---
title: "周报-11｜"
date: 2023-03-20T09:00:00+08:00
draft: true
slug: weekly_review_11
categories: [Ideas]
tags: [review,yuque]
authors:
- chensoul
---

## 前言

本篇是对 `2023-03-13` 到 `2023-03-19` 这周生活的记录与思考。首发在我的个人 [博客](https://blog.chensoul.com/) ，你可以移步了解更多或者给我留言。

## Obsidian 使用

上周提到开始使用 格志 APP 来写日志



1、将语雀文档导出为 markdown

参考 [yuque/yuque-exporter](https://github.com/yuque/yuque-exporter) 文档，下载 yuque-exporter  之后进行导出操作，发现以下问题：

- 该项目需要使用的 nodejs 版本为 18.0.4 
- nodejs 使用正确的版本还是导出失败



于是，改为使用源码编译和运行导出。先下载代码：

```bash
git clone https://github.com/yuque/yuque-exporter.git
```



修改 main.ts 中需要导出的语雀知识库地址为自己的仓库地址：

```ts
// Determining if an ESM module is main then run the code
if (import.meta.url.startsWith('file:')) {
  const modulePath = fileURLToPath(import.meta.url);
  if (process.argv[1] === modulePath) {
    const urlPaths = [
      'chensoul/rose',
      'chensoul/growup',
      'chensoul/tech',
    ];
    await start({ urlPaths });
  }
}
```



参考 [文档](https://www.yuque.com/yuque/developer/api#785a3731) 申请语雀 TOKEN。



下载项目依赖：

```bash
npm i
```



运行项目，开始导出：

```bash
YUQUE_TOKEN=XXXXXX npm start
```

导出的文件在 storage 目录，接下来可以拷贝到 Obsidian 目录里。



另外，可以在源码做一些修改：

- 导出的 markdown 文件不要有 frontmatter，修改 doc.ts 中 buildDoc 方法：
```ts
export async function buildDoc(doc: TreeNode, mapping: Record<string, TreeNode>) {
  const docDetail = await readJSON(path.join(metaDir, doc.namespace, 'docs', `${doc.url}.json`));
  const content = await remark()
    .data('settings', { bullet: '-', listItemIndent: 'one' })
    .use([
      [ replaceHTML ],
      [ relativeLink, { doc, mapping }],
      [ downloadAsset, { doc, mapping }],
    ])
    .process(docDetail.body);

  //  doc.content = frontmatter(doc) + content.toString();
  doc.content = content.toString();

  // FIXME: remark will transform `*` to `\*`
  doc.content = doc.content.replaceAll('\\*', '*');

  return doc;
}
```
- 导出的段落之间增加换行，修改 doc.ts 中 replaceHTML 方法：
```ts
function replaceHTML() {
  return tree => {
    const htmlNodes = selectAll('html', tree) as Text[];
    for (const node of htmlNodes) {
      if (node.value === '<br />' || node.value === '<br/>') {
        node.type = 'text';
        node.value = '\n\n\n';
      }
    }
  };
}
```

