[{"content":"å•æœºå®‰è£… é€šè¿‡ yum å®‰è£… åœ¨ CentOS 7 ä¸Šé€šè¿‡ yum å®‰è£… Redisï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œï¼š\næ›´æ–°ç³»ç»Ÿè½¯ä»¶åŒ…ï¼š\nsudo yum update å®‰è£… Redisï¼š\nsudo yum install redis å¯ä»¥çœ‹åˆ°é»˜è®¤å®‰è£…çš„ redis ç‰ˆæœ¬æ˜¯ 3.2.12-2.el7\nå¦‚æœéœ€è¦å®‰è£… redis 7ï¼Œè¿™éœ€è¦ä¸‹è½½ yum æºï¼š\nsudo yum install epel-release sudo yum -y install http://rpms.remirepo.net/enterprise/remi-release-7.rpm ç„¶åï¼Œåœ¨æŒ‡å®šæºè¿›è¡Œå®‰è£…ï¼š\nyum --enablerepo=remi install redis å¯åŠ¨ Redis æœåŠ¡ï¼š\nsudo systemctl start redis é…ç½® Redis å¼€æœºè‡ªå¯åŠ¨ï¼š\nsudo systemctl enable redis ä¿®æ”¹é…ç½®æ–‡ä»¶ /etc/redis.conf\nä¿®æ”¹ bind å’Œ requirepass\nbind 0.0.0.0 requirepass 123456 ç„¶åé‡å¯ redisï¼š\nsudo systemctl restart redis å¼€å¯é˜²ç«å¢™ï¼ˆå¯é€‰ï¼‰\n# æ·»åŠ  redis ç«¯å£ firewall-cmd --zone=public --add-port=6379/tcp --permanent firewall-cmd --zone=public --add-port=6379/udp --permanent # é‡å¯é˜²ç«å¢™ firewall-cmd --reload è¿è¡Œ redis-cli\nredis-cli 127.0.0.1:6379\u0026gt; auth 123456 OK é€šè¿‡ snap å®‰è£… å®‰è£… redis\nsudo snap install redis æŸ¥çœ‹ snap å®‰è£…çš„åŒ…ï¼š\nsnap list å¯åŠ¨ Redisï¼š\nsudo snap start redis è¿è¡Œ redis-cli\nRedisçš„snapå®‰è£…æ²¡æœ‰é¢„é…ç½®çš„æ–‡ä»¶(redis.conf)ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨Redisçš„CLIè¿›å…¥æ§åˆ¶å°å¹¶è¿›è¡Œé…ç½®ã€‚\nredis.cli # æ‰“å°æ‰€æœ‰çš„é…ç½® 127.0.0.1:6379\u0026gt; CONFIG GET * é…ç½®å¤–ç½‘è®¿é—®\nè¦é…ç½®Redisä»¥å…è®¸å¤–éƒ¨ç½‘ç»œè®¿é—®ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š\n127.0.0.1:6379\u0026gt; CONFIG GET bind 127.0.0.1:6379\u0026gt; config set bind 0.0.0.0 è¿™å°†ç»‘å®šRedisæœåŠ¡å™¨åˆ°0.0.0.0 IPåœ°å€ï¼Œä½¿å…¶å¯¹å¤–å¯è®¿é—®ã€‚è¯·æ³¨æ„ï¼Œè¿™å¯èƒ½ä¼šå¸¦æ¥ä¸€äº›å®‰å…¨é£é™©ï¼Œå› æ­¤è¯·è°¨æ…æ“ä½œã€‚\nè®¾ç½®ä¿æŠ¤æ¨¡å¼\n127.0.0.1:6379\u0026gt; CONFIG SET protected-mode no è¯¥æ¨¡å¼æ§åˆ¶å¤–éƒ¨ç½‘æ˜¯å¦å¯ä»¥è¿æ¥ redis æœåŠ¡ï¼Œé»˜è®¤æ˜¯ yes, æ‰€ä»¥é»˜è®¤æˆ‘ä»¬å¤–ç½‘æ˜¯æ— æ³•è®¿é—®çš„ï¼Œå¦‚éœ€å¤–ç½‘è¿æ¥ rendis æœåŠ¡åˆ™éœ€è¦å°†æ­¤å±æ€§æ”¹ä¸º noã€‚\nè®¾ç½®è®¿é—®å¯†ç \n127.0.0.1:6379\u0026gt; config set requirepass mypass è¿™å°†è®¾ç½®ä¸€ä¸ªåä¸º\u0026quot;mypass\u0026quot;çš„å¯†ç ä½œä¸ºè®¿é—®Redisçš„è¦æ±‚ã€‚è¯·ç¡®ä¿å°†\u0026quot;mypass\u0026quot;æ›¿æ¢ä¸ºæ‚¨é€‰æ‹©çš„å¼ºå¯†ç ã€‚\nå‡çº§\nsudo snap refresh redis å¸è½½\nsudo snap remove redis åœ¨ MacOS å®‰è£… å®‰è£… Redisï¼š\nbrew install redis å¯åŠ¨ Redis æœåŠ¡å™¨ï¼š\nbrew services start redis è¿™å°†å¯åŠ¨ Redis æœåŠ¡å™¨å¹¶ä½¿å…¶åœ¨åå°è¿è¡Œã€‚\næŸ¥çœ‹ Redis çŠ¶æ€\nbrew services info redis éªŒè¯ Redis å®‰è£…ï¼š\næ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥éªŒè¯ Redis æ˜¯å¦æˆåŠŸå®‰è£…å¹¶æ­£åœ¨è¿è¡Œï¼š\nredis-cli ping å¦‚æœ Redis æ­£å¸¸è¿è¡Œï¼Œå®ƒå°†è¿”å› \u0026ldquo;PONG\u0026rdquo;ã€‚\nåœæ­¢ Redis æœåŠ¡å™¨ï¼š\nbrew services stop redis é€šè¿‡æºç å®‰è£… å®‰è£…ç¼–è¯‘è½¯ä»¶\nyum -y install gcc gcc-c++ kernel-devel åˆ›å»ºå®‰è£…ç›®å½•\nmkdir -p /usr/local/redis ä¸‹è½½æºä»£ç å¹¶è§£å‹\nwget https://download.redis.io/redis-stable.tar.gz tar -xzvf redis-stable.tar.gz è¿›å…¥éƒ½ç›®ï¼Œç¼–è¯‘å®‰è£…\ncd redis-stable make prefix=/usr/local/redis/ install make installé»˜è®¤å®‰è£…åˆ°/usr/local/binç›®å½•ä¸‹ï¼Œå¦‚æœéœ€è¦æŒ‡å®šå®‰è£…è·¯å¾„ï¼Œéœ€è¦æ·»åŠ PREFIXå‚æ•°\næ‹·è´é…ç½®æ–‡ä»¶\nmkdir /usr/local/redis/conf cp redis.conf /usr/local/redis/conf/ ä¿®æ”¹ redis.conf åŠ å…¥ä»¥ä¸‹é…ç½®ï¼š\n# å…è®¸å“ªäº› IP åœ°å€å¯ä»¥è®¿é—® bind 0.0.0.0 # ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œ daemonize yes # è®¾ç½®å¯†ç æˆæƒ requirepass \u0026lt;è®¾ç½®å¯†ç \u0026gt; å¯åŠ¨Redisï¼š\nredis-server /usr/local/redis/conf/redis.conf æŸ¥çœ‹è¿›ç¨‹ï¼š\nps -ef|grep redis åœæ­¢redisæœåŠ¡ï¼š\nredis-cli shutdown é€šè¿‡ docker å®‰è£… åœ¨Dockerä¸­è¿è¡ŒRediså®¹å™¨ï¼Œå¹¶è®¾ç½®å¯†ç ä¿æŠ¤å’ŒæŒä¹…åŒ–å­˜å‚¨çš„é…ç½®\nREDIS_PASSWORD=123456 docker run \\ -d \\ --restart always \\ --privileged=true \\ --name redis \\ -v /etc/localtime:/etc/localtime \\ -p 6379:6379 \\ redis:7 \\ --requirepass $REDIS_PASSWORD \\ --appendonly yes å‚æ•°è¯´æ˜ï¼š\nREDIS_PASSWORD=123456ï¼šè®¾ç½®Redisçš„å¯†ç ä¸º123456ã€‚å¯ä»¥æ ¹æ®éœ€è¦æ›´æ”¹å¯†ç ã€‚ docker runï¼šè¿è¡ŒDockerå®¹å™¨å‘½ä»¤ã€‚ -dï¼šä»¥åå°æ¨¡å¼è¿è¡Œå®¹å™¨ã€‚ --restart alwaysï¼šè®¾ç½®å®¹å™¨åœ¨å¯åŠ¨æ—¶è‡ªåŠ¨é‡å¯ã€‚ --privileged=trueï¼šæˆäºˆå®¹å™¨ç‰¹æƒï¼Œä»¥ä¾¿åœ¨å®¹å™¨å†…éƒ¨æ‰§è¡Œç‰¹æƒæ“ä½œã€‚ --name redisï¼šæŒ‡å®šå®¹å™¨çš„åç§°ä¸ºredisã€‚ -v /etc/localtime:/etc/localtimeï¼šå°†ä¸»æœºçš„æ—¶åŒºè®¾ç½®æ˜ å°„åˆ°å®¹å™¨å†…éƒ¨ï¼Œä»¥ç¡®ä¿æ—¶é—´åŒæ­¥ã€‚ -p 6379:6379ï¼šå°†ä¸»æœºçš„6379ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„6379ç«¯å£ï¼Œä»¥ä¾¿å¯ä»¥é€šè¿‡ä¸»æœºIPå’Œç«¯å£è®¿é—®Redisã€‚ redis:7ï¼šæŒ‡å®šè¦è¿è¡Œçš„Redisé•œåƒç‰ˆæœ¬ä¸º7ã€‚ --requirepass $REDIS_PASSWORDï¼šè®¾ç½®Redisçš„å¯†ç ä¸ºä¹‹å‰å®šä¹‰çš„REDIS_PASSWORDå˜é‡çš„å€¼ã€‚ --appendonly yesï¼šå¼€å¯Redisçš„AOFï¼ˆAppend-Only Fileï¼‰æŒä¹…åŒ–æ¨¡å¼ï¼Œå°†å†™æ“ä½œè¿½åŠ åˆ°æ–‡ä»¶ä¸­ï¼Œä»¥ä¿è¯æ•°æ®æŒä¹…åŒ–ã€‚ é€šè¿‡ docker-compose å®‰è£… ä½¿ç”¨Docker Composeé…ç½®Rediså•æœºå®¹å™¨ï¼Œhttps://github.com/chensoul/learn-docker/blob/main/docker-compose/redis/docker-compose.redis.yml\nversion: \u0026#39;3.0\u0026#39; services: # Redis standalone redis: image: bitnami/redis:7.2 restart: always environment: # ALLOW_EMPTY_PASSWORD is recommended only for development. ALLOW_EMPTY_PASSWORD: \u0026#34;yes\u0026#34; ports: - \u0026#39;6379:6379\u0026#39; volumes: - redis-data:/bitnami/redis/data healthcheck: test: [ \u0026#34;CMD\u0026#34;, \u0026#34;redis-cli\u0026#34;,\u0026#34;--raw\u0026#34;, \u0026#34;incr\u0026#34;,\u0026#34;ping\u0026#34; ] interval: 5s timeout: 2s retries: 10 volumes: redis-data: restart: alwaysï¼šè®¾ç½®å®¹å™¨åœ¨åœæ­¢åè‡ªåŠ¨é‡å¯ã€‚ environmentï¼šå®šä¹‰å®¹å™¨çš„ç¯å¢ƒå˜é‡ã€‚ ALLOW_EMPTY_PASSWORD: \u0026quot;yes\u0026quot;ï¼šå…è®¸ä½¿ç”¨ç©ºå¯†ç ï¼ˆä»…åœ¨å¼€å‘ç¯å¢ƒä¸­å»ºè®®ä½¿ç”¨ï¼‰ã€‚ portsï¼šæŒ‡å®šå®¹å™¨ç«¯å£ä¸ä¸»æœºç«¯å£çš„æ˜ å°„å…³ç³»ã€‚ '6379:6379'ï¼šå°†ä¸»æœºçš„6379ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„6379ç«¯å£ï¼Œä»¥ä¾¿å¯ä»¥é€šè¿‡ä¸»æœºIPå’Œç«¯å£è®¿é—®Redisã€‚ volumesï¼šå®šä¹‰å®¹å™¨çš„æ•°æ®å·ã€‚ redis-data:/bitnami/redis/dataï¼šå°†Rediså®¹å™¨çš„æ•°æ®å­˜å‚¨åœ¨åä¸ºredis-dataçš„å·ä¸­ã€‚ healthcheckï¼šå®šä¹‰å®¹å™¨çš„å¥åº·æ£€æŸ¥ã€‚ test: [ \u0026quot;CMD\u0026quot;, \u0026quot;redis-cli\u0026quot;,\u0026quot;--raw\u0026quot;, \u0026quot;incr\u0026quot;,\u0026quot;ping\u0026quot; ]ï¼šä½¿ç”¨Redisçš„å¥åº·æ£€æŸ¥å‘½ä»¤æ¥æµ‹è¯•å®¹å™¨çš„å¥åº·çŠ¶æ€ã€‚ interval: 5sï¼šæ¯5ç§’è¿è¡Œä¸€æ¬¡å¥åº·æ£€æŸ¥ã€‚ timeout: 2sï¼šæ¯æ¬¡å¥åº·æ£€æŸ¥çš„è¶…æ—¶æ—¶é—´ä¸º2ç§’ã€‚ retries: 10ï¼šæœ€å¤šé‡è¯•10æ¬¡å¥åº·æ£€æŸ¥ã€‚ é›†ç¾¤æ¨¡å¼å®‰è£… é€šè¿‡ yum å®‰è£… TODO\né€šè¿‡ docker-compose å®‰è£… https://github.com/chensoul/learn-docker/blob/main/docker-compose/redis/docker-compose.redis-cluster.yml\nversion: \u0026#39;3.0\u0026#39; services: # Redis cluster redis-node-0: image: bitnami/redis-cluster:7.2 volumes: - redis-cluster-data-0:/bitnami/redis/data environment: - REDIS_PASSWORD=redis - REDISCLI_AUTH=redis - REDIS_NODES=redis-node-0 redis-node-1 redis-node-2 redis-node-3 redis-node-4 redis-node-5 redis-node-1: image: bitnami/redis-cluster:7.2 volumes: - redis-cluster-data-1:/bitnami/redis/data depends_on: - redis-node-0 environment: - REDIS_PASSWORD=redis - REDISCLI_AUTH=redis - REDIS_NODES=redis-node-0 redis-node-1 redis-node-2 redis-node-3 redis-node-4 redis-node-5 redis-node-2: image: bitnami/redis-cluster:7.2 volumes: - redis-cluster-data-2:/bitnami/redis/data depends_on: - redis-node-1 environment: - REDIS_PASSWORD=redis - REDISCLI_AUTH=redis - REDIS_NODES=redis-node-0 redis-node-1 redis-node-2 redis-node-3 redis-node-4 redis-node-5 redis-node-3: image: bitnami/redis-cluster:7.2 volumes: - redis-cluster-data-3:/bitnami/redis/data depends_on: - redis-node-2 environment: - REDIS_PASSWORD=redis - REDISCLI_AUTH=redis - REDIS_NODES=redis-node-0 redis-node-1 redis-node-2 redis-node-3 redis-node-4 redis-node-5 redis-node-4: image: bitnami/redis-cluster:7.2 volumes: - redis-cluster-data-4:/bitnami/redis/data depends_on: - redis-node-3 environment: - REDIS_PASSWORD=redis - REDISCLI_AUTH=redis - REDIS_NODES=redis-node-0 redis-node-1 redis-node-2 redis-node-3 redis-node-4 redis-node-5 redis-node-5: image: bitnami/redis-cluster:7.2 volumes: - redis-cluster-data-5:/bitnami/redis/data depends_on: - redis-node-0 - redis-node-1 - redis-node-2 - redis-node-3 - redis-node-4 environment: - REDIS_PASSWORD=redis - REDISCLI_AUTH=redis - REDIS_NODES=redis-node-0 redis-node-1 redis-node-2 redis-node-3 redis-node-4 redis-node-5 - REDIS_CLUSTER_REPLICAS=1 - REDIS_CLUSTER_CREATOR=yes volumes: redis-cluster-data-0: redis-cluster-data-1: redis-cluster-data-2: redis-cluster-data-3: redis-cluster-data-4: redis-cluster-data-5: å“¨å…µæ¨¡å¼å®‰è£… é€šè¿‡ yum å®‰è£… TODO\né€šè¿‡ docker-compose å®‰è£… https://github.com/chensoul/learn-docker/blob/main/docker-compose/redis/docker-compose.redis-sentinel.yml\nversion: \u0026#39;3.0\u0026#39; services: # Redis sentinel redis-master: image: bitnami/redis:7.2 volumes: - redis-sentinel-data-master:/bitnami/redis/data environment: - REDIS_REPLICATION_MODE=master - REDIS_PASSWORD=123456 redis-slave: image: bitnami/redis:7.2 volumes: - redis-sentinel-data-slave:/bitnami/redis/data environment: - REDIS_REPLICATION_MODE=slave - REDIS_MASTER_HOST=redis-master - REDIS_MASTER_PASSWORD=123456 - REDIS_PASSWORD=123456 depends_on: - redis-master redis-sentinel: image: bitnami/redis:7.2 volumes: - redis-sentinel-data-sentinel:/bitnami/redis/data environment: - REDIS_MASTER_HOST=redis-master - REDIS_MASTER_SET=mymaster - REDIS_SENTINEL_PASSWORD=123456 - REDIS_MASTER_PASSWORD=123456 depends_on: - redis-master - redis-slave volumes: redis-sentinel-data-master: redis-sentinel-data-slave: redis-sentinel-data-sentinel: ","permalink":"https://blog.chensoul.cc/posts/2024/05/14/redis-install/","summary":"å•æœºå®‰è£… é€šè¿‡ yum å®‰è£… åœ¨ CentOS 7 ä¸Šé€šè¿‡ yum å®‰è£… Redisï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œï¼š\næ›´æ–°ç³»ç»Ÿè½¯ä»¶åŒ…ï¼š\nsudo yum update å®‰è£… Redisï¼š\nsudo yum install redis å¯ä»¥çœ‹åˆ°é»˜è®¤å®‰è£…çš„ redis ç‰ˆæœ¬æ˜¯ 3.2.12-2.el7\nå¦‚æœéœ€è¦å®‰è£… redis 7ï¼Œè¿™éœ€è¦ä¸‹è½½ yum æºï¼š\nsudo yum install epel-release sudo yum -y install http://rpms.remirepo.net/enterprise/remi-release-7.rpm ç„¶åï¼Œåœ¨æŒ‡å®šæºè¿›è¡Œå®‰è£…ï¼š\nyum --enablerepo=remi install redis å¯åŠ¨ Redis æœåŠ¡ï¼š\nsudo systemctl start redis é…ç½® Redis å¼€æœºè‡ªå¯åŠ¨ï¼š\nsudo systemctl enable redis ä¿®æ”¹é…ç½®æ–‡ä»¶ /etc/redis.conf\nä¿®æ”¹ bind å’Œ requirepass\nbind 0.0.0.0 requirepass 123456 ç„¶åé‡å¯ redisï¼š\nsudo systemctl restart redis å¼€å¯é˜²ç«å¢™ï¼ˆå¯é€‰ï¼‰\n# æ·»åŠ  redis ç«¯å£ firewall-cmd --zone=public --add-port=6379/tcp --permanent firewall-cmd --zone=public --add-port=6379/udp --permanent # é‡å¯é˜²ç«å¢™ firewall-cmd --reload è¿è¡Œ redis-cli\nredis-cli 127.0.0.1:6379\u0026gt; auth 123456 OK é€šè¿‡ snap å®‰è£… å®‰è£… redis","title":"Rediså®‰è£…å’Œéƒ¨ç½²"},{"content":"å®‰è£… ArgoCD å®‰è£…ï¼š\n$ kubectl create namespace argocd $ kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml æŸ¥çœ‹å®‰è£…æ˜¯å¦æˆåŠŸï¼Œå½“argocdå‘½åç©ºé—´ä¸‹PodçŠ¶æ€éƒ½ä¸ºRunningæ—¶è¡¨ç¤ºå®‰è£…æˆåŠŸã€‚\nkubectl get pod -A æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå°†åä¸ºargocd-serverçš„Serviceç±»å‹ä¿®æ”¹ä¸ºNodePortã€‚\n$ kubectl patch svc argocd-server -n argocd -p \u0026#39;{\u0026#34;spec\u0026#34;: {\u0026#34;type\u0026#34;: \u0026#34;NodePort\u0026#34;}}\u0026#39; service/argocd-server patched æŸ¥çœ‹ä¿®æ”¹ç»“æœã€‚\n$ kubectl -n argocd get svc NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE argocd-applicationset-controller ClusterIP 10.43.184.106 \u0026lt;none\u0026gt; 7000/TCP,8080/TCP 24h argocd-dex-server ClusterIP 10.43.99.202 \u0026lt;none\u0026gt; 5556/TCP,5557/TCP,5558/TCP 24h argocd-metrics ClusterIP 10.43.47.99 \u0026lt;none\u0026gt; 8082/TCP 24h argocd-notifications-controller-metrics ClusterIP 10.43.58.49 \u0026lt;none\u0026gt; 9001/TCP 24h argocd-redis ClusterIP 10.43.70.36 \u0026lt;none\u0026gt; 6379/TCP 24h argocd-repo-server ClusterIP 10.43.40.224 \u0026lt;none\u0026gt; 8081/TCP,8084/TCP 24h argocd-server NodePort 10.43.180.135 \u0026lt;none\u0026gt; 80:31912/TCP,443:32728/TCP 24h argocd-server-metrics ClusterIP 10.43.5.195 \u0026lt;none\u0026gt; 8083/TCP 24h é€šè¿‡ argocd-server Serviceè®¿é—®Argo CDï¼Œç›´æ¥ä½¿ç”¨èŠ‚ç‚¹IP:ç«¯å£å·è®¿é—®å³å¯ã€‚ä¾‹å¦‚æœ¬ç¤ºä¾‹ä¸­ï¼Œç«¯å£å·ä¸º32728ã€‚\nç™»å½•ç”¨æˆ·åä¸ºadminï¼Œå¯†ç å¯ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è·å–ã€‚\n$ kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath=\u0026#34;{.data.password}\u0026#34; | base64 -d;echo ä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤ä¿®æ”¹å¯†ç ï¼š\n$ argocd account update-password --account admin --current-password xxxx --new-password xxxx å®‰è£… Argo CLI å®‰è£…Argo CDå®¢æˆ·ç«¯\n$ wget https://github.com/argoproj/argo-cd/releases/download/v2.11.0/argocd-linux-amd64 $ cp argocd-linux-amd64 /usr/local/bin/argocd $ chmod +x /usr/local/bin/argocd $ argocd version ä½¿ç”¨ ä½¿ç”¨ Argo CLI ç™»å½•ArgoæœåŠ¡ç«¯ï¼Œç”¨æˆ·åä¸º adminã€‚\nargocd login 192.168.1.107:32728 --username admin --password J22WcGIGcDnbmOtB å…ˆæŸ¥çœ‹é›†ç¾¤ï¼š\n$ kubectl config get-contexts CURRENT NAME CLUSTER AUTHINFO NAMESPACE * default default default æ·»åŠ é›†ç¾¤ï¼š\nargocd cluster add default --kubeconfig $HOME/.kube/config --name k3s ä¸Šé¢å‘½ä»¤ä¸­ï¼Œdefault æ˜¯é›†ç¾¤ä¸Šä¸‹æ–‡åç§°ï¼Œ$HOME/.kube/config æ˜¯kubectlé…ç½®æ–‡ä»¶æ‰€åœ¨è·¯å¾„ï¼Œk3s æ˜¯é›†ç¾¤åœ¨Argo CDä¸­å®šä¹‰çš„åç§°ã€‚\næ·»åŠ  git ä»“åº“ï¼Œä»¥å…¬å¼€çš„ https://github.com/yangchuansheng/argocd-lab ä»“åº“ä¸ºä¾‹ï¼Œç”¨æˆ·åå’Œå¯†ç å¯ä»¥ä¸ºç©º\n# argocd repo add https://github.com/yangchuansheng/argocd-lab.git --username \u0026lt;username\u0026gt; --password \u0026lt;password\u0026gt; argocd repo add https://github.com/yangchuansheng/argocd-lab.git åœ¨æœåŠ¡å™¨é‡Œè®¿é—® github ä¼šè¶…æ—¶ï¼Œå¯ä»¥å°†è¯¥ä»“åº“å¯¼å…¥è‡ªå·±æ­å»ºçš„ git æœåŠ¡å™¨ï¼Œæ¯”å¦‚ gitnessã€‚ä¾‹å¦‚ï¼šå¯¼å…¥åçš„åœ°å€ä¸º http://192.168.3.180:3000/git/test/argocd-lab.gitï¼Œä¿®æ”¹æ·»åŠ ä»“åº“å‘½ä»¤ä¸ºï¼š\nargocd repo add http://192.168.3.180:3000/git/test/argocd-lab.git åœ¨Argo CDä¸­æ·»åŠ åº”ç”¨ã€‚\nargocd app create nginx --repo http://192.168.3.180:3000/git/test/argocd-lab.git --path dev --dest-server https://192.168.1.107:6443 --dest-namespace test åŒæ­¥åº”ç”¨ï¼š\nargocd app sync nginx åœ¨ https://192.168.1.107:32728/applications æŸ¥çœ‹åº”ç”¨çŠ¶æ€ã€‚\né›†ç¾¤ä¸­å¯ä»¥æŸ¥çœ‹åˆ°éƒ¨ç½²äº†ä¸€ä¸ª nginx å·¥ä½œè´Ÿè½½å’Œä¸€ä¸ªs erviceã€‚\n$ kubectl get all -n test NAME READY STATUS RESTARTS AGE pod/test-64b8fff975-c9dp5 1/1 Running 0 6m37s pod/test-64b8fff975-jztwd 1/1 Running 0 6m37s NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE service/test-service ClusterIP 10.43.54.34 \u0026lt;none\u0026gt; 80/TCP 6m37s NAME READY UP-TO-DATE AVAILABLE AGE deployment.apps/test 2/2 2 2 6m37s NAME DESIRED CURRENT READY AGE replicaset.apps/test-64b8fff975 2 2 2 6m37s ä½¿ç”¨ Argo Service åˆ›å»º Application ä»¥ https://github.com/yangchuansheng/argocd-lab é¡¹ç›®ä½œä¸ºç¤ºä¾‹ï¼Œé€šè¿‡ kubectl åˆ›å»ºåº”ç”¨ï¼š\n$ kubectl apply -f https://raw.githubusercontent.com/yangchuansheng/argocd-lab/main/application.yaml application.argoproj.io/myapp-argo-application created ç¨ç­‰ç‰‡åˆ»ï¼Œåœ¨ Argo CD å¯è§†åŒ–ç•Œé¢ä¸­å¯ä»¥çœ‹åˆ°åº”ç”¨å·²ç»åˆ›å»ºæˆåŠŸäº†ã€‚\nä½¿ç”¨Argo Rolloutså®ç°ç°åº¦å‘å¸ƒ å‚è€ƒï¼š https://support.huaweicloud.com/bestpractice-cce/cce_bestpractice_10007.html\nå‚è€ƒæ–‡ç«  Argo CD å…¥é—¨æ•™ç¨‹\nä½¿ç”¨Argo CDå®ç°æŒç»­äº¤ä»˜\nArgo cd å®‰è£…å’Œéƒ¨ç½²\nArgo CD ç®€ä»‹\nä½¿ç”¨ Argo CD è¿›è¡Œ GitOps æµæ°´çº¿æ”¹é€ \nåŸºäº Argo CD çš„ GitOps å®è·µç¬”è®°\nåœ¨ Kubernetes ä¸Šä½¿ç”¨ ArgoCD å’Œ Jenkins å®ç°ç«¯åˆ°ç«¯ GitOps è‡ªåŠ¨åŒ– â€” ç¬¬ä¸€éƒ¨åˆ† â€” ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ ArgoCDï¼Ÿ\nArgo Workflows ä¸­æ–‡å¿«é€ŸæŒ‡å—\n","permalink":"https://blog.chensoul.cc/posts/2024/05/11/argocd/","summary":"å®‰è£… ArgoCD å®‰è£…ï¼š\n$ kubectl create namespace argocd $ kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml æŸ¥çœ‹å®‰è£…æ˜¯å¦æˆåŠŸï¼Œå½“argocdå‘½åç©ºé—´ä¸‹PodçŠ¶æ€éƒ½ä¸ºRunningæ—¶è¡¨ç¤ºå®‰è£…æˆåŠŸã€‚\nkubectl get pod -A æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå°†åä¸ºargocd-serverçš„Serviceç±»å‹ä¿®æ”¹ä¸ºNodePortã€‚\n$ kubectl patch svc argocd-server -n argocd -p \u0026#39;{\u0026#34;spec\u0026#34;: {\u0026#34;type\u0026#34;: \u0026#34;NodePort\u0026#34;}}\u0026#39; service/argocd-server patched æŸ¥çœ‹ä¿®æ”¹ç»“æœã€‚\n$ kubectl -n argocd get svc NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE argocd-applicationset-controller ClusterIP 10.43.184.106 \u0026lt;none\u0026gt; 7000/TCP,8080/TCP 24h argocd-dex-server ClusterIP 10.43.99.202 \u0026lt;none\u0026gt; 5556/TCP,5557/TCP,5558/TCP 24h argocd-metrics ClusterIP 10.43.47.99 \u0026lt;none\u0026gt; 8082/TCP 24h argocd-notifications-controller-metrics ClusterIP 10.43.58.49 \u0026lt;none\u0026gt; 9001/TCP 24h argocd-redis ClusterIP 10.43.70.36 \u0026lt;none\u0026gt; 6379/TCP 24h argocd-repo-server ClusterIP 10.43.40.224 \u0026lt;none\u0026gt; 8081/TCP,8084/TCP 24h argocd-server NodePort 10.43.180.135 \u0026lt;none\u0026gt; 80:31912/TCP,443:32728/TCP 24h argocd-server-metrics ClusterIP 10.43.5.195 \u0026lt;none\u0026gt; 8083/TCP 24h é€šè¿‡ argocd-server Serviceè®¿é—®Argo CDï¼Œç›´æ¥ä½¿ç”¨èŠ‚ç‚¹IP:ç«¯å£å·è®¿é—®å³å¯ã€‚ä¾‹å¦‚æœ¬ç¤ºä¾‹ä¸­ï¼Œç«¯å£å·ä¸º32728ã€‚\nç™»å½•ç”¨æˆ·åä¸ºadminï¼Œå¯†ç å¯ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è·å–ã€‚","title":"ä½¿ç”¨Argo CDå®ç°æŒç»­äº¤ä»˜"},{"content":" Wikipediaï¼šWebSocket\nWebSocket - Web APIs | MDN\nPubNubï¼šä»€ä¹ˆæ˜¯ WebSocketï¼Ÿ\nWhat are WebSockets?\nwebsocket protocol - RFC6455 - tools.ietf.org\nWebSocket\nAblyï¼šWhat are WebSockets used for? Pusherï¼šWhat are WebSockets?\nWebSocket vs. HTTP communication protocols\nWhat are WebSockets? | Web Security Academy\nEducativeï¼šWhat is WebSocket?\nSpringï¼šWebSocket\nWriting a WebSocket server in Java - Web APIs\nBaeldungï¼šA Guide to the Java API for WebSocket\nBaeldungï¼šA Java Client for a WebSockets API\nWebSocket Implementation with Spring Boot and STOMP\nApiFoxï¼šWebSocketåè®®å…¥é—¨åˆ°ç²¾é€š\nJSR 356, Java API for WebSocket\nWebSocket åè®®è§£æ [RFC 6455]\nWebSocketåŸç†åŠæŠ€æœ¯ç®€ä»‹\nã€NO.23ã€‘ä¸€ç¯‡æ–‡ç« å½»åº•ææ‡‚websocketåè®®çš„åŸç†ä¸åº”ç”¨ï¼ˆä¸€ï¼‰\nWebSocket åè®®è¯¦è§£\nWebSocket åè®®ï¼ˆRFC 6455 ä¸­æ–‡ç‰ˆï¼‰\nç”¨JAVAåˆ†åˆ«å®ç°WebSocketå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯\nWebSocket Programming with Java\nMQTT Websocket Client\n","permalink":"https://blog.chensoul.cc/posts/2024/05/10/all-things-about-websocket/","summary":"Wikipediaï¼šWebSocket\nWebSocket - Web APIs | MDN\nPubNubï¼šä»€ä¹ˆæ˜¯ WebSocketï¼Ÿ\nWhat are WebSockets?\nwebsocket protocol - RFC6455 - tools.ietf.org\nWebSocket\nAblyï¼šWhat are WebSockets used for? Pusherï¼šWhat are WebSockets?\nWebSocket vs. HTTP communication protocols\nWhat are WebSockets? | Web Security Academy\nEducativeï¼šWhat is WebSocket?\nSpringï¼šWebSocket\nWriting a WebSocket server in Java - Web APIs\nBaeldungï¼šA Guide to the Java API for WebSocket\nBaeldungï¼šA Java Client for a WebSockets API\nWebSocket Implementation with Spring Boot and STOMP\nApiFoxï¼šWebSocketåè®®å…¥é—¨åˆ°ç²¾é€š\nJSR 356, Java API for WebSocket\nWebSocket åè®®è§£æ [RFC 6455]\nWebSocketåŸç†åŠæŠ€æœ¯ç®€ä»‹\nã€NO.23ã€‘ä¸€ç¯‡æ–‡ç« å½»åº•ææ‡‚websocketåè®®çš„åŸç†ä¸åº”ç”¨ï¼ˆä¸€ï¼‰\nWebSocket åè®®è¯¦è§£\nWebSocket åè®®ï¼ˆRFC 6455 ä¸­æ–‡ç‰ˆï¼‰\nç”¨JAVAåˆ†åˆ«å®ç°WebSocketå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯\nWebSocket Programming with Java\nMQTT Websocket Client","title":"All things about WebSocket"},{"content":"å‰ææ¡ä»¶ Kubernetes é›†ç¾¤ï¼šå¯ä»¥ä½¿ç”¨ RKEã€RKE2ã€K3S ç­‰å·¥å…·å®‰è£…é›†ç¾¤ Ingress Controllerï¼šå¯¹äº RKEã€RKE2 å’Œ K3sï¼Œä½ ä¸éœ€è¦æ‰‹åŠ¨å®‰è£… Ingress Controllerï¼Œå› ä¸ºå®ƒæ˜¯é»˜è®¤å®‰è£…çš„ã€‚ CLI å·¥å…·ï¼šå®‰è£… kubectl å’Œ helm ä½¿ç”¨ docker å®‰è£… Rancher mkdir -p /data/rancher docker run --name rancher --privileged -d --restart=unless-stopped -p 80:80 -p 443:443 -v /data/rancher:/var/lib/rancher/ rancher/rancher:stable docker logs -f rancher ä½¿ç”¨ helm å®‰è£… Rancher å‚è€ƒï¼šåœ¨ Kubernetes é›†ç¾¤ä¸Šå®‰è£…/å‡çº§ Rancher\næ·»åŠ  Helm Chart ä»“åº“ï¼Œå®‰è£… cert-manager helm repo add rancher-stable https://releases.rancher.com/server-charts/stable helm repo add jetstack https://charts.jetstack.io helm repo update helm install cert-manager jetstack/cert-manager \\ --namespace cert-manager \\ --create-namespace \\ --version v1.14.5 \\ --set installCRDs=true kubectl get pods --namespace cert-manager ä¸åŒçš„è¯ä¹¦é…ç½®éœ€è¦ä½¿ç”¨ä¸åŒçš„ Rancher å®‰è£…å‘½ä»¤ã€‚ å…ˆåˆ›å»ºå‘½åç©ºé—´ï¼š\nkubectl create namespace cattle-system é»˜è®¤æƒ…å†µæ˜¯ä½¿ç”¨ Rancher ç”Ÿæˆ CAï¼Œå¹¶ä½¿ç”¨ cert-manager é¢å‘ç”¨äºè®¿é—® Rancher Server æ¥å£çš„è¯ä¹¦ã€‚\nhelm install rancher rancher-stable/rancher \\ --namespace cattle-system \\ --set hostname=rancher.chensoul.cc \\ --set bootstrapPassword=admin ä½¿ç”¨ cert-manager æ¥è‡ªåŠ¨è¯·æ±‚å’Œç»­è®¢ Let\u0026rsquo;s Encrypt è¯ä¹¦ã€‚Let\u0026rsquo;s Encrypt æ˜¯å…è´¹çš„ï¼Œè€Œä¸”æ˜¯å—ä¿¡çš„ CAï¼Œå› æ­¤å¯ä»¥ä¸ºä½ æä¾›æœ‰æ•ˆçš„è¯ä¹¦ã€‚\n#Letâ€™s Encrypt helm install rancher rancher-stable/rancher \\ --namespace cattle-system \\ --set hostname=rancher.chensoul.cc \\ --set bootstrapPassword=admin \\ --set ingress.tls.source=letsEncrypt \\ --set letsEncrypt.email=ichensoul@gmail.com \\ --set letsEncrypt.ingress.class=nginx ä½¿ç”¨ä½ è‡ªå·±çš„è¯ä¹¦æ¥åˆ›å»º Kubernetes å¯†æ–‡ï¼Œä»¥ä¾› Rancher ä½¿ç”¨ã€‚\nç”Ÿæˆè‡ªç­¾åè¯ä¹¦ï¼Œå‚è€ƒï¼šä¸€é”®ç”Ÿæˆ-ssl-è‡ªç­¾åè¯ä¹¦è„šæœ¬\næ£€æŸ¥ Rancher æ˜¯å¦å·²æˆåŠŸè¿è¡Œï¼š kubectl -n cattle-system rollout status deploy/rancher kubectl -n cattle-system get deploy rancher kubectl -n cattle-system describe deploy rancher æŸ¥çœ‹ rancher å¯†ç ï¼š kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=\u0026#39;{{.data.bootstrapPassword|base64decode}}{{ \u0026#34;\\n\u0026#34; }}\u0026#39; è®¿é—® Rancherï¼šhttps://rancher.chensoul.cc/ å¸è½½ Rancher git clone https://github.com/rancher/rancher-cleanup cd rancher-cleanup sh cleanup.sh ","permalink":"https://blog.chensoul.cc/posts/2024/05/10/install-rancher/","summary":"å‰ææ¡ä»¶ Kubernetes é›†ç¾¤ï¼šå¯ä»¥ä½¿ç”¨ RKEã€RKE2ã€K3S ç­‰å·¥å…·å®‰è£…é›†ç¾¤ Ingress Controllerï¼šå¯¹äº RKEã€RKE2 å’Œ K3sï¼Œä½ ä¸éœ€è¦æ‰‹åŠ¨å®‰è£… Ingress Controllerï¼Œå› ä¸ºå®ƒæ˜¯é»˜è®¤å®‰è£…çš„ã€‚ CLI å·¥å…·ï¼šå®‰è£… kubectl å’Œ helm ä½¿ç”¨ docker å®‰è£… Rancher mkdir -p /data/rancher docker run --name rancher --privileged -d --restart=unless-stopped -p 80:80 -p 443:443 -v /data/rancher:/var/lib/rancher/ rancher/rancher:stable docker logs -f rancher ä½¿ç”¨ helm å®‰è£… Rancher å‚è€ƒï¼šåœ¨ Kubernetes é›†ç¾¤ä¸Šå®‰è£…/å‡çº§ Rancher\næ·»åŠ  Helm Chart ä»“åº“ï¼Œå®‰è£… cert-manager helm repo add rancher-stable https://releases.rancher.com/server-charts/stable helm repo add jetstack https://charts.jetstack.io helm repo update helm install cert-manager jetstack/cert-manager \\ --namespace cert-manager \\ --create-namespace \\ --version v1.14.5 \\ --set installCRDs=true kubectl get pods --namespace cert-manager ä¸åŒçš„è¯ä¹¦é…ç½®éœ€è¦ä½¿ç”¨ä¸åŒçš„ Rancher å®‰è£…å‘½ä»¤ã€‚ å…ˆåˆ›å»ºå‘½åç©ºé—´ï¼š\nkubectl create namespace cattle-system é»˜è®¤æƒ…å†µæ˜¯ä½¿ç”¨ Rancher ç”Ÿæˆ CAï¼Œå¹¶ä½¿ç”¨ cert-manager é¢å‘ç”¨äºè®¿é—® Rancher Server æ¥å£çš„è¯ä¹¦ã€‚","title":"åœ¨Kubernetesé›†ç¾¤ä¸Šå®‰è£…Rancher"},{"content":"cert-manager ä¸º Kubernetes æˆ– OpenShift é›†ç¾¤ä¸­çš„å·¥ä½œè´Ÿè½½åˆ›å»º TLS è¯ä¹¦ï¼Œå¹¶åœ¨è¯ä¹¦è¿‡æœŸä¹‹å‰ç»­è®¢è¯ä¹¦ã€‚\ncert-manager å¯ä»¥ä»å„ç§è¯ä¹¦é¢å‘æœºæ„è·å–è¯ä¹¦ï¼ŒåŒ…æ‹¬ï¼š Let\u0026rsquo;s Encryptã€HashiCorp Vaultã€ Venafiå’Œç§æœ‰ PKIã€‚\nä½¿ç”¨ cert-manager çš„è¯ä¹¦èµ„æºï¼Œç§é’¥å’Œè¯ä¹¦å­˜å‚¨åœ¨ Kubernetes Secret ä¸­ï¼Œè¯¥ Secret ç”±åº”ç”¨ç¨‹åº Pod æŒ‚è½½æˆ–ç”± Ingress æ§åˆ¶å™¨ä½¿ç”¨ã€‚ä½¿ç”¨csi-driverã€csi-driver-spiffeæˆ–istio-csrï¼Œç§é’¥æ˜¯åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨ä¹‹å‰æŒ‰éœ€ç”Ÿæˆçš„ï¼›ç§é’¥æ°¸è¿œä¸ä¼šç¦»å¼€èŠ‚ç‚¹ï¼Œå¹¶ä¸”ä¸ä¼šå­˜å‚¨åœ¨ Kubernetes Secret ä¸­ã€‚\nå®‰è£… å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://cert-manager.io/docs/installation/\nä½¿ç”¨kubectlå®‰è£… kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.14.5/cert-manager.yaml æŸ¥çœ‹ï¼š\n$ kubectl get pods --namespace cert-manager ä½¿ç”¨helmå®‰è£… æ·»åŠ  repoï¼š\nhelm repo add jetstack https://charts.jetstack.io --force-update helm repo update å®‰è£… cert-managerï¼š\nhelm install cert-manager jetstack/cert-manager \\ --namespace cert-manager \\ --create-namespace \\ --version v1.14.5 \\ --set installCRDs=true æ›´å¤šé…ç½®å‚æ•°ï¼Œå‚è€ƒï¼šhttps://artifacthub.io/packages/helm/cert-manager/cert-manager\næŸ¥çœ‹çŠ¶æ€\n$ kubectl -n cert-manager rollout status deploy/cert-manager deployment \u0026#34;cert-manager\u0026#34; successfully rolled out $ kubectl get pods -n cert-manager NAME READY STATUS RESTARTS AGE pod/cert-manager-5c47f46f57-k78l6 1/1 Running 0 91s pod/cert-manager-cainjector-6659d6844d-tr8rf 1/1 Running 0 91s pod/cert-manager-webhook-547567b88f-8lthd 1/1 Running 0 91s ä½¿ç”¨helm3æŸ¥çœ‹ï¼š\n$ helm list -n cert-manager NAME NAMESPACE REVISION\tUPDATED STATUS CHART cert-manager\tcert-manager\t1 2024-05-09 17:35:59.976722226 +0800 CST\tdeployed\tcert-manager-v1.14.5\tv1.14.5 éªŒè¯ åˆ›å»ºè‡ªç­¾åè¯ä¹¦è¿›è¡ŒéªŒè¯ï¼š\n$ cat \u0026lt;\u0026lt;EOF \u0026gt; test-resources.yaml apiVersion: v1 kind: Namespace metadata: name: cert-manager-test --- apiVersion: cert-manager.io/v1 kind: Issuer metadata: name: test-selfsigned namespace: cert-manager-test spec: selfSigned: {} --- apiVersion: cert-manager.io/v1 kind: Certificate metadata: name: selfsigned-cert namespace: cert-manager-test spec: dnsNames: - example.com secretName: selfsigned-cert-tls issuerRef: name: test-selfsigned EOF åˆ›å»º test-resourcesï¼š\n$ kubectl apply -f test-resources.yaml æŸ¥çœ‹è¯ä¹¦çŠ¶æ€ï¼š\n$ kubectl describe certificate -n cert-manager-test Name: selfsigned-cert Namespace: cert-manager-test Labels: \u0026lt;none\u0026gt; Annotations: \u0026lt;none\u0026gt; API Version: cert-manager.io/v1 Kind: Certificate Metadata: Creation Timestamp: 2024-05-09T23:25:16Z Generation: 1 Resource Version: 302521 UID: 4a691ab3-4a7a-476d-9cd6-028285bca5ba Spec: Dns Names: example.com Issuer Ref: Name: test-selfsigned Secret Name: selfsigned-cert-tls Status: Conditions: Last Transition Time: 2024-05-09T23:25:17Z Message: Certificate is up to date and has not expired Observed Generation: 1 Reason: Ready Status: True Type: Ready Not After: 2024-08-07T23:25:17Z Not Before: 2024-05-09T23:25:17Z Renewal Time: 2024-07-08T23:25:17Z Revision: 1 Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal Issuing 8s cert-manager-certificates-trigger Issuing certificate as Secret does not exist Normal Generated 7s cert-manager-certificates-key-manager Stored new private key in temporary Secret resource \u0026#34;selfsigned-cert-f66n5\u0026#34; Normal Requested 7s cert-manager-certificates-request-manager Created new CertificateRequest resource \u0026#34;selfsigned-cert-1\u0026#34; Normal Issuing 7s cert-manager-certificates-issuing The certificate has been successfully issued åˆ é™¤ test-resourcesï¼š\n$ kubectl delete -f test-resources.yaml å¸è½½ #é€šè¿‡kubectlåˆ é™¤ kubectl delete -f https://github.com/cert-manager/cert-manager/releases/download/v1.14.5/cert-manager.crds.yaml #é€šè¿‡helm3åˆ é™¤ helm --namespace cert-manager delete cert-manager kubectl delete namespace cert-manager ç”Ÿæˆè¯ä¹¦ æ¦‚å¿µä»‹ç» Issuer å®‰è£… cert-manager åï¼Œæ‚¨éœ€è¦é…ç½®çš„ç¬¬ä¸€ä»¶äº‹æ˜¯Issueræˆ–ClusterIssuerã€‚Issuers å’Œ ClusterIssuers æ˜¯ Kubernetes èµ„æºï¼Œè¡¨ç¤ºèƒ½å¤Ÿé€šè¿‡æ¥å—è¯ä¹¦ç­¾åè¯·æ±‚æ¥ç”Ÿæˆç­¾åè¯ä¹¦çš„è¯ä¹¦é¢å‘æœºæ„ ï¼ˆCAï¼‰ã€‚æ‰€æœ‰ cert-manager è¯ä¹¦éƒ½éœ€è¦ä¸€ä¸ªå¤„äºå°±ç»ªçŠ¶æ€çš„å¼•ç”¨é¢å‘è€…æ¥å°è¯•æ¥å—è¯·æ±‚ã€‚\nä¸€ä¸ªç®€å•çš„ CA Issuer å¦‚ä¸‹ï¼š\napiVersion: cert-manager.io/v1 kind: Issuer metadata: name: ca-issuer namespace: mesh-system spec: ca: secretName: ca-key-pair è¿™æ˜¯ä¸€ä¸ªåŸºäºç§é’¥å¯¹è¯ä¹¦è¿›è¡Œç­¾åçš„ç®€å• Issuer æ–¹æ³•ã€‚ç„¶åï¼Œå­˜å‚¨åœ¨å¯†é’¥ ca-key-pair ä¸­çš„è¯ä¹¦å¯ç”¨äº Issuer åœ¨å…¬é’¥åŸºç¡€ç»“æ„ ï¼ˆPKIï¼‰ ç³»ç»Ÿä¸­ä¿¡ä»»æ–°ç­¾åçš„è¯ä¹¦ã€‚\nIssuers å’Œ ClusterIssuer åŒºåˆ«ï¼š\nIssuers æ˜¯åŸºäºå‘½åç©ºé—´çš„ ClusterIssuer æ˜¯åŸºäºé›†ç¾¤çš„ ACME Orders å’Œ Challenges cert-manager æ”¯æŒä½¿ç”¨ACME Issuerä» ACME æœåŠ¡å™¨è¯·æ±‚è¯ä¹¦ï¼ŒåŒ…æ‹¬ä»Let\u0026rsquo;s Encryptè¯·æ±‚è¯ä¹¦ã€‚è¿™äº›è¯ä¹¦é€šå¸¸åœ¨å…¬å…± Internet ä¸Šå—åˆ°å¤§å¤šæ•°è®¡ç®—æœºçš„ä¿¡ä»»ã€‚è¦æˆåŠŸè¯·æ±‚è¯ä¹¦ï¼Œè¯ä¹¦ç®¡ç†å™¨å¿…é¡»è§£å†³å·²å®Œæˆçš„ ACME æŒ‘æˆ˜ï¼Œä»¥è¯æ˜å®¢æˆ·ç«¯æ‹¥æœ‰æ‰€è¯·æ±‚çš„ DNS åœ°å€ã€‚\nä¸ºäº†å®Œæˆè¿™äº›æŒ‘æˆ˜ï¼Œcert-managerå¼•å…¥äº†ä¸¤ç§ CustomResourceç±»å‹ï¼›Orderså’ŒChallengesã€‚\nACME æ”¯æŒä¸¤ç§éªŒè¯æ–¹å¼ï¼š\nDNS éªŒè¯ï¼šé€šè¿‡ DNS01 è´¨è¯¢ï¼Œæ‚¨å¯ä»¥é€šè¿‡è¯æ˜æ‚¨æ§åˆ¶åŸŸåçš„ DNS è®°å½•æ¥è¯æ˜å…¶æ‰€æœ‰æƒã€‚è¿™æ˜¯é€šè¿‡åˆ›å»ºå…·æœ‰ç‰¹å®šå†…å®¹çš„ TXT è®°å½•æ¥å®Œæˆçš„ï¼Œè¯¥è®°å½•è¯æ˜æ‚¨æ‹¥æœ‰å¯¹åŸŸ DNS è®°å½•çš„æ§åˆ¶æƒ HTTP éªŒè¯ï¼šé€šè¿‡ HTTP01 è´¨è¯¢ï¼Œæ‚¨å¯ä»¥é€šè¿‡ç¡®ä¿åŸŸä¸­å­˜åœ¨ç‰¹å®šæ–‡ä»¶æ¥è¯æ˜åŸŸçš„æ‰€æœ‰æƒã€‚ Let\u0026rsquo;s Encrypt çš„ ACME æœåŠ¡å™¨åˆ†ä¸ºä¸¤ç§ï¼š\næš‚å­˜ç¯å¢ƒï¼šhttps://acme-staging-v02.api.letsencrypt.org/directory ç”Ÿäº§ç¯å¢ƒï¼šhttps://acme-v02.api.letsencrypt.org/directory ç”Ÿäº§ç¯å¢ƒæ–½åŠ äº†æ›´ä¸¥æ ¼çš„é€Ÿç‡é™åˆ¶ï¼Œå› æ­¤ä¸ºäº†å‡å°‘æ‚¨è¾¾åˆ°è¿™äº›é™åˆ¶çš„æœºä¼šï¼Œå»ºè®®æµ‹è¯•è¿‡ç¨‹ä¸­ä½¿ç”¨æš‚å­˜ç¯å¢ƒã€‚\nLetâ€™s Encrypt åˆ©ç”¨ ACME åè®®æ¥æ ¡éªŒåŸŸåæ˜¯å¦çœŸçš„å±äºä½ ï¼Œæ ¡éªŒæˆåŠŸåå°±å¯ä»¥è‡ªåŠ¨é¢å‘å…è´¹è¯ä¹¦ï¼Œè¯ä¹¦æœ‰æ•ˆæœŸåªæœ‰ 90 å¤©ï¼Œåœ¨åˆ°æœŸå‰éœ€è¦å†æ ¡éªŒä¸€æ¬¡æ¥å®ç°ç»­æœŸï¼Œå¹¸è¿çš„æ˜¯ cert-manager å¯ä»¥è‡ªåŠ¨ç»­æœŸï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨æ°¸ä¹…å…è´¹çš„è¯ä¹¦äº†ã€‚å¦‚ä½•æ ¡éªŒè¿™ä¸ªåŸŸåæ˜¯å¦å±äºä½ å‘¢ï¼Ÿä¸»æµçš„ä¸¤ç§æ ¡éªŒæ–¹å¼æ˜¯ HTTP-01 å’Œ DNS-01ï¼Œè¯¦ç»†æ ¡éªŒåŸç†å¯å‚è€ƒ Let\u0026rsquo;s Encrypt çš„è¿ä½œæ–¹å¼ï¼Œä¸‹é¢å°†ç®€å•æè¿°ä¸‹ã€‚\nLetâ€™s Encryptç”Ÿæˆè¯ä¹¦ ACME é¢å‘è¯ä¹¦å¹¶ä½¿ç”¨ HTTP éªŒè¯ HTTP-01 çš„æ ¡éªŒåŸç†æ˜¯ç»™ä½ åŸŸåæŒ‡å‘çš„ HTTP æœåŠ¡å¢åŠ ä¸€ä¸ªä¸´æ—¶ location ï¼ŒLetâ€™s Encrypt ä¼šå‘é€ http è¯·æ±‚åˆ° http:///.well-known/acme-challenge/ï¼ŒYOUR_DOMAIN å°±æ˜¯è¢«æ ¡éªŒçš„åŸŸåï¼ŒTOKEN æ˜¯ ACME åè®®çš„å®¢æˆ·ç«¯è´Ÿè´£æ”¾ç½®çš„æ–‡ä»¶ï¼Œåœ¨è¿™é‡Œ ACME å®¢æˆ·ç«¯å°±æ˜¯ cert-managerï¼Œå®ƒé€šè¿‡ä¿®æ”¹æˆ–åˆ›å»º Ingress è§„åˆ™æ¥å¢åŠ è¿™ä¸ªä¸´æ—¶æ ¡éªŒè·¯å¾„å¹¶æŒ‡å‘æä¾› TOKEN çš„æœåŠ¡ã€‚Letâ€™s Encrypt ä¼šå¯¹æ¯” TOKEN æ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œæ ¡éªŒæˆåŠŸåå°±ä¼šé¢å‘è¯ä¹¦ã€‚æ­¤æ–¹æ³•ä»…é€‚ç”¨äºç»™ä½¿ç”¨ Ingress æš´éœ²æµé‡çš„æœåŠ¡é¢å‘è¯ä¹¦ï¼Œå¹¶ä¸”ä¸æ”¯æŒæ³›åŸŸåè¯ä¹¦ã€‚\nå…ˆåˆ›å»ºä¸€ä¸ªé¢å‘è€…ï¼Œå› ä¸ºæµ‹è¯•ï¼Œä½¿ç”¨æš‚å­˜ç¯å¢ƒçš„ ACME æœåŠ¡å™¨ã€‚\ncat \u0026lt;\u0026lt;EOF \u0026gt; letsencrypt-staging.yaml apiVersion: cert-manager.io/v1 kind: Issuer metadata: name: letsencrypt-staging spec: acme: # The ACME server URL server: https://acme-staging-v02.api.letsencrypt.org/directory # Email address used for ACME registration email: ichensoul@gmail.com # Name of a secret used to store the ACME account private key privateKeySecretRef: name: letsencrypt-staging # Enable the HTTP-01 challenge provider solvers: # An empty \u0026#39;selector\u0026#39; means that this solver matches all domains - selector: {} http01: ingress: ingressClassName: nginx EOF åˆ›å»ºé¢å‘è€…ï¼š\n$ kubectl apply -f letsencrypt-staging.yaml åˆ›å»ºè¯ä¹¦ï¼š\ncat \u0026lt;\u0026lt;EOF \u0026gt; chensoul-cc-tls.yaml apiVersion: cert-manager.io/v1 kind: Certificate metadata: name: chensoul-cc-tls spec: secretName: chensoul-cc-tls issuerRef: name: letsencrypt-staging commonName: test.chensoul.cc dnsNames: - test.chensoul.cc EOF åˆ›å»ºè¯ä¹¦ï¼š\n$ kubectl apply -f chensoul-cc-tls.yaml certificate.cert-manager.io/chensoul-cc-tls created æŸ¥çœ‹çŠ¶æ€ï¼š\nkubectl get secret,certificate,Issuer,ClusterIssuer kubectl describe Issuer letsencrypt-staging kubectl describe Secret cloudflare-api-token-secret kubectl describe certificate chensoul-cc-tls kubectl describe CertificateRequest chensoul-cc-tls kubectl describe order chensoul-cc-tls kubectl describe Challenge chensoul-cc-tls ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œç›´åˆ°è¯ä¹¦çŠ¶æ€å˜ä¸ºTrueï¼š\n$ kubectl get secret,certificate,Issuer,ClusterIssuer NAME TYPE DATA AGE secret/chensoul-cc-tls kubernetes.io/tls 2 47s secret/cloudflare-api-token-secret Opaque 1 2m39s secret/letsencrypt-staging Opaque 1 5m34s NAME READY SECRET AGE certificate.cert-manager.io/chensoul-cc-tls True chensoul-cc-tls 2m31s NAME READY AGE issuer.cert-manager.io/letsencrypt-staging True 2m39s è¿˜å¯ä»¥æŸ¥çœ‹è¯ä¹¦çš„ TLS Base64 é”®å€¼å¯¹ï¼š\nkubectl get secret chensoul-cc-tls -o yaml åˆ é™¤ç›¸å…³èµ„æºï¼š\nkubectl delete Secret cloudflare-api-token-secret letsencrypt-staging chensoul-cc-tls kubectl delete Issuers letsencrypt-staging kubectl delete certificate chensoul-cc-tls ACME é¢å‘è¯ä¹¦å¹¶ä½¿ç”¨ DNS éªŒè¯ DNS-01 çš„æ ¡éªŒåŸç†æ˜¯åˆ©ç”¨ DNS æä¾›å•†çš„ API Key æ‹¿åˆ°ä½ çš„ DNS æ§åˆ¶æƒé™ï¼Œ åœ¨ Letâ€™s Encrypt ä¸º ACME å®¢æˆ·ç«¯æä¾›ä»¤ç‰Œåï¼ŒACME å®¢æˆ·ç«¯ (cert-manager) å°†åˆ›å»ºä»è¯¥ä»¤ç‰Œå’Œæ‚¨çš„å¸æˆ·å¯†é’¥æ´¾ç”Ÿçš„ TXT è®°å½•ï¼Œå¹¶å°†è¯¥è®°å½•æ”¾åœ¨ _acme-challenge.ã€‚ ç„¶å Letâ€™s Encrypt å°†å‘ DNS ç³»ç»ŸæŸ¥è¯¢è¯¥è®°å½•ï¼Œå¦‚æœæ‰¾åˆ°åŒ¹é…é¡¹ï¼Œå°±å¯ä»¥é¢å‘è¯ä¹¦ã€‚æ­¤æ–¹æ³•ä¸éœ€è¦ä½ çš„æœåŠ¡ä½¿ç”¨ Ingressï¼Œå¹¶ä¸”æ”¯æŒæ³›åŸŸåè¯ä¹¦ã€‚\nå‚è€ƒï¼šhttps://medium.com/@sms-astanley/custom-issuers-with-letsencrypt-and-rancher-ingress-2c89ab1b0a91\nå…ˆåˆ›å»ºä¸€ä¸ªé¢å‘è€…ï¼Œç„¶åæ ¹æ®åŸŸåè§£æé€‰æ‹© DNS01 æä¾›å•†ï¼Œæ”¯æŒçš„æä¾›å•†å‚è€ƒï¼šhttps://cert-manager.io/docs/configuration/acme/dns01/\næˆ‘çš„ DNS æä¾›å•†ä¸º Cloudflareï¼Œå‚è€ƒ https://cert-manager.io/docs/configuration/acme/dns01/cloudflare/ åœ¨ Cloudflare åˆ›å»ºä¸€ä¸ª API token æˆ–è€… API KEYã€‚\ncat \u0026lt;\u0026lt;EOF \u0026gt; letsencrypt-staging.yaml apiVersion: v1 kind: Secret metadata: name: cloudflare-api-token-secret type: Opaque stringData: api-token: SSQ0XP71lyfFDjIMPuwtti7v-LhOQlpPe5ruK-9Z --- apiVersion: cert-manager.io/v1 kind: Issuer metadata: name: letsencrypt-staging spec: acme: email: ichensoul@gmail.com server: https://acme-staging-v02.api.letsencrypt.org/directory # Name of a secret used to store the ACME account private key privateKeySecretRef: name: letsencrypt-staging solvers: - dns01: cloudflare: email: ichensoul@gmail.com apiTokenSecretRef: name: cloudflare-api-token-secret key: api-token EOF åˆ›å»ºé¢å‘è€…ï¼š\n$ kubectl apply -f letsencrypt-staging.yaml secret/cloudflare-api-token-secret created issuer.cert-manager.io/letsencrypt-staging created å¦‚æœæƒ³å°†è¿™ä¸ª Issuer è®¾ç½®ä¸ºé»˜è®¤ä½¿ç”¨ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹å‘½ä»¤å‡çº§ cert-manager\nhelm upgrade cert-manager jetstack/cert-manager --set \u0026#39;extraArgs={--default-issuer-name=letsencrypt-prod,--default-issuer-kind=ClusterIssuer}\u0026#39; -n cert-manager åˆ›å»ºä¸€ä¸ªè¯ä¹¦ï¼š\ncat \u0026lt;\u0026lt;EOF \u0026gt; chensoul-cc-tls.yaml apiVersion: cert-manager.io/v1 kind: Certificate metadata: name: chensoul-cc-tls spec: secretName: chensoul-cc-tls issuerRef: name: letsencrypt-staging kind: Issuer commonName: test.chensoul.cc dnsNames: - test.chensoul.cc EOF åˆ›å»ºè¯ä¹¦ï¼š\n$ kubectl apply -f chensoul-cc-tls.yaml certificate.cert-manager.io/chensoul-cc-tls created æŸ¥çœ‹çŠ¶æ€ï¼š\nkubectl get secret,certificate,Issuer,ClusterIssuer kubectl describe Issuer letsencrypt-staging kubectl describe Secret cloudflare-api-token-secret kubectl describe certificate chensoul-cc-tls kubectl describe CertificateRequest chensoul-cc-tls kubectl describe order chensoul-cc-tls kubectl describe Challenge chensoul-cc-tls ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œç›´åˆ°è¯ä¹¦çŠ¶æ€å˜ä¸ºTrueï¼š\n$ kubectl get secret,certificate,Issuer,ClusterIssuer NAME TYPE DATA AGE secret/chensoul-cc-tls kubernetes.io/tls 2 47s secret/cloudflare-api-token-secret Opaque 1 2m39s secret/letsencrypt-staging Opaque 1 5m34s NAME READY SECRET AGE certificate.cert-manager.io/chensoul-cc-tls True chensoul-cc-tls 2m31s NAME READY AGE issuer.cert-manager.io/letsencrypt-staging True 2m39s è¿˜å¯ä»¥æŸ¥çœ‹è¯ä¹¦çš„ TLS Base64 é”®å€¼å¯¹ï¼š\nkubectl get secret chensoul-cc-tls -o yaml åˆ é™¤ç›¸å…³èµ„æºï¼š\nkubectl delete Secret cloudflare-api-token-secret letsencrypt-staging chensoul-cc-tls kubectl delete Issuers letsencrypt-staging kubectl delete certificate chensoul-cc-tls æ ¡éªŒæ–¹å¼å¯¹æ¯” HTTP-01 çš„æ ¡éªŒæ–¹å¼çš„ä¼˜ç‚¹æ˜¯: é…ç½®ç®€å•é€šç”¨ï¼Œä¸ç®¡ä½¿ç”¨å“ªä¸ª DNS æä¾›å•†éƒ½å¯ä»¥ä½¿ç”¨ç›¸åŒçš„é…ç½®æ–¹æ³•ï¼›ç¼ºç‚¹æ˜¯ï¼šéœ€è¦ä¾èµ– Ingressï¼Œå¦‚æœä½ çš„æœåŠ¡ä¸æ˜¯ç”¨ Ingress æš´éœ²æµé‡çš„å°±ä¸é€‚ç”¨ï¼Œè€Œä¸”ä¸æ”¯æŒæ³›åŸŸåè¯ä¹¦ã€‚\nDNS-01 çš„æ ¡éªŒæ–¹å¼çš„ä¼˜ç‚¹æ˜¯æ²¡æœ‰ HTTP-01 æ ¡éªŒæ–¹å¼ç¼ºç‚¹ï¼Œä¸ä¾èµ– Ingressï¼Œä¹Ÿæ”¯æŒæ³›åŸŸåï¼›ç¼ºç‚¹å°±æ˜¯ä¸åŒ DNS æä¾›å•†çš„é…ç½®æ–¹å¼ä¸ä¸€æ ·ï¼Œè€Œä¸” DNS æä¾›å•†æœ‰å¾ˆå¤šï¼Œcert-manager çš„ Issuer ä¸å¯èƒ½æ¯ä¸ªéƒ½å»æ”¯æŒï¼Œä¸è¿‡æœ‰ä¸€äº›å¯ä»¥é€šè¿‡éƒ¨ç½²å®ç°äº† cert-manager çš„ Webhook çš„æœåŠ¡æ¥æ‰©å±• Issuer è¿›è¡Œæ”¯æŒï¼Œæ¯”å¦‚ DNSPod å’Œ é˜¿é‡Œ DNSï¼Œè¯¦ç»† Webhook åˆ—è¡¨è¯·å‚è€ƒ: https://cert-manager.io/docs/configuration/acme/dns01/#webhook\né€‰æ‹©å“ªç§æ–¹å¼å‘¢ï¼Ÿæ¡ä»¶å…è®¸çš„è¯ï¼Œå»ºè®®æ˜¯å°½é‡ç”¨ DNS-01 çš„æ–¹å¼ï¼Œé™åˆ¶æ›´å°‘ï¼ŒåŠŸèƒ½æ›´å…¨ã€‚\nå‚è€ƒæ–‡ç«  Make SSL certs easy with k3s https://www.thebookofjoel.com/k3s-cert-manager-letsencrypt ä½¿ç”¨ LetsEncrypté…ç½®kubernetes ingress-nginxå…è´¹HTTPSè¯ä¹¦ cert-managerç®¡ç†k8sé›†ç¾¤è¯ä¹¦ https://blog.csdn.net/xichenguan/article/details/100709830 https://medium.com/@sms-astanley/custom-issuers-with-letsencrypt-and-rancher-ingress-2c89ab1b0a91 ","permalink":"https://blog.chensoul.cc/posts/2024/05/10/install-cert-manager/","summary":"cert-manager ä¸º Kubernetes æˆ– OpenShift é›†ç¾¤ä¸­çš„å·¥ä½œè´Ÿè½½åˆ›å»º TLS è¯ä¹¦ï¼Œå¹¶åœ¨è¯ä¹¦è¿‡æœŸä¹‹å‰ç»­è®¢è¯ä¹¦ã€‚\ncert-manager å¯ä»¥ä»å„ç§è¯ä¹¦é¢å‘æœºæ„è·å–è¯ä¹¦ï¼ŒåŒ…æ‹¬ï¼š Let\u0026rsquo;s Encryptã€HashiCorp Vaultã€ Venafiå’Œç§æœ‰ PKIã€‚\nä½¿ç”¨ cert-manager çš„è¯ä¹¦èµ„æºï¼Œç§é’¥å’Œè¯ä¹¦å­˜å‚¨åœ¨ Kubernetes Secret ä¸­ï¼Œè¯¥ Secret ç”±åº”ç”¨ç¨‹åº Pod æŒ‚è½½æˆ–ç”± Ingress æ§åˆ¶å™¨ä½¿ç”¨ã€‚ä½¿ç”¨csi-driverã€csi-driver-spiffeæˆ–istio-csrï¼Œç§é’¥æ˜¯åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨ä¹‹å‰æŒ‰éœ€ç”Ÿæˆçš„ï¼›ç§é’¥æ°¸è¿œä¸ä¼šç¦»å¼€èŠ‚ç‚¹ï¼Œå¹¶ä¸”ä¸ä¼šå­˜å‚¨åœ¨ Kubernetes Secret ä¸­ã€‚\nå®‰è£… å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼šhttps://cert-manager.io/docs/installation/\nä½¿ç”¨kubectlå®‰è£… kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.14.5/cert-manager.yaml æŸ¥çœ‹ï¼š\n$ kubectl get pods --namespace cert-manager ä½¿ç”¨helmå®‰è£… æ·»åŠ  repoï¼š\nhelm repo add jetstack https://charts.jetstack.io --force-update helm repo update å®‰è£… cert-managerï¼š\nhelm install cert-manager jetstack/cert-manager \\ --namespace cert-manager \\ --create-namespace \\ --version v1.14.5 \\ --set installCRDs=true æ›´å¤šé…ç½®å‚æ•°ï¼Œå‚è€ƒï¼šhttps://artifacthub.io/packages/helm/cert-manager/cert-manager\næŸ¥çœ‹çŠ¶æ€\n$ kubectl -n cert-manager rollout status deploy/cert-manager deployment \u0026#34;cert-manager\u0026#34; successfully rolled out $ kubectl get pods -n cert-manager NAME READY STATUS RESTARTS AGE pod/cert-manager-5c47f46f57-k78l6 1/1 Running 0 91s pod/cert-manager-cainjector-6659d6844d-tr8rf 1/1 Running 0 91s pod/cert-manager-webhook-547567b88f-8lthd 1/1 Running 0 91s ä½¿ç”¨helm3æŸ¥çœ‹ï¼š","title":"K8så®‰è£…Cert Manager"},{"content":"Drone by Harness â„¢ æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„æŒç»­é›†æˆå¹³å°ï¼Œä½¿å¿™ç¢Œçš„å›¢é˜Ÿèƒ½å¤Ÿä½¿ç”¨å¼ºå¤§çš„äº‘åŸç”Ÿç®¡é“å¼•æ“è‡ªåŠ¨åŒ–å…¶æ„å»ºã€æµ‹è¯•å’Œå‘å¸ƒå·¥ä½œæµç¨‹ã€‚\nDroneå®è·µ Docker å®¹å™¨ç¯å¢ƒä¸‹çš„æŒç»­é›†æˆæœ€ä½³å®è·µï¼šæ„å»ºåŸºäº Drone + GitFlow + K8s çš„äº‘åŸç”Ÿè¯­ä¹‰åŒ– CI å·¥ä½œæµ å®¹å™¨ç¯å¢ƒæŒç»­é›†æˆä¼˜åŒ–ï¼ŒDrone CI æé€Ÿ 500% åœ¨Kubernetesä¸Šæ‰§è¡ŒDrone CI/CD ç©è½¬ Drone CI åŸºäº gogs/gitlab å’Œ drone æ­å»ºçš„ CI/CD å¹³å° åŸºäºdroneæ„å»ºCI/CDç³»ç»Ÿ,å¯¹æ¥k8s ä½¿ç”¨Droneæ„å»ºé™æ€åšå®¢\nHugo + Gogs + Drone æ­å»ºåšå®¢ How to build a Hugo static site automatically using Drone CI and Codeberg.org Static Website Generation on Steriods with Docker A HUGO PLUGIN FOR YOUR DRONE CI PIPELINE droneæŒç»­é›†æˆ-å‘å¸ƒgithub pages è§†é¢‘æ•™å­¦ ä¸€å¤©å­¸æœƒ DevOps è‡ªå‹•åŒ–æ¸¬è©¦åŠéƒ¨ç½² ","permalink":"https://blog.chensoul.cc/posts/2024/05/09/all-things-about-drone/","summary":"Drone by Harness â„¢ æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„æŒç»­é›†æˆå¹³å°ï¼Œä½¿å¿™ç¢Œçš„å›¢é˜Ÿèƒ½å¤Ÿä½¿ç”¨å¼ºå¤§çš„äº‘åŸç”Ÿç®¡é“å¼•æ“è‡ªåŠ¨åŒ–å…¶æ„å»ºã€æµ‹è¯•å’Œå‘å¸ƒå·¥ä½œæµç¨‹ã€‚\nDroneå®è·µ Docker å®¹å™¨ç¯å¢ƒä¸‹çš„æŒç»­é›†æˆæœ€ä½³å®è·µï¼šæ„å»ºåŸºäº Drone + GitFlow + K8s çš„äº‘åŸç”Ÿè¯­ä¹‰åŒ– CI å·¥ä½œæµ å®¹å™¨ç¯å¢ƒæŒç»­é›†æˆä¼˜åŒ–ï¼ŒDrone CI æé€Ÿ 500% åœ¨Kubernetesä¸Šæ‰§è¡ŒDrone CI/CD ç©è½¬ Drone CI åŸºäº gogs/gitlab å’Œ drone æ­å»ºçš„ CI/CD å¹³å° åŸºäºdroneæ„å»ºCI/CDç³»ç»Ÿ,å¯¹æ¥k8s ä½¿ç”¨Droneæ„å»ºé™æ€åšå®¢\nHugo + Gogs + Drone æ­å»ºåšå®¢ How to build a Hugo static site automatically using Drone CI and Codeberg.org Static Website Generation on Steriods with Docker A HUGO PLUGIN FOR YOUR DRONE CI PIPELINE droneæŒç»­é›†æˆ-å‘å¸ƒgithub pages è§†é¢‘æ•™å­¦ ä¸€å¤©å­¸æœƒ DevOps è‡ªå‹•åŒ–æ¸¬è©¦åŠéƒ¨ç½² ","title":"All things about Drone"},{"content":"k3supæ˜¯ä¸€ä¸ªæ”¯æŒåœ¨PCã€è™šæ‹Ÿæœºã€ARMè®¾å¤‡ä¸Šå®‰è£…k3sçš„å·¥å…·ï¼Œå®˜æ–¹ç½‘ç«™ï¼šhttps://k3sup.dev/\nå®‰è£…k3sup åœ¨çº¿å®‰è£…ï¼š\ncurl -sLS https://get.k3sup.dev | sh sudo install k3sup /usr/local/bin/ ç¦»çº¿å®‰è£…ï¼Œä¸‹è½½åœ°å€ï¼šhttps://github.com/alexellis/k3sup/releases\nwget https://github.com/alexellis/k3sup/releases/download/0.13.5/k3sup mv k3sup /usr/local/bin/ chmod +x /usr/local/bin/k3sup æŸ¥çœ‹ç‰ˆæœ¬ï¼š\n$ k3sup version _ _____ | | _|___ / ___ _ _ _ __ | |/ / |_ \\/ __| | | | \u0026#39;_ \\ | \u0026lt; ___) \\__ \\ |_| | |_) | |_|\\_\\____/|___/\\__,_| .__/ |_| bootstrap K3s over SSH in \u0026lt; 60s ğŸš€ ğŸš€ Speed up GitHub Actions/GitLab CI + reduce costs: https://actuated.dev Version: 0.13.5 Git Commit: d952d6df22b06147806ca1030b8ba3a4bb9e0c0c åˆ›å»ºk3sé›†ç¾¤ åˆ›å»ºä¸€ä¸ªæœ¬åœ°é›†ç¾¤ k3sup install \\ --local \\ --context localk3s \\ --k3s-channel stable \\ --k3s-extra-args \u0026#39;--docker\u0026#39; æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š\n$ k3sup ready --context localk3s --kubeconfig ./kubeconfig Checking cluster status: 1/25 All node(s) are ready æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹ï¼š\n$ kubectl get nodes -o wide NAME STATUS ROLES AGE VERSION INTERNAL-IP EXTERNAL-IP OS-IMAGE KERNEL-VERSION CONTAINER-RUNTIME doris-01 Ready control-plane,etcd,master 127m v1.29.4+k3s1 192.168.1.107 \u0026lt;none\u0026gt; CentOS Linux 7 (Core) 3.10.0-1160.71.1.el7.x86_64 docker://25.0.4 åˆ›å»ºä¸€ä¸ªè¿œç¨‹æœåŠ¡çš„é›†ç¾¤ è¿æ¥è¿œç¨‹èŠ‚ç‚¹ï¼Œéœ€è¦å…ˆé…ç½® ssh\nä¿®æ”¹sshdé…ç½®ï¼š\nsed -i \u0026#39;/PasswordAuthentication/s/^/#/\u0026#39; /etc/ssh/sshd_config sed -i \u0026#39;s/^[ ]*StrictHostKeyChecking.*/StrictHostKeyChecking no/g\u0026#39; /etc/ssh/ssh_config #ç¦ç”¨sshdæœåŠ¡çš„UseDNSã€GSSAPIAuthenticationä¸¤é¡¹ç‰¹æ€§ sed -i -e \u0026#39;s/^#UseDNS.*$/UseDNS no/\u0026#39; /etc/ssh/sshd_config sed -i -e \u0026#39;s/^GSSAPIAuthentication.*$/GSSAPIAuthentication no/\u0026#39; /etc/ssh/sshd_config systemctl restart sshd ç”Ÿæˆsshç§é’¥ï¼š\n[ ! -d ~/.ssh ] \u0026amp;\u0026amp; ( mkdir ~/.ssh ) [ ! -f ~/.ssh/id_rsa.pub ] \u0026amp;\u0026amp; (yes|ssh-keygen -f ~/.ssh/id_rsa -t rsa -N \u0026#34;\u0026#34;) ( chmod 600 ~/.ssh/id_rsa.pub ) \u0026amp;\u0026amp; cat ~/.ssh/id_rsa.pub \u0026gt;\u0026gt; ~/.ssh/authorized_keys é…ç½®æ— å¯†ç ç™»é™†ï¼š192.168.1.107 æ˜¯å½“å‰æœåŠ¡å™¨çš„ IP\nssh-copy-id 192.168.1.107 å¦‚æœssh-agentæ²¡å¯åŠ¨ï¼Œåˆ™å¯åŠ¨ï¼š\neval `ssh-agent` ssh-add ~/.ssh/id_rsa åœ¨ 192.168.1.107 èŠ‚ç‚¹ä¸Šåˆ›å»ºé›†ç¾¤ï¼š\nexport USER=root export SERVER_IP=192.168.1.107 k3sup install \\ --ip $SERVER_IP \\ --user $USER \\ --k3s-extra-args \u0026#39;--docker\u0026#39; æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š\n$ k3sup ready --context default --kubeconfig ./kubeconfig $ kubectl get nodes --kubeconfig ./kubeconfig æˆ–è€…æŒ‡å®šä¸€ä¸ª context å¹¶åˆå¹¶åˆ°é»˜è®¤çš„ KUBECONFIG æ–‡ä»¶ï¼š\nk3sup install \\ --ip $SERVER_IP \\ --user $USER \\ --k3s-extra-args \u0026#39;--docker\u0026#39; --context pik3s \\ --merge \\ --local-path $HOME/.kube/config æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š\n# $HOME/.kube/config is a default for kubeconfig k3sup ready --context pik3s ä½¿ç”¨åµŒå…¥å¼ etcd åˆ›å»ºä¸€ä¸ª HA é›†ç¾¤ æ·»åŠ  --cluster åˆ›å»ºä¸€ä¸ªé›†ç¾¤ï¼š\nexport USER=root export SERVER_IP=192.168.1.107 k3sup install \\ --cluster \\ --ip $SERVER_IP \\ --user $USER \\ --k3s-extra-args \u0026#39;--docker\u0026#39; æ·»åŠ å¦ä¸€ä¸ªserver èŠ‚ç‚¹ï¼ˆ192.168.1.109ï¼‰ï¼Œå…ˆé…ç½®æ— å¯†ç ç™»å½•ï¼š\nssh-copy-id 192.168.1.109 ç„¶åï¼Œæ·»åŠ  --serverï¼š\nexport USER=root export SERVER_IP=192.168.1.107 export NEXT_SERVER_IP=192.168.1.109 k3sup join \\ --ip $NEXT_SERVER_IP \\ --user $USER \\ --server-ip $SERVER_IP \\ --server-user $USER \\ --server \\ --k3s-extra-args \u0026#39;--docker\u0026#39; å†æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ï¼š\n$ k3sup ready --context default --kubeconfig ./kubeconfig $ kubectl get nodes --kubeconfig ./kubeconfig NAME STATUS ROLES AGE VERSION doris-01 Ready control-plane,etcd,master 166m v1.29.4+k3s1 doris-03 Ready \u0026lt;none\u0026gt; 2m18s v1.29.4+k3s1 æ·»åŠ ä¸€ä¸ª Agent èŠ‚ç‚¹åˆ°é›†ç¾¤ æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆ192.168.1.109ï¼‰åˆ°é›†ç¾¤ï¼Œå…ˆé…ç½®æ— å¯†ç ç™»å½•ï¼š\nssh-copy-id 192.168.1.109 ç„¶å\nexport USER=root export SERVER_IP=192.168.1.107 export AGENT_IP=192.168.1.109 k3sup join \\ --ip $AGENT_IP \\ --user $USER \\ --server-ip $SERVER_IP \\ --server-user $USER \\ --k3s-extra-args \u0026#39;--docker\u0026#39; ","permalink":"https://blog.chensoul.cc/posts/2024/05/09/install-k3s-using-k3sup/","summary":"k3supæ˜¯ä¸€ä¸ªæ”¯æŒåœ¨PCã€è™šæ‹Ÿæœºã€ARMè®¾å¤‡ä¸Šå®‰è£…k3sçš„å·¥å…·ï¼Œå®˜æ–¹ç½‘ç«™ï¼šhttps://k3sup.dev/\nå®‰è£…k3sup åœ¨çº¿å®‰è£…ï¼š\ncurl -sLS https://get.k3sup.dev | sh sudo install k3sup /usr/local/bin/ ç¦»çº¿å®‰è£…ï¼Œä¸‹è½½åœ°å€ï¼šhttps://github.com/alexellis/k3sup/releases\nwget https://github.com/alexellis/k3sup/releases/download/0.13.5/k3sup mv k3sup /usr/local/bin/ chmod +x /usr/local/bin/k3sup æŸ¥çœ‹ç‰ˆæœ¬ï¼š\n$ k3sup version _ _____ | | _|___ / ___ _ _ _ __ | |/ / |_ \\/ __| | | | \u0026#39;_ \\ | \u0026lt; ___) \\__ \\ |_| | |_) | |_|\\_\\____/|___/\\__,_| .__/ |_| bootstrap K3s over SSH in \u0026lt; 60s ğŸš€ ğŸš€ Speed up GitHub Actions/GitLab CI + reduce costs: https://actuated.dev Version: 0.13.5 Git Commit: d952d6df22b06147806ca1030b8ba3a4bb9e0c0c åˆ›å»ºk3sé›†ç¾¤ åˆ›å»ºä¸€ä¸ªæœ¬åœ°é›†ç¾¤ k3sup install \\ --local \\ --context localk3s \\ --k3s-channel stable \\ --k3s-extra-args \u0026#39;--docker\u0026#39; æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š\n$ k3sup ready --context localk3s --kubeconfig .","title":"é€šè¿‡k3supå®‰è£…k3s"},{"content":"K3s æ˜¯è½»é‡çº§çš„ Kubernetesã€‚K3s æ˜“äºå®‰è£…ï¼Œä»…éœ€è¦ Kubernetes å†…å­˜çš„ä¸€åŠï¼Œæ‰€æœ‰ç»„ä»¶éƒ½åœ¨ä¸€ä¸ªå°äº 100 MB çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ã€‚\nk3s æ–‡æ¡£ï¼šhttps://docs.rancher.cn/docs/k3s/_index\nK3sä»‹ç» ä»€ä¹ˆæ˜¯ K3sï¼Ÿ K3s æ˜¯ä¸€ä¸ªå®Œå…¨å…¼å®¹çš„ Kubernetes å‘è¡Œç‰ˆï¼Œå…·æœ‰ä»¥ä¸‹å¢å¼ºåŠŸèƒ½ï¼š\næ‰“åŒ…ä¸ºå•ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ã€‚ ä½¿ç”¨åŸºäº sqlite3 ä½œä¸ºé»˜è®¤å­˜å‚¨æœºåˆ¶çš„è½»é‡çº§å­˜å‚¨åç«¯ã€‚åŒæ—¶æ”¯æŒä½¿ç”¨ etcd3ã€MySQL å’Œ Postgresã€‚ å°è£…åœ¨ç®€å•çš„å¯åŠ¨ç¨‹åºä¸­ï¼Œå¯ä»¥å¤„ç†å¾ˆå¤šå¤æ‚çš„ TLS å’Œé€‰é¡¹ã€‚ é»˜è®¤æƒ…å†µä¸‹æ˜¯å®‰å…¨çš„ï¼Œå¯¹è½»é‡çº§ç¯å¢ƒæœ‰åˆç†çš„é»˜è®¤å€¼ã€‚ æ·»åŠ äº†ç®€å•ä½†å¼ºå¤§çš„ batteries-included åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š æœ¬åœ°å­˜å‚¨æä¾›ç¨‹åº service load balancer Helm controller Traefik ingress controller æ‰€æœ‰ Kubernetes control plane ç»„ä»¶çš„æ“ä½œéƒ½å°è£…åœ¨å•ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶å’Œè¿›ç¨‹ä¸­ã€‚å› æ­¤ï¼ŒK3s æ”¯æŒè‡ªåŠ¨åŒ–å’Œç®¡ç†å¤æ‚çš„é›†ç¾¤æ“ä½œï¼ˆä¾‹å¦‚è¯ä¹¦åˆ†å‘ç­‰ï¼‰ã€‚ æœ€å¤§ç¨‹åº¦å‡è½»äº†å¤–éƒ¨ä¾èµ–æ€§ï¼ŒK3s ä»…éœ€è¦ç°ä»£å†…æ ¸å’Œ cgroup æŒ‚è½½ã€‚K3s æ‰“åŒ…äº†æ‰€éœ€çš„ä¾èµ–ï¼ŒåŒ…æ‹¬ï¼š containerd Flannel (CNI) CoreDNS Traefik (Ingress) Klipper-lb (Service LB) åµŒå…¥å¼ç½‘ç»œç­–ç•¥æ§åˆ¶å™¨ åµŒå…¥å¼ local-path-provisioner ä¸»æœºå®ç”¨ç¨‹åºï¼ˆiptablesã€socat ç­‰ï¼‰ ä¸ºä»€ä¹ˆå« K3s? æˆ‘ä»¬å¸Œæœ›å®‰è£…çš„ Kubernetes åªå ç”¨ä¸€åŠçš„å†…å­˜ã€‚Kubernetes æ˜¯ä¸€ä¸ª 10 ä¸ªå­—æ¯çš„å•è¯ï¼Œç®€å†™ä¸º K8sã€‚Kubernetes çš„ä¸€åŠå°±æ˜¯ä¸€ä¸ª 5 ä¸ªå­—æ¯çš„å•è¯ï¼Œå› æ­¤ç®€å†™ä¸º K3sã€‚K3s æ²¡æœ‰å…¨ç§°ï¼Œä¹Ÿæ²¡æœ‰å®˜æ–¹çš„å‘éŸ³ã€‚\né€‚ç”¨åœºæ™¯ K3s é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š\nè¾¹ç¼˜è®¡ç®—-Edge ç‰©è”ç½‘-IoT CI Development ARM åµŒå…¥ K8s ç”±äºè¿è¡Œ K3s æ‰€éœ€çš„èµ„æºç›¸å¯¹è¾ƒå°‘ï¼Œæ‰€ä»¥ K3s ä¹Ÿé€‚ç”¨äºå¼€å‘å’Œæµ‹è¯•åœºæ™¯ã€‚åœ¨è¿™äº›åœºæ™¯ä¸­ï¼Œå¦‚æœå¼€å‘æˆ–æµ‹è¯•äººå‘˜éœ€è¦å¯¹æŸäº›åŠŸèƒ½è¿›è¡ŒéªŒè¯ï¼Œæˆ–å¯¹æŸäº›é—®é¢˜è¿›è¡Œé‡ç°ï¼Œé‚£ä¹ˆä½¿ç”¨ K3s ä¸ä»…èƒ½å¤Ÿç¼©çŸ­å¯åŠ¨é›†ç¾¤çš„æ—¶é—´ï¼Œè¿˜èƒ½å¤Ÿå‡å°‘é›†ç¾¤éœ€è¦æ¶ˆè€—çš„èµ„æºã€‚ä¸æ­¤åŒæ—¶ï¼ŒRancher ä¸­å›½å›¢é˜Ÿæ¨å‡ºäº†ä¸€æ¬¾é’ˆå¯¹ K3s çš„æ•ˆç‡æå‡å·¥å…·ï¼šAutoK3sã€‚åªéœ€è¦è¾“å…¥ä¸€è¡Œå‘½ä»¤ï¼Œå³å¯å¿«é€Ÿåˆ›å»º K3s é›†ç¾¤å¹¶æ·»åŠ æŒ‡å®šæ•°é‡çš„ master èŠ‚ç‚¹å’Œ worker èŠ‚ç‚¹ã€‚å¦‚éœ€è¯¦ç»†äº†è§£ AutoK3sï¼Œè¯·å‚è€ƒAutoK3s åŠŸèƒ½ä»‹ç»ã€‚\nå®‰è£…Docker ä½¿ç”¨ docker å®˜æ–¹å®‰è£…è„šæœ¬ï¼š\n$ curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun $ usermod -aG docker `whoami` å¦ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨ Rancher çš„ Docker å®‰è£…è„šæœ¬ï¼Œè¯¥è„šæœ¬å¯ç”¨äºè¾ƒæ–°çš„ Docker ç‰ˆæœ¬ã€‚\ncurl https://releases.rancher.com/install-docker/\u0026lt;version-number\u0026gt;.sh | sh version-number å¯ä»¥åœ¨æŸ¥çœ‹ï¼šhttps://github.com/rancher/install-docker/blob/master/dist/ ï¼Œæ¯”å¦‚ï¼š\ncurl https://releases.rancher.com/install-docker/25.0.sh | sh è¯·æ³¨æ„ï¼Œå¿…é¡»åº”ç”¨ä»¥ä¸‹ /etc/sysctl.conf è®¾ç½®ï¼š\nnet.bridge.bridge-nf-call-iptables=1 å¯åŠ¨ docker\n$ systemctl enable docker \u0026amp;\u0026amp; systemctl start docker åœ¨çº¿å®‰è£… K3s æä¾›äº†ä¸€ä¸ªå®‰è£…è„šæœ¬ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å°†å…¶ä½œä¸ºæœåŠ¡å®‰è£…åœ¨åŸºäº systemd æˆ– openrc çš„ç³»ç»Ÿä¸Šã€‚è¯¥è„šæœ¬å¯åœ¨ https://get.k3s.io è·å¾—ã€‚è¦ä½¿ç”¨è¿™ç§æ–¹æ³•å®‰è£… K3sï¼Œåªéœ€è¿è¡Œï¼š\n$ curl -sfL https://get.k3s.io | sh - --docker å¤‡æ³¨ï¼š\nä¸­å›½ç”¨æˆ·ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•åŠ é€Ÿå®‰è£…ï¼š\ncurl -sfL https://rancher-mirror.rancher.cn/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn sh - è¿è¡Œæ­¤å®‰è£…åï¼š\nK3s æœåŠ¡å°†è¢«é…ç½®ä¸ºåœ¨èŠ‚ç‚¹é‡å¯åæˆ–è¿›ç¨‹å´©æºƒæˆ–è¢«æ€æ­»æ—¶è‡ªåŠ¨é‡å¯ã€‚ å°†å®‰è£…å…¶ä»–å®ç”¨ç¨‹åºï¼ŒåŒ…æ‹¬ kubectlã€crictlã€ctrã€k3s-killall.sh å’Œ k3s-uninstall.shã€‚ kubeconfig æ–‡ä»¶å°†å†™å…¥åˆ° /etc/rancher/k3s/k3s.yamlï¼Œç”± K3s å®‰è£…çš„ kubectl å°†è‡ªåŠ¨ä½¿ç”¨è¯¥æ–‡ä»¶ã€‚ $ curl -sfL https://rancher-mirror.rancher.cn/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn INSTALL_K3S_VERSION=v1.28.7+k3s1 sh -s - --docker --dockerï¼šK3s åŒ…å«å¹¶é»˜è®¤ä¸º containerd ï¼Œä½¿ç”¨ docker ä»£æ›¿ containerd INSTALL_K3S_VERSION=v1.28.7+k3s1ï¼šæŒ‡å®šç‰ˆæœ¬ï¼Œrancher éœ€è¦ k3s ç‰ˆæœ¬å°äº 1.29.0ã€‚ ç¨ç­‰ç‰‡åˆ»ï¼ŒæŸ¥çœ‹ docker å®¹å™¨ï¼š\n$ sudo docker ps æŸ¥çœ‹å®‰è£…k3så¯ä»¥é…ç½®çš„å‚æ•°ï¼š\n$ k3s server -h å½“k3så®‰è£…æˆåŠŸä¹‹åï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¿®æ”¹ /etc/systemd/system/k3s.service ä¸­çš„å¯åŠ¨å‚æ•°\n[Unit] Description=Lightweight Kubernetes Documentation=https://k3s.io Wants=network-online.target [Install] WantedBy=multi-user.target [Service] Type=notify EnvironmentFile=/etc/systemd/system/k3s.service.env KillMode=process Delegate=yes LimitNOFILE=infinity LimitNPROC=infinity LimitCORE=infinity TasksMax=infinity TimeoutStartSec=0 Restart=always RestartSec=5s ExecStartPre=-/sbin/modprobe br_netfilter ExecStartPre=-/sbin/modprobe overlay ExecStart=/usr/local/bin/k3s \\ server \\ \u0026#39;--docker\u0026#39; \\ æ ¹æ®éœ€è¦ï¼Œå¯ä»¥è°ƒæ•´ä¸‹ K3s çš„æœåŠ¡é…ç½®æ–‡ä»¶ï¼Œä»¥å°† K3s çš„é»˜è®¤å®¹å™¨å¼•æ“ä» Containerd åˆ‡æ¢åˆ° Dockerï¼Œæˆ–è€…ä¸éƒ¨ç½² traefik\nExecStart=/usr/local/bin/k3s server --docker --no-deploy traefik ä¹‹åä¿å­˜é€€å‡ºï¼Œæ‰§è¡Œå‘½ä»¤é‡æ–°åŠ è½½æ–°çš„æœåŠ¡é…ç½®æ–‡ä»¶ï¼š\nsystemctl daemon-reload systemctl restart k3s é›†ç¾¤è®¿é—® /etc/rancher/k3s/k3s.yaml ä¸­å­˜å‚¨çš„ kubeconfig æ–‡ä»¶ç”¨äºé…ç½®å¯¹ Kubernetes é›†ç¾¤çš„è®¿é—®ã€‚å¦‚æœä½ å·²ç»å®‰è£…äº†ä¸Šæ¸¸çš„ Kubernetes å‘½ä»¤è¡Œå·¥å…·ï¼ˆå¦‚ kubectl æˆ– helm)ï¼Œä½ éœ€è¦ç”¨æ­£ç¡®çš„ kubeconfig è·¯å¾„é…ç½®å®ƒä»¬ã€‚è¿™å¯ä»¥é€šè¿‡å¯¼å‡º KUBECONFIG ç¯å¢ƒå˜é‡æˆ–è°ƒç”¨ --kubeconfig å‘½ä»¤è¡Œæ ‡å¿—æ¥å®Œæˆã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ä»¥ä¸‹ç¤ºä¾‹ã€‚\nä½¿ç”¨ KUBECONFIG ç¯å¢ƒå˜é‡ï¼š\nexport KUBECONFIG=/etc/rancher/k3s/k3s.yaml kubectl get pods --all-namespaces helm ls --all-namespaces æˆ–è€…åœ¨å‘½ä»¤ä¸­æŒ‡å®š kubeconfig æ–‡ä»¶çš„ä½ç½®ï¼š\nkubectl --kubeconfig /etc/rancher/k3s/k3s.yaml get pods --all-namespaces helm --kubeconfig /etc/rancher/k3s/k3s.yaml ls --all-namespaces ä½¿ç”¨ kubectl ä»å¤–éƒ¨è®¿é—®é›†ç¾¤ å°† /etc/rancher/k3s/k3s.yaml å¤åˆ¶åˆ°ä½äºé›†ç¾¤å¤–éƒ¨çš„ä¸»æœºä¸Šçš„ ~/.kube/configã€‚ç„¶åï¼Œå°† server å­—æ®µçš„å€¼æ›¿æ¢ä¸ºä½  K3s Server çš„ IP æˆ–åç§°ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥ä½¿ç”¨ kubectl æ¥ç®¡ç† K3s é›†ç¾¤ã€‚\ncp /etc/rancher/k3s/k3s.yaml $HOME/.kube/config æ£€æŸ¥çŠ¶æ€ æŸ¥çœ‹kubectlæ˜¯å¦å®‰è£…ï¼š\n$ which kubectl $ kubectl version Client Version: v1.29.3 Kustomize Version: v5.0.4-0.20230601165947-6ce0bf390ce3 Server Version: v1.29.4+k3s1 æŸ¥çœ‹k3sç‰ˆæœ¬å’ŒæœåŠ¡è¿è¡ŒçŠ¶æ€ï¼š\n$ k3s --version k3s version v1.29.4+k3s1 (94e29e2e) go version go1.21.9 $ systemctl status k3s æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ï¼š\n$ kubectl get nodes NAME STATUS ROLES AGE VERSION doris-01 Ready control-plane,master 91m v1.29.4+k3s1 $ kubectl get node -o wide NAME STATUS ROLES AGE VERSION INTERNAL-IP EXTERNAL-IP OS-IMAGE KERNEL-VERSION CONTAINER-RUNTIME doris-01 Ready control-plane,master 92m v1.29.4+k3s1 192.168.1.107 \u0026lt;none\u0026gt; CentOS Linux 7 (Core) 3.10.0-1160.71.1.el7.x86_64 containerd://1.7.15-k3s1 æŸ¥çœ‹å‘½åç©ºé—´ï¼š\n$ kubectl get ns NAME STATUS AGE kube-system Active 92m kube-public Active 92m kube-node-lease Active 92m default Active 92m æŸ¥çœ‹è¿è¡ŒçŠ¶æ€ï¼š\n$ kubectl get all -n kube-system NAME READY STATUS RESTARTS AGE pod/coredns-6799fbcd5-gjl6m 1/1 Running 0 92m pod/local-path-provisioner-6c86858495-l29k2 1/1 Running 0 92m pod/helm-install-traefik-crd-4gsfn 0/1 Completed 0 92m pod/helm-install-traefik-6j2ch 0/1 Completed 1 92m pod/metrics-server-54fd9b65b-98rld 1/1 Running 0 92m pod/svclb-traefik-231ab742-j2qfs 2/2 Running 0 91m pod/traefik-7d5f6474df-s6srn 1/1 Running 0 91m NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE service/kube-dns ClusterIP 10.43.0.10 \u0026lt;none\u0026gt; 53/UDP,53/TCP,9153/TCP 92m service/metrics-server ClusterIP 10.43.120.4 \u0026lt;none\u0026gt; 443/TCP 92m service/traefik LoadBalancer 10.43.104.97 192.168.1.107 80:30484/TCP,443:32566/TCP 91m NAME DESIRED CURRENT READY UP-TO-DATE AVAILABLE NODE SELECTOR AGE daemonset.apps/svclb-traefik-231ab742 1 1 1 1 1 \u0026lt;none\u0026gt; 91m NAME READY UP-TO-DATE AVAILABLE AGE deployment.apps/coredns 1/1 1 1 92m deployment.apps/local-path-provisioner 1/1 1 1 92m deployment.apps/metrics-server 1/1 1 1 92m deployment.apps/traefik 1/1 1 1 91m NAME DESIRED CURRENT READY AGE replicaset.apps/coredns-6799fbcd5 1 1 1 92m replicaset.apps/local-path-provisioner-6c86858495 1 1 1 92m replicaset.apps/metrics-server-54fd9b65b 1 1 1 92m replicaset.apps/traefik-7d5f6474df 1 1 1 91m NAME COMPLETIONS DURATION AGE job.batch/helm-install-traefik-crd 1/1 32s 92m job.batch/helm-install-traefik 1/1 34s 92m å¯ä»¥çœ‹åˆ° service/traefik ç±»å‹ä¸º LoadBalancerï¼ŒEXTERNAL-IP ä¸º 192.168.1.107 ã€‚ é…ç½®é›†ç¾¤ æ·»åŠ  worker èŠ‚ç‚¹ åœ¨masterèŠ‚ç‚¹æŸ¥çœ‹_K3S_TOKEN_ï¼š\n$ cat /var/lib/rancher/k3s/server/node-token K1069e97c40ac7433f5e4ca318e3945d2684fcc58813588305743a9bc17582f160e::server:ca28a1e542ce5030bcf6031d0c4c8ef4 åœ¨workerèŠ‚ç‚¹å®‰è£…ï¼Œè¿™é‡Œä½¿ç”¨ 192.168.1.109 èŠ‚ç‚¹å®‰è£…ï¼š\næ³¨æ„ï¼š192.168.1.109 èŠ‚ç‚¹ éœ€è¦å…ˆå®‰è£…å¥½ dockerã€‚\nk3s_url=\u0026#34;https://192.168.1.107:6443\u0026#34; k3s_token=\u0026#34;K1069e97c40ac7433f5e4ca318e3945d2684fcc58813588305743a9bc17582f160e::server:ca28a1e542ce5030bcf6031d0c4c8ef4\u0026#34; curl -sfL https://rancher-mirror.rancher.cn/k3s/k3s-install.sh | INSTALL_K3S_MIRROR=cn K3S_URL=${k3s_url} K3S_TOKEN=${k3s_token} sh -s - --docker åœ¨ master èŠ‚ç‚¹ï¼ˆ192.168.1.107ï¼‰æŸ¥çœ‹èŠ‚ç‚¹ï¼š\n$ kubectl get nodes NAME STATUS ROLES AGE VERSION doris-01 Ready control-plane,master 50m v1.29.4+k3s1 doris-03 Ready \u0026lt;none\u0026gt; 67s v1.29.4+k3s1 å¸è½½ å¸è½½ k3sï¼š\n/usr/local/bin/k3s-uninstall.sh /usr/local/bin/k3s-agent-uninstall.sh æ¸…ç† docker å®¹å™¨ï¼š\ndocker rm -f $(docker ps -aq) ","permalink":"https://blog.chensoul.cc/posts/2024/05/09/install-k3s/","summary":"K3s æ˜¯è½»é‡çº§çš„ Kubernetesã€‚K3s æ˜“äºå®‰è£…ï¼Œä»…éœ€è¦ Kubernetes å†…å­˜çš„ä¸€åŠï¼Œæ‰€æœ‰ç»„ä»¶éƒ½åœ¨ä¸€ä¸ªå°äº 100 MB çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ã€‚\nk3s æ–‡æ¡£ï¼šhttps://docs.rancher.cn/docs/k3s/_index\nK3sä»‹ç» ä»€ä¹ˆæ˜¯ K3sï¼Ÿ K3s æ˜¯ä¸€ä¸ªå®Œå…¨å…¼å®¹çš„ Kubernetes å‘è¡Œç‰ˆï¼Œå…·æœ‰ä»¥ä¸‹å¢å¼ºåŠŸèƒ½ï¼š\næ‰“åŒ…ä¸ºå•ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ã€‚ ä½¿ç”¨åŸºäº sqlite3 ä½œä¸ºé»˜è®¤å­˜å‚¨æœºåˆ¶çš„è½»é‡çº§å­˜å‚¨åç«¯ã€‚åŒæ—¶æ”¯æŒä½¿ç”¨ etcd3ã€MySQL å’Œ Postgresã€‚ å°è£…åœ¨ç®€å•çš„å¯åŠ¨ç¨‹åºä¸­ï¼Œå¯ä»¥å¤„ç†å¾ˆå¤šå¤æ‚çš„ TLS å’Œé€‰é¡¹ã€‚ é»˜è®¤æƒ…å†µä¸‹æ˜¯å®‰å…¨çš„ï¼Œå¯¹è½»é‡çº§ç¯å¢ƒæœ‰åˆç†çš„é»˜è®¤å€¼ã€‚ æ·»åŠ äº†ç®€å•ä½†å¼ºå¤§çš„ batteries-included åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š æœ¬åœ°å­˜å‚¨æä¾›ç¨‹åº service load balancer Helm controller Traefik ingress controller æ‰€æœ‰ Kubernetes control plane ç»„ä»¶çš„æ“ä½œéƒ½å°è£…åœ¨å•ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶å’Œè¿›ç¨‹ä¸­ã€‚å› æ­¤ï¼ŒK3s æ”¯æŒè‡ªåŠ¨åŒ–å’Œç®¡ç†å¤æ‚çš„é›†ç¾¤æ“ä½œï¼ˆä¾‹å¦‚è¯ä¹¦åˆ†å‘ç­‰ï¼‰ã€‚ æœ€å¤§ç¨‹åº¦å‡è½»äº†å¤–éƒ¨ä¾èµ–æ€§ï¼ŒK3s ä»…éœ€è¦ç°ä»£å†…æ ¸å’Œ cgroup æŒ‚è½½ã€‚K3s æ‰“åŒ…äº†æ‰€éœ€çš„ä¾èµ–ï¼ŒåŒ…æ‹¬ï¼š containerd Flannel (CNI) CoreDNS Traefik (Ingress) Klipper-lb (Service LB) åµŒå…¥å¼ç½‘ç»œç­–ç•¥æ§åˆ¶å™¨ åµŒå…¥å¼ local-path-provisioner ä¸»æœºå®ç”¨ç¨‹åºï¼ˆiptablesã€socat ç­‰ï¼‰ ä¸ºä»€ä¹ˆå« K3s? æˆ‘ä»¬å¸Œæœ›å®‰è£…çš„ Kubernetes åªå ç”¨ä¸€åŠçš„å†…å­˜ã€‚Kubernetes æ˜¯ä¸€ä¸ª 10 ä¸ªå­—æ¯çš„å•è¯ï¼Œç®€å†™ä¸º K8sã€‚Kubernetes çš„ä¸€åŠå°±æ˜¯ä¸€ä¸ª 5 ä¸ªå­—æ¯çš„å•è¯ï¼Œå› æ­¤ç®€å†™ä¸º K3sã€‚K3s æ²¡æœ‰å…¨ç§°ï¼Œä¹Ÿæ²¡æœ‰å®˜æ–¹çš„å‘éŸ³ã€‚\né€‚ç”¨åœºæ™¯ K3s é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š\nè¾¹ç¼˜è®¡ç®—-Edge ç‰©è”ç½‘-IoT CI Development ARM åµŒå…¥ K8s ç”±äºè¿è¡Œ K3s æ‰€éœ€çš„èµ„æºç›¸å¯¹è¾ƒå°‘ï¼Œæ‰€ä»¥ K3s ä¹Ÿé€‚ç”¨äºå¼€å‘å’Œæµ‹è¯•åœºæ™¯ã€‚åœ¨è¿™äº›åœºæ™¯ä¸­ï¼Œå¦‚æœå¼€å‘æˆ–æµ‹è¯•äººå‘˜éœ€è¦å¯¹æŸäº›åŠŸèƒ½è¿›è¡ŒéªŒè¯ï¼Œæˆ–å¯¹æŸäº›é—®é¢˜è¿›è¡Œé‡ç°ï¼Œé‚£ä¹ˆä½¿ç”¨ K3s ä¸ä»…èƒ½å¤Ÿç¼©çŸ­å¯åŠ¨é›†ç¾¤çš„æ—¶é—´ï¼Œè¿˜èƒ½å¤Ÿå‡å°‘é›†ç¾¤éœ€è¦æ¶ˆè€—çš„èµ„æºã€‚ä¸æ­¤åŒæ—¶ï¼ŒRancher ä¸­å›½å›¢é˜Ÿæ¨å‡ºäº†ä¸€æ¬¾é’ˆå¯¹ K3s çš„æ•ˆç‡æå‡å·¥å…·ï¼šAutoK3sã€‚åªéœ€è¦è¾“å…¥ä¸€è¡Œå‘½ä»¤ï¼Œå³å¯å¿«é€Ÿåˆ›å»º K3s é›†ç¾¤å¹¶æ·»åŠ æŒ‡å®šæ•°é‡çš„ master èŠ‚ç‚¹å’Œ worker èŠ‚ç‚¹ã€‚å¦‚éœ€è¯¦ç»†äº†è§£ AutoK3sï¼Œè¯·å‚è€ƒAutoK3s åŠŸèƒ½ä»‹ç»ã€‚","title":"å®‰è£…k3s"},{"content":"k3dæ˜¯ä»€ä¹ˆ k3d æ˜¯ä¸€ä¸ªè½»é‡çº§åŒ…è£…å™¨ï¼Œç”¨äºåœ¨ docker ä¸­è¿è¡Œk3sï¼ˆRancher Lab çš„æœ€å° Kubernetes å‘è¡Œç‰ˆï¼‰ã€‚\nk3d ä½¿å¾—åœ¨ docker ä¸­åˆ›å»ºå•èŠ‚ç‚¹å’Œå¤šèŠ‚ç‚¹k3sé›†ç¾¤å˜å¾—éå¸¸å®¹æ˜“ï¼Œä¾‹å¦‚ç”¨äº Kubernetes ä¸Šçš„æœ¬åœ°å¼€å‘ã€‚\næ³¨æ„ï¼š k3d æ˜¯ä¸€ä¸ªç¤¾åŒºé©±åŠ¨çš„é¡¹ç›®ï¼Œä½†å®ƒä¸æ˜¯å®˜æ–¹ Rancher (SUSE) äº§å“ã€‚\nk3då®‰è£… é€šè¿‡è„šæœ¬å®‰è£…ï¼š\nwget -q -O - https://raw.githubusercontent.com/k3d-io/k3d/main/install.sh | bash macos ä¸Šé€šè¿‡homebrewå®‰è£…ï¼š\nbrew install k3d æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£ï¼š\n$ k3d -h https://k3d.io/ k3d is a wrapper CLI that helps you to easily create k3s clusters inside docker. Nodes of a k3d cluster are docker containers running a k3s image. All Nodes of a k3d cluster are part of the same docker network. Usage: k3d [flags] k3d [command] Available Commands: cluster Manage cluster(s) completion Generate completion scripts for [bash, zsh, fish, powershell | psh] config Work with config file(s) help Help about any command image Handle container images. kubeconfig Manage kubeconfig(s) node Manage node(s) registry Manage registry/registries version Show k3d and default k3s version Flags: -h, --help help for k3d --timestamps Enable Log timestamps --trace Enable super verbose output (trace logging) --verbose Enable verbose output (debug logging) --version Show k3d and default k3s version Use \u0026#34;k3d [command] --help\u0026#34; for more information about a command. æŸ¥çœ‹ç‰ˆæœ¬ï¼š\n$ k3d --version k3d version v5.6.3 k3s version v1.28.8-k3s1 (default) åˆ›å»ºk3sé›†ç¾¤ å¿«é€Ÿåˆ›å»ºä¸€ä¸ªé›†ç¾¤ï¼š\n$ k3d cluster create mycluster INFO[0000] Prep: Network INFO[0000] Created network \u0026#39;k3d-mycluster\u0026#39; INFO[0000] Created image volume k3d-mycluster-images INFO[0000] Starting new tools node... INFO[0001] Creating node \u0026#39;k3d-mycluster-server-0\u0026#39; INFO[0005] Pulling image \u0026#39;ghcr.io/k3d-io/k3d-tools:5.6.3\u0026#39; INFO[0005] Pulling image \u0026#39;docker.io/rancher/k3s:v1.28.8-k3s1\u0026#39; INFO[0009] Starting node \u0026#39;k3d-mycluster-tools\u0026#39; INFO[0017] Creating LoadBalancer \u0026#39;k3d-mycluster-serverlb\u0026#39; INFO[0021] Pulling image \u0026#39;ghcr.io/k3d-io/k3d-proxy:5.6.3\u0026#39; INFO[0031] Using the k3d-tools node to gather environment information INFO[0031] HostIP: using network gateway 192.168.237.1 address INFO[0031] Starting cluster \u0026#39;mycluster\u0026#39; INFO[0031] Starting servers... INFO[0031] Starting node \u0026#39;k3d-mycluster-server-0\u0026#39; INFO[0034] All agents already running. INFO[0034] Starting helpers... INFO[0035] Starting node \u0026#39;k3d-mycluster-serverlb\u0026#39; INFO[0041] Injecting records for hostAliases (incl. host.k3d.internal) and for 2 network members into CoreDNS configmap... INFO[0043] Cluster \u0026#39;mycluster\u0026#39; created successfully! INFO[0043] You can now use it like this: kubectl cluster-info æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹ï¼š\n$ kubectl get nodes NAME STATUS ROLES AGE VERSION k3d-mycluster-server-0 Ready control-plane,master 117s v1.28.8+k3s1 æŸ¥çœ‹åˆ›å»ºçš„é›†ç¾¤ï¼š\n$ k3d cluster list NAME SERVERS AGENTS LOADBALANCER mycluster 1/1 0/0 true åˆ›å»ºå¤šæœåŠ¡å™¨é›†ç¾¤ ä½¿ç”¨ k3s çš„åµŒå…¥å¼ etcd æ•°æ®åº“åˆ›å»ºä¸€ä¸ªå…·æœ‰ 3 ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹çš„é›†ç¾¤ã€‚è¦åˆ›å»ºçš„ç¬¬ä¸€ä¸ªæœåŠ¡å™¨å°†ä½¿ç”¨è¯¥--cluster-initæ ‡å¿—ï¼Œk3d å°†ç­‰å¾…å®ƒå¯åŠ¨å¹¶è¿è¡Œï¼Œç„¶åå†åˆ›å»ºï¼ˆå’Œè¿æ¥ï¼‰å…¶ä»–æœåŠ¡å™¨èŠ‚ç‚¹ã€‚\nk3d cluster create multiserver --servers 3 å°†æœåŠ¡å™¨èŠ‚ç‚¹æ·»åŠ åˆ°æ­£åœ¨è¿è¡Œçš„é›†ç¾¤ï¼š\nk3d node create newserver --cluster multiserver --role server æŸ¥çœ‹èŠ‚ç‚¹ï¼š\n$ kubectl get nodes NAME STATUS ROLES AGE VERSION k3d-multiserver-server-0 Ready control-plane,etcd,master 2m55s v1.28.8+k3s1 k3d-multiserver-server-1 Ready control-plane,etcd,master 2m37s v1.28.8+k3s1 k3d-multiserver-server-2 Ready control-plane,etcd,master 2m22s v1.28.8+k3s1 k3d-n æš´éœ²æœåŠ¡ é€šè¿‡Ingressï¼ˆæ¨èï¼‰ éƒ¨ç½²ä¸€ä¸ªç®€å•çš„ nginx Web æœåŠ¡å™¨éƒ¨ç½²å¹¶ä½¿å…¶å¯é€šè¿‡ ingress è¿›è¡Œè®¿é—®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»ä»¥æŸç§æ–¹å¼åˆ›å»ºé›†ç¾¤ï¼Œä»¥ä¾¿traefikåœ¨ä¸»æœºç³»ç»Ÿä¸Šå…¬å¼€å†…éƒ¨ç«¯å£ 80ï¼ˆå…¥å£æ§åˆ¶å™¨æ­£åœ¨ä¾¦å¬çš„ç«¯å£ï¼‰ã€‚\n1ã€åˆ›å»ºé›†ç¾¤ï¼Œå°†å…¥å£ç«¯å£ 80 æ˜ å°„åˆ° localhost:8081\nk3d cluster create --api-port 6550 -p \u0026#34;8081:80@loadbalancer\u0026#34; --agents 2 å†æ¬¡æŸ¥çœ‹é›†ç¾¤ï¼š\n$ k3d cluster list NAME SERVERS AGENTS LOADBALANCER k3s-default 1/1 2/2 true mycluster 1/1 0/0 true 2ã€åˆ›å»ºnginx deploymentï¼š\nkubectl create deployment nginx --image=nginx 3ã€ä¸ºå…¶åˆ›å»ºClusterIPæœåŠ¡ï¼š\nkubectl create service clusterip nginx --tcp=80:80 4ã€åˆ›å»ºä¸€ä¸ªIngressï¼Œæ³¨æ„ï¼šk3sé»˜è®¤å®‰è£…äº†treafik ingress\ncat \u0026lt;\u0026lt; EOF | kubectl apply -f - # apiVersion: networking.k8s.io/v1beta1 # for k3s \u0026lt; v1.19 apiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: nginx annotations: ingress.kubernetes.io/ssl-redirect: \u0026#34;false\u0026#34; spec: rules: - http: paths: - path: / pathType: Prefix backend: service: name: nginx port: number: 80 EOF æŸ¥çœ‹çŠ¶æ€ï¼š\nNAME READY STATUS RESTARTS AGE pod/nginx-7854ff8877-k4ss2 1/1 Running 0 30s NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE service/kubernetes ClusterIP 10.43.0.1 \u0026lt;none\u0026gt; 443/TCP 69s service/nginx ClusterIP 10.43.187.137 \u0026lt;none\u0026gt; 80/TCP 16s NAME CLASS HOSTS ADDRESS PORTS AGE ingress.networking.k8s.io/nginx traefik * 192.168.148.2,192.168.148.3,192.168.148.4 80 7s 5ã€æœ¬åœ°è®¿é—®ï¼š\ncurl localhost:8081/ é€šè¿‡ NodePort æš´éœ² 1ã€åˆ›å»ºé›†ç¾¤ï¼Œå°†ç«¯å£30080ä»æ˜ å°„agent-0åˆ°localhost:8082\nk3d cluster create mycluster -p \u0026#34;8082:30080@agent:0\u0026#34; --agents 2 æ³¨1ï¼šKubernetesçš„é»˜è®¤NodePortèŒƒå›´æ˜¯30000-32767 æ³¨ 2ï¼šæ‚¨ä¹Ÿå¯ä»¥ä»ä¸€å¼€å§‹å°±å…¬å¼€æ•´ä¸ª NodePort èŒƒå›´ï¼Œä¾‹å¦‚é€šè¿‡k3d cluster create mycluster --agents 3 -p \u0026quot;30000-32767:30000-32767@server:0\u0026quot; 2ã€3æ­¥éª¤å’Œä¸Šé¢ä¸€æ ·\n4ã€åˆ›å»ºService\ncat \u0026lt;\u0026lt; EOF | kubectl apply -f - apiVersion: v1 kind: Service metadata: labels: app: nginx name: nginx spec: ports: - name: 80-80 nodePort: 30080 port: 80 protocol: TCP targetPort: 80 selector: app: nginx type: NodePort EOF 5ã€æœ¬åœ°è®¿é—®ï¼š\ncurl localhost:8082/ ç›¸å…³é¡¹ç›® vscode-k3dï¼šVSCode æ‰©å±•ï¼Œç”¨äºä» VSCode å†…å¤„ç† k3d é›†ç¾¤ k3xï¼šk3d çš„å›¾å½¢æ¥å£ï¼ˆé€‚ç”¨äº Linuxï¼‰ã€‚ AbsaOSS/k3d-actionï¼šå®Œå…¨å¯å®šåˆ¶çš„ GitHub Action ä»¥è¿è¡Œè½»é‡çº§ Kubernetes é›†ç¾¤ã€‚ AutoK3sï¼šä¸€ä¸ªè½»é‡çº§å·¥å…·ï¼Œå¯å¸®åŠ©åœ¨ä»»ä½•åœ°æ–¹è¿è¡Œ K3sï¼ŒåŒ…æ‹¬ k3d æä¾›å•†ã€‚ nolar/setup-k3d-k3sï¼šä¸º GitHub Actions è®¾ç½® K3d/K3sã€‚ ","permalink":"https://blog.chensoul.cc/posts/2024/05/09/install-k3s-using-k3d/","summary":"k3dæ˜¯ä»€ä¹ˆ k3d æ˜¯ä¸€ä¸ªè½»é‡çº§åŒ…è£…å™¨ï¼Œç”¨äºåœ¨ docker ä¸­è¿è¡Œk3sï¼ˆRancher Lab çš„æœ€å° Kubernetes å‘è¡Œç‰ˆï¼‰ã€‚\nk3d ä½¿å¾—åœ¨ docker ä¸­åˆ›å»ºå•èŠ‚ç‚¹å’Œå¤šèŠ‚ç‚¹k3sé›†ç¾¤å˜å¾—éå¸¸å®¹æ˜“ï¼Œä¾‹å¦‚ç”¨äº Kubernetes ä¸Šçš„æœ¬åœ°å¼€å‘ã€‚\næ³¨æ„ï¼š k3d æ˜¯ä¸€ä¸ªç¤¾åŒºé©±åŠ¨çš„é¡¹ç›®ï¼Œä½†å®ƒä¸æ˜¯å®˜æ–¹ Rancher (SUSE) äº§å“ã€‚\nk3då®‰è£… é€šè¿‡è„šæœ¬å®‰è£…ï¼š\nwget -q -O - https://raw.githubusercontent.com/k3d-io/k3d/main/install.sh | bash macos ä¸Šé€šè¿‡homebrewå®‰è£…ï¼š\nbrew install k3d æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£ï¼š\n$ k3d -h https://k3d.io/ k3d is a wrapper CLI that helps you to easily create k3s clusters inside docker. Nodes of a k3d cluster are docker containers running a k3s image. All Nodes of a k3d cluster are part of the same docker network. Usage: k3d [flags] k3d [command] Available Commands: cluster Manage cluster(s) completion Generate completion scripts for [bash, zsh, fish, powershell | psh] config Work with config file(s) help Help about any command image Handle container images.","title":"é€šè¿‡k3då®‰è£…k3s"},{"content":"VMware æ¨å‡ºäº†ä¸€ä¸ªå®éªŒæ€§çš„é¡¹ç›®Spring Modulithï¼Œä»¥ä¾¿äºé€šè¿‡æ¨¡å—å’Œäº‹ä»¶æ›´å¥½åœ°ç»„ç»‡ Spring Boot 3 åº”ç”¨ã€‚è¯¥é¡¹ç›®å¼•å…¥äº†æ–°çš„ç±»å’Œæ³¨è§£ï¼Œä½†å¹¶ä¸ä¼šç”Ÿæˆä»£ç ã€‚å®ƒçš„æ¨¡å—æ²¡æœ‰ä½¿ç”¨ Java Platform Module Systemï¼ˆJPMSï¼‰ï¼Œè€Œæ˜¯æ˜ å°„åˆ°äº†æ™®é€šçš„ Java åŒ…ã€‚æ¨¡å—æœ‰ APIï¼Œä½†æ˜¯ Spring Modulith é¼“åŠ±ä½¿ç”¨ Spring åº”ç”¨äº‹ä»¶ä½œä¸ºâ€œä¸»è¦çš„äº¤äº’æ–¹å¼â€ã€‚è¿™äº›äº‹ä»¶å¯ä»¥è‡ªåŠ¨æŒä¹…åŒ–åˆ°äº‹ä»¶æ—¥å¿—ä¸­ã€‚Spring Modulith è¿˜ç®€åŒ–äº†æ¨¡å—å’Œäº‹ä»¶çš„æµ‹è¯•ã€‚\n2022 å¹´ 11 æœˆæ¨å‡ºçš„Spring Boot 3ä¼šæ˜¯ Spring Modulith çš„åŸºç¡€ã€‚æ‰€ä»¥å®ƒçš„åŸºçº¿æ˜¯ Spring Framework 6ã€Java 17 å’Œ Jakarta EE 9ã€‚Spring Modulith æ˜¯Modulithsï¼ˆå…¶åå­—æœ‰ä¸ªâ€œsâ€åç¼€ï¼‰é¡¹ç›®çš„ç»§æ‰¿è€…ã€‚è¯¥é¡¹ç›®ä½¿ç”¨ Spring Boot 2.7ï¼Œç›®å‰å·²ç»é€€å½¹ï¼Œåªæ¥æ”¶ç¼ºé™·ä¿®æ­£ï¼Œç›´è‡³ 2023 å¹´ 11 æœˆä»½ã€‚\nhttps://spring.io/blog/2022/10/21/introducing-spring-modulith\nhttps://www.baeldung.com/spring-modulith\nhttps://www.baeldung.com/spring-modulith-event-externalization\nhttps://piotrminkowski.com/2023/10/13/guide-to-modulith-with-spring-boot/\nhttps://springdoc.cn/guide-to-modulith-with-spring-boot/\nhttps://medium.com/andamp/event-sourcing-with-spring-modulith-2b35b0569dbb\nhttps://www.geeksforgeeks.org/what-is-spring-modulith/\nhttps://github.com/xsreality/spring-modulith-with-ddd\nhttps://riteshshergill.medium.com/the-spring-modulith-monolithic-but-manageable-ca1532a1e585\nhttps://www.infoq.com/news/2022/11/spring-modulith-launch/\nhttps://dzone.com/articles/architecture-style-modulith-vs-microservices\nhttps://speakerdeck.com/olivergierke/spring-modulith-a-deep-dive\nhttps://www.jappware.com/proffesional-activity/make-monolithic-apps-great-again-with-spring-modulith-coffeejug/\nhttps://blog.worldline.tech/2024/01/23/modulith.html\nhttps://springdoc.cn/spring-modulith-intro/\nhttps://dimitri.codes/checking-out-spring-modulith/\nhttps://www.lefer.cn/posts/29752/\nhttps://www.jdon.com/63003.html\nhttps://blog.csdn.net/cfy_banq/article/details/132185951\nhttps://www.zhihu.com/question/567053421\n","permalink":"https://blog.chensoul.cc/posts/2024/05/09/all-things-about-spring-modulith/","summary":"VMware æ¨å‡ºäº†ä¸€ä¸ªå®éªŒæ€§çš„é¡¹ç›®Spring Modulithï¼Œä»¥ä¾¿äºé€šè¿‡æ¨¡å—å’Œäº‹ä»¶æ›´å¥½åœ°ç»„ç»‡ Spring Boot 3 åº”ç”¨ã€‚è¯¥é¡¹ç›®å¼•å…¥äº†æ–°çš„ç±»å’Œæ³¨è§£ï¼Œä½†å¹¶ä¸ä¼šç”Ÿæˆä»£ç ã€‚å®ƒçš„æ¨¡å—æ²¡æœ‰ä½¿ç”¨ Java Platform Module Systemï¼ˆJPMSï¼‰ï¼Œè€Œæ˜¯æ˜ å°„åˆ°äº†æ™®é€šçš„ Java åŒ…ã€‚æ¨¡å—æœ‰ APIï¼Œä½†æ˜¯ Spring Modulith é¼“åŠ±ä½¿ç”¨ Spring åº”ç”¨äº‹ä»¶ä½œä¸ºâ€œä¸»è¦çš„äº¤äº’æ–¹å¼â€ã€‚è¿™äº›äº‹ä»¶å¯ä»¥è‡ªåŠ¨æŒä¹…åŒ–åˆ°äº‹ä»¶æ—¥å¿—ä¸­ã€‚Spring Modulith è¿˜ç®€åŒ–äº†æ¨¡å—å’Œäº‹ä»¶çš„æµ‹è¯•ã€‚\n2022 å¹´ 11 æœˆæ¨å‡ºçš„Spring Boot 3ä¼šæ˜¯ Spring Modulith çš„åŸºç¡€ã€‚æ‰€ä»¥å®ƒçš„åŸºçº¿æ˜¯ Spring Framework 6ã€Java 17 å’Œ Jakarta EE 9ã€‚Spring Modulith æ˜¯Modulithsï¼ˆå…¶åå­—æœ‰ä¸ªâ€œsâ€åç¼€ï¼‰é¡¹ç›®çš„ç»§æ‰¿è€…ã€‚è¯¥é¡¹ç›®ä½¿ç”¨ Spring Boot 2.7ï¼Œç›®å‰å·²ç»é€€å½¹ï¼Œåªæ¥æ”¶ç¼ºé™·ä¿®æ­£ï¼Œç›´è‡³ 2023 å¹´ 11 æœˆä»½ã€‚\nhttps://spring.io/blog/2022/10/21/introducing-spring-modulith\nhttps://www.baeldung.com/spring-modulith\nhttps://www.baeldung.com/spring-modulith-event-externalization\nhttps://piotrminkowski.com/2023/10/13/guide-to-modulith-with-spring-boot/\nhttps://springdoc.cn/guide-to-modulith-with-spring-boot/\nhttps://medium.com/andamp/event-sourcing-with-spring-modulith-2b35b0569dbb\nhttps://www.geeksforgeeks.org/what-is-spring-modulith/\nhttps://github.com/xsreality/spring-modulith-with-ddd\nhttps://riteshshergill.medium.com/the-spring-modulith-monolithic-but-manageable-ca1532a1e585\nhttps://www.infoq.com/news/2022/11/spring-modulith-launch/\nhttps://dzone.com/articles/architecture-style-modulith-vs-microservices\nhttps://speakerdeck.com/olivergierke/spring-modulith-a-deep-dive\nhttps://www.jappware.com/proffesional-activity/make-monolithic-apps-great-again-with-spring-modulith-coffeejug/\nhttps://blog.worldline.tech/2024/01/23/modulith.html\nhttps://springdoc.cn/spring-modulith-intro/\nhttps://dimitri.codes/checking-out-spring-modulith/\nhttps://www.lefer.cn/posts/29752/\nhttps://www.jdon.com/63003.html\nhttps://blog.csdn.net/cfy_banq/article/details/132185951\nhttps://www.zhihu.com/question/567053421","title":"All things about Spring Modulith"},{"content":"åŸæ–‡é“¾æ¥ï¼šhttps://noobj.medium.com/exploring-http2-part-2-with-node-http2-core-and-hapijs-74e3df14249\næ¥æºï¼šhttps://www.thewebmaster.com/\nå…ˆå†³æ¡ä»¶ï¼šäº†è§£ javascriptã€å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„ã€‚\nå®Œæ•´çš„ä»£ç å¯ä»¥åœ¨githubä¸Šæ‰¾åˆ°ã€‚\nç¬¬ 1 éƒ¨åˆ†ï¼šæ¦‚è¿°ï¼ˆhttp2 çš„åŸå› ã€å†…å®¹ã€æ—¶é—´ã€æ–¹å¼ï¼‰ç¬¬ 2 éƒ¨åˆ†ï¼šä½¿ç”¨ node-http2 æ ¸å¿ƒå’Œ hapijs è¿›è¡Œæ¢ç´¢\nå…è´£å£°æ˜ï¼šæœ¬æ–‡å°†ä½¿ç”¨node@v9+é™„å¸¦çš„http2æ¨¡å—ã€‚è¿™é‡Œåˆ—å‡ºäº†å…¶ä»–å‡ ä¸ª http2 å®¢æˆ·ç«¯-æœåŠ¡å™¨åº“å®ç°ã€‚\nè®©æˆ‘ä»¬å¼€å§‹åˆ›å»ºä¸€ä¸ªå…·æœ‰å•ä¸€è·¯ç”±çš„ç®€å• http1.1 æœåŠ¡å™¨ã€‚\nmkdir hapijs-http2 \u0026amp;\u0026amp; \\ cd hapijs-http2 \u0026amp;\u0026amp; \\ npm init -y \u0026amp;\u0026amp; \\ npm i hapi@^16.6 -s \u0026amp;\u0026amp; \\ touch http1Server.js å°†ä¸‹é¢çš„ä»£ç å¤åˆ¶åˆ°æ­¤å¤„æˆ–ä»æ­¤å¤„http1Server.jså…‹éš†æ•´ä¸ªå­˜å‚¨åº“ã€‚\nconst Hapi = require(\u0026#39;hapi\u0026#39;); const server = new Hapi.Server(); // define server config server.connection({ port: \u0026#39;8000\u0026#39; }); // define route config server.route([{ method: \u0026#39;GET\u0026#39;, path: \u0026#39;/ping\u0026#39;, handler: (request, reply) =\u0026gt; { reply(\u0026#39;pong\u0026#39;); } }]); // start server server.start(err =\u0026gt; { if (err) console.error(err) console.log(`Started ${server.connections.length} connections`) }); ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¿›è¡Œå¥å…¨æ€§æ£€æŸ¥ã€‚\nå¯åŠ¨æœåŠ¡å™¨ï¼Œnode http1Server.js\nâ‡’ http://127.0.0.1:8000/ping pong å‡‰çˆ½çš„ï¼å¦‚æœæˆ‘ä»¬å¾—åˆ° pong çš„ pingï¼Œè®©æˆ‘ä»¬å°è¯•å°†http2é›†æˆåˆ°æˆ‘ä»¬çš„ hapijs æœåŠ¡å™¨ä¸­ã€‚\næœ¬è´¨ä¸Šï¼Œhttp2 éœ€è¦ä¸ https ä¸€èµ·è¿è¡Œã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ssl è¯ä¹¦ã€‚æˆ‘ä»¬å°†ä½¿ç”¨OpenSSLåˆ›å»ºä¸€ä¸ªè‡ªç­¾åè¯ä¹¦ï¼Œæˆ–è€…æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨æ­¤å¤„çš„ä¸€ä¸ªã€‚\nopenssl req -x509 -newkey rsa:2048 -nodes -sha256 -subj \u0026#39;/CN=localhost\u0026#39; \\ -keyout localhost-privkey.pem -out localhost-cert.pem æˆ‘ä»¬å°†localhost-privkey.pemåœ¨localhost-cert.pemæˆ‘ä»¬çš„http2Server.js.\nè®©æˆ‘ä»¬è¿›è¡Œä»¥ä¸‹æ›´æ”¹ï¼Œ\nconst Hapi = require(\u0026#39;hapi\u0026#39;); const fs = require(\u0026#39;fs\u0026#39;); const Http2 = require(\u0026#39;http2\u0026#39;); const server = new Hapi.Server(); // read certificate and private key const serverOptions = { key: fs.readFileSync(\u0026#39;localhost-privkey.pem\u0026#39;), cert: fs.readFileSync(\u0026#39;localhost-cert.pem\u0026#39;) }; // create http2 secure server listener const listener = Http2.createSecureServer(serverOptions); // create a connection object with listener and other options server.connection({ listener, port: \u0026#39;8000\u0026#39; }); // define routes server.route([{ method: \u0026#39;GET\u0026#39;, path: \u0026#39;/ping\u0026#39;, handler: (request, reply) =\u0026gt; { reply(\u0026#39;pong\u0026#39;); } }]); // start server server.start(err =\u0026gt; { if (err) console.error(err) console.log(`Started ${server.connections.length} connections`) }); å‘ç”Ÿäº†ä»€ä¹ˆå˜åŒ–ï¼Ÿ\nç¬¬ 7-10 è¡Œï¼šæˆ‘ä»¬æ­£åœ¨è¯»å–ä¹‹å‰ç”Ÿæˆçš„è¯ä¹¦å’Œç§é’¥ã€‚\nç¬¬ 13 è¡Œï¼šåˆ›å»ºä¸€ä¸ªå®‰å…¨çš„ Http2 æœåŠ¡å™¨ï¼Œå…¶ä¸­è¯ä¹¦å’Œç§é’¥ä½œä¸ºæœåŠ¡å™¨é€‰é¡¹ä»http2æ¨¡å—ä¼ é€’ã€‚\nç¬¬ 17 è¡Œï¼šæˆ‘ä»¬å¯ä»¥åœ¨ä½¿ç”¨è¯¥é€‰é¡¹åˆ›å»ºè¿æ¥æ—¶æä¾›æˆ‘ä»¬è‡ªå·±çš„æœåŠ¡å™¨å®ç°listenerã€‚ ï¼ˆæ›´å¤šä¿¡æ¯åœ¨è¿™é‡Œï¼‰ã€‚\nä»…ä¾›å‚è€ƒï¼šæˆ‘ä½¿ç”¨çš„æ˜¯ node@v10.4.1ï¼Œä»»ä½•é«˜äº 9 çš„å€¼éƒ½å¯ä»¥ã€‚\né‡æ–°å¯åŠ¨æœåŠ¡å™¨ï¼Œç„¶åä½¿ç”¨æµè§ˆå™¨https://127.0.0.1:8000/ping\nç§ï¼\næœåŠ¡å™¨ç”¨ pong å›å¤\néœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œ\nåè®®å€¼ä¸ºh2åˆ«åhttp2 å°½ç®¡æˆ‘ä»¬ä½¿ç”¨ https è¿è¡Œï¼Œä½†æˆ‘ä»¬åœ¨æµè§ˆå™¨åœ°å€æ ä¸­çœ‹åˆ°ä¸å®‰å…¨ï¼›å› ä¸ºæˆ‘ä»¬å¯¹ssl è¯ä¹¦è¿›è¡Œäº†è‡ªç­¾åï¼Œå¹¶ä¸”æµè§ˆå™¨æ— æ³•å°†å…¶è¯†åˆ«ä¸ºæ¥è‡ªæœ‰æ•ˆçš„è¯ä¹¦é¢å‘æœºæ„ã€‚ å¦‚æœæˆ‘ä»¬å°è¯•ä½¿ç”¨curlï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå¾—åˆ°This is because http2 may not support with default curly by your OS.æ‚¨å¯ä»¥æŒ‰ç…§æ­¤æ“ä½œå‡çº§æ‚¨çš„curl (macOS)ã€‚ âœ curl https://127.0.0.1:8000/ping curl: Unsupported protocol ä¸€æ—¦æˆ‘ä»¬å®Œæˆè®¾ç½®ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¸¦æœ‰æ ‡å¿—çš„curlæ¥æ”¯æŒhttp2åè®®ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¼ é€’å¸¦æœ‰æ ‡å¿—çš„è¯ä¹¦æ–‡ä»¶ï¼Œå› ä¸ºå®ƒæ˜¯è‡ªç­¾åçš„å¹¶ä¸”ä¸èƒ½è¢«curlè¯†åˆ«ã€‚ curl --http2 --cacert localhost-cert.pem https://127.0.0.1:8000/ping â€”-http2``â€”-cacert -Iæˆ‘ä»¬å¯ä»¥é€šè¿‡è¦æ±‚curlä»…è¿”å›å¸¦æœ‰ï¼ˆheadï¼‰æˆ–å¸¦æœ‰ï¼ˆverboseï¼‰çš„å“åº”å¤´æ¥éªŒè¯åè®®-vã€‚ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸€åˆ‡éƒ½å¾ˆå¥½ã€‚ä½†æˆ‘ä»¬æ‰€æœ‰çš„å®¢æˆ·å¯èƒ½æ”¯æŒä¹Ÿå¯èƒ½ä¸æ”¯æŒ http2ã€‚æˆ‘ä»¬é€šè¿‡æ·»åŠ é¢å¤–çš„æœåŠ¡å™¨é€‰é¡¹æ¥å¤„ç†è¿™ä¸ªé—®é¢˜ï¼š allowHttp1: true\n// read certificate and private-key const serverOptions = { key: fs.readFileSync(\u0026#39;localhost-privkey.pem\u0026#39;), cert: fs.readFileSync(\u0026#39;localhost-cert.pem\u0026#39;), allowHTTP1: true }; åœ¨ serverOptions ä¸­æ·»åŠ â€œallowHTTP1: trueâ€ åœ¨ serverOptions ä¸­æ·»åŠ â€œallowHTTP1ï¼š trueâ€\nç°åœ¨æˆ‘ä»¬å¼€å§‹ï¼å½“å®¢æˆ·ç«¯ä¸æ”¯æŒ http2 æ—¶ï¼Œå›é€€åˆ°æä¾› http1.1\nåŒæ—¶ä¸º http1.1 å’Œ http2 å®¢æˆ·ç«¯æä¾›æœåŠ¡\nä»…é€šè¿‡è¿™äº›æ›´æ”¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥è·å¾—çº¦ 135% çš„æ€§èƒ½æå‡ã€‚\nä»”ç»†è§‚å¯Ÿå·®å¼‚ï¼Œ\né€šè¿‡ç€‘å¸ƒéƒ¨åˆ†ï¼Œå¯ä»¥æ˜æ˜¾åœ°æŒæ¡å•ä¸ª TCP è¿æ¥ä½¿ç”¨ä¸å¤šä¸ª TCP è¿æ¥ä½¿ç”¨ä¹‹é—´çš„å·®å¼‚ã€‚\nå¦‚æœæ‚¨æƒ³è·å¾— http2 å¯ä»¥æä¾›çš„ç¬¬ä¸€æ‰‹ç»éªŒï¼Œè¯·æŒ‰ç…§æ­¤å¤„çš„è¯´æ˜åœ¨æ‚¨çš„è®¡ç®—æœºä¸­è¿è¡Œä¸Šè¿°æ¼”ç¤ºã€‚\nå› æ­¤ï¼Œé€‰æ‹©æ‚¨çš„å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨åº“å®ç°å¹¶å¼€å§‹ä½¿ç”¨ http2ï¼\nå®Œæ•´çš„ä»£ç å¯ä»¥åœ¨githubä¸Šæ‰¾åˆ°ã€‚\nå‚è€ƒï¼š\nhttps://http2.github.io/faq https://http2.akamai.com/demo https://github.com/http2/http2-spec/wiki/Implementations https://caniuse.com/#feat=http2 https://nodejs.org/dist/latest-v10.x/docs/api/http2.html å¦‚æœä½ è§‰å¾—è¿™ä¸ªæ•…äº‹æœ‰ç”¨çš„è¯ï¼Œè¯·ç‚¹ä¸ªèµæ”¯æŒä¸€ä¸‹ğŸ‘\n","permalink":"https://blog.chensoul.cc/posts/2024/05/08/exploring-http2-part-2-overview/","summary":"åŸæ–‡é“¾æ¥ï¼šhttps://noobj.medium.com/exploring-http2-part-2-with-node-http2-core-and-hapijs-74e3df14249\næ¥æºï¼šhttps://www.thewebmaster.com/\nå…ˆå†³æ¡ä»¶ï¼šäº†è§£ javascriptã€å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶æ„ã€‚\nå®Œæ•´çš„ä»£ç å¯ä»¥åœ¨githubä¸Šæ‰¾åˆ°ã€‚\nç¬¬ 1 éƒ¨åˆ†ï¼šæ¦‚è¿°ï¼ˆhttp2 çš„åŸå› ã€å†…å®¹ã€æ—¶é—´ã€æ–¹å¼ï¼‰ç¬¬ 2 éƒ¨åˆ†ï¼šä½¿ç”¨ node-http2 æ ¸å¿ƒå’Œ hapijs è¿›è¡Œæ¢ç´¢\nå…è´£å£°æ˜ï¼šæœ¬æ–‡å°†ä½¿ç”¨node@v9+é™„å¸¦çš„http2æ¨¡å—ã€‚è¿™é‡Œåˆ—å‡ºäº†å…¶ä»–å‡ ä¸ª http2 å®¢æˆ·ç«¯-æœåŠ¡å™¨åº“å®ç°ã€‚\nè®©æˆ‘ä»¬å¼€å§‹åˆ›å»ºä¸€ä¸ªå…·æœ‰å•ä¸€è·¯ç”±çš„ç®€å• http1.1 æœåŠ¡å™¨ã€‚\nmkdir hapijs-http2 \u0026amp;\u0026amp; \\ cd hapijs-http2 \u0026amp;\u0026amp; \\ npm init -y \u0026amp;\u0026amp; \\ npm i hapi@^16.6 -s \u0026amp;\u0026amp; \\ touch http1Server.js å°†ä¸‹é¢çš„ä»£ç å¤åˆ¶åˆ°æ­¤å¤„æˆ–ä»æ­¤å¤„http1Server.jså…‹éš†æ•´ä¸ªå­˜å‚¨åº“ã€‚\nconst Hapi = require(\u0026#39;hapi\u0026#39;); const server = new Hapi.Server(); // define server config server.connection({ port: \u0026#39;8000\u0026#39; }); // define route config server.route([{ method: \u0026#39;GET\u0026#39;, path: \u0026#39;/ping\u0026#39;, handler: (request, reply) =\u0026gt; { reply(\u0026#39;pong\u0026#39;); } }]); // start server server.start(err =\u0026gt; { if (err) console.error(err) console.log(`Started ${server.connections.length} connections`) }); ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¿›è¡Œå¥å…¨æ€§æ£€æŸ¥ã€‚\nå¯åŠ¨æœåŠ¡å™¨ï¼Œnode http1Server.js\nâ‡’ http://127.0.0.1:8000/ping pong å‡‰çˆ½çš„ï¼å¦‚æœæˆ‘ä»¬å¾—åˆ° pong çš„ pingï¼Œè®©æˆ‘ä»¬å°è¯•å°†http2é›†æˆåˆ°æˆ‘ä»¬çš„ hapijs æœåŠ¡å™¨ä¸­ã€‚","title":"[è¯‘]æ¢ç´¢ http2ï¼ˆç¬¬ 2 éƒ¨åˆ†ï¼‰ï¼šä½¿ç”¨ node-http2 æ ¸å¿ƒå’Œ hapijs"},{"content":"åŸæ–‡é“¾æ¥ï¼šhttps://noobj.medium.com/exploring-http2-part-1-overview-dc3e9b53968f\nè®©æˆ‘ä»¬æ¥è°ˆè°ˆ http2 çš„å†…å®¹ã€åŸå› ã€æ—¶é—´å’Œæ–¹å¼\nå®Œæ•´çš„ä»£ç å¯ä»¥åœ¨githubä¸Šæ‰¾åˆ°ã€‚\nç¬¬ 1 éƒ¨åˆ†ï¼šæ¦‚è¿° ç¬¬ 2 éƒ¨åˆ†ï¼šä½¿ç”¨ node-http2 æ ¸å¿ƒå’Œ hapijs è¿›è¡Œæ¢ç´¢\nä»€ä¹ˆæ˜¯http2ï¼Ÿ **http2*æ˜¯è‡ª 1999 å¹´ä»¥æ¥ä½¿ç”¨çš„http1.1***ä¹‹åçš„æœ€æ–°æ›´æ–°\nhttp2åè®®æ³¨é‡æ€§èƒ½ï¼›å…·ä½“æ¥è¯´ï¼Œæœ€ç»ˆç”¨æˆ·æ„ŸçŸ¥çš„å»¶è¿Ÿã€ç½‘ç»œå’ŒæœåŠ¡å™¨èµ„æºçš„ä½¿ç”¨æƒ…å†µã€‚ ï¼ˆåœ¨æ­¤å¤„é˜…è¯»æœ‰å…³è§„æ ¼çš„ä¿¡æ¯*ï¼‰*\nä¸ºä»€ä¹ˆæ˜¯http2ï¼Ÿ æ¢å¥è¯è¯´http1.1æœ‰ä»€ä¹ˆé—®é¢˜\nåŠ è½½ç½‘é¡µæ˜¯ä¸€é¡¹èµ„æºå¯†é›†å‹å·¥ä½œï¼Œå› ä¸º HTTP/1.1 åªå…è®¸æ¯ä¸ª TCP è¿æ¥æœ‰ä¸€ä¸ªæœªå®Œæˆçš„è¯·æ±‚ã€‚ç½‘ç»œéœ€è¦è¿›è¡Œæ›´æ–°ï¼Œä»¥æé«˜æ•ˆç‡ã€å®‰å…¨æ€§å’Œé€Ÿåº¦ã€‚\nhttp2å¦‚ä½•è§£å†³æ€§èƒ½é—®é¢˜ï¼Ÿ\nhttp2 å¸¦æ¥çš„æ”¹è¿›ï¼š\n**å•ä¸€è¿æ¥ï¼š**ä»…ä½¿ç”¨ä¸€ä¸ªä¸æœåŠ¡å™¨çš„è¿æ¥æ¥åŠ è½½ç½‘ç«™ï¼Œå¹¶ä¸”åªè¦ç½‘ç«™æ‰“å¼€ï¼Œè¯¥è¿æ¥å°±ä¿æŒæ‰“å¼€çŠ¶æ€ã€‚è¿™å‡å°‘äº†å»ºç«‹å¤šä¸ª TCP è¿æ¥æ‰€éœ€çš„å¾€è¿”æ¬¡æ•°ã€‚ï¼ˆæ›´å¤šä¿¡æ¯åœ¨è¿™é‡Œï¼‰ **å¤šè·¯å¤ç”¨ï¼š**åŒä¸€è¿æ¥ä¸ŠåŒæ—¶å…è®¸å¤šä¸ªè¯·æ±‚ã€‚ä»¥å‰ï¼Œåœ¨ HTTP/1.1 ä¸­ï¼Œæ¯ä¸ªä¼ è¾“éƒ½å¿…é¡»ç­‰å¾…å…¶ä»–ä¼ è¾“å®Œæˆã€‚ï¼ˆæ›´å¤šä¿¡æ¯åœ¨è¿™é‡Œï¼‰ **æœåŠ¡å™¨æ¨é€ï¼š**å¯ä»¥å°†å…¶ä»–èµ„æºå‘é€åˆ°å®¢æˆ·ç«¯ä»¥ä¾›å°†æ¥ä½¿ç”¨ã€‚ï¼ˆæ›´å¤šä¿¡æ¯åœ¨è¿™é‡Œï¼‰ **ä¼˜å…ˆçº§ï¼š**è¯·æ±‚è¢«åˆ†é…ä¾èµ–çº§åˆ«ï¼ŒæœåŠ¡å™¨å¯ä»¥ä½¿ç”¨å®ƒæ¥æ›´å¿«åœ°äº¤ä»˜æ›´é«˜ä¼˜å…ˆçº§çš„èµ„æºã€‚ï¼ˆæ›´å¤šä¿¡æ¯åœ¨è¿™é‡Œï¼‰ **äºŒè¿›åˆ¶ï¼š**ä½¿ HTTP/2 æ›´æ˜“äºæœåŠ¡å™¨è§£æã€æ›´ç´§å‡‘ä¸”ä¸æ˜“å‡ºé”™ã€‚å°†ä¿¡æ¯ä»æ–‡æœ¬è½¬æ¢ä¸ºäºŒè¿›åˆ¶ä¸ä¼šæµªè´¹é¢å¤–çš„æ—¶é—´ã€‚ï¼ˆæ›´å¤šä¿¡æ¯åœ¨è¿™é‡Œï¼‰ æ ‡å¤´å‹ç¼©ï¼š HTTP/2 ä½¿ç”¨HPACKå‹ç¼©ï¼Œä»è€Œå‡å°‘å¼€é”€ã€‚åœ¨ HTTP/1.1 ä¸­ï¼Œæ¯ä¸ªè¯·æ±‚ä¸­çš„è®¸å¤šæ ‡å¤´éƒ½ä½¿ç”¨ç›¸åŒçš„å€¼å‘é€ã€‚ï¼ˆæ›´å¤šä¿¡æ¯åœ¨è¿™é‡Œï¼‰ æˆ‘ä»¬ä»€ä¹ˆæ—¶å€™å¯ä»¥å¼€å§‹ä½¿ç”¨http2ï¼Ÿ ç°åœ¨ï¼\nè¿™æ˜¯æ—¶é—´çº¿ï¼Œ\næ¥æºï¼šhttps://www.polyglotdeveloper.com/\næ˜¯çš„ï¼Œä» 1999 å¹´åˆ°ä»Šå¤©ï¼Œæˆ‘ä»¬ï¼ˆå¤§å¤šæ•°ï¼‰éƒ½åœ¨ä½¿ç”¨åŒæ ·å¥½çš„æ—§ http1.1ï¼› 15å¹´ï¼\nå¦‚ä½•å¼€å§‹ä½¿ç”¨http2ï¼Ÿ ä»¥ä¸‹æ˜¯å„ç§è¯­è¨€çš„ http2 åº“å®ç°åˆ—è¡¨ã€‚\næ ¹æ®Can I Useçš„ç»Ÿè®¡ï¼Œå¤§çº¦ 83% çš„åœ¨çº¿æµè§ˆå™¨å·²ç»æ”¯æŒ http2\næŸ¥çœ‹å®é™…æƒ…å†µï¼Œhttp1.1 ä¸ http2ï¼ˆç½‘ç»œèŠ‚æµï¼šå¿«é€Ÿ 3gï¼‰\nhttp1.1ï¼ˆå·¦ï¼‰ä¸http2ï¼ˆå³ï¼‰ï¼›è®©æˆ‘ä»¬åœ¨ä¸‹ä¸€èŠ‚ä¸­æ„å»ºå®ƒ\nåœ¨ä¸‹ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªæ”¯æŒ http2 çš„ç®€å•æœåŠ¡å™¨ï¼›å…·æœ‰http1.1å‘åå…¼å®¹æ€§ï¼›ä¸€æ­¥ä¸€æ­¥ä½¿ç”¨http2-node core å’Œhapi jsã€‚\nç¬¬ 1 éƒ¨åˆ†ï¼šæ¦‚è¿° ç¬¬ 2 éƒ¨åˆ†ï¼šä½¿ç”¨ node-http2 æ ¸å¿ƒå’Œ hapijs è¿›è¡Œæ¢ç´¢\nå®Œæ•´çš„ä»£ç å¯ä»¥åœ¨githubä¸Šæ‰¾åˆ°ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2024/05/08/exploring-http2-part-1-overview/","summary":"åŸæ–‡é“¾æ¥ï¼šhttps://noobj.medium.com/exploring-http2-part-1-overview-dc3e9b53968f\nè®©æˆ‘ä»¬æ¥è°ˆè°ˆ http2 çš„å†…å®¹ã€åŸå› ã€æ—¶é—´å’Œæ–¹å¼\nå®Œæ•´çš„ä»£ç å¯ä»¥åœ¨githubä¸Šæ‰¾åˆ°ã€‚\nç¬¬ 1 éƒ¨åˆ†ï¼šæ¦‚è¿° ç¬¬ 2 éƒ¨åˆ†ï¼šä½¿ç”¨ node-http2 æ ¸å¿ƒå’Œ hapijs è¿›è¡Œæ¢ç´¢\nä»€ä¹ˆæ˜¯http2ï¼Ÿ **http2*æ˜¯è‡ª 1999 å¹´ä»¥æ¥ä½¿ç”¨çš„http1.1***ä¹‹åçš„æœ€æ–°æ›´æ–°\nhttp2åè®®æ³¨é‡æ€§èƒ½ï¼›å…·ä½“æ¥è¯´ï¼Œæœ€ç»ˆç”¨æˆ·æ„ŸçŸ¥çš„å»¶è¿Ÿã€ç½‘ç»œå’ŒæœåŠ¡å™¨èµ„æºçš„ä½¿ç”¨æƒ…å†µã€‚ ï¼ˆåœ¨æ­¤å¤„é˜…è¯»æœ‰å…³è§„æ ¼çš„ä¿¡æ¯*ï¼‰*\nä¸ºä»€ä¹ˆæ˜¯http2ï¼Ÿ æ¢å¥è¯è¯´http1.1æœ‰ä»€ä¹ˆé—®é¢˜\nåŠ è½½ç½‘é¡µæ˜¯ä¸€é¡¹èµ„æºå¯†é›†å‹å·¥ä½œï¼Œå› ä¸º HTTP/1.1 åªå…è®¸æ¯ä¸ª TCP è¿æ¥æœ‰ä¸€ä¸ªæœªå®Œæˆçš„è¯·æ±‚ã€‚ç½‘ç»œéœ€è¦è¿›è¡Œæ›´æ–°ï¼Œä»¥æé«˜æ•ˆç‡ã€å®‰å…¨æ€§å’Œé€Ÿåº¦ã€‚\nhttp2å¦‚ä½•è§£å†³æ€§èƒ½é—®é¢˜ï¼Ÿ\nhttp2 å¸¦æ¥çš„æ”¹è¿›ï¼š\n**å•ä¸€è¿æ¥ï¼š**ä»…ä½¿ç”¨ä¸€ä¸ªä¸æœåŠ¡å™¨çš„è¿æ¥æ¥åŠ è½½ç½‘ç«™ï¼Œå¹¶ä¸”åªè¦ç½‘ç«™æ‰“å¼€ï¼Œè¯¥è¿æ¥å°±ä¿æŒæ‰“å¼€çŠ¶æ€ã€‚è¿™å‡å°‘äº†å»ºç«‹å¤šä¸ª TCP è¿æ¥æ‰€éœ€çš„å¾€è¿”æ¬¡æ•°ã€‚ï¼ˆæ›´å¤šä¿¡æ¯åœ¨è¿™é‡Œï¼‰ **å¤šè·¯å¤ç”¨ï¼š**åŒä¸€è¿æ¥ä¸ŠåŒæ—¶å…è®¸å¤šä¸ªè¯·æ±‚ã€‚ä»¥å‰ï¼Œåœ¨ HTTP/1.1 ä¸­ï¼Œæ¯ä¸ªä¼ è¾“éƒ½å¿…é¡»ç­‰å¾…å…¶ä»–ä¼ è¾“å®Œæˆã€‚ï¼ˆæ›´å¤šä¿¡æ¯åœ¨è¿™é‡Œï¼‰ **æœåŠ¡å™¨æ¨é€ï¼š**å¯ä»¥å°†å…¶ä»–èµ„æºå‘é€åˆ°å®¢æˆ·ç«¯ä»¥ä¾›å°†æ¥ä½¿ç”¨ã€‚ï¼ˆæ›´å¤šä¿¡æ¯åœ¨è¿™é‡Œï¼‰ **ä¼˜å…ˆçº§ï¼š**è¯·æ±‚è¢«åˆ†é…ä¾èµ–çº§åˆ«ï¼ŒæœåŠ¡å™¨å¯ä»¥ä½¿ç”¨å®ƒæ¥æ›´å¿«åœ°äº¤ä»˜æ›´é«˜ä¼˜å…ˆçº§çš„èµ„æºã€‚ï¼ˆæ›´å¤šä¿¡æ¯åœ¨è¿™é‡Œï¼‰ **äºŒè¿›åˆ¶ï¼š**ä½¿ HTTP/2 æ›´æ˜“äºæœåŠ¡å™¨è§£æã€æ›´ç´§å‡‘ä¸”ä¸æ˜“å‡ºé”™ã€‚å°†ä¿¡æ¯ä»æ–‡æœ¬è½¬æ¢ä¸ºäºŒè¿›åˆ¶ä¸ä¼šæµªè´¹é¢å¤–çš„æ—¶é—´ã€‚ï¼ˆæ›´å¤šä¿¡æ¯åœ¨è¿™é‡Œï¼‰ æ ‡å¤´å‹ç¼©ï¼š HTTP/2 ä½¿ç”¨HPACKå‹ç¼©ï¼Œä»è€Œå‡å°‘å¼€é”€ã€‚åœ¨ HTTP/1.1 ä¸­ï¼Œæ¯ä¸ªè¯·æ±‚ä¸­çš„è®¸å¤šæ ‡å¤´éƒ½ä½¿ç”¨ç›¸åŒçš„å€¼å‘é€ã€‚ï¼ˆæ›´å¤šä¿¡æ¯åœ¨è¿™é‡Œï¼‰ æˆ‘ä»¬ä»€ä¹ˆæ—¶å€™å¯ä»¥å¼€å§‹ä½¿ç”¨http2ï¼Ÿ ç°åœ¨ï¼\nè¿™æ˜¯æ—¶é—´çº¿ï¼Œ\næ¥æºï¼šhttps://www.polyglotdeveloper.com/\næ˜¯çš„ï¼Œä» 1999 å¹´åˆ°ä»Šå¤©ï¼Œæˆ‘ä»¬ï¼ˆå¤§å¤šæ•°ï¼‰éƒ½åœ¨ä½¿ç”¨åŒæ ·å¥½çš„æ—§ http1.1ï¼› 15å¹´ï¼\nå¦‚ä½•å¼€å§‹ä½¿ç”¨http2ï¼Ÿ ä»¥ä¸‹æ˜¯å„ç§è¯­è¨€çš„ http2 åº“å®ç°åˆ—è¡¨ã€‚\næ ¹æ®Can I Useçš„ç»Ÿè®¡ï¼Œå¤§çº¦ 83% çš„åœ¨çº¿æµè§ˆå™¨å·²ç»æ”¯æŒ http2\næŸ¥çœ‹å®é™…æƒ…å†µï¼Œhttp1.1 ä¸ http2ï¼ˆç½‘ç»œèŠ‚æµï¼šå¿«é€Ÿ 3gï¼‰\nhttp1.1ï¼ˆå·¦ï¼‰ä¸http2ï¼ˆå³ï¼‰ï¼›è®©æˆ‘ä»¬åœ¨ä¸‹ä¸€èŠ‚ä¸­æ„å»ºå®ƒ\nåœ¨ä¸‹ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªæ”¯æŒ http2 çš„ç®€å•æœåŠ¡å™¨ï¼›å…·æœ‰http1.1å‘åå…¼å®¹æ€§ï¼›ä¸€æ­¥ä¸€æ­¥ä½¿ç”¨http2-node core å’Œhapi jsã€‚\nç¬¬ 1 éƒ¨åˆ†ï¼šæ¦‚è¿° ç¬¬ 2 éƒ¨åˆ†ï¼šä½¿ç”¨ node-http2 æ ¸å¿ƒå’Œ hapijs è¿›è¡Œæ¢ç´¢\nå®Œæ•´çš„ä»£ç å¯ä»¥åœ¨githubä¸Šæ‰¾åˆ°ã€‚","title":"[è¯‘]æ¢ç´¢ http2ï¼ˆç¬¬ 1 éƒ¨åˆ†ï¼‰ï¼šæ¦‚è¿°"},{"content":"åŸæ–‡é“¾æ¥ï¼šhttps://ably.com/topic/socketio-vs-http\nåœ¨è§„åˆ’å®æ—¶åº”ç”¨ç¨‹åºæ—¶ï¼Œæ‚¨åº”è¯¥ä»”ç»†è€ƒè™‘è¦ä½¿ç”¨å“ªäº›æŠ€æœ¯ã€‚æœ¬æ–‡å¯¹Socket.IOå®æ—¶åº“å’ŒHTTPåè®®è¿›è¡Œäº†æ¯”è¾ƒã€‚ä¸‹é¢æ‚¨å°†äº†è§£æ¯ç§è§£å†³æ–¹æ¡ˆçš„åŠŸèƒ½ã€æ¯ç§è§£å†³æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹ä»¥åŠä½•æ—¶ä½¿ç”¨å®ƒä»¬ã€‚\nä»€ä¹ˆæ˜¯Socket.IOï¼Ÿ Socket.IO æ˜¯ä¸€ä¸ªåˆ›å»ºäº 2010 å¹´çš„åº“ï¼Œæä¾›å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„å®æ—¶åŒå‘é€šä¿¡ã€‚å®ƒå…è®¸ç®¡ç†è¿æ¥ã€å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ç­‰ç­‰ã€‚è¿™ä½¿å¾— Socket.IO æˆä¸ºæ„å»ºæ¶ˆæ¯/èŠå¤©åº”ç”¨ç¨‹åºçš„ç†æƒ³é€‰æ‹©ã€‚\nSocket.IO éœ€è¦ä¸¤ä¸ªåº“ - ä¸€ä¸ªåœ¨æœåŠ¡å™¨ä¸Šï¼Œä¸€ä¸ªåœ¨å®¢æˆ·ç«¯ä¸Šã€‚ Socket.IO åˆ›å»ºè€…ç»´æŠ¤ä»¥ä¸‹â€œå®˜æ–¹â€ï¼š\nSocket.IOæ˜¯ Node.js æœåŠ¡å™¨ç»„ä»¶ã€‚ Socket.IO-clientæ˜¯å®¢æˆ·ç«¯ JavaScript åº“ã€‚ ä¸€äº› Socket.IO å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å®ç°å¯ä»¥ç”¨å…¶ä»–è¯­è¨€å®ç°ã€‚è¯·é˜…è¯»Socket.IO æ˜¯ä»€ä¹ˆæ¥è·å–åˆ—è¡¨ã€‚\nä¸‹å›¾æ€»ç»“äº†å…¸å‹çš„ Socket.IO è®¾ç½®ï¼š\nSocket.IO ä¸»è¦ç‰¹æ€§ Socket.IO å…·æœ‰ä»¥ä¸‹ä¸»è¦ç‰¹æ€§ï¼š\n**å‘åå…¼å®¹æ€§ï¼š**åœ¨ç°ä»£æµè§ˆå™¨ä¸­ï¼ŒSocket.IO ä½¿ç”¨WebSocket APIæä¾›æ‰€éœ€çš„è¿æ¥å¹¶å‘é€æ¶ˆæ¯ã€‚ WebSocket åœ¨æœåŠ¡å™¨å’Œæµè§ˆå™¨ä¹‹é—´æä¾›å…¨åŒå·¥ã€ä½å»¶è¿Ÿã€äº‹ä»¶é©±åŠ¨çš„è¿æ¥ã€‚å®ƒä¹Ÿæ˜¯æœ‰çŠ¶æ€çš„ã€‚å¦‚æœéœ€è¦æ—§ç‰ˆæµè§ˆå™¨æ”¯æŒï¼Œæˆ–è€… WebSocket è¿æ¥æ— æ³•ä½¿ç”¨ï¼ˆç”±äºé˜²ç«å¢™æˆ–å…¬å¸ä»£ç†ï¼‰ï¼ŒSocket.IO å¯ä»¥å›é€€åˆ° HTTP å’Œé•¿è½®è¯¢ã€‚ é‡è¿å’Œç¼“å†²ï¼š Socket.IOæä¾›è‡ªåŠ¨é‡è¿åŠŸèƒ½ã€‚å½“å®¢æˆ·ç«¯æ–­å¼€è¿æ¥æ—¶ï¼Œæ•°æ®åŒ…ä¼šè‡ªåŠ¨ç¼“å†²ï¼Œå¹¶åœ¨é‡æ–°è¿æ¥æ—¶å‘é€ã€‚ å¤šç§æ•°æ®æ ¼å¼ï¼š Socket.IO æ”¯æŒä»»ä½•å¯åºåˆ—åŒ–æ ¼å¼çš„æ•°æ®ä¼ è¾“ï¼ŒåŒ…æ‹¬Bufferæˆ–TypedArrayç­‰äºŒè¿›åˆ¶å¯¹è±¡ã€‚ **è‡´è°¢ï¼š**ä½¿ç”¨ Socket.IOï¼Œä¸€æ—¦æˆåŠŸæ¥æ”¶åˆ°æ¶ˆæ¯å°±å¯ä»¥å‘é€å“åº”æ¶ˆæ¯ã€‚ å‘½åç©ºé—´ï¼š Socket.IO ä½¿æ‚¨èƒ½å¤Ÿè®¾ç½®å…·æœ‰ä¸åŒå®¢æˆ·ç«¯ã€æˆ¿é—´ã€äº‹ä»¶å’Œåº”ç”¨ç¨‹åºé€»è¾‘çš„ä¸åŒé€šé“ã€‚ **å¹¿æ’­åˆ°ä¸åŒçš„å®¢æˆ·ç«¯ç»„ï¼š**ä»æœåŠ¡å™¨ï¼Œæ‚¨å¯ä»¥å‘æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯æˆ–å­é›†å‘é€æ¶ˆæ¯ã€‚ Socket.IO çš„ä¼˜ç¼ºç‚¹ Socket.IO ä¸“ä¸šäººå£« è¿æ¥æ•ˆç‡ï¼š Socket.IO ä½¿ç”¨ HTTP é•¿è½®è¯¢å‘èµ·è¿æ¥ï¼Œä¸€æ—¦å»ºç«‹å¯ç”¨æ€§å°±å‡çº§åˆ° WebSocketï¼ˆæœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…å‡çº§æœºåˆ¶ï¼‰ã€‚å½“å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œå®¢æˆ·ç«¯-æœåŠ¡å™¨è¿æ¥ä½¿ç”¨å•ä¸ª WebSocketï¼Œè€Œä¸å¿…å¯åŠ¨å¤šä¸ªè¿æ¥ï¼Œä»è€Œå‡å°‘å»¶è¿Ÿå¹¶æ”¹å–„ç”¨æˆ·ä½“éªŒã€‚ **å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å‘èµ·çš„é€šä¿¡ï¼š**ç”±äºWebSocketæä¾›äº†å…¨åŒå·¥ã€åŒå‘çš„é€šä¿¡é€šé“ï¼Œå› æ­¤æœåŠ¡å™¨å¯ä»¥å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼Œå¹¶ä¸”ä¸¤è€…å¯ä»¥åŒæ—¶å‘é€æ¶ˆæ¯ã€‚ äº‹ä»¶é©±åŠ¨çš„é€šä¿¡ï¼š WebSocketæ˜¯ä¸€ç§äº‹ä»¶é©±åŠ¨çš„åè®®ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥åœ¨æ”¶åˆ°æ¶ˆæ¯åç«‹å³ç›‘å¬å¹¶å“åº”æ¶ˆæ¯ï¼Œè€Œä¸æ˜¯ä½¿ç”¨è½®è¯¢æœºåˆ¶æ¥æ£€æŸ¥æ›´æ–°ï¼Œè¿™æ ·æ—¢æµªè´¹åˆä½æ•ˆã€‚ ä¸°å¯Œçš„åŠŸèƒ½é›†ï¼š Socket.IO æä¾›äº†å®ç°å®æ—¶åº”ç”¨ç¨‹åºæ‰€éœ€çš„ä¸€åˆ‡ã€‚å½“ä½¿ç”¨åŸå§‹ HTTP ç”šè‡³åŸå§‹ WebSocket æ—¶ï¼Œæ‚¨å¿…é¡»è‡ªå·±å®ç°å…¶ä¸­å¤§éƒ¨åˆ†åŠŸèƒ½ã€‚ æœ‰çŠ¶æ€ï¼š Socket.IO ä½¿ç”¨ WebSocketï¼Œå®ƒæ˜¯æœ‰çŠ¶æ€çš„ã€‚è¯¥çŠ¶æ€ä¸€ç›´æŒç»­åˆ°è¿æ¥å…³é—­ä¸ºæ­¢ã€‚ Socket.IO ç¼ºç‚¹ **æœ‰é™çš„å¹³å°æ”¯æŒï¼š**æˆ‘ä»¬ä¹‹å‰æåˆ°ï¼ŒSocket.IO åœ¨ä¸åŒçš„å¹³å°å’Œè¯­è¨€ä¸Šæœ‰å¤šç§æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å®ç°ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå…¶ä¸­ä¸€äº›æ²¡æœ‰å¾—åˆ°ç§¯æç»´æŠ¤ï¼Œæˆ–è€…åŠŸèƒ½é›†æœ‰é™ï¼Œå› æ­¤åœ¨è€ƒè™‘ä½¿ç”¨å®ƒä»¬ä¹‹å‰è¯·ä»”ç»†æ£€æŸ¥å®ƒä»¬ã€‚æ­¤å¤–ï¼ŒSocket.IO å®ç°ä¸æœ¬æœº WebSocket ä¸å…¼å®¹ï¼Œå› ä¸º Socket.IO ä¼šå‘å…¶å‘é€çš„æ¯ä¸ªæ•°æ®åŒ…æ·»åŠ é¢å¤–çš„å…ƒæ•°æ®ã€‚ å¯æ‰©å±•æ€§ï¼š Socket.IO éå¸¸é€‚åˆæœ‰é™æ•°é‡ç”¨æˆ·çš„å®æ—¶é€šä¿¡åº”ç”¨ç¨‹åºã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨çš„ç”¨æˆ·æ•°é‡å’Œæ•°æ®é‡å¼€å§‹å˜å¤§ï¼Œæ‚¨çš„æœåŠ¡å™¨å¯èƒ½ä¼šè¿‡è½½ã€‚å½“æ‚¨çš„æœåŠ¡å™¨è¾¾åˆ°æœ€å¤§è´Ÿè½½æ—¶ï¼Œæ‚¨å°†éœ€è¦å°†è¿æ¥æ‹†åˆ†åˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œå¦åˆ™å¯èƒ½ä¼šä¸¢å¤±é‡è¦ä¿¡æ¯ã€‚è¿™ç§å¢åŠ çš„æ¶æ„å¤æ‚æ€§å¸¦æ¥äº†æ›´å¤šé—®é¢˜ã€‚é˜…è¯»Scaling Socket.IO - å®é™…æ³¨æ„äº‹é¡¹ä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚ **å†…å­˜æ³„æ¼ï¼š**å·²çŸ¥ Socket.IO å­˜åœ¨ä¸€äº›ä¸å†…å­˜æ³„æ¼ç›¸å…³çš„é—®é¢˜ã€‚å†…å­˜æ³„æ¼ä¸å¤ªå¯èƒ½å¯¼è‡´ä»»ä½•ç›´æ¥é—®é¢˜ï¼Œä½†å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºä½¿ç”¨äº†å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œå®ƒä»¬æœ€ç»ˆå¯èƒ½ä¼šå¯¼è‡´ç”¨æˆ·çš„è®¾å¤‡å†»ç»“æˆ–å´©æºƒã€‚ ä»€ä¹ˆæ˜¯ HTTPï¼Ÿ HTTP æ˜¯ä¸€ç§è¯·æ±‚/å“åº”åè®®ï¼Œä½œä¸º Web çš„ä¸»è¦é€šä¿¡æœºåˆ¶ï¼Œæ„å»ºåœ¨ TCP ç½‘ç»œåè®®ä¹‹ä¸Šã€‚æœ‰é™ç‰ˆæœ¬æœ€åˆç”± Tim Berners-Lee äº 1989 å¹´æå‡ºï¼Œéšåç»è¿‡å¿«é€Ÿä¿®æ”¹ä»¥æ”¯æŒæ›´å¹¿æ³›çš„æµè§ˆå™¨å’ŒæœåŠ¡å™¨åŠŸèƒ½ã€‚ HTTP å·¥ä½œç»„äº 1996 å¹´å°†è¿™äº›ä¿®æ”¹è®°å½•ä¸º HTTP/1.0 ( RFC 1945 )ã€‚\nHTTP åœ¨ RESTful æ¶æ„ï¼ˆå³ REST APIï¼‰ä¸­å¾ˆå¸¸è§ã€‚ REST çš„ç»å…¸ç”¨ä¾‹æ˜¯ CRUD åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­ HTTP POSTã€PUTã€GETã€PUT å’Œ DELETE åŠ¨è¯æä¾›äº†ä¸€ç§ç®€å•çš„æ–¹æ³•æ¥å®ç°åˆ›å»ºã€è¯»å–ã€æ›´æ–°å’Œåˆ é™¤æ•°æ®çš„æ“ä½œã€‚\nä¼ ç»Ÿçš„ HTTP æ¶ˆæ¯æµå¦‚ä¸‹æ‰€ç¤ºï¼š\nHTTP æŠ€æœ¯çš„å‡ºç°å¯ä»¥å®ç°å®æ—¶åº”ç”¨ç¨‹åºï¼š\né•¿è½®è¯¢**ï¼š**å¯¹ HTTP æœåŠ¡å™¨çš„é‡å¤è¯·æ±‚ä¼šæµªè´¹èµ„æº - åœ¨æ¯ä¸ªè¯·æ±‚ä¸­ï¼Œæ‚¨éƒ½å¿…é¡»å»ºç«‹ä¸€ä¸ªæ–°è¿æ¥ï¼Œè§£æ HTTP æ ‡å¤´ï¼ŒæŸ¥è¯¢æ–°æ•°æ®ï¼Œç”Ÿæˆå’Œä¼ é€’å“åº”ï¼Œä»¥åŠå…³é—­å’Œæ¸…ç†è¿æ¥ã€‚é•¿è½®è¯¢é€šè¿‡å°½å¯èƒ½é•¿æ—¶é—´åœ°ä¿æŒå®¢æˆ·ç«¯-æœåŠ¡å™¨è¿æ¥æ‰“å¼€ï¼Œåœ¨æ–°æ•°æ®å¯ç”¨æˆ–è¾¾åˆ°è¶…æ—¶é˜ˆå€¼æ—¶æä¾›å“åº”æ¥æ”¹è¿›è¿™ä¸€ç‚¹ã€‚æ­£å¦‚æœ¬æ–‡å‰é¢æåˆ°çš„ï¼Œå½“ WebSocket ä¸å¯ç”¨æ—¶ï¼ŒSocket.IO ä¼šè½¬è€Œä½¿ç”¨ HTTP é•¿è½®è¯¢ã€‚ æœåŠ¡å™¨å‘é€äº‹ä»¶ (SSE)ï¼š SSE å…è®¸æµè§ˆå™¨è®¢é˜…æœåŠ¡å™¨ç”Ÿæˆçš„äº‹ä»¶æµï¼Œå¹¶åœ¨æ–°äº‹ä»¶å‘ç”Ÿæ—¶æ¥æ”¶æ›´æ–°ã€‚ EventSourceæ¥å£æ¥å—ç‰¹å®š URL å¤„çš„ HTTP æµè¿æ¥ï¼Œå¹¶åœ¨æ£€ç´¢å¯ç”¨æ•°æ®æ—¶ä¿æŒè¿æ¥æ‰“å¼€ã€‚ SSE å¬èµ·æ¥åƒæ˜¯ WebSocket çš„æœ‰åŠ›ç«äº‰å¯¹æ‰‹ï¼Œä½†å®ƒæ˜¯å•å‘çš„ã€‚ HTTP å…³é”®ç‰¹æ€§ æˆ‘ä»¬å·²ç»çœ‹åˆ°äº† HTTP çš„å¤šä¸ªæ–°ç‰ˆæœ¬ï¼Œæ¯ä¸ªç‰ˆæœ¬éƒ½æ·»åŠ äº†æ–°åŠŸèƒ½ã€‚\n**HTTP/1.1 (1997)ï¼š**å¼•å…¥äº†ä¸€äº›é‡è¦çš„å¢å¼ºåŠŸèƒ½ï¼Œæœ€æ˜¾ç€çš„æ˜¯Keep-Aliveæ ‡å¤´ï¼ˆå…è®¸è¿æ¥å¤„ç†å¤šä¸ªè¯·æ±‚ï¼‰å’ŒUpgradeæ ‡å¤´ï¼ˆå°†è¿æ¥å‡çº§åˆ°å¢å¼ºåè®®ï¼Œä¾‹å¦‚ WebSocketsï¼‰ã€‚ **HTTP/2 (2015)ï¼š**è¿™æ˜¯ä¸€é¡¹æ€§èƒ½æ›´æ–°ï¼Œæ—¨åœ¨æé«˜ Web é€šä¿¡çš„é€Ÿåº¦ã€‚ HTTP/2 åŒ…æ‹¬ï¼š å¤šè·¯å¤ç”¨ï¼Œæ¶‰åŠå¸§å†…çš„äºŒè¿›åˆ¶æ•°æ®å°è£…ï¼Œæ²¿ç€å¤šä¸ªç§°ä¸ºæµçš„åŒå‘é€šé“å‘é€ï¼Œå…¨éƒ¨é€šè¿‡å•ä¸ª TCP è¿æ¥ï¼Œå…è®¸åŒæ—¶å‘ç”Ÿè®¸å¤šå¹¶è¡Œè¯·æ±‚/å“åº”ã€‚ æœåŠ¡å™¨æ¨é€ï¼Œä¸€ç§å…è®¸æœåŠ¡å™¨åœ¨å®¢æˆ·ç«¯è¯·æ±‚å“åº”ä¹‹å‰å°†å“åº”å‘é€åˆ°å…¼å®¹ HTTP/2 çš„å®¢æˆ·ç«¯çš„åŠŸèƒ½ã€‚å½“æœåŠ¡å™¨çŸ¥é“å®¢æˆ·ç«¯éœ€è¦â€œæ¨é€â€å“åº”æ¥å®Œå…¨å¤„ç†åŸå§‹è¯·æ±‚æ—¶ï¼Œæ­¤åŠŸèƒ½éå¸¸æœ‰ç”¨ã€‚ **HTTP/3ï¼ˆè‡ª 2018 å¹´å¼€å§‹å¼€å‘ï¼‰ï¼š**æ—¨åœ¨ä½¿ç”¨ç§°ä¸º QUIC çš„ä¸åŒä¼ è¾“å±‚ç½‘ç»œåè®®è§£å†³ HTTP/2 çš„ä¼ è¾“ç›¸å…³é—®é¢˜ï¼ˆä¾‹å¦‚å»¶è¿Ÿï¼‰ï¼Œè¯¥åè®®åœ¨ç”¨æˆ·æ•°æ®æŠ¥åè®® (UDP) è€Œä¸æ˜¯ TCP ä¸Šè¿è¡Œã€‚ HTTP çš„ä¼˜ç‚¹å’Œç¼ºç‚¹ HTTP ä¼˜ç‚¹ï¼š **å¹³å°æ”¯æŒï¼š**æ¯ä¸ªæœåŠ¡å™¨ç«¯å¹³å°å’Œéæµè§ˆå™¨å®¢æˆ·ç«¯å¹³å°ï¼ˆæƒ³æƒ³ç”¨ Kotlin æ„å»ºçš„ Android å®¢æˆ·ç«¯ï¼Œæˆ–ç”¨ Rust æ„å»ºçš„æ¡Œé¢åº”ç”¨ç¨‹åºï¼‰éƒ½å…·æœ‰å‡ºè‰²çš„ HTTP æ”¯æŒã€‚å¦‚æœæ‚¨ä½¿ç”¨çš„å¹³å°å¯¹ Socket.IO ç­‰åº“æ²¡æœ‰è‰¯å¥½çš„æ”¯æŒï¼Œæ‚¨å¯èƒ½ä¼šé€‰æ‹©åœ¨æ ‡å‡† HTTP ä¹‹ä¸Šå®ç°è§£å†³æ–¹æ¡ˆã€‚ HTTP ç¼ºç‚¹ï¼š **è¿æ¥æ•ˆç‡ï¼š**å°½ç®¡ Keep-Alive æ ‡å¤´å’Œé•¿è½®è¯¢å…è®¸åœ¨æ¯ä¸ªè¿æ¥ä¸Šå‘é€å¤šä¸ªè¯·æ±‚ï¼Œä½†ä»ç„¶éœ€è¦å¤šä¸ªè¿æ¥ï¼Œå¹¶ä¸”å¼€é”€æ¯”åŸºäº WebSocket çš„è§£å†³æ–¹æ¡ˆï¼ˆå¦‚ Socket.IOï¼‰æ›´å¤§ã€‚è¿™ä¼šå¯¼è‡´å»¶è¿Ÿå¢åŠ å’Œç”¨æˆ·ä½“éªŒå˜å·®ã€‚ **å•å‘é€šä¿¡ï¼š**åœ¨æ ‡å‡† HTTP ä¸­ï¼Œæ‰€æœ‰è¯·æ±‚å‡ç”±å®¢æˆ·ç«¯å‘èµ·ï¼Œå“åº”ç”±æœåŠ¡å™¨å¤„ç†ã€‚ SSE æä¾›æ¥è‡ªæœåŠ¡å™¨çš„é€šä¿¡æµï¼Œä½†è¿™ä»ç„¶åªæ˜¯å•å‘çš„ã€‚ **ç¼ºä¹äº‹ä»¶é©±åŠ¨çš„é€šä¿¡ï¼š**å°½ç®¡ SSE å…è®¸åœ¨äº‹ä»¶å‘ç”Ÿæ—¶ä½¿ç”¨äº‹ä»¶æ¥å“åº”æ¥è‡ªæœåŠ¡å™¨çš„æ¶ˆæ¯ã€‚åœ¨æœåŠ¡å™¨ä¸Šç›‘å¬å’Œå“åº”æ¥è‡ªå®¢æˆ·ç«¯çš„æ¶ˆæ¯ä»ç„¶éœ€è¦è½®è¯¢æœºåˆ¶æ¥ä¸æ–­æ£€æŸ¥æ›´æ–°ï¼Œè¿™æ˜¯æµªè´¹ä¸”ä½æ•ˆçš„ã€‚ **æœ‰é™çš„åŠŸèƒ½é›†ï¼š**ä½¿ç”¨åŸå§‹ HTTP å°†è¦æ±‚æ‚¨è‡ªå·±å®ç°åº”ç”¨ç¨‹åºæ‰€éœ€çš„åŠŸèƒ½é›†ï¼Œæˆ–è€…æ‰¾åˆ°å…¶ä»–åº“æ¥å¸®åŠ©æ‚¨ã€‚ **æ— çŠ¶æ€ï¼š**æ¯æ¬¡é€šä¿¡å®Œæˆåï¼Œè¿æ¥å…³é—­ï¼ŒçŠ¶æ€ä¸¢å¤±ã€‚ Socket.IO å’Œ HTTP æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ ä¸‹è¡¨å¿«é€Ÿæ€»ç»“äº† Socket.IO å’Œ HTTP ä¹‹é—´çš„ä¸»è¦åŒºåˆ«ã€‚\nå¥—æ¥å­—IO HTTPåè®® è‰¯å¥½çš„æµè§ˆå™¨å…¼å®¹æ€§ï¼Œå¯å›é€€åˆ° HTTP é•¿è½®è¯¢ ä¼˜ç§€çš„æµè§ˆå™¨å…¼å®¹æ€§ æœåŠ¡å™¨ç«¯å¹³å°å…¼å®¹æ€§å’Œéæµè§ˆå™¨å®¢æˆ·ç«¯å…¼å®¹æ€§å°šå¯ï¼Œéƒ¨åˆ†åœ°æ–¹å­˜åœ¨å·®è· å‡ºè‰²çš„æœåŠ¡å™¨ç«¯å’Œéæµè§ˆå™¨å®¢æˆ·ç«¯å…¼å®¹æ€§ åŒå‘é€šè®¯ å•å‘é€šè®¯ äº‹ä»¶é©±åŠ¨çš„é€šä¿¡ éäº‹ä»¶é©±åŠ¨é€šä¿¡ï¼ˆä½¿ç”¨ SSEï¼Œäº‹ä»¶é©±åŠ¨é€šä¿¡ä»…é€‚ç”¨äºä»æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯ï¼‰ å‡ºè‰²çš„è¿æ¥æ•ˆç‡â€”â€”ä¸€æ—¦å»ºç«‹ï¼ŒWebSocket è¿æ¥çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸéƒ½éœ€è¦å•ä¸ª TCP è¿æ¥ è¿æ¥æ•ˆç‡è‰¯å¥½â€”â€”é€šä¿¡ç”Ÿå‘½å‘¨æœŸå†…éœ€è¦å¤šä¸ªè¿æ¥ æœ‰çŠ¶æ€çš„ æ— å›½ç± ä¸°å¯Œçš„åŠŸèƒ½é›† åŠŸèƒ½éœ€è¦è‡ªè¡Œå®ç° æˆ‘åº”è¯¥ä½¿ç”¨ Socket.IO è¿˜æ˜¯ HTTPï¼Ÿ è¿™å–å†³äºæ‚¨çš„ç”¨ä¾‹ï¼›åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ç ”ç©¶ä¸¤è€…çš„åˆé€‚ç”¨ä¾‹ã€‚\nä½•æ—¶ä½¿ç”¨ Socket.IO Socket.IO éå¸¸é€‚åˆæ„å»ºæ¶‰åŠå¤šä¸ªç”¨æˆ·å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ¶ˆæ¯äº¤æ¢çš„ä»»ä½•åº”ç”¨ç¨‹åºï¼Œæ‚¨å¸Œæœ›åœ¨å…¶ä¸­ç»´æŠ¤æ•´ä½“çŠ¶æ€å¹¶å¸Œæœ›è·å¾—å“åº”å¼åŒå‘å®æ—¶ç”¨æˆ·ä½“éªŒã€‚ç¤ºä¾‹åŒ…æ‹¬èŠå¤©/æ¶ˆæ¯åº”ç”¨ç¨‹åºã€å¤šç”¨æˆ·æ¸¸æˆã€åä½œç¼–è¾‘ï¼ˆä¾‹å¦‚ Google æ–‡æ¡£ï¼‰ã€åŸºäºä½ç½®çš„åº”ç”¨ç¨‹åºç­‰ã€‚\nSocket.IO å…·æœ‰è‰¯å¥½çš„è·¨æµè§ˆå™¨å…¼å®¹æ€§ï¼Œä½†å…¶å¯¹ä¸åŒå¹³å°ï¼ˆå³é JavaScript/Node.jsï¼‰çš„æ”¯æŒå¯èƒ½å‚å·®ä¸é½ã€‚å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯è‰¯å¥½æ”¯æŒçš„å®¢æˆ·ç«¯/æœåŠ¡å™¨ç»„åˆï¼Œå¹¶ä¸”æ‚¨ä¸å…³å¿ƒæ”¯æŒæ—§ç‰ˆæµè§ˆå™¨ï¼Œé‚£ä¹ˆ Socket.IO å°±å¯ä»¥äº†ã€‚å¦‚æœæ‚¨éœ€è¦æ›¿ä»£æ–¹æ¡ˆï¼Œè¯·é˜…è¯»æˆ‘ä»¬çš„Socket.IO æ›¿ä»£æ–¹æ¡ˆæ–‡ç« ä»¥è·å–é€‰é¡¹ã€‚\nä½•æ—¶ä½¿ç”¨ HTTP HTTP éå¸¸é€‚åˆå¤šç”¨æˆ·åº”ç”¨ç¨‹åºï¼Œåœ¨è¿™äº›åº”ç”¨ç¨‹åºä¸­ï¼Œæ‚¨ä¸éœ€è¦ä¸¤ä¸ªæ–¹å‘çš„å®æ—¶å“åº”ï¼Œä½†æ‚¨ä»ç„¶å…³å¿ƒæ¯ä¸ªå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å¯é ã€å®‰å…¨çš„æ•°æ®äº¤æ¢ã€‚æƒ³æƒ³ä¼ ç»Ÿçš„ REST/CRUD åº”ç”¨ç¨‹åºâ€”â€”é“¶è¡Œåº”ç”¨ç¨‹åºã€ç”µå­é‚®ä»¶åº”ç”¨ç¨‹åºã€å¤©æ°”åº”ç”¨ç¨‹åºå’Œç”µå­å•†åŠ¡åº”ç”¨ç¨‹åºã€‚\nå¦‚æœæ‚¨æƒ³è¦å®æ—¶å“åº”ï¼Œä½†ä»…é™äºä»æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯ï¼Œé‚£ä¹ˆ SSE æ˜¯ä¸€ä¸ªå¯è¡Œçš„è§£å†³æ–¹æ¡ˆã€‚ SSE å¯¹äºæä¾›å®æ—¶ä¿¡æ¯æ›´æ–°çš„åº”ç”¨ç¨‹åºå¾ˆæœ‰ç”¨ï¼Œä½†ç”¨æˆ·åªæ˜¯æ¶ˆè´¹æ•°æ®ï¼Œè€Œä¸æ˜¯å†™å…¥æ•°æ®ã€‚å¾ˆå¥½çš„ä¾‹å­å¯èƒ½åŒ…æ‹¬è‚¡ç¥¨è¡Œæƒ…æˆ–æ–°é—»è¡Œæƒ…åº”ç”¨ç¨‹åºã€‚\nHTTP æ˜¯ä¸€é¡¹éå¸¸æˆç†Ÿçš„æŠ€æœ¯ï¼Œå¯¹ Web æµè§ˆå™¨ã€æœåŠ¡å™¨å¹³å°å’Œéæµè§ˆå™¨å®¢æˆ·ç«¯ç±»å‹æä¾›å¤§åŠ›æ”¯æŒã€‚å¦‚æœæ‚¨æ‹…å¿ƒå¯¹ Socket.IO ç­‰åº“çš„æ”¯æŒä¸å®Œæ•´ï¼Œè¯·è€ƒè™‘ä½¿ç”¨åŸå§‹ HTTP æ„å»ºæ‚¨çš„åº”ç”¨ç¨‹åºã€‚\næ€»ä½“è€Œè¨€ï¼ŒSocket.IO å’Œ HTTP å“ªä¸ªæ›´å¥½ï¼Ÿ æ‚¨åº”è¯¥ä½¿ç”¨ Socket.IO è¿˜æ˜¯ HTTP å–å†³äºæ‚¨çš„ç”¨ä¾‹ã€‚ Socket.IO ç­‰åŸºäº WebSocket çš„è§£å†³æ–¹æ¡ˆå¯¹äºæ„å»ºå…·æœ‰ä½å»¶è¿Ÿã€é«˜æ•ˆè¿æ¥å’Œé«˜æ€§èƒ½è¦æ±‚çš„å®æ—¶åº”ç”¨ç¨‹åºè‡³å…³é‡è¦ã€‚ç„¶è€Œï¼Œå½“æ¶‰åŠåˆ°å¹³å°å…¼å®¹æ€§å’Œå¯æ‰©å±•æ€§æ—¶ï¼ŒSocket.IO å¯èƒ½ä¼šä¸‹é™â€”â€”å¦‚æœè¿™äº›å‡ºç°é—®é¢˜ï¼ŒHTTP å¯èƒ½æ˜¯æ›´å¥½çš„æ–¹æ³•ã€‚\nAbly æ˜¯ Socket.IO çš„æ›¿ä»£å“ï¼Œå…·æœ‰å¼ºå¤§çš„å‘å¸ƒ/è®¢é˜…æ¶ˆæ¯ä¼ é€’ã€é’ˆå¯¹æ¯ç§ä¸»è¦è¯­è¨€å’Œå¼€å‘å¹³å°çš„è¶…è¿‡ 25 ä¸ª SDKã€å¯ç”¨çš„ä¸“é—¨ä¸“å®¶æ”¯æŒç­‰ç­‰ã€‚æœ‰å…³è¯¦ç»†æ¯”è¾ƒï¼Œè¯·å‚é˜…Ably ä¸ Socket.IOã€‚å€ŸåŠ©å¯ç”¨çš„ WebSocket å’Œ REST åº“ï¼Œæ‚¨å¯ä»¥è½»æ¾é›†æˆã€‚\n","permalink":"https://blog.chensoul.cc/posts/2024/05/08/socketio-vs-http/","summary":"åŸæ–‡é“¾æ¥ï¼šhttps://ably.com/topic/socketio-vs-http\nåœ¨è§„åˆ’å®æ—¶åº”ç”¨ç¨‹åºæ—¶ï¼Œæ‚¨åº”è¯¥ä»”ç»†è€ƒè™‘è¦ä½¿ç”¨å“ªäº›æŠ€æœ¯ã€‚æœ¬æ–‡å¯¹Socket.IOå®æ—¶åº“å’ŒHTTPåè®®è¿›è¡Œäº†æ¯”è¾ƒã€‚ä¸‹é¢æ‚¨å°†äº†è§£æ¯ç§è§£å†³æ–¹æ¡ˆçš„åŠŸèƒ½ã€æ¯ç§è§£å†³æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹ä»¥åŠä½•æ—¶ä½¿ç”¨å®ƒä»¬ã€‚\nä»€ä¹ˆæ˜¯Socket.IOï¼Ÿ Socket.IO æ˜¯ä¸€ä¸ªåˆ›å»ºäº 2010 å¹´çš„åº“ï¼Œæä¾›å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„å®æ—¶åŒå‘é€šä¿¡ã€‚å®ƒå…è®¸ç®¡ç†è¿æ¥ã€å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ç­‰ç­‰ã€‚è¿™ä½¿å¾— Socket.IO æˆä¸ºæ„å»ºæ¶ˆæ¯/èŠå¤©åº”ç”¨ç¨‹åºçš„ç†æƒ³é€‰æ‹©ã€‚\nSocket.IO éœ€è¦ä¸¤ä¸ªåº“ - ä¸€ä¸ªåœ¨æœåŠ¡å™¨ä¸Šï¼Œä¸€ä¸ªåœ¨å®¢æˆ·ç«¯ä¸Šã€‚ Socket.IO åˆ›å»ºè€…ç»´æŠ¤ä»¥ä¸‹â€œå®˜æ–¹â€ï¼š\nSocket.IOæ˜¯ Node.js æœåŠ¡å™¨ç»„ä»¶ã€‚ Socket.IO-clientæ˜¯å®¢æˆ·ç«¯ JavaScript åº“ã€‚ ä¸€äº› Socket.IO å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å®ç°å¯ä»¥ç”¨å…¶ä»–è¯­è¨€å®ç°ã€‚è¯·é˜…è¯»Socket.IO æ˜¯ä»€ä¹ˆæ¥è·å–åˆ—è¡¨ã€‚\nä¸‹å›¾æ€»ç»“äº†å…¸å‹çš„ Socket.IO è®¾ç½®ï¼š\nSocket.IO ä¸»è¦ç‰¹æ€§ Socket.IO å…·æœ‰ä»¥ä¸‹ä¸»è¦ç‰¹æ€§ï¼š\n**å‘åå…¼å®¹æ€§ï¼š**åœ¨ç°ä»£æµè§ˆå™¨ä¸­ï¼ŒSocket.IO ä½¿ç”¨WebSocket APIæä¾›æ‰€éœ€çš„è¿æ¥å¹¶å‘é€æ¶ˆæ¯ã€‚ WebSocket åœ¨æœåŠ¡å™¨å’Œæµè§ˆå™¨ä¹‹é—´æä¾›å…¨åŒå·¥ã€ä½å»¶è¿Ÿã€äº‹ä»¶é©±åŠ¨çš„è¿æ¥ã€‚å®ƒä¹Ÿæ˜¯æœ‰çŠ¶æ€çš„ã€‚å¦‚æœéœ€è¦æ—§ç‰ˆæµè§ˆå™¨æ”¯æŒï¼Œæˆ–è€… WebSocket è¿æ¥æ— æ³•ä½¿ç”¨ï¼ˆç”±äºé˜²ç«å¢™æˆ–å…¬å¸ä»£ç†ï¼‰ï¼ŒSocket.IO å¯ä»¥å›é€€åˆ° HTTP å’Œé•¿è½®è¯¢ã€‚ é‡è¿å’Œç¼“å†²ï¼š Socket.IOæä¾›è‡ªåŠ¨é‡è¿åŠŸèƒ½ã€‚å½“å®¢æˆ·ç«¯æ–­å¼€è¿æ¥æ—¶ï¼Œæ•°æ®åŒ…ä¼šè‡ªåŠ¨ç¼“å†²ï¼Œå¹¶åœ¨é‡æ–°è¿æ¥æ—¶å‘é€ã€‚ å¤šç§æ•°æ®æ ¼å¼ï¼š Socket.IO æ”¯æŒä»»ä½•å¯åºåˆ—åŒ–æ ¼å¼çš„æ•°æ®ä¼ è¾“ï¼ŒåŒ…æ‹¬Bufferæˆ–TypedArrayç­‰äºŒè¿›åˆ¶å¯¹è±¡ã€‚ **è‡´è°¢ï¼š**ä½¿ç”¨ Socket.IOï¼Œä¸€æ—¦æˆåŠŸæ¥æ”¶åˆ°æ¶ˆæ¯å°±å¯ä»¥å‘é€å“åº”æ¶ˆæ¯ã€‚ å‘½åç©ºé—´ï¼š Socket.IO ä½¿æ‚¨èƒ½å¤Ÿè®¾ç½®å…·æœ‰ä¸åŒå®¢æˆ·ç«¯ã€æˆ¿é—´ã€äº‹ä»¶å’Œåº”ç”¨ç¨‹åºé€»è¾‘çš„ä¸åŒé€šé“ã€‚ **å¹¿æ’­åˆ°ä¸åŒçš„å®¢æˆ·ç«¯ç»„ï¼š**ä»æœåŠ¡å™¨ï¼Œæ‚¨å¯ä»¥å‘æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯æˆ–å­é›†å‘é€æ¶ˆæ¯ã€‚ Socket.IO çš„ä¼˜ç¼ºç‚¹ Socket.IO ä¸“ä¸šäººå£« è¿æ¥æ•ˆç‡ï¼š Socket.IO ä½¿ç”¨ HTTP é•¿è½®è¯¢å‘èµ·è¿æ¥ï¼Œä¸€æ—¦å»ºç«‹å¯ç”¨æ€§å°±å‡çº§åˆ° WebSocketï¼ˆæœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…å‡çº§æœºåˆ¶ï¼‰ã€‚å½“å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œå®¢æˆ·ç«¯-æœåŠ¡å™¨è¿æ¥ä½¿ç”¨å•ä¸ª WebSocketï¼Œè€Œä¸å¿…å¯åŠ¨å¤šä¸ªè¿æ¥ï¼Œä»è€Œå‡å°‘å»¶è¿Ÿå¹¶æ”¹å–„ç”¨æˆ·ä½“éªŒã€‚ **å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å‘èµ·çš„é€šä¿¡ï¼š**ç”±äºWebSocketæä¾›äº†å…¨åŒå·¥ã€åŒå‘çš„é€šä¿¡é€šé“ï¼Œå› æ­¤æœåŠ¡å™¨å¯ä»¥å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼Œå¹¶ä¸”ä¸¤è€…å¯ä»¥åŒæ—¶å‘é€æ¶ˆæ¯ã€‚ äº‹ä»¶é©±åŠ¨çš„é€šä¿¡ï¼š WebSocketæ˜¯ä¸€ç§äº‹ä»¶é©±åŠ¨çš„åè®®ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥åœ¨æ”¶åˆ°æ¶ˆæ¯åç«‹å³ç›‘å¬å¹¶å“åº”æ¶ˆæ¯ï¼Œè€Œä¸æ˜¯ä½¿ç”¨è½®è¯¢æœºåˆ¶æ¥æ£€æŸ¥æ›´æ–°ï¼Œè¿™æ ·æ—¢æµªè´¹åˆä½æ•ˆã€‚ ä¸°å¯Œçš„åŠŸèƒ½é›†ï¼š Socket.IO æä¾›äº†å®ç°å®æ—¶åº”ç”¨ç¨‹åºæ‰€éœ€çš„ä¸€åˆ‡ã€‚å½“ä½¿ç”¨åŸå§‹ HTTP ç”šè‡³åŸå§‹ WebSocket æ—¶ï¼Œæ‚¨å¿…é¡»è‡ªå·±å®ç°å…¶ä¸­å¤§éƒ¨åˆ†åŠŸèƒ½ã€‚ æœ‰çŠ¶æ€ï¼š Socket.IO ä½¿ç”¨ WebSocketï¼Œå®ƒæ˜¯æœ‰çŠ¶æ€çš„ã€‚è¯¥çŠ¶æ€ä¸€ç›´æŒç»­åˆ°è¿æ¥å…³é—­ä¸ºæ­¢ã€‚ Socket.IO ç¼ºç‚¹ **æœ‰é™çš„å¹³å°æ”¯æŒï¼š**æˆ‘ä»¬ä¹‹å‰æåˆ°ï¼ŒSocket.IO åœ¨ä¸åŒçš„å¹³å°å’Œè¯­è¨€ä¸Šæœ‰å¤šç§æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å®ç°ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå…¶ä¸­ä¸€äº›æ²¡æœ‰å¾—åˆ°ç§¯æç»´æŠ¤ï¼Œæˆ–è€…åŠŸèƒ½é›†æœ‰é™ï¼Œå› æ­¤åœ¨è€ƒè™‘ä½¿ç”¨å®ƒä»¬ä¹‹å‰è¯·ä»”ç»†æ£€æŸ¥å®ƒä»¬ã€‚æ­¤å¤–ï¼ŒSocket.IO å®ç°ä¸æœ¬æœº WebSocket ä¸å…¼å®¹ï¼Œå› ä¸º Socket.IO ä¼šå‘å…¶å‘é€çš„æ¯ä¸ªæ•°æ®åŒ…æ·»åŠ é¢å¤–çš„å…ƒæ•°æ®ã€‚ å¯æ‰©å±•æ€§ï¼š Socket.IO éå¸¸é€‚åˆæœ‰é™æ•°é‡ç”¨æˆ·çš„å®æ—¶é€šä¿¡åº”ç”¨ç¨‹åºã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨çš„ç”¨æˆ·æ•°é‡å’Œæ•°æ®é‡å¼€å§‹å˜å¤§ï¼Œæ‚¨çš„æœåŠ¡å™¨å¯èƒ½ä¼šè¿‡è½½ã€‚å½“æ‚¨çš„æœåŠ¡å™¨è¾¾åˆ°æœ€å¤§è´Ÿè½½æ—¶ï¼Œæ‚¨å°†éœ€è¦å°†è¿æ¥æ‹†åˆ†åˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œå¦åˆ™å¯èƒ½ä¼šä¸¢å¤±é‡è¦ä¿¡æ¯ã€‚è¿™ç§å¢åŠ çš„æ¶æ„å¤æ‚æ€§å¸¦æ¥äº†æ›´å¤šé—®é¢˜ã€‚é˜…è¯»Scaling Socket.IO - å®é™…æ³¨æ„äº‹é¡¹ä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚ **å†…å­˜æ³„æ¼ï¼š**å·²çŸ¥ Socket.IO å­˜åœ¨ä¸€äº›ä¸å†…å­˜æ³„æ¼ç›¸å…³çš„é—®é¢˜ã€‚å†…å­˜æ³„æ¼ä¸å¤ªå¯èƒ½å¯¼è‡´ä»»ä½•ç›´æ¥é—®é¢˜ï¼Œä½†å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºä½¿ç”¨äº†å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œå®ƒä»¬æœ€ç»ˆå¯èƒ½ä¼šå¯¼è‡´ç”¨æˆ·çš„è®¾å¤‡å†»ç»“æˆ–å´©æºƒã€‚ ä»€ä¹ˆæ˜¯ HTTPï¼Ÿ HTTP æ˜¯ä¸€ç§è¯·æ±‚/å“åº”åè®®ï¼Œä½œä¸º Web çš„ä¸»è¦é€šä¿¡æœºåˆ¶ï¼Œæ„å»ºåœ¨ TCP ç½‘ç»œåè®®ä¹‹ä¸Šã€‚æœ‰é™ç‰ˆæœ¬æœ€åˆç”± Tim Berners-Lee äº 1989 å¹´æå‡ºï¼Œéšåç»è¿‡å¿«é€Ÿä¿®æ”¹ä»¥æ”¯æŒæ›´å¹¿æ³›çš„æµè§ˆå™¨å’ŒæœåŠ¡å™¨åŠŸèƒ½ã€‚ HTTP å·¥ä½œç»„äº 1996 å¹´å°†è¿™äº›ä¿®æ”¹è®°å½•ä¸º HTTP/1.","title":"[è¯‘]æ¯”è¾ƒ Socket.IO å’Œ HTTPï¼šä¸»è¦åŒºåˆ«å’Œç”¨ä¾‹"},{"content":"åŸæ–‡é“¾æ¥ï¼šhttps://www.pubnub.com/guides/http/\nHTTP æ¦‚è¿° HTTPï¼Œå³è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œæ˜¯äº’è”ç½‘é€šä¿¡çš„åŸºç¡€ã€‚å®ƒåœ¨å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å‹ä¸Šè¿è¡Œï¼Œå…¶ä¸­å‰ç«¯å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ç½‘ç»œæµè§ˆå™¨ï¼‰é€šè¿‡å‘æœåŠ¡å™¨å‘é€HTTPè¯·æ±‚æ¶ˆæ¯æ¥å‘èµ·è¯·æ±‚ï¼Œä¾‹å¦‚è¯·æ±‚ç½‘é¡µï¼ˆä¾‹å¦‚æœç´¢å¼•æ“ï¼‰ã€‚ç„¶åï¼ŒæœåŠ¡å™¨ä½¿ç”¨åŒ…å«æ‰€è¯·æ±‚èµ„æºçš„ HTTP å“åº”æ¶ˆæ¯è¿›è¡Œå“åº”ï¼Œå¦‚æœèµ„æºä¸å¯ç”¨ï¼Œåˆ™ä½¿ç”¨é”™è¯¯æ¶ˆæ¯è¿›è¡Œå“åº”ã€‚\nHTTP æ˜¯ä¸€ç§æ— çŠ¶æ€åè®®ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªè¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¹‹å‰æˆ–å°†æ¥çš„è¯·æ±‚æ— å…³ã€‚è¿™å…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œæœ‰æ•ˆçš„é€šä¿¡ã€‚\nHTTP äº 1991 å¹´é¦–æ¬¡å¼•å…¥ï¼Œä½œä¸º Tim Berners-Lee åˆ›å»ºçš„ä¸‡ç»´ç½‘é¡¹ç›®çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ç”±äº’è”ç½‘å·¥ç¨‹ä»»åŠ¡ç»„ (IETF)è¿›è¡Œæ ‡å‡†åŒ–ã€‚ IETF è´Ÿè´£å¼€å‘å’Œç»´æŠ¤ HTTPã€TCP/IPã€DNS ç­‰åè®®ï¼Œä»¥åŠä»–ä»¬åœ¨ RFC æˆ–â€œå¾æ±‚æ„è§â€ä¸­è®°å½•çš„è®¸å¤šå…¶ä»–åè®®ã€‚\næ—©æœŸï¼Œéœ€è¦ä¸€ç§æ ‡å‡†åŒ–åè®®æ¥ä¿ƒè¿›ä¸åŒè®¡ç®—æœºå’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ã€‚è¿™å¯¼è‡´äº†å„ç§åè®®çš„å‘å±•ï¼ŒåŒ…æ‹¬ HTTPã€‚\nHTTP 0.9ï¼Œè¯¥åè®®çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œæ˜¯ä¸€ä¸ªç®€å•ä¸”æœ‰é™çš„ç³»ç»Ÿï¼Œä»…æ”¯æŒè¶…æ–‡æœ¬æ–‡æ¡£çš„æ£€ç´¢ã€‚å®ƒä¸æ”¯æŒæ ‡å¤´ï¼Œåªå…è®¸ä¼ è¾“çº¯æ–‡æœ¬æ•°æ®ã€‚\n1996 å¹´ï¼ŒHTTP 1.0 å‘å¸ƒï¼Œå¼•å…¥äº†è‡³ä»Šä»åœ¨ä½¿ç”¨çš„å‡ ä¸ªé‡è¦åŠŸèƒ½ã€‚å®ƒå¢åŠ äº†å¯¹å¤šç§åª’ä½“ç±»å‹çš„æ”¯æŒï¼Œå…è®¸ä¼ è¾“å›¾åƒã€è§†é¢‘å’Œå…¶ä»–æ–‡ä»¶æ ¼å¼ã€‚å®ƒè¿˜å¼•å…¥äº†ä½¿ç”¨æ ‡å¤´æ¥å®ç°æ›´é«˜çº§çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ç¼“å­˜å’Œèº«ä»½éªŒè¯ã€‚\n1999 å¹´å‘å¸ƒçš„ HTTP 1.1 è¿›ä¸€æ­¥æ”¹è¿›äº†è¯¥åè®®ã€‚å®ƒå¼•å…¥äº†æŒä¹…è¿æ¥ï¼Œå…è®¸é€šè¿‡å•ä¸ª TCP è¿æ¥å‘é€å¤šä¸ªè¯·æ±‚å’Œå“åº”ã€‚è¿™æå¤§åœ°æé«˜äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´é€šä¿¡çš„æ•ˆç‡å’Œé€Ÿåº¦ã€‚\nè¿‘å¹´æ¥ï¼Œäººä»¬è‡´åŠ›äºå¢å¼ºå’Œä¼˜åŒ–HTTPåè®®ã€‚è¿™å¯¼è‡´äº†HTTP/2çš„å¼€å‘ï¼Œå¹¶äº 2015 å¹´å‘å¸ƒã€‚HTTP/2 å¸¦æ¥äº†å¤šé¡¹æ”¹è¿›ï¼ŒåŒ…æ‹¬å¤šè·¯å¤ç”¨ã€æ ‡å¤´å‹ç¼©å’ŒæœåŠ¡å™¨æ¨é€ï¼Œä»¥å‡å°‘å»¶è¿Ÿå¹¶æé«˜æ€§èƒ½ã€‚\næœ€åæ˜¯ HTTP/3ã€‚HTTP/3ä¹Ÿç§°ä¸º HTTP over QUICï¼ˆå¿«é€Ÿ UDP Internet è¿æ¥ï¼‰ï¼Œæ˜¯æœ€æ–°çš„ HTTP åè®®ç‰ˆæœ¬ï¼Œæ—¨åœ¨è§£å†³ä»¥å‰ç‰ˆæœ¬çš„ä¸€äº›é™åˆ¶å¹¶æé«˜æ€§èƒ½ã€‚\nHTTP/3 æ„å»ºåœ¨ QUIC ä¼ è¾“åè®®ä¹‹ä¸Šï¼Œè¯¥åè®®ä½¿ç”¨ç”¨æˆ·æ•°æ®æŠ¥åè®® (UDP)è€Œä¸æ˜¯ TCPã€‚ä¸ TCP ç›¸æ¯”ï¼ŒUDP å…·æœ‰å¤šç§ä¼˜åŠ¿ï¼Œä¾‹å¦‚å‡å°‘å»¶è¿Ÿå’Œæ”¹è¿›æ‹¥å¡æ§åˆ¶ã€‚ HTTP/3 ä½¿ç”¨ UDPï¼Œæ—¨åœ¨æä¾›æ›´å¿«ã€æ›´å¯é ã€æ›´å®‰å…¨çš„è¿æ¥ã€‚\nHTTP/3 çš„å…³é”®ç‰¹æ€§ä¹‹ä¸€æ˜¯å®ƒæ”¯æŒå¤šè·¯å¤ç”¨å’Œæµå¤šè·¯å¤ç”¨çš„èƒ½åŠ›ã€‚è¿™å…è®¸é€šè¿‡å•ä¸ªè¿æ¥åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚å’Œå“åº”ï¼Œä»è€Œæé«˜æ•ˆç‡å¹¶å‡å°‘å»¶è¿Ÿã€‚æ­¤å¤–ï¼ŒHTTP/3 è¿˜åŒ…å«é›¶ RTT è¿æ¥å»ºç«‹ã€æ”¹è¿›çš„æ‹¥å¡æ§åˆ¶ä»¥åŠé€šè¿‡åŠ å¯†æé«˜å®‰å…¨æ€§ç­‰åŠŸèƒ½ã€‚\nHTTP å’ŒæœåŠ¡å™¨ æœåŠ¡å™¨å¯¹äºå¤„ç† HTTP è¯·æ±‚å’Œæä¾›ç›¸åº”çš„å“åº”è‡³å…³é‡è¦ã€‚ä»¥ä¸‹æ˜¯HTTPä¸æœåŠ¡å™¨å…³ç³»çš„å‡ ä¸ªè¦ç‚¹ï¼š\nè¯·æ±‚-å“åº”æ¨¡å‹ï¼šå¦‚å‰æ‰€è¿°ï¼ŒHTTP éµå¾ªè¯·æ±‚-å“åº”æ¨¡å‹ã€‚å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ HTTP è¯·æ±‚ï¼ŒæŒ‡å®šæ‰€éœ€çš„æ“ä½œï¼Œä¾‹å¦‚æ£€ç´¢ç½‘é¡µæˆ–æäº¤è¡¨å•æ•°æ®ã€‚æœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶å‘å› HTTP å“åº”ï¼Œå…¶ä¸­åŒ…æ‹¬çŠ¶æ€ä»£ç ã€æ ‡å¤´å’Œè¯·æ±‚çš„å†…å®¹ï¼ˆå¦‚æœé€‚ç”¨ï¼‰ã€‚ Web æœåŠ¡å™¨ï¼šWeb æœåŠ¡å™¨æ˜¯å¤„ç† HTTP è¯·æ±‚çš„è½¯ä»¶åº”ç”¨ç¨‹åºæˆ–ç¨‹åºã€‚å®ƒä»¬ä¾¦å¬ç‰¹å®šç½‘ç»œç«¯å£ï¼ˆé€šå¸¸ä¸º HTTP çš„ç«¯å£ 80ï¼‰ä¸Šçš„ä¼ å…¥è¯·æ±‚ï¼Œå¹¶å°†å®ƒä»¬è·¯ç”±åˆ°é€‚å½“çš„èµ„æºæˆ–åº”ç”¨ç¨‹åºã€‚æµè¡Œçš„ Web æœåŠ¡å™¨è½¯ä»¶åŒ…æ‹¬ Apacheã€Nginxå’Œ Microsoft IISã€‚ è·¯ç”±å’Œèµ„æºå¤„ç†ï¼šåœ¨ HTTP æœåŠ¡å™¨ä¸­ï¼Œè·¯ç”±ç¡®å®šä¼ å…¥è¯·æ±‚å¦‚ä½•æ˜ å°„åˆ°ç‰¹å®šèµ„æºæˆ–ç«¯ç‚¹å¤„ç†ç¨‹åºã€‚ä¾‹å¦‚ï¼Œå½“æ¥æ”¶åˆ°é’ˆå¯¹ç‰¹å®š URL æˆ–è·¯å¾„çš„è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ä½¿ç”¨è·¯ç”±è§„åˆ™æ¥ç¡®å®šå“ªä¸ªä»£ç æˆ–èµ„æºåº”å¤„ç†è¯¥è¯·æ±‚å¹¶ç”Ÿæˆé€‚å½“çš„å“åº”ã€‚ å¤„ç†å’Œç”Ÿæˆå“åº”ï¼šå½“ HTTP è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨æ—¶ï¼Œå®ƒä¼šè§¦å‘ä¸æ‰€è¯·æ±‚çš„èµ„æºå…³è”çš„ä»£ç æˆ–èµ„æºå¤„ç†ç¨‹åºçš„æ‰§è¡Œã€‚è¿™äº›å¤„ç†ç¨‹åºå¯ä»¥ä»æ•°æ®åº“æ£€ç´¢æ•°æ®ã€ä¸å¤–éƒ¨æœåŠ¡äº¤äº’æˆ–ç”ŸæˆåŠ¨æ€å†…å®¹ã€‚æœåŠ¡å™¨æ ¹æ®è¯·æ±‚å¤„ç†è¿™äº›æ•°æ®ï¼Œå¹¶ç”Ÿæˆå¸¦æœ‰å¿…è¦æ ‡å¤´å’Œå†…å®¹çš„ HTTP å“åº”ã€‚ çŠ¶æ€ä»£ç ï¼šHTTP å“åº”åŒ…æ‹¬æŒ‡ç¤ºè¯·æ±‚ç»“æœçš„çŠ¶æ€ä»£ç ã€‚è¿™äº›çŠ¶æ€ä»£ç çš„èŒƒå›´ä»ä¿¡æ¯æ€§ (1xx) åˆ°æˆåŠŸ (2xx)ã€é‡å®šå‘ (3xx)ã€å®¢æˆ·ç«¯é”™è¯¯ (4xx) å’ŒæœåŠ¡å™¨é”™è¯¯ (5xx)ã€‚å¸¸è§çŠ¶æ€ä»£ç åŒ…æ‹¬ 200ï¼ˆæ­£å¸¸ï¼‰ã€404ï¼ˆæœªæ‰¾åˆ°ï¼‰å’Œ 500ï¼ˆå†…éƒ¨æœåŠ¡å™¨é”™è¯¯ï¼‰ã€‚ æ— çŠ¶æ€ï¼šHTTP æ˜¯ä¸€ç§æ— çŠ¶æ€åè®®ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªè¯·æ±‚/å“åº”äº¤äº’éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå¹¶ä¸”ä¸ä¿ç•™æœ‰å…³å…ˆå‰è¯·æ±‚çš„ä¿¡æ¯ã€‚ä¸ºäº†ç»´æŠ¤ç”¨æˆ·ä¼šè¯æˆ–è·Ÿè¸ªç”¨æˆ·äº¤äº’ï¼ŒæœåŠ¡å™¨é€šå¸¸ä½¿ç”¨ cookie æˆ–ä¼šè¯ç®¡ç†æŠ€æœ¯ã€‚ HTTP æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ å½“å®¢æˆ·ç«¯æƒ³è¦ä»æœåŠ¡å™¨æ£€ç´¢ç½‘é¡µæˆ–æ–°èµ„æºæ—¶ï¼Œå®ƒä¼šå‘èµ· HTTP è¯·æ±‚ã€‚è¯¥è¯·æ±‚ç”±å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š\nè¯·æ±‚æ–¹æ³•ï¼šå®¢æˆ·ç«¯æŒ‡å®šå®ƒå¸Œæœ›æœåŠ¡å™¨æ‰§è¡Œçš„æ‰€éœ€æ“ä½œã€‚æœ€å¸¸è§çš„æ–¹æ³•æ˜¯â€œGETâ€ï¼Œå®ƒæ£€ç´¢èµ„æºï¼Œä½†â€œPOSTâ€ã€â€œPUTâ€å’Œâ€œDELETEâ€ç­‰å…¶ä»–æ–¹æ³•ä¹Ÿç”¨äºå„ç§ç›®çš„ã€‚ URLï¼ˆç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼‰ï¼šURLæ ‡è¯†å®¢æˆ·ç«¯æƒ³è¦è®¿é—®çš„ç‰¹å®šèµ„æºã€‚å®ƒåŒ…æ‹¬åè®® (HTTP)ã€æœåŠ¡å™¨çš„åŸŸåæˆ– IP åœ°å€ä»¥åŠæœåŠ¡å™¨ä¸Šèµ„æºçš„è·¯å¾„ã€‚ æ ‡å¤´ï¼šHTTP æ ‡å¤´å­—æ®µæä¾›æœ‰å…³è¯·æ±‚å’Œå®¢æˆ·ç«¯çš„é™„åŠ ä¿¡æ¯ã€‚å®ƒä»¬å¯ä»¥åŒ…æ‹¬ç”¨æˆ·ä»£ç†ï¼ˆå‘å‡ºè¯·æ±‚çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼‰ã€æ¥å—çš„å†…å®¹ç±»å‹å’Œ cookie ç­‰ä¿¡æ¯ã€‚ä¸€ä¸ªå¸¸è§çš„ä¾‹å­æ˜¯å†…å®¹é•¿åº¦ã€‚ Content-Length æŒ‡å®šè¯·æ±‚æˆ–å“åº”ä¸­çš„æ¶ˆæ¯æ­£æ–‡å¤§å°ã€‚å®ƒæŒ‡ç¤º HTTP æ¶ˆæ¯ä¸­åŒ…å«çš„å®ä½“ä¸»ä½“æˆ–æœ‰æ•ˆè´Ÿè½½çš„é•¿åº¦ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚ æ­£æ–‡ï¼ˆå¯é€‰ï¼‰ï¼šæŸäº›è¯·æ±‚å¯èƒ½åŒ…å«åŒ…å«é™„åŠ æ•°æ®çš„æ­£æ–‡ï¼Œé€šå¸¸ä¸â€œPOSTâ€æˆ–â€œPUTâ€ç­‰æ–¹æ³•ä¸€èµ·ä½¿ç”¨ä»¥å°†æ•°æ®å‘é€åˆ°æœåŠ¡å™¨ã€‚ ä¸€æ—¦å®¢æˆ·ç«¯å‘é€ HTTP è¯·æ±‚ï¼Œå®ƒå°±ä¼šåˆ°è¾¾æœåŠ¡å™¨ã€‚æœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶ç”Ÿæˆé€‚å½“çš„å“åº”ã€‚ HTTP å“åº”ä¹Ÿç”±å‡ ä¸ªç»„ä»¶ç»„æˆï¼š\nçŠ¶æ€è¡Œï¼šè¯¥è¡ŒåŒ…æ‹¬ HTTP ç‰ˆæœ¬ã€ä¸‰ä½æ•°çŠ¶æ€ä»£ç å’Œç›¸åº”çš„çŠ¶æ€æ¶ˆæ¯ã€‚çŠ¶æ€ä»£ç æŒ‡ç¤ºè¯·æ±‚çš„ç»“æœï¼Œä¾‹å¦‚ 200 è¡¨ç¤ºè¯·æ±‚æˆåŠŸï¼Œ404 è¡¨ç¤ºæœªæ‰¾åˆ°èµ„æºã€‚ æ ‡å¤´ï¼šä¸è¯·æ±‚æ ‡å¤´ç±»ä¼¼ï¼Œå“åº”æ ‡å¤´æä¾›æœ‰å…³å“åº”å’ŒæœåŠ¡å™¨çš„é™„åŠ ä¿¡æ¯ã€‚å®ƒä»¬å¯ä»¥åŒ…æ‹¬å†…å®¹ç±»å‹ã€ç¼“å­˜æ§åˆ¶æŒ‡ä»¤å’ŒæœåŠ¡å™¨ä¿¡æ¯ç­‰ä¿¡æ¯ã€‚ Bodyï¼šå“åº”æ­£æ–‡åŒ…å«å‘é€å›å®¢æˆ·ç«¯çš„å†…å®¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¯·æ±‚é’ˆå¯¹ HTML ç½‘é¡µï¼Œåˆ™å“åº”æ­£æ–‡å°†åŒ…å« HTML æ ‡è®°ã€‚ å†…å®¹åå•† å†…å®¹åå•†æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å°±å†…å®¹ç±»å‹ä¼ è¾¾å…¶åå¥½å’ŒåŠŸèƒ½çš„è¿‡ç¨‹ã€‚è¿™å¯ä»¥çµæ´»åœ°ä¸ºå®¢æˆ·æä¾›æœ€åˆé€‚çš„å†…å®¹ã€‚\nå®¢æˆ·ç«¯è¯·æ±‚ä¸­çš„ Accept æ ‡å¤´æŒ‡å®šå®ƒå¯ä»¥å¤„ç†çš„å†…å®¹ç±»å‹ï¼Œå¹¶æŒ‰é¦–é€‰é¡¹æ’åºã€‚ä¾‹å¦‚ï¼Œå®¢æˆ·ç«¯å¯ä»¥å‘é€å¸¦æœ‰â€œtext/htmlâ€å’Œâ€œapplication/jsonâ€çš„ Accept æ ‡å¤´ï¼Œä»¥æŒ‡ç¤ºå®ƒå¯ä»¥å¤„ç† HTML å’Œ JSONï¼ˆJavaScriptå¯¹è±¡è¡¨ç¤ºæ³•ï¼‰å†…å®¹ç±»å‹ã€‚ XML æ˜¯ Accept æ ‡å¤´ä¸­æåˆ°çš„å¦ä¸€ç§å—æ”¯æŒçš„æ ¼å¼ï¼Œè¡¨æ˜å®¢æˆ·ç«¯å¸Œæœ›æ¥æ”¶ XML æ ¼å¼çš„å“åº”ã€‚\næœåŠ¡å™¨æ£€æŸ¥ Accept æ ‡å¤´å¹¶å°†å…¶ä¸å®ƒå¯ä»¥ä¼ é€çš„å¯ç”¨å†…å®¹ç±»å‹è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœåŒ¹é…ï¼ŒæœåŠ¡å™¨å°†å‘é€å…·æœ‰ç›¸åº”å†…å®¹ç±»å‹çš„å“åº”ã€‚å¦‚æœä¸åŒ¹é…ï¼ŒæœåŠ¡å™¨å¯èƒ½ä¼šä½¿ç”¨ä¸åŒçš„å†…å®¹ç±»å‹è¿›è¡Œå“åº”ï¼Œæˆ–è€…è¿”å› 406 çŠ¶æ€ä»£ç ï¼ŒæŒ‡ç¤ºå®¢æˆ·ç«¯ä¸å¯æ¥å—ä»»ä½•å¯ç”¨çš„å†…å®¹ç±»å‹ã€‚\nå†…å®¹åå•†å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®Œæˆï¼ŒåŒ…æ‹¬ï¼š\nContent-Type æ ‡å¤´ï¼šæœåŠ¡å™¨å¯ä»¥åœ¨å“åº”ä¸­ä½¿ç”¨â€œContent-Typeâ€æ ‡å¤´æ¥æŒ‡ç¤ºæ­£åœ¨å‘é€çš„å†…å®¹çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæœåŠ¡å™¨å“åº”â€œContent-Typeï¼štext/htmlâ€ï¼Œåˆ™è¡¨æ˜å†…å®¹æ˜¯ HTML æ ¼å¼ã€‚ MIME åœ¨ HTTP ä¸­å‘æŒ¥ç€è‡³å…³é‡è¦çš„ä½œç”¨ï¼Œå®ƒæä¾›äº†ä¸€ç§æ ‡å‡†åŒ–çš„æ–¹æ³•æ¥è¯†åˆ«å’Œå¤„ç†å„ç§å†…å®¹ç±»å‹ï¼Œä¿ƒè¿›å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„æ­£ç¡®è§£é‡Šå’Œå¤„ç†ã€‚ Content-Type æ ‡å¤´æ˜¯ HTTP æ¶ˆæ¯ä¸­æºå¸¦æ­¤ä¿¡æ¯çš„å…³é”®ç»„ä»¶ã€‚ æ–‡ä»¶æ‰©å±•åï¼šæœåŠ¡å™¨è¿˜å¯ä»¥æ ¹æ®è¯·æ±‚èµ„æºçš„æ–‡ä»¶æ‰©å±•åæ¥ç¡®å®šå†…å®¹ç±»å‹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå®¢æˆ·ç«¯è¯·æ±‚ä¸€ä¸ªæ‰©å±•åä¸ºâ€œ.jsonâ€çš„æ–‡ä»¶ï¼ŒæœåŠ¡å™¨å¯ä»¥å‡è®¾è¯¥å†…å®¹æ˜¯ JSON æ ¼å¼ã€‚ æŸ¥è¯¢å‚æ•°ï¼šåå•†å†…å®¹çš„å¦ä¸€ç§æ–¹æ³•æ˜¯é€šè¿‡ URL ä¸­çš„æŸ¥è¯¢å‚æ•°ã€‚å®¢æˆ·ç«¯å¯ä»¥åœ¨ URL ä¸­åŒ…å«å‚æ•°æ¥æŒ‡å®šæ‰€éœ€çš„å†…å®¹ç±»å‹ã€‚ä¾‹å¦‚ï¼Œå®¢æˆ·ç«¯å¯ä»¥åœ¨ URL ä¸­åŒ…å«â€œ?format=jsonâ€ï¼Œä»¥æŒ‡ç¤ºå®ƒéœ€è¦ JSON æ ¼å¼çš„å“åº”ã€‚ è¯­è¨€æ ‡å¤´ï¼šé™¤äº†å†…å®¹ç±»å‹åå•†ä¹‹å¤–ï¼ŒæœåŠ¡å™¨è¿˜å¯ä»¥åå•†å†…å®¹çš„è¯­è¨€ã€‚å®¢æˆ·ç«¯å¯ä»¥åŒ…å«â€œAccept-Languageâ€æ ‡å¤´ä»¥æŒ‡ç¤ºè¯·æ±‚ä¸­çš„é¦–é€‰è¯­è¨€ã€‚ç„¶åï¼ŒæœåŠ¡å™¨å¯ä»¥ä½¿ç”¨è¯·æ±‚çš„è¯­è¨€å‘é€å“åº”ï¼ˆå¦‚æœå¯ç”¨ï¼‰ã€‚ HTTP æ–¹æ³•æœ‰å“ªäº›ä¸åŒç±»å‹ï¼Ÿ HTTP å®šä¹‰äº†ä¸€ç»„æ–¹æ³•æˆ–åŠ¨è¯ï¼ŒæŒ‡ç¤ºè¦å¯¹èµ„æºæ‰§è¡Œçš„æ‰€éœ€æ“ä½œã€‚ä»¥ä¸‹æ˜¯å¸¸ç”¨çš„ä¸åŒç±»å‹çš„ HTTP æ–¹æ³•ï¼š\nGETï¼š[GET æ–¹æ³•](https://www.w3schools.com/tags/ref_httpmethods.asp#:~:text=The GET Method,data from a specified resource.\u0026amp;text=Some notes on GET requests,remain in the browser history)ä»æœåŠ¡å™¨æ£€ç´¢ä¿¡æ¯ã€‚å®ƒè¯·æ±‚æŒ‡å®šèµ„æºçš„è¡¨ç¤ºå¹¶ä¸”ä¸ä¿®æ”¹å®ƒã€‚ GET è¯·æ±‚è¢«è®¤ä¸ºæ˜¯å®‰å…¨ä¸”å¹‚ç­‰çš„ï¼Œå› ä¸ºå®ƒä»¬å¯¹æœåŠ¡å™¨æˆ–è¯·æ±‚çš„èµ„æºæ²¡æœ‰ä»»ä½•å‰¯ä½œç”¨ã€‚ POSTï¼š[POSTæ–¹æ³•](https://www.w3schools.com/tags/ref_httpmethods.asp#:~:text=The POST Method,to create%2Fupdate a resource.\u0026amp;text=Some notes on POST requests,remain in the browser history)ç”¨äºæäº¤æ•°æ®ä»¥ä¾›æœåŠ¡å™¨å¤„ç†ã€‚å®ƒè¯·æ±‚æœåŠ¡å™¨æ¥å—æ‰€åŒ…å«çš„å®ä½“ä½œä¸ºæŒ‡å®šèµ„æºçš„æ–°ä»å±å®ä½“ã€‚ POST è¯·æ±‚ä¸æ˜¯å¹‚ç­‰çš„ï¼Œè¿™æ„å‘³ç€å¤šä¸ªç›¸åŒçš„è¯·æ±‚å¯èƒ½ä¼šäº§ç”Ÿä¸åŒçš„æ•ˆæœã€‚ PUTï¼š[PUT æ–¹æ³•](https://www.arubanetworks.com/techdocs/AOS-CX/10.12/HTML/rest_v10-0x/Content/Chp_REST_ref/put-met-usa-con-10.htm#:~:text=The PUT method updates an,afterward are called immutable attributes.)ç”¨æ‰€åŒ…å«çš„å®ä½“æ›´æ–°æˆ–æ›¿æ¢ç°æœ‰èµ„æºã€‚å®ƒè¯·æ±‚æœåŠ¡å™¨å°†æ‰€åŒ…å«çš„å®ä½“å­˜å‚¨åœ¨æŒ‡å®šçš„ URI å¤„ã€‚ PUT è¯·æ±‚æ˜¯å¹‚ç­‰çš„ï¼Œå› ä¸ºå¤šä¸ªç›¸åŒçš„è¯·æ±‚ä¸å•ä¸ªè¯·æ±‚å…·æœ‰ç›¸åŒçš„æ•ˆæœã€‚ DELETEï¼šDELETEæ–¹æ³•åˆ é™¤æŒ‡å®šçš„èµ„æºã€‚å®ƒè¯·æ±‚æœåŠ¡å™¨åˆ é™¤ URI æ ‡è¯†çš„èµ„æºã€‚ DELETE è¯·æ±‚æ˜¯å¹‚ç­‰çš„ï¼Œå› ä¸ºå¤šä¸ªç›¸åŒçš„è¯·æ±‚ä¸å•ä¸ªè¯·æ±‚å…·æœ‰ç›¸åŒçš„æ•ˆæœã€‚ PATCHï¼š[PATCH æ–¹æ³•](https://en.wikipedia.org/wiki/PATCH_(HTTP)#:~:text=In computing%2C the PATCH method,Uniform Resource Identifier (URI).)éƒ¨åˆ†æ›´æ–°èµ„æºã€‚å®ƒè¯·æ±‚æœåŠ¡å™¨å¯¹ URI æ ‡è¯†çš„èµ„æºåº”ç”¨éƒ¨åˆ†ä¿®æ”¹ã€‚ PATCH è¯·æ±‚ä¸æ˜¯å¹‚ç­‰çš„ï¼Œè¿™æ„å‘³ç€å¤šä¸ªç›¸åŒçš„è¯·æ±‚å¯èƒ½ä¼šäº§ç”Ÿä¸åŒçš„æ•ˆæœã€‚ è¿™äº› HTTP æ–¹æ³•æ„æˆäº†å®¢æˆ·ç«¯-æœåŠ¡å™¨é€šä¿¡çš„åŸºç¡€ï¼Œå¯¹äºæ„å»º Web åº”ç”¨ç¨‹åºè‡³å…³é‡è¦ã€‚æ¯ç§æ–¹æ³•éƒ½æœ‰ç‰¹å®šçš„ç›®çš„ï¼Œå¼€å‘äººå‘˜å¿…é¡»æ ¹æ®æ‰€éœ€çš„æ“ä½œå’Œåº”ç”¨ç¨‹åºçš„è¯­ä¹‰ä»”ç»†è€ƒè™‘ä½¿ç”¨å“ªç§æ–¹æ³•\nä»€ä¹ˆæ˜¯ HTTP çŠ¶æ€ä»£ç ï¼Ÿ HTTP çŠ¶æ€ä»£ç æ˜¯ Web æœåŠ¡å™¨å“åº”å®¢æˆ·ç«¯è¯·æ±‚è€Œè¿”å›çš„ä¸‰ä½æ•°ã€‚å®ƒæä¾›æœ‰å…³æ‰€è¯·æ±‚èµ„æºçš„çŠ¶æ€çš„ä¿¡æ¯ï¼Œå¹¶æœ‰åŠ©äºäº†è§£è¯·æ±‚çš„ç»“æœã€‚\næ¯ä¸ª HTTP çŠ¶æ€ä»£ç åˆ†ä¸ºäº”ä¸ªç±»åˆ«ä¹‹ä¸€ï¼ŒæŒ‡ç¤ºä¸åŒç±»å‹çš„å“åº”ï¼š\n1xx - ä¿¡æ¯æ€§\n2xx - æˆåŠŸ\n3xx - é‡å®šå‘\n4xx - å®¢æˆ·ç«¯é”™è¯¯\n5xx - æœåŠ¡å™¨é”™è¯¯\nè®©æˆ‘ä»¬æ›´æ·±å…¥åœ°äº†è§£æ¯ä¸ªç±»åˆ«ï¼š\n1xx - ä¿¡æ¯æ€§ï¼šè¿™äº›çŠ¶æ€ä»£ç è¡¨ç¤ºæœåŠ¡å™¨å·²æ”¶åˆ°è¯·æ±‚å¹¶æ­£åœ¨ç»§ç»­è¯¥è¿‡ç¨‹ã€‚å®ƒä»¬ä¸»è¦ç”¨äºé€šä¿¡ç›®çš„ï¼Œä¸éœ€è¦å®¢æˆ·ç«¯é‡‡å–è¿›ä¸€æ­¥çš„æ“ä½œã€‚\n2xx - æˆåŠŸï¼šè¿™äº›çŠ¶æ€ä»£ç è¡¨ç¤ºæœåŠ¡å™¨æˆåŠŸæ¥æ”¶ã€ç†è§£å¹¶æ¥å—å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚è¯¥ç±»åˆ«æœ€å¸¸è§çš„çŠ¶æ€ä»£ç æ˜¯ 200 OKï¼Œè¿™æ„å‘³ç€è¯·æ±‚æˆåŠŸã€‚\n3xx - é‡å®šå‘ï¼šè¿™äº›çŠ¶æ€ä»£ç è¡¨ç¤ºå®¢æˆ·ç«¯éœ€è¦é‡‡å–è¿›ä¸€æ­¥æ“ä½œæ‰èƒ½å®Œæˆè¯·æ±‚ã€‚å½“èµ„æºè¢«ç§»åŠ¨æˆ–ä¸´æ—¶é‡å®šå‘åˆ°ä¸åŒä½ç½®æ—¶ï¼Œé€šå¸¸ä¼šä½¿ç”¨å®ƒä»¬ã€‚\n4xx - å®¢æˆ·ç«¯é”™è¯¯ï¼šè¿™äº›çŠ¶æ€ä»£ç è¡¨ç¤ºå®¢æˆ·ç«¯çš„è¯·æ±‚æ ¼å¼é”™è¯¯ã€æœªç»æˆæƒæˆ–æœåŠ¡å™¨æ— æ³•æ»¡è¶³ã€‚æ­¤ç±»åˆ«ä¸­æœ€è‘—åçš„çŠ¶æ€ä»£ç æ˜¯ 404 Not Foundï¼Œå®ƒè¡¨ç¤ºåœ¨æœåŠ¡å™¨ä¸Šæ‰¾ä¸åˆ°æ‰€è¯·æ±‚çš„èµ„æºã€‚\n5xx - æœåŠ¡å™¨é”™è¯¯ï¼šè¿™äº›çŠ¶æ€ä»£ç æŒ‡ç¤ºæœåŠ¡å™¨ç«¯åœ¨å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯ã€‚å®ƒä»¬è¡¨æ˜æœåŠ¡å™¨ç”±äºæŸäº›å†…éƒ¨é”™è¯¯æˆ–é—®é¢˜è€Œæ— æ³•æ»¡è¶³è¯·æ±‚ã€‚æ­¤ç±»åˆ«æœ€å¸¸è§çš„çŠ¶æ€ä»£ç æ˜¯ 500 å†…éƒ¨æœåŠ¡å™¨é”™è¯¯ï¼Œå®ƒè¡¨ç¤ºä¸€èˆ¬æœåŠ¡å™¨ç«¯é”™è¯¯ã€‚\nä¸ºä»€ä¹ˆ HTTP çŠ¶æ€ä»£ç å¯¹äºåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜å¾ˆé‡è¦ï¼Ÿ HTTP çŠ¶æ€ä»£ç å¯¹äºåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜è‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒä»¬æä¾›æœ‰å…³è¯·æ±‚ç»“æœçš„å®è´µä¿¡æ¯ã€‚é€šè¿‡åˆ†æè¿™äº›çŠ¶æ€ä»£ç ï¼Œå¼€å‘äººå‘˜å¯ä»¥äº†è§£ä»–ä»¬çš„è¯·æ±‚æ˜¯å¦æˆåŠŸæˆ–é‡åˆ°ä»»ä½•é—®é¢˜ã€‚\nä»¥ä¸‹æ˜¯ HTTP çŠ¶æ€ä»£ç å¯¹äºåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜å¾ˆé‡è¦çš„ä¸€äº›å…³é”®åŸå› ï¼š\né”™è¯¯å¤„ç†ï¼šHTTP çŠ¶æ€ä»£ç å¸®åŠ©å¼€å‘äººå‘˜è¯†åˆ«å’Œå¤„ç†å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨é€šä¿¡æœŸé—´å¯èƒ½å‘ç”Ÿçš„é”™è¯¯ã€‚ æ•…éšœæ’é™¤ï¼šå½“åº”ç”¨ç¨‹åºæœªæŒ‰é¢„æœŸè¿è¡Œæ—¶ï¼Œå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨ HTTP çŠ¶æ€ä»£ç æ¥è§£å†³é—®é¢˜ã€‚é€šè¿‡æ£€æŸ¥è¿”å›çš„çŠ¶æ€ä»£ç ï¼Œå¼€å‘äººå‘˜å¯ä»¥ç¼©å°é—®é¢˜èŒƒå›´å¹¶é‡‡å–å¿…è¦çš„æ­¥éª¤æ¥ä¿®å¤å®ƒã€‚ API æ–‡æ¡£ï¼šåœ¨ä½¿ç”¨ APIæ—¶ï¼Œå¼€å‘äººå‘˜ç»å¸¸å‚è€ƒ API æ–‡æ¡£æ¥äº†è§£å¦‚ä½•ä¸ API ç«¯ç‚¹äº¤äº’ã€‚ HTTP çŠ¶æ€ä»£ç åœ¨ API æ–‡æ¡£ä¸­è‡³å…³é‡è¦ï¼Œå®ƒæä¾›æœ‰å…³å¯èƒ½çš„å“åº”åŠå…¶å«ä¹‰çš„ä¿¡æ¯ã€‚è¿™æœ‰åŠ©äºå¼€å‘äººå‘˜äº†è§£ API çš„é¢„æœŸè¡Œä¸ºå¹¶ç›¸åº”åœ°å¤„ç†ä¸åŒçš„åœºæ™¯ã€‚ ç”¨æˆ·ä½“éªŒï¼šHTTP çŠ¶æ€ä»£ç é—´æ¥å½±å“åº”ç”¨ç¨‹åºçš„ç”¨æˆ·ä½“éªŒã€‚å½“ç”¨æˆ·åœ¨ä½¿ç”¨åº”ç”¨ç¨‹åºæ—¶é‡åˆ°é”™è¯¯æˆ–é—®é¢˜æ—¶ï¼Œåº”ç”¨ç¨‹åºåœ¨ HTTP çŠ¶æ€ä»£ç ä¸­çš„å“åº”å¯ä»¥æä¾›æœ‰ä»·å€¼çš„åé¦ˆã€‚ æ€§èƒ½ä¼˜åŒ–ï¼šHTTPçŠ¶æ€ä»£ç è¿˜å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜ä¼˜åŒ–åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚ å®‰å…¨æ€§ï¼šHTTP çŠ¶æ€ä»£ç å¯ä»¥æä¾›å¯¹å®‰å…¨ç›¸å…³é—®é¢˜çš„æ·±å…¥äº†è§£ã€‚é€šè¿‡ç›‘è§†å’Œåˆ†æè¿™äº›çŠ¶æ€ä»£ç ï¼Œå¼€å‘äººå‘˜å¯ä»¥è¯†åˆ«æ½œåœ¨çš„å®‰å…¨æ¼æ´å¹¶é‡‡å–é€‚å½“çš„æªæ–½æ¥è§£å†³å®ƒä»¬ã€‚ æœ€å¸¸è§çš„ HTTP çŠ¶æ€ä»£ç æœ‰å“ªäº›ï¼Ÿ å¼€å‘ Web åº”ç”¨ç¨‹åºæ—¶ï¼Œç†è§£å’Œå¤„ç† HTTP çŠ¶æ€ä»£ç è‡³å…³é‡è¦ã€‚è¿™äº›ä»£ç æ˜¯æœåŠ¡å™¨å“åº”å®¢æˆ·ç«¯è¯·æ±‚è€Œå‘é€çš„ä¸‰ä½æ•°ï¼Œæä¾›æœ‰å…³è¯·æ±‚çŠ¶æ€çš„ä¿¡æ¯ã€‚è®©æˆ‘ä»¬æ¢è®¨ä¸€äº›æœ€å¸¸è§çš„ HTTP çŠ¶æ€ä»£ç åŠå…¶å«ä¹‰ã€‚\n200 OKï¼šè¿™æ˜¯æœ€å¸¸é‡åˆ°çš„çŠ¶æ€ç ï¼Œè¡¨ç¤ºè¯·æ±‚æˆåŠŸã€‚å®ƒé€šå¸¸æ˜¯å“åº” GET å’Œ POST è¯·æ±‚è€Œå‘é€çš„ï¼Œé€šçŸ¥å®¢æˆ·ç«¯æœåŠ¡å™¨å·²æ»¡è¶³è¯·æ±‚ã€‚ 404 Not Foundï¼šå½“åœ¨æœåŠ¡å™¨ä¸Šæ‰¾ä¸åˆ°æ‰€è¯·æ±‚çš„èµ„æºæ—¶ï¼Œè¿”å›404çŠ¶æ€ç ã€‚è¡¨ç¤ºå®¢æˆ·ç«¯æä¾›çš„URLæˆ–ç«¯ç‚¹ä¸å­˜åœ¨æˆ–æ‰¾ä¸åˆ°ã€‚ 500 å†…éƒ¨æœåŠ¡å™¨é”™è¯¯ï¼šæ­¤çŠ¶æ€ä»£ç è¡¨ç¤ºæœåŠ¡å™¨ç«¯é”™è¯¯ã€‚è¿™è¡¨æ˜æœåŠ¡å™¨åœ¨å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚æ—¶å‡ºç°äº†é—®é¢˜ï¼Œä½†æœåŠ¡å™¨æ— æ³•æä¾›æœ‰å…³é”™è¯¯çš„å…·ä½“è¯¦ç»†ä¿¡æ¯ã€‚ 403 Forbiddenï¼š403çŠ¶æ€ç è¡¨ç¤ºæœåŠ¡å™¨ç†è§£å®¢æˆ·ç«¯çš„è¯·æ±‚ä½†æ‹’ç»æ‰§è¡Œå®ƒã€‚è¿™å¯èƒ½æ˜¯ç”±äºæƒé™ä¸è¶³æˆ–èº«ä»½éªŒè¯é—®é¢˜ã€‚ 302 Found/Redirectï¼šæ­¤ä»£ç ç”¨äºä¸´æ—¶é‡å®šå‘ã€‚å½“å®¢æˆ·ç«¯é‡åˆ°æ­¤çŠ¶æ€ä»£ç æ—¶ï¼Œç³»ç»Ÿä¼šæŒ‡ç¤ºå®ƒå‘ä¸åŒçš„ URL å‘å‡ºæ–°è¯·æ±‚ï¼Œé€šå¸¸åœ¨å“åº”çš„â€œLocationâ€æ ‡å¤´ä¸­æä¾›ã€‚ 400 Bad Requestï¼šå½“æœåŠ¡å™¨ç”±äºè¯­æ³•æˆ–æ ¼å¼é”™è¯¯è€Œæ— æ³•ç†è§£æˆ–å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚æ—¶ï¼Œä¼šè¿”å›400çŠ¶æ€ç ã€‚å¦‚æœå®¢æˆ·ç«¯å‘é€æ— æ•ˆæ•°æ®æˆ–æœåŠ¡å™¨æœŸæœ›ç¼ºå°‘æŸäº›å‚æ•°ï¼Œåˆ™å¯èƒ½ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚ 301 Moved Permanentlyï¼šæ­¤çŠ¶æ€ä»£ç ç”¨äºæ°¸ä¹…é‡å®šå‘ã€‚å®ƒè¡¨æ˜æ‰€è¯·æ±‚çš„èµ„æºå·²æ°¸ä¹…ç§»åŠ¨åˆ°æ–°ä½ç½®ã€‚å®¢æˆ·ç«¯å¿…é¡»æ›´æ–°å…¶ä¹¦ç­¾æˆ–å¯¹æ–° URL çš„å¼•ç”¨ã€‚ 304 Not Modifiedï¼šå½“å®¢æˆ·ç«¯å‘é€æœ‰æ¡ä»¶çš„ GET è¯·æ±‚ï¼Œå¹¶ä¸”æ‰€è¯·æ±‚çš„èµ„æºè‡ªä¸Šæ¬¡è¯·æ±‚ä»¥æ¥æ²¡æœ‰è¢«ä¿®æ”¹æ—¶ï¼ŒæœåŠ¡å™¨è¿”å› 304 çŠ¶æ€ç ã€‚è¿™è¡¨æ˜å®¢æˆ·ç«¯çš„èµ„æºç¼“å­˜ç‰ˆæœ¬ä»ç„¶æœ‰æ•ˆï¼Œæ— éœ€å†æ¬¡ä¼ è¾“å®é™…å†…å®¹ã€‚ 503 Service Unavailableï¼šè¯¥çŠ¶æ€ç è¡¨ç¤ºæœåŠ¡å™¨æš‚æ—¶æ— æ³•å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚å®ƒå¯èƒ½æ˜¯ç”±äºæœåŠ¡å™¨è¿‡è½½ã€ç»´æŠ¤æˆ–å…¶ä»–ä¸´æ—¶é—®é¢˜è€Œå‘ç”Ÿçš„ã€‚å®¢æˆ·ç«¯å¯ä»¥åœ¨ä¸€æ®µæ—¶é—´åé‡è¯•è¯¥è¯·æ±‚ã€‚ 429 Too Many Requestsï¼šå½“å®¢æˆ·ç«¯è¶…è¿‡æœåŠ¡å™¨è®¾ç½®çš„é€Ÿç‡é™åˆ¶æ—¶ï¼Œè¿”å›æ­¤çŠ¶æ€ç ã€‚å®ƒè¡¨æ˜æœåŠ¡å™¨æ­£åœ¨é™åˆ¶æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚æ•°é‡ä»¥é˜²æ­¢æ»¥ç”¨æˆ–è¿‡è½½ã€‚ HTTP å’Œ HTTPS æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ HTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰å’Œ HTTPSï¼ˆå®‰å…¨è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰æ˜¯é€šè¿‡ Internet ä¼ è¾“æ•°æ®çš„åè®®ã€‚ä¸¤è€…ä¹‹é—´çš„ä¸»è¦åŒºåˆ«åœ¨äºå®ƒä»¬æä¾›çš„å®‰å…¨çº§åˆ«ã€‚\nHTTP åœ¨ TCPï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼‰ä¹‹ä¸Šè¿è¡Œå¹¶ä¸”æœªåŠ å¯†ã€‚ä»»ä½•è®¿é—®ç½‘ç»œçš„äººéƒ½å¯ä»¥è½»æ¾æ‹¦æˆªå¹¶è¯»å–HTTPæ•°æ®ã€‚ç¼ºä¹åŠ å¯†ä½¿å¾— HTTP å®¹æ˜“å—åˆ°å„ç§å®‰å…¨å¨èƒï¼Œä¾‹å¦‚æ•°æ®ç¯¡æ”¹ã€çªƒå¬å’Œä¸­é—´äººæ”»å‡»ã€‚\nå¦ä¸€æ–¹é¢ï¼ŒHTTPS æ˜¯ HTTP çš„å®‰å…¨ç‰ˆæœ¬ï¼Œå®ƒä½¿ç”¨SSL/TLSï¼ˆå®‰å…¨å¥—æ¥å­—å±‚/ä¼ è¾“å±‚å®‰å…¨ï¼‰åè®®æ¥åŠ å¯†ä¼ è¾“çš„æ•°æ®ã€‚è¿™ç§åŠ å¯†å¯ç¡®ä¿æ•°æ®å—åˆ°ä¿æŠ¤ï¼Œå¹¶ä¸”æœªç»æˆæƒçš„ä¸ªäººæ— æ³•è½»æ˜“ç ´è¯‘ã€‚ HTTPS ä¸ºé€šä¿¡é€šé“æ·»åŠ äº†ä¸€å±‚å®‰å…¨æ€§ï¼Œä½¿æ”»å‡»è€…æ›´éš¾æ‹¦æˆªå’Œæ“çºµæ•°æ®ã€‚\nä¸ºäº†å®ç°è¿™ç§åŠ å¯†ï¼ŒHTTPS éœ€è¦ä½¿ç”¨ SSL/TLS è¯ä¹¦ã€‚è¯¥è¯ä¹¦ç”±å—ä¿¡ä»»çš„ç¬¬ä¸‰æ–¹ç»„ç»‡ï¼ˆè¯ä¹¦é¢å‘æœºæ„ (CA)ï¼‰é¢å‘ã€‚è¯¥è¯ä¹¦åŒ…å«ç”¨äºåŠ å¯†æ•°æ®çš„å…¬é’¥å’Œä¿å¯†å¹¶ç”¨äºè§£å¯†çš„ç§é’¥ã€‚å½“ç”¨æˆ·ä½¿ç”¨ HTTPS è®¿é—®ç½‘ç«™æ—¶ï¼Œå…¶æµè§ˆå™¨ä¼šéªŒè¯ SSL/TLS è¯ä¹¦çš„çœŸå®æ€§ï¼Œä»¥ç¡®ä¿é€šä¿¡å®‰å…¨ã€‚\né™¤äº†åŠ å¯†ä¹‹å¤–ï¼ŒHTTPS è¿˜æä¾›èº«ä»½éªŒè¯ã€‚è¿™æ„å‘³ç€ç”¨æˆ·å¯ä»¥æ”¾å¿ƒåœ°ä¸ç›®æ ‡ç½‘ç«™è€Œä¸æ˜¯å†’åé¡¶æ›¿è€…è¿›è¡Œäº¤æµã€‚ SSL/TLS è¯ä¹¦åŒ…å«æœ‰å…³ç½‘ç«™èº«ä»½çš„ä¿¡æ¯ï¼Œä¾‹å¦‚å…¶åŸŸåã€‚ç”¨æˆ·çš„æµè§ˆå™¨æ ¹æ®è¯ä¹¦é¢å‘æœºæ„çš„è®°å½•æ£€æŸ¥æ­¤ä¿¡æ¯ï¼Œä»¥éªŒè¯è¯¥ç½‘ç«™æ˜¯å¦åˆæ³•ã€‚å¦‚æœè¯ä¹¦ä¸åŒ¹é…æˆ–å­˜åœ¨ä»»ä½•å…¶ä»–é—®é¢˜ï¼Œæµè§ˆå™¨å°†è­¦å‘Šç”¨æˆ·ï¼Œè¡¨æ˜è¯¥ç½‘ç«™å¯èƒ½ä¸å®‰å…¨ã€‚\nHTTP å®‰å…¨ è™½ç„¶ HTTP æœ¬èº«ä¸æä¾›å†…ç½®å®‰å…¨æ€§ï¼Œä½†æ‚¨å¯ä»¥é‡‡å–å¤šç§æªæ–½æ¥å¢å¼ºåŸºäº HTTP çš„é€šä¿¡çš„å®‰å…¨æ€§ï¼š\nHTTPSï¼šä¿æŠ¤ HTTP æµé‡çš„ä¸»è¦æ–¹æ³•æ˜¯ä½¿ç”¨ HTTPSï¼Œå®ƒå¯ä»¥ä¿æŠ¤æ•æ„Ÿæ•°æ®å…é­çªƒå¬å’Œç¯¡æ”¹ã€‚è¦å®æ–½ HTTPSï¼Œæ‚¨å¿…é¡»è·å– SSL/TLS è¯ä¹¦å¹¶é…ç½® Web æœåŠ¡å™¨ä»¥ä½¿ç”¨å®ƒã€‚ SSL/TLS è¯ä¹¦ï¼šSSL/TLS è¯ä¹¦æ˜¯ç”±å—ä¿¡ä»»çš„è¯ä¹¦é¢å‘æœºæ„ (CA) é¢å‘çš„æ•°å­—è¯ä¹¦ï¼ŒåŒ…å«ç”¨äºåŠ å¯†å’Œè§£å¯†æ•°æ®çš„åŠ å¯†å¯†é’¥ã€‚æœ‰æ•ˆçš„ SSL/TLS è¯ä¹¦å¯ä¿æŠ¤é€šè¿‡ HTTP ä¼ è¾“çš„æ•°æ®ã€‚ æœåŠ¡å™¨é…ç½®ï¼šæ­£ç¡®é…ç½® Web æœåŠ¡å™¨å¯¹äºå¢å¼º HTTP å®‰å…¨æ€§éå¸¸é‡è¦ã€‚è¿™åŒ…æ‹¬ç¦ç”¨ä¸å®‰å…¨å’Œè¿‡æ—¶çš„åè®®ã€å¯ç”¨å®‰å…¨å¯†ç å¥—ä»¶ä»¥åŠæ­£ç¡®é…ç½®å®‰å…¨æ ‡å¤´ä»¥é˜²æ­¢æŸäº›ç±»å‹çš„æ”»å‡»ï¼Œä¾‹å¦‚è·¨ç«™ç‚¹è„šæœ¬æ”»å‡» (XSS)å’Œç‚¹å‡»åŠ«æŒã€‚ å†…å®¹å®‰å…¨ç­–ç•¥ (CSP)ï¼šå†…å®¹å®‰å…¨ç­–ç•¥å…è®¸æ‚¨å®šä¹‰ç½‘é¡µå¯ä»¥åŠ è½½å†…å®¹çš„æºï¼ŒåŒ…æ‹¬è„šæœ¬ã€æ ·å¼è¡¨å’Œå›¾åƒã€‚é€šè¿‡å®æ–½å®šä¹‰è‰¯å¥½çš„ CSPï¼Œæ‚¨å¯ä»¥é™ä½è·¨ç«™ç‚¹è„šæœ¬ (XSS) æ”»å‡»å’Œå…¶ä»–å†…å®¹æ³¨å…¥æ¼æ´çš„é£é™©ã€‚ å®‰å…¨ Cookie å¤„ç†ï¼šå½“ä½¿ç”¨ cookie è¿›è¡Œä¼šè¯ç®¡ç†æˆ–èº«ä»½éªŒè¯æ—¶ï¼Œç¡®ä¿å®ƒä»¬çš„å®‰å…¨éå¸¸é‡è¦ã€‚å®æ–½å®‰å…¨ cookie æ ‡å¿—ï¼Œä¾‹å¦‚â€œSecureâ€å’Œâ€œHttpOnlyâ€ï¼Œä»¥é˜²æ­¢å®ƒä»¬é€šè¿‡ä¸å®‰å…¨çš„é€šé“ä¼ è¾“æˆ–è¢«æ¶æ„è„šæœ¬è®¿é—®ã€‚ å®šæœŸæ›´æ–°å’Œè¡¥ä¸ï¼šä½¿ç”¨æœ€æ–°çš„å®‰å…¨è¡¥ä¸æ›´æ–°æ‚¨çš„ç½‘ç»œæœåŠ¡å™¨å’Œå…¶ä»–è½¯ä»¶ã€‚è¿™åŒ…æ‹¬æœåŠ¡å™¨çš„æ“ä½œç³»ç»Ÿã€Web æœåŠ¡å™¨è½¯ä»¶ä»¥åŠç¬¬ä¸‰æ–¹ç»„ä»¶æˆ–åº“ã€‚ Web åº”ç”¨ç¨‹åºå®‰å…¨ï¼šåœ¨ Web åº”ç”¨ç¨‹åºä¸­å®æ–½å®‰å…¨ç¼–ç å®è·µï¼Œä»¥é˜²æ­¢å¸¸è§æ¼æ´ï¼Œä¾‹å¦‚[SQL æ³¨å…¥](https://www.imperva.com/learn/application-security/sql-injection-sqli/#:~:text=SQL injection%2C also known as,lists or private customer details.)ã€è·¨ç«™ç‚¹è„šæœ¬ (XSS) å’Œè·¨ç«™ç‚¹è¯·æ±‚ä¼ªé€  (CSRF)ã€‚éªŒè¯å’Œæ¸…ç†è¾“å…¥æ•°æ®ï¼Œä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼Œå¹¶å®æ–½å¼ºå¤§çš„èº«ä»½éªŒè¯å’Œè®¿é—®æ§åˆ¶ã€‚ è¯·è®°ä½ï¼Œå³ä½¿é‡‡å–äº†è¿™äº›å®‰å…¨æªæ–½ï¼Œéšç€æ–°å¨èƒå’Œæ¼æ´çš„å‡ºç°ï¼Œå®šæœŸæ£€æŸ¥å’Œæ›´æ–°å®‰å…¨å®è·µä¹Ÿå¾ˆé‡è¦ã€‚é‡‡ç”¨åˆ†å±‚å®‰å…¨æ–¹æ³•å¹¶éµå¾ªæœ€ä½³å®è·µå°†æœ‰åŠ©äºç¡®ä¿åŸºäº HTTP çš„é€šä¿¡çš„å®‰å…¨æ€§ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2024/05/07/http/","summary":"åŸæ–‡é“¾æ¥ï¼šhttps://www.pubnub.com/guides/http/\nHTTP æ¦‚è¿° HTTPï¼Œå³è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œæ˜¯äº’è”ç½‘é€šä¿¡çš„åŸºç¡€ã€‚å®ƒåœ¨å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å‹ä¸Šè¿è¡Œï¼Œå…¶ä¸­å‰ç«¯å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ç½‘ç»œæµè§ˆå™¨ï¼‰é€šè¿‡å‘æœåŠ¡å™¨å‘é€HTTPè¯·æ±‚æ¶ˆæ¯æ¥å‘èµ·è¯·æ±‚ï¼Œä¾‹å¦‚è¯·æ±‚ç½‘é¡µï¼ˆä¾‹å¦‚æœç´¢å¼•æ“ï¼‰ã€‚ç„¶åï¼ŒæœåŠ¡å™¨ä½¿ç”¨åŒ…å«æ‰€è¯·æ±‚èµ„æºçš„ HTTP å“åº”æ¶ˆæ¯è¿›è¡Œå“åº”ï¼Œå¦‚æœèµ„æºä¸å¯ç”¨ï¼Œåˆ™ä½¿ç”¨é”™è¯¯æ¶ˆæ¯è¿›è¡Œå“åº”ã€‚\nHTTP æ˜¯ä¸€ç§æ— çŠ¶æ€åè®®ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªè¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¹‹å‰æˆ–å°†æ¥çš„è¯·æ±‚æ— å…³ã€‚è¿™å…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œæœ‰æ•ˆçš„é€šä¿¡ã€‚\nHTTP äº 1991 å¹´é¦–æ¬¡å¼•å…¥ï¼Œä½œä¸º Tim Berners-Lee åˆ›å»ºçš„ä¸‡ç»´ç½‘é¡¹ç›®çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ç”±äº’è”ç½‘å·¥ç¨‹ä»»åŠ¡ç»„ (IETF)è¿›è¡Œæ ‡å‡†åŒ–ã€‚ IETF è´Ÿè´£å¼€å‘å’Œç»´æŠ¤ HTTPã€TCP/IPã€DNS ç­‰åè®®ï¼Œä»¥åŠä»–ä»¬åœ¨ RFC æˆ–â€œå¾æ±‚æ„è§â€ä¸­è®°å½•çš„è®¸å¤šå…¶ä»–åè®®ã€‚\næ—©æœŸï¼Œéœ€è¦ä¸€ç§æ ‡å‡†åŒ–åè®®æ¥ä¿ƒè¿›ä¸åŒè®¡ç®—æœºå’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ã€‚è¿™å¯¼è‡´äº†å„ç§åè®®çš„å‘å±•ï¼ŒåŒ…æ‹¬ HTTPã€‚\nHTTP 0.9ï¼Œè¯¥åè®®çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œæ˜¯ä¸€ä¸ªç®€å•ä¸”æœ‰é™çš„ç³»ç»Ÿï¼Œä»…æ”¯æŒè¶…æ–‡æœ¬æ–‡æ¡£çš„æ£€ç´¢ã€‚å®ƒä¸æ”¯æŒæ ‡å¤´ï¼Œåªå…è®¸ä¼ è¾“çº¯æ–‡æœ¬æ•°æ®ã€‚\n1996 å¹´ï¼ŒHTTP 1.0 å‘å¸ƒï¼Œå¼•å…¥äº†è‡³ä»Šä»åœ¨ä½¿ç”¨çš„å‡ ä¸ªé‡è¦åŠŸèƒ½ã€‚å®ƒå¢åŠ äº†å¯¹å¤šç§åª’ä½“ç±»å‹çš„æ”¯æŒï¼Œå…è®¸ä¼ è¾“å›¾åƒã€è§†é¢‘å’Œå…¶ä»–æ–‡ä»¶æ ¼å¼ã€‚å®ƒè¿˜å¼•å…¥äº†ä½¿ç”¨æ ‡å¤´æ¥å®ç°æ›´é«˜çº§çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ç¼“å­˜å’Œèº«ä»½éªŒè¯ã€‚\n1999 å¹´å‘å¸ƒçš„ HTTP 1.1 è¿›ä¸€æ­¥æ”¹è¿›äº†è¯¥åè®®ã€‚å®ƒå¼•å…¥äº†æŒä¹…è¿æ¥ï¼Œå…è®¸é€šè¿‡å•ä¸ª TCP è¿æ¥å‘é€å¤šä¸ªè¯·æ±‚å’Œå“åº”ã€‚è¿™æå¤§åœ°æé«˜äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´é€šä¿¡çš„æ•ˆç‡å’Œé€Ÿåº¦ã€‚\nè¿‘å¹´æ¥ï¼Œäººä»¬è‡´åŠ›äºå¢å¼ºå’Œä¼˜åŒ–HTTPåè®®ã€‚è¿™å¯¼è‡´äº†HTTP/2çš„å¼€å‘ï¼Œå¹¶äº 2015 å¹´å‘å¸ƒã€‚HTTP/2 å¸¦æ¥äº†å¤šé¡¹æ”¹è¿›ï¼ŒåŒ…æ‹¬å¤šè·¯å¤ç”¨ã€æ ‡å¤´å‹ç¼©å’ŒæœåŠ¡å™¨æ¨é€ï¼Œä»¥å‡å°‘å»¶è¿Ÿå¹¶æé«˜æ€§èƒ½ã€‚\næœ€åæ˜¯ HTTP/3ã€‚HTTP/3ä¹Ÿç§°ä¸º HTTP over QUICï¼ˆå¿«é€Ÿ UDP Internet è¿æ¥ï¼‰ï¼Œæ˜¯æœ€æ–°çš„ HTTP åè®®ç‰ˆæœ¬ï¼Œæ—¨åœ¨è§£å†³ä»¥å‰ç‰ˆæœ¬çš„ä¸€äº›é™åˆ¶å¹¶æé«˜æ€§èƒ½ã€‚\nHTTP/3 æ„å»ºåœ¨ QUIC ä¼ è¾“åè®®ä¹‹ä¸Šï¼Œè¯¥åè®®ä½¿ç”¨ç”¨æˆ·æ•°æ®æŠ¥åè®® (UDP)è€Œä¸æ˜¯ TCPã€‚ä¸ TCP ç›¸æ¯”ï¼ŒUDP å…·æœ‰å¤šç§ä¼˜åŠ¿ï¼Œä¾‹å¦‚å‡å°‘å»¶è¿Ÿå’Œæ”¹è¿›æ‹¥å¡æ§åˆ¶ã€‚ HTTP/3 ä½¿ç”¨ UDPï¼Œæ—¨åœ¨æä¾›æ›´å¿«ã€æ›´å¯é ã€æ›´å®‰å…¨çš„è¿æ¥ã€‚\nHTTP/3 çš„å…³é”®ç‰¹æ€§ä¹‹ä¸€æ˜¯å®ƒæ”¯æŒå¤šè·¯å¤ç”¨å’Œæµå¤šè·¯å¤ç”¨çš„èƒ½åŠ›ã€‚è¿™å…è®¸é€šè¿‡å•ä¸ªè¿æ¥åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚å’Œå“åº”ï¼Œä»è€Œæé«˜æ•ˆç‡å¹¶å‡å°‘å»¶è¿Ÿã€‚æ­¤å¤–ï¼ŒHTTP/3 è¿˜åŒ…å«é›¶ RTT è¿æ¥å»ºç«‹ã€æ”¹è¿›çš„æ‹¥å¡æ§åˆ¶ä»¥åŠé€šè¿‡åŠ å¯†æé«˜å®‰å…¨æ€§ç­‰åŠŸèƒ½ã€‚\nHTTP å’ŒæœåŠ¡å™¨ æœåŠ¡å™¨å¯¹äºå¤„ç† HTTP è¯·æ±‚å’Œæä¾›ç›¸åº”çš„å“åº”è‡³å…³é‡è¦ã€‚ä»¥ä¸‹æ˜¯HTTPä¸æœåŠ¡å™¨å…³ç³»çš„å‡ ä¸ªè¦ç‚¹ï¼š\nè¯·æ±‚-å“åº”æ¨¡å‹ï¼šå¦‚å‰æ‰€è¿°ï¼ŒHTTP éµå¾ªè¯·æ±‚-å“åº”æ¨¡å‹ã€‚å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ HTTP è¯·æ±‚ï¼ŒæŒ‡å®šæ‰€éœ€çš„æ“ä½œï¼Œä¾‹å¦‚æ£€ç´¢ç½‘é¡µæˆ–æäº¤è¡¨å•æ•°æ®ã€‚æœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶å‘å› HTTP å“åº”ï¼Œå…¶ä¸­åŒ…æ‹¬çŠ¶æ€ä»£ç ã€æ ‡å¤´å’Œè¯·æ±‚çš„å†…å®¹ï¼ˆå¦‚æœé€‚ç”¨ï¼‰ã€‚ Web æœåŠ¡å™¨ï¼šWeb æœåŠ¡å™¨æ˜¯å¤„ç† HTTP è¯·æ±‚çš„è½¯ä»¶åº”ç”¨ç¨‹åºæˆ–ç¨‹åºã€‚å®ƒä»¬ä¾¦å¬ç‰¹å®šç½‘ç»œç«¯å£ï¼ˆé€šå¸¸ä¸º HTTP çš„ç«¯å£ 80ï¼‰ä¸Šçš„ä¼ å…¥è¯·æ±‚ï¼Œå¹¶å°†å®ƒä»¬è·¯ç”±åˆ°é€‚å½“çš„èµ„æºæˆ–åº”ç”¨ç¨‹åºã€‚æµè¡Œçš„ Web æœåŠ¡å™¨è½¯ä»¶åŒ…æ‹¬ Apacheã€Nginxå’Œ Microsoft IISã€‚ è·¯ç”±å’Œèµ„æºå¤„ç†ï¼šåœ¨ HTTP æœåŠ¡å™¨ä¸­ï¼Œè·¯ç”±ç¡®å®šä¼ å…¥è¯·æ±‚å¦‚ä½•æ˜ å°„åˆ°ç‰¹å®šèµ„æºæˆ–ç«¯ç‚¹å¤„ç†ç¨‹åºã€‚ä¾‹å¦‚ï¼Œå½“æ¥æ”¶åˆ°é’ˆå¯¹ç‰¹å®š URL æˆ–è·¯å¾„çš„è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ä½¿ç”¨è·¯ç”±è§„åˆ™æ¥ç¡®å®šå“ªä¸ªä»£ç æˆ–èµ„æºåº”å¤„ç†è¯¥è¯·æ±‚å¹¶ç”Ÿæˆé€‚å½“çš„å“åº”ã€‚ å¤„ç†å’Œç”Ÿæˆå“åº”ï¼šå½“ HTTP è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨æ—¶ï¼Œå®ƒä¼šè§¦å‘ä¸æ‰€è¯·æ±‚çš„èµ„æºå…³è”çš„ä»£ç æˆ–èµ„æºå¤„ç†ç¨‹åºçš„æ‰§è¡Œã€‚è¿™äº›å¤„ç†ç¨‹åºå¯ä»¥ä»æ•°æ®åº“æ£€ç´¢æ•°æ®ã€ä¸å¤–éƒ¨æœåŠ¡äº¤äº’æˆ–ç”ŸæˆåŠ¨æ€å†…å®¹ã€‚æœåŠ¡å™¨æ ¹æ®è¯·æ±‚å¤„ç†è¿™äº›æ•°æ®ï¼Œå¹¶ç”Ÿæˆå¸¦æœ‰å¿…è¦æ ‡å¤´å’Œå†…å®¹çš„ HTTP å“åº”ã€‚ çŠ¶æ€ä»£ç ï¼šHTTP å“åº”åŒ…æ‹¬æŒ‡ç¤ºè¯·æ±‚ç»“æœçš„çŠ¶æ€ä»£ç ã€‚è¿™äº›çŠ¶æ€ä»£ç çš„èŒƒå›´ä»ä¿¡æ¯æ€§ (1xx) åˆ°æˆåŠŸ (2xx)ã€é‡å®šå‘ (3xx)ã€å®¢æˆ·ç«¯é”™è¯¯ (4xx) å’ŒæœåŠ¡å™¨é”™è¯¯ (5xx)ã€‚å¸¸è§çŠ¶æ€ä»£ç åŒ…æ‹¬ 200ï¼ˆæ­£å¸¸ï¼‰ã€404ï¼ˆæœªæ‰¾åˆ°ï¼‰å’Œ 500ï¼ˆå†…éƒ¨æœåŠ¡å™¨é”™è¯¯ï¼‰ã€‚ æ— çŠ¶æ€ï¼šHTTP æ˜¯ä¸€ç§æ— çŠ¶æ€åè®®ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªè¯·æ±‚/å“åº”äº¤äº’éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå¹¶ä¸”ä¸ä¿ç•™æœ‰å…³å…ˆå‰è¯·æ±‚çš„ä¿¡æ¯ã€‚ä¸ºäº†ç»´æŠ¤ç”¨æˆ·ä¼šè¯æˆ–è·Ÿè¸ªç”¨æˆ·äº¤äº’ï¼ŒæœåŠ¡å™¨é€šå¸¸ä½¿ç”¨ cookie æˆ–ä¼šè¯ç®¡ç†æŠ€æœ¯ã€‚ HTTP æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ å½“å®¢æˆ·ç«¯æƒ³è¦ä»æœåŠ¡å™¨æ£€ç´¢ç½‘é¡µæˆ–æ–°èµ„æºæ—¶ï¼Œå®ƒä¼šå‘èµ· HTTP è¯·æ±‚ã€‚è¯¥è¯·æ±‚ç”±å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š","title":"[è¯‘]ä»€ä¹ˆæ˜¯ HTTPï¼Ÿ"},{"content":"åŸæ–‡é“¾æ¥ï¼šhttps://www.pubnub.com/guides/oauth/\nä»€ä¹ˆæ˜¯ OAuthï¼Ÿ OAuthï¼ˆå¼€æ”¾æˆæƒï¼‰æ˜¯ä¸€ç§å¼€æ”¾æ ‡å‡†æˆæƒæ¡†æ¶ï¼Œå…è®¸ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºè®¿é—®ç”¨æˆ·æ•°æ®ï¼Œè€Œæ— éœ€ç”¨æˆ·å…±äº«å…¶ç™»å½•å‡­æ®ã€‚å®ƒä¸ºç”¨æˆ·æä¾›äº†ä¸€ç§å®‰å…¨ä¸”æ ‡å‡†åŒ–çš„æ–¹å¼ï¼Œå°†å…¶åœ¨ä¸€ä¸ªç½‘ç«™ä¸Šçš„èµ„æºçš„è®¿é—®æƒé™æˆäºˆå¦ä¸€ä¸ªç½‘ç«™æˆ–åº”ç”¨ç¨‹åºï¼Œè€Œæ— éœ€æš´éœ²å…¶å¯†ç ã€‚\nç®€å•æ¥è¯´ï¼ŒOAuth å……å½“æœ€ç»ˆç”¨æˆ·å’Œä»–ä»¬æƒ³è¦æˆäºˆè®¿é—®æƒé™çš„åº”ç”¨ç¨‹åºä¹‹é—´çš„ä¸­é—´äººã€‚ç”¨æˆ·ä¸ä¼šç›´æ¥å‘ Web åº”ç”¨ç¨‹åºæä¾›ç”¨æˆ·åå’Œå¯†ç ï¼Œè€Œæ˜¯ä¼šè¢«é‡å®šå‘åˆ°æˆæƒæœåŠ¡å™¨ï¼ˆä¾‹å¦‚ Googleã€Facebook æˆ– Twitterï¼‰ï¼Œåœ¨é‚£é‡Œä»–ä»¬å¯ä»¥å®‰å…¨åœ°éªŒè¯è‡ªå·±çš„èº«ä»½ã€‚ç»è¿‡èº«ä»½éªŒè¯åï¼Œç”¨æˆ·å¯ä»¥æˆäºˆæˆ–æ‹’ç»å¯¹å…¶æƒ³è¦ä½¿ç”¨çš„åº”ç”¨ç¨‹åºä¸Šçš„æ•°æ®çš„è®¿é—®æƒé™ã€‚\nOAuth æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ OAuth ä¸ºç”¨æˆ·æä¾›äº†ä¸€ç§å®‰å…¨ä¸”æ ‡å‡†åŒ–çš„æ–¹å¼æ¥æˆæƒåº”ç”¨ç¨‹åºä»å„ç§æ¥æºï¼ˆä¾‹å¦‚ç¤¾äº¤åª’ä½“å¹³å°æˆ–åœ¨çº¿æœåŠ¡ï¼‰è®¿é—®å…¶æ•°æ®ã€‚\nOAuthå·¥ä½œæµç¨‹æ¶‰åŠä¸‰ä¸ªä¸»è¦æ–¹ï¼šç”¨æˆ·ã€åº”ç”¨ç¨‹åºå’ŒæœåŠ¡æä¾›å•†ï¼ˆä¹Ÿç§°ä¸ºOAuth æœåŠ¡å™¨ï¼‰ã€‚ä»¥ä¸‹æ˜¯ OAuth æµç¨‹çš„é«˜çº§æ¦‚è¿°ï¼š\nç”¨æˆ·å¯åŠ¨è¯¥è¿‡ç¨‹ï¼šç”¨æˆ·æƒ³è¦ä½¿ç”¨éœ€è¦è®¿é—®æœåŠ¡æä¾›å•†ä¸Šå—ä¿æŠ¤èµ„æºçš„åº”ç”¨ç¨‹åºã€‚ç”¨æˆ·é¦–å…ˆå‘åº”ç”¨ç¨‹åºè¯·æ±‚è®¿é—®æƒé™ã€‚ åº”ç”¨ç¨‹åºè¯·æ±‚æˆæƒï¼šåº”ç”¨ç¨‹åºå°†ç”¨æˆ·é‡å®šå‘åˆ°æœåŠ¡æä¾›å•†çš„æˆæƒç«¯ç‚¹ï¼Œä»¥åŠå¿…è¦çš„å‚æ•°ï¼Œä¾‹å¦‚åº”ç”¨ç¨‹åºçš„å®¢æˆ·ç«¯ ID å’Œè¯·æ±‚çš„è®¿é—®èŒƒå›´ã€‚ ç”¨æˆ·æˆäºˆæˆæƒï¼šæœåŠ¡æä¾›å•†åœ¨æˆæƒç«¯ç‚¹å‘ç”¨æˆ·æ˜¾ç¤ºç™»å½•å±å¹•ã€‚ç”¨æˆ·è¾“å…¥å…¶å‡­æ®ï¼Œå¦‚æœæœ‰æ•ˆï¼Œåˆ™ç³»ç»Ÿä¼šè¦æ±‚æˆäºˆæˆ–æ‹’ç»åº”ç”¨ç¨‹åºè®¿é—®å…¶èµ„æºçš„è¯·æ±‚ã€‚ æœåŠ¡æä¾›å•†å‘å‡ºæˆæƒä»£ç ï¼šå¦‚æœç”¨æˆ·æˆäºˆæˆæƒï¼ŒæœåŠ¡æä¾›å•†ä¼šç”Ÿæˆæˆæƒä»£ç å¹¶å°†ç”¨æˆ·é‡å®šå‘å›åº”ç”¨ç¨‹åºæŒ‡å®šçš„é‡å®šå‘ URIã€‚æˆæƒç æ˜¯ä¸€ä¸ªä¸´æ—¶ä»¤ç‰Œï¼Œä»£è¡¨ç”¨æˆ·çš„åŒæ„ã€‚ åº”ç”¨ç¨‹åºç”¨æˆæƒä»£ç äº¤æ¢è®¿é—®ä»¤ç‰Œï¼šç°åœ¨æ‹¥æœ‰æˆæƒä»£ç çš„åº”ç”¨ç¨‹åºå‘æœåŠ¡æä¾›å•†å‘é€è¯·æ±‚ï¼Œä»¥ç”¨ä»£ç äº¤æ¢è®¿é—®ä»¤ç‰Œã€‚è¯¥è¯·æ±‚åŒ…æ‹¬ä»£ç ã€åº”ç”¨ç¨‹åºçš„å®¢æˆ·ç«¯ ID å’Œå®¢æˆ·ç«¯å¯†é’¥ï¼Œå®ƒä»¬ç”¨äºå‘æœåŠ¡æä¾›å•†éªŒè¯åº”ç”¨ç¨‹åºçš„èº«ä»½ã€‚ æœåŠ¡æä¾›å•†éªŒè¯æˆæƒä»£ç ï¼šæœåŠ¡æä¾›å•†å¯¹å…¶è¿›è¡ŒéªŒè¯å¹¶æ£€æŸ¥å®ƒæ˜¯å¦ä¸ä¹‹å‰ä¸ºç”¨æˆ·ç”Ÿæˆçš„æˆæƒä»£ç ç›¸åŒ¹é…ã€‚å¦‚æœä»£ç æœ‰æ•ˆï¼ŒæœåŠ¡æä¾›å•†å°†å‘åº”ç”¨ç¨‹åºé¢å‘è®¿é—®ä»¤ç‰Œã€‚ åº”ç”¨ç¨‹åºä½¿ç”¨è®¿é—®ä»¤ç‰Œæ¥è®¿é—®å—ä¿æŠ¤çš„èµ„æºï¼šé€šè¿‡ä»æœåŠ¡æä¾›å•†è·å¾—çš„è®¿é—®ä»¤ç‰Œï¼Œåº”ç”¨ç¨‹åºç°åœ¨å¯ä»¥ä»£è¡¨ç”¨æˆ·å‘å‡ºè¯·æ±‚ä»¥è®¿é—®å…¶å—ä¿æŠ¤çš„èµ„æºã€‚è¿™äº›è¯·æ±‚é€šå¸¸æ˜¯å‘æœåŠ¡æä¾›å•†çš„ API ç«¯ç‚¹å‘å‡ºçš„ã€‚ è®¿é—®ä»¤ç‰Œè¿‡æœŸå’Œåˆ·æ–°ï¼šè®¿é—®ä»¤ç‰Œçš„ç”Ÿå‘½å‘¨æœŸæœ‰é™ï¼Œè¿‡æœŸåå°±ä¼šè¿‡æœŸã€‚è¦ç»§ç»­è®¿é—®ç”¨æˆ·çš„èµ„æºï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨åˆ·æ–°ä»¤ç‰Œï¼ˆå¦‚æœæä¾›ï¼‰æ¥è·å–æ–°çš„è®¿é—®ä»¤ç‰Œï¼Œè€Œæ— éœ€ç”¨æˆ·çš„å‚ä¸ã€‚ ä½¿ç”¨ OAuth æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ è¿™ç§å¹¿æ³›é‡‡ç”¨çš„åè®®ä¸ºæ„å»ºå®æ—¶èŠå¤©å’Œæ¶ˆæ¯åº”ç”¨ç¨‹åºçš„å¼€å‘äººå‘˜æä¾›äº†å¤šç§å¥½å¤„ï¼š\nå¢å¼ºçš„å®‰å…¨æ€§ï¼š OAuth æ¶ˆé™¤äº†åº”ç”¨ç¨‹åºéœ€è¦å­˜å‚¨ç”¨æˆ·å‡­æ®çš„æƒ…å†µï¼Œä»è€Œé™ä½äº†æœªç»æˆæƒè®¿é—®çš„é£é™©ã€‚é€šè¿‡åˆ©ç”¨ OAuthï¼Œå¼€å‘äººå‘˜å¯ä»¥å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯å’Œæˆæƒï¼Œè€Œæ— éœ€å¤„ç†ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯ï¼ˆä¾‹å¦‚å¯†ç ï¼‰ã€‚è¿™æ˜¾ç€é™ä½äº†æ•°æ®æ³„éœ²çš„å¯èƒ½æ€§å¹¶å¢å¼ºäº†æ•´ä½“åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ã€‚\nç®€åŒ–çš„ç”¨æˆ·ä½“éªŒï¼š OAuth ä½¿ç”¨æˆ·èƒ½å¤Ÿå‘ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºæˆäºˆæƒé™è€Œæ— éœ€å…±äº«å…¶å‡­æ®ï¼Œä»è€Œæä¾›æ— ç¼ä¸”ç”¨æˆ·å‹å¥½çš„ä½“éªŒã€‚è¿™æ¶ˆé™¤äº†ä¸ºæ¯ä¸ªåº”ç”¨ç¨‹åºåˆ›å»ºå’Œç®¡ç†å•ç‹¬å¸æˆ·çš„éº»çƒ¦ï¼Œä»è€Œæé«˜äº†ä¾¿åˆ©æ€§å’Œç”¨æˆ·é‡‡ç”¨ç‡ã€‚\nå¯æ‰©å±•æ€§å’Œäº’æ“ä½œæ€§ï¼š OAuth ä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿæ„å»ºé›†æˆå¤šä¸ªå¹³å°å’ŒæœåŠ¡çš„åº”ç”¨ç¨‹åºã€‚é€šè¿‡åˆ©ç”¨ OAuthï¼Œå¼€å‘äººå‘˜å¯ä»¥è½»æ¾åœ°éªŒè¯å’Œè®¿é—®æ¥è‡ªä¸åŒæä¾›å•†çš„èµ„æºï¼Œä»è€Œå…è®¸ä»–ä»¬çš„èŠå¤©å’Œæ¶ˆæ¯åº”ç”¨ç¨‹åºä¸å…¶ä»–ç³»ç»Ÿæ— ç¼äº¤äº’ã€‚è¿™å¢å¼ºäº†å¯æ‰©å±•æ€§ï¼Œå¹¶ä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿåˆ©ç”¨ä¸åŒå¹³å°çš„ç°æœ‰ç”¨æˆ·ç¾¤ã€‚\nç»†ç²’åº¦çš„è®¿é—®æ§åˆ¶ï¼š OAuth å…è®¸å¼€å‘äººå‘˜ä¸ºå…¶èŠå¤©å’Œæ¶ˆæ¯åº”ç”¨ç¨‹åºå®æ–½ç»†ç²’åº¦çš„è®¿é—®æ§åˆ¶ã€‚å¯ä»¥ä¸ºæ¯ä¸ªèµ„æºæˆäºˆæƒé™ï¼Œç¡®ä¿ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºåªèƒ½è®¿é—®æ‰€éœ€çš„èµ„æºã€‚è¿™ç§å¯¹è®¿é—®çš„ç²¾ç»†æ§åˆ¶æœ‰åŠ©äºç»´æŠ¤æ•°æ®éšç§å’Œæ§åˆ¶ï¼Œé™ä½æœªç»æˆæƒçš„æ•°æ®æ³„éœ²çš„é£é™©ã€‚\nå¼€å‘äººå‘˜å‹å¥½ï¼š OAuth æä¾›äº†ä¸€ä¸ªç®€å•ã€å¼€å‘äººå‘˜å‹å¥½çš„æ¡†æ¶ï¼Œç”¨äºåœ¨èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºä¸­å®ç°èº«ä»½éªŒè¯å’Œæˆæƒã€‚è¯¥åè®®æœ‰è¯¦ç»†çš„æ–‡æ¡£è®°å½•ï¼Œå¹¶å—åˆ°å„ç§åº“å’Œ SDK çš„æ”¯æŒï¼Œä½¿å¼€å‘äººå‘˜å¯ä»¥è½»æ¾åœ°å°† OAuth é›†æˆåˆ°ä»–ä»¬çš„åº”ç”¨ç¨‹åºä¸­ã€‚æ­¤å¤–ï¼ŒOAuth é€šè¿‡å†…ç½®çš„ä»¤ç‰Œè¿‡æœŸå’Œæ’¤é”€æœºåˆ¶ç®€åŒ–äº†è®¿é—®ä»¤ç‰Œçš„ç®¡ç†ã€‚è¿™ç®€åŒ–äº†å¼€å‘æµç¨‹å¹¶é™ä½äº†å¤„ç†ç”¨æˆ·èº«ä»½éªŒè¯å’Œæˆæƒçš„å¤æ‚æ€§ã€‚\nä½¿ç”¨ OAuth æœ‰å“ªäº›ç¼ºç‚¹ï¼Ÿ è™½ç„¶ OAuth å¯¹äºæ„å»ºå®æ—¶èŠå¤©å’Œæ¶ˆæ¯åº”ç”¨ç¨‹åºçš„å¼€å‘äººå‘˜æ¥è¯´å…·æœ‰ä¼—å¤šä¼˜åŠ¿ï¼Œä½†ä¹Ÿå­˜åœ¨ä¸€äº›ç¼ºç‚¹ã€‚è¿™äº›ç¼ºç‚¹åŒ…æ‹¬ï¼š\n**å¤æ‚æ€§ï¼š**å®æ–½ OAuth å¯èƒ½å¾ˆå¤æ‚ï¼Œå°¤å…¶æ˜¯å¯¹äºä¸ç†Ÿæ‚‰è¯¥åè®®çš„å¼€å‘äººå‘˜è€Œè¨€ã€‚è¯¥è¿‡ç¨‹æ¶‰åŠå¤šä¸ªæ­¥éª¤ï¼ŒåŒ…æ‹¬æ³¨å†Œåº”ç”¨ç¨‹åºã€è·å–å®¢æˆ·ç«¯å‡­æ®å’Œå¤„ç†æˆæƒæµç¨‹ã€‚ä¸å¤šä¸ªèº«ä»½æä¾›å•†é›†æˆæˆ–å¤„ç†åˆ·æ–°ä»¤ç‰Œæ—¶ï¼Œå¤æ‚æ€§å¯èƒ½ä¼šè¿›ä¸€æ­¥å¢åŠ ã€‚å¼€å‘äººå‘˜éœ€è¦æŠ•å…¥æ—¶é—´å’Œç²¾åŠ›æ¥æ­£ç¡®ç†è§£å’Œå®æ–½ OAuthã€‚\nå¯¹ç¬¬ä¸‰æ–¹æä¾›å•†çš„ä¾èµ–ï¼š OAuth ä¾èµ–ç¬¬ä¸‰æ–¹èº«ä»½æä¾›å•†æ¥å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯å’Œæˆæƒã€‚è¿™ç§ä¾èµ–æ€§å¼•å…¥äº†æ½œåœ¨çš„å•ç‚¹æ•…éšœã€‚å¦‚æœèº«ä»½æä¾›å•†é‡åˆ°ä¸­æ–­æˆ–æ›´æ”¹å…¶ APIï¼Œåˆ™å¯èƒ½ä¼šä¸­æ–­èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºçš„èº«ä»½éªŒè¯å’Œæˆæƒè¿‡ç¨‹ã€‚å¼€å‘äººå‘˜éœ€è¦è€ƒè™‘æ‰€é€‰èº«ä»½æä¾›å•†çš„å¯é æ€§å’Œå¯¿å‘½ã€‚\nç”¨æˆ·éšç§é—®é¢˜ï¼š OAuth æä¾›äº†ä¸€ç§å®‰å…¨çš„èº«ä»½éªŒè¯å’Œæˆæƒæœºåˆ¶ï¼Œä½†ä¸€äº›ç”¨æˆ·å¯èƒ½æ‹…å¿ƒä¸ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºå…±äº«å…¶ä¸ªäººä¿¡æ¯ã€‚å°½ç®¡ OAuth ä¸ä¼šå…¬å¼€å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯ï¼Œä½†ç”¨æˆ·ä»ç„¶éœ€è¦æˆäºˆè®¿é—®å…¶æ•°æ®çš„æƒé™ã€‚æŸäº›ç”¨æˆ·å¯èƒ½ä¼šçŠ¹è±«æ˜¯å¦æˆäºˆè¿™äº›æƒé™ï¼Œå°¤å…¶æ˜¯å¯¹äºé²œä¸ºäººçŸ¥æˆ–ä¸å¤ªå—ä¿¡ä»»çš„åº”ç”¨ç¨‹åºã€‚\n**ç¼ºä¹æ ‡å‡†åŒ–ï¼š**å°½ç®¡ OAuth è¢«å¹¿æ³›é‡‡ç”¨ï¼Œä½†ä¸åŒæä¾›å•†å’Œå¹³å°çš„å®æ–½å¯èƒ½å­˜åœ¨å·®å¼‚ã€‚ç¼ºä¹æ ‡å‡†åŒ–å¯èƒ½ä¼šå¯¼è‡´ä¸å¤šä¸ªç³»ç»Ÿé›†æˆæ—¶å‡ºç°ä¸ä¸€è‡´å’Œå…¼å®¹æ€§é—®é¢˜ã€‚å¼€å‘äººå‘˜å¯èƒ½éœ€è¦é¢å¤–çš„åŠªåŠ›æ¥å¤„ç†è¿™äº›å˜åŒ–å¹¶ç¡®ä¿ä¸åŒå¹³å°å’Œæä¾›å•†ä¹‹é—´çš„å…¼å®¹æ€§ã€‚\n**å®‰å…¨æ¼æ´ï¼š**è™½ç„¶ OAuth çš„è®¾è®¡æ˜¯å®‰å…¨çš„ï¼Œä½†ä¹Ÿå­˜åœ¨å‘ç°å’Œåˆ©ç”¨æ¼æ´çš„æƒ…å†µã€‚è¿™äº›æ¼æ´å¯èƒ½å¯¼è‡´æœªç»æˆæƒçš„ç”¨æˆ·æ•°æ®è®¿é—®æˆ–å†’å……æ”»å‡»ã€‚å¼€å‘äººå‘˜å¿…é¡»åŠæ—¶äº†è§£æœ€æ–°çš„å®‰å…¨æœ€ä½³å®è·µï¼Œå¹¶å®šæœŸä¿®è¡¥ OAuth å®æ–½ä¸­çš„ä»»ä½•æ¼æ´ã€‚\nOAuth ä¸ OpenID OAuth å’ŒOpenIDæ˜¯å¹¿æ³›ä½¿ç”¨çš„èº«ä»½éªŒè¯å’Œæˆæƒåè®®ï¼Œä½†ç”¨é€”ä¸åŒã€‚\nOAuth ä¸»è¦æ˜¯ä¸€ç§æˆæƒåè®®ï¼Œå…è®¸åº”ç”¨ç¨‹åºè®¿é—®å¦ä¸€ä¸ªç³»ç»Ÿä¸Šçš„ç”¨æˆ·èµ„æºï¼Œè€Œæ— éœ€å…±äº«å…¶å‡­æ®ã€‚å®ƒé€šå¸¸ç”¨äºå§”æ‰˜æˆæƒåœºæ™¯ï¼Œå³ç”¨æˆ·å‘ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºæˆäºˆè®¿é—®å…¶åœ¨ç‰¹å®šç½‘ç«™æˆ–æœåŠ¡ä¸Šçš„æ•°æ®çš„æƒé™ã€‚ä¾‹å¦‚ï¼Œå½“æ‚¨ä½¿ç”¨ Google å¸æˆ·ç™»å½•ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºæ—¶ï¼ŒOAuth é€šå¸¸ç”¨äºæˆäºˆè¯¥åº”ç”¨ç¨‹åºè®¿é—®æ‚¨çš„ Google äº‘ç«¯ç¡¬ç›˜æˆ– Gmail æ•°æ®çš„æƒé™ã€‚\nå¦ä¸€æ–¹é¢ï¼ŒOpenID æ˜¯ä¸€ç§èº«ä»½éªŒè¯åè®®ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿä½¿ç”¨ä¸€ç»„å‡­æ®åœ¨å¤šä¸ªç½‘ç«™æˆ–åº”ç”¨ç¨‹åºä¸­å¯¹è‡ªå·±è¿›è¡Œèº«ä»½éªŒè¯ã€‚å®ƒå…è®¸ç”¨æˆ·ä½¿ç”¨å…¶ OpenID å‡­æ®ç™»å½•å¤šä¸ªç½‘ç«™ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ä¸ªç½‘ç«™åˆ›å»ºå•ç‹¬çš„ç”¨æˆ·åå’Œå¯†ç ã€‚ OpenID é€šå¸¸ç”¨ä½œå•ç‚¹ç™»å½• (SSO ) è§£å†³æ–¹æ¡ˆï¼Œä¸ºä¸æƒ³è®°ä½å¤šä¸ªç™»å½•å‡­æ®çš„ç”¨æˆ·æä¾›ä¾¿åˆ©ã€‚\nOAuth ä¸ OpenID Connect OAuth å’ŒOpenID Connectç»å¸¸å‡ºç°åœ¨ authï¼ˆèº«ä»½éªŒè¯å’Œæˆæƒï¼‰åè®®æ–¹é¢ã€‚è™½ç„¶å®ƒä»¬æ˜¯ç›¸å…³çš„å¹¶ä¸”å…·æœ‰ç›¸ä¼¼çš„ç›®çš„ï¼Œä½†å®ƒä»¬ä¹Ÿæœ‰ä¸€äº›å…³é”®çš„åŒºåˆ«ã€‚æœ¬èŠ‚å°†æ¢è®¨è¿™äº›å·®å¼‚å¹¶å¸®åŠ©æ‚¨äº†è§£ä½•æ—¶ä½¿ç”¨å…¶ä¸­ä¸€ç§è€Œä¸æ˜¯å¦ä¸€ç§ã€‚\nOAuthï¼šä¸“æ³¨äºæˆæƒ\nå¦‚å‰æ‰€è¿°ï¼ŒOAuth ä¸»è¦æ˜¯ä¸€ç§æˆæƒåè®®ã€‚å…¶ä¸»è¦ç›®çš„æ˜¯å…è®¸åº”ç”¨ç¨‹åºè®¿é—®å¦ä¸€ä¸ªç³»ç»Ÿä¸Šçš„ç”¨æˆ·èµ„æºï¼Œè€Œæ— éœ€å…±äº«å…¶å‡­æ®ã€‚è¿™æ˜¯é€šè¿‡ä½¿ç”¨è®¿é—®ä»¤ç‰Œæ¥å®ç°çš„ã€‚\nOAuth çš„å…¸å‹ç”¨ä¾‹æ˜¯å½“ç”¨æˆ·æƒ³è¦æˆäºˆç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºè®¿é—®å…¶åœ¨ç‰¹å®šç½‘ç«™æˆ–æœåŠ¡ä¸Šçš„æ•°æ®çš„æƒé™æ—¶ã€‚ä¾‹å¦‚ï¼Œå½“æ‚¨ä½¿ç”¨ Google å¸æˆ·ç™»å½•ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºæ—¶ï¼ŒOAuth é€šå¸¸ç”¨äºæˆäºˆè¯¥åº”ç”¨ç¨‹åºè®¿é—®æ‚¨çš„ Google äº‘ç«¯ç¡¬ç›˜æˆ– Gmail æ•°æ®çš„æƒé™ã€‚\nOpenID Connectï¼šä¸“æ³¨äºèº«ä»½éªŒè¯\nå¦ä¸€æ–¹é¢ï¼ŒOpenID Connect æ˜¯ä¸€ç§èº«ä»½éªŒè¯åè®®ã€‚å…¶ä¸»è¦ç›®æ ‡æ˜¯ä¸ºç”¨æˆ·æä¾›ä¸€ç§æ ‡å‡†åŒ–çš„æ–¹å¼æ¥è·¨å¤šä¸ªç½‘ç«™æˆ–åº”ç”¨ç¨‹åºè¿›è¡Œèº«ä»½éªŒè¯ã€‚å®ƒå…è®¸ç”¨æˆ·ä½¿ç”¨ä¸€ç»„å‡­æ®ï¼ˆOpenIDï¼‰ç™»å½•å¤šä¸ªç«™ç‚¹ï¼Œä»è€Œæ— éœ€è®°ä½å¤šä¸ªç”¨æˆ·åå’Œå¯†ç ã€‚\né™¤äº†èº«ä»½éªŒè¯ä¹‹å¤–ï¼ŒOpenID Connect è¿˜æä¾›æœ‰å…³ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯ï¼Œä¾‹å¦‚å§“åå’Œç”µå­é‚®ä»¶åœ°å€ã€‚æ­¤ä¿¡æ¯å¯ç”¨äºåº”ç”¨ç¨‹åºå†…çš„ä¸ªæ€§åŒ–å’Œå®šåˆ¶ç›®çš„ã€‚\nOAuth å’Œ OpenID Connect ä¹‹é—´çš„ä¸»è¦åŒºåˆ«ä¹‹ä¸€æ˜¯ç”¨æˆ·äº¤äº’çº§åˆ«ã€‚å½“ç”¨æˆ·å‘ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºæˆäºˆå¯¹å…¶èµ„æºçš„è®¿é—®æƒé™æ—¶ï¼Œé€šå¸¸ä¼šä½¿ç”¨ OAuthã€‚ç³»ç»Ÿå¯èƒ½ä¼šæç¤ºç”¨æˆ·ç™»å½•å…¶å¸æˆ·å¹¶æˆäºˆæƒé™ï¼Œä½†é‡ç‚¹æ˜¯èµ„æºè®¿é—®è€Œä¸æ˜¯èº«ä»½éªŒè¯ã€‚\nå¦ä¸€æ–¹é¢ï¼ŒOpenID Connect æ˜¯ä¸“é—¨ä¸ºèº«ä»½éªŒè¯è€Œè®¾è®¡çš„ã€‚å®ƒå…è®¸ç”¨æˆ·ä½¿ç”¨ä¸€ç»„å‡­æ®è¯æ˜è‡ªå·±çš„èº«ä»½å¹¶ç™»å½•å¤šä¸ªç«™ç‚¹ã€‚è¿™æ˜¯é€šè¿‡ OpenID æä¾›å•†ï¼ˆä¾‹å¦‚ Google æˆ– Facebookï¼‰é¢å‘çš„ OpenID ä»¤ç‰Œæ¥å®ç°çš„ï¼Œå¹¶ä¸”å¯ç”¨äºè·¨å¤šä¸ªç«™ç‚¹å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ã€‚\nOAuth å’Œ OpenID Connect ä¹‹é—´çš„å¦ä¸€ä¸ªåŒºåˆ«æ˜¯æä¾›çš„å®‰å…¨çº§åˆ«ã€‚ OAuth ä¾§é‡äºæˆæƒå’Œè®¿é—®æ§åˆ¶ï¼Œç¡®ä¿åªæœ‰æˆæƒçš„åº”ç”¨ç¨‹åºæ‰èƒ½è®¿é—®ç”¨æˆ·çš„èµ„æºã€‚å®ƒä¸ç›´æ¥æä¾›èº«ä»½éªŒè¯æˆ–èº«ä»½ä¿¡æ¯ã€‚\nç®€è€Œè¨€ä¹‹ï¼ŒOpenID Connect åœ¨ OAuth ä¹‹ä¸Šæ·»åŠ äº†ä¸€ä¸ªèº«ä»½éªŒè¯å±‚ã€‚å®ƒå…è®¸ç”¨æˆ·éªŒè¯è‡ªå·±çš„èº«ä»½å¹¶æä¾›æœ‰å…³ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯ã€‚æ­¤ä¿¡æ¯æ˜¯é€šè¿‡ ID ä»¤ç‰Œè·å–çš„ï¼ŒID ä»¤ç‰Œç”± OpenID æä¾›å•†é¢å‘å¹¶åŒ…å«ç”¨æˆ·å§“åå’Œç”µå­é‚®ä»¶åœ°å€ç­‰ä¿¡æ¯ã€‚\nOAuth ä¸ SAML OAuth å’Œ[SAML](https://support.google.com/a/answer/6262987?hl=en#:~:text=Security Assertion Markup Language (SAML,trying to access secure content.)éƒ½æ˜¯å¹¿æ³›ä½¿ç”¨çš„èº«ä»½éªŒè¯å’Œæˆæƒåè®®ï¼Œä½†å®ƒä»¬å…·æœ‰ä¸åŒçš„ç”¨ä¾‹å’Œè®¾è®¡ç†å¿µã€‚\nOAuth é€šå¸¸ç”¨äºå§”æ‰˜æˆæƒåœºæ™¯ï¼Œä¾‹å¦‚å…è®¸ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºè®¿é—®ç‰¹å®šç½‘ç«™æˆ–æœåŠ¡ä¸Šçš„ç”¨æˆ·æ•°æ®ã€‚å®ƒè¢«è®¾è®¡ä¸ºè½»é‡çº§ã€å¯æ‰©å±•ä¸”æ˜“äºå®æ–½ï¼Œä½¿å…¶æˆä¸ºé›†æˆå¤–éƒ¨æœåŠ¡å’Œ API çš„æµè¡Œé€‰æ‹©ã€‚\nå¦ä¸€æ–¹é¢ï¼ŒSAMLï¼ˆå®‰å…¨æ–­è¨€æ ‡è®°è¯­è¨€ï¼‰æ˜¯ä¸€ç§åŸºäº XML çš„åè®®ï¼Œç”¨äºåœ¨èº«ä»½æä¾›å•† (IdP) å’ŒæœåŠ¡æä¾›å•† (SP) ä¹‹é—´äº¤æ¢èº«ä»½éªŒè¯å’Œæˆæƒæ•°æ®ã€‚å®ƒé€šå¸¸ç”¨äºå•ç‚¹ç™»å½• (SSO) åœºæ™¯ï¼Œå…¶ä¸­ç”¨æˆ·å¯ä»¥ä½¿ç”¨ä¸€ç»„å‡­æ®ç™»å½•å¤šä¸ªç½‘ç«™æˆ–åº”ç”¨ç¨‹åºã€‚ SAML ä½¿ IdP èƒ½å¤Ÿé€šè¿‡æ•°å­—ç­¾åçš„ XML æ–‡æ¡£å‘ SP æ–­è¨€ç”¨æˆ·çš„èº«ä»½ã€‚è¿™å¯ä»¥å®ç°é›†ä¸­ä¸”å®‰å…¨çš„èº«ä»½éªŒè¯æœºåˆ¶ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¼ä¸šç¯å¢ƒä¸­ã€‚\næ¯”è¾ƒ OAuth å’Œ SAML æ—¶ï¼Œéœ€è¦è€ƒè™‘å‡ ä¸ªå…³é”®å·®å¼‚ï¼š\nç”¨ä¾‹ï¼šOAuth ä¸»è¦å…³æ³¨å§”æ´¾æˆæƒï¼Œæˆäºˆå¯¹å¦ä¸€ä¸ªç³»ç»Ÿä¸Šçš„ç”¨æˆ·èµ„æºçš„è®¿é—®æƒé™ã€‚å¦ä¸€æ–¹é¢ï¼ŒSAML ä¸“æ³¨äºèº«ä»½éªŒè¯å¹¶æ”¯æŒè·¨å¤šä¸ªç³»ç»Ÿçš„ SSOã€‚ æ¶æ„ï¼šOAuth éµå¾ªåˆ†æ•£å¼æ¶æ„ï¼Œå…¶ä¸­ç”¨æˆ·ã€å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå’Œèµ„æºæœåŠ¡å™¨æ˜¯ç‹¬ç«‹çš„å®ä½“ã€‚ SAML éµå¾ªé›†ä¸­å¼æ¶æ„ï¼Œå…¶ä¸­èº«ä»½æä¾›å•† (IdP) æ˜¯èº«ä»½éªŒè¯å’Œæˆæƒçš„ä¸­å¤®æœºæ„ã€‚ åè®®ï¼šOAuthä½¿ç”¨OAuthåè®®ï¼Œè¯¥åè®®åŸºäºHTTPå’ŒJSONï¼Œä½¿å…¶è½»é‡çº§ä¸”æ˜“äºå®ç°ã€‚å¦ä¸€æ–¹é¢ï¼ŒSAMLä½¿ç”¨SAMLåè®®ï¼Œè¯¥åè®®åŸºäºXMLï¼Œå®ç°èµ·æ¥æ¯”è¾ƒå¤æ‚ã€‚ é›†æˆï¼šOAuthé€šå¸¸ç”¨äºä¸å¤–éƒ¨æœåŠ¡å’ŒAPIé›†æˆï¼Œå…è®¸ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºè®¿é—®ç”¨æˆ·èµ„æºã€‚ SAML é€šå¸¸ç”¨äºä¸ä¼ä¸šç³»ç»Ÿé›†æˆå¹¶æ”¯æŒè·¨å¤šä¸ªç½‘ç«™æˆ–åº”ç”¨ç¨‹åºçš„ SSOã€‚ å®‰å…¨æ€§ï¼šOAuth ä½¿ç”¨è®¿é—®ä»¤ç‰Œå‘ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºæˆäºˆæƒé™ï¼Œå…è®¸å®ƒä»¬åœ¨ä¸å…±äº«å‡­æ®çš„æƒ…å†µä¸‹è®¿é—®ç”¨æˆ·èµ„æºã€‚ç›¸åï¼ŒSAML ä½¿ç”¨æ•°å­—ç­¾åçš„ XML æ–‡æ¡£æ¥æ–­è¨€ç”¨æˆ·çš„èº«ä»½ï¼Œä»è€Œæä¾›æ›´å®‰å…¨çš„èº«ä»½éªŒè¯æœºåˆ¶ã€‚ OAuth æœ‰å“ªäº›ä¸åŒç‰ˆæœ¬ï¼Ÿ å¤šå¹´æ¥ï¼Œå·²ç»å‘å¸ƒäº†å¤šä¸ª OAuth ç‰ˆæœ¬æ¥è§£å†³å®‰å…¨é—®é¢˜å¹¶æ”¹è¿›åŠŸèƒ½ã€‚è®©æˆ‘ä»¬æ¢è®¨ä¸€ä¸‹ OAuth çš„ä¸åŒç‰ˆæœ¬ï¼š\nOAuth 1.0ï¼š\nOAuth 1.0 æ˜¯å®šä¹‰æˆæƒæ ¸å¿ƒåŸåˆ™çš„åˆå§‹åè®®ç‰ˆæœ¬ã€‚å®ƒå¼•å…¥äº†ä»¤ç‰Œï¼ˆè¯·æ±‚å’Œè®¿é—®ä»¤ç‰Œï¼‰çš„æ¦‚å¿µæ¥æˆäºˆå¯¹å—ä¿æŠ¤èµ„æºçš„è®¿é—®æƒé™ã€‚ç„¶è€Œï¼ŒOAuth 1.0 å­˜åœ¨å¤šä¸ªå®‰å…¨ç¼ºé™·ï¼ŒåŒ…æ‹¬è¦æ±‚å…±äº«æ¶ˆè´¹è€…å¯†é’¥ï¼Œä½¿å…¶å®¹æ˜“å—åˆ°æ‹¦æˆªæ”»å‡»ã€‚\nOAuth 1.0aï¼š\nOAuth 1.0a æ˜¯ OAuth 1.0 çš„æ›´æ–°ï¼Œè§£å†³äº†åŸå§‹ç‰ˆæœ¬ä¸­çš„å®‰å…¨æ¼æ´ã€‚å®ƒæ·»åŠ äº†ç­¾åæœºåˆ¶æ¥é˜²æ­¢ä»¤ç‰Œæ‹¦æˆªæ”»å‡»ã€‚ OAuth 1.0a ä½¿ç”¨ä¸‰è¶³æˆæƒæµç¨‹ï¼Œæ¶‰åŠç”¨æˆ·ã€å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå’ŒæœåŠ¡æä¾›å•†ã€‚\nOAuth 2.0ï¼š\nOAuth 2.0 æ˜¯å¯¹ OAuth 1.0 çš„å½»åº•é‡æ–°è®¾è®¡å’Œæ”¹è¿›ã€‚å®ƒç®€åŒ–äº†æˆæƒè¿‡ç¨‹ï¼ŒåŒæ—¶è§£å†³äº†å…¶å‰èº«çš„ç¼ºç‚¹ã€‚ OAuth 2.0 å¼•å…¥äº†æ›´çµæ´»å’Œå¯æ‰©å±•çš„æ¡†æ¶ï¼Œæ”¯æŒå„ç§æˆæƒæµç¨‹ï¼Œä¾‹å¦‚æˆæƒä»£ç ã€éšå¼ã€èµ„æºæ‰€æœ‰è€…å¯†ç å‡­æ®å’Œå®¢æˆ·ç«¯å‡­æ®ã€‚å®ƒè¿˜å…è®¸ä½¿ç”¨ä¸åŒçš„èº«ä»½éªŒè¯æœºåˆ¶ï¼Œä¾‹å¦‚ç”¨æˆ·å/å¯†ç å’Œ JWTï¼ˆJSON Web ä»¤ç‰Œï¼‰ã€‚\nOAuth 2.1ï¼š\nOAuth 2.1 æ˜¯ OAuth åè®®çš„æœ€æ–°ç‰ˆæœ¬ï¼Œäº 2021 å¹´å‘å¸ƒã€‚å®ƒçš„é‡ç‚¹æ˜¯æé«˜å®‰å…¨æ€§ã€æ¾„æ¸…æ­§ä¹‰å¹¶ä¸ºå¼€å‘äººå‘˜æä¾›æ›´å¥½çš„æŒ‡å¯¼ã€‚ OAuth 2.1 å¯¹æˆæƒä»£ç æµå¼•å…¥äº†æ›´ä¸¥æ ¼çš„è¦æ±‚ï¼Œå¹¶æä¾›äº†å®æ–½å®‰å…¨ä»¤ç‰Œå¤„ç†å’Œæ’¤é”€çš„å»ºè®®ã€‚å®ƒè¿˜åŒ…æ‹¬å¤„ç†åˆ·æ–°ä»¤ç‰Œå’Œå®¢æˆ·ç«¯èº«ä»½éªŒè¯çš„é¢å¤–å®‰å…¨æ³¨æ„äº‹é¡¹ã€‚\nOAuth 1.0 å’Œ OAuth 2.0 ä¹‹é—´çš„ä¸»è¦åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ\nOAuth 1.0 å’Œ OAuth 2.0 åœ¨è®¾è®¡å’ŒåŠŸèƒ½ä¸Šæœ‰æ˜¾ç€ä¸åŒã€‚ä»¥ä¸‹æ˜¯ä¸¤ä¸ªç‰ˆæœ¬ä¹‹é—´çš„ä¸€äº›ä¸»è¦åŒºåˆ«ï¼š\nå¤æ‚ï¼š\nä¸ OAuth 2.0 ç›¸æ¯”ï¼ŒOAuth 1.0 çš„è®¾è®¡æ›´åŠ å¤æ‚å’Œä¸¥æ ¼ã€‚å®ƒéœ€è¦åŠ å¯†ç­¾åå’Œè¯·æ±‚æ—¶é—´æˆ³ï¼Œä½¿å¾—å®æ–½è¿‡ç¨‹æ›´å…·æŒ‘æˆ˜æ€§ã€‚ç›¸åï¼ŒOAuth 2.0 ä½¿ç”¨è®¿é—®ä»¤ç‰Œæä¾›äº†æ›´ç®€å•ã€æ›´çµæ´»çš„æ¡†æ¶ã€‚\nä»£å¸ç”¨é€”ï¼š\nåœ¨ OAuth 1.0 ä¸­ï¼Œæ¯ä¸ª API è¯·æ±‚ä¸­éƒ½ä¼šä½¿ç”¨è¯·æ±‚ä»¤ç‰Œå’Œè®¿é—®ä»¤ç‰Œï¼Œä»è€Œå¯¼è‡´é¢å¤–çš„å¼€é”€å’Œå¤æ‚æ€§ã€‚ OAuth 2.0ä¸»è¦ä½¿ç”¨è®¿é—®ä»¤ç‰Œï¼Œç®€åŒ–äº†ä»¤ç‰Œç®¡ç†æµç¨‹ã€‚\nå®‰å…¨æ¨¡å‹ï¼š\nOAuth 1.0 ä¾é ç­¾åå’Œæ—¶é—´æˆ³æ¥ç¡®ä¿æ¶ˆæ¯å®Œæ•´æ€§å¹¶é˜²æ­¢é‡æ”¾æ”»å‡»ã€‚ OAuth 2.0æ›´å…³æ³¨ä¼ è¾“å®‰å…¨ï¼ˆä¾‹å¦‚HTTPSï¼‰ï¼Œå¹¶å°†ä»¤ç‰Œå®‰å…¨çš„è´£ä»»ç•™ç»™äº†åº•å±‚æœºåˆ¶ï¼Œä¾‹å¦‚å®‰å…¨å­˜å‚¨å’Œä¼ è¾“ã€‚ OAuth 2.0 è¿˜å¼•å…¥äº†åˆ·æ–°ä»¤ç‰Œçš„æ¦‚å¿µï¼Œç”¨äºåœ¨ä¸æ¶‰åŠç”¨æˆ·çš„æƒ…å†µä¸‹è·å–æ–°çš„è®¿é—®ä»¤ç‰Œã€‚\næˆæƒæµç¨‹ï¼š\nOAuth 1.0ä»…æ”¯æŒä¸€ç§æˆæƒæµç¨‹ï¼Œå³ä¸‰è¶³ä¸€æµç¨‹ã€‚æ­¤æµç¨‹æ¶‰åŠç”¨æˆ·ã€å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå’ŒæœåŠ¡æä¾›å•†ã€‚å¦ä¸€æ–¹é¢ï¼ŒOAuth 2.0 å¼•å…¥äº†å¤šç§æˆæƒæµç¨‹ï¼Œä¸ºä¸åŒçš„ç”¨ä¾‹æä¾›äº†æ›´å¤šçš„çµæ´»æ€§å’Œé€‰é¡¹ã€‚\nåº”ç”¨èŒƒå›´ï¼š\nOAuth 1.0 ä¸»è¦æ˜¯ä¸º Web åº”ç”¨ç¨‹åºè®¾è®¡çš„ï¼Œç¼ºä¹å¯¹ç§»åŠ¨å’Œæ¡Œé¢åº”ç”¨ç¨‹åºçš„æœ¬æœºæ”¯æŒã€‚å¦ä¸€æ–¹é¢ï¼ŒOAuth 2.0 æ—¨åœ¨æ»¡è¶³æ›´å¹¿æ³›çš„åº”ç”¨ç¨‹åºï¼ŒåŒ…æ‹¬ Webã€ç§»åŠ¨å’Œæ¡Œé¢ã€‚\næ ‡å‡†åŒ–ï¼š\nOAuth 1.0 ç¼ºä¹æ­£å¼çš„æ ‡å‡†åŒ–æµç¨‹ï¼Œå¯¼è‡´å…¶å®æ–½è¿‡ç¨‹ä¸­å‡ºç°å˜åŒ–å’Œä¸ä¸€è‡´ã€‚ OAuth 2.0 ç»å†äº†æ ‡å‡†åŒ–æµç¨‹ï¼Œåˆ›å»ºäº†æ›´åŠ ä¸€è‡´å’Œå¯äº’æ“ä½œçš„åè®®ã€‚\nç¤¾åŒºé‡‡ç”¨ï¼š\nOAuth 2.0 è·å¾—äº†å¼€å‘è€…ç¤¾åŒºå’Œä¸»è¦æŠ€æœ¯å…¬å¸çš„æ›´å¹¿æ³›é‡‡ç”¨å’Œæ”¯æŒã€‚å®ƒè¢«å¹¿æ³›è®¤ä¸ºæ˜¯ç°ä»£åº”ç”¨ç¨‹åºä¸­æˆæƒå’Œèº«ä»½éªŒè¯çš„äº‹å®ä¸Šçš„æ ‡å‡†ã€‚\nä»€ä¹ˆæ˜¯ OAuth è®¿é—®ä»¤ç‰Œï¼Ÿ OAuth è®¿é—®ä»¤ç‰Œæ˜¯åº”ç”¨ç¨‹åºç”¨æ¥ä»£è¡¨ç”¨æˆ·è®¿é—®å—ä¿æŠ¤èµ„æºçš„å‡­æ®ã€‚å®ƒæ˜¯ä¸€ç§æˆæƒæœºåˆ¶ï¼Œå…è®¸ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºåœ¨ä¸çŸ¥é“ç”¨æˆ·ç™»å½•å‡­æ®çš„æƒ…å†µä¸‹è®¿é—®ç”¨æˆ·çš„æ•°æ®ã€‚\nå½“ç”¨æˆ·å‘åº”ç”¨ç¨‹åºæˆäºˆè®¿é—®å…¶æ•°æ®çš„æƒé™æ—¶ï¼Œåº”ç”¨ç¨‹åºä¼šä»æˆæƒæœåŠ¡å™¨æ¥æ”¶è®¿é—®ä»¤ç‰Œã€‚ç„¶åï¼Œæ­¤è®¿é—®ä»¤ç‰Œç”¨äºéªŒè¯å’Œæˆæƒåº”ç”¨ç¨‹åºè®¿é—®ç”¨æˆ·çš„èµ„æºï¼Œä¾‹å¦‚ç”¨æˆ·çš„ä¸ªäººèµ„æ–™ä¿¡æ¯æˆ–å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šçš„ç‰¹å®šæ•°æ®ã€‚\nOAuth è®¿é—®ä»¤ç‰Œé€šå¸¸æ˜¯çŸ­æš‚çš„ï¼Œå¹¶ä¸”å¯ä»¥å…·æœ‰ä¸åŒçº§åˆ«çš„èŒƒå›´æˆ–æƒé™ã€‚èŒƒå›´å®šä¹‰åº”ç”¨ç¨‹åºå¯ä»¥ä»£è¡¨ç”¨æˆ·è®¿é—®çš„ç‰¹å®šèµ„æºæˆ–æ“ä½œã€‚ä¾‹å¦‚ï¼Œåº”ç”¨ç¨‹åºå¯èƒ½ä»…å…·æœ‰å¯¹ç”¨æˆ·ç”µå­é‚®ä»¶åœ°å€çš„è¯»å–è®¿é—®æƒé™ï¼Œä½†æ— æ³•ä»£è¡¨ä»–ä»¬å‘é€ç”µå­é‚®ä»¶ã€‚\nè®¿é—®ä»¤ç‰Œé€šå¸¸ä½œä¸ºæˆæƒæ ‡å¤´çš„ä¸€éƒ¨åˆ†æˆ–ä½œä¸ºè¯·æ±‚ URL ä¸­çš„å‚æ•°ä¸æ¯ä¸ª API è¯·æ±‚ä¸€èµ·ä¼ é€’ã€‚æ‰˜ç®¡å—ä¿æŠ¤èµ„æºçš„æœåŠ¡å™¨éªŒè¯è®¿é—®ä»¤ç‰Œï¼Œä»¥ç¡®ä¿åº”ç”¨ç¨‹åºå…·æœ‰è®¿é—®æ‰€è¯·æ±‚èµ„æºçš„å¿…è¦æƒé™ã€‚\nä½¿ç”¨ OAuth è®¿é—®ä»¤ç‰Œæœ‰å‡ ä¸ªå¥½å¤„ã€‚é¦–å…ˆï¼Œå®ƒå¢å¼ºäº†å®‰å…¨æ€§ï¼Œå› ä¸ºåº”ç”¨ç¨‹åºä¸éœ€è¦å­˜å‚¨æˆ–å¤„ç†ç”¨æˆ·çš„ç™»å½•å‡­æ®ã€‚å…¶æ¬¡ï¼Œå®ƒå…è®¸ç”¨æˆ·æˆäºˆæˆ–æ’¤é”€å¯¹å…¶æ•°æ®çš„è®¿é—®æƒé™ï¼Œè€Œæ— éœ€æ›´æ”¹æ¯ä¸ªåº”ç”¨ç¨‹åºçš„ç™»å½•å‡­æ®ã€‚æ­¤å¤–ï¼Œè®¿é—®ä»¤ç‰Œçš„èŒƒå›´å¯ä»¥å—åˆ°é™åˆ¶ï¼Œä»è€Œä¸ºç”¨æˆ·æä¾›å¯¹åº”ç”¨ç¨‹åºå¯ä»¥è®¿é—®å“ªäº›èµ„æºçš„ç»†ç²’åº¦æ§åˆ¶ã€‚\nä»£å¸ç±»å‹ï¼š\nOAuth 2.0 æ”¯æŒä¸åŒç±»å‹çš„è®¿é—®ä»¤ç‰Œï¼Œå…·ä½“å–å†³äºåº”ç”¨ç¨‹åºçš„ç‰¹å®šç”¨ä¾‹å’Œè¦æ±‚ã€‚æœ€å¸¸ç”¨çš„ä»¤ç‰Œç±»å‹æ˜¯ï¼š\n[ä¸è®°åä»¤ç‰Œï¼š](https://apidog.com/articles/what-is-bearer-token/#:~:text=A Bearer token is a,JWT (JSON Web Token).)ä¸è®°åä»¤ç‰Œæ˜¯ OAuth 2.0 ä¸­çš„é»˜è®¤ä»¤ç‰Œç±»å‹ã€‚å®ƒä»¬æ˜¯å®¢æˆ·ç«¯åœ¨å‘æœåŠ¡å™¨å‘å‡ºçš„æ¯ä¸ªè¯·æ±‚ä¸­åŒ…å«çš„ç®€å•å­—ç¬¦ä¸²ã€‚ä¸è®°åä»¤ç‰Œé€šå¸¸æ˜¯çŸ­æš‚çš„ï¼Œå¹¶ä¸”ä¸åŒ…å«ä»»ä½•é¢å¤–çš„å®‰å…¨æœºåˆ¶ã€‚æœåŠ¡å™¨éªŒè¯ä»¤ç‰Œçš„æœ‰æ•ˆæ€§å¹¶æ ¹æ®ä»¤ç‰Œçš„èŒƒå›´æˆäºˆè®¿é—®æƒé™ã€‚ JWT ä»¤ç‰Œï¼šJSON Web ä»¤ç‰Œ (JWT) æ˜¯ä¸€ç§ç‹¬ç«‹çš„è®¿é—®ä»¤ç‰Œï¼Œå¯ä»¥æºå¸¦æœ‰å…³ç”¨æˆ·æˆ–å…¶ä»–ä¿¡æ¯çš„å£°æ˜ã€‚ JWT ä»¤ç‰Œç»è¿‡æ•°å­—ç­¾åï¼Œå¯ç”¨äºéªŒè¯ä»¤ç‰Œçš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ã€‚å®ƒä»¬è¿˜å¯ä»¥ç”¨äºåœ¨æœåŠ¡ä¹‹é—´å®‰å…¨åœ°äº¤æ¢ä¿¡æ¯ã€‚ ä»£å¸æµç¨‹ï¼š\nè·å– OAuth è®¿é—®ä»¤ç‰Œçš„è¿‡ç¨‹é€šå¸¸æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š\nç”¨æˆ·æˆæƒï¼šç”¨æˆ·ä¼šçœ‹åˆ°ç™»å½•å±å¹•æˆ–æˆæƒæç¤ºï¼Œä»–ä»¬å¯ä»¥åœ¨å…¶ä¸­æˆäºˆåº”ç”¨ç¨‹åºè®¿é—®å…¶æ•°æ®çš„æƒé™ã€‚ æˆæƒç æˆäºˆï¼šç”¨æˆ·æˆäºˆæƒé™åï¼Œåº”ç”¨ç¨‹åºä¼šä»æˆæƒæœåŠ¡å™¨æ¥æ”¶æˆæƒç ã€‚ ä»¤ç‰Œäº¤æ¢ï¼šåº”ç”¨ç¨‹åºé€šè¿‡è¯·æ±‚æˆæƒæœåŠ¡å™¨çš„ä»¤ç‰Œç«¯ç‚¹æ¥äº¤æ¢è®¿é—®ä»¤ç‰Œçš„æˆæƒä»£ç ã€‚æ­¤è¯·æ±‚åŒ…æ‹¬å®¢æˆ·ç«¯ IDã€å®¢æˆ·ç«¯å¯†é’¥ã€æˆæƒä»£ç å’Œé‡å®šå‘ URIã€‚ Access Tokenï¼šå¦‚æœæˆæƒæœåŠ¡å™¨éªŒè¯äº†æˆæƒç å’Œå…¶ä»–å‚æ•°ï¼Œåˆ™ä¼šå‘åº”ç”¨ç¨‹åºé¢å‘è®¿é—®ä»¤ç‰Œã€‚åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨æ­¤è®¿é—®ä»¤ç‰Œä»£è¡¨ç”¨æˆ·å‘å‡º API è¯·æ±‚ã€‚ ä»£å¸ç®¡ç†ï¼š\nåœ¨æ„å»ºå®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºæ—¶ï¼Œæ­£ç¡®çš„ä»¤ç‰Œç®¡ç†è‡³å…³é‡è¦ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›éœ€è¦è€ƒè™‘çš„æœ€ä½³å®è·µï¼š\nä»¤ç‰Œè¿‡æœŸï¼šè®¿é—®ä»¤ç‰Œåº”å…·æœ‰æœ‰é™çš„ç”Ÿå‘½å‘¨æœŸä»¥å¢å¼ºå®‰å…¨æ€§ã€‚å½“ä»¤ç‰Œè¿‡æœŸæ—¶ï¼Œåº”ç”¨ç¨‹åºåº”ä½¿ç”¨åˆ·æ–°ä»¤ç‰Œæˆ–é‡æ–°å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯æ¥è·å–æ–°ä»¤ç‰Œã€‚ ä»¤ç‰Œæ’¤é”€ï¼šç”¨æˆ·åº”è¯¥èƒ½å¤Ÿéšæ—¶æ’¤é”€å¯¹å…¶æ•°æ®çš„è®¿é—®æƒé™ã€‚åº”ç”¨ç¨‹åºåº”ä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªç•Œé¢æ¥ç®¡ç†å…¶æˆæƒçš„åº”ç”¨ç¨‹åºå¹¶åœ¨éœ€è¦æ—¶æ’¤é”€è®¿é—®æƒé™ã€‚ ä»¤ç‰ŒèŒƒå›´ï¼šè®¿é—®ä»¤ç‰Œçš„èŒƒå›´å¯ä»¥é™åˆ¶ä¸ºä»…å…è®¸è®¿é—®ç‰¹å®šèµ„æºæˆ–æ“ä½œã€‚è¯·æ±‚è®¿é—®ä»¤ç‰Œæ—¶ï¼Œåº”ç”¨ç¨‹åºåº”æŒ‡å®šæ‰€éœ€çš„èŒƒå›´ï¼Œä»¥æœ€å¤§é™åº¦åœ°é™ä½æœªç»æˆæƒçš„è®¿é—®é£é™©ã€‚ ä»¤ç‰Œå­˜å‚¨ï¼šè®¿é—®ä»¤ç‰Œåº”å®‰å…¨åœ°å­˜å‚¨åœ¨å®¢æˆ·ç«¯ã€‚å®ƒä»¬ä¸åº”æš´éœ²ç»™ç”¨æˆ·æˆ–å­˜å‚¨åœ¨æ˜“äºè®¿é—®çš„ä½ç½®ã€‚è€ƒè™‘ä½¿ç”¨å®‰å…¨å­˜å‚¨æœºåˆ¶ï¼Œä¾‹å¦‚åŠ å¯†é”®å€¼å­˜å‚¨æˆ–å®‰å…¨ cookieã€‚ ä»¤ç‰Œè½®æ¢ï¼šå®šæœŸè½®æ¢è®¿é—®ä»¤ç‰Œå¯ä»¥è¿›ä¸€æ­¥å¢å¼ºå®‰å…¨æ€§ã€‚é€šè¿‡è½®æ¢ä»¤ç‰Œå¯ä»¥é™ä½å› ä»¤ç‰Œå—æŸè€Œå¯¼è‡´æœªç»æˆæƒè®¿é—®çš„é£é™©ã€‚åº”ç”¨ç¨‹åºåº”è¯¥æœ‰ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥åœ¨ä¸€æ®µæ—¶é—´åè‡ªåŠ¨è½®æ¢ä»¤ç‰Œã€‚ ä»¤ç‰ŒéªŒè¯ï¼šå½“æ¥æ”¶å¸¦æœ‰è®¿é—®ä»¤ç‰Œçš„ API è¯·æ±‚æ—¶ï¼Œåº”ç”¨ç¨‹åºåº”éªŒè¯å…¶çœŸå®æ€§å’Œå®Œæ•´æ€§ï¼Œä»¥ç¡®ä¿å®ƒä»¬æ²¡æœ‰è¢«ç¯¡æ”¹æˆ–ä¼ªé€ ã€‚è¿™å¯ä»¥é€šè¿‡ä½¿ç”¨æˆæƒæœåŠ¡å™¨çš„å…¬é’¥æˆ–ä»¤ç‰ŒéªŒè¯æœåŠ¡éªŒè¯ä»¤ç‰Œçš„ç­¾åæ¥å®Œæˆã€‚ ä»¤ç‰Œå®¡è®¡ï¼šè·Ÿè¸ªä»¤ç‰Œä½¿ç”¨æƒ…å†µå¯ä»¥æä¾›æœ‰ä»·å€¼çš„è§è§£å¹¶å¸®åŠ©è¯†åˆ«ä»»ä½•å¯ç–‘æ´»åŠ¨ã€‚åº”ç”¨ç¨‹åºåº”è®°å½•ä»¤ç‰Œçš„ä½¿ç”¨æƒ…å†µï¼ŒåŒ…æ‹¬è¯·æ±‚çš„ IP åœ°å€ã€ç”¨æˆ·ä»£ç†å’Œæ—¶é—´æˆ³ï¼Œä»¥æ£€æµ‹å¼‚å¸¸æˆ–æ½œåœ¨çš„å®‰å…¨æ¼æ´ã€‚ ä»¤ç‰Œæ’¤é”€é€šçŸ¥ï¼šé™¤äº†å…è®¸ç”¨æˆ·æ‰‹åŠ¨æ’¤é”€è®¿é—®ä¹‹å¤–ï¼Œåº”ç”¨ç¨‹åºè¿˜åº”è¯¥ä¾¦å¬æ¥è‡ªæˆæƒæœåŠ¡å™¨çš„ä»¤ç‰Œæ’¤é”€äº‹ä»¶ã€‚è¿™å…è®¸åº”ç”¨ç¨‹åºå®æ—¶å¤±æ•ˆå¹¶åˆ é™¤å·²æ’¤é”€çš„ä»¤ç‰Œï¼Œè¿›ä¸€æ­¥å¢å¼ºå®‰å…¨æ€§å¹¶é™ä½æœªç»æˆæƒè®¿é—®çš„é£é™©ã€‚ ä»¤ç‰Œé€Ÿç‡é™åˆ¶ï¼šä¸ºäº†é˜²æ­¢æ»¥ç”¨å¹¶é˜²æ­¢æ¶æ„è¡Œä¸ºè€…ï¼Œåº”ç”¨ç¨‹åºåº”ä½¿ç”¨è®¿é—®ä»¤ç‰Œå¯¹ API è¯·æ±‚å®æ–½é€Ÿç‡é™åˆ¶ã€‚è¿™æœ‰åŠ©äºé˜²æ­¢æš´åŠ›æ”»å‡»å¹¶ç¡®ä¿èµ„æºçš„å…¬å¹³ä½¿ç”¨ã€‚ TokenåŠ å¯†ï¼šå½“Access Tokenä¸­å­˜å‚¨æ•æ„Ÿæ•°æ®ï¼ˆä¾‹å¦‚ç”¨æˆ·ä¿¡æ¯æˆ–æƒé™ï¼‰æ—¶ï¼Œå»ºè®®å¯¹Tokenè¿›è¡ŒåŠ å¯†ã€‚è¿™å¢åŠ äº†ä¸€å±‚å®‰å…¨æ€§ï¼Œå¹¶é˜²æ­¢æœªç»æˆæƒè®¿é—®æ•æ„Ÿä¿¡æ¯ï¼Œå³ä½¿ä»¤ç‰Œè¢«æ³„éœ²ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ æœ‰å“ªäº›ä¸åŒç±»å‹çš„æµé‡ï¼Ÿ åœ¨èº«ä»½éªŒè¯å’Œæˆæƒåè®®çš„ä¸Šä¸‹æ–‡ä¸­å­˜åœ¨å¤šç§ç±»å‹çš„æµã€‚è¿™äº›æµç¨‹å®šä¹‰å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå¦‚ä½•è·å–å’Œä½¿ç”¨è®¿é—®ä»¤ç‰Œæ¥éªŒè¯å’Œæˆæƒå¯¹æœåŠ¡å™¨çš„è¯·æ±‚ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„æµç¨‹ï¼š\næˆæƒä»£ç æµç¨‹**ï¼š**æ­¤æµç¨‹é€šå¸¸ç”¨äºæœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå¯ä»¥å®‰å…¨åœ°å­˜å‚¨å®¢æˆ·ç«¯æœºå¯†ã€‚å®¢æˆ·ç«¯å°†ç”¨æˆ·é‡å®šå‘åˆ°æˆæƒæœåŠ¡å™¨çš„ç™»å½•é¡µé¢ï¼Œç”¨æˆ·åœ¨è¯¥é¡µé¢è¿›è¡Œèº«ä»½éªŒè¯å¹¶å‘å®¢æˆ·ç«¯æˆäºˆæƒé™ã€‚ç„¶åï¼ŒæˆæƒæœåŠ¡å™¨ä½¿ç”¨æˆæƒä»£ç å°†ç”¨æˆ·é‡å®šå‘åˆ°å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºã€‚å®¢æˆ·ç«¯å°†æ­¤ä»£ç äº¤æ¢ä¸ºè®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œï¼Œå¯ç”¨äºåœ¨å½“å‰è®¿é—®ä»¤ç‰Œè¿‡æœŸæ—¶è·å–æ–°çš„è®¿é—®ä»¤ç‰Œã€‚\néšå¼æµç¨‹**ï¼š**æ­¤æµç¨‹é€‚ç”¨äºå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚åœ¨ Web æµè§ˆå™¨ä¸­è¿è¡Œçš„åŸºäºJavaScriptçš„åº”ç”¨ç¨‹åºã€‚å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå°†ç”¨æˆ·é‡å®šå‘åˆ°æˆæƒæœåŠ¡å™¨çš„ç™»å½•é¡µé¢ï¼Œç”¨æˆ·åœ¨å…¶ä¸­è¿›è¡Œèº«ä»½éªŒè¯å¹¶æˆäºˆæƒé™ã€‚ç„¶åï¼ŒæˆæƒæœåŠ¡å™¨ä½¿ç”¨åµŒå…¥åœ¨ URL ç‰‡æ®µä¸­çš„è®¿é—®ä»¤ç‰Œå°†ç”¨æˆ·é‡å®šå‘åˆ°å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºã€‚å®¢æˆ·ç«¯æå–è®¿é—®ä»¤ç‰Œå¹¶ä½¿ç”¨å®ƒæ¥éªŒè¯æœåŠ¡å™¨è¯·æ±‚ã€‚\nèµ„æºæ‰€æœ‰è€…å¯†ç å‡­æ®æµç¨‹**ï¼š**æ­¤æµç¨‹é€‚ç”¨äºå—ä¿¡ä»»çš„åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚æœ¬æœºç§»åŠ¨åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå¯ä»¥å®‰å…¨åœ°å­˜å‚¨ç”¨æˆ·å‡­æ®ã€‚å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºæ”¶é›†ç”¨æˆ·çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶å°†å…¶ç›´æ¥å‘é€åˆ°æˆæƒæœåŠ¡å™¨ä»¥è·å¾—è®¿é—®ä»¤ç‰Œã€‚ä¸å»ºè®®å…¬å…±å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä½¿ç”¨æ­¤æµç¨‹ï¼Œå› ä¸ºå®ƒè¦æ±‚å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå¤„ç†å’Œå­˜å‚¨æ•æ„Ÿçš„ç”¨æˆ·å‡­æ®ã€‚\nå®¢æˆ·ç«¯å‡­æ®æµç¨‹ï¼šæ­¤æµç¨‹æœ€é€‚åˆæœåŠ¡å™¨åˆ°æœåŠ¡å™¨çš„é€šä¿¡ï¼Œå…¶ä¸­å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºéœ€è¦å¯¹è‡ªèº«è€Œä¸æ˜¯ç‰¹å®šç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ã€‚å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå°†å…¶å‡­æ®ï¼ˆå®¢æˆ·ç«¯ ID å’Œå®¢æˆ·ç«¯å¯†é’¥ï¼‰ç›´æ¥å‘é€åˆ°æˆæƒæœåŠ¡å™¨ä»¥è·å–è®¿é—®ä»¤ç‰Œã€‚æ­¤æµç¨‹ä¸æ¶‰åŠç”¨æˆ·èº«ä»½éªŒè¯ï¼Œé€šå¸¸ç”¨äºåç«¯è¿›ç¨‹æˆ– APIã€‚\nè®¾å¤‡æˆæƒæµç¨‹**ï¼š**æ­¤æµç¨‹ä¸“ä¸ºè¾“å…¥åŠŸèƒ½æœ‰é™çš„è®¾å¤‡ï¼ˆä¾‹å¦‚æ™ºèƒ½ç”µè§†æˆ–æ¸¸æˆæœºï¼‰è€Œè®¾è®¡ã€‚å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºåœ¨è®¾å¤‡å±å¹•ä¸Šæ˜¾ç¤ºä»£ç ï¼Œå¹¶æŒ‡ç¤ºç”¨æˆ·è½¬åˆ°å¦ä¸€è®¾å¤‡ï¼ˆä¾‹å¦‚æ™ºèƒ½æ‰‹æœºæˆ–è®¡ç®—æœºï¼‰ä¸Šçš„æŒ‡å®š URL ä»¥è¾“å…¥ä»£ç å¹¶å¯¹è®¾å¤‡è¿›è¡Œæˆæƒã€‚å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå®šæœŸè½®è¯¢æˆæƒæœåŠ¡å™¨ä»¥æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²å®Œæˆæˆæƒã€‚è·å¾—æˆæƒåï¼Œè®¾å¤‡ä¼šæ”¶åˆ°è®¿é—®ä»¤ç‰Œä»¥ä»£è¡¨ç”¨æˆ·å‘å‡ºè¯·æ±‚ã€‚\néªŒè¯ OAuth è¯·æ±‚çš„æ­¥éª¤æ˜¯ä»€ä¹ˆï¼Ÿ å¯¹ OAuth è¯·æ±‚è¿›è¡Œèº«ä»½éªŒè¯æ¶‰åŠå‡ ä¸ªæ­¥éª¤ï¼Œä»¥ç¡®ä¿å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå’ŒæœåŠ¡å™¨ä¹‹é—´é€šä¿¡çš„å®‰å…¨æ€§å’Œå®Œæ•´æ€§ã€‚ä»¥ä¸‹æ˜¯éªŒè¯ OAuth è¯·æ±‚çš„ä¸€èˆ¬æ­¥éª¤ï¼š\næ³¨å†Œæ‚¨çš„åº”ç”¨ç¨‹åºï¼šåœ¨ä½¿ç”¨ OAuth å¯¹è¯·æ±‚è¿›è¡Œèº«ä»½éªŒè¯ä¹‹å‰ï¼Œæ‚¨å¿…é¡»å‘ OAuth æä¾›å•†æ³¨å†Œæ‚¨çš„åº”ç”¨ç¨‹åºã€‚è¿™é€šå¸¸æ¶‰åŠæä¾›æœ‰å…³æ‚¨çš„åº”ç”¨ç¨‹åºçš„ä¿¡æ¯ï¼Œä¾‹å¦‚åç§°ã€ç½‘ç«™ URL å’Œå›è°ƒ URLã€‚ è·å–å®¢æˆ·ç«¯å‡­æ®ï¼šæ³¨å†Œåº”ç”¨ç¨‹åºåï¼ŒOAuth æä¾›å•†å°†æä¾›å®¢æˆ·ç«¯å‡­æ®ï¼ŒåŒ…æ‹¬å®¢æˆ·ç«¯ ID å’Œå®¢æˆ·ç«¯å¯†é’¥ã€‚è¿™äº›å‡­æ®å¯ä½œä¸ºå‘ OAuth æä¾›å•†è¯†åˆ«å’ŒéªŒè¯æ‚¨çš„åº”ç”¨ç¨‹åºçš„ä¸€ç§æ–¹å¼ã€‚ å‘é€æˆæƒè¯·æ±‚ï¼šå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºé€šè¿‡å°†ç”¨æˆ·é‡å®šå‘åˆ° OAuth æä¾›ç¨‹åºçš„æˆæƒç«¯ç‚¹æ¥å¯åŠ¨èº«ä»½éªŒè¯è¿‡ç¨‹ã€‚æ­¤è¯·æ±‚é€šå¸¸åŒ…æ‹¬å®¢æˆ·ç«¯ IDã€è¯·æ±‚èŒƒå›´ä»¥åŠèº«ä»½éªŒè¯åå°†é‡å®šå‘ç”¨æˆ·çš„é‡å®šå‘ URL ç­‰å‚æ•°ã€‚ ç”¨æˆ·èº«ä»½éªŒè¯å’Œæˆæƒï¼šç”¨æˆ·è¢«é‡å®šå‘åˆ° OAuth æä¾›å•†çš„èº«ä»½éªŒè¯é¡µé¢ï¼Œç³»ç»Ÿä¼šæç¤ºç”¨æˆ·ç™»å½•å¹¶æˆæƒå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºè®¿é—®å…¶èµ„æºã€‚ç”¨æˆ·çš„åŒæ„æ˜¯èº«ä»½éªŒè¯è¿‡ç¨‹ä¸­çš„å…³é”®æ­¥éª¤ï¼Œå¹¶ç¡®ä¿å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä»…è®¿é—®ç”¨æˆ·æˆæƒçš„æ•°æ®ã€‚ æ¥æ”¶æˆæƒï¼šç”¨æˆ·æˆåŠŸç™»å½•å¹¶æˆæƒå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºåï¼ŒOAuth æä¾›ç¨‹åºå°†ç”¨æˆ·é‡å®šå‘å›æˆæƒè¯·æ±‚ä¸­æŒ‡å®šçš„é‡å®šå‘ URLã€‚é‡å®šå‘ URL åŒ…æ‹¬æˆæƒè®¸å¯ä½œä¸ºæŸ¥è¯¢å‚æ•°ã€‚ å°†æˆæƒæˆäºˆäº¤æ¢ä¸ºè®¿é—®ä»¤ç‰Œï¼šå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå¿…é¡»å°†ä¸Šä¸€æ­¥ä¸­æ”¶åˆ°çš„æˆæƒæˆäºˆäº¤æ¢ä¸ºè®¿é—®ä»¤ç‰Œã€‚è¿™æ¶‰åŠè¯·æ±‚ OAuth æä¾›ç¨‹åºçš„ä»¤ç‰Œç«¯ç‚¹ã€æä¾›æˆæƒã€å®¢æˆ·ç«¯å‡­æ®ä»¥åŠä»»ä½•å…¶ä»–æ‰€éœ€å‚æ•°ã€‚ä»¤ç‰Œç«¯ç‚¹ä»¥è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œï¼ˆå¯é€‰ï¼‰è¿›è¡Œå“åº”ã€‚ ä½¿ç”¨è®¿é—®ä»¤ç‰Œå‘å‡ºç»è¿‡èº«ä»½éªŒè¯çš„è¯·æ±‚ï¼šä½¿ç”¨ä¸Šä¸€æ­¥ä¸­è·å–çš„è®¿é—®ä»¤ç‰Œï¼Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå¯ä»¥å°†å…¶åŒ…å«åœ¨å¯¹ OAuth æä¾›ç¨‹åºå—ä¿æŠ¤èµ„æºçš„åç»­è¯·æ±‚çš„ Authorization æ ‡å¤´ä¸­ã€‚è¿™å…è®¸å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä»£è¡¨ç”¨æˆ·è®¿é—®ç”¨æˆ·çš„èµ„æºã€‚ å¤„ç†ä»¤ç‰Œè¿‡æœŸå’Œåˆ·æ–°ï¼šè®¿é—®ä»¤ç‰Œçš„ç”Ÿå‘½å‘¨æœŸæœ‰é™ï¼Œè¿‡æœŸåå°†æ— æ³•å†ç”¨äºè®¿é—®å—ä¿æŠ¤çš„èµ„æºã€‚è¦ç»§ç»­å‘å‡ºç»è¿‡èº«ä»½éªŒè¯çš„è¯·æ±‚ï¼Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨æ­¥éª¤ 6 ä¸­çš„åˆ·æ–°ä»¤ç‰Œæ¥è·å–æ–°çš„è®¿é—®ä»¤ç‰Œã€‚è¿™æ¶‰åŠè¯·æ±‚ä»¤ç‰Œç«¯ç‚¹å¹¶æä¾›åˆ·æ–°ä»¤ç‰Œå’Œå®¢æˆ·ç«¯å‡­æ®ã€‚ä»¤ç‰Œç«¯ç‚¹ä»¥æ–°çš„è®¿é—®ä»¤ç‰Œå’Œï¼ˆå¯é€‰ï¼‰æ–°çš„åˆ·æ–°ä»¤ç‰Œè¿›è¡Œå“åº”ã€‚ OAuth å’Œå®æ—¶åº”ç”¨ç¨‹åº OAuth æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„åè®®ï¼Œç”¨äºå®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºä¸­çš„å®‰å…¨èº«ä»½éªŒè¯å’Œæˆæƒã€‚é€šè¿‡åœ¨åº”ç”¨ç¨‹åºä¸­å®æ–½ OAuthï¼Œæ‚¨å¯ä»¥æä¾›å®‰å…¨ã€æ— ç¼çš„ç”¨æˆ·ä½“éªŒï¼ŒåŒæ—¶é™ä½æ•°æ®æ³„éœ²çš„é£é™©ã€‚\näº†è§£ OAuth åè®®ï¼šåœ¨åº”ç”¨ç¨‹åºä¸­å®ç° OAuth ä¹‹å‰ï¼Œæ·±å…¥äº†è§£åè®®åŠå…¶ç»„ä»¶éå¸¸é‡è¦ã€‚ OAuth å…è®¸ç”¨æˆ·ä»ä¸€ä¸ªç½‘ç«™å‘å¦ä¸€ä¸ªç½‘ç«™æˆäºˆå¯¹èµ„æºçš„æœ‰é™è®¿é—®æƒé™ï¼Œè€Œæ— éœ€å…±äº«å…¶å‡­æ®ã€‚å®ƒä½¿ç”¨è®¿é—®å’Œåˆ·æ–°ä»¤ç‰Œæ¥éªŒè¯å’Œæˆæƒå¯¹å—ä¿æŠ¤èµ„æºçš„è®¿é—®ã€‚ç†Ÿæ‚‰ OAuth å·¥ä½œæµç¨‹å’Œä¸åŒçš„ OAuth æµç¨‹ï¼ˆä¾‹å¦‚ï¼Œæˆæƒä»£ç æµç¨‹ã€éšå¼æµç¨‹ã€å®¢æˆ·ç«¯å‡­æ®æµç¨‹ï¼‰ï¼Œä»¥ç¡®å®šæœ€é€‚åˆæ‚¨çš„åº”ç”¨ç¨‹åºçš„æµç¨‹ã€‚ é€‰æ‹©ä¿¡èª‰è‰¯å¥½çš„ OAuth æä¾›å•†ï¼šåœ¨åº”ç”¨ç¨‹åºä¸­å®æ–½ OAuth æ—¶ï¼Œæ‚¨åº”è¯¥åªä¸ä¿¡èª‰è‰¯å¥½çš„ OAuth æä¾›å•†åˆä½œã€‚è¿™å¯ç¡®ä¿ OAuth æä¾›å•†å®æ–½å®‰å…¨æªæ–½å¹¶éµå¾ªæœ€ä½³å®è·µæ¥ä¿æŠ¤ç”¨æˆ·æ•°æ®ã€‚å¯»æ‰¾ç»è¿‡ç‹¬ç«‹å®‰å…¨å®¡æ ¸å¹¶æ‹¥æœ‰ç»´æŠ¤ç”¨æˆ·æ•°æ®å®‰å…¨å’Œéšç§è®°å½•çš„æä¾›å•†ã€‚ å®æ–½å®‰å…¨ä»¤ç‰Œå­˜å‚¨ï¼šOAuth ä¾èµ–è®¿é—®å’Œåˆ·æ–°ä»¤ç‰Œæ¥éªŒè¯å’Œæˆæƒå¯¹å—ä¿æŠ¤èµ„æºçš„è®¿é—®ã€‚å®‰å…¨åœ°å­˜å‚¨è¿™äº›ä»¤ç‰Œä»¥é˜²æ­¢æœªç»æˆæƒçš„è®¿é—®è‡³å…³é‡è¦ã€‚é¿å…å°†ä»¤ç‰Œå­˜å‚¨åœ¨æ˜æ–‡æˆ–å®¢æˆ·ç«¯å­˜å‚¨ä¸­ï¼Œå› ä¸ºè¿™äº›æ–¹æ³•å¾ˆå®¹æ˜“å—åˆ°æŸå®³ã€‚ç›¸åï¼Œè¯·ä½¿ç”¨å®‰å…¨å­˜å‚¨æœºåˆ¶ï¼Œä¾‹å¦‚äº‘æä¾›å•†æä¾›çš„åŠ å¯†æ•°æ®åº“æˆ–å¯†é’¥ç®¡ç†æœåŠ¡ã€‚æ­¤å¤–ï¼Œè€ƒè™‘å®æ–½ä»¤ç‰Œè½®æ¢æˆ–è¿‡æœŸç­–ç•¥ä»¥è¿›ä¸€æ­¥å¢å¼ºå®‰å…¨æ€§ã€‚ å®æ–½é€Ÿç‡é™åˆ¶å’ŒèŠ‚æµï¼šå®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºé€šå¸¸ä¼šé‡åˆ°æµé‡å¤§å’Œ API ä½¿ç”¨ç‡é«˜çš„æƒ…å†µã€‚æ‚¨åº”è¯¥è€ƒè™‘å®æ–½é€Ÿç‡é™åˆ¶å’ŒèŠ‚æµæœºåˆ¶ï¼Œä»¥é˜²æ­¢æ»¥ç”¨å¹¶ä¿æŠ¤æ‚¨çš„åº”ç”¨ç¨‹åºå…å—æ‹’ç»æœåŠ¡æ”»å‡»ã€‚è¿™äº›æœºåˆ¶å¯ä»¥å¸®åŠ©æ§åˆ¶ API è¯·æ±‚çš„é€Ÿç‡ï¼Œç¡®ä¿èµ„æºçš„å…¬å¹³åˆ†é…å¹¶é˜²æ­¢æ¶æ„è¡Œä¸ºè€…å‹å®æ‚¨çš„æœåŠ¡å™¨ã€‚ å®šæœŸæ›´æ–°å’Œä¿®è¡¥æ‚¨çš„ä¾èµ–é¡¹ï¼šå®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºä¾èµ–äºç¬¬ä¸‰æ–¹åº“å’Œæ¡†æ¶ã€‚å®šæœŸæ›´æ–°å’Œä¿®è¡¥è¿™äº›ä¾èµ–é¡¹ä»¥è§£å†³å®‰å…¨æ¼æ´è‡³å…³é‡è¦ã€‚éšæ—¶äº†è§£å½±å“æ‚¨çš„ä¾èµ–é¡¹çš„å®‰å…¨æ›´æ–°å’Œæ¼æ´ï¼Œå¹¶åŠæ—¶åº”ç”¨è¡¥ä¸ã€‚ ç›‘è§†å’Œåˆ†ææ—¥å¿—ï¼šç›‘è§†å’Œåˆ†ææ—¥å¿—å¯ä»¥æä¾›æœ‰å…³åº”ç”¨ç¨‹åºå®‰å…¨æ€§çš„å®è´µè§è§£ã€‚é€šè¿‡æŒç»­ç›‘æ§æ—¥å¿—ï¼Œæ‚¨å¯ä»¥åŠæ—¶å‘ç°å¹¶å“åº”å®‰å…¨äº‹ä»¶ã€‚å®æ–½ä¸€ä¸ªé›†ä¸­å¼æ—¥å¿—ç³»ç»Ÿï¼Œæ”¶é›†å’Œèšåˆæ¥è‡ªæ‰€æœ‰åº”ç”¨ç¨‹åºç»„ä»¶çš„æ—¥å¿—ã€‚ä½¿ç”¨æ—¥å¿—åˆ†æå·¥å…·æœç´¢è¡¨æ˜æ½œåœ¨å®‰å…¨æ¼æ´çš„æ¨¡å¼å’Œå¼‚å¸¸æƒ…å†µã€‚æ­¤å¤–ï¼Œè¯·è€ƒè™‘å®æ–½å®æ—¶è­¦æŠ¥æœºåˆ¶ï¼Œä»¥é€šçŸ¥æ‚¨å¯ç–‘æ´»åŠ¨æˆ–æœªç»æˆæƒçš„è®¿é—®å°è¯•ã€‚ å®šæœŸè¿›è¡Œå®‰å…¨å®¡æ ¸å’Œæ¸—é€æµ‹è¯•ï¼šå®šæœŸå®‰å…¨å®¡æ ¸å’Œæ¸—é€æµ‹è¯•å¯ä»¥å¸®åŠ©è¯†åˆ«åº”ç”¨ç¨‹åºä¸­çš„æ¼æ´å’Œå¼±ç‚¹ã€‚è˜è¯·ä¸“ä¸šçš„å®‰å…¨å…¬å¸æˆ–è¿›è¡Œå†…éƒ¨å®‰å…¨å®¡è®¡æ¥è¯„ä¼°å®‰å…¨æªæ–½çš„æœ‰æ•ˆæ€§ã€‚æ‰§è¡Œç¬”æµ‹è¯•æ¥æ¨¡æ‹Ÿç°å®ä¸–ç•Œçš„æ”»å‡»å¹¶è¯†åˆ«æ”»å‡»è€…çš„æ½œåœ¨å…¥å£ç‚¹ã€‚åŠæ—¶è§£å†³è¿™äº›å®¡æ ¸å’Œæµ‹è¯•æœŸé—´å‘ç°çš„ä»»ä½•æ¼æ´æˆ–å¼±ç‚¹ï¼Œä»¥ç»´æŠ¤åº”ç”¨ç¨‹åºçš„å®‰å…¨ã€‚ å‘æ‚¨çš„ç”¨æˆ·æä¾›æœ‰å…³å®‰å…¨æœ€ä½³å®è·µçš„æ•™è‚²ï¼šç”¨æˆ·åœ¨ç¡®ä¿åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§æ–¹é¢å‘æŒ¥ç€è‡³å…³é‡è¦çš„ä½œç”¨ã€‚æ•™è‚²æ‚¨çš„ç”¨æˆ·æœ‰å…³å®‰å…¨æœ€ä½³å®è·µçš„çŸ¥è¯†ï¼Œä¾‹å¦‚ä½¿ç”¨å¼ºè€Œç‹¬ç‰¹çš„å¯†ç ã€é¿å…å…±äº«æ•æ„Ÿä¿¡æ¯ä»¥åŠè­¦æƒ•ç½‘ç»œé’“é±¼å°è¯•ã€‚æä¾›æœ‰å…³ä¿æŠ¤å…¶å¸æˆ·å’Œä¸ªäººä¿¡æ¯çš„æ˜ç¡®è¯´æ˜å’ŒæŒ‡å—ã€‚ æŒç»­ç›‘æ§å’Œæ›´æ–°æ‚¨çš„å®‰å…¨æªæ–½ï¼šå®‰å…¨å¨èƒå’Œæ”»å‡»æŠ€æœ¯ä¸æ–­å‘å±•ã€‚æŒç»­ç›‘æ§å’Œæ›´æ–°å®‰å…¨æªæ–½ä»¥é¢†å…ˆäºæ½œåœ¨å¨èƒéå¸¸é‡è¦ã€‚éšæ—¶äº†è§£æœ€æ–°çš„å®‰å…¨è¶‹åŠ¿å’Œæ¼æ´ï¼Œå¹¶å®šæœŸæ›´æ–°æ‚¨çš„å®‰å…¨åè®®å’Œé…ç½®ã€‚å®æ–½è‡ªåŠ¨å®‰å…¨æ›´æ–°å’Œè¡¥ä¸ï¼Œä»¥ç¡®ä¿åŠæ—¶é˜²èŒƒæ–°å‡ºç°çš„å¨èƒã€‚ å®æ–½å¤šé‡èº«ä»½éªŒè¯ (MFA)ï¼š[å¤šé‡èº«ä»½éªŒè¯](https://aws.amazon.com/what-is/mfa/#:~:text=Multi-factor authentication (MFA),question%2C or scan a fingerprint.)è¦æ±‚ç”¨æˆ·åœ¨è®¿é—®å…¶å¸æˆ·ä¹‹å‰æä¾›å¤šç§å½¢å¼çš„èº«ä»½éªŒè¯ï¼Œä»è€Œä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºå¢åŠ äº†é¢å¤–çš„å®‰å…¨å±‚ã€‚è¿™å¯èƒ½åŒ…æ‹¬ä»–ä»¬çŸ¥é“çš„ä¸œè¥¿ï¼ˆä¾‹å¦‚å¯†ç ï¼‰ã€ä»–ä»¬æ‹¥æœ‰çš„ä¸œè¥¿ï¼ˆä¾‹å¦‚å‘é€åˆ°æ‰‹æœºçš„å”¯ä¸€ä»£ç ï¼‰æˆ–ä»–ä»¬æœ¬èº«çš„ä¸œè¥¿ï¼ˆä¾‹å¦‚æŒ‡çº¹æˆ–é¢éƒ¨è¯†åˆ«ï¼‰ã€‚é€šè¿‡å®æ–½ MFAï¼Œå³ä½¿ç”¨æˆ·çš„å¯†ç è¢«æ³„éœ²ï¼Œæ”»å‡»è€…ä»ç„¶éœ€è¦è®¿é—®å…¶ä»–å½¢å¼çš„æ ‡è¯†ï¼Œä»è€Œä½¿æœªç»æˆæƒçš„è®¿é—®å˜å¾—æ›´åŠ å›°éš¾ã€‚ åŠ å¯†æ•æ„Ÿæ•°æ®ï¼šåŠ å¯†å¯¹äºä¿æŠ¤æ•æ„Ÿæ•°æ®ï¼ˆä¾‹å¦‚ç”¨æˆ·å‡­æ®æˆ–ä¸ªäººä¿¡æ¯ï¼‰è‡³å…³é‡è¦ã€‚å®æ–½å¼ºå¤§çš„åŠ å¯†ç®—æ³•ï¼Œç¡®ä¿æ•°æ®å®‰å…¨ä¼ è¾“å’Œå­˜å‚¨ã€‚ä½¿ç”¨è¡Œä¸šæ ‡å‡†çš„åŠ å¯†åè®®å’Œç®—æ³•å¹¶å®šæœŸå®¡æŸ¥å’Œæ›´æ–°ï¼Œä»¥ä¿æŒæœ€é«˜çº§åˆ«çš„å®‰å…¨æ€§ã€‚è€ƒè™‘ä½¿ç”¨ç«¯åˆ°ç«¯åŠ å¯†ï¼Œè¿™å¯ç¡®ä¿æ•°æ®åœ¨ä»å‘é€è€…åˆ°æ¥æ”¶è€…çš„æ•´ä¸ªè¿‡ç¨‹ä¸­ä¿æŒåŠ å¯†çŠ¶æ€ã€‚ å®æ–½è®¿é—®æ§åˆ¶å’Œæƒé™ï¼šé™åˆ¶å¯¹åº”ç”¨ç¨‹åºæ•æ„ŸåŒºåŸŸçš„è®¿é—®å¯¹äºç»´æŠ¤å®‰å…¨è‡³å…³é‡è¦ã€‚å®æ–½è®¿é—®æ§åˆ¶å’Œæƒé™ï¼Œä»¥ç¡®ä¿åªæœ‰æˆæƒçš„ä¸ªäººæ‰èƒ½è®¿é—®å’Œä¿®æ”¹åº”ç”¨ç¨‹åºçš„æŸäº›éƒ¨åˆ†ã€‚ä½¿ç”¨åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶(RBAC) ä¸ºä¸åŒçš„ç”¨æˆ·è§’è‰²å®šä¹‰ä¸åŒçš„è®¿é—®çº§åˆ«ã€‚å®šæœŸå®¡æŸ¥å’Œæ›´æ–°è®¿é—®æ§åˆ¶ï¼Œä»¥é˜²æ­¢æœªç»æˆæƒçš„è®¿é—®å’Œæƒé™å‡çº§ã€‚ å®šæœŸå¤‡ä»½å’Œæµ‹è¯•æ•°æ®ï¼šå®šæœŸå¤‡ä»½æ•°æ®å¯¹äºç¾éš¾æ¢å¤å’Œç¡®ä¿åº”ç”¨ç¨‹åºçš„å¯ç”¨æ€§è‡³å…³é‡è¦ã€‚å®æ–½å¼ºå¤§çš„å¤‡ä»½ç³»ç»Ÿï¼Œå®šæœŸè‡ªåŠ¨åˆ›å»ºæ•°æ®å¤‡ä»½ã€‚å°†è¿™äº›å¤‡ä»½å­˜å‚¨åœ¨ä¸ç”Ÿäº§ç¯å¢ƒåˆ†å¼€çš„å®‰å…¨ä½ç½®ã€‚æ­¤å¤–ï¼Œå®šæœŸæµ‹è¯•æ‚¨çš„å¤‡ä»½ï¼Œä»¥ç¡®ä¿å®ƒä»¬å¯ä»¥åœ¨æ•°æ®ä¸¢å¤±äº‹ä»¶æœŸé—´æ¢å¤ã€‚ å®æ–½å®‰å…¨çš„ç½‘ç»œåŸºç¡€è®¾æ–½ï¼šé€šè¿‡å®æ–½é˜²ç«å¢™ã€å…¥ä¾µæ£€æµ‹ç³»ç»Ÿå’Œè™šæ‹Ÿä¸“ç”¨ç½‘ç»œ (VPN) ç¡®ä¿æ‚¨çš„ç½‘ç»œåŸºç¡€è®¾æ–½å®‰å…¨ã€‚è¿™äº›æŠ€æœ¯å¯ä»¥å¸®åŠ©ä¿æŠ¤æ‚¨çš„åº”ç”¨ç¨‹åºå…å—æœªç»æˆæƒçš„è®¿é—®å’ŒåŸºäºç½‘ç»œçš„æ”»å‡»ã€‚å®šæœŸç›‘æ§å’Œæ›´æ–°æ‚¨çš„ç½‘ç»œåŸºç¡€è®¾æ–½ï¼Œä»¥é¢†å…ˆäºæ½œåœ¨çš„æ¼æ´ã€‚ ä½¿ç”¨å®‰å…¨ç¼–ç å®è·µï¼šå¼€å‘åº”ç”¨ç¨‹åºæ—¶ï¼Œéµå¾ªå®‰å…¨ç¼–ç å®è·µä»¥æœ€å¤§é™åº¦åœ°é™ä½å®‰å…¨æ¼æ´çš„é£é™©ã€‚è¿™åŒ…æ‹¬è¾“å…¥éªŒè¯ã€è¾“å‡ºç¼–ç å’Œæ­£ç¡®çš„é”™è¯¯å¤„ç†ç­‰å®è·µã€‚é¿å…ä½¿ç”¨å·²å¼ƒç”¨æˆ–ä¸å®‰å…¨çš„åº“å’Œæ¡†æ¶ï¼Œå¹¶å®šæœŸæ›´æ–°ä»£ç åº“ä»¥åŒ…å«æœ€æ–°çš„å®‰å…¨è¡¥ä¸å’Œä¿®å¤ç¨‹åºã€‚ ","permalink":"https://blog.chensoul.cc/posts/2024/05/07/oauth/","summary":"åŸæ–‡é“¾æ¥ï¼šhttps://www.pubnub.com/guides/oauth/\nä»€ä¹ˆæ˜¯ OAuthï¼Ÿ OAuthï¼ˆå¼€æ”¾æˆæƒï¼‰æ˜¯ä¸€ç§å¼€æ”¾æ ‡å‡†æˆæƒæ¡†æ¶ï¼Œå…è®¸ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºè®¿é—®ç”¨æˆ·æ•°æ®ï¼Œè€Œæ— éœ€ç”¨æˆ·å…±äº«å…¶ç™»å½•å‡­æ®ã€‚å®ƒä¸ºç”¨æˆ·æä¾›äº†ä¸€ç§å®‰å…¨ä¸”æ ‡å‡†åŒ–çš„æ–¹å¼ï¼Œå°†å…¶åœ¨ä¸€ä¸ªç½‘ç«™ä¸Šçš„èµ„æºçš„è®¿é—®æƒé™æˆäºˆå¦ä¸€ä¸ªç½‘ç«™æˆ–åº”ç”¨ç¨‹åºï¼Œè€Œæ— éœ€æš´éœ²å…¶å¯†ç ã€‚\nç®€å•æ¥è¯´ï¼ŒOAuth å……å½“æœ€ç»ˆç”¨æˆ·å’Œä»–ä»¬æƒ³è¦æˆäºˆè®¿é—®æƒé™çš„åº”ç”¨ç¨‹åºä¹‹é—´çš„ä¸­é—´äººã€‚ç”¨æˆ·ä¸ä¼šç›´æ¥å‘ Web åº”ç”¨ç¨‹åºæä¾›ç”¨æˆ·åå’Œå¯†ç ï¼Œè€Œæ˜¯ä¼šè¢«é‡å®šå‘åˆ°æˆæƒæœåŠ¡å™¨ï¼ˆä¾‹å¦‚ Googleã€Facebook æˆ– Twitterï¼‰ï¼Œåœ¨é‚£é‡Œä»–ä»¬å¯ä»¥å®‰å…¨åœ°éªŒè¯è‡ªå·±çš„èº«ä»½ã€‚ç»è¿‡èº«ä»½éªŒè¯åï¼Œç”¨æˆ·å¯ä»¥æˆäºˆæˆ–æ‹’ç»å¯¹å…¶æƒ³è¦ä½¿ç”¨çš„åº”ç”¨ç¨‹åºä¸Šçš„æ•°æ®çš„è®¿é—®æƒé™ã€‚\nOAuth æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ OAuth ä¸ºç”¨æˆ·æä¾›äº†ä¸€ç§å®‰å…¨ä¸”æ ‡å‡†åŒ–çš„æ–¹å¼æ¥æˆæƒåº”ç”¨ç¨‹åºä»å„ç§æ¥æºï¼ˆä¾‹å¦‚ç¤¾äº¤åª’ä½“å¹³å°æˆ–åœ¨çº¿æœåŠ¡ï¼‰è®¿é—®å…¶æ•°æ®ã€‚\nOAuthå·¥ä½œæµç¨‹æ¶‰åŠä¸‰ä¸ªä¸»è¦æ–¹ï¼šç”¨æˆ·ã€åº”ç”¨ç¨‹åºå’ŒæœåŠ¡æä¾›å•†ï¼ˆä¹Ÿç§°ä¸ºOAuth æœåŠ¡å™¨ï¼‰ã€‚ä»¥ä¸‹æ˜¯ OAuth æµç¨‹çš„é«˜çº§æ¦‚è¿°ï¼š\nç”¨æˆ·å¯åŠ¨è¯¥è¿‡ç¨‹ï¼šç”¨æˆ·æƒ³è¦ä½¿ç”¨éœ€è¦è®¿é—®æœåŠ¡æä¾›å•†ä¸Šå—ä¿æŠ¤èµ„æºçš„åº”ç”¨ç¨‹åºã€‚ç”¨æˆ·é¦–å…ˆå‘åº”ç”¨ç¨‹åºè¯·æ±‚è®¿é—®æƒé™ã€‚ åº”ç”¨ç¨‹åºè¯·æ±‚æˆæƒï¼šåº”ç”¨ç¨‹åºå°†ç”¨æˆ·é‡å®šå‘åˆ°æœåŠ¡æä¾›å•†çš„æˆæƒç«¯ç‚¹ï¼Œä»¥åŠå¿…è¦çš„å‚æ•°ï¼Œä¾‹å¦‚åº”ç”¨ç¨‹åºçš„å®¢æˆ·ç«¯ ID å’Œè¯·æ±‚çš„è®¿é—®èŒƒå›´ã€‚ ç”¨æˆ·æˆäºˆæˆæƒï¼šæœåŠ¡æä¾›å•†åœ¨æˆæƒç«¯ç‚¹å‘ç”¨æˆ·æ˜¾ç¤ºç™»å½•å±å¹•ã€‚ç”¨æˆ·è¾“å…¥å…¶å‡­æ®ï¼Œå¦‚æœæœ‰æ•ˆï¼Œåˆ™ç³»ç»Ÿä¼šè¦æ±‚æˆäºˆæˆ–æ‹’ç»åº”ç”¨ç¨‹åºè®¿é—®å…¶èµ„æºçš„è¯·æ±‚ã€‚ æœåŠ¡æä¾›å•†å‘å‡ºæˆæƒä»£ç ï¼šå¦‚æœç”¨æˆ·æˆäºˆæˆæƒï¼ŒæœåŠ¡æä¾›å•†ä¼šç”Ÿæˆæˆæƒä»£ç å¹¶å°†ç”¨æˆ·é‡å®šå‘å›åº”ç”¨ç¨‹åºæŒ‡å®šçš„é‡å®šå‘ URIã€‚æˆæƒç æ˜¯ä¸€ä¸ªä¸´æ—¶ä»¤ç‰Œï¼Œä»£è¡¨ç”¨æˆ·çš„åŒæ„ã€‚ åº”ç”¨ç¨‹åºç”¨æˆæƒä»£ç äº¤æ¢è®¿é—®ä»¤ç‰Œï¼šç°åœ¨æ‹¥æœ‰æˆæƒä»£ç çš„åº”ç”¨ç¨‹åºå‘æœåŠ¡æä¾›å•†å‘é€è¯·æ±‚ï¼Œä»¥ç”¨ä»£ç äº¤æ¢è®¿é—®ä»¤ç‰Œã€‚è¯¥è¯·æ±‚åŒ…æ‹¬ä»£ç ã€åº”ç”¨ç¨‹åºçš„å®¢æˆ·ç«¯ ID å’Œå®¢æˆ·ç«¯å¯†é’¥ï¼Œå®ƒä»¬ç”¨äºå‘æœåŠ¡æä¾›å•†éªŒè¯åº”ç”¨ç¨‹åºçš„èº«ä»½ã€‚ æœåŠ¡æä¾›å•†éªŒè¯æˆæƒä»£ç ï¼šæœåŠ¡æä¾›å•†å¯¹å…¶è¿›è¡ŒéªŒè¯å¹¶æ£€æŸ¥å®ƒæ˜¯å¦ä¸ä¹‹å‰ä¸ºç”¨æˆ·ç”Ÿæˆçš„æˆæƒä»£ç ç›¸åŒ¹é…ã€‚å¦‚æœä»£ç æœ‰æ•ˆï¼ŒæœåŠ¡æä¾›å•†å°†å‘åº”ç”¨ç¨‹åºé¢å‘è®¿é—®ä»¤ç‰Œã€‚ åº”ç”¨ç¨‹åºä½¿ç”¨è®¿é—®ä»¤ç‰Œæ¥è®¿é—®å—ä¿æŠ¤çš„èµ„æºï¼šé€šè¿‡ä»æœåŠ¡æä¾›å•†è·å¾—çš„è®¿é—®ä»¤ç‰Œï¼Œåº”ç”¨ç¨‹åºç°åœ¨å¯ä»¥ä»£è¡¨ç”¨æˆ·å‘å‡ºè¯·æ±‚ä»¥è®¿é—®å…¶å—ä¿æŠ¤çš„èµ„æºã€‚è¿™äº›è¯·æ±‚é€šå¸¸æ˜¯å‘æœåŠ¡æä¾›å•†çš„ API ç«¯ç‚¹å‘å‡ºçš„ã€‚ è®¿é—®ä»¤ç‰Œè¿‡æœŸå’Œåˆ·æ–°ï¼šè®¿é—®ä»¤ç‰Œçš„ç”Ÿå‘½å‘¨æœŸæœ‰é™ï¼Œè¿‡æœŸåå°±ä¼šè¿‡æœŸã€‚è¦ç»§ç»­è®¿é—®ç”¨æˆ·çš„èµ„æºï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨åˆ·æ–°ä»¤ç‰Œï¼ˆå¦‚æœæä¾›ï¼‰æ¥è·å–æ–°çš„è®¿é—®ä»¤ç‰Œï¼Œè€Œæ— éœ€ç”¨æˆ·çš„å‚ä¸ã€‚ ä½¿ç”¨ OAuth æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ è¿™ç§å¹¿æ³›é‡‡ç”¨çš„åè®®ä¸ºæ„å»ºå®æ—¶èŠå¤©å’Œæ¶ˆæ¯åº”ç”¨ç¨‹åºçš„å¼€å‘äººå‘˜æä¾›äº†å¤šç§å¥½å¤„ï¼š\nå¢å¼ºçš„å®‰å…¨æ€§ï¼š OAuth æ¶ˆé™¤äº†åº”ç”¨ç¨‹åºéœ€è¦å­˜å‚¨ç”¨æˆ·å‡­æ®çš„æƒ…å†µï¼Œä»è€Œé™ä½äº†æœªç»æˆæƒè®¿é—®çš„é£é™©ã€‚é€šè¿‡åˆ©ç”¨ OAuthï¼Œå¼€å‘äººå‘˜å¯ä»¥å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯å’Œæˆæƒï¼Œè€Œæ— éœ€å¤„ç†ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯ï¼ˆä¾‹å¦‚å¯†ç ï¼‰ã€‚è¿™æ˜¾ç€é™ä½äº†æ•°æ®æ³„éœ²çš„å¯èƒ½æ€§å¹¶å¢å¼ºäº†æ•´ä½“åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ã€‚\nç®€åŒ–çš„ç”¨æˆ·ä½“éªŒï¼š OAuth ä½¿ç”¨æˆ·èƒ½å¤Ÿå‘ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºæˆäºˆæƒé™è€Œæ— éœ€å…±äº«å…¶å‡­æ®ï¼Œä»è€Œæä¾›æ— ç¼ä¸”ç”¨æˆ·å‹å¥½çš„ä½“éªŒã€‚è¿™æ¶ˆé™¤äº†ä¸ºæ¯ä¸ªåº”ç”¨ç¨‹åºåˆ›å»ºå’Œç®¡ç†å•ç‹¬å¸æˆ·çš„éº»çƒ¦ï¼Œä»è€Œæé«˜äº†ä¾¿åˆ©æ€§å’Œç”¨æˆ·é‡‡ç”¨ç‡ã€‚\nå¯æ‰©å±•æ€§å’Œäº’æ“ä½œæ€§ï¼š OAuth ä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿæ„å»ºé›†æˆå¤šä¸ªå¹³å°å’ŒæœåŠ¡çš„åº”ç”¨ç¨‹åºã€‚é€šè¿‡åˆ©ç”¨ OAuthï¼Œå¼€å‘äººå‘˜å¯ä»¥è½»æ¾åœ°éªŒè¯å’Œè®¿é—®æ¥è‡ªä¸åŒæä¾›å•†çš„èµ„æºï¼Œä»è€Œå…è®¸ä»–ä»¬çš„èŠå¤©å’Œæ¶ˆæ¯åº”ç”¨ç¨‹åºä¸å…¶ä»–ç³»ç»Ÿæ— ç¼äº¤äº’ã€‚è¿™å¢å¼ºäº†å¯æ‰©å±•æ€§ï¼Œå¹¶ä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿåˆ©ç”¨ä¸åŒå¹³å°çš„ç°æœ‰ç”¨æˆ·ç¾¤ã€‚\nç»†ç²’åº¦çš„è®¿é—®æ§åˆ¶ï¼š OAuth å…è®¸å¼€å‘äººå‘˜ä¸ºå…¶èŠå¤©å’Œæ¶ˆæ¯åº”ç”¨ç¨‹åºå®æ–½ç»†ç²’åº¦çš„è®¿é—®æ§åˆ¶ã€‚å¯ä»¥ä¸ºæ¯ä¸ªèµ„æºæˆäºˆæƒé™ï¼Œç¡®ä¿ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºåªèƒ½è®¿é—®æ‰€éœ€çš„èµ„æºã€‚è¿™ç§å¯¹è®¿é—®çš„ç²¾ç»†æ§åˆ¶æœ‰åŠ©äºç»´æŠ¤æ•°æ®éšç§å’Œæ§åˆ¶ï¼Œé™ä½æœªç»æˆæƒçš„æ•°æ®æ³„éœ²çš„é£é™©ã€‚\nå¼€å‘äººå‘˜å‹å¥½ï¼š OAuth æä¾›äº†ä¸€ä¸ªç®€å•ã€å¼€å‘äººå‘˜å‹å¥½çš„æ¡†æ¶ï¼Œç”¨äºåœ¨èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºä¸­å®ç°èº«ä»½éªŒè¯å’Œæˆæƒã€‚è¯¥åè®®æœ‰è¯¦ç»†çš„æ–‡æ¡£è®°å½•ï¼Œå¹¶å—åˆ°å„ç§åº“å’Œ SDK çš„æ”¯æŒï¼Œä½¿å¼€å‘äººå‘˜å¯ä»¥è½»æ¾åœ°å°† OAuth é›†æˆåˆ°ä»–ä»¬çš„åº”ç”¨ç¨‹åºä¸­ã€‚æ­¤å¤–ï¼ŒOAuth é€šè¿‡å†…ç½®çš„ä»¤ç‰Œè¿‡æœŸå’Œæ’¤é”€æœºåˆ¶ç®€åŒ–äº†è®¿é—®ä»¤ç‰Œçš„ç®¡ç†ã€‚è¿™ç®€åŒ–äº†å¼€å‘æµç¨‹å¹¶é™ä½äº†å¤„ç†ç”¨æˆ·èº«ä»½éªŒè¯å’Œæˆæƒçš„å¤æ‚æ€§ã€‚\nä½¿ç”¨ OAuth æœ‰å“ªäº›ç¼ºç‚¹ï¼Ÿ è™½ç„¶ OAuth å¯¹äºæ„å»ºå®æ—¶èŠå¤©å’Œæ¶ˆæ¯åº”ç”¨ç¨‹åºçš„å¼€å‘äººå‘˜æ¥è¯´å…·æœ‰ä¼—å¤šä¼˜åŠ¿ï¼Œä½†ä¹Ÿå­˜åœ¨ä¸€äº›ç¼ºç‚¹ã€‚è¿™äº›ç¼ºç‚¹åŒ…æ‹¬ï¼š\n**å¤æ‚æ€§ï¼š**å®æ–½ OAuth å¯èƒ½å¾ˆå¤æ‚ï¼Œå°¤å…¶æ˜¯å¯¹äºä¸ç†Ÿæ‚‰è¯¥åè®®çš„å¼€å‘äººå‘˜è€Œè¨€ã€‚è¯¥è¿‡ç¨‹æ¶‰åŠå¤šä¸ªæ­¥éª¤ï¼ŒåŒ…æ‹¬æ³¨å†Œåº”ç”¨ç¨‹åºã€è·å–å®¢æˆ·ç«¯å‡­æ®å’Œå¤„ç†æˆæƒæµç¨‹ã€‚ä¸å¤šä¸ªèº«ä»½æä¾›å•†é›†æˆæˆ–å¤„ç†åˆ·æ–°ä»¤ç‰Œæ—¶ï¼Œå¤æ‚æ€§å¯èƒ½ä¼šè¿›ä¸€æ­¥å¢åŠ ã€‚å¼€å‘äººå‘˜éœ€è¦æŠ•å…¥æ—¶é—´å’Œç²¾åŠ›æ¥æ­£ç¡®ç†è§£å’Œå®æ–½ OAuthã€‚\nå¯¹ç¬¬ä¸‰æ–¹æä¾›å•†çš„ä¾èµ–ï¼š OAuth ä¾èµ–ç¬¬ä¸‰æ–¹èº«ä»½æä¾›å•†æ¥å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯å’Œæˆæƒã€‚è¿™ç§ä¾èµ–æ€§å¼•å…¥äº†æ½œåœ¨çš„å•ç‚¹æ•…éšœã€‚å¦‚æœèº«ä»½æä¾›å•†é‡åˆ°ä¸­æ–­æˆ–æ›´æ”¹å…¶ APIï¼Œåˆ™å¯èƒ½ä¼šä¸­æ–­èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºçš„èº«ä»½éªŒè¯å’Œæˆæƒè¿‡ç¨‹ã€‚å¼€å‘äººå‘˜éœ€è¦è€ƒè™‘æ‰€é€‰èº«ä»½æä¾›å•†çš„å¯é æ€§å’Œå¯¿å‘½ã€‚\nç”¨æˆ·éšç§é—®é¢˜ï¼š OAuth æä¾›äº†ä¸€ç§å®‰å…¨çš„èº«ä»½éªŒè¯å’Œæˆæƒæœºåˆ¶ï¼Œä½†ä¸€äº›ç”¨æˆ·å¯èƒ½æ‹…å¿ƒä¸ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºå…±äº«å…¶ä¸ªäººä¿¡æ¯ã€‚å°½ç®¡ OAuth ä¸ä¼šå…¬å¼€å¯†ç ç­‰æ•æ„Ÿä¿¡æ¯ï¼Œä½†ç”¨æˆ·ä»ç„¶éœ€è¦æˆäºˆè®¿é—®å…¶æ•°æ®çš„æƒé™ã€‚æŸäº›ç”¨æˆ·å¯èƒ½ä¼šçŠ¹è±«æ˜¯å¦æˆäºˆè¿™äº›æƒé™ï¼Œå°¤å…¶æ˜¯å¯¹äºé²œä¸ºäººçŸ¥æˆ–ä¸å¤ªå—ä¿¡ä»»çš„åº”ç”¨ç¨‹åºã€‚\n**ç¼ºä¹æ ‡å‡†åŒ–ï¼š**å°½ç®¡ OAuth è¢«å¹¿æ³›é‡‡ç”¨ï¼Œä½†ä¸åŒæä¾›å•†å’Œå¹³å°çš„å®æ–½å¯èƒ½å­˜åœ¨å·®å¼‚ã€‚ç¼ºä¹æ ‡å‡†åŒ–å¯èƒ½ä¼šå¯¼è‡´ä¸å¤šä¸ªç³»ç»Ÿé›†æˆæ—¶å‡ºç°ä¸ä¸€è‡´å’Œå…¼å®¹æ€§é—®é¢˜ã€‚å¼€å‘äººå‘˜å¯èƒ½éœ€è¦é¢å¤–çš„åŠªåŠ›æ¥å¤„ç†è¿™äº›å˜åŒ–å¹¶ç¡®ä¿ä¸åŒå¹³å°å’Œæä¾›å•†ä¹‹é—´çš„å…¼å®¹æ€§ã€‚\n**å®‰å…¨æ¼æ´ï¼š**è™½ç„¶ OAuth çš„è®¾è®¡æ˜¯å®‰å…¨çš„ï¼Œä½†ä¹Ÿå­˜åœ¨å‘ç°å’Œåˆ©ç”¨æ¼æ´çš„æƒ…å†µã€‚è¿™äº›æ¼æ´å¯èƒ½å¯¼è‡´æœªç»æˆæƒçš„ç”¨æˆ·æ•°æ®è®¿é—®æˆ–å†’å……æ”»å‡»ã€‚å¼€å‘äººå‘˜å¿…é¡»åŠæ—¶äº†è§£æœ€æ–°çš„å®‰å…¨æœ€ä½³å®è·µï¼Œå¹¶å®šæœŸä¿®è¡¥ OAuth å®æ–½ä¸­çš„ä»»ä½•æ¼æ´ã€‚\nOAuth ä¸ OpenID OAuth å’ŒOpenIDæ˜¯å¹¿æ³›ä½¿ç”¨çš„èº«ä»½éªŒè¯å’Œæˆæƒåè®®ï¼Œä½†ç”¨é€”ä¸åŒã€‚\nOAuth ä¸»è¦æ˜¯ä¸€ç§æˆæƒåè®®ï¼Œå…è®¸åº”ç”¨ç¨‹åºè®¿é—®å¦ä¸€ä¸ªç³»ç»Ÿä¸Šçš„ç”¨æˆ·èµ„æºï¼Œè€Œæ— éœ€å…±äº«å…¶å‡­æ®ã€‚å®ƒé€šå¸¸ç”¨äºå§”æ‰˜æˆæƒåœºæ™¯ï¼Œå³ç”¨æˆ·å‘ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºæˆäºˆè®¿é—®å…¶åœ¨ç‰¹å®šç½‘ç«™æˆ–æœåŠ¡ä¸Šçš„æ•°æ®çš„æƒé™ã€‚ä¾‹å¦‚ï¼Œå½“æ‚¨ä½¿ç”¨ Google å¸æˆ·ç™»å½•ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºæ—¶ï¼ŒOAuth é€šå¸¸ç”¨äºæˆäºˆè¯¥åº”ç”¨ç¨‹åºè®¿é—®æ‚¨çš„ Google äº‘ç«¯ç¡¬ç›˜æˆ– Gmail æ•°æ®çš„æƒé™ã€‚","title":"[è¯‘]ä»€ä¹ˆæ˜¯ OAuthï¼Ÿ"},{"content":"åŸæ–‡é“¾æ¥ï¼šhttps://www.pubnub.com/guides/http-3/\nä»€ä¹ˆæ˜¯ HTTP/3ï¼Ÿ HTTP/3ï¼ˆæˆ– HTTP-over-QUICï¼‰æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®® ( HTTP ) çš„ç¬¬ä¸‰ä¸ªä¸»è¦ç‰ˆæœ¬ã€‚å®ƒæ˜¯ç”¨äº Web æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´é€šä¿¡çš„åº”ç”¨å±‚åè®®ã€‚ HTTP/3 æ—¨åœ¨æé«˜ Web é€šä¿¡çš„æ€§èƒ½å’Œå®‰å…¨æ€§ã€‚\nHTTP/3çš„ä¸»è¦åŠŸèƒ½ä¹‹ä¸€æ˜¯å®ƒæ„å»ºåœ¨ç”¨æˆ·æ•°æ®æŠ¥åè®® (UDP)ä¹‹ä¸Šï¼Œè€Œä¸æ˜¯å»ºç«‹åœ¨ HTTP æ—©æœŸç‰ˆæœ¬ä¸­ä½¿ç”¨çš„ä¼ è¾“æ§åˆ¶åè®®(TCP) ä¹‹ä¸Šã€‚ UDP æ˜¯ä¸€ç§æ— è¿æ¥åè®®ï¼Œå¯ä¸ºå®æ—¶åº”ç”¨ç¨‹åºæä¾›æ›´ä½çš„å»¶è¿Ÿå’Œæ›´å¥½çš„æ€§èƒ½ã€‚\nHTTP/3 è¿˜å¼•å…¥äº†ä¸€ç§æ–°çš„ä¼ è¾“åè®®ï¼Œç§°ä¸ºQUICï¼ˆå¿«é€Ÿ UDP äº’è”ç½‘è¿æ¥ï¼‰ã€‚ä¸ TCP ç›¸æ¯”ï¼ŒQUIC å…·æœ‰å¤šç§ä¼˜åŠ¿ï¼ŒåŒ…æ‹¬å‡å°‘å»¶è¿Ÿã€æé«˜å¯é æ€§å’Œæ›´å¥½çš„æ‹¥å¡æ§åˆ¶ã€‚å®ƒè¿˜åŒ…æ‹¬å†…ç½®åŠ å¯†ï¼Œå¢å¼ºç½‘é¡µå’Œé€šä¿¡å®‰å…¨æ€§ã€‚\nHTTP/3 çš„å¦ä¸€ä¸ªé‡è¦ç‰¹æ€§æ˜¯å®ƒå¯¹å¤šè·¯å¤ç”¨çš„æ”¯æŒã€‚è¿™æ„å‘³ç€å¯ä»¥é€šè¿‡å•ä¸ªè¿æ¥åŒæ—¶å‘é€å’Œæ¥æ”¶å¤šä¸ªè¯·æ±‚å’Œå“åº”ï¼Œä»è€Œæé«˜æ•°æ®ä¼ è¾“æ•ˆç‡ã€‚\nHTTP/3 è¿˜åŒ…æ‹¬å…¶ä»–ä¼˜åŒ–ä»¥æé«˜æ€§èƒ½ï¼Œä¾‹å¦‚æ ‡å¤´å‹ç¼©å’Œæµä¼˜å…ˆçº§ã€‚è¿™äº›ä¼˜åŒ–æœ‰åŠ©äºå‡å°‘å¼€é”€å¹¶æé«˜ Web é€šä¿¡çš„æ•´ä½“é€Ÿåº¦ã€‚\næ€»ä½“è€Œè¨€ï¼ŒHTTP/3 åœ¨æ€§èƒ½å’Œå®‰å…¨æ€§æ–¹é¢æ¯”å…¶å‰èº« HTTP/2 æ˜¾ç€æ”¹è¿›äº†åŠŸèƒ½ã€‚å®ƒå¯¹äºæ„å»ºå®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºçš„å¼€å‘äººå‘˜ç‰¹åˆ«æœ‰åˆ©ï¼Œå› ä¸ºå®ƒæä¾›æ›´ä½çš„å»¶è¿Ÿå’Œæ›´é«˜çš„å¯é æ€§ï¼Œä½¿å…¶æˆä¸ºéœ€è¦å¿«é€Ÿäº¤ä»˜å®æ—¶æ•°æ®çš„ç”¨ä¾‹çš„ç†æƒ³é€‰æ‹©ã€‚\nè®©æˆ‘ä»¬é€€ä¸€æ­¥çœ‹çœ‹è¿™ä¸€åˆ‡ä»ç¬¬ä¸€ä¸ª HTTP ç‰ˆæœ¬å¼€å§‹ã€‚\nHTTP ç®€å² HTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰åè®®æœ‰ç€é•¿è¾¾æ•°åå¹´çš„ä¸°å¯Œå†å²ã€‚å®ƒäº 20 ä¸–çºª 90 å¹´ä»£åˆé¦–æ¬¡æ¨å‡ºï¼Œä½œä¸ºä¸‡ç»´ç½‘ä¸Šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ–¹å¼ã€‚\nHTTP æœ€åˆæ˜¯ç”±Tim Berners-Leeå’Œä»–åœ¨CERNï¼ˆæ¬§æ´²æ ¸ç ”ç©¶ç»„ç»‡ï¼‰çš„å›¢é˜Ÿå¼€å‘çš„ï¼Œæ—¨åœ¨ä¿ƒè¿›è¶…æ–‡æœ¬æ–‡æ¡£çš„äº¤æ¢ã€‚ç¬¬ä¸€ä¸ªç‰ˆæœ¬ HTTP/0.9 æ˜¯ä¸€ä¸ªç®€å•çš„åè®®ï¼Œä»…æ”¯æŒç”¨äºæ£€ç´¢ HTML æ–‡æ¡£çš„ GET è¯·æ±‚ã€‚\n1996 å¹´ï¼ŒHTTP/1.0 åè®®ç”±äº’è”ç½‘å·¥ç¨‹ä»»åŠ¡ç»„(IETF)æ ‡å‡†åŒ–ã€‚è¯¥ç‰ˆæœ¬å¼•å…¥äº†å‡ ä¸ªé‡è¦çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬å¯¹ POST è¯·æ±‚ã€å“åº”çŠ¶æ€ä»£ç å’Œæ ‡å¤´çš„æ”¯æŒã€‚ HTTP/1.0 è¿˜å…è®¸ä¼ è¾“ä¸åŒçš„åª’ä½“ç±»å‹ï¼Œä¾‹å¦‚å›¾åƒå’Œè§†é¢‘ä»¥åŠ HTML æ–‡æ¡£ã€‚\nç„¶è€Œï¼Œéšç€ç½‘ç»œå˜å¾—æ›´åŠ å¤æ‚å’Œäº¤äº’ï¼ŒHTTP/1.0 çš„å±€é™æ€§å˜å¾—æ˜æ˜¾ã€‚å®ƒæ˜¯å›´ç»•è¯·æ±‚-å“åº”æ¨¡å‹è®¾è®¡çš„ï¼Œå…¶ä¸­æ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦ä¸æœåŠ¡å™¨çš„å•ç‹¬è¿æ¥ã€‚è¿™å¯¼è‡´äº†é«˜å»¶è¿Ÿå’Œç½‘ç»œèµ„æºçš„ä½æ•ˆä½¿ç”¨ã€‚\nHTTP/1.1 åè®®è§£å†³äº†è¿™äº›é—®é¢˜ã€‚\nHTTP/1.1 HTTP/1.1 æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®® (HTTP) çš„ç¬¬äºŒä¸ªä¸»è¦ç‰ˆæœ¬ï¼Œäº 1999 å¹´æ¨å‡ºï¼Œå¦‚ä»Šåœ¨äº’è”ç½‘ä¸Šå¹¿æ³›ä½¿ç”¨ã€‚\nHTTP/1.1 çš„å…³é”®åŠŸèƒ½ä¹‹ä¸€æ˜¯æ”¯æŒæŒä¹…è¿æ¥ï¼Œä¹Ÿç§°ä¸ºä¿æŒæ´»åŠ¨è¿æ¥ã€‚åœ¨ä»¥å‰ç‰ˆæœ¬çš„ HTTP ä¸­ï¼Œå¿…é¡»ä¸ºæ¯ä¸ªè¯·æ±‚å’Œå“åº”å»ºç«‹ä¸€ä¸ªæ–°çš„ TCP è¿æ¥ï¼Œè¿™å¯¼è‡´å»¶è¿Ÿå’Œå¼€é”€å¢åŠ ã€‚ä½¿ç”¨ HTTP/1.1ï¼Œå¯ä»¥é€šè¿‡å•ä¸ªè¿æ¥å‘é€å¤šä¸ªè¯·æ±‚å’Œå“åº”ï¼Œä»è€Œå‡å°‘å»ºç«‹æ–°è¿æ¥çš„éœ€è¦å¹¶æé«˜æ€§èƒ½ã€‚\nHTTP/1.1 çš„å¦ä¸€ä¸ªé‡è¦ç‰¹æ€§æ˜¯å®ƒå¯¹ç®¡é“çš„æ”¯æŒã€‚æµæ°´çº¿å…è®¸å‘é€å¤šä¸ªè¯·æ±‚è€Œæ— éœ€ç­‰å¾…ç›¸åº”çš„å“åº”ï¼Œè¿™æœ‰åŠ©äºå‡å°‘å»¶è¿Ÿå¹¶æé«˜æ•°æ®ä¼ è¾“æ•ˆç‡ã€‚\nHTTP/1.1è¿˜å¼•å…¥äº†ç¼“å­˜çš„æ¦‚å¿µã€‚ç¼“å­˜å…è®¸ Web æµè§ˆå™¨å­˜å‚¨å’Œé‡ç”¨ä»¥å‰è®¿é—®çš„èµ„æºï¼Œä¾‹å¦‚å›¾åƒå’Œæ ·å¼è¡¨ï¼Œè¿™å¯ä»¥æ˜¾ç€ç¼©çŸ­é¡µé¢åŠ è½½æ—¶é—´å¹¶å‡å°‘å¸¦å®½ä½¿ç”¨ã€‚\nç„¶è€Œï¼Œå°½ç®¡æœ‰è¿™äº›æ”¹è¿›ï¼ŒHTTP/1.1 ä»ç„¶å­˜åœ¨ä¸€äº›å±€é™æ€§ã€‚åŒæ—¶å¤„ç†å¤šä¸ªè¯·æ±‚å’Œå“åº”å¯èƒ½æ•ˆç‡ä½ä¸‹ï¼Œå› ä¸ºå®ƒéœ€è¦ä¸¥æ ¼çš„æ¶ˆæ¯æ’åºã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯å¯¹äºéœ€è¦ä½å»¶è¿Ÿå’Œé«˜å¹¶å‘çš„å®æ—¶åº”ç”¨ç¨‹åºã€‚\næ­¤å¤–ï¼ŒHTTP/1.1 ä¸æ”¯æŒæ ‡å¤´å‹ç¼©ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´å¼€é”€å¢åŠ å’Œæ•°æ®ä¼ è¾“é€Ÿåº¦å˜æ…¢ã€‚\nHTTP/2 HTTP/2 æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®® (HTTP)çš„æœ€æ–°ä¸»è¦ç‰ˆæœ¬ï¼Œäº 2015 å¹´æ¨å‡ºï¼Œä½œä¸ºå¯¹ä¹‹å‰ HTTP/1.1 ç‰ˆæœ¬çš„æ”¹è¿›ã€‚\nHTTP/2 æ—¨åœ¨è§£å†³ HTTP/1.1 çš„é™åˆ¶ï¼Œå¹¶ä¸º Web åº”ç”¨ç¨‹åºæä¾›æ›´å¥½çš„æ€§èƒ½ã€æ•ˆç‡å’Œå®‰å…¨æ€§ã€‚å®ƒå¼•å…¥äº†å‡ ä¸ªå…³é”®åŠŸèƒ½ï¼Œæ—¨åœ¨ä¼˜åŒ–å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®ä¼ è¾“æ–¹å¼ã€‚\nHTTP/2 çš„ä¸»è¦æ”¹è¿›ä¹‹ä¸€æ˜¯å®ƒå¯¹å¤šè·¯å¤ç”¨çš„æ”¯æŒã€‚ä½¿ç”¨ HTTP/2ï¼Œå¯ä»¥é€šè¿‡å•ä¸ªè¿æ¥åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚å’Œå“åº”ã€‚è¿™æ¶ˆé™¤äº†å¯¹æ¶ˆæ¯ä¸¥æ ¼æ’åºçš„éœ€è¦ï¼Œå¹¶å…è®¸æ›´å¥½çš„å¹¶å‘æ€§ï¼Œå‡å°‘å»¶è¿Ÿå¹¶æé«˜æ•°æ®ä¼ è¾“çš„æ•´ä½“æ•ˆç‡ã€‚\næ­¤å¤–ï¼ŒHTTP/2 å¼•å…¥äº†æ ‡å¤´å‹ç¼©ã€‚åœ¨ HTTP/1.1 ä¸­ï¼Œæ¯ä¸ªè¯·æ±‚å’Œå“åº”çš„æ ‡å¤´å‡ä»¥æ˜æ–‡å½¢å¼å‘é€ï¼Œè¿™ä¼šå¯¼è‡´æ˜¾ç€çš„å¼€é”€ï¼Œå°¤å…¶æ˜¯å¯¹äºå¤§å‹æ ‡å¤´ã€‚åœ¨HTTP/2ä¸­ï¼Œä½¿ç”¨HPACKå‹ç¼©ç®—æ³•å¯¹æ ‡å¤´è¿›è¡Œå‹ç¼©ï¼Œå‡å°‘äº†éœ€è¦ä¼ è¾“çš„æ•°æ®é‡ï¼Œæé«˜äº†æ€§èƒ½ã€‚\nHTTP/2 è¿˜åŒ…æ‹¬å…¶ä»–æ€§èƒ½ä¼˜åŒ–ï¼Œä¾‹å¦‚æµä¼˜å…ˆçº§ï¼ˆå…è®¸å®¢æˆ·ç«¯å°†æŸäº›è¯·æ±‚ä¼˜å…ˆäºå…¶ä»–è¯·æ±‚ï¼‰å’Œæµæ§åˆ¶ï¼ˆæœ‰åŠ©äºé˜²æ­¢æ‹¥å¡å¹¶ç¡®ä¿æœ€ä½³æ€§èƒ½ï¼‰ã€‚\nåœ¨å®‰å…¨æ€§æ–¹é¢ï¼ŒHTTP/2 é»˜è®¤æ”¯æŒåŠ å¯†è¿æ¥ã€‚è¿™æ„å‘³ç€å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“çš„æ‰€æœ‰æ•°æ®éƒ½ç»è¿‡åŠ å¯†ï¼Œä»è€Œæä¾›æ›´å¥½çš„ä¿æŠ¤ï¼Œé˜²æ­¢çªƒå¬å’Œç¯¡æ”¹ã€‚\nHTTP/2 éå¸¸é€‚åˆéœ€è¦ä½å»¶è¿Ÿå’Œé«˜å¹¶å‘çš„å®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºã€‚é€šè¿‡åˆ©ç”¨å¤šè·¯å¤ç”¨ã€æ ‡å¤´å‹ç¼©å’ŒæœåŠ¡å™¨æ¨é€ï¼Œå¼€å‘äººå‘˜å¯ä»¥æ„å»ºå¯æ‰©å±•ä¸”å®‰å…¨çš„åº”ç”¨ç¨‹åºï¼Œä»è€Œæä¾›æ— ç¼ä¸”å“åº”è¿…é€Ÿçš„ç”¨æˆ·ä½“éªŒã€‚\nä»€ä¹ˆæ˜¯ HTTP/2 æ¨é€ï¼Ÿ HTTP/2 Pushæ˜¯HTTP/2åè®®ä¸­å¼•å…¥çš„ä¸€é¡¹åŠŸèƒ½ï¼Œå…è®¸æœåŠ¡å™¨åœ¨ä¸»åŠ¨è¯·æ±‚èµ„æºä¹‹å‰å°†èµ„æºå‘é€åˆ°å®¢æˆ·ç«¯ã€‚è¿™æ„å‘³ç€æœåŠ¡å™¨æ— éœ€ç­‰å¾…å®¢æˆ·ç«¯è¯·æ±‚å•ä¸ªèµ„æºï¼ˆä¾‹å¦‚å›¾åƒæˆ–æ ·å¼è¡¨ï¼‰ï¼Œè€Œæ˜¯å¯ä»¥å°†è¿™äº›èµ„æºæ¨é€åˆ°å®¢æˆ·ç«¯è€Œæ— éœ€ç‰¹å®šè¯·æ±‚ã€‚\nå½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨å¯ä»¥æ£€æŸ¥è¯¥è¯·æ±‚å¹¶è¯†åˆ«å®¢æˆ·ç«¯å¯èƒ½éœ€è¦çš„å…¶ä»–èµ„æºã€‚ç„¶åï¼Œå®ƒå¯ä»¥å°†è¿™äº›èµ„æºä¸åˆå§‹å“åº”ä¸€èµ·æ¨é€ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯å¯ä»¥é€‰æ‹©ä½¿ç”¨è¿™äº›æ¨é€çš„èµ„æºï¼Œå¦‚æœä¸éœ€è¦ï¼Œä¹Ÿå¯ä»¥å¿½ç•¥å®ƒä»¬ã€‚\nHTTP/2 Push å¯ä»¥æ˜¾ç€æé«˜é¡µé¢åŠ è½½æ—¶é—´å¹¶å‡å°‘å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„å¾€è¿”æ¬¡æ•°ã€‚é€šè¿‡ä¸»åŠ¨æ¨é€èµ„æºï¼ŒæœåŠ¡å™¨å¯ä»¥å‡å°‘åº”ç”¨ç¨‹åºçš„æ•´ä½“å»¶è¿Ÿï¼Œä»è€Œæä¾›æ›´å¿«ã€å“åº”æ›´çµæ•çš„ç”¨æˆ·ä½“éªŒã€‚\nç„¶è€Œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒHTTP/2 Push çš„ä½¿ç”¨åº”è¯¥æ˜æ™ºä¸”è°¨æ…ã€‚å¦‚æœå‘å®¢æˆ·ç«¯æ¨é€å¤ªå¤šèµ„æºï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸å¿…è¦çš„æ•°æ®ä¼ è¾“ï¼Œå¹¶å¯èƒ½å½±å“åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚å› æ­¤ï¼Œå¼€å‘è€…ä»”ç»†åˆ†æå¹¶ç¡®å®šåº”è¯¥æ¨é€å“ªäº›èµ„æºä»¥åŠä½•æ—¶æ¨é€è‡³å…³é‡è¦ã€‚\næ€»ä½“è€Œè¨€ï¼ŒHTTP/2 Push æ˜¯ä¸€é¡¹å¼ºå¤§çš„åŠŸèƒ½ï¼Œå¯ä»¥å¢å¼º Web åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯éœ€è¦ä½å»¶è¿Ÿçš„å®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºã€‚é€šè¿‡å°†èµ„æºæ¨é€åˆ°å®¢æˆ·ç«¯ï¼Œå¼€å‘äººå‘˜å¯ä»¥ä¼˜åŒ–æ•°æ®ä¼ è¾“æµç¨‹ï¼Œä¸ºç”¨æˆ·æä¾›æ— ç¼çš„æµè§ˆä½“éªŒã€‚\nè¿™è®©æˆ‘ä»¬å›åˆ°äº† HTTP/3ã€‚\nHTTP/3 ä¸ HTTP/2 HTTP/3 åœ¨å‡ ä¸ªæ–¹é¢ä¸ HTTP/2 ä¸åŒã€‚\nåè®®ï¼šHTTP/3 åŸºäº QUICï¼ˆå¿«é€Ÿ UDP äº’è”ç½‘è¿æ¥ï¼‰åè®®ï¼Œè€Œ HTTP/2 åŸºäº TCPï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼‰ã€‚ QUIC æ—¨åœ¨é€šè¿‡å¤šè·¯å¤ç”¨å’ŒåŠ å¯†ç­‰æŠ€æœ¯çš„ç»„åˆæ¥å‡å°‘å»¶è¿Ÿå’Œæ•°æ®åŒ…ä¸¢å¤±ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚ ä¼ è¾“å±‚ï¼šHTTP/3 ä½¿ç”¨ UDPï¼ˆç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼‰ä½œä¸ºå…¶ä¼ è¾“å±‚åè®®ï¼Œè¿™æ˜¯ä¸€ç§è½»é‡çº§ã€æ— è¿æ¥çš„åè®®ï¼Œä¸ HTTP/2 ä½¿ç”¨çš„ TCP ç›¸æ¯”ï¼Œå®ƒæä¾›æ›´ä½çš„å¼€é”€å’Œæ›´å¿«çš„é€Ÿåº¦ã€‚ UDP çš„æ— è¿æ¥ç‰¹æ€§å…è®¸æ›´å¿«åœ°ä¼ è¾“æ•°æ®åŒ…ï¼Œè€Œæ— éœ€ç­‰å¾…ç¡®è®¤ã€‚ å¤šè·¯å¤ç”¨ï¼šä¸ HTTP/2 ç›¸æ¯”ï¼ŒHTTP/3 æ”¯æŒæ”¹è¿›çš„å¤šè·¯å¤ç”¨ã€‚åœ¨ HTTP/2 ä¸­ï¼Œå¤šä¸ªæµé€šè¿‡å•ä¸ª TCP è¿æ¥è¿›è¡Œå¤ç”¨ï¼Œä½†ä¸€ä¸ªæµä¸­çš„å»¶è¿Ÿæˆ–ä¸¢å¤±å¯èƒ½ä¼šå½±å“å…¶ä»–æµã€‚å¦ä¸€æ–¹é¢ï¼ŒHTTP/3 ä½¿ç”¨ QUIC çš„å¤ç”¨åŠŸèƒ½ï¼Œå…è®¸ç‹¬ç«‹çš„æµå—åˆ°å»¶è¿Ÿæˆ–ä¸¢å¤±çš„å½±å“è¾ƒå°ã€‚ å®‰å…¨æ€§ï¼šè™½ç„¶ HTTP/2 å’Œ HTTP/3 æ”¯æŒåŠ å¯†ï¼Œä½† HTTP/3 å¢å¼ºäº†å®‰å…¨åŠŸèƒ½ã€‚ QUIC é»˜è®¤é‡‡ç”¨ TLS 1.3 åŠ å¯†ï¼Œæé«˜é€šä¿¡çš„å®‰å…¨æ€§å’Œéšç§æ€§ã€‚ é˜Ÿå¤´é˜»å¡ï¼šåœ¨ HTTP/2 ä¸­ï¼Œå¦‚æœæ•°æ®åŒ…ä¸¢å¤±æˆ–å»¶è¿Ÿï¼Œå¯èƒ½ä¼šå¯¼è‡´é˜Ÿå¤´é˜»å¡ï¼Œåç»­æ•°æ®åŒ…å¿…é¡»ç­‰å¾…ä¸¢å¤±çš„æ•°æ®åŒ…é‡æ–°ä¼ è¾“ã€‚ HTTP/3 é€šè¿‡ä½¿ç”¨ QUIC æ¥å‡å°‘é˜Ÿå¤´é˜»å¡çš„å½±å“ï¼ŒQUIC å…è®¸ç‹¬ç«‹çš„æ•°æ®åŒ…ä¼ è¾“ï¼Œä»è€Œå‡å°‘å› æ•°æ®åŒ…ä¸¢å¤±æˆ–å»¶è¿Ÿè€Œå¯¼è‡´çš„å»¶è¿Ÿã€‚ HTTP 3 æä¾›äº†å“ªäº›å®‰å…¨æ”¹è¿›ï¼Ÿ ä¸å…¶å‰èº« HTTP/2 ç›¸æ¯”ï¼ŒHTTP-over-QUIC æä¾›äº†å¤šé¡¹å®‰å…¨æ”¹è¿›ã€‚ HTTP/3 æä¾›çš„ä¸€äº›å€¼å¾—æ³¨æ„çš„å®‰å…¨å¢å¼ºåŠŸèƒ½åŒ…æ‹¬ï¼š\nä¼ è¾“å±‚å®‰å…¨ (TLS) åŠ å¯†ï¼šHTTP/3 ä¸“ä¸ºåœ¨ä¼ è¾“å±‚å®‰å…¨ (TLS) åè®®ä¸Šå·¥ä½œè€Œè®¾è®¡ï¼Œç¡®ä¿å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“çš„æ•°æ®è¿›è¡Œç«¯åˆ°ç«¯åŠ å¯†ã€‚è¿™ç§åŠ å¯†å¯ä»¥é˜²æ­¢æœªç»æˆæƒçš„è®¿é—®å’Œçªƒå¬ï¼Œä»è€Œå¢å¼ºé€šä¿¡çš„å®‰å…¨æ€§ã€‚ å‡å°‘æ”»å‡»é¢ï¼šHTTP/3 ä½¿ç”¨åŸºäºç”¨æˆ·æ•°æ®æŠ¥åè®® (UDP) çš„ QUICï¼ˆå¿«é€Ÿ UDP äº’è”ç½‘è¿æ¥ï¼‰ä¼ è¾“åè®®ã€‚ä¸ä¹‹å‰ç‰ˆæœ¬ä¸­ä½¿ç”¨çš„ TCPï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼‰ä¸åŒï¼ŒQUIC åœ¨ä¼ è¾“å±‚è¿è¡Œï¼Œé€šè¿‡æ¶ˆé™¤ä¸ TCP ç›¸å…³çš„æŸäº›æ¼æ´æ¥å‡å°‘æ”»å‡»é¢ã€‚ è¿æ¥è¿ç§»ï¼šHTTP/3 å…è®¸ä¸åŒç½‘ç»œæ¥å£ä¹‹é—´çš„æ— ç¼è¿æ¥è¿ç§»ï¼Œä¾‹å¦‚ Wi-Fi å’Œèœ‚çªç½‘ç»œä¹‹é—´çš„åˆ‡æ¢ã€‚å³ä½¿ç½‘ç»œæ¡ä»¶å‘ç”Ÿå˜åŒ–ï¼Œæ­¤åŠŸèƒ½ä¹Ÿæœ‰åŠ©äºä¿æŒå®‰å…¨è¿æ¥ï¼Œä»è€Œé˜²æ­¢ä¸è¿æ¥ä¸­æ–­ç›¸å…³çš„æ½œåœ¨å®‰å…¨é£é™©ã€‚ æé«˜å¯¹æ‹’ç»æœåŠ¡ (DoS) æ”»å‡»çš„æŠµæŠ—åŠ›ï¼šHTTP/3 ç»“åˆäº†å„ç§æœºåˆ¶æ¥å‡è½» DoS æ”»å‡»çš„å½±å“ã€‚ QUICåè®®æä¾›å†…ç½®çš„é’ˆå¯¹é“¾è·¯æ³›æ´ªå’Œæ”¾å¤§æ”»å‡»çš„ä¿æŠ¤ï¼Œé™ä½æ¶æ„æ”»å‡»å¯¼è‡´æœåŠ¡ä¸­æ–­çš„é£é™©ã€‚ é›¶ RTTï¼ˆå¾€è¿”æ—¶é—´ï¼‰æ¡æ‰‹ï¼šHTTP/3 å¼•å…¥äº†é›¶ RTT æ¡æ‰‹ï¼Œå¯ä»¥æ›´å¿«åœ°å»ºç«‹å®‰å…¨è¿æ¥ã€‚è¿™å¯ä»¥å‡å°‘å»¶è¿Ÿå¹¶æé«˜å®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºçš„æ•´ä½“æ€§èƒ½ã€‚ å¢å¼ºçš„éšç§æ€§ï¼šHTTP/3 é€šè¿‡ä¸ºæ¯ä¸ªæµä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®åŒ…ä¼ è¾“æ¥æä¾›æ”¹è¿›çš„éšç§æ€§ã€‚è¿™æ¶ˆé™¤äº†é˜Ÿå¤´é˜»å¡ï¼Œè¯¥é˜»å¡å¯èƒ½ä¼šæš´éœ²ä»¥å‰ç‰ˆæœ¬çš„ HTTP ä¸­çš„æ•æ„Ÿä¿¡æ¯ã€‚é€šè¿‡ç¡®ä¿æ¯ä¸ªæµéƒ½æ˜¯éš”ç¦»çš„ï¼ŒHTTP/3 å¢å¼ºäº†ç”¨æˆ·æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„ç§å¯†æ€§å’Œæœºå¯†æ€§ã€‚ [å‰å‘çº é”™](https://www.techtarget.com/searchmobilecomputing/definition/forward-error-correction#:~:text=Forward error correction (FEC) is,that contains no apparent errors.)(FEC)ï¼šHTTP/3 ç»“åˆäº† FEC æ¥æ¢å¤ä¸¢å¤±çš„æ•°æ®åŒ…å¹¶æœ€å¤§é™åº¦åœ°å‡å°‘æ•°æ®åŒ…ä¸¢å¤±å¯¹å®æ—¶åº”ç”¨ç¨‹åºæ€§èƒ½çš„å½±å“ã€‚è¿™æœ‰åŠ©äºä¿æŒé€šä¿¡çš„å¯é æ€§å’Œå®Œæ•´æ€§ï¼Œç‰¹åˆ«æ˜¯å½“ç½‘ç»œæ¡ä»¶ä¸å¤ªç†æƒ³æ—¶ã€‚ å…¼å®¹æ€§**ï¼š** HTTP/3 æ—¨åœ¨å‘åå…¼å®¹ HTTP/2ï¼Œå…è®¸å¼€å‘äººå‘˜è½»æ¾åœ°å°†ç°æœ‰åº”ç”¨ç¨‹åºè¿ç§»åˆ°æ–°åè®®ï¼Œè€Œæ— éœ€è¿›è¡Œé‡å¤§æ›´æ”¹ã€‚ æ€»ä½“è€Œè¨€ï¼ŒHTTP/3 æ¯”ä»¥å‰çš„ç‰ˆæœ¬æä¾›äº†æ˜¾ç€çš„å®‰å…¨æ”¹è¿›ï¼Œä½¿å…¶æˆä¸ºæ„å»ºå®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºçš„å¼€å‘äººå‘˜çš„é¦–é€‰ã€‚é€šè¿‡åˆ©ç”¨ HTTP/3 æä¾›çš„åŠŸèƒ½ï¼Œå¼€å‘äººå‘˜å¯ä»¥ç¡®ä¿å…¶åº”ç”¨ç¨‹åºçš„å¯æ‰©å±•æ€§ã€é€Ÿåº¦å’Œå®‰å…¨æ€§ï¼Œä»è€Œå¢å¼ºæ•´ä½“ç”¨æˆ·ä½“éªŒã€‚\nHTTP/3 ä½¿ç”¨å“ªäº›åè®®ï¼Ÿ HTTP/3 ä½¿ç”¨çš„åè®®æœ‰ï¼š\nQUICï¼ˆå¿«é€Ÿ UDP äº’è”ç½‘è¿æ¥ï¼‰\nQUICï¼Œå…¨ç§°Quick UDP Internet Connectionsï¼Œæ˜¯è°·æ­Œå¼€å‘çš„ä¼ è¾“å±‚åè®®ã€‚å®ƒæ˜¯ä¸ HTTP/3 ä¸€èµ·ä½¿ç”¨çš„ä¸»è¦åè®®ï¼Œç”¨äºæé«˜ Web é€šä¿¡çš„æ€§èƒ½å’Œå®‰å…¨æ€§ã€‚ä¸å…¶å‰èº«ä¸åŒï¼ŒQUIC æ„å»ºåœ¨ç”¨æˆ·æ•°æ®æŠ¥åè®® (UDP) ä¹‹ä¸Šï¼Œè€Œä¸æ˜¯ä¼ è¾“æ§åˆ¶åè®® (TCP) ä¹‹ä¸Šã€‚\nQUIC ç»“åˆäº† HTTP/2ã€TCP å’Œ TLSï¼ˆä¼ è¾“å±‚å®‰å…¨æ€§ï¼‰çš„åŠŸèƒ½ï¼Œå¯æé«˜æ€§èƒ½å¹¶å‡å°‘å»¶è¿Ÿã€‚å®ƒé€šè¿‡ Internet æä¾›å¯é ã€å®‰å…¨å’Œä½å»¶è¿Ÿçš„é€šä¿¡ã€‚\nå®ƒçš„ä¸»è¦ä¼˜åŠ¿ä¹‹ä¸€æ˜¯èƒ½å¤Ÿæ¯” TCP æ›´å¿«åœ°å»ºç«‹è¿æ¥ã€‚å®ƒé€šè¿‡ç»“åˆä½¿ç”¨åŠ å¯†å’Œå¤šè·¯å¤ç”¨æŠ€æœ¯æ¥å®ç°è¿™ä¸€ç‚¹ã€‚ QUIC è¿˜åŒ…æ‹¬å†…ç½®çš„æ‹¥å¡æ§åˆ¶å’Œçº é”™æœºåˆ¶ï¼Œå¢å¼ºäº†å¯é æ€§å’Œæ€§èƒ½ã€‚\næ€»ä½“è€Œè¨€ï¼ŒQUIC æ—¨åœ¨ä¸ºèŠå¤©å’Œæ¶ˆæ¯ä¼ é€’ç­‰å®æ—¶åº”ç”¨ç¨‹åºæä¾›æ›´é«˜æ•ˆã€æ›´å®‰å…¨çš„é€šä¿¡åè®®ã€‚å®ƒä¸ HTTP/3 çš„é›†æˆä½¿å…¶æˆä¸ºå¯»æ±‚æ„å»ºå¯æ‰©å±•ä¸”å®‰å…¨çš„åº”ç”¨ç¨‹åºçš„å¼€å‘äººå‘˜çš„é¦–é€‰ã€‚\nDTLS ç‰ˆæœ¬ 1.3 - ç”¨äºåŠ å¯†å’Œå®‰å…¨é€šä¿¡\nDTLS ä»£è¡¨æ•°æ®æŠ¥ä¼ è¾“å±‚å®‰å…¨ã€‚å®ƒæ˜¯ä¸“ä¸ºåŸºäº UDP çš„é€šä¿¡è€Œè®¾è®¡çš„ä¼ è¾“å±‚å®‰å…¨ (TLS) åè®®çš„å˜ä½“ã€‚ TLS é€šå¸¸ä¸ TCP ä¸€èµ·ä½¿ç”¨æ¥æä¾› Internet ä¸Šçš„å®‰å…¨é€šä¿¡ï¼Œè€Œ DTLS ä¸ UDP ä¸€èµ·ä½¿ç”¨æ¥ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´äº¤æ¢çš„æ•°æ®æä¾›åŠ å¯†å’Œèº«ä»½éªŒè¯ã€‚\nDTLS ç‰ˆæœ¬ 1.3 æ˜¯ä¸ HTTP/3 ä¸€èµ·ä½¿ç”¨çš„ç‰¹å®šç‰ˆæœ¬ã€‚å®ƒæä¾›äº†å…ˆè¿›çš„å®‰å…¨åŠŸèƒ½å¹¶æ¯”ä»¥å‰çš„ç‰ˆæœ¬è¿›è¡Œäº†æ”¹è¿›ã€‚ DTLS 1.3 çš„ä¸€äº›å…³é”®åŠŸèƒ½åŒ…æ‹¬å¢å¼ºçš„æ¡æ‰‹å®‰å…¨æ€§ã€æ”¹è¿›çš„æ€§èƒ½å’Œå‡å°‘çš„å»¶è¿Ÿã€‚å®ƒè¿˜å¯ä»¥é˜²æ­¢é‡æ”¾æ”»å‡»å’Œé™çº§æ”»å‡»ç­‰æ”»å‡»ã€‚\nåœ¨ HTTP/3 ä¸­ï¼ŒDTLS 1.3 å¯¹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡è¿›è¡ŒåŠ å¯†å’Œä¿æŠ¤ã€‚å®ƒç¡®ä¿é€šè¿‡ç½‘ç»œä¼ è¾“çš„æ•°æ®ä¿æŒæœºå¯†ï¼Œå¹¶ä¸”ä¸ä¼šè¢«æœªç»æˆæƒçš„å„æ–¹æ‹¦æˆªæˆ–ç¯¡æ”¹ã€‚\nDTLS 1.3 åœ¨ç¡®ä¿åŸºäº HTTP/3 æ„å»ºçš„å®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºä¸­äº¤æ¢çš„æ•°æ®çš„å®‰å…¨æ€§å’Œå®Œæ•´æ€§æ–¹é¢å‘æŒ¥ç€è‡³å…³é‡è¦çš„ä½œç”¨ã€‚\nhttp/3æ”¯æŒåŠ å¯†å—ï¼Ÿ æ˜¯çš„ï¼ŒHTTP/3 ç¡®å®æ”¯æŒåŠ å¯†ã€‚ HTTP/3 æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®® (HTTP) çš„æœ€æ–°ç‰ˆæœ¬ï¼Œæ—¨åœ¨æé«˜ Web é€šä¿¡çš„æ€§èƒ½å’Œå®‰å…¨æ€§ã€‚å®ƒåŸºäº QUICï¼ˆå¿«é€Ÿ UDP äº’è”ç½‘è¿æ¥ï¼‰åè®®ï¼Œè¿™æ˜¯ä¸€ç§åœ¨ UDPï¼ˆç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼‰ä¸Šè¿è¡Œçš„ä¼ è¾“å±‚åè®®ã€‚\nåŠ å¯†æ˜¯ HTTP/3 çš„å…³é”®ç»„æˆéƒ¨åˆ†ã€‚å®ƒå¯¹ä¼ è¾“çš„æ•°æ®è¿›è¡ŒåŠ å¯†å¹¶æä¾›å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„å®‰å…¨é€šä¿¡ã€‚è¿™æœ‰åŠ©äºä¿æŠ¤æ•æ„Ÿä¿¡æ¯ï¼ˆä¾‹å¦‚ç”¨æˆ·å‡­è¯ã€ä¸ªäººæ•°æ®å’Œå…¶ä»–æœºå¯†ä¿¡æ¯ï¼‰å…é­æœªç»æˆæƒçš„è®¿é—®æˆ–æ‹¦æˆªã€‚\nHTTP/3 ä¸­çš„åŠ å¯†æ˜¯ä½¿ç”¨ä¼ è¾“å±‚å®‰å…¨ (TLS) åè®®å®ç°çš„ã€‚ TLS ç¡®ä¿å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´äº¤æ¢çš„æ•°æ®æ˜¯åŠ å¯†çš„ï¼Œæœªç»æˆæƒçš„å„æ–¹æ— æ³•è½»æ˜“ç ´è¯‘ã€‚å®ƒæä¾›ç«¯åˆ°ç«¯åŠ å¯†ï¼Œè¿™æ„å‘³ç€æ•°æ®åœ¨å®¢æˆ·ç«¯åŠ å¯†ï¼Œé€šè¿‡ç½‘ç»œå®‰å…¨ä¼ è¾“ï¼Œå¹¶åœ¨æœåŠ¡å™¨ç«¯è§£å¯†ã€‚\né€šè¿‡æ”¯æŒåŠ å¯†ï¼ŒHTTP/3 å¢å¼ºäº† Web é€šä¿¡çš„å®‰å…¨æ€§ï¼Œæœ‰åŠ©äºé˜²èŒƒå„ç§å®‰å…¨å¨èƒï¼Œä¾‹å¦‚çªƒå¬ã€æ•°æ®ç¯¡æ”¹å’Œå‡å†’æ”»å‡»ã€‚å®ƒè¿˜æé«˜äº†ç”¨æˆ·æ•°æ®çš„éšç§æ€§å’Œå®Œæ•´æ€§ï¼Œç¡®ä¿å…¶åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¿æŒæœºå¯†ä¸”ä¸è¢«æ›´æ”¹ã€‚\næ€»è€Œè¨€ä¹‹ï¼ŒHTTP/3 ç¡®å®æ”¯æŒé€šè¿‡ä½¿ç”¨ TLS åè®®è¿›è¡ŒåŠ å¯†ï¼Œä»è€Œä¸ºå®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºæä¾›å®‰å…¨å¯é çš„é€šä¿¡é€šé“ã€‚\nhttp/3 çš„å®æ–½ç°çŠ¶å¦‚ä½•ï¼Ÿ æˆªè‡³ç›®å‰ï¼ŒHTTP/3 çš„å®æ–½ä»åœ¨è¿›è¡Œä¸­ï¼Œå°šæœªæœ€ç»ˆç¡®å®šã€‚ HTTP/3 æ˜¯ HTTP åè®®çš„ä¸‹ä¸€ä¸ªé‡å¤§ä¿®è®¢ç‰ˆï¼Œæ—¨åœ¨æ¯”å…¶å‰èº« HTTP/2 æé«˜æ€§èƒ½å’Œå®‰å…¨æ€§ã€‚\nHTTP/3 åŸºäº QUICï¼ˆå¿«é€Ÿ UDP äº’è”ç½‘è¿æ¥ï¼‰ä¼ è¾“åè®®ï¼Œæ—¨åœ¨é€šè¿‡äº’è”ç½‘æä¾›ä½å»¶è¿Ÿå’Œå¯é çš„é€šä¿¡ã€‚ QUIC ä½¿ç”¨ç”¨æˆ·æ•°æ®æŠ¥åè®® (UDP)ï¼Œè€Œä¸æ˜¯ä»¥å‰ç‰ˆæœ¬çš„ HTTP ä½¿ç”¨çš„ä¼ è¾“æ§åˆ¶åè®® (TCP)ã€‚\näº’è”ç½‘å·¥ç¨‹ä»»åŠ¡ç»„ (IETF) è´Ÿè´£å¼€å‘å’Œæ ‡å‡†åŒ– HTTP/3ã€‚è¯¥åè®®æ­£å¤„äºè‰æ¡ˆé˜¶æ®µï¼Œæœ€æ–°ç‰ˆæœ¬ä¸ºdraft-32ã€‚ HTTP/3 è‰æ¡ˆæŒ‡å®šäº†åè®®çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…¶å¸§æ ¼å¼ã€é”™è¯¯å¤„ç†å’Œå®‰å…¨æ³¨æ„äº‹é¡¹ã€‚\nä¸€äº›ä¸»è¦çš„ Web æµè§ˆå™¨å’ŒæœåŠ¡å™¨è½¯ä»¶å·²ç»å¼€å§‹è‡´åŠ›äºå®ç° HTTP/3ã€‚ä¾‹å¦‚ï¼Œè°·æ­Œä¸€ç›´åœ¨ç§¯æå¼€å‘ QUICï¼Œå¹¶åœ¨å…¶ä¸€äº›æœåŠ¡ä¸­éƒ¨ç½²äº†ä¸€ä¸ªå˜ä½“ï¼Œä¾‹å¦‚ Google Chrome å’Œ YouTubeã€‚ Safari ä¹Ÿåœ¨è·¯ä¸Šã€‚\nç„¶è€Œï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç”±äº HTTP/3 çš„æŒç»­å¼€å‘å’Œä¸æ–­å‘å±•çš„æ€§è´¨ï¼Œå…¶å®ç°åœ¨ä¸åŒçš„è½¯ä»¶å’Œå¹³å°ä¸Šå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚å»ºè®®å‚è€ƒ IETF å’Œç›¸å…³è½¯ä»¶ä¾›åº”å•†çš„å®˜æ–¹æ–‡æ¡£å’Œæ›´æ–°ï¼Œä»¥è·å–æœ‰å…³ HTTP/3 å®æ–½çŠ¶æ€çš„æœ€æ–°ä¿¡æ¯ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2024/05/07/http3/","summary":"åŸæ–‡é“¾æ¥ï¼šhttps://www.pubnub.com/guides/http-3/\nä»€ä¹ˆæ˜¯ HTTP/3ï¼Ÿ HTTP/3ï¼ˆæˆ– HTTP-over-QUICï¼‰æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®® ( HTTP ) çš„ç¬¬ä¸‰ä¸ªä¸»è¦ç‰ˆæœ¬ã€‚å®ƒæ˜¯ç”¨äº Web æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´é€šä¿¡çš„åº”ç”¨å±‚åè®®ã€‚ HTTP/3 æ—¨åœ¨æé«˜ Web é€šä¿¡çš„æ€§èƒ½å’Œå®‰å…¨æ€§ã€‚\nHTTP/3çš„ä¸»è¦åŠŸèƒ½ä¹‹ä¸€æ˜¯å®ƒæ„å»ºåœ¨ç”¨æˆ·æ•°æ®æŠ¥åè®® (UDP)ä¹‹ä¸Šï¼Œè€Œä¸æ˜¯å»ºç«‹åœ¨ HTTP æ—©æœŸç‰ˆæœ¬ä¸­ä½¿ç”¨çš„ä¼ è¾“æ§åˆ¶åè®®(TCP) ä¹‹ä¸Šã€‚ UDP æ˜¯ä¸€ç§æ— è¿æ¥åè®®ï¼Œå¯ä¸ºå®æ—¶åº”ç”¨ç¨‹åºæä¾›æ›´ä½çš„å»¶è¿Ÿå’Œæ›´å¥½çš„æ€§èƒ½ã€‚\nHTTP/3 è¿˜å¼•å…¥äº†ä¸€ç§æ–°çš„ä¼ è¾“åè®®ï¼Œç§°ä¸ºQUICï¼ˆå¿«é€Ÿ UDP äº’è”ç½‘è¿æ¥ï¼‰ã€‚ä¸ TCP ç›¸æ¯”ï¼ŒQUIC å…·æœ‰å¤šç§ä¼˜åŠ¿ï¼ŒåŒ…æ‹¬å‡å°‘å»¶è¿Ÿã€æé«˜å¯é æ€§å’Œæ›´å¥½çš„æ‹¥å¡æ§åˆ¶ã€‚å®ƒè¿˜åŒ…æ‹¬å†…ç½®åŠ å¯†ï¼Œå¢å¼ºç½‘é¡µå’Œé€šä¿¡å®‰å…¨æ€§ã€‚\nHTTP/3 çš„å¦ä¸€ä¸ªé‡è¦ç‰¹æ€§æ˜¯å®ƒå¯¹å¤šè·¯å¤ç”¨çš„æ”¯æŒã€‚è¿™æ„å‘³ç€å¯ä»¥é€šè¿‡å•ä¸ªè¿æ¥åŒæ—¶å‘é€å’Œæ¥æ”¶å¤šä¸ªè¯·æ±‚å’Œå“åº”ï¼Œä»è€Œæé«˜æ•°æ®ä¼ è¾“æ•ˆç‡ã€‚\nHTTP/3 è¿˜åŒ…æ‹¬å…¶ä»–ä¼˜åŒ–ä»¥æé«˜æ€§èƒ½ï¼Œä¾‹å¦‚æ ‡å¤´å‹ç¼©å’Œæµä¼˜å…ˆçº§ã€‚è¿™äº›ä¼˜åŒ–æœ‰åŠ©äºå‡å°‘å¼€é”€å¹¶æé«˜ Web é€šä¿¡çš„æ•´ä½“é€Ÿåº¦ã€‚\næ€»ä½“è€Œè¨€ï¼ŒHTTP/3 åœ¨æ€§èƒ½å’Œå®‰å…¨æ€§æ–¹é¢æ¯”å…¶å‰èº« HTTP/2 æ˜¾ç€æ”¹è¿›äº†åŠŸèƒ½ã€‚å®ƒå¯¹äºæ„å»ºå®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºçš„å¼€å‘äººå‘˜ç‰¹åˆ«æœ‰åˆ©ï¼Œå› ä¸ºå®ƒæä¾›æ›´ä½çš„å»¶è¿Ÿå’Œæ›´é«˜çš„å¯é æ€§ï¼Œä½¿å…¶æˆä¸ºéœ€è¦å¿«é€Ÿäº¤ä»˜å®æ—¶æ•°æ®çš„ç”¨ä¾‹çš„ç†æƒ³é€‰æ‹©ã€‚\nè®©æˆ‘ä»¬é€€ä¸€æ­¥çœ‹çœ‹è¿™ä¸€åˆ‡ä»ç¬¬ä¸€ä¸ª HTTP ç‰ˆæœ¬å¼€å§‹ã€‚\nHTTP ç®€å² HTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰åè®®æœ‰ç€é•¿è¾¾æ•°åå¹´çš„ä¸°å¯Œå†å²ã€‚å®ƒäº 20 ä¸–çºª 90 å¹´ä»£åˆé¦–æ¬¡æ¨å‡ºï¼Œä½œä¸ºä¸‡ç»´ç½‘ä¸Šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ–¹å¼ã€‚\nHTTP æœ€åˆæ˜¯ç”±Tim Berners-Leeå’Œä»–åœ¨CERNï¼ˆæ¬§æ´²æ ¸ç ”ç©¶ç»„ç»‡ï¼‰çš„å›¢é˜Ÿå¼€å‘çš„ï¼Œæ—¨åœ¨ä¿ƒè¿›è¶…æ–‡æœ¬æ–‡æ¡£çš„äº¤æ¢ã€‚ç¬¬ä¸€ä¸ªç‰ˆæœ¬ HTTP/0.9 æ˜¯ä¸€ä¸ªç®€å•çš„åè®®ï¼Œä»…æ”¯æŒç”¨äºæ£€ç´¢ HTML æ–‡æ¡£çš„ GET è¯·æ±‚ã€‚\n1996 å¹´ï¼ŒHTTP/1.0 åè®®ç”±äº’è”ç½‘å·¥ç¨‹ä»»åŠ¡ç»„(IETF)æ ‡å‡†åŒ–ã€‚è¯¥ç‰ˆæœ¬å¼•å…¥äº†å‡ ä¸ªé‡è¦çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬å¯¹ POST è¯·æ±‚ã€å“åº”çŠ¶æ€ä»£ç å’Œæ ‡å¤´çš„æ”¯æŒã€‚ HTTP/1.0 è¿˜å…è®¸ä¼ è¾“ä¸åŒçš„åª’ä½“ç±»å‹ï¼Œä¾‹å¦‚å›¾åƒå’Œè§†é¢‘ä»¥åŠ HTML æ–‡æ¡£ã€‚\nç„¶è€Œï¼Œéšç€ç½‘ç»œå˜å¾—æ›´åŠ å¤æ‚å’Œäº¤äº’ï¼ŒHTTP/1.0 çš„å±€é™æ€§å˜å¾—æ˜æ˜¾ã€‚å®ƒæ˜¯å›´ç»•è¯·æ±‚-å“åº”æ¨¡å‹è®¾è®¡çš„ï¼Œå…¶ä¸­æ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦ä¸æœåŠ¡å™¨çš„å•ç‹¬è¿æ¥ã€‚è¿™å¯¼è‡´äº†é«˜å»¶è¿Ÿå’Œç½‘ç»œèµ„æºçš„ä½æ•ˆä½¿ç”¨ã€‚\nHTTP/1.1 åè®®è§£å†³äº†è¿™äº›é—®é¢˜ã€‚\nHTTP/1.1 HTTP/1.1 æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®® (HTTP) çš„ç¬¬äºŒä¸ªä¸»è¦ç‰ˆæœ¬ï¼Œäº 1999 å¹´æ¨å‡ºï¼Œå¦‚ä»Šåœ¨äº’è”ç½‘ä¸Šå¹¿æ³›ä½¿ç”¨ã€‚\nHTTP/1.1 çš„å…³é”®åŠŸèƒ½ä¹‹ä¸€æ˜¯æ”¯æŒæŒä¹…è¿æ¥ï¼Œä¹Ÿç§°ä¸ºä¿æŒæ´»åŠ¨è¿æ¥ã€‚åœ¨ä»¥å‰ç‰ˆæœ¬çš„ HTTP ä¸­ï¼Œå¿…é¡»ä¸ºæ¯ä¸ªè¯·æ±‚å’Œå“åº”å»ºç«‹ä¸€ä¸ªæ–°çš„ TCP è¿æ¥ï¼Œè¿™å¯¼è‡´å»¶è¿Ÿå’Œå¼€é”€å¢åŠ ã€‚ä½¿ç”¨ HTTP/1.1ï¼Œå¯ä»¥é€šè¿‡å•ä¸ªè¿æ¥å‘é€å¤šä¸ªè¯·æ±‚å’Œå“åº”ï¼Œä»è€Œå‡å°‘å»ºç«‹æ–°è¿æ¥çš„éœ€è¦å¹¶æé«˜æ€§èƒ½ã€‚\nHTTP/1.1 çš„å¦ä¸€ä¸ªé‡è¦ç‰¹æ€§æ˜¯å®ƒå¯¹ç®¡é“çš„æ”¯æŒã€‚æµæ°´çº¿å…è®¸å‘é€å¤šä¸ªè¯·æ±‚è€Œæ— éœ€ç­‰å¾…ç›¸åº”çš„å“åº”ï¼Œè¿™æœ‰åŠ©äºå‡å°‘å»¶è¿Ÿå¹¶æé«˜æ•°æ®ä¼ è¾“æ•ˆç‡ã€‚\nHTTP/1.1è¿˜å¼•å…¥äº†ç¼“å­˜çš„æ¦‚å¿µã€‚ç¼“å­˜å…è®¸ Web æµè§ˆå™¨å­˜å‚¨å’Œé‡ç”¨ä»¥å‰è®¿é—®çš„èµ„æºï¼Œä¾‹å¦‚å›¾åƒå’Œæ ·å¼è¡¨ï¼Œè¿™å¯ä»¥æ˜¾ç€ç¼©çŸ­é¡µé¢åŠ è½½æ—¶é—´å¹¶å‡å°‘å¸¦å®½ä½¿ç”¨ã€‚\nç„¶è€Œï¼Œå°½ç®¡æœ‰è¿™äº›æ”¹è¿›ï¼ŒHTTP/1.1 ä»ç„¶å­˜åœ¨ä¸€äº›å±€é™æ€§ã€‚åŒæ—¶å¤„ç†å¤šä¸ªè¯·æ±‚å’Œå“åº”å¯èƒ½æ•ˆç‡ä½ä¸‹ï¼Œå› ä¸ºå®ƒéœ€è¦ä¸¥æ ¼çš„æ¶ˆæ¯æ’åºã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯å¯¹äºéœ€è¦ä½å»¶è¿Ÿå’Œé«˜å¹¶å‘çš„å®æ—¶åº”ç”¨ç¨‹åºã€‚\næ­¤å¤–ï¼ŒHTTP/1.1 ä¸æ”¯æŒæ ‡å¤´å‹ç¼©ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´å¼€é”€å¢åŠ å’Œæ•°æ®ä¼ è¾“é€Ÿåº¦å˜æ…¢ã€‚\nHTTP/2 HTTP/2 æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®® (HTTP)çš„æœ€æ–°ä¸»è¦ç‰ˆæœ¬ï¼Œäº 2015 å¹´æ¨å‡ºï¼Œä½œä¸ºå¯¹ä¹‹å‰ HTTP/1.","title":"[è¯‘]ä»€ä¹ˆæ˜¯HTTP/3ï¼Ÿ"},{"content":"åŸæ–‡é“¾æ¥ï¼šhttps://www.pubnub.com/guides/http-streaming/\nä»€ä¹ˆæ˜¯ HTTP æµå¼ä¼ è¾“ï¼Ÿ HTTP æµï¼Œä¹Ÿç§°ä¸ºåŸºäº HTTP çš„æµæˆ– HTTP å®æ—¶æµï¼Œæ˜¯ä¸€ç§ç”¨äºé€šè¿‡ Internet ä¼ é€å®æ—¶å¤šåª’ä½“å†…å®¹ï¼ˆä¾‹å¦‚éŸ³é¢‘æˆ–è§†é¢‘ï¼‰çš„æŠ€æœ¯ã€‚è¯¥åè®®å…è®¸ä»æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯è®¾å¤‡çš„è¿ç»­æ•°æ®ä¼ è¾“ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿæ¶ˆè´¹åª’ä½“å†…å®¹è€Œæ— éœ€å®Œæ•´çš„æ–‡ä»¶ä¸‹è½½ã€‚\nä¸ä¼ ç»Ÿçš„æ–‡ä»¶ä¸‹è½½æ–¹æ³•ä¸åŒï¼Œåœ¨å¼€å§‹æ’­æ”¾ä¹‹å‰éœ€è¦ä¸‹è½½æ•´ä¸ªæ–‡ä»¶ï¼ŒHTTP æµå…è®¸ç«‹å³æ’­æ”¾åª’ä½“å†…å®¹ã€‚å®ƒçš„å·¥ä½œåŸç†æ˜¯å°†åª’ä½“æ–‡ä»¶åˆ†æˆæ›´å°çš„ç‰‡æ®µæˆ–å—ï¼Œç„¶åå°†å…¶è¿ç»­ä¼ é€åˆ°å®¢æˆ·ç«¯è®¾å¤‡ã€‚\nHTTP æµåˆ©ç”¨è¶…æ–‡æœ¬ä¼ è¾“åè®® (HTTP)ä½œä¸ºå…¶é€šä¿¡åè®®ã€‚å®ƒåˆ©ç”¨ç°æœ‰çš„ Web åŸºç¡€è®¾æ–½å¹¶ä½¿ç”¨ HTTP æœåŠ¡å™¨çš„å¯æ‰©å±•æ€§ã€ç¼“å­˜å’Œè´Ÿè½½å¹³è¡¡åŠŸèƒ½ã€‚è¿™ä½¿å…¶æˆä¸ºå‘è®¸å¤šç”¨æˆ·æä¾›å®æ—¶å†…å®¹çš„é«˜æ•ˆä¸”çµæ´»çš„è§£å†³æ–¹æ¡ˆã€‚\nHTTP æµå¦‚ä½•å·¥ä½œï¼Ÿ ä»è¾ƒé«˜å±‚é¢æ¥çœ‹ï¼ŒHTTP æµå¼ä¼ è¾“çš„å·¥ä½œåŸç†æ˜¯å°†åª’ä½“æ–‡ä»¶åˆ†æˆå°å—å¹¶é€šè¿‡ HTTP è¿æ¥å°†å…¶ä¼ è¾“åˆ°å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯ï¼ˆé€šå¸¸æ˜¯ç½‘ç»œæµè§ˆå™¨æˆ–åª’ä½“æ’­æ”¾å™¨ï¼‰ä¸æ–­è¯·æ±‚å’Œæ¥æ”¶è¿™äº›å—ï¼Œä»è€Œå®ç°åª’ä½“çš„æ— ç¼æ’­æ”¾ã€‚\nHTTP æµå¼ä¼ è¾“æœ‰ä¸¤ç§ä¸»è¦æ–¹æ³•ï¼šæ¸è¿›å¼ä¸‹è½½å’Œè‡ªé€‚åº”æµå¼ä¼ è¾“ã€‚\n1.æ¸è¿›å¼ä¸‹è½½ï¼š\næ¸è¿›å¼ä¸‹è½½ç¼ºä¹è‡ªé€‚åº”æµåª’ä½“æä¾›çš„é€‚åº”æ€§ã€‚åœ¨å®¢æˆ·ç«¯å¼€å§‹æ’­æ”¾ä¹‹å‰ï¼Œä¼šé€šè¿‡æ¸è¿›å¼ä¸‹è½½æ¥ä¸‹è½½æ•´ä¸ªåª’ä½“æ–‡ä»¶ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœåœ¨ä¸‹è½½è¿‡ç¨‹ä¸­å‡ºç°ä»»ä½• Wi-Fi ç½‘ç»œä¸­æ–­æˆ–å¸¦å®½æ³¢åŠ¨ï¼Œç”¨æˆ·å¯èƒ½ä¼šé‡åˆ°æ’­æ”¾ç¼“å†²æˆ–å»¶è¿Ÿçš„æƒ…å†µã€‚è¿™å¯èƒ½ä¼šè®©ç”¨æˆ·æ„Ÿåˆ°æ²®ä¸§ï¼Œå¹¶å¯èƒ½å¯¼è‡´ç³Ÿç³•çš„ç”¨æˆ·ä½“éªŒã€‚\n2.[è‡ªé€‚åº”æµåª’ä½“](https://www.cloudflare.com/learning/video/what-is-adaptive-bitrate-streaming/#:~:text=Adaptive bitrate streaming adjusts video,%2C location%2C or Internet speed.)ï¼š\nè‡ªé€‚åº”æµåª’ä½“å¯¹äºå¼€å‘äººå‘˜æ„å»ºå®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºï¼ˆæä¾›è§†é¢‘æˆ–éŸ³é¢‘ç­‰åª’ä½“æ–‡ä»¶ï¼‰æ¥è¯´æ˜¯ä¸€é¡¹è‡³å…³é‡è¦çš„æŠ€æœ¯ã€‚å®ƒç¡®ä¿æ— è®ºç”¨æˆ·çš„ç½‘ç»œæ¡ä»¶å¦‚ä½•ï¼Œåª’ä½“å†…å®¹éƒ½å¯ä»¥æµç•…ã€é«˜æ•ˆåœ°ä¼ è¾“ã€‚è¿™åœ¨å½“ä»Šçš„æ•°å­—ç¯å¢ƒä¸­å°¤å…¶é‡è¦ï¼Œç”¨æˆ·æœŸæœ›é«˜è´¨é‡ã€ä¸é—´æ–­çš„åª’ä½“æ’­æ”¾ï¼Œä½†æœ‰æ—¶å…·æœ‰ä¸åŒçš„äº’è”ç½‘é€Ÿåº¦ã€‚\nè‡ªé€‚åº”æµå¼ä¼ è¾“é€šå¸¸æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š\nå†…å®¹ç¼–ç ï¼šåª’ä½“æ–‡ä»¶è¢«ç¼–ç ä¸ºå…·æœ‰ä¸åŒæ¯”ç‰¹ç‡å’Œè´¨é‡çº§åˆ«çš„å¤šç§å˜ä½“ã€‚è¿™äº›å˜åŒ–å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šã€‚ æ¸…å•æ–‡ä»¶ï¼šåˆ›å»ºä¸€ä¸ªæ¸…å•æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æœ‰å…³å¯ç”¨å˜ä½“åŠå…¶ç›¸åº” URL çš„ä¿¡æ¯ã€‚ åˆå§‹è¯·æ±‚ï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨è¯·æ±‚æ¸…å•æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æä¾›æœ‰å…³åª’ä½“æ–‡ä»¶çš„å¯ç”¨å˜ä½“çš„ä¿¡æ¯ã€‚ å˜ä½“é€‰æ‹©ï¼šå®¢æˆ·ç«¯æ ¹æ®ç½‘ç»œæ¡ä»¶å’Œè®¾å¤‡åŠŸèƒ½é€‰æ‹©æ‰€éœ€çš„å˜ä½“ã€‚ç„¶åå®ƒä»æœåŠ¡å™¨è¯·æ±‚ç›¸åº”çš„åª’ä½“å—ã€‚ å—ä¼ é€ï¼šæœåŠ¡å™¨é€šè¿‡ HTTP è¿æ¥å°†åˆ†å—åª’ä½“ä¼ é€åˆ°å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯ä¸æ–­è¯·æ±‚å¹¶æ¥æ”¶è¿™äº›å—ï¼Œå¹¶åœ¨å¿…è¦æ—¶è°ƒæ•´æ’­æ”¾è´¨é‡ã€‚ æ¯”ç‰¹ç‡é€‚åº”ï¼šåœ¨æ’­æ”¾æœŸé—´ï¼Œå®¢æˆ·ç«¯ç›‘è§†ç½‘ç»œçŠ¶å†µå¹¶æ ¹æ®å¯ç”¨å¸¦å®½åŠ¨æ€è°ƒæ•´æ‰€é€‰å˜ä½“ã€‚å¦‚æœç½‘ç»œå˜å¾—æ‹¥å¡ï¼Œå®ƒå¯èƒ½ä¼šåˆ‡æ¢åˆ°è¾ƒä½çš„æ¯”ç‰¹ç‡å˜ä½“ï¼Œæˆ–è€…å¦‚æœç½‘ç»œçŠ¶å†µæ”¹å–„ï¼Œå®ƒå¯èƒ½ä¼šåˆ‡æ¢åˆ°è¾ƒé«˜çš„æ¯”ç‰¹ç‡å˜ä½“ã€‚ æ— ç¼æ’­æ”¾ï¼šé€šè¿‡è¿ç»­æ¥æ”¶å’Œæ’­æ”¾åª’ä½“å—ï¼Œè‡ªé€‚åº”æµåª’ä½“æä¾›æ— ç¼æ’­æ”¾ä½“éªŒï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿåœ¨æ²¡æœ‰ä¸­æ–­æˆ–ç¼“å†²çš„æƒ…å†µä¸‹äº«å—å†…å®¹ã€‚ HTTP æµæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ HTTP æµå¼ä¼ è¾“ä¸ºæ„å»ºå®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºçš„å¼€å‘äººå‘˜æä¾›äº†å¤šç§å¥½å¤„ï¼š\nå®æ—¶æ•°æ®ä¼ é€ï¼šHTTPæµå¯ä»¥å®ç°æ•°æ®çš„å®æ—¶ä¼ é€ï¼Œå…è®¸ç”¨æˆ·å³æ—¶å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚è¿™ç¡®ä¿ç”¨æˆ·å¯ä»¥è¿›è¡Œå®æ—¶å¯¹è¯ï¼Œè€Œä¸ä¼šå‡ºç°ä»»ä½•æ˜æ˜¾çš„å»¶è¿Ÿã€‚ å¯æ‰©å±•æ€§ï¼šHTTP æµå…·æœ‰é«˜åº¦å¯æ‰©å±•æ€§ï¼Œèƒ½å¤Ÿå¤„ç†è®¸å¤šå¹¶å‘è¿æ¥å¹¶å‘å¤šä¸ªç”¨æˆ·å®æ—¶ä¼ é€æ¶ˆæ¯ã€‚è¿™å¯¹äºæ”¯æŒä¸æ–­å¢é•¿çš„ç”¨æˆ·ç¾¤å’Œå¤„ç†å¤§é‡æ¶ˆæ¯çš„åº”ç”¨ç¨‹åºè‡³å…³é‡è¦ã€‚ å‡å°‘ç½‘ç»œå¼€é”€ï¼šä½¿ç”¨ HTTP æµå¼ä¼ è¾“ï¼Œå½“æœ‰æ–°ä¿¡æ¯å¯ç”¨æ—¶ï¼Œä»…é€šè¿‡ç½‘ç»œå‘é€å¿…è¦çš„æ•°æ®ï¼Œä»è€Œå‡å°‘ç½‘ç»œå¼€é”€ã€‚è¿™ä¸è½®è¯¢ç­‰å…¶ä»–æ–¹æ³•å½¢æˆé²œæ˜å¯¹æ¯”ï¼Œå³ä½¿ä¸å­˜åœ¨æ–°æ•°æ®ï¼Œä¹Ÿä¼šä¸æ–­å‘å‡ºè¯·æ±‚ã€‚ é«˜æ•ˆçš„èµ„æºåˆ©ç”¨ï¼šHTTP æµå¯ä»¥æœ‰æ•ˆåœ°åˆ©ç”¨æœåŠ¡å™¨èµ„æºï¼Œå› ä¸ºå®ƒæ¶ˆé™¤äº†é¢‘ç¹çš„è½®è¯¢è¯·æ±‚ã€‚è¿™å¯ä»¥å‡å°‘æœåŠ¡å™¨è´Ÿè½½å¹¶æé«˜æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨å…·æœ‰è®¸å¤šæ´»è·ƒç”¨æˆ·çš„åº”ç”¨ç¨‹åºä¸­ã€‚ æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼šHTTP æµé€šè¿‡æä¾›å®æ—¶æ›´æ–°å’Œå³æ—¶æ¶ˆæ¯ä¼ é€’ï¼Œå¢å¼ºäº†èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºçš„ç”¨æˆ·ä½“éªŒã€‚ç”¨æˆ·å¯ä»¥è¿›è¡Œæ›´å…·äº’åŠ¨æ€§å’Œå¸å¼•åŠ›çš„å¯¹è¯ï¼Œè€Œä¸ä¼šå› å»¶è¿Ÿæˆ–é”™è¿‡æ¶ˆæ¯è€Œæ„Ÿåˆ°æ²®ä¸§ã€‚ å®‰å…¨æ€§ï¼šHTTP æµå¯ä»¥åˆ©ç”¨ HTTPS ç­‰ç°æœ‰å®‰å…¨æªæ–½æä¾›å®‰å…¨çš„é€šä¿¡é€šé“ã€‚è¿™å¯ç¡®ä¿æ•æ„Ÿçš„ç”¨æˆ·æ•°æ®å’Œå¯¹è¯å…å—æœªç»æˆæƒçš„è®¿é—®å’Œçªƒå¬ã€‚ ä½¿ç”¨ HTTP æµæœ‰å“ªäº›ç¼ºç‚¹ï¼Ÿ ä½¿ç”¨ HTTP æµè¿›è¡Œå®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºæœ‰å‡ ä¸ªç¼ºç‚¹ï¼š\nå»¶è¿Ÿï¼š HTTP æµåª’ä½“ä¾èµ–äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æŒç»­è¿æ¥ã€‚è¿™å¯èƒ½ä¼šå¼•å…¥å»¶è¿Ÿï¼Œå› ä¸ºæœåŠ¡å™¨éœ€è¦ç»´æŒå¼€æ”¾è¿æ¥å¹¶ä»¥å—çš„å½¢å¼å‘é€æ•°æ®ã€‚å› æ­¤ï¼Œå‘ç”¨æˆ·å‘é€å®æ—¶æ¶ˆæ¯å¯èƒ½ä¼šå‡ºç°å»¶è¿Ÿï¼Œä»è€Œå½±å“ç”¨æˆ·ä½“éªŒã€‚\nå¯æ‰©å±•æ€§ï¼š HTTP æµå¯¹äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ¥è¯´å¯èƒ½æ˜¯èµ„æºå¯†é›†å‹çš„ã€‚ç»´æŠ¤å¤§é‡æ‰“å¼€çš„è¿æ¥ä¼šç»™æœåŠ¡å™¨å¸¦æ¥å‹åŠ›å¹¶é™åˆ¶å…¶å¯æ‰©å±•æ€§ã€‚æ­¤å¤–ï¼Œå®¢æˆ·ç«¯éœ€è¦å¤„ç†ä¼ å…¥çš„æ•°æ®æµï¼Œè¿™ä¹Ÿå¯èƒ½å¯¹å…¶èµ„æºæå‡ºè¦æ±‚ã€‚\n**å…¼å®¹æ€§ï¼š**æ‰€æœ‰è®¾å¤‡æˆ–ç½‘ç»œå¯èƒ½ä¸æ”¯æŒ HTTP æµã€‚æŸäº›é˜²ç«å¢™æˆ–ä»£ç†å¯èƒ½ä¼šé˜»æ­¢æˆ–å¹²æ‰°æµè¿æ¥ï¼Œä»è€Œå¯¼è‡´é€šä¿¡é—®é¢˜ã€‚è¿™å¯èƒ½ä¼šå°†èŠå¤©åº”ç”¨ç¨‹åºçš„å¯ç”¨æ€§é™åˆ¶ä¸ºéƒ¨åˆ†ç”¨æˆ·ã€‚\n**å¯é æ€§ï¼š**ç”±äº HTTP æµåª’ä½“ä¾èµ–äºé•¿æœŸè¿æ¥ï¼Œå› æ­¤ä¸­æ–­æˆ–ç½‘ç»œæ•…éšœå¯èƒ½ä¼šç ´åæµåª’ä½“è¿‡ç¨‹ã€‚å¦‚æœè¿æ¥ä¸¢å¤±ï¼Œå®¢æˆ·ç«¯å¯èƒ½éœ€è¦é‡æ–°å»ºç«‹è¿æ¥ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±æˆ–é‡å¤ã€‚\nå®‰å…¨æ€§ï¼š HTTP æµæœ¬èº«å¹¶ä¸ä¸ºæ•°æ®ä¼ è¾“æä¾›åŠ å¯†æˆ–å®‰å…¨æªæ–½ã€‚å¦‚æœæ²¡æœ‰é¢å¤–çš„å®‰å…¨å±‚ï¼Œé€šè¿‡èŠå¤©åº”ç”¨ç¨‹åºäº¤æ¢çš„æ•æ„Ÿä¿¡æ¯å¯èƒ½å®¹æ˜“é­åˆ°çªƒå¬æˆ–æœªç»æˆæƒçš„è®¿é—®ã€‚\n**ç”µæ± æ¶ˆè€—ï¼š**è¿ç»­è¿æ¥å’Œæ•°æ®æµä¼šå¿«é€Ÿè€—å°½ç§»åŠ¨è®¾å¤‡çš„ç”µæ± ã€‚è¿™å¯èƒ½æ˜¯å®æ—¶èŠå¤©åº”ç”¨ç¨‹åºçš„ç”¨æˆ·æ‰€å…³å¿ƒçš„é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨é•¿æ—¶é—´ä½¿ç”¨è¿™äº›åº”ç”¨ç¨‹åºæ—¶ã€‚\nå¼€å‘äººå‘˜åœ¨é€‰æ‹©å®æ—¶èŠå¤©å’Œæ¶ˆæ¯åº”ç”¨ç¨‹åºæŠ€æœ¯æ—¶éœ€è¦è€ƒè™‘è¿™äº›ç¼ºç‚¹ã€‚è™½ç„¶ HTTP æµæä¾›äº†ä¸€äº›å¥½å¤„ï¼Œä¾‹å¦‚åˆ©ç”¨ç°æœ‰çš„å®‰å…¨æªæ–½ï¼Œä½†å¼€å‘äººå‘˜åº”è¯¥æƒè¡¡è¿™äº›ä¼˜ç‚¹ä¸æ½œåœ¨çš„ç¼ºç‚¹ï¼Œå¹¶è¯„ä¼°å®ƒä»¬æ˜¯å¦ç¬¦åˆå…¶ç‰¹å®šçš„ç”¨ä¾‹å’Œè¦æ±‚ã€‚\nHTTP æµå¼ä¼ è¾“æœ‰å“ªäº›æ›¿ä»£æ–¹æ¡ˆï¼Ÿ HTTP æµçš„ä¸€äº›æ›¿ä»£æ–¹æ¡ˆåŒ…æ‹¬ï¼š\nWebSockets ï¼šWebSockets æ˜¯ä¸€ç§é€šè¿‡å•ä¸ªTCPè¿æ¥æä¾›å…¨åŒå·¥é€šä¿¡é€šé“çš„é€šä¿¡åè®®ã€‚å®ƒå…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œå®æ—¶åŒå‘é€šä¿¡ï¼Œä½¿å…¶é€‚åˆéœ€è¦æŒç»­å’Œä½å»¶è¿Ÿæ•°æ®æ›´æ–°çš„åº”ç”¨ç¨‹åºã€‚ WebRTCï¼šWebRTCï¼ˆWeb å®æ—¶é€šä¿¡ï¼‰æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œå¯å®ç°æµè§ˆå™¨å’Œç§»åŠ¨åº”ç”¨ç¨‹åºä¹‹é—´çš„å®æ—¶é€šä¿¡ã€‚å®ƒæä¾›ç”¨äºè¯­éŸ³å’Œè§†é¢‘é€šè¯ä»¥åŠç‚¹å¯¹ç‚¹æ•°æ®å…±äº«çš„ APIï¼Œä½¿å…¶æˆä¸ºè§†é¢‘ä¼šè®®å’Œå®æ—¶æµåª’ä½“åº”ç”¨ç¨‹åºçš„æµè¡Œé€‰æ‹©ã€‚ MQTTï¼ˆæ¶ˆæ¯é˜Ÿåˆ—é¥æµ‹ä¼ è¾“ï¼‰ï¼šMQTT æ˜¯ä¸€ç§ä¸“ä¸ºç‰©è”ç½‘ (IoT) è®¾è®¡çš„è½»é‡çº§æ¶ˆæ¯åè®®ã€‚å®ƒé’ˆå¯¹ä½å¸¦å®½å’Œä¸å¯é çš„ç½‘ç»œè¿›è¡Œäº†ä¼˜åŒ–ï¼Œä½¿å…¶é€‚åˆèµ„æºæœ‰é™çš„ç‰©è”ç½‘è®¾å¤‡ã€‚ MQTT å…è®¸ç‰©è”ç½‘è®¾å¤‡å’Œåç«¯ç³»ç»Ÿä¹‹é—´è¿›è¡Œé«˜æ•ˆã€å®æ—¶çš„é€šä¿¡ã€‚ RTMPï¼ˆå®æ—¶æ¶ˆæ¯åè®®ï¼‰ï¼šRTMP æ˜¯ Adobe Systems å¼€å‘çš„ä¸€ç§æµåè®®ï¼Œç”¨äºé€šè¿‡äº’è”ç½‘ä¼ è¾“éŸ³é¢‘ã€è§†é¢‘å’Œæ•°æ®ã€‚å®ƒå·²å¹¿æ³›ç”¨äºå®æ—¶æµåª’ä½“å’Œè§†é¢‘ç‚¹æ’­åº”ç”¨ç¨‹åºï¼Œä½†è¿‘å¹´æ¥ç”±äºåŸºäº HTTP çš„æµåª’ä½“åè®®çš„å…´èµ·ï¼Œå…¶ä½¿ç”¨é‡æœ‰æ‰€ä¸‹é™ã€‚ HLSï¼ˆHTTP Live Streamingï¼‰ï¼šHLS æ˜¯ Apple å¼€å‘çš„è‡ªé€‚åº”æµåª’ä½“åè®®ï¼Œç”¨äºé€šè¿‡äº’è”ç½‘ä¼ è¾“åª’ä½“å†…å®¹ã€‚å®ƒå°†å†…å®¹åˆ†è§£ä¸ºå°çš„åˆ†æ®µæ–‡ä»¶ï¼Œå®¢æˆ·ç«¯å¯ä»¥å®æ—¶ä¸‹è½½å’Œæ’­æ”¾ã€‚ HLS å¹¿æ³›ç”¨äºæµå¼ä¼ è¾“ç°åœºæ´»åŠ¨ç‚¹æ’­è§†é¢‘ï¼Œåœ¨ä¸åŒè®¾å¤‡å’Œç½‘ç»œæ¡ä»¶ä¸‹æä¾›é«˜è´¨é‡çš„è§†é¢‘æ’­æ”¾ã€‚ SPDYï¼ˆå‘éŸ³ä¸ºâ€œspeedyâ€ï¼‰ï¼šSPDY æ˜¯ Google å¼€å‘çš„ä¸€ç§å·²å¼ƒç”¨çš„ç½‘ç»œåè®®ï¼Œç”¨äºæé«˜ç½‘é¡µæµè§ˆçš„é€Ÿåº¦å’Œå®‰å…¨æ€§ã€‚å®ƒæ—¨åœ¨é€šè¿‡å¼•å…¥å¤šè·¯å¤ç”¨ã€æ ‡å¤´å‹ç¼©å’Œè¯·æ±‚ä¼˜å…ˆçº§ç­‰åŠŸèƒ½æ¥å‡å°‘å»¶è¿Ÿå¹¶ä¼˜åŒ– Web å†…å®¹äº¤ä»˜ã€‚ç„¶è€Œï¼ŒSPDY å·²è¢« HTTP/2 å–ä»£ï¼ŒHTTP/2 åˆå¹¶äº† SPDY çš„è®¸å¤šåŠŸèƒ½ã€‚ WebSocket++ã€Boost.Asioå’Œå…¶ä»–åº“ï¼šè¿™äº›åº“å’Œæ¡†æ¶æä¾›ä½çº§ API å’Œå·¥å…·ï¼Œç”¨äºä½¿ç”¨ WebSocket ç­‰åè®®æ„å»ºå®æ—¶é€šä¿¡åº”ç”¨ç¨‹åºã€‚ä¸ HTTP æµç­‰é«˜çº§åè®®ç›¸æ¯”ï¼Œå®ƒä»¬æä¾›äº†æ›´å¤šçš„çµæ´»æ€§å’Œå®šåˆ¶é€‰é¡¹ï¼Œä½†éœ€è¦æ›´å¤šçš„å¼€å‘å·¥ä½œå’Œä¸“ä¸šçŸ¥è¯†ã€‚ åœ¨é€‰æ‹© HTTP æµçš„æ›¿ä»£æ–¹æ¡ˆæ—¶ï¼Œè€ƒè™‘åº”ç”¨ç¨‹åºçš„ç‰¹å®šè¦æ±‚å’Œé™åˆ¶éå¸¸é‡è¦ã€‚åº”è€ƒè™‘å¯æ‰©å±•æ€§ã€å®‰å…¨æ€§ã€å…¼å®¹æ€§å’Œå¼€å‘äººå‘˜ç†Ÿæ‚‰ç¨‹åº¦ï¼Œä»¥ç¡®ä¿æœ€é€‚åˆæ‚¨çš„ç”¨ä¾‹ã€‚\nTCP å’Œ HTTP æµæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ TCPï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼‰å’Œ HTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰æµæ˜¯é€šè¿‡äº’è”ç½‘ä¼ è¾“æ•°æ®çš„æµè¡Œåè®®ã€‚ TCP æ˜¯ä¸€ç§å¯é çš„ã€é¢å‘è¿æ¥çš„åè®®ï¼Œè€Œ HTTP æµæ˜¯ä¸€ç§æ›´æ–°çš„æµåª’ä½“å†…å®¹æ–¹æ³•ã€‚è®©æˆ‘ä»¬æ·±å…¥æ¢è®¨ä¸€ä¸‹ä¸¤è€…ä¹‹é—´çš„å·®å¼‚ï¼š\né¢å‘è¿æ¥ä¸æ— è¿æ¥ï¼š\nTCPæ˜¯ä¸€ç§[é¢å‘è¿æ¥çš„åè®®](https://nordvpn.com/cybersecurity/glossary/connection-oriented-protocol/#:~:text=A connection-oriented protocol is,data in a structured way.)ï¼Œè¿™æ„å‘³ç€å®ƒåœ¨å‘é€æ–¹å’Œæ¥æ”¶æ–¹ä¹‹é—´å»ºç«‹ç›´æ¥ã€å¯é ã€æŒä¹…çš„è¿æ¥ã€‚è¿™ç¡®ä¿äº†æ•°æ®åŒ…æŒ‰ç…§å‘é€é¡ºåºä¼ é€ï¼Œå¹¶ä¸”æ²¡æœ‰ä»»ä½•ä¸¢å¤±æˆ–é‡å¤ã€‚ HTTP æµåŸºäºæ— è¿æ¥æ¨¡å‹ï¼Œå…¶ä¸­å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€å•ç‹¬çš„ HTTP è¯·æ±‚ï¼ŒæœåŠ¡å™¨é€šå¸¸å®æ—¶å“åº”æ•°æ®å—ã€‚\næ•°æ®ä¼ è¾“ï¼š\nTCP é€šè¿‡ä½¿ç”¨é”™è¯¯æ£€æµ‹ã€ä¸¢å¤±æ•°æ®åŒ…é‡ä¼ å’Œæµé‡æ§åˆ¶ç­‰å„ç§æœºåˆ¶æ¥ç¡®ä¿æ•°æ®çš„å¯é ä¼ è¾“ã€‚å®ƒä¿è¯æ¥æ”¶æ–¹æŒ‰ç…§å‘é€çš„é¡ºåºè·å–æ‰€æœ‰æ•°æ®ã€‚ HTTP æµä¾§é‡äºå®æ—¶å¤šåª’ä½“å†…å®¹ä¼ è¾“ï¼Œä¾‹å¦‚éŸ³é¢‘æˆ–è§†é¢‘ã€‚å®ƒä¼˜å…ˆè€ƒè™‘ä½å»¶è¿Ÿå’Œå“åº”èƒ½åŠ›ï¼Œè€Œä¸æ˜¯ä¿è¯æ¯ä¸ªæ•°æ®åŒ…çš„ä¼ è¾“ã€‚\nç«¯å£å’Œåè®®ï¼š\nTCP ä½¿ç”¨ç«¯å£å·æ¥è¯†åˆ«è®¾å¤‡ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºæˆ–æœåŠ¡ã€‚ç”¨äº HTTP é€šä¿¡çš„ TCP é»˜è®¤ç«¯å£æ˜¯ 80ã€‚å¦ä¸€æ–¹é¢ï¼ŒHTTP æµé€šå¸¸ä½¿ç”¨ HTTP Live Streaming (HLS) æˆ–HTTP ä¸Šçš„åŠ¨æ€è‡ªé€‚åº”æµ (DASH)ç­‰æ›´é«˜çº§åˆ«çš„åè®®æ¥ä¼ è¾“åª’ä½“å†…å®¹ã€‚è¿™äº›åè®®é€šè¿‡æ ‡å‡† HTTP ç«¯å£ï¼ˆ80 æˆ– 443ï¼‰è¿è¡Œã€‚\nå¯æ‰©å±•æ€§ï¼š\nTCP ä¸“ä¸ºä¸¤ä¸ªè®¾å¤‡ä¹‹é—´çš„ç‚¹å¯¹ç‚¹é€šä¿¡è€Œè®¾è®¡ã€‚å½“å°è¯•å¤„ç†è®¸å¤šå¹¶å‘è¿æ¥æ—¶ï¼Œå®ƒå¯èƒ½ä¼šé¢ä¸´å¯æ‰©å±•æ€§æŒ‘æˆ˜ã€‚ HTTP æµå¯ä»¥åˆ©ç”¨è´Ÿè½½å¹³è¡¡æŠ€æœ¯å’Œå†…å®¹äº¤ä»˜ç½‘ç»œ (CDN) åœ¨å¤šä¸ªæœåŠ¡å™¨ä¹‹é—´åˆ†é…æµå·¥ä½œè´Ÿè½½ï¼Œä»è€Œå®ç°å¤„ç†é«˜æµé‡çš„å¯æ‰©å±•æ€§ã€‚\nå®‰å…¨ï¼š\nTCP æä¾›å›ºæœ‰çš„å®‰å…¨åŠŸèƒ½ï¼Œä¾‹å¦‚åŠ å¯†å’Œèº«ä»½éªŒè¯ã€‚ç„¶è€Œï¼Œå¯ä»¥åœ¨ TCP ä¹‹ä¸Šå®æ–½SSL/TLSç­‰é™„åŠ å®‰å…¨æªæ–½ï¼Œä»¥ç¡®ä¿å®‰å…¨é€šä¿¡ã€‚ HTTP æµè¿˜å¯ä»¥ä½¿ç”¨ SSL/TLS è¿›è¡Œå®‰å…¨æ•°æ®ä¼ è¾“ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥åº”ç”¨æ•°å­—ç‰ˆæƒç®¡ç† (DRM) ç­‰å†…å®¹ä¿æŠ¤æŠ€æœ¯æ¥ä¿æŠ¤å¤šåª’ä½“å†…å®¹ã€‚\nå…¼å®¹æ€§ï¼š\næ‰€æœ‰ä¸»è¦æ“ä½œç³»ç»Ÿã€ç½‘ç»œè®¾å¤‡å’Œç¼–ç¨‹è¯­è¨€éƒ½å¹¿æ³›æ”¯æŒ TCPã€‚å®ƒæ˜¯äº’è”ç½‘é€šä¿¡çš„åŸºç¡€åè®®ã€‚ HTTPä½œä¸ºåº”ç”¨å±‚åè®®ä¹Ÿå¾—åˆ°äº†å¹¿æ³›çš„æ”¯æŒï¼Œå¹¶ä¸”HTTPæµå¯ä»¥åœ¨ç°æœ‰HTTPåŸºç¡€è®¾æ–½ä¹‹ä¸Šå®ç°ã€‚\næ€»ä¹‹ï¼ŒTCP æ˜¯ä¸€ç§å¯é ä¸”é¢å‘è¿æ¥çš„åè®®ï¼Œé€‚ç”¨äºä¸€èˆ¬æ•°æ®ä¼ è¾“ï¼Œè€Œ HTTP æµæ˜¯ä¸€ç§ä¸“æ³¨äºå®æ—¶å¤šåª’ä½“å†…å®¹ä¼ è¾“çš„æœ€æ–°æ–¹æ³•ã€‚æ¯ä¸ªåè®®éƒ½æœ‰å…¶ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Œå¹¶ä¸”ç”¨äºä¸åŒçš„åœºæ™¯ã€‚æ„å»ºå®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºçš„å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®æ•°æ®ä¼ è¾“ã€å¯æ‰©å±•æ€§ã€å®‰å…¨æ€§å’Œå…¼å®¹æ€§çš„ç‰¹å®šè¦æ±‚åœ¨ TCP å’Œ HTTP æµä¹‹é—´è¿›è¡Œé€‰æ‹©ã€‚\nHTTP æµä¸ REST HTTP æµå’ŒRESTæ˜¯ Web åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­ä¸¤ç§ä¸åŒçš„æ•°æ®ä¼ è¾“æ–¹æ³•ã€‚\nHTTP æµæ˜¯æŒ‡é€šè¿‡ HTTP è¿æ¥ä»æœåŠ¡å™¨è¿ç»­å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ã€‚å®ƒå¯ä»¥å®æ—¶ä¼ è¾“éŸ³é¢‘æˆ–è§†é¢‘æµç­‰å¤šåª’ä½“å†…å®¹ã€‚ HTTP æµé€šå¸¸æ¶‰åŠä½¿ç”¨ HTTP Live Streaming (HLS) æˆ– Dynamic Adaptive Streaming over HTTP (DASH) ç­‰åè®®æ¥ä»¥å°å—å½¢å¼ä¼ é€å†…å®¹ã€‚è¿™ç§æ–¹æ³•å…è®¸å®¢æˆ·ç«¯åœ¨æ¥æ”¶åª’ä½“æ—¶æ’­æ”¾åª’ä½“ï¼Œè€Œæ— éœ€ç­‰å¾…æ•´ä¸ªæ–‡ä»¶ä¸‹è½½ã€‚\nå¦ä¸€æ–¹é¢ï¼ŒRESTï¼ˆè¡¨è¿°æ€§çŠ¶æ€ä¼ è¾“ï¼‰æ˜¯ä¸€ç§ç”¨äºè®¾è®¡ç½‘ç»œåº”ç”¨ç¨‹åºçš„æ¶æ„é£æ ¼ã€‚å®ƒåŸºäºæ—¨åœ¨ä½¿ Web æœåŠ¡å¯æ‰©å±•ã€æ— çŠ¶æ€å’Œå¯äº’æ“ä½œçš„åŸåˆ™å’Œçº¦æŸã€‚ RESTful APIï¼ˆåº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼‰ä½¿ç”¨ HTTP ä½œä¸ºåº•å±‚é€šä¿¡åè®®ï¼Œä½†ä¸æ¶‰åŠå®æ—¶æ•°æ®æµã€‚ç›¸åï¼ŒREST API éµå¾ªè¯·æ±‚-å“åº”æ¨¡å‹ï¼Œå…¶ä¸­å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨ä»¥æ‰€è¯·æ±‚èµ„æºçš„è¡¨ç¤ºå½¢å¼è¿›è¡Œå“åº”ã€‚\nHTTP æµä¸é•¿è½®è¯¢ åœ¨æ¯”è¾ƒå®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºçš„HTTP æµå’Œé•¿è½®è¯¢æ—¶ï¼Œéœ€è¦è€ƒè™‘å‡ ä¸ªå› ç´ ã€‚è¿™ä¸¤ç§æ–¹æ³•éƒ½æœ‰ä¼˜ç‚¹å’Œå±€é™æ€§ï¼Œå› æ­¤äº†è§£å®ƒä»¬çš„å·®å¼‚ä»¥åšå‡ºæ˜æ™ºçš„å†³å®šéå¸¸é‡è¦ã€‚\nHTTP æµæ˜¯ä¸€ç§æœåŠ¡å™¨é€šè¿‡å•ä¸ªé•¿æœŸè¿æ¥å°†æ•°æ®æ¨é€åˆ°å®¢æˆ·ç«¯çš„æŠ€æœ¯ã€‚è¿™å…è®¸å®æ—¶æ¶ˆæ¯ä¼ é€’ï¼Œå› ä¸ºæ›´æ–°ä¸€æ—¦å¯ç”¨å°±å¯ä»¥å‘é€åˆ°å®¢æˆ·ç«¯ã€‚ HTTP æµå¯¹äºéœ€è¦ä½å»¶è¿Ÿå’Œé«˜å¹¶å‘çš„åº”ç”¨ç¨‹åºå°¤å…¶æœ‰æ•ˆã€‚\nå¦ä¸€æ–¹é¢ï¼Œé•¿è½®è¯¢æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨å°†è¯·æ±‚ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œç›´åˆ°æœ‰æ–°æ•°æ®å¯ç”¨æˆ–å‘ç”Ÿè¶…æ—¶ã€‚è¿™ç§æ–¹æ³•é€šè¿‡ä¸æ–­è¯·æ±‚æœåŠ¡å™¨æ£€æŸ¥æ›´æ–°æ¥æ¨¡æ‹Ÿå®æ—¶é€šä¿¡ã€‚é•¿è½®è¯¢å¯¹äºä¸éœ€è¦ç«‹å³æ›´æ–°å¹¶ä¸”å¯ä»¥å®¹å¿ç¨é«˜å»¶è¿Ÿçš„åº”ç”¨ç¨‹åºéå¸¸æœ‰ç”¨ã€‚\nä¸é•¿è½®è¯¢ç›¸æ¯”ï¼ŒHTTP æµå¼ä¼ è¾“çš„ä¼˜åŠ¿ä¹‹ä¸€æ˜¯èƒ½å¤Ÿè½»æ¾å¤„ç†é«˜å¹¶å‘æ€§å’Œæ‰©å±•æ€§ã€‚ç›¸åï¼Œé•¿è½®è¯¢å¯èƒ½éš¾ä»¥æœ‰æ•ˆåœ°å¤„ç†å¤§é‡å¹¶å‘è¿æ¥ã€‚\nåœ¨æ€§èƒ½æ–¹é¢ï¼ŒHTTP æµå¼ä¼ è¾“å…·æœ‰ä½å»¶è¿Ÿçš„ä¼˜ç‚¹ï¼Œå› ä¸ºæ›´æ–°ä¸€æ—¦å¯ç”¨å°±ä¼šç«‹å³æ¨é€åˆ°å®¢æˆ·ç«¯ã€‚è¿™ç§æ¶ˆæ¯çš„å®æ—¶ä¼ é€’ç¡®ä¿ç”¨æˆ·æ¯«ä¸å»¶è¿Ÿåœ°æ”¶åˆ°æœ€æ–°çš„ä¿¡æ¯ã€‚ç›¸åï¼Œé•¿è½®è¯¢ä¼šå¸¦æ¥è½»å¾®çš„å»¶è¿Ÿï¼Œå› ä¸ºå®¢æˆ·ç«¯éœ€è¦è¯·æ±‚æœåŠ¡å™¨ä¸æ–­æ£€æŸ¥æ›´æ–°ã€‚\nHTTP æµåª’ä½“å’Œå…¶ä»–æµåª’ä½“åè®®æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ HTTP æµä¹Ÿç§°ä¸ºåŸºäº HTTP çš„è‡ªé€‚åº”æµï¼Œæ˜¯ä¸€ç§é€šè¿‡å¸¸è§„ HTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰è¿æ¥ä¼ é€å¤šåª’ä½“å†…å®¹çš„æµåè®®ã€‚å®ƒä¸å…¶ä»–æµåª’ä½“åè®®ï¼ˆä¾‹å¦‚RTSPï¼ˆå®æ—¶æµåª’ä½“åè®®ï¼‰å’ŒRTMPï¼ˆå®æ—¶æ¶ˆæ¯åè®®ï¼‰ï¼‰æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹é¢çš„ä¸åŒï¼š\nä¼ è¾“åè®®ï¼š HTTP æµä½¿ç”¨ HTTP åè®®ï¼Œå—åˆ° Web æœåŠ¡å™¨ã€ä»£ç†å’Œé˜²ç«å¢™çš„å¹¿æ³›æ”¯æŒã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒRTSP å’Œ RTMP ä½¿ç”¨ä¼ è¾“åè®®ï¼Œè¿™å¯èƒ½éœ€è¦ç‰¹æ®Šé…ç½®æˆ–ä¸“ç”¨åŸºç¡€è®¾æ–½ã€‚\n**å¯ç§»æ¤æ€§ï¼š**ç”±äº HTTP æ˜¯æ ‡å‡†åè®®ï¼Œå› æ­¤å„ç§è®¾å¤‡å’Œå¹³å°éƒ½å¯ä»¥è½»æ¾è®¿é—® HTTP æµï¼Œè€Œä¸éœ€è¦ç‰¹å®šçš„å®¢æˆ·ç«¯åº“æˆ–æ’ä»¶ã€‚å¦ä¸€æ–¹é¢ï¼ŒRTSP å’Œ RTMP å¯èƒ½éœ€è¦ä¸“é—¨çš„å®¢æˆ·ç«¯æˆ–æ’ä»¶æ¥è®¿é—®æµå†…å®¹ã€‚\nå¯æ‰©å±•æ€§ï¼š HTTP æµåˆ©ç”¨æ ‡å‡† Web åŸºç¡€è®¾æ–½ï¼Œå…è®¸å†…å®¹åˆ†å‘ç½‘ç»œ (CDN)è·¨å¤šä¸ªæœåŠ¡å™¨å’Œä½ç½®é«˜æ•ˆåˆ†å‘æµå†…å®¹ã€‚è¿™ä½¿å¾—æµåª’ä½“åº”ç”¨ç¨‹åºå…·æœ‰æ›´å¥½çš„å¯æ‰©å±•æ€§å’Œæ›´å¹¿æ³›çš„è¦†ç›–èŒƒå›´ã€‚ç„¶è€Œï¼ŒRTSP å’Œ RTMP å¯èƒ½éœ€è¦æ›´å¤æ‚çš„è®¾ç½®æ‰èƒ½å®ç°ç±»ä¼¼çš„å¯æ‰©å±•æ€§ã€‚\nè‡ªé€‚åº”æ¯”ç‰¹ç‡æµåª’ä½“ï¼š HTTP æµåª’ä½“æ”¯æŒ[è‡ªé€‚åº”æ¯”ç‰¹ç‡æµåª’ä½“](https://www.cloudflare.com/learning/video/what-is-adaptive-bitrate-streaming/#:~:text=Adaptive bitrate streaming adjusts video,%2C location%2C or Internet speed.)ï¼Œå¯æ ¹æ®è§‚çœ‹è€…çš„å¯ç”¨å¸¦å®½å’Œè®¾å¤‡åŠŸèƒ½åŠ¨æ€è°ƒæ•´è§†é¢‘è´¨é‡ã€‚å³ä½¿åœ¨ä¸åŒçš„ç½‘ç»œæ¡ä»¶ä¸‹ï¼Œè¿™ä¹Ÿå¯ç¡®ä¿æµç•…çš„è§‚çœ‹ä½“éªŒã€‚ RTSP å’Œ RTMP é€šå¸¸ä¸æä¾›å†…ç½®çš„è‡ªé€‚åº”æ¯”ç‰¹ç‡æµã€‚\n**é˜²ç«å¢™å’Œä»£ç†ï¼š**é€šè¿‡ HTTP çš„ HTTP æµå¯ä»¥è½»æ¾ç©¿è¶Šé˜²ç«å¢™å’Œä»£ç†ï¼Œå› ä¸ºå®ƒä½¿ç”¨æ ‡å‡† HTTP ç«¯å£ï¼ˆHTTPS çš„ç«¯å£ 80 æˆ– 443ï¼‰ï¼Œé€šå¸¸åœ¨å¤§å¤šæ•°ç½‘ç»œé…ç½®ä¸­æ‰“å¼€ã€‚ç›¸åï¼ŒRTSP å’Œ RTMP å¯èƒ½éœ€è¦ç‰¹å®šçš„ç«¯å£é…ç½®æˆ–é¢å¤–çš„ç½‘ç»œè®¾ç½®æ‰èƒ½ç»•è¿‡é˜²ç«å¢™å’Œä»£ç†ã€‚\næ€»ä½“è€Œè¨€ï¼ŒHTTP æµåœ¨æ˜“äºå®æ–½ã€å¯ç§»æ¤æ€§ã€å¯æ‰©å±•æ€§ã€è‡ªé€‚åº”æ¯”ç‰¹ç‡æµä»¥åŠä¸é˜²ç«å¢™å’Œä»£ç†çš„å…¼å®¹æ€§æ–¹é¢å…·æœ‰ä¼˜åŠ¿ã€‚è¿™äº›å› ç´ ä½¿å…¶æˆä¸ºæ„å»ºéœ€è¦å¯æ‰©å±•æ€§å’Œå®‰å…¨æ€§çš„å®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºçš„å¼€å‘äººå‘˜çš„é¦–é€‰ã€‚\nå¦‚ä½•è®¾ç½® HTTP æµåª’ä½“æœåŠ¡å™¨ï¼Ÿ è®¾ç½® HTTP æµåª’ä½“æœåŠ¡å™¨éœ€è¦å‡ ä¸ªæ­¥éª¤æ‰èƒ½ç¡®ä¿æ— ç¼ä¸”é«˜æ•ˆçš„æµåª’ä½“ä½“éªŒã€‚ä»¥ä¸‹æ˜¯å¸®åŠ©æ‚¨å…¥é—¨çš„åˆ†æ­¥æŒ‡å—ï¼š\né€‰æ‹©æµåª’ä½“åè®®ï¼šæœ‰å¤šç§å¯ç”¨çš„æµåª’ä½“åè®®ï¼ŒåŒ…æ‹¬ HTTP Live Streaming (HLS)ã€Dynamic Adaptive Streaming over HTTP (DASH) å’Œ Smooth Streamingã€‚é€‰æ‹©æœ€é€‚åˆæ‚¨çš„è¦æ±‚å’Œç›®æ ‡è®¾å¤‡çš„åè®®ã€‚ å®‰è£… Web æœåŠ¡å™¨ï¼šè¦é€šè¿‡ HTTP ä¼ è¾“å†…å®¹ï¼Œæ‚¨éœ€è¦ä¸€ä¸ª Web æœåŠ¡å™¨ã€‚æµè¡Œçš„é€‰é¡¹åŒ…æ‹¬Apache HTTP Serverã€Nginxå’ŒMicrosoft IISã€‚é€‰æ‹©ä¸æ‚¨çš„æ“ä½œç³»ç»Ÿå…¼å®¹çš„ä¸€æ¬¾å¹¶å°†å…¶å®‰è£…åœ¨æ‚¨çš„æœåŠ¡å™¨ä¸Šã€‚ é…ç½® Web æœåŠ¡å™¨ï¼šå®‰è£…åï¼Œæ‚¨å¿…é¡»é…ç½® Web æœåŠ¡å™¨ä»¥å¤„ç†æµè¯·æ±‚ã€‚è¿™é€šå¸¸æ¶‰åŠä¿®æ”¹æœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶ã€‚æœ‰å…³å¦‚ä½•è®¾ç½®æµå¼ä¼ è¾“çš„è¯¦ç»†è¯´æ˜ï¼Œè¯·å‚é˜…ç‰¹å®šäºæ‚¨æ‰€é€‰ Web æœåŠ¡å™¨çš„æ–‡æ¡£ã€‚ å‡†å¤‡æ‚¨çš„å†…å®¹ï¼šåœ¨è¿›è¡Œæµå¼ä¼ è¾“ä¹‹å‰ï¼Œæ‚¨å¿…é¡»å‡†å¤‡å¥½è¦ä¼ é€çš„å†…å®¹ã€‚è¿™åŒ…æ‹¬å°†è§†é¢‘æ–‡ä»¶ç¼–ç ä¸ºé€‚å½“çš„æ ¼å¼ã€åˆ›å»ºæ’­æ”¾åˆ—è¡¨ä»¥åŠå°†å†…å®¹åˆ†å‰²æˆæ›´å°çš„å—ã€‚å„ç§ç¼–ç å·¥å…·å’Œè½¯ä»¶ï¼ˆä¾‹å¦‚FFmpegæˆ–Adobe Media Encoderï¼‰å¯ä»¥å¸®åŠ©æ‚¨å®Œæˆæ­¤è¿‡ç¨‹ã€‚ è®¾ç½®å†…å®¹äº¤ä»˜ï¼šè€ƒè™‘ä½¿ç”¨å†…å®¹äº¤ä»˜ç½‘ç»œ (CDN) å°†æµåª’ä½“å†…å®¹é«˜æ•ˆåœ°äº¤ä»˜ç»™ç”¨æˆ·ã€‚ CDN å°†æ‚¨çš„å†…å®¹ç¼“å­˜åœ¨è·ç¦»å—ä¼—æ›´è¿‘çš„æœåŠ¡å™¨ä¸Šï¼Œä»è€Œå‡å°‘å»¶è¿Ÿå¹¶æé«˜æµåª’ä½“æ€§èƒ½ã€‚ æµ‹è¯•å’Œç›‘æ§ï¼šè®¾ç½®æµåª’ä½“æœåŠ¡å™¨åï¼Œæµ‹è¯•å’Œç›‘æ§å…¶æ€§èƒ½è‡³å…³é‡è¦ã€‚è¿›è¡Œå½»åº•çš„æµ‹è¯•ï¼Œä»¥ç¡®ä¿æ‚¨çš„æµåª’ä½“å†…å®¹é¡ºåˆ©äº¤ä»˜ï¼Œæ²¡æœ‰ä»»ä½•æ•…éšœã€‚ç›‘æ§ç¼“å†²æ—¶é—´ã€è§†é¢‘è´¨é‡å’Œç½‘ç»œå»¶è¿Ÿç­‰å…³é”®æŒ‡æ ‡ï¼Œä»¥è¯†åˆ«æ½œåœ¨é—®é¢˜å¹¶è¿›è¡Œå¿…è¦çš„è°ƒæ•´ã€‚ æ ¹æ®éœ€è¦è¿›è¡Œæ‰©å±•ï¼šéšç€ç”¨æˆ·ç¾¤çš„å¢é•¿ä»¥åŠå¯¹æµåª’ä½“æœåŠ¡çš„éœ€æ±‚çš„å¢åŠ ï¼Œæ‚¨å¯èƒ½éœ€è¦æ‰©å±•æœåŠ¡å™¨åŸºç¡€è®¾æ–½æ¥å¤„ç†è´Ÿè½½ã€‚è€ƒè™‘ä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨ã€é›†ç¾¤æˆ–åŸºäºäº‘çš„è§£å†³æ–¹æ¡ˆæ¥ç¡®ä¿å¯æ‰©å±•æ€§å’Œé«˜å¯ç”¨æ€§ã€‚ ä¿æŠ¤æ‚¨çš„æµåª’ä½“æœåŠ¡å™¨ï¼šä¸ºäº†ä¿æŠ¤æ‚¨çš„æµåª’ä½“å†…å®¹å¹¶ç¡®ä¿æœåŠ¡å™¨çš„å®‰å…¨ï¼Œè¯·å®æ–½é€‚å½“çš„å®‰å…¨æªæ–½ã€‚è¿™å¯èƒ½åŒ…æ‹¬ä½¿ç”¨ HTTPS ç­‰åŠ å¯†åè®®ã€å®æ–½è®¿é—®æ§åˆ¶ä»¥åŠå®šæœŸæ›´æ–°æœåŠ¡å™¨è½¯ä»¶ä»¥ä¿®è¡¥ä»»ä½•æ¼æ´ã€‚ HTTP æµåª’ä½“éœ€è¦ä»€ä¹ˆè½¯ä»¶ï¼Ÿ è¦å¯ç”¨ HTTP æµï¼Œéœ€è¦å¤šä¸ªè½¯ä»¶ç»„ä»¶ã€‚æ‰€éœ€çš„å…·ä½“è½¯ä»¶å–å†³äºæ‰€ä½¿ç”¨çš„æµåª’ä½“åè®®ã€‚ä»¥ä¸‹æ˜¯ä¸¤ç§æœ€å¸¸è§çš„ HTTP æµåè®®çš„å…³é”®ç»„ä»¶ï¼š\nHTTP ç›´æ’­ (HLS)ï¼š\nåª’ä½“ç¼–ç å™¨ï¼šApple åŸºäº macOS çš„åª’ä½“ç¼–ç å·¥å…·â€œ Compressor â€æˆ– FFmpeg ç­‰è½¯ä»¶å¯ä»¥å°†è§†é¢‘å’ŒéŸ³é¢‘æ–‡ä»¶ç¼–ç ä¸ºä¸ HLS å…¼å®¹çš„æ‰€éœ€æ ¼å¼ã€‚ åª’ä½“åˆ†æ®µå™¨ï¼šè¯¥è½¯ä»¶å°†ç¼–ç åª’ä½“åˆ’åˆ†ä¸ºå°çš„ã€å¯ç®¡ç†çš„å—ï¼ˆç§°ä¸ºæ®µï¼‰ã€‚ Apple çš„â€œ mediafilesegmenter â€æˆ–â€œBento4â€ç­‰å¼€æºå·¥å…·å¯ä»¥æ‰§è¡Œæ­¤ä»»åŠ¡ã€‚ Web æœåŠ¡å™¨ï¼šéœ€è¦ Web æœåŠ¡å™¨ï¼ˆä¾‹å¦‚ Apache æˆ– Nginxï¼‰é€šè¿‡ HTTP å‘å®¢æˆ·ç«¯æä¾›åª’ä½“æ–‡ä»¶ã€‚ CDNï¼ˆå†…å®¹äº¤ä»˜ç½‘ç»œï¼‰ï¼šCDN å¯ä»¥åœ¨åœ°ç†ä¸Šè·¨å¤šä¸ªæœåŠ¡å™¨åˆ†å‘åª’ä½“æ–‡ä»¶ï¼Œä»è€Œå‡å°‘å»¶è¿Ÿå¹¶æé«˜å¯æ‰©å±•æ€§ã€‚ HTTP åŠ¨æ€è‡ªé€‚åº”æµå¼ä¼ è¾“ (DASH)ï¼š\nåª’ä½“ç¼–ç å™¨ï¼šä¸ HLS ç±»ä¼¼ï¼Œåª’ä½“ç¼–ç å™¨å¿…é¡»å°†è§†é¢‘å’ŒéŸ³é¢‘æ–‡ä»¶ç¼–ç ä¸º DASH å…¼å®¹çš„æ ¼å¼ã€‚ FFmpeg ä¹Ÿæ˜¯ä¸€ä¸ªæµè¡Œçš„é€‰æ‹©ã€‚ DASH Packagerï¼šè¯¥è½¯ä»¶å°†ç¼–ç åª’ä½“æ‰“åŒ…æˆå¿…è¦çš„ DASH æ ¼å¼ï¼ˆ[MPD - åª’ä½“æ¼”ç¤ºæè¿°](https://ott.dolby.com/OnDelKits/DDP/Dolby_Digital_Plus_Online_Delivery_Kit_v1.5/Documentation/Content_Creation/SDM/help_files/topics/ddp_mpeg_dash_c_dash_mpd_ov.html#:~:text=Media Presentation Description-,A Media Presentation Description (MPD) is a hierarchical XML document,make up a media presentation.)ï¼‰ã€‚MP4Boxç­‰å¼€æºå·¥å…·æˆ–Bitmovinç­‰å•†ä¸šè§£å†³æ–¹æ¡ˆå¯ä»¥æ‰§è¡Œæ­¤ä»»åŠ¡ã€‚ Web æœåŠ¡å™¨ï¼šä»ç„¶éœ€è¦ Web æœåŠ¡å™¨é€šè¿‡ HTTP å‘å®¢æˆ·ç«¯æä¾›åª’ä½“æ–‡ä»¶ï¼Œå°±åƒåœ¨ HLS ä¸­ä¸€æ ·ã€‚ CDNï¼ˆå†…å®¹äº¤ä»˜ç½‘ç»œï¼‰ CDN å¯ä»¥è·¨å¤šä¸ªæœåŠ¡å™¨åˆ†å‘åª’ä½“æ–‡ä»¶ï¼Œä»¥æé«˜å¯æ‰©å±•æ€§å¹¶å‡å°‘å»¶è¿Ÿã€‚ é™¤äº†è¿™äº›ç»„ä»¶ä¹‹å¤–ï¼Œæ‚¨å¯èƒ½è¿˜éœ€è¦å…¶ä»–è½¯ä»¶æˆ–å·¥å…·ï¼Œå…·ä½“å–å†³äºæ‚¨çš„å…·ä½“è¦æ±‚ã€‚å…¶ä¸­åŒ…æ‹¬ä¾›å®¢æˆ·ç«¯æ’­æ”¾æµåª’ä½“å†…å®¹çš„åª’ä½“æ’­æ”¾å™¨ã€ç”¨äºå†…å®¹ä¿æŠ¤çš„DRMï¼ˆæ•°å­—ç‰ˆæƒç®¡ç†ï¼‰ç³»ç»Ÿä»¥åŠç”¨äºç›‘æ§å’Œåˆ†ææµåª’ä½“æ€§èƒ½çš„åˆ†æå·¥å…·ã€‚\nåœ¨è€ƒè™‘ç”¨äº HTTP æµåª’ä½“çš„è½¯ä»¶æ—¶ï¼Œé‡è¦çš„æ˜¯é€‰æ‹©ä¸æ‚¨çš„æµåª’ä½“åŸºç¡€è®¾æ–½å…¼å®¹çš„å¯é ä¸”æ”¯æŒè‰¯å¥½çš„é€‰é¡¹ï¼Œå¹¶æ»¡è¶³æ‚¨åœ¨åŠŸèƒ½ã€å¯æ‰©å±•æ€§å’Œå®‰å…¨æ€§æ–¹é¢çš„ç‰¹å®šéœ€æ±‚ã€‚\næ‚¨å¯ä»¥ä½¿ç”¨å“ªäº› API æ¥è¿›è¡Œ HTTP æµä¼ è¾“ï¼Ÿ æœ‰å¤šä¸ª API å¯ç”¨äº HTTP æµï¼Œå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨å®ƒä»¬åœ¨åº”ç”¨ç¨‹åºä¸­å®ç°è§†é¢‘å†…å®¹äº¤ä»˜ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æµè¡Œçš„ HTTP æµ APIï¼š\nåª’ä½“æºæ‰©å±•(MSE)ï¼š MSE æ˜¯ä¸€ä¸ª Web APIï¼Œå…è®¸ JavaScript ç”Ÿæˆæ’­æ”¾åª’ä½“æµã€‚å®ƒæä¾›äº†ä¸€ç§åœ¨ä¸åŒåª’ä½“æºä¹‹é—´åŠ¨æ€åˆ‡æ¢å¹¶é€‚åº”ç½‘ç»œæ¡ä»¶çš„æ–¹æ³•ã€‚ MSE å—åˆ°ç°ä»£æµè§ˆå™¨çš„å¹¿æ³›æ”¯æŒï¼Œä½¿å…¶æˆä¸º HTTP æµçš„æµè¡Œé€‰æ‹©ã€‚\nVideo.jsï¼š Video.js æ˜¯ä¸€ä¸ªå¼€æº JavaScript åº“ï¼Œæä¾›æ”¯æŒ HTTP æµçš„ HTML5 è§†é¢‘æ’­æ”¾å™¨ã€‚å®ƒæŠ½è±¡äº†åº•å±‚è§†é¢‘æ’­æ”¾æŠ€æœ¯ï¼Œå¹¶ä¸ºå¼€å‘äººå‘˜æä¾›äº†ä¸€è‡´çš„ APIã€‚ Video.js æ”¯æŒ HLS å’Œå…¶ä»–æµæ ¼å¼ï¼Œä¾‹å¦‚ MPEG-DASH å’Œ Smooth Streamingã€‚\nDash.jsï¼š Dash.js æ˜¯ä¸€ä¸ªå®ç° HTTP æµåª’ä½“ MPEG-DASH æ ‡å‡†çš„å‚è€ƒå®¢æˆ·ç«¯ã€‚å®ƒæ˜¯ä¸€ä¸ªå¼€æº JavaScript åº“ï¼Œæä¾›åŠŸèƒ½ä¸°å¯Œçš„è§†é¢‘æ’­æ”¾å™¨ï¼Œæ”¯æŒè‡ªé€‚åº”æ¯”ç‰¹ç‡æµã€DRMã€å­—å¹•ç­‰ã€‚ Dash.js å¹¿æ³›ç”¨äº MPEG-DASH æµåª’ä½“ï¼Œå¹¶æä¾›å¹¿æ³›çš„è‡ªå®šä¹‰é€‰é¡¹ã€‚\nExoPlayerï¼š ExoPlayer æ˜¯ä¸€ä¸ªæ”¯æŒ HTTP æµåª’ä½“çš„ Android å¼€æºåª’ä½“æ’­æ”¾å™¨åº“ã€‚å®ƒä¸ºå¼€å‘äººå‘˜æä¾›äº†çµæ´»ä¸”å¯æ‰©å±•çš„ API æ¥æ„å»ºè‡ªå®šä¹‰åª’ä½“æ’­æ”¾ä½“éªŒã€‚ ExoPlayer æ”¯æŒ HLSã€MPEG-DASH å’Œå¹³æ»‘æµåª’ä½“ç­‰æ ¼å¼ã€‚\nAVPlayerï¼š AVPlayer æ˜¯ Apple ä¸ºå…¶ iPhone çš„ iOS å’Œ macOS å¹³å°æä¾›çš„æ¡†æ¶ã€‚å®ƒæ”¯æŒ HTTP æµåª’ä½“ï¼ŒåŒ…æ‹¬ HLSï¼Œå¹¶æä¾›è‡ªé€‚åº”æ¯”ç‰¹ç‡æµåª’ä½“ã€å­—å¹•å’Œç¦»çº¿æ’­æ”¾ç­‰é«˜çº§åŠŸèƒ½ã€‚ AVPlayer ä¸ºå¼€å‘äººå‘˜æä¾›äº†ä¸€ä¸ªé«˜çº§ APIï¼Œå¯ä»¥è½»æ¾åœ°å°† HTTP æµåª’ä½“é›†æˆåˆ°ä»–ä»¬çš„åº”ç”¨ç¨‹åºä¸­ã€‚\nè¿™äº›åªæ˜¯å¯ç”¨äº HTTP æµçš„ API çš„å‡ ä¸ªç¤ºä¾‹ã€‚æ ¹æ®æ‚¨çš„å…·ä½“è¦æ±‚å’Œç›®æ ‡å¹³å°ï¼Œå…¶ä»– API å¯èƒ½æ›´é€‚åˆæ‚¨çš„éœ€æ±‚ã€‚ç ”ç©¶å’Œè¯„ä¼°ä¸åŒçš„é€‰é¡¹ä»¥é€‰æ‹©ç¬¦åˆæ‚¨çš„é¡¹ç›®ç›®æ ‡å¹¶æä¾›å¿…è¦çš„åŠŸèƒ½å’Œæ€§èƒ½çš„é€‰é¡¹éå¸¸é‡è¦ã€‚\næ‚¨å¯ä»¥ä½¿ç”¨å“ªäº›ç¼–ç¨‹è¯­è¨€è¿›è¡Œ HTTP æµä¼ è¾“ï¼Ÿ æ‚¨å¯ä»¥ä½¿ç”¨å¤šç§ç¼–ç¨‹è¯­è¨€æ¥è¿›è¡Œ HTTP æµå¤„ç†ï¼Œå…·ä½“å–å†³äºæ‚¨çš„å…·ä½“éœ€æ±‚å’Œåå¥½ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æµè¡Œçš„é€‰é¡¹ï¼š\nJavaScriptï¼š JavaScriptå¹¿æ³›ç”¨äº Web å¼€å‘ï¼Œæ˜¯ Web æµè§ˆå™¨ä¸­å®¢æˆ·ç«¯è„šæœ¬çš„ä¸»è¦è¯­è¨€ã€‚å®ƒé€šå¸¸ç”¨äºåœ¨å‰ç«¯å®ç° HTTP æµï¼Œåˆ©ç”¨åª’ä½“æºæ‰©å±• (MSE) ç­‰ API ä»¥åŠ Video.js å’Œ Dash.js ç­‰åº“ã€‚\nJavaï¼šJavaæ˜¯ä¸€ç§é€šç”¨ç¼–ç¨‹è¯­è¨€ï¼Œå¸¸ç”¨äºæ„å»ºä¼ä¸šçº§åº”ç”¨ç¨‹åºã€‚å®ƒå¯ç”¨äºæœåŠ¡å™¨ç«¯çš„ HTTP æµåª’ä½“ï¼Œå…·æœ‰ ExoPlayer ç­‰æ¡†æ¶å’Œæ”¯æŒ HLSã€MPEG-DASH å’Œ Smooth Streaming ç­‰æµåª’ä½“åè®®çš„åº“ã€‚\nSwiftï¼š Swiftæ˜¯ Apple å¼€å‘çš„ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œç”¨äº iOSã€macOSã€watchOS å’Œ tvOS åº”ç”¨ç¨‹åºå¼€å‘ã€‚å®ƒå¯ç”¨äº Apple å¹³å°ä¸Šçš„ HTTP æµåª’ä½“ï¼Œåˆ©ç”¨ AVPlayer ç­‰æ¡†æ¶æä¾›é«˜çº§åŠŸèƒ½å¹¶æ”¯æŒ HLS ç­‰æµåª’ä½“åè®®ã€‚\nC#ï¼šC#æ˜¯ Microsoft å¼€å‘çš„ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œä¸»è¦ç”¨äºæ„å»º Windows åº”ç”¨ç¨‹åºã€‚å®ƒå¯ç”¨äºæœåŠ¡å™¨ç«¯çš„ HTTP æµåª’ä½“ï¼Œå…·æœ‰æ”¯æŒ HLSã€MPEG-DASH å’Œ Smooth Streaming ç­‰æµåª’ä½“åè®®çš„æ¡†æ¶å’Œåº“ã€‚\nPythonï¼š Pythonæ˜¯ä¸€ç§å¤šåŠŸèƒ½ç¼–ç¨‹è¯­è¨€ï¼Œä»¥å…¶ç®€å•æ€§å’Œå¯è¯»æ€§è€Œé—»åã€‚è™½ç„¶å®ƒå¯èƒ½ä¸æ˜¯ HTTP æµçš„æœ€å¸¸è§é€‰æ‹©ï¼Œä½† Flask å’Œ Django ç­‰åº“å’Œæ¡†æ¶å¯ä»¥ä¿ƒè¿›æµå®ç°ã€‚\nRubyï¼š Rubyæ˜¯ä¸€ç§åŠ¨æ€çš„ã€é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ï¼Œä»¥å…¶ç®€å•æ€§å’Œç”Ÿäº§åŠ›è€Œé—»åã€‚å°½ç®¡å®ƒå¯èƒ½ä¸å¸¸ç”¨äº HTTP æµï¼Œä½†åƒ EventMachine å’Œ Celluloid è¿™æ ·çš„åº“å¯ç”¨äºåœ¨ Ruby ä¸­æ„å»ºæµåº”ç”¨ç¨‹åºã€‚\nGoï¼š Goæ˜¯ä¸€ç§é™æ€ç±»å‹ã€ç¼–è¯‘å‹ç¼–ç¨‹è¯­è¨€ï¼Œæ—¨åœ¨å®ç°ç®€å•æ€§å’Œå¯æ‰©å±•æ€§ã€‚å®ƒéå¸¸æ³¨é‡å¹¶å‘æ€§ï¼Œæ˜¯æ„å»ºé«˜æ€§èƒ½æµåº”ç”¨ç¨‹åºçš„ä¸é”™é€‰æ‹©ã€‚ä¸€äº›åº“ï¼ˆä¾‹å¦‚ Gin å’Œ Revelï¼‰å¯ç”¨äº Go ä¸­çš„ HTTP æµã€‚\nPHPï¼š PHPæ˜¯ä¸€ç§å¹¿æ³›ç”¨äº Web å¼€å‘çš„æœåŠ¡å™¨ç«¯è„šæœ¬è¯­è¨€ã€‚è™½ç„¶å®ƒå¯èƒ½ä¸æ˜¯ HTTP æµæœ€æµè¡Œçš„é€‰æ‹©ï¼Œä½† Laravel ç­‰æ¡†æ¶å’Œ ReactPHP ç­‰åº“å¯ç”¨äºåœ¨ PHP ä¸­å®ç°æµåŠŸèƒ½ã€‚\nRustï¼š Rustæ˜¯ä¸€ç§ç³»ç»Ÿç¼–ç¨‹è¯­è¨€ï¼Œä»¥å…¶æ€§èƒ½ã€å¯é æ€§å’Œå†…å­˜å®‰å…¨ä¿è¯è€Œé—»åã€‚è™½ç„¶å®ƒå¯èƒ½ä¸æ˜¯ HTTP æµæœ€å¸¸ç”¨çš„è¯­è¨€ï¼Œä½†æœ‰ä¸€äº›åº“ï¼ˆä¾‹å¦‚ Tokio å’Œ Actixï¼‰å¯ç”¨äºåœ¨ Rust ä¸­æ„å»ºæµåº”ç”¨ç¨‹åºã€‚\nKotlinï¼š Kotlinæ˜¯ç”± JetBrains å¼€å‘çš„é™æ€ç±»å‹ç¼–ç¨‹è¯­è¨€ï¼Œå¹¶æ­£å¼æ”¯æŒ Android å¼€å‘ã€‚å®ƒå¯ç”¨äº Android å¹³å°ä¸Šçš„ HTTP æµåª’ä½“ï¼Œä½¿ç”¨ ExoPlayer ç­‰æ”¯æŒ HLS å’Œ MPEG-DASH ç­‰æµåª’ä½“åè®®çš„åº“ã€‚\nå“ªç§ HTTP æµåè®®æ›´çµæ´»å¹¶æä¾›äº’æ“ä½œæ€§ï¼Ÿ HTTP ä¸Šçš„åŠ¨æ€è‡ªé€‚åº”æµ (DASH) æ˜¯ HTTP æµåè®®ï¼Œä¸å…¶ä»–åè®®ç›¸æ¯”ï¼Œå®ƒæä¾›äº†æ›´å¤§çš„çµæ´»æ€§å’Œäº’æ“ä½œæ€§ã€‚ DASH ä¸ä¾èµ–äºç‰¹å®šå¹³å°æˆ–è®¾å¤‡ï¼Œå› æ­¤é€‚ç”¨äºå„ç§åº”ç”¨ç¨‹åºå’Œè®¾å¤‡ã€‚å®ƒæ”¯æŒé«˜æ•ˆç¼–ç å’Œè‡ªé€‚åº”æ¯”ç‰¹ç‡æµåª’ä½“ï¼Œç¡®ä¿åœ¨ä¸åŒç½‘ç»œæ¡ä»¶ä¸‹æä¾›æµç•…çš„æ’­æ”¾ä½“éªŒã€‚\nDASH çš„ä¸»è¦ä¼˜åŠ¿ä¹‹ä¸€æ˜¯å…¶äº’æ“ä½œæ€§ã€‚å®ƒå¾—åˆ° MPEG è¡Œä¸šè”ç›Ÿçš„æ”¯æŒï¼Œè¯¥è”ç›Ÿç”±ä¸»è¦è¡Œä¸šå‚ä¸è€…ç»„æˆï¼ŒåŒ…æ‹¬ Microsoftã€Netflix å’Œ Googleã€‚è¿™ç§å¹¿æ³›çš„æ”¯æŒç¡®ä¿äº† DASH ä¸å„ç§è®¾å¤‡ã€å¹³å°å’Œæµè§ˆå™¨å…¼å®¹ã€‚å®ƒæä¾›äº†æµåª’ä½“è§†é¢‘å†…å®¹çš„æ ‡å‡†åŒ–æ–¹æ³•ï¼Œä½¿å¼€å‘äººå‘˜æ›´å®¹æ˜“å®æ–½å’Œç»´æŠ¤ã€‚\nç›¸æ¯”ä¹‹ä¸‹ï¼ŒHTTP Live Streaming (HLS) ç­‰å…¶ä»–æµåª’ä½“åè®®ä¸ç‰¹å®šå¹³å°ç›¸å…³ï¼Œä¾‹å¦‚ Apple è®¾å¤‡å’Œæµè§ˆå™¨ã€‚è™½ç„¶ HLS åœ¨ Apple è®¾å¤‡å’Œæµè§ˆå™¨ä¸Šå¾—åˆ°å¹¿æ³›æ”¯æŒï¼Œä½†å…¶åœ¨å…¶ä»–å¹³å°ä¸Šçš„ä½¿ç”¨å¯èƒ½ä¼šå—åˆ°é™åˆ¶ã€‚è¿™å¯èƒ½ä¼šç»™æƒ³è¦ç¡®ä¿å…¶è§†é¢‘å†…å®¹è¦†ç›–æ›´å¹¿æ³›å—ä¼—çš„å¼€å‘è€…å¸¦æ¥æŒ‘æˆ˜ã€‚\nDASH åœ¨ç¼–ç é€‰é¡¹æ–¹é¢ä¹Ÿæä¾›äº†æ›´å¤§çš„çµæ´»æ€§ã€‚å®ƒæ”¯æŒå„ç§è§†é¢‘ç¼–è§£ç å™¨å’Œæ ¼å¼ï¼Œå…è®¸å¼€å‘äººå‘˜ä¸ºå…¶ç‰¹å®šç”¨ä¾‹é€‰æ‹©æœ€æœ‰æ•ˆã€æœ€åˆé€‚çš„é€‰é¡¹ã€‚è¿™ç§çµæ´»æ€§ä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿä¼˜åŒ–è§†é¢‘è´¨é‡å’Œæ–‡ä»¶å¤§å°ï¼Œä»è€Œå¢å¼ºæœ€ç»ˆç”¨æˆ·çš„æµåª’ä½“ä½“éªŒã€‚\næ­¤å¤–ï¼ŒDASH çš„è‡ªé€‚åº”æ¯”ç‰¹ç‡æµåª’ä½“åŠŸèƒ½å…è®¸åœ¨ä¸åŒçš„ç½‘ç»œæ¡ä»¶ä¸‹æ— ç¼æ’­æ”¾ã€‚å®ƒæ ¹æ®è§‚çœ‹è€…çš„äº’è”ç½‘è¿æ¥å®æ—¶è°ƒæ•´è§†é¢‘è´¨é‡ï¼Œå³ä½¿åœ¨ä¸åŒçš„ç½‘ç»œé€Ÿåº¦ä¸‹ä¹Ÿèƒ½ç¡®ä¿æµç•…çš„æµåª’ä½“ä½“éªŒã€‚è¿™ç§è‡ªé€‚åº”æ¯”ç‰¹ç‡æµåª’ä½“åŠŸèƒ½å¯¹äºå®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºè‡³å…³é‡è¦ï¼Œå¯ä»¥å®ç°ä¸é—´æ–­çš„ç”¨æˆ·é€šä¿¡ã€‚\nDASH çš„å¦ä¸€ä¸ªä¼˜åŠ¿æ˜¯å…¶å¤„ç† DRM å’Œå†…å®¹ä¿æŠ¤çš„èƒ½åŠ›ã€‚ DASH æ”¯æŒå„ç§ DRM ç³»ç»Ÿï¼Œä¾‹å¦‚Microsoft PlayReadyå’ŒGoogle Widevineï¼Œè¿™å¯¹äºä¿æŠ¤å—ç‰ˆæƒä¿æŠ¤çš„å†…å®¹å…é­æœªç»æˆæƒçš„è®¿é—®è‡³å…³é‡è¦ã€‚è¿™ç¡®ä¿äº†å¼€å‘äººå‘˜å¯ä»¥å®‰å…¨åœ°äº¤ä»˜ä»–ä»¬çš„è§†é¢‘å†…å®¹ï¼Œè€Œä¸ä¼šå½±å“å®‰å…¨æ€§ã€‚\nDASH æ˜¯æ›´çµæ´»ä¸”å¯äº’æ“ä½œçš„ HTTP æµåè®®ï¼Œé€‚åˆå¼€å‘äººå‘˜æ„å»ºå®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºã€‚å®ƒä¸å„ç§è®¾å¤‡ã€å¹³å°å’Œæµè§ˆå™¨çš„å…¼å®¹æ€§ï¼Œä»¥åŠä¸»è¦è¡Œä¸šå‚ä¸è€…çš„æ”¯æŒï¼Œä½¿å…¶æˆä¸ºå¯é çš„é€‰æ‹©ã€‚æ­¤å¤–ï¼Œå…¶ç¼–ç é€‰é¡¹çš„çµæ´»æ€§å’Œè‡ªé€‚åº”æ¯”ç‰¹ç‡æµåª’ä½“åŠŸèƒ½è¿›ä¸€æ­¥å¢å¼ºäº†æœ€ç»ˆç”¨æˆ·çš„æµåª’ä½“ä½“éªŒã€‚\nHTTP æµåª’ä½“ä¸ HTTP ç›´æ’­æµåª’ä½“ åœ¨æ¯”è¾ƒ HTTP Streaming å’Œ HTTP Live Streaming (HLS) æ—¶ï¼Œå¼€å‘äººå‘˜éœ€è¦å‡ ä¸ªå…³é”®å› ç´ æ¥æ„å»ºå®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºã€‚\né¦–å…ˆï¼ŒHTTP Streaming æ˜¯æ¯” HLS æ›´çµæ´»ã€å¯æ‰©å±•çš„åè®®ã€‚è™½ç„¶ HLS åœ¨ Apple è®¾å¤‡å’Œæµè§ˆå™¨ä¸Šå¾—åˆ°å¹¿æ³›æ”¯æŒï¼Œä½†å…¶åœ¨å…¶ä»–å¹³å°ä¸Šçš„ä½¿ç”¨å¯èƒ½ä¼šå—åˆ°é™åˆ¶ã€‚è¿™å¯èƒ½ä¼šç»™æƒ³è¦ç¡®ä¿å…¶è§†é¢‘å†…å®¹è¦†ç›–æ›´å¹¿æ³›å—ä¼—çš„å¼€å‘è€…å¸¦æ¥æŒ‘æˆ˜ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒHTTP Streaming ä¸è®¸å¤šè®¾å¤‡ã€å¹³å°å’Œæµè§ˆå™¨å…¼å®¹ï¼Œä½¿å…¶æˆä¸ºå¼€å‘äººå‘˜æ›´å¯é çš„é€‰æ‹©ã€‚\nå…¶æ¬¡ï¼ŒHTTP Streaming åœ¨ç¼–ç é€‰é¡¹æ–¹é¢æä¾›äº†æ›´å¤§çš„çµæ´»æ€§ã€‚å®ƒæ”¯æŒå„ç§è§†é¢‘ç¼–è§£ç å™¨å’Œæ ¼å¼ï¼Œå…è®¸å¼€å‘äººå‘˜ä¸ºå…¶ç‰¹å®šç”¨ä¾‹é€‰æ‹©æœ€æœ‰æ•ˆã€æœ€åˆé€‚çš„é€‰é¡¹ã€‚è¿™ç§çµæ´»æ€§ä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿä¼˜åŒ–è§†é¢‘è´¨é‡å’Œæ–‡ä»¶å¤§å°ï¼Œä»è€Œå¢å¼ºæœ€ç»ˆç”¨æˆ·çš„æµåª’ä½“ä½“éªŒã€‚\næ­¤å¤–ï¼ŒHTTP Streaming çš„è‡ªé€‚åº”æ¯”ç‰¹ç‡æµåŠŸèƒ½å¯¹äºå®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºè‡³å…³é‡è¦ã€‚å®ƒæ ¹æ®è§‚çœ‹è€…çš„äº’è”ç½‘è¿æ¥å®æ—¶è°ƒæ•´è§†é¢‘è´¨é‡ï¼Œå³ä½¿åœ¨ä¸åŒçš„ç½‘ç»œé€Ÿåº¦ä¸‹ä¹Ÿèƒ½ç¡®ä¿æµç•…çš„æµåª’ä½“ä½“éªŒã€‚æ­¤åŠŸèƒ½å¯¹äºç”¨æˆ·ä¹‹é—´ä¸é—´æ–­çš„é€šä¿¡è‡³å…³é‡è¦ã€‚\nHTTP Streamingï¼ˆç‰¹åˆ«æ˜¯ DASHï¼‰çš„å¦ä¸€ä¸ªä¼˜åŠ¿æ˜¯å®ƒå¯¹æ•°å­—ç‰ˆæƒç®¡ç† (DRM) å’Œå†…å®¹ä¿æŠ¤çš„å¤„ç†ã€‚ DASH æ”¯æŒå„ç§ DRM ç³»ç»Ÿï¼Œä¾‹å¦‚ Microsoft PlayReady å’Œ Google Widevineï¼Œè¿™å¯¹äºä¿æŠ¤å—ç‰ˆæƒä¿æŠ¤çš„å†…å®¹å…é­æœªç»æˆæƒçš„è®¿é—®è‡³å…³é‡è¦ã€‚è¿™ç¡®ä¿äº†å¼€å‘äººå‘˜å¯ä»¥å®‰å…¨åœ°äº¤ä»˜è§†é¢‘å†…å®¹ï¼Œè€Œä¸ä¼šå½±å“ç‰ˆæƒä¿æŠ¤ã€‚\nç›¸æ¯”ä¹‹ä¸‹ï¼ŒHLS å¯¹ DRM å’Œå†…å®¹ä¿æŠ¤çš„æ”¯æŒæœ‰é™ã€‚è™½ç„¶å®ƒç¡®å®æä¾›äº†åŸºæœ¬çš„åŠ å¯†é€‰é¡¹ï¼Œä½†å¯¹äºéœ€è¦å¼ºå¤§å†…å®¹ä¿æŠ¤æªæ–½çš„åº”ç”¨ç¨‹åºæ¥è¯´å¯èƒ½è¿˜ä¸å¤Ÿã€‚å¯¹äºéœ€è¦ç¡®ä¿è§†é¢‘å†…å®¹çš„å®‰å…¨æ€§å’Œå®Œæ•´æ€§çš„å¼€å‘äººå‘˜æ¥è¯´ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªé‡å¤§ç¼ºç‚¹ã€‚\næ­¤å¤–ï¼ŒHTTP Streaming ä¸ºå®æ—¶æµå’Œä½å»¶è¿Ÿåº”ç”¨ç¨‹åºæä¾›äº†æ›´å¥½çš„æ”¯æŒã€‚å®ƒå¯ä»¥æ›´å¿«åœ°äº¤ä»˜è§†é¢‘å†…å®¹ï¼Œå‡å°‘ç¼“å†²å’Œå»¶è¿Ÿé—®é¢˜ã€‚è¿™å¯¹äºå®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºå°¤å…¶é‡è¦ï¼Œå› ä¸ºè§†é¢‘ä¼ è¾“çš„å»¶è¿Ÿå¯èƒ½ä¼šå½±å“ç”¨æˆ·ä½“éªŒå’Œé€šä¿¡æ•ˆç‡ã€‚\nå‡ºäºå¤šç§åŸå› ï¼Œå¼€å‘äººå‘˜åœ¨æ„å»ºå®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºæ—¶åº”è€ƒè™‘ä½¿ç”¨åŸºäº HLS çš„ HTTP æµã€‚ HTTP Streaming æä¾›äº†æ›´å¤§çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€ä¸å„ç§è®¾å¤‡å’Œå¹³å°çš„å…¼å®¹æ€§ä»¥åŠå¯¹å„ç§ç¼–ç é€‰é¡¹çš„æ”¯æŒã€‚å…¶è‡ªé€‚åº”æ¯”ç‰¹ç‡æµåª’ä½“åŠŸèƒ½å¯ç¡®ä¿ç”¨æˆ·è·å¾—æ— ç¼çš„æµåª’ä½“ä½“éªŒï¼Œæ— è®ºå…¶ç½‘ç»œè¿æ¥å¦‚ä½•ã€‚æ­¤å¤–ï¼ŒHTTP Streaming å¼ºå¤§çš„ DRM å’Œå†…å®¹ä¿æŠ¤åŠŸèƒ½ä¸ºä¿æŠ¤å—ç‰ˆæƒä¿æŠ¤çš„å†…å®¹æä¾›äº†å¿…è¦çš„å®‰å…¨æªæ–½ã€‚\né€šè¿‡é€‰æ‹© HTTP Streaming ä½œä¸ºå®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºçš„æµåè®®ï¼Œå¼€å‘äººå‘˜å¯ä»¥ç¡®ä¿ä¸ºé«˜è´¨é‡è§†é¢‘å†…å®¹æä¾›å¯é ã€å¯æ‰©å±•ä¸”å®‰å…¨çš„å¹³å°ã€‚\nHTTP æµçš„ç”¨ä¾‹æœ‰å“ªäº›ï¼Ÿ HTTP æµæœ‰è®¸å¤šç”¨ä¾‹ï¼Œç‰¹åˆ«æ˜¯åœ¨å®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºä¸­ã€‚ä»¥ä¸‹æ˜¯ HTTP æµçš„ä¸€äº›å…·ä½“ç”¨ä¾‹ï¼š\nè§†é¢‘æµæœåŠ¡ï¼šHTTP æµé€šå¸¸ç”¨äº Netflixã€YouTube å’Œ Amazon Prime Video ç­‰è®¢é˜…æµåª’ä½“å¹³å°ã€‚å®ƒå…è®¸è·¨ä¸åŒè®¾å¤‡å’Œå¹³å°å‘ç”¨æˆ·æ— ç¼äº¤ä»˜é«˜è´¨é‡è§†é¢‘å†…å®¹ã€‚ å®æ—¶æµåª’ä½“ï¼šHTTP æµåª’ä½“å¹¿æ³›ç”¨äºå®æ—¶æµåª’ä½“æ´»åŠ¨ï¼ŒåŒ…æ‹¬ä½“è‚²æ¯”èµ›ã€éŸ³ä¹ä¼šå’Œä¼šè®®ã€‚å®ƒèƒ½å¤Ÿå‘å¤§é‡è§‚ä¼—å¹¿æ’­å®æ—¶è§†é¢‘å†…å®¹ï¼Œç¡®ä¿æµç•…æ’­æ”¾å’Œæœ€å°ç¼“å†²ã€‚ è§†é¢‘ä¼šè®®ï¼šHTTP æµå¯¹äºè§†é¢‘ä¼šè®®åº”ç”¨ç¨‹åºè‡³å…³é‡è¦ï¼Œå…¶ä¸­å®æ—¶é€šä¿¡å’Œåä½œè‡³å…³é‡è¦ã€‚å®ƒå¯ç¡®ä¿æµç•…çš„è§†é¢‘æ’­æ”¾å’Œä½å»¶è¿Ÿæµä¼ è¾“ï¼Œä½¿å‚ä¸è€…èƒ½å¤Ÿè¿›è¡Œæ¸…æ™°ã€ä¸é—´æ–­çš„è§†é¢‘é€šè¯ã€‚ æ¸¸æˆï¼šHTTP æµè¶Šæ¥è¶Šå¤šåœ°ç”¨äºäº‘æ¸¸æˆå¹³å°ï¼Œæ¸¸æˆé€šè¿‡äº’è”ç½‘ç›´æ¥æµå¼ä¼ è¾“åˆ°ç”¨æˆ·çš„è®¾å¤‡ã€‚å®ƒå…è®¸æ¸¸æˆç©å®¶ç©é«˜è´¨é‡çš„æ¸¸æˆï¼Œè€Œæ— éœ€å¼ºå¤§çš„ç¡¬ä»¶ï¼Œå› ä¸ºå¤„ç†æ˜¯åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šå®Œæˆçš„ã€‚ ç”µå­å­¦ä¹ ï¼šHTTP æµç”¨äºæä¾›åœ¨çº¿è¯¾ç¨‹å’Œæ•™è‚²è§†é¢‘çš„ç”µå­å­¦ä¹ å¹³å°ã€‚å®ƒä½¿å­¦ç”Ÿèƒ½å¤Ÿæ— ç¼åœ°ä¼ è¾“æ•™è‚²å†…å®¹ï¼Œæ— è®ºä½ç½®æˆ–è®¾å¤‡å¦‚ä½•ã€‚ ç¤¾äº¤åª’ä½“ï¼š Twitchã€LinkedInã€Facebookã€Instagram å’Œ Snapchat ç­‰ç¤¾äº¤åª’ä½“å¹³å°é‡‡ç”¨ HTTP æµè¿›è¡Œå®æ—¶è§†é¢‘æµå’Œå…±äº«ã€‚å®ƒå…è®¸ç”¨æˆ·å‘å…¶å…³æ³¨è€…æ’­æ”¾å®æ—¶è§†é¢‘ï¼Œå¹¶ä¿ƒè¿›ç”¨æˆ·ä¹‹é—´çš„å®æ—¶äº’åŠ¨å’Œå‚ä¸ã€‚ HTTP æµå¼ä¼ è¾“çš„å®‰å…¨æ€§å¦‚ä½•ï¼Ÿ HTTP æµåª’ä½“åè®®ï¼Œä¾‹å¦‚ HLSï¼ˆHTTP å®æ—¶æµåª’ä½“ï¼‰å’Œ DASHï¼ˆHTTP ä¸Šçš„åŠ¨æ€è‡ªé€‚åº”æµåª’ä½“ï¼‰ï¼Œä¸ºåœ¨çº¿æµåª’ä½“å†…å®¹æä¾›å®‰å…¨æ€§ã€‚ç„¶è€Œï¼Œå¿…é¡»äº†è§£çš„æ˜¯ï¼Œè™½ç„¶ HTTP æµåè®®æ”¯æŒ HTTPS ç­‰å®‰å…¨ä¼ è¾“æœºåˆ¶ï¼Œä½†æ•´ä½“å®‰å…¨æ€§å–å†³äºå„ç§å› ç´ å’Œè€ƒè™‘å› ç´ ã€‚\nå†…å®¹ä¿æŠ¤ï¼šHTTP æµåè®®æœ¬èº«å¹¶ä¸æä¾›å†…å®¹ä¿æŠ¤æœºåˆ¶ã€‚å¼€å‘äººå‘˜å¿…é¡»å®æ–½å…¶ä»–æªæ–½ï¼Œä¾‹å¦‚ DRMï¼ˆæ•°å­—ç‰ˆæƒç®¡ç†ï¼‰ç³»ç»Ÿæˆ–åŠ å¯†æŠ€æœ¯æ¥ä¿æŠ¤æµåª’ä½“å†…å®¹ã€‚è¿™äº›æªæ–½ç¡®ä¿æœªç»æˆæƒçš„ç”¨æˆ·æ— æ³•è®¿é—®æˆ–å¤åˆ¶æµåª’ä½“å†…å®¹ã€‚ ä¼ è¾“å®‰å…¨ï¼šHTTP æµåè®®å¯ä»¥åˆ©ç”¨ HTTPS ç­‰å®‰å…¨ä¼ è¾“æœºåˆ¶æ¥åŠ å¯†æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯é€šä¿¡ã€‚è¿™ç§åŠ å¯†æœ‰åŠ©äºä¿æŠ¤æµå†…å®¹çš„å®Œæ•´æ€§å’Œæœºå¯†æ€§ï¼Œé˜²æ­¢æœªç»æˆæƒçš„æ‹¦æˆªæˆ–ç¯¡æ”¹ã€‚ èº«ä»½éªŒè¯å’Œæˆæƒï¼šHTTP æµåª’ä½“åè®®å¯ä»¥ä¸èº«ä»½éªŒè¯å’Œæˆæƒç³»ç»Ÿé›†æˆï¼Œä»¥ç¡®ä¿åªæœ‰æˆæƒç”¨æˆ·æ‰èƒ½è®¿é—®æµåª’ä½“å†…å®¹ã€‚è¿™å¯èƒ½æ¶‰åŠç”¨æˆ·èº«ä»½éªŒè¯ã€è®¿é—®æ§åˆ¶ç­–ç•¥å’Œç”¨äºè°ƒèŠ‚è®¿é—®æƒé™çš„ç”¨æˆ·ç®¡ç†ç³»ç»Ÿã€‚ æœåŠ¡å™¨ç«¯å®‰å…¨æ€§ï¼šæ‰˜ç®¡æµåª’ä½“å†…å®¹çš„æœåŠ¡å™¨åŸºç¡€è®¾æ–½çš„å®‰å…¨æ€§è‡³å…³é‡è¦ã€‚å¼€å‘äººå‘˜éœ€è¦å®æ–½æœåŠ¡å™¨å®‰å…¨çš„æœ€ä½³å®è·µï¼ŒåŒ…æ‹¬å®šæœŸæ›´æ–°å’Œè¡¥ä¸ã€å®‰å…¨é…ç½®ä»¥åŠç›‘æ§æ½œåœ¨æ¼æ´ã€‚ ç½‘ç»œå®‰å…¨ï¼šè™½ç„¶ HTTP æµåª’ä½“åè®®æä¾›å®‰å…¨ä¼ è¾“æœºåˆ¶ï¼Œä½†æµåª’ä½“ç³»ç»Ÿçš„æ•´ä½“å®‰å…¨æ€§å¯èƒ½ä¼šå—åˆ°æ½œåœ¨ç½‘ç»œæ¼æ´çš„å½±å“ã€‚å¼€å‘äººå‘˜åº”è€ƒè™‘å®æ–½é¢å¤–çš„å®‰å…¨æªæ–½ï¼Œä¾‹å¦‚é˜²ç«å¢™ã€å…¥ä¾µæ£€æµ‹ç³»ç»Ÿå’Œç½‘ç»œåˆ†æ®µï¼Œä»¥é˜²æ­¢æœªç»æˆæƒçš„è®¿é—®å’Œæ”»å‡»ã€‚ æ•°æ®éšç§ï¼šHTTP æµåè®®æœ¬èº«å¹¶ä¸æä¾›æ•°æ®éšç§åŠŸèƒ½ã€‚å¼€å‘è€…éœ€è¦å®æ–½é€‚å½“çš„æ•°æ®éšç§æªæ–½ï¼Œä¾‹å¦‚åŠ å¯†ï¼Œä»¥ä¿æŠ¤æµåª’ä½“è¿‡ç¨‹ä¸­ä¼ è¾“çš„ä¸ªäººä¿¡æ¯å’Œæ•æ„Ÿä¿¡æ¯ã€‚ åˆè§„æ€§ï¼šæ ¹æ®æµå¼ä¼ è¾“çš„å†…å®¹ï¼Œå¼€å‘äººå‘˜å¯èƒ½éœ€è¦éµå®ˆè¡Œä¸šç‰¹å®šçš„æ³•è§„å’Œæ ‡å‡†ï¼Œä¾‹å¦‚GDPRï¼ˆé€šç”¨æ•°æ®ä¿æŠ¤æ³•è§„ï¼‰æˆ–HIPAAï¼ˆå¥åº·ä¿é™©æµé€šä¸è´£ä»»æ³•æ¡ˆï¼‰ã€‚éµå®ˆè¿™äº›æ³•è§„éœ€è¦é¢å¤–çš„å®‰å…¨æªæ–½å’Œä¿éšœæªæ–½æ¥ä¿æŠ¤ç”¨æˆ·æ•°æ®ã€‚ å“ªäº›è¡Œä¸šå¯ä»¥ä½¿ç”¨HTTPæµï¼Ÿ HTTP æµå¯ç”¨äºä¾èµ–å®æ—¶é€šä¿¡å’Œå†…å®¹äº¤ä»˜çš„å„ç§è¡Œä¸šã€‚ä¸€äº›å¯ä»¥ä» HTTP æµä¸­å—ç›Šçš„è¡Œä¸šåŒ…æ‹¬ï¼š\nåª’ä½“å’Œå¨±ä¹ï¼šHTTP æµé€šå¸¸ç”¨äºç›´æ’­æµåª’ä½“å¹³å°å’Œåœ¨çº¿éŸ³é¢‘å†…å®¹ã€‚è¿™åŒ…æ‹¬æµåª’ä½“æœåŠ¡ã€åœ¨çº¿æ¸¸æˆå¹³å°å’Œç°åœºä½“è‚²èµ›äº‹ã€‚ ç”µå­å•†åŠ¡ï¼šåœ¨çº¿é›¶å”®å•†å¯ä»¥ä½¿ç”¨ HTTP æµæ¥å±•ç¤ºäº§å“è§†é¢‘å¹¶æä¾›äº¤äº’å¼è´­ç‰©ä½“éªŒã€‚è¿™ä½¿å®¢æˆ·èƒ½å¤Ÿè§‚çœ‹äº§å“æ¼”ç¤ºå¹¶åšå‡ºæ˜æ™ºçš„è´­ä¹°å†³å®šã€‚ æ•™è‚²å’Œç”µå­å­¦ä¹ ï¼šæ•™è‚²æœºæ„å’Œç”µå­å­¦ä¹ å¹³å°å¯ä»¥åˆ©ç”¨ HTTP æµæ¥æä¾›å®æ—¶è®²åº§ã€ç½‘ç»œç ”è®¨ä¼šå’Œç‚¹æ’­æ•™è‚²å†…å®¹ã€‚è¿™ä½¿å¾—å­¦ç”Ÿå’Œå­¦ä¹ è€…èƒ½å¤Ÿå®æ—¶æˆ–åœ¨æ–¹ä¾¿æ—¶è®¿é—®æ•™è‚²ææ–™ã€‚ åŒ»ç–—ä¿å¥ï¼šHTTP æµå¯ç”¨äºè¿œç¨‹åŒ»ç–—åº”ç”¨ç¨‹åºï¼Œä½¿æä¾›å•†èƒ½å¤Ÿæä¾›è¿œç¨‹å’¨è¯¢ã€è§†é¢‘ä¼šè®®å’ŒåŒ»ç–—åŸ¹è®­è¯¾ç¨‹ã€‚å®ƒè¿˜å¯ç”¨äºæµå¼ä¼ è¾“æ‚£è€…æ•™è‚²è§†é¢‘å’ŒåŒ»ç–—å†…å®¹ã€‚ é“¶è¡Œå’Œé‡‘èï¼šé‡‘èæœºæ„å¯ä»¥é€šè¿‡ HTTP ä¼ è¾“å®æ—¶é‡‘èæ•°æ®ã€è‚¡ç¥¨å¸‚åœºæ›´æ–°å’Œåœ¨çº¿äº¤æ˜“å¹³å°ã€‚è¿™ç¡®ä¿å®¢æˆ·èƒ½å¤Ÿè®¿é—®æœ€æ–°ä¿¡æ¯å¹¶æ”¹å–„æ•´ä½“ç”¨æˆ·ä½“éªŒã€‚ æ¸¸æˆï¼šæ¸¸æˆè¡Œä¸šä¸¥é‡ä¾èµ– HTTP æµåª’ä½“è¿›è¡Œåœ¨çº¿å¤šäººæ¸¸æˆã€æ¸¸æˆæ›´æ–°ä»¥åŠæ¸¸æˆæµåª’ä½“æœåŠ¡çš„æµåª’ä½“å¹³å°ã€‚è¿™ä½¿å¾—æ¸¸æˆç©å®¶å¯ä»¥å®æ—¶ç©å’Œè®¿é—®æ¸¸æˆå†…å®¹ï¼Œè€Œæ— éœ€å¤§é‡ä¸‹è½½ã€‚ ç¤¾äº¤åª’ä½“ï¼šç¤¾äº¤åª’ä½“å¹³å°é€šå¸¸ä½¿ç”¨ HTTP æµä¸ºå…¶å†…å®¹åˆ›å»ºè€…æä¾›å®æ—¶è§†é¢‘å¹¿æ’­ã€å®æ—¶äº‹ä»¶å’Œå‘ç”¨æˆ·æä¾›å®æ—¶é€šçŸ¥ã€‚è¿™å¢å¼ºäº†ç”¨æˆ·ä½“éªŒå¹¶å…è®¸ç«‹å³äº¤äº’å’Œå‚ä¸ã€‚ Facebook Live å°±æ˜¯ä¸€ä¸ªç¤ºä¾‹å¹³å°ã€‚ é€šä¿¡å’Œåä½œï¼šHTTP æµå¯ç”¨äºé€šä¿¡å’Œåä½œå¹³å°ï¼Œä¾‹å¦‚æ¶ˆæ¯åº”ç”¨ç¨‹åºã€è§†é¢‘ä¼šè®®å·¥å…·å’Œæ–‡ä»¶å…±äº«æœåŠ¡ã€‚è¿™å¯ä»¥å®ç°å®æ—¶é€šä¿¡ã€æ–‡ä»¶æµå’Œåä½œå·¥ä½œç©ºé—´ã€‚ è¿è¾“å’Œç‰©æµï¼šHTTP æµå¯ç”¨äºè·Ÿè¸ªå’Œç›‘æ§è¿è¾“å’Œç‰©æµè¡Œä¸šçš„è½¦è¾†ã€è´§è¿å’Œåº“å­˜ã€‚è¿™å¯ä»¥å®ç°ç‰©æµæµç¨‹çš„é«˜æ•ˆç®¡ç†å’Œä¼˜åŒ–ã€‚ IoTï¼ˆç‰©è”ç½‘ï¼‰ï¼šHTTP æµå¯ç”¨äº IoT åº”ç”¨ç¨‹åºæ¥ä¼ è¾“å®æ—¶ä¼ æ„Ÿå™¨æ•°æ®ã€ç›‘è§†å’Œæ§åˆ¶ä¿¡å·ä»¥åŠè®¾å¤‡æ›´æ–°ã€‚è¿™ä½¿å¾—èƒ½å¤Ÿé›†æˆå„ç§è¡Œä¸šçš„ç‰©è”ç½‘è®¾å¤‡å’Œç³»ç»Ÿï¼Œä¾‹å¦‚æ™ºèƒ½å®¶å±…è‡ªåŠ¨åŒ–ã€å·¥ä¸šè‡ªåŠ¨åŒ–å’Œç¯å¢ƒç›‘æµ‹ã€‚ æ€»ä½“è€Œè¨€ï¼ŒHTTP æµå¼ä¼ è¾“å¯ä»¥ä½¿ä»»ä½•éœ€è¦å®æ—¶é€šä¿¡ã€å†…å®¹äº¤ä»˜å’Œæ•°æ®ä¼ è¾“çš„è¡Œä¸šå—ç›Šã€‚é€šè¿‡åˆ©ç”¨ HTTP æµï¼Œä¼ä¸šå¯ä»¥å¢å¼ºå…¶æœåŠ¡ã€æ”¹å–„ç”¨æˆ·ä½“éªŒå¹¶åœ¨å½“ä»Šçš„æ•°å­—ç¯å¢ƒä¸­ä¿æŒç«äº‰åŠ›ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2024/05/07/http-streaming/","summary":"åŸæ–‡é“¾æ¥ï¼šhttps://www.pubnub.com/guides/http-streaming/\nä»€ä¹ˆæ˜¯ HTTP æµå¼ä¼ è¾“ï¼Ÿ HTTP æµï¼Œä¹Ÿç§°ä¸ºåŸºäº HTTP çš„æµæˆ– HTTP å®æ—¶æµï¼Œæ˜¯ä¸€ç§ç”¨äºé€šè¿‡ Internet ä¼ é€å®æ—¶å¤šåª’ä½“å†…å®¹ï¼ˆä¾‹å¦‚éŸ³é¢‘æˆ–è§†é¢‘ï¼‰çš„æŠ€æœ¯ã€‚è¯¥åè®®å…è®¸ä»æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯è®¾å¤‡çš„è¿ç»­æ•°æ®ä¼ è¾“ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿæ¶ˆè´¹åª’ä½“å†…å®¹è€Œæ— éœ€å®Œæ•´çš„æ–‡ä»¶ä¸‹è½½ã€‚\nä¸ä¼ ç»Ÿçš„æ–‡ä»¶ä¸‹è½½æ–¹æ³•ä¸åŒï¼Œåœ¨å¼€å§‹æ’­æ”¾ä¹‹å‰éœ€è¦ä¸‹è½½æ•´ä¸ªæ–‡ä»¶ï¼ŒHTTP æµå…è®¸ç«‹å³æ’­æ”¾åª’ä½“å†…å®¹ã€‚å®ƒçš„å·¥ä½œåŸç†æ˜¯å°†åª’ä½“æ–‡ä»¶åˆ†æˆæ›´å°çš„ç‰‡æ®µæˆ–å—ï¼Œç„¶åå°†å…¶è¿ç»­ä¼ é€åˆ°å®¢æˆ·ç«¯è®¾å¤‡ã€‚\nHTTP æµåˆ©ç”¨è¶…æ–‡æœ¬ä¼ è¾“åè®® (HTTP)ä½œä¸ºå…¶é€šä¿¡åè®®ã€‚å®ƒåˆ©ç”¨ç°æœ‰çš„ Web åŸºç¡€è®¾æ–½å¹¶ä½¿ç”¨ HTTP æœåŠ¡å™¨çš„å¯æ‰©å±•æ€§ã€ç¼“å­˜å’Œè´Ÿè½½å¹³è¡¡åŠŸèƒ½ã€‚è¿™ä½¿å…¶æˆä¸ºå‘è®¸å¤šç”¨æˆ·æä¾›å®æ—¶å†…å®¹çš„é«˜æ•ˆä¸”çµæ´»çš„è§£å†³æ–¹æ¡ˆã€‚\nHTTP æµå¦‚ä½•å·¥ä½œï¼Ÿ ä»è¾ƒé«˜å±‚é¢æ¥çœ‹ï¼ŒHTTP æµå¼ä¼ è¾“çš„å·¥ä½œåŸç†æ˜¯å°†åª’ä½“æ–‡ä»¶åˆ†æˆå°å—å¹¶é€šè¿‡ HTTP è¿æ¥å°†å…¶ä¼ è¾“åˆ°å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯ï¼ˆé€šå¸¸æ˜¯ç½‘ç»œæµè§ˆå™¨æˆ–åª’ä½“æ’­æ”¾å™¨ï¼‰ä¸æ–­è¯·æ±‚å’Œæ¥æ”¶è¿™äº›å—ï¼Œä»è€Œå®ç°åª’ä½“çš„æ— ç¼æ’­æ”¾ã€‚\nHTTP æµå¼ä¼ è¾“æœ‰ä¸¤ç§ä¸»è¦æ–¹æ³•ï¼šæ¸è¿›å¼ä¸‹è½½å’Œè‡ªé€‚åº”æµå¼ä¼ è¾“ã€‚\n1.æ¸è¿›å¼ä¸‹è½½ï¼š\næ¸è¿›å¼ä¸‹è½½ç¼ºä¹è‡ªé€‚åº”æµåª’ä½“æä¾›çš„é€‚åº”æ€§ã€‚åœ¨å®¢æˆ·ç«¯å¼€å§‹æ’­æ”¾ä¹‹å‰ï¼Œä¼šé€šè¿‡æ¸è¿›å¼ä¸‹è½½æ¥ä¸‹è½½æ•´ä¸ªåª’ä½“æ–‡ä»¶ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœåœ¨ä¸‹è½½è¿‡ç¨‹ä¸­å‡ºç°ä»»ä½• Wi-Fi ç½‘ç»œä¸­æ–­æˆ–å¸¦å®½æ³¢åŠ¨ï¼Œç”¨æˆ·å¯èƒ½ä¼šé‡åˆ°æ’­æ”¾ç¼“å†²æˆ–å»¶è¿Ÿçš„æƒ…å†µã€‚è¿™å¯èƒ½ä¼šè®©ç”¨æˆ·æ„Ÿåˆ°æ²®ä¸§ï¼Œå¹¶å¯èƒ½å¯¼è‡´ç³Ÿç³•çš„ç”¨æˆ·ä½“éªŒã€‚\n2.[è‡ªé€‚åº”æµåª’ä½“](https://www.cloudflare.com/learning/video/what-is-adaptive-bitrate-streaming/#:~:text=Adaptive bitrate streaming adjusts video,%2C location%2C or Internet speed.)ï¼š\nè‡ªé€‚åº”æµåª’ä½“å¯¹äºå¼€å‘äººå‘˜æ„å»ºå®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºï¼ˆæä¾›è§†é¢‘æˆ–éŸ³é¢‘ç­‰åª’ä½“æ–‡ä»¶ï¼‰æ¥è¯´æ˜¯ä¸€é¡¹è‡³å…³é‡è¦çš„æŠ€æœ¯ã€‚å®ƒç¡®ä¿æ— è®ºç”¨æˆ·çš„ç½‘ç»œæ¡ä»¶å¦‚ä½•ï¼Œåª’ä½“å†…å®¹éƒ½å¯ä»¥æµç•…ã€é«˜æ•ˆåœ°ä¼ è¾“ã€‚è¿™åœ¨å½“ä»Šçš„æ•°å­—ç¯å¢ƒä¸­å°¤å…¶é‡è¦ï¼Œç”¨æˆ·æœŸæœ›é«˜è´¨é‡ã€ä¸é—´æ–­çš„åª’ä½“æ’­æ”¾ï¼Œä½†æœ‰æ—¶å…·æœ‰ä¸åŒçš„äº’è”ç½‘é€Ÿåº¦ã€‚\nè‡ªé€‚åº”æµå¼ä¼ è¾“é€šå¸¸æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š\nå†…å®¹ç¼–ç ï¼šåª’ä½“æ–‡ä»¶è¢«ç¼–ç ä¸ºå…·æœ‰ä¸åŒæ¯”ç‰¹ç‡å’Œè´¨é‡çº§åˆ«çš„å¤šç§å˜ä½“ã€‚è¿™äº›å˜åŒ–å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šã€‚ æ¸…å•æ–‡ä»¶ï¼šåˆ›å»ºä¸€ä¸ªæ¸…å•æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æœ‰å…³å¯ç”¨å˜ä½“åŠå…¶ç›¸åº” URL çš„ä¿¡æ¯ã€‚ åˆå§‹è¯·æ±‚ï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨è¯·æ±‚æ¸…å•æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æä¾›æœ‰å…³åª’ä½“æ–‡ä»¶çš„å¯ç”¨å˜ä½“çš„ä¿¡æ¯ã€‚ å˜ä½“é€‰æ‹©ï¼šå®¢æˆ·ç«¯æ ¹æ®ç½‘ç»œæ¡ä»¶å’Œè®¾å¤‡åŠŸèƒ½é€‰æ‹©æ‰€éœ€çš„å˜ä½“ã€‚ç„¶åå®ƒä»æœåŠ¡å™¨è¯·æ±‚ç›¸åº”çš„åª’ä½“å—ã€‚ å—ä¼ é€ï¼šæœåŠ¡å™¨é€šè¿‡ HTTP è¿æ¥å°†åˆ†å—åª’ä½“ä¼ é€åˆ°å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯ä¸æ–­è¯·æ±‚å¹¶æ¥æ”¶è¿™äº›å—ï¼Œå¹¶åœ¨å¿…è¦æ—¶è°ƒæ•´æ’­æ”¾è´¨é‡ã€‚ æ¯”ç‰¹ç‡é€‚åº”ï¼šåœ¨æ’­æ”¾æœŸé—´ï¼Œå®¢æˆ·ç«¯ç›‘è§†ç½‘ç»œçŠ¶å†µå¹¶æ ¹æ®å¯ç”¨å¸¦å®½åŠ¨æ€è°ƒæ•´æ‰€é€‰å˜ä½“ã€‚å¦‚æœç½‘ç»œå˜å¾—æ‹¥å¡ï¼Œå®ƒå¯èƒ½ä¼šåˆ‡æ¢åˆ°è¾ƒä½çš„æ¯”ç‰¹ç‡å˜ä½“ï¼Œæˆ–è€…å¦‚æœç½‘ç»œçŠ¶å†µæ”¹å–„ï¼Œå®ƒå¯èƒ½ä¼šåˆ‡æ¢åˆ°è¾ƒé«˜çš„æ¯”ç‰¹ç‡å˜ä½“ã€‚ æ— ç¼æ’­æ”¾ï¼šé€šè¿‡è¿ç»­æ¥æ”¶å’Œæ’­æ”¾åª’ä½“å—ï¼Œè‡ªé€‚åº”æµåª’ä½“æä¾›æ— ç¼æ’­æ”¾ä½“éªŒï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿåœ¨æ²¡æœ‰ä¸­æ–­æˆ–ç¼“å†²çš„æƒ…å†µä¸‹äº«å—å†…å®¹ã€‚ HTTP æµæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ HTTP æµå¼ä¼ è¾“ä¸ºæ„å»ºå®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºçš„å¼€å‘äººå‘˜æä¾›äº†å¤šç§å¥½å¤„ï¼š\nå®æ—¶æ•°æ®ä¼ é€ï¼šHTTPæµå¯ä»¥å®ç°æ•°æ®çš„å®æ—¶ä¼ é€ï¼Œå…è®¸ç”¨æˆ·å³æ—¶å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚è¿™ç¡®ä¿ç”¨æˆ·å¯ä»¥è¿›è¡Œå®æ—¶å¯¹è¯ï¼Œè€Œä¸ä¼šå‡ºç°ä»»ä½•æ˜æ˜¾çš„å»¶è¿Ÿã€‚ å¯æ‰©å±•æ€§ï¼šHTTP æµå…·æœ‰é«˜åº¦å¯æ‰©å±•æ€§ï¼Œèƒ½å¤Ÿå¤„ç†è®¸å¤šå¹¶å‘è¿æ¥å¹¶å‘å¤šä¸ªç”¨æˆ·å®æ—¶ä¼ é€æ¶ˆæ¯ã€‚è¿™å¯¹äºæ”¯æŒä¸æ–­å¢é•¿çš„ç”¨æˆ·ç¾¤å’Œå¤„ç†å¤§é‡æ¶ˆæ¯çš„åº”ç”¨ç¨‹åºè‡³å…³é‡è¦ã€‚ å‡å°‘ç½‘ç»œå¼€é”€ï¼šä½¿ç”¨ HTTP æµå¼ä¼ è¾“ï¼Œå½“æœ‰æ–°ä¿¡æ¯å¯ç”¨æ—¶ï¼Œä»…é€šè¿‡ç½‘ç»œå‘é€å¿…è¦çš„æ•°æ®ï¼Œä»è€Œå‡å°‘ç½‘ç»œå¼€é”€ã€‚è¿™ä¸è½®è¯¢ç­‰å…¶ä»–æ–¹æ³•å½¢æˆé²œæ˜å¯¹æ¯”ï¼Œå³ä½¿ä¸å­˜åœ¨æ–°æ•°æ®ï¼Œä¹Ÿä¼šä¸æ–­å‘å‡ºè¯·æ±‚ã€‚ é«˜æ•ˆçš„èµ„æºåˆ©ç”¨ï¼šHTTP æµå¯ä»¥æœ‰æ•ˆåœ°åˆ©ç”¨æœåŠ¡å™¨èµ„æºï¼Œå› ä¸ºå®ƒæ¶ˆé™¤äº†é¢‘ç¹çš„è½®è¯¢è¯·æ±‚ã€‚è¿™å¯ä»¥å‡å°‘æœåŠ¡å™¨è´Ÿè½½å¹¶æé«˜æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨å…·æœ‰è®¸å¤šæ´»è·ƒç”¨æˆ·çš„åº”ç”¨ç¨‹åºä¸­ã€‚ æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼šHTTP æµé€šè¿‡æä¾›å®æ—¶æ›´æ–°å’Œå³æ—¶æ¶ˆæ¯ä¼ é€’ï¼Œå¢å¼ºäº†èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºçš„ç”¨æˆ·ä½“éªŒã€‚ç”¨æˆ·å¯ä»¥è¿›è¡Œæ›´å…·äº’åŠ¨æ€§å’Œå¸å¼•åŠ›çš„å¯¹è¯ï¼Œè€Œä¸ä¼šå› å»¶è¿Ÿæˆ–é”™è¿‡æ¶ˆæ¯è€Œæ„Ÿåˆ°æ²®ä¸§ã€‚ å®‰å…¨æ€§ï¼šHTTP æµå¯ä»¥åˆ©ç”¨ HTTPS ç­‰ç°æœ‰å®‰å…¨æªæ–½æä¾›å®‰å…¨çš„é€šä¿¡é€šé“ã€‚è¿™å¯ç¡®ä¿æ•æ„Ÿçš„ç”¨æˆ·æ•°æ®å’Œå¯¹è¯å…å—æœªç»æˆæƒçš„è®¿é—®å’Œçªƒå¬ã€‚ ä½¿ç”¨ HTTP æµæœ‰å“ªäº›ç¼ºç‚¹ï¼Ÿ ä½¿ç”¨ HTTP æµè¿›è¡Œå®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºæœ‰å‡ ä¸ªç¼ºç‚¹ï¼š\nå»¶è¿Ÿï¼š HTTP æµåª’ä½“ä¾èµ–äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æŒç»­è¿æ¥ã€‚è¿™å¯èƒ½ä¼šå¼•å…¥å»¶è¿Ÿï¼Œå› ä¸ºæœåŠ¡å™¨éœ€è¦ç»´æŒå¼€æ”¾è¿æ¥å¹¶ä»¥å—çš„å½¢å¼å‘é€æ•°æ®ã€‚å› æ­¤ï¼Œå‘ç”¨æˆ·å‘é€å®æ—¶æ¶ˆæ¯å¯èƒ½ä¼šå‡ºç°å»¶è¿Ÿï¼Œä»è€Œå½±å“ç”¨æˆ·ä½“éªŒã€‚\nå¯æ‰©å±•æ€§ï¼š HTTP æµå¯¹äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ¥è¯´å¯èƒ½æ˜¯èµ„æºå¯†é›†å‹çš„ã€‚ç»´æŠ¤å¤§é‡æ‰“å¼€çš„è¿æ¥ä¼šç»™æœåŠ¡å™¨å¸¦æ¥å‹åŠ›å¹¶é™åˆ¶å…¶å¯æ‰©å±•æ€§ã€‚æ­¤å¤–ï¼Œå®¢æˆ·ç«¯éœ€è¦å¤„ç†ä¼ å…¥çš„æ•°æ®æµï¼Œè¿™ä¹Ÿå¯èƒ½å¯¹å…¶èµ„æºæå‡ºè¦æ±‚ã€‚\n**å…¼å®¹æ€§ï¼š**æ‰€æœ‰è®¾å¤‡æˆ–ç½‘ç»œå¯èƒ½ä¸æ”¯æŒ HTTP æµã€‚æŸäº›é˜²ç«å¢™æˆ–ä»£ç†å¯èƒ½ä¼šé˜»æ­¢æˆ–å¹²æ‰°æµè¿æ¥ï¼Œä»è€Œå¯¼è‡´é€šä¿¡é—®é¢˜ã€‚è¿™å¯èƒ½ä¼šå°†èŠå¤©åº”ç”¨ç¨‹åºçš„å¯ç”¨æ€§é™åˆ¶ä¸ºéƒ¨åˆ†ç”¨æˆ·ã€‚\n**å¯é æ€§ï¼š**ç”±äº HTTP æµåª’ä½“ä¾èµ–äºé•¿æœŸè¿æ¥ï¼Œå› æ­¤ä¸­æ–­æˆ–ç½‘ç»œæ•…éšœå¯èƒ½ä¼šç ´åæµåª’ä½“è¿‡ç¨‹ã€‚å¦‚æœè¿æ¥ä¸¢å¤±ï¼Œå®¢æˆ·ç«¯å¯èƒ½éœ€è¦é‡æ–°å»ºç«‹è¿æ¥ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±æˆ–é‡å¤ã€‚\nå®‰å…¨æ€§ï¼š HTTP æµæœ¬èº«å¹¶ä¸ä¸ºæ•°æ®ä¼ è¾“æä¾›åŠ å¯†æˆ–å®‰å…¨æªæ–½ã€‚å¦‚æœæ²¡æœ‰é¢å¤–çš„å®‰å…¨å±‚ï¼Œé€šè¿‡èŠå¤©åº”ç”¨ç¨‹åºäº¤æ¢çš„æ•æ„Ÿä¿¡æ¯å¯èƒ½å®¹æ˜“é­åˆ°çªƒå¬æˆ–æœªç»æˆæƒçš„è®¿é—®ã€‚\n**ç”µæ± æ¶ˆè€—ï¼š**è¿ç»­è¿æ¥å’Œæ•°æ®æµä¼šå¿«é€Ÿè€—å°½ç§»åŠ¨è®¾å¤‡çš„ç”µæ± ã€‚è¿™å¯èƒ½æ˜¯å®æ—¶èŠå¤©åº”ç”¨ç¨‹åºçš„ç”¨æˆ·æ‰€å…³å¿ƒçš„é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨é•¿æ—¶é—´ä½¿ç”¨è¿™äº›åº”ç”¨ç¨‹åºæ—¶ã€‚\nå¼€å‘äººå‘˜åœ¨é€‰æ‹©å®æ—¶èŠå¤©å’Œæ¶ˆæ¯åº”ç”¨ç¨‹åºæŠ€æœ¯æ—¶éœ€è¦è€ƒè™‘è¿™äº›ç¼ºç‚¹ã€‚è™½ç„¶ HTTP æµæä¾›äº†ä¸€äº›å¥½å¤„ï¼Œä¾‹å¦‚åˆ©ç”¨ç°æœ‰çš„å®‰å…¨æªæ–½ï¼Œä½†å¼€å‘äººå‘˜åº”è¯¥æƒè¡¡è¿™äº›ä¼˜ç‚¹ä¸æ½œåœ¨çš„ç¼ºç‚¹ï¼Œå¹¶è¯„ä¼°å®ƒä»¬æ˜¯å¦ç¬¦åˆå…¶ç‰¹å®šçš„ç”¨ä¾‹å’Œè¦æ±‚ã€‚\nHTTP æµå¼ä¼ è¾“æœ‰å“ªäº›æ›¿ä»£æ–¹æ¡ˆï¼Ÿ HTTP æµçš„ä¸€äº›æ›¿ä»£æ–¹æ¡ˆåŒ…æ‹¬ï¼š","title":"[è¯‘]ä»€ä¹ˆæ˜¯HTTPæµå¼ä¼ è¾“ï¼Ÿ"},{"content":"åŸæ–‡é“¾æ¥ï¼šhttps://www.pubnub.com/guides/socket-io/\nä»€ä¹ˆæ˜¯Socket.IOï¼Ÿ Socket.IOæ˜¯ä¸€ä¸ªå¼€æºçš„è·¨å¹³å°åº“ï¼Œå®ƒæä¾›å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´åŸºäºäº‹ä»¶çš„å…¨åŒå·¥åŒå‘é€šä¿¡ã€‚å®ƒåŸºäº WebSocket åè®®æ„å»ºï¼Œæä¾›é™„åŠ åŠŸèƒ½ï¼Œä¾‹å¦‚è‡ªåŠ¨é‡æ–°è¿æ¥ä»¥åŠåœ¨æ— æ³•ä½¿ç”¨ WebSocketæ—¶å›é€€åˆ°HTTP é•¿è½®è¯¢ã€‚\nSocket.IO å®¢æˆ·ç«¯ç”±å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯åº“ç»„æˆã€‚è™½ç„¶æœ€åˆåœ¨æœåŠ¡å™¨ä¸Šæ”¯æŒNodeJS ï¼Œåœ¨å®¢æˆ·ç«¯æ”¯æŒJavaScriptï¼Œä½†ç°åœ¨å®ƒæ”¯æŒå„ç§æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æŠ€æœ¯ï¼ŒåŒ…æ‹¬Javaã€Pythonã€Swiftå’ŒKotlinï¼Œå®ƒä»¬éƒ½æ˜¯å®˜æ–¹ä»£ç åº“çš„ä¸€éƒ¨åˆ†ï¼Œç”±æ´»è·ƒç¤¾åŒºè´¡çŒ®ã€‚\nSocket.io æœ‰ä½•ç”¨é€”ï¼Ÿ Socket.IO å…è®¸æ‚¨å®ç°ä¾èµ–äºæ¶ˆæ¯äº¤æ¢çš„å„ç§åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚å³æ—¶æ¶ˆæ¯ä¼ é€’ã€å¤šç”¨æˆ·åä½œã€å®æ—¶åˆ†æã€æ–‡ä»¶å…±äº«å’Œé€šçŸ¥ã€‚\nSocket.io é€‚åˆå®æ—¶åº”ç”¨ç¨‹åºå—ï¼Ÿ æ˜¯çš„ï¼ŒSocket.IO æ˜¯æ„å»ºå®æ—¶ Web åº”ç”¨ç¨‹åºçš„ä¸é”™é€‰æ‹©ï¼Œå› ä¸ºå®ƒæä¾›äº†è®¸å¤šå¯¹å¼€å‘äººå‘˜æœ‰ç”¨çš„å¼€ç®±å³ç”¨åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š\næˆ¿é—´å’Œå‘½åç©ºé—´æ”¯æŒå…è®¸æ‚¨å°†å®¢æˆ·ç«¯åˆ†ç»„åˆ°å¯ä»¥æ¥æ”¶å¹¿æ’­æˆ–å¤šæ’­æ¶ˆæ¯çš„æˆ¿é—´ä¸­ã€‚ è‡ªåŠ¨é‡è¿æ„å‘³ç€æ‚¨æ— éœ€æ‹…å¿ƒå®¢æˆ·ç«¯ä¸Šçº¿æˆ–ç¦»çº¿ã€‚ äºŒè¿›åˆ¶æ•°æ®æ”¯æŒï¼Œä½¿æ‚¨ä¸ä»…å¯ä»¥äº¤æ¢èŠå¤©æ¶ˆæ¯ï¼Œè¿˜å¯ä»¥äº¤æ¢å›¾åƒæˆ–å…¶ä»–åª’ä½“ã€‚ Socket.io æ˜¯ API å—ï¼Ÿ Socket.IOä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„APIã€‚å®ƒæ˜¯ä¸€ä¸ªåº“æˆ–æ¡†æ¶ï¼ŒæŠ½è±¡äº†åº•å±‚ä¼ è¾“æœºåˆ¶ï¼Œå¹¶æä¾›äº†ä¸€ç»„ç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´æ„å»ºå®æ—¶åŒå‘é€šä¿¡çš„å·¥å…·å’Œå®ç”¨ç¨‹åºã€‚\nSocket.IO åŒ…å«å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶éƒ½å…¬å¼€å…¶ APIã€‚\nSocket.ioæ˜¯TCPè¿˜æ˜¯UDPï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ Socket.IOå¯ä»¥ä½¿ç”¨TCPå’ŒUDPä½œä¸ºåº•å±‚ä¼ è¾“åè®®ï¼Œä½†å®ƒä¸»è¦ä½¿ç”¨TCPã€‚\nTCPï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼‰æ˜¯ä¸€ç§å¯é çš„ã€é¢å‘è¿æ¥çš„åè®®ï¼Œå¯ç¡®ä¿æ•°æ®æŒ‰é¡ºåºä¸”æ— é”™è¯¯åœ°ä¼ é€ã€‚\nå¦ä¸€æ–¹é¢ï¼ŒUDPï¼ˆç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼‰æ˜¯ä¸€ç§æ— è¿æ¥ã€ä¸å¯é çš„åè®®ï¼Œå®ƒå‘é€æ•°æ®æ—¶ä¸æ£€æŸ¥æ•°æ®æ˜¯å¦å·²æˆåŠŸæ¥æ”¶ã€‚\nUDP æ¯” TCP æ›´è½»é‡çº§ï¼Œå› ä¸ºåªæœ‰åè€…åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹è¿æ¥ï¼Œä½†å®ƒåªèƒ½ç”±èƒ½å¤ŸæŠµå¾¡ä¸¢å¤±æ¶ˆæ¯çš„åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚\nSocket.io ä¸ Web Sockets è™½ç„¶ Socket.IO æ˜ç¡®ä¸æ˜¯WebSocketå®ç°ï¼Œä½†æœ‰ä¸€äº›ç›¸ä¼¼ä¹‹å¤„ã€‚ä¸¤è€…éƒ½æ˜¯åŸºäºäº‹ä»¶çš„ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥â€œä¾¦å¬â€è¿æ¥ã€æ–­å¼€è¿æ¥æˆ– new_message ç­‰äº‹ä»¶ï¼Œå¹¶ä¸”éƒ½å…è®¸æ‚¨å‘é€JSON å¯¹è±¡ç­‰ç»“æ„åŒ–æ•°æ®ã€‚\næ‚¨å¯ä»¥å°† Socket.IO è§†ä¸ºåº•å±‚ä¼ è¾“åè®®ä¹‹ä¸Šçš„æŠ½è±¡å±‚ã€‚é™¤äº†åº•å±‚é€šä¿¡å±‚ä¹‹å¤–ï¼Œè¯¥åº“è¿˜å®ç°äº†å…¶ä»–åŠŸèƒ½ï¼Œä¾‹å¦‚è‡ªåŠ¨é‡æ–°è¿æ¥ã€æ•°æ®åŒ…ç¼“å†²å’Œæ¶ˆæ¯ç¡®è®¤ï¼Œä»¥åŠåœ¨ WebSocket ä¸å¯ç”¨æ—¶å›é€€åˆ° HTTP é•¿è½®è¯¢ï¼Œä»è€Œå¢åŠ äº†é²æ£’æ€§ã€‚\nSocket.io ç¤ºä¾‹ï¼šå®¢æˆ·ç«¯/æœåŠ¡å™¨ JavaScript ä¸­ Socket.IO çš„ Hello World å®¢æˆ·ç«¯/æœåŠ¡å™¨å®ç°å°†ç¼–å†™å¦‚ä¸‹ï¼Œæ‘˜è‡ª4.x Socket.IO æ–‡æ¡£ï¼š\nSocket.io æœåŠ¡å™¨ç¤ºä¾‹ï¼š\nSocket.io å®¢æˆ·ç«¯ç¤ºä¾‹ï¼š\nSocket.IO æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ è¯¥åº“æ”¯æŒä¸¤ç§ä¼ è¾“æ–¹æ³•ï¼šHTTP é•¿è½®è¯¢å’Œ WebSocketsã€‚é¦–å…ˆå»ºç«‹ HTTP é•¿è½®è¯¢è¿æ¥ï¼Œç„¶ååœ¨å¯èƒ½çš„æƒ…å†µä¸‹å‡çº§ä¸º WebSocket è¿æ¥ã€‚ WebSocket ä¸èƒ½åœ¨ä»»ä½•åœ°æ–¹è¿è¡Œï¼Œä¾‹å¦‚ï¼Œå®ƒä»¬è¢«è®¸å¤šå…¬å¸ä»£ç†å’Œé˜²ç«å¢™é˜»æ­¢ï¼Œå› æ­¤é¦–å…ˆå‘èµ· HTTP é•¿è½®è¯¢ï¼Œå› ä¸ºå®ƒæ›´æœ‰å¯èƒ½æˆåŠŸã€‚ HTTP é•¿è½®è¯¢è¿æ¥å»ºç«‹åï¼Œä¼šåœ¨å¯¹æœ€ç»ˆç”¨æˆ·å®Œå…¨é€æ˜çš„è¿‡ç¨‹ä¸­â€œå‡çº§â€ä¸º WebSocket è¿æ¥ã€‚\nSocket.IOçš„æ¶æ„æ˜¯æ€æ ·çš„ï¼Ÿ Socket.IO ç”±ä¸¤ä¸ªä¸åŒçš„å±‚ç»„æˆï¼Œåˆ†åˆ«å­˜åœ¨äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸Šï¼š\nåº•å±‚ç®¡é“ç”±ä¸€ä¸ªåä¸ºEngine.IOçš„å•ç‹¬åº“æä¾› Socket.IO æä¾›çš„é«˜çº§ API ä½œä¸ºå¼€å‘äººå‘˜æˆ–ç”¨æˆ·ï¼Œæ‚¨é€šå¸¸ä¸ä¼šç›´æ¥ä¸ Engine.IO äº¤äº’ï¼Œä½†å®ƒåœ¨å¹•åè¿è¡Œä»¥å»ºç«‹è¿æ¥ã€åå•†ä¼ è¾“æœºåˆ¶å¹¶æ£€æµ‹ä»»ä½•æ–­å¼€è¿æ¥ã€‚å°† Engine.IO ä¸ WebSocket è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œä¸¤è€…åœ¨åŠŸèƒ½ä¸Šéå¸¸ç›¸ä¼¼ï¼Œåªæ˜¯ Engine.IO æä¾›äº†ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œå…è®¸æ‚¨ä» HTTP é•¿è½®è¯¢è¿æ¥è¿ç§»ï¼Œè€Œä¸ä¼šï¼ˆè‡³å…³é‡è¦ï¼‰ä¸¢å¤±ä»»ä½•æ¶ˆæ¯ã€‚\né«˜çº§ Socket.IO APIåœ¨Engine.IO æä¾›çš„åŸºæœ¬è¿æ¥ä¹‹ä¸Šæ·»åŠ äº†ä¸€äº›å€¼å¾—æ³¨æ„çš„åŠŸèƒ½ï¼š\nç¼“å†²äº‹ä»¶å…è®¸æ‚¨åœ¨æœªè¿æ¥æ—¶å‘é€äº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶å°†åœ¨å®¢æˆ·ç«¯é‡æ–°è¿æ¥æ—¶ä¼ é€’ã€‚å¦‚æœå®¢æˆ·ç«¯éœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½é‡æ–°è¿æ¥ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æµé‡æ¿€å¢ï¼Œå› æ­¤æ‚¨éœ€è¦å¯¹å®¢æˆ·ç«¯è¿›è¡Œç›¸åº”çš„ç¼–ç ã€‚ ç¡®è®¤å…è®¸æ‚¨æŒ‡å®šä¸€ä¸ªå›è°ƒï¼Œå½“å¦ä¸€æ–¹ç¡®è®¤å·²æ”¶åˆ°æ¶ˆæ¯æ—¶å°†è°ƒç”¨è¯¥å›è°ƒã€‚ å¹¿æ’­å’Œå¤šæ’­ï¼ˆSocket.IO ç§°ä¸ºRoomsçš„æ¦‚å¿µï¼‰å…è®¸æœåŠ¡å™¨å‘å¤šä¸ªå®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ï¼Œä½†å®¢æˆ·ç«¯æ— æ³•å‘å…¶ä»–å®¢æˆ·ç«¯å¹¿æ’­ã€‚ äº¤ä»˜ Socket.IO è§£å†³æ–¹æ¡ˆæ—¶é¢ä¸´å“ªäº›æŒ‘æˆ˜ï¼Ÿ ä¸ä»»ä½•æ¶‰åŠä¾¦å¬å’Œå‘é€æ¶ˆæ¯çš„è§£å†³æ–¹æ¡ˆä¸€æ ·ï¼Œæœ€å¤§çš„æŒ‘æˆ˜æ˜¯å¦‚ä½•æ‰©å±•åˆ°æ•°åƒåç”¨æˆ·ä¹‹å¤–ã€‚\nSocket.IO æ˜¯ä¸€ä¸ªåº“ï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªåŸºç¡€è®¾æ–½ã€‚ä½œä¸ºè§£å†³æ–¹æ¡ˆæ¶æ„å¸ˆæˆ–å¼€å‘äººå‘˜ï¼Œæ‚¨è´Ÿè´£å†³å®šè§£å†³æ–¹æ¡ˆå¦‚ä½•å¯é åœ°æ‰©å±•ï¼Œè¿™å°†æ¶‰åŠä½¿ç”¨å¤šä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ä»¥åŠåœ¨å®ƒä»¬ä¹‹é—´å¹³è¡¡å®¢æˆ·ç«¯è¿æ¥çš„è´Ÿè½½ã€‚è´Ÿè½½å¹³è¡¡æœ‰å…¶è‡ªèº«çš„ä¸€ç³»åˆ—æŒ‘æˆ˜ï¼Œä½†ç”±äº Socket.io å·²ç»å­˜åœ¨åå¤šå¹´äº†ï¼Œç¤¾åŒºå·²ç»æå‡ºäº†ä¸€ç»„å¼ºå¤§çš„æœ€ä½³å®è·µï¼Œä¾‹å¦‚ï¼Œé€‚é…å™¨çš„æ¦‚å¿µå…è®¸æ‚¨åœ¨å®¢æˆ·ç«¯ä¹‹é—´å‘é€å¹¿æ’­æ¶ˆæ¯ä½¿ç”¨Pub/Subæœºåˆ¶è¿æ¥åˆ°ä¸åŒçš„æœåŠ¡å™¨ã€‚\nå°½ç®¡å¦‚æ­¤ï¼Œå³ä½¿ç¡®å®å­˜åœ¨å¯æ‰©å±• Socket.IO çš„è§£å†³æ–¹æ¡ˆï¼Œæ‚¨çš„å¼€å‘å›¢é˜Ÿä»éœ€è¦è¿›è¡Œå¤§é‡è€ƒè™‘ï¼Œå¹¶ä¸”å¾ˆéš¾è€ƒè™‘æ¯ç§è¾¹ç¼˜æƒ…å†µã€‚\nä½¿ç”¨ Socket.IO åœ¨æœåŠ¡å™¨å®ä¾‹ä¹‹é—´å¹¿æ’­æ¶ˆæ¯çš„å»ºè®®æ¶æ„ï¼š\n","permalink":"https://blog.chensoul.cc/posts/2024/05/07/socket-io/","summary":"åŸæ–‡é“¾æ¥ï¼šhttps://www.pubnub.com/guides/socket-io/\nä»€ä¹ˆæ˜¯Socket.IOï¼Ÿ Socket.IOæ˜¯ä¸€ä¸ªå¼€æºçš„è·¨å¹³å°åº“ï¼Œå®ƒæä¾›å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´åŸºäºäº‹ä»¶çš„å…¨åŒå·¥åŒå‘é€šä¿¡ã€‚å®ƒåŸºäº WebSocket åè®®æ„å»ºï¼Œæä¾›é™„åŠ åŠŸèƒ½ï¼Œä¾‹å¦‚è‡ªåŠ¨é‡æ–°è¿æ¥ä»¥åŠåœ¨æ— æ³•ä½¿ç”¨ WebSocketæ—¶å›é€€åˆ°HTTP é•¿è½®è¯¢ã€‚\nSocket.IO å®¢æˆ·ç«¯ç”±å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯åº“ç»„æˆã€‚è™½ç„¶æœ€åˆåœ¨æœåŠ¡å™¨ä¸Šæ”¯æŒNodeJS ï¼Œåœ¨å®¢æˆ·ç«¯æ”¯æŒJavaScriptï¼Œä½†ç°åœ¨å®ƒæ”¯æŒå„ç§æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æŠ€æœ¯ï¼ŒåŒ…æ‹¬Javaã€Pythonã€Swiftå’ŒKotlinï¼Œå®ƒä»¬éƒ½æ˜¯å®˜æ–¹ä»£ç åº“çš„ä¸€éƒ¨åˆ†ï¼Œç”±æ´»è·ƒç¤¾åŒºè´¡çŒ®ã€‚\nSocket.io æœ‰ä½•ç”¨é€”ï¼Ÿ Socket.IO å…è®¸æ‚¨å®ç°ä¾èµ–äºæ¶ˆæ¯äº¤æ¢çš„å„ç§åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚å³æ—¶æ¶ˆæ¯ä¼ é€’ã€å¤šç”¨æˆ·åä½œã€å®æ—¶åˆ†æã€æ–‡ä»¶å…±äº«å’Œé€šçŸ¥ã€‚\nSocket.io é€‚åˆå®æ—¶åº”ç”¨ç¨‹åºå—ï¼Ÿ æ˜¯çš„ï¼ŒSocket.IO æ˜¯æ„å»ºå®æ—¶ Web åº”ç”¨ç¨‹åºçš„ä¸é”™é€‰æ‹©ï¼Œå› ä¸ºå®ƒæä¾›äº†è®¸å¤šå¯¹å¼€å‘äººå‘˜æœ‰ç”¨çš„å¼€ç®±å³ç”¨åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š\næˆ¿é—´å’Œå‘½åç©ºé—´æ”¯æŒå…è®¸æ‚¨å°†å®¢æˆ·ç«¯åˆ†ç»„åˆ°å¯ä»¥æ¥æ”¶å¹¿æ’­æˆ–å¤šæ’­æ¶ˆæ¯çš„æˆ¿é—´ä¸­ã€‚ è‡ªåŠ¨é‡è¿æ„å‘³ç€æ‚¨æ— éœ€æ‹…å¿ƒå®¢æˆ·ç«¯ä¸Šçº¿æˆ–ç¦»çº¿ã€‚ äºŒè¿›åˆ¶æ•°æ®æ”¯æŒï¼Œä½¿æ‚¨ä¸ä»…å¯ä»¥äº¤æ¢èŠå¤©æ¶ˆæ¯ï¼Œè¿˜å¯ä»¥äº¤æ¢å›¾åƒæˆ–å…¶ä»–åª’ä½“ã€‚ Socket.io æ˜¯ API å—ï¼Ÿ Socket.IOä¸æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„APIã€‚å®ƒæ˜¯ä¸€ä¸ªåº“æˆ–æ¡†æ¶ï¼ŒæŠ½è±¡äº†åº•å±‚ä¼ è¾“æœºåˆ¶ï¼Œå¹¶æä¾›äº†ä¸€ç»„ç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´æ„å»ºå®æ—¶åŒå‘é€šä¿¡çš„å·¥å…·å’Œå®ç”¨ç¨‹åºã€‚\nSocket.IO åŒ…å«å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶éƒ½å…¬å¼€å…¶ APIã€‚\nSocket.ioæ˜¯TCPè¿˜æ˜¯UDPï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ Socket.IOå¯ä»¥ä½¿ç”¨TCPå’ŒUDPä½œä¸ºåº•å±‚ä¼ è¾“åè®®ï¼Œä½†å®ƒä¸»è¦ä½¿ç”¨TCPã€‚\nTCPï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼‰æ˜¯ä¸€ç§å¯é çš„ã€é¢å‘è¿æ¥çš„åè®®ï¼Œå¯ç¡®ä¿æ•°æ®æŒ‰é¡ºåºä¸”æ— é”™è¯¯åœ°ä¼ é€ã€‚\nå¦ä¸€æ–¹é¢ï¼ŒUDPï¼ˆç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼‰æ˜¯ä¸€ç§æ— è¿æ¥ã€ä¸å¯é çš„åè®®ï¼Œå®ƒå‘é€æ•°æ®æ—¶ä¸æ£€æŸ¥æ•°æ®æ˜¯å¦å·²æˆåŠŸæ¥æ”¶ã€‚\nUDP æ¯” TCP æ›´è½»é‡çº§ï¼Œå› ä¸ºåªæœ‰åè€…åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹è¿æ¥ï¼Œä½†å®ƒåªèƒ½ç”±èƒ½å¤ŸæŠµå¾¡ä¸¢å¤±æ¶ˆæ¯çš„åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚\nSocket.io ä¸ Web Sockets è™½ç„¶ Socket.IO æ˜ç¡®ä¸æ˜¯WebSocketå®ç°ï¼Œä½†æœ‰ä¸€äº›ç›¸ä¼¼ä¹‹å¤„ã€‚ä¸¤è€…éƒ½æ˜¯åŸºäºäº‹ä»¶çš„ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥â€œä¾¦å¬â€è¿æ¥ã€æ–­å¼€è¿æ¥æˆ– new_message ç­‰äº‹ä»¶ï¼Œå¹¶ä¸”éƒ½å…è®¸æ‚¨å‘é€JSON å¯¹è±¡ç­‰ç»“æ„åŒ–æ•°æ®ã€‚\næ‚¨å¯ä»¥å°† Socket.IO è§†ä¸ºåº•å±‚ä¼ è¾“åè®®ä¹‹ä¸Šçš„æŠ½è±¡å±‚ã€‚é™¤äº†åº•å±‚é€šä¿¡å±‚ä¹‹å¤–ï¼Œè¯¥åº“è¿˜å®ç°äº†å…¶ä»–åŠŸèƒ½ï¼Œä¾‹å¦‚è‡ªåŠ¨é‡æ–°è¿æ¥ã€æ•°æ®åŒ…ç¼“å†²å’Œæ¶ˆæ¯ç¡®è®¤ï¼Œä»¥åŠåœ¨ WebSocket ä¸å¯ç”¨æ—¶å›é€€åˆ° HTTP é•¿è½®è¯¢ï¼Œä»è€Œå¢åŠ äº†é²æ£’æ€§ã€‚\nSocket.io ç¤ºä¾‹ï¼šå®¢æˆ·ç«¯/æœåŠ¡å™¨ JavaScript ä¸­ Socket.IO çš„ Hello World å®¢æˆ·ç«¯/æœåŠ¡å™¨å®ç°å°†ç¼–å†™å¦‚ä¸‹ï¼Œæ‘˜è‡ª4.x Socket.IO æ–‡æ¡£ï¼š\nSocket.io æœåŠ¡å™¨ç¤ºä¾‹ï¼š\nSocket.io å®¢æˆ·ç«¯ç¤ºä¾‹ï¼š\nSocket.IO æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ è¯¥åº“æ”¯æŒä¸¤ç§ä¼ è¾“æ–¹æ³•ï¼šHTTP é•¿è½®è¯¢å’Œ WebSocketsã€‚é¦–å…ˆå»ºç«‹ HTTP é•¿è½®è¯¢è¿æ¥ï¼Œç„¶ååœ¨å¯èƒ½çš„æƒ…å†µä¸‹å‡çº§ä¸º WebSocket è¿æ¥ã€‚ WebSocket ä¸èƒ½åœ¨ä»»ä½•åœ°æ–¹è¿è¡Œï¼Œä¾‹å¦‚ï¼Œå®ƒä»¬è¢«è®¸å¤šå…¬å¸ä»£ç†å’Œé˜²ç«å¢™é˜»æ­¢ï¼Œå› æ­¤é¦–å…ˆå‘èµ· HTTP é•¿è½®è¯¢ï¼Œå› ä¸ºå®ƒæ›´æœ‰å¯èƒ½æˆåŠŸã€‚ HTTP é•¿è½®è¯¢è¿æ¥å»ºç«‹åï¼Œä¼šåœ¨å¯¹æœ€ç»ˆç”¨æˆ·å®Œå…¨é€æ˜çš„è¿‡ç¨‹ä¸­â€œå‡çº§â€ä¸º WebSocket è¿æ¥ã€‚\nSocket.IOçš„æ¶æ„æ˜¯æ€æ ·çš„ï¼Ÿ Socket.IO ç”±ä¸¤ä¸ªä¸åŒçš„å±‚ç»„æˆï¼Œåˆ†åˆ«å­˜åœ¨äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸Šï¼š\nåº•å±‚ç®¡é“ç”±ä¸€ä¸ªåä¸ºEngine.IOçš„å•ç‹¬åº“æä¾› Socket.IO æä¾›çš„é«˜çº§ API ä½œä¸ºå¼€å‘äººå‘˜æˆ–ç”¨æˆ·ï¼Œæ‚¨é€šå¸¸ä¸ä¼šç›´æ¥ä¸ Engine.IO äº¤äº’ï¼Œä½†å®ƒåœ¨å¹•åè¿è¡Œä»¥å»ºç«‹è¿æ¥ã€åå•†ä¼ è¾“æœºåˆ¶å¹¶æ£€æµ‹ä»»ä½•æ–­å¼€è¿æ¥ã€‚å°† Engine.IO ä¸ WebSocket è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œä¸¤è€…åœ¨åŠŸèƒ½ä¸Šéå¸¸ç›¸ä¼¼ï¼Œåªæ˜¯ Engine.","title":"[è¯‘]ä»€ä¹ˆæ˜¯Socket.IOï¼Ÿ"},{"content":"åŸæ–‡é“¾æ¥ï¼šhttps://www.pubnub.com/guides/websockets/\nä»€ä¹ˆæ˜¯ WebSocketï¼Ÿ WebSocket æ˜¯ä¸€ç§é€šè¿‡å•ä¸ªTCPè¿æ¥æä¾›å…¨åŒå·¥é€šä¿¡é€šé“çš„é€šä¿¡åè®®ã€‚å®ƒæ”¯æŒå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„å®æ—¶ã€äº‹ä»¶é©±åŠ¨çš„è¿æ¥ã€‚\nä¸éµå¾ªè¯·æ±‚-å“åº”æ¨¡å‹çš„ä¼ ç»Ÿ HTTP è½¯ä»¶ä¸åŒï¼ŒWebSocket å…è®¸åŒå‘ï¼ˆåŒå‘ï¼‰é€šä¿¡ã€‚è¿™æ„å‘³ç€å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥éšæ—¶å‘å¯¹æ–¹å‘é€æ•°æ®ï¼Œè€Œæ— éœ€æŒç»­è½®è¯¢ã€‚\nWebSocket æœ‰ä½•ç”¨é€”ï¼Ÿ WebSocket ç”¨äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„å®æ—¶ã€äº‹ä»¶é©±åŠ¨çš„é€šä¿¡ã€‚å®ƒä»¬å¯¹äºæ„å»ºéœ€è¦å³æ—¶æ›´æ–°çš„è½¯ä»¶åº”ç”¨ç¨‹åºç‰¹åˆ«æœ‰ç”¨ï¼Œä¾‹å¦‚å®æ—¶èŠå¤©ã€æ¶ˆæ¯ä¼ é€’å’Œå¤šäººæ¸¸æˆã€‚\nåœ¨ä¼ ç»Ÿçš„ HTTP ä¸­ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨ç”¨è¯·æ±‚çš„æ•°æ®è¿›è¡Œå“åº”ã€‚è¿™ç§è¯·æ±‚-å“åº”æ¨¡å‹éœ€è¦ä»å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨è¿›è¡Œè¿ç»­è½®è¯¢ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´å»¶è¿Ÿå¢åŠ å’Œæ•ˆç‡é™ä½ã€‚\nå¦ä¸€æ–¹é¢ï¼ŒWebSockets åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹æŒä¹…è¿æ¥ã€‚è¿™æ„å‘³ç€ä¸€æ—¦å»ºç«‹è¿æ¥ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å°±å¯ä»¥éšæ—¶å‘å¯¹æ–¹å‘é€æ•°æ®ï¼Œè€Œæ— éœ€ä¸æ–­è½®è¯¢è¯·æ±‚ã€‚è¿™å…è®¸å®æ—¶é€šä¿¡ï¼Œå¯ä»¥ç«‹å³å‘é€å’Œæ¥æ”¶æ›´æ–°ã€‚\nä¾‹å¦‚ï¼Œå½“ç”¨æˆ·åœ¨èŠå¤©åº”ç”¨ç¨‹åºä¸­å‘é€æ¶ˆæ¯æ—¶ï¼Œè¯¥æ¶ˆæ¯å¯ä»¥ç«‹å³ä¼ é€’ç»™æ‰€æœ‰å…¶ä»–ç”¨æˆ·ï¼Œè€Œæ— éœ€åˆ·æ–°é¡µé¢æˆ–å‘å‡ºé¢‘ç¹çš„ HTTP è¯·æ±‚ã€‚è¿™å°†å¸¦æ¥æ›´åŠ æ— ç¼å’Œé«˜æ•ˆçš„ç”¨æˆ·ä½“éªŒã€‚\næ­¤å¤–ï¼ŒWeb Sockets è¿˜å…è®¸åŒå‘é€šä¿¡ï¼Œè¿™æ„å‘³ç€å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½å¯ä»¥ç›¸äº’å‘é€æ•°æ®ã€‚è¿™ä¸ºæ›´å…·äº¤äº’æ€§å’Œå¸å¼•åŠ›çš„åº”ç”¨ç¨‹åºæä¾›äº†å¯èƒ½æ€§ï¼Œå…¶ä¸­æœåŠ¡å™¨å¯ä»¥å¤„ç†å‘å®¢æˆ·ç«¯æ¨é€æ›´æ–°æˆ–é€šçŸ¥ï¼Œè€Œæ— éœ€å®¢æˆ·ç«¯æ˜ç¡®è¯·æ±‚å®ƒä»¬ã€‚\nWeb å¥—æ¥å­—çš„ç¼ºç‚¹ WebSocket çš„ç¼ºç‚¹åŒ…æ‹¬ï¼š\næµè§ˆå™¨æ”¯æŒï¼šè™½ç„¶å¤§å¤šæ•°ç°ä»£æµè§ˆå™¨æ”¯æŒ WebSocketï¼Œä½†ä¸€äº›æ—§æµè§ˆå™¨ä¸æ”¯æŒã€‚è¿™å¯èƒ½ä¼šé™åˆ¶åº”ç”¨ç¨‹åºçš„èŒƒå›´ï¼Œå¹¶ä¸”éœ€è¦é’ˆå¯¹æ—§ç‰ˆæµè§ˆå™¨çš„é¢å¤–åå¤‡æœºåˆ¶ã€‚ ä»£ç†å’Œé˜²ç«å¢™é™åˆ¶ï¼šæŸäº›ä»£ç†æœåŠ¡å™¨å’Œé˜²ç«å¢™å¯èƒ½ä¼šé˜»æ­¢æˆ–å¹²æ‰° WebSocket è¿æ¥ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´è¿æ¥é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨å®‰å…¨çš„å…¬å¸æˆ–å—é™çš„ç½‘ç»œç¯å¢ƒä¸­ã€‚ å¯æ‰©å±•æ€§ï¼šWeb Sockets åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ç»´æŠ¤æŒä¹…è¿æ¥ï¼Œè¿™åœ¨å¤„ç†è®¸å¤šå¹¶å‘è¿æ¥æ—¶å¯èƒ½ä¼šå¯¼è‡´æœåŠ¡å™¨èµ„æºç´§å¼ ã€‚å¿…é¡»å®æ–½é€‚å½“çš„è´Ÿè½½å¹³è¡¡å’Œèµ„æºç®¡ç†æŠ€æœ¯ä»¥ç¡®ä¿å¯æ‰©å±•æ€§ã€‚åƒ Socket.io è¿™æ ·çš„å¼€æºèµ„æºä¸é€‚åˆå¤§è§„æ¨¡è¿è¥æˆ–å¿«é€Ÿå¢é•¿ã€‚ æœ‰çŠ¶æ€æ€§ï¼šä¸æ— çŠ¶æ€çš„ä¼ ç»Ÿ HTTP ä¸åŒï¼ŒWebSocket æ˜¯æœ‰çŠ¶æ€çš„ã€‚è¿™æ„å‘³ç€æœåŠ¡å™¨éœ€è¦ç»´æŠ¤æ¯ä¸ªå®¢æˆ·ç«¯çš„è¿æ¥çŠ¶æ€ï¼Œä»è€Œå¯¼è‡´å†…å­˜ä½¿ç”¨é‡å¢åŠ å’Œæ½œåœ¨çš„å¯æ‰©å±•æ€§æŒ‘æˆ˜ã€‚ å®‰å…¨æ³¨æ„äº‹é¡¹ï¼šé€šè¿‡ WebSocket å»ºç«‹æŒä¹…è¿æ¥ï¼Œéœ€è¦é‡‡å–é€‚å½“çš„å®‰å…¨æªæ–½æ¥é˜²æ­¢æ½œåœ¨çš„æ¼æ´ï¼Œä¾‹å¦‚è·¨ç«™ç‚¹è„šæœ¬ (XSS) å’Œè·¨ç«™ç‚¹è¯·æ±‚ä¼ªé€ (CSRF)ã€‚åº”å®æ–½ä½¿ç”¨SSL/TLSåŠ å¯†çš„å®‰å…¨ WebSocket è¿æ¥ (wss://)ï¼Œä»¥ç¡®ä¿æ•°æ®éšç§å’Œå®Œæ•´æ€§ã€‚ å¦‚æœé€šè¿‡ Web å¥—æ¥å­—çš„è¿æ¥ä¸¢å¤±ï¼Œåˆ™ä¸åŒ…å«è´Ÿè½½å¹³è¡¡æˆ–é‡æ–°è¿æ¥æœºåˆ¶ã€‚ åœ¨å¯èƒ½ä¸æ”¯æŒ Web Sockets çš„ç¯å¢ƒä¸­ï¼Œä»ç„¶éœ€è¦æœ‰åå¤‡é€‰é¡¹ï¼Œä¾‹å¦‚HTTP æµæˆ–é•¿è½®è¯¢ã€‚ åƒPresenceè¿™æ ·çš„åŠŸèƒ½åœ¨ WebSocket è¿æ¥ä¸Šä¸èƒ½å¾ˆå¥½åœ°å·¥ä½œï¼Œå› ä¸ºæ–­å¼€è¿æ¥å¾ˆéš¾æ£€æµ‹åˆ°ã€‚ WebSocketsã€HTTPã€Web æœåŠ¡å™¨ã€è½®è¯¢ HTTP è¿æ¥ä¸ WebSockets è¦äº†è§£WebSocket APIï¼Œäº†è§£å…¶æ„å»ºåŸºç¡€ â€” HTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰åŠå…¶è¯·æ±‚/å“åº”æ¨¡å‹ä¹Ÿå¾ˆé‡è¦ã€‚ HTTP æ˜¯ä¸€ç§åº”ç”¨å±‚åè®®ï¼Œæ˜¯æ‰€æœ‰åŸºäº Web çš„é€šä¿¡å’Œæ•°æ®ä¼ è¾“çš„åŸºç¡€ã€‚\nä½¿ç”¨ HTTP æ—¶ï¼Œå®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ Web æµè§ˆå™¨ï¼‰å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œç„¶åæœåŠ¡å™¨å‘å›æ¶ˆæ¯ï¼ˆç§°ä¸ºå“åº”ï¼‰ã€‚æˆ‘ä»¬ä»Šå¤©æ‰€çŸ¥é“çš„ç½‘ç»œæ˜¯å»ºç«‹åœ¨è¿™ç§åŸºæœ¬çš„å®¢æˆ·ç«¯-æœåŠ¡å™¨å¾ªç¯ä¹‹ä¸Šçš„ï¼Œå°½ç®¡å¯¹ HTTP è¿›è¡Œäº†è®¸å¤šæ·»åŠ å’Œæ›´æ–°ä»¥ä½¿å…¶æ›´å…·äº¤äº’æ€§ã€‚å½“å‰æœ‰ä¸€äº›å¯è¡Œä¸”å—æ”¯æŒçš„ HTTP ç‰ˆæœ¬ï¼ˆHTTP/1.1 å’Œ HTTP/2ï¼‰ä»¥åŠç§°ä¸º HTTPS çš„å®‰å…¨ç‰ˆæœ¬ã€‚\nåŸºæœ¬ HTTP è¯·æ±‚é€‚ç”¨äºè®¸å¤šç”¨ä¾‹ï¼Œä¾‹å¦‚å½“æœ‰äººéœ€è¦åœ¨ç½‘é¡µä¸Šæœç´¢å¹¶æ¥æ”¶ç›¸å…³çš„ã€éæ—¶é—´æ•æ„Ÿçš„ä¿¡æ¯æ—¶ã€‚ç„¶è€Œï¼Œå®ƒå¹¶ä¸æ€»æ˜¯æœ€é€‚åˆéœ€è¦å®æ—¶é€šä¿¡æˆ–éœ€è¦ä»¥æœ€å°å»¶è¿Ÿå¿«é€Ÿæ›´æ–°çš„æ•°æ®çš„ Web åº”ç”¨ç¨‹åºã€‚\næ¯å½“å®¢æˆ·ç«¯å‘å‡ºæ–°çš„ HTTP æœåŠ¡å™¨è¯·æ±‚æ—¶ï¼Œé»˜è®¤è¡Œä¸ºæ˜¯æ‰“å¼€æ–°çš„ HTTP è¿æ¥ã€‚è¿™æ˜¯ä½æ•ˆçš„ï¼Œå› ä¸ºå®ƒä½¿ç”¨å¾ªç¯éæœ‰æ•ˆè´Ÿè½½æ•°æ®çš„å¸¦å®½å¹¶å¢åŠ äº†æ•°æ®ä¼ è¾“ä¹‹é—´çš„å»¶è¿Ÿã€‚\næ­¤å¤–ï¼ŒHTTP è¯·æ±‚åªèƒ½ä»å®¢æˆ·ç«¯å‘ä¸€ä¸ªæ–¹å‘æµåŠ¨ã€‚ä¼ ç»Ÿä¸Šæ²¡æœ‰æœåŠ¡å™¨å‘èµ·ä¸å®¢æˆ·ç«¯é€šä¿¡çš„æœºåˆ¶ã€‚é™¤éæœåŠ¡å™¨é¦–å…ˆè¯·æ±‚æ•°æ®ï¼Œå¦åˆ™æœåŠ¡å™¨æ— æ³•å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ã€‚è¿™å¯èƒ½ä¼šç»™éœ€è¦ä»æœåŠ¡å™¨ç«¯å®æ—¶å‘å‡ºæ¶ˆæ¯çš„ç”¨ä¾‹å¸¦æ¥é—®é¢˜ã€‚\nçŸ­è½®è¯¢ä¸ WebSockets HTTP è½®è¯¢æ˜¯æ¥æ”¶å®šæœŸæ•°æ®æ›´æ–°çš„ç¬¬ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚è½®è¯¢æ˜¯ä¸€ç§å®¢æˆ·ç«¯é‡å¤å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ç›´åˆ°æœåŠ¡å™¨æ›´æ–°çš„æŠ€æœ¯ã€‚ä¾‹å¦‚ï¼Œæ‰€æœ‰ç°ä»£ Web æµè§ˆå™¨éƒ½æä¾›å¯¹ XMLHttpRequest çš„æ”¯æŒï¼Œè¿™æ˜¯è½®è¯¢æœåŠ¡å™¨çš„åŸå§‹æ–¹æ³•ä¹‹ä¸€ã€‚\nè¿™äº›æ—©æœŸçš„è§£å†³æ–¹æ¡ˆå¯¹äºé«˜æ•ˆçš„å®æ—¶é€šä¿¡æ¥è¯´ä»ç„¶ä¸æ˜¯ç†æƒ³çš„â€”â€”çŸ­è½®è¯¢æ˜¯å¯†é›†çš„ï¼Œå› ä¸ºå¯¹äºæ¯ä¸ªè¯·æ±‚ï¼Œéæœ‰æ•ˆè´Ÿè½½æ•°æ®éƒ½è¢«é‡æ–°å‘é€å¹¶ä¸”å¿…é¡»è¢«è§£æï¼ŒåŒ…æ‹¬æ ‡å¤´ HTMLã€Web URL å’Œå…¶ä»–é‡å¤çš„æ•°æ®ã€‚æµªè´¹èµ„æºçš„ä¿¡æ¯ã€‚\né•¿è½®è¯¢ä¸ Web å¥—æ¥å­— æ”¹å–„å»¶è¿Ÿçš„ä¸‹ä¸€ä¸ªé€»è¾‘æ­¥éª¤æ˜¯HTTP é•¿è½®è¯¢ã€‚å½“é•¿è½®è¯¢æ—¶ï¼Œå®¢æˆ·ç«¯è½®è¯¢æœåŠ¡å™¨ï¼Œå¹¶ä¸”è¯¥è¿æ¥ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œç›´åˆ°æœåŠ¡å™¨æœ‰æ–°æ•°æ®ã€‚æœåŠ¡å™¨å‘é€å¸¦æœ‰ç›¸å…³ä¿¡æ¯çš„å“åº”ï¼Œç„¶åå®¢æˆ·ç«¯ç«‹å³æ‰“å¼€å¦ä¸€ä¸ªè¯·æ±‚ï¼Œå†æ¬¡ä¿ç•™ç›´åˆ°ä¸‹ä¸€æ¬¡æ›´æ–°ã€‚é•¿è½®è¯¢å¯ä»¥ä½¿è¿æ¥ä¿æŒæ‰“å¼€çŠ¶æ€æœ€å¤š 280 ç§’ï¼Œç„¶åè‡ªåŠ¨å‘é€å¦ä¸€ä¸ªè¯·æ±‚ã€‚æ­¤æ–¹æ³•æœ‰æ•ˆåœ°æ¨¡æ‹Ÿ HTTP æœåŠ¡å™¨æ¨é€ã€‚\né•¿è½®è¯¢åœ¨è®¸å¤šç¯å¢ƒä¸­æä¾›å¿«é€Ÿé€šä¿¡ï¼Œå¹¶ä¸”è¢«å¹¿æ³›ä½¿ç”¨ï¼Œé€šå¸¸ä¸ WebSocket è¿æ¥æˆ–æœåŠ¡å™¨ç«¯äº‹ä»¶ (SSE)ç­‰çœŸæ­£çš„åŸºäºæ¨é€çš„æ–¹æ³•ç›¸åã€‚é•¿è½®è¯¢åœ¨æœåŠ¡å™¨ç«¯çœ‹èµ·æ¥å¯èƒ½å¾ˆå¯†é›†ï¼Œå› ä¸ºå®ƒéœ€è¦è¿ç»­çš„èµ„æºæ¥ä¿æŒè¿æ¥æ‰“å¼€ï¼Œä½†å®ƒä½¿ç”¨çš„èµ„æºæ¯”é‡å¤å‘é€è½®è¯¢è¯·æ±‚è¦å°‘å¾—å¤šã€‚\né˜…è¯»æ›´å¤šå†…å®¹ï¼šé•¿è½®è¯¢ä¸ Websockets\nWebSocket æœ‰ä½•ç”¨é€”ï¼Ÿ å¼€å‘äººå‘˜å‘æ˜äº† WebSocket æ¥æœ‰æ•ˆåœ°ä¿ƒè¿›å®æ—¶ç»“æœã€‚ WebSocket åœ¨å®¢æˆ·ç«¯å’Œ WebSocket æœåŠ¡å™¨ä¹‹é—´å¯åŠ¨è¿ç»­çš„å…¨åŒå·¥é€šä¿¡ã€‚è¿™å‡å°‘äº†ä¸å¿…è¦çš„ç½‘ç»œæµé‡ï¼Œå› ä¸ºæ•°æ®å¯ä»¥é€šè¿‡å•ä¸ªå¼€æ”¾è¿æ¥ç«‹å³åŒå‘ä¼ è¾“ã€‚è¿™æä¾›äº†ç½‘ç»œä¸Šçš„é€Ÿåº¦å’Œå®æ—¶åŠŸèƒ½ã€‚ Websockets è¿˜ä½¿æœåŠ¡å™¨èƒ½å¤Ÿè·Ÿè¸ªå®¢æˆ·ç«¯å¹¶æ ¹æ®éœ€è¦å‘å®ƒä»¬â€œæ¨é€â€æ•°æ®ï¼Œè€Œä»…ä½¿ç”¨ HTTP æ˜¯ä¸å¯èƒ½å®ç°è¿™ä¸€ç‚¹çš„ã€‚\nWebSocket è¿æ¥æ”¯æŒé€šè¿‡æ¶ˆæ¯ä¼ è¾“æ–‡æœ¬å­—ç¬¦ä¸²å’ŒäºŒè¿›åˆ¶æ•°æ®ã€‚ WebSocket æ¶ˆæ¯åŒ…æ‹¬å¸§ã€æœ‰æ•ˆè´Ÿè½½å’Œæ•°æ®éƒ¨åˆ†ã€‚é€šè¿‡è¿™ç§æ–¹å¼é€šè¿‡ç°æœ‰ç½‘ç»œè¿æ¥å‘é€çš„éæœ‰æ•ˆè´Ÿè½½æ•°æ®éå¸¸å°‘ï¼Œè¿™æœ‰åŠ©äºå‡å°‘å»¶è¿Ÿå’Œå¼€é”€ï¼Œç‰¹åˆ«æ˜¯ä¸ HTTP è¯·æ±‚å’Œæµæ¨¡å‹ç›¸æ¯”ã€‚\nGoogle Chrome äº 2009 å¹´æˆä¸ºç¬¬ä¸€ä¸ªåŒ…å« WebSocket æ ‡å‡†æ”¯æŒçš„æµè§ˆå™¨ã€‚RFC 6455ï¼ˆWebSocket åè®®ï¼‰äº 2011 å¹´æ­£å¼åœ¨çº¿å‘å¸ƒã€‚WebSocketåè®®å’ŒWebSocket APIç”± W3C å’Œ IETF æ ‡å‡†åŒ–ï¼Œè·¨æµè§ˆå™¨çš„æ”¯æŒéå¸¸å¹¿æ³›ã€‚å¸¸è§çš„ã€‚\nWebSockets å¦‚ä½•å·¥ä½œï¼ˆåŠå…¶è¿æ¥ï¼‰ åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨äº¤æ¢æ•°æ®ä¹‹å‰ï¼Œå¿…é¡»ä½¿ç”¨ TCPï¼ˆä¼ è¾“æ§åˆ¶åè®®ï¼‰å±‚å»ºç«‹è¿æ¥ã€‚ä½¿ç”¨ WebSocket åè®®ï¼ŒwebSocket å¯ä»¥æœ‰æ•ˆåœ°ä½œä¸º TCP è¿æ¥ä¸Šçš„ä¼ è¾“å±‚è¿è¡Œã€‚\né€šè¿‡ HTTP è¯·æ±‚/å“åº”å¯¹è¿æ¥åï¼Œå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨ HTTP/1.1 å‡çº§æ ‡å¤´å°†å…¶è¿æ¥ä» HTTP åˆ‡æ¢åˆ° WebSocketsã€‚ç„¶è€Œï¼Œä¸ HTTP/1.1 ä¸åŒï¼ŒWebSocket è¿æ¥æ˜¯å®Œå…¨å¼‚æ­¥çš„ã€‚ WebSocket è¿æ¥æ˜¯é€šè¿‡ TCP ä¸Šçš„ WebSocket æ¡æ‰‹å»ºç«‹çš„ã€‚åœ¨æ–°çš„ WebSocket æ¡æ‰‹æœŸé—´ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¿˜ä¼šä¼ è¾¾åç»­äº¤äº’å°†ä½¿ç”¨å“ªä¸ªå­åè®®ã€‚å»ºç«‹åï¼Œè¿æ¥å°†åœ¨ WebSocket åè®®ä¸Šè¿è¡Œã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“åœ¨ WebSocket åè®®å±‚ä¸Šè¿è¡Œæ—¶ï¼ŒWebSocket éœ€è¦ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ (URI) æ‰èƒ½ä½¿ç”¨â€œws:â€æˆ–â€œwss:â€æ–¹æ¡ˆï¼Œç±»ä¼¼äº HTTP URL å§‹ç»ˆä½¿ç”¨â€œhttp:â€çš„æ–¹å¼æˆ–â€œhttps:â€æ–¹æ¡ˆã€‚\næœ‰å“ªäº›åº“å¯ç”¨äºå®ç° WebSocketï¼Ÿ åœ¨å®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºä¸­å®ç° WebSocket æ—¶ï¼Œå¤šä¸ªåº“å¯ä»¥æä¾›å¿…è¦çš„å·¥å…·å’ŒåŠŸèƒ½ã€‚è¿™äº›åº“æä¾›äº†å¹¿æ³›çš„åŠŸèƒ½å¹¶æ”¯æŒä¸åŒçš„ç¼–ç¨‹è¯­è¨€ï¼Œä½¿å¼€å‘äººå‘˜å¯ä»¥æ›´è½»æ¾åœ°å°† WebSocket é›†æˆåˆ°ä»–ä»¬çš„åº”ç”¨ç¨‹åºä¸­ã€‚ä»¥ä¸‹æ˜¯æ‚¨å¯ä»¥è€ƒè™‘çš„ä¸€äº›æµè¡Œåº“ï¼š\nSocket.IO æ˜¯ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„åº“ï¼Œå®ƒæä¾›æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´åŸºäºäº‹ä»¶çš„å®æ—¶åŒå‘é€šä¿¡ã€‚å®ƒæä¾›è‡ªåŠ¨é‡æ–°è¿æ¥ã€åå¤‡é€‰é¡¹ä»¥åŠå¯¹å„ç§ä¼ è¾“çš„æ”¯æŒç­‰åŠŸèƒ½ï¼Œä½¿å…¶æˆä¸ºæ„å»ºå¯æ‰©å±•ä¸”å¯é çš„åº”ç”¨ç¨‹åºçš„ç»ä½³é€‰æ‹©ã€‚ Socket.IO æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ï¼ŒåŒ…æ‹¬JavaScriptã€Python å’Œ Javaã€‚ SignalRæ˜¯å¾®è½¯å¼€å‘çš„å®æ—¶é€šä¿¡åº“ã€‚å®ƒå…è®¸æ‚¨é€šè¿‡æä¾›ç”¨äºåˆ›å»º WebSocket è¿æ¥çš„ç®€å• API æ¥æ„å»ºå®æ—¶ Web åº”ç”¨ç¨‹åºã€‚ SignalR æ”¯æŒæœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯å®ç°ï¼Œå¹¶ä¸”å¯ä»¥ä¸ .NETã€JavaScript å’Œå…¶ä»–è¯­è¨€ä¸€èµ·ä½¿ç”¨ã€‚å®ƒè¿˜æä¾›è‡ªåŠ¨è¿æ¥ç®¡ç†ã€å¹¿æ’­æ¶ˆæ¯ä»¥åŠè·¨å¤šä¸ªæœåŠ¡å™¨çš„æ‰©å±•ã€‚ SockJSæ˜¯ä¸€ä¸ªJavaScriptåº“ï¼Œå³ä½¿æœåŠ¡å™¨ä¸æ”¯æŒWebSocketsï¼Œå®ƒä¹Ÿå¯ä»¥åœ¨æµè§ˆå™¨ä¸­æä¾›ç±»ä¼¼WebSocketçš„å¯¹è±¡ã€‚å®ƒæä¾›äº†ä¸€ç§ä½¿ç”¨æ›¿ä»£ä¼ è¾“åè®®ï¼ˆä¾‹å¦‚ HTTP é•¿è½®è¯¢ï¼‰çš„å›é€€æœºåˆ¶ï¼Œå…è®¸æ‚¨çš„åº”ç”¨ç¨‹åºåœ¨ Websocket ä¸å¯ç”¨çš„ç¯å¢ƒä¸­å·¥ä½œã€‚ SockJS å¯ä»¥ä¸å„ç§åç«¯å’Œç¼–ç¨‹è¯­è¨€ä¸€èµ·ä½¿ç”¨ï¼ŒåŒ…æ‹¬Node.jsã€ Java å’ŒPythonã€‚ WS æ˜¯ Node.js çš„ä¸€ä¸ªç®€å•ä¸”è½»é‡çº§çš„ WebSocket å®ç°ã€‚å®ƒæä¾›äº†ä¸€ä¸ªç®€å•çš„ API ç”¨äºåˆ›å»º WebSocket æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼Œä»è€Œå¯ä»¥è½»æ¾åœ°å°† websocket é›†æˆåˆ° Node.js åº”ç”¨ç¨‹åºä¸­ã€‚ ws æä¾›æ¯æ¶ˆæ¯å‹ç¼©ã€è‡ªåŠ¨é‡æ–°è¿æ¥ä»¥åŠç”¨äºå¤„ç†ä¼ å…¥å’Œä¼ å‡ºæ¶ˆæ¯çš„å¯è‡ªå®šä¹‰é€‰é¡¹ã€‚ Django Channelsï¼šDjango Channelsæ˜¯ä¸€ä¸ªæ‰©å±• Django Web æ¡†æ¶å¤„ç†å®æ—¶åº”ç”¨ç¨‹åºåŠŸèƒ½çš„åº“ã€‚å®ƒæ”¯æŒ websockets å’Œå…¶ä»–åè®®ï¼Œå¦‚ HTTP é•¿è½®è¯¢å’ŒæœåŠ¡å™¨å‘é€äº‹ä»¶ã€‚ Django Channels å…è®¸æ‚¨ä½¿ç”¨ç†Ÿæ‚‰çš„ Django è¯­æ³•å’Œå·¥å…·æ„å»ºå®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºã€‚ è€ƒè™‘ä½¿ç”¨ WebSocket è¿›è¡Œå®æ—¶é€šä¿¡çš„åŸå›  Websockets æä¾›å®æ—¶æ›´æ–°å’Œå¼€æ”¾çš„é€šä¿¡çº¿è·¯ã€‚ Websocket ç¬¦åˆ HTML5 æ ‡å‡†ï¼Œå¹¶æä¾›ä¸æ—§ç‰ˆ HTML æ–‡æ¡£çš„å‘åå…¼å®¹æ€§ã€‚å› æ­¤ï¼Œæ‰€æœ‰ç°ä»£ç½‘ç»œæµè§ˆå™¨ï¼ˆGoogle Chromeã€Mozilla Firefoxã€Apple Safari ç­‰ï¼‰éƒ½æ”¯æŒå®ƒä»¬ã€‚ WebSockets å…¼å®¹Androidã€iOSã€Web å’Œæ¡Œé¢å¹³å°ã€‚ å•ä¸ªæœåŠ¡å™¨å¯ä»¥åŒæ—¶æ‰“å¼€å¤šä¸ª WebSocket è¿æ¥ï¼Œå¹¶ä¸”å¯ä»¥ä¸åŒä¸€å®¢æˆ·ç«¯å»ºç«‹å¤šä¸ªè¿æ¥ï¼Œè¿™ä¸ºå¯æ‰©å±•æ€§æ‰“å¼€äº†å¤§é—¨ã€‚ WebSocket å¯ä»¥é€šè¿‡è®¸å¤šä»£ç†å’Œé˜²ç«å¢™è¿›è¡Œæµå¼ä¼ è¾“ã€‚ æœ‰è®¸å¤šå¼€æºèµ„æºå’Œæ•™ç¨‹å¯ç”¨äºå°† WebSocket åˆå¹¶åˆ°åº”ç”¨ç¨‹åºä¸­ï¼Œä¾‹å¦‚ Javascript åº“ Socket.ioã€‚ PubNub å¯¹ WebSockets ä¸é•¿è½®è¯¢çš„çœ‹æ³• PubNub é‡‡å–ä¸åè®®æ— å…³çš„ç«‹åœºï¼Œä½†åœ¨æˆ‘ä»¬å½“å‰çš„æ“ä½œä¸­ï¼Œæˆ‘ä»¬å‘ç°é•¿è½®è¯¢æ˜¯å¤§å¤šæ•°ç”¨ä¾‹çš„æœ€ä½³é€‰æ‹©ã€‚éƒ¨åˆ†åŸå› æ˜¯åœ¨åç«¯æ‰©å±• WebSocket æ‰€éœ€çš„ç»´æŠ¤å’Œä¿å…»ï¼Œä»¥åŠå½“æ‚¨æ— æ³•è½»æ¾è¯†åˆ«æ–­å¼€è¿æ¥æ—¶å¯èƒ½å‡ºç°çš„æ½œåœ¨é—®é¢˜ã€‚ WebSocket æ˜¯ä¸€ä¸ªå¾ˆæ£’çš„å·¥å…·ï¼Œä½†é•¿è½®è¯¢åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½èƒ½å¯é åœ°å·¥ä½œã€‚\nPubNub ä½¿ç”¨é•¿è½®è¯¢æ¥ç¡®ä¿æ‰€æœ‰ç½‘ç»œç¯å¢ƒï¼ˆè€Œä¸ä»…ä»…æ˜¯å¤§å¤šæ•°ï¼‰çš„å¯é æ€§ã€å®‰å…¨æ€§å’Œå¯æ‰©å±•æ€§ã€‚åœ¨è®¸å¤šç°å®ä¸–ç•Œçš„å®æ—¶å®ç°ä¸­ï¼Œé•¿è½®è¯¢å¯ä»¥ä¸ WebSocket ä¸€æ ·é«˜æ•ˆã€‚æˆ‘ä»¬å¼€å‘äº†ä¸€ç§é«˜æ•ˆé•¿è½®è¯¢çš„æ–¹æ³•â€”â€”ç”¨ C è¯­è¨€ç¼–å†™ï¼Œå¹¶é’ˆå¯¹è§„æ¨¡è¿›è¡Œäº†å¤šä¸ªå†…æ ¸ä¼˜åŒ–ã€‚\nPubNub æ˜¯ä¸€ä¸ªå®æ—¶é€šä¿¡å¹³å°ï¼Œä¸ºçœŸå®çš„è™šæ‹Ÿä½“éªŒæä¾›åŸºç¡€ï¼Œä¾‹å¦‚å®æ—¶æ›´æ–°ã€åº”ç”¨å†…èŠå¤©ã€æ¨é€é€šçŸ¥ç­‰ã€‚æˆ‘ä»¬å¹³å°çš„æ„å»ºå—ç»“æ„å…è®¸åˆå¹¶é¢å¤–çš„åŠŸèƒ½ï¼Œä¾‹å¦‚çŠ¶æ€ã€æ“ä½œä»ªè¡¨æ¿æˆ–åœ°ç†å®šä½ã€‚ PubNub è¿˜ä½¿å…¶éå¸¸å®¹æ˜“æ‰©å±•ï¼Œç‰¹åˆ«æ˜¯ä¸ Socket.io æˆ– SocksJS ç­‰å¥—æ¥å­—æ¡†æ¶ç›¸æ¯”ã€‚\næ¦‚æ‹¬ æ€»è€Œè¨€ä¹‹ï¼ŒWebSocket æ˜¯ä¸€ç§éå¸¸æœ‰ç”¨çš„åè®®ï¼Œå¯ç”¨äºè·¨ Webã€ç§»åŠ¨å’Œæ¡Œé¢å˜ä½“æ„å»ºå®æ—¶åŠŸèƒ½ï¼Œä½†å®ƒä»¬å¹¶ä¸æ˜¯ä¸€ç§ä¸‡èƒ½çš„æ–¹æ³•ã€‚ WebSocket åªæ˜¯ä¸€ç§è½¯ä»¶å·¥å…·ï¼Œåœ¨å¼€å‘éœ€è¦ä½å»¶è¿Ÿçš„å®æ—¶ã€åŸºäºé€šä¿¡çš„åº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒå¯ä»¥èå…¥åˆ°æ›´å¤§çš„åº“ä¸­ã€‚å¯ä»¥åŸºäºåŸºæœ¬çš„ WebSocket åè®®æ„å»ºï¼Œç»“åˆ SSE æˆ–é•¿è½®è¯¢ç­‰å…¶ä»–æ–¹æ³•ï¼Œå¹¶æ„å»ºæ›´å¥½ã€æ›´å…·å¯æ‰©å±•æ€§çš„å®æ—¶åº”ç”¨ç¨‹åºã€‚é—®é¢˜æ˜¯ï¼Œå½“æ‚¨ä½¿ç”¨ WebSockets æ—¶ï¼Œå¦‚æœæ‚¨ä¸æ˜¯æ„å»ºå®æ—¶ç³»ç»Ÿçš„ä¸“å®¶ï¼Œè¿™äº›ç¼ºç‚¹å¯èƒ½å¾ˆéš¾ç®¡ç†ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2024/05/07/websockets/","summary":"åŸæ–‡é“¾æ¥ï¼šhttps://www.pubnub.com/guides/websockets/\nä»€ä¹ˆæ˜¯ WebSocketï¼Ÿ WebSocket æ˜¯ä¸€ç§é€šè¿‡å•ä¸ªTCPè¿æ¥æä¾›å…¨åŒå·¥é€šä¿¡é€šé“çš„é€šä¿¡åè®®ã€‚å®ƒæ”¯æŒå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„å®æ—¶ã€äº‹ä»¶é©±åŠ¨çš„è¿æ¥ã€‚\nä¸éµå¾ªè¯·æ±‚-å“åº”æ¨¡å‹çš„ä¼ ç»Ÿ HTTP è½¯ä»¶ä¸åŒï¼ŒWebSocket å…è®¸åŒå‘ï¼ˆåŒå‘ï¼‰é€šä¿¡ã€‚è¿™æ„å‘³ç€å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥éšæ—¶å‘å¯¹æ–¹å‘é€æ•°æ®ï¼Œè€Œæ— éœ€æŒç»­è½®è¯¢ã€‚\nWebSocket æœ‰ä½•ç”¨é€”ï¼Ÿ WebSocket ç”¨äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„å®æ—¶ã€äº‹ä»¶é©±åŠ¨çš„é€šä¿¡ã€‚å®ƒä»¬å¯¹äºæ„å»ºéœ€è¦å³æ—¶æ›´æ–°çš„è½¯ä»¶åº”ç”¨ç¨‹åºç‰¹åˆ«æœ‰ç”¨ï¼Œä¾‹å¦‚å®æ—¶èŠå¤©ã€æ¶ˆæ¯ä¼ é€’å’Œå¤šäººæ¸¸æˆã€‚\nåœ¨ä¼ ç»Ÿçš„ HTTP ä¸­ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨ç”¨è¯·æ±‚çš„æ•°æ®è¿›è¡Œå“åº”ã€‚è¿™ç§è¯·æ±‚-å“åº”æ¨¡å‹éœ€è¦ä»å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨è¿›è¡Œè¿ç»­è½®è¯¢ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´å»¶è¿Ÿå¢åŠ å’Œæ•ˆç‡é™ä½ã€‚\nå¦ä¸€æ–¹é¢ï¼ŒWebSockets åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹æŒä¹…è¿æ¥ã€‚è¿™æ„å‘³ç€ä¸€æ—¦å»ºç«‹è¿æ¥ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å°±å¯ä»¥éšæ—¶å‘å¯¹æ–¹å‘é€æ•°æ®ï¼Œè€Œæ— éœ€ä¸æ–­è½®è¯¢è¯·æ±‚ã€‚è¿™å…è®¸å®æ—¶é€šä¿¡ï¼Œå¯ä»¥ç«‹å³å‘é€å’Œæ¥æ”¶æ›´æ–°ã€‚\nä¾‹å¦‚ï¼Œå½“ç”¨æˆ·åœ¨èŠå¤©åº”ç”¨ç¨‹åºä¸­å‘é€æ¶ˆæ¯æ—¶ï¼Œè¯¥æ¶ˆæ¯å¯ä»¥ç«‹å³ä¼ é€’ç»™æ‰€æœ‰å…¶ä»–ç”¨æˆ·ï¼Œè€Œæ— éœ€åˆ·æ–°é¡µé¢æˆ–å‘å‡ºé¢‘ç¹çš„ HTTP è¯·æ±‚ã€‚è¿™å°†å¸¦æ¥æ›´åŠ æ— ç¼å’Œé«˜æ•ˆçš„ç”¨æˆ·ä½“éªŒã€‚\næ­¤å¤–ï¼ŒWeb Sockets è¿˜å…è®¸åŒå‘é€šä¿¡ï¼Œè¿™æ„å‘³ç€å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½å¯ä»¥ç›¸äº’å‘é€æ•°æ®ã€‚è¿™ä¸ºæ›´å…·äº¤äº’æ€§å’Œå¸å¼•åŠ›çš„åº”ç”¨ç¨‹åºæä¾›äº†å¯èƒ½æ€§ï¼Œå…¶ä¸­æœåŠ¡å™¨å¯ä»¥å¤„ç†å‘å®¢æˆ·ç«¯æ¨é€æ›´æ–°æˆ–é€šçŸ¥ï¼Œè€Œæ— éœ€å®¢æˆ·ç«¯æ˜ç¡®è¯·æ±‚å®ƒä»¬ã€‚\nWeb å¥—æ¥å­—çš„ç¼ºç‚¹ WebSocket çš„ç¼ºç‚¹åŒ…æ‹¬ï¼š\næµè§ˆå™¨æ”¯æŒï¼šè™½ç„¶å¤§å¤šæ•°ç°ä»£æµè§ˆå™¨æ”¯æŒ WebSocketï¼Œä½†ä¸€äº›æ—§æµè§ˆå™¨ä¸æ”¯æŒã€‚è¿™å¯èƒ½ä¼šé™åˆ¶åº”ç”¨ç¨‹åºçš„èŒƒå›´ï¼Œå¹¶ä¸”éœ€è¦é’ˆå¯¹æ—§ç‰ˆæµè§ˆå™¨çš„é¢å¤–åå¤‡æœºåˆ¶ã€‚ ä»£ç†å’Œé˜²ç«å¢™é™åˆ¶ï¼šæŸäº›ä»£ç†æœåŠ¡å™¨å’Œé˜²ç«å¢™å¯èƒ½ä¼šé˜»æ­¢æˆ–å¹²æ‰° WebSocket è¿æ¥ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´è¿æ¥é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨å®‰å…¨çš„å…¬å¸æˆ–å—é™çš„ç½‘ç»œç¯å¢ƒä¸­ã€‚ å¯æ‰©å±•æ€§ï¼šWeb Sockets åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ç»´æŠ¤æŒä¹…è¿æ¥ï¼Œè¿™åœ¨å¤„ç†è®¸å¤šå¹¶å‘è¿æ¥æ—¶å¯èƒ½ä¼šå¯¼è‡´æœåŠ¡å™¨èµ„æºç´§å¼ ã€‚å¿…é¡»å®æ–½é€‚å½“çš„è´Ÿè½½å¹³è¡¡å’Œèµ„æºç®¡ç†æŠ€æœ¯ä»¥ç¡®ä¿å¯æ‰©å±•æ€§ã€‚åƒ Socket.io è¿™æ ·çš„å¼€æºèµ„æºä¸é€‚åˆå¤§è§„æ¨¡è¿è¥æˆ–å¿«é€Ÿå¢é•¿ã€‚ æœ‰çŠ¶æ€æ€§ï¼šä¸æ— çŠ¶æ€çš„ä¼ ç»Ÿ HTTP ä¸åŒï¼ŒWebSocket æ˜¯æœ‰çŠ¶æ€çš„ã€‚è¿™æ„å‘³ç€æœåŠ¡å™¨éœ€è¦ç»´æŠ¤æ¯ä¸ªå®¢æˆ·ç«¯çš„è¿æ¥çŠ¶æ€ï¼Œä»è€Œå¯¼è‡´å†…å­˜ä½¿ç”¨é‡å¢åŠ å’Œæ½œåœ¨çš„å¯æ‰©å±•æ€§æŒ‘æˆ˜ã€‚ å®‰å…¨æ³¨æ„äº‹é¡¹ï¼šé€šè¿‡ WebSocket å»ºç«‹æŒä¹…è¿æ¥ï¼Œéœ€è¦é‡‡å–é€‚å½“çš„å®‰å…¨æªæ–½æ¥é˜²æ­¢æ½œåœ¨çš„æ¼æ´ï¼Œä¾‹å¦‚è·¨ç«™ç‚¹è„šæœ¬ (XSS) å’Œè·¨ç«™ç‚¹è¯·æ±‚ä¼ªé€ (CSRF)ã€‚åº”å®æ–½ä½¿ç”¨SSL/TLSåŠ å¯†çš„å®‰å…¨ WebSocket è¿æ¥ (wss://)ï¼Œä»¥ç¡®ä¿æ•°æ®éšç§å’Œå®Œæ•´æ€§ã€‚ å¦‚æœé€šè¿‡ Web å¥—æ¥å­—çš„è¿æ¥ä¸¢å¤±ï¼Œåˆ™ä¸åŒ…å«è´Ÿè½½å¹³è¡¡æˆ–é‡æ–°è¿æ¥æœºåˆ¶ã€‚ åœ¨å¯èƒ½ä¸æ”¯æŒ Web Sockets çš„ç¯å¢ƒä¸­ï¼Œä»ç„¶éœ€è¦æœ‰åå¤‡é€‰é¡¹ï¼Œä¾‹å¦‚HTTP æµæˆ–é•¿è½®è¯¢ã€‚ åƒPresenceè¿™æ ·çš„åŠŸèƒ½åœ¨ WebSocket è¿æ¥ä¸Šä¸èƒ½å¾ˆå¥½åœ°å·¥ä½œï¼Œå› ä¸ºæ–­å¼€è¿æ¥å¾ˆéš¾æ£€æµ‹åˆ°ã€‚ WebSocketsã€HTTPã€Web æœåŠ¡å™¨ã€è½®è¯¢ HTTP è¿æ¥ä¸ WebSockets è¦äº†è§£WebSocket APIï¼Œäº†è§£å…¶æ„å»ºåŸºç¡€ â€” HTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰åŠå…¶è¯·æ±‚/å“åº”æ¨¡å‹ä¹Ÿå¾ˆé‡è¦ã€‚ HTTP æ˜¯ä¸€ç§åº”ç”¨å±‚åè®®ï¼Œæ˜¯æ‰€æœ‰åŸºäº Web çš„é€šä¿¡å’Œæ•°æ®ä¼ è¾“çš„åŸºç¡€ã€‚\nä½¿ç”¨ HTTP æ—¶ï¼Œå®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ Web æµè§ˆå™¨ï¼‰å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œç„¶åæœåŠ¡å™¨å‘å›æ¶ˆæ¯ï¼ˆç§°ä¸ºå“åº”ï¼‰ã€‚æˆ‘ä»¬ä»Šå¤©æ‰€çŸ¥é“çš„ç½‘ç»œæ˜¯å»ºç«‹åœ¨è¿™ç§åŸºæœ¬çš„å®¢æˆ·ç«¯-æœåŠ¡å™¨å¾ªç¯ä¹‹ä¸Šçš„ï¼Œå°½ç®¡å¯¹ HTTP è¿›è¡Œäº†è®¸å¤šæ·»åŠ å’Œæ›´æ–°ä»¥ä½¿å…¶æ›´å…·äº¤äº’æ€§ã€‚å½“å‰æœ‰ä¸€äº›å¯è¡Œä¸”å—æ”¯æŒçš„ HTTP ç‰ˆæœ¬ï¼ˆHTTP/1.1 å’Œ HTTP/2ï¼‰ä»¥åŠç§°ä¸º HTTPS çš„å®‰å…¨ç‰ˆæœ¬ã€‚\nåŸºæœ¬ HTTP è¯·æ±‚é€‚ç”¨äºè®¸å¤šç”¨ä¾‹ï¼Œä¾‹å¦‚å½“æœ‰äººéœ€è¦åœ¨ç½‘é¡µä¸Šæœç´¢å¹¶æ¥æ”¶ç›¸å…³çš„ã€éæ—¶é—´æ•æ„Ÿçš„ä¿¡æ¯æ—¶ã€‚ç„¶è€Œï¼Œå®ƒå¹¶ä¸æ€»æ˜¯æœ€é€‚åˆéœ€è¦å®æ—¶é€šä¿¡æˆ–éœ€è¦ä»¥æœ€å°å»¶è¿Ÿå¿«é€Ÿæ›´æ–°çš„æ•°æ®çš„ Web åº”ç”¨ç¨‹åºã€‚\næ¯å½“å®¢æˆ·ç«¯å‘å‡ºæ–°çš„ HTTP æœåŠ¡å™¨è¯·æ±‚æ—¶ï¼Œé»˜è®¤è¡Œä¸ºæ˜¯æ‰“å¼€æ–°çš„ HTTP è¿æ¥ã€‚è¿™æ˜¯ä½æ•ˆçš„ï¼Œå› ä¸ºå®ƒä½¿ç”¨å¾ªç¯éæœ‰æ•ˆè´Ÿè½½æ•°æ®çš„å¸¦å®½å¹¶å¢åŠ äº†æ•°æ®ä¼ è¾“ä¹‹é—´çš„å»¶è¿Ÿã€‚\næ­¤å¤–ï¼ŒHTTP è¯·æ±‚åªèƒ½ä»å®¢æˆ·ç«¯å‘ä¸€ä¸ªæ–¹å‘æµåŠ¨ã€‚ä¼ ç»Ÿä¸Šæ²¡æœ‰æœåŠ¡å™¨å‘èµ·ä¸å®¢æˆ·ç«¯é€šä¿¡çš„æœºåˆ¶ã€‚é™¤éæœåŠ¡å™¨é¦–å…ˆè¯·æ±‚æ•°æ®ï¼Œå¦åˆ™æœåŠ¡å™¨æ— æ³•å‘å®¢æˆ·ç«¯å‘é€æ•°æ®ã€‚è¿™å¯èƒ½ä¼šç»™éœ€è¦ä»æœåŠ¡å™¨ç«¯å®æ—¶å‘å‡ºæ¶ˆæ¯çš„ç”¨ä¾‹å¸¦æ¥é—®é¢˜ã€‚\nçŸ­è½®è¯¢ä¸ WebSockets HTTP è½®è¯¢æ˜¯æ¥æ”¶å®šæœŸæ•°æ®æ›´æ–°çš„ç¬¬ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚è½®è¯¢æ˜¯ä¸€ç§å®¢æˆ·ç«¯é‡å¤å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ç›´åˆ°æœåŠ¡å™¨æ›´æ–°çš„æŠ€æœ¯ã€‚ä¾‹å¦‚ï¼Œæ‰€æœ‰ç°ä»£ Web æµè§ˆå™¨éƒ½æä¾›å¯¹ XMLHttpRequest çš„æ”¯æŒï¼Œè¿™æ˜¯è½®è¯¢æœåŠ¡å™¨çš„åŸå§‹æ–¹æ³•ä¹‹ä¸€ã€‚","title":"[è¯‘]ä»€ä¹ˆæ˜¯WebSocketï¼Ÿ"},{"content":"åŸæ–‡é“¾æ¥ï¼šhttps://www.pubnub.com/guides/long-polling/\nä»€ä¹ˆæ˜¯é•¿è½®è¯¢ï¼Ÿ é•¿è½®è¯¢ç”¨äºå®æ—¶ Web åº”ç”¨ç¨‹åºï¼Œä»¥å®ç°å®¢æˆ·ç«¯å’Œ Web æœåŠ¡å™¨ä¹‹é—´è¿‘ä¹å³æ—¶çš„é€šä¿¡ã€‚å®ƒåœ¨å®æ—¶æ›´æ–°è‡³å…³é‡è¦çš„èŠå¤©å’Œæ¶ˆæ¯åº”ç”¨ç¨‹åºä¸­ç‰¹åˆ«æœ‰ç”¨ã€‚\nåœ¨ä¼ ç»Ÿçš„HTTPé€šä¿¡ä¸­ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€æ–°è¯·æ±‚å¹¶ç­‰å¾…å“åº”ã€‚è¿™ç§°ä¸ºçŸ­è½®è¯¢ã€‚ç„¶è€Œï¼Œåœ¨å®æ—¶åœºæ™¯ä¸­ï¼ŒçŸ­è½®è¯¢å¯èƒ½æ•ˆç‡ä¸é«˜ï¼Œå› ä¸ºå®ƒéœ€è¦é¢‘ç¹å‘æœåŠ¡å™¨è¯·æ±‚ï¼Œå¯¼è‡´ä¸å¿…è¦çš„ç½‘ç»œå¼€é”€å’Œå¢åŠ å»¶è¿Ÿã€‚\nå¦ä¸€æ–¹é¢ï¼Œé•¿è½®è¯¢é€šè¿‡åœ¨æ–°æ•°æ®å¯ç”¨ä¹‹å‰ä¿æŒè¯·æ±‚é•¿æ—¶é—´æ‰“å¼€æ¥æé«˜æ•ˆç‡ã€‚æœåŠ¡å™¨ä¿æŒè¯·æ±‚æ‰“å¼€å¹¶ç­‰å¾…ï¼Œç›´åˆ°æœ‰æ–°ä¿¡æ¯å‘é€å›å®¢æˆ·ç«¯ã€‚ä¸€æ—¦æœåŠ¡å™¨æœ‰æ–°æ•°æ®ï¼Œå®ƒå°±ä¼šå“åº”å®¢æˆ·ç«¯ï¼Œç„¶åå®¢æˆ·ç«¯å¯ä»¥å¤„ç†æ•°æ®å¹¶å‘èµ·æ–°çš„é•¿è½®è¯¢è¯·æ±‚ã€‚\né€šè¿‡ç»´æŒå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é•¿æœŸè¿æ¥ï¼Œé•¿è½®è¯¢å‡å°‘äº†è¯·æ±‚æ•°é‡ï¼Œæœ€å¤§é™åº¦åœ°å‡å°‘äº†å»¶è¿Ÿï¼Œå¹¶æé«˜äº†å®æ—¶é€šä¿¡ã€‚è¿™ä½¿å¾—å®ƒéå¸¸é€‚åˆéœ€è¦æœ‰æ•ˆæŠ€æœ¯æ¥æ„å»ºå¯æ‰©å±•å’Œå“åº”å¼èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºä»¥åŠå…¶ä»–åˆ©ç”¨æ¸¸æˆç­‰å®æ—¶æ•°æ®çš„åº”ç”¨ç¨‹åºçš„ç”¨ä¾‹ã€‚\né•¿è½®è¯¢å¦‚ä½•å·¥ä½œï¼Ÿ é•¿è½®è¯¢æ˜¯ä¸€ç§ç”¨äºå®æ—¶é€šä¿¡çš„æŠ€æœ¯ï¼Œç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å®ç°è¿‘ä¹å³æ—¶çš„æ¶ˆæ¯ä¼ é€’ã€‚å®ƒåœ¨æ„å»ºä½å»¶è¿Ÿå’Œå®æ—¶æ›´æ–°è‡³å…³é‡è¦çš„èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºæ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚\nä¼ ç»Ÿä¸Šï¼ŒWeb æµè§ˆå™¨ä½¿ç”¨åŸºäºæ‹‰å–çš„æ–¹æ³•ä»æœåŠ¡å™¨è·å–æ•°æ®ã€‚å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨ä»¥è¯·æ±‚çš„æ•°æ®è¿›è¡Œå“åº”ã€‚è¿™ç§æ–¹æ³•ç§°ä¸ºçŸ­è½®è¯¢ï¼Œå¯èƒ½ä¼šé€ æˆé€šä¿¡å»¶è¿Ÿï¼Œå› ä¸ºå®¢æˆ·ç«¯å¿…é¡»é‡å¤å‘é€è¯·æ±‚æ¥æ£€æŸ¥æ›´æ–°ã€‚\nå¦ä¸€æ–¹é¢ï¼Œé•¿è½®è¯¢æ˜¯ä¸€ç§åŸºäºæ¨é€çš„æ–¹æ³•ï¼Œå…è®¸æœåŠ¡å™¨åœ¨æ›´æ–°å¯ç”¨æ—¶ç«‹å³å‘å®¢æˆ·ç«¯å‘é€æ›´æ–°ã€‚å®ƒçš„å·¥ä½œåŸç†å¦‚ä¸‹ï¼š\nå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œé€šå¸¸é€šè¿‡ HTTP è¯·æ±‚ã€‚ æœåŠ¡å™¨ä¸ä¼šç«‹å³å“åº”ï¼Œè€Œæ˜¯å°†è¯·æ±‚ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œä»è€Œä¿æŒè¿æ¥å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚ å¦‚æœæ²¡æœ‰æ–°æ•°æ®å¯ç”¨ï¼ŒæœåŠ¡å™¨å°†ç­‰å¾…ï¼Œç›´åˆ°æœ‰æ•°æ®è¦å‘å›ã€‚ ä¸€æ—¦æœåŠ¡å™¨æœ‰æ–°çš„æ•°æ®æˆ–è€…å‘ç”Ÿé¢„å®šä¹‰çš„è¶…æ—¶ï¼Œå®ƒå°±ä¼šç”¨æœ€æ–°çš„ä¿¡æ¯å“åº”å®¢æˆ·ç«¯ã€‚ å®¢æˆ·ç«¯æ”¶åˆ°å“åº”åï¼Œç«‹å³å‘æœåŠ¡å™¨å‘é€å¦ä¸€ä¸ªè¯·æ±‚ä»¥ç»´æŒè¿æ¥ã€‚ è¿™ç§å‘é€è¯·æ±‚å’Œæ¥æ”¶å“åº”çš„å¾ªç¯æŒç»­è¿›è¡Œï¼Œç¡®ä¿å®æ—¶æ›´æ–°ã€‚ é•¿è½®è¯¢é€šè¿‡é•¿æ—¶é—´ä¿æŒè¯·æ±‚-å“åº”å‘¨æœŸæ‰“å¼€æ¥æœ‰æ•ˆåœ°æ¨¡æ‹Ÿå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„å®æ—¶è¿æ¥ã€‚å®ƒå…è®¸æœåŠ¡å™¨åœ¨æ›´æ–°å¯ç”¨æ—¶ç«‹å³å°†æ›´æ–°æ¨é€åˆ°å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”æ— éœ€å®¢æˆ·ç«¯é‡å¤æ£€æŸ¥æ›´æ–°ã€‚\nä½¿ç”¨ä»€ä¹ˆæŠ€æœ¯æ¥å®ç°é•¿è½®è¯¢ï¼Ÿ é•¿è½®è¯¢æ˜¯ä¸€ç§å®ç°å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å®æ—¶é€šä¿¡çš„æŠ€æœ¯ã€‚å®ƒé€šå¸¸ç”¨äºå³æ—¶æ›´æ–°è‡³å…³é‡è¦çš„èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºã€‚å¯ä»¥ä½¿ç”¨å¤šç§æŠ€æœ¯æ¥å®ç°é•¿è½®è¯¢ï¼Œæ¯ç§æŠ€æœ¯éƒ½æœ‰ä¼˜ç‚¹å’Œæ³¨æ„äº‹é¡¹ã€‚è®©æˆ‘ä»¬æ¢è®¨ä¸€äº›ç”¨äºå®ç°é•¿è½®è¯¢çš„å¸¸ç”¨æŠ€æœ¯ã€‚\nHTTP é•¿è½®è¯¢ï¼š\nè¿™æ˜¯å®ç°é•¿è½®è¯¢çš„æœ€åŸºæœ¬ã€æœ€å¹¿æ³›ä½¿ç”¨çš„æ–¹æ³•ã€‚å®ƒåˆ©ç”¨ HTTP åè®®å»ºç«‹å¹¶ç»´æŠ¤å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é•¿æœŸè¿æ¥ã€‚å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨å°†è¯·æ±‚ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œç›´åˆ°æœ‰æ–°æ•°æ®å¯ç”¨æˆ–è¾¾åˆ°æŸä¸ªè¶…æ—¶ã€‚ä¸€æ—¦æœ‰æ–°æ•°æ®å¯ç”¨ï¼ŒæœåŠ¡å™¨å°±ä¼šç”¨æ›´æ–°çš„ä¿¡æ¯è¿›è¡Œå“åº”ï¼Œå®¢æˆ·ç«¯ç«‹å³å‘é€å¦ä¸€ä¸ªè¯·æ±‚ä»¥ç»§ç»­å¾ªç¯ã€‚è¿™ç§æ–¹æ³•æ˜“äºå®ç°ï¼Œä¸éœ€è¦ç‰¹æ®Šçš„æœåŠ¡å™¨ç«¯æŠ€æœ¯ã€‚\nç½‘ç»œå¥—æ¥å­—ï¼š\nWebSocket æ˜¯ä¸€ç§å…¨åŒå·¥é€šä¿¡åè®®ï¼Œå¯é€šè¿‡å•ä¸ªé•¿æœŸè¿æ¥åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å®ç°å®æ—¶é€šä¿¡ã€‚å®ƒæä¾›äº†æ¯”é•¿è½®è¯¢æ›´é«˜æ•ˆã€ä½å»¶è¿Ÿçš„æ›¿ä»£æ–¹æ¡ˆã€‚ WebSocket æ”¯æŒåŒå‘æ•°æ®æµï¼Œå…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¼‚æ­¥å‘é€æ¶ˆæ¯ã€‚å®ƒæ¶ˆé™¤äº†é¢‘ç¹çš„ HTTP è¯·æ±‚å¹¶å‡å°‘äº†ç½‘ç»œå¼€é”€ã€‚ WebSocket éå¸¸é€‚åˆéœ€è¦å³æ—¶æ›´æ–°å’Œå®æ—¶äº¤äº’çš„åº”ç”¨ç¨‹åºã€‚\næœåŠ¡å™¨å‘é€çš„äº‹ä»¶ (SSE)ï¼š\nSSE æ˜¯ä¸€ç§å•å‘é€šä¿¡æŠ€æœ¯ï¼Œå…è®¸æœåŠ¡å™¨é€šè¿‡å•ä¸ªé•¿æœŸ HTTP è¿æ¥å°†æ•°æ®æ¨é€åˆ°å®¢æˆ·ç«¯ã€‚é€šè¿‡SSEï¼ŒæœåŠ¡å™¨å¯ä»¥å‘å®¢æˆ·ç«¯å‘é€å¤šä¸ªæ›´æ–°ï¼Œè€Œä¸éœ€è¦å®¢æˆ·ç«¯ä¸æ–­åœ°å‘å‡ºè¯·æ±‚ã€‚æœåŠ¡å™¨å¯åŠ¨è¿æ¥å¹¶ä»¥ä¸€ç³»åˆ—äº‹ä»¶çš„å½¢å¼å‘é€æ•°æ®ã€‚å®¢æˆ·ç«¯æ¥æ”¶è¿™äº›äº‹ä»¶å¹¶å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œå¤„ç†ã€‚\nåœ¨é€‰æ‹©åœ¨åº”ç”¨ç¨‹åºä¸­å®ç°é•¿è½®è¯¢çš„æŠ€æœ¯æ—¶ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªå› ç´ ï¼š\nå¯æ‰©å±•æ€§ï¼šç¡®ä¿æ‰€é€‰æŠ€æœ¯å¯ä»¥å¤„ç†å¤§é‡å¹¶å‘è¿æ¥ï¼Œå¹¶ä¸”å¯ä»¥éšç€ç”¨æˆ·ç¾¤çš„å¢é•¿è€Œæ‰©å±•ã€‚ WebSocket å’Œ SSE é€šå¸¸æ¯”åŸºäº HTTP çš„é•¿è½®è¯¢æ›´å…·å¯æ‰©å±•æ€§ï¼Œå› ä¸ºå®ƒä»¬å…è®¸æ›´æœ‰æ•ˆåœ°ä½¿ç”¨æœåŠ¡å™¨èµ„æºã€‚ å®‰å…¨æ€§ï¼šè€ƒè™‘æ‰€é€‰æŠ€æœ¯çš„å®‰å…¨å½±å“ã€‚ WebSocket å’Œ SSE å¯ä»¥ä½¿ç”¨SSL/TLSç­‰åŠ å¯†åè®®è¿›è¡Œä¿æŠ¤ï¼Œä»è€Œç¡®ä¿æ•°æ®éšç§å’Œå®Œæ•´æ€§ã€‚åŸºäº HTTP çš„é•¿è½®è¯¢ä¹Ÿå¯ä»¥å¾—åˆ°ä¿æŠ¤ï¼Œä½†å¯èƒ½éœ€è¦é¢å¤–çš„èº«ä»½éªŒè¯å’Œè®¿é—®æ§åˆ¶æªæ–½ã€‚ æµè§ˆå™¨æ”¯æŒï¼šæ£€æŸ¥æ‰€é€‰æŠ€æœ¯çš„æµè§ˆå™¨å…¼å®¹æ€§ã€‚ WebSocket å’Œ SSE æ¯”åŸºäº HTTP çš„é•¿è½®è¯¢å…·æœ‰æ›´å¥½çš„æµè§ˆå™¨æ”¯æŒï¼Œè¿™å¯èƒ½éœ€è¦é¢å¤–çš„æŠ€æœ¯æˆ–é’ˆå¯¹æ—§æµè§ˆå™¨çš„åå¤‡é€‰é¡¹ã€‚ å®æ–½å¤æ‚æ€§ï¼šè¯„ä¼°æ‰€é€‰æŠ€æœ¯çš„å®æ–½å’Œç»´æŠ¤éš¾æ˜“ç¨‹åº¦ã€‚åŸºäº HTTP çš„é•¿è½®è¯¢ç›¸å¯¹ç®€å•ï¼Œè€Œ WebSocket å’Œ SSE å¯èƒ½éœ€è¦æ›´é«˜çº§çš„çŸ¥è¯†å’ŒåŸºç¡€è®¾æ–½ã€‚è€ƒè™‘å¼€å‘å›¢é˜Ÿå¯ç”¨çš„ä¸“ä¸šçŸ¥è¯†æ°´å¹³ä»¥åŠå®æ–½å’Œç»´æŠ¤æ‰€é€‰æŠ€æœ¯æ‰€éœ€çš„èµ„æºã€‚ é•¿è½®è¯¢ä¸ WebSockets é•¿è½®è¯¢å’Œ WebSocketæ˜¯åœ¨å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ Web æµè§ˆå™¨ï¼‰å’ŒæœåŠ¡å™¨ä¹‹é—´å®ç°å®æ—¶è¿æ¥çš„æŠ€æœ¯ã€‚å°½ç®¡å®ƒä»¬çš„ç›®çš„ç›¸ä¼¼ï¼Œä½†ä¸¤è€…å­˜åœ¨æ˜¾ç€å·®å¼‚ã€‚\né•¿è½®è¯¢æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œå®¢æˆ·ç«¯å‘ Web æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼ŒæœåŠ¡å™¨ä¿æŒè¿æ¥æ‰“å¼€ï¼Œç›´åˆ°æœ‰æ–°æ•°æ®è¦å‘å›ã€‚å¦‚æœæœåŠ¡å™¨æœ‰æ–°æ•°æ®å¯ç”¨ï¼Œåˆ™å¯ä»¥ç«‹å³å“åº”ï¼Œæˆ–è€…åœ¨å‘é€ç©ºå“åº”ä¹‹å‰ç­‰å¾…æŒ‡å®šçš„è¶…æ—¶æ—¶é—´ã€‚æ— è®ºå“ªç§æƒ…å†µï¼Œå®¢æˆ·ç«¯ä¸€æ—¦æ”¶åˆ°å“åº”ï¼Œå°±ä¼šç«‹å³å‘æœåŠ¡å™¨å‘å‡ºå¦ä¸€ä¸ªè¯·æ±‚ä»¥å»ºç«‹æ–°è¿æ¥ã€‚æ­¤è¿‡ç¨‹ä¸æ–­é‡å¤ï¼Œå…è®¸æœåŠ¡å™¨åœ¨æ›´æ–°å¯ç”¨æ—¶ç«‹å³å°†æ›´æ–°æ¨é€åˆ°å®¢æˆ·ç«¯ã€‚\nå¦ä¸€æ–¹é¢ï¼ŒWebSockets åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´æä¾›æŒä¹…çš„åŒå‘é€šä¿¡é€šé“ã€‚ä¸é•¿è½®è¯¢ä¸åŒçš„æ˜¯ï¼Œé•¿è½®è¯¢ä¼šä¸ºæ¯ä¸ªè¯·æ±‚å»ºç«‹ä¸€ä¸ªæ–°è¿æ¥ï¼Œè€Œ WebSocket è¿æ¥åªä¼šå»ºç«‹ä¸€æ¬¡å¹¶æ— é™æœŸåœ°ä¿æŒæ‰“å¼€çŠ¶æ€ã€‚è¿™å…è®¸åŒå‘å®æ—¶ã€ä½å»¶è¿Ÿé€šä¿¡ã€‚æœåŠ¡å™¨å¯ä»¥éšæ—¶å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®ï¼Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥ä¸ç­‰å¾…å“åº”å°±å‘æœåŠ¡å™¨å‘é€æ•°æ®ã€‚\né•¿è½®è¯¢å’Œ Web Sockets ä¹‹é—´çš„ç›¸ä¼¼ä¹‹å¤„ï¼š 1.å®æ—¶æ›´æ–°ï¼šé•¿è½®è¯¢å’ŒWebSocketséƒ½å¯ä»¥å®ç°æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„å®æ—¶é€šä¿¡ï¼Œå…è®¸å³æ—¶æ›´æ–°ï¼Œæ— éœ€è¿ç»­è½®è¯¢æˆ–åˆ·æ–°ã€‚\nå‡å°‘æœåŠ¡å™¨è´Ÿè½½ï¼šè¿™ä¸¤ç§æŠ€æœ¯éƒ½é€šè¿‡ä»…åœ¨æ•°æ®å¯ç”¨æ—¶å‘é€æ•°æ®æ¥æœ€å¤§ç¨‹åº¦åœ°å‡å°‘ä¸å¿…è¦çš„è¯·æ±‚ï¼Œä»è€Œå‡å°‘æœåŠ¡å™¨è´Ÿè½½å¹¶æé«˜å¯æ‰©å±•æ€§ã€‚ å¹¿æ³›çš„è¯­è¨€å’Œæ¡†æ¶æ”¯æŒï¼šè®¸å¤šæµè¡Œçš„ç¼–ç¨‹è¯­è¨€å’Œæ¡†æ¶éƒ½æ”¯æŒé•¿è½®è¯¢å’ŒWebSocketï¼Œä½¿ä¸åŒç”Ÿæ€ç³»ç»Ÿçš„å¼€å‘äººå‘˜éƒ½å¯ä»¥ä½¿ç”¨å®ƒä»¬ã€‚ é•¿è½®è¯¢å’Œ Web Sockets ä¹‹é—´çš„åŒºåˆ«ï¼š 1.å»¶è¿Ÿï¼šé•¿è½®è¯¢ä¼šå¼•å…¥å»¶è¿Ÿï¼Œå› ä¸ºæœåŠ¡å™¨å‘é€å“åº”å’Œå®¢æˆ·ç«¯æ¥æ”¶å“åº”ä¹‹é—´å­˜åœ¨å»¶è¿Ÿã€‚ WebSocket æä¾›åŒå‘ã€ä½å»¶è¿Ÿé€šä¿¡ï¼Œä»è€Œå®ç°æ›´å¿«çš„å®æ—¶åŠŸèƒ½ã€‚\n2.èµ„æºæ¶ˆè€—ï¼šé•¿è½®è¯¢éœ€è¦æœåŠ¡å™¨ä¸æ¯ä¸ªå®¢æˆ·ç«¯ä¿æŒå¼€æ”¾çš„è¿æ¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´èµ„æºæ¶ˆè€—å¹¶é™åˆ¶å¹¶å‘è¿æ¥æ•°ã€‚ç„¶è€Œï¼ŒWebSockets ä½¿ç”¨æŒä¹…è¿æ¥ï¼Œå‡å°‘äº†æ€»ä½“èµ„æºæ¶ˆè€—ã€‚\nå¯æ‰©å±•æ€§ï¼šé•¿è½®è¯¢éœ€è¦é•¿æ—¶é—´ä¿æŒè¿æ¥æ‰“å¼€ï¼Œè¿™å¯èƒ½ä¼šç»™æœåŠ¡å™¨çš„æ°´å¹³æ‰©å±•å¸¦æ¥æŒ‘æˆ˜ã€‚å‡­å€ŸæŒä¹…è¿æ¥ï¼ŒWebSocket å¯ä»¥å®ç°æ›´å¥½çš„å¯æ‰©å±•æ€§ï¼Œå› ä¸ºå®ƒä»¬ä¸éœ€è¦å¾ˆå¤šæ‰“å¼€çš„è¿æ¥ã€‚ é•¿è½®è¯¢å’Œ WebSocket éƒ½æä¾›å®æ—¶æ›´æ–°å¹¶å‡å°‘æœåŠ¡å™¨è´Ÿè½½ï¼Œä½†å®ƒä»¬åœ¨å»¶è¿Ÿã€èµ„æºæ¶ˆè€—å’Œå¯æ‰©å±•æ€§æ–¹é¢æœ‰æ‰€ä¸åŒã€‚ Web å¥—æ¥å­—æä¾›æ›´å¿«çš„åŒå‘é€šä¿¡ï¼ŒåŒæ—¶å‡å°‘èµ„æºæ¶ˆè€—ï¼Œä½¿å…¶é€‚åˆéœ€è¦ä½å»¶è¿Ÿå’Œé«˜å¯æ‰©å±•æ€§çš„åº”ç”¨ç¨‹åºã€‚å¦ä¸€æ–¹é¢ï¼Œå½“ä½å»¶è¿Ÿå¹¶ä¸é‡è¦ä¸”å¹¶å‘è¿æ¥æ•°ç›¸å¯¹è¾ƒå°æ—¶ï¼Œé•¿è½®è¯¢å¯èƒ½æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚å¼€å‘äººå‘˜åœ¨ä¸ºå®æ—¶èŠå¤©å’Œæ¶ˆæ¯åº”ç”¨ç¨‹åºé€‰æ‹©ä¸¤ç§æŠ€æœ¯æ—¶åº”è€ƒè™‘è¿™äº›å› ç´ ã€‚\né•¿è½®è¯¢ä¸æœåŠ¡å™¨å‘é€äº‹ä»¶ (SSE) SSEåœ¨ç®€å•æ€§å’Œæ˜“äºå®ç°æ–¹é¢ä¸é•¿è½®è¯¢ç±»ä¼¼ï¼Œä½†å®ƒæä¾›äº†ä¸€ç§æ›´é«˜æ•ˆã€æ›´æ ‡å‡†åŒ–çš„æ–¹å¼æ¥å®ç°æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„é€šä¿¡ã€‚è®©æˆ‘ä»¬çœ‹çœ‹è¿™ä¸¤ç§æŠ€æœ¯ä¹‹é—´çš„ä¸€äº›å…¶ä»–ç›¸ä¼¼ç‚¹å’Œä¸åŒç‚¹ã€‚\né•¿è½®è¯¢å’Œ SSE çš„ç›¸ä¼¼ä¹‹å¤„ï¼š å®æ—¶æ›´æ–°ï¼šé•¿è½®è¯¢å’ŒSSEéƒ½å¯ä»¥å®ç°æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„å®æ—¶é€šä¿¡ï¼Œå…è®¸å³æ—¶æ›´æ–°ï¼Œæ— éœ€æŒç»­è½®è¯¢æˆ–åˆ·æ–°ã€‚ å‡å°‘æœåŠ¡å™¨è´Ÿè½½ï¼šè¿™ä¸¤ç§æŠ€æœ¯éƒ½é€šè¿‡ä»…åœ¨æ•°æ®å¯ç”¨æ—¶å‘é€æ•°æ®æ¥æœ€å¤§ç¨‹åº¦åœ°å‡å°‘ä¸å¿…è¦çš„è¯·æ±‚ï¼Œä»è€Œå‡å°‘æœåŠ¡å™¨è´Ÿè½½å¹¶æé«˜å¯æ‰©å±•æ€§ã€‚ å¹¿æ³›çš„è¯­è¨€å’Œæ¡†æ¶æ”¯æŒï¼šè®¸å¤šæµè¡Œçš„ç¼–ç¨‹è¯­è¨€å’Œæ¡†æ¶éƒ½æ”¯æŒé•¿è½®è¯¢å’ŒSSEï¼Œä½¿ä¸åŒç”Ÿæ€ç³»ç»Ÿçš„å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨å®ƒä»¬ã€‚ é•¿è½®è¯¢å’ŒSSEçš„åŒºåˆ«ï¼š å»¶è¿Ÿï¼šé•¿è½®è¯¢ä¼šå¼•å…¥å»¶è¿Ÿï¼Œå› ä¸ºæœåŠ¡å™¨å‘é€å“åº”å’Œå®¢æˆ·ç«¯æ¥æ”¶å“åº”ä¹‹é—´å­˜åœ¨å»¶è¿Ÿã€‚å¦ä¸€æ–¹é¢ï¼ŒSSEæä¾›ä»æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„è¿ç»­æ•°æ®æµï¼Œå‡å°‘å»¶è¿Ÿå¹¶æé«˜å®æ—¶èƒ½åŠ›ã€‚ èµ„æºæ¶ˆè€—ï¼šé•¿è½®è¯¢è¦æ±‚æœåŠ¡å™¨ä¸æ¯ä¸ªå®¢æˆ·ç«¯ä¿æŒæ‰“å¼€çš„è¿æ¥ï¼Œå¯èƒ½ä¼šå¯¼è‡´èµ„æºæ¶ˆè€—å¹¶é™åˆ¶å¹¶å‘è¿æ¥æ•°ã€‚ç„¶è€Œï¼ŒSSE ä½¿ç”¨å•ä¸ªé•¿æœŸè¿æ¥ï¼Œå‡å°‘äº†æ€»ä½“èµ„æºæ¶ˆè€—ã€‚ å¯æ‰©å±•æ€§ï¼šé•¿è½®è¯¢éœ€è¦é•¿æ—¶é—´ä¿æŒè¿æ¥æ‰“å¼€ï¼Œè¿™å¯èƒ½ä¼šç»™æœåŠ¡å™¨çš„æ°´å¹³æ‰©å±•å¸¦æ¥æŒ‘æˆ˜ã€‚ç”±äºæ¯ä¸ªå®¢æˆ·ç«¯åªæœ‰ä¸€ä¸ªè¿æ¥ï¼ŒSSE ä¸éœ€è¦è®¸å¤šæ‰“å¼€çš„è¿æ¥ï¼Œå› æ­¤å¯ä»¥å®ç°æ›´å¥½çš„å¯æ‰©å±•æ€§ã€‚ å¦‚ä½•ä¼˜åŒ–é•¿è½®è¯¢ï¼Ÿ é•¿è½®è¯¢ç”¨äºå®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºï¼Œä»¥æä¾›è¿‘ä¹å³æ—¶çš„å®¢æˆ·ç«¯æ›´æ–°ã€‚ä½†æ˜¯ï¼Œå¦‚æœä¼˜åŒ–ä¸å½“ï¼Œå®ƒå¯èƒ½ä¼šå ç”¨èµ„æºå¹¶å¯¼è‡´å¯æ‰©å±•æ€§é—®é¢˜ã€‚ä»¥ä¸‹æ˜¯å¯ç”¨äºä¼˜åŒ–é•¿è½®è¯¢ä»¥è·å¾—æ›´å¥½æ€§èƒ½å’Œå¯æ‰©å±•æ€§çš„å‡ ç§æŠ€æœ¯ã€‚\n**æ‰¹é‡å“åº”ï¼š**ä¸æ˜¯ä¸ºæ¯ä¸ªè¯·æ±‚å‘é€å“åº”ï¼Œè€Œæ˜¯[å°†å¤šä¸ªæ›´æ–°ä¸€èµ·æ‰¹å¤„ç†](https://developers.google.com/classroom/best-practices/batch#:~:text=separate HTTP request.-,Response to a batch request,same order as the requests.)å¹¶åœ¨å•ä¸ªå“åº”ä¸­å‘é€å®ƒä»¬ã€‚è¿™å‡å°‘äº† HTTP è¯·æ±‚çš„æ•°é‡å¹¶æœ‰åŠ©äºæœ€å¤§é™åº¦åœ°å‡å°‘å¼€é”€ã€‚\n**å‹ç¼©ï¼š**åœ¨é€šè¿‡ç½‘ç»œå‘é€æ•°æ®ä¹‹å‰å¯¹å…¶è¿›è¡Œå‹ç¼©å¯ä»¥æ˜¾ç€å‡å°‘æœ‰æ•ˆè´Ÿè½½å¤§å°ï¼Œä»è€ŒåŠ å¿«ä¼ è¾“é€Ÿåº¦å¹¶é™ä½å¸¦å®½æ¶ˆè€—ã€‚Gzip å‹ç¼©ç­‰æŠ€æœ¯å¯ç”¨äºå®ç°æ­¤ç›®çš„ã€‚\n**ç¼“å­˜ï¼š**å®ç°ç¼“å­˜å±‚å¯ä»¥å¸®åŠ©å‡å°‘æ•°æ®åº“æˆ–å…¶ä»–æ•°æ®æºçš„è´Ÿè½½ã€‚é€šè¿‡ç¼“å­˜é¢‘ç¹è¯·æ±‚çš„æ•°æ®ï¼Œåç»­è¯·æ±‚å¯ä»¥ä»ç¼“å­˜æœ¬èº«å¾—åˆ°æœåŠ¡ï¼Œä»è€Œå‡å°‘å“åº”æ—¶é—´å¹¶æé«˜å¯æ‰©å±•æ€§ã€‚\n**è¿æ¥æ± ï¼š**ç»´æŠ¤ä¸€ä¸ªå¯é‡ç”¨è¿æ¥æ± ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ä¸ªè¯·æ±‚åˆ›å»ºä¸€ä¸ªæ–°è¿æ¥ï¼Œå¯ä»¥æé«˜é•¿è½®è¯¢æœºåˆ¶çš„æ•ˆç‡ã€‚è¿™æ¶ˆé™¤äº†ä¸ºæ¯ä¸ªè¯·æ±‚å»ºç«‹æ–°è¿æ¥çš„å¼€é”€ï¼Œä»è€Œè·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚\n**èŠ‚æµå’Œé€Ÿç‡é™åˆ¶ï¼š**å®æ–½èŠ‚æµå’Œé€Ÿç‡é™åˆ¶æœºåˆ¶å¯ä»¥é˜²æ­¢è¿‡å¤šçš„è¯·æ±‚å‹å®æœåŠ¡å™¨ã€‚è¿™å¯ç¡®ä¿å…¬å¹³çš„èµ„æºåˆ†é…å¹¶é˜²æ­¢æ»¥ç”¨ï¼Œä»è€Œæé«˜æ€§èƒ½å’Œå¯æ‰©å±•æ€§ã€‚\nè´Ÿè½½å¹³è¡¡**ï¼š**ä½¿ç”¨è´Ÿè½½å¹³è¡¡æŠ€æœ¯åœ¨å¤šä¸ªæœåŠ¡å™¨ä¹‹é—´åˆ†é…ä¼ å…¥è¯·æ±‚å¯ä»¥å¸®åŠ©åˆ†é…è´Ÿè½½å¹¶é˜²æ­¢ä»»ä½•å•ä¸ªæœåŠ¡å™¨ä¸å ªé‡è´Ÿã€‚è¿™æé«˜äº†é•¿è½®è¯¢ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½å’Œå¯æ‰©å±•æ€§ã€‚\n**ç›‘æ§å’Œä¼˜åŒ–ï¼š**å®šæœŸç›‘æ§é•¿è½®è¯¢ç³»ç»Ÿçš„æ€§èƒ½å¹¶è¯†åˆ«ä»»ä½•ç“¶é¢ˆæˆ–æ”¹è¿›é¢†åŸŸå¯ä»¥å¸®åŠ©ä¼˜åŒ–ç³»ç»Ÿä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§ã€‚åˆ†æã€è´Ÿè½½æµ‹è¯•å’Œæ€§èƒ½è°ƒæ•´ç­‰æŠ€æœ¯å¯ç”¨äºè¯†åˆ«å’Œè§£å†³ä»»ä½•æ€§èƒ½é—®é¢˜ã€‚\n**å¼‚æ­¥ï¼ˆAsyncï¼‰å¤„ç†ï¼š**å°†è€—æ—¶çš„ä»»åŠ¡å¸è½½ç»™å¼‚æ­¥è¿›ç¨‹æˆ–åå°å·¥ä½œäººå‘˜å¯ä»¥å¸®åŠ©é‡Šæ”¾èµ„æºå¹¶æé«˜é•¿è½®è¯¢ç³»ç»Ÿçš„å“åº”èƒ½åŠ›ã€‚æ‚¨å¯ä»¥é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ã€å·¥ä½œè¿›ç¨‹æˆ–åˆ†å¸ƒå¼è®¡ç®—æ¥è·å–æ­¤ä¿¡æ¯ã€‚\n**è¿æ¥è¶…æ—¶ï¼š**å®æ–½é€‚å½“çš„è¿æ¥è¶…æ—¶æœ‰åŠ©äºé˜²æ­¢ç©ºé—²è¿æ¥æ¶ˆè€—ä¸å¿…è¦çš„èµ„æºã€‚é€šè¿‡åœ¨ä¸€æ®µæ—¶é—´ä¸æ´»åŠ¨åå…³é—­ç©ºé—²è¿æ¥ï¼Œç³»ç»Ÿå¯ä»¥ä¸ºå…¶ä»–å®¢æˆ·ç«¯é‡Šæ”¾èµ„æºå¹¶æé«˜å¯æ‰©å±•æ€§ã€‚\n**å¯æ‰©å±•çš„åŸºç¡€è®¾æ–½ï¼š**ç¡®ä¿åº•å±‚åŸºç¡€è®¾æ–½å¯æ‰©å±•å¹¶ä¸”èƒ½å¤Ÿå¤„ç†é¢„æœŸçš„è´Ÿè½½å¯¹äºä¼˜åŒ–é•¿è½®è¯¢è‡³å…³é‡è¦ã€‚è¿™å¯èƒ½æ¶‰åŠä½¿ç”¨äº‘è®¡ç®—ã€è‡ªåŠ¨æ‰©å±•æˆ–å®¹å™¨åŒ–ç­‰æŠ€æœ¯æ¥æ ¹æ®éœ€æ±‚åŠ¨æ€åˆ†é…èµ„æºã€‚\nå“ªäº›ç¼–ç¨‹è¯­è¨€ä¸é•¿è½®è¯¢å…¼å®¹ï¼Ÿ å¤šç§ç¼–ç¨‹è¯­è¨€ä¸åœ¨å®æ—¶èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºä¸­å®ç°é•¿è½®è¯¢å…¼å®¹ã€‚è¿™é‡Œæœ‰ä¸€äº›ä¾‹å­ï¼š\nJavaScriptï¼šé•¿è½®è¯¢é€šå¸¸ä¸JavaScriptç»“åˆä½¿ç”¨ï¼Œå…è®¸æ— ç¼çš„å®¢æˆ·ç«¯å®ç°ã€‚Reactã€Angular å’ŒVue.jsç­‰JavaScriptæ¡†æ¶æä¾›äº†å¯ç®€åŒ–åº”ç”¨ç¨‹åºä¸­é•¿è½®è¯¢å®ç°çš„åº“å’Œå·¥å…·ã€‚ PHPï¼šPHPæ˜¯ä¸€ç§æµè¡Œçš„æœåŠ¡å™¨ç«¯è¯­è¨€ï¼Œç»å¸¸ç”¨äº Web å¼€å‘ã€‚å®ƒæä¾›çš„åŠŸèƒ½å’Œåº“ä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿæœ‰æ•ˆåœ°å®ç°é•¿è½®è¯¢ã€‚ä¾‹å¦‚ï¼ŒPHP æ¡†æ¶ Laravel é€šè¿‡å…¶äº‹ä»¶å¹¿æ’­ç³»ç»Ÿæä¾›å¯¹é•¿è½®è¯¢çš„æ”¯æŒã€‚ Pythonï¼šPythonæ˜¯å¦ä¸€ç§é€šç”¨è¯­è¨€ï¼Œå¯ç”¨äºå®ç°é•¿è½®è¯¢ã€‚ Django å’Œ Flask ç­‰ Python æ¡†æ¶æä¾›äº†ä½¿ç”¨é•¿è½®è¯¢æŠ€æœ¯æ„å»ºå®æ—¶åº”ç”¨ç¨‹åºçš„å·¥å…·å’Œåº“ã€‚ Rubyï¼šRubyæ˜¯ä¸€ç§åŠ¨æ€çš„ã€é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ï¼Œéå¸¸é€‚åˆ Web å¼€å‘ã€‚æµè¡Œçš„ Web æ¡†æ¶Ruby on Railsæ”¯æŒé€šè¿‡å„ç§åº“å’Œæ‰©å±•è¿›è¡Œé•¿è½®è¯¢ã€‚ Javaï¼šJavaæ˜¯ä¼ä¸šå¼€å‘ä¸­å¹¿æ³›ä½¿ç”¨çš„è¯­è¨€ï¼Œæä¾›é•¿è½®è¯¢çš„æ”¯æŒã€‚ Spring å’Œ Java EE ç­‰ Java æ¡†æ¶æä¾›äº†ç”¨äºåœ¨å®æ—¶åº”ç”¨ç¨‹åºä¸­å®ç°é•¿è½®è¯¢çš„åº“å’Œå·¥å…·ã€‚ .NET/C#ï¼š. NET æ¡†æ¶åŠå…¶ç¼–ç¨‹è¯­è¨€ C#é€šå¸¸ç”¨äºæ„å»º Web åº”ç”¨ç¨‹åºã€‚å®ƒæä¾›äº† ASP.NET SignalRç­‰åº“å’Œæ¡†æ¶ï¼Œå¯ç®€åŒ–é•¿è½®è¯¢æŠ€æœ¯çš„å®ç°ã€‚ è¿™äº›åªæ˜¯æ”¯æŒé•¿è½®è¯¢çš„ç¼–ç¨‹è¯­è¨€çš„å‡ ä¸ªç¤ºä¾‹ã€‚è®¸å¤šå…¶ä»–è¯­è¨€å’Œæ¡†æ¶ä¹Ÿå¯ä»¥åœ¨å®æ—¶èŠå¤©å’Œæ¶ˆæ¯åº”ç”¨ç¨‹åºä¸­å®ç°é•¿è½®è¯¢ã€‚\nåœ¨é€‰æ‹©ç”¨äºå®ç°é•¿è½®è¯¢çš„ç¼–ç¨‹è¯­è¨€æ—¶ï¼Œéœ€è¦è€ƒè™‘å‡ ä¸ªå› ç´ ã€‚é¦–å…ˆï¼Œè€ƒè™‘æ‚¨çš„åº”ç”¨ç¨‹åºçš„å…·ä½“è¦æ±‚å¹¶é€‰æ‹©æœ€é€‚åˆè¿™äº›è¦æ±‚çš„è¯­è¨€ã€‚è€ƒè™‘åç«¯çš„å¯æ‰©å±•æ€§ã€æ€§èƒ½å’Œæ˜“äºå®æ–½æ€§ã€‚\næ­¤å¤–ï¼Œè¯·è€ƒè™‘å›´ç»•ç¼–ç¨‹è¯­è¨€çš„ç¤¾åŒºå’Œç”Ÿæ€ç³»ç»Ÿã€‚å¼ºå¤§è€Œæ´»è·ƒçš„ç¤¾åŒºå¯ä»¥æä¾›æ”¯æŒã€æ•™ç¨‹ã€æ–‡æ¡£å’Œèµ„æºï¼Œä½¿æ‚¨çš„åº”ç”¨ç¨‹åºä¸­çš„é•¿è½®è¯¢å®ç°å˜å¾—æ›´åŠ å®¹æ˜“ã€‚\né•¿è½®è¯¢åœ¨å®æ—¶åº”ç”¨ä¸­å¦‚ä½•ä½¿ç”¨ï¼Ÿ é•¿è½®è¯¢çš„ä¸»è¦ä¼˜ç‚¹ä¹‹ä¸€æ˜¯å…¶æä¾›å®æ—¶æ›´æ–°çš„æ•ˆç‡ã€‚æœ€å¤§é™åº¦åœ°å‡å°‘å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚æ•°é‡å¯æ˜¾ç€é™ä½ç½‘ç»œå»¶è¿Ÿå¹¶æé«˜æ•´ä½“æ€§èƒ½ã€‚æ­¤å¤–ï¼Œå®ƒå…è®¸æœåŠ¡å™¨ç«‹å³å‘å®¢æˆ·ç«¯æ¨é€æ›´æ–°ï¼Œç¡®ä¿æ¶ˆæ¯å’Œé€šçŸ¥åŠæ—¶ä¼ é€’ã€‚\næ­¤å¤–ï¼Œé•¿è½®è¯¢æœ‰åˆ©äºå®æ—¶åº”ç”¨ç¨‹åºçš„å¯æ‰©å±•æ€§ã€‚å‡å°‘æ‰“å¼€è¿æ¥çš„æ•°é‡ä½¿æœåŠ¡å™¨èƒ½å¤Ÿå¤„ç†æ›´å¤šå¹¶å‘å®¢æˆ·ç«¯ã€‚è¿™åœ¨ç”¨æˆ·æ•°é‡ä¸æ–­æ³¢åŠ¨çš„èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºä¸­å°¤å…¶é‡è¦ã€‚\né•¿è½®è¯¢æœ‰åŠ©äºèŠ‚çœç³»ç»Ÿèµ„æºã€‚ä½¿ç”¨ä¼ ç»Ÿçš„è½®è¯¢ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦æœåŠ¡å™¨å¤„ç†å’Œå“åº”ï¼Œå³ä½¿æ²¡æœ‰æ›´æ–°ã€‚è¿™ç§æŒç»­çš„å¤„ç†å¯èƒ½ä¼šä½¿æœåŠ¡å™¨èµ„æºç´§å¼ å¹¶å¯¹æ€§èƒ½äº§ç”Ÿè´Ÿé¢å½±å“ã€‚ç›¸åï¼Œé•¿è½®è¯¢ä»…åœ¨æœ‰æ–°æ•°æ®å¯ç”¨æˆ–å‘ç”Ÿè¶…æ—¶æ—¶è§¦å‘æœåŠ¡å™¨å¤„ç†ã€‚è¿™æœ€å¤§é™åº¦åœ°å‡å°‘äº†ç³»ç»Ÿèµ„æºçš„å‹åŠ›ï¼Œå¹¶å®ç°äº†æ›´å¥½çš„å¯æ‰©å±•æ€§å’Œå¯é æ€§ã€‚\nç„¶è€Œï¼Œå®æ–½é•¿è½®è¯¢ä¹Ÿä¼šå¸¦æ¥ä¸€äº›æŒ‘æˆ˜ã€‚ä¸€é¡¹æŒ‘æˆ˜æ˜¯æœ‰æ•ˆç®¡ç†æœåŠ¡å™¨èµ„æºã€‚ç”±äºé•¿è½®è¯¢æ¶‰åŠé•¿æ—¶é—´ä¿æŒè¿æ¥æ‰“å¼€ï¼Œå› æ­¤å¤„ç†å¤šä¸ªå¹¶å‘è¿æ¥éœ€è¦å¤§é‡æœåŠ¡å™¨èµ„æºã€‚è¿™å¯ä»¥é€šè¿‡ä½¿ç”¨äº‘è®¡ç®—ã€è‡ªåŠ¨æ‰©å±•æˆ–å®¹å™¨åŒ–ç­‰æŠ€æœ¯æ¥æ ¹æ®éœ€æ±‚åŠ¨æ€åˆ†é…èµ„æºæ¥è§£å†³ã€‚é€šè¿‡æ ¹æ®æ´»åŠ¨è¿æ¥æ•°é‡è‡ªåŠ¨æ‰©å±•æˆ–ç¼©å‡èµ„æºï¼Œå¼€å‘äººå‘˜å¯ä»¥ç¡®ä¿æœåŠ¡å™¨èƒ½å¤Ÿæœ‰æ•ˆåœ°å¤„ç†é¢„æœŸè´Ÿè½½ã€‚\nå¦ä¸€ä¸ªæŒ‘æˆ˜æ˜¯å¤„ç†è¶…æ—¶å’Œè¿æ¥å¤±è´¥ã€‚åœ¨é•¿è½®è¯¢ä¸­ï¼ŒæœåŠ¡å™¨ä¿æŒè¯·æ±‚æ‰“å¼€ï¼Œç›´åˆ°æœ‰æ–°æ•°æ®å¯ç”¨æˆ–å‘ç”Ÿè¶…æ—¶ã€‚å¦‚æœå‘ç”Ÿè¶…æ—¶ï¼ŒæœåŠ¡å™¨å¿…é¡»å¦¥å–„å¤„ç†å¹¶å…³é—­è¿æ¥ä»¥é‡Šæ”¾èµ„æºã€‚æ­¤å¤–ï¼Œå¦‚æœè¿æ¥å¤±è´¥ï¼ŒæœåŠ¡å™¨åº”è¯¥èƒ½å¤Ÿæ£€æµ‹åˆ°å®ƒå¹¶é€‚å½“åœ°å¤„ç†é‡æ–°è¿æ¥å°è¯•ã€‚é€šè¿‡å®ç°å¼ºå¤§çš„é”™è¯¯å¤„ç†å’Œè¿æ¥ç®¡ç†æœºåˆ¶ï¼Œå¼€å‘äººå‘˜å¯ä»¥ç¡®ä¿å®æ—¶åº”ç”¨ç¨‹åºä¸­é•¿è½®è¯¢çš„å¯é æ€§ã€‚\nåœ¨å®æ—¶åº”ç”¨ç¨‹åºä¸­å®ç°é•¿è½®è¯¢æ—¶ï¼Œå®‰å…¨æ€§æ˜¯å¦ä¸€ä¸ªé‡è¦çš„è€ƒè™‘å› ç´ ã€‚ç”±äºé•¿è½®è¯¢æ¶‰åŠç»´æŠ¤å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æŒä¹…è¿æ¥ï¼Œå› æ­¤ä¿æŠ¤è¿™äº›è¿æ¥ä»¥ä¿æŠ¤æ•æ„Ÿæ•°æ®è‡³å…³é‡è¦ã€‚å®æ–½å®‰å…¨å¥—æ¥å­—å±‚ (SSL) æˆ–ä¼ è¾“å±‚å®‰å…¨ (TLS) åè®®å¯ä»¥å¸®åŠ©åŠ å¯†é€šè¿‡é•¿è½®è¯¢è¿æ¥ä¼ è¾“çš„æ•°æ®ï¼Œå¹¶é˜²æ­¢çªƒå¬æˆ–æœªç»æˆæƒçš„è®¿é—®ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2024/05/07/long-polling/","summary":"åŸæ–‡é“¾æ¥ï¼šhttps://www.pubnub.com/guides/long-polling/\nä»€ä¹ˆæ˜¯é•¿è½®è¯¢ï¼Ÿ é•¿è½®è¯¢ç”¨äºå®æ—¶ Web åº”ç”¨ç¨‹åºï¼Œä»¥å®ç°å®¢æˆ·ç«¯å’Œ Web æœåŠ¡å™¨ä¹‹é—´è¿‘ä¹å³æ—¶çš„é€šä¿¡ã€‚å®ƒåœ¨å®æ—¶æ›´æ–°è‡³å…³é‡è¦çš„èŠå¤©å’Œæ¶ˆæ¯åº”ç”¨ç¨‹åºä¸­ç‰¹åˆ«æœ‰ç”¨ã€‚\nåœ¨ä¼ ç»Ÿçš„HTTPé€šä¿¡ä¸­ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€æ–°è¯·æ±‚å¹¶ç­‰å¾…å“åº”ã€‚è¿™ç§°ä¸ºçŸ­è½®è¯¢ã€‚ç„¶è€Œï¼Œåœ¨å®æ—¶åœºæ™¯ä¸­ï¼ŒçŸ­è½®è¯¢å¯èƒ½æ•ˆç‡ä¸é«˜ï¼Œå› ä¸ºå®ƒéœ€è¦é¢‘ç¹å‘æœåŠ¡å™¨è¯·æ±‚ï¼Œå¯¼è‡´ä¸å¿…è¦çš„ç½‘ç»œå¼€é”€å’Œå¢åŠ å»¶è¿Ÿã€‚\nå¦ä¸€æ–¹é¢ï¼Œé•¿è½®è¯¢é€šè¿‡åœ¨æ–°æ•°æ®å¯ç”¨ä¹‹å‰ä¿æŒè¯·æ±‚é•¿æ—¶é—´æ‰“å¼€æ¥æé«˜æ•ˆç‡ã€‚æœåŠ¡å™¨ä¿æŒè¯·æ±‚æ‰“å¼€å¹¶ç­‰å¾…ï¼Œç›´åˆ°æœ‰æ–°ä¿¡æ¯å‘é€å›å®¢æˆ·ç«¯ã€‚ä¸€æ—¦æœåŠ¡å™¨æœ‰æ–°æ•°æ®ï¼Œå®ƒå°±ä¼šå“åº”å®¢æˆ·ç«¯ï¼Œç„¶åå®¢æˆ·ç«¯å¯ä»¥å¤„ç†æ•°æ®å¹¶å‘èµ·æ–°çš„é•¿è½®è¯¢è¯·æ±‚ã€‚\né€šè¿‡ç»´æŒå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é•¿æœŸè¿æ¥ï¼Œé•¿è½®è¯¢å‡å°‘äº†è¯·æ±‚æ•°é‡ï¼Œæœ€å¤§é™åº¦åœ°å‡å°‘äº†å»¶è¿Ÿï¼Œå¹¶æé«˜äº†å®æ—¶é€šä¿¡ã€‚è¿™ä½¿å¾—å®ƒéå¸¸é€‚åˆéœ€è¦æœ‰æ•ˆæŠ€æœ¯æ¥æ„å»ºå¯æ‰©å±•å’Œå“åº”å¼èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºä»¥åŠå…¶ä»–åˆ©ç”¨æ¸¸æˆç­‰å®æ—¶æ•°æ®çš„åº”ç”¨ç¨‹åºçš„ç”¨ä¾‹ã€‚\né•¿è½®è¯¢å¦‚ä½•å·¥ä½œï¼Ÿ é•¿è½®è¯¢æ˜¯ä¸€ç§ç”¨äºå®æ—¶é€šä¿¡çš„æŠ€æœ¯ï¼Œç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å®ç°è¿‘ä¹å³æ—¶çš„æ¶ˆæ¯ä¼ é€’ã€‚å®ƒåœ¨æ„å»ºä½å»¶è¿Ÿå’Œå®æ—¶æ›´æ–°è‡³å…³é‡è¦çš„èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºæ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚\nä¼ ç»Ÿä¸Šï¼ŒWeb æµè§ˆå™¨ä½¿ç”¨åŸºäºæ‹‰å–çš„æ–¹æ³•ä»æœåŠ¡å™¨è·å–æ•°æ®ã€‚å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨ä»¥è¯·æ±‚çš„æ•°æ®è¿›è¡Œå“åº”ã€‚è¿™ç§æ–¹æ³•ç§°ä¸ºçŸ­è½®è¯¢ï¼Œå¯èƒ½ä¼šé€ æˆé€šä¿¡å»¶è¿Ÿï¼Œå› ä¸ºå®¢æˆ·ç«¯å¿…é¡»é‡å¤å‘é€è¯·æ±‚æ¥æ£€æŸ¥æ›´æ–°ã€‚\nå¦ä¸€æ–¹é¢ï¼Œé•¿è½®è¯¢æ˜¯ä¸€ç§åŸºäºæ¨é€çš„æ–¹æ³•ï¼Œå…è®¸æœåŠ¡å™¨åœ¨æ›´æ–°å¯ç”¨æ—¶ç«‹å³å‘å®¢æˆ·ç«¯å‘é€æ›´æ–°ã€‚å®ƒçš„å·¥ä½œåŸç†å¦‚ä¸‹ï¼š\nå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œé€šå¸¸é€šè¿‡ HTTP è¯·æ±‚ã€‚ æœåŠ¡å™¨ä¸ä¼šç«‹å³å“åº”ï¼Œè€Œæ˜¯å°†è¯·æ±‚ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œä»è€Œä¿æŒè¿æ¥å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚ å¦‚æœæ²¡æœ‰æ–°æ•°æ®å¯ç”¨ï¼ŒæœåŠ¡å™¨å°†ç­‰å¾…ï¼Œç›´åˆ°æœ‰æ•°æ®è¦å‘å›ã€‚ ä¸€æ—¦æœåŠ¡å™¨æœ‰æ–°çš„æ•°æ®æˆ–è€…å‘ç”Ÿé¢„å®šä¹‰çš„è¶…æ—¶ï¼Œå®ƒå°±ä¼šç”¨æœ€æ–°çš„ä¿¡æ¯å“åº”å®¢æˆ·ç«¯ã€‚ å®¢æˆ·ç«¯æ”¶åˆ°å“åº”åï¼Œç«‹å³å‘æœåŠ¡å™¨å‘é€å¦ä¸€ä¸ªè¯·æ±‚ä»¥ç»´æŒè¿æ¥ã€‚ è¿™ç§å‘é€è¯·æ±‚å’Œæ¥æ”¶å“åº”çš„å¾ªç¯æŒç»­è¿›è¡Œï¼Œç¡®ä¿å®æ—¶æ›´æ–°ã€‚ é•¿è½®è¯¢é€šè¿‡é•¿æ—¶é—´ä¿æŒè¯·æ±‚-å“åº”å‘¨æœŸæ‰“å¼€æ¥æœ‰æ•ˆåœ°æ¨¡æ‹Ÿå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„å®æ—¶è¿æ¥ã€‚å®ƒå…è®¸æœåŠ¡å™¨åœ¨æ›´æ–°å¯ç”¨æ—¶ç«‹å³å°†æ›´æ–°æ¨é€åˆ°å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”æ— éœ€å®¢æˆ·ç«¯é‡å¤æ£€æŸ¥æ›´æ–°ã€‚\nä½¿ç”¨ä»€ä¹ˆæŠ€æœ¯æ¥å®ç°é•¿è½®è¯¢ï¼Ÿ é•¿è½®è¯¢æ˜¯ä¸€ç§å®ç°å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å®æ—¶é€šä¿¡çš„æŠ€æœ¯ã€‚å®ƒé€šå¸¸ç”¨äºå³æ—¶æ›´æ–°è‡³å…³é‡è¦çš„èŠå¤©å’Œæ¶ˆæ¯ä¼ é€’åº”ç”¨ç¨‹åºã€‚å¯ä»¥ä½¿ç”¨å¤šç§æŠ€æœ¯æ¥å®ç°é•¿è½®è¯¢ï¼Œæ¯ç§æŠ€æœ¯éƒ½æœ‰ä¼˜ç‚¹å’Œæ³¨æ„äº‹é¡¹ã€‚è®©æˆ‘ä»¬æ¢è®¨ä¸€äº›ç”¨äºå®ç°é•¿è½®è¯¢çš„å¸¸ç”¨æŠ€æœ¯ã€‚\nHTTP é•¿è½®è¯¢ï¼š\nè¿™æ˜¯å®ç°é•¿è½®è¯¢çš„æœ€åŸºæœ¬ã€æœ€å¹¿æ³›ä½¿ç”¨çš„æ–¹æ³•ã€‚å®ƒåˆ©ç”¨ HTTP åè®®å»ºç«‹å¹¶ç»´æŠ¤å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é•¿æœŸè¿æ¥ã€‚å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨å°†è¯·æ±‚ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œç›´åˆ°æœ‰æ–°æ•°æ®å¯ç”¨æˆ–è¾¾åˆ°æŸä¸ªè¶…æ—¶ã€‚ä¸€æ—¦æœ‰æ–°æ•°æ®å¯ç”¨ï¼ŒæœåŠ¡å™¨å°±ä¼šç”¨æ›´æ–°çš„ä¿¡æ¯è¿›è¡Œå“åº”ï¼Œå®¢æˆ·ç«¯ç«‹å³å‘é€å¦ä¸€ä¸ªè¯·æ±‚ä»¥ç»§ç»­å¾ªç¯ã€‚è¿™ç§æ–¹æ³•æ˜“äºå®ç°ï¼Œä¸éœ€è¦ç‰¹æ®Šçš„æœåŠ¡å™¨ç«¯æŠ€æœ¯ã€‚\nç½‘ç»œå¥—æ¥å­—ï¼š\nWebSocket æ˜¯ä¸€ç§å…¨åŒå·¥é€šä¿¡åè®®ï¼Œå¯é€šè¿‡å•ä¸ªé•¿æœŸè¿æ¥åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å®ç°å®æ—¶é€šä¿¡ã€‚å®ƒæä¾›äº†æ¯”é•¿è½®è¯¢æ›´é«˜æ•ˆã€ä½å»¶è¿Ÿçš„æ›¿ä»£æ–¹æ¡ˆã€‚ WebSocket æ”¯æŒåŒå‘æ•°æ®æµï¼Œå…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¼‚æ­¥å‘é€æ¶ˆæ¯ã€‚å®ƒæ¶ˆé™¤äº†é¢‘ç¹çš„ HTTP è¯·æ±‚å¹¶å‡å°‘äº†ç½‘ç»œå¼€é”€ã€‚ WebSocket éå¸¸é€‚åˆéœ€è¦å³æ—¶æ›´æ–°å’Œå®æ—¶äº¤äº’çš„åº”ç”¨ç¨‹åºã€‚\næœåŠ¡å™¨å‘é€çš„äº‹ä»¶ (SSE)ï¼š\nSSE æ˜¯ä¸€ç§å•å‘é€šä¿¡æŠ€æœ¯ï¼Œå…è®¸æœåŠ¡å™¨é€šè¿‡å•ä¸ªé•¿æœŸ HTTP è¿æ¥å°†æ•°æ®æ¨é€åˆ°å®¢æˆ·ç«¯ã€‚é€šè¿‡SSEï¼ŒæœåŠ¡å™¨å¯ä»¥å‘å®¢æˆ·ç«¯å‘é€å¤šä¸ªæ›´æ–°ï¼Œè€Œä¸éœ€è¦å®¢æˆ·ç«¯ä¸æ–­åœ°å‘å‡ºè¯·æ±‚ã€‚æœåŠ¡å™¨å¯åŠ¨è¿æ¥å¹¶ä»¥ä¸€ç³»åˆ—äº‹ä»¶çš„å½¢å¼å‘é€æ•°æ®ã€‚å®¢æˆ·ç«¯æ¥æ”¶è¿™äº›äº‹ä»¶å¹¶å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œå¤„ç†ã€‚\nåœ¨é€‰æ‹©åœ¨åº”ç”¨ç¨‹åºä¸­å®ç°é•¿è½®è¯¢çš„æŠ€æœ¯æ—¶ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªå› ç´ ï¼š\nå¯æ‰©å±•æ€§ï¼šç¡®ä¿æ‰€é€‰æŠ€æœ¯å¯ä»¥å¤„ç†å¤§é‡å¹¶å‘è¿æ¥ï¼Œå¹¶ä¸”å¯ä»¥éšç€ç”¨æˆ·ç¾¤çš„å¢é•¿è€Œæ‰©å±•ã€‚ WebSocket å’Œ SSE é€šå¸¸æ¯”åŸºäº HTTP çš„é•¿è½®è¯¢æ›´å…·å¯æ‰©å±•æ€§ï¼Œå› ä¸ºå®ƒä»¬å…è®¸æ›´æœ‰æ•ˆåœ°ä½¿ç”¨æœåŠ¡å™¨èµ„æºã€‚ å®‰å…¨æ€§ï¼šè€ƒè™‘æ‰€é€‰æŠ€æœ¯çš„å®‰å…¨å½±å“ã€‚ WebSocket å’Œ SSE å¯ä»¥ä½¿ç”¨SSL/TLSç­‰åŠ å¯†åè®®è¿›è¡Œä¿æŠ¤ï¼Œä»è€Œç¡®ä¿æ•°æ®éšç§å’Œå®Œæ•´æ€§ã€‚åŸºäº HTTP çš„é•¿è½®è¯¢ä¹Ÿå¯ä»¥å¾—åˆ°ä¿æŠ¤ï¼Œä½†å¯èƒ½éœ€è¦é¢å¤–çš„èº«ä»½éªŒè¯å’Œè®¿é—®æ§åˆ¶æªæ–½ã€‚ æµè§ˆå™¨æ”¯æŒï¼šæ£€æŸ¥æ‰€é€‰æŠ€æœ¯çš„æµè§ˆå™¨å…¼å®¹æ€§ã€‚ WebSocket å’Œ SSE æ¯”åŸºäº HTTP çš„é•¿è½®è¯¢å…·æœ‰æ›´å¥½çš„æµè§ˆå™¨æ”¯æŒï¼Œè¿™å¯èƒ½éœ€è¦é¢å¤–çš„æŠ€æœ¯æˆ–é’ˆå¯¹æ—§æµè§ˆå™¨çš„åå¤‡é€‰é¡¹ã€‚ å®æ–½å¤æ‚æ€§ï¼šè¯„ä¼°æ‰€é€‰æŠ€æœ¯çš„å®æ–½å’Œç»´æŠ¤éš¾æ˜“ç¨‹åº¦ã€‚åŸºäº HTTP çš„é•¿è½®è¯¢ç›¸å¯¹ç®€å•ï¼Œè€Œ WebSocket å’Œ SSE å¯èƒ½éœ€è¦æ›´é«˜çº§çš„çŸ¥è¯†å’ŒåŸºç¡€è®¾æ–½ã€‚è€ƒè™‘å¼€å‘å›¢é˜Ÿå¯ç”¨çš„ä¸“ä¸šçŸ¥è¯†æ°´å¹³ä»¥åŠå®æ–½å’Œç»´æŠ¤æ‰€é€‰æŠ€æœ¯æ‰€éœ€çš„èµ„æºã€‚ é•¿è½®è¯¢ä¸ WebSockets é•¿è½®è¯¢å’Œ WebSocketæ˜¯åœ¨å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ Web æµè§ˆå™¨ï¼‰å’ŒæœåŠ¡å™¨ä¹‹é—´å®ç°å®æ—¶è¿æ¥çš„æŠ€æœ¯ã€‚å°½ç®¡å®ƒä»¬çš„ç›®çš„ç›¸ä¼¼ï¼Œä½†ä¸¤è€…å­˜åœ¨æ˜¾ç€å·®å¼‚ã€‚\né•¿è½®è¯¢æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œå®¢æˆ·ç«¯å‘ Web æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼ŒæœåŠ¡å™¨ä¿æŒè¿æ¥æ‰“å¼€ï¼Œç›´åˆ°æœ‰æ–°æ•°æ®è¦å‘å›ã€‚å¦‚æœæœåŠ¡å™¨æœ‰æ–°æ•°æ®å¯ç”¨ï¼Œåˆ™å¯ä»¥ç«‹å³å“åº”ï¼Œæˆ–è€…åœ¨å‘é€ç©ºå“åº”ä¹‹å‰ç­‰å¾…æŒ‡å®šçš„è¶…æ—¶æ—¶é—´ã€‚æ— è®ºå“ªç§æƒ…å†µï¼Œå®¢æˆ·ç«¯ä¸€æ—¦æ”¶åˆ°å“åº”ï¼Œå°±ä¼šç«‹å³å‘æœåŠ¡å™¨å‘å‡ºå¦ä¸€ä¸ªè¯·æ±‚ä»¥å»ºç«‹æ–°è¿æ¥ã€‚æ­¤è¿‡ç¨‹ä¸æ–­é‡å¤ï¼Œå…è®¸æœåŠ¡å™¨åœ¨æ›´æ–°å¯ç”¨æ—¶ç«‹å³å°†æ›´æ–°æ¨é€åˆ°å®¢æˆ·ç«¯ã€‚\nå¦ä¸€æ–¹é¢ï¼ŒWebSockets åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´æä¾›æŒä¹…çš„åŒå‘é€šä¿¡é€šé“ã€‚ä¸é•¿è½®è¯¢ä¸åŒçš„æ˜¯ï¼Œé•¿è½®è¯¢ä¼šä¸ºæ¯ä¸ªè¯·æ±‚å»ºç«‹ä¸€ä¸ªæ–°è¿æ¥ï¼Œè€Œ WebSocket è¿æ¥åªä¼šå»ºç«‹ä¸€æ¬¡å¹¶æ— é™æœŸåœ°ä¿æŒæ‰“å¼€çŠ¶æ€ã€‚è¿™å…è®¸åŒå‘å®æ—¶ã€ä½å»¶è¿Ÿé€šä¿¡ã€‚æœåŠ¡å™¨å¯ä»¥éšæ—¶å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®ï¼Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥ä¸ç­‰å¾…å“åº”å°±å‘æœåŠ¡å™¨å‘é€æ•°æ®ã€‚\né•¿è½®è¯¢å’Œ Web Sockets ä¹‹é—´çš„ç›¸ä¼¼ä¹‹å¤„ï¼š 1.å®æ—¶æ›´æ–°ï¼šé•¿è½®è¯¢å’ŒWebSocketséƒ½å¯ä»¥å®ç°æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„å®æ—¶é€šä¿¡ï¼Œå…è®¸å³æ—¶æ›´æ–°ï¼Œæ— éœ€è¿ç»­è½®è¯¢æˆ–åˆ·æ–°ã€‚\nå‡å°‘æœåŠ¡å™¨è´Ÿè½½ï¼šè¿™ä¸¤ç§æŠ€æœ¯éƒ½é€šè¿‡ä»…åœ¨æ•°æ®å¯ç”¨æ—¶å‘é€æ•°æ®æ¥æœ€å¤§ç¨‹åº¦åœ°å‡å°‘ä¸å¿…è¦çš„è¯·æ±‚ï¼Œä»è€Œå‡å°‘æœåŠ¡å™¨è´Ÿè½½å¹¶æé«˜å¯æ‰©å±•æ€§ã€‚ å¹¿æ³›çš„è¯­è¨€å’Œæ¡†æ¶æ”¯æŒï¼šè®¸å¤šæµè¡Œçš„ç¼–ç¨‹è¯­è¨€å’Œæ¡†æ¶éƒ½æ”¯æŒé•¿è½®è¯¢å’ŒWebSocketï¼Œä½¿ä¸åŒç”Ÿæ€ç³»ç»Ÿçš„å¼€å‘äººå‘˜éƒ½å¯ä»¥ä½¿ç”¨å®ƒä»¬ã€‚ é•¿è½®è¯¢å’Œ Web Sockets ä¹‹é—´çš„åŒºåˆ«ï¼š 1.å»¶è¿Ÿï¼šé•¿è½®è¯¢ä¼šå¼•å…¥å»¶è¿Ÿï¼Œå› ä¸ºæœåŠ¡å™¨å‘é€å“åº”å’Œå®¢æˆ·ç«¯æ¥æ”¶å“åº”ä¹‹é—´å­˜åœ¨å»¶è¿Ÿã€‚ WebSocket æä¾›åŒå‘ã€ä½å»¶è¿Ÿé€šä¿¡ï¼Œä»è€Œå®ç°æ›´å¿«çš„å®æ—¶åŠŸèƒ½ã€‚","title":"[è¯‘]ä»€ä¹ˆæ˜¯é•¿è½®è¯¢ï¼Ÿ"},{"content":"åŸæ–‡é“¾æ¥ï¼šhttps://ably.com/topic/websocket-alternatives\nä»€ä¹ˆæ˜¯ WebSocketï¼Ÿ ç®€è€Œè¨€ä¹‹ï¼ŒWebSocket æ˜¯ä¸€ç§å®æ—¶ Web æŠ€æœ¯ï¼Œå¯é€šè¿‡æŒä¹…è¿æ¥åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å®ç°åŒå‘ã€å…¨åŒå·¥é€šä¿¡ã€‚ WebSocket è¿æ¥ä¼šæ ¹æ®éœ€è¦ä¿æŒæ´»åŠ¨çŠ¶æ€ï¼ˆç†è®ºä¸Šï¼Œå®ƒå¯ä»¥æ°¸è¿œæŒç»­ï¼‰ï¼Œä»è€Œå…è®¸æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä»¥æœ€å°çš„å¼€é”€éšæ„å‘é€æ•°æ®ã€‚\näº†è§£æ›´å¤šï¼š\nä»€ä¹ˆæ˜¯ WebSocketï¼Ÿ WebSocket æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ ä»€ä¹ˆæ—¶å€™åº”è¯¥è€ƒè™‘ä½¿ç”¨ WebSocket æ›¿ä»£æ–¹æ¡ˆï¼Ÿ å¯¹äºå®æ—¶æˆ–è¿‘å®æ—¶å‘é€å’Œä½¿ç”¨æ•°æ®è‡³å…³é‡è¦ï¼ˆæˆ–è‡³å°‘æ˜¯ç†æƒ³çš„ï¼‰çš„ç”¨ä¾‹ï¼ŒWebSocket æ˜¯ä¸€ä¸ªç»ä½³çš„é€‰æ‹©ã€‚ç¤ºä¾‹åŒ…æ‹¬èŠå¤©åº”ç”¨ç¨‹åºã€å¤šäººåä½œä½“éªŒä»¥åŠå¹¿æ’­å®æ—¶è·¯å†µæ›´æ–°ã€‚\näº†è§£æœ‰å…³ WebSocket ç”¨ä¾‹çš„æ›´å¤šä¿¡æ¯\nç„¶è€Œï¼Œå¾ˆå°‘æœ‰ä¸€ç§æ”¾ä¹‹å››æµ·è€Œçš†å‡†çš„åè®®ï¼šä¸åŒçš„åè®®æ¯”å…¶ä»–åè®®æ›´å¥½åœ°æœåŠ¡äºä¸åŒçš„ç›®çš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºä¸¥é‡ä¾èµ– CRUD æ“ä½œï¼Œå¹¶ä¸”ç”¨æˆ·ä¸éœ€è¦å¿«é€Ÿå¯¹æ›´æ”¹åšå‡ºååº”ï¼Œé‚£ä¹ˆ HTTP æ˜¯æ¯” WebSockets æ›´å¥½çš„é€‰æ‹©ã€‚å¦ä¸€ä¸ªä¾‹å­ - å¦‚æœæ‚¨æƒ³ä¼ è¾“éŸ³é¢‘å’Œè§†é¢‘æ•°æ®ï¼ŒWebRTC æ˜¯æ¯” WebSockets æ›´å¥½çš„é€‰æ‹©ã€‚\næˆ‘ä»¬è¦æåˆ°çš„æœ€åä¸€ä¸ªä¾‹å­ï¼šå¦‚æœæ‚¨åªéœ€è¦å°†æ–‡æœ¬ï¼ˆå­—ç¬¦ä¸²ï¼‰æ•°æ®æ¨é€åˆ°æµè§ˆå™¨å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”æ‚¨ä»ä¸æœŸæœ›éœ€è¦åŒå‘é€šä¿¡ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥ä½¿ç”¨æœåŠ¡å™¨å‘é€äº‹ä»¶ï¼ˆSSEï¼‰ä¹‹ç±»çš„ä¸œè¥¿ã€‚ä¸ WebSocket ç›¸æ¯”ï¼ŒSSE çš„å¤æ‚æ€§å’Œè¦æ±‚è¾ƒä½ï¼Œå¹¶ä¸”æ›´æ˜“äºæ‰©å±•ã€‚\näº†è§£ WebSocket çš„ä¼˜ç‚¹å’Œç¼ºç‚¹\nWebSocket åè®®çš„äº”ç§æ›¿ä»£æ–¹æ¡ˆ ç°åœ¨ï¼Œæˆ‘ä»¬å°†ç ”ç©¶ WebSocket åè®®çš„äº”ç§æ›¿ä»£æ–¹æ¡ˆ - æ‚¨å¯ä»¥ä½¿ç”¨è¿™äº›æŠ€æœ¯æ¥æ„å»ºå®æ—¶åº”ç”¨ç¨‹åºï¼Œè¿™äº›æŠ€æœ¯æœ‰äº›ç±»ä¼¼ã€‚\næœåŠ¡å™¨å‘é€çš„äº‹ä»¶ æœåŠ¡å™¨å‘é€äº‹ä»¶ (SSE)æ˜¯ä¸€ç§ HTTP æœåŠ¡å™¨æ¨é€æŠ€æœ¯ã€‚è¿™ä¸ªæƒ³æ³•å¾ˆç®€å•ï¼šæµè§ˆå™¨å®¢æˆ·ç«¯å¯ä»¥è®¢é˜…æœåŠ¡å™¨ç”Ÿæˆçš„äº‹ä»¶æµï¼Œå¹¶åœ¨æ–°äº‹ä»¶å‘ç”Ÿæ—¶æ¥æ”¶æ›´æ–°ã€‚\næœåŠ¡å™¨å‘é€äº‹ä»¶çš„ä¼˜ç‚¹\nå†…ç½®å¯¹é‡æ–°è¿æ¥çš„æ”¯æŒã€‚ æ‰€æœ‰ç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒã€‚ è½»é‡çº§åè®®ã€‚ æœåŠ¡å™¨å‘é€äº‹ä»¶çš„ç¼ºç‚¹\nå®ƒæ˜¯å•å‘çš„ï¼›åªæœ‰æœåŠ¡å™¨å¯ä»¥å°†æ•°æ®æ¨é€åˆ°å®¢æˆ·ç«¯ã€‚ æ¯ä¸ªæµè§ˆå™¨åœ¨åŒä¸€æ—¶é—´åªèƒ½æœ‰å…­ä¸ªå¹¶å‘ SSE è¿æ¥ã€‚ ä»…æ”¯æŒUTF-8æ–‡æœ¬æ•°æ®ï¼› SSE æ— æ³•å¤„ç†äºŒè¿›åˆ¶æ•°æ®ã€‚ å¯¹äºä¸éœ€è¦åŒå‘æ¶ˆæ¯ä¼ é€’çš„åœºæ™¯ï¼ˆä¾‹å¦‚å®æ—¶æ¯”åˆ†æ›´æ–°ï¼‰ï¼ŒSSE æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚å¯¹äºéœ€è¦åŒå‘é€šä¿¡çš„ç”¨ä¾‹ï¼ŒWebSocket æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚\næŸ¥çœ‹ SSE ä¸ WebSocket çš„æ¯”è¾ƒ\né•¿è½®è¯¢ é•¿è½®è¯¢æ˜¯ä¸€ç§å®¢æˆ·ç«¯æ‹‰å–æŠ€æœ¯ï¼Œå®ƒé‡‡ç”¨ HTTP è¯·æ±‚/å“åº”è½®è¯¢å¹¶ä½¿å…¶æ›´åŠ é«˜æ•ˆã€‚åœ¨é•¿è½®è¯¢ä¸­ï¼ŒæœåŠ¡å™¨é€‰æ‹©å°½å¯èƒ½é•¿æ—¶é—´åœ°ä¿æŒå®¢æˆ·ç«¯è¿æ¥æ‰“å¼€ï¼Œå¹¶åœ¨æ–°æ•°æ®å¯ç”¨æˆ–è¾¾åˆ°è¶…æ—¶é˜ˆå€¼æ—¶å‘é€å“åº”ã€‚\né•¿è½®è¯¢çš„ä¼˜ç‚¹\né•¿è½®è¯¢æ˜¯åœ¨XMLHttpRequestçš„åŸºç¡€ä¸Šå®ç°çš„ï¼Œå®ƒå‡ ä¹å—åˆ°è®¾å¤‡çš„æ™®éæ”¯æŒï¼Œå› æ­¤é€šå¸¸ä¸éœ€è¦å®ç°ä»»ä½•åå¤‡ã€‚ åœ¨å¿…é¡»å¤„ç†å¼‚å¸¸çš„æƒ…å†µä¸‹ï¼Œæˆ–è€…å¯ä»¥æŸ¥è¯¢æœåŠ¡å™¨ä»¥è·å–æ–°æ•°æ®ä½†ä¸æ”¯æŒé•¿è½®è¯¢ï¼ˆæ›´ä¸ç”¨è¯´å…¶ä»–æ›´ç°ä»£çš„æŠ€æœ¯æ ‡å‡†ï¼‰æ—¶ï¼ŒåŸºæœ¬è½®è¯¢æœ‰æ—¶ä»ç„¶å…·æœ‰æœ‰é™çš„ç”¨é€”ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨XMLHttpRequestï¼Œæˆ–é€šè¿‡ç®€å•çš„ HTML è„šæœ¬æ ‡è®°é€šè¿‡ JSONPã€‚ é•¿è½®è¯¢çš„ç¼ºç‚¹\nä¸ WebSocket ç›¸æ¯”ï¼Œé•¿è½®è¯¢åœ¨æœåŠ¡å™¨ä¸Šæ¶ˆè€—æ›´å¤šèµ„æºã€‚ é•¿è½®è¯¢å¯èƒ½ä¼šå¸¦æ¥å»¶è¿Ÿå¼€é”€ï¼Œå› ä¸ºå®ƒéœ€è¦åœ¨æœåŠ¡å™¨å’Œè®¾å¤‡ä¹‹é—´è¿›è¡Œå¤šæ¬¡è·³è·ƒã€‚ å¯é çš„æ¶ˆæ¯æ’åºå¯èƒ½æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚ é•¿è½®è¯¢æ˜¯ WebSocket çš„æ—©æœŸå…ˆé©±ã€‚å½“è°ˆåˆ°æ„å»ºé«˜æ€§èƒ½ã€ä½å»¶è¿Ÿçš„å®æ—¶åº”ç”¨ç¨‹åºæ—¶ï¼ŒWebSocket å‡ ä¹åœ¨å„ä¸ªæ–¹é¢éƒ½æ˜¯ä¸€ä¸ªä¼˜è¶Šçš„é€‰æ‹©ã€‚è¿™å¹¶ä¸æ˜¯è¯´é•¿è½®è¯¢å·²ç»è¿‡æ—¶ï¼›è€Œæ˜¯è¯´é•¿è½®è¯¢å·²ç»è¿‡æ—¶ã€‚åœ¨æŸäº›ç¯å¢ƒä¸­ï¼Œä¾‹å¦‚å¸¦æœ‰ä»£ç†æœåŠ¡å™¨çš„å…¬å¸ç½‘ç»œä¼šé˜»æ­¢ WebSocket è¿æ¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé•¿è½®è¯¢ä½œä¸º WebSocket çš„åå¤‡æœºåˆ¶éå¸¸æœ‰ç”¨ã€‚\næŸ¥çœ‹è½®è¯¢ä¸ WebSocket ç›¸æ¯”éœ€è¦å¤šé•¿æ—¶é—´\nMQTT MQTTï¼ˆæ¶ˆæ¯é˜Ÿåˆ—é¥æµ‹ä¼ è¾“ï¼‰æ˜¯ä¸€ç§å‘å¸ƒ-è®¢é˜…æ¶ˆæ¯ä¼ é€’åè®®ï¼Œå…¶å†å²å¯ä»¥è¿½æº¯åˆ° 1999 å¹´ï¼Œå½“æ—¶ IBM çš„ Andy Stanley-Clark å’Œ Cirrus Link çš„ Arlen Nipperå‘å¸ƒäº†ç¬¬ä¸€ä¸ªè¿­ä»£ã€‚\nåœ¨ MQTT æ¶æ„ä¸­ï¼Œæˆ‘ä»¬æœ‰ï¼š\nå‘å¸ƒè€…ï¼ˆç”Ÿäº§è€…ï¼‰å’Œè®¢é˜…è€…ï¼ˆæ¶ˆè´¹è€…ï¼‰ã€‚è¯·æ³¨æ„ï¼Œå‘å¸ƒè€…ä¹Ÿå¯ä»¥æ˜¯è®¢é˜…è€…ã€‚ å……å½“ä¸­é—´ä»¶ MQTT æœåŠ¡å™¨çš„ä»£ç†ï¼Œç®¡ç†å‘å¸ƒè€…å’Œè®¢é˜…è€…ä¹‹é—´çš„æ¶ˆæ¯äº¤æ¢ã€‚ MQTT ä¼˜åŠ¿\nè½»é‡çº§åè®®éå¸¸é€‚åˆå¸¦å®½æœ‰é™æˆ–è¿æ¥ä¸å¯é¢„æµ‹çš„ç½‘ç»œä»¥åŠ CPUã€å†…å­˜å’Œç”µæ± å¯¿å‘½æœ‰é™çš„è®¾å¤‡ã€‚ å¯é åè®®ï¼Œå…·æœ‰ä¸‰ç§ä¸åŒçº§åˆ«çš„æ•°æ®ä¼ é€’ä¿è¯ï¼š0ï¼ˆæœ€å¤šä¼ é€’ä¸€æ¬¡ï¼‰ã€1ï¼ˆè‡³å°‘ä¼ é€’ä¸€æ¬¡ï¼‰å’Œ2ï¼ˆæ°å¥½ä¼ é€’ä¸€æ¬¡ï¼‰ã€‚ åŒå‘ä¸”çµæ´» - å®ƒæä¾›ä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šå’Œå¤šå¯¹å¤šé€šä¿¡ã€‚ MQTT ç¼ºç‚¹\nå¯¹äºå‘é€ç…§ç‰‡ã€è§†é¢‘æˆ–éŸ³é¢‘æ•°æ®æ¥è¯´ä¸æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ã€‚ æ‚¨æ— æ³•å°† MQTT æ¶ˆæ¯å‘é€åˆ°æµè§ˆå™¨ï¼Œå› ä¸º Web æµè§ˆå™¨æ²¡æœ‰å†…ç½® MQTT æ”¯æŒã€‚ åŸºæœ¬ MQTT åè®®ä¸ä½¿ç”¨åŠ å¯†é€šä¿¡ã€‚æŸäº› MQTT ä»£ç†å…è®¸æ‚¨ä½¿ç”¨ MQTT over TLS æ¥å¢å¼ºå®‰å…¨æ€§ï¼Œä½†è¿™ä¼šå¯¼è‡´ CPU ä½¿ç”¨ç‡å¢åŠ ï¼Œè¿™å¯¹äºå—é™è®¾å¤‡æ¥è¯´å¯èƒ½æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚ ç”±äºè®¾è®¡è½»é‡ï¼Œå¯¹äºè®¸å¤šç‰©è”ç½‘ç”¨ä¾‹ï¼ˆä¾‹å¦‚ä»æ¸©åº¦æˆ–å‹åŠ›ä¼ æ„Ÿå™¨å®æ—¶æ”¶é›†æ•°æ®ï¼‰æ¥è¯´ï¼ŒMQTT æ˜¯æ¯” WebSocket æ›´å¥½çš„é€‰æ‹©ã€‚ä½†æ˜¯ï¼Œå¦‚å‰æ‰€è¿°ï¼ŒMQTT æ— æ³•ç›´æ¥å‘æµè§ˆå™¨å‘é€æ¶ˆæ¯ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ WebSocket é€šå¸¸è¢«ç”¨ä½œå°† MQTT æ•°æ®æµå¼ä¼ è¾“åˆ°æµè§ˆå™¨å®¢æˆ·ç«¯çš„ä¼ è¾“æ–¹å¼ï¼ˆåŸºäº WebSocket çš„ MQTTï¼‰ã€‚\næŸ¥çœ‹ MQTT ä¸ WebSocket çš„æ¯”è¾ƒ\nç½‘ç»œRTC Web å®æ—¶é€šä¿¡ (WebRTC)æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œå¯è®©æ‚¨å‘ Web å’Œç§»åŠ¨åº”ç”¨ç¨‹åºæ·»åŠ å®æ—¶é€šä¿¡ (RTC) åŠŸèƒ½ã€‚ WebRTC å…è®¸ä»¥ç‚¹å¯¹ç‚¹æ–¹å¼ä¼ è¾“ä»»æ„æ•°æ®ï¼ˆè§†é¢‘ã€è¯­éŸ³å’Œé€šç”¨æ•°æ®ï¼‰ã€‚\nWebRTCä¼˜åŠ¿\nå¼ºå¤§çš„å®‰å…¨ä¿è¯ï¼Œé€šè¿‡ WebRTC ä¼ è¾“çš„æ•°æ®åœ¨å®‰å…¨å®æ—¶ä¼ è¾“åè®® (SRTP)çš„å¸®åŠ©ä¸‹è¿›è¡ŒåŠ å¯†å’ŒéªŒè¯ã€‚ å¼€æºä¸”å…è´¹ä½¿ç”¨ã€‚ å¹³å°å’Œè®¾å¤‡æ— å…³ï¼› WebRTC åº”ç”¨ç¨‹åºå¯ä»¥åœ¨ä»»ä½•æ”¯æŒ WebRTC çš„æµè§ˆå™¨ä¸Šè¿è¡Œï¼Œæ— è®ºæ“ä½œç³»ç»Ÿæˆ–è®¾å¤‡ç±»å‹å¦‚ä½•ã€‚ WebRTC çš„ç¼ºç‚¹\nå°½ç®¡ WebRTC æ˜¯ä¸€ç§ç‚¹å¯¹ç‚¹æŠ€æœ¯ï¼Œæ‚¨ä»ç„¶éœ€è¦ç®¡ç† Web æœåŠ¡å™¨å¹¶ä¸ºå…¶ä»˜è´¹ã€‚ä¸ºäº†ä½¿ä¸¤ä¸ªå¯¹ç­‰ç‚¹èƒ½å¤Ÿç›¸äº’â€œäº¤è°ˆâ€ï¼Œæ‚¨éœ€è¦ä½¿ç”¨ä¿¡ä»¤æœåŠ¡å™¨æ¥å»ºç«‹ã€ç®¡ç†å’Œç»ˆæ­¢ WebRTC é€šä¿¡ä¼šè¯ã€‚ åœ¨å¤„ç†è§†é¢‘å†…å®¹å’Œå¤§é‡ç”¨æˆ·æ—¶ï¼ŒWebRTC å¯èƒ½ä¼šå ç”¨å¤§é‡ CPU èµ„æºã€‚ WebRTC å…¥é—¨å¾ˆéš¾ã€‚æœ‰å¾ˆå¤šæ¦‚å¿µéœ€è¦æ¢ç´¢å’ŒæŒæ¡ï¼šå„ç§æ¥å£ã€ç¼–è§£ç å™¨ã€ç½‘ç»œåœ°å€è½¬æ¢ (NAT) å’Œé˜²ç«å¢™ã€UDPï¼ˆWebRTC ä½¿ç”¨çš„ä¸»è¦åº•å±‚é€šä¿¡åè®®ï¼‰ç­‰ç­‰ã€‚ WebRTC ä¸»è¦è®¾è®¡ç”¨äºæµå¼ä¼ è¾“éŸ³é¢‘å’Œè§†é¢‘å†…å®¹ï¼ˆé€šè¿‡ UDPï¼‰ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹é€šå¸¸æ˜¯æ¯” WebSocket æ›´å¥½çš„é€‰æ‹©ã€‚å¦ä¸€æ–¹é¢ï¼Œå½“æ•°æ®å®Œæ•´æ€§ï¼ˆä¿è¯æ’åºå’Œäº¤ä»˜ï¼‰è‡³å…³é‡è¦æ—¶ï¼ŒWebSocket æ˜¯æ›´å¥½çš„é€‰æ‹©ï¼Œå› ä¸ºæ‚¨å¯ä»¥ä» TCP çš„åº•å±‚å¯é æ€§ä¸­å—ç›Šã€‚\né€šå¸¸ï¼ŒWebRTC å’Œ WebSocket æ˜¯äº’è¡¥æŠ€æœ¯ã€‚ WebRTC å¯¹ç­‰ç‚¹é€šè¿‡ç§°ä¸ºä¿¡ä»¤çš„è¿‡ç¨‹æ¥åè°ƒé€šä¿¡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒWebRTC ä¸æä¾›æ ‡å‡†çš„ä¿¡ä»¤å®ç°ï¼Œå…è®¸å¼€å‘äººå‘˜ä¸ºæ­¤ç›®çš„ä½¿ç”¨ä¸åŒçš„åè®®ã€‚WebSocket åè®®é€šå¸¸ç”¨ä½œ WebRTC åº”ç”¨ç¨‹åºçš„ä¿¡ä»¤æœºåˆ¶ã€‚\näº†è§£ WebRTC ä¸ WebSocket çš„æ¯”è¾ƒ\nç½‘ç»œä¼ è¾“ WebTransportæ˜¯ä¸€é¡¹æ–°å…´çš„å®æ—¶æŠ€æœ¯ï¼Œé€šè¿‡HTTP/3æä¾›å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¶ˆæ¯ä¼ é€’ã€‚ WebTransport æœ‰ä¸¤ä¸ªå…³é”®æ¦‚å¿µï¼š\næ•°æ®æŠ¥ã€‚æ•°æ®æŠ¥æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ•°æ®åŒ…ï¼Œå¯ä»¥æŒ‰ä»»ä½•ç‰¹å®šé¡ºåºåˆ°è¾¾ã€‚ä¸“ä¸ºéœ€è¦ä½å»¶è¿Ÿä¸”å°½åŠ›è€Œä¸ºçš„æ•°æ®ä¼ è¾“å°±è¶³å¤Ÿå¥½çš„ç”¨ä¾‹è€Œè®¾è®¡ã€‚ æºªæµã€‚ Streams API æä¾›å¯é ã€æœ‰åºçš„æ•°æ®ä¼ è¾“ã€‚è¯·æ³¨æ„ï¼Œæ‚¨å¯ä»¥åˆ›å»ºå•å‘å’ŒåŒå‘æµã€‚ ç½‘ç»œä¼ è¾“ä¼˜åŠ¿\né€šè¿‡ä½¿ç”¨ Datagrams API æˆ–é€šè¿‡å¤šä¸ª Streams API å®ä¾‹ï¼Œæ‚¨ä¸å¿…æ‹…å¿ƒé˜Ÿå¤´é˜»å¡ã€‚ å»ºç«‹æ–°è¿æ¥éå¸¸å¿«â€”â€”è¿™æ˜¯å› ä¸º HTTP/3 åœ¨åº•å±‚ä½¿ç”¨äº† QUICï¼›ä¼—æ‰€å‘¨çŸ¥ï¼ŒQUIC æ¡æ‰‹æ¯”é€šè¿‡ TLS å¯åŠ¨ TCP æ›´å¿«ã€‚ Webä¼ è¾“çš„ç¼ºç‚¹\nWebTransport ä»ç„¶æ˜¯ä¸€é¡¹æ–°å…´æŠ€æœ¯ã€‚æˆªè‡³ 2022 å¹´ 11 æœˆï¼ŒWebTransport æ˜¯ W3C çš„è‰æ¡ˆè§„èŒƒï¼Œä¸å…¶å·¥ä½œæ–¹å¼ç›¸å…³çš„æ–¹é¢å§‹ç»ˆæœ‰å¯èƒ½å‘ç”Ÿå˜åŒ–ã€‚ å¹¶éæ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒ WebTransportã€‚ä¾‹å¦‚ï¼Œæ‚¨æ— æ³•åœ¨ Firefox å’Œ Safari ä¸­ä½¿ç”¨ WebTransportã€‚ ä¸æˆ‘ä»¬åœ¨æœ¬æ–‡ä¸­ä»‹ç»çš„å…¶ä»– WebSocket æ›¿ä»£æ–¹æ¡ˆï¼ˆè¿™äº›éƒ½æ˜¯å·²ç»å­˜åœ¨ä¸€æ®µæ—¶é—´çš„æˆç†ŸæŠ€æœ¯ï¼‰ä¸åŒï¼ŒWebTransport æ›´åƒæ˜¯ WebSocket çš„æœªæ¥æ½œåœ¨æ›¿ä»£æ–¹æ¡ˆã€‚æˆ‘ä»¬ä¸çŸ¥é“å®ƒåœ¨æœªæ¥å‡ å¹´å°†å¦‚ä½•å‘å±•ï¼Œå¼€å‘äººå‘˜é‡‡ç”¨å®ƒçš„å¯èƒ½æ€§æœ‰å¤šå¤§ï¼Œæˆ–è€…å®ƒåœ¨ç”Ÿäº§å°±ç»ªç³»ç»Ÿä¸­ä½¿ç”¨æ—¶å¯èƒ½å­˜åœ¨å“ªäº›é™·é˜±ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒWebSocket å·²ç»å­˜åœ¨åå¤šå¹´äº†ï¼›å®ƒæ˜¯ä¸€ç§å¼ºå¤§ã€ç¨³å®šçš„æŠ€æœ¯ï¼Œæ‹¥æœ‰åºå¤§è€Œæ´»è·ƒçš„ç¤¾åŒºï¼Œç›®å‰ä½¿å…¶æˆä¸º WebTransport çš„å“è¶Šæ›¿ä»£å“ã€‚\näº†è§£æœ‰å…³ WebTransport çš„æ›´å¤šä¿¡æ¯\nWebSocket åŠå…¶æ›¿ä»£æ–¹æ¡ˆï¼šå¤´å¯¹å¤´æ¯”è¾ƒ ä¸‹è¡¨æ˜¾ç¤ºäº† WebSocket ä¸æˆ‘ä»¬åœ¨æœ¬æ–‡ä¸­ä»‹ç»çš„æ›¿ä»£å®æ—¶æŠ€æœ¯ä¹‹é—´çš„ä¸»è¦åŒºåˆ«å’Œç›¸ä¼¼ä¹‹å¤„ã€‚\næ ‡å‡† WebSockets é•¿è½®è¯¢ ä¸Šè¯æ‰€ MQTT ç½‘ç»œRTC ç½‘ç»œä¼ è¾“ åº•å±‚åè®® ä¼ è¾“æ§åˆ¶åè®® ä¼ è¾“æ§åˆ¶åè®® ä¼ è¾“æ§åˆ¶åè®® ä¼ è¾“æ§åˆ¶åè®® UDPã€TCP WHO åŒå‘ï¼Ÿ æ˜¯çš„ ä¸ ä¸ æ˜¯çš„ æ˜¯çš„ æ˜¯çš„ æ½œä¼ ä½çš„ é«˜çš„ ä½çš„ ä½çš„ ä½çš„ ä½çš„ å¸¦å®½ ä½çš„ é«˜çš„ ä½çš„ ä½çš„ é«˜çš„ é«˜çš„ æµè§ˆå™¨æ”¯æŒ å¹¿æ³›æ”¯æŒ å¹¿æ³›æ”¯æŒ å¹¿æ³›æ”¯æŒ æµè§ˆå™¨æ²¡æœ‰å†…ç½®çš„ MQTT æ”¯æŒ Internet Explorer å’Œ Opera Mini ä¸æ”¯æŒ æ”¯æŒæœ‰é™ ä½¿ç”¨æ–¹ä¾¿ ç¼“å’Œ ç®€å•çš„ ç®€å•çš„ ç¼“å’Œ éš¾çš„ ç®€å•çš„ åˆ°æœŸ æŠ€æœ¯æˆç†Ÿ æŠ€æœ¯æˆç†Ÿ æŠ€æœ¯æˆç†Ÿ æŠ€æœ¯æˆç†Ÿ æŠ€æœ¯æˆç†Ÿ æ–°å…´ç§‘æŠ€ æ•°æ®çš„å®Œæ•´æ€§ é«˜çš„ ç¼“å’Œ é«˜çš„ é«˜çš„ é«˜çš„ é«˜çš„ å¯æ‰©å±•æ€§ é«˜çš„ ç¼“å’Œ é«˜çš„ é«˜çš„ ä½çš„ é«˜çš„ å®ƒæ˜¯å¹²ä»€ä¹ˆç”¨çš„ï¼Ÿ æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„å®æ—¶é€šä¿¡ã€‚ å®¢æˆ·ç«¯å‘èµ·çš„å®æ—¶æ›´æ–°é€šä¿¡ã€‚ å•å‘æ•°æ®æµï¼ˆæœåŠ¡å™¨æ¨é€ï¼‰ã€‚ ç”¨äº IoT å’Œ M2M é€šä¿¡çš„è½»é‡çº§æ¶ˆæ¯ä¼ é€’åè®®ã€‚ ç”¨äºå®æ—¶éŸ³é¢‘å’Œè§†é¢‘æµçš„ç‚¹å¯¹ç‚¹é€šä¿¡ã€‚ ç”¨äºä½å»¶è¿Ÿ Web é€šä¿¡çš„å¤šè·¯å¤ç”¨ä¼ è¾“åè®®ã€‚ ä½¿ç”¨å¤šç§åè®®æä¾›å®æ—¶ä½“éªŒ æˆ‘ä»¬å¸Œæœ›æ‚¨å‘ç°æœ¬æ–‡å¯¹æ‚¨å‘ç° WebSocket çš„æ½œåœ¨æ›¿ä»£æ–¹æ¡ˆæœ‰æ‰€å¸®åŠ©ã€‚ç„¶è€Œï¼Œç°å®æƒ…å†µæ˜¯ï¼Œè®¸å¤šç”Ÿäº§å°±ç»ªçš„å®æ—¶ç³»ç»Ÿä¸ä»…ä»…ä½¿ç”¨ä¸€ç§åè®®ï¼Œè€Œæ˜¯å¤šç§åè®®çš„æ··åˆã€‚\nä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æ­£åœ¨å¼€å‘è§†é¢‘ä¼šè®®è§£å†³æ–¹æ¡ˆï¼ŒWebRTC æ˜¯åœ¨å¯¹ç­‰ç‚¹ä¹‹é—´å‘é€éŸ³é¢‘å’Œè§†é¢‘æ•°æ®çš„ç»ä½³é€‰æ‹©ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒWebSocket è¡¥å……äº† WebRTCï¼Œå¹¶ç»å¸¸ç”¨ä½œWebRTC å¯¹ç­‰æ–¹çš„ä¿¡ä»¤æœºåˆ¶ã€‚\nå¦ä¸€ä¸ªä¾‹å­ï¼šç”±äºå…¶è½»é‡çº§è®¾è®¡ï¼ŒMQTT æ˜¯ä»ç‰©è”ç½‘ä¼ æ„Ÿå™¨æ”¶é›†é¥æµ‹æ•°æ®çš„ç»ä½³é€‰æ‹©ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨æƒ³ä½¿ç”¨è¿™äº›æ•°æ®æ¥æ”¯æŒå¯ä»¥åœ¨æµè§ˆå™¨ä¸­ç›‘æ§çš„å®æ—¶ä»ªè¡¨æ¿ï¼Œåˆ™ MQTT ä¸é€‚åˆï¼Œå› ä¸ºæµè§ˆå™¨ä¸æ”¯æŒå®ƒã€‚æ‚¨å¯ä»¥åšçš„å°±æ˜¯é€šè¿‡ WebSocket å°†æ•°æ®å‘é€åˆ°æµè§ˆå™¨ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆç°åœ¨è®¸å¤š MQTT ä»£ç†ä¹Ÿæ”¯æŒ WebSocketï¼ˆæˆ–åŸºäº WebSocket çš„ MQTTï¼‰ã€‚\nå¦‚æœæ‚¨ç¡®å®å†³å®šä½¿ç”¨ WebSocket ä½œä¸ºæ‚¨çš„ç”¨ä¾‹çš„ä¸»è¦ä¼ è¾“åè®®ï¼Œæ‚¨ä»ç„¶éœ€è¦è€ƒè™‘æ”¯æŒåå¤‡ä¼ è¾“ï¼Œå› ä¸ºæŸäº›ç¯å¢ƒä¼šé˜»æ­¢ WebSocket è¿æ¥ï¼ˆä¾‹å¦‚ï¼Œé™åˆ¶æ€§çš„å…¬å¸ç½‘ç»œï¼‰ã€‚ SSE å’Œé•¿è½®è¯¢é€šå¸¸ç”¨ä½œ WebSocket çš„åå¤‡æ–¹æ¡ˆã€‚\nAblyï¼Œåœ¨ä»»ä½•è§„æ¨¡ä¸‹éƒ½èƒ½å¯é è¿è¡Œçš„å¤šåè®®å®æ—¶å¹³å° Ably æ˜¯ä¸€å®¶å®æ—¶ä½“éªŒåŸºç¡€è®¾æ–½æä¾›å•†ã€‚æˆ‘ä»¬çš„ API å’Œ SDK å¯å¸®åŠ©å¼€å‘äººå‘˜æ„å»ºå’Œæä¾›å®æ—¶ä½“éªŒï¼Œè€Œæ— éœ€æ‹…å¿ƒç»´æŠ¤å’Œæ‰©å±•æ··ä¹±çš„å®æ—¶åŸºç¡€è®¾æ–½ã€‚\nAbly çš„ä¸»è¦ç‰¹æ€§å’ŒåŠŸèƒ½ï¼š\nå…·æœ‰ä¸°å¯ŒåŠŸèƒ½çš„å‘å¸ƒ/è®¢é˜…æ¶ˆæ¯ä¼ é€’ï¼Œä¾‹å¦‚æ¶ˆæ¯å¢é‡å‹ç¼©ã€è¿ç»­æ€§è‡ªåŠ¨é‡æ–°è¿æ¥ã€ç”¨æˆ·çŠ¶æ€ã€æ¶ˆæ¯å†å²è®°å½•å’Œæ¶ˆæ¯äº¤äº’ã€‚ å¤šåè®®åŠŸèƒ½ã€‚ Ably åè®®åŸºäº WebSocketï¼Œä½†æˆ‘ä»¬è¿˜æ”¯æŒé•¿è½®è¯¢ä½œä¸ºåå¤‡ã€SSEã€MQTTã€AMQPã€STOMP å’Œ HTTP/RESTã€‚ å…¨çƒåˆ†å¸ƒå¼æ•°æ®ä¸­å¿ƒç½‘ç»œå’Œè¾¹ç¼˜åŠ é€Ÿæ¥å…¥ç‚¹ã€‚ ä¿è¯æ¶ˆæ¯æ’åºå’Œä¼ é€’ã€‚ å…¨çƒå®¹é”™å’Œ 99.999% çš„æ­£å¸¸è¿è¡Œæ—¶é—´ SLAã€‚ \u0026lt; 65 æ¯«ç§’å¾€è¿”å»¶è¿Ÿ (P99)ã€‚ åŠ¨æ€å¼¹æ€§ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å¿«é€Ÿæ‰©å±•ä»¥å¤„ç†ä»»ä½•éœ€æ±‚ï¼ˆå‘é€åˆ°æ•°ç™¾ä¸‡ä¸ªå‘å¸ƒ/è®¢é˜…é€šé“å’Œå®¢æˆ·ç«¯è¿æ¥çš„æ•°åäº¿æ¡æ¶ˆæ¯ï¼‰ã€‚ ","permalink":"https://blog.chensoul.cc/posts/2024/05/07/websocket-alternatives/","summary":"åŸæ–‡é“¾æ¥ï¼šhttps://ably.com/topic/websocket-alternatives\nä»€ä¹ˆæ˜¯ WebSocketï¼Ÿ ç®€è€Œè¨€ä¹‹ï¼ŒWebSocket æ˜¯ä¸€ç§å®æ—¶ Web æŠ€æœ¯ï¼Œå¯é€šè¿‡æŒä¹…è¿æ¥åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å®ç°åŒå‘ã€å…¨åŒå·¥é€šä¿¡ã€‚ WebSocket è¿æ¥ä¼šæ ¹æ®éœ€è¦ä¿æŒæ´»åŠ¨çŠ¶æ€ï¼ˆç†è®ºä¸Šï¼Œå®ƒå¯ä»¥æ°¸è¿œæŒç»­ï¼‰ï¼Œä»è€Œå…è®¸æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä»¥æœ€å°çš„å¼€é”€éšæ„å‘é€æ•°æ®ã€‚\näº†è§£æ›´å¤šï¼š\nä»€ä¹ˆæ˜¯ WebSocketï¼Ÿ WebSocket æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ ä»€ä¹ˆæ—¶å€™åº”è¯¥è€ƒè™‘ä½¿ç”¨ WebSocket æ›¿ä»£æ–¹æ¡ˆï¼Ÿ å¯¹äºå®æ—¶æˆ–è¿‘å®æ—¶å‘é€å’Œä½¿ç”¨æ•°æ®è‡³å…³é‡è¦ï¼ˆæˆ–è‡³å°‘æ˜¯ç†æƒ³çš„ï¼‰çš„ç”¨ä¾‹ï¼ŒWebSocket æ˜¯ä¸€ä¸ªç»ä½³çš„é€‰æ‹©ã€‚ç¤ºä¾‹åŒ…æ‹¬èŠå¤©åº”ç”¨ç¨‹åºã€å¤šäººåä½œä½“éªŒä»¥åŠå¹¿æ’­å®æ—¶è·¯å†µæ›´æ–°ã€‚\näº†è§£æœ‰å…³ WebSocket ç”¨ä¾‹çš„æ›´å¤šä¿¡æ¯\nç„¶è€Œï¼Œå¾ˆå°‘æœ‰ä¸€ç§æ”¾ä¹‹å››æµ·è€Œçš†å‡†çš„åè®®ï¼šä¸åŒçš„åè®®æ¯”å…¶ä»–åè®®æ›´å¥½åœ°æœåŠ¡äºä¸åŒçš„ç›®çš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºä¸¥é‡ä¾èµ– CRUD æ“ä½œï¼Œå¹¶ä¸”ç”¨æˆ·ä¸éœ€è¦å¿«é€Ÿå¯¹æ›´æ”¹åšå‡ºååº”ï¼Œé‚£ä¹ˆ HTTP æ˜¯æ¯” WebSockets æ›´å¥½çš„é€‰æ‹©ã€‚å¦ä¸€ä¸ªä¾‹å­ - å¦‚æœæ‚¨æƒ³ä¼ è¾“éŸ³é¢‘å’Œè§†é¢‘æ•°æ®ï¼ŒWebRTC æ˜¯æ¯” WebSockets æ›´å¥½çš„é€‰æ‹©ã€‚\næˆ‘ä»¬è¦æåˆ°çš„æœ€åä¸€ä¸ªä¾‹å­ï¼šå¦‚æœæ‚¨åªéœ€è¦å°†æ–‡æœ¬ï¼ˆå­—ç¬¦ä¸²ï¼‰æ•°æ®æ¨é€åˆ°æµè§ˆå™¨å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”æ‚¨ä»ä¸æœŸæœ›éœ€è¦åŒå‘é€šä¿¡ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥ä½¿ç”¨æœåŠ¡å™¨å‘é€äº‹ä»¶ï¼ˆSSEï¼‰ä¹‹ç±»çš„ä¸œè¥¿ã€‚ä¸ WebSocket ç›¸æ¯”ï¼ŒSSE çš„å¤æ‚æ€§å’Œè¦æ±‚è¾ƒä½ï¼Œå¹¶ä¸”æ›´æ˜“äºæ‰©å±•ã€‚\näº†è§£ WebSocket çš„ä¼˜ç‚¹å’Œç¼ºç‚¹\nWebSocket åè®®çš„äº”ç§æ›¿ä»£æ–¹æ¡ˆ ç°åœ¨ï¼Œæˆ‘ä»¬å°†ç ”ç©¶ WebSocket åè®®çš„äº”ç§æ›¿ä»£æ–¹æ¡ˆ - æ‚¨å¯ä»¥ä½¿ç”¨è¿™äº›æŠ€æœ¯æ¥æ„å»ºå®æ—¶åº”ç”¨ç¨‹åºï¼Œè¿™äº›æŠ€æœ¯æœ‰äº›ç±»ä¼¼ã€‚\næœåŠ¡å™¨å‘é€çš„äº‹ä»¶ æœåŠ¡å™¨å‘é€äº‹ä»¶ (SSE)æ˜¯ä¸€ç§ HTTP æœåŠ¡å™¨æ¨é€æŠ€æœ¯ã€‚è¿™ä¸ªæƒ³æ³•å¾ˆç®€å•ï¼šæµè§ˆå™¨å®¢æˆ·ç«¯å¯ä»¥è®¢é˜…æœåŠ¡å™¨ç”Ÿæˆçš„äº‹ä»¶æµï¼Œå¹¶åœ¨æ–°äº‹ä»¶å‘ç”Ÿæ—¶æ¥æ”¶æ›´æ–°ã€‚\næœåŠ¡å™¨å‘é€äº‹ä»¶çš„ä¼˜ç‚¹\nå†…ç½®å¯¹é‡æ–°è¿æ¥çš„æ”¯æŒã€‚ æ‰€æœ‰ç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒã€‚ è½»é‡çº§åè®®ã€‚ æœåŠ¡å™¨å‘é€äº‹ä»¶çš„ç¼ºç‚¹\nå®ƒæ˜¯å•å‘çš„ï¼›åªæœ‰æœåŠ¡å™¨å¯ä»¥å°†æ•°æ®æ¨é€åˆ°å®¢æˆ·ç«¯ã€‚ æ¯ä¸ªæµè§ˆå™¨åœ¨åŒä¸€æ—¶é—´åªèƒ½æœ‰å…­ä¸ªå¹¶å‘ SSE è¿æ¥ã€‚ ä»…æ”¯æŒUTF-8æ–‡æœ¬æ•°æ®ï¼› SSE æ— æ³•å¤„ç†äºŒè¿›åˆ¶æ•°æ®ã€‚ å¯¹äºä¸éœ€è¦åŒå‘æ¶ˆæ¯ä¼ é€’çš„åœºæ™¯ï¼ˆä¾‹å¦‚å®æ—¶æ¯”åˆ†æ›´æ–°ï¼‰ï¼ŒSSE æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚å¯¹äºéœ€è¦åŒå‘é€šä¿¡çš„ç”¨ä¾‹ï¼ŒWebSocket æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚\næŸ¥çœ‹ SSE ä¸ WebSocket çš„æ¯”è¾ƒ\né•¿è½®è¯¢ é•¿è½®è¯¢æ˜¯ä¸€ç§å®¢æˆ·ç«¯æ‹‰å–æŠ€æœ¯ï¼Œå®ƒé‡‡ç”¨ HTTP è¯·æ±‚/å“åº”è½®è¯¢å¹¶ä½¿å…¶æ›´åŠ é«˜æ•ˆã€‚åœ¨é•¿è½®è¯¢ä¸­ï¼ŒæœåŠ¡å™¨é€‰æ‹©å°½å¯èƒ½é•¿æ—¶é—´åœ°ä¿æŒå®¢æˆ·ç«¯è¿æ¥æ‰“å¼€ï¼Œå¹¶åœ¨æ–°æ•°æ®å¯ç”¨æˆ–è¾¾åˆ°è¶…æ—¶é˜ˆå€¼æ—¶å‘é€å“åº”ã€‚\né•¿è½®è¯¢çš„ä¼˜ç‚¹\né•¿è½®è¯¢æ˜¯åœ¨XMLHttpRequestçš„åŸºç¡€ä¸Šå®ç°çš„ï¼Œå®ƒå‡ ä¹å—åˆ°è®¾å¤‡çš„æ™®éæ”¯æŒï¼Œå› æ­¤é€šå¸¸ä¸éœ€è¦å®ç°ä»»ä½•åå¤‡ã€‚ åœ¨å¿…é¡»å¤„ç†å¼‚å¸¸çš„æƒ…å†µä¸‹ï¼Œæˆ–è€…å¯ä»¥æŸ¥è¯¢æœåŠ¡å™¨ä»¥è·å–æ–°æ•°æ®ä½†ä¸æ”¯æŒé•¿è½®è¯¢ï¼ˆæ›´ä¸ç”¨è¯´å…¶ä»–æ›´ç°ä»£çš„æŠ€æœ¯æ ‡å‡†ï¼‰æ—¶ï¼ŒåŸºæœ¬è½®è¯¢æœ‰æ—¶ä»ç„¶å…·æœ‰æœ‰é™çš„ç”¨é€”ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨XMLHttpRequestï¼Œæˆ–é€šè¿‡ç®€å•çš„ HTML è„šæœ¬æ ‡è®°é€šè¿‡ JSONPã€‚ é•¿è½®è¯¢çš„ç¼ºç‚¹\nä¸ WebSocket ç›¸æ¯”ï¼Œé•¿è½®è¯¢åœ¨æœåŠ¡å™¨ä¸Šæ¶ˆè€—æ›´å¤šèµ„æºã€‚ é•¿è½®è¯¢å¯èƒ½ä¼šå¸¦æ¥å»¶è¿Ÿå¼€é”€ï¼Œå› ä¸ºå®ƒéœ€è¦åœ¨æœåŠ¡å™¨å’Œè®¾å¤‡ä¹‹é—´è¿›è¡Œå¤šæ¬¡è·³è·ƒã€‚ å¯é çš„æ¶ˆæ¯æ’åºå¯èƒ½æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚ é•¿è½®è¯¢æ˜¯ WebSocket çš„æ—©æœŸå…ˆé©±ã€‚å½“è°ˆåˆ°æ„å»ºé«˜æ€§èƒ½ã€ä½å»¶è¿Ÿçš„å®æ—¶åº”ç”¨ç¨‹åºæ—¶ï¼ŒWebSocket å‡ ä¹åœ¨å„ä¸ªæ–¹é¢éƒ½æ˜¯ä¸€ä¸ªä¼˜è¶Šçš„é€‰æ‹©ã€‚è¿™å¹¶ä¸æ˜¯è¯´é•¿è½®è¯¢å·²ç»è¿‡æ—¶ï¼›è€Œæ˜¯è¯´é•¿è½®è¯¢å·²ç»è¿‡æ—¶ã€‚åœ¨æŸäº›ç¯å¢ƒä¸­ï¼Œä¾‹å¦‚å¸¦æœ‰ä»£ç†æœåŠ¡å™¨çš„å…¬å¸ç½‘ç»œä¼šé˜»æ­¢ WebSocket è¿æ¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé•¿è½®è¯¢ä½œä¸º WebSocket çš„åå¤‡æœºåˆ¶éå¸¸æœ‰ç”¨ã€‚\næŸ¥çœ‹è½®è¯¢ä¸ WebSocket ç›¸æ¯”éœ€è¦å¤šé•¿æ—¶é—´","title":"[è¯‘]2024å¹´æœ€å¥½çš„WebSocketæ›¿ä»£å“"},{"content":"åŸæ–‡é“¾æ¥ï¼šhttps://ably.com/topic/http2\nå¯ä»¥æ¯«ä¸å¤¸å¼ åœ°è¯´ï¼Œè¶…æ–‡æœ¬ä¼ è¾“åè®® (HTTP) é€ å°±äº†æˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„äº’è”ç½‘ã€‚ HTTP æœ€åˆæ˜¯ç”±ä¸‡ç»´ç½‘çš„å‘æ˜è€…è’‚å§†Â·ä¼¯çº³æ–¯Â·æ (Tim Berners-Lee) äº 1989 å¹´æå‡ºçš„åº”ç”¨ç¨‹åºåè®®ã€‚ç¬¬ä¸€ä¸ªè®°å½•ç‰ˆæœ¬ HTTP/0.9 è¢«ç§°ä¸ºå•è¡Œåè®®ã€‚é‰´äºå®ƒå‚¬ç”Ÿäº†ä¸‡ç»´ç½‘ï¼Œå®ƒç°åœ¨å¯ä»¥è¢«æè¿°ä¸ºæœ‰å²ä»¥æ¥æœ€ä¼Ÿå¤§çš„ä¿çš®è¯ã€‚\néšç€æˆ‘ä»¬å¯¹äº’è”ç½‘çš„éœ€æ±‚ä¸æ–­å¢é•¿ï¼ŒHTTP ä½œä¸ºç½‘ç»œåè®®ä¹Ÿå¿…é¡»ä¸æ–­å‘å±•æ‰èƒ½æä¾›å¯æ¥å—çš„æ€§èƒ½ã€‚ HTTP/2 æ ‡å¿—ç€ä¸€æ¬¡é‡å¤§æ”¹é©ï¼Œæ˜¯è‡ª 1997 å¹´ HTTP/1.1 ( RFC 2068 ) æä¾›ä»¥æ¥ç¬¬ä¸€ä¸ªæ–°çš„æ ‡å‡†åŒ–ã€‚æœ¬æ–‡ä»‹ç»äº† HTTP/2 å¦‚ä½•è®¾è®¡æ¥å…‹æœ HTTP/1.1 çš„é™åˆ¶ã€æ–°åè®®çš„å®ç°ã€HTTP/2 çš„å·¥ä½œåŸç†ä»¥åŠå…¶è‡ªèº«çš„é™åˆ¶ã€‚\né€šè¿‡å•ä¸ª TCP è¿æ¥çš„ HTTP/2 å®¢æˆ·ç«¯-æœåŠ¡å™¨ã€‚\nå‡ºèº«å‘å¾®â€”â€”HTTP ç®€å² HTTP/0.9 çš„â€œå•è¡Œåè®®â€ç”±è¯·æ±‚ç»„æˆï¼šæ–¹æ³•GETåè·Ÿæ–‡æ¡£åœ°å€ã€å¯é€‰ç«¯å£åœ°å€ï¼Œå¹¶ä»¥å›è½¦ç¬¦å’Œæ¢è¡Œç¬¦ç»“æŸã€‚ç”±ä¸€ä¸² ASCII å­—ç¬¦ç»„æˆçš„è¯·æ±‚ã€‚åªèƒ½ä¼ è¾“ HTML æ–‡ä»¶ã€‚æ²¡æœ‰ HTTP æ ‡å¤´ã€çŠ¶æ€ä»£ç æˆ–é”™è¯¯ä»£ç ã€‚\nè¿›åŒ–çš„ç¬¬ä¸€é˜¶æ®µå¿…é¡»å¾ˆå¿«åˆ°æ¥ã€‚\nHTTP/1.0 â€“ çªç ´é™åˆ¶ ä¸ºäº†å…‹æœ HTTP/0.9 çš„ä¸¥é‡é™åˆ¶ï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨ç‹¬ç«‹ä¿®æ”¹äº†åè®®ã€‚ä¸€äº›å…³é”®çš„åè®®æ›´æ”¹ï¼š\nè¯·æ±‚å…è®¸åŒ…å«å¤šä¸ªç”±æ¢è¡Œç¬¦åˆ†éš”çš„æ ‡å¤´å­—æ®µã€‚ æœåŠ¡å™¨å‘é€äº†åŒ…å«å•ä¸ªçŠ¶æ€è¡Œçš„å“åº”ã€‚ å“åº”ä¸­æ·»åŠ äº†ä¸€ä¸ªæ ‡å¤´å­—æ®µã€‚å“åº”æ ‡å¤´å¯¹è±¡ç”±ç”±æ¢è¡Œç¬¦åˆ†éš”çš„æ ‡å¤´å­—æ®µç»„æˆã€‚ æœåŠ¡å™¨å¯ä»¥ä½¿ç”¨ HTML ä»¥å¤–çš„æ–‡ä»¶è¿›è¡Œå“åº”ã€‚ è¿™äº›ä¿®æ”¹æ²¡æœ‰ä»¥æœ‰åºæˆ–å•†å®šçš„æ–¹å¼å®Œæˆï¼Œå¯¼è‡´ HTTP/0.9 çš„ä¸åŒé£æ ¼ï¼Œè¿›è€Œå¯¼è‡´äº’æ“ä½œæ€§é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼ŒHTTP å·¥ä½œç»„æˆç«‹ï¼Œå¹¶äº 1996 å¹´å‘å¸ƒäº† HTTP/1.0ï¼ˆRFC 1945ï¼‰ã€‚å®ƒæ˜¯ä¸€ä¸ªä¿¡æ¯æ€§ RFCï¼Œä»…è®°å½•å½“æ—¶çš„æ‰€æœ‰ç”¨æ³•ã€‚å› æ­¤ï¼ŒHTTP/1.0 ä¸è¢«è§†ä¸ºæ­£å¼è§„èŒƒæˆ–äº’è”ç½‘æ ‡å‡†ã€‚\nHTTP/1.0 è¯·æ±‚/å“åº”çš„ä»£ç ç¤ºä¾‹ æ¥è‡ªå®¢æˆ·ç«¯çš„ä½¿ç”¨ GET æ–¹æ³•çš„è¯·æ±‚\nGET /contact HTTP/1.0 Host: www.ably.io User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0) Accept: text/*, text/html, text/html;level=1, */*Accept-Language: en-us å®¢æˆ·ç«¯é€šè¿‡ POST æ–¹æ³•å‘å‡ºè¯·æ±‚\nPOST /contact HTTP/1.0 Host: www.ably.io User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0) Accept: text/*, text/html, text/html;level=1, */*Accept-Language: en-us Content-Length: 27 Content-Type: application/x-www-form-urlencoded 200 æ­£å¸¸å“åº”\nHTTP/1.0 200 OK Date: Wed, 24 Jun 2020 11:26:43 GMT Content-Type: text/html; charset=utf-8 Connection: close Server: cloudflare HTTP/1.1 â€“ ç»™æ··ä¹±å¸¦æ¥ï¼ˆä¸€äº›ï¼‰ç§©åº åˆ° 1995 å¹´ï¼ŒHTTP æ ‡å‡†çš„å¼€å‘å·¥ä½œå·²ç»å¼€å§‹ã€‚ HTTP/1.1 é¦–æ¬¡åœ¨RFC 2068ä¸­å®šä¹‰ï¼Œå¹¶äº 1997 å¹´ 1 æœˆå‘å¸ƒã€‚1999 å¹´ 5 æœˆåœ¨RFC 2616ä¸‹å‘å¸ƒäº†æ”¹è¿›å’Œæ›´æ–°ã€‚\nHTTP/1.1 å¼•å…¥äº†è®¸å¤šåŠŸèƒ½å¢å¼ºå’Œæ€§èƒ½ä¼˜åŒ–ï¼ŒåŒ…æ‹¬ï¼š\næŒä¹…è¿æ¥å’Œç®¡é“è¿æ¥ è™šæ‹Ÿä¸»æœº å†…å®¹åå•†ã€åˆ†å—ä¼ è¾“ã€å‹ç¼©å’Œè§£å‹ç¼©ã€ä¼ è¾“ç¼–ç å’Œç¼“å­˜æŒ‡ä»¤ å­—ç¬¦é›†å’Œè¯­è¨€æ ‡ç­¾ å®¢æˆ·è¯†åˆ«å’Œ cookie åŸºæœ¬èº«ä»½éªŒè¯ã€æ‘˜è¦èº«ä»½éªŒè¯å’Œå®‰å…¨ HTTP HTTP/1.1 è¯·æ±‚/å“åº”çš„ä»£ç ç¤ºä¾‹ æ¥è‡ªå®¢æˆ·ç«¯çš„ä½¿ç”¨ GET æ–¹æ³•çš„è¯·æ±‚\nGET /contact HTTP/1.1 Host: www.ably.io User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0) Accept: text/*, text/html, text/html;level=1, */*Accept-Language: en-us å®¢æˆ·ç«¯é€šè¿‡ POST æ–¹æ³•å‘å‡ºè¯·æ±‚\nPOST /contact HTTP/1.1 Host: www.ably.io User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0) Accept: text/*, text/html, text/html;level=1, */*Accept-Language: en-us Content-Length: 27 Content-Type: application/x-www-form-urlencoded 200 æ­£å¸¸å“åº”\nHTTP/1.1 200 OK Date: Wed, 24 Jun 2020 11:59:14 GMT Content-Type: text/html; charset=utf-8 Transfer-Encoding: chunked Server: cloudflare HTTP/1.1 æ—¥ç›Šä¸¥é‡çš„é—®é¢˜ åœ¨æ–°åƒå¹´æœŸé—´ï¼Œåœ¨ HTTP/1.1 çš„æ”¯æŒä¸‹ï¼Œäº’è”ç½‘çš„ä½¿ç”¨ç¨³æ­¥å¢é•¿ã€‚ä¸æ­¤åŒæ—¶ï¼Œç½‘ç«™ä¸æ–­å˜å¾—æ›´å¤§ã€æ›´å¤æ‚ã€‚ç½‘ç»œçŠ¶å†µæŠ¥å‘Šä¸­çš„è¿™å¼ å›¾è¡¨æ˜¾ç¤ºï¼Œ2016 å¹´ 11 æœˆè‡³ 2017 å¹´ 11 æœˆæœŸé—´ï¼Œæ¡Œé¢ç½‘ç«™çš„ä¸­å€¼å¤§å°å¢åŠ äº† 30.6%ï¼Œè€Œè¿™äº›ç½‘ç«™çš„ç§»åŠ¨ç‰ˆæœ¬å¢åŠ äº† 32.3%ã€‚\n2016 å¹´ 11 æœˆä¹‹åçš„ä¸€å¹´ä¸­ï¼Œç½‘ç«™è§„æ¨¡çš„å¢åŠ å¼€å§‹æ¨åŠ¨ HTTP çš„èƒ½åŠ›ï¼ŒåŠ è½½æ—¶é—´è€ƒéªŒç€ç”¨æˆ·çš„è€å¿ƒã€‚æ¥æºï¼šHTTP æ¡£æ¡ˆï¼šç½‘ç»œç°çŠ¶ã€‚\nç”¨æˆ·ä¸å–œæ¬¢åŠ è½½ç¼“æ…¢çš„ç½‘ç«™ã€‚æˆªè‡³ 2019 å¹´ 11 æœˆï¼Œä»å°å¼è®¡ç®—æœºè®¿é—®çš„ç½‘ç«™çš„é¦–æ¬¡å†…å®¹ç»˜åˆ¶ (FCP) çš„ä¸­ä½æ—¶é—´ä¸º 2.4 ç§’ã€‚å¯¹äºç§»åŠ¨è®¾å¤‡ï¼ŒFCP çš„ä¸­ä½æ—¶é—´ä¸º 6.4 ç§’ã€‚ä¸ºäº†ä¿æŒè¯»è€…çš„æ³¨æ„åŠ›ä¸è¢«æ‰“æ‰°ï¼ŒFCP åº”è¯¥ä½äºä¸€ç§’ã€‚\nå¤§éƒ¨åˆ†å»¶è¿Ÿæ˜¯ç”±äº HTTP/1.1 çš„é™åˆ¶é€ æˆçš„ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å…¶ä¸­ä¸€äº›é™åˆ¶ä»¥åŠå¼€å‘äººå‘˜å…‹æœè¿™äº›é™åˆ¶çš„æŠ€å·§ã€‚\né˜Ÿå¤´é˜»å¡ å½“ç”±äºä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®åŒ…è¢«é˜»æ­¢è€Œå¯¼è‡´ä¸€ç³»åˆ—æ•°æ®åŒ…è¢«é˜»æ­¢æ—¶ï¼Œé˜Ÿå¤´é˜»æ­¢ä¼šå¢åŠ ç½‘ç«™å“åº”æ—¶é—´ã€‚å®¢æˆ·ç«¯ä½¿ç”¨ HTTP/1.1 å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œé€šè¿‡ä¼ è¾“æ§åˆ¶åè®® (TCP) è¿æ¥ï¼ŒæœåŠ¡å™¨å¿…é¡»è¿”å›å®Œæ•´çš„å“åº”ï¼Œç„¶åæ‰èƒ½å†æ¬¡ä½¿ç”¨è¿æ¥ã€‚åœ¨å“åº”å®Œæˆä¹‹å‰ï¼Œåç»­è¯·æ±‚å°†æ— æ³•ä½¿ç”¨ TCP è¿æ¥ã€‚\nå“åº” 2 å’Œ 3 è¢«é˜»å¡ï¼Œç›´åˆ°å“åº” 1 è¢«é‡æ–°ä¼ è¾“å’Œä¼ é€’ã€‚æ”¹ç¼–è‡ª10.5 æ¢ç´¢é˜Ÿå¤´é˜»å¡ã€‚\nèµ·åˆï¼Œæµè§ˆå™¨åªå…è®¸ä¸æœåŠ¡å™¨æœ‰ä¸¤ä¸ªå¹¶å‘è¿æ¥ï¼Œå¹¶ä¸”æµè§ˆå™¨å¿…é¡»ç­‰å¾…å…¶ä¸­ä¸€ä¸ªç©ºé—²ï¼Œä»è€Œé€ æˆç“¶é¢ˆã€‚å…è®¸æµè§ˆå™¨å»ºç«‹å…­ä¸ªå¹¶å‘è¿æ¥çš„è§£å†³æ–¹æ³•åªæ˜¯æ¨è¿Ÿäº†é—®é¢˜çš„è§£å†³ã€‚\nå¼€å‘äººå‘˜å¼€å§‹ä½¿ç”¨åŸŸåˆ†ç‰‡å°†å†…å®¹åˆ†å‰²åˆ°å¤šä¸ªå­åŸŸã€‚è¿™ä½¿å¾—æµè§ˆå™¨å¯ä»¥åŒæ—¶ä¸‹è½½æ›´å¤šèµ„æºï¼Œä»è€Œä½¿ç½‘ç«™åŠ è½½é€Ÿåº¦æ›´å¿«ã€‚è¿™æ˜¯ä»¥å¢åŠ å¼€å‘å¤æ‚æ€§å’Œå¢åŠ  TCP è¿æ¥è®¾ç½®å¼€é”€ä¸ºä»£ä»·çš„ã€‚\næµæ°´çº¿ ç®¡é“æ˜¯ä¸€ç§å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€å¤šä¸ªè¯·æ±‚è€Œä¸ç­‰å¾…å“åº”çš„æŠ€æœ¯ã€‚ä½†æ˜¯ï¼ŒæœåŠ¡å™¨å¿…é¡»æŒ‰é¡ºåºå“åº”è¯·æ±‚ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½å¿…é¡»æ”¯æŒå®ƒæ‰èƒ½å·¥ä½œã€‚\nè¾ƒå¤§æˆ–è¾ƒæ…¢çš„å“åº”å¯èƒ½ä¼šé˜»æ­¢å…¶åé¢çš„å“åº”ï¼Œä»è€Œç ´åæµæ°´çº¿ã€‚ç®¡é“åŒ–çš„å®æ–½å…·æœ‰æŒ‘æˆ˜æ€§ï¼Œå› ä¸ºè®¸å¤šä¸­ä»‹å’ŒæœåŠ¡å™¨æ²¡æœ‰æ­£ç¡®å¤„ç†å®ƒã€‚\nHTTP/2 ä¸­çš„ç®¡é“å¯ä»¥é˜²æ­¢é˜Ÿå¤´é˜»å¡æ€§èƒ½é—®é¢˜ã€‚æ”¹ç¼–è‡ªHTTP/2 vs HTTP/1 - å“ªä¸ªæ›´å¿«ï¼Ÿ\nåè®®å¼€é”€ â€“ é‡å¤æ ‡å¤´å’Œ cookie HTTPæ˜¯æ— çŠ¶æ€åè®®ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ã€‚æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯äº¤æ¢é¢å¤–çš„è¯·æ±‚å’Œå“åº”å…ƒæ•°æ®ã€‚æµè§ˆå™¨å‘èµ·çš„æ¯ä¸ª HTTP è¯·æ±‚éƒ½ä¼šæºå¸¦å¤§çº¦ 700 å­—èŠ‚çš„å…ƒæ•°æ®ã€‚æœåŠ¡å™¨ä½¿ç”¨ cookie è¿›è¡Œä¼šè¯ç®¡ç†ã€‚åœ¨æ¯ä¸ªè¯·æ±‚ä¸­æ·»åŠ  cookie åï¼Œåè®®å¼€é”€å°±ä¼šå¢åŠ ã€‚\nè§£å†³æ–¹æ³•æ˜¯å¼€å‘äººå‘˜ä½¿ç”¨â€œæ—  cookieâ€åŸŸæ¥æä¾›ä¸éœ€è¦ cookie çš„é™æ€æ–‡ä»¶ï¼Œä¾‹å¦‚å›¾åƒã€CSS å’Œ JavaScriptã€‚\nTCPæ…¢å¯åŠ¨ TCP æ…¢å¯åŠ¨æ˜¯è¯¥åè®®çš„ä¸€é¡¹åŠŸèƒ½ï¼Œé€šè¿‡æ¢æµ‹ç½‘ç»œæ¥ç¡®å®šå¯ç”¨å®¹é‡ã€‚ HTTP over TCP ä»ä¸€å¼€å§‹å°±æ²¡æœ‰ä½¿ç”¨å…¨éƒ¨å¸¦å®½å®¹é‡ã€‚å°è§„æ¨¡ä¼ è¾“å¯¹äº TCP æ¥è¯´æ˜¯æ˜‚è´µçš„ã€‚ä¸ºäº†å…‹æœ TCP ç¼“æ…¢å¯åŠ¨çš„é—®é¢˜ï¼Œå¼€å‘äººå‘˜ä½¿ç”¨äº†è¯¸å¦‚è¿æ¥ JavaScript å’Œ CSS æ–‡ä»¶ä»¥åŠåˆ†å‰²å°å›¾åƒç­‰æŠ€å·§ã€‚\nHTTP/2 çš„æ¼”å˜ ç®€å•æ€§æ˜¯ HTTP çš„æ ¸å¿ƒåŸåˆ™ã€‚ç„¶è€Œï¼Œå®ç°çš„ç®€å•æ€§æ˜¯ä»¥æ€§èƒ½ä¸ºä»£ä»·çš„ã€‚æ­£å¦‚æˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚ä¸­çœ‹åˆ°çš„ï¼ŒHTTP/1.1 æœ‰è®¸å¤šå›ºæœ‰çš„å±€é™æ€§ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¿™äº›é™åˆ¶å˜å¾—å¤ªå¤šï¼ŒHTTP éœ€è¦å‡çº§ã€‚\n2009 å¹´ï¼ŒGoogle å‘å¸ƒäº†SPDYï¼Œä¸€ä¸ªå®éªŒæ€§åè®®ã€‚è¯¥é¡¹ç›®æœ‰ä»¥ä¸‹é«˜çº§ç›®æ ‡ï¼š\nç›®æ ‡æ˜¯é¡µé¢åŠ è½½æ—¶é—´å‡å°‘ 50%ã€‚ æœ€å¤§é™åº¦åœ°é™ä½éƒ¨ç½²å¤æ‚æ€§ã€‚ é¿å…ç½‘ç«™ä½œè€…å¯¹å†…å®¹è¿›è¡Œä»»ä½•æ›´æ”¹ã€‚ å°†æœ‰å…´è¶£æ¢ç´¢åè®®ä½œä¸ºè§£å†³å»¶è¿Ÿé—®é¢˜çš„æ–¹æ³•çš„å¿—åŒé“åˆçš„å„æ–¹èšé›†åœ¨ä¸€èµ·ã€‚ 2009 å¹´ 11 æœˆï¼ŒGoogle å·¥ç¨‹å¸ˆå®£å¸ƒä»–ä»¬çš„åŠ è½½æ—¶é—´åŠ å¿«äº† 55%ã€‚åˆ° 2012 å¹´ï¼ŒSPDY å¾—åˆ°äº† Chromeã€Firefox å’Œ Opera çš„æ”¯æŒã€‚\nHTTP å·¥ä½œç»„æ³¨æ„åˆ°äº†è¿™ä¸€ç‚¹ï¼Œå¹¶å¼€å§‹åŠªåŠ›åˆ©ç”¨ SPDY çš„ç»éªŒæ•™è®­ã€‚ 2012å¹´11æœˆï¼ŒHTTP/2å¾é›†ææ¡ˆï¼Œå¹¶ä»¥SPDYè§„èŒƒä¸ºèµ·ç‚¹ã€‚\nåœ¨æ¥ä¸‹æ¥çš„å‡ å¹´é‡Œï¼ŒHTTP/2 å’Œ SPDY å…±åŒè¿›åŒ–ï¼Œå…¶ä¸­ SPDY ä½œä¸ºå®éªŒåˆ†æ”¯ã€‚ HTTP/2 äº 2015 å¹´ 5 æœˆä½œä¸ºæè®®æ ‡å‡†å‘å¸ƒ ( RFC 7540 )ã€‚\nåº•å±‚ï¼šHTTP/2 çš„æè¿° ä»è¾ƒé«˜å±‚é¢æ¥çœ‹ï¼ŒHTTP/2 æ—¨åœ¨è§£å†³ HTTP/1.1 çš„é—®é¢˜ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ HTTP/2 æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚éœ€è¦è®°ä½çš„ä¸€ä¸ªé‡è¦æ–¹é¢æ˜¯ HTTP/2 æ˜¯ HTTP/1.1 çš„æ‰©å±•ï¼Œè€Œä¸æ˜¯æ›¿ä»£å“ã€‚å®ƒä¿ç•™äº†HTTP/1.1çš„åº”ç”¨è¯­ä¹‰ã€‚åŠŸèƒ½ã€HTTP æ–¹æ³•ã€çŠ¶æ€ä»£ç ã€URI å’Œæ ‡å¤´å­—æ®µä¿æŒä¸å˜ã€‚\nHTTP/2 æ¶ˆæ¯çš„ç»“æ„ HTTP/2 å…·æœ‰é«˜åº¦ç»“æ„åŒ–çš„æ ¼å¼ï¼Œå…¶ä¸­ HTTP æ¶ˆæ¯è¢«æ ¼å¼åŒ–ä¸ºæ•°æ®åŒ…ï¼ˆç§°ä¸ºå¸§ï¼‰ï¼Œæ¯ä¸ªå¸§åˆ†é…ç»™ä¸€ä¸ªæµã€‚ HTTP/2 å¸§å…·æœ‰ç‰¹å®šçš„æ ¼å¼ï¼ŒåŒ…æ‹¬åœ¨æ¯ä¸ªå¸§å¼€å¤´å£°æ˜çš„é•¿åº¦ä»¥åŠå¸§å¤´ä¸­çš„å‡ ä¸ªå…¶ä»–å­—æ®µã€‚\nåœ¨è®¸å¤šæ–¹é¢ï¼ŒHTTP å¸§ä¸ TCP æ•°æ®åŒ…ç›¸ä¼¼ã€‚è¯»å– HTTP/2 å¸§éµå¾ªä¸€ä¸ªå®šä¹‰çš„è¿‡ç¨‹ï¼šå‰ 24 ä½æ˜¯è¯¥æ•°æ®åŒ…çš„é•¿åº¦ï¼Œåé¢çš„ 8 ä½å®šä¹‰å¸§ç±»å‹ï¼Œä¾æ­¤ç±»æ¨ã€‚\nå¸§å¤´ä¹‹åæ˜¯æœ‰æ•ˆè´Ÿè½½ã€‚è¿™å¯ä»¥æ˜¯ HTTP æ ‡å¤´æˆ–æ­£æ–‡ã€‚è¿™äº›ä¹Ÿå…·æœ‰é¢„å…ˆå·²çŸ¥çš„ç‰¹å®šæ ¼å¼ã€‚ HTTP/2 æ¶ˆæ¯å¯ä»¥åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªå¸§ä¸­å‘é€ã€‚\nç›¸æ¯”ä¹‹ä¸‹ï¼ŒHTTP/1.1 æ˜¯ä¸€ç§ç”± ASCII æ–‡æœ¬è¡Œç»„æˆçš„éç»“æ„åŒ–æ ¼å¼ã€‚æœ€ç»ˆï¼Œå®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦æµï¼Œè€Œä¸æ˜¯è¢«ä¸“é—¨åˆ†æˆå•ç‹¬çš„ç‰‡æ®µ/æ¡†æ¶ï¼ˆé™¤äº†è¡Œçš„åŒºåˆ«ï¼‰ã€‚\nHTTP/1.1 æ¶ˆæ¯ï¼ˆæˆ–è‡³å°‘ç¬¬ä¸€ä¸ª HTTP è¯·æ±‚/å“åº”è¡Œå’Œ HTTP æ ‡å¤´ï¼‰é€šè¿‡ä¸€æ¬¡è¯»å…¥ä¸€ä¸ªå­—ç¬¦æ¥è¿›è¡Œè§£æï¼Œç›´åˆ°åˆ°è¾¾æ–°è¡Œå­—ç¬¦ã€‚è¿™å¾ˆæ··ä¹±ï¼Œå› ä¸ºæ‚¨äº‹å…ˆä¸çŸ¥é“æ¯è¡Œæœ‰å¤šé•¿ã€‚\nåœ¨ HTTP/1.1 ä¸­ï¼ŒHTTP ä¸»ä½“é•¿åº¦çš„å¤„ç†æ–¹å¼ç•¥æœ‰ä¸åŒï¼Œå› ä¸ºå®ƒé€šå¸¸åœ¨ Content-Length HTTP æ ‡å¤´ä¸­å®šä¹‰ã€‚ HTTP/1.1 æ¶ˆæ¯å¿…é¡»ä½œä¸ºä¸€ä¸ªè¿ç»­çš„æ•°æ®æµå®Œæ•´å‘é€ï¼Œå¹¶ä¸”åœ¨å®Œæˆä¹‹å‰è¿æ¥åªèƒ½ç”¨äºä¼ è¾“è¯¥æ¶ˆæ¯ã€‚\næ¯ä¸ª HTTP/2 è¿æ¥éƒ½ä»¥ HTTP/1.1 å¯åŠ¨ï¼Œå¦‚æœå®¢æˆ·ç«¯æ”¯æŒ HTTP/2ï¼Œè¿æ¥å°±ä¼šå‡çº§ã€‚ HTTP/2 åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä½¿ç”¨å•ä¸ª TCP è¿æ¥ï¼Œè¯¥è¿æ¥åœ¨äº¤äº’æœŸé—´ä¿æŒæ‰“å¼€çŠ¶æ€ã€‚\nHTTP/2 è®¾è®¡ç‰¹ç‚¹ HTTP/2 å¼•å…¥äº†è®¸å¤šæ—¨åœ¨æé«˜æ€§èƒ½çš„åŠŸèƒ½ï¼š\nç”¨äºŒè¿›åˆ¶åè®®æ›¿æ¢æ–‡æœ¬åè®®ã€‚äºŒè¿›åˆ¶æˆå¸§å±‚åˆ›å»ºäº¤é”™çš„é€šä¿¡æµã€‚ å®Œå…¨å¤šè·¯å¤ç”¨è€Œä¸æ˜¯æœ‰åºå’Œé˜»å¡ï¼ˆè¿™æ„å‘³ç€å®ƒå¯ä»¥ä½¿ç”¨ä¸€ä¸ªè¿æ¥æ¥å®ç°å¹¶è¡Œæ€§ï¼‰ã€‚ æµæ§åˆ¶ä»¥ç¡®ä¿æµæ˜¯éé˜»å¡çš„ã€‚ æµä¼˜å…ˆçº§å¯è§£å†³ç”±å¤šä¸ªè¯·æ±‚å’Œå“åº”çš„åˆ†å‰²å’Œå¤ç”¨å¼•èµ·çš„é—®é¢˜ã€‚ æ ‡å¤´å‹ç¼©ä»¥å‡å°‘å¼€é”€ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…æ ‡å¤´å‹ç¼©ã€‚ æœåŠ¡å™¨æ¨é€ã€‚ä¸»åŠ¨å°†å“åº”ä»æœåŠ¡å™¨â€œæ¨é€â€åˆ°å®¢æˆ·ç«¯ç¼“å­˜ä¸­ã€‚ äºŒè¿›åˆ¶æ¡†æ¶å±‚ äºŒè¿›åˆ¶æˆå¸§å±‚è´Ÿè´£ HTTP/2 ä¸­çš„æ‰€æœ‰æ€§èƒ½å¢å¼ºï¼Œåˆ¶å®šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´æ¶ˆæ¯å°è£…å’Œä¼ è¾“çš„åè®®ã€‚\nHTTP/2 ä¸­æ·»åŠ åˆ°åº”ç”¨å±‚çš„äºŒè¿›åˆ¶æˆå¸§å±‚ã€‚æ”¹ç¼–è‡ªHTTP/2 ç®€ä»‹ã€‚\näºŒè¿›åˆ¶æˆå¸§å±‚å°†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡åˆ†æˆå°å—ï¼Œå¹¶åˆ›å»ºäº¤é”™çš„åŒå‘é€šä¿¡æµã€‚ç”±äºäºŒè¿›åˆ¶å¸§å±‚ï¼ŒHTTP/2 ä½¿ç”¨å•ä¸ª TCP è¿æ¥ï¼Œè¯¥è¿æ¥åœ¨äº¤äº’æœŸé—´ä¿æŒæ‰“å¼€çŠ¶æ€ã€‚\nåœ¨ç»§ç»­ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆçœ‹çœ‹ HTTP/2 ä¸­ä½¿ç”¨çš„ä¸€äº›æœ¯è¯­ã€‚\nHTTP/2 æœ¯è¯­ **æ¡†æ¶ã€‚**å¸§æ˜¯ HTTP/2 ä¸­æœ€å°çš„é€šä¿¡å•å…ƒã€‚å¸§æºå¸¦ç‰¹å®šç±»å‹çš„æ•°æ®ï¼Œä¾‹å¦‚ HTTP æ ‡å¤´æˆ–æœ‰æ•ˆè´Ÿè½½ã€‚æ‰€æœ‰å¸§å‡ä»¥å›ºå®šçš„ 9 ä¸ªå…«ä½å­—èŠ‚æ ‡å¤´å¼€å§‹ã€‚é™¤å…¶ä»–å†…å®¹å¤–ï¼Œæ ‡å¤´å­—æ®µè¿˜åŒ…å«æµæ ‡è¯†ç¬¦å­—æ®µã€‚æ ‡å¤´åé¢æ˜¯å¯å˜é•¿åº¦çš„æœ‰æ•ˆè´Ÿè½½ã€‚å¸§æœ‰æ•ˆè´Ÿè½½çš„æœ€å¤§å¤§å°ä¸º 2^24 - 1 ä¸ªå…«ä½ä½ç»„ã€‚\n**ä¿¡æ¯ã€‚**æ¶ˆæ¯æ˜¯ä¸€ä¸ªå®Œæ•´çš„ HTTP è¯·æ±‚æˆ–å“åº”æ¶ˆæ¯ã€‚æ¶ˆæ¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå¸§ç»„æˆã€‚\n**æºªæµã€‚**æµæ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„åŒå‘å¸§æµã€‚æµçš„ä¸€äº›é‡è¦ç‰¹å¾æ˜¯ï¼š\nå•ä¸ª HTTP/2 è¿æ¥å¯ä»¥æœ‰å¤šä¸ªå¹¶å‘æ‰“å¼€çš„æµã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥ä»è¿æ¥ä¸Šçš„ä¸åŒæµå‘é€å¸§ã€‚æµå¯ä»¥ç”±å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å…±äº«ã€‚æµä¹Ÿå¯ä»¥ç”±å•ä¸ªå¯¹ç­‰æ–¹å»ºç«‹å’Œä½¿ç”¨ã€‚ ä»»ä¸€ç«¯ç‚¹éƒ½å¯ä»¥å…³é—­æµã€‚ æµä¸­å¸§çš„é¡ºåºå¾ˆé‡è¦ã€‚æ¥æ”¶å™¨æŒ‰ç…§æ¥æ”¶å¸§çš„é¡ºåºå¤„ç†å¸§ã€‚æ ‡å¤´å’Œæ•°æ®å¸§çš„é¡ºåºå…·æœ‰è¯­ä¹‰æ„ä¹‰ã€‚ ä¸€ä¸ªæ•´æ•°æ ‡è¯†æµã€‚æ ‡è¯†æ•´æ•°ç”±å‘èµ·æµçš„ç«¯ç‚¹åˆ†é…ã€‚ HTTP/2 ä¸­çš„å¤šä¸ªè¿æ¥æ‰“å¼€æµæ˜¾ç¤ºæ ‡å¤´å’Œæ•°æ®å¸§ã€‚\nå…¨å¤ç”¨ äºŒè¿›åˆ¶åˆ†å¸§å±‚è§£å†³äº†é˜Ÿå¤´é˜»å¡çš„é—®é¢˜ï¼Œä½¿å¾—HTTP/2å®Œå…¨å¤ç”¨ã€‚æ­£å¦‚æˆ‘ä»¬æ‰€æåˆ°çš„ï¼ŒäºŒè¿›åˆ¶æˆå¸§å±‚æ ¹æ®å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å‘é€çš„ä¿¡æ¯â€œå—â€åˆ›å»ºäº¤é”™çš„åŒå‘æµã€‚\nå®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨å¯ä»¥æŒ‡å®šå…¶ä»–å¯¹ç­‰æ–¹å¯ä»¥å‘èµ·çš„å¹¶å‘æµçš„æœ€å¤§æ•°é‡ã€‚å¯¹ç­‰æ–¹å¯ä»¥éšæ—¶å‡å°‘æˆ–å¢åŠ æ­¤æ•°å­—ã€‚\næµé‡æ§åˆ¶ æ­¤æ—¶ï¼Œæ‚¨ä¸€å®šæƒ³çŸ¥é“ä¸ºä»€ä¹ˆå•ä¸ª TCP è¿æ¥ä¸Šçš„å¤šè·¯å¤ç”¨ä¸ä¼šå¯¼è‡´é˜Ÿå¤´é˜»å¡ã€‚\nHTTP/2 ä½¿ç”¨æµé‡æ§åˆ¶æ–¹æ¡ˆæ¥ç¡®ä¿æµæ˜¯éé˜»å¡çš„ã€‚æµé‡æ§åˆ¶åªæ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæœåŠ¡å™¨ã€å®¢æˆ·ç«¯æˆ–ä¸­ä»‹ï¼ˆå¦‚ä»£ç†æœåŠ¡å™¨ï¼‰çš„ç¼“å†²èƒ½åŠ›ã€‚æµé‡æ§åˆ¶ç”¨äºå„ä¸ªæµå’Œæ•´ä¸ªè¿æ¥ã€‚å¯¹äºæ–°æµå’Œæ•´ä¸ªè¿æ¥ï¼Œæµé‡æ§åˆ¶çª—å£çš„åˆå§‹å€¼ä¸º 65,535 ä¸ªå…«ä½ä½ç»„ã€‚\nå¯¹ç­‰æ–¹å¯ä»¥ä½¿ç”¨ WINDOW_UPDATE å¸§æ¥æ›´æ”¹å®ƒå¯ä»¥ç¼“å†²çš„å…«ä½å­—èŠ‚çš„å€¼ã€‚æœåŠ¡å™¨ã€å®¢æˆ·ç«¯å’Œä¸­ä»‹ä½“å¯ä»¥ç‹¬ç«‹åœ°é€šå‘Šå…¶æµé‡æ§åˆ¶çª—å£å¹¶éµå®ˆå…¶å¯¹ç­‰ä½“è®¾ç½®çš„æµé‡æ§åˆ¶çª—å£ã€‚\nHTTP/2 ä¸­çš„æµé‡æ§åˆ¶æ§åˆ¶æµçš„å¤§å°ä»¥é˜²æ­¢é˜Ÿå¤´é˜»å¡ã€‚\næµä¼˜å…ˆçº§ HTTP/2 åè®®å…è®¸å°†å¤šä¸ªè¯·æ±‚å’Œå“åº”åˆ†å‰²æˆå¸§å¹¶è¿›è¡Œå¤ç”¨ã€‚ä¼ è¾“é¡ºåºå¯¹äºæ€§èƒ½å˜å¾—è‡³å…³é‡è¦ã€‚ HTTP/2 ä½¿ç”¨æµä¼˜å…ˆçº§æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å®¢æˆ·ç«¯ä½¿ç”¨ä¸¤ä¸ªè§„åˆ™åˆ›å»ºä¼˜å…ˆçº§æ ‘ï¼š\nä¸€ä¸ªæµå¯ä»¥ä¾èµ–äºå¦ä¸€ä¸ªæµã€‚å¦‚æœæ²¡æœ‰ç»™ä¸€ä¸ªæµæ˜ç¡®çš„ä¾èµ–å…³ç³»ï¼Œé‚£ä¹ˆå®ƒä¾èµ–äºæ ¹æµã€‚æµå…·æœ‰çˆ¶å­å…³ç³»ã€‚ æ‰€æœ‰ç›¸å…³æµéƒ½å¯ä»¥è¢«èµ‹äºˆ 1 åˆ° 256 ä¹‹é—´çš„æ•´æ•°æƒé‡ã€‚ HTTP/2 ä¸­çš„æµæƒé‡å’Œæµä¾èµ–æ€§ã€‚ æ”¹ç¼–è‡ªHTTP/2 ç®€ä»‹ã€‚\nçˆ¶æµåœ¨å…¶ä»å±æµä¹‹å‰ä¼ é€’ã€‚åŒä¸€çˆ¶çº§çš„ä¾èµ–æµåº”è¯¥è·å¾—ä¸å…¶æƒé‡æˆæ¯”ä¾‹çš„èµ„æºã€‚ä½†æ˜¯ï¼Œå…±äº«åŒä¸€çˆ¶çº§çš„ä»å±æµä¸ä¼šç›¸äº’æ’åºã€‚\nå¯ä»¥ä½¿ç”¨ç‹¬å æ ‡å¿—æ·»åŠ æ–°çº§åˆ«çš„ä¾èµ–å…³ç³»ã€‚ç‹¬å æ ‡å¿—ä½¿æµå”¯ä¸€ä¾èµ–äºå…¶çˆ¶æµã€‚æœ€åï¼Œå¯ä»¥ä½¿ç”¨ PRIORITY æ ‡å¿—æ›´æ”¹æµä¼˜å…ˆçº§ã€‚\næ ‡å¤´å‹ç¼© HTTP è¯·æ±‚åŒ…å«æ ‡å¤´å’Œ cookie æ•°æ®ï¼Œè¿™ä¼šå¢åŠ æ€§èƒ½å¼€é”€ã€‚ HTTP/2 ä½¿ç”¨ HPACK å‹ç¼©æ ¼å¼æ¥å‹ç¼©è¯·æ±‚å’Œå“åº”å…ƒæ•°æ®ã€‚ä¼ è¾“çš„æ ‡å¤´å­—æ®µä½¿ç”¨éœå¤«æ›¼ç¼–ç è¿›è¡Œç¼–ç ã€‚ HTTP/2 è¦æ±‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç»´æŠ¤å’Œæ›´æ–°å…ˆå‰è§è¿‡çš„æ ‡å¤´å­—æ®µçš„ç´¢å¼•åˆ—è¡¨ã€‚ç´¢å¼•åˆ—è¡¨ç”¨ä½œæœ‰æ•ˆç¼–ç å…ˆå‰ä¼ è¾“çš„å€¼çš„å‚è€ƒã€‚\næœåŠ¡å™¨æ¨é€ æœåŠ¡å™¨æ¨é€æ˜¯ä¸€é¡¹æ€§èƒ½åŠŸèƒ½ï¼Œå…è®¸æœåŠ¡å™¨åœ¨å®¢æˆ·ç«¯è¯·æ±‚å“åº”ä¹‹å‰å°†å“åº”å‘é€åˆ°ç¬¦åˆ HTTP/2 çš„å®¢æˆ·ç«¯ã€‚å½“æœåŠ¡å™¨çŸ¥é“å®¢æˆ·ç«¯éœ€è¦â€œæ¨é€â€å“åº”æ¥å®Œå…¨å¤„ç†åŸå§‹è¯·æ±‚æ—¶ï¼Œæ­¤åŠŸèƒ½éå¸¸æœ‰ç”¨ã€‚\næœåŠ¡å™¨æ¨é€æœ‰å¯èƒ½é€šè¿‡åˆ©ç”¨ç½‘ç»œç©ºé—²æ—¶é—´æ¥æé«˜æ€§èƒ½ã€‚ç„¶è€Œï¼Œå¦‚æœå®æ–½ä¸å½“ï¼ŒæœåŠ¡å™¨æ¨é€å¯èƒ½ä¼šé€‚å¾—å…¶åã€‚\næ¨é€å·²ç»åœ¨å®¢æˆ·ç«¯ç¼“å­˜ä¸­çš„èµ„æºä¼šæµªè´¹å¸¦å®½ã€‚æµªè´¹å¸¦å®½æœ‰æœºä¼šæˆæœ¬ï¼Œå› ä¸ºå®ƒå¯ä»¥ç”¨äºç›¸å…³å“åº”ã€‚\nHTTP/2 çš„ç¼“å­˜æ‘˜è¦æ˜¯è§£å†³æ­¤é—®é¢˜çš„æ‹Ÿè®®æ ‡å‡†ã€‚åŒæ—¶ï¼Œå¯ä»¥é€šè¿‡ä»…æ¨é€ç¬¬ä¸€æ¬¡è®¿é—®å¹¶ä½¿ç”¨â€œç¼“å­˜æ‘˜è¦â€æ¥è§£å†³è¯¥é—®é¢˜ã€‚\næ¨é€çš„èµ„æºä¸ HTML çš„äº¤ä»˜å‘ç”Ÿç«äº‰ï¼Œä»è€Œå¯¹é¡µé¢åŠ è½½æ—¶é—´äº§ç”Ÿä¸åˆ©å½±å“ã€‚å¼€å‘è€…å¯ä»¥é€šè¿‡é™åˆ¶æ¨é€èµ„äº§çš„å¤§å°æ¥é¿å…è¿™ç§æƒ…å†µã€‚\nä½¿ç”¨ Node.js è¿è¡Œ HTTP/2 æœåŠ¡å™¨çš„ä»£ç ç¤ºä¾‹ æ‚¨å¯èƒ½éœ€è¦æ›´æ–° Node.js ç‰ˆæœ¬æ‰èƒ½ä½¿ç”¨ HTTP/2 æ¨¡å—ã€‚\néœ€è¦è€ƒè™‘çš„ä¸€ä»¶é‡è¦äº‹æƒ…æ˜¯ï¼Œç›®å‰æ²¡æœ‰æµè§ˆå™¨æ”¯æŒä¸åŠ å¯†çš„ HTTP/2ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦å°†æœåŠ¡å™¨é…ç½®ä¸ºé€šè¿‡å®‰å…¨è¿æ¥ (HTTPS) å·¥ä½œã€‚\nå¤§å¤šæ•°ç°ä»£æ¡†æ¶å’ŒæœåŠ¡å™¨ç°åœ¨éƒ½æ”¯æŒ HTTP/2ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨ Node.js å¯åŠ¨ HTTP/2 Web æœåŠ¡å™¨çš„ç®€å•ç¤ºä¾‹ï¼š\nconst http2 = require(\u0026#39;http2\u0026#39;); const fs = require(\u0026#39;fs\u0026#39;); function onRequest (req, resp) { resp.end(\u0026#34;Hello World\u0026#34;); } const server = http2.createSecureServer({ key: fs.readFileSync(\u0026#39;localhost-privkey.pem\u0026#39;), cert: fs.readFileSync(\u0026#39;localhost-cert.pem\u0026#39;) }, onRequest); server.listen(8443); è¿è¡Œä»£ç åï¼Œæ‰“å¼€æ‚¨é€‰æ‹©çš„æ”¯æŒ HTTP/2 çš„ Web æµè§ˆå™¨ã€‚ç„¶åï¼Œè®¿é—®ä»¥ä¸‹ URLï¼šhttps://localhost:8443/streamã€‚\nHTTP/2 å’Œ HTTP/1.x ä¹‹é—´çš„å·®å¼‚ HTTP/1.x HTTP/2 å…·æœ‰éç»“æ„åŒ–æ ¼å¼çš„æ–‡æœ¬åè®®ï¼Œç”± ASCII ç¼–ç çš„æ–‡æœ¬è¡Œç»„æˆã€‚ äºŒè¿›åˆ¶åè®®ã€‚ HTTP æ¶ˆæ¯è¢«æ ¼å¼åŒ–ä¸ºæ•°æ®åŒ…ï¼ˆç§°ä¸ºå¸§ï¼‰ï¼Œå¹¶ä¸”æ¯ä¸ªå¸§éƒ½åˆ†é…ç»™ä¸€ä¸ªæµã€‚ HTTP/2 å¸§å…·æœ‰ç‰¹å®šçš„æ ¼å¼ï¼ŒåŒ…æ‹¬åœ¨æ¯ä¸ªå¸§å¼€å¤´å£°æ˜çš„é•¿åº¦ä»¥åŠå¸§å¤´ä¸­çš„å„ç§å…¶ä»–å­—æ®µã€‚ å¯ä»¥ä¸åŠ å¯† å¤§éƒ¨åˆ†éƒ½æ˜¯åŠ å¯†çš„ã€‚ HTTP/2 åè®®ä¸å¼ºåˆ¶åŠ å¯†ï¼Œä½†å¤§å¤šæ•°å®¢æˆ·ç«¯éƒ½éœ€è¦åŠ å¯†ã€‚ å†…å®¹åå•†ï¼Œå³å½“æœ‰å¤šä¸ªå¯ç”¨è¡¨ç¤ºæ—¶ä¸ºç»™å®šå“åº”é€‰æ‹©æœ€ä½³è¡¨ç¤ºçš„è¿‡ç¨‹å¯ä»¥æ˜¯æœåŠ¡å™¨é©±åŠ¨æˆ–ä»£ç†é©±åŠ¨ï¼ˆæˆ–â€œé€æ˜â€ï¼‰ã€‚å¢åŠ å¼€é”€ã€‚ åå•†é€šè¿‡å®¢æˆ·ç«¯å‘é€çš„â€œå‡çº§â€HTTP æ ‡å¤´è¿›è¡Œã€‚åå•†ä¹Ÿå¯ä»¥åœ¨ä½¿ç”¨ ALPN çš„ TLS æ¡æ‰‹æœŸé—´è¿›è¡Œã€‚å¦‚æœæœåŠ¡å™¨æ”¯æŒ HTTP/2ï¼Œå®ƒä¼šå“åº”â€œ101 Switchingâ€çŠ¶æ€ï¼Œä»é‚£æ—¶èµ·ï¼Œå®ƒä¼šåœ¨è¯¥è¿æ¥ä¸Šä½¿ç”¨ HTTP/2ã€‚è¿™ä¼šèŠ±è´¹å®Œæ•´çš„ç½‘ç»œå¾€è¿”æ—¶é—´ï¼Œä½†å¥½å¤„æ˜¯ HTTP/2 è¿æ¥åº”è¯¥å¯ä»¥æ¯” HTTP1 è¿æ¥æ›´å¤§ç¨‹åº¦åœ°ä¿æŒæ´»åŠ¨çŠ¶æ€å¹¶é‡ç”¨ã€‚å³ä½¿å‡è®¾ HTTP/2 over TLSï¼Œå‡ºäº Web å¼€å‘çš„ç›®çš„ï¼Œè¿™ä¹Ÿå¯èƒ½æ˜¯åè®®çš„è¦æ±‚ã€‚ ä½¿ç”¨ç®¡é“è¿›è¡Œå¤šè·¯å¤ç”¨ ä½¿ç”¨æµè¿›è¡Œå¤šè·¯å¤ç”¨ã€‚å¯ä»¥éšæ—¶å¯¹æµè¿›è¡Œä¼˜å…ˆçº§æ’åºã€é‡æ–°ä¼˜å…ˆçº§æ’åºå’Œå–æ¶ˆã€‚æµå…·æœ‰å•ç‹¬çš„æµæ§åˆ¶å¹¶ä¸”å¯ä»¥å…·æœ‰ä¾èµ–æ€§ã€‚å®ƒæ¯” HTTP/1.1 ä¸­ä½¿ç”¨çš„ç®¡é“æ›´æœ‰æ•ˆã€‚ éç®¡é“ã€ç®¡é“å’Œå¤šè·¯å¤ç”¨æµä¸­çš„æµé‡æ¯”è¾ƒã€‚æ”¹ç¼–è‡ªLoadMaster - HTTP/2ã€‚\næ³¨æ„ï¼š\nHTTP/1.x æ ‡å¤´ä»¥çº¯æ–‡æœ¬å½¢å¼ä¼ è¾“ï¼Œä½† HTTP/2 ä¼šå‹ç¼©æ ‡å¤´ã€‚ æœåŠ¡å™¨å¯ä»¥å°†å®¢æˆ·ç«¯æœªè¯·æ±‚çš„å†…å®¹æ¨é€ç»™å®¢æˆ·ç«¯ã€‚ åœ¨ HTTP/1.1 ä¸­ï¼Œå‘ç”Ÿé”™è¯¯æ—¶å®¢æˆ·ç«¯æ— æ³•é‡è¯•éå¹‚ç­‰è¯·æ±‚ã€‚æŸäº›æœåŠ¡å™¨å¤„ç†å¯èƒ½åœ¨é”™è¯¯ä¹‹å‰å‘ç”Ÿï¼Œé‡æ–°å°è¯•å¯èƒ½ä¼šäº§ç”Ÿä¸è‰¯å½±å“ã€‚ HTTP/2 å…·æœ‰ä¿è¯è¯·æ±‚æœªè¢«å¤„ç†çš„æœºåˆ¶ã€‚ HTTP/2 å¯èƒ½ä¼šå‘ç”Ÿ TCP çº¿å¤´é˜»å¡ï¼Œä½†å¦‚ä¸Šå›¾ï¼ˆå¯¹äºå¤šè·¯å¤ç”¨ HTTPï¼‰æ‰€ç¤ºï¼Œå“åº” 2 å¯ä»¥åœ¨å“åº” 1 ä¹‹å‰å®Œæˆã€‚å°†å“åº” 1 è§†ä¸ºè·¨è¶Š HTTP/2 æ•°æ®å¸§çš„å¤§å‹åª’ä½“æ–‡ä»¶ï¼Œè€Œå“åº”2 æ˜¯é€‚åˆå•ä¸ª HTTP/2 å¸§çš„å°‘é‡æ–‡æœ¬ã€‚å®¢æˆ·ç«¯å°†åœ¨å“åº” 2 çš„ç¬¬ä¸€å¸§ä¹‹å‰æ¥æ”¶åˆ°å“åº” 1 çš„ç¬¬ä¸€å¸§ï¼Œä½†æ˜¯ HTTP/2 å¯¹è¿™äº›å¸§è¿›è¡Œå¤ç”¨ï¼Œå®¢æˆ·ç«¯ä¸å¿…åœ¨è·å–å“åº” 1 çš„ç¬¬ä¸€ä¸ªå¸§ä¹‹å‰ç­‰å¾…å“åº” 1 çš„å…¶ä»– 99 å¸§ï¼ˆå¹¶ä¸”ä»…) å“åº” 2 çš„å¸§ã€‚ç„¶åå“åº” 2 å®Œæˆï¼ŒåŒæ—¶å“åº” 1 ä»åœ¨å‘é€ã€‚ å®æ–½ HTTP/2 ç›®å‰ï¼Œæ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒ HTTPS ä¸Šçš„ HTTP/2 åè®®ã€‚è¦é€šè¿‡ HTTP/2 ä¸ºåº”ç”¨ç¨‹åºæä¾›æœåŠ¡ï¼Œå¿…é¡»ä½¿ç”¨ SSL è¯ä¹¦é…ç½® Web æœåŠ¡å™¨ã€‚æ‚¨å¯ä»¥ä½¿ç”¨Let\u0026rsquo;s Encryptå¿«é€Ÿå¯åŠ¨å¹¶è¿è¡Œå…è´¹çš„ SSL è¯ä¹¦ã€‚\næ‰€æœ‰ä¸»è¦æœåŠ¡å™¨è½¯ä»¶éƒ½æ”¯æŒ HTTP/2ï¼š\nApache Web Server ç‰ˆæœ¬ 2.4.17 æˆ–æ›´é«˜ç‰ˆæœ¬é€šè¿‡ mod_http2 æ”¯æŒ HTTP/2ï¼Œæ— éœ€æ·»åŠ è¡¥ä¸ã€‚å¯ä»¥ä»ä»¥ä¸‹ä½ç½®ä¸‹è½½ï¼šhttps://httpd.apache.org/download.cgi#apache24ã€‚ç‰ˆæœ¬ 2.4.12 é€šè¿‡ mod_h2 æ”¯æŒ HTTP/2ã€‚ä½†æ˜¯ï¼Œå¿…é¡»å¯¹æœåŠ¡å™¨çš„æºä»£ç åº”ç”¨è¡¥ä¸ã€‚ NGiNX ç‰ˆæœ¬ 1.9.5 åŠæ›´é«˜ç‰ˆæœ¬æ”¯æŒ HTTP/2ã€‚ä»1.13.9ç‰ˆæœ¬å¼€å§‹æ”¯æŒServer Pushã€‚ä»ä»¥ä¸‹ä½ç½®ä¸‹è½½æœ€æ–°ã€ç¨³å®šå’Œæ—§ç‰ˆæœ¬ï¼šhttp://nginx.org/en/download.html Microsoft IISåœ¨ Windows 10 å’Œ Windows Server 2016 ä¸­æ”¯æŒ HTTP/2ã€‚IIS åŒ…å«åœ¨ Windows 10 ä¸­ï¼Œä½†é»˜è®¤æƒ…å†µä¸‹æœªæ‰“å¼€ã€‚ä½¿ç”¨æ§åˆ¶é¢æ¿ä¸­çš„æ‰“å¼€å’Œå…³é—­ Windows åŠŸèƒ½é“¾æ¥ï¼Œç„¶åæŸ¥æ‰¾ Internet ä¿¡æ¯æœåŠ¡ã€‚å¦è¯·å‚é˜…iis.netã€‚ é™·é˜±ï¼šHTTP/2 çš„è®¾è®¡æ³¨æ„äº‹é¡¹ HTTP/2 å…è®¸å®¢æˆ·ç«¯é€šè¿‡å•ä¸ª TCP è¿æ¥åŒæ—¶å‘é€æ‰€æœ‰è¯·æ±‚ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯åº”è¯¥æ›´å¿«åœ°æ¥æ”¶èµ„æºã€‚å¦ä¸€æ–¹é¢ï¼Œå¹¶å‘è¯·æ±‚ä¼šå¢åŠ æœåŠ¡å™¨çš„è´Ÿè½½ã€‚å¯¹äº HTTP/1.1ï¼Œè¯·æ±‚æ˜¯åˆ†æ•£çš„ã€‚ä½†ä½¿ç”¨ HTTP/2ï¼ŒæœåŠ¡å™¨å¯ä»¥å¤§æ‰¹é‡æ¥æ”¶è¯·æ±‚ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´è¯·æ±‚è¶…æ—¶ã€‚æœåŠ¡å™¨è´Ÿè½½æ¿€å¢çš„é—®é¢˜å¯ä»¥é€šè¿‡æ’å…¥è´Ÿè½½å‡è¡¡å™¨æˆ–ä»£ç†æœåŠ¡å™¨æ¥è§£å†³ï¼Œè¿™å¯ä»¥é™åˆ¶è¯·æ±‚ã€‚\nå¤§å¤šæ•°æµè§ˆå™¨é™åˆ¶åˆ°ç»™å®šæºï¼ˆæ–¹æ¡ˆã€ä¸»æœºå’Œç«¯å£çš„ç»„åˆï¼‰çš„å¹¶å‘è¿æ¥æ•°ï¼Œå¹¶ä¸” HTTP/1.1 è¿æ¥å¿…é¡»åœ¨å•ä¸ªè¿æ¥ä¸Šä¸²è¡Œå¤„ç†ã€‚è¿™æ„å‘³ç€ HTTP/1.1 æµè§ˆå™¨æœ‰æ•ˆåœ°é™åˆ¶äº†å¯¹è¯¥æºçš„å¹¶å‘è¯·æ±‚æ•°é‡ï¼Œè¿™æ„å‘³ç€ç”¨æˆ·çš„æµè§ˆå™¨ä¼šé™åˆ¶å¯¹å…¶æœåŠ¡å™¨çš„è¯·æ±‚å¹¶ä¿æŒæµé‡é¡ºç•…ã€‚\næœåŠ¡å™¨å¯¹ HTTP/2 ä¼˜å…ˆçº§çš„æ”¯æŒå°šä¸æˆç†Ÿã€‚è½¯ä»¶æ”¯æŒä»åœ¨ä¸æ–­å‘å±•ã€‚æŸäº› CDN æˆ–è´Ÿè½½å‡è¡¡å™¨å¯èƒ½æ— æ³•æ­£ç¡®æ”¯æŒä¼˜å…ˆçº§ã€‚\nå¦‚æœä¸æ˜æ™ºåœ°ä½¿ç”¨ HTTP/2 æ¨é€åŠŸèƒ½ï¼Œå¼Šå¤§äºåˆ©ã€‚ä¾‹å¦‚ï¼Œè¿”å›çš„è®¿é—®è€…å¯èƒ½æ‹¥æœ‰æ–‡ä»¶çš„ç¼“å­˜å‰¯æœ¬ï¼Œå¹¶ä¸”æœåŠ¡å™¨ä¸åº”æ¨é€èµ„æºã€‚è®©æœåŠ¡å™¨æ¨é€ç¼“å­˜æ„ŸçŸ¥å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ç„¶è€Œï¼Œç¼“å­˜æ„ŸçŸ¥æ¨é€æœºåˆ¶å¯èƒ½ä¼šå˜å¾—å¤æ‚ã€‚\nHTTP/2 è§£å†³äº† HTTP/1.1 çº§åˆ«çš„é˜Ÿå¤´é˜»å¡é—®é¢˜ã€‚ä½†æ˜¯ï¼ŒTCP æµçš„æ•°æ®åŒ…çº§é˜Ÿå¤´é˜»å¡ä»ç„¶å¯ä»¥é˜»å¡è¿æ¥ä¸Šçš„æ‰€æœ‰äº‹åŠ¡ã€‚\nHTTP/2 çš„æ›¿ä»£æ–¹æ¡ˆ ä»¥ä¸‹æŠ€æœ¯å¯ç”¨ä½œæ ‡å‡†å½¢å¼çš„ HTTP/2 çš„æ›¿ä»£æ–¹æ¡ˆï¼Œä»¥å¢å¼ºå®æ—¶ä½¿ç”¨çš„æ€§èƒ½ã€‚\nWebSockets WebSocket æ„å»ºäº HTTP/1.1 ä¹‹ä¸Šï¼Œæä¾›å®Œå…¨åŒå‘é€šä¿¡ã€‚ WebSocket åè®®æé«˜äº†äº’è”ç½‘é€šä¿¡çš„å¯èƒ½æ€§ï¼Œå¹¶å®ç°äº†çœŸæ­£çš„å®æ—¶ç½‘ç»œã€‚\nWebSocket æ˜¯æ„å»ºåœ¨è®¾å¤‡ TCP/IP å †æ ˆä¹‹ä¸Šçš„è–„ä¼ è¾“å±‚ã€‚å…¶ç›®çš„æ˜¯ä¸º Web åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜æä¾›æœ¬è´¨ä¸Šå°½å¯èƒ½æ¥è¿‘åŸå§‹çš„ TCP é€šä¿¡å±‚ï¼ŒåŒæ—¶æ·»åŠ ä¸€äº›æŠ½è±¡ä»¥æ¶ˆé™¤ Web å·¥ä½œæ–¹å¼ä¸­å¯èƒ½å­˜åœ¨çš„æ‘©æ“¦ã€‚\nä¸ REST ç›¸æ¯”ï¼ŒWebSocket å…·æœ‰æ›´é«˜çš„æ•ˆç‡ï¼Œå› ä¸ºå®ƒä»¬ä¸éœ€è¦ä¸ºå‘é€å’Œæ¥æ”¶çš„æ¯æ¡æ¶ˆæ¯äº§ç”Ÿ HTTP è¯·æ±‚/å“åº”å¼€é”€ã€‚å½“å®¢æˆ·ç«¯æƒ³è¦æŒç»­æ›´æ–°èµ„æºçŠ¶æ€æ—¶ï¼ŒWebSockets é€šå¸¸æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚\nè¯·å‚é˜… Ably ä¸»é¢˜WebSockets - æ¦‚å¿µæ·±å…¥æ¢è®¨äº†è§£æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œå¹¶å‚é˜…WebSockets ä¸ HTTPæ¯”è¾ƒè¿™ä¸¤ä¸ªæ¡†æ¶ã€‚\nMQTTï¼ˆæ¶ˆæ¯é˜Ÿåˆ—é¥æµ‹ä¼ è¾“ï¼‰ å¹¿æ³›åº”ç”¨äºç‰©è”ç½‘é¡¹ç›®çš„åº”ç”¨å±‚åè®®ã€‚å®ƒçš„é€‚ç”¨æ€§æ¥è‡ªäºå…¶å°ºå¯¸å°ã€åŠŸè€—ä½ã€æ•°æ®åŒ…æœ€å°åŒ–ä»¥åŠæ˜“äºå®æ–½ã€‚\nMQTT æ˜¯ä¸€ç§ç½‘ç»œåè®®ï¼Œä¸“é—¨ç”¨äºå®ç°ç‰©è”ç½‘ (IoT) è®¾å¤‡ä¹‹é—´çš„é«˜æ•ˆé€šä¿¡ã€‚è¿™æ˜¯å› ä¸ºå®ƒå°ºå¯¸å°ã€åŠŸè€—ä½ã€æ•°æ®åŒ…æœ€å°‘å¹¶ä¸”æ˜“äºå®æ–½ã€‚\né™¤æ­¤ä¹‹å¤–ï¼Œä¸ HTTP ä¸åŒçš„æ˜¯ï¼ŒMQTT ä¸éµå¾ªè¯·æ±‚/å“åº”æœºåˆ¶è¿›è¡Œé€šä¿¡ã€‚ç›¸åï¼Œå®ƒä½¿ç”¨å‘å¸ƒ-è®¢é˜…èŒƒä¾‹ (pub/sub)ã€‚\nè¯·å‚é˜… Ably ä¸»é¢˜MQTTï¼šæ¦‚å¿µæ·±å…¥æ¢è®¨äº†è§£æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚\næœåŠ¡å™¨å‘é€çš„äº‹ä»¶ (SSE) SSE æ˜¯ä¸€ç§å¼€æ”¾ã€è½»é‡çº§ã€ä»…é™è®¢é˜…çš„äº‹ä»¶é©±åŠ¨æ•°æ®æµåè®®ã€‚ SSE é€šè¿‡ HTTP/1.1 å’Œ HTTP/2 ä½œä¸º HTTP ä¹‹ä¸Šçš„å±‚æä¾›æµäº‹ä»¶ã€‚\nSSE è¿æ¥åªèƒ½å°†æ•°æ®æ¨é€åˆ°æµè§ˆå™¨ï¼ˆå› æ­¤ç§°ä¸ºâ€œæœåŠ¡å™¨å‘é€â€ï¼‰ã€‚å¯ä»¥ä» SSE ä¸­å—ç›Šçš„åº”ç”¨ç¨‹åºçš„å¥½ä¾‹å­æ˜¯åœ¨çº¿è‚¡ç¥¨æŠ¥ä»·å’Œç¤¾äº¤åª’ä½“æœåŠ¡ Twitter çš„æ›´æ–°æ—¶é—´è¡¨ã€‚\nç†æƒ³æƒ…å†µä¸‹ï¼Œå½“ä»æœåŠ¡å™¨è¯·æ±‚æ•°æ®æ—¶ï¼Œä¸€ä¸ªç®€å•çš„ XMLHttpRequest å°±å¯ä»¥äº†ã€‚ä½†æ˜¯ï¼Œåœ¨æ‚¨å¸Œæœ›ä½¿ç”¨ XHR æµä¿æŒè¿æ¥æ‰“å¼€çš„æƒ…å†µä¸‹ï¼Œè¿™ä¼šå¸¦æ¥ä¸€ç³»åˆ—å¼€é”€ï¼ŒåŒ…æ‹¬å¤„ç†è§£æé€»è¾‘å’Œè¿æ¥ç®¡ç†ã€‚\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ SSEã€‚ SSE æä¾›äº†ä¸€ä¸ªè¿æ¥ç®¡ç†å’Œè§£æé€»è¾‘å±‚ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿè½»æ¾åœ°ä¿æŒè¿æ¥æ‰“å¼€ï¼ŒåŒæ—¶æœåŠ¡å™¨åœ¨æ–°äº‹ä»¶å¯ç”¨æ—¶å°†å…¶æ¨é€åˆ°å®¢æˆ·ç«¯ã€‚\nå®é™…ä¸Šï¼Œå¯ä»¥ä½¿ç”¨ SSE å®Œæˆçš„æ‰€æœ‰æ“ä½œä¹Ÿå¯ä»¥ä½¿ç”¨ WebSocket å®Œæˆã€‚ç„¶è€Œï¼Œå¯¹äºæŸäº›ç±»å‹çš„åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œä½¿ç”¨ WebSocket å¯èƒ½æœ‰äº›è¿‡å¤§ï¼Œå¹¶ä¸”ä½¿ç”¨ SSE ç­‰åè®®å¯ä»¥æ›´è½»æ¾åœ°å®ç°åç«¯ã€‚\nSSE çš„å¦ä¸€ä¸ªå¯èƒ½çš„ä¼˜ç‚¹æ˜¯ï¼Œå®ƒå¯ä»¥ä»…ä½¿ç”¨ JavaScript æ¥å¡«å……åˆ°æœ¬èº«ä¸æ”¯æŒå®ƒçš„æ—§æµè§ˆå™¨ä¸­ã€‚\næœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… Ably ä¸»é¢˜æœåŠ¡å™¨å‘é€äº‹ä»¶ (SSE)ï¼šæ¦‚å¿µæ·±å…¥æ¢è®¨ã€‚\nHTTP/3 HTTP/3 æ˜¯ HTTP çš„æ–°è¿­ä»£ï¼Œè‡ª 2018 å¹´ä»¥æ¥ä¸€ç›´åœ¨å¼€å‘ä¸­ï¼Œå°½ç®¡åœ¨æ’°å†™æœ¬æ–‡æ—¶å°šæœªæ ‡å‡†åŒ–ï¼Œä½†ä¸€äº›æµè§ˆå™¨å·²ç»åœ¨ä½¿ç”¨å®ƒã€‚\nHTTP/3 çš„ç›®æ ‡æ˜¯é€šè¿‡è§£å†³ HTTP/2 çš„ä¼ è¾“ç›¸å…³é—®é¢˜ï¼Œåœ¨æ‰€æœ‰å½¢å¼çš„è®¾å¤‡ä¸Šæä¾›å¿«é€Ÿã€å¯é ä¸”å®‰å…¨çš„ Web è¿æ¥ã€‚ä¸ºæ­¤ï¼Œå®ƒä½¿ç”¨äº†ä¸€ç§åä¸º QUIC çš„ä¸åŒä¼ è¾“å±‚ç½‘ç»œåè®®ï¼Œè¯¥åè®®åœ¨ç”¨æˆ·æ•°æ®æŠ¥åè®® (UDP) äº’è”ç½‘åè®®ä¸Šè¿è¡Œï¼Œè€Œä¸æ˜¯åœ¨æ‰€æœ‰æ—©æœŸç‰ˆæœ¬çš„ HTTP ä¸­ä½¿ç”¨çš„ TCPã€‚\nè¯·å‚é˜… Ably ä¸»é¢˜HTTP/3 Deep Diveäº†è§£æ›´å¤šè¯¦ç»†ä¿¡æ¯æˆ–é˜…è¯»HTTP/2 ä¸ HTTP/3ï¼šæ¯”è¾ƒã€‚\nç»“è®º HTTP/2 é’ˆå¯¹é€Ÿåº¦è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä»è€Œå¸¦æ¥æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚ä½¿ç”¨ HTTP/2 è¿˜å¯ä»¥ç»™å¼€å‘äººå‘˜å¸¦æ¥å¿«ä¹ï¼Œå› ä¸ºä¸å†éœ€è¦ä½¿ç”¨åŸŸåˆ†ç‰‡ã€èµ„äº§ä¸²è”å’Œå›¾åƒåˆ†å‰²ç­‰æŠ€å·§ã€‚è¿™é™ä½äº†å¼€å‘å¤æ‚æ€§ã€‚\nä¸å…¶å‰èº«ç›¸æ¯”ï¼ŒHTTP/2 ä½¿ç½‘é¡µæµè§ˆå˜å¾—æ›´åŠ å®¹æ˜“å’Œæ›´å¿«ã€‚å®ƒå…·æœ‰è¾ƒä½çš„å¸¦å®½ä½¿ç”¨ç‡ï¼Œè¿™æ„å‘³ç€ HTTP/2 ç»ˆäºèƒ½å¤Ÿå……åˆ†åˆ©ç”¨è¿‡å» 16 å¹´ IT çš„æœ€æ–°å‘å±•ï¼Œè€Œ HTTP1.1 æ— æ³•åšåˆ°è¿™ä¸€ç‚¹ã€‚\nHTTP/2 ä¸“æ³¨äºæ€§èƒ½ï¼Œå°¤å…¶æ˜¯åœ¨ç”¨æˆ·ç«¯ã€‚æ­¤å¤–ï¼Œä¹Ÿä¸éœ€è¦ä¸ºç»•è¿‡æ—§ç‰ˆæœ¬çš„é—®é¢˜è€Œå¼€å‘çš„è®¸å¤šæŠ€å·§ã€‚\nHTTP/2 ä¸“ä¸º Web æµé‡è€Œè®¾è®¡ï¼Œç‰¹åˆ«æ˜¯å›´ç»•æœåŠ¡ Web å†…å®¹çš„éœ€æ±‚ã€‚ç„¶è€Œï¼Œå¯¹äºå®æ—¶é€šä¿¡ï¼Œç‰¹åˆ«æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„åŒå‘é€šä¿¡ï¼ŒWebSockets å’Œ MQTT ç­‰åè®®æ›´é€‚åˆã€‚\nHTTP/2 å’Œ Ably Ably æ˜¯ä¸€ä¸ªä¼ä¸šçº§å‘å¸ƒ/è®¢é˜…æ¶ˆæ¯å¹³å°ã€‚æˆ‘ä»¬å¯ä»¥è½»æ¾é«˜æ•ˆåœ°è®¾è®¡ã€å¿«é€Ÿäº¤ä»˜å’Œæ— ç¼æ‰©å±•ç›´æ¥äº¤ä»˜ç»™æœ€ç»ˆç”¨æˆ·çš„å…³é”®å®æ—¶åŠŸèƒ½ã€‚æ¯å¤©ï¼Œæˆ‘ä»¬å‘æ•°åƒå®¶å…¬å¸çš„æ•°ç™¾ä¸‡ç”¨æˆ·å‘é€æ•°åäº¿æ¡å®æ—¶æ¶ˆæ¯ã€‚\næˆ‘ä»¬ä¸ºäººä»¬ã€ç»„ç»‡å’Œä¼ä¸šæ¯å¤©ä¾èµ–çš„åº”ç”¨ç¨‹åºæä¾›æ”¯æŒï¼Œä¾‹å¦‚Lightspeed Systemä¸ºè¶…è¿‡ 700 ä¸‡å­¦æ ¡æ‹¥æœ‰çš„è®¾å¤‡æä¾›çš„å®æ—¶è®¾å¤‡ç®¡ç†å¹³å°ã€Vitacä¸ºæ•°äº¿å¤šè¯­è¨€è§‚ä¼—æä¾›çš„é’ˆå¯¹å¥¥è¿ä¼šå’Œæ–¯æ™®åˆ©ç‰¹å¥¥è¿ä¼šç­‰æ´»åŠ¨çš„å®æ—¶å­—å¹•æ¯æœˆä¸€ä¸‡äº¿ä¸ªåŠŸèƒ½æ ‡è®°çš„å®æ—¶åŠŸèƒ½æ ‡è®°ã€‚\næˆ‘ä»¬æ˜¯å”¯ä¸€ä¸€ä¸ªæ‹¥æœ‰ä¸€å¥—å†…ç½®æœåŠ¡æ¥æ„å»ºå®Œæ•´å®æ—¶åŠŸèƒ½çš„pub/sub å¹³å°ï¼šåœ¨é€è´§ä¸Šé—¨åº”ç”¨ç¨‹åºä¸Šæ˜¾ç¤ºé©¾é©¶å‘˜çš„å®æ—¶ GPS ä½ç½®ï¼Œå†å²è®°å½•åœ¨æ‰“å¼€ä½“è‚²åº”ç”¨ç¨‹åºæ—¶ç«‹å³åŠ è½½æœ€æ–°åˆ†æ•°ï¼Œæµæ¢å¤ä¼šåœ¨äº¤æ¢ç½‘ç»œæ—¶è‡ªåŠ¨å¤„ç†é‡æ–°è¿æ¥ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„é›†æˆå°† Ably æ‰©å±•åˆ°ç¬¬ä¸‰æ–¹äº‘å’Œç³»ç»Ÿï¼Œä¾‹å¦‚ AWS Kinesis å’Œ RabbitMQã€‚å‡­å€Ÿ 25 å¤šä¸ª SDKï¼Œæˆ‘ä»¬é’ˆå¯¹ç½‘ç»œã€ç§»åŠ¨å’Œç‰©è”ç½‘çš„æ¯ä¸ªä¸»è¦å¹³å°ã€‚\næˆ‘ä»¬çš„å¹³å°å›´ç»•å¯é æ€§çš„å››å¤§æ”¯æŸ±è¿›è¡Œæ•°å­¦å»ºæ¨¡ï¼Œå› æ­¤æˆ‘ä»¬èƒ½å¤Ÿç¡®ä¿æ¶ˆæ¯ä¸ä¼šä¸¢å¤±ï¼ŒåŒæ—¶ä»é€šè¿‡å®‰å…¨ã€å¯é ä¸”é«˜åº¦å¯ç”¨çš„ å…¨çƒè¾¹ç¼˜ç½‘ç»œä»¥ä½å»¶è¿Ÿä¼ é€ã€‚\nä»åˆåˆ›å…¬å¸åˆ°å·¥ä¸šå·¨å¤´çš„å¼€å‘äººå‘˜éƒ½é€‰æ‹©åœ¨ Ably ä¸Šè¿›è¡Œæ„å»ºï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥ç®€åŒ–å·¥ç¨‹ã€æœ€å¤§é™åº¦åœ°å‡å°‘ DevOps å¼€é”€å¹¶æé«˜å¼€å‘é€Ÿåº¦ã€‚\nè¿›ä¸€æ­¥é˜…è¯» WebSockets - A Conceptual Deep Dive The realtime web: evolution of the user experience MQTT: A Conceptual Deep Dive Server-Sent Events (SSE): A Conceptual Deep Dive HTTP evolution - HTTP3 Deep dive HTTP/2 vs HTTP/3: A Comparison WebSockets vs. HTTP See also the Medium article: Exploring http2 (Part 2): with node-http2 core and hapijs\n","permalink":"https://blog.chensoul.cc/posts/2024/05/07/http2/","summary":"åŸæ–‡é“¾æ¥ï¼šhttps://ably.com/topic/http2\nå¯ä»¥æ¯«ä¸å¤¸å¼ åœ°è¯´ï¼Œè¶…æ–‡æœ¬ä¼ è¾“åè®® (HTTP) é€ å°±äº†æˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„äº’è”ç½‘ã€‚ HTTP æœ€åˆæ˜¯ç”±ä¸‡ç»´ç½‘çš„å‘æ˜è€…è’‚å§†Â·ä¼¯çº³æ–¯Â·æ (Tim Berners-Lee) äº 1989 å¹´æå‡ºçš„åº”ç”¨ç¨‹åºåè®®ã€‚ç¬¬ä¸€ä¸ªè®°å½•ç‰ˆæœ¬ HTTP/0.9 è¢«ç§°ä¸ºå•è¡Œåè®®ã€‚é‰´äºå®ƒå‚¬ç”Ÿäº†ä¸‡ç»´ç½‘ï¼Œå®ƒç°åœ¨å¯ä»¥è¢«æè¿°ä¸ºæœ‰å²ä»¥æ¥æœ€ä¼Ÿå¤§çš„ä¿çš®è¯ã€‚\néšç€æˆ‘ä»¬å¯¹äº’è”ç½‘çš„éœ€æ±‚ä¸æ–­å¢é•¿ï¼ŒHTTP ä½œä¸ºç½‘ç»œåè®®ä¹Ÿå¿…é¡»ä¸æ–­å‘å±•æ‰èƒ½æä¾›å¯æ¥å—çš„æ€§èƒ½ã€‚ HTTP/2 æ ‡å¿—ç€ä¸€æ¬¡é‡å¤§æ”¹é©ï¼Œæ˜¯è‡ª 1997 å¹´ HTTP/1.1 ( RFC 2068 ) æä¾›ä»¥æ¥ç¬¬ä¸€ä¸ªæ–°çš„æ ‡å‡†åŒ–ã€‚æœ¬æ–‡ä»‹ç»äº† HTTP/2 å¦‚ä½•è®¾è®¡æ¥å…‹æœ HTTP/1.1 çš„é™åˆ¶ã€æ–°åè®®çš„å®ç°ã€HTTP/2 çš„å·¥ä½œåŸç†ä»¥åŠå…¶è‡ªèº«çš„é™åˆ¶ã€‚\né€šè¿‡å•ä¸ª TCP è¿æ¥çš„ HTTP/2 å®¢æˆ·ç«¯-æœåŠ¡å™¨ã€‚\nå‡ºèº«å‘å¾®â€”â€”HTTP ç®€å² HTTP/0.9 çš„â€œå•è¡Œåè®®â€ç”±è¯·æ±‚ç»„æˆï¼šæ–¹æ³•GETåè·Ÿæ–‡æ¡£åœ°å€ã€å¯é€‰ç«¯å£åœ°å€ï¼Œå¹¶ä»¥å›è½¦ç¬¦å’Œæ¢è¡Œç¬¦ç»“æŸã€‚ç”±ä¸€ä¸² ASCII å­—ç¬¦ç»„æˆçš„è¯·æ±‚ã€‚åªèƒ½ä¼ è¾“ HTML æ–‡ä»¶ã€‚æ²¡æœ‰ HTTP æ ‡å¤´ã€çŠ¶æ€ä»£ç æˆ–é”™è¯¯ä»£ç ã€‚\nè¿›åŒ–çš„ç¬¬ä¸€é˜¶æ®µå¿…é¡»å¾ˆå¿«åˆ°æ¥ã€‚\nHTTP/1.0 â€“ çªç ´é™åˆ¶ ä¸ºäº†å…‹æœ HTTP/0.9 çš„ä¸¥é‡é™åˆ¶ï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨ç‹¬ç«‹ä¿®æ”¹äº†åè®®ã€‚ä¸€äº›å…³é”®çš„åè®®æ›´æ”¹ï¼š\nè¯·æ±‚å…è®¸åŒ…å«å¤šä¸ªç”±æ¢è¡Œç¬¦åˆ†éš”çš„æ ‡å¤´å­—æ®µã€‚ æœåŠ¡å™¨å‘é€äº†åŒ…å«å•ä¸ªçŠ¶æ€è¡Œçš„å“åº”ã€‚ å“åº”ä¸­æ·»åŠ äº†ä¸€ä¸ªæ ‡å¤´å­—æ®µã€‚å“åº”æ ‡å¤´å¯¹è±¡ç”±ç”±æ¢è¡Œç¬¦åˆ†éš”çš„æ ‡å¤´å­—æ®µç»„æˆã€‚ æœåŠ¡å™¨å¯ä»¥ä½¿ç”¨ HTML ä»¥å¤–çš„æ–‡ä»¶è¿›è¡Œå“åº”ã€‚ è¿™äº›ä¿®æ”¹æ²¡æœ‰ä»¥æœ‰åºæˆ–å•†å®šçš„æ–¹å¼å®Œæˆï¼Œå¯¼è‡´ HTTP/0.9 çš„ä¸åŒé£æ ¼ï¼Œè¿›è€Œå¯¼è‡´äº’æ“ä½œæ€§é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼ŒHTTP å·¥ä½œç»„æˆç«‹ï¼Œå¹¶äº 1996 å¹´å‘å¸ƒäº† HTTP/1.0ï¼ˆRFC 1945ï¼‰ã€‚å®ƒæ˜¯ä¸€ä¸ªä¿¡æ¯æ€§ RFCï¼Œä»…è®°å½•å½“æ—¶çš„æ‰€æœ‰ç”¨æ³•ã€‚å› æ­¤ï¼ŒHTTP/1.0 ä¸è¢«è§†ä¸ºæ­£å¼è§„èŒƒæˆ–äº’è”ç½‘æ ‡å‡†ã€‚\nHTTP/1.0 è¯·æ±‚/å“åº”çš„ä»£ç ç¤ºä¾‹ æ¥è‡ªå®¢æˆ·ç«¯çš„ä½¿ç”¨ GET æ–¹æ³•çš„è¯·æ±‚\nGET /contact HTTP/1.0 Host: www.ably.io User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0) Accept: text/*, text/html, text/html;level=1, */*Accept-Language: en-us å®¢æˆ·ç«¯é€šè¿‡ POST æ–¹æ³•å‘å‡ºè¯·æ±‚\nPOST /contact HTTP/1.0 Host: www.ably.io User-Agent: Mozilla/4.","title":"[è¯‘]HTTP çš„æ¼”å˜ â€“ HTTP2 æ·±å…¥æ¢è®¨"},{"content":"åŸæ–‡é“¾æ¥ï¼šhttps://ably.com/topic/websockets-vs-http\nå½“è°ˆåˆ° WebSocket ä¸ HTTP æ—¶ï¼Œå†³å®šä½¿ç”¨å“ªä¸€ç§å¹¶ä¸æ€»æ˜¯é‚£ä¹ˆæ˜ç¡®ã€‚å“ªä¸€ä¸ªæ›´å¥½ï¼Ÿæ‚¨çš„åº”ç”¨ç¨‹åºåº”è¯¥ä½¿ç”¨å“ªä¸€æ¬¾ï¼Ÿ\nä½†é—®é¢˜çš„ç­”æ¡ˆä¸ä¸€å®šæ˜¯å…¶ä¸­ä¹‹ä¸€ - å¼€å‘äººå‘˜ç»å¸¸æ ¹æ®åœºæ™¯åœ¨åŒä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­åŒæ—¶ä½¿ç”¨ WebSocket å’Œ HTTPã€‚æ›´é‡è¦çš„é—®é¢˜æ˜¯ - æˆ‘å¦‚ä½•ç¡®å®š WebSockets è¿˜æ˜¯ HTTP æ˜¯ç‰¹å®šç±»å‹é€šä¿¡çš„æ­£ç¡®é€šä¿¡åè®®ï¼Ÿ\nè¿™æ˜¯æ‚¨éœ€è¦äº†è§£çš„ä¸€åˆ‡ã€‚\nWebSocket ä¸ HTTP æ¦‚è§ˆ åœ¨æ­¤é¡µé¢ä¸Šï¼Œæˆ‘ä»¬å°†æ¢è®¨è¿™äº›æŠ€æœ¯çš„å·¥ä½œåŸç†ã€å®ƒä»¬åœ¨å®ç°å®æ—¶é€šä¿¡æ–¹é¢çš„è¡¨ç°å¦‚ä½•ï¼Œå¹¶å°±åœ¨å“ªäº›åœºæ™¯ä¸­ä½¿ç”¨å“ªäº›æŠ€æœ¯æä¾›å…·ä½“æŒ‡å¯¼ã€‚\nå¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾é«˜çº§æ¯”è¾ƒï¼Œä»¥ä¸‹æ˜¯ä¸»è¦å·®å¼‚ä¸€ç›®äº†ç„¶ï¼š\nè¯·ç»§ç»­é˜…è¯»ä»¥è¯¦ç»†äº†è§£è¿™ä¸¤ç§æµè¡Œåè®®çš„æ¯”è¾ƒã€‚\nHTTPåè®® ä»€ä¹ˆæ˜¯ HTTPï¼Ÿ ä»æ ¹æœ¬ä¸Šè®²ï¼ŒHTTP æ˜¯ä¸€ç§é€šä¿¡åè®®ï¼Œä½¿å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ Web æµè§ˆå™¨ï¼‰å’ŒæœåŠ¡å™¨èƒ½å¤Ÿå…±äº«ä¿¡æ¯ã€‚\nä¾‹å¦‚ï¼ŒHTML æ–‡æ¡£ã€å›¾åƒã€åº”ç”¨ç¨‹åºæ•°æ® (JSON) ç­‰ã€‚\nå¾ˆéš¾æƒ³å‡ºæ¯”æ‚¨ç°åœ¨æ­£åœ¨é˜…è¯»çš„æ­¤é¡µé¢æ›´å¥½çš„ HTTP å®é™…ç¤ºä¾‹ã€‚\nå½“æ‚¨åŠ è½½æ­¤é¡µé¢æ—¶ï¼Œæ‚¨çš„æµè§ˆå™¨ä¼šå‘å‡º HTTP è¯·æ±‚ï¼ŒæœåŠ¡å™¨ä¼šä½¿ç”¨æ‚¨å½“å‰æ­£åœ¨é˜…è¯»çš„ HTML æ–‡æ¡£æ¥å“åº”è¯¥è¯·æ±‚ã€‚\nHTTP æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ HTTP éµå¾ªè¯·æ±‚-å“åº”æ¶ˆæ¯ä¼ é€’æ¨¡å¼ï¼Œå…¶ä¸­å®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚ï¼ŒWeb æœåŠ¡å™¨å‘é€å“åº”ï¼Œè¯¥å“åº”ä¸ä»…åŒ…æ‹¬è¯·æ±‚çš„å†…å®¹ï¼Œè¿˜åŒ…æ‹¬æœ‰å…³è¯·æ±‚çš„ç›¸å…³ä¿¡æ¯ã€‚\nåœ¨åº•å±‚ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½ä¼šæ‰“å¼€ä¸€ä¸ªä¸æœåŠ¡å™¨çš„çŸ­æš‚è¿æ¥ï¼Œç„¶åå…³é—­ã€‚\nHTTP ç¤ºä¾‹\nç½‘é¡µæµè§ˆã€‚ ä¸‹è½½å›¾åƒã€è§†é¢‘æˆ–äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¾‹å¦‚æ¡Œé¢åº”ç”¨ç¨‹åºã€‚ ä½¿ç”¨ JavaScript ä¸­çš„ fetch å‡½æ•°å‘ API å‘å‡ºå¼‚æ­¥è¯·æ±‚ã€‚ ç”±äºæ¯ä¸ª HTTP è¯·æ±‚éƒ½åŒ…å«å¤„ç†å®ƒæ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå› æ­¤æœåŠ¡å™¨æ— éœ€è·Ÿè¸ªè¿æ¥å’Œè¯·æ±‚ã€‚\nè¿™ç§æ— çŠ¶æ€è®¾è®¡æ˜¯æœ‰åˆ©çš„ï¼Œå› ä¸ºå®ƒä½¿å¾—å¯ä»¥éƒ¨ç½²é¢å¤–çš„æœåŠ¡å™¨æ¥å¤„ç†è¯·æ±‚ï¼Œè€Œä¸éœ€è¦åœ¨æœåŠ¡å™¨ä¹‹é—´åŒæ­¥çŠ¶æ€é€»è¾‘ã€‚\næ­¤å¤–ï¼Œç”±äºæ¯ä¸ªè¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå› æ­¤é€šè¿‡ä»£ç†è·¯ç”±æ¶ˆæ¯ä»¥æ‰§è¡Œç¼“å­˜ã€åŠ å¯†å’Œå‹ç¼©ç­‰å¢å€¼åŠŸèƒ½å˜å¾—éå¸¸ç®€å•ã€‚\nè¿™ç§æ— çŠ¶æ€æ–¹æ³•çš„ç¼ºç‚¹æ˜¯å®¢æˆ·ç«¯æ‰“å¼€ä¸€ä¸ªä¸´æ—¶è¿æ¥å¹¶ä¸ºæ¯ä¸ªè¯·æ±‚å‘é€å…ƒæ•°æ®ï¼Œä»è€Œäº§ç”Ÿå°‘é‡å¼€é”€ã€‚\nå½“åŠ è½½ç½‘é¡µæˆ–ä¸‹è½½æ–‡ä»¶æ—¶ï¼Œè¿™ç§å¼€é”€å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨å‘é€è´Ÿè½½è¾ƒå°çš„é«˜é¢‘è¯·æ±‚ï¼Œå®ƒå¯èƒ½ä¼šå¯¹åº”ç”¨ç¨‹åºçš„æ€§èƒ½äº§ç”Ÿæ˜¾ç€å½±å“ã€‚\né€šè¿‡ HTTP è¿›è¡Œå®æ—¶æ›´æ–° è¿™ç§æ¨¡å¼ï¼ˆå®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚ï¼ŒæœåŠ¡å™¨å‘å‡ºå“åº”ï¼‰éå¸¸é€‚åˆç½‘é¡µã€æ–‡ä»¶æˆ–åº”ç”¨ç¨‹åºæ•°æ®ç­‰é™æ€èµ„æºã€‚\nä½†æ˜¯ï¼Œè¯·è€ƒè™‘è¿™æ ·ä¸€ç§æƒ…å†µï¼šå®¢æˆ·ä¸çŸ¥é“æ–°ä¿¡æ¯ä½•æ—¶å¯ç”¨ã€‚\nä¾‹å¦‚ï¼Œå‡è®¾æ‚¨æ­£åœ¨ä¸º BBC å®æ–½çªå‘æ–°é—»åŠŸèƒ½ã€‚\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®¢æˆ·ä¸çŸ¥é“æ•…äº‹çš„ä¸‹ä¸€æ¬¡æ›´æ–°ä½•æ—¶ä¼šå‘ç”Ÿã€‚\nç°åœ¨ï¼Œæ‚¨å¯ä»¥å¯¹å®¢æˆ·ç«¯è¿›è¡Œç¼–ç ï¼Œä»¥é¢‘ç¹åœ°å‘å‡º HTTP è¯·æ±‚ï¼Œä»¥é˜²ä¸‡ä¸€å‘ç”ŸæŸäº›æƒ…å†µï¼Œå¹¶ä¸”å¯¹äºå°‘æ•°å®¢æˆ·ç«¯æ¥è¯´ï¼Œè¿™å¯èƒ½å·¥ä½œå¾—è¶³å¤Ÿå¥½ã€‚\nä½†æ˜¯å‡è®¾æ‚¨æœ‰æˆç™¾ä¸Šåƒä¸ªå®¢æˆ·ç«¯ï¼ˆåœ¨ BBC çš„æƒ…å†µä¸‹æœ‰æ•°åä¸‡ä¸ªï¼‰å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œè€Œè¿™äº›è¯·æ±‚åœ¨æ›´æ–°ä¹‹é—´æ²¡æœ‰äº§ç”Ÿä»»ä½•æ–°å†…å®¹ã€‚\nè¿™ä¸ä»…æµªè´¹å¸¦å®½å’ŒæœåŠ¡å™¨èµ„æºï¼Œè€Œä¸”åœ¨æœ€è¿‘çš„è¯·æ±‚å®Œæˆåä¸ä¹…æ›´æ–°å°±ä¼šä¸­æ–­ - å¯èƒ½éœ€è¦å‡ ç§’é’Ÿæ‰èƒ½å‘é€ä¸‹ä¸€ä¸ªè¯·æ±‚å¹¶ä¸”ç”¨æˆ·è·å¾—æ›´æ–°ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿™ç§æ–¹æ³•ç§°ä¸ºHTTP è½®è¯¢ï¼Œå®ƒæ—¢ä¸é«˜æ•ˆä¹Ÿä¸å®æ—¶ï¼\nç›¸åï¼Œå¦‚æœæœåŠ¡å™¨èƒ½å¤Ÿåœ¨æ–°ä¿¡æ¯å¯ç”¨æ—¶å°†æ•°æ®æ¨é€åˆ°å®¢æˆ·ç«¯ï¼Œé‚£å°±æ›´å¥½äº†ï¼Œä½†è¿™ä»æ ¹æœ¬ä¸Šè¿èƒŒäº†è¯·æ±‚-å“åº”æ¨¡å¼çš„åŸåˆ™ã€‚\næˆ–è€…ç¡®å®å¦‚æ­¤ï¼Ÿ\nHTTP æµå¼ä¼ è¾“ å°½ç®¡ HTTP ä»æ ¹æœ¬ä¸Šéµå¾ªè¯·æ±‚-å“åº”æ¨¡å¼ï¼Œä½†æœ‰ä¸€ç§è§£å†³æ–¹æ³•å¯ç”¨äºå®ç°å®æ—¶æ›´æ–°ã€‚\næœåŠ¡å™¨ä¸æ˜¯å‘å‡ºå®Œæ•´çš„å“åº”ï¼Œè€Œæ˜¯å‘å‡ºéƒ¨åˆ† HTTP å“åº”å¹¶ä¿æŒåº•å±‚è¿æ¥æ‰“å¼€ã€‚\nåŸºäºä¸Šä¸€èŠ‚çš„çªå‘æ–°é—»ç¤ºä¾‹ï¼Œé€šè¿‡ HTTP æµï¼ŒæœåŠ¡å™¨å¯ä»¥åœ¨æ¯æ¬¡æ–°é—»æ›´æ–°ä¸­æ–­æ—¶å°†éƒ¨åˆ†å“åº”ï¼ˆå¦‚æœæ‚¨æ„¿æ„ï¼Œå¯ä»¥æ˜¯å—ï¼‰é™„åŠ åˆ°å“åº”æµ - è¿æ¥æ— é™æœŸä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œä½¿æœåŠ¡å™¨èƒ½å¤Ÿæ¨é€å½“æ–°ä¿¡æ¯å¯ç”¨æ—¶ï¼Œä»¥æœ€çŸ­çš„å»¶è¿Ÿå‘å®¢æˆ·ç«¯æä¾›æ–°ä¿¡æ¯ã€‚\nå¦‚æœæ‚¨æœ‰å…´è¶£äº†è§£æœ‰å…³æ­¤æ¨¡å¼åœ¨å®è·µä¸­å¦‚ä½•å·¥ä½œçš„æ›´å¤šä¿¡æ¯ï¼Œæˆ‘ä»¬å·²ç»åœ¨ Ably ç½‘ç«™ä¸Šçš„å…¶ä»–åœ°æ–¹æ’°å†™äº†æœ‰å…³HTTP æµå’ŒæœåŠ¡å™¨å‘é€äº‹ä»¶ï¼ˆHTTP æµçš„æ ‡å‡†å®ç°ï¼‰çš„æ–‡ç« ã€‚\nä½¿ç”¨ HTTP æµï¼ŒæœåŠ¡å™¨å¿…é¡»ç»´æŠ¤å¤§é‡é•¿æœŸè¿æ¥çš„çŠ¶æ€ï¼Œå¹¶ä¸”ä¸èƒ½å†è¢«è§†ä¸ºæ— çŠ¶æ€ã€‚è¿™ç»™æ‰©å±• HTTP æµå¸¦æ¥äº†æ–°çš„æŒ‘æˆ˜ï¼Œå¹¶ä¸”è¿˜å¸¦æ¥äº†å•ç‚¹æ•…éšœã€‚\nHTTP æµå¼ä¼ è¾“çš„ç¼ºç‚¹\nHTTPæµæ˜¯å®ç°å®æ—¶æ›´æ–°çš„å¯è¡Œæ–¹æ³•ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½å°†å…¶è§†ä¸ºå…¨é¢çš„å®æ—¶è§£å†³æ–¹æ¡ˆã€‚\nä¸ WebSocket ç­‰å…¶ä»–å®æ—¶è§£å†³æ–¹æ¡ˆç›¸æ¯”ï¼ŒHTTP æµçš„ä¸»è¦ç¼ºç‚¹æ˜¯ HTTP æ˜¯åŠåŒå·¥åè®®ã€‚è¿™æ„å‘³ç€ï¼Œå°±åƒå¯¹è®²æœºä¸€æ ·ï¼Œä¿¡æ¯ä¸€æ¬¡åªèƒ½é€šè¿‡è¿æ¥å‘ä¸€ä¸ªæ–¹å‘æµåŠ¨ã€‚\nå¯¹äºçªå‘æ–°é—»æˆ–å®æ—¶å›¾è¡¨ç­‰å®æ—¶æ›´æ–°ï¼ˆæ›´æ–°ä¸»è¦ä»æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯çš„å•å‘æµåŠ¨ï¼‰ï¼ŒHTTP æ˜¯åŠåŒå·¥è¿™ä¸€äº‹å®ä¸å¤ªå¯èƒ½ç«‹å³å¸¦æ¥é™åˆ¶ï¼ˆå°½ç®¡æ‚¨å¯èƒ½å¸Œæœ›é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥ä¿è¯æ¶ˆæ¯ä¼ é€’å±‚çš„æœªæ¥å®‰å…¨ï¼‰ä»æœ¬è´¨ä¸Šå…¨åŒå·¥çš„ä¸œè¥¿å¼€å§‹ï¼‰ã€‚\nç„¶è€Œï¼Œå¯¹äºä¿¡æ¯éœ€è¦é€šè¿‡åŒä¸€è¿æ¥åŒæ—¶åœ¨ä¸¤ä¸ªæ–¹å‘æµåŠ¨çš„æƒ…å†µï¼Œå¦‚å¤šäººæ¸¸æˆã€èŠå¤©æˆ–Figma ç­‰åä½œåº”ç”¨ç¨‹åºï¼Œå³ä½¿æµåª’ä½“å‡ºç°ï¼ŒHTTP ä¹Ÿæ˜¾ç„¶ä¸åˆé€‚ã€‚\nå¯¹äºæ­¤ç±»æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘ WebSocketï¼Œè¿™æ˜¯ä¸€ç§ç”¨äºå®æ—¶æ›´æ–°å’ŒåŒå‘é€šä¿¡çš„ä¸€ä½“åŒ–è§£å†³æ–¹æ¡ˆã€‚\nWebSockets ä»€ä¹ˆæ˜¯ WebSocketï¼Ÿ ä¸ HTTP ä¸€æ ·ï¼ŒWebSocketæ˜¯ä¸€ç§é€šä¿¡åè®®ï¼Œä½¿å®¢æˆ·ç«¯ï¼ˆé€šå¸¸æ˜¯ Web æµè§ˆå™¨ï¼Œå› æ­¤å¾—åï¼‰å’ŒæœåŠ¡å™¨èƒ½å¤Ÿç›¸äº’é€šä¿¡\nä¸å…·æœ‰è¯·æ±‚-å“åº”æ¨¡å‹çš„ HTTP ä¸åŒï¼ŒWebSocket ä¸“é—¨è®¾è®¡ç”¨äºå®ç°æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„å®æ—¶åŒå‘é€šä¿¡ã€‚\nè¿™æ„å‘³ç€æœåŠ¡å™¨å¯ä»¥åœ¨å®æ—¶æ›´æ–°ï¼ˆä¾‹å¦‚çªå‘æ–°é—»ï¼‰å¯ç”¨æ—¶ç«‹å³æ¨é€å®ƒä»¬ï¼Œè€Œæ— éœ€ç­‰å¾…å®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚ã€‚\næ›´é‡è¦çš„æ˜¯ï¼ŒWebSockets æ˜¯ä¸€ç§å…¨åŒå·¥åè®®ã€‚\nç®€å•æ¥è¯´ï¼Œè¿™æ„å‘³ç€æ•°æ®å¯ä»¥é€šè¿‡åŒä¸€è¿æ¥åŒæ—¶åœ¨ä¸¤ä¸ªæ–¹å‘ä¸ŠæµåŠ¨ï¼Œè¿™ä½¿å¾— WebSocket æˆä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åŒæ ·â€œé¢‘ç¹â€ä¸”éœ€è¦é«˜ååé‡çš„åº”ç”¨ç¨‹åºçš„é¦–é€‰ã€‚æˆ‘ä»¬è°ˆè®ºçš„æ˜¯èŠå¤©ã€åä½œç¼–è¾‘ç­‰ç­‰ã€‚\nWebSocket æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ å°½ç®¡æˆ‘ä»¬æ­£åœ¨æ¯”è¾ƒä¸¤è€…ï¼Œä½†å€¼å¾—æ³¨æ„çš„æ˜¯ HTTP å’Œ WebSocket å¹¶ä¸ç›¸äº’æ’æ–¥ã€‚\nä¸€èˆ¬æ¥è¯´ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºé»˜è®¤ä½¿ç”¨ HTTPï¼Œç„¶åä½¿ç”¨ WebSocket è¿›è¡Œå®æ—¶é€šä¿¡ä»£ç ã€‚\næœ‰è¶£çš„æ˜¯ï¼ŒWebSocket å†…éƒ¨å·¥ä½œçš„æ–¹å¼æ˜¯å°†HTTP è¿æ¥ å‡çº§ä¸º WebSocket è¿æ¥ã€‚\nå½“æ‚¨å»ºç«‹ WebSocket è¿æ¥æ—¶ï¼ŒWebSocket ä¼šå‘ WebSocket æœåŠ¡å™¨å‘å‡º HTTP è¯·æ±‚ï¼Œè¯¢é—®ï¼šâ€œå˜¿ï¼ä½ ä»¬æ”¯æŒ WebSocket å—ï¼Ÿâ€\nå¦‚æœæœåŠ¡å™¨å“åº”â€œæ˜¯â€ï¼Œåˆ™ HTTP è¿æ¥å°†å‡çº§ä¸º WebSocket è¿æ¥ - è¿™ç§°ä¸ºæ‰“å¼€æ¡æ‰‹ã€‚\nWebsocket è¿æ¥/æ–­å¼€çš„é¡ºåº\nè¿™ä¸æ˜¯æ‚¨é€šå¸¸éœ€è¦è€ƒè™‘çš„äº‹æƒ…ï¼Œå› ä¸ºå¤§å¤šæ•° WebSocket API éƒ½ä¼šä¸ºæ‚¨å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚å°½ç®¡å¦‚æ­¤ï¼Œå®ƒè¿˜æ˜¯è¯´æ˜äº† HTTP å’Œ WebSocket ä¹‹é—´çš„å…³ç³»ã€‚\nä¸€æ—¦å»ºç«‹è¿æ¥ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½å¯ä»¥ä»¥æœ€å°çš„å»¶è¿Ÿå®æ—¶ä¼ è¾“å’Œæ¥æ”¶æ•°æ®ï¼Œç›´åˆ°ä»»ä½•ä¸€æ–¹å†³å®šå…³é—­è¿æ¥ã€‚\nä½¿ç”¨ WebSocket è¿›è¡Œå®æ—¶æ›´æ–° HTTP é€šå¸¸ç”± Web æµè§ˆå™¨æ— ç¼å¤„ç†ï¼ˆä¾‹å¦‚ï¼Œå½“æ‚¨åŠ è½½æ­¤é¡µé¢æ—¶ï¼‰ï¼Œè€Œ WebSocket å§‹ç»ˆè¦æ±‚æ‚¨ç¼–å†™è‡ªå®šä¹‰ä»£ç ã€‚\nä¸ºäº†å°†è¿™ä¸ªæƒ³æ³•å˜ä¸ºç°å®ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ JavaScript å’Œå†…ç½®WebSocket Web APIè¿è¡Œ WebSocket çš„ç¤ºä¾‹ï¼š\n// Create WebSocket connection. const socket = new WebSocket(\u0026#34;ws://localhost:8080\u0026#34;); // Connection opened socket.addEventListener(\u0026#34;open\u0026#34;, (event) =\u0026gt; { socket.send(\u0026#34;Hello Server!\u0026#34;); }); // Listen for messages socket.addEventListener(\u0026#34;message\u0026#34;, (event) =\u0026gt; { console.log(\u0026#34;Message from server \u0026#34;, event.data); }); ä¸Šé¢ï¼Œæˆ‘ä»¬ä½¿ç”¨ WebSocket æœåŠ¡å™¨çš„ URL å¯åŠ¨WebSocketæ„é€ å‡½æ•°ï¼ˆæœ¬æ–‡ä¸­æœªæ˜¾ç¤ºï¼‰ã€‚\nè¯·æ³¨æ„ URL çš„å‰ç¼€ws://æ˜¯â€œWebSocketâ€è€Œä¸æ˜¯http://â€œHTTPâ€ã€‚åŒæ ·ï¼Œå½“ä½¿ç”¨åŠ å¯†æ—¶ï¼Œæ‚¨å°†ä½¿ç”¨wss://è€Œä¸æ˜¯ã€‚https://\nå°±åè®®è€Œè¨€ï¼ŒWebSocket å¹¶ä¸æ˜¯ä½çº§åè®®ï¼Œä½†å®ƒä»¬å¾ˆçµæ´»ã€‚\nåœ¨æ‚¨éœ€è¦å¯¹ WebSockets ä»£ç è¿›è¡Œç»å¯¹ç»†ç²’åº¦æ§åˆ¶çš„ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œæ‰€æä¾›çš„çµæ´»æ€§å¯èƒ½éå¸¸æœ‰åˆ©ã€‚ç„¶è€Œï¼Œå¯¹äºè®¸å¤šå¼€å‘äººå‘˜æ¥è¯´ï¼ŒWebSocket çš„å‡†ç³»ç»Ÿå®é™…ä¸Šæ˜¯ä¸€ç§è´Ÿæ‹…ï¼Œå› ä¸ºå®ƒä¼šå¸¦æ¥å¤§é‡é¢å¤–çš„å·¥ä½œã€‚\nWebSocket ä¸çŸ¥é“å¦‚ä½•æ£€æµ‹æ–­å¼€è¿æ¥æˆ–å¦‚ä½•ä»æ–­å¼€è¿æ¥ä¸­æ¢å¤ã€‚æ‚¨éœ€è¦è‡ªå·±å®ç°ç§°ä¸ºå¿ƒè·³çš„ä¸œè¥¿ã€‚ å› ä¸º WebSockets æ˜¯ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹äº HTTP çš„åè®®ï¼Œæ‰€ä»¥æ‚¨æ— æ³•ä» HTTP ä» HTTP ä»£ç†è·å¾—çš„å¢å€¼å†…å®¹ï¼ˆä¾‹å¦‚å‹ç¼©ï¼‰ä¸­å—ç›Šã€‚ ä¸ç›¸å½“æ ‡å‡†åŒ–çš„ HTTP ç›¸æ¯”ï¼Œæ‚¨éœ€è¦å†³å®šè‡ªå·±çš„èº«ä»½éªŒè¯å’Œé”™è¯¯ä»£ç å®ç°æ–¹å¼ã€‚ åœ¨è®¸å¤šæ–¹é¢ï¼Œå½“æ‚¨æ„å»ºä¸€ä¸ªå…¨é¢çš„ WebSocket æ¶ˆæ¯ä¼ é€’å±‚æ—¶ï¼Œæ‚¨æœ€ç»ˆä¼šé‡æ–°å‘æ˜è½®å­ï¼Œå¹¶ä¸”è¿™éœ€è¦æ—¶é—´ - æ‚¨å¯èƒ½æ›´æ„¿æ„èŠ±æ—¶é—´æ¥æ„å»ºåº”ç”¨ç¨‹åºç‹¬æœ‰çš„ä¸œè¥¿ã€‚\nå°½ç®¡ä¸Šé¢çš„ä»£ç ç¤ºä¾‹ä¸­ä½¿ç”¨çš„ WebSocket Web API ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç§æ–¹ä¾¿çš„æ–¹æ³•æ¥è¯´æ˜ WebSocket çš„å·¥ä½œåŸç†ï¼Œä½†é€šå¸¸å¼€å‘äººå‘˜ä¼šé¿å¼€å®ƒï¼Œè€Œè½¬è€Œä½¿ç”¨å®ç°èº«ä»½éªŒè¯ã€é”™è¯¯å¤„ç†ã€å‹ç¼©ç­‰æ‰€æœ‰åŠŸèƒ½çš„å¼€æºåº“ï¼Œä»¥ä¾¿ä½ ï¼Œä»¥åŠåƒ pub/sub æˆ–â€œroomsâ€è¿™æ ·çš„æ¨¡å¼ï¼Œä¸ºä½ æä¾›ä¸€ç§ç®€å•çš„æ–¹å¼æ¥è·¯ç”±æ¶ˆæ¯ã€‚\nè¿™äº› WebSocket åº“å¾€å¾€ä¸“æ³¨äºå‰ç«¯ã€‚åœ¨åç«¯ï¼Œæ‚¨ä»åœ¨ä½¿ç”¨æœ‰çŠ¶æ€åè®®ï¼Œè¿™ä½¿å¾—è·¨æœåŠ¡å™¨åˆ†æ•£å·¥ä½œä»¥å°†åº”ç”¨ç¨‹åºä¸å¯èƒ½å¯¼è‡´æ‹¥å¡ï¼ˆé«˜å»¶è¿Ÿï¼‰ç”šè‡³ä¸­æ–­çš„æ•…éšœéš”ç¦»å¼€æ¥å˜å¾—å¾ˆæ£˜æ‰‹ã€‚\nè™½ç„¶å¼€æºåº“æä¾›äº†å…¨é¢çš„å‰ç«¯è§£å†³æ–¹æ¡ˆï¼Œä½†å¦‚æœæ‚¨æƒ³ç¡®ä¿å®æ—¶ä»£ç ç¨³å¥å¯é ä¸”å»¶è¿Ÿè¾ƒä½ï¼Œé€šå¸¸éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šå®Œæˆæ›´å¤šå·¥ä½œã€‚\nå¼€å‘äººå‘˜è¶Šæ¥è¶Šä¾èµ–Ablyç­‰å®æ—¶ä½“éªŒå¹³å°æ¥è§£å†³æ‰€æœ‰çƒ¦äººçš„æ•°æ®å’ŒåŸºç¡€è®¾æ–½é—®é¢˜ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥ä¸“æ³¨äºä¸ºç”¨æˆ·æ„å»ºå‡ºè‰²çš„å®æ—¶ä½“éªŒã€‚\næ¯”è¾ƒ HTTP ä¸ WebSocket è€ƒè™‘ HTTP å’Œ WebSocket ä¹‹é—´å·®å¼‚çš„ä¸€ä¸ªæœ‰ç”¨æ–¹æ³•æ˜¯é‚®ä»¶ä¸ç”µè¯ã€‚\nHTTPå½“ Tim Bernes-Lee äº 1989 å¹´å‘æ˜ä¸‡ç»´ç½‘å’Œ HTTP æ—¶ï¼Œä¸»è¦æƒ³æ³•æ˜¯é€šè¿‡ç½‘ç»œåœ¨è®¡ç®—æœºä¹‹é—´äº¤æ¢æ–‡æ¡£ã€‚ä»è¿™ä¸ªæ„ä¹‰ä¸Šè¯´ï¼ŒHTTP å¾ˆåƒé‚®ä»¶â€”â€”å®¢æˆ·ç«¯ï¼ˆé€šå¸¸æ˜¯ Web æµè§ˆå™¨ï¼‰ä»æœåŠ¡å™¨è¯·æ±‚ HTML æ–‡æ¡£ï¼Œåç«¯å°†å…¶è·¯ç”±åˆ°å®¢æˆ·ç«¯çš„åœ°å€ã€‚å¦‚æœå®¢æˆ·ç«¯æƒ³è¦æ›´å¤šä¿¡æ¯ï¼Œå®ƒä¼šå‘å‡ºå¦ä¸€ä¸ªè¯·æ±‚ï¼ŒæœåŠ¡å™¨ä¼šå‘é€å…¶ä»–å†…å®¹ã€‚ WebSocketsæƒ³è±¡ä¸€ä¸‹åƒèŠå¤©ã€åä½œç¼–è¾‘å™¨æˆ–å¤šäººæ¸¸æˆè¿™æ ·çš„ç½‘ç»œåº”ç”¨ç¨‹åºï¼Œå…¶ä¸­ä¿¡æ¯ç¡®å®éœ€è¦åœ¨ä¸¤ä¸ªæ–¹å‘ä¸ŠåŒæ—¶æµåŠ¨ã€‚å€Ÿç”¨å‰é¢çš„ç±»æ¯”ï¼Œé‚®ä»¶æ˜¯å¯é çš„ï¼Œä½†å®ƒé€Ÿåº¦æ…¢ä¸”å•å‘ã€‚å½“æ‚¨éœ€è¦ä¿¡æ¯åŒå‘æµåŠ¨æ—¶ï¼Œç”µè¯å°†æ˜¯æ›´å¥½çš„é€‰æ‹©ï¼Œè¿™å°±æ˜¯ WebSocket çš„ä½œç”¨ - åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´æ‰“å¼€è¿ç»­çš„åŒå‘å¯¹è¯ï¼Œä»¥ä¾¿ä¿¡æ¯å¯ä»¥åœ¨ä»»ä¸€æ–¹å‘ä»¥é«˜ååé‡å®æ—¶æµåŠ¨æ–¹å‘ã€‚ é€‰æ‹©å“ªä¸ªï¼šWebSockets è¿˜æ˜¯ HTTPï¼Ÿ å½“ HTTP æ›´å¥½æ—¶ **è¯·æ±‚èµ„æºï¼š**å½“å®¢æˆ·ç«¯éœ€è¦èµ„æºçš„å½“å‰çŠ¶æ€å¹¶ä¸”ä¸éœ€è¦å®æ—¶æ›´æ–°æ—¶ï¼ŒHTTP å°†æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ **è¯·æ±‚å¯ç¼“å­˜èµ„æºï¼š**ç»å¸¸è®¿é—®ä½†ä¸ç»å¸¸æ›´æ”¹çš„èµ„æºå¯ä»¥ä» HTTP ç¼“å­˜ä¸­å—ç›Šã€‚ WebSocket ä¸æ”¯æŒç¼“å­˜ã€‚ å®ç° REST APIï¼š POSTã€GET å’Œ UPDATE ç­‰ HTTP æ–¹æ³•ä¸ REST åŸåˆ™å®Œç¾å¥‘åˆã€‚ **åŒæ­¥äº‹ä»¶ï¼š**è¯·æ±‚-å“åº”æ¨¡å¼éå¸¸é€‚åˆéœ€è¦åŒæ­¥æˆ–éœ€è¦æŒ‰ç‰¹å®šé¡ºåºæ‰§è¡Œçš„æ“ä½œã€‚è¿™æ˜¯å› ä¸º HTTP è¯·æ±‚æ€»æ˜¯ä¼´éšç€ä¸€ä¸ªå“åº”ï¼Œå‘Šè¯‰æ‚¨æ“ä½œçš„ç»“æœï¼ˆæ— è®ºæ˜¯â€œ200 OKâ€è¿˜æ˜¯ä¸æ˜¯ï¼‰ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒWebSocket ä¸ä¿è¯æ¶ˆæ¯å°†ä»¥ä»»ä½•å½¢å¼ç«‹å³å¾—åˆ°ç¡®è®¤ã€‚ æœ€å¤§é™åº¦åœ°æé«˜å…¼å®¹æ€§ï¼š HTTP æ— å¤„ä¸åœ¨ä¸”å¾—åˆ°å¹¿æ³›æ”¯æŒã€‚åœ¨è¶Šæ¥è¶Šç½•è§çš„æƒ…å†µä¸‹ï¼Œè¿‡æ—¶çš„ä¼ä¸šé˜²ç«å¢™é…ç½®é”™è¯¯å¯èƒ½ä¼šå¹²æ‰° WebSocket å‡çº§æ¡æ‰‹ï¼Œä»è€Œé˜»æ­¢å»ºç«‹è¿æ¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦å›é€€åˆ° HTTP æµæˆ–é•¿è½®è¯¢ã€‚ å½“ WebSocket æ›´å¥½æ—¶ **å®æ—¶æ›´æ–°ï¼š**å½“æœ‰æ–°ä¿¡æ¯å¯ç”¨æ—¶éœ€è¦é€šçŸ¥å®¢æˆ·ç«¯æ—¶ï¼ŒWebSockets é€šå¸¸æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ åŒå‘é€šä¿¡ï¼š WebSocket æä¾›ä½å»¶è¿ŸåŒå‘é€šä¿¡ï¼Œå…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œå³æ—¶æ•°æ®ä¼ è¾“ã€‚ä¸ HTTPï¼ˆæ¯æ¬¡æœåŠ¡å™¨å“åº”éƒ½éœ€è¦ä¸€ä¸ªæ–°è¯·æ±‚ï¼‰ä¸åŒï¼ŒWebSocket ä¿æŒæŒä¹…è¿æ¥ï¼Œä½¿å…¶æˆä¸ºèŠå¤©ã€æ¸¸æˆå’Œå®æ—¶æ›´æ–°ç­‰å®æ—¶åº”ç”¨ç¨‹åºçš„ç†æƒ³é€‰æ‹©ã€‚ **ä½å»¶è¿Ÿæ›´æ–°ï¼š**ä¸ HTTP ç›¸æ¯”ï¼ŒWebSocket çš„å¼€é”€æ›´å°‘ï¼Œå› ä¸ºå®ƒä»¬ä¸éœ€è¦æ¯ä¸ªè¯·æ±‚å“åº”å‘¨æœŸçš„æ ‡å¤´å’Œæ¡æ‰‹ã€‚è¿™ç§æ•ˆç‡å¯ä»¥é™ä½æ•°æ®ä¼ è¾“æˆæœ¬å¹¶æé«˜å®æ—¶æƒ…å†µçš„æ€§èƒ½ã€‚ WebSocket ä¸ HTTP å¸¸è§é—®é¢˜è§£ç­” WebSockets æ˜¯ HTTP çš„æ›¿ä»£å“å—ï¼Ÿ ä¸ï¼ŒWebSocket ä¸ä¼šå–ä»£ HTTPã€‚è™½ç„¶è¿™ä¸¤ç§é€šä¿¡åè®®éƒ½ç”¨äº Web å¼€å‘ï¼Œä½†å®ƒä»¬å„è‡ªæœ‰ä¸åŒçš„ç”¨é€”ã€‚ HTTPéµå¾ªè¯·æ±‚-å“åº”æ¨¡å‹ï¼Œä¸»è¦ç”¨äºæ£€ç´¢ç½‘é¡µç­‰é™æ€èµ„æºæˆ–å‘å‡ºæ— çŠ¶æ€APIè¯·æ±‚ã€‚å¦ä¸€æ–¹é¢ï¼ŒWebSocket æ”¯æŒå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„å®æ—¶åŒå‘é€šä¿¡ - å®ƒä»¬éå¸¸é€‚åˆå®æ—¶æ›´æ–°æˆ–éœ€è¦è¿ç»­æ•°æ®äº¤æ¢çš„åº”ç”¨ç¨‹åºã€‚\näººä»¬è¿˜åœ¨ä½¿ç”¨ WebSockets å—ï¼Ÿ WebSocket ä»ç„¶è¢«å¹¿æ³›ä½¿ç”¨ï¼Œå¹¶ä¸”ä»ç„¶æ˜¯åœ¨ Web å¼€å‘ä¸­å®ç°å®æ—¶ä½“éªŒçš„æµè¡Œé€‰æ‹©ã€‚ Slack å’Œ Uber ç­‰æµè¡Œåº”ç”¨ç¨‹åºåˆ©ç”¨ WebSocket æ¥å®ç°å®æ—¶æ•°æ®äº¤æ¢ã€‚\nè™½ç„¶ Web Transport ç­‰æ–°æŠ€æœ¯å’Œåè®®ä¸æ–­å‡ºç°ï¼Œä½† WebSocket å·²è¢«è¯æ˜å¯¹äºå®æ—¶åœºæ™¯æ¥è¯´æ˜¯å¯é ä¸”æœ‰æ•ˆçš„ï¼Œå¼€å‘äººå‘˜ç»å¸¸é€‰æ‹©å®ƒä»¬ï¼Œå› ä¸ºå®ƒä»¬ç®€å•ä¸”å¹¿æ³›çš„æµè§ˆå™¨æ”¯æŒã€‚\nHTTP/2 ä¸ WebSocketsï¼Ÿ HTTP/2 å¼•å…¥äº†å¤šé¡¹åŠŸèƒ½ï¼Œä¾‹å¦‚å¤šè·¯å¤ç”¨ã€æ ‡å¤´å‹ç¼©å’Œæ¯ä¸ªåŸŸçš„æ— é™è¿æ¥ã€‚è¿™æ ·ï¼Œå½“æ‚¨éœ€è¦å®æ—¶æ›´æ–°æ—¶ï¼ŒHTTP/2 ä½¿ HTTP æµå’Œ SSEï¼ˆHTTP æµçš„æ ‡å‡†åŒ–å®ç°ï¼‰æˆä¸º WebSocket çš„å¯è¡Œæ›¿ä»£æ–¹æ¡ˆã€‚è¯è™½å¦‚æ­¤ï¼ŒWebSockets æ˜¯ç›®å‰åœ¨æµè§ˆå™¨ä¸­å®ç°å…¨åŒå·¥åŒå‘é€šä¿¡çš„å”¯ä¸€æ–¹æ³•ã€‚\nWebSocket æ¯” HTTP æ›´å¥½å—ï¼Ÿ WebSocket æœ¬è´¨ä¸Šå¹¶ä¸æ¯” HTTP æ›´å¥½ - ç›¸åï¼Œå®ƒä»¬æœåŠ¡äºä¸åŒçš„ç›®çš„ã€‚ HTTP æ˜¯ä¸€ç§è¯·æ±‚-å“åº”åè®®ï¼Œæœ€é€‚åˆå®¢æˆ·ç«¯å¶å°”å‘æœåŠ¡å™¨å‘å‡ºæ•°æ®å’Œèµ„æºè¯·æ±‚çš„ä¼ ç»Ÿ Web åº”ç”¨ç¨‹åºã€‚å¦ä¸€æ–¹é¢ï¼ŒWebSocket åœ¨å®æ—¶ã€åŒå‘é€šä¿¡æ–¹é¢è¡¨ç°å‡ºè‰²ï¼Œä½¿å…¶æˆä¸ºéœ€è¦æŒç»­æ•°æ®æµå’Œå³æ—¶æ›´æ–°çš„åº”ç”¨ç¨‹åºçš„ç†æƒ³é€‰æ‹©ï¼Œä¾‹å¦‚å®æ—¶èŠå¤©ã€åœ¨çº¿æ¸¸æˆå’Œåä½œå·¥å…·ã€‚\nä¸ºä»€ä¹ˆä¸ä½¿ç”¨ WebSockets æ¥å®Œæˆæ‰€æœ‰äº‹æƒ…å‘¢ï¼Ÿ HTTP æ˜¯ Web æµè§ˆå™¨ç”¨æ¥è¯·æ±‚æ•°æ®å’Œèµ„æºçš„æ ‡å‡†åè®®ã€‚ä¾‹å¦‚ï¼Œå½“æ¶‰åŠåˆ°è·å–ç½‘é¡µæ—¶ï¼ŒWebSockets å°±ä¸åˆé€‚äº†ã€‚\nç†è®ºä¸Šï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ WebSocket è¿›è¡Œ API é€šä¿¡ï¼ˆä¾‹å¦‚ï¼Œè€Œä¸æ˜¯ HTTP REST APIï¼‰ã€‚å®é™…ä¸Šï¼Œæ²¡æœ‰ä»»ä½•ä»¤äººä¿¡æœçš„ç†ç”±è¿™æ ·åšï¼Œå¹¶ä¸” HTTP çš„æ— çŠ¶æ€æ€§è´¨æ›´é€‚åˆè¿™äº›ç±»å‹çš„çŸ­æœŸè¯·æ±‚ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ‚¨åº”è¯¥å‡è®¾æ‚¨çš„ API é»˜è®¤æ˜¯ä¼ ç»Ÿçš„ HTTPï¼Œç„¶åå‡çº§åˆ° WebSockets ä»¥è·å¾—å®æ—¶åŠŸèƒ½ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2024/05/07/websockets-vs-http/","summary":"åŸæ–‡é“¾æ¥ï¼šhttps://ably.com/topic/websockets-vs-http\nå½“è°ˆåˆ° WebSocket ä¸ HTTP æ—¶ï¼Œå†³å®šä½¿ç”¨å“ªä¸€ç§å¹¶ä¸æ€»æ˜¯é‚£ä¹ˆæ˜ç¡®ã€‚å“ªä¸€ä¸ªæ›´å¥½ï¼Ÿæ‚¨çš„åº”ç”¨ç¨‹åºåº”è¯¥ä½¿ç”¨å“ªä¸€æ¬¾ï¼Ÿ\nä½†é—®é¢˜çš„ç­”æ¡ˆä¸ä¸€å®šæ˜¯å…¶ä¸­ä¹‹ä¸€ - å¼€å‘äººå‘˜ç»å¸¸æ ¹æ®åœºæ™¯åœ¨åŒä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­åŒæ—¶ä½¿ç”¨ WebSocket å’Œ HTTPã€‚æ›´é‡è¦çš„é—®é¢˜æ˜¯ - æˆ‘å¦‚ä½•ç¡®å®š WebSockets è¿˜æ˜¯ HTTP æ˜¯ç‰¹å®šç±»å‹é€šä¿¡çš„æ­£ç¡®é€šä¿¡åè®®ï¼Ÿ\nè¿™æ˜¯æ‚¨éœ€è¦äº†è§£çš„ä¸€åˆ‡ã€‚\nWebSocket ä¸ HTTP æ¦‚è§ˆ åœ¨æ­¤é¡µé¢ä¸Šï¼Œæˆ‘ä»¬å°†æ¢è®¨è¿™äº›æŠ€æœ¯çš„å·¥ä½œåŸç†ã€å®ƒä»¬åœ¨å®ç°å®æ—¶é€šä¿¡æ–¹é¢çš„è¡¨ç°å¦‚ä½•ï¼Œå¹¶å°±åœ¨å“ªäº›åœºæ™¯ä¸­ä½¿ç”¨å“ªäº›æŠ€æœ¯æä¾›å…·ä½“æŒ‡å¯¼ã€‚\nå¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾é«˜çº§æ¯”è¾ƒï¼Œä»¥ä¸‹æ˜¯ä¸»è¦å·®å¼‚ä¸€ç›®äº†ç„¶ï¼š\nè¯·ç»§ç»­é˜…è¯»ä»¥è¯¦ç»†äº†è§£è¿™ä¸¤ç§æµè¡Œåè®®çš„æ¯”è¾ƒã€‚\nHTTPåè®® ä»€ä¹ˆæ˜¯ HTTPï¼Ÿ ä»æ ¹æœ¬ä¸Šè®²ï¼ŒHTTP æ˜¯ä¸€ç§é€šä¿¡åè®®ï¼Œä½¿å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ Web æµè§ˆå™¨ï¼‰å’ŒæœåŠ¡å™¨èƒ½å¤Ÿå…±äº«ä¿¡æ¯ã€‚\nä¾‹å¦‚ï¼ŒHTML æ–‡æ¡£ã€å›¾åƒã€åº”ç”¨ç¨‹åºæ•°æ® (JSON) ç­‰ã€‚\nå¾ˆéš¾æƒ³å‡ºæ¯”æ‚¨ç°åœ¨æ­£åœ¨é˜…è¯»çš„æ­¤é¡µé¢æ›´å¥½çš„ HTTP å®é™…ç¤ºä¾‹ã€‚\nå½“æ‚¨åŠ è½½æ­¤é¡µé¢æ—¶ï¼Œæ‚¨çš„æµè§ˆå™¨ä¼šå‘å‡º HTTP è¯·æ±‚ï¼ŒæœåŠ¡å™¨ä¼šä½¿ç”¨æ‚¨å½“å‰æ­£åœ¨é˜…è¯»çš„ HTML æ–‡æ¡£æ¥å“åº”è¯¥è¯·æ±‚ã€‚\nHTTP æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ HTTP éµå¾ªè¯·æ±‚-å“åº”æ¶ˆæ¯ä¼ é€’æ¨¡å¼ï¼Œå…¶ä¸­å®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚ï¼ŒWeb æœåŠ¡å™¨å‘é€å“åº”ï¼Œè¯¥å“åº”ä¸ä»…åŒ…æ‹¬è¯·æ±‚çš„å†…å®¹ï¼Œè¿˜åŒ…æ‹¬æœ‰å…³è¯·æ±‚çš„ç›¸å…³ä¿¡æ¯ã€‚\nåœ¨åº•å±‚ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½ä¼šæ‰“å¼€ä¸€ä¸ªä¸æœåŠ¡å™¨çš„çŸ­æš‚è¿æ¥ï¼Œç„¶åå…³é—­ã€‚\nHTTP ç¤ºä¾‹\nç½‘é¡µæµè§ˆã€‚ ä¸‹è½½å›¾åƒã€è§†é¢‘æˆ–äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¾‹å¦‚æ¡Œé¢åº”ç”¨ç¨‹åºã€‚ ä½¿ç”¨ JavaScript ä¸­çš„ fetch å‡½æ•°å‘ API å‘å‡ºå¼‚æ­¥è¯·æ±‚ã€‚ ç”±äºæ¯ä¸ª HTTP è¯·æ±‚éƒ½åŒ…å«å¤„ç†å®ƒæ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå› æ­¤æœåŠ¡å™¨æ— éœ€è·Ÿè¸ªè¿æ¥å’Œè¯·æ±‚ã€‚\nè¿™ç§æ— çŠ¶æ€è®¾è®¡æ˜¯æœ‰åˆ©çš„ï¼Œå› ä¸ºå®ƒä½¿å¾—å¯ä»¥éƒ¨ç½²é¢å¤–çš„æœåŠ¡å™¨æ¥å¤„ç†è¯·æ±‚ï¼Œè€Œä¸éœ€è¦åœ¨æœåŠ¡å™¨ä¹‹é—´åŒæ­¥çŠ¶æ€é€»è¾‘ã€‚\næ­¤å¤–ï¼Œç”±äºæ¯ä¸ªè¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå› æ­¤é€šè¿‡ä»£ç†è·¯ç”±æ¶ˆæ¯ä»¥æ‰§è¡Œç¼“å­˜ã€åŠ å¯†å’Œå‹ç¼©ç­‰å¢å€¼åŠŸèƒ½å˜å¾—éå¸¸ç®€å•ã€‚\nè¿™ç§æ— çŠ¶æ€æ–¹æ³•çš„ç¼ºç‚¹æ˜¯å®¢æˆ·ç«¯æ‰“å¼€ä¸€ä¸ªä¸´æ—¶è¿æ¥å¹¶ä¸ºæ¯ä¸ªè¯·æ±‚å‘é€å…ƒæ•°æ®ï¼Œä»è€Œäº§ç”Ÿå°‘é‡å¼€é”€ã€‚\nå½“åŠ è½½ç½‘é¡µæˆ–ä¸‹è½½æ–‡ä»¶æ—¶ï¼Œè¿™ç§å¼€é”€å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨å‘é€è´Ÿè½½è¾ƒå°çš„é«˜é¢‘è¯·æ±‚ï¼Œå®ƒå¯èƒ½ä¼šå¯¹åº”ç”¨ç¨‹åºçš„æ€§èƒ½äº§ç”Ÿæ˜¾ç€å½±å“ã€‚\né€šè¿‡ HTTP è¿›è¡Œå®æ—¶æ›´æ–° è¿™ç§æ¨¡å¼ï¼ˆå®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚ï¼ŒæœåŠ¡å™¨å‘å‡ºå“åº”ï¼‰éå¸¸é€‚åˆç½‘é¡µã€æ–‡ä»¶æˆ–åº”ç”¨ç¨‹åºæ•°æ®ç­‰é™æ€èµ„æºã€‚\nä½†æ˜¯ï¼Œè¯·è€ƒè™‘è¿™æ ·ä¸€ç§æƒ…å†µï¼šå®¢æˆ·ä¸çŸ¥é“æ–°ä¿¡æ¯ä½•æ—¶å¯ç”¨ã€‚\nä¾‹å¦‚ï¼Œå‡è®¾æ‚¨æ­£åœ¨ä¸º BBC å®æ–½çªå‘æ–°é—»åŠŸèƒ½ã€‚\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®¢æˆ·ä¸çŸ¥é“æ•…äº‹çš„ä¸‹ä¸€æ¬¡æ›´æ–°ä½•æ—¶ä¼šå‘ç”Ÿã€‚\nç°åœ¨ï¼Œæ‚¨å¯ä»¥å¯¹å®¢æˆ·ç«¯è¿›è¡Œç¼–ç ï¼Œä»¥é¢‘ç¹åœ°å‘å‡º HTTP è¯·æ±‚ï¼Œä»¥é˜²ä¸‡ä¸€å‘ç”ŸæŸäº›æƒ…å†µï¼Œå¹¶ä¸”å¯¹äºå°‘æ•°å®¢æˆ·ç«¯æ¥è¯´ï¼Œè¿™å¯èƒ½å·¥ä½œå¾—è¶³å¤Ÿå¥½ã€‚\nä½†æ˜¯å‡è®¾æ‚¨æœ‰æˆç™¾ä¸Šåƒä¸ªå®¢æˆ·ç«¯ï¼ˆåœ¨ BBC çš„æƒ…å†µä¸‹æœ‰æ•°åä¸‡ä¸ªï¼‰å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œè€Œè¿™äº›è¯·æ±‚åœ¨æ›´æ–°ä¹‹é—´æ²¡æœ‰äº§ç”Ÿä»»ä½•æ–°å†…å®¹ã€‚\nè¿™ä¸ä»…æµªè´¹å¸¦å®½å’ŒæœåŠ¡å™¨èµ„æºï¼Œè€Œä¸”åœ¨æœ€è¿‘çš„è¯·æ±‚å®Œæˆåä¸ä¹…æ›´æ–°å°±ä¼šä¸­æ–­ - å¯èƒ½éœ€è¦å‡ ç§’é’Ÿæ‰èƒ½å‘é€ä¸‹ä¸€ä¸ªè¯·æ±‚å¹¶ä¸”ç”¨æˆ·è·å¾—æ›´æ–°ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿™ç§æ–¹æ³•ç§°ä¸ºHTTP è½®è¯¢ï¼Œå®ƒæ—¢ä¸é«˜æ•ˆä¹Ÿä¸å®æ—¶ï¼\nç›¸åï¼Œå¦‚æœæœåŠ¡å™¨èƒ½å¤Ÿåœ¨æ–°ä¿¡æ¯å¯ç”¨æ—¶å°†æ•°æ®æ¨é€åˆ°å®¢æˆ·ç«¯ï¼Œé‚£å°±æ›´å¥½äº†ï¼Œä½†è¿™ä»æ ¹æœ¬ä¸Šè¿èƒŒäº†è¯·æ±‚-å“åº”æ¨¡å¼çš„åŸåˆ™ã€‚\næˆ–è€…ç¡®å®å¦‚æ­¤ï¼Ÿ\nHTTP æµå¼ä¼ è¾“ å°½ç®¡ HTTP ä»æ ¹æœ¬ä¸Šéµå¾ªè¯·æ±‚-å“åº”æ¨¡å¼ï¼Œä½†æœ‰ä¸€ç§è§£å†³æ–¹æ³•å¯ç”¨äºå®ç°å®æ—¶æ›´æ–°ã€‚\næœåŠ¡å™¨ä¸æ˜¯å‘å‡ºå®Œæ•´çš„å“åº”ï¼Œè€Œæ˜¯å‘å‡ºéƒ¨åˆ† HTTP å“åº”å¹¶ä¿æŒåº•å±‚è¿æ¥æ‰“å¼€ã€‚\nåŸºäºä¸Šä¸€èŠ‚çš„çªå‘æ–°é—»ç¤ºä¾‹ï¼Œé€šè¿‡ HTTP æµï¼ŒæœåŠ¡å™¨å¯ä»¥åœ¨æ¯æ¬¡æ–°é—»æ›´æ–°ä¸­æ–­æ—¶å°†éƒ¨åˆ†å“åº”ï¼ˆå¦‚æœæ‚¨æ„¿æ„ï¼Œå¯ä»¥æ˜¯å—ï¼‰é™„åŠ åˆ°å“åº”æµ - è¿æ¥æ— é™æœŸä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œä½¿æœåŠ¡å™¨èƒ½å¤Ÿæ¨é€å½“æ–°ä¿¡æ¯å¯ç”¨æ—¶ï¼Œä»¥æœ€çŸ­çš„å»¶è¿Ÿå‘å®¢æˆ·ç«¯æä¾›æ–°ä¿¡æ¯ã€‚","title":"[è¯‘]WebSocketä¸HTTPï¼š2024å¹´ä¸ºæ‚¨çš„é¡¹ç›®é€‰æ‹©å“ªä¸€ä¸ª"},{"content":"åŸæ–‡é“¾æ¥ï¼šhttps://ably.com/topic/websockets-kafka\nApache Kafka æ˜¯ç›®å‰æœ€å¼ºå¤§çš„å¼‚æ­¥æ¶ˆæ¯ä¼ é€’æŠ€æœ¯ä¹‹ä¸€ã€‚ Kafka ç”± Jay Krepsã€Jun Rao å’Œ Neha Narkhede ç­‰å›¢é˜Ÿäº 2010 å¹´åœ¨ LinkedIn è®¾è®¡ï¼Œå¹¶äº 2011 å¹´åˆå¼€æºã€‚å¦‚ä»Šï¼Œè¯¥å·¥å…·è¢«ä¼—å¤šå…¬å¸ï¼ˆåŒ…æ‹¬ç§‘æŠ€å·¨å¤´ï¼Œä¾‹å¦‚ Slackã€Airbnb æˆ– Netflix ä½¿ç”¨ï¼‰ä¸ºå…¶å®æ—¶æ•°æ®æµç®¡é“æä¾›æ”¯æŒã€‚\nç”±äº Kafka å¦‚æ­¤å—æ¬¢è¿ï¼Œæˆ‘å¾ˆå¥½å¥‡æ˜¯å¦å¯ä»¥ä½¿ç”¨å®ƒé€šè¿‡äº’è”ç½‘å’Œ WebSockets å°†å®æ—¶æ•°æ®ç›´æ¥æµå¼ä¼ è¾“ç»™æœ€ç»ˆç”¨æˆ·ã€‚æ¯•ç«Ÿï¼ŒKafka å…·æœ‰ä¸€ç³»åˆ—ç‰¹å¾ï¼Œä¼¼ä¹ä½¿å…¶æˆä¸ºä¸€ä¸ªå€¼å¾—æ³¨æ„çš„é€‰æ‹©ï¼Œä¾‹å¦‚ï¼š\né«˜é€šé‡ ä½å»¶è¿Ÿ é«˜å¹¶å‘ å®¹é”™èƒ½åŠ› æŒä¹…æ€§ï¼ˆæŒä¹…æ€§ï¼‰ ç”¨äºå°† Kafka æ¶ˆæ¯æµå¼ä¼ è¾“åˆ°é¢å‘äº’è”ç½‘çš„å®¢æˆ·ç«¯çš„ç°æœ‰è§£å†³æ–¹æ¡ˆ æˆ‘å¼€å§‹ç ”ç©¶å®æ—¶å¼€å‘ç¤¾åŒºå¯¹è¿™ä¸ªç”¨ä¾‹çš„çœ‹æ³•ã€‚æˆ‘å¾ˆå¿«å‘ç° Kafka æœ€åˆè®¾è®¡ç”¨äºå®‰å…¨ç½‘ç»œå†…è¿›è¡Œæœºå™¨å¯¹æœºå™¨é€šä¿¡ã€‚è¿™è®©æˆ‘æƒ³åˆ°ï¼Œå¦‚æœæ‚¨æƒ³é€šè¿‡ WebSocket å°†æ•°æ®ä» Kafka æµå¼ä¼ è¾“åˆ°é¢å‘äº’è”ç½‘çš„ç”¨æˆ·ï¼Œæ‚¨å¯èƒ½éœ€è¦ä½¿ç”¨æŸç§ä¸­é—´ä»¶ã€‚\næˆ‘ç»§ç»­ç ”ç©¶ï¼Œå¸Œæœ›æ‰¾åˆ°ä¸€äº›å¯ä»¥å……å½“ä¸­é—´ä»¶çš„å¼€æºè§£å†³æ–¹æ¡ˆã€‚æˆ‘å‘ç°äº†å…¶ä¸­çš„å‡ ä¸ªï¼Œç†è®ºä¸Šå¯ä»¥ç”¨ä½œ Kafka å’Œé€šè¿‡äº’è”ç½‘è¿æ¥æ•°æ®æµçš„å®¢æˆ·ç«¯ä¹‹é—´çš„ä¸­ä»‹ï¼š\ntransfers_websockets_service kafka-websocket kafka-proxy-ws ä¸å¹¸çš„æ˜¯ï¼Œä¸Šé¢åˆ—å‡ºçš„æ‰€æœ‰è§£å†³æ–¹æ¡ˆéƒ½åªæ˜¯æ¦‚å¿µè¯æ˜ï¼Œä»…æ­¤è€Œå·²ã€‚å®ƒä»¬çš„åŠŸèƒ½é›†æœ‰é™ï¼Œå¹¶ä¸”å°šæœªåšå¥½ç”Ÿäº§å‡†å¤‡ï¼ˆå°¤å…¶æ˜¯å¤§è§„æ¨¡ç”Ÿäº§ï¼‰ã€‚\nç„¶åæˆ‘ç ”ç©¶äº†æˆç†Ÿçš„ç§‘æŠ€å…¬å¸å¦‚ä½•è§£å†³è¿™ä¸ª Kafka ç”¨ä¾‹ï¼›çœ‹æ¥ä»–ä»¬ç¡®å®åœ¨ä½¿ç”¨æŸç§ä¸­é—´ä»¶ã€‚ä¾‹å¦‚ï¼ŒTrello å¼€å‘äº†WebSocket åè®®çš„ç®€åŒ–ç‰ˆæœ¬ï¼Œä»…æ”¯æŒè®¢é˜…å’Œå–æ¶ˆè®¢é˜…å‘½ä»¤ã€‚ Slack æä¾›äº†å¦ä¸€ä¸ªä¾‹å­ã€‚è¯¥å…¬å¸æ„å»ºäº†ä¸€ä¸ªåä¸ºFlannelçš„ä»£ç†ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯éƒ¨ç½²åˆ°è¾¹ç¼˜å­˜åœ¨ç‚¹çš„åº”ç”¨ç¨‹åºçº§ç¼“å­˜æœåŠ¡ã€‚\nå½“ç„¶ï¼Œåƒ Trello æˆ– Slack è¿™æ ·çš„å…¬å¸æœ‰èƒ½åŠ›æŠ•èµ„æ‰€éœ€çš„èµ„æºæ¥æ„å»ºæ­¤ç±»è§£å†³æ–¹æ¡ˆã€‚ç„¶è€Œï¼Œå¼€å‘è‡ªå·±çš„ä¸­é—´ä»¶å¹¶ä¸æ€»æ˜¯ä¸€ä¸ªå¯è¡Œçš„é€‰æ‹©â€”â€”è¿™æ˜¯ä¸€é¡¹éå¸¸å¤æ‚çš„ä»»åŠ¡ï¼Œéœ€è¦å¤§é‡çš„èµ„æºå’Œæ—¶é—´ã€‚å¦ä¸€ç§é€‰æ‹©ï¼ˆæœ€æ–¹ä¾¿ã€æœ€å¸¸è§çš„ä¸€ç§ï¼‰æ˜¯ä½¿ç”¨å·²å»ºç«‹çš„ç¬¬ä¸‰æ–¹è§£å†³æ–¹æ¡ˆã€‚\næ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œæ™®éçš„å…±è¯†ä¼¼ä¹æ˜¯ Kafka æœ¬èº«ä¸é€‚åˆé€šè¿‡äº’è”ç½‘è¿›è¡Œæœ€åä¸€è‹±é‡Œäº¤ä»˜ï¼›æ‚¨éœ€è¦å°†å®ƒä¸å¦ä¸€ä¸ªç»„ä»¶ç»“åˆä½¿ç”¨ï¼šé¢å‘äº’è”ç½‘çš„å®æ—¶æ¶ˆæ¯ä¼ é€’æœåŠ¡ã€‚\nåœ¨ Ablyï¼Œæˆ‘ä»¬çš„è®¸å¤šå®¢æˆ·éƒ½é€šè¿‡æˆ‘ä»¬é¢å‘äº’è”ç½‘çš„ pub/sub å®æ—¶æ¶ˆæ¯æœåŠ¡ä¼ è¾“ Kafkaæ¶ˆæ¯ã€‚ä¸ºäº†æ¼”ç¤ºå®ƒæ˜¯å¤šä¹ˆç®€å•ï¼Œä¸‹é¢æ˜¯å¦‚ä½•ä» Kafka æ¶ˆè´¹æ•°æ®å¹¶å°†å…¶å‘å¸ƒåˆ° Ably çš„ç¤ºä¾‹ï¼š\nconst kafka = require(\u0026#39;kafka-node\u0026#39;); const Ably = require(\u0026#39;ably\u0026#39;); const ably = new Ably.Realtime({{ABLY_API_KEY}}); const ablyChannel = ably.channels.get(\u0026#39;kafka-example\u0026#39;); const Consumer = kafka.Consumer; const client = new kafka.KafkaClient({ kafkaHost: {{KAFKA_SERVER_URL}} }); const consumer = new Consumer( client, [ { topic: {{KAFKA_TOPIC}}, partition: 0 } ] ); consumer.on(\u0026#39;message\u0026#39;, function (message) { ablyChannel.publish(\u0026#39;kafka-event\u0026#39;, message.value); }); ä»¥ä¸‹æ˜¯å®¢æˆ·ç«¯è¿æ¥åˆ° Ably æ¥ä½¿ç”¨æ•°æ®çš„æ–¹å¼ï¼š\nconst Ably = require(\u0026#39;ably\u0026#39;); const ably = new Ably.Realtime({{ABLY_KEY}}); const channel = ably.channels.get(\u0026#39;kafka-example\u0026#39;); channel.subscribe(function(message) { console.log(\u0026#39;kafka message data: \u0026#39;, message.data); }); æ‚¨å¯ä»¥å†³å®šåœ¨ Kafka å’Œå®¢æˆ·ç«¯è®¾å¤‡ä¹‹é—´ä½¿ç”¨ä»»ä½•é¢å‘äº’è”ç½‘çš„å®æ—¶æ¶ˆæ¯ä¼ é€’æœåŠ¡ã€‚ä½†æ˜¯ï¼Œæ— è®ºæ‚¨å¦‚ä½•é€‰æ‹©ï¼Œæ‚¨éƒ½éœ€è¦è€ƒè™‘è¯¥æ¶ˆæ¯ä¼ é€’æœåŠ¡å±‚å¿…é¡»èƒ½å¤Ÿåº”å¯¹çš„æ‰€æœ‰æŒ‘æˆ˜ã€‚\nä½¿ç”¨ Kafka å’Œæ¶ˆæ¯ä¸­é—´ä»¶ï¼šå·¥ç¨‹å’Œè¿è¥æŒ‘æˆ˜ åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘å¿…é¡»å¼ºè°ƒæœ¬æ–‡ä»‹ç»çš„è®¾è®¡æ¨¡å¼æ¶‰åŠåœ¨ Kafka å’Œé¢å‘ Internet çš„ç”¨æˆ·ä¹‹é—´ä½¿ç”¨åŸºäº WebSocket çš„å®æ—¶æ¶ˆæ¯ä¼ é€’ä¸­é—´ä»¶ã€‚\nè¿˜å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæˆ‘å†™è¿™ç¯‡æ–‡ç« çš„åŸºç¡€æ˜¯ Ably å›¢é˜Ÿæ‹¥æœ‰çš„å…³äºå¤§è§„æ¨¡å®æ—¶æ•°æ®æµæŒ‘æˆ˜çš„å¹¿æ³›é›†ä½“çŸ¥è¯†ã€‚\næˆ‘ç°åœ¨å°†æ·±å…¥æ¢è®¨æ‚¨éœ€è¦è€ƒè™‘çš„å…³é”®é—®é¢˜ï¼Œä¾‹å¦‚æ¶ˆæ¯æ‰‡å‡ºã€æœåŠ¡å¯ç”¨æ€§ã€å®‰å…¨æ€§ã€æ¶æ„æˆ–ç®¡ç†èƒŒå‹ã€‚å¦‚æœæ‚¨è¦æ„å»ºä¸€ä¸ªå¯æ‰©å±•ä¸”å¯é çš„ç³»ç»Ÿï¼Œæ‚¨é€‰æ‹©åœ¨ Kafka å’Œæœ€ç»ˆç”¨æˆ·ä¹‹é—´ä½¿ç”¨çš„é¢å‘äº’è”ç½‘çš„æ¶ˆæ¯ä¼ é€’æœåŠ¡å¿…é¡»èƒ½å¤Ÿæœ‰æ•ˆå¤„ç†æ‰€æœ‰è¿™äº›å¤æ‚æ€§ã€‚\næ¶ˆæ¯è·¯ç”± æ‚¨å¿…é¡»è€ƒè™‘çš„å…³é”®äº‹é¡¹ä¹‹ä¸€æ˜¯å¦‚ä½•ç¡®ä¿å®¢æˆ·ç«¯è®¾å¤‡ä»…æ¥æ”¶ç›¸å…³æ¶ˆæ¯ã€‚å¤§å¤šæ•°æ—¶å€™ï¼Œå®¢æˆ·ç«¯å’Œ Kafka ä¸»é¢˜ä¹‹é—´çš„ 1:1 æ˜ å°„æ˜¯ä¸å¯æ‰©å±•çš„ï¼Œå› æ­¤æ‚¨å°†æ‹¥æœ‰è·¨å¤šä¸ªè®¾å¤‡å…±äº«çš„ä¸»é¢˜ã€‚\nä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€å®¶ä¿¡ç”¨å¡å…¬å¸æƒ³è¦å‘å…¶å®¢æˆ·ä¼ è¾“å¤§é‡äº¤æ˜“ä¿¡æ¯ã€‚è¯¥å…¬å¸ä½¿ç”¨ä¸€ä¸ªè¢«åˆ†å‰²ï¼ˆåˆ†ç‰‡ï¼‰ä¸ºå¤šä¸ªåˆ†åŒºçš„ä¸»é¢˜æ¥å¢åŠ æ¶ˆæ¯çš„æ€»ååé‡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒKafka æä¾›æ’åºä¿è¯â€”â€”äº‹åŠ¡æŒ‰åˆ†åŒºæ’åºã€‚\nç„¶è€Œï¼Œå½“å®¢æˆ·ç«¯è®¾å¤‡é€šè¿‡æµè§ˆå™¨è¿æ¥ä»¥æ¥æ”¶äº¤æ˜“ä¿¡æ¯æ—¶ï¼Œå®ƒåªå¸Œæœ›å¹¶ä¸”åº”è¯¥åªè¢«å…è®¸æ¥æ”¶ä¸è¯¥ç”¨æˆ·/è®¾å¤‡ç›¸å…³çš„äº¤æ˜“ã€‚ä½†æ˜¯å®¢æˆ·ç«¯ä¸çŸ¥é“å®ƒéœ€è¦ä»å“ªä¸ªåˆ†åŒºæ¥æ”¶ä¿¡æ¯ï¼Œå¹¶ä¸” Kafka æ²¡æœ‰å¯ä»¥å¸®åŠ©è§£å†³æ­¤é—®é¢˜çš„æœºåˆ¶ã€‚\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ‚¨éœ€è¦åœ¨ Kafka å±‚å’Œæœ€ç»ˆç”¨æˆ·ä¹‹é—´ä½¿ç”¨é¢å‘äº’è”ç½‘çš„å®æ—¶æ¶ˆæ¯ä¼ é€’æœåŠ¡ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚\nä½¿ç”¨è¯¥æ¨¡å‹çš„å¥½å¤„ï¼š\nå°†æ¶ˆæ¯ä» Kafka çµæ´»è·¯ç”±åˆ°é¢å‘äº’è”ç½‘çš„ä¸»é¢˜ã€‚ ç¡®ä¿é€šè¿‡ Internet è¿æ¥çš„å®¢æˆ·ç«¯ä»…è®¢é˜…ç›¸å…³ä¸»é¢˜ã€‚ å¢å¼ºå®‰å…¨æ€§ï¼Œå› ä¸ºå®¢æˆ·ç«¯æ— æ³•è®¿é—®éƒ¨ç½² Kafka é›†ç¾¤çš„å®‰å…¨ç½‘ç»œï¼›æ•°æ®ä»Kafkaæ¨é€åˆ°é¢å‘äº’è”ç½‘çš„å®æ—¶æ¶ˆæ¯æœåŠ¡ï¼›å®¢æˆ·ç«¯è®¾å¤‡ä¸åè€…äº¤äº’ï¼Œè€Œä¸æ˜¯ç›´æ¥ä» Kafka æå–æ•°æ®ã€‚ ç³»ç»Ÿå®‰å…¨ Kafka ä¸ç”¨äºæœ€åä¸€è‹±é‡Œäº¤ä»˜çš„ä¸»è¦åŸå› ä¹‹ä¸€ä¸å®‰å…¨æ€§å’Œå¯ç”¨æ€§æœ‰å…³ã€‚ç®€è€Œè¨€ä¹‹ï¼Œæ‚¨ä¸å¸Œæœ›æ‚¨çš„æ•°æ®å¤„ç†ç»„ä»¶å¯ä»¥ç›´æ¥é€šè¿‡ Internet è®¿é—®ã€‚\nä¸ºäº†ä¿æŠ¤æ•°æ®çš„å®Œæ•´æ€§å’Œç³»ç»Ÿçš„å¯ç”¨æ€§ï¼Œæ‚¨éœ€è¦ä¸€ä¸ªé¢å‘äº’è”ç½‘çš„å®æ—¶æ¶ˆæ¯ä¼ é€’æœåŠ¡ï¼Œè¯¥æœåŠ¡å¯ä»¥å……å½“ Kafka ä¸å…¶æµå¼ä¼ è¾“æ¶ˆæ¯çš„å®¢æˆ·ç«¯è®¾å¤‡ä¹‹é—´çš„å®‰å…¨å±éšœã€‚ç”±äºæ­¤æ¶ˆæ¯ä¼ é€’æœåŠ¡æš´éœ²äº Internetï¼Œå› æ­¤å®ƒåº”è¯¥ä½äºç½‘ç»œçš„å®‰å…¨èŒƒå›´ä¹‹å¤–ã€‚\næ‚¨åº”è¯¥è€ƒè™‘å°†æ•°æ®æ¨é€åˆ°é¢å‘äº’è”ç½‘çš„å®æ—¶æ¶ˆæ¯ä¼ é€’æœåŠ¡ï¼Œè€Œä¸æ˜¯è®©è¯¥æœåŠ¡ä» Kafka å±‚æå–æ•°æ®ã€‚è¿™æ ·ï¼Œå³ä½¿æ¶ˆæ¯æœåŠ¡é­åˆ°ç ´åï¼ŒKafka ä¸­çš„æ•°æ®ä»ç„¶æ˜¯å®‰å…¨çš„ã€‚é¢å‘äº’è”ç½‘çš„å®æ—¶æ¶ˆæ¯æœåŠ¡è¿˜æœ‰åŠ©äºç¡®ä¿æ‚¨ä¸ä¼šé”™è¯¯åœ°å…è®¸å®¢æˆ·ç«¯è®¾å¤‡è¿æ¥åˆ°æ‚¨çš„ Kafka éƒ¨ç½²æˆ–è®¢é˜…å®ƒä»¬ä¸åº”è®¿é—®çš„ä¸»é¢˜ã€‚\næ‚¨å¸Œæœ›é¢å‘ Internet çš„å®æ—¶æ¶ˆæ¯ä¼ é€’æœåŠ¡å…·å¤‡é€‚å½“çš„æœºåˆ¶ï¼Œä½¿å…¶èƒ½å¤Ÿå¤„ç†ç³»ç»Ÿæ»¥ç”¨ï¼Œä¾‹å¦‚æ‹’ç»æœåŠ¡ (DoS) æ”»å‡»ï¼Œç”šè‡³æ˜¯æ— æ„çš„æ”»å‡»ï¼Œå…¶ç ´åæ€§ä¸æ¶æ„æ”»å‡»ä¸€æ ·ã€‚\nç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹ Ably å›¢é˜Ÿå¿…é¡»å¤„ç†çš„ DoS æ”»å‡»çš„çœŸå®æƒ…å†µã€‚å°½ç®¡å®ƒä¸æ˜¯æ¶æ„çš„ï¼Œä½†å®ƒä»ç„¶æ˜¯ DoS æ”»å‡»ã€‚æˆ‘ä»¬çš„ä¸€ä½å®¢æˆ·é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œç½‘ç»œæ•…éšœå¯¼è‡´æ•°ä¸‡ä¸ªè¿æ¥åŒæ—¶æ–­å¼€ã€‚ç”±äºä»£ç ä¸­çš„é”™è¯¯ï¼Œæ¯å½“è¿æ¥å¤±è´¥æ—¶ï¼Œç³»ç»Ÿéƒ½ä¼šç«‹å³å°è¯•é‡æ–°å»ºç«‹ WebSocket è¿æ¥ï¼Œè€Œä¸ç®¡ç½‘ç»œçŠ¶å†µå¦‚ä½•ã€‚è¿™åè¿‡æ¥åˆå¯¼è‡´æ¯éš”å‡ ç§’å°±ä¼šæœ‰æ•°åƒæ¬¡å®¢æˆ·ç«¯è¿æ¥å°è¯•ï¼Œç›´åˆ°å®¢æˆ·ç«¯èƒ½å¤Ÿé‡æ–°è¿æ¥åˆ°é¢å‘äº’è”ç½‘çš„å®æ—¶æ¶ˆæ¯ä¼ é€’æœåŠ¡ä¸ºæ­¢ã€‚ç”±äº Ably æ˜¯ä¸­é—´çš„æ¶ˆæ¯æœåŠ¡ï¼Œå®ƒå¸æ”¶äº†è¿æ¥çš„å³°å€¼ï¼Œè€Œåº•å±‚ Kafka å±‚å®Œå…¨ä¸å—å½±å“ã€‚\næ•°æ®è½¬æ¢ é€šå¸¸ï¼Œæ‚¨åœ¨æµå¼ä¼ è¾“ç®¡é“ä¸­å†…éƒ¨ä½¿ç”¨çš„æ•°æ®ä¸é€‚åˆæœ€ç»ˆç”¨æˆ·ã€‚æ ¹æ®æ‚¨çš„ä½¿ç”¨æ¡ˆä¾‹ï¼Œè¿™å¯èƒ½ä¼šç»™æ‚¨çš„å®¢æˆ·å¸¦æ¥æ€§èƒ½æˆ–å¸¦å®½ç›¸å…³çš„é—®é¢˜ï¼Œå› ä¸ºæ‚¨æœ€ç»ˆå¯èƒ½ä¼šé€šè¿‡æ¯æ¡æ¶ˆæ¯å‘ä»–ä»¬ä¼ è¾“é¢å¤–å’Œå†—ä½™çš„ä¿¡æ¯ã€‚\næˆ‘å°†ç”¨ä¸€ä¸ªä¾‹å­æ¥æ›´å¥½åœ°è¯´æ˜æˆ‘çš„æ„æ€ã€‚åœ¨ Ablyï¼Œæˆ‘ä»¬ä½¿å®¢æˆ·èƒ½å¤Ÿè¿æ¥åˆ°å„ç§æ•°æ®æµã€‚å…¶ä¸­ä¸€ä¸ªæµç§°ä¸ºCTtransit GTFS-realtimeï¼ˆè¯·æ³¨æ„ï¼ŒCTtransit æ˜¯åº·æ¶…ç‹„æ ¼å·äº¤é€šéƒ¨çš„ä¸€é¡¹å·´å£«æœåŠ¡ï¼‰ã€‚è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨å…¬å¼€å¯ç”¨æ€»çº¿æ•°æ®çš„å…è´¹æµã€‚\nç°åœ¨å‡è®¾æ‚¨æƒ³è¦ç›´æ¥è¿æ¥åˆ° CTtransit GTFS-realtimeï¼Œå°†æ•°æ®æµå¼ä¼ è¾“åˆ°å‘æœ€ç»ˆç”¨æˆ·æä¾›å®æ—¶å…¬äº¤è½¦æ›´æ–°ï¼ˆä¾‹å¦‚è½¦è¾†ä½ç½®æˆ–è·¯çº¿å˜æ›´ï¼‰çš„åº”ç”¨ç¨‹åºã€‚æ¯æ¬¡æœ‰æ›´æ–°æ—¶ï¼ˆå³ä½¿ä»…é’ˆå¯¹ä¸€è¾†å…¬äº¤è½¦ï¼‰ï¼ŒCTtransit å‘é€çš„æ¶ˆæ¯å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š\n[ { \u0026#34;id\u0026#34;:\u0026#34;1430\u0026#34;, \u0026#34;vehicle\u0026#34;:{ \u0026#34;trip\u0026#34;:{ \u0026#34;tripId\u0026#34;:\u0026#34;1278992\u0026#34;, \u0026#34;startDate\u0026#34;:\u0026#34;20200612\u0026#34;, \u0026#34;routeId\u0026#34;:\u0026#34;11417\u0026#34; }, \u0026#34;position\u0026#34;:{ \u0026#34;latitude\u0026#34;:41.75381851196289, \u0026#34;longitude\u0026#34;:-72.6827621459961 }, \u0026#34;timestamp\u0026#34;:\u0026#34;1591959482\u0026#34;, \u0026#34;vehicle\u0026#34;:{ \u0026#34;id\u0026#34;:\u0026#34;2430\u0026#34;, \u0026#34;label\u0026#34;:\u0026#34;1430\u0026#34; } } }, { \u0026#34;id\u0026#34;:\u0026#34;1431\u0026#34;, \u0026#34;vehicle\u0026#34;:{ \u0026#34;trip\u0026#34;:{ \u0026#34;tripId\u0026#34;:\u0026#34;1278402\u0026#34;, \u0026#34;startDate\u0026#34;:\u0026#34;20200612\u0026#34;, \u0026#34;routeId\u0026#34;:\u0026#34;11413\u0026#34; }, \u0026#34;position\u0026#34;:{ \u0026#34;latitude\u0026#34;:41.69612121582031, \u0026#34;longitude\u0026#34;:-72.75396728515625 }, \u0026#34;timestamp\u0026#34;:\u0026#34;1591960295\u0026#34;, \u0026#34;vehicle\u0026#34;:{ \u0026#34;id\u0026#34;:\u0026#34;2431\u0026#34;, \u0026#34;label\u0026#34;:\u0026#34;1431\u0026#34; } } }, // Payload contains information for an additional 150+ buses } ] æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œæœ‰æ•ˆè´Ÿè½½å·¨å¤§å¹¶ä¸”è¦†ç›–äº†å¤šæ¡æ€»çº¿ã€‚ç„¶è€Œï¼Œå¤§å¤šæ•°æ—¶å€™ï¼Œæœ€ç»ˆç”¨æˆ·åªå¯¹æ¥æ”¶å…¶ä¸­ä¸€è¾†æ€»çº¿çš„æ›´æ–°æ„Ÿå…´è¶£ã€‚å› æ­¤ï¼Œé’ˆå¯¹ä»–ä»¬çš„ç›¸å…³æ¶ˆæ¯å¦‚ä¸‹æ‰€ç¤ºï¼š\n{ \u0026#34;id\u0026#34;:\u0026#34;1430\u0026#34;, \u0026#34;vehicle\u0026#34;:{ \u0026#34;trip\u0026#34;:{ \u0026#34;tripId\u0026#34;:\u0026#34;1278992\u0026#34;, \u0026#34;startDate\u0026#34;:\u0026#34;20200612\u0026#34;, \u0026#34;routeId\u0026#34;:\u0026#34;11417\u0026#34; }, \u0026#34;position\u0026#34;:{ \u0026#34;latitude\u0026#34;:41.75381851196289, \u0026#34;longitude\u0026#34;:-72.6827621459961 }, \u0026#34;timestamp\u0026#34;:\u0026#34;1591959482\u0026#34;, \u0026#34;vehicle\u0026#34;:{ \u0026#34;id\u0026#34;:\u0026#34;2430\u0026#34;, \u0026#34;label\u0026#34;:\u0026#34;1430\u0026#34; } } } è®©æˆ‘ä»¬æ›´è¿›ä¸€æ­¥â€”â€”å®¢æˆ·ç«¯å¯èƒ½å¸Œæœ›åªæ¥æ”¶è½¦è¾†çš„æ–°çº¬åº¦å’Œç»åº¦å€¼ï¼Œå› æ­¤ä¸Šé¢çš„æœ‰æ•ˆè´Ÿè½½åœ¨å‘é€åˆ°å®¢æˆ·ç«¯è®¾å¤‡ä¹‹å‰å°†è½¬æ¢ä¸ºä»¥ä¸‹å†…å®¹ï¼š\n{ \u0026#34;id\u0026#34;:\u0026#34;1430\u0026#34;, \u0026#34;lat\u0026#34;:41.75381851196289, \u0026#34;long\u0026#34;:-72.6827621459961 } æ­¤ç¤ºä¾‹çš„ç›®çš„æ˜¯è¯æ˜ï¼Œå¦‚æœæ‚¨å¸Œæœ›ä¸ºæœ€ç»ˆç”¨æˆ·åˆ›å»ºæœ€ä½³ä¸”ä½å»¶è¿Ÿçš„ä½“éªŒï¼Œåˆ™éœ€è¦åˆ¶å®šä¸€ä¸ªå›´ç»•æ•°æ®è½¬æ¢çš„ç­–ç•¥ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥å°†å…¶åˆ†è§£ï¼ˆåˆ†ç‰‡ï¼‰ä¸ºæ›´å°ã€æ›´å¿«çš„æ•°æ®ï¼Œä»¥åŠæ›´ç›¸å…³çš„å­æµï¼Œæ›´é€‚åˆæœ€åä¸€è‹±é‡Œäº¤ä»˜ã€‚\né™¤äº†æ•°æ®è½¬æ¢ä¹‹å¤–ï¼Œå¦‚æœå®ƒä¸æ‚¨çš„ç”¨ä¾‹ç›¸å…³ï¼Œæ‚¨å¯ä»¥è€ƒè™‘ä½¿ç”¨æ¶ˆæ¯å¢é‡å‹ç¼©ï¼Œè¿™æ˜¯ä¸€ç§æœºåˆ¶ï¼Œä½¿æ‚¨èƒ½å¤Ÿå‘é€ä»…åŒ…å«å½“å‰æ¶ˆæ¯ä¸æ‚¨ä¹‹å‰å‘é€çš„æ¶ˆæ¯ä¹‹é—´çš„å·®å¼‚ï¼ˆå¢é‡ï¼‰çš„æœ‰æ•ˆè´Ÿè½½ã€‚å‘é€ã€‚å°ºå¯¸çš„å‡å°é™ä½äº†å¸¦å®½æˆæœ¬ï¼Œæ”¹å–„äº†æœ€ç»ˆç”¨æˆ·çš„å»¶è¿Ÿï¼Œå¹¶å®ç°äº†æ›´å¤§çš„æ¶ˆæ¯ååé‡ã€‚\næŸ¥çœ‹Ably å®æ—¶å¢é‡æ¯”è¾ƒæ¼”ç¤ºï¼Œçœ‹çœ‹è¿™åœ¨æ¶ˆæ¯å¤§å°æ–¹é¢æœ‰å¤šå¤§å·®å¼‚ã€‚è¯·æ³¨æ„ï¼Œè¯¥æ¼”ç¤ºä½¿ç”¨çš„æ˜¯ç¾å›½ CTtransit æ•°æ®æºï¼Œå› æ­¤ï¼Œå¦‚æœæ‚¨ç¢°å·§åœ¨æ²¡æœ‰å…¬äº¤è½¦è¿è¡Œçš„æ—¶é—´ï¼ˆç¾å›½ä¸œéƒ¨æ—¶é—´åˆå¤œè‡³æ—©ä¸Š 6 ç‚¹æˆ–æ¬§æ´²çš„æ¸…æ™¨ï¼‰æŸ¥çœ‹è¯¥æ¼”ç¤ºï¼Œæ‚¨å°†çœ‹ä¸åˆ°ä»»ä½•æ•°æ®ã€‚\næ‚¨å·²ç»çœ‹åˆ°ä»ä½å»¶è¿Ÿè§’åº¦è½¬æ¢æ•°æ®å’Œä½¿ç”¨å¢é‡å‹ç¼©æ˜¯å¤šä¹ˆé‡è¦ - æœ‰æ•ˆè´Ÿè½½å¯ä»¥ç¼©å°æ•°åå€ã€‚ Kafka æä¾›äº†ä¸€äº›å°†æ•°æ®æµæ‹†åˆ†ä¸ºæ›´å°çš„å­æµçš„åŠŸèƒ½ï¼Œå®ƒè¿˜å…è®¸æ‚¨å‹ç¼©æ¶ˆæ¯ä»¥å®ç°æ›´é«˜æ•ˆçš„å­˜å‚¨å’Œæ›´å¿«çš„äº¤ä»˜ã€‚ä½†æ˜¯ï¼Œä¸è¦å¿˜è®°ï¼Œä»æ•´ä½“ä¸Šçœ‹ï¼ŒKafka å¹¶ä¸æ˜¯ä¸ºé€šè¿‡äº’è”ç½‘è¿›è¡Œæœ€åä¸€è‹±é‡Œäº¤ä»˜è€Œè®¾è®¡çš„ã€‚æ‚¨æœ€å¥½å°†æ•°æ®è½¬æ¢å’Œå¢é‡å‹ç¼©çš„æ“ä½œå¤æ‚æ€§è½¬ç§»ç»™ä½äº Kafka å’Œå®¢æˆ·ä¹‹é—´çš„é¢å‘äº’è”ç½‘çš„å®æ—¶æ¶ˆæ¯ä¼ é€’æœåŠ¡ã€‚\nä¼ è¾“åè®®äº’æ“ä½œæ€§ å¯ç”¨äºæµä¼ è¾“ç®¡é“çš„ä¼ è¾“åè®®çš„æƒ…å†µéå¸¸å¤šæ ·åŒ–ã€‚æ‚¨çš„ç³»ç»Ÿå¾ˆå¯èƒ½éœ€è¦æ”¯æŒå¤šç§åè®®ï¼šé™¤äº†ä¸»è¦åè®®ä¹‹å¤–ï¼Œæ‚¨è¿˜éœ€è¦æœ‰åå¤‡é€‰é¡¹ï¼Œä¾‹å¦‚ XHR æµã€XHR è½®è¯¢æˆ– JSONP è½®è¯¢ã€‚è®©æˆ‘ä»¬å¿«é€Ÿæµè§ˆä¸€ä¸‹ä¸€äº›æœ€æµè¡Œçš„åè®®ï¼š\nWebSocketã€‚é€šè¿‡å•ä¸ª TCP è¿æ¥æä¾›å…¨åŒå·¥é€šä¿¡é€šé“ã€‚æ¯”åŠåŒå·¥æ›¿ä»£æ–¹æ¡ˆï¼ˆä¾‹å¦‚ HTTP è½®è¯¢ï¼‰ä½å¾—å¤šçš„å¼€é”€ã€‚é‡‘èè¡Œæƒ…ã€åŸºäºä½ç½®çš„åº”ç”¨ç¨‹åºå’ŒèŠå¤©è§£å†³æ–¹æ¡ˆçš„ç»ä½³é€‰æ‹©ã€‚æœ€å¯ç§»æ¤çš„å®æ—¶åè®®ï¼Œå…·æœ‰å¹¿æ³›çš„æ”¯æŒã€‚ MQTTã€‚ç”¨äºåœ¨ CPU åŠŸç‡å’Œ/æˆ–ç”µæ± å¯¿å‘½æœ‰é™çš„è®¾å¤‡ä¹‹é—´ä»¥åŠå…·æœ‰æ˜‚è´µ/ä½å¸¦å®½ã€ä¸å¯é¢„æµ‹çš„ç¨³å®šæ€§æˆ–é«˜å»¶è¿Ÿçš„ç½‘ç»œä¹‹é—´ä¼ è¾“æ•°æ®çš„é¦–é€‰åè®®ã€‚éå¸¸é€‚åˆç‰©è”ç½‘ã€‚ SSEã€‚ ç”¨äºäº‹ä»¶é©±åŠ¨æ•°æ®æµçš„å¼€æ”¾ã€è½»é‡çº§ã€ä»…è®¢é˜…åè®®ã€‚éå¸¸é€‚åˆè®¢é˜…æ•°æ®æºï¼Œä¾‹å¦‚å®æ—¶ä½“è‚²æ›´æ–°ã€‚ é™¤äº†ä¸Šé¢åˆ—å‡ºçš„åŸå§‹åè®®ä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥æ·»åŠ åº”ç”¨ç¨‹åºçº§åè®®ã€‚ä¾‹å¦‚ï¼Œå¯¹äº WebSocketsï¼Œæ‚¨å¯ä»¥é€‰æ‹©ä½¿ç”¨Socket.IOæˆ–SockJSç­‰è§£å†³æ–¹æ¡ˆã€‚å½“ç„¶ï¼Œæ‚¨ä¹Ÿå¯ä»¥æ„å»ºè‡ªå·±çš„è‡ªå®šä¹‰åè®®ï¼Œä½†å®é™…ä¸Š**å¿…é¡»è¿™æ ·åšçš„åœºæ™¯éå¸¸ç½•è§ã€‚è®¾è®¡å®šåˆ¶åè®®æ˜¯ä¸€ä¸ªå¤æ‚çš„è¿‡ç¨‹ï¼Œéœ€è¦èŠ±è´¹å¤§é‡çš„æ—¶é—´å’Œç²¾åŠ›ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ‚¨æœ€å¥½ä½¿ç”¨ç°æœ‰ä¸”å®Œå–„çš„è§£å†³æ–¹æ¡ˆã€‚\nKafka åŸºäº TCP çš„äºŒè¿›åˆ¶åè®®ä¸é€‚åˆé€šè¿‡ Internet è¿›è¡Œé€šä¿¡ï¼Œå¹¶ä¸”ä¸å—æµè§ˆå™¨æ”¯æŒã€‚æ­¤å¤–ï¼ŒKafka ä¸æä¾›å¯¹å…¶ä»–åè®®çš„åŸç”Ÿæ”¯æŒã€‚å› æ­¤ï¼Œæ‚¨éœ€è¦ä½¿ç”¨é¢å‘äº’è”ç½‘çš„å®æ—¶æ¶ˆæ¯ä¼ é€’æœåŠ¡ï¼Œè¯¥æœåŠ¡å¯ä»¥ä» Kafka è·å–æ•°æ®ï¼Œå¯¹å…¶è¿›è¡Œè½¬æ¢ï¼Œç„¶åé€šè¿‡æ‚¨æ‰€éœ€çš„åè®®å°†å…¶æ¨é€ç»™è®¢é˜…è€…ã€‚\næ¶ˆæ¯æ‰‡å‡º æ— è®ºæ‚¨ä½¿ç”¨å“ªç§æŠ€æœ¯å †æ ˆæ¥æ„å»ºæ•°æ®æµç®¡é“ï¼Œæ‚¨éƒ½å¿…é¡»è€ƒè™‘çš„ä¸€ä»¶äº‹æ˜¯å¦‚ä½•ç®¡ç†æ¶ˆæ¯æ‰‡å‡ºï¼ˆæ›´å…·ä½“åœ°è¯´ï¼Œå‘å¸ƒä¸€æ¡è¢«å¤§é‡ç”¨æˆ·æ¥æ”¶çš„æ¶ˆæ¯ï¼Œä¸€å¯¹å¤šå…³ç³»ï¼‰ã€‚è§„æ¨¡è®¾è®¡è¦æ±‚æ‚¨åº”è¯¥ä½¿ç”¨è¿™æ ·çš„æ¨¡å‹ï¼šå‘å¸ƒè€…å°†æ•°æ®æ¨é€åˆ°ä»»æ„æ•°é‡çš„ç”¨æˆ·å¯ä»¥è®¢é˜…çš„ç»„ä»¶ã€‚æœ€æ˜æ˜¾çš„é€‰æ‹©æ˜¯å‘å¸ƒ/è®¢é˜…æ¨¡å¼ã€‚\nå½“æ‚¨è€ƒè™‘é«˜æ‰‡å‡ºæ—¶ï¼Œæ‚¨åº”è¯¥è€ƒè™‘ç³»ç»Ÿçš„å¼¹æ€§ï¼ŒåŒ…æ‹¬å¯ä»¥è¿æ¥åˆ°å®ƒçš„å®¢æˆ·ç«¯è®¾å¤‡çš„æ•°é‡ï¼Œä»¥åŠå®ƒå¯ä»¥ç»´æŒçš„ä¸»é¢˜æ•°é‡ã€‚è¿™å¾€å¾€æ˜¯å‡ºç°é—®é¢˜çš„åœ°æ–¹ã€‚ Kafka ä¸»è¦è®¾è®¡ç”¨äºç½‘ç»œå†…éƒ¨çš„æœºå™¨å¯¹æœºå™¨é€šä¿¡ï¼Œå®ƒå°†æ•°æ®æµå¼ä¼ è¾“ç»™å°‘é‡è®¢é˜…è€…ã€‚å› æ­¤ï¼Œå®ƒæ²¡æœ‰é’ˆå¯¹é€šè¿‡ Internet å°†æ¶ˆæ¯æ‰‡å‡ºåˆ°å¤§é‡å®¢æˆ·ç«¯è¿›è¡Œä¼˜åŒ–ã€‚\nç„¶è€Œï¼Œå¦‚æœä¸­é—´æœ‰ä¸€ä¸ªé¢å‘äº’è”ç½‘çš„å®æ—¶æ¶ˆæ¯æœåŠ¡ï¼Œæƒ…å†µå°±å®Œå…¨ä¸åŒäº†ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ¶ˆæ¯ä¼ é€’æœåŠ¡å±‚å°†æ¶ˆæ¯çš„æ‰‡å‡ºå¸è½½åˆ°å®¢æˆ·ç«¯ã€‚å¦‚æœè¯¥å±‚æœ‰èƒ½åŠ›ä¼ é€’æ‰‡å‡ºæ¶ˆæ¯ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥ä»¥éå¸¸ä½çš„å»¶è¿Ÿä¼ é€’å®ƒä»¬ï¼Œè€Œæ— éœ€å‘ Kafka é›†ç¾¤æ·»åŠ å®¹é‡ã€‚\næœåŠ¡å™¨å¼¹æ€§ æ‚¨éœ€è¦è€ƒè™‘ Kafka å±‚çš„å¼¹æ€§ã€‚å½“æ‚¨å°†æ— å¼¹æ€§çš„æµåª’ä½“æœåŠ¡å™¨æš´éœ²åœ¨äº’è”ç½‘ä¸Šæ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°ç ´åç³»ç»Ÿçš„å¤æ‚æƒ…å†µï¼Œäº’è”ç½‘æ˜¯ä¸ç¨³å®šä¸”ä¸å¯é¢„æµ‹çš„æµé‡æ¥æºã€‚\næ‚¨çš„ Kafka å±‚éœ€è¦æœ‰èƒ½åŠ›éšæ—¶å¤„ç†äº’è”ç½‘æµé‡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æ­£åœ¨å¼€å‘ä¸€æ¬¾å¤šäººæ¸¸æˆï¼Œå¹¶ä¸”æ•°ä»¥ä¸‡è®¡çš„å¹¶å‘ç”¨æˆ·çš„æ“ä½œè§¦å‘äº†ä½¿ç”¨é‡å³°å€¼ï¼Œé‚£ä¹ˆå¢åŠ çš„è´Ÿè½½å¯èƒ½ä¼šä¼ æ’­åˆ°æ‚¨çš„ Kafka é›†ç¾¤ï¼Œè¯¥é›†ç¾¤éœ€è¦æœ‰èµ„æºæ¥å¤„ç†å®ƒã€‚\nç¡®å®ï¼Œå¤§å¤šæ•°æµåª’ä½“æœåŠ¡å™¨éƒ½æ˜¯æœ‰å¼¹æ€§çš„ï¼Œä½†ä¸æ˜¯åŠ¨æ€å¼¹æ€§çš„ã€‚è¿™å¹¶ä¸ç†æƒ³ï¼Œå› ä¸ºæ‚¨æ— æ³•å¿«é€Ÿæé«˜ Kafka æœåŠ¡å™¨å®¹é‡ï¼ˆå‡ åˆ†é’Ÿè€Œä¸æ˜¯å‡ å°æ—¶ï¼‰ã€‚æ‚¨å¯ä»¥åšçš„æ˜¯æå‰è®¡åˆ’å’Œé…ç½®å®¹é‡ï¼Œå¹¶å¸Œæœ›å®ƒè¶³ä»¥åº”å¯¹æµé‡é«˜å³°ã€‚ä½†ä¸èƒ½ä¿è¯æ‚¨çš„ Kafka å±‚ä¸ä¼šè¿‡è½½ã€‚\né¢å‘äº’è”ç½‘çš„å®æ—¶æ¶ˆæ¯æœåŠ¡é€šå¸¸èƒ½å¤Ÿæ›´å¥½åœ°æä¾›åŠ¨æ€å¼¹æ€§ã€‚å®ƒä»¬æœ¬èº«å¹¶éæ²¡æœ‰æŒ‘æˆ˜ï¼Œä½†æ‚¨å¯ä»¥å°†å¼¹æ€§é—®é¢˜è½¬ç§»ç»™æ¶ˆæ¯æœåŠ¡ï¼Œä»è€Œåœ¨äº’è”ç½‘æµé‡æ¿€å¢æ—¶ä¿æŠ¤æ‚¨çš„ Kafka é›†ç¾¤ã€‚\nè®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç°å®ç”Ÿæ´»ä¸­çš„ä¾‹å­ã€‚ä¸ä¹…å‰ï¼ŒAbly æœ‰å¹¸å¸®åŠ©æ¾³å¤§åˆ©äºšç½‘çƒåä¼šå‘æµè§ˆæ¾³å¤§åˆ©äºšç½‘çƒå…¬å¼€èµ›ç½‘ç«™çš„çƒè¿·ä¼ è¾“å®æ—¶æ¯”åˆ†æ›´æ–°ã€‚æˆ‘ä»¬æœ€åˆå¯¹ç³»ç»Ÿè¿›è¡Œäº†æ¯åˆ†é’Ÿ 100 ä¸‡ä¸ªè¿æ¥çš„è´Ÿè½½æµ‹è¯•ã€‚ä¸€æ—¦æŠ•å…¥ç”Ÿäº§ï¼Œæˆ‘ä»¬å‘ç°è¿æ¥æ¯ 15 ç§’å·¦å³å°±ä¼šå‘ç”Ÿä¸€æ¬¡æ··ä¹±ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ¯åˆ†é’Ÿå¿…é¡»å¤„ç† 400 ä¸‡ä¸ªæ–°è¿æ¥ï¼Œè¿™æ˜¯ä¸€ä¸ªå®Œå…¨ä¸åŒçš„é—®é¢˜ã€‚å¦‚æœæ¾³å¤§åˆ©äºšç½‘çƒåä¼šæ²¡æœ‰åœ¨ä¸­é—´ä½¿ç”¨ Ably ä½œä¸ºé¢å‘äº’è”ç½‘çš„å¼¹æ€§å®æ—¶æ¶ˆæ¯æœåŠ¡ï¼Œé‚£ä¹ˆä»–ä»¬çš„åº•å±‚æœåŠ¡å™¨å±‚ï¼ˆKafka æˆ–å…¶ä»–ï¼‰å°†ä¼šå—åˆ°ä¸åˆ©å½±å“ã€‚å®Œå…¨å¸æ”¶äº†è´Ÿè½½ï¼Œè€Œæ¾³å¤§åˆ©äºšç½‘çƒåä¼šå¿…é¡»åšçš„å·¥ä½œé‡ä¿æŒä¸å˜â€”â€”ä»–ä»¬åªéœ€è¦åœ¨ä¸€åœºé›†ä¼šç»“æŸæ—¶å‘å¸ƒä¸€æ¡æ¶ˆæ¯ã€‚\næ‚¨å¿…é¡»è€ƒè™‘çš„å¦ä¸€ä»¶äº‹æ˜¯å¦‚ä½•å¤„ç†è¿æ¥é‡æ–°å»ºç«‹ã€‚å½“å®¢æˆ·ç«¯é‡æ–°è¿æ¥æ—¶ï¼Œæ•°æ®æµå¿…é¡»ä»ä¸­æ–­å¤„æ¢å¤ã€‚ä½†æ˜¯å“ªä¸ªç»„ä»¶è´Ÿè´£è·Ÿè¸ªè¿™ä¸€ç‚¹å‘¢ï¼Ÿæ˜¯é¢å‘äº’è”ç½‘çš„å®æ—¶æ¶ˆæ¯æœåŠ¡ã€Kafka è¿˜æ˜¯å®¢æˆ·ç«¯ï¼Ÿç­”æ¡ˆæ²¡æœ‰æ­£ç¡®æˆ–é”™è¯¯ä¹‹åˆ†â€”â€”è¿™ä¸‰ä¸ªäººä¸­çš„ä»»ä½•ä¸€ä¸ªéƒ½å¯ä»¥è¢«åˆ†é…è¿™ä¸ªè´£ä»»ã€‚ä½†æ˜¯ï¼Œæ‚¨éœ€è¦ä»”ç»†åˆ†ææ‚¨çš„éœ€æ±‚ï¼Œå¹¶è€ƒè™‘å¦‚æœæ¯ä¸ªæµéƒ½éœ€è¦å­˜å‚¨æ•°æ®ï¼Œåˆ™æ‚¨å°†éœ€è¦æ ¹æ®è¿æ¥æ•°æŒ‰æ¯”ä¾‹æ‰©å±•å­˜å‚¨ã€‚\nå…¨çƒåˆ†å¸ƒå¼æ¶æ„ ä¸ºäº†è·å¾—ä½å»¶è¿Ÿçš„æ•°æ®æµç³»ç»Ÿï¼Œæ‚¨ä½¿ç”¨çš„é¢å‘äº’è”ç½‘çš„å®æ—¶æ¶ˆæ¯æœåŠ¡å¿…é¡»ä¸æ‚¨çš„ Kafka éƒ¨ç½²ä½äºåŒä¸€åŒºåŸŸã€‚ä½†è¿™è¿˜ä¸å¤Ÿã€‚æ‚¨å‘é€æ¶ˆæ¯çš„å®¢æˆ·ç«¯è®¾å¤‡ä¹Ÿåº”è¯¥ä½äºåŒä¸€åŒºåŸŸã€‚ä¾‹å¦‚ï¼Œæ‚¨ä¸å¸Œæœ›é€šè¿‡éƒ¨ç½²åœ¨ä¸–ç•Œå…¶ä»–åœ°åŒºçš„ç³»ç»Ÿå°†æ•°æ®ä»æ¾³å¤§åˆ©äºšæµå¼ä¼ è¾“åˆ°æ¾³å¤§åˆ©äºšçš„æœ€ç»ˆç”¨æˆ·ã€‚\nå¦‚æœæ‚¨å¸Œæœ›åœ¨å‘é€è€…å’Œæ¥æ”¶è€…ä½äºä¸–ç•Œä¸åŒåœ°åŒºæ—¶æä¾›ä»æºåˆ°æœ€ç»ˆç”¨æˆ·çš„ä½å»¶è¿Ÿï¼Œåˆ™éœ€è¦è€ƒè™‘å…¨çƒåˆ†å¸ƒå¼æ¶æ„ã€‚è¾¹ç¼˜äº¤ä»˜ä½¿æ‚¨èƒ½å¤Ÿå°†æ¶ˆæ¯çš„è®¡ç®—å¤„ç†é è¿‘å®¢æˆ·ç«¯ã€‚\næ‹¥æœ‰å…¨çƒåˆ†å¸ƒå¼çš„é¢å‘äº’è”ç½‘çš„å®æ—¶æ¶ˆæ¯ä¼ é€’å±‚çš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œå¦‚æœæ‚¨çš„ Kafka æœåŠ¡å™¨ç”±äºé‡æ–°å¯åŠ¨æˆ–ä¸å…¼å®¹çš„å‡çº§è€Œå‘ç”Ÿæ•…éšœï¼Œå®æ—¶æ¶ˆæ¯ä¼ é€’æœåŠ¡å°†ä¿æŒè¿æ¥å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œå› æ­¤ä¸€æ—¦ Kafka å±‚æ¢å¤æ­£å¸¸ï¼Œå®ƒä»¬å°±å¯ä»¥å¿«é€Ÿæ¢å¤ã€‚å†æ¬¡è¿è¡Œã€‚æ¢å¥è¯è¯´ï¼Œå­¤ç«‹çš„ Kafka æ•…éšœä¸ä¼šå¯¹è®¢é˜…æ•°æ®æµçš„æ‰€æœ‰å®¢æˆ·ç«¯äº§ç”Ÿç›´æ¥å½±å“ã€‚è¿™æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸»è¦ä¼˜ç‚¹ä¹‹ä¸€â€”â€”ç»„ä»¶ç‹¬ç«‹å‘ç”Ÿæ•…éšœå¹¶ä¸”ä¸ä¼šå¯¼è‡´çº§è”æ•…éšœã€‚\nå¦ä¸€æ–¹é¢ï¼Œå¦‚æœä¸ä½¿ç”¨é¢å‘äº’è”ç½‘çš„å®æ—¶è¾¹ç¼˜æ¶ˆæ¯ä¼ é€’å±‚ï¼ŒKafka æ•…éšœå°†æ›´éš¾ä»¥ç®¡ç†ã€‚è¿™å°†å¯¼è‡´æ‰€æœ‰è¿æ¥ç»ˆæ­¢ã€‚å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œå®¢æˆ·ç«¯å°†å°è¯•ç«‹å³é‡æ–°è¿æ¥ï¼Œè¿™ä¼šç»™ç³»ç»Ÿä¸­ä»»ä½•å…¶ä»–ç°æœ‰çš„ Kafka èŠ‚ç‚¹å¢åŠ æ›´å¤šè´Ÿè½½ã€‚èŠ‚ç‚¹å¯èƒ½ä¼šè¿‡è½½ï¼Œä»è€Œå¯¼è‡´çº§è”æ•…éšœã€‚\nè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æ‚¨å¯ä»¥ä½¿ç”¨çš„ä¸€äº›å¸¸è§çš„å…¨çƒåˆ†å¸ƒå¼æ¶æ„æ¨¡å‹ã€‚åœ¨ç¬¬ä¸€ä¸ªæ¨¡å‹ä¸­ï¼ŒKafka éƒ¨ç½²åœ¨å®‰å…¨ç½‘ç»œå†…ï¼Œå¹¶å°†æ•°æ®æ¨é€åˆ°é¢å‘äº’è”ç½‘çš„å®æ—¶æ¶ˆæ¯æœåŠ¡ã€‚æ¶ˆæ¯ä¼ é€’æœåŠ¡ä½äºå®‰å…¨ç½‘ç»œçš„è¾¹ç¼˜ï¼Œæš´éœ²åœ¨äº’è”ç½‘ä¸Šã€‚\næ‚¨å¯ä»¥é‡‡ç”¨çš„è¾…åŠ©æ¨¡å‹æ¶‰åŠä¸€ä¸ªé¢å‘äº’è”ç½‘çš„å®æ—¶æ¶ˆæ¯ä¼ é€’æœåŠ¡å’Œä¸¤ä¸ª Kafka å®ä¾‹ï¼ˆä¸»å®ä¾‹å’Œå¤‡ä»½/åå¤‡å®ä¾‹ï¼‰ã€‚ç”±äºæ¶ˆæ¯ä¼ é€’æœåŠ¡æ˜¯è§£è€¦çš„ï¼Œå› æ­¤å®ƒä¸çŸ¥é“ï¼ˆä¹Ÿä¸å…³å¿ƒï¼‰ä¸¤ä¸ª Kafka å®ä¾‹ä¸­çš„å“ªä¸€ä¸ªæ­£åœ¨ä¸ºå…¶æä¾›æ•°æ®ã€‚è¯¥æ¨¡å‹æ˜¯ä¸€ç§æ•…éšœè½¬ç§»è®¾è®¡ï¼Œä¸ºæ‚¨çš„ Kafka è®¾ç½®å¢åŠ äº†ä¸€å±‚å¯é æ€§ï¼šå¦‚æœå…¶ä¸­ä¸€ä¸ª Kafka å®ä¾‹å‘ç”Ÿæ•…éšœï¼Œç¬¬äºŒä¸ªå®ä¾‹å°†å–ä»£å®ƒã€‚\nç¬¬ä¸‰ç§æ¨¡å¼éå¸¸å— Ably å®¢æˆ·æ¬¢è¿ï¼Œæ˜¯ä¸»åŠ¨-ä¸»åŠ¨æ–¹æ³•ã€‚å®ƒéœ€è¦ä¸¤ä¸ªKafkaé›†ç¾¤åŒæ—¶ç‹¬ç«‹è¿è¡Œï¼Œä»¥åˆ†æ‹…è´Ÿè½½ã€‚ä¸¤ä¸ªé›†ç¾¤å‡ä»¥ 50% çš„å®¹é‡è¿è¡Œï¼Œå¹¶ä½¿ç”¨ç›¸åŒçš„é¢å‘ Internet çš„å®æ—¶æ¶ˆæ¯ä¼ é€’æœåŠ¡ã€‚æ­¤æ¨¡å‹åœ¨éœ€è¦å°†æ¶ˆæ¯æµå¼ä¼ è¾“åˆ°å¤§é‡å®¢æˆ·ç«¯è®¾å¤‡çš„æƒ…å†µä¸‹ç‰¹åˆ«æœ‰ç”¨ã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ª Kafka é›†ç¾¤å‘ç”Ÿæ•…éšœï¼Œå¦ä¸€ä¸ªé›†ç¾¤å¯ä»¥æ‰¿æ‹… 50% çš„è´Ÿè½½ï¼Œä»¥ä¿æŒç³»ç»Ÿè¿è¡Œã€‚\nç®¡ç†èƒŒå‹ å½“é€šè¿‡äº’è”ç½‘å°†æ•°æ®æµå¼ä¼ è¾“åˆ°å®¢æˆ·ç«¯è®¾å¤‡æ—¶ï¼ŒèƒŒå‹æ˜¯æ‚¨å¿…é¡»å¤„ç†çš„å…³é”®é—®é¢˜ä¹‹ä¸€ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨æ¯ç§’ä¼ è¾“ 25 æ¡æ¶ˆæ¯ï¼Œä½†å®¢æˆ·ç«¯æ¯ç§’åªèƒ½å¤„ç† 10 æ¡æ¶ˆæ¯ã€‚æ‚¨å¦‚ä½•å¤„ç†å®¢æˆ·ç«¯æ— æ³•æ¶ˆè´¹çš„æ¯ç§’ 15 æ¡å‰©ä½™æ¶ˆæ¯ï¼Ÿ\nç”±äº Kafka æ˜¯ä¸ºæœºå™¨å¯¹æœºå™¨é€šä¿¡è€Œè®¾è®¡çš„ï¼Œå› æ­¤å®ƒæ²¡æœ‰ä¸ºæ‚¨æä¾›è‰¯å¥½çš„æœºåˆ¶æ¥ç®¡ç†äº’è”ç½‘ä¸Šçš„èƒŒå‹ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨åœ¨ Kafka å’Œå®¢æˆ·ç«¯ä¹‹é—´ä½¿ç”¨é¢å‘äº’è”ç½‘çš„å®æ—¶æ¶ˆæ¯ä¼ é€’æœåŠ¡ï¼Œæ‚¨å¯èƒ½èƒ½å¤Ÿæ›´å¥½åœ°å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚\nå³ä½¿ä¸­é—´æœ‰æ¶ˆæ¯ä¼ é€’æœåŠ¡ï¼Œæ‚¨ä»ç„¶éœ€è¦å†³å®šä»€ä¹ˆå¯¹æ‚¨çš„æµä¼ è¾“ç®¡é“æ›´é‡è¦ï¼šä½å»¶è¿Ÿè¿˜æ˜¯æ•°æ®å®Œæ•´æ€§ï¼Ÿå®ƒä»¬å¹¶ä¸ç›¸äº’æ’æ–¥ï¼Œä½†é€‰æ‹©å…¶ä¸­ä¹‹ä¸€ä¼šåœ¨ä¸€å®šç¨‹åº¦ä¸Šå½±å“å¦ä¸€ä¸ªã€‚\nä¾‹å¦‚ï¼Œå‡è®¾æ‚¨æœ‰ä¸€ä¸ªä¾›ç»çºªäººå’Œäº¤æ˜“è€…ä½¿ç”¨çš„äº¤æ˜“åº”ç”¨ç¨‹åºã€‚åœ¨æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªç”¨ä¾‹ä¸­ï¼Œæœ€ç»ˆç”¨æˆ·æœ‰å…´è¶£å°½å¿«æ¥æ”¶è´§å¸æ›´æ–°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½å»¶è¿Ÿåº”è¯¥æ˜¯æ‚¨çš„é‡ç‚¹ï¼Œè€Œæ•°æ®å®Œæ•´æ€§åˆ™ä¸å¤ªé‡è¦ã€‚\nä¸ºäº†å®ç°ä½å»¶è¿Ÿï¼Œæ‚¨å¯ä»¥ä½¿ç”¨èƒŒå‹æ§åˆ¶ï¼Œå®ƒç›‘è§†åœ¨ç”¨äºå°†æ•°æ®æµå¼ä¼ è¾“åˆ°å®¢æˆ·ç«¯è®¾å¤‡çš„å¥—æ¥å­—ä¸Šå»ºç«‹çš„ç¼“å†²åŒºã€‚è¿™ç§æ•°æ®åŒ…çº§æœºåˆ¶å¯ç¡®ä¿ç¼“å†²åŒºçš„å¢é•¿ä¸ä¼šè¶…å‡ºä¸‹æ¸¸è¿æ¥å¯ä»¥æ‰¿å—çš„èŒƒå›´ã€‚æ‚¨è¿˜å¯ä»¥è¿›è¡Œåˆå¹¶ï¼Œè¿™å®é™…ä¸Šå…è®¸æ‚¨å°†å¤šæ¡æ¶ˆæ¯èšåˆä¸ºä¸€æ¡æ¶ˆæ¯ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ‚¨å¯ä»¥æ§åˆ¶ä¸‹æ¸¸æ¶ˆæ¯é€Ÿç‡ã€‚æ­¤å¤–ï¼Œåˆå¹¶å¯ä»¥åœ¨ä¸å¯é çš„ç½‘ç»œæ¡ä»¶ä¸‹æˆåŠŸä½¿ç”¨ï¼Œä»¥ç¡®ä¿é‡æ–°è¿æ¥æ—¶æœ€æ–°çŠ¶æ€æ˜¯æœ€è¿‘æ¶ˆæ¯çš„èšåˆã€‚\nå¦‚æœæ‚¨å¸Œæœ›åœ¨åº”ç”¨ç¨‹åºçº§åˆ«å¤„ç†èƒŒå‹ï¼Œåˆ™å¯ä»¥ä¾èµ–æ¥è‡ªè®¢é˜…æ•°æ®æµçš„å®¢æˆ·ç«¯çš„ ACKã€‚é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæ‚¨çš„ç³»ç»Ÿå°†æ¨è¿Ÿå‘é€é¢å¤–æ‰¹æ¬¡çš„æ¶ˆæ¯ï¼Œç›´åˆ°æ”¶åˆ°ç¡®è®¤ä»£ç ã€‚\nç°åœ¨è®©æˆ‘ä»¬å›åˆ°æˆ‘ä»¬çš„äº¤æ˜“åº”ç”¨ç¨‹åºã€‚åœ¨æˆ‘ä»¬çš„ç¬¬äºŒä¸ªç”¨ä¾‹ä¸­ï¼Œæœ€ç»ˆç”¨æˆ·æœ‰å…´è¶£æŸ¥çœ‹ä»–ä»¬çš„äº¤æ˜“å†å²è®°å½•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ•°æ®å®Œæ•´æ€§èƒœè¿‡å»¶è¿Ÿï¼Œå› ä¸ºç”¨æˆ·éœ€è¦æŸ¥çœ‹å®Œæ•´çš„äº¤æ˜“è®°å½•ã€‚ä¸ºäº†ç®¡ç†èƒŒå‹ï¼Œæ‚¨å¯ä»¥æ±‚åŠ©äºæˆ‘ä»¬å·²ç»æåˆ°è¿‡çš„ ACKã€‚\nä¸ºäº†ç¡®ä¿å®Œæ•´æ€§ï¼Œæ‚¨å¯èƒ½éœ€è¦è€ƒè™‘å¦‚ä½•å¤„ç†ä¸€æ¬¡æ€§äº¤ä»˜ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½å¸Œæœ›é€šè¿‡æŒä¹…è¿æ¥ä½¿ç”¨å¹‚ç­‰å‘å¸ƒã€‚ç®€è€Œè¨€ä¹‹ï¼Œå¹‚ç­‰å‘å¸ƒæ„å‘³ç€å‘å¸ƒçš„æ¶ˆæ¯ä»…å¤„ç†ä¸€æ¬¡ï¼Œå³ä½¿å®¢æˆ·ç«¯æˆ–è¿æ¥æ•…éšœå¯¼è‡´é‡æ–°å°è¯•å‘å¸ƒä¹Ÿæ˜¯å¦‚æ­¤ã€‚é‚£ä¹ˆå®ƒåœ¨å®è·µä¸­æ˜¯å¦‚ä½•è¿ä½œçš„å‘¢ï¼Ÿé‚£ä¹ˆï¼Œå¦‚æœå®¢æˆ·ç«¯è®¾å¤‡å‘å‡ºè´­ä¹°è‚¡ç¥¨çš„è¯·æ±‚ï¼Œå¹¶ä¸”è¯·æ±‚æˆåŠŸï¼Œä½†å®¢æˆ·ç«¯è¶…æ—¶ï¼Œåˆ™å®¢æˆ·ç«¯å¯ä»¥å†æ¬¡å°è¯•ç›¸åŒçš„è¯·æ±‚ã€‚å¹‚ç­‰æ€§å¯ä»¥é˜²æ­¢å®¢æˆ·ç«¯è¢«æ”¶å–ä¸¤æ¬¡è´¹ç”¨ã€‚\nç»“è®ºï¼šæ‚¨åº”è¯¥ä½¿ç”¨ Kafka é€šè¿‡äº’è”ç½‘å°†æ•°æ®ç›´æ¥æµå¼ä¼ è¾“åˆ°å®¢æˆ·ç«¯è®¾å¤‡å—ï¼Ÿ Kafka æ˜¯ä¸€ä¸ªå‡ºè‰²çš„å·¥å…·ï¼Œå®ƒçš„è®¾è®¡åˆè¡·å°±æ˜¯å®ç°æœºå™¨å¯¹æœºå™¨é€šä¿¡ã€‚æ‚¨å¯ä»¥è€Œä¸”åº”è¯¥å°†å…¶ç”¨ä½œæ•°æ®æµç®¡é“çš„ç»„ä»¶ã€‚ä½†å®ƒå¹¶ä¸æ„å‘³ç€é€šè¿‡äº’è”ç½‘å°†æ•°æ®ç›´æ¥æµå¼ä¼ è¾“åˆ°å®¢æˆ·ç«¯è®¾å¤‡ï¼Œé¢å‘äº’è”ç½‘çš„ä¸­é—´å®æ—¶æ¶ˆæ¯ä¼ é€’è§£å†³æ–¹æ¡ˆçš„è®¾è®¡å’Œä¼˜åŒ–æ­£æ˜¯ä¸ºäº†æ‰¿æ‹…è¿™ä¸€è´£ä»»ã€‚\nå¸Œæœ›æœ¬æ–‡èƒ½å¤Ÿå¸®åŠ©æ‚¨åœ¨æ„å»ºä½¿ç”¨ Kafka å’Œæ”¯æŒ WebSockets çš„é¢å‘äº’è”ç½‘çš„å®æ—¶æ¶ˆæ¯ä¼ é€’æœåŠ¡çš„æµå¼ä¼ è¾“ç®¡é“æ—¶ï¼Œé‡ç‚¹å…³æ³¨éœ€è¦è€ƒè™‘çš„æ­£ç¡®äº‹é¡¹ã€‚å¦‚æœæ‚¨è®¡åˆ’è‡ªå·±å¼€å‘æ­¤ç±»æœåŠ¡ï¼Œæˆ–è€…æ‚¨å¸Œæœ›ä½¿ç”¨ç°æœ‰æŠ€æœ¯ï¼Œè¿™å¹¶ä¸é‡è¦â€”â€”æ‚¨å°†é¢ä¸´çš„å¯æ‰©å±•æ€§å’Œè¿è¥æŒ‘æˆ˜æ˜¯ç›¸åŒçš„ã€‚\nä½†æˆ‘ä»¬ä¸è¦å°±æ­¤æ­¢æ­¥ã€‚å¦‚æœæ‚¨æƒ³æ›´å¤šåœ°è®¨è®ºæ­¤ä¸»é¢˜ï¼Œæˆ–è€…æƒ³äº†è§£æœ‰å…³ Ably çš„æ›´å¤šä¿¡æ¯ä»¥åŠæˆ‘ä»¬å¦‚ä½•å¸®åŠ©æ‚¨å®Œæˆ Kafka å’Œ WebSockets ä¹‹æ—…ï¼Œè¯·è”ç³»æˆ‘ä»¬æˆ– æ³¨å†Œä¸€ä¸ªå…è´¹å¸æˆ·ã€‚\nå¤šå¹´æ¥ï¼Œæˆ‘ä»¬æ’°å†™äº†å¤§é‡æœ‰å…³å®æ—¶æ¶ˆæ¯ä¼ é€’å’Œæ„å»ºæœ‰æ•ˆæ•°æ®æµç®¡é“çš„æ–‡ç« ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æœ‰ç”¨çš„é“¾æ¥ï¼Œä¾›è¿›ä¸€æ­¥æ¢ç´¢ï¼š\nExtend Kafka to end-users at the edge with Ably Confluent Blog: Building a Dependable Real-Time Betting App with Confluent Cloud and Ably The WebSocket Handbook: learn about the technology behind the realtime web Ably Kafka Connector: extend Kafka to the edge reliably and safely Building a realtime ticket booking solution with Kafka, FastAPI, and Ably WebSockets â€” A Conceptual Deep-Dive Dependable realtime banking with Kafka and Ably Ably blog Ably resources \u0026amp; datasheets ","permalink":"https://blog.chensoul.cc/posts/2024/05/07/websockets-kafka/","summary":"åŸæ–‡é“¾æ¥ï¼šhttps://ably.com/topic/websockets-kafka\nApache Kafka æ˜¯ç›®å‰æœ€å¼ºå¤§çš„å¼‚æ­¥æ¶ˆæ¯ä¼ é€’æŠ€æœ¯ä¹‹ä¸€ã€‚ Kafka ç”± Jay Krepsã€Jun Rao å’Œ Neha Narkhede ç­‰å›¢é˜Ÿäº 2010 å¹´åœ¨ LinkedIn è®¾è®¡ï¼Œå¹¶äº 2011 å¹´åˆå¼€æºã€‚å¦‚ä»Šï¼Œè¯¥å·¥å…·è¢«ä¼—å¤šå…¬å¸ï¼ˆåŒ…æ‹¬ç§‘æŠ€å·¨å¤´ï¼Œä¾‹å¦‚ Slackã€Airbnb æˆ– Netflix ä½¿ç”¨ï¼‰ä¸ºå…¶å®æ—¶æ•°æ®æµç®¡é“æä¾›æ”¯æŒã€‚\nç”±äº Kafka å¦‚æ­¤å—æ¬¢è¿ï¼Œæˆ‘å¾ˆå¥½å¥‡æ˜¯å¦å¯ä»¥ä½¿ç”¨å®ƒé€šè¿‡äº’è”ç½‘å’Œ WebSockets å°†å®æ—¶æ•°æ®ç›´æ¥æµå¼ä¼ è¾“ç»™æœ€ç»ˆç”¨æˆ·ã€‚æ¯•ç«Ÿï¼ŒKafka å…·æœ‰ä¸€ç³»åˆ—ç‰¹å¾ï¼Œä¼¼ä¹ä½¿å…¶æˆä¸ºä¸€ä¸ªå€¼å¾—æ³¨æ„çš„é€‰æ‹©ï¼Œä¾‹å¦‚ï¼š\né«˜é€šé‡ ä½å»¶è¿Ÿ é«˜å¹¶å‘ å®¹é”™èƒ½åŠ› æŒä¹…æ€§ï¼ˆæŒä¹…æ€§ï¼‰ ç”¨äºå°† Kafka æ¶ˆæ¯æµå¼ä¼ è¾“åˆ°é¢å‘äº’è”ç½‘çš„å®¢æˆ·ç«¯çš„ç°æœ‰è§£å†³æ–¹æ¡ˆ æˆ‘å¼€å§‹ç ”ç©¶å®æ—¶å¼€å‘ç¤¾åŒºå¯¹è¿™ä¸ªç”¨ä¾‹çš„çœ‹æ³•ã€‚æˆ‘å¾ˆå¿«å‘ç° Kafka æœ€åˆè®¾è®¡ç”¨äºå®‰å…¨ç½‘ç»œå†…è¿›è¡Œæœºå™¨å¯¹æœºå™¨é€šä¿¡ã€‚è¿™è®©æˆ‘æƒ³åˆ°ï¼Œå¦‚æœæ‚¨æƒ³é€šè¿‡ WebSocket å°†æ•°æ®ä» Kafka æµå¼ä¼ è¾“åˆ°é¢å‘äº’è”ç½‘çš„ç”¨æˆ·ï¼Œæ‚¨å¯èƒ½éœ€è¦ä½¿ç”¨æŸç§ä¸­é—´ä»¶ã€‚\næˆ‘ç»§ç»­ç ”ç©¶ï¼Œå¸Œæœ›æ‰¾åˆ°ä¸€äº›å¯ä»¥å……å½“ä¸­é—´ä»¶çš„å¼€æºè§£å†³æ–¹æ¡ˆã€‚æˆ‘å‘ç°äº†å…¶ä¸­çš„å‡ ä¸ªï¼Œç†è®ºä¸Šå¯ä»¥ç”¨ä½œ Kafka å’Œé€šè¿‡äº’è”ç½‘è¿æ¥æ•°æ®æµçš„å®¢æˆ·ç«¯ä¹‹é—´çš„ä¸­ä»‹ï¼š\ntransfers_websockets_service kafka-websocket kafka-proxy-ws ä¸å¹¸çš„æ˜¯ï¼Œä¸Šé¢åˆ—å‡ºçš„æ‰€æœ‰è§£å†³æ–¹æ¡ˆéƒ½åªæ˜¯æ¦‚å¿µè¯æ˜ï¼Œä»…æ­¤è€Œå·²ã€‚å®ƒä»¬çš„åŠŸèƒ½é›†æœ‰é™ï¼Œå¹¶ä¸”å°šæœªåšå¥½ç”Ÿäº§å‡†å¤‡ï¼ˆå°¤å…¶æ˜¯å¤§è§„æ¨¡ç”Ÿäº§ï¼‰ã€‚\nç„¶åæˆ‘ç ”ç©¶äº†æˆç†Ÿçš„ç§‘æŠ€å…¬å¸å¦‚ä½•è§£å†³è¿™ä¸ª Kafka ç”¨ä¾‹ï¼›çœ‹æ¥ä»–ä»¬ç¡®å®åœ¨ä½¿ç”¨æŸç§ä¸­é—´ä»¶ã€‚ä¾‹å¦‚ï¼ŒTrello å¼€å‘äº†WebSocket åè®®çš„ç®€åŒ–ç‰ˆæœ¬ï¼Œä»…æ”¯æŒè®¢é˜…å’Œå–æ¶ˆè®¢é˜…å‘½ä»¤ã€‚ Slack æä¾›äº†å¦ä¸€ä¸ªä¾‹å­ã€‚è¯¥å…¬å¸æ„å»ºäº†ä¸€ä¸ªåä¸ºFlannelçš„ä»£ç†ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯éƒ¨ç½²åˆ°è¾¹ç¼˜å­˜åœ¨ç‚¹çš„åº”ç”¨ç¨‹åºçº§ç¼“å­˜æœåŠ¡ã€‚\nå½“ç„¶ï¼Œåƒ Trello æˆ– Slack è¿™æ ·çš„å…¬å¸æœ‰èƒ½åŠ›æŠ•èµ„æ‰€éœ€çš„èµ„æºæ¥æ„å»ºæ­¤ç±»è§£å†³æ–¹æ¡ˆã€‚ç„¶è€Œï¼Œå¼€å‘è‡ªå·±çš„ä¸­é—´ä»¶å¹¶ä¸æ€»æ˜¯ä¸€ä¸ªå¯è¡Œçš„é€‰æ‹©â€”â€”è¿™æ˜¯ä¸€é¡¹éå¸¸å¤æ‚çš„ä»»åŠ¡ï¼Œéœ€è¦å¤§é‡çš„èµ„æºå’Œæ—¶é—´ã€‚å¦ä¸€ç§é€‰æ‹©ï¼ˆæœ€æ–¹ä¾¿ã€æœ€å¸¸è§çš„ä¸€ç§ï¼‰æ˜¯ä½¿ç”¨å·²å»ºç«‹çš„ç¬¬ä¸‰æ–¹è§£å†³æ–¹æ¡ˆã€‚\næ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œæ™®éçš„å…±è¯†ä¼¼ä¹æ˜¯ Kafka æœ¬èº«ä¸é€‚åˆé€šè¿‡äº’è”ç½‘è¿›è¡Œæœ€åä¸€è‹±é‡Œäº¤ä»˜ï¼›æ‚¨éœ€è¦å°†å®ƒä¸å¦ä¸€ä¸ªç»„ä»¶ç»“åˆä½¿ç”¨ï¼šé¢å‘äº’è”ç½‘çš„å®æ—¶æ¶ˆæ¯ä¼ é€’æœåŠ¡ã€‚\nåœ¨ Ablyï¼Œæˆ‘ä»¬çš„è®¸å¤šå®¢æˆ·éƒ½é€šè¿‡æˆ‘ä»¬é¢å‘äº’è”ç½‘çš„ pub/sub å®æ—¶æ¶ˆæ¯æœåŠ¡ä¼ è¾“ Kafkaæ¶ˆæ¯ã€‚ä¸ºäº†æ¼”ç¤ºå®ƒæ˜¯å¤šä¹ˆç®€å•ï¼Œä¸‹é¢æ˜¯å¦‚ä½•ä» Kafka æ¶ˆè´¹æ•°æ®å¹¶å°†å…¶å‘å¸ƒåˆ° Ably çš„ç¤ºä¾‹ï¼š\nconst kafka = require(\u0026#39;kafka-node\u0026#39;); const Ably = require(\u0026#39;ably\u0026#39;); const ably = new Ably.Realtime({{ABLY_API_KEY}}); const ablyChannel = ably.channels.get(\u0026#39;kafka-example\u0026#39;); const Consumer = kafka.Consumer; const client = new kafka.","title":"[è¯‘]å¦‚ä½•é€šè¿‡ WebSocket å°† Kafka æ¶ˆæ¯æµå¼ä¼ è¾“åˆ°é¢å‘äº’è”ç½‘çš„å®¢æˆ·ç«¯"},{"content":"åŸæ–‡é“¾æ¥ï¼šhttps://ably.com/topic/apache-kafka-vs-rabbitmq-vs-aws-sns-sqs\nå°†æ¶ˆæ¯ä»ä¸€ä¸ªç»„ä»¶è·å–åˆ°å¦ä¸€ä¸ªç»„ä»¶æ˜¯å¾®æœåŠ¡æ¶æ„ä¸­æœ€é‡è¦çš„éƒ¨åˆ†ä¹‹ä¸€ã€‚æ¯ä¸ªæœåŠ¡å¿…é¡»èƒ½å¤Ÿä¸ä»»ä½•å…¶ä»–æœåŠ¡å¼‚æ­¥ã€å¯é ä¸”å¤§è§„æ¨¡åœ°é€šä¿¡ã€‚\nè¿™å°±æ˜¯æ¶ˆæ¯ä»£ç†çš„ç”¨æ­¦ä¹‹åœ°ã€‚æ¶ˆæ¯ä»£ç†ï¼ˆä¾‹å¦‚ Apache Kafkaã€RabbitMQ å’ŒAWS SNS/SQSï¼‰ä¸ºæ‚¨æä¾›ä¸€ä¸ªé€šç”¨æ¥å£å’Œä¸€ç»„ä¿è¯ï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨åè°ƒå¯èƒ½æ•°åƒä¸ªå¾®æœåŠ¡ä¹‹é—´çš„é€šä¿¡ã€‚è¿™ç®€åŒ–äº†é›†æˆå¹¶æ›´å®¹æ˜“æ¨ç†æ‚¨çš„ç³»ç»Ÿã€‚\nç„¶è€Œï¼Œæ¯”è¾ƒæ¶ˆæ¯ä»£ç†å¯èƒ½å¾ˆæ£˜æ‰‹ï¼Œå› ä¸ºæ¯ä¸ªæ¶ˆæ¯ä»£ç†éƒ½é‡‡ç”¨ä¸åŒçš„æ–¹æ³•æ¥å®Œæˆå·¥ä½œã€‚é‚£ä¹ˆï¼Œæ‚¨å¦‚ä½•å†³å®šå“ªä¸ªæ¶ˆæ¯ä»£ç†æœ€é€‚åˆæ‚¨çš„ç”¨ä¾‹ï¼Ÿ\nåœ¨æœ¬æ–‡ä¸­ï¼Œæ‚¨å°†æ‰¾åˆ°æœ‰å…³ä¸šç•Œæœ€å—æ¬¢è¿çš„ä¸‰ä¸ªæ¶ˆæ¯ä»£ç†å¦‚ä½•é€‚ç”¨äºä¸åŒç”¨ä¾‹çš„æŒ‡å—ã€‚æˆ‘ä»¬å°†ç ”ç©¶è¯¸å¦‚å®ƒä»¬çš„æ‰©å±•æ–¹æ³•ã€å®ƒä»¬æ”¯æŒçš„æ¶ˆæ¯ä¼ é€’æ¨¡å¼ä»¥åŠå®ƒä»¬å¦‚ä½•å¤„ç†æ€§èƒ½å’Œæ™ºèƒ½æ¶ˆæ¯è·¯ç”±ä¹‹é—´çš„æƒè¡¡ç­‰ç‰¹å¾ã€‚\næ¯”è¾ƒæ¶ˆæ¯ä»£ç†ï¼šæ‚¨åº”è¯¥å¯»æ‰¾ä»€ä¹ˆï¼Ÿ æ¶ˆæ¯ä»£ç†æ˜¯ä¸€ä¸ªå¹¿æ³›çš„ç±»åˆ«ã€‚è™½ç„¶æˆ‘ä»¬æ­£åœ¨è€ƒè™‘çš„ä¸‰ä¸ªé€‰é¡¹ä¸­çš„æ¯ä¸€ä¸ªéƒ½åœ¨æ›´å¤§ç³»ç»Ÿä¸­çš„ç»„ä»¶ä¹‹é—´ç§»åŠ¨æ•°æ®ï¼Œä½†åœ¨å®ƒä»¬ä¹‹é—´åšå‡ºå†³å®šå–å†³äºå®ƒä»¬å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ã€‚\nå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ£€æŸ¥æ¯ä¸ªæ¶ˆæ¯ä»£ç†çš„ç‰¹å¾ï¼Œæ ¹æ®å®ƒä»¬å¦‚ä½•å½±å“å…¶ç§»åŠ¨æ•°æ®çš„èƒ½åŠ›ä»¥åŠå®ƒçš„å·¥ä½œæ–¹å¼ã€‚æˆ‘ä»¬å°†ç ”ç©¶ä»¥ä¸‹å…­ä¸ªå› ç´ ä»¥åŠå®ƒä»¬å¦‚ä½•åº”ç”¨äº Apache Kafkaã€RabbitMQ å’Œ AWS SNS/SQSï¼š\n**æ¶ˆæ¯ä¼ é€’æ¨¡å¼ï¼š**æ¶ˆæ¯ä»£ç†ç»„ç»‡å’Œåˆ†å‘æ¶ˆæ¯çš„æ–¹å¼ï¼ˆä¾‹å¦‚å‘å¸ƒ/è®¢é˜…æˆ–è¯·æ±‚å›å¤ï¼‰æ¯”å…¶ä»–æ¶æ„å’Œç”¨ä¾‹æ›´é€‚åˆæŸäº›æ¶æ„å’Œç”¨ä¾‹ã€‚ **æ¶ˆæ¯è·¯ç”±ï¼š**æ¶ˆæ¯ä»£ç†èƒ½å¦æ ¹æ®æ¶ˆæ¯çš„å†…å®¹å’Œå…¶ä»–æ ‡å‡†æ¥è·¯ç”±æ¶ˆæ¯ï¼Ÿ **å¯æ‰©å±•æ€§ï¼š**å¹¶éæ¯ç§æƒ…å†µéƒ½éœ€è¦æ¯ç§’å¤„ç†æ•°ç™¾ä¸‡æ¡æ¶ˆæ¯ã€‚ç¡®ä¿æ¶ˆæ¯ä»£ç†å¯ä»¥æ‰©å±•åˆ°æ‚¨éœ€è¦çš„ååé‡çº§åˆ«ï¼ŒåŒæ—¶ç‰¢è®°è¿™å°†å¦‚ä½•å½±å“è®¾ç½®å’Œæ“ä½œçš„å¤æ‚æ€§ã€‚ **å¯é æ€§ï¼š**æ¶ˆæ¯ä»£ç†å¦‚ä½•å¤„ç†æ•…éšœï¼Ÿå®ƒä¼šä¿ç•™æ¶ˆæ¯è¿˜æ˜¯ä»…é€šè¿‡ç³»ç»Ÿä¼ é€’æ¶ˆæ¯ï¼Ÿ **å®‰å…¨æ€§ï¼š**æ•°æ®æ˜¯å¦åŠ å¯†ï¼Ÿæ¶ˆæ¯ä»£ç†æ˜¯å¦æä¾›å®¡æ ¸æ—¥å¿—ï¼Ÿå®ƒå¦‚ä½•å¤„ç†èº«ä»½éªŒè¯å’Œè®¿é—®æ§åˆ¶ï¼Ÿæ˜¯å¦ç»è¿‡ HIPAA å’Œ PCI DSS ç­‰è¡Œä¸šæ ‡å‡†è®¤è¯ï¼Ÿ **æˆæœ¬å’Œè®¸å¯ï¼š**æ¶ˆæ¯ä»£ç†æ˜¯å¼€æºçš„å—ï¼Ÿéœ€è¦å“ªäº›äº‘æˆ–æœåŠ¡å™¨èµ„æºï¼Ÿæ˜¯å¦æŒç»­æ”¶å–è®¸å¯è´¹ï¼Ÿæ‚¨çš„å›¢é˜Ÿéœ€è¦èŠ±è´¹å¤šå°‘æ—¶é—´æ¥è¿è¡Œå®ƒï¼Ÿ ä»‹ç» Apache Kafkaã€RabbitMQ ä»¥åŠ AWS SNS å’Œ SQS åœ¨è¯¦ç»†è¿›è¡Œæ¯”è¾ƒä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥è°ˆè°ˆä¸ºä»€ä¹ˆæˆ‘ä»¬å…³æ³¨è¿™ä¸‰ç§è§£å†³æ–¹æ¡ˆã€‚åŸå› ä¹‹ä¸€æ˜¯å®ƒä»¬æ˜¯æ‚¨å¯èƒ½é‡åˆ°çš„æœ€å¸¸è§çš„æ¶ˆæ¯ä»£ç†è§£å†³æ–¹æ¡ˆä¹‹ä¸€ã€‚ç ”ç©¶è¡¨æ˜ï¼Œå…¨çƒæœ‰è¿‘ 50,000 å®¶å…¬å¸ä½¿ç”¨ RabbitMQï¼Œè€Œè¶…è¿‡60,000 å®¶å…¬å¸æ­£åœ¨ä½¿ç”¨ Apache Kafkaã€‚å°½ç®¡ AWS SQS çš„ç”¨æˆ·ç¾¤ä¼¼ä¹è¾ƒå°ï¼Œä½†åªæœ‰è¶…è¿‡ 24,000 å®¶å…¬å¸ï¼Œä½†å®ƒåœ¨æ›´å¹¿æ³›çš„ Amazon Web Services ç”Ÿæ€ç³»ç»Ÿä¸­å‘æŒ¥ç€é‡è¦ä½œç”¨ã€‚è¿™ç§å¹¿æ³›çš„éƒ¨ç½²ä½¿å¾—æ‚¨å¯ä»¥æ›´è½»æ¾åœ°æ‹›å‹Ÿç»éªŒä¸°å¯Œçš„å‘˜å·¥ã€ä¸ç°æœ‰æŠ€æœ¯å †æ ˆé›†æˆï¼Œä»¥åŠå½“æ‚¨éœ€è¦æ—¶å¯»æ±‚æ”¯æŒã€‚ä½†è¿˜æœ‰å¦ä¸€ä¸ªè€ƒè™‘å› ç´ ã€‚æˆ‘ä»¬æ­£åœ¨ç ”ç©¶çš„æ¯ä¸ªæ¶ˆæ¯ä»£ç†éƒ½ä»ä¸åŒçš„è§’åº¦è§£å†³è¯¥é—®é¢˜ã€‚ Apache Kafka ä¸“ä¸ºååé‡è€Œè®¾è®¡ï¼Œè€Œ RabbitMQ æ›´å…³æ³¨å¤æ‚çš„æ¶ˆæ¯è·¯ç”±ã€‚ä¸ RabbitMQ ä¸€æ ·ï¼ŒSNS å’Œ SQS è¿™ä¸¤ç§ AWS è§£å†³æ–¹æ¡ˆæ›´å…³æ³¨è·¯ç”±è€Œä¸æ˜¯ååé‡ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œè€ƒè™‘å®ƒä»¬æ˜¯å› ä¸º AWS ç”Ÿæ€ç³»ç»Ÿçš„é‡è¦æ€§ã€‚\né˜¿å¸•å¥‡Â·å¡å¤«å¡ Apache Kafka æ˜¯ä¸€ä¸ªå®æ—¶æµå¹³å°ï¼Œæ—¨åœ¨æ„å»ºå¯æ‰©å±•ã€å®¹é”™çš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºã€‚å®ƒä¸“é—¨ä»¥éå¸¸é«˜çš„ååé‡ä¼ è¾“æ•°æ®ï¼Œé€šå¸¸ç”¨äºæ“ä½œæ•°æ®ï¼Œä¾‹å¦‚æ—¥å¿—è®°å½•å’ŒæŒ‡æ ‡ã€‚\næ‹¥æœ‰å¦‚æ­¤åºå¤§çš„å®‰è£…åŸºç¡€ï¼Œæœ‰ä¸€äº›å·¥å…·å¯ä»¥å°† Apache Kafka è¿æ¥åˆ°å‡ ä¹ä»»ä½•å…¶ä»–æ­£åœ¨è¿è¡Œçš„ç³»ç»Ÿã€‚å°½ç®¡ Apache Kafka ä¸“æ³¨äºé«˜ååé‡ï¼Œä½†å®ƒä¹Ÿå¯ä»¥å¤„ç†ä¼ è¾“ä¸­çš„æ•°æ®ï¼Œä¾‹å¦‚è§¦å‘æ“ä½œå’Œè½¬æ¢æ•°æ®ã€‚ç„¶è€Œï¼Œè¿™ç§çµæ´»æ€§å’Œå¼ºå¤§åŠŸèƒ½æ˜¯æœ‰ä»£ä»·çš„ï¼Œå› ä¸º Apache Kafka æ¯”æŸäº›æ›¿ä»£æ–¹æ¡ˆæ›´éš¾è®¾ç½®å’Œæ“ä½œã€‚\nRabbitMQ ä¸ Apache Kafka ä¸“æ³¨äºæµæ•°æ®ä¸åŒï¼ŒRabbitMQ æ˜¯ä¸€ä¸ªå¼€æºåˆ†å¸ƒå¼æ¶ˆæ¯ä»£ç†ï¼Œæ”¯æŒå¤šç§ä¸åŒçš„æ¶ˆæ¯ä¼ é€’æ¨¡å¼ï¼Œä¾‹å¦‚å‘å¸ƒ/è®¢é˜…å’Œç”Ÿäº§è€…/æ¶ˆè´¹è€…ã€‚å°½ç®¡å®ƒç¡®å®æ‹¥æœ‰é«˜ååé‡ï¼Œä½†å®ƒçš„é‡ç‚¹æ›´å¤šåœ°æ˜¯æ ¹æ®æ¶ˆæ¯å†…å®¹ã€ä¸€å¤©ä¸­çš„æ—¶é—´ã€å‘é€è€…å’Œå…¶ä»–æ ‡å‡†æ™ºèƒ½åœ°è·¯ç”±æ•°æ®ï¼Œè¿™ä½¿å¾—å®ƒéå¸¸é€‚åˆäº‹ä»¶é©±åŠ¨çš„æ¶æ„ã€‚\nä¸ Apache Kafka ä¸€æ ·ï¼ŒRabbitMQ å¾—åˆ°äº†å¹¿æ³›çš„æ”¯æŒï¼Œå…·æœ‰ä¸°å¯Œçš„é›†æˆç”Ÿæ€ç³»ç»Ÿã€‚\nAWS SNS å’Œ SQS Amazon Web Services (AWS) æä¾›äº†ä¸¤ç§é€‚åˆæ¶ˆæ¯ä»£ç†æ——å¸œçš„äº§å“ã€‚ AWS Simple Notification Service (SNS) æ˜¯ä¸€ç§é«˜ååé‡æ¶ˆæ¯ä¼ é€’æœåŠ¡ï¼Œå®ƒä½¿ç”¨å‘å¸ƒ/è®¢é˜…æ¨¡å‹åœ¨å¾®æœåŠ¡æˆ–åˆ†å‘åº”ç”¨ç¨‹åºçš„ç»„ä»¶ä¹‹é—´ä¼ é€’æ¶ˆæ¯ã€‚\nAWS SNS ä½¿ç”¨ä¸»é¢˜åˆ›å»ºå•ç‹¬çš„é€šçŸ¥æµã€‚å®ƒè¿˜å…è®¸è¿‡æ»¤ï¼Œè¿™æ ·å³ä½¿æ¶ˆè´¹è€…è®¢é˜…äº†ç‰¹å®šä¸»é¢˜ï¼Œä»–ä»¬ä¹Ÿä¸å¿…æ¥æ”¶æ¯æ¡æ¶ˆæ¯ã€‚\nAWS Simple Queue Service (SQS) æ˜¯ä¸€ç§å…ˆè¿›å…ˆå‡º (FIFO) é˜Ÿåˆ—æœåŠ¡ï¼Œå¯å°†æ¶ˆæ¯åˆ†å‘ç»™æ½œåœ¨çš„å¤§é‡æ¶ˆè´¹è€…ã€‚äººä»¬å€¾å‘äºåŒæ—¶ä½¿ç”¨ SNS å’Œ SQSï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨ SNS å°†æ¶ˆæ¯å‘å¸ƒåˆ°æŸä¸ªä¸»é¢˜ï¼Œç„¶åä½¿ç”¨ SQS å°†è¿™äº›æ¶ˆæ¯å¯é åœ°åˆ†å‘åˆ°é€‚å½“çš„ç›®çš„åœ°ã€‚\nä¸ Apache Kafka å’Œ RabbitMQ ä¸åŒï¼ŒSNS å’Œ SQS åªèƒ½é€šè¿‡è®¢é˜… Amazon Web Services æ¥ä½¿ç”¨ã€‚\næ¯”è¾ƒ Apache Kafkaã€RabbitMQ å’Œ AWS SNS/SQS ä¸ºäº†å¸®åŠ©æ‚¨äº†è§£å“ªç§ç»çºªå•†æœ€é€‚åˆæ‚¨çš„ä½¿ç”¨æ¡ˆä¾‹ï¼Œä»¥ä¸‹æ˜¯å®ƒä»¬ä¸ä¸Šè¿°æ³¨æ„äº‹é¡¹çš„æ¯”è¾ƒã€‚\né˜¿å¸•å¥‡Â·å¡å¤«å¡ RabbitMQ AWS SNS/SQS æ¶ˆæ¯ä¼ é€’æ¨¡å¼ å‘å¸ƒ/è®¢é˜… å‘å¸ƒ/è®¢é˜…ç‚¹å¯¹ç‚¹è¯·æ±‚-å›å¤ å‘å¸ƒ/è®¢é˜…ç‚¹å¯¹ç‚¹ æ¶ˆæ¯è·¯ç”± æ„šè ¢çš„è·¯ç”±å™¨ï¼Œèªæ˜çš„æ¶ˆè´¹è€…ã€‚ï¼ˆé€šè¿‡æ’ä»¶å¯å®ç°æ›´æ™ºèƒ½çš„è·¯ç”±ï¼‰ åŸºäºå…ƒæ•°æ®æˆ–æ¶ˆæ¯å†…å®¹çš„æ™ºèƒ½è·¯ç”±ã€‚ åŸºäºå…ƒæ•°æ®æˆ–æ¶ˆæ¯å†…å®¹çš„æ™ºèƒ½è·¯ç”±ã€‚ å¯æ‰©å±•æ€§ æ¯ç§’é«˜è¾¾æ•°ç™¾ä¸‡æ¡æ¶ˆæ¯ã€‚ æ¯ç§’å¤šè¾¾æ•°åƒæ¡æ¶ˆæ¯ã€‚ æ¯ç§’å¤šè¾¾æ•°åƒæ¡æ¶ˆæ¯ã€‚ å¯é æ€§ è‡ªæ„ˆã€å®¹é”™é›†ç¾¤ã€‚ è‡ªæ„ˆã€å®¹é”™é›†ç¾¤ã€‚ æ‰˜ç®¡æœåŠ¡ã€‚ å®‰å…¨ TLS åŠ å¯†å’Œèº«ä»½éªŒè¯SASL æˆæƒ TLS åŠ å¯†å’Œèº«ä»½éªŒè¯SASL æˆæƒ AWS KMS èº«ä»½éªŒè¯ä¸ AWS IAM é›†æˆ æˆæœ¬å’Œè®¸å¯ å¼€æºã€‚å•†ä¸šé€‰æ‹©ã€‚ å¼€æºã€‚å•†ä¸šé€‰æ‹©ã€‚ æŒç»­çš„ä½¿ç”¨è´¹ã€‚ æ¶ˆæ¯ä¼ é€’æ¨¡å¼ ä»£ç†å¦‚ä½•ç»„ç»‡å’Œåˆ†å‘æ¶ˆæ¯å‡ ä¹å½±å“å…¶ä»–ä¸€åˆ‡ã€‚å®ƒä¸ä»…ä¼šå½±å“æ¶ˆæ¯ä»£ç†æœ€é€‚åˆçš„ç”¨ä¾‹ï¼Œè¿˜ä¼šå½±å“åº”ç”¨ç¨‹åºæ¶æ„å…¶ä½™éƒ¨åˆ†çš„è®¾è®¡ã€å¯æ‰©å±•æ€§ã€æ€§èƒ½å’Œçµæ´»æ€§ã€‚\né‚£ä¹ˆï¼ŒApache Kafkaã€RabbitMQ å’Œ AWS SNS/SQS æä¾›å“ªäº›æ¶ˆæ¯ä¼ é€’æ¨¡å¼ï¼Ÿ\nå›¾æ¡ˆ æè¿° å¯ç”¨æ€§ å‘å¸ƒ/è®¢é˜…ï¼ˆPub/Subï¼‰ Pub/Sub æ˜¯å›´ç»•ä¸»é¢˜æ„å»ºçš„ã€‚å‘å¸ƒè€…å°†æ¶ˆæ¯æ¨é€åˆ°ä¸»é¢˜ï¼Œç”±å¤šä¸ªè®¢é˜…è€…ä½¿ç”¨ã€‚ä¸€ä¸ªç®€å•çš„ä¾‹å­æ˜¯å¤©æ°”ç³»ç»Ÿã€‚æ¯ä¸ªåœ°ç‚¹éƒ½æœ‰ä¸€ä¸ªä¸»é¢˜ã€‚è¦†ç›–è¯¥ä½ç½®çš„æ°”è±¡ç«™å°†æ›´æ–°æ¨é€åˆ°è¯¥ä¸»é¢˜ï¼Œç„¶åç§»åŠ¨åº”ç”¨ç¨‹åºã€è­¦æŠ¥æœåŠ¡ç­‰ä½œä¸ºè¯¥ä¸»é¢˜çš„è®¢é˜…è€…æ¥æ”¶è¿™äº›æ›´æ–°ã€‚ Pub/Sub ä¸»è¦æ˜¯ä¸€ç§å•å‘å¹¿æ’­æ–¹æ³•ã€‚é€‰æ‹© Pub/Sub çš„åŸå› åŒ…æ‹¬ï¼š-**æ¾æ•£è€¦åˆï¼šå‘å¸ƒè€…å’Œè®¢é˜…è€…ä¸éœ€è¦äº’ç›¸äº†è§£æˆ–ç›´æ¥ä¾èµ–å¯¹æ–¹ã€‚- æœ‰åˆ©äºæ‰©å±•ï¼šå‘å¸ƒè€…æ¨é€æ¶ˆæ¯ä¸€æ¬¡ï¼Œç„¶åä¸“é—¨çš„ä»£ç†è´Ÿè´£å°†å…¶æ¨é€ç»™è®¢é˜…è€…- çµæ´»æ€§ï¼š**æ·»åŠ æ–°ä¸»é¢˜ã€å‘å¸ƒè€…å’Œè®¢é˜…è€…éå¸¸ç®€å•ï¼Œè¿™æ„å‘³ç€ç³»ç»Ÿå¯ä»¥è½»æ¾é€‚åº”ä¸æ–­å˜åŒ–çš„éœ€æ±‚ã€‚ é˜¿å¸•å¥‡Â·å¡å¤«å¡RabbitMQAWSç¤¾äº¤ç½‘ç»œæœåŠ¡ ç‚¹å¯¹ç‚¹æ¶ˆæ¯ä¼ é€’ æ¶ˆæ¯é˜Ÿåˆ—æˆ–ç‚¹å¯¹ç‚¹æ¶ˆæ¯ä¼ é€’ä¸ Pub/Sub çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œæ¶ˆæ¯ä»…ç”±ä¸€ä¸ªè®¢é˜…è€…è€Œä¸æ˜¯å¤šä¸ªè®¢é˜…è€…ä½¿ç”¨ã€‚é€šå¸¸ï¼Œæ¶ˆè´¹è€…ä¼šç¡®è®¤æ”¶è´§ï¼Œè¿™å¯ä»¥æ›´æ·±å…¥åœ°äº†è§£äº¤ä»˜èƒ½åŠ›ã€‚é€‰æ‹©ç‚¹å¯¹ç‚¹æ¶ˆæ¯ä¼ é€’çš„åŸå› åŒ…æ‹¬ï¼š- éœ€è¦å‘ç‰¹å®šæ”¶ä»¶äººå‘é€æ¶ˆæ¯ã€‚- ä¿è¯äº¤è´§ã€‚- æŒ‰ç‰¹å®šé¡ºåºäº¤ä»˜ã€‚ RabbitMQAWS æœåŠ¡è´¨é‡ä½“ç³» è¯·æ±‚-å›å¤ å½“æœåŠ¡éœ€è¦ç³»ç»Ÿå¦ä¸€éƒ¨åˆ†çš„æŸäº›å†…å®¹æ—¶ï¼Œåœ¨è¯·æ±‚-ç­”å¤æ¨¡å¼ä¸‹ï¼Œå®ƒä¼šä¸»åŠ¨è¯·æ±‚ï¼Œç„¶åå®æ—¶ç­‰å¾…ç­”æ¡ˆã€‚è¯·æ±‚-ç­”å¤æœ€é€‚åˆæ•°æ®æˆ–æ“ä½œå¯¹æ—¶é—´æ•æ„Ÿçš„æƒ…å†µã€‚ä¾‹å¦‚ï¼Œé“¶è¡Œåº”ç”¨ç¨‹åºå¯èƒ½ä¼šåœ¨è¿›è¡Œè´§å¸è½¬æ¢ä¹‹å‰è¯·æ±‚æœ€æ–°çš„æ±‡ç‡ã€‚é€‰æ‹©è¯·æ±‚-å›å¤æ¶ˆæ¯ä¼ é€’çš„åŸå› åŒ…æ‹¬ï¼š- åŠæ—¶å“åº”å¾ˆé‡è¦ï¼Œä¾‹å¦‚è¯·æ±‚è€…åœ¨ç»§ç»­ä¹‹å‰éœ€è¦å“åº”çš„æƒ…å†µã€‚- éœ€è¦åŒå‘é€šä¿¡ã€‚- ä¸æ— æ³•æ”¯æŒå‘å¸ƒ/è®¢é˜…é€šä¿¡çš„é—ç•™ç³»ç»Ÿé›†æˆã€‚ RabbitMQ æ¶ˆæ¯è·¯ç”± åœ¨è·¯ç”±æ–¹é¢ï¼Œæ¶ˆæ¯ä»£ç†æœ‰ä¸¤ç§å¹¿æ³›çš„é€‰æ‹©ï¼š\n**æ™ºèƒ½è·¯ç”±å™¨ï¼Œæ„šè ¢çš„æ¶ˆè´¹è€…ï¼š**ä»£ç†å†³å®šå°†æ¶ˆæ¯è·¯ç”±åˆ°å“ªé‡Œï¼Œè¿™æ„å‘³ç€æ¥æ”¶æ¶ˆæ¯çš„å¾®æœåŠ¡æˆ–åº”ç”¨ç¨‹åºè¦åšçš„å·¥ä½œæ›´å°‘ã€‚ **å“‘è·¯ç”±å™¨ï¼Œæ™ºèƒ½æ¶ˆè´¹è€…ï¼š**ä»£ç†å°†æ¶ˆæ¯å‘é€åˆ°é¢„å®šçš„é˜Ÿåˆ—ï¼Œä½†åº”ç”¨ç¨‹åºå †æ ˆçš„å…¶ä»–éƒ¨åˆ†å¿…é¡»å†³å®šå“ªä¸ªå¾®æœåŠ¡æˆ–åº”ç”¨ç¨‹åºè¯»å–å“ªä¸ªé˜Ÿåˆ—ã€‚ ä»å¹¿ä¹‰ä¸Šè®²ï¼ŒRabbitMQ é‡‡ç”¨æ™ºèƒ½è·¯ç”±å™¨ã€å“‘æ¶ˆè´¹è€…æ¨¡å‹ã€‚ RabbitMQ å¯ä»¥ä½¿ç”¨æ¶ˆæ¯çš„å†…å®¹ã€å…ƒæ•°æ®ã€å‘é€è€…ã€ä¸€å¤©ä¸­çš„æ—¶é—´å’Œå…¶ä»–æ ‡å‡†æ¥å†³å®šå¦‚ä½•è·¯ç”±å®ƒã€‚\nå¦ä¸€æ–¹é¢ï¼ŒApache Kafka æ›´é€‚åˆå“‘è·¯ç”±å™¨ã€æ™ºèƒ½æ¶ˆè´¹è€…æ¨¡å‹ã€‚ç„¶è€Œï¼Œæœ‰ä¸€äº›ç¬¬ä¸‰æ–¹å·¥å…·å¯ä»¥æ’å…¥ Apache Kafka æ¥å¯ç”¨ä¸åŒç±»å‹çš„æ™ºèƒ½è·¯ç”±ã€‚\nAWS SNS å’Œ SQS çš„ç»„åˆæä¾›äº†ä¸¤ç§æ–¹æ³•çš„ç»„åˆã€‚æ­£å¦‚æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„ï¼Œå‘å¸ƒè€…å¯ä»¥ä¸ºæ¯æ¡æ¶ˆæ¯æŒ‡å®š AWS SNS ä¸»é¢˜ã€‚ä¸ RabbitMQ ç±»ä¼¼ï¼ŒSNS è¿˜å…è®¸åŸºäºæ¶ˆæ¯å…ƒæ•°æ®å’Œæ¶ˆæ¯æ­£æ–‡è¿›è¡Œæ›´ç»†ç²’åº¦çš„è¿‡æ»¤ã€‚\nå¯æ‰©å±•æ€§ æˆ‘ä»¬æ­£åœ¨è€ƒè™‘çš„æ‰€æœ‰ä¸‰ä¸ªæ¶ˆæ¯ä»£ç†éƒ½å…·æœ‰è‰¯å¥½çš„æ‰©å±•æ€§ã€‚ä½†æ¯ä¸ªåŠŸèƒ½çš„æ‰©å±•ç¨‹åº¦å–å†³äºå®ƒæä¾›çš„å…¶ä»–åŠŸèƒ½ã€‚\næ¶ˆæ¯ä»£ç†é‡‡ç”¨æ™ºèƒ½è·¯ç”±å™¨è¿˜æ˜¯å“‘è·¯ç”±å™¨æ–¹æ³•åœ¨è¿™é‡Œä¼šäº§ç”Ÿä¸€äº›å½±å“ã€‚é€šè¿‡è¦æ±‚æ¶ˆæ¯ä»£ç†åšæ›´å¤šçš„å·¥ä½œï¼Œæ™ºèƒ½è·¯ç”±å™¨æ–¹æ³•çš„å¯æ‰©å±•æ€§æ¯”å“‘è·¯ç”±å™¨æ¨¡å‹è¦å·®ä¸€äº›ã€‚\nRabbitMQ å’Œ Apache Kafka éƒ½æ˜¯æ°´å¹³æ‰©å±•çš„ã€‚æ¢å¥è¯è¯´ï¼Œæ‚¨å¯ä»¥åˆ›å»º RabbitMQ æˆ– Apache Kafka èŠ‚ç‚¹çš„é›†ç¾¤ã€‚æ¯ä¸ªä¸»é¢˜å¯ä»¥è·¨å¤šä¸ªèŠ‚ç‚¹è¿›è¡Œåˆ†åŒºï¼Œå› æ­¤æ·»åŠ æ›´å¤šå®ä¾‹å¯ä»¥å¢åŠ é›†ç¾¤çš„å®¹é‡ã€‚\nå°½ç®¡ä¸¤è€…ä¹‹é—´çš„ä¸€äº›æ¶æ„å†³ç­–æœ‰æ‰€ä¸åŒï¼Œä½†å®ƒä»¬éƒ½ç›¸å¯¹å®¹æ˜“æ‰©å±•ã€‚ç„¶è€Œï¼Œåœ¨æ‰©å±•å¦‚ä½•å½±å“ååé‡æ–¹é¢ï¼Œå®ƒä»¬å­˜åœ¨æ˜¾ç€å·®å¼‚ã€‚é€šå¸¸ï¼ŒRabbitMQæ¯ç§’å¤„ç†æ•°åƒæ¡æ¶ˆæ¯ï¼Œè€Œå³ä½¿ç›¸å¯¹è¾ƒå°çš„ Apache Kafka é›†ç¾¤æ¯ç§’ä¹Ÿå¯ä»¥å¤„ç†æ•°ç™¾ä¸‡æ¡æ¶ˆæ¯ã€‚\nä½œä¸ºæ‰˜ç®¡æœåŠ¡ï¼Œæ‰©å±• AWS SNS å’Œ SQS çš„é‡ç‚¹ä¸æ˜¯å¯ä»¥å¯åŠ¨å¤šå°‘ä¸ªå®ä¾‹ï¼Œè€Œæ˜¯ååé‡é™åˆ¶ã€‚ä¾‹å¦‚ï¼ŒAWS SQSæ¯ç§’æœ€å¤šå¼•ç”¨ 30,000 æ¡æ¶ˆæ¯ï¼Œå¹¶ä¸”åªæœ‰åœ¨æ¶ˆæ¯æ‰¹é‡å‘é€çš„æƒ…å†µä¸‹æ‰å¦‚æ­¤ã€‚\nå¯é æ€§ å¯æ‰©å±•æ€§å’Œå¯é æ€§æ˜¯é½å¤´å¹¶è¿›çš„ã€‚ä½œä¸ºæ°´å¹³å¯æ‰©å±•çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼ŒApache Kafka å’Œ RabbitMQ éƒ½å¯ä»¥åœ¨å•ä¸ªèŠ‚ç‚¹ç¦»çº¿çš„æƒ…å†µä¸‹ç»§ç»­å­˜åœ¨ï¼Œå› ä¸ºå…¶ä»–èŠ‚ç‚¹ä¼šå¼¥è¡¥è¿™ä¸€ç¼ºé™·ã€‚\nåœ¨ RabbitMQ çš„æƒ…å†µä¸‹ï¼Œå„ä¸ªæ¶ˆæ¯åœ¨å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´å¤åˆ¶ï¼Œè¿™æ„å‘³ç€å¦‚æœä¸€ä¸ªèŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œæ¶ˆæ¯åœ¨å…¶ä»–èŠ‚ç‚¹ä¸Šä»ç„¶å¯ç”¨ã€‚åŒæ ·ï¼ŒRabbitMQå¯ä»¥å°†æ¶ˆæ¯æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œè¿™æ ·å³ä½¿æ•´ä¸ªé›†ç¾¤ç¦»çº¿ä¹Ÿå¯ä»¥æ¢å¤ã€‚\nä¸ RabbitMQ ä¸€æ ·ï¼ŒApache Kafka ä½¿ç”¨å¤šä¸ªèŠ‚ç‚¹æ¥æé«˜å¯ç”¨æ€§ã€‚é€šå¸¸ï¼ŒApache Kafka å°†æ¶ˆæ¯å¤åˆ¶åˆ°ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œä½†å¤åˆ¶å› å­æ˜¯å¯é…ç½®çš„ã€‚å¦‚æœæŸä¸ªèŠ‚ç‚¹ä¸å¯ç”¨ï¼ŒApache Kafka ä¼šè‡ªåŠ¨é‡æ–°é…ç½®è‡ªèº«ï¼Œä»¥å°†å·¥ä½œè´Ÿè½½åˆ†æ•£åˆ°ç¼©å‡åçš„é›†ç¾¤ä¸­ã€‚\nAWS SNS å’Œ SQS é‡‡ç”¨ç±»ä¼¼çš„æ–¹æ³•ã€‚å®ƒä»¬è·¨å¤šä¸ªå¯ç”¨åŒºï¼ˆå³ AWS åŒºåŸŸå†…çš„ç‹¬ç«‹æ•°æ®ä¸­å¿ƒï¼‰å¤åˆ¶æ¶ˆæ¯ï¼Œä»¥ä¾¿é›†ç¾¤èƒ½å¤Ÿåœ¨ä¸€ä¸ªåŒºåŸŸå‘ç”Ÿä¸­æ–­æ—¶å¹¸å­˜ä¸‹æ¥ã€‚ä¸ RabbitMQ å’Œ Apache Kafka ä¸€æ ·ï¼Œæ¶ˆæ¯å¯ä»¥æŒä¹…ä¿å­˜åˆ°ç£ç›˜ï¼Œä»¥ä¾¿åœ¨å‘ç”Ÿè¾ƒå¤§æ•…éšœæ—¶è¿›è¡Œæ¢å¤ã€‚\nå®‰å…¨ é™¤äº†ä¿¡ä»»æ¯ä¸ªä¾›åº”å•†/é¡¹ç›®å¦‚ä½•è§£å†³å®‰å…¨æ¼æ´ä¹‹å¤–ï¼Œæ¶ˆæ¯ä»£ç†çš„å®‰å…¨æ€§è¿˜å–å†³äºä¸‰ä¸ªå› ç´ ï¼š\n**èº«ä»½éªŒè¯ï¼š**éªŒè¯å‘å¸ƒè€…å’Œæ¶ˆè´¹è€…çš„èº«ä»½ä»¥æˆäºˆå¯¹æ¶ˆæ¯ä»£ç†çš„è®¿é—®æƒé™ã€‚ **æˆæƒï¼š**ä½¿ç”¨è®¿é—®æ§åˆ¶åˆ—è¡¨ (ACL) æ¥ç¡®å®šæ¯ä¸ªå‘å¸ƒè€…å’Œæ¶ˆè´¹è€…å¯ä»¥ä½¿ç”¨å“ªäº›ä¸»é¢˜å’ŒåŠŸèƒ½ã€‚ **æ•°æ®åŠ å¯†ï¼š**åœ¨æ•°æ®é€šè¿‡ç³»ç»Ÿï¼ˆä¼ è¾“ä¸­ï¼‰å’Œç£ç›˜ä¸Šï¼ˆé™æ€ï¼‰æ—¶ä¿æŠ¤æ•°æ®ã€‚ ä¸è®¸å¤šäº‹æƒ…ä¸€æ ·ï¼ŒApache Kafka çš„èº«ä»½éªŒè¯å¯é€šè¿‡ä½¿ç”¨ç¬¬ä¸‰æ–¹é™„åŠ ç»„ä»¶è¿›è¡Œé…ç½®ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒApache Kafka æä¾› TLS æˆ–SASLèº«ä»½éªŒè¯ã€‚ TLS èº«ä»½éªŒè¯ä½¿ç”¨å…¬ç§å¯†é’¥å¯¹æ¥ç¡®è®¤æ˜¯å¦å…è®¸å®¢æˆ·ç«¯è®¿é—® Apache Kafka å®ä¾‹ã€‚ SASL æä¾›ä¸åŒçº§åˆ«çš„èº«ä»½éªŒè¯ï¼Œä»ç”¨æˆ·åå’Œå¯†ç åˆ° OAUTH 2.0ã€‚\nåŒæ ·ï¼ŒRabbitMQä½¿ç”¨ X.509 è¯ä¹¦æä¾›åŸºäº TLS çš„èº«ä»½éªŒè¯ã€‚æˆ–è€…ï¼ŒRabbitMQ å¯ä»¥æ”¯æŒç”¨æˆ·å/å¯†ç å¯¹è¿›è¡Œèº«ä»½éªŒè¯ã€‚\nApache Kafka å’Œ RabbitMQ éƒ½å…è®¸é€šè¿‡ ACL æˆäºˆç»†ç²’åº¦çš„æƒé™ï¼Œä¾‹å¦‚è¯»å–ã€å†™å…¥ã€é…ç½®å’Œç®¡ç†ã€‚\nä¸æ­¤å¤„çš„è®¸å¤šå› ç´ ä¸€æ ·ï¼ŒAWS SNS/SQS ç•¥æœ‰ä¸åŒï¼Œå› ä¸ºå®ƒä»¬æ˜¯ AWS ç”Ÿæ€ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ã€‚å› æ­¤ï¼Œä»–ä»¬ä¸»è¦ä½¿ç”¨ Amazon çš„ IAM è¯ä¹¦è¿›è¡Œèº«ä»½éªŒè¯å’Œè®¿é—®æ§åˆ¶ã€‚\nä¸è¿‡ï¼Œåœ¨æ•°æ®åŠ å¯†æ–¹é¢ï¼Œè¿™äº›äº§å“ä¹‹é—´çš„å·®å¼‚è¾ƒå°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒApache Kafka å’Œ RabbitMQ éƒ½ä»¥æ˜æ–‡å½¢å¼å‘é€æ•°æ®ï¼Œä½†ä¹Ÿå¯ä»¥ä½¿ç”¨ TLS åŠ å¯†ä¼ è¾“ä¸­çš„æ•°æ®ã€‚å°± Apache Kafka è€Œè¨€ï¼Œæœ‰è®¸å¤šç¬¬ä¸‰æ–¹æ’ä»¶å¯ä»¥æ”¯æŒå…¶ä»–å½¢å¼çš„ä¼ è¾“ä¸­åŠ å¯†ã€‚ Apache Kafka å’Œ RabbitMQ éƒ½ä¸åŠ å¯†é™æ€æ•°æ®ï¼Œè€Œæ˜¯å»ºè®®ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œä¾‹å¦‚åŠ å¯†æ–‡ä»¶ç³»ç»Ÿã€‚ AWS SNS å’Œ SQS ä¾èµ–AWS Key Management Serviceæ¥åŠ å¯†é™æ€å’Œä¼ è¾“ä¸­çš„æ•°æ®ã€‚\næˆæœ¬å’Œè®¸å¯ è®¡ç®—æ€»æ‹¥æœ‰æˆæœ¬ (TCO) å¯èƒ½å¾ˆå¤æ‚ã€‚ RabbitMQ å’Œ Apache Kafka éƒ½æ˜¯å¼€æºé¡¹ç›®ï¼Œä½¿ç”¨æ—¶ä¸éœ€è¦è®¸å¯è´¹ç”¨ã€‚ç„¶è€Œï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒApache Kafka åœ¨è®¾ç½®å’Œæ“ä½œæ–¹é¢å¯èƒ½ä¼šå¸¦æ¥æŒ‘æˆ˜ï¼Œè¿™å¯èƒ½æ„å‘³ç€æ‚¨éœ€è¦è˜è¯·ä¸“é—¨çš„å‘˜å·¥æˆ–é¡¾é—®æ¥ç®¡ç†å’Œç®¡ç†éƒ¨ç½²ã€‚\nåœ¨è¾ƒå°çš„è§„æ¨¡ä¸‹ï¼ŒRabbitMQ æ¯” Apache Kafka æ›´å®¹æ˜“è¿è¡Œï¼Œå¹¶ä¸”ä»¥å…¶æ“ä½œç¨³å®šæ€§è€Œé—»åã€‚å¦‚æœæ‚¨é€‰æ‹© Apache Kafka æˆ– RabbitMQ çš„å•†ä¸šç‰ˆæœ¬ï¼Œæ˜¾ç„¶è¿™ä¼šå¸¦æ¥è®¸å¯æˆæœ¬ï¼Œä½†æ‚¨ä¹Ÿå°†å—ç›Šäºé™„åŠ åŠŸèƒ½ã€å¢å¼ºçš„æ–‡æ¡£å’Œæ”¯æŒï¼Œè¿™åè¿‡æ¥åˆå¯ä»¥é™ä½å…¶ä»–æ–¹é¢çš„æˆæœ¬ã€‚\nåŒæ ·ï¼ŒAWS äº§å“åœ¨è¿™é‡Œå¾ˆå¥‡æ€ªï¼Œå› ä¸ºå®ƒä»¬ä¸æ˜¯å¼€æºçš„ï¼Œåªèƒ½ä½œä¸ºæ‰˜ç®¡æœåŠ¡æä¾›ã€‚è¿™å°†è®¸å¯ã€äº‘å’Œè¿è¥æˆæœ¬æ•´åˆåˆ°ä¸€å¼ è´¦å•ä¸­ã€‚\næ‚¨åº”è¯¥ä½¿ç”¨å“ªä¸ªæ¶ˆæ¯ä»£ç†ï¼Ÿ Apache Kafkaã€RabbitMQ å’Œ AWS SNS/SQS éƒ½æ˜¯æ¶ˆæ¯ä»£ç†ï¼Œä½†å®ƒä»¬éƒ½æœ‰è‡ªå·±çš„ä¼˜ç‚¹å’Œç¼ºç‚¹ã€‚\nApache Kafka ä»¥å…¶é«˜ååé‡å’Œæ‰©å±•åˆ°éå¸¸å¤§çš„ååé‡çš„èƒ½åŠ›è€Œé—»åï¼Œè¿™ä½¿å…¶æˆä¸ºéœ€è¦å®æ—¶å¤„ç†å¤§é‡æ•°æ®çš„åº”ç”¨ç¨‹åºçš„ä¸é”™é€‰æ‹©ã€‚ RabbitMQ ä¸å¤ªå…³æ³¨çº¯ç²¹çš„ååé‡ï¼Œè€Œæ›´å¤šåœ°å…³æ³¨æ™ºèƒ½è·¯ç”±æ¶ˆæ¯ã€‚ AWS SNS å’Œ SQS çš„ç»„åˆæ¯”å…¶ä»–ä¸¤ä¸ªé€‰é¡¹æ›´æ˜“äºè®¾ç½®å’Œè¿è¡Œï¼Œä½†éšç€å·¥ä½œè´Ÿè½½çš„æ‰©å±•ï¼Œå¯èƒ½ä¼šäº§ç”Ÿæˆæœ¬å½±å“ã€‚ é‚£ä¹ˆï¼Œå“ªä¸ªæ¶ˆæ¯ä»£ç†é€‚åˆæ‚¨çš„é¡¹ç›®ï¼Ÿéœ€è¦è€ƒè™‘çš„æœ€é‡è¦å› ç´ æ˜¯ï¼š\nå®ƒæ ¹æ®æ¶ˆæ¯çš„å†…å®¹å’Œå…ƒæ•°æ®è·¯ç”±æ¶ˆæ¯çš„èƒ½åŠ›å¦‚ä½•ã€‚ æ•°æ®é‡å’Œååé‡ã€‚ å¯æ‰©å±•æ€§å’Œå®¹é”™æ€§ã€‚ å®‰å…¨åŠŸèƒ½ã€‚ æˆæœ¬å’Œæ‰€æœ‰æƒæ¨¡å‹ã€‚ è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œä»¥ä¸‹æ˜¯é€‰æ‹©æ¶ˆæ¯ä»£ç†çš„ä¸€äº›å»ºè®®ï¼š\néå¸¸å¤§çš„æ•°æ®é‡ã€çµæ´»çš„å¯æ‰©å±•æ€§å’ŒåŸºæœ¬çš„è·¯ç”±éœ€æ±‚ï¼šApache Kafkaã€‚ å¤§é‡æ•°æ®å’Œå¤æ‚çš„è·¯ç”±ï¼šRabbitMQã€‚ å¤§é‡æ•°æ®å’Œå®Œå…¨æ‰˜ç®¡é€‰é¡¹ï¼šAWS SNS å’Œ SQSã€‚ ","permalink":"https://blog.chensoul.cc/posts/2024/05/07/apache-kafka-vs-rabbitmq-vs-aws-sns-sqs/","summary":"åŸæ–‡é“¾æ¥ï¼šhttps://ably.com/topic/apache-kafka-vs-rabbitmq-vs-aws-sns-sqs\nå°†æ¶ˆæ¯ä»ä¸€ä¸ªç»„ä»¶è·å–åˆ°å¦ä¸€ä¸ªç»„ä»¶æ˜¯å¾®æœåŠ¡æ¶æ„ä¸­æœ€é‡è¦çš„éƒ¨åˆ†ä¹‹ä¸€ã€‚æ¯ä¸ªæœåŠ¡å¿…é¡»èƒ½å¤Ÿä¸ä»»ä½•å…¶ä»–æœåŠ¡å¼‚æ­¥ã€å¯é ä¸”å¤§è§„æ¨¡åœ°é€šä¿¡ã€‚\nè¿™å°±æ˜¯æ¶ˆæ¯ä»£ç†çš„ç”¨æ­¦ä¹‹åœ°ã€‚æ¶ˆæ¯ä»£ç†ï¼ˆä¾‹å¦‚ Apache Kafkaã€RabbitMQ å’ŒAWS SNS/SQSï¼‰ä¸ºæ‚¨æä¾›ä¸€ä¸ªé€šç”¨æ¥å£å’Œä¸€ç»„ä¿è¯ï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨åè°ƒå¯èƒ½æ•°åƒä¸ªå¾®æœåŠ¡ä¹‹é—´çš„é€šä¿¡ã€‚è¿™ç®€åŒ–äº†é›†æˆå¹¶æ›´å®¹æ˜“æ¨ç†æ‚¨çš„ç³»ç»Ÿã€‚\nç„¶è€Œï¼Œæ¯”è¾ƒæ¶ˆæ¯ä»£ç†å¯èƒ½å¾ˆæ£˜æ‰‹ï¼Œå› ä¸ºæ¯ä¸ªæ¶ˆæ¯ä»£ç†éƒ½é‡‡ç”¨ä¸åŒçš„æ–¹æ³•æ¥å®Œæˆå·¥ä½œã€‚é‚£ä¹ˆï¼Œæ‚¨å¦‚ä½•å†³å®šå“ªä¸ªæ¶ˆæ¯ä»£ç†æœ€é€‚åˆæ‚¨çš„ç”¨ä¾‹ï¼Ÿ\nåœ¨æœ¬æ–‡ä¸­ï¼Œæ‚¨å°†æ‰¾åˆ°æœ‰å…³ä¸šç•Œæœ€å—æ¬¢è¿çš„ä¸‰ä¸ªæ¶ˆæ¯ä»£ç†å¦‚ä½•é€‚ç”¨äºä¸åŒç”¨ä¾‹çš„æŒ‡å—ã€‚æˆ‘ä»¬å°†ç ”ç©¶è¯¸å¦‚å®ƒä»¬çš„æ‰©å±•æ–¹æ³•ã€å®ƒä»¬æ”¯æŒçš„æ¶ˆæ¯ä¼ é€’æ¨¡å¼ä»¥åŠå®ƒä»¬å¦‚ä½•å¤„ç†æ€§èƒ½å’Œæ™ºèƒ½æ¶ˆæ¯è·¯ç”±ä¹‹é—´çš„æƒè¡¡ç­‰ç‰¹å¾ã€‚\næ¯”è¾ƒæ¶ˆæ¯ä»£ç†ï¼šæ‚¨åº”è¯¥å¯»æ‰¾ä»€ä¹ˆï¼Ÿ æ¶ˆæ¯ä»£ç†æ˜¯ä¸€ä¸ªå¹¿æ³›çš„ç±»åˆ«ã€‚è™½ç„¶æˆ‘ä»¬æ­£åœ¨è€ƒè™‘çš„ä¸‰ä¸ªé€‰é¡¹ä¸­çš„æ¯ä¸€ä¸ªéƒ½åœ¨æ›´å¤§ç³»ç»Ÿä¸­çš„ç»„ä»¶ä¹‹é—´ç§»åŠ¨æ•°æ®ï¼Œä½†åœ¨å®ƒä»¬ä¹‹é—´åšå‡ºå†³å®šå–å†³äºå®ƒä»¬å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ã€‚\nå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ£€æŸ¥æ¯ä¸ªæ¶ˆæ¯ä»£ç†çš„ç‰¹å¾ï¼Œæ ¹æ®å®ƒä»¬å¦‚ä½•å½±å“å…¶ç§»åŠ¨æ•°æ®çš„èƒ½åŠ›ä»¥åŠå®ƒçš„å·¥ä½œæ–¹å¼ã€‚æˆ‘ä»¬å°†ç ”ç©¶ä»¥ä¸‹å…­ä¸ªå› ç´ ä»¥åŠå®ƒä»¬å¦‚ä½•åº”ç”¨äº Apache Kafkaã€RabbitMQ å’Œ AWS SNS/SQSï¼š\n**æ¶ˆæ¯ä¼ é€’æ¨¡å¼ï¼š**æ¶ˆæ¯ä»£ç†ç»„ç»‡å’Œåˆ†å‘æ¶ˆæ¯çš„æ–¹å¼ï¼ˆä¾‹å¦‚å‘å¸ƒ/è®¢é˜…æˆ–è¯·æ±‚å›å¤ï¼‰æ¯”å…¶ä»–æ¶æ„å’Œç”¨ä¾‹æ›´é€‚åˆæŸäº›æ¶æ„å’Œç”¨ä¾‹ã€‚ **æ¶ˆæ¯è·¯ç”±ï¼š**æ¶ˆæ¯ä»£ç†èƒ½å¦æ ¹æ®æ¶ˆæ¯çš„å†…å®¹å’Œå…¶ä»–æ ‡å‡†æ¥è·¯ç”±æ¶ˆæ¯ï¼Ÿ **å¯æ‰©å±•æ€§ï¼š**å¹¶éæ¯ç§æƒ…å†µéƒ½éœ€è¦æ¯ç§’å¤„ç†æ•°ç™¾ä¸‡æ¡æ¶ˆæ¯ã€‚ç¡®ä¿æ¶ˆæ¯ä»£ç†å¯ä»¥æ‰©å±•åˆ°æ‚¨éœ€è¦çš„ååé‡çº§åˆ«ï¼ŒåŒæ—¶ç‰¢è®°è¿™å°†å¦‚ä½•å½±å“è®¾ç½®å’Œæ“ä½œçš„å¤æ‚æ€§ã€‚ **å¯é æ€§ï¼š**æ¶ˆæ¯ä»£ç†å¦‚ä½•å¤„ç†æ•…éšœï¼Ÿå®ƒä¼šä¿ç•™æ¶ˆæ¯è¿˜æ˜¯ä»…é€šè¿‡ç³»ç»Ÿä¼ é€’æ¶ˆæ¯ï¼Ÿ **å®‰å…¨æ€§ï¼š**æ•°æ®æ˜¯å¦åŠ å¯†ï¼Ÿæ¶ˆæ¯ä»£ç†æ˜¯å¦æä¾›å®¡æ ¸æ—¥å¿—ï¼Ÿå®ƒå¦‚ä½•å¤„ç†èº«ä»½éªŒè¯å’Œè®¿é—®æ§åˆ¶ï¼Ÿæ˜¯å¦ç»è¿‡ HIPAA å’Œ PCI DSS ç­‰è¡Œä¸šæ ‡å‡†è®¤è¯ï¼Ÿ **æˆæœ¬å’Œè®¸å¯ï¼š**æ¶ˆæ¯ä»£ç†æ˜¯å¼€æºçš„å—ï¼Ÿéœ€è¦å“ªäº›äº‘æˆ–æœåŠ¡å™¨èµ„æºï¼Ÿæ˜¯å¦æŒç»­æ”¶å–è®¸å¯è´¹ï¼Ÿæ‚¨çš„å›¢é˜Ÿéœ€è¦èŠ±è´¹å¤šå°‘æ—¶é—´æ¥è¿è¡Œå®ƒï¼Ÿ ä»‹ç» Apache Kafkaã€RabbitMQ ä»¥åŠ AWS SNS å’Œ SQS åœ¨è¯¦ç»†è¿›è¡Œæ¯”è¾ƒä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥è°ˆè°ˆä¸ºä»€ä¹ˆæˆ‘ä»¬å…³æ³¨è¿™ä¸‰ç§è§£å†³æ–¹æ¡ˆã€‚åŸå› ä¹‹ä¸€æ˜¯å®ƒä»¬æ˜¯æ‚¨å¯èƒ½é‡åˆ°çš„æœ€å¸¸è§çš„æ¶ˆæ¯ä»£ç†è§£å†³æ–¹æ¡ˆä¹‹ä¸€ã€‚ç ”ç©¶è¡¨æ˜ï¼Œå…¨çƒæœ‰è¿‘ 50,000 å®¶å…¬å¸ä½¿ç”¨ RabbitMQï¼Œè€Œè¶…è¿‡60,000 å®¶å…¬å¸æ­£åœ¨ä½¿ç”¨ Apache Kafkaã€‚å°½ç®¡ AWS SQS çš„ç”¨æˆ·ç¾¤ä¼¼ä¹è¾ƒå°ï¼Œä½†åªæœ‰è¶…è¿‡ 24,000 å®¶å…¬å¸ï¼Œä½†å®ƒåœ¨æ›´å¹¿æ³›çš„ Amazon Web Services ç”Ÿæ€ç³»ç»Ÿä¸­å‘æŒ¥ç€é‡è¦ä½œç”¨ã€‚è¿™ç§å¹¿æ³›çš„éƒ¨ç½²ä½¿å¾—æ‚¨å¯ä»¥æ›´è½»æ¾åœ°æ‹›å‹Ÿç»éªŒä¸°å¯Œçš„å‘˜å·¥ã€ä¸ç°æœ‰æŠ€æœ¯å †æ ˆé›†æˆï¼Œä»¥åŠå½“æ‚¨éœ€è¦æ—¶å¯»æ±‚æ”¯æŒã€‚ä½†è¿˜æœ‰å¦ä¸€ä¸ªè€ƒè™‘å› ç´ ã€‚æˆ‘ä»¬æ­£åœ¨ç ”ç©¶çš„æ¯ä¸ªæ¶ˆæ¯ä»£ç†éƒ½ä»ä¸åŒçš„è§’åº¦è§£å†³è¯¥é—®é¢˜ã€‚ Apache Kafka ä¸“ä¸ºååé‡è€Œè®¾è®¡ï¼Œè€Œ RabbitMQ æ›´å…³æ³¨å¤æ‚çš„æ¶ˆæ¯è·¯ç”±ã€‚ä¸ RabbitMQ ä¸€æ ·ï¼ŒSNS å’Œ SQS è¿™ä¸¤ç§ AWS è§£å†³æ–¹æ¡ˆæ›´å…³æ³¨è·¯ç”±è€Œä¸æ˜¯ååé‡ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œè€ƒè™‘å®ƒä»¬æ˜¯å› ä¸º AWS ç”Ÿæ€ç³»ç»Ÿçš„é‡è¦æ€§ã€‚\né˜¿å¸•å¥‡Â·å¡å¤«å¡ Apache Kafka æ˜¯ä¸€ä¸ªå®æ—¶æµå¹³å°ï¼Œæ—¨åœ¨æ„å»ºå¯æ‰©å±•ã€å®¹é”™çš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºã€‚å®ƒä¸“é—¨ä»¥éå¸¸é«˜çš„ååé‡ä¼ è¾“æ•°æ®ï¼Œé€šå¸¸ç”¨äºæ“ä½œæ•°æ®ï¼Œä¾‹å¦‚æ—¥å¿—è®°å½•å’ŒæŒ‡æ ‡ã€‚\næ‹¥æœ‰å¦‚æ­¤åºå¤§çš„å®‰è£…åŸºç¡€ï¼Œæœ‰ä¸€äº›å·¥å…·å¯ä»¥å°† Apache Kafka è¿æ¥åˆ°å‡ ä¹ä»»ä½•å…¶ä»–æ­£åœ¨è¿è¡Œçš„ç³»ç»Ÿã€‚å°½ç®¡ Apache Kafka ä¸“æ³¨äºé«˜ååé‡ï¼Œä½†å®ƒä¹Ÿå¯ä»¥å¤„ç†ä¼ è¾“ä¸­çš„æ•°æ®ï¼Œä¾‹å¦‚è§¦å‘æ“ä½œå’Œè½¬æ¢æ•°æ®ã€‚ç„¶è€Œï¼Œè¿™ç§çµæ´»æ€§å’Œå¼ºå¤§åŠŸèƒ½æ˜¯æœ‰ä»£ä»·çš„ï¼Œå› ä¸º Apache Kafka æ¯”æŸäº›æ›¿ä»£æ–¹æ¡ˆæ›´éš¾è®¾ç½®å’Œæ“ä½œã€‚\nRabbitMQ ä¸ Apache Kafka ä¸“æ³¨äºæµæ•°æ®ä¸åŒï¼ŒRabbitMQ æ˜¯ä¸€ä¸ªå¼€æºåˆ†å¸ƒå¼æ¶ˆæ¯ä»£ç†ï¼Œæ”¯æŒå¤šç§ä¸åŒçš„æ¶ˆæ¯ä¼ é€’æ¨¡å¼ï¼Œä¾‹å¦‚å‘å¸ƒ/è®¢é˜…å’Œç”Ÿäº§è€…/æ¶ˆè´¹è€…ã€‚å°½ç®¡å®ƒç¡®å®æ‹¥æœ‰é«˜ååé‡ï¼Œä½†å®ƒçš„é‡ç‚¹æ›´å¤šåœ°æ˜¯æ ¹æ®æ¶ˆæ¯å†…å®¹ã€ä¸€å¤©ä¸­çš„æ—¶é—´ã€å‘é€è€…å’Œå…¶ä»–æ ‡å‡†æ™ºèƒ½åœ°è·¯ç”±æ•°æ®ï¼Œè¿™ä½¿å¾—å®ƒéå¸¸é€‚åˆäº‹ä»¶é©±åŠ¨çš„æ¶æ„ã€‚\nä¸ Apache Kafka ä¸€æ ·ï¼ŒRabbitMQ å¾—åˆ°äº†å¹¿æ³›çš„æ”¯æŒï¼Œå…·æœ‰ä¸°å¯Œçš„é›†æˆç”Ÿæ€ç³»ç»Ÿã€‚\nAWS SNS å’Œ SQS Amazon Web Services (AWS) æä¾›äº†ä¸¤ç§é€‚åˆæ¶ˆæ¯ä»£ç†æ——å¸œçš„äº§å“ã€‚ AWS Simple Notification Service (SNS) æ˜¯ä¸€ç§é«˜ååé‡æ¶ˆæ¯ä¼ é€’æœåŠ¡ï¼Œå®ƒä½¿ç”¨å‘å¸ƒ/è®¢é˜…æ¨¡å‹åœ¨å¾®æœåŠ¡æˆ–åˆ†å‘åº”ç”¨ç¨‹åºçš„ç»„ä»¶ä¹‹é—´ä¼ é€’æ¶ˆæ¯ã€‚","title":"[è¯‘]Apache Kafkaã€RabbitMQ ä¸ AWS SNSSQSï¼šå“ªä¸ªæ¶ˆæ¯ä»£ç†æœ€å¥½ï¼Ÿ"},{"content":"åŸæ–‡ï¼šhttps://ably.com/topic/websockets-java\nåœ¨å…¨çƒèŒƒå›´å†…ï¼Œäººä»¬å¯¹å®æ—¶ä¼ è¾“æ•°æ®çš„éœ€æ±‚ä¸æ–­å¢é•¿ï¼ŒWebSocketå¯èƒ½æ˜¯æ­¤ç±»ç”¨ä¾‹ä¸­æœ€æµè¡Œçš„ä¼ è¾“åè®®ã€‚åœ¨ WebSocket å‡ºç°ä¹‹å‰ï¼Œâ€œå®æ—¶â€ç½‘ç»œå·²ç»å­˜åœ¨ï¼Œä½†å®ƒå¾ˆéš¾å®ç°ï¼Œé€šå¸¸é€Ÿåº¦è¾ƒæ…¢ï¼Œå¹¶ä¸”æ˜¯é€šè¿‡ç ´è§£ç°æœ‰çš„ç½‘ç»œæŠ€æœ¯æ¥å®ç°çš„ï¼Œè€Œè¿™äº›æŠ€æœ¯å¹¶ä¸æ˜¯ä¸ºå®æ—¶åº”ç”¨ç¨‹åºè®¾è®¡çš„ã€‚ WebSocket åè®®ä¸ºçœŸæ­£çš„å®æ—¶ç½‘ç»œé“ºå¹³äº†é“è·¯ã€‚\nJavaæ˜¯ä¸€ç§æµè¡Œçš„ç¼–ç¨‹è¯­è¨€å’Œè®¡ç®—è¯­è¨€ã€‚å®ƒæ˜¯ Android æ™ºèƒ½æ‰‹æœºåº”ç”¨ç¨‹åºçš„æ ¸å¿ƒç¼–ç¨‹è¯­è¨€ä¹‹ä¸€ï¼Œæ˜¯æ„å»ºå®æ—¶ç³»ç»Ÿçš„å¯é é€‰æ‹©ã€‚ WebSockets æˆä¸º Java æ ‡å‡†ç‰ˆ SDK çš„ä¸€éƒ¨åˆ†å·²ç»æœ‰ä¸€æ®µæ—¶é—´äº†ã€‚WebSocket åè®®æœ€åˆæ˜¯åœ¨ 2013 å¹´ä½œä¸ºJSR 356çš„ä¸€éƒ¨åˆ†æå‡ºçš„ï¼Œç›®å‰å·²ä½œä¸ºjavax.websocketåŒ…çš„ä¸€éƒ¨åˆ†åŒ…å«åœ¨ Java SDK ä¸­ã€‚\nç”±äºå¯¹å®æ—¶æ•°æ®çš„éœ€æ±‚æ­£åœ¨ç¨³æ­¥å¢é•¿ï¼Œå¹¶ä¸” Java å·²æˆä¸ºä¸€ç§æˆç†Ÿä¸”å¹¿æ³›ä½¿ç”¨çš„è¯­è¨€/å¹³å°ï¼Œå› æ­¤æˆ‘è®¤ä¸ºå€¼å¾—è€ƒè™‘ä¸ºJava å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå®ç°å¯é çš„ WebSocket è§£å†³æ–¹æ¡ˆæ‰€é¢ä¸´çš„ä¼—å¤šæŒ‘æˆ˜ã€‚\nç°çŠ¶â€”â€”ç®€è¦æ¦‚è¿° åŸºæœ¬æˆ–åŸå§‹çš„ WebSocket å®ç°å¾ˆå°‘èƒ½å¤Ÿæ»¡è¶³ä¸ºæœªçŸ¥ï¼ˆä½†å¯èƒ½éå¸¸å¤šï¼‰æ•°é‡çš„ç”¨æˆ·æä¾›æœåŠ¡çš„å®æ—¶åº”ç”¨ç¨‹åºçš„éœ€æ±‚ã€‚å¤§å¤šæ•°æ—¶å€™ï¼Œæ‚¨éœ€è¦è€ƒè™‘æ‰©å±• Java å®¢æˆ·ç«¯ WebSocket å®ç°çš„åŠŸèƒ½ã€‚\nä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨nv-websocket-clientç­‰å¼€æºåº“ï¼Œå…¶ä¸­åŒ…å«ä¸€äº›é™„åŠ åŠŸèƒ½ï¼Œä¾‹å¦‚ä»£ç†æ”¯æŒã€‚è¿™æ˜¯ä½¿ç”¨ nv-websocket-client åˆ›å»º WebSocket å®ä¾‹çš„æ–¹æ³•ï¼š\n// Create a WebSocket. The scheme part can be one of the following: // \u0026#39;ws\u0026#39;, \u0026#39;wss\u0026#39;, \u0026#39;http\u0026#39; and \u0026#39;https\u0026#39; (case-insensitive). The user info // part, if any, is interpreted as expected. If a raw socket failed // to be created, an IOException is thrown. WebSocket ws = new WebSocketFactory().createSocket(\u0026#34;ws://localhost/endpoint\u0026#34;); åˆ›å»º WebSocket å®ä¾‹åï¼Œä¸‹ä¸€æ­¥æ˜¯æ³¨å†Œä¾¦å¬å™¨ä»¥æ¥æ”¶ WebSocket äº‹ä»¶ï¼š\n// Register a listener to receive WebSocket events. ws.addListener(new WebSocketAdapter() { @Override public void onTextMessage(WebSocket websocket, String message) throws Exception { // Received a text message. ...... } }); æœ€åï¼Œè¿™æ˜¯è¿æ¥åˆ°æœåŠ¡å™¨å¹¶ç›‘è§†è¿æ¥äº‹ä»¶çš„æ–¹å¼ï¼š\ntry { // Connect to the server and perform an opening handshake. // This method blocks until the opening handshake is finished. ws.connect(); } catch (OpeningHandshakeException e) { // A violation against the WebSocket protocol was detected // during the opening handshake. } catch (HostnameUnverifiedException e) { // The certificate of the peer does not match the expected hostname. } catch (WebSocketException e) { // Failed to establish a WebSocket connection. } ç„¶è€Œï¼Œè™½ç„¶åƒ nv-websocket-client è¿™æ ·çš„åº“ç¡®å®æä¾›äº†ä¸€äº›å¥½å¤„ï¼Œä½†å®ƒä»¬æœ¬è´¨ä¸Šåªæ˜¯ WebSocket å®¢æˆ·ç«¯çš„åŒ…è£…å™¨ï¼›å®ƒä»¬ä¸æä¾›ä»»ä½•åŠŸèƒ½ã€‚\nä¸ºäº†å……åˆ†åˆ©ç”¨ WebSocketï¼Œé€šå¸¸ä¼šä½¿ç”¨æ„å»ºåœ¨ WebSocket ä¹‹ä¸Šçš„åè®®ï¼Œè¯¥åè®®å¯å®ç°æ›´ä¸°å¯Œçš„åŠŸèƒ½ï¼Œä¾‹å¦‚ pub/subã€‚æ‚¨å¯ä»¥é€‰æ‹©å¼€å‘è‡ªå·±çš„åŸºäº WebSocket çš„åè®®ï¼Œä¸“é—¨æ ¹æ®æ‚¨çš„éœ€æ±‚å®šåˆ¶ã€‚ç„¶è€Œï¼Œè¿™æ˜¯ä¸€é¡¹éå¸¸å¤æ‚ä¸”è€—æ—¶çš„å·¥ä½œã€‚å¤§å¤šæ•°æ—¶å€™ï¼Œæ‚¨æœ€å¥½ä½¿ç”¨å·²å»ºç«‹çš„åŸºäº WebSocket çš„è§£å†³æ–¹æ¡ˆï¼Œè¯¥è§£å†³æ–¹æ¡ˆå·²åšå¥½å¤„ç†æ•´å¥—å·¥ç¨‹å¤æ‚æ€§çš„å‡†å¤‡ã€‚\nåœ¨Ablyï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªåœ¨ WebSocket ä¹‹ä¸Šä½¿ç”¨çš„ pub/sub åè®®ã€‚å®ƒå…è®¸æ‚¨ä½¿ç”¨ä¸€ç»„æ›´é«˜çº§åˆ«çš„åŠŸèƒ½é€šè¿‡ WebSocket è¿›è¡Œé€šä¿¡ã€‚ä¸ºäº†è¯æ˜å®ƒæ˜¯å¤šä¹ˆç®€å•ï¼Œä¸‹é¢æ˜¯å¦‚ä½•å°†æ•°æ®å‘å¸ƒåˆ° Ably çš„ç¤ºä¾‹ï¼š\nAblyRealtime ably = new AblyRealtime(\u0026#34;ABLY_API_KEY\u0026#34;); Channel channel = ably.channels.get(\u0026#34;test\u0026#34;); /* Publish a message to the test channel */ channel.publish(\u0026#34;greeting\u0026#34;, \u0026#34;hello\u0026#34;); ä»¥ä¸‹æ˜¯å®¢æˆ·ç«¯è¿æ¥åˆ° Ably æ¥ä½¿ç”¨æ•°æ®çš„æ–¹å¼ï¼š\nAblyRealtime ably = new AblyRealtime(\u0026#34;ABLY_API_KEY\u0026#34;); Channel channel = ably.channels.get(\u0026#34;test\u0026#34;); /* Subscribe to messages on channel */ MessageListener listener; listener = new MessageListener() { @Override public void onMessage(Message message) { System.out.print(message.data); }}; }; channel.subscribe(\u0026#34;greeting\u0026#34;, listener); ä»ä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸­å¯ä»¥çœ‹å‡ºï¼Œè™½ç„¶é€šä¿¡æ˜¯é€šè¿‡ WebSocket å®Œæˆçš„ï¼Œä½†åº•å±‚çš„ WebSocket åè®®å¯¹å¼€å‘äººå‘˜æ¥è¯´æ˜¯â€œéšè—â€çš„ã€‚\næ‚¨å¯ä»¥å†³å®šä½¿ç”¨ä»»ä½•æ”¯æŒ Java çš„åŸºäº WebSocket çš„åè®®ã€‚ä¸è¿‡ï¼Œæ— è®ºæ‚¨å¦‚ä½•é€‰æ‹©ï¼Œæ‚¨éƒ½éœ€è¦è€ƒè™‘åœ¨ WebSocket æ–¹é¢å°†é¢ä¸´çš„æ‰€æœ‰æŒ‘æˆ˜ã€‚\nWebSockets å’Œ Javaï¼šæ‚¨éœ€è¦è€ƒè™‘çš„äº‹é¡¹ åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘å¿…é¡»å¼ºè°ƒï¼Œæœ¬æ–‡ä»…å…³æ³¨ä¸ºJava åº”ç”¨ç¨‹åºæ„å»ºå¯é çš„åŸºäº WebSocket çš„è§£å†³æ–¹æ¡ˆæ‰€é¢ä¸´çš„å®¢æˆ·ç«¯æŒ‘æˆ˜ã€‚æˆ‘å‡è®¾æ‚¨å·²ç»å†³å®šè¦åœ¨æœåŠ¡å™¨ç«¯ä½¿ç”¨ä»€ä¹ˆè§£å†³æ–¹æ¡ˆã€‚å¦‚æœè¿˜æ²¡æœ‰ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Socket.IOç­‰å¼€æºåº“ï¼Œæˆ– Ably ç­‰åŸºäºäº‘çš„è§£å†³æ–¹æ¡ˆã€‚\nè¿˜å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæˆ‘å†™è¿™ç¯‡æ–‡ç« çš„åŸºç¡€æ˜¯ Ably å›¢é˜Ÿæ‰€æ‹¥æœ‰çš„å…³äºé€šè¿‡ WebSocket è¿›è¡Œå®æ—¶é€šä¿¡çš„æŒ‘æˆ˜çš„å¹¿æ³›é›†ä½“çŸ¥è¯†ã€‚\næˆ‘ç°åœ¨å°†æ·±å…¥æ¢è®¨æ‚¨éœ€è¦è€ƒè™‘çš„å…³é”®é—®é¢˜ï¼Œä¾‹å¦‚èº«ä»½éªŒè¯ã€ç½‘ç»œå…¼å®¹æ€§æˆ–å¤„ç†è¿ç»­æ€§é‡æ–°è¿æ¥ã€‚å¦‚æœæ‚¨è¦æ„å»ºä¸€ä¸ªå¯é çš„ç³»ç»Ÿï¼Œæ‚¨çš„å®¢æˆ·ç«¯ WebSocket å®ç°å¿…é¡»èƒ½å¤Ÿæœ‰æ•ˆåœ°å¤„ç†æ‰€æœ‰è¿™äº›å¤æ‚æ€§ã€‚\næ‚¨çœŸçš„éœ€è¦ WebSocket å—ï¼Ÿ WebSocket æ˜¯æœ€æµè¡Œå’Œå¯ç§»æ¤çš„å®æ—¶åè®®ã€‚å®ƒé€šè¿‡å•ä¸ª TCP è¿æ¥æä¾›å…¨åŒå·¥é€šä¿¡ã€‚ WebSocket å¯¹äºè®¸å¤šç”¨ä¾‹æ¥è¯´éƒ½æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œä¾‹å¦‚é‡‘èè¡Œæƒ…ã€èŠå¤©è§£å†³æ–¹æ¡ˆæˆ–åŸºäºä½ç½®çš„åº”ç”¨ç¨‹åºç­‰ç­‰ã€‚ä½†è¿™å¹¶ä¸æ˜¯å”¯ä¸€å¯ç”¨çš„é€‰æ‹©ã€‚åœ¨åŠ å…¥ WebSocket æ½®æµä¹‹å‰ï¼Œæ‚¨åº”è¯¥æŸ¥çœ‹ç°æœ‰çš„æ›¿ä»£æ–¹æ¡ˆï¼Œä»¥ç¡®ä¿å®ƒä»¬ä¸æ˜¯æ›´é€‚åˆæ‚¨çš„ç”¨ä¾‹ã€‚\nä¾‹å¦‚ï¼Œè¿˜æ”¯æŒåŒå‘é€šä¿¡çš„MQTTæ˜¯ç”µæ± å¯¿å‘½æœ‰é™çš„ç‰©è”ç½‘è®¾å¤‡ä»¥åŠå¸¦å®½æ˜‚è´µæˆ–ä½ã€ç¨³å®šæ€§ä¸å¯é¢„æµ‹æˆ–å»¶è¿Ÿé«˜çš„ç½‘ç»œçš„é¦–é€‰åè®®ã€‚å¦ä¸€ä¸ªä¾‹å­æ˜¯SSEï¼Œä»å®ç°å’Œä½¿ç”¨çš„è§’åº¦æ¥çœ‹ï¼Œè¿™æ˜¯ä¸€ç§è½»é‡çº§åè®®ã€‚å¯¹äºå¤§å¤šæ•°å•å‘é€šä¿¡å°±è¶³å¤Ÿçš„åŸºäºæµè§ˆå™¨çš„åœºæ™¯ï¼ˆä¾‹å¦‚ç”¨æˆ·è®¢é˜…åŸºæœ¬æ–°é—»æºï¼‰æ¥è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆã€‚\nWebSocketã€MQTT å’Œ SSE éƒ½æ˜¯åŸºäº TCP çš„åè®®ã€‚ TCP è¢«è®¾è®¡ä¸ºå¯é çš„ä¼ è¾“å±‚åè®®ï¼Œæä¾›æ¶ˆæ¯ä¼ é€’å’Œæ’åºä¿è¯ã€‚è¿™å¯¹äºè®¸å¤šå®æ—¶ç”¨ä¾‹æ¥è¯´éå¸¸æœ‰ç”¨ã€‚ä½†å¯¹äºå…¶ä»–ç”¨ä¾‹ï¼Œè½»é‡çº§ã€æ›´å¿«çš„åè®®æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„ç›®çš„æ˜¯ä¼ è¾“è§†é¢‘æ•°æ®ï¼Œé‚£ä¹ˆæœ€å¥½ä½¿ç”¨ UDP ä½œä¸ºä¼ è¾“å±‚åè®®ã€‚\nå³ä½¿ WebSocket æ˜¯æ»¡è¶³æ‚¨éœ€æ±‚çš„ä¸é”™é€‰æ‹©ï¼Œä½†æ ¹æ®æ¶æ„çš„å¤æ‚æ€§ä»¥åŠæ‚¨æƒ³è¦é€šè¿‡ç³»ç»Ÿå®ç°çš„ç›®æ ‡ï¼Œæ‚¨å¯èƒ½å¸Œæœ›èƒ½å¤Ÿçµæ´»åœ°ä½¿ç”¨å¤šä¸ªåè®®ï¼Œæ¯ä¸ªåè®®å¯¹åº”ä¸€ä¸ªç‰¹å®šçš„ç”¨ä¾‹ã€‚\néªŒè¯ ä¸€èˆ¬æ¥è¯´ï¼Œæœ€å¥½åªå…è®¸ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ä½¿ç”¨ WebSocket è¿æ¥ã€‚ä½†æ˜¯ï¼ŒåŸå§‹ WebSocket è¯·æ±‚æ²¡æœ‰æ ‡å¤´ï¼Œå› æ­¤æ‚¨æ— æ³•åƒä½¿ç”¨ HTTP è¯·æ±‚é‚£æ ·æä¾›èº«ä»½éªŒè¯ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ‚¨éœ€è¦ä½¿ç”¨å…¶ä»–ç»„ä»¶æˆ–æœåŠ¡è¿›è¡Œèº«ä»½éªŒè¯ã€‚\nå®¢æˆ·ç«¯ WebSocket åº“å¯èƒ½æ˜¯ä¸€ç§é€‰æ‹©ï¼Œä½†åœ¨é€‰æ‹©æ—¶è¦å°å¿ƒï¼Œå› ä¸ºå¹¶éæ‰€æœ‰åº“éƒ½æä¾›èº«ä»½éªŒè¯æœºåˆ¶ï¼ˆæˆ–è€…å³ä½¿æä¾›ï¼Œä¹Ÿå¯èƒ½éå¸¸æœ‰é™ï¼‰ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥æ„å»ºè‡ªå·±çš„èº«ä»½éªŒè¯æœåŠ¡ã€‚ä¸è¿‡ï¼Œå¤§å¤šæ•°æ—¶å€™ï¼Œæ‚¨æœ€å¥½ä½¿ç”¨æˆç†Ÿçš„ã€åŠŸèƒ½ä¸°å¯Œçš„è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚å®æ—¶æ¶ˆæ¯ä¼ é€’å¹³å°ï¼Œå®ƒä¸ä»…å¯ä»¥å¤„ç†èº«ä»½éªŒè¯ï¼Œè¿˜å¯ä»¥å¤„ç†ä¸é€šè¿‡ WebSocket ä¼ è¾“æ•°æ®æµç›¸å…³çš„ä¸€æ•´å¥—å·¥ç¨‹å¤æ‚æ€§ã€‚\nç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹å¯ä»¥é€šè¿‡ WebSocket ä½¿ç”¨çš„æœ€å¸¸è§çš„èº«ä»½éªŒè¯æœºåˆ¶ã€‚ç¬¬ä¸€ä¸ªæ˜¯åŸºæœ¬èº«ä»½éªŒè¯ï¼Œæ˜¯æœ€ç®€å•çš„å¯ç”¨é€‰é¡¹ï¼ˆä¹Ÿæ˜¯æœ€ä¸å®‰å…¨çš„é€‰é¡¹ï¼‰ï¼Œå®ƒæ¶‰åŠ API å¯†é’¥çš„ä½¿ç”¨ã€‚å‡­æ®é€šå¸¸ä½œä¸º URL ä¸­çš„æŸ¥è¯¢å‚æ•°ä¼ é€’ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nwss://realtime.ably.com/?key=MY_API_KEY\u0026amp;format=json\u0026amp;heartbeats=true\u0026amp;v=1.1\u0026amp;lib=js-web-1.2.1 ä»å®‰å…¨è§’åº¦æ¥çœ‹ï¼Œå»ºè®®ä»…ä½¿ç”¨æœåŠ¡å™¨ç«¯çš„åŸºæœ¬èº«ä»½éªŒè¯ï¼Œå› ä¸ºå°† API å¯†é’¥æš´éœ²ç»™å¤šä¸ªå®¢æˆ·ç«¯æ˜¯éå¸¸ä¸å®‰å…¨çš„ã€‚ç†è®ºä¸Šï¼Œå¦‚æœæ‚¨åœ¨å®¢æˆ·ç«¯ä½¿ç”¨åœ¨ç»™å®šæ—¶é—´åè¿‡æœŸçš„ä¸´æ—¶ API å¯†é’¥ï¼Œåˆ™å¯ä»¥å°†å®ƒä»¬è¢«æ³„éœ²çš„é£é™©é™è‡³æœ€ä½ã€‚ç„¶è€Œï¼Œå®é™…ä¸Šï¼Œä¸€æ—¦å¯†é’¥è¿‡æœŸï¼ŒåŒ…å«ä¸´æ—¶ API å¯†é’¥çš„ URL å°±ä¼šè¢«ç ´åã€‚æ­¤å¤–ï¼Œè¯·æ±‚æ—¥å¿—è®°å½•æœåŠ¡å°†æ•è·æœåŠ¡å™¨æ—¥å¿—ä¸­çš„ API å¯†é’¥ã€‚å› æ­¤ï¼Œæ¯æ¬¡åˆ·æ–° API å¯†é’¥æ—¶ï¼Œæ‚¨éƒ½å¿…é¡»æ‰“å¼€ä¸€ä¸ªæ–°çš„ WebSocket è¿æ¥ã€‚è¿™ä¸æ˜¯ä¸€ç§å¯æ‰©å±•çš„æ–¹æ³•ã€‚\nåŸºäºä»¤ç‰Œçš„èº«ä»½éªŒè¯æ˜¯å¦ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„èº«ä»½éªŒè¯æœºåˆ¶ã€‚æœ€æµè¡Œçš„åŸºäºä»¤ç‰Œçš„èº«ä»½éªŒè¯æ–¹æ³•ä¹‹ä¸€ç§°ä¸ºJSON Web ä»¤ç‰Œ(JWT)ã€‚å®ƒæ˜¯ä¸€ç§å¼€æ”¾ä¸”çµæ´»çš„æ ¼å¼ï¼Œå·²æˆä¸ºè¡Œä¸šæ ‡å‡†ã€‚åœ¨åŸºæœ¬å±‚é¢ä¸Šï¼ŒJWT çš„å·¥ä½œåŸç†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nå®¢æˆ·ç«¯å‘æˆæƒæœåŠ¡å™¨å‘é€æˆæƒè¯·æ±‚ã€‚ æˆæƒæœåŠ¡å™¨å‘å®¢æˆ·ç«¯è¿”å›è®¿é—®ä»¤ç‰Œã€‚ å®¢æˆ·ç«¯ä½¿ç”¨è®¿é—®ä»¤ç‰Œè®¿é—®å—ä¿æŠ¤çš„èµ„æºã€‚ JWT æ˜¯æ¨èçš„å®¢æˆ·ç«¯ç­–ç•¥ï¼Œå› ä¸ºå®ƒæä¾›æ¯”åŸºæœ¬èº«ä»½éªŒè¯æ›´ç»†ç²’åº¦çš„è®¿é—®æ§åˆ¶ï¼Œå¹¶é™åˆ¶å‡­æ®æš´éœ²æˆ–æ³„éœ²çš„é£é™©ã€‚æ­¤å¤–ï¼Œé™¤äº† JWT åœ¨è®¾è®¡ä¸Šæ˜¯çŸ­æš‚çš„ä¹‹å¤–ï¼Œå®ƒä»¬è¿˜å¯ä»¥è¢«æ’¤é”€ã€‚\nè™½ç„¶ JWT æ˜¾ç„¶æ¯”åŸºæœ¬èº«ä»½éªŒè¯æ›´å¯é ã€æ›´å®‰å…¨ï¼Œä½†å¦‚æœæ‚¨å†³å®šå¼€å‘è‡ªå·±çš„åŸºäº JWT çš„èº«ä»½éªŒè¯è§£å†³æ–¹æ¡ˆï¼Œåˆ™å®ƒä»¬ä¼šå¸¦æ¥ä¸€äº›å·¥ç¨‹æŒ‘æˆ˜ï¼Œæ‚¨å¿…é¡»åº”å¯¹è¿™äº›æŒ‘æˆ˜ï¼š\næ‚¨å¦‚ä½•å¤„ç†ä»¤ç‰Œç‰¹æƒå’Œæƒé™ï¼Ÿ å¦‚ä½•è®¾ç½®TTLï¼ˆç”Ÿå­˜æ—¶é—´ï¼‰ï¼Ÿ å¦‚ä½•æ›´æ–°ä»¤ç‰Œï¼Ÿ ä»£å¸å¦‚ä½•å‘é€ï¼Ÿå¦‚æœæ˜¯é€šè¿‡ URLï¼Œæ‚¨éœ€è¦ä¸€ç§æœºåˆ¶ï¼Œå…è®¸æ‚¨åœ¨ä»¤ç‰Œè¿‡æœŸæ—¶æ›´æ–°ä»¤ç‰Œï¼Œè€Œæ— éœ€å¯åŠ¨æ–°çš„ WebSocket è¿æ¥ã€‚ ç½‘ç»œå…¼å®¹æ€§å’Œåå¤‡ä¼ è¾“ å°½ç®¡æœ‰å¹¿æ³›çš„å¹³å°æ”¯æŒï¼Œä½† WebSocket ä»é¢ä¸´ä¸€äº›ç½‘ç»œé—®é¢˜ã€‚ä¸»è¦çš„å°±æ˜¯ä»£ç†éå†ã€‚ä¾‹å¦‚ï¼ŒæŸäº›æœåŠ¡å™¨å’Œå…¬å¸é˜²ç«å¢™ä¼šé˜»æ­¢ WebSocket è¿æ¥ã€‚\nç«¯å£ 80 å’Œ 443 æ˜¯ Web è®¿é—®çš„æ ‡å‡†ç«¯å£ï¼Œå®ƒä»¬æ”¯æŒ WebSocketã€‚è¯·æ³¨æ„ï¼Œç«¯å£ 80 ç”¨äºä¸å®‰å…¨çš„è¿æ¥ã€‚è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œå»ºè®®å°½å¯èƒ½ä½¿ç”¨ WebSocket ç«¯å£ 443ï¼Œå› ä¸ºå®ƒæ˜¯å®‰å…¨çš„ï¼Œå¹¶ä¸”å¯ä»¥é˜²æ­¢ä»£ç†æ£€æŸ¥è¿æ¥ã€‚å¦‚æœæ‚¨å¿…é¡»ï¼ˆæˆ–å¸Œæœ›ï¼‰åœ¨ä¸åŒç«¯å£ä¸Šè¿è¡Œ WebSocketï¼Œé€šå¸¸éœ€è¦è¿›è¡Œç½‘ç»œé…ç½®ã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ‚¨æ— æ³•ä½¿ç”¨ç«¯å£ 443ï¼Œå¹¶ä¸”æ‚¨é¢„è§å®¢æˆ·ç«¯ä¼šä»å…¬å¸é˜²ç«å¢™å†…éƒ¨æˆ–å…¶ä»–æ£˜æ‰‹çš„æ¥æºè¿›è¡Œè¿æ¥ï¼Œåˆ™æ‚¨å¯èƒ½éœ€è¦æ”¯æŒåå¤‡ä¼ è¾“ï¼Œä¾‹å¦‚ XHR æµã€XHR è½®è¯¢æˆ– JSONP è½®è¯¢ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ‚¨éœ€è¦ä½¿ç”¨æ”¯æŒå›é€€çš„åŸºäº WebSocket çš„å®¢æˆ·ç«¯è§£å†³æ–¹æ¡ˆã€‚è¯¥è§£å†³æ–¹æ¡ˆå¯ä»¥é‡‡å–å¤šç§å½¢å¼ï¼›æ‚¨å¯ä»¥é€‰æ‹©ä¸“é—¨è®¾è®¡ç”¨äºæä¾›å¤§é‡åå¤‡åŠŸèƒ½çš„å¼€æºåº“ï¼Œä¾‹å¦‚SockJSã€‚\næˆ–è€…ï¼Œæ‚¨å¯ä»¥æ„å»ºè‡ªå·±çš„å¤æ‚åå¤‡åŠŸèƒ½ï¼Œä½†å®é™…ä¸Šå¿…é¡»è¿™æ ·åšçš„åœºæ™¯éå¸¸ç½•è§ã€‚å¼€å‘å®šåˆ¶è§£å†³æ–¹æ¡ˆæ˜¯ä¸€ä¸ªå¤æ‚çš„è¿‡ç¨‹ï¼Œéœ€è¦èŠ±è´¹å¤§é‡çš„æ—¶é—´å’Œç²¾åŠ›ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸ºäº†å°†å·¥ç¨‹å¤æ‚æ€§é™è‡³æœ€ä½ï¼Œæ‚¨æœ€å¥½ä½¿ç”¨æä¾›åå¤‡é€‰é¡¹çš„ç°æœ‰åŸºäº WebSocket çš„è§£å†³æ–¹æ¡ˆã€‚\nè®¾å¤‡ç”µæºç®¡ç†å’Œå¿ƒè·³ å°±å…¶æœ¬è´¨è€Œè¨€ï¼ŒWebSocket è¿æ¥æ˜¯æŒä¹…çš„ã€‚è¿™ä¹Ÿæ„å‘³ç€åªè¦å®ƒå¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œå°±ä¼šæ¶ˆè€—ç”µæ± å¯¿å‘½ã€‚éšç€ WebSocket è·å¾—å„ç§å¼€å‘å¹³å°å’Œç¼–ç¨‹è¯­è¨€ï¼ˆåŒ…æ‹¬ Javaï¼‰çš„æ”¯æŒï¼Œè®¾å¤‡ç”µæºç®¡ç†æˆä¸ºå¿…é¡»è€ƒè™‘çš„é—®é¢˜ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè®¸å¤š Java WebSocket åº“éƒ½æ²¡æœ‰å¤„ç†å®ƒã€‚\næœ‰å¤šç§æ–¹æ³•å¯ä»¥å®ç°ç”µæ± ç®¡ç†å’Œå¿ƒè·³ã€‚ WebSocket åè®®æœ¬èº«æ”¯æŒç§°ä¸º Ping å’Œ Pong çš„æ§åˆ¶å¸§ã€‚è¿™æ˜¯ä¸€ç§åº”ç”¨ç¨‹åºçº§åˆ«çš„å¿ƒè·³æœºåˆ¶ï¼Œå¯è®©æ‚¨æ£€æµ‹ WebSocket è¿æ¥æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚é€šå¸¸ï¼ŒæœåŠ¡å™¨ç«¯å‘é€ Ping å¸§ï¼Œå®¢æˆ·ç«¯æ”¶åˆ°åå°† Pong å¸§å‘é€å›æœåŠ¡å™¨ã€‚\nç†è®ºä¸Šï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨åè®®çº§å¿ƒè·³ - TCP keepaliveã€‚ç„¶è€Œï¼Œè¿™æ˜¯ä¸€ä¸ªä¸å¤ªç†æƒ³çš„é€‰æ‹©ï¼Œå› ä¸º TCP keepalive ä¸ä¼šé€šè¿‡ç½‘ç»œä»£ç†ã€‚æ¢å¥è¯è¯´ï¼Œä½¿ç”¨ TCP keepaliveï¼Œæ‚¨æ— æ³•å§‹ç»ˆéªŒè¯ç«¯åˆ°ç«¯è¿æ¥ã€‚\nè¯·æ³¨æ„ï¼Œæ‚¨å‘é€çš„å¿ƒè·³è¶Šå¤šï¼Œç”µæ± è€—å°½çš„é€Ÿåº¦å°±è¶Šå¿«ã€‚è¿™å¯èƒ½ä¼šå¸¦æ¥å¾ˆå¤§çš„é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨æ¶‰åŠç§»åŠ¨è®¾å¤‡æ—¶ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œä¸ºäº†å»¶é•¿ç”µæ± å¯¿å‘½ï¼Œæ‚¨å¯èƒ½å¸Œæœ›å°½å¯èƒ½ä½¿ç”¨æ“ä½œç³»ç»Ÿæœ¬æœºæ¨é€é€šçŸ¥ã€‚ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæ— éœ€ä¿æŒ WebSocket è¿æ¥å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œå› ä¸ºåªè¦æ‚¨å‘é€æ¨é€é€šçŸ¥ï¼ŒæœåŠ¡å™¨å°±å¯ä»¥å”¤é†’åº”ç”¨ç¨‹åºçš„éæ´»åŠ¨å®ä¾‹ã€‚\nè™½ç„¶æ¨é€é€šçŸ¥æ˜¯å”¤é†’åº”ç”¨ç¨‹åºçš„ç»ä½³é€‰æ‹©ï¼Œä½†å®ƒä»¬å¹¶ä¸èƒ½æ›¿ä»£ WebSocket æˆ–æµåè®®å±‚ï¼Œå› ä¸ºå®ƒä»¬ä¸æä¾›æœåŠ¡è´¨é‡ä¿è¯ã€‚æ¨é€é€šçŸ¥é€šå¸¸æ˜¯çŸ­æš‚çš„ï¼Œå…·æœ‰å¯å˜çš„å»¶è¿Ÿï¼Œå¹¶ä¸”æ²¡æœ‰é¡ºåºã€‚æ­¤å¤–ï¼Œåœ¨ä»»ä½•ç»™å®šæ—¶åˆ»ï¼Œé€šå¸¸å¯ä»¥æ’é˜Ÿç­‰å¾…ä¼ é€çš„æ¨é€é€šçŸ¥æ•°é‡æœ‰é™ã€‚\nåœ¨å†³å®šæ˜¯å¦ä½¿ç”¨å¿ƒè·³ã€æ¨é€é€šçŸ¥æˆ–åŒæ—¶ä½¿ç”¨ä¸¤è€…ä¹‹å‰ï¼Œæ‚¨å¿…é¡»ä»”ç»†åˆ†ææ‚¨çš„ç³»ç»Ÿè¦æ±‚å’Œç”¨ä¾‹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æ­£åœ¨å¼€å‘èŠå¤©è§£å†³æ–¹æ¡ˆæˆ–å¤šäººæ¸¸æˆï¼Œæ‚¨å¸Œæœ›é¢‘ç¹å‘é€å¿ƒè·³ï¼Œå³ä½¿è¿™æ„å‘³ç€ç”µæ± å¯¿å‘½ä¼šæ›´å¿«è€—å°½ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæ‚¨æ­£åœ¨å¼€å‘åœ¨çº¿å•†åº—å¹¶ä¸”å¸Œæœ›å¶å°”é€šçŸ¥å®¢æˆ·æœ‰å…³æ–°äº§å“çš„ä¿¡æ¯ï¼Œæ‚¨å¯èƒ½éœ€è¦ä½¿ç”¨æ¨é€é€šçŸ¥æ¥å®ç°æ­¤ç‰¹å®šç›®çš„ã€‚æ¨é€é€šçŸ¥å°†æ›´å¥½åœ°å»¶é•¿ç”µæ± å¯¿å‘½ï¼Œå³ä½¿è¿™æ„å‘³ç€æ‚¨çš„è¿æ¥çŠ¶æ€æ£€æµ‹ä¸ä¼šé‚£ä¹ˆå‡†ç¡®ã€‚\nè¿ç»­æ€§åœ°å¤„ç†é‡æ–°è¿æ¥ è®¾å¤‡ç»å¸¸ç»å†ä¸æ–­å˜åŒ–çš„ç½‘ç»œçŠ¶å†µã€‚è®¾å¤‡å¯èƒ½ä¼šä»ç§»åŠ¨æ•°æ®ç½‘ç»œåˆ‡æ¢åˆ° Wi-Fi ç½‘ç»œã€ç©¿è¿‡éš§é“ï¼Œæˆ–è€…å¯èƒ½ä¼šé‡åˆ°é—´æ­‡æ€§ç½‘ç»œé—®é¢˜ã€‚åƒè¿™æ ·çš„çªç„¶æ–­å¼€è¿æ¥åœºæ™¯éœ€è¦é‡æ–°å»ºç«‹ WebSocket è¿æ¥ã€‚\nå¯¹äºæŸäº›å®æ—¶ç”¨ä¾‹ï¼Œåœ¨ä¸­æ–­åå‡†ç¡®åœ°ä»ä¸­æ–­ä½ç½®æ¢å¤æµè‡³å…³é‡è¦ã€‚æƒ³æƒ³å®æ—¶èŠå¤©ç­‰åŠŸèƒ½ï¼Œåœ¨æ–­å¼€è¿æ¥æœŸé—´ä¸¢å¤±æ¶ˆæ¯ä¼šå¯¼è‡´æ··ä¹±å’Œæ²®ä¸§ã€‚æ‚¨éœ€è¦ç¡®ä¿æ‚¨çš„å®¢æˆ·ç«¯ WebSocket å®ç°èƒ½å¤Ÿå¤„ç†é‡æ–°è¿æ¥çš„å¤æ‚æ€§ã€‚å®ç°è¿˜åº”è¯¥æä¾›æ¢å¤æµçš„æ–¹æ³•å¹¶æä¾›ä¸€æ¬¡æ€§ä¼ é€ä¿è¯ã€‚\nå¦‚æœåœ¨çŸ­æš‚æ–­å¼€è¿æ¥åå‡†ç¡®åœ°æ¢å¤æµå¯¹äºæ‚¨çš„ç”¨ä¾‹å¾ˆé‡è¦ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦å®ç°å†å²/æŒä¹…æ•°æ®ã€‚è¯¦ç»†ä»‹ç»è¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ï¼ˆæœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æ­¤åšå®¢æ–‡ç« ï¼‰ï¼Œä½†æ‚¨éœ€è¦è€ƒè™‘ä»¥ä¸‹ä¸€äº›äº‹é¡¹ï¼š\n**åœ¨å‰ç«¯å†…å­˜ä¸­ç¼“å­˜æ¶ˆæ¯ã€‚**æ‚¨å­˜å‚¨äº†å¤šå°‘æ¡æ¶ˆæ¯ä»¥åŠå­˜å‚¨å¤šé•¿æ—¶é—´ï¼Ÿ **å°†æ•°æ®ç§»è‡³æŒä¹…å­˜å‚¨ã€‚**æ‚¨éœ€è¦å°†æ•°æ®ç§»åŠ¨åˆ°ç£ç›˜å—ï¼Ÿå¦‚æœæ˜¯è¿™æ ·ï¼Œæ‚¨ä¼šä¿å­˜å¤šé•¿æ—¶é—´ï¼Ÿä½ æŠŠå®ƒå­˜æ”¾åœ¨å“ªé‡Œï¼Ÿå®¢æˆ·ç«¯é‡æ–°è¿æ¥åå°†å¦‚ä½•è®¿é—®è¿™äº›æ•°æ®ï¼Ÿ **æ¢å¤æµã€‚**å½“å®¢æˆ·ç«¯é‡æ–°è¿æ¥æ—¶ï¼Œæ‚¨å¦‚ä½•çŸ¥é“è¦æ¢å¤å“ªä¸ªæµä»¥åŠç¡®åˆ‡åœ°ä»å“ªé‡Œæ¢å¤å®ƒï¼Ÿæ‚¨æ˜¯å¦éœ€è¦ä½¿ç”¨è¿æ¥ ID æ¥ç¡®å®šè¿æ¥ä¸­æ–­çš„ä½ç½®ï¼Ÿè°éœ€è¦è·Ÿè¸ªæ–­å¼€çš„è¿æ¥ - å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡å™¨ï¼Ÿ é€€é¿æœºåˆ¶ã€‚æ‚¨çš„å¢é‡é€€é¿ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿåœ¨æœ‰å¤§é‡å®¢æˆ·ç«¯ä¸æ–­å°è¯•ï¼ˆä½†å¤±è´¥ï¼‰é‡æ–°å»ºç«‹è¿æ¥çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•é˜²æ­¢æœåŠ¡å™¨è¿‡è½½ï¼Ÿ æ‚¨ç”šè‡³å¯èƒ½ä¼šè€ƒè™‘ WebSockets æ˜¯å¦æ˜¯æ‚¨çœŸæ­£éœ€è¦çš„ã€‚å¦‚æœæ‚¨çš„ç”¨ä¾‹ä¸éœ€è¦åŒå‘æ¶ˆæ¯ä¼ é€’ï¼Œè€Œæ˜¯ä»…è®¢é˜…ï¼Œé‚£ä¹ˆåƒSSEè¿™æ ·å¸¦æœ‰æµæ¢å¤åŠŸèƒ½çš„åè®®å¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚\næœ€åçš„æƒ³æ³• å¸Œæœ›æœ¬æ–‡èƒ½å¤Ÿå‘æ‚¨å±•ç¤ºï¼Œå¦‚æœæ‚¨å¸Œæœ›åœ¨ Java ä¸­å®ç°å¯é çš„ WebSocket å®¢æˆ·ç«¯ï¼Œæ‚¨å°†é¢ä¸´è®¸å¤šæŒ‘æˆ˜ã€‚å³ä½¿å¯¹äºåŸºæœ¬ç”¨ä¾‹ï¼ŒåŸå§‹ WebSocket ä¹Ÿè¿œè¿œä¸å¤Ÿã€‚å¦‚æœæ‚¨æƒ³å¯é åœ°æ‰©å±•ç³»ç»Ÿå¹¶ä¸ºæœ€ç»ˆç”¨æˆ·æä¾›æœ€ä½³ä½“éªŒï¼Œæ‚¨å¾ˆå¯èƒ½å¿…é¡»ä½¿ç”¨åŠŸèƒ½ä¸°å¯Œçš„ WebSocket è§£å†³æ–¹æ¡ˆã€‚\nåœ¨ Ablyï¼Œæˆ‘ä»¬ä¸»è¦ä½¿ç”¨æˆ‘ä»¬è‡ªå·±çš„åŸºäº WebSocket çš„åè®®æ¥å®æ—¶æä¾›åŒæ­¥æ•°å­—ä½“éªŒï¼Œè¯¥åè®®åœ¨æ€§èƒ½ã€å¯ç§»æ¤æ€§å’Œå¯é æ€§ä¹‹é—´æä¾›äº†é€‚å½“çš„å¹³è¡¡ã€‚æˆ‘ä»¬çš„å…¨çƒåˆ†å¸ƒå¼ä¸”å®Œå…¨æ‰˜ç®¡çš„å¹³å°å¯ä»¥è½»æ¾æœ‰æ•ˆåœ°è®¾è®¡ã€å¿«é€Ÿäº¤ä»˜å’Œæ— ç¼æ‰©å±•ç›´æ¥äº¤ä»˜ç»™æœ€ç»ˆç”¨æˆ·çš„å…³é”®å®æ—¶åŠŸèƒ½ã€‚\nå¦‚æœæ‚¨å¸Œæœ›ä½¿ç”¨ WebSockets å’Œ Java æ„å»ºå€¼å¾—ä¿¡èµ–çš„ Web åº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆä½¿ç”¨ Ablyï¼Œæ‚¨å¯ä»¥åœ¨å‡ åˆ†é’Ÿå†…å¯åŠ¨å¹¶è¿è¡Œã€‚å°è¯•ä¸€ä¸‹æˆ‘ä»¬çš„ APIã€‚\nè¿›ä¸€æ­¥é˜…è¯»\nå¤šå¹´æ¥ï¼Œæˆ‘ä»¬æ’°å†™äº†å¤§é‡æœ‰å…³å®æ—¶äº‹ä»¶é©±åŠ¨ç³»ç»Ÿå’Œ WebSocket ç­‰ä¸»é¢˜çš„æ–‡ç« ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æœ‰ç”¨çš„èµ„æºä¾›æ‚¨æ¢ç´¢ï¼š\nThe WebSocket Handbook: learn about the technology behind the realtime web WebSockets â€” A Conceptual Deep-Dive Ably blog Ably resources \u0026amp; datasheets Ably\u0026rsquo;s 25+ client library SDKs ","permalink":"https://blog.chensoul.cc/posts/2024/05/07/websockets-java/","summary":"åŸæ–‡ï¼šhttps://ably.com/topic/websockets-java\nåœ¨å…¨çƒèŒƒå›´å†…ï¼Œäººä»¬å¯¹å®æ—¶ä¼ è¾“æ•°æ®çš„éœ€æ±‚ä¸æ–­å¢é•¿ï¼ŒWebSocketå¯èƒ½æ˜¯æ­¤ç±»ç”¨ä¾‹ä¸­æœ€æµè¡Œçš„ä¼ è¾“åè®®ã€‚åœ¨ WebSocket å‡ºç°ä¹‹å‰ï¼Œâ€œå®æ—¶â€ç½‘ç»œå·²ç»å­˜åœ¨ï¼Œä½†å®ƒå¾ˆéš¾å®ç°ï¼Œé€šå¸¸é€Ÿåº¦è¾ƒæ…¢ï¼Œå¹¶ä¸”æ˜¯é€šè¿‡ç ´è§£ç°æœ‰çš„ç½‘ç»œæŠ€æœ¯æ¥å®ç°çš„ï¼Œè€Œè¿™äº›æŠ€æœ¯å¹¶ä¸æ˜¯ä¸ºå®æ—¶åº”ç”¨ç¨‹åºè®¾è®¡çš„ã€‚ WebSocket åè®®ä¸ºçœŸæ­£çš„å®æ—¶ç½‘ç»œé“ºå¹³äº†é“è·¯ã€‚\nJavaæ˜¯ä¸€ç§æµè¡Œçš„ç¼–ç¨‹è¯­è¨€å’Œè®¡ç®—è¯­è¨€ã€‚å®ƒæ˜¯ Android æ™ºèƒ½æ‰‹æœºåº”ç”¨ç¨‹åºçš„æ ¸å¿ƒç¼–ç¨‹è¯­è¨€ä¹‹ä¸€ï¼Œæ˜¯æ„å»ºå®æ—¶ç³»ç»Ÿçš„å¯é é€‰æ‹©ã€‚ WebSockets æˆä¸º Java æ ‡å‡†ç‰ˆ SDK çš„ä¸€éƒ¨åˆ†å·²ç»æœ‰ä¸€æ®µæ—¶é—´äº†ã€‚WebSocket åè®®æœ€åˆæ˜¯åœ¨ 2013 å¹´ä½œä¸ºJSR 356çš„ä¸€éƒ¨åˆ†æå‡ºçš„ï¼Œç›®å‰å·²ä½œä¸ºjavax.websocketåŒ…çš„ä¸€éƒ¨åˆ†åŒ…å«åœ¨ Java SDK ä¸­ã€‚\nç”±äºå¯¹å®æ—¶æ•°æ®çš„éœ€æ±‚æ­£åœ¨ç¨³æ­¥å¢é•¿ï¼Œå¹¶ä¸” Java å·²æˆä¸ºä¸€ç§æˆç†Ÿä¸”å¹¿æ³›ä½¿ç”¨çš„è¯­è¨€/å¹³å°ï¼Œå› æ­¤æˆ‘è®¤ä¸ºå€¼å¾—è€ƒè™‘ä¸ºJava å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå®ç°å¯é çš„ WebSocket è§£å†³æ–¹æ¡ˆæ‰€é¢ä¸´çš„ä¼—å¤šæŒ‘æˆ˜ã€‚\nç°çŠ¶â€”â€”ç®€è¦æ¦‚è¿° åŸºæœ¬æˆ–åŸå§‹çš„ WebSocket å®ç°å¾ˆå°‘èƒ½å¤Ÿæ»¡è¶³ä¸ºæœªçŸ¥ï¼ˆä½†å¯èƒ½éå¸¸å¤šï¼‰æ•°é‡çš„ç”¨æˆ·æä¾›æœåŠ¡çš„å®æ—¶åº”ç”¨ç¨‹åºçš„éœ€æ±‚ã€‚å¤§å¤šæ•°æ—¶å€™ï¼Œæ‚¨éœ€è¦è€ƒè™‘æ‰©å±• Java å®¢æˆ·ç«¯ WebSocket å®ç°çš„åŠŸèƒ½ã€‚\nä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨nv-websocket-clientç­‰å¼€æºåº“ï¼Œå…¶ä¸­åŒ…å«ä¸€äº›é™„åŠ åŠŸèƒ½ï¼Œä¾‹å¦‚ä»£ç†æ”¯æŒã€‚è¿™æ˜¯ä½¿ç”¨ nv-websocket-client åˆ›å»º WebSocket å®ä¾‹çš„æ–¹æ³•ï¼š\n// Create a WebSocket. The scheme part can be one of the following: // \u0026#39;ws\u0026#39;, \u0026#39;wss\u0026#39;, \u0026#39;http\u0026#39; and \u0026#39;https\u0026#39; (case-insensitive). The user info // part, if any, is interpreted as expected. If a raw socket failed // to be created, an IOException is thrown. WebSocket ws = new WebSocketFactory().createSocket(\u0026#34;ws://localhost/endpoint\u0026#34;); åˆ›å»º WebSocket å®ä¾‹åï¼Œä¸‹ä¸€æ­¥æ˜¯æ³¨å†Œä¾¦å¬å™¨ä»¥æ¥æ”¶ WebSocket äº‹ä»¶ï¼š\n// Register a listener to receive WebSocket events.","title":"[è¯‘]Javaå’ŒWebSocketsï¼šæ„å»ºå¯é çš„å®æ—¶åº”ç”¨ç¨‹åº"},{"content":"åŸæ–‡åœ°å€ï¼šhttps://ably.com/topic/websockets\nWebSocket æ ‡å¿—ç€ Web å¼€å‘çš„è½¬æŠ˜ç‚¹ã€‚ WebSocket æŠ€æœ¯æ—¨åœ¨ä»¥äº‹ä»¶ä¸ºé©±åŠ¨ï¼Œå¹¶é’ˆå¯¹ä½å»¶è¿Ÿè¿›è¡Œäº†ä¼˜åŒ–ï¼Œå·²æˆä¸ºè®¸å¤šå¯»æ±‚æ„å»ºäº¤äº’å¼å®æ—¶æ•°å­—ä½“éªŒä»¥æä¾›ä»¤äººæ„‰æ‚¦çš„ç”¨æˆ·ä½“éªŒçš„ç»„ç»‡å’Œå¼€å‘äººå‘˜çš„é¦–é€‰ã€‚æœ¬æ–‡æ¢è®¨äº†ä¸ WebSocket ç›¸å…³çš„å…³é”®ä¸»é¢˜ï¼š\nWebSocket åè®®å’Œ API è§£é‡Š\nWebSockets æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ\nWebSocketsçš„ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ\nWebSockets æ˜¯å¦å¯æ‰©å±•ï¼Ÿ\nWebSocket çš„ç”¨é€”æ˜¯ä»€ä¹ˆï¼Ÿ\nWebSockets çš„æœ€ä½³æ›¿ä»£å“æ˜¯ä»€ä¹ˆï¼Ÿ\nå¦‚ä½•å¼€å§‹ä½¿ç”¨ WebSockets æ„å»ºå®æ—¶ä½“éªŒ\nWebSocket å¸¸è§é—®é¢˜è§£ç­”\nWebSocketï¼šåè®®å’Œ API è§£é‡Š WebSocket æ˜¯ä¸€ç§å®æ—¶æŠ€æœ¯ï¼Œå¯é€šè¿‡æŒä¹…çš„å•å¥—æ¥å­—è¿æ¥åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å®ç°åŒå‘å…¨åŒå·¥é€šä¿¡ã€‚åªè¦éœ€è¦ï¼ŒWebSocket è¿æ¥å°±ä¼šä¿æŒæ´»åŠ¨çŠ¶æ€ï¼ˆç†è®ºä¸Šï¼Œå®ƒå¯ä»¥æ°¸è¿œæŒç»­ä¸‹å»ï¼‰ï¼Œå…è®¸æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éšæ„å‘é€æ•°æ®ï¼Œå¼€é”€æœ€å°ã€‚\nWebSocket æŠ€æœ¯ç”±ä¸¤ä¸ªæ ¸å¿ƒæ„å»ºå—ç»„æˆï¼š\nWebSocket åè®®ã€‚ WebSocket APIã€‚ WebSocketçš„å†å²æ˜¯ä»€ä¹ˆï¼Ÿ ç¬¬ä¸€ä¸ªå®æ—¶ Web åº”ç”¨ç¨‹åºå¼€å§‹å‡ºç°åœ¨ 2000 å¹´ä»£ï¼Œè¯•å›¾æä¾›å“åº”è¿…é€Ÿã€åŠ¨æ€å’Œäº¤äº’å¼çš„æœ€ç»ˆç”¨æˆ·ä½“éªŒã€‚ç„¶è€Œï¼Œåœ¨é‚£ä¸ªæ—¶å€™ï¼Œå®æ—¶ç½‘ç»œå¾ˆéš¾å®ç°ï¼Œè€Œä¸”æ¯”æˆ‘ä»¬ç°åœ¨ä¹ æƒ¯çš„è¦æ…¢;å®ƒæ˜¯é€šè¿‡å…¥ä¾µç°æœ‰çš„åŸºäºHTTPçš„æŠ€æœ¯ï¼ˆAJAXå’ŒCometï¼‰æ¥å®ç°çš„ï¼Œè¿™äº›æŠ€æœ¯ä¸æ˜¯ä¸ºå®æ—¶åº”ç”¨ç¨‹åºè®¾è®¡å’Œä¼˜åŒ–çš„ã€‚å¾ˆæ˜æ˜¾ï¼Œéœ€è¦ä¸€ä¸ªæ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆã€‚\nåœ¨ 2008 å¹´ï¼Œå¼€å‘äººå‘˜ Michael Carter å’Œ Ian Hickson ç‰¹åˆ«æ•é”åœ°æ„Ÿå—åˆ°äº†åœ¨å®ç°ä»»ä½•ç±»ä¼¼å®æ—¶çš„ä¸œè¥¿æ—¶ä½¿ç”¨ AJAX å’Œ Comet çš„ç—›è‹¦å’Œå±€é™æ€§ã€‚é€šè¿‡åœ¨ IRC å’Œ W3C é‚®ä»¶åˆ—è¡¨ä¸Šçš„åˆä½œï¼Œä»–ä»¬æå‡ºäº†ä¸€ä¸ªè®¡åˆ’ï¼Œä¸ºç½‘ç»œä¸Šçš„ç°ä»£ã€çœŸæ­£çš„å®æ—¶é€šä¿¡å¼•å…¥ä¸€ä¸ªæ–°æ ‡å‡†ã€‚å› æ­¤ï¼Œâ€œWebSocketâ€è¿™ä¸ªåå­—è¢«åˆ›é€ å‡ºæ¥ã€‚\nä»€ä¹ˆæ˜¯ WebSocket åè®®ï¼Ÿ WebSocket åè®®æ”¯æŒ Web å®¢æˆ·ç«¯å’Œ Web æœåŠ¡å™¨ä¹‹é—´é€šè¿‡åŸºç¡€ TCP è¿æ¥è¿›è¡ŒæŒç»­çš„å…¨åŒå·¥åŒå‘é€šä¿¡ã€‚è¯¥åè®®æ—¨åœ¨å…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å®æ—¶é€šä¿¡ï¼Œä»è€Œåœ¨ Web åº”ç”¨ç¨‹åºä¸­å®ç°é«˜æ•ˆä¸”å“åº”è¿…é€Ÿçš„æ•°æ®ä¼ è¾“ã€‚\n2011 å¹´ 12 æœˆï¼Œäº’è”ç½‘å·¥ç¨‹ä»»åŠ¡ç»„ ï¼ˆIETFï¼‰ é€šè¿‡ RFC 6455 å¯¹ WebSocket åè®®è¿›è¡Œäº†æ ‡å‡†åŒ–ã€‚äº’è”ç½‘å·ç åˆ†é…æœºæ„ ï¼ˆIANAï¼‰ ä¸ IETF åè°ƒç»´æŠ¤ WebSocket åè®®æ³¨å†Œç®¡ç†æœºæ„ï¼Œè¯¥æ³¨å†Œç®¡ç†æœºæ„å®šä¹‰äº†åè®®ä½¿ç”¨çš„è®¸å¤šä»£ç å’Œå‚æ•°æ ‡è¯†ç¬¦ã€‚\nä»€ä¹ˆæ˜¯ WebSocket APIï¼Ÿ WebSocket API åŒ…å«åœ¨ HTML Living Standard ä¸­ï¼Œæ˜¯ä¸€ä¸ªç¼–ç¨‹æ¥å£ï¼Œç”¨äºåˆ›å»º WebSocket è¿æ¥å¹¶ç®¡ç† Web åº”ç”¨ç¨‹åºä¸­å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®äº¤æ¢ã€‚å®ƒä¸ºå¼€å‘äººå‘˜æä¾›äº†ä¸€ç§ç®€å•ä¸”æ ‡å‡†åŒ–çš„æ–¹æ³•ï¼Œå¯ä»¥åœ¨å…¶åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ WebSocket åè®®ã€‚\nå¦‚ä»Šï¼Œå‡ ä¹æ‰€æœ‰ç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒ WebSocket APIã€‚æ­¤å¤–ï¼Œè¿˜æœ‰è®¸å¤šæ¡†æ¶å’Œåº“ï¼ˆåŒ…æ‹¬å¼€æºå’Œå•†ä¸šè§£å†³æ–¹æ¡ˆï¼‰å®ç°äº† WebSocket APIã€‚\nWebSocket çš„ç”¨é€”æ˜¯ä»€ä¹ˆï¼Ÿ WebSocket æä¾›ä½å»¶è¿Ÿé€šä¿¡åŠŸèƒ½ï¼Œé€‚ç”¨äºå„ç§ç±»å‹çš„å®æ—¶ç”¨ä¾‹ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ WebSockets æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š\nå¼ºå¤§çš„å®æ—¶èŠå¤©ä½“éªŒã€‚ å¹¿æ’­å®æ—¶äº‹ä»¶æ•°æ®ï¼Œä¾‹å¦‚å®æ—¶æ¯”åˆ†å’Œæµé‡æ›´æ–°ã€‚ ä¿ƒè¿›å…±äº«é¡¹ç›®å’Œç™½æ¿ä¸Šçš„å¤šäººåä½œã€‚ å‘é€é€šçŸ¥å’Œè­¦æŠ¥ã€‚ è®©æ‚¨çš„åç«¯å’Œå‰ç«¯ä¿æŒå®æ—¶åŒæ­¥ã€‚ ä¸ºåŸå¸‚äº¤é€šå’Œé€é¤åº”ç”¨æ·»åŠ å®æ—¶ä½ç½®è·Ÿè¸ªåŠŸèƒ½ã€‚ WebSockets æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ æ¦‚æ‹¬åœ°è¯´ï¼Œä½¿ç”¨ WebSockets æ¶‰åŠä¸‰ä¸ªä¸»è¦æ­¥éª¤ï¼š\næ‰“å¼€ WebSocket è¿æ¥ã€‚å»ºç«‹ WebSocket è¿æ¥çš„è¿‡ç¨‹ç§°ä¸ºå¼€å§‹æ¡æ‰‹ï¼Œç”±å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ HTTP è¯·æ±‚/å“åº”äº¤æ¢ç»„æˆã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…å¦‚ä½•å»ºç«‹ WebSocket è¿æ¥ã€‚ é€šè¿‡WebSocketè¿›è¡Œæ•°æ®ä¼ è¾“ã€‚æˆåŠŸæ‰“å¼€æ¡æ‰‹åï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥é€šè¿‡æŒä¹… WebSocket è¿æ¥äº¤æ¢æ¶ˆæ¯ï¼ˆå¸§ï¼‰ã€‚WebSocket æ¶ˆæ¯å¯èƒ½åŒ…å«å­—ç¬¦ä¸²ï¼ˆçº¯æ–‡æœ¬ï¼‰æˆ–äºŒè¿›åˆ¶æ•°æ®ã€‚è¯¦ç»†äº†è§£é€šè¿‡ WebSocket ä¼ è¾“æ•°æ®ã€‚ å…³é—­ WebSocket è¿æ¥ã€‚ä¸€æ—¦æŒä¹…çš„ WebSocket è¿æ¥è¾¾åˆ°å…¶ç›®çš„ï¼Œå®ƒå°±å¯ä»¥ç»ˆæ­¢;å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½å¯ä»¥é€šè¿‡å‘é€å…³é—­æ¶ˆæ¯æ¥å¯åŠ¨å…³é—­æ¡æ‰‹ã€‚é˜…è¯»æœ‰å…³å…³é—­ WebSocket è¿æ¥çš„è¯¦ç»†ä¿¡æ¯ã€‚ å¦‚ä½•å»ºç«‹ WebSocket è¿æ¥ åœ¨ WebSocket åè®®çº§åˆ«å»ºç«‹è¿æ¥ æ ¹æ® WebSocket åè®®è§„èŒƒï¼Œå»ºç«‹ WebSocket è¿æ¥çš„è¿‡ç¨‹ç§°ä¸ºæ‰“å¼€æ¡æ‰‹ï¼Œç”±å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ HTTP/1.1 è¯·æ±‚/å“åº”äº¤æ¢ç»„æˆã€‚å®¢æˆ·ç«¯å§‹ç»ˆå‘èµ·æ¡æ‰‹;å®ƒå‘æœåŠ¡å™¨å‘é€è¯·æ±‚ GET ï¼ŒæŒ‡ç¤ºå®ƒæƒ³è¦å°†è¿æ¥ä» HTTP åè®®å‡çº§åˆ° WebSocketã€‚\nä¸‹é¢æ˜¯å®¢æˆ·ç«¯å‘å‡ºçš„å¯åŠ¨å¼€åœºæ¡æ‰‹ GET çš„è¯·æ±‚çš„åŸºæœ¬ç¤ºä¾‹ï¼š\nGET wss://example.com:8181/ HTTP/1.1 Host: localhost: 8181 Connection: Upgrade Upgrade: websocket Sec-WebSocket-Version: 13 Sec-WebSocket-Key: zy6Dy9mSAIM7GJZNf9rI1A== æœåŠ¡å™¨å¿…é¡»è¿”å›å“åº” HTTP 101 Switching Protocols ä»£ç æ‰èƒ½æˆåŠŸå»ºç«‹ WebSocket è¿æ¥ï¼š\nHTTP/1.1 101 Switching Protocols Connection: Upgrade Sec-WebSocket-Accept: EDJa7WCAQQzMCYNJM42Syuo9SqQ= Upgrade: websocket æ‰“å¼€æ¡æ‰‹æ ‡å¤´\nä¸‹è¡¨æè¿°äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åœ¨æ‰“å¼€æ¡æ‰‹æœŸé—´ä½¿ç”¨çš„æ ‡å¤´ - åŒ…æ‹¬å¿…éœ€çš„æ ‡å¤´ï¼ˆåœ¨ä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸­è¿›è¡Œäº†è¯´æ˜ï¼‰å’Œå¯é€‰æ ‡å¤´ã€‚\nHeader Required Description Host Yes ä¸»æœºåï¼Œä»¥åŠè¯·æ±‚å‘é€åˆ°çš„æœåŠ¡å™¨çš„ç«¯å£å·ï¼ˆå¯é€‰ï¼‰ã€‚ Connection Yes æŒ‡ç¤ºå®¢æˆ·ç«¯å¸Œæœ›åå•†æ›´æ”¹è¿æ¥çš„ä½¿ç”¨æ–¹å¼ã€‚å€¼å¿…é¡»ä¸º Upgrade ã€‚Also returned by the server. ä¹Ÿç”±æœåŠ¡å™¨è¿”å›ã€‚ Sec-WebSocket-Version Yes å”¯ä¸€æ¥å—çš„å€¼æ˜¯ 13ã€‚åœ¨æ­¤æ ‡å¤´ä¸­ä¼ é€’çš„ä»»ä½•å…¶ä»–ç‰ˆæœ¬éƒ½æ˜¯æ— æ•ˆçš„ã€‚ Sec-WebSocket-Key Yes å®¢æˆ·ç«¯å‘é€çš„ base64 ç¼–ç çš„ä¸€æ¬¡æ€§éšæœºå€¼ï¼ˆéšæœºæ•°ï¼‰ã€‚ç”±å¤§å¤šæ•° WebSocket åº“æˆ–ä½¿ç”¨æµè§ˆå™¨ä¸­æä¾›çš„ WebSocket ç±»è‡ªåŠ¨ä¸ºæ‚¨å¤„ç†ã€‚ Sec-WebSocket-Accept Yes æœåŠ¡å™¨è¿”å›çš„ base64 ç¼–ç çš„ SHA-1 å“ˆå¸Œå€¼ï¼Œä½œä¸ºå¯¹ Sec-WebSocket-Key çš„ç›´æ¥å“åº”ã€‚Indicates that the server is willing to initiate the WebSocket connection. æŒ‡ç¤ºæœåŠ¡å™¨æ„¿æ„å¯åŠ¨ WebSocket è¿æ¥ã€‚ Sec-WebSocket-Protocol No å¯é€‰æ ‡å¤´å­—æ®µï¼ŒåŒ…å«ä¸€ä¸ªå€¼åˆ—è¡¨ï¼Œè¿™äº›å€¼æŒ‡ç¤ºå®¢æˆ·ç«¯è¦å‘è¨€çš„å­åè®®ï¼ŒæŒ‰é¦–é€‰é¡¹æ’åºã€‚æœåŠ¡å™¨éœ€è¦åœ¨å“åº”ä¸­å°†æ­¤å­—æ®µä¸é€‰å®šçš„å­åè®®å€¼ä¹‹ä¸€ï¼ˆåˆ—è¡¨ä¸­æ”¯æŒçš„ç¬¬ä¸€ä¸ªå€¼ï¼‰ä¸€èµ·åŒ…å«ã€‚ Sec-WebSocket-Extensions No å¯é€‰æ ‡å¤´å­—æ®µï¼Œæœ€åˆä»å®¢æˆ·ç«¯å‘é€åˆ°æœåŠ¡å™¨ï¼Œç„¶åä»æœåŠ¡å™¨å‘é€åˆ°å®¢æˆ·ç«¯ã€‚å®ƒå¸®åŠ©å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å°±ä¸€ç»„åè®®çº§æ‰©å±•è¾¾æˆä¸€è‡´ï¼Œä»¥ä¾¿åœ¨è¿æ¥æœŸé—´ä½¿ç”¨ã€‚ Origin No æ‰€æœ‰æµè§ˆå™¨å®¢æˆ·ç«¯å‘é€çš„æ ‡å¤´å­—æ®µï¼ˆå¯¹äºéæµè§ˆå™¨å®¢æˆ·ç«¯æ˜¯å¯é€‰çš„ï¼‰ã€‚ç”¨äºé˜²æ­¢åœ¨ Web æµè§ˆå™¨ä¸­ä½¿ç”¨ WebSocket API çš„è„šæœ¬æœªç»æˆæƒè·¨åŸŸä½¿ç”¨ WebSocket æœåŠ¡å™¨ã€‚å¦‚æœ Origin æŒ‡ç¤ºçš„è¿æ¥å¯¹æœåŠ¡å™¨ä¸å¯æ¥å—ï¼Œåˆ™è¿æ¥å°†è¢«æ‹’ç»ã€‚ Sec-WebSocket-Key å’Œ Sec-WebSocket-Accept\nå€¼å¾—ä¸€æçš„æ˜¯ï¼Œæœ‰å…³ WebSocket æ¡æ‰‹æœŸé—´ä½¿ç”¨çš„ä¸¤ä¸ªå¿…éœ€æ ‡å¤´çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼š Sec-WebSocket-Key å’Œ Sec-WebSocket-Accept .æ€»ä¹‹ï¼Œè¿™äº›æ ‡å¤´å¯¹äºä¿è¯æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½èƒ½å¤Ÿé€šè¿‡ WebSocket è¿›è¡Œé€šä¿¡è‡³å…³é‡è¦ã€‚\né¦–å…ˆï¼Œæˆ‘ä»¬æœ‰ Sec-WebSocket-Key ï¼Œå®ƒç”±å®¢æˆ·ç«¯ä¼ é€’ç»™æœåŠ¡å™¨ï¼Œå¹¶åŒ…å«ä¸€ä¸ª 16 å­—èŠ‚ã€base64 ç¼–ç çš„ä¸€æ¬¡æ€§éšæœºå€¼ï¼ˆnonceï¼‰ã€‚å…¶ç›®çš„æ˜¯å¸®åŠ©ç¡®ä¿æœåŠ¡å™¨ä¸æ¥å—æ¥è‡ªé WebSocket å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ HTTP å®¢æˆ·ç«¯ï¼‰çš„è¿æ¥ï¼Œè¿™äº›å®¢æˆ·ç«¯è¢«æ»¥ç”¨ï¼ˆæˆ–é…ç½®é”™è¯¯ï¼‰ä»¥å°†æ•°æ®å‘é€åˆ°æ¯«æ— æˆ’å¿ƒçš„ WebSocket æœåŠ¡å™¨ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ Sec-WebSocket-Key ï¼š\nSec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ== ä¸ ç›´æ¥ç›¸å…³çš„æ˜¯ Sec-WebSocket-Key ï¼ŒæœåŠ¡å™¨å“åº”åŒ…æ‹¬ä¸€ä¸ª Sec-WebSocket-Accept æ ‡å¤´ã€‚æ­¤æ ‡å¤´åŒ…å«é€šè¿‡è¿æ¥å®¢æˆ·ç«¯å‘é€çš„ Sec-WebSocket-Key éšæœºæ•°å’Œé™æ€å€¼ ï¼ˆUUIDï¼‰ 258EAFA5-E914-47DA-95CA-C5AB0DC85B11 ç”Ÿæˆçš„ base64 ç¼–ç çš„ SHA-1 å“ˆå¸Œå€¼ã€‚\næ ¹æ®ä¸Šé¢æä¾›çš„ Sec-WebSocket-Key ç¤ºä¾‹ï¼Œä¸‹é¢æ˜¯æœåŠ¡å™¨è¿”å›çš„ Sec-WebSocket-Accept æ ‡å¤´ï¼š\nSec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo= åœ¨ WebSocket API çº§åˆ«å»ºç«‹è¿æ¥ æµè§ˆå™¨ï¼ˆä»¥åŠå¤§å¤šæ•° WebSocket åº“ï¼‰ä¸­çš„ WebSocket API ä¼šè‡ªåŠ¨ä¸ºæ‚¨å¤„ç†å¼€åœºæ¡æ‰‹ã€‚æ‚¨æ‰€è¦åšçš„å°±æ˜¯å®ä¾‹åŒ– WebSocket å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å°†è‡ªåŠ¨å°è¯•æ‰“å¼€ä¸æœåŠ¡å™¨çš„è¿æ¥ï¼š\nconst socket = new WebSocket(\u0026#39;wss://example.org\u0026#39;); å»ºç«‹ WebSocket è¿æ¥æ—¶ä¼šå¼•å‘ open äº‹ä»¶ã€‚å®ƒè¡¨ç¤ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ‰“å¼€æ¡æ‰‹æˆåŠŸï¼Œç°åœ¨å¯ä»¥ä½¿ç”¨ WebSocket è¿æ¥æ¥å‘é€å’Œæ¥æ”¶æ•°æ®ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼ˆè¯·æ³¨æ„ï¼Œ open è¯¥äº‹ä»¶æ˜¯é€šè¿‡ onopen å±æ€§å¤„ç†çš„ï¼‰ï¼š\n// Create WebSocket connection const socket = new WebSocket(\u0026#39;wss://example.org\u0026#39;); // Connection opened socket.onopen = function(e) { console.log(\u0026#39;Connection open!\u0026#39;); }; å¦‚ä½•é€šè¿‡ WebSocket ä¼ è¾“æ•°æ® æ•°æ®ä¼ è¾“ï¼šåè®®çº§æ³¨æ„äº‹é¡¹ æˆåŠŸæ‰“å¼€æ¡æ‰‹åï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥ä½¿ç”¨ WebSocket è¿æ¥åœ¨å…¨åŒå·¥æ¨¡å¼ä¸‹äº¤æ¢æ¶ˆæ¯ã€‚WebSocket æ¶ˆæ¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå¸§ç»„æˆã€‚\nWebSocket å¸§é‡‡ç”¨äºŒè¿›åˆ¶è¯­æ³•ï¼ŒåŒ…å«å¤šæ¡ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nFINé’»å¤´å’Œç¢ç‰‡\nåœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œéœ€è¦å°† WebSocket æ¶ˆæ¯åˆ†æ®µä¸ºå¤šä¸ªå¸§ï¼ˆæˆ–è‡³å°‘æ˜¯å¯å–çš„ï¼‰ã€‚ä¾‹å¦‚ï¼Œç¢ç‰‡åŒ–é€šå¸¸ç”¨äºæé«˜æ€§èƒ½ã€‚å¦‚æœæ²¡æœ‰ç¢ç‰‡ï¼Œç»ˆç»“ç‚¹åœ¨å‘é€æ¶ˆæ¯ä¹‹å‰å¿…é¡»ç¼“å†²æ•´ä¸ªæ¶ˆæ¯ã€‚é€šè¿‡åˆ†æ®µï¼Œç«¯ç‚¹å¯ä»¥é€‰æ‹©ä¸€ä¸ªå¤§å°åˆç†çš„ç¼“å†²åŒºï¼Œå½“ç¼“å†²åŒºå·²æ»¡æ—¶ï¼Œå°†åç»­å¸§ä½œä¸ºå»¶ç»­å‘é€ã€‚ç„¶åï¼Œæ¥æ”¶ç«¯ç‚¹ç»„è£…å¸§ä»¥é‡æ–°åˆ›å»º WebSocket æ¶ˆæ¯ã€‚\nä»¥ä¸‹æ˜¯å•å¸§æ¶ˆæ¯çš„æ ·å­ï¼š\n0x81 0x05 0x48 0x65 0x6c 0x6c 0x6f (contains \u0026#34;Hello\u0026#34;) ç›¸æ¯”ä¹‹ä¸‹ï¼Œå¯¹äºç¢ç‰‡åŒ–ï¼Œç›¸åŒçš„æ¶ˆæ¯å°†å¦‚ä¸‹æ‰€ç¤ºï¼š\n0x01 0x03 0x48 0x65 0x6c (contains \u0026#34;Hel\u0026#34;) 0x80 0x02 0x6c 0x6f (contains \u0026#34;lo\u0026#34;) RSV 1-3\nRSV1 ã€ RSV2 å’Œ RSV3 æ˜¯ä¿ç•™ä½ã€‚å®ƒä»¬å¿…é¡»ä¸º 0ï¼Œé™¤éåœ¨å¼€å§‹æ¡æ‰‹æœŸé—´åå•†äº†å®šä¹‰éé›¶å€¼çš„æ‰©å±•ã€‚\nOpcodes\næ¯ä¸ªå¸§éƒ½æœ‰ä¸€ä¸ªæ“ä½œç ï¼Œç”¨äºç¡®å®šå¦‚ä½•è§£é‡Šè¯¥å¸§çš„æœ‰æ•ˆè½½è·æ•°æ®ã€‚å½“å‰ä½¿ç”¨çš„æ ‡å‡†æ“ä½œç ç”± RFC 6455 å®šä¹‰ï¼Œå¹¶ç”±äº’è”ç½‘å·ç åˆ†é…æœºæ„ ï¼ˆIANAï¼‰ ç»´æŠ¤ã€‚\nOpcode Description 0 å»¶ç»­æ¡†æ¶;ç»§ç»­ä¸Šä¸€å¸§çš„æœ‰æ•ˆè½½è·ã€‚ 1 æŒ‡ç¤ºæ–‡æœ¬æ¡†æ¶ï¼ˆUTF-8 æ–‡æœ¬æ•°æ®ï¼‰ã€‚ 2 æŒ‡ç¤ºäºŒè¿›åˆ¶å¸§ã€‚ 3-7 ä¸ºè‡ªå®šä¹‰æ•°æ®æ¡†ä¿ç•™ã€‚ 8 è¿æ¥é—­åˆæ¡†æ¶;å¯¼è‡´è¿æ¥ç»ˆæ­¢ã€‚ 9 ping å¸§ã€‚ç”¨ä½œç¡®ä¿è¿æ¥ä»å¤„äºæ´»åŠ¨çŠ¶æ€çš„å¿ƒè·³æœºåˆ¶ã€‚æ¥æ”¶å™¨å¿…é¡»ä»¥ä¹’ä¹“çƒæ¡†æ¶è¿›è¡Œå“åº”ã€‚ 10 pong å¸§ã€‚ç”¨ä½œç¡®ä¿è¿æ¥ä»å¤„äºæ´»åŠ¨çŠ¶æ€çš„å¿ƒè·³æœºåˆ¶ã€‚åœ¨æ”¶åˆ° ping å¸§åä½œä¸ºå“åº”å‘é€ã€‚ 11-15 ä¿ç•™ç”¨äºè‡ªå®šä¹‰æ§åˆ¶å¸§ã€‚ Masking\nå®¢æˆ·ç«¯å‘é€åˆ°æœåŠ¡å™¨çš„æ¯ä¸ª WebSocket å¸§éƒ½éœ€è¦å€ŸåŠ©éšæœº masking-key ï¼ˆ32 ä½å€¼ï¼‰è¿›è¡Œå±è”½ã€‚æ­¤é”®åŒ…å«åœ¨å¸§ä¸­ï¼Œç”¨äºæ··æ·†æœ‰æ•ˆè´Ÿè½½æ•°æ®ã€‚ä½†æ˜¯ï¼Œå½“æ•°æ®ä»¥ç›¸åçš„æ–¹å¼æµåŠ¨æ—¶ï¼ŒæœåŠ¡å™¨ä¸å¾—å±è”½å®ƒå‘é€åˆ°å®¢æˆ·ç«¯çš„ä»»ä½•å¸§ã€‚\nåœ¨æœåŠ¡å™¨ç«¯ï¼Œåœ¨è¿›ä¸€æ­¥å¤„ç†ä¹‹å‰ï¼Œå¿…é¡»å–æ¶ˆå±è”½ä»å®¢æˆ·ç«¯æ¥æ”¶çš„å¸§ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œè¯´æ˜å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ï¼š\nvar unmask = function(mask, buffer) { var payload = new Buffer(buffer.length); for (var i=0; i\u0026lt;buffer.length; i++) { payload[i] = mask[i % 4] ^ buffer[i]; } return payload; } æœ‰æ•ˆè½½è·é•¿åº¦å’Œæœ‰æ•ˆè½½è·æ•°æ®WebSocket åè®®ä½¿ç”¨å¯å˜å­—èŠ‚æ•°å¯¹æœ‰æ•ˆè´Ÿè½½æ•°æ®çš„é•¿åº¦è¿›è¡Œç¼–ç ï¼š\nå¯¹äº \u0026lt;126 å­—èŠ‚çš„æœ‰æ•ˆè´Ÿè½½ï¼Œé•¿åº¦å°†æ‰“åŒ…åˆ°å‰ä¸¤ä¸ªå¸§æ ‡å¤´å­—èŠ‚ä¸­ã€‚ å¯¹äº 126 å­—èŠ‚çš„æœ‰æ•ˆè´Ÿè½½ï¼Œä½¿ç”¨ä¸¤ä¸ªé¢å¤–çš„æ ‡å¤´å­—èŠ‚æ¥æŒ‡ç¤ºé•¿åº¦ã€‚ å¦‚æœæœ‰æ•ˆè´Ÿè½½ä¸º 127 å­—èŠ‚ï¼Œåˆ™ä½¿ç”¨å¦å¤– 8 ä¸ªæ ‡å¤´å­—èŠ‚æ¥æŒ‡ç¤ºå…¶é•¿åº¦ã€‚ WebSocket åè®®æ”¯æŒä¸¤ç§ç±»å‹çš„æœ‰æ•ˆè´Ÿè½½æ•°æ®ï¼šæ–‡æœ¬ï¼ˆUTF-8 Unicode æ–‡æœ¬ï¼‰å’ŒäºŒè¿›åˆ¶ã€‚ ä½¿ç”¨ WebSocket API è¿›è¡Œæ•°æ®ä¼ è¾“ WebSocket ç¼–ç¨‹éµå¾ªå¼‚æ­¥ã€äº‹ä»¶é©±åŠ¨çš„ç¼–ç¨‹æ¨¡å‹ã€‚åªè¦ WebSocket è¿æ¥å¤„äºæ‰“å¼€çŠ¶æ€ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å°±åªéœ€ä¾¦å¬äº‹ä»¶ï¼Œå³å¯å¤„ç†ä¼ å…¥æ•°æ®å’Œè¿æ¥çŠ¶æ€æ›´æ”¹ï¼ˆæ— éœ€è½®è¯¢ï¼‰ã€‚\nå½“é€šè¿‡ WebSocket æ¥æ”¶æ•°æ®æ—¶ï¼Œå°†è§¦å‘è¯¥ message äº‹ä»¶ã€‚æ¶ˆæ¯å¯èƒ½åŒ…å«å­—ç¬¦ä¸²ï¼ˆçº¯æ–‡æœ¬ï¼‰æˆ–äºŒè¿›åˆ¶æ•°æ®ï¼Œå¦‚ä½•å¤„ç†å’Œå¯è§†åŒ–è¿™äº›æ•°æ®å–å†³äºæ‚¨ã€‚\nä¸‹é¢æ˜¯å¦‚ä½•å¤„ç† message äº‹ä»¶çš„ç¤ºä¾‹ï¼ˆä½¿ç”¨å±æ€§ onmessage ï¼‰ï¼š\nsocket.onmessage = function(msg) { if(msg.data instanceof ArrayBuffer) { processArrayBuffer(msg.data); } else { processText(msg.data); } } è¦é€šè¿‡ WebSocket API å‘é€æ¶ˆæ¯ï¼Œæ‚¨å¿…é¡»ä½¿ç”¨è¯¥ send() æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nsocket.onopen = function(e) { socket.send(JSON.stringify({\u0026#39;msg\u0026#39;: \u0026#39;payload\u0026#39;})); } ä¸Šé¢çš„ç¤ºä¾‹ä»£ç æ¼”ç¤ºå¦‚ä½•å‘é€æ–‡æœ¬ï¼ˆå­—ç¬¦ä¸²ï¼‰æ¶ˆæ¯ã€‚ä½†æ˜¯ï¼Œé™¤äº†å­—ç¬¦ä¸²ä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥å‘é€äºŒè¿›åˆ¶æ•°æ®ï¼ˆ Blob æˆ– ArrayBuffer ï¼‰ï¼š\nvar buffer = new ArrayBuffer(128); socket.send(buffer); var intview = new Uint32Array(buffer); socket.send(intview); var blob = new Blob([buffer]); socket.send(blob); å¦‚ä½•å…³é—­ WebSocket è¿æ¥ åœ¨åè®®çº§åˆ«å…³é—­ WebSocket è¿æ¥ å…³é—­ WebSocket è¿æ¥çš„è¿‡ç¨‹ç§°ä¸ºå…³é—­æ¡æ‰‹ã€‚æ‚¨å¯ä»¥é€šè¿‡å‘é€æ“ä½œç ä¸º çš„ close 8 å¸§æ¥å¯åŠ¨å®ƒã€‚é™¤äº†æ“ä½œç ä¹‹å¤–ï¼Œå…³é—­å¸§è¿˜å¯èƒ½åŒ…å«æŒ‡ç¤ºå…³é—­åŸå› çš„æ­£æ–‡ã€‚æ­¤æ­£æ–‡ç”±çŠ¶æ€ä»£ç ï¼ˆæ•´æ•°ï¼‰å’Œ UTF-8 ç¼–ç å­—ç¬¦ä¸²ï¼ˆåŸå› ï¼‰ç»„æˆã€‚\nåœ¨ç»“æŸæ¡æ‰‹æœŸé—´å¯ä»¥ä½¿ç”¨çš„æ ‡å‡†çŠ¶æ€ä»£ç ç”± RFC 6455 å®šä¹‰ï¼Œå¹¶åœ¨ä¸‹è¡¨ä¸­åˆ—å‡ºï¼š\n**Status code Name Description 0-999 N/A ä½äº 1000 çš„ä»£ç æ— æ•ˆï¼Œä¸èƒ½ä½¿ç”¨ã€‚ 1000 æ­£å¸¸é—­åˆ æŒ‡ç¤ºæ­£å¸¸é—­åŒ…ï¼Œè¡¨ç¤ºå·²å®ç°å»ºç«‹ WebSocket è¿æ¥çš„ç›®çš„ã€‚ 1001 ç¦»å¼€ åº”åœ¨å…³é—­è¿æ¥æ—¶ä½¿ç”¨ï¼Œå¹¶ä¸”ä¸ä¼šå°è¯•åç»­è¿æ¥ï¼ˆä¾‹å¦‚ï¼ŒæœåŠ¡å™¨å…³é—­æˆ–æµè§ˆå™¨ç¦»å¼€é¡µé¢ï¼‰ã€‚ 1002 åè®®é”™è¯¯ ç”±äºåè®®é”™è¯¯ï¼Œç»ˆç»“ç‚¹æ­£åœ¨ç»ˆæ­¢è¿æ¥ã€‚ 1003 ä¸æ”¯æŒçš„æ•°æ® è¿æ¥è¢«ç»ˆæ­¢ï¼Œå› ä¸ºç«¯ç‚¹æ¥æ”¶åˆ°å®ƒæ— æ³•å¤„ç†çš„æ•°æ®ç±»å‹ï¼ˆä¾‹å¦‚ï¼Œæ¥æ”¶äºŒè¿›åˆ¶æ•°æ®çš„çº¯æ–‡æœ¬ç«¯ç‚¹ï¼‰ã€‚ 1004 Reserved Reserved. A meaning might be defined in the future. ä¿ç•™ã€‚å°†æ¥å¯èƒ½ä¼šå®šä¹‰ä¸€ä¸ªå«ä¹‰ã€‚ 1005 æœªæ”¶åˆ°çŠ¶æ€ åº”ç”¨å’Œ WebSocket API ç”¨äºæŒ‡ç¤ºæœªæ”¶åˆ°çŠ¶æ€ä»£ç ï¼Œå°½ç®¡é¢„æœŸä¼šæ”¶åˆ°çŠ¶æ€ä»£ç ã€‚ 1006 å¼‚å¸¸é—­åˆ ç”±åº”ç”¨å’Œ WebSocket API ç”¨äºæŒ‡ç¤ºè¿æ¥å¼‚å¸¸å…³é—­ï¼ˆä¾‹å¦‚ï¼Œæœªå‘é€æˆ–æ¥æ”¶ close å¸§ï¼‰ã€‚ 1007 æ— æ•ˆçš„è´Ÿè½½æ•°æ® ç»ˆç»“ç‚¹æ­£åœ¨ç»ˆæ­¢è¿æ¥ï¼Œå› ä¸ºå®ƒæ”¶åˆ°åŒ…å«ä¸ä¸€è‡´æ•°æ®çš„æ¶ˆæ¯ï¼ˆä¾‹å¦‚ï¼Œæ–‡æœ¬æ¶ˆæ¯ä¸­çš„é UTF-8 æ•°æ®ï¼‰ã€‚ 1008 Policy violation è¿åæ”¿ç­– ç»ˆç»“ç‚¹æ­£åœ¨ç»ˆæ­¢è¿æ¥ï¼Œå› ä¸ºå®ƒæ”¶åˆ°äº†è¿åå…¶ç­–ç•¥çš„æ¶ˆæ¯ã€‚è¿™æ˜¯ä¸€ä¸ªé€šç”¨çŠ¶æ€ä»£ç ;å½“å…¶ä»–çŠ¶æ€ä»£ç ä¸åˆé€‚æ—¶ï¼Œæˆ–è€…éœ€è¦éšè—æœ‰å…³ç­–ç•¥çš„ç‰¹å®šè¯¦ç»†ä¿¡æ¯æ—¶ï¼Œåº”ä½¿ç”¨å®ƒã€‚ 1009 æ¶ˆæ¯å¤ªå¤§ . ç”±äºæ¥æ”¶åˆ°çš„æ•°æ®å¸§å¤ªå¤§è€Œæ— æ³•å¤„ç†ï¼Œç«¯ç‚¹æ­£åœ¨ç»ˆæ­¢è¿æ¥ã€‚ 1010 å¼ºåˆ¶å»¶æœŸ Tå®¢æˆ·ç«¯æ­£åœ¨ç»ˆæ­¢è¿æ¥ï¼Œå› ä¸ºæœåŠ¡å™¨åœ¨æ‰“å¼€æ¡æ‰‹æœŸé—´æœªèƒ½åå•†æ‰©å±•ã€‚ 1011 å†…éƒ¨é”™è¯¯ æœåŠ¡å™¨æ­£åœ¨ç»ˆæ­¢è¿æ¥ï¼Œå› ä¸ºå®ƒé‡åˆ°äº†æ„å¤–æƒ…å†µï¼Œå¯¼è‡´å®ƒæ— æ³•æ»¡è¶³è¯·æ±‚ã€‚ 1012 æœåŠ¡é‡å¯ æœåŠ¡å™¨æ­£åœ¨ç»ˆæ­¢è¿æ¥ï¼Œå› ä¸ºå®ƒæ­£åœ¨é‡æ–°å¯åŠ¨ã€‚ 1013 è¯·ç¨åå†è¯• æœåŠ¡å™¨ç”±äºä¸´æ—¶æƒ…å†µï¼ˆä¾‹å¦‚ï¼Œå®ƒè¿‡è½½ï¼‰è€Œç»ˆæ­¢è¿æ¥ã€‚ 1014 Bad gateway ç½‘å…³é”™è¯¯ æœåŠ¡å™¨å……å½“ç½‘å…³æˆ–ä»£ç†ï¼Œå¹¶æ”¶åˆ°æ¥è‡ªä¸Šæ¸¸æœåŠ¡å™¨çš„æ— æ•ˆå“åº”ã€‚ç±»ä¼¼äº 502 Bad Gateway HTTP çŠ¶æ€ä»£ç ã€‚ 1015 TLS handshake TLS æ¡æ‰‹ ä¿ç•™ã€‚æŒ‡ç¤ºç”±äºæ— æ³•æ‰§è¡Œ TLS æ¡æ‰‹ï¼ˆä¾‹å¦‚ï¼Œæ— æ³•éªŒè¯æœåŠ¡å™¨è¯ä¹¦ï¼‰è€Œå…³é—­è¿æ¥ã€‚ 1016-1999 N/A ä¿ç•™ä¾› WebSocket æ ‡å‡†å°†æ¥ä½¿ç”¨ã€‚ 2000-2999 N/A ä¿ç•™ä¾› WebSocket æ‰©å±•å°†æ¥ä½¿ç”¨ã€‚ å®¢æˆ·ç«¯å’Œ Web æœåŠ¡å™¨éƒ½å¯ä»¥å¯åŠ¨å…³é—­æ¡æ‰‹ã€‚æ”¶åˆ° close å¸§åï¼Œç«¯ç‚¹ï¼ˆå®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨ï¼‰å¿…é¡»å‘é€å¸§ close ä½œä¸ºå“åº”ï¼ˆå›æ˜¾æ¥æ”¶åˆ°çš„çŠ¶æ€ä»£ç ï¼‰ã€‚ç»ˆç»“ç‚¹å‘é€å’Œæ¥æ”¶ close å¸§åï¼Œç»“æŸæ¡æ‰‹å®Œæˆï¼ŒWebSocket è¿æ¥è¢«è§†ä¸ºå·²å…³é—­ã€‚\nä½¿ç”¨ WebSocket API å…³é—­ WebSocket è¿æ¥ è¯¥ close() æ–¹æ³•ç”¨äºå…³é—­ WebSocket è¿æ¥ã€‚è°ƒç”¨æ­¤æ–¹æ³•åï¼Œæ— æ³•é€šè¿‡ WebSocket è¿æ¥å‘é€æˆ–æ¥æ”¶æ›´å¤šæ•°æ®ã€‚\nä¸‹é¢æ˜¯è°ƒç”¨ close() è¯¥æ–¹æ³•çš„æœ€åŸºæœ¬ç¤ºä¾‹ï¼š\nsocket.close(); ï¼ˆå¯é€‰ï¼‰æ‚¨å¯ä»¥ä½¿ç”¨ closeï¼ˆï¼‰ æ–¹æ³•ä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼š\nä¸€ä¸ªæ•°å€¼ï¼ŒæŒ‡ç¤ºè¯´æ˜å…³é—­è¿æ¥åŸå› çš„çŠ¶æ€ä»£ç ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…æœ¬æ–‡ä¸Šä¸€èŠ‚ä¸­çš„çŠ¶æ€ä»£ç è¡¨ã€‚ ä¸€ä¸ªäººç±»å¯è¯»çš„å­—ç¬¦ä¸²ï¼Œè§£é‡Šè¿æ¥å…³é—­çš„åŸå› ã€‚ ä¸‹é¢æ˜¯ä½¿ç”¨ä¸¤ä¸ªå¯é€‰å‚æ•°è°ƒç”¨ close() æ–¹æ³•çš„ç¤ºä¾‹ï¼š\nsocket.close(1003, \u0026#34;Unsupported data type!\u0026#34;); å½“ WebSocket è¿æ¥å…³é—­æ—¶ï¼Œå°†è§¦å‘ä¸€ä¸ª `close` äº‹ä»¶ã€‚ä»¥ä¸‹æ˜¯ä¾¦å¬ `close` äº‹ä»¶çš„æ–¹å¼ï¼š socket.onclose = function(e) { console.log(\u0026#34;Connection closed\u0026#34;, e); }; WebSocketsçš„ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ WebSocket çš„ä¼˜ç‚¹æ˜¯å®ƒä»¬æ”¯æŒå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„å®æ—¶é€šä¿¡ï¼Œè€Œæ— éœ€é¢‘ç¹çš„ HTTP è¯·æ±‚/å“åº”ã€‚è¿™å¸¦æ¥äº†ä¸€äº›å¥½å¤„ï¼Œä¾‹å¦‚å‡å°‘å»¶è¿Ÿï¼Œä»¥åŠæé«˜ Web åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œå“åº”èƒ½åŠ›ã€‚\nç”±äºå…¶æŒä¹…æ€§å’ŒåŒå‘æ€§ï¼ŒWebSocket åè®®åœ¨æ„å»ºéœ€è¦é¢‘ç¹æ•°æ®äº¤æ¢çš„å®æ—¶åº”ç”¨ç¨‹åºæ—¶æ¯” HTTP æ›´çµæ´»ã€‚WebSocket ä¹Ÿæ›´æœ‰æ•ˆç‡ï¼Œå› ä¸ºå®ƒä»¬å…è®¸ä¼ è¾“æ•°æ®è€Œæ— éœ€é‡å¤çš„ HTTP æ ‡å¤´å’Œæ¡æ‰‹ã€‚è¿™å¯ä»¥å‡å°‘å¸¦å®½ä½¿ç”¨å’ŒæœåŠ¡å™¨è´Ÿè½½ã€‚\nè™½ç„¶ WebSocket æœ‰å¾ˆå¤šä¼˜ç‚¹ï¼Œä½†å®ƒä»¬ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ã€‚ä»¥ä¸‹æ˜¯ä¸»è¦çš„ï¼š\nWebSocket æœªé’ˆå¯¹æµå¼éŸ³é¢‘å’Œè§†é¢‘æ•°æ®è¿›è¡Œä¼˜åŒ–ã€‚ å½“è¿æ¥ç»ˆæ­¢æ—¶ï¼ŒWebSocket ä¸ä¼šè‡ªåŠ¨æ¢å¤ã€‚ æŸäº›ç¯å¢ƒï¼ˆä¾‹å¦‚å…·æœ‰ä»£ç†æœåŠ¡å™¨çš„ä¼ä¸šç½‘ç»œï¼‰å°†é˜»æ­¢ WebSocket è¿æ¥ã€‚ WebSocket æ˜¯æœ‰çŠ¶æ€çš„ï¼Œè¿™ä½¿å¾—å®ƒä»¬å¾ˆéš¾åœ¨å¤§å‹ç³»ç»Ÿä¸­ä½¿ç”¨ã€‚ WebSockets çš„æœ€ä½³æ›¿ä»£å“æ˜¯ä»€ä¹ˆï¼Ÿ WebSocket æ˜¯å®æ—¶æˆ–è¿‘ä¹å®æ—¶å‘é€å’Œä½¿ç”¨æ•°æ®çš„å…³é”®ï¼ˆæˆ–è‡³å°‘æ˜¯å¯å–çš„ï¼‰ç”¨ä¾‹çš„ç»ä½³é€‰æ‹©ã€‚ç„¶è€Œï¼Œå¾ˆå°‘æœ‰æ”¾ä¹‹å››æµ·è€Œçš†å‡†çš„åè®®â€”â€”ä¸åŒçš„åè®®æ¯”å…¶ä»–åè®®æ›´å¥½åœ°æœåŠ¡äºä¸åŒçš„ç›®çš„ã€‚WebSockets çš„å®æ—¶æ›¿ä»£æ–¹æ¡ˆåŒ…æ‹¬ï¼š\nServer-Sent Events HTTP é•¿è½®è¯¢ MQTT WebRTC WebTransport å¦‚ä½•å¼€å§‹ä½¿ç”¨ WebSockets æ„å»ºå®æ—¶ä½“éªŒ WebSockets çš„å…¥é—¨éå¸¸ç®€å•ã€‚WebSocket API ä½¿ç”¨èµ·æ¥å¾ˆç®€å•ï¼Œæ¯ç§ç¼–ç¨‹è¯­è¨€éƒ½æœ‰è®¸å¤šå¯ç”¨çš„ WebSocket åº“å’Œæ¡†æ¶ã€‚å®ƒä»¬ä¸­çš„å¤§å¤šæ•°éƒ½å»ºç«‹åœ¨åŸå§‹ WebSocket åè®®ä¹‹ä¸Šï¼ŒåŒæ—¶æä¾›äº†é¢å¤–çš„åŠŸèƒ½ï¼Œä»è€Œä½¿å¼€å‘äººå‘˜æ›´å®¹æ˜“ã€æ›´æ–¹ä¾¿åœ°åœ¨ä»–ä»¬çš„åº”ç”¨ç¨‹åºä¸­å®ç° WebSocket å¹¶æ„å»ºåŸºäº WebSocket çš„åŠŸèƒ½ã€‚\nå¦‚æœæ‚¨åˆšåˆšå¼€å§‹ä½¿ç”¨ WebSocketsï¼Œå¹¶ä¸”å¸Œæœ›æ„å»ºç¬¬ä¸€ä¸ªç”± WebSockets æä¾›æ”¯æŒçš„å®æ—¶åº”ç”¨ç¨‹åºï¼Œè¯·æŸ¥çœ‹æ­¤åˆ†æ­¥æ•™ç¨‹ã€‚å®ƒæ•™æ‚¨å¦‚ä½•ä½¿ç”¨ä¸¤ä¸ªç®€å•çš„å¼€æº WebSocket åº“å¼€å‘äº¤äº’å¼å…‰æ ‡ä½ç½®å…±äº«æ¼”ç¤ºã€‚è¿™ç§é¡¹ç›®éœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„åŒå‘å³æ—¶é€šä¿¡ï¼Œè€Œ WebSocket æŠ€æœ¯æ­£æ˜¯åœ¨è¿™ç§ç”¨ä¾‹ä¸­å¤§æ”¾å¼‚å½©çš„ã€‚\nå¦ä¸€æ–¹é¢ï¼Œäº¤ä»˜ç”±å¼€æº WebSocket åº“æä¾›æ”¯æŒçš„ç”Ÿäº§å°±ç»ªå®æ—¶åŠŸèƒ½å¹¶ä¸åƒæ„å»ºä¸€ä¸ªç®€å•çš„æ¼”ç¤ºåº”ç”¨ç¨‹åºé‚£æ ·å®¹æ˜“ã€‚è¿™æ˜¯ä¸€æ¡å……æ»¡éšœç¢å’Œå·¥ç¨‹å¤æ‚æ€§çš„é“è·¯ã€‚ä¾‹å¦‚ï¼Œè¯·å‚é˜…æ‰©å±• Socket.IO æ‰€æ¶‰åŠçš„è®¸å¤šå·¥ç¨‹æŒ‘æˆ˜ï¼Œè¿™æ˜¯ç›®å‰æœ€æµè¡Œçš„å¼€æº WebSocket åº“ä¹‹ä¸€ã€‚\nå¦‚æœæ‚¨æƒ³é¿å…åœ¨å†…éƒ¨æ‰©å±•å’Œç»´æŠ¤ WebSocket åŸºç¡€æ¶æ„çš„æŒ‘æˆ˜å’Œæˆæœ¬ï¼Œæ‚¨å¯ä»¥å°†è¿™ç§å¤æ‚æ€§å¸è½½åˆ°æ‰˜ç®¡çš„ç¬¬ä¸‰æ–¹ PaaSï¼ˆå¦‚ Ablyï¼‰ä¸Šã€‚\nAblyï¼ŒWebSocketå¹³å°åœ¨ä»»ä½•è§„æ¨¡ä¸‹éƒ½èƒ½å¯é åœ°å·¥ä½œ Ably æ˜¯ä¸€å®¶å®æ—¶ä½“éªŒåŸºç¡€è®¾æ–½æä¾›å•†ã€‚æˆ‘ä»¬çš„ API å’Œ SDK å¯å¸®åŠ©å¼€å‘äººå‘˜æ„å»ºå’Œäº¤ä»˜å®æ—¶ä½“éªŒï¼Œè€Œæ— éœ€æ‹…å¿ƒç»´æŠ¤å’Œæ‰©å±•æ‚ä¹±æ— ç« çš„ WebSocket åŸºç¡€è®¾æ–½ã€‚\nAbly çš„ä¸»è¦ç‰¹æ€§å’ŒåŠŸèƒ½ï¼š\né€šè¿‡æ— æœåŠ¡å™¨ WebSocket è¿›è¡Œå‘å¸ƒ/è®¢é˜…æ¶ˆæ¯ä¼ é€’ï¼Œå…·æœ‰ä¸°å¯Œçš„åŠŸèƒ½ï¼Œä¾‹å¦‚æ¶ˆæ¯å¢é‡å‹ç¼©ã€å…·æœ‰è¿ç»­æ€§çš„è‡ªåŠ¨é‡æ–°è¿æ¥ã€ç”¨æˆ·çŠ¶æ€ã€æ¶ˆæ¯å†å²è®°å½•å’Œæ¶ˆæ¯äº¤äº’ã€‚ ç”±æ•°æ®ä¸­å¿ƒå’Œè¾¹ç¼˜åŠ é€Ÿæ¥å…¥ç‚¹ç»„æˆçš„å…¨çƒåˆ†å¸ƒå¼ç½‘ç»œã€‚ ä¿è¯æ¶ˆæ¯æ’åºå’Œä¼ é€’ã€‚ å…¨å±€å®¹é”™å’Œ 99.999% çš„æ­£å¸¸è¿è¡Œæ—¶é—´ SLAã€‚ \u0026lt; 65 æ¯«ç§’çš„å¾€è¿”å»¶è¿Ÿ ï¼ˆP99ï¼‰ã€‚ åŠ¨æ€å¼¹æ€§ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å¿«é€Ÿæ‰©å±•ä»¥å¤„ç†ä»»ä½•éœ€æ±‚ï¼ˆæ•°åäº¿æ¡ WebSocket æ¶ˆæ¯å‘é€åˆ°æ•°ç™¾ä¸‡ä¸ªå‘å¸ƒ/è®¢é˜…é¢‘é“å’Œ WebSocket è¿æ¥ï¼‰ã€‚ WebSocket å¸¸è§é—®é¢˜è§£ç­” ä»€ä¹ˆæ˜¯ WebSocket è¿æ¥ï¼Ÿ æ‚¨å¯ä»¥å°† WebSocket è¿æ¥è§†ä¸º Web å®¢æˆ·ç«¯å’Œ Web æœåŠ¡å™¨ä¹‹é—´çš„é•¿æœŸåŒå‘å…¨åŒå·¥é€šä¿¡é€šé“ã€‚è¯·æ³¨æ„ï¼ŒWebSocket è¿æ¥åœ¨ TCP ä¹‹ä¸Šå·¥ä½œã€‚\nWebSockets æ˜¯å¦å¯æ‰©å±•ï¼Ÿ æ˜¯çš„ï¼ŒWebSocket æ˜¯å¯æ‰©å±•çš„ã€‚Slackã€Netflix å’Œ Uber ç­‰å…¬å¸ä½¿ç”¨ WebSockets ä¸ºå…¶åº”ç”¨ç¨‹åºä¸­çš„å®æ—¶åŠŸèƒ½æä¾›æ”¯æŒï¼Œä¸ºæ•°ç™¾ä¸‡æœ€ç»ˆç”¨æˆ·æä¾›æ”¯æŒã€‚ä¾‹å¦‚ï¼ŒSlack ä½¿ç”¨ WebSockets åœ¨èŠå¤©ç”¨æˆ·ä¹‹é—´è¿›è¡Œå³æ—¶æ¶ˆæ¯ä¼ é€’ã€‚\nç„¶è€Œï¼Œæ‰©å±• WebSocket å¹¶éæ˜“äº‹ï¼Œæ¶‰åŠå¤§é‡å·¥ç¨‹å†³ç­–å’ŒæŠ€æœ¯æƒè¡¡ã€‚å…¶ä¸­ï¼š\næ‚¨åº”è¯¥ä½¿ç”¨å‚ç›´ç¼©æ”¾è¿˜æ˜¯æ°´å¹³ç¼©æ”¾ï¼Ÿ æ‚¨å¦‚ä½•å¤„ç†ä¸å¯é¢„æµ‹çš„è´Ÿè½½ï¼Ÿ å¦‚ä½•å¤§è§„æ¨¡ç®¡ç† WebSocket è¿æ¥ï¼Ÿ æ€»ä½“ä¸Šä½¿ç”¨äº†å¤šå°‘å¸¦å®½ï¼Œå®ƒå¦‚ä½•å½±å“æ‚¨çš„é¢„ç®—ï¼Ÿ æ‚¨æ˜¯å¦å¿…é¡»å¤„ç†æµé‡é«˜å³°ï¼Œå¦‚æœæ˜¯è¿™æ ·ï¼Œå¯¹æœåŠ¡å™¨å±‚çš„æ€§èƒ½æœ‰ä»€ä¹ˆå½±å“ï¼Ÿ å¦‚æœéœ€è¦ï¼Œæ‚¨å°†å¦‚ä½•è‡ªåŠ¨æ·»åŠ é¢å¤–çš„æœåŠ¡å™¨å®¹é‡ï¼Ÿ å¦‚ä½•ç¡®ä¿å¤§è§„æ¨¡çš„æ•°æ®å®Œæ•´æ€§ï¼ˆä¿è¯æ¶ˆæ¯æ’åºå’Œä¼ é€’ï¼‰ï¼Ÿ WebSocket å®‰å…¨å—ï¼Ÿ å¦‚æœ WebSocket é‡‡ç”¨é€‚å½“çš„å®‰å…¨æªæ–½æ¥å®æ–½ï¼Œå®ƒä»¬æ˜¯å®‰å…¨çš„ã€‚å®‰å…¨ WebSocket è¿æ¥ä½¿ç”¨â€œwss://â€URIã€‚è¿™è¡¨ç¤ºè¿æ¥æ˜¯ä½¿ç”¨ SSL/TLS åŠ å¯†çš„ï¼Œè¿™ç¡®ä¿äº† WebSocket å®¢æˆ·ç«¯å’Œ WebSocket æœåŠ¡å™¨ä¹‹é—´ä¼ è¾“çš„æ•°æ®æ˜¯åŠ å¯†çš„ï¼Œä¸ä¼šè¢«ç¬¬ä¸‰æ–¹æ‹¦æˆªæˆ–ç¯¡æ”¹ã€‚\næ­¤å¤–ï¼ŒWebSocket è¿æ¥å¯èƒ½å—åˆ°ä¸ HTTP è¿æ¥ç›¸åŒçš„å®‰å…¨ç­–ç•¥çš„çº¦æŸï¼Œä¾‹å¦‚è·¨åŸŸèµ„æºå…±äº« ï¼ˆCORSï¼‰ é™åˆ¶ï¼Œå¯é˜²æ­¢è·¨ä¸åŒåŸŸå¯¹èµ„æºè¿›è¡Œæœªç»æˆæƒçš„è®¿é—®ã€‚\nè¯·æ³¨æ„ï¼ŒWebSocket åè®®æ²¡æœ‰è§„å®šæœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯è¿›è¡Œèº«ä»½éªŒè¯çš„ä»»ä½•ç‰¹å®šæ–¹å¼ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨å¼€å§‹æ¡æ‰‹æœŸé—´ä½¿ç”¨ Cookie æ ‡å¤´å¤„ç†èº«ä»½éªŒè¯ã€‚å¦ä¸€ç§é€‰æ‹©æ˜¯ä½¿ç”¨ JSON Web ä»¤ç‰Œç­‰æŠ€æœ¯åœ¨åº”ç”¨ç¨‹åºçº§åˆ«ç®¡ç†èº«ä»½éªŒè¯ï¼ˆå’Œæˆæƒï¼‰ã€‚\nWebSockets æ¯” HTTP å¿«å—ï¼Ÿ åœ¨éœ€è¦é¢‘ç¹æ•°æ®äº¤æ¢çš„å®æ—¶åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ä¸­ï¼ŒWebSocket æ¯” HTTP æ›´å¿«ã€‚\nä¸ WebSocket è¿æ¥ç›¸æ¯”ï¼ŒHTTP è¿æ¥å…·æœ‰é¢å¤–çš„å¼€é”€ï¼ˆä¾‹å¦‚æ ‡å¤´å’Œå…¶ä»–å…ƒæ•°æ®ï¼‰ï¼Œè¿™å¯èƒ½ä¼šå¢åŠ å»¶è¿Ÿå¹¶é™ä½æ€§èƒ½ï¼Œè€Œ WebSocket è¿æ¥ä¸“ä¸ºæŒä¹…ã€ä½å»¶è¿Ÿã€åŒå‘é€šä¿¡è€Œè®¾è®¡ã€‚ä½¿ç”¨ WebSocketsï¼Œä¸éœ€è¦å¤šä¸ª HTTP è¯·æ±‚å’Œå“åº”ã€‚è¿™å¯ä»¥åŠ å¿«é€šä¿¡é€Ÿåº¦å¹¶é™ä½å»¶è¿Ÿã€‚\nWebSocket æ˜¯åŒæ­¥çš„è¿˜æ˜¯å¼‚æ­¥çš„ï¼Ÿ WebSocket åœ¨è®¾è®¡ä¸Šæ˜¯å¼‚æ­¥çš„ï¼Œè¿™æ„å‘³ç€å¯ä»¥éšæ—¶å‘é€å’Œæ¥æ”¶æ•°æ®ï¼Œè€Œæ— éœ€é˜»å¡æˆ–ç­‰å¾…å“åº”ã€‚ä½†æ˜¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶ WebSocket æœ¬èº«æ˜¯å¼‚æ­¥çš„ï¼Œä½†ç”¨äºå¤„ç† WebSocket äº‹ä»¶å’Œæ¶ˆæ¯çš„ä»£ç å¯èƒ½æ˜¯åŒæ­¥çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯å¼‚æ­¥çš„ï¼Œå…·ä½“å–å†³äºå®ƒçš„ç¼–å†™æ–¹å¼ã€‚\nWebSocket è´µå—ï¼Ÿ WebSocket è¿æ¥æœ¬èº«å¹¶ä¸æ˜‚è´µï¼Œå› ä¸ºå®ƒè¢«è®¾è®¡ä¸ºè½»é‡çº§å’Œé«˜æ•ˆï¼Œå¼€é”€æœ€å°ã€‚è¯è™½å¦‚æ­¤ï¼Œåœ¨å†…éƒ¨æ„å»ºå’Œç®¡ç†ä¸€ä¸ªå¯æ‰©å±•ä¸”å¯é çš„ WebSocket ç³»ç»Ÿæ—¢æ˜‚è´µåˆè€—æ—¶ï¼Œå¹¶ä¸”éœ€è¦å¤§é‡çš„å·¥ç¨‹å·¥ä½œï¼š\n10.2 äººæœˆæ˜¯åœ¨å†…éƒ¨æ„å»ºåŸºæœ¬ WebSocket åŸºç¡€è®¾æ–½çš„å¹³å‡æ—¶é—´ï¼Œå¯æ‰©å±•æ€§æœ‰é™ã€‚ æ‰€æœ‰è‡ªå»ºçš„ WebSocket è§£å†³æ–¹æ¡ˆä¸­æœ‰ä¸€åŠæ¯å¹´éœ€è¦ $100K-$200K çš„ç»´æŠ¤ã€‚ å“ªäº›æµè§ˆå™¨æ”¯æŒ WebSocketsï¼Ÿ å¤§å¤šæ•°ç°ä»£ Web æµè§ˆå™¨éƒ½æ”¯æŒ WebSocketï¼ŒåŒ…æ‹¬ï¼š\nGoogle Chromeï¼ˆç‰ˆæœ¬ 4 åŠæ›´é«˜ç‰ˆæœ¬ï¼‰ã€‚ Mozilla Firefoxï¼ˆç‰ˆæœ¬ 4 åŠæ›´é«˜ç‰ˆæœ¬ï¼‰ã€‚ Safariï¼ˆç‰ˆæœ¬ 5 åŠæ›´é«˜ç‰ˆæœ¬ï¼‰ã€‚ Microsoft Edgeï¼ˆç‰ˆæœ¬ 12 åŠæ›´é«˜ç‰ˆæœ¬ï¼‰ã€‚ Operaï¼ˆç‰ˆæœ¬ 10.70 åŠæ›´é«˜ç‰ˆæœ¬ï¼‰ã€‚ Internet Explorerï¼ˆç‰ˆæœ¬ 10 åŠæ›´é«˜ç‰ˆæœ¬ï¼‰ã€‚ Microsoft Edgeï¼ˆç‰ˆæœ¬ 12 åŠæ›´é«˜ç‰ˆæœ¬ï¼‰ã€‚ è¯·æ³¨æ„ï¼Œè¿™äº›æµè§ˆå™¨çš„æ—§ç‰ˆæœ¬è¦ä¹ˆä¸æ”¯æŒ WebSocketï¼Œè¦ä¹ˆæ”¯æŒæœ‰é™ã€‚åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼ˆ2023 å¹´ 4 æœˆ 25 æ—¥ï¼‰ï¼ŒOpera Mini æ˜¯å”¯ä¸€ä¸æ”¯æŒ WebSocket çš„ç°ä»£æµè§ˆå™¨ã€‚ WebSocket å¯ä»¥ä¿æŒæ‰“å¼€çŠ¶æ€å¤šé•¿æ—¶é—´ï¼Ÿ é€šå¸¸ï¼Œåªè¦å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¿æŒè¿æ¥å¹¶ä¸”ç½‘ç»œç¨³å®šï¼ŒWebSocket è¿æ¥å°±å¯ä»¥æ— é™æœŸä¿æŒæ‰“å¼€çŠ¶æ€ã€‚\nWebSocket æ˜¯æœ‰çŠ¶æ€çš„è¿˜æ˜¯æ— çŠ¶æ€çš„ï¼Ÿ ä¸ HTTP ä¸åŒï¼ŒWebSocket è¿æ¥æ˜¯æŒä¹…ä¸”æœ‰çŠ¶æ€çš„ã€‚è¿™ä½¿å¾— WebSocket éš¾ä»¥åœ¨ç”±å¤šä¸ª WebSocket æœåŠ¡å™¨ç»„æˆçš„å¤§å‹ç³»ç»Ÿä¸­ä½¿ç”¨ï¼ˆæ‚¨éœ€è¦åœ¨æœåŠ¡å™¨ä¹‹é—´å…±äº«è¿æ¥çŠ¶æ€ï¼‰ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2024/05/07/the-websocket-api-and-protocol-explained/","summary":"åŸæ–‡åœ°å€ï¼šhttps://ably.com/topic/websockets\nWebSocket æ ‡å¿—ç€ Web å¼€å‘çš„è½¬æŠ˜ç‚¹ã€‚ WebSocket æŠ€æœ¯æ—¨åœ¨ä»¥äº‹ä»¶ä¸ºé©±åŠ¨ï¼Œå¹¶é’ˆå¯¹ä½å»¶è¿Ÿè¿›è¡Œäº†ä¼˜åŒ–ï¼Œå·²æˆä¸ºè®¸å¤šå¯»æ±‚æ„å»ºäº¤äº’å¼å®æ—¶æ•°å­—ä½“éªŒä»¥æä¾›ä»¤äººæ„‰æ‚¦çš„ç”¨æˆ·ä½“éªŒçš„ç»„ç»‡å’Œå¼€å‘äººå‘˜çš„é¦–é€‰ã€‚æœ¬æ–‡æ¢è®¨äº†ä¸ WebSocket ç›¸å…³çš„å…³é”®ä¸»é¢˜ï¼š\nWebSocket åè®®å’Œ API è§£é‡Š\nWebSockets æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ\nWebSocketsçš„ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ\nWebSockets æ˜¯å¦å¯æ‰©å±•ï¼Ÿ\nWebSocket çš„ç”¨é€”æ˜¯ä»€ä¹ˆï¼Ÿ\nWebSockets çš„æœ€ä½³æ›¿ä»£å“æ˜¯ä»€ä¹ˆï¼Ÿ\nå¦‚ä½•å¼€å§‹ä½¿ç”¨ WebSockets æ„å»ºå®æ—¶ä½“éªŒ\nWebSocket å¸¸è§é—®é¢˜è§£ç­”\nWebSocketï¼šåè®®å’Œ API è§£é‡Š WebSocket æ˜¯ä¸€ç§å®æ—¶æŠ€æœ¯ï¼Œå¯é€šè¿‡æŒä¹…çš„å•å¥—æ¥å­—è¿æ¥åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å®ç°åŒå‘å…¨åŒå·¥é€šä¿¡ã€‚åªè¦éœ€è¦ï¼ŒWebSocket è¿æ¥å°±ä¼šä¿æŒæ´»åŠ¨çŠ¶æ€ï¼ˆç†è®ºä¸Šï¼Œå®ƒå¯ä»¥æ°¸è¿œæŒç»­ä¸‹å»ï¼‰ï¼Œå…è®¸æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éšæ„å‘é€æ•°æ®ï¼Œå¼€é”€æœ€å°ã€‚\nWebSocket æŠ€æœ¯ç”±ä¸¤ä¸ªæ ¸å¿ƒæ„å»ºå—ç»„æˆï¼š\nWebSocket åè®®ã€‚ WebSocket APIã€‚ WebSocketçš„å†å²æ˜¯ä»€ä¹ˆï¼Ÿ ç¬¬ä¸€ä¸ªå®æ—¶ Web åº”ç”¨ç¨‹åºå¼€å§‹å‡ºç°åœ¨ 2000 å¹´ä»£ï¼Œè¯•å›¾æä¾›å“åº”è¿…é€Ÿã€åŠ¨æ€å’Œäº¤äº’å¼çš„æœ€ç»ˆç”¨æˆ·ä½“éªŒã€‚ç„¶è€Œï¼Œåœ¨é‚£ä¸ªæ—¶å€™ï¼Œå®æ—¶ç½‘ç»œå¾ˆéš¾å®ç°ï¼Œè€Œä¸”æ¯”æˆ‘ä»¬ç°åœ¨ä¹ æƒ¯çš„è¦æ…¢;å®ƒæ˜¯é€šè¿‡å…¥ä¾µç°æœ‰çš„åŸºäºHTTPçš„æŠ€æœ¯ï¼ˆAJAXå’ŒCometï¼‰æ¥å®ç°çš„ï¼Œè¿™äº›æŠ€æœ¯ä¸æ˜¯ä¸ºå®æ—¶åº”ç”¨ç¨‹åºè®¾è®¡å’Œä¼˜åŒ–çš„ã€‚å¾ˆæ˜æ˜¾ï¼Œéœ€è¦ä¸€ä¸ªæ›´å¥½çš„æ›¿ä»£æ–¹æ¡ˆã€‚\nåœ¨ 2008 å¹´ï¼Œå¼€å‘äººå‘˜ Michael Carter å’Œ Ian Hickson ç‰¹åˆ«æ•é”åœ°æ„Ÿå—åˆ°äº†åœ¨å®ç°ä»»ä½•ç±»ä¼¼å®æ—¶çš„ä¸œè¥¿æ—¶ä½¿ç”¨ AJAX å’Œ Comet çš„ç—›è‹¦å’Œå±€é™æ€§ã€‚é€šè¿‡åœ¨ IRC å’Œ W3C é‚®ä»¶åˆ—è¡¨ä¸Šçš„åˆä½œï¼Œä»–ä»¬æå‡ºäº†ä¸€ä¸ªè®¡åˆ’ï¼Œä¸ºç½‘ç»œä¸Šçš„ç°ä»£ã€çœŸæ­£çš„å®æ—¶é€šä¿¡å¼•å…¥ä¸€ä¸ªæ–°æ ‡å‡†ã€‚å› æ­¤ï¼Œâ€œWebSocketâ€è¿™ä¸ªåå­—è¢«åˆ›é€ å‡ºæ¥ã€‚\nä»€ä¹ˆæ˜¯ WebSocket åè®®ï¼Ÿ WebSocket åè®®æ”¯æŒ Web å®¢æˆ·ç«¯å’Œ Web æœåŠ¡å™¨ä¹‹é—´é€šè¿‡åŸºç¡€ TCP è¿æ¥è¿›è¡ŒæŒç»­çš„å…¨åŒå·¥åŒå‘é€šä¿¡ã€‚è¯¥åè®®æ—¨åœ¨å…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å®æ—¶é€šä¿¡ï¼Œä»è€Œåœ¨ Web åº”ç”¨ç¨‹åºä¸­å®ç°é«˜æ•ˆä¸”å“åº”è¿…é€Ÿçš„æ•°æ®ä¼ è¾“ã€‚\n2011 å¹´ 12 æœˆï¼Œäº’è”ç½‘å·¥ç¨‹ä»»åŠ¡ç»„ ï¼ˆIETFï¼‰ é€šè¿‡ RFC 6455 å¯¹ WebSocket åè®®è¿›è¡Œäº†æ ‡å‡†åŒ–ã€‚äº’è”ç½‘å·ç åˆ†é…æœºæ„ ï¼ˆIANAï¼‰ ä¸ IETF åè°ƒç»´æŠ¤ WebSocket åè®®æ³¨å†Œç®¡ç†æœºæ„ï¼Œè¯¥æ³¨å†Œç®¡ç†æœºæ„å®šä¹‰äº†åè®®ä½¿ç”¨çš„è®¸å¤šä»£ç å’Œå‚æ•°æ ‡è¯†ç¬¦ã€‚\nä»€ä¹ˆæ˜¯ WebSocket APIï¼Ÿ WebSocket API åŒ…å«åœ¨ HTML Living Standard ä¸­ï¼Œæ˜¯ä¸€ä¸ªç¼–ç¨‹æ¥å£ï¼Œç”¨äºåˆ›å»º WebSocket è¿æ¥å¹¶ç®¡ç† Web åº”ç”¨ç¨‹åºä¸­å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®äº¤æ¢ã€‚å®ƒä¸ºå¼€å‘äººå‘˜æä¾›äº†ä¸€ç§ç®€å•ä¸”æ ‡å‡†åŒ–çš„æ–¹æ³•ï¼Œå¯ä»¥åœ¨å…¶åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ WebSocket åè®®ã€‚","title":"[è¯‘]WebSocket APIå’Œåè®®è¯´æ˜"},{"content":"åŸæ–‡é“¾æ¥ï¼šhttps://ably.com/topic/websocket-vs-rest\næ— è®ºæ‚¨æ˜¯å°†å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨ã€å°†å¾®æœåŠ¡ç›¸äº’è¿æ¥ï¼Œè¿˜æ˜¯å°†åº”ç”¨ç¨‹åºçš„ä¸€éƒ¨åˆ†è¿æ¥åˆ°å¤–éƒ¨æœåŠ¡ï¼Œåœ¨é€šä¿¡æ–¹æ³•æ–¹é¢ï¼Œæ‚¨å‡ ä¹éƒ½ä¼šæœ‰å¤šç§é€‰æ‹©ã€‚ä¸è¿‡ï¼Œæœ‰ä¸¤ä¸ªæ¯”è¾ƒçªå‡ºï¼šWebSocket å’Œ RESTã€‚\nå¥½æ¶ˆæ¯æ˜¯ï¼Œå°½ç®¡ä¸ºåº”ç”¨ç¨‹åºé€‰æ‹©æ ¸å¿ƒæŠ€æœ¯æ˜¯ä¸€é¡¹ä¸¥è‚ƒçš„è´£ä»»ï¼Œä½†ç”±äº WebSocket å’Œ REST ä¸åŒçš„æ¶æ„é€‰æ‹©ã€æ€§èƒ½ç‰¹å¾å’Œå®ç°è€ƒè™‘å› ç´ ï¼Œåœ¨ WebSocket å’Œ REST ä¹‹é—´è¿›è¡Œé€‰æ‹©ç›¸å¯¹ç®€å•ã€‚è¿™æ„å‘³ç€åŒæ–¹éƒ½å¯ä»¥è§£å†³å¯¹æ–¹å¯èƒ½é‡åˆ°çš„é—®é¢˜ã€‚\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†é˜æ˜ REST ä¸ WebSocketï¼Œæ¶µç›–ï¼š\nå›é¡¾ä¸€ä¸‹ REST å’Œ WebSocket æ˜¯ä»€ä¹ˆ ä»–ä»¬çš„æŠ€æœ¯æƒè¡¡ï¼ŒåŒ…æ‹¬ WebSocket ä¸ REST æ€§èƒ½ ä½•æ—¶åº”è¯¥ä½¿ç”¨ REST ä»¥åŠä½•æ—¶ WebSocket æ˜¯æ›´å¥½çš„é€‰æ‹© å¦‚æœæ‚¨ä½¿ç”¨ä»»ä¸€åè®®ï¼Œåˆ™éœ€è¦å¡«è¡¥ä¸€äº›ç©ºç™½ã€‚ ä½†å¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾å¿«é€Ÿæ‘˜è¦ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦äº†è§£ä»¥ä¸‹å†…å®¹ï¼š\nå½“æ‚¨éœ€è¦è½»æ¾æ‰©å±•çš„åŸºç¡€æ¶æ„æ¥è¿›è¡Œæ— çŠ¶æ€ CRUD æ“ä½œå¹¶ä¸”æ‚¨å¸Œæœ›åšæŒä½¿ç”¨æ ‡å‡† Web å·¥å…·æ—¶ï¼ŒREST æ˜¯ç†æƒ³çš„é€‰æ‹©ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æ­£åœ¨æ„å»ºä¸€ä¸ª API æ¥å°†æ›´æ–°å‘å¸ƒåˆ°ç¤¾äº¤ç½‘ç»œ å½“æ‚¨éœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œå®æ—¶ã€åŒå‘ã€ä½å»¶è¿Ÿé€šä¿¡æ—¶ï¼ŒWebSocket æ˜¯æ­£ç¡®çš„é€‰æ‹©ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æ­£åœ¨æ„å»ºèŠå¤©åº”ç”¨ç¨‹åºã€‚ ä»€ä¹ˆæ˜¯RESTï¼Ÿ è¡¨è¿°æ€§çŠ¶æ€ä¼ è¾“ (REST) æ˜¯ä¸€ç»„åŸåˆ™ï¼Œå®šä¹‰äº†é€šè¿‡ HTTP æ„å»º API çš„ä¸€ç§æ–¹æ³•ã€‚è¿™å¾ˆå®¹æ˜“è¢«å¿½è§†ï¼Œä½† REST ä¸æ˜¯ä¸€ç§åè®®ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥éå¸¸çµæ´»åœ°æ ¹æ®æ‚¨çš„éœ€æ±‚æ¥å¡‘é€ å®ƒã€‚å®ƒçš„æµè¡Œå¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯ç”±äºå®ƒçš„ç®€å•æ€§ä»¥åŠå®ƒé‡ç”¨äº†å·²ç»ç”¨äºç½‘ç»œçš„æ–¹æ³•å’ŒæŠ€æœ¯ã€‚è¿™åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå®šä¹‰äº†å®ƒè¡¨ç°è‰¯å¥½çš„ç”¨ä¾‹ä»¥åŠæ‚¨éœ€è¦å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆçš„ç”¨ä¾‹ã€‚\nè®©æˆ‘ä»¬å¿«é€Ÿäº†è§£ä¸€ä¸‹ REST ä¸å…¶ä»–æ–¹æ³•çš„åŒºåˆ«ã€‚\nREST çš„ä¸»è¦ç‰¹å¾ **æ— çŠ¶æ€ï¼š**å¯¹ REST API å‘å‡ºçš„æ¯ä¸ªè¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹ä¸”è‡ªåŒ…å«çš„ã€‚è¿™ä½¿å¾—æ‰©å±•å˜å¾—æ›´åŠ ç®€å•ã€‚å½“æµé‡å¢åŠ æ—¶ï¼Œæ‚¨å¯ä»¥åœ¨è´Ÿè½½å‡è¡¡å™¨åé¢æ·»åŠ æ›´å¤šæœåŠ¡å™¨ï¼Œå› ä¸ºç‰¹å®šå®¢æˆ·ç«¯ä¸éœ€è¦æ¯æ¬¡éƒ½è¿æ¥åˆ°åŒä¸€å°æœåŠ¡å™¨ã€‚å°½ç®¡ HTTP å’Œ REST æ˜¯æ— çŠ¶æ€çš„ï¼Œä½†æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨å®¢æˆ·ç«¯ cookie æ¥è·Ÿè¸ªä¼šè¯å’Œç™»å½•çŠ¶æ€æ¥ç»´æŠ¤é•¿æ—¶é—´è¿è¡Œçš„ä¼šè¯ã€‚ **CRUDï¼š**æ¯ä¸ª REST è¯·æ±‚éƒ½ä½¿ç”¨æ ‡å‡† HTTP åŠ¨è¯ï¼ˆGETã€POSTã€PUTã€PATCH å’Œ DELETEï¼‰ï¼Œä¸åˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤æ“ä½œå¯¹é½ã€‚ æœ‰æ•ˆè´Ÿè½½æ ¼å¼ï¼š REST é€šå¸¸ä½¿ç”¨ JSON æˆ– XML ç­‰æ ‡å‡†åŒ–æ¶ˆæ¯æ ¼å¼è¿›è¡Œæ•°æ®äº¤æ¢ã€‚ä½†æ˜¯æ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½•æ‚¨å–œæ¬¢çš„æ•°æ®æ ¼å¼ï¼Œåªè¦æ‚¨è®¾ç½®æ­£ç¡®çš„Content-Typeæ ‡å¤´å³å¯ã€‚ **å¯ç¼“å­˜ï¼š**æ‚¨å¯ä»¥é€‰æ‹©å…è®¸å®¢æˆ·ç«¯å’Œä¸­é—´åŸºç¡€è®¾æ–½ç¼“å­˜å“åº”ã€‚è¿™æœ‰åŠ©äºæ‰©å±•å’Œå“åº”æ—¶é—´ã€‚ åŒæ­¥ï¼š REST æ‰€ä¾èµ–çš„ HTTP è¯·æ±‚-å“åº”å‘¨æœŸæœ€é€‚åˆçŸ­æš‚ã€ç®€å•çš„äº‹åŠ¡ï¼Œå…¶ä¸­å®¢æˆ·ç«¯åœ¨ç»§ç»­ä¸‹ä¸€ä¸ªä»»åŠ¡ä¹‹å‰ç­‰å¾…å“åº”ã€‚ ä»€ä¹ˆæ˜¯ WebSocketï¼Ÿ REST é€‚ç”¨äºçŸ­æš‚ã€æ— çŠ¶æ€çš„é€šä¿¡ï¼Œè€Œ WebSocket åˆ™æä¾›æŒç»­ã€ä½å»¶è¿Ÿçš„åŒå‘é€šä¿¡é€šé“ã€‚è¿™æ„å‘³ç€æ‚¨ä¸ WebSocket äº¤äº’çš„æ–¹å¼æ˜¯ä¸åŒçš„ã€‚å› æ­¤ï¼Œæ‚¨æ— éœ€ä½¿ç”¨ç‰¹å®šç«¯ç‚¹æ„å»ºâ€œWebSocket APIâ€ï¼Œè€Œæ˜¯æ‰“å¼€ä¸€ä¸ªè¿æ¥ï¼ŒåŒæ–¹å¯ä»¥åœ¨éœ€è¦æ—¶äº¤æ¢æ¶ˆæ¯ã€‚è¿™ä½¿å…¶æˆä¸ºå®æ—¶åº”ç”¨ç¨‹åºçš„ç†æƒ³é€‰æ‹©ï¼Œä¾‹å¦‚èŠå¤©ã€ä½“è‚²æˆ–é‡‘èæ•°æ®çš„å®æ—¶æµåª’ä½“ï¼Œä»¥åŠ Figmaã€Miro å’Œ Google Docs ç­‰äº¤äº’å¼å®æ—¶åä½œç¯å¢ƒã€‚\nWebSocket å…³é”®ç‰¹æ€§ **æŒä¹…è¿æ¥ï¼š**æ¯ä¸ª REST è¯·æ±‚éƒ½éœ€è¦æ–°çš„ HTTP è¿æ¥ï¼Œè¿™ä¼šç”±äº HTTP æ¡æ‰‹çš„å¼€é”€è€Œå¢åŠ å»¶è¿Ÿã€‚ WebSocket æ‰“å¼€ä¸€æ¬¡è¿æ¥ï¼Œç„¶åæ ¹æ®éœ€è¦å°†å…¶ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œä»è€Œå‡å°‘å‘é€æ¶ˆæ¯æ‰€éœ€çš„æ—¶é—´ã€‚ æœ‰çŠ¶æ€ï¼š WebSocket çš„æŒä¹…è¿æ¥æ„å‘³ç€å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥è·Ÿè¸ªä¹‹å‰å‘ç”Ÿçš„æƒ…å†µï¼Œè€Œä¸å¿…åƒ REST é‚£æ ·ä½¿ç”¨ cookie æ¥è·Ÿè¸ªçŠ¶æ€ã€‚ **å…¨åŒå·¥é€šä¿¡ï¼š**å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯éƒ½å¯ä»¥åœ¨éœ€è¦æ—¶åŒæ—¶å‘é€æ•°æ®ã€‚åœ¨ REST ä¸­ï¼Œåªæœ‰å®¢æˆ·ç«¯æ‰èƒ½å‘èµ·æ–°è¿æ¥ã€‚ æœ‰æ•ˆè´Ÿè½½æ ¼å¼ï¼š WebSocket é€‚ç”¨äºç¦»æ•£æ¶ˆæ¯ï¼Œä¾‹å¦‚ JSON å¯¹è±¡æˆ– Protobuf æ¶ˆæ¯ã€‚è¿™ä¸å‘é€æ’å®šå­—èŠ‚æµçš„æµåª’ä½“æ ¼å¼å½¢æˆé²œæ˜å¯¹æ¯”ã€‚é‡è¦çš„æ˜¯ï¼ŒWebSocket å…è®¸æ‚¨å‘é€æ–‡æœ¬æˆ–äºŒè¿›åˆ¶æ•°æ®ï¼Œå¹¶ä¸”ç”±æ‚¨æ¥å¤„ç†è¯¥æ•°æ®çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚ å®æ—¶ï¼š WebSocket å°½å¯èƒ½å‡å°‘å»¶è¿Ÿã€‚æŒä¹…è¿æ¥å’Œå°æ ‡å¤´ï¼ˆä½è‡³ä¸¤ä¸ªå­—èŠ‚ï¼‰éƒ½æœ‰å¸®åŠ©ã€‚ WebSocket ä¸ REST æ¦‚è§ˆ æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼ŒWebSocket å’Œ REST çš„è®¾è®¡å¯¼è‡´å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„è¿æ¥æ–¹å¼æˆªç„¶ä¸åŒã€‚è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹å®ƒä»¬çš„ä¸ä¼—ä¸åŒä¹‹å¤„ã€‚\nä¼‘æ¯ WebSocket æ²Ÿé€šæ¨¡å¼ è¯·æ±‚-å“åº” åŸºäºäº‹ä»¶ çŠ¶æ€æ€§ æ— å›½ç± æœ‰çŠ¶æ€çš„ å¯æ‰©å±•æ€§ æ˜“äºæ‰©å±• è§„æ¨¡æ›´å¤æ‚ æ•°æ®æ ¼å¼ äºŒè¿›åˆ¶æˆ–æ–‡æœ¬ äºŒè¿›åˆ¶æˆ–æ–‡æœ¬ é«˜æ¶ æ›´é«˜ï¼Œå› ä¸ºæ¯æ¬¡äº¤äº’éƒ½éœ€è¦æ–°çš„è¿æ¥ åˆæ¬¡æ¡æ‰‹åé™ä½ ç”¨ä¾‹ CRUD APIï¼Œç¦»æ•£æ•°æ®å•å…ƒçš„æ— çŠ¶æ€ä¼ è¾“ å®æ—¶åä½œã€èŠå¤©ã€æ•°æ®å¹¿æ’­ã€æŒç»­æ•°æ®ä¼ è¾“ æˆ‘åº”è¯¥ä½¿ç”¨ WebSocket è¿˜æ˜¯ RESTï¼Ÿ åœ¨è€ƒè™‘ WebSocket å’Œ REST ä¹‹é—´çš„å·®å¼‚æ—¶ï¼Œäº†è§£æŠ€æœ¯èƒ½åŠ›æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚ä½†å½“æˆ‘ä»¬æŸ¥çœ‹ç”¨ä¾‹æ—¶ï¼Œäº‹æƒ…å˜å¾—éå¸¸æœ‰è¶£ã€‚æ‚¨åº”è¯¥é€‰æ‹© WebSocket è¿˜æ˜¯ REST çš„é—®é¢˜å®Œå…¨å–å†³äºæ‚¨æƒ³è¦è§£å†³çš„é—®é¢˜ã€‚æ‚¨æœ€ç»ˆå¯èƒ½ä¼šå¾—åˆ°ä¸¤è€…çš„æ··åˆã€‚\næˆ‘ä»¬ä»¥æ‰‹æœºé“¶è¡Œåº”ç”¨ç¨‹åºä¸ºä¾‹ã€‚å…¶å¤§éƒ¨åˆ†å®¢æˆ·ç«¯-æœåŠ¡å™¨é€šä¿¡ï¼ˆä¾‹å¦‚ä»˜æ¬¾ï¼‰æœ€é€‚åˆ REST APIã€‚æ”¶æ¬¾äººè¯¦ç»†ä¿¡æ¯ã€ä»˜æ¬¾é‡‘é¢å’Œç›¸å…³æ•°æ®éå¸¸é€‚åˆè¯·æ±‚-å“åº”æ¨¡å‹ã€‚\nä½†å‡è®¾æ‚¨è¿˜æƒ³å°†å®æ—¶å®¢æˆ·æœåŠ¡èŠå¤©æ·»åŠ åˆ°é“¶è¡Œåº”ç”¨ç¨‹åºä¸­ã€‚ä»…å°±è¯¥åŠŸèƒ½è€Œè¨€ï¼ŒWebSocket å°†æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚æŒä¹…ã€æœ‰çŠ¶æ€çš„è¿æ¥å’Œä½å»¶è¿Ÿäº¤ä»˜ä½¿å…¶éå¸¸é€‚åˆäº¤äº’å¼å®æ—¶é€šä¿¡ã€‚\næ‰€ä»¥ï¼Œä¹Ÿè®¸é—®é¢˜åº”è¯¥æ˜¯ï¼šâ€œæˆ‘å¯ä»¥åŒæ—¶ä½¿ç”¨ REST å’Œ WebSocket å—ï¼Ÿâ€ã€‚ç­”æ¡ˆæ˜¯åšå®šçš„â€œæ˜¯â€ã€‚äº‹å®ä¸Šï¼Œæ ¹æ®å½“å‰çš„é—®é¢˜åœ¨åŒä¸€åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ä¸åŒçš„é€šä¿¡æ–¹æ³•æ˜¯å¾ˆå¸¸è§çš„ã€‚\nWebSocket ä¸ REST ç”¨ä¾‹ ä¸ºäº†å¼€å§‹æ€è€ƒåº”è¯¥åœ¨å“ªé‡Œä½¿ç”¨ REST ä»¥åŠåœ¨å“ªé‡Œåº”è¯¥ä½¿ç”¨ WebSocketï¼Œè®©æˆ‘ä»¬æ¯”è¾ƒä¸€ä¸‹å®ƒä»¬å¯¹ä¸€äº›å¸¸è§åœºæ™¯çš„é€‚ç”¨æ€§ã€‚\nä½¿ç”¨æ¡ˆä¾‹ ä¼‘æ¯ WebSocket èŠå¤© æ•ˆç‡ä½ä¸‹ï¼Œå› ä¸ºå®ƒéœ€è¦é¢‘ç¹çš„æ‰‹åŠ¨è½®è¯¢æˆ–é•¿è½®è¯¢ç­‰è§£å†³æ–¹æ³•ã€‚ å…·æœ‰ä½å»¶è¿Ÿçš„æŒä¹…åŒå‘è¿æ¥éå¸¸é€‚åˆ WebSocket èŠå¤©ã€‚ åœ¨çº¿æ¸¸æˆ ä¸é€‚åˆï¼Œå› ä¸ºå¤šä¸ªè¯·æ±‚-å“åº”å‘¨æœŸçš„å¼€é”€ä¼šå¢åŠ å¤ªå¤šçš„å»¶è¿Ÿã€‚ æ›´å¥½åœ°åŒ¹é…å‚ä¸åœ¨çº¿æ¸¸æˆçš„å¤šä¸ªç©å®¶çš„å®æ—¶æ›´æ–°ã€‚ æ•°æ®æ›´æ–° é€‚ç”¨äºä¸é¢‘ç¹æ›´æ–°ï¼Œå…¶ä¸­ç«‹å³æ•°æ®åˆ·æ–°å¹¶ä¸é‡è¦ã€‚ éå¸¸é€‚åˆæ›´æ–°å¯¹æ—¶é—´æ•æ„Ÿçš„ä»ªè¡¨æ¿ã€ä½“è‚²æ•°æ®å’Œè´¢åŠ¡æ•°æ®ã€‚ å®æ—¶åä½œ ä¸åˆ‡å®é™…ï¼Œå› ä¸ºå»¶è¿Ÿå¤ªé«˜ï¼Œè€Œä¸” REST ç¼ºä¹æœåŠ¡å™¨å¯åŠ¨æ¶ˆæ¯ä¼ è¾“çš„æ–¹æ³•ï¼Œæ²¡æœ‰è§£å†³æ–¹æ³•ã€‚ åŒå‘å³æ—¶åŒæ­¥æ„å‘³ç€æ‰€æœ‰å‚ä¸è€…çš„æ›´æ”¹ä¼šåŒæ—¶å…±äº«ã€‚ æœåŠ¡æ•´åˆ éå¸¸é€‚åˆé›†æˆåŸºäºæ— çŠ¶æ€äº¤äº’çš„ç¬¬ä¸‰æ–¹æœåŠ¡ï¼Œä¾‹å¦‚æ”¯ä»˜å¤„ç†ã€‚ ä¸å¤ªé€‚åˆï¼Œå› ä¸ºå¯¹æŒä¹…è¿æ¥çš„éœ€æ±‚è¾ƒå°‘ å…¬å…±API è¿™å°±æ˜¯ REST çš„ä¼˜åŠ¿æ‰€åœ¨ï¼Œå› ä¸ºå®ƒå¯ä»¥ä½¿ç”¨æ ‡å‡† Web å·¥å…·è½»æ¾éƒ¨ç½²ã€‚ ä¸å¤ªé€‚åˆï¼Œå› ä¸ºæ²¡æœ‰èµ„æºå‘ç°æœºåˆ¶ï¼Œè€Œä¸”æ›´éš¾æ‰©å±•ã€‚ ç‰©è”ç½‘è®¾å¤‡é€šä¿¡ å¦‚æœè®¾å¤‡éœ€è¦å®šæœŸå‘é€æ•°æ®æˆ–ç”±çŠ¶æ€æ›´æ”¹è§¦å‘ï¼Œåˆ™ REST å¯èƒ½é€‚åˆã€‚ç„¶è€Œï¼Œå®ƒé™åˆ¶äº†å•å‘é€šä¿¡ï¼Œå¹¶ä¸”æœ‰æ›´å¥½çš„é€‰æ‹©ã€‚ éå¸¸é€‚åˆéœ€è¦ä¸ç‰©è”ç½‘ç½‘ç»œå…¶ä½™éƒ¨åˆ†è¿›è¡ŒæŒç»­åŒå‘é€šä¿¡çš„è®¾å¤‡ã€‚ å°½ç®¡æŒ‰ç”¨ä¾‹è¿›è¡Œæ€è€ƒå¾ˆæœ‰å¸®åŠ©ï¼Œä½†æ‚¨å¯ä»¥åº”ç”¨ä¸€æ¡é€šç”¨è§„åˆ™æ¥å†³å®šåœ¨ä½•å¤„ä½¿ç”¨ WebSocket ä»¥åŠåœ¨ä½•å¤„ä½¿ç”¨ RESTã€‚å¯¹äºå®æ—¶é€šä¿¡ï¼Œè¯·ä½¿ç”¨ WebSocketã€‚å¯¹äºè¯·æ±‚é©±åŠ¨çš„äº¤äº’ï¼ˆä¾‹å¦‚å…¸å‹çš„ CRUD æ“ä½œï¼‰ï¼ŒREST æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚\nREST API å¯ä»¥ä½¿ç”¨ WebSocket å—ï¼Ÿ REST çš„çµæ´»æ€§æ„å‘³ç€æ‚¨å¯ä»¥ç²¾ç¡®é€‰æ‹©å¦‚ä½•å®ç° REST APIã€‚ä¾‹å¦‚ï¼Œä¸å…¶ä»–åè®®ç›¸æ¯”ï¼ŒHTTP çš„å»¶è¿Ÿå¯èƒ½ä¼šè®©æ‚¨æ„Ÿåˆ°æ²®ä¸§ã€‚ä½ èƒ½æŠŠå®ƒæ¢æˆ WebSocket å—ï¼Ÿç†è®ºä¸Šï¼Œä½ å¯ä»¥ã€‚ SwaggerSocketå¼€æºé¡¹ç›®è¯•å›¾åšåˆ°è¿™ä¸€ç‚¹ã€‚ä½† REST å’Œ HTTP å¯ä»¥å¾ˆå¥½åœ°ç»“åˆåœ¨ä¸€èµ·ï¼Œå› ä¸ºå®ƒä»¬éƒ½æ˜¯å›´ç»•è¯·æ±‚-å“åº”æ¨¡å‹è®¾è®¡çš„ã€‚ WebSocket çš„æœ‰çŠ¶æ€ã€åŸºäºäº‹ä»¶çš„æ¨¡å‹æ„å‘³ç€å®ƒä¸æ˜¯ä¸€å¯¹ä¸€çš„æ›¿ä»£å“ã€‚å¦‚æœæ‚¨æƒ³è¦è§£å†³çš„é—®é¢˜éœ€è¦ RESTï¼Œé‚£ä¹ˆå°±ä½¿ç”¨ RESTã€‚\nç”¨äºæ„å»º REST å’Œ WebSocket åŸºç¡€è®¾æ–½çš„é€‰é¡¹ åœ¨ WebSocket å’Œ REST ä¹‹é—´è¿›è¡Œé€‰æ‹©å®é™…ä¸Šåªæ˜¯ç¬¬ä¸€æ­¥ã€‚è¯·è®°ä½ï¼Œå®ƒä»¬éƒ½æ²¡æœ‰å‘Šè¯‰æ‚¨å¤ªå¤šæœ‰å…³è¿è¡Œå®ƒä»¬æ‰€éœ€çš„åŸºç¡€è®¾æ–½çš„ä¿¡æ¯ã€‚å¯¹äº RESTï¼Œæ„å»ºå¯æ‰©å±•çš„ HTTP åç«¯å‡ ä¹æ˜¯ä¸€ä¸ªå·²è§£å†³çš„é—®é¢˜ã€‚ä½† WebSocket çš„æƒ…å†µå¹¶éå¦‚æ­¤ã€‚æŒä¹…çš„ã€æœ‰çŠ¶æ€çš„è¿æ¥ä¼šå¢åŠ æœåŠ¡å™¨çš„è´Ÿè½½å¹¶ä½¿æ‰©å±•å˜å¾—å¤æ‚ã€‚\nå€¼å¾—åº†å¹¸çš„æ˜¯ï¼Œæœ‰å„ç§å„æ ·çš„åº“ã€æ¡†æ¶å’Œæ‰˜ç®¡æœåŠ¡å¯ç”¨äºç®€åŒ–åº”ç”¨ç¨‹åºåç«¯çš„æ„å»ºå’Œç®¡ç†ã€‚å®ƒä»¬å¾€å¾€åˆ†ä¸ºå››ç±»ï¼š\n**æ‰˜ç®¡æ‚¨è‡ªå·±çš„åç«¯ï¼š**å°½ç®¡æ‚¨æ‰¿æ‹…äº†é¢å¤–çš„ DevOps è´Ÿæ‹…ï¼Œä½†æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ä¹‹ä¸€æ‰˜ç®¡æ‚¨è‡ªå·±çš„ WebSocket åç«¯ï¼š **çº¯ WebSocket åº“ï¼š**å¤§å¤šæ•°è¯­è¨€éƒ½æœ‰ WebSocket åè®®çš„å®˜æ–¹æˆ–åŠå®˜æ–¹å®ç°ã€‚ä¾‹å¦‚ï¼Œâ€œwsâ€ä»£è¡¨ NodeJSã€‚å®ƒä»¬ä¸ºæ‚¨æä¾›ä½çº§ WebSocket åŠŸèƒ½ï¼Œå¦‚æœæ‚¨åªæƒ³è¦è½»é‡çº§å®ç°æˆ–è€…ç¡®å®éœ€è¦åˆ›å»ºè‡ªå®šä¹‰è§£å†³æ–¹æ¡ˆï¼Œé‚£ä¹ˆè¿™äº›åŠŸèƒ½å¯èƒ½ä¼šå¾ˆå¥½ã€‚ **åŠŸèƒ½é½å…¨çš„æ¶ˆæ¯ä¼ é€’åº“ï¼š**æ›´é«˜ä¸€çº§çš„æ˜¯æ¶ˆæ¯ä¼ é€’åº“ï¼Œä¾‹å¦‚ç”¨äº .NET çš„ SignalR æˆ–ç”¨äº NodeJS çš„ Socket.IOã€‚ä»–ä»¬è´Ÿè´£å¤„ç†æ›´å¤šé—®é¢˜ï¼Œä¾‹å¦‚è‡ªåŠ¨é‡æ–°è¿æ¥ã€‚ ä½¿ç”¨æ¡†æ¶ï¼š Spring Boot for Java æœ¬èº«ä¹Ÿæ”¯æŒ WebSocketã€‚ **ä½¿ç”¨ä¸“é—¨çš„æ‰˜ç®¡æœåŠ¡ï¼š**æ ¹æ®æ‚¨çš„ä½¿ç”¨æ¡ˆä¾‹ï¼Œå¯èƒ½ä¼šæœ‰ä¸€ç§è½¯ä»¶å³æœåŠ¡äº§å“æä¾›ä¸“é—¨çš„ WebSocket åç«¯ã€‚ä¾‹å¦‚ï¼ŒèŠå¤© SaaS API å¾ˆå¸¸è§ã€‚ä½†æ˜¯ï¼Œæ‚¨éœ€è¦ç†Ÿæ‚‰ä¾›åº”å•†æ‰€åšçš„è®¾è®¡é€‰æ‹©ã€‚ ä½¿ç”¨åç«¯å³æœåŠ¡ (BaaS)ï¼š Firebase å’Œ Supabase ç­‰å¹³å°æä¾›åŸºäº WebSocket æ„å»ºçš„æœ‰é™å®æ—¶åŠŸèƒ½ã€‚ç„¶è€Œï¼Œé€šå¸¸ç¼ºä¹å¯æ‰©å±•æ€§å’Œæ¶ˆæ¯ä¿è¯ã€‚ **ä½¿ç”¨å®æ—¶å¹³å°å³æœåŠ¡ (PaaS)ï¼š**å¯¹äºå¯é æ€§ã€æ•°æ®å®Œæ•´æ€§å’Œå¯æ‰©å±•æ€§å¾ˆé‡è¦çš„åº”ç”¨ç¨‹åºï¼Œæ‚¨åº”è¯¥è€ƒè™‘ä½¿ç”¨ä¸“ç”¨çš„å®æ—¶ PaaSã€‚ Ably çš„å®æ—¶ PaaS å¯å¸®åŠ©æ‚¨æ›´å¿«åœ°è¿›å…¥å¸‚åœºï¼Œä¸ºæ‚¨æä¾›å…¨çƒæ‰˜ç®¡åŸºç¡€æ¶æ„ï¼Œå¹¶æä¾›é™¤çº¯ WebSocket ä¹‹å¤–çš„ä¸°å¯ŒåŠŸèƒ½ã€‚ å€ŸåŠ© Ablyï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºå¯ä»¥åˆ©ç”¨ï¼š\n**å…¨çƒè¾¹ç¼˜ç½‘ç»œï¼š**æ— è®ºæ‚¨çš„åº”ç”¨ç¨‹åºçš„ç”¨æˆ·ä½äºä¸–ç•Œä½•å¤„ï¼ŒAblly è¾¹ç¼˜ä½ç½®éƒ½å¯ç¡®ä¿æ•´ä¸ªç½‘ç»œçš„å»¶è¿Ÿä½äº 65 æ¯«ç§’ã€‚åœ¨ ä¸ä»…ä»…æ˜¯ WebSocketï¼š Ably å¯ä»¥æ ¹æ®æ‚¨çš„åº”ç”¨ç¨‹åºéœ€æ±‚å’Œç½‘ç»œæ¡ä»¶é€‰æ‹©æ­£ç¡®çš„åè®®ï¼Œä» WebSocketã€æœåŠ¡å™¨å‘é€äº‹ä»¶å’Œ MQTT ç­‰é€‰é¡¹ä¸­è¿›è¡Œé€‰æ‹©ã€‚ å¼¹æ€§äº¤ä»˜ï¼š Aly ä¿è¯æ¶ˆæ¯æŒ‰é¡ºåºæŒ‰æ—¶åˆ°è¾¾ã€‚ 99.999% çš„æ­£å¸¸è¿è¡Œæ—¶é—´ï¼š Ably çš„ç½‘ç»œå¯ä»¥ç»•è¿‡æ•…éšœï¼Œç¡®ä¿æ‚¨çš„åº”ç”¨ç¨‹åºæŒç»­äº¤ä»˜ã€‚ **æ‰©å±•ä»¥æ»¡è¶³éœ€æ±‚ï¼š**éšç€éœ€æ±‚çš„å¢é•¿ï¼ŒAblly çš„æ¶ˆæ¯æ•°é‡ä»æ•°åƒæ¡æ‰©å±•åˆ°æ•°åäº¿æ¡ã€‚ **æ— è®ºæ‚¨çš„æŠ€æœ¯å †æ ˆå¦‚ä½•ï¼Œéƒ½èƒ½è·å¾—å‡ºè‰²çš„å¼€å‘äººå‘˜ä½“éªŒï¼š**å‡­å€Ÿé€‚ç”¨äºè¶…è¿‡ 25 ç§è¯­è¨€å’Œæ¡†æ¶çš„ SDKã€ä¸å¸¸ç”¨å·¥å…·çš„é›†æˆä»¥åŠè¡Œä¸šé¢†å…ˆçš„æ–‡æ¡£ï¼ŒAbly ä¸ºæ‚¨æä¾›äº†å¿«é€Ÿæé«˜ç”Ÿäº§åŠ›çš„å·¥å…·ã€‚ ","permalink":"https://blog.chensoul.cc/posts/2024/05/07/websocket-vs-rest/","summary":"åŸæ–‡é“¾æ¥ï¼šhttps://ably.com/topic/websocket-vs-rest\næ— è®ºæ‚¨æ˜¯å°†å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨ã€å°†å¾®æœåŠ¡ç›¸äº’è¿æ¥ï¼Œè¿˜æ˜¯å°†åº”ç”¨ç¨‹åºçš„ä¸€éƒ¨åˆ†è¿æ¥åˆ°å¤–éƒ¨æœåŠ¡ï¼Œåœ¨é€šä¿¡æ–¹æ³•æ–¹é¢ï¼Œæ‚¨å‡ ä¹éƒ½ä¼šæœ‰å¤šç§é€‰æ‹©ã€‚ä¸è¿‡ï¼Œæœ‰ä¸¤ä¸ªæ¯”è¾ƒçªå‡ºï¼šWebSocket å’Œ RESTã€‚\nå¥½æ¶ˆæ¯æ˜¯ï¼Œå°½ç®¡ä¸ºåº”ç”¨ç¨‹åºé€‰æ‹©æ ¸å¿ƒæŠ€æœ¯æ˜¯ä¸€é¡¹ä¸¥è‚ƒçš„è´£ä»»ï¼Œä½†ç”±äº WebSocket å’Œ REST ä¸åŒçš„æ¶æ„é€‰æ‹©ã€æ€§èƒ½ç‰¹å¾å’Œå®ç°è€ƒè™‘å› ç´ ï¼Œåœ¨ WebSocket å’Œ REST ä¹‹é—´è¿›è¡Œé€‰æ‹©ç›¸å¯¹ç®€å•ã€‚è¿™æ„å‘³ç€åŒæ–¹éƒ½å¯ä»¥è§£å†³å¯¹æ–¹å¯èƒ½é‡åˆ°çš„é—®é¢˜ã€‚\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†é˜æ˜ REST ä¸ WebSocketï¼Œæ¶µç›–ï¼š\nå›é¡¾ä¸€ä¸‹ REST å’Œ WebSocket æ˜¯ä»€ä¹ˆ ä»–ä»¬çš„æŠ€æœ¯æƒè¡¡ï¼ŒåŒ…æ‹¬ WebSocket ä¸ REST æ€§èƒ½ ä½•æ—¶åº”è¯¥ä½¿ç”¨ REST ä»¥åŠä½•æ—¶ WebSocket æ˜¯æ›´å¥½çš„é€‰æ‹© å¦‚æœæ‚¨ä½¿ç”¨ä»»ä¸€åè®®ï¼Œåˆ™éœ€è¦å¡«è¡¥ä¸€äº›ç©ºç™½ã€‚ ä½†å¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾å¿«é€Ÿæ‘˜è¦ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦äº†è§£ä»¥ä¸‹å†…å®¹ï¼š\nå½“æ‚¨éœ€è¦è½»æ¾æ‰©å±•çš„åŸºç¡€æ¶æ„æ¥è¿›è¡Œæ— çŠ¶æ€ CRUD æ“ä½œå¹¶ä¸”æ‚¨å¸Œæœ›åšæŒä½¿ç”¨æ ‡å‡† Web å·¥å…·æ—¶ï¼ŒREST æ˜¯ç†æƒ³çš„é€‰æ‹©ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æ­£åœ¨æ„å»ºä¸€ä¸ª API æ¥å°†æ›´æ–°å‘å¸ƒåˆ°ç¤¾äº¤ç½‘ç»œ å½“æ‚¨éœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œå®æ—¶ã€åŒå‘ã€ä½å»¶è¿Ÿé€šä¿¡æ—¶ï¼ŒWebSocket æ˜¯æ­£ç¡®çš„é€‰æ‹©ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æ­£åœ¨æ„å»ºèŠå¤©åº”ç”¨ç¨‹åºã€‚ ä»€ä¹ˆæ˜¯RESTï¼Ÿ è¡¨è¿°æ€§çŠ¶æ€ä¼ è¾“ (REST) æ˜¯ä¸€ç»„åŸåˆ™ï¼Œå®šä¹‰äº†é€šè¿‡ HTTP æ„å»º API çš„ä¸€ç§æ–¹æ³•ã€‚è¿™å¾ˆå®¹æ˜“è¢«å¿½è§†ï¼Œä½† REST ä¸æ˜¯ä¸€ç§åè®®ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥éå¸¸çµæ´»åœ°æ ¹æ®æ‚¨çš„éœ€æ±‚æ¥å¡‘é€ å®ƒã€‚å®ƒçš„æµè¡Œå¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯ç”±äºå®ƒçš„ç®€å•æ€§ä»¥åŠå®ƒé‡ç”¨äº†å·²ç»ç”¨äºç½‘ç»œçš„æ–¹æ³•å’ŒæŠ€æœ¯ã€‚è¿™åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå®šä¹‰äº†å®ƒè¡¨ç°è‰¯å¥½çš„ç”¨ä¾‹ä»¥åŠæ‚¨éœ€è¦å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆçš„ç”¨ä¾‹ã€‚\nè®©æˆ‘ä»¬å¿«é€Ÿäº†è§£ä¸€ä¸‹ REST ä¸å…¶ä»–æ–¹æ³•çš„åŒºåˆ«ã€‚\nREST çš„ä¸»è¦ç‰¹å¾ **æ— çŠ¶æ€ï¼š**å¯¹ REST API å‘å‡ºçš„æ¯ä¸ªè¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹ä¸”è‡ªåŒ…å«çš„ã€‚è¿™ä½¿å¾—æ‰©å±•å˜å¾—æ›´åŠ ç®€å•ã€‚å½“æµé‡å¢åŠ æ—¶ï¼Œæ‚¨å¯ä»¥åœ¨è´Ÿè½½å‡è¡¡å™¨åé¢æ·»åŠ æ›´å¤šæœåŠ¡å™¨ï¼Œå› ä¸ºç‰¹å®šå®¢æˆ·ç«¯ä¸éœ€è¦æ¯æ¬¡éƒ½è¿æ¥åˆ°åŒä¸€å°æœåŠ¡å™¨ã€‚å°½ç®¡ HTTP å’Œ REST æ˜¯æ— çŠ¶æ€çš„ï¼Œä½†æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨å®¢æˆ·ç«¯ cookie æ¥è·Ÿè¸ªä¼šè¯å’Œç™»å½•çŠ¶æ€æ¥ç»´æŠ¤é•¿æ—¶é—´è¿è¡Œçš„ä¼šè¯ã€‚ **CRUDï¼š**æ¯ä¸ª REST è¯·æ±‚éƒ½ä½¿ç”¨æ ‡å‡† HTTP åŠ¨è¯ï¼ˆGETã€POSTã€PUTã€PATCH å’Œ DELETEï¼‰ï¼Œä¸åˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤æ“ä½œå¯¹é½ã€‚ æœ‰æ•ˆè´Ÿè½½æ ¼å¼ï¼š REST é€šå¸¸ä½¿ç”¨ JSON æˆ– XML ç­‰æ ‡å‡†åŒ–æ¶ˆæ¯æ ¼å¼è¿›è¡Œæ•°æ®äº¤æ¢ã€‚ä½†æ˜¯æ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½•æ‚¨å–œæ¬¢çš„æ•°æ®æ ¼å¼ï¼Œåªè¦æ‚¨è®¾ç½®æ­£ç¡®çš„Content-Typeæ ‡å¤´å³å¯ã€‚ **å¯ç¼“å­˜ï¼š**æ‚¨å¯ä»¥é€‰æ‹©å…è®¸å®¢æˆ·ç«¯å’Œä¸­é—´åŸºç¡€è®¾æ–½ç¼“å­˜å“åº”ã€‚è¿™æœ‰åŠ©äºæ‰©å±•å’Œå“åº”æ—¶é—´ã€‚ åŒæ­¥ï¼š REST æ‰€ä¾èµ–çš„ HTTP è¯·æ±‚-å“åº”å‘¨æœŸæœ€é€‚åˆçŸ­æš‚ã€ç®€å•çš„äº‹åŠ¡ï¼Œå…¶ä¸­å®¢æˆ·ç«¯åœ¨ç»§ç»­ä¸‹ä¸€ä¸ªä»»åŠ¡ä¹‹å‰ç­‰å¾…å“åº”ã€‚ ä»€ä¹ˆæ˜¯ WebSocketï¼Ÿ REST é€‚ç”¨äºçŸ­æš‚ã€æ— çŠ¶æ€çš„é€šä¿¡ï¼Œè€Œ WebSocket åˆ™æä¾›æŒç»­ã€ä½å»¶è¿Ÿçš„åŒå‘é€šä¿¡é€šé“ã€‚è¿™æ„å‘³ç€æ‚¨ä¸ WebSocket äº¤äº’çš„æ–¹å¼æ˜¯ä¸åŒçš„ã€‚å› æ­¤ï¼Œæ‚¨æ— éœ€ä½¿ç”¨ç‰¹å®šç«¯ç‚¹æ„å»ºâ€œWebSocket APIâ€ï¼Œè€Œæ˜¯æ‰“å¼€ä¸€ä¸ªè¿æ¥ï¼ŒåŒæ–¹å¯ä»¥åœ¨éœ€è¦æ—¶äº¤æ¢æ¶ˆæ¯ã€‚è¿™ä½¿å…¶æˆä¸ºå®æ—¶åº”ç”¨ç¨‹åºçš„ç†æƒ³é€‰æ‹©ï¼Œä¾‹å¦‚èŠå¤©ã€ä½“è‚²æˆ–é‡‘èæ•°æ®çš„å®æ—¶æµåª’ä½“ï¼Œä»¥åŠ Figmaã€Miro å’Œ Google Docs ç­‰äº¤äº’å¼å®æ—¶åä½œç¯å¢ƒã€‚","title":"[è¯‘]WebSocketä¸REST"},{"content":"ThingsBoardæ˜¯ä¸€ä¸ªå¼€æºçš„ç‰©è”ç½‘å¹³å°ï¼Œç”¨äºç®¡ç†å’Œç›‘æ§ç‰©è”ç½‘è®¾å¤‡å’Œæ•°æ®ã€‚å®ƒæä¾›äº†ä¸€ä¸ªå¯æ‰©å±•çš„æ¶æ„ï¼Œå¯ä»¥è¿æ¥å„ç§è®¾å¤‡ï¼Œå¹¶å®æ—¶æ”¶é›†ã€å¤„ç†å’Œåˆ†æè®¾å¤‡ç”Ÿæˆçš„æ•°æ®ã€‚\né¢†åŸŸæ¨¡å‹ åœ¨ThingsBoardä¸­ï¼Œé¢†åŸŸæ¨¡å‹æ˜¯ä¸€ä¸ªå…³é”®æ¦‚å¿µï¼Œç”¨äºæè¿°ç‰©è”ç½‘ç³»ç»Ÿä¸­çš„ç‰©ç†å®ä½“ã€å±æ€§å’Œè¡Œä¸ºã€‚ä»¥ä¸‹æ˜¯ThingsBoardä¸­çš„ä¸»è¦é¢†åŸŸæ¨¡å‹ç»„ä»¶ï¼š\nç§Ÿæˆ·ï¼ˆTenantï¼‰ï¼šç§Ÿæˆ·æ˜¯ThingsBoardä¸­çš„é¡¶çº§ç»„ç»‡å•ä½ã€‚å®ƒä»£è¡¨äº†ä¸€ä¸ªç‹¬ç«‹çš„å®ä½“ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªç”¨æˆ·ã€ç»„ç»‡æˆ–å…¬å¸ã€‚ç§Ÿæˆ·æ‹¥æœ‰å’Œç®¡ç†è‡ªå·±çš„è®¾å¤‡ã€å®¢æˆ·ã€è§„åˆ™å’Œä»ªè¡¨æ¿ç­‰èµ„æºã€‚ç§Ÿæˆ·ä¹‹é—´çš„æ•°æ®å’Œé…ç½®æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œæ¯ä¸ªç§Ÿæˆ·éƒ½æœ‰è‡ªå·±çš„ç‹¬ç«‹ç¯å¢ƒã€‚ç§Ÿæˆ·ç”±ç³»ç»Ÿç®¡ç†å‘˜åˆ›å»ºå’Œç®¡ç†ã€‚\nç§Ÿæˆ·é…ç½®ï¼ˆTenantProfileï¼‰ï¼šç”¨äºå®šä¹‰ç§Ÿæˆ·çº§åˆ«çš„é…ç½®å’Œå±æ€§ã€‚\nå®¢æˆ·ï¼ˆCustomerï¼‰ï¼šå®¢æˆ·æ˜¯ç§Ÿæˆ·ä¸‹çš„å­çº§å®ä½“ï¼Œä»£è¡¨äº†ç‰©è”ç½‘ç³»ç»Ÿä¸­çš„ç”¨æˆ·æˆ–ç»„ç»‡ã€‚ä¸€ä¸ªç§Ÿæˆ·å¯ä»¥åŒ…å«å¤šä¸ªå®¢æˆ·ï¼Œæ¯ä¸ªå®¢æˆ·éƒ½æœ‰è‡ªå·±çš„è®¿é—®æƒé™å’Œè§’è‰²ã€‚å®¢æˆ·å¯ä»¥è®¿é—®å’Œç›‘æ§ç§Ÿæˆ·ä¸‹çš„è®¾å¤‡å’Œæ•°æ®ã€‚å®¢æˆ·å¯ä»¥æœ‰è‡ªå·±çš„è®¾å¤‡ã€è§„åˆ™å’Œä»ªè¡¨æ¿ç­‰èµ„æºï¼Œä½†è¿™äº›èµ„æºå—åˆ°ç§Ÿæˆ·çº§åˆ«çš„é™åˆ¶ã€‚å®¢æˆ·ç”±ç§Ÿæˆ·ç®¡ç†å‘˜åˆ›å»ºå’Œç®¡ç†ã€‚\nç”¨æˆ·ï¼ˆUserï¼‰ï¼šä¿å­˜ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯\nç”¨æˆ·çš„è§’è‰²ï¼ˆAuthorityï¼‰ï¼šSYS_ADMINã€TENANT_ADMINã€CUSTOMER_USERã€REFRESH_TOKENã€PRE_VERIFICATION_TOKEN ç”¨æˆ·å‡­è¯ï¼ˆUserCredentialsï¼‰ï¼šä¿å­˜ç”¨æˆ·çš„å¯†ç ã€æ¿€æ´»ç”¨æˆ· Tokenã€é‡ç½®å¯†ç  Tokenã€å¯†ç ä½¿ç”¨å†å² ç”¨æˆ·è®¤è¯è®¾ç½®ï¼ˆUserAuthSettingsï¼‰ï¼šä¿å­˜ç”¨æˆ· 2FA è®¤è¯è®¾ç½® ç”¨æˆ·è®¾ç½®ï¼ˆUserSettingsï¼‰ï¼šä¿å­˜ç”¨æˆ·çš„è®¾ç½®ï¼ŒåŒ…æ‹¬ï¼šé€šç”¨è®¾ç½®ã€é€šçŸ¥ã€è®¿é—®è¿‡çš„ä»ªè¡¨ç›˜ç­‰ç­‰ ç³»ç»Ÿè®¾ç½®ï¼ˆAdminSettingsï¼‰ï¼šæ˜¯ç”¨äºé…ç½®å’Œç®¡ç†æ•´ä¸ªç³»ç»Ÿçš„å…¨å±€è®¾ç½®å’Œå‚æ•°ï¼ŒåŒ…æ‹¬ï¼šé€šç”¨è®¾ç½®ã€é‚®ä»¶ã€JWTã€è¿æ¥è®¾ç½®ç­‰ç­‰ã€‚\nå®¡è®¡æ—¥å¿—ï¼ˆAuditLogï¼‰\nèµ„äº§ï¼ˆAssetï¼‰ï¼šæŒ‡åœ¨ç³»ç»Ÿä¸­è¡¨ç¤ºå’Œç®¡ç†çš„ç‰©ç†æˆ–è™šæ‹Ÿå®ä½“ã€‚èµ„äº§å¯ä»¥æ˜¯è®¾å¤‡ã€ä¼ æ„Ÿå™¨ã€è®¾æ–½ã€è½¦è¾†ã€å»ºç­‘ç‰©ã€äººå‘˜æˆ–å…¶ä»–å®ä½“ï¼Œå…¶çŠ¶æ€ã€å±æ€§å’Œè¡Œä¸ºå¯ä»¥è¢«ç›‘æµ‹ã€æ§åˆ¶å’Œç®¡ç†ã€‚\nèµ„äº§é…ç½®ï¼ˆAssetProfileï¼‰ï¼šé…ç½®èµ„äº§ä½¿ç”¨çš„é»˜è®¤è§„åˆ™é“¾ã€é˜Ÿåˆ—ã€ç§»åŠ¨ç«¯ä»ªè¡¨ç›˜\nè®¾å¤‡ï¼ˆDeviceï¼‰ï¼š\né¥æµ‹æ•°æ®ï¼ˆTsKVï¼‰ï¼š æœ€æ–°é¥æµ‹æ•°æ®ï¼š å±æ€§ï¼ˆAttributeKvEntryï¼‰ï¼šå±æ€§ç±»å‹åˆ†ä¸ºå®¢æˆ·ç«¯ã€æœåŠ¡ç«¯ã€å…±äº« è¿œç¨‹è°ƒç”¨ï¼ˆRpcï¼‰ è®¾å¤‡å‡­è¯ï¼ˆDeviceCredentialsï¼‰ï¼š OTAï¼š è®¾å¤‡é…ç½®ï¼ˆDeviceProfileï¼‰ï¼šé…ç½®è®¾å¤‡ä½¿ç”¨çš„é»˜è®¤è§„åˆ™é“¾ã€é˜Ÿåˆ—ã€ç§»åŠ¨ç«¯ä»ªè¡¨ç›˜ã€è¾¹ç¼˜ç½‘å…³é»˜è®¤è§„åˆ™é“¾ã€åˆ†é…çš„å›ºä»¶ã€åˆ†é…çš„è½¯ä»¶ã€ä¼ è¾“æ–¹å¼ã€å‘Šè­¦è§„åˆ™ã€è®¾ç½®é¢„é…ç½®\nå‘Šè­¦ï¼ˆAlarmï¼‰ï¼šåŒ…æ‹¬å­—æ®µï¼šç§Ÿæˆ·ã€å®¢æˆ·ã€ç±»å‹ã€æ˜ç»†ã€å‘èµ·è€…ã€å‘Šè­¦çº§åˆ«ï¼ˆä¸¥é‡ã€é‡è¦ã€æ¬¡è¦ã€è­¦å‘Šã€ä¸ç¡®å®šï¼‰ã€æ˜¯å¦åº”ç­”ã€æ˜¯å¦æ¸…é™¤ã€å—ç†äººã€å¼€å§‹æ—¶é—´ã€ç»“æŸæ—¶é—´ã€åº”ç­”æ—¶é—´ã€æ¸…é™¤æ—¶é—´ã€å—ç†æ—¶é—´ã€æ˜¯å¦ä¼ æ’­ã€æ˜¯å¦ä¼ æ’­ç»™æ‰€æœ‰è€…ã€æ˜¯å¦ä¼ æ’­ç»™ç§Ÿæˆ·\nå‘Šè­¦è¯„è®ºï¼ˆAlarmCommentï¼‰ï¼š\nå®ä½“å‘Šè­¦ï¼ˆEntityAlarmï¼‰ï¼š\näº‹ä»¶ï¼ˆEventï¼‰ï¼šåˆ†ä¸ºå¼‚å¸¸äº‹ä»¶ã€ç»„ä»¶ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ã€è§„åˆ™é“¾è°ƒè¯•äº‹ä»¶ã€è§„åˆ™èŠ‚ç‚¹äº‹ä»¶ã€ç»Ÿè®¡äº‹ä»¶\né€šçŸ¥ï¼ˆNotificationï¼‰:\né€šçŸ¥è¯·æ±‚ï¼ˆNotificationRequestï¼‰ é€šçŸ¥æ¨¡ç‰ˆï¼ˆNotificationTemplateï¼‰ï¼š é€šçŸ¥è§„åˆ™ï¼ˆNotificationRuleï¼‰ é€šçŸ¥å¯¹è±¡ï¼ˆNotificationTargetï¼‰ æµç¨‹ ä¸ŠæŠ¥é¥æµ‹æ•°æ® è®¾å¤‡é…ç½®å¯ç”¨å‘Šè­¦è§„åˆ™ã€‚æ¸©åº¦å¤§äº 20 æ—¶ï¼Œäº§ç”Ÿå‘Šè­¦ã€‚æ¸©åº¦å°äº 20 æ—¶ï¼Œæ¸…é™¤å‘Šè­¦ã€‚\nåˆ›å»ºä¸€ä¸ªè®¾å¤‡ï¼Œè®¾å¤‡å‡­è¯ä½¿ç”¨ AccessToken\nä½¿ç”¨ http api å‘é€é¥æµ‹æ•°æ®\ncurl -v -X POST http://localhost:8080/api/v1/gs76dj5m47yd3lm1wurd/telemetry --header Content-Type:application/json --data \u0026#34;{temperature:25}\u0026#34; æŸ¥çœ‹å‘Šè­¦\nå†æ¬¡å‘é€é¥æµ‹æ•°æ®ï¼Œå¯ä»¥æ¸…é™¤å‘Šè­¦\næºç åˆ†æï¼š\nä½¿ç”¨ http api å‘é€æ•°æ®ï¼Œå…¥å£ç±»åœ¨ common/transport/http æ¨¡å—ä¸‹çš„ DeviceApiController ç±»ã€‚è¿™ä¸ªç±»æä¾›äº†ä»¥ä¸‹å‡ ä¸ªæ¥å£ï¼š\nGET /api/v1/{deviceToken}/attributes POST /api/v1/{deviceToken}/attributes GET /api/v1/{deviceToken}/telemetry POST /api/v1/{deviceToken}/telemetry GET /api/v1/{deviceToken}/rpc POST /api/v1/{deviceToken}/rpc POST /api/v1/{deviceToken}/rpc/{requestId} POST /api/v1/{deviceToken}/claim GET /api/v1/{deviceToken}/firmware POST /api/v1/{deviceToken}/firmware GET /api/v1/{deviceToken}/software POST /api/v1/{deviceToken}/software POST /api/v1/provision POST /api/v1/{deviceToken}/telemetry å¤„ç†é€»è¾‘ï¼š\nHttpTransportContext TransportService DefaultTransportService TbQueueProducer\u0026lt;TbProtoQueueMsg\u0026lt;ToRuleEngineMsg\u0026gt;\u0026gt; ruleEngineMsgProducer TbRuleEngineQueueConsumerManager TbRuleEngineConsumerContext ActorSystemContext TbActorRef TbActorMailbox AppActor TenantActor RuleChainActor\tRuleChainActorMessageProcessor RuleNodeActor RuleNodeActorMessageProcessor TbDeviceProfileNode DeviceState AlarmState DefaultTbContext DefaultTbClusterService TbRuleEngineProducerProvider TbQueueProducer\u0026lt;TbProtoQueueMsg\u0026lt;ToRuleEngineMsg\u0026gt;\u0026gt; toRuleEngine è¿™é‡Œé¢ç”¨åˆ°äº† Transport ã€Queueã€Actor ï¼Œè°ƒç”¨é“¾éå¸¸é•¿ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2024/05/07/thingsboard-domain/","summary":"ThingsBoardæ˜¯ä¸€ä¸ªå¼€æºçš„ç‰©è”ç½‘å¹³å°ï¼Œç”¨äºç®¡ç†å’Œç›‘æ§ç‰©è”ç½‘è®¾å¤‡å’Œæ•°æ®ã€‚å®ƒæä¾›äº†ä¸€ä¸ªå¯æ‰©å±•çš„æ¶æ„ï¼Œå¯ä»¥è¿æ¥å„ç§è®¾å¤‡ï¼Œå¹¶å®æ—¶æ”¶é›†ã€å¤„ç†å’Œåˆ†æè®¾å¤‡ç”Ÿæˆçš„æ•°æ®ã€‚\né¢†åŸŸæ¨¡å‹ åœ¨ThingsBoardä¸­ï¼Œé¢†åŸŸæ¨¡å‹æ˜¯ä¸€ä¸ªå…³é”®æ¦‚å¿µï¼Œç”¨äºæè¿°ç‰©è”ç½‘ç³»ç»Ÿä¸­çš„ç‰©ç†å®ä½“ã€å±æ€§å’Œè¡Œä¸ºã€‚ä»¥ä¸‹æ˜¯ThingsBoardä¸­çš„ä¸»è¦é¢†åŸŸæ¨¡å‹ç»„ä»¶ï¼š\nç§Ÿæˆ·ï¼ˆTenantï¼‰ï¼šç§Ÿæˆ·æ˜¯ThingsBoardä¸­çš„é¡¶çº§ç»„ç»‡å•ä½ã€‚å®ƒä»£è¡¨äº†ä¸€ä¸ªç‹¬ç«‹çš„å®ä½“ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªç”¨æˆ·ã€ç»„ç»‡æˆ–å…¬å¸ã€‚ç§Ÿæˆ·æ‹¥æœ‰å’Œç®¡ç†è‡ªå·±çš„è®¾å¤‡ã€å®¢æˆ·ã€è§„åˆ™å’Œä»ªè¡¨æ¿ç­‰èµ„æºã€‚ç§Ÿæˆ·ä¹‹é—´çš„æ•°æ®å’Œé…ç½®æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œæ¯ä¸ªç§Ÿæˆ·éƒ½æœ‰è‡ªå·±çš„ç‹¬ç«‹ç¯å¢ƒã€‚ç§Ÿæˆ·ç”±ç³»ç»Ÿç®¡ç†å‘˜åˆ›å»ºå’Œç®¡ç†ã€‚\nç§Ÿæˆ·é…ç½®ï¼ˆTenantProfileï¼‰ï¼šç”¨äºå®šä¹‰ç§Ÿæˆ·çº§åˆ«çš„é…ç½®å’Œå±æ€§ã€‚\nå®¢æˆ·ï¼ˆCustomerï¼‰ï¼šå®¢æˆ·æ˜¯ç§Ÿæˆ·ä¸‹çš„å­çº§å®ä½“ï¼Œä»£è¡¨äº†ç‰©è”ç½‘ç³»ç»Ÿä¸­çš„ç”¨æˆ·æˆ–ç»„ç»‡ã€‚ä¸€ä¸ªç§Ÿæˆ·å¯ä»¥åŒ…å«å¤šä¸ªå®¢æˆ·ï¼Œæ¯ä¸ªå®¢æˆ·éƒ½æœ‰è‡ªå·±çš„è®¿é—®æƒé™å’Œè§’è‰²ã€‚å®¢æˆ·å¯ä»¥è®¿é—®å’Œç›‘æ§ç§Ÿæˆ·ä¸‹çš„è®¾å¤‡å’Œæ•°æ®ã€‚å®¢æˆ·å¯ä»¥æœ‰è‡ªå·±çš„è®¾å¤‡ã€è§„åˆ™å’Œä»ªè¡¨æ¿ç­‰èµ„æºï¼Œä½†è¿™äº›èµ„æºå—åˆ°ç§Ÿæˆ·çº§åˆ«çš„é™åˆ¶ã€‚å®¢æˆ·ç”±ç§Ÿæˆ·ç®¡ç†å‘˜åˆ›å»ºå’Œç®¡ç†ã€‚\nç”¨æˆ·ï¼ˆUserï¼‰ï¼šä¿å­˜ç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯\nç”¨æˆ·çš„è§’è‰²ï¼ˆAuthorityï¼‰ï¼šSYS_ADMINã€TENANT_ADMINã€CUSTOMER_USERã€REFRESH_TOKENã€PRE_VERIFICATION_TOKEN ç”¨æˆ·å‡­è¯ï¼ˆUserCredentialsï¼‰ï¼šä¿å­˜ç”¨æˆ·çš„å¯†ç ã€æ¿€æ´»ç”¨æˆ· Tokenã€é‡ç½®å¯†ç  Tokenã€å¯†ç ä½¿ç”¨å†å² ç”¨æˆ·è®¤è¯è®¾ç½®ï¼ˆUserAuthSettingsï¼‰ï¼šä¿å­˜ç”¨æˆ· 2FA è®¤è¯è®¾ç½® ç”¨æˆ·è®¾ç½®ï¼ˆUserSettingsï¼‰ï¼šä¿å­˜ç”¨æˆ·çš„è®¾ç½®ï¼ŒåŒ…æ‹¬ï¼šé€šç”¨è®¾ç½®ã€é€šçŸ¥ã€è®¿é—®è¿‡çš„ä»ªè¡¨ç›˜ç­‰ç­‰ ç³»ç»Ÿè®¾ç½®ï¼ˆAdminSettingsï¼‰ï¼šæ˜¯ç”¨äºé…ç½®å’Œç®¡ç†æ•´ä¸ªç³»ç»Ÿçš„å…¨å±€è®¾ç½®å’Œå‚æ•°ï¼ŒåŒ…æ‹¬ï¼šé€šç”¨è®¾ç½®ã€é‚®ä»¶ã€JWTã€è¿æ¥è®¾ç½®ç­‰ç­‰ã€‚\nå®¡è®¡æ—¥å¿—ï¼ˆAuditLogï¼‰\nèµ„äº§ï¼ˆAssetï¼‰ï¼šæŒ‡åœ¨ç³»ç»Ÿä¸­è¡¨ç¤ºå’Œç®¡ç†çš„ç‰©ç†æˆ–è™šæ‹Ÿå®ä½“ã€‚èµ„äº§å¯ä»¥æ˜¯è®¾å¤‡ã€ä¼ æ„Ÿå™¨ã€è®¾æ–½ã€è½¦è¾†ã€å»ºç­‘ç‰©ã€äººå‘˜æˆ–å…¶ä»–å®ä½“ï¼Œå…¶çŠ¶æ€ã€å±æ€§å’Œè¡Œä¸ºå¯ä»¥è¢«ç›‘æµ‹ã€æ§åˆ¶å’Œç®¡ç†ã€‚\nèµ„äº§é…ç½®ï¼ˆAssetProfileï¼‰ï¼šé…ç½®èµ„äº§ä½¿ç”¨çš„é»˜è®¤è§„åˆ™é“¾ã€é˜Ÿåˆ—ã€ç§»åŠ¨ç«¯ä»ªè¡¨ç›˜\nè®¾å¤‡ï¼ˆDeviceï¼‰ï¼š\né¥æµ‹æ•°æ®ï¼ˆTsKVï¼‰ï¼š æœ€æ–°é¥æµ‹æ•°æ®ï¼š å±æ€§ï¼ˆAttributeKvEntryï¼‰ï¼šå±æ€§ç±»å‹åˆ†ä¸ºå®¢æˆ·ç«¯ã€æœåŠ¡ç«¯ã€å…±äº« è¿œç¨‹è°ƒç”¨ï¼ˆRpcï¼‰ è®¾å¤‡å‡­è¯ï¼ˆDeviceCredentialsï¼‰ï¼š OTAï¼š è®¾å¤‡é…ç½®ï¼ˆDeviceProfileï¼‰ï¼šé…ç½®è®¾å¤‡ä½¿ç”¨çš„é»˜è®¤è§„åˆ™é“¾ã€é˜Ÿåˆ—ã€ç§»åŠ¨ç«¯ä»ªè¡¨ç›˜ã€è¾¹ç¼˜ç½‘å…³é»˜è®¤è§„åˆ™é“¾ã€åˆ†é…çš„å›ºä»¶ã€åˆ†é…çš„è½¯ä»¶ã€ä¼ è¾“æ–¹å¼ã€å‘Šè­¦è§„åˆ™ã€è®¾ç½®é¢„é…ç½®\nå‘Šè­¦ï¼ˆAlarmï¼‰ï¼šåŒ…æ‹¬å­—æ®µï¼šç§Ÿæˆ·ã€å®¢æˆ·ã€ç±»å‹ã€æ˜ç»†ã€å‘èµ·è€…ã€å‘Šè­¦çº§åˆ«ï¼ˆä¸¥é‡ã€é‡è¦ã€æ¬¡è¦ã€è­¦å‘Šã€ä¸ç¡®å®šï¼‰ã€æ˜¯å¦åº”ç­”ã€æ˜¯å¦æ¸…é™¤ã€å—ç†äººã€å¼€å§‹æ—¶é—´ã€ç»“æŸæ—¶é—´ã€åº”ç­”æ—¶é—´ã€æ¸…é™¤æ—¶é—´ã€å—ç†æ—¶é—´ã€æ˜¯å¦ä¼ æ’­ã€æ˜¯å¦ä¼ æ’­ç»™æ‰€æœ‰è€…ã€æ˜¯å¦ä¼ æ’­ç»™ç§Ÿæˆ·\nå‘Šè­¦è¯„è®ºï¼ˆAlarmCommentï¼‰ï¼š\nå®ä½“å‘Šè­¦ï¼ˆEntityAlarmï¼‰ï¼š\näº‹ä»¶ï¼ˆEventï¼‰ï¼šåˆ†ä¸ºå¼‚å¸¸äº‹ä»¶ã€ç»„ä»¶ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ã€è§„åˆ™é“¾è°ƒè¯•äº‹ä»¶ã€è§„åˆ™èŠ‚ç‚¹äº‹ä»¶ã€ç»Ÿè®¡äº‹ä»¶\né€šçŸ¥ï¼ˆNotificationï¼‰:\né€šçŸ¥è¯·æ±‚ï¼ˆNotificationRequestï¼‰ é€šçŸ¥æ¨¡ç‰ˆï¼ˆNotificationTemplateï¼‰ï¼š é€šçŸ¥è§„åˆ™ï¼ˆNotificationRuleï¼‰ é€šçŸ¥å¯¹è±¡ï¼ˆNotificationTargetï¼‰ æµç¨‹ ä¸ŠæŠ¥é¥æµ‹æ•°æ® è®¾å¤‡é…ç½®å¯ç”¨å‘Šè­¦è§„åˆ™ã€‚æ¸©åº¦å¤§äº 20 æ—¶ï¼Œäº§ç”Ÿå‘Šè­¦ã€‚æ¸©åº¦å°äº 20 æ—¶ï¼Œæ¸…é™¤å‘Šè­¦ã€‚\nåˆ›å»ºä¸€ä¸ªè®¾å¤‡ï¼Œè®¾å¤‡å‡­è¯ä½¿ç”¨ AccessToken\nä½¿ç”¨ http api å‘é€é¥æµ‹æ•°æ®\ncurl -v -X POST http://localhost:8080/api/v1/gs76dj5m47yd3lm1wurd/telemetry --header Content-Type:application/json --data \u0026#34;{temperature:25}\u0026#34; æŸ¥çœ‹å‘Šè­¦\nå†æ¬¡å‘é€é¥æµ‹æ•°æ®ï¼Œå¯ä»¥æ¸…é™¤å‘Šè­¦\næºç åˆ†æï¼š\nä½¿ç”¨ http api å‘é€æ•°æ®ï¼Œå…¥å£ç±»åœ¨ common/transport/http æ¨¡å—ä¸‹çš„ DeviceApiController ç±»ã€‚è¿™ä¸ªç±»æä¾›äº†ä»¥ä¸‹å‡ ä¸ªæ¥å£ï¼š\nGET /api/v1/{deviceToken}/attributes POST /api/v1/{deviceToken}/attributes GET /api/v1/{deviceToken}/telemetry POST /api/v1/{deviceToken}/telemetry GET /api/v1/{deviceToken}/rpc POST /api/v1/{deviceToken}/rpc POST /api/v1/{deviceToken}/rpc/{requestId} POST /api/v1/{deviceToken}/claim GET /api/v1/{deviceToken}/firmware POST /api/v1/{deviceToken}/firmware GET /api/v1/{deviceToken}/software POST /api/v1/{deviceToken}/software POST /api/v1/provision POST /api/v1/{deviceToken}/telemetry å¤„ç†é€»è¾‘ï¼š\nHttpTransportContext TransportService DefaultTransportService TbQueueProducer\u0026lt;TbProtoQueueMsg\u0026lt;ToRuleEngineMsg\u0026gt;\u0026gt; ruleEngineMsgProducer TbRuleEngineQueueConsumerManager TbRuleEngineConsumerContext ActorSystemContext TbActorRef TbActorMailbox AppActor TenantActor RuleChainActor\tRuleChainActorMessageProcessor RuleNodeActor RuleNodeActorMessageProcessor TbDeviceProfileNode DeviceState AlarmState DefaultTbContext DefaultTbClusterService TbRuleEngineProducerProvider TbQueueProducer\u0026lt;TbProtoQueueMsg\u0026lt;ToRuleEngineMsg\u0026gt;\u0026gt; toRuleEngine è¿™é‡Œé¢ç”¨åˆ°äº† Transport ã€Queueã€Actor ï¼Œè°ƒç”¨é“¾éå¸¸é•¿ã€‚","title":"ThingsBoardçš„é¢†åŸŸæ¨¡å‹"},{"content":"thingsboard æ˜¯ä¸€æ¬¾ä¹Œå…‹å…°å›¢é˜ŸåŸºäºjavaè¯­è¨€ç ”å‘çš„å¼€æºç‰©è”ç½‘æ¡†æ¶ï¼Œå¼€æºçš„æ˜¯ceç‰ˆï¼Œä¼ä¸šç‰ˆéœ€è¦è´­ä¹°æˆæƒä¸”æ— æºç ã€‚\nå®˜æ–¹ç½‘ç«™ï¼š\nThingsboard å®˜ç½‘ï¼šhttps://thingsboard.io/\nThingsboardç¤¾åŒºå…è´¹ç‰ˆæœ¬ï¼šhttps://demo.thingsboard.io/\nThingsboard ä¼ä¸šä»˜è´¹ç‰ˆæœ¬ï¼šhttps://thingsboard.cloud/\nThingsboard æºç ï¼šhttps://github.com/thingsboard/thingsboard\nTBMQ æºç ï¼šhttps://github.com/thingsboard/tbmq\nä¸­æ–‡ç½‘ï¼šhttp://www.ithingsboard.com/\nThingsBoard ä¸­æ–‡ç¤¾åŒºï¼šhttps://www.thingsboard.club/\nåšå®¢ï¼š\nWhat is ThingsBoard? An Overview of ThingsBoard in 2024\nHow to access MQTT data with ThingsBoard | EMQ\nåˆ†äº«ï½œäº”åˆ†é’Ÿå­¦ä¼šä½¿ç”¨ ThingsBoard è§„åˆ™é“¾\nåˆ†äº«ï½œäº”åˆ†é’Ÿäº†è§£ ThingsBoard ç‰©è”ç½‘å¹³å°å¤šç§éƒ¨ç½²åœºæ™¯\nåˆ†äº«ï½œäº”åˆ†é’Ÿå¿«é€Ÿå­¦ä¼š ThingsBoard æ‰“åŒ…é•œåƒå’Œ Docker éƒ¨ç½²\nåˆ†äº«ï½œäº”åˆ†é’Ÿå¿«é€Ÿå­¦ä¼š ThingsBoard å¯¹æ¥ç‰©è”ç½‘ç½‘å…³\nåˆ†äº«ï½œäº”åˆ†é’Ÿå¿«é€Ÿå­¦ä¼š ThingsBoard DashBoard åŸºæœ¬æ“ä½œ\nåˆ†äº«ï½œäº”åˆ†é’Ÿå­¦ä¼š ThingsBoard æœ¬åœ°ç¼–è¯‘è¿è¡Œå’Œ Linux éƒ¨ç½²\nåˆ†äº«ï½œäº”åˆ†é’Ÿç†Ÿæ‚‰ ThingsBoard å‰ç«¯äºŒæ¬¡å¼€å‘ã€‚\nhttps://www.cnblogs.com/east196/tag/ThingsBoard/\nç‰©è”ç½‘æŠ€æœ¯å­¦ä¹ æŒ‡å— https://iot.mushuwei.cn/\nç‰©è”ç½‘å¼€æºæ¡†æ¶Thingsboardä½¿ç”¨æ€»ç»“\nhttps://www.weishadian.com/index.php/tag/thingsboard/page/5/\nthingskitåšå®¢\nThingsBoardäºŒæ¬¡å¼€å‘ä¹‹æºç åˆ†æ1- åŸºç¡€çŸ¥è¯†\næºç åˆ†æï¼š\nThingsBoard æºç åˆ†æ thingsboardæºç è§£æ ç²¾å°½thingsboardæºç è§£æ https://github.com/blackstar-baba/how-2-use-thingsboard https://chenzhifu.xyz/categories/thingsboard IOT å¹³å°ï¼š\nhttp://iot.bctools.cn/ ThingsKit åˆ†å¸ƒå¼è§„åˆ™å¼•æ“ç³»ç»Ÿï¼Œé‡æ„äºå¼€æºIOTé¡¹ç›®thingboard ","permalink":"https://blog.chensoul.cc/posts/2024/04/29/all-things-about-thingsboard/","summary":"thingsboard æ˜¯ä¸€æ¬¾ä¹Œå…‹å…°å›¢é˜ŸåŸºäºjavaè¯­è¨€ç ”å‘çš„å¼€æºç‰©è”ç½‘æ¡†æ¶ï¼Œå¼€æºçš„æ˜¯ceç‰ˆï¼Œä¼ä¸šç‰ˆéœ€è¦è´­ä¹°æˆæƒä¸”æ— æºç ã€‚\nå®˜æ–¹ç½‘ç«™ï¼š\nThingsboard å®˜ç½‘ï¼šhttps://thingsboard.io/\nThingsboardç¤¾åŒºå…è´¹ç‰ˆæœ¬ï¼šhttps://demo.thingsboard.io/\nThingsboard ä¼ä¸šä»˜è´¹ç‰ˆæœ¬ï¼šhttps://thingsboard.cloud/\nThingsboard æºç ï¼šhttps://github.com/thingsboard/thingsboard\nTBMQ æºç ï¼šhttps://github.com/thingsboard/tbmq\nä¸­æ–‡ç½‘ï¼šhttp://www.ithingsboard.com/\nThingsBoard ä¸­æ–‡ç¤¾åŒºï¼šhttps://www.thingsboard.club/\nåšå®¢ï¼š\nWhat is ThingsBoard? An Overview of ThingsBoard in 2024\nHow to access MQTT data with ThingsBoard | EMQ\nåˆ†äº«ï½œäº”åˆ†é’Ÿå­¦ä¼šä½¿ç”¨ ThingsBoard è§„åˆ™é“¾\nåˆ†äº«ï½œäº”åˆ†é’Ÿäº†è§£ ThingsBoard ç‰©è”ç½‘å¹³å°å¤šç§éƒ¨ç½²åœºæ™¯\nåˆ†äº«ï½œäº”åˆ†é’Ÿå¿«é€Ÿå­¦ä¼š ThingsBoard æ‰“åŒ…é•œåƒå’Œ Docker éƒ¨ç½²\nåˆ†äº«ï½œäº”åˆ†é’Ÿå¿«é€Ÿå­¦ä¼š ThingsBoard å¯¹æ¥ç‰©è”ç½‘ç½‘å…³\nåˆ†äº«ï½œäº”åˆ†é’Ÿå¿«é€Ÿå­¦ä¼š ThingsBoard DashBoard åŸºæœ¬æ“ä½œ\nåˆ†äº«ï½œäº”åˆ†é’Ÿå­¦ä¼š ThingsBoard æœ¬åœ°ç¼–è¯‘è¿è¡Œå’Œ Linux éƒ¨ç½²\nåˆ†äº«ï½œäº”åˆ†é’Ÿç†Ÿæ‚‰ ThingsBoard å‰ç«¯äºŒæ¬¡å¼€å‘ã€‚\nhttps://www.cnblogs.com/east196/tag/ThingsBoard/\nç‰©è”ç½‘æŠ€æœ¯å­¦ä¹ æŒ‡å— https://iot.mushuwei.cn/\nç‰©è”ç½‘å¼€æºæ¡†æ¶Thingsboardä½¿ç”¨æ€»ç»“\nhttps://www.weishadian.com/index.php/tag/thingsboard/page/5/\nthingskitåšå®¢\nThingsBoardäºŒæ¬¡å¼€å‘ä¹‹æºç åˆ†æ1- åŸºç¡€çŸ¥è¯†\næºç åˆ†æï¼š\nThingsBoard æºç åˆ†æ thingsboardæºç è§£æ ç²¾å°½thingsboardæºç è§£æ https://github.com/blackstar-baba/how-2-use-thingsboard https://chenzhifu.xyz/categories/thingsboard IOT å¹³å°ï¼š\nhttp://iot.bctools.cn/ ThingsKit åˆ†å¸ƒå¼è§„åˆ™å¼•æ“ç³»ç»Ÿï¼Œé‡æ„äºå¼€æºIOTé¡¹ç›®thingboard ","title":"All things about ThingsBoard"},{"content":" å¯åŠ¨ TBMQ ç¨‹åºï¼Œæµè§ˆå™¨è®¿é—® http://localhost:8083ï¼Œåˆ›å»ºä¸€ä¸ª Applicationï¼ŒCredentials Type ä¸º BASICï¼Œå®¢æˆ·ç«¯ IDã€ç”¨æˆ·åå’Œå¯†ç å‡è®¾ç½®ä¸º tbmq_app\nä½¿ç”¨ mosquitto æµ‹è¯•è®¢é˜…æ¶ˆæ¯\nmosquitto_sub -d -q 1 -h localhost -p 1883 -t tbmq/demo/+ -i \u0026#39;tbmq_app\u0026#39; -u \u0026#39;tbmq_app\u0026#39; -P \u0026#39;tbmq_app\u0026#39; -c -v Debug è°ƒè¯• MqttSessionHandler ç±»çš„ channelRead(ChannelHandlerContext ctx, Object msg) æ–¹æ³•\nç¬¬ä¸€æ¬¡è¿æ¥ï¼Œæ¶ˆæ¯ç±»å‹æ˜¯ CONNECT\næ¶ˆæ¯ï¼š\nå›ºå®šå¤´ï¼šMqttFixedHeader[messageType=CONNECT, isDup=false, qosLevel=AT_MOST_ONCE, isRetain=false, remainingLength=40]\nå˜é‡å¤´ï¼šMqttConnectVariableHeader[name=MQTT, version=4, hasUserName=true, hasPassword=true, isWillRetain=false, isWillFlag=false, isCleanSession=false, keepAliveTimeSeconds=60]\nè´Ÿè½½ï¼šMqttConnectPayload[clientIdentifier=tbmq_app, willTopic=null, willMessage=null, userName=tbmq_app, password=[116, 98, 109, 113, 95, 97, 112, 112]]\naddress ä¸ºç©ºï¼Œæ•…ä» ChannelHandlerContext è·å–å®¢æˆ·ç«¯åœ°å€ï¼Œå¹¶å°†åœ°å€ä¿æŒåˆ°å®¢æˆ·ç«¯ Session ä¸Šä¸‹æ–‡ ClientSessionCtx\nåˆå§‹åŒ– Sessionï¼šè·å– clientIã€mqtt ç‰ˆæœ¬ï¼Œè°ƒç”¨ ClientMqttActorManager åˆå§‹åŒ– sessionï¼šåˆ›å»º clientActorRefï¼Œå‘é€ä¸€ä¸ª SessionInitMsg æ¶ˆæ¯\nè°ƒç”¨ ClientMqttActorManager connect æ–¹æ³•ï¼Œå‘é€ä¸€ä¸ª MqttConnectMsg æ¶ˆæ¯\nç¬¬äºŒæ¬¡è¿æ¥ï¼Œæ¶ˆæ¯ç±»å‹æ˜¯ SUBSCRIBE\nMqttSubscribeMessage[fixedHeader=MqttFixedHeader[messageType=SUBSCRIBE, isDup=false, qosLevel=AT_LEAST_ONCE, isRetain=false, remainingLength=16], variableHeader=MqttMessageIdAndPropertiesVariableHeader[messageId=1, properties=io.netty.handler.codec.mqtt.MqttProperties@15c52601], payload=MqttSubscribePayload[MqttTopicSubscription[topicFilter=tbmq/demo/+, option=SubscriptionOption[qos=AT_LEAST_ONCE, noLocal=false, retainAsPublished=false, retainHandling=SEND_AT_SUBSCRIBE]]]]\nç¬¬ä¸‰æ¬¡è¿æ¥ï¼Œæ¶ˆæ¯ç±»å‹æ˜¯ PINGREQ\nMqttSessionHandler ç¬¬ä¸€æ¬¡è¿æ¥æ—¶ï¼ŒClientMqttActorManagerImpl åˆå§‹åŒ–ä»£ç \n@Override public void initSession(String clientId, boolean isClientIdGenerated, SessionInitMsg sessionInitMsg) { TbActorRef clientActorRef = getActor(clientId); if (clientActorRef == null) { clientActorRef = createRootActor(clientId, isClientIdGenerated); } clientActorRef.tellWithHighPriority(sessionInitMsg); } å¯ä»¥çœ‹åˆ°ï¼š\nMqttSessionHandler å°†æ¶ˆæ¯çš„å¤„ç†å§”æ‰˜ç»™äº† ClientMqttActorManager å¯¹è±¡ã€‚ClientMqttActorManagerä½¿ç”¨äº† Actor æ¨¡å‹ã€‚\nClientMqttActorManager\nActorSystemContext\nTbActorSystem\né€šè¿‡ ClientActorCreator åˆ›å»ºä¸€ä¸ª TbActorCtxï¼Œå…¶å®æ˜¯åˆ›å»ºäº†ä¸€ä¸ª TbActorMailbox\nprivate TbActorRef createRootActor(String clientId, boolean isClientIdGenerated) { return actorSystem.createRootActor(ActorSystemLifecycle.CLIENT_DISPATCHER_NAME, new ClientActorCreator(actorSystemContext, clientId, isClientIdGenerated)); } ClientActorCreator è´Ÿè´£åˆ›å»º ClientActor\nNettyMqttConverter è´Ÿè´£å°† MqttMessage è½¬æ¢ä¸º TbActorMsgã€‚\nclientActorRef.tellWithHighPriority å‘é€äº†ä¸€ä¸ªé«˜ä¼˜å…ˆçº§çš„æ¶ˆæ¯ï¼šclientActorRef.tellWithHighPriority(sessionInitMsg)ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯ Actor æ¨¡å‹å®šä¹‰çš„æ–¹æ³•ï¼Œè°ƒç”¨è¯¥æ–¹æ³•æ„å‘³ç€ç¨‹åºçš„æ‰§è¡Œè¿›å…¥äº† Actorã€‚å…³äº Actor å…·ä½“çš„æ‰§è¡Œé€»è¾‘ï¼Œå¯ä»¥å…ˆå¿½ç•¥ï¼Œä¸»è¦å…³æ³¨ Actor æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™ã€æ€ä¹ˆè°ƒç”¨ä¸šåŠ¡ä»£ç çš„ï¼ˆå³å¦‚ä½•å¤„ç† MQTT æ¶ˆæ¯çš„é€»è¾‘ï¼‰ã€‚\nè°ƒç”¨ TbActorMailboxçš„ enqueue(TbActorMsg msg, boolean highPriority) æ–¹æ³• è°ƒç”¨ tryProcessQueue(true); è°ƒç”¨ processMailbox() æ–¹æ³• è°ƒç”¨ actor.process(msg); æ–¹æ³•ï¼Œè¿™é‡Œçš„ actor æ˜¯ç”± ClientActorCreator åˆ›å»ºçš„ ClientActor è°ƒç”¨ ClientActor çš„actor.process(msg); æ–¹æ³• å¦‚æœ TimedMsg åˆ™ clientActorStats.logMsgQueueTime(msg, TimeUnit.NANOSECONDS); clientLogger è®°å½•äº‹ä»¶ å¦‚æœæ˜¯é˜Ÿåˆ—æ¶ˆæ¯ QueueableMqttMsgï¼Œè°ƒç”¨ processQueueableMqttMsg((QueueableMqttMsg) msg); æ–¹æ³• å¦‚æœæ˜¯å…¶ä»–æ¶ˆæ¯ï¼š SessionInitMsgï¼šActorProcessor åˆ›å»º AuthContext è°ƒç”¨ AuthResponse authenticateClient(AuthContext authContext) è°ƒç”¨ authenticationService.authenticate(authContext) è°ƒç”¨ MqttClientAuthProviderçš„authenticate(AuthContext authContext) è°ƒç”¨ BasicMqttClientAuthProvider è®¤è¯å¯†ç  BasicMqttCredentials è°ƒç”¨ authorizationRuleService.parseBasicAuthorizationRule(credentials) è·å– AuthRulePatterns è¿”å› AuthResponse finishSessionAuth(state.getClientId(), sessionCtx, authResponse) ï¼š ClientSessionCtx ä¿å­˜å®¢æˆ·ç«¯ç±»å‹ã€authRulePatterns æ›´æ–° ClientActorState MQTT_CONNECT_MSGï¼š ConnectService startConnection ClientSessionCtx ä¿å­˜ SessionInfo ClientSessionCtx è®¾ç½® TopicAliasCtx KeepAliveService æ³¨å†Œ session ClientSessionEventService requestConnection(SessionInfo sessionInfo) å‘é€ ClientSessionEventProto åˆ° MQ â€‹\nMqttSessionHandler ç±»è°ƒç”¨å…³ç³»ï¼š\nMqttSessionHandler\nClientMqttActorManager\nTbActorMailbox\nContextAwareActor\nClientActor\n1ï¼šSessionInitMsg\nActorProcessor AuthenticationService MqttClientAuthProvider MqttClientCredentialsService MqttClientCredentialsDao MqttConnectMsg ConnectService ClientSessionEventService TbQueueProducer ClientSessionEventConsumer ClientSessionEventActorManager TbActorRef ConnectionRequestMsg SessionClusterManager ClientSessionService ClientSessionPersistenceService TbQueueProducer ConnectionAcceptedMsg\nConnectService MqttDisconnectMsg\nDisconnectService SessionDisconnectedMsg\nSessionClusterManager ClientSessionService ClientSubscriptionService MqttSessionHandler æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†MQTTä¼šè¯çš„Javaç±»ã€‚å®ƒå®ç°äº†ChannelInboundHandlerAdapterå’ŒGenericFutureListeneræ¥å£ï¼Œå› æ­¤å¯ä»¥ä½œä¸ºNettyæ¡†æ¶ä¸­çš„å¤„ç†ç»„ä»¶ã€‚\nå®ç°åŸç†ï¼š\nç±»ä¸­åŒ…å«äº†ä¸€ä¸ªsessionIdï¼Œç”¨äºæ ‡è¯†æ¯ä¸ªä¼šè¯ã€‚sessionIdæ˜¯éšæœºç”Ÿæˆçš„UUIDï¼Œæ¯æ¬¡ä¼šè¯å¼€å§‹æ—¶éƒ½ä¼šé‡æ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„sessionIdã€‚ ç±»ä¸­åŒ…å«äº†å„ç§å¤„ç†MQTTæ¶ˆæ¯çš„æ–¹æ³•ï¼Œä¾‹å¦‚processMqttMsgæ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¼šæ ¹æ®æ¥æ”¶åˆ°çš„MQTTæ¶ˆæ¯ç±»å‹è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚ä¾‹å¦‚ï¼Œå½“æ”¶åˆ°CONNECTæ¶ˆæ¯æ—¶ï¼Œä¼šè°ƒç”¨initSessionæ–¹æ³•åˆå§‹åŒ–ä¼šè¯ã€‚å½“æ”¶åˆ°PUBLISHæ¶ˆæ¯æ—¶ï¼Œä¼šæ£€æŸ¥é€Ÿç‡é™åˆ¶å¹¶å¤„ç†æ¶ˆæ¯ã€‚ disconnectæ–¹æ³•ç”¨äºæ–­å¼€ä¸å®¢æˆ·ç«¯çš„è¿æ¥ã€‚å½“æ”¶åˆ°æ–­å¼€è¿æ¥çš„æ¶ˆæ¯æ—¶ï¼Œä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¼šå…³é—­å®¢æˆ·ç«¯çš„é€šé“ï¼Œå¹¶å‘é€ä¸€ä¸ªMQTTæ–­å¼€è¿æ¥æ¶ˆæ¯ç»™å®¢æˆ·ç«¯ã€‚ getAddressæ–¹æ³•ç”¨äºè·å–å®¢æˆ·ç«¯çš„è¿æ¥åœ°å€ã€‚è¿™ä¸ªæ–¹æ³•ä¼šä»ä¸Šä¸‹æ–‡ä¸­è·å–å®¢æˆ·ç«¯çš„åœ°å€ï¼Œå¦‚æœè·å–å¤±è´¥ï¼Œä¼šä½¿ç”¨è¿œç¨‹åœ°å€ä½œä¸ºå¤‡é€‰æ–¹æ¡ˆã€‚ operationCompleteæ–¹æ³•å®ç°äº†GenericFutureListeneræ¥å£çš„æ–¹æ³•ã€‚å½“ä¸€ä¸ªæ“ä½œå®Œæˆæ—¶ï¼Œä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œä¼šæ£€æŸ¥clientIdæ˜¯å¦ä¸ºnullï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æ–­å¼€è¿æ¥ï¼Œå‘é€ä¸€ä¸ªMQTTæ–­å¼€è¿æ¥æ¶ˆæ¯ç»™å®¢æˆ·ç«¯ã€‚ exceptionCaughtæ–¹æ³•ç”¨äºå¤„ç†å¼‚å¸¸ã€‚å½“å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¼šè®°å½•å¼‚å¸¸ä¿¡æ¯ï¼Œå¹¶æ–­å¼€è¿æ¥ã€‚ channelReadCompleteæ–¹æ³•ç”¨äºåˆ·æ–°ç¼“å†²åŒºã€‚å½“ä¸€æ¡æ¶ˆæ¯è¯»å–å®Œæˆæ—¶ï¼Œä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚ channelReadæ–¹æ³•æ˜¯ä¸»è¦å¤„ç†æ–¹æ³•ã€‚å½“æ¥æ”¶åˆ°æ•°æ®æ—¶ï¼Œä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•è¿›è¡Œå¤„ç†ã€‚è¿™ä¸ªæ–¹æ³•ä¼šå…ˆæ£€æŸ¥addressæ˜¯å¦ä¸ºnullï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ç”Ÿæˆä¸€ä¸ªæ–°çš„addressã€‚ç„¶åï¼Œä¼šæ ¹æ®æ¥æ”¶åˆ°çš„MQTTæ¶ˆæ¯ç±»å‹è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚ channelReadæ–¹æ³•ç”¨äºå¤„ç†æ¥è‡ªç½‘ç»œé€šé“çš„æ¶ˆæ¯ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒå¤„ç†çš„æ˜¯MQTTåè®®çš„æ¶ˆæ¯ã€‚MQTTæ˜¯ä¸€ç§è½»é‡çº§çš„é€šä¿¡åè®®ï¼Œç”¨äºç®€åŒ–ç½‘ç»œåº”ç”¨ç¨‹åºä¹‹é—´çš„é€šä¿¡ã€‚è¿™æ®µä»£ç çš„ä¸»è¦ä½œç”¨æ˜¯è§£æå’Œå¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„MQTTæ¶ˆæ¯ã€‚\nå®ç°åŸç†ï¼š\né¦–å…ˆï¼Œä»£ç æ£€æŸ¥addressæ˜¯å¦ä¸ºnullï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è°ƒç”¨getAddress(ctx)è·å–å®¢æˆ·ç«¯çš„åœ°å€ï¼Œå¹¶å°†å…¶è®¾ç½®åˆ°addresså˜é‡ä¸­ã€‚åŒæ—¶ï¼Œå°†addressè®¾ç½®åˆ°clientSessionCtxä¸­ã€‚è¿™æ ·å¯ä»¥æ–¹ä¾¿åœ°åœ¨æ—¥å¿—ä¸­è®°å½•å®¢æˆ·ç«¯çš„åœ°å€ã€‚ å¦‚æœlog.isTraceEnabled()ä¸ºtrueï¼Œåˆ™è®°å½•ä¸‹å½“å‰å¤„ç†çš„æ¶ˆæ¯ï¼Œä»¥ä¾¿äºè°ƒè¯•å’Œæ—¥å¿—åˆ†æã€‚ å°†ctxè®¾ç½®åˆ°clientSessionCtxä¸­ï¼Œè¿™æ ·åç»­çš„å¤„ç†éƒ½å¯ä»¥é€šè¿‡clientSessionCtxæ¥è¿›è¡Œã€‚ æ£€æŸ¥æ¥æ”¶åˆ°çš„æ¶ˆæ¯msgæ˜¯å¦æ˜¯MqttMessageç±»å‹ã€‚å¦‚æœä¸æ˜¯ï¼Œåˆ™è®°å½•ä¸€æ¡è­¦å‘Šä¿¡æ¯ï¼Œå¹¶æ–­å¼€ä¸å®¢æˆ·ç«¯çš„è¿æ¥ã€‚ å¦‚æœæ¶ˆæ¯msgçš„è§£ç ç»“æœä¸æˆåŠŸï¼Œåˆ™è®°å½•ä¸€æ¡è­¦å‘Šä¿¡æ¯ï¼Œå¹¶æ–­å¼€ä¸å®¢æˆ·ç«¯çš„è¿æ¥ã€‚å¦‚æœæ¶ˆæ¯msgçš„è§£ç ç»“æœæ˜¯TooLongFrameExceptionå¼‚å¸¸ï¼Œåˆ™æ–­å¼€è¿æ¥çš„åŸå› æ˜¯ON_PACKET_TOO_LARGEï¼Œå¦åˆ™æ–­å¼€è¿æ¥çš„åŸå› æ˜¯ON_MALFORMED_PACKETã€‚ è°ƒç”¨processMqttMsgæ–¹æ³•å¤„ç†MqttMessageç±»å‹çš„æ¶ˆæ¯ã€‚ åœ¨å¤„ç†æ¶ˆæ¯åï¼Œ finally å—ä¸­ï¼Œé€šè¿‡ReferenceCountUtil.safeRelease(msg)é‡Šæ”¾æ¶ˆæ¯msgçš„å¼•ç”¨è®¡æ•°ã€‚ processMqttMsg æ–¹æ³•æ¥æ”¶ä¸€ä¸ªMqttMessageå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œç„¶åæ ¹æ®æ¶ˆæ¯çš„ç±»å‹è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚\nå®ç°åŸç†ï¼š\né¦–å…ˆï¼Œå®ƒæ£€æŸ¥æ¶ˆæ¯çš„å›ºå®šå¤´éƒ¨æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªåè®®è¿åå¼‚å¸¸ã€‚ æ¥ä¸‹æ¥ï¼Œå®ƒæ£€æŸ¥å®¢æˆ·ç«¯IDï¼ˆclientIdï¼‰æ˜¯å¦ä¸ºç©ºã€‚å¦‚æœæ˜¯è¿æ¥æ¶ˆæ¯ï¼ˆCONNECTï¼‰ï¼Œåˆ™åˆå§‹åŒ–ä¼šè¯ï¼ˆinitSessionæ–¹æ³•ï¼‰ï¼›å¦åˆ™ï¼Œå¦‚æœclientIdä¸ºç©ºï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªåè®®è¿åå¼‚å¸¸ã€‚ ç„¶åï¼Œå®ƒè®°å½•å®¢æˆ·ç«¯æ—¥å¿—ï¼ˆclientLoggerï¼‰å¹¶ä½¿ç”¨ä¸€ä¸ªswitchè¯­å¥æ ¹æ®æ¶ˆæ¯ç±»å‹è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚ ç”¨é€”ï¼š\nè¿™ä¸ªæ–¹æ³•ä¸»è¦ç”¨äºå¤„ç†MQTTæ¶ˆæ¯ï¼Œæ ¹æ®æ¶ˆæ¯ç±»å‹è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚\nä¾‹å¦‚ï¼Œå½“æ”¶åˆ°CONNECTæ¶ˆæ¯æ—¶ï¼Œå®ƒéœ€è¦åˆå§‹åŒ–ä¼šè¯ï¼›æ”¶åˆ°SUBSCRIBEæ¶ˆæ¯æ—¶ï¼Œéœ€è¦è®¢é˜…topicï¼›æ”¶åˆ°PUBLISHæ¶ˆæ¯æ—¶ï¼Œéœ€è¦å‘å¸ƒæ¶ˆæ¯ç­‰ã€‚\nClientMqttActorManagerImpl è¿™ä¸ªä»£ç æ˜¯ä¸€ä¸ªJavaå®ç°çš„MQTTå®¢æˆ·ç«¯ ActorSystemï¼Œç”¨äºå¤„ç†MQTTæ¶ˆæ¯ã€‚ä»¥ä¸‹æ˜¯è¿™ä¸ªä»£ç çš„ä¸»è¦å®ç°åŸç†ã€ç”¨é€”å’Œæ³¨æ„äº‹é¡¹ï¼š\nå®ç°åŸç†ï¼šè¿™ä¸ªç±»ä½¿ç”¨äº†Akkaæ¡†æ¶çš„ActorSystemæ¥å¤„ç†MQTTæ¶ˆæ¯ã€‚ActorSystemæ˜¯ä¸€ä¸ªç”¨äºç»„ç»‡å’Œç®¡ç†Akkaactorçš„å±‚æ¬¡ç»“æ„ã€‚Actoræ˜¯Akkaçš„æ ¸å¿ƒæ¦‚å¿µï¼Œå®ƒå…è®¸ä»£ç ä»¥æ¶ˆæ¯ä¼ é€’çš„æ–¹å¼ç¼–å†™ï¼Œä»è€Œå®ç°å¹¶è¡Œå’Œæ— é˜»å¡çš„å¼‚æ­¥ç¼–ç¨‹ã€‚åœ¨è¿™ä¸ªç±»ä¸­ï¼ŒClientMqttActorManagerImplä½œä¸ºç®¡ç†å™¨ï¼Œè´Ÿè´£åˆ›å»ºã€é…ç½®å’Œæ§åˆ¶Actorçš„åˆ›å»ºå’Œæ¶ˆæ¯å¤„ç†ã€‚ ç”¨é€”ï¼šè¿™ä¸ªç±»çš„ä¸»è¦ç”¨é€”æ˜¯å¤„ç†MQTTæ¶ˆæ¯ï¼Œç‰¹åˆ«æ˜¯è¿æ¥ã€æ–­è¿ã€è®¢é˜…å’Œå–æ¶ˆè®¢é˜…ç­‰æ¶ˆæ¯ã€‚é€šè¿‡è¿™ä¸ªç±»ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä¸ActorSystemé€šä¿¡ï¼Œä»è€Œå¤„ç†MQTTæ¶ˆæ¯ã€‚ Akka æ˜¯ä¸€ä¸ªç”¨äºå¼€å‘å¹¶å‘åº”ç”¨ç¨‹åºçš„Javaæ¡†æ¶ï¼Œå®ƒåŸºäºAkka Actoræ¨¡å‹ã€‚ActorSystemæ˜¯ä¸€ä¸ªç”¨äºç»„ç»‡å’Œç®¡ç†Akkaactorçš„å±‚æ¬¡ç»“æ„ã€‚Actoræ˜¯Akkaçš„æ ¸å¿ƒæ¦‚å¿µï¼Œå®ƒå…è®¸ä»£ç ä»¥æ¶ˆæ¯ä¼ é€’çš„æ–¹å¼ç¼–å†™ï¼Œä»è€Œå®ç°å¹¶è¡Œå’Œæ— é˜»å¡çš„å¼‚æ­¥ç¼–ç¨‹ã€‚ActorSystemçš„ä¸»è¦ä½œç”¨æ˜¯åˆ›å»ºã€é…ç½®å’Œæ§åˆ¶Actorçš„åˆ›å»ºå’Œæ¶ˆæ¯å¤„ç†ã€‚\nåœ¨è¿™ä¸ªç³»ç»Ÿä¸­ï¼ŒActoræ˜¯åŸºæœ¬çš„é€šä¿¡å•å…ƒã€‚å®ƒä»¬é€šè¿‡æ¶ˆæ¯ä¼ é€’è¿›è¡Œé€šä¿¡ï¼Œè€Œä¸æ˜¯ç›´æ¥è°ƒç”¨å…¶ä»–æ–¹æ³•ã€‚è¿™ç§è®¾è®¡å…è®¸ä»£ç ä»¥ä¸€ç§çµæ´»çš„æ–¹å¼ç¼–å†™ï¼Œä»è€Œé€‚åº”å¹¶å‘ç¼–ç¨‹çš„è¦æ±‚ã€‚ActorSystemçš„ä¸»è¦ç»„ä»¶åŒ…æ‹¬ï¼š\nCelluloidï¼šè¿™æ˜¯ä¸€ä¸ªç”¨äºåè°ƒå¹¶å‘è¡Œä¸ºçš„åº“ï¼Œå®ƒæä¾›äº†åŸºæœ¬çš„çº¿ç¨‹å®‰å…¨å’Œé€šä¿¡æœºåˆ¶ã€‚ JSR 229ï¼šè¿™æ˜¯ä¸€ä¸ªJavaæ ‡å‡†è§„èŒƒï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªç”¨äºå¤„ç†æ¶ˆæ¯çš„APIã€‚Akkaä½¿ç”¨JSR 229 APIæ¥å®ç°Actorä¹‹é—´çš„é€šä¿¡ã€‚ ThreadPoolï¼šè¿™æ˜¯ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œå®ƒç”¨äºåœ¨Actorç³»ç»Ÿä¸­å…±äº«çº¿ç¨‹èµ„æºã€‚è¿™æ ·å¯ä»¥æé«˜æ€§èƒ½ï¼Œé¿å…é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ã€‚ Mailboxï¼šè¿™æ˜¯ä¸€ä¸ªæ¶ˆæ¯å­˜å‚¨ç»“æ„ï¼Œç”¨äºå­˜å‚¨Actoræ”¶åˆ°çš„æ¶ˆæ¯ã€‚Mailboxå¯ä»¥ç¡®ä¿æ¶ˆæ¯çš„å®‰å…¨æ€§å’Œé¡ºåºæ€§ã€‚ ActorRefï¼šè¿™æ˜¯ä¸€ä¸ªå¼•ç”¨ï¼Œç”¨äºè¡¨ç¤ºActorçš„å®ä¾‹ã€‚ActorRefå…è®¸å…¶ä»–Actoré€šè¿‡å…¶è®¿é—®å’Œæ“ä½œActorã€‚ Managerï¼šè¿™æ˜¯ä¸€ä¸ªé«˜çº§çš„Actorç®¡ç†å™¨ï¼Œå®ƒè´Ÿè´£åˆ›å»ºã€é…ç½®å’Œæ§åˆ¶Actorçš„åˆ›å»ºå’Œæ¶ˆæ¯å¤„ç†ã€‚ ActorSystemï¼šè¿™æ˜¯ä¸€ä¸ªå…¨å±€çš„Actorç³»ç»Ÿï¼Œå®ƒè´Ÿè´£ç®¡ç†æ‰€æœ‰çš„Actorå’Œæ¶ˆæ¯ã€‚ æ€»ä¹‹ï¼ŒAkkaæ¡†æ¶çš„ä¸»è¦ç‰¹æ€§æ˜¯å¹¶è¡Œç¼–ç¨‹ï¼Œå®ƒé€šè¿‡ActorSystemæ¥å®ç°ã€‚ActorSystemæ˜¯ä¸€ä¸ªå±‚æ¬¡ç»“æ„ï¼Œç”±Actorç»„æˆï¼Œå®ƒä»¬é€šè¿‡æ¶ˆæ¯ä¼ é€’è¿›è¡Œé€šä¿¡ã€‚è¿™ç§è®¾è®¡ä½¿å¾—ä»£ç æ˜“äºç†è§£å’Œç»´æŠ¤ï¼ŒåŒæ—¶æ»¡è¶³å¹¶å‘ç¼–ç¨‹çš„è¦æ±‚ã€‚\nTbActorMailbox è¿™ä¸ªä»£ç æ˜¯ä¸€ä¸ªå®ç°é«˜ä¼˜å…ˆçº§æ¶ˆæ¯å¤„ç†çš„Javaç±»ã€‚å®ƒä¸»è¦ç”¨äºåœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­å¤„ç†é«˜ä¼˜å…ˆçº§æ¶ˆæ¯ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚ä»¥ä¸‹æ˜¯è¿™ä¸ªç±»çš„è¯¦ç»†è§£é‡Šï¼š\nå®šä¹‰äº†ä¸¤ä¸ªå¸¸é‡HIGH_PRIORITYå’ŒNORMAL_PRIORITYæ¥è¡¨ç¤ºé«˜ä¼˜å…ˆçº§å’Œæ™®é€šä¼˜å…ˆçº§ã€‚ å®šä¹‰äº†ä¸¤ä¸ªå¸¸é‡FREEå’ŒBUSYæ¥è¡¨ç¤ºé‚®ç®±çš„ç©ºé—²çŠ¶æ€å’Œå¤„ç†æ¶ˆæ¯çš„çŠ¶æ€ã€‚ å®šä¹‰äº†ä¸¤ä¸ªå¸¸é‡NOT_READYå’ŒREADYæ¥è¡¨ç¤ºé‚®ç®±æœªå‡†å¤‡å¥½æ¥æ”¶æ¶ˆæ¯å’Œå·²å‡†å¤‡å¥½æ¥æ”¶æ¶ˆæ¯çš„çŠ¶æ€ã€‚ ä½¿ç”¨äº†ConcurrentLinkedQueueæ¥å­˜å‚¨æ¶ˆæ¯ï¼Œä»¥æé«˜æ€§èƒ½ã€‚ initActoræ–¹æ³•ç”¨äºåˆå§‹åŒ– Actorï¼Œå®ƒä¼šå°†åˆå§‹åŒ–ä»»åŠ¡åˆ†é…ç»™çº¿ç¨‹æ± æ‰§è¡Œã€‚ enqueueæ–¹æ³•ç”¨äºå°†æ¶ˆæ¯æ·»åŠ åˆ°é‚®ç®±ä¸­ï¼Œå®ƒä¼šæ ¹æ®æ¶ˆæ¯çš„ä¼˜å…ˆçº§å°†æ¶ˆæ¯æ·»åŠ åˆ°ç›¸åº”çš„é˜Ÿåˆ—ä¸­ã€‚ tryProcessQueueæ–¹æ³•ç”¨äºå¤„ç†æ¶ˆæ¯ï¼Œå®ƒä¼šæ£€æŸ¥é‚®ç®±æ˜¯å¦å·²å‡†å¤‡å¥½æ¥æ”¶æ¶ˆæ¯ï¼Œæ˜¯å¦åœ¨destroyInProgressä¸­ï¼Œä»¥åŠæ˜¯å¦è¿˜æœ‰æ¶ˆæ¯éœ€è¦å¤„ç†ã€‚å¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œå®ƒä¼šè°ƒç”¨processMailboxæ–¹æ³•æ¥å¤„ç†æ¶ˆæ¯ã€‚ processMailboxæ–¹æ³•ç”¨äºå¤„ç†æ¶ˆæ¯ï¼Œå®ƒä¼šä»é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯ï¼Œå¹¶è°ƒç”¨actor.processæ–¹æ³•æ¥å¤„ç†æ¶ˆæ¯ã€‚ getSelfæ–¹æ³•ç”¨äºè·å–å½“å‰çš„ActorIdã€‚ tellæ–¹æ³•ç”¨äºå‘é€æ¶ˆæ¯ç»™å­Actorï¼Œå®ƒä¼šå°†æ¶ˆæ¯å‘é€ç»™ç³»ç»Ÿã€‚ broadcastToChildrenæ–¹æ³•ç”¨äºå‘å­Actorå¹¿æ’­æ¶ˆæ¯ï¼Œå®ƒä¼šå°†æ¶ˆæ¯å¹¿æ’­ç»™ç³»ç»Ÿä¸­æ»¡è¶³æ¡ä»¶çš„å­Actorã€‚ filterChildrenæ–¹æ³•ç”¨äºè¿‡æ»¤å­Actorï¼Œå®ƒä¼šè¿”å›æ»¡è¶³æ¡ä»¶çš„å­Actoråˆ—è¡¨ã€‚ stopæ–¹æ³•ç”¨äºåœæ­¢Actorï¼Œå®ƒä¼šå°†åœæ­¢æ¶ˆæ¯å‘é€ç»™ç³»ç»Ÿã€‚ getOrCreateChildActoræ–¹æ³•ç”¨äºåˆ›å»ºæˆ–è·å–å­Actorï¼Œå®ƒä¼šæ ¹æ®æ¡ä»¶æ¥åˆ›å»ºæˆ–è·å–å­Actorã€‚ destroyæ–¹æ³•ç”¨äºé”€æ¯Actorï¼Œå®ƒä¼šè®¾ç½®destroyInProgressä¸ºtrueï¼Œç„¶åé”€æ¯Actorã€‚ å®ç°äº†TbActorIdæ¥å£ï¼Œè¯¥æ¥å£å®šä¹‰äº†Actorçš„å”¯ä¸€æ ‡è¯†ã€‚ tellå’ŒtellWithHighPriorityæ–¹æ³•ç”¨äºå‘é€æ¶ˆæ¯ç»™å­Actorï¼Œå®ƒä¼šæ ¹æ®æ¶ˆæ¯çš„ä¼˜å…ˆçº§å°†æ¶ˆæ¯æ·»åŠ åˆ°ç›¸åº”çš„é˜Ÿåˆ—ä¸­ã€‚ é€šè¿‡å®ç°è¿™ä¸ªç±»ï¼Œå¯ä»¥åœ¨Actorç³»ç»Ÿä¸­å¤„ç†é«˜ä¼˜å…ˆçº§æ¶ˆæ¯ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚\nMQæ¶ˆæ¯ä¸»é¢˜ï¼š\ntbmq.client.session ClientSessionConsumer tbmq.client.subscriptions ClientSubscriptionConsumer tbmq.client.session.event.request ClientSessionEventConsumer tbmq.msg.persisted tbmq.msg.retained RetainedMsgConsumer tbmq.client.disconnect.chensoulMacBook.local DisconnectClientCommandConsumer tbmq.client.session.event.response.chensoulMacBook.local tbmq.msg.downlink.basic.chensoulMacBook.local tbmq.msg.app.1b2512eca293401e8be2f7376becfb6273758da77822acc28f9debd557f1d97a tbmq.sys.historical.data HistoricalStatsTotalConsumer ","permalink":"https://blog.chensoul.cc/posts/2024/04/28/thingsboard-tbmq-test/","summary":"å¯åŠ¨ TBMQ ç¨‹åºï¼Œæµè§ˆå™¨è®¿é—® http://localhost:8083ï¼Œåˆ›å»ºä¸€ä¸ª Applicationï¼ŒCredentials Type ä¸º BASICï¼Œå®¢æˆ·ç«¯ IDã€ç”¨æˆ·åå’Œå¯†ç å‡è®¾ç½®ä¸º tbmq_app\nä½¿ç”¨ mosquitto æµ‹è¯•è®¢é˜…æ¶ˆæ¯\nmosquitto_sub -d -q 1 -h localhost -p 1883 -t tbmq/demo/+ -i \u0026#39;tbmq_app\u0026#39; -u \u0026#39;tbmq_app\u0026#39; -P \u0026#39;tbmq_app\u0026#39; -c -v Debug è°ƒè¯• MqttSessionHandler ç±»çš„ channelRead(ChannelHandlerContext ctx, Object msg) æ–¹æ³•\nç¬¬ä¸€æ¬¡è¿æ¥ï¼Œæ¶ˆæ¯ç±»å‹æ˜¯ CONNECT\næ¶ˆæ¯ï¼š\nå›ºå®šå¤´ï¼šMqttFixedHeader[messageType=CONNECT, isDup=false, qosLevel=AT_MOST_ONCE, isRetain=false, remainingLength=40]\nå˜é‡å¤´ï¼šMqttConnectVariableHeader[name=MQTT, version=4, hasUserName=true, hasPassword=true, isWillRetain=false, isWillFlag=false, isCleanSession=false, keepAliveTimeSeconds=60]\nè´Ÿè½½ï¼šMqttConnectPayload[clientIdentifier=tbmq_app, willTopic=null, willMessage=null, userName=tbmq_app, password=[116, 98, 109, 113, 95, 97, 112, 112]]\naddress ä¸ºç©ºï¼Œæ•…ä» ChannelHandlerContext è·å–å®¢æˆ·ç«¯åœ°å€ï¼Œå¹¶å°†åœ°å€ä¿æŒåˆ°å®¢æˆ·ç«¯ Session ä¸Šä¸‹æ–‡ ClientSessionCtx\nåˆå§‹åŒ– Sessionï¼šè·å– clientIã€mqtt ç‰ˆæœ¬ï¼Œè°ƒç”¨ ClientMqttActorManager åˆå§‹åŒ– sessionï¼šåˆ›å»º clientActorRefï¼Œå‘é€ä¸€ä¸ª SessionInitMsg æ¶ˆæ¯\nè°ƒç”¨ ClientMqttActorManager connect æ–¹æ³•ï¼Œå‘é€ä¸€ä¸ª MqttConnectMsg æ¶ˆæ¯\nç¬¬äºŒæ¬¡è¿æ¥ï¼Œæ¶ˆæ¯ç±»å‹æ˜¯ SUBSCRIBE\nMqttSubscribeMessage[fixedHeader=MqttFixedHeader[messageType=SUBSCRIBE, isDup=false, qosLevel=AT_LEAST_ONCE, isRetain=false, remainingLength=16], variableHeader=MqttMessageIdAndPropertiesVariableHeader[messageId=1, properties=io.","title":"TBMQæµ‹è¯•å’Œæºç åˆ†æ"},{"content":"docker-compose è¿è¡Œ å‚è€ƒï¼šhttps://thingsboard.io/docs/mqtt-broker/install/cluster/docker-compose-setup/\nä¸‹è½½æºä»£ç \ngit clone -b release-1.3.0 https://github.com/thingsboard/tbmq.git cd tbmq/docker åˆ›å»ºé€»è¾‘å·å¹¶æ‰§è¡Œå®‰è£…ç¨‹åº\n./scripts/docker-create-volumes.sh ./scripts/docker-install-tbmq.sh è¿è¡ŒæœåŠ¡\n./scripts/docker-start-services.sh æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:8083ï¼Œç”¨æˆ·å/å¯†ç ï¼šsysadmin@thingsboard.org / sysadmin\næŸ¥çœ‹ HaProxy æ—¥å¿—ï¼Œå‘ç°å‡ºç°å¼‚å¸¸ï¼šError: Specified qdisc kind is unknown. ã€‚\nç›®å‰ï¼Œå°šæœªæ‰¾åˆ°è§£å†³åŠæ³•ï¼Œåªèƒ½ä¸ä½¿ç”¨ HaProxy è€Œæ˜¯ç›´æ¥è®¿é—® tbmq1ï¼Œä¿®æ”¹ docker-compose.yml ï¼Œæš´éœ²å®¹å™¨ç«¯å£ 8083 åˆ°æœ¬åœ°çš„ 8083ï¼š\ntbmq1: restart: always container_name: \u0026#34;${TBMQ_1_NAME}\u0026#34; image: \u0026#34;${DOCKER_REPO}/${DOCKER_NAME}:${TBMQ_VERSION}\u0026#34; ports: - \u0026#34;1883\u0026#34; - \u0026#34;8083:8083\u0026#34; #ä¿®æ”¹è¿™é‡Œ - \u0026#34;8084\u0026#34; ç„¶åï¼Œé€šè¿‡æµè§ˆå™¨è®¿é—® æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:8081\næºç ç¼–è¯‘å¹¶è¿è¡Œ å®‰è£…å¥½ JDK 17+ å’Œ Maven3.6.3+\nä¸‹è½½æºä»£ç \ngit clone -b release-1.3.0 https://github.com/thingsboard/tbmq.git cd tbmq ç¼–è¯‘ä»£ç \nmvn clean install -DskipTests é€šè¿‡ docker-compose æœ¬åœ°å®‰è£… postgresã€kafkaã€redis\nå‚è€ƒ docker ç›®å½•ä¸‹çš„æ–‡ä»¶æ–°å»º docker-compose.postgres.yml æ–‡ä»¶ï¼š\nversion: \u0026#39;3.0\u0026#39; services: postgres: restart: always image: postgres:15 ports: - \u0026#34;5432:5432\u0026#34; environment: POSTGRES_DB: thingsboard_mqtt_broker POSTGRES_PASSWORD: postgres volumes: - postgres-data:/var/lib/postgresql/data volumes: postgres-data: æ–°å»º docker-compose.redis.yml æ–‡ä»¶ï¼š\nversion: \u0026#39;3.0\u0026#39; services: # Redis standalone redis: restart: always image: bitnami/redis:7.2 ports: - \u0026#39;6379:6379\u0026#39; volumes: - redis-data:/bitnami/redis/data command: redis-server --requirepass 123456 healthcheck: test: [ \u0026#34;CMD\u0026#34;, \u0026#34;redis-cli\u0026#34;,\u0026#34;-a\u0026#34;,\u0026#34;123456\u0026#34;,\u0026#34;--raw\u0026#34;, \u0026#34;incr\u0026#34;,\u0026#34;ping\u0026#34; ] interval: 5s timeout: 2s retries: 10 volumes: redis-data: æ–°å»º docker-compose.kafka.yml æ–‡ä»¶ï¼š\nversion: \u0026#39;3.0\u0026#39; services: kafka: restart: always image: bitnami/kafka:3.7.0 ports: - \u0026#34;9092:9092\u0026#34; env_file: - kafka.env æ–°å»º kafka.env ï¼š\nKAFKA_CFG_NODE_ID=0 KAFKA_CFG_PROCESS_ROLES=controller,broker KAFKA_CFG_CONTROLLER_QUORUM_VOTERS=0@kafka:9093 KAFKA_CFG_LISTENERS=PLAINTEXT://:9092,CONTROLLER://:9093 KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://:9092 KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT KAFKA_CFG_CONTROLLER_LISTENER_NAMES=CONTROLLER KAFKA_CFG_INTER_BROKER_LISTENER_NAME=PLAINTEXT KAFKA_CFG_AUTO_CREATE_TOPICS_ENABLE=false KAFKA_CFG_LOG_RETENTION_BYTES=1073741824 KAFKA_CFG_LOG_SEGMENT_BYTES=268435456 KAFKA_CFG_LOG_RETENTION_MS=300000 KAFKA_CFG_LOG_CLEANUP_POLICY=delete æœ¬åœ° hosts æ–‡ä»¶æ·»åŠ ä¸€è¡Œï¼š\nlocalhost kafka å¯¼å…¥ IDE è¿è¡Œ\nå…ˆè¿è¡Œ ThingsboardMqttBrokerInstallApplication ç±»æ‰§è¡Œå®‰è£…ç¨‹åºã€‚ç„¶åï¼Œè¿è¡Œ ThingsboardMqttBrokerApplication ç±»ï¼Œå¯åŠ¨åº”ç”¨ã€‚\nå¯åŠ¨æˆåŠŸä¹‹åï¼Œæµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:8083ï¼Œç”¨æˆ·å/å¯†ç ï¼šsysadmin@thingsboard.org / sysadmin\n","permalink":"https://blog.chensoul.cc/posts/2024/04/17/thingsboard-tbmq-local-docker-run/","summary":"docker-compose è¿è¡Œ å‚è€ƒï¼šhttps://thingsboard.io/docs/mqtt-broker/install/cluster/docker-compose-setup/\nä¸‹è½½æºä»£ç \ngit clone -b release-1.3.0 https://github.com/thingsboard/tbmq.git cd tbmq/docker åˆ›å»ºé€»è¾‘å·å¹¶æ‰§è¡Œå®‰è£…ç¨‹åº\n./scripts/docker-create-volumes.sh ./scripts/docker-install-tbmq.sh è¿è¡ŒæœåŠ¡\n./scripts/docker-start-services.sh æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:8083ï¼Œç”¨æˆ·å/å¯†ç ï¼šsysadmin@thingsboard.org / sysadmin\næŸ¥çœ‹ HaProxy æ—¥å¿—ï¼Œå‘ç°å‡ºç°å¼‚å¸¸ï¼šError: Specified qdisc kind is unknown. ã€‚\nç›®å‰ï¼Œå°šæœªæ‰¾åˆ°è§£å†³åŠæ³•ï¼Œåªèƒ½ä¸ä½¿ç”¨ HaProxy è€Œæ˜¯ç›´æ¥è®¿é—® tbmq1ï¼Œä¿®æ”¹ docker-compose.yml ï¼Œæš´éœ²å®¹å™¨ç«¯å£ 8083 åˆ°æœ¬åœ°çš„ 8083ï¼š\ntbmq1: restart: always container_name: \u0026#34;${TBMQ_1_NAME}\u0026#34; image: \u0026#34;${DOCKER_REPO}/${DOCKER_NAME}:${TBMQ_VERSION}\u0026#34; ports: - \u0026#34;1883\u0026#34; - \u0026#34;8083:8083\u0026#34; #ä¿®æ”¹è¿™é‡Œ - \u0026#34;8084\u0026#34; ç„¶åï¼Œé€šè¿‡æµè§ˆå™¨è®¿é—® æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:8081\næºç ç¼–è¯‘å¹¶è¿è¡Œ å®‰è£…å¥½ JDK 17+ å’Œ Maven3.6.3+\nä¸‹è½½æºä»£ç \ngit clone -b release-1.3.0 https://github.com/thingsboard/tbmq.git cd tbmq ç¼–è¯‘ä»£ç \nmvn clean install -DskipTests é€šè¿‡ docker-compose æœ¬åœ°å®‰è£… postgresã€kafkaã€redis\nå‚è€ƒ docker ç›®å½•ä¸‹çš„æ–‡ä»¶æ–°å»º docker-compose.postgres.yml æ–‡ä»¶ï¼š\nversion: \u0026#39;3.0\u0026#39; services: postgres: restart: always image: postgres:15 ports: - \u0026#34;5432:5432\u0026#34; environment: POSTGRES_DB: thingsboard_mqtt_broker POSTGRES_PASSWORD: postgres volumes: - postgres-data:/var/lib/postgresql/data volumes: postgres-data: æ–°å»º docker-compose.","title":"ThingsBoard TBMQæœ¬åœ°å’Œé€šè¿‡Dockerè¿è¡Œ"},{"content":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\nChatGPT ç¼–å†™ä¸€ä¸ª RateLimitAspect ç±»ï¼Œå®ç°åŸºäºç”¨æˆ·çš„ get æŸ¥è¯¢è¯·æ±‚çš„é™æµåŠŸèƒ½\n@Aspect @Component public class RateLimitAspect { private final RedisTemplate\u0026lt;String, Object\u0026gt; redisTemplate; private final Logger logger = LoggerFactory.getLogger(RateLimitAspect.class); private final int maxRequests; // Maximum number of requests private final int timeWindow; // Time window in seconds @Autowired public RateLimitAspect(RedisTemplate\u0026lt;String, Object\u0026gt; redisTemplate) { this.redisTemplate = redisTemplate; this.maxRequests = 100; // Default maximum number of requests is 100 this.timeWindow = 60; // Default time window is 60 seconds } @Before(\u0026#34;@annotation(getMapping)\u0026#34;) public void applyRateLimit(JoinPoint joinPoint, GetMapping getMapping) { HttpServletRequest request = ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest(); if (request != null \u0026amp;\u0026amp; HttpMethod.GET.matches(request.getMethod())) { String username = request.getUserPrincipal().getName(); // Get the username if (username != null \u0026amp;\u0026amp; !username.isEmpty()) { String rateLimitKey = \u0026#34;rate_limit:\u0026#34; + username; incrementAndCheckRateLimit(rateLimitKey, request); } } } private void incrementAndCheckRateLimit(String rateLimitKey, HttpServletRequest request) { Long currentRequests = redisTemplate.execute((RedisCallback\u0026lt;Long\u0026gt;) connection -\u0026gt; { Object nativeConnection = connection.getNativeConnection(); String script = \u0026#34;local current = redis.call(\u0026#39;INCR\u0026#39;, KEYS[1])\\n\u0026#34; + \u0026#34;if tonumber(current) == 1 then\\n\u0026#34; + \u0026#34; redis.call(\u0026#39;EXPIRE\u0026#39;, KEYS[1], ARGV[1])\\n\u0026#34; + \u0026#34;end\\n\u0026#34; + \u0026#34;return current\u0026#34;; return (Long) ((RedisOperations\u0026lt;?, ?\u0026gt;) nativeConnection).execute( (RedisCallback\u0026lt;Object\u0026gt;) connection1 -\u0026gt; connection1.eval( script.getBytes(), redisTemplate.getKeySerializer(), // Use custom Key serializer redisTemplate.getValueSerializer(), // Use custom Value serializer Collections.singletonList(rateLimitKey.getBytes()), Collections.singletonList(String.valueOf(timeWindow).getBytes()) ) ); }); if (currentRequests \u0026gt; maxRequests) { String urlWithParams = getRequestUrlWithParams(request); logger.warn(\u0026#34;Rate limit exceeded for key: {}. Request URL with Params: {}\u0026#34;, rateLimitKey, urlWithParams); throw new RateLimitException(); } } private String getRequestUrlWithParams(HttpServletRequest request) { String url = request.getRequestURL().toString(); String queryString = request.getQueryString(); if (queryString != null \u0026amp;\u0026amp; !queryString.isEmpty()) { url += \u0026#34;?\u0026#34; + queryString; } return url; } } è°ƒæ•´ spring-cloud-examples ç›®å½•ï¼Œé€šè¿‡æºç åˆ†æ SpringBoot 2.7.18 å¯åŠ¨è¿‡ç¨‹\n","permalink":"https://blog.chensoul.cc/posts/2024/02/20/til/","summary":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\nChatGPT ç¼–å†™ä¸€ä¸ª RateLimitAspect ç±»ï¼Œå®ç°åŸºäºç”¨æˆ·çš„ get æŸ¥è¯¢è¯·æ±‚çš„é™æµåŠŸèƒ½\n@Aspect @Component public class RateLimitAspect { private final RedisTemplate\u0026lt;String, Object\u0026gt; redisTemplate; private final Logger logger = LoggerFactory.getLogger(RateLimitAspect.class); private final int maxRequests; // Maximum number of requests private final int timeWindow; // Time window in seconds @Autowired public RateLimitAspect(RedisTemplate\u0026lt;String, Object\u0026gt; redisTemplate) { this.redisTemplate = redisTemplate; this.maxRequests = 100; // Default maximum number of requests is 100 this.timeWindow = 60; // Default time window is 60 seconds } @Before(\u0026#34;@annotation(getMapping)\u0026#34;) public void applyRateLimit(JoinPoint joinPoint, GetMapping getMapping) { HttpServletRequest request = ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest(); if (request != null \u0026amp;\u0026amp; HttpMethod.GET.matches(request.getMethod())) { String username = request.getUserPrincipal().getName(); // Get the username if (username !","title":"2024-02-20ï½œRateLimitAspectè¯·æ±‚é™æµã€è°ƒæ•´spring-cloud-examplesé¡¹ç›®ç»“æ„"},{"content":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\né‡æ„ foodie-cloud é¡¹ç›® åŸºäº docker å®ç°æ•°æ®åº“é…ç½®ä¸»ä»å¤åˆ¶ï¼Œé›†æˆ Sharding Sphere å®ç°è¯»å†™åˆ†ç¦» ","permalink":"https://blog.chensoul.cc/posts/2024/02/19/til/","summary":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\né‡æ„ foodie-cloud é¡¹ç›® åŸºäº docker å®ç°æ•°æ®åº“é…ç½®ä¸»ä»å¤åˆ¶ï¼Œé›†æˆ Sharding Sphere å®ç°è¯»å†™åˆ†ç¦» ","title":"2024-02-19ï½œfoodie-cloudé›†æˆSharding Sphereå®ç°è¯»å†™åˆ†ç¦»"},{"content":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\nNewReliceï¼šåº”ç”¨æ€§èƒ½ç›‘æ§\nhttps://www.cnblogs.com/caoweixiong/p/14798449.html Top 6 Tools to Turn Code into Beautiful Diagrams ï¼š\nDiagrams Go Diagrams Mermaid PlantUML ASCII diagramsï¼Œasciiflow \u0026amp; monodraw Markmap foodie-cloud é¡¹ç›®\næµ‹è¯• resilience4j ä½¿ç”¨ bash æµ‹è¯•æ¥å£ï¼štest-em-all.sh ä½¿ç”¨ docker éƒ¨ç½²é¡¹ç›® ","permalink":"https://blog.chensoul.cc/posts/2024/02/18/til/","summary":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\nNewReliceï¼šåº”ç”¨æ€§èƒ½ç›‘æ§\nhttps://www.cnblogs.com/caoweixiong/p/14798449.html Top 6 Tools to Turn Code into Beautiful Diagrams ï¼š\nDiagrams Go Diagrams Mermaid PlantUML ASCII diagramsï¼Œasciiflow \u0026amp; monodraw Markmap foodie-cloud é¡¹ç›®\næµ‹è¯• resilience4j ä½¿ç”¨ bash æµ‹è¯•æ¥å£ï¼štest-em-all.sh ä½¿ç”¨ docker éƒ¨ç½²é¡¹ç›® ","title":"2024-02-18ï½œNewReliceåº”ç”¨æ€§èƒ½ç›‘æ§ã€6ä¸ªDiagramså·¥å…·ã€foodie-foodæµ‹è¯•"},{"content":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\nåˆ›å»ºé¡¹ç›® spring-cloud-examplesï¼Œæµ‹è¯• Spring Cloud Config ä½¿ç”¨æœ¬åœ°æ–‡ä»¶å’Œ git ä»“åº“ä½œä¸ºé…ç½®ä¸­å¿ƒ Spring Cloud Config æ˜¯ä¸€ä¸ªåŸºäºhttpåè®®çš„è¿œç¨‹é…ç½®å®ç°æ–¹å¼ã€‚é€šè¿‡ç»Ÿä¸€çš„é…ç½®ç®¡ç†æœåŠ¡å™¨è¿›è¡Œé…ç½®ç®¡ç†ï¼Œå®¢æˆ·ç«¯é€šè¿‡httpåè®®ä¸»åŠ¨çš„æ‹‰å–æœåŠ¡çš„çš„é…ç½®ä¿¡æ¯ï¼Œå®Œæˆé…ç½®è·å–ã€‚\nSpring Cloud Config æ”¯æŒä»¥ä¸‹å‡ ç§å­˜å‚¨æ–¹å¼ï¼š\nGit ä»“åº“ æœ¬åœ°æ–‡ä»¶ Vault JDBC æ•°æ®åº“ æœ¬æ–‡ä¸»è¦åˆ†äº« Spring Cloud Config ä½¿ç”¨æœ¬åœ°æ–‡ä»¶å’ŒGit ä»“åº“å­˜å‚¨é…ç½®æ–‡ä»¶ã€é…ç½®æ–‡ä»¶åŠ è§£å¯†ã€é›†æˆ Spring Cloud Bus ç­‰å†…å®¹ï¼Œæºç åœ¨ githubï¼šspring-cloud-examplesã€‚\næœ¬åœ°æ–‡ä»¶ æœåŠ¡ç«¯åº”ç”¨ 1. åˆ›å»ºé¡¹ç›® é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªç›®å½•\nmkdir spring-cloud-examples cd spring-cloud-examples ç„¶åï¼Œåˆ›å»º config ç›®å½•ï¼Œå¹¶ä½¿ç”¨ spring cli åˆ›å»ºä¸€ä¸ª maven é¡¹ç›®ï¼Œé¡¹ç›®åç§° config-server-file\nmkdir config cd config spring init \\ --boot-version=3.2.2 \\ --type=maven-project \\ --java-version=8 \\ --name=config-server-file \\ --package-name=com.chensoul.springcloud \\ --groupId=com.chensoul.springcloud \\ --dependencies=cloud-config-server,actuator \\ config-server-file â€‹\té¡¹ç›®åˆ›å»ºæˆåŠŸä¹‹åï¼Œå°† spring-boot-starter-parent ç‰ˆæœ¬æ”¹ä¸º 2.7.18ï¼Œå¯¹åº”çš„å°† spring-cloud.version æ”¹ä¸º 2021.0.9ã€‚\n2. æ·»åŠ  @EnableConfigServer æ³¨è§£ @EnableConfigServer @SpringBootApplication public class ConfigServerFileApplication { public static void main(final String[] args) { SpringApplication.run(ConfigServerFileApplication.class, args); } } 3. ä¿®æ”¹é…ç½®æ–‡ä»¶ å°† application.properties é‡å‘½åä¸º application.ymlï¼Œå¹¶æ·»åŠ å¦‚ä¸‹é…ç½®\nserver: port: 8888 spring.application.name: config-server-file spring.profiles.active: native management.endpoint.health.show-details: ALWAYS management.endpoints.web.exposure.include: \u0026#34;*\u0026#34; # default value: classpath:/, classpath:/config, file:./, file:./config spring.cloud.config.server.native.search-locations: file:${PWD}/config-repo è¯´æ˜ï¼š\nä½¿ç”¨æœ¬åœ°é…ç½®æ–‡ä»¶ï¼Œè¦æ±‚ spring.profiles.active å¿…é¡»ä¸º native ${PWD} æŒ‡å‘çš„æ˜¯å½“å‰é¡¹ç›®çš„è·¯å¾„ åˆ›å»º config-repo ç›®å½•ï¼Œç”¨äºä¿å­˜é…ç½®æ–‡ä»¶ï¼š\nmkdir config-repo åœ¨ config-repo ç›®å½•åˆ›å»ºä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ foo.ymlï¼š\nfoo: hello world 4. å¯åŠ¨åº”ç”¨ å¯åŠ¨åº”ç”¨ä¹‹åï¼Œå¯ä»¥è®¿é—® /actuator ã€‚\n$ curl http://localhost:8888/actuator/ -s | jq { \u0026#34;_links\u0026#34;: { \u0026#34;self\u0026#34;: { \u0026#34;href\u0026#34;: \u0026#34;http://localhost:8888/actuator\u0026#34;, \u0026#34;templated\u0026#34;: false }, ... \u0026#34;refresh\u0026#34;: { \u0026#34;href\u0026#34;: \u0026#34;http://localhost:8888/actuator/refresh\u0026#34;, \u0026#34;templated\u0026#34;: false }, \u0026#34;features\u0026#34;: { \u0026#34;href\u0026#34;: \u0026#34;http://localhost:8888/actuator/features\u0026#34;, \u0026#34;templated\u0026#34;: false } } } æ­¤å¤–ï¼Œé…ç½®æœåŠ¡å™¨è¿˜æš´éœ²ä»¥ä¸‹å‡ ä¸ªç«¯ç‚¹ï¼š\n/encrypt å’Œ /decrypt /{application}/{profile}[/{label}] /{application}-{profile}.yml /{label}/{application}-{profile}.yml /{application}-{profile}.properties /{label}/{application}-{profile}.properties è¯´æ˜ï¼š\napplicationï¼šåº”ç”¨åç§° profileï¼šspring çš„ profile labelï¼šgit ä»“åº“çš„åˆ†æ”¯åç§° é’ˆå¯¹å½“å‰é¡¹ç›®çš„ foo.yml é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥è®¿é—®çš„è·¯å¾„æœ‰ï¼š\nhttp://localhost:8888/foo/native http://localhost:8888/foo-native.yml http://localhost:8888/foo-native.yaml http://localhost:8888/foo-native.properties http://localhost:8888/foo-native.json http://localhost:8888/foo/native/master http://localhost:8888/foo/native,default/master http://localhost:8888/master/foo-native.properties http://localhost:8888/master/foo-native.yml http://localhost:8888/master/foo-native.yaml http://localhost:8888/master/foo-native.json ä¾‹å¦‚ï¼Œè®¿é—® localhost:8888/foo/native :\n$ curl -s localhost:8888/foo/native | jq { \u0026#34;name\u0026#34;: \u0026#34;foo\u0026#34;, \u0026#34;profiles\u0026#34;: [ \u0026#34;native\u0026#34; ], \u0026#34;label\u0026#34;: null, \u0026#34;version\u0026#34;: null, \u0026#34;state\u0026#34;: null, \u0026#34;propertySources\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;file:/Users/chensoul/workspace/IdeaProjects/spring-cloud-examples/config-repo/foo.yml\u0026#34;, \u0026#34;source\u0026#34;: { \u0026#34;foo\u0026#34;: \u0026#34;hello world\u0026#34; } } ] } è®¿é—® http://localhost:8888/actuator/env å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ propertySources é…ç½®ï¼š\n$ curl -s localhost:8080/actuator/env | jq { \u0026#34;activeProfiles\u0026#34;: [ \u0026#34;native\u0026#34; ], \u0026#34;propertySources\u0026#34;: [ { \u0026#34;name\u0026#34;: \u0026#34;server.ports\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;local.server.port\u0026#34;: { \u0026#34;value\u0026#34;: 8888 } } }, { \u0026#34;name\u0026#34;: \u0026#34;servletContextInitParams\u0026#34;, \u0026#34;properties\u0026#34;: {} }, { \u0026#34;name\u0026#34;: \u0026#34;systemProperties\u0026#34;, \u0026#34;properties\u0026#34;: { } }, { \u0026#34;name\u0026#34;: \u0026#34;systemEnvironment\u0026#34;, \u0026#34;properties\u0026#34;: { } }, { \u0026#34;name\u0026#34;: \u0026#34;configServerClient\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;spring.cloud.config.enabled\u0026#34;: { \u0026#34;value\u0026#34;: \u0026#34;false\u0026#34; } } }, { \u0026#34;name\u0026#34;: \u0026#34;springCloudClientHostInfo\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;spring.cloud.client.hostname\u0026#34;: { \u0026#34;value\u0026#34;: \u0026#34;192.168.3.214\u0026#34; }, \u0026#34;spring.cloud.client.ip-address\u0026#34;: { \u0026#34;value\u0026#34;: \u0026#34;192.168.3.214\u0026#34; } } }, { \u0026#34;name\u0026#34;: \u0026#34;Config resource \u0026#39;class path resource [application.yml]\u0026#39; via location \u0026#39;optional:classpath:/\u0026#39;\u0026#34;, \u0026#34;properties\u0026#34;: { \u0026#34;server.port\u0026#34;: { \u0026#34;value\u0026#34;: 8888, \u0026#34;origin\u0026#34;: \u0026#34;class path resource [application.yml] - 2:9\u0026#34; }, \u0026#34;spring.profiles.active\u0026#34;: { \u0026#34;value\u0026#34;: \u0026#34;native\u0026#34;, \u0026#34;origin\u0026#34;: \u0026#34;class path resource [application.yml] - 6:13\u0026#34; }, \u0026#34;spring.cloud.config.server.native.search-locations\u0026#34;: { \u0026#34;value\u0026#34;: \u0026#34;file:/Users/chensoul/workspace/IdeaProjects/spring-cloud-examples/config-repo\u0026#34;, \u0026#34;origin\u0026#34;: \u0026#34;class path resource [application.yml] - 9:53\u0026#34; }, \u0026#34;management.endpoints.web.exposure.include\u0026#34;: { \u0026#34;value\u0026#34;: \u0026#34;*\u0026#34;, \u0026#34;origin\u0026#34;: \u0026#34;class path resource [application.yml] - 15:18\u0026#34; }, \u0026#34;management.endpoint.env.post.enabled\u0026#34;: { \u0026#34;value\u0026#34;: true, \u0026#34;origin\u0026#34;: \u0026#34;class path resource [application.yml] - 19:18\u0026#34; } } } ] } propertySources åŒ…æ‹¬ï¼š\nserver.ports servletContextInitParams systemProperties systemEnvironment configServerClient springCloudClientHostInfo optional:classpath:/ ä¸­çš„ application.yml æŸ¥çœ‹ foo.yml é…ç½®æ–‡ä»¶å†…å®¹ï¼š\n$ curl http://localhost:8888/foo-native.yml foo: hello world 5. å¼€å¯ Security æ·»åŠ  security ä¾èµ–ï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-security\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®ç”¨æˆ·åå’Œå¯†ç ï¼š\nspring.security.user.name: ${SPRING_SECURITY_USER_NAME:root} spring.security.user.password: ${SPRING_SECURITY_USER_PASSWORD:123456} æˆ–è€…é€šè¿‡ç¯å¢ƒå˜é‡ SPRING_SECURITY_USER_NAMEã€SPRING_SECURITY_USER_PASSWORD è¿›è¡Œè®¾ç½®ã€‚\né‡å¯åº”ç”¨ï¼Œå†æ¬¡è®¿é—®é…ç½®æœåŠ¡å™¨æ—¶éœ€è¦æŒ‡å®šç”¨æˆ·åå’Œå¯†ç ï¼Œä¾‹å¦‚ï¼ŒæŸ¥çœ‹ foo.yml é…ç½®æ–‡ä»¶å†…å®¹ï¼š\n$ curl http://root:123456@localhost:8888/foo/native -s | jq test: hello world 6. åŠ è§£å¯†ä¿¡æ¯ æ”¯æŒä¸¤ç§é…ç½®æ–¹å¼ï¼š\nç¬¬ä¸€ç§ï¼Œå¯¹ç§°åŠ å¯†ã€‚é…ç½®åŠ å¯† key å’Œ salt\nencrypt.key: ${ENCRYPT_KEY:123456} encrypt.salt: deadbeef # å¯é€‰ï¼Œé»˜è®¤å€¼ä¸º deadbeef æˆ–è€…é€šè¿‡ç¯å¢ƒå˜é‡ ENCRYPT_KEY è¿›è¡Œè®¾ç½®ã€‚\nç¬¬äºŒç§ï¼Œåˆ†å¯¹ç§°åŠ å¯†ã€‚\né¦–å…ˆï¼Œéœ€è¦ç”Ÿæˆ keystore æ–‡ä»¶ï¼š\ncd config-server-file/src/main/resources keytool -genkeypair -alias mytestkey -storetype PKCS12 -keyalg RSA -dname \u0026#34;CN=Web Server,OU=Unit,O=Organization,L=City,S=State,C=US\u0026#34; -keypass changeme -keystore server.jks -storepass changeme ç„¶åï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼š\nencrypt: key-store: location: classpath:server.jks password: changeme alias: mytestkey secret: changeme æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ç¬¬ä¸€ç§é…ç½®æ–¹å¼è¿›è¡Œæµ‹è¯•ã€‚\né‡å¯åº”ç”¨ï¼ŒåŠ å¯† \u0026ldquo;hello world\u0026rdquo;ï¼š\n$ curl -s http://root:123456@localhost:8888/encrypt --data-urlencode \u0026#34;hello world\u0026#34; 1245fd945d0a14e529a0cafe0b6367206d69cad381d4d733ba21d348a303865e è§£å¯†ï¼š\n$ curl -s http://root:123456@localhost:8888/decrypt -d 1245fd945d0a14e529a0cafe0b6367206d69cad381d4d733ba21d348a303865e hello world åœ¨é…ç½®æ–‡ä»¶ä½¿ç”¨åŠ å¯†å­—ç¬¦ä¸²ã€‚ä¿®æ”¹ foo.yml ä¸­ test çš„å€¼ä¸ºä¸Šé¢ç”Ÿæˆçš„åŠ å¯†å­—ç¬¦ä¸²ï¼š\nfoo: \u0026#39;{cipher}1245fd945d0a14e529a0cafe0b6367206d69cad381d4d733ba21d348a303865e\u0026#39; é‡å¯åº”ç”¨ï¼ŒæŸ¥çœ‹ foo.yml æ–‡ä»¶å†…å®¹ï¼š\n$ curl http://root:123456@localhost:8888/foo/native -s | jq foo: hello world 7. é›†æˆ Eureka æ³¨å†Œä¸­å¿ƒ æ·»åŠ  eureka å®¢æˆ·ç«¯ä¾èµ–ï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-starter-netflix-eureka-client\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; æ·»åŠ  eureka é…ç½®ï¼š\neureka: instance: prefer-ip-address: true instance-id: ${spring.cloud.client.ip-address}:${server.port} # å®¢æˆ·ç«¯å‘æ³¨å†Œä¸­å¿ƒå‘é€å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼Œé»˜è®¤30ç§’ leaseRenewalIntervalInSeconds: 5 #æ³¨å†Œä¸­å¿ƒåœ¨æ”¶åˆ°å®¢æˆ·ç«¯å¿ƒè·³ä¹‹åï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡å¿ƒè·³çš„è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœåœ¨è¿™ä¸ªæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°ä¸‹æ¬¡å¿ƒè·³ï¼Œåˆ™ç§»é™¤è¯¥å®¢æˆ·ç«¯ã€‚é»˜è®¤90ç§’ leaseExpirationDurationInSeconds: 30 client: service-url: defaultZone: http://localhost:8761/eureka/ initialInstanceInfoReplicationIntervalSeconds: 5 registryFetchIntervalSeconds: 5 8. é…ç½®é«˜å¯ç”¨ æœ‰ä¸¤ç§æ–¹å¼ï¼š\néƒ¨ç½²å¤šå®ä¾‹ï¼Œç„¶åä½¿ç”¨è´Ÿè½½å‡è¡¡è¿›è¡Œä»£ç† æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒï¼Œéƒ¨ç½²å¤šå®ä¾‹ å®¢æˆ·ç«¯åº”ç”¨ 1. åˆ›å»ºé¡¹ç›® ä½¿ç”¨ spring cli åˆ›å»ºä¸€ä¸ª maven é¡¹ç›® config-client\nspring init \\ --boot-version=3.2.2 \\ --type=maven-project \\ --java-version=8 \\ --name=config-server-file-client \\ --package-name=com.chensoul.springcloud \\ --groupId=com.chensoul.springcloud \\ --dependencies=cloud-config-client,web,actuator \\ config-client å°† spring-boot-starter-parent ç‰ˆæœ¬æ”¹ä¸º 2.7.18ï¼Œå¯¹åº”çš„å°† spring-cloud.version æ”¹ä¸º 2021.0.9\n2. ä¿®æ”¹é…ç½®æ–‡ä»¶ å°† application.properties é‡å‘½åä¸º application.ymlï¼Œå¹¶æ·»åŠ å¦‚ä¸‹é…ç½®\nspring.application.name: config-client management.endpoint.health.show-details: ALWAYS management.endpoints.web.exposure.include: \u0026#34;*\u0026#34; # 1. é»˜è®¤ä» http://localhost:8888 è·å–é…ç½® # 2. å¦‚æœæ²¡æœ‰é…ç½® optional: åˆ™ Config Client è¿æ¥ä¸åˆ° Config Server æ—¶å°±ä¼šå¤±è´¥ # 3. import é…ç½®ä¼˜å…ˆäº uri é…ç½® # 4. é…ç½®äº†åå°±ä¸éœ€è¦ bootstrap å¼•å¯¼æ–‡ä»¶ spring.config.import: \u0026#34;optional:configserver:\u0026#34; spring: cloud: config: uri: http://localhost:8888 åœ¨ config-repo ç›®å½•æ·»åŠ å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ config-client.yml\ntest: hello world 3. åˆ›å»ºä¸€ä¸ª controller @RefreshScope @RestController @SpringBootApplication public class ConfigClientApplication { @Value(\u0026#34;${test}\u0026#34;) private String test; @GetMapping(\u0026#34;/test\u0026#34;) public String test() { return this.test; } public static void main(final String[] args) { SpringApplication.run(ConfigFileClientApplication.class, args); } } 4. å¯åŠ¨åº”ç”¨ æŸ¥çœ‹ test çš„å€¼\n$ curl http://localhost:8080/test test: hello world æŸ¥çœ‹ config-client åº”ç”¨çš„é…ç½®ï¼š\n$ curl http://root:123456@localhost:8888/config-client.yml test: hello world 5. é…ç½®é‡è¯• æ·»åŠ  spring-retry ä¾èµ–ï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.retry\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-retry\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-aop\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; ä¿®æ”¹é…ç½®æ·»åŠ é‡è¯•å‚æ•°ï¼š\nspring: cloud: config: uri: http://localhost:8888 # å®¢æˆ·ç«¯é…ç½®å¿«é€Ÿå¤±è´¥ fail-fast: true # é…ç½®é‡è¯•ï¼Œéœ€è¦å¼•å…¥ spring-retry retry: initialInterval: 1000 multiplier: 1.1 maxInterval: 10000 maxAttempts: 6 æ³¨æ„ï¼šé‡è¯•å‚æ•°ä¹Ÿå¯ä»¥æ·»åŠ åˆ° url åé¢ï¼š\nspring.config.import: configserver:http://configserver.example.com?fail-fast=true\u0026amp;max-attempts=10\u0026amp;max-interval=1500\u0026amp;multiplier=1.2\u0026amp;initial-interval=1100\u0026#34; 6. é…ç½®å…¶ä»–å‚æ•° é…ç½®å®¢æˆ·ç«¯å¿«é€Ÿå¤±è´¥å’Œè¿æ¥è¶…æ—¶ï¼š\nspring: cloud: config: uri: http://localhost:8888 # å®¢æˆ·ç«¯é…ç½®å¿«é€Ÿå¤±è´¥ fail-fast: true # é…ç½®é‡è¯•ï¼Œéœ€è¦å¼•å…¥ spring-retry retry: initialInterval: 1000 multiplier: 1.1 maxInterval: 10000 maxAttempts: 6 request-connect-timeout: 3000 request-read-timeout: 3000 7. å¼€å¯ Security æœåŠ¡ç«¯å¼€å¯äº† security ä¹‹åï¼Œå®¢æˆ·ç«¯å¯åŠ¨æ—¶ä¼šæŠ¥é”™ï¼š\norg.springframework.cloud.config.client.ConfigClientFailFastException: Could not locate PropertySource and the fail fast property is set, failing Caused by: org.springframework.web.client.UnknownContentTypeException: Could not extract response: no suitable HttpMessageConverter found for response type [class org.springframework.cloud.config.environment.Environment] and content type [text/html;charset=UTF-8] è¿™æ—¶å€™ï¼Œå®¢æˆ·ç«¯éœ€è¦è®¾ç½®ç”¨æˆ·åå’Œå¯†ç ã€‚ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š\nspring: cloud: config: uri: http://localhost:8888 username: ${SPRING_SECURITY_USER_NAME:root} password: ${SPRING_SECURITY_USER_PASSWORD:123456} é‡å¯ä¹‹åï¼Œå†æ¬¡æŸ¥çœ‹ test çš„å€¼ï¼š\n$ curl http://localhost:8080/test hello world 8. é›†æˆ Eureka æ³¨å†Œä¸­å¿ƒ æ·»åŠ  eureka å®¢æˆ·ç«¯ä¾èµ–ï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-starter-netflix-eureka-client\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š\nspring: cloud: config: # uri: http://localhost:8888 discovery: enabled: true service-id: config-server-file Git ä»“åº“ æœåŠ¡ç«¯åº”ç”¨ 1. åˆ›å»ºé¡¹ç›® ä½¿ç”¨ spring cli åˆ›å»ºä¸€ä¸ª maven é¡¹ç›® config-server-git\ncd config spring init \\ --boot-version=3.2.2 \\ --type=maven-project \\ --java-version=8 \\ --name=config-server-git \\ --package-name=com.chensoul.springcloud \\ --groupId=com.chensoul.springcloud \\ --dependencies=cloud-config-server,actuator \\ config-server-git å°† spring-boot-starter-parent ç‰ˆæœ¬æ”¹ä¸º 2.7.18ï¼Œå¯¹åº”çš„å°† spring-cloud.version æ”¹ä¸º 2021.0.9\n2. æ·»åŠ  @EnableConfigServer æ³¨è§£ @EnableConfigServer @SpringBootApplication public class ConfigServerGitApplication { public static void main(final String[] args) { SpringApplication.run(ConfigServerGitApplication.class, args); } } 3. ä¿®æ”¹é…ç½®æ–‡ä»¶ å°† application.properties é‡å‘½åä¸º application.ymlï¼Œå¹¶æ·»åŠ å¦‚ä¸‹é…ç½®\nserver: port: 8888 spring.application.name: config-server-git management.endpoint.health.show-details: ALWAYS management.endpoints.web.exposure.include: \u0026#34;*\u0026#34; spring.cloud.config.server.git.uri: https://github.com/chensoul/spring-cloud-examples spring.cloud.config.server.git.search-paths: config-repo spring.cloud.config.server.git.default-label: config # ä½¿ç”¨ config åˆ†æ”¯ è¯´æ˜ï¼š\nsearch-pathsï¼šæœç´¢è·¯å¾„ï¼Œå¯ä»¥æ˜¯å¤šä¸ªï¼Œä½¿ç”¨é€—å·è¿æ¥ï¼Œæ”¯æŒ * åŒ¹é… default-labelï¼šæŒ‡å®šé»˜è®¤åˆ†æ”¯ 4. é…ç½®å‚æ•° spring: cloud: config: server: git: uri: file:${PWD}/config-repo username: username password: password skipSslValidation: true timeout: 4 force-pull: true deleteUntrackedBranches: true refreshRate: 0 defaultLabel: main tryMasterBranch: false å¦‚æœæ˜¯ç§æœ‰ä»“åº“ï¼Œåˆ™éœ€è¦é…ç½®è®¤è¯ï¼Œæˆ–è€…ä½¿ç”¨ ssh ç§é’¥ï¼Œé…ç½®æ–¹å¼ï¼Œè¯·å‚è€ƒ Git SSH configuration using propertiesã€‚\n5. å¯åŠ¨åº”ç”¨ æŸ¥çœ‹ test çš„å€¼\n$ curl http://localhost:8080/test hello world 6. å¼€å¯ Security æ·»åŠ  security ä¾èµ–ï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-security\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®ç”¨æˆ·åå’Œå¯†ç ï¼š\nspring.security.user.name: ${SPRING_SECURITY_USER_NAME:root} spring.security.user.password: ${SPRING_SECURITY_USER_PASSWORD:123456} æˆ–è€…é€šè¿‡ç¯å¢ƒå˜é‡ SPRING_SECURITY_USER_NAMEã€SPRING_SECURITY_USER_PASSWORD è¿›è¡Œè®¾ç½®ã€‚\né‡å¯åº”ç”¨ï¼Œå†æ¬¡è®¿é—®é…ç½®æœåŠ¡å™¨æ—¶éœ€è¦æŒ‡å®šç”¨æˆ·åå’Œå¯†ç ï¼Œä¾‹å¦‚ï¼ŒæŸ¥çœ‹ foo.yml é…ç½®æ–‡ä»¶å†…å®¹ï¼š\n$ curl http://root:123456@localhost:8888/foo-native.yml foo: hello world æŸ¥çœ‹ config-client åº”ç”¨çš„é…ç½®ï¼š\n$ curl http://root:123456@localhost:8888/config-client.yml test: hello world å®¢æˆ·ç«¯åº”ç”¨ 1. åˆ›å»ºåº”ç”¨ åœ¨ config-client é¡¹ç›®åŸºç¡€ä¸Šï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶\nå› ä¸ºæœåŠ¡ç«¯é…ç½®æ–‡ä»¶æ˜¯åœ¨ config åˆ†æ”¯ï¼ˆspring.cloud.config.server.git.default-label: configï¼‰ï¼Œæ•…å®¢æˆ·ç«¯ä¹Ÿåº”è¯¥è®¾ç½®åˆ†æ”¯ spring.cloud.config.label: configï¼š\nspring.application.name: config-client management.endpoint.health.show-details: ALWAYS management.endpoints.web.exposure.include: \u0026#34;*\u0026#34; # 1. é»˜è®¤ä» http://localhost:8888 è·å–é…ç½® # 2. å¦‚æœæ²¡æœ‰é…ç½® optional: åˆ™ Config Client è¿æ¥ä¸åˆ° Config Server æ—¶å°±ä¼šå¤±è´¥ # 3. import é…ç½®ä¼˜å…ˆäº uri é…ç½® # 4. é…ç½®äº†åå°±ä¸éœ€è¦ bootstrap å¼•å¯¼æ–‡ä»¶ spring.config.import: \u0026#34;optional:configserver:\u0026#34; spring: cloud: config: uri: http://localhost:8888 label: config # å®¢æˆ·ç«¯é…ç½®å¿«é€Ÿå¤±è´¥ fail-fast: true # é…ç½®é‡è¯•ï¼Œéœ€è¦å¼•å…¥ spring-retry retry: initialInterval: 1000 multiplier: 1.1 maxInterval: 10000 maxAttempts: 6 2. å¯åŠ¨åº”ç”¨ é‡å¯åº”ç”¨ï¼ŒæŸ¥çœ‹ test çš„å€¼\n$ curl http://root:123456@localhost:8080/test hello world 3. å¼€å¯ security æœåŠ¡ç«¯å¼€å¯ security ä¹‹åï¼Œå®¢æˆ·ç«¯éœ€è¦è®¾ç½®ç”¨æˆ·åå’Œå¯†ç ã€‚ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š\nspring: cloud: config: uri: http://localhost:8888 label: config username: ${SPRING_SECURITY_USER_NAME:root} password: ${SPRING_SECURITY_USER_PASSWORD:123456} é‡å¯ä¹‹åï¼Œå†æ¬¡æŸ¥çœ‹ test çš„å€¼ï¼š\n$ curl http://localhost:8080/test hello world 4. æµ‹è¯•æ‰‹åŠ¨æ›´æ–°é…ç½® ä¿®æ”¹ config-client.yml æ–‡ä»¶ä¸­ test çš„å€¼ä¸º \u0026ldquo;hello world 1111\u0026rdquo;ï¼Œå¹¶æäº¤åˆ° git ä»“åº“ã€‚\né€šè¿‡é…ç½®æœåŠ¡ï¼ŒæŸ¥çœ‹ config-client åº”ç”¨çš„é…ç½®ï¼Œå‘ç° test çš„å€¼å·²ç»æ›´æ–°ã€‚\n$ curl http://root:123456@localhost:8888/config-client.yml test: hello world ç„¶åï¼Œå†æ¬¡æŸ¥çœ‹å®¢æˆ·ç«¯çš„ test çš„å€¼ï¼š\n$ curl http://localhost:8080/test hello world å‘ç° test å€¼å¹¶æ²¡æœ‰æ›´æ–°ï¼Œè¿™æ—¶å€™éœ€è¦è°ƒç”¨å®¢æˆ·ç«¯çš„ /actuator/refresh æ‰‹åŠ¨æ›´æ–°ã€‚\n$ curl -X POST http://localhost:8080/actuator/refresh [\u0026#34;config.client.version\u0026#34;,\u0026#34;test\u0026#34;]% è¿”å›å†…å®¹ï¼Œè¯´æ˜ config.client.version å’Œ test çš„å€¼æœ‰æ›´æ–°ã€‚å¦‚æœæ²¡æœ‰è¿”å›ï¼Œè¯´æ˜æ‰§è¡Œå¼‚å¸¸ã€‚\nå†æ¬¡æŸ¥çœ‹å®¢æˆ·ç«¯çš„ test çš„å€¼ï¼Œå‘ç° test å€¼å·²ä¿®æ”¹ä¸º \u0026ldquo;hello world 1111\u0026rdquo;ï¼š\n$ curl http://localhost:8080/test hello world 1111 è¯´æ˜ï¼š\n/actuator/refresh åªèƒ½æ›´æ–°å•ä¸ªå®¢æˆ·ç«¯çš„é…ç½®ï¼Œå¦‚æœæœ‰å¤šä¸ªå®¢æˆ·ç«¯éœ€è¦ä¸€ä¸ªä¸ªæ‰§è¡Œåˆ·æ–°æ¥å£ã€‚ é›†æˆ Spring Cloud Bus æœåŠ¡ç«¯åº”ç”¨ 1. åˆ›å»ºåº”ç”¨ åœ¨ config-server-git é¡¹ç›®åŸºç¡€ä¸Šï¼Œæ·»åŠ ä¾èµ–ï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-starter-bus-amqp\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; 2. ä¿®æ”¹é…ç½®æ–‡ä»¶ æ·»åŠ  rabbitmq é…ç½®\nspring.rabbitmq: host: 127.0.0.1 port: 5672 username: guest password: 123456 3. é‡å¯åº”ç”¨ å®¢æˆ·ç«¯åº”ç”¨ 1. åˆ›å»ºåº”ç”¨ åœ¨ config-client é¡¹ç›®åŸºç¡€ä¸Šï¼Œæ·»åŠ ä¾èµ–ï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-starter-bus-amqp\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; 2. ä¿®æ”¹é…ç½®æ–‡ä»¶ æ·»åŠ  rabbitmq é…ç½®\nspring.rabbitmq: host: 127.0.0.1 port: 5672 username: guest password: 123456 3. é‡å¯åº”ç”¨ æŸ¥çœ‹ test çš„å€¼\n$ curl http://root:123456@localhost:8888/config-client-default.yml test: hello world 1111 $ curl http://localhost:8080/test hello world 1111 4. è‡ªåŠ¨åˆ·æ–°é…ç½® spring cloud bus æä¾›äº†ä¸¤ä¸ªç«¯ç‚¹ï¼š\n/actuator/busrefreshï¼šé€šè¿‡è¯¥æ¥å£åˆ·æ–°é…ç½®ï¼Œspring cloud bus ä¼šå¹¿æ’­ç»™æ‰€æœ‰å®¢æˆ·ç«¯ä»è€Œåˆ·æ–°é…ç½® /actuator/busenv ä½¿ç”¨ POST è¯·æ±‚è®¿é—® /actuator/busenvï¼Œä¿®æ”¹ config-client.yml æ–‡ä»¶ä¸­ test çš„å€¼ä¸º \u0026ldquo;hello world 2222\u0026rdquo;ï¼š\ncurl -X POST -H \u0026#39;Content-Type: application/json\u0026#39; -d \u0026#39;{\u0026#34;name\u0026#34;:\u0026#34;test\u0026#34;,\u0026#34;value\u0026#34;:\u0026#34;hello world 2222\u0026#34;}\u0026#39; http://localhost:8080/actuator/busenv æŸ¥çœ‹å®¢æˆ·ç«¯æ—¥å¿—ï¼š\n2024-02-06 11:33:06.003 INFO 11387 --- [nio-8080-exec-7] o.s.c.b.event.EnvironmentChangeListener : Received remote environment change request. Keys/values to update {test=hello world 2222} è¿™æ—¶å€™æŸ¥çœ‹ï¼Œè¿”å›å†…å®¹ä¸ºï¼š\n$ curl http://root:123456@localhost:8888/config-client-default.yml test: hello world 1111 $ curl http://localhost:8080/test hello world 1111 å¯ä»¥çœ‹åˆ° test å±æ€§çš„å€¼è¿˜æ²¡æœ‰åˆ·æ–°ã€‚é€šè¿‡ /actuator/busrefresh åˆ·æ–°é…ç½®ï¼š\ncurl -X POST http://localhost:8080/actuator/busrefresh å†æ¬¡æŸ¥çœ‹ï¼Œå¯ä»¥çœ‹åˆ° test å±æ€§çš„å€¼å·²ç»åˆ·æ–°ã€‚\n$ curl http://localhost:8080/test hello world 2222 5. é€šè¿‡ git åˆ·æ–°é…ç½® åœ¨ git ä»“åº“ä¸­ä¿®æ”¹ test çš„å€¼ä¸º \u0026ldquo;hello world 3333\u0026rdquo;ï¼Œç„¶åæ‰§è¡Œåˆ·æ–°æ“ä½œï¼š\ncurl -X POST http://localhost:8080/actuator/busrefresh æŸ¥çœ‹å®¢æˆ·ç«¯æ—¥å¿—ï¼š\nReceived remote refresh request. Fetching config from server at : http://localhost:8888 Located environment: name=config-client, profiles=[default], label=config, version=cfcb38e6d396ce6b85e0aa0e8839f38538b7f221, state=null Keys refreshed [config.client.version, test] å†æ¬¡æŸ¥çœ‹ï¼Œå¯ä»¥çœ‹åˆ° test å±æ€§çš„å€¼å·²ç»åˆ·æ–°ã€‚\n$ curl http://localhost:8080/test hello world 3333% å¦å¤–ï¼Œå¦‚æœæƒ³å®ç° git ä¸Šä¿®æ”¹ä¹‹åç«‹å³æ¨é€ï¼Œåˆ™éœ€è¦é…ç½® git çš„ webhook åŠŸèƒ½ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2024/02/05/til/","summary":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\nåˆ›å»ºé¡¹ç›® spring-cloud-examplesï¼Œæµ‹è¯• Spring Cloud Config ä½¿ç”¨æœ¬åœ°æ–‡ä»¶å’Œ git ä»“åº“ä½œä¸ºé…ç½®ä¸­å¿ƒ Spring Cloud Config æ˜¯ä¸€ä¸ªåŸºäºhttpåè®®çš„è¿œç¨‹é…ç½®å®ç°æ–¹å¼ã€‚é€šè¿‡ç»Ÿä¸€çš„é…ç½®ç®¡ç†æœåŠ¡å™¨è¿›è¡Œé…ç½®ç®¡ç†ï¼Œå®¢æˆ·ç«¯é€šè¿‡httpåè®®ä¸»åŠ¨çš„æ‹‰å–æœåŠ¡çš„çš„é…ç½®ä¿¡æ¯ï¼Œå®Œæˆé…ç½®è·å–ã€‚\nSpring Cloud Config æ”¯æŒä»¥ä¸‹å‡ ç§å­˜å‚¨æ–¹å¼ï¼š\nGit ä»“åº“ æœ¬åœ°æ–‡ä»¶ Vault JDBC æ•°æ®åº“ æœ¬æ–‡ä¸»è¦åˆ†äº« Spring Cloud Config ä½¿ç”¨æœ¬åœ°æ–‡ä»¶å’ŒGit ä»“åº“å­˜å‚¨é…ç½®æ–‡ä»¶ã€é…ç½®æ–‡ä»¶åŠ è§£å¯†ã€é›†æˆ Spring Cloud Bus ç­‰å†…å®¹ï¼Œæºç åœ¨ githubï¼šspring-cloud-examplesã€‚\næœ¬åœ°æ–‡ä»¶ æœåŠ¡ç«¯åº”ç”¨ 1. åˆ›å»ºé¡¹ç›® é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªç›®å½•\nmkdir spring-cloud-examples cd spring-cloud-examples ç„¶åï¼Œåˆ›å»º config ç›®å½•ï¼Œå¹¶ä½¿ç”¨ spring cli åˆ›å»ºä¸€ä¸ª maven é¡¹ç›®ï¼Œé¡¹ç›®åç§° config-server-file\nmkdir config cd config spring init \\ --boot-version=3.2.2 \\ --type=maven-project \\ --java-version=8 \\ --name=config-server-file \\ --package-name=com.chensoul.springcloud \\ --groupId=com.chensoul.springcloud \\ --dependencies=cloud-config-server,actuator \\ config-server-file â€‹\té¡¹ç›®åˆ›å»ºæˆåŠŸä¹‹åï¼Œå°† spring-boot-starter-parent ç‰ˆæœ¬æ”¹ä¸º 2.7.18ï¼Œå¯¹åº”çš„å°† spring-cloud.version æ”¹ä¸º 2021.0.9ã€‚\n2. æ·»åŠ  @EnableConfigServer æ³¨è§£ @EnableConfigServer @SpringBootApplication public class ConfigServerFileApplication { public static void main(final String[] args) { SpringApplication.run(ConfigServerFileApplication.class, args); } } 3.","title":"2024-02-05ï½œSpring Cloud Configå¿«é€Ÿå…¥é—¨"},{"content":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\né‡æ„ foodie-cloud é¡¹ç›®\né›†æˆ Resilience4j ä¿®æ”¹ README.md æ–‡æ¡£ é˜…è¯»åšå®¢ https://blog.csdn.net/weixin_42189048\nEnum + Validation çš„ä¸ªäººæœ€ä½³å®è·µ demo åˆ†äº« ","permalink":"https://blog.chensoul.cc/posts/2024/02/04/til/","summary":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\né‡æ„ foodie-cloud é¡¹ç›®\né›†æˆ Resilience4j ä¿®æ”¹ README.md æ–‡æ¡£ é˜…è¯»åšå®¢ https://blog.csdn.net/weixin_42189048\nEnum + Validation çš„ä¸ªäººæœ€ä½³å®è·µ demo åˆ†äº« ","title":"2024-02-04ï½œfoodie-cloudé›†æˆResilience4j"},{"content":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\nå‚è€ƒ ã€ŠMicroservices with Spring Boot 3 and Spring Cloudã€‹ï¼Œé‡æ„ foodie-cloud é¡¹ç›® é›†æˆ Spring Cloud Config ä½¿ç”¨æ–‡ä»¶ä¿å­˜é…ç½®æ–‡ä»¶\né›†æˆ SpringDoc OpenAPI åŸºäº Javadoc ç”Ÿæˆ API æ–‡æ¡£\ntodoï¼š\né›†æˆ Resilience4j\né›†æˆ Zipkin\néƒ¨ç½²åˆ° Kubernetes\né›†æˆ EFK\né›†æˆ Spring Cloud Bus\n","permalink":"https://blog.chensoul.cc/posts/2024/02/02/til/","summary":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\nå‚è€ƒ ã€ŠMicroservices with Spring Boot 3 and Spring Cloudã€‹ï¼Œé‡æ„ foodie-cloud é¡¹ç›® é›†æˆ Spring Cloud Config ä½¿ç”¨æ–‡ä»¶ä¿å­˜é…ç½®æ–‡ä»¶\né›†æˆ SpringDoc OpenAPI åŸºäº Javadoc ç”Ÿæˆ API æ–‡æ¡£\ntodoï¼š\né›†æˆ Resilience4j\né›†æˆ Zipkin\néƒ¨ç½²åˆ° Kubernetes\né›†æˆ EFK\né›†æˆ Spring Cloud Bus","title":"2024-02-02ï½œfoodie-cloudé›†æˆSpring Cloud Configå’ŒSpringDoc"},{"content":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\né‡æ„ foodie-cloud é¡¹ç›®ï¼Œéƒ¨ç½²åˆ° docker å®¹å™¨ ä½¿ç”¨ Spring Initializr åˆ›å»ºé¡¹ç›® ä½¿ç”¨ Spring Initializr åˆ›å»ºé¡¹ç›® å®‰è£… spring cli\nä½¿ç”¨ brew å®‰è£…çš„ spring cli ç‰ˆæœ¬æ˜¯ 3.x ç‰ˆæœ¬\nbrew tap pivotal/tap brew install springboot ä½¿ç”¨ sdkman å®‰è£…ï¼š\nsdk install springboot 3.2.2 æŸ¥çœ‹ç‰ˆæœ¬ï¼š\n$ spring version Spring CLI v3.2.2 æŸ¥çœ‹ spring cli æ”¯æŒçš„å‘½ä»¤\nspring help æŸ¥çœ‹ init å‘½ä»¤è¯´æ˜ï¼š\nspring help init å‚è€ƒ spring init å‘½ä»¤ï¼š\nspring init --list å¯ä»¥çœ‹åˆ°æ”¯æŒçš„ä¾èµ–\nactivemq actuator amqp artemis azure-active-directory azure-cosmos-db azure-keyvault azure-storage azure-support batch cache camel cloud-bus cloud-config-client cloud-config-server cloud-contract-stub-runner cloud-contract-verifier cloud-eureka cloud-eureka-server cloud-feign cloud-function cloud-gateway cloud-gateway-reactive cloud-gcp cloud-gcp-pubsub cloud-gcp-storage cloud-loadbalancer cloud-resilience4j cloud-starter cloud-starter-consul-config cloud-starter-consul-discovery cloud-starter-vault-config cloud-starter-zookeeper-config cloud-starter-zookeeper-discovery cloud-stream cloud-task codecentric-spring-boot-admin-client codecentric-spring-boot-admin-server configuration-processor data-cassandra data-cassandra-reactive data-couchbase data-couchbase-reactive data-elasticsearch data-jdbc data-jpa data-ldap data-mongodb data-mongodb-reactive data-neo4j data-r2dbc data-redis data-redis-reactive data-rest data-rest-explorer datadog db2 derby devtools dgs-codegen distributed-tracing docker-compose dynatrace flyway freemarker graphite graphql groovy-templates h2 hateoas hilla hsql influx integration jdbc jersey jooq kafka kafka-streams liquibase lombok mail mariadb modulith mustache mybatis mysql native new-relic oauth2-authorization-server oauth2-client oauth2-resource-server okta oracle picocli postgresql prometheus pulsar pulsar-reactive quartz restdocs rsocket scs-config-client scs-service-registry security sentry session solace spring-shell sqlserver testcontainers thymeleaf timefold-solver unboundid-ldap vaadin validation wavefront web web-services webflux websocket zipkin æ”¯æŒçš„æ„å»ºç³»ç»Ÿæœ‰ï¼š\ngradle-build gradle-project gradle-project-kotlin maven-build maven-project æ”¯æŒçš„å‚æ•°æœ‰ï¼š\nartifactId bootVersion description groupId javaVersion language name packageName packaging type version åˆ›å»ºé¡¹ç›® spring init ä½¿ç”¨çš„æ˜¯ start.spring.io åˆ›å»ºé¡¹ç›®ï¼Œè€Œç›®å‰ start.spring.io æ”¯æŒçš„ spring boot ç‰ˆæœ¬æœ€ä½ä¸º 3.1.0ã€‚å¦‚æœæƒ³åˆ›å»º spring boot2 çš„é¡¹ç›®ï¼Œéœ€è¦åˆ›å»ºé¡¹ç›®ä¹‹åæ‰‹åŠ¨ä¿®æ”¹ç‰ˆæœ¬å·ã€‚\nspring init \\ --boot-version=3.2.2 \\ --type=maven-project \\ --java-version=8 \\ --name=config-file \\ --package-name=com.chensoul.springcloud \\ --groupId=com.chensoul.springcloud \\ --dependencies=cloud-config-server \\ config-file ","permalink":"https://blog.chensoul.cc/posts/2024/02/01/til/","summary":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\né‡æ„ foodie-cloud é¡¹ç›®ï¼Œéƒ¨ç½²åˆ° docker å®¹å™¨ ä½¿ç”¨ Spring Initializr åˆ›å»ºé¡¹ç›® ä½¿ç”¨ Spring Initializr åˆ›å»ºé¡¹ç›® å®‰è£… spring cli\nä½¿ç”¨ brew å®‰è£…çš„ spring cli ç‰ˆæœ¬æ˜¯ 3.x ç‰ˆæœ¬\nbrew tap pivotal/tap brew install springboot ä½¿ç”¨ sdkman å®‰è£…ï¼š\nsdk install springboot 3.2.2 æŸ¥çœ‹ç‰ˆæœ¬ï¼š\n$ spring version Spring CLI v3.2.2 æŸ¥çœ‹ spring cli æ”¯æŒçš„å‘½ä»¤\nspring help æŸ¥çœ‹ init å‘½ä»¤è¯´æ˜ï¼š\nspring help init å‚è€ƒ spring init å‘½ä»¤ï¼š\nspring init --list å¯ä»¥çœ‹åˆ°æ”¯æŒçš„ä¾èµ–\nactivemq actuator amqp artemis azure-active-directory azure-cosmos-db azure-keyvault azure-storage azure-support batch cache camel cloud-bus cloud-config-client cloud-config-server cloud-contract-stub-runner cloud-contract-verifier cloud-eureka cloud-eureka-server cloud-feign cloud-function cloud-gateway cloud-gateway-reactive cloud-gcp cloud-gcp-pubsub cloud-gcp-storage cloud-loadbalancer cloud-resilience4j cloud-starter cloud-starter-consul-config cloud-starter-consul-discovery cloud-starter-vault-config cloud-starter-zookeeper-config cloud-starter-zookeeper-discovery cloud-stream cloud-task codecentric-spring-boot-admin-client codecentric-spring-boot-admin-server configuration-processor data-cassandra data-cassandra-reactive data-couchbase data-couchbase-reactive data-elasticsearch data-jdbc data-jpa data-ldap data-mongodb data-mongodb-reactive data-neo4j data-r2dbc data-redis data-redis-reactive data-rest data-rest-explorer datadog db2 derby devtools dgs-codegen distributed-tracing docker-compose dynatrace flyway freemarker graphite graphql groovy-templates h2 hateoas hilla hsql influx integration jdbc jersey jooq kafka kafka-streams liquibase lombok mail mariadb modulith mustache mybatis mysql native new-relic oauth2-authorization-server oauth2-client oauth2-resource-server okta oracle picocli postgresql prometheus pulsar pulsar-reactive quartz restdocs rsocket scs-config-client scs-service-registry security sentry session solace spring-shell sqlserver testcontainers thymeleaf timefold-solver unboundid-ldap vaadin validation wavefront web web-services webflux websocket zipkin æ”¯æŒçš„æ„å»ºç³»ç»Ÿæœ‰ï¼š","title":"2024-02-01ï½œä½¿ç”¨ Spring Initializr åˆ›å»ºé¡¹ç›®"},{"content":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\nä¸‹è½½ ã€ŠMicroservices with Spring Boot 3 and Spring Cloudã€‹ï¼Œæºç åœ¨ github\nRedis äº‹åŠ¡\nRedisäº‹åŠ¡ åŸç† Redis æ˜¯ä¸€ä¸ªå†…å­˜æ•°æ®åº“ï¼Œå®ƒæ”¯æŒäº‹åŠ¡æ“ä½œã€‚Redis äº‹åŠ¡æ˜¯ä¸€ç³»åˆ—çš„å‘½ä»¤æ“ä½œï¼Œè¿™äº›å‘½ä»¤ä¼šè¢«ä¸€èµ·æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚åœ¨äº‹åŠ¡æ‰§è¡ŒæœŸé—´ï¼Œå…¶ä»–å®¢æˆ·ç«¯æäº¤çš„å‘½ä»¤ä¸ä¼šè¢«æ’å…¥åˆ°äº‹åŠ¡ä¸­ï¼Œç¡®ä¿äº‹åŠ¡çš„åŸå­æ€§ã€‚\nRedis äº‹åŠ¡ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œç®¡ç†ï¼š\nMULTIï¼šæ ‡è®°äº‹åŠ¡çš„å¼€å§‹ã€‚ EXECï¼šæ‰§è¡Œäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤ã€‚ DISCARDï¼šå–æ¶ˆäº‹åŠ¡ï¼Œæ”¾å¼ƒä¹‹å‰çš„æ‰€æœ‰å‘½ä»¤ã€‚ WATCHï¼šç›‘è§†ä¸€ä¸ªæˆ–å¤šä¸ªé”®ï¼Œå¦‚æœåœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰æœ‰å…¶ä»–å®¢æˆ·ç«¯å¯¹è¿™äº›é”®è¿›è¡Œäº†ä¿®æ”¹ï¼Œåˆ™äº‹åŠ¡ä¼šè¢«ä¸­æ­¢ã€‚ UNWATCHï¼šå–æ¶ˆå¯¹æ‰€æœ‰é”®çš„ç›‘è§†ã€‚ åœ¨æ‰§è¡Œäº‹åŠ¡ä¹‹å‰ï¼Œå…ˆä½¿ç”¨ MULTI å‘½ä»¤æ ‡è®°äº‹åŠ¡çš„å¼€å§‹ï¼Œç„¶åæŒ‰é¡ºåºæ‰§è¡Œå¤šä¸ªå‘½ä»¤ã€‚åœ¨æ‰€æœ‰å‘½ä»¤éƒ½è¢«æ·»åŠ åˆ°äº‹åŠ¡é˜Ÿåˆ—ä¹‹åï¼Œä½¿ç”¨ EXEC å‘½ä»¤æ¥æ‰§è¡Œäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤ã€‚å¦‚æœæ‰§è¡ŒæˆåŠŸï¼Œäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤ä¼šè¢«ä¸€èµ·æ‰§è¡Œï¼Œç„¶åè¿”å›ç»“æœã€‚å¦‚æœåœ¨æ‰§è¡Œäº‹åŠ¡æœŸé—´å‘ç”Ÿé”™è¯¯ï¼Œäº‹åŠ¡ä¼šè¢«ä¸­æ­¢ï¼Œæ‰€æœ‰çš„ä¿®æ”¹éƒ½ä¼šè¢«å›æ»šã€‚\nç¤ºä¾‹ ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ Redis äº‹åŠ¡çš„ç¤ºä¾‹ï¼š\n#å¼€å¯äº‹åŠ¡ MULTI SET key1 \u0026#34;value1\u0026#34; SET key2 \u0026#34;value2\u0026#34; GET key1 GET key2 #æ‰§è¡Œäº‹åŠ¡ EXEC # å–æ¶ˆäº‹åŠ¡ discard ä¸Šè¿°äº‹åŠ¡åŒ…å«äº†ä¸¤ä¸ª SET å‘½ä»¤å’Œä¸¤ä¸ª GET å‘½ä»¤ã€‚åœ¨ EXEC å‘½ä»¤æ‰§è¡Œä¹‹åï¼Œå°†ä¼šä¾æ¬¡æ‰§è¡Œè¿™äº›å‘½ä»¤ï¼Œå¹¶è¿”å›ç›¸åº”çš„ç»“æœã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒRedis çš„äº‹åŠ¡æ˜¯ä¹è§‚é”ï¼Œå¹¶ä¸ä¼šåœ¨æ‰§è¡ŒæœŸé—´å¯¹é”®è¿›è¡ŒåŠ é”ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨äº‹åŠ¡æ—¶è¦æ³¨æ„å¹¶å‘æ“ä½œå¯èƒ½å¼•å‘çš„ç«æ€æ¡ä»¶ã€‚\nRediså¯¹äºå‘½ä»¤æ‰§è¡Œé”™è¯¯å¤„ç†ï¼Œæœ‰ä¸¤ç§è§£å†³æ–¹å¼ï¼š\nè¯­æ³•é”™è¯¯ï¼ˆç¼–è¯‘ï¼‰ æ‰§è¡Œé”™è¯¯ï¼ˆè¿è¡Œï¼‰ è¯­æ³•é”™è¯¯ï¼šæ‰§è¡Œå‘½ä»¤çš„è¯­æ³•ä¸æ­£ç¡®ã€‚\n#å¼€å¯äº‹åŠ¡ multi #å‘½ä»¤ set name zhangsan set age seterror sex male #æ‰§è¡Œäº‹åŠ¡ exec #è·å–æ­£ç¡®æŒ‡ä»¤æ•°æ® get name æ­¤æ—¶æ•´ä¸ªäº‹åŠ¡é˜Ÿåˆ—ä¸­ï¼Œå­˜åœ¨ä¸€æ¡æ­£ç¡®æŒ‡ä»¤ï¼Œä¸¤æ¡è¯­æ³•é”™è¯¯æŒ‡ä»¤ï¼Œ å½“æ‰§è¡Œexecåï¼Œä¼šç›´æ¥è¿”å›é”™è¯¯ï¼Œæ­£ç¡®çš„å‘½ä»¤ä¹Ÿä¸ä¼šæ‰§è¡Œã€‚\næ‰§è¡Œé”™è¯¯ï¼šå‘½ä»¤åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ã€‚\n#å¼€å¯äº‹åŠ¡ multi #å‘½ä»¤ set lesson java rpush lesson eureka feign nacos set lesson redis #æ‰§è¡Œäº‹åŠ¡ exec #è·å–æ•°æ® get lesson é€šè¿‡ä¸Šé¢äº‹åŠ¡æ‰§è¡Œå¯ä»¥çœ‹åˆ°ï¼Œè¯­æ³•æœ¬èº«æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œæ‰€ä»¥è¿è¡Œä¹‹å‰redisæ— æ³•å‘ç°é”™è¯¯ï¼Œä½†æ˜¯åœ¨æ‰§è¡Œæ—¶å‡ºç°äº†é”™è¯¯ï¼Œå› æ­¤åªä¼šé”™è¯¯çš„å‘½ä»¤ä¸æ‰§è¡Œï¼Œ è€Œæ­£ç¡®çš„å‘½ä»¤ä»ç„¶èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œã€‚\nSpringBootå®ç°äº‹åŠ¡æ“ä½œ 1ï¼‰ä¿®æ”¹RedisConfigé…ç½®ç±»ï¼Œå¼€å¯äº‹åŠ¡æ§åˆ¶\n@Configuration public class RedisConfig { @Autowired private RedisConnectionFactory redisConnectionFactory; @Bean public RedisTemplate\u0026lt;String, Object\u0026gt; redisTemplate() { RedisTemplate\u0026lt;String, Object\u0026gt; template = new RedisTemplate\u0026lt;\u0026gt;(); template.setConnectionFactory(redisConnectionFactory); // è®¾ç½®åºåˆ—åŒ–å™¨ç­‰å…¶ä»–é…ç½®... template.setKeySerializer(new StringRedisSerializer()); template.setValueSerializer(new GenericJackson2JsonRedisSerializer()); //å¼€å¯redisäº‹åŠ¡æ§åˆ¶ template.setEnableTransactionSupport(true); return template; } } 2ï¼‰è‡ªå®šä¹‰æ–¹æ³•ï¼Œæµ‹è¯•äº‹åŠ¡æ•ˆæœ\n@Test public void multiTest(){ //å¼€å¯äº‹åŠ¡ redisTemplate.multi(); try{ redisTemplate.opsForValue().set(\u0026#34;lesson\u0026#34;,\u0026#34;java\u0026#34;); redisTemplate.opsForSet().add(\u0026#34;lesson\u0026#34;,\u0026#34;eureka\u0026#34;,\u0026#34;feign\u0026#34;,\u0026#34;gateway\u0026#34;); redisTemplate.opsForValue().set(\u0026#34;lesson\u0026#34;,\u0026#34;redis\u0026#34;); System.out.println(redisTemplate.opsForValue().get(\u0026#34;lesson\u0026#34;)); }catch (Exception e){ //å›æ»š System.out.println(\u0026#34;å‡ºç°å¼‚å¸¸\u0026#34;); redisTemplate.discard(); }finally { redisTemplate.exec(); } } FAQ Redis äº‹åŠ¡çš„åŸå­æ€§æ˜¯å¦‚ä½•ä¿è¯çš„ï¼Ÿ Redis äº‹åŠ¡çš„åŸå­æ€§æ˜¯é€šè¿‡ Redis çš„å•çº¿ç¨‹æ‰§è¡Œå’Œä¹è§‚é”æ¥ä¿è¯çš„ã€‚\nåœ¨ Redis ä¸­ï¼Œäº‹åŠ¡çš„æ‰§è¡Œæ˜¯é€šè¿‡å°†å¤šä¸ªå‘½ä»¤æŒ‰é¡ºåºæ”¾å…¥äº‹åŠ¡é˜Ÿåˆ—ä¸­ï¼Œç„¶åç”± Redis ä¾æ¬¡æ‰§è¡Œè¿™äº›å‘½ä»¤ã€‚åœ¨äº‹åŠ¡æ‰§è¡ŒæœŸé—´ï¼ŒRedis ä¼šç¡®ä¿å…¶ä»–å®¢æˆ·ç«¯æäº¤çš„å‘½ä»¤ä¸ä¼šè¢«æ’å…¥åˆ°å½“å‰äº‹åŠ¡ä¸­ï¼Œä»è€Œä¿è¯äº‹åŠ¡çš„åŸå­æ€§ã€‚\nå½“æ‰§è¡Œ EXEC å‘½ä»¤æ—¶ï¼ŒRedis ä¼šæŒ‰ç…§é¡ºåºæ‰§è¡Œäº‹åŠ¡é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å‘½ä»¤ï¼Œå¹¶è¿”å›æ¯ä¸ªå‘½ä»¤çš„æ‰§è¡Œç»“æœã€‚å¦‚æœåœ¨æ‰§è¡ŒæœŸé—´å‡ºç°é”™è¯¯ï¼Œä¾‹å¦‚å…¶ä¸­ä¸€ä¸ªå‘½ä»¤è¿”å›äº†é”™è¯¯ï¼ŒRedis ä¼šç»ˆæ­¢äº‹åŠ¡çš„æ‰§è¡Œï¼Œå¹¶è¿”å›ç›¸åº”çš„é”™è¯¯ä¿¡æ¯ã€‚\næ­¤å¤–ï¼ŒRedis ä½¿ç”¨ä¹è§‚é”æ¥ä¿è¯äº‹åŠ¡çš„åŸå­æ€§ã€‚åœ¨äº‹åŠ¡æ‰§è¡ŒæœŸé—´ï¼ŒRedis ä¸ä¼šå¯¹äº‹åŠ¡ä¸­çš„é”®è¿›è¡ŒåŠ é”ã€‚ç›¸åï¼ŒRedis ä¼šåœ¨æ‰§è¡Œäº‹åŠ¡ä¹‹å‰ä½¿ç”¨ WATCH å‘½ä»¤ç›‘è§†ä¸€ä¸ªæˆ–å¤šä¸ªé”®ã€‚å¦‚æœåœ¨äº‹åŠ¡æ‰§è¡ŒæœŸé—´æœ‰å…¶ä»–å®¢æˆ·ç«¯å¯¹è¿™äº›è¢«ç›‘è§†çš„é”®è¿›è¡Œäº†ä¿®æ”¹ï¼ŒRedis ä¼šä¸­æ­¢äº‹åŠ¡çš„æ‰§è¡Œï¼Œå¹¶è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚é€šè¿‡ä½¿ç”¨ä¹è§‚é”ï¼ŒRedis ç¡®ä¿äº†äº‹åŠ¡åœ¨æ‰§è¡ŒæœŸé—´ä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯çš„ä¿®æ”¹æ‰€å¹²æ‰°ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒRedis çš„äº‹åŠ¡å¹¶ä¸æ˜¯éš”ç¦»çš„ï¼Œå³äº‹åŠ¡æ‰§è¡ŒæœŸé—´å…¶ä»–å®¢æˆ·ç«¯æäº¤çš„å‘½ä»¤ä»ç„¶å¯ä»¥ä¿®æ”¹äº‹åŠ¡ä¸­çš„é”®ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨ Redis äº‹åŠ¡æ—¶ï¼Œéœ€è¦æ³¨æ„å¹¶å‘æ“ä½œå¯èƒ½å¼•å‘çš„ç«æ€æ¡ä»¶ã€‚å¦‚æœéœ€è¦æ›´ä¸¥æ ¼çš„éš”ç¦»æ€§ï¼Œå¯ä»¥ä½¿ç”¨ Redis çš„ WATCH å’Œ MULTI å‘½ä»¤ç»“åˆ Lua è„šæœ¬æ¥å®ç°æ›´å¤æ‚çš„äº‹åŠ¡é€»è¾‘ã€‚\nRedis äº‹åŠ¡çš„ä¹è§‚é”æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ Redis çš„äº‹åŠ¡ä¹è§‚é”æœºåˆ¶æ˜¯é€šè¿‡ WATCH å‘½ä»¤å’Œæ£€æµ‹äº‹åŠ¡æ‰§è¡ŒæœŸé—´é”®çš„å˜åŒ–æ¥å®ç°çš„ã€‚\nå½“è°ƒç”¨ WATCH å‘½ä»¤æ—¶ï¼ŒRedis ä¼šç›‘è§†ä¸€ä¸ªæˆ–å¤šä¸ªé”®ã€‚åœ¨äº‹åŠ¡æ‰§è¡ŒæœŸé—´ï¼Œå¦‚æœä»»ä½•è¢«ç›‘è§†çš„é”®å‘ç”Ÿäº†å˜åŒ–ï¼ˆè¢«å…¶ä»–å®¢æˆ·ç«¯ä¿®æ”¹ï¼‰ï¼ŒRedis å°†ä¸­æ­¢äº‹åŠ¡çš„æ‰§è¡Œã€‚\nä»¥ä¸‹æ˜¯ä¹è§‚é”åœ¨ Redis äº‹åŠ¡ä¸­çš„å·¥ä½œåŸç†ï¼š\nå®¢æˆ·ç«¯è°ƒç”¨ WATCH å‘½ä»¤ï¼ŒæŒ‡å®šè¦ç›‘è§†çš„é”®ã€‚ Redis å¼€å§‹ç›‘è§†è¿™äº›é”®ï¼Œå¹¶è®°å½•å®ƒä»¬çš„å½“å‰å€¼ã€‚ å®¢æˆ·ç«¯å¼€å§‹æ‰§è¡Œäº‹åŠ¡ä¸­çš„å‘½ä»¤ã€‚ åœ¨æ‰§è¡Œ EXEC å‘½ä»¤ä¹‹å‰ï¼ŒRedis æ£€æŸ¥è¢«ç›‘è§†çš„é”®æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ã€‚ å¦‚æœä»»ä½•è¢«ç›‘è§†çš„é”®å‘ç”Ÿäº†å˜åŒ–ï¼ŒRedis ä¸­æ­¢äº‹åŠ¡çš„æ‰§è¡Œï¼Œå¹¶è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚ å¦‚æœè¢«ç›‘è§†çš„é”®æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œåˆ™ Redis æ‰§è¡Œäº‹åŠ¡ä¸­çš„å‘½ä»¤ï¼Œå¹¶è¿”å›ç»“æœã€‚ ä¹è§‚é”çš„å…³é”®åœ¨äºåœ¨æ‰§è¡Œ EXEC å‘½ä»¤ä¹‹å‰æ£€æŸ¥é”®çš„å˜åŒ–ã€‚å¦‚æœåœ¨äº‹åŠ¡æ‰§è¡ŒæœŸé—´ï¼Œæœ‰å…¶ä»–å®¢æˆ·ç«¯ä¿®æ”¹äº†è¢«ç›‘è§†çš„é”®ï¼Œé‚£ä¹ˆ Redis ä¼šä¸­æ­¢äº‹åŠ¡çš„æ‰§è¡Œï¼Œå› ä¸ºå®ƒæ— æ³•ä¿è¯äº‹åŠ¡çš„åŸå­æ€§ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¹è§‚é”å¹¶ä¸ä¼šå¯¹è¢«ç›‘è§†çš„é”®è¿›è¡ŒåŠ é”ã€‚å®ƒåªæ˜¯åœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰æ£€æŸ¥é”®çš„å˜åŒ–æƒ…å†µã€‚è¿™æ„å‘³ç€å…¶ä»–å®¢æˆ·ç«¯ä»ç„¶å¯ä»¥ä¿®æ”¹è¢«ç›‘è§†çš„é”®ï¼Œä½†æ˜¯å½“äº‹åŠ¡æ‰§è¡Œæ—¶ï¼Œå¦‚æœé”®å‘ç”Ÿäº†å˜åŒ–ï¼Œäº‹åŠ¡å°†è¢«ä¸­æ­¢ã€‚\nä¹è§‚é”åœ¨ Redis äº‹åŠ¡ä¸­çš„åº”ç”¨åœºæ™¯æ˜¯ä¿è¯åœ¨æ‰§è¡Œäº‹åŠ¡æœŸé—´è¢«ç›‘è§†çš„é”®æ²¡æœ‰è¢«å…¶ä»–å®¢æˆ·ç«¯ä¿®æ”¹ã€‚å¦‚æœéœ€è¦æ›´ä¸¥æ ¼çš„éš”ç¦»æ€§ï¼Œå¯ä»¥ç»“åˆä½¿ç”¨ WATCH å’Œ MULTI å‘½ä»¤ä»¥åŠ Lua è„šæœ¬æ¥å®ç°æ›´å¤æ‚çš„äº‹åŠ¡é€»è¾‘ã€‚\nRedis äº‹åŠ¡æ˜¯å¦æ”¯æŒåµŒå¥—ï¼Ÿ åœ¨ Redis ä¸­ï¼Œäº‹åŠ¡æ˜¯ä¸æ”¯æŒåµŒå¥—çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ ä¸èƒ½åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­å¼€å¯å¦ä¸€ä¸ªäº‹åŠ¡ã€‚\nå½“ä½ è°ƒç”¨ MULTI å‘½ä»¤å¼€å§‹ä¸€ä¸ªäº‹åŠ¡åï¼Œåç»­çš„å‘½ä»¤éƒ½ä¼šè¢«æ·»åŠ åˆ°å½“å‰äº‹åŠ¡é˜Ÿåˆ—ä¸­ï¼Œç›´åˆ°è°ƒç”¨ EXEC å‘½ä»¤æ‰§è¡Œäº‹åŠ¡ã€‚äº‹åŠ¡ä¸­çš„å‘½ä»¤ä¼šæŒ‰ç…§é¡ºåºæ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚\nè™½ç„¶ Redis æä¾›äº† MULTI å’Œ EXEC å‘½ä»¤æ¥æ”¯æŒäº‹åŠ¡ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€äº‹åŠ¡çš„åµŒå¥—ã€‚å¦‚æœåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­è°ƒç”¨ MULTI å‘½ä»¤å¼€å¯å¦ä¸€ä¸ªäº‹åŠ¡ï¼Œå®é™…ä¸Šä»ç„¶æ˜¯åœ¨å½“å‰äº‹åŠ¡ä¸­æ‰§è¡Œäº†ä¸€ä¸ª MULTI å‘½ä»¤ï¼Œè€Œä¸æ˜¯å¯åŠ¨äº†ä¸€ä¸ªæ–°çš„åµŒå¥—äº‹åŠ¡ã€‚å› æ­¤ï¼ŒåµŒå¥—äº‹åŠ¡çš„æ¦‚å¿µåœ¨ Redis ä¸­å¹¶ä¸å­˜åœ¨ã€‚\nå¦‚æœä½ éœ€è¦åœ¨ Redis ä¸­è¿›è¡Œå¤æ‚çš„æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨ Lua è„šæœ¬æ¥å®ç°ã€‚Lua è„šæœ¬å¯ä»¥åœ¨ä¸€ä¸ªåŸå­æ€§æ“ä½œä¸­æ‰§è¡Œå¤šä¸ª Redis å‘½ä»¤ï¼Œå¹¶ä¸”æ”¯æŒæ¡ä»¶åˆ¤æ–­å’Œæµç¨‹æ§åˆ¶ï¼Œä»¥æ»¡è¶³æ›´å¤æ‚çš„ä¸šåŠ¡éœ€æ±‚ã€‚\nRedis æ˜¯å¦æ”¯æŒå›æ»šäº‹åŠ¡ï¼Ÿ åœ¨ Redis ä¸­ï¼Œäº‹åŠ¡æ˜¯æ”¯æŒå›æ»šçš„ã€‚å½“äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯æˆ–è€…é€šè¿‡å®¢æˆ·ç«¯æ˜¾å¼åœ°è°ƒç”¨ DISCARD å‘½ä»¤æ—¶ï¼ŒRedis å°†ä¼šå›æ»šäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤ï¼Œå°†æ•°æ®æ¢å¤åˆ°äº‹åŠ¡æ‰§è¡Œä¹‹å‰çš„çŠ¶æ€ã€‚\nä»¥ä¸‹æ˜¯ Redis ä¸­å›æ»šäº‹åŠ¡çš„æƒ…å†µï¼š\nå½“äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯æ—¶ï¼Œæ¯”å¦‚å…¶ä¸­ä¸€ä¸ªå‘½ä»¤è¿”å›äº†é”™è¯¯ï¼ŒRedis å°†è‡ªåŠ¨ä¸­æ­¢äº‹åŠ¡çš„æ‰§è¡Œï¼Œå¹¶ä¸¢å¼ƒäº‹åŠ¡é˜Ÿåˆ—ä¸­å°šæœªæ‰§è¡Œçš„å‘½ä»¤ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿äº‹åŠ¡çš„åŸå­æ€§ï¼Œæœªæ‰§è¡Œçš„å‘½ä»¤ä¸ä¼šå¯¹æ•°æ®äº§ç”Ÿå½±å“ã€‚ å®¢æˆ·ç«¯å¯ä»¥æ˜¾å¼åœ°è°ƒç”¨ DISCARD å‘½ä»¤æ¥å–æ¶ˆäº‹åŠ¡ï¼Œæ”¾å¼ƒä¹‹å‰çš„æ‰€æœ‰å‘½ä»¤ã€‚è¿™å°†å¯¼è‡´ Redis ä¸¢å¼ƒäº‹åŠ¡é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å‘½ä»¤ï¼Œå¹¶å°†æ•°æ®æ¢å¤åˆ°äº‹åŠ¡å¼€å§‹ä¹‹å‰çš„çŠ¶æ€ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒRedis çš„äº‹åŠ¡å›æ»šåªä¼šå½±å“å½“å‰è¿æ¥çš„äº‹åŠ¡ï¼Œä¸ä¼šå¯¹å…¶ä»–å®¢æˆ·ç«¯äº§ç”Ÿå½±å“ã€‚å¦‚æœä¸€ä¸ªå®¢æˆ·ç«¯åœ¨æ‰§è¡Œäº‹åŠ¡æœŸé—´å‘ç”Ÿé”™è¯¯æˆ–è€…å›æ»šï¼Œå…¶ä»–å®¢æˆ·ç«¯çš„æ“ä½œä¸ä¼šå—åˆ°å½±å“ï¼Œå®ƒä»¬ä»ç„¶å¯ä»¥æ­£å¸¸åœ°æ“ä½œå’Œè®¿é—® Redis æ•°æ®åº“ã€‚\nå¦å¤–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ Redis çš„äº‹åŠ¡å¹¶ä¸æ˜¯éš”ç¦»çš„ï¼Œå³äº‹åŠ¡æ‰§è¡ŒæœŸé—´å…¶ä»–å®¢æˆ·ç«¯æäº¤çš„å‘½ä»¤ä»ç„¶å¯ä»¥ä¿®æ”¹äº‹åŠ¡ä¸­çš„é”®ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨ Redis äº‹åŠ¡æ—¶ï¼Œéœ€è¦æ³¨æ„å¹¶å‘æ“ä½œå¯èƒ½å¼•å‘çš„ç«æ€æ¡ä»¶ã€‚å¦‚æœéœ€è¦æ›´ä¸¥æ ¼çš„éš”ç¦»æ€§ï¼Œå¯ä»¥ç»“åˆä½¿ç”¨ WATCH å’Œ MULTI å‘½ä»¤ä»¥åŠ Lua è„šæœ¬æ¥å®ç°æ›´å¤æ‚çš„äº‹åŠ¡é€»è¾‘å’Œæ§åˆ¶ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2024/01/31/til/","summary":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\nä¸‹è½½ ã€ŠMicroservices with Spring Boot 3 and Spring Cloudã€‹ï¼Œæºç åœ¨ github\nRedis äº‹åŠ¡\nRedisäº‹åŠ¡ åŸç† Redis æ˜¯ä¸€ä¸ªå†…å­˜æ•°æ®åº“ï¼Œå®ƒæ”¯æŒäº‹åŠ¡æ“ä½œã€‚Redis äº‹åŠ¡æ˜¯ä¸€ç³»åˆ—çš„å‘½ä»¤æ“ä½œï¼Œè¿™äº›å‘½ä»¤ä¼šè¢«ä¸€èµ·æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚åœ¨äº‹åŠ¡æ‰§è¡ŒæœŸé—´ï¼Œå…¶ä»–å®¢æˆ·ç«¯æäº¤çš„å‘½ä»¤ä¸ä¼šè¢«æ’å…¥åˆ°äº‹åŠ¡ä¸­ï¼Œç¡®ä¿äº‹åŠ¡çš„åŸå­æ€§ã€‚\nRedis äº‹åŠ¡ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œç®¡ç†ï¼š\nMULTIï¼šæ ‡è®°äº‹åŠ¡çš„å¼€å§‹ã€‚ EXECï¼šæ‰§è¡Œäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤ã€‚ DISCARDï¼šå–æ¶ˆäº‹åŠ¡ï¼Œæ”¾å¼ƒä¹‹å‰çš„æ‰€æœ‰å‘½ä»¤ã€‚ WATCHï¼šç›‘è§†ä¸€ä¸ªæˆ–å¤šä¸ªé”®ï¼Œå¦‚æœåœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰æœ‰å…¶ä»–å®¢æˆ·ç«¯å¯¹è¿™äº›é”®è¿›è¡Œäº†ä¿®æ”¹ï¼Œåˆ™äº‹åŠ¡ä¼šè¢«ä¸­æ­¢ã€‚ UNWATCHï¼šå–æ¶ˆå¯¹æ‰€æœ‰é”®çš„ç›‘è§†ã€‚ åœ¨æ‰§è¡Œäº‹åŠ¡ä¹‹å‰ï¼Œå…ˆä½¿ç”¨ MULTI å‘½ä»¤æ ‡è®°äº‹åŠ¡çš„å¼€å§‹ï¼Œç„¶åæŒ‰é¡ºåºæ‰§è¡Œå¤šä¸ªå‘½ä»¤ã€‚åœ¨æ‰€æœ‰å‘½ä»¤éƒ½è¢«æ·»åŠ åˆ°äº‹åŠ¡é˜Ÿåˆ—ä¹‹åï¼Œä½¿ç”¨ EXEC å‘½ä»¤æ¥æ‰§è¡Œäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤ã€‚å¦‚æœæ‰§è¡ŒæˆåŠŸï¼Œäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤ä¼šè¢«ä¸€èµ·æ‰§è¡Œï¼Œç„¶åè¿”å›ç»“æœã€‚å¦‚æœåœ¨æ‰§è¡Œäº‹åŠ¡æœŸé—´å‘ç”Ÿé”™è¯¯ï¼Œäº‹åŠ¡ä¼šè¢«ä¸­æ­¢ï¼Œæ‰€æœ‰çš„ä¿®æ”¹éƒ½ä¼šè¢«å›æ»šã€‚\nç¤ºä¾‹ ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ Redis äº‹åŠ¡çš„ç¤ºä¾‹ï¼š\n#å¼€å¯äº‹åŠ¡ MULTI SET key1 \u0026#34;value1\u0026#34; SET key2 \u0026#34;value2\u0026#34; GET key1 GET key2 #æ‰§è¡Œäº‹åŠ¡ EXEC # å–æ¶ˆäº‹åŠ¡ discard ä¸Šè¿°äº‹åŠ¡åŒ…å«äº†ä¸¤ä¸ª SET å‘½ä»¤å’Œä¸¤ä¸ª GET å‘½ä»¤ã€‚åœ¨ EXEC å‘½ä»¤æ‰§è¡Œä¹‹åï¼Œå°†ä¼šä¾æ¬¡æ‰§è¡Œè¿™äº›å‘½ä»¤ï¼Œå¹¶è¿”å›ç›¸åº”çš„ç»“æœã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒRedis çš„äº‹åŠ¡æ˜¯ä¹è§‚é”ï¼Œå¹¶ä¸ä¼šåœ¨æ‰§è¡ŒæœŸé—´å¯¹é”®è¿›è¡ŒåŠ é”ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨äº‹åŠ¡æ—¶è¦æ³¨æ„å¹¶å‘æ“ä½œå¯èƒ½å¼•å‘çš„ç«æ€æ¡ä»¶ã€‚\nRediså¯¹äºå‘½ä»¤æ‰§è¡Œé”™è¯¯å¤„ç†ï¼Œæœ‰ä¸¤ç§è§£å†³æ–¹å¼ï¼š\nè¯­æ³•é”™è¯¯ï¼ˆç¼–è¯‘ï¼‰ æ‰§è¡Œé”™è¯¯ï¼ˆè¿è¡Œï¼‰ è¯­æ³•é”™è¯¯ï¼šæ‰§è¡Œå‘½ä»¤çš„è¯­æ³•ä¸æ­£ç¡®ã€‚\n#å¼€å¯äº‹åŠ¡ multi #å‘½ä»¤ set name zhangsan set age seterror sex male #æ‰§è¡Œäº‹åŠ¡ exec #è·å–æ­£ç¡®æŒ‡ä»¤æ•°æ® get name æ­¤æ—¶æ•´ä¸ªäº‹åŠ¡é˜Ÿåˆ—ä¸­ï¼Œå­˜åœ¨ä¸€æ¡æ­£ç¡®æŒ‡ä»¤ï¼Œä¸¤æ¡è¯­æ³•é”™è¯¯æŒ‡ä»¤ï¼Œ å½“æ‰§è¡Œexecåï¼Œä¼šç›´æ¥è¿”å›é”™è¯¯ï¼Œæ­£ç¡®çš„å‘½ä»¤ä¹Ÿä¸ä¼šæ‰§è¡Œã€‚\næ‰§è¡Œé”™è¯¯ï¼šå‘½ä»¤åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ã€‚\n#å¼€å¯äº‹åŠ¡ multi #å‘½ä»¤ set lesson java rpush lesson eureka feign nacos set lesson redis #æ‰§è¡Œäº‹åŠ¡ exec #è·å–æ•°æ® get lesson é€šè¿‡ä¸Šé¢äº‹åŠ¡æ‰§è¡Œå¯ä»¥çœ‹åˆ°ï¼Œè¯­æ³•æœ¬èº«æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œæ‰€ä»¥è¿è¡Œä¹‹å‰redisæ— æ³•å‘ç°é”™è¯¯ï¼Œä½†æ˜¯åœ¨æ‰§è¡Œæ—¶å‡ºç°äº†é”™è¯¯ï¼Œå› æ­¤åªä¼šé”™è¯¯çš„å‘½ä»¤ä¸æ‰§è¡Œï¼Œ è€Œæ­£ç¡®çš„å‘½ä»¤ä»ç„¶èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œã€‚","title":"2024-01-31ï½œRedisäº‹åŠ¡"},{"content":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\né‡æ„ foodie-cloud é¡¹ç›® å‚è€ƒ DDD ç»„ç»‡åŒ…ç»“æ„ Mybatis plus é…ç½®ä¸»é”®ç”Ÿæˆç­–ç•¥å’Œæ•°æ®å®¡è®¡åŠŸèƒ½ Jackson é…ç½®æ—¥æœŸåºåˆ—åŒ– é‡æ„ foodie-cloud é¡¹ç›® Mybatis plus é…ç½®ä¸»é”®ç”Ÿæˆç­–ç•¥ å®ä½“ç±»ä¸­å¯ä»¥ä¸ç”¨æ·»åŠ @TableIdï¼Œå‡å°‘å®ä½“ç±»å¯¹ mybatis-plus-annotationçš„ä¾èµ–\npublic class BaseEntity implements Serializable { private Long id; private LocalDateTime createTime; private LocalDateTime updateTime; } æ”¹ä¸ºä½¿ç”¨é…ç½®ï¼š\nmybatis-plus: global-config: db-config: id-type: ASSIGN_ID Mybatis plus é…ç½®æ•°æ®å®¡è®¡åŠŸèƒ½ æ·»åŠ ä¸‹é¢çš„ç±»\n@Component @Slf4j public class CustomMetaObjecthandler implements MetaObjectHandler { protected static void fillValIfNullByName( final String fieldName,final Object fieldVal, final MetaObject metaObject,final boolean isCover) { // 1. æ²¡æœ‰ set æ–¹æ³• if (!metaObject.hasSetter(fieldName)) { return; } // 2. å¦‚æœç”¨æˆ·æœ‰æ‰‹åŠ¨è®¾ç½®çš„å€¼ if (metaObject.getValue(fieldName) != null \u0026amp;\u0026amp; !isCover) { return; } // 3. field ç±»å‹ç›¸åŒæ—¶è®¾ç½® final Class\u0026lt;?\u0026gt; getterType = metaObject.getGetterType(fieldName); if (ClassUtils.isAssignableValue(getterType, fieldVal)) { metaObject.setValue(fieldName, fieldVal); } } @Override public void insertFill(final MetaObject metaObject) { final LocalDateTime now = LocalDateTime.now(); final String username = SecurityContextHolder.getContext().getAuthentication().getName(); log.info(\u0026#34;å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……[insert]: {},{}\u0026#34;, now, username); fillValIfNullByName(\u0026#34;createTime\u0026#34;, now, metaObject, false); fillValIfNullByName(\u0026#34;createUser\u0026#34;, username, metaObject, false); } @Override public void updateFill(final MetaObject metaObject) { final LocalDateTime now = LocalDateTime.now(); final String username = SecurityContextHolder.getContext().getAuthentication().getName(); log.info(\u0026#34;å…¬å…±å­—æ®µè‡ªåŠ¨å¡«å……[update]: {},{}\u0026#34;, now, username); fillValIfNullByName(\u0026#34;updateTime\u0026#34;, now, metaObject, true); fillValIfNullByName(\u0026#34;updateUser\u0026#34;, username, metaObject, true); } } å¹¶åœ¨å®ä½“ç±»ä¸Šçš„å¯¹åº”å±æ€§æ·»åŠ æ³¨è§£ï¼š\n@Getter @Setter public class BaseEntity implements Serializable { private static final long serialVersionUID = 6595513467381653081L; private Long id; @TableField(fill = FieldFill.INSERT) private LocalDateTime createTime; @TableField(fill = FieldFill.INSERT_UPDATE) private LocalDateTime updateTime; } Jackson é…ç½®æ—¥æœŸåºåˆ—åŒ– è‡ªå®šä¹‰ä¸€ä¸ª ObjectMapperï¼š\npublic class CustomObjectMapper extends ObjectMapper { public static final String DEFAULT_DATE_FORMAT = \u0026#34;yyyy-MM-dd\u0026#34;; public static final String DEFAULT_DATE_TIME_FORMAT = \u0026#34;yyyy-MM-dd HH:mm:ss\u0026#34;; public static final String DEFAULT_TIME_FORMAT = \u0026#34;HH:mm:ss\u0026#34;; public CustomObjectMapper() { //æ”¶åˆ°æœªçŸ¥å±æ€§æ—¶ä¸æŠ¥å¼‚å¸¸ this.configure(FAIL_ON_UNKNOWN_PROPERTIES, false); //ååºåˆ—åŒ–æ—¶ï¼Œå±æ€§ä¸å­˜åœ¨çš„å…¼å®¹å¤„ç† this.getDeserializationConfig().withoutFeatures(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES); final SimpleModule simpleModule = new SimpleModule() .addSerializer(BigInteger.class, ToStringSerializer.instance) .addSerializer(Long.class, ToStringSerializer.instance) .addDeserializer(LocalDateTime.class, new LocalDateTimeDeserializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT))) .addDeserializer(LocalDate.class, new LocalDateDeserializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT))) .addDeserializer(LocalTime.class, new LocalTimeDeserializer(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT))) .addSerializer(LocalDateTime.class, new LocalDateTimeSerializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT))) .addSerializer(LocalDate.class, new LocalDateSerializer(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT))) .addSerializer(LocalTime.class, new LocalTimeSerializer(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT))); //æ³¨å†ŒåŠŸèƒ½æ¨¡å— ä¾‹å¦‚ï¼Œå¯ä»¥æ·»åŠ è‡ªå®šä¹‰åºåˆ—åŒ–å™¨å’Œååºåˆ—åŒ–å™¨ this.registerModule(simpleModule); } } ç„¶åï¼Œæ³¨å…¥çš„ spring å®¹å™¨ï¼š\n@Configuration public class JacksonConfig { @Bean @Primary public ObjectMapper objectMapper() { return new CustomObjectMapper(); } } è¿™æ ·ï¼Œå°±å¯ä»¥ä¸ç”¨åœ¨ LocalDateTime ç±»å‹çš„å±æ€§ä¸Šæ·»åŠ  @JsonFormat æ³¨è§£ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2024/01/30/til/","summary":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\né‡æ„ foodie-cloud é¡¹ç›® å‚è€ƒ DDD ç»„ç»‡åŒ…ç»“æ„ Mybatis plus é…ç½®ä¸»é”®ç”Ÿæˆç­–ç•¥å’Œæ•°æ®å®¡è®¡åŠŸèƒ½ Jackson é…ç½®æ—¥æœŸåºåˆ—åŒ– é‡æ„ foodie-cloud é¡¹ç›® Mybatis plus é…ç½®ä¸»é”®ç”Ÿæˆç­–ç•¥ å®ä½“ç±»ä¸­å¯ä»¥ä¸ç”¨æ·»åŠ @TableIdï¼Œå‡å°‘å®ä½“ç±»å¯¹ mybatis-plus-annotationçš„ä¾èµ–\npublic class BaseEntity implements Serializable { private Long id; private LocalDateTime createTime; private LocalDateTime updateTime; } æ”¹ä¸ºä½¿ç”¨é…ç½®ï¼š\nmybatis-plus: global-config: db-config: id-type: ASSIGN_ID Mybatis plus é…ç½®æ•°æ®å®¡è®¡åŠŸèƒ½ æ·»åŠ ä¸‹é¢çš„ç±»\n@Component @Slf4j public class CustomMetaObjecthandler implements MetaObjectHandler { protected static void fillValIfNullByName( final String fieldName,final Object fieldVal, final MetaObject metaObject,final boolean isCover) { // 1. æ²¡æœ‰ set æ–¹æ³• if (!metaObject.hasSetter(fieldName)) { return; } // 2. å¦‚æœç”¨æˆ·æœ‰æ‰‹åŠ¨è®¾ç½®çš„å€¼ if (metaObject.getValue(fieldName) != null \u0026amp;\u0026amp; !isCover) { return; } // 3. field ç±»å‹ç›¸åŒæ—¶è®¾ç½® final Class\u0026lt;?\u0026gt; getterType = metaObject.getGetterType(fieldName); if (ClassUtils.","title":"2024-01-30ï½œMybatis pluså’ŒJacksoné…ç½®"},{"content":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\né‡æ„ foodie-cloud é¡¹ç›®\nC4 æ¶æ„æ¨¡å‹\nC4æ¶æ„æ¨¡å‹ C4 æ¶æ„æ¨¡å‹æ˜¯ä¸€ç§ç®€æ´ä¸”æ˜“äºç†è§£çš„è½¯ä»¶æ¶æ„æè¿°æ–¹æ³•ï¼Œç”± Simon Brown æå‡ºã€‚C4 è¡¨ç¤º Context, Containers, Components, and Codeï¼Œè¿™å››ä¸ªå±‚çº§å¸®åŠ©æˆ‘ä»¬ç»„ç»‡å’Œæè¿°è½¯ä»¶ç³»ç»Ÿçš„ä¸åŒæŠ½è±¡å±‚æ¬¡ã€‚\nä»¥ä¸‹æ˜¯ C4 æ¶æ„æ¨¡å‹çš„å››ä¸ªå±‚çº§ï¼š\nContextï¼ˆä¸Šä¸‹æ–‡ï¼‰ï¼šè¿™æ˜¯æœ€é«˜çº§åˆ«çš„å±‚çº§ï¼Œç”¨äºæè¿°ç³»ç»Ÿçš„æ•´ä½“ç¯å¢ƒå’Œç›®æ ‡ã€‚åœ¨è¿™ä¸ªå±‚çº§ï¼Œæˆ‘ä»¬å…³æ³¨ç³»ç»Ÿä¸å¤–éƒ¨å®ä½“ï¼ˆå¦‚ç”¨æˆ·ã€å…¶ä»–ç³»ç»Ÿã€ç¡¬ä»¶è®¾å¤‡ç­‰ï¼‰çš„äº¤äº’ã€‚å¯ä»¥ä½¿ç”¨ä¸Šä¸‹æ–‡å›¾ï¼ˆContext Diagramï¼‰æ¥å±•ç¤ºç³»ç»Ÿå’Œç›¸å…³å®ä½“ä¹‹é—´çš„å…³ç³»ã€‚ Containersï¼ˆå®¹å™¨ï¼‰ï¼šè¿™ä¸ªå±‚çº§ç”¨äºæè¿°ç³»ç»Ÿå†…éƒ¨çš„ä¸»è¦é€»è¾‘ç»„ä»¶ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿è¡Œæ—¶è¿›ç¨‹æˆ–çº¿ç¨‹ã€‚å®¹å™¨å¯ä»¥æ˜¯ Web æœåŠ¡å™¨ã€æ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€æ¡Œé¢åº”ç”¨ç­‰ï¼Œå®ƒä»¬åœ¨ç³»ç»Ÿä¸­æ‰¿æ‹…ç€ä¸åŒçš„è§’è‰²å’Œè´£ä»»ã€‚é€šè¿‡å®¹å™¨å›¾ï¼ˆContainer Diagramï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å±•ç¤ºç³»ç»Ÿä¸­çš„å®¹å™¨åŠå…¶ä¹‹é—´çš„å…³ç³»ã€‚ Componentsï¼ˆç»„ä»¶ï¼‰ï¼šè¿™ä¸ªå±‚çº§ç”¨äºè¿›ä¸€æ­¥åˆ’åˆ†å®¹å™¨ï¼Œæè¿°å®¹å™¨å†…éƒ¨çš„ç»„ç»‡ç»“æ„å’Œç»„ä»¶ä¹‹é—´çš„å…³ç³»ã€‚ç»„ä»¶æ˜¯ç³»ç»Ÿçš„æ„å»ºå—ï¼Œä»£è¡¨äº†è¾ƒç»†ç²’åº¦çš„åŠŸèƒ½å•å…ƒæˆ–æ¨¡å—ã€‚å¯ä»¥ä½¿ç”¨ç»„ä»¶å›¾ï¼ˆComponent Diagramï¼‰æ¥å±•ç¤ºç»„ä»¶åŠå…¶ä¹‹é—´çš„å…³ç³»ã€‚ Codeï¼ˆä»£ç ï¼‰ï¼šè¿™ä¸ªå±‚çº§ç”¨äºæè¿°ç»„ä»¶å†…éƒ¨çš„ä»£ç ç»“æ„å’Œå®ç°ç»†èŠ‚ã€‚åœ¨è¿™ä¸ªå±‚çº§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç±»å›¾ã€åŒ…å›¾ç­‰æ¥å±•ç¤ºä»£ç çº§åˆ«çš„ç»“æ„å’Œå…³ç³»ã€‚ C4 æ¶æ„æ¨¡å‹é€šè¿‡å±‚çº§åŒ–çš„æ–¹å¼ï¼Œå¸®åŠ©æˆ‘ä»¬ä»é«˜çº§åˆ«åˆ°ä½çº§åˆ«é€æ­¥å±•ç¤ºå’Œæè¿°è½¯ä»¶ç³»ç»Ÿçš„ä¸åŒæŠ½è±¡å±‚æ¬¡ï¼Œä½¿å¾—æ¶æ„æè¿°æ›´åŠ æ¸…æ™°å’Œæ˜“äºç†è§£ã€‚å®ƒé€‚ç”¨äºä¸åŒè§„æ¨¡å’Œå¤æ‚åº¦çš„è½¯ä»¶ç³»ç»Ÿï¼Œå¹¶ä¸”å¯ä»¥æ–¹ä¾¿åœ°ä¸å…¶ä»–æ¶æ„æè¿°æ–¹æ³•ï¼ˆå¦‚ UMLï¼‰ç»“åˆä½¿ç”¨ã€‚\nå‚è€ƒèµ„æ–™ï¼š\nç”¨äºè½¯ä»¶æ¶æ„çš„C4æ¨¡å‹ C4 æ¨¡å‹- å¯è§†åŒ–æ¶æ„è®¾è®¡- lex-wu https://c4model.com/ ","permalink":"https://blog.chensoul.cc/posts/2024/01/29/til/","summary":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\né‡æ„ foodie-cloud é¡¹ç›®\nC4 æ¶æ„æ¨¡å‹\nC4æ¶æ„æ¨¡å‹ C4 æ¶æ„æ¨¡å‹æ˜¯ä¸€ç§ç®€æ´ä¸”æ˜“äºç†è§£çš„è½¯ä»¶æ¶æ„æè¿°æ–¹æ³•ï¼Œç”± Simon Brown æå‡ºã€‚C4 è¡¨ç¤º Context, Containers, Components, and Codeï¼Œè¿™å››ä¸ªå±‚çº§å¸®åŠ©æˆ‘ä»¬ç»„ç»‡å’Œæè¿°è½¯ä»¶ç³»ç»Ÿçš„ä¸åŒæŠ½è±¡å±‚æ¬¡ã€‚\nä»¥ä¸‹æ˜¯ C4 æ¶æ„æ¨¡å‹çš„å››ä¸ªå±‚çº§ï¼š\nContextï¼ˆä¸Šä¸‹æ–‡ï¼‰ï¼šè¿™æ˜¯æœ€é«˜çº§åˆ«çš„å±‚çº§ï¼Œç”¨äºæè¿°ç³»ç»Ÿçš„æ•´ä½“ç¯å¢ƒå’Œç›®æ ‡ã€‚åœ¨è¿™ä¸ªå±‚çº§ï¼Œæˆ‘ä»¬å…³æ³¨ç³»ç»Ÿä¸å¤–éƒ¨å®ä½“ï¼ˆå¦‚ç”¨æˆ·ã€å…¶ä»–ç³»ç»Ÿã€ç¡¬ä»¶è®¾å¤‡ç­‰ï¼‰çš„äº¤äº’ã€‚å¯ä»¥ä½¿ç”¨ä¸Šä¸‹æ–‡å›¾ï¼ˆContext Diagramï¼‰æ¥å±•ç¤ºç³»ç»Ÿå’Œç›¸å…³å®ä½“ä¹‹é—´çš„å…³ç³»ã€‚ Containersï¼ˆå®¹å™¨ï¼‰ï¼šè¿™ä¸ªå±‚çº§ç”¨äºæè¿°ç³»ç»Ÿå†…éƒ¨çš„ä¸»è¦é€»è¾‘ç»„ä»¶ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿è¡Œæ—¶è¿›ç¨‹æˆ–çº¿ç¨‹ã€‚å®¹å™¨å¯ä»¥æ˜¯ Web æœåŠ¡å™¨ã€æ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€æ¡Œé¢åº”ç”¨ç­‰ï¼Œå®ƒä»¬åœ¨ç³»ç»Ÿä¸­æ‰¿æ‹…ç€ä¸åŒçš„è§’è‰²å’Œè´£ä»»ã€‚é€šè¿‡å®¹å™¨å›¾ï¼ˆContainer Diagramï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å±•ç¤ºç³»ç»Ÿä¸­çš„å®¹å™¨åŠå…¶ä¹‹é—´çš„å…³ç³»ã€‚ Componentsï¼ˆç»„ä»¶ï¼‰ï¼šè¿™ä¸ªå±‚çº§ç”¨äºè¿›ä¸€æ­¥åˆ’åˆ†å®¹å™¨ï¼Œæè¿°å®¹å™¨å†…éƒ¨çš„ç»„ç»‡ç»“æ„å’Œç»„ä»¶ä¹‹é—´çš„å…³ç³»ã€‚ç»„ä»¶æ˜¯ç³»ç»Ÿçš„æ„å»ºå—ï¼Œä»£è¡¨äº†è¾ƒç»†ç²’åº¦çš„åŠŸèƒ½å•å…ƒæˆ–æ¨¡å—ã€‚å¯ä»¥ä½¿ç”¨ç»„ä»¶å›¾ï¼ˆComponent Diagramï¼‰æ¥å±•ç¤ºç»„ä»¶åŠå…¶ä¹‹é—´çš„å…³ç³»ã€‚ Codeï¼ˆä»£ç ï¼‰ï¼šè¿™ä¸ªå±‚çº§ç”¨äºæè¿°ç»„ä»¶å†…éƒ¨çš„ä»£ç ç»“æ„å’Œå®ç°ç»†èŠ‚ã€‚åœ¨è¿™ä¸ªå±‚çº§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç±»å›¾ã€åŒ…å›¾ç­‰æ¥å±•ç¤ºä»£ç çº§åˆ«çš„ç»“æ„å’Œå…³ç³»ã€‚ C4 æ¶æ„æ¨¡å‹é€šè¿‡å±‚çº§åŒ–çš„æ–¹å¼ï¼Œå¸®åŠ©æˆ‘ä»¬ä»é«˜çº§åˆ«åˆ°ä½çº§åˆ«é€æ­¥å±•ç¤ºå’Œæè¿°è½¯ä»¶ç³»ç»Ÿçš„ä¸åŒæŠ½è±¡å±‚æ¬¡ï¼Œä½¿å¾—æ¶æ„æè¿°æ›´åŠ æ¸…æ™°å’Œæ˜“äºç†è§£ã€‚å®ƒé€‚ç”¨äºä¸åŒè§„æ¨¡å’Œå¤æ‚åº¦çš„è½¯ä»¶ç³»ç»Ÿï¼Œå¹¶ä¸”å¯ä»¥æ–¹ä¾¿åœ°ä¸å…¶ä»–æ¶æ„æè¿°æ–¹æ³•ï¼ˆå¦‚ UMLï¼‰ç»“åˆä½¿ç”¨ã€‚\nå‚è€ƒèµ„æ–™ï¼š\nç”¨äºè½¯ä»¶æ¶æ„çš„C4æ¨¡å‹ C4 æ¨¡å‹- å¯è§†åŒ–æ¶æ„è®¾è®¡- lex-wu https://c4model.com/ ","title":"2024-01-29ï½œC4æ¶æ„æ¨¡å‹"},{"content":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\né‡æ„ foodie-cloud é¡¹ç›®\né›†æˆ Feign æ›¿æ¢ RestTemplate è®¤è¯æœåŠ¡è´Ÿè´£ç”¨æˆ·çš„ç»´æŠ¤å’Œç™»å½• æ•´ç† Feignã€Eurekaã€Seataã€Sentinel ç›¸å…³æ–‡æ¡£\neurekaåˆ†åŒºçš„æ·±å…¥è®²è§£ Spring Cloud Eurekaè¯¦è§£ ","permalink":"https://blog.chensoul.cc/posts/2024/01/26/til/","summary":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\né‡æ„ foodie-cloud é¡¹ç›®\né›†æˆ Feign æ›¿æ¢ RestTemplate è®¤è¯æœåŠ¡è´Ÿè´£ç”¨æˆ·çš„ç»´æŠ¤å’Œç™»å½• æ•´ç† Feignã€Eurekaã€Seataã€Sentinel ç›¸å…³æ–‡æ¡£\neurekaåˆ†åŒºçš„æ·±å…¥è®²è§£ Spring Cloud Eurekaè¯¦è§£ ","title":"2024-01-26ï½œfoodie-cloudé›†æˆFeign"},{"content":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\næ•´ç† Idea å¿«æ·é”® æ•´ç† zsh ä¸­å®šä¹‰çš„å¸¸ç”¨çš„å¿«æ·é”® Idea å¿«æ·é”® ä½¿ç”¨å¿«æ·é”® command +1 æ‰“å¼€ Project çª—å£\nè¾“å…¥ control + R å¯ä»¥è¿è¡Œ Java ä»£ç \nä¸Šä¸‹æ–‡ åœ¨ for æ–¹æ³•ä¸Šï¼Œè¾“å…¥ option + enterï¼Œå¯ä»¥è°ƒå‡ºä¸Šä¸‹æ–‡ï¼Œæ›¿æ¢ for è¡¨è¾¾å¼\nåœ¨å­—ç¬¦ä¸²ä¸Šé¢è¾“å…¥ option + enterï¼Œå¯ä»¥è°ƒå‡ºä¸Šä¸‹æ–‡ã€‚\nåœ¨å­—ç¬¦ä¸²ä¸Šé¢æˆ–è€…åŒå‡»é€‰ä¸­ï¼Œç„¶ååŒå‡»ä¸¤æ¬¡ â‡§ ï¼Œæ‰“å¼€ Search Everywhere å¼¹çª—ï¼Œç„¶åè¾“å…¥ case ï¼Œé€‰æ‹© Toggle Case å°† AVERAGE å˜ä¸ºå°å†™ã€‚\nåœ¨æ²¡æœ‰ä½¿ç”¨çš„æ–¹æ³•å‚æ•° redundant ä¸Šï¼Œè¾“å…¥ option + enterï¼Œå¯ä»¥é€‰æ‹© Safe delete 'redunant' åˆ é™¤è¯¥å‚æ•°\nåœ¨ä¸‰ç›®è¿ç®—ï¼Œè¾“å…¥ option + enterï¼Œå¯ä»¥é€‰æ‹© Negate '?:'\næœç´¢ æŸ¥æ‰¾æœ€è¿‘æ–‡ä»¶ï¼šcomand + E\nè¾“å…¥ â‡§ + command + A å¯ä»¥æ‰“å¼€ Find Action çª—å£ã€‚\nåŒå‡»ä¸¤æ¬¡ â‡§ å¯ä»¥æ‰“å¼€ Search Everywhere çª—å£ã€‚è¾“å…¥å…³é”®å­—ï¼Œå¯ä»¥æœç´¢ java ç±»ã€‚\nå¦‚æœæƒ³æœç´¢Javaç±»ï¼Œåˆ™å¯ä»¥è¾“å…¥ command + Oï¼Œå¹¶å¯ä»¥é€‰æ‹©åœ¨ All Places æœç´¢ã€‚\nå¦‚æœæƒ³æœç´¢æ–¹æ³•æˆ–è€…å˜é‡åç§°ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ option + command + O\nè‡ªåŠ¨è¡¥å…¨ command + â†‘ + enter è¡¥å…¨æ–¹æ³•ä½“ã€ifã€whileã€for ã€switch åé¢æ‹¬å·\nä»¥ä¸‹ä»£ç ï¼Œåœ¨ new åé¢è¾“å…¥ Ran ï¼Œç„¶åæŒ‰ tab é”®å¯ä»¥è¡¥å…¨ Randomï¼Œç„¶ååœ¨æ‹¬å·å†…ï¼ŒæŒ‰ control+space ï¼Œå¯ä»¥è°ƒå‡ºæŸ¥æ‰¾çª—å£ï¼Œç„¶åé€‰æ‹© PROCESS_IDï¼Œæœ€åæŒ‰ â‡§ + command + enter å®Œæˆ\nclass BasicCompletionDemo { private int PROCESS_ID = 0; public void systemProcess(){ System.out.println(PROCESS_ID++); } public BasicCompletionDemo() { byte b = MAX_VALUE; } public void random() { Random random = new ; } } è¾“å…¥ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œç„¶åæŒ‰ . é”®\ncontrol + â‡§ + space\næ³¨é‡Š è¾“å…¥ command + / ï¼Œæ³¨é‡Šå½“è¡Œä»£ç ã€‚ é€‰ä¸­ä¸€æ®µä»£ç å—ï¼Œè¾“å…¥ option + command + /ï¼Œå¯ä»¥æ³¨é‡Šä»£ç å—ã€‚ åœ¨ java é‡Œé¢ï¼Œæ·»åŠ çš„æ˜¯ /**/ åœ¨ xml é‡Œé¢ï¼Œæ·»åŠ çš„æ˜¯\u0026lt;!----\u0026gt; ä»£ç  ä»£ç æ ¼å¼åŒ–\noption + command + L æ ¼å¼åŒ–ä»£ç ã€‚\nå¯¹é€‰ä¸­çš„ä»£ç ï¼Œä½¿ç”¨ option + command + L ï¼Œå¯ä»¥æ ¼å¼åŒ–ä»£ç ã€‚å†ä½¿ç”¨è¯¥å¿«æ·é”®ï¼Œå¯ä»¥å¯¹æ•´ä¸ªæ–‡ä»¶è¿›è¡Œæ ¼å¼åŒ–ã€‚\nâ‡§+option + command + L å¯ä»¥æŸ¥çœ‹æ ¼å¼åŒ–ä»£ç çš„è®¾ç½®\ncommand + P æŸ¥çœ‹æ–¹æ³•ç­¾å\nF1 æŸ¥çœ‹æ–¹æ³•çš„ Javadoc\noption + space æˆ–è€… command + Y æŸ¥çœ‹æ–¹æ³•çš„å®šä¹‰\nä½¿ç”¨ option + command + T å¯ä»¥æ‰“å¼€ Surround with çª—å£ï¼›ä½¿ç”¨ option + command + del å¯ä»¥æ‰“å¼€ Unwrap çª—å£\né‡æ„ é‡å‘½å â‡§ + F6\næŠ½å–å˜é‡ option + command + V\næŠ½å–æ–¹æ³• option + command + M\nè°ƒå‡ºé‡æ„çª—å£ control + T\nå¤åˆ¶å’Œåˆ æ‰ä»£ç  å¤åˆ¶ä¸€è¡Œä»£ç ï¼Œä½¿ç”¨ command + D\næŒ‰ â‡§ + â†‘ ä¸¤æ¬¡ï¼Œå¯ä»¥é€‰æ‹©ä¸¤è¡Œï¼Œç„¶å ä½¿ç”¨ command + Dï¼Œå¯ä»¥å¤åˆ¶ä¸¤è¡Œä»£ç ã€‚\nå¦‚æœè¦åˆ é™¤å½“å‰è¡Œä»£ç ï¼Œå¯ä»¥ä½¿ç”¨ command + del å¿«æ·é”®ã€‚\nå‰ªåˆ‡è¡Œä»£ç ï¼Œä½¿ç”¨ command + x\nå¤åˆ¶ä»£ç ï¼Œä½¿ç”¨ command + c\né¼ æ ‡åœ¨æŸä¸€è¡Œï¼Œè¾“å…¥ command + c å¯ä»¥é€‰ä¸­è¯¥è¡Œ é€‰ä¸­ æŠŠé¼ æ ‡åœç•™åœ¨ä¸€ä¸ªå•è¯ï¼Œè¾“å…¥ option + â†‘ï¼Œå¯ä»¥é€‰æ‹©å•è¯ï¼›å†æ¬¡è¾“å…¥ option + â†‘ï¼Œå¯ä»¥é€‰æ‹©ä¸€å¥è¯ï¼›å†æ¬¡è¾“å…¥ option + â†‘ï¼Œå¯ä»¥é€‰ä¸­æ•´ä¸ªå­—ç¬¦ä¸²å˜é‡ï¼›å†æ¬¡è¾“å…¥ option + â†‘ï¼Œå¯ä»¥é€‰æ‹©æ–¹æ³•çš„æ‰€æœ‰å˜é‡ï¼›å†æ¬¡è¾“å…¥ option + â†‘ï¼Œå¯ä»¥é€‰ä¸­æ–¹æ³•åŠ æ‰€æœ‰å‚æ•°ï¼›å†æ¬¡è¾“å…¥ option + â†‘ï¼Œå¯ä»¥é€‰ä¸­æ•´è¡Œå†…å®¹ã€‚\nä½¿ç”¨ control + G é€‰ä¸­é¼ æ ‡æ‰€åœ¨å•è¯\nå†æ¬¡ä½¿ç”¨ control + G é€‰ä¸­ä¸‹ä¸€ä¸ªé¼ æ ‡æ‰€åœ¨å•è¯\nä½¿ç”¨ control + â‡§ + G å–æ¶ˆé€‰æ‹©ä¸Šä¸€ä¸ª\nä½¿ç”¨ control + command + G é€‰æ‹©æ‰€æœ‰å‡ºç°é¼ æ ‡æ‰€åœ¨å•è¯ï¼Œç„¶åï¼Œè¾“å…¥ä¸€ä¸ªå•è¯ï¼Œä¼šæ›¿æ¢æ‰€æœ‰é€‰ä¸­çš„å•è¯ã€‚\nç§»åŠ¨ä»£ç  å°†å½“å‰è¡Œä»£ç å‘ä¸Šç§»ï¼šoption + â‡§ + â†‘\nå°†å½“å‰è¡Œä»£ç å‘ä¸‹ç§»ï¼šoption + â‡§ + â†“\nå°†å½“å‰æ–¹æ³•å‘ä¸Šç§»ï¼šcommand + â‡§ + â†‘\nå°†å½“å‰æ–¹æ³•å‘ä¸‹ç§»ï¼šcommand + â‡§ + â†“\næ”¶ç¼©ä»£ç  æ”¶ç¼©ä»£ç ï¼šcommand + -\nå±•å¼€ä»£ç ï¼šcommand + =\næ”¶ç¼©ä¸€ä¸ªæ–‡ä»¶çš„æ‰€æœ‰ä»£ç ï¼šcommand + â‡§ + -\nå±•å¼€ä¸€ä¸ªæ–‡ä»¶çš„æ‰€æœ‰ä»£ç ï¼šcommand + â‡§ + =\nzshä¸­å®šä¹‰çš„å¿«æ·é”® ~/.oh-my-zsh/plugins/git/git.plugin.zsh\nalias g=\u0026#39;git\u0026#39; alias ga=\u0026#39;git add\u0026#39; alias gaa=\u0026#39;git add --all\u0026#39; #å°†æ‰€æœ‰å˜æ›´æ·»åŠ åˆ°æš‚å­˜åŒº alias gapa=\u0026#39;git add --patch\u0026#39; #äº¤äº’å¼çš„é€‰ä¸­å˜æ›´æ·»åŠ åˆ°æš‚å­˜åŒº #åˆ†æ”¯ç›¸å…³ alias gb=\u0026#39;git branch\u0026#39; #åˆ—å‡ºå½“å‰ä»“åº“ä¸­æ‰€æœ‰çš„åˆ†æ”¯ï¼Œå¹¶åœ¨å½“å‰åˆ†æ”¯å‰é¢æ ‡è®°ä¸€ä¸ªæ˜Ÿå· alias gba=\u0026#39;git branch -a\u0026#39; #åˆ—å‡ºæ‰€æœ‰çš„æœ¬åœ°åˆ†æ”¯å’Œè¿œç¨‹åˆ†æ”¯ alias gbd=\u0026#39;git branch -d\u0026#39; #å‘½ä»¤ç”¨äºåˆ é™¤æŒ‡å®šçš„æœ¬åœ°åˆ†æ”¯ alias gbD=\u0026#39;git branch -d --force\u0026#39; # å‘½ä»¤ç”¨äºå¼ºåˆ¶åˆ é™¤æŒ‡å®šçš„æœ¬åœ°åˆ†æ”¯ alias gbm=\u0026#39;git branch -m\u0026#39; #é‡å‘½ååˆ†æ”¯ alias gbnm=\u0026#39;git branch --no-merged\u0026#39; #åˆ—å‡ºæ‰€æœ‰æœªåˆå¹¶åˆ°å½“å‰åˆ†æ”¯çš„åˆ†æ”¯ alias gbr=\u0026#39;git branch --remote\u0026#39; #åˆ—å‡ºè¿œç¨‹åˆ†æ”¯ alias ggsup=\u0026#39;git branch --set-upstream-to=origin/$(git_current_branch)\u0026#39; #å°†å½“å‰åˆ†æ”¯ä¸è¿œç¨‹ä»“åº“çš„åŒååˆ†æ”¯å»ºç«‹èµ·è¿½è¸ªå…³ç³» #åœ¨æœ¬åœ°å’Œè¿œç¨‹ä»“åº“ä¸­é‡å‘½å Git åˆ†æ”¯ function grename() { if [[ -z \u0026#34;$1\u0026#34; || -z \u0026#34;$2\u0026#34; ]]; then echo \u0026#34;Usage: $0 old_branch new_branch\u0026#34; return 1 fi # Rename branch locally git branch -m \u0026#34;$1\u0026#34; \u0026#34;$2\u0026#34; # Rename branch in origin remote if git push origin :\u0026#34;$1\u0026#34;; then git push --set-upstream origin \u0026#34;$2\u0026#34; fi } alias gc=\u0026#39;git commit --verbose\u0026#39; #æäº¤å½“å‰æš‚å­˜åŒºä¸­çš„å˜æ›´ï¼Œå¹¶æ˜¾ç¤ºè¯¦ç»†çš„æäº¤ä¿¡æ¯ alias gc!=\u0026#39;git commit --verbose --amend\u0026#39;#ä¿®æ”¹æœ€è¿‘ä¸€æ¬¡çš„æäº¤ï¼Œå¹¶åœ¨æäº¤è¿‡ç¨‹ä¸­æ˜¾ç¤ºè¯¦ç»†çš„å˜æ›´ä¿¡æ¯ alias gcmsg=\u0026#39;git commit -m\u0026#39; #æäº¤å½“å‰æš‚å­˜åŒºä¸­çš„å˜æ›´å¹¶æä¾›æäº¤ä¿¡æ¯ alias gco=\u0026#39;git checkout\u0026#39; alias gcor=\u0026#39;git checkout --recurse-submodules\u0026#39; #é€’å½’åœ°åˆ‡æ¢åˆ°ä¸»ä»“åº“ä»¥åŠæ‰€æœ‰å­æ¨¡å—çš„ç›¸åº”æäº¤æˆ–åˆ†æ”¯ alias gcb=\u0026#39;git checkout -b\u0026#39; #åˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯å¹¶åˆ‡æ¢åˆ°è¯¥åˆ†æ”¯ alias gcB=\u0026#39;git checkout -B\u0026#39; #åˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯å¹¶å¼ºåˆ¶åˆ‡æ¢åˆ°è¯¥åˆ†æ”¯ alias gcd=\u0026#39;git checkout $(git_develop_branch)\u0026#39; alias gcm=\u0026#39;git checkout $(git_main_branch)\u0026#39; alias gcl=\u0026#39;git clone --recurse-submodules\u0026#39; #å…‹éš†ä»£ç  gccd #å…‹éš†ä»£ç å¹¶è¿›å…¥ç›®å½• alias gcf=\u0026#39;git config --list\u0026#39; alias gf=\u0026#39;git fetch\u0026#39; alias gfo=\u0026#39;git fetch origin\u0026#39; alias gm=\u0026#39;git merge\u0026#39; alias gma=\u0026#39;git merge --abort\u0026#39; alias gms=\u0026#34;git merge --squash\u0026#34; alias gmom=\u0026#39;git merge origin/$(git_main_branch)\u0026#39; alias gmum=\u0026#39;git merge upstream/$(git_main_branch)\u0026#39; #æ‹‰å–ä»£ç  alias gl=\u0026#39;git pull\u0026#39; alias gpr=\u0026#39;git pull --rebase\u0026#39; #æ‹‰å–è¿œç¨‹ä»“åº“çš„æœ€æ–°æäº¤ï¼Œå¹¶å°†æœ¬åœ°æäº¤åº”ç”¨åˆ°æœ€æ–°æäº¤ alias gpra=\u0026#39;git pull --rebase --autostash\u0026#39; #æ‹‰å–è¿œç¨‹ä»“åº“çš„æœ€æ–°æäº¤ï¼Œå¹¶å°†æœ¬åœ°æäº¤åº”ç”¨åˆ°æœ€æ–°æäº¤ä¹‹ä¸Šï¼ŒåŒæ—¶è‡ªåŠ¨ä¿å­˜å’Œæ¢å¤æœªæäº¤çš„æ›´æ”¹ alias ggpull=\u0026#39;git pull origin \u0026#34;$(git_current_branch)\u0026#34;\u0026#39; #ä»è¿œç¨‹ä»“åº“æ‹‰å–æœ€æ–°æäº¤ï¼Œå¹¶ä½¿ç”¨ rebase çš„æ–¹å¼å°†æœ¬åœ°æäº¤åº”ç”¨åˆ°æ‹‰å–çš„æäº¤ä¹‹ function ggu() { [[ \u0026#34;$#\u0026#34; != 1 ]] \u0026amp;\u0026amp; local b=\u0026#34;$(git_current_branch)\u0026#34; git pull --rebase origin \u0026#34;${b:=$1}\u0026#34; } #æäº¤ä»£ç  alias gp=\u0026#39;git push\u0026#39; alias gpd=\u0026#39;git push --dry-run\u0026#39; alias ggpush=\u0026#39;git push origin \u0026#34;$(git_current_branch)\u0026#34;\u0026#39; #æ‹‰å–ä»£ç å¹¶æäº¤ function ggpnp() { if [[ \u0026#34;$#\u0026#34; == 0 ]]; then ggl \u0026amp;\u0026amp; ggp else ggl \u0026#34;${*}\u0026#34; \u0026amp;\u0026amp; ggp \u0026#34;${*}\u0026#34; fi } alias grb=\u0026#39;git rebase\u0026#39; alias grba=\u0026#39;git rebase --abort\u0026#39; alias grbc=\u0026#39;git rebase --continue\u0026#39; alias grbi=\u0026#39;git rebase --interactive\u0026#39; alias grbo=\u0026#39;git rebase --onto\u0026#39; alias grbs=\u0026#39;git rebase --skip\u0026#39; alias grbd=\u0026#39;git rebase $(git_develop_branch)\u0026#39; alias grbm=\u0026#39;git rebase $(git_main_branch)\u0026#39; alias grbom=\u0026#39;git rebase origin/$(git_main_branch)\u0026#39; alias gr=\u0026#39;git remote\u0026#39; alias gra=\u0026#39;git remote add\u0026#39; alias grrm=\u0026#39;git remote remove\u0026#39; alias grmv=\u0026#39;git remote rename\u0026#39; alias grset=\u0026#39;git remote set-url\u0026#39; alias grup=\u0026#39;git remote update\u0026#39; alias gst=\u0026#39;git status\u0026#39; ","permalink":"https://blog.chensoul.cc/posts/2024/01/25/til/","summary":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\næ•´ç† Idea å¿«æ·é”® æ•´ç† zsh ä¸­å®šä¹‰çš„å¸¸ç”¨çš„å¿«æ·é”® Idea å¿«æ·é”® ä½¿ç”¨å¿«æ·é”® command +1 æ‰“å¼€ Project çª—å£\nè¾“å…¥ control + R å¯ä»¥è¿è¡Œ Java ä»£ç \nä¸Šä¸‹æ–‡ åœ¨ for æ–¹æ³•ä¸Šï¼Œè¾“å…¥ option + enterï¼Œå¯ä»¥è°ƒå‡ºä¸Šä¸‹æ–‡ï¼Œæ›¿æ¢ for è¡¨è¾¾å¼\nåœ¨å­—ç¬¦ä¸²ä¸Šé¢è¾“å…¥ option + enterï¼Œå¯ä»¥è°ƒå‡ºä¸Šä¸‹æ–‡ã€‚\nåœ¨å­—ç¬¦ä¸²ä¸Šé¢æˆ–è€…åŒå‡»é€‰ä¸­ï¼Œç„¶ååŒå‡»ä¸¤æ¬¡ â‡§ ï¼Œæ‰“å¼€ Search Everywhere å¼¹çª—ï¼Œç„¶åè¾“å…¥ case ï¼Œé€‰æ‹© Toggle Case å°† AVERAGE å˜ä¸ºå°å†™ã€‚\nåœ¨æ²¡æœ‰ä½¿ç”¨çš„æ–¹æ³•å‚æ•° redundant ä¸Šï¼Œè¾“å…¥ option + enterï¼Œå¯ä»¥é€‰æ‹© Safe delete 'redunant' åˆ é™¤è¯¥å‚æ•°\nåœ¨ä¸‰ç›®è¿ç®—ï¼Œè¾“å…¥ option + enterï¼Œå¯ä»¥é€‰æ‹© Negate '?:'\næœç´¢ æŸ¥æ‰¾æœ€è¿‘æ–‡ä»¶ï¼šcomand + E\nè¾“å…¥ â‡§ + command + A å¯ä»¥æ‰“å¼€ Find Action çª—å£ã€‚\nåŒå‡»ä¸¤æ¬¡ â‡§ å¯ä»¥æ‰“å¼€ Search Everywhere çª—å£ã€‚è¾“å…¥å…³é”®å­—ï¼Œå¯ä»¥æœç´¢ java ç±»ã€‚\nå¦‚æœæƒ³æœç´¢Javaç±»ï¼Œåˆ™å¯ä»¥è¾“å…¥ command + Oï¼Œå¹¶å¯ä»¥é€‰æ‹©åœ¨ All Places æœç´¢ã€‚\nå¦‚æœæƒ³æœç´¢æ–¹æ³•æˆ–è€…å˜é‡åç§°ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ option + command + O\nè‡ªåŠ¨è¡¥å…¨ command + â†‘ + enter è¡¥å…¨æ–¹æ³•ä½“ã€ifã€whileã€for ã€switch åé¢æ‹¬å·","title":"2024-01-25ï½œIdeaå’Œzshå¿«æ·é”®"},{"content":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\nè§‚çœ‹ B ç«™è§†é¢‘ã€Šé¸Ÿå®çš„æ˜¥å¤©11_securityç¼–ç å®ç°ã€‹\nå‚è€ƒè§†é¢‘ä¸­ç¤ºä¾‹ä½¿ç”¨ SecurityFilterChain DSL è¯­æ³•å®ç°ç”¨æˆ·åå¯†ç ç™»å½•åŠŸèƒ½ã€‚\næ‰©å±• WebAuthenticationDetails ï¼Œä¿®æ”¹å®¢æˆ·ç«¯ IP è·å–æ–¹å¼ï¼Œå¹¶è®°å½•æœåŠ¡ç«¯ IPã€‚\npublic class CustomWebAuthenticationDetails extends WebAuthenticationDetails { private static final long serialVersionUID = 4441359628463408329L; @Getter private final String serverAddress; public CustomWebAuthenticationDetails(final HttpServletRequest request, final String serverAddress) { super(HttpRequestUtils.getClientIp(request), extractSessionId(request)); this.serverAddress = serverAddress; } protected static String extractSessionId(final HttpServletRequest request) { final HttpSession session = request.getSession(false); return (session != null) ? session.getId() : null; } } è·å–å®¢æˆ·ç«¯ IP ä½¿ç”¨äº† HttpRequestUtils ç±»ï¼Œå®é™…ä¸Šå°±æ˜¯ä» Request çš„ header ä¸­è·å– IPã€‚\nprivate static final List\u0026lt;String\u0026gt; CLIENT_IP_HEADER_NAMES = Arrays.asList(\u0026#34;X-Forwarded-For\u0026#34;, \u0026#34;X-Real-IP\u0026#34;, \u0026#34;Proxy-Client-IP\u0026#34;, \u0026#34;WL-Proxy-Client-IP\u0026#34;, \u0026#34;HTTP_CLIENT_IP\u0026#34;, \u0026#34;HTTP_X_FORWARDED_FOR\u0026#34;); public static String getClientIp(HttpServletRequest request, String... otherHeaderNames) { if (request == null) { return null; } if (ArrayUtils.isNotEmpty(otherHeaderNames)) { CLIENT_IP_HEADER_NAMES.addAll(Arrays.asList(otherHeaderNames)); } String ip; for (String header : CLIENT_IP_HEADER_NAMES) { ip = request.getHeader(header); if (!NetUtils.isUnknown(ip)) { return NetUtils.getMultistageReverseProxyIp(ip); } } ip = request.getRemoteHost(); return NetUtils.getMultistageReverseProxyIp(ip); } ","permalink":"https://blog.chensoul.cc/posts/2024/01/24/til/","summary":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\nè§‚çœ‹ B ç«™è§†é¢‘ã€Šé¸Ÿå®çš„æ˜¥å¤©11_securityç¼–ç å®ç°ã€‹\nå‚è€ƒè§†é¢‘ä¸­ç¤ºä¾‹ä½¿ç”¨ SecurityFilterChain DSL è¯­æ³•å®ç°ç”¨æˆ·åå¯†ç ç™»å½•åŠŸèƒ½ã€‚\næ‰©å±• WebAuthenticationDetails ï¼Œä¿®æ”¹å®¢æˆ·ç«¯ IP è·å–æ–¹å¼ï¼Œå¹¶è®°å½•æœåŠ¡ç«¯ IPã€‚\npublic class CustomWebAuthenticationDetails extends WebAuthenticationDetails { private static final long serialVersionUID = 4441359628463408329L; @Getter private final String serverAddress; public CustomWebAuthenticationDetails(final HttpServletRequest request, final String serverAddress) { super(HttpRequestUtils.getClientIp(request), extractSessionId(request)); this.serverAddress = serverAddress; } protected static String extractSessionId(final HttpServletRequest request) { final HttpSession session = request.getSession(false); return (session != null) ? session.getId() : null; } } è·å–å®¢æˆ·ç«¯ IP ä½¿ç”¨äº† HttpRequestUtils ç±»ï¼Œå®é™…ä¸Šå°±æ˜¯ä» Request çš„ header ä¸­è·å– IPã€‚\nprivate static final List\u0026lt;String\u0026gt; CLIENT_IP_HEADER_NAMES = Arrays.asList(\u0026#34;X-Forwarded-For\u0026#34;, \u0026#34;X-Real-IP\u0026#34;, \u0026#34;Proxy-Client-IP\u0026#34;, \u0026#34;WL-Proxy-Client-IP\u0026#34;, \u0026#34;HTTP_CLIENT_IP\u0026#34;, \u0026#34;HTTP_X_FORWARDED_FOR\u0026#34;); public static String getClientIp(HttpServletRequest request, String... otherHeaderNames) { if (request == null) { return null; } if (ArrayUtils.","title":"2024-01-24ï½œä»Šå¤©åšäº†ä»€ä¹ˆ"},{"content":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\né‡æ„ foodie-cloud é¡¹ç›®ï¼Œä¿®æ”¹æ¨¡å—åç§°ã€è¡¨ååŠå­—æ®µåã€‚\nä¿®æ”¹ spring-security-oauth2-legacy-examples ï¼Œæµ‹è¯•èµ„æºæœåŠ¡å™¨é€šè¿‡ jwtã€jwkã€è¿œç¨‹ä¸‰ç§æ–¹å¼è·å–ç”¨æˆ·ä¿¡æ¯ï¼›æµ‹è¯• sso å•ç‚¹ç™»å½•ï¼ˆè¿›è¡Œä¸­ï¼‰ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2024/01/23/til/","summary":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\né‡æ„ foodie-cloud é¡¹ç›®ï¼Œä¿®æ”¹æ¨¡å—åç§°ã€è¡¨ååŠå­—æ®µåã€‚\nä¿®æ”¹ spring-security-oauth2-legacy-examples ï¼Œæµ‹è¯•èµ„æºæœåŠ¡å™¨é€šè¿‡ jwtã€jwkã€è¿œç¨‹ä¸‰ç§æ–¹å¼è·å–ç”¨æˆ·ä¿¡æ¯ï¼›æµ‹è¯• sso å•ç‚¹ç™»å½•ï¼ˆè¿›è¡Œä¸­ï¼‰ã€‚","title":"2024-01-23ï½œä»Šå¤©åšäº†ä»€ä¹ˆ"},{"content":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\nä¿®æ”¹ç‘å‰å¤–å–é¡¹ç›® reggieï¼š\nå»æ‰ .mvn ç›¸å…³æ–‡ä»¶ï¼Œå»æ‰ github action ä¸­ç”¨åˆ° .mvn çš„ workflow å‚è€ƒ DDD ä¿®æ”¹åŒ…ç»“æ„ é…ç½® Redis æŒä¹…åŒ–\nchensoul-parent å‘å¸ƒ v1.0.40 ï¼Œå‡çº§ maven æ’ä»¶ç‰ˆæœ¬ï¼Œå»æ‰ sortpomã€impsort æ’ä»¶\nvps ç¦ç”¨é˜²ç«å¢™\nè§‚çœ‹æ…•è¯¾ç½‘è§†é¢‘ã€Šé«˜çº§Redisè¿›é˜¶è¯¾ è§£å†³Rediså®é™…é—®é¢˜+æŒæ¡Redis6.xç‰¹æ€§ã€‹ï¼Œç½‘ç›˜åœ°å€ï¼šhttps://www.aliyundrive.com/s/DqXP972AJnkã€‚æ³¨æ„ï¼šå…¶ä¸­æ²¡æœ‰é¡¹ç›®èµ„æ–™ï¼Œå¦‚æœ‰éœ€è¦ï¼Œå¯ä»¥è”ç³»æˆ‘ã€‚\né‡æ„ ã€Šé«˜çº§Redisè¿›é˜¶è¯¾ è§£å†³Rediså®é™…é—®é¢˜+æŒæ¡Redis6.xç‰¹æ€§ã€‹ èµ„æ–™ä¸­çš„ food-social-contact-parent æºä»£ç ï¼Œé‡å‘½åä¸º foodie-cloud å¹¶æäº¤åˆ° Github ä»“åº“ foodie-cloud ï¼ˆåŸæ¥çš„ foodie-cloud æºç å·²åˆ é™¤ï¼‰ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2024/01/22/til/","summary":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\nä¿®æ”¹ç‘å‰å¤–å–é¡¹ç›® reggieï¼š\nå»æ‰ .mvn ç›¸å…³æ–‡ä»¶ï¼Œå»æ‰ github action ä¸­ç”¨åˆ° .mvn çš„ workflow å‚è€ƒ DDD ä¿®æ”¹åŒ…ç»“æ„ é…ç½® Redis æŒä¹…åŒ–\nchensoul-parent å‘å¸ƒ v1.0.40 ï¼Œå‡çº§ maven æ’ä»¶ç‰ˆæœ¬ï¼Œå»æ‰ sortpomã€impsort æ’ä»¶\nvps ç¦ç”¨é˜²ç«å¢™\nè§‚çœ‹æ…•è¯¾ç½‘è§†é¢‘ã€Šé«˜çº§Redisè¿›é˜¶è¯¾ è§£å†³Rediså®é™…é—®é¢˜+æŒæ¡Redis6.xç‰¹æ€§ã€‹ï¼Œç½‘ç›˜åœ°å€ï¼šhttps://www.aliyundrive.com/s/DqXP972AJnkã€‚æ³¨æ„ï¼šå…¶ä¸­æ²¡æœ‰é¡¹ç›®èµ„æ–™ï¼Œå¦‚æœ‰éœ€è¦ï¼Œå¯ä»¥è”ç³»æˆ‘ã€‚\né‡æ„ ã€Šé«˜çº§Redisè¿›é˜¶è¯¾ è§£å†³Rediså®é™…é—®é¢˜+æŒæ¡Redis6.xç‰¹æ€§ã€‹ èµ„æ–™ä¸­çš„ food-social-contact-parent æºä»£ç ï¼Œé‡å‘½åä¸º foodie-cloud å¹¶æäº¤åˆ° Github ä»“åº“ foodie-cloud ï¼ˆåŸæ¥çš„ foodie-cloud æºç å·²åˆ é™¤ï¼‰ã€‚","title":"2024-01-22ï½œä»Šå¤©åšäº†ä»€ä¹ˆ"},{"content":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\nä¿®æ”¹ç‘å‰å¤–å–é¡¹ç›® reggieï¼š\nä¿®æ”¹æ•°æ®æºé…ç½®ï¼Œä½¿ç”¨ HikariCP æ•°æ®æº ä¿®æ”¹æ¥å£è¿”å›å­—æ®µå’Œå‰ç«¯æ–‡ä»¶ï¼Œcode=0 è¡¨ç¤ºæˆåŠŸ æ·»åŠ  mysqlã€redis å®‰è£…æ–‡æ¡£ æ·»åŠ  openresty lua è„šæœ¬å®ç° redis ç¼“å­˜ åŸºäº springboot ä½¿ç”¨ sharding-jdbc æµ‹è¯•è¯»å†™åˆ†ç¦»ã€åˆ†åº“åˆ†è¡¨ã€‚ä»£ç åœ¨ï¼šhttps://github.com/chensoul/sharding-examples\næµ‹è¯• RabbitMQ ç”Ÿäº§ã€æ¶ˆè´¹ï¼Œä»£ç åœ¨ï¼šhttps://github.com/chensoul/rabbitmq-examples\nè§‚çœ‹ B ç«™è§†é¢‘ã€Šã€ITè€é½455ã€‘SpringBootã€Caffineã€Redisæœ¬åœ°è¿œç¨‹äºŒçº§ç¼“å­˜ã€‹ï¼Œè§†é¢‘ä¸­çš„ä»£ç åœ¨ï¼šsecond-cache\n","permalink":"https://blog.chensoul.cc/posts/2024/01/18/til/","summary":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\nä¿®æ”¹ç‘å‰å¤–å–é¡¹ç›® reggieï¼š\nä¿®æ”¹æ•°æ®æºé…ç½®ï¼Œä½¿ç”¨ HikariCP æ•°æ®æº ä¿®æ”¹æ¥å£è¿”å›å­—æ®µå’Œå‰ç«¯æ–‡ä»¶ï¼Œcode=0 è¡¨ç¤ºæˆåŠŸ æ·»åŠ  mysqlã€redis å®‰è£…æ–‡æ¡£ æ·»åŠ  openresty lua è„šæœ¬å®ç° redis ç¼“å­˜ åŸºäº springboot ä½¿ç”¨ sharding-jdbc æµ‹è¯•è¯»å†™åˆ†ç¦»ã€åˆ†åº“åˆ†è¡¨ã€‚ä»£ç åœ¨ï¼šhttps://github.com/chensoul/sharding-examples\næµ‹è¯• RabbitMQ ç”Ÿäº§ã€æ¶ˆè´¹ï¼Œä»£ç åœ¨ï¼šhttps://github.com/chensoul/rabbitmq-examples\nè§‚çœ‹ B ç«™è§†é¢‘ã€Šã€ITè€é½455ã€‘SpringBootã€Caffineã€Redisæœ¬åœ°è¿œç¨‹äºŒçº§ç¼“å­˜ã€‹ï¼Œè§†é¢‘ä¸­çš„ä»£ç åœ¨ï¼šsecond-cache","title":"2024-01-18ï½œä»Šå¤©åšäº†ä»€ä¹ˆ"},{"content":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\nè§‚çœ‹ã€Š2022å¹´é»‘é©¬ç¨‹åºå‘˜æ–°ç‰ˆjavaè¯¾ç¨‹ã€‹ä¸­ MySQL ä¸»ä»å¤åˆ¶å’Œè¯»å†™åˆ†ç¦»ç›¸å…³è§†é¢‘ï¼Œä½¿ç”¨ Docker æ­å»º MySQL ä¸»ä»å¤åˆ¶ç¯å¢ƒã€‚ foodie-cloud é¡¹ç›®å®ç°è¯»å†™åˆ†ç¦»å¹¶é›†æˆ Springdoc Docker æ­å»º MySQL ä¸»ä»å¤åˆ¶ç¯å¢ƒ å‚è€ƒæ–‡ç«  ï¼šåŸºäº Docker çš„ MySQL ä¸»ä»å¤åˆ¶æ­å»ºåŠåŸç†ï¼ˆçœŸæ­£å¼„æ‡‚ï¼‰\nå…ˆåˆ›å»ºä¸¤ä¸ªå®¹å™¨ï¼š\nversion: \u0026#39;3.8\u0026#39; services: mysql-master: image: mysql:8 restart: always env_file: - .env ports: - \u0026#34;3307:3306\u0026#34; environment: - TZ=Asia/Shanghai - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD} - MYSQL_DATABASE=${MYSQL_DATABASE} - MYSQL_USER=${MYSQL_USER} - MYSQL_PASSWORD=${MYSQL_PASSWORD} command: --default-authentication-plugin=mysql_native_password --explicit_defaults_for_timestamp=true --lower_case_table_names=1 --tls-version=\u0026#39;\u0026#39; --log-bin=mysql-bin --server-id=1 healthcheck: test: \u0026#34;/usr/bin/mysql --user=${MYSQL_USER} --password=${MYSQL_PASSWORD} -e \u0026#39;SHOW DATABASES;\u0026#39;\u0026#34; interval: 5s timeout: 2s retries: 10 mysql-slave: image: mysql:8 restart: always env_file: - .env ports: - \u0026#34;3308:3306\u0026#34; environment: - TZ=Asia/Shanghai - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD} - MYSQL_DATABASE=${MYSQL_DATABASE} - MYSQL_USER=${MYSQL_USER} - MYSQL_PASSWORD=${MYSQL_PASSWORD} command: --default-authentication-plugin=mysql_native_password --explicit_defaults_for_timestamp=true --lower_case_table_names=1 --tls-version=\u0026#39;\u0026#39; --log-bin=mysql-bin --server-id=2 healthcheck: test: \u0026#34;/usr/bin/mysql --user=${MYSQL_USER} --password=${MYSQL_PASSWORD} -e \u0026#39;SHOW DATABASES;\u0026#39;\u0026#34; interval: 5s timeout: 2s retries: 10 .env æ–‡ä»¶ï¼š\nTZ=Asia/Shanghai MYSQL_ROOT_PASSWORD=123456 MYSQL_DATABASE=foodie-cloud MYSQL_USER=foodie MYSQL_PASSWORD=foodie ä¸»æ•°æ®åº“ï¼š\ndocker exec -it mysql-master /bin/bash mysql -uroot -p123456 CREATE USER \u0026#39;test\u0026#39;@\u0026#39;%\u0026#39; IDENTIFIED BY \u0026#39;123456\u0026#39;; GRANT REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO \u0026#39;test\u0026#39;@\u0026#39;%\u0026#39;; SHOW MASTER STATUS; ä»æ•°æ®åº“ï¼š\ndocker inspect --format=\u0026#39;{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}\u0026#39; mysql-master docker exec -it mysql-slave /bin/bash mysql -uroot -p123456 \u0026gt; change master to master_host=\u0026#39;192.168.215.4\u0026#39;,master_user=\u0026#39;test\u0026#39;,master_password=\u0026#39;123456\u0026#39;,master_log_file=\u0026#39;mysql-bin.000003\u0026#39;,master_log_pos=642; \u0026gt;SHOW SLAVE STATUS \\G; æ­£å¸¸æƒ…å†µä¸‹ï¼ŒSlaveIORunning å’Œ SlaveSQLRunning éƒ½æ˜¯ Noï¼Œå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰å¼€å¯ä¸»ä»å¤åˆ¶è¿‡ç¨‹ã€‚ä½¿ç”¨ start slave å¼€å¯ä¸»ä»å¤åˆ¶è¿‡ç¨‹ï¼Œç„¶åå†æ¬¡æŸ¥è¯¢ä¸»ä»åŒæ­¥çŠ¶æ€ show slave status \\G;ã€‚\n\u0026gt;start slave; \u0026gt;SHOW SLAVE STATUS \\G; \u0026gt;SHOW BINARY LOGS; ShardingJDBCå®ç°è¯»å†™åˆ†ç¦» ä»‹ç» Sharding-JDBCå®šä½ä¸ºè½»é‡çº§Javaæ¡†æ¶ï¼Œåœ¨Javaçš„JDBCå±‚æä¾›çš„é¢å¤–æœåŠ¡ã€‚ å®ƒä½¿ç”¨å®¢æˆ·ç«¯ç›´è¿æ•°æ®åº“ï¼Œä»¥jaråŒ…å½¢å¼æä¾›æœåŠ¡ï¼Œæ— éœ€é¢å¤–éƒ¨ç½²å’Œä¾èµ–ï¼Œå¯ç†è§£ä¸ºå¢å¼ºç‰ˆçš„JDBCé©±åŠ¨ï¼Œå®Œå…¨å…¼å®¹JDBCå’Œå„ç§ORMæ¡†æ¶ã€‚\nä½¿ç”¨Sharding-JDBCå¯ä»¥åœ¨ç¨‹åºä¸­è½»æ¾çš„å®ç°æ•°æ®åº“è¯»å†™åˆ†ç¦»ã€‚\nSharding-JDBCå…·æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š\n1). é€‚ç”¨äºä»»ä½•åŸºäºJDBCçš„ORMæ¡†æ¶ï¼Œå¦‚ï¼šJPA, Hibernate, Mybatis, Spring JDBC Templateæˆ–ç›´æ¥ä½¿ç”¨JDBCã€‚\n2). æ”¯æŒä»»ä½•ç¬¬ä¸‰æ–¹çš„æ•°æ®åº“è¿æ¥æ± ï¼Œå¦‚ï¼šDBCP, C3P0, BoneCP, Druid, HikariCPç­‰ã€‚\n3). æ”¯æŒä»»æ„å®ç°JDBCè§„èŒƒçš„æ•°æ®åº“ã€‚ç›®å‰æ”¯æŒMySQLï¼ŒOracleï¼ŒSQLServerï¼ŒPostgreSQLä»¥åŠä»»ä½•éµå¾ªSQL92æ ‡å‡†çš„æ•°æ®åº“ã€‚\né…ç½® 1). åœ¨pom.xmlä¸­å¢åŠ shardingJdbcçš„mavenåæ ‡\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.shardingsphere\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;sharding-jdbc-spring-boot-starter\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.1.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; 2). åœ¨application.ymlä¸­å¢åŠ æ•°æ®æºçš„é…ç½®\nå…ˆæ³¨é‡ŠåŸæ¥çš„æ•°æ®æºé…ç½®ï¼š\n#spring.datasource: # url: jdbc:mysql://${mysql:mysql}:3306/foodie-cloud?connectTimeout=2000\u0026amp;socketTimeout=150000\u0026amp;allowMultiQueries=true\u0026amp;useUnicode=true\u0026amp;characterEncoding=UTF-8\u0026amp;useSSL=false\u0026amp;serverTimezone=Asia/Shanghai # driver-class-name: com.mysql.cj.jdbc.Driver # username: foodie # password: foodie ç„¶åï¼Œæ·»åŠ  shardingsphere é…ç½®ï¼š\nspring.shardingsphere: datasource: names: master,slave master: type: com.zaxxer.hikari.HikariDataSource driver-class-name: com.mysql.cj.jdbc.Driver jdbcUrl: jdbc:mysql://${mysql-master:mysql-master}:3307/foodie-cloud?connectTimeout=2000\u0026amp;socketTimeout=150000\u0026amp;allowMultiQueries=true\u0026amp;useUnicode=true\u0026amp;characterEncoding=UTF-8\u0026amp;useSSL=false\u0026amp;serverTimezone=Asia/Shanghai username: foodie password: foodie slave: type: com.zaxxer.hikari.HikariDataSource driver-class-name: com.mysql.cj.jdbc.Driver jdbcUrl: jdbc:mysql://${mysql-slave:mysql-slave}:3308/foodie-cloud?connectTimeout=2000\u0026amp;socketTimeout=150000\u0026amp;allowMultiQueries=true\u0026amp;useUnicode=true\u0026amp;characterEncoding=UTF-8\u0026amp;useSSL=false\u0026amp;serverTimezone=Asia/Shanghai username: foodie password: foodie master-slave: load-balance-algorithm-type: round_robin # æœ€ç»ˆçš„æ•°æ®æºåç§° name: dataSource # ä¸»åº“æ•°æ®æºåç§° master-data-source-name: master # ä»åº“æ•°æ®æºåç§°åˆ—è¡¨ï¼Œå¤šä¸ªé€—å·åˆ†éš” slave-data-source-names: slave props: sql: show: true å¢åŠ ä¸‹é¢é…ç½®ï¼Œå…è®¸ bean è¦†ç›–ï¼š\nspring: main: allow-bean-definition-overriding: true 3). åœ¨æœ¬åœ°çš„ hosts æ–‡ä»¶æ·»åŠ ï¼š\n127.0.0.1 mysql-master 127.0.0.1 mysql-slave 4). å¯åŠ¨åº”ç”¨\nåœ¨å¯åŠ¨è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ï¼š\nCaused by: java.sql.SQLFeatureNotSupportedException: isValid Sharding Sphere ä¸æ”¯æŒæ•°æ®åº“å¥åº·æ£€æŸ¥ï¼Œå…³é—­æ•°æ®åº“å¥åº·æ£€æŸ¥å³å¯ã€‚\n# Sharding Sphere ä¸æ”¯æŒæ•°æ®åº“å¥åº·æ£€æŸ¥ management.health.db.enabled: false é›†æˆ Springdoc + Javadoc æ·»åŠ ä¾èµ– spring-boot2 ä½¿ç”¨ springdoc-openapi 1.7.0 ç‰ˆæœ¬\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springdoc\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;springdoc-openapi-ui\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springdoc\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;springdoc-openapi-javadoc\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; é›†æˆ springdoc ä½¿ç”¨ javadoc æ³¨é‡Šä½œä¸ºæ–‡æ¡£ å‚è€ƒ https://springdoc.org/#javadoc-support ï¼Œä¿®æ”¹ maven-compiler-plugin æ’ä»¶ï¼š\n\u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-compiler-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${maven-compiler-plugin.version}\u0026lt;/version\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;parameters\u0026gt;true\u0026lt;/parameters\u0026gt; \u0026lt;annotationProcessorPaths\u0026gt; \u0026lt;!-- https://springdoc.org/#javadoc-support --\u0026gt; \u0026lt;path\u0026gt; \u0026lt;groupId\u0026gt;com.github.therapi\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;therapi-runtime-javadoc-scribe\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${therapi-runtime-javadoc.version}\u0026lt;/version\u0026gt; \u0026lt;/path\u0026gt; \u0026lt;!-- ä¿®å¤ lombokã€springdoc å†²çª --\u0026gt; \u0026lt;path\u0026gt; \u0026lt;groupId\u0026gt;org.projectlombok\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;lombok\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${lombok.version}\u0026lt;/version\u0026gt; \u0026lt;/path\u0026gt; \u0026lt;/annotationProcessorPaths\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt; æ·»åŠ ä¾èµ–ï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.github.therapi\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;therapi-runtime-javadoc\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${therapi-runtime-javadoc.version}\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; å¯åŠ¨åº”ç”¨ è®¿é—®ï¼š\nhttp://localhost:8080/swagger-ui.html http://localhost:8080/v3/api-docs è¯´æ˜ï¼š\nè®¿é—® swagger-ui.html ä¼šæ˜¾ç¤º petstore çš„ api æ¥å£ä¿¡æ¯ã€‚å…·ä½“åŸå› ï¼Œå¯ä»¥å‚è€ƒ https://stackoverflow.com/questions/71721477/springdoc-swagger-ui-not-using-swagger-config ç›®å‰ï¼Œæ²¡æœ‰æ‰¾åˆ°è§£å†³åŠæ³•ã€‚æ›²çº¿æ•‘å›½çš„æ–¹æ³•æ˜¯ä½¿ç”¨å…¶ä»– Swagger UIï¼Œå¦‚ Knife4jã€‚ ","permalink":"https://blog.chensoul.cc/posts/2024/01/17/til/","summary":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\nè§‚çœ‹ã€Š2022å¹´é»‘é©¬ç¨‹åºå‘˜æ–°ç‰ˆjavaè¯¾ç¨‹ã€‹ä¸­ MySQL ä¸»ä»å¤åˆ¶å’Œè¯»å†™åˆ†ç¦»ç›¸å…³è§†é¢‘ï¼Œä½¿ç”¨ Docker æ­å»º MySQL ä¸»ä»å¤åˆ¶ç¯å¢ƒã€‚ foodie-cloud é¡¹ç›®å®ç°è¯»å†™åˆ†ç¦»å¹¶é›†æˆ Springdoc Docker æ­å»º MySQL ä¸»ä»å¤åˆ¶ç¯å¢ƒ å‚è€ƒæ–‡ç«  ï¼šåŸºäº Docker çš„ MySQL ä¸»ä»å¤åˆ¶æ­å»ºåŠåŸç†ï¼ˆçœŸæ­£å¼„æ‡‚ï¼‰\nå…ˆåˆ›å»ºä¸¤ä¸ªå®¹å™¨ï¼š\nversion: \u0026#39;3.8\u0026#39; services: mysql-master: image: mysql:8 restart: always env_file: - .env ports: - \u0026#34;3307:3306\u0026#34; environment: - TZ=Asia/Shanghai - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD} - MYSQL_DATABASE=${MYSQL_DATABASE} - MYSQL_USER=${MYSQL_USER} - MYSQL_PASSWORD=${MYSQL_PASSWORD} command: --default-authentication-plugin=mysql_native_password --explicit_defaults_for_timestamp=true --lower_case_table_names=1 --tls-version=\u0026#39;\u0026#39; --log-bin=mysql-bin --server-id=1 healthcheck: test: \u0026#34;/usr/bin/mysql --user=${MYSQL_USER} --password=${MYSQL_PASSWORD} -e \u0026#39;SHOW DATABASES;\u0026#39;\u0026#34; interval: 5s timeout: 2s retries: 10 mysql-slave: image: mysql:8 restart: always env_file: - .env ports: - \u0026#34;3308:3306\u0026#34; environment: - TZ=Asia/Shanghai - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD} - MYSQL_DATABASE=${MYSQL_DATABASE} - MYSQL_USER=${MYSQL_USER} - MYSQL_PASSWORD=${MYSQL_PASSWORD} command: --default-authentication-plugin=mysql_native_password --explicit_defaults_for_timestamp=true --lower_case_table_names=1 --tls-version=\u0026#39;\u0026#39; --log-bin=mysql-bin --server-id=2 healthcheck: test: \u0026#34;/usr/bin/mysql --user=${MYSQL_USER} --password=${MYSQL_PASSWORD} -e \u0026#39;SHOW DATABASES;\u0026#39;\u0026#34; interval: 5s timeout: 2s retries: 10 .","title":"2024-01-17ï½œMySQL ä¸»ä»å¤åˆ¶ã€ShardingJDBCå®ç°è¯»å†™åˆ†ç¦»ã€é›†æˆSpringdoc+Javadoc"},{"content":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\n1ã€spring-cloud-examples æ·»åŠ åˆ†å¸ƒå¼é”ã€rabbitmqã€kafkaã€åˆ†åº“åˆ†è¡¨ç­‰ç¤ºä¾‹ä»£ç \n2ã€foodie-cloud æ·»åŠ ç™»å½•éƒ¨åˆ†ä»£ç \n3ã€æ•´ç† Redis å®‰è£…æ–‡æ¡£\nRedis å®‰è£… Centos7 é€šè¿‡ yum å®‰è£… åœ¨ CentOS 7 ä¸Šé€šè¿‡ yum å®‰è£… Redisï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œï¼š\næ›´æ–°ç³»ç»Ÿè½¯ä»¶åŒ…ï¼š\nsudo yum update å®‰è£… Redisï¼š\nsudo yum install redis å¯ä»¥çœ‹åˆ°é»˜è®¤å®‰è£…çš„ redis ç‰ˆæœ¬æ˜¯ 3.2.12-2.el7\nå¦‚æœéœ€è¦å®‰è£… redis 7ï¼Œè¿™éœ€è¦ä¸‹è½½ yum æºï¼š\nsudo yum install epel-release sudo yum -y install http://rpms.remirepo.net/enterprise/remi-release-7.rpm ç„¶åï¼Œåœ¨æŒ‡å®šæºè¿›è¡Œå®‰è£…ï¼š\nyum --enablerepo=remi install redis å¯åŠ¨ Redis æœåŠ¡ï¼š\nsudo systemctl start redis é…ç½® Redis å¼€æœºè‡ªå¯åŠ¨ï¼š\nsudo systemctl enable redis ä¿®æ”¹é…ç½®æ–‡ä»¶ /etc/redis.conf\nä¿®æ”¹ bind å’Œ requirepass\nbind 0.0.0.0 requirepass 123456 ç„¶åé‡å¯ redisï¼š\nsudo systemctl restart redis è¿è¡Œ redis-cli\nredis-cli 127.0.0.1:6379\u0026gt; auth 123456 OK Centos7 é€šè¿‡ snap å®‰è£… å®‰è£… redis\nsudo snap install redis æŸ¥çœ‹ snap å®‰è£…çš„åŒ…ï¼š\nsnap list å¯åŠ¨ Redisï¼š\nsudo snap start redis è¿è¡Œ redis-cli\nRedisçš„snapå®‰è£…æ²¡æœ‰é¢„é…ç½®çš„æ–‡ä»¶(redis.conf)ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨Redisçš„CLIè¿›å…¥æ§åˆ¶å°å¹¶è¿›è¡Œé…ç½®ã€‚\nredis.cli # æ‰“å°æ‰€æœ‰çš„é…ç½® 127.0.0.1:6379\u0026gt; CONFIG GET * é…ç½®å¤–ç½‘è®¿é—®\nè¦é…ç½®Redisä»¥å…è®¸å¤–éƒ¨ç½‘ç»œè®¿é—®ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š\n127.0.0.1:6379\u0026gt; CONFIG GET bind 127.0.0.1:6379\u0026gt; config set bind 0.0.0.0 è¿™å°†ç»‘å®šRedisæœåŠ¡å™¨åˆ°0.0.0.0 IPåœ°å€ï¼Œä½¿å…¶å¯¹å¤–å¯è®¿é—®ã€‚è¯·æ³¨æ„ï¼Œè¿™å¯èƒ½ä¼šå¸¦æ¥ä¸€äº›å®‰å…¨é£é™©ï¼Œå› æ­¤è¯·è°¨æ…æ“ä½œã€‚\nè®¾ç½®ä¿æŠ¤æ¨¡å¼\n127.0.0.1:6379\u0026gt; CONFIG SET protected-mode no è¯¥æ¨¡å¼æ§åˆ¶å¤–éƒ¨ç½‘æ˜¯å¦å¯ä»¥è¿æ¥ redis æœåŠ¡ï¼Œé»˜è®¤æ˜¯ yes, æ‰€ä»¥é»˜è®¤æˆ‘ä»¬å¤–ç½‘æ˜¯æ— æ³•è®¿é—®çš„ï¼Œå¦‚éœ€å¤–ç½‘è¿æ¥ rendis æœåŠ¡åˆ™éœ€è¦å°†æ­¤å±æ€§æ”¹ä¸º noã€‚\nè®¾ç½®è®¿é—®å¯†ç \n127.0.0.1:6379\u0026gt; config set requirepass mypass è¿™å°†è®¾ç½®ä¸€ä¸ªåä¸º\u0026quot;mypass\u0026quot;çš„å¯†ç ä½œä¸ºè®¿é—®Redisçš„è¦æ±‚ã€‚è¯·ç¡®ä¿å°†\u0026quot;mypass\u0026quot;æ›¿æ¢ä¸ºæ‚¨é€‰æ‹©çš„å¼ºå¯†ç ã€‚\nå¼€å¯é˜²ç«å¢™ï¼ˆå¯é€‰ï¼‰\n# æ·»åŠ  redis ç«¯å£ firewall-cmd --zone=public --add-port=6379/tcp --permanent firewall-cmd --zone=public --add-port=6379/udp --permanent # é‡å¯é˜²ç«å¢™ firewall-cmd --reload å‡çº§\nsudo snap refresh redis å¸è½½\nsudo snap remove redis MacOS ä¸Šå®‰è£… å®‰è£… Redisï¼š\nbrew install redis å¯åŠ¨ Redis æœåŠ¡å™¨ï¼š\nbrew services start redis è¿™å°†å¯åŠ¨ Redis æœåŠ¡å™¨å¹¶ä½¿å…¶åœ¨åå°è¿è¡Œã€‚\næŸ¥çœ‹ Redis çŠ¶æ€\nbrew services info redis éªŒè¯ Redis å®‰è£…ï¼š\næ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥éªŒè¯ Redis æ˜¯å¦æˆåŠŸå®‰è£…å¹¶æ­£åœ¨è¿è¡Œï¼š\nredis-cli ping å¦‚æœ Redis æ­£å¸¸è¿è¡Œï¼Œå®ƒå°†è¿”å› \u0026ldquo;PONG\u0026rdquo;ã€‚\nåœæ­¢ Redis æœåŠ¡å™¨ï¼š\nbrew services stop redis æºç å®‰è£… ä¸‹è½½æºä»£ç \nwget https://download.redis.io/redis-stable.tar.gz ç¼–è¯‘\ntar -xzvf redis-stable.tar.gz cd redis-stable make å¯åŠ¨ Redis æœåŠ¡å™¨\nredis-server Docker å®‰è£… é€šè¿‡ docker å®‰è£…ï¼š\nREDIS_PASSWORD=123456 docker run \\ -d \\ --restart always \\ --privileged=true \\ --name redis \\ -v /etc/localtime:/etc/localtime \\ -p 6379:6379 \\ redis:7.2.2 \\ --requirepass $REDIS_PASSWORD \\ --appendonly yes é€šè¿‡ docker-compose å®‰è£…ï¼š\nversion: \u0026#39;3\u0026#39; services: redis: image: redis:7.2.2 restart: unless-stopped environment: TZ: Asia/Shanghai command: redis-server --requirepass 123456 ports: - \u0026#34;6379:6379\u0026#34; ","permalink":"https://blog.chensoul.cc/posts/2024/01/16/til/","summary":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\n1ã€spring-cloud-examples æ·»åŠ åˆ†å¸ƒå¼é”ã€rabbitmqã€kafkaã€åˆ†åº“åˆ†è¡¨ç­‰ç¤ºä¾‹ä»£ç \n2ã€foodie-cloud æ·»åŠ ç™»å½•éƒ¨åˆ†ä»£ç \n3ã€æ•´ç† Redis å®‰è£…æ–‡æ¡£\nRedis å®‰è£… Centos7 é€šè¿‡ yum å®‰è£… åœ¨ CentOS 7 ä¸Šé€šè¿‡ yum å®‰è£… Redisï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œï¼š\næ›´æ–°ç³»ç»Ÿè½¯ä»¶åŒ…ï¼š\nsudo yum update å®‰è£… Redisï¼š\nsudo yum install redis å¯ä»¥çœ‹åˆ°é»˜è®¤å®‰è£…çš„ redis ç‰ˆæœ¬æ˜¯ 3.2.12-2.el7\nå¦‚æœéœ€è¦å®‰è£… redis 7ï¼Œè¿™éœ€è¦ä¸‹è½½ yum æºï¼š\nsudo yum install epel-release sudo yum -y install http://rpms.remirepo.net/enterprise/remi-release-7.rpm ç„¶åï¼Œåœ¨æŒ‡å®šæºè¿›è¡Œå®‰è£…ï¼š\nyum --enablerepo=remi install redis å¯åŠ¨ Redis æœåŠ¡ï¼š\nsudo systemctl start redis é…ç½® Redis å¼€æœºè‡ªå¯åŠ¨ï¼š\nsudo systemctl enable redis ä¿®æ”¹é…ç½®æ–‡ä»¶ /etc/redis.conf\nä¿®æ”¹ bind å’Œ requirepass\nbind 0.0.0.0 requirepass 123456 ç„¶åé‡å¯ redisï¼š\nsudo systemctl restart redis è¿è¡Œ redis-cli\nredis-cli 127.0.0.1:6379\u0026gt; auth 123456 OK Centos7 é€šè¿‡ snap å®‰è£… å®‰è£… redis\nsudo snap install redis æŸ¥çœ‹ snap å®‰è£…çš„åŒ…ï¼š","title":"2024-01-16ï½œRediså®‰è£…"},{"content":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\n1ã€çœ‹ JHipster æºç å‘ç°è¿™ä¸¤ä¸ªç±»åº“\njackson-datatypes-collections æ”¯æŒ hppc æ•°æ®ç±»å‹ã€‚hppcï¼šJava çš„é«˜æ€§èƒ½åŸå§‹é›†åˆï¼ŒHPPC ä¸ºæ‰€æœ‰ Java åŸºå…ƒç±»å‹æä¾›å…¸å‹é›†åˆçš„æ¨¡æ¿ç”Ÿæˆå®ç°ï¼Œä¾‹å¦‚åˆ—è¡¨ã€é›†åˆå’Œæ˜ å°„ã€‚HPPC èƒŒåçš„ä¸»è¦é©±åŠ¨åŠ›æ˜¯é’ˆå¯¹æœ€é«˜æ€§èƒ½å’Œå†…å­˜æ•ˆç‡çš„ä¼˜åŒ–ã€‚\nHandy-URI-Templates A Java URI Template processor implementing RFC6570\n2ã€æ•´ç†æ–‡æ¡£ã€ŠNginxè¿›ç¨‹æ¨¡å‹ã€‹ã€ã€ŠNginxé…ç½®ç»“æ„ä¸æŒ‡ä»¤è¯­æ³•ã€‹\nNginxé…ç½®ç»“æ„ä¸æŒ‡ä»¤è¯­æ³• Nginxçš„é…ç½®æ–‡ä»¶ä½¿ç”¨ä¸€ç§å—ç»“æ„å’ŒæŒ‡ä»¤è¯­æ³•æ¥å®šä¹‰æœåŠ¡å™¨çš„è¡Œä¸ºå’Œå±æ€§ã€‚ä»¥ä¸‹æ˜¯Nginxé…ç½®æ–‡ä»¶çš„åŸºæœ¬ç»“æ„å’ŒæŒ‡ä»¤è¯­æ³•ï¼š\nåŸºæœ¬ç»“æ„å’ŒæŒ‡ä»¤è¯­æ³• é…ç½®æ–‡ä»¶ç»“æ„ï¼š Nginxé…ç½®æ–‡ä»¶ç”±å¤šä¸ªå—ï¼ˆBlockï¼‰ç»„æˆï¼Œæ¯ä¸ªå—ç”¨èŠ±æ‹¬å· {} æ‹¬èµ·æ¥ã€‚ ä¸»è¦çš„é…ç½®å—æ˜¯ http å—ï¼Œç”¨äºå…¨å±€HTTPé…ç½®ã€‚ åœ¨ http å—å†…éƒ¨ï¼Œå¯ä»¥åŒ…å«å¤šä¸ª server å—ï¼Œæ¯ä¸ª server å—ç”¨äºé…ç½®ä¸€ä¸ªè™šæ‹Ÿä¸»æœºã€‚ åœ¨ server å—å†…éƒ¨ï¼Œå¯ä»¥åŒ…å«å¤šä¸ªå…¶ä»–å—ï¼ˆå¦‚ location å—ï¼‰ï¼Œç”¨äºé…ç½®è¯·æ±‚çš„å¤„ç†è§„åˆ™ã€‚ æŒ‡ä»¤è¯­æ³•ï¼š æŒ‡ä»¤æ˜¯é…ç½®æ–‡ä»¶ä¸­çš„å…³é”®å­—ï¼Œç”¨äºæŒ‡å®šæœåŠ¡å™¨çš„è¡Œä¸ºå’Œå±æ€§ã€‚ æŒ‡ä»¤é€šå¸¸ç”±æŒ‡ä»¤åç§°å’Œå‚æ•°ç»„æˆï¼Œä¸­é—´ä½¿ç”¨ç©ºæ ¼åˆ†éš”ã€‚ æŒ‡ä»¤ä»¥åˆ†å· ; ç»“æŸã€‚ æœ‰äº›æŒ‡ä»¤å¯ä»¥åŒ…å«å—ç»“æ„ï¼Œä»¥å®šä¹‰æ›´å¤æ‚çš„é…ç½®è§„åˆ™ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹çš„Nginxé…ç½®æ–‡ä»¶çš„ç»“æ„å’ŒæŒ‡ä»¤è¯­æ³•ï¼š\n# å…¨å±€é…ç½®å— http { # å…¨å±€æŒ‡ä»¤ directive_name parameter; # æœåŠ¡å™¨å— server { # æœåŠ¡å™¨æŒ‡ä»¤ directive_name parameter; # ä½ç½®å— location / { # ä½ç½®æŒ‡ä»¤ directive_name parameter; } } } åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œhttp æ˜¯å…¨å±€é…ç½®å—ï¼Œserver æ˜¯æœåŠ¡å™¨å—ï¼Œlocation æ˜¯ä½ç½®å—ã€‚æ¯ä¸ªå—å†…éƒ¨å¯ä»¥åŒ…å«ç›¸åº”çš„æŒ‡ä»¤ã€‚\næ³¨æ„äº‹é¡¹ï¼š\næŒ‡ä»¤åç§°å¯¹å¤§å°å†™ä¸æ•æ„Ÿï¼Œä½†é€šå¸¸ä»¥å°å†™å­—æ¯è¡¨ç¤ºã€‚ å¤šä¸ªæŒ‡ä»¤å¯ä»¥åœ¨åŒä¸€è¡Œä¸Šç”¨åˆ†å· ; åˆ†éš”ã€‚ æ³¨é‡Šä»¥ # å¼€å¤´ï¼Œå¹¶åœ¨è¡Œçš„ä»»ä½•ä½ç½®æ·»åŠ ã€‚ å¯ä»¥ä½¿ç”¨å˜é‡å’Œé¢„å®šä¹‰å˜é‡æ¥è®¾ç½®æŒ‡ä»¤å‚æ•°ã€‚ nginx.conf é…ç½® userï¼šè®¾ç½®Nginxå·¥ä½œè¿›ç¨‹çš„è¿è¡Œç”¨æˆ·å’Œç”¨æˆ·ç»„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒNginxä»¥nobodyç”¨æˆ·è¿è¡Œã€‚ è¯­æ³•ï¼šuser username [groupname] ä¾‹å¦‚ï¼šuser nginx; æˆ– user nginx nginx; worker_processesï¼šè®¾ç½®Nginxå·¥ä½œè¿›ç¨‹çš„æ•°é‡ã€‚å¯ä»¥æ˜¯ä¸€ä¸ªæ•´æ•°å€¼æˆ–autoã€‚é€šå¸¸ï¼Œå»ºè®®å°†å…¶è®¾ç½®ä¸ºæœåŠ¡å™¨å¯ç”¨CPUæ ¸å¿ƒæ•°é‡çš„ä¸€å€æˆ–ä¸¤å€ï¼Œä»¥å……åˆ†åˆ©ç”¨æœåŠ¡å™¨çš„æ€§èƒ½ã€‚ è¯­æ³•ï¼šworker_processes number | auto error_logï¼šç”¨äºè®¾ç½®é”™è¯¯æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„å’Œçº§åˆ« è¯­æ³•ï¼šerror_log file [level]; fileï¼šæŒ‡å®šé”™è¯¯æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ã€‚ levelï¼šå¯é€‰å‚æ•°ï¼ŒæŒ‡å®šè®°å½•çš„é”™è¯¯çº§åˆ«ã€‚ å¸¸è§çš„çº§åˆ«åŒ…æ‹¬ emergã€alertã€critã€errorã€warnã€noticeã€info å’Œ debugã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œé”™è¯¯æ—¥å¿—çš„çº§åˆ«ä¸º errorã€‚ å¯ä»¥ä½¿ç”¨ syslog:facility.level æ ¼å¼å°†é”™è¯¯æ—¥å¿—å‘é€åˆ°ç³»ç»Ÿæ—¥å¿—ï¼ˆsyslogï¼‰ä¸­ã€‚ eventsï¼šé…ç½®ä¸Nginxäº‹ä»¶ç›¸å…³çš„å‚æ•°ã€‚ è¯­æ³•ï¼ševents {} å¸¸ç”¨çš„å‚æ•°åŒ…æ‹¬ï¼š worker_connectionsï¼šæ¯ä¸ªå·¥ä½œè¿›ç¨‹çš„æœ€å¤§å¹¶å‘è¿æ¥æ•°ã€‚ multi_acceptï¼šæ˜¯å¦æ¥å—å¤šä¸ªè¯·æ±‚åŒæ—¶å¤„ç†ã€‚ useï¼šæŒ‡å®šäº‹ä»¶æ¨¡å—ï¼ˆå¦‚epollã€kqueueç­‰ï¼‰ã€‚ httpï¼š è¯­æ³•ï¼šhttp {} å®šä¹‰å…¨å±€HTTPé…ç½®ã€‚ å¸¸ç”¨çš„æŒ‡ä»¤åŒ…æ‹¬ï¼š includeï¼šåŒ…å«å…¶ä»–é…ç½®æ–‡ä»¶ã€‚ default_typeï¼šè®¾ç½®é»˜è®¤çš„Content-Typeã€‚ access_logï¼šå®šä¹‰è®¿é—®æ—¥å¿—çš„ä½ç½®å’Œæ ¼å¼ã€‚ sendfileï¼šç”¨äºæ§åˆ¶æ˜¯å¦ä½¿ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„é›¶æ‹·è´æŠ€æœ¯è¿›è¡Œæ–‡ä»¶ä¼ è¾“ã€‚å½“å¯ç”¨ sendfile æ—¶ï¼ŒNginx å¯ä»¥ç›´æ¥å°†æ–‡ä»¶ä»ç£ç›˜è¯»å–å¹¶å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œè€Œæ— éœ€å°†æ–‡ä»¶å†…å®¹å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´ã€‚è¿™å¯ä»¥æ˜¾è‘—æé«˜æ–‡ä»¶ä¼ è¾“çš„æ•ˆç‡å’Œæ€§èƒ½ã€‚ å½“ sendfile è®¾ç½®ä¸º on æ—¶ï¼ŒNginx å°†å°è¯•ä½¿ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„ sendfile() ç³»ç»Ÿè°ƒç”¨è¿›è¡Œæ–‡ä»¶ä¼ è¾“ã€‚ å½“ sendfile è®¾ç½®ä¸º off æ—¶ï¼ŒNginx å°†ä½¿ç”¨æ™®é€šçš„æ–¹å¼è¿›è¡Œæ–‡ä»¶ä¼ è¾“ï¼Œå³é€šè¿‡å°†æ–‡ä»¶å†…å®¹ä»ç£ç›˜å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´å†å‘é€ç»™å®¢æˆ·ç«¯ã€‚ åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé»˜è®¤å€¼ sendfile off æ˜¯å®‰å…¨å’Œå¯é çš„é€‰æ‹©ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯ç”¨ sendfile å¯èƒ½ä¼šå¸¦æ¥æ›´å¥½çš„æ€§èƒ½å’Œæ•ˆç‡ã€‚ å¯ç”¨ sendfile å¯ä»¥é™ä½ CPU å’Œå†…å­˜çš„ä½¿ç”¨é‡ï¼Œä½†åœ¨æŸäº›ç‰¹å®šçš„æ“ä½œç³»ç»Ÿæˆ–æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°æŸäº›é—®é¢˜ï¼Œå¦‚ä¼ è¾“ä¸å®Œæ•´æˆ–æ–‡ä»¶å†…å®¹æŸåç­‰ã€‚å› æ­¤ï¼Œåœ¨å¯ç”¨ sendfile ä¹‹å‰ï¼Œå»ºè®®è¿›è¡Œå……åˆ†çš„æµ‹è¯•å’Œè¯„ä¼°ã€‚ tcp_nopushï¼š å½“ tcp_nopush è®¾ç½®ä¸º on æ—¶ï¼ŒNginx å°†å¯ç”¨ TCP_CORK é€‰é¡¹ï¼Œæ•°æ®å°†è¢«ç¼“å†²å¹¶ä¸€æ¬¡æ€§å‘é€ç»™å®¢æˆ·ç«¯ï¼Œä»¥æé«˜ä¼ è¾“æ•ˆç‡ã€‚ å½“ tcp_nopush è®¾ç½®ä¸º off æ—¶ï¼ŒNginx å°†ç¦ç”¨ TCP_CORK é€‰é¡¹ï¼Œæ•°æ®å°†ç«‹å³å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå‡å°‘å»¶è¿Ÿã€‚ åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½¿ç”¨é»˜è®¤å€¼ tcp_nopush off æ˜¯å®‰å…¨å’Œå¯é çš„é€‰æ‹©ï¼Œå¯ä»¥å‡å°‘å»¶è¿Ÿã€‚ ç„¶è€Œï¼Œåœ¨æŸäº›å…·ä½“çš„åœºæ™¯ä¸­ï¼Œå¦‚é«˜å¸¦å®½ã€ä½å»¶è¿Ÿçš„ç½‘ç»œç¯å¢ƒï¼Œå¯ç”¨ tcp_nopush on å¯ä»¥æé«˜ä¼ è¾“æ•ˆç‡ï¼Œä½†å¯èƒ½ä¼šå¢åŠ å»¶è¿Ÿã€‚ keepalive_timeoutï¼šè®¾ç½®ä¸å®¢æˆ·ç«¯çš„ HTTP keep-alive è¿æ¥çš„è¶…æ—¶æ—¶é—´ã€‚HTTP keep-alive å…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„å¤šä¸ª HTTP è¯·æ±‚å’Œå“åº”å…±äº«åŒä¸€ä¸ª TCP è¿æ¥ï¼Œä»¥å‡å°‘è¿æ¥å»ºç«‹å’Œå…³é—­çš„å¼€é”€ã€‚ keepalive_timeout æŒ‡å®šäº†ä¸€ä¸ªæŒç»­è¿æ¥çš„è¶…æ—¶æ—¶é—´ã€‚å¦‚æœåœ¨è¶…è¿‡æŒ‡å®šçš„æ—¶é—´å†…æ²¡æœ‰æ–°çš„è¯·æ±‚åˆ°è¾¾ï¼ŒNginx å°†å…³é—­ keep-alive è¿æ¥ã€‚ å½“å®¢æˆ·ç«¯å‘é€æ–°è¯·æ±‚æ—¶ï¼Œè¶…è¿‡ keepalive_timeout çš„è¿æ¥å°†è¢«å…³é—­ï¼Œå¹¶åœ¨å¿…è¦æ—¶é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œkeepalive_timeout è®¾ç½®ä¸º 65 ç§’ã€‚ å¦‚æœå°† keepalive_timeout è®¾ç½®ä¸º 0ï¼Œè¡¨ç¤ºç¦ç”¨ keep-alive è¿æ¥ï¼Œæ¯ä¸ªè¯·æ±‚å°†ä½¿ç”¨ç‹¬ç«‹çš„è¿æ¥ã€‚ å¯ä»¥ä½¿ç”¨ s åç¼€è¡¨ç¤ºç§’ï¼Œæˆ–ä½¿ç”¨ ms åç¼€è¡¨ç¤ºæ¯«ç§’ã€‚ gzipï¼šç”¨äºå¯ç”¨æˆ–ç¦ç”¨å¯¹å“åº”è¿›è¡Œ Gzip å‹ç¼©ã€‚Gzip å‹ç¼©æ˜¯ä¸€ç§åœ¨æœåŠ¡å™¨ç«¯å°†å“åº”å†…å®¹è¿›è¡Œå‹ç¼©ï¼Œç„¶åå†å‘é€ç»™å®¢æˆ·ç«¯çš„æŠ€æœ¯ï¼Œå¯ä»¥å‡å°‘ä¼ è¾“æ•°æ®çš„å¤§å°ï¼Œæé«˜ç½‘ç»œä¼ è¾“æ•ˆç‡ã€‚ å½“ gzip è®¾ç½®ä¸º on æ—¶ï¼ŒNginx å°†å¯¹å“åº”å†…å®¹è¿›è¡Œ Gzip å‹ç¼©ã€‚ å½“ gzip è®¾ç½®ä¸º off æ—¶ï¼ŒNginx å°†ç¦ç”¨ Gzip å‹ç¼©ã€‚ å¯ç”¨ Gzip å‹ç¼©å¯ä»¥æ˜¾è‘—å‡å°‘ä¼ è¾“æ•°æ®çš„å¤§å°ï¼Œæé«˜ç½‘ç»œä¼ è¾“æ•ˆç‡ï¼Œä½†ä¼šå¢åŠ æœåŠ¡å™¨çš„ CPU å’Œå†…å­˜è´Ÿè½½ã€‚ åœ¨å¯ç”¨ Gzip å‹ç¼©ä¹‹å‰ï¼Œå»ºè®®è¯„ä¼°æœåŠ¡å™¨çš„æ€§èƒ½å’Œèµ„æºä½¿ç”¨æƒ…å†µï¼Œç¡®ä¿æœåŠ¡å™¨å…·å¤‡è¶³å¤Ÿçš„è®¡ç®—èµ„æºæ¥å¤„ç†å‹ç¼©æ“ä½œã€‚ å¯ä»¥é€šè¿‡é…ç½® gzip_types æŒ‡ä»¤æ¥æŒ‡å®šè¦è¿›è¡Œ Gzip å‹ç¼©çš„ MIME ç±»å‹ã€‚ è¿˜å¯ä»¥é€šè¿‡é…ç½® gzip_comp_level æŒ‡ä»¤æ¥è°ƒæ•´ Gzip å‹ç¼©çš„å‹ç¼©çº§åˆ«ã€‚ serverï¼š è¯­æ³•ï¼šserver {} é…ç½®è™šæ‹Ÿä¸»æœºã€‚ å¸¸ç”¨çš„æŒ‡ä»¤åŒ…æ‹¬ï¼š listenï¼šå®šä¹‰ç›‘å¬çš„ç«¯å£å·å’Œåœ°å€ã€‚ server_nameï¼šå®šä¹‰è™šæ‹Ÿä¸»æœºçš„åŸŸåã€‚ rootï¼šæŒ‡å®šæ ¹ç›®å½•çš„è·¯å¾„ã€‚ indexï¼šå®šä¹‰é»˜è®¤çš„ç´¢å¼•æ–‡ä»¶ã€‚ error_pageï¼šç”¨äºå®šä¹‰åœ¨ç‰¹å®š HTTP é”™è¯¯çŠ¶æ€ç å‡ºç°æ—¶ï¼Œå‘å®¢æˆ·ç«¯å‘é€è‡ªå®šä¹‰é”™è¯¯é¡µé¢çš„è·¯å¾„æˆ–é‡å®šå‘åˆ°å…¶ä»– URLã€‚ è¯­æ³•ï¼šerror_page [error_code] [action]; é€‚ç”¨èŒƒå›´ï¼šhttp, server, location é…ç½®å—å†…éƒ¨ã€‚ error_page æŒ‡å®šäº†ç‰¹å®š HTTP é”™è¯¯çŠ¶æ€ç çš„å¤„ç†æ–¹å¼ã€‚ error_code å‚æ•°æŒ‡å®šäº†è¦å¤„ç†çš„ HTTP é”™è¯¯çŠ¶æ€ç ï¼Œå¦‚ 404ã€500 ç­‰ã€‚è¿˜å¯ä»¥ä½¿ç”¨é€šé…ç¬¦ * åŒ¹é…æ‰€æœ‰é”™è¯¯çŠ¶æ€ç ã€‚ action å‚æ•°å®šä¹‰äº†å¯¹åº”é”™è¯¯çŠ¶æ€ç çš„å¤„ç†è¡Œä¸ºã€‚å¯ä»¥æœ‰ä»¥ä¸‹å‡ ç§å¤„ç†æ–¹å¼ï¼š å‘é€è‡ªå®šä¹‰é”™è¯¯é¡µé¢ï¼šerror_page error_code path;ï¼Œå…¶ä¸­ path æ˜¯è‡ªå®šä¹‰é”™è¯¯é¡µé¢çš„è·¯å¾„ã€‚ é‡å®šå‘åˆ°å…¶ä»– URLï¼šerror_page error_code redirect_url;ï¼Œå…¶ä¸­ redirect_url æ˜¯è¦é‡å®šå‘çš„ URLã€‚ ä½¿ç”¨é»˜è®¤çš„ Nginx é”™è¯¯é¡µé¢ï¼šerror_page error_code =default;ï¼Œå°†ä½¿ç”¨ Nginx é»˜è®¤çš„é”™è¯¯é¡µé¢ã€‚ è¿”å›ç©ºå“åº”ï¼šerror_page error_code =;ï¼Œå°†è¿”å›ä¸€ä¸ªç©ºçš„å“åº”ï¼Œå³ä¸å‘é€ä»»ä½•å†…å®¹ç»™å®¢æˆ·ç«¯ã€‚ locationï¼š è¯­æ³•ï¼šlocation [modifier] uri {} é…ç½®è¯·æ±‚çš„å¤„ç†è§„åˆ™ã€‚ å¸¸ç”¨çš„æŒ‡ä»¤åŒ…æ‹¬ï¼š rootï¼šæŒ‡å®šæ ¹ç›®å½•çš„è·¯å¾„ã€‚ proxy_passï¼šåå‘ä»£ç†åˆ°æŒ‡å®šçš„åç«¯æœåŠ¡å™¨ã€‚ try_filesï¼šå°è¯•åŒ¹é…å¤šä¸ªæ–‡ä»¶æˆ–è·¯å¾„ã€‚ user nginx; worker_processes auto; error_log /var/log/nginx/error.log notice; pid /var/run/nginx.pid; events { #é»˜è®¤ä½¿ç”¨ epoll æ¨¡å¼ use epoll; worker_connections 1024; } http { include /etc/nginx/mime.types; default_type application/octet-stream; log_format main \u0026#39;$remote_addr - $remote_user [$time_local] \u0026#34;$request\u0026#34; \u0026#39; \u0026#39;$status $body_bytes_sent \u0026#34;$http_referer\u0026#34; \u0026#39; \u0026#39;\u0026#34;$http_user_agent\u0026#34; \u0026#34;$http_x_forwarded_for\u0026#34;\u0026#39;; access_log /var/log/nginx/access.log main; sendfile on; #tcp_nopush on; keepalive_timeout 65; #gzip on; #gzip_types text/plain text/html; #gzip_comp_level 5; include /etc/nginx/conf.d/*.conf; } ","permalink":"https://blog.chensoul.cc/posts/2024/01/15/til/","summary":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\n1ã€çœ‹ JHipster æºç å‘ç°è¿™ä¸¤ä¸ªç±»åº“\njackson-datatypes-collections æ”¯æŒ hppc æ•°æ®ç±»å‹ã€‚hppcï¼šJava çš„é«˜æ€§èƒ½åŸå§‹é›†åˆï¼ŒHPPC ä¸ºæ‰€æœ‰ Java åŸºå…ƒç±»å‹æä¾›å…¸å‹é›†åˆçš„æ¨¡æ¿ç”Ÿæˆå®ç°ï¼Œä¾‹å¦‚åˆ—è¡¨ã€é›†åˆå’Œæ˜ å°„ã€‚HPPC èƒŒåçš„ä¸»è¦é©±åŠ¨åŠ›æ˜¯é’ˆå¯¹æœ€é«˜æ€§èƒ½å’Œå†…å­˜æ•ˆç‡çš„ä¼˜åŒ–ã€‚\nHandy-URI-Templates A Java URI Template processor implementing RFC6570\n2ã€æ•´ç†æ–‡æ¡£ã€ŠNginxè¿›ç¨‹æ¨¡å‹ã€‹ã€ã€ŠNginxé…ç½®ç»“æ„ä¸æŒ‡ä»¤è¯­æ³•ã€‹\nNginxé…ç½®ç»“æ„ä¸æŒ‡ä»¤è¯­æ³• Nginxçš„é…ç½®æ–‡ä»¶ä½¿ç”¨ä¸€ç§å—ç»“æ„å’ŒæŒ‡ä»¤è¯­æ³•æ¥å®šä¹‰æœåŠ¡å™¨çš„è¡Œä¸ºå’Œå±æ€§ã€‚ä»¥ä¸‹æ˜¯Nginxé…ç½®æ–‡ä»¶çš„åŸºæœ¬ç»“æ„å’ŒæŒ‡ä»¤è¯­æ³•ï¼š\nåŸºæœ¬ç»“æ„å’ŒæŒ‡ä»¤è¯­æ³• é…ç½®æ–‡ä»¶ç»“æ„ï¼š Nginxé…ç½®æ–‡ä»¶ç”±å¤šä¸ªå—ï¼ˆBlockï¼‰ç»„æˆï¼Œæ¯ä¸ªå—ç”¨èŠ±æ‹¬å· {} æ‹¬èµ·æ¥ã€‚ ä¸»è¦çš„é…ç½®å—æ˜¯ http å—ï¼Œç”¨äºå…¨å±€HTTPé…ç½®ã€‚ åœ¨ http å—å†…éƒ¨ï¼Œå¯ä»¥åŒ…å«å¤šä¸ª server å—ï¼Œæ¯ä¸ª server å—ç”¨äºé…ç½®ä¸€ä¸ªè™šæ‹Ÿä¸»æœºã€‚ åœ¨ server å—å†…éƒ¨ï¼Œå¯ä»¥åŒ…å«å¤šä¸ªå…¶ä»–å—ï¼ˆå¦‚ location å—ï¼‰ï¼Œç”¨äºé…ç½®è¯·æ±‚çš„å¤„ç†è§„åˆ™ã€‚ æŒ‡ä»¤è¯­æ³•ï¼š æŒ‡ä»¤æ˜¯é…ç½®æ–‡ä»¶ä¸­çš„å…³é”®å­—ï¼Œç”¨äºæŒ‡å®šæœåŠ¡å™¨çš„è¡Œä¸ºå’Œå±æ€§ã€‚ æŒ‡ä»¤é€šå¸¸ç”±æŒ‡ä»¤åç§°å’Œå‚æ•°ç»„æˆï¼Œä¸­é—´ä½¿ç”¨ç©ºæ ¼åˆ†éš”ã€‚ æŒ‡ä»¤ä»¥åˆ†å· ; ç»“æŸã€‚ æœ‰äº›æŒ‡ä»¤å¯ä»¥åŒ…å«å—ç»“æ„ï¼Œä»¥å®šä¹‰æ›´å¤æ‚çš„é…ç½®è§„åˆ™ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹çš„Nginxé…ç½®æ–‡ä»¶çš„ç»“æ„å’ŒæŒ‡ä»¤è¯­æ³•ï¼š\n# å…¨å±€é…ç½®å— http { # å…¨å±€æŒ‡ä»¤ directive_name parameter; # æœåŠ¡å™¨å— server { # æœåŠ¡å™¨æŒ‡ä»¤ directive_name parameter; # ä½ç½®å— location / { # ä½ç½®æŒ‡ä»¤ directive_name parameter; } } } åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œhttp æ˜¯å…¨å±€é…ç½®å—ï¼Œserver æ˜¯æœåŠ¡å™¨å—ï¼Œlocation æ˜¯ä½ç½®å—ã€‚æ¯ä¸ªå—å†…éƒ¨å¯ä»¥åŒ…å«ç›¸åº”çš„æŒ‡ä»¤ã€‚\næ³¨æ„äº‹é¡¹ï¼š\næŒ‡ä»¤åç§°å¯¹å¤§å°å†™ä¸æ•æ„Ÿï¼Œä½†é€šå¸¸ä»¥å°å†™å­—æ¯è¡¨ç¤ºã€‚ å¤šä¸ªæŒ‡ä»¤å¯ä»¥åœ¨åŒä¸€è¡Œä¸Šç”¨åˆ†å· ; åˆ†éš”ã€‚ æ³¨é‡Šä»¥ # å¼€å¤´ï¼Œå¹¶åœ¨è¡Œçš„ä»»ä½•ä½ç½®æ·»åŠ ã€‚ å¯ä»¥ä½¿ç”¨å˜é‡å’Œé¢„å®šä¹‰å˜é‡æ¥è®¾ç½®æŒ‡ä»¤å‚æ•°ã€‚ nginx.conf é…ç½® userï¼šè®¾ç½®Nginxå·¥ä½œè¿›ç¨‹çš„è¿è¡Œç”¨æˆ·å’Œç”¨æˆ·ç»„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒNginxä»¥nobodyç”¨æˆ·è¿è¡Œã€‚ è¯­æ³•ï¼šuser username [groupname] ä¾‹å¦‚ï¼šuser nginx; æˆ– user nginx nginx; worker_processesï¼šè®¾ç½®Nginxå·¥ä½œè¿›ç¨‹çš„æ•°é‡ã€‚å¯ä»¥æ˜¯ä¸€ä¸ªæ•´æ•°å€¼æˆ–autoã€‚é€šå¸¸ï¼Œå»ºè®®å°†å…¶è®¾ç½®ä¸ºæœåŠ¡å™¨å¯ç”¨CPUæ ¸å¿ƒæ•°é‡çš„ä¸€å€æˆ–ä¸¤å€ï¼Œä»¥å……åˆ†åˆ©ç”¨æœåŠ¡å™¨çš„æ€§èƒ½ã€‚ è¯­æ³•ï¼šworker_processes number | auto error_logï¼šç”¨äºè®¾ç½®é”™è¯¯æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„å’Œçº§åˆ« è¯­æ³•ï¼šerror_log file [level]; fileï¼šæŒ‡å®šé”™è¯¯æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ã€‚ levelï¼šå¯é€‰å‚æ•°ï¼ŒæŒ‡å®šè®°å½•çš„é”™è¯¯çº§åˆ«ã€‚ å¸¸è§çš„çº§åˆ«åŒ…æ‹¬ emergã€alertã€critã€errorã€warnã€noticeã€info å’Œ debugã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œé”™è¯¯æ—¥å¿—çš„çº§åˆ«ä¸º errorã€‚ å¯ä»¥ä½¿ç”¨ syslog:facility.","title":"2024-01-15ï½œNginxé…ç½®ç»“æ„ä¸æŒ‡ä»¤è¯­æ³•"},{"content":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\n1ã€è§‚çœ‹ B ç«™ ã€ŠSSOå•ç‚¹ç™»å½•ã€‹è§†é¢‘\n2ã€å‚è€ƒ https://github.com/jOOQ/jOOL å’Œ https://github.com/vavr-io/vavr ï¼Œå°† CheckedXXX çš„ç±»åŠ å…¥å…¬å¸é¡¹ç›®ä¸­ã€‚\næ¶‰åŠçš„ç±»æœ‰ï¼šAsync.javaã€Blocking.javaã€CheckedBiConsumer.javaã€CheckedBiFunction.javaã€CheckedBiPredicate.javaã€CheckedComparator.javaã€CheckedConsumer.javaã€CheckedFunction.javaã€CheckedPredicate.javaã€CheckedRunnable.javaã€CheckedSupplier.javaã€FunctionUtils.javaã€OnceConsumer.javaã€SameExecutorCompletionStage.javaã€UncheckedException.javaï¼Œå¹¶æ·»åŠ å•å…ƒæµ‹è¯•ç±»ã€‚\nç¤ºä¾‹ä»£ç ï¼š\n@FunctionalInterface public interface CheckedConsumer\u0026lt;T\u0026gt; { void accept(T t) throws Throwable; default CheckedConsumer\u0026lt;T\u0026gt; andThen(CheckedConsumer\u0026lt;? super T\u0026gt; after) { Objects.requireNonNull(after, \u0026#34;after is null\u0026#34;); return (T t) -\u0026gt; { accept(t); after.accept(t); }; } static \u0026lt;T\u0026gt; Consumer\u0026lt;T\u0026gt; sneaky(CheckedConsumer\u0026lt;T\u0026gt; consumer) { return unchecked(consumer, RETHROW_ALL); } static \u0026lt;T\u0026gt; Consumer\u0026lt;T\u0026gt; unchecked(CheckedConsumer\u0026lt;T\u0026gt; consumer) { return unchecked(consumer, THROWABLE_TO_RUNTIME_EXCEPTION); } static \u0026lt;T\u0026gt; Consumer\u0026lt;T\u0026gt; unchecked(CheckedConsumer\u0026lt;T\u0026gt; consumer, Consumer\u0026lt;Throwable\u0026gt; handler) { return t -\u0026gt; { try { consumer.accept(t); } catch (Throwable e) { handler.accept(e); throw new IllegalStateException(\u0026#34;Exception handler must throw a RuntimeException\u0026#34;, e); } }; } } 3ã€é‡æ„å…¬å¸å¾®æœåŠ¡æ¡†æ¶\n4ã€æ˜å¤©å¾…åŠäº‹é¡¹ï¼š\né‡å†™å¾®æœåŠ¡æ—¥å¿—è®°å½•æ¨¡å— ç»§ç»­é‡æ„ foodie-cloud æ”¯æŒå•ç‚¹ç™»å½• æ”¯æŒå…¨æ–‡æ£€ç´¢ é›†æˆ Spring Security OAuth2 Sessionå’ŒCookieçš„åŒºåˆ« Sessionå’ŒCookieæ˜¯Webå¼€å‘ä¸­å¸¸ç”¨çš„ä¸¤ç§æŠ€æœ¯ï¼Œç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å­˜å‚¨å’Œä¼ é€’æ•°æ®ã€‚å®ƒä»¬åœ¨ä¸€äº›æ–¹é¢æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›é‡è¦çš„åŒºåˆ«ã€‚\næ•°æ®å­˜å‚¨ä½ç½®ï¼š\nCookieï¼šCookieæ˜¯ä¸€å°æ®µæ–‡æœ¬ä¿¡æ¯ï¼Œå­˜å‚¨åœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸­ã€‚æ¯å½“ç”¨æˆ·è®¿é—®ç›¸åº”çš„ç½‘ç«™æ—¶ï¼Œæµè§ˆå™¨ä¼šå°†Cookieå‘é€ç»™æœåŠ¡å™¨ã€‚ Sessionï¼šSessionæ˜¯æœåŠ¡å™¨ä¸Šçš„ä¸€æ®µå­˜å‚¨ç”¨æˆ·æ•°æ®çš„ç©ºé—´ï¼Œæ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šï¼Œè€Œä¸æ˜¯åœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸­ã€‚ æ•°æ®å®‰å…¨æ€§ï¼š\nCookieï¼šCookieçš„æ•°æ®å­˜å‚¨åœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸­ï¼Œå› æ­¤å¯ä»¥è¢«ç”¨æˆ·ç¯¡æ”¹æˆ–è€…è¢«å…¶ä»–æ¶æ„ç”¨æˆ·çªƒå–ã€‚ä¸ºäº†å¢åŠ å®‰å…¨æ€§ï¼Œå¯ä»¥ä½¿ç”¨åŠ å¯†å’Œç­¾åç­‰æŠ€æœ¯å¯¹Cookieè¿›è¡Œä¿æŠ¤ã€‚ Sessionï¼šSessionçš„æ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šï¼Œç›¸å¯¹æ¥è¯´æ›´å®‰å…¨ï¼Œç”¨æˆ·æ— æ³•ç›´æ¥ç¯¡æ”¹æˆ–è€…çªƒå–Sessionæ•°æ®ã€‚ä½†æ˜¯ï¼ŒæœåŠ¡å™¨éœ€è¦é‡‡å–æªæ–½æ¥ä¿æŠ¤Sessionæ•°æ®çš„å®‰å…¨æ€§ï¼Œä¾‹å¦‚ä½¿ç”¨åˆé€‚çš„å­˜å‚¨æ–¹å¼å’Œå®‰å…¨ä¼ è¾“åè®®ã€‚ å­˜å‚¨å®¹é‡ï¼š\nCookieï¼šCookieçš„å­˜å‚¨å®¹é‡æœ‰é™ï¼Œé€šå¸¸ä¸ºå‡ KBã€‚ä¸åŒæµè§ˆå™¨å¯¹Cookieçš„å®¹é‡é™åˆ¶å¯èƒ½ä¸åŒã€‚ Sessionï¼šSessionçš„å­˜å‚¨å®¹é‡ç›¸å¯¹è¾ƒå¤§ï¼Œé€šå¸¸æ²¡æœ‰æ˜ç¡®çš„é™åˆ¶ã€‚æœåŠ¡å™¨çš„ç¡¬ç›˜ç©ºé—´å’Œå†…å­˜å¤§å°ä¼šå½±å“Sessionçš„å®¹é‡é™åˆ¶ã€‚ ç”Ÿå‘½å‘¨æœŸï¼š\nCookieï¼šCookieå¯ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå¯ä»¥æ˜¯ä¼šè¯çº§åˆ«çš„ï¼ˆå½“æµè§ˆå™¨å…³é—­æ—¶å¤±æ•ˆï¼‰æˆ–è€…æŒä¹…æ€§çš„ï¼ˆåœ¨ä¸€æ®µæ—¶é—´åå¤±æ•ˆï¼‰ã€‚ Sessionï¼šSessioné€šå¸¸åœ¨ç”¨æˆ·é¦–æ¬¡è®¿é—®ç½‘ç«™æ—¶åˆ›å»ºï¼Œå¹¶åœ¨ç”¨æˆ·å…³é—­æµè§ˆå™¨æˆ–è€…ä¸€æ®µæ—¶é—´ä¸æ´»åŠ¨åè¿‡æœŸã€‚Sessionçš„ç”Ÿå‘½å‘¨æœŸç”±æœåŠ¡å™¨ç®¡ç†ã€‚ è®¿é—®æ–¹å¼ï¼š\nCookieï¼šCookieå­˜å‚¨åœ¨æµè§ˆå™¨ä¸­ï¼Œå¯ä»¥é€šè¿‡JavaScriptæˆ–æœåŠ¡å™¨ç«¯ä»£ç ç›´æ¥è¯»å–å’Œå†™å…¥ã€‚ Sessionï¼šSessionå­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šï¼Œé€šè¿‡æœåŠ¡å™¨ç«¯ä»£ç è®¿é—®å’Œæ“ä½œã€‚ æ€»ç»“ï¼š Cookieé€‚åˆå­˜å‚¨å°‘é‡çš„ç®€å•æ•°æ®ï¼Œä¸”éœ€è¦åœ¨å®¢æˆ·ç«¯ä¿æŒçŠ¶æ€ã€‚Sessioné€‚åˆå­˜å‚¨è¾ƒå¤§çš„ç”¨æˆ·æ•°æ®æˆ–æ•æ„Ÿæ•°æ®ï¼Œä¸”éœ€è¦åœ¨æœåŠ¡å™¨ç«¯ä¿æŒçŠ¶æ€ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒCookieå’ŒSessioné€šå¸¸ä¼šç»“åˆä½¿ç”¨ï¼ŒSession IDä¼šå­˜å‚¨åœ¨Cookieä¸­ï¼Œç”¨äºæ ‡è¯†å’Œå…³è”å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸Šçš„Sessionæ•°æ®ã€‚\nå•ç‚¹ç™»å½•å’Œä¸‰æ–¹ç™»å½•çš„åŒºåˆ« å•ç‚¹ç™»å½•ï¼ˆSingle Sign-Onï¼ŒSSOï¼‰å’Œä¸‰æ–¹ç™»å½•ï¼ˆThird-party Loginï¼‰æ˜¯ä¸¤ç§ä¸åŒçš„èº«ä»½è®¤è¯æœºåˆ¶ã€‚\nå•ç‚¹ç™»å½•ï¼ˆSSOï¼‰ï¼š\nå®šä¹‰ï¼šå•ç‚¹ç™»å½•æ˜¯ä¸€ç§èº«ä»½éªŒè¯æœºåˆ¶ï¼Œå…è®¸ç”¨æˆ·åªéœ€ç™»å½•ä¸€æ¬¡ï¼Œå³å¯è®¿é—®å¤šä¸ªå…³è”çš„åº”ç”¨ç¨‹åºæˆ–ç³»ç»Ÿã€‚ æµç¨‹ï¼šç”¨æˆ·åœ¨é€šè¿‡èº«ä»½éªŒè¯åï¼Œä¼šè·å¾—ä¸€ä¸ªä»¤ç‰Œï¼Œç”¨äºè¡¨ç¤ºä»–ä»¬å·²ç»é€šè¿‡è®¤è¯ã€‚è¿™ä¸ªä»¤ç‰Œå¯ä»¥åœ¨å¤šä¸ªåº”ç”¨ç¨‹åºä¹‹é—´å…±äº«ï¼Œä½¿ç”¨æˆ·å¯ä»¥æ— éœ€é‡å¤ç™»å½•å³å¯è®¿é—®è¿™äº›åº”ç”¨ç¨‹åºã€‚ ä¼˜ç‚¹ï¼šæä¾›äº†ä¾¿åˆ©æ€§ï¼Œç”¨æˆ·åªéœ€ç™»å½•ä¸€æ¬¡å³å¯è®¿é—®å¤šä¸ªåº”ç”¨ç¨‹åºï¼Œæ— éœ€ä¸ºæ¯ä¸ªåº”ç”¨ç¨‹åºå•ç‹¬è¿›è¡Œèº«ä»½éªŒè¯ã€‚åŒæ—¶ï¼ŒSSOè¿˜å¯ä»¥æé«˜å®‰å…¨æ€§ï¼Œå› ä¸ºç”¨æˆ·åªéœ€åœ¨ä¸€ä¸ªå—ä¿¡ä»»çš„èº«ä»½æä¾›è€…è¿›è¡Œèº«ä»½éªŒè¯ã€‚ ç¤ºä¾‹ï¼šCASï¼ˆCentral Authentication Serviceï¼‰æ˜¯ä¸€ä¸ªå¸¸è§çš„SSOåè®®å’ŒæŠ€æœ¯ï¼Œç”¨äºå®ç°å•ç‚¹ç™»å½•ã€‚ ä¸‰æ–¹ç™»å½•ï¼š\nå®šä¹‰ï¼šä¸‰æ–¹ç™»å½•æ˜¯ä¸€ç§èº«ä»½éªŒè¯æœºåˆ¶ï¼Œå…è®¸ç”¨æˆ·ä½¿ç”¨å…¶åœ¨ç¬¬ä¸‰æ–¹èº«ä»½æä¾›è€…ï¼ˆå¦‚ç¤¾äº¤åª’ä½“å¹³å°ï¼‰ä¸Šå·²æœ‰çš„èº«ä»½è®¤è¯æ¥ç™»å½•åº”ç”¨ç¨‹åºæˆ–ç½‘ç«™ã€‚ æµç¨‹ï¼šç”¨æˆ·é€‰æ‹©ä½¿ç”¨ä¸‰æ–¹ç™»å½•ï¼Œå¹¶æä¾›å…¶åœ¨ç¬¬ä¸‰æ–¹èº«ä»½æä¾›è€…ä¸Šçš„å‡­æ®ã€‚åº”ç”¨ç¨‹åºå°†å‘ç¬¬ä¸‰æ–¹èº«ä»½æä¾›è€…å‘é€è¯·æ±‚ï¼Œä»¥éªŒè¯ç”¨æˆ·çš„èº«ä»½ï¼Œå¹¶è·å¾—ä¸€äº›åŸºæœ¬ä¿¡æ¯ã€‚åº”ç”¨ç¨‹åºå¯ä»¥é€‰æ‹©ä½¿ç”¨è¿™äº›ä¿¡æ¯æ¥åˆ›å»ºä¸€ä¸ªæœ¬åœ°è´¦æˆ·ï¼Œä¹Ÿå¯ä»¥ä»…ä¾èµ–ç¬¬ä¸‰æ–¹èº«ä»½æä¾›è€…è¿›è¡Œèº«ä»½éªŒè¯å’Œæˆæƒã€‚ ä¼˜ç‚¹ï¼šæä¾›äº†ä¾¿åˆ©æ€§ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨å…¶åœ¨ç¬¬ä¸‰æ–¹å¹³å°ä¸Šå·²æœ‰çš„èº«ä»½è¿›è¡Œç™»å½•ï¼Œæ— éœ€åˆ›å»ºæ–°çš„è´¦æˆ·å’Œå¯†ç ã€‚åŒæ—¶ï¼Œä¸‰æ–¹ç™»å½•è¿˜å¯ä»¥æä¾›é¢å¤–çš„ç”¨æˆ·ä¿¡æ¯ï¼Œä»¥ä¾¿åº”ç”¨ç¨‹åºä¸ªæ€§åŒ–ç”¨æˆ·ä½“éªŒã€‚ ç¤ºä¾‹ï¼šä½¿ç”¨Facebookã€Googleæˆ–Twitterè´¦æˆ·ç™»å½•æŸä¸ªåº”ç”¨ç¨‹åºæˆ–ç½‘ç«™ï¼Œå°±æ˜¯ä¸€ç§å¸¸è§çš„ä¸‰æ–¹ç™»å½•ã€‚ æ€»ç»“ï¼š å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰æ˜¯ä¸€ç§èº«ä»½è®¤è¯æœºåˆ¶ï¼Œå…è®¸ç”¨æˆ·åªéœ€ç™»å½•ä¸€æ¬¡ï¼Œå³å¯è®¿é—®å¤šä¸ªå…³è”çš„åº”ç”¨ç¨‹åºæˆ–ç³»ç»Ÿã€‚ä¸‰æ–¹ç™»å½•æ˜¯ä¸€ç§èº«ä»½è®¤è¯æœºåˆ¶ï¼Œå…è®¸ç”¨æˆ·ä½¿ç”¨å…¶åœ¨ç¬¬ä¸‰æ–¹èº«ä»½æä¾›è€…ä¸Šå·²æœ‰çš„èº«ä»½è®¤è¯æ¥ç™»å½•åº”ç”¨ç¨‹åºæˆ–ç½‘ç«™ã€‚ä¸¤è€…çš„ä¸»è¦åŒºåˆ«åœ¨äºå•ç‚¹ç™»å½•å…³æ³¨çš„æ˜¯ç”¨æˆ·åœ¨å¤šä¸ªåº”ç”¨ç¨‹åºä¹‹é—´çš„èº«ä»½éªŒè¯å’Œæˆæƒï¼Œè€Œä¸‰æ–¹ç™»å½•å…³æ³¨çš„æ˜¯ç”¨æˆ·ä½¿ç”¨ç¬¬ä¸‰æ–¹èº«ä»½æä¾›è€…çš„å‡­æ®è¿›è¡Œèº«ä»½éªŒè¯ã€‚\nSessionè·¨åŸŸå¦‚ä½•å®ç° åœ¨Webå¼€å‘ä¸­ï¼Œç”±äºæµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼ˆSame-Origin Policyï¼‰ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè·¨åŸŸè®¿é—®Sessionæ˜¯ä¸è¢«å…è®¸çš„ã€‚ç„¶è€Œï¼Œå¯ä»¥é€šè¿‡ä¸€äº›æŠ€æœ¯æ‰‹æ®µæ¥å®ç°è·¨åŸŸè®¿é—®Sessionã€‚ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„å®ç°æ–¹æ³•ï¼š\nJSONPï¼ˆJSON with Paddingï¼‰ï¼šJSONPæ˜¯ä¸€ç§åˆ©ç”¨åŠ¨æ€åˆ›å»º\u0026lt;script\u0026gt;æ ‡ç­¾æ¥å®ç°è·¨åŸŸè¯·æ±‚çš„æŠ€æœ¯ã€‚é€šè¿‡åœ¨è·¨åŸŸè¯·æ±‚ä¸­åŒ…å«ä¸€ä¸ªå›è°ƒå‡½æ•°çš„åç§°ï¼ŒæœåŠ¡å™¨ä¼šå°†æ•°æ®åŒ…è£…åœ¨è¯¥å‡½æ•°ä¸­ä½œä¸ºå“åº”è¿”å›ã€‚å®¢æˆ·ç«¯å¯ä»¥å®šä¹‰ä¸€ä¸ªå…¨å±€çš„å›è°ƒå‡½æ•°æ¥æ¥æ”¶å“åº”ï¼Œå¹¶åœ¨å›è°ƒå‡½æ•°ä¸­å¤„ç†æ•°æ®å’Œè®¾ç½®Sessionã€‚\nCORSï¼ˆCross-Origin Resource Sharingï¼‰ï¼šCORSæ˜¯ä¸€ç§åŸºäºHTTPå¤´éƒ¨çš„è·¨åŸŸè§£å†³æ–¹æ¡ˆã€‚æœåŠ¡å™¨ç«¯å¯ä»¥é€šè¿‡è®¾ç½®ç‰¹å®šçš„å“åº”å¤´éƒ¨ï¼Œå…è®¸æŒ‡å®šçš„åŸŸåæˆ–ä¸€ç»„åŸŸåè·¨åŸŸè®¿é—®èµ„æºã€‚å¯¹äºè·¨åŸŸè®¿é—®Sessionï¼ŒæœåŠ¡å™¨ç«¯éœ€è¦åœ¨å“åº”ä¸­åŒ…å«Access-Control-Allow-Credentials: trueå¤´éƒ¨ï¼Œå¹¶åœ¨è¯·æ±‚ä¸­è®¾ç½®withCredentials: trueä»¥å…è®¸æºå¸¦Cookieä¿¡æ¯ã€‚\nä»£ç†æœåŠ¡å™¨ï¼šå¯ä»¥è®¾ç½®ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼Œå°†è·¨åŸŸè¯·æ±‚è½¬å‘åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚å®¢æˆ·ç«¯é€šè¿‡è®¿é—®ä»£ç†æœåŠ¡å™¨ï¼Œä»£ç†æœåŠ¡å™¨åœ¨å†…éƒ¨è½¬å‘è¯·æ±‚å¹¶æºå¸¦Sessionä¿¡æ¯ã€‚ç”±äºä»£ç†æœåŠ¡å™¨ä¸ç›®æ ‡æœåŠ¡å™¨åœ¨åŒä¸€åŸŸåä¸‹ï¼Œå› æ­¤å¯ä»¥å®ç°è·¨åŸŸè®¿é—®Sessionã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›æ–¹æ³•éƒ½éœ€è¦æœåŠ¡å™¨ç«¯çš„æ”¯æŒå’Œç›¸åº”çš„é…ç½®ã€‚å¦å¤–ï¼Œè·¨åŸŸè®¿é—®Sessionæ¶‰åŠå®‰å…¨é—®é¢˜ï¼Œéœ€è¦è°¨æ…å¤„ç†ï¼Œç¡®ä¿åªæœ‰å—ä¿¡ä»»çš„åŸŸåå¯ä»¥è®¿é—®Sessionï¼Œå¹¶é‡‡å–é€‚å½“çš„å®‰å…¨æªæ–½ä¿æŠ¤ç”¨æˆ·çš„æ•°æ®ã€‚\nNginxå®ç°å…±äº« Session ä¼˜ç¼ºç‚¹ ä½¿ç”¨ Nginx çš„ ip_hash æŒ‡ä»¤å®ç°ä¼šè¯å…±äº«å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼š\nä¼˜ç‚¹ï¼š\nä¼šè¯ä¸€è‡´æ€§ï¼šip_hash æŒ‡ä»¤åŸºäºå®¢æˆ·ç«¯çš„ IP åœ°å€å°†è¯·æ±‚è·¯ç”±åˆ°åç«¯æœåŠ¡å™¨ã€‚è¿™æ„å‘³ç€ç›¸åŒ IP çš„å®¢æˆ·ç«¯å°†å§‹ç»ˆè¢«è·¯ç”±åˆ°åŒä¸€å°åç«¯æœåŠ¡å™¨ï¼Œä»è€Œå®ç°äº†ä¼šè¯ä¸€è‡´æ€§ã€‚è¿™å¯¹äºæŸäº›åº”ç”¨ç¨‹åºæ¥è¯´éå¸¸é‡è¦ï¼Œå› ä¸ºå®ƒä»¬éœ€è¦ç¡®ä¿ä¼šè¯ä¸­çš„æ•°æ®å§‹ç»ˆå­˜å‚¨åœ¨åŒä¸€æœåŠ¡å™¨ä¸Šã€‚ æ— éœ€å…±äº«ä¼šè¯å­˜å‚¨ï¼šç”±äºç›¸åŒ IP çš„å®¢æˆ·ç«¯è¢«è·¯ç”±åˆ°åŒä¸€å°åç«¯æœåŠ¡å™¨ï¼Œå› æ­¤ä¸éœ€è¦åœ¨ä¸åŒæœåŠ¡å™¨ä¹‹é—´å…±äº«ä¼šè¯æ•°æ®ã€‚æ¯ä¸ªæœåŠ¡å™¨éƒ½å¯ä»¥ç‹¬ç«‹åœ°ç®¡ç†å’Œå­˜å‚¨ä¼šè¯æ•°æ®ï¼Œç®€åŒ–äº†æ¶æ„å’Œéƒ¨ç½²ã€‚ æ˜“äºæ‰©å±•ï¼šé€šè¿‡ä½¿ç”¨ ip_hashï¼Œå¯ä»¥åœ¨å¢åŠ æœåŠ¡å™¨æ—¶è½»æ¾æ‰©å±•åº”ç”¨ç¨‹åºçš„å®¹é‡ã€‚æ¯å½“å¼•å…¥æ–°çš„æœåŠ¡å™¨æ—¶ï¼Œéƒ¨åˆ†å®¢æˆ·ç«¯ä¼šè¯å°†è‡ªåŠ¨è·¯ç”±åˆ°æ–°æœåŠ¡å™¨ï¼Œä»è€Œå®ç°è´Ÿè½½å‡è¡¡å’Œæ‰©å±•æ€§ã€‚ ç¼ºç‚¹ï¼š\nä¸é€‚ç”¨äºåŠ¨æ€ IP åœ°å€ï¼šip_hash æŒ‡ä»¤æ˜¯åŸºäºå®¢æˆ·ç«¯çš„ IP åœ°å€è¿›è¡Œè·¯ç”±çš„ï¼Œå› æ­¤å¯¹äºä½¿ç”¨åŠ¨æ€ IP åœ°å€çš„å®¢æˆ·ç«¯ï¼Œä¼šè¯ä¸€è‡´æ€§å¯èƒ½æ— æ³•å®ç°ã€‚å½“å®¢æˆ·ç«¯çš„ IP åœ°å€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šå¯¼è‡´ä¼šè¯è¢«é‡æ–°åˆ†é…åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œå¯èƒ½å¯¼è‡´ä¼šè¯çŠ¶æ€ä¸¢å¤±ã€‚ ä¸é€‚ç”¨äºå…±äº«è´Ÿè½½å‡è¡¡ï¼šä½¿ç”¨ ip_hash æ—¶ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯è¢«è·¯ç”±åˆ°ç‰¹å®šçš„æœåŠ¡å™¨ï¼Œè¿™å¯èƒ½å¯¼è‡´æœåŠ¡å™¨ä¹‹é—´çš„è´Ÿè½½ä¸å‡è¡¡ã€‚å¦‚æœæŸäº›å®¢æˆ·ç«¯çš„ IP åœ°å€é›†ä¸­åœ¨æŸå‡ ä¸ªæœåŠ¡å™¨ä¸Šï¼Œè€Œå…¶ä»–æœåŠ¡å™¨çš„è´Ÿè½½è¾ƒè½»ï¼Œåˆ™ä¼šå¯¼è‡´èµ„æºåˆ©ç”¨ä¸å‡è¡¡ã€‚ å•ç‚¹æ•…éšœï¼šå¦‚æœæŸä¸ªæœåŠ¡å™¨å‡ºç°æ•…éšœï¼Œæ‰€æœ‰ä¸è¯¥æœåŠ¡å™¨å…³è”çš„å®¢æˆ·ç«¯ä¼šè¯å°†å—åˆ°å½±å“ï¼Œå› ä¸ºå®ƒä»¬æ— æ³•è¢«æ­£ç¡®è·¯ç”±åˆ°å…¶ä»–æœåŠ¡å™¨ã€‚è¿™å¯èƒ½å¯¼è‡´æœåŠ¡ä¸­æ–­å’Œæ•°æ®ä¸¢å¤±ã€‚ æ€»ç»“èµ·æ¥ï¼Œip_hash æä¾›äº†ç®€å•ä¸”æœ‰æ•ˆçš„ä¼šè¯å…±äº«æ–¹æ³•ï¼Œé€‚ç”¨äºæŸäº›ç‰¹å®šåœºæ™¯ã€‚ç„¶è€Œï¼Œå®ƒä¹Ÿå­˜åœ¨ä¸€äº›é™åˆ¶ï¼Œç‰¹åˆ«æ˜¯å¯¹äºåŠ¨æ€ IP åœ°å€å’Œè´Ÿè½½å‡è¡¡çš„éœ€æ±‚ã€‚åœ¨å†³å®šæ˜¯å¦ä½¿ç”¨ ip_hash æ—¶ï¼Œéœ€è¦ä»”ç»†è€ƒè™‘åº”ç”¨ç¨‹åºçš„éœ€æ±‚å’Œæ¶æ„ï¼Œå¹¶æƒè¡¡å…¶ä¸­çš„ä¼˜ç¼ºç‚¹ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2024/01/11/til/","summary":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\n1ã€è§‚çœ‹ B ç«™ ã€ŠSSOå•ç‚¹ç™»å½•ã€‹è§†é¢‘\n2ã€å‚è€ƒ https://github.com/jOOQ/jOOL å’Œ https://github.com/vavr-io/vavr ï¼Œå°† CheckedXXX çš„ç±»åŠ å…¥å…¬å¸é¡¹ç›®ä¸­ã€‚\næ¶‰åŠçš„ç±»æœ‰ï¼šAsync.javaã€Blocking.javaã€CheckedBiConsumer.javaã€CheckedBiFunction.javaã€CheckedBiPredicate.javaã€CheckedComparator.javaã€CheckedConsumer.javaã€CheckedFunction.javaã€CheckedPredicate.javaã€CheckedRunnable.javaã€CheckedSupplier.javaã€FunctionUtils.javaã€OnceConsumer.javaã€SameExecutorCompletionStage.javaã€UncheckedException.javaï¼Œå¹¶æ·»åŠ å•å…ƒæµ‹è¯•ç±»ã€‚\nç¤ºä¾‹ä»£ç ï¼š\n@FunctionalInterface public interface CheckedConsumer\u0026lt;T\u0026gt; { void accept(T t) throws Throwable; default CheckedConsumer\u0026lt;T\u0026gt; andThen(CheckedConsumer\u0026lt;? super T\u0026gt; after) { Objects.requireNonNull(after, \u0026#34;after is null\u0026#34;); return (T t) -\u0026gt; { accept(t); after.accept(t); }; } static \u0026lt;T\u0026gt; Consumer\u0026lt;T\u0026gt; sneaky(CheckedConsumer\u0026lt;T\u0026gt; consumer) { return unchecked(consumer, RETHROW_ALL); } static \u0026lt;T\u0026gt; Consumer\u0026lt;T\u0026gt; unchecked(CheckedConsumer\u0026lt;T\u0026gt; consumer) { return unchecked(consumer, THROWABLE_TO_RUNTIME_EXCEPTION); } static \u0026lt;T\u0026gt; Consumer\u0026lt;T\u0026gt; unchecked(CheckedConsumer\u0026lt;T\u0026gt; consumer, Consumer\u0026lt;Throwable\u0026gt; handler) { return t -\u0026gt; { try { consumer.accept(t); } catch (Throwable e) { handler.accept(e); throw new IllegalStateException(\u0026#34;Exception handler must throw a RuntimeException\u0026#34;, e); } }; } } 3ã€é‡æ„å…¬å¸å¾®æœåŠ¡æ¡†æ¶\n4ã€æ˜å¤©å¾…åŠäº‹é¡¹ï¼š","title":"2024-01-11ï½œSessionå’ŒCookieçš„åŒºåˆ«ã€å•ç‚¹ç™»å½•å’Œä¸‰æ–¹ç™»å½•çš„åŒºåˆ«"},{"content":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\n1ã€Java Lambda å¢å¼º https://github.com/jOOQ/jOOL å’Œ https://github.com/vavr-io/vavr ï¼ŒjOOL åœ¨ jdk8 ä¸‹å­˜åœ¨ç¼–è¯‘é”™è¯¯ï¼Œè®¡åˆ’ï¼Œæ•´åˆè¿™ä¸¤ä¸ªé¡¹ç›®ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®ï¼Œåªå¼•å…¥è‡ªå·±éœ€è¦çš„ä¸€äº›ç±»ã€‚\n2ã€https://www.pac4j.org/ ä¸€ä¸ªå®‰å…¨æ¡†æ¶\n3ã€https://github.com/apereo/inspektr ä¸€ä¸ªè½»é‡çº§çš„ Java å®¡è®¡æ¡†æ¶ã€‚è¿™ä¸ªæ˜¯åœ¨çœ‹ CAS æºç çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°çš„ã€‚\nåœ¨ CAS çš„æºç ä¸­ï¼Œæœ‰ä¸€äº›æ¯”è¾ƒä¸é”™çš„ä»£ç ï¼Œå¼•å…¥åˆ°è‡ªå·±çš„é¡¹ç›®ä¸­ï¼Œå¦å¤–ï¼Œæ‰“ç®—ä»¿ç…§è¿™ä¸ª inspektr æ¡†æ¶ï¼Œé‡å†™å…¬å¸å¾®æœåŠ¡é¡¹ç›®ä¸­çš„æ—¥å¿—è®°å½•æ¨¡å—ã€‚\n4ã€åˆ†äº«ä¸€ä¸ªå®‰å…¨ç›¸å…³çš„ wiki ç½‘ç«™ï¼šhttps://wukong-doc.redhtc.com/security\næ€»ç»“ï¼š\nå¾…åŠäº‹é¡¹ï¼š\né‡å†™å¾®æœåŠ¡æ—¥å¿—è®°å½•æ¨¡å— å†™ä¸€ä¸ª Lambda ç±»åº“ é‡æ„å…¬å¸å¾®æœåŠ¡æ¡†æ¶ ç»§ç»­é‡æ„ foodie-cloud æ”¯æŒå•ç‚¹ç™»å½• æ”¯æŒå…¨æ–‡æ£€ç´¢ é›†æˆ Spring Security OAuth2 ","permalink":"https://blog.chensoul.cc/posts/2024/01/10/til/","summary":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\n1ã€Java Lambda å¢å¼º https://github.com/jOOQ/jOOL å’Œ https://github.com/vavr-io/vavr ï¼ŒjOOL åœ¨ jdk8 ä¸‹å­˜åœ¨ç¼–è¯‘é”™è¯¯ï¼Œè®¡åˆ’ï¼Œæ•´åˆè¿™ä¸¤ä¸ªé¡¹ç›®ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®ï¼Œåªå¼•å…¥è‡ªå·±éœ€è¦çš„ä¸€äº›ç±»ã€‚\n2ã€https://www.pac4j.org/ ä¸€ä¸ªå®‰å…¨æ¡†æ¶\n3ã€https://github.com/apereo/inspektr ä¸€ä¸ªè½»é‡çº§çš„ Java å®¡è®¡æ¡†æ¶ã€‚è¿™ä¸ªæ˜¯åœ¨çœ‹ CAS æºç çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°çš„ã€‚\nåœ¨ CAS çš„æºç ä¸­ï¼Œæœ‰ä¸€äº›æ¯”è¾ƒä¸é”™çš„ä»£ç ï¼Œå¼•å…¥åˆ°è‡ªå·±çš„é¡¹ç›®ä¸­ï¼Œå¦å¤–ï¼Œæ‰“ç®—ä»¿ç…§è¿™ä¸ª inspektr æ¡†æ¶ï¼Œé‡å†™å…¬å¸å¾®æœåŠ¡é¡¹ç›®ä¸­çš„æ—¥å¿—è®°å½•æ¨¡å—ã€‚\n4ã€åˆ†äº«ä¸€ä¸ªå®‰å…¨ç›¸å…³çš„ wiki ç½‘ç«™ï¼šhttps://wukong-doc.redhtc.com/security\næ€»ç»“ï¼š\nå¾…åŠäº‹é¡¹ï¼š\né‡å†™å¾®æœåŠ¡æ—¥å¿—è®°å½•æ¨¡å— å†™ä¸€ä¸ª Lambda ç±»åº“ é‡æ„å…¬å¸å¾®æœåŠ¡æ¡†æ¶ ç»§ç»­é‡æ„ foodie-cloud æ”¯æŒå•ç‚¹ç™»å½• æ”¯æŒå…¨æ–‡æ£€ç´¢ é›†æˆ Spring Security OAuth2 ","title":"2024-01-10ï½œ Javaå®¡è®¡æ¡†æ¶inspektr"},{"content":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\nä½¿ç”¨ renovate ç›‘æ§ç¬¬ä¸‰æ–¹ä¾èµ–æ›´æ–° ï¼Œrenovate è²Œä¼¼éœ€è¦ä»˜è´¹ï¼Œæ”¾å¼ƒã€‚ spring-security-oauth2-samples ç¤ºä¾‹å·¥ç¨‹é‡å‘½åæ¨¡å—å’ŒåŒ…åï¼Œä»£ç è§ spring-security-oauth2-boot å®ç°å•ç‚¹ç™»å½•å¹¶æµ‹è¯• å®ç°å•ç‚¹ç™»å½•å¹¶æµ‹è¯• å®ç°å•ç‚¹ç™»å½•ï¼ˆSingle Sign-Onï¼ŒSSOï¼‰å¯ä»¥é‡‡ç”¨å¤šç§æ€è·¯å’ŒæŠ€æœ¯ã€‚ä¸‹é¢æ˜¯å‡ ç§å¸¸è§çš„å®ç°æ€è·¯ï¼š\nåŸºäºä»¤ç‰Œï¼ˆTokenï¼‰çš„SSOï¼šç”¨æˆ·åœ¨ç™»å½•æ—¶ï¼Œè®¤è¯æœåŠ¡å™¨é¢å‘ä¸€ä¸ªä»¤ç‰Œç»™ç”¨æˆ·ï¼Œè¯¥ä»¤ç‰ŒåŒ…å«ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯ã€‚ç”¨æˆ·åœ¨è®¿é—®å…¶ä»–åº”ç”¨æ—¶ï¼Œå°†ä»¤ç‰Œå‘é€ç»™åº”ç”¨æœåŠ¡å™¨è¿›è¡ŒéªŒè¯ï¼Œä»è€Œå®ç°å•ç‚¹ç™»å½•ã€‚ åŸºäºä¼šè¯ï¼ˆSessionï¼‰çš„SSOï¼šç”¨æˆ·åœ¨ç™»å½•æ—¶ï¼Œè®¤è¯æœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªä¼šè¯ï¼Œå¹¶å°†ä¼šè¯IDå‘é€ç»™ç”¨æˆ·çš„æµè§ˆå™¨ã€‚ç”¨æˆ·åœ¨è®¿é—®å…¶ä»–åº”ç”¨æ—¶ï¼Œæµè§ˆå™¨å°†ä¼šè¯IDå‘é€ç»™åº”ç”¨æœåŠ¡å™¨è¿›è¡ŒéªŒè¯ï¼Œä»è€Œå®ç°å•ç‚¹ç™»å½•ã€‚ åŸºäºèº«ä»½æä¾›è€…ï¼ˆIdentity Providerï¼ŒIdPï¼‰çš„SSOï¼šä½¿ç”¨ä¸€ä¸ªç‹¬ç«‹çš„èº«ä»½æä¾›è€…ï¼ˆå¦‚OpenID Connectã€SAMLç­‰ï¼‰ï¼Œç”¨æˆ·åœ¨ç™»å½•æ—¶å°†èº«ä»½éªŒè¯å§”æ‰˜ç»™èº«ä»½æä¾›è€…ã€‚èº«ä»½æä¾›è€…è´Ÿè´£éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œå¹¶å‘åº”ç”¨ç¨‹åºæä¾›ä»¤ç‰Œæˆ–èº«ä»½å‡­è¯ï¼Œå®ç°å•ç‚¹ç™»å½•ã€‚ åŸºäºä»£ç†ï¼ˆProxyï¼‰çš„SSOï¼šé€šè¿‡åœ¨å‰ç«¯éƒ¨ç½²åå‘ä»£ç†æœåŠ¡å™¨æˆ–è´Ÿè½½å‡è¡¡å™¨ï¼Œå°†ç”¨æˆ·çš„ç™»å½•çŠ¶æ€å­˜å‚¨åœ¨ä»£ç†æœåŠ¡å™¨ä¸­ã€‚ç”¨æˆ·è®¿é—®å…¶ä»–åº”ç”¨æ—¶ï¼Œä»£ç†æœåŠ¡å™¨å°†ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯ä¼ é€’ç»™åº”ç”¨æœåŠ¡å™¨ï¼Œä»è€Œå®ç°å•ç‚¹ç™»å½•ã€‚ åŸºäºç»Ÿä¸€è®¤è¯ç³»ç»Ÿï¼ˆCASï¼‰çš„SSOï¼šä½¿ç”¨CASä½œä¸ºä¸­å¤®è®¤è¯æœåŠ¡å™¨ï¼Œç”¨æˆ·åœ¨ç™»å½•æ—¶é€šè¿‡CASè¿›è¡Œè®¤è¯ï¼Œå¹¶è·å–ä¸€ä¸ªç¥¨æ®ï¼ˆticketï¼‰ã€‚ç”¨æˆ·è®¿é—®å…¶ä»–åº”ç”¨æ—¶ï¼Œåº”ç”¨æœåŠ¡å™¨å°†ç¥¨æ®å‘é€ç»™CASè¿›è¡ŒéªŒè¯ï¼Œä»è€Œå®ç°å•ç‚¹ç™»å½•ã€‚ è¿™äº›æ€è·¯å’ŒæŠ€æœ¯å¹¶éäº’æ–¥ï¼Œå¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚å’Œç³»ç»Ÿæ¶æ„çš„å¤æ‚æ€§é€‰æ‹©é€‚åˆçš„å®ç°æ–¹å¼ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ç°æœ‰çš„SSOè§£å†³æ–¹æ¡ˆå’Œèº«ä»½ç®¡ç†å¹³å°ï¼Œå¦‚Auth0ã€Oktaã€Keycloakç­‰ï¼Œç®€åŒ–SSOçš„å®ç°è¿‡ç¨‹ã€‚\nåŸºäº OAuth2 å•ç‚¹ç™»å½• åœ¨ spring-security-oauth2-legacy-examples æ·»åŠ å•ç‚¹ç™»å½• github ç¤ºä¾‹ã€‚å‚è€ƒäº† oauth2-sample-java-webapp\nCAS å®ç°å•ç‚¹ç™»å½• CASï¼ˆCentral Authentication Serviceï¼‰æ˜¯ä¸€å¥—å®Œæ•´çš„ç»Ÿä¸€èº«ä»½è®¤è¯è§£å†³æ–¹æ¡ˆï¼Œå®Œæ•´èµ„æ–™å¯æŸ¥é˜…å…¶ å®˜æ–¹ç½‘ç«™ã€‚CASåŒ…æ‹¬å¯¹åº”çš„åè®®(CAS Protocol)ã€åè®®çš„å®ç°(CAS Server)å’Œä¸CASæœåŠ¡äº¤äº’çš„è½¯ä»¶åŒ…(CAS Client)ã€‚\nCAS Clientæ¥å…¥ç¤ºä¾‹ï¼šhttps://github.com/apereo?q=client\nCAS äº¤äº’æ—¶åºå›¾ï¼šhttps://apereo.github.io/cas/7.0.x/images/cas_flow_diagram.png\nå‚è€ƒ SpringBoot+CASæ•´åˆæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å®ç°SSOå•ç‚¹ç™»å½•ä¸ç™»å‡ºå¿«é€Ÿå…¥é—¨ä¸Šæ‰‹ è¿™ç¯‡æ–‡ç« ï¼Œä»£ç åœ¨ è¿™é‡Œã€‚\n","permalink":"https://blog.chensoul.cc/posts/2024/01/09/til/","summary":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\nä½¿ç”¨ renovate ç›‘æ§ç¬¬ä¸‰æ–¹ä¾èµ–æ›´æ–° ï¼Œrenovate è²Œä¼¼éœ€è¦ä»˜è´¹ï¼Œæ”¾å¼ƒã€‚ spring-security-oauth2-samples ç¤ºä¾‹å·¥ç¨‹é‡å‘½åæ¨¡å—å’ŒåŒ…åï¼Œä»£ç è§ spring-security-oauth2-boot å®ç°å•ç‚¹ç™»å½•å¹¶æµ‹è¯• å®ç°å•ç‚¹ç™»å½•å¹¶æµ‹è¯• å®ç°å•ç‚¹ç™»å½•ï¼ˆSingle Sign-Onï¼ŒSSOï¼‰å¯ä»¥é‡‡ç”¨å¤šç§æ€è·¯å’ŒæŠ€æœ¯ã€‚ä¸‹é¢æ˜¯å‡ ç§å¸¸è§çš„å®ç°æ€è·¯ï¼š\nåŸºäºä»¤ç‰Œï¼ˆTokenï¼‰çš„SSOï¼šç”¨æˆ·åœ¨ç™»å½•æ—¶ï¼Œè®¤è¯æœåŠ¡å™¨é¢å‘ä¸€ä¸ªä»¤ç‰Œç»™ç”¨æˆ·ï¼Œè¯¥ä»¤ç‰ŒåŒ…å«ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯ã€‚ç”¨æˆ·åœ¨è®¿é—®å…¶ä»–åº”ç”¨æ—¶ï¼Œå°†ä»¤ç‰Œå‘é€ç»™åº”ç”¨æœåŠ¡å™¨è¿›è¡ŒéªŒè¯ï¼Œä»è€Œå®ç°å•ç‚¹ç™»å½•ã€‚ åŸºäºä¼šè¯ï¼ˆSessionï¼‰çš„SSOï¼šç”¨æˆ·åœ¨ç™»å½•æ—¶ï¼Œè®¤è¯æœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªä¼šè¯ï¼Œå¹¶å°†ä¼šè¯IDå‘é€ç»™ç”¨æˆ·çš„æµè§ˆå™¨ã€‚ç”¨æˆ·åœ¨è®¿é—®å…¶ä»–åº”ç”¨æ—¶ï¼Œæµè§ˆå™¨å°†ä¼šè¯IDå‘é€ç»™åº”ç”¨æœåŠ¡å™¨è¿›è¡ŒéªŒè¯ï¼Œä»è€Œå®ç°å•ç‚¹ç™»å½•ã€‚ åŸºäºèº«ä»½æä¾›è€…ï¼ˆIdentity Providerï¼ŒIdPï¼‰çš„SSOï¼šä½¿ç”¨ä¸€ä¸ªç‹¬ç«‹çš„èº«ä»½æä¾›è€…ï¼ˆå¦‚OpenID Connectã€SAMLç­‰ï¼‰ï¼Œç”¨æˆ·åœ¨ç™»å½•æ—¶å°†èº«ä»½éªŒè¯å§”æ‰˜ç»™èº«ä»½æä¾›è€…ã€‚èº«ä»½æä¾›è€…è´Ÿè´£éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œå¹¶å‘åº”ç”¨ç¨‹åºæä¾›ä»¤ç‰Œæˆ–èº«ä»½å‡­è¯ï¼Œå®ç°å•ç‚¹ç™»å½•ã€‚ åŸºäºä»£ç†ï¼ˆProxyï¼‰çš„SSOï¼šé€šè¿‡åœ¨å‰ç«¯éƒ¨ç½²åå‘ä»£ç†æœåŠ¡å™¨æˆ–è´Ÿè½½å‡è¡¡å™¨ï¼Œå°†ç”¨æˆ·çš„ç™»å½•çŠ¶æ€å­˜å‚¨åœ¨ä»£ç†æœåŠ¡å™¨ä¸­ã€‚ç”¨æˆ·è®¿é—®å…¶ä»–åº”ç”¨æ—¶ï¼Œä»£ç†æœåŠ¡å™¨å°†ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯ä¼ é€’ç»™åº”ç”¨æœåŠ¡å™¨ï¼Œä»è€Œå®ç°å•ç‚¹ç™»å½•ã€‚ åŸºäºç»Ÿä¸€è®¤è¯ç³»ç»Ÿï¼ˆCASï¼‰çš„SSOï¼šä½¿ç”¨CASä½œä¸ºä¸­å¤®è®¤è¯æœåŠ¡å™¨ï¼Œç”¨æˆ·åœ¨ç™»å½•æ—¶é€šè¿‡CASè¿›è¡Œè®¤è¯ï¼Œå¹¶è·å–ä¸€ä¸ªç¥¨æ®ï¼ˆticketï¼‰ã€‚ç”¨æˆ·è®¿é—®å…¶ä»–åº”ç”¨æ—¶ï¼Œåº”ç”¨æœåŠ¡å™¨å°†ç¥¨æ®å‘é€ç»™CASè¿›è¡ŒéªŒè¯ï¼Œä»è€Œå®ç°å•ç‚¹ç™»å½•ã€‚ è¿™äº›æ€è·¯å’ŒæŠ€æœ¯å¹¶éäº’æ–¥ï¼Œå¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚å’Œç³»ç»Ÿæ¶æ„çš„å¤æ‚æ€§é€‰æ‹©é€‚åˆçš„å®ç°æ–¹å¼ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ç°æœ‰çš„SSOè§£å†³æ–¹æ¡ˆå’Œèº«ä»½ç®¡ç†å¹³å°ï¼Œå¦‚Auth0ã€Oktaã€Keycloakç­‰ï¼Œç®€åŒ–SSOçš„å®ç°è¿‡ç¨‹ã€‚\nåŸºäº OAuth2 å•ç‚¹ç™»å½• åœ¨ spring-security-oauth2-legacy-examples æ·»åŠ å•ç‚¹ç™»å½• github ç¤ºä¾‹ã€‚å‚è€ƒäº† oauth2-sample-java-webapp\nCAS å®ç°å•ç‚¹ç™»å½• CASï¼ˆCentral Authentication Serviceï¼‰æ˜¯ä¸€å¥—å®Œæ•´çš„ç»Ÿä¸€èº«ä»½è®¤è¯è§£å†³æ–¹æ¡ˆï¼Œå®Œæ•´èµ„æ–™å¯æŸ¥é˜…å…¶ å®˜æ–¹ç½‘ç«™ã€‚CASåŒ…æ‹¬å¯¹åº”çš„åè®®(CAS Protocol)ã€åè®®çš„å®ç°(CAS Server)å’Œä¸CASæœåŠ¡äº¤äº’çš„è½¯ä»¶åŒ…(CAS Client)ã€‚\nCAS Clientæ¥å…¥ç¤ºä¾‹ï¼šhttps://github.com/apereo?q=client\nCAS äº¤äº’æ—¶åºå›¾ï¼šhttps://apereo.github.io/cas/7.0.x/images/cas_flow_diagram.png\nå‚è€ƒ SpringBoot+CASæ•´åˆæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å®ç°SSOå•ç‚¹ç™»å½•ä¸ç™»å‡ºå¿«é€Ÿå…¥é—¨ä¸Šæ‰‹ è¿™ç¯‡æ–‡ç« ï¼Œä»£ç åœ¨ è¿™é‡Œã€‚","title":"2024-01-09ï½œå•ç‚¹ç™»å½•"},{"content":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\nVPS è¿ç§»\nç»§ç»­é‡æ„ foodie-cloud\nå‚è€ƒ https://github.com/mybatis/parent/ é‡æ„ chensoul-parent\nä¿®æ”¹äº† maven æ’ä»¶ æ·»åŠ äº† Github Actions VPS è¿ç§» è¿ç§»æ­¥éª¤ï¼š\næ—§çš„ VPS ä¸Šå¤‡ä»½æ•°æ®åº“ã€nginx é…ç½®æ–‡ä»¶ã€docker-compose æ–‡ä»¶ æ–°çš„ VPS ä¸Šå®‰è£… dockerã€docker-composeã€nginx æ–°çš„ VPS ä¸Šæ¢å¤æ•°æ®åº“ï¼Œé…ç½® nginx ä¿®æ”¹ DNS è§£æ ","permalink":"https://blog.chensoul.cc/posts/2024/01/08/til/","summary":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\nVPS è¿ç§»\nç»§ç»­é‡æ„ foodie-cloud\nå‚è€ƒ https://github.com/mybatis/parent/ é‡æ„ chensoul-parent\nä¿®æ”¹äº† maven æ’ä»¶ æ·»åŠ äº† Github Actions VPS è¿ç§» è¿ç§»æ­¥éª¤ï¼š\næ—§çš„ VPS ä¸Šå¤‡ä»½æ•°æ®åº“ã€nginx é…ç½®æ–‡ä»¶ã€docker-compose æ–‡ä»¶ æ–°çš„ VPS ä¸Šå®‰è£… dockerã€docker-composeã€nginx æ–°çš„ VPS ä¸Šæ¢å¤æ•°æ®åº“ï¼Œé…ç½® nginx ä¿®æ”¹ DNS è§£æ ","title":"2024-01-08ï½œVPS è¿ç§»"},{"content":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\nNginxã€æ­£å‘ä»£ç†å’Œåå‘ä»£ç† Nginx ä»‹ç» Nginxï¼ˆå‘éŸ³ä¸º\u0026quot;engine-x\u0026quot;ï¼‰æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„å¼€æºWebæœåŠ¡å™¨å’Œåå‘ä»£ç†æœåŠ¡å™¨ã€‚å®ƒä¸“æ³¨äºé«˜å¹¶å‘ã€ä½å†…å­˜æ¶ˆè€—å’Œé«˜åº¦æ¨¡å—åŒ–çš„æ¶æ„ï¼Œå› æ­¤è¢«å¹¿æ³›ç”¨äºæ„å»ºæ€§èƒ½å‡ºè‰²çš„ç½‘ç«™ã€åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ã€‚\nä»¥ä¸‹æ˜¯ä¸€äº›å…³äº Nginx çš„å…³é”®ç‰¹ç‚¹ï¼š\né«˜æ€§èƒ½ï¼šNginx çš„è®¾è®¡ç›®æ ‡ä¹‹ä¸€æ˜¯åœ¨é«˜å¹¶å‘æƒ…å†µä¸‹æä¾›å“è¶Šçš„æ€§èƒ½ã€‚å®ƒä½¿ç”¨å¼‚æ­¥ã€äº‹ä»¶é©±åŠ¨çš„æ¶æ„æ¥å¤„ç†è¯·æ±‚ï¼Œæœ‰æ•ˆåœ°ç®¡ç†ç³»ç»Ÿèµ„æºï¼Œæä¾›å¿«é€Ÿå“åº”å’Œé«˜ååé‡ã€‚ é«˜åº¦å¯å®šåˆ¶åŒ–ï¼šNginx çš„æ¨¡å—åŒ–æ¶æ„ä½¿å…¶é«˜åº¦å¯å®šåˆ¶ã€‚å®ƒæ”¯æŒè®¸å¤šç¬¬ä¸‰æ–¹æ¨¡å—å’Œæ’ä»¶ï¼Œå¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚è¿›è¡Œæ‰©å±•å’Œå®šåˆ¶ã€‚è¿™ä½¿å¾—å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®è‡ªå·±çš„è¦æ±‚æ·»åŠ é¢å¤–çš„åŠŸèƒ½å’Œæ‰©å±• Nginx çš„èƒ½åŠ›ã€‚ è½»é‡çº§å’Œä½å†…å­˜æ¶ˆè€—ï¼šNginx æ˜¯ä¸€ä¸ªè½»é‡çº§çš„æœåŠ¡å™¨ï¼Œå…·æœ‰ä½å†…å­˜æ¶ˆè€—ã€‚è¿™ä½¿å¾—å®ƒèƒ½å¤Ÿåœ¨èµ„æºå—é™çš„ç¯å¢ƒä¸­é«˜æ•ˆè¿è¡Œï¼Œå¹¶å¤„ç†å¤§é‡çš„å¹¶å‘è¿æ¥ã€‚ ç®€å•çš„é…ç½®å’Œæ˜“äºä½¿ç”¨ï¼šNginx çš„é…ç½®æ–‡ä»¶é‡‡ç”¨ç®€å•çš„è¯­æ³•ï¼Œæ˜“äºç†è§£å’Œä¿®æ”¹ã€‚å®ƒæä¾›äº†æ¸…æ™°çš„æ–‡æ¡£å’Œä¸°å¯Œçš„ç¤ºä¾‹ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥å¿«é€Ÿä¸Šæ‰‹å¹¶è¿›è¡Œå¿…è¦çš„é…ç½®ã€‚ åŠŸèƒ½ï¼š\nåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡ï¼šNginx å¯ä»¥ä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨ï¼Œå°†å®¢æˆ·ç«¯è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨ã€‚å®ƒè¿˜æ”¯æŒè´Ÿè½½å‡è¡¡ï¼Œå¯ä»¥å°†æµé‡åˆ†é…åˆ°å¤šä¸ªåç«¯æœåŠ¡å™¨ï¼Œæé«˜ç³»ç»Ÿçš„å¯é æ€§å’Œæ€§èƒ½ã€‚ é™æ€æ–‡ä»¶æœåŠ¡ï¼šNginx å¯ä»¥å¿«é€Ÿã€å¯é åœ°æä¾›é™æ€æ–‡ä»¶ï¼Œå‡è½»åç«¯åº”ç”¨ç¨‹åºçš„è´Ÿæ‹…ã€‚å®ƒå¯ä»¥é€šè¿‡é«˜æ•ˆçš„æ–‡ä»¶ä¼ è¾“å’Œç¼“å­˜æœºåˆ¶æä¾›é™æ€å†…å®¹ï¼Œæé«˜ç½‘ç«™çš„å“åº”é€Ÿåº¦ã€‚ SSL/TLS åŠ å¯†ï¼šNginx æ”¯æŒ SSL/TLS åŠ å¯†ï¼Œå¯ä»¥å®‰å…¨åœ°ä¼ è¾“æ•°æ®ã€‚å®ƒæä¾›å¼ºå¤§çš„åŠ å¯†åŠŸèƒ½å’Œé…ç½®é€‰é¡¹ï¼Œä»¥ä¿æŠ¤ç½‘ç«™å’Œåº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ã€‚ åŠ¨æ€å†…å®¹æ”¯æŒï¼šå°½ç®¡ Nginx ä¸»è¦ç”¨äºå¤„ç†é™æ€å†…å®¹ï¼Œä½†å®ƒä¹Ÿå¯ä»¥ä¸åç«¯åº”ç”¨ç¨‹åºï¼ˆå¦‚ PHPã€Pythonã€Node.js ç­‰ï¼‰é›†æˆï¼Œä»¥å¤„ç†åŠ¨æ€ç”Ÿæˆçš„å†…å®¹ã€‚ HTTP/2 å’Œ HTTP/3 æ”¯æŒï¼šNginx æ”¯æŒæœ€æ–°çš„ HTTP/2 å’Œ HTTP/3 åè®®ï¼Œè¿™äº›åè®®æä¾›æ›´å¿«çš„æ•°æ®ä¼ è¾“å’Œæ›´ä½çš„å»¶è¿Ÿï¼Œæ”¹å–„ç”¨æˆ·ä½“éªŒã€‚ é«˜åº¦å¯æ‰©å±•ï¼šNginx çš„æ¨¡å—åŒ–æ¶æ„ä½¿å¾—å®ƒå¯ä»¥è½»æ¾åœ°æ‰©å±•å’Œå®šåˆ¶ã€‚å®ƒæ”¯æŒå„ç§ç¬¬ä¸‰æ–¹æ¨¡å—å’Œæ’ä»¶ï¼Œå¯ä»¥æ»¡è¶³ä¸åŒåœºæ™¯å’Œéœ€æ±‚çš„è¦æ±‚ã€‚ æ­£å‘ä»£ç†å’Œåå‘ä»£ç† æ­£å‘ä»£ç† æ­£å‘ä»£ç†ï¼ˆForward Proxyï¼‰æ˜¯ä¸€ç§ä»£ç†æœåŠ¡å™¨çš„ä½¿ç”¨æ–¹å¼ï¼Œå®ƒä»£è¡¨å®¢æˆ·ç«¯å‘å…¶ä»–æœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚å½“å®¢æˆ·ç«¯æƒ³è¦è®¿é—®äº’è”ç½‘ä¸Šçš„èµ„æºæ—¶ï¼Œå®ƒé¦–å…ˆå‘é€è¯·æ±‚åˆ°æ­£å‘ä»£ç†æœåŠ¡å™¨ï¼Œç„¶åç”±ä»£ç†æœåŠ¡å™¨ä»£è¡¨å®¢æˆ·ç«¯å‘ç›®æ ‡æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œè·å–å“åº”å¹¶å°†å…¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚\næ­£å‘ä»£ç†çš„å…¸å‹ç”¨é€”æ˜¯ä¸ºåœ¨é˜²ç«å¢™å†…çš„å±€åŸŸç½‘å®¢æˆ·ç«¯æä¾›è®¿é—®Internetçš„é€”å¾„ã€‚\næ­£å‘ä»£ç†ä¸€èˆ¬æ˜¯åœ¨å®¢æˆ·ç«¯è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼Œé€šè¿‡ä»£ç†æœåŠ¡å™¨è½¬å‘è¯·æ±‚ï¼Œæœ€ç»ˆè®¿é—®åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚\nä»¥ä¸‹æ˜¯æ­£å‘ä»£ç†çš„ä¸»è¦ç‰¹ç‚¹å’Œç”¨é€”ï¼š\néšè—å®¢æˆ·ç«¯èº«ä»½ï¼šæ­£å‘ä»£ç†å¯ä»¥éšè—å®¢æˆ·ç«¯çš„çœŸå®IPåœ°å€å’Œèº«ä»½ï¼Œä¿æŠ¤å®¢æˆ·ç«¯çš„éšç§å’Œå®‰å…¨ã€‚ç›®æ ‡æœåŠ¡å™¨åªèƒ½çœ‹åˆ°æ­£å‘ä»£ç†æœåŠ¡å™¨çš„IPåœ°å€å’Œè¯·æ±‚ï¼Œæ— æ³•ç›´æ¥è¯†åˆ«å’Œè¿½è¸ªå®¢æˆ·ç«¯ã€‚ è®¿é—®æ§åˆ¶å’Œè¿‡æ»¤ï¼šæ­£å‘ä»£ç†å¯ä»¥å®æ–½è®¿é—®æ§åˆ¶å’Œè¿‡æ»¤ç­–ç•¥ï¼Œé™åˆ¶å®¢æˆ·ç«¯å¯¹ç‰¹å®šèµ„æºçš„è®¿é—®ã€‚å®ƒå¯ä»¥ç”¨äºå®æ–½è®¿é—®æƒé™ã€URLè¿‡æ»¤ã€å†…å®¹è¿‡æ»¤ç­‰ï¼Œä»¥ä¾¿æ§åˆ¶å’Œç®¡ç†å®¢æˆ·ç«¯å¯¹äº’è”ç½‘èµ„æºçš„è®¿é—®ã€‚ ç¼“å­˜å’ŒåŠ é€Ÿï¼šæ­£å‘ä»£ç†æœåŠ¡å™¨å¯ä»¥ç¼“å­˜ç»å¸¸è¯·æ±‚çš„èµ„æºï¼Œä»¥æé«˜è®¿é—®é€Ÿåº¦å¹¶å‡è½»ç›®æ ‡æœåŠ¡å™¨çš„è´Ÿè½½ã€‚å½“å¤šä¸ªå®¢æˆ·ç«¯è¯·æ±‚ç›¸åŒçš„èµ„æºæ—¶ï¼Œä»£ç†æœåŠ¡å™¨å¯ä»¥ç›´æ¥æä¾›ç¼“å­˜çš„å‰¯æœ¬ï¼Œè€Œæ— éœ€æ¯æ¬¡éƒ½å‘ç›®æ ‡æœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚ å¯¹æŠ—è®¿é—®é™åˆ¶ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯å¯èƒ½æ— æ³•ç›´æ¥è®¿é—®æŸäº›èµ„æºï¼Œä¾‹å¦‚ç”±äºåœ°ç†ä½ç½®é™åˆ¶æˆ–ç½‘ç»œé˜²ç«å¢™çš„é˜»å¡ã€‚é€šè¿‡ä½¿ç”¨æ­£å‘ä»£ç†ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ä»£ç†æœåŠ¡å™¨æ¥è®¿é—®è¢«é™åˆ¶çš„èµ„æºï¼Œä»£ç†æœåŠ¡å™¨å……å½“ä¸­é—´äººæ¥è·å–èµ„æºå¹¶ä¼ é€’ç»™å®¢æˆ·ç«¯ã€‚ åŒ¿åä¸Šç½‘ï¼šæ­£å‘ä»£ç†å¯ä»¥ä¸ºç”¨æˆ·æä¾›åŒ¿åä¸Šç½‘çš„åŠŸèƒ½ï¼Œéšè—ç”¨æˆ·çš„çœŸå®èº«ä»½å’Œä½ç½®ä¿¡æ¯ã€‚è¿™å¯¹äºä¿æŠ¤ç”¨æˆ·éšç§ã€ç»•è¿‡åœ°åŸŸé™åˆ¶å’Œè®¿é—®å—é™èµ„æºç­‰æƒ…å†µéå¸¸æœ‰ç”¨ã€‚ æ€»è€Œè¨€ä¹‹ï¼Œæ­£å‘ä»£ç†å……å½“å®¢æˆ·ç«¯å’Œç›®æ ‡æœåŠ¡å™¨ä¹‹é—´çš„ä¸­é—´äººï¼Œä»£è¡¨å®¢æˆ·ç«¯å‘é€è¯·æ±‚å¹¶è·å–å“åº”ã€‚å®ƒå¯ä»¥éšè—å®¢æˆ·ç«¯èº«ä»½ã€å®æ–½è®¿é—®æ§åˆ¶ã€æä¾›ç¼“å­˜å’ŒåŠ é€Ÿç­‰åŠŸèƒ½ï¼Œä¸ºç”¨æˆ·æä¾›æ›´å®‰å…¨å’Œæ›´çµæ´»çš„è®¿é—®äº’è”ç½‘çš„æ–¹å¼ã€‚\nåå‘ä»£ç† åå‘ä»£ç†ï¼ˆReverse Proxyï¼‰æœåŠ¡å™¨ä½äºç”¨æˆ·ä¸ç›®æ ‡æœåŠ¡å™¨ä¹‹é—´ï¼Œä½†æ˜¯å¯¹äºç”¨æˆ·è€Œè¨€ï¼Œåå‘ä»£ç†æœåŠ¡å™¨å°±ç›¸å½“äºç›®æ ‡æœåŠ¡å™¨ï¼Œå³ç”¨æˆ·ç›´æ¥è®¿é—®åå‘ä»£ç†æœåŠ¡å™¨å°±å¯ä»¥è·å¾—ç›®æ ‡æœåŠ¡å™¨çš„èµ„æºï¼Œåå‘ä»£ç†æœåŠ¡å™¨è´Ÿè´£å°†è¯·æ±‚è½¬å‘ç»™ç›®æ ‡æœåŠ¡å™¨ã€‚ç”¨æˆ·ä¸éœ€è¦çŸ¥é“ç›®æ ‡æœåŠ¡å™¨çš„åœ°å€ï¼Œä¹Ÿæ— é¡»åœ¨ç”¨æˆ·ç«¯ä½œä»»ä½•è®¾å®šï¼Œå¯¹äºç”¨æˆ·æ¥è¯´ï¼Œè®¿é—®åå‘ä»£ç†æœåŠ¡å™¨æ˜¯å®Œå…¨æ— æ„ŸçŸ¥çš„ã€‚\nä»¥ä¸‹æ˜¯åå‘ä»£ç†çš„ä¸»è¦ç‰¹ç‚¹å’Œç”¨é€”ï¼š\nè´Ÿè½½å‡è¡¡ï¼šåå‘ä»£ç†å¯ä»¥ä½œä¸ºè´Ÿè½½å‡è¡¡å™¨ï¼Œå°†å®¢æˆ·ç«¯è¯·æ±‚åˆ†å‘ç»™å¤šä¸ªåç«¯æœåŠ¡å™¨ï¼Œä»¥å®ç°è´Ÿè½½å‡è¡¡ã€‚å®ƒå¯ä»¥æ ¹æ®æœåŠ¡å™¨çš„è´Ÿè½½æƒ…å†µã€å“åº”æ—¶é—´ç­‰æŒ‡æ ‡åŠ¨æ€åœ°å†³å®šå°†è¯·æ±‚å‘é€åˆ°å“ªä¸ªåç«¯æœåŠ¡å™¨ï¼Œä»¥ç¡®ä¿è¯·æ±‚è¢«åˆç†åœ°åˆ†æ•£å¤„ç†ã€‚ é«˜å¯ç”¨æ€§å’Œæ•…éšœæ¢å¤ï¼šé€šè¿‡åå‘ä»£ç†ï¼Œå¯ä»¥é…ç½®å¤šä¸ªåç«¯æœåŠ¡å™¨ä½œä¸ºå†—ä½™çš„å¤‡ä»½ã€‚å¦‚æœæŸä¸ªåç«¯æœåŠ¡å™¨å‡ºç°æ•…éšœæˆ–ä¸å¯ç”¨ï¼Œåå‘ä»£ç†å¯ä»¥è‡ªåŠ¨å°†è¯·æ±‚è½¬å‘åˆ°å…¶ä»–æ­£å¸¸å·¥ä½œçš„åç«¯æœåŠ¡å™¨ï¼Œä»¥ç¡®ä¿æœåŠ¡çš„å¯ç”¨æ€§ã€‚ SSL åŠ å¯†å’Œå®‰å…¨æ€§ï¼šåå‘ä»£ç†å¯ä»¥ä¸å®¢æˆ·ç«¯ä¹‹é—´å»ºç«‹å®‰å…¨çš„ SSL/TLS è¿æ¥ï¼Œæä¾›åŠ å¯†å’Œèº«ä»½éªŒè¯åŠŸèƒ½ã€‚è¿™æ ·å¯ä»¥ä¿æŠ¤å®¢æˆ·ç«¯ä¸åå‘ä»£ç†ä¹‹é—´çš„é€šä¿¡ï¼Œå¢å¼ºæ•°æ®çš„å®‰å…¨æ€§ã€‚ ç¼“å­˜å’ŒåŠ é€Ÿï¼šåå‘ä»£ç†å¯ä»¥ç¼“å­˜åç«¯æœåŠ¡å™¨è¿”å›çš„é™æ€èµ„æºï¼Œå¦‚å›¾ç‰‡ã€CSSã€JavaScript æ–‡ä»¶ç­‰ã€‚å½“å®¢æˆ·ç«¯è¯·æ±‚è¿™äº›èµ„æºæ—¶ï¼Œåå‘ä»£ç†å¯ä»¥ç›´æ¥æä¾›ç¼“å­˜çš„å‰¯æœ¬ï¼Œå‡è½»åç«¯æœåŠ¡å™¨çš„è´Ÿè½½å¹¶æé«˜å“åº”é€Ÿåº¦ã€‚ æä¾›ç»Ÿä¸€å…¥å£ï¼šåå‘ä»£ç†å¯ä»¥å°†å¤šä¸ªåç«¯æœåŠ¡å™¨æä¾›çš„ä¸åŒæœåŠ¡ï¼ˆå¦‚Webåº”ç”¨ã€APIæœåŠ¡ç­‰ï¼‰é€šè¿‡ç»Ÿä¸€çš„å…¥å£ç‚¹è¿›è¡Œè®¿é—®ã€‚è¿™æ ·å®¢æˆ·ç«¯åªéœ€ä¸åå‘ä»£ç†é€šä¿¡ï¼Œå¹¶ç”±åå‘ä»£ç†æ ¹æ®è¯·æ±‚çš„è·¯å¾„å°†å…¶è½¬å‘åˆ°é€‚å½“çš„åç«¯æœåŠ¡å™¨ã€‚ æ€»ç»“èµ·æ¥ï¼Œåå‘ä»£ç†å……å½“äº†å®¢æˆ·ç«¯å’Œåç«¯æœåŠ¡å™¨ä¹‹é—´çš„ä¸­é—´äººï¼Œè´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚å¹¶å°†å…¶è½¬å‘ç»™åç«¯æœåŠ¡å™¨ã€‚å®ƒå¯ä»¥å®ç°è´Ÿè½½å‡è¡¡ã€æä¾›é«˜å¯ç”¨æ€§ã€å¢åŠ å®‰å…¨æ€§ã€ç¼“å­˜å’ŒåŠ é€Ÿç­‰åŠŸèƒ½ï¼Œä¸ºå®¢æˆ·ç«¯æä¾›æ›´é«˜æ•ˆã€å®‰å…¨å’Œå¯é çš„è®¿é—®ä½“éªŒã€‚\næ€»ç»“ æ­£å‘ä»£ç†ï¼šå®¢æˆ·ç«¯è¯·æ±‚ç›®æ ‡æœåŠ¡å™¨ï¼Œè¯·æ±‚ä¼šå…ˆç»è¿‡ä»£ç†æœåŠ¡å™¨ï¼Œç„¶åå†è½¬å‘è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œè·å¾—å†…å®¹åæœ€åå†å“åº”ç»™å®¢æˆ·ç«¯ã€‚ åå‘ä»£ç†ï¼šç”¨æˆ·è¯·æ±‚ç›®æ ‡æœåŠ¡å™¨ï¼Œç”±ä»£ç†æœåŠ¡å™¨å†³å®šè®¿é—®å“ªä¸ª IPã€‚ è½¬å‘ä»£ç†æ˜¯ä½äºç”¨æˆ·è®¾å¤‡å’Œäº’è”ç½‘ä¹‹é—´çš„æœåŠ¡å™¨ã€‚\næ­£å‘ä»£ç†é€šå¸¸ç”¨äºï¼š\nä¿æŠ¤å®¢æˆ·ç«¯ é¿å…æµè§ˆé™åˆ¶ é˜»æ­¢è®¿é—®æŸäº›å†…å®¹ åå‘ä»£ç†æ˜¯ä¸€ç§æœåŠ¡å™¨ï¼Œå®ƒæ¥å—å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå°†è¯·æ±‚è½¬å‘åˆ° Web æœåŠ¡å™¨ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå°±å¥½åƒä»£ç†æœåŠ¡å™¨å·²ç»å¤„ç†äº†è¯·æ±‚ä¸€æ ·ã€‚\nåå‘ä»£ç†é€‚ç”¨äºï¼š\nä¿æŠ¤æœåŠ¡å™¨ è´Ÿè½½å‡è¡¡ ç¼“å­˜é™æ€å†…å®¹ åŠ å¯†å’Œè§£å¯† SSL é€šä¿¡ ","permalink":"https://blog.chensoul.cc/posts/2024/01/05/til/","summary":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\nNginxã€æ­£å‘ä»£ç†å’Œåå‘ä»£ç† Nginx ä»‹ç» Nginxï¼ˆå‘éŸ³ä¸º\u0026quot;engine-x\u0026quot;ï¼‰æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„å¼€æºWebæœåŠ¡å™¨å’Œåå‘ä»£ç†æœåŠ¡å™¨ã€‚å®ƒä¸“æ³¨äºé«˜å¹¶å‘ã€ä½å†…å­˜æ¶ˆè€—å’Œé«˜åº¦æ¨¡å—åŒ–çš„æ¶æ„ï¼Œå› æ­¤è¢«å¹¿æ³›ç”¨äºæ„å»ºæ€§èƒ½å‡ºè‰²çš„ç½‘ç«™ã€åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ã€‚\nä»¥ä¸‹æ˜¯ä¸€äº›å…³äº Nginx çš„å…³é”®ç‰¹ç‚¹ï¼š\né«˜æ€§èƒ½ï¼šNginx çš„è®¾è®¡ç›®æ ‡ä¹‹ä¸€æ˜¯åœ¨é«˜å¹¶å‘æƒ…å†µä¸‹æä¾›å“è¶Šçš„æ€§èƒ½ã€‚å®ƒä½¿ç”¨å¼‚æ­¥ã€äº‹ä»¶é©±åŠ¨çš„æ¶æ„æ¥å¤„ç†è¯·æ±‚ï¼Œæœ‰æ•ˆåœ°ç®¡ç†ç³»ç»Ÿèµ„æºï¼Œæä¾›å¿«é€Ÿå“åº”å’Œé«˜ååé‡ã€‚ é«˜åº¦å¯å®šåˆ¶åŒ–ï¼šNginx çš„æ¨¡å—åŒ–æ¶æ„ä½¿å…¶é«˜åº¦å¯å®šåˆ¶ã€‚å®ƒæ”¯æŒè®¸å¤šç¬¬ä¸‰æ–¹æ¨¡å—å’Œæ’ä»¶ï¼Œå¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚è¿›è¡Œæ‰©å±•å’Œå®šåˆ¶ã€‚è¿™ä½¿å¾—å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®è‡ªå·±çš„è¦æ±‚æ·»åŠ é¢å¤–çš„åŠŸèƒ½å’Œæ‰©å±• Nginx çš„èƒ½åŠ›ã€‚ è½»é‡çº§å’Œä½å†…å­˜æ¶ˆè€—ï¼šNginx æ˜¯ä¸€ä¸ªè½»é‡çº§çš„æœåŠ¡å™¨ï¼Œå…·æœ‰ä½å†…å­˜æ¶ˆè€—ã€‚è¿™ä½¿å¾—å®ƒèƒ½å¤Ÿåœ¨èµ„æºå—é™çš„ç¯å¢ƒä¸­é«˜æ•ˆè¿è¡Œï¼Œå¹¶å¤„ç†å¤§é‡çš„å¹¶å‘è¿æ¥ã€‚ ç®€å•çš„é…ç½®å’Œæ˜“äºä½¿ç”¨ï¼šNginx çš„é…ç½®æ–‡ä»¶é‡‡ç”¨ç®€å•çš„è¯­æ³•ï¼Œæ˜“äºç†è§£å’Œä¿®æ”¹ã€‚å®ƒæä¾›äº†æ¸…æ™°çš„æ–‡æ¡£å’Œä¸°å¯Œçš„ç¤ºä¾‹ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥å¿«é€Ÿä¸Šæ‰‹å¹¶è¿›è¡Œå¿…è¦çš„é…ç½®ã€‚ åŠŸèƒ½ï¼š\nåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡ï¼šNginx å¯ä»¥ä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨ï¼Œå°†å®¢æˆ·ç«¯è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨ã€‚å®ƒè¿˜æ”¯æŒè´Ÿè½½å‡è¡¡ï¼Œå¯ä»¥å°†æµé‡åˆ†é…åˆ°å¤šä¸ªåç«¯æœåŠ¡å™¨ï¼Œæé«˜ç³»ç»Ÿçš„å¯é æ€§å’Œæ€§èƒ½ã€‚ é™æ€æ–‡ä»¶æœåŠ¡ï¼šNginx å¯ä»¥å¿«é€Ÿã€å¯é åœ°æä¾›é™æ€æ–‡ä»¶ï¼Œå‡è½»åç«¯åº”ç”¨ç¨‹åºçš„è´Ÿæ‹…ã€‚å®ƒå¯ä»¥é€šè¿‡é«˜æ•ˆçš„æ–‡ä»¶ä¼ è¾“å’Œç¼“å­˜æœºåˆ¶æä¾›é™æ€å†…å®¹ï¼Œæé«˜ç½‘ç«™çš„å“åº”é€Ÿåº¦ã€‚ SSL/TLS åŠ å¯†ï¼šNginx æ”¯æŒ SSL/TLS åŠ å¯†ï¼Œå¯ä»¥å®‰å…¨åœ°ä¼ è¾“æ•°æ®ã€‚å®ƒæä¾›å¼ºå¤§çš„åŠ å¯†åŠŸèƒ½å’Œé…ç½®é€‰é¡¹ï¼Œä»¥ä¿æŠ¤ç½‘ç«™å’Œåº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ã€‚ åŠ¨æ€å†…å®¹æ”¯æŒï¼šå°½ç®¡ Nginx ä¸»è¦ç”¨äºå¤„ç†é™æ€å†…å®¹ï¼Œä½†å®ƒä¹Ÿå¯ä»¥ä¸åç«¯åº”ç”¨ç¨‹åºï¼ˆå¦‚ PHPã€Pythonã€Node.js ç­‰ï¼‰é›†æˆï¼Œä»¥å¤„ç†åŠ¨æ€ç”Ÿæˆçš„å†…å®¹ã€‚ HTTP/2 å’Œ HTTP/3 æ”¯æŒï¼šNginx æ”¯æŒæœ€æ–°çš„ HTTP/2 å’Œ HTTP/3 åè®®ï¼Œè¿™äº›åè®®æä¾›æ›´å¿«çš„æ•°æ®ä¼ è¾“å’Œæ›´ä½çš„å»¶è¿Ÿï¼Œæ”¹å–„ç”¨æˆ·ä½“éªŒã€‚ é«˜åº¦å¯æ‰©å±•ï¼šNginx çš„æ¨¡å—åŒ–æ¶æ„ä½¿å¾—å®ƒå¯ä»¥è½»æ¾åœ°æ‰©å±•å’Œå®šåˆ¶ã€‚å®ƒæ”¯æŒå„ç§ç¬¬ä¸‰æ–¹æ¨¡å—å’Œæ’ä»¶ï¼Œå¯ä»¥æ»¡è¶³ä¸åŒåœºæ™¯å’Œéœ€æ±‚çš„è¦æ±‚ã€‚ æ­£å‘ä»£ç†å’Œåå‘ä»£ç† æ­£å‘ä»£ç† æ­£å‘ä»£ç†ï¼ˆForward Proxyï¼‰æ˜¯ä¸€ç§ä»£ç†æœåŠ¡å™¨çš„ä½¿ç”¨æ–¹å¼ï¼Œå®ƒä»£è¡¨å®¢æˆ·ç«¯å‘å…¶ä»–æœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚å½“å®¢æˆ·ç«¯æƒ³è¦è®¿é—®äº’è”ç½‘ä¸Šçš„èµ„æºæ—¶ï¼Œå®ƒé¦–å…ˆå‘é€è¯·æ±‚åˆ°æ­£å‘ä»£ç†æœåŠ¡å™¨ï¼Œç„¶åç”±ä»£ç†æœåŠ¡å™¨ä»£è¡¨å®¢æˆ·ç«¯å‘ç›®æ ‡æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œè·å–å“åº”å¹¶å°†å…¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚\næ­£å‘ä»£ç†çš„å…¸å‹ç”¨é€”æ˜¯ä¸ºåœ¨é˜²ç«å¢™å†…çš„å±€åŸŸç½‘å®¢æˆ·ç«¯æä¾›è®¿é—®Internetçš„é€”å¾„ã€‚\næ­£å‘ä»£ç†ä¸€èˆ¬æ˜¯åœ¨å®¢æˆ·ç«¯è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼Œé€šè¿‡ä»£ç†æœåŠ¡å™¨è½¬å‘è¯·æ±‚ï¼Œæœ€ç»ˆè®¿é—®åˆ°ç›®æ ‡æœåŠ¡å™¨ã€‚\nä»¥ä¸‹æ˜¯æ­£å‘ä»£ç†çš„ä¸»è¦ç‰¹ç‚¹å’Œç”¨é€”ï¼š\néšè—å®¢æˆ·ç«¯èº«ä»½ï¼šæ­£å‘ä»£ç†å¯ä»¥éšè—å®¢æˆ·ç«¯çš„çœŸå®IPåœ°å€å’Œèº«ä»½ï¼Œä¿æŠ¤å®¢æˆ·ç«¯çš„éšç§å’Œå®‰å…¨ã€‚ç›®æ ‡æœåŠ¡å™¨åªèƒ½çœ‹åˆ°æ­£å‘ä»£ç†æœåŠ¡å™¨çš„IPåœ°å€å’Œè¯·æ±‚ï¼Œæ— æ³•ç›´æ¥è¯†åˆ«å’Œè¿½è¸ªå®¢æˆ·ç«¯ã€‚ è®¿é—®æ§åˆ¶å’Œè¿‡æ»¤ï¼šæ­£å‘ä»£ç†å¯ä»¥å®æ–½è®¿é—®æ§åˆ¶å’Œè¿‡æ»¤ç­–ç•¥ï¼Œé™åˆ¶å®¢æˆ·ç«¯å¯¹ç‰¹å®šèµ„æºçš„è®¿é—®ã€‚å®ƒå¯ä»¥ç”¨äºå®æ–½è®¿é—®æƒé™ã€URLè¿‡æ»¤ã€å†…å®¹è¿‡æ»¤ç­‰ï¼Œä»¥ä¾¿æ§åˆ¶å’Œç®¡ç†å®¢æˆ·ç«¯å¯¹äº’è”ç½‘èµ„æºçš„è®¿é—®ã€‚ ç¼“å­˜å’ŒåŠ é€Ÿï¼šæ­£å‘ä»£ç†æœåŠ¡å™¨å¯ä»¥ç¼“å­˜ç»å¸¸è¯·æ±‚çš„èµ„æºï¼Œä»¥æé«˜è®¿é—®é€Ÿåº¦å¹¶å‡è½»ç›®æ ‡æœåŠ¡å™¨çš„è´Ÿè½½ã€‚å½“å¤šä¸ªå®¢æˆ·ç«¯è¯·æ±‚ç›¸åŒçš„èµ„æºæ—¶ï¼Œä»£ç†æœåŠ¡å™¨å¯ä»¥ç›´æ¥æä¾›ç¼“å­˜çš„å‰¯æœ¬ï¼Œè€Œæ— éœ€æ¯æ¬¡éƒ½å‘ç›®æ ‡æœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚ å¯¹æŠ—è®¿é—®é™åˆ¶ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯å¯èƒ½æ— æ³•ç›´æ¥è®¿é—®æŸäº›èµ„æºï¼Œä¾‹å¦‚ç”±äºåœ°ç†ä½ç½®é™åˆ¶æˆ–ç½‘ç»œé˜²ç«å¢™çš„é˜»å¡ã€‚é€šè¿‡ä½¿ç”¨æ­£å‘ä»£ç†ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ä»£ç†æœåŠ¡å™¨æ¥è®¿é—®è¢«é™åˆ¶çš„èµ„æºï¼Œä»£ç†æœåŠ¡å™¨å……å½“ä¸­é—´äººæ¥è·å–èµ„æºå¹¶ä¼ é€’ç»™å®¢æˆ·ç«¯ã€‚ åŒ¿åä¸Šç½‘ï¼šæ­£å‘ä»£ç†å¯ä»¥ä¸ºç”¨æˆ·æä¾›åŒ¿åä¸Šç½‘çš„åŠŸèƒ½ï¼Œéšè—ç”¨æˆ·çš„çœŸå®èº«ä»½å’Œä½ç½®ä¿¡æ¯ã€‚è¿™å¯¹äºä¿æŠ¤ç”¨æˆ·éšç§ã€ç»•è¿‡åœ°åŸŸé™åˆ¶å’Œè®¿é—®å—é™èµ„æºç­‰æƒ…å†µéå¸¸æœ‰ç”¨ã€‚ æ€»è€Œè¨€ä¹‹ï¼Œæ­£å‘ä»£ç†å……å½“å®¢æˆ·ç«¯å’Œç›®æ ‡æœåŠ¡å™¨ä¹‹é—´çš„ä¸­é—´äººï¼Œä»£è¡¨å®¢æˆ·ç«¯å‘é€è¯·æ±‚å¹¶è·å–å“åº”ã€‚å®ƒå¯ä»¥éšè—å®¢æˆ·ç«¯èº«ä»½ã€å®æ–½è®¿é—®æ§åˆ¶ã€æä¾›ç¼“å­˜å’ŒåŠ é€Ÿç­‰åŠŸèƒ½ï¼Œä¸ºç”¨æˆ·æä¾›æ›´å®‰å…¨å’Œæ›´çµæ´»çš„è®¿é—®äº’è”ç½‘çš„æ–¹å¼ã€‚\nåå‘ä»£ç† åå‘ä»£ç†ï¼ˆReverse Proxyï¼‰æœåŠ¡å™¨ä½äºç”¨æˆ·ä¸ç›®æ ‡æœåŠ¡å™¨ä¹‹é—´ï¼Œä½†æ˜¯å¯¹äºç”¨æˆ·è€Œè¨€ï¼Œåå‘ä»£ç†æœåŠ¡å™¨å°±ç›¸å½“äºç›®æ ‡æœåŠ¡å™¨ï¼Œå³ç”¨æˆ·ç›´æ¥è®¿é—®åå‘ä»£ç†æœåŠ¡å™¨å°±å¯ä»¥è·å¾—ç›®æ ‡æœåŠ¡å™¨çš„èµ„æºï¼Œåå‘ä»£ç†æœåŠ¡å™¨è´Ÿè´£å°†è¯·æ±‚è½¬å‘ç»™ç›®æ ‡æœåŠ¡å™¨ã€‚ç”¨æˆ·ä¸éœ€è¦çŸ¥é“ç›®æ ‡æœåŠ¡å™¨çš„åœ°å€ï¼Œä¹Ÿæ— é¡»åœ¨ç”¨æˆ·ç«¯ä½œä»»ä½•è®¾å®šï¼Œå¯¹äºç”¨æˆ·æ¥è¯´ï¼Œè®¿é—®åå‘ä»£ç†æœåŠ¡å™¨æ˜¯å®Œå…¨æ— æ„ŸçŸ¥çš„ã€‚\nä»¥ä¸‹æ˜¯åå‘ä»£ç†çš„ä¸»è¦ç‰¹ç‚¹å’Œç”¨é€”ï¼š\nè´Ÿè½½å‡è¡¡ï¼šåå‘ä»£ç†å¯ä»¥ä½œä¸ºè´Ÿè½½å‡è¡¡å™¨ï¼Œå°†å®¢æˆ·ç«¯è¯·æ±‚åˆ†å‘ç»™å¤šä¸ªåç«¯æœåŠ¡å™¨ï¼Œä»¥å®ç°è´Ÿè½½å‡è¡¡ã€‚å®ƒå¯ä»¥æ ¹æ®æœåŠ¡å™¨çš„è´Ÿè½½æƒ…å†µã€å“åº”æ—¶é—´ç­‰æŒ‡æ ‡åŠ¨æ€åœ°å†³å®šå°†è¯·æ±‚å‘é€åˆ°å“ªä¸ªåç«¯æœåŠ¡å™¨ï¼Œä»¥ç¡®ä¿è¯·æ±‚è¢«åˆç†åœ°åˆ†æ•£å¤„ç†ã€‚ é«˜å¯ç”¨æ€§å’Œæ•…éšœæ¢å¤ï¼šé€šè¿‡åå‘ä»£ç†ï¼Œå¯ä»¥é…ç½®å¤šä¸ªåç«¯æœåŠ¡å™¨ä½œä¸ºå†—ä½™çš„å¤‡ä»½ã€‚å¦‚æœæŸä¸ªåç«¯æœåŠ¡å™¨å‡ºç°æ•…éšœæˆ–ä¸å¯ç”¨ï¼Œåå‘ä»£ç†å¯ä»¥è‡ªåŠ¨å°†è¯·æ±‚è½¬å‘åˆ°å…¶ä»–æ­£å¸¸å·¥ä½œçš„åç«¯æœåŠ¡å™¨ï¼Œä»¥ç¡®ä¿æœåŠ¡çš„å¯ç”¨æ€§ã€‚ SSL åŠ å¯†å’Œå®‰å…¨æ€§ï¼šåå‘ä»£ç†å¯ä»¥ä¸å®¢æˆ·ç«¯ä¹‹é—´å»ºç«‹å®‰å…¨çš„ SSL/TLS è¿æ¥ï¼Œæä¾›åŠ å¯†å’Œèº«ä»½éªŒè¯åŠŸèƒ½ã€‚è¿™æ ·å¯ä»¥ä¿æŠ¤å®¢æˆ·ç«¯ä¸åå‘ä»£ç†ä¹‹é—´çš„é€šä¿¡ï¼Œå¢å¼ºæ•°æ®çš„å®‰å…¨æ€§ã€‚ ç¼“å­˜å’ŒåŠ é€Ÿï¼šåå‘ä»£ç†å¯ä»¥ç¼“å­˜åç«¯æœåŠ¡å™¨è¿”å›çš„é™æ€èµ„æºï¼Œå¦‚å›¾ç‰‡ã€CSSã€JavaScript æ–‡ä»¶ç­‰ã€‚å½“å®¢æˆ·ç«¯è¯·æ±‚è¿™äº›èµ„æºæ—¶ï¼Œåå‘ä»£ç†å¯ä»¥ç›´æ¥æä¾›ç¼“å­˜çš„å‰¯æœ¬ï¼Œå‡è½»åç«¯æœåŠ¡å™¨çš„è´Ÿè½½å¹¶æé«˜å“åº”é€Ÿåº¦ã€‚ æä¾›ç»Ÿä¸€å…¥å£ï¼šåå‘ä»£ç†å¯ä»¥å°†å¤šä¸ªåç«¯æœåŠ¡å™¨æä¾›çš„ä¸åŒæœåŠ¡ï¼ˆå¦‚Webåº”ç”¨ã€APIæœåŠ¡ç­‰ï¼‰é€šè¿‡ç»Ÿä¸€çš„å…¥å£ç‚¹è¿›è¡Œè®¿é—®ã€‚è¿™æ ·å®¢æˆ·ç«¯åªéœ€ä¸åå‘ä»£ç†é€šä¿¡ï¼Œå¹¶ç”±åå‘ä»£ç†æ ¹æ®è¯·æ±‚çš„è·¯å¾„å°†å…¶è½¬å‘åˆ°é€‚å½“çš„åç«¯æœåŠ¡å™¨ã€‚ æ€»ç»“èµ·æ¥ï¼Œåå‘ä»£ç†å……å½“äº†å®¢æˆ·ç«¯å’Œåç«¯æœåŠ¡å™¨ä¹‹é—´çš„ä¸­é—´äººï¼Œè´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚å¹¶å°†å…¶è½¬å‘ç»™åç«¯æœåŠ¡å™¨ã€‚å®ƒå¯ä»¥å®ç°è´Ÿè½½å‡è¡¡ã€æä¾›é«˜å¯ç”¨æ€§ã€å¢åŠ å®‰å…¨æ€§ã€ç¼“å­˜å’ŒåŠ é€Ÿç­‰åŠŸèƒ½ï¼Œä¸ºå®¢æˆ·ç«¯æä¾›æ›´é«˜æ•ˆã€å®‰å…¨å’Œå¯é çš„è®¿é—®ä½“éªŒã€‚\næ€»ç»“ æ­£å‘ä»£ç†ï¼šå®¢æˆ·ç«¯è¯·æ±‚ç›®æ ‡æœåŠ¡å™¨ï¼Œè¯·æ±‚ä¼šå…ˆç»è¿‡ä»£ç†æœåŠ¡å™¨ï¼Œç„¶åå†è½¬å‘è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œè·å¾—å†…å®¹åæœ€åå†å“åº”ç»™å®¢æˆ·ç«¯ã€‚ åå‘ä»£ç†ï¼šç”¨æˆ·è¯·æ±‚ç›®æ ‡æœåŠ¡å™¨ï¼Œç”±ä»£ç†æœåŠ¡å™¨å†³å®šè®¿é—®å“ªä¸ª IPã€‚ è½¬å‘ä»£ç†æ˜¯ä½äºç”¨æˆ·è®¾å¤‡å’Œäº’è”ç½‘ä¹‹é—´çš„æœåŠ¡å™¨ã€‚\næ­£å‘ä»£ç†é€šå¸¸ç”¨äºï¼š\nä¿æŠ¤å®¢æˆ·ç«¯ é¿å…æµè§ˆé™åˆ¶ é˜»æ­¢è®¿é—®æŸäº›å†…å®¹ åå‘ä»£ç†æ˜¯ä¸€ç§æœåŠ¡å™¨ï¼Œå®ƒæ¥å—å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå°†è¯·æ±‚è½¬å‘åˆ° Web æœåŠ¡å™¨ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå°±å¥½åƒä»£ç†æœåŠ¡å™¨å·²ç»å¤„ç†äº†è¯·æ±‚ä¸€æ ·ã€‚\nåå‘ä»£ç†é€‚ç”¨äºï¼š\nä¿æŠ¤æœåŠ¡å™¨ è´Ÿè½½å‡è¡¡ ç¼“å­˜é™æ€å†…å®¹ åŠ å¯†å’Œè§£å¯† SSL é€šä¿¡ ","title":"2024-01-05ï½œNginxã€æ­£å‘ä»£ç†å’Œåå‘ä»£ç†"},{"content":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\nä¿®æ”¹ä¸ªäººè”ç³»æ–¹å¼ æ³¨é”€äºšé©¬é€Šè´¦å· åˆ©ç”¨GitHub Actionsè‡ªåŠ¨ä¼˜é›…åœ°ä¸ºé¡¹ç›®æ„å»ºReleases åˆ©ç”¨GitHub Actionsè‡ªåŠ¨æ„å»ºé¡¹ç›®çš„dockeré•œåƒå¹¶å‘å¸ƒåˆ°DockerHub ä¿®æ”¹ä¸ªäººè”ç³»æ–¹å¼ ä½¿ç”¨ ichensoul æ³¨å†Œäº†æ–°çš„ Gmailã€163 é‚®ç®±ï¼Œå¹¶å°†å„ç§ç½‘ç«™ç»‘å®šçš„é‚®ç®±ä¿®æ”¹åˆ°æ–°çš„ gmail é‚®ç®±ã€‚è‡ªæ­¤ï¼Œgmailã€githubã€æ¨ç‰¹ã€å¾®ä¿¡ã€163 çš„è´¦å·éƒ½ä¿æŒä¸ºä¸€è‡´ï¼Œéƒ½æ˜¯ ichensoulã€‚\nä»¥ä¸‹æ˜¯ github ä¸Šæˆ‘çš„ä¸ªäººè”ç³»æ–¹å¼ã€‚\nå¥åº·ï¼Œçˆ±æƒ…å’Œä½¿å‘½ï¼ŒæŒ‰ç…§è¿™ä¸ªé¡ºåºï¼Œå…¶å®ƒçš„éƒ½ä¸é‡è¦ã€‚ \u0026mdash;\u0026mdash; çº³ç“¦å°”\næˆ‘æ˜¯ ChenSoulï¼Œä¸€ä¸ª Java è½¯ä»¶å¼€å‘å·¥ç¨‹å¸ˆï¼Œç›®å‰å·¥ä½œåœ¨æ­¦æ±‰ã€‚\nçƒ­çˆ±ç¼–ç¨‹ï¼Œå–œæ¬¢è·‘æ­¥ã€‚è¯»ä¹¦ã€å¥èº«ã€å®šæŠ•ã€å¸®æœ‹å‹ã€é™ªå®¶äººï¼Œåšä¸€ä¸ªé•¿æœŸä¸»ä¹‰è€…ã€‚\nç½‘ç«™ åšå®¢ï¼šhttps://blog.chensoul.cc/ è·‘æ­¥ï¼šhttps://run.chensoul.cc/ Memosï¼šhttps://memos.chensoul.cc/ æ‰¾åˆ°æˆ‘ å¾®ä¿¡ï¼š@ichensoul é‚®ç®±ï¼šichensoul@gmail.com Githubï¼šhttps://github.com/chensoulã€https://github.com/ichensoul Twitterï¼šhttps://twitter.com/ichensoul Telegramé¢‘é“ï¼šhttps://t.me/chensoul_share æ³¨é”€äºšé©¬é€Šè´¦å· ç¼˜ç”±æ˜¯ï¼Œä¹‹å‰æ€»æ˜¯æ”¶åˆ°äºšé©¬é€Šçš„ä»˜æ¬¾è´¦å•ï¼ˆæ¯ä¸ªæœˆ 0.5 ç¾å…ƒï¼Œæœ‰æ—¶å€™1 ç¾å…ƒï¼‰ï¼Œæ•…å…ƒæ—¦æ”¾å‡çš„æ—¶å€™ç™»é™†äº†äºšé©¬é€Šè´¦å·æŸ¥æ‰¾ä»˜è´¹åŸå› ã€‚æ‰¾äº†åŠå¤©æ²¡æœ‰æ‰¾åˆ°æ˜¯å“ªé‡Œäº§ç”Ÿçš„è´¹ç”¨ï¼Œå°±ä¸€æ€’ä¹‹ä¸‹æŠŠåœ¨äºšé©¬é€Šæ³¨å†Œçš„åŸŸåï¼ˆchensoul.comï¼Œä¸€å¹´ 12 ç¾å…ƒï¼Œä¸€æ¬¡æ€§ä»˜è´¹äº† 5 å¹´ï¼‰åˆ é™¤äº†ã€‚\nè¿™å‡ å¤©å‘ç°æœ¬åšå®¢æ— æ³•è®¿é—®ï¼Œäºæ˜¯æå·¥å•è¯¢é—®æ˜¯å¦å¯ä»¥æ¢å¤åŸŸåã€‚å¾—åˆ°çš„å›å¤æ˜¯å¿…é¡»æ”¯ä»˜ 66 ç¾å…ƒï¼Œæ‰èƒ½æ¢å¤ä¸€å¹´ã€‚å¯¹æ­¤ï¼Œæˆ‘è‚¯å®šæ— æ³•æ¥å—ã€‚äºæ˜¯ï¼Œå†³å®šæ³¨é”€äºšé©¬é€Šï¼Œåœ¨å…¶ä»–å¹³å°é‡æ–°æ³¨å†Œä¸€ä¸ªåŸŸåã€‚\nä»Šå¤©åœ¨ CF ä¸Šæ³¨å†Œäº†ä¸€ä¸ªæ–°çš„åŸŸå chensoul.ccï¼Œä¸€å¹´ 8 ç¾å…ƒï¼Œä¸€æ¬¡æ€§ä»˜è´¹ 5 å¹´ã€‚åœ¨é‡æ–°è®¾ç½® DNSï¼Œä¿®æ”¹ VPS ä¸Šçš„ç›¸å…³æœåŠ¡çš„åŸŸåä¸ºæ–°åŸŸåä¹‹åï¼Œåšå®¢æ¢å¤æ­£å¸¸ã€‚\nåˆ©ç”¨GitHub Actionsè‡ªåŠ¨ä¼˜é›…åœ°ä¸ºé¡¹ç›®æ„å»ºReleases å‚è€ƒ åˆ©ç”¨GitHub Actionsè‡ªåŠ¨ä¼˜é›…åœ°ä¸ºé¡¹ç›®æ„å»ºReleases ä¸º github ä¸Šçš„é¡¹ç›® https://github.com/chensoul/chensoul-parent æ·»åŠ ä¸€ä¸ªæœºå™¨äººå­—æ®µæ„å»º Releaseã€‚\nä½¿ç”¨æ–¹æ³•ï¼š\n1ã€å‚è€ƒ å®˜æ–¹æ–‡æ¡£ï¼Œåœ¨ä»“åº“é‡Œé¢é…ç½®ä¸€ä¸ª GitHub Action ï¼Œä¾‹å¦‚ï¼š.github/workflows/release-drafter.yml\nname: Release Drafter on: push: # branches to consider in the event; optional, defaults to all branches: - main # pull_request event is required only for autolabeler pull_request: # Only following types are handled by the action, but one can default to all as well types: [opened, reopened, synchronize] # pull_request_target event is required for autolabeler to support PRs from forks # pull_request_target: # types: [opened, reopened, synchronize] permissions: contents: read jobs: update_release_draft: permissions: # write permission is required to create a github release contents: write # write permission is required for autolabeler # otherwise, read permission is required at least pull-requests: write runs-on: ubuntu-latest steps: # (Optional) GitHub Enterprise requires GHE_HOST variable set #- name: Set GHE_HOST # run: | # echo \u0026#34;GHE_HOST=${GITHUB_SERVER_URL##https:\\/\\/}\u0026#34; \u0026gt;\u0026gt; $GITHUB_ENV # Drafts your next Release notes as Pull Requests are merged into \u0026#34;master\u0026#34; - uses: release-drafter/release-drafter@v5 # (Optional) specify config name to use, relative to .github/. Default: release-drafter.yml # with: # config-name: my-config.yml # disable-autolabeler: true env: GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} è¯´æ˜ï¼š\nè¯¥ action åªå¯¹ main åˆ†æ”¯èµ·ä½œç”¨ è¯¥ action åªå¯¹ opened, reopened, synchronize ç±»å‹çš„ pull_request èµ·ä½œç”¨ 2ã€æ·»åŠ  .github/release-drafter.yml é…ç½®ç”Ÿæˆçš„ Release å†…å®¹\n# Configuration for Release Drafter: https://github.com/toolmantim/release-drafter name-template: \u0026#39;v$NEXT_PATCH_VERSION\u0026#39; tag-template: \u0026#39;v$NEXT_PATCH_VERSION\u0026#39; version-template: $MAJOR.$MINOR.$PATCH # Emoji reference: https://gitmoji.carloscuesta.me/ categories: - title: \u0026#39;â­ New Features\u0026#39; labels: - \u0026#39;feature\u0026#39; - \u0026#39;enhancement\u0026#39; - \u0026#39;kind/feature\u0026#39; - title: \u0026#39;ğŸ Bug Fixes\u0026#39; labels: - \u0026#39;fix\u0026#39; - \u0026#39;bugfix\u0026#39; - \u0026#39;bug\u0026#39; - \u0026#39;regression\u0026#39; - \u0026#39;kind/bug\u0026#39; - title: \u0026#39;ğŸ“ Documentation\u0026#39; labels: - documentation - \u0026#39;kind/doc\u0026#39; - title: \u0026#39;ğŸ§° Dependency Upgrades\u0026#39; labels: - chore - dependencies - \u0026#39;kind/chore\u0026#39; - \u0026#39;kind/dep\u0026#39; - title: \u0026#39;ğŸš¦ Tests\u0026#39; labels: - test - tests exclude-labels: - reverted - no-changelog - skip-changelog - invalid change-template: \u0026#39;* $TITLE (#$NUMBER) @$AUTHOR\u0026#39; template: | ## Whatâ€™s Changed $CHANGES æ¨¡æ¿çš„å«ä¹‰æ˜¯å½“æäº¤çš„ PR ç¬¦åˆå…¶ä¸­çš„ labels æ—¶ï¼Œå¯¹åº”æäº¤çš„æ ‡é¢˜ä¼šä½œä¸ºå½“æ¬¡æäº¤çš„è¯´æ˜ä¿¡æ¯ï¼Œç”Ÿæˆåœ¨ release çš„è‰ç¨¿ä¸­ã€‚\næœ‰äº†è¿™äº›å†…å®¹ï¼Œåœ¨æ¯æ¬¡ push æˆ–è€… pr çš„æ—¶å€™ï¼ŒActions éƒ½ä¼šè‡ªåŠ¨å°†å½“æ¬¡çš„å†…å®¹å†™å…¥åˆ° release çš„è‰ç¨¿ä¸­ï¼Œä¸‹æ¬¡å†æœ‰ pr åˆ™å†…å®¹å°†ä¼šæ˜¯è¿½åŠ ï¼Œå¹¶ä¸ä¼šè¦†ç›–ä¸€å¼€å§‹çš„è‰ç¨¿ã€‚\n3ã€é€šå¸¸æ™®é€šåä½œè€…åœ¨æäº¤ pr çš„æ—¶å€™ï¼Œå¤§æ¦‚éƒ½å¾ˆå°‘ä¼šæœ‰ä¸»åŠ¨ç»™ pr æ·»åŠ  labels çš„ï¼Œæ¯æ¬¡è¿˜éœ€è¦é¡¹ç›®è´Ÿè´£äººè‡ªå·±æ·»åŠ ï¼Œä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œè€Œè¿™ä¸ªåŠŸèƒ½åˆæ˜¯ä¾èµ– pr çš„ labels çš„ï¼Œå› æ­¤å¯ä»¥å†åŠ ä¸€ä¸ªé…ç½® .github/PULL_REQUEST_TEMPLATE.mdï¼Œè¯¥æ–‡ä»¶é…ç½®å¯ä»¥ä»“åº“ GitHub pull request templateã€‚\nspring-boot é¡¹ç›®ä¸­çš„ .github/PULL_REQUEST_TEMPLATE.md å†…å®¹å¦‚ä¸‹ï¼š\n\u0026lt;!-- Thanks for contributing to Spring Boot. Please review the following notes before submitting a pull request. Please submit only genuine pull-requests. Do not use this repository as a GitHub playground. Security Vulnerabilities STOP! If your contribution fixes a security vulnerability, please do not submit it. Instead, please head over to https://spring.io/security-policy to learn how to disclose a vulnerability responsibly. Dependency Upgrades Please do not open a pull request for a straightforward dependency upgrade (one that only updates the version property). We have a semi-automated process for such upgrades that we prefer to use. However, if the upgrade is more involved (such as requiring changes for removed or deprecated API) your pull request is most welcome. Describing Your Changes If, having reviewed the notes above, you\u0026#39;re ready to submit your pull request, please provide a brief description of the proposed changes. If they fix a bug, please describe the broken behaviour and how the changes fix it. If they make an enhancement, please describe the new functionality and why you believe it\u0026#39;s useful. If your pull request relates to any existing issues, please reference them by using the issue number prefixed with #. --\u0026gt; ç»¼åˆä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘çš„ .github/PULL_REQUEST_TEMPLATE.md å†…å®¹å¦‚ä¸‹ï¼š\n\u0026lt;!-- Thanks for contributing to this project. Please review the following notes before submitting a pull request. Please submit only genuine pull-requests. Do not use this repository as a GitHub playground. Dependency Upgrades Please do not open a pull request for a straightforward dependency upgrade (one that only updates the version property). We have a semi-automated process for such upgrades that we prefer to use. However, if the upgrade is more involved (such as requiring changes for removed or deprecated API) your pull request is most welcome. Describing Your Changes If, having reviewed the notes above, you\u0026#39;re ready to submit your pull request, please provide a brief description of the proposed changes. If they fix a bug, please describe the broken behaviour and how the changes fix it. If they make an enhancement, please describe the new functionality and why you believe it\u0026#39;s useful. If your pull request relates to any existing issues, please reference them by using the issue number prefixed with #. --\u0026gt; ## Describing Your Changes ## Checklist before requesting a review - [ ] I have performed a self-review of my code - [ ] If it is a core feature, I have added thorough tests. - [ ] Do we need to implement analytics? - [ ] Will this be part of a product update? If yes, please write one phrase about this update. è¿™æ ·åä½œè€…æäº¤ pr çš„æ—¶å€™å°±ä¼šä¸»åŠ¨æç¤ºåä½œè€…å°½é‡ç»™å½“æ¬¡ pr æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªåˆé€‚çš„ labelsã€‚\næœ€åæ¥çœ‹ä¸‹ç”Ÿæˆçš„ release drafterï¼š\nåˆ©ç”¨GitHub Actionsè‡ªåŠ¨æ„å»ºé¡¹ç›®çš„dockeré•œåƒå¹¶å‘å¸ƒåˆ°DockerHub å‚è€ƒ åˆ©ç”¨GitHub Actionsè‡ªåŠ¨æ„å»ºé¡¹ç›®çš„dockeré•œåƒå¹¶å‘å¸ƒåˆ°DockerHub ï¼Œç»™ https://github.com/chensoul/maven-hello-world æ·»åŠ äº†ä¸€ä¸ª docker actionï¼š .github/workflows/docker-image.yml name: build_docker on: release: types: [created] # è¡¨ç¤ºåœ¨åˆ›å»ºæ­£å¼çš„ Release æ—¶è§¦å‘ jobs: build_docker: name: Build docker runs-on: ubuntu-latest steps: - name: Checkout uses: actions/checkout@v3 # åˆ©ç”¨github-slug-actionæš´æ¼Github Actionä¸Šä¸‹æ–‡ä¸­çš„å…³é”®å˜é‡ https://wiki.eryajf.net/pages/77e2fe - name: Inject slug/short variables uses: rlespinasse/github-slug-action@v4 - name: Set up QEMU uses: docker/setup-qemu-action@v2 - name: Set up Docker Buildx uses: docker/setup-buildx-action@v2 - name: Login to DockerHub uses: docker/login-action@v2 with: username: ${{ secrets.DOCKERHUB_USERNAME }} password: ${{ secrets.DOCKERHUB_TOKEN }} - name: Build And Push uses: docker/build-push-action@v3 with: context: . platforms: linux/amd64,linux/arm64 push: ${{ github.event_name != \u0026#39;pull_request\u0026#39; }} tags: | ${{ secrets.DOCKERHUB_USERNAME }}/${{ env.GITHUB_REPOSITORY_NAME_PART }}:${{ env.GITHUB_REF_NAME }} ${{ secrets.DOCKERHUB_USERNAME }}/${{ env.GITHUB_REPOSITORY_NAME_PART }}:latest å…³é”®ç‚¹ï¼šä½¿ç”¨ rlespinasse/github-slug-action@v4 æš´æ¼Github Actionä¸Šä¸‹æ–‡ä¸­çš„å…³é”®å˜é‡ã€‚è¯·å‚è€ƒï¼šåˆ©ç”¨github-slug-actionæš´æ¼Github Actionä¸Šä¸‹æ–‡ä¸­çš„å…³é”®å˜é‡ ã€‚\nWakatime ç¼–ç ç»Ÿè®¡ Wakatimeè®°å½•çš„ä»Šæ—¥ç¼–ç æ—¶é—´ç»Ÿè®¡ï¼š\nå‚è€ƒæ–‡ç«  åˆ©ç”¨GitHub Actionsè‡ªåŠ¨ä¼˜é›…åœ°ä¸ºé¡¹ç›®æ„å»ºReleases åˆ©ç”¨GitHub Actionsè‡ªåŠ¨æ„å»ºé¡¹ç›®çš„dockeré•œåƒå¹¶å‘å¸ƒåˆ°DockerHub åˆ©ç”¨github-slug-actionæš´æ¼Github Actionä¸Šä¸‹æ–‡ä¸­çš„å…³é”®å˜é‡ ","permalink":"https://blog.chensoul.cc/posts/2024/01/04/til/","summary":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\nä¿®æ”¹ä¸ªäººè”ç³»æ–¹å¼ æ³¨é”€äºšé©¬é€Šè´¦å· åˆ©ç”¨GitHub Actionsè‡ªåŠ¨ä¼˜é›…åœ°ä¸ºé¡¹ç›®æ„å»ºReleases åˆ©ç”¨GitHub Actionsè‡ªåŠ¨æ„å»ºé¡¹ç›®çš„dockeré•œåƒå¹¶å‘å¸ƒåˆ°DockerHub ä¿®æ”¹ä¸ªäººè”ç³»æ–¹å¼ ä½¿ç”¨ ichensoul æ³¨å†Œäº†æ–°çš„ Gmailã€163 é‚®ç®±ï¼Œå¹¶å°†å„ç§ç½‘ç«™ç»‘å®šçš„é‚®ç®±ä¿®æ”¹åˆ°æ–°çš„ gmail é‚®ç®±ã€‚è‡ªæ­¤ï¼Œgmailã€githubã€æ¨ç‰¹ã€å¾®ä¿¡ã€163 çš„è´¦å·éƒ½ä¿æŒä¸ºä¸€è‡´ï¼Œéƒ½æ˜¯ ichensoulã€‚\nä»¥ä¸‹æ˜¯ github ä¸Šæˆ‘çš„ä¸ªäººè”ç³»æ–¹å¼ã€‚\nå¥åº·ï¼Œçˆ±æƒ…å’Œä½¿å‘½ï¼ŒæŒ‰ç…§è¿™ä¸ªé¡ºåºï¼Œå…¶å®ƒçš„éƒ½ä¸é‡è¦ã€‚ \u0026mdash;\u0026mdash; çº³ç“¦å°”\næˆ‘æ˜¯ ChenSoulï¼Œä¸€ä¸ª Java è½¯ä»¶å¼€å‘å·¥ç¨‹å¸ˆï¼Œç›®å‰å·¥ä½œåœ¨æ­¦æ±‰ã€‚\nçƒ­çˆ±ç¼–ç¨‹ï¼Œå–œæ¬¢è·‘æ­¥ã€‚è¯»ä¹¦ã€å¥èº«ã€å®šæŠ•ã€å¸®æœ‹å‹ã€é™ªå®¶äººï¼Œåšä¸€ä¸ªé•¿æœŸä¸»ä¹‰è€…ã€‚\nç½‘ç«™ åšå®¢ï¼šhttps://blog.chensoul.cc/ è·‘æ­¥ï¼šhttps://run.chensoul.cc/ Memosï¼šhttps://memos.chensoul.cc/ æ‰¾åˆ°æˆ‘ å¾®ä¿¡ï¼š@ichensoul é‚®ç®±ï¼šichensoul@gmail.com Githubï¼šhttps://github.com/chensoulã€https://github.com/ichensoul Twitterï¼šhttps://twitter.com/ichensoul Telegramé¢‘é“ï¼šhttps://t.me/chensoul_share æ³¨é”€äºšé©¬é€Šè´¦å· ç¼˜ç”±æ˜¯ï¼Œä¹‹å‰æ€»æ˜¯æ”¶åˆ°äºšé©¬é€Šçš„ä»˜æ¬¾è´¦å•ï¼ˆæ¯ä¸ªæœˆ 0.5 ç¾å…ƒï¼Œæœ‰æ—¶å€™1 ç¾å…ƒï¼‰ï¼Œæ•…å…ƒæ—¦æ”¾å‡çš„æ—¶å€™ç™»é™†äº†äºšé©¬é€Šè´¦å·æŸ¥æ‰¾ä»˜è´¹åŸå› ã€‚æ‰¾äº†åŠå¤©æ²¡æœ‰æ‰¾åˆ°æ˜¯å“ªé‡Œäº§ç”Ÿçš„è´¹ç”¨ï¼Œå°±ä¸€æ€’ä¹‹ä¸‹æŠŠåœ¨äºšé©¬é€Šæ³¨å†Œçš„åŸŸåï¼ˆchensoul.comï¼Œä¸€å¹´ 12 ç¾å…ƒï¼Œä¸€æ¬¡æ€§ä»˜è´¹äº† 5 å¹´ï¼‰åˆ é™¤äº†ã€‚\nè¿™å‡ å¤©å‘ç°æœ¬åšå®¢æ— æ³•è®¿é—®ï¼Œäºæ˜¯æå·¥å•è¯¢é—®æ˜¯å¦å¯ä»¥æ¢å¤åŸŸåã€‚å¾—åˆ°çš„å›å¤æ˜¯å¿…é¡»æ”¯ä»˜ 66 ç¾å…ƒï¼Œæ‰èƒ½æ¢å¤ä¸€å¹´ã€‚å¯¹æ­¤ï¼Œæˆ‘è‚¯å®šæ— æ³•æ¥å—ã€‚äºæ˜¯ï¼Œå†³å®šæ³¨é”€äºšé©¬é€Šï¼Œåœ¨å…¶ä»–å¹³å°é‡æ–°æ³¨å†Œä¸€ä¸ªåŸŸåã€‚\nä»Šå¤©åœ¨ CF ä¸Šæ³¨å†Œäº†ä¸€ä¸ªæ–°çš„åŸŸå chensoul.ccï¼Œä¸€å¹´ 8 ç¾å…ƒï¼Œä¸€æ¬¡æ€§ä»˜è´¹ 5 å¹´ã€‚åœ¨é‡æ–°è®¾ç½® DNSï¼Œä¿®æ”¹ VPS ä¸Šçš„ç›¸å…³æœåŠ¡çš„åŸŸåä¸ºæ–°åŸŸåä¹‹åï¼Œåšå®¢æ¢å¤æ­£å¸¸ã€‚\nåˆ©ç”¨GitHub Actionsè‡ªåŠ¨ä¼˜é›…åœ°ä¸ºé¡¹ç›®æ„å»ºReleases å‚è€ƒ åˆ©ç”¨GitHub Actionsè‡ªåŠ¨ä¼˜é›…åœ°ä¸ºé¡¹ç›®æ„å»ºReleases ä¸º github ä¸Šçš„é¡¹ç›® https://github.com/chensoul/chensoul-parent æ·»åŠ ä¸€ä¸ªæœºå™¨äººå­—æ®µæ„å»º Releaseã€‚\nä½¿ç”¨æ–¹æ³•ï¼š\n1ã€å‚è€ƒ å®˜æ–¹æ–‡æ¡£ï¼Œåœ¨ä»“åº“é‡Œé¢é…ç½®ä¸€ä¸ª GitHub Action ï¼Œä¾‹å¦‚ï¼š.github/workflows/release-drafter.yml\nname: Release Drafter on: push: # branches to consider in the event; optional, defaults to all branches: - main # pull_request event is required only for autolabeler pull_request: # Only following types are handled by the action, but one can default to all as well types: [opened, reopened, synchronize] # pull_request_target event is required for autolabeler to support PRs from forks # pull_request_target: # types: [opened, reopened, synchronize] permissions: contents: read jobs: update_release_draft: permissions: # write permission is required to create a github release contents: write # write permission is required for autolabeler # otherwise, read permission is required at least pull-requests: write runs-on: ubuntu-latest steps: # (Optional) GitHub Enterprise requires GHE_HOST variable set #- name: Set GHE_HOST # run: | # echo \u0026#34;GHE_HOST=${GITHUB_SERVER_URL##https:\\/\\/}\u0026#34; \u0026gt;\u0026gt; $GITHUB_ENV # Drafts your next Release notes as Pull Requests are merged into \u0026#34;master\u0026#34; - uses: release-drafter/release-drafter@v5 # (Optional) specify config name to use, relative to .","title":"2024-01-04ï½œGitHub Actions"},{"content":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\nidworker-client ï¼Œä¸€ä¸ªå¼€æºçš„ ID ç”Ÿæˆå™¨ï¼Œé€‚åˆåœ¨å•æœºä½¿ç”¨ github ä¸Šåˆ›å»ºäº†ä¸€ä¸ªä½¿ç”¨ spring cloud netflix ç›¸å…³ç»„ä»¶çš„å¾®æœåŠ¡é¡¹ç›® spring-cloud-examples é‡æ„äº†ç‹‚é‡æ¶æ„å¸ˆè¯¾ç¨‹ä¸­çš„å¾®æœåŠ¡ç‰ˆæœ¬çš„æºç  foodie-cloud é‡æ„æ…•è¯¾ç½‘ Javaæ¶æ„å¸ˆ-æŠ€æœ¯ä¸“å®¶ è¯¾ç¨‹ä¸­çš„ æºç ï¼Œæˆ‘åšäº†ä¸€äº›æ”¹åŠ¨ï¼š\nå‡çº§ Spring Boot å’Œ Spring Cloud ç‰ˆæœ¬ å»æ‰ tk-mybatis æ”¹ä¸ºä½¿ç”¨ mybatis-plus é‡æ„æ¨¡å—å’Œéƒ¨åˆ†ä»£ç  é‡æ„åçš„æºç åœ°å€ï¼šhttps://github.com/chensoul/foodie-cloud\nåç»­è®¡åˆ’ï¼š\ndocker å®¹å™¨ç¼–æ’ k8s å®¹å™¨ç¼–æ’ é›†æˆ Spring Security OAuth2 é›†æˆ Spring Cloud alibaba å¼€å‘ç¯å¢ƒå’Œå¼€æºé¡¹ç›®ç‰ˆæœ¬ è½¯ä»¶ç‰ˆæœ¬ï¼š\nç»„ä»¶ ç”¨é€” ç‰ˆæœ¬å· Redis ç¼“å­˜ç»„ä»¶ 5.0.4 RabbitMQ æ¶ˆæ¯ä¸­é—´ä»¶ 3.7.15 Kafka æ¶ˆæ¯ä¸­é—´ä»¶ 2.2.0 Lua é™æµè„šæœ¬ 5.3.5 MySQL æ•°æ®åº“ 5.7 IDEA å¼€å‘ç¯å¢ƒ ç‰ˆæœ¬éšæ„ Java ç¼–è¯‘è¿è¡Œé¡¹ç›® 1.8ä»¥ä¸Šï¼ˆæ¨è8u161ä»¥åçš„ç‰ˆæœ¬ï¼Œå¦åˆ™è¦è£…JCEæ’ä»¶ï¼‰ Maven ä¾èµ–ç®¡ç† 3.0.4ä»¥ä¸Š Maven ä¾èµ–ç‰ˆæœ¬ï¼š\nç»„ä»¶ ç‰ˆæœ¬å· Spring Cloud 2021.0.9 Spring Boot 2.7.18 Mybatis Plus 3.5.5 æŠ€æœ¯é€‰å‹ Spring Cloudæ¯ä¸ªä¸šåŠ¡é¢†åŸŸéƒ½æœ‰å¤šä¸ªå¯ä¾›é€‰æ‹©çš„ç»„ä»¶ï¼Œè¿™é‡Œä¹Ÿåˆ—å‡ºäº†å¾®æœåŠ¡ç« èŠ‚ä¸­å°†è¦ç”¨åˆ°çš„ç»„ä»¶+ä¸­é—´ä»¶çš„æŠ€æœ¯é€‰å‹ï¼Œè¿™ä¹Ÿæ˜¯å½“å‰ä¸»æµçš„é€‰å‹ã€‚\nå†…å®¹ æŠ€æœ¯é€‰å‹ æœåŠ¡æ²»ç† Eureka è´Ÿè½½å‡è¡¡ Ribbon æœåŠ¡é—´è°ƒç”¨ Feign æœåŠ¡å®¹é”™ Hystrix + Turbine + Dashboard é…ç½®ç®¡ç† Config + Github æ¶ˆæ¯æ€»çº¿ Bus + RabbitMQ æœåŠ¡ç½‘å…³ Gateway è°ƒç”¨é“¾è¿½è¸ª Sleuth + Zipkin + ELK æ¶ˆæ¯é©±åŠ¨ Stream + RabbitMQ æµæ§ Sentinel åŸºäºRPCçš„æœåŠ¡æ²»ç†ï¼ˆä¸é›†æˆåˆ°ç”µå•†é¡¹ç›®ï¼‰ Dubbo + Admin Portal é»˜è®¤ç«¯å£ å†…å®¹ ç«¯å£ Eureka 20000 Turbine 20001 Hystrix-Dashboard 20002 Config-Server 20003 Gateway 20004 Zipkin 9411 ELKé•œåƒ-ES 9200 ELKé•œåƒ-Logstash 5044 ELKé•œåƒ-Kibana 5601 redisï¼ˆå•æœºæ¨¡å¼ï¼‰ 6379 rabbitmqï¼ˆå•æœºæ¨¡å¼ï¼‰ 5672 mariadb/mysqlï¼ˆå•æœºæ¨¡å¼ï¼‰ 3306 å•†å“å¾®æœåŠ¡ 10001 ç”¨æˆ·å¾®æœåŠ¡ 10002 è®¢å•å¾®æœåŠ¡ 10003 è´­ç‰©è½¦å¾®æœåŠ¡ 10004 æƒé™å¾®æœåŠ¡ 10006 ä¸»æœå¾®æœåŠ¡ åŒå­¦ä»¬è‡ªå·±å®ç° æ”¯ä»˜æœåŠ¡ æ²¡å˜ï¼Œä½†å›è°ƒåœ°å€è¦æ”¹ä¸€ä¸‹ å¯åŠ¨æ–¹å¼ å¯ä»¥åœ¨IDEAé‡Œå¯åŠ¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Mavenç¼–è¯‘ååœ¨å‘½ä»¤è¡Œçª—å£å¯åŠ¨ï¼Œå‘½ä»¤è¡Œå¯åŠ¨æ–¹å¼éœ€è¦åœ¨mavenç¼–è¯‘å¥½é¡¹ç›®ä¹‹åï¼Œcdåˆ°å¯¹åº”é¡¹ç›®ä¸‹çš„targetç›®å½•ï¼Œç„¶åä½¿ç”¨å‘½ä»¤\u0026quot;java -jar xxx.jar\u0026quot;æ‰§è¡Œç¼–è¯‘å¥½çš„jaråŒ…å³å¯ã€‚\nå¯åŠ¨é¡ºåºï¼š\nå…ˆç¡®ä¿RabbitMQï¼ŒRediså’ŒMariadb/MySQLå¤„äºå¯åŠ¨çŠ¶æ€ å¯åŠ¨Eureka - æ‰€æœ‰å¾®æœåŠ¡å’ŒSCå¹³å°ç»„ä»¶éƒ½ä¾èµ–EurekaåšæœåŠ¡æ³¨å†Œ å¯åŠ¨Config-Server - éƒ¨åˆ†å¾®æœåŠ¡ä¾èµ–é…ç½®ä¸­å¿ƒæ‹‰å–é…ç½®é¡¹ å¯åŠ¨Hystrixç›‘æ§æ¨¡å— - Turbineå’ŒHystrix-Dashboardï¼Œç­‰åˆ°åç»­å¾®æœåŠ¡æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒåï¼ŒTurbineä¸‹æ¬¡åšæœåŠ¡å‘ç°ä¹‹åå°±å¯ä»¥æ­£å¸¸æ”¶é›†æ•°æ®äº† å¯åŠ¨é“¾è·¯è¿½è¸ªç»„ä»¶ - Zipkinå’ŒELKå®¹å™¨ ä¾æ¬¡å¯åŠ¨Authå¾®æœåŠ¡ -\u0026gt; Userå¾®æœåŠ¡ -\u0026gt; Itemå¾®æœåŠ¡ -\u0026gt; Cartå¾®æœåŠ¡ -\u0026gt; Orderå¾®æœåŠ¡ï¼Œä»¥åŠç•™ç»™åŒå­¦ä»¬å®Œæˆçš„ä¸»æœæœåŠ¡ï¼Œæ”¯ä»˜ä¸­å¿ƒ æœ€åå¯åŠ¨Gatewayç½‘å…³ - åœ¨å¾®æœåŠ¡éƒ½å¯åŠ¨å¥½ä¹‹åå†å¯åŠ¨ç½‘å…³ï¼Œå¯ä»¥ä¿è¯ç½‘å…³å¯åŠ¨åç«‹å³ç”Ÿæ•ˆã€‚åè¿‡æ¥å…ˆå¯åŠ¨ç½‘å…³å†æ³¨å†Œå¾®æœåŠ¡ä¹Ÿè¡Œï¼Œä½†æ˜¯Gatewayä¼šå¤„äºçŸ­æš‚çš„ä¸å¯ç”¨çŠ¶æ€ï¼Œå› ä¸ºGatewayå¯åŠ¨çš„æ—¶å€™å¾®æœåŠ¡è¿˜æ²¡æ³¨å†Œï¼Œéœ€è¦ç­‰GatewayåšæœåŠ¡å‘ç°åæ‰èƒ½ç”Ÿæ•ˆ ","permalink":"https://blog.chensoul.cc/posts/2024/01/03/til/","summary":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\nidworker-client ï¼Œä¸€ä¸ªå¼€æºçš„ ID ç”Ÿæˆå™¨ï¼Œé€‚åˆåœ¨å•æœºä½¿ç”¨ github ä¸Šåˆ›å»ºäº†ä¸€ä¸ªä½¿ç”¨ spring cloud netflix ç›¸å…³ç»„ä»¶çš„å¾®æœåŠ¡é¡¹ç›® spring-cloud-examples é‡æ„äº†ç‹‚é‡æ¶æ„å¸ˆè¯¾ç¨‹ä¸­çš„å¾®æœåŠ¡ç‰ˆæœ¬çš„æºç  foodie-cloud é‡æ„æ…•è¯¾ç½‘ Javaæ¶æ„å¸ˆ-æŠ€æœ¯ä¸“å®¶ è¯¾ç¨‹ä¸­çš„ æºç ï¼Œæˆ‘åšäº†ä¸€äº›æ”¹åŠ¨ï¼š\nå‡çº§ Spring Boot å’Œ Spring Cloud ç‰ˆæœ¬ å»æ‰ tk-mybatis æ”¹ä¸ºä½¿ç”¨ mybatis-plus é‡æ„æ¨¡å—å’Œéƒ¨åˆ†ä»£ç  é‡æ„åçš„æºç åœ°å€ï¼šhttps://github.com/chensoul/foodie-cloud\nåç»­è®¡åˆ’ï¼š\ndocker å®¹å™¨ç¼–æ’ k8s å®¹å™¨ç¼–æ’ é›†æˆ Spring Security OAuth2 é›†æˆ Spring Cloud alibaba å¼€å‘ç¯å¢ƒå’Œå¼€æºé¡¹ç›®ç‰ˆæœ¬ è½¯ä»¶ç‰ˆæœ¬ï¼š\nç»„ä»¶ ç”¨é€” ç‰ˆæœ¬å· Redis ç¼“å­˜ç»„ä»¶ 5.0.4 RabbitMQ æ¶ˆæ¯ä¸­é—´ä»¶ 3.7.15 Kafka æ¶ˆæ¯ä¸­é—´ä»¶ 2.2.0 Lua é™æµè„šæœ¬ 5.3.5 MySQL æ•°æ®åº“ 5.7 IDEA å¼€å‘ç¯å¢ƒ ç‰ˆæœ¬éšæ„ Java ç¼–è¯‘è¿è¡Œé¡¹ç›® 1.8ä»¥ä¸Šï¼ˆæ¨è8u161ä»¥åçš„ç‰ˆæœ¬ï¼Œå¦åˆ™è¦è£…JCEæ’ä»¶ï¼‰ Maven ä¾èµ–ç®¡ç† 3.0.4ä»¥ä¸Š Maven ä¾èµ–ç‰ˆæœ¬ï¼š\nç»„ä»¶ ç‰ˆæœ¬å· Spring Cloud 2021.0.9 Spring Boot 2.7.18 Mybatis Plus 3.5.5 æŠ€æœ¯é€‰å‹ Spring Cloudæ¯ä¸ªä¸šåŠ¡é¢†åŸŸéƒ½æœ‰å¤šä¸ªå¯ä¾›é€‰æ‹©çš„ç»„ä»¶ï¼Œè¿™é‡Œä¹Ÿåˆ—å‡ºäº†å¾®æœåŠ¡ç« èŠ‚ä¸­å°†è¦ç”¨åˆ°çš„ç»„ä»¶+ä¸­é—´ä»¶çš„æŠ€æœ¯é€‰å‹ï¼Œè¿™ä¹Ÿæ˜¯å½“å‰ä¸»æµçš„é€‰å‹ã€‚\nå†…å®¹ æŠ€æœ¯é€‰å‹ æœåŠ¡æ²»ç† Eureka è´Ÿè½½å‡è¡¡ Ribbon æœåŠ¡é—´è°ƒç”¨ Feign æœåŠ¡å®¹é”™ Hystrix + Turbine + Dashboard é…ç½®ç®¡ç† Config + Github æ¶ˆæ¯æ€»çº¿ Bus + RabbitMQ æœåŠ¡ç½‘å…³ Gateway è°ƒç”¨é“¾è¿½è¸ª Sleuth + Zipkin + ELK æ¶ˆæ¯é©±åŠ¨ Stream + RabbitMQ æµæ§ Sentinel åŸºäºRPCçš„æœåŠ¡æ²»ç†ï¼ˆä¸é›†æˆåˆ°ç”µå•†é¡¹ç›®ï¼‰ Dubbo + Admin Portal é»˜è®¤ç«¯å£ å†…å®¹ ç«¯å£ Eureka 20000 Turbine 20001 Hystrix-Dashboard 20002 Config-Server 20003 Gateway 20004 Zipkin 9411 ELKé•œåƒ-ES 9200 ELKé•œåƒ-Logstash 5044 ELKé•œåƒ-Kibana 5601 redisï¼ˆå•æœºæ¨¡å¼ï¼‰ 6379 rabbitmqï¼ˆå•æœºæ¨¡å¼ï¼‰ 5672 mariadb/mysqlï¼ˆå•æœºæ¨¡å¼ï¼‰ 3306 å•†å“å¾®æœåŠ¡ 10001 ç”¨æˆ·å¾®æœåŠ¡ 10002 è®¢å•å¾®æœåŠ¡ 10003 è´­ç‰©è½¦å¾®æœåŠ¡ 10004 æƒé™å¾®æœåŠ¡ 10006 ä¸»æœå¾®æœåŠ¡ åŒå­¦ä»¬è‡ªå·±å®ç° æ”¯ä»˜æœåŠ¡ æ²¡å˜ï¼Œä½†å›è°ƒåœ°å€è¦æ”¹ä¸€ä¸‹ å¯åŠ¨æ–¹å¼ å¯ä»¥åœ¨IDEAé‡Œå¯åŠ¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Mavenç¼–è¯‘ååœ¨å‘½ä»¤è¡Œçª—å£å¯åŠ¨ï¼Œå‘½ä»¤è¡Œå¯åŠ¨æ–¹å¼éœ€è¦åœ¨mavenç¼–è¯‘å¥½é¡¹ç›®ä¹‹åï¼Œcdåˆ°å¯¹åº”é¡¹ç›®ä¸‹çš„targetç›®å½•ï¼Œç„¶åä½¿ç”¨å‘½ä»¤\u0026quot;java -jar xxx.","title":"2024-01-03ï½œä»Šå¤©åšäº†ä»€ä¹ˆ"},{"content":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\né›ªå´©é—®é¢˜ Spring Cloudå¾®æœåŠ¡é›†æˆ Sentinel æ‰©å±• Sentinel é›†æˆ OpenFeignï¼Œå®ç°è‡ªåŠ¨é™çº§ é›ªå´©é—®é¢˜ 1ã€ä»€ä¹ˆæ˜¯é›ªå´©é—®é¢˜ï¼Ÿ\né›ªå´©é—®é¢˜ï¼ˆAvalanche Effectï¼‰æ˜¯æŒ‡åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹æˆ–æœåŠ¡å‡ºç°æ•…éšœæˆ–ä¸å¯ç”¨æ—¶ï¼Œå…¶å½±å“ä¼šæ‰©æ•£åˆ°å…¶ä»–èŠ‚ç‚¹æˆ–æœåŠ¡ï¼Œå¯¼è‡´çº§è”æ•…éšœçš„ç°è±¡ã€‚è¿™ç§ç°è±¡ç±»ä¼¼äºé›ªå´©ï¼Œä¸€æ—¦å¼€å§‹ï¼Œä¼šä¸æ–­æ”¾å¤§å’Œè”“å»¶ï¼Œæœ€ç»ˆå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå´©æºƒã€‚\né›ªå´©é—®é¢˜çš„ä¸»è¦åŸå› æ˜¯ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹æˆ–æœåŠ¡ä¹‹é—´å­˜åœ¨è¿‡åº¦ä¾èµ–ã€é«˜åº¦è€¦åˆï¼Œä»¥åŠç¼ºä¹å®¹é”™æœºåˆ¶ã€‚å½“ä¸€ä¸ªèŠ‚ç‚¹æˆ–æœåŠ¡å‡ºç°æ•…éšœæ—¶ï¼Œç”±äºå…¶ä»–èŠ‚ç‚¹æˆ–æœåŠ¡æ— æ³•åŠæ—¶å¤„ç†æˆ–é€‚åº”ï¼Œæ•…éšœä¼šä¸æ–­ä¼ æ’­ï¼Œæœ€ç»ˆå¯¼è‡´æ•´ä¸ªç³»ç»Ÿçš„å´©æºƒã€‚\n2ã€å¦‚ä½•è§£å†³é›ªå´©é—®é¢˜ï¼Ÿ\nè¶…æ—¶å¤„ç†ï¼šåœ¨è¯·æ±‚å…¶ä»–èŠ‚ç‚¹æˆ–æœåŠ¡æ—¶ï¼Œè®¾ç½®é€‚å½“çš„è¶…æ—¶æ—¶é—´ã€‚å¦‚æœåœ¨è§„å®šçš„æ—¶é—´å†…æœªæ”¶åˆ°å“åº”ï¼Œå¯ä»¥è®¤ä¸ºè¯·æ±‚å¤±è´¥ï¼Œå¹¶è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œå¦‚è¿”å›é»˜è®¤å€¼æˆ–é”™è¯¯ä¿¡æ¯ã€‚è¶…æ—¶å¤„ç†å¯ä»¥é˜²æ­¢å› ç­‰å¾…è¿‡é•¿çš„å“åº”æ—¶é—´å¯¼è‡´çš„è¯·æ±‚å †ç§¯å’Œèµ„æºæµªè´¹ã€‚ çº¿ç¨‹éš”ç¦»ï¼šé€šè¿‡å°†ä¸åŒçš„è¯·æ±‚åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå¯ä»¥é¿å…å› æŸä¸ªè¯·æ±‚çš„æ‰§è¡Œæ—¶é—´è¿‡é•¿è€Œå½±å“å…¶ä»–è¯·æ±‚çš„å¤„ç†ã€‚çº¿ç¨‹éš”ç¦»å¯ä»¥é€šè¿‡çº¿ç¨‹æ± æˆ–ç‹¬ç«‹çš„çº¿ç¨‹æ¥å®ç°ã€‚æ¯ä¸ªè¯·æ±‚éƒ½åœ¨ç‹¬ç«‹çš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå‘ç”Ÿæ•…éšœæˆ–å¼‚å¸¸æ—¶åªä¼šå½±å“å½“å‰è¯·æ±‚ï¼Œè€Œä¸ä¼šå½±å“æ•´ä¸ªç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚ é™çº§ç†”æ–­ï¼šå½“ç³»ç»Ÿå‹åŠ›è¿‡å¤§æˆ–å‡ºç°æ•…éšœæ—¶ï¼Œå¯ä»¥é€šè¿‡é™çº§ç†”æ–­æœºåˆ¶æš‚æ—¶å…³é—­æˆ–å‡å°‘å¯¹æŸäº›åŠŸèƒ½æˆ–æœåŠ¡çš„è¯·æ±‚ï¼Œä»¥ä¿æŠ¤æ ¸å¿ƒåŠŸèƒ½çš„ç¨³å®šæ€§ã€‚ä¾‹å¦‚ï¼Œå½“è¯·æ±‚æŸä¸ªæœåŠ¡çš„å¤±è´¥ç‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œå¯ä»¥è‡ªåŠ¨è§¦å‘ç†”æ–­æœºåˆ¶ï¼Œæš‚æ—¶åœæ­¢å¯¹è¯¥æœåŠ¡çš„è¯·æ±‚ï¼Œå¹¶è¿”å›ä¸€ä¸ªé»˜è®¤å€¼æˆ–é”™è¯¯ä¿¡æ¯ã€‚ æµé‡æ§åˆ¶ï¼šé€šè¿‡å®æ–½æµé‡æ§åˆ¶ç­–ç•¥ï¼Œé™åˆ¶å¯¹ç³»ç»Ÿçš„å¹¶å‘è¯·æ±‚æ•°é‡ã€‚å¯ä»¥ä½¿ç”¨ä»¤ç‰Œæ¡¶ç®—æ³•æˆ–æ¼æ¡¶ç®—æ³•ç­‰è¿›è¡Œæµé‡æ§åˆ¶ã€‚è¿™å¯ä»¥é¿å…è¿‡å¤šçš„è¯·æ±‚é›†ä¸­åœ¨æŸä¸ªèŠ‚ç‚¹æˆ–æœåŠ¡ä¸Šï¼Œå¯¼è‡´å…¶è´Ÿè½½è¿‡é‡ï¼Œè¿›è€Œå¼•å‘é›ªå´©æ•ˆåº”ã€‚ è´Ÿè½½å‡è¡¡ï¼šä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨å°†è¯·æ±‚åˆ†å‘åˆ°å¤šä¸ªèŠ‚ç‚¹æˆ–æœåŠ¡ä¸Šï¼Œä»¥å‡è¡¡ç³»ç»Ÿçš„è´Ÿè½½ã€‚è´Ÿè½½å‡è¡¡å¯ä»¥åŸºäºä¸åŒçš„ç®—æ³•ï¼Œå¦‚è½®è¯¢ã€éšæœºã€åŠ æƒè½®è¯¢ç­‰ã€‚é€šè¿‡è´Ÿè½½å‡è¡¡ï¼Œå¯ä»¥é¿å…å•ä¸€èŠ‚ç‚¹æˆ–æœåŠ¡æ‰¿å—è¿‡å¤§çš„å‹åŠ›ï¼Œä»è€Œå‡å°‘æ•…éšœå’Œé›ªå´©çš„é£é™©ã€‚ è¿™äº›æ–¹æ³•å¯ä»¥å•ç‹¬æˆ–ç»„åˆä½¿ç”¨ï¼Œå…·ä½“çš„é€‰æ‹©å’Œå®æ–½å–å†³äºç³»ç»Ÿçš„éœ€æ±‚å’Œæ¶æ„ã€‚æ­¤å¤–ï¼Œè¿˜éœ€è¦å®šæœŸè¿›è¡Œç³»ç»Ÿæ€§èƒ½è¯„ä¼°å’Œå‹åŠ›æµ‹è¯•ï¼Œä»¥ä¾¿åŠæ—¶å‘ç°å’Œè§£å†³æ½œåœ¨çš„é›ªå´©é—®é¢˜ï¼Œå¹¶ä¸æ–­ä¼˜åŒ–ç³»ç»Ÿçš„å¯é æ€§å’Œç¨³å®šæ€§ã€‚\nSpring Cloud å¾®æœåŠ¡é›†æˆ Sentinel æ·»åŠ  maven ä¾èµ–ï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.alibaba.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-starter-alibaba-sentinel\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; æ·»åŠ é…ç½®æ–‡ä»¶ï¼š\nspring.cloud.sentinel.transport.dashboard=localhost:8080 é…ç½®æ–‡ä»¶æ‰“å¼€ Sentinel å¯¹ Feign çš„æ”¯æŒï¼šfeign.sentinel.enabled=true\nåŠ å…¥ spring-cloud-starter-openfeign ä¾èµ–ä½¿ Sentinel starter ä¸­çš„è‡ªåŠ¨åŒ–é…ç½®ç±»ç”Ÿæ•ˆï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-starter-openfeign\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; é…ç½® RestTemplate æ”¯æŒ sentinelï¼š\n@Bean @SentinelRestTemplate( blockHandler = \u0026#34;handleBlock\u0026#34;, fallback = \u0026#34;handleFallback\u0026#34;, fallbackClass = SentinelFallbackBlockHandler.class, blockHandlerClass = SentinelFallbackBlockHandler.class) public RestTemplate restTemplate() { return new RestTemplate(); } SentinelFallbackBlockHandler ç±»ï¼š\npublic class SentinelFallbackBlockHandler { public static ClientHttpResponse handleBlock(HttpRequest request, byte[] body, ClientHttpRequestExecution execution, BlockException exception) { return new SentinelClientHttpResponse(); } public static ClientHttpResponse handleFallback(HttpRequest request, byte[] body, ClientHttpRequestExecution execution, BlockException ex) { return new SentinelClientHttpResponse(); } } æ‰©å±• Sentinel é›†æˆ OpenFeignï¼Œå®ç°è‡ªåŠ¨é™çº§ 1ã€æ‰©å±• BlockExceptionHandlerï¼Œå®ç° JSON è¾“å‡º\n@Slf4j @RequiredArgsConstructor public class JsonBlockExceptionHandler implements BlockExceptionHandler { private final ObjectMapper objectMapper; @Override public void handle(HttpServletRequest request, HttpServletResponse response, BlockException e) throws Exception { log.error(\u0026#34;Sentinel fallback , resource is {}\u0026#34;, e.getRule().getResource(), e); response.setContentType(MediaType.APPLICATION_JSON_VALUE); response.setStatus(HttpStatus.TOO_MANY_REQUESTS.value()); response.getWriter().print(objectMapper.writeValueAsString(Result.error(ResultCode.TOO_MANY_REQUESTS))); } } 2ã€é‡å†™ SentinelInvocationHandlerï¼Œå®ç°è‡ªåŠ¨é™çº§å¤„ç†\n@Slf4j public class AutoFallbackSentinelInvocationHandler implements InvocationHandler { public static final String EQUALS = \u0026#34;equals\u0026#34;; public static final String HASH_CODE = \u0026#34;hashCode\u0026#34;; public static final String TO_STRING = \u0026#34;toString\u0026#34;; private final Target\u0026lt;?\u0026gt; target; private final Map\u0026lt;Method, InvocationHandlerFactory.MethodHandler\u0026gt; dispatch; private FallbackFactory\u0026lt;?\u0026gt; fallbackFactory; private Map\u0026lt;Method, Method\u0026gt; fallbackMethodMap; AutoFallbackSentinelInvocationHandler(Target\u0026lt;?\u0026gt; target, Map\u0026lt;Method, InvocationHandlerFactory.MethodHandler\u0026gt; dispatch, FallbackFactory\u0026lt;?\u0026gt; fallbackFactory) { this.target = checkNotNull(target, \u0026#34;target\u0026#34;); this.dispatch = checkNotNull(dispatch, \u0026#34;dispatch\u0026#34;); this.fallbackFactory = fallbackFactory; this.fallbackMethodMap = toFallbackMethod(dispatch); } AutoFallbackSentinelInvocationHandler(Target\u0026lt;?\u0026gt; target, Map\u0026lt;Method, InvocationHandlerFactory.MethodHandler\u0026gt; dispatch) { this.target = checkNotNull(target, \u0026#34;target\u0026#34;); this.dispatch = checkNotNull(dispatch, \u0026#34;dispatch\u0026#34;); } @Override public Object invoke(final Object proxy, final Method method, final Object[] args) throws Throwable { if (EQUALS.equals(method.getName())) { try { Object otherHandler = args.length \u0026gt; 0 \u0026amp;\u0026amp; args[0] != null ? Proxy.getInvocationHandler(args[0]) : null; return equals(otherHandler); } catch (IllegalArgumentException e) { return false; } } else if (HASH_CODE.equals(method.getName())) { return hashCode(); } else if (TO_STRING.equals(method.getName())) { return toString(); } Object result; InvocationHandlerFactory.MethodHandler methodHandler = this.dispatch.get(method); // only handle by HardCodedTarget if (target instanceof Target.HardCodedTarget) { Target.HardCodedTarget\u0026lt;?\u0026gt; hardCodedTarget = (Target.HardCodedTarget) target; MethodMetadata methodMetadata = SentinelContractHolder.METADATA_MAP .get(hardCodedTarget.type().getName() + Feign.configKey(hardCodedTarget.type(), method)); // resource default is HttpMethod:protocol://url if (methodMetadata == null) { result = methodHandler.invoke(args); } else { String resourceName = methodMetadata.template().method().toUpperCase() + \u0026#39;:\u0026#39; + hardCodedTarget.url() + methodMetadata.template().path(); Entry entry = null; try { ContextUtil.enter(resourceName); entry = SphU.entry(resourceName, EntryType.OUT, 1, args); result = methodHandler.invoke(args); } catch (Throwable ex) { // fallback handle if (!BlockException.isBlockException(ex)) { Tracer.trace(ex); } if (fallbackFactory != null) { try { return fallbackMethodMap.get(method).invoke(fallbackFactory.create(ex), args); } catch (IllegalAccessException e) { // shouldn\u0026#39;t happen as method is public due to being an // interface throw new AssertionError(e); } catch (InvocationTargetException e) { throw new AssertionError(e.getCause()); } } else { // è‹¥æ˜¯Resultç±»å‹ å¹¶ä¸”ä¸åŒ…å«@FeignRetry æ‰§è¡Œè‡ªåŠ¨é™çº§è¿”å› FeignRetry feignRetry = AnnotationUtils.findAnnotation(method, FeignRetry.class); if (Result.class == method.getReturnType() \u0026amp;\u0026amp; Objects.isNull(feignRetry)) { log.error(\u0026#34;æœåŠ¡è°ƒç”¨å¼‚å¸¸\u0026#34;, ex); return Result.error(ResultCode.INNER_SERVICE_ERROR, ex.getMessage()); } else { throw ex; } } } finally { if (entry != null) { entry.exit(1, args); } ContextUtil.exit(); } } } else { // other target type using default strategy result = methodHandler.invoke(args); } return result; } @Override public boolean equals(Object obj) { if (obj instanceof SentinelInvocationHandler) { AutoFallbackSentinelInvocationHandler other = (AutoFallbackSentinelInvocationHandler) obj; return target.equals(other.target); } return false; } @Override public int hashCode() { return target.hashCode(); } @Override public String toString() { return target.toString(); } static Map\u0026lt;Method, Method\u0026gt; toFallbackMethod(Map\u0026lt;Method, InvocationHandlerFactory.MethodHandler\u0026gt; dispatch) { Map\u0026lt;Method, Method\u0026gt; result = new LinkedHashMap\u0026lt;\u0026gt;(); for (Method method : dispatch.keySet()) { method.setAccessible(true); result.put(method, method); } return result; } } 3ã€é‡å†™ SentinelFeignï¼Œæ”¯æŒè‡ªåŠ¨é™çº§æ³¨å…¥\npublic final class AutoFallbackSentinelFeign { private AutoFallbackSentinelFeign() { } public static Builder builder() { return new Builder(); } public static final class Builder extends Feign.Builder implements ApplicationContextAware { private Contract contract = new Contract.Default(); private ApplicationContext applicationContext; private FeignContext feignContext; @Override public Feign.Builder invocationHandlerFactory(InvocationHandlerFactory invocationHandlerFactory) { throw new UnsupportedOperationException(); } @Override public Builder contract(Contract contract) { this.contract = contract; return this; } @Override public Feign build() { super.invocationHandlerFactory(new InvocationHandlerFactory() { @Override public InvocationHandler create(Target target, Map\u0026lt;Method, MethodHandler\u0026gt; dispatch) { // æŸ¥æ‰¾ FeignClient ä¸Šçš„ é™çº§ç­–ç•¥ FeignClient feignClient = AnnotationUtils.findAnnotation(target.type(), FeignClient.class); Class\u0026lt;?\u0026gt; fallback = feignClient.fallback(); Class\u0026lt;?\u0026gt; fallbackFactory = feignClient.fallbackFactory(); String beanName = feignClient.contextId(); if (!StringUtils.hasText(beanName)) { beanName = feignClient.name(); } Object fallbackInstance; FallbackFactory\u0026lt;?\u0026gt; fallbackFactoryInstance; if (void.class != fallback) { fallbackInstance = getFromContext(beanName, \u0026#34;fallback\u0026#34;, fallback, target.type()); return new AutoFallbackSentinelInvocationHandler(target, dispatch, new FallbackFactory.Default(fallbackInstance)); } if (void.class != fallbackFactory) { //é’ˆå¯¹ hystrix fallbackFactory ç‰¹æ®Šå¤„ç† try { fallbackFactoryInstance = (FallbackFactory\u0026lt;?\u0026gt;) getFromContext(beanName, \u0026#34;fallbackFactory\u0026#34;, fallbackFactory, FallbackFactory.class); } catch (Exception e) { return new AutoFallbackSentinelInvocationHandler(target, dispatch); } return new AutoFallbackSentinelInvocationHandler(target, dispatch, fallbackFactoryInstance); } return new AutoFallbackSentinelInvocationHandler(target, dispatch); } private Object getFromContext(String name, String type, Class\u0026lt;?\u0026gt; fallbackType, Class\u0026lt;?\u0026gt; targetType) { Object fallbackInstance = feignContext.getInstance(name, fallbackType); if (fallbackInstance == null) { throw new IllegalStateException(String .format(\u0026#34;No %s instance of type %s found for loadbalance client %s\u0026#34;, type, fallbackType, name)); } if (!targetType.isAssignableFrom(fallbackType)) { throw new IllegalStateException(String.format( \u0026#34;Incompatible %s instance. Fallback/fallbackFactory of type %s is not assignable to %s for loadbalance client %s\u0026#34;, type, fallbackType, targetType, name)); } return fallbackInstance; } }); super.contract(new SentinelContractHolder(contract)); return super.build(); } private Object getFieldValue(Object instance, String fieldName) { Field field = ReflectionUtils.findField(instance.getClass(), fieldName); field.setAccessible(true); try { return field.get(instance); } catch (IllegalAccessException e) { // ignore } return null; } @Override public void setApplicationContext(ApplicationContext applicationContext) throws BeansException { this.applicationContext = applicationContext; feignContext = this.applicationContext.getBean(FeignContext.class); } } } æœ€åï¼Œå†è¿›è¡Œè‡ªåŠ¨è£…é…ï¼š\n@AutoConfiguration @AutoConfigureBefore(SentinelFeignAutoConfiguration.class) @ConditionalOnProperty(name = \u0026#34;feign.sentinel.enabled\u0026#34;, havingValue = \u0026#34;true\u0026#34;) public class SentinelFeignConfiguration { @Bean @Scope(\u0026#34;prototype\u0026#34;) @ConditionalOnMissingBean public Feign.Builder autoFallbackSentinelFeignBuilder() { return AutoFallbackSentinelFeign.builder(); } @Bean @ConditionalOnMissingBean public BlockExceptionHandler blockExceptionHandler(ObjectMapper objectMapper) { return new JsonBlockExceptionHandler(objectMapper); } @Bean @ConditionalOnMissingBean public RequestOriginParser requestOriginParser() { return new AllowHeaderRequestOriginParser(); } } ","permalink":"https://blog.chensoul.cc/posts/2024/01/02/til/","summary":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\né›ªå´©é—®é¢˜ Spring Cloudå¾®æœåŠ¡é›†æˆ Sentinel æ‰©å±• Sentinel é›†æˆ OpenFeignï¼Œå®ç°è‡ªåŠ¨é™çº§ é›ªå´©é—®é¢˜ 1ã€ä»€ä¹ˆæ˜¯é›ªå´©é—®é¢˜ï¼Ÿ\né›ªå´©é—®é¢˜ï¼ˆAvalanche Effectï¼‰æ˜¯æŒ‡åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹æˆ–æœåŠ¡å‡ºç°æ•…éšœæˆ–ä¸å¯ç”¨æ—¶ï¼Œå…¶å½±å“ä¼šæ‰©æ•£åˆ°å…¶ä»–èŠ‚ç‚¹æˆ–æœåŠ¡ï¼Œå¯¼è‡´çº§è”æ•…éšœçš„ç°è±¡ã€‚è¿™ç§ç°è±¡ç±»ä¼¼äºé›ªå´©ï¼Œä¸€æ—¦å¼€å§‹ï¼Œä¼šä¸æ–­æ”¾å¤§å’Œè”“å»¶ï¼Œæœ€ç»ˆå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå´©æºƒã€‚\né›ªå´©é—®é¢˜çš„ä¸»è¦åŸå› æ˜¯ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹æˆ–æœåŠ¡ä¹‹é—´å­˜åœ¨è¿‡åº¦ä¾èµ–ã€é«˜åº¦è€¦åˆï¼Œä»¥åŠç¼ºä¹å®¹é”™æœºåˆ¶ã€‚å½“ä¸€ä¸ªèŠ‚ç‚¹æˆ–æœåŠ¡å‡ºç°æ•…éšœæ—¶ï¼Œç”±äºå…¶ä»–èŠ‚ç‚¹æˆ–æœåŠ¡æ— æ³•åŠæ—¶å¤„ç†æˆ–é€‚åº”ï¼Œæ•…éšœä¼šä¸æ–­ä¼ æ’­ï¼Œæœ€ç»ˆå¯¼è‡´æ•´ä¸ªç³»ç»Ÿçš„å´©æºƒã€‚\n2ã€å¦‚ä½•è§£å†³é›ªå´©é—®é¢˜ï¼Ÿ\nè¶…æ—¶å¤„ç†ï¼šåœ¨è¯·æ±‚å…¶ä»–èŠ‚ç‚¹æˆ–æœåŠ¡æ—¶ï¼Œè®¾ç½®é€‚å½“çš„è¶…æ—¶æ—¶é—´ã€‚å¦‚æœåœ¨è§„å®šçš„æ—¶é—´å†…æœªæ”¶åˆ°å“åº”ï¼Œå¯ä»¥è®¤ä¸ºè¯·æ±‚å¤±è´¥ï¼Œå¹¶è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œå¦‚è¿”å›é»˜è®¤å€¼æˆ–é”™è¯¯ä¿¡æ¯ã€‚è¶…æ—¶å¤„ç†å¯ä»¥é˜²æ­¢å› ç­‰å¾…è¿‡é•¿çš„å“åº”æ—¶é—´å¯¼è‡´çš„è¯·æ±‚å †ç§¯å’Œèµ„æºæµªè´¹ã€‚ çº¿ç¨‹éš”ç¦»ï¼šé€šè¿‡å°†ä¸åŒçš„è¯·æ±‚åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå¯ä»¥é¿å…å› æŸä¸ªè¯·æ±‚çš„æ‰§è¡Œæ—¶é—´è¿‡é•¿è€Œå½±å“å…¶ä»–è¯·æ±‚çš„å¤„ç†ã€‚çº¿ç¨‹éš”ç¦»å¯ä»¥é€šè¿‡çº¿ç¨‹æ± æˆ–ç‹¬ç«‹çš„çº¿ç¨‹æ¥å®ç°ã€‚æ¯ä¸ªè¯·æ±‚éƒ½åœ¨ç‹¬ç«‹çš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå‘ç”Ÿæ•…éšœæˆ–å¼‚å¸¸æ—¶åªä¼šå½±å“å½“å‰è¯·æ±‚ï¼Œè€Œä¸ä¼šå½±å“æ•´ä¸ªç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚ é™çº§ç†”æ–­ï¼šå½“ç³»ç»Ÿå‹åŠ›è¿‡å¤§æˆ–å‡ºç°æ•…éšœæ—¶ï¼Œå¯ä»¥é€šè¿‡é™çº§ç†”æ–­æœºåˆ¶æš‚æ—¶å…³é—­æˆ–å‡å°‘å¯¹æŸäº›åŠŸèƒ½æˆ–æœåŠ¡çš„è¯·æ±‚ï¼Œä»¥ä¿æŠ¤æ ¸å¿ƒåŠŸèƒ½çš„ç¨³å®šæ€§ã€‚ä¾‹å¦‚ï¼Œå½“è¯·æ±‚æŸä¸ªæœåŠ¡çš„å¤±è´¥ç‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œå¯ä»¥è‡ªåŠ¨è§¦å‘ç†”æ–­æœºåˆ¶ï¼Œæš‚æ—¶åœæ­¢å¯¹è¯¥æœåŠ¡çš„è¯·æ±‚ï¼Œå¹¶è¿”å›ä¸€ä¸ªé»˜è®¤å€¼æˆ–é”™è¯¯ä¿¡æ¯ã€‚ æµé‡æ§åˆ¶ï¼šé€šè¿‡å®æ–½æµé‡æ§åˆ¶ç­–ç•¥ï¼Œé™åˆ¶å¯¹ç³»ç»Ÿçš„å¹¶å‘è¯·æ±‚æ•°é‡ã€‚å¯ä»¥ä½¿ç”¨ä»¤ç‰Œæ¡¶ç®—æ³•æˆ–æ¼æ¡¶ç®—æ³•ç­‰è¿›è¡Œæµé‡æ§åˆ¶ã€‚è¿™å¯ä»¥é¿å…è¿‡å¤šçš„è¯·æ±‚é›†ä¸­åœ¨æŸä¸ªèŠ‚ç‚¹æˆ–æœåŠ¡ä¸Šï¼Œå¯¼è‡´å…¶è´Ÿè½½è¿‡é‡ï¼Œè¿›è€Œå¼•å‘é›ªå´©æ•ˆåº”ã€‚ è´Ÿè½½å‡è¡¡ï¼šä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨å°†è¯·æ±‚åˆ†å‘åˆ°å¤šä¸ªèŠ‚ç‚¹æˆ–æœåŠ¡ä¸Šï¼Œä»¥å‡è¡¡ç³»ç»Ÿçš„è´Ÿè½½ã€‚è´Ÿè½½å‡è¡¡å¯ä»¥åŸºäºä¸åŒçš„ç®—æ³•ï¼Œå¦‚è½®è¯¢ã€éšæœºã€åŠ æƒè½®è¯¢ç­‰ã€‚é€šè¿‡è´Ÿè½½å‡è¡¡ï¼Œå¯ä»¥é¿å…å•ä¸€èŠ‚ç‚¹æˆ–æœåŠ¡æ‰¿å—è¿‡å¤§çš„å‹åŠ›ï¼Œä»è€Œå‡å°‘æ•…éšœå’Œé›ªå´©çš„é£é™©ã€‚ è¿™äº›æ–¹æ³•å¯ä»¥å•ç‹¬æˆ–ç»„åˆä½¿ç”¨ï¼Œå…·ä½“çš„é€‰æ‹©å’Œå®æ–½å–å†³äºç³»ç»Ÿçš„éœ€æ±‚å’Œæ¶æ„ã€‚æ­¤å¤–ï¼Œè¿˜éœ€è¦å®šæœŸè¿›è¡Œç³»ç»Ÿæ€§èƒ½è¯„ä¼°å’Œå‹åŠ›æµ‹è¯•ï¼Œä»¥ä¾¿åŠæ—¶å‘ç°å’Œè§£å†³æ½œåœ¨çš„é›ªå´©é—®é¢˜ï¼Œå¹¶ä¸æ–­ä¼˜åŒ–ç³»ç»Ÿçš„å¯é æ€§å’Œç¨³å®šæ€§ã€‚\nSpring Cloud å¾®æœåŠ¡é›†æˆ Sentinel æ·»åŠ  maven ä¾èµ–ï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.alibaba.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-starter-alibaba-sentinel\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; æ·»åŠ é…ç½®æ–‡ä»¶ï¼š\nspring.cloud.sentinel.transport.dashboard=localhost:8080 é…ç½®æ–‡ä»¶æ‰“å¼€ Sentinel å¯¹ Feign çš„æ”¯æŒï¼šfeign.sentinel.enabled=true\nåŠ å…¥ spring-cloud-starter-openfeign ä¾èµ–ä½¿ Sentinel starter ä¸­çš„è‡ªåŠ¨åŒ–é…ç½®ç±»ç”Ÿæ•ˆï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-starter-openfeign\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; é…ç½® RestTemplate æ”¯æŒ sentinelï¼š\n@Bean @SentinelRestTemplate( blockHandler = \u0026#34;handleBlock\u0026#34;, fallback = \u0026#34;handleFallback\u0026#34;, fallbackClass = SentinelFallbackBlockHandler.class, blockHandlerClass = SentinelFallbackBlockHandler.class) public RestTemplate restTemplate() { return new RestTemplate(); } SentinelFallbackBlockHandler ç±»ï¼š\npublic class SentinelFallbackBlockHandler { public static ClientHttpResponse handleBlock(HttpRequest request, byte[] body, ClientHttpRequestExecution execution, BlockException exception) { return new SentinelClientHttpResponse(); } public static ClientHttpResponse handleFallback(HttpRequest request, byte[] body, ClientHttpRequestExecution execution, BlockException ex) { return new SentinelClientHttpResponse(); } } æ‰©å±• Sentinel é›†æˆ OpenFeignï¼Œå®ç°è‡ªåŠ¨é™çº§ 1ã€æ‰©å±• BlockExceptionHandlerï¼Œå®ç° JSON è¾“å‡º","title":"2024-01-02ï½œé›ªå´©é—®é¢˜ã€Spring Cloudå¾®æœåŠ¡é›†æˆ Sentinel"},{"content":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\né‡æ„å¾®æœåŠ¡é¡¹ç›®ä¸­ä½¿ç”¨ spring-security-oauth2 æ­å»º OAuth2 è®¤è¯æœåŠ¡å’Œèµ„æºæœåŠ¡çš„ä»£ç ï¼Œå‡å°‘å…¶ä»–æ¨¡å—å¯¹æ­¤çš„è€¦åˆåº¦ã€‚è®¡åˆ’å°† spring-security-oauth2 è¿ç§»åˆ° spring-security-oauth2-authorization-server ä¸Šï¼Œå³ä½¿ç”¨ OAuth2.1 æˆæƒå’Œè®¤è¯ã€‚Spring Authorization Server ç›¸å…³æ–‡æ¡£ï¼Œå¯ä»¥å‚è€ƒ https://blog.51cto.com/u_15268610/category2ã€‚\nçœ‹ xuxiaowei-cloud master åˆ†æ”¯æºä»£ç ï¼Œæ•´ç† /login ç™»é™†é€»è¾‘ï¼Œå‚æ•°ï¼šusernameã€passwordã€tenantIdã€clientId\nç™»é™†æˆåŠŸ\nè®°å½•ç™»é™†æ—¥å¿— è½¬å‘ /login/success è·å–å®¢æˆ·ç«¯ä¿¡æ¯ï¼Œå°†æˆæƒåœ°å€ã€æ ¡éªŒ token åœ°å€è¿”å›ç»™å‰ç«¯ å‰ç«¯é‡å®šå‘åˆ°æˆæƒé¡µé¢ æˆæƒåŒæ„ï¼Œåˆ™é‡å®šå‘åˆ°å®¢æˆ·ç«¯è¡¨ä¸­é…ç½®çš„é‡å®šå‘åœ°å€ /oauth2/code/{id}ï¼Œå¹¶é€šè¿‡ code å»è·å– tokenï¼Œæœ€åå†é‡å®šå‘åˆ°ç”¨æˆ·æŒ‡å®šçš„å›è°ƒåœ°å€ é‡æ–°æ¢³ç†ç”¨æˆ·ä¸­å¿ƒé¢†åŸŸæ¨¡å‹ã€‚\né¢†åŸŸæ¨¡å‹ï¼š\nå®¢æˆ·ç«¯ï¼Œå¯¹åº” OAuth ä¸­çš„å®¢æˆ·ç«¯çš„æ¦‚å¿µã€‚\nåº”ç”¨\nç§Ÿæˆ·\nç”¨æˆ·\nè§’è‰²\nèµ„æº\nåŒºåŸŸ\né—¨åº—\né¢†åŸŸæ¨¡å‹ä¹‹é—´çš„å…³ç³»è¯´æ˜ï¼š\nå®¢æˆ·ç«¯å’Œåº”ç”¨å¤šå¯¹çš„çš„å…³ç³»ï¼Œåº”ç”¨å’Œç§Ÿæˆ·æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ï¼Œç§Ÿæˆ·å’Œèµ„æºæ˜¯å¤šå¯¹å¤šçš„å…³ç³»ï¼Œåº”ç”¨å’Œèµ„æºä¸€å¯¹å¤šçš„å…³ç³»ã€‚ä¸ºäº†ç®€åŒ–æ“ä½œï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªä¸­é—´è¡¨ä¿å­˜å®¢æˆ·ç«¯ã€åº”ç”¨ã€ç§Ÿæˆ·ã€èµ„æºä¹‹é—´çš„å…³ç³»ã€‚ èµ„æºã€ç”¨æˆ·ã€è§’è‰²æ˜¯ RBAC æ¨¡å‹ã€‚è§’è‰²å’Œåº”ç”¨æ˜¯å¤šå¯¹ä¸€çš„å…³ç³»ï¼Œç§Ÿæˆ·å’Œè§’è‰²æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œå³è§’è‰²æ˜¯éš¶å±äºåº”ç”¨å’Œç§Ÿæˆ·ã€‚ä¸å¤ªåº”ç”¨çš„ä¸åŒç§Ÿæˆ·ä¸‹çš„è§’è‰²ä¸ä¸€æ ·ã€‚ ç§Ÿæˆ·å’ŒåŒºåŸŸæ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼ŒåŒºåŸŸå’Œé—¨åº—æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œé—¨åº—å’Œåº”ç”¨æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ã€‚ ç”¨æˆ·å’Œç§Ÿæˆ·æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ã€‚ æµç¨‹ï¼š\nç™»é™†ï¼šä½¿ç”¨ç”¨æˆ·åã€å¯†ç ã€å®¢æˆ·ç«¯ IDã€ç§Ÿæˆ· IDï¼ˆé¦–æ¬¡ç™»é™†æ—¶ä¸ºç©ºï¼Œå–ç”¨æˆ·æœ‰æƒé™çš„ç§Ÿæˆ·ä¸­çš„ç¬¬ä¸€ä¸ªï¼‰ ç™»é™†ã€‚é€šè¿‡ å®¢æˆ·ç«¯ IDã€ç§Ÿæˆ· ID ã€ç”¨æˆ·åæŸ¥è¯¢è¯¥ç”¨æˆ·çš„æƒé™ã€‚ ç™»é™†ä¹‹åï¼Œå†é€‰æ‹©ç§Ÿæˆ·è¿›å…¥é¦–é¡µã€‚ åˆ›å»ºå®¢æˆ·ç«¯ä¹‹åï¼Œå¯ä»¥ç»‘å®šåº”ç”¨ã€‚ åˆ›å»ºç§Ÿæˆ·æ—¶ï¼Œå¯ä»¥é€šè¿‡èµ„æºæ ‘ï¼ˆå®¢æˆ·ç«¯+åº”ç”¨+èµ„æºï¼‰å¼€é€šèµ„æºï¼Œå¯ä»¥ç»™ç§Ÿæˆ·å¼€é€šçš„åº”ç”¨å¼€é€šé—¨åº—ã€‚ ","permalink":"https://blog.chensoul.cc/posts/2023/12/28/til/","summary":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\né‡æ„å¾®æœåŠ¡é¡¹ç›®ä¸­ä½¿ç”¨ spring-security-oauth2 æ­å»º OAuth2 è®¤è¯æœåŠ¡å’Œèµ„æºæœåŠ¡çš„ä»£ç ï¼Œå‡å°‘å…¶ä»–æ¨¡å—å¯¹æ­¤çš„è€¦åˆåº¦ã€‚è®¡åˆ’å°† spring-security-oauth2 è¿ç§»åˆ° spring-security-oauth2-authorization-server ä¸Šï¼Œå³ä½¿ç”¨ OAuth2.1 æˆæƒå’Œè®¤è¯ã€‚Spring Authorization Server ç›¸å…³æ–‡æ¡£ï¼Œå¯ä»¥å‚è€ƒ https://blog.51cto.com/u_15268610/category2ã€‚\nçœ‹ xuxiaowei-cloud master åˆ†æ”¯æºä»£ç ï¼Œæ•´ç† /login ç™»é™†é€»è¾‘ï¼Œå‚æ•°ï¼šusernameã€passwordã€tenantIdã€clientId\nç™»é™†æˆåŠŸ\nè®°å½•ç™»é™†æ—¥å¿— è½¬å‘ /login/success è·å–å®¢æˆ·ç«¯ä¿¡æ¯ï¼Œå°†æˆæƒåœ°å€ã€æ ¡éªŒ token åœ°å€è¿”å›ç»™å‰ç«¯ å‰ç«¯é‡å®šå‘åˆ°æˆæƒé¡µé¢ æˆæƒåŒæ„ï¼Œåˆ™é‡å®šå‘åˆ°å®¢æˆ·ç«¯è¡¨ä¸­é…ç½®çš„é‡å®šå‘åœ°å€ /oauth2/code/{id}ï¼Œå¹¶é€šè¿‡ code å»è·å– tokenï¼Œæœ€åå†é‡å®šå‘åˆ°ç”¨æˆ·æŒ‡å®šçš„å›è°ƒåœ°å€ é‡æ–°æ¢³ç†ç”¨æˆ·ä¸­å¿ƒé¢†åŸŸæ¨¡å‹ã€‚\né¢†åŸŸæ¨¡å‹ï¼š\nå®¢æˆ·ç«¯ï¼Œå¯¹åº” OAuth ä¸­çš„å®¢æˆ·ç«¯çš„æ¦‚å¿µã€‚\nåº”ç”¨\nç§Ÿæˆ·\nç”¨æˆ·\nè§’è‰²\nèµ„æº\nåŒºåŸŸ\né—¨åº—\né¢†åŸŸæ¨¡å‹ä¹‹é—´çš„å…³ç³»è¯´æ˜ï¼š\nå®¢æˆ·ç«¯å’Œåº”ç”¨å¤šå¯¹çš„çš„å…³ç³»ï¼Œåº”ç”¨å’Œç§Ÿæˆ·æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ï¼Œç§Ÿæˆ·å’Œèµ„æºæ˜¯å¤šå¯¹å¤šçš„å…³ç³»ï¼Œåº”ç”¨å’Œèµ„æºä¸€å¯¹å¤šçš„å…³ç³»ã€‚ä¸ºäº†ç®€åŒ–æ“ä½œï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªä¸­é—´è¡¨ä¿å­˜å®¢æˆ·ç«¯ã€åº”ç”¨ã€ç§Ÿæˆ·ã€èµ„æºä¹‹é—´çš„å…³ç³»ã€‚ èµ„æºã€ç”¨æˆ·ã€è§’è‰²æ˜¯ RBAC æ¨¡å‹ã€‚è§’è‰²å’Œåº”ç”¨æ˜¯å¤šå¯¹ä¸€çš„å…³ç³»ï¼Œç§Ÿæˆ·å’Œè§’è‰²æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œå³è§’è‰²æ˜¯éš¶å±äºåº”ç”¨å’Œç§Ÿæˆ·ã€‚ä¸å¤ªåº”ç”¨çš„ä¸åŒç§Ÿæˆ·ä¸‹çš„è§’è‰²ä¸ä¸€æ ·ã€‚ ç§Ÿæˆ·å’ŒåŒºåŸŸæ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼ŒåŒºåŸŸå’Œé—¨åº—æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œé—¨åº—å’Œåº”ç”¨æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ã€‚ ç”¨æˆ·å’Œç§Ÿæˆ·æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ã€‚ æµç¨‹ï¼š\nç™»é™†ï¼šä½¿ç”¨ç”¨æˆ·åã€å¯†ç ã€å®¢æˆ·ç«¯ IDã€ç§Ÿæˆ· IDï¼ˆé¦–æ¬¡ç™»é™†æ—¶ä¸ºç©ºï¼Œå–ç”¨æˆ·æœ‰æƒé™çš„ç§Ÿæˆ·ä¸­çš„ç¬¬ä¸€ä¸ªï¼‰ ç™»é™†ã€‚é€šè¿‡ å®¢æˆ·ç«¯ IDã€ç§Ÿæˆ· ID ã€ç”¨æˆ·åæŸ¥è¯¢è¯¥ç”¨æˆ·çš„æƒé™ã€‚ ç™»é™†ä¹‹åï¼Œå†é€‰æ‹©ç§Ÿæˆ·è¿›å…¥é¦–é¡µã€‚ åˆ›å»ºå®¢æˆ·ç«¯ä¹‹åï¼Œå¯ä»¥ç»‘å®šåº”ç”¨ã€‚ åˆ›å»ºç§Ÿæˆ·æ—¶ï¼Œå¯ä»¥é€šè¿‡èµ„æºæ ‘ï¼ˆå®¢æˆ·ç«¯+åº”ç”¨+èµ„æºï¼‰å¼€é€šèµ„æºï¼Œå¯ä»¥ç»™ç§Ÿæˆ·å¼€é€šçš„åº”ç”¨å¼€é€šé—¨åº—ã€‚ ","title":"2023-12-28ï½œä»Šå¤©åšäº†ä»€ä¹ˆ"},{"content":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\nå¾®æœåŠ¡é¡¹ç›®ä¸­è®¤è¯æœåŠ¡å™¨é…ç½®æˆæƒç æ¨¡å¼ï¼Œå¹¶æµ‹è¯•é€šè¿‡\næ‰©å±• RedisAuthorizationCodeServices ï¼Œæ”¯æŒè®¾ç½®è¿‡æœŸæ—¶é—´ã€‚\næ³¨æ„ï¼šOAuth2Authentication æ— æ³•ä» json ååºåˆ—åŒ–ï¼Œæ•…æ— æ³•ä½¿ç”¨ JSON ååºåˆ—åŒ–ç±»ï¼Œåªèƒ½ä½¿ç”¨ JDK ååºåˆ—åŒ–ç±»ã€‚ æ‰©å±• BearerTokenExtractorï¼Œæ”¯æŒä» request è¯·æ±‚çš„ header ä¸­è¯»å– access_token\né…ç½® JWK token ä½¿ç”¨æ—¶\næ‰©å±• JwtAccessTokenConverter ï¼Œç”¨äºè§£æ jwks æ¥å£è¿”å›çš„ jsonï¼Œç›¸å…³è¯´æ˜å‚è€ƒ creating-the-jwk-set-endpoint JwkDefinitionSource ç±»ä¸­è·å– jwkSetUrls æ—¶ï¼Œä¸æ”¯æŒ url ä¸­é…ç½®æœåŠ¡åç§°ï¼Œå³ä¸æ”¯æŒè´Ÿè½½å‡è¡¡ã€‚æ•…ï¼Œé‡å†™è¯¥ç±»ä»¥æ”¯æŒé€šè¿‡ RestTemplate ï¼ˆå¯ä»¥æ³¨å…¥ä¸€ä¸ªæ”¯æŒè´Ÿè½½å‡è¡¡çš„ RestTemplateï¼‰ è§£æ jwkSetUrls è¿”å›çš„ json ç±»å‹çš„å­—ç¬¦ä¸²ï¼›åˆ›å»ºäº†ä¸€ä¸ªæ”¯æŒè´Ÿè½½å‡è¡¡çš„ TokenStoreã€‚ è¿è¡Œ xuxiaowei-cloud é¡¹ç›®æ—¶\næç¤º Rollup failed to resolve import \u0026quot;@vue/shared\u0026quot;ï¼ŒåŸå› ï¼šè¿™ä¸ªé”™è¯¯æ˜¯ç”±äºæ— æ³•è§£æåˆ° @vue/shared è¿™ä¸ªåŒ…å¯¼è‡´çš„ã€‚@vue/shared æ˜¯ Vue å†…éƒ¨ä½¿ç”¨çš„ä¸€ä¸ªå…±äº«å·¥å…·åº“ã€‚è§£å†³æ–¹æ¡ˆï¼šå°† @vue/shared æ·»åŠ åˆ°é¡¹ç›®çš„ä¾èµ–ä¸­ã€‚\nnpm install --save @vue/shared Controller çš„æ–¹æ³•ä¸Šæ·»åŠ æ³¨è§£åˆ¤æ–­æ˜¯å¦æœ‰æƒé™ï¼Œä¾‹å­ï¼š@PreAuthorize(\u0026quot;hasAuthority('manage_user_authority') or #oauth2.hasScope('manage_user_authority')\u0026quot;)\nPrincipal ä¸­çš„ç”¨æˆ·å¯¹è±¡ï¼Œå³ UserDetails å¯¹è±¡ä¸æ·»åŠ é¢å¤–å­—æ®µï¼Œåªæœ‰ usernameï¼Œå¦‚æœæƒ³è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œéœ€è¦é€šè¿‡ç”¨æˆ·æœåŠ¡å»æŸ¥è¯¢ã€‚\nå…³äº OAuth2 çš„å‚è€ƒèµ„æ–™ï¼š\nOauth2.0æ­å»ºé—®é¢˜è®°å½•\nOAuth 2.0 å®æˆ˜\nå…³äº Spring Cloud é›†æˆ OAuth2 çš„å‚è€ƒä»“åº“ï¼š\nhttps://gitee.com/youlaitech/youlai-mall\nhttps://gitee.com/dromara/RuoYi-Cloud-Plus\nhttps://gitee.com/dromara/open-capacity-platform/\n","permalink":"https://blog.chensoul.cc/posts/2023/12/27/til/","summary":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\nå¾®æœåŠ¡é¡¹ç›®ä¸­è®¤è¯æœåŠ¡å™¨é…ç½®æˆæƒç æ¨¡å¼ï¼Œå¹¶æµ‹è¯•é€šè¿‡\næ‰©å±• RedisAuthorizationCodeServices ï¼Œæ”¯æŒè®¾ç½®è¿‡æœŸæ—¶é—´ã€‚\næ³¨æ„ï¼šOAuth2Authentication æ— æ³•ä» json ååºåˆ—åŒ–ï¼Œæ•…æ— æ³•ä½¿ç”¨ JSON ååºåˆ—åŒ–ç±»ï¼Œåªèƒ½ä½¿ç”¨ JDK ååºåˆ—åŒ–ç±»ã€‚ æ‰©å±• BearerTokenExtractorï¼Œæ”¯æŒä» request è¯·æ±‚çš„ header ä¸­è¯»å– access_token\né…ç½® JWK token ä½¿ç”¨æ—¶\næ‰©å±• JwtAccessTokenConverter ï¼Œç”¨äºè§£æ jwks æ¥å£è¿”å›çš„ jsonï¼Œç›¸å…³è¯´æ˜å‚è€ƒ creating-the-jwk-set-endpoint JwkDefinitionSource ç±»ä¸­è·å– jwkSetUrls æ—¶ï¼Œä¸æ”¯æŒ url ä¸­é…ç½®æœåŠ¡åç§°ï¼Œå³ä¸æ”¯æŒè´Ÿè½½å‡è¡¡ã€‚æ•…ï¼Œé‡å†™è¯¥ç±»ä»¥æ”¯æŒé€šè¿‡ RestTemplate ï¼ˆå¯ä»¥æ³¨å…¥ä¸€ä¸ªæ”¯æŒè´Ÿè½½å‡è¡¡çš„ RestTemplateï¼‰ è§£æ jwkSetUrls è¿”å›çš„ json ç±»å‹çš„å­—ç¬¦ä¸²ï¼›åˆ›å»ºäº†ä¸€ä¸ªæ”¯æŒè´Ÿè½½å‡è¡¡çš„ TokenStoreã€‚ è¿è¡Œ xuxiaowei-cloud é¡¹ç›®æ—¶\næç¤º Rollup failed to resolve import \u0026quot;@vue/shared\u0026quot;ï¼ŒåŸå› ï¼šè¿™ä¸ªé”™è¯¯æ˜¯ç”±äºæ— æ³•è§£æåˆ° @vue/shared è¿™ä¸ªåŒ…å¯¼è‡´çš„ã€‚@vue/shared æ˜¯ Vue å†…éƒ¨ä½¿ç”¨çš„ä¸€ä¸ªå…±äº«å·¥å…·åº“ã€‚è§£å†³æ–¹æ¡ˆï¼šå°† @vue/shared æ·»åŠ åˆ°é¡¹ç›®çš„ä¾èµ–ä¸­ã€‚\nnpm install --save @vue/shared Controller çš„æ–¹æ³•ä¸Šæ·»åŠ æ³¨è§£åˆ¤æ–­æ˜¯å¦æœ‰æƒé™ï¼Œä¾‹å­ï¼š@PreAuthorize(\u0026quot;hasAuthority('manage_user_authority') or #oauth2.hasScope('manage_user_authority')\u0026quot;)\nPrincipal ä¸­çš„ç”¨æˆ·å¯¹è±¡ï¼Œå³ UserDetails å¯¹è±¡ä¸æ·»åŠ é¢å¤–å­—æ®µï¼Œåªæœ‰ usernameï¼Œå¦‚æœæƒ³è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œéœ€è¦é€šè¿‡ç”¨æˆ·æœåŠ¡å»æŸ¥è¯¢ã€‚\nå…³äº OAuth2 çš„å‚è€ƒèµ„æ–™ï¼š\nOauth2.0æ­å»ºé—®é¢˜è®°å½•\nOAuth 2.0 å®æˆ˜\nå…³äº Spring Cloud é›†æˆ OAuth2 çš„å‚è€ƒä»“åº“ï¼š\nhttps://gitee.com/youlaitech/youlai-mall\nhttps://gitee.com/dromara/RuoYi-Cloud-Plus\nhttps://gitee.com/dromara/open-capacity-platform/","title":"2023-12-27ï½œä»Šå¤©åšäº†ä»€ä¹ˆ"},{"content":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\næˆ‘ä½¿ç”¨çš„ Idea æ’ä»¶ã€‚\nspringdoc-openapi v1.7.0 ç¤ºä¾‹\nSpring Security OAuth Boot 2 Autoconfig è½¬æ¢æˆ maven é¡¹ç›®ï¼Œå¹¶æ·»åŠ ç¤ºä¾‹\nIdea 1ã€æ’ä»¶\nGenerateSerialVersionUIDï¼šè‡ªåŠ¨ç”Ÿæˆ serialVersionUID\nMicroProfile Starterï¼šåˆ›å»º MicroProfile å¾®æœåŠ¡åº”ç”¨\nEasy Javadocï¼šå¿«é€Ÿç”Ÿæˆ Javadoc\nå¿«æ·é”® ä½œç”¨åŸŸ è¯´æ˜ ctrl \\ ç±»ã€æ–¹æ³•ã€å±æ€§ï¼ˆå…‰æ ‡æ”¾ä¸Šé¢å°±è¡Œï¼Œä¸è¦åŒå‡»é€‰ä¸­ï¼ï¼‰ ç”Ÿæˆå½“å‰æ–‡æ¡£æ³¨é‡Š ctrl \\ é€‰ä¸­çš„ä¸­æ–‡ ç”Ÿæˆé€‰ä¸­çš„ä¸­æ–‡çš„è‹±æ–‡å‘½å ctrl \\ é€‰ä¸­çš„éä¸­æ–‡ å¼¹æ¡†å±•ç¤ºç¿»è¯‘ç»“æœ ctrl shift \\ ç±» ç”Ÿæˆå…¨éƒ¨æ–‡æ¡£æ³¨é‡Š .ignore\nMaven Helper\nMetricsReloaded\nMybatisX\nPlantUML Diagram Generator\nSave Actions Tool\nSequenceDiagram\nStringManipulation\nTranslation\nWakaTime\n2ã€å¿«æ·é”®\nå¤šä¸ªçª—å£ä¹‹å‰åˆ‡æ¢ï¼ŒMacOS å¿«æ·é”®ï¼šCommand + ~ springdoc-openapi v1.7.0 å°†é¡¹ç›®ä¸­ä½¿ç”¨çš„ swagger doc è¿ç§»åˆ° springdoc-openapi v1.7.0ï¼Œå…³äº springdoc çš„ä½¿ç”¨ï¼Œåœ¨ github ä¸Šåˆ›å»ºäº†ä¸€ä¸ªç¤ºä¾‹ä»“åº“ï¼š springdoc-examples\nSpring Security OAuth Boot 2 Autoconfig å°† Spring Security OAuth Boot 2 Autoconfig ä¿®æ”¹æˆ maven é¡¹ç›®ï¼Œå¹¶æ·»åŠ  samples ç¤ºä¾‹ã€‚ä¿®æ”¹åçš„é¡¹ç›®åœ°å€ï¼šhttps://github.com/chensoul/spring-security-oauth2-boot\n","permalink":"https://blog.chensoul.cc/posts/2023/12/22/til/","summary":"ä»Šå¤©åšäº†ä»€ä¹ˆï¼š\næˆ‘ä½¿ç”¨çš„ Idea æ’ä»¶ã€‚\nspringdoc-openapi v1.7.0 ç¤ºä¾‹\nSpring Security OAuth Boot 2 Autoconfig è½¬æ¢æˆ maven é¡¹ç›®ï¼Œå¹¶æ·»åŠ ç¤ºä¾‹\nIdea 1ã€æ’ä»¶\nGenerateSerialVersionUIDï¼šè‡ªåŠ¨ç”Ÿæˆ serialVersionUID\nMicroProfile Starterï¼šåˆ›å»º MicroProfile å¾®æœåŠ¡åº”ç”¨\nEasy Javadocï¼šå¿«é€Ÿç”Ÿæˆ Javadoc\nå¿«æ·é”® ä½œç”¨åŸŸ è¯´æ˜ ctrl \\ ç±»ã€æ–¹æ³•ã€å±æ€§ï¼ˆå…‰æ ‡æ”¾ä¸Šé¢å°±è¡Œï¼Œä¸è¦åŒå‡»é€‰ä¸­ï¼ï¼‰ ç”Ÿæˆå½“å‰æ–‡æ¡£æ³¨é‡Š ctrl \\ é€‰ä¸­çš„ä¸­æ–‡ ç”Ÿæˆé€‰ä¸­çš„ä¸­æ–‡çš„è‹±æ–‡å‘½å ctrl \\ é€‰ä¸­çš„éä¸­æ–‡ å¼¹æ¡†å±•ç¤ºç¿»è¯‘ç»“æœ ctrl shift \\ ç±» ç”Ÿæˆå…¨éƒ¨æ–‡æ¡£æ³¨é‡Š .ignore\nMaven Helper\nMetricsReloaded\nMybatisX\nPlantUML Diagram Generator\nSave Actions Tool\nSequenceDiagram\nStringManipulation\nTranslation\nWakaTime\n2ã€å¿«æ·é”®\nå¤šä¸ªçª—å£ä¹‹å‰åˆ‡æ¢ï¼ŒMacOS å¿«æ·é”®ï¼šCommand + ~ springdoc-openapi v1.7.0 å°†é¡¹ç›®ä¸­ä½¿ç”¨çš„ swagger doc è¿ç§»åˆ° springdoc-openapi v1.7.0ï¼Œå…³äº springdoc çš„ä½¿ç”¨ï¼Œåœ¨ github ä¸Šåˆ›å»ºäº†ä¸€ä¸ªç¤ºä¾‹ä»“åº“ï¼š springdoc-examples\nSpring Security OAuth Boot 2 Autoconfig å°† Spring Security OAuth Boot 2 Autoconfig ä¿®æ”¹æˆ maven é¡¹ç›®ï¼Œå¹¶æ·»åŠ  samples ç¤ºä¾‹ã€‚ä¿®æ”¹åçš„é¡¹ç›®åœ°å€ï¼šhttps://github.com/chensoul/spring-security-oauth2-boot","title":"2023-12-22ï½œä»Šå¤©åšäº†ä»€ä¹ˆ"},{"content":"Today I Learned. ä»Šå¤©åˆ†äº«å†…å®¹ï¼šSpring Security å¯¹ OAuth2 çš„æ”¯æŒ\nSpring Security æä¾›äº†å¯¹ OAuth çš„æ”¯æŒï¼Œå¹¶ä¸”æœ‰å‡ ä¸ªç›¸å…³çš„é¡¹ç›®å¯ä»¥ç”¨äºå®ç° OAuth åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ Spring Security OAuth é¡¹ç›®åŠå…¶ç›¸å…³ä¿¡æ¯ï¼š\nSpring Security OAuthï¼ˆhttps://github.com/spring-attic/spring-security-oauthï¼‰ï¼šå®˜æ–¹æä¾›çš„ Spring Security OAuth é¡¹ç›®ï¼Œä¸º Spring åº”ç”¨ç¨‹åºæä¾›äº† OAuth 1.0 å’Œ OAuth 2.0 çš„æ”¯æŒã€‚è¯¥é¡¹ç›®åœ¨ Spring Security 5.x ç‰ˆæœ¬åå·²ä¸å†ç»´æŠ¤ï¼Œå»ºè®®ä½¿ç”¨åç»­æåˆ°çš„ Spring Authorization Serverã€‚ Spring Security 5ï¼ˆhttps://github.com/spring-attic/spring-securityï¼‰ï¼šSpring Security 5.x ç‰ˆæœ¬å¼€å§‹å°† OAuth 2.0 å®¢æˆ·ç«¯æ”¯æŒé›†æˆåˆ°æ ¸å¿ƒåº“ä¸­ï¼Œä½¿å¾—åœ¨ Spring Security ä¸­å®ç° OAuth 2.0 è®¤è¯å˜å¾—æ›´åŠ ç®€å•ã€‚ä½ å¯ä»¥ä½¿ç”¨ Spring Security 5.x ä»¥åŠåç»­ç‰ˆæœ¬æ¥å®ç° OAuth 2.0 å®¢æˆ·ç«¯åŠŸèƒ½ã€‚ Spring Security OAuth2 Bootï¼ˆhttps://github.com/spring-attic/spring-security-oauth2-bootï¼‰ï¼Œè¯¥é¡¹ç›®æ˜¯ spring-attic ç»„ç»‡ç»´æŠ¤çš„ï¼Œæä¾›äº† Spring Boot 2 å’Œæ—§ç‰ˆ Spring Security OAuth çš„è‡ªåŠ¨é…ç½®ã€‚è¯¥é¡¹ç›®å·²ç»åœæ­¢äº†æ´»è·ƒçš„å¼€å‘å’Œæ›´æ–°ï¼Œæœ€æ–°çš„æäº¤æ—¥æœŸæ˜¯ 2022 å¹´ 5 æœˆ 20 æ—¥ã€‚ Spring Authorization Serverï¼ˆhttps://github.com/spring-projects/spring-authorization-serverï¼‰ï¼šå®˜æ–¹æä¾›çš„ç”¨äºæ„å»º OAuth 2.0 æˆæƒæœåŠ¡å™¨çš„å®éªŒæ€§é¡¹ç›®ã€‚å®ƒæ˜¯ Spring Security 5.3 ä¹‹åæ¨å‡ºçš„æ›¿ä»£æ–¹æ¡ˆï¼Œæ—¨åœ¨æä¾›æ›´ç®€åŒ–å’Œçµæ´»çš„ OAuth 2.0 æˆæƒæœåŠ¡å™¨åŠŸèƒ½ã€‚ Authorization Server\nç›®å‰ï¼ŒSpring Security ä¸æ”¯æŒå®ç° OAuth 2.0 æˆæƒæœåŠ¡å™¨ã€‚ ä½†æ˜¯ï¼Œæ­¤åŠŸèƒ½å¯ä» Spring Security OAuth é¡¹ç›®ä¸­è·å¾—ï¼Œè¯¥é¡¹ç›®æœ€ç»ˆå°†è¢« Spring Security å®Œå…¨å–ä»£ã€‚ åœ¨æ­¤ä¹‹å‰ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¯¥ spring-security-oauth2-autoconfigure æ¨¡å—è½»æ¾è®¾ç½® OAuth 2.0 æˆæƒæœåŠ¡å™¨ï¼›æœ‰å…³è¯´æ˜ï¼Œè¯·å‚é˜…å…¶ æ–‡æ¡£ã€‚ Spring OAuth 2.0 Spring Security OAuth Boot Spring Cloud Security Spring OAuth 2.1 ä»“åº“åœ°å€ spring-security-oauth spring-security-oauth2-boot spring-cloud-security spring-authorization-server æ˜¯å¦æ›´æ–° 2022å¹´6æœˆ1æ—¥å½’æ¡£ 2022å¹´5æœˆ31æ—¥å½’æ¡£ 2022å¹´4æœˆ4æ—¥å½’æ¡£ æœ€æ–°ç‰ˆæœ¬ 2.5.2.RELEASE 2.6.8 2.2.5 1.2.1 æˆæƒæ–¹å¼ æˆæƒç  å®¢æˆ·å‡­è¯ æˆæƒç  å®¢æˆ·ç«¯å‡­æ® éšå¼ å¯†ç  è®¾å¤‡æˆæƒ JDK 8 æ”¯æŒï¼Œæ¥å£å·²å…¨é¢åºŸå¼ƒ 1.0 ä¹‹å‰çš„ç‰ˆæœ¬æ”¯æŒï¼ˆ0.3.0 ä»…æ”¯æŒ JDK 11ï¼‰ JDK 11 æ”¯æŒï¼Œæ¥å£å·²å…¨é¢åºŸå¼ƒ 1.0 ä¹‹å‰çš„ç‰ˆæœ¬æ”¯æŒ JDK 17 ä¸æ”¯æŒ 1.0 ä¹‹åçš„ç‰ˆæœ¬æ”¯æŒ å‚è€ƒ https://github.com/spring-projects/spring-security/wiki/OAuth-2.0-Features-Matrix\n1ã€Spring Security ä¸­ OAuth 2.0 æ”¯æŒçš„æœªæ¥æ˜¯ä»€ä¹ˆï¼Ÿ\nSpring Security 5.0 å¼•å…¥äº†å¯¹ OAuth 2.0 æˆæƒæ¡†æ¶å’Œ OpenID Connect 1.0 çš„æ–°å®¢æˆ·ç«¯æ”¯æŒã€‚Spring Security 5.1 å¼•å…¥äº†æ–°çš„èµ„æºæœåŠ¡å™¨æ”¯æŒä»¥åŠå¯¹ä¸åŒæˆæƒç±»å‹çš„é¢å¤–å®¢æˆ·ç«¯æ”¯æŒã€‚Spring Security 5.2å»¶ç»­äº†è¿™ä¸€æ¨¡å¼ï¼Œä¸ºèµ„æºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æä¾›äº†æ›´å¤šæ”¯æŒã€‚\n2ã€Spring Security OAuth 2.3+ ä¸­æ˜¯å¦å®ç°äº†æ–°åŠŸèƒ½ï¼Ÿ\næˆ‘ä»¬å°†æä¾›é”™è¯¯/å®‰å…¨ä¿®å¤å¹¶è€ƒè™‘æ·»åŠ è¾ƒå°çš„å¢å¼ºåŠŸèƒ½ã€‚æˆ‘ä»¬æœªæ¥çš„è®¡åˆ’æ˜¯å°† Spring Security OAuth ä¸­å½“å‰çš„æ‰€æœ‰åŠŸèƒ½æ„å»ºåˆ° Spring Security 5.x ä¸­ã€‚åœ¨ Spring Security è¾¾åˆ°ä¸ Spring Security OAuth åŒç­‰çš„åŠŸèƒ½åï¼Œæˆ‘ä»¬å°†ç»§ç»­æ”¯æŒé”™è¯¯å’Œå®‰å…¨ä¿®å¤è‡³å°‘ä¸€å¹´ã€‚\n3ã€Spring Boot 2.0 æ˜¯å¦æä¾›å¯¹ Spring Security OAuth çš„æ”¯æŒï¼Ÿ\nSpring Boot 2.0 å·²æ”¾å¼ƒå¯¹ Spring Security OAuth çš„æ”¯æŒã€‚ä½†æ˜¯ï¼Œå®ƒåœ¨ Spring Security 5 ä¸­æä¾›äº†å¯¹ OAuth 2.0 Loginã€OAuth 2.0 Client å’Œ OAuth 2.0 Resource Server çš„æ”¯æŒã€‚\n4ã€æœ‰æ²¡æœ‰åŠæ³•åœ¨ Spring Boot 2.0 ä¸­é›†æˆ Spring Security OAuthï¼Ÿ\nSpring Security OAuth Boot 2 Autoconfigé¡¹ç›®æ˜¯ Spring Boot 1.5.x ä¸­åŒ…å«çš„ Spring Security OAuth è‡ªåŠ¨é…ç½®çš„ç«¯å£ã€‚å¦‚æœæ‚¨æƒ³åœ¨ Spring Boot 2.0 ä¸­ä½¿ç”¨ Spring Security OAuthï¼Œåˆ™å¿…é¡»åœ¨é¡¹ç›®ä¸­æ˜¾å¼åŒ…å«ä»¥ä¸‹ä¾èµ–é¡¹ï¼š\nç»„ID: org.springframework.security.oauth.boot å·¥ä»¶IDï¼š spring-security-oauth2-autoconfigure æˆ‘åˆ›å»ºäº†ä¸€ä¸ªé¡¹ç›® spring-security-oauth2-legacyï¼Œä½¿ç”¨ Spring Security OAuth2 Boot æ¥è‡ªåŠ¨è£…é…èµ„æºæœåŠ¡å™¨ã€‚ç›®å‰ï¼Œè¿˜åœ¨æµ‹è¯•ä¸­ã€‚\nå¦‚æœæƒ³åŸºäº spring-authorization-server åˆ›å»ºè®¤è¯æœåŠ¡å™¨å’Œèµ„æºæœåŠ¡å™¨ï¼Œå¯ä»¥å‚è€ƒ github ä¸Šè¿™ä¸ªä»“åº“ï¼šxuxiaowei-cloudã€‚\nå…¶ main åˆ†æ”¯åŸºäº JDK 8/11ã€Spring Boot 2.7.xã€OAuth 2.1ã€Vite 4ã€Vue 3ã€Element Plus çš„å¾®æœåŠ¡ã€‚æ”¯æŒæ”¯ä»˜å®ã€é’‰é’‰ã€ç äº‘ã€QQã€å¾®ä¿¡ã€ä¼ä¸šå¾®ä¿¡ã€å¾®åšç­‰ç¬¬ä¸‰æ–¹ç™»å½•ã€‚åŒ…å«åŸºäº GitLab Runner çš„ kubernetesï¼ˆk8sï¼‰ã€Dockerã€Shell ç­‰ CI/CD æµæ°´çº¿è¿›è¡Œè‡ªåŠ¨æ„å»ºã€åˆ¶ä½œ Docker é•œåƒã€å‘å¸ƒã€‚æ°¸ä¹…å…è´¹å¼€æºã€‚\nå…¶archive/OAuth2.0 åˆ†æ”¯æ˜¯åŸºäº spring-security-oauth2-boot å®ç°çš„ï¼Œå¯ä»¥å‚è€ƒä»£ç ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/12/21/til/","summary":"Today I Learned. ä»Šå¤©åˆ†äº«å†…å®¹ï¼šSpring Security å¯¹ OAuth2 çš„æ”¯æŒ\nSpring Security æä¾›äº†å¯¹ OAuth çš„æ”¯æŒï¼Œå¹¶ä¸”æœ‰å‡ ä¸ªç›¸å…³çš„é¡¹ç›®å¯ä»¥ç”¨äºå®ç° OAuth åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ Spring Security OAuth é¡¹ç›®åŠå…¶ç›¸å…³ä¿¡æ¯ï¼š\nSpring Security OAuthï¼ˆhttps://github.com/spring-attic/spring-security-oauthï¼‰ï¼šå®˜æ–¹æä¾›çš„ Spring Security OAuth é¡¹ç›®ï¼Œä¸º Spring åº”ç”¨ç¨‹åºæä¾›äº† OAuth 1.0 å’Œ OAuth 2.0 çš„æ”¯æŒã€‚è¯¥é¡¹ç›®åœ¨ Spring Security 5.x ç‰ˆæœ¬åå·²ä¸å†ç»´æŠ¤ï¼Œå»ºè®®ä½¿ç”¨åç»­æåˆ°çš„ Spring Authorization Serverã€‚ Spring Security 5ï¼ˆhttps://github.com/spring-attic/spring-securityï¼‰ï¼šSpring Security 5.x ç‰ˆæœ¬å¼€å§‹å°† OAuth 2.0 å®¢æˆ·ç«¯æ”¯æŒé›†æˆåˆ°æ ¸å¿ƒåº“ä¸­ï¼Œä½¿å¾—åœ¨ Spring Security ä¸­å®ç° OAuth 2.0 è®¤è¯å˜å¾—æ›´åŠ ç®€å•ã€‚ä½ å¯ä»¥ä½¿ç”¨ Spring Security 5.x ä»¥åŠåç»­ç‰ˆæœ¬æ¥å®ç° OAuth 2.0 å®¢æˆ·ç«¯åŠŸèƒ½ã€‚ Spring Security OAuth2 Bootï¼ˆhttps://github.com/spring-attic/spring-security-oauth2-bootï¼‰ï¼Œè¯¥é¡¹ç›®æ˜¯ spring-attic ç»„ç»‡ç»´æŠ¤çš„ï¼Œæä¾›äº† Spring Boot 2 å’Œæ—§ç‰ˆ Spring Security OAuth çš„è‡ªåŠ¨é…ç½®ã€‚è¯¥é¡¹ç›®å·²ç»åœæ­¢äº†æ´»è·ƒçš„å¼€å‘å’Œæ›´æ–°ï¼Œæœ€æ–°çš„æäº¤æ—¥æœŸæ˜¯ 2022 å¹´ 5 æœˆ 20 æ—¥ã€‚ Spring Authorization Serverï¼ˆhttps://github.com/spring-projects/spring-authorization-serverï¼‰ï¼šå®˜æ–¹æä¾›çš„ç”¨äºæ„å»º OAuth 2.0 æˆæƒæœåŠ¡å™¨çš„å®éªŒæ€§é¡¹ç›®ã€‚å®ƒæ˜¯ Spring Security 5.3 ä¹‹åæ¨å‡ºçš„æ›¿ä»£æ–¹æ¡ˆï¼Œæ—¨åœ¨æä¾›æ›´ç®€åŒ–å’Œçµæ´»çš„ OAuth 2.0 æˆæƒæœåŠ¡å™¨åŠŸèƒ½ã€‚ Authorization Server\nç›®å‰ï¼ŒSpring Security ä¸æ”¯æŒå®ç° OAuth 2.","title":"2023-12-21ï½œSpring Securityå¯¹OAuth2çš„æ”¯æŒåŠå®ç°æ–¹å¼"},{"content":"Today I Learned. ä»Šå¤©åˆ†äº«å†…å®¹ï¼šMavené…ç½®ç»§æ‰¿å’Œç”Ÿå‘½å‘¨æœŸã€æºç è¿è¡ŒNacos 2.3.0æ§åˆ¶å°\nMaven ç›¸å…³ Mavené…ç½®ç»§æ‰¿ ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„POMèŠ‚ç‚¹ï¼Œåœ¨å­é¡¹ç›®ä¸­å¯ä»¥ç»§æ‰¿æˆ–è¦†ç›–çˆ¶é¡¹ç›®çš„é…ç½®ï¼š\ngroupIdï¼ˆé¡¹ç›®ç»„IDï¼‰ï¼šå¦‚æœåœ¨å­é¡¹ç›®ä¸­æœªå®šä¹‰groupIdï¼Œåˆ™å°†ç»§æ‰¿çˆ¶é¡¹ç›®çš„groupIdã€‚\nversionï¼ˆé¡¹ç›®ç‰ˆæœ¬ï¼‰ï¼šå¦‚æœåœ¨å­é¡¹ç›®ä¸­æœªå®šä¹‰versionï¼Œåˆ™å°†ç»§æ‰¿çˆ¶é¡¹ç›®çš„versionã€‚\npropertiesï¼ˆå±æ€§ï¼‰ï¼šå­é¡¹ç›®å¯ä»¥ç»§æ‰¿çˆ¶é¡¹ç›®çš„å±æ€§å®šä¹‰ï¼Œå¹¶åœ¨å­é¡¹ç›®ä¸­ä½¿ç”¨ç›¸åŒçš„å±æ€§ã€‚\ndependenciesï¼ˆä¾èµ–é¡¹ï¼‰ï¼šå­é¡¹ç›®å¯ä»¥ç»§æ‰¿çˆ¶é¡¹ç›®çš„ä¾èµ–é¡¹é…ç½®ï¼ŒåŒ…æ‹¬ä¾èµ–çš„groupIdã€artifactIdå’Œversionç­‰ä¿¡æ¯ã€‚\ndependencyManagementï¼ˆä¾èµ–ç®¡ç†ï¼‰ï¼šåœ¨çˆ¶é¡¹ç›®çš„dependencyManagementèŠ‚ç‚¹ä¸­å®šä¹‰çš„ä¾èµ–ç‰ˆæœ¬å¯ä»¥è¢«å­é¡¹ç›®ç»§æ‰¿å’Œä½¿ç”¨ã€‚\nbuildï¼ˆæ„å»ºé…ç½®ï¼‰ï¼šå­é¡¹ç›®å¯ä»¥ç»§æ‰¿çˆ¶é¡¹ç›®çš„æ„å»ºé…ç½®ï¼ŒåŒ…æ‹¬æ’ä»¶é…ç½®ã€æ„å»ºç›®å½•ã€èµ„æºç›®å½•ç­‰ã€‚å­é¡¹ç›®å¯ä»¥è¦†ç›–æˆ–æ·»åŠ é¢å¤–çš„æ„å»ºé…ç½®ã€‚\nreportingï¼ˆæŠ¥å‘Šé…ç½®ï¼‰ï¼šå­é¡¹ç›®å¯ä»¥ç»§æ‰¿çˆ¶é¡¹ç›®çš„æŠ¥å‘Šé…ç½®ï¼ŒåŒ…æ‹¬æŠ¥å‘Šæ’ä»¶çš„é…ç½®ä¿¡æ¯ã€‚\nrepositoriesï¼ˆä»“åº“é…ç½®ï¼‰ï¼šå­é¡¹ç›®å¯ä»¥ç»§æ‰¿çˆ¶é¡¹ç›®çš„ä»“åº“é…ç½®ï¼Œç”¨äºä»æŒ‡å®šçš„ä»“åº“è§£æä¾èµ–ã€‚\nscmï¼ˆç‰ˆæœ¬æ§åˆ¶é…ç½®ï¼‰ï¼šå­é¡¹ç›®å¯ä»¥ç»§æ‰¿çˆ¶é¡¹ç›®çš„ scm èŠ‚ç‚¹ä¸­çš„é…ç½®ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿçš„ URLã€è¿æ¥å™¨ã€æ ‡ç­¾ç­‰ä¿¡æ¯ã€‚\nissueManagementï¼ˆé—®é¢˜ç®¡ç†é…ç½®ï¼‰ï¼šå­é¡¹ç›®å¯ä»¥ç»§æ‰¿çˆ¶é¡¹ç›®çš„ issueManagement èŠ‚ç‚¹ä¸­çš„é…ç½®ï¼ŒåŒ…æ‹¬é—®é¢˜è·Ÿè¸ªç³»ç»Ÿçš„ URLã€è¿æ¥å™¨ç­‰ä¿¡æ¯ã€‚\norganizationï¼ˆç»„ç»‡é…ç½®ï¼‰ï¼šå­é¡¹ç›®å¯ä»¥ç»§æ‰¿çˆ¶é¡¹ç›®çš„ organization èŠ‚ç‚¹ä¸­çš„é…ç½®ï¼ŒåŒ…æ‹¬ç»„ç»‡çš„åç§°ã€URL ç­‰ä¿¡æ¯ã€‚\ndevelopersï¼ˆå¼€å‘è€…é…ç½®ï¼‰ï¼šå­é¡¹ç›®å¯ä»¥ç»§æ‰¿çˆ¶é¡¹ç›®çš„ developers èŠ‚ç‚¹ä¸­çš„é…ç½®ï¼ŒåŒ…æ‹¬å¼€å‘è€…çš„å§“åã€é‚®ç®±ç­‰ä¿¡æ¯ã€‚\nlicensesï¼ˆè®¸å¯è¯é…ç½®ï¼‰ï¼šå­é¡¹ç›®å¯ä»¥ç»§æ‰¿çˆ¶é¡¹ç›®çš„ licenses èŠ‚ç‚¹ä¸­çš„é…ç½®ï¼ŒåŒ…æ‹¬è®¸å¯è¯çš„åç§°ã€URLã€åˆ†å‘æ–¹å¼ç­‰ä¿¡æ¯ã€‚\ninceptionYearå’Œurlè¿™ä¸¤ä¸ªèŠ‚ç‚¹åœ¨ Maven çš„ POM æ–‡ä»¶ä¸­æ— æ³•è¢«å­é¡¹ç›®ç»§æ‰¿ã€‚\ninceptionYearï¼šè¿™ä¸ªèŠ‚ç‚¹ç”¨äºæŒ‡å®šé¡¹ç›®çš„åˆå§‹å¹´ä»½ã€‚å®ƒé€šå¸¸ç”¨äºæä¾›é¡¹ç›®çš„åˆ›å»ºæˆ–å¼€å§‹æ—¥æœŸï¼Œä½†å®ƒä¸ä¼šè¢«å­é¡¹ç›®ç»§æ‰¿ã€‚æ¯ä¸ªå­é¡¹ç›®éœ€è¦åœ¨è‡ªå·±çš„ POM æ–‡ä»¶ä¸­æ˜¾å¼å®šä¹‰è‡ªå·±çš„inceptionYearã€‚ urlï¼šè¿™ä¸ªèŠ‚ç‚¹ç”¨äºæŒ‡å®šé¡¹ç›®çš„URLåœ°å€ï¼Œä¾‹å¦‚é¡¹ç›®çš„ä¸»é¡µæˆ–ç‰ˆæœ¬æ§åˆ¶ä»“åº“çš„URLã€‚ä¸inceptionYearç±»ä¼¼ï¼ŒurlèŠ‚ç‚¹ä¹Ÿä¸ä¼šè¢«å­é¡¹ç›®ç»§æ‰¿ã€‚æ¯ä¸ªå­é¡¹ç›®éœ€è¦åœ¨è‡ªå·±çš„ POM æ–‡ä»¶ä¸­æ˜¾å¼å®šä¹‰è‡ªå·±çš„urlã€‚ è¿™äº›èŠ‚ç‚¹é€šå¸¸æ˜¯é¡¹ç›®ç‰¹å®šçš„ä¿¡æ¯ï¼Œä¸å…·å¤‡è¢«ç»§æ‰¿çš„å±æ€§ï¼Œå› æ­¤æ¯ä¸ªå­é¡¹ç›®éƒ½éœ€è¦è‡ªè¡Œå®šä¹‰è¿™äº›èŠ‚ç‚¹ï¼Œä»¥æä¾›è‡ªå·±ç‹¬ç‰¹çš„é¡¹ç›®èµ·å§‹å¹´ä»½å’ŒURLåœ°å€ã€‚\nMavençš„ç”Ÿå‘½å‘¨æœŸ Mavençš„æ ‡å‡†ç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬ä¸‰ä¸ªä¸»è¦çš„ç”Ÿå‘½å‘¨æœŸï¼š\nCleanç”Ÿå‘½å‘¨æœŸï¼šç”¨äºæ¸…ç†é¡¹ç›®æ„å»ºäº§ç”Ÿçš„è¾“å‡ºï¼ŒåŒ…æ‹¬åˆ é™¤ç”Ÿæˆçš„ç›®å½•å’Œæ–‡ä»¶ã€‚ cleanï¼šæ¸…ç†é¡¹ç›®ï¼Œåˆ é™¤ç”Ÿæˆçš„ç›®å½•å’Œæ–‡ä»¶ã€‚ Defaultç”Ÿå‘½å‘¨æœŸï¼šç”¨äºæ„å»ºé¡¹ç›®çš„æ ¸å¿ƒç”Ÿå‘½å‘¨æœŸï¼Œæ¶µç›–äº†é¡¹ç›®çš„ç¼–è¯‘ã€æµ‹è¯•ã€æ‰“åŒ…ã€éƒ¨ç½²ç­‰ä¸»è¦é˜¶æ®µã€‚ validateï¼šéªŒè¯é¡¹ç›®æ˜¯å¦æ­£ç¡®ä¸”æ‰€æœ‰å¿…è¦ä¿¡æ¯å¯ç”¨ã€‚ compileï¼šç¼–è¯‘é¡¹ç›®çš„æºä»£ç ã€‚ testï¼šè¿è¡Œé¡¹ç›®çš„å•å…ƒæµ‹è¯•ã€‚ packageï¼šå°†ç¼–è¯‘åçš„ä»£ç æ‰“åŒ…æˆå¯åˆ†å‘çš„æ ¼å¼ï¼Œä¾‹å¦‚JARã€WARã€‚ installï¼šå°†æ‰“åŒ…çš„é¡¹ç›®å®‰è£…åˆ°æœ¬åœ°ä»“åº“ï¼Œä¾›å…¶ä»–é¡¹ç›®ä½¿ç”¨ã€‚ deployï¼šå°†æœ€ç»ˆçš„åŒ…å¤åˆ¶åˆ°è¿œç¨‹ä»“åº“ï¼Œä¾›å…¶ä»–å¼€å‘äººå‘˜å’Œé¡¹ç›®ä½¿ç”¨ã€‚ Siteç”Ÿå‘½å‘¨æœŸï¼šç”¨äºç”Ÿæˆé¡¹ç›®çš„ç«™ç‚¹æ–‡æ¡£ã€‚ siteï¼šç”Ÿæˆé¡¹ç›®çš„ç«™ç‚¹æ–‡æ¡£ã€‚ site-deployï¼šå°†ç”Ÿæˆçš„ç«™ç‚¹æ–‡æ¡£éƒ¨ç½²åˆ°è¿œç¨‹æœåŠ¡å™¨ã€‚ å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸï¼š\nvalidateï¼šéªŒè¯é¡¹ç›®æ˜¯å¦æ­£ç¡®ä¸”æ‰€æœ‰å¿…è¦ä¿¡æ¯å¯ç”¨ã€‚ initializeï¼šåˆå§‹åŒ–æ„å»ºç¯å¢ƒï¼Œä¾‹å¦‚è®¾ç½®æ„å»ºå±æ€§å’ŒåŠ è½½çˆ¶POMã€‚ generate-sourcesï¼šç”Ÿæˆé¡¹ç›®çš„æºä»£ç ï¼Œä¾‹å¦‚é€šè¿‡å¤„ç†æ³¨è§£æˆ–å…¶ä»–ç”Ÿæˆä»£ç çš„å·¥å…·ã€‚ process-sourcesï¼šå¤„ç†é¡¹ç›®çš„æºä»£ç ï¼Œä¾‹å¦‚å¯¹æºä»£ç è¿›è¡Œè¿‡æ»¤æˆ–è½¬æ¢ã€‚ generate-resourcesï¼šç”Ÿæˆé¡¹ç›®çš„èµ„æºæ–‡ä»¶ï¼Œä¾‹å¦‚æ‹·è´èµ„æºæ–‡ä»¶åˆ°ç›®æ ‡ç›®å½•ã€‚ process-resourcesï¼šå¤„ç†é¡¹ç›®çš„èµ„æºæ–‡ä»¶ï¼Œä¾‹å¦‚è¿‡æ»¤èµ„æºæ–‡ä»¶çš„å ä½ç¬¦ã€‚ compileï¼šç¼–è¯‘é¡¹ç›®çš„æºä»£ç ï¼Œå°†æºä»£ç ç¼–è¯‘ä¸ºå­—èŠ‚ç æ–‡ä»¶ï¼ˆ.classæ–‡ä»¶ï¼‰ã€‚ process-classesï¼šå¯¹ç¼–è¯‘åçš„ç±»æ–‡ä»¶è¿›è¡Œé¢å¤–çš„å¤„ç†ï¼Œä¾‹å¦‚ç”Ÿæˆé¢å¤–çš„èµ„æºæ–‡ä»¶ã€‚ generate-test-sourcesï¼šç”Ÿæˆé¡¹ç›®çš„æµ‹è¯•æºä»£ç ï¼Œä¾‹å¦‚é€šè¿‡å¤„ç†æ³¨è§£æˆ–å…¶ä»–ç”Ÿæˆä»£ç çš„å·¥å…·ã€‚ process-test-sourcesï¼šå¤„ç†é¡¹ç›®çš„æµ‹è¯•æºä»£ç ï¼Œä¾‹å¦‚å¯¹æµ‹è¯•æºä»£ç è¿›è¡Œè¿‡æ»¤æˆ–è½¬æ¢ã€‚ generate-test-resourcesï¼šç”Ÿæˆé¡¹ç›®çš„æµ‹è¯•èµ„æºæ–‡ä»¶ï¼Œä¾‹å¦‚æ‹·è´æµ‹è¯•èµ„æºæ–‡ä»¶åˆ°ç›®æ ‡ç›®å½•ã€‚ process-test-resourcesï¼šå¤„ç†é¡¹ç›®çš„æµ‹è¯•èµ„æºæ–‡ä»¶ï¼Œä¾‹å¦‚è¿‡æ»¤æµ‹è¯•èµ„æºæ–‡ä»¶çš„å ä½ç¬¦ã€‚ test-compileï¼šç¼–è¯‘é¡¹ç›®çš„æµ‹è¯•æºä»£ç ï¼Œå°†æµ‹è¯•æºä»£ç ç¼–è¯‘ä¸ºå­—èŠ‚ç æ–‡ä»¶ã€‚ process-test-classesï¼šå¯¹ç¼–è¯‘åçš„æµ‹è¯•ç±»æ–‡ä»¶è¿›è¡Œé¢å¤–çš„å¤„ç†ã€‚ testï¼šè¿è¡Œé¡¹ç›®çš„å•å…ƒæµ‹è¯•ã€‚ prepare-packageï¼šå‡†å¤‡æ‰“åŒ…é˜¶æ®µçš„ç›¸å…³å·¥ä½œï¼Œä¾‹å¦‚ç”Ÿæˆé¢å¤–çš„æ–‡ä»¶æˆ–èµ„æºã€‚ packageï¼šå°†é¡¹ç›®æ‰“åŒ…æˆå¯åˆ†å‘çš„æ ¼å¼ï¼Œä¾‹å¦‚JARã€WARç­‰ã€‚ pre-integration-testï¼šåœ¨é›†æˆæµ‹è¯•ä¹‹å‰æ‰§è¡Œçš„ä¸€äº›å‡†å¤‡å·¥ä½œã€‚ integration-testï¼šè¿è¡Œé¡¹ç›®çš„é›†æˆæµ‹è¯•ã€‚ post-integration-testï¼šåœ¨é›†æˆæµ‹è¯•ä¹‹åæ‰§è¡Œçš„ä¸€äº›æ¸…ç†å·¥ä½œã€‚ verifyï¼šéªŒè¯é¡¹ç›®çš„å®Œæ•´æ€§ï¼Œä¾‹å¦‚å¯¹ç”Ÿæˆçš„æŠ¥å‘Šè¿›è¡Œæ£€æŸ¥ã€‚ installï¼šå°†é¡¹ç›®çš„æ„ä»¶å®‰è£…åˆ°æœ¬åœ°ä»“åº“ï¼Œä¾›æœ¬åœ°å…¶ä»–é¡¹ç›®ä½¿ç”¨ã€‚ deployï¼šå°†é¡¹ç›®çš„æ„ä»¶å¤åˆ¶åˆ°è¿œç¨‹ä»“åº“ï¼Œä¾›å…¶ä»–å¼€å‘äººå‘˜å’Œé¡¹ç›®ä½¿ç”¨ã€‚ maven-compiler-plugin é—®é¢˜ github action çš„æœºå™¨äººå°† maven-compiler-plugin ç‰ˆæœ¬å‡çº§åˆ° 3.12.0 ï¼Œè¿è¡Œ test æ—¶å‡ºç°å¼‚å¸¸ï¼š\nbasedir /Users/chensoul/workspace/IdeaProjects/cocktail/cocktail-cloud/cocktail/cocktail-oauth2/target/generated-test-sources/test-annotations does not exist å°†ç‰ˆæœ¬é™åˆ° 3.12.0ï¼Œå°±æ­£å¸¸ã€‚\nGitHub ä¸Šç±»ä¼¼çš„é—®é¢˜ï¼š\nhttps://github.com/apache/maven-compiler-plugin/pull/191 æºç è¿è¡Œ Nacos 2.3.0 1ã€ä¸‹è½½æºä»£ç \ngit clone git@github.com:alibaba/nacos.git 2ã€æ‹·è´ console æ¨¡å—é‡Œé¢çš„ java å’Œ resources ç›®å½•å’Œ pom.xml ä»£ç åˆ°è‡ªå·±çš„é¡¹ç›®é‡Œé¢\n3ã€console æ¨¡å— pom.xml ä¸­æœ‰éƒ¨åˆ†ä¾èµ–æœ€æ–°ç‰ˆæœ¬æ²¡æœ‰å‘å¸ƒåˆ°ä¸­å¤®ä»“åº“ï¼Œå¯ä»¥æ‰‹åŠ¨éƒ¨ç½²åˆ°è‡ªå·±çš„ç§æœ‰ä»“åº“é‡Œé¢\ngit checkout master mvn deploy -DskipTests=true 4ã€ä¿®æ”¹ pom.xml ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªæ”¹åŠ¨ï¼š\nä¿®æ”¹ nacos.version ç‰ˆæœ¬ä¸º 2.3.0 ä¿®æ”¹ nacos ç›¸å…³ä¾èµ–çš„ groupId ä¸º com.alibaba.nacos ä¿®æ”¹ nacos-default-plugin-impl ä¸º nacos-default-plugin-all \u0026lt;properties\u0026gt; \u0026lt;nacos.version\u0026gt;2.3.0\u0026lt;/nacos.version\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.alibaba.nacos\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;nacos-sys\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${nacos.version}\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.alibaba.nacos\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;nacos-config\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${nacos.version}\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.alibaba.nacos\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;nacos-naming\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${nacos.version}\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.alibaba.nacos\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;nacos-client\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${nacos.version}\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.alibaba.nacos\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;nacos-default-plugin-all\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${nacos.version}\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.alibaba.nacos\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;nacos-prometheus\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${nacos.version}\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; 5ã€ä¿®æ”¹ application.properties é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“ã€‚å–æ¶ˆä»¥ä¸‹å‡ è¡Œçš„æ³¨é‡Šï¼Œå¹¶ä¿®æ”¹æ•°æ®åº“é…ç½®\nspring.sql.init.platform=mysql db.num=1 db.url.0=jdbc:mysql://${MYSQL_HOST:localhost}:${MYSQL_PORT:3306}/nacos_2.2.4?characterEncoding=utf8\u0026amp;connectTimeout=1000\u0026amp;socketTimeout=3000\u0026amp;autoReconnect=true\u0026amp;useUnicode=true\u0026amp;useSSL=false\u0026amp;serverTimezone=UTC db.user=${MYSQL_USER:root} db.password=${MYSQL_PASS:123456} 6ã€ä¿®æ”¹å¯åŠ¨ç±»ï¼Œè®¾ç½®å•æœºæ¨¡å¼å¯åŠ¨\nä¿®æ”¹ @SpringBootApplication æ³¨è§£ä¸º @SpringBootConfiguration åœ¨ main æ–¹æ³•é‡Œæ·»åŠ ä¸€è¡Œä»£ç ï¼šSystem.setProperty(Constants.STANDALONE_MODE_PROPERTY_NAME, \u0026quot;true\u0026quot;); ä¿®æ”¹ derby.log æ–‡ä»¶çš„è·¯å¾„ @SpringBootConfiguration @ComponentScan(basePackages = \u0026#34;com.alibaba.nacos\u0026#34;, excludeFilters = { @Filter(type = FilterType.CUSTOM, classes = {NacosTypeExcludeFilter.class}), @Filter(type = FilterType.CUSTOM, classes = {TypeExcludeFilter.class}), @Filter(type = FilterType.CUSTOM, classes = {AutoConfigurationExcludeFilter.class})}) @ServletComponentScan @EnableScheduling public class Nacos { public static void main(String[] args) { // é€šè¿‡ç¯å¢ƒå˜é‡çš„å½¢å¼ è®¾ç½® å•æœºå¯åŠ¨ System.setProperty(\u0026#34;nacos.standalone\u0026#34;, \u0026#34;true\u0026#34;); // ä¿®æ”¹derby.logæ–‡ä»¶çš„è·¯å¾„ System.setProperty(\u0026#34;derby.stream.error.file\u0026#34;, System.getProperty(\u0026#34;java.io.tmpdir\u0026#34;) + \u0026#34;/derby.log\u0026#34;); SpringApplication.run(Nacos.class, args); } } ","permalink":"https://blog.chensoul.cc/posts/2023/12/20/til/","summary":"Today I Learned. ä»Šå¤©åˆ†äº«å†…å®¹ï¼šMavené…ç½®ç»§æ‰¿å’Œç”Ÿå‘½å‘¨æœŸã€æºç è¿è¡ŒNacos 2.3.0æ§åˆ¶å°\nMaven ç›¸å…³ Mavené…ç½®ç»§æ‰¿ ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„POMèŠ‚ç‚¹ï¼Œåœ¨å­é¡¹ç›®ä¸­å¯ä»¥ç»§æ‰¿æˆ–è¦†ç›–çˆ¶é¡¹ç›®çš„é…ç½®ï¼š\ngroupIdï¼ˆé¡¹ç›®ç»„IDï¼‰ï¼šå¦‚æœåœ¨å­é¡¹ç›®ä¸­æœªå®šä¹‰groupIdï¼Œåˆ™å°†ç»§æ‰¿çˆ¶é¡¹ç›®çš„groupIdã€‚\nversionï¼ˆé¡¹ç›®ç‰ˆæœ¬ï¼‰ï¼šå¦‚æœåœ¨å­é¡¹ç›®ä¸­æœªå®šä¹‰versionï¼Œåˆ™å°†ç»§æ‰¿çˆ¶é¡¹ç›®çš„versionã€‚\npropertiesï¼ˆå±æ€§ï¼‰ï¼šå­é¡¹ç›®å¯ä»¥ç»§æ‰¿çˆ¶é¡¹ç›®çš„å±æ€§å®šä¹‰ï¼Œå¹¶åœ¨å­é¡¹ç›®ä¸­ä½¿ç”¨ç›¸åŒçš„å±æ€§ã€‚\ndependenciesï¼ˆä¾èµ–é¡¹ï¼‰ï¼šå­é¡¹ç›®å¯ä»¥ç»§æ‰¿çˆ¶é¡¹ç›®çš„ä¾èµ–é¡¹é…ç½®ï¼ŒåŒ…æ‹¬ä¾èµ–çš„groupIdã€artifactIdå’Œversionç­‰ä¿¡æ¯ã€‚\ndependencyManagementï¼ˆä¾èµ–ç®¡ç†ï¼‰ï¼šåœ¨çˆ¶é¡¹ç›®çš„dependencyManagementèŠ‚ç‚¹ä¸­å®šä¹‰çš„ä¾èµ–ç‰ˆæœ¬å¯ä»¥è¢«å­é¡¹ç›®ç»§æ‰¿å’Œä½¿ç”¨ã€‚\nbuildï¼ˆæ„å»ºé…ç½®ï¼‰ï¼šå­é¡¹ç›®å¯ä»¥ç»§æ‰¿çˆ¶é¡¹ç›®çš„æ„å»ºé…ç½®ï¼ŒåŒ…æ‹¬æ’ä»¶é…ç½®ã€æ„å»ºç›®å½•ã€èµ„æºç›®å½•ç­‰ã€‚å­é¡¹ç›®å¯ä»¥è¦†ç›–æˆ–æ·»åŠ é¢å¤–çš„æ„å»ºé…ç½®ã€‚\nreportingï¼ˆæŠ¥å‘Šé…ç½®ï¼‰ï¼šå­é¡¹ç›®å¯ä»¥ç»§æ‰¿çˆ¶é¡¹ç›®çš„æŠ¥å‘Šé…ç½®ï¼ŒåŒ…æ‹¬æŠ¥å‘Šæ’ä»¶çš„é…ç½®ä¿¡æ¯ã€‚\nrepositoriesï¼ˆä»“åº“é…ç½®ï¼‰ï¼šå­é¡¹ç›®å¯ä»¥ç»§æ‰¿çˆ¶é¡¹ç›®çš„ä»“åº“é…ç½®ï¼Œç”¨äºä»æŒ‡å®šçš„ä»“åº“è§£æä¾èµ–ã€‚\nscmï¼ˆç‰ˆæœ¬æ§åˆ¶é…ç½®ï¼‰ï¼šå­é¡¹ç›®å¯ä»¥ç»§æ‰¿çˆ¶é¡¹ç›®çš„ scm èŠ‚ç‚¹ä¸­çš„é…ç½®ï¼ŒåŒ…æ‹¬ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿçš„ URLã€è¿æ¥å™¨ã€æ ‡ç­¾ç­‰ä¿¡æ¯ã€‚\nissueManagementï¼ˆé—®é¢˜ç®¡ç†é…ç½®ï¼‰ï¼šå­é¡¹ç›®å¯ä»¥ç»§æ‰¿çˆ¶é¡¹ç›®çš„ issueManagement èŠ‚ç‚¹ä¸­çš„é…ç½®ï¼ŒåŒ…æ‹¬é—®é¢˜è·Ÿè¸ªç³»ç»Ÿçš„ URLã€è¿æ¥å™¨ç­‰ä¿¡æ¯ã€‚\norganizationï¼ˆç»„ç»‡é…ç½®ï¼‰ï¼šå­é¡¹ç›®å¯ä»¥ç»§æ‰¿çˆ¶é¡¹ç›®çš„ organization èŠ‚ç‚¹ä¸­çš„é…ç½®ï¼ŒåŒ…æ‹¬ç»„ç»‡çš„åç§°ã€URL ç­‰ä¿¡æ¯ã€‚\ndevelopersï¼ˆå¼€å‘è€…é…ç½®ï¼‰ï¼šå­é¡¹ç›®å¯ä»¥ç»§æ‰¿çˆ¶é¡¹ç›®çš„ developers èŠ‚ç‚¹ä¸­çš„é…ç½®ï¼ŒåŒ…æ‹¬å¼€å‘è€…çš„å§“åã€é‚®ç®±ç­‰ä¿¡æ¯ã€‚\nlicensesï¼ˆè®¸å¯è¯é…ç½®ï¼‰ï¼šå­é¡¹ç›®å¯ä»¥ç»§æ‰¿çˆ¶é¡¹ç›®çš„ licenses èŠ‚ç‚¹ä¸­çš„é…ç½®ï¼ŒåŒ…æ‹¬è®¸å¯è¯çš„åç§°ã€URLã€åˆ†å‘æ–¹å¼ç­‰ä¿¡æ¯ã€‚\ninceptionYearå’Œurlè¿™ä¸¤ä¸ªèŠ‚ç‚¹åœ¨ Maven çš„ POM æ–‡ä»¶ä¸­æ— æ³•è¢«å­é¡¹ç›®ç»§æ‰¿ã€‚\ninceptionYearï¼šè¿™ä¸ªèŠ‚ç‚¹ç”¨äºæŒ‡å®šé¡¹ç›®çš„åˆå§‹å¹´ä»½ã€‚å®ƒé€šå¸¸ç”¨äºæä¾›é¡¹ç›®çš„åˆ›å»ºæˆ–å¼€å§‹æ—¥æœŸï¼Œä½†å®ƒä¸ä¼šè¢«å­é¡¹ç›®ç»§æ‰¿ã€‚æ¯ä¸ªå­é¡¹ç›®éœ€è¦åœ¨è‡ªå·±çš„ POM æ–‡ä»¶ä¸­æ˜¾å¼å®šä¹‰è‡ªå·±çš„inceptionYearã€‚ urlï¼šè¿™ä¸ªèŠ‚ç‚¹ç”¨äºæŒ‡å®šé¡¹ç›®çš„URLåœ°å€ï¼Œä¾‹å¦‚é¡¹ç›®çš„ä¸»é¡µæˆ–ç‰ˆæœ¬æ§åˆ¶ä»“åº“çš„URLã€‚ä¸inceptionYearç±»ä¼¼ï¼ŒurlèŠ‚ç‚¹ä¹Ÿä¸ä¼šè¢«å­é¡¹ç›®ç»§æ‰¿ã€‚æ¯ä¸ªå­é¡¹ç›®éœ€è¦åœ¨è‡ªå·±çš„ POM æ–‡ä»¶ä¸­æ˜¾å¼å®šä¹‰è‡ªå·±çš„urlã€‚ è¿™äº›èŠ‚ç‚¹é€šå¸¸æ˜¯é¡¹ç›®ç‰¹å®šçš„ä¿¡æ¯ï¼Œä¸å…·å¤‡è¢«ç»§æ‰¿çš„å±æ€§ï¼Œå› æ­¤æ¯ä¸ªå­é¡¹ç›®éƒ½éœ€è¦è‡ªè¡Œå®šä¹‰è¿™äº›èŠ‚ç‚¹ï¼Œä»¥æä¾›è‡ªå·±ç‹¬ç‰¹çš„é¡¹ç›®èµ·å§‹å¹´ä»½å’ŒURLåœ°å€ã€‚\nMavençš„ç”Ÿå‘½å‘¨æœŸ Mavençš„æ ‡å‡†ç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬ä¸‰ä¸ªä¸»è¦çš„ç”Ÿå‘½å‘¨æœŸï¼š\nCleanç”Ÿå‘½å‘¨æœŸï¼šç”¨äºæ¸…ç†é¡¹ç›®æ„å»ºäº§ç”Ÿçš„è¾“å‡ºï¼ŒåŒ…æ‹¬åˆ é™¤ç”Ÿæˆçš„ç›®å½•å’Œæ–‡ä»¶ã€‚ cleanï¼šæ¸…ç†é¡¹ç›®ï¼Œåˆ é™¤ç”Ÿæˆçš„ç›®å½•å’Œæ–‡ä»¶ã€‚ Defaultç”Ÿå‘½å‘¨æœŸï¼šç”¨äºæ„å»ºé¡¹ç›®çš„æ ¸å¿ƒç”Ÿå‘½å‘¨æœŸï¼Œæ¶µç›–äº†é¡¹ç›®çš„ç¼–è¯‘ã€æµ‹è¯•ã€æ‰“åŒ…ã€éƒ¨ç½²ç­‰ä¸»è¦é˜¶æ®µã€‚ validateï¼šéªŒè¯é¡¹ç›®æ˜¯å¦æ­£ç¡®ä¸”æ‰€æœ‰å¿…è¦ä¿¡æ¯å¯ç”¨ã€‚ compileï¼šç¼–è¯‘é¡¹ç›®çš„æºä»£ç ã€‚ testï¼šè¿è¡Œé¡¹ç›®çš„å•å…ƒæµ‹è¯•ã€‚ packageï¼šå°†ç¼–è¯‘åçš„ä»£ç æ‰“åŒ…æˆå¯åˆ†å‘çš„æ ¼å¼ï¼Œä¾‹å¦‚JARã€WARã€‚ installï¼šå°†æ‰“åŒ…çš„é¡¹ç›®å®‰è£…åˆ°æœ¬åœ°ä»“åº“ï¼Œä¾›å…¶ä»–é¡¹ç›®ä½¿ç”¨ã€‚ deployï¼šå°†æœ€ç»ˆçš„åŒ…å¤åˆ¶åˆ°è¿œç¨‹ä»“åº“ï¼Œä¾›å…¶ä»–å¼€å‘äººå‘˜å’Œé¡¹ç›®ä½¿ç”¨ã€‚ Siteç”Ÿå‘½å‘¨æœŸï¼šç”¨äºç”Ÿæˆé¡¹ç›®çš„ç«™ç‚¹æ–‡æ¡£ã€‚ siteï¼šç”Ÿæˆé¡¹ç›®çš„ç«™ç‚¹æ–‡æ¡£ã€‚ site-deployï¼šå°†ç”Ÿæˆçš„ç«™ç‚¹æ–‡æ¡£éƒ¨ç½²åˆ°è¿œç¨‹æœåŠ¡å™¨ã€‚ å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸï¼š\nvalidateï¼šéªŒè¯é¡¹ç›®æ˜¯å¦æ­£ç¡®ä¸”æ‰€æœ‰å¿…è¦ä¿¡æ¯å¯ç”¨ã€‚ initializeï¼šåˆå§‹åŒ–æ„å»ºç¯å¢ƒï¼Œä¾‹å¦‚è®¾ç½®æ„å»ºå±æ€§å’ŒåŠ è½½çˆ¶POMã€‚ generate-sourcesï¼šç”Ÿæˆé¡¹ç›®çš„æºä»£ç ï¼Œä¾‹å¦‚é€šè¿‡å¤„ç†æ³¨è§£æˆ–å…¶ä»–ç”Ÿæˆä»£ç çš„å·¥å…·ã€‚ process-sourcesï¼šå¤„ç†é¡¹ç›®çš„æºä»£ç ï¼Œä¾‹å¦‚å¯¹æºä»£ç è¿›è¡Œè¿‡æ»¤æˆ–è½¬æ¢ã€‚ generate-resourcesï¼šç”Ÿæˆé¡¹ç›®çš„èµ„æºæ–‡ä»¶ï¼Œä¾‹å¦‚æ‹·è´èµ„æºæ–‡ä»¶åˆ°ç›®æ ‡ç›®å½•ã€‚ process-resourcesï¼šå¤„ç†é¡¹ç›®çš„èµ„æºæ–‡ä»¶ï¼Œä¾‹å¦‚è¿‡æ»¤èµ„æºæ–‡ä»¶çš„å ä½ç¬¦ã€‚ compileï¼šç¼–è¯‘é¡¹ç›®çš„æºä»£ç ï¼Œå°†æºä»£ç ç¼–è¯‘ä¸ºå­—èŠ‚ç æ–‡ä»¶ï¼ˆ.classæ–‡ä»¶ï¼‰ã€‚ process-classesï¼šå¯¹ç¼–è¯‘åçš„ç±»æ–‡ä»¶è¿›è¡Œé¢å¤–çš„å¤„ç†ï¼Œä¾‹å¦‚ç”Ÿæˆé¢å¤–çš„èµ„æºæ–‡ä»¶ã€‚ generate-test-sourcesï¼šç”Ÿæˆé¡¹ç›®çš„æµ‹è¯•æºä»£ç ï¼Œä¾‹å¦‚é€šè¿‡å¤„ç†æ³¨è§£æˆ–å…¶ä»–ç”Ÿæˆä»£ç çš„å·¥å…·ã€‚ process-test-sourcesï¼šå¤„ç†é¡¹ç›®çš„æµ‹è¯•æºä»£ç ï¼Œä¾‹å¦‚å¯¹æµ‹è¯•æºä»£ç è¿›è¡Œè¿‡æ»¤æˆ–è½¬æ¢ã€‚ generate-test-resourcesï¼šç”Ÿæˆé¡¹ç›®çš„æµ‹è¯•èµ„æºæ–‡ä»¶ï¼Œä¾‹å¦‚æ‹·è´æµ‹è¯•èµ„æºæ–‡ä»¶åˆ°ç›®æ ‡ç›®å½•ã€‚ process-test-resourcesï¼šå¤„ç†é¡¹ç›®çš„æµ‹è¯•èµ„æºæ–‡ä»¶ï¼Œä¾‹å¦‚è¿‡æ»¤æµ‹è¯•èµ„æºæ–‡ä»¶çš„å ä½ç¬¦ã€‚ test-compileï¼šç¼–è¯‘é¡¹ç›®çš„æµ‹è¯•æºä»£ç ï¼Œå°†æµ‹è¯•æºä»£ç ç¼–è¯‘ä¸ºå­—èŠ‚ç æ–‡ä»¶ã€‚ process-test-classesï¼šå¯¹ç¼–è¯‘åçš„æµ‹è¯•ç±»æ–‡ä»¶è¿›è¡Œé¢å¤–çš„å¤„ç†ã€‚ testï¼šè¿è¡Œé¡¹ç›®çš„å•å…ƒæµ‹è¯•ã€‚ prepare-packageï¼šå‡†å¤‡æ‰“åŒ…é˜¶æ®µçš„ç›¸å…³å·¥ä½œï¼Œä¾‹å¦‚ç”Ÿæˆé¢å¤–çš„æ–‡ä»¶æˆ–èµ„æºã€‚ packageï¼šå°†é¡¹ç›®æ‰“åŒ…æˆå¯åˆ†å‘çš„æ ¼å¼ï¼Œä¾‹å¦‚JARã€WARç­‰ã€‚ pre-integration-testï¼šåœ¨é›†æˆæµ‹è¯•ä¹‹å‰æ‰§è¡Œçš„ä¸€äº›å‡†å¤‡å·¥ä½œã€‚ integration-testï¼šè¿è¡Œé¡¹ç›®çš„é›†æˆæµ‹è¯•ã€‚ post-integration-testï¼šåœ¨é›†æˆæµ‹è¯•ä¹‹åæ‰§è¡Œçš„ä¸€äº›æ¸…ç†å·¥ä½œã€‚ verifyï¼šéªŒè¯é¡¹ç›®çš„å®Œæ•´æ€§ï¼Œä¾‹å¦‚å¯¹ç”Ÿæˆçš„æŠ¥å‘Šè¿›è¡Œæ£€æŸ¥ã€‚ installï¼šå°†é¡¹ç›®çš„æ„ä»¶å®‰è£…åˆ°æœ¬åœ°ä»“åº“ï¼Œä¾›æœ¬åœ°å…¶ä»–é¡¹ç›®ä½¿ç”¨ã€‚ deployï¼šå°†é¡¹ç›®çš„æ„ä»¶å¤åˆ¶åˆ°è¿œç¨‹ä»“åº“ï¼Œä¾›å…¶ä»–å¼€å‘äººå‘˜å’Œé¡¹ç›®ä½¿ç”¨ã€‚ maven-compiler-plugin é—®é¢˜ github action çš„æœºå™¨äººå°† maven-compiler-plugin ç‰ˆæœ¬å‡çº§åˆ° 3.12.0 ï¼Œè¿è¡Œ test æ—¶å‡ºç°å¼‚å¸¸ï¼š\nbasedir /Users/chensoul/workspace/IdeaProjects/cocktail/cocktail-cloud/cocktail/cocktail-oauth2/target/generated-test-sources/test-annotations does not exist å°†ç‰ˆæœ¬é™åˆ° 3.","title":"2023-12-20ï½œMavené…ç½®ç»§æ‰¿å’Œç”Ÿå‘½å‘¨æœŸã€æºç è¿è¡ŒNacos 2.3.0æ§åˆ¶å°"},{"content":"Today I Learned. ä»Šå¤©åˆ†äº«å†…å®¹ï¼šSpring Security OAuth2 é…ç½®JWTã€Github Actionsé…ç½®ä»£ç æ‰«æï¼Œå¦å¤–ï¼Œä¿®æ”¹äº† spring-security-oauth2-legacy ä»“åº“ï¼Œæ”¯æŒæˆæƒè®¤è¯ä¸­å¿ƒçš„å¤šç§é…ç½®æ–¹å¼ï¼ˆjdbcã€å†…å­˜ã€redisã€jwtï¼‰ã€èµ„æºä¸­å¿ƒçš„å¤šç§é…ç½®æ–¹å¼ï¼ˆjwtã€jdbcã€redisã€remoteã€jwk-set-uriï¼‰ã€‚\nSpring Security OAuth2 é…ç½®JWT ä½¿ç”¨ Spring Security å®ç°OAuth2 é…ç½® JWT éå¯¹ç§°åŠ å¯†æ—¶ï¼Œ JwtAccessTokenConverter è®¾ç½®ç”Ÿæˆç§é’¥ç­¾åå’Œå…¬é’¥éªŒè¯å™¨ï¼ˆå¯çœç•¥ï¼‰ã€‚\n@Bean public JwtAccessTokenConverter jwtAccessTokenConverter() { JwtAccessTokenConverter converter = new JwtAccessTokenConverter(); // è®¾ç½®ç§é’¥ç­¾å converter.setSigner(new RsaSigner((RSAPrivateKey) new RSA(\u0026#34;privateKey\u0026#34;, null).getPrivateKey())); // è®¾ç½®å…¬é’¥éªŒè¯å™¨ï¼Œå¯çœç•¥ converter.setVerifier(new RsaVerifier((RSAPublicKey) new RSA(null, \u0026#34;publicKey\u0026#34;).getPublicKey())); return jwtAccessTokenConverter; } æ³¨æ„ï¼šè¿™é‡Œä½¿ç”¨äº† Hutool çš„ RSA ä»å­—ç¬¦ä¸²ç”Ÿæˆ PrivateKey å’Œ PublicKey\nå»æ‰å¯¹ Hutool çš„ä¾èµ–ï¼Œåˆ™å¯ä»¥ä½¿ç”¨è‡ªå·±å®ç°çš„ RSAUtil ç±»ï¼š\npublic class RSAUtil { public static final String ALGORITHM_KEY = \u0026#34;RSA\u0026#34;; @SneakyThrows public static PrivateKey getPrivateKeyFromString(String privateKeyStr) { byte[] privateKeyBytes = Base64.getDecoder().decode(privateKeyStr.replaceAll(\u0026#34;\\n\u0026#34;, \u0026#34;\u0026#34;)); PKCS8EncodedKeySpec keySpec = new PKCS8EncodedKeySpec(privateKeyBytes); KeyFactory keyFactory = KeyFactory.getInstance(ALGORITHM_KEY); return keyFactory.generatePrivate(keySpec); } @SneakyThrows public static PublicKey getPublicKeyFromString(String publicKeyStr) { byte[] publicKeyBytes = Base64.getDecoder().decode(publicKeyStr.replaceAll(\u0026#34;\\n\u0026#34;, \u0026#34;\u0026#34;)); X509EncodedKeySpec keySpec = new X509EncodedKeySpec(publicKeyBytes); KeyFactory keyFactory = KeyFactory.getInstance(ALGORITHM_KEY); return keyFactory.generatePublic(keySpec); } } ç„¶åå°†ä¸Šé¢ä»£ç ä¿®æ”¹ä¸ºï¼š\n@Bean public JwtAccessTokenConverter jwtAccessTokenConverter() { JwtAccessTokenConverter converter = new JwtAccessTokenConverter(); //éå¯¹ç§°åŠ å¯† String privateKey = \u0026#34;\u0026#34;; String publicKey = \u0026#34;\u0026#34;; converter.setSigner(new RsaSigner((RSAPrivateKey) RSAUtil.getPrivateKeyFromString(privateKey))); // å¯çœç•¥å…¬é’¥ converter.setVerifier(new RsaVerifier((RSAPublicKey) RSAUtil.getPublicKeyFromString(publicKey))); return converter; } åœ¨æ’æŸ¥é”™è¯¯çš„è¿‡ç¨‹ä¸­ï¼ŒæŸ¥çœ‹ converter.setSigningKey() æ–¹æ³•ï¼Œnew RsaSigner(String sshKey) æ„é€ æ–¹æ³•å†…è°ƒç”¨äº† RsaKeyHelper çš„ parseKeyPair æ–¹æ³•ï¼Œè¯¥æ–¹æ³•éœ€è¦ä¼ å…¥çš„å­—ç¬¦ä¸²æ˜¯ \u0026ldquo;\u0026mdash;\u0026ndash;BEGIN RSA PRIVATE KEY\u0026rdquo; å¼€å¤´\nè€Œä¸‹é¢ä»£ç ä½¿ç”¨ keytool ç”Ÿæˆ JKS æ–‡ä»¶ç„¶åå¯¼å‡ºçš„ç§é’¥\u0026quot;\u0026mdash;\u0026ndash;BEGIN PRIVATE KEY\u0026quot; å¼€å¤´ã€‚\nç”Ÿæˆ JKS æ–‡ä»¶ keytool -genkeypair -alias myalias -storetype PKCS12 -keyalg RSA -keypass mypass -keystore mykeystore.jks -storepass mypass -validity 3650 å¯¼å‡ºå…¬é’¥ # ä¿å­˜ä¸º public.cer æ–‡ä»¶ï¼š keytool -exportcert -alias myalias -storepass mypass -keystore mykeystore.jks -file public.cer # ä¿å­˜ä¸º public.key æ–‡ä»¶ keytool -list -rfc --keystore mykeystore.jks -storepass mypass | openssl x509 -inform pem -pubkey \u0026gt; public.key å¯¼å‡ºç§é’¥ï¼Œå°†å…¶ä¿å­˜ä¸º private.key æ–‡ä»¶ï¼š keytool -importkeystore -srckeystore mykeystore.jks -srcstorepass mypass -destkeystore private.p12 -deststoretype PKCS12 -deststorepass mypass -destkeypass mypass openssl pkcs12 -in private.p12 -nodes -nocerts -out private.key äºæ˜¯ï¼Œæ‰¾åˆ°ä¸€ä¸ª RSA çš„ä»“åº“ https://github.com/xuxiaowei-com-cn/RSAï¼ŒFork ä¹‹åï¼Œå¯¹ä»£ç åšäº†ä¸€äº›ä¿®æ”¹ï¼š\nä¿®æ”¹ä»£ç åŒ…åä¸ºæˆ‘çš„åŸŸå com.chensoulï¼Œä»¥ä¾¿èƒ½å¤Ÿéƒ¨ç½²åˆ° sonatype ä»“åº“ã€‚ å»æ‰ Apache Common Codec ä¾èµ– ä¿®æ”¹ pom.xml ä¸­ä»“åº“ä¿¡æ¯ï¼Œå»æ‰æ³¨é‡Š Github Actionsé…ç½®ä»£ç æ‰«æ æäº¤ä»£ç åˆ°ä»“åº“ï¼Œå‘ç° Github Actions ä¸­æœ‰ä¸ª Workflow codeql-analysis.yml æ²¡æœ‰æ‰§è¡Œï¼Œäºæ˜¯åœ¨ä»“åº“ä¸­å¯ç”¨ Actionï¼Œå¹¶ä¸”ä¿®æ”¹ codeql-analysis.yml ä¸­ github/codeql-action/autobuild ç‰ˆæœ¬ä¸º v2ã€‚äºæ˜¯ï¼Œè¯¥ workflow å¯ä»¥æ­£å¸¸æ‰§è¡Œã€‚\nå‚è€ƒ Github Actions â€” Scan Codeï¼Œå¯ç”¨ Code scanning alerts ï¼Œå‘ç°æœ‰ä¸€ä¸ªä»£ç æ‰«æè­¦å‘Šï¼š\näºæ˜¯ï¼Œå‚ç…§ä¸Šé¢è¯´æ˜ï¼Œä¿®æ”¹ä»£ç ï¼Œå†æ¬¡æäº¤ä»£ç ï¼Œè¯¥è­¦å‘Šè‡ªåŠ¨å…³é—­ã€‚\nå¹²è„†æŠŠ Dependabot alerts ä¹Ÿå¯ç”¨äº†ï¼Œå¹¶ä¸­é…ç½®é¡µé¢å¯ç”¨ç›¸å…³é…ç½®ï¼š\nç‚¹å‡» .github/dependabot.yml ï¼Œä¿®æ”¹ package-ecosystem å€¼ä¸º mavenã€‚å› ä¸ºå½“å‰ä»“åº“æ˜¯ maven æ„å»ºï¼Œæ‰€ä»¥è¿™é‡Œè®¾ç½®ä¸º mavenã€‚\nä¿å­˜å¹¶æäº¤ä¿®æ”¹ã€‚æœºå™¨äººæ‰«æå‡ºäº”ä¸ªç‰ˆæœ¬éœ€è¦å‡çº§ï¼Œå¹¶è‡ªåŠ¨åˆ›å»ºäº†äº”ä¸ª Pull Requestã€‚\nåœ¨ä»“åº“çš„ Security é¡µé¢ï¼Œç‚¹å‡»å·¦ä¾§çš„ Code scanning\nç‚¹å‡» Add toolï¼Œå¯ä»¥æ·»åŠ æ›´å¤šä»£ç æ‰«æå·¥å…·ï¼Œæ€»å…±æœ‰ 70 ä¸ª æ‰«æå·¥å…·å¯ä»¥é€‰æ‹©ï¼Œå¦‚ï¼šSemgrepã€SonarQubeã€pmd ç­‰ç­‰ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/12/19/til/","summary":"Today I Learned. ä»Šå¤©åˆ†äº«å†…å®¹ï¼šSpring Security OAuth2 é…ç½®JWTã€Github Actionsé…ç½®ä»£ç æ‰«æï¼Œå¦å¤–ï¼Œä¿®æ”¹äº† spring-security-oauth2-legacy ä»“åº“ï¼Œæ”¯æŒæˆæƒè®¤è¯ä¸­å¿ƒçš„å¤šç§é…ç½®æ–¹å¼ï¼ˆjdbcã€å†…å­˜ã€redisã€jwtï¼‰ã€èµ„æºä¸­å¿ƒçš„å¤šç§é…ç½®æ–¹å¼ï¼ˆjwtã€jdbcã€redisã€remoteã€jwk-set-uriï¼‰ã€‚\nSpring Security OAuth2 é…ç½®JWT ä½¿ç”¨ Spring Security å®ç°OAuth2 é…ç½® JWT éå¯¹ç§°åŠ å¯†æ—¶ï¼Œ JwtAccessTokenConverter è®¾ç½®ç”Ÿæˆç§é’¥ç­¾åå’Œå…¬é’¥éªŒè¯å™¨ï¼ˆå¯çœç•¥ï¼‰ã€‚\n@Bean public JwtAccessTokenConverter jwtAccessTokenConverter() { JwtAccessTokenConverter converter = new JwtAccessTokenConverter(); // è®¾ç½®ç§é’¥ç­¾å converter.setSigner(new RsaSigner((RSAPrivateKey) new RSA(\u0026#34;privateKey\u0026#34;, null).getPrivateKey())); // è®¾ç½®å…¬é’¥éªŒè¯å™¨ï¼Œå¯çœç•¥ converter.setVerifier(new RsaVerifier((RSAPublicKey) new RSA(null, \u0026#34;publicKey\u0026#34;).getPublicKey())); return jwtAccessTokenConverter; } æ³¨æ„ï¼šè¿™é‡Œä½¿ç”¨äº† Hutool çš„ RSA ä»å­—ç¬¦ä¸²ç”Ÿæˆ PrivateKey å’Œ PublicKey\nå»æ‰å¯¹ Hutool çš„ä¾èµ–ï¼Œåˆ™å¯ä»¥ä½¿ç”¨è‡ªå·±å®ç°çš„ RSAUtil ç±»ï¼š\npublic class RSAUtil { public static final String ALGORITHM_KEY = \u0026#34;RSA\u0026#34;; @SneakyThrows public static PrivateKey getPrivateKeyFromString(String privateKeyStr) { byte[] privateKeyBytes = Base64.getDecoder().decode(privateKeyStr.replaceAll(\u0026#34;\\n\u0026#34;, \u0026#34;\u0026#34;)); PKCS8EncodedKeySpec keySpec = new PKCS8EncodedKeySpec(privateKeyBytes); KeyFactory keyFactory = KeyFactory.getInstance(ALGORITHM_KEY); return keyFactory.generatePrivate(keySpec); } @SneakyThrows public static PublicKey getPublicKeyFromString(String publicKeyStr) { byte[] publicKeyBytes = Base64.","title":"2023-12-19ï½œSpring Security OAuth2é…ç½®JWTã€Github Actionsé…ç½®ä»£ç æ‰«æ"},{"content":"Today I Learned. ä»Šå¤©åˆ†äº«å†…å®¹ï¼šä½¿ç”¨Spring Securityå®ç°OAuth2æˆæƒå’Œè®¤è¯ã€‚\næœ€è¿‘åœ¨å¼€å‘ Spring Cloud å¾®æœåŠ¡æ—¶ï¼Œéœ€è¦å¯¹ OAuth2 çš„å¼‚å¸¸å¤„ç†è¿›è¡Œå®šåˆ¶ï¼Œä»ç½‘ä¸Šæœåˆ°ä¸€ä¸ª github ä»“åº“ï¼šoauth2ã€‚è¿™ç¯‡ä»“åº“çš„ä»£ç å®ç°äº† OAuth2 çš„å››ç§æˆæƒæ¨¡å¼ã€I18N å›½é™…åŒ–ã€å¼‚å¸¸å¤„ç†ã€JWT Tokenï¼Œæˆ‘ fork äº†ä¸€ä»½ä»£ç ï¼Œåšäº†ä¸€äº›æ”¹åŠ¨ï¼Œå»æ‰äº† webfluxã€eureka ç›¸å…³ä»£ç ã€‚\nä»£ç ä»“åº“åœ°å€ï¼šhttps://github.com/chensoul/spring-security-oauth2-legacyï¼Œç›¸å…³ä¾èµ–çš„ç‰ˆæœ¬ï¼š\nspring-boot: 2.7.18 org.springframework.security.oauth:spring-security-oauth2-autoconfigure: 2.6.8 org.springframework.security.oauth:spring-security-oauth2: 2.5.2.RELEASE org.springframework.security:spring-security-jwt 1.1.1.RELEASE ç‰¹æ€§ ç»Ÿä¸€å¼‚å¸¸å¤„ç† å‚è€ƒspring securityçš„ ExceptionTranslationFilter ç±»\nå¼‚å¸¸å¤„ç†ç±» AccessDeniedHandler AuthenticationEntryPoint jwt keyç”Ÿæˆ ç”Ÿæˆ JKS æ–‡ä»¶ keytool -genkeypair -alias myalias -storetype PKCS12 -keyalg RSA -keypass mypass -keystore mykeystore.jks -storepass mypass -validity 3650 å¯¼å‡ºå…¬é’¥ # ä¿å­˜ä¸º public.cer æ–‡ä»¶ï¼š keytool -exportcert -alias myalias -storepass mypass -keystore mykeystore.jks -file public.cer # ä¿å­˜ä¸º public.key æ–‡ä»¶ keytool -list -rfc --keystore mykeystore.jks -storepass mypass | openssl x509 -inform pem -pubkey \u0026gt; public.key å¯¼å‡ºç§é’¥ï¼Œå°†å…¶ä¿å­˜ä¸º private.key æ–‡ä»¶ï¼š keytool -importkeystore -srckeystore mykeystore.jks -srcstorepass mypass -destkeystore private.p12 -deststoretype PKCS12 -deststorepass mypass -destkeypass mypass openssl pkcs12 -in private.p12 -nodes -nocerts -out private.key I18Nå›½é™…åŒ– å‚è€ƒ LocaleConfiguration ç±» æ”¯æŒ @Inner æ³¨è§£å®ç°å†…éƒ¨æ¥å£ä¸ç”¨è®¤è¯ å‚è€ƒä»¥ä¸‹ç±»ï¼š\nInner InnerAspect FeignOAuth2RequestInterceptor ResourceServerConfig PermitUrlProperties OAuth 2.0æˆæƒæ¨¡å¼ å¯†ç æ¨¡å¼ï¼ˆresource owner password credentialsï¼‰ æˆæƒç æ¨¡å¼ï¼ˆauthorization codeï¼‰ ç®€åŒ–æ¨¡å¼ï¼ˆimplicitï¼‰ å®¢æˆ·ç«¯æ¨¡å¼ï¼ˆclient credentialsï¼‰ å¯†ç æ¨¡å¼ï¼ˆresource owner password credentialsï¼‰ è¿™ç§æ¨¡å¼æ˜¯æœ€ä¸æ¨èçš„ï¼Œå› ä¸ºclientå¯èƒ½å­˜äº†ç”¨æˆ·å¯†ç  è¿™ç§æ¨¡å¼ä¸»è¦ç”¨æ¥åšé—ç•™é¡¹ç›®å‡çº§ä¸ºoauth2çš„é€‚é…æ–¹æ¡ˆ å½“ç„¶å¦‚æœclientæ˜¯è‡ªå®¶çš„åº”ç”¨ï¼Œä¹Ÿæ˜¯å¯ä»¥ æ”¯æŒrefresh token æˆæƒç æ¨¡å¼ï¼ˆauthorization codeï¼‰ è¿™ç§æ¨¡å¼ç®—æ˜¯æ­£å®—çš„oauth2çš„æˆæƒæ¨¡å¼ è®¾è®¡äº†auth codeï¼Œé€šè¿‡è¿™ä¸ªcodeå†è·å–token æ”¯æŒrefresh token ç®€åŒ–æ¨¡å¼ï¼ˆimplicitï¼‰ è¿™ç§æ¨¡å¼æ¯”æˆæƒç æ¨¡å¼å°‘äº†codeç¯èŠ‚ï¼Œå›è°ƒurlç›´æ¥æºå¸¦token è¿™ç§æ¨¡å¼çš„ä½¿ç”¨åœºæ™¯æ˜¯åŸºäºæµè§ˆå™¨çš„åº”ç”¨ è¿™ç§æ¨¡å¼åŸºäºå®‰å…¨æ€§è€ƒè™‘ï¼Œå»ºè®®æŠŠtokenæ—¶æ•ˆè®¾ç½®çŸ­ä¸€äº› ä¸æ”¯æŒrefresh token å®¢æˆ·ç«¯æ¨¡å¼ï¼ˆclient credentialsï¼‰ è¿™ç§æ¨¡å¼ç›´æ¥æ ¹æ®clientçš„idå’Œå¯†é’¥å³å¯è·å–tokenï¼Œæ— éœ€ç”¨æˆ·å‚ä¸ è¿™ç§æ¨¡å¼æ¯”è¾ƒåˆé€‚æ¶ˆè´¹apiçš„åç«¯æœåŠ¡ï¼Œæ¯”å¦‚æ‹‰å–ä¸€ç»„ç”¨æˆ·ä¿¡æ¯ç­‰ ä¸æ”¯æŒrefresh tokenï¼Œä¸»è¦æ˜¯æ²¡æœ‰å¿…è¦ å…³äºrefresh token refresh tokençš„åˆè¡·ä¸»è¦æ˜¯ä¸ºäº†ç”¨æˆ·ä½“éªŒä¸æƒ³ç”¨æˆ·é‡å¤è¾“å…¥è´¦å·å¯†ç æ¥æ¢å–æ–°tokenï¼Œå› è€Œè®¾è®¡äº†refresh tokenç”¨äºæ¢å–æ–°token è¿™ç§æ¨¡å¼ç”±äºæ²¡æœ‰ç”¨æˆ·å‚ä¸ï¼Œè€Œä¸”ä¹Ÿä¸éœ€è¦ç”¨æˆ·è´¦å·å¯†ç ï¼Œä»…ä»…æ ¹æ®è‡ªå·±çš„idå’Œå¯†é’¥å°±å¯ä»¥æ¢å–æ–°tokenï¼Œå› è€Œæ²¡å¿…è¦refresh token æˆæƒæ¥å£åŠç›¸å…³å‚æ•° æˆæƒæ¨¡å¼ è¯·æ±‚è·¯å¾„ è¯·æ±‚æ–¹æ³• è¯·æ±‚å¤´ è¯·æ±‚å‚æ•° ç”¨æˆ·åå¯†ç (password) /oauth/token post Content-Type:application/x-www-form-urlencoded grant_type:passwordusername:userpassword:123456scope:serverclient_id:clientclient_secret:secret å®¢æˆ·ç«¯å‡­è¯(client_credentials) /oauth/token post Content-Type:application/x-www-form-urlencoded grant_type:client_credentialsscope:userinfo resourceclient_id:clientclient_secret:secret å®¢æˆ·ç«¯æˆæƒç (authorization_code) /oauth/authorize get Content-Type:application/x-www-form-urlencoded response_type=code\u0026amp;scope=server\u0026amp;client_id=client\u0026amp;redirect_uri=https://www.taobao.com å®¢æˆ·ç«¯æˆæƒç (authorization_code) /oauth/authorize get Content-Type:application/x-www-form-urlencoded response_type:authorization_codecode:gE3Ekaredirect_uri:https://www.jd.comscope:server ç®€åŒ–æ¨¡å¼(implicit) /oauth/authorize get Content-Type:application/x-www-form-urlencoded response_type:tokenclient_id:clientredirect_uri:https://www.jd.comscope:server state:123456 å°ç»“ å¯†ç æ¨¡å¼ï¼ˆresource owner password credentialsï¼‰(ä¸ºé—ç•™ç³»ç»Ÿè®¾è®¡)(æ”¯æŒrefresh token) æˆæƒç æ¨¡å¼ï¼ˆauthorization codeï¼‰(æ­£å®—æ–¹å¼)(æ”¯æŒrefresh token) ç®€åŒ–æ¨¡å¼ï¼ˆimplicitï¼‰(ä¸ºwebæµè§ˆå™¨åº”ç”¨è®¾è®¡)(ä¸æ”¯æŒrefresh token) å®¢æˆ·ç«¯æ¨¡å¼ï¼ˆclient credentialsï¼‰(ä¸ºåå°apiæœåŠ¡æ¶ˆè´¹è€…è®¾è®¡)(ä¸æ”¯æŒrefresh token) å‚è€ƒèµ„æ–™ spring-security-oauth-samples å®˜æ–¹schema.sql ","permalink":"https://blog.chensoul.cc/posts/2023/12/18/til/","summary":"Today I Learned. ä»Šå¤©åˆ†äº«å†…å®¹ï¼šä½¿ç”¨Spring Securityå®ç°OAuth2æˆæƒå’Œè®¤è¯ã€‚\næœ€è¿‘åœ¨å¼€å‘ Spring Cloud å¾®æœåŠ¡æ—¶ï¼Œéœ€è¦å¯¹ OAuth2 çš„å¼‚å¸¸å¤„ç†è¿›è¡Œå®šåˆ¶ï¼Œä»ç½‘ä¸Šæœåˆ°ä¸€ä¸ª github ä»“åº“ï¼šoauth2ã€‚è¿™ç¯‡ä»“åº“çš„ä»£ç å®ç°äº† OAuth2 çš„å››ç§æˆæƒæ¨¡å¼ã€I18N å›½é™…åŒ–ã€å¼‚å¸¸å¤„ç†ã€JWT Tokenï¼Œæˆ‘ fork äº†ä¸€ä»½ä»£ç ï¼Œåšäº†ä¸€äº›æ”¹åŠ¨ï¼Œå»æ‰äº† webfluxã€eureka ç›¸å…³ä»£ç ã€‚\nä»£ç ä»“åº“åœ°å€ï¼šhttps://github.com/chensoul/spring-security-oauth2-legacyï¼Œç›¸å…³ä¾èµ–çš„ç‰ˆæœ¬ï¼š\nspring-boot: 2.7.18 org.springframework.security.oauth:spring-security-oauth2-autoconfigure: 2.6.8 org.springframework.security.oauth:spring-security-oauth2: 2.5.2.RELEASE org.springframework.security:spring-security-jwt 1.1.1.RELEASE ç‰¹æ€§ ç»Ÿä¸€å¼‚å¸¸å¤„ç† å‚è€ƒspring securityçš„ ExceptionTranslationFilter ç±»\nå¼‚å¸¸å¤„ç†ç±» AccessDeniedHandler AuthenticationEntryPoint jwt keyç”Ÿæˆ ç”Ÿæˆ JKS æ–‡ä»¶ keytool -genkeypair -alias myalias -storetype PKCS12 -keyalg RSA -keypass mypass -keystore mykeystore.jks -storepass mypass -validity 3650 å¯¼å‡ºå…¬é’¥ # ä¿å­˜ä¸º public.cer æ–‡ä»¶ï¼š keytool -exportcert -alias myalias -storepass mypass -keystore mykeystore.jks -file public.cer # ä¿å­˜ä¸º public.key æ–‡ä»¶ keytool -list -rfc --keystore mykeystore.jks -storepass mypass | openssl x509 -inform pem -pubkey \u0026gt; public.key å¯¼å‡ºç§é’¥ï¼Œå°†å…¶ä¿å­˜ä¸º private.key æ–‡ä»¶ï¼š keytool -importkeystore -srckeystore mykeystore.","title":"2023-12-18ï½œä½¿ç”¨Spring Securityå®ç°OAuth2æˆæƒå’Œè®¤è¯"},{"content":"Today I Learned. ä»Šå¤©åˆ†äº«å†…å®¹ï¼šJNDI InitialContextæºç åˆ†æã€ClassLoaderåŠ è½½æœºåˆ¶ã€‚\nJNDI InitialContext æºç åˆ†æ JNDIåŒ…ç»“æ„ javax.naming\nContext InitialContext Name CompositeName CompoundName NameImpl NameParser NamingEnumeration Referenceable RefAddr BinaryRefAddr StringRefAddr NameClassPair Binding Reference LinkRef javax.naming.directory\nAttribute\nBasicAttribute Attributes\nBasicAttributes DirContext\nInitialDirContext ModificationItem\nSearchControls\nSearchResult\njavax.naming.spi\nNamingManager DirectoryManager ObjectFactory DirObjectFactory ObjectFactoryBuilder StateFactory DirStateFactory InitialContextFactory InitialContextFactoryBuilder Resolver ContinuationContext ContinuationDirContext ResolveResult InitialContext æ„é€ æ–¹æ³• InitialContextçš„åˆå§‹åŒ–æœ‰å‡ ç§æ–¹å¼ï¼š\né€šè¿‡æ„é€ æ–¹æ³• é€šè¿‡ InitialContextFactory#getInitialContext é€šè¿‡åè®®è½¬æ¢åˆ›å»º InitialContext.getURLOrDefaultInitCtx(String name) ä¸€ä¸ª JNDI ç¤ºä¾‹ï¼š\npublic class DNSClient { public static void main(String[] args) { Hashtable\u0026lt;String, String\u0026gt; env = new Hashtable\u0026lt;\u0026gt;(); env.put(Context.INITIAL_CONTEXT_FACTORY, \u0026#34;com.sun.jndi.dns.DnsContextFactory\u0026#34;); env.put(Context.PROVIDER_URL, \u0026#34;dns://114.114.114.114\u0026#34;); try { DirContext ctx = new InitialDirContext(env); Attributes res = ctx.getAttributes(\u0026#34;example.com\u0026#34;, new String[]{\u0026#34;A\u0026#34;}); System.out.println(res); } catch (NamingException e) { e.printStackTrace(); } } } InitialDirContext æ„é€ æ–¹æ³•åˆå§‹åŒ–è¿‡ç¨‹ï¼š\nè°ƒç”¨ new InitialContext(Hashtable\u0026lt;?,?\u0026gt; environment)\nå¦‚æœ environment ä¸ä¸ºç©ºï¼Œåˆ™å…‹éš†ä¸€ä¸ª\nè°ƒç”¨ init(environment)\nè°ƒç”¨ ResourceManager.getInitialEnvironment(environment) è·å–åˆå§‹åŒ–çš„ç¯å¢ƒå˜é‡\nå¦‚æœå…¥å‚ä¸ºç©ºï¼Œåˆ™ new ä¸€ä¸ª Hashtable ï¼Œå¤§å° 11\nJNDI æœ‰7ä¸ªé¢„å®šä¹‰çš„å˜é‡ï¼Œkey å€¼å¦‚ä¸‹\njava.naming.factory.initial java.naming.factory.object java.naming.factory.state java.naming.factory.url.pkgs java.naming.provider.url java.naming.dns.url java.naming.factory.control å¦‚æœå®šä¹‰äº† java.naming.appletï¼Œåˆ™è°ƒç”¨ AppletParameter è·å–å˜é‡çš„å€¼ï¼›å¦åˆ™ä» System Properties ä¸­è·å–\nå¦‚æœå®šä¹‰äº† com.sun.naming.disable.app.resource.filesï¼Œä¸”è¯¥å˜é‡çš„å€¼ä¸º trueï¼Œå³ç¦ç”¨åº”ç”¨çš„èµ„æºæ–‡ä»¶ï¼Œåˆ™è¿”å›ï¼›å¦åˆ™è°ƒç”¨ ResourceManager.getApplicationResources() è¯»å–åº”ç”¨èµ„æºæ–‡ä»¶ï¼ˆå³ jndi.propertiesï¼‰å®šä¹‰çš„å˜é‡è°ƒç”¨ mergeTables æ–¹æ³•åˆå¹¶åˆ° environment\né€šè¿‡ classloader è¯»å–åº”ç”¨èµ„æºå³ jndi.properties æ–‡ä»¶å†…å®¹ï¼Œå¯èƒ½ä¼šè¯»å–åˆ°å¤šä¸ªï¼Œè¯»å–åˆ°ä¹‹ååˆå¹¶åˆ° environment é€šè¿‡ IO è¯»å– JavaHome çš„ lib ç›®å½•ä¸‹çš„ jndi.properties æ–‡ä»¶å†…å®¹ï¼Œç„¶ååˆå¹¶åˆ° environment mergeTables åˆå¹¶é€»è¾‘ï¼š å˜é‡æ–°çš„ environment çš„ keyï¼Œå¦‚æœæ—§çš„ environmentå¯¹åº” key çš„å€¼ä¸ºç©ºï¼Œåˆ™ä½¿ç”¨æ–°çš„å€¼ï¼›å¦‚æœä¸ä¸ºç©ºï¼Œå¹¶ä¸” key æ˜¯ JNDI é¢„å®šä¹‰çš„ java.naming.factory.objectã€java.naming.factory.url.pkgsã€java.naming.factory.stateã€java.naming.factory.controlï¼Œåˆ™ä½¿ç”¨å†’å·è¿æ¥æ–°æ—§çš„å€¼ã€‚ç›¸å½“äºåˆ™å‡ ä¸ªå€¼çš„å±æ€§å¯ä»¥é…ç½®å¤šä¸ªå€¼ã€‚ å¦‚æœ java.naming.factory.initial ä¸ä¸ºç©ºï¼Œåˆ™è°ƒç”¨ getDefaultInitCtx() åˆå§‹åŒ–é»˜è®¤çš„ Context\ngotDefault å˜é‡æ§åˆ¶åªèƒ½åˆå§‹åŒ–ä¸€æ¬¡\nè°ƒç”¨ NamingManager.getInitialContext(myProps) è·å–é»˜è®¤çš„ Context\nå¦‚æœ InitialContextFactoryBuilder ä¸ä¸ºç©ºï¼Œåˆ™ä½¿ç”¨ InitialContextFactoryBuilder åˆ›å»º InitialContextFactoryï¼›å¦åˆ™ï¼Œä½¿ç”¨åå°„åˆ›å»º InitialContextFactory\nè·å– ClassLoader ä½¿ç”¨çš„æ˜¯ VersionHelper å·¥å…·æ çš„ getContextClassLoader æ–¹æ³• å…ˆè·å–å½“å‰çº¿ç¨‹çš„ ClassLoaderï¼Œå¦‚æœä¸ºç©ºï¼Œå†è·å– SystemClassLoader è°ƒç”¨ InitialContextFactory çš„ getInitialContext(env) åˆ›å»º Context\nè¯´æ˜ï¼š\n1ã€è¯»å–æˆ–è€…åˆå¹¶ environment çš„é¡ºåº\nç¨‹åºè®¾ç½® -\u0026gt; Applet -\u0026gt; System Properties -\u0026gt; åº”ç”¨çš„ jndi.properties -\u0026gt; JavaHome çš„ jndi.properties 2ã€VersionHelper å·¥å…·ç±»æœ‰è¯»å– System Propertiesï¼ˆä½¿ç”¨ Java Security çš„ AccessController ï¼‰ ã€è·å– ClassLoaderã€åå°„çš„æ–¹æ³•\nVersionHelperæ˜¯æŠ½è±¡çš„å•ä¾‹ç±»ï¼Œå®šä¹‰ä¸ºæŠ½è±¡ç±»çš„å¥½å¤„æ˜¯å¯ä»¥å°†æ–¹æ³•å’Œå®ç°è¿›è¡Œåˆ†ç¦»ã€‚\npublic abstract class VersionHelper { private static VersionHelper helper = null; VersionHelper() {} // Disallow anyone from creating one of these. static { helper = new VersionHelper12(); } public static VersionHelper getVersionHelper() { return helper; } } 3ã€ResourceManager.getApplicationResources() ä½¿ç”¨äº†ç¼“å­˜å’ŒåŒæ­¥ã€‚ç¼“å­˜ä½¿ç”¨çš„æ˜¯ WeakHashMap\nWeakHashMap æ˜¯ Java ä¸­çš„ä¸€ç§ç‰¹æ®Šç±»å‹çš„ Map å®ç°ï¼Œå®ƒä½¿ç”¨å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰æ¥å­˜å‚¨é”®å¯¹è±¡ã€‚åœ¨ WeakHashMap ä¸­ï¼Œå½“é”®å¯¹è±¡æ²¡æœ‰è¢«å…¶ä»–å¼ºå¼•ç”¨æ‰€å¼•ç”¨æ—¶ï¼Œå®ƒä»¬å¯ä»¥è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ï¼Œå³ä½¿å®ƒä»¬å­˜åœ¨äº WeakHashMap ä¸­ã€‚\n// WeakHashMap\u0026lt;Class | ClassLoader, Hashtable\u0026gt; private static final WeakHashMap\u0026lt;Object, Hashtable\u0026lt;? super String, Object\u0026gt;\u0026gt; propertiesCache = new WeakHashMap\u0026lt;\u0026gt;(11); éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒWeakHashMap çš„æ€§èƒ½å¯èƒ½ä¼šå—åˆ°å½±å“ï¼Œå› ä¸ºå®ƒéœ€è¦åœ¨åƒåœ¾å›æ”¶æ—¶æ¸…ç†æ— æ•ˆçš„é”®å€¼å¯¹ã€‚æ­¤å¤–ï¼Œç”±äºé”®å¯¹è±¡çš„å¼±å¼•ç”¨ç‰¹æ€§ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›ä¸é¢„æœŸä¸ç¬¦çš„è¡Œä¸ºï¼Œå› æ­¤åœ¨ä½¿ç”¨ WeakHashMap æ—¶éœ€è¦ä»”ç»†è€ƒè™‘å…¶é€‚ç”¨æ€§å’Œæ½œåœ¨çš„å½±å“ã€‚\nè¯»å†™ propertiesCache æ—¶ï¼Œå¯¹ propertiesCache å¯¹è±¡æ·»åŠ  synchronized å…³é”®å­—\nprivate static Hashtable\u0026lt;? super String, Object\u0026gt; getProviderResource(Object obj)throws NamingException{ if (obj == null) { return (new Hashtable\u0026lt;\u0026gt;(1)); } synchronized (propertiesCache) { Class\u0026lt;?\u0026gt; c = obj.getClass(); Hashtable\u0026lt;? super String, Object\u0026gt; props = propertiesCache.get(c); if (props != null) { return props; } props = new Properties(); InputStream istream = helper.getResourceAsStream(c, PROVIDER_RESOURCE_FILE_NAME); if (istream != null) { try { ((Properties)props).load(istream); } catch (IOException e) { NamingException ne = new ConfigurationException( \u0026#34;Error reading provider resource file for \u0026#34; + c); ne.setRootCause(e); throw ne; } } propertiesCache.put(c, props); return props; } } WeakHashMap æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œå®ƒä¸æ˜¯è®¾è®¡ç”¨äºåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹è¿›è¡Œå¹¶å‘è®¿é—®çš„ã€‚å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹ WeakHashMap è¿›è¡Œä¿®æ”¹æ“ä½œï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸ä¸€è‡´çš„ç»“æœæˆ–æŠ›å‡ºå¼‚å¸¸ã€‚\nå¦‚æœéœ€è¦åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä½¿ç”¨ WeakHashMapï¼Œå¯ä»¥è€ƒè™‘ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š\nä½¿ç”¨åŒæ­¥æœºåˆ¶ï¼šæ‚¨å¯ä»¥ä½¿ç”¨ synchronized å…³é”®å­—æˆ–å…¶ä»–åŒæ­¥æœºåˆ¶ï¼ˆå¦‚ ReentrantLockï¼‰æ¥ä¿æŠ¤å¯¹ WeakHashMap çš„è®¿é—®ã€‚é€šè¿‡ç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶ä¿®æ”¹ WeakHashMapï¼Œå¯ä»¥é¿å…å¹¶å‘è®¿é—®çš„é—®é¢˜ã€‚ ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„æ›¿ä»£ç±»ï¼šå¦‚æœéœ€è¦åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä½¿ç”¨å¹¶å‘è®¿é—®çš„ Mapï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„å®ç°ï¼Œå¦‚ ConcurrentHashMapã€‚ 4ã€JNDI è¿˜ä½¿ç”¨äº†å·¥å‚æ¨¡å¼å’Œæ„é€ è€…æ¨¡å¼ã€‚ç›¸å…³ç±»ï¼šInitialContextFactoryã€InitialContextFactoryBuilderï¼Œåˆ™ä¸¤ä¸ªç±»çš„æ–¹æ³•å‚æ•°éƒ½æ˜¯ä½¿ç”¨çš„ Hashtable\u0026lt;?,?\u0026gt; environmentï¼Œè¿™æ ·å¯ä»¥ä¼ å…¥å¤šä¸ªå‚æ•°ã€‚JNDI æœ‰å®šä¹‰ spi åŒ…ï¼Œä½†æ˜¯å´æ²¡æœ‰ä½¿ç”¨Java çš„ ServiceLoader ç±»å®ç° SPIã€‚åŸå› æ˜¯ JNDI æ˜¯ Java 1.3 å¼•å…¥çš„ï¼Œè€Œ ServiceLoader æ˜¯åœ¨ Java 1.6 å¼•å…¥çš„ã€‚\nContext åˆå§‹åŒ– InitialContext å®ç°äº† Context æ¥å£ï¼Œå…¶å†…éƒ¨æœ‰ä¸€ä¸ª Context å¼•ç”¨ï¼Œè¡¨ç¤ºé»˜è®¤çš„ Contextã€‚Context æ¥å£å®šä¹‰çš„æ–¹æ³•éƒ½å’Œå‘½åæœ‰å…³ï¼Œæ¯ä¸ªå‘½åéƒ½æœ‰ä¸€ä¸ªåç§°ï¼Œé€šè¿‡è¿™ä¸ªåç§°è·å– Context æ—¶ï¼Œå¯èƒ½ä¼šè·å–é»˜è®¤çš„ Context ï¼Œä¹Ÿå¯èƒ½è·å–è‡ªå®šä¹‰çš„ Context ã€‚\nä»£ç å¦‚ä¸‹ï¼š\nprotected Context getURLOrDefaultInitCtx(String name) throws NamingException { if (NamingManager.hasInitialContextFactoryBuilder()) { return getDefaultInitCtx(); } String scheme = getURLScheme(name); if (scheme != null) { Context ctx = NamingManager.getURLContext(scheme, myProps); if (ctx != null) { return ctx; } } return getDefaultInitCtx(); } 1ã€å¦‚æœè®¾ç½®äº†InitialContextFactoryBuilderï¼Œåˆ™ç›´æ¥è¿”å›é»˜è®¤çš„ Context\n2ã€å¦‚æœåç§°ä¸­æœ‰ schemaï¼Œåˆ™è°ƒç”¨ NamingManager.getURLContext(scheme, myProps) è·å– Contextã€‚ä¾‹å¦‚ï¼šjava:comp/env/jdbc/UserPlatformDB\nè°ƒç”¨ getURLObject æ–¹æ³• è¿”å›å¯¹è±¡ é€šè¿‡ ResourceManager è·å– ObjectFactory è¯»å– java.naming.factory.url.pkgs å€¼ä½œä¸ºåŒ…åï¼Œå¦‚æœå€¼ä¸ºç©ºï¼Œåˆ™ä½¿ç”¨ com.sun.jndi.urlï¼›å¦åˆ™å°†è¯¥å€¼ä½¿ç”¨å†’å·æ‹¼æ¥ä¸Š com.sun.jndi.url ç±»åå‰ç¼€ä¸º \u0026quot;.\u0026quot; + scheme + \u0026quot;.\u0026quot; + scheme + \u0026quot;URLContextFactory\u0026quot; ä½¿ç”¨å†’å·åˆ†éš”ç¬¦éå†åŒ…åï¼Œå°†åŒ…ååŠ ä¸Šç±»åï¼Œå¾—åˆ°å…¨ç±»åçš„ URLContextFactoryï¼Œç„¶åé€šè¿‡åå°„åŠ è½½ç±»ï¼Œç›´åˆ°å¾—åˆ°ä¸€ä¸ªä¸ä¸ºç©ºçš„ factoryï¼Œå¹¶æ”¾å…¥äºŒçº§ç¼“å­˜ä¸­ï¼ˆWeakHashMap\u0026lt;ClassLoader, Map\u0026lt;String, List\u0026lt;NamedWeakReference\u0026lt;Object\u0026gt;\u0026gt;\u0026gt;\u0026gt;ï¼‰ã€‚ ä¾‹å¦‚ï¼Œå¯¹äº java:comp/env/jdbc/UserPlatformDBï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®š java.naming.factory.url.pkgsï¼Œåˆ™å¾—åˆ°çš„åŒ…åä¸ºï¼šcom.sun.jndi.url.java.javaURLContextFactory å¦‚æœ factory ä¸ä¸ºç©ºï¼Œåˆ™è°ƒç”¨ factory.getObjectInstance(urlInfo, name, nameCtx, environment) è¿”å›å¯¹è±¡ å¦‚æœè¿”å›çš„å¯¹è±¡æ˜¯ Contextï¼Œåˆ™è¿”å› 3ã€è¿”å›é»˜è®¤çš„ Context\nJava ç±»åŠ è½½æœºåˆ¶ Javaçš„ClassLoaderï¼ˆç±»åŠ è½½å™¨ï¼‰æœºåˆ¶æ˜¯Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰ç”¨äºåŠ è½½Javaç±»çš„ä¸€ç§æœºåˆ¶ã€‚å®ƒè´Ÿè´£åœ¨è¿è¡Œæ—¶æŸ¥æ‰¾ã€åŠ è½½å’Œé“¾æ¥Javaç±»ï¼Œå¹¶ç”Ÿæˆå¯¹åº”çš„Classå¯¹è±¡ã€‚\nClassLoader æœºåˆ¶çš„ä¸»è¦ç›®æ ‡æ˜¯å®ç°Javaçš„åŠ¨æ€æ‰©å±•æ€§å’Œä»£ç çš„éš”ç¦»æ€§ã€‚å®ƒå…è®¸å¼€å‘äººå‘˜åŠ è½½æ¥è‡ªä¸åŒæ¥æºçš„ç±»ï¼Œä¾‹å¦‚æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œã€JARæ–‡ä»¶ç­‰ï¼Œå¹¶å°†å®ƒä»¬ç»„ç»‡æˆä¸€ä¸ªç±»å±‚æ¬¡ç»“æ„ã€‚\nClassLoader ç±»ç»“æ„ ClassLoader ç±»ç»§æ‰¿ç»“æ„ï¼š\nSecureClassLoader URLClassLoader FactoryURLClassLoader AppClassLoaderï¼š ExtClassLoaderï¼š å¸¸è§çš„ClassLoaderåŒ…æ‹¬ï¼š\nBootstrap ClassLoaderï¼šä¹Ÿç§°ä¸ºåŸç”Ÿç±»åŠ è½½å™¨ï¼Œå®ƒæ˜¯JVMçš„ä¸€éƒ¨åˆ†å¹¶ä¸”æ˜¯ä½¿ç”¨ native ä»£ç ç¼–å†™ï¼Œè´Ÿè´£åŠ è½½JVMè¿è¡Œæ—¶ï¼Œå¦‚java.lang.Objectã€‚Bootstrap ClassLoader æ˜¯æ‰€æœ‰ ClassLoader çš„çˆ¶ç±»ã€‚ Extension ClassLoaderï¼šExtClassLoaderï¼Œç”¨äºåŠ è½½Javaçš„æ‰©å±•ç±»åº“ï¼Œä½äºjre/lib/extç›®å½•ä¸­ æˆ–è€…ç”± java.ext.dirs æŒ‡å®šç›®å½•ä¸‹çš„JARæ–‡ä»¶ã€‚ System ClassLoaderï¼šAppClassLoaderï¼Œä¹Ÿç§°ä¸ºåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼ŒåŠ è½½ç”¨æˆ·è‡ªå®šä¹‰çš„ç±»å’Œç¬¬ä¸‰æ–¹ç±»åº“ã€‚ AppClassLoaderæ˜¯é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼Œå¦‚æœç±»åŠ è½½æ—¶æˆ‘ä»¬ä¸æŒ‡å®šç±»åŠ è½½å™¨çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤ä¼šä½¿ç”¨AppClassLoaderåŠ è½½ç±»ï¼ŒClassLoader.getSystemClassLoader()è¿”å›çš„ç³»ç»Ÿç±»åŠ è½½å™¨ä¹Ÿæ˜¯AppClassLoaderã€‚\nJavaä¸­çš„ClassLoaderæ˜¯ä¸€ä¸ªå±‚æ¬¡ç»“æ„ï¼Œç”±å¤šä¸ªClassLoaderç»„æˆã€‚æ¯ä¸ªClassLoaderéƒ½æœ‰ä¸€ä¸ªçˆ¶ClassLoaderï¼Œé™¤äº†é¡¶å±‚çš„åŸç”Ÿç±»åŠ è½½å™¨ï¼ˆbootstrap class loaderï¼‰ä¹‹å¤–ã€‚å½“éœ€è¦åŠ è½½ä¸€ä¸ªç±»æ—¶ï¼ŒClassLoaderä¼šé¦–å…ˆå°è¯•å§”æ‰˜ç»™å…¶çˆ¶ClassLoaderè¿›è¡ŒåŠ è½½ã€‚åªæœ‰å½“çˆ¶ClassLoaderæ— æ³•åŠ è½½æ—¶ï¼ŒClassLoaderæ‰ä¼šå°è¯•è‡ªå·±åŠ è½½ã€‚\nClassLoader å¦‚ä½•å·¥ä½œ ç±»åŠ è½½å™¨æ˜¯ Java è¿è¡Œæ—¶ç¯å¢ƒçš„ä¸€éƒ¨åˆ†ã€‚å½“ JVM è¯·æ±‚ä¸€ä¸ªç±»æ—¶ï¼Œç±»åŠ è½½å™¨ä¼šå°è¯•å®šä½è¯¥ç±»ï¼Œå¹¶ä½¿ç”¨å®Œå…¨é™å®šçš„ç±»åå°†ç±»å®šä¹‰åŠ è½½åˆ°è¿è¡Œæ—¶ä¸­ã€‚\njava.lang.ClassLoader.loadClass() æ–¹æ³•è´Ÿè´£å°†ç±»å®šä¹‰åŠ è½½åˆ°è¿è¡Œæ—¶ã€‚å®ƒå°è¯•æ ¹æ®å®Œå…¨é™å®šåç§°åŠ è½½ç±»ã€‚\nå¦‚æœè¯¥ç±»å°šæœªåŠ è½½ï¼Œå®ƒå°†è¯·æ±‚å§”æ‰˜ç»™çˆ¶ç±»åŠ è½½å™¨ã€‚è¿™ä¸ªè¿‡ç¨‹é€’å½’åœ°å‘ç”Ÿã€‚\næœ€ç»ˆï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å™¨æ‰¾ä¸åˆ°è¯¥ç±»ï¼Œåˆ™å­ç±»å°†è°ƒç”¨ java.net.URLClassLoader.findClass() æ–¹æ³•åœ¨æ–‡ä»¶ç³»ç»Ÿæœ¬èº«ä¸­æŸ¥æ‰¾ç±»ã€‚\nå¦‚æœæœ€åä¸€ä¸ªå­ç±»åŠ è½½å™¨ä¹Ÿæ— æ³•åŠ è½½è¯¥ç±»ï¼Œåˆ™ä¼šæŠ›å‡º java.lang.NoClassDefFoundError æˆ– java.lang.ClassNotFoundExceptionã€‚\nè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æŠ›å‡º ClassNotFoundException æ—¶çš„è¾“å‡ºç¤ºä¾‹ï¼š\njava.lang.ClassNotFoundException: at java.net.URLClassLoader.findClass(URLClassLoader.java:381) at java.lang.ClassLoader.loadClass(ClassLoader.java:424) at java.lang.ClassLoader.loadClass(ClassLoader.java:357) at java.lang.Class.forName0(Native Method) at java.lang.Class.forName(Class.java:348) å¦‚æœæˆ‘ä»¬ä»è°ƒç”¨ java.lang.Class.forName() å¼€å§‹æŸ¥çœ‹é”™è¯¯æ—¥å¿—ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒé¦–å…ˆå°è¯•é€šè¿‡çˆ¶ç±»åŠ è½½å™¨åŠ è½½è¯¥ç±»ï¼Œç„¶å java.net.URLClassLoader.findClass() æ¥åŠ è½½è¯¥ç±»ã€‚å½“å®ƒä»ç„¶æ‰¾ä¸åˆ°è¯¥ç±»æ—¶ï¼Œå®ƒä¼šæŠ›å‡º ClassNotFoundExceptionã€‚\nClassLoader ä¸‰ä¸ªç‰¹æ€§ åŒäº²å§”æ´¾æ¨¡å‹\nç±»åŠ è½½å™¨éµå¾ªå§”æ‰˜æ¨¡å‹ï¼Œåœ¨è¯·æ±‚æŸ¥æ‰¾ç±»æˆ–èµ„æºæ—¶ï¼ŒClassLoader å®ä¾‹ä¼šå°†ç±»æˆ–èµ„æºçš„æœç´¢å§”æ‰˜ç»™çˆ¶ç±»åŠ è½½å™¨ã€‚\nå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå°†åº”ç”¨ç¨‹åºç±»åŠ è½½åˆ° JVM ä¸­çš„è¯·æ±‚ã€‚ç³»ç»Ÿç±»åŠ è½½å™¨é¦–å…ˆå°†è¯¥ç±»çš„åŠ è½½å§”æ‰˜ç»™å…¶çˆ¶æ‰©å±•ç±»åŠ è½½å™¨ï¼Œåè€…åˆå°†å…¶å§”æ‰˜ç»™å¼•å¯¼ç±»åŠ è½½å™¨ã€‚\nä»…å½“å¼•å¯¼ç¨‹åºå’Œæ‰©å±•ç±»åŠ è½½å™¨åŠ è½½ç±»å¤±è´¥æ—¶ï¼Œç³»ç»Ÿç±»åŠ è½½å™¨æ‰ä¼šå°è¯•åŠ è½½ç±»æœ¬èº«ã€‚\nå¯è§æ€§\nå­ç±»åŠ è½½å™¨å¯¹å…¶çˆ¶ç±»åŠ è½½å™¨åŠ è½½çš„ç±»æ˜¯å¯è§çš„ã€‚\nä¾‹å¦‚ï¼Œç³»ç»Ÿç±»åŠ è½½å™¨åŠ è½½çš„ç±»å¯ä»¥çœ‹åˆ°æ‰©å±•å’Œå¼•å¯¼ç±»åŠ è½½å™¨åŠ è½½çš„ç±»ï¼Œä½†åä¹‹åˆ™ä¸ç„¶ã€‚\nä¸ºäº†è¯´æ˜è¿™ä¸€ç‚¹ï¼Œå¦‚æœç±» A ç”±åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨åŠ è½½ï¼Œç±» B ç”±æ‰©å±•ç±»åŠ è½½å™¨åŠ è½½ï¼Œåˆ™å°±åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨åŠ è½½çš„å…¶ä»–ç±»è€Œè¨€ï¼ŒA ç±»å’Œ B ç±»éƒ½æ˜¯å¯è§çš„ã€‚\nç„¶è€Œï¼ŒB ç±»æ˜¯å”¯ä¸€å¯¹æ‰©å±•ç±»åŠ è½½å™¨åŠ è½½çš„å…¶ä»–ç±»å¯è§çš„ç±»ã€‚\nå”¯ä¸€æ€§\nç”±äºå§”æ‰˜æ¨¡å‹çš„ç»“æœï¼Œå¾ˆå®¹æ˜“ç¡®ä¿å”¯ä¸€çš„ç±»ï¼Œå› ä¸ºæˆ‘ä»¬æ€»æ˜¯å°è¯•å‘ä¸Šå§”æ‰˜ã€‚å¦‚æœçˆ¶ç±»åŠ è½½å™¨æ— æ³•æ‰¾åˆ°è¯¥ç±»ï¼Œåªæœ‰å½“å‰å®ä¾‹æ‰ä¼šå°è¯•è‡ªè¡ŒæŸ¥æ‰¾ã€‚\nClassLoader æºç  1ã€loadClass() æ–¹æ³•\npublic Class\u0026lt;?\u0026gt; loadClass(String name, boolean resolve) throws ClassNotFoundException { è¯¥æ–¹æ³•è´Ÿè´£åŠ è½½ç»™å®šåç§°å‚æ•°çš„ç±»ã€‚ name å‚æ•°æŒ‡çš„æ˜¯å®Œå…¨é™å®šçš„ç±»åã€‚\nJavaè™šæ‹Ÿæœºè°ƒç”¨ loadClass() æ–¹æ³•æ¥è§£æç±»å¼•ç”¨ï¼Œå¹¶å°† resolve è®¾ç½®ä¸ºtrueã€‚ç„¶è€Œï¼Œå¹¶ä¸æ€»æ˜¯éœ€è¦è§£æä¸€ä¸ªç±»ã€‚å¦‚æœæˆ‘ä»¬åªéœ€è¦åˆ¤æ–­ç±»æ˜¯å¦å­˜åœ¨ï¼Œé‚£ä¹ˆ resolve å‚æ•°è®¾ç½®ä¸º falseã€‚\nè¯¥æ–¹æ³•å……å½“ç±»åŠ è½½å™¨çš„å…¥å£ç‚¹ã€‚\næˆ‘ä»¬å¯ä»¥å°è¯• ä»java.lang.ClassLoader çš„æºç ä¸­äº†è§£ loadClass() æ–¹æ³•çš„å†…éƒ¨å·¥ä½œåŸç†ï¼š\nprotected Class\u0026lt;?\u0026gt; loadClass(String name, boolean resolve) throws ClassNotFoundException { synchronized (getClassLoadingLock(name)) { // First, check if the class has already been loaded Class\u0026lt;?\u0026gt; c = findLoadedClass(name); if (c == null) { long t0 = System.nanoTime(); try { if (parent != null) { c = parent.loadClass(name, false); } else { c = findBootstrapClassOrNull(name); } } catch (ClassNotFoundException e) { // ClassNotFoundException thrown if class not found // from the non-null parent class loader } if (c == null) { // If still not found, then invoke findClass in order // to find the class. c = findClass(name); } } if (resolve) { resolveClass(c); } return c; } } è¯¥æ–¹æ³•çš„é»˜è®¤å®ç°æŒ‰ä»¥ä¸‹é¡ºåºæœç´¢ç±»ï¼š\nè°ƒç”¨ findLoadedClass(String) æ–¹æ³•ä»¥æŸ¥çœ‹è¯¥ç±»æ˜¯å¦å·²åŠ è½½ã€‚ è°ƒç”¨çˆ¶ç±»åŠ è½½å™¨ä¸Šçš„ loadClass(String) æ–¹æ³•ã€‚ è°ƒç”¨ findClass(String) æ–¹æ³•æ¥æŸ¥æ‰¾è¯¥ç±»ã€‚ 2ã€defineClass() æ–¹æ³•\nprotected final Class\u0026lt;?\u0026gt; defineClass( String name, byte[] b, int off, int len) throws ClassFormatError è¯¥æ–¹æ³•è´Ÿè´£å°†å­—èŠ‚æ•°ç»„è½¬æ¢ä¸ºç±»çš„å®ä¾‹ã€‚åœ¨ä½¿ç”¨è¯¥ç±»ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰å®ƒã€‚å¦‚æœæ•°æ®ä¸åŒ…å«æœ‰æ•ˆçš„ç±»ï¼Œåˆ™ä¼šæŠ›å‡º ClassFormatErrorã€‚\næ­¤å¤–ï¼Œæˆ‘ä»¬æ— æ³•é‡å†™æ­¤æ–¹æ³•ï¼Œå› ä¸ºå®ƒè¢«æ ‡è®°ä¸ºæœ€ç»ˆæ–¹æ³•ã€‚\n3ã€findClass() æ–¹æ³•\nprotected Class\u0026lt;?\u0026gt; findClass(String name) throws ClassNotFoundException æ­¤æ–¹æ³•æŸ¥æ‰¾ä»¥å®Œå…¨é™å®šåç§°ä½œä¸ºå‚æ•°çš„ç±»ã€‚æˆ‘ä»¬éœ€è¦åœ¨éµå¾ªåŠ è½½ç±»çš„å§”æ‰˜æ¨¡å‹çš„è‡ªå®šä¹‰ç±»åŠ è½½å™¨å®ç°ä¸­é‡å†™æ­¤æ–¹æ³•ã€‚\næ­¤å¤–ï¼Œå¦‚æœçˆ¶ç±»åŠ è½½å™¨æ‰¾ä¸åˆ°æ‰€è¯·æ±‚çš„ç±»ï¼ŒloadClass() ä¼šè°ƒç”¨æ­¤æ–¹æ³•ã€‚\nå¦‚æœç±»åŠ è½½å™¨çš„çˆ¶çº§æ²¡æœ‰æ‰¾åˆ°è¯¥ç±»ï¼Œåˆ™é»˜è®¤å®ç°ä¼šæŠ›å‡º ClassNotFoundExceptionã€‚\n4ã€getParent() æ–¹æ³•\npublic final ClassLoader getParent() è¯¥æ–¹æ³•è¿”å›å§”æ‰˜çš„çˆ¶ç±»åŠ è½½å™¨ã€‚æŸäº›å®ç°ä½¿ç”¨ null æ¥è¡¨ç¤ºå¼•å¯¼ç±»åŠ è½½å™¨ã€‚\n5ã€getResource() æ–¹æ³•\npublic URL getResource(String name) æ­¤æ–¹æ³•å°è¯•æŸ¥æ‰¾å…·æœ‰ç»™å®šåç§°çš„èµ„æºã€‚\nå®ƒé¦–å…ˆå°†èµ„æºå§”æ‰˜ç»™çˆ¶ç±»åŠ è½½å™¨ã€‚å¦‚æœ parent ä¸ºnullï¼Œåˆ™æŸ¥æ‰¾è™šæ‹Ÿæœºå†…ç½®çš„ç±»åŠ è½½å™¨çš„è·¯å¾„ã€‚å¦‚æœå¤±è´¥ï¼Œè¯¥æ–¹æ³•å°†è°ƒç”¨ findResource(String) æ¥æŸ¥æ‰¾èµ„æºã€‚æŒ‡å®šä¸ºè¾“å…¥çš„èµ„æºåç§°å¯ä»¥æ˜¯ç›¸å¯¹äºç±»è·¯å¾„çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»å¯¹çš„ã€‚\nå®ƒè¿”å›ä¸€ä¸ªç”¨äºè¯»å–èµ„æºçš„ URL å¯¹è±¡ï¼Œå¦‚æœæ‰¾ä¸åˆ°èµ„æºæˆ–è°ƒç”¨è€…æ²¡æœ‰è¶³å¤Ÿçš„æƒé™æ¥è¿”å›èµ„æºï¼Œåˆ™è¿”å› nullã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒJava ä»ç±»è·¯å¾„åŠ è½½èµ„æºã€‚\næœ€åï¼ŒJava ä¸­çš„èµ„æºåŠ è½½è¢«è®¤ä¸ºæ˜¯ä¸ä½ç½®æ— å…³çš„ï¼Œå› ä¸ºåªè¦è®¾ç½®ç¯å¢ƒæ¥æŸ¥æ‰¾èµ„æºï¼Œä»£ç åœ¨å“ªé‡Œè¿è¡Œå¹¶ä¸é‡è¦ã€‚\nContext Classloaders ä¸€èˆ¬æ¥è¯´ï¼Œä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ä¸º J2SE ä¸­å¼•å…¥çš„ç±»åŠ è½½å§”æ‰˜æ–¹æ¡ˆæä¾›äº†ä¸€ç§æ›¿ä»£æ–¹æ³•ã€‚\næ­£å¦‚æˆ‘ä»¬ä¹‹å‰äº†è§£åˆ°çš„ï¼ŒJVM ä¸­çš„ç±»åŠ è½½å™¨éµå¾ªåˆ†å±‚æ¨¡å‹ï¼Œå› æ­¤é™¤äº†å¼•å¯¼ç±»åŠ è½½å™¨ä¹‹å¤–ï¼Œæ¯ä¸ªç±»åŠ è½½å™¨éƒ½æœ‰ä¸€ä¸ªçˆ¶ç±»åŠ è½½å™¨ã€‚\nç„¶è€Œï¼Œæœ‰æ—¶å½“ JVM æ ¸å¿ƒç±»éœ€è¦åŠ¨æ€åŠ è½½åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜æä¾›çš„ç±»æˆ–èµ„æºæ—¶ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°é—®é¢˜ã€‚\nä¾‹å¦‚ï¼Œåœ¨ JNDI ä¸­ï¼Œæ ¸å¿ƒåŠŸèƒ½æ˜¯ç”± rt.jar ä¸­çš„å¼•å¯¼ç±»å®ç°çš„ã€‚ä½†è¿™äº› JNDI ç±»å¯èƒ½ä¼šåŠ è½½ç”±ç‹¬ç«‹ä¾›åº”å•†å®ç°çš„ JNDI æä¾›ç¨‹åºï¼ˆéƒ¨ç½²åœ¨åº”ç”¨ç¨‹åºç±»è·¯å¾„ä¸­ï¼‰ã€‚è¿™ç§æƒ…å†µéœ€è¦å¼•å¯¼ç±»åŠ è½½å™¨ï¼ˆçˆ¶ç±»åŠ è½½å™¨ï¼‰æ¥åŠ è½½åº”ç”¨ç¨‹åºåŠ è½½å™¨ï¼ˆå­ç±»åŠ è½½å™¨ï¼‰å¯è§çš„ç±»ã€‚\nJ2SE å§”æ‰˜åœ¨è¿™é‡Œä¸èµ·ä½œç”¨ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ç±»åŠ è½½çš„æ›¿ä»£æ–¹æ³•ã€‚è¿™å¯ä»¥ä½¿ç”¨çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨æ¥å®ç°ã€‚\njava.lang.Thread ç±»æœ‰ä¸€ä¸ªæ–¹æ³• getContextClassLoader()ï¼Œå®ƒè¿”å›ç‰¹å®šçº¿ç¨‹çš„ Context ClassLoaderã€‚ Context ClassLoader æ˜¯çº¿ç¨‹çš„åˆ›å»ºè€…åœ¨åŠ è½½èµ„æºå’Œç±»æ—¶æä¾›çš„ã€‚å¦‚æœæœªè®¾ç½®è¯¥å€¼ï¼Œåˆ™é»˜è®¤ä¸ºçˆ¶çº¿ç¨‹çš„ Context ClassLoaderã€‚\næ­£å¦‚å‰é¢åœ¨ JNDI æºç åˆ†æä¸­æåˆ°çš„ï¼Œåœ¨ JNDI ä¸­ï¼Œè·å– ClassLoader çš„ä»£ç åœ¨ VersionHelper12 ç±»çš„ getContextClassLoader æ–¹æ³•ä¸­ã€‚\nfinal class VersionHelper12 extends VersionHelper { ClassLoader getContextClassLoader() { return AccessController.doPrivileged( new PrivilegedAction\u0026lt;ClassLoader\u0026gt;() { public ClassLoader run() { ClassLoader loader = Thread.currentThread().getContextClassLoader(); if (loader == null) { // Don\u0026#39;t use bootstrap class loader directly! loader = ClassLoader.getSystemClassLoader(); } return loader; } } ); } } å‚è€ƒ ClassLoader\nClass Loaders in Java\n","permalink":"https://blog.chensoul.cc/posts/2023/12/15/til/","summary":"Today I Learned. ä»Šå¤©åˆ†äº«å†…å®¹ï¼šJNDI InitialContextæºç åˆ†æã€ClassLoaderåŠ è½½æœºåˆ¶ã€‚\nJNDI InitialContext æºç åˆ†æ JNDIåŒ…ç»“æ„ javax.naming\nContext InitialContext Name CompositeName CompoundName NameImpl NameParser NamingEnumeration Referenceable RefAddr BinaryRefAddr StringRefAddr NameClassPair Binding Reference LinkRef javax.naming.directory\nAttribute\nBasicAttribute Attributes\nBasicAttributes DirContext\nInitialDirContext ModificationItem\nSearchControls\nSearchResult\njavax.naming.spi\nNamingManager DirectoryManager ObjectFactory DirObjectFactory ObjectFactoryBuilder StateFactory DirStateFactory InitialContextFactory InitialContextFactoryBuilder Resolver ContinuationContext ContinuationDirContext ResolveResult InitialContext æ„é€ æ–¹æ³• InitialContextçš„åˆå§‹åŒ–æœ‰å‡ ç§æ–¹å¼ï¼š\né€šè¿‡æ„é€ æ–¹æ³• é€šè¿‡ InitialContextFactory#getInitialContext é€šè¿‡åè®®è½¬æ¢åˆ›å»º InitialContext.getURLOrDefaultInitCtx(String name) ä¸€ä¸ª JNDI ç¤ºä¾‹ï¼š\npublic class DNSClient { public static void main(String[] args) { Hashtable\u0026lt;String, String\u0026gt; env = new Hashtable\u0026lt;\u0026gt;(); env.put(Context.INITIAL_CONTEXT_FACTORY, \u0026#34;com.sun.jndi.dns.DnsContextFactory\u0026#34;); env.put(Context.PROVIDER_URL, \u0026#34;dns://114.114.114.114\u0026#34;); try { DirContext ctx = new InitialDirContext(env); Attributes res = ctx.getAttributes(\u0026#34;example.com\u0026#34;, new String[]{\u0026#34;A\u0026#34;}); System.out.println(res); } catch (NamingException e) { e.","title":"2023-12-15ï½œJNDI InitialContextæºç åˆ†æã€ClassLoaderåŠ è½½æœºåˆ¶"},{"content":"Today I Learned. ä»Šå¤©åˆ†äº«å†…å®¹ï¼šè´­ä¹°æ–°çš„ VPS æœåŠ¡å™¨ã€æœ€è¿‘åœ¨åšä»€ä¹ˆã€‚\nè´­ä¹°æ–°çš„ VPS æœåŠ¡å™¨ ä»Šå¤©çœ‹åˆ°æ¬ç“¦å·¥ä¸Šçš„ VPS è¿˜æœ‰ä¸€ä¸ªæœˆåˆ°æœŸï¼Œè¯¥ VPS é…ç½®æ˜¯ 40 GB SSDã€2 GB RAMã€2 TB Bandwidthã€3x Intel Xeon CPUã€1 Gigabit Networkï¼Œä¸€å¹´è´¹ç”¨æ˜¯ 99 ç¾å…ƒã€‚\nåœ¨ä¸­æ–‡åšå®¢åœˆå¾®ä¿¡ç¾¤é‡Œé¢çœ‹åˆ° CloudCone æœ€è¿‘åœ¨åš CloudCone 2023 å¹´åœ£è¯èŠ‚æ´»åŠ¨ã€‚\nCloudCone æˆç«‹äº 2017 å¹´ï¼Œç¾å›½æ³¨å†Œå…¬å¸ (æ€€ä¿„æ˜å· 2017-000753144)ã€‚ä¸»è¥ç¾å›½æ´›æ‰çŸ¶ MultaCom æœºæˆ¿çš„äº‘æœåŠ¡å™¨ / VPSã€ç‹¬ç«‹æœåŠ¡å™¨ã€ç”µå­é‚®ä»¶æ‰˜ç®¡ç­‰ä¸šåŠ¡ã€‚VPS åŸºäº KVM è™šæ‹Ÿï¼Œé‡‡ç”¨è‡ªè¡Œç ”å‘çš„æ§åˆ¶é¢æ¿ã€‚å…¶æ‰€åœ¨çš„ MultaCom æœºæˆ¿é‡‡ç”¨åŠ¨æ€è·¯ç”±ç½‘ç»œï¼Œä¼šæ ¹æ®ä¸åŒç½‘ç»œçŠ¶æ€è°ƒæ•´çº¿è·¯ï¼Œå¾ˆå¤šåœ°åŒºçš„ç”µä¿¡ç½‘ç»œä¼šèµ° CN2 çº¿è·¯ï¼Œå› æ­¤å»¶è¿Ÿå’Œç¨³å®šæ€§åœ¨éé«˜å³°æ—¶æ®µéƒ½è¾ƒä¸ºä¼˜ç§€ã€‚åŒæ—¶è¯¥ä¸»æœºå•†æä¾›äº†æŒ‰ç§’è®¡è´¹ã€éšåˆ éšç”¨ã€å®šæœŸå¤‡ä»½æœåŠ¡ã€‚æ”¯æŒæ”¯ä»˜å®ã€Paypalã€ä¿¡ç”¨å¡ç­‰æ–¹å¼ä»˜æ¬¾ã€‚\nCloudCone 2023 å¹´åœ£è¯èŠ‚ VPS ä¼˜æƒ ä¿ƒé”€æ´»åŠ¨ã€‚ç¾å›½è¥¿æµ·å²¸æ´›æ‰çŸ¶ MultaCom æœºæˆ¿ï¼Œåƒå…†å¸¦å®½ï¼Œ1 ä¸ª IPv4 åœ°å€ï¼Œ3 ä¸ª IPv6 åœ°å€ï¼ŒåŸºäº KVM è™šæ‹Ÿï¼ŒSSD Cached RAID 10 å­˜å‚¨ã€‚\næ´»åŠ¨åœ°å€ï¼šhttps://hello.cloudcone.com/2023-christmas-vps-sale\nCPU å†…å­˜ ç¡¬ç›˜ï¼ˆSSDï¼‰ æµé‡ å¸¦å®½ ä»·æ ¼ è´­ä¹°åœ°å€ 1 æ ¸ 0.5G 30G 3T 1Gbps $9.5/å¹´ ç‚¹å‡»è´­ä¹° 2 æ ¸ 1G 45G 3T 1Gbps $15/å¹´ ç‚¹å‡»è´­ä¹° 2 æ ¸ 1G 50G 3T 1Gbps $16.5/å¹´ ç‚¹å‡»è´­ä¹° 2 æ ¸ 2G 100G 6T 1Gbps $26/å¹´ ç‚¹å‡»è´­ä¹° 2 æ ¸ 2G 105G 6T 1Gbps $29/å¹´ ç‚¹å‡»è´­ä¹° 4 æ ¸ 4G 205G 8T 1Gbps $48.5/å¹´ ç‚¹å‡»è´­ä¹° 4 æ ¸ 4G 210G 8T 1Gbps $54/å¹´ ç‚¹å‡»è´­ä¹° 6 æ ¸ 8G 400G 8T 1Gbps $93/å¹´ ç‚¹å‡»è´­ä¹° 6 æ ¸ 8G 410G 8T 1Gbps $104/å¹´ ç‚¹å‡»è´­ä¹° 8 æ ¸ 16G 850G 10T 1Gbps $188/å¹´ ç‚¹å‡»è´­ä¹° 8 æ ¸ 16G 850G 10T 1Gbps $210/å¹´ ç‚¹å‡»è´­ä¹° 16 æ ¸ 32G 1024G 10T 1Gbps $340/å¹´ ç‚¹å‡»è´­ä¹° 16 æ ¸ 32G 1TB 10T 1Gbps $390/å¹´ ç‚¹å‡»è´­ä¹° äºæ˜¯ä¹°äº†ä¸€ä¸ª 4 æ ¸ 4 GB å†…å­˜ 205 GB ç¡¬ç›˜çš„ VPSã€‚é…ç½®æ¯”æ¬ç“¦å·¥çš„ VPS é«˜äº†ä¸€å€ï¼Œä»·æ ¼å´ä¾¿å®œäº†ä¸€åŠã€‚ç¬é—´è§‰å¾— CloudCone çœŸé¦™ï¼\næ¥ä¸‹æ¥çš„å·¥ä½œå°±æ˜¯å°†åŸæ¥ VPS ä¸Šçš„æœåŠ¡è¿ç§»åˆ°æ–°çš„ VPS ä¸Šé¢ã€‚æ–° VPS çš„è®¾ç½®å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„ä¸€ç¯‡åšå®¢ æˆ‘çš„ VPS æœåŠ¡éƒ¨ç½²è®°å½•ã€‚\nä»Šå¤©è¿˜åšäº†ä»€ä¹ˆ æ›´æ–°åšå®¢ æˆ‘çš„ VPS æœåŠ¡éƒ¨ç½²è®°å½• æœ€è¿‘åœ¨åšä»€ä¹ˆ æœ€è¿‘åœ¨çœ‹ å°é©¬å“¥çš„ Java é¡¹ç›®å®æˆ˜è¥ï¼Œçœ‹åˆ°äº† \u0026ldquo;01 JavaEE å•ä½“æ¶æ„\u0026rdquo; çš„ç¬¬ 11 èŠ‚ï¼Œéœ€è¦æ•´ç†ç¬”è®°ï¼ŒåŠ æ·±ç†è§£ã€‚æ€»å…±æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹ï¼š\nJNDI JDBC JPA æ•°æ®æ ¡éªŒ äº‹åŠ¡ Servlet é…ç½®ç®¡ç†å’Œ Java Logging JMX Maven \u0026ndash; EOF\n","permalink":"https://blog.chensoul.cc/posts/2023/12/14/til/","summary":"Today I Learned. ä»Šå¤©åˆ†äº«å†…å®¹ï¼šè´­ä¹°æ–°çš„ VPS æœåŠ¡å™¨ã€æœ€è¿‘åœ¨åšä»€ä¹ˆã€‚\nè´­ä¹°æ–°çš„ VPS æœåŠ¡å™¨ ä»Šå¤©çœ‹åˆ°æ¬ç“¦å·¥ä¸Šçš„ VPS è¿˜æœ‰ä¸€ä¸ªæœˆåˆ°æœŸï¼Œè¯¥ VPS é…ç½®æ˜¯ 40 GB SSDã€2 GB RAMã€2 TB Bandwidthã€3x Intel Xeon CPUã€1 Gigabit Networkï¼Œä¸€å¹´è´¹ç”¨æ˜¯ 99 ç¾å…ƒã€‚\nåœ¨ä¸­æ–‡åšå®¢åœˆå¾®ä¿¡ç¾¤é‡Œé¢çœ‹åˆ° CloudCone æœ€è¿‘åœ¨åš CloudCone 2023 å¹´åœ£è¯èŠ‚æ´»åŠ¨ã€‚\nCloudCone æˆç«‹äº 2017 å¹´ï¼Œç¾å›½æ³¨å†Œå…¬å¸ (æ€€ä¿„æ˜å· 2017-000753144)ã€‚ä¸»è¥ç¾å›½æ´›æ‰çŸ¶ MultaCom æœºæˆ¿çš„äº‘æœåŠ¡å™¨ / VPSã€ç‹¬ç«‹æœåŠ¡å™¨ã€ç”µå­é‚®ä»¶æ‰˜ç®¡ç­‰ä¸šåŠ¡ã€‚VPS åŸºäº KVM è™šæ‹Ÿï¼Œé‡‡ç”¨è‡ªè¡Œç ”å‘çš„æ§åˆ¶é¢æ¿ã€‚å…¶æ‰€åœ¨çš„ MultaCom æœºæˆ¿é‡‡ç”¨åŠ¨æ€è·¯ç”±ç½‘ç»œï¼Œä¼šæ ¹æ®ä¸åŒç½‘ç»œçŠ¶æ€è°ƒæ•´çº¿è·¯ï¼Œå¾ˆå¤šåœ°åŒºçš„ç”µä¿¡ç½‘ç»œä¼šèµ° CN2 çº¿è·¯ï¼Œå› æ­¤å»¶è¿Ÿå’Œç¨³å®šæ€§åœ¨éé«˜å³°æ—¶æ®µéƒ½è¾ƒä¸ºä¼˜ç§€ã€‚åŒæ—¶è¯¥ä¸»æœºå•†æä¾›äº†æŒ‰ç§’è®¡è´¹ã€éšåˆ éšç”¨ã€å®šæœŸå¤‡ä»½æœåŠ¡ã€‚æ”¯æŒæ”¯ä»˜å®ã€Paypalã€ä¿¡ç”¨å¡ç­‰æ–¹å¼ä»˜æ¬¾ã€‚\nCloudCone 2023 å¹´åœ£è¯èŠ‚ VPS ä¼˜æƒ ä¿ƒé”€æ´»åŠ¨ã€‚ç¾å›½è¥¿æµ·å²¸æ´›æ‰çŸ¶ MultaCom æœºæˆ¿ï¼Œåƒå…†å¸¦å®½ï¼Œ1 ä¸ª IPv4 åœ°å€ï¼Œ3 ä¸ª IPv6 åœ°å€ï¼ŒåŸºäº KVM è™šæ‹Ÿï¼ŒSSD Cached RAID 10 å­˜å‚¨ã€‚\næ´»åŠ¨åœ°å€ï¼šhttps://hello.cloudcone.com/2023-christmas-vps-sale\nCPU å†…å­˜ ç¡¬ç›˜ï¼ˆSSDï¼‰ æµé‡ å¸¦å®½ ä»·æ ¼ è´­ä¹°åœ°å€ 1 æ ¸ 0.5G 30G 3T 1Gbps $9.5/å¹´ ç‚¹å‡»è´­ä¹° 2 æ ¸ 1G 45G 3T 1Gbps $15/å¹´ ç‚¹å‡»è´­ä¹° 2 æ ¸ 1G 50G 3T 1Gbps $16.","title":"2023-12-14ï½œè´­ä¹°æ–°çš„VPSæœåŠ¡å™¨ã€æœ€è¿‘åœ¨åšä»€ä¹ˆ"},{"content":"æœ€è¿‘åœ¨ä¸€äº›å¼€æºé¡¹ç›®ä¸­çœ‹åˆ°äº† MicroProfile ï¼Œäºæ˜¯åœ¨ç½‘ä¸ŠæŸ¥é˜…äº†ç›¸å…³èµ„æ–™åŠ æ·±å¯¹ MicroProfile çš„ç†è§£ï¼Œå¹¶åšäº†ç¬”è®°å½¢æˆæ­¤æ–‡ã€‚\nMicroProfile MicroProfileæ˜¯ä¸€ä¸ªå¼€æ”¾çš„ä¼ä¸šçº§Javaå¾®æœåŠ¡æ¡†æ¶ï¼Œæ—¨åœ¨ç®€åŒ–å’Œæ ‡å‡†åŒ–åŸºäºå¾®æœåŠ¡æ¶æ„çš„åº”ç”¨ç¨‹åºå¼€å‘ã€‚å®ƒæ˜¯ç”±Eclipse Foundationä¸»å¯¼çš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œè‡´åŠ›äºæä¾›è½»é‡çº§ã€å¯ç§»æ¤å’Œå¯äº’æ“ä½œçš„Javaå¾®æœåŠ¡è§„èŒƒå’Œå®ç°ã€‚\nMicroProfileçš„ç›®æ ‡æ˜¯ä¸ºJavaå¼€å‘äººå‘˜æä¾›ä¸€ä¸ªè§„èŒƒé›†åˆï¼Œä½¿ä»–ä»¬èƒ½å¤Ÿæ›´è½»æ¾åœ°æ„å»ºå’Œéƒ¨ç½²äº‘åŸç”Ÿåº”ç”¨ç¨‹åºã€‚å®ƒç»“åˆäº†Java EEã€Jakarta EEå’Œå…¶ä»–ç›¸å…³è§„èŒƒï¼Œä¸ºå¼€å‘äººå‘˜æä¾›äº†ä¸€ç»„æ ¸å¿ƒåŠŸèƒ½å’Œæ‰©å±•ï¼Œä»¥æ”¯æŒæ„å»ºå¯ä¼¸ç¼©ã€å¼¹æ€§å’Œé«˜æ€§èƒ½çš„å¾®æœåŠ¡åº”ç”¨ç¨‹åºã€‚\nMicroProfileæä¾›äº†ä¸€ç³»åˆ—çš„è§„èŒƒï¼ŒåŒ…æ‹¬ï¼š\nMicroProfile Config MicroProfile JWT RBAC MicroProfile Health MicroProfile Fault Tolerance MicroProfile Metrics MicroProfile OpenAPI MicroProfile OpenTracing MicroProfile REST Client MicroProfile Context Propagation MicroProfile Reactive Streams Operators MicroProfile Reactive Messaging MicroProfile GraphQL MicroProfile Long Running Actions MicroProfile Telemetry MicroProfile å®ç°ï¼š\nPayara Microï¼šæ˜¯ä¸€ä¸ªç”¨äºå®¹å™¨åŒ–Jakarta EEåº”ç”¨éƒ¨ç½²çš„è½»é‡çº§ä¸­é—´ä»¶å¹³å°ï¼Œä¸éœ€è¦å®‰è£…ã€é…ç½®æˆ–é‡å†™ä»£ç ï¼Œå¯ä»¥å¿«é€Ÿéƒ¨ç½² WildFly by Redhatï¼šæ˜¯ä¸€ä¸ªè½»é‡çº§ã€æ¨¡å—åŒ–çš„å¾®æœåŠ¡æ¡†æ¶ï¼Œé›†ä¸­ã€ç®€å•ã€ä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒï¼Œå®ç°äº†Jakarta EEå’ŒEclipse MicroProfileçš„æœ€æ–°ä¼ä¸šJavaæ ‡å‡†ã€‚ Quarkus by RedHatï¼šä¸ºGraalVMå’ŒOpenJDK HotSpotæ„å»ºçš„Kubernetes Native Javaå †æ ˆï¼Œç”±æœ€ä½³çš„Javaåº“å’Œæ ‡å‡†ç²¾å¿ƒæ‰“é€ ã€‚ Apache TomEEï¼šè¿™æ˜¯Apache Tomcat Javaä¼ä¸šç‰ˆï¼Œå®ƒç»“åˆäº†å‡ ä¸ªJavaä¼ä¸šé¡¹ç›®ï¼ŒåŒ…æ‹¬Apache OpenEJBã€Apache OpenJPAã€Apache OpenWebBeansã€Apache MyFaceså’Œå…¶ä»–è®¸å¤šé¡¹ç›®ã€‚ Hammockï¼šè¿™æ˜¯ä¸€ä¸ªåŸºäºCDIçš„bootstrapping Javaä¼ä¸šå¾®æœåŠ¡æ¡†æ¶ï¼Œç”±äºå…¶çµæ´»æ€§å’Œç®€å•æ€§ï¼Œç”¨äºæ„å»ºåº”ç”¨ç¨‹åº Openlibertyï¼šæ˜¯ä¸€ä¸ªå¼€æºçš„è½»é‡çº§Java EEå¾®æœåŠ¡æ¡†æ¶ï¼Œç”¨äºæ„å»ºå¿«é€Ÿé«˜æ•ˆçš„äº‘åŸç”ŸJavaå¾®æœåŠ¡åº”ç”¨ï¼Œåªè¿è¡Œæ‰€éœ€çš„æœåŠ¡ï¼ŒåŒæ—¶è€ƒè™‘æœ€æ–°çš„Eclipse MicroProfileæ ‡å‡† Helidon by Oracleï¼šè¿™æ˜¯ä¸€ä¸ªJavaåº“çš„é›†åˆï¼Œç”¨äºç¼–å†™åœ¨å¿«é€Ÿçš„Helidon Reactive WebServerä¸Šè¿è¡Œçš„Javaå¾®æœåŠ¡ï¼Œè¿™æ˜¯ä¸€ä¸ªç”±Nettyé©±åŠ¨çš„Webæ ¸å¿ƒï¼ŒåŒæ—¶æ”¯æŒMicroProfileåŠå…¶æ ‡å‡†è§„èŒƒã€‚ KumuluzEEï¼šæ˜¯ä¸€ä¸ªè½»é‡çº§æ¡†æ¶ï¼Œç”¨äºä½¿ç”¨æ ‡å‡†çš„Java/JavaEE/JakartaEE/EE4JæŠ€æœ¯å’ŒAPIå¼€å‘å¾®æœåŠ¡ï¼Œå¯é€‰æ‹©æ‰©å±•ï¼Œå¦‚ä½¿ç”¨Node.jsã€Goå’Œå…¶ä»–è¯­è¨€ï¼Œå¹¶å°†ç°æœ‰åº”ç”¨ç¨‹åºè¿ç§»åˆ°äº‘åŸç”Ÿæ¶æ„å’Œå¾®æœåŠ¡ï¼Œä»¥ä¾¿æ›´å®¹æ˜“åœ°è¿›è¡Œäº‘åŸç”Ÿå¾®æœåŠ¡å¼€å‘ã€‚ Launcher by Fujitsuï¼šå®ƒç”±å¯Œå£«é€šå…¬å¸å¼€å‘ï¼Œæ˜¯ä¸€ä¸ªæ”¯æŒæŸäº›MicroProfileè§„èŒƒçš„Java EEå¾®æœåŠ¡æ¡†æ¶ï¼Œå¯ä»¥å°†åº”ç”¨æ†ç»‘åˆ°Ã¼ber-jar/fatæ–‡ä»¶ï¼ˆJARæ–‡ä»¶ï¼ŒåŒ…å«å…¶æ‰€æœ‰éœ€è¦çš„ä¾èµ–é¡¹ï¼‰ ThornTail (è¿‡æ—¶çš„)ï¼šæ˜¯ä¸€ä¸ªJavaä¼ä¸šçº§å¾®æœåŠ¡æ¡†æ¶ï¼Œå®ƒåªå°†éœ€è¦çš„å’ŒæŒ‡å®šçš„åŒ…æ†ç»‘åˆ°ä¸€ä¸ªJARæ–‡ä»¶ä¸­ï¼Œå¹¶æœ‰è¶³å¤Ÿçš„è¿è¡Œæ—¶é—´æ¥è¿è¡Œå®ƒä»¬ MicroProfileå‘å±•å†å² Infoq ä¸Šæœ‰ä¸€æ®µä»‹ç»ï¼š\n2016 å¹´å¹´ä¸­ï¼Œä½œä¸ºå¯¹ Oracle åœ¨å‘å¸ƒ Java EE 8 æ–¹é¢åœæ»ä¸å‰çš„ç›´æ¥å›åº”ï¼Œç¤¾åŒºå‘èµ·äº†ä¸¤ä¸ªæ–°çš„å€¡è®®ï¼Œä¹Ÿå°±æ˜¯MicroProfileå’Œ Java EE Guardiansï¼ˆç°åœ¨è¢«ç§°ä¸ºJakarta EE Ambassadorsï¼‰ã€‚Java ç¤¾åŒºè®¤ä¸ºï¼Œéšç€ç”¨äºæ„å»ºå¾®æœåŠ¡åº”ç”¨çš„ web æœåŠ¡æŠ€æœ¯çš„å‡ºç°ï¼Œä¼ä¸šçº§ Java å·²ç»è½åäºæ—¶ä»£äº†ã€‚\nMicroProfile å€¡è®®æ˜¯åœ¨2016å¹´6æœˆ27æ—¥Red Hatçš„DevNationä¼šè®®ä¸Šå‘èµ·çš„ï¼Œå®ƒæ˜¯ç”± IBMã€Red Hatã€Tomitribeã€Payara ç­‰å‚å•†åä½œåˆ›å»ºçš„ï¼Œæ—¨åœ¨ä¸ºä¼ä¸šçº§ Java æä¾›å¾®æœåŠ¡ã€‚MicroProfile 1.0çš„å‘å¸ƒæ˜¯åœ¨ JavaOne 2016 ä¸Šå®£å¸ƒçš„ï¼Œå®ƒåŒ…å«äº†ä¸‰ä¸ªåŸºäº JSR çš„ APIï¼Œè¿™äº› API è¢«è§†ä¸ºåˆ›å»ºå¾®æœåŠ¡çš„æœ€ä½é™åº¦è¦æ±‚ï¼Œå³JSR-346ï¼šä¸Šä¸‹æ–‡å’Œä¾èµ–æ³¨å…¥ï¼ˆCDIï¼‰ã€JSR-353ï¼šJSON å¤„ç†çš„ Java APIï¼ˆJSON-Pï¼‰ä»¥åŠJSR-339ï¼šRESTful Web æœåŠ¡çš„ Java APIï¼ˆJAX-RSï¼‰ã€‚\nåˆ° 2018 å¹´ 2 æœˆMicroProfile 1.3å‘å¸ƒçš„æ—¶å€™ï¼Œå·²ç»åˆ›å»ºäº†å…«ä¸ªåŸºäºç¤¾åŒºçš„ APIï¼Œä»¥è¡¥å……æœ€åˆçš„ä¸‰ä¸ªåŸºäº JSR çš„ APIï¼Œç”¨æ¥æ„å»ºæ›´åŠ å¥å£®çš„åŸºäºå¾®æœåŠ¡çš„åº”ç”¨ã€‚éšç€MicroProfile 2.0çš„å‘å¸ƒï¼Œå¢åŠ äº†ç¬¬å››ä¸ªåŸºäº JSR çš„ APIï¼Œå³JSR-367ï¼šJSON ç»‘å®šçš„ Java APIï¼ˆJSON-Bï¼‰ã€‚\nåŸå®šäº 2020 å¹´ 6 æœˆå‘å¸ƒçš„ MicroProfile 4.0è¢«æ¨è¿Ÿäº†ï¼Œä»¥ä¾¿äºæŒ‰ç…§ Eclipse åŸºé‡‘ä¼šçš„æˆæƒæˆç«‹MicroProfileå·¥ä½œç»„ã€‚è¯¥å·¥ä½œç»„å®šä¹‰äº†MicroProfileè§„èŒƒæµç¨‹å’Œæ­£å¼çš„æŒ‡å¯¼å§”å‘˜ä¼šï¼Œè¯¥å§”å‘˜ä¼šç”±å„ç»„ç»‡å’Œ Java ç”¨æˆ·ç»„ï¼ˆJava User Groupï¼ŒJUGï¼‰ç»„æˆï¼Œå³äºšç‰¹å…°å¤§JUGã€IBM, Jelasticã€Red Hatå’ŒTomitribeã€‚é¢„è®¡å…¶ä»–çš„ç»„ç»‡å’Œ JUG ä¼šåœ¨ 2021 å¹´åŠ å…¥ã€‚MicroProfile å·¥ä½œç»„åœ¨ 2020 å¹´ 12 æœˆ 23 æ—¥å‘å¸ƒäº† MicroProfile 4.0ï¼Œå…¶ç‰¹æ€§æ˜¯å¯¹12ä¸ªæ ¸å¿ƒAPIè¿›è¡Œæ›´æ–°å¹¶ä¸Jakarta EE 8ä¿æŒä¸€è‡´ã€‚\nMicroProfile çš„åˆ›å§‹å‚å•†æä¾›äº†è‡ªå·±çš„å¾®æœåŠ¡æ¡†æ¶ï¼Œåˆ†åˆ«æ˜¯Open Libertyï¼ˆIBMï¼‰ã€WildFly Swarm/Thorntailï¼ˆRed Hatï¼‰ã€TomEEï¼ˆTomitribe å’ŒPayara Microï¼ˆPayaraï¼‰ï¼Œå®ƒä»¬æœ€ç»ˆéƒ½æ”¯æŒäº† MicroProfile å€¡è®®ã€‚\nåœ¨ 2018 å¹´çš„å¹´ä¸­ï¼ŒRed Hat å°† WildFly Swarmï¼ˆè¿™æ˜¯ Red Hat çš„æ ¸å¿ƒåº”ç”¨æœåŠ¡å™¨WildFlyçš„æ‰©å±•ï¼‰é‡å‘½åä¸ºThorntailï¼Œä»è€Œä¸ºå®ƒçš„å¾®æœåŠ¡æ¡†æ¶æä¾›è‡ªå·±çš„æ ‡è¯†ã€‚ä½†æ˜¯ï¼Œä¸åˆ°ä¸€å¹´ä¹‹åï¼ŒRed Hat å‘å¸ƒäº†Quarkusï¼Œè¿™æ˜¯ä¸€ä¸ªâ€œä¸º OpenJDK HotSpot å’Œ GraalVM é‡èº«å®šåšçš„ Kubernetes åŸç”Ÿ Java æ ˆï¼ŒåŸºäºæœ€ä¼˜ç§€çš„ Java åº“å’Œæ ‡å‡†ç²¾å¿ƒæ‰“é€ â€ã€‚Quarkus è¢«ç§°ä¸ºâ€œè¶…éŸ³é€ŸäºšåŸå­çš„ Javaâ€ï¼Œåœ¨ Java ç¤¾åŒºè¿…é€Ÿæµè¡Œäº†èµ·æ¥ï¼Œä»¥è‡³äº Red Hatå®£å¸ƒThorntailåœ¨2020å¹´7æœˆå¯¿ç»ˆæ­£å¯ã€‚Quarkus åŠ å…¥äº†ç›¸å¯¹è¾ƒæ–°çš„æ¡†æ¶Micronautå’ŒHelidonçš„è¡Œåˆ—ï¼Œè¿™ä¸¤ä¸ªæ¡†æ¶éƒ½æ˜¯åœ¨æ­¤ä¹‹å‰ä¸åˆ°ä¸€å¹´å‰å¼•å…¥ Java ç¤¾åŒºçš„ã€‚é™¤äº† Micronaut ä¹‹å¤–ï¼Œæ‰€æœ‰è¿™äº›åŸºäºå¾®æœåŠ¡çš„æ¡†æ¶éƒ½æ”¯æŒ MicroProfile å€¡è®®ã€‚\nMicroProfileçš„å‘å±•å†å²å¯ä»¥è¿½æº¯åˆ°2016å¹´ã€‚ä»¥ä¸‹æ˜¯MicroProfileçš„å…³é”®é‡Œç¨‹ç¢‘å’Œå‘å±•é˜¶æ®µï¼š\n2016å¹´6æœˆ - ç”±Red Hatã€IBMã€Tomitribeã€Payaraå’ŒLJCï¼ˆLondon Java Communityï¼‰ç­‰å…¬å¸å’Œç»„ç»‡å…±åŒå‘èµ·äº†MicroProfileé¡¹ç›®ã€‚æ—¨åœ¨åˆ›å»ºä¸€ä¸ªå¼€æ”¾çš„ã€ä¾›åº”å•†ä¸­ç«‹çš„Javaå¾®æœåŠ¡è§„èŒƒã€‚ 2016å¹´9æœˆ - MicroProfile 1.0å‘å¸ƒï¼ŒåŒ…æ‹¬Java API for RESTful Web Servicesï¼ˆJAX-RSï¼‰ã€Java API for JSON Processingï¼ˆJSON-Pï¼‰ã€Java API for WebSocketï¼ˆWebSocketï¼‰ç­‰è§„èŒƒã€‚ 2017å¹´5æœˆ - MicroProfile 1.1å‘å¸ƒï¼Œå¼•å…¥Config APIè§„èŒƒï¼Œç”¨äºå¤–éƒ¨é…ç½®çš„ç®¡ç†ã€‚ 2017å¹´9æœˆ - MicroProfile 1.2å‘å¸ƒï¼Œæ·»åŠ äº†Health Check APIè§„èŒƒï¼Œç”¨äºæ£€æŸ¥åº”ç”¨ç¨‹åºçš„å¥åº·çŠ¶æ€ã€‚ 2018å¹´2æœˆ - MicroProfile 1.3å‘å¸ƒï¼Œå¼•å…¥äº†OpenAPIè§„èŒƒï¼ˆä»¥å‰ç§°ä¸ºSwaggerï¼‰ï¼Œç”¨äºAPIæ–‡æ¡£å’Œå¯è§†åŒ–ã€‚ 2018å¹´5æœˆ - MicroProfile 2.0å‘å¸ƒï¼Œå‡çº§äº†åŸºç¡€è§„èŒƒç‰ˆæœ¬ï¼Œå¹¶æ·»åŠ äº†Fault Tolerance APIè§„èŒƒï¼Œç”¨äºå®¹é”™å’Œå¼¹æ€§ã€‚ 2018å¹´11æœˆ - MicroProfile 2.1å‘å¸ƒï¼Œå¢åŠ äº†Metrics APIè§„èŒƒï¼Œç”¨äºåº”ç”¨ç¨‹åºçš„æ€§èƒ½ç›‘æ§å’ŒæŒ‡æ ‡æ”¶é›†ã€‚ 2019å¹´3æœˆ - MicroProfile 2.2å‘å¸ƒï¼Œå¼•å…¥äº†JWT RBACï¼ˆRole-Based Access Controlï¼‰è§„èŒƒï¼Œç”¨äºèº«ä»½éªŒè¯å’Œæˆæƒã€‚ 2019å¹´11æœˆ - MicroProfile 3.0å‘å¸ƒï¼Œå‡çº§äº†åŸºç¡€è§„èŒƒç‰ˆæœ¬ï¼Œæ”¯æŒJava EE 8å’ŒJakarta EEè§„èŒƒã€‚ 2020å¹´2æœˆ - MicroProfile 3.1å‘å¸ƒï¼Œå‡çº§äº†åŸºç¡€è§„èŒƒç‰ˆæœ¬ï¼Œå¹¶å¢åŠ äº†å…¶ä»–æ”¹è¿›å’Œä¿®å¤ã€‚ 2021å¹´5æœˆ - MicroProfile 4.0å‘å¸ƒï¼Œå‡çº§äº†åŸºç¡€è§„èŒƒç‰ˆæœ¬ï¼Œå¹¶å¼•å…¥äº†é‡å¤§æ”¹è¿›å’Œæ–°åŠŸèƒ½ï¼Œå¦‚Context Propagationã€Reactive Messagingç­‰ã€‚ MicroProfile Config MicroProfile Configæ˜¯MicroProfileçš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼Œå®ƒæä¾›äº†ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥å°†é…ç½®ä»å¾®æœåŠ¡ä¸­å¤–éƒ¨åŒ–ã€‚è¿™ä½¿å¾—åº”ç”¨å’Œå¾®æœåŠ¡å¯ä»¥åœ¨å¤šä¸ªç¯å¢ƒä¸­è¿è¡Œï¼Œæ— éœ€ä¿®æ”¹æˆ–é‡æ–°æ‰“åŒ…ã€‚é…ç½®æ•°æ®å¯ä»¥åŠ¨æ€å˜åŒ–ï¼Œåº”ç”¨éœ€è¦èƒ½å¤Ÿåœ¨ä¸é‡æ–°å¯åŠ¨æœåŠ¡å™¨çš„æƒ…å†µä¸‹è®¿é—®æœ€æ–°çš„é…ç½®ä¿¡æ¯ã€‚\nMicroProfile Configå…è®¸ä»ä¸åŒçš„ä½ç½®å’Œä¸åŒçš„æ ¼å¼è·å–é…ç½®æ•°æ®ï¼Œå¦‚ç³»ç»Ÿå±æ€§ã€ç³»ç»Ÿç¯å¢ƒå˜é‡ã€.propertiesã€.xmlå’Œæ•°æ®æºç­‰ï¼Œè¿™äº›é…ç½®ä½ç½®è¢«ç§°ä¸ºConfigSourcesã€‚\nå®ƒæä¾›äº†ä¸€ç§æ–¹å¼ï¼Œå¯ä»¥ä»è®¸å¤šä¸åŒçš„ConfigSourcesèšåˆé…ç½®ï¼Œå¹¶å‘ˆç°è¿™äº›é…ç½®çš„å•ä¸€ã€ç»Ÿä¸€çš„è§†å›¾ã€‚MicroProfile Configæä¾›äº†ä¸¤ç§è·å–é…ç½®å±æ€§çš„æ–¹å¼ï¼šç¼–ç¨‹æ–¹å¼å’Œé€šè¿‡ä¸Šä¸‹æ–‡å’Œä¾èµ–æ³¨å…¥ï¼ˆCDIï¼‰ã€‚\nåœ¨ç¼–ç¨‹æ–¹å¼ä¸­ï¼Œä½ é¦–å…ˆè·å–åŒ…å«æ‰€æœ‰å¯ä»¥è®¿é—®çš„å±æ€§çš„Configå¯¹è±¡ï¼Œç„¶åé€šè¿‡getValue(String propertyName, Class\u0026lt;?\u0026gt; propertyValueType)æŸ¥æ‰¾å•ä¸ªå±æ€§ã€‚ä½¿ç”¨CDIï¼Œå¯ä»¥ç›´æ¥å°†é…ç½®å±æ€§å€¼æ³¨å…¥åˆ°åº”ç”¨ä¸­ï¼Œæ— éœ€åº”ç”¨ä»£ç æ¥æ£€ç´¢å®ƒä»¬ã€‚\næ­¤å¤–ï¼Œè¿˜å¯ä»¥æ ¹æ®MicroProfile Configçš„è§„å®šåˆ›å»ºè‡ªå®šä¹‰çš„ConfigSourceã€‚é€šè¿‡è‡ªå®šä¹‰ConfigSourceï¼Œå¯ä»¥è¯»å–é¢å¤–çš„é…ç½®å€¼ï¼Œå¹¶å°†å®ƒä»¬ä»¥å®šä¹‰çš„é¡ºåºæ·»åŠ åˆ°Configå®ä¾‹ä¸­ã€‚è¿™å…è®¸è¦†ç›–æ¥è‡ªå…¶ä»–æºçš„å€¼æˆ–å›é€€åˆ°å…¶ä»–å€¼ã€‚\nå‚è€ƒæ–‡ç«  https://microprofile.io/\nMicroProfile 6.1\nMicroProfile æ˜¯ä»€ä¹ˆï¼Ÿ\nEclipse MicroProfile ç®€ä»‹\nä»€ä¹ˆæ˜¯Eclipse MicroProfileï¼Ÿ\nSpring Bootä¸Eclipse MicroProfileæ¯”è¾ƒ\nMicroProfile å¯¹å¾®æœåŠ¡æ¡†æ¶çš„å½±å“ | InfoQ åœ†æ¡Œ\nMicroProfile ç¼–ç¨‹æ¨¡å‹æ”¯æŒ\nå­¦ä¹ å¦‚ä½•ä½¿ç”¨MicroProfile\nä½¿ç”¨ Quarkus å’Œ MicroProfile å®ç°å¾®æœåŠ¡ç‰¹æ€§\nMicroProfile äº‘åŸç”Ÿå¾®æœåŠ¡å¼€å‘ç¼–ç¨‹æ¨¡å‹\nä½¿ç”¨ MicroProfileã€ConfigMapsã€Secrets å®ç°å¤–éƒ¨åŒ–åº”ç”¨é…ç½®\nEclipse MicroProfile ä¼ä¸šçº§å¾®æœåŠ¡å®ç”¨æŒ‡å—\näºšä¿¡Webåº”ç”¨ä¸­é—´ä»¶ï¼ˆFlyingServerï¼‰é€šè¿‡Eclipse MicroProfileåŠŸèƒ½æµ‹è¯„\nå¾®æœåŠ¡æ¡†æ¶ï¼šå¦‚æœä¸ç”¨ Spring Bootï¼Œè¿˜å¯ä»¥é€‰æ‹©è°ï¼Ÿ\nâ€œAzure ä¸Šçš„ Eclipse MicroProfileâ€æ–‡æ¡£\nJBoss 4.2. MicroProfile é…ç½®å¼€å‘\nQUARKUS - MICROPROFILE å¥åº·æ£€æŸ¥\n","permalink":"https://blog.chensoul.cc/posts/2023/12/14/all-things-about-microprofile/","summary":"æœ€è¿‘åœ¨ä¸€äº›å¼€æºé¡¹ç›®ä¸­çœ‹åˆ°äº† MicroProfile ï¼Œäºæ˜¯åœ¨ç½‘ä¸ŠæŸ¥é˜…äº†ç›¸å…³èµ„æ–™åŠ æ·±å¯¹ MicroProfile çš„ç†è§£ï¼Œå¹¶åšäº†ç¬”è®°å½¢æˆæ­¤æ–‡ã€‚\nMicroProfile MicroProfileæ˜¯ä¸€ä¸ªå¼€æ”¾çš„ä¼ä¸šçº§Javaå¾®æœåŠ¡æ¡†æ¶ï¼Œæ—¨åœ¨ç®€åŒ–å’Œæ ‡å‡†åŒ–åŸºäºå¾®æœåŠ¡æ¶æ„çš„åº”ç”¨ç¨‹åºå¼€å‘ã€‚å®ƒæ˜¯ç”±Eclipse Foundationä¸»å¯¼çš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œè‡´åŠ›äºæä¾›è½»é‡çº§ã€å¯ç§»æ¤å’Œå¯äº’æ“ä½œçš„Javaå¾®æœåŠ¡è§„èŒƒå’Œå®ç°ã€‚\nMicroProfileçš„ç›®æ ‡æ˜¯ä¸ºJavaå¼€å‘äººå‘˜æä¾›ä¸€ä¸ªè§„èŒƒé›†åˆï¼Œä½¿ä»–ä»¬èƒ½å¤Ÿæ›´è½»æ¾åœ°æ„å»ºå’Œéƒ¨ç½²äº‘åŸç”Ÿåº”ç”¨ç¨‹åºã€‚å®ƒç»“åˆäº†Java EEã€Jakarta EEå’Œå…¶ä»–ç›¸å…³è§„èŒƒï¼Œä¸ºå¼€å‘äººå‘˜æä¾›äº†ä¸€ç»„æ ¸å¿ƒåŠŸèƒ½å’Œæ‰©å±•ï¼Œä»¥æ”¯æŒæ„å»ºå¯ä¼¸ç¼©ã€å¼¹æ€§å’Œé«˜æ€§èƒ½çš„å¾®æœåŠ¡åº”ç”¨ç¨‹åºã€‚\nMicroProfileæä¾›äº†ä¸€ç³»åˆ—çš„è§„èŒƒï¼ŒåŒ…æ‹¬ï¼š\nMicroProfile Config MicroProfile JWT RBAC MicroProfile Health MicroProfile Fault Tolerance MicroProfile Metrics MicroProfile OpenAPI MicroProfile OpenTracing MicroProfile REST Client MicroProfile Context Propagation MicroProfile Reactive Streams Operators MicroProfile Reactive Messaging MicroProfile GraphQL MicroProfile Long Running Actions MicroProfile Telemetry MicroProfile å®ç°ï¼š\nPayara Microï¼šæ˜¯ä¸€ä¸ªç”¨äºå®¹å™¨åŒ–Jakarta EEåº”ç”¨éƒ¨ç½²çš„è½»é‡çº§ä¸­é—´ä»¶å¹³å°ï¼Œä¸éœ€è¦å®‰è£…ã€é…ç½®æˆ–é‡å†™ä»£ç ï¼Œå¯ä»¥å¿«é€Ÿéƒ¨ç½² WildFly by Redhatï¼šæ˜¯ä¸€ä¸ªè½»é‡çº§ã€æ¨¡å—åŒ–çš„å¾®æœåŠ¡æ¡†æ¶ï¼Œé›†ä¸­ã€ç®€å•ã€ä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒï¼Œå®ç°äº†Jakarta EEå’ŒEclipse MicroProfileçš„æœ€æ–°ä¼ä¸šJavaæ ‡å‡†ã€‚ Quarkus by RedHatï¼šä¸ºGraalVMå’ŒOpenJDK HotSpotæ„å»ºçš„Kubernetes Native Javaå †æ ˆï¼Œç”±æœ€ä½³çš„Javaåº“å’Œæ ‡å‡†ç²¾å¿ƒæ‰“é€ ã€‚ Apache TomEEï¼šè¿™æ˜¯Apache Tomcat Javaä¼ä¸šç‰ˆï¼Œå®ƒç»“åˆäº†å‡ ä¸ªJavaä¼ä¸šé¡¹ç›®ï¼ŒåŒ…æ‹¬Apache OpenEJBã€Apache OpenJPAã€Apache OpenWebBeansã€Apache MyFaceså’Œå…¶ä»–è®¸å¤šé¡¹ç›®ã€‚ Hammockï¼šè¿™æ˜¯ä¸€ä¸ªåŸºäºCDIçš„bootstrapping Javaä¼ä¸šå¾®æœåŠ¡æ¡†æ¶ï¼Œç”±äºå…¶çµæ´»æ€§å’Œç®€å•æ€§ï¼Œç”¨äºæ„å»ºåº”ç”¨ç¨‹åº Openlibertyï¼šæ˜¯ä¸€ä¸ªå¼€æºçš„è½»é‡çº§Java EEå¾®æœåŠ¡æ¡†æ¶ï¼Œç”¨äºæ„å»ºå¿«é€Ÿé«˜æ•ˆçš„äº‘åŸç”ŸJavaå¾®æœåŠ¡åº”ç”¨ï¼Œåªè¿è¡Œæ‰€éœ€çš„æœåŠ¡ï¼ŒåŒæ—¶è€ƒè™‘æœ€æ–°çš„Eclipse MicroProfileæ ‡å‡† Helidon by Oracleï¼šè¿™æ˜¯ä¸€ä¸ªJavaåº“çš„é›†åˆï¼Œç”¨äºç¼–å†™åœ¨å¿«é€Ÿçš„Helidon Reactive WebServerä¸Šè¿è¡Œçš„Javaå¾®æœåŠ¡ï¼Œè¿™æ˜¯ä¸€ä¸ªç”±Nettyé©±åŠ¨çš„Webæ ¸å¿ƒï¼ŒåŒæ—¶æ”¯æŒMicroProfileåŠå…¶æ ‡å‡†è§„èŒƒã€‚ KumuluzEEï¼šæ˜¯ä¸€ä¸ªè½»é‡çº§æ¡†æ¶ï¼Œç”¨äºä½¿ç”¨æ ‡å‡†çš„Java/JavaEE/JakartaEE/EE4JæŠ€æœ¯å’ŒAPIå¼€å‘å¾®æœåŠ¡ï¼Œå¯é€‰æ‹©æ‰©å±•ï¼Œå¦‚ä½¿ç”¨Node.jsã€Goå’Œå…¶ä»–è¯­è¨€ï¼Œå¹¶å°†ç°æœ‰åº”ç”¨ç¨‹åºè¿ç§»åˆ°äº‘åŸç”Ÿæ¶æ„å’Œå¾®æœåŠ¡ï¼Œä»¥ä¾¿æ›´å®¹æ˜“åœ°è¿›è¡Œäº‘åŸç”Ÿå¾®æœåŠ¡å¼€å‘ã€‚ Launcher by Fujitsuï¼šå®ƒç”±å¯Œå£«é€šå…¬å¸å¼€å‘ï¼Œæ˜¯ä¸€ä¸ªæ”¯æŒæŸäº›MicroProfileè§„èŒƒçš„Java EEå¾®æœåŠ¡æ¡†æ¶ï¼Œå¯ä»¥å°†åº”ç”¨æ†ç»‘åˆ°Ã¼ber-jar/fatæ–‡ä»¶ï¼ˆJARæ–‡ä»¶ï¼ŒåŒ…å«å…¶æ‰€æœ‰éœ€è¦çš„ä¾èµ–é¡¹ï¼‰ ThornTail (è¿‡æ—¶çš„)ï¼šæ˜¯ä¸€ä¸ªJavaä¼ä¸šçº§å¾®æœåŠ¡æ¡†æ¶ï¼Œå®ƒåªå°†éœ€è¦çš„å’ŒæŒ‡å®šçš„åŒ…æ†ç»‘åˆ°ä¸€ä¸ªJARæ–‡ä»¶ä¸­ï¼Œå¹¶æœ‰è¶³å¤Ÿçš„è¿è¡Œæ—¶é—´æ¥è¿è¡Œå®ƒä»¬ MicroProfileå‘å±•å†å² Infoq ä¸Šæœ‰ä¸€æ®µä»‹ç»ï¼š\n2016 å¹´å¹´ä¸­ï¼Œä½œä¸ºå¯¹ Oracle åœ¨å‘å¸ƒ Java EE 8 æ–¹é¢åœæ»ä¸å‰çš„ç›´æ¥å›åº”ï¼Œç¤¾åŒºå‘èµ·äº†ä¸¤ä¸ªæ–°çš„å€¡è®®ï¼Œä¹Ÿå°±æ˜¯MicroProfileå’Œ Java EE Guardiansï¼ˆç°åœ¨è¢«ç§°ä¸ºJakarta EE Ambassadorsï¼‰ã€‚Java ç¤¾åŒºè®¤ä¸ºï¼Œéšç€ç”¨äºæ„å»ºå¾®æœåŠ¡åº”ç”¨çš„ web æœåŠ¡æŠ€æœ¯çš„å‡ºç°ï¼Œä¼ä¸šçº§ Java å·²ç»è½åäºæ—¶ä»£äº†ã€‚","title":"All things about MicroProfile"},{"content":"è¿™æ˜¯ä¸€ç¯‡åŒè¯­ç¿»è¯‘çš„æ–‡ç« ï¼ŒåŸæ–‡å‡ºè‡ª grok_system_design_interview.pdf çš„ä¸€ç¯‡æ–‡ç« ã€ŠDesigning Twitterã€‹è®¾è®¡ Twitterã€‚\nLetâ€™s design a Twitter-like social networking service. Users of the service will be able to post tweets, follow other people, and favorite tweets. Difficulty Level: Medium\nè®©æˆ‘ä»¬è®¾è®¡ä¸€ä¸ªç±»ä¼¼ Twitter çš„ç¤¾äº¤ç½‘ç»œæœåŠ¡ã€‚è¯¥æœåŠ¡çš„ç”¨æˆ·å°†èƒ½å¤Ÿå‘å¸ƒæ¨æ–‡ã€å…³æ³¨å…¶ä»–äººä»¥åŠå–œæ¬¢çš„æ¨æ–‡ã€‚éš¾åº¦çº§åˆ«ï¼šä¸­ç­‰\n1. What is Twitter? 1.ä»€ä¹ˆæ˜¯æ¨ç‰¹ï¼Ÿ\nTwitter is an online social networking service where users post and read short 140-character messages called â€œtweets.â€ Registered users can post and read tweets, but those who are not registered can only read them. Users access Twitter through their website interface, SMS, or mobile app.\nTwitter æ˜¯ä¸€ç§åœ¨çº¿ç¤¾äº¤ç½‘ç»œæœåŠ¡ï¼Œç”¨æˆ·å¯ä»¥åœ¨å…¶ä¸­å‘å¸ƒå’Œé˜…è¯»ç§°ä¸ºâ€œæ¨æ–‡â€çš„ 140 ä¸ªå­—ç¬¦çš„ç®€çŸ­æ¶ˆæ¯ã€‚æ³¨å†Œç”¨æˆ·å¯ä»¥å‘å¸ƒå’Œé˜…è¯»æ¨æ–‡ï¼Œä½†æœªæ³¨å†Œçš„ç”¨æˆ·åªèƒ½é˜…è¯»æ¨æ–‡ã€‚ç”¨æˆ·é€šè¿‡ç½‘ç«™ç•Œé¢ã€çŸ­ä¿¡æˆ–ç§»åŠ¨åº”ç”¨ç¨‹åºè®¿é—® Twitterã€‚\n2. Requirements and Goals of the System ç³»ç»Ÿçš„è¦æ±‚å’Œç›®æ ‡ We will be designing a simpler version of Twitter with the following requirements:\næˆ‘ä»¬å°†è®¾è®¡ä¸€ä¸ªæ›´ç®€å•çš„ Twitter ç‰ˆæœ¬ï¼Œå¹¶æ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š\nFunctional Requirements\nåŠŸèƒ½è¦æ±‚\nUsers should be able to post new tweets.\nç”¨æˆ·åº”è¯¥èƒ½å¤Ÿå‘å¸ƒæ–°çš„æ¨æ–‡ã€‚\nA user should be able to follow other users.\nç”¨æˆ·åº”è¯¥èƒ½å¤Ÿå…³æ³¨å…¶ä»–ç”¨æˆ·ã€‚\nUsers should be able to mark tweets as favorites.\nç”¨æˆ·åº”è¯¥èƒ½å¤Ÿå°†æ¨æ–‡æ ‡è®°ä¸ºæ”¶è—å¤¹ã€‚\nThe service should be able to create and display a userâ€™s timeline consisting of top tweets from all the people the user follows.\nè¯¥æœåŠ¡åº”è¯¥èƒ½å¤Ÿåˆ›å»ºå¹¶æ˜¾ç¤ºç”¨æˆ·çš„æ—¶é—´çº¿ï¼Œå…¶ä¸­åŒ…å«æ¥è‡ªä»¥ä¸‹ä½ç½®çš„çƒ­é—¨æ¨æ–‡ï¼šç”¨æˆ·å…³æ³¨çš„æ‰€æœ‰äººå‘˜ã€‚\nTweets can contain photos and videos.\næ¨æ–‡å¯ä»¥åŒ…å«ç…§ç‰‡å’Œè§†é¢‘ã€‚\nNon-functional Requirements\néåŠŸèƒ½æ€§éœ€æ±‚\nOur service needs to be highly available.\næˆ‘ä»¬çš„æœåŠ¡éœ€è¦é«˜åº¦å¯ç”¨ã€‚\nAcceptable latency of the system is 200ms for timeline generation.\næ—¶é—´çº¿ç”Ÿæˆç³»ç»Ÿå¯æ¥å—çš„å»¶è¿Ÿä¸º 200 æ¯«ç§’ã€‚\nConsistency can take a hit (in the interest of availability); if a user doesnâ€™t see a tweet for a while, it should be fine.\nä¸€è‡´æ€§å¯èƒ½ä¼šå—åˆ°å½±å“ï¼ˆä¸ºäº†å¯ç”¨æ€§ï¼‰ï¼›å¦‚æœç”¨æˆ·æ²¡æœ‰çœ‹åˆ°æŸæ¡æ¨æ–‡åŒæ—¶ï¼Œåº”è¯¥æ²¡é—®é¢˜ã€‚\nExtended Requirements\næ‰©å±•è¦æ±‚\nSearching for tweets.\næ­£åœ¨æœç´¢æ¨æ–‡ã€‚\nReplying to a tweet.\nå›å¤æ¨æ–‡ã€‚\nTrending topics â€“ current hot topics/searches.\nçƒ­é—¨è¯é¢˜ â€“ å½“å‰çš„çƒ­é—¨è¯é¢˜/æœç´¢ã€‚\nTagging other users.\næ ‡è®°å…¶ä»–ç”¨æˆ·ã€‚\nTweet Notification.\næ¨æ–‡é€šçŸ¥ã€‚\nWho to follow? Suggestions?\nè·Ÿéšè°ï¼Ÿå»ºè®®ï¼Ÿ\nMoments.\næ—¶åˆ»ã€‚\n3. Capacity Estimation and Constraints å®¹é‡ä¼°è®¡å’Œçº¦æŸ Letâ€™s assume we have one billion total users with 200 million daily active users (DAU). Also assume we have 100 million new tweets every day and on average each user follows 200 people.\nå‡è®¾æˆ‘ä»¬çš„æ€»ç”¨æˆ·æ•°ä¸º 10 äº¿ï¼Œå…¶ä¸­æ¯æ—¥æ´»è·ƒç”¨æˆ· (DAU) ä¸º 2 äº¿ã€‚è¿˜å‡è®¾æˆ‘ä»¬æ¯å¤©æœ‰ 1 äº¿æ¡æ–°æ¨æ–‡ï¼Œå¹³å‡æ¯ä¸ªç”¨æˆ·å…³æ³¨ 200 äººã€‚\nHow many favorites per day? If, on average, each user favorites five tweets per day we will have: 200M users * 5 favorites =\u0026gt; 1B favorites\næ¯å¤©æœ‰å¤šå°‘ä¸ªæ”¶è—å¤¹ï¼Ÿå¦‚æœå¹³å‡æ¯ä¸ªç”¨æˆ·æ¯å¤©æ”¶è— 5 æ¡æ¨æ–‡ï¼Œæˆ‘ä»¬å°†æ‹¥æœ‰ï¼š2 äº¿ç”¨æˆ· * 5 ä¸ªæ”¶è— =\u0026gt; 1B ä¸ªæ”¶è—\nHow many total tweet-views will our system generate? Letâ€™s assume on average a user visits their timeline two times a day and visits five other peopleâ€™s pages. On each page if a user sees 20 tweets, then our system will generate 28B/day total tweet-views:\næˆ‘ä»¬çš„ç³»ç»Ÿæ€»å…±ä¼šäº§ç”Ÿå¤šå°‘æ¨æ–‡æµè§ˆé‡ï¼Ÿå‡è®¾ç”¨æˆ·å¹³å‡æ¯å¤©è®¿é—®è‡ªå·±çš„æ—¶é—´çº¿ä¸¤æ¬¡ï¼Œå¹¶è®¿é—®å…¶ä»–äº”ä¸ªäººçš„é¡µé¢ã€‚å¦‚æœç”¨æˆ·åœ¨æ¯ä¸ªé¡µé¢ä¸Šçœ‹åˆ° 20 æ¡æ¨æ–‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ç³»ç»Ÿå°†ç”Ÿæˆ 28B/å¤©çš„æ€»æ¨æ–‡æµè§ˆé‡ï¼š\n200M DAU * ((2 + 5) * 20 tweets) =\u0026gt; 28B/day\nStorage Estimates Letâ€™s say each tweet has 140 characters and we need two bytes to store a character without compression. Letâ€™s assume we need 30 bytes to store metadata with each tweet (like ID, timestamp, user ID, etc.). Total storage we would need:\nå­˜å‚¨ä¼°ç®— å‡è®¾æ¯æ¡æ¨æ–‡æœ‰ 140 ä¸ªå­—ç¬¦ï¼Œæˆ‘ä»¬éœ€è¦ä¸¤ä¸ªå­—èŠ‚æ¥å­˜å‚¨ä¸€ä¸ªå­—ç¬¦è€Œä¸è¿›è¡Œå‹ç¼©ã€‚å‡è®¾æˆ‘ä»¬éœ€è¦ 30 ä¸ªå­—èŠ‚æ¥å­˜å‚¨æ¯æ¡æ¨æ–‡çš„å…ƒæ•°æ®ï¼ˆå¦‚ IDã€æ—¶é—´æˆ³ã€ç”¨æˆ· ID ç­‰ï¼‰ã€‚æˆ‘ä»¬éœ€è¦çš„æ€»å­˜å‚¨ç©ºé—´ï¼š\n100M * (280 + 30) bytes =\u0026gt; 30GB/day\nWhat would our storage needs be for five years? How much storage we would need for usersâ€™ data, follows, favorites? We will leave this for the exercise.\näº”å¹´å†…æˆ‘ä»¬çš„å­˜å‚¨éœ€æ±‚æ˜¯å¤šå°‘ï¼Ÿæˆ‘ä»¬éœ€è¦å¤šå°‘å­˜å‚¨ç©ºé—´æ¥å­˜å‚¨ç”¨æˆ·æ•°æ®ã€å…³æ³¨æ•°æ®ã€æ”¶è—å¤¹ï¼Ÿæˆ‘ä»¬å°†æŠŠå®ƒç•™ç»™ç»ƒä¹ ã€‚\nNot all tweets will have media, letâ€™s assume that on average every fifth tweet has a photo and every tenth has a video. Letâ€™s also assume on average a photo is 200KB and a video is 2MB. This will lead us to have 24TB of new media every day.\nå¹¶éæ‰€æœ‰æ¨æ–‡éƒ½ä¼šæœ‰åª’ä½“ï¼Œæˆ‘ä»¬å‡è®¾å¹³å‡æ¯äº”æ¡æ¨æ–‡æœ‰ä¸€å¼ ç…§ç‰‡ï¼Œæ¯ååˆ†ä¹‹ä¸€æœ‰ä¸€ä¸ªè§†é¢‘ã€‚æˆ‘ä»¬è¿˜å‡è®¾å¹³å‡ä¸€å¼ ç…§ç‰‡ä¸º 200KBï¼Œä¸€æ®µè§†é¢‘ä¸º 2MBã€‚è¿™å°†ä½¿æˆ‘ä»¬æ¯å¤©æ‹¥æœ‰ 24TB çš„æ–°åª’ä½“ã€‚\n(100M/5 photos * 200KB) + (100M/10 videos * 2MB) ~= 24TB/day\nBandwidth Estimates Since total ingress is 24TB per day, this would translate into 290MB/sec.\nå¸¦å®½ä¼°è®¡ ç”±äºæ€»å…¥å£é‡ä¸ºæ¯å¤© 24TBï¼Œè¿™å°†è½¬åŒ–ä¸º 290MB/ç§’ã€‚\nRemember that we have 28B tweet views per day. We must show the photo of every tweet (if it has a photo), but letâ€™s assume that the users watch every 3rd video they see in their timeline. So, total egress will be:\nè¯·è®°ä½ï¼Œæˆ‘ä»¬æ¯å¤©çš„æ¨æ–‡æµè§ˆé‡ä¸º 28Bã€‚æˆ‘ä»¬å¿…é¡»æ˜¾ç¤ºæ¯æ¡æ¨æ–‡çš„ç…§ç‰‡ï¼ˆå¦‚æœå®ƒæœ‰ç…§ç‰‡ï¼‰ï¼Œä½†æˆ‘ä»¬å‡è®¾ç”¨æˆ·è§‚çœ‹ä»–ä»¬åœ¨æ—¶é—´çº¿ä¸­çœ‹åˆ°çš„æ¯ç¬¬ä¸‰ä¸ªè§†é¢‘ã€‚å› æ­¤ï¼Œæ€»å‡ºå£å°†ä¸ºï¼š\n4. System APIs 4. ç³»ç»ŸAPI\nOnce weâ€™ve finalized the requirements, itâ€™s always a good idea to define the system APIs. This should explicitly state what is expected from the system.\nä¸€æ—¦æˆ‘ä»¬æœ€ç»ˆç¡®å®šäº†éœ€æ±‚ï¼Œå®šä¹‰ç³»ç»Ÿ API æ€»æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚è¿™åº”è¯¥æ˜ç¡®è¯´æ˜ç³»ç»Ÿçš„æœŸæœ›ã€‚\nWe can have SOAP or REST APIs to expose the functionality of our service. Following could be the definition of the API for posting a new tweet:\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨ SOAP æˆ– REST API æ¥å…¬å¼€æˆ‘ä»¬æœåŠ¡çš„åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯ç”¨äºå‘å¸ƒæ–°æ¨æ–‡çš„ API çš„å®šä¹‰ï¼š\ntweet(api_dev_key, tweet_data, tweet_location, user_location, media_ids, maximum_results_to_return) Parameters: å‚æ•°ï¼š\napi_dev_key (string): The API developer key of a registered account. This will be used to, among other things, throttle users based on their allocated quota. tweet_data (string): The text of the tweet, typically up to 140 characters. tweet_location (string): Optional location (longitude, latitude) this Tweet refers to. user_location (string): Optional location (longitude, latitude) of the user adding the tweet.\napi_dev_key (string): æ³¨å†Œè´¦æˆ·çš„APIå¼€å‘è€…å¯†é’¥ã€‚é™¤å…¶ä»–å¤–ï¼Œè¿™å°†ç”¨äºæ ¹æ®åˆ†é…çš„é…é¢é™åˆ¶ç”¨æˆ·ã€‚ tweet_dataï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šæ¨æ–‡çš„æ–‡æœ¬ï¼Œé€šå¸¸æœ€å¤š 140 ä¸ªå­—ç¬¦ã€‚ tweet_locationï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šæ­¤æ¨æ–‡æ‰€æŒ‡çš„å¯é€‰ä½ç½®ï¼ˆç»åº¦ã€çº¬åº¦ï¼‰ã€‚ user_locationï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šæ·»åŠ æ¨æ–‡çš„ç”¨æˆ·çš„å¯é€‰ä½ç½®ï¼ˆç»åº¦ã€çº¬åº¦ï¼‰ã€‚\nmedia_ids (number[]): Optional list of media_ids to be associated with the Tweet. (All the media photo, video, etc. need to be uploaded separately).\nmedia_ids (number[])ï¼šä¸æ¨æ–‡å…³è”çš„å¯é€‰ media_ids åˆ—è¡¨ã€‚ ï¼ˆæ‰€æœ‰åª’ä½“ç…§ç‰‡ã€è§†é¢‘ç­‰éœ€å•ç‹¬ä¸Šä¼ ï¼‰ã€‚\nReturns: (string) A successful post will return the URL to access that tweet. Otherwise, an appropriate HTTP error is returned.\nè¿”å›ï¼šï¼ˆå­—ç¬¦ä¸²ï¼‰æˆåŠŸå‘å¸ƒçš„å¸–å­å°†è¿”å›ç”¨äºè®¿é—®è¯¥æ¨æ–‡çš„ URLã€‚å¦åˆ™ï¼Œå°†è¿”å›é€‚å½“çš„ HTTP é”™è¯¯ã€‚\n5. High Level System Design é«˜å±‚ç³»ç»Ÿè®¾è®¡ We need a system that can efficiently store all the new tweets, 100M/86400s =\u0026gt; 1150 tweets per second and read 28B/86400s =\u0026gt; 325K tweets per second. It is clear from the requirements that this will be a read-heavy system.\næˆ‘ä»¬éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿé«˜æ•ˆå­˜å‚¨æ‰€æœ‰æ–°æ¨æ–‡çš„ç³»ç»Ÿï¼Œæ¯ç§’ 100M/86400s =\u0026gt; 1150 æ¡æ¨æ–‡ï¼Œæ¯ç§’è¯»å– 28B/86400s =\u0026gt; 325K æ¡æ¨æ–‡ã€‚ä»éœ€æ±‚ä¸­å¯ä»¥æ¸…æ¥šåœ°çœ‹å‡ºï¼Œè¿™å°†æ˜¯ä¸€ä¸ªè¯»å–ç¹é‡çš„ç³»ç»Ÿã€‚\nAt a high level, we need multiple application servers to serve all these requests with load balancers in front of them for traffic distributions. On the backend, we need an efficient database that can store all the new tweets and can support a huge number of reads. We also need some file storage to store photos and videos.\nåœ¨è¾ƒé«˜å±‚é¢ä¸Šï¼Œæˆ‘ä»¬éœ€è¦å¤šä¸ªåº”ç”¨ç¨‹åºæœåŠ¡å™¨æ¥æœåŠ¡æ‰€æœ‰è¿™äº›è¯·æ±‚ï¼Œå¹¶åœ¨å®ƒä»¬å‰é¢æä¾›è´Ÿè½½å‡è¡¡å™¨ä»¥è¿›è¡Œæµé‡åˆ†é…ã€‚åœ¨åç«¯ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªé«˜æ•ˆçš„æ•°æ®åº“ï¼Œèƒ½å¤Ÿå­˜å‚¨æ‰€æœ‰æ–°çš„æ¨æ–‡ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ”¯æŒæµ·é‡çš„è¯»å–ã€‚æˆ‘ä»¬è¿˜éœ€è¦ä¸€äº›æ–‡ä»¶å­˜å‚¨æ¥å­˜å‚¨ç…§ç‰‡å’Œè§†é¢‘ã€‚\nAlthough our expected daily write load is 100 million and read load is 28 billion tweets. This means on average our system will receive around 1160 new tweets and 325K read requests per second. This traffic will be distributed unevenly throughout the day, though, at peak time we should expect at least a few thousand write requests and around 1M read requests per second. We should keep this in mind while designing the architecture of our system.\nå°½ç®¡æˆ‘ä»¬é¢„è®¡æ¯æ—¥å†™å…¥è´Ÿè½½ä¸º 1 äº¿æ¡æ¨æ–‡ï¼Œè¯»å–è´Ÿè½½ä¸º 280 äº¿æ¡æ¨æ–‡ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬çš„ç³»ç»Ÿå¹³å‡æ¯ç§’å°†æ”¶åˆ°å¤§çº¦ 1160 æ¡æ–°æ¨æ–‡å’Œ 325K è¯»å–è¯·æ±‚ã€‚ä¸è¿‡ï¼Œè¯¥æµé‡åœ¨ä¸€å¤©ä¸­çš„åˆ†å¸ƒä¸å‡åŒ€ï¼Œä½†åœ¨é«˜å³°æ—¶æ®µï¼Œæˆ‘ä»¬é¢„è®¡æ¯ç§’è‡³å°‘æœ‰å‡ åƒä¸ªå†™å…¥è¯·æ±‚å’Œå¤§çº¦ 100 ä¸‡ä¸ªè¯»å–è¯·æ±‚ã€‚æˆ‘ä»¬åœ¨è®¾è®¡ç³»ç»Ÿæ¶æ„æ—¶åº”è¯¥ç‰¢è®°è¿™ä¸€ç‚¹ã€‚\n6. Database Schema æ•°æ®åº“æ¶æ„ We need to store data about users, their tweets, their favorite tweets, and people they follow.\næˆ‘ä»¬éœ€è¦å­˜å‚¨æœ‰å…³ç”¨æˆ·ã€ä»–ä»¬çš„æ¨æ–‡ã€ä»–ä»¬æœ€å–œæ¬¢çš„æ¨æ–‡ä»¥åŠä»–ä»¬å…³æ³¨çš„äººçš„æ•°æ®ã€‚\nFor choosing between SQL and NoSQL databases to store the above schema, please see â€˜Database schemaâ€™ under Designing Instagram.\nè¦åœ¨ SQL å’Œ NoSQL æ•°æ®åº“ä¹‹é—´è¿›è¡Œé€‰æ‹©æ¥å­˜å‚¨ä¸Šè¿°æ¶æ„ï¼Œè¯·å‚é˜…è®¾è®¡ Instagram ä¸‹çš„â€œæ•°æ®åº“æ¶æ„â€ã€‚\n7. Data Sharding 7.æ•°æ®åˆ†ç‰‡\nSince we have a huge number of new tweets every day and our read load is extremely high too, we need to distribute our data onto multiple machines such that we can read/write it efficiently. We have many options to shard our data; letâ€™s go through them one by one:\nç”±äºæˆ‘ä»¬æ¯å¤©éƒ½ä¼šæœ‰å¤§é‡çš„æ–°æ¨æ–‡ï¼Œå¹¶ä¸”è¯»å–è´Ÿè½½ä¹Ÿéå¸¸é«˜ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°†æ•°æ®åˆ†å‘åˆ°å¤šå°æœºå™¨ä¸Šï¼Œä»¥ä¾¿èƒ½å¤Ÿé«˜æ•ˆåœ°è¯»/å†™ã€‚æˆ‘ä»¬æœ‰å¾ˆå¤šé€‰æ‹©æ¥åˆ†ç‰‡æˆ‘ä»¬çš„æ•°æ®ï¼›è®©æˆ‘ä»¬ä¸€ä¸€åˆ†æä¸€ä¸‹ï¼š\nSharding based on UserID: We can try storing all the data of a user on one server. While storing, we can pass the UserID to our hash function that will map the user to a database server where we will store all of the userâ€™s tweets, favorites, follows, etc. While querying for tweets/follows/favorites of a user, we can ask our hash function where can we find the data of a user and then read it from there. This approach has a couple of issues:\nåŸºäºUserIDçš„åˆ†ç‰‡ï¼šæˆ‘ä»¬å¯ä»¥å°è¯•å°†ä¸€ä¸ªç”¨æˆ·çš„æ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šã€‚åœ¨å­˜å‚¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°† UserID ä¼ é€’ç»™æˆ‘ä»¬çš„å“ˆå¸Œå‡½æ•°ï¼Œè¯¥å‡½æ•°å°†ç”¨æˆ·æ˜ å°„åˆ°æ•°æ®åº“æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä¸­å­˜å‚¨ç”¨æˆ·çš„æ‰€æœ‰æ¨æ–‡ã€æ”¶è—å¤¹ã€å…³æ³¨ç­‰ã€‚åœ¨æŸ¥è¯¢ç”¨æˆ·çš„æ¨æ–‡/å…³æ³¨/æ”¶è—å¤¹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è¯¢é—®æˆ‘ä»¬çš„å“ˆå¸Œå‡½æ•°åœ¨å“ªé‡Œå¯ä»¥æ‰¾åˆ°ç”¨æˆ·çš„æ•°æ®ï¼Œç„¶åä»é‚£é‡Œè¯»å–å®ƒã€‚è¿™ç§æ–¹æ³•æœ‰å‡ ä¸ªé—®é¢˜ï¼š\nWhat if a user becomes hot? There could be a lot of queries on the server holding the user. This high load will affect the performance of our service.\nå¦‚æœç”¨æˆ·å˜å¾—çƒ­é—¨æ€ä¹ˆåŠï¼ŸæŒæœ‰ç”¨æˆ·çš„æœåŠ¡å™¨ä¸Šå¯èƒ½æœ‰å¾ˆå¤šæŸ¥è¯¢ã€‚è¿™ç§é«˜è´Ÿè½½ä¼šå½±å“æˆ‘ä»¬æœåŠ¡çš„æ€§èƒ½ã€‚\nOver time some users can end up storing a lot of tweets or having a lot of follows compared to others. Maintaining a uniform distribution of growing user data is quite difficult.\néšç€æ—¶é—´çš„æ¨ç§»ï¼Œä¸å…¶ä»–ç”¨æˆ·ç›¸æ¯”ï¼Œä¸€äº›ç”¨æˆ·æœ€ç»ˆå¯èƒ½ä¼šå­˜å‚¨å¤§é‡æ¨æ–‡æˆ–æ‹¥æœ‰å¤§é‡å…³æ³¨è€…ã€‚ä¿æŒä¸æ–­å¢é•¿çš„ç”¨æˆ·æ•°æ®çš„å‡åŒ€åˆ†å¸ƒæ˜¯ç›¸å½“å›°éš¾çš„ã€‚\nTo recover from these situations either we have to repartition/redistribute our data or use consistent hashing.\nä¸ºäº†ä»è¿™äº›æƒ…å†µä¸­æ¢å¤ï¼Œæˆ‘ä»¬å¿…é¡»é‡æ–°åˆ†åŒº/é‡æ–°åˆ†å¸ƒæˆ‘ä»¬çš„æ•°æ®æˆ–ä½¿ç”¨ä¸€è‡´çš„æ•£åˆ—ã€‚\nSharding based on TweetID: Our hash function will map each TweetID to a random server where we will store that Tweet. To search for tweets, we have to query all servers, and each server will return a set of tweets. A centralized server will aggregate these results to return them to the user. Letâ€™s look into timeline generation example; here are the number of steps our system has to perform to generate a userâ€™s timeline:\nåŸºäº TweetID çš„åˆ†ç‰‡ï¼šæˆ‘ä»¬çš„å“ˆå¸Œå‡½æ•°ä¼šå°†æ¯ä¸ª TweetID æ˜ å°„åˆ°ä¸€ä¸ªéšæœºæœåŠ¡å™¨ï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä¸­å­˜å‚¨è¯¥æ¨æ–‡ã€‚è¦æœç´¢æ¨æ–‡ï¼Œæˆ‘ä»¬å¿…é¡»æŸ¥è¯¢æ‰€æœ‰æœåŠ¡å™¨ï¼Œæ¯ä¸ªæœåŠ¡å™¨éƒ½ä¼šè¿”å›ä¸€ç»„æ¨æ–‡ã€‚ä¸­å¤®æœåŠ¡å™¨å°†æ±‡æ€»è¿™äº›ç»“æœå¹¶å°†å…¶è¿”å›ç»™ç”¨æˆ·ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æ—¶é—´çº¿ç”Ÿæˆç¤ºä¾‹ï¼›ä»¥ä¸‹æ˜¯æˆ‘ä»¬çš„ç³»ç»Ÿç”Ÿæˆç”¨æˆ·æ—¶é—´çº¿å¿…é¡»æ‰§è¡Œçš„æ­¥éª¤æ•°ï¼š\nOur application (app) server will find all the people the user follows.\næˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼ˆappï¼‰æœåŠ¡å™¨å°†æ‰¾åˆ°ç”¨æˆ·å…³æ³¨çš„æ‰€æœ‰äººå‘˜ã€‚\nApp server will send the query to all database servers to find tweets from these people.\nåº”ç”¨æœåŠ¡å™¨ä¼šå°†æŸ¥è¯¢å‘é€åˆ°æ‰€æœ‰æ•°æ®åº“æœåŠ¡å™¨ä»¥æŸ¥æ‰¾è¿™äº›äººçš„æ¨æ–‡ã€‚\nEach database server will find the tweets for each user, sort them by recency and return the top tweets.\næ¯ä¸ªæ•°æ®åº“æœåŠ¡å™¨éƒ½ä¼šæ‰¾åˆ°æ¯ä¸ªç”¨æˆ·çš„æ¨æ–‡ï¼ŒæŒ‰æ–°è¿‘åº¦å¯¹å®ƒä»¬è¿›è¡Œæ’åºå¹¶è¿”å›é¡¶éƒ¨æ¨æ–‡ã€‚\nApp server will merge all the results and sort them again to return the top results to the user.\nåº”ç”¨æœåŠ¡å™¨å°†åˆå¹¶æ‰€æœ‰ç»“æœå¹¶å†æ¬¡æ’åºï¼Œå°†æ’åé å‰çš„ç»“æœè¿”å›ç»™ç”¨æˆ·ã€‚\nThis approach solves the problem of hot users, but, in contrast to sharding by UserID, we have to query all database partitions to find tweets of a user, which can result in higher latencies.\nè¿™ç§æ–¹æ³•è§£å†³äº†çƒ­ç‚¹ç”¨æˆ·çš„é—®é¢˜ï¼Œä½†æ˜¯ï¼Œä¸æŒ‰ UserID åˆ†ç‰‡ç›¸æ¯”ï¼Œæˆ‘ä»¬å¿…é¡»æŸ¥è¯¢æ‰€æœ‰æ•°æ®åº“åˆ†åŒºæ‰èƒ½æ‰¾åˆ°ç”¨æˆ·çš„æ¨æ–‡ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æ›´é«˜çš„å»¶è¿Ÿã€‚\nWe can further improve our performance by introducing cache to store hot tweets in front of the database servers.\næˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨æ•°æ®åº“æœåŠ¡å™¨å‰é¢å¼•å…¥ç¼“å­˜æ¥å­˜å‚¨çƒ­é—¨æ¨æ–‡æ¥è¿›ä¸€æ­¥æé«˜æ€§èƒ½ã€‚\nSharding based on Tweet creation time: Storing tweets based on creation time will give us the advantage of fetching all the top tweets quickly and we only have to query a very small set of servers. The problem here is that the traffic load will not be distributed, e.g., while writing, all new tweets will be going to one server and the remaining servers will be sitting idle. Similarly, while reading, the server holding the latest data will have a very high load as compared to servers holding old data.\nåŸºäºæ¨æ–‡åˆ›å»ºæ—¶é—´çš„åˆ†ç‰‡ï¼šåŸºäºåˆ›å»ºæ—¶é—´å­˜å‚¨æ¨æ–‡å°†ä¸ºæˆ‘ä»¬æä¾›å¿«é€Ÿè·å–æ‰€æœ‰çƒ­é—¨æ¨æ–‡çš„ä¼˜åŠ¿ï¼Œå¹¶ä¸”æˆ‘ä»¬åªéœ€è¦æŸ¥è¯¢éå¸¸å°çš„ä¸€ç»„æœåŠ¡å™¨ã€‚è¿™é‡Œçš„é—®é¢˜æ˜¯æµé‡è´Ÿè½½ä¸ä¼šè¢«åˆ†é…ï¼Œä¾‹å¦‚ï¼Œåœ¨å†™å…¥æ—¶ï¼Œæ‰€æœ‰æ–°æ¨æ–‡å°†å‘é€åˆ°ä¸€å°æœåŠ¡å™¨ï¼Œè€Œå…¶ä½™æœåŠ¡å™¨å°†é—²ç½®ã€‚ç±»ä¼¼åœ°ï¼Œåœ¨è¯»å–æ—¶ï¼Œä¸ä¿å­˜æ—§æ•°æ®çš„æœåŠ¡å™¨ç›¸æ¯”ï¼Œä¿å­˜æœ€æ–°æ•°æ®çš„æœåŠ¡å™¨å°†å…·æœ‰éå¸¸é«˜çš„è´Ÿè½½ã€‚\nWhat if we can combine sharding by TweedID and Tweet creation time? If we donâ€™t store tweet creation time separately and use TweetID to reflect that, we can get benefits of both the approaches. This way it will be quite quick to find the latest Tweets. For this, we must make each TweetID universally unique in our system and each TweetID should contain a timestamp too.\nå¦‚æœæˆ‘ä»¬å¯ä»¥å°† TweedID å’Œæ¨æ–‡åˆ›å»ºæ—¶é—´çš„åˆ†ç‰‡ç»“åˆèµ·æ¥ä¼šæ€ä¹ˆæ ·ï¼Ÿå¦‚æœæˆ‘ä»¬ä¸å•ç‹¬å­˜å‚¨æ¨æ–‡åˆ›å»ºæ—¶é—´å¹¶ä½¿ç”¨ TweetID æ¥åæ˜ è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»è¿™ä¸¤ç§æ–¹æ³•ä¸­å—ç›Šã€‚è¿™æ ·å°±å¯ä»¥å¾ˆå¿«æ‰¾åˆ°æœ€æ–°çš„æ¨æ–‡ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿æ¯ä¸ª TweetID åœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸­æ™®éå”¯ä¸€ï¼Œå¹¶ä¸”æ¯ä¸ª TweetID ä¹Ÿåº”è¯¥åŒ…å«ä¸€ä¸ªæ—¶é—´æˆ³ã€‚\nWe can use epoch time for this. Letâ€™s say our TweetID will have two parts: the first part will be representing epoch seconds and the second part will be an auto-incrementing sequence. So, to make a new TweetID, we can take the current epoch time and append an auto-incrementing number to it. We can figure out the shard number from this TweetID and store it there.\næˆ‘ä»¬å¯ä»¥ä¸ºæ­¤ä½¿ç”¨çºªå…ƒæ—¶é—´ã€‚å‡è®¾æˆ‘ä»¬çš„ TweetID å°†æœ‰ä¸¤éƒ¨åˆ†ï¼šç¬¬ä¸€éƒ¨åˆ†å°†è¡¨ç¤ºçºªå…ƒç§’ï¼Œç¬¬äºŒéƒ¨åˆ†å°†æ˜¯è‡ªåŠ¨é€’å¢åºåˆ—ã€‚å› æ­¤ï¼Œè¦åˆ›å»ºä¸€ä¸ªæ–°çš„ TweetIDï¼Œæˆ‘ä»¬å¯ä»¥è·å–å½“å‰çºªå…ƒæ—¶é—´å¹¶å‘å…¶é™„åŠ ä¸€ä¸ªè‡ªåŠ¨é€’å¢çš„æ•°å­—ã€‚æˆ‘ä»¬å¯ä»¥ä»è¿™ä¸ª TweetID ä¸­æ‰¾å‡ºåˆ†ç‰‡ç¼–å·å¹¶å°†å…¶å­˜å‚¨åœ¨é‚£é‡Œã€‚\nWhat could be the size of our TweetID? Letâ€™s say our epoch time starts today, how many bits we would need to store the number of seconds for the next 50 years?\næˆ‘ä»¬çš„ TweetID çš„å¤§å°æ˜¯å¤šå°‘ï¼Ÿå‡è®¾æˆ‘ä»¬çš„çºªå…ƒæ—¶é—´ä»ä»Šå¤©å¼€å§‹ï¼Œæˆ‘ä»¬éœ€è¦å¤šå°‘ä½æ¥å­˜å‚¨æœªæ¥ 50 å¹´çš„ç§’æ•°ï¼Ÿ\n86400 sec/day * 365 (days a year) * 50 (years) =\u0026gt; 1.6B\nWe would need 31 bits to store this number. Since on average we are expecting 1150 new tweets per second, we can allocate 17 bits to store auto incremented sequence; this will make our TweetID 48 bits long. So, every second we can store (2^17 =\u0026gt; 130K) new tweets. We can reset our auto incrementing sequence every second. For fault tolerance and better performance, we can have two database servers to generate auto-incrementing keys for us, one generating even numbered keys and the other generating odd numbered keys.\næˆ‘ä»¬éœ€è¦ 31 ä½æ¥å­˜å‚¨è¿™ä¸ªæ•°å­—ã€‚ç”±äºæˆ‘ä»¬å¹³å‡æ¯ç§’é¢„è®¡æœ‰ 1150 æ¡æ–°æ¨æ–‡ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ†é… 17 ä½æ¥å­˜å‚¨è‡ªåŠ¨é€’å¢åºåˆ—ï¼›è¿™å°†ä½¿æˆ‘ä»¬çš„ TweetID é•¿ä¸º 48 ä½ã€‚å› æ­¤ï¼Œæ¯ä¸€ç§’æˆ‘ä»¬éƒ½å¯ä»¥å­˜å‚¨ (2^17 =\u0026gt; 130K) æ¡æ–°æ¨æ–‡ã€‚æˆ‘ä»¬å¯ä»¥æ¯ç§’é‡ç½®è‡ªåŠ¨é€’å¢åºåˆ—ã€‚ä¸ºäº†å®¹é”™å’Œæ›´å¥½çš„æ€§èƒ½ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰ä¸¤å°æ•°æ®åº“æœåŠ¡å™¨ä¸ºæˆ‘ä»¬ç”Ÿæˆè‡ªåŠ¨é€’å¢é”®ï¼Œä¸€å°ç”Ÿæˆå¶æ•°é”®ï¼Œå¦ä¸€å°ç”Ÿæˆå¥‡æ•°é”®ã€‚\nIf we assume our current epoch seconds are â€œ1483228800,â€ our TweetID will look like this:\nå¦‚æœæˆ‘ä»¬å‡è®¾å½“å‰çš„çºªå…ƒç§’æ˜¯â€œ1483228800â€ï¼Œæˆ‘ä»¬çš„ TweetID å°†å¦‚ä¸‹æ‰€ç¤ºï¼š\n1483228800 000001 1483228800 000002 1483228800 000003 1483228800 000004 â€¦\nIf we make our TweetID 64bits (8 bytes) long, we can easily store tweets for the next 100 years and also store them for mili-seconds granularity.\nå¦‚æœæˆ‘ä»¬å°† TweetID è®¾ä¸º 64 ä½ï¼ˆ8 å­—èŠ‚ï¼‰é•¿ï¼Œæˆ‘ä»¬â€‹â€‹å°±å¯ä»¥è½»æ¾å­˜å‚¨æœªæ¥ 100 å¹´çš„æ¨æ–‡ï¼Œå¹¶ä»¥æ¯«ç§’ä¸ºç²’åº¦è¿›è¡Œå­˜å‚¨ã€‚\nIn the above approach, we still have to query all the servers for timeline generation, but our reads (and writes) will be substantially quicker.\nåœ¨ä¸Šè¿°æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦æŸ¥è¯¢æ‰€æœ‰æœåŠ¡å™¨ä»¥ç”Ÿæˆæ—¶é—´çº¿ï¼Œä½†æˆ‘ä»¬çš„è¯»å–ï¼ˆå’Œå†™å…¥ï¼‰å°†ä¼šå¿«å¾—å¤šã€‚\nSince we donâ€™t have any secondary index (on creation time) this will reduce our write latency. 2. While reading, we donâ€™t need to filter on creation-time as our primary key has epoch time included in it.\nç”±äºæˆ‘ä»¬æ²¡æœ‰ä»»ä½•äºŒçº§ç´¢å¼•ï¼ˆåœ¨åˆ›å»ºæ—¶ï¼‰ï¼Œè¿™å°†å‡å°‘æˆ‘ä»¬çš„å†™å…¥å»¶è¿Ÿã€‚ 2.åœ¨è¯»å–æ—¶ï¼Œæˆ‘ä»¬ä¸éœ€è¦è¿‡æ»¤åˆ›å»ºæ—¶é—´ï¼Œå› ä¸ºæˆ‘ä»¬çš„ä¸»é”®æœ‰çºªå…ƒæ—¶é—´åŒ…å«åœ¨å…¶ä¸­ã€‚\n8. Cache 8.ç¼“å­˜\nWe can introduce a cache for database servers to cache hot tweets and users. We can use an off-the- shelf solution like Memcache that can store the whole tweet objects. Application servers, before hitting database, can quickly check if the cache has desired tweets. Based on clientsâ€™ usage patterns we can determine how many cache servers we need.\næˆ‘ä»¬å¯ä»¥ä¸ºæ•°æ®åº“æœåŠ¡å™¨å¼•å…¥ç¼“å­˜æ¥ç¼“å­˜çƒ­é—¨æ¨æ–‡å’Œç”¨æˆ·ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åƒ Memcache è¿™æ ·çš„ç°æˆè§£å†³æ–¹æ¡ˆæ¥å­˜å‚¨æ•´ä¸ªæ¨æ–‡å¯¹è±¡ã€‚åº”ç”¨æœåŠ¡å™¨åœ¨è®¿é—®æ•°æ®åº“ä¹‹å‰å¯ä»¥å¿«é€Ÿæ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦æœ‰æ‰€éœ€çš„æ¨æ–‡ã€‚æ ¹æ®å®¢æˆ·çš„ä½¿ç”¨æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šéœ€è¦å¤šå°‘ä¸ªç¼“å­˜æœåŠ¡å™¨ã€‚\nWhich cache replacement policy would best fit our needs? When the cache is full and we want to replace a tweet with a newer/hotter tweet, how would we choose? Least Recently Used (LRU) can be a reasonable policy for our system. Under this policy, we discard the least recently viewed tweet first.\nå“ªç§ç¼“å­˜æ›¿æ¢ç­–ç•¥æœ€é€‚åˆæˆ‘ä»¬çš„éœ€æ±‚ï¼Ÿå½“ç¼“å­˜å·²æ»¡å¹¶ä¸”æˆ‘ä»¬æƒ³ç”¨æ›´æ–°/æ›´çƒ­é—¨çš„æ¨æ–‡æ›¿æ¢ä¸€æ¡æ¨æ–‡æ—¶ï¼Œæˆ‘ä»¬ä¼šå¦‚ä½•é€‰æ‹©ï¼Ÿæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLRUï¼‰å¯¹äºæˆ‘ä»¬çš„ç³»ç»Ÿæ¥è¯´æ˜¯ä¸€ä¸ªåˆç†çš„ç­–ç•¥ã€‚æ ¹æ®æ­¤æ”¿ç­–ï¼Œæˆ‘ä»¬é¦–å…ˆä¸¢å¼ƒæœ€è¿‘æœ€å°‘æŸ¥çœ‹çš„æ¨æ–‡ã€‚\nHow can we have a more intelligent cache? If we go with 80-20 rule, that is 20% of tweets generating 80% of read traffic which means that certain tweets are so popular that a majority of people read them. This dictates that we can try to cache 20% of daily read volume from each shard.\nå¦‚ä½•æ‰èƒ½æ‹¥æœ‰æ›´æ™ºèƒ½çš„ç¼“å­˜å‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬é‡‡ç”¨ 80-20 è§„åˆ™ï¼Œå³ 20% çš„æ¨æ–‡äº§ç”Ÿ 80% çš„é˜…è¯»æµé‡ï¼Œè¿™æ„å‘³ç€æŸäº›æ¨æ–‡éå¸¸å—æ¬¢è¿ï¼Œä»¥è‡³äºå¤§å¤šæ•°äººéƒ½ä¼šé˜…è¯»å®ƒä»¬ã€‚è¿™è¡¨æ˜æˆ‘ä»¬å¯ä»¥å°è¯•ç¼“å­˜æ¯ä¸ªåˆ†ç‰‡æ¯æ—¥è¯»å–é‡çš„ 20%ã€‚\nWhat if we cache the latest data? Our service can benefit from this approach. Letâ€™s say if 80% of our users see tweets from the past three days only; we can try to cache all the tweets from the past three days. Letâ€™s say we have dedicated cache servers that cache all the tweets from all the users from the past three days. As estimated above, we are getting 100 million new tweets or 30GB of new data every day (without photos and videos). If we want to store all the tweets from last three days, we will need less than 100GB of memory. This data can easily fit into one server, but we should replicate it onto multiple servers to distribute all the read traffic to reduce the load on cache servers. So whenever we are generating a userâ€™s timeline, we can ask the cache servers if they have all the recent tweets for that user. If yes, we can simply return all the data from the cache. If we donâ€™t have enough tweets in the cache, we have to query the backend server to fetch that data. On a similar design, we can try caching photos and videos from the last three days.\nå¦‚æœæˆ‘ä»¬ç¼“å­˜æœ€æ–°çš„æ•°æ®æ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬çš„æœåŠ¡å¯ä»¥ä»è¿™ç§æ–¹æ³•ä¸­å—ç›Šã€‚å‡è®¾æˆ‘ä»¬ 80% çš„ç”¨æˆ·åªçœ‹åˆ°è¿‡å»ä¸‰å¤©çš„æ¨æ–‡ï¼›æˆ‘ä»¬å¯ä»¥å°è¯•ç¼“å­˜è¿‡å»ä¸‰å¤©çš„æ‰€æœ‰æ¨æ–‡ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸“ç”¨çš„ç¼“å­˜æœåŠ¡å™¨ï¼Œå¯ä»¥ç¼“å­˜è¿‡å»ä¸‰å¤©æ‰€æœ‰ç”¨æˆ·çš„æ‰€æœ‰æ¨æ–‡ã€‚æ ¹æ®ä¸Šè¿°ä¼°è®¡ï¼Œæˆ‘ä»¬æ¯å¤©ä¼šæ”¶åˆ° 1 äº¿æ¡æ–°æ¨æ–‡æˆ– 30GB æ–°æ•°æ®ï¼ˆä¸åŒ…æ‹¬ç…§ç‰‡å’Œè§†é¢‘ï¼‰ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦å­˜å‚¨è¿‡å»ä¸‰å¤©çš„æ‰€æœ‰æ¨æ–‡ï¼Œæˆ‘ä»¬å°†éœ€è¦ä¸åˆ° 100GB çš„å†…å­˜ã€‚è¿™äº›æ•°æ®å¯ä»¥å¾ˆå®¹æ˜“åœ°æ”¾å…¥ä¸€å°æœåŠ¡å™¨ä¸­ï¼Œä½†æˆ‘ä»¬åº”è¯¥å°†å…¶å¤åˆ¶åˆ°å¤šå°æœåŠ¡å™¨ä¸Šä»¥åˆ†é…æ‰€æœ‰è¯»å–æµé‡ï¼Œä»è€Œå‡å°‘ç¼“å­˜æœåŠ¡å™¨ä¸Šçš„è´Ÿè½½ã€‚å› æ­¤ï¼Œæ¯å½“æˆ‘ä»¬ç”Ÿæˆç”¨æˆ·çš„æ—¶é—´çº¿æ—¶ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥è¯¢é—®ç¼“å­˜æœåŠ¡å™¨æ˜¯å¦æ‹¥æœ‰è¯¥ç”¨æˆ·æœ€è¿‘çš„æ‰€æœ‰æ¨æ–‡ã€‚å¦‚æœæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°ä»ç¼“å­˜ä¸­è¿”å›æ‰€æœ‰æ•°æ®ã€‚å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰è¶³å¤Ÿçš„æ¨æ–‡ï¼Œæˆ‘ä»¬å¿…é¡»æŸ¥è¯¢åç«¯æœåŠ¡å™¨æ¥è·å–è¯¥æ•°æ®ã€‚åœ¨ç±»ä¼¼çš„è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ç¼“å­˜æœ€è¿‘ä¸‰å¤©çš„ç…§ç‰‡å’Œè§†é¢‘ã€‚\nOur cache would be like a hash table where â€˜keyâ€™ would be â€˜OwnerIDâ€™ and â€˜valueâ€™ would be a doubly linked list containing all the tweets from that user in the past three days. Since we want to retrieve the most recent data first, we can always insert new tweets at the head of the linked list, which means all the older tweets will be near the tail of the linked list. Therefore, we can remove tweets from the tail to make space for newer tweets.\næˆ‘ä»¬çš„ç¼“å­˜å°±åƒä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œå…¶ä¸­â€œkeyâ€æ˜¯â€œOwnerIDâ€ï¼Œâ€œvalueâ€æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå…¶ä¸­åŒ…å«è¯¥ç”¨æˆ·åœ¨è¿‡å»ä¸‰å¤©å†…çš„æ‰€æœ‰æ¨æ–‡ã€‚ç”±äºæˆ‘ä»¬å¸Œæœ›é¦–å…ˆæ£€ç´¢æœ€æ–°çš„æ•°æ®ï¼Œå› æ­¤æˆ‘ä»¬å§‹ç»ˆå¯ä»¥åœ¨é“¾è¡¨çš„å¤´éƒ¨æ’å…¥æ–°çš„æ¨æ–‡ï¼Œè¿™æ„å‘³ç€æ‰€æœ‰è¾ƒæ—§çš„æ¨æ–‡å°†ä½äºé“¾è¡¨çš„å°¾éƒ¨é™„è¿‘ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä»å°¾éƒ¨åˆ é™¤æ¨æ–‡ï¼Œä¸ºæ–°çš„æ¨æ–‡è…¾å‡ºç©ºé—´ã€‚\n9. Timeline Generation 9. æ—¶é—´çº¿ç”Ÿæˆ\nFor a detailed discussion about timeline generation, take a look at Designing Facebookâ€™s Newsfeed.\næœ‰å…³æ—¶é—´çº¿ç”Ÿæˆçš„è¯¦ç»†è®¨è®ºï¼Œè¯·æŸ¥çœ‹è®¾è®¡ Facebook çš„æ–°é—»æºã€‚\n10. Replication and Fault Tolerance 10.å¤åˆ¶å’Œå®¹é”™\nSince our system is read-heavy, we can have multiple secondary database servers for each DB partition. Secondary servers will be used for read traffic only. All writes will first go to the primary server and then will be replicated to secondary servers. This scheme will also give us fault tolerance, since whenever the primary server goes down we can failover to a secondary server.\nç”±äºæˆ‘ä»¬çš„ç³»ç»Ÿæ˜¯è¯»å–å¯†é›†å‹çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ªæ•°æ®åº“åˆ†åŒºæ‹¥æœ‰å¤šä¸ªè¾…åŠ©æ•°æ®åº“æœåŠ¡å™¨ã€‚è¾…åŠ©æœåŠ¡å™¨å°†ä»…ç”¨äºè¯»å–æµé‡ã€‚æ‰€æœ‰å†™å…¥å°†é¦–å…ˆå‘é€åˆ°ä¸»æœåŠ¡å™¨ï¼Œç„¶åå¤åˆ¶åˆ°è¾…åŠ©æœåŠ¡å™¨ã€‚è¯¥æ–¹æ¡ˆè¿˜ä¸ºæˆ‘ä»¬æä¾›äº†å®¹é”™èƒ½åŠ›ï¼Œå› ä¸ºæ¯å½“ä¸»æœåŠ¡å™¨å‡ºç°æ•…éšœæ—¶ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥æ•…éšœè½¬ç§»åˆ°è¾…åŠ©æœåŠ¡å™¨ã€‚\n11. Load Balancing 11.è´Ÿè½½å‡è¡¡\nWe can add Load balancing layer at three places in our system 1) Between Clients and Application servers 2) Between Application servers and database replication servers and 3) Between Aggregation servers and Cache server. Initially, a simple Round Robin approach can be adopted; that distributes incoming requests equally among servers. This LB is simple to implement and does not introduce any overhead. Another benefit of this approach is that if a server is dead, LB will take it out of the rotation and will stop sending any traffic to it. A problem with Round Robin LB is that it wonâ€™t take servers\næˆ‘ä»¬å¯ä»¥åœ¨ç³»ç»Ÿä¸­çš„ä¸‰ä¸ªä½ç½®æ·»åŠ è´Ÿè½½å¹³è¡¡å±‚ï¼š1ï¼‰å®¢æˆ·ç«¯å’Œåº”ç”¨ç¨‹åºæœåŠ¡å™¨ä¹‹é—´ï¼Œ2ï¼‰åº”ç”¨ç¨‹åºæœåŠ¡å™¨å’Œæ•°æ®åº“å¤åˆ¶æœåŠ¡å™¨ä¹‹é—´ï¼Œ3ï¼‰èšåˆæœåŠ¡å™¨å’Œç¼“å­˜æœåŠ¡å™¨ä¹‹é—´ã€‚æœ€åˆï¼Œå¯ä»¥é‡‡ç”¨ç®€å•çš„å¾ªç¯æ–¹æ³•ï¼›åœ¨æœåŠ¡å™¨ä¹‹é—´å¹³å‡åˆ†é…ä¼ å…¥è¯·æ±‚ã€‚è¯¥LBå®ç°ç®€å•ï¼Œä¸ä¼šå¼•å…¥ä»»ä½•å¼€é”€ã€‚è¿™ç§æ–¹æ³•çš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œå¦‚æœæœåŠ¡å™¨æ­»æœºï¼ŒLB ä¼šå°†å…¶ä»è½®æ¢ä¸­åˆ é™¤ï¼Œå¹¶åœæ­¢å‘å…¶å‘é€ä»»ä½•æµé‡ã€‚å¾ªç¯è´Ÿè½½å‡è¡¡çš„ä¸€ä¸ªé—®é¢˜æ˜¯å®ƒä¸ä¼šå ç”¨æœåŠ¡å™¨\nload into consideration. If a server is overloaded or slow, the LB will not stop sending new requests to that server. To handle this, a more intelligent LB solution can be placed that periodically queries backend server about their load and adjusts traffic based on that.\nè´Ÿè½½è€ƒè™‘ã€‚å¦‚æœæœåŠ¡å™¨è¿‡è½½æˆ–é€Ÿåº¦ç¼“æ…¢ï¼Œè´Ÿè½½å‡è¡¡å™¨ä¸ä¼šåœæ­¢å‘è¯¥æœåŠ¡å™¨å‘é€æ–°è¯·æ±‚ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥æ”¾ç½®æ›´æ™ºèƒ½çš„ LB è§£å†³æ–¹æ¡ˆï¼Œå®šæœŸæŸ¥è¯¢åç«¯æœåŠ¡å™¨çš„è´Ÿè½½å¹¶æ®æ­¤è°ƒæ•´æµé‡ã€‚\n12. Monitoring 12. ç›‘æ§\nHaving the ability to monitor our systems is crucial. We should constantly collect data to get an instant insight into how our system is doing. We can collect following metrics/counters to get an understanding of the performance of our service:\næ‹¥æœ‰ç›‘æ§æˆ‘ä»¬ç³»ç»Ÿçš„èƒ½åŠ›è‡³å…³é‡è¦ã€‚æˆ‘ä»¬åº”è¯¥ä¸æ–­æ”¶é›†æ•°æ®ï¼Œä»¥ä¾¿ç«‹å³äº†è§£æˆ‘ä»¬çš„ç³»ç»Ÿçš„è¿è¡Œæƒ…å†µã€‚æˆ‘ä»¬å¯ä»¥æ”¶é›†ä»¥ä¸‹æŒ‡æ ‡/è®¡æ•°å™¨æ¥äº†è§£æˆ‘ä»¬æœåŠ¡çš„æ€§èƒ½ï¼š\nNew tweets per day/second, what is the daily peak?\næ¯å¤©/æ¯ç§’æ–°æ¨æ–‡ï¼Œæ¯æ—¥å³°å€¼æ˜¯å¤šå°‘ï¼Ÿ\nTimeline delivery stats, how many tweets per day/second our service is delivering. 3. Average latency that is seen by the user to refresh timeline.\næ—¶é—´è½´ä¼ é€ç»Ÿè®¡æ•°æ®ï¼Œæˆ‘ä»¬çš„æœåŠ¡æ¯å¤©/æ¯ç§’ä¼ é€å¤šå°‘æ¡æ¨æ–‡ã€‚ 3. ç”¨æˆ·çœ‹åˆ°çš„åˆ·æ–°æ—¶é—´çº¿çš„å¹³å‡å»¶è¿Ÿã€‚\nBy monitoring these counters, we will realize if we need more replication, load balancing, or caching.\né€šè¿‡ç›‘è§†è¿™äº›è®¡æ•°å™¨ï¼Œæˆ‘ä»¬å°†æ„è¯†åˆ°æ˜¯å¦éœ€è¦æ›´å¤šå¤åˆ¶ã€è´Ÿè½½å¹³è¡¡æˆ–ç¼“å­˜ã€‚\n13. Extended Requirements 13.æ‰©å±•è¦æ±‚\nHow do we serve feeds? Get all the latest tweets from the people someone follows and merge/sort them by time. Use pagination to fetch/show tweets. Only fetch top N tweets from all the people someone follows. This N will depend on the clientâ€™s Viewport, since on a mobile we show fewer tweets compared to a Web client. We can also cache next top tweets to speed things up.\næˆ‘ä»¬å¦‚ä½•æä¾› Feedï¼Ÿè·å–æŸäººå…³æ³¨çš„äººçš„æ‰€æœ‰æœ€æ–°æ¨æ–‡ï¼Œå¹¶æŒ‰æ—¶é—´å¯¹å®ƒä»¬è¿›è¡Œåˆå¹¶/æ’åºã€‚ä½¿ç”¨åˆ†é¡µæ¥è·å–/æ˜¾ç¤ºæ¨æ–‡ã€‚åªè·å–æ‰€æœ‰å…³æ³¨è€…çš„å‰ N â€‹â€‹æ¡æ¨æ–‡ã€‚è¿™ä¸ª N å°†å–å†³äºå®¢æˆ·ç«¯çš„è§†å£ï¼Œå› ä¸ºä¸ Web å®¢æˆ·ç«¯ç›¸æ¯”ï¼Œæˆ‘ä»¬åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šæ˜¾ç¤ºçš„æ¨æ–‡æ›´å°‘ã€‚æˆ‘ä»¬è¿˜å¯ä»¥ç¼“å­˜ä¸‹ä¸€ä¸ªçƒ­é—¨æ¨æ–‡ä»¥åŠ å¿«é€Ÿåº¦ã€‚\nAlternately, we can pre-generate the feed to improve efficiency; for details please see â€˜Ranking and timeline generationâ€™ under Designing Instagram.\næˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥é¢„å…ˆç”Ÿæˆ feed ä»¥æé«˜æ•ˆç‡ï¼›æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œè®¾è®¡ Instagramâ€ä¸‹çš„â€œæ’åå’Œæ—¶é—´çº¿ç”Ÿæˆâ€ã€‚\nRetweet: With each Tweet object in the database, we can store the ID of the original Tweet and not store any contents on this retweet object.\nè½¬æ¨ï¼šå¯¹äºæ•°æ®åº“ä¸­çš„æ¯ä¸ªæ¨æ–‡å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥å­˜å‚¨åŸå§‹æ¨æ–‡çš„ IDï¼Œå¹¶ä¸”åœ¨æ­¤è½¬æ¨å¯¹è±¡ä¸Šä¸å­˜å‚¨ä»»ä½•å†…å®¹ã€‚\nTrending Topics: We can cache most frequently occurring hashtags or search queries in the last N seconds and keep updating them after every M seconds. We can rank trending topics based on the frequency of tweets or search queries or retweets or likes. We can give more weight to topics which are shown to more people.\nçƒ­é—¨ä¸»é¢˜ï¼šæˆ‘ä»¬å¯ä»¥ç¼“å­˜æœ€è¿‘ N ç§’å†…æœ€å¸¸å‡ºç°çš„ä¸»é¢˜æ ‡ç­¾æˆ–æœç´¢æŸ¥è¯¢ï¼Œå¹¶åœ¨æ¯ M ç§’åä¸æ–­æ›´æ–°å®ƒä»¬ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®æ¨æ–‡ã€æœç´¢æŸ¥è¯¢ã€è½¬å‘æˆ–ç‚¹èµçš„é¢‘ç‡å¯¹çƒ­é—¨ä¸»é¢˜è¿›è¡Œæ’åã€‚æˆ‘ä»¬å¯ä»¥æ›´åŠ é‡è§†å‘æ›´å¤šäººå±•ç¤ºçš„ä¸»é¢˜ã€‚\nWho to follow? How to give suggestions? This feature will improve user engagement. We can suggest friends of people someone follows. We can go two or three levels down to find famous people for the suggestions. We can give preference to people with more followers.\nè·Ÿéšè°ï¼Ÿå¦‚ä½•æå‡ºå»ºè®®ï¼Ÿæ­¤åŠŸèƒ½å°†æé«˜ç”¨æˆ·å‚ä¸åº¦ã€‚æˆ‘ä»¬å¯ä»¥æ¨èæŸäººå…³æ³¨çš„äººçš„æœ‹å‹ã€‚æˆ‘ä»¬å¯ä»¥ä¸‹ä¸¤ä¸‰å±‚å»æ‰¾åäººæå»ºè®®ã€‚æˆ‘ä»¬å¯ä»¥ä¼˜å…ˆè€ƒè™‘æ‹¥æœ‰æ›´å¤šå…³æ³¨è€…çš„äººã€‚\nAs only a few suggestions can be made at any time, use Machine Learning (ML) to shuffle and re- prioritize. ML signals could include people with recently increased follow-ship, common followers if the other person is following this user, common location or interests, etc.\nç”±äºä»»ä½•æ—¶å€™åªèƒ½æå‡ºä¸€äº›å»ºè®®ï¼Œå› æ­¤è¯·ä½¿ç”¨æœºå™¨å­¦ä¹  (ML) æ¥é‡æ–°æ’åˆ—å’Œé‡æ–°ç¡®å®šä¼˜å…ˆçº§ã€‚æœºå™¨å­¦ä¹ ä¿¡å·å¯èƒ½åŒ…æ‹¬æœ€è¿‘å…³æ³¨é‡å¢åŠ çš„äººã€å…±åŒå…³æ³¨è€…ï¼ˆå¦‚æœå…¶ä»–äººæ­£åœ¨å…³æ³¨è¯¥ç”¨æˆ·ï¼‰ã€å…±åŒä½ç½®æˆ–å…´è¶£ç­‰ã€‚\nMoments: Get top news for different websites for past 1 or 2 hours, figure out related tweets, prioritize them, categorize them (news, support, financial, entertainment, etc.) using ML â€“ supervised learning or Clustering. Then we can show these articles as trending topics in Moments.\næ—¶åˆ»ï¼šè·å–è¿‡å» 1 æˆ– 2 å°æ—¶å†…ä¸åŒç½‘ç«™çš„çƒ­é—¨æ–°é—»ï¼Œæ‰¾å‡ºç›¸å…³æ¨æ–‡ï¼Œå¯¹å®ƒä»¬è¿›è¡Œä¼˜å…ˆçº§æ’åºï¼Œä½¿ç”¨ MLï¼ˆç›‘ç£å­¦ä¹ æˆ–èšç±»ï¼‰å¯¹å®ƒä»¬è¿›è¡Œåˆ†ç±»ï¼ˆæ–°é—»ã€æ”¯æŒã€é‡‘èã€å¨±ä¹ç­‰ï¼‰ã€‚ç„¶åæˆ‘ä»¬å°±å¯ä»¥æŠŠè¿™äº›æ–‡ç« ä½œä¸ºæœ‹å‹åœˆçš„çƒ­é—¨è¯é¢˜å±•ç¤ºå‡ºæ¥ã€‚\nSearch: Search involves Indexing, Ranking, and Retrieval of tweets. A similar solution is discussed in our next problem Design Twitter Search.\næœç´¢ï¼šæœç´¢æ¶‰åŠæ¨æ–‡çš„ç´¢å¼•ã€æ’åå’Œæ£€ç´¢ã€‚æˆ‘ä»¬çš„ä¸‹ä¸€ä¸ªé—®é¢˜â€œè®¾è®¡ Twitter æœç´¢â€ä¸­è®¨è®ºäº†ç±»ä¼¼çš„è§£å†³æ–¹æ¡ˆã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/12/14/designing-twitter/","summary":"è¿™æ˜¯ä¸€ç¯‡åŒè¯­ç¿»è¯‘çš„æ–‡ç« ï¼ŒåŸæ–‡å‡ºè‡ª grok_system_design_interview.pdf çš„ä¸€ç¯‡æ–‡ç« ã€ŠDesigning Twitterã€‹è®¾è®¡ Twitterã€‚\nLetâ€™s design a Twitter-like social networking service. Users of the service will be able to post tweets, follow other people, and favorite tweets. Difficulty Level: Medium\nè®©æˆ‘ä»¬è®¾è®¡ä¸€ä¸ªç±»ä¼¼ Twitter çš„ç¤¾äº¤ç½‘ç»œæœåŠ¡ã€‚è¯¥æœåŠ¡çš„ç”¨æˆ·å°†èƒ½å¤Ÿå‘å¸ƒæ¨æ–‡ã€å…³æ³¨å…¶ä»–äººä»¥åŠå–œæ¬¢çš„æ¨æ–‡ã€‚éš¾åº¦çº§åˆ«ï¼šä¸­ç­‰\n1. What is Twitter? 1.ä»€ä¹ˆæ˜¯æ¨ç‰¹ï¼Ÿ\nTwitter is an online social networking service where users post and read short 140-character messages called â€œtweets.â€ Registered users can post and read tweets, but those who are not registered can only read them. Users access Twitter through their website interface, SMS, or mobile app.\nTwitter æ˜¯ä¸€ç§åœ¨çº¿ç¤¾äº¤ç½‘ç»œæœåŠ¡ï¼Œç”¨æˆ·å¯ä»¥åœ¨å…¶ä¸­å‘å¸ƒå’Œé˜…è¯»ç§°ä¸ºâ€œæ¨æ–‡â€çš„ 140 ä¸ªå­—ç¬¦çš„ç®€çŸ­æ¶ˆæ¯ã€‚æ³¨å†Œç”¨æˆ·å¯ä»¥å‘å¸ƒå’Œé˜…è¯»æ¨æ–‡ï¼Œä½†æœªæ³¨å†Œçš„ç”¨æˆ·åªèƒ½é˜…è¯»æ¨æ–‡ã€‚ç”¨æˆ·é€šè¿‡ç½‘ç«™ç•Œé¢ã€çŸ­ä¿¡æˆ–ç§»åŠ¨åº”ç”¨ç¨‹åºè®¿é—® Twitterã€‚\n2. Requirements and Goals of the System ç³»ç»Ÿçš„è¦æ±‚å’Œç›®æ ‡ We will be designing a simpler version of Twitter with the following requirements:","title":"[è¯‘]ã€ŠGrokking the System Design Interviewã€‹è®¾è®¡Twitter"},{"content":"Today I Learned. ä»Šå¤©åˆ†äº«å†…å®¹ï¼šå‘å¸ƒåˆ° Maven ä¸­å¤®ä»“åº“çš„ç¬¬ä¸€ä¸ªé¡¹ç›®ã€‚\næœ€è¿‘åœ¨ Github ä¸Šåˆ›å»ºäº†ä¸€ä¸ª Pom ç±»å‹çš„ Maven é¡¹ç›® chensoul-parentï¼Œè¯¥é¡¹ç›®ä¸»é¡µ https://chensoul.github.io/chensoul-parent/ ï¼Œè¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ä¸ªå‘å¸ƒå¯¹ Maven ä¸­å¤®ä»“åº“çš„é¡¹ç›®ã€‚\nå…¶ä¸»è¦ç”¨é€”æ˜¯ç®¡ç†å¸¸ç”¨çš„ Maven Plugin æ’ä»¶ã€‚åœ¨ç¼–å†™è¯¥é¡¹ç›®çš„è¿‡ç¨‹ä¸­ï¼Œå‚è€ƒäº†ä¸€äº›å¼€æºé¡¹ç›®ï¼Œä»–ä»¬åˆ†åˆ«æ˜¯ï¼š\nhttps://github.com/eclipse/microprofile Eclipse çš„ä¸€å¥—å¼€æºå¾®æœåŠ¡æ¡†æ¶å®ç° https://github.com/microbean/microbean-function microBeanâ„¢ çš„ Java æ‰©å±• https://github.com/naturalett/maven-hello-world ä¸€ä¸ª Maven å‘å¸ƒ Jar çš„ hello world çš„ç¤ºä¾‹é¡¹ç›® https://github.com/eclipse-store/store Eclipse å¼€æºçš„ä¸€ä¸ªé«˜æ€§èƒ½ Java åŸç”ŸæŒä¹…å­˜å‚¨ã€‚å¾®ç§’å“åº”æ—¶é—´ã€‚è¶…é«˜ååé‡ã€‚æœ€å°å»¶è¿Ÿã€‚åˆ›å»ºè¶…å¿«é€Ÿå†…å­˜æ•°æ®åº“åº”ç”¨ç¨‹åºå’Œå¾®æœåŠ¡ã€‚ è¯¥é¡¹ç›®æ‰“åŒ…ä¹‹åæ˜¯ä¸€ä¸ª pom æ–‡ä»¶ï¼Œä»»ä½• Maven é¡¹ç›®éƒ½å¯ä»¥ç»§æ‰¿è¿™ä¸ªé¡¹ç›®ï¼Œè¿™æ ·å¯ä»¥å…å»è‡ªå·±ç®¡ç† Mave Plugin æ’ä»¶çš„éº»çƒ¦ã€‚è¿™é‡Œé¢çš„ Mave Plugin æ’ä»¶åŒ…æ‹¬ï¼š\nç¼–è¯‘ æ‰“åŒ… å‘å¸ƒ æµ‹è¯•ï¼Œå¹¶ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š è´¨é‡æ£€æµ‹ï¼ŒåŒ…æ‹¬ä»£ç é£æ ¼æ£€æŸ¥ã€æ¼æ´æ£€æµ‹ ç”Ÿæˆç½‘ç«™å¹¶å‘å¸ƒåˆ° github pages å‘å¸ƒå…ˆæ˜¯ä½¿ç”¨çš„ Maven Release Plugin å’Œ Nexus Staging Maven Plugin æ’ä»¶ï¼Œåæ¥è§‰å¾— Maven Release Plugin æ’ä»¶åšçš„äº‹æƒ…å¤ªå¤šäº†ï¼Œä¸å¦‚æ‰‹åŠ¨æ‰§è¡Œå‘½ä»¤ï¼Œäºæ˜¯å»æ‰äº† Maven Release Plugin æ’ä»¶ã€‚\nå…³äº Nexus Staging Maven Plugin æ’ä»¶çš„ä½¿ç”¨äº†ï¼Œèµ·åˆæˆ‘ä½¿ç”¨äº†è¿™ä¸ªä»“åº“å‘å¸ƒ Maven æ„å»ºçš„è„šæœ¬ ã€‚è¿™ä¸ªè„šæœ¬æ¯”è¾ƒå¤æ‚ï¼Œäºæ˜¯æ‰¾åˆ°äº† https://github.com/naturalett/maven-hello-world è¿™ä¸ªä»“åº“ï¼Œå…¶å¯¹åº”çš„åšå®¢ ã€ŠPublishing Artifacts to Maven Central using GitHub Actions: A Step-by-Step Guideã€‹ï¼Œå¯¹äºå¦‚ä½•éƒ¨ç½²æ„å»ºåˆ° Maven ä¸­å¤®ä»“åº“ã€å¦‚ä½•ä½¿ç”¨ Github Action è¯´çš„æ¯”è¾ƒæ¸…æ¥šã€‚å¦‚æœä½ å¯¹äºå¦‚ä½•ä½¿ç”¨è¿™ä¸ªæ’ä»¶ï¼Œå¯ä»¥é˜…è¯»è¯¥æ–‡ç« ï¼Œæœ¬æ–‡ä¸ä½œèµ˜è¿°ã€‚\næˆ‘å¯¹ Github Action çš„ Workflow åšè¿‡ä¸€äº›ä¼˜åŒ–ã€‚ä¼˜åŒ–åçš„ Workflow æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\nname: \u0026#34;Maven Release\u0026#34; on: workflow_dispatch: inputs: releaseVersion: description: \u0026#34;Define the RELEASE version\u0026#34; required: false default: \u0026#34;\u0026#34; developmentVersion: description: \u0026#34;Define the SNAPSHOT version\u0026#34; required: false default: \u0026#34;\u0026#34; autoReleaseAfterClose: description: \u0026#34;Auto release after close\u0026#34; required: false default: \u0026#34;false\u0026#34; jobs: build: runs-on: ubuntu-latest steps: - uses: actions/checkout@v2 - name: Set up Maven Central Repository uses: actions/setup-java@v3 with: java-version: 11 distribution: \u0026#34;temurin\u0026#34; java-package: \u0026#34;jdk\u0026#34; cache: \u0026#34;maven\u0026#34; server-id: ossrh - name: Configure Git User run: | git config user.email \u0026#34;actions@github.com\u0026#34; git config user.name \u0026#34;GitHub Actions\u0026#34; echo \u0026#34;sha_short=$(git rev-parse --short HEAD)\u0026#34; \u0026gt;\u0026gt; $GITHUB_ENV - name: Import GPG Key uses: crazy-max/ghaction-import-gpg@v5.0.0 with: gpg_private_key: ${{ secrets.MAVEN_GPG_PRIVATE_KEY }} passphrase: ${{ secrets.MAVEN_GPG_PASSPHRASE }} - name: Verify Whether a Release is Ready shell: bash run: | if [ \u0026#34;${{ github.event.inputs.autoReleaseAfterClose }}\u0026#34; == \u0026#34;true\u0026#34; ] ; then echo \u0026#34;auto_release=true\u0026#34; \u0026gt;\u0026gt; $GITHUB_ENV else echo \u0026#34;auto_release=false\u0026#34; \u0026gt;\u0026gt; $GITHUB_ENV fi - name: Fetch Artifact Information shell: bash run: | # remove \u0026#39;-SNAPSHOT\u0026#39; from version echo \u0026#34;artifact_version=$(grep -m1 \u0026#39;\u0026lt;version\u0026gt;\u0026#39; pom.xml | sed \u0026#39;s/.*\u0026lt;version\u0026gt;\\([^\u0026lt;]*\\)\u0026lt;\\/version\u0026gt;.*/\\1/\u0026#39; | sed \u0026#39;s/-SNAPSHOT$//\u0026#39;)\u0026#34; \u0026gt;\u0026gt; \u0026#34;$GITHUB_ENV\u0026#34; echo \u0026#34;artifact_name=$(grep -m1 \u0026#39;\u0026lt;artifactId\u0026gt;\u0026#39; pom.xml | sed \u0026#39;s/.*\u0026lt;artifactId\u0026gt;\\([^\u0026lt;]*\\)\u0026lt;\\/artifactId\u0026gt;.*/\\1/\u0026#39;)\u0026#34; \u0026gt;\u0026gt; \u0026#34;$GITHUB_ENV\u0026#34; echo \u0026#34;artifact_packaging=$(grep -m1 \u0026#39;\u0026lt;packaging\u0026gt;\u0026#39; pom.xml | sed \u0026#39;s/.*\u0026lt;packaging\u0026gt;\\([^\u0026lt;]*\\)\u0026lt;\\/packaging\u0026gt;.*/\\1/\u0026#39;)\u0026#34; \u0026gt;\u0026gt; \u0026#34;$GITHUB_ENV\u0026#34; - name: Release With Maven run: | echo \u0026#34;${{ env.artifact_name }} ${{ env.artifact_version }} ${{ env.artifact_packaging }}\u0026#34; mvn -B -U \\ release:prepare \\ release:perform \\ -DreleaseVersion=${{ github.event.inputs.releaseVersion }} \\ -DdevelopmentVersion=${{ github.event.inputs.developmentVersion }} \\ deploy \\ -s settings.xml \\ -Prelease \\ -Dgpg.passphrase=${{ secrets.MAVEN_GPG_PASSPHRASE }} ls -al ./target/ env: OSSRH_USERNAME: ${{ secrets.OSSRH_USERNAME }} OSSRH_TOKEN: ${{ secrets.OSSRH_TOKEN }} AUTO_RELEASE_AFTER_CLOSE: ${{ env.auto_release }} - name: Upload Artifact uses: actions/upload-artifact@v3 with: name: ${{ env.artifact_name }}-${{ env.artifact_version }} path: ./target/${{ env.artifact_name }}-${{ env.artifact_version }}.${{ env.artifact_packaging }} - name: Workflow Release Notes uses: peter-evans/repository-dispatch@v2 with: event-type: github-release client-payload: \u0026#39;{\u0026#34;auto_release\u0026#34;: \u0026#34;${{ env.auto_release }}\u0026#34;, \u0026#34;artifact\u0026#34;: \u0026#34;${{ env.artifact_name }}-${{ env.artifact_version }}\u0026#34;}\u0026#39; åœ¨ Github Action æ‰‹åŠ¨æ‰§è¡Œè¯¥ Workflow æ–‡ä»¶æ—¶ï¼Œå¯ä»¥æŒ‡å®šæ­£å¼ç‰ˆæœ¬ã€å¼€å‘ç‰ˆæœ¬ä»¥åŠæ˜¯å¦å°† Maven æ„å»ºå‘å¸ƒåˆ°ä¸­å¤®ä»“åº“ã€‚å¦‚æœæ˜¯ï¼Œåˆ™ä¼šè§¦å‘ github-release.yml è¿™ä¸ª Workflow åœ¨è¯¥ github ä»“åº“åˆ›å»ºä¸€ä¸ª Releaseï¼Œæ•ˆæœå¦‚ä¸‹ï¼š\nhttps://github.com/naturalett/maven-hello-world è¿™ä¸ªä»“åº“ä½¿ç”¨äº† settings.xml æ–‡ä»¶ç”¨äºåœ¨ Github Action ä¸­è®¾ç½®ç”¨æˆ·åå’Œå¯†ç ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆã€‚\néšåï¼Œåœ¨ https://github.com/eclipse-store/store ä»“åº“ä¸­æ‰¾åˆ°äº†ä½¿ç”¨ Github Action å‘å¸ƒ Maven æ„å»º çš„ä¸€ä¸ªæ¯”è¾ƒç®€æ´çš„å®ç°ã€‚ä»è¯¥æ–‡ä»¶çš„æ³¨é‡Šå¯ä»¥çœ‹åˆ° Github Action å®˜æ–¹æ–‡æ¡£æœ‰å…³äºä½¿ç”¨ Maven çš„ä»‹ç» ã€‚\näºæ˜¯ï¼Œåœ¨å»æ‰ Maven Release Plugin ä¹‹åï¼ŒåˆæŠŠ settings.xml æ–‡ä»¶åˆ é™¤äº†ã€‚ä¸ªäººè§‰å¾—æ˜¯å¦åˆ›å»º Github Release åº”è¯¥æ‰‹åŠ¨æ§åˆ¶æ›´å¥½ä¸€äº›ï¼Œäºæ˜¯å°† github-release.yml è¿™ä¸ª Workflow ä¹Ÿä»æˆ‘çš„ä»“åº“ä¸­åˆ é™¤äº†ã€‚\nåœ¨ microprofile-config ä»“åº“é‡Œå‘ç°äº†ä¸€ä¸ª dependabot.yml ï¼Œäºæ˜¯æŠŠè¿™ä¸ªæ–‡ä»¶åŠ å…¥äº†æˆ‘çš„é¡¹ç›®ä¸­ã€‚æ·»åŠ è¯¥æ–‡ä»¶ä¹‹åï¼Œä¼šæœ‰ä¸€ä¸ªæœºå™¨äººæ¯å¤©æ£€æŸ¥é¡¹ç›®ä¸­ä½¿ç”¨çš„ maven æ’ä»¶ç‰ˆæœ¬æ˜¯å¦æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™ä¼šåˆ›å»ºä¸€ä¸ª pull requestã€‚\næ›´å¤šæŠ€æœ¯å†…å®¹å’Œå¦‚æ­¤ä½¿ç”¨ï¼Œè¯·æŸ¥çœ‹æºç ã€‚\nMaven é¡¹ç›®åˆ°ä¸­å¤®ä»“åº“æµç¨‹ å‘å¸ƒ Maven é¡¹ç›®åˆ°ä¸­å¤®ä»“åº“æµç¨‹ï¼š\n1. pom.xml é…ç½®å¦‚ä¸‹ä¿¡æ¯ License ä¿¡æ¯ å¼€å‘äººå‘˜ä¿¡æ¯ SCM ä¿¡æ¯ Javadoc å’Œ Sources æ’ä»¶ Distribution ç®¡ç† è®¾ç½®ä¸€ä¸ª profile ï¼ˆå¯é€‰ï¼‰ ä»¥ chensoul-parent é¡¹ç›®ä¸ºä¾‹ï¼ŒLicense ä¿¡æ¯å¦‚ä¸‹ï¼š\n\u0026lt;licenses\u0026gt; \u0026lt;license\u0026gt; \u0026lt;name\u0026gt;Apache License 2.0\u0026lt;/name\u0026gt; \u0026lt;url\u0026gt;https://www.apache.org/licenses/LICENSE-2.0.txt\u0026lt;/url\u0026gt; \u0026lt;comments\u0026gt;The Apache License, Version 2.0\u0026lt;/comments\u0026gt; \u0026lt;distribution\u0026gt;repo\u0026lt;/distribution\u0026gt; \u0026lt;/license\u0026gt; \u0026lt;/licenses\u0026gt; å¼€å‘äººå‘˜ä¿¡æ¯ï¼š\n\u0026lt;organization\u0026gt; \u0026lt;name\u0026gt;ChenSoulâ„¢\u0026lt;/name\u0026gt; \u0026lt;url\u0026gt;https://blog.chensoul.cc/\u0026lt;/url\u0026gt; \u0026lt;/organization\u0026gt; \u0026lt;developers\u0026gt; \u0026lt;developer\u0026gt; \u0026lt;id\u0026gt;chensoul\u0026lt;/id\u0026gt; \u0026lt;name\u0026gt;chensoul\u0026lt;/name\u0026gt; \u0026lt;email\u0026gt;chensoul.eth@gmail.com\u0026lt;/email\u0026gt; \u0026lt;url\u0026gt;https://blog.chensoul.cc\u0026lt;/url\u0026gt; \u0026lt;roles\u0026gt; \u0026lt;role\u0026gt;architect\u0026lt;/role\u0026gt; \u0026lt;role\u0026gt;developer\u0026lt;/role\u0026gt; \u0026lt;/roles\u0026gt; \u0026lt;timezone\u0026gt;+8\u0026lt;/timezone\u0026gt; \u0026lt;/developer\u0026gt; \u0026lt;/developers\u0026gt; SCM ä¿¡æ¯ï¼š\n\u0026lt;scm\u0026gt; \u0026lt;connection\u0026gt;scm:git:https://github.com/chensoul/chensoul-parent.git\u0026lt;/connection\u0026gt; \u0026lt;developerConnection\u0026gt;scm:git:https://github.com/chensoul/chensoul-parent.git\u0026lt;/developerConnection\u0026gt; \u0026lt;url\u0026gt;https://github.com/chensoul/chensoul-parent\u0026lt;/url\u0026gt; \u0026lt;tag\u0026gt;HEAD\u0026lt;/tag\u0026gt; \u0026lt;/scm\u0026gt; Javadoc å’Œ Sources æ’ä»¶ï¼š\n\u0026lt;build\u0026gt; \u0026lt;pluginManagement\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-source-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.3.0\u0026lt;/version\u0026gt; \u0026lt;executions\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;id\u0026gt;attach-sources\u0026lt;/id\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;jar-no-fork\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;/executions\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-javadoc-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.6.3\u0026lt;/version\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;additionalJOptions combine.children=\u0026#34;append\u0026#34;\u0026gt; \u0026lt;additionalJOption\u0026gt;-J-Dhttp.agent=maven-javadoc-plugin\u0026lt;/additionalJOption\u0026gt; \u0026lt;/additionalJOptions\u0026gt; \u0026lt;attach\u0026gt;true\u0026lt;/attach\u0026gt; \u0026lt;doclint\u0026gt;none\u0026lt;/doclint\u0026gt; \u0026lt;doctitle\u0026gt;\u0026amp;lt;a href=\u0026#34;${project.url}\u0026#34; target=\u0026#34;_top\u0026#34;\u0026amp;gt;${project.artifactId}\u0026amp;lt;/a\u0026amp;gt; ${project.version} \u0026lt;/doctitle\u0026gt; \u0026lt;docfilessubdirs\u0026gt;true\u0026lt;/docfilessubdirs\u0026gt; \u0026lt;windowtitle\u0026gt;${project.name}\u0026lt;/windowtitle\u0026gt; \u0026lt;header\u0026gt;\u0026lt;![CDATA[\u0026lt;br\u0026gt;${project.name} v${project.version}]]\u0026gt;\u0026lt;/header\u0026gt; \u0026lt;bottom\u0026gt; \u0026lt;![CDATA[Copyright \u0026amp;copy; ${project.inceptionYear}\u0026amp;ndash;{currentYear}, \u0026lt;a href=\u0026#34;${project.organization.url}\u0026#34; target=\u0026#34;_parent\u0026#34;\u0026gt;${project.organization.name}\u0026lt;/a\u0026gt;. All rights reserved.]]\u0026gt; \u0026lt;/bottom\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;executions\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;id\u0026gt;attach-javadocs\u0026lt;/id\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;jar\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;/executions\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;/pluginManagement\u0026gt; \u0026lt;/build\u0026gt; Distribution ç®¡ç†ä¿¡æ¯ï¼š\n\u0026lt;distributionManagement\u0026gt; \u0026lt;repository\u0026gt; \u0026lt;id\u0026gt;ossrh\u0026lt;/id\u0026gt; \u0026lt;url\u0026gt;https://s01.oss.sonatype.org/service/local/staging/deploy/maven2/\u0026lt;/url\u0026gt; \u0026lt;/repository\u0026gt; \u0026lt;snapshotRepository\u0026gt; \u0026lt;id\u0026gt;ossrh\u0026lt;/id\u0026gt; \u0026lt;url\u0026gt;https://s01.oss.sonatype.org/content/repositories/snapshots\u0026lt;/url\u0026gt; \u0026lt;uniqueVersion\u0026gt;true\u0026lt;/uniqueVersion\u0026gt; \u0026lt;/snapshotRepository\u0026gt; \u0026lt;site\u0026gt; \u0026lt;id\u0026gt;github\u0026lt;/id\u0026gt; \u0026lt;url\u0026gt;https://github.com/chensoul/chensoul-parent\u0026lt;/url\u0026gt; \u0026lt;/site\u0026gt; \u0026lt;/distributionManagement\u0026gt; è®¾ç½®ä¸€ä¸ª profileï¼š\n\u0026lt;profiles\u0026gt; \u0026lt;!-- mvn clean source:jar javadoc:jar deploy -DskipTests -P release --\u0026gt; \u0026lt;profile\u0026gt; \u0026lt;id\u0026gt;release\u0026lt;/id\u0026gt; \u0026lt;build\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;!-- https://blog.sonatype.com/2010/01/how-to-generate-pgp-signatures-with-maven/--\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-gpg-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.1.0\u0026lt;/version\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;gpgArguments\u0026gt; \u0026lt;arg\u0026gt;--pinentry-mode\u0026lt;/arg\u0026gt; \u0026lt;arg\u0026gt;loopback\u0026lt;/arg\u0026gt; \u0026lt;/gpgArguments\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;executions\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;id\u0026gt;sign-artifacts\u0026lt;/id\u0026gt; \u0026lt;phase\u0026gt;verify\u0026lt;/phase\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;sign\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;/executions\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;/build\u0026gt; \u0026lt;/profile\u0026gt; 2. GPG è®¾ç½® å®‰è£… GPG ç”Ÿæˆ key ä¸Šä¼  key MacOs ä¸Šæ“ä½œå¦‚ä¸‹ï¼š\nbrew install gpg # Generate a key gpg --gen-key # List your key gpg --list-keys # Define a key expiration : \u0026#39; Press 1 Type expire Type the expiration Months\\Years Type save \u0026#39; gpg --edit-key \u0026lt;Your Key - You Can Get From The Command Above --list-keys\u0026gt; # Distribute your public key to a key server gpg --keyserver keyserver.ubuntu.com --send-keys \u0026lt;Your Key - You Can Get From The Command Above --list-keys\u0026gt; 3. åˆ›å»º Sonatype è´¦å· åœ¨ Sonatype Jira ä¸Šåˆ›å»ºç”¨æˆ·ï¼Œå¹¶æäº¤ Issure\nåœ¨ settings.xml ä¸­é…ç½® Sonatype ç”¨æˆ·åå’Œå¯†ç ä»¥åŠ gpg å¯†é’¥\n\u0026lt;servers\u0026gt; \u0026lt;server\u0026gt; \u0026lt;id\u0026gt;gpg.passphrase\u0026lt;/id\u0026gt; \u0026lt;passphrase\u0026gt;xxxx\u0026lt;/passphrase\u0026gt; \u0026lt;/server\u0026gt; \u0026lt;server\u0026gt; \u0026lt;id\u0026gt;ossrh\u0026lt;/id\u0026gt; \u0026lt;username\u0026gt;xxxx\u0026lt;/username\u0026gt; \u0026lt;password\u0026gt;xxxxx\u0026lt;/password\u0026gt; \u0026lt;/server\u0026gt; \u0026lt;/servers\u0026gt; 4. éƒ¨ç½² Maven deploy å‘½ä»¤ï¼š\nmvn clean source:jar javadoc:jar deploy -DskipTests -P release æ‰§è¡ŒæˆåŠŸä¹‹åï¼Œå¯ä»¥åœ¨ä¸‹é¢ä¸‰ä¸ªä»“åº“æŸ¥çœ‹ï¼š\nSNAPSHOT artifacts Sontype Release artifacts Maven Release artifacts Maven central release ä¾‹å¦‚ï¼Œå¦‚æœå½“å‰é¡¹ç›®ä¸ºå¿«ç…§ç‰ˆæœ¬ï¼š1.0.35-SNAPSHOTï¼Œæ‰§è¡Œä¸Šé¢ deploy å‘½ä»¤ä¹‹åï¼Œåœ¨ SNAPSHOT artifacts å¯ä»¥çœ‹åˆ°ä¸Šä¼ çš„å†…å®¹ï¼š\nå¦‚æœå½“å‰é¡¹ç›®ä¸ºæ­£å¼ç‰ˆæœ¬ï¼š1.0.35ï¼Œæ‰§è¡Œä¸Šé¢ deploy å‘½ä»¤ä¹‹åï¼Œå¯ä»¥çœ‹åˆ°è¾“å‡ºæ—¥å¿—ï¼š\nUploaded to ossrh: https://s01.oss.sonatype.org:443/service/local/staging/deployByRepositoryId/comchensoul-1107/com/chensoul/chensoul-parent/1.0.35/chensoul-parent-1.0.35.pom.asc (228 B at 425 B/s) [INFO] * Upload of locally staged artifacts finished. [INFO] * Closing staging repository with ID \u0026#34;comchensoul-1107\u0026#34;. Waiting for operation to complete... ................. [INFO] Remote staged 1 repositories, finished with success. [INFO] ------------------------------------------------------------------------ [INFO] BUILD SUCCESS [INFO] ------------------------------------------------------------------------ [INFO] Total time: 01:15 min [INFO] Finished at: 2023-12-20T09:21:20+08:00 [INFO] ------------------------------------------------------------------------ ç™»é™† https://s01.oss.sonatype.org/ ä¹‹åï¼Œåœ¨ https://s01.oss.sonatype.org/#stagingRepositories å¯ä»¥æŸ¥çœ‹åˆ° comchensoul-1107 è¿™ä¸ª staging ä»“åº“ã€‚\nstaging æ„æ€æ˜¯è¯¥ä»“åº“è¿˜ä¸æ˜¯æ­£å¼ä»“åº“ï¼Œåœ¨ Maven Release artifacts è¿˜æŸ¥è¯¢ä¸åˆ°ã€‚å¦‚æœæƒ³å°†è¯¥ staging ä»“åº“å‘å¸ƒåˆ° Release ä»“åº“ï¼Œåˆ™éœ€è¦ç‚¹å‡»ä¸Šå›¾ä¸­çš„ Release æŒ‰é’®ã€‚ç„¶åç­‰å‡ åˆ†é’Ÿå°±å¯ä»¥ä¸­ Release ä»“åº“çœ‹åˆ°ï¼š\nhttps://repo.maven.apache.org ã€https://mvnrepository.com/ åŒæ­¥æœ‰å»¶æ—¶ï¼Œè¿˜æ²¡æœ‰æŸ¥è¯¢åˆ°ã€‚\nå¦‚æœæƒ³åœ¨ staging ä»“åº“å…³é—­ä¹‹åè‡ªåŠ¨ Release åˆ°æ­£å¼ä»“åº“ï¼Œå¯ä»¥ä½¿ç”¨ nexus-staging-maven-plugin æ’ä»¶ã€‚åœ¨ release profile ä¸­æ·»åŠ ï¼š\n\u0026lt;!-- https://itnext.io/publishing-artifacts-to-maven-central-using-github-actions-a-step-by-step-guide-fd65ef075fd4 --\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.sonatype.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;nexus-staging-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.6.13\u0026lt;/version\u0026gt; \u0026lt;extensions\u0026gt;true\u0026lt;/extensions\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;serverId\u0026gt;ossrh\u0026lt;/serverId\u0026gt; \u0026lt;nexusUrl\u0026gt;https://s01.oss.sonatype.org/\u0026lt;/nexusUrl\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt; ç„¶ååœ¨ deploy å‘½ä»¤åæ·»åŠ å‚æ•°ï¼š\nmvn clean source:jar javadoc:jar deploy -DskipTests -P release -DautoReleaseAfterClose=true 5. åœ¨ GitHub Actions é…ç½® CICD é…ç½®ä¸€ä¸ª maven-release.yml æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å‚è€ƒå¦‚ä¸‹ï¼š\n# This workflow will build a package using Maven and then publish it to GitHub packages when a release is created # For more information see: https://github.com/actions/setup-java/blob/main/docs/advanced-usage.md#apache-maven-with-a-settings-path name: Maven Release on: release: types: [created] jobs: publish: runs-on: ubuntu-latest steps: - uses: actions/checkout@v4 - name: Install gpg secret key run: | cat \u0026lt;(echo -e \u0026#34;${{ secrets.MAVEN_GPG_PRIVATE_KEY }}\u0026#34;) | gpg --batch --import gpg --list-secret-keys --keyid-format LONG - name: Set up Java for publishing to Maven Central Repository uses: actions/setup-java@v4 with: java-version: 8 distribution: \u0026#34;temurin\u0026#34; cache: \u0026#34;maven\u0026#34; server-id: ossrh server-username: MAVEN_USERNAME server-password: MAVEN_PASSWORD gpg-passphrase: PASSPHRASE - name: Maven Release run: mvn -ntp -B -U clean source:jar javadoc:jar deploy site scm-publish:publish-scm -P release -DautoReleaseAfterClose=true env: MAVEN_USERNAME: ${{ secrets.OSSRH_USERNAME }} MAVEN_PASSWORD: ${{ secrets.OSSRH_TOKEN }} PASSPHRASE: ${{ secrets.MAVEN_GPG_PASSPHRASE }} éœ€è¦è‡ª GitHub Actions çš„ Actions é¡µé¢é…ç½®ä»¥ä¸‹ Secretsï¼š\nOSSRH_USERNAME OSSRH_TOKEN MAVEN_GPG_PASSPHRASE MAVEN_GPG_PRIVATE_KEY å…¶ Maven æ‰§è¡Œå‘½ä»¤ï¼š\nmvn -ntp -B -U clean deploy site scm-publish:publish-scm -P release -DautoReleaseAfterClose=true æ³¨æ„ï¼šè¿™é‡Œ scm-publish æ˜¯æŠŠç”Ÿæˆçš„ site ç«™ç‚¹å‘å¸ƒåˆ°è¯¥ä»“åº“çš„ gp-pages åˆ†æ”¯\n6. åœ¨é¡¹ç›®é‡Œé¢é…ç½® sonatype ä»“åº“ åœ¨ pom.xml ä¸­æ·»åŠ ï¼š\n\u0026lt;repositories\u0026gt; \u0026lt;!-- å¦‚æœä½¿ç”¨æµè§ˆå™¨è®¿é—®æ—¶ï¼Œéœ€è¦æ·»åŠ  groupId æ‰æ˜¾ç¤ºå†…å®¹ --\u0026gt; \u0026lt;repository\u0026gt; \u0026lt;id\u0026gt;oss-snapshots\u0026lt;/id\u0026gt; \u0026lt;url\u0026gt;https://oss.sonatype.org/content/repositories/snapshots/\u0026lt;/url\u0026gt; \u0026lt;releases\u0026gt; \u0026lt;enabled\u0026gt;false\u0026lt;/enabled\u0026gt; \u0026lt;/releases\u0026gt; \u0026lt;snapshots\u0026gt; \u0026lt;enabled\u0026gt;true\u0026lt;/enabled\u0026gt; \u0026lt;/snapshots\u0026gt; \u0026lt;/repository\u0026gt; \u0026lt;repository\u0026gt; \u0026lt;id\u0026gt;oss-snapshots-s01\u0026lt;/id\u0026gt; \u0026lt;url\u0026gt;https://s01.oss.sonatype.org/content/repositories/snapshots/\u0026lt;/url\u0026gt; \u0026lt;releases\u0026gt; \u0026lt;enabled\u0026gt;false\u0026lt;/enabled\u0026gt; \u0026lt;/releases\u0026gt; \u0026lt;snapshots\u0026gt; \u0026lt;enabled\u0026gt;true\u0026lt;/enabled\u0026gt; \u0026lt;/snapshots\u0026gt; \u0026lt;/repository\u0026gt; \u0026lt;/repositories\u0026gt; \u0026ndash; EOF\n","permalink":"https://blog.chensoul.cc/posts/2023/12/13/til/","summary":"Today I Learned. ä»Šå¤©åˆ†äº«å†…å®¹ï¼šå‘å¸ƒåˆ° Maven ä¸­å¤®ä»“åº“çš„ç¬¬ä¸€ä¸ªé¡¹ç›®ã€‚\næœ€è¿‘åœ¨ Github ä¸Šåˆ›å»ºäº†ä¸€ä¸ª Pom ç±»å‹çš„ Maven é¡¹ç›® chensoul-parentï¼Œè¯¥é¡¹ç›®ä¸»é¡µ https://chensoul.github.io/chensoul-parent/ ï¼Œè¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ä¸ªå‘å¸ƒå¯¹ Maven ä¸­å¤®ä»“åº“çš„é¡¹ç›®ã€‚\nå…¶ä¸»è¦ç”¨é€”æ˜¯ç®¡ç†å¸¸ç”¨çš„ Maven Plugin æ’ä»¶ã€‚åœ¨ç¼–å†™è¯¥é¡¹ç›®çš„è¿‡ç¨‹ä¸­ï¼Œå‚è€ƒäº†ä¸€äº›å¼€æºé¡¹ç›®ï¼Œä»–ä»¬åˆ†åˆ«æ˜¯ï¼š\nhttps://github.com/eclipse/microprofile Eclipse çš„ä¸€å¥—å¼€æºå¾®æœåŠ¡æ¡†æ¶å®ç° https://github.com/microbean/microbean-function microBeanâ„¢ çš„ Java æ‰©å±• https://github.com/naturalett/maven-hello-world ä¸€ä¸ª Maven å‘å¸ƒ Jar çš„ hello world çš„ç¤ºä¾‹é¡¹ç›® https://github.com/eclipse-store/store Eclipse å¼€æºçš„ä¸€ä¸ªé«˜æ€§èƒ½ Java åŸç”ŸæŒä¹…å­˜å‚¨ã€‚å¾®ç§’å“åº”æ—¶é—´ã€‚è¶…é«˜ååé‡ã€‚æœ€å°å»¶è¿Ÿã€‚åˆ›å»ºè¶…å¿«é€Ÿå†…å­˜æ•°æ®åº“åº”ç”¨ç¨‹åºå’Œå¾®æœåŠ¡ã€‚ è¯¥é¡¹ç›®æ‰“åŒ…ä¹‹åæ˜¯ä¸€ä¸ª pom æ–‡ä»¶ï¼Œä»»ä½• Maven é¡¹ç›®éƒ½å¯ä»¥ç»§æ‰¿è¿™ä¸ªé¡¹ç›®ï¼Œè¿™æ ·å¯ä»¥å…å»è‡ªå·±ç®¡ç† Mave Plugin æ’ä»¶çš„éº»çƒ¦ã€‚è¿™é‡Œé¢çš„ Mave Plugin æ’ä»¶åŒ…æ‹¬ï¼š\nç¼–è¯‘ æ‰“åŒ… å‘å¸ƒ æµ‹è¯•ï¼Œå¹¶ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š è´¨é‡æ£€æµ‹ï¼ŒåŒ…æ‹¬ä»£ç é£æ ¼æ£€æŸ¥ã€æ¼æ´æ£€æµ‹ ç”Ÿæˆç½‘ç«™å¹¶å‘å¸ƒåˆ° github pages å‘å¸ƒå…ˆæ˜¯ä½¿ç”¨çš„ Maven Release Plugin å’Œ Nexus Staging Maven Plugin æ’ä»¶ï¼Œåæ¥è§‰å¾— Maven Release Plugin æ’ä»¶åšçš„äº‹æƒ…å¤ªå¤šäº†ï¼Œä¸å¦‚æ‰‹åŠ¨æ‰§è¡Œå‘½ä»¤ï¼Œäºæ˜¯å»æ‰äº† Maven Release Plugin æ’ä»¶ã€‚\nå…³äº Nexus Staging Maven Plugin æ’ä»¶çš„ä½¿ç”¨äº†ï¼Œèµ·åˆæˆ‘ä½¿ç”¨äº†è¿™ä¸ªä»“åº“å‘å¸ƒ Maven æ„å»ºçš„è„šæœ¬ ã€‚è¿™ä¸ªè„šæœ¬æ¯”è¾ƒå¤æ‚ï¼Œäºæ˜¯æ‰¾åˆ°äº† https://github.com/naturalett/maven-hello-world è¿™ä¸ªä»“åº“ï¼Œå…¶å¯¹åº”çš„åšå®¢ ã€ŠPublishing Artifacts to Maven Central using GitHub Actions: A Step-by-Step Guideã€‹ï¼Œå¯¹äºå¦‚ä½•éƒ¨ç½²æ„å»ºåˆ° Maven ä¸­å¤®ä»“åº“ã€å¦‚ä½•ä½¿ç”¨ Github Action è¯´çš„æ¯”è¾ƒæ¸…æ¥šã€‚å¦‚æœä½ å¯¹äºå¦‚ä½•ä½¿ç”¨è¿™ä¸ªæ’ä»¶ï¼Œå¯ä»¥é˜…è¯»è¯¥æ–‡ç« ï¼Œæœ¬æ–‡ä¸ä½œèµ˜è¿°ã€‚","title":"2023-12-13ï½œå‘å¸ƒåˆ°Mavenä¸­å¤®ä»“åº“çš„ç¬¬ä¸€ä¸ªé¡¹ç›®"},{"content":"Today I Learned. ä»Šå¤©æˆ‘å­¦äº†ï¼šRMIã€Javaæ¼æ´å®‰å…¨ã€Semgrepæ¼æ´æ£€æµ‹ã€‚\nRMI ä»‹ç» RMIï¼ˆRemote Method Invocationï¼‰æ˜¯Javaè¯­è¨€æä¾›çš„ä¸€ç§è¿œç¨‹è°ƒç”¨æœºåˆ¶ï¼Œç”¨äºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å®ç°å¯¹è±¡ä¹‹é—´çš„è¿œç¨‹é€šä¿¡ã€‚\né€šè¿‡Java RMIï¼Œå¼€å‘äººå‘˜å¯ä»¥åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹å¯¹è±¡çš„æ–¹æ³•ã€‚RMIéšè—äº†åº•å±‚ç½‘ç»œé€šä¿¡çš„å¤æ‚æ€§ï¼Œä½¿å¾—è¿œç¨‹æ–¹æ³•è°ƒç”¨è¿‡ç¨‹å¯¹äºå¼€å‘äººå‘˜æ¥è¯´æ›´åŠ ç®€å•å’Œé€æ˜ã€‚\nå‘å±•å†å² RMIï¼ˆRemote Method Invocationï¼‰æ˜¯Javaè¯­è¨€æä¾›çš„ä¸€ç§è¿œç¨‹è°ƒç”¨æœºåˆ¶ï¼Œå®ƒçš„å‘å±•å†å²å¯ä»¥è¿½æº¯åˆ°ä¸Šä¸ªä¸–çºª90å¹´ä»£ã€‚\nä»¥ä¸‹æ˜¯RMIçš„ä¸»è¦å‘å±•å†ç¨‹ï¼š\nåˆæœŸç‰ˆæœ¬ï¼ˆJava 1.1ï¼‰ï¼šRMIæœ€æ—©å‡ºç°åœ¨Java 1.1ç‰ˆæœ¬ä¸­ï¼Œå®ƒæä¾›äº†åŸºæœ¬çš„è¿œç¨‹è°ƒç”¨åŠŸèƒ½ï¼Œå…è®¸å¼€å‘äººå‘˜åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä½¿ç”¨Javaå¯¹è±¡è¿›è¡Œè¿œç¨‹æ–¹æ³•è°ƒç”¨ã€‚è¿™ä¸ªç‰ˆæœ¬çš„RMIè¿˜æ¯”è¾ƒç®€å•ï¼ŒåŠŸèƒ½ç›¸å¯¹æœ‰é™ã€‚ RMI-IIOPï¼ˆJava 1.2ï¼‰ï¼šéšç€Java 1.2ç‰ˆæœ¬çš„å‘å¸ƒï¼ŒSun Microsystemsï¼ˆç°åœ¨çš„Oracleï¼‰å¼•å…¥äº†RMI-IIOPï¼ˆRMI over IIOPï¼‰çš„æ¦‚å¿µï¼Œå°†RMIä¸CORBAï¼ˆCommon Object Request Broker Architectureï¼‰è¿›è¡Œäº†æ•´åˆã€‚RMI-IIOPä½¿ç”¨IIOPï¼ˆInternet Inter-ORB Protocolï¼‰ä½œä¸ºåº•å±‚çš„é€šä¿¡åè®®ï¼Œä½¿å¾—Javaå¯¹è±¡èƒ½å¤Ÿä¸å…¶ä»–ç¼–ç¨‹è¯­è¨€çš„å¯¹è±¡è¿›è¡Œäº¤äº’ã€‚ JDK 1.3å’Œ1.4çš„æ”¹è¿›ï¼šåœ¨JDK 1.3å’Œ1.4ç‰ˆæœ¬ä¸­ï¼ŒRMIå¾—åˆ°äº†è¿›ä¸€æ­¥æ”¹è¿›å’Œå¢å¼ºã€‚å…¶ä¸­åŒ…æ‹¬å¯¹Javaåºåˆ—åŒ–æœºåˆ¶çš„æ”¹è¿›ï¼Œæä¾›äº†æ›´å¥½çš„å…¼å®¹æ€§å’Œæ€§èƒ½ã€‚æ­¤å¤–ï¼Œè¿˜å¼•å…¥äº†Java Activation Frameworkï¼ˆJAFï¼‰ï¼Œç”¨äºå¤„ç†ä¼ è¾“çš„æ•°æ®ç±»å‹ã€‚ Java 5çš„å¢å¼ºï¼šJava 5å¼•å…¥äº†ä¸€äº›é‡è¦çš„å¢å¼ºåŠŸèƒ½ï¼Œå¦‚æ³¨è§£ï¼ˆAnnotationsï¼‰å’Œæ³›å‹ï¼ˆGenericsï¼‰ã€‚è¿™äº›åŠŸèƒ½ä½¿å¾—RMIçš„ä½¿ç”¨æ›´åŠ ä¾¿æ·å’Œçµæ´»ã€‚ Java 8å’Œåç»­ç‰ˆæœ¬ï¼šåœ¨Java 8åŠå…¶åç»­ç‰ˆæœ¬ä¸­ï¼ŒRMIå¹¶æ²¡æœ‰è¿›è¡Œå¤§è§„æ¨¡çš„æ”¹åŠ¨ã€‚ç„¶è€Œï¼Œéšç€Javaå¹³å°çš„ä¸æ–­å‘å±•å’Œæ”¹è¿›ï¼ŒRMIä»ç„¶æ˜¯Javaåˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¸¸ç”¨çš„è¿œç¨‹è°ƒç”¨æœºåˆ¶ä¹‹ä¸€ã€‚ æ¶æ„ RMIæ¶æ„åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š\nè¿œç¨‹æ¥å£ï¼ˆRemote Interfaceï¼‰ï¼šè¿œç¨‹æ¥å£å®šä¹‰äº†è¿œç¨‹å¯¹è±¡çš„æ–¹æ³•åˆ—è¡¨ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è¯¥æ¥å£è°ƒç”¨è¿œç¨‹å¯¹è±¡çš„æ–¹æ³•ã€‚è¿œç¨‹æ¥å£å¿…é¡»ç»§æ‰¿java.rmi.Remoteæ¥å£ï¼Œå¹¶å£°æ˜å¯ä»¥è¢«è¿œç¨‹è°ƒç”¨çš„æ–¹æ³•ã€‚ è¿œç¨‹å¯¹è±¡ï¼ˆRemote Objectï¼‰ï¼šè¿œç¨‹å¯¹è±¡æ˜¯å®ç°äº†è¿œç¨‹æ¥å£çš„Javaå¯¹è±¡ã€‚è¿™äº›å¯¹è±¡çš„æ–¹æ³•å¯ä»¥é€šè¿‡RMIè¿›è¡Œè¿œç¨‹è°ƒç”¨ã€‚è¿œç¨‹å¯¹è±¡å¿…é¡»ç»§æ‰¿java.rmi.server.UnicastRemoteObjectç±»ï¼Œå¹¶å®ç°å¯¹åº”çš„è¿œç¨‹æ¥å£ã€‚ è¿œç¨‹æ³¨å†Œè¡¨ï¼ˆRemote Registryï¼‰ï¼šè¿œç¨‹æ³¨å†Œè¡¨æ˜¯ä¸€ä¸ªä¸­å¤®æ³¨å†Œè¡¨ï¼Œç”¨äºå­˜å‚¨è¿œç¨‹å¯¹è±¡çš„å¼•ç”¨ã€‚å®¢æˆ·ç«¯å¯ä»¥æŸ¥è¯¢è¿œç¨‹æ³¨å†Œè¡¨ä»¥è·å–è¿œç¨‹å¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶é€šè¿‡å¼•ç”¨è°ƒç”¨è¿œç¨‹å¯¹è±¡çš„æ–¹æ³•ã€‚è¿œç¨‹æ³¨å†Œè¡¨ä½¿ç”¨RMIæ³¨å†Œè¡¨æœåŠ¡ï¼ˆrmiregistryï¼‰æ¥å®ç°ã€‚ Stubï¼ˆå­˜æ ¹ï¼‰å’ŒSkeletonï¼ˆéª¨æ¶ï¼‰ï¼šStubå’ŒSkeletonæ˜¯RMIçš„å…³é”®ç»„ä»¶ï¼Œç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚Stubæ˜¯å®¢æˆ·ç«¯çš„ä»£ç†ï¼Œå®ƒè´Ÿè´£å°†å®¢æˆ·ç«¯çš„æ–¹æ³•è°ƒç”¨è½¬å‘åˆ°è¿œç¨‹å¯¹è±¡ã€‚Skeletonæ˜¯æœåŠ¡å™¨ç«¯çš„ä»£ç†ï¼Œå®ƒè´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯çš„æ–¹æ³•è°ƒç”¨å¹¶å°†å…¶è½¬å‘ç»™å®é™…çš„è¿œç¨‹å¯¹è±¡ã€‚ RMIåè®®ï¼ˆRMI Protocolï¼‰ï¼šRMIåè®®å®šä¹‰äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡åè®®ï¼ŒåŒ…æ‹¬è¯·æ±‚ã€å“åº”ã€å‚æ•°ä¼ é€’å’Œåºåˆ—åŒ–ç­‰ç»†èŠ‚ã€‚RMIåè®®ä½¿ç”¨Javaåºåˆ—åŒ–æ¥å¯¹å¯¹è±¡è¿›è¡Œç¼–ç å’Œè§£ç ï¼Œä»¥å®ç°å¯¹è±¡åœ¨ç½‘ç»œä¸Šçš„ä¼ è¾“ã€‚ RMIæ¶æ„çš„åŸºæœ¬å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š\næœåŠ¡å™¨ç«¯å°†è¿œç¨‹å¯¹è±¡æ³¨å†Œåˆ°è¿œç¨‹æ³¨å†Œè¡¨ä¸­ã€‚ å®¢æˆ·ç«¯ä»è¿œç¨‹æ³¨å†Œè¡¨ä¸­è·å–è¿œç¨‹å¯¹è±¡çš„å¼•ç”¨ã€‚ å®¢æˆ·ç«¯é€šè¿‡å¼•ç”¨è°ƒç”¨è¿œç¨‹å¯¹è±¡çš„æ–¹æ³•ã€‚ å®¢æˆ·ç«¯çš„æ–¹æ³•è°ƒç”¨è¢«è½¬å‘åˆ°æœåŠ¡å™¨ç«¯çš„è¿œç¨‹å¯¹è±¡ã€‚ æœåŠ¡å™¨ç«¯çš„è¿œç¨‹å¯¹è±¡æ‰§è¡Œç›¸åº”çš„æ–¹æ³•ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚ å®¢æˆ·ç«¯æ¥æ”¶åˆ°æ–¹æ³•çš„è¿”å›å€¼ã€‚ åœ¨JDK 1.2ç‰ˆæœ¬ï¼ˆ1998ï¼‰ä¹‹åï¼Œéª¨æ¶skeletonä¸å†è¢«éœ€è¦, ç”±Javaçš„UnicastServerRef#dispatchæ›¿ä»£ï¼›åœ¨JDK 5 ï¼ˆå¤§å®¶å¸¸è¯´çš„1.5ï¼‰ä¹‹åï¼Œä¸å†éœ€è¦æ‰‹åŠ¨åˆ©ç”¨rmicå‘½ä»¤ç”Ÿæˆé™æ€Stubï¼Œè€Œæ˜¯ä¼šç”±Javaè‡ªåŠ¨åœ°åŠ¨æ€ç”Ÿæˆã€‚è¿™ä¸ªåŠ¨æ€ç”Ÿæˆä¹Ÿæ˜¯æˆ‘ä»¬åé¢JNDIæ³¨å…¥çš„å…³é”®ã€‚\nRMIæ¼æ´ RMIï¼ˆRemote Method Invocationï¼‰åœ¨è¿‡å»çš„ä¸€æ®µæ—¶é—´ä¸­æ›¾å‘ç°ä¸€äº›å®‰å…¨æ¼æ´ï¼Œè¿™äº›æ¼æ´å¯èƒ½ä¼šå¯¼è‡´å®‰å…¨é£é™©ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„RMIæ¼æ´ï¼š\nååºåˆ—åŒ–æ¼æ´ï¼šRMIä½¿ç”¨Javaåºåˆ—åŒ–æœºåˆ¶æ¥åœ¨ç½‘ç»œä¸Šä¼ è¾“å¯¹è±¡ã€‚ç„¶è€Œï¼Œå¦‚æœä¸æ­£ç¡®åœ°å¤„ç†ååºåˆ—åŒ–è¿‡ç¨‹ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡æ„é€ æ¶æ„åºåˆ—åŒ–æ•°æ®æ¥æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚è¿™ç§æ¼æ´è¢«å¹¿æ³›ç§°ä¸º\u0026quot;Javaååºåˆ—åŒ–æ¼æ´\u0026quot;æˆ–\u0026quot;Javaååºåˆ—åŒ–æ”»å‡»\u0026quot;ï¼Œå¹¶ä¸”ä¸ä»…ä»…å½±å“RMIï¼Œè¿˜å¯èƒ½å½±å“å…¶ä»–ä½¿ç”¨Javaåºåˆ—åŒ–çš„æŠ€æœ¯ã€‚ æœªæˆæƒè®¿é—®æ¼æ´ï¼šRMIæœåŠ¡é»˜è®¤æƒ…å†µä¸‹å¯èƒ½æ²¡æœ‰è¿›è¡Œé€‚å½“çš„èº«ä»½éªŒè¯å’Œæˆæƒæ£€æŸ¥ã€‚è¿™å¯èƒ½å¯¼è‡´æ”»å‡»è€…èƒ½å¤Ÿæœªç»æˆæƒåœ°è®¿é—®è¿œç¨‹å¯¹è±¡å’Œè°ƒç”¨æ–¹æ³•ï¼Œä»è€Œé€ æˆå®‰å…¨é£é™©ã€‚ æ³¨å†Œè¡¨ç»•è¿‡æ¼æ´ï¼šRMIä½¿ç”¨æ³¨å†Œè¡¨ï¼ˆRegistryï¼‰æ¥å­˜å‚¨è¿œç¨‹å¯¹è±¡çš„å¼•ç”¨ã€‚æ”»å‡»è€…å¯èƒ½é€šè¿‡ç»•è¿‡æ³¨å†Œè¡¨æˆ–ç¯¡æ”¹æ³¨å†Œè¡¨ä¸­çš„å¼•ç”¨ï¼Œæ¥æ‰§è¡Œæ¶æ„æ“ä½œæˆ–æ›¿æ¢åŸå§‹å¯¹è±¡ã€‚ æœªåŠ å¯†çš„é€šä¿¡æ¼æ´ï¼šå¦‚æœRMIçš„é€šä¿¡è¿‡ç¨‹æ²¡æœ‰é€‚å½“åœ°åŠ å¯†å’Œä¿æŠ¤ï¼Œæ”»å‡»è€…å¯èƒ½èƒ½å¤Ÿçªƒå¬ã€ç¯¡æ”¹æˆ–é‡æ”¾ç½‘ç»œé€šä¿¡ï¼Œä»è€Œè·å–æ•æ„Ÿä¿¡æ¯æˆ–æ‰§è¡Œä¸­é—´äººæ”»å‡»ã€‚ ä¸ºäº†ç¼“è§£è¿™äº›æ¼æ´çš„é£é™©ï¼Œå»ºè®®é‡‡å–ä»¥ä¸‹å®‰å…¨æªæ–½ï¼š\nåŠæ—¶æ›´æ–°å’Œå‡çº§ä½¿ç”¨çš„Javaè¿è¡Œæ—¶ç¯å¢ƒï¼Œä»¥è·å–æœ€æ–°çš„å®‰å…¨ä¿®å¤ç¨‹åºã€‚JDK 8u121å¼•å…¥äº†å¯¹RMIæ¼æ´çš„ä¿®å¤ã€‚ åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­è°¨æ…å¤„ç†è¾“å…¥æ•°æ®ï¼Œé¿å…æ¥å—æœªå—ä¿¡ä»»çš„åºåˆ—åŒ–æ•°æ®ã€‚ å®æ–½é€‚å½“çš„èº«ä»½éªŒè¯å’Œæˆæƒæœºåˆ¶ï¼Œç¡®ä¿åªæœ‰ç»è¿‡æˆæƒçš„ç”¨æˆ·å¯ä»¥è®¿é—®å’Œè°ƒç”¨è¿œç¨‹å¯¹è±¡ã€‚ ä½¿ç”¨å®‰å…¨åè®®ï¼ˆå¦‚SSL/TLSï¼‰å¯¹RMIé€šä¿¡è¿›è¡ŒåŠ å¯†å’Œä¿æŠ¤ã€‚ é…ç½®å’Œé™åˆ¶RMIçš„ç½‘ç»œè®¿é—®ï¼Œä»…å…è®¸å—ä¿¡ä»»çš„ä¸»æœºå’Œç«¯å£è¿›è¡Œé€šä¿¡ã€‚ å¯¹RMIæ³¨å†Œè¡¨è¿›è¡Œå®‰å…¨é…ç½®ï¼Œé™åˆ¶å¯¹æ³¨å†Œè¡¨çš„è®¿é—®æƒé™ã€‚ RMIç”¨åˆ°çš„æŠ€æœ¯ Javaåºåˆ—åŒ–ï¼ˆSerializationï¼‰ï¼šRMIä½¿ç”¨Javaåºåˆ—åŒ–æ¥å®ç°å¯¹è±¡åœ¨ç½‘ç»œä¸Šçš„ä¼ è¾“ã€‚Javaåºåˆ—åŒ–æœºåˆ¶å…è®¸å°†Javaå¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµè¡¨ç¤ºï¼Œä»¥ä¾¿åœ¨ç½‘ç»œä¸Šè¿›è¡Œä¼ è¾“ã€‚RMIä½¿ç”¨Javaåºåˆ—åŒ–å°†æ–¹æ³•è°ƒç”¨å’Œå‚æ•°ç¼–ç ä¸ºå­—èŠ‚æµï¼Œå¹¶åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œä¼ è¾“ã€‚ Javaç½‘ç»œé€šä¿¡ï¼ˆNetwork Communicationï¼‰ï¼šRMIä½¿ç”¨Javaçš„ç½‘ç»œé€šä¿¡æœºåˆ¶æ¥åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œè¿œç¨‹è°ƒç”¨çš„ä¼ è¾“ã€‚RMIæ”¯æŒå¤šç§åº•å±‚ä¼ è¾“åè®®ï¼Œå¦‚JRMPï¼ˆJava Remote Method Protocolï¼‰å’ŒIIOPï¼ˆInternet Inter-ORB Protocolï¼‰ã€‚è¿™äº›åè®®è´Ÿè´£å°†ç¼–ç çš„æ–¹æ³•è°ƒç”¨å’Œå‚æ•°ä¼ è¾“åˆ°è¿œç¨‹å¯¹è±¡ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚ ä»£ç†ã€‚Stubå’ŒSkeletonæ˜¯RMIä¸­çš„ä»£ç†ç»„ä»¶ã€‚Stubæ˜¯å®¢æˆ·ç«¯çš„ä»£ç†ï¼ŒSkeletonæ˜¯æœåŠ¡å™¨ç«¯çš„ä»£ç†ã€‚Stubè´Ÿè´£å°†å®¢æˆ·ç«¯çš„æ–¹æ³•è°ƒç”¨è½¬å‘åˆ°è¿œç¨‹å¯¹è±¡ï¼Œè€ŒSkeletonæ¥æ”¶å®¢æˆ·ç«¯çš„æ–¹æ³•è°ƒç”¨å¹¶å°†å…¶è½¬å‘ç»™å®é™…çš„è¿œç¨‹å¯¹è±¡ã€‚Stubå’ŒSkeletonå¤„ç†äº†ç½‘ç»œé€šä¿¡ã€å‚æ•°ç¼–ç»„å’Œè§£ç»„ç­‰ç»†èŠ‚ï¼Œä½¿å¾—è¿œç¨‹è°ƒç”¨è¿‡ç¨‹å¯¹å¼€å‘äººå‘˜é€æ˜ã€‚ Javaæ¼æ´ æ–‡ç«  å…³äºJavaä¸­RMIçš„ä¸ªäººæ‹™è§\nJava JNDIå…¶å®ƒæ³¨å…¥ç‚¹åˆ†æ\nJava JNDIæ³¨å…¥æºç åˆ†æ\nJava RMIååºåˆ—åŒ–\u0026amp;JNDIæ³¨å…¥\nJNDI æ³¨å…¥æ¼æ´çš„å‰ä¸–ä»Šç”Ÿ\næ”»å‡»Javaä¸­çš„JNDIã€RMIã€LDAP(ä¸€)\næ”»å‡»Javaä¸­çš„JNDIã€RMIã€LDAP(äºŒ)\næ”»å‡»Javaä¸­çš„JNDIã€RMIã€LDAP(ä¸‰)\næ”»å‡»Java Webåº”ç”¨-[Java Webå®‰å…¨]\nè§†é¢‘ Bç«™æœ€å…¨çš„Javaå®‰å…¨å­¦ä¹ è·¯çº¿ Javaååºåˆ—åŒ–RMIä¸“é¢˜-æ²¡æœ‰äººæ¯”æˆ‘æ›´æ‡‚RMI åšå®¢ https://paper.seebug.org/\nhttps://su18.org/\nhttps://www.03sec.com/\nhttps://y4er.com/\nhttps://evilpan.com/\nhttp://nekopunch.cn/\nhttps://4ra1n.github.io/\nhttps://chenlvtang.top/\nhttps://www.yulegeyu.com/\nç¤¾åŒº https://xz.aliyun.com/ https://web.sqlsec.com/ Semgrep semgrep æ˜¯ä¸€æ¬¾ç”±Facebookå¼€æºçš„ç™½ç›’ä»£ç æ‰«æå·¥å…·ï¼Œé¡¹ç›®åœ°å€ï¼šhttps://github.com/returntocorp/semgrepï¼Œå…¶è§„åˆ™ç¼–å†™ç®€å•ï¼Œæ˜“ç”¨ï¼Œæ‰«æé€Ÿåº¦å¿«ã€‚ç›¸è¾ƒäºCodeQL è€Œè¨€ï¼Œå…¥é—¨é—¨æ§›è¾ƒä½ï¼Œç¼–å†™è§„åˆ™ç®€å•ï¼Œä¸”éå¸¸æ–¹ä¾¿åœ°æ¥å…¥åˆ°CIæµç¨‹ä¸­ã€‚\nå®‰è£…æ­¥éª¤ æ–¹å¼ä¸€ã€macæœºå™¨ä¸Šå¯ä½¿ç”¨ homebrew å®‰è£…ï¼š\nbrew install semgrep æ–¹å¼äºŒã€Ubuntu / Windows via WSL / Linux / macOS ä¹Ÿå¯ä»¥ä½¿ç”¨pipè¿›è¡Œå®‰è£…ï¼š\npython3 -m pip install semgrep æ–¹å¼ä¸‰ã€Dockeréƒ¨ç½²:\ndocker pull returntocorp/semgrep:latest semgrep æœ‰ Pro ç‰ˆæœ¬ä¸ç¤¾åŒºç‰ˆæœ¬ä¸¤ä¸ªç‰ˆæœ¬ï¼Œä½¿ç”¨ä¸‹é¢å‘½ä»¤å¯ä»¥ç™»é™† Pro ç‰ˆæœ¬ï¼š\nsemgrep login æ ¹æ®è¾“å‡ºè®¿é—®å¯¹åº”çš„é“¾æ¥è¿›è¡Œç™»é™†ã€‚\nç»ˆç«¯è·å¾— token ä¹‹åï¼Œå°±å¯ä»¥å®‰è£… pro å¼•æ“äº†ã€‚\nsemgrep install-semgrep-pro å®‰è£…å®Œåå¯ä»¥ä½¿ç”¨ --pro å‚æ•°è°ƒç”¨ pro å¼•æ“ã€‚\nsemgrep --pro --config \u0026#34;p/default\u0026#34; ä½¿ç”¨ git clone https://github.com/WebGoat/WebGoat semgrep -c p/sql-injection WebGoat -o WebGoat.json --json è¯´æ˜ï¼š\n-oï¼šè¾“å‡ºæ‰«æç»“æœåˆ°æ–‡ä»¶\n--jsonï¼šæŒ‡å®šè¾“å‡º json æ ¼å¼æ–‡ä»¶ã€‚å¯ä»¥è¾“å‡ºjsonæ ¼å¼/xml/sarif ç­‰æ ¼å¼\n--configï¼šé…ç½®æ‰«æè§„åˆ™æ–‡ä»¶ å®˜æ–¹ä¹Ÿæä¾›äº†ä¸€äº›è§„åˆ™æ–‡ä»¶ï¼Œåœ¨ https://semgrep.dev/r é‡Œå¯ä»¥æŸ¥çœ‹å„ç§åˆ†ç±»çš„è§„åˆ™é›†ã€‚\nè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Scan Status â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Scanning 1048 files (only git-tracked) with 103 Code rules: CODE RULES Language Rules Files Origin Rules â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ java 16 279 Pro rules 55 js 10 82 Community 48 SUPPLY CHAIN RULES ğŸ’ Run `semgrep ci` to find dependency vulnerabilities and advanced cross-file findings. PROGRESS â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 100% 0:00:03 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Scan Summary â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Some files were skipped or only partially analyzed. Scan was limited to files tracked by git. Scan skipped: 87 files matching .semgrepignore patterns For a full list of skipped files, run semgrep with the --verbose flag. Ran 26 rules on 361 files: 13 findings. âœ IdeaProjects semgrep install-semgrep-pro Semgrep Pro Engine will be installed in /opt/homebrew/Cellar/semgrep/1.52.0/libexec/lib/python3.11/site-packages/semgrep/bin/semgrep-core-proprietary Downloading... â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 159.6/159.6 MB 7.6 MB/s 0:00:00 Successfully installed Semgrep Pro Engine (version 3e84760)! æ³¨æ„éšç§ç­–ç•¥ æ ¹æ®å®˜æ–¹çš„éšç§ç­–ç•¥ Semgrep Privacy Policy - Semgrep çš„ç›¸å…³æè¿°ã€‚\n$ semgrep --config=myrule.yaml # â†’ no metrics (loading rules from local file) $ semgrep --config=p/python # â†’ metrics enabled (fetching Registry) $ semgrep login \u0026amp;\u0026amp; semgrep ci # â†’ metrics enabled (logged in to semgrep.dev) å½“ä»…ä½¿ç”¨æœ¬åœ°é…ç½®æ–‡ä»¶æˆ–å‘½ä»¤è¡Œæœç´¢æ¨¡å¼è¿è¡Œæ—¶ï¼Œå®˜æ–¹ä¸ä¼šæ”¶é›†ç›¸å…³ä¿¡æ¯ã€‚ å½“ä½¿ç”¨ Registry ä¸­çš„è§„åˆ™æ—¶ï¼Œå®˜æ–¹ä¼šæ”¶é›†æ‰€éœ€æ•°æ®ä»¥å¸®åŠ©ç»´æŠ¤äººå‘˜å®Œå–„è§„åˆ™ã€‚ å½“ä½¿ç”¨äº‘å¹³å°æ—¶ï¼Œå®˜æ–¹ä¹Ÿä¼šæ”¶é›†è¿™äº›æ•°æ®ï¼Œå¹¶ä¸”å°†ç»“æœå­˜æ”¾åœ¨äº‘å¹³å°ä¸­ã€‚ æ”¶é›†æ•°æ®çš„å…·ä½“å†…å®¹å¯è§ï¼šData collected as metrics\nç”¨æˆ·ä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®š --metrics é€‰é¡¹æ¥æ§åˆ¶æ•°æ®çš„å‘é€ã€‚\n--metrics autoï¼šï¼ˆé»˜è®¤ï¼‰æ¯å½“ä» Semgrep æ³¨å†Œè¡¨ä¸­æå–è§„åˆ™æ—¶éƒ½ä¼šå‘é€ --metrics onï¼šæ¯æ¬¡ Semgrep è¿è¡Œæ—¶éƒ½ä¼šå‘é€ --metrics offï¼šæ°¸è¿œä¸ä¼šå‘é€ å¦‚æœæœ‰éšç§è€ƒè™‘çš„è¯ï¼Œå»ºè®®ç¦»çº¿ä½¿ç”¨è§„åˆ™åº“ï¼Œå¹¶æ·»åŠ  --metrics off å‚æ•°ã€‚\nå‚è€ƒ è½»é‡çº§ä»£ç å®¡è®¡å·¥å…·: Semgrep https://github.com/chenlvtang/CodeReview-Java ä½¿ç”¨ Semgrep è§„åˆ™æ£€æµ‹å¼€æº CMS ç³»ç»Ÿçš„æ¼æ´ \u0026ndash; EOF\n","permalink":"https://blog.chensoul.cc/posts/2023/12/12/til/","summary":"Today I Learned. ä»Šå¤©æˆ‘å­¦äº†ï¼šRMIã€Javaæ¼æ´å®‰å…¨ã€Semgrepæ¼æ´æ£€æµ‹ã€‚\nRMI ä»‹ç» RMIï¼ˆRemote Method Invocationï¼‰æ˜¯Javaè¯­è¨€æä¾›çš„ä¸€ç§è¿œç¨‹è°ƒç”¨æœºåˆ¶ï¼Œç”¨äºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å®ç°å¯¹è±¡ä¹‹é—´çš„è¿œç¨‹é€šä¿¡ã€‚\né€šè¿‡Java RMIï¼Œå¼€å‘äººå‘˜å¯ä»¥åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹å¯¹è±¡çš„æ–¹æ³•ã€‚RMIéšè—äº†åº•å±‚ç½‘ç»œé€šä¿¡çš„å¤æ‚æ€§ï¼Œä½¿å¾—è¿œç¨‹æ–¹æ³•è°ƒç”¨è¿‡ç¨‹å¯¹äºå¼€å‘äººå‘˜æ¥è¯´æ›´åŠ ç®€å•å’Œé€æ˜ã€‚\nå‘å±•å†å² RMIï¼ˆRemote Method Invocationï¼‰æ˜¯Javaè¯­è¨€æä¾›çš„ä¸€ç§è¿œç¨‹è°ƒç”¨æœºåˆ¶ï¼Œå®ƒçš„å‘å±•å†å²å¯ä»¥è¿½æº¯åˆ°ä¸Šä¸ªä¸–çºª90å¹´ä»£ã€‚\nä»¥ä¸‹æ˜¯RMIçš„ä¸»è¦å‘å±•å†ç¨‹ï¼š\nåˆæœŸç‰ˆæœ¬ï¼ˆJava 1.1ï¼‰ï¼šRMIæœ€æ—©å‡ºç°åœ¨Java 1.1ç‰ˆæœ¬ä¸­ï¼Œå®ƒæä¾›äº†åŸºæœ¬çš„è¿œç¨‹è°ƒç”¨åŠŸèƒ½ï¼Œå…è®¸å¼€å‘äººå‘˜åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä½¿ç”¨Javaå¯¹è±¡è¿›è¡Œè¿œç¨‹æ–¹æ³•è°ƒç”¨ã€‚è¿™ä¸ªç‰ˆæœ¬çš„RMIè¿˜æ¯”è¾ƒç®€å•ï¼ŒåŠŸèƒ½ç›¸å¯¹æœ‰é™ã€‚ RMI-IIOPï¼ˆJava 1.2ï¼‰ï¼šéšç€Java 1.2ç‰ˆæœ¬çš„å‘å¸ƒï¼ŒSun Microsystemsï¼ˆç°åœ¨çš„Oracleï¼‰å¼•å…¥äº†RMI-IIOPï¼ˆRMI over IIOPï¼‰çš„æ¦‚å¿µï¼Œå°†RMIä¸CORBAï¼ˆCommon Object Request Broker Architectureï¼‰è¿›è¡Œäº†æ•´åˆã€‚RMI-IIOPä½¿ç”¨IIOPï¼ˆInternet Inter-ORB Protocolï¼‰ä½œä¸ºåº•å±‚çš„é€šä¿¡åè®®ï¼Œä½¿å¾—Javaå¯¹è±¡èƒ½å¤Ÿä¸å…¶ä»–ç¼–ç¨‹è¯­è¨€çš„å¯¹è±¡è¿›è¡Œäº¤äº’ã€‚ JDK 1.3å’Œ1.4çš„æ”¹è¿›ï¼šåœ¨JDK 1.3å’Œ1.4ç‰ˆæœ¬ä¸­ï¼ŒRMIå¾—åˆ°äº†è¿›ä¸€æ­¥æ”¹è¿›å’Œå¢å¼ºã€‚å…¶ä¸­åŒ…æ‹¬å¯¹Javaåºåˆ—åŒ–æœºåˆ¶çš„æ”¹è¿›ï¼Œæä¾›äº†æ›´å¥½çš„å…¼å®¹æ€§å’Œæ€§èƒ½ã€‚æ­¤å¤–ï¼Œè¿˜å¼•å…¥äº†Java Activation Frameworkï¼ˆJAFï¼‰ï¼Œç”¨äºå¤„ç†ä¼ è¾“çš„æ•°æ®ç±»å‹ã€‚ Java 5çš„å¢å¼ºï¼šJava 5å¼•å…¥äº†ä¸€äº›é‡è¦çš„å¢å¼ºåŠŸèƒ½ï¼Œå¦‚æ³¨è§£ï¼ˆAnnotationsï¼‰å’Œæ³›å‹ï¼ˆGenericsï¼‰ã€‚è¿™äº›åŠŸèƒ½ä½¿å¾—RMIçš„ä½¿ç”¨æ›´åŠ ä¾¿æ·å’Œçµæ´»ã€‚ Java 8å’Œåç»­ç‰ˆæœ¬ï¼šåœ¨Java 8åŠå…¶åç»­ç‰ˆæœ¬ä¸­ï¼ŒRMIå¹¶æ²¡æœ‰è¿›è¡Œå¤§è§„æ¨¡çš„æ”¹åŠ¨ã€‚ç„¶è€Œï¼Œéšç€Javaå¹³å°çš„ä¸æ–­å‘å±•å’Œæ”¹è¿›ï¼ŒRMIä»ç„¶æ˜¯Javaåˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¸¸ç”¨çš„è¿œç¨‹è°ƒç”¨æœºåˆ¶ä¹‹ä¸€ã€‚ æ¶æ„ RMIæ¶æ„åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š\nè¿œç¨‹æ¥å£ï¼ˆRemote Interfaceï¼‰ï¼šè¿œç¨‹æ¥å£å®šä¹‰äº†è¿œç¨‹å¯¹è±¡çš„æ–¹æ³•åˆ—è¡¨ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è¯¥æ¥å£è°ƒç”¨è¿œç¨‹å¯¹è±¡çš„æ–¹æ³•ã€‚è¿œç¨‹æ¥å£å¿…é¡»ç»§æ‰¿java.rmi.Remoteæ¥å£ï¼Œå¹¶å£°æ˜å¯ä»¥è¢«è¿œç¨‹è°ƒç”¨çš„æ–¹æ³•ã€‚ è¿œç¨‹å¯¹è±¡ï¼ˆRemote Objectï¼‰ï¼šè¿œç¨‹å¯¹è±¡æ˜¯å®ç°äº†è¿œç¨‹æ¥å£çš„Javaå¯¹è±¡ã€‚è¿™äº›å¯¹è±¡çš„æ–¹æ³•å¯ä»¥é€šè¿‡RMIè¿›è¡Œè¿œç¨‹è°ƒç”¨ã€‚è¿œç¨‹å¯¹è±¡å¿…é¡»ç»§æ‰¿java.rmi.server.UnicastRemoteObjectç±»ï¼Œå¹¶å®ç°å¯¹åº”çš„è¿œç¨‹æ¥å£ã€‚ è¿œç¨‹æ³¨å†Œè¡¨ï¼ˆRemote Registryï¼‰ï¼šè¿œç¨‹æ³¨å†Œè¡¨æ˜¯ä¸€ä¸ªä¸­å¤®æ³¨å†Œè¡¨ï¼Œç”¨äºå­˜å‚¨è¿œç¨‹å¯¹è±¡çš„å¼•ç”¨ã€‚å®¢æˆ·ç«¯å¯ä»¥æŸ¥è¯¢è¿œç¨‹æ³¨å†Œè¡¨ä»¥è·å–è¿œç¨‹å¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶é€šè¿‡å¼•ç”¨è°ƒç”¨è¿œç¨‹å¯¹è±¡çš„æ–¹æ³•ã€‚è¿œç¨‹æ³¨å†Œè¡¨ä½¿ç”¨RMIæ³¨å†Œè¡¨æœåŠ¡ï¼ˆrmiregistryï¼‰æ¥å®ç°ã€‚ Stubï¼ˆå­˜æ ¹ï¼‰å’ŒSkeletonï¼ˆéª¨æ¶ï¼‰ï¼šStubå’ŒSkeletonæ˜¯RMIçš„å…³é”®ç»„ä»¶ï¼Œç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚Stubæ˜¯å®¢æˆ·ç«¯çš„ä»£ç†ï¼Œå®ƒè´Ÿè´£å°†å®¢æˆ·ç«¯çš„æ–¹æ³•è°ƒç”¨è½¬å‘åˆ°è¿œç¨‹å¯¹è±¡ã€‚Skeletonæ˜¯æœåŠ¡å™¨ç«¯çš„ä»£ç†ï¼Œå®ƒè´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯çš„æ–¹æ³•è°ƒç”¨å¹¶å°†å…¶è½¬å‘ç»™å®é™…çš„è¿œç¨‹å¯¹è±¡ã€‚ RMIåè®®ï¼ˆRMI Protocolï¼‰ï¼šRMIåè®®å®šä¹‰äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡åè®®ï¼ŒåŒ…æ‹¬è¯·æ±‚ã€å“åº”ã€å‚æ•°ä¼ é€’å’Œåºåˆ—åŒ–ç­‰ç»†èŠ‚ã€‚RMIåè®®ä½¿ç”¨Javaåºåˆ—åŒ–æ¥å¯¹å¯¹è±¡è¿›è¡Œç¼–ç å’Œè§£ç ï¼Œä»¥å®ç°å¯¹è±¡åœ¨ç½‘ç»œä¸Šçš„ä¼ è¾“ã€‚ RMIæ¶æ„çš„åŸºæœ¬å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š\næœåŠ¡å™¨ç«¯å°†è¿œç¨‹å¯¹è±¡æ³¨å†Œåˆ°è¿œç¨‹æ³¨å†Œè¡¨ä¸­ã€‚ å®¢æˆ·ç«¯ä»è¿œç¨‹æ³¨å†Œè¡¨ä¸­è·å–è¿œç¨‹å¯¹è±¡çš„å¼•ç”¨ã€‚ å®¢æˆ·ç«¯é€šè¿‡å¼•ç”¨è°ƒç”¨è¿œç¨‹å¯¹è±¡çš„æ–¹æ³•ã€‚ å®¢æˆ·ç«¯çš„æ–¹æ³•è°ƒç”¨è¢«è½¬å‘åˆ°æœåŠ¡å™¨ç«¯çš„è¿œç¨‹å¯¹è±¡ã€‚ æœåŠ¡å™¨ç«¯çš„è¿œç¨‹å¯¹è±¡æ‰§è¡Œç›¸åº”çš„æ–¹æ³•ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚ å®¢æˆ·ç«¯æ¥æ”¶åˆ°æ–¹æ³•çš„è¿”å›å€¼ã€‚ åœ¨JDK 1.2ç‰ˆæœ¬ï¼ˆ1998ï¼‰ä¹‹åï¼Œéª¨æ¶skeletonä¸å†è¢«éœ€è¦, ç”±Javaçš„UnicastServerRef#dispatchæ›¿ä»£ï¼›åœ¨JDK 5 ï¼ˆå¤§å®¶å¸¸è¯´çš„1.5ï¼‰ä¹‹åï¼Œä¸å†éœ€è¦æ‰‹åŠ¨åˆ©ç”¨rmicå‘½ä»¤ç”Ÿæˆé™æ€Stubï¼Œè€Œæ˜¯ä¼šç”±Javaè‡ªåŠ¨åœ°åŠ¨æ€ç”Ÿæˆã€‚è¿™ä¸ªåŠ¨æ€ç”Ÿæˆä¹Ÿæ˜¯æˆ‘ä»¬åé¢JNDIæ³¨å…¥çš„å…³é”®ã€‚\nRMIæ¼æ´ RMIï¼ˆRemote Method Invocationï¼‰åœ¨è¿‡å»çš„ä¸€æ®µæ—¶é—´ä¸­æ›¾å‘ç°ä¸€äº›å®‰å…¨æ¼æ´ï¼Œè¿™äº›æ¼æ´å¯èƒ½ä¼šå¯¼è‡´å®‰å…¨é£é™©ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„RMIæ¼æ´ï¼š\nååºåˆ—åŒ–æ¼æ´ï¼šRMIä½¿ç”¨Javaåºåˆ—åŒ–æœºåˆ¶æ¥åœ¨ç½‘ç»œä¸Šä¼ è¾“å¯¹è±¡ã€‚ç„¶è€Œï¼Œå¦‚æœä¸æ­£ç¡®åœ°å¤„ç†ååºåˆ—åŒ–è¿‡ç¨‹ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡æ„é€ æ¶æ„åºåˆ—åŒ–æ•°æ®æ¥æ‰§è¡Œè¿œç¨‹ä»£ç ã€‚è¿™ç§æ¼æ´è¢«å¹¿æ³›ç§°ä¸º\u0026quot;Javaååºåˆ—åŒ–æ¼æ´\u0026quot;æˆ–\u0026quot;Javaååºåˆ—åŒ–æ”»å‡»\u0026quot;ï¼Œå¹¶ä¸”ä¸ä»…ä»…å½±å“RMIï¼Œè¿˜å¯èƒ½å½±å“å…¶ä»–ä½¿ç”¨Javaåºåˆ—åŒ–çš„æŠ€æœ¯ã€‚ æœªæˆæƒè®¿é—®æ¼æ´ï¼šRMIæœåŠ¡é»˜è®¤æƒ…å†µä¸‹å¯èƒ½æ²¡æœ‰è¿›è¡Œé€‚å½“çš„èº«ä»½éªŒè¯å’Œæˆæƒæ£€æŸ¥ã€‚è¿™å¯èƒ½å¯¼è‡´æ”»å‡»è€…èƒ½å¤Ÿæœªç»æˆæƒåœ°è®¿é—®è¿œç¨‹å¯¹è±¡å’Œè°ƒç”¨æ–¹æ³•ï¼Œä»è€Œé€ æˆå®‰å…¨é£é™©ã€‚ æ³¨å†Œè¡¨ç»•è¿‡æ¼æ´ï¼šRMIä½¿ç”¨æ³¨å†Œè¡¨ï¼ˆRegistryï¼‰æ¥å­˜å‚¨è¿œç¨‹å¯¹è±¡çš„å¼•ç”¨ã€‚æ”»å‡»è€…å¯èƒ½é€šè¿‡ç»•è¿‡æ³¨å†Œè¡¨æˆ–ç¯¡æ”¹æ³¨å†Œè¡¨ä¸­çš„å¼•ç”¨ï¼Œæ¥æ‰§è¡Œæ¶æ„æ“ä½œæˆ–æ›¿æ¢åŸå§‹å¯¹è±¡ã€‚ æœªåŠ å¯†çš„é€šä¿¡æ¼æ´ï¼šå¦‚æœRMIçš„é€šä¿¡è¿‡ç¨‹æ²¡æœ‰é€‚å½“åœ°åŠ å¯†å’Œä¿æŠ¤ï¼Œæ”»å‡»è€…å¯èƒ½èƒ½å¤Ÿçªƒå¬ã€ç¯¡æ”¹æˆ–é‡æ”¾ç½‘ç»œé€šä¿¡ï¼Œä»è€Œè·å–æ•æ„Ÿä¿¡æ¯æˆ–æ‰§è¡Œä¸­é—´äººæ”»å‡»ã€‚ ä¸ºäº†ç¼“è§£è¿™äº›æ¼æ´çš„é£é™©ï¼Œå»ºè®®é‡‡å–ä»¥ä¸‹å®‰å…¨æªæ–½ï¼š\nåŠæ—¶æ›´æ–°å’Œå‡çº§ä½¿ç”¨çš„Javaè¿è¡Œæ—¶ç¯å¢ƒï¼Œä»¥è·å–æœ€æ–°çš„å®‰å…¨ä¿®å¤ç¨‹åºã€‚JDK 8u121å¼•å…¥äº†å¯¹RMIæ¼æ´çš„ä¿®å¤ã€‚ åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­è°¨æ…å¤„ç†è¾“å…¥æ•°æ®ï¼Œé¿å…æ¥å—æœªå—ä¿¡ä»»çš„åºåˆ—åŒ–æ•°æ®ã€‚ å®æ–½é€‚å½“çš„èº«ä»½éªŒè¯å’Œæˆæƒæœºåˆ¶ï¼Œç¡®ä¿åªæœ‰ç»è¿‡æˆæƒçš„ç”¨æˆ·å¯ä»¥è®¿é—®å’Œè°ƒç”¨è¿œç¨‹å¯¹è±¡ã€‚ ä½¿ç”¨å®‰å…¨åè®®ï¼ˆå¦‚SSL/TLSï¼‰å¯¹RMIé€šä¿¡è¿›è¡ŒåŠ å¯†å’Œä¿æŠ¤ã€‚ é…ç½®å’Œé™åˆ¶RMIçš„ç½‘ç»œè®¿é—®ï¼Œä»…å…è®¸å—ä¿¡ä»»çš„ä¸»æœºå’Œç«¯å£è¿›è¡Œé€šä¿¡ã€‚ å¯¹RMIæ³¨å†Œè¡¨è¿›è¡Œå®‰å…¨é…ç½®ï¼Œé™åˆ¶å¯¹æ³¨å†Œè¡¨çš„è®¿é—®æƒé™ã€‚ RMIç”¨åˆ°çš„æŠ€æœ¯ Javaåºåˆ—åŒ–ï¼ˆSerializationï¼‰ï¼šRMIä½¿ç”¨Javaåºåˆ—åŒ–æ¥å®ç°å¯¹è±¡åœ¨ç½‘ç»œä¸Šçš„ä¼ è¾“ã€‚Javaåºåˆ—åŒ–æœºåˆ¶å…è®¸å°†Javaå¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµè¡¨ç¤ºï¼Œä»¥ä¾¿åœ¨ç½‘ç»œä¸Šè¿›è¡Œä¼ è¾“ã€‚RMIä½¿ç”¨Javaåºåˆ—åŒ–å°†æ–¹æ³•è°ƒç”¨å’Œå‚æ•°ç¼–ç ä¸ºå­—èŠ‚æµï¼Œå¹¶åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œä¼ è¾“ã€‚ Javaç½‘ç»œé€šä¿¡ï¼ˆNetwork Communicationï¼‰ï¼šRMIä½¿ç”¨Javaçš„ç½‘ç»œé€šä¿¡æœºåˆ¶æ¥åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œè¿œç¨‹è°ƒç”¨çš„ä¼ è¾“ã€‚RMIæ”¯æŒå¤šç§åº•å±‚ä¼ è¾“åè®®ï¼Œå¦‚JRMPï¼ˆJava Remote Method Protocolï¼‰å’ŒIIOPï¼ˆInternet Inter-ORB Protocolï¼‰ã€‚è¿™äº›åè®®è´Ÿè´£å°†ç¼–ç çš„æ–¹æ³•è°ƒç”¨å’Œå‚æ•°ä¼ è¾“åˆ°è¿œç¨‹å¯¹è±¡ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚ ä»£ç†ã€‚Stubå’ŒSkeletonæ˜¯RMIä¸­çš„ä»£ç†ç»„ä»¶ã€‚Stubæ˜¯å®¢æˆ·ç«¯çš„ä»£ç†ï¼ŒSkeletonæ˜¯æœåŠ¡å™¨ç«¯çš„ä»£ç†ã€‚Stubè´Ÿè´£å°†å®¢æˆ·ç«¯çš„æ–¹æ³•è°ƒç”¨è½¬å‘åˆ°è¿œç¨‹å¯¹è±¡ï¼Œè€ŒSkeletonæ¥æ”¶å®¢æˆ·ç«¯çš„æ–¹æ³•è°ƒç”¨å¹¶å°†å…¶è½¬å‘ç»™å®é™…çš„è¿œç¨‹å¯¹è±¡ã€‚Stubå’ŒSkeletonå¤„ç†äº†ç½‘ç»œé€šä¿¡ã€å‚æ•°ç¼–ç»„å’Œè§£ç»„ç­‰ç»†èŠ‚ï¼Œä½¿å¾—è¿œç¨‹è°ƒç”¨è¿‡ç¨‹å¯¹å¼€å‘äººå‘˜é€æ˜ã€‚ Javaæ¼æ´ æ–‡ç«  å…³äºJavaä¸­RMIçš„ä¸ªäººæ‹™è§\nJava JNDIå…¶å®ƒæ³¨å…¥ç‚¹åˆ†æ\nJava JNDIæ³¨å…¥æºç åˆ†æ\nJava RMIååºåˆ—åŒ–\u0026amp;JNDIæ³¨å…¥","title":"2023-12-12ï½œRMIã€Javaæ¼æ´å®‰å…¨ã€Semgrepæ¼æ´æ£€æµ‹"},{"content":"å¾ˆå¤šä¸šåŠ¡æœ‰ç”Ÿæˆå”¯ä¸€ ID å¹¶ä½œä¸ºæ•°æ®åº“ä¸»é”®çš„éœ€æ±‚ã€‚æ•°æ®åº“ä¼šåœ¨è¿™ä¸ªå­—æ®µä¸Šå»ºç«‹èšé›†ç´¢å¼•ï¼ˆå‚è€ƒ MySQL InnoDBï¼‰ï¼Œå³è¯¥å­—æ®µä¼šå½±å“å„æ¡æ•°æ®å†ç‰©ç†å­˜å‚¨ä¸Šçš„é¡ºåºã€‚\nIDè¿˜è¦å°½å¯èƒ½çŸ­ï¼ŒèŠ‚çœå†…å­˜ï¼Œè®©æ•°æ®åº“ç´¢å¼•æ•ˆç‡æ›´é«˜ã€‚åŸºæœ¬ä¸Š64ä½æ•´æ•°èƒ½å¤Ÿæ»¡è¶³ç»å¤§å¤šæ•°çš„åœºæ™¯ï¼Œä½†æ˜¯å¦‚æœèƒ½åšåˆ°æ¯”64ä½æ›´çŸ­é‚£å°±æ›´å¥½äº†ã€‚éœ€è¦æ ¹æ®å…·ä½“ä¸šåŠ¡è¿›è¡Œåˆ†æï¼Œé¢„ä¼°å‡ºIDçš„æœ€å¤§å€¼ï¼Œè¿™ä¸ªæœ€å¤§å€¼é€šå¸¸æ¯”64ä½æ•´æ•°çš„ä¸Šé™å°å¾ˆå¤šï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥ç”¨æ›´å°‘çš„bitè¡¨ç¤ºè¿™ä¸ªIDã€‚\næŸ¥è¯¢çš„æ—¶å€™ï¼Œå¾€å¾€æœ‰åˆ†é¡µæˆ–è€…æ’åºçš„éœ€æ±‚ï¼Œæ‰€ä»¥éœ€è¦ç»™æ¯æ¡æ•°æ®æ·»åŠ ä¸€ä¸ªæ—¶é—´å­—æ®µï¼Œå¹¶åœ¨å…¶ä¸Šå»ºç«‹æ™®é€šç´¢å¼•(Secondary Index)ã€‚ä½†æ˜¯æ™®é€šç´¢å¼•çš„è®¿é—®æ•ˆç‡æ¯”èšé›†ç´¢å¼•æ…¢ï¼Œå¦‚æœèƒ½å¤Ÿè®©IDæŒ‰ç…§æ—¶é—´ç²—ç•¥æœ‰åºï¼Œåˆ™å¯ä»¥çœå»è¿™ä¸ªæ—¶é—´å­—æ®µã€‚ä¸ºä»€ä¹ˆä¸æ˜¯æŒ‰ç…§æ—¶é—´ç²¾ç¡®æœ‰åºå‘¢ï¼Ÿå› ä¸ºæŒ‰ç…§æ—¶é—´ç²¾ç¡®æœ‰åºæ˜¯åšä¸åˆ°çš„ï¼Œé™¤éç”¨ä¸€ä¸ªå•æœºç®—æ³•ï¼Œåœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹åšåˆ°ç²¾ç¡®æœ‰åºæ€§èƒ½ä¸€èˆ¬å¾ˆå·®ã€‚\nè¿™å°±å¼•å‡ºäº† ID ç”Ÿæˆçš„ä¸‰å¤§æ ¸å¿ƒéœ€æ±‚ï¼š\nå…¨å±€å”¯ä¸€ æŒ‰ç…§æ—¶é—´ç²—ç•¥æœ‰åº å°½å¯èƒ½çŸ­ ä¸‹é¢ä»‹ç»ä¸€äº›å¸¸ç”¨çš„ç”Ÿæˆ ID çš„æ–¹æ³•ã€‚\nUUID UUID æ˜¯ä¸€ç±»ç®—æ³•çš„ç»Ÿç§°ï¼Œå…·ä½“æœ‰ä¸åŒçš„å®ç°ã€‚UUID çš„ä¼˜ç‚¹æ˜¯æ¯å°æœºå™¨å¯ä»¥ç‹¬ç«‹äº§ç”Ÿ IDï¼Œç†è®ºä¸Šä¿è¯ä¸ä¼šé‡å¤ï¼Œæ‰€ä»¥å¤©ç„¶æ˜¯åˆ†å¸ƒå¼çš„ï¼›ç¼ºç‚¹æ˜¯ç”Ÿæˆçš„ ID å¤ªé•¿ï¼Œä¸ä»…å ç”¨å†…å­˜ï¼Œè€Œä¸”ç´¢å¼•æŸ¥è¯¢æ•ˆç‡ä½ã€‚\nMongoDB çš„ ObjectId ä½¿ç”¨çš„å°±æ˜¯ UUID ç®—æ³•ã€‚ç”Ÿæˆçš„ ObjectId å  12 ä¸ªå­—èŠ‚ï¼Œç”±ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼Œ\n4 ä¸ªå­—èŠ‚è¡¨ç¤ºçš„ Unix timestamp 3 ä¸ªå­—èŠ‚è¡¨ç¤ºçš„æœºå™¨çš„ ID 2 ä¸ªå­—èŠ‚è¡¨ç¤ºçš„è¿›ç¨‹ ID 3 ä¸ªå­—èŠ‚è¡¨ç¤ºçš„è®¡æ•°å™¨ ä½¿ç”¨æ•°æ®åº“ å¯ä»¥ä½¿ç”¨æ•°æ®åº“ä¸­çš„è‡ªå¢ä¸»é”®æ¥ç”ŸæˆIDã€‚å°†IDç”Ÿæˆçš„è¿‡ç¨‹äº¤ç»™æ•°æ®åº“ç®¡ç†ï¼Œæ¯ä¸ªèŠ‚ç‚¹å‘æ•°æ®åº“æ’å…¥è®°å½•æ—¶ï¼Œæ•°æ®åº“ä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„IDã€‚é€šè¿‡ä½¿ç”¨æ•°æ®åº“çš„è‡ªåŠ¨é€’å¢åŠŸèƒ½ï¼Œå¯ä»¥ä¿è¯IDçš„å”¯ä¸€æ€§å’Œç²—ç•¥æœ‰åºæ€§ã€‚\nåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œå¯ä»¥ä½¿ç”¨å¤šå°æ•°æ®åº“ååŒå·¥ä½œç”Ÿæˆ IDã€‚å‡è®¾ç”¨ 8 å°MySQLæœåŠ¡å™¨ååŒå·¥ä½œï¼Œç¬¬ä¸€å° MySQL åˆå§‹å€¼æ˜¯ 1ï¼Œæ¯æ¬¡è‡ªå¢ 8ï¼Œç¬¬äºŒå° MySQL åˆå§‹å€¼æ˜¯ 2ï¼Œæ¯æ¬¡è‡ªå¢ 8ï¼Œä¾æ¬¡ç±»æ¨ã€‚åœ¨æ•°æ®åº“å‰é¢æ·»åŠ ä¸€ä¸ªè´Ÿè½½å‡è¡¡ï¼Œæ¯æ¥ä¸€ä¸ªè¯·æ±‚ï¼Œç”±è´Ÿè½½å‡è¡¡éšæœºåœ°å°†è¯·æ±‚å‘ç»™ 8 å° MySQL ä¸­çš„ä»»æ„ä¸€ä¸ªï¼Œç„¶åè¿”å›ä¸€ä¸ªIDã€‚\nFlickrå°±æ˜¯è¿™ä¹ˆåšçš„ï¼Œä»…ä»…ä½¿ç”¨äº†ä¸¤å° MySQL æœåŠ¡å™¨ã€‚å¯è§è¿™ä¸ªæ–¹æ³•è™½ç„¶ç®€å•æ— è„‘ï¼Œä½†æ˜¯æ€§èƒ½è¶³å¤Ÿå¥½ã€‚ä¸è¿‡è¦æ³¨æ„ï¼Œåœ¨ MySQL ä¸­ï¼Œä¸éœ€è¦æŠŠæ‰€æœ‰ ID éƒ½å­˜ä¸‹æ¥ï¼Œæ¯å°æœºå™¨åªéœ€è¦å­˜ä¸€ä¸ª MAX_ID å°±å¯ä»¥äº†ã€‚è¿™éœ€è¦ç”¨åˆ° MySQL çš„ä¸€ä¸ª REPLACE INTO ç‰¹æ€§ã€‚\nFlickr çš„å®ç°æ–¹å¼å¦‚ä¸‹ã€‚\nTickets64 è¡¨ç»“æ„å¦‚ä¸‹ï¼š\nCREATE TABLE `Tickets64` ( `id` bigint(20) unsigned NOT NULL auto_increment, `stub` char(1) NOT NULL default \u0026#39;\u0026#39;, PRIMARY KEY (`id`), UNIQUE KEY `stub` (`stub`) ) ENGINE=InnoDB SELECT * from Tickets64 è¿”å›ä¸€è¡Œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n+-------------------+------+ | id | stub | +-------------------+------+ | 72157623227190423 | a | +-------------------+------+ å½“æˆ‘éœ€è¦ä¸€ä¸ªæ–°çš„å…¨å±€å”¯ä¸€ 64 ä½ ID æ—¶ï¼Œæˆ‘å‘å‡ºä»¥ä¸‹ SQLï¼š\nREPLACE INTO Tickets64 (stub) VALUES (\u0026#39;a\u0026#39;); SELECT LAST_INSERT_ID(); å¯¹äºä¸¤å°æ•°æ®åº“æœåŠ¡å™¨ï¼Œåˆ†åˆ«è®¾ç½®è¡¨çš„è‡ªå¢å€¼ï¼ˆauto_increment_incrementï¼‰å’Œåç§»å€¼ï¼ˆauto_increment_offsetï¼‰ã€‚\nTicketServer1: auto_increment_increment = 2 auto_increment_offset = 1 TicketServer2: auto_increment_increment = 2 auto_increment_offset = 2 ä¸¾ä¾‹ï¼šä¸€ä¸ªæ•°æ®åº“æœåŠ¡å™¨è®¾ç½®ï¼šè‡ªå¢å€¼ä¸º 2ï¼Œèµ·å§‹å€¼ä¸º 1ï¼Œç”Ÿæˆçš„ ID ä¸ºå¥‡æ•°ã€‚\nSET auto_increment_increment=2; SET auto_increment_offset=1; drop table Tickets64; CREATE TABLE `Tickets64` ( `id` bigint(20) unsigned NOT NULL auto_increment, `stub` char(1) NOT NULL default \u0026#39;\u0026#39;, PRIMARY KEY (`id`), UNIQUE KEY `stub` (`stub`) ); SELECT AUTO_INCREMENT FROM information_schema.tables WHERE table_name=\u0026#34;Tickets64\u0026#34;; REPLACE INTO Tickets64 (stub) VALUES (\u0026#39;a\u0026#39;); SELECT LAST_INSERT_ID(); å¦ä¸€ä¸ªæ•°æ®åº“æœåŠ¡å™¨å¦‚ä½•è®¾ç½®ï¼Ÿï¼šè‡ªå¢å€¼ä¸º 2ï¼Œèµ·å§‹å€¼ä¸º 2ï¼Œç”Ÿæˆçš„ ID ä¸ºå¶æ•°ã€‚\nSET auto_increment_increment=2; SET auto_increment_offset=2; drop table Tickets64; CREATE TABLE `Tickets64` ( `id` bigint(20) unsigned NOT NULL auto_increment, `stub` char(1) NOT NULL default \u0026#39;\u0026#39;, PRIMARY KEY (`id`), UNIQUE KEY `stub` (`stub`) ); SELECT AUTO_INCREMENT FROM information_schema.tables WHERE table_name=\u0026#34;Tickets64\u0026#34;; REPLACE INTO Tickets64 (stub) VALUES (\u0026#39;a\u0026#39;); SELECT LAST_INSERT_ID(); è¿™ä¸ªæ–¹æ³•è·Ÿå•å°æ•°æ®åº“æ¯”ï¼Œç¼ºç‚¹æ˜¯ ID ä¸æ˜¯ä¸¥æ ¼é€’å¢çš„ï¼Œåªæ˜¯ç²—ç•¥é€’å¢çš„ã€‚ä¸è¿‡è¿™ä¸ªé—®é¢˜ä¸å¤§ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ç²—ç•¥æœ‰åºï¼Œä¸éœ€è¦ä¸¥æ ¼é€’å¢ã€‚\nSnowflakeç®—æ³• Twitter å¼€æºçš„ Snowflake ç®—æ³•ã€‚Snowflakeæ˜¯ä¸€ç§ç»å…¸çš„åˆ†å¸ƒå¼IDç”Ÿæˆç®—æ³•ï¼Œç”±Twitterå¼€å‘ã€‚å®ƒå°†64ä½çš„IDåˆ’åˆ†ä¸ºä¸åŒçš„éƒ¨åˆ†ï¼ŒåŒ…æ‹¬æ—¶é—´æˆ³ã€æ•°æ®ä¸­å¿ƒIDã€æœºå™¨IDå’Œåºåˆ—å·ã€‚é€šè¿‡åœ¨ä¸åŒçš„éƒ¨åˆ†åˆ†é…ä¸åŒçš„ä½æ•°ï¼Œå¯ä»¥åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ç”Ÿæˆå”¯ä¸€çš„IDï¼Œå¹¶ä¸”ä¿è¯äº†IDçš„æ—¶é—´ç²—ç•¥æœ‰åºæ€§ã€‚\nInstagram ç”¨äº†ç±»ä¼¼çš„æ–¹æ¡ˆï¼Œ41 ä½è¡¨ç¤ºæ—¶é—´æˆ³ï¼Œ13 ä½è¡¨ç¤º shard Idï¼ˆä¸€ä¸ªshard Idå¯¹åº”ä¸€å°PostgreSQLæœºå™¨ï¼‰ï¼Œæœ€ä½10ä½è¡¨ç¤ºè‡ªå¢ IDã€‚è¿™ä¸ªæ–¹æ¡ˆç”¨ä¸€ä¸ª PostgreSQL é›†ç¾¤ä»£æ›¿äº† Twitter Snowflake é›†ç¾¤ï¼Œä¼˜ç‚¹æ˜¯åˆ©ç”¨äº†ç°æˆçš„ PostgreSQLã€‚\nä½¿ç”¨åˆ†å¸ƒå¼é” å¯ä»¥ä½¿ç”¨åˆ†å¸ƒå¼é”æ¥ä¿è¯åœ¨ç”Ÿæˆ ID æ—¶çš„äº’æ–¥æ€§ï¼Œä»è€Œä¿è¯ ID çš„æœ‰åºæ€§ã€‚å¯ä»¥ä½¿ç”¨ä¸€äº›åˆ†å¸ƒå¼é”çš„å®ç°ï¼Œå¦‚ ZooKeeperã€Redis ç­‰ï¼Œæ¥åè°ƒå„ä¸ªèŠ‚ç‚¹çš„ ID ç”Ÿæˆè¿‡ç¨‹ã€‚æ¯ä¸ªèŠ‚ç‚¹åœ¨ç”Ÿæˆ ID ä¹‹å‰ï¼Œé¦–å…ˆè·å–åˆ†å¸ƒå¼é”ï¼Œç„¶åæŒ‰ç…§ä¸€å®šè§„åˆ™ç”Ÿæˆ IDï¼Œé‡Šæ”¾é”åï¼Œä¸‹ä¸€ä¸ªèŠ‚ç‚¹å†è·å–é”ç”ŸæˆIDã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªåŸºæœ¬çš„ä½¿ç”¨ ZooKeeper é”ç”Ÿæˆåˆ†å¸ƒå¼ ID çš„ç¤ºä¾‹ï¼š\nåˆ›å»ºZooKeeperå®¢æˆ·ç«¯è¿æ¥ï¼š CuratorFramework client = CuratorFrameworkFactory.newClient(\u0026#34;localhost:2181\u0026#34;, new ExponentialBackoffRetry(1000, 3)); client.start(); åˆ›å»ºåˆ†å¸ƒå¼é”ï¼š InterProcessMutex lock = new InterProcessMutex(client, \u0026#34;/id_lock\u0026#34;); è·å–é”å¹¶ç”ŸæˆIDï¼š int timeoutSeconds = 10; // è®¾ç½®é”è¶…æ—¶æ—¶é—´ä¸º10ç§’ try { if (lock.acquire(timeoutSeconds, TimeUnit.SECONDS)) { // æˆåŠŸè·å–é” String distributedID = generateID(); // ä½¿ç”¨ç”Ÿæˆçš„IDè¿›è¡Œä¸šåŠ¡æ“ä½œ // ... } else { // æœªèƒ½åœ¨è¶…æ—¶æ—¶é—´å†…è·å–åˆ°é”ï¼Œè¿›è¡Œç›¸åº”å¤„ç† // ... } } catch (Exception e) { // å¤„ç†å¼‚å¸¸ } finally { try { lock.release(); // é‡Šæ”¾é” } catch (Exception e) { // å¤„ç†å¼‚å¸¸ } } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨ Curator æ¡†æ¶åˆ›å»ºäº†ä¸€ä¸ª ZooKeeper å®¢æˆ·ç«¯è¿æ¥ï¼Œç„¶ååˆ›å»ºäº†ä¸€ä¸ª InterProcessMutex å¯¹è±¡ï¼Œè¯¥å¯¹è±¡è¡¨ç¤ºä¸€ä¸ªåˆ†å¸ƒå¼é”ã€‚åœ¨è·å–é”ä¹‹å‰ï¼ŒèŠ‚ç‚¹ä¼šå°è¯•è·å–å¹¶æŒæœ‰è¯¥é”ã€‚åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥æˆåŠŸè·å–åˆ°é”ï¼Œå…¶ä»–èŠ‚ç‚¹ä¼šé˜»å¡ç­‰å¾…ã€‚\nè·å–åˆ°é”åï¼Œå¯ä»¥æ‰§è¡Œç”Ÿæˆ ID çš„é€»è¾‘ï¼Œç”Ÿæˆå”¯ä¸€çš„åˆ†å¸ƒå¼ IDã€‚\nåœ¨ä¸šåŠ¡æ“ä½œå®Œæˆåï¼Œé€šè¿‡ release()æ–¹æ³•é‡Šæ”¾é”ï¼Œä½¿å…¶ä»–èŠ‚ç‚¹å¯ä»¥ç»§ç»­è·å–é”å¹¶ç”Ÿæˆ IDã€‚\né€šè¿‡ä½¿ç”¨ ZooKeeper é”ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ç”Ÿæˆçš„ ID æ˜¯äº’æ–¥çš„ï¼Œå¹¶ä¸”æŒ‰ç…§è·å–é”çš„é¡ºåºç”Ÿæˆã€‚è¿™æ ·å¯ä»¥ä¿è¯ç”Ÿæˆçš„ ID æ˜¯æœ‰åºçš„ï¼Œå¹¶ä¸”é¿å…äº†å¹¶å‘å†²çªçš„é—®é¢˜ã€‚\nRedis æœ¬èº«å¹¶æ²¡æœ‰æä¾›åŸç”Ÿçš„åˆ†å¸ƒå¼é”åŠŸèƒ½ï¼Œä½†å¯ä»¥å€ŸåŠ© Redis çš„åŸå­æ€§æ“ä½œå’Œè¿‡æœŸæ—¶é—´æ¥å®ç°ä¸€ä¸ªç®€å•çš„åˆ†å¸ƒå¼é”ï¼Œå¹¶åœ¨è·å–é”æ—¶ç”Ÿæˆåˆ†å¸ƒå¼ IDã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ Redis é”ç”Ÿæˆåˆ†å¸ƒå¼ ID çš„ç¤ºä¾‹ä»£ç ï¼š\nimport redis.clients.jedis.Jedis; public class DistributedIdGenerator { private static final String LOCK_KEY = \u0026#34;id_lock\u0026#34;; private static final int LOCK_EXPIRATION = 10; // é”çš„è¿‡æœŸæ—¶é—´ï¼Œå•ä½ä¸ºç§’ private static final String REDIS_HOST = \u0026#34;localhost\u0026#34;; private static final int REDIS_PORT = 6379; private Jedis jedis; public DistributedIdGenerator() { jedis = new Jedis(REDIS_HOST, REDIS_PORT); } public String generateDistributedId() { // è·å–åˆ†å¸ƒå¼é” boolean lockAcquired = acquireLock(LOCK_KEY, LOCK_EXPIRATION); if (lockAcquired) { try { // ç”ŸæˆIDçš„é€»è¾‘ String distributedId = generateId(); // ä½¿ç”¨ç”Ÿæˆçš„IDè¿›è¡Œä¸šåŠ¡æ“ä½œ // ... return distributedId; } finally { // é‡Šæ”¾åˆ†å¸ƒå¼é” releaseLock(LOCK_KEY); } } else { // æœªèƒ½è·å–åˆ°åˆ†å¸ƒå¼é”ï¼Œè¿›è¡Œç›¸åº”å¤„ç† // ... return null; } } private boolean acquireLock(String lockKey, int expiration) { String result = jedis.set(lockKey, \u0026#34;locked\u0026#34;, \u0026#34;NX\u0026#34;, \u0026#34;EX\u0026#34;, expiration); return \u0026#34;OK\u0026#34;.equals(result); } private void releaseLock(String lockKey) { jedis.del(lockKey); } private String generateId() { // ç”ŸæˆIDçš„é€»è¾‘ // ... return \u0026#34;your_generated_id\u0026#34;; } } åœ¨ä¸Šè¿°ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Jedis å®¢æˆ·ç«¯è¿æ¥ Redisï¼Œå¹¶å®šä¹‰äº†è·å–é”å’Œé‡Šæ”¾é”çš„æ–¹æ³• acquireLock() å’Œ releaseLock()ã€‚åœ¨ generateDistributedId() æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå°è¯•è·å–åˆ†å¸ƒå¼é”ï¼Œå¦‚æœæˆåŠŸè·å–åˆ°é”ï¼Œåˆ™æ‰§è¡Œç”Ÿæˆ ID çš„é€»è¾‘å’Œä¸šåŠ¡æ“ä½œï¼Œå¹¶åœ¨æœ€åé‡Šæ”¾é”ã€‚å¦‚æœæ— æ³•è·å–åˆ°é”ï¼Œåˆ™å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œç›¸åº”å¤„ç†ã€‚\nè¯·æ³¨æ„ï¼Œä¸Šè¿°ç¤ºä¾‹ä»£ç æ˜¯ä¸€ä¸ªç®€å•çš„å®ç°ï¼Œä»…ä¾›å‚è€ƒã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œè¿˜éœ€è¦è€ƒè™‘å¼‚å¸¸å¤„ç†ã€åˆ†å¸ƒå¼é”çš„å¯é‡å…¥æ€§ã€å¤„ç†é”è¶…æ—¶ç­‰æƒ…å†µï¼Œä»¥åŠæ ¹æ®å…·ä½“çš„éœ€æ±‚å’Œç³»ç»Ÿæ¶æ„è¿›è¡Œé€‚å½“çš„è°ƒæ•´ã€‚\nå‚è€ƒèµ„æ–™ Sharding \u0026amp; IDs at Instagram Ticket Servers: Distributed Unique Primary Keys on the Cheap Twitter Snowflake ç»†èŠåˆ†å¸ƒå¼IDç”Ÿæˆæ–¹æ³• - æ²ˆå‰‘ æœåŠ¡åŒ–æ¡†æ¶ï¼åˆ†å¸ƒå¼Unique IDçš„ç”Ÿæˆæ–¹æ³•ä¸€è§ˆ - æ±Ÿå—ç™½è¡£ ç”Ÿæˆå…¨å±€å”¯ä¸€IDçš„3ä¸ªæ€è·¯ï¼Œæ¥è‡ªä¸€ä¸ªèµ„æ·±æ¶æ„å¸ˆçš„æ€»ç»“ åˆ†å¸ƒå¼IDä¸­çš„SnowFlake ","permalink":"https://blog.chensoul.cc/posts/2023/12/05/distributed-id-generator/","summary":"å¾ˆå¤šä¸šåŠ¡æœ‰ç”Ÿæˆå”¯ä¸€ ID å¹¶ä½œä¸ºæ•°æ®åº“ä¸»é”®çš„éœ€æ±‚ã€‚æ•°æ®åº“ä¼šåœ¨è¿™ä¸ªå­—æ®µä¸Šå»ºç«‹èšé›†ç´¢å¼•ï¼ˆå‚è€ƒ MySQL InnoDBï¼‰ï¼Œå³è¯¥å­—æ®µä¼šå½±å“å„æ¡æ•°æ®å†ç‰©ç†å­˜å‚¨ä¸Šçš„é¡ºåºã€‚\nIDè¿˜è¦å°½å¯èƒ½çŸ­ï¼ŒèŠ‚çœå†…å­˜ï¼Œè®©æ•°æ®åº“ç´¢å¼•æ•ˆç‡æ›´é«˜ã€‚åŸºæœ¬ä¸Š64ä½æ•´æ•°èƒ½å¤Ÿæ»¡è¶³ç»å¤§å¤šæ•°çš„åœºæ™¯ï¼Œä½†æ˜¯å¦‚æœèƒ½åšåˆ°æ¯”64ä½æ›´çŸ­é‚£å°±æ›´å¥½äº†ã€‚éœ€è¦æ ¹æ®å…·ä½“ä¸šåŠ¡è¿›è¡Œåˆ†æï¼Œé¢„ä¼°å‡ºIDçš„æœ€å¤§å€¼ï¼Œè¿™ä¸ªæœ€å¤§å€¼é€šå¸¸æ¯”64ä½æ•´æ•°çš„ä¸Šé™å°å¾ˆå¤šï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥ç”¨æ›´å°‘çš„bitè¡¨ç¤ºè¿™ä¸ªIDã€‚\næŸ¥è¯¢çš„æ—¶å€™ï¼Œå¾€å¾€æœ‰åˆ†é¡µæˆ–è€…æ’åºçš„éœ€æ±‚ï¼Œæ‰€ä»¥éœ€è¦ç»™æ¯æ¡æ•°æ®æ·»åŠ ä¸€ä¸ªæ—¶é—´å­—æ®µï¼Œå¹¶åœ¨å…¶ä¸Šå»ºç«‹æ™®é€šç´¢å¼•(Secondary Index)ã€‚ä½†æ˜¯æ™®é€šç´¢å¼•çš„è®¿é—®æ•ˆç‡æ¯”èšé›†ç´¢å¼•æ…¢ï¼Œå¦‚æœèƒ½å¤Ÿè®©IDæŒ‰ç…§æ—¶é—´ç²—ç•¥æœ‰åºï¼Œåˆ™å¯ä»¥çœå»è¿™ä¸ªæ—¶é—´å­—æ®µã€‚ä¸ºä»€ä¹ˆä¸æ˜¯æŒ‰ç…§æ—¶é—´ç²¾ç¡®æœ‰åºå‘¢ï¼Ÿå› ä¸ºæŒ‰ç…§æ—¶é—´ç²¾ç¡®æœ‰åºæ˜¯åšä¸åˆ°çš„ï¼Œé™¤éç”¨ä¸€ä¸ªå•æœºç®—æ³•ï¼Œåœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹åšåˆ°ç²¾ç¡®æœ‰åºæ€§èƒ½ä¸€èˆ¬å¾ˆå·®ã€‚\nè¿™å°±å¼•å‡ºäº† ID ç”Ÿæˆçš„ä¸‰å¤§æ ¸å¿ƒéœ€æ±‚ï¼š\nå…¨å±€å”¯ä¸€ æŒ‰ç…§æ—¶é—´ç²—ç•¥æœ‰åº å°½å¯èƒ½çŸ­ ä¸‹é¢ä»‹ç»ä¸€äº›å¸¸ç”¨çš„ç”Ÿæˆ ID çš„æ–¹æ³•ã€‚\nUUID UUID æ˜¯ä¸€ç±»ç®—æ³•çš„ç»Ÿç§°ï¼Œå…·ä½“æœ‰ä¸åŒçš„å®ç°ã€‚UUID çš„ä¼˜ç‚¹æ˜¯æ¯å°æœºå™¨å¯ä»¥ç‹¬ç«‹äº§ç”Ÿ IDï¼Œç†è®ºä¸Šä¿è¯ä¸ä¼šé‡å¤ï¼Œæ‰€ä»¥å¤©ç„¶æ˜¯åˆ†å¸ƒå¼çš„ï¼›ç¼ºç‚¹æ˜¯ç”Ÿæˆçš„ ID å¤ªé•¿ï¼Œä¸ä»…å ç”¨å†…å­˜ï¼Œè€Œä¸”ç´¢å¼•æŸ¥è¯¢æ•ˆç‡ä½ã€‚\nMongoDB çš„ ObjectId ä½¿ç”¨çš„å°±æ˜¯ UUID ç®—æ³•ã€‚ç”Ÿæˆçš„ ObjectId å  12 ä¸ªå­—èŠ‚ï¼Œç”±ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼Œ\n4 ä¸ªå­—èŠ‚è¡¨ç¤ºçš„ Unix timestamp 3 ä¸ªå­—èŠ‚è¡¨ç¤ºçš„æœºå™¨çš„ ID 2 ä¸ªå­—èŠ‚è¡¨ç¤ºçš„è¿›ç¨‹ ID 3 ä¸ªå­—èŠ‚è¡¨ç¤ºçš„è®¡æ•°å™¨ ä½¿ç”¨æ•°æ®åº“ å¯ä»¥ä½¿ç”¨æ•°æ®åº“ä¸­çš„è‡ªå¢ä¸»é”®æ¥ç”ŸæˆIDã€‚å°†IDç”Ÿæˆçš„è¿‡ç¨‹äº¤ç»™æ•°æ®åº“ç®¡ç†ï¼Œæ¯ä¸ªèŠ‚ç‚¹å‘æ•°æ®åº“æ’å…¥è®°å½•æ—¶ï¼Œæ•°æ®åº“ä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„IDã€‚é€šè¿‡ä½¿ç”¨æ•°æ®åº“çš„è‡ªåŠ¨é€’å¢åŠŸèƒ½ï¼Œå¯ä»¥ä¿è¯IDçš„å”¯ä¸€æ€§å’Œç²—ç•¥æœ‰åºæ€§ã€‚\nåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œå¯ä»¥ä½¿ç”¨å¤šå°æ•°æ®åº“ååŒå·¥ä½œç”Ÿæˆ IDã€‚å‡è®¾ç”¨ 8 å°MySQLæœåŠ¡å™¨ååŒå·¥ä½œï¼Œç¬¬ä¸€å° MySQL åˆå§‹å€¼æ˜¯ 1ï¼Œæ¯æ¬¡è‡ªå¢ 8ï¼Œç¬¬äºŒå° MySQL åˆå§‹å€¼æ˜¯ 2ï¼Œæ¯æ¬¡è‡ªå¢ 8ï¼Œä¾æ¬¡ç±»æ¨ã€‚åœ¨æ•°æ®åº“å‰é¢æ·»åŠ ä¸€ä¸ªè´Ÿè½½å‡è¡¡ï¼Œæ¯æ¥ä¸€ä¸ªè¯·æ±‚ï¼Œç”±è´Ÿè½½å‡è¡¡éšæœºåœ°å°†è¯·æ±‚å‘ç»™ 8 å° MySQL ä¸­çš„ä»»æ„ä¸€ä¸ªï¼Œç„¶åè¿”å›ä¸€ä¸ªIDã€‚\nFlickrå°±æ˜¯è¿™ä¹ˆåšçš„ï¼Œä»…ä»…ä½¿ç”¨äº†ä¸¤å° MySQL æœåŠ¡å™¨ã€‚å¯è§è¿™ä¸ªæ–¹æ³•è™½ç„¶ç®€å•æ— è„‘ï¼Œä½†æ˜¯æ€§èƒ½è¶³å¤Ÿå¥½ã€‚ä¸è¿‡è¦æ³¨æ„ï¼Œåœ¨ MySQL ä¸­ï¼Œä¸éœ€è¦æŠŠæ‰€æœ‰ ID éƒ½å­˜ä¸‹æ¥ï¼Œæ¯å°æœºå™¨åªéœ€è¦å­˜ä¸€ä¸ª MAX_ID å°±å¯ä»¥äº†ã€‚è¿™éœ€è¦ç”¨åˆ° MySQL çš„ä¸€ä¸ª REPLACE INTO ç‰¹æ€§ã€‚\nFlickr çš„å®ç°æ–¹å¼å¦‚ä¸‹ã€‚\nTickets64 è¡¨ç»“æ„å¦‚ä¸‹ï¼š\nCREATE TABLE `Tickets64` ( `id` bigint(20) unsigned NOT NULL auto_increment, `stub` char(1) NOT NULL default \u0026#39;\u0026#39;, PRIMARY KEY (`id`), UNIQUE KEY `stub` (`stub`) ) ENGINE=InnoDB SELECT * from Tickets64 è¿”å›ä¸€è¡Œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š","title":"å¦‚ä½•è®¾è®¡ä¸€ä¸ªåˆ†å¸ƒå¼IDç”Ÿæˆå™¨ä¿è¯IDæŒ‰æ—¶é—´æœ‰åºï¼Ÿ"},{"content":"è¿™æ˜¯ä¸€ç¯‡åŒè¯­ç¿»è¯‘çš„æ–‡ç« ï¼ŒåŸæ–‡å‡ºè‡ª grok_system_design_interview.pdf çš„ä¸€ç¯‡æ–‡ç« ã€ŠDesigning Dropboxã€‹è®¾è®¡ Dropboxã€‚\nLetâ€™s design a file hosting service like Dropbox or Google Drive. Cloud file storage enables users to store their data on remote servers. Usually, these servers are maintained by cloud storage providers and made available to users over a network (typically through the Internet). Users pay for their cloud data storage on a monthly basis. Similar Services: OneDrive, Google Drive Difficulty Level: Medium\nè®©æˆ‘ä»¬è®¾è®¡ä¸€ä¸ªæ–‡ä»¶æ‰˜ç®¡æœåŠ¡ï¼Œä¾‹å¦‚ Dropbox æˆ– Google Driveã€‚äº‘æ–‡ä»¶å­˜å‚¨ä½¿ç”¨æˆ·èƒ½å¤Ÿå°†æ•°æ®å­˜å‚¨åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šã€‚é€šå¸¸ï¼Œè¿™äº›æœåŠ¡å™¨ç”±äº‘å­˜å‚¨æä¾›å•†ç»´æŠ¤ï¼Œå¹¶é€šè¿‡ç½‘ç»œï¼ˆé€šå¸¸é€šè¿‡äº’è”ç½‘ï¼‰æä¾›ç»™ç”¨æˆ·ã€‚ç”¨æˆ·æŒ‰æœˆæ”¯ä»˜äº‘æ•°æ®å­˜å‚¨è´¹ç”¨ã€‚ç±»ä¼¼æœåŠ¡ï¼šOneDriveã€Google Drive éš¾åº¦çº§åˆ«ï¼šä¸­\n1. Why Cloud Storage? ä¸ºä»€ä¹ˆé€‰æ‹©äº‘å­˜å‚¨ï¼Ÿ Cloud file storage services have become very popular recently as they simplify the storage and exchange of digital resources among multiple devices. The shift from using single personal computers to using multiple devices with different platforms and operating systems such as smartphones and tablets each with portable access from various geographical locations at any time, is believed to be accountable for the huge popularity of cloud storage services. Following are some of the top benefits of such services:\näº‘æ–‡ä»¶å­˜å‚¨æœåŠ¡æœ€è¿‘å˜å¾—éå¸¸æµè¡Œï¼Œå› ä¸ºå®ƒä»¬ç®€åŒ–äº†å¤šä¸ªè®¾å¤‡ä¹‹é—´æ•°å­—èµ„æºçš„å­˜å‚¨å’Œäº¤æ¢ã€‚ä»ä½¿ç”¨å•ä¸€ä¸ªäººç”µè„‘åˆ°ä½¿ç”¨å…·æœ‰ä¸åŒå¹³å°å’Œæ“ä½œç³»ç»Ÿçš„å¤šä¸ªè®¾å¤‡ï¼ˆä¾‹å¦‚æ™ºèƒ½æ‰‹æœºå’Œå¹³æ¿ç”µè„‘ï¼‰çš„è½¬å˜ï¼Œæ¯ä¸ªè®¾å¤‡éƒ½å¯ä»¥éšæ—¶ä»ä¸åŒåœ°ç†ä½ç½®è¿›è¡Œä¾¿æºå¼è®¿é—®ï¼Œè¿™è¢«è®¤ä¸ºæ˜¯äº‘å­˜å‚¨æœåŠ¡å¦‚æ­¤æ™®åŠçš„åŸå› ã€‚ä»¥ä¸‹æ˜¯æ­¤ç±»æœåŠ¡çš„ä¸€äº›ä¸»è¦å¥½å¤„ï¼š\nAvailability: The motto of cloud storage services is to have data availability anywhere, anytime. Users can access their files/photos from any device whenever and wherever they like.\nå¯ç”¨æ€§ï¼šäº‘å­˜å‚¨æœåŠ¡çš„åº§å³é“­æ˜¯éšæ—¶éšåœ°æä¾›æ•°æ®å¯ç”¨æ€§ã€‚ç”¨æˆ·å¯ä»¥éšæ—¶éšåœ°ä»ä»»ä½•è®¾å¤‡è®¿é—®ä»–ä»¬çš„æ–‡ä»¶/ç…§ç‰‡ã€‚\nReliability and Durability: Another benefit of cloud storage is that it offers 100% reliability and durability of data. Cloud storage ensures that users will never lose their data by keeping multiple copies of the data stored on different geographically located servers.\nå¯é æ€§å’ŒæŒä¹…æ€§ï¼šäº‘å­˜å‚¨çš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯å®ƒæä¾› 100% çš„æ•°æ®å¯é æ€§å’ŒæŒä¹…æ€§ã€‚äº‘å­˜å‚¨é€šè¿‡å°†æ•°æ®çš„å¤šä¸ªå‰¯æœ¬å­˜å‚¨åœ¨ä¸åŒåœ°ç†ä½ç½®çš„æœåŠ¡å™¨ä¸Šï¼Œç¡®ä¿ç”¨æˆ·æ°¸è¿œä¸ä¼šä¸¢å¤±æ•°æ®ã€‚\nScalability: Users will never have to worry about getting out of storage space. With cloud storage you have unlimited storage as long as you are ready to pay for it.\nå¯æ‰©å±•æ€§ï¼šç”¨æˆ·æ°¸è¿œä¸å¿…æ‹…å¿ƒå­˜å‚¨ç©ºé—´ä¸è¶³ã€‚ä½¿ç”¨äº‘å­˜å‚¨ï¼Œåªè¦æ‚¨å‡†å¤‡å¥½ä»˜è´¹ï¼Œæ‚¨å°±å¯ä»¥æ‹¥æœ‰æ— â€‹â€‹é™çš„å­˜å‚¨ç©ºé—´ã€‚\nIf you havenâ€™t used dropbox.com before, we would highly recommend creating an account there and uploading/editing a file and also going through the different options their service offers. This will help you a lot in understanding this chapter.\nå¦‚æœæ‚¨ä»¥å‰æ²¡æœ‰ä½¿ç”¨è¿‡ dropbox.comï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®æ‚¨åœ¨é‚£é‡Œåˆ›å»ºä¸€ä¸ªå¸æˆ·å¹¶ä¸Šä¼ /ç¼–è¾‘æ–‡ä»¶ï¼Œå¹¶æŸ¥çœ‹ä»–ä»¬çš„æœåŠ¡æä¾›çš„ä¸åŒé€‰é¡¹ã€‚è¿™å°†å¯¹ä½ ç†è§£æœ¬ç« æœ‰å¾ˆå¤§å¸®åŠ©ã€‚\n2. Requirements and Goals of the System ç³»ç»Ÿçš„è¦æ±‚å’Œç›®æ ‡ You should always clarify requirements at the beginning of the interview. Be sure to ask questions to find the exact scope of the system that the interviewer has in mind.\næ‚¨åº”è¯¥å§‹ç»ˆåœ¨é¢è¯•å¼€å§‹æ—¶æ¾„æ¸…è¦æ±‚ã€‚ä¸€å®šè¦é€šè¿‡æé—®æ¥æ‰¾åˆ°é¢è¯•å®˜å¿ƒç›®ä¸­ç³»ç»Ÿçš„ç¡®åˆ‡èŒƒå›´ã€‚\nWhat do we wish to achieve from a Cloud Storage system? Here are the top-level requirements for our system:\næˆ‘ä»¬å¸Œæœ›é€šè¿‡äº‘å­˜å‚¨ç³»ç»Ÿå®ç°ä»€ä¹ˆç›®æ ‡ï¼Ÿä»¥ä¸‹æ˜¯æˆ‘ä»¬ç³»ç»Ÿçš„é¡¶çº§è¦æ±‚ï¼š\nUsers should be able to upload and download their files/photos from any device.\nç”¨æˆ·åº”è¯¥èƒ½å¤Ÿä»ä»»ä½•è®¾å¤‡ä¸Šä¼ å’Œä¸‹è½½æ–‡ä»¶/ç…§ç‰‡ã€‚\nUsers should be able to share files or folders with other users.\nç”¨æˆ·åº”è¯¥èƒ½å¤Ÿä¸å…¶ä»–ç”¨æˆ·å…±äº«æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ã€‚\nOur service should support automatic synchronization between devices, i.e., after updating a file on one device, it should get synchronized on all devices.\næˆ‘ä»¬çš„æœåŠ¡åº”è¯¥æ”¯æŒè®¾å¤‡ä¹‹é—´çš„è‡ªåŠ¨åŒæ­¥ï¼Œå³æ›´æ–°æ–‡ä»¶ååœ¨ä¸€å°è®¾å¤‡ä¸Šï¼Œå®ƒåº”è¯¥åœ¨æ‰€æœ‰è®¾å¤‡ä¸ŠåŒæ­¥ã€‚\nThe system should support storing large files up to a GB.\nç³»ç»Ÿåº”æ”¯æŒå­˜å‚¨é«˜è¾¾ 1 GB çš„å¤§æ–‡ä»¶ã€‚\nACID-ity is required. Atomicity, Consistency, Isolation and Durability of all file operations should be guaranteed. éœ€è¦ACIDã€‚æ‰€æœ‰æ–‡ä»¶æ“ä½œçš„åŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§å’ŒæŒä¹…æ€§åº”è¯¥å¾—åˆ°ä¿è¯ã€‚\nOur system should support offline editing. Users should be able to add/delete/modify files while offline, and as soon as they come online, all their changes should be synced to the remote servers and other online devices.\næˆ‘ä»¬çš„ç³»ç»Ÿåº”è¯¥æ”¯æŒç¦»çº¿ç¼–è¾‘ã€‚ç”¨æˆ·åº”è¯¥èƒ½å¤Ÿæ·»åŠ /åˆ é™¤/ä¿®æ”¹æ–‡ä»¶ç¦»çº¿ï¼Œä¸€æ—¦ä¸Šçº¿ï¼Œæ‰€æœ‰æ›´æ”¹éƒ½åº”åŒæ­¥åˆ°è¿œç¨‹æœåŠ¡å™¨å’Œå…¶ä»–åœ¨çº¿è®¾å¤‡ã€‚\nExtended Requirements\næ‰©å±•è¦æ±‚\nThe system should support snapshotting of the data, so that users can go back to any version of the files. ç³»ç»Ÿåº”æ”¯æŒæ•°æ®å¿«ç…§ï¼Œä»¥ä¾¿ç”¨æˆ·å¯ä»¥è¿”å›åˆ°æ–‡ä»¶çš„ä»»ä½•ç‰ˆæœ¬ã€‚\n3. Some Design Considerations ä¸€äº›è®¾è®¡è€ƒè™‘ We should expect huge read and write volumes.\næˆ‘ä»¬åº”è¯¥æœŸå¾…å·¨å¤§çš„è¯»å†™é‡ã€‚\nRead to write ratio is expected to be nearly the same.\né¢„è®¡è¯»å†™æ¯”ç‡å‡ ä¹ç›¸åŒã€‚\nInternally, files can be stored in small parts or chunks (say 4MB); this can provide a lot of benefits i.e. all failed operations shall only be retried for smaller parts of a file. If a user fails to upload a file, then only the failing chunk will be retried.\nåœ¨å†…éƒ¨ï¼Œæ–‡ä»¶å¯ä»¥ä»¥å°éƒ¨åˆ†æˆ–å—çš„å½¢å¼å­˜å‚¨ï¼ˆä¾‹å¦‚ 4MBï¼‰ï¼›è¿™å¯ä»¥æä¾›å¾ˆå¤šå¥½å¤„æ˜¯ï¼Œæ‰€æœ‰å¤±è´¥çš„æ“ä½œåªèƒ½é’ˆå¯¹æ–‡ä»¶çš„è¾ƒå°éƒ¨åˆ†é‡è¯•ã€‚å¦‚æœç”¨æˆ·æœªèƒ½ä¸Šä¼ æ–‡ä»¶ï¼Œåˆ™ä»…é‡è¯•å¤±è´¥çš„å—ã€‚\nWe can reduce the amount of data exchange by transferring updated chunks only.\næˆ‘ä»¬å¯ä»¥é€šè¿‡ä»…ä¼ è¾“æ›´æ–°çš„å—æ¥å‡å°‘æ•°æ®äº¤æ¢é‡ã€‚\nBy removing duplicate chunks, we can save storage space and bandwidth usage.\né€šè¿‡åˆ é™¤é‡å¤çš„å—ï¼Œæˆ‘ä»¬å¯ä»¥èŠ‚çœå­˜å‚¨ç©ºé—´å’Œå¸¦å®½ä½¿ç”¨ã€‚\nKeeping a local copy of the metadata (file name, size, etc.) with the client can save us a lot of round trips to the server.\nä¸å®¢æˆ·ç«¯ä¿å­˜å…ƒæ•°æ®ï¼ˆæ–‡ä»¶åã€å¤§å°ç­‰ï¼‰çš„æœ¬åœ°å‰¯æœ¬å¯ä»¥ä¸ºæˆ‘ä»¬èŠ‚çœå¤§é‡æ—¶é—´åˆ°æœåŠ¡å™¨çš„å¾€è¿”ã€‚\nFor small changes, clients can intelligently upload the diffs instead of the whole chunk.\nå¯¹äºå°çš„æ›´æ”¹ï¼Œå®¢æˆ·ç«¯å¯ä»¥æ™ºèƒ½åœ°ä¸Šä¼ å·®å¼‚è€Œä¸æ˜¯æ•´ä¸ªå—ã€‚\n4. Capacity Estimation and Constraints å®¹é‡ä¼°è®¡å’Œçº¦æŸ Letâ€™s assume that we have 500M total users, and 100M daily active users (DAU).\nå‡è®¾æˆ‘ä»¬çš„æ€»ç”¨æˆ·æ•°ä¸º 5 äº¿ï¼Œæ¯æ—¥æ´»è·ƒç”¨æˆ· (DAU) ä¸º 1 äº¿ã€‚\nLetâ€™s assume that on average each user connects from three different devices.\næˆ‘ä»¬å‡è®¾å¹³å‡æ¯ä¸ªç”¨æˆ·ä»ä¸‰ä¸ªä¸åŒçš„è®¾å¤‡è¿›è¡Œè¿æ¥ã€‚\nOn average if a user has 200 files/photos, we will have 100 billion total files.\nå¹³å‡æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ªç”¨æˆ·æœ‰ 200 ä¸ªæ–‡ä»¶/ç…§ç‰‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†æ‹¥æœ‰ 1000 äº¿ä¸ªæ–‡ä»¶æ€»æ•°ã€‚\nLetâ€™s assume that average file size is 100KB, this would give us ten petabytes of total storage.\nå‡è®¾å¹³å‡æ–‡ä»¶å¤§å°ä¸º 100KBï¼Œè¿™å°†ä¸ºæˆ‘ä»¬æä¾› 10PB çš„æ€»å­˜å‚¨ç©ºé—´ã€‚\n100B * 100KB =\u0026gt; 10PB\nLetâ€™s also assume that we will have one million active connections per minute.\næˆ‘ä»¬è¿˜å‡è®¾æ¯åˆ†é’Ÿæœ‰ 100 ä¸‡ä¸ªæ´»åŠ¨è¿æ¥ã€‚\n5. High Level Design é«˜å±‚è®¾è®¡ The user will specify a folder as the workspace on their device. Any file/photo/folder placed in this folder will be uploaded to the cloud, and whenever a file is modified or deleted, it will be reflected in the same way in the cloud storage. The user can specify similar workspaces on all their devices and any modification done on one device will be propagated to all other devices to have the same view of the workspace everywhere.\nç”¨æˆ·å°†æŒ‡å®šä¸€ä¸ªæ–‡ä»¶å¤¹ä½œä¸ºå…¶è®¾å¤‡ä¸Šçš„å·¥ä½œåŒºã€‚æ”¾ç½®åœ¨æ­¤æ–‡ä»¶å¤¹ä¸­çš„ä»»ä½•æ–‡ä»¶/ç…§ç‰‡/æ–‡ä»¶å¤¹éƒ½å°†ä¸Šä¼ åˆ°äº‘ç«¯ï¼Œå¹¶ä¸”æ¯å½“ä¿®æ”¹æˆ–åˆ é™¤æ–‡ä»¶æ—¶ï¼Œéƒ½ä¼šä»¥ç›¸åŒçš„æ–¹å¼åæ˜ åœ¨äº‘å­˜å‚¨ä¸­ã€‚ç”¨æˆ·å¯ä»¥åœ¨å…¶æ‰€æœ‰è®¾å¤‡ä¸ŠæŒ‡å®šç±»ä¼¼çš„å·¥ä½œåŒºï¼Œå¹¶ä¸”åœ¨ä¸€å°è®¾å¤‡ä¸Šå®Œæˆçš„ä»»ä½•ä¿®æ”¹éƒ½å°†ä¼ æ’­åˆ°æ‰€æœ‰å…¶ä»–è®¾å¤‡ï¼Œä»¥ä¾¿åœ¨ä»»ä½•åœ°æ–¹éƒ½å…·æœ‰ç›¸åŒçš„å·¥ä½œåŒºè§†å›¾ã€‚\nAt a high level, we need to store files and their metadata information like File Name, File Size, Directory, etc., and who this file is shared with. So, we need some servers that can help the clients to upload/download files to Cloud Storage and some servers that can facilitate updating metadata about files and users. We also need some mechanism to notify all clients whenever an update happens so they can synchronize their files.\nåœ¨è¾ƒé«˜å±‚é¢ä¸Šï¼Œæˆ‘ä»¬éœ€è¦å­˜å‚¨æ–‡ä»¶åŠå…¶å…ƒæ•°æ®ä¿¡æ¯ï¼Œä¾‹å¦‚æ–‡ä»¶åã€æ–‡ä»¶å¤§å°ã€ç›®å½•ç­‰ï¼Œä»¥åŠä¸è°å…±äº«è¯¥æ–‡ä»¶ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›å¯ä»¥å¸®åŠ©å®¢æˆ·ç«¯ä¸Šä¼ /ä¸‹è½½æ–‡ä»¶åˆ°äº‘å­˜å‚¨çš„æœåŠ¡å™¨ï¼Œä»¥åŠä¸€äº›å¯ä»¥å¸®åŠ©æ›´æ–°æœ‰å…³æ–‡ä»¶å’Œç”¨æˆ·çš„å…ƒæ•°æ®çš„æœåŠ¡å™¨ã€‚æˆ‘ä»¬è¿˜éœ€è¦æŸç§æœºåˆ¶æ¥åœ¨å‘ç”Ÿæ›´æ–°æ—¶é€šçŸ¥æ‰€æœ‰å®¢æˆ·ç«¯ï¼Œä»¥ä¾¿ä»–ä»¬å¯ä»¥åŒæ­¥å…¶æ–‡ä»¶ã€‚\nAs shown in the diagram below, Block servers will work with the clients to upload/download files from cloud storage and Metadata servers will keep metadata of files updated in a SQL or NoSQL database. Synchronization servers will handle the workflow of notifying all clients about different changes for synchronization.\nå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå—æœåŠ¡å™¨å°†ä¸å®¢æˆ·ç«¯ä¸€èµ·ä»äº‘å­˜å‚¨ä¸Šä¼ /ä¸‹è½½æ–‡ä»¶ï¼Œå…ƒæ•°æ®æœåŠ¡å™¨å°†åœ¨ SQL æˆ– NoSQL æ•°æ®åº“ä¸­æ›´æ–°æ–‡ä»¶çš„å…ƒæ•°æ®ã€‚åŒæ­¥æœåŠ¡å™¨å°†å¤„ç†é€šçŸ¥æ‰€æœ‰å®¢æˆ·ç«¯æœ‰å…³åŒæ­¥çš„ä¸åŒæ›´æ”¹çš„å·¥ä½œæµç¨‹ã€‚\nHigh level design for Dropbox\nDropbox çš„é«˜çº§è®¾è®¡\n6. Component Design ç»„ä»¶è®¾è®¡ Letâ€™s go through the major components of our system one by one:\nè®©æˆ‘ä»¬ä¸€ä¸€æµè§ˆä¸€ä¸‹æˆ‘ä»¬ç³»ç»Ÿçš„ä¸»è¦ç»„ä»¶ï¼š\na. Client\na. å®¢æˆ·ç«¯\nThe Client Application monitors the workspace folder on the userâ€™s machine and syncs all files/folders in it with the remote Cloud Storage. The client application will work with the storage servers to upload, download, and modify actual files to backend Cloud Storage. The client also interacts with the remote\nå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºç›‘è§†ç”¨æˆ·è®¡ç®—æœºä¸Šçš„å·¥ä½œåŒºæ–‡ä»¶å¤¹ï¼Œå¹¶å°†å…¶ä¸­çš„æ‰€æœ‰æ–‡ä»¶/æ–‡ä»¶å¤¹ä¸è¿œç¨‹äº‘å­˜å‚¨åŒæ­¥ã€‚å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå°†ä¸å­˜å‚¨æœåŠ¡å™¨é…åˆï¼Œå°†å®é™…æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½å’Œä¿®æ”¹åˆ°åç«¯äº‘å­˜å‚¨ã€‚å®¢æˆ·ç«¯è¿˜ä¸è¿œç¨‹è¿›è¡Œäº¤äº’\nSynchronization Service to handle any file metadata updates, e.g., change in the file name, size, modification date, etc.\nåŒæ­¥æœåŠ¡å¤„ç†ä»»ä½•æ–‡ä»¶å…ƒæ•°æ®æ›´æ–°ï¼Œä¾‹å¦‚æ–‡ä»¶åã€å¤§å°ã€ä¿®æ”¹æ—¥æœŸç­‰çš„æ›´æ”¹ã€‚\nHere are some of the essential operations for the client:\nä»¥ä¸‹æ˜¯å®¢æˆ·çš„ä¸€äº›åŸºæœ¬æ“ä½œï¼š\nUpload and download files.\nä¸Šä¼ å’Œä¸‹è½½æ–‡ä»¶ã€‚\nDetect file changes in the workspace folder.\næ£€æµ‹å·¥ä½œåŒºæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶æ›´æ”¹ã€‚\nHandle conflict due to offline or concurrent updates.\nå¤„ç†ç”±äºç¦»çº¿æˆ–å¹¶å‘æ›´æ–°è€Œå¯¼è‡´çš„å†²çªã€‚\nHow do we handle file transfer efficiently? As mentioned above, we can break each file into smaller chunks so that we transfer only those chunks that are modified and not the whole file. Letâ€™s say we divide each file into fixed sizes of 4MB chunks. We can statically calculate what could be an optimal chunk size based on 1) Storage devices we use in the cloud to optimize space utilization and input/output operations per second (IOPS) 2) Network bandwidth 3) Average file size in the storage etc. In our metadata, we should also keep a record of each file and the chunks that constitute it.\næˆ‘ä»¬å¦‚ä½•æœ‰æ•ˆåœ°å¤„ç†æ–‡ä»¶ä¼ è¾“ï¼Ÿå¦‚ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¯ä¸ªæ–‡ä»¶åˆ†æˆæ›´å°çš„å—ï¼Œä»¥ä¾¿æˆ‘ä»¬åªä¼ è¾“é‚£äº›è¢«ä¿®æ”¹çš„å—ï¼Œè€Œä¸æ˜¯æ•´ä¸ªæ–‡ä»¶ã€‚å‡è®¾æˆ‘ä»¬å°†æ¯ä¸ªæ–‡ä»¶åˆ’åˆ†ä¸ºå›ºå®šå¤§å°çš„ 4MB å—ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ® 1) æˆ‘ä»¬åœ¨äº‘ä¸­ä½¿ç”¨çš„å­˜å‚¨è®¾å¤‡æ¥é™æ€è®¡ç®—æœ€ä½³å—å¤§å°ï¼Œä»¥ä¼˜åŒ–ç©ºé—´åˆ©ç”¨ç‡å’Œæ¯ç§’è¾“å…¥/è¾“å‡ºæ“ä½œ (IOPS) 2) ç½‘ç»œå¸¦å®½ 3) å­˜å‚¨ä¸­çš„å¹³å‡æ–‡ä»¶å¤§å°ç­‰ã€‚åœ¨æˆ‘ä»¬çš„å…ƒæ•°æ®ä¸­ï¼Œæˆ‘ä»¬è¿˜åº”è¯¥ä¿ç•™æ¯ä¸ªæ–‡ä»¶åŠå…¶æ„æˆå—çš„è®°å½•ã€‚\nShould we keep a copy of metadata with Client? Keeping a local copy of metadata not only enable us to do offline updates but also saves a lot of round trips to update remote metadata.\næˆ‘ä»¬åº”è¯¥ä¸å®¢æˆ·ä¿ç•™ä¸€ä»½å…ƒæ•°æ®å‰¯æœ¬å—ï¼Ÿä¿ç•™å…ƒæ•°æ®çš„æœ¬åœ°å‰¯æœ¬ä¸ä»…ä½¿æˆ‘ä»¬èƒ½å¤Ÿè¿›è¡Œç¦»çº¿æ›´æ–°ï¼Œè€Œä¸”è¿˜èŠ‚çœäº†æ›´æ–°è¿œç¨‹å…ƒæ•°æ®çš„å¤§é‡å¾€è¿”æ¬¡æ•°ã€‚\nHow can clients efficiently listen to changes happening with other clients? One solution could be that the clients periodically check with the server if there are any changes. The problem with this approach is that we will have a delay in reflecting changes locally as clients will be checking for changes periodically compared to a server notifying whenever there is some change. If the client frequently checks the server for changes, it will not only be wasting bandwidth, as the server has to return an empty response most of the time, but will also be keeping the server busy. Pulling information in this manner is not scalable.\nå®¢æˆ·å¦‚ä½•æœ‰æ•ˆåœ°å€¾å¬å…¶ä»–å®¢æˆ·å‘ç”Ÿçš„å˜åŒ–ï¼Ÿä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯å®¢æˆ·ç«¯å®šæœŸæ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æœ‰ä»»ä½•æ›´æ”¹ã€‚è¿™ç§æ–¹æ³•çš„é—®é¢˜åœ¨äºï¼Œæˆ‘ä»¬åœ¨æœ¬åœ°åæ˜ æ›´æ”¹æ—¶ä¼šå‡ºç°å»¶è¿Ÿï¼Œå› ä¸ºä¸æœåŠ¡å™¨åœ¨å‘ç”Ÿæ›´æ”¹æ—¶é€šçŸ¥æœåŠ¡å™¨ç›¸æ¯”ï¼Œå®¢æˆ·ç«¯å°†å®šæœŸæ£€æŸ¥æ›´æ”¹ã€‚å¦‚æœå®¢æˆ·ç«¯é¢‘ç¹æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æœ‰æ›´æ”¹ï¼Œåˆ™ä¸ä»…ä¼šæµªè´¹å¸¦å®½ï¼ˆå› ä¸ºæœåŠ¡å™¨å¤§å¤šæ•°æ—¶å€™å¿…é¡»è¿”å›ç©ºå“åº”ï¼‰ï¼Œè€Œä¸”è¿˜ä¼šä½¿æœåŠ¡å™¨ä¿æŒå¿™ç¢Œã€‚ä»¥è¿™ç§æ–¹å¼æ‹‰å–ä¿¡æ¯æ˜¯ä¸å¯æ‰©å±•çš„ã€‚\nA solution to the above problem could be to use HTTP long polling. With long polling the client requests information from the server with the expectation that the server may not respond immediately. If the server has no new data for the client when the poll is received, instead of sending an empty response, the server holds the request open and waits for response information to become available. Once it does have new information, the server immediately sends an HTTP/S response to the client, completing the open HTTP/S Request. Upon receipt of the server response, the client can immediately issue another server request for future updates.\nè§£å†³ä¸Šè¿°é—®é¢˜çš„æ–¹æ³•å¯èƒ½æ˜¯ä½¿ç”¨ HTTP é•¿è½®è¯¢ã€‚é€šè¿‡é•¿è½®è¯¢ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨è¯·æ±‚ä¿¡æ¯ï¼Œå¹¶æœŸæœ›æœåŠ¡å™¨å¯èƒ½ä¸ä¼šç«‹å³å“åº”ã€‚å¦‚æœæœåŠ¡å™¨åœ¨æ”¶åˆ°è½®è¯¢æ—¶æ²¡æœ‰ä¸ºå®¢æˆ·ç«¯æä¾›æ–°æ•°æ®ï¼Œåˆ™æœåŠ¡å™¨ä¸ä¼šå‘é€ç©ºå“åº”ï¼Œè€Œæ˜¯ä¿æŒè¯·æ±‚æ‰“å¼€å¹¶ç­‰å¾…å“åº”ä¿¡æ¯å¯ç”¨ã€‚ä¸€æ—¦æœ‰æ–°ä¿¡æ¯ï¼ŒæœåŠ¡å™¨ç«‹å³å‘å®¢æˆ·ç«¯å‘é€ HTTP/S å“åº”ï¼Œå®Œæˆæ‰“å¼€çš„ HTTP/S è¯·æ±‚ã€‚æ”¶åˆ°æœåŠ¡å™¨å“åº”åï¼Œå®¢æˆ·ç«¯å¯ä»¥ç«‹å³å‘å‡ºå¦ä¸€ä¸ªæœåŠ¡å™¨è¯·æ±‚ä»¥è¿›è¡Œå°†æ¥çš„æ›´æ–°ã€‚\nBased on the above considerations, we can divide our client into following four parts:\nåŸºäºä»¥ä¸Šè€ƒè™‘ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®¢æˆ·åˆ†ä¸ºä»¥ä¸‹å››ä¸ªéƒ¨åˆ†ï¼š\nI. Internal Metadata Database will keep track of all the files, chunks, their versions, and their location in the file system.\nå†…éƒ¨å…ƒæ•°æ®æ•°æ®åº“å°†è·Ÿè¸ªæ‰€æœ‰æ–‡ä»¶ã€å—ã€å®ƒä»¬çš„ç‰ˆæœ¬ä»¥åŠå®ƒä»¬åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä½ç½®ã€‚ II. Chunker will split the files into smaller pieces called chunks. It will also be responsible for reconstructing a file from its chunks. Our chunking algorithm will detect the parts of the files that have been modified by the user and only transfer those parts to the Cloud Storage; this will save us bandwidth and synchronization time.\nChunker ä¼šå°†æ–‡ä»¶åˆ†å‰²æˆæ›´å°çš„å—ï¼Œç§°ä¸ºå—ã€‚å®ƒè¿˜å°†è´Ÿè´£ä»æ–‡ä»¶å—ä¸­é‡å»ºæ–‡ä»¶ã€‚æˆ‘ä»¬çš„åˆ†å—ç®—æ³•å°†æ£€æµ‹æ–‡ä»¶ä¸­å·²è¢«ç”¨æˆ·ä¿®æ”¹çš„éƒ¨åˆ†ï¼Œå¹¶ä»…å°†è¿™äº›éƒ¨åˆ†ä¼ è¾“åˆ°äº‘å­˜å‚¨ï¼›è¿™å°†ä¸ºæˆ‘ä»¬èŠ‚çœå¸¦å®½å’ŒåŒæ­¥æ—¶é—´ã€‚ III. Watcher will monitor the local workspace folders and notify the Indexer (discussed below) of any action performed by the users, e.g. when users create, delete, or update files or folders. Watcher also listens to any changes happening on other clients that are broadcasted by Synchronization service.\nè§‚å¯Ÿè€…å°†ç›‘è§†æœ¬åœ°å·¥ä½œåŒºæ–‡ä»¶å¤¹å¹¶é€šçŸ¥ç´¢å¼•å™¨ï¼ˆå¦‚ä¸‹æ‰€è¿°ï¼‰ç”¨æˆ·æ‰§è¡Œçš„ä»»ä½•æ“ä½œï¼Œä¾‹å¦‚å½“ç”¨æˆ·åˆ›å»ºã€åˆ é™¤æˆ–æ›´æ–°æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹æ—¶ã€‚è§‚å¯Ÿè€…è¿˜ä¾¦å¬åŒæ­¥æœåŠ¡å¹¿æ’­çš„å…¶ä»–å®¢æˆ·ç«¯ä¸Šå‘ç”Ÿçš„ä»»ä½•æ›´æ”¹ã€‚ IV. Indexer will process the events received from the Watcher and update the internal metadata database with information about the chunks of the modified files. Once the chunks are successfully submitted/downloaded to the Cloud Storage, the Indexer will communicate with the remote Synchronization Service to broadcast changes to other clients and update remote metadata database.\nç´¢å¼•å™¨å°†å¤„ç†ä»è§‚å¯Ÿå™¨æ¥æ”¶åˆ°çš„äº‹ä»¶ï¼Œå¹¶ä½¿ç”¨æœ‰å…³å·²ä¿®æ”¹æ–‡ä»¶å—çš„ä¿¡æ¯æ›´æ–°å†…éƒ¨å…ƒæ•°æ®æ•°æ®åº“ã€‚ä¸€æ—¦å—æˆåŠŸæäº¤/ä¸‹è½½åˆ°äº‘å­˜å‚¨ï¼Œç´¢å¼•å™¨å°†ä¸è¿œç¨‹åŒæ­¥æœåŠ¡é€šä¿¡ï¼Œä»¥å°†æ›´æ”¹å¹¿æ’­åˆ°å…¶ä»–å®¢æˆ·ç«¯å¹¶æ›´æ–°è¿œç¨‹å…ƒæ•°æ®æ•°æ®åº“ã€‚ How should clients handle slow servers? Clients should exponentially back-off if the server is busy/not-responding. Meaning, if a server is too slow to respond, clients should delay their retries and this delay should increase exponentially.\nå®¢æˆ·ç«¯åº”è¯¥å¦‚ä½•å¤„ç†ç¼“æ…¢çš„æœåŠ¡å™¨ï¼Ÿå¦‚æœæœåŠ¡å™¨ç¹å¿™/æ— å“åº”ï¼Œå®¢æˆ·ç«¯åº”å‘ˆæŒ‡æ•°çº§åé€€ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœæœåŠ¡å™¨å“åº”é€Ÿåº¦å¤ªæ…¢ï¼Œå®¢æˆ·ç«¯åº”è¯¥å»¶è¿Ÿé‡è¯•ï¼Œå¹¶ä¸”è¿™ç§å»¶è¿Ÿåº”è¯¥å‘ˆæŒ‡æ•°çº§å¢é•¿ã€‚\nShould mobile clients sync remote changes immediately? Unlike desktop or web clients, mobile clients usually sync on demand to save userâ€™s bandwidth and space.\nç§»åŠ¨å®¢æˆ·ç«¯æ˜¯å¦åº”è¯¥ç«‹å³åŒæ­¥è¿œç¨‹æ›´æ”¹ï¼Ÿä¸æ¡Œé¢æˆ– Web å®¢æˆ·ç«¯ä¸åŒï¼Œç§»åŠ¨å®¢æˆ·ç«¯é€šå¸¸æŒ‰éœ€åŒæ­¥ä»¥èŠ‚çœç”¨æˆ·çš„å¸¦å®½å’Œç©ºé—´ã€‚\nb. Metadata Database\nb.å…ƒæ•°æ®æ•°æ®åº“\nThe Metadata Database is responsible for maintaining the versioning and metadata information about files/chunks, users, and workspaces. The Metadata Database can be a relational database such as MySQL, or a NoSQL database service such as DynamoDB. Regardless of the type of the database, the Synchronization Service should be able to provide a consistent view of the files using a database, especially if more than one user is working with the same file simultaneously. Since NoSQL data stores do not support ACID properties in favor of scalability and performance, we need to incorporate the support for ACID properties programmatically in the logic of our Synchronization Service in case we\nå…ƒæ•°æ®æ•°æ®åº“è´Ÿè´£ç»´æŠ¤æœ‰å…³æ–‡ä»¶/å—ã€ç”¨æˆ·å’Œå·¥ä½œåŒºçš„ç‰ˆæœ¬æ§åˆ¶å’Œå…ƒæ•°æ®ä¿¡æ¯ã€‚å…ƒæ•°æ®æ•°æ®åº“å¯ä»¥æ˜¯å…³ç³»æ•°æ®åº“ï¼ˆä¾‹å¦‚ MySQLï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ NoSQL æ•°æ®åº“æœåŠ¡ï¼ˆä¾‹å¦‚ DynamoDBï¼‰ã€‚æ— è®ºæ•°æ®åº“çš„ç±»å‹å¦‚ä½•ï¼ŒåŒæ­¥æœåŠ¡éƒ½åº”è¯¥èƒ½å¤Ÿä½¿ç”¨æ•°æ®åº“æä¾›ä¸€è‡´çš„æ–‡ä»¶è§†å›¾ï¼Œç‰¹åˆ«æ˜¯å½“å¤šä¸ªç”¨æˆ·åŒæ—¶ä½¿ç”¨åŒä¸€æ–‡ä»¶æ—¶ã€‚ç”±äº NoSQL æ•°æ®å­˜å‚¨ä¸æ”¯æŒ ACID å±æ€§ä»¥æ”¯æŒå¯æ‰©å±•æ€§å’Œæ€§èƒ½ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä»¥ç¼–ç¨‹æ–¹å¼å°†å¯¹ ACID å±æ€§çš„æ”¯æŒåˆå¹¶åˆ°åŒæ­¥æœåŠ¡çš„é€»è¾‘ä¸­ï¼Œä»¥é˜²ä¸‡ä¸€\nopt for this kind of database. However, using a relational database can simplify the implementation of the Synchronization Service as they natively support ACID properties.\né€‰æ‹©è¿™ç§æ•°æ®åº“ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨å…³ç³»æ•°æ®åº“å¯ä»¥ç®€åŒ–åŒæ­¥æœåŠ¡çš„å®ç°ï¼Œå› ä¸ºå®ƒä»¬æœ¬èº«æ”¯æŒ ACID å±æ€§ã€‚\nThe metadata Database should be storing information about following objects:\nå…ƒæ•°æ®æ•°æ®åº“åº”å­˜å‚¨æœ‰å…³ä»¥ä¸‹å¯¹è±¡çš„ä¿¡æ¯ï¼š\nChunks\nå—\nFiles\næ–‡ä»¶\nUser\nç”¨æˆ·\nDevices\nè®¾å¤‡\nWorkspace (sync folders)\nå·¥ä½œåŒºï¼ˆåŒæ­¥æ–‡ä»¶å¤¹ï¼‰\nc. Synchronization Service\nc. åŒæ­¥æœåŠ¡\nThe Synchronization Service is the component that processes file updates made by a client and applies these changes to other subscribed clients. It also synchronizes clientsâ€™ local databases with the information stored in the remote Metadata DB. The Synchronization Service is the most important part of the system architecture due to its critical role in managing the metadata and synchronizing usersâ€™ files. Desktop clients communicate with the Synchronization Service to either obtain updates from the Cloud Storage or send files and updates to the Cloud Storage and, potentially, other users. If a client was offline for a period, it polls the system for new updates as soon as they come online. When the Synchronization Service receives an update request, it checks with the Metadata Database for consistency and then proceeds with the update. Subsequently, a notification is sent to all subscribed users or devices to report the file update.\nåŒæ­¥æœåŠ¡æ˜¯å¤„ç†å®¢æˆ·ç«¯è¿›è¡Œçš„æ–‡ä»¶æ›´æ–°å¹¶å°†è¿™äº›æ›´æ”¹åº”ç”¨åˆ°å…¶ä»–è®¢é˜…å®¢æˆ·ç«¯çš„ç»„ä»¶ã€‚å®ƒè¿˜å°†å®¢æˆ·ç«¯çš„æœ¬åœ°æ•°æ®åº“ä¸è¿œç¨‹å…ƒæ•°æ®æ•°æ®åº“ä¸­å­˜å‚¨çš„ä¿¡æ¯åŒæ­¥ã€‚åŒæ­¥æœåŠ¡æ˜¯ç³»ç»Ÿæ¶æ„ä¸­æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œå› ä¸ºå®ƒåœ¨ç®¡ç†å…ƒæ•°æ®å’ŒåŒæ­¥ç”¨æˆ·æ–‡ä»¶æ–¹é¢å‘æŒ¥ç€å…³é”®ä½œç”¨ã€‚æ¡Œé¢å®¢æˆ·ç«¯ä¸åŒæ­¥æœåŠ¡è¿›è¡Œé€šä¿¡ï¼Œä»¥ä»äº‘å­˜å‚¨è·å–æ›´æ–°ï¼Œæˆ–å°†æ–‡ä»¶å’Œæ›´æ–°å‘é€åˆ°äº‘å­˜å‚¨ä»¥åŠå¯èƒ½çš„å…¶ä»–ç”¨æˆ·ã€‚å¦‚æœå®¢æˆ·ç«¯ç¦»çº¿ä¸€æ®µæ—¶é—´ï¼Œå®ƒä¼šåœ¨æ–°æ›´æ–°ä¸Šçº¿åç«‹å³è½®è¯¢ç³»ç»Ÿä»¥è·å–æ–°æ›´æ–°ã€‚å½“åŒæ­¥æœåŠ¡æ”¶åˆ°æ›´æ–°è¯·æ±‚æ—¶ï¼Œå®ƒä¼šæ£€æŸ¥å…ƒæ•°æ®æ•°æ®åº“çš„ä¸€è‡´æ€§ï¼Œç„¶åç»§ç»­æ›´æ–°ã€‚éšåï¼Œå‘æ‰€æœ‰è®¢é˜…çš„ç”¨æˆ·æˆ–è®¾å¤‡å‘é€é€šçŸ¥ä»¥æŠ¥å‘Šæ–‡ä»¶æ›´æ–°ã€‚\nThe Synchronization Service should be designed in such a way that it transmits less data between clients and the Cloud Storage to achieve a better response time. To meet this design goal, the Synchronization Service can employ a differencing algorithm to reduce the amount of the data that needs to be synchronized. Instead of transmitting entire files from clients to the server or vice versa, we can just transmit the difference between two versions of a file. Therefore, only the part of the file that has been changed is transmitted. This also decreases bandwidth consumption and cloud data storage for the end user. As described above, we will be dividing our files into 4MB chunks and will be transferring modified chunks only. Server and clients can calculate a hash (e.g., SHA-256) to see whether to update the local copy of a chunk or not. On the server, if we already have a chunk with a similar hash (even from another user), we donâ€™t need to create another copy, we can use the same chunk. This is discussed in detail later under Data Deduplication.\nåŒæ­¥æœåŠ¡çš„è®¾è®¡æ–¹å¼åº”ä½¿å…¶åœ¨å®¢æˆ·ç«¯å’Œäº‘å­˜å‚¨ä¹‹é—´ä¼ è¾“æ›´å°‘çš„æ•°æ®ï¼Œä»¥å®ç°æ›´å¥½çš„å“åº”æ—¶é—´ã€‚ä¸ºäº†å®ç°è¿™ä¸€è®¾è®¡ç›®æ ‡ï¼ŒåŒæ­¥æœåŠ¡å¯ä»¥é‡‡ç”¨å·®åˆ†ç®—æ³•æ¥å‡å°‘éœ€è¦åŒæ­¥çš„æ•°æ®é‡ã€‚æˆ‘ä»¬å¯ä»¥åªä¼ è¾“æ–‡ä»¶çš„ä¸¤ä¸ªç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚ï¼Œè€Œä¸æ˜¯å°†æ•´ä¸ªæ–‡ä»¶ä»å®¢æˆ·ç«¯ä¼ è¾“åˆ°æœåŠ¡å™¨ï¼Œåä¹‹äº¦ç„¶ã€‚å› æ­¤ï¼Œä»…ä¼ è¾“æ–‡ä»¶ä¸­å·²æ›´æ”¹çš„éƒ¨åˆ†ã€‚è¿™ä¹Ÿå‡å°‘äº†æœ€ç»ˆç”¨æˆ·çš„å¸¦å®½æ¶ˆè€—å’Œäº‘æ•°æ®å­˜å‚¨ã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å°†æŠŠæ–‡ä»¶åˆ†æˆ 4MB çš„å—ï¼Œå¹¶ä¸”ä»…ä¼ è¾“ä¿®æ”¹åçš„å—ã€‚æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å¯ä»¥è®¡ç®—å“ˆå¸Œå€¼ï¼ˆä¾‹å¦‚ SHA-256ï¼‰æ¥æŸ¥çœ‹æ˜¯å¦æ›´æ–°å—çš„æœ¬åœ°å‰¯æœ¬ã€‚åœ¨æœåŠ¡å™¨ä¸Šï¼Œå¦‚æœæˆ‘ä»¬å·²ç»æœ‰ä¸€ä¸ªå…·æœ‰ç›¸ä¼¼å“ˆå¸Œå€¼çš„å—ï¼ˆç”šè‡³æ¥è‡ªå¦ä¸€ä¸ªç”¨æˆ·ï¼‰ï¼Œæˆ‘ä»¬ä¸éœ€è¦åˆ›å»ºå¦ä¸€ä¸ªå‰¯æœ¬ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç›¸åŒçš„å—ã€‚ç¨åå°†åœ¨é‡å¤æ•°æ®åˆ é™¤ä¸­è¯¦ç»†è®¨è®ºè¿™ä¸€ç‚¹ã€‚\nTo be able to provide an efficient and scalable synchronization protocol we can consider using a communication middleware between clients and the Synchronization Service. The messaging middleware should provide scalable message queuing and change notifications to support a high number of clients using pull or push strategies. This way, multiple Synchronization Service instances can receive requests from a global request Queue, and the communication middleware will be able to balance its load.\nä¸ºäº†èƒ½å¤Ÿæä¾›é«˜æ•ˆä¸”å¯æ‰©å±•çš„åŒæ­¥åè®®ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘åœ¨å®¢æˆ·ç«¯å’ŒåŒæ­¥æœåŠ¡ä¹‹é—´ä½¿ç”¨é€šä¿¡ä¸­é—´ä»¶ã€‚æ¶ˆæ¯ä¸­é—´ä»¶åº”æä¾›å¯æ‰©å±•çš„æ¶ˆæ¯é˜Ÿåˆ—å’Œæ›´æ”¹é€šçŸ¥ï¼Œä»¥æ”¯æŒä½¿ç”¨æ‹‰æˆ–æ¨ç­–ç•¥çš„å¤§é‡å®¢æˆ·ç«¯ã€‚è¿™æ ·ï¼Œå¤šä¸ªåŒæ­¥æœåŠ¡å®ä¾‹å°±å¯ä»¥ä»å…¨å±€è¯·æ±‚é˜Ÿåˆ—æ¥æ”¶è¯·æ±‚ï¼Œå¹¶ä¸”é€šä¿¡ä¸­é—´ä»¶å°†èƒ½å¤Ÿå¹³è¡¡å…¶è´Ÿè½½ã€‚\nd. Message Queuing Service\nd.æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡\nAn important part of our architecture is a messaging middleware that should be able to handle a substantial number of requests. A scalable Message Queuing Service that supports asynchronous message-based communication between clients and the Synchronization Service best fits the requirements of our application. The Message Queuing Service supports asynchronous and loosely coupled message-based communication between distributed components of the system. The Message Queuing Service should be able to efficiently store any number of messages in a highly available, reliable and scalable queue.\næˆ‘ä»¬æ¶æ„çš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†æ˜¯æ¶ˆæ¯ä¼ é€’ä¸­é—´ä»¶ï¼Œå®ƒåº”è¯¥èƒ½å¤Ÿå¤„ç†å¤§é‡è¯·æ±‚ã€‚æ”¯æŒå®¢æˆ·ç«¯å’ŒåŒæ­¥æœåŠ¡ä¹‹é—´åŸºäºå¼‚æ­¥æ¶ˆæ¯çš„é€šä¿¡çš„å¯æ‰©å±•æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡æœ€é€‚åˆæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„è¦æ±‚ã€‚æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡æ”¯æŒç³»ç»Ÿçš„åˆ†å¸ƒå¼ç»„ä»¶ä¹‹é—´çš„å¼‚æ­¥ä¸”æ¾æ•£è€¦åˆçš„åŸºäºæ¶ˆæ¯çš„é€šä¿¡ã€‚æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡åº”è¯¥èƒ½å¤Ÿåœ¨é«˜åº¦å¯ç”¨ã€å¯é å’Œå¯æ‰©å±•çš„é˜Ÿåˆ—ä¸­æœ‰æ•ˆåœ°å­˜å‚¨ä»»æ„æ•°é‡çš„æ¶ˆæ¯ã€‚\nThe Message Queuing Service will implement two types of queues in our system. The Request Queue is a global queue and all clients will share it. Clientsâ€™ requests to update the Metadata Database will be sent to the Request Queue first, from there the Synchronization Service will take it to update metadata. The Response Queues that correspond to individual subscribed clients are responsible for delivering the update messages to each client. Since a message will be deleted from the queue once received by a client, we need to create separate Response Queues for each subscribed client to share update messages.\næ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å°†åœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸­å®ç°ä¸¤ç§ç±»å‹çš„é˜Ÿåˆ—ã€‚è¯·æ±‚é˜Ÿåˆ—æ˜¯ä¸€ä¸ªå…¨å±€é˜Ÿåˆ—ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯éƒ½ä¼šå…±äº«å®ƒã€‚å®¢æˆ·ç«¯æ›´æ–°å…ƒæ•°æ®æ•°æ®åº“çš„è¯·æ±‚å°†é¦–å…ˆå‘é€åˆ°è¯·æ±‚é˜Ÿåˆ—ï¼ŒåŒæ­¥æœåŠ¡å°†ä»é‚£é‡Œæ¥æ”¶å®ƒæ¥æ›´æ–°å…ƒæ•°æ®ã€‚ä¸å„ä¸ªè®¢é˜…å®¢æˆ·ç«¯ç›¸å¯¹åº”çš„å“åº”é˜Ÿåˆ—è´Ÿè´£å°†æ›´æ–°æ¶ˆæ¯ä¼ é€’ç»™æ¯ä¸ªå®¢æˆ·ç«¯ã€‚ç”±äºæ¶ˆæ¯ä¸€æ—¦è¢«å®¢æˆ·ç«¯æ¥æ”¶åˆ°å°±ä¼šä»é˜Ÿåˆ—ä¸­åˆ é™¤ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ªè®¢é˜…çš„å®¢æˆ·ç«¯åˆ›å»ºå•ç‹¬çš„å“åº”é˜Ÿåˆ—ä»¥å…±äº«æ›´æ–°æ¶ˆæ¯ã€‚\ne. Cloud/Block Storage\ne.äº‘/å—å­˜å‚¨\nCloud/Block Storage stores chunks of files uploaded by the users. Clients directly interact with the storage to send and receive objects from it. Separation of the metadata from storage enables us to use any storage either in the cloud or in-house.\näº‘/å—å­˜å‚¨å­˜å‚¨ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶å—ã€‚å®¢æˆ·ç«¯ç›´æ¥ä¸å­˜å‚¨äº¤äº’ä»¥å‘é€å’Œæ¥æ”¶å¯¹è±¡ã€‚å°†å…ƒæ•°æ®ä¸å­˜å‚¨åˆ†ç¦»ä½¿æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨äº‘ä¸­æˆ–å†…éƒ¨çš„ä»»ä½•å­˜å‚¨ã€‚\nDetailed component design for Dropbox\nDropbox çš„è¯¦ç»†ç»„ä»¶è®¾è®¡\n7. File Processing Workflow æ–‡ä»¶å¤„ç†å·¥ä½œæµç¨‹ The sequence below shows the interaction between the components of the application in a scenario when Client A updates a file that is shared with Client B and C, so they should receive the update too. If the other clients are not online at the time of the update, the Message Queuing Service keeps the update notifications in separate response queues for them until they come online later.\nä¸‹é¢çš„åºåˆ—æ˜¾ç¤ºäº†å½“å®¢æˆ·ç«¯ A æ›´æ–°ä¸å®¢æˆ·ç«¯ B å’Œ C å…±äº«çš„æ–‡ä»¶æ—¶åº”ç”¨ç¨‹åºç»„ä»¶ä¹‹é—´çš„äº¤äº’ï¼Œå› æ­¤å®ƒä»¬ä¹Ÿåº”è¯¥æ”¶åˆ°æ›´æ–°ã€‚å¦‚æœå…¶ä»–å®¢æˆ·ç«¯åœ¨æ›´æ–°æ—¶æœªè”æœºï¼Œåˆ™æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡ä¼šå°†æ›´æ–°é€šçŸ¥ä¿ç•™åœ¨å•ç‹¬çš„å“åº”é˜Ÿåˆ—ä¸­ï¼Œç›´åˆ°å®ƒä»¬ç¨åè”æœºã€‚\nClient A uploads chunks to cloud storage.\nå®¢æˆ·ç«¯Aå°†å—ä¸Šä¼ åˆ°äº‘å­˜å‚¨ã€‚\nClient A updates metadata and commits changes.\nå®¢æˆ·ç«¯ A æ›´æ–°å…ƒæ•°æ®å¹¶æäº¤æ›´æ”¹ã€‚\nClient A gets confirmation and notifications are sent to Clients B and C about the changes. 4. Client B and C receive metadata changes and download updated chunks.\nå®¢æˆ· A è·å¾—ç¡®è®¤ï¼Œå¹¶å‘å®¢æˆ· B å’Œ C å‘é€æœ‰å…³æ›´æ”¹çš„é€šçŸ¥ã€‚ 4. å®¢æˆ·ç«¯ B å’Œ C æ¥æ”¶å…ƒæ•°æ®æ›´æ”¹å¹¶ä¸‹è½½æ›´æ–°çš„å—ã€‚\n8. Data Deduplication é‡å¤æ•°æ®åˆ é™¤ Data deduplication is a technique used for eliminating duplicate copies of data to improve storage utilization. It can also be applied to network data transfers to reduce the number of bytes that must be sent. For each new incoming chunk, we can calculate a hash of it and compare that hash with all the hashes of the existing chunks to see if we already have the same chunk present in our storage.\né‡å¤æ•°æ®åˆ é™¤æ˜¯ä¸€ç§ç”¨äºæ¶ˆé™¤æ•°æ®é‡å¤å‰¯æœ¬ä»¥æé«˜å­˜å‚¨åˆ©ç”¨ç‡çš„æŠ€æœ¯ã€‚å®ƒè¿˜å¯ä»¥åº”ç”¨äºç½‘ç»œæ•°æ®ä¼ è¾“ï¼Œä»¥å‡å°‘å¿…é¡»å‘é€çš„å­—èŠ‚æ•°ã€‚å¯¹äºæ¯ä¸ªæ–°ä¼ å…¥çš„å—ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—å®ƒçš„å“ˆå¸Œå€¼ï¼Œå¹¶å°†è¯¥å“ˆå¸Œå€¼ä¸ç°æœ‰å—çš„æ‰€æœ‰å“ˆå¸Œå€¼è¿›è¡Œæ¯”è¾ƒï¼Œä»¥æŸ¥çœ‹å­˜å‚¨ä¸­æ˜¯å¦å·²ç»å­˜åœ¨ç›¸åŒçš„å—ã€‚\nWe can implement deduplication in two ways in our system:\næˆ‘ä»¬å¯ä»¥åœ¨ç³»ç»Ÿä¸­é€šè¿‡ä¸¤ç§æ–¹å¼å®ç°é‡å¤æ•°æ®åˆ é™¤ï¼š\na. Post-process deduplication\na.åå¤„ç†é‡å¤æ•°æ®åˆ é™¤\nWith post-process deduplication, new chunks are first stored on the storage device and later some process analyzes the data looking for duplication. The benefit is that clients will not need to wait for the hash calculation or lookup to complete before storing the data, thereby ensuring that there is no degradation in storage performance. Drawbacks of this approach are 1) We will unnecessarily be storing duplicate data, though for a short time, 2) Duplicate data will be transferred consuming bandwidth.\né€šè¿‡åå¤„ç†é‡å¤æ•°æ®åˆ é™¤ï¼Œæ–°çš„å—é¦–å…ˆå­˜å‚¨åœ¨å­˜å‚¨è®¾å¤‡ä¸Šï¼Œç„¶åä¸€äº›è¿›ç¨‹åˆ†ææ•°æ®ä»¥æŸ¥æ‰¾é‡å¤é¡¹ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå®¢æˆ·ç«¯åœ¨å­˜å‚¨æ•°æ®ä¹‹å‰ä¸éœ€è¦ç­‰å¾…å“ˆå¸Œè®¡ç®—æˆ–æŸ¥æ‰¾å®Œæˆï¼Œä»è€Œç¡®ä¿å­˜å‚¨æ€§èƒ½ä¸ä¼šä¸‹é™ã€‚è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹æ˜¯ 1) æˆ‘ä»¬å°†ä¸å¿…è¦åœ°å­˜å‚¨é‡å¤æ•°æ®ï¼Œå°½ç®¡æ—¶é—´å¾ˆçŸ­ï¼Œ2) ä¼ è¾“é‡å¤æ•°æ®ä¼šæ¶ˆè€—å¸¦å®½ã€‚\nb. In-line deduplication\nb.åœ¨çº¿é‡å¤æ•°æ®åˆ é™¤\nAlternatively, deduplication hash calculations can be done in real-time as the clients are entering data on their device. If our system identifies a chunk that it has already stored, only a reference to the existing chunk will be added in the metadata, rather than a full copy of the chunk. This approach will give us optimal network and storage usage.\næˆ–è€…ï¼Œå½“å®¢æˆ·ç«¯åœ¨å…¶è®¾å¤‡ä¸Šè¾“å…¥æ•°æ®æ—¶ï¼Œå¯ä»¥å®æ—¶å®Œæˆé‡å¤æ•°æ®åˆ é™¤å“ˆå¸Œè®¡ç®—ã€‚å¦‚æœæˆ‘ä»¬çš„ç³»ç»Ÿè¯†åˆ«å‡ºå®ƒå·²ç»å­˜å‚¨çš„å—ï¼Œåˆ™åªä¼šåœ¨å…ƒæ•°æ®ä¸­æ·»åŠ å¯¹ç°æœ‰å—çš„å¼•ç”¨ï¼Œè€Œä¸æ˜¯å—çš„å®Œæ•´å‰¯æœ¬ã€‚è¿™ç§æ–¹æ³•å°†ä¸ºæˆ‘ä»¬æä¾›æœ€ä½³çš„ç½‘ç»œå’Œå­˜å‚¨åˆ©ç”¨ç‡ã€‚\n9. Metadata Partitioning å…ƒæ•°æ®åˆ†åŒº To scale out metadata DB, we need to partition it so that it can store information about millions of users and billions of files/chunks. We need to come up with a partitioning scheme that would divide and store our data in different DB servers.\nä¸ºäº†æ¨ªå‘æ‰©å±•å…ƒæ•°æ®æ•°æ®åº“ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œåˆ†åŒºï¼Œä»¥ä¾¿å®ƒå¯ä»¥å­˜å‚¨æœ‰å…³æ•°ç™¾ä¸‡ç”¨æˆ·å’Œæ•°åäº¿æ–‡ä»¶/å—çš„ä¿¡æ¯ã€‚æˆ‘ä»¬éœ€è¦æå‡ºä¸€ä¸ªåˆ†åŒºæ–¹æ¡ˆï¼Œå°†æ•°æ®åˆ’åˆ†å¹¶å­˜å‚¨åœ¨ä¸åŒçš„æ•°æ®åº“æœåŠ¡å™¨ä¸­ã€‚\n1. Vertical Partitioning: We can partition our database in such a way that we store tables related to one particular feature on one server. For example, we can store all the user related tables in one database and all files/chunks related tables in another database. Although this approach is straightforward to implement it has some issues:\nå‚ç›´åˆ†åŒºï¼šæˆ‘ä»¬å¯ä»¥å¯¹æ•°æ®åº“è¿›è¡Œåˆ†åŒºï¼Œä»¥ä¾¿åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šå­˜å‚¨ä¸æŸä¸€ç‰¹å®šåŠŸèƒ½ç›¸å…³çš„è¡¨ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰ä¸ç”¨æˆ·ç›¸å…³çš„è¡¨å­˜å‚¨åœ¨ä¸€ä¸ªæ•°æ®åº“ä¸­ï¼Œå¹¶å°†æ‰€æœ‰æ–‡ä»¶/å—ç›¸å…³çš„è¡¨å­˜å‚¨åœ¨å¦ä¸€ä¸ªæ•°æ®åº“ä¸­ã€‚å°½ç®¡è¿™ç§æ–¹æ³•å®æ–½èµ·æ¥å¾ˆç®€å•ï¼Œä½†ä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ï¼š\nWill we still have scale issues? What if we have trillions of chunks to be stored and our database cannot support storing such a huge number of records? How would we further partition such tables?\næˆ‘ä»¬è¿˜ä¼šé‡åˆ°è§„æ¨¡é—®é¢˜å—ï¼Ÿå¦‚æœæˆ‘ä»¬æœ‰æ•°ä¸‡äº¿ä¸ªå—è¦å­˜å‚¨ï¼Œè€Œæˆ‘ä»¬çš„æ•°æ®åº“æ— æ³•æ”¯æŒå­˜å‚¨å¦‚æ­¤å¤§é‡çš„è®°å½•æ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬å¦‚ä½•è¿›ä¸€æ­¥å¯¹è¿™äº›è¡¨è¿›è¡Œåˆ†åŒºï¼Ÿ\nJoining two tables in two separate databases can cause performance and consistency issues. How frequently do we have to join user and file tables?\nè¿æ¥ä¸¤ä¸ªç‹¬ç«‹æ•°æ®åº“ä¸­çš„ä¸¤ä¸ªè¡¨å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½å’Œä¸€è‡´æ€§é—®é¢˜ã€‚æˆ‘ä»¬éœ€è¦å¤šä¹…è¿æ¥ä¸€æ¬¡ç”¨æˆ·è¡¨å’Œæ–‡ä»¶è¡¨ï¼Ÿ\n2. Range Based Partitioning: What if we store files/chunks in separate partitions based on the first letter of the File Path? In that case, we save all the files starting with the letter â€˜Aâ€™ in one partition and those that start with the letter â€˜Bâ€™ into another partition and so on. This approach is called range based partitioning. We can even combine certain less frequently occurring letters into one database partition. We should come up with this partitioning scheme statically so that we can always store/find a file in a predictable manner.\nåŸºäºèŒƒå›´çš„åˆ†åŒºï¼šå¦‚æœæˆ‘ä»¬æ ¹æ®æ–‡ä»¶è·¯å¾„çš„ç¬¬ä¸€ä¸ªå­—æ¯å°†æ–‡ä»¶/å—å­˜å‚¨åœ¨å•ç‹¬çš„åˆ†åŒºä¸­ä¼šæ€æ ·ï¼Ÿåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†ä»¥å­—æ¯â€œAâ€å¼€å¤´çš„æ‰€æœ‰æ–‡ä»¶ä¿å­˜åœ¨ä¸€ä¸ªåˆ†åŒºä¸­ï¼Œå°†æ‰€æœ‰ä»¥å­—æ¯â€œBâ€å¼€å¤´çš„æ–‡ä»¶ä¿å­˜åˆ°å¦ä¸€ä¸ªåˆ†åŒºä¸­ï¼Œä¾æ­¤ç±»æ¨ã€‚è¿™ç§æ–¹æ³•ç§°ä¸ºåŸºäºèŒƒå›´çš„åˆ†åŒºã€‚æˆ‘ä»¬ç”šè‡³å¯ä»¥å°†æŸäº›ä¸å¸¸å‡ºç°çš„å­—æ¯åˆå¹¶åˆ°ä¸€ä¸ªæ•°æ®åº“åˆ†åŒºä¸­ã€‚æˆ‘ä»¬åº”è¯¥é™æ€åœ°æå‡ºè¿™ä¸ªåˆ†åŒºæ–¹æ¡ˆï¼Œä»¥ä¾¿æˆ‘ä»¬å§‹ç»ˆå¯ä»¥ä»¥å¯é¢„æµ‹çš„æ–¹å¼å­˜å‚¨/æŸ¥æ‰¾æ–‡ä»¶ã€‚\nThe main problem with this approach is that it can lead to unbalanced servers. For example, if we decide to put all files starting with the letter â€˜Eâ€™ into a DB partition, and later we realize that we have too many files that start with the letter â€˜Eâ€™, to such an extent that we cannot fit them into one DB partition.\nè¿™ç§æ–¹æ³•çš„ä¸»è¦é—®é¢˜æ˜¯å®ƒå¯èƒ½å¯¼è‡´æœåŠ¡å™¨ä¸å¹³è¡¡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬å†³å®šå°†æ‰€æœ‰ä»¥å­—æ¯â€œEâ€å¼€å¤´çš„æ–‡ä»¶æ”¾å…¥æ•°æ®åº“åˆ†åŒºï¼Œåæ¥æˆ‘ä»¬å‘ç°ä»¥å­—æ¯â€œEâ€å¼€å¤´çš„æ–‡ä»¶å¤ªå¤šäº†ï¼Œä»¥è‡³äºæˆ‘ä»¬æ— æ³•å®¹çº³å®ƒä»¬åˆ°ä¸€ä¸ªæ•°æ®åº“åˆ†åŒºã€‚\n3. Hash-Based Partitioning: In this scheme we take a hash of the object we are storing and based on this hash we figure out the DB partition to which this object should go. In our case, we can take the\n3.åŸºäºæ•£åˆ—çš„åˆ†åŒºï¼šåœ¨è¿™ä¸ªæ–¹æ¡ˆä¸­ï¼Œæˆ‘ä»¬å¯¹æˆ‘ä»¬å­˜å‚¨çš„å¯¹è±¡è¿›è¡Œæ•£åˆ—ï¼Œå¹¶æ ¹æ®è¿™ä¸ªæ•£åˆ—ï¼Œæˆ‘ä»¬è®¡ç®—å‡ºè¯¥å¯¹è±¡åº”è¯¥è¿›å…¥çš„æ•°æ®åº“åˆ†åŒºã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡å–\nhash of the â€˜FileIDâ€™ of the File object we are storing to determine the partition the file will be stored. Our hashing function will randomly distribute objects into different partitions, e.g., our hashing function can always map any ID to a number between [1â€¦256], and this number would be the partition we will store our object.\næˆ‘ä»¬è¦å­˜å‚¨çš„ File å¯¹è±¡çš„â€œFileIDâ€çš„å“ˆå¸Œå€¼ï¼Œä»¥ç¡®å®šæ–‡ä»¶å°†å­˜å‚¨çš„åˆ†åŒºã€‚æˆ‘ä»¬çš„å“ˆå¸Œå‡½æ•°ä¼šå°†å¯¹è±¡éšæœºåˆ†é…åˆ°ä¸åŒçš„åˆ†åŒºä¸­ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„å“ˆå¸Œå‡½æ•°æ€»æ˜¯å¯ä»¥å°†ä»»ä½• ID æ˜ å°„åˆ° [1â€¦256] ä¹‹é—´çš„æ•°å­—ï¼Œè€Œè¿™ä¸ªæ•°å­—å°†æ˜¯æˆ‘ä»¬å°†å­˜å‚¨å¯¹è±¡çš„åˆ†åŒºã€‚\nThis approach can still lead to overloaded partitions, which can be solved by using Consistent Hashing.\nè¿™ç§æ–¹æ³•ä»ç„¶ä¼šå¯¼è‡´åˆ†åŒºè¿‡è½½ï¼Œè¿™å¯ä»¥é€šè¿‡ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œæ¥è§£å†³ã€‚\n10. Caching ç¼“å­˜ We can have two kinds of caches in our system. To deal with hot files/chunks we can introduce a cache for Block storage. We can use an off-the-shelf solution like Memcached that can store whole chunks with its respective IDs/Hashes and Block servers before hitting Block storage can quickly check if the cache has desired chunk. Based on clientsâ€™ usage pattern we can determine how many cache servers we need. A high-end commercial server can have 144GB of memory; one such server can cache 36K chunks.\næˆ‘ä»¬çš„ç³»ç»Ÿä¸­å¯ä»¥æœ‰ä¸¤ç§ç¼“å­˜ã€‚ä¸ºäº†å¤„ç†çƒ­æ–‡ä»¶/å—ï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥å—å­˜å‚¨çš„ç¼“å­˜ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åƒ Memcached è¿™æ ·çš„ç°æˆè§£å†³æ–¹æ¡ˆï¼Œå®ƒå¯ä»¥å­˜å‚¨æ•´ä¸ªå—åŠå…¶å„è‡ªçš„ ID/å“ˆå¸Œå€¼ï¼Œå¹¶ä¸”å—æœåŠ¡å™¨åœ¨è®¿é—®å—å­˜å‚¨ä¹‹å‰å¯ä»¥å¿«é€Ÿæ£€æŸ¥ç¼“å­˜æ˜¯å¦æœ‰æ‰€éœ€çš„å—ã€‚æ ¹æ®å®¢æˆ·çš„ä½¿ç”¨æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šéœ€è¦å¤šå°‘ä¸ªç¼“å­˜æœåŠ¡å™¨ã€‚é«˜ç«¯å•†ç”¨æœåŠ¡å™¨å¯ä»¥æœ‰144GBå†…å­˜ï¼›ä¸€å°è¿™æ ·çš„æœåŠ¡å™¨å¯ä»¥ç¼“å­˜ 36K å—ã€‚\nWhich cache replacement policy would best fit our needs? When the cache is full, and we want to replace a chunk with a newer/hotter chunk, how would we choose? Least Recently Used (LRU) can be a reasonable policy for our system. Under this policy, we discard the least recently used chunk first. Load Similarly, we can have a cache for Metadata DB.\nå“ªç§ç¼“å­˜æ›¿æ¢ç­–ç•¥æœ€é€‚åˆæˆ‘ä»¬çš„éœ€æ±‚ï¼Ÿå½“ç¼“å­˜å·²æ»¡æ—¶ï¼Œæˆ‘ä»¬æƒ³ç”¨æ›´æ–°/æ›´çƒ­çš„å—æ›¿æ¢ä¸€ä¸ªå—ï¼Œæˆ‘ä»¬ä¼šå¦‚ä½•é€‰æ‹©ï¼Ÿæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLRUï¼‰å¯¹äºæˆ‘ä»¬çš„ç³»ç»Ÿæ¥è¯´æ˜¯ä¸€ä¸ªåˆç†çš„ç­–ç•¥ã€‚æ ¹æ®è¿™ä¸ªç­–ç•¥ï¼Œæˆ‘ä»¬é¦–å…ˆä¸¢å¼ƒæœ€è¿‘æœ€å°‘ä½¿ç”¨çš„å—ã€‚åŠ è½½ ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºå…ƒæ•°æ®æ•°æ®åº“æä¾›ç¼“å­˜ã€‚\n11. Load Balancer (LB) 11.è´Ÿè½½å‡è¡¡å™¨ï¼ˆLBï¼‰\nWe can add the Load balancing layer at two places in our system: 1) Between Clients and Block servers and 2) Between Clients and Metadata servers. Initially, a simple Round Robin approach can be adopted that distributes incoming requests equally among backend servers. This LB is simple to implement and does not introduce any overhead. Another benefit of this approach is if a server is dead, LB will take it out of the rotation and will stop sending any traffic to it. A problem with Round Robin LB is, it wonâ€™t take server load into consideration. If a server is overloaded or slow, the LB will not stop sending new requests to that server. To handle this, a more intelligent LB solution can be placed that periodically queries backend server about their load and adjusts traffic based on that.\næˆ‘ä»¬å¯ä»¥åœ¨ç³»ç»Ÿä¸­çš„ä¸¤ä¸ªä½ç½®æ·»åŠ è´Ÿè½½å¹³è¡¡å±‚ï¼š1ï¼‰å®¢æˆ·ç«¯å’Œå—æœåŠ¡å™¨ä¹‹é—´ä»¥åŠ2ï¼‰å®¢æˆ·ç«¯å’Œå…ƒæ•°æ®æœåŠ¡å™¨ä¹‹é—´ã€‚æœ€åˆï¼Œå¯ä»¥é‡‡ç”¨ç®€å•çš„å¾ªç¯æ–¹æ³•ï¼Œåœ¨åç«¯æœåŠ¡å™¨ä¹‹é—´å¹³å‡åˆ†é…ä¼ å…¥è¯·æ±‚ã€‚è¯¥LBå®ç°ç®€å•ï¼Œä¸ä¼šå¼•å…¥ä»»ä½•å¼€é”€ã€‚è¿™ç§æ–¹æ³•çš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œå¦‚æœæœåŠ¡å™¨æ­»æœºï¼ŒLB ä¼šå°†å…¶ä»è½®æ¢ä¸­åˆ é™¤ï¼Œå¹¶åœæ­¢å‘å…¶å‘é€ä»»ä½•æµé‡ã€‚å¾ªç¯è´Ÿè½½å‡è¡¡çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå®ƒä¸ä¼šè€ƒè™‘æœåŠ¡å™¨è´Ÿè½½ã€‚å¦‚æœæœåŠ¡å™¨è¿‡è½½æˆ–é€Ÿåº¦ç¼“æ…¢ï¼Œè´Ÿè½½å‡è¡¡å™¨ä¸ä¼šåœæ­¢å‘è¯¥æœåŠ¡å™¨å‘é€æ–°è¯·æ±‚ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥æ”¾ç½®æ›´æ™ºèƒ½çš„ LB è§£å†³æ–¹æ¡ˆï¼Œå®šæœŸæŸ¥è¯¢åç«¯æœåŠ¡å™¨çš„è´Ÿè½½å¹¶æ®æ­¤è°ƒæ•´æµé‡ã€‚\n12. Security, Permissions and File Sharing å®‰å…¨ã€æƒé™å’Œæ–‡ä»¶å…±äº« One of the primary concerns users will have while storing their files in the cloud is the privacy and security of their data, especially since in our system users can share their files with other users or even make them public to share it with everyone. To handle this, we will be storing the permissions of each file in our metadata DB to reflect what files are visible or modifiable by any user.\nç”¨æˆ·åœ¨äº‘ä¸­å­˜å‚¨æ–‡ä»¶æ—¶æœ€å…³å¿ƒçš„é—®é¢˜ä¹‹ä¸€æ˜¯æ•°æ®çš„éšç§å’Œå®‰å…¨ï¼Œç‰¹åˆ«æ˜¯å› ä¸ºåœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·å¯ä»¥ä¸å…¶ä»–ç”¨æˆ·å…±äº«ä»–ä»¬çš„æ–‡ä»¶ï¼Œç”šè‡³å°†å®ƒä»¬å…¬å¼€ä»¥ä¸æ‰€æœ‰äººå…±äº«ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°†åœ¨å…ƒæ•°æ®æ•°æ®åº“ä¸­å­˜å‚¨æ¯ä¸ªæ–‡ä»¶çš„æƒé™ï¼Œä»¥åæ˜ å“ªäº›æ–‡ä»¶å¯¹ä»»ä½•ç”¨æˆ·å¯è§æˆ–å¯ä¿®æ”¹ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/11/24/designing-dropbox/","summary":"è¿™æ˜¯ä¸€ç¯‡åŒè¯­ç¿»è¯‘çš„æ–‡ç« ï¼ŒåŸæ–‡å‡ºè‡ª grok_system_design_interview.pdf çš„ä¸€ç¯‡æ–‡ç« ã€ŠDesigning Dropboxã€‹è®¾è®¡ Dropboxã€‚\nLetâ€™s design a file hosting service like Dropbox or Google Drive. Cloud file storage enables users to store their data on remote servers. Usually, these servers are maintained by cloud storage providers and made available to users over a network (typically through the Internet). Users pay for their cloud data storage on a monthly basis. Similar Services: OneDrive, Google Drive Difficulty Level: Medium\nè®©æˆ‘ä»¬è®¾è®¡ä¸€ä¸ªæ–‡ä»¶æ‰˜ç®¡æœåŠ¡ï¼Œä¾‹å¦‚ Dropbox æˆ– Google Driveã€‚äº‘æ–‡ä»¶å­˜å‚¨ä½¿ç”¨æˆ·èƒ½å¤Ÿå°†æ•°æ®å­˜å‚¨åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šã€‚é€šå¸¸ï¼Œè¿™äº›æœåŠ¡å™¨ç”±äº‘å­˜å‚¨æä¾›å•†ç»´æŠ¤ï¼Œå¹¶é€šè¿‡ç½‘ç»œï¼ˆé€šå¸¸é€šè¿‡äº’è”ç½‘ï¼‰æä¾›ç»™ç”¨æˆ·ã€‚ç”¨æˆ·æŒ‰æœˆæ”¯ä»˜äº‘æ•°æ®å­˜å‚¨è´¹ç”¨ã€‚ç±»ä¼¼æœåŠ¡ï¼šOneDriveã€Google Drive éš¾åº¦çº§åˆ«ï¼šä¸­\n1. Why Cloud Storage? ä¸ºä»€ä¹ˆé€‰æ‹©äº‘å­˜å‚¨ï¼Ÿ Cloud file storage services have become very popular recently as they simplify the storage and exchange of digital resources among multiple devices.","title":"[è¯‘]ã€ŠGrokking the System Design Interviewã€‹è®¾è®¡Dropbox"},{"content":"è¿™æ˜¯ä¸€ç¯‡åŒè¯­ç¿»è¯‘çš„æ–‡ç« ï¼ŒåŸæ–‡å‡ºè‡ª grok_system_design_interview.pdf çš„ä¸€ç¯‡æ–‡ç« ã€ŠDesigning Facebook Messengerã€‹è®¾è®¡ Facebook Messengerã€‚\nLetâ€™s design an instant messaging service like Facebook Messenger where users can send text messages to each other through web and mobile interfaces. è®©æˆ‘ä»¬è®¾è®¡ä¸€ä¸ªåƒ Facebook Messenger è¿™æ ·çš„å³æ—¶æ¶ˆæ¯æœåŠ¡ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ç½‘ç»œå’Œç§»åŠ¨ç•Œé¢äº’ç›¸å‘é€çŸ­ä¿¡ã€‚\n1. What is Facebook Messenger? 1.ä»€ä¹ˆæ˜¯ Facebook Messengerï¼Ÿ\nFacebook Messenger is a software application which provides text-based instant messaging services to its users. Messenger users can chat with their Facebook friends both from cell-phones and Facebookâ€™s website.\nFacebook Messenger æ˜¯ä¸€æ¬¾ä¸ºå…¶ç”¨æˆ·æä¾›åŸºäºæ–‡æœ¬çš„å³æ—¶æ¶ˆæ¯æœåŠ¡çš„è½¯ä»¶åº”ç”¨ç¨‹åºã€‚ Messenger ç”¨æˆ·å¯ä»¥é€šè¿‡æ‰‹æœºå’Œ Facebook ç½‘ç«™ä¸ Facebook å¥½å‹èŠå¤©ã€‚\n2. Requirements and Goals of the System ç³»ç»Ÿçš„è¦æ±‚å’Œç›®æ ‡ Our Messenger should meet the following requirements:\næˆ‘ä»¬çš„ Messenger åº”æ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š\nFunctional Requirements:\nåŠŸèƒ½è¦æ±‚ï¼š\nMessenger should support one-on-one conversations between users.\nMessenger åº”æ”¯æŒç”¨æˆ·ä¹‹é—´çš„ä¸€å¯¹ä¸€å¯¹è¯ã€‚\nMessenger should keep track of the online/offline statuses of its users.\nMessenger åº”è·Ÿè¸ªç”¨æˆ·çš„åœ¨çº¿/ç¦»çº¿çŠ¶æ€ã€‚\nMessenger should support persistent storage of chat history.\nMessengeråº”è¯¥æ”¯æŒèŠå¤©è®°å½•çš„æŒä¹…å­˜å‚¨ã€‚\nNon-functional Requirements:\néåŠŸèƒ½æ€§è¦æ±‚ï¼š\nUsers should have real-time chat experience with minimum latency.\nç”¨æˆ·åº”è¯¥è·å¾—å»¶è¿Ÿæœ€å°çš„å®æ—¶èŠå¤©ä½“éªŒã€‚\nOur system should be highly consistent; users should be able to see the same chat history on all their devices.\næˆ‘ä»¬çš„ç³»ç»Ÿåº”è¯¥é«˜åº¦ä¸€è‡´ï¼›ç”¨æˆ·åº”è¯¥èƒ½å¤Ÿåœ¨æ‰€æœ‰å†…å®¹ä¸Šçœ‹åˆ°ç›¸åŒçš„èŠå¤©è®°å½•ä»–ä»¬çš„è®¾å¤‡ã€‚\nMessengerâ€™s high availability is desirable; we can tolerate lower availability in the interest of consistency.\nMessenger çš„é«˜å¯ç”¨æ€§æ˜¯å¯å–çš„ï¼›ä¸ºäº†ä»¥ä¸‹ç›®çš„ï¼Œæˆ‘ä»¬å¯ä»¥å®¹å¿è¾ƒä½çš„å¯ç”¨æ€§ä¸€è‡´æ€§ã€‚\nExtended Requirements:\næ‰©å±•è¦æ±‚ï¼š\nGroup Chats: Messenger should support multiple people talking to each other in a group.\nç¾¤ç»„èŠå¤©ï¼šMessenger åº”æ”¯æŒå¤šäººåœ¨ç¾¤ç»„ä¸­ç›¸äº’äº¤è°ˆã€‚\nPush notifications: Messenger should be able to notify users of new messages when they are offline.\næ¨é€é€šçŸ¥ï¼šMessenger åº”è¯¥èƒ½å¤Ÿåœ¨ç”¨æˆ·æœ‰æ–°æ¶ˆæ¯æ—¶é€šçŸ¥ä»–ä»¬ç¦»çº¿ã€‚\n3. Capacity Estimation and Constraints å®¹é‡ä¼°è®¡å’Œçº¦æŸ Letâ€™s assume that we have 500 million daily active users and on average each user sends 40 messages daily; this gives us 20 billion messages per day.\nå‡è®¾æˆ‘ä»¬æœ‰ 5 äº¿æ—¥æ´»è·ƒç”¨æˆ·ï¼Œå¹³å‡æ¯ä¸ªç”¨æˆ·æ¯å¤©å‘é€ 40 æ¡æ¶ˆæ¯ï¼›è¿™æ¯å¤©ç»™æˆ‘ä»¬å¸¦æ¥ 200 äº¿æ¡æ¶ˆæ¯ã€‚\nStorage Estimation: Letâ€™s assume that on average a message is 100 bytes, so to store all the messages for one day we would need 2TB of storage.\nå­˜å‚¨ä¼°ç®—ï¼šå‡è®¾ä¸€æ¡æ¶ˆæ¯å¹³å‡ä¸º 100 å­—èŠ‚ï¼Œå› æ­¤è¦å­˜å‚¨ä¸€å¤©çš„æ‰€æœ‰æ¶ˆæ¯ï¼Œæˆ‘ä»¬éœ€è¦ 2TB çš„å­˜å‚¨ç©ºé—´ã€‚\n20 billion messages * 100 bytes =\u0026gt; 2 TB/day\n200 äº¿æ¡æ¶ˆæ¯ * 100 å­—èŠ‚ =\u0026gt; 2 TB/å¤©\nTo store five years of chat history, we would need 3.6 petabytes of storage.\nè¦å­˜å‚¨äº”å¹´çš„èŠå¤©å†å²è®°å½•ï¼Œæˆ‘ä»¬éœ€è¦ 3.6 PB çš„å­˜å‚¨ç©ºé—´ã€‚\n2 TB * 365 days * 5 years ~= 3.6 PB\nOther than the chat messages, we would also need to store usersâ€™ information, messagesâ€™ metadata (ID, Timestamp, etc.). Not to mention, the above calculation doesnâ€™t take data compression and replication in consideration.\né™¤äº†èŠå¤©æ¶ˆæ¯ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ã€æ¶ˆæ¯å…ƒæ•°æ®ï¼ˆIDã€æ—¶é—´æˆ³ç­‰ï¼‰ã€‚æ›´ä¸ç”¨è¯´ï¼Œä¸Šè¿°è®¡ç®—æ²¡æœ‰è€ƒè™‘æ•°æ®å‹ç¼©å’Œå¤åˆ¶ã€‚\nBandwidth Estimation: If our service is getting 2TB of data every day, this will give us 25MB of incoming data for each second.\nå¸¦å®½ä¼°è®¡ï¼šå¦‚æœæˆ‘ä»¬çš„æœåŠ¡æ¯å¤©è·å– 2TB çš„æ•°æ®ï¼Œé‚£ä¹ˆæ¯ç§’å°†ä¸ºæˆ‘ä»¬æä¾› 25MB çš„ä¼ å…¥æ•°æ®ã€‚\n2 TB / 86400 sec ~= 25 MB/s\nSince each incoming message needs to go out to another user, we will need the same amount of bandwidth 25MB/s for both upload and download.\nç”±äºæ¯æ¡ä¼ å…¥æ¶ˆæ¯éƒ½éœ€è¦å‘é€ç»™å¦ä¸€ä¸ªç”¨æˆ·ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ç›¸åŒçš„å¸¦å®½ 25MB/s æ¥è¿›è¡Œä¸Šä¼ å’Œä¸‹è½½ã€‚\nHigh level estimates:\né«˜æ°´å¹³ä¼°è®¡ï¼š\nTotal messages 20 billion per day Storage for each day 2TB Storage for 5 years 3.6PB Incomming data 25MB/s Outgoing data 25MB/s\næ¶ˆæ¯æ€»æ•° æ¯å¤© 200 äº¿æ¡ æ¯å¤©å­˜å‚¨ 2TB å­˜å‚¨ 5 å¹´ 3.6PB ä¼ å…¥æ•°æ® 25MB/s ä¼ å‡ºæ•°æ® 25MB/s\n4. High Level Design é«˜å±‚è®¾è®¡ At a high-level, we will need a chat server that will be the central piece, orchestrating all the communications between users. When a user wants to send a message to another user, they will connect to the chat server and send the message to the server; the server then passes that message to the other user and also stores it in the database.\nåœ¨é«˜å±‚ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªèŠå¤©æœåŠ¡å™¨ä½œä¸ºæ ¸å¿ƒéƒ¨åˆ†ï¼Œåè°ƒç”¨æˆ·ä¹‹é—´çš„æ‰€æœ‰é€šä¿¡ã€‚å½“ä¸€ä¸ªç”¨æˆ·æƒ³è¦å‘å¦ä¸€ä¸ªç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ï¼Œä»–ä»¬ä¼šè¿æ¥åˆ°èŠå¤©æœåŠ¡å™¨å¹¶å°†æ¶ˆæ¯å‘é€åˆ°æœåŠ¡å™¨ï¼›ç„¶åï¼ŒæœåŠ¡å™¨å°†è¯¥æ¶ˆæ¯ä¼ é€’ç»™å…¶ä»–ç”¨æˆ·å¹¶å°†å…¶å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚\nThe detailed workflow would look like this:\nè¯¦ç»†çš„å·¥ä½œæµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š\nUser-A sends a message to User-B through the chat server.\nç”¨æˆ· A é€šè¿‡èŠå¤©æœåŠ¡å™¨å‘ç”¨æˆ· B å‘é€æ¶ˆæ¯ã€‚\nThe server receives the message and sends an acknowledgment to User-A.\næœåŠ¡å™¨æ¥æ”¶æ¶ˆæ¯å¹¶å‘ç”¨æˆ· A å‘é€ç¡®è®¤ã€‚\nThe server stores the message in its database and sends the message to User-B.\næœåŠ¡å™¨å°†æ¶ˆæ¯å­˜å‚¨åœ¨å…¶æ•°æ®åº“ä¸­å¹¶å°†æ¶ˆæ¯å‘é€ç»™ç”¨æˆ·\nUser-B receives the message and sends the acknowledgment to the server.\nç”¨æˆ·B æ¥æ”¶æ¶ˆæ¯å¹¶å‘æœåŠ¡å™¨å‘é€ç¡®è®¤ã€‚\nThe server notifies User-A that the message has been delivered successfully to User-B.\næœåŠ¡å™¨é€šçŸ¥ç”¨æˆ· A æ¶ˆæ¯å·²æˆåŠŸä¼ é€’ç»™ç”¨æˆ· Bã€‚\n5. Detailed Component Design è¯¦ç»†ç»„ä»¶è®¾è®¡ Letâ€™s try to build a simple solution first where everything runs on one server. At the high level our system needs to handle the following use cases:\nè®©æˆ‘ä»¬é¦–å…ˆå°è¯•æ„å»ºä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ¡ˆï¼Œå…¶ä¸­æ‰€æœ‰å†…å®¹éƒ½åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šè¿è¡Œã€‚åœ¨é«˜å±‚ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿéœ€è¦å¤„ç†ä»¥ä¸‹ç”¨ä¾‹ï¼š\nReceive incoming messages and deliver outgoing messages.\næ¥æ”¶ä¼ å…¥æ¶ˆæ¯å¹¶ä¼ é€’ä¼ å‡ºæ¶ˆæ¯ã€‚\nStore and retrieve messages from the database.\nåœ¨æ•°æ®åº“ä¸­å­˜å‚¨å’Œæ£€ç´¢æ¶ˆæ¯ã€‚\nKeep a record of which user is online or has gone offline, and notify all the relevant users about these status changes.\nè®°å½•å“ªäº›ç”¨æˆ·åœ¨çº¿æˆ–ç¦»çº¿ï¼Œå¹¶é€šçŸ¥æ‰€æœ‰ç›¸å…³ç”¨æˆ·è¿™äº›çŠ¶æ€å˜åŒ–ã€‚\nLetâ€™s talk about these scenarios one by one:\næˆ‘ä»¬æ¥ä¸€ä¸€è°ˆè°ˆè¿™äº›åœºæ™¯ï¼š\na. Messages Handling\na.æ¶ˆæ¯å¤„ç†\nHow would we efficiently send/receive messages? To send messages, a user needs to connect to the server and post messages for the other users. To get a message from the server, the user has two options:\næˆ‘ä»¬å¦‚ä½•æœ‰æ•ˆåœ°å‘é€/æ¥æ”¶æ¶ˆæ¯ï¼Ÿè¦å‘é€æ¶ˆæ¯ï¼Œç”¨æˆ·éœ€è¦è¿æ¥åˆ°æœåŠ¡å™¨å¹¶ä¸ºå…¶ä»–ç”¨æˆ·å‘å¸ƒæ¶ˆæ¯ã€‚è¦ä»æœåŠ¡å™¨è·å–æ¶ˆæ¯ï¼Œç”¨æˆ·æœ‰ä¸¤ç§é€‰æ‹©ï¼š\nPull model: Users can periodically ask the server if there are any new messages for them.\nPullæ¨¡å‹ï¼šç”¨æˆ·å¯ä»¥å®šæœŸå‘æœåŠ¡å™¨è¯¢é—®æ˜¯å¦æœ‰æ–°æ¶ˆæ¯ã€‚\nPush model: Users can keep a connection open with the server and can depend upon the server to notify them whenever there are new messages.\næ¨é€æ¨¡å‹ï¼šç”¨æˆ·å¯ä»¥ä¸æœåŠ¡å™¨ä¿æŒå¼€æ”¾çš„è¿æ¥ï¼Œå¹¶ä¸”å¯ä»¥ä¾èµ–æœåŠ¡å™¨æ¯å½“æœ‰æ–°æ¶ˆæ¯æ—¶é€šçŸ¥ä»–ä»¬ã€‚\nIf we go with our first approach, then the server needs to keep track of messages that are still waiting to be delivered, and as soon as the receiving user connects to the server to ask for any new message, the server can return all the pending messages. To minimize latency for the user, they have to check the server quite frequently, and most of the time they will be getting an empty response if there are no pending message. This will waste a lot of resources and does not look like an efficient solution.\nå¦‚æœæˆ‘ä»¬é‡‡ç”¨ç¬¬ä¸€ç§æ–¹æ³•ï¼Œé‚£ä¹ˆæœåŠ¡å™¨éœ€è¦è·Ÿè¸ªä»åœ¨ç­‰å¾…ä¼ é€’çš„æ¶ˆæ¯ï¼Œå¹¶ä¸”ä¸€æ—¦æ¥æ”¶ç”¨æˆ·è¿æ¥åˆ°æœåŠ¡å™¨ä»¥è¯·æ±‚ä»»ä½•æ–°æ¶ˆæ¯ï¼ŒæœåŠ¡å™¨å°±å¯ä»¥è¿”å›æ‰€æœ‰å¾…å¤„ç†çš„æ¶ˆæ¯æ¶ˆæ¯ã€‚ä¸ºäº†æœ€å¤§é™åº¦åœ°å‡å°‘ç”¨æˆ·çš„å»¶è¿Ÿï¼Œä»–ä»¬å¿…é¡»ç»å¸¸æ£€æŸ¥æœåŠ¡å™¨ï¼Œå¹¶ä¸”å¤§å¤šæ•°æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰å¾…å¤„ç†çš„æ¶ˆæ¯ï¼Œä»–ä»¬å°†å¾—åˆ°ç©ºå“åº”ã€‚è¿™ä¼šæµªè´¹å¤§é‡èµ„æºï¼Œè€Œä¸”çœ‹èµ·æ¥å¹¶ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚\nIf we go with our second approach, where all the active users keep a connection open with the server, then as soon as the server receives a message it can immediately pass the message to the intended user. This way, the server does not need to keep track of the pending messages, and we will have minimum latency, as the messages are delivered instantly on the opened connection.\nå¦‚æœæˆ‘ä»¬é‡‡ç”¨ç¬¬äºŒç§æ–¹æ³•ï¼Œå³æ‰€æœ‰æ´»åŠ¨ç”¨æˆ·ä¸æœåŠ¡å™¨ä¿æŒæ‰“å¼€çš„è¿æ¥ï¼Œé‚£ä¹ˆä¸€æ—¦æœåŠ¡å™¨æ”¶åˆ°æ¶ˆæ¯ï¼Œå®ƒå°±å¯ä»¥ç«‹å³å°†æ¶ˆæ¯ä¼ é€’ç»™ç›®æ ‡ç”¨æˆ·ã€‚è¿™æ ·ï¼ŒæœåŠ¡å™¨ä¸éœ€è¦è·Ÿè¸ªå¾…å¤„ç†çš„æ¶ˆæ¯ï¼Œå¹¶ä¸”æˆ‘ä»¬å°†å…·æœ‰æœ€å°çš„å»¶è¿Ÿï¼Œå› ä¸ºæ¶ˆæ¯æ˜¯åœ¨æ‰“å¼€çš„è¿æ¥ä¸Šç«‹å³ä¼ é€’çš„ã€‚\nHow will clients maintain an open connection with the server? We can use HTTP Long Polling or WebSockets. In long polling, clients can request information from the server with the expectation that the server may not respond immediately. If the server has no new data for the client when the poll is received, instead of sending an empty response, the server holds the request open and waits for\nå®¢æˆ·ç«¯å¦‚ä½•ä¸æœåŠ¡å™¨ä¿æŒå¼€æ”¾è¿æ¥ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ HTTP é•¿è½®è¯¢æˆ– WebSocketsã€‚åœ¨é•¿è½®è¯¢ä¸­ï¼Œå®¢æˆ·ç«¯å¯ä»¥å‘æœåŠ¡å™¨è¯·æ±‚ä¿¡æ¯ï¼Œä½†æœŸæœ›æœåŠ¡å™¨å¯èƒ½ä¸ä¼šç«‹å³å“åº”ã€‚å¦‚æœæœåŠ¡å™¨åœ¨æ”¶åˆ°è½®è¯¢æ—¶æ²¡æœ‰ä¸ºå®¢æˆ·ç«¯æä¾›æ–°æ•°æ®ï¼Œåˆ™æœåŠ¡å™¨ä¸ä¼šå‘é€ç©ºå“åº”ï¼Œè€Œæ˜¯ä¿æŒè¯·æ±‚æ‰“å¼€å¹¶ç­‰å¾…\nresponse information to become available. Once it does have new information, the server immediately sends the response to the client, completing the open request. Upon receipt of the server response, the client can immediately issue another server request for future updates. This gives a lot of improvements in latencies, throughputs, and performance. The long polling request can timeout or can receive a disconnect from the server, in that case, the client has to open a new request.\nå“åº”ä¿¡æ¯å˜å¾—å¯ç”¨ã€‚ä¸€æ—¦æœ‰æ–°ä¿¡æ¯ï¼ŒæœåŠ¡å™¨ç«‹å³å°†å“åº”å‘é€ç»™å®¢æˆ·ç«¯ï¼Œå®Œæˆæ‰“å¼€è¯·æ±‚ã€‚æ”¶åˆ°æœåŠ¡å™¨å“åº”åï¼Œå®¢æˆ·ç«¯å¯ä»¥ç«‹å³å‘å‡ºå¦ä¸€ä¸ªæœåŠ¡å™¨è¯·æ±‚ä»¥è¿›è¡Œå°†æ¥çš„æ›´æ–°ã€‚è¿™åœ¨å»¶è¿Ÿã€ååé‡å’Œæ€§èƒ½æ–¹é¢å¸¦æ¥äº†å¾ˆå¤§çš„æ”¹è¿›ã€‚é•¿è½®è¯¢è¯·æ±‚å¯èƒ½ä¼šè¶…æ—¶æˆ–å¯èƒ½ä¼šæ”¶åˆ°ä¸æœåŠ¡å™¨çš„æ–­å¼€è¿æ¥ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯å¿…é¡»æ‰“å¼€æ–°çš„è¯·æ±‚ã€‚\nHow can the server keep track of all the opened connection to redirect messages to the users efficiently? The server can maintain a hash table, where â€œkeyâ€ would be the UserID and â€œvalueâ€ would be the connection object. So whenever the server receives a message for a user, it looks up that user in the hash table to find the connection object and sends the message on the open request.\næœåŠ¡å™¨å¦‚ä½•è·Ÿè¸ªæ‰€æœ‰æ‰“å¼€çš„è¿æ¥ä»¥æœ‰æ•ˆåœ°å°†æ¶ˆæ¯é‡å®šå‘åˆ°ç”¨æˆ·ï¼ŸæœåŠ¡å™¨å¯ä»¥ç»´æŠ¤ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œå…¶ä¸­â€œkeyâ€æ˜¯ç”¨æˆ·IDï¼Œâ€œvalueâ€æ˜¯è¿æ¥å¯¹è±¡ã€‚å› æ­¤ï¼Œæ¯å½“æœåŠ¡å™¨æ”¶åˆ°ç”¨æˆ·çš„æ¶ˆæ¯æ—¶ï¼Œå®ƒéƒ½ä¼šåœ¨å“ˆå¸Œè¡¨ä¸­æŸ¥æ‰¾è¯¥ç”¨æˆ·ä»¥æ‰¾åˆ°è¿æ¥å¯¹è±¡ï¼Œå¹¶æ ¹æ®æ‰“å¼€çš„è¯·æ±‚å‘é€æ¶ˆæ¯ã€‚\nWhat will happen when the server receives a message for a user who has gone offline? If the receiver has disconnected, the server can notify the sender about the delivery failure. If it is a temporary disconnect, e.g., the receiverâ€™s long-poll request just timed out, then we should expect a reconnect from the user. In that case, we can ask the sender to retry sending the message. This retry could be embedded in the clientâ€™s logic so that users donâ€™t have to retype the message. The server can also store the message for a while and retry sending it once the receiver reconnects.\nå½“æœåŠ¡å™¨æ”¶åˆ°ç”¨æˆ·ä¸‹çº¿çš„æ¶ˆæ¯æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿå¦‚æœæ¥æ”¶æ–¹å·²æ–­å¼€è¿æ¥ï¼ŒæœåŠ¡å™¨å¯ä»¥é€šçŸ¥å‘é€æ–¹ä¼ é€å¤±è´¥ã€‚å¦‚æœæ˜¯ä¸´æ—¶æ–­å¼€è¿æ¥ï¼Œä¾‹å¦‚æ¥æ”¶è€…çš„é•¿è½®è¯¢è¯·æ±‚åˆšåˆšè¶…æ—¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æœŸæœ›ç”¨æˆ·é‡æ–°è¿æ¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è¦æ±‚å‘ä»¶äººé‡è¯•å‘é€æ¶ˆæ¯ã€‚è¿™ç§é‡è¯•å¯ä»¥åµŒå…¥åˆ°å®¢æˆ·ç«¯çš„é€»è¾‘ä¸­ï¼Œè¿™æ ·ç”¨æˆ·å°±ä¸å¿…é‡æ–°è¾“å…¥æ¶ˆæ¯ã€‚æœåŠ¡å™¨è¿˜å¯ä»¥å°†æ¶ˆæ¯å­˜å‚¨ä¸€æ®µæ—¶é—´ï¼Œå¹¶åœ¨æ¥æ”¶è€…é‡æ–°è¿æ¥åé‡è¯•å‘é€ã€‚\nHow many chat servers we need? Letâ€™s plan for 500 million connections at any time. Assuming a modern server can handle 50K concurrent connections at any time, we would need 10K such servers.\næˆ‘ä»¬éœ€è¦å¤šå°‘ä¸ªèŠå¤©æœåŠ¡å™¨ï¼Ÿéšæ—¶è§„åˆ’5äº¿è¿æ¥ã€‚å‡è®¾ç°ä»£æœåŠ¡å™¨å¯ä»¥éšæ—¶å¤„ç† 50K å¹¶å‘è¿æ¥ï¼Œæˆ‘ä»¬å°†éœ€è¦ 10K è¿™æ ·çš„æœåŠ¡å™¨ã€‚\nHow do we know which server holds the connection to which user? We can introduce a software load balancer in front of our chat servers; that can map each UserID to a server to redirect the request.\næˆ‘ä»¬å¦‚ä½•çŸ¥é“å“ªä¸ªæœåŠ¡å™¨æ‹¥æœ‰ä¸å“ªä¸ªç”¨æˆ·çš„è¿æ¥ï¼Ÿæˆ‘ä»¬å¯ä»¥åœ¨èŠå¤©æœåŠ¡å™¨å‰é¢å¼•å…¥ä¸€ä¸ªè½¯ä»¶è´Ÿè½½å‡è¡¡å™¨ï¼›å®ƒå¯ä»¥å°†æ¯ä¸ª UserID æ˜ å°„åˆ°æœåŠ¡å™¨ä»¥é‡å®šå‘è¯·æ±‚ã€‚\nHow should the server process a â€˜deliver messageâ€™ request? The server needs to do the following things upon receiving a new message: 1) Store the message in the database 2) Send the message to the receiver and 3) Send an acknowledgment to the sender.\næœåŠ¡å™¨åº”è¯¥å¦‚ä½•å¤„ç†â€œä¼ é€’æ¶ˆæ¯â€è¯·æ±‚ï¼ŸæœåŠ¡å™¨åœ¨æ”¶åˆ°æ–°æ¶ˆæ¯åéœ€è¦æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š 1) å°†æ¶ˆæ¯å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ 2) å°†æ¶ˆæ¯å‘é€ç»™æ¥æ”¶è€… 3) å‘å‘é€è€…å‘é€ç¡®è®¤ã€‚\nThe chat server will first find the server that holds the connection for the receiver and pass the message to that server to send it to the receiver. The chat server can then send the acknowledgment to the sender; we donâ€™t need to wait for storing the message in the database (this can happen in the background). Storing the message is discussed in the next section.\nèŠå¤©æœåŠ¡å™¨å°†é¦–å…ˆæ‰¾åˆ°ä¸ºæ¥æ”¶è€…ä¿ç•™è¿æ¥çš„æœåŠ¡å™¨ï¼Œå¹¶å°†æ¶ˆæ¯ä¼ é€’ç»™è¯¥æœåŠ¡å™¨ä»¥å°†å…¶å‘é€ç»™æ¥æ”¶è€…ã€‚ç„¶åèŠå¤©æœåŠ¡å™¨å¯ä»¥å°†ç¡®è®¤å‘é€ç»™å‘é€è€…ï¼›æˆ‘ä»¬ä¸éœ€è¦ç­‰å¾…å°†æ¶ˆæ¯å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼ˆè¿™å¯ä»¥åœ¨åå°å‘ç”Ÿï¼‰ã€‚ä¸‹ä¸€èŠ‚å°†è®¨è®ºå­˜å‚¨æ¶ˆæ¯ã€‚\nHow does the messenger maintain the sequencing of the messages? We can store a timestamp with each message, which is the time the message is received by the server. This will still not ensure correct ordering of messages for clients. The scenario where the server timestamp cannot determine the exact order of messages would look like this:\næ¶ˆæ¯ä¼ é€’è€…å¦‚ä½•ä¿æŒæ¶ˆæ¯çš„é¡ºåºï¼Ÿæˆ‘ä»¬å¯ä»¥ä¸ºæ¯æ¡æ¶ˆæ¯å­˜å‚¨ä¸€ä¸ªæ—¶é—´æˆ³ï¼Œè¿™æ˜¯æœåŠ¡å™¨æ¥æ”¶æ¶ˆæ¯çš„æ—¶é—´ã€‚è¿™ä»ç„¶ä¸èƒ½ç¡®ä¿å®¢æˆ·ç«¯æ¶ˆæ¯çš„æ­£ç¡®æ’åºã€‚æœåŠ¡å™¨æ—¶é—´æˆ³æ— æ³•ç¡®å®šæ¶ˆæ¯çš„ç¡®åˆ‡é¡ºåºçš„æƒ…å†µå¦‚ä¸‹æ‰€ç¤ºï¼š\nUser-1 sends a message M1 to the server for User-2.\nUser-1 å‘ User-2 çš„æœåŠ¡å™¨å‘é€æ¶ˆæ¯ M1ã€‚\nThe server receives M1 at T1.\næœåŠ¡å™¨åœ¨ T1 æ¥æ”¶ M1ã€‚\nMeanwhile, User-2 sends a message M2 to the server for User-1.\nåŒæ—¶ï¼ŒUser-2å‘User-1çš„æœåŠ¡å™¨å‘é€æ¶ˆæ¯M2ã€‚\nThe server receives the message M2 at T2, such that T2 \u0026gt; T1.\næœåŠ¡å™¨åœ¨T2æ¥æ”¶æ¶ˆæ¯M2ï¼Œä½¿å¾—T2\u0026gt;T1ã€‚\nThe server sends message M1 to User-2 and M2 to User-1.\næœåŠ¡å™¨å°†æ¶ˆæ¯ M1 å‘é€åˆ° User-2ï¼Œå°† M2 å‘é€åˆ° User-1ã€‚\nSo User-1 will see M1 first and then M2, whereas User-2 will see M2 first and then M1.\nå› æ­¤ï¼Œç”¨æˆ· 1 å°†é¦–å…ˆçœ‹åˆ° M1ï¼Œç„¶åæ˜¯ M2ï¼Œè€Œç”¨æˆ· 2 å°†é¦–å…ˆçœ‹åˆ° M2ï¼Œç„¶åæ˜¯ M1ã€‚\nTo resolve this, we need to keep a sequence number with every message for each client. This sequence number will determine the exact ordering of messages for EACH user. With this solution both clients will see a different view of the message sequence, but this view will be consistent for them on all devices.\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯çš„æ¯æ¡æ¶ˆæ¯ä¿ç•™ä¸€ä¸ªåºåˆ—å·ã€‚è¯¥åºåˆ—å·å°†ç¡®å®šæ¯ä¸ªç”¨æˆ·çš„æ¶ˆæ¯çš„ç¡®åˆ‡é¡ºåºã€‚é€šè¿‡æ­¤è§£å†³æ–¹æ¡ˆï¼Œä¸¤ä¸ªå®¢æˆ·ç«¯éƒ½å°†çœ‹åˆ°æ¶ˆæ¯åºåˆ—çš„ä¸åŒè§†å›¾ï¼Œä½†æ­¤è§†å›¾åœ¨æ‰€æœ‰è®¾å¤‡ä¸Šéƒ½å°†ä¿æŒä¸€è‡´ã€‚\nb. Storing and retrieving the messages from the database\nb.ä»æ•°æ®åº“ä¸­å­˜å‚¨å’Œæ£€ç´¢æ¶ˆæ¯**\nWhenever the chat server receives a new message, it needs to store it in the database. To do so, we have two options:\næ¯å½“èŠå¤©æœåŠ¡å™¨æ”¶åˆ°æ–°æ¶ˆæ¯æ—¶ï¼Œéƒ½éœ€è¦å°†å…¶å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼š\nStart a separate thread, which will work with the database to store the message. 2. Send an asynchronous request to the database to store the message.\nå¯åŠ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹å°†ä¸æ•°æ®åº“ä¸€èµ·å­˜å‚¨æ¶ˆæ¯ã€‚ 2. å‘æ•°æ®åº“å‘é€å¼‚æ­¥è¯·æ±‚æ¥å­˜å‚¨æ¶ˆæ¯ã€‚\nWe have to keep certain things in mind while designing our database:\nåœ¨è®¾è®¡æ•°æ®åº“æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»è®°ä½ä»¥ä¸‹å‡ ç‚¹ï¼š\nHow to efficiently work with the database connection pool.\nå¦‚ä½•é«˜æ•ˆåœ°ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± ã€‚\nHow to retry failed requests.\nå¦‚ä½•é‡è¯•å¤±è´¥çš„è¯·æ±‚ã€‚\nWhere to log those requests that failed even after some retries.\nåœ¨å“ªé‡Œè®°å½•é‚£äº›é‡è¯•åä»å¤±è´¥çš„è¯·æ±‚ã€‚\nHow to retry these logged requests (that failed after the retry) when all the issues have resolved.\nå½“æ‰€æœ‰é—®é¢˜éƒ½è§£å†³åï¼Œå¦‚ä½•é‡è¯•è¿™äº›è®°å½•çš„è¯·æ±‚ï¼ˆé‡è¯•åå¤±è´¥ï¼‰ã€‚\nWhich storage system we should use? We need to have a database that can support a very high rate of small updates and also fetch a range of records quickly. This is required because we have a huge number of small messages that need to be inserted in the database and, while querying, a user is mostly interested in sequentially accessing the messages.\næˆ‘ä»¬åº”è¯¥ä½¿ç”¨å“ªç§å­˜å‚¨ç³»ç»Ÿï¼Ÿæˆ‘ä»¬éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿæ”¯æŒéå¸¸é«˜çš„å°æ›´æ–°ç‡å¹¶ä¸”èƒ½å¤Ÿå¿«é€Ÿè·å–ä¸€ç³»åˆ—è®°å½•çš„æ•°æ®åº“ã€‚è¿™æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºæˆ‘ä»¬æœ‰å¤§é‡çš„å°æ¶ˆæ¯éœ€è¦æ’å…¥åˆ°æ•°æ®åº“ä¸­ï¼Œå¹¶ä¸”åœ¨æŸ¥è¯¢æ—¶ï¼Œç”¨æˆ·æœ€æ„Ÿå…´è¶£çš„æ˜¯é¡ºåºè®¿é—®è¿™äº›æ¶ˆæ¯ã€‚\nWe cannot use RDBMS like MySQL or NoSQL like MongoDB because we cannot afford to read/write a row from the database every time a user receives/sends a message. This will not only make the basic operations of our service run with high latency, but also create a huge load on databases.\næˆ‘ä»¬æ— æ³•ä½¿ç”¨ MySQL ç­‰ RDBMS æˆ– MongoDB ç­‰ NoSQLï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•åœ¨ç”¨æˆ·æ¯æ¬¡æ¥æ”¶/å‘é€æ¶ˆæ¯æ—¶ä»æ•°æ®åº“ä¸­è¯»å–/å†™å…¥ä¸€è¡Œã€‚è¿™ä¸ä»…ä¼šä½¿æˆ‘ä»¬æœåŠ¡çš„åŸºæœ¬æ“ä½œä»¥é«˜å»¶è¿Ÿè¿è¡Œï¼Œè¿˜ä¼šå¯¹æ•°æ®åº“é€ æˆå·¨å¤§çš„è´Ÿè½½ã€‚\nBoth of our requirements can be easily met with a wide-column database solution like HBase. HBase is a column-oriented key-value NoSQL database that can store multiple values against one key into multiple columns. HBase is modeled after Googleâ€™s BigTable and runs on top of Hadoop Distributed File System (HDFS). HBase groups data together to store new data in a memory buffer and, once the buffer is full, it dumps the data to the disk. This way of storage not only helps storing a lot of small data quickly, but also fetching rows by the key or scanning ranges of rows. HBase is also an efficient database to store variably sized data, which is also required by our service.\nåƒ HBase è¿™æ ·çš„å®½åˆ—æ•°æ®åº“è§£å†³æ–¹æ¡ˆå°±å¯ä»¥è½»æ¾æ»¡è¶³æˆ‘ä»¬çš„è¿™ä¸¤ä¸ªè¦æ±‚ã€‚ HBase æ˜¯ä¸€ç§é¢å‘åˆ—çš„é”®å€¼ NoSQL æ•°æ®åº“ï¼Œå¯ä»¥å°†ä¸€ä¸ªé”®çš„å¤šä¸ªå€¼å­˜å‚¨åˆ°å¤šä¸ªåˆ—ä¸­ã€‚ HBase ä»¿ç…§ Google çš„ BigTable å»ºæ¨¡ï¼Œå¹¶åœ¨ Hadoop åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ (HDFS) ä¹‹ä¸Šè¿è¡Œã€‚ HBase å°†æ•°æ®åˆ†ç»„åœ¨ä¸€èµ·ï¼Œå°†æ–°æ•°æ®å­˜å‚¨åœ¨å†…å­˜ç¼“å†²åŒºä¸­ï¼Œä¸€æ—¦ç¼“å†²åŒºå·²æ»¡ï¼Œå®ƒå°†æ•°æ®è½¬å‚¨åˆ°ç£ç›˜ã€‚è¿™ç§å­˜å‚¨æ–¹å¼ä¸ä»…æœ‰åŠ©äºå¿«é€Ÿå­˜å‚¨å¤§é‡å°æ•°æ®ï¼Œè€Œä¸”è¿˜å¯ä»¥é€šè¿‡é”®æˆ–æ‰«æè¡ŒèŒƒå›´æ¥è·å–è¡Œã€‚ HBaseä¹Ÿæ˜¯ä¸€ä¸ªé«˜æ•ˆçš„æ•°æ®åº“ï¼Œå¯ä»¥å­˜å‚¨ä¸åŒå¤§å°çš„æ•°æ®ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬çš„æœåŠ¡æ‰€éœ€è¦çš„ã€‚\nHow should clients efficiently fetch data from the server? Clients should paginate while fetching data from the server. Page size could be different for different clients, e.g., cell phones have smaller screens, so we need a fewer number of message/conversations in the viewport.\nå®¢æˆ·ç«¯åº”è¯¥å¦‚ä½•é«˜æ•ˆåœ°ä»æœåŠ¡å™¨è·å–æ•°æ®ï¼Ÿå®¢æˆ·ç«¯åœ¨ä»æœåŠ¡å™¨è·å–æ•°æ®æ—¶åº”è¯¥åˆ†é¡µã€‚å¯¹äºä¸åŒçš„å®¢æˆ·ç«¯ï¼Œé¡µé¢å¤§å°å¯èƒ½ä¸åŒï¼Œä¾‹å¦‚ï¼Œæ‰‹æœºçš„å±å¹•è¾ƒå°ï¼Œå› æ­¤æˆ‘ä»¬åœ¨è§†å£ä¸­éœ€è¦è¾ƒå°‘æ•°é‡çš„æ¶ˆæ¯/å¯¹è¯ã€‚\nc. Managing userâ€™s status\nc.ç®¡ç†ç”¨æˆ·çŠ¶æ€\nWe need to keep track of userâ€™s online/offline status and notify all the relevant users whenever a status change happens. Since we are maintaining a connection object on the server for all active users, we can easily figure out the userâ€™s current status from this. With 500M active users at any time, if we have to\næˆ‘ä»¬éœ€è¦è·Ÿè¸ªç”¨æˆ·çš„åœ¨çº¿/ç¦»çº¿çŠ¶æ€ï¼Œå¹¶åœ¨çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶é€šçŸ¥æ‰€æœ‰ç›¸å…³ç”¨æˆ·ã€‚ç”±äºæˆ‘ä»¬åœ¨æœåŠ¡å™¨ä¸Šä¸ºæ‰€æœ‰æ´»åŠ¨ç”¨æˆ·ç»´æŠ¤ä¸€ä¸ªè¿æ¥å¯¹è±¡ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°ä»ä¸­æ‰¾å‡ºç”¨æˆ·çš„å½“å‰çŠ¶æ€ã€‚ä»»ä½•æ—¶å€™éƒ½æœ‰ 5 äº¿æ´»è·ƒç”¨æˆ·ï¼Œå¦‚æœæˆ‘ä»¬å¿…é¡»çš„è¯\nbroadcast each status change to all the relevant active users, it will consume a lot of resources. We can do the following optimization around this:\nå°†æ¯ä¸ªçŠ¶æ€å˜åŒ–å¹¿æ’­ç»™æ‰€æœ‰ç›¸å…³çš„æ´»è·ƒç”¨æˆ·ï¼Œä¼šæ¶ˆè€—å¤§é‡èµ„æºã€‚å›´ç»•è¿™ä¸€ç‚¹æˆ‘ä»¬å¯ä»¥åšå¦‚ä¸‹ä¼˜åŒ–ï¼š\nWhenever a client starts the app, it can pull the current status of all users in their friendsâ€™ list.\næ¯å½“å®¢æˆ·ç«¯å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒéƒ½å¯ä»¥æå–å¥½å‹åˆ—è¡¨ä¸­æ‰€æœ‰ç”¨æˆ·çš„å½“å‰çŠ¶æ€ã€‚\nWhenever a user sends a message to another user that has gone offline, we can send a failure to the sender and update the status on the client.\næ¯å½“ä¸€ä¸ªç”¨æˆ·å‘å¦ä¸€ä¸ªç¦»çº¿çš„ç”¨æˆ·å‘é€æ¶ˆæ¯æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å‘å‘é€è€…å¹¶æ›´æ–°å®¢æˆ·ç«¯ä¸Šçš„çŠ¶æ€ã€‚\nWhenever a user comes online, the server can always broadcast that status with a delay of a few seconds to see if the user does not go offline immediately.\næ¯å½“ç”¨æˆ·ä¸Šçº¿æ—¶ï¼ŒæœåŠ¡å™¨æ€»æ˜¯å¯ä»¥å»¶è¿Ÿå‡ ç§’å¹¿æ’­è¯¥çŠ¶æ€ç§’æŸ¥çœ‹ç”¨æˆ·æ˜¯å¦æ²¡æœ‰ç«‹å³ç¦»çº¿ã€‚\nClientâ€™s can pull the status from the server about those users that are being shown on the userâ€™s viewport. This should not be a frequent operation, as the server is broadcasting the online status of users and we can live with the stale offline status of users for a while.\nå®¢æˆ·ç«¯å¯ä»¥ä»æœåŠ¡å™¨è·å–æœ‰å…³ç”¨æˆ·çš„çŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€æ˜¾ç¤ºåœ¨ç”¨æˆ·çš„è§†å£ã€‚è¿™ä¸åº”è¯¥æ˜¯ä¸€ä¸ªé¢‘ç¹çš„æ“ä½œï¼Œå› ä¸ºæœåŠ¡å™¨æ­£åœ¨å¹¿æ’­åœ¨çº¿çŠ¶æ€ç”¨æˆ·çš„ç¦»çº¿çŠ¶æ€æˆ‘ä»¬å¯ä»¥å¿å—ä¸€æ®µæ—¶é—´ã€‚\nWhenever the client starts a new chat with another user, we can pull the status at that time.\næ¯å½“å®¢æˆ·ç«¯ä¸å¦ä¸€ä¸ªç”¨æˆ·å¼€å§‹æ–°çš„èŠå¤©æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥æå–å½“æ—¶çš„çŠ¶æ€ã€‚\nDetailed component design for Facebook messenger\nFacebook Messenger çš„è¯¦ç»†ç»„ä»¶è®¾è®¡\nDesign Summary: Clients will open a connection to the chat server to send a message; the server will then pass it to the requested user. All the active users will keep a connection open with the server to receive messages. Whenever a new message arrives, the chat server will push it to the receiving user on the long poll request. Messages can be stored in HBase, which supports quick small updates, and range\nè®¾è®¡æ€»ç»“ï¼šå®¢æˆ·ç«¯ä¼šæ‰“å¼€ä¸€ä¸ªåˆ°èŠå¤©æœåŠ¡å™¨çš„è¿æ¥æ¥å‘é€æ¶ˆæ¯ï¼›ç„¶åæœåŠ¡å™¨ä¼šå°†å…¶ä¼ é€’ç»™è¯·æ±‚çš„ç”¨æˆ·ã€‚æ‰€æœ‰æ´»åŠ¨ç”¨æˆ·éƒ½å°†ä¿æŒä¸æœåŠ¡å™¨çš„è¿æ¥ä»¥æ¥æ”¶æ¶ˆæ¯ã€‚æ¯å½“æœ‰æ–°æ¶ˆæ¯åˆ°è¾¾æ—¶ï¼ŒèŠå¤©æœåŠ¡å™¨éƒ½ä¼šé€šè¿‡é•¿è½®è¯¢è¯·æ±‚å°†å…¶æ¨é€ç»™æ¥æ”¶ç”¨æˆ·ã€‚æ¶ˆæ¯å¯ä»¥å­˜å‚¨åœ¨HBaseä¸­ï¼Œæ”¯æŒå¿«é€Ÿå°æ›´æ–°å’ŒèŒƒå›´\nbased searches. The servers can broadcast the online status of a user to other relevant users. Clients can pull status updates for users who are visible in the clientâ€™s viewport on a less frequent basis.\nåŸºäºæœç´¢ã€‚æœåŠ¡å™¨å¯ä»¥å‘å…¶ä»–ç›¸å…³ç”¨æˆ·å¹¿æ’­ç”¨æˆ·çš„åœ¨çº¿çŠ¶æ€ã€‚å®¢æˆ·ç«¯å¯ä»¥ä¸é¢‘ç¹åœ°ä¸ºåœ¨å®¢æˆ·ç«¯è§†å£ä¸­å¯è§çš„ç”¨æˆ·æ‹‰å–çŠ¶æ€æ›´æ–°ã€‚\n6. Data partitioning æ•°æ®åˆ†åŒº Since we will be storing a lot of data (3.6PB for five years), we need to distribute it onto multiple database servers. What will be our partitioning scheme?\nç”±äºæˆ‘ä»¬å°†å­˜å‚¨å¤§é‡æ•°æ®ï¼ˆäº”å¹´ 3.6PBï¼‰ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°†å…¶åˆ†å‘åˆ°å¤šä¸ªæ•°æ®åº“æœåŠ¡å™¨ä¸Šã€‚æˆ‘ä»¬çš„åˆ†åŒºæ–¹æ¡ˆæ˜¯ä»€ä¹ˆï¼Ÿ\nPartitioning based on UserID: Letâ€™s assume we partition based on the hash of the UserID so that we can keep all messages of a user on the same database. If one DB shard is 4TB, we will have â€œ3.6PB/4TB ~= 900â€ shards for five years. For simplicity, letâ€™s assume we keep 1K shards. So we will find the shard number by â€œhash(UserID) % 1000â€ and then store/retrieve the data from there. This partitioning scheme will also be very quick to fetch chat history for any user.\nåŸºäº UserID çš„åˆ†åŒºï¼šå‡è®¾æˆ‘ä»¬åŸºäº UserID çš„å“ˆå¸Œè¿›è¡Œåˆ†åŒºï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥å°†ç”¨æˆ·çš„æ‰€æœ‰æ¶ˆæ¯ä¿å­˜åœ¨åŒä¸€ä¸ªæ•°æ®åº“ä¸­ã€‚å¦‚æœä¸€ä¸ªæ•°æ®åº“åˆ†ç‰‡æ˜¯ 4TBï¼Œé‚£ä¹ˆäº”å¹´å†…æˆ‘ä»¬å°†æ‹¥æœ‰â€œ3.6PB/4TB ~= 900â€ä¸ªåˆ†ç‰‡ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å‡è®¾æˆ‘ä»¬ä¿ç•™ 1K åˆ†ç‰‡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†é€šè¿‡â€œhash(UserID) % 1000â€æ‰¾åˆ°åˆ†ç‰‡ç¼–å·ï¼Œç„¶åä»é‚£é‡Œå­˜å‚¨/æ£€ç´¢æ•°æ®ã€‚è¿™ç§åˆ†åŒºæ–¹æ¡ˆä¹Ÿå¯ä»¥éå¸¸å¿«é€Ÿåœ°è·å–ä»»ä½•ç”¨æˆ·çš„èŠå¤©å†å²è®°å½•ã€‚\nIn the beginning, we can start with fewer database servers with multiple shards residing on one physical server. Since we can have multiple database instances on a server, we can easily store multiple partitions on a single server. Our hash function needs to understand this logical partitioning scheme so that it can map multiple logical partitions on one physical server.\nä¸€å¼€å§‹ï¼Œæˆ‘ä»¬å¯ä»¥ä»è¾ƒå°‘çš„æ•°æ®åº“æœåŠ¡å™¨å¼€å§‹ï¼Œåœ¨ä¸€å°ç‰©ç†æœåŠ¡å™¨ä¸Šé©»ç•™å¤šä¸ªåˆ†ç‰‡ã€‚ç”±äºæˆ‘ä»¬å¯ä»¥åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šæ‹¥æœ‰å¤šä¸ªæ•°æ®åº“å®ä¾‹ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šå­˜å‚¨å¤šä¸ªåˆ†åŒºã€‚æˆ‘ä»¬çš„å“ˆå¸Œå‡½æ•°éœ€è¦ç†è§£è¿™ç§é€»è¾‘åˆ†åŒºæ–¹æ¡ˆï¼Œä»¥ä¾¿å®ƒå¯ä»¥åœ¨ä¸€å°ç‰©ç†æœåŠ¡å™¨ä¸Šæ˜ å°„å¤šä¸ªé€»è¾‘åˆ†åŒºã€‚\nSince we will store an unlimited history of messages, we can start with a big number of logical partitions, which will be mapped to fewer physical servers, and as our storage demand increases, we can add more physical servers to distribute our logical partitions.\nç”±äºæˆ‘ä»¬å°†å­˜å‚¨æ— é™çš„æ¶ˆæ¯å†å²è®°å½•ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä»å¤§é‡é€»è¾‘åˆ†åŒºå¼€å§‹ï¼Œè¿™äº›é€»è¾‘åˆ†åŒºå°†æ˜ å°„åˆ°æ›´å°‘çš„ç‰©ç†æœåŠ¡å™¨ï¼Œå¹¶ä¸”éšç€å­˜å‚¨éœ€æ±‚çš„å¢åŠ ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ æ›´å¤šç‰©ç†æœåŠ¡å™¨æ¥åˆ†å¸ƒæˆ‘ä»¬çš„é€»è¾‘åˆ†åŒºã€‚\nPartitioning based on MessageID: If we store different messages of a user on separate database shards, fetching a range of messages of a chat would be very slow, so we should not adopt this scheme.\nåŸºäºMessageIDçš„åˆ†åŒºï¼šå¦‚æœæˆ‘ä»¬å°†ä¸€ä¸ªç”¨æˆ·çš„ä¸åŒæ¶ˆæ¯å­˜å‚¨åœ¨ä¸åŒçš„æ•°æ®åº“åˆ†ç‰‡ä¸Šï¼Œé‚£ä¹ˆè·å–ä¸€æ®µèŠå¤©çš„ä¸€ç³»åˆ—æ¶ˆæ¯ä¼šéå¸¸æ…¢ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸åº”è¯¥é‡‡ç”¨è¿™ç§æ–¹æ¡ˆã€‚\n7. Cache ç¼“å­˜ We can cache a few recent messages (say last 15) in a few recent conversations that are visible in a userâ€™s viewport (say last 5). Since we decided to store all of the userâ€™s messages on one shard, cache for a user should entirely reside on one machine too.\næˆ‘ä»¬å¯ä»¥åœ¨ç”¨æˆ·è§†å£ä¸­å¯è§çš„ä¸€äº›æœ€è¿‘å¯¹è¯ï¼ˆä¾‹å¦‚æœ€å 5 æ¡ï¼‰ä¸­ç¼“å­˜ä¸€äº›æœ€è¿‘çš„æ¶ˆæ¯ï¼ˆä¾‹å¦‚æœ€å 15 æ¡ï¼‰ã€‚ç”±äºæˆ‘ä»¬å†³å®šå°†æ‰€æœ‰ç”¨æˆ·çš„æ¶ˆæ¯å­˜å‚¨åœ¨ä¸€ä¸ªåˆ†ç‰‡ä¸Šï¼Œå› æ­¤ç”¨æˆ·çš„ç¼“å­˜ä¹Ÿåº”è¯¥å®Œå…¨é©»ç•™åœ¨ä¸€å°æœºå™¨ä¸Šã€‚\n8. Load balancing 8.è´Ÿè½½å‡è¡¡\nWe will need a load balancer in front of our chat servers; that can map each UserID to a server that holds the connection for the user and then direct the request to that server. Similarly, we would need a load balancer for our cache servers.\næˆ‘ä»¬éœ€è¦åœ¨èŠå¤©æœåŠ¡å™¨å‰é¢æœ‰ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ï¼›å®ƒå¯ä»¥å°†æ¯ä¸ª UserID æ˜ å°„åˆ°ä¿å­˜ç”¨æˆ·è¿æ¥çš„æœåŠ¡å™¨ï¼Œç„¶åå°†è¯·æ±‚å®šå‘åˆ°è¯¥æœåŠ¡å™¨ã€‚åŒæ ·ï¼Œæˆ‘ä»¬çš„ç¼“å­˜æœåŠ¡å™¨éœ€è¦ä¸€ä¸ªè´Ÿè½½å¹³è¡¡å™¨ã€‚\n9. Fault tolerance and Replication å®¹é”™å’Œå¤åˆ¶ What will happen when a chat server fails? Our chat servers are holding connections with the users. If a server goes down, should we devise a mechanism to transfer those connections to some other server? Itâ€™s extremely hard to failover TCP connections to other servers; an easier approach can be to have clients automatically reconnect if the connection is lost.\nå½“èŠå¤©æœåŠ¡å™¨å‡ºç°æ•…éšœæ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿæˆ‘ä»¬çš„èŠå¤©æœåŠ¡å™¨ä¸ç”¨æˆ·ä¿æŒè¿æ¥ã€‚å¦‚æœæœåŠ¡å™¨å‡ºç°æ•…éšœï¼Œæˆ‘ä»¬æ˜¯å¦åº”è¯¥è®¾è®¡ä¸€ç§æœºåˆ¶å°†è¿™äº›è¿æ¥è½¬ç§»åˆ°å…¶ä»–æœåŠ¡å™¨ï¼Ÿå°† TCP è¿æ¥æ•…éšœè½¬ç§»åˆ°å…¶ä»–æœåŠ¡å™¨éå¸¸å›°éš¾ï¼›ä¸€ç§æ›´ç®€å•çš„æ–¹æ³•æ˜¯è®©å®¢æˆ·ç«¯åœ¨è¿æ¥ä¸¢å¤±æ—¶è‡ªåŠ¨é‡æ–°è¿æ¥ã€‚\nShould we store multiple copies of user messages? We cannot have only one copy of the userâ€™s data, because if the server holding the data crashes or is down permanently, we donâ€™t have any mechanism to\næˆ‘ä»¬åº”è¯¥å­˜å‚¨ç”¨æˆ·æ¶ˆæ¯çš„å¤šä¸ªå‰¯æœ¬å—ï¼Ÿæˆ‘ä»¬ä¸èƒ½åªæœ‰ä¸€ä»½ç”¨æˆ·æ•°æ®çš„å‰¯æœ¬ï¼Œå› ä¸ºå¦‚æœä¿å­˜æ•°æ®çš„æœåŠ¡å™¨å´©æºƒæˆ–æ°¸ä¹…å…³é—­ï¼Œæˆ‘ä»¬æ²¡æœ‰ä»»ä½•æœºåˆ¶å¯ä»¥\nrecover that data. For this, either we have to store multiple copies of the data on different servers or use techniques like Reed-Solomon encoding to distribute and replicate it.\næ¢å¤è¯¥æ•°æ®ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬è¦ä¹ˆå¿…é¡»åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šå­˜å‚¨æ•°æ®çš„å¤šä¸ªå‰¯æœ¬ï¼Œè¦ä¹ˆä½¿ç”¨ Reed-Solomon ç¼–ç ç­‰æŠ€æœ¯æ¥åˆ†å‘å’Œå¤åˆ¶æ•°æ®ã€‚\n10. Extended Requirements æ‰©å±•è¦æ±‚ a. Group chat\na.ç¾¤èŠ\nWe can have separate group-chat objects in our system that can be stored on the chat servers. A group- chat object is identified by GroupChatID and will also maintain a list of people who are part of that chat. Our load balancer can direct each group chat message based on GroupChatID and the server handling that group chat can iterate through all the users of the chat to find the server handling the connection of each user to deliver the message.\næˆ‘ä»¬å¯ä»¥åœ¨ç³»ç»Ÿä¸­æ‹¥æœ‰å•ç‹¬çš„ç¾¤èŠå¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡å¯ä»¥å­˜å‚¨åœ¨èŠå¤©æœåŠ¡å™¨ä¸Šã€‚ç¾¤èŠå¯¹è±¡ç”± GroupChatID æ ‡è¯†ï¼Œå¹¶ä¸”è¿˜å°†ç»´æŠ¤å±äºè¯¥èŠå¤©çš„äººå‘˜åˆ—è¡¨ã€‚æˆ‘ä»¬çš„è´Ÿè½½å‡è¡¡å™¨å¯ä»¥æ ¹æ® GroupChatID å¼•å¯¼æ¯ä¸ªç¾¤èŠæ¶ˆæ¯ï¼Œå¹¶ä¸”å¤„ç†è¯¥ç¾¤èŠçš„æœåŠ¡å™¨å¯ä»¥è¿­ä»£æ‰€æœ‰èŠå¤©ç”¨æˆ·ï¼Œæ‰¾åˆ°å¤„ç†æ¯ä¸ªç”¨æˆ·è¿æ¥çš„æœåŠ¡å™¨æ¥ä¼ é€’æ¶ˆæ¯ã€‚\nIn databases, we can store all the group chats in a separate table partitioned based on GroupChatID.\nåœ¨æ•°æ®åº“ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰ç¾¤èŠå­˜å‚¨åœ¨ä¸€ä¸ªæ ¹æ®GroupChatIDåˆ†åŒºçš„å•ç‹¬è¡¨ä¸­ã€‚\nb. Push notifications\nb.æ¨é€é€šçŸ¥\nIn our current design userâ€™s can only send messages to active users and if the receiving user is offline, we send a failure to the sending user. Push notifications will enable our system to send messages to offline users.\nåœ¨æˆ‘ä»¬å½“å‰çš„è®¾è®¡ä¸­ï¼Œç”¨æˆ·åªèƒ½å‘æ´»åŠ¨ç”¨æˆ·å‘é€æ¶ˆæ¯ï¼Œå¦‚æœæ¥æ”¶ç”¨æˆ·ç¦»çº¿ï¼Œæˆ‘ä»¬ä¼šå‘å‘é€ç”¨æˆ·å‘é€å¤±è´¥æ¶ˆæ¯ã€‚æ¨é€é€šçŸ¥å°†ä½¿æˆ‘ä»¬çš„ç³»ç»Ÿèƒ½å¤Ÿå‘ç¦»çº¿ç”¨æˆ·å‘é€æ¶ˆæ¯ã€‚\nFor Push notifications, each user can opt-in from their device (or a web browser) to get notifications whenever there is a new message or event. Each manufacturer maintains a set of servers that handles pushing these notifications to the user.\nå¯¹äºæ¨é€é€šçŸ¥ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½å¯ä»¥é€‰æ‹©ä»ä»–ä»¬çš„è®¾å¤‡ï¼ˆæˆ–ç½‘ç»œæµè§ˆå™¨ï¼‰æ¥æ”¶é€šçŸ¥ï¼Œåªè¦æœ‰æ–°æ¶ˆæ¯æˆ–äº‹ä»¶ã€‚æ¯ä¸ªåˆ¶é€ å•†éƒ½ç»´æŠ¤ä¸€ç»„æœåŠ¡å™¨æ¥å¤„ç†å°†è¿™äº›é€šçŸ¥æ¨é€ç»™ç”¨æˆ·ã€‚\nTo have push notifications in our system, we would need to set up a Notification server, which will take the messages for offline users and send them to the manufactureâ€™s push notification server, which will then send them to the userâ€™s device.\nè¦åœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸­æ·»åŠ æ¨é€é€šçŸ¥ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€ä¸ªé€šçŸ¥æœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨å°†è·å–ç¦»çº¿ç”¨æˆ·çš„æ¶ˆæ¯å¹¶å°†å…¶å‘é€åˆ°åˆ¶é€ å•†çš„æ¨é€é€šçŸ¥æœåŠ¡å™¨ï¼Œç„¶ååˆ¶é€ å•†çš„æ¨é€é€šçŸ¥æœåŠ¡å™¨å°†å®ƒä»¬å‘é€åˆ°ç”¨æˆ·çš„è®¾å¤‡ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/11/24/designing-facebook-messenger/","summary":"è¿™æ˜¯ä¸€ç¯‡åŒè¯­ç¿»è¯‘çš„æ–‡ç« ï¼ŒåŸæ–‡å‡ºè‡ª grok_system_design_interview.pdf çš„ä¸€ç¯‡æ–‡ç« ã€ŠDesigning Facebook Messengerã€‹è®¾è®¡ Facebook Messengerã€‚\nLetâ€™s design an instant messaging service like Facebook Messenger where users can send text messages to each other through web and mobile interfaces. è®©æˆ‘ä»¬è®¾è®¡ä¸€ä¸ªåƒ Facebook Messenger è¿™æ ·çš„å³æ—¶æ¶ˆæ¯æœåŠ¡ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ç½‘ç»œå’Œç§»åŠ¨ç•Œé¢äº’ç›¸å‘é€çŸ­ä¿¡ã€‚\n1. What is Facebook Messenger? 1.ä»€ä¹ˆæ˜¯ Facebook Messengerï¼Ÿ\nFacebook Messenger is a software application which provides text-based instant messaging services to its users. Messenger users can chat with their Facebook friends both from cell-phones and Facebookâ€™s website.\nFacebook Messenger æ˜¯ä¸€æ¬¾ä¸ºå…¶ç”¨æˆ·æä¾›åŸºäºæ–‡æœ¬çš„å³æ—¶æ¶ˆæ¯æœåŠ¡çš„è½¯ä»¶åº”ç”¨ç¨‹åºã€‚ Messenger ç”¨æˆ·å¯ä»¥é€šè¿‡æ‰‹æœºå’Œ Facebook ç½‘ç«™ä¸ Facebook å¥½å‹èŠå¤©ã€‚\n2. Requirements and Goals of the System ç³»ç»Ÿçš„è¦æ±‚å’Œç›®æ ‡ Our Messenger should meet the following requirements:\næˆ‘ä»¬çš„ Messenger åº”æ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š\nFunctional Requirements:","title":"[è¯‘]ã€ŠGrokking the System Design Interviewã€‹è®¾è®¡Facebook Messenger"},{"content":"è¿™æ˜¯ä¸€ç¯‡åŒè¯­ç¿»è¯‘çš„æ–‡ç« ï¼ŒåŸæ–‡å‡ºè‡ª grok_system_design_interview.pdf çš„ä¸€ç¯‡æ–‡ç« ã€ŠDesigning Instagramã€‹è®¾è®¡ Instagramã€‚\nLetâ€™s design a photo-sharing service like Instagram, where users can upload photos to share them with other users. Similar Services: Flickr, Picasa Difficulty Level: Medium\nè®©æˆ‘ä»¬è®¾è®¡ä¸€ä¸ªåƒ Instagram è¿™æ ·çš„ç…§ç‰‡å…±äº«æœåŠ¡ï¼Œç”¨æˆ·å¯ä»¥ä¸Šä¼ ç…§ç‰‡ä¸å…¶ä»–ç”¨æˆ·å…±äº«ã€‚ç±»ä¼¼æœåŠ¡ï¼šFlickrã€Picasa éš¾åº¦çº§åˆ«ï¼šä¸­\n1. What is Instagram? 1.Instagramæ˜¯ä»€ä¹ˆï¼Ÿ\nInstagram is a social networking service which enables its users to upload and share their photos and videos with other users. Instagram users can choose to share information either publicly or privately. Anything shared publicly can be seen by any other user, whereas privately shared content can only be accessed by a specified set of people. Instagram also enables its users to share through many other social networking platforms, such as Facebook, Twitter, Flickr, and Tumblr.\nInstagram æ˜¯ä¸€é¡¹ç¤¾äº¤ç½‘ç»œæœåŠ¡ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡å®ƒä¸Šä¼ ç…§ç‰‡å’Œè§†é¢‘å¹¶ä¸å…¶ä»–ç”¨æˆ·åˆ†äº«ã€‚ Instagram ç”¨æˆ·å¯ä»¥é€‰æ‹©å…¬å¼€æˆ–ç§ä¸‹åˆ†äº«ä¿¡æ¯ã€‚ä»»ä½•å…¶ä»–ç”¨æˆ·éƒ½å¯ä»¥çœ‹åˆ°å…¬å¼€å…±äº«çš„ä»»ä½•å†…å®¹ï¼Œè€Œç§äººå…±äº«çš„å†…å®¹åªèƒ½ç”±æŒ‡å®šçš„ä¸€ç»„äººè®¿é—®ã€‚ Instagram è¿˜å…è®¸ç”¨æˆ·é€šè¿‡è®¸å¤šå…¶ä»–ç¤¾äº¤ç½‘ç»œå¹³å°è¿›è¡Œåˆ†äº«ï¼Œä¾‹å¦‚ Facebookã€Twitterã€Flickr å’Œ Tumblrã€‚\nFor the sake of this exercise, we plan to design a simpler version of Instagram, where a user can share photos and can also follow other users. The â€˜News Feedâ€™ for each user will consist of top photos of all the people the user follows.\nä¸ºäº†è¿™ä¸ªç»ƒä¹ ï¼Œæˆ‘ä»¬è®¡åˆ’è®¾è®¡ä¸€ä¸ªæ›´ç®€å•çš„ Instagram ç‰ˆæœ¬ï¼Œç”¨æˆ·å¯ä»¥åœ¨å…¶ä¸­åˆ†äº«ç…§ç‰‡ï¼Œä¹Ÿå¯ä»¥å…³æ³¨å…¶ä»–ç”¨æˆ·ã€‚æ¯ä¸ªç”¨æˆ·çš„â€œæ–°é—»æºâ€å°†åŒ…å«è¯¥ç”¨æˆ·å…³æ³¨çš„æ‰€æœ‰äººçš„çƒ­é—¨ç…§ç‰‡ã€‚\n2. Requirements and Goals of the System ç³»ç»Ÿçš„è¦æ±‚å’Œç›®æ ‡ Weâ€™ll focus on the following set of requirements while designing the Instagram:\nåœ¨è®¾è®¡ Instagram æ—¶ï¼Œæˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨ä»¥ä¸‹ä¸€ç»„è¦æ±‚ï¼š\nFunctional Requirements\nåŠŸèƒ½è¦æ±‚\nUsers should be able to upload/download/view photos.\nç”¨æˆ·åº”è¯¥èƒ½å¤Ÿä¸Šä¼ /ä¸‹è½½/æŸ¥çœ‹ç…§ç‰‡ã€‚\nUsers can perform searches based on photo/video titles.\nç”¨æˆ·å¯ä»¥æ ¹æ®ç…§ç‰‡/è§†é¢‘æ ‡é¢˜æ‰§è¡Œæœç´¢ã€‚\nUsers can follow other users.\nç”¨æˆ·å¯ä»¥å…³æ³¨å…¶ä»–ç”¨æˆ·ã€‚\nThe system should be able to generate and display a userâ€™s News Feed consisting of top photos from all the people the user follows.\nç³»ç»Ÿåº”è¯¥èƒ½å¤Ÿç”Ÿæˆå¹¶æ˜¾ç¤ºç”±çƒ­é—¨ç…§ç‰‡ç»„æˆçš„ç”¨æˆ·åŠ¨æ€æ¶ˆæ¯æ¥è‡ªç”¨æˆ·å…³æ³¨çš„æ‰€æœ‰äººã€‚\nNon-functional Requirements\néåŠŸèƒ½æ€§éœ€æ±‚\nOur service needs to be highly available.\næˆ‘ä»¬çš„æœåŠ¡éœ€è¦é«˜åº¦å¯ç”¨ã€‚\nThe acceptable latency of the system is 200ms for News Feed generation.\nå¯¹äº News Feed ç”Ÿæˆï¼Œç³»ç»Ÿå¯æ¥å—çš„å»¶è¿Ÿä¸º 200 æ¯«ç§’ã€‚\nConsistency can take a hit (in the interest of availability), if a user doesnâ€™t see a photo for a while; it should be fine.\nå¦‚æœç”¨æˆ·æ²¡æœ‰çœ‹åˆ°æŸä¸ªæ—¶é—´çš„ç…§ç‰‡ï¼Œä¸€è‡´æ€§å¯èƒ½ä¼šå—åˆ°å½±å“ï¼ˆä¸ºäº†å¯ç”¨æ€§ï¼‰å°½ç®¡;åº”è¯¥æ²¡é—®é¢˜ã€‚\nThe system should be highly reliable; any uploaded photo or video should never be lost.\nç³»ç»Ÿåº”å…·æœ‰é«˜å¯é æ€§ï¼›ä»»ä½•ä¸Šä¼ çš„ç…§ç‰‡æˆ–è§†é¢‘éƒ½ä¸åº”ä¸¢å¤±ã€‚\nNot in scope: Adding tags to photos, searching photos on tags, commenting on photos, tagging users to photos, who to follow, etc.\nä¸åœ¨èŒƒå›´å†…ï¼šä¸ºç…§ç‰‡æ·»åŠ æ ‡ç­¾ã€åœ¨æ ‡ç­¾ä¸Šæœç´¢ç…§ç‰‡ã€è¯„è®ºç…§ç‰‡ã€ä¸ºç…§ç‰‡æ ‡è®°ç”¨æˆ·ã€å…³æ³¨è°ç­‰ã€‚\n3. Some Design Considerations ä¸€äº›è®¾è®¡è€ƒè™‘ The system would be read-heavy, so we will focus on building a system that can retrieve photos quickly.\nè¯¥ç³»ç»Ÿçš„è¯»å–é‡å¾ˆå¤§ï¼Œå› æ­¤æˆ‘ä»¬å°†ä¸“æ³¨äºæ„å»ºä¸€ä¸ªå¯ä»¥å¿«é€Ÿæ£€ç´¢ç…§ç‰‡çš„ç³»ç»Ÿã€‚\nPractically, users can upload as many photos as they like. Efficient management of storage should be a crucial factor while designing this system.\nå®é™…ä¸Šï¼Œç”¨æˆ·å¯ä»¥ä¸Šä¼ ä»»æ„æ•°é‡çš„ç…§ç‰‡ã€‚è®¾è®¡è¯¥ç³»ç»Ÿæ—¶ï¼Œæœ‰æ•ˆçš„å­˜å‚¨ç®¡ç†åº”è¯¥æ˜¯ä¸€ä¸ªå…³é”®å› ç´ ã€‚\nLow latency is expected while viewing photos.\næŸ¥çœ‹ç…§ç‰‡æ—¶é¢„è®¡å»¶è¿Ÿè¾ƒä½ã€‚\nData should be 100% reliable. If a user uploads a photo, the system will guarantee that it will never be lost.\næ•°æ®åº”è¯¥100%å¯é ã€‚å¦‚æœç”¨æˆ·ä¸Šä¼ ç…§ç‰‡ï¼Œç³»ç»Ÿå°†ä¿è¯å®ƒä¼šæ°¸è¿œä¸ä¼šè¿·å¤±ã€‚\n4. Capacity Estimation and Constraints å®¹é‡ä¼°è®¡å’Œçº¦æŸ Letâ€™s assume we have 500M total users, with 1M daily active users.\nå‡è®¾æˆ‘ä»¬æœ‰ 5 äº¿æ€»ç”¨æˆ·ï¼Œå…¶ä¸­æ¯æ—¥æ´»è·ƒç”¨æˆ·ä¸º 100 ä¸‡ã€‚\n2M new photos every day, 23 new photos every second.\næ¯å¤© 200 ä¸‡å¼ æ–°ç…§ç‰‡ï¼Œæ¯ç§’ 23 å¼ æ–°ç…§ç‰‡ã€‚\nAverage photo file size =\u0026gt; 200KB\nå¹³å‡ç…§ç‰‡æ–‡ä»¶å¤§å° =\u0026gt; 200KB\nTotal space required for 1 day of photos\n1 å¤©ç…§ç‰‡æ‰€éœ€çš„æ€»ç©ºé—´\n2M * 200KB =\u0026gt; 400 GB\nTotal space required for 10 years: 400GB * 365 (days a year) * 10 (years) ~= 1425TB\n10å¹´æ‰€éœ€æ€»ç©ºé—´ï¼š400GB * 365ï¼ˆä¸€å¹´å¤©ï¼‰* 10ï¼ˆå¹´ï¼‰~= 1425TB\n5. High Level System Design é«˜å±‚ç³»ç»Ÿè®¾è®¡ At a high-level, we need to support two scenarios, one to upload photos and the other to view/search photos. Our service would need some object storage servers to store photos and also some database servers to store metadata information about the photos.\nåœ¨é«˜å±‚ï¼Œæˆ‘ä»¬éœ€è¦æ”¯æŒä¸¤ç§åœºæ™¯ï¼Œä¸€ç§æ˜¯ä¸Šä¼ ç…§ç‰‡ï¼Œå¦ä¸€ç§æ˜¯æŸ¥çœ‹/æœç´¢ç…§ç‰‡ã€‚æˆ‘ä»¬çš„æœåŠ¡éœ€è¦ä¸€äº›å¯¹è±¡å­˜å‚¨æœåŠ¡å™¨æ¥å­˜å‚¨ç…§ç‰‡ï¼Œè¿˜éœ€è¦ä¸€äº›æ•°æ®åº“æœåŠ¡å™¨æ¥å­˜å‚¨æœ‰å…³ç…§ç‰‡çš„å…ƒæ•°æ®ä¿¡æ¯ã€‚\n6. Database Schema æ•°æ®åº“æ¶æ„ Defining the DB schema in the early stages of the interview would help to understand the data flow among various components and later would guide towards data partitioning.\nåœ¨é¢è¯•çš„æ—©æœŸé˜¶æ®µå®šä¹‰æ•°æ®åº“æ¨¡å¼å°†æœ‰åŠ©äºç†è§£å„ä¸ªç»„ä»¶ä¹‹é—´çš„æ•°æ®æµï¼Œå¹¶åœ¨ä»¥åæŒ‡å¯¼æ•°æ®åˆ†åŒºã€‚\nWe need to store data about users, their uploaded photos, and people they follow. Photo table will store all data related to a photo; we need to have an index on (PhotoID, CreationDate) since we need to fetch recent photos first.\næˆ‘ä»¬éœ€è¦å­˜å‚¨æœ‰å…³ç”¨æˆ·ã€ä»–ä»¬ä¸Šä¼ çš„ç…§ç‰‡ä»¥åŠä»–ä»¬å…³æ³¨çš„äººçš„æ•°æ®ã€‚ç…§ç‰‡è¡¨å°†å­˜å‚¨ä¸ç…§ç‰‡ç›¸å…³çš„æ‰€æœ‰æ•°æ®ï¼›æˆ‘ä»¬éœ€è¦åœ¨ (PhotoID, CreationDate) ä¸Šæœ‰ä¸€ä¸ªç´¢å¼•ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦é¦–å…ˆè·å–æœ€è¿‘çš„ç…§ç‰‡ã€‚\nA straightforward approach for storing the above schema would be to use an RDBMS like MySQL since we require joins. But relational databases come with their challenges, especially when we need to scale them. For details, please take a look at SQL vs. NoSQL.\nå­˜å‚¨ä¸Šè¿°æ¨¡å¼çš„ä¸€ä¸ªç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨åƒ MySQL è¿™æ ·çš„ RDBMSï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦è¿æ¥ã€‚ä½†å…³ç³»æ•°æ®åº“ä¹Ÿé¢ä¸´ç€æŒ‘æˆ˜ï¼Œå°¤å…¶æ˜¯å½“æˆ‘ä»¬éœ€è¦æ‰©å±•å®ƒä»¬æ—¶ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ SQL ä¸ NoSQLã€‚\nWe can store photos in a distributed file storage like HDFS or S3.\næˆ‘ä»¬å¯ä»¥å°†ç…§ç‰‡å­˜å‚¨åœ¨ HDFS æˆ– S3 ç­‰åˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨ä¸­ã€‚\nWe can store the above schema in a distributed key-value store to enjoy the benefits offered by NoSQL. All the metadata related to photos can go to a table where the â€˜keyâ€™ would be the â€˜PhotoIDâ€™ and the â€˜valueâ€™ would be an object containing PhotoLocation, UserLocation, CreationTimestamp, etc.\næˆ‘ä»¬å¯ä»¥å°†ä¸Šè¿°æ¨¡å¼å­˜å‚¨åœ¨åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ä¸­ï¼Œä»¥äº«å— NoSQL æä¾›çš„å¥½å¤„ã€‚æ‰€æœ‰ä¸ç…§ç‰‡ç›¸å…³çš„å…ƒæ•°æ®éƒ½å¯ä»¥è¿›å…¥ä¸€ä¸ªè¡¨ï¼Œå…¶ä¸­â€œé”®â€æ˜¯â€œPhotoIDâ€ï¼Œâ€œå€¼â€æ˜¯åŒ…å« PhotoLocationã€UserLocationã€CreationTimestamp ç­‰çš„å¯¹è±¡ã€‚\nWe need to store relationships between users and photos, to know who owns which photo. We also need to store the list of people a user follows. For both of these tables, we can use a wide-column datastore like Cassandra. For the â€˜UserPhotoâ€™ table, the â€˜keyâ€™ would be â€˜UserIDâ€™ and the â€˜valueâ€™ would be the list of â€˜PhotoIDsâ€™ the user owns, stored in different columns. We will have a similar scheme for the â€˜UserFollowâ€™ table.\næˆ‘ä»¬éœ€è¦å­˜å‚¨ç”¨æˆ·å’Œç…§ç‰‡ä¹‹é—´çš„å…³ç³»ï¼Œä»¥äº†è§£è°æ‹¥æœ‰å“ªå¼ ç…§ç‰‡ã€‚æˆ‘ä»¬è¿˜éœ€è¦å­˜å‚¨ç”¨æˆ·å…³æ³¨çš„äººå‘˜åˆ—è¡¨ã€‚å¯¹äºè¿™ä¸¤ä¸ªè¡¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åƒ Cassandra è¿™æ ·çš„å®½åˆ—æ•°æ®å­˜å‚¨ã€‚å¯¹äºâ€œUserPhotoâ€è¡¨ï¼Œâ€œé”®â€å°†æ˜¯â€œUserIDâ€ï¼Œâ€œå€¼â€å°†æ˜¯ç”¨æˆ·æ‹¥æœ‰çš„â€œPhotoIDâ€åˆ—è¡¨ï¼Œå­˜å‚¨åœ¨ä¸åŒçš„åˆ—ä¸­ã€‚æˆ‘ä»¬å°†ä¸ºâ€œUserFollowâ€è¡¨æä¾›ç±»ä¼¼çš„æ–¹æ¡ˆã€‚\nCassandra or key-value stores in general, always maintain a certain number of replicas to offer reliability. Also, in such data stores, deletes donâ€™t get applied instantly, data is retained for certain days (to support undeleting) before getting removed from the system permanently.\nCassandra æˆ–é”®å€¼å­˜å‚¨é€šå¸¸å§‹ç»ˆç»´æŠ¤ä¸€å®šæ•°é‡çš„å‰¯æœ¬ä»¥æä¾›å¯é æ€§ã€‚æ­¤å¤–ï¼Œåœ¨æ­¤ç±»æ•°æ®å­˜å‚¨ä¸­ï¼Œåˆ é™¤ä¸ä¼šç«‹å³åº”ç”¨ï¼Œæ•°æ®ä¼šä¿ç•™ä¸€å®šå¤©æ•°ï¼ˆä»¥æ”¯æŒå–æ¶ˆåˆ é™¤ï¼‰ï¼Œç„¶åä»ç³»ç»Ÿä¸­æ°¸ä¹…åˆ é™¤ã€‚\n7. Data Size Estimation æ•°æ®å¤§å°ä¼°è®¡ Letâ€™s estimate how much data will be going into each table and how much total storage we will need for 10 years.\nè®©æˆ‘ä»¬ä¼°è®¡ä¸€ä¸‹æ¯ä¸ªè¡¨ä¸­å°†æœ‰å¤šå°‘æ•°æ®ä»¥åŠ 10 å¹´éœ€è¦å¤šå°‘æ€»å­˜å‚¨ç©ºé—´ã€‚\nUser: Assuming each â€œintâ€ and â€œdateTimeâ€ is four bytes, each row in the Userâ€™s table will be of 68 bytes:\nUserï¼šå‡è®¾æ¯ä¸ªâ€œintâ€å’Œâ€œdateTimeâ€éƒ½æ˜¯4ä¸ªå­—èŠ‚ï¼Œåˆ™Userè¡¨ä¸­çš„æ¯è¡Œå°†æœ‰68ä¸ªå­—èŠ‚ï¼š\nUserID (4 bytes) + Name (20 bytes) + Email (32 bytes) + DateOfBirth (4 bytes) + CreationDate (4 bytes) + LastLogin (4 bytes) = 68 bytes\nç”¨æˆ· IDï¼ˆ4 å­—èŠ‚ï¼‰+ å§“åï¼ˆ20 å­—èŠ‚ï¼‰+ ç”µå­é‚®ä»¶ï¼ˆ32 å­—èŠ‚ï¼‰+ å‡ºç”Ÿæ—¥æœŸï¼ˆ4 å­—èŠ‚ï¼‰+ åˆ›å»ºæ—¥æœŸï¼ˆ4 å­—èŠ‚ï¼‰+ æœ€åç™»å½•ï¼ˆ4 å­—èŠ‚ï¼‰= 68 å­—èŠ‚\nIf we have 500 million users, we will need 32GB of total storage.\nå¦‚æœæˆ‘ä»¬æœ‰ 5 äº¿ç”¨æˆ·ï¼Œæˆ‘ä»¬å°†éœ€è¦ 32GB çš„æ€»å­˜å‚¨ç©ºé—´ã€‚\n500 million * 68 ~= 32GB\nPhoto: Each row in Photoâ€™s table will be of 284 bytes:\nPhotoï¼šPhoto è¡¨ä¸­çš„æ¯ä¸€è¡Œéƒ½æ˜¯ 284 å­—èŠ‚ï¼š\nPhotoID (4 bytes) + UserID (4 bytes) + PhotoPath (256 bytes) + PhotoLatitude (4 bytes) + PhotLongitude(4 bytes) + UserLatitude (4 bytes) + UserLongitude (4 bytes) + CreationDate (4 bytes) = 284 bytes\nPhotoIDï¼ˆ4 å­—èŠ‚ï¼‰+ UserIDï¼ˆ4 å­—èŠ‚ï¼‰+ PhotoPathï¼ˆ256 å­—èŠ‚ï¼‰+ PhotoLatitudeï¼ˆ4 å­—èŠ‚ï¼‰+ PhotoLongitudeï¼ˆ4 å­—èŠ‚ï¼‰+ UserLatitudeï¼ˆ4 å­—èŠ‚ï¼‰+ UserLongitudeï¼ˆ4 å­—èŠ‚ï¼‰+ CreationDateï¼ˆ4 å­—èŠ‚ï¼‰= 284 å­—èŠ‚\nIf 2M new photos get uploaded every day, we will need 0.5GB of storage for one day:\nå¦‚æœæ¯å¤©ä¸Šä¼  200 ä¸‡å¼ æ–°ç…§ç‰‡ï¼Œæˆ‘ä»¬ä¸€å¤©éœ€è¦ 0.5GB çš„å­˜å‚¨ç©ºé—´ï¼š\n2M * 284 bytes ~= 0.5GB per day\n2M * 284 å­—èŠ‚ ~= 0.5GB æ¯å¤©\nFor 10 years we will need 1.88TB of storage.\n10 å¹´å†…æˆ‘ä»¬å°†éœ€è¦ 1.88TB çš„å­˜å‚¨ç©ºé—´ã€‚\nUserFollow: Each row in the UserFollow table will consist of 8 bytes. If we have 500 million users and on average each user follows 500 users. We would need 1.82TB of storage for the UserFollow table:\nUserFollowï¼šUserFollow è¡¨ä¸­çš„æ¯ä¸€è¡Œç”± 8 ä¸ªå­—èŠ‚ç»„æˆã€‚å¦‚æœæˆ‘ä»¬æœ‰ 5 äº¿ç”¨æˆ·ï¼Œå¹³å‡æ¯ä¸ªç”¨æˆ·å…³æ³¨ 500 ä¸ªç”¨æˆ·ã€‚æˆ‘ä»¬éœ€è¦ 1.82TB çš„å­˜å‚¨ç©ºé—´ç”¨äº UserFollow è¡¨ï¼š\n500 million users * 500 followers * 8 bytes ~= 1.82TB\n5 äº¿ç”¨æˆ· * 500 ä¸ªå…³æ³¨è€… * 8 å­—èŠ‚ ~= 1.82TB\nTotal space required for all tables for 10 years will be 3.7TB:\n10 å¹´æ‰€æœ‰è¡¨æ‰€éœ€çš„æ€»ç©ºé—´å°†ä¸º 3.7TBï¼š\n32GB + 1.88TB + 1.82TB ~= 3.7TB\n8. Component Design ç»„ä»¶è®¾è®¡ Photo uploads (or writes) can be slow as they have to go to the disk, whereas reads will be faster, especially if they are being served from cache.\nç…§ç‰‡ä¸Šä¼ ï¼ˆæˆ–å†™å…¥ï¼‰å¯èƒ½ä¼šå¾ˆæ…¢ï¼Œå› ä¸ºå®ƒä»¬å¿…é¡»å†™å…¥ç£ç›˜ï¼Œè€Œè¯»å–ä¼šæ›´å¿«ï¼Œå°¤å…¶æ˜¯ä»ç¼“å­˜æä¾›æœåŠ¡æ—¶ã€‚\nUploading users can consume all the available connections, as uploading is a slow process. This means that â€˜readsâ€™ cannot be served if the system gets busy with all the write requests. We should keep in mind that web servers have a connection limit before designing our system. If we assume that a web server can have a maximum of 500 connections at any time, then it canâ€™t have more than 500 concurrent uploads or reads. To handle this bottleneck we can split reads and writes into separate services. We will have dedicated servers for reads and different servers for writes to ensure that uploads donâ€™t hog the system.\nä¸Šä¼ ç”¨æˆ·å¯èƒ½ä¼šæ¶ˆè€—æ‰€æœ‰å¯ç”¨è¿æ¥ï¼Œå› ä¸ºä¸Šä¼ æ˜¯ä¸€ä¸ªç¼“æ…¢çš„è¿‡ç¨‹ã€‚è¿™æ„å‘³ç€å¦‚æœç³»ç»Ÿå¿™äºå¤„ç†æ‰€æœ‰å†™å…¥è¯·æ±‚ï¼Œåˆ™æ— æ³•æä¾›â€œè¯»å–â€æœåŠ¡ã€‚åœ¨è®¾è®¡æˆ‘ä»¬çš„ç³»ç»Ÿä¹‹å‰ï¼Œæˆ‘ä»¬åº”è¯¥è®°ä½ç½‘ç»œæœåŠ¡å™¨æœ‰è¿æ¥é™åˆ¶ã€‚å¦‚æœæˆ‘ä»¬å‡è®¾ä¸€ä¸ª Web æœåŠ¡å™¨åœ¨ä»»ä½•æ—¶å€™æœ€å¤šå¯ä»¥æœ‰ 500 ä¸ªè¿æ¥ï¼Œé‚£ä¹ˆå®ƒçš„å¹¶å‘ä¸Šä¼ æˆ–è¯»å–å°±ä¸èƒ½è¶…è¿‡ 500 ä¸ªã€‚ä¸ºäº†è§£å†³è¿™ä¸ªç“¶é¢ˆï¼Œæˆ‘ä»¬å¯ä»¥å°†è¯»å–å’Œå†™å…¥æ‹†åˆ†ä¸ºå•ç‹¬çš„æœåŠ¡ã€‚æˆ‘ä»¬å°†æ‹¥æœ‰ä¸“é—¨çš„è¯»å–æœåŠ¡å™¨å’Œä¸åŒçš„å†™å…¥æœåŠ¡å™¨ï¼Œä»¥ç¡®ä¿ä¸Šä¼ ä¸ä¼šå ç”¨ç³»ç»Ÿã€‚\nSeparating photosâ€™ read and write requests will also allow us to scale and optimize each of these operations independently.\nåˆ†ç¦»ç…§ç‰‡çš„è¯»å–å’Œå†™å…¥è¯·æ±‚è¿˜å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿç‹¬ç«‹æ‰©å±•å’Œä¼˜åŒ–æ¯ä¸ªæ“ä½œã€‚\n9. Reliability and Redundancy å¯é æ€§å’Œå†—ä½™æ€§ Losing files is not an option for our service. Therefore, we will store multiple copies of each file so that if one storage server dies we can retrieve the photo from the other copy present on a different storage server.\næˆ‘ä»¬çš„æœåŠ¡ä¸å…è®¸ä¸¢å¤±æ–‡ä»¶ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†å­˜å‚¨æ¯ä¸ªæ–‡ä»¶çš„å¤šä¸ªå‰¯æœ¬ï¼Œä»¥ä¾¿å¦‚æœä¸€ä¸ªå­˜å‚¨æœåŠ¡å™¨å‡ºç°æ•…éšœï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸åŒå­˜å‚¨æœåŠ¡å™¨ä¸Šå­˜åœ¨çš„å¦ä¸€ä¸ªå‰¯æœ¬ä¸­æ£€ç´¢ç…§ç‰‡ã€‚\nThis same principle also applies to other components of the system. If we want to have high availability of the system, we need to have multiple replicas of services running in the system, so that if a few services die down the system still remains available and running. Redundancy removes the single point of failure in the system.\nåŒæ ·çš„åŸç†ä¹Ÿé€‚ç”¨äºç³»ç»Ÿçš„å…¶ä»–ç»„ä»¶ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ›ç³»ç»Ÿå…·æœ‰é«˜å¯ç”¨æ€§ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç³»ç»Ÿä¸­è¿è¡Œå¤šä¸ªæœåŠ¡å‰¯æœ¬ï¼Œä»¥ä¾¿åœ¨å°‘æ•°æœåŠ¡åœæ­¢è¿è¡Œæ—¶ç³»ç»Ÿä»ç„¶ä¿æŒå¯ç”¨å¹¶è¿è¡Œã€‚å†—ä½™æ¶ˆé™¤äº†ç³»ç»Ÿä¸­çš„å•ç‚¹æ•…éšœã€‚\nIf only one instance of a service is required to run at any point, we can run a redundant secondary copy of the service that is not serving any traffic, but it can take control after the failover when primary has a problem.\nå¦‚æœæŸä¸ªæœåŠ¡åœ¨ä»»ä½•æ—¶å€™åªéœ€è¦è¿è¡Œä¸€ä¸ªå®ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œè¯¥æœåŠ¡çš„å†—ä½™è¾…åŠ©å‰¯æœ¬ï¼Œè¯¥å‰¯æœ¬ä¸æä¾›ä»»ä½•æµé‡ï¼Œä½†å½“ä¸»æœåŠ¡å™¨å‡ºç°é—®é¢˜æ—¶ï¼Œå®ƒå¯ä»¥åœ¨æ•…éšœè½¬ç§»åæ¥ç®¡æ§åˆ¶æƒã€‚\nCreating redundancy in a system can remove single points of failure and provide a backup or spare functionality if needed in a crisis. For example, if there are two instances of the same service running in production and one fails or degrades, the system can failover to the healthy copy. Failover can happen automatically or require manual intervention.\nåœ¨ç³»ç»Ÿä¸­åˆ›å»ºå†—ä½™å¯ä»¥æ¶ˆé™¤å•ç‚¹æ•…éšœï¼Œå¹¶åœ¨å±æœºä¸­éœ€è¦æ—¶æä¾›å¤‡ä»½æˆ–å¤‡ç”¨åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåŒä¸€æœåŠ¡æœ‰ä¸¤ä¸ªå®ä¾‹åœ¨ç”Ÿäº§ä¸­è¿è¡Œï¼Œå…¶ä¸­ä¸€ä¸ªå®ä¾‹å‡ºç°æ•…éšœæˆ–æ€§èƒ½ä¸‹é™ï¼Œç³»ç»Ÿå¯ä»¥æ•…éšœè½¬ç§»åˆ°æ­£å¸¸å‰¯æœ¬ã€‚æ•…éšœè½¬ç§»å¯ä»¥è‡ªåŠ¨å‘ç”Ÿæˆ–éœ€è¦æ‰‹åŠ¨å¹²é¢„ã€‚\n10. Data Sharding æ•°æ®åˆ†ç‰‡ Letâ€™s discuss different schemes for metadata sharding:\nè®©æˆ‘ä»¬è®¨è®ºå…ƒæ•°æ®åˆ†ç‰‡çš„ä¸åŒæ–¹æ¡ˆï¼š\na. Partitioning based on UserID Letâ€™s assume we shard based on the â€˜UserIDâ€™ so that we can keep all photos of a user on the same shard. If one DB shard is 1TB, we will need four shards to store 3.7TB of data. Letâ€™s assume for better performance and scalability we keep 10 shards.\na. åŸºäº UserID çš„åˆ†åŒº å‡è®¾æˆ‘ä»¬åŸºäºâ€œUserIDâ€è¿›è¡Œåˆ†ç‰‡ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥å°†ç”¨æˆ·çš„æ‰€æœ‰ç…§ç‰‡ä¿ç•™åœ¨åŒä¸€ä¸ªåˆ†ç‰‡ä¸Šã€‚å¦‚æœä¸€ä¸ªæ•°æ®åº“åˆ†ç‰‡ä¸º 1TBï¼Œæˆ‘ä»¬å°†éœ€è¦å››ä¸ªåˆ†ç‰‡æ¥å­˜å‚¨ 3.7TB çš„æ•°æ®ã€‚å‡è®¾ä¸ºäº†è·å¾—æ›´å¥½çš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§ï¼Œæˆ‘ä»¬ä¿ç•™ 10 ä¸ªåˆ†ç‰‡ã€‚\nSo weâ€™ll find the shard number by UserID % 10 and then store the data there. To uniquely identify any photo in our system, we can append shard number with each PhotoID.\nå› æ­¤ï¼Œæˆ‘ä»¬å°†é€šè¿‡ UserID % 10 æ‰¾åˆ°åˆ†ç‰‡ç¼–å·ï¼Œç„¶åå°†æ•°æ®å­˜å‚¨åœ¨é‚£é‡Œã€‚ä¸ºäº†å”¯ä¸€åœ°æ ‡è¯†æˆ‘ä»¬ç³»ç»Ÿä¸­çš„ä»»ä½•ç…§ç‰‡ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ª PhotoID é™„åŠ åˆ†ç‰‡ç¼–å·ã€‚\nHow can we generate PhotoIDs? Each DB shard can have its own auto-increment sequence for PhotoIDs and since we will append ShardID with each PhotoID, it will make it unique throughout our system.\næˆ‘ä»¬å¦‚ä½•ç”Ÿæˆ PhotoIDï¼Ÿæ¯ä¸ªæ•°æ®åº“åˆ†ç‰‡éƒ½å¯ä»¥æœ‰è‡ªå·±çš„ PhotoID è‡ªåŠ¨é€’å¢åºåˆ—ï¼Œå¹¶ä¸”ç”±äºæˆ‘ä»¬å°†åœ¨æ¯ä¸ª PhotoID åé™„åŠ  ShardIDï¼Œè¿™å°†ä½¿å…¶åœ¨æ•´ä¸ªç³»ç»Ÿä¸­æ˜¯å”¯ä¸€çš„ã€‚\nWhat are the different issues with this partitioning scheme?\nè¿™ç§åˆ†åŒºæ–¹æ¡ˆæœ‰å“ªäº›ä¸åŒçš„é—®é¢˜ï¼Ÿ\nHow would we handle hot users? Several people follow such hot users and a lot of other people see any photo they upload.\næˆ‘ä»¬å¦‚ä½•å¤„ç†çƒ­é—¨ç”¨æˆ·ï¼Ÿæœ‰å‡ ä¸ªäººå…³æ³¨è¿™äº›çƒ­é—¨ç”¨æˆ·ï¼Œå¾ˆå¤šå…¶ä»–äººéƒ½ä¼šçœ‹åˆ°ä»–ä»¬ä¸Šä¼ çš„ä»»ä½•ç…§ç‰‡ã€‚\nSome users will have a lot of photos compared to others, thus making a non-uniform distribution of storage.\nä¸å…¶ä»–ç”¨æˆ·ç›¸æ¯”ï¼ŒæŸäº›ç”¨æˆ·ä¼šæ‹¥æœ‰å¤§é‡ç…§ç‰‡ï¼Œä»è€Œå¯¼è‡´å­˜å‚¨åˆ†å¸ƒä¸å‡åŒ€ã€‚\nWhat if we cannot store all pictures of a user on one shard? If we distribute photos of a user onto multiple shards will it cause higher latencies?\nå¦‚æœæˆ‘ä»¬æ— æ³•å°†ç”¨æˆ·çš„æ‰€æœ‰å›¾ç‰‡å­˜å‚¨åœ¨ä¸€ä¸ªåˆ†ç‰‡ä¸Šæ€ä¹ˆåŠï¼Ÿå¦‚æœæˆ‘ä»¬å°†ç”¨æˆ·çš„ç…§ç‰‡åˆ†å‘åˆ°å¤šä¸ªåˆ†ç‰‡ä¸Šä¼šå¯¼è‡´æ›´é«˜çš„å»¶è¿Ÿå—ï¼Ÿ\nStoring all photos of a user on one shard can cause issues like unavailability of all of the userâ€™s data if that shard is down or higher latency if it is serving high load etc.\nå°†ç”¨æˆ·çš„æ‰€æœ‰ç…§ç‰‡å­˜å‚¨åœ¨ä¸€ä¸ªåˆ†ç‰‡ä¸Šå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚ï¼Œå¦‚æœè¯¥åˆ†ç‰‡å·²å…³é—­ï¼Œåˆ™æ‰€æœ‰ç”¨æˆ·çš„æ•°æ®å°†ä¸å¯ç”¨ï¼›å¦‚æœè¯¥åˆ†ç‰‡æä¾›é«˜è´Ÿè½½æœåŠ¡ï¼Œåˆ™å»¶è¿Ÿä¼šæ›´é«˜ç­‰ã€‚\nb. Partitioning based on PhotoID If we can generate unique PhotoIDs first and then find a shard number through â€œPhotoID % 10â€, the above problems will have been solved. We would not need to append ShardID with PhotoID in this case as PhotoID will itself be unique throughout the system.\nb.åŸºäºPhotoIDçš„åˆ†åŒºå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿå…ˆç”Ÿæˆå”¯ä¸€çš„PhotoIDï¼Œç„¶åé€šè¿‡â€œPhotoID % 10â€æ‰¾åˆ°åˆ†ç‰‡ç¼–å·ï¼Œé‚£ä¹ˆä¸Šè¿°é—®é¢˜å°±è¿åˆƒè€Œè§£äº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸éœ€è¦å°† ShardID ä¸ PhotoID ä¸€èµ·é™„åŠ ï¼Œå› ä¸º PhotoID æœ¬èº«åœ¨æ•´ä¸ªç³»ç»Ÿä¸­æ˜¯å”¯ä¸€çš„ã€‚\nHow can we generate PhotoIDs? Here we cannot have an auto-incrementing sequence in each shard to define PhotoID because we need to know PhotoID first to find the shard where it will be stored. One solution could be that we dedicate a separate database instance to generate auto-incrementing IDs. If our PhotoID can fit into 64 bits, we can define a table containing only a 64 bit ID field. So whenever we would like to add a photo in our system, we can insert a new row in this table and take that ID to be our PhotoID of the new photo.\næˆ‘ä»¬å¦‚ä½•ç”Ÿæˆ PhotoIDï¼Ÿè¿™é‡Œæˆ‘ä»¬ä¸èƒ½åœ¨æ¯ä¸ªåˆ†ç‰‡ä¸­ä½¿ç”¨è‡ªåŠ¨é€’å¢åºåˆ—æ¥å®šä¹‰ PhotoIDï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦é¦–å…ˆçŸ¥é“ PhotoID æ‰èƒ½æ‰¾åˆ°å­˜å‚¨å®ƒçš„åˆ†ç‰‡ã€‚ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯æˆ‘ä»¬ä¸“é—¨ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„æ•°æ®åº“å®ä¾‹æ¥ç”Ÿæˆè‡ªåŠ¨é€’å¢çš„ IDã€‚å¦‚æœæˆ‘ä»¬çš„ PhotoID å¯ä»¥å®¹çº³ 64 ä½ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®šä¹‰ä¸€ä¸ªä»…åŒ…å« 64 ä½ ID å­—æ®µçš„è¡¨ã€‚å› æ­¤ï¼Œæ¯å½“æˆ‘ä»¬æƒ³åœ¨ç³»ç»Ÿä¸­æ·»åŠ ç…§ç‰‡æ—¶ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥åœ¨æ­¤è¡¨ä¸­æ’å…¥ä¸€ä¸ªæ–°è¡Œï¼Œå¹¶å°†è¯¥ ID ä½œä¸ºæ–°ç…§ç‰‡çš„ PhotoIDã€‚\nWouldnâ€™t this key generating DB be a single point of failure? Yes, it would be. A workaround for that could be defining two such databases with one generating even numbered IDs and the other odd numbered. For the MySQL, the following script can define such sequences:\nè¿™ä¸ªå¯†é’¥ç”Ÿæˆæ•°æ®åº“ä¸ä¼šå‡ºç°å•ç‚¹æ•…éšœå—ï¼Ÿæ˜¯çš„ï¼Œä¼šçš„ã€‚ä¸€ç§è§£å†³æ–¹æ³•æ˜¯å®šä¹‰ä¸¤ä¸ªè¿™æ ·çš„æ•°æ®åº“ï¼Œå…¶ä¸­ä¸€ä¸ªç”Ÿæˆå¶æ•°ç¼–å·çš„ IDï¼Œå¦ä¸€ä¸ªç”Ÿæˆå¥‡æ•°ç¼–å·çš„ IDã€‚å¯¹äºMySQLï¼Œä»¥ä¸‹è„šæœ¬å¯ä»¥å®šä¹‰è¿™æ ·çš„åºåˆ—ï¼š\nKeyGeneratingServer1: auto-increment-increment = 2 auto-increment-offset = 1 KeyGeneratingServer2: auto-increment-increment = 2 auto-increment-offset = 2 We can put a load balancer in front of both of these databases to round robin between them and to deal with downtime. Both these servers could be out of sync with one generating more keys than the other, but this will not cause any issue in our system. We can extend this design by defining separate ID tables for Users, Photo-Comments, or other objects present in our system.\næˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸¤ä¸ªæ•°æ®åº“å‰é¢æ”¾ç½®ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨ï¼Œä»¥åœ¨å®ƒä»¬ä¹‹é—´è¿›è¡Œå¾ªç¯å¹¶å¤„ç†åœæœºæ—¶é—´ã€‚è¿™ä¸¤å°æœåŠ¡å™¨å¯èƒ½ä¼šä¸åŒæ­¥ï¼Œå…¶ä¸­ä¸€å°ç”Ÿæˆçš„å¯†é’¥å¤šäºå¦ä¸€å°ï¼Œä½†è¿™ä¸ä¼šåœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸­é€ æˆä»»ä½•é—®é¢˜ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸ºç”¨æˆ·ã€ç…§ç‰‡è¯„è®ºæˆ–ç³»ç»Ÿä¸­å­˜åœ¨çš„å…¶ä»–å¯¹è±¡å®šä¹‰å•ç‹¬çš„ ID è¡¨æ¥æ‰©å±•æ­¤è®¾è®¡ã€‚\nAlternately, we can implement a â€˜keyâ€™ generation scheme similar to what we have discussed in Designing a URL Shortening service like TinyURL.\næˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªâ€œå¯†é’¥â€ç”Ÿæˆæ–¹æ¡ˆï¼Œç±»ä¼¼äºæˆ‘ä»¬åœ¨è®¾è®¡ç±»ä¼¼ TinyURL çš„ URL ç¼©çŸ­æœåŠ¡ä¸­è®¨è®ºçš„æ–¹æ¡ˆã€‚\nHow can we plan for the future growth of our system? We can have a large number of logical partitions to accommodate future data growth, such that in the beginning, multiple logical partitions reside on a single physical database server. Since each database server can have multiple database instances on it, we can have separate databases for each logical partition on any server. So whenever we feel that a particular database server has a lot of data, we can migrate some logical partitions from it to another server. We can maintain a config file (or a separate database) that can map our logical partitions to database servers; this will enable us to move partitions around easily. Whenever we want to move a partition, we only have to update the config file to announce the change.\næˆ‘ä»¬å¦‚ä½•è§„åˆ’ç³»ç»Ÿçš„æœªæ¥å‘å±•ï¼Ÿæˆ‘ä»¬å¯ä»¥æ‹¥æœ‰å¤§é‡çš„é€»è¾‘åˆ†åŒºæ¥é€‚åº”æœªæ¥çš„æ•°æ®å¢é•¿ï¼Œè¿™æ ·åœ¨å¼€å§‹æ—¶ï¼Œå¤šä¸ªé€»è¾‘åˆ†åŒºé©»ç•™åœ¨å•ä¸ªç‰©ç†æ•°æ®åº“æœåŠ¡å™¨ä¸Šã€‚ç”±äºæ¯ä¸ªæ•°æ®åº“æœåŠ¡å™¨ä¸Šå¯ä»¥æœ‰å¤šä¸ªæ•°æ®åº“å®ä¾‹ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä¸ºä»»ä½•æœåŠ¡å™¨ä¸Šçš„æ¯ä¸ªé€»è¾‘åˆ†åŒºæ‹¥æœ‰å•ç‹¬çš„æ•°æ®åº“ã€‚å› æ­¤ï¼Œæ¯å½“æˆ‘ä»¬æ„Ÿè§‰æŸä¸ªç‰¹å®šçš„æ•°æ®åº“æœåŠ¡å™¨æœ‰å¤§é‡æ•°æ®æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å…¶ä¸­çš„ä¸€äº›é€»è¾‘åˆ†åŒºè¿ç§»åˆ°å¦ä¸€å°æœåŠ¡å™¨ä¸Šã€‚æˆ‘ä»¬å¯ä»¥ç»´æŠ¤ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼ˆæˆ–ä¸€ä¸ªå•ç‹¬çš„æ•°æ®åº“ï¼‰ï¼Œå®ƒå¯ä»¥å°†æˆ‘ä»¬çš„é€»è¾‘åˆ†åŒºæ˜ å°„åˆ°æ•°æ®åº“æœåŠ¡å™¨ï¼›è¿™å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿè½»æ¾ç§»åŠ¨åˆ†åŒºã€‚æ¯å½“æˆ‘ä»¬æƒ³è¦ç§»åŠ¨åˆ†åŒºæ—¶ï¼Œæˆ‘ä»¬åªéœ€æ›´æ–°é…ç½®æ–‡ä»¶å³å¯å®£å¸ƒæ›´æ”¹ã€‚\n11. Ranking and News Feed Generation æ’åå’ŒåŠ¨æ€æ¶ˆæ¯ç”Ÿæˆ To create the News Feed for any given user, we need to fetch the latest, most popular and relevant photos of the people the user follows.\nè¦ä¸ºä»»ä½•ç»™å®šç”¨æˆ·åˆ›å»ºæ–°é—»æºï¼Œæˆ‘ä»¬éœ€è¦è·å–ç”¨æˆ·å…³æ³¨çš„äººçš„æœ€æ–°ã€æœ€å—æ¬¢è¿å’Œç›¸å…³çš„ç…§ç‰‡ã€‚\nFor simplicity, letâ€™s assume we need to fetch top 100 photos for a userâ€™s News Feed. Our application server will first get a list of people the user follows and then fetch metadata info of latest 100 photos from each user. In the final step, the server will submit all these photos to our ranking algorithm which will determine the top 100 photos (based on recency, likeness, etc.) and return them to the user. A possible problem with this approach would be higher latency as we have to query multiple tables and perform sorting/merging/ranking on the results. To improve the efficiency, we can pre-generate the News Feed and store it in a separate table.\nä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å‡è®¾æˆ‘ä»¬éœ€è¦è·å–ç”¨æˆ·åŠ¨æ€æ¶ˆæ¯ä¸­çš„å‰ 100 å¼ ç…§ç‰‡ã€‚æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæœåŠ¡å™¨å°†é¦–å…ˆè·å–ç”¨æˆ·å…³æ³¨çš„äººå‘˜åˆ—è¡¨ï¼Œç„¶åä»æ¯ä¸ªç”¨æˆ·è·å–æœ€æ–° 100 å¼ ç…§ç‰‡çš„å…ƒæ•°æ®ä¿¡æ¯ã€‚åœ¨æœ€åä¸€æ­¥ä¸­ï¼ŒæœåŠ¡å™¨ä¼šå°†æ‰€æœ‰è¿™äº›ç…§ç‰‡æäº¤ç»™æˆ‘ä»¬çš„æ’åç®—æ³•ï¼Œè¯¥ç®—æ³•å°†ç¡®å®šå‰ 100 å¼ ç…§ç‰‡ï¼ˆåŸºäºæ–°è¿‘åº¦ã€ç›¸ä¼¼åº¦ç­‰ï¼‰å¹¶å°†å…¶è¿”å›ç»™ç”¨æˆ·ã€‚è¿™ç§æ–¹æ³•çš„ä¸€ä¸ªå¯èƒ½çš„é—®é¢˜æ˜¯æ›´é«˜çš„å»¶è¿Ÿï¼Œå› ä¸ºæˆ‘ä»¬å¿…é¡»æŸ¥è¯¢å¤šä¸ªè¡¨å¹¶å¯¹ç»“æœæ‰§è¡Œæ’åº/åˆå¹¶/æ’åã€‚ä¸ºäº†æé«˜æ•ˆç‡ï¼Œæˆ‘ä»¬å¯ä»¥é¢„å…ˆç”ŸæˆNews Feedï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨å•ç‹¬çš„è¡¨ä¸­ã€‚\nPre-generating the News Feed: We can have dedicated servers that are continuously generating usersâ€™ News Feeds and storing them in a â€˜UserNewsFeedâ€™ table. So whenever any user needs the latest photos for their News Feed, we will simply query this table and return the results to the user.\né¢„ç”Ÿæˆæ–°é—»æºï¼šæˆ‘ä»¬å¯ä»¥æ‹¥æœ‰ä¸“ç”¨æœåŠ¡å™¨ï¼Œä¸æ–­ç”Ÿæˆç”¨æˆ·çš„æ–°é—»æºå¹¶å°†å…¶å­˜å‚¨åœ¨â€œUserNewsFeedâ€è¡¨ä¸­ã€‚å› æ­¤ï¼Œæ¯å½“ä»»ä½•ç”¨æˆ·éœ€è¦ä¸ºå…¶åŠ¨æ€æ¶ˆæ¯æä¾›æœ€æ–°ç…§ç‰‡æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šç®€å•åœ°æŸ¥è¯¢æ­¤è¡¨å¹¶å°†ç»“æœè¿”å›ç»™ç”¨æˆ·ã€‚\nWhenever these servers need to generate the News Feed of a user, they will first query the UserNewsFeed table to find the last time the News Feed was generated for that user. Then, new News Feed data will be generated from that time onwards (following the steps mentioned above).\næ¯å½“è¿™äº›æœåŠ¡å™¨éœ€è¦ç”Ÿæˆç”¨æˆ·çš„æ–°é—»æºæ—¶ï¼Œå®ƒä»¬å°†é¦–å…ˆæŸ¥è¯¢ UserNewsFeed è¡¨ä»¥æŸ¥æ‰¾ä¸Šæ¬¡ä¸ºè¯¥ç”¨æˆ·ç”Ÿæˆæ–°é—»æºçš„æ—¶é—´ã€‚ç„¶åï¼Œå°†ä»é‚£æ—¶èµ·ç”Ÿæˆæ–°çš„æ–°é—»æºæ•°æ®ï¼ˆæŒ‰ç…§ä¸Šè¿°æ­¥éª¤ï¼‰ã€‚\nWhat are the different approaches for sending News Feed contents to the users? å‘ç”¨æˆ·å‘é€åŠ¨æ€æ¶ˆæ¯å†…å®¹æœ‰å“ªäº›ä¸åŒçš„æ–¹æ³•ï¼Ÿ\n1. Pull: Clients can pull the News Feed contents from the server on a regular basis or manually whenever they need it. Possible problems with this approach are a) New data might not be shown to the users until clients issue a pull request b) Most of the time pull requests will result in an empty response if there is no new data.\n1.æ‹‰å–ï¼šå®¢æˆ·ç«¯å¯ä»¥å®šæœŸæˆ–åœ¨éœ€è¦æ—¶æ‰‹åŠ¨ä»æœåŠ¡å™¨æ‹‰å–News Feedå†…å®¹ã€‚è¿™ç§æ–¹æ³•å¯èƒ½å­˜åœ¨çš„é—®é¢˜æ˜¯ï¼šaï¼‰åœ¨å®¢æˆ·ç«¯å‘å‡ºæ‹‰å–è¯·æ±‚ä¹‹å‰ï¼Œæ–°æ•°æ®å¯èƒ½ä¸ä¼šæ˜¾ç¤ºç»™ç”¨æˆ·ã€‚bï¼‰å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰æ–°æ•°æ®ï¼Œæ‹‰å–è¯·æ±‚å°†å¯¼è‡´ç©ºå“åº”ã€‚\n2. Push: Servers can push new data to the users as soon as it is available. To efficiently manage this, users have to maintain a Long Poll request with the server for receiving the updates. A possible problem with this approach is, a user who follows a lot of people or a celebrity user who has millions of followers; in this case, the server has to push updates quite frequently.\n2.æ¨é€ï¼šæœåŠ¡å™¨å¯ä»¥å°†æ–°æ•°æ®æ¨é€ç»™ç”¨æˆ·ã€‚ä¸ºäº†æœ‰æ•ˆåœ°ç®¡ç†è¿™ä¸€ç‚¹ï¼Œç”¨æˆ·å¿…é¡»ä¸æœåŠ¡å™¨ä¿æŒé•¿è½®è¯¢è¯·æ±‚ä»¥æ¥æ”¶æ›´æ–°ã€‚è¿™ç§æ–¹æ³•å¯èƒ½å­˜åœ¨çš„é—®é¢˜æ˜¯ï¼Œå…³æ³¨å¾ˆå¤šäººçš„ç”¨æˆ·æˆ–æ‹¥æœ‰æ•°ç™¾ä¸‡å…³æ³¨è€…çš„åäººç”¨æˆ·ï¼›åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨å¿…é¡»éå¸¸é¢‘ç¹åœ°æ¨é€æ›´æ–°ã€‚\n3. Hybrid: We can adopt a hybrid approach. We can move all the users who have a high number of follows to a pull-based model and only push data to those users who have a few hundred (or thousand) follows. Another approach could be that the server pushes updates to all the users not more than a certain frequency, letting users with a lot of follows/updates to regularly pull data.\n3.æ··åˆï¼šæˆ‘ä»¬å¯ä»¥é‡‡ç”¨æ··åˆçš„æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰æ‹¥æœ‰å¤§é‡å…³æ³¨çš„ç”¨æˆ·è½¬ç§»åˆ°åŸºäºæ‹‰åŠ¨çš„æ¨¡å‹ï¼Œå¹¶ä¸”åªå°†æ•°æ®æ¨é€ç»™é‚£äº›æ‹¥æœ‰æ•°ç™¾ï¼ˆæˆ–æ•°åƒï¼‰å…³æ³¨çš„ç”¨æˆ·ã€‚å¦ä¸€ç§æ–¹æ³•å¯èƒ½æ˜¯æœåŠ¡å™¨å‘æ‰€æœ‰ç”¨æˆ·æ¨é€æ›´æ–°çš„é¢‘ç‡ä¸è¶…è¿‡ä¸€å®šé¢‘ç‡ï¼Œè®©å…³æ³¨/æ›´æ–°è¾ƒå¤šçš„ç”¨æˆ·å®šæœŸæ‹‰å–æ•°æ®ã€‚\nFor a detailed discussion about News Feed generation, take a look at Designing Facebookâ€™s Newsfeed.\næœ‰å…³ News Feed ç”Ÿæˆçš„è¯¦ç»†è®¨è®ºï¼Œè¯·æŸ¥çœ‹è®¾è®¡ Facebook çš„ Newsfeedã€‚\n12. News Feed Creation with Sharded Data ä½¿ç”¨åˆ†ç‰‡æ•°æ®åˆ›å»ºæ–°é—»æº One of the most important requirement to create the News Feed for any given user is to fetch the latest photos from all people the user follows. For this, we need to have a mechanism to sort photos on their time of creation. To efficiently do this, we can make photo creation time part of the PhotoID. As we will have a primary index on PhotoID, it will be quite quick to find the latest PhotoIDs.\nä¸ºä»»ä½•ç»™å®šç”¨æˆ·åˆ›å»ºæ–°é—»æºçš„æœ€é‡è¦è¦æ±‚ä¹‹ä¸€æ˜¯è·å–è¯¥ç”¨æˆ·å…³æ³¨çš„æ‰€æœ‰äººçš„æœ€æ–°ç…§ç‰‡ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€ç§æœºåˆ¶æ¥æŒ‰ç…§ç‰‡çš„åˆ›å»ºæ—¶é—´å¯¹å…¶è¿›è¡Œæ’åºã€‚ä¸ºäº†æœ‰æ•ˆåœ°åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç…§ç‰‡åˆ›å»ºæ—¶é—´ä½œä¸º PhotoID çš„ä¸€éƒ¨åˆ†ã€‚ç”±äºæˆ‘ä»¬å°†åœ¨ PhotoID ä¸Šå»ºç«‹ä¸»ç´¢å¼•ï¼Œå› æ­¤å¯ä»¥å¾ˆå¿«æ‰¾åˆ°æœ€æ–°çš„ PhotoIDã€‚\nWe can use epoch time for this. Letâ€™s say our PhotoID will have two parts; the first part will be representing epoch time and the second part will be an auto-incrementing sequence. So to make a new PhotoID, we can take the current epoch time and append an auto-incrementing ID from our key- generating DB. We can figure out shard number from this PhotoID ( PhotoID % 10) and store the photo there.\næˆ‘ä»¬å¯ä»¥ä¸ºæ­¤ä½¿ç”¨çºªå…ƒæ—¶é—´ã€‚å‡è®¾æˆ‘ä»¬çš„ PhotoID å°†ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šç¬¬ä¸€éƒ¨åˆ†å°†è¡¨ç¤ºçºªå…ƒæ—¶é—´ï¼Œç¬¬äºŒéƒ¨åˆ†å°†æ˜¯è‡ªåŠ¨é€’å¢åºåˆ—ã€‚å› æ­¤ï¼Œä¸ºäº†åˆ›å»ºä¸€ä¸ªæ–°çš„ PhotoIDï¼Œæˆ‘ä»¬å¯ä»¥è·å–å½“å‰çºªå…ƒæ—¶é—´å¹¶ä»æˆ‘ä»¬çš„å¯†é’¥ç”Ÿæˆæ•°æ®åº“ä¸­é™„åŠ ä¸€ä¸ªè‡ªåŠ¨é€’å¢çš„ IDã€‚æˆ‘ä»¬å¯ä»¥ä»è¿™ä¸ª PhotoID ( PhotoID % 10) ä¸­æ‰¾å‡ºåˆ†ç‰‡ç¼–å·å¹¶å°†ç…§ç‰‡å­˜å‚¨åœ¨é‚£é‡Œã€‚\nWhat could be the size of our PhotoID? Letâ€™s say our epoch time starts today, how many bits we would need to store the number of seconds for next 50 years?\næˆ‘ä»¬çš„ PhotoID çš„å¤§å°æ˜¯å¤šå°‘ï¼Ÿå‡è®¾æˆ‘ä»¬çš„çºªå…ƒæ—¶é—´ä»ä»Šå¤©å¼€å§‹ï¼Œæˆ‘ä»¬éœ€è¦å¤šå°‘ä½æ¥å­˜å‚¨æœªæ¥ 50 å¹´çš„ç§’æ•°ï¼Ÿ\n86400 sec/day * 365 (days a year) * 50 (years) =\u0026gt; 1.6 billion seconds\n86400 ç§’/å¤© * 365ï¼ˆä¸€å¹´å¤©ï¼‰* 50ï¼ˆå¹´ï¼‰=\u0026gt; 16 äº¿ç§’\nWe would need 31 bits to store this number. Since on the average, we are expecting 23 new photos per second; we can allocate 9 bits to store auto incremented sequence. So every second we can store (2^9 =\u0026gt; 512) new photos. We can reset our auto incrementing sequence every second.\næˆ‘ä»¬éœ€è¦ 31 ä½æ¥å­˜å‚¨è¿™ä¸ªæ•°å­—ã€‚å› ä¸ºå¹³å‡è€Œè¨€ï¼Œæˆ‘ä»¬é¢„è®¡æ¯ç§’ 23 å¼ æ–°ç…§ç‰‡ï¼›æˆ‘ä»¬å¯ä»¥åˆ†é…9ä½æ¥å­˜å‚¨è‡ªåŠ¨é€’å¢åºåˆ—ã€‚æ‰€ä»¥æ¯ä¸€ç§’æˆ‘ä»¬éƒ½å¯ä»¥å­˜å‚¨ (2^9 =\u0026gt; 512) å¼ æ–°ç…§ç‰‡ã€‚æˆ‘ä»¬å¯ä»¥æ¯ç§’é‡ç½®è‡ªåŠ¨é€’å¢åºåˆ—ã€‚\nWe will discuss more details about this technique under â€˜Data Shardingâ€™ in Designing Twitter.\næˆ‘ä»¬å°†åœ¨è®¾è®¡ Twitter ä¸­çš„â€œæ•°æ®åˆ†ç‰‡â€éƒ¨åˆ†è®¨è®ºæœ‰å…³æ­¤æŠ€æœ¯çš„æ›´å¤šç»†èŠ‚ã€‚\n13. Cache and Load balancing ç¼“å­˜å’Œè´Ÿè½½å¹³è¡¡ Our service would need a massive-scale photo delivery system to serve the globally distributed users. Our service should push its content closer to the user using a large number of geographically distributed photo cache servers and use CDNs (for details see Caching).\næˆ‘ä»¬çš„æœåŠ¡éœ€è¦ä¸€ä¸ªå¤§è§„æ¨¡çš„ç…§ç‰‡ä¼ è¾“ç³»ç»Ÿæ¥ä¸ºå…¨çƒåˆ†å¸ƒçš„ç”¨æˆ·æä¾›æœåŠ¡ã€‚æˆ‘ä»¬çš„æœåŠ¡åº”è¯¥ä½¿ç”¨å¤§é‡åœ°ç†åˆ†å¸ƒçš„ç…§ç‰‡ç¼“å­˜æœåŠ¡å™¨å¹¶ä½¿ç”¨ CDNï¼ˆæœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ç¼“å­˜ï¼‰å°†å…¶å†…å®¹æ¨é€åˆ°æ›´æ¥è¿‘ç”¨æˆ·çš„ä½ç½®ã€‚\nWe can introduce a cache for metadata servers to cache hot database rows. We can use Memcache to cache the data and Application servers before hitting database can quickly check if the cache has desired rows. Least Recently Used (LRU) can be a reasonable cache eviction policy for our system. Under this policy, we discard the least recently viewed row first.\næˆ‘ä»¬å¯ä»¥ä¸ºå…ƒæ•°æ®æœåŠ¡å™¨å¼•å…¥ç¼“å­˜æ¥ç¼“å­˜çƒ­æ•°æ®åº“è¡Œã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Memcache æ¥ç¼“å­˜æ•°æ®ï¼Œåº”ç”¨ç¨‹åºæœåŠ¡å™¨åœ¨è®¿é—®æ•°æ®åº“ä¹‹å‰å¯ä»¥å¿«é€Ÿæ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦æœ‰æ‰€éœ€çš„è¡Œã€‚æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLRUï¼‰å¯¹äºæˆ‘ä»¬çš„ç³»ç»Ÿæ¥è¯´æ˜¯ä¸€ä¸ªåˆç†çš„ç¼“å­˜é©±é€ç­–ç•¥ã€‚æ ¹æ®æ­¤ç­–ç•¥ï¼Œæˆ‘ä»¬é¦–å…ˆä¸¢å¼ƒæœ€è¿‘æœ€å°‘æŸ¥çœ‹çš„è¡Œã€‚\nHow can we build more intelligent cache? If we go with 80-20 rule, i.e., 20% of daily read volume for photos is generating 80% of traffic which means that certain photos are so popular that the majority of people read them. This dictates that we can try caching 20% of daily read volume of photos and metadata.\nå¦‚ä½•æ„å»ºæ›´åŠ æ™ºèƒ½çš„ç¼“å­˜ï¼Ÿå¦‚æœæˆ‘ä»¬éµå¾ª 80-20 è§„åˆ™ï¼Œå³æ¯æ—¥ç…§ç‰‡é˜…è¯»é‡çš„ 20% ä¼šäº§ç”Ÿ 80% çš„æµé‡ï¼Œè¿™æ„å‘³ç€æŸäº›ç…§ç‰‡éå¸¸å—æ¬¢è¿ï¼Œä»¥è‡³äºå¤§å¤šæ•°äººéƒ½ä¼šé˜…è¯»å®ƒä»¬ã€‚è¿™è¡¨æ˜æˆ‘ä»¬å¯ä»¥å°è¯•ç¼“å­˜æ¯æ—¥è¯»å–é‡çš„ 20% çš„ç…§ç‰‡å’Œå…ƒæ•°æ®ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/11/24/designing-instagram/","summary":"è¿™æ˜¯ä¸€ç¯‡åŒè¯­ç¿»è¯‘çš„æ–‡ç« ï¼ŒåŸæ–‡å‡ºè‡ª grok_system_design_interview.pdf çš„ä¸€ç¯‡æ–‡ç« ã€ŠDesigning Instagramã€‹è®¾è®¡ Instagramã€‚\nLetâ€™s design a photo-sharing service like Instagram, where users can upload photos to share them with other users. Similar Services: Flickr, Picasa Difficulty Level: Medium\nè®©æˆ‘ä»¬è®¾è®¡ä¸€ä¸ªåƒ Instagram è¿™æ ·çš„ç…§ç‰‡å…±äº«æœåŠ¡ï¼Œç”¨æˆ·å¯ä»¥ä¸Šä¼ ç…§ç‰‡ä¸å…¶ä»–ç”¨æˆ·å…±äº«ã€‚ç±»ä¼¼æœåŠ¡ï¼šFlickrã€Picasa éš¾åº¦çº§åˆ«ï¼šä¸­\n1. What is Instagram? 1.Instagramæ˜¯ä»€ä¹ˆï¼Ÿ\nInstagram is a social networking service which enables its users to upload and share their photos and videos with other users. Instagram users can choose to share information either publicly or privately. Anything shared publicly can be seen by any other user, whereas privately shared content can only be accessed by a specified set of people. Instagram also enables its users to share through many other social networking platforms, such as Facebook, Twitter, Flickr, and Tumblr.","title":"[è¯‘]ã€ŠGrokking the System Design Interviewã€‹è®¾è®¡Instagram"},{"content":"è¿™æ˜¯ä¸€ç¯‡åŒè¯­ç¿»è¯‘çš„æ–‡ç« ï¼ŒåŸæ–‡å‡ºè‡ª grok_system_design_interview.pdf çš„ä¸€ç¯‡æ–‡ç« ã€ŠDesigning Pastebinã€‹è®¾è®¡ Pastebinã€‚\nLetâ€™s design a Pastebin like web service, where users can store plain text. Users of the service will enter a piece of text and get a randomly generated URL to access it. Similar Services: pastebin.com, pasted.co, chopapp.com Difficulty Level: Easy\nè®©æˆ‘ä»¬è®¾è®¡ä¸€ä¸ªç±»ä¼¼ Pastebin çš„ Web æœåŠ¡ï¼Œç”¨æˆ·å¯ä»¥åœ¨å…¶ä¸­å­˜å‚¨çº¯æ–‡æœ¬ã€‚è¯¥æœåŠ¡çš„ç”¨æˆ·å°†è¾“å…¥ä¸€æ®µæ–‡æœ¬å¹¶è·å¾—ä¸€ä¸ªéšæœºç”Ÿæˆçš„ URL æ¥è®¿é—®å®ƒã€‚ç±»ä¼¼æœåŠ¡ï¼špastebin.comã€pasted.coã€hopapp.com éš¾åº¦çº§åˆ«ï¼šç®€å•\n1. What is Pastebin? 1.Pastebinæ˜¯ä»€ä¹ˆï¼Ÿ\nPastebin like services enable users to store plain text or images over the network (typically the Internet) and generate unique URLs to access the uploaded data. Such services are also used to share data over the network quickly, as users would just need to pass the URL to let other users see it.\nPastebin ä¹‹ç±»çš„æœåŠ¡ä½¿ç”¨æˆ·èƒ½å¤Ÿé€šè¿‡ç½‘ç»œï¼ˆé€šå¸¸æ˜¯äº’è”ç½‘ï¼‰å­˜å‚¨çº¯æ–‡æœ¬æˆ–å›¾åƒï¼Œå¹¶ç”Ÿæˆå”¯ä¸€çš„ URL æ¥è®¿é—®ä¸Šä¼ çš„æ•°æ®ã€‚æ­¤ç±»æœåŠ¡è¿˜ç”¨äºé€šè¿‡ç½‘ç»œå¿«é€Ÿå…±äº«æ•°æ®ï¼Œå› ä¸ºç”¨æˆ·åªéœ€ä¼ é€’ URL å³å¯è®©å…¶ä»–ç”¨æˆ·çœ‹åˆ°å®ƒã€‚\nIf you havenâ€™t used pastebin.com before, please try creating a new â€˜Pasteâ€™ there and spend some time going through the different options their service offers. This will help you a lot in understanding this chapter.\nå¦‚æœæ‚¨ä»¥å‰æ²¡æœ‰ä½¿ç”¨è¿‡ pastebin.comï¼Œè¯·å°è¯•åœ¨é‚£é‡Œåˆ›å»ºä¸€ä¸ªæ–°çš„â€œç²˜è´´â€ï¼Œå¹¶èŠ±ä¸€äº›æ—¶é—´æµè§ˆä»–ä»¬çš„æœåŠ¡æä¾›çš„ä¸åŒé€‰é¡¹ã€‚è¿™å°†å¯¹ä½ ç†è§£æœ¬ç« æœ‰å¾ˆå¤§å¸®åŠ©ã€‚\n2. Requirements and Goals of the System ç³»ç»Ÿçš„è¦æ±‚å’Œç›®æ ‡ Our Pastebin service should meet the following requirements:\næˆ‘ä»¬çš„ Pastebin æœåŠ¡åº”æ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š\nFunctional Requirements:\nåŠŸèƒ½è¦æ±‚ï¼š\nUsers should be able to upload or â€œpasteâ€ their data and get a unique URL to access it.\nç”¨æˆ·åº”è¯¥èƒ½å¤Ÿä¸Šä¼ æˆ–â€œç²˜è´´â€ä»–ä»¬çš„æ•°æ®å¹¶è·å¾—å”¯ä¸€çš„ URL æ¥è®¿é—®å®ƒã€‚\nUsers will only be able to upload text.\nç”¨æˆ·åªèƒ½ä¸Šä¼ æ–‡æœ¬ã€‚\nData and links will expire after a specific timespan automatically; users should also be able to specify expiration time.\næ•°æ®å’Œé“¾æ¥å°†åœ¨ç‰¹å®šæ—¶é—´æ®µåè‡ªåŠ¨è¿‡æœŸï¼›ç”¨æˆ·è¿˜åº”è¯¥èƒ½å¤ŸæŒ‡å®šè¿‡æœŸæ—¶é—´ã€‚\nUsers should optionally be able to pick a custom alias for their paste.\nç”¨æˆ·åº”è¯¥å¯ä»¥é€‰æ‹©ä¸ºå…¶ç²˜è´´é€‰æ‹©è‡ªå®šä¹‰åˆ«åã€‚\nNon-Functional Requirements:\néåŠŸèƒ½æ€§è¦æ±‚ï¼š\nThe system should be highly reliable, any data uploaded should not be lost.\nç³»ç»Ÿåº”é«˜åº¦å¯é ï¼Œä¸Šä¼ çš„ä»»ä½•æ•°æ®éƒ½ä¸åº”ä¸¢å¤±ã€‚\nThe system should be highly available. This is required because if our service is down, users will not be able to access their Pastes.\nç³»ç»Ÿåº”è¯¥æ˜¯é«˜å¯ç”¨çš„ã€‚è¿™æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºå¦‚æœæˆ‘ä»¬çš„æœåŠ¡å‡ºç°æ•…éšœï¼Œç”¨æˆ·å°†æ— æ³•è®¿é—®ä»–ä»¬çš„ç²˜è´´ã€‚\nUsers should be able to access their Pastes in real-time with minimum latency.\nç”¨æˆ·åº”è¯¥èƒ½å¤Ÿä»¥æœ€å°çš„å»¶è¿Ÿå®æ—¶è®¿é—®ä»–ä»¬çš„ç²˜è´´ã€‚\nPaste links should not be guessable (not predictable).\nç²˜è´´é“¾æ¥ä¸åº”æ˜¯å¯çŒœæµ‹çš„ï¼ˆä¸å¯é¢„æµ‹çš„ï¼‰ã€‚\nExtended Requirements:\næ‰©å±•è¦æ±‚ï¼š\nAnalytics, e.g., how many times a paste was accessed?\nåˆ†æï¼Œä¾‹å¦‚ç²˜è´´è¢«è®¿é—®äº†å¤šå°‘æ¬¡ï¼Ÿ\nOur service should also be accessible through REST APIs by other services.\næˆ‘ä»¬çš„æœåŠ¡è¿˜åº”è¯¥å¯ä»¥ç”±å…¶ä»–æœåŠ¡é€šè¿‡ REST API è®¿é—®ã€‚\n3. Some Design Considerations ä¸€äº›è®¾è®¡è€ƒè™‘ Pastebin shares some requirements with URL Shortening service, but there are some additional design considerations we should keep in mind.\nPastebin ä¸ URL ç¼©çŸ­æœåŠ¡æœ‰ä¸€äº›å…±åŒçš„è¦æ±‚ï¼Œä½†æˆ‘ä»¬è¿˜åº”è¯¥ç‰¢è®°ä¸€äº›é¢å¤–çš„è®¾è®¡æ³¨æ„äº‹é¡¹ã€‚\nWhat should be the limit on the amount of text user can paste at a time? We can limit users not to have Pastes bigger than 10MB to stop the abuse of the service.\nç”¨æˆ·ä¸€æ¬¡å¯ä»¥ç²˜è´´çš„æ–‡æœ¬é‡çš„é™åˆ¶åº”è¯¥æ˜¯å¤šå°‘ï¼Ÿæˆ‘ä»¬å¯ä»¥é™åˆ¶ç”¨æˆ·ç²˜è´´çš„å¤§å°ä¸å¾—è¶…è¿‡ 10MBï¼Œä»¥é˜»æ­¢æ»¥ç”¨æœåŠ¡ã€‚\nShould we impose size limits on custom URLs? Since our service supports custom URLs, users can pick any URL that they like, but providing a custom URL is not mandatory. However, it is reasonable (and often desirable) to impose a size limit on custom URLs, so that we have a consistent URL database.\næˆ‘ä»¬åº”è¯¥å¯¹è‡ªå®šä¹‰ URL æ–½åŠ å¤§å°é™åˆ¶å—ï¼Ÿç”±äºæˆ‘ä»¬çš„æœåŠ¡æ”¯æŒè‡ªå®šä¹‰ URLï¼Œå› æ­¤ç”¨æˆ·å¯ä»¥é€‰æ‹©ä»–ä»¬å–œæ¬¢çš„ä»»ä½• URLï¼Œä½†æä¾›è‡ªå®šä¹‰ URL ä¸æ˜¯å¼ºåˆ¶æ€§çš„ã€‚ç„¶è€Œï¼Œå¯¹è‡ªå®šä¹‰ URL æ–½åŠ å¤§å°é™åˆ¶æ˜¯åˆç†çš„ï¼ˆè€Œä¸”é€šå¸¸æ˜¯å¯å–çš„ï¼‰ï¼Œè¿™æ ·æˆ‘ä»¬å°±æœ‰ä¸€ä¸ªä¸€è‡´çš„ URL æ•°æ®åº“ã€‚\n4. Capacity Estimation and Constraints å®¹é‡ä¼°è®¡å’Œçº¦æŸ Our services will be read-heavy; there will be more read requests compared to new Pastes creation. We can assume a 5:1 ratio between read and write.\næˆ‘ä»¬çš„æœåŠ¡å°†éœ€è¦å¤§é‡é˜…è¯»ï¼›ä¸åˆ›å»ºæ–°çš„ç²˜è´´ç›¸æ¯”ï¼Œå°†ä¼šæœ‰æ›´å¤šçš„è¯»å–è¯·æ±‚ã€‚æˆ‘ä»¬å¯ä»¥å‡è®¾è¯»å’Œå†™ä¹‹é—´çš„æ¯”ä¾‹ä¸º 5:1ã€‚\nTraffic estimates: Pastebin services are not expected to have traffic similar to Twitter or Facebook, letâ€™s assume here that we get one million new pastes added to our system every day. This leaves us with five million reads per day.\næµé‡ä¼°è®¡ï¼šPastebin æœåŠ¡é¢„è®¡ä¸ä¼šæœ‰ç±»ä¼¼äº Twitter æˆ– Facebook çš„æµé‡ï¼Œæˆ‘ä»¬å‡è®¾æ¯å¤©æœ‰ 100 ä¸‡ä¸ªæ–°ç²˜è´´æ·»åŠ åˆ°æˆ‘ä»¬çš„ç³»ç»Ÿä¸­ã€‚è¿™ä½¿å¾—æˆ‘ä»¬æ¯å¤©çš„é˜…è¯»é‡è¾¾åˆ° 500 ä¸‡æ¬¡ã€‚\nNew Pastes per second:\næ¯ç§’æ–°ç²˜è´´æ•°ï¼š\n1M / (24 hours * 3600 seconds) ~= 12 pastes/sec\nPaste reads per second:\nç²˜è´´æ¯ç§’è¯»å–æ¬¡æ•°ï¼š\n5M / (24 hours * 3600 seconds) ~= 58 reads/sec\nStorage estimates: Users can upload maximum 10MB of data; commonly Pastebin like services are\nå­˜å‚¨é¢„ä¼°ï¼šç”¨æˆ·æœ€å¤šå¯ä¸Šä¼ 10MBæ•°æ®ï¼›é€šå¸¸ç±»ä¼¼ Pastebin çš„æœåŠ¡æ˜¯\nused to share source code, configs or logs. Such texts are not huge, so letâ€™s assume that each paste on average contains 10KB.\nç”¨äºå…±äº«æºä»£ç ã€é…ç½®æˆ–æ—¥å¿—ã€‚è¿™äº›æ–‡æœ¬å¹¶ä¸å¤§ï¼Œæ‰€ä»¥æˆ‘ä»¬å‡è®¾æ¯ä¸ªç²˜è´´å¹³å‡åŒ…å« 10KBã€‚\nAt this rate, we will be storing 10GB of data per day.\næŒ‰ç…§è¿™ä¸ªé€Ÿåº¦ï¼Œæˆ‘ä»¬æ¯å¤©å°†å­˜å‚¨ 10GB çš„æ•°æ®ã€‚\n1M * 10KB =\u0026gt; 10 GB/day\nIf we want to store this data for ten years we would need the total storage capacity of 36TB.\nå¦‚æœæˆ‘ä»¬æƒ³å­˜å‚¨è¿™äº›æ•°æ®åå¹´ï¼Œæˆ‘ä»¬éœ€è¦ 36TB çš„æ€»å­˜å‚¨å®¹é‡ã€‚\nWith 1M pastes every day we will have 3.6 billion Pastes in 10 years. We need to generate and store keys to uniquely identify these pastes. If we use base64 encoding ([A-Z, a-z, 0-9, ., -]) we would need six letters strings:\næ¯å¤©æœ‰ 100 ä¸‡ä¸ªç„Šè†ï¼Œ10 å¹´åæˆ‘ä»¬å°†æ‹¥æœ‰ 36 äº¿ä¸ªç„Šè†ã€‚æˆ‘ä»¬éœ€è¦ç”Ÿæˆå¹¶å­˜å‚¨å¯†é’¥æ¥å”¯ä¸€æ ‡è¯†è¿™äº›ç²˜è´´ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨ Base64 ç¼–ç ï¼ˆ[A-Z, a-z, 0-9, ., -]ï¼‰ï¼Œæˆ‘ä»¬å°†éœ€è¦å…­ä¸ªå­—æ¯çš„å­—ç¬¦ä¸²ï¼š\n64^6 ~= 68.7 billion unique strings\n64^6 ~= 687 äº¿ä¸ªå”¯ä¸€å­—ç¬¦ä¸²\nIf it takes one byte to store one character, total size required to store 3.6B keys would be:\nå¦‚æœéœ€è¦ 1 ä¸ªå­—èŠ‚å­˜å‚¨ 1 ä¸ªå­—ç¬¦ï¼Œåˆ™å­˜å‚¨ 3.6B ä¸ªå¯†é’¥æ‰€éœ€çš„æ€»å¤§å°ä¸ºï¼š\n3.6B * 6 =\u0026gt; 22 GB\n22GB is negligible compared to 36TB. To keep some margin, we will assume a 70% capacity model (meaning we donâ€™t want to use more than 70% of our total storage capacity at any point), which raises our storage needs to 51.4TB.\nä¸ 36TB ç›¸æ¯”ï¼Œ22GB å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚ä¸ºäº†ä¿ç•™ä¸€å®šçš„ä½™é‡ï¼Œæˆ‘ä»¬å°†å‡è®¾ 70% çš„å®¹é‡æ¨¡å‹ï¼ˆè¿™æ„å‘³ç€æˆ‘ä»¬åœ¨ä»»ä½•æ—¶å€™éƒ½ä¸æƒ³ä½¿ç”¨è¶…è¿‡æ€»å­˜å‚¨å®¹é‡çš„ 70%ï¼‰ï¼Œè¿™ä¼šå°†æˆ‘ä»¬çš„å­˜å‚¨éœ€æ±‚æé«˜åˆ° 51.4TBã€‚\nBandwidth estimates: For write requests, we expect 12 new pastes per second, resulting in 120KB of ingress per second.\nå¸¦å®½ä¼°è®¡ï¼šå¯¹äºå†™å…¥è¯·æ±‚ï¼Œæˆ‘ä»¬é¢„è®¡æ¯ç§’ 12 ä¸ªæ–°ç²˜è´´ï¼Œå¯¼è‡´æ¯ç§’ 120KB çš„å…¥å£ã€‚\n12 * 10KB =\u0026gt; 120 KB/s\nAs for the read request, we expect 58 requests per second. Therefore, total data egress (sent to users) will be 0.6 MB/s.\nè‡³äºè¯»å–è¯·æ±‚ï¼Œæˆ‘ä»¬é¢„è®¡æ¯ç§’æœ‰ 58 ä¸ªè¯·æ±‚ã€‚å› æ­¤ï¼Œæ€»æ•°æ®è¾“å‡ºï¼ˆå‘é€ç»™ç”¨æˆ·ï¼‰å°†ä¸º 0.6 MB/sã€‚\n58 * 10KB =\u0026gt; 0.6 MB/s\nAlthough total ingress and egress are not big, we should keep these numbers in mind while designing our service.\nå°½ç®¡å…¥å£å’Œå‡ºå£æ€»é‡å¹¶ä¸å¤§ï¼Œä½†æˆ‘ä»¬åœ¨è®¾è®¡æœåŠ¡æ—¶åº”è¯¥ç‰¢è®°è¿™äº›æ•°å­—ã€‚\nMemory estimates: We can cache some of the hot pastes that are frequently accessed. Following the 80-20 rule, meaning 20% of hot pastes generate 80% of traffic, we would like to cache these 20% pastes\nå†…å­˜ä¼°ç®—ï¼šæˆ‘ä»¬å¯ä»¥ç¼“å­˜ä¸€äº›ç»å¸¸è®¿é—®çš„çƒ­è´´ã€‚éµå¾ª 80-20 è§„åˆ™ï¼Œå³ 20% çš„çƒ­é—¨ç²˜è´´äº§ç”Ÿ 80% çš„æµé‡ï¼Œæˆ‘ä»¬å¸Œæœ›ç¼“å­˜è¿™ 20% çš„ç²˜è´´\nSince we have 5M read requests per day, to cache 20% of these requests, we would need:\nç”±äºæˆ‘ä»¬æ¯å¤©æœ‰ 500 ä¸‡ä¸ªè¯»å–è¯·æ±‚ï¼Œä¸ºäº†ç¼“å­˜è¿™äº›è¯·æ±‚çš„ 20%ï¼Œæˆ‘ä»¬éœ€è¦ï¼š\n0.2 * 5M * 10KB ~= 10 GB\n5. System APIs ç³»ç»ŸAPI We can have SOAP or REST APIs to expose the functionality of our service. Following could be the definitions of the APIs to create/retrieve/delete Pastes:\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨ SOAP æˆ– REST API æ¥å…¬å¼€æˆ‘ä»¬æœåŠ¡çš„åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯åˆ›å»º/æ£€ç´¢/åˆ é™¤ç²˜è´´çš„ API çš„å®šä¹‰ï¼š\naddPaste(api_dev_key, paste_data, custom_url=None user_name=None, paste_name=None, expire_date=None) Parameters:\nå‚æ•°ï¼š\napi_dev_key (string): The API developer key of a registered account. This will be used to, among other things, throttle users based on their allocated quota. paste_data (string): Textual data of the paste. custom_url (string): Optional custom URL.\napi_dev_key (string): æ³¨å†Œè´¦æˆ·çš„APIå¼€å‘è€…å¯†é’¥ã€‚é™¤å…¶ä»–å¤–ï¼Œè¿™å°†ç”¨äºæ ¹æ®åˆ†é…çš„é…é¢é™åˆ¶ç”¨æˆ·ã€‚ Paste_dataï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šç²˜è´´çš„æ–‡æœ¬æ•°æ®ã€‚ custom_urlï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šå¯é€‰çš„è‡ªå®šä¹‰ URLã€‚\nuser_name (string): Optional user name to be used to generate URL. paste_name (string): Optional name of the paste expire_date (string): Optional expiration date for the paste.\nuser_nameï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šç”¨äºç”Ÿæˆ URL çš„å¯é€‰ç”¨æˆ·åã€‚ Paste_nameï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šç²˜è´´çš„å¯é€‰åç§° expire_dateï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šç²˜è´´çš„å¯é€‰åˆ°æœŸæ—¥æœŸã€‚\nReturns: (string) A successful insertion returns the URL through which the paste can be accessed, otherwise, it will return an error code.\nè¿”å›ï¼šï¼ˆå­—ç¬¦ä¸²ï¼‰æˆåŠŸæ’å…¥å°†è¿”å›å¯è®¿é—®ç²˜è´´çš„ URLï¼Œå¦åˆ™å°†è¿”å›é”™è¯¯ä»£ç ã€‚\nSimilarly, we can have retrieve and delete Paste APIs:\nåŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥æ£€ç´¢å’Œåˆ é™¤ç²˜è´´ APIï¼š\ngetPaste(api_dev_key, api_paste_key) Where â€œapi_paste_keyâ€ is a string representing the Paste Key of the paste to be retrieved. This API will return the textual data of the paste.\nå…¶ä¸­â€œapi_paste_keyâ€æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè¦æ£€ç´¢çš„ç²˜è´´çš„ç²˜è´´å¯†é’¥ã€‚è¯¥ API å°†è¿”å›ç²˜è´´çš„æ–‡æœ¬æ•°æ®ã€‚\ndeletePaste(api_dev_key, api_paste_key) A successful deletion returns â€˜trueâ€™, otherwise returns â€˜falseâ€™.\næˆåŠŸåˆ é™¤è¿”å›â€œtrueâ€ï¼Œå¦åˆ™è¿”å›â€œfalseâ€ã€‚\n6. Database Design æ•°æ®åº“è®¾è®¡ A few observations about the nature of the data we are storing:\nå…³äºæˆ‘ä»¬å­˜å‚¨çš„æ•°æ®çš„æ€§è´¨çš„ä¸€äº›è§‚å¯Ÿï¼š\nWe need to store billions of records.\næˆ‘ä»¬éœ€è¦å­˜å‚¨æ•°åäº¿æ¡è®°å½•ã€‚\nEach metadata object we are storing would be small (less than 100 bytes).\næˆ‘ä»¬å­˜å‚¨çš„æ¯ä¸ªå…ƒæ•°æ®å¯¹è±¡éƒ½å¾ˆå°ï¼ˆå°äº 100 å­—èŠ‚ï¼‰ã€‚\nEach paste object we are storing can be of medium size (it can be a few MB).\næˆ‘ä»¬å­˜å‚¨çš„æ¯ä¸ªç²˜è´´å¯¹è±¡å¯ä»¥æ˜¯ä¸­ç­‰å¤§å°ï¼ˆå¯ä»¥æ˜¯å‡  MBï¼‰ã€‚\nThere are no relationships between records, except if we want to store which user created what Paste.\nè®°å½•ä¹‹é—´æ²¡æœ‰å…³ç³»ï¼Œé™¤éæˆ‘ä»¬æƒ³è¦å­˜å‚¨å“ªä¸ªç”¨æˆ·åˆ›å»ºäº†å“ªä¸ªç²˜è´´ã€‚\nOur service is read-heavy.\næˆ‘ä»¬çš„æœåŠ¡æ˜¯é‡è¯»çš„ã€‚\nDatabase Schema:\næ•°æ®åº“æ¶æ„ï¼š\nWe would need two tables, one for storing information about the Pastes and the other for usersâ€™ data.\næˆ‘ä»¬éœ€è¦ä¸¤ä¸ªè¡¨ï¼Œä¸€ä¸ªç”¨äºå­˜å‚¨æœ‰å…³ç²˜è´´çš„ä¿¡æ¯ï¼Œå¦ä¸€ä¸ªç”¨äºå­˜å‚¨ç”¨æˆ·æ•°æ®ã€‚\nHere, â€˜URlHashâ€™ is the URL equivalent of the TinyURL and â€˜ContentKeyâ€™ is the object key storing the contents of the paste.\nè¿™é‡Œï¼Œâ€œURlHashâ€æ˜¯ç›¸å½“äº TinyURL çš„ URLï¼Œâ€œContentKeyâ€æ˜¯å­˜å‚¨ç²˜è´´å†…å®¹çš„å¯¹è±¡é”®ã€‚\n7. High Level Design é«˜å±‚è®¾è®¡ At a high level, we need an application layer that will serve all the read and write requests. Application layer will talk to a storage layer to store and retrieve data. We can segregate our storage layer with one database storing metadata related to each paste, users, etc., while the other storing the paste contents in some object storage (like Amazon S3). This division of data will also allow us to scale them individually.\nåœ¨è¾ƒé«˜çš„å±‚é¢ä¸Šï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåº”ç”¨ç¨‹åºå±‚æ¥æœåŠ¡æ‰€æœ‰çš„è¯»å†™è¯·æ±‚ã€‚åº”ç”¨å±‚å°†ä¸å­˜å‚¨å±‚é€šä¿¡ä»¥å­˜å‚¨å’Œæ£€ç´¢æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥å°†å­˜å‚¨å±‚éš”ç¦»ï¼Œä¸€ä¸ªæ•°æ®åº“å­˜å‚¨ä¸æ¯ä¸ªç²˜è´´ã€ç”¨æˆ·ç­‰ç›¸å…³çš„å…ƒæ•°æ®ï¼Œè€Œå¦ä¸€ä¸ªæ•°æ®åº“å°†ç²˜è´´å†…å®¹å­˜å‚¨åœ¨æŸäº›å¯¹è±¡å­˜å‚¨ï¼ˆå¦‚ Amazon S3ï¼‰ä¸­ã€‚è¿™ç§æ•°æ®åˆ’åˆ†è¿˜å…è®¸æˆ‘ä»¬å•ç‹¬ç¼©æ”¾å®ƒä»¬ã€‚\n8. Component Design ç»„ä»¶è®¾è®¡ a. Application layer\na. åº”ç”¨å±‚\nOur application layer will process all incoming and outgoing requests. The application servers will be talking to the backend data store components to serve the requests.\næˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå±‚å°†å¤„ç†æ‰€æœ‰ä¼ å…¥å’Œä¼ å‡ºçš„è¯·æ±‚ã€‚åº”ç”¨ç¨‹åºæœåŠ¡å™¨å°†ä¸åç«¯æ•°æ®å­˜å‚¨ç»„ä»¶é€šä¿¡ä»¥æœåŠ¡è¯·æ±‚ã€‚\nHow to handle a write request? Upon receiving a write request, our application server will generate a six-letter random string, which would serve as the key of the paste (if the user has not provided a custom key). The application server will then store the contents of the paste and the generated key in the database. After the successful insertion, the server can return the key to the user. One possible problem here could be that the insertion fails because of a duplicate key. Since we are generating a random key, there is a possibility that the newly generated key could match an existing one. In that case, we should regenerate a new key and try again. We should keep retrying until we donâ€™t see failure due to the duplicate key. We should return an error to the user if the custom key they have provided is already present in our database.\nå¦‚ä½•å¤„ç†å†™è¯·æ±‚ï¼Ÿæ”¶åˆ°å†™å…¥è¯·æ±‚åï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæœåŠ¡å™¨å°†ç”Ÿæˆä¸€ä¸ªå…­å­—æ¯çš„éšæœºå­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²å°†ç”¨ä½œç²˜è´´çš„å¯†é’¥ï¼ˆå¦‚æœç”¨æˆ·æœªæä¾›è‡ªå®šä¹‰å¯†é’¥ï¼‰ã€‚ç„¶ååº”ç”¨ç¨‹åºæœåŠ¡å™¨ä¼šå°†ç²˜è´´çš„å†…å®¹å’Œç”Ÿæˆçš„å¯†é’¥å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚æ’å…¥æˆåŠŸåï¼ŒæœåŠ¡å™¨å¯ä»¥å°†å¯†é’¥è¿”å›ç»™ç”¨æˆ·ã€‚è¿™é‡Œä¸€ä¸ªå¯èƒ½çš„é—®é¢˜æ˜¯æ’å…¥ç”±äºé‡å¤çš„é”®è€Œå¤±è´¥ã€‚ç”±äºæˆ‘ä»¬ç”Ÿæˆéšæœºå¯†é’¥ï¼Œå› æ­¤æ–°ç”Ÿæˆçš„å¯†é’¥æœ‰å¯èƒ½ä¸ç°æœ‰å¯†é’¥åŒ¹é…ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥é‡æ–°ç”Ÿæˆä¸€ä¸ªæ–°å¯†é’¥å¹¶é‡è¯•ã€‚æˆ‘ä»¬åº”è¯¥ä¸æ–­é‡è¯•ï¼Œç›´åˆ°çœ‹ä¸åˆ°ç”±äºé‡å¤å¯†é’¥è€Œå¯¼è‡´çš„å¤±è´¥ã€‚å¦‚æœç”¨æˆ·æä¾›çš„è‡ªå®šä¹‰å¯†é’¥å·²å­˜åœ¨äºæˆ‘ä»¬çš„æ•°æ®åº“ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥å‘ç”¨æˆ·è¿”å›é”™è¯¯ã€‚\nAnother solution of the above problem could be to run a standalone Key Generation Service (KGS) that generates random six letters strings beforehand and stores them in a database (letâ€™s call it key-DB). Whenever we want to store a new paste, we will just take one of the already generated keys and use it. This approach will make things quite simple and fast since we will not be worrying about duplications or collisions. KGS will make sure all the keys inserted in key-DB are unique. KGS can use two tables to store keys, one for keys that are not used yet and one for all the used keys. As soon as KGS gives some keys to an application server, it can move these to the used keys table. KGS can always keep some keys in memory so that whenever a server needs them, it can quickly provide them. As soon as KGS loads some keys in memory, it can move them to the used keys table, this way we can make sure each server gets unique keys. If KGS dies before using all the keys loaded in memory, we will be wasting those keys. We can ignore these keys given that we have a huge number of them.\nä¸Šè¿°é—®é¢˜çš„å¦ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯è¿è¡Œä¸€ä¸ªç‹¬ç«‹çš„å¯†é’¥ç”ŸæˆæœåŠ¡ï¼ˆKGSï¼‰ï¼Œè¯¥æœåŠ¡é¢„å…ˆç”Ÿæˆéšæœºçš„å…­ä¸ªå­—æ¯å­—ç¬¦ä¸²å¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸ºå¯†é’¥æ•°æ®åº“ï¼‰ã€‚æ¯å½“æˆ‘ä»¬æƒ³è¦å­˜å‚¨æ–°çš„ç²˜è´´æ—¶ï¼Œæˆ‘ä»¬åªéœ€è·å–å·²ç”Ÿæˆçš„å¯†é’¥ä¹‹ä¸€å¹¶ä½¿ç”¨å®ƒå³å¯ã€‚è¿™ç§æ–¹æ³•å°†ä½¿äº‹æƒ…å˜å¾—éå¸¸ç®€å•å’Œå¿«é€Ÿï¼Œå› ä¸ºæˆ‘ä»¬ä¸ä¼šæ‹…å¿ƒé‡å¤æˆ–å†²çªã€‚ KGS å°†ç¡®ä¿æ’å…¥ key-DB ä¸­çš„æ‰€æœ‰å¯†é’¥éƒ½æ˜¯å”¯ä¸€çš„ã€‚ KGS å¯ä»¥ä½¿ç”¨ä¸¤å¼ è¡¨æ¥å­˜å‚¨å¯†é’¥ï¼Œä¸€å¼ ç”¨äºå°šæœªä½¿ç”¨çš„å¯†é’¥ï¼Œä¸€å¼ ç”¨äºæ‰€æœ‰å·²ä½¿ç”¨çš„å¯†é’¥ã€‚ä¸€æ—¦ KGS å‘åº”ç”¨ç¨‹åºæœåŠ¡å™¨æä¾›ä¸€äº›å¯†é’¥ï¼Œå®ƒå°±å¯ä»¥å°†è¿™äº›å¯†é’¥ç§»åŠ¨åˆ°å·²ä½¿ç”¨çš„å¯†é’¥è¡¨ä¸­ã€‚ KGS å¯ä»¥å§‹ç»ˆå°†ä¸€äº›å¯†é’¥ä¿ç•™åœ¨å†…å­˜ä¸­ï¼Œä»¥ä¾¿æ¯å½“æœåŠ¡å™¨éœ€è¦å®ƒä»¬æ—¶ï¼Œå®ƒå¯ä»¥å¿«é€Ÿæä¾›å®ƒä»¬ã€‚ä¸€æ—¦ KGS åœ¨å†…å­˜ä¸­åŠ è½½ä¸€äº›å¯†é’¥ï¼Œå®ƒå°±å¯ä»¥å°†å®ƒä»¬ç§»åŠ¨åˆ°å·²ä½¿ç”¨çš„å¯†é’¥è¡¨ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç¡®ä¿æ¯ä¸ªæœåŠ¡å™¨éƒ½è·å¾—å”¯ä¸€çš„å¯†é’¥ã€‚å¦‚æœ KGS åœ¨ä½¿ç”¨å†…å­˜ä¸­åŠ è½½çš„æ‰€æœ‰å¯†é’¥ä¹‹å‰å°±æ­»æ‰äº†ï¼Œæˆ‘ä»¬å°†æµªè´¹è¿™äº›å¯†é’¥ã€‚é‰´äºæˆ‘ä»¬æœ‰å¤§é‡çš„å¯†é’¥ï¼Œæˆ‘ä»¬å¯ä»¥å¿½ç•¥è¿™äº›å¯†é’¥ã€‚\nIsnâ€™t KGS a single point of failure? Yes, it is. To solve this, we can have a standby replica of KGS and whenever the primary server dies it can take over to generate and provide keys.\nKGS ä¸æ˜¯å•ç‚¹æ•…éšœå—ï¼Ÿæ˜¯çš„ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥æ‹¥æœ‰ä¸€ä¸ª KGS çš„å¤‡ç”¨å‰¯æœ¬ï¼Œæ¯å½“ä¸»æœåŠ¡å™¨æŒ‚æ‰æ—¶ï¼Œå®ƒå°±å¯ä»¥æ¥ç®¡ç”Ÿæˆå’Œæä¾›å¯†é’¥ã€‚\nCan each app server cache some keys from key-DB? Yes, this can surely speed things up. Although in this case, if the application server dies before consuming all the keys, we will end up losing those keys. This could be acceptable since we have 68B unique six letters keys, which are a lot more than we require.\næ¯ä¸ªåº”ç”¨ç¨‹åºæœåŠ¡å™¨å¯ä»¥ç¼“å­˜å¯†é’¥æ•°æ®åº“ä¸­çš„ä¸€äº›å¯†é’¥å—ï¼Ÿæ˜¯çš„ï¼Œè¿™è‚¯å®šå¯ä»¥åŠ å¿«é€Ÿåº¦ã€‚å°½ç®¡åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœåº”ç”¨ç¨‹åºæœåŠ¡å™¨åœ¨æ¶ˆè€—æ‰€æœ‰å¯†é’¥ä¹‹å‰æ­»äº¡ï¼Œæˆ‘ä»¬æœ€ç»ˆå°†ä¸¢å¤±è¿™äº›å¯†é’¥ã€‚è¿™æ˜¯å¯ä»¥æ¥å—çš„ï¼Œå› ä¸ºæˆ‘ä»¬æœ‰ 68B ä¸ªç‹¬ç‰¹çš„å…­ä¸ªå­—æ¯é”®ï¼Œè¿™æ¯”æˆ‘ä»¬éœ€è¦çš„å¤šå¾—å¤šã€‚\nHow does it handle a paste read request? Upon receiving a read paste request, the application service layer contacts the datastore. The datastore searches for the key, and if it is found, returns the pasteâ€™s contents. Otherwise, an error code is returned.\nå®ƒå¦‚ä½•å¤„ç†ç²˜è´´è¯»å–è¯·æ±‚ï¼Ÿåœ¨æ¥æ”¶åˆ°è¯»å–ç²˜è´´è¯·æ±‚åï¼Œåº”ç”¨ç¨‹åºæœåŠ¡å±‚è”ç³»æ•°æ®å­˜å‚¨ã€‚æ•°æ®å­˜å‚¨åŒºæœç´¢å¯†é’¥ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œåˆ™è¿”å›ç²˜è´´çš„å†…å®¹ã€‚å¦åˆ™ï¼Œè¿”å›é”™è¯¯ä»£ç ã€‚\nb. Datastore layer b.æ•°æ®å­˜å‚¨å±‚\nWe can divide our datastore layer into two:\næˆ‘ä»¬å¯ä»¥å°†æ•°æ®å­˜å‚¨å±‚åˆ†ä¸ºä¸¤å±‚ï¼š\nMetadata database: We can use a relational database like MySQL or a Distributed Key-Value store like Dynamo or Cassandra.\nå…ƒæ•°æ®æ•°æ®åº“ï¼šæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…³ç³»æ•°æ®åº“ï¼ˆä¾‹å¦‚ MySQLï¼‰æˆ–åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ï¼ˆä¾‹å¦‚ Dynamo æˆ– Cassandraï¼‰ã€‚\nObject storage: We can store our contents in an Object Storage like Amazonâ€™s S3. Whenever we feel like hitting our full capacity on content storage, we can easily increase it by adding more servers.\nå¯¹è±¡å­˜å‚¨ï¼šæˆ‘ä»¬å¯ä»¥å°†å†…å®¹å­˜å‚¨åœ¨å¯¹è±¡å­˜å‚¨ä¸­ï¼Œä¾‹å¦‚ Amazon çš„ S3ã€‚æ¯å½“æˆ‘ä»¬æƒ³è¦å……åˆ†åˆ©ç”¨å†…å®¹å­˜å‚¨å®¹é‡æ—¶ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥é€šè¿‡æ·»åŠ æ›´å¤šæœåŠ¡å™¨æ¥è½»æ¾å¢åŠ å®¹é‡ã€‚\nDetailed component design for Pastebin\nPastebin çš„è¯¦ç»†ç»„ä»¶è®¾è®¡\n9. Purging or DB Cleanup æ¸…é™¤æˆ–æ•°æ®åº“æ¸…ç† Please see Designing a URL Shortening service.\nè¯·å‚é˜…è®¾è®¡ URL ç¼©çŸ­æœåŠ¡ã€‚\n10. Data Partitioning and Replication æ•°æ®åˆ†åŒºå’Œå¤åˆ¶ Please see Designing a URL Shortening service.\nè¯·å‚é˜…è®¾è®¡ URL ç¼©çŸ­æœåŠ¡ã€‚\n11. Cache and Load Balancer ç¼“å­˜å’Œè´Ÿè½½å‡è¡¡å™¨ Please see Designing a URL Shortening service.\nè¯·å‚é˜…è®¾è®¡ URL ç¼©çŸ­æœåŠ¡ã€‚\n12. Security and Permissions å®‰å…¨å’Œæƒé™ Please see Designing a URL Shortening service.\nè¯·å‚é˜…è®¾è®¡ URL ç¼©çŸ­æœåŠ¡ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/11/24/designing-pastebin/","summary":"è¿™æ˜¯ä¸€ç¯‡åŒè¯­ç¿»è¯‘çš„æ–‡ç« ï¼ŒåŸæ–‡å‡ºè‡ª grok_system_design_interview.pdf çš„ä¸€ç¯‡æ–‡ç« ã€ŠDesigning Pastebinã€‹è®¾è®¡ Pastebinã€‚\nLetâ€™s design a Pastebin like web service, where users can store plain text. Users of the service will enter a piece of text and get a randomly generated URL to access it. Similar Services: pastebin.com, pasted.co, chopapp.com Difficulty Level: Easy\nè®©æˆ‘ä»¬è®¾è®¡ä¸€ä¸ªç±»ä¼¼ Pastebin çš„ Web æœåŠ¡ï¼Œç”¨æˆ·å¯ä»¥åœ¨å…¶ä¸­å­˜å‚¨çº¯æ–‡æœ¬ã€‚è¯¥æœåŠ¡çš„ç”¨æˆ·å°†è¾“å…¥ä¸€æ®µæ–‡æœ¬å¹¶è·å¾—ä¸€ä¸ªéšæœºç”Ÿæˆçš„ URL æ¥è®¿é—®å®ƒã€‚ç±»ä¼¼æœåŠ¡ï¼špastebin.comã€pasted.coã€hopapp.com éš¾åº¦çº§åˆ«ï¼šç®€å•\n1. What is Pastebin? 1.Pastebinæ˜¯ä»€ä¹ˆï¼Ÿ\nPastebin like services enable users to store plain text or images over the network (typically the Internet) and generate unique URLs to access the uploaded data. Such services are also used to share data over the network quickly, as users would just need to pass the URL to let other users see it.","title":"[è¯‘]ã€ŠGrokking the System Design Interviewã€‹è®¾è®¡Pastebin"},{"content":"è¿™æ˜¯ä¸€ç¯‡åŒè¯­ç¿»è¯‘çš„æ–‡ç« ï¼ŒåŸæ–‡å‡ºè‡ªã€ŠGrokking the System Design Interviewã€‹æ•™ç¨‹çš„ Domain Name System è¿™ç¯‡ç« èŠ‚ã€‚\nIntroduction to Domain Name System (DNS) åŸŸåç³»ç»Ÿ (DNS) ç®€ä»‹\nThe origins of DNS DNS çš„èµ·æº\nLetâ€™s consider the example of a mobile phone where a unique number is associated with each user. To make calls to friends, we can initially try to memorize some of the phone numbers. However, as the number of contacts grows, weâ€™ll have to use a phone book to keep track of all our contacts. This way, whenever we need to make a call, weâ€™ll refer to the phone book and dial the number we need.\nè®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªç§»åŠ¨ç”µè¯çš„ç¤ºä¾‹ï¼Œå…¶ä¸­æ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„å·ç ã€‚ä¸ºäº†ç»™æœ‹å‹æ‰“ç”µè¯ï¼Œæˆ‘ä»¬é¦–å…ˆå¯ä»¥å°è¯•è®°ä½ä¸€äº›ç”µè¯å·ç ã€‚ç„¶è€Œï¼Œéšç€è”ç³»äººæ•°é‡çš„å¢åŠ ï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸ä½¿ç”¨ç”µè¯ç°¿æ¥è·Ÿè¸ªæ‰€æœ‰è”ç³»äººã€‚è¿™æ ·ï¼Œæ¯å½“æˆ‘ä»¬éœ€è¦æ‰“ç”µè¯æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šæŸ¥é˜…ç”µè¯ç°¿å¹¶æ‹¨æ‰“æˆ‘ä»¬éœ€è¦çš„å·ç ã€‚\nSimilarly, computers are uniquely identified by IP addressesâ€”for example, 104.18.2.119 is an IP address. We use IP addresses to visit a website hosted on a machine. Since humans cannot easily remember IP addresses to visit domain names (an example domain name being educative.io), we need a phone book-like repository that can maintain all mappings of domain names to IP addresses. In this chapter, weâ€™ll see how DNS serves as the Internetâ€™s phone book.\nåŒæ ·ï¼Œè®¡ç®—æœºç”± IP åœ°å€å”¯ä¸€æ ‡è¯†ï¼Œä¾‹å¦‚ï¼Œ 104.18.2.119 æ˜¯ä¸€ä¸ª IP åœ°å€ã€‚æˆ‘ä»¬ä½¿ç”¨ IP åœ°å€æ¥è®¿é—®è®¡ç®—æœºä¸Šæ‰˜ç®¡çš„ç½‘ç«™ã€‚ç”±äºäººç±»æ— æ³•è½»æ˜“è®°ä½ IP åœ°å€æ¥è®¿é—®åŸŸåï¼ˆä¾‹å¦‚åŸŸå eduducative.ioï¼‰ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªç±»ä¼¼ç”µè¯ç°¿çš„å­˜å‚¨åº“æ¥ç»´æŠ¤åŸŸååˆ° IP åœ°å€çš„æ‰€æœ‰æ˜ å°„ã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£ DNS å¦‚ä½•å……å½“äº’è”ç½‘çš„ç”µè¯ç°¿ã€‚\nWhat is DNS? ä»€ä¹ˆæ˜¯ DNSï¼Ÿ\nThe domain name system (DNS) is the Internetâ€™s naming service that maps human-friendly domain names to machine-readable IP addresses. The service of DNS is transparent to users. When a user enters a domain name in the browser, the browser has to translate the domain name to IP address by asking the DNS infrastructure. Once the desired IP address is obtained, the userâ€™s request is forwarded to the destination web server.\nåŸŸåç³»ç»Ÿ (DNS) æ˜¯äº’è”ç½‘çš„å‘½åæœåŠ¡ï¼Œå®ƒå°†äººç±»å‹å¥½çš„åŸŸåæ˜ å°„åˆ°æœºå™¨å¯è¯»çš„ IP åœ°å€ã€‚ DNSæœåŠ¡å¯¹ç”¨æˆ·æ˜¯é€æ˜çš„ã€‚å½“ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­è¾“å…¥åŸŸåæ—¶ï¼Œæµè§ˆå™¨å¿…é¡»é€šè¿‡è¯¢é—® DNS åŸºç¡€è®¾æ–½å°†åŸŸåè½¬æ¢ä¸º IP åœ°å€ã€‚ä¸€æ—¦è·å¾—æ‰€éœ€çš„ IP åœ°å€ï¼Œç”¨æˆ·çš„è¯·æ±‚å°±ä¼šè½¬å‘åˆ°ç›®æ ‡ Web æœåŠ¡å™¨ã€‚\nThe slides below show the high-level flow of the working of DNS:\nä¸‹é¢çš„å¹»ç¯ç‰‡æ˜¾ç¤ºäº† DNS å·¥ä½œçš„é«˜çº§æµç¨‹ï¼š\nThe entire operation is performed very quickly. Therefore, the end user experiences minimum delay. Weâ€™ll also see how browsers save some of the frequently used mappings for later use in the next lesson.\næ•´ä¸ªæ“ä½œè¿›è¡Œå¾—éå¸¸å¿«ã€‚å› æ­¤ï¼Œæœ€ç»ˆç”¨æˆ·ä½“éªŒåˆ°çš„å»¶è¿Ÿæœ€å°ã€‚æˆ‘ä»¬è¿˜å°†äº†è§£æµè§ˆå™¨å¦‚ä½•ä¿å­˜ä¸€äº›å¸¸ç”¨çš„æ˜ å°„ä»¥ä¾›ä¸‹ä¸€è¯¾ç¨åä½¿ç”¨ã€‚\nImportant details é‡è¦ç»†èŠ‚\nLetâ€™s highlight some of the important details about DNS, some of which weâ€™ll cover in the next lesson:\nè®©æˆ‘ä»¬é‡ç‚¹ä»‹ç»æœ‰å…³ DNS çš„ä¸€äº›é‡è¦ç»†èŠ‚ï¼Œå…¶ä¸­ä¸€äº›æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€è¯¾ä¸­ä»‹ç»ï¼š\nName servers: Itâ€™s important to understand that the DNS isnâ€™t a single server. Itâ€™s a complete infrastructure with numerous servers. DNS servers that respond to usersâ€™ queries are called name servers.\nåç§°æœåŠ¡å™¨ï¼šé‡è¦çš„æ˜¯è¦äº†è§£ DNS ä¸æ˜¯å•ä¸ªæœåŠ¡å™¨ã€‚å®ƒæ˜¯ä¸€ä¸ªæ‹¥æœ‰å¤§é‡æœåŠ¡å™¨çš„å®Œæ•´åŸºç¡€è®¾æ–½ã€‚å“åº”ç”¨æˆ·æŸ¥è¯¢çš„ DNS æœåŠ¡å™¨ç§°ä¸ºåç§°æœåŠ¡å™¨ã€‚\nResource records: The DNS database stores domain name to IP address mappings in the form of resource records (RR). The RR is the smallest unit of information that users request from the name servers. There are different types of RRs. The table below describes common RRs. The three important pieces of information are type, name, and value. The name and value change depending upon the type of the RR.\nèµ„æºè®°å½•ï¼šDNS æ•°æ®åº“ä»¥èµ„æºè®°å½• (RR) çš„å½¢å¼å­˜å‚¨åŸŸååˆ° IP åœ°å€çš„æ˜ å°„ã€‚ RR æ˜¯ç”¨æˆ·ä»åç§°æœåŠ¡å™¨è¯·æ±‚çš„æœ€å°ä¿¡æ¯å•å…ƒã€‚ RR æœ‰ä¸åŒç±»å‹ã€‚ä¸‹è¡¨æè¿°äº†å¸¸è§çš„ RRã€‚ä¸‰ä¸ªé‡è¦çš„ä¿¡æ¯æ˜¯ç±»å‹ã€åç§°å’Œå€¼ã€‚åç§°å’Œå€¼æ ¹æ® RR çš„ç±»å‹è€Œå˜åŒ–ã€‚\nCommon Types of Resource Records èµ„æºè®°å½•çš„å¸¸è§ç±»å‹\n**Type ** **Description ** **Name ** Value **Example (Type, Name, Value) ** A Provides the hostname to IP address mapping Hostname IP address (A, relay1.main.educative.io,104.18.2.119) NS Provides the hostname that is the authoritative DNS for a domain name Domain name Hostname (NS, educative.io, dns.educative.io) CNAME Provides the mapping from alias to canonical hostname Hostname Canonical name (CNAME, educative.io, server1.primary.educative.io) MX Provides the mapping of mail server from alias to canonical hostname Hostname Canonical name (MX, mail.educative.io, mailserver1.backup.educative.io) Caching: DNS uses caching at different layers to reduce request latency for the user. Caching plays an important role in reducing the burden on DNS infrastructure because it has to cater to the queries of the entire Internet.\nç¼“å­˜ï¼šDNS ä½¿ç”¨ä¸åŒå±‚çš„ç¼“å­˜æ¥å‡å°‘ç”¨æˆ·çš„è¯·æ±‚å»¶è¿Ÿã€‚ç¼“å­˜åœ¨å‡è½» DNS åŸºç¡€è®¾æ–½çš„è´Ÿæ‹…æ–¹é¢å‘æŒ¥ç€é‡è¦ä½œç”¨ï¼Œå› ä¸ºå®ƒå¿…é¡»æ»¡è¶³æ•´ä¸ªäº’è”ç½‘çš„æŸ¥è¯¢ã€‚\nHierarchy: DNS name servers are in a hierarchical form. The hierarchical structure allows DNS to be highly scalable because of its increasing size and query load. In the next lesson, weâ€™ll look at how a tree-like structure is used to manage the entire DNS database.\nå±‚æ¬¡ç»“æ„ï¼šDNS åç§°æœåŠ¡å™¨é‡‡ç”¨å±‚æ¬¡ç»“æ„å½¢å¼ã€‚ç”±äºå…¶è§„æ¨¡å’ŒæŸ¥è¯¢è´Ÿè½½ä¸æ–­å¢åŠ ï¼Œåˆ†å±‚ç»“æ„ä½¿ DNS å…·æœ‰é«˜åº¦å¯æ‰©å±•æ€§ã€‚åœ¨ä¸‹ä¸€è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•ä½¿ç”¨æ ‘çŠ¶ç»“æ„æ¥ç®¡ç†æ•´ä¸ª DNS æ•°æ®åº“ã€‚\nLetâ€™s explore more details of the above points in the next lesson to get more clarity.\nè®©æˆ‘ä»¬åœ¨ä¸‹ä¸€è¯¾ä¸­æ¢è®¨ä¸Šè¿°è¦ç‚¹çš„æ›´å¤šç»†èŠ‚ï¼Œä»¥ä¾¿æ›´åŠ æ¸…æ™°ã€‚\nHow the Domain Name System Works åŸŸåç³»ç»Ÿå¦‚ä½•è¿ä½œ\nThrough this lesson, weâ€™ll answer the following questions:\né€šè¿‡æœ¬è¯¾ï¼Œæˆ‘ä»¬å°†å›ç­”ä»¥ä¸‹é—®é¢˜ï¼š\nHow is the DNS hierarchy formed using various types of DNS name servers?\nå¦‚ä½•ä½¿ç”¨å„ç§ç±»å‹çš„ DNS åç§°æœåŠ¡å™¨å½¢æˆ DNS å±‚æ¬¡ç»“æ„ï¼Ÿ\nHow is caching performed at different levels of the Internet to reduce the querying burden over the DNS infrastructure?\nå¦‚ä½•åœ¨äº’è”ç½‘çš„ä¸åŒçº§åˆ«æ‰§è¡Œç¼“å­˜ä»¥å‡è½» DNS åŸºç¡€è®¾æ–½çš„æŸ¥è¯¢è´Ÿæ‹…ï¼Ÿ\nHow does the distributed nature of the DNS infrastructure help its robustness?\nDNS åŸºç¡€è®¾æ–½çš„åˆ†å¸ƒå¼ç‰¹æ€§å¦‚ä½•æœ‰åŠ©äºå…¶ç¨³å¥æ€§ï¼Ÿ\nLetâ€™s get started.\nè®©æˆ‘ä»¬å¼€å§‹å§ã€‚\nDNS hierarchy DNSå±‚æ¬¡ç»“æ„\nAs stated before, the DNS isnâ€™t a single server that accepts requests and responds to user queries. Itâ€™s a complete infrastructure with name servers at different hierarchies.\nå¦‚å‰æ‰€è¿°ï¼ŒDNS ä¸æ˜¯æ¥å—è¯·æ±‚å¹¶å“åº”ç”¨æˆ·æŸ¥è¯¢çš„å•ä¸ªæœåŠ¡å™¨ã€‚å®ƒæ˜¯ä¸€ä¸ªå®Œæ•´çš„åŸºç¡€è®¾æ–½ï¼Œå…·æœ‰ä¸åŒå±‚æ¬¡ç»“æ„çš„åç§°æœåŠ¡å™¨ã€‚\nThere are mainly four types of servers in the DNS hierarchy:\nDNS å±‚æ¬¡ç»“æ„ä¸­ä¸»è¦æœ‰å››ç§ç±»å‹çš„æœåŠ¡å™¨ï¼š\nDNS resolver: Resolvers initiate the querying sequence and forward requests to the other DNS name servers. Typically, DNS resolvers lie within the premise of the userâ€™s network. However, DNS resolvers can also cater to usersâ€™ DNS queries through caching techniques, as we will see shortly. These servers can also be called local or default servers.\nDNS è§£æå™¨ï¼šè§£æå™¨å¯åŠ¨æŸ¥è¯¢åºåˆ—å¹¶å°†è¯·æ±‚è½¬å‘åˆ°å…¶ä»– DNS åç§°æœåŠ¡å™¨ã€‚é€šå¸¸ï¼ŒDNS è§£æå™¨ä½äºç”¨æˆ·ç½‘ç»œçš„å†…éƒ¨ã€‚ç„¶è€Œï¼ŒDNS è§£æå™¨è¿˜å¯ä»¥é€šè¿‡ç¼“å­˜æŠ€æœ¯æ¥æ»¡è¶³ç”¨æˆ·çš„ DNS æŸ¥è¯¢ï¼Œæˆ‘ä»¬å¾ˆå¿«å°±ä¼šçœ‹åˆ°ã€‚è¿™äº›æœåŠ¡å™¨ä¹Ÿå¯ä»¥ç§°ä¸ºæœ¬åœ°æˆ–é»˜è®¤æœåŠ¡å™¨ã€‚\nRoot-level name servers: These servers receive requests from local servers. Root name servers maintain name servers based on top-level domain names, such as .com, .edu, .us, and so on. For instance, when a user requests the IP address of educative.io, root-level name servers will return a list of top-level domain (TLD) servers that hold the IP addresses of the .io domain.\næ ¹çº§åç§°æœåŠ¡å™¨ï¼šè¿™äº›æœåŠ¡å™¨æ¥æ”¶æ¥è‡ªæœ¬åœ°æœåŠ¡å™¨çš„è¯·æ±‚ã€‚æ ¹åç§°æœåŠ¡å™¨ç»´æŠ¤åŸºäºé¡¶çº§åŸŸåçš„åç§°æœåŠ¡å™¨ï¼Œä¾‹å¦‚ .com ã€ .edu ã€ .us ç­‰ã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·è¯·æ±‚ educative.io çš„ IP åœ°å€æ—¶ï¼Œæ ¹çº§åç§°æœåŠ¡å™¨å°†è¿”å›ä¿å­˜ .io åŸŸçš„ IP åœ°å€çš„é¡¶çº§åŸŸ (TLD) æœåŠ¡å™¨åˆ—è¡¨ã€‚\nTop-level domain (TLD) name servers: These servers hold the IP addresses of authoritative name servers. The querying party will get a list of IP addresses that belong to the authoritative servers of the organization.\né¡¶çº§åŸŸå (TLD) åç§°æœåŠ¡å™¨ï¼šè¿™äº›æœåŠ¡å™¨ä¿å­˜æƒå¨åç§°æœåŠ¡å™¨çš„ IP åœ°å€ã€‚æŸ¥è¯¢æ–¹å°†è·å¾—å±äºè¯¥ç»„ç»‡çš„æƒå¨æœåŠ¡å™¨çš„IPåœ°å€åˆ—è¡¨ã€‚\nAuthoritative name servers: These are the organizationâ€™s DNS name servers that provide the IP addresses of the web or application servers.\næƒå¨åç§°æœåŠ¡å™¨ï¼šè¿™äº›æ˜¯ç»„ç»‡çš„ DNS åç§°æœåŠ¡å™¨ï¼Œæä¾› Web æˆ–åº”ç”¨ç¨‹åºæœåŠ¡å™¨çš„ IP åœ°å€ã€‚\nQuestion\né—®é¢˜\nHow are DNS names processed? For example, will educative.io be processed from left to right or right to left?\nDNS åç§°æ˜¯å¦‚ä½•å¤„ç†çš„ï¼Ÿä¾‹å¦‚ï¼Œeducative.io æ˜¯ä»å·¦åˆ°å³è¿˜æ˜¯ä»å³åˆ°å·¦å¤„ç†ï¼Ÿ\nUnlike UNIX files, which are processed from left to right, DNS names are processed from right to left. In the case of educative.io, the resolvers will first resolve the .io part, then educative, and so on.\nä¸ä»å·¦åˆ°å³å¤„ç†çš„ UNIX æ–‡ä»¶ä¸åŒï¼ŒDNS åç§°æ˜¯ä»å³åˆ°å·¦å¤„ç†çš„ã€‚å¯¹äº educative.ioï¼Œè§£æå™¨å°†é¦–å…ˆè§£æ .io éƒ¨åˆ†ï¼Œç„¶åè§£æ educative ï¼Œä¾æ­¤ç±»æ¨ã€‚\nVisually, however, the DNS hierarchy can be viewed as a tree.\nç„¶è€Œï¼Œä»è§†è§‰ä¸Šçœ‹ï¼ŒDNS å±‚æ¬¡ç»“æ„å¯ä»¥è§†ä¸ºä¸€æ£µæ ‘ã€‚\nIterative versus recursive query resolution è¿­ä»£ä¸é€’å½’æŸ¥è¯¢è§£æ\nThere are two ways to perform a DNS query:\næœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥æ‰§è¡Œ DNS æŸ¥è¯¢ï¼š\nIterative: The local server requests the root, TLD, and the authoritative servers for the IP address.\nè¿­ä»£ï¼šæœ¬åœ°æœåŠ¡å™¨å‘æ ¹æœåŠ¡å™¨ã€TLD å’Œæƒå¨æœåŠ¡å™¨è¯·æ±‚ IP åœ°å€ã€‚\nRecursive: The end user requests the local server. The local server further requests the root DNS name servers. The root name servers forward the requests to other name servers.\né€’å½’ï¼šæœ€ç»ˆç”¨æˆ·è¯·æ±‚æœ¬åœ°æœåŠ¡å™¨ã€‚æœ¬åœ°æœåŠ¡å™¨è¿›ä¸€æ­¥è¯·æ±‚æ ¹ DNS åç§°æœåŠ¡å™¨ã€‚æ ¹åç§°æœåŠ¡å™¨å°†è¯·æ±‚è½¬å‘åˆ°å…¶ä»–åç§°æœåŠ¡å™¨ã€‚\nIn the following illustration (on the left), DNS query resolution is iterative from the perspective of the local/ISP server:\nåœ¨ä¸‹å›¾ä¸­ï¼ˆå·¦ï¼‰ï¼Œä»æœ¬åœ°/ISPæœåŠ¡å™¨çš„è§’åº¦æ¥çœ‹ï¼ŒDNSæŸ¥è¯¢è§£ææ˜¯è¿­ä»£çš„ï¼š\nNote: Typically, an iterative query is preferred to reduce query load on DNS infrastructure.\næ³¨æ„ï¼šé€šå¸¸ï¼Œé¦–é€‰è¿­ä»£æŸ¥è¯¢æ¥å‡å°‘ DNS åŸºç¡€è®¾æ–½ä¸Šçš„æŸ¥è¯¢è´Ÿè½½ã€‚\nThese days, weâ€™ll find many third-party public DNS resolvers offered by Google, Cloudflare, OpenDNS, and many more. The interesting fact is that these public DNS servers may provide quicker responses than the local ISP DNS facilities.\nå¦‚ä»Šï¼Œæˆ‘ä»¬ä¼šå‘ç° Googleã€Cloudflareã€OpenDNS ç­‰æä¾›çš„è®¸å¤šç¬¬ä¸‰æ–¹å…¬å…± DNS è§£æå™¨ã€‚æœ‰è¶£çš„æ˜¯ï¼Œè¿™äº›å…¬å…± DNS æœåŠ¡å™¨å¯èƒ½æ¯”æœ¬åœ° ISP DNS è®¾æ–½æä¾›æ›´å¿«çš„å“åº”ã€‚\nCaching ç¼“å­˜\nCaching refers to the temporary storage of frequently requested resource records. A record is a data unit within the DNS database that shows a name-to-value binding. Caching reduces response time to the user and decreases network traffic. When we use caching at different hierarchies, it can reduce a lot of querying burden on the DNS infrastructure. Caching can be implemented in the browser, operating systems, local name server within the userâ€™s network, or the ISPâ€™s DNS resolvers.\nç¼“å­˜æ˜¯æŒ‡ä¸´æ—¶å­˜å‚¨ç»å¸¸è¯·æ±‚çš„èµ„æºè®°å½•ã€‚ è®°å½•æ˜¯ DNS æ•°æ®åº“ä¸­çš„ä¸€ä¸ªæ•°æ®å•å…ƒï¼Œæ˜¾ç¤ºåç§°åˆ°å€¼çš„ç»‘å®šã€‚ç¼“å­˜å‡å°‘äº†ç”¨æˆ·çš„å“åº”æ—¶é—´å¹¶å‡å°‘äº†ç½‘ç»œæµé‡ã€‚å½“æˆ‘ä»¬åœ¨ä¸åŒçš„å±‚æ¬¡ç»“æ„ä¸­ä½¿ç”¨ç¼“å­˜æ—¶ï¼Œå®ƒå¯ä»¥å‡è½» DNS åŸºç¡€è®¾æ–½çš„å¤§é‡æŸ¥è¯¢è´Ÿæ‹…ã€‚ç¼“å­˜å¯ä»¥åœ¨æµè§ˆå™¨ã€æ“ä½œç³»ç»Ÿã€ç”¨æˆ·ç½‘ç»œå†…çš„æœ¬åœ°åç§°æœåŠ¡å™¨æˆ– ISP çš„ DNS è§£æå™¨ä¸­å®ç°ã€‚\nThe slideshow below demonstrates the power of caching in the DNS:\nä¸‹é¢çš„å¹»ç¯ç‰‡å±•ç¤ºäº† DNS ä¸­ç¼“å­˜çš„å¼ºå¤§åŠŸèƒ½ï¼š\nNote: Even if there is no cache available to resolve a userâ€™s query and itâ€™s imperative to visit the DNS infrastructure, caching can still be beneficial. The local server or ISP DNS resolver can cache the IP addresses of TLD servers or authoritative servers and avoid requesting the root-level server.\næ³¨æ„ï¼šå³ä½¿æ²¡æœ‰å¯ç”¨çš„ç¼“å­˜æ¥è§£æç”¨æˆ·çš„æŸ¥è¯¢å¹¶ä¸”å¿…é¡»è®¿é—® DNS åŸºç¡€è®¾æ–½ï¼Œç¼“å­˜ä»ç„¶æ˜¯æœ‰ç›Šçš„ã€‚æœ¬åœ°æœåŠ¡å™¨æˆ–ISP DNSè§£æå™¨å¯ä»¥ç¼“å­˜TLDæœåŠ¡å™¨æˆ–æƒå¨æœåŠ¡å™¨çš„IPåœ°å€ï¼Œå¹¶é¿å…è¯·æ±‚æ ¹çº§æœåŠ¡å™¨ã€‚\nDNS as a distributed system DNS ä½œä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿ\nAlthough the DNS hierarchy facilitates the distributed Internet that we know today, itâ€™s a distributed system itself. The distributed nature of DNS has the following advantages:\nå°½ç®¡ DNS å±‚æ¬¡ç»“æ„ä¿ƒè¿›äº†æˆ‘ä»¬ä»Šå¤©æ‰€çŸ¥çš„åˆ†å¸ƒå¼äº’è”ç½‘ï¼Œä½†å®ƒæœ¬èº«å°±æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿã€‚ DNSçš„åˆ†å¸ƒå¼ç‰¹æ€§å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š\nIt avoids becoming a single point of failure (SPOF).\nå®ƒé¿å…æˆä¸ºå•ç‚¹æ•…éšœ (SPOF)ã€‚\nIt achieves low query latency so users can get responses from nearby servers.\nå®ƒå®ç°äº†ä½æŸ¥è¯¢å»¶è¿Ÿï¼Œå› æ­¤ç”¨æˆ·å¯ä»¥ä»é™„è¿‘çš„æœåŠ¡å™¨è·å¾—å“åº”ã€‚\nIt gets a higher degree of flexibility during maintenance and updates or upgrades. For example, if one DNS server is down or overburdened, another DNS server can respond to user queries.\nå®ƒåœ¨ç»´æŠ¤å’Œæ›´æ–°æˆ–å‡çº§è¿‡ç¨‹ä¸­è·å¾—æ›´é«˜ç¨‹åº¦çš„çµæ´»æ€§ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€å° DNS æœåŠ¡å™¨å‘ç”Ÿæ•…éšœæˆ–è´Ÿè½½è¿‡é‡ï¼Œå¦ä¸€å° DNS æœåŠ¡å™¨å¯ä»¥å“åº”ç”¨æˆ·æŸ¥è¯¢ã€‚\nThere are 13 logical root name servers (named letter A through M) with many instances spread throughout the globe. These servers are managed by 12 different organizations.\næœ‰ 13 ä¸ªé€»è¾‘æ ¹åç§°æœåŠ¡å™¨ï¼ˆå‘½åä¸ºå­—æ¯ A åˆ° Mï¼‰ï¼Œå…¶ä¸­è®¸å¤šå®ä¾‹éå¸ƒå…¨çƒã€‚è¿™äº›æœåŠ¡å™¨ç”± 12 ä¸ªä¸åŒçš„ç»„ç»‡ç®¡ç†ã€‚\nLetâ€™s now go over how DNS is scalable, reliable, and consistent.\nç°åœ¨è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ DNS å¦‚ä½•å®ç°å¯æ‰©å±•ã€å¯é å’Œä¸€è‡´ã€‚\nHighly scalable é«˜åº¦å¯æ‰©å±•\nDue to its hierarchical nature, DNS is a highly scalable system. Roughly 1,000 replicated instances of 13 root-level servers are spread throughout the world strategically to handle user queries. The working labor is divided among TLD and root servers to handle a query and, finally, the authoritative servers that are managed by the organizations themselves to make the entire system work. As shown in the DNS hierarchy tree above, different services handle different portions of the tree enabling scalability and manageability of the system.\nç”±äºå…¶åˆ†å±‚æ€§è´¨ï¼ŒDNS æ˜¯ä¸€ä¸ªé«˜åº¦å¯æ‰©å±•çš„ç³»ç»Ÿã€‚ 13 å°æ ¹çº§æœåŠ¡å™¨çš„å¤§çº¦ 1,000 ä¸ªå¤åˆ¶å®ä¾‹æˆ˜ç•¥æ€§åœ°åˆ†å¸ƒåœ¨ä¸–ç•Œå„åœ°ï¼Œä»¥å¤„ç†ç”¨æˆ·æŸ¥è¯¢ã€‚å·¥ä½œåŠ³åŠ›è¢«åˆ†é…åˆ° TLD å’Œæ ¹æœåŠ¡å™¨æ¥å¤„ç†æŸ¥è¯¢ï¼Œæœ€ååˆ†é…åˆ°ç”±ç»„ç»‡è‡ªå·±ç®¡ç†çš„æƒå¨æœåŠ¡å™¨ä»¥ä½¿æ•´ä¸ªç³»ç»Ÿæ­£å¸¸è¿è¡Œã€‚å¦‚ä¸Šé¢çš„ DNS å±‚æ¬¡ç»“æ„æ ‘æ‰€ç¤ºï¼Œä¸åŒçš„æœåŠ¡å¤„ç†æ ‘çš„ä¸åŒéƒ¨åˆ†ï¼Œä»è€Œå®ç°ç³»ç»Ÿçš„å¯æ‰©å±•æ€§å’Œå¯ç®¡ç†æ€§ã€‚\nReliable å¯é æ€§\nThree main reasons make the DNS a reliable system:\nDNS æˆä¸ºå¯é ç³»ç»Ÿçš„ä¸‰ä¸ªä¸»è¦åŸå› ï¼š\nCaching: The caching is done in the browser, the operating system, and the local name server, and the ISP DNS resolvers also maintain a rich cache of frequently visited services. Even if some DNS servers are temporarily down, cached records can be served to make DNS a reliable system.\nç¼“å­˜ï¼šç¼“å­˜æ˜¯åœ¨æµè§ˆå™¨ã€æ“ä½œç³»ç»Ÿå’Œæœ¬åœ°åç§°æœåŠ¡å™¨ä¸­å®Œæˆçš„ï¼ŒISP DNS è§£æå™¨è¿˜ç»´æŠ¤ç€ç»å¸¸è®¿é—®çš„æœåŠ¡çš„ä¸°å¯Œç¼“å­˜ã€‚å³ä½¿æŸäº› DNS æœåŠ¡å™¨æš‚æ—¶å…³é—­ï¼Œä¹Ÿå¯ä»¥æä¾›ç¼“å­˜è®°å½•ï¼Œä½¿ DNS æˆä¸ºä¸€ä¸ªå¯é çš„ç³»ç»Ÿã€‚\nServer replication: DNS has replicated copies of each logical server spread systematically across the globe to entertain user requests at low latency. The redundant servers improve the reliability of the overall system.\næœåŠ¡å™¨å¤åˆ¶ï¼šDNS ç³»ç»Ÿåœ°å¤åˆ¶äº†éå¸ƒå…¨çƒçš„æ¯ä¸ªé€»è¾‘æœåŠ¡å™¨çš„å‰¯æœ¬ï¼Œä»¥ä½å»¶è¿Ÿå¤„ç†ç”¨æˆ·è¯·æ±‚ã€‚å†—ä½™æœåŠ¡å™¨æé«˜äº†æ•´ä¸ªç³»ç»Ÿçš„å¯é æ€§ã€‚\nProtocol: Although many clients rely on the unreliable User Datagram Protocol (UDP) to request and receive DNS responses, it is important to acknowledge that UDP also offers distinct advantages. UDP is much faster and, therefore, improves DNS performance. Furthermore, Internet serviceâ€™s reliability has improved since its inception, so UDP is usually favored over TCP. A DNS resolver can resend the UDP request if it didnâ€™t get a reply to a previous one. This request-response needs just one round trip, which provides a shorter delay as compared to TCP, which needs a three-way handshake before data exchange.\nåè®®ï¼šå°½ç®¡è®¸å¤šå®¢æˆ·ç«¯ä¾èµ–ä¸å¯é çš„ç”¨æˆ·æ•°æ®æŠ¥åè®® (UDP) æ¥è¯·æ±‚å’Œæ¥æ”¶ DNS å“åº”ï¼Œä½†é‡è¦çš„æ˜¯è¦æ‰¿è®¤ UDP ä¹Ÿæä¾›äº†ç‹¬ç‰¹çš„ä¼˜åŠ¿ã€‚ UDP é€Ÿåº¦æ›´å¿«ï¼Œå› æ­¤å¯ä»¥æé«˜ DNS æ€§èƒ½ã€‚æ­¤å¤–ï¼Œè‡ªè¯ç”Ÿä»¥æ¥ï¼Œäº’è”ç½‘æœåŠ¡çš„å¯é æ€§å·²å¾—åˆ°æé«˜ï¼Œå› æ­¤ UDP é€šå¸¸æ¯” TCP æ›´å—é’çã€‚å¦‚æœ DNS è§£æå™¨æ²¡æœ‰æ”¶åˆ°å‰ä¸€ä¸ªè¯·æ±‚çš„å›å¤ï¼Œåˆ™å¯ä»¥é‡æ–°å‘é€ UDP è¯·æ±‚ã€‚è¿™ç§è¯·æ±‚-å“åº”ä»…éœ€è¦ä¸€æ¬¡å¾€è¿”ï¼Œä¸åœ¨æ•°æ®äº¤æ¢ä¹‹å‰éœ€è¦ä¸‰æ¬¡æ¡æ‰‹çš„ TCP ç›¸æ¯”ï¼Œå»¶è¿Ÿæ›´çŸ­ã€‚\nQuestion\né—®é¢˜\nWhat happens if a network is congested? Should DNS continue using UDP?\nå¦‚æœç½‘ç»œæ‹¥å¡ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ DNS æ˜¯å¦åº”è¯¥ç»§ç»­ä½¿ç”¨ UDPï¼Ÿ\nTypically, DNS uses UDP. However, DNS can use TCP when its message size exceeds the original packet size of 512 Bytes. This is because large-size packets are more prone to be damaged in congested networks. DNS always uses TCP for zone transfers.\né€šå¸¸ï¼ŒDNS ä½¿ç”¨ UDPã€‚ä½†æ˜¯ï¼Œå½“ DNS çš„æ¶ˆæ¯å¤§å°è¶…è¿‡åŸå§‹æ•°æ®åŒ…å¤§å° 512 å­—èŠ‚æ—¶ï¼ŒDNS å¯ä»¥ä½¿ç”¨ TCPã€‚è¿™æ˜¯å› ä¸ºå¤§å°ºå¯¸æ•°æ®åŒ…åœ¨æ‹¥å¡çš„ç½‘ç»œä¸­æ›´å®¹æ˜“è¢«æŸåã€‚ DNS å§‹ç»ˆä½¿ç”¨ TCP è¿›è¡ŒåŒºåŸŸä¼ è¾“ã€‚\nSome clients prefer DNS over TCP to employ transport layer security for privacy reasons.\nå‡ºäºéšç§åŸå› ï¼ŒæŸäº›å®¢æˆ·ç«¯æ›´å–œæ¬¢ä½¿ç”¨ DNS è€Œä¸æ˜¯ TCP æ¥é‡‡ç”¨ä¼ è¾“å±‚å®‰å…¨æ€§ã€‚\nConsistent ä¸€è‡´æ€§\nDNS uses various protocols to update and transfer information among replicated servers in a hierarchy. DNS compromises on strong consistency to achieve high performance because data is read frequently from DNS databases as compared to writing. However, DNS provides eventual consistency and updates records on replicated servers lazily. Typically, it can take from a few seconds up to three days to update records on the DNS servers across the Internet. The time it takes to propagate information among different DNS clusters depends on the DNS infrastructure, the size of the update, and which part of the DNS tree is being updated.\nDNS ä½¿ç”¨å„ç§åè®®åœ¨å±‚æ¬¡ç»“æ„ä¸­çš„å¤åˆ¶æœåŠ¡å™¨ä¹‹é—´æ›´æ–°å’Œä¼ è¾“ä¿¡æ¯ã€‚ DNS ä¼šåœ¨å¼ºä¸€è‡´æ€§æ–¹é¢åšå‡ºå¦¥åä»¥å®ç°é«˜æ€§èƒ½ï¼Œå› ä¸ºä¸å†™å…¥ç›¸æ¯”ï¼Œä» DNS æ•°æ®åº“ä¸­è¯»å–æ•°æ®çš„é¢‘ç‡æ›´é«˜ã€‚ç„¶è€Œï¼ŒDNS æä¾›æœ€ç»ˆä¸€è‡´æ€§å¹¶å»¶è¿Ÿæ›´æ–°å¤åˆ¶æœåŠ¡å™¨ä¸Šçš„è®°å½•ã€‚é€šå¸¸ï¼Œæ›´æ–° Internet ä¸Š DNS æœåŠ¡å™¨ä¸Šçš„è®°å½•å¯èƒ½éœ€è¦å‡ ç§’é’Ÿåˆ°ä¸‰å¤©çš„æ—¶é—´ã€‚åœ¨ä¸åŒ DNS é›†ç¾¤ä¹‹é—´ä¼ æ’­ä¿¡æ¯æ‰€éœ€çš„æ—¶é—´å–å†³äº DNS åŸºç¡€è®¾æ–½ã€æ›´æ–°çš„å¤§å°ä»¥åŠæ­£åœ¨æ›´æ–° DNS æ ‘çš„å“ªä¸€éƒ¨åˆ†ã€‚\nConsistency can suffer because of caching too. Since authoritative servers are located within the organization, it may be possible that certain resource records are updated on the authoritative servers in case of server failures at the organization. Therefore, cached records at the default/local and ISP servers may be outdated. To mitigate this issue, each cached record comes with an expiration time called time-to-live (TTL).\nç”±äºç¼“å­˜ï¼Œä¸€è‡´æ€§ä¹Ÿä¼šå—åˆ°å½±å“ã€‚ç”±äºæƒå¨æœåŠ¡å™¨ä½äºç»„ç»‡å†…ï¼Œå› æ­¤åœ¨ç»„ç»‡ä¸­çš„æœåŠ¡å™¨å‘ç”Ÿæ•…éšœçš„æƒ…å†µä¸‹ï¼Œæƒå¨æœåŠ¡å™¨ä¸Šçš„æŸäº›èµ„æºè®°å½•å¯èƒ½ä¼šè¢«æ›´æ–°ã€‚å› æ­¤ï¼Œé»˜è®¤/æœ¬åœ°å’Œ ISP æœåŠ¡å™¨ä¸Šçš„ç¼“å­˜è®°å½•å¯èƒ½ä¼šè¿‡æ—¶ã€‚ä¸ºäº†ç¼“è§£æ­¤é—®é¢˜ï¼Œæ¯ä¸ªç¼“å­˜è®°å½•éƒ½å¸¦æœ‰ä¸€ä¸ªç§°ä¸ºç”Ÿå­˜æ—¶é—´ (TTL) çš„è¿‡æœŸæ—¶é—´ã€‚\nQuestion\né—®é¢˜\nTo maintain high availability, should the TTL value be large or small?\nä¸ºäº†ä¿æŒé«˜å¯ç”¨æ€§ï¼ŒTTLå€¼åº”è¯¥å¤§è¿˜æ˜¯å°ï¼Ÿ\nTo maintain high availability, the TTL value should be small. This is because if any server or cluster fails, the organization can update the resource records right away. Users will experience non-availability only for the time the TTL isnâ€™t expired. However, if the TTL is large, the organization will update its resource records, whereas users will keep pinging the outdated server that would have crashed long ago. Companies that long for high availability maintain a TTL value as low as 120 seconds. Therefore, even in case of a failure, the maximum downtime is a few minutes.\nä¸ºäº†ä¿æŒé«˜å¯ç”¨æ€§ï¼ŒTTLå€¼åº”è¯¥å¾ˆå°ã€‚è¿™æ˜¯å› ä¸ºå¦‚æœä»»ä½•æœåŠ¡å™¨æˆ–é›†ç¾¤å‘ç”Ÿæ•…éšœï¼Œç»„ç»‡å¯ä»¥ç«‹å³æ›´æ–°èµ„æºè®°å½•ã€‚ä»…åœ¨ TTL æœªè¿‡æœŸæœŸé—´ï¼Œç”¨æˆ·æ‰ä¼šé‡åˆ°ä¸å¯ç”¨çš„æƒ…å†µã€‚ç„¶è€Œï¼Œå¦‚æœ TTL å¾ˆå¤§ï¼Œç»„ç»‡å°†æ›´æ–°å…¶èµ„æºè®°å½•ï¼Œè€Œç”¨æˆ·å°†ç»§ç»­ ping æ—©å°±å´©æºƒçš„è¿‡æ—¶æœåŠ¡å™¨ã€‚æ¸´æœ›é«˜å¯ç”¨æ€§çš„å…¬å¸å°† TTL å€¼ç»´æŒåœ¨ä½è‡³ 120 ç§’ã€‚å› æ­¤ï¼Œå³ä½¿å‘ç”Ÿæ•…éšœï¼Œæœ€é•¿åœæœºæ—¶é—´ä¹Ÿåªæœ‰å‡ åˆ†é’Ÿã€‚\nTest it out æµ‹è¯•ä¸€ä¸‹\nLetâ€™s run a couple of commands. Click on the terminal to execute the following commands. Copy the following commands in the terminal to run them. Study the output of the commands:\nè®©æˆ‘ä»¬è¿è¡Œå‡ ä¸ªå‘½ä»¤ã€‚å•å‡»ç»ˆç«¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ã€‚åœ¨ç»ˆç«¯ä¸­å¤åˆ¶ä»¥ä¸‹å‘½ä»¤æ¥è¿è¡Œå®ƒä»¬ã€‚ç ”ç©¶å‘½ä»¤çš„è¾“å‡ºï¼š\nnslookup www.google.com dig www.google.com The following slide deck highlights some important aspects of nslookup and dig output.\nä»¥ä¸‹å¹»ç¯ç‰‡é‡ç‚¹ä»‹ç»äº† nslookup å’Œ dig è¾“å‡ºçš„ä¸€äº›é‡è¦æ–¹é¢ã€‚\nLetâ€™s go through the meaning of the output:\næˆ‘ä»¬æ¥çœ‹çœ‹è¾“å‡ºçš„å«ä¹‰ï¼š\nThe nslookup output nslookup è¾“å‡º\nThe Non-authoritative answer, as the name suggests, is the answer provided by a server that is not the authoritative server of Google. It isnâ€™t in the list of authoritative nameservers that Google maintains. So, where does the answer come from? The answer is provided by second, third, and fourth-hand name servers configured to reply to our DNS queryâ€”for example, our university or office DNS resolver, our ISP nameserver, our ISPâ€™s ISP nameserver, and so on. In short, it can be considered as a cached version of Googleâ€™s authoritative nameservers response. If we try multiple domain names, weâ€™ll realize that we receive a cached response most of the time.\nNon-authoritative answer ï¼Œé¡¾åæ€ä¹‰ï¼Œæ˜¯ç”±é Google æƒå¨æœåŠ¡å™¨æä¾›çš„ç­”æ¡ˆã€‚å®ƒä¸åœ¨ Google ç»´æŠ¤çš„æƒå¨åŸŸåæœåŠ¡å™¨åˆ—è¡¨ä¸­ã€‚é‚£ä¹ˆï¼Œç­”æ¡ˆä»ä½•è€Œæ¥ï¼Ÿç­”æ¡ˆç”±é…ç½®ä¸ºå›å¤æˆ‘ä»¬çš„ DNS æŸ¥è¯¢çš„ç¬¬äºŒæ‰‹ã€ç¬¬ä¸‰æ‰‹å’Œç¬¬å››æ‰‹åç§°æœåŠ¡å™¨æä¾›ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„å¤§å­¦æˆ–åŠå…¬å®¤ DNS è§£æå™¨ã€æˆ‘ä»¬çš„ ISP åç§°æœåŠ¡å™¨ã€æˆ‘ä»¬ ISP çš„ ISP åç§°æœåŠ¡å™¨ç­‰ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå®ƒå¯ä»¥è¢«è§†ä¸º Google æƒå¨åŸŸåæœåŠ¡å™¨å“åº”çš„ç¼“å­˜ç‰ˆæœ¬ã€‚å¦‚æœæˆ‘ä»¬å°è¯•å¤šä¸ªåŸŸåï¼Œæˆ‘ä»¬ä¼šå‘ç°å¤§å¤šæ•°æ—¶å€™æˆ‘ä»¬éƒ½ä¼šæ”¶åˆ°ç¼“å­˜çš„å“åº”ã€‚\nIf we run the same command multiple times, weâ€™ll receive the same IP addresses list but in a different order each time. The reason for that is DNS is indirectly performing load balancing. Itâ€™s an important term that weâ€™ll gain familiarity with in the coming lessons.\nå¦‚æœæˆ‘ä»¬å¤šæ¬¡è¿è¡Œç›¸åŒçš„å‘½ä»¤ï¼Œæˆ‘ä»¬å°†æ”¶åˆ°ç›¸åŒçš„ IP åœ°å€åˆ—è¡¨ï¼Œä½†æ¯æ¬¡çš„é¡ºåºä¸åŒã€‚åŸå› æ˜¯ DNS é—´æ¥æ‰§è¡Œè´Ÿè½½å¹³è¡¡ã€‚è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„æœ¯è¯­ï¼Œæˆ‘ä»¬å°†åœ¨æ¥ä¸‹æ¥çš„è¯¾ç¨‹ä¸­ç†Ÿæ‚‰å®ƒã€‚\nThe dig output dig è¾“å‡º\nThe Query time: 4 msec represents the time it takes to get a response from the DNS server. For various reasons, these numbers may be different in our case.\nQuery time: 4 msec è¡¨ç¤ºä» DNS æœåŠ¡å™¨è·å–å“åº”æ‰€éœ€çš„æ—¶é—´ã€‚ç”±äºå„ç§åŸå› ï¼Œè¿™äº›æ•°å­—åœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­å¯èƒ½æœ‰æ‰€ä¸åŒã€‚\nThe 300 value in the ANSWER SECTION represents the number of seconds the cache is maintained in the DNS resolver. This means that Googleâ€™s ADNS keeps a TTL value of five minutes (300/60 sec).\nANSWER SECTION ä¸­çš„ 300 å€¼è¡¨ç¤º DNS è§£æå™¨ä¸­ç»´æŠ¤ç¼“å­˜çš„ç§’æ•°ã€‚è¿™æ„å‘³ç€ Google çš„ ADNS å°† TTL å€¼ä¿æŒä¸ºäº”åˆ†é’Ÿï¼ˆ300/60 ç§’ï¼‰ã€‚\nNote: We invite you to test different services for their TTL and query times to strengthen your understanding. You may use the above terminal for this purpose.\næ³¨æ„ï¼šæˆ‘ä»¬é‚€è¯·æ‚¨æµ‹è¯•ä¸åŒæœåŠ¡çš„ TTL å’ŒæŸ¥è¯¢æ—¶é—´ï¼Œä»¥åŠ æ·±æ‚¨çš„ç†è§£ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä¸Šè¿°ç»ˆç«¯æ¥å®ç°æ­¤ç›®çš„ã€‚\nQuestion\né—®é¢˜\nIf we need DNS to tell us which IP to reach a website or service, how will we know the DNS resolverâ€™s IP address? (It seems like a chicken-and-egg problem!)\nå¦‚æœæˆ‘ä»¬éœ€è¦ DNS å‘Šè¯‰æˆ‘ä»¬å“ªä¸ª IP å¯ä»¥è®¿é—®ç½‘ç«™æˆ–æœåŠ¡ï¼Œæˆ‘ä»¬å¦‚ä½•çŸ¥é“ DNS è§£æå™¨çš„ IP åœ°å€ï¼Ÿ ï¼ˆè¿™ä¼¼ä¹æ˜¯ä¸€ä¸ªå…ˆæœ‰é¸¡è¿˜æ˜¯å…ˆæœ‰è›‹çš„é—®é¢˜ï¼ï¼‰\nEnd usersâ€™ operating systems have configuration files (/etc/resolv.conf in Linux) with the DNS resolversâ€™ IP addresses, which in turn obtain all information for them. (Often, DHCP provides the default DNS resolver IP address along with other configurations.) The end-systems request DNS resolves for any DNS queries. DNS resolvers have special software installed to resolve queries through the DNS infrastructure. The root serverâ€™s IP addresses are within the special software. Typically, the Berkeley Internet Name Domain (BIND) software is used on DNS resolvers. The InterNIC maintains the updated list of 13 root servers.\næœ€ç»ˆç”¨æˆ·çš„æ“ä½œç³»ç»Ÿå…·æœ‰åŒ…å« DNS è§£æå™¨ IP åœ°å€çš„é…ç½®æ–‡ä»¶ï¼ˆLinux ä¸­ä¸º /etc/resolv.conf ï¼‰ï¼Œè€Œ DNS è§£æå™¨åˆä¼šè·å–å…¶æ‰€æœ‰ä¿¡æ¯ã€‚ ï¼ˆé€šå¸¸ï¼ŒDHCP æä¾›é»˜è®¤ DNS è§£æå™¨ IP åœ°å€ä»¥åŠå…¶ä»–é…ç½®ã€‚ï¼‰ç»ˆç«¯ç³»ç»Ÿè¯·æ±‚ DNS è§£æä»»ä½• DNS æŸ¥è¯¢ã€‚ DNS è§£æå™¨å®‰è£…äº†ç‰¹æ®Šè½¯ä»¶æ¥é€šè¿‡ DNS åŸºç¡€è®¾æ–½è§£ææŸ¥è¯¢ã€‚æ ¹æœåŠ¡å™¨çš„IPåœ°å€ä½äºç‰¹æ®Šè½¯ä»¶å†…ã€‚é€šå¸¸ï¼Œä¼¯å…‹åˆ©äº’è”ç½‘åç§°åŸŸ (BIND) è½¯ä»¶ç”¨äº DNS è§£æå™¨ã€‚ InterNIC ç»´æŠ¤ç€ 13 ä¸ªæ ¹æœåŠ¡å™¨çš„æ›´æ–°åˆ—è¡¨ã€‚\nSo, we break the chicken-and-egg problem by seeding each resolver with prior knowledge of root DNS servers (whose IPs rarely change).\nå› æ­¤ï¼Œæˆ‘ä»¬é€šè¿‡ä¸ºæ¯ä¸ªè§£æå™¨æä¾›æ ¹ DNS æœåŠ¡å™¨ï¼ˆå…¶ IP å¾ˆå°‘æ›´æ”¹ï¼‰çš„å…ˆéªŒçŸ¥è¯†æ¥è§£å†³å…ˆæœ‰é¸¡è¿˜æ˜¯å…ˆæœ‰è›‹çš„é—®é¢˜ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/11/17/dns/","summary":"è¿™æ˜¯ä¸€ç¯‡åŒè¯­ç¿»è¯‘çš„æ–‡ç« ï¼ŒåŸæ–‡å‡ºè‡ªã€ŠGrokking the System Design Interviewã€‹æ•™ç¨‹çš„ Domain Name System è¿™ç¯‡ç« èŠ‚ã€‚\nIntroduction to Domain Name System (DNS) åŸŸåç³»ç»Ÿ (DNS) ç®€ä»‹\nThe origins of DNS DNS çš„èµ·æº\nLetâ€™s consider the example of a mobile phone where a unique number is associated with each user. To make calls to friends, we can initially try to memorize some of the phone numbers. However, as the number of contacts grows, weâ€™ll have to use a phone book to keep track of all our contacts. This way, whenever we need to make a call, weâ€™ll refer to the phone book and dial the number we need.\nè®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªç§»åŠ¨ç”µè¯çš„ç¤ºä¾‹ï¼Œå…¶ä¸­æ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„å·ç ã€‚ä¸ºäº†ç»™æœ‹å‹æ‰“ç”µè¯ï¼Œæˆ‘ä»¬é¦–å…ˆå¯ä»¥å°è¯•è®°ä½ä¸€äº›ç”µè¯å·ç ã€‚ç„¶è€Œï¼Œéšç€è”ç³»äººæ•°é‡çš„å¢åŠ ï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸ä½¿ç”¨ç”µè¯ç°¿æ¥è·Ÿè¸ªæ‰€æœ‰è”ç³»äººã€‚è¿™æ ·ï¼Œæ¯å½“æˆ‘ä»¬éœ€è¦æ‰“ç”µè¯æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šæŸ¥é˜…ç”µè¯ç°¿å¹¶æ‹¨æ‰“æˆ‘ä»¬éœ€è¦çš„å·ç ã€‚","title":"[è¯‘]ã€ŠGrokking the System Design Interviewã€‹åŸŸåç³»ç»Ÿ"},{"content":"å¦‚ä½•ç”Ÿæˆä¸€ä¸ªçŸ­ç½‘å€æœåŠ¡ï¼Œå‚è€ƒ Design a URL Shortening Service / TinyURL å’Œ Designing a URL Shortening service like TinyURL ä¸¤ç¯‡æ–‡ç« ï¼Œæ•´ç†å¦‚ä¸‹ç¬”è®°ã€‚\nå…¶ä¸­ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š\nè®¾è®¡ä¸€ä¸ªç³»ç»Ÿæœ‰å“ªäº›æ­¥éª¤ éœ€æ±‚ é¢„ä¼° è®¾è®¡ é«˜å±‚æ¬¡è®¾è®¡ API è®¾è®¡ ç»†èŠ‚è®¾è®¡ è¯„ä¼° è®¾è®¡ä¸€ä¸ªçŸ­ç½‘å€æœåŠ¡çš„ç»†èŠ‚ è®¾è®¡æ­¥éª¤ Requirements éœ€æ±‚\nåŠŸèƒ½æ€§éœ€æ±‚ çŸ­ URL ç”Ÿæˆï¼šæˆ‘ä»¬çš„æœåŠ¡åº”è¯¥èƒ½å¤Ÿä¸ºç»™å®š URL ç”Ÿæˆå”¯ä¸€çš„è¾ƒçŸ­åˆ«åã€‚ é‡å®šå‘ï¼šç»™å®šä¸€ä¸ªçŸ­é“¾æ¥ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿåº”è¯¥èƒ½å¤Ÿå°†ç”¨æˆ·é‡å®šå‘åˆ°åŸå§‹ URLã€‚ è‡ªå®šä¹‰çŸ­é“¾æ¥ï¼šç”¨æˆ·åº”è¯¥èƒ½å¤Ÿä½¿ç”¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸ºå…¶ URL ç”Ÿæˆè‡ªå®šä¹‰çŸ­é“¾æ¥ã€‚ åˆ é™¤ï¼šåœ¨èµ‹äºˆæƒé™çš„æƒ…å†µä¸‹ï¼Œç”¨æˆ·åº”è¯¥èƒ½å¤Ÿåˆ é™¤æˆ‘ä»¬ç³»ç»Ÿç”Ÿæˆçš„çŸ­é“¾æ¥ã€‚ æ›´æ–°ï¼šå¦‚æœæœ‰é€‚å½“çš„æƒé™ï¼Œç”¨æˆ·åº”è¯¥èƒ½å¤Ÿæ›´æ–°ä¸çŸ­é“¾æ¥å…³è”çš„é•¿ URLã€‚ è¿‡æœŸæ—¶é—´ï¼šçŸ­é“¾æ¥å¿…é¡»æœ‰ä¸€ä¸ªé»˜è®¤çš„è¿‡æœŸæ—¶é—´ï¼Œä½†ç”¨æˆ·åº”è¯¥å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚ åˆ†åŠŸèƒ½æ€§éœ€æ±‚ï¼šå¯ç”¨æ€§ã€å¯é æ€§ã€æ‰©å±•æ€§ã€å¯ç»´æŠ¤æ€§ã€å®¹é”™æ€§ å¯ç”¨æ€§ï¼šæˆ‘ä»¬çš„ç³»ç»Ÿåº”è¯¥å…·æœ‰é«˜å¯ç”¨æ€§ï¼Œå› ä¸ºå³ä½¿æ˜¯ç¬¬äºŒæ¬¡åœæœºçš„ä¸€å°éƒ¨åˆ†ä¹Ÿä¼šå¯¼è‡´ URL é‡å®šå‘å¤±è´¥ã€‚ç”±äºæˆ‘ä»¬ç³»ç»Ÿçš„åŸŸä½äº URL ä¸­ï¼Œå› æ­¤æˆ‘ä»¬æ²¡æœ‰åœæœºæ—¶é—´çš„ä¼˜åŠ¿ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„è®¾è®¡å¿…é¡»çŒè¾“å®¹é”™æ¡ä»¶ã€‚ å¯æ‰©å±•æ€§ï¼šæˆ‘ä»¬çš„ç³»ç»Ÿåº”è¯¥èƒ½å¤Ÿéšç€éœ€æ±‚çš„å¢åŠ è€Œæ°´å¹³æ‰©å±•ã€‚ å¯è¯»æ€§ï¼šæˆ‘ä»¬çš„ç³»ç»Ÿç”Ÿæˆçš„çŸ­é“¾æ¥åº”è¯¥æ˜“äºé˜…è¯»ã€åŒºåˆ†å’Œè¾“å…¥ã€‚ å»¶è¿Ÿï¼šç³»ç»Ÿåº”ä»¥ä½å»¶è¿Ÿæ‰§è¡Œï¼Œä»¥ä¾¿ä¸ºç”¨æˆ·æä¾›æµç•…çš„ä½“éªŒã€‚ ä¸å¯é¢„æµ‹æ€§ï¼šä»å®‰å…¨è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿç”Ÿæˆçš„çŸ­é“¾æ¥åº”è¯¥æ˜¯é«˜åº¦ä¸å¯é¢„æµ‹çš„ã€‚è¿™ç¡®ä¿äº†ä¸‹ä¸€ä¸ªçŸ­ URL ä¸ä¼šè¿ç»­ç”Ÿæˆï¼Œä»è€Œæ¶ˆé™¤äº†æœ‰äººçŒœæµ‹æˆ‘ä»¬çš„ç³»ç»Ÿå·²ç»ç”Ÿæˆæˆ–å°†ç”Ÿæˆçš„æ‰€æœ‰çŸ­ URL çš„å¯èƒ½æ€§ã€‚ Estimation ä¼°è®¡\næµé‡ è¯»å†™æ¯”ï¼š1:100 æ¯æœˆè¯·æ±‚æ•°ï¼š2 äº¿ å•æ¡è®°å½•å ç”¨ç©ºé—´ï¼š500B è®°å½•ä¿å­˜å¤šé•¿æ—¶é—´ï¼š5 å¹´ æ¯æ—¥æ´»è·ƒç”¨æˆ· (DAU) ï¼š1 äº¿ å­˜å‚¨ 5 å¹´è®°å½•æ•°ï¼š2 äº¿ x 5 x 12 =120 äº¿ æ€»å­˜å‚¨ï¼š120 äº¿ x 500B= 120 äº¿ x 0.5KB=6TB å¸¦å®½ æ¯ç§’å†™è¯·æ±‚ï¼š2 äº¿ / 30 /24 /60 /60 = 77æ¬¡/s å†™å…¥å¸¦å®½ï¼š77 x 500B =38KB/s è¯»å¸¦å®½ï¼š38 x 100 =3.8MB/s å†…å­˜ï¼šå­˜å‚¨çš„ 20% æ¯å¤©ç¼“å­˜å†…å­˜ï¼š77 x 100 x 24 x 3600 x 20% x 500B = 66GB æœåŠ¡å™¨ï¼š æ•°æ®é‡ï¼š1äº¿ /8000=12500 ä¸ºä»€ä¹ˆæŒ‰å•å°æœåŠ¡å™¨å¤„ç†å¹¶å‘è¯·æ±‚ 8000 è®¡ç®—ï¼Ÿ Design è®¾è®¡\nHigh-Level design é«˜å±‚æ¬¡è®¾è®¡\nç»„ä»¶\næ•°æ®åº“ï¼šéœ€è¦æ•°æ®åº“æ¥å­˜å‚¨é•¿ URL å’Œç›¸åº”çš„çŸ­ URL çš„æ˜ å°„ã€‚ åºåˆ—å™¨ï¼šSequencer å°†æä¾›å”¯ä¸€çš„ IDï¼Œä½œä¸ºæ¯ä¸ªçŸ­ URL ç”Ÿæˆçš„èµ·ç‚¹ã€‚ è´Ÿè½½å‡è¡¡ï¼šå„ä¸ªå±‚çš„è´Ÿè½½å‡è¡¡å™¨å°†ç¡®ä¿å¯ç”¨æœåŠ¡å™¨ä¹‹é—´çš„è¯·æ±‚å¹³ç¨³åˆ†é…ã€‚ ç¼“å­˜ï¼šç¼“å­˜å°†ç”¨äºå­˜å‚¨æœ€é¢‘ç¹çš„çŸ­ URL ç›¸å…³è¯·æ±‚ã€‚ é™æµå™¨ï¼šå°†ä½¿ç”¨é€Ÿç‡é™åˆ¶å™¨æ¥é¿å…ç³»ç»Ÿè¢«åˆ©ç”¨ã€‚ æœåŠ¡å™¨ï¼šç”¨äºå¤„ç†å’Œå¯¼èˆªæœåŠ¡è¯·æ±‚ä»¥åŠè¿è¡Œåº”ç”¨ç¨‹åºé€»è¾‘ã€‚ Base-58 ç¼–ç å™¨ï¼šç”¨äºå°†åºåˆ—å™¨çš„æ•°å­—è¾“å‡ºè½¬æ¢ä¸ºæ›´å¯è¯»å’Œæ›´å¯ç”¨çš„å­—æ¯æ•°å­—å½¢å¼ã€‚ è®¾è®¡å›¾\nApplication Programming Interfaces (APIs) API è®¾è®¡\nREST API åˆ›å»ºçŸ­ç½‘å€ shortURL(api_dev_key, original_url, custom_alias=None, expiry_date=None) é‡å®šå‘çŸ­ç½‘å€ redirectURL(api_dev_key, url_key) åˆ é™¤çŸ­ç½‘å€ deleteURL(api_dev_key, url_key) Detailed design è¯¦ç»†è®¾è®¡\nç»„ä»¶ æ•°æ®åº“ï¼š\nå­˜å‚¨\nç”¨æˆ·è¡¨\nIDã€name URL çš„æ˜ å°„\nIDã€urlã€createDateã€expireDateã€userId é€‰æ‹© NoSQLï¼š\né€‰æ‹© MongoDBï¼š\nå®ƒä½¿ç”¨é¢†å¯¼è€…-è·Ÿéšè€…åè®®ï¼Œä½¿å¾—ä½¿ç”¨å‰¯æœ¬è¿›è¡Œå¤§é‡è¯»å–æˆä¸ºå¯èƒ½ã€‚ MongoDB ç¡®ä¿å¹¶å‘å†™å…¥æ“ä½œçš„åŸå­æ€§ï¼Œå¹¶é€šè¿‡é’ˆå¯¹è®°å½•é‡å¤é—®é¢˜è¿”å›é‡å¤é”®é”™è¯¯æ¥é¿å…å†²çªã€‚ ä¸ºä»€ä¹ˆä¸é€‰æ‹© Cassandraã€Riak å’Œ DynamoDB ç­‰ NoSQL æ•°æ®åº“ï¼Ÿ\nCassandraã€Riak å’Œ DynamoDB ç­‰ NoSQL æ•°æ®åº“åœ¨è¯»å–é˜¶æ®µéœ€è¦è¯»å–ä¿®å¤ï¼Œå› æ­¤è¯»å–å†™å…¥æ€§èƒ½è¾ƒæ…¢ã€‚\nå®ƒä»¬æ˜¯æ— é¢†å¯¼è€…çš„ NoSQL æ•°æ®åº“ï¼Œåœ¨å¹¶å‘å†™å…¥æ—¶æä¾›è¾ƒå¼±çš„æ•°æ®ä¸€è‡´æ€§ä¿è¯ã€‚\nåºåˆ—å™¨ï¼š\nç”¨äºç”Ÿæˆå”¯ä¸€ ID çš„åºåˆ—å™¨ åºåˆ—å™¨ç”Ÿæˆ 64 ä½çš„æ•´æ•° IDï¼Œå¤§å°é™åˆ¶ä¸ºä» 1 äº¿åˆ° 2^63-1ï¼Œæœ€å¤§ä½æ•°ä¸º 20 è¡¨ç¤ºä¸€ä¸ªåè¿›åˆ¶æ•°å­—æ‰€éœ€çš„ä½æ•° log2(10) â‰ˆ 3.32 64ä½æ•°å€¼IDä¸­çš„åè¿›åˆ¶æ•°å­—çš„æ€»ä½æ•° 64/3.32 â‰ˆ 20 å°†ç”Ÿæˆçš„ ID è½¬æ¢ä¸º 58 è¿›åˆ¶ï¼Œæœ€å¤§ä½æ•°ä¸º 11 è¡¨ç¤ºä¸€ä¸ª58è¿›åˆ¶æ•°å­—æ‰€éœ€çš„ä½æ•° log2(58) â‰ˆ 5.8585 64ä½æ•°å€¼IDä¸­çš„58è¿›åˆ¶æ•°å­—çš„æ€»ä½æ•° 64/5.8585 â‰ˆ 11 ç”Ÿå‘½å‘¨æœŸ å¯ç”¨çš„ ID æ•°é‡ 2^64 -10^9= 18446644 äº¿ å¯ä»¥ä½¿ç”¨å¤šå°‘å¹´ 18446644 äº¿ / 24äº¿=7686143363.63å¹´ Base-58 ç¼–ç å™¨ ä» 64 å­—ç¬¦ï¼ˆåŒ…æ‹¬ A-Zã€a-zã€0-9ã€ + å’Œ / ï¼‰åˆ é™¤ 6 ä¸ªï¼ˆ+ã€/ã€0 ã€ O ã€ I å’Œ lï¼‰ä»¥å¢å¼ºå¯è¯»æ€§ è´Ÿè½½å‡è¡¡\næœ¬åœ°è´Ÿè½½å‡è¡¡ å®¢æˆ·ç«¯å’Œåº”ç”¨æœåŠ¡å™¨ä¹‹é—´ åº”ç”¨æœåŠ¡å™¨å’Œæ•°æ®åº“æœåŠ¡å™¨ä¹‹é—´ åº”ç”¨æœåŠ¡å™¨å’Œç¼“å­˜æœåŠ¡å™¨ä¹‹é—´ å…¨å±€è´Ÿè½½å‡è¡¡ æ•°æ®åº“åœ°ç†ä½ç½®ä¸€è‡´ å¦‚æœä½¿ç”¨æ•°æ®ä¸­å¿ƒï¼Œåˆ™å¯ä»¥åœ¨çŸ­åœ°å€ä¸­æ·»åŠ å­—ç¬¦è¡¨ç¤ºæ•°æ®ä¸­å¿ƒï¼šhttp://service.com/x/short123 ç¼“å­˜\né™åˆ¶æ¯ä¸ªç”¨æˆ·çš„é…é¢ è¯»å¯†é›†å‹ï¼Œé€‰æ‹© Memcached ä½¿ç”¨ LRU ç¼“å­˜æ¥æ·˜æ±°ä¸ç»å¸¸è®¿é—®çš„ç½‘å€ é™æµå™¨ï¼šå›ºå®šçª—å£è®¡æ•°å™¨ç®—æ³•\nè®¾è®¡å›¾ å·¥ä½œæµ åˆ›å»ºçŸ­ç½‘å€\nè‡ªå®šä¹‰éå¿…å¡«ï¼Œåˆ«åé•¿åº¦ä¸èƒ½å¤§äº 11ï¼Œä¸èƒ½å°äº 3 é‡å®šå‘çŸ­ç½‘å€\nä½¿ç”¨ 302 é‡å®šå‘ï¼šå¯ä»¥å¯¹çŸ­ç½‘å€è¿›è¡Œç»Ÿè®¡ 301 æ°¸ä¹…é‡å®šå‘ï¼šç¬¬ä¸€æ¬¡è¯·æ±‚æ‹¿åˆ°é•¿é“¾æ¥åï¼Œä¸‹æ¬¡æµè§ˆå™¨å†å»è¯·æ±‚çŸ­é“¾çš„è¯ï¼Œä¸ä¼šå‘çŸ­ç½‘å€æœåŠ¡å™¨è¯·æ±‚äº†ï¼Œè€Œæ˜¯ç›´æ¥ä»æµè§ˆå™¨çš„ç¼“å­˜é‡Œæ‹¿ï¼Œå‡å°‘å¯¹æœåŠ¡å™¨çš„å‹åŠ› 302 ä¸´æ—¶é‡å®šå‘ï¼šæ¯æ¬¡å»è¯·æ±‚çŸ­é“¾éƒ½ä¼šå»è¯·æ±‚çŸ­ç½‘å€æœåŠ¡å™¨ï¼ˆé™¤éå“åº”ä¸­ç”¨ Cache-Control æˆ– Expired æš—ç¤ºæµè§ˆå™¨è¿›è¡Œç¼“å­˜ï¼‰ åˆ é™¤çŸ­ç½‘å€\nç”¨æˆ·é€šè¿‡ Rest API åˆ é™¤ ç”¨æˆ·è®¿é—®è¿‡æœŸçš„çŸ­ç½‘å€æ—¶ï¼Œåˆ é™¤ è¿è¡Œå®šæ—¶ä»»åŠ¡ï¼Œå…ˆåˆ æ•°æ®åº“è®°å½•ï¼Œå†åˆ ç¼“å­˜ã€‚å¦‚æœéœ€è¦å†ä¿é™©ä¸€ç‚¹ï¼Œå†å¯ç”¨å»¶æ—¶åŒåˆ ï¼Œæˆ–è€…ç›´æ¥åŒæ­¥æ•°æ®åº“çš„ binlog æ¥åˆ ç¼“å­˜ Evaluation è¯„ä¼°\né«˜å¯ç”¨ æ¯å¤©å¤‡ä»½å­˜å‚¨å’Œç¼“å­˜æœåŠ¡å™¨ï¼Œæœ€å¥½ä¸€å¤©ä¸¤æ¬¡ å…¨å±€æœåŠ¡å™¨è´Ÿè½½å¹³è¡¡æ¥å¤„ç†ç³»ç»Ÿçš„æµé‡ã€‚ é€Ÿç‡é™åˆ¶å™¨é™åˆ¶æ¯ä¸ªç”¨æˆ·çš„èµ„æºåˆ†é…ã€‚ æ‰©å±•æ€§ æ•°æ®åº“çš„æ°´å¹³åˆ†ç‰‡ã€‚ MongoDB - ä½œä¸º NoSQL æ•°æ®åº“ã€‚ åŸºäºä¸€è‡´æ€§å“ˆå¸Œçš„æ•°æ®åˆ†å¸ƒã€‚ å¯è¯»æ€§ å¼•å…¥ Base-58 ç¼–ç å™¨æ¥ç”ŸæˆçŸ­ URLã€‚ åˆ é™¤éå­—æ¯æ•°å­—å­—ç¬¦ã€‚ åˆ é™¤ç›¸ä¼¼çš„å­—ç¬¦ã€‚ å»¶è¿Ÿ MongoDB ä½å»¶è¿Ÿå’Œé«˜ååé‡ã€‚ åˆ†å¸ƒå¼ç¼“å­˜ï¼Œæœ€å¤§é™åº¦å‡å°‘æœåŠ¡å»¶è¿Ÿã€‚ ä¸å¯é¢„è®¡æ€§ ID å”¯ä¸€ä¸”ä¸å¯é¢„æµ‹ å‚è€ƒæ–‡ç«  Designing a URL Shortening service like TinyURL\nDesign a URL Shortening Service / TinyURL\nåç«¯é¢è¯•ä¹‹ç³»ç»Ÿè®¾è®¡-çŸ­ç½‘å€ï¼ˆShort URLï¼‰æœåŠ¡æ€ä¹ˆè®¾è®¡ï¼Ÿ\n[ä¸‡å­—é•¿æ–‡] ç³»ç»Ÿè®¾è®¡ä¹‹è·¯ï¼šå¦‚ä½•è®¾è®¡ä¸€ä¸ªURLçŸ­é“¾æœåŠ¡\nçŸ­ URL ç³»ç»Ÿæ˜¯æ€ä¹ˆè®¾è®¡çš„ï¼Ÿ - iammutex çš„å›ç­” - çŸ¥ä¹\n","permalink":"https://blog.chensoul.cc/posts/2023/11/17/designing-a-url-shortening-service/","summary":"å¦‚ä½•ç”Ÿæˆä¸€ä¸ªçŸ­ç½‘å€æœåŠ¡ï¼Œå‚è€ƒ Design a URL Shortening Service / TinyURL å’Œ Designing a URL Shortening service like TinyURL ä¸¤ç¯‡æ–‡ç« ï¼Œæ•´ç†å¦‚ä¸‹ç¬”è®°ã€‚\nå…¶ä¸­ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š\nè®¾è®¡ä¸€ä¸ªç³»ç»Ÿæœ‰å“ªäº›æ­¥éª¤ éœ€æ±‚ é¢„ä¼° è®¾è®¡ é«˜å±‚æ¬¡è®¾è®¡ API è®¾è®¡ ç»†èŠ‚è®¾è®¡ è¯„ä¼° è®¾è®¡ä¸€ä¸ªçŸ­ç½‘å€æœåŠ¡çš„ç»†èŠ‚ è®¾è®¡æ­¥éª¤ Requirements éœ€æ±‚\nåŠŸèƒ½æ€§éœ€æ±‚ çŸ­ URL ç”Ÿæˆï¼šæˆ‘ä»¬çš„æœåŠ¡åº”è¯¥èƒ½å¤Ÿä¸ºç»™å®š URL ç”Ÿæˆå”¯ä¸€çš„è¾ƒçŸ­åˆ«åã€‚ é‡å®šå‘ï¼šç»™å®šä¸€ä¸ªçŸ­é“¾æ¥ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿåº”è¯¥èƒ½å¤Ÿå°†ç”¨æˆ·é‡å®šå‘åˆ°åŸå§‹ URLã€‚ è‡ªå®šä¹‰çŸ­é“¾æ¥ï¼šç”¨æˆ·åº”è¯¥èƒ½å¤Ÿä½¿ç”¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸ºå…¶ URL ç”Ÿæˆè‡ªå®šä¹‰çŸ­é“¾æ¥ã€‚ åˆ é™¤ï¼šåœ¨èµ‹äºˆæƒé™çš„æƒ…å†µä¸‹ï¼Œç”¨æˆ·åº”è¯¥èƒ½å¤Ÿåˆ é™¤æˆ‘ä»¬ç³»ç»Ÿç”Ÿæˆçš„çŸ­é“¾æ¥ã€‚ æ›´æ–°ï¼šå¦‚æœæœ‰é€‚å½“çš„æƒé™ï¼Œç”¨æˆ·åº”è¯¥èƒ½å¤Ÿæ›´æ–°ä¸çŸ­é“¾æ¥å…³è”çš„é•¿ URLã€‚ è¿‡æœŸæ—¶é—´ï¼šçŸ­é“¾æ¥å¿…é¡»æœ‰ä¸€ä¸ªé»˜è®¤çš„è¿‡æœŸæ—¶é—´ï¼Œä½†ç”¨æˆ·åº”è¯¥å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚ åˆ†åŠŸèƒ½æ€§éœ€æ±‚ï¼šå¯ç”¨æ€§ã€å¯é æ€§ã€æ‰©å±•æ€§ã€å¯ç»´æŠ¤æ€§ã€å®¹é”™æ€§ å¯ç”¨æ€§ï¼šæˆ‘ä»¬çš„ç³»ç»Ÿåº”è¯¥å…·æœ‰é«˜å¯ç”¨æ€§ï¼Œå› ä¸ºå³ä½¿æ˜¯ç¬¬äºŒæ¬¡åœæœºçš„ä¸€å°éƒ¨åˆ†ä¹Ÿä¼šå¯¼è‡´ URL é‡å®šå‘å¤±è´¥ã€‚ç”±äºæˆ‘ä»¬ç³»ç»Ÿçš„åŸŸä½äº URL ä¸­ï¼Œå› æ­¤æˆ‘ä»¬æ²¡æœ‰åœæœºæ—¶é—´çš„ä¼˜åŠ¿ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„è®¾è®¡å¿…é¡»çŒè¾“å®¹é”™æ¡ä»¶ã€‚ å¯æ‰©å±•æ€§ï¼šæˆ‘ä»¬çš„ç³»ç»Ÿåº”è¯¥èƒ½å¤Ÿéšç€éœ€æ±‚çš„å¢åŠ è€Œæ°´å¹³æ‰©å±•ã€‚ å¯è¯»æ€§ï¼šæˆ‘ä»¬çš„ç³»ç»Ÿç”Ÿæˆçš„çŸ­é“¾æ¥åº”è¯¥æ˜“äºé˜…è¯»ã€åŒºåˆ†å’Œè¾“å…¥ã€‚ å»¶è¿Ÿï¼šç³»ç»Ÿåº”ä»¥ä½å»¶è¿Ÿæ‰§è¡Œï¼Œä»¥ä¾¿ä¸ºç”¨æˆ·æä¾›æµç•…çš„ä½“éªŒã€‚ ä¸å¯é¢„æµ‹æ€§ï¼šä»å®‰å…¨è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿç”Ÿæˆçš„çŸ­é“¾æ¥åº”è¯¥æ˜¯é«˜åº¦ä¸å¯é¢„æµ‹çš„ã€‚è¿™ç¡®ä¿äº†ä¸‹ä¸€ä¸ªçŸ­ URL ä¸ä¼šè¿ç»­ç”Ÿæˆï¼Œä»è€Œæ¶ˆé™¤äº†æœ‰äººçŒœæµ‹æˆ‘ä»¬çš„ç³»ç»Ÿå·²ç»ç”Ÿæˆæˆ–å°†ç”Ÿæˆçš„æ‰€æœ‰çŸ­ URL çš„å¯èƒ½æ€§ã€‚ Estimation ä¼°è®¡\næµé‡ è¯»å†™æ¯”ï¼š1:100 æ¯æœˆè¯·æ±‚æ•°ï¼š2 äº¿ å•æ¡è®°å½•å ç”¨ç©ºé—´ï¼š500B è®°å½•ä¿å­˜å¤šé•¿æ—¶é—´ï¼š5 å¹´ æ¯æ—¥æ´»è·ƒç”¨æˆ· (DAU) ï¼š1 äº¿ å­˜å‚¨ 5 å¹´è®°å½•æ•°ï¼š2 äº¿ x 5 x 12 =120 äº¿ æ€»å­˜å‚¨ï¼š120 äº¿ x 500B= 120 äº¿ x 0.5KB=6TB å¸¦å®½ æ¯ç§’å†™è¯·æ±‚ï¼š2 äº¿ / 30 /24 /60 /60 = 77æ¬¡/s å†™å…¥å¸¦å®½ï¼š77 x 500B =38KB/s è¯»å¸¦å®½ï¼š38 x 100 =3.","title":"å¦‚ä½•è®¾è®¡ä¸€ä¸ªçŸ­ç½‘å€æœåŠ¡"},{"content":"è¿™æ˜¯ä¸€ç¯‡åŒè¯­ç¿»è¯‘çš„æ–‡ç« ï¼ŒåŸæ–‡å‡ºè‡ªã€ŠGrokking the System Design Interviewã€‹æ•™ç¨‹çš„ System Design Master Template è¿™ç¯‡ç« èŠ‚ã€‚\nSystem design interviews are unstructured by design. In these interviews, you are asked to take on an open-ended design problem that doesnâ€™t have a standard solution.\nç³»ç»Ÿè®¾è®¡é¢è¯•åœ¨è®¾è®¡ä¸Šæ˜¯éç»“æ„åŒ–çš„ã€‚åœ¨è¿™äº›é¢è¯•ä¸­ï¼Œæ‚¨è¢«è¦æ±‚è§£å†³ä¸€ä¸ªæ²¡æœ‰æ ‡å‡†è§£å†³æ–¹æ¡ˆçš„å¼€æ”¾å¼è®¾è®¡é—®é¢˜ã€‚\nThe two biggest challenges of answering a system design interview question are:\nå›ç­”ç³»ç»Ÿè®¾è®¡é¢è¯•é—®é¢˜çš„ä¸¤ä¸ªæœ€å¤§æŒ‘æˆ˜æ˜¯ï¼š\nTo know where to start.\nçŸ¥é“ä»å“ªé‡Œå¼€å§‹ã€‚\nTo know if you have talked about all the important parts of the system.\näº†è§£æ‚¨æ˜¯å¦å·²ç»è®¨è®ºè¿‡ç³»ç»Ÿçš„æ‰€æœ‰é‡è¦éƒ¨åˆ†ã€‚\nTo simplify this process, the course offers a comprehensive system design template that can effectively guide you in addressing any system design interview question.\nä¸ºäº†ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼Œæœ¬è¯¾ç¨‹æä¾›äº†ä¸€ä¸ªå…¨é¢çš„ç³»ç»Ÿè®¾è®¡æ¨¡æ¿ï¼Œå¯ä»¥æœ‰æ•ˆåœ°æŒ‡å¯¼æ‚¨è§£å†³ä»»ä½•ç³»ç»Ÿè®¾è®¡é¢è¯•é—®é¢˜ã€‚\nHave a look at the following image to understand the major components that could be part of any system design and how these components interact with each other. æŸ¥çœ‹ä¸‹å›¾ï¼Œäº†è§£å¯èƒ½æˆä¸ºä»»ä½•ç³»ç»Ÿè®¾è®¡ä¸€éƒ¨åˆ†çš„ä¸»è¦ç»„ä»¶ä»¥åŠè¿™äº›ç»„ä»¶å¦‚ä½•ç›¸äº’äº¤äº’ã€‚\nWith this master template in mind, we will discuss the 18 essential system design concepts. Here is a brief description of each:\nè€ƒè™‘åˆ°è¿™ä¸ªä¸»æ¨¡æ¿ï¼Œæˆ‘ä»¬å°†è®¨è®º 18 ä¸ªåŸºæœ¬çš„ç³»ç»Ÿè®¾è®¡æ¦‚å¿µã€‚ä»¥ä¸‹æ˜¯æ¯é¡¹çš„ç®€è¦è¯´æ˜ï¼š\n1. Domain Name System (DNS) 1.åŸŸåç³»ç»Ÿï¼ˆDNSï¼‰\nThe Domain Name System (DNS) serves as a fundamental component of the internet infrastructure, translating user-friendly domain names into their corresponding IP addresses. It acts as a phonebook for the internet, enabling users to access websites and services by entering easily memorable domain names, such as www.designgurus.io, rather than the numerical IP addresses like \u0026ldquo;192.0.2.1\u0026rdquo; that computers utilize to identify each other.\nåŸŸåç³»ç»Ÿ (DNS) æ˜¯äº’è”ç½‘åŸºç¡€è®¾æ–½çš„åŸºæœ¬ç»„æˆéƒ¨åˆ†ï¼Œå®ƒå°†ç”¨æˆ·å‹å¥½çš„åŸŸåè½¬æ¢ä¸ºå…¶ç›¸åº”çš„ IP åœ°å€ã€‚å®ƒå……å½“äº’è”ç½‘çš„ç”µè¯ç°¿ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿé€šè¿‡è¾“å…¥æ˜“äºè®°å¿†çš„åŸŸåï¼ˆä¾‹å¦‚ www.designgurus.ioï¼‰æ¥è®¿é—®ç½‘ç«™å’ŒæœåŠ¡ï¼Œè€Œä¸æ˜¯è®¡ç®—æœºç”¨æ¥è¯†åˆ«å½¼æ­¤çš„æ•°å­— IP åœ°å€ï¼ˆä¾‹å¦‚â€œ192.0.2.1â€ï¼‰ ã€‚\nWhen you input a domain name into your web browser, the DNS is responsible for finding the associated IP address and directing your request to the appropriate server. This process commences with your computer sending a query to a recursive resolver, which then searches a series of DNS servers, beginning with the root server, followed by the Top-Level Domain (TLD) server, and ultimately the authoritative name server. Once the IP address is located, the recursive resolver returns it to your computer, allowing your browser to establish a connection with the target server and access the desired content.\nå½“æ‚¨åœ¨ç½‘ç»œæµè§ˆå™¨ä¸­è¾“å…¥åŸŸåæ—¶ï¼ŒDNS è´Ÿè´£æŸ¥æ‰¾å…³è”çš„ IP åœ°å€å¹¶å°†æ‚¨çš„è¯·æ±‚å®šå‘åˆ°é€‚å½“çš„æœåŠ¡å™¨ã€‚æ­¤è¿‡ç¨‹é¦–å…ˆæ˜¯æ‚¨çš„è®¡ç®—æœºå‘é€’å½’è§£æå™¨å‘é€æŸ¥è¯¢ï¼Œç„¶åé€’å½’è§£æå™¨æœç´¢ä¸€ç³»åˆ— DNS æœåŠ¡å™¨ï¼Œä»æ ¹æœåŠ¡å™¨å¼€å§‹ï¼Œç„¶åæ˜¯é¡¶çº§åŸŸ (TLD) æœåŠ¡å™¨ï¼Œæœ€åæ˜¯æƒå¨åç§°æœåŠ¡å™¨ã€‚ä¸€æ—¦æ‰¾åˆ° IP åœ°å€ï¼Œé€’å½’è§£æå™¨ä¼šå°†å…¶è¿”å›åˆ°æ‚¨çš„è®¡ç®—æœºï¼Œä»è€Œå…è®¸æ‚¨çš„æµè§ˆå™¨ä¸ç›®æ ‡æœåŠ¡å™¨å»ºç«‹è¿æ¥å¹¶è®¿é—®æ‰€éœ€çš„å†…å®¹ã€‚\n2. Load Balancer 2.è´Ÿè½½å‡è¡¡å™¨\nA load balancer is a networking device or software designed to distribute incoming network traffic across multiple servers, ensuring optimal resource utilization, reduced latency, and maintained high availability. It plays a crucial role in scaling applications and efficiently managing server workloads, particularly in situations where there is a sudden surge in traffic or uneven distribution of requests among servers.\nè´Ÿè½½å‡è¡¡å™¨æ˜¯ä¸€ç§ç½‘ç»œè®¾å¤‡æˆ–è½¯ä»¶ï¼Œæ—¨åœ¨è·¨å¤šä¸ªæœåŠ¡å™¨åˆ†é…ä¼ å…¥çš„ç½‘ç»œæµé‡ï¼Œç¡®ä¿æœ€ä½³çš„èµ„æºåˆ©ç”¨ç‡ã€å‡å°‘å»¶è¿Ÿå¹¶ä¿æŒé«˜å¯ç”¨æ€§ã€‚å®ƒåœ¨æ‰©å±•åº”ç”¨ç¨‹åºå’Œæœ‰æ•ˆç®¡ç†æœåŠ¡å™¨å·¥ä½œè´Ÿè½½æ–¹é¢å‘æŒ¥ç€è‡³å…³é‡è¦çš„ä½œç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨æµé‡çªç„¶æ¿€å¢æˆ–æœåŠ¡å™¨ä¹‹é—´è¯·æ±‚åˆ†å¸ƒä¸å‡åŒ€çš„æƒ…å†µä¸‹ã€‚\nLoad balancers employ various algorithms to determine the distribution of incoming traffic. Some common algorithms include:\nè´Ÿè½½å‡è¡¡å™¨é‡‡ç”¨å„ç§ç®—æ³•æ¥ç¡®å®šä¼ å…¥æµé‡çš„åˆ†é…ã€‚ä¸€äº›å¸¸è§çš„ç®—æ³•åŒ…æ‹¬ï¼š\nRound Robin: Requests are sequentially and evenly distributed across all available servers in a cyclical manner.\nå¾ªç¯ï¼šè¯·æ±‚ä»¥å¾ªç¯æ–¹å¼é¡ºåºå‡åŒ€åœ°åˆ†å¸ƒåœ¨æ‰€æœ‰å¯ç”¨æœåŠ¡å™¨ä¸Šã€‚\nLeast Connections: The load balancer assigns requests to the server with the fewest active connections, giving priority to less-busy servers.\næœ€å°‘è¿æ¥ï¼šè´Ÿè½½å‡è¡¡å™¨å°†è¯·æ±‚åˆ†é…ç»™æ´»åŠ¨è¿æ¥æœ€å°‘çš„æœåŠ¡å™¨ï¼Œå¹¶ä¼˜å…ˆè€ƒè™‘ä¸å¤ªç¹å¿™çš„æœåŠ¡å™¨ã€‚\nIP Hash: The client\u0026rsquo;s IP address is hashed, and the resulting value is used to determine which server the request should be directed to. This method ensures that a specific client\u0026rsquo;s requests are consistently routed to the same server, helping maintain session persistence.\nIP å“ˆå¸Œï¼šå¯¹å®¢æˆ·ç«¯çš„ IP åœ°å€è¿›è¡Œå“ˆå¸Œå¤„ç†ï¼Œç»“æœå€¼ç”¨äºç¡®å®šè¯·æ±‚åº”å®šå‘åˆ°å“ªä¸ªæœåŠ¡å™¨ã€‚æ­¤æ–¹æ³•å¯ç¡®ä¿ç‰¹å®šå®¢æˆ·ç«¯çš„è¯·æ±‚ä¸€è‡´è·¯ç”±åˆ°åŒä¸€æœåŠ¡å™¨ï¼Œä»è€Œæœ‰åŠ©äºç»´æŠ¤ä¼šè¯æŒä¹…æ€§ã€‚\n3. API Gateway 3.APIç½‘å…³\nAn API Gateway serves as a server or service that functions as an intermediary between external clients and the internal microservices or API-based backend services of an application. It is a vital component in contemporary architectures, particularly in microservices-based systems, where it streamlines the communication process and offers a single entry point for clients to access various services.\nAPI ç½‘å…³å……å½“æœåŠ¡å™¨æˆ–æœåŠ¡ï¼Œå……å½“å¤–éƒ¨å®¢æˆ·ç«¯ä¸åº”ç”¨ç¨‹åºçš„å†…éƒ¨å¾®æœåŠ¡æˆ–åŸºäº API çš„åç«¯æœåŠ¡ä¹‹é—´çš„ä¸­ä»‹ã€‚å®ƒæ˜¯å½“ä»£æ¶æ„ä¸­çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œç‰¹åˆ«æ˜¯åœ¨åŸºäºå¾®æœåŠ¡çš„ç³»ç»Ÿä¸­ï¼Œå®ƒç®€åŒ–äº†é€šä¿¡æµç¨‹ï¼Œå¹¶ä¸ºå®¢æˆ·ç«¯è®¿é—®å„ç§æœåŠ¡æä¾›äº†å•ä¸€å…¥å£ç‚¹ã€‚\nThe primary functions of an API Gateway encompass:\nAPIç½‘å…³çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š\nRequest Routing: The API Gateway directs incoming API requests from clients to the appropriate backend service or microservice, based on predefined rules and configurations.\nè¯·æ±‚è·¯ç”±ï¼šAPI ç½‘å…³æ ¹æ®é¢„å®šä¹‰çš„è§„åˆ™å’Œé…ç½®ï¼Œå°†æ¥è‡ªå®¢æˆ·ç«¯çš„ä¼ å…¥ API è¯·æ±‚å®šå‘åˆ°é€‚å½“çš„åç«¯æœåŠ¡æˆ–å¾®æœåŠ¡ã€‚\nAuthentication and Authorization: The API Gateway manages user authentication and authorization, ensuring that only authorized clients can access the services. It verifies API keys, tokens, or other credentials before routing requests to the backend services.\nèº«ä»½éªŒè¯å’Œæˆæƒï¼šAPIç½‘å…³ç®¡ç†ç”¨æˆ·èº«ä»½éªŒè¯å’Œæˆæƒï¼Œç¡®ä¿åªæœ‰æˆæƒçš„å®¢æˆ·ç«¯æ‰èƒ½è®¿é—®æœåŠ¡ã€‚å®ƒåœ¨å°†è¯·æ±‚è·¯ç”±åˆ°åç«¯æœåŠ¡ä¹‹å‰éªŒè¯ API å¯†é’¥ã€ä»¤ç‰Œæˆ–å…¶ä»–å‡­æ®ã€‚\nRate Limiting and Throttling: To safeguard backend services from excessive load or abuse, the API Gateway enforces rate limits or throttles requests from clients according to predefined policies.\né€Ÿç‡é™åˆ¶å’ŒèŠ‚æµï¼šä¸ºäº†ä¿æŠ¤åç«¯æœåŠ¡å…å—è¿‡åº¦è´Ÿè½½æˆ–æ»¥ç”¨ï¼ŒAPI ç½‘å…³æ ¹æ®é¢„å®šä¹‰çš„ç­–ç•¥å¼ºåˆ¶æ‰§è¡Œé€Ÿç‡é™åˆ¶æˆ–èŠ‚æµæ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚\nCaching: In order to minimize latency and backend load, the API Gateway caches frequently-used responses, serving them directly to clients without the need to query the backend services.\nç¼“å­˜ï¼šä¸ºäº†æœ€å¤§ç¨‹åº¦åœ°å‡å°‘å»¶è¿Ÿå’Œåç«¯è´Ÿè½½ï¼ŒAPI ç½‘å…³ä¼šç¼“å­˜å¸¸ç”¨çš„å“åº”ï¼Œå°†å…¶ç›´æ¥æä¾›ç»™å®¢æˆ·ç«¯ï¼Œè€Œæ— éœ€æŸ¥è¯¢åç«¯æœåŠ¡ã€‚\nRequest and Response Transformation: The API Gateway can modify requests and responses, such as converting data formats, adding or removing headers, or altering query parameters, to ensure compatibility between clients and services.\nè¯·æ±‚å’Œå“åº”è½¬æ¢ï¼šAPIç½‘å…³å¯ä»¥ä¿®æ”¹è¯·æ±‚å’Œå“åº”ï¼Œä¾‹å¦‚è½¬æ¢æ•°æ®æ ¼å¼ã€æ·»åŠ æˆ–åˆ é™¤æ ‡å¤´æˆ–æ›´æ”¹æŸ¥è¯¢å‚æ•°ï¼Œä»¥ç¡®ä¿å®¢æˆ·ç«¯å’ŒæœåŠ¡ä¹‹é—´çš„å…¼å®¹æ€§ã€‚\n4. CDN 4.CDN\nA Content Delivery Network (CDN) is a distributed network of servers that store and deliver content, such as images, videos, stylesheets, and scripts, to users from locations that are geographically closer to them. CDNs are designed to enhance the performance, speed, and reliability of content delivery to end-users, irrespective of their location relative to the origin server. Here\u0026rsquo;s how a CDN operates:\nå†…å®¹äº¤ä»˜ç½‘ç»œ (CDN) æ˜¯ä¸€ç§åˆ†å¸ƒå¼æœåŠ¡å™¨ç½‘ç»œï¼Œç”¨äºå­˜å‚¨å¹¶å‘åœ°ç†ä½ç½®è¾ƒè¿‘çš„ç”¨æˆ·äº¤ä»˜å†…å®¹ï¼ˆä¾‹å¦‚å›¾åƒã€è§†é¢‘ã€æ ·å¼è¡¨å’Œè„šæœ¬ï¼‰ã€‚ CDN æ—¨åœ¨å¢å¼ºå‘æœ€ç»ˆç”¨æˆ·äº¤ä»˜å†…å®¹çš„æ€§èƒ½ã€é€Ÿåº¦å’Œå¯é æ€§ï¼Œæ— è®ºå…¶ç›¸å¯¹äºæºæœåŠ¡å™¨çš„ä½ç½®å¦‚ä½•ã€‚ CDN çš„è¿ä½œæ–¹å¼å¦‚ä¸‹ï¼š\nWhen a user requests content from a website or application, the request is directed to the nearest CDN server, also known as an edge server.\nå½“ç”¨æˆ·ä»ç½‘ç«™æˆ–åº”ç”¨ç¨‹åºè¯·æ±‚å†…å®¹æ—¶ï¼Œè¯·æ±‚å°†è¢«å®šå‘åˆ°æœ€è¿‘çš„ CDN æœåŠ¡å™¨ï¼ˆä¹Ÿç§°ä¸ºè¾¹ç¼˜æœåŠ¡å™¨ï¼‰ã€‚\nIf the edge server has the requested content cached, it directly serves the content to the user. This process reduces latency and improves the user experience, as the content travels a shorter distance.\nå¦‚æœè¾¹ç¼˜æœåŠ¡å™¨ç¼“å­˜äº†æ‰€è¯·æ±‚çš„å†…å®¹ï¼Œåˆ™å®ƒç›´æ¥å‘ç”¨æˆ·æä¾›å†…å®¹ã€‚ç”±äºå†…å®¹ä¼ è¾“çš„è·ç¦»è¾ƒçŸ­ï¼Œå› æ­¤æ­¤è¿‡ç¨‹å‡å°‘äº†å»¶è¿Ÿå¹¶æ”¹å–„äº†ç”¨æˆ·ä½“éªŒã€‚\nIf the content is not cached on the edge server, the CDN retrieves it from the origin server or another nearby CDN server. Once the content is fetched, it is cached on the edge server and served to the user.\nå¦‚æœå†…å®¹æœªç¼“å­˜åœ¨è¾¹ç¼˜æœåŠ¡å™¨ä¸Šï¼Œåˆ™ CDN ä¼šä»æºæœåŠ¡å™¨æˆ–å…¶ä»–é™„è¿‘çš„ CDN æœåŠ¡å™¨æ£€ç´¢å†…å®¹ã€‚è·å–å†…å®¹åï¼Œå®ƒä¼šç¼“å­˜åœ¨è¾¹ç¼˜æœåŠ¡å™¨ä¸Šå¹¶æä¾›ç»™ç”¨æˆ·ã€‚\nTo ensure the content stays up-to-date, the CDN periodically checks the origin server for changes and updates its cache accordingly.\nä¸ºäº†ç¡®ä¿å†…å®¹ä¿æŒæœ€æ–°ï¼ŒCDN å®šæœŸæ£€æŸ¥æºæœåŠ¡å™¨æ˜¯å¦æœ‰æ›´æ”¹å¹¶ç›¸åº”æ›´æ–°å…¶ç¼“å­˜ã€‚\n5. Forward Proxy vs. Reverse Proxy æ­£å‘ä»£ç†ä¸åå‘ä»£ç† A forward proxy, also referred to as a \u0026ldquo;proxy server\u0026rdquo; or simply \u0026ldquo;proxy,\u0026rdquo; is a server positioned in front of one or more client machines, acting as an intermediary between the clients and the internet. When a client machine requests a resource on the internet, the request is initially sent to the forward proxy. The forward proxy then forwards the request to the internet on behalf of the client machine and returns the response to the client machine.\nè½¬å‘ä»£ç†ä¹Ÿç§°ä¸ºâ€œä»£ç†æœåŠ¡å™¨â€æˆ–ç®€ç§°ä¸ºâ€œä»£ç†â€ï¼Œæ˜¯ä½äºä¸€å°æˆ–å¤šå°å®¢æˆ·ç«¯è®¡ç®—æœºå‰é¢çš„æœåŠ¡å™¨ï¼Œå……å½“å®¢æˆ·ç«¯å’Œäº’è”ç½‘ä¹‹é—´çš„ä¸­ä»‹ã€‚å½“å®¢æˆ·ç«¯è®¡ç®—æœºè¯·æ±‚äº’è”ç½‘ä¸Šçš„èµ„æºæ—¶ï¼Œè¯¥è¯·æ±‚æœ€åˆè¢«å‘é€åˆ°è½¬å‘ä»£ç†ã€‚ç„¶åï¼Œè½¬å‘ä»£ç†ä»£è¡¨å®¢æˆ·ç«¯è®¡ç®—æœºå°†è¯·æ±‚è½¬å‘åˆ°äº’è”ç½‘ï¼Œå¹¶å°†å“åº”è¿”å›åˆ°å®¢æˆ·ç«¯è®¡ç®—æœºã€‚\nOn the other hand, a reverse proxy is a server that sits in front of one or more web servers, serving as an intermediary between the web servers and the internet. When a client requests a resource on the internet, the request is first sent to the reverse proxy. The reverse proxy then forwards the request to one of the web servers, which returns the response to the reverse proxy. Finally, the reverse proxy returns the response to the client.\nå¦ä¸€æ–¹é¢ï¼Œåå‘ä»£ç†æ˜¯ä½äºä¸€ä¸ªæˆ–å¤šä¸ª Web æœåŠ¡å™¨å‰é¢çš„æœåŠ¡å™¨ï¼Œå……å½“ Web æœåŠ¡å™¨å’Œäº’è”ç½‘ä¹‹é—´çš„ä¸­ä»‹ã€‚å½“å®¢æˆ·ç«¯è¯·æ±‚äº’è”ç½‘ä¸Šçš„èµ„æºæ—¶ï¼Œè¯·æ±‚é¦–å…ˆå‘é€åˆ°åå‘ä»£ç†ã€‚ç„¶åï¼Œåå‘ä»£ç†å°†è¯·æ±‚è½¬å‘åˆ°å…¶ä¸­ä¸€å° Web æœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨å°†å“åº”è¿”å›ç»™åå‘ä»£ç†ã€‚æœ€åï¼Œåå‘ä»£ç†å°†å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚\n6. Caching ç¼“å­˜ Cache is a high-speed storage layer positioned between the application and the original data source, such as a database, file system, or remote web service. When an application requests data, the cache is checked first. If the data is present in the cache, it is returned to the application. If the data is not found in the cache, it is retrieved from its original source, stored in the cache for future use, and then returned to the application. In a distributed system, caching can occur in multiple locations, including the client, DNS, CDN, load balancer, API gateway, server, database, and more.\nç¼“å­˜æ˜¯ä½äºåº”ç”¨ç¨‹åºå’ŒåŸå§‹æ•°æ®æºï¼ˆä¾‹å¦‚æ•°æ®åº“ã€æ–‡ä»¶ç³»ç»Ÿæˆ–è¿œç¨‹ Web æœåŠ¡ï¼‰ä¹‹é—´çš„é«˜é€Ÿå­˜å‚¨å±‚ã€‚å½“åº”ç”¨ç¨‹åºè¯·æ±‚æ•°æ®æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥ç¼“å­˜ã€‚å¦‚æœæ•°æ®å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™å°†å…¶è¿”å›ç»™åº”ç”¨ç¨‹åºã€‚å¦‚æœåœ¨ç¼“å­˜ä¸­æ‰¾ä¸åˆ°æ•°æ®ï¼Œåˆ™ä¼šä»åŸå§‹æ¥æºæ£€ç´¢è¯¥æ•°æ®ï¼Œå°†å…¶å­˜å‚¨åœ¨ç¼“å­˜ä¸­ä»¥ä¾›å°†æ¥ä½¿ç”¨ï¼Œç„¶åè¿”å›ç»™åº”ç”¨ç¨‹åºã€‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç¼“å­˜å¯ä»¥å‘ç”Ÿåœ¨å¤šä¸ªä½ç½®ï¼ŒåŒ…æ‹¬å®¢æˆ·ç«¯ã€DNSã€CDNã€è´Ÿè½½å‡è¡¡å™¨ã€API ç½‘å…³ã€æœåŠ¡å™¨ã€æ•°æ®åº“ç­‰ã€‚\n7. Data Partitioning æ•°æ®åˆ†åŒº In a database, horizontal partitioning, often referred to as sharding, entails dividing the rows of a table into smaller tables and storing them on distinct servers or database instances. This method is employed to distribute the database load across multiple servers, thereby enhancing performance.\nåœ¨æ•°æ®åº“ä¸­ï¼Œæ°´å¹³åˆ†åŒºï¼ˆé€šå¸¸ç§°ä¸ºåˆ†ç‰‡ï¼‰éœ€è¦å°†è¡¨çš„è¡Œåˆ’åˆ†ä¸ºæ›´å°çš„è¡¨ï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨ä¸åŒçš„æœåŠ¡å™¨æˆ–æ•°æ®åº“å®ä¾‹ä¸Šã€‚è¯¥æ–¹æ³•ç”¨äºå°†æ•°æ®åº“è´Ÿè½½åˆ†æ•£åˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚\nConversely, vertical partitioning involves splitting the columns of a table into separate tables. This technique aims to reduce the column count in a table and boost the performance of queries that only access a limited number of columns.\nç›¸åï¼Œå‚ç›´åˆ†åŒºæ¶‰åŠå°†è¡¨çš„åˆ—æ‹†åˆ†ä¸ºå•ç‹¬çš„è¡¨ã€‚è¯¥æŠ€æœ¯æ—¨åœ¨å‡å°‘è¡¨ä¸­çš„åˆ—æ•°å¹¶æé«˜ä»…è®¿é—®æœ‰é™æ•°é‡åˆ—çš„æŸ¥è¯¢çš„æ€§èƒ½ã€‚\n8. Database Replication æ•°æ®åº“å¤åˆ¶ Database replication is a method employed to maintain multiple copies of the same database across various servers or locations. The main objective of database replication is to enhance data availability, redundancy, and fault tolerance, ensuring the system remains operational even in the face of hardware failures or other issues.\næ•°æ®åº“å¤åˆ¶æ˜¯ä¸€ç§ç”¨äºè·¨ä¸åŒæœåŠ¡å™¨æˆ–ä½ç½®ç»´æŠ¤åŒä¸€æ•°æ®åº“çš„å¤šä¸ªå‰¯æœ¬çš„æ–¹æ³•ã€‚æ•°æ®åº“å¤åˆ¶çš„ä¸»è¦ç›®æ ‡æ˜¯å¢å¼ºæ•°æ®å¯ç”¨æ€§ã€å†—ä½™å’Œå®¹é”™èƒ½åŠ›ï¼Œç¡®ä¿ç³»ç»Ÿå³ä½¿åœ¨é‡åˆ°ç¡¬ä»¶æ•…éšœæˆ–å…¶ä»–é—®é¢˜æ—¶ä¹Ÿèƒ½ä¿æŒè¿è¡Œã€‚\nIn a replicated database configuration, one server serves as the primary (or master) database, while others act as replicas (or slaves). This process involves synchronizing data between the primary database and replicas, ensuring all possess the same up-to-date information. Database replication provides several advantages, including:\nåœ¨å¤åˆ¶æ•°æ®åº“é…ç½®ä¸­ï¼Œä¸€å°æœåŠ¡å™¨å……å½“ä¸»ï¼ˆæˆ–ä¸»ï¼‰æ•°æ®åº“ï¼Œè€Œå…¶ä»–æœåŠ¡å™¨å……å½“å‰¯æœ¬ï¼ˆæˆ–ä»ï¼‰æ•°æ®åº“ã€‚æ­¤è¿‡ç¨‹æ¶‰åŠåœ¨ä¸»æ•°æ®åº“å’Œå‰¯æœ¬ä¹‹é—´åŒæ­¥æ•°æ®ï¼Œç¡®ä¿æ‰€æœ‰æ•°æ®åº“éƒ½æ‹¥æœ‰ç›¸åŒçš„æœ€æ–°ä¿¡æ¯ã€‚æ•°æ®åº“å¤åˆ¶å…·æœ‰å¤šç§ä¼˜åŠ¿ï¼ŒåŒ…æ‹¬ï¼š\nImproved Performance: By distributing read queries among multiple replicas, the load on the primary database can be reduced, leading to faster query response times.\næé«˜æ€§èƒ½ï¼šé€šè¿‡åœ¨å¤šä¸ªå‰¯æœ¬ä¹‹é—´åˆ†é…è¯»å–æŸ¥è¯¢ï¼Œå¯ä»¥å‡å°‘ä¸»æ•°æ®åº“ä¸Šçš„è´Ÿè½½ï¼Œä»è€ŒåŠ å¿«æŸ¥è¯¢å“åº”æ—¶é—´ã€‚\nHigh Availability: If the primary database experiences failure or downtime, replicas can continue to provide data, ensuring uninterrupted access to the application.\né«˜å¯ç”¨æ€§ï¼šå¦‚æœä¸»æ•°æ®åº“å‡ºç°æ•…éšœæˆ–åœæœºï¼Œå‰¯æœ¬å¯ä»¥ç»§ç»­æä¾›æ•°æ®ï¼Œç¡®ä¿å¯¹åº”ç”¨ç¨‹åºçš„ä¸é—´æ–­è®¿é—®ã€‚\nEnhanced Data Protection: Maintaining multiple copies of the database across different locations helps safeguard against data loss due to hardware failures or other disasters.\nå¢å¼ºçš„æ•°æ®ä¿æŠ¤ï¼šåœ¨ä¸åŒä½ç½®ç»´æŠ¤æ•°æ®åº“çš„å¤šä¸ªå‰¯æœ¬æœ‰åŠ©äºé˜²æ­¢ç”±äºç¡¬ä»¶æ•…éšœæˆ–å…¶ä»–ç¾éš¾è€Œå¯¼è‡´çš„æ•°æ®ä¸¢å¤±ã€‚\nLoad Balancing: Replicas can handle read queries, allowing for better load distribution and reducing overall stress on the primary database.\nè´Ÿè½½å¹³è¡¡ï¼šå‰¯æœ¬å¯ä»¥å¤„ç†è¯»å–æŸ¥è¯¢ï¼Œä»è€Œå®ç°æ›´å¥½çš„è´Ÿè½½åˆ†é…å¹¶å‡å°‘ä¸»æ•°æ®åº“çš„æ•´ä½“å‹åŠ›ã€‚\n9. Distributed Messaging Systems 9.åˆ†å¸ƒå¼æ¶ˆæ¯ç³»ç»Ÿ\nDistributed messaging systems provide a reliable, scalable, and fault-tolerant means for exchanging messages between numerous, possibly geographically-dispersed applications, services, or components. These systems facilitate communication by decoupling sender and receiver components, enabling them to develop and function independently. Distributed messaging systems are especially valuable in large-scale or intricate systems, like those seen in microservices architectures or distributed computing environments. Examples of these systems include Apache Kafka and RabbitMQ.\nåˆ†å¸ƒå¼æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿæä¾›äº†ä¸€ç§å¯é ã€å¯æ‰©å±•ä¸”å®¹é”™çš„æ–¹å¼ï¼Œç”¨äºåœ¨ä¼—å¤šå¯èƒ½åœ¨åœ°ç†ä¸Šåˆ†æ•£çš„åº”ç”¨ç¨‹åºã€æœåŠ¡æˆ–ç»„ä»¶ä¹‹é—´äº¤æ¢æ¶ˆæ¯ã€‚è¿™äº›ç³»ç»Ÿé€šè¿‡è§£è€¦å‘é€å™¨å’Œæ¥æ”¶å™¨ç»„ä»¶æ¥ä¿ƒè¿›é€šä¿¡ï¼Œä½¿å®ƒä»¬èƒ½å¤Ÿç‹¬ç«‹å¼€å‘å’Œè¿è¡Œã€‚åˆ†å¸ƒå¼æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿåœ¨å¤§è§„æ¨¡æˆ–å¤æ‚çš„ç³»ç»Ÿä¸­å°¤å…¶æœ‰ä»·å€¼ï¼Œä¾‹å¦‚å¾®æœåŠ¡æ¶æ„æˆ–åˆ†å¸ƒå¼è®¡ç®—ç¯å¢ƒä¸­çš„ç³»ç»Ÿã€‚è¿™äº›ç³»ç»Ÿçš„ç¤ºä¾‹åŒ…æ‹¬ Apache Kafka å’Œ RabbitMQã€‚\n10. Microservices å¾®æœåŠ¡ Microservices represent an architectural style wherein an application is organized as an assembly of small, loosely-coupled, and autonomously deployable services. Each microservice is accountable for a distinct aspect of functionality or domain within the application and communicates with other microservices via well-defined APIs. This method deviates from the conventional monolithic architecture, where an application is constructed as a single, tightly-coupled unit.\nå¾®æœåŠ¡ä»£è¡¨äº†ä¸€ç§æ¶æ„é£æ ¼ï¼Œå…¶ä¸­åº”ç”¨ç¨‹åºè¢«ç»„ç»‡ä¸ºå°å‹ã€æ¾æ•£è€¦åˆä¸”å¯è‡ªä¸»éƒ¨ç½²çš„æœåŠ¡çš„é›†åˆã€‚æ¯ä¸ªå¾®æœåŠ¡è´Ÿè´£åº”ç”¨ç¨‹åºå†…åŠŸèƒ½æˆ–é¢†åŸŸçš„ä¸åŒæ–¹é¢ï¼Œå¹¶é€šè¿‡å®šä¹‰è‰¯å¥½çš„ API ä¸å…¶ä»–å¾®æœåŠ¡è¿›è¡Œé€šä¿¡ã€‚æ­¤æ–¹æ³•ä¸åŒäºä¼ ç»Ÿçš„æ•´ä½“æ¶æ„ï¼Œåœ¨ä¼ ç»Ÿçš„æ•´ä½“æ¶æ„ä¸­ï¼Œåº”ç”¨ç¨‹åºè¢«æ„å»ºä¸ºå•ä¸ªç´§å¯†è€¦åˆçš„å•å…ƒã€‚\nThe primary characteristics of microservices include:\nå¾®æœåŠ¡çš„ä¸»è¦ç‰¹å¾åŒ…æ‹¬ï¼š\nSingle Responsibility: Adhering to the Single Responsibility Principle, each microservice focuses on a specific function or domain, making the services more straightforward to comprehend, develop, and maintain.\nå•ä¸€èŒè´£ï¼šéµå¾ªå•ä¸€èŒè´£åŸåˆ™ï¼Œæ¯ä¸ªå¾®æœåŠ¡éƒ½ä¸“æ³¨äºç‰¹å®šçš„åŠŸèƒ½æˆ–é¢†åŸŸï¼Œä½¿æœåŠ¡æ›´æ˜“äºç†è§£ã€å¼€å‘å’Œç»´æŠ¤ã€‚\nIndependence: Microservices can be independently developed, deployed, and scaled, offering increased flexibility and agility in the development process. Teams can work on various services simultaneously without impacting the entire system.\nç‹¬ç«‹æ€§ï¼šå¾®æœåŠ¡å¯ä»¥ç‹¬ç«‹å¼€å‘ã€éƒ¨ç½²å’Œæ‰©å±•ï¼Œä»è€Œæé«˜å¼€å‘è¿‡ç¨‹çš„çµæ´»æ€§å’Œæ•æ·æ€§ã€‚å›¢é˜Ÿå¯ä»¥åŒæ—¶å¤„ç†å„ç§æœåŠ¡ï¼Œè€Œä¸ä¼šå½±å“æ•´ä¸ªç³»ç»Ÿã€‚\nDecentralization: Typically, microservices are decentralized, with each service possessing its data and business logic. This approach fosters separation of concerns and empowers teams to make decisions and select technologies tailored to their unique requirements.\nå»ä¸­å¿ƒåŒ–ï¼šé€šå¸¸ï¼Œå¾®æœåŠ¡æ˜¯å»ä¸­å¿ƒåŒ–çš„ï¼Œæ¯ä¸ªæœåŠ¡éƒ½æ‹¥æœ‰è‡ªå·±çš„æ•°æ®å’Œä¸šåŠ¡é€»è¾‘ã€‚è¿™ç§æ–¹æ³•ä¿ƒè¿›äº†å…³æ³¨ç‚¹åˆ†ç¦»ï¼Œå¹¶ä½¿å›¢é˜Ÿèƒ½å¤Ÿåšå‡ºå†³ç­–å¹¶é€‰æ‹©é€‚åˆå…¶ç‹¬ç‰¹éœ€æ±‚çš„æŠ€æœ¯ã€‚\nCommunication: Microservices interact with each other using lightweight protocols, such as HTTP/REST, gRPC, or message queues. This fosters interoperability and facilitates the integration of new services or the replacement of existing ones.\né€šä¿¡ï¼šå¾®æœåŠ¡ä½¿ç”¨è½»é‡çº§åè®®ï¼ˆä¾‹å¦‚ HTTP/RESTã€gRPC æˆ–æ¶ˆæ¯é˜Ÿåˆ—ï¼‰ç›¸äº’äº¤äº’ã€‚è¿™ä¿ƒè¿›äº†äº’æ“ä½œæ€§å¹¶ä¿ƒè¿›æ–°æœåŠ¡çš„é›†æˆæˆ–ç°æœ‰æœåŠ¡çš„æ›¿æ¢ã€‚\nFault Tolerance: As microservices are independent, the failure of one service does not necessarily result in the collapse of the entire system, enhancing the application\u0026rsquo;s overall resiliency.\nå®¹é”™æ€§ï¼šç”±äºå¾®æœåŠ¡æ˜¯ç‹¬ç«‹çš„ï¼Œä¸€ä¸ªæœåŠ¡çš„æ•…éšœå¹¶ä¸ä¸€å®šä¼šå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå´©æºƒï¼Œå¢å¼ºäº†åº”ç”¨ç¨‹åºçš„æ•´ä½“å¼¹æ€§ã€‚\n11. NoSQL Databases 11.NoSQL æ•°æ®åº“\nNoSQL databases, or â€œNot Only SQLâ€ databases, are non-relational databases designed to store, manage, and retrieve unstructured or semi-structured data. They offer an alternative to traditional relational databases, which rely on structured data and predefined schemas. NoSQL databases have become popular due to their flexibility, scalability, and ability to handle large volumes of data, making them well-suited for modern applications, big data processing, and real-time analytics.\nNoSQL æ•°æ®åº“æˆ–â€œNot Only SQLâ€æ•°æ®åº“æ˜¯éå…³ç³»æ•°æ®åº“ï¼Œæ—¨åœ¨å­˜å‚¨ã€ç®¡ç†å’Œæ£€ç´¢éç»“æ„åŒ–æˆ–åŠç»“æ„åŒ–æ•°æ®ã€‚å®ƒä»¬æä¾›äº†ä¼ ç»Ÿå…³ç³»æ•°æ®åº“çš„æ›¿ä»£æ–¹æ¡ˆï¼Œä¼ ç»Ÿå…³ç³»æ•°æ®åº“ä¾èµ–äºç»“æ„åŒ–æ•°æ®å’Œé¢„å®šä¹‰æ¨¡å¼ã€‚ NoSQL æ•°æ®åº“å› å…¶çµæ´»æ€§ã€å¯æ‰©å±•æ€§å’Œå¤„ç†å¤§é‡æ•°æ®çš„èƒ½åŠ›è€Œå˜å¾—æµè¡Œï¼Œä½¿å…¶éå¸¸é€‚åˆç°ä»£åº”ç”¨ç¨‹åºã€å¤§æ•°æ®å¤„ç†å’Œå®æ—¶åˆ†æã€‚\nNoSQL databases can be categorized into four main types:\nNoSQL æ•°æ®åº“å¯åˆ†ä¸ºå››ç§ä¸»è¦ç±»å‹ï¼š\nDocument-Based: These databases store data in document-like structures, such as JSON or BSON. Each document is self-contained and can have its own unique structure, making them suitable for handling heterogeneous data. Examples of document-based NoSQL databases include MongoDB and Couchbase.\nåŸºäºæ–‡æ¡£ï¼šè¿™äº›æ•°æ®åº“ä»¥ç±»ä¼¼æ–‡æ¡£çš„ç»“æ„å­˜å‚¨æ•°æ®ï¼Œä¾‹å¦‚ JSON æˆ– BSONã€‚æ¯ä¸ªæ–‡æ¡£éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œå¯ä»¥æœ‰è‡ªå·±ç‹¬ç‰¹çš„ç»“æ„ï¼Œä½¿å®ƒä»¬é€‚åˆå¤„ç†å¼‚æ„æ•°æ®ã€‚åŸºäºæ–‡æ¡£çš„ NoSQL æ•°æ®åº“çš„ç¤ºä¾‹åŒ…æ‹¬ MongoDB å’Œ Couchbaseã€‚\nKey-Value: These databases store data as key-value pairs, where the key acts as a unique identifier, and the value holds the associated data. Key-value databases are highly efficient for simple read and write operations, and they can be easily partitioned and scaled horizontally. Examples of key-value NoSQL databases include Redis and Amazon DynamoDB.\né”®å€¼ï¼šè¿™äº›æ•°æ®åº“å°†æ•°æ®å­˜å‚¨ä¸ºé”®å€¼å¯¹ï¼Œå…¶ä¸­é”®å……å½“å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå€¼ä¿å­˜å…³è”çš„æ•°æ®ã€‚é”®å€¼æ•°æ®åº“å¯¹äºç®€å•çš„è¯»å†™æ“ä½œéå¸¸é«˜æ•ˆï¼Œå¹¶ä¸”å¯ä»¥è½»æ¾åœ°è¿›è¡Œåˆ†åŒºå’Œæ°´å¹³æ‰©å±•ã€‚é”®å€¼ NoSQL æ•°æ®åº“çš„ç¤ºä¾‹åŒ…æ‹¬ Redis å’Œ Amazon DynamoDBã€‚\nColumn-Family: These databases store data in column families, which are groups of related columns. They are designed to handle write-heavy workloads and are highly efficient for querying data with a known row and column keys. Examples of column-family NoSQL databases include Apache Cassandra and HBase.\nåˆ—æ—ï¼šè¿™äº›æ•°æ®åº“å°†æ•°æ®å­˜å‚¨åœ¨åˆ—æ—ä¸­ï¼Œåˆ—æ—æ˜¯ç›¸å…³åˆ—çš„ç»„ã€‚å®ƒä»¬æ—¨åœ¨å¤„ç†å†™å…¥ç¹é‡çš„å·¥ä½œè´Ÿè½½ï¼Œå¹¶ä¸”å¯¹äºä½¿ç”¨å·²çŸ¥çš„è¡Œé”®å’Œåˆ—é”®æŸ¥è¯¢æ•°æ®éå¸¸é«˜æ•ˆã€‚åˆ—æ— NoSQL æ•°æ®åº“çš„ç¤ºä¾‹åŒ…æ‹¬ Apache Cassandra å’Œ HBaseã€‚\nGraph-Based: These databases are designed for storing and querying data that has complex relationships and interconnected structures, such as social networks or recommendation systems. Graph databases use nodes, edges, and properties to represent and store data, making it easier to perform complex traversals and relationship-based queries. Examples of graph-based NoSQL databases include Neo4j and Amazon Neptune.\nåŸºäºå›¾ï¼šè¿™äº›æ•°æ®åº“æ—¨åœ¨å­˜å‚¨å’ŒæŸ¥è¯¢å…·æœ‰å¤æ‚å…³ç³»å’Œäº’è¿ç»“æ„çš„æ•°æ®ï¼Œä¾‹å¦‚ç¤¾äº¤ç½‘ç»œæˆ–æ¨èç³»ç»Ÿã€‚å›¾æ•°æ®åº“ä½¿ç”¨èŠ‚ç‚¹ã€è¾¹å’Œå±æ€§æ¥è¡¨ç¤ºå’Œå­˜å‚¨æ•°æ®ï¼Œä»è€Œæ›´å®¹æ˜“æ‰§è¡Œå¤æ‚çš„éå†å’ŒåŸºäºå…³ç³»çš„æŸ¥è¯¢ã€‚åŸºäºå›¾å½¢çš„ NoSQL æ•°æ®åº“çš„ç¤ºä¾‹åŒ…æ‹¬ Neo4j å’Œ Amazon Neptuneã€‚\n12. Database Index æ•°æ®åº“ç´¢å¼• Database indexes are data structures that enhance the speed and efficiency of query operations within a database. They function similarly to an index in a book, enabling the database management system (DBMS) to swiftly locate data associated with a specific value or group of values, without the need to search through every row in a table. By offering a more direct route to the desired data, indexes can considerably decrease the time required to retrieve information from a database.\næ•°æ®åº“ç´¢å¼•æ˜¯æé«˜æ•°æ®åº“å†…æŸ¥è¯¢æ“ä½œé€Ÿåº¦å’Œæ•ˆç‡çš„æ•°æ®ç»“æ„ã€‚å®ƒä»¬çš„åŠŸèƒ½ç±»ä¼¼äºä¹¦ä¸­çš„ç´¢å¼•ï¼Œä½¿æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ (DBMS) èƒ½å¤Ÿå¿«é€Ÿå®šä½ä¸ç‰¹å®šå€¼æˆ–ä¸€ç»„å€¼å…³è”çš„æ•°æ®ï¼Œè€Œæ— éœ€æœç´¢è¡¨ä¸­çš„æ¯ä¸€è¡Œã€‚é€šè¿‡æä¾›è·å–æ‰€éœ€æ•°æ®çš„æ›´ç›´æ¥é€”å¾„ï¼Œç´¢å¼•å¯ä»¥å¤§å¤§å‡å°‘ä»æ•°æ®åº“æ£€ç´¢ä¿¡æ¯æ‰€éœ€çš„æ—¶é—´ã€‚\nIndexes are typically constructed on one or more columns of a database table. The B-tree index is the most prevalent type, organizing data in a hierarchical tree structure, which allows for rapid search, insertion, and deletion operations. Other types of indexes, such as bitmap indexes and hash indexes, exist as well, each with their particular use cases and advantages.\nç´¢å¼•é€šå¸¸æ„å»ºåœ¨æ•°æ®åº“è¡¨çš„ä¸€åˆ—æˆ–å¤šåˆ—ä¸Šã€‚ B æ ‘ç´¢å¼•æ˜¯æœ€æµè¡Œçš„ç±»å‹ï¼Œä»¥åˆ†å±‚æ ‘ç»“æ„ç»„ç»‡æ•°æ®ï¼Œå…è®¸å¿«é€Ÿæœç´¢ã€æ’å…¥å’Œåˆ é™¤æ“ä½œã€‚è¿˜å­˜åœ¨å…¶ä»–ç±»å‹çš„ç´¢å¼•ï¼Œä¾‹å¦‚ä½å›¾ç´¢å¼•å’Œå“ˆå¸Œç´¢å¼•ï¼Œæ¯ç§ç´¢å¼•éƒ½æœ‰å…¶ç‰¹å®šçš„ç”¨ä¾‹å’Œä¼˜ç‚¹ã€‚\nAlthough indexes can significantly enhance query performance, they also involve certain trade-offs:\nè™½ç„¶ç´¢å¼•å¯ä»¥æ˜¾ç€æé«˜æŸ¥è¯¢æ€§èƒ½ï¼Œä½†å®ƒä»¬ä¹Ÿæ¶‰åŠæŸäº›æƒè¡¡ï¼š\nStorage Space: Indexes require additional storage space since they generate and maintain separate data structures alongside the original table data.\nå­˜å‚¨ç©ºé—´ï¼šç´¢å¼•éœ€è¦é¢å¤–çš„å­˜å‚¨ç©ºé—´ï¼Œå› ä¸ºå®ƒä»¬ä¸åŸå§‹è¡¨æ•°æ®ä¸€èµ·ç”Ÿæˆå’Œç»´æŠ¤å•ç‹¬çš„æ•°æ®ç»“æ„ã€‚\nWrite Performance: When data is inserted, updated, or deleted in a table, the corresponding indexes must also be updated, which may slow down write operations.\nå†™å…¥æ€§èƒ½ï¼šå½“åœ¨è¡¨ä¸­æ’å…¥ã€æ›´æ–°æˆ–åˆ é™¤æ•°æ®æ—¶ï¼Œç›¸åº”çš„ç´¢å¼•ä¹Ÿå¿…é¡»æ›´æ–°ï¼Œè¿™å¯èƒ½ä¼šå‡æ…¢å†™å…¥æ“ä½œã€‚\n13. Distributed File Systems 13.åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ\nDistributed file systems are storage systems designed to manage and grant access to files and directories across multiple servers, nodes, or machines, frequently distributed across a network. They allow users and applications to access and modify files as though they were situated on a local file system, despite the fact that the actual files may be physically located on various remote servers. Distributed file systems are commonly employed in large-scale or distributed computing environments to offer fault tolerance, high availability, and enhanced performance.\nåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€ç§å­˜å‚¨ç³»ç»Ÿï¼Œæ—¨åœ¨ç®¡ç†å’Œæˆäºˆå¯¹è·¨å¤šä¸ªæœåŠ¡å™¨ã€èŠ‚ç‚¹æˆ–æœºå™¨çš„æ–‡ä»¶å’Œç›®å½•çš„è®¿é—®æƒé™ï¼Œè¿™äº›æœåŠ¡å™¨ã€èŠ‚ç‚¹æˆ–æœºå™¨ç»å¸¸åˆ†å¸ƒåœ¨ç½‘ç»œä¸Šã€‚å®ƒä»¬å…è®¸ç”¨æˆ·å’Œåº”ç”¨ç¨‹åºè®¿é—®å’Œä¿®æ”¹æ–‡ä»¶ï¼Œå°±åƒå®ƒä»¬ä½äºæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸Šä¸€æ ·ï¼Œå°½ç®¡å®é™…æ–‡ä»¶å¯èƒ½ç‰©ç†ä¸Šä½äºå„ç§è¿œç¨‹æœåŠ¡å™¨ä¸Šã€‚åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿé€šå¸¸ç”¨äºå¤§è§„æ¨¡æˆ–åˆ†å¸ƒå¼è®¡ç®—ç¯å¢ƒä¸­ï¼Œä»¥æä¾›å®¹é”™ã€é«˜å¯ç”¨æ€§å’Œå¢å¼ºçš„æ€§èƒ½ã€‚\n14. Notification System 14.é€šçŸ¥ç³»ç»Ÿ\nThese are used to send notifications or alerts to users, such as emails, push notifications, or text messages.\nå®ƒä»¬ç”¨äºå‘ç”¨æˆ·å‘é€é€šçŸ¥æˆ–è­¦æŠ¥ï¼Œä¾‹å¦‚ç”µå­é‚®ä»¶ã€æ¨é€é€šçŸ¥æˆ–çŸ­ä¿¡ã€‚\n15. Full-text Search å…¨æ–‡æ£€ç´¢ Full-text search allows users to search for particular words or phrases within an application or website. Upon receiving a user query, the application or website delivers the most relevant results. To accomplish this rapidly and effectively, full-text search utilizes an inverted index, a data structure that associates words or phrases with the documents where they are found. Elastic Search is an example of such systems.\nå…¨æ–‡æœç´¢å…è®¸ç”¨æˆ·åœ¨åº”ç”¨ç¨‹åºæˆ–ç½‘ç«™ä¸­æœç´¢ç‰¹å®šå•è¯æˆ–çŸ­è¯­ã€‚æ”¶åˆ°ç”¨æˆ·æŸ¥è¯¢åï¼Œåº”ç”¨ç¨‹åºæˆ–ç½‘ç«™ä¼šæä¾›æœ€ç›¸å…³çš„ç»“æœã€‚ä¸ºäº†å¿«é€Ÿæœ‰æ•ˆåœ°å®Œæˆæ­¤ä»»åŠ¡ï¼Œå…¨æ–‡æœç´¢ä½¿ç”¨å€’æ’ç´¢å¼•ï¼Œè¿™æ˜¯ä¸€ç§å°†å•è¯æˆ–çŸ­è¯­ä¸æ‰¾åˆ°å®ƒä»¬çš„æ–‡æ¡£ç›¸å…³è”çš„æ•°æ®ç»“æ„ã€‚ Elastic Search å°±æ˜¯æ­¤ç±»ç³»ç»Ÿçš„ä¸€ä¸ªç¤ºä¾‹ã€‚\n16. Distributed Coordination Services 16.åˆ†å¸ƒå¼åè°ƒæœåŠ¡\nDistributed coordination services are systems engineered to regulate and synchronize the actions of distributed applications, services, or nodes in a dependable, efficient, and fault-tolerant way. They assist in maintaining consistency, addressing distributed synchronization, and overseeing the configuration and state of diverse components in a distributed setting. Distributed coordination services are especially valuable in large-scale or intricate systems, like those encountered in microservices architectures, distributed computing environments, or clustered databases. Apache ZooKeeper, etcd, and Consul are examples of such services.\nåˆ†å¸ƒå¼åè°ƒæœåŠ¡æ˜¯æ—¨åœ¨ä»¥å¯é ã€é«˜æ•ˆå’Œå®¹é”™çš„æ–¹å¼è°ƒèŠ‚å’ŒåŒæ­¥åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºã€æœåŠ¡æˆ–èŠ‚ç‚¹çš„æ“ä½œçš„ç³»ç»Ÿã€‚å®ƒä»¬æœ‰åŠ©äºç»´æŠ¤ä¸€è‡´æ€§ã€è§£å†³åˆ†å¸ƒå¼åŒæ­¥ä»¥åŠç›‘ç£åˆ†å¸ƒå¼ç¯å¢ƒä¸­ä¸åŒç»„ä»¶çš„é…ç½®å’ŒçŠ¶æ€ã€‚åˆ†å¸ƒå¼åè°ƒæœåŠ¡åœ¨å¤§è§„æ¨¡æˆ–å¤æ‚çš„ç³»ç»Ÿä¸­å°¤å…¶æœ‰ä»·å€¼ï¼Œä¾‹å¦‚å¾®æœåŠ¡æ¶æ„ã€åˆ†å¸ƒå¼è®¡ç®—ç¯å¢ƒæˆ–é›†ç¾¤æ•°æ®åº“ä¸­é‡åˆ°çš„ç³»ç»Ÿã€‚ Apache ZooKeeperã€etcd å’Œ Consul æ˜¯æ­¤ç±»æœåŠ¡çš„ç¤ºä¾‹ã€‚\n17. Heartbeat å¿ƒè·³ In a distributed environment, work/data is distributed among servers. To efficiently route requests in such a setup, servers need to know what other servers are part of the system. Furthermore, servers should know if other servers are alive and working. In a decentralized system, whenever a request arrives at a server, the server should have enough information to decide which server is responsible for entertaining that request. This makes the timely detection of server failure an important task, which also enables the system to take corrective actions and move the data/work to another healthy server and stop the environment from further deterioration.\nåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œå·¥ä½œ/æ•°æ®åˆ†å¸ƒåœ¨æœåŠ¡å™¨ä¹‹é—´ã€‚ä¸ºäº†åœ¨è¿™æ ·çš„è®¾ç½®ä¸­æœ‰æ•ˆåœ°è·¯ç”±è¯·æ±‚ï¼ŒæœåŠ¡å™¨éœ€è¦çŸ¥é“ç³»ç»Ÿä¸­è¿˜æœ‰å“ªäº›å…¶ä»–æœåŠ¡å™¨ã€‚æ­¤å¤–ï¼ŒæœåŠ¡å™¨åº”è¯¥çŸ¥é“å…¶ä»–æœåŠ¡å™¨æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€å¹¶æ­£åœ¨å·¥ä½œã€‚åœ¨å»ä¸­å¿ƒåŒ–ç³»ç»Ÿä¸­ï¼Œæ¯å½“è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨éƒ½åº”è¯¥æœ‰è¶³å¤Ÿçš„ä¿¡æ¯æ¥å†³å®šå“ªä¸ªæœåŠ¡å™¨è´Ÿè´£å¤„ç†è¯¥è¯·æ±‚ã€‚è¿™ä½¿å¾—åŠæ—¶æ£€æµ‹æœåŠ¡å™¨æ•…éšœæˆä¸ºä¸€é¡¹é‡è¦ä»»åŠ¡ï¼Œè¿™ä¹Ÿä½¿ç³»ç»Ÿèƒ½å¤Ÿé‡‡å–çº æ­£æªæ–½å¹¶å°†æ•°æ®/å·¥ä½œè½¬ç§»åˆ°å¦ä¸€å°å¥åº·çš„æœåŠ¡å™¨ä¸Šï¼Œå¹¶é˜»æ­¢ç¯å¢ƒè¿›ä¸€æ­¥æ¶åŒ–ã€‚\nTo solve this, each server periodically sends a heartbeat message to a central monitoring server or other servers in the system to show that it is still alive and functioning.\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ¯ä¸ªæœåŠ¡å™¨å®šæœŸå‘ä¸­å¤®ç›‘æ§æœåŠ¡å™¨æˆ–ç³»ç»Ÿä¸­çš„å…¶ä»–æœåŠ¡å™¨å‘é€å¿ƒè·³æ¶ˆæ¯ï¼Œä»¥è¡¨æ˜å®ƒä»ç„¶æ´»ç€å¹¶ä¸”æ­£åœ¨è¿è¡Œã€‚\nHeartbeating is one of the mechanisms for detecting failures in a distributed system. If there is a central server, all servers periodically send a heartbeat message to it. If there is no central server, all servers randomly choose a set of servers and send them a heartbeat message every few seconds. This way, if no heartbeat message is received from a server for a while, the system can suspect that the server might have crashed. If there is no heartbeat within a configured timeout period, the system can conclude that the server is not alive anymore and stop sending requests to it and start working on its replacement.\nå¿ƒè·³æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ£€æµ‹æ•…éšœçš„æœºåˆ¶ä¹‹ä¸€ã€‚å¦‚æœæœ‰ä¸€ä¸ªä¸­å¿ƒæœåŠ¡å™¨ï¼Œæ‰€æœ‰æœåŠ¡å™¨éƒ½ä¼šå®šæœŸå‘å®ƒå‘é€å¿ƒè·³æ¶ˆæ¯ã€‚å¦‚æœæ²¡æœ‰ä¸­å¿ƒæœåŠ¡å™¨ï¼Œåˆ™æ‰€æœ‰æœåŠ¡å™¨éšæœºé€‰æ‹©ä¸€ç»„æœåŠ¡å™¨ï¼Œæ¯éš”å‡ ç§’å‘å®ƒä»¬å‘é€ä¸€æ¡å¿ƒè·³æ¶ˆæ¯ã€‚è¿™æ ·ï¼Œå¦‚æœä¸€æ®µæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°æœåŠ¡å™¨çš„å¿ƒè·³æ¶ˆæ¯ï¼Œç³»ç»Ÿå°±ä¼šæ€€ç–‘è¯¥æœåŠ¡å™¨å¯èƒ½å·²ç»å´©æºƒäº†ã€‚å¦‚æœåœ¨é…ç½®çš„è¶…æ—¶æ—¶é—´å†…æ²¡æœ‰å¿ƒè·³ï¼Œç³»ç»Ÿå¯ä»¥æ–­å®šæœåŠ¡å™¨ä¸å†æ´»åŠ¨ï¼Œå¹¶åœæ­¢å‘å…¶å‘é€è¯·æ±‚å¹¶å¼€å§‹è¿›è¡Œæ›¿æ¢ã€‚\n18. Checksum æ ¡éªŒå’Œ In a distributed system, while moving data between components, it is possible that the data fetched from a node may arrive corrupted. This corruption can occur because of faults in a storage device, network, software, etc. How can a distributed system ensure data integrity, so that the client receives an error instead of corrupt data?\nåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå½“åœ¨ç»„ä»¶ä¹‹é—´ç§»åŠ¨æ•°æ®æ—¶ï¼Œä»èŠ‚ç‚¹è·å–çš„æ•°æ®å¯èƒ½ä¼šæŸåã€‚è¿™ç§æŸåå¯èƒ½æ˜¯ç”±äºå­˜å‚¨è®¾å¤‡ã€ç½‘ç»œã€è½¯ä»¶ç­‰çš„æ•…éšœè€Œå‘ç”Ÿçš„ã€‚åˆ†å¸ƒå¼ç³»ç»Ÿå¦‚ä½•ç¡®ä¿æ•°æ®å®Œæ•´æ€§ï¼Œä»¥ä¾¿å®¢æˆ·ç«¯æ”¶åˆ°é”™è¯¯è€Œä¸æ˜¯æŸåçš„æ•°æ®ï¼Ÿ\nTo solve this, we can calculate a checksum and store it with data.\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—æ ¡éªŒå’Œå¹¶å°†å…¶ä¸æ•°æ®ä¸€èµ·å­˜å‚¨ã€‚\nTo calculate a checksum, a cryptographic hash-function like MD5, SHA-1, SHA-256, or SHA-512 is used. The hash function takes the input data and produces a string (containing letters and numbers) of fixed length; this string is called the checksum.\nè¦è®¡ç®—æ ¡éªŒå’Œï¼Œéœ€è¦ä½¿ç”¨MD5ã€SHA-1ã€SHA-256æˆ–SHA-512ç­‰åŠ å¯†å“ˆå¸Œå‡½æ•°ã€‚å“ˆå¸Œå‡½æ•°è·å–è¾“å…¥æ•°æ®å¹¶ç”Ÿæˆå›ºå®šé•¿åº¦çš„å­—ç¬¦ä¸²ï¼ˆåŒ…å«å­—æ¯å’Œæ•°å­—ï¼‰ï¼›è¯¥å­—ç¬¦ä¸²ç§°ä¸ºæ ¡éªŒå’Œã€‚\nWhen a system is storing some data, it computes a checksum of the data and stores the checksum with the data. When a client retrieves data, it verifies that the data it received from the server matches the checksum stored. If not, then the client can opt to retrieve that data from another replica.\nå½“ç³»ç»Ÿå­˜å‚¨æŸäº›æ•°æ®æ—¶ï¼Œå®ƒä¼šè®¡ç®—æ•°æ®çš„æ ¡éªŒå’Œå¹¶å°†æ ¡éªŒå’Œä¸æ•°æ®ä¸€èµ·å­˜å‚¨ã€‚å½“å®¢æˆ·ç«¯æ£€ç´¢æ•°æ®æ—¶ï¼Œå®ƒä¼šéªŒè¯ä»æœåŠ¡å™¨æ¥æ”¶çš„æ•°æ®æ˜¯å¦ä¸å­˜å‚¨çš„æ ¡éªŒå’ŒåŒ¹é…ã€‚å¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å¯ä»¥é€‰æ‹©ä»å¦ä¸€ä¸ªå‰¯æœ¬æ£€ç´¢è¯¥æ•°æ®ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/11/16/system-design-master-template/","summary":"è¿™æ˜¯ä¸€ç¯‡åŒè¯­ç¿»è¯‘çš„æ–‡ç« ï¼ŒåŸæ–‡å‡ºè‡ªã€ŠGrokking the System Design Interviewã€‹æ•™ç¨‹çš„ System Design Master Template è¿™ç¯‡ç« èŠ‚ã€‚\nSystem design interviews are unstructured by design. In these interviews, you are asked to take on an open-ended design problem that doesnâ€™t have a standard solution.\nç³»ç»Ÿè®¾è®¡é¢è¯•åœ¨è®¾è®¡ä¸Šæ˜¯éç»“æ„åŒ–çš„ã€‚åœ¨è¿™äº›é¢è¯•ä¸­ï¼Œæ‚¨è¢«è¦æ±‚è§£å†³ä¸€ä¸ªæ²¡æœ‰æ ‡å‡†è§£å†³æ–¹æ¡ˆçš„å¼€æ”¾å¼è®¾è®¡é—®é¢˜ã€‚\nThe two biggest challenges of answering a system design interview question are:\nå›ç­”ç³»ç»Ÿè®¾è®¡é¢è¯•é—®é¢˜çš„ä¸¤ä¸ªæœ€å¤§æŒ‘æˆ˜æ˜¯ï¼š\nTo know where to start.\nçŸ¥é“ä»å“ªé‡Œå¼€å§‹ã€‚\nTo know if you have talked about all the important parts of the system.\näº†è§£æ‚¨æ˜¯å¦å·²ç»è®¨è®ºè¿‡ç³»ç»Ÿçš„æ‰€æœ‰é‡è¦éƒ¨åˆ†ã€‚\nTo simplify this process, the course offers a comprehensive system design template that can effectively guide you in addressing any system design interview question.\nä¸ºäº†ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼Œæœ¬è¯¾ç¨‹æä¾›äº†ä¸€ä¸ªå…¨é¢çš„ç³»ç»Ÿè®¾è®¡æ¨¡æ¿ï¼Œå¯ä»¥æœ‰æ•ˆåœ°æŒ‡å¯¼æ‚¨è§£å†³ä»»ä½•ç³»ç»Ÿè®¾è®¡é¢è¯•é—®é¢˜ã€‚\nHave a look at the following image to understand the major components that could be part of any system design and how these components interact with each other.","title":"[è¯‘]ã€ŠGrokking the System Design Interviewã€‹ç³»ç»Ÿè®¾è®¡ä¸»æ¨¡æ¿"},{"content":"è¿™æ˜¯ä¸€ç¯‡åŒè¯­ç¿»è¯‘çš„æ–‡ç« ï¼ŒåŸæ–‡å‡ºè‡ª grok_system_design_interview.pdf çš„ä¸€ç¯‡æ–‡ç« ã€ŠDesigning a URL Shortening service like TinyURLã€‹è®¾è®¡ç±»ä¼¼ TinyURL çš„ URL ç¼©çŸ­æœåŠ¡ã€‚\nLetâ€™s design a URL shortening service like TinyURL. This service will provide short aliases redirecting to long URLs. Similar services: bit.ly, goo.gl, qlink.me, etc.\nè®©æˆ‘ä»¬è®¾è®¡ä¸€ä¸ªåƒ TinyURL è¿™æ ·çš„ URL ç¼©çŸ­æœåŠ¡ã€‚è¯¥æœåŠ¡å°†æä¾›é‡å®šå‘åˆ°é•¿ URL çš„çŸ­åˆ«åã€‚ç±»ä¼¼æœåŠ¡ï¼šbit.lyã€goo.glã€qlink.meç­‰ã€‚\nDifficulty Level: Easy\néš¾åº¦çº§åˆ«ï¼šç®€å•\n1.Why do we need URL shortening? 1.ä¸ºä»€ä¹ˆéœ€è¦URLç¼©çŸ­ï¼Ÿ\nURL shortening is used to create shorter aliases for long URLs. We call these shortened aliases â€œshort links.â€ Users are redirected to the original URL when they hit these short links. Short links save a lot of space when displayed, printed, messaged, or tweeted. Additionally, users are less likely to mistype shorter URLs.\nURL ç¼©çŸ­ç”¨äºä¸ºé•¿ URL åˆ›å»ºè¾ƒçŸ­çš„åˆ«åã€‚æˆ‘ä»¬å°†è¿™äº›ç¼©çŸ­çš„åˆ«åç§°ä¸ºâ€œçŸ­é“¾æ¥â€ã€‚å½“ç”¨æˆ·ç‚¹å‡»è¿™äº›çŸ­é“¾æ¥æ—¶ï¼Œä»–ä»¬ä¼šè¢«é‡å®šå‘åˆ°åŸå§‹ URLã€‚çŸ­é“¾æ¥åœ¨æ˜¾ç¤ºã€æ‰“å°ã€æ¶ˆæ¯æˆ–æ¨æ–‡æ—¶å¯ä»¥èŠ‚çœå¤§é‡ç©ºé—´ã€‚æ­¤å¤–ï¼Œç”¨æˆ·ä¸å¤ªå¯èƒ½é”™è¯¯è¾“å…¥è¾ƒçŸ­çš„ URLã€‚\nFor example, if we shorten this page through TinyURL:\nä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬é€šè¿‡ TinyURL ç¼©çŸ­è¿™ä¸ªé¡µé¢ï¼š\nhttps://www.educative.io/collection/page/5668639101419520/5649050225344512/5668600916475904/\nWe would get:\næˆ‘ä»¬ä¼šå¾—åˆ°ï¼š\nhttp://tinyurl.com/jlg8zpc\nThe shortened URL is nearly one-third the size of the actual URL.\nç¼©çŸ­çš„ URL å¤§å°å‡ ä¹æ˜¯å®é™… URL çš„ä¸‰åˆ†ä¹‹ä¸€ã€‚\nURL shortening is used for optimizing links across devices, tracking individual links to analyze audience and campaign performance, and hiding affiliated original URLs.\nURL ç¼©çŸ­ç”¨äºè·¨è®¾å¤‡ä¼˜åŒ–é“¾æ¥ã€è·Ÿè¸ªå•ä¸ªé“¾æ¥ä»¥åˆ†æå—ä¼—å’Œè¥é”€æ´»åŠ¨ç»©æ•ˆä»¥åŠéšè—å…³è”çš„åŸå§‹ URLã€‚\nIf you havenâ€™t used tinyurl.com before, please try creating a new shortened URL and spend some time going through the various options their service offers. This will help you a lot in understanding this chapter.\nå¦‚æœæ‚¨ä»¥å‰æ²¡æœ‰ä½¿ç”¨è¿‡ tinyurl.comï¼Œè¯·å°è¯•åˆ›å»ºä¸€ä¸ªæ–°çš„ç¼©çŸ­çš„ URLï¼Œå¹¶èŠ±ä¸€äº›æ—¶é—´æµè§ˆä»–ä»¬çš„æœåŠ¡æä¾›çš„å„ç§é€‰é¡¹ã€‚è¿™å°†å¯¹ä½ ç†è§£æœ¬ç« æœ‰å¾ˆå¤§å¸®åŠ©ã€‚\n2.Requirements and Goals of the System 2.ç³»ç»Ÿçš„è¦æ±‚å’Œç›®æ ‡\nYou should always clarify requirements at the beginning of the interview. Be sure to ask questions to find the exact scope of the system that the interviewer has in mind.\næ‚¨åº”è¯¥å§‹ç»ˆåœ¨é¢è¯•å¼€å§‹æ—¶æ¾„æ¸…è¦æ±‚ã€‚ä¸€å®šè¦é€šè¿‡æé—®æ¥æ‰¾åˆ°é¢è¯•å®˜å¿ƒç›®ä¸­ç³»ç»Ÿçš„ç¡®åˆ‡èŒƒå›´ã€‚\nOur URL shortening system should meet the following requirements:\næˆ‘ä»¬çš„URLç¼©çŸ­ç³»ç»Ÿåº”æ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š\nFunctional Requirements:\nåŠŸèƒ½è¦æ±‚ï¼š\nGiven a URL, our service should generate a shorter and unique alias of it. This is called a short link.\nç»™å®šä¸€ä¸ª URLï¼Œæˆ‘ä»¬çš„æœåŠ¡åº”è¯¥ç”Ÿæˆä¸€ä¸ªæ›´çŸ­ä¸”å”¯ä¸€çš„åˆ«åã€‚è¿™ç§°ä¸ºçŸ­é“¾æ¥ã€‚\nWhen users access a short link, our service should redirect them to the original link.\nå½“ç”¨æˆ·è®¿é—®çŸ­é“¾æ¥æ—¶ï¼Œæˆ‘ä»¬çš„æœåŠ¡åº”è¯¥å°†ä»–ä»¬é‡å®šå‘åˆ°åŸå§‹é“¾æ¥ã€‚\nUsers should optionally be able to pick a custom short link for their URL.\nç”¨æˆ·åº”è¯¥å¯ä»¥é€‰æ‹©ä¸ºå…¶ URL é€‰æ‹©è‡ªå®šä¹‰çŸ­é“¾æ¥ã€‚\nLinks will expire after a standard default timespan. Users should be able to specify the expiration time.\né“¾æ¥å°†åœ¨æ ‡å‡†é»˜è®¤æ—¶é—´è·¨åº¦åè¿‡æœŸã€‚ç”¨æˆ·åº”è¯¥èƒ½å¤ŸæŒ‡å®šè¿‡æœŸæ—¶é—´ã€‚\nNon-Functional Requirements:\néåŠŸèƒ½æ€§è¦æ±‚ï¼š\nThe system should be highly available. This is required because, if our service is down, all the URL redirections will start failing.\nç³»ç»Ÿåº”è¯¥æ˜¯é«˜å¯ç”¨çš„ã€‚è¿™æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºå¦‚æœæˆ‘ä»¬çš„æœåŠ¡å‡ºç°æ•…éšœï¼Œæ‰€æœ‰ URL é‡å®šå‘éƒ½å°†å¼€å§‹å¤±è´¥ã€‚\nURL redirection should happen in real-time with minimal latency.\nURL é‡å®šå‘åº”è¯¥ä»¥æœ€å°çš„å»¶è¿Ÿå®æ—¶å‘ç”Ÿã€‚\nShortened links should not be guessable (not predictable).\nç¼©çŸ­çš„é“¾æ¥ä¸åº”è¯¥æ˜¯å¯çŒœæµ‹çš„ï¼ˆä¸å¯é¢„æµ‹çš„ï¼‰ã€‚\nExtended Requirements:\næ‰©å±•è¦æ±‚ï¼š\nAnalytics; e.g., how many times a redirection happened?\nåˆ†æï¼›ä¾‹å¦‚ï¼Œé‡å®šå‘å‘ç”Ÿäº†å¤šå°‘æ¬¡ï¼Ÿ\nOur service should also be accessible through REST APIs by other services.\næˆ‘ä»¬çš„æœåŠ¡è¿˜åº”è¯¥å¯ä»¥ç”±å…¶ä»–æœåŠ¡é€šè¿‡ REST API è®¿é—®ã€‚\n3. Capacity Estimation and Constraints å®¹é‡ä¼°è®¡å’Œçº¦æŸ Our system will be read-heavy. There will be lots of redirection requests compared to new URL shortenings. Letâ€™s assume 100:1 ratio between read and write.\næˆ‘ä»¬çš„ç³»ç»Ÿè¯»å–é‡å¾ˆå¤§ã€‚ä¸æ–°çš„ URL ç¼©çŸ­ç›¸æ¯”ï¼Œå°†ä¼šæœ‰å¤§é‡çš„é‡å®šå‘è¯·æ±‚ã€‚å‡è®¾è¯»å†™æ¯”ç‡ä¸º 100:1ã€‚\nTraffic estimates: Assuming, we will have 500M new URL shortenings per month, with 100:1 read/write ratio, we can expect 50B redirections during the same period:\næµé‡ä¼°è®¡ï¼šå‡è®¾æˆ‘ä»¬æ¯æœˆæœ‰ 500M æ–°çš„ URL ç¼©çŸ­ï¼Œè¯»/å†™æ¯”ä¸º 100:1ï¼Œæˆ‘ä»¬å¯ä»¥é¢„æœŸåŒæœŸæœ‰ 50B çš„é‡å®šå‘ï¼š\n100 * 500M =\u0026gt; 50B\nWhat would be Queries Per Second (QPS) for our system? New URLs shortenings per second:\næˆ‘ä»¬ç³»ç»Ÿçš„æ¯ç§’æŸ¥è¯¢æ•° (QPS) æ˜¯å¤šå°‘ï¼Ÿæ¯ç§’æ–°ç¼©çŸ­çš„ URLï¼š\n500 million / (30 days * 24 hours * 3600 seconds) = ~200 URLs/s\nConsidering 100:1 read/write ratio, URLs redirections per second will be:\nè€ƒè™‘åˆ° 100:1 çš„è¯»/å†™æ¯”ç‡ï¼Œæ¯ç§’ URL é‡å®šå‘å°†ä¸ºï¼š\n100 * 200 URLs/s = 20K/s\nStorage estimates: Letâ€™s assume we store every URL shortening request (and associated shortened link) for 5 years. Since we expect to have 500M new URLs every month, the total number of objects we expect to store will be 30 billion:\nå­˜å‚¨ä¼°è®¡ï¼šå‡è®¾æˆ‘ä»¬å°†æ¯ä¸ª URL ç¼©çŸ­è¯·æ±‚ï¼ˆä»¥åŠç›¸å…³çš„ç¼©çŸ­é“¾æ¥ï¼‰å­˜å‚¨ 5 å¹´ã€‚ç”±äºæˆ‘ä»¬é¢„è®¡æ¯æœˆä¼šæœ‰ 5 äº¿ä¸ªæ–° URLï¼Œå› æ­¤æˆ‘ä»¬é¢„è®¡å­˜å‚¨çš„å¯¹è±¡æ€»æ•°å°†ä¸º 300 äº¿ä¸ªï¼š\n500 million * 5 years * 12 months = 30 billion\nLetâ€™s assume that each stored object will be approximately 500 bytes (just a ballpark estimateâ€“we will dig into it later). We will need 15TB of total storage:\næˆ‘ä»¬å‡è®¾æ¯ä¸ªå­˜å‚¨çš„å¯¹è±¡å¤§çº¦æœ‰ 500 å­—èŠ‚ï¼ˆåªæ˜¯ä¸€ä¸ªå¤§æ¦‚çš„ä¼°è®¡â€”â€”æˆ‘ä»¬ç¨åä¼šæ·±å…¥ç ”ç©¶ï¼‰ã€‚æˆ‘ä»¬éœ€è¦ 15TB çš„æ€»å­˜å‚¨ç©ºé—´ï¼š\n30 billion * 500 bytes = 15 TB\nBandwidth estimates: For write requests, since we expect 200 new URLs every second, total incoming data for our service will be 100KB per second:\nå¸¦å®½ä¼°è®¡ï¼šå¯¹äºå†™å…¥è¯·æ±‚ï¼Œç”±äºæˆ‘ä»¬é¢„è®¡æ¯ç§’æœ‰ 200 ä¸ªæ–° URLï¼Œå› æ­¤æˆ‘ä»¬æœåŠ¡çš„æ€»ä¼ å…¥æ•°æ®å°†ä¸ºæ¯ç§’ 100KBï¼š\n200 * 500 bytes = 100 KB/s\nFor read requests, since every second we expect ~20K URLs redirections, total outgoing data for our service would be 10MB per second:\nå¯¹äºè¯»å–è¯·æ±‚ï¼Œç”±äºæˆ‘ä»¬é¢„è®¡æ¯ç§’çº¦æœ‰ 20K ä¸ª URL é‡å®šå‘ï¼Œå› æ­¤æˆ‘ä»¬æœåŠ¡çš„æ€»ä¼ å‡ºæ•°æ®å°†ä¸ºæ¯ç§’ 10MBï¼š\n20K * 500 bytes = ~10 MB/s\nMemory estimates: If we want to cache some of the hot URLs that are frequently accessed, how much memory will we need to store them? If we follow the 80-20 rule, meaning 20% of URLs generate 80% of traffic, we would like to cache these 20% hot URLs.\nå†…å­˜ä¼°ç®—ï¼šå¦‚æœæˆ‘ä»¬è¦ç¼“å­˜ä¸€äº›ç»å¸¸è®¿é—®çš„çƒ­é—¨ URLï¼Œæˆ‘ä»¬éœ€è¦å¤šå°‘å†…å­˜æ¥å­˜å‚¨å®ƒä»¬ï¼Ÿå¦‚æœæˆ‘ä»¬éµå¾ª 80-20 è§„åˆ™ï¼Œå³ 20% çš„ URL äº§ç”Ÿ 80% çš„æµé‡ï¼Œæˆ‘ä»¬å¸Œæœ›ç¼“å­˜è¿™ 20% çš„çƒ­é—¨ URLã€‚\nSince we have 20K requests per second, we will be getting 1.7 billion requests per day:\nç”±äºæˆ‘ä»¬æ¯ç§’æœ‰ 20K ä¸ªè¯·æ±‚ï¼Œå› æ­¤æˆ‘ä»¬æ¯å¤©å°†æ”¶åˆ° 17 äº¿ä¸ªè¯·æ±‚ï¼š\n20K * 3600 seconds * 24 hours = ~1.7 billion\nTo cache 20% of these requests, we will need 170GB of memory.\nè¦ç¼“å­˜å…¶ä¸­ 20% çš„è¯·æ±‚ï¼Œæˆ‘ä»¬éœ€è¦ 170GB å†…å­˜ã€‚\n0.2 * 1.7 billion * 500 bytes = ~170GB\nOne thing to note here is that since there will be a lot of duplicate requests (of the same URL), therefore, our actual memory usage will be less than 170GB.\nè¿™é‡Œéœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œç”±äºä¼šæœ‰å¾ˆå¤šé‡å¤è¯·æ±‚ï¼ˆåŒä¸€ URLï¼‰ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬çš„å®é™…å†…å­˜ä½¿ç”¨é‡å°†å°äº 170GBã€‚\nHigh level estimates: Assuming 500 million new URLs per month and 100:1 read:write ratio, following is the summary of the high level estimates for our service:\né«˜æ°´å¹³ä¼°è®¡ï¼šå‡è®¾æ¯æœˆæœ‰ 5 äº¿ä¸ªæ–° URL å’Œ 100:1 çš„è¯»ï¼šå†™æ¯”ç‡ï¼Œä»¥ä¸‹æ˜¯æˆ‘ä»¬æœåŠ¡çš„é«˜æ°´å¹³ä¼°è®¡çš„æ‘˜è¦ï¼š\nNew URLs 200/s URL redirections 20K/s Incoming data 100KB/s Outgoing data 10MB/s Storage for 5 years 15TB Memory for cache 170GB 4. System APIs ç³»ç»ŸAPI Once weâ€™ve finalized the requirements, itâ€™s always a good idea to define the system APIs. This should explicitly state what is expected from the system.\nä¸€æ—¦æˆ‘ä»¬æœ€ç»ˆç¡®å®šäº†éœ€æ±‚ï¼Œå®šä¹‰ç³»ç»Ÿ API æ€»æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚è¿™åº”è¯¥æ˜ç¡®è¯´æ˜ç³»ç»Ÿçš„æœŸæœ›ã€‚\nWe can have SOAP or REST APIs to expose the functionality of our service. Following could be the definitions of the APIs for creating and deleting URLs:\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨ SOAP æˆ– REST API æ¥å…¬å¼€æˆ‘ä»¬æœåŠ¡çš„åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯ç”¨äºåˆ›å»ºå’Œåˆ é™¤ URL çš„ API çš„å®šä¹‰ï¼š\ncreateURL(api_dev_key, original_url, custom_alias=None, user_name=None, expire_date=None) Parameters:\nå‚æ•°ï¼š\napi_dev_key (string): The API developer key of a registered account. This will be used to, among other things, throttle users based on their allocated quota.\napi_dev_key (string): æ³¨å†Œè´¦æˆ·çš„APIå¼€å‘è€…å¯†é’¥ã€‚é™¤å…¶ä»–å¤–ï¼Œè¿™å°†ç”¨äºæ ¹æ®åˆ†é…çš„é…é¢é™åˆ¶ç”¨æˆ·ã€‚\noriginal_url (string): Original URL to be shortened.\ncustom_aliasï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šURL çš„å¯é€‰è‡ªå®šä¹‰é”®ã€‚\ncustom_alias (string): Optional custom key for the URL.\nOriginal_urlï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šè¦ç¼©çŸ­çš„åŸå§‹ URLã€‚\nuser_name (string): Optional user name to be used in encoding.\nuser_nameï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šç¼–ç ä¸­ä½¿ç”¨çš„å¯é€‰ç”¨æˆ·åã€‚\nexpire_date (string): Optional expiration date for the shortened URL.\nexpire_dateï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šç¼©çŸ­çš„ URL çš„å¯é€‰åˆ°æœŸæ—¥æœŸã€‚\nReturns: (string) A successful insertion returns the shortened URL; otherwise, it returns an error code.\nè¿”å›ï¼šï¼ˆå­—ç¬¦ä¸²ï¼‰æˆåŠŸæ’å…¥è¿”å›ç¼©çŸ­çš„ URLï¼›å¦åˆ™ï¼Œå®ƒè¿”å›ä¸€ä¸ªé”™è¯¯ä»£ç ã€‚\ndeleteURL(api_dev_key, url_key) Where â€œurl_keyâ€ is a string representing the shortened URL to be retrieved. A successful deletion returns â€˜URL Removedâ€™.\nå…¶ä¸­â€œurl_keyâ€æ˜¯è¡¨ç¤ºè¦æ£€ç´¢çš„ç¼©çŸ­ URL çš„å­—ç¬¦ä¸²ã€‚æˆåŠŸåˆ é™¤å°†è¿”å›â€œURL å·²åˆ é™¤â€ã€‚\nHow do we detect and prevent abuse? A malicious user can put us out of business by consuming all URL keys in the current design. To prevent abuse, we can limit users via their api_dev_key. Each api_dev_key can be limited to a certain number of URL creations and redirections per some time period (which may be set to a different duration per developer key).\næˆ‘ä»¬å¦‚ä½•å‘ç°å¹¶é˜²æ­¢æ»¥ç”¨è¡Œä¸ºï¼Ÿ æ¶æ„ç”¨æˆ·å¯ä»¥é€šè¿‡æ¶ˆè€—å½“å‰è®¾è®¡ä¸­çš„æ‰€æœ‰ URL å¯†é’¥æ¥ä½¿æˆ‘ä»¬ç ´äº§ã€‚ä¸ºäº†é˜²æ­¢æ»¥ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ api_dev_key é™åˆ¶ç”¨æˆ·ã€‚æ¯ä¸ª api_dev_key å¯ä»¥é™åˆ¶ä¸ºåœ¨æŸä¸ªæ—¶é—´æ®µå†…ä¸€å®šæ•°é‡çš„ URL åˆ›å»ºå’Œé‡å®šå‘ï¼ˆå¯ä»¥å°†æ¯ä¸ªå¼€å‘äººå‘˜å¯†é’¥è®¾ç½®ä¸ºä¸åŒçš„æŒç»­æ—¶é—´ï¼‰ã€‚\n5. Database Design æ•°æ®åº“è®¾è®¡ Defining the DB schema in the early stages of the interview would help to understand the data flow among various components and later would guide towards data partitioning.\nåœ¨é¢è¯•çš„æ—©æœŸé˜¶æ®µå®šä¹‰æ•°æ®åº“æ¨¡å¼å°†æœ‰åŠ©äºç†è§£å„ä¸ªç»„ä»¶ä¹‹é—´çš„æ•°æ®æµï¼Œå¹¶åœ¨ä»¥åæŒ‡å¯¼æ•°æ®åˆ†åŒºã€‚\nA few observations about the nature of the data we will store:\nå…³äºæˆ‘ä»¬å°†å­˜å‚¨çš„æ•°æ®çš„æ€§è´¨çš„ä¸€äº›è§‚å¯Ÿï¼š\nWe need to store billions of records.\næˆ‘ä»¬éœ€è¦å­˜å‚¨æ•°åäº¿æ¡è®°å½•ã€‚\nEach object we store is small (less than 1K).\næˆ‘ä»¬å­˜å‚¨çš„æ¯ä¸ªå¯¹è±¡éƒ½å¾ˆå°ï¼ˆå°äº 1Kï¼‰ã€‚\nThere are no relationships between recordsâ€”other than storing which user created a URL.\né™¤äº†å­˜å‚¨å“ªä¸ªç”¨æˆ·åˆ›å»ºäº† URL ä¹‹å¤–ï¼Œè®°å½•ä¹‹é—´æ²¡æœ‰ä»»ä½•å…³ç³»ã€‚\nOur service is read-heavy.\næˆ‘ä»¬çš„æœåŠ¡æ˜¯é‡è¯»çš„ã€‚\nDatabase Schema:\næ•°æ®åº“æ¶æ„ï¼š\nWe would need two tables: one for storing information about the URL mappings, and one for the userâ€™s data who created the short link.\næˆ‘ä»¬éœ€è¦ä¸¤å¼ è¡¨ï¼šä¸€å¼ ç”¨äºå­˜å‚¨æœ‰å…³ URL æ˜ å°„çš„ä¿¡æ¯ï¼Œä¸€å¼ ç”¨äºåˆ›å»ºçŸ­é“¾æ¥çš„ç”¨æˆ·æ•°æ®ã€‚\nWhat kind of database should we use? Since we anticipate storing billions of rows, and we donâ€™t need to use relationships between objects â€“ a NoSQL key-value store like DynamoDB, Cassandra or Riak is a better choice. A NoSQL choice would also be easier to scale. Please see SQL vs NoSQL for more details.\næˆ‘ä»¬åº”è¯¥ä½¿ç”¨ä»€ä¹ˆæ ·çš„æ•°æ®åº“ï¼Ÿç”±äºæˆ‘ä»¬é¢„è®¡å­˜å‚¨æ•°åäº¿è¡Œï¼Œå¹¶ä¸”ä¸éœ€è¦ä½¿ç”¨å¯¹è±¡ä¹‹é—´çš„å…³ç³» - DynamoDBã€Cassandra æˆ– Riak ç­‰ NoSQL é”®å€¼å­˜å‚¨æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚ NoSQL é€‰æ‹©ä¹Ÿæ›´å®¹æ˜“æ‰©å±•ã€‚è¯·å‚é˜… SQL ä¸ NoSQL äº†è§£æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚\n6. Basic System Design and Algorithm åŸºæœ¬ç³»ç»Ÿè®¾è®¡å’Œç®—æ³• The problem we are solving here is, how to generate a short and unique key for a given URL.\næˆ‘ä»¬è¿™é‡Œè¦è§£å†³çš„é—®é¢˜æ˜¯ï¼Œå¦‚ä½•ä¸ºç»™å®šçš„ URL ç”Ÿæˆä¸€ä¸ªç®€çŸ­ä¸”å”¯ä¸€çš„å¯†é’¥ã€‚\nIn the TinyURL example in Section 1, the shortened URL is â€œhttp://tinyurl.com/jlg8zpcâ€. The last six characters of this URL is the short key we want to generate. Weâ€™ll explore two solutions here:\nåœ¨ç¬¬ 1 èŠ‚çš„ TinyURL ç¤ºä¾‹ä¸­ï¼Œç¼©çŸ­çš„ URL æ˜¯â€œhttp://tinyurl.com/jlg8zpcâ€ã€‚è¯¥URLçš„æœ€åå…­ä¸ªå­—ç¬¦æ˜¯æˆ‘ä»¬è¦ç”Ÿæˆçš„çŸ­å¯†é’¥ã€‚æˆ‘ä»¬å°†åœ¨è¿™é‡Œæ¢ç´¢ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š\na. Encoding actual URL\na. å¯¹å®é™… URL è¿›è¡Œç¼–ç \nWe can compute a unique hash (e.g., MD5 or SHA256, etc.) of the given URL. The hash can then be encoded for displaying. This encoding could be base36 ([a-z ,0-9]) or base62 ([A-Z, a-z, 0-9]) and if we add â€˜-â€™ and â€˜.â€™ we can use base64 encoding. A reasonable question would be, what should be the length of the short key? 6, 8 or 10 characters.\næˆ‘ä»¬å¯ä»¥è®¡ç®—ç»™å®š URL çš„å”¯ä¸€å“ˆå¸Œå€¼ï¼ˆä¾‹å¦‚ MD5 æˆ– SHA256 ç­‰ï¼‰ã€‚ç„¶åå¯ä»¥å¯¹æ•£åˆ—è¿›è¡Œç¼–ç ä»¥ä¾›æ˜¾ç¤ºã€‚è¯¥ç¼–ç å¯ä»¥æ˜¯base36ï¼ˆ[a-zï¼Œ0-9]ï¼‰æˆ–base62ï¼ˆ[A-Zï¼Œa-zï¼Œ0-9]ï¼‰ï¼Œå¦‚æœæˆ‘ä»¬æ·»åŠ â€œ-â€å’Œâ€œ.â€ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨base64ç¼–ç ã€‚ä¸€ä¸ªåˆç†çš„é—®é¢˜æ˜¯ï¼ŒçŸ­å¯†é’¥çš„é•¿åº¦åº”è¯¥æ˜¯å¤šå°‘ï¼Ÿ 6ã€8 æˆ– 10 ä¸ªå­—ç¬¦ã€‚\nUsing base64 encoding, a 6 letter long key would result in 64^6 = ~68.7 billion possible strings Using base64 encoding, an 8 letter long key would result in 64^8 = ~281 trillion possible strings\nä½¿ç”¨ Base64 ç¼–ç ï¼Œ6 ä¸ªå­—æ¯é•¿çš„å¯†é’¥å°†äº§ç”Ÿ 64^6 = ~687 äº¿ä¸ªå¯èƒ½çš„å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ Base64 ç¼–ç ï¼Œ8 ä¸ªå­—æ¯é•¿çš„å¯†é’¥å°†äº§ç”Ÿ 64^8 = ~281 ä¸‡äº¿ä¸ªå¯èƒ½çš„å­—ç¬¦ä¸²\nWith 68.7B unique strings, letâ€™s assume six letter keys would suffice for our system.\nå¯¹äº 68.7B çš„å”¯ä¸€å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å‡è®¾å…­ä¸ªå­—æ¯é”®è¶³ä»¥æ»¡è¶³æˆ‘ä»¬çš„ç³»ç»Ÿã€‚\nIf we use the MD5 algorithm as our hash function, itâ€™ll produce a 128-bit hash value. After base64 encoding, weâ€™ll get a string having more than 21 characters (since each base64 character encodes 6 bits of the hash value). Since we only have space for 8 characters per short key, how will we choose our key then? We can take the first 6 (or 8) letters for the key. This could result in key duplication though, upon which we can choose some other characters out of the encoding string or swap some characters.\nå¦‚æœæˆ‘ä»¬ä½¿ç”¨ MD5 ç®—æ³•ä½œä¸ºå“ˆå¸Œå‡½æ•°ï¼Œå®ƒå°†äº§ç”Ÿä¸€ä¸ª 128 ä½çš„å“ˆå¸Œå€¼ã€‚ç»è¿‡base64ç¼–ç åï¼Œæˆ‘ä»¬å°†å¾—åˆ°ä¸€ä¸ªè¶…è¿‡21ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²ï¼ˆå› ä¸ºæ¯ä¸ª base64 å­—ç¬¦ç¼–ç å“ˆå¸Œå€¼çš„6ä½ï¼‰ã€‚ç”±äºæ¯ä¸ªçŸ­å¯†é’¥åªæœ‰ 8 ä¸ªå­—ç¬¦çš„ç©ºé—´ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†å¦‚ä½•é€‰æ‹©æˆ‘ä»¬çš„å¯†é’¥å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥å–å‰ 6 ä¸ªï¼ˆæˆ– 8 ä¸ªï¼‰å­—æ¯ä½œä¸ºå¯†é’¥ã€‚ä½†è¿™å¯èƒ½ä¼šå¯¼è‡´å¯†é’¥é‡å¤ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä»ç¼–ç å­—ç¬¦ä¸²ä¸­é€‰æ‹©ä¸€äº›å…¶ä»–å­—ç¬¦æˆ–äº¤æ¢ä¸€äº›å­—ç¬¦ã€‚\nWhat are different issues with our solution? We have the following couple of problems with our encoding scheme:\næˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆæœ‰å“ªäº›ä¸åŒçš„é—®é¢˜ï¼Ÿæˆ‘ä»¬çš„ç¼–ç æ–¹æ¡ˆå­˜åœ¨ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š\nIf multiple users enter the same URL, they can get the same shortened URL, which is not acceptable.\nå¦‚æœå¤šä¸ªç”¨æˆ·è¾“å…¥ç›¸åŒçš„ URLï¼Œä»–ä»¬å¯ä»¥è·å¾—ç›¸åŒçš„ç¼©çŸ­çš„ URLï¼Œè¿™æ˜¯ä¸å¯æ¥å—çš„ã€‚\nWhat if parts of the URL are URL-encoded? e.g., http://www.educative.io/distributed.php?id=design, and http://www.educative.io/distributed.php%3Fid%3Ddesign are identical except for the URL encoding.\nå¦‚æœ URL çš„ä¸€éƒ¨åˆ†æ˜¯ URL ç¼–ç çš„æ€ä¹ˆåŠï¼Ÿä¾‹å¦‚ï¼Œhttp://www.eduative.io/distributed.php?id=design å’Œ http://www.educative.io/distributed.php%3Fid%3Ddesign é™¤äº† URL ç¼–ç ä¹‹å¤–ï¼Œå®Œå…¨ç›¸åŒã€‚\nWorkaround for the issues: We can append an increasing sequence number to each input URL to make it unique, and then generate a hash of it. We donâ€™t need to store this sequence number in the databases, though. Possible problems with this approach could be an ever-increasing sequence number. Can it overflow? Appending an increasing sequence number will also impact the performance of the service.\né—®é¢˜çš„è§£å†³æ–¹æ³•ï¼šæˆ‘ä»¬å¯ä»¥å°†é€’å¢çš„åºåˆ—å·é™„åŠ åˆ°æ¯ä¸ªè¾“å…¥ URL ä»¥ä½¿å…¶å”¯ä¸€ï¼Œç„¶åç”Ÿæˆå®ƒçš„å“ˆå¸Œå€¼ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬ä¸éœ€è¦å°†æ­¤åºåˆ—å·å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚è¿™ç§æ–¹æ³•å¯èƒ½å‡ºç°çš„é—®é¢˜æ˜¯åºåˆ—å·ä¸æ–­å¢åŠ ã€‚èƒ½æº¢å‡ºå—ï¼Ÿé™„åŠ é€’å¢çš„åºåˆ—å·ä¹Ÿä¼šå½±å“æœåŠ¡çš„æ€§èƒ½ã€‚\nAnother solution could be to append user id (which should be unique) to the input URL. However, if the user has not signed in, we would have to ask the user to choose a uniqueness key. Even after this, if we have a conflict, we have to keep generating a key until we get a unique one.\nå¦ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯å°†ç”¨æˆ· IDï¼ˆåº”è¯¥æ˜¯å”¯ä¸€çš„ï¼‰é™„åŠ åˆ°è¾“å…¥ URLã€‚ä½†æ˜¯ï¼Œå¦‚æœç”¨æˆ·å°šæœªç™»å½•ï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸è¦æ±‚ç”¨æˆ·é€‰æ‹©å”¯ä¸€æ€§å¯†é’¥ã€‚å³ä½¿åœ¨æ­¤ä¹‹åï¼Œå¦‚æœå‡ºç°å†²çªï¼Œæˆ‘ä»¬ä¹Ÿå¿…é¡»ç»§ç»­ç”Ÿæˆå¯†é’¥ï¼Œç›´åˆ°è·å¾—å”¯ä¸€çš„å¯†é’¥ã€‚\nb. Generating keys offline\nb.ç¦»çº¿ç”Ÿæˆå¯†é’¥\nWe can have a standalone Key Generation Service (KGS) that generates random six letter strings beforehand and stores them in a database (letâ€™s call it key-DB). Whenever we want to shorten a URL, we will just take one of the already-generated keys and use it. This approach will make things quite simple and fast. Not only are we not encoding the URL, but we wonâ€™t have to worry about duplications or collisions. KGS will make sure all the keys inserted into key-DB are unique\næˆ‘ä»¬å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„å¯†é’¥ç”ŸæˆæœåŠ¡ï¼ˆKGSï¼‰ï¼Œå®ƒé¢„å…ˆç”Ÿæˆéšæœºçš„å…­ä¸ªå­—æ¯å­—ç¬¦ä¸²å¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸ºå¯†é’¥æ•°æ®åº“ï¼‰ã€‚æ¯å½“æˆ‘ä»¬æƒ³è¦ç¼©çŸ­ URL æ—¶ï¼Œæˆ‘ä»¬åªéœ€è·å–å·²ç”Ÿæˆçš„å¯†é’¥ä¹‹ä¸€å¹¶ä½¿ç”¨å®ƒå³å¯ã€‚è¿™ç§æ–¹æ³•å°†ä½¿äº‹æƒ…å˜å¾—éå¸¸ç®€å•å’Œå¿«é€Ÿã€‚æˆ‘ä»¬ä¸ä»…ä¸å¯¹ URL è¿›è¡Œç¼–ç ï¼Œè€Œä¸”ä¸å¿…æ‹…å¿ƒé‡å¤æˆ–å†²çªã€‚ KGS å°†ç¡®ä¿æ’å…¥ key-DB çš„æ‰€æœ‰å¯†é’¥éƒ½æ˜¯å”¯ä¸€çš„\nCan concurrency cause problems? As soon as a key is used, it should be marked in the database to ensure it doesnâ€™t get used again. If there are multiple servers reading keys concurrently, we might get a scenario where two or more servers try to read the same key from the database. How can we solve this concurrency problem?\nå¹¶å‘ä¼šå¯¼è‡´é—®é¢˜å—ï¼Ÿå¯†é’¥ä¸€æ—¦ä½¿ç”¨ï¼Œå°±åº”è¯¥åœ¨æ•°æ®åº“ä¸­è¿›è¡Œæ ‡è®°ï¼Œä»¥ç¡®ä¿å®ƒä¸ä¼šè¢«å†æ¬¡ä½¿ç”¨ã€‚å¦‚æœæœ‰å¤šä¸ªæœåŠ¡å™¨åŒæ—¶è¯»å–å¯†é’¥ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°ä¸¤ä¸ªæˆ–å¤šä¸ªæœåŠ¡å™¨å°è¯•ä»æ•°æ®åº“è¯»å–ç›¸åŒå¯†é’¥çš„æƒ…å†µã€‚æˆ‘ä»¬å¦‚ä½•è§£å†³è¿™ä¸ªå¹¶å‘é—®é¢˜å‘¢ï¼Ÿ\nServers can use KGS to read/mark keys in the database. KGS can use two tables to store keys: one for keys that are not used yet, and one for all the used keys. As soon as KGS gives keys to one of the servers, it can move them to the used keys table. KGS can always keep some keys in memory so that it can quickly provide them whenever a server needs them.\næœåŠ¡å™¨å¯ä»¥ä½¿ç”¨ KGS è¯»å–/æ ‡è®°æ•°æ®åº“ä¸­çš„å¯†é’¥ã€‚ KGS å¯ä»¥ä½¿ç”¨ä¸¤å¼ è¡¨æ¥å­˜å‚¨å¯†é’¥ï¼šä¸€å¼ ç”¨äºå°šæœªä½¿ç”¨çš„å¯†é’¥ï¼Œä¸€å¼ ç”¨äºæ‰€æœ‰å·²ä½¿ç”¨çš„å¯†é’¥ã€‚ä¸€æ—¦ KGS å‘å…¶ä¸­ä¸€å°æœåŠ¡å™¨æä¾›å¯†é’¥ï¼Œå®ƒå°±å¯ä»¥å°†å®ƒä»¬ç§»åŠ¨åˆ°å·²ä½¿ç”¨çš„å¯†é’¥è¡¨ä¸­ã€‚ KGS å¯ä»¥å§‹ç»ˆå°†ä¸€äº›å¯†é’¥ä¿ç•™åœ¨å†…å­˜ä¸­ï¼Œä»¥ä¾¿åœ¨æœåŠ¡å™¨éœ€è¦æ—¶å¯ä»¥å¿«é€Ÿæä¾›å®ƒä»¬ã€‚\nFor simplicity, as soon as KGS loads some keys in memory, it can move them to the used keys table. This ensures each server gets unique keys. If KGS dies before assigning all the loaded keys to some server, we will be wasting those keysâ€“which is acceptable, given the huge number of keys we have.\nä¸ºç®€å•èµ·è§ï¼Œä¸€æ—¦ KGS å°†æŸäº›å¯†é’¥åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå®ƒå°±å¯ä»¥å°†å®ƒä»¬ç§»åŠ¨åˆ°å·²ä½¿ç”¨çš„å¯†é’¥è¡¨ä¸­ã€‚è¿™ç¡®ä¿æ¯ä¸ªæœåŠ¡å™¨è·å¾—å”¯ä¸€çš„å¯†é’¥ã€‚å¦‚æœ KGS åœ¨å°†æ‰€æœ‰åŠ è½½çš„å¯†é’¥åˆ†é…ç»™æŸä¸ªæœåŠ¡å™¨ä¹‹å‰å°±æ­»æ‰äº†ï¼Œæˆ‘ä»¬å°†æµªè´¹è¿™äº›å¯†é’¥â€”â€”è€ƒè™‘åˆ°æˆ‘ä»¬æ‹¥æœ‰å¤§é‡çš„å¯†é’¥ï¼Œè¿™æ˜¯å¯ä»¥æ¥å—çš„ã€‚\nKGS also has to make sure not to give the same key to multiple servers. For that, it must synchronize (or get a lock on) the data structure holding the keys before removing keys from it and giving them to a server\nKGS è¿˜å¿…é¡»ç¡®ä¿ä¸è¦å°†ç›¸åŒçš„å¯†é’¥æä¾›ç»™å¤šä¸ªæœåŠ¡å™¨ã€‚ä¸ºæ­¤ï¼Œå®ƒå¿…é¡»åŒæ­¥ï¼ˆæˆ–é”å®šï¼‰ä¿å­˜å¯†é’¥çš„æ•°æ®ç»“æ„ï¼Œç„¶åå†ä»ä¸­åˆ é™¤å¯†é’¥å¹¶å°†å…¶æä¾›ç»™æœåŠ¡å™¨\nWhat would be the key-DB size? With base64 encoding, we can generate 68.7B unique six letters keys. If we need one byte to store one alpha-numeric character, we can store all these keys in:\nå¯†é’¥æ•°æ®åº“çš„å¤§å°æ˜¯å¤šå°‘ï¼Ÿé€šè¿‡ base64 ç¼–ç ï¼Œæˆ‘ä»¬å¯ä»¥ç”Ÿæˆ 68.7B å”¯ä¸€çš„å…­ä¸ªå­—æ¯å¯†é’¥ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå­—èŠ‚æ¥å­˜å‚¨ä¸€ä¸ªå­—æ¯æ•°å­—å­—ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰è¿™äº›é”®å­˜å‚¨åœ¨ï¼š\n6 (characters per key) * 68.7B (unique keys) = 412 GB.\nIsnâ€™t KGS a single point of failure? Yes, it is. To solve this, we can have a standby replica of KGS. Whenever the primary server dies, the standby server can take over to generate and provide keys.\nKGS ä¸æ˜¯å•ç‚¹æ•…éšœå—ï¼Ÿæ˜¯çš„ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥æ‹¥æœ‰ä¸€ä¸ª KGS çš„å¤‡ç”¨å‰¯æœ¬ã€‚æ¯å½“ä¸»æœåŠ¡å™¨æŒ‚æ‰æ—¶ï¼Œå¤‡ç”¨æœåŠ¡å™¨å°±å¯ä»¥æ¥ç®¡å¹¶ç”Ÿæˆå’Œæä¾›å¯†é’¥ã€‚\nCan each app server cache some keys from key-DB? Yes, this can surely speed things up. Although in this case, if the application server dies before consuming all the keys, we will end up losing those keys. This can be acceptable since we have 68B unique six letter keys.\næ¯ä¸ªåº”ç”¨ç¨‹åºæœåŠ¡å™¨å¯ä»¥ç¼“å­˜å¯†é’¥æ•°æ®åº“ä¸­çš„ä¸€äº›å¯†é’¥å—ï¼Ÿæ˜¯çš„ï¼Œè¿™è‚¯å®šå¯ä»¥åŠ å¿«é€Ÿåº¦ã€‚å°½ç®¡åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœåº”ç”¨ç¨‹åºæœåŠ¡å™¨åœ¨æ¶ˆè€—æ‰€æœ‰å¯†é’¥ä¹‹å‰æ­»äº¡ï¼Œæˆ‘ä»¬æœ€ç»ˆå°†ä¸¢å¤±è¿™äº›å¯†é’¥ã€‚è¿™æ˜¯å¯ä»¥æ¥å—çš„ï¼Œå› ä¸ºæˆ‘ä»¬æœ‰ 68B ç‹¬ç‰¹çš„å…­å­—æ¯é”®ã€‚\nHow would we perform a key lookup? We can look up the key in our database or key-value store to get the full URL. If itâ€™s present, issue an â€œHTTP 302 Redirectâ€ status back to the browser, passing the stored URL in the â€œLocationâ€ field of the request. If that key is not present in our system, issue an â€œHTTP 404 Not Foundâ€ status or redirect the user back to the homepage.\næˆ‘ä»¬å¦‚ä½•æ‰§è¡Œé”®æŸ¥æ‰¾ï¼Ÿæˆ‘ä»¬å¯ä»¥åœ¨æ•°æ®åº“æˆ–é”®å€¼å­˜å‚¨ä¸­æŸ¥æ‰¾é”®æ¥è·å–å®Œæ•´çš„ URLã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™å‘æµè§ˆå™¨å‘å‡ºâ€œHTTP 302 é‡å®šå‘â€çŠ¶æ€ï¼Œå¹¶åœ¨è¯·æ±‚çš„â€œä½ç½®â€å­—æ®µä¸­ä¼ é€’å­˜å‚¨çš„ URLã€‚å¦‚æœæˆ‘ä»¬çš„ç³»ç»Ÿä¸­ä¸å­˜åœ¨è¯¥å¯†é’¥ï¼Œè¯·å‘å‡ºâ€œHTTP 404 Not Foundâ€çŠ¶æ€æˆ–å°†ç”¨æˆ·é‡å®šå‘å›ä¸»é¡µã€‚\nShould we impose size limits on custom aliases? Our service supports custom aliases. Users can pick any â€˜keyâ€™ they like, but providing a custom alias is not mandatory. However, it is reasonable (and often desirable) to impose a size limit on a custom alias to ensure we have a consistent URL database. Letâ€™s assume users can specify a maximum of 16 characters per customer key (as reflected in the above database schema).\næˆ‘ä»¬åº”è¯¥å¯¹è‡ªå®šä¹‰åˆ«åæ–½åŠ å¤§å°é™åˆ¶å—ï¼Ÿæˆ‘ä»¬çš„æœåŠ¡æ”¯æŒè‡ªå®šä¹‰åˆ«åã€‚ç”¨æˆ·å¯ä»¥é€‰æ‹©ä»–ä»¬å–œæ¬¢çš„ä»»ä½•â€œé”®â€ï¼Œä½†æä¾›è‡ªå®šä¹‰åˆ«åä¸æ˜¯å¼ºåˆ¶æ€§çš„ã€‚ç„¶è€Œï¼Œå¯¹è‡ªå®šä¹‰åˆ«åæ–½åŠ å¤§å°é™åˆ¶ä»¥ç¡®ä¿æˆ‘ä»¬æ‹¥æœ‰ä¸€è‡´çš„ URL æ•°æ®åº“æ˜¯åˆç†çš„ï¼ˆå¹¶ä¸”é€šå¸¸æ˜¯å¯å–çš„ï¼‰ã€‚å‡è®¾ç”¨æˆ·å¯ä»¥ä¸ºæ¯ä¸ªå®¢æˆ·å¯†é’¥æŒ‡å®šæœ€å¤š 16 ä¸ªå­—ç¬¦ï¼ˆå¦‚ä¸Šé¢çš„æ•°æ®åº“æ¶æ„æ‰€ç¤ºï¼‰ã€‚\nHigh level system design for URL shortening\nURL ç¼©çŸ­çš„é«˜çº§ç³»ç»Ÿè®¾è®¡\n7. Data Partitioning and Replication æ•°æ®åˆ†åŒºå’Œå¤åˆ¶ To scale out our DB, we need to partition it so that it can store information about billions of URLs. We need to come up with a partitioning scheme that would divide and store our data to different DB servers.\nä¸ºäº†æ‰©å±•æˆ‘ä»¬çš„æ•°æ®åº“ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œåˆ†åŒºï¼Œä»¥ä¾¿å®ƒå¯ä»¥å­˜å‚¨æœ‰å…³æ•°åäº¿ä¸ª URL çš„ä¿¡æ¯ã€‚æˆ‘ä»¬éœ€è¦æå‡ºä¸€ä¸ªåˆ†åŒºæ–¹æ¡ˆï¼Œå°†æ•°æ®åˆ’åˆ†å¹¶å­˜å‚¨åˆ°ä¸åŒçš„æ•°æ®åº“æœåŠ¡å™¨ã€‚\na. Range Based Partitioning: We can store URLs in separate partitions based on the first letter of the URL or the hash key. Hence we save all the URLs starting with letter â€˜Aâ€™ in one partition, save those that start with letter â€˜Bâ€™ in another partition and so on. This approach is called range-based partitioning. We can even combine certain less frequently occurring letters into one database partition. We should come up with a static partitioning scheme so that we can always store/find a file in a predictable manner.\na.åŸºäºèŒƒå›´çš„åˆ†åŒºï¼š æˆ‘ä»¬å¯ä»¥æ ¹æ® URL çš„é¦–å­—æ¯æˆ–å“ˆå¸Œé”®å°† URL å­˜å‚¨åœ¨å•ç‹¬çš„åˆ†åŒºä¸­ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰ä»¥å­—æ¯â€œAâ€å¼€å¤´çš„ URL ä¿å­˜åœ¨ä¸€ä¸ªåˆ†åŒºä¸­ï¼Œå°†é‚£äº›ä»¥å­—æ¯â€œBâ€å¼€å¤´çš„ URL ä¿å­˜åœ¨å¦ä¸€ä¸ªåˆ†åŒºä¸­ï¼Œä¾æ­¤ç±»æ¨ã€‚è¿™ç§æ–¹æ³•ç§°ä¸ºåŸºäºèŒƒå›´çš„åˆ†åŒºã€‚æˆ‘ä»¬ç”šè‡³å¯ä»¥å°†æŸäº›ä¸å¸¸å‡ºç°çš„å­—æ¯åˆå¹¶åˆ°ä¸€ä¸ªæ•°æ®åº“åˆ†åŒºä¸­ã€‚æˆ‘ä»¬åº”è¯¥æå‡ºä¸€ä¸ªé™æ€åˆ†åŒºæ–¹æ¡ˆï¼Œä»¥ä¾¿æˆ‘ä»¬å§‹ç»ˆå¯ä»¥ä»¥å¯é¢„æµ‹çš„æ–¹å¼å­˜å‚¨/æŸ¥æ‰¾æ–‡ä»¶ã€‚\nThe main problem with this approach is that it can lead to unbalanced servers. For example: we decide to put all URLs starting with letter â€˜Eâ€™ into a DB partition, but later we realize that we have too many URLs that start with letter â€˜Eâ€™.\nè¿™ç§æ–¹æ³•çš„ä¸»è¦é—®é¢˜æ˜¯å®ƒå¯èƒ½å¯¼è‡´æœåŠ¡å™¨ä¸å¹³è¡¡ã€‚ä¾‹å¦‚ï¼šæˆ‘ä»¬å†³å®šå°†æ‰€æœ‰ä»¥å­—æ¯â€œEâ€å¼€å¤´çš„ URL æ”¾å…¥æ•°æ®åº“åˆ†åŒºï¼Œä½†åæ¥æˆ‘ä»¬æ„è¯†åˆ°ä»¥å­—æ¯â€œEâ€å¼€å¤´çš„ URL å¤ªå¤šäº†ã€‚\nb. Hash-Based Partitioning: In this scheme, we take a hash of the object we are storing. We then calculate which partition to use based upon the hash. In our case, we can take the hash of the â€˜keyâ€™ or the actual URL to determine the partition in which we store the data object.\nb.åŸºäºå“ˆå¸Œçš„åˆ†åŒºï¼š åœ¨æ­¤æ–¹æ¡ˆä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨æ‰€å­˜å‚¨å¯¹è±¡çš„å“ˆå¸Œå€¼ã€‚ç„¶åæˆ‘ä»¬æ ¹æ®å“ˆå¸Œè®¡ç®—è¦ä½¿ç”¨å“ªä¸ªåˆ†åŒºã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨â€œé”®â€çš„å“ˆå¸Œå€¼æˆ–å®é™… URL æ¥ç¡®å®šå­˜å‚¨æ•°æ®å¯¹è±¡çš„åˆ†åŒºã€‚\nOur hashing function will randomly distribute URLs into different partitions (e.g., our hashing function can always map any key to a number between [1â€¦256]), and this number would represent the partition in which we store our object.\næˆ‘ä»¬çš„å“ˆå¸Œå‡½æ•°ä¼šå°† URL éšæœºåˆ†å¸ƒåˆ°ä¸åŒçš„åˆ†åŒºä¸­ï¼ˆä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„å“ˆå¸Œå‡½æ•°å§‹ç»ˆå¯ä»¥å°†ä»»ä½•é”®æ˜ å°„åˆ° [1â€¦256] ä¹‹é—´çš„æ•°å­—ï¼‰ï¼Œå¹¶ä¸”è¯¥æ•°å­—å°†ä»£è¡¨æˆ‘ä»¬å­˜å‚¨å¯¹è±¡çš„åˆ†åŒºã€‚\nThis approach can still lead to overloaded partitions, which can be solved by using Consistent Hashing.\nè¿™ç§æ–¹æ³•ä»ç„¶ä¼šå¯¼è‡´åˆ†åŒºè¿‡è½½ï¼Œè¿™å¯ä»¥é€šè¿‡ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œæ¥è§£å†³ã€‚\n8. Cache ç¼“å­˜ We can cache URLs that are frequently accessed. We can use some off-the-shelf solution like Memcache, which can store full URLs with their respective hashes. The application servers, before hitting backend storage, can quickly check if the cache has the desired URL.\næˆ‘ä»¬å¯ä»¥ç¼“å­˜ç»å¸¸è®¿é—®çš„URLã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›ç°æˆçš„è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚ Memcacheï¼Œå®ƒå¯ä»¥å­˜å‚¨å®Œæ•´çš„ URL åŠå…¶å„è‡ªçš„å“ˆå¸Œå€¼ã€‚åº”ç”¨ç¨‹åºæœåŠ¡å™¨åœ¨è®¿é—®åç«¯å­˜å‚¨ä¹‹å‰ï¼Œå¯ä»¥å¿«é€Ÿæ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦æœ‰æ‰€éœ€çš„ URLã€‚\nHow much cache should we have? We can start with 20% of daily traffic and, based on clientsâ€™ usage pattern, we can adjust how many cache servers we need. As estimated above, we need 170GB memory to cache 20% of daily traffic. Since a modern-day server can have 256GB memory, we can easily fit all the cache into one machine. Alternatively, we can use a couple of smaller servers to store all these hot URLs.\næˆ‘ä»¬åº”è¯¥æœ‰å¤šå°‘ç¼“å­˜ï¼Ÿæˆ‘ä»¬å¯ä»¥ä»æ¯æ—¥æµé‡çš„ 20% å¼€å§‹ï¼Œæ ¹æ®å®¢æˆ·çš„ä½¿ç”¨æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒæ•´æˆ‘ä»¬éœ€è¦çš„ç¼“å­˜æœåŠ¡å™¨æ•°é‡ã€‚æ ¹æ®ä¸Šé¢çš„ä¼°è®¡ï¼Œæˆ‘ä»¬éœ€è¦ 170GB å†…å­˜æ¥ç¼“å­˜ 20% çš„æ—¥å¸¸æµé‡ã€‚ç”±äºç°ä»£æœåŠ¡å™¨å¯ä»¥æ‹¥æœ‰ 256GB å†…å­˜ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°å°†æ‰€æœ‰ç¼“å­˜å®‰è£…åˆ°ä¸€å°æœºå™¨ä¸­ã€‚æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‡ ä¸ªè¾ƒå°çš„æœåŠ¡å™¨æ¥å­˜å‚¨æ‰€æœ‰è¿™äº›çƒ­é—¨ URLã€‚\nWhich cache eviction policy would best fit our needs? When the cache is full, and we want to replace a link with a newer/hotter URL, how would we choose? Least Recently Used (LRU) can be a reasonable policy for our system. Under this policy, we discard the least recently used URL first. We can use a Linked Hash Map or a similar data structure to store our URLs and Hashes, which will also keep track of the URLs that have been accessed recently.\nå“ªç§ç¼“å­˜é©±é€ç­–ç•¥æœ€é€‚åˆæˆ‘ä»¬çš„éœ€æ±‚ï¼Ÿå½“ç¼“å­˜å·²æ»¡ï¼Œå¹¶ä¸”æˆ‘ä»¬æƒ³ç”¨æ›´æ–°/æ›´çƒ­é—¨çš„ URL æ›¿æ¢é“¾æ¥æ—¶ï¼Œæˆ‘ä»¬ä¼šå¦‚ä½•é€‰æ‹©ï¼Ÿæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLRUï¼‰å¯¹äºæˆ‘ä»¬çš„ç³»ç»Ÿæ¥è¯´æ˜¯ä¸€ä¸ªåˆç†çš„ç­–ç•¥ã€‚æ ¹æ®æ­¤ç­–ç•¥ï¼Œæˆ‘ä»¬é¦–å…ˆä¸¢å¼ƒæœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ URLã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨é“¾æ¥å“ˆå¸Œæ˜ å°„æˆ–ç±»ä¼¼çš„æ•°æ®ç»“æ„æ¥å­˜å‚¨æˆ‘ä»¬çš„ URL å’Œå“ˆå¸Œï¼Œå®ƒè¿˜å°†è·Ÿè¸ªæœ€è¿‘è®¿é—®è¿‡çš„ URLã€‚\nTo further increase the efficiency, we can replicate our caching servers to distribute load between them.\nä¸ºäº†è¿›ä¸€æ­¥æé«˜æ•ˆç‡ï¼Œæˆ‘ä»¬å¯ä»¥å¤åˆ¶ç¼“å­˜æœåŠ¡å™¨ä»¥åœ¨å®ƒä»¬ä¹‹é—´åˆ†é…è´Ÿè½½ã€‚\nHow can each cache replica be updated? Whenever there is a cache miss, our servers would be hitting a backend database. Whenever this happens, we can update the cache and pass the new entry to all the cache replicas. Each replica can update their cache by adding the new entry. If a replica already has that entry, it can simply ignore it.\nå¦‚ä½•æ›´æ–°æ¯ä¸ªç¼“å­˜å‰¯æœ¬ï¼Ÿæ¯å½“å‡ºç°ç¼“å­˜æœªå‘½ä¸­æ—¶ï¼Œæˆ‘ä»¬çš„æœåŠ¡å™¨å°±ä¼šè®¿é—®åç«¯æ•°æ®åº“ã€‚æ¯å½“å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥æ›´æ–°ç¼“å­˜å¹¶å°†æ–°æ¡ç›®ä¼ é€’ç»™æ‰€æœ‰ç¼“å­˜å‰¯æœ¬ã€‚æ¯ä¸ªå‰¯æœ¬éƒ½å¯ä»¥é€šè¿‡æ·»åŠ æ–°æ¡ç›®æ¥æ›´æ–°å…¶ç¼“å­˜ã€‚å¦‚æœå‰¯æœ¬å·²ç»å…·æœ‰è¯¥æ¡ç›®ï¼Œåˆ™å¯ä»¥ç®€å•åœ°å¿½ç•¥å®ƒã€‚\n9. Load Balancer (LB) 9.è´Ÿè½½å‡è¡¡å™¨ï¼ˆLBï¼‰\nRequest flow for accessing a shortened URL\nè®¿é—®ç¼©çŸ­çš„ URL çš„è¯·æ±‚æµç¨‹\nWe can add a Load balancing layer at three places in our system:\næˆ‘ä»¬å¯ä»¥åœ¨ç³»ç»Ÿä¸­çš„ä¸‰ä¸ªä½ç½®æ·»åŠ è´Ÿè½½å‡è¡¡å±‚ï¼š\nBetween Clients and Application servers\nå®¢æˆ·ç«¯å’Œåº”ç”¨æœåŠ¡å™¨ä¹‹é—´\nBetween Application Servers and database servers\nåº”ç”¨æœåŠ¡å™¨å’Œæ•°æ®åº“æœåŠ¡å™¨ä¹‹é—´\nBetween Application Servers and Cache servers\nåº”ç”¨æœåŠ¡å™¨å’Œç¼“å­˜æœåŠ¡å™¨ä¹‹é—´\nInitially, we could use a simple Round Robin approach that distributes incoming requests equally among backend servers. This LB is simple to implement and does not introduce any overhead. Another benefit of this approach is that if a server is dead, LB will take it out of the rotation and will stop sending any traffic to it.\næœ€åˆï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç®€å•çš„å¾ªç¯æ–¹æ³•ï¼Œåœ¨åç«¯æœåŠ¡å™¨ä¹‹é—´å¹³å‡åˆ†é…ä¼ å…¥è¯·æ±‚ã€‚è¯¥LBå®ç°ç®€å•ï¼Œä¸ä¼šå¼•å…¥ä»»ä½•å¼€é”€ã€‚è¿™ç§æ–¹æ³•çš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œå¦‚æœæœåŠ¡å™¨æ­»æœºï¼ŒLB ä¼šå°†å…¶ä»è½®æ¢ä¸­åˆ é™¤ï¼Œå¹¶åœæ­¢å‘å…¶å‘é€ä»»ä½•æµé‡ã€‚\nA problem with Round Robin LB is that server load is not taken into consideration. If a server is overloaded or slow, the LB will not stop sending new requests to that server. To handle this, a more intelligent LB solution can be placed that periodically queries the backend server about its load and adjusts traffic based on that.\nå¾ªç¯è´Ÿè½½å‡è¡¡çš„ä¸€ä¸ªé—®é¢˜æ˜¯æ²¡æœ‰è€ƒè™‘æœåŠ¡å™¨è´Ÿè½½ã€‚å¦‚æœæœåŠ¡å™¨è¿‡è½½æˆ–é€Ÿåº¦ç¼“æ…¢ï¼Œè´Ÿè½½å‡è¡¡å™¨ä¸ä¼šåœæ­¢å‘è¯¥æœåŠ¡å™¨å‘é€æ–°è¯·æ±‚ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥é‡‡ç”¨æ›´æ™ºèƒ½çš„è´Ÿè½½å‡è¡¡è§£å†³æ–¹æ¡ˆï¼Œå®šæœŸæŸ¥è¯¢åç«¯æœåŠ¡å™¨çš„è´Ÿè½½æƒ…å†µï¼Œå¹¶æ®æ­¤è°ƒæ•´æµé‡ã€‚\n10. Purging or DB cleanup æ¸…é™¤æˆ–æ•°æ®åº“æ¸…ç† Should entries stick around forever or should they be purged? If a user-specified expiration time is reached, what should happen to the link?\næ¡ç›®åº”è¯¥æ°¸è¿œä¿ç•™è¿˜æ˜¯åº”è¯¥è¢«æ¸…é™¤ï¼Ÿå¦‚æœè¾¾åˆ°äº†ç”¨æˆ·æŒ‡å®šçš„è¿‡æœŸæ—¶é—´ï¼Œé“¾æ¥ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼Ÿ\nIf we chose to actively search for expired links to remove them, it would put a lot of pressure on our database. Instead, we can slowly remove expired links and do a lazy cleanup. Our service will make sure that only expired links will be deleted, although some expired links can live longer but will never be returned to users.\nå¦‚æœæˆ‘ä»¬é€‰æ‹©ä¸»åŠ¨æœç´¢è¿‡æœŸé“¾æ¥æ¥åˆ é™¤å®ƒä»¬ï¼Œè¿™ä¼šç»™æˆ‘ä»¬çš„æ•°æ®åº“å¸¦æ¥å¾ˆå¤§çš„å‹åŠ›ã€‚ç›¸åï¼Œæˆ‘ä»¬å¯ä»¥æ…¢æ…¢åˆ é™¤è¿‡æœŸé“¾æ¥å¹¶è¿›è¡Œæƒ°æ€§æ¸…ç†ã€‚æˆ‘ä»¬çš„æœåŠ¡å°†ç¡®ä¿åªåˆ é™¤è¿‡æœŸçš„é“¾æ¥ï¼Œå°½ç®¡æœ‰äº›è¿‡æœŸçš„é“¾æ¥å¯ä»¥å­˜åœ¨æ›´é•¿çš„æ—¶é—´ï¼Œä½†æ°¸è¿œä¸ä¼šè¿”å›ç»™ç”¨æˆ·ã€‚\nWhenever a user tries to access an expired link, we can delete the link and return an error to the user.\næ¯å½“ç”¨æˆ·å°è¯•è®¿é—®è¿‡æœŸé“¾æ¥æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ é™¤è¯¥é“¾æ¥å¹¶å‘ç”¨æˆ·è¿”å›é”™è¯¯ã€‚\nA separate Cleanup service can run periodically to remove expired links from our storage and cache. This service should be very lightweight and can be scheduled to run only when the user traffic is expected to be low.\nå¯ä»¥å®šæœŸè¿è¡Œå•ç‹¬çš„æ¸…ç†æœåŠ¡ï¼Œä»¥ä»æˆ‘ä»¬çš„å­˜å‚¨å’Œç¼“å­˜ä¸­åˆ é™¤è¿‡æœŸçš„é“¾æ¥ã€‚è¯¥æœåŠ¡åº”è¯¥éå¸¸è½»é‡çº§ï¼Œå¹¶ä¸”å¯ä»¥å®‰æ’ä»…åœ¨é¢„è®¡ç”¨æˆ·æµé‡è¾ƒä½æ—¶è¿è¡Œã€‚\nWe can have a default expiration time for each link (e.g., two years).\næˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸ªé“¾æ¥è®¾ç½®ä¸€ä¸ªé»˜è®¤çš„è¿‡æœŸæ—¶é—´ï¼ˆä¾‹å¦‚ä¸¤å¹´ï¼‰ã€‚\nAfter removing an expired link, we can put the key back in the key-DB to be reused.\nåˆ é™¤è¿‡æœŸé“¾æ¥åï¼Œæˆ‘ä»¬å¯ä»¥å°†å¯†é’¥æ”¾å›åˆ°å¯†é’¥æ•°æ®åº“ä¸­ä»¥ä¾›é‡å¤ä½¿ç”¨ã€‚\nShould we remove links that havenâ€™t been visited in some length of time, say six months? This could be tricky. Since storage is getting cheap, we can decide to keep links forever.\næˆ‘ä»¬æ˜¯å¦åº”è¯¥åˆ é™¤ä¸€æ®µæ—¶é—´å†…ï¼ˆä¾‹å¦‚å…­ä¸ªæœˆï¼‰æœªè®¿é—®è¿‡çš„é“¾æ¥ï¼Ÿè¿™å¯èƒ½ä¼šå¾ˆæ£˜æ‰‹ã€‚ç”±äºå­˜å‚¨å˜å¾—è¶Šæ¥è¶Šä¾¿å®œï¼Œæˆ‘ä»¬å¯ä»¥å†³å®šæ°¸è¿œä¿ç•™é“¾æ¥ã€‚\nDetailed component design for URL shortening\nURLç¼©çŸ­çš„è¯¦ç»†ç»„ä»¶è®¾è®¡\n11. Telemetry é¥æµ‹ How many times a short URL has been used, what were user locations, etc.? How would we store these statistics? If it is part of a DB row that gets updated on each view, what will happen when a popular URL is slammed with a large number of concurrent requests?\nçŸ­ URL ä½¿ç”¨äº†å¤šå°‘æ¬¡ï¼Œç”¨æˆ·ä½ç½®æ˜¯ä»€ä¹ˆï¼Œç­‰ç­‰ï¼Ÿæˆ‘ä»¬å¦‚ä½•å­˜å‚¨è¿™äº›ç»Ÿè®¡æ•°æ®ï¼Ÿå¦‚æœå®ƒæ˜¯åœ¨æ¯ä¸ªè§†å›¾ä¸Šæ›´æ–°çš„æ•°æ®åº“è¡Œçš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆå½“æµè¡Œçš„ URL å—åˆ°å¤§é‡å¹¶å‘è¯·æ±‚çš„å†²å‡»æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ\nSome statistics worth tracking: country of the visitor, date and time of access, web page that refers the click, browser, or platform from where the page was accessed.\nä¸€äº›å€¼å¾—è·Ÿè¸ªçš„ç»Ÿè®¡æ•°æ®ï¼šè®¿é—®è€…æ‰€åœ¨çš„å›½å®¶/åœ°åŒºã€è®¿é—®æ—¥æœŸå’Œæ—¶é—´ã€å¼•ç”¨ç‚¹å‡»çš„ç½‘é¡µã€æµè§ˆå™¨æˆ–è®¿é—®é¡µé¢çš„å¹³å°ã€‚\n12. Security and Permissions å®‰å…¨å’Œæƒé™ Can users create private URLs or allow a particular set of users to access a URL?\nç”¨æˆ·èƒ½å¦åˆ›å»ºç§æœ‰ URL æˆ–å…è®¸ç‰¹å®šç”¨æˆ·ç»„è®¿é—® URLï¼Ÿ\nWe can store permission level (public/private) with each URL in the database. We can also create a separate table to store UserIDs that have permission to see a specific URL. If a user does not have permission and tries to access a URL, we can send an error (HTTP 401) back. Given that we are storing our data in a NoSQL wide-column database like Cassandra, the key for the table storing permissions would be the â€˜Hashâ€™ (or the KGS generated â€˜keyâ€™). The columns will store the UserIDs of those users that have permissions to see the URL.\næˆ‘ä»¬å¯ä»¥åœ¨æ•°æ®åº“ä¸­å­˜å‚¨æ¯ä¸ª URL çš„æƒé™çº§åˆ«ï¼ˆå…¬å…±/ç§æœ‰ï¼‰ã€‚æˆ‘ä»¬è¿˜å¯ä»¥åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„è¡¨æ¥å­˜å‚¨æœ‰æƒæŸ¥çœ‹ç‰¹å®š URL çš„ UserIDã€‚å¦‚æœç”¨æˆ·æ²¡æœ‰æƒé™å¹¶å°è¯•è®¿é—® URLï¼Œæˆ‘ä»¬å¯ä»¥å‘å›é”™è¯¯ (HTTP 401)ã€‚é‰´äºæˆ‘ä»¬å°†æ•°æ®å­˜å‚¨åœ¨åƒ Cassandra è¿™æ ·çš„ NoSQL å®½åˆ—æ•°æ®åº“ä¸­ï¼Œè¡¨å­˜å‚¨æƒé™çš„å¯†é’¥å°†æ˜¯â€œå“ˆå¸Œâ€ï¼ˆæˆ– KGS ç”Ÿæˆçš„â€œå¯†é’¥â€ï¼‰ã€‚è¿™äº›åˆ—å°†å­˜å‚¨æœ‰æƒæŸ¥çœ‹ URL çš„ç”¨æˆ·çš„ UserIDã€‚\nå‚è€ƒæ–‡ç« \nDesigning a URL Shortening service like TinyURL Design a URL Shortening Service / TinyURL ","permalink":"https://blog.chensoul.cc/posts/2023/11/16/designing-a-url-shortening-service/","summary":"è¿™æ˜¯ä¸€ç¯‡åŒè¯­ç¿»è¯‘çš„æ–‡ç« ï¼ŒåŸæ–‡å‡ºè‡ª grok_system_design_interview.pdf çš„ä¸€ç¯‡æ–‡ç« ã€ŠDesigning a URL Shortening service like TinyURLã€‹è®¾è®¡ç±»ä¼¼ TinyURL çš„ URL ç¼©çŸ­æœåŠ¡ã€‚\nLetâ€™s design a URL shortening service like TinyURL. This service will provide short aliases redirecting to long URLs. Similar services: bit.ly, goo.gl, qlink.me, etc.\nè®©æˆ‘ä»¬è®¾è®¡ä¸€ä¸ªåƒ TinyURL è¿™æ ·çš„ URL ç¼©çŸ­æœåŠ¡ã€‚è¯¥æœåŠ¡å°†æä¾›é‡å®šå‘åˆ°é•¿ URL çš„çŸ­åˆ«åã€‚ç±»ä¼¼æœåŠ¡ï¼šbit.lyã€goo.glã€qlink.meç­‰ã€‚\nDifficulty Level: Easy\néš¾åº¦çº§åˆ«ï¼šç®€å•\n1.Why do we need URL shortening? 1.ä¸ºä»€ä¹ˆéœ€è¦URLç¼©çŸ­ï¼Ÿ\nURL shortening is used to create shorter aliases for long URLs. We call these shortened aliases â€œshort links.â€ Users are redirected to the original URL when they hit these short links. Short links save a lot of space when displayed, printed, messaged, or tweeted. Additionally, users are less likely to mistype shorter URLs.","title":"[è¯‘]ã€ŠGrokking the System Design Interviewã€‹è®¾è®¡ç±»ä¼¼ TinyURL çš„ URL ç¼©çŸ­æœåŠ¡"},{"content":"è¿™æ˜¯ä¸€ç¯‡åŒè¯­ç¿»è¯‘çš„æ–‡ç« ï¼ŒåŸæ–‡å‡ºè‡ª grok_system_design_interview.pdf çš„ä¸€ç¯‡æ–‡ç« ã€ŠSystem Design Interviews: A step by step guideã€‹ç³»ç»Ÿè®¾è®¡è®¿è°ˆï¼šåˆ†æ­¥æŒ‡å—ã€‚\nA lot of software engineers struggle with system design interviews (SDIs) primarily because of three reasons:\nè®¸å¤šè½¯ä»¶å·¥ç¨‹å¸ˆåœ¨ç³»ç»Ÿè®¾è®¡é¢è¯•ï¼ˆSDIï¼‰ä¸­é‡åˆ°å›°éš¾ï¼Œä¸»è¦æ˜¯å› ä¸ºä»¥ä¸‹ä¸‰ä¸ªåŸå› ï¼š\nThe unstructured nature of SDIs, where they are asked to work on an open-ended design problem that doesnâ€™t have a standard answer.\nSDI çš„éç»“æ„åŒ–æ€§è´¨ï¼Œè¦æ±‚ä»–ä»¬è§£å†³æ²¡æœ‰æ ‡å‡†ç­”æ¡ˆçš„å¼€æ”¾å¼è®¾è®¡é—®é¢˜ã€‚\nTheir lack of experience in developing large scale systems.\nä»–ä»¬ç¼ºä¹å¼€å‘å¤§å‹ç³»ç»Ÿçš„ç»éªŒã€‚\nThey did not prepare for SDIs.\nä»–ä»¬æ²¡æœ‰ä¸º SDI åšå¥½å‡†å¤‡ã€‚\nLike coding interviews, candidates who havenâ€™t put a conscious effort to prepare for SDIs, mostly perform poorly especially at top companies like Google, Facebook, Amazon, Microsoft, etc. In these companies, candidates who donâ€™t perform above average, have a limited chance to get an offer. On the other hand, a good performance always results in a better offer (higher position and salary), since it shows the candidateâ€™s ability to handle a complex system.\nä¸ç¼–ç é¢è¯•ä¸€æ ·ï¼Œæ²¡æœ‰åˆ»æ„å‡†å¤‡ SDI çš„å€™é€‰äººå¤§å¤šè¡¨ç°ä¸ä½³ï¼Œå°¤å…¶æ˜¯åœ¨ Googleã€Facebookã€äºšé©¬é€Šã€å¾®è½¯ç­‰é¡¶çº§å…¬å¸ã€‚åœ¨è¿™äº›å…¬å¸ä¸­ï¼Œè¡¨ç°ä¸é«˜äºå¹³å‡æ°´å¹³çš„å€™é€‰äººè·å¾—æŠ¥ä»·çš„æœºä¼šæœ‰é™ã€‚å¦ä¸€æ–¹é¢ï¼Œè‰¯å¥½çš„è¡¨ç°æ€»æ˜¯ä¼šå¸¦æ¥æ›´å¥½çš„å·¥ä½œæœºä¼šï¼ˆæ›´é«˜çš„èŒä½å’Œè–ªæ°´ï¼‰ï¼Œå› ä¸ºå®ƒæ˜¾ç¤ºäº†å€™é€‰äººå¤„ç†å¤æ‚ç³»ç»Ÿçš„èƒ½åŠ›ã€‚\nIn this course, weâ€™ll follow a step by step approach to solve multiple design problems. First, letâ€™s go through these steps:\nåœ¨æœ¬è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†éµå¾ªé€æ­¥çš„æ–¹æ³•æ¥è§£å†³å¤šä¸ªè®¾è®¡é—®é¢˜ã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬å®Œæˆä»¥ä¸‹æ­¥éª¤ï¼š\nStep 1: Requirements clarifications æ­¥éª¤ 1ï¼šéœ€æ±‚æ¾„æ¸…\nIt is always a good idea to ask questions about the exact scope of the problem we are solving. Design questions are mostly open-ended, and they donâ€™t have ONE correct answer, thatâ€™s why clarifying ambiguities early in the interview becomes critical. Candidates who spend enough time to define the end goals of the system always have a better chance to be successful in the interview. Also, since we only have 35-40 minutes to design a (supposedly) large system, we should clarify what parts of the system we will be focusing on.\nè¯¢é—®æˆ‘ä»¬æ­£åœ¨è§£å†³çš„é—®é¢˜çš„ç¡®åˆ‡èŒƒå›´æ€»æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚è®¾è®¡é—®é¢˜å¤§å¤šæ˜¯å¼€æ”¾å¼çš„ï¼Œå¹¶ä¸”æ²¡æœ‰ä¸€ä¸ªæ­£ç¡®çš„ç­”æ¡ˆï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨é¢è¯•åˆæœŸæ¾„æ¸…æ­§ä¹‰å˜å¾—è‡³å…³é‡è¦ã€‚èŠ±è¶³å¤Ÿæ—¶é—´æ¥å®šä¹‰ç³»ç»Ÿæœ€ç»ˆç›®æ ‡çš„å€™é€‰äººæ€»æ˜¯æœ‰æ›´å¥½çš„æœºä¼šåœ¨é¢è¯•ä¸­å–å¾—æˆåŠŸã€‚å¦å¤–ï¼Œç”±äºæˆ‘ä»¬åªæœ‰ 35-40 åˆ†é’Ÿçš„æ—¶é—´æ¥è®¾è®¡ä¸€ä¸ªï¼ˆæ®ç§°ï¼‰å¤§å‹ç³»ç»Ÿï¼Œå› æ­¤æˆ‘ä»¬åº”è¯¥æ˜ç¡®æˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨ç³»ç»Ÿçš„å“ªäº›éƒ¨åˆ†ã€‚\nLetâ€™s expand this with an actual example of designing a Twitter-like service. Here are some questions for designing Twitter that should be answered before moving on to the next steps:\nè®©æˆ‘ä»¬é€šè¿‡è®¾è®¡ç±»ä¼¼ Twitter çš„æœåŠ¡çš„å®é™…ç¤ºä¾‹æ¥æ‰©å±•è¿™ä¸€ç‚¹ã€‚ä»¥ä¸‹æ˜¯è®¾è®¡ Twitter æ—¶åº”å›ç­”çš„ä¸€äº›é—®é¢˜ï¼Œç„¶åå†ç»§ç»­ä¸‹ä¸€æ­¥ï¼š\nWill users of our service be able to post tweets and follow other people?\næˆ‘ä»¬æœåŠ¡çš„ç”¨æˆ·èƒ½å¤Ÿå‘å¸ƒæ¨æ–‡å¹¶å…³æ³¨å…¶ä»–äººå—ï¼Ÿ\nShould we also design to create and display the userâ€™s timeline?\næˆ‘ä»¬è¿˜åº”è¯¥è®¾è®¡åˆ›å»ºå’Œæ˜¾ç¤ºç”¨æˆ·çš„æ—¶é—´çº¿å—ï¼Ÿ\nWill tweets contain photos and videos?\næ¨æ–‡ä¼šåŒ…å«ç…§ç‰‡å’Œè§†é¢‘å—ï¼Ÿ\nAre we focusing on the backend only or are we developing the front-end too?\næˆ‘ä»¬åªå…³æ³¨åç«¯è¿˜æ˜¯ä¹Ÿå¼€å‘å‰ç«¯ï¼Ÿ\nWill users be able to search tweets?\nç”¨æˆ·èƒ½å¤Ÿæœç´¢æ¨æ–‡å—ï¼Ÿ\nDo we need to display hot trending topics?\næˆ‘ä»¬éœ€è¦å±•ç¤ºçƒ­é—¨è¯é¢˜å—ï¼Ÿ\nWill there be any push notification for new (or important) tweets?\næ–°çš„ï¼ˆæˆ–é‡è¦çš„ï¼‰æ¨æ–‡ä¼šæœ‰æ¨é€é€šçŸ¥å—ï¼Ÿ\nAll such question will determine how our end design will look like.\næ‰€æœ‰è¿™äº›é—®é¢˜å°†å†³å®šæˆ‘ä»¬çš„æœ€ç»ˆè®¾è®¡ä¼šæ˜¯ä»€ä¹ˆæ ·å­ã€‚\nStep 2: System interface definition æ­¥éª¤2 ï¼šç³»ç»Ÿæ¥å£å®šä¹‰\nDefine what APIs are expected from the system. This will not only establish the exact contract expected from the system, but will also ensure if we havenâ€™t gotten any requirements wrong. Some examples for our Twitter-like service will be:\nå®šä¹‰ç³»ç»ŸæœŸæœ›æä¾›å“ªäº› APIã€‚è¿™ä¸ä»…å¯ä»¥å»ºç«‹ç³»ç»Ÿæ‰€æœŸæœ›çš„å‡†ç¡®åˆåŒï¼Œè€Œä¸”è¿˜å¯ä»¥ç¡®ä¿æˆ‘ä»¬æ²¡æœ‰é”™è¯¯åœ°æå‡ºä»»ä½•è¦æ±‚ã€‚æˆ‘ä»¬ç±»ä¼¼ Twitter çš„æœåŠ¡çš„ä¸€äº›ç¤ºä¾‹å¦‚ä¸‹ï¼š\npostTweet(user_id, tweet_data, tweet_location, user_location, timestamp, ...) generateTimeline(user_id, current_time, user_location, ...) markTweetFavorite(user_id, tweet_id, timestamp, ...) Step 3: Back-of-the-envelope estimation æ­¥éª¤ 3ï¼šç²—ç•¥ä¼°è®¡\nIt is always a good idea to estimate the scale of the system weâ€™re going to design. This will also help later when we will be focusing on scaling, partitioning, load balancing and caching.\nä¼°è®¡æˆ‘ä»¬è¦è®¾è®¡çš„ç³»ç»Ÿçš„è§„æ¨¡æ€»æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚å½“æˆ‘ä»¬ç¨åå…³æ³¨æ‰©å±•ã€åˆ†åŒºã€è´Ÿè½½å¹³è¡¡å’Œç¼“å­˜æ—¶ï¼Œè¿™ä¹Ÿä¼šæœ‰æ‰€å¸®åŠ©ã€‚\nWhat scale is expected from the system (e.g., number of new tweets, number of tweet views, number of timeline generations per sec., etc.)?\nç³»ç»Ÿçš„é¢„æœŸè§„æ¨¡æ˜¯å¤šå°‘ï¼ˆä¾‹å¦‚ï¼Œæ–°æ¨æ–‡æ•°é‡ã€æ¨æ–‡æµè§ˆé‡ã€æ¯ç§’ç”Ÿæˆçš„æ—¶é—´çº¿æ•°é‡ç­‰ï¼‰ï¼Ÿ\nHow much storage will we need? We will have different numbers if users can have photos and videos in their tweets.\næˆ‘ä»¬éœ€è¦å¤šå°‘å­˜å‚¨ç©ºé—´ï¼Ÿå¦‚æœç”¨æˆ·çš„æ¨æ–‡ä¸­å¯ä»¥åŒ…å«ç…§ç‰‡å’Œè§†é¢‘ï¼Œæˆ‘ä»¬å°†å¾—åˆ°ä¸åŒçš„æ•°å­—ã€‚\nWhat network bandwidth usage are we expecting? This will be crucial in deciding how we will manage traffic and balance load between servers.\næˆ‘ä»¬æœŸæœ›ä½¿ç”¨å¤šå°‘ç½‘ç»œå¸¦å®½ï¼Ÿè¿™å¯¹äºå†³å®šæˆ‘ä»¬å¦‚ä½•ç®¡ç†æµé‡å’Œå¹³è¡¡æœåŠ¡å™¨ä¹‹é—´çš„è´Ÿè½½è‡³å…³é‡è¦ã€‚\nStep 4: Defining data model æ­¥éª¤ 4ï¼šå®šä¹‰æ•°æ®æ¨¡å‹\nDefining the data model early will clarify how data will flow among different components of the system. Later, it will guide towards data partitioning and management. The candidate should be able to identify various entities of the system, how they will interact with each other, and different aspect of data management like storage, transportation, encryption, etc. Here are some entities for our Twitter- like service:\nå°½æ—©å®šä¹‰æ•°æ®æ¨¡å‹å°†é˜æ˜æ•°æ®å¦‚ä½•åœ¨ç³»ç»Ÿçš„ä¸åŒç»„ä»¶ä¹‹é—´æµåŠ¨ã€‚ç¨åï¼Œå®ƒå°†æŒ‡å¯¼æ•°æ®åˆ†åŒºå’Œç®¡ç†ã€‚è€ƒç”Ÿåº”è¯¥èƒ½å¤Ÿè¯†åˆ«ç³»ç»Ÿçš„å„ç§å®ä½“ï¼Œå®ƒä»¬å¦‚ä½•ç›¸äº’äº¤äº’ï¼Œä»¥åŠæ•°æ®ç®¡ç†çš„ä¸åŒæ–¹é¢ï¼Œå¦‚å­˜å‚¨ã€ä¼ è¾“ã€åŠ å¯†ç­‰ã€‚ä»¥ä¸‹æ˜¯æˆ‘ä»¬ç±»ä¼¼ Twitter æœåŠ¡çš„ä¸€äº›å®ä½“ï¼š\nUser: UserID, Name, Email, DoB, CreationDate, LastLogin, etc.\nTweet: TweetID, Content, TweetLocation, NumberOfLikes, TimeStamp, etc.\nUserFollow: UserID1, UserID2\nFavoriteTweets: UserID, TweetID, TimeStamp\nWhich database system should we use? Will NoSQL like Cassandra best fit our needs, or should we use a MySQL-like solution? What kind of block storage should we use to store photos and videos?\næˆ‘ä»¬åº”è¯¥ä½¿ç”¨å“ªç§æ•°æ®åº“ç³»ç»Ÿï¼Ÿåƒ Cassandra è¿™æ ·çš„ NoSQL æ˜¯å¦æœ€é€‚åˆæˆ‘ä»¬çš„éœ€æ±‚ï¼Œæˆ–è€…æˆ‘ä»¬åº”è¯¥ä½¿ç”¨ç±»ä¼¼ MySQL çš„è§£å†³æ–¹æ¡ˆï¼Ÿæˆ‘ä»¬åº”è¯¥ä½¿ç”¨ä»€ä¹ˆæ ·çš„å—å­˜å‚¨æ¥å­˜å‚¨ç…§ç‰‡å’Œè§†é¢‘ï¼Ÿ\nStep 5: High-level design æ­¥éª¤ 5ï¼šé«˜å±‚è®¾è®¡\nDraw a block diagram with 5-6 boxes representing the core components of our system. We should identify enough components that are needed to solve the actual problem from end-to-end.\nç»˜åˆ¶ä¸€ä¸ªæ¡†å›¾ï¼Œå…¶ä¸­ 5-6 ä¸ªæ–¹æ¡†ä»£è¡¨æˆ‘ä»¬ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ã€‚æˆ‘ä»¬åº”è¯¥ç¡®å®šç«¯åˆ°ç«¯è§£å†³å®é™…é—®é¢˜æ‰€éœ€çš„è¶³å¤Ÿç»„ä»¶ã€‚\nFor Twitter, at a high-level, we will need multiple application servers to serve all the read/write requests with load balancers in front of them for traffic distributions. If weâ€™re assuming that we will have a lot more read traffic (as compared to write), we can decide to have separate servers for handling these scenarios. On the backend, we need an efficient database that can store all the tweets and can support a huge number of reads. We will also need a distributed file storage system for storing photos and videos.\nå¯¹äº Twitterï¼Œåœ¨è¾ƒé«˜å±‚é¢ä¸Šï¼Œæˆ‘ä»¬éœ€è¦å¤šä¸ªåº”ç”¨ç¨‹åºæœåŠ¡å™¨æ¥æœåŠ¡æ‰€æœ‰è¯»/å†™è¯·æ±‚ï¼Œå¹¶åœ¨å®ƒä»¬å‰é¢æä¾›è´Ÿè½½å‡è¡¡å™¨ä»¥è¿›è¡Œæµé‡åˆ†é…ã€‚å¦‚æœæˆ‘ä»¬å‡è®¾æˆ‘ä»¬å°†æœ‰æ›´å¤šçš„è¯»å–æµé‡ï¼ˆä¸å†™å…¥ç›¸æ¯”ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å†³å®šä½¿ç”¨å•ç‹¬çš„æœåŠ¡å™¨æ¥å¤„ç†è¿™äº›åœºæ™¯ã€‚åœ¨åç«¯ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªé«˜æ•ˆçš„æ•°æ®åº“æ¥å­˜å‚¨æ‰€æœ‰çš„æ¨æ–‡ï¼Œå¹¶ä¸”å¯ä»¥æ”¯æŒæµ·é‡è¯»å–ã€‚æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªåˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨ç³»ç»Ÿæ¥å­˜å‚¨ç…§ç‰‡å’Œè§†é¢‘ã€‚\nStep 6: Detailed design æ­¥éª¤ 6ï¼šè¯¦ç»†è®¾è®¡\nDig deeper into two or three components; interviewerâ€™s feedback should always guide us what parts of the system need further discussion. We should be able to present different approaches, their pros and cons, and explain why we will prefer one approach on the other. Remember there is no single answer, the only important thing is to consider tradeoffs between different options while keeping system constraints in mind.\næ·±å…¥æŒ–æ˜ä¸¤ä¸ªæˆ–ä¸‰ä¸ªç»„ä»¶ï¼›é¢è¯•å®˜çš„åé¦ˆåº”è¯¥å§‹ç»ˆæŒ‡å¯¼æˆ‘ä»¬ç³»ç»Ÿçš„å“ªäº›éƒ¨åˆ†éœ€è¦è¿›ä¸€æ­¥è®¨è®ºã€‚æˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿå±•ç¤ºä¸åŒçš„æ–¹æ³•åŠå…¶ä¼˜ç¼ºç‚¹ï¼Œå¹¶è§£é‡Šä¸ºä»€ä¹ˆæˆ‘ä»¬æ›´å–œæ¬¢ä¸€ç§æ–¹æ³•è€Œä¸æ˜¯å¦ä¸€ç§æ–¹æ³•ã€‚è¯·è®°ä½ï¼Œæ²¡æœ‰å•ä¸€çš„ç­”æ¡ˆï¼Œå”¯ä¸€é‡è¦çš„æ˜¯è€ƒè™‘ä¸åŒé€‰é¡¹ä¹‹é—´çš„æƒè¡¡ï¼ŒåŒæ—¶ç‰¢è®°ç³»ç»Ÿçº¦æŸã€‚\nSince we will be storing a massive amount of data, how should we partition our data to distribute it to multiple databases? Should we try to store all the data of a user on the same database? What issue could it cause?\nç”±äºæˆ‘ä»¬å°†å­˜å‚¨å¤§é‡æ•°æ®ï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•å¯¹æ•°æ®è¿›è¡Œåˆ†åŒºä»¥å°†å…¶åˆ†å¸ƒåˆ°å¤šä¸ªæ•°æ®åº“ï¼Ÿæˆ‘ä»¬æ˜¯å¦åº”è¯¥å°è¯•å°†ç”¨æˆ·çš„æ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨åŒä¸€ä¸ªæ•°æ®åº“ä¸­ï¼Ÿå®ƒå¯èƒ½ä¼šå¯¼è‡´ä»€ä¹ˆé—®é¢˜ï¼Ÿ\nHow will we handle hot users who tweet a lot or follow lots of people?\næˆ‘ä»¬å°†å¦‚ä½•å¤„ç†ç»å¸¸å‘æ¨æ–‡æˆ–å…³æ³¨å¾ˆå¤šäººçš„çƒ­é—¨ç”¨æˆ·ï¼Ÿ\nSince usersâ€™ timeline will contain the most recent (and relevant) tweets, should we try to store our data in such a way that is optimized for scanning the latest tweets?\nç”±äºç”¨æˆ·çš„æ—¶é—´çº¿å°†åŒ…å«æœ€æ–°çš„ï¼ˆå’Œç›¸å…³çš„ï¼‰æ¨æ–‡ï¼Œæˆ‘ä»¬æ˜¯å¦åº”è¯¥å°è¯•å­˜å‚¨æˆ‘ä»¬çš„æ•°æ®æ˜¯å¦ä»¥é’ˆå¯¹æ‰«ææœ€æ–°æ¨æ–‡è¿›è¡Œä¼˜åŒ–çš„æ–¹å¼ï¼Ÿ\nHow much and at which layer should we introduce cache to speed things up?\næˆ‘ä»¬åº”è¯¥åœ¨å¤šå¤§ç¨‹åº¦ä¸Šä»¥åŠåœ¨å“ªä¸€å±‚å¼•å…¥ç¼“å­˜æ¥åŠ å¿«é€Ÿåº¦ï¼Ÿ\nWhat components need better load balancing?\nå“ªäº›ç»„ä»¶éœ€è¦æ›´å¥½çš„è´Ÿè½½å¹³è¡¡ï¼Ÿ\nStep 7: Identifying and resolving bottlenecks æ­¥éª¤ 7ï¼šè¯†åˆ«å¹¶è§£å†³ç“¶é¢ˆ\nTry to discuss as many bottlenecks as possible and different approaches to mitigate them.\nå°è¯•è®¨è®ºå°½å¯èƒ½å¤šçš„ç“¶é¢ˆä»¥åŠç¼“è§£ç“¶é¢ˆçš„ä¸åŒæ–¹æ³•ã€‚\nIs there any single point of failure in our system? What are we doing to mitigate it?\næˆ‘ä»¬çš„ç³»ç»Ÿä¸­æ˜¯å¦å­˜åœ¨å•ç‚¹æ•…éšœï¼Ÿæˆ‘ä»¬æ­£åœ¨é‡‡å–ä»€ä¹ˆæªæ–½æ¥ç¼“è§£è¿™ç§æƒ…å†µï¼Ÿ\nDo we have enough replicas of the data so that if we lose a few servers we can still serve our users?\næˆ‘ä»¬æ˜¯å¦æœ‰è¶³å¤Ÿçš„æ•°æ®å‰¯æœ¬ï¼Œä»¥ä¾¿åœ¨å¤±å»ä¸€äº›æœåŠ¡å™¨æ—¶æˆ‘ä»¬ä»ç„¶å¯ä»¥ä¸ºæˆ‘ä»¬çš„æœåŠ¡æä¾›æœåŠ¡ç”¨æˆ·ï¼Ÿ\nSimilarly, do we have enough copies of different services running such that a few failures will not cause total system shutdown?\nåŒæ ·ï¼Œæˆ‘ä»¬æ˜¯å¦æœ‰è¶³å¤Ÿçš„è¿è¡Œä¸åŒæœåŠ¡çš„å‰¯æœ¬ï¼Œä»¥ä¾¿å°‘æ•°æ•…éšœä¼šå‘ç”Ÿä¸ä¼šå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå…³é—­å—ï¼Ÿ\nHow are we monitoring the performance of our service? Do we get alerts whenever critical components fail or their performance degrades?\næˆ‘ä»¬å¦‚ä½•ç›‘æ§æˆ‘ä»¬çš„æœåŠ¡è¡¨ç°ï¼Ÿæˆ‘ä»¬æ˜¯å¦ä¼šåœ¨å…³é”®æ—¶åˆ»æ”¶åˆ°è­¦æŠ¥ç»„ä»¶å‡ºç°æ•…éšœæˆ–æ€§èƒ½ä¸‹é™ï¼Ÿ\nSummary æ¦‚æ‹¬\nIn short, preparation and being organized during the interview are the keys to be successful in system design interviews. The above-mentioned steps should guide you to remain on track and cover all the different aspects while designing a system.\nç®€è€Œè¨€ä¹‹ï¼Œé¢è¯•è¿‡ç¨‹ä¸­çš„å‡†å¤‡å’Œç»„ç»‡æ˜¯ç³»ç»Ÿè®¾è®¡é¢è¯•æˆåŠŸçš„å…³é”®ã€‚ä¸Šè¿°æ­¥éª¤åº”æŒ‡å¯¼æ‚¨åœ¨è®¾è®¡ç³»ç»Ÿæ—¶ä¿æŒæ­£è½¨å¹¶æ¶µç›–æ‰€æœ‰ä¸åŒæ–¹é¢ã€‚\nLetâ€™s apply the above guidelines to design a few systems that are asked in SDIs.\nè®©æˆ‘ä»¬åº”ç”¨ä¸Šè¿°æŒ‡å—æ¥è®¾è®¡ SDI ä¸­è¦æ±‚çš„ä¸€äº›ç³»ç»Ÿã€‚\nå‚è€ƒæ–‡ç« ï¼š\nhttps://www.designgurus.io/course-play/grokking-the-system-design-interview/doc/638c0b5aac93e7ae59a1af63 ","permalink":"https://blog.chensoul.cc/posts/2023/11/16/sdi-a-step-by-step-guide/","summary":"è¿™æ˜¯ä¸€ç¯‡åŒè¯­ç¿»è¯‘çš„æ–‡ç« ï¼ŒåŸæ–‡å‡ºè‡ª grok_system_design_interview.pdf çš„ä¸€ç¯‡æ–‡ç« ã€ŠSystem Design Interviews: A step by step guideã€‹ç³»ç»Ÿè®¾è®¡è®¿è°ˆï¼šåˆ†æ­¥æŒ‡å—ã€‚\nA lot of software engineers struggle with system design interviews (SDIs) primarily because of three reasons:\nè®¸å¤šè½¯ä»¶å·¥ç¨‹å¸ˆåœ¨ç³»ç»Ÿè®¾è®¡é¢è¯•ï¼ˆSDIï¼‰ä¸­é‡åˆ°å›°éš¾ï¼Œä¸»è¦æ˜¯å› ä¸ºä»¥ä¸‹ä¸‰ä¸ªåŸå› ï¼š\nThe unstructured nature of SDIs, where they are asked to work on an open-ended design problem that doesnâ€™t have a standard answer.\nSDI çš„éç»“æ„åŒ–æ€§è´¨ï¼Œè¦æ±‚ä»–ä»¬è§£å†³æ²¡æœ‰æ ‡å‡†ç­”æ¡ˆçš„å¼€æ”¾å¼è®¾è®¡é—®é¢˜ã€‚\nTheir lack of experience in developing large scale systems.\nä»–ä»¬ç¼ºä¹å¼€å‘å¤§å‹ç³»ç»Ÿçš„ç»éªŒã€‚\nThey did not prepare for SDIs.\nä»–ä»¬æ²¡æœ‰ä¸º SDI åšå¥½å‡†å¤‡ã€‚\nLike coding interviews, candidates who havenâ€™t put a conscious effort to prepare for SDIs, mostly perform poorly especially at top companies like Google, Facebook, Amazon, Microsoft, etc. In these companies, candidates who donâ€™t perform above average, have a limited chance to get an offer.","title":"[è¯‘]ã€ŠGrokking the System Design Interviewã€‹ç³»ç»Ÿè®¾è®¡è®¿è°ˆï¼šåˆ†æ­¥æŒ‡å—"},{"content":"ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼Ÿ åˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯æŒ‡ç”±å¤šä¸ªç‹¬ç«‹çš„è®¡ç®—æœºèŠ‚ç‚¹ï¼ˆæˆ–æœåŠ¡å™¨ï¼‰é€šè¿‡ç½‘ç»œç›¸äº’è¿æ¥å’Œåä½œï¼Œå…±åŒå®ŒæˆæŸä¸ªä»»åŠ¡æˆ–æä¾›æŸä¸ªæœåŠ¡çš„ç³»ç»Ÿã€‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå„ä¸ªèŠ‚ç‚¹å¯ä»¥åŒæ—¶è¿›è¡Œè®¡ç®—ã€å­˜å‚¨å’Œé€šä¿¡ï¼Œå¹¶é€šè¿‡æ¶ˆæ¯ä¼ é€’ç­‰æ–¹å¼è¿›è¡Œåè°ƒå’ŒåŒæ­¥ã€‚\nåˆ†å¸ƒå¼ç³»ç»Ÿçš„è®¾è®¡ç›®æ ‡æ˜¯æé«˜ç³»ç»Ÿçš„æ€§èƒ½ã€å¯é æ€§å’Œå¯æ‰©å±•æ€§ï¼ŒåŒæ—¶å‡å°‘å•ç‚¹æ•…éšœå’Œæé«˜ç³»ç»Ÿçš„å®¹é”™æ€§ã€‚é€šè¿‡å°†ä»»åŠ¡å’Œæ•°æ®åˆ†å¸ƒåˆ°å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿå¯ä»¥å®ç°æ›´é«˜çš„å¹¶è¡Œæ€§å’Œå¤„ç†èƒ½åŠ›ã€‚æ­¤å¤–ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿè¿˜å¯ä»¥æä¾›æ›´å¥½çš„è´Ÿè½½å‡è¡¡ï¼Œä»¥åº”å¯¹ä¸æ–­å¢é•¿çš„å·¥ä½œè´Ÿè½½ã€‚\nåˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸»è¦ç‰¹å¾ åˆ†å¸ƒå¼ç³»ç»Ÿå…·æœ‰ä»¥ä¸‹ä¸»è¦ç‰¹å¾ï¼š\nåˆ†å¸ƒæ€§ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„è®¡ç®—æœºèŠ‚ç‚¹åˆ†å¸ƒåœ¨ä¸åŒçš„ç‰©ç†æˆ–é€»è¾‘ä½ç½®ä¸Šï¼Œå¯ä»¥æ˜¯åŒä¸€å±€åŸŸç½‘å†…çš„å¤šå°æœºå™¨ï¼Œä¹Ÿå¯ä»¥æ˜¯åˆ†å¸ƒåœ¨å…¨çƒä¸åŒåœ°åŒºçš„æœåŠ¡å™¨ã€‚ å¹¶è¡Œæ€§ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹å¯ä»¥åŒæ—¶è¿›è¡Œè®¡ç®—å’Œå¤„ç†ä»»åŠ¡ï¼Œä»è€Œå®ç°å¹¶è¡Œå¤„ç†å’Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½ã€‚å¹¶è¡Œæ€§å¯ä»¥é€šè¿‡å°†ä»»åŠ¡åˆ’åˆ†ä¸ºå­ä»»åŠ¡ï¼Œå¹¶åœ¨ä¸åŒèŠ‚ç‚¹ä¸Šå¹¶è¡Œæ‰§è¡Œæ¥å®ç°ã€‚ é€šä¿¡ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿé€šè¿‡ç½‘ç»œè¿›è¡ŒèŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡å’Œæ•°æ®ä¼ è¾“ï¼Œä»¥å®ç°åä½œå’Œä¿¡æ¯äº¤æ¢ã€‚èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡å¯ä»¥é€šè¿‡æ¶ˆæ¯ä¼ é€’ã€è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰æˆ–åˆ†å¸ƒå¼å…±äº«å†…å­˜ç­‰æ–¹å¼å®ç°ã€‚ ç¼ºä¹å…¨å±€æ—¶é’Ÿï¼šç”±äºèŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡å»¶è¿Ÿå’Œä¸å¯é æ€§ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿå¾€å¾€æ— æ³•ä¾èµ–å…¨å±€æ—¶é’Ÿæ¥è¿›è¡ŒåŒæ­¥ã€‚å› æ­¤ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿéœ€è¦é‡‡ç”¨ä¸€äº›åˆ†å¸ƒå¼ç®—æ³•æ¥å®ç°ä¸€è‡´æ€§å’Œåè°ƒï¼Œå¦‚åˆ†å¸ƒå¼é”ã€ä¸€è‡´æ€§åè®®ç­‰ã€‚ å®¹é”™æ€§ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿéœ€è¦å…·å¤‡å®¹é”™æœºåˆ¶ï¼Œä»¥åº”å¯¹èŠ‚ç‚¹æ•…éšœã€ç½‘ç»œæ•…éšœæˆ–å…¶ä»–å¼‚å¸¸æƒ…å†µã€‚å®¹é”™æ€§çš„å®ç°é€šå¸¸åŒ…æ‹¬å¤‡ä»½å’Œå†—ä½™ï¼Œä¾‹å¦‚ä½¿ç”¨å†—ä½™èŠ‚ç‚¹ã€æ•°æ®å¤åˆ¶å’Œå‰¯æœ¬æœºåˆ¶ï¼Œä»¥ç¡®ä¿ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œæ•°æ®çš„å®Œæ•´æ€§ã€‚ å¯æ‰©å±•æ€§ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿåº”å…·å¤‡è‰¯å¥½çš„å¯æ‰©å±•æ€§ï¼Œå³èƒ½å¤Ÿæ–¹ä¾¿åœ°æ‰©å±•èŠ‚ç‚¹æ•°é‡å’Œå¤„ç†èƒ½åŠ›ï¼Œä»¥é€‚åº”ä¸æ–­å¢é•¿çš„å·¥ä½œè´Ÿè½½ã€‚å¯æ‰©å±•æ€§çš„å®ç°å¯èƒ½åŒ…æ‹¬æ°´å¹³æ‰©å±•ã€å‚ç›´æ‰©å±•ã€è´Ÿè½½å‡è¡¡ç­‰æŠ€æœ¯æ‰‹æ®µã€‚ ä¸ç¡®å®šæ€§ï¼šç”±äºèŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡å»¶è¿Ÿå’Œä¸å¯é æ€§ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ“ä½œå¯èƒ½å­˜åœ¨ä¸ç¡®å®šæ€§ã€‚ä¾‹å¦‚ï¼Œæ¶ˆæ¯ä¼ é€’å¯èƒ½ä¼šæœ‰å»¶è¿Ÿï¼Œç½‘ç»œå¯èƒ½ä¼šå‘ç”Ÿåˆ†åŒºï¼Œå¯¼è‡´èŠ‚ç‚¹ä¹‹é—´çš„ä¿¡æ¯ä¸ä¸€è‡´ã€‚å› æ­¤ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿéœ€è¦è€ƒè™‘å’Œå¤„ç†è¿™ç§ä¸ç¡®å®šæ€§æƒ…å†µã€‚ è¿™äº›ç‰¹å¾ä½¿å¾—åˆ†å¸ƒå¼ç³»ç»Ÿèƒ½å¤Ÿå®ç°é«˜æ€§èƒ½ã€é«˜å¯ç”¨æ€§å’Œå¯æ‰©å±•æ€§ï¼Œä½†ä¹Ÿå¸¦æ¥äº†æŒ‘æˆ˜ï¼Œå¦‚ä¸€è‡´æ€§é—®é¢˜ã€å¹¶å‘æ§åˆ¶ã€æ•…éšœå¤„ç†ç­‰ã€‚å› æ­¤ï¼Œåœ¨è®¾è®¡å’Œå¼€å‘åˆ†å¸ƒå¼ç³»ç»Ÿæ—¶ï¼Œéœ€è¦è€ƒè™‘è¿™äº›ç‰¹å¾ï¼Œå¹¶é€‰æ‹©åˆé€‚çš„æŠ€æœ¯å’Œç®—æ³•æ¥è§£å†³ç›¸å…³é—®é¢˜ã€‚\nåˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é—®é¢˜ åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é—®é¢˜åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\nä¸€è‡´æ€§é—®é¢˜ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ•°æ®çš„å¤åˆ¶å’ŒåŒæ­¥æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚èŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®å¤åˆ¶å¯èƒ½å­˜åœ¨å»¶è¿Ÿå’Œä¸ä¸€è‡´æ€§ï¼Œéœ€è¦é‡‡ç”¨åˆé€‚çš„å¤åˆ¶ç­–ç•¥å’ŒåŒæ­¥æœºåˆ¶ï¼Œå¦‚ä¸»ä»å¤åˆ¶ã€å¤šä¸»å¤åˆ¶ã€ä¸€è‡´æ€§å“ˆå¸Œç­‰ã€‚ å¹¶å‘æ§åˆ¶ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¤šä¸ªèŠ‚ç‚¹åŒæ—¶å¯¹å…±äº«èµ„æºè¿›è¡Œè¯»å†™æ“ä½œå¯èƒ½å¯¼è‡´å¹¶å‘å†²çªå’Œæ•°æ®ä¸ä¸€è‡´ã€‚å¹¶å‘æ§åˆ¶æœºåˆ¶ï¼Œå¦‚åˆ†å¸ƒå¼é”ã€ç‰ˆæœ¬æ§åˆ¶ã€ä¹è§‚å¹¶å‘æ§åˆ¶ç­‰ï¼Œç”¨äºç¡®ä¿å¯¹å…±äº«èµ„æºçš„è®¿é—®æ˜¯å®‰å…¨å’Œæœ‰åºçš„ã€‚ æ•…éšœå¤„ç†å’Œå®¹é”™æ€§ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹å¯èƒ½ä¼šå‘ç”Ÿæ•…éšœï¼Œå¦‚èŠ‚ç‚¹å´©æºƒã€ç½‘ç»œåˆ†åŒºç­‰ï¼Œè¿™å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±æˆ–ç³»ç»Ÿä¸å¯ç”¨ã€‚ä¸ºäº†ä¿è¯ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œæ•°æ®çš„å®Œæ•´æ€§ï¼Œéœ€è¦é‡‡ç”¨æ•…éšœæ£€æµ‹å’Œæ¢å¤æœºåˆ¶ï¼Œå¦‚å¿ƒè·³æ£€æµ‹ã€æ•…éšœè½¬ç§»ã€æ•°æ®å¤‡ä»½ç­‰ã€‚ åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ï¼šéšç€ç”¨æˆ·å’Œæ•°æ®é‡çš„å¢é•¿ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿéœ€è¦èƒ½å¤Ÿæ–¹ä¾¿åœ°æ‰©å±•èŠ‚ç‚¹æ•°é‡å’Œå¤„ç†èƒ½åŠ›ã€‚è®¾è®¡å’Œå®ç°å…·æœ‰è‰¯å¥½å¯æ‰©å±•æ€§çš„åˆ†å¸ƒå¼ç³»ç»Ÿéœ€è¦è€ƒè™‘è´Ÿè½½å‡è¡¡ã€æ•°æ®åˆ†ç‰‡ã€åˆ†å¸ƒå¼ç¼“å­˜ç­‰æŠ€æœ¯æ‰‹æ®µã€‚ ç›‘æ§å’Œç®¡ç†ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç”±äºèŠ‚ç‚¹æ•°é‡ä¼—å¤šï¼Œç›‘æ§å’Œç®¡ç†å˜å¾—æ›´åŠ å¤æ‚ã€‚éœ€è¦å»ºç«‹æœ‰æ•ˆçš„ç›‘æ§ç³»ç»Ÿæ¥æ”¶é›†å’Œåˆ†æç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡ï¼Œå¹¶é‡‡ç”¨è‡ªåŠ¨åŒ–çš„ç®¡ç†å·¥å…·æ¥ç®¡ç†èŠ‚ç‚¹ã€é…ç½®å’Œéƒ¨ç½²ç³»ç»Ÿã€‚ è¡¡é‡åˆ†å¸ƒå¼ç³»ç»Ÿçš„æŒ‡æ ‡ è¡¡é‡åˆ†å¸ƒå¼ç³»ç»Ÿæ€§èƒ½å’Œè´¨é‡çš„æŒ‡æ ‡å¯ä»¥åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\nå¯ç”¨æ€§ï¼šæŒ‡ç³»ç»Ÿå¤„äºæ­£å¸¸è¿è¡ŒçŠ¶æ€çš„æ—¶é—´æ¯”ä¾‹ã€‚å¦‚æœç”¨æˆ·æ— æ³•è®¿é—®ç³»ç»Ÿï¼Œåˆ™ç§°ç³»ç»Ÿä¸å¯ç”¨ã€‚é€šå¸¸ä»¥ç™¾åˆ†æ¯”ï¼ˆå¦‚99.9%ï¼‰è¡¨ç¤ºã€‚è¾ƒé«˜çš„å¯ç”¨æ€§æ„å‘³ç€ç³»ç»Ÿæ›´å¯é ï¼Œç”¨æˆ·èƒ½å¤Ÿæ›´ç¨³å®šåœ°è®¿é—®å’Œä½¿ç”¨ç³»ç»Ÿã€‚\nä»æŠ€æœ¯è§’åº¦æ¥çœ‹ï¼Œå¯ç”¨æ€§ä¸»è¦ä¸å®¹é”™æ€§æœ‰å…³ã€‚å› ä¸ºæ•…éšœå‘ç”Ÿçš„æ¦‚ç‡éšç€ç»„ä»¶æ•°é‡çš„å¢åŠ è€Œå¢åŠ ï¼Œç³»ç»Ÿåº”è¯¥èƒ½å¤Ÿè¿›è¡Œè¡¥å¿ï¼Œä»¥ç¡®ä¿éšç€ç»„ä»¶æ•°é‡çš„å¢åŠ ï¼Œç³»ç»Ÿçš„å¯é æ€§ä¸ä¼šé™ä½ã€‚\nå®¹é”™æ€§æ˜¯æŒ‡ç³»ç»Ÿåœ¨å‘ç”Ÿæ•…éšœæ—¶ä»èƒ½ä»¥æ˜ç¡®å®šä¹‰çš„æ–¹å¼ç»§ç»­è¿è¡Œçš„èƒ½åŠ›ã€‚\n**å¯æ‰©å±•æ€§ï¼šè¡¡é‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é¢å¯¹ä¸æ–­å¢é•¿çš„å·¥ä½œè´Ÿè½½æ—¶ï¼Œèƒ½å¤Ÿæ–¹ä¾¿åœ°æ‰©å±•èŠ‚ç‚¹æ•°é‡å’Œå¤„ç†èƒ½åŠ›çš„èƒ½åŠ›ã€‚**å¯æ‰©å±•æ€§å¯ä»¥åŒ…æ‹¬æ°´å¹³æ‰©å±•ï¼ˆå¢åŠ èŠ‚ç‚¹æ•°é‡ï¼‰å’Œå‚ç›´æ‰©å±•ï¼ˆå¢åŠ èŠ‚ç‚¹çš„å¤„ç†èƒ½åŠ›ï¼‰ã€‚\n**ä¸€è‡´æ€§ï¼šè¡¨ç¤ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ•°æ®å‰¯æœ¬åœ¨ä¸åŒèŠ‚ç‚¹ä¹‹é—´ä¿æŒä¸€è‡´çš„ç¨‹åº¦ã€‚**è¾ƒé«˜çš„ä¸€è‡´æ€§æ„å‘³ç€ç³»ç»Ÿä¸­çš„æ•°æ®åœ¨ä¸åŒèŠ‚ç‚¹ä¸Šçš„è®¿é—®ç»“æœæ˜¯ç›¸åŒçš„ï¼Œè€Œè¾ƒä½çš„ä¸€è‡´æ€§å¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚\n**å¯é æ€§ï¼šè¡¨ç¤ºåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é¢å¯¹èŠ‚ç‚¹æ•…éšœã€ç½‘ç»œæ•…éšœæˆ–å…¶ä»–å¼‚å¸¸æƒ…å†µæ—¶èƒ½å¤Ÿç»§ç»­æ­£å¸¸è¿è¡Œçš„èƒ½åŠ›ã€‚**å¯é æ€§é€šå¸¸ä¸å®¹é”™æ€§ç›¸å…³ï¼ŒåŒ…æ‹¬æ•…éšœæ£€æµ‹ã€æ•…éšœè½¬ç§»ã€æ•°æ®å¤‡ä»½ç­‰æœºåˆ¶ã€‚\næ€§èƒ½ï¼šæ˜¯æŒ‡è®¡ç®—æœºç³»ç»Ÿåœ¨ä½¿ç”¨çš„æ—¶é—´å’Œèµ„æºç›¸å¯¹äºæ‰€å®Œæˆçš„æœ‰ç”¨å·¥ä½œé‡æ¥è¡¡é‡çš„ç‰¹å¾ã€‚\nååé‡ï¼šè¡¨ç¤ºåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å•ä½æ—¶é—´å†…èƒ½å¤Ÿå¤„ç†çš„è¯·æ±‚æˆ–äº‹åŠ¡æ•°é‡ã€‚ååé‡è¶Šé«˜ï¼Œç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›è¶Šå¼ºï¼Œèƒ½å¤Ÿæ›´é«˜æ•ˆåœ°å¤„ç†ç”¨æˆ·è¯·æ±‚å’Œæ•°æ®å¤„ç†ä»»åŠ¡ã€‚ å“åº”æ—¶é—´ï¼šè¡¨ç¤ºåˆ†å¸ƒå¼ç³»ç»Ÿå¯¹äºç”¨æˆ·è¯·æ±‚çš„å“åº”é€Ÿåº¦ã€‚è¾ƒä½çš„å“åº”æ—¶é—´æ„å‘³ç€ç³»ç»Ÿèƒ½å¤Ÿæ›´å¿«åœ°å“åº”ç”¨æˆ·è¯·æ±‚ï¼Œæä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚ å¹¶å‘æ€§èƒ½ï¼šè¡¡é‡ç³»ç»Ÿåœ¨å¤„ç†å¹¶å‘è¯·æ±‚æ—¶çš„èƒ½åŠ›ã€‚è¾ƒå¥½çš„å¹¶å‘æ€§èƒ½æ„å‘³ç€ç³»ç»Ÿèƒ½å¤ŸåŒæ—¶å¤„ç†å¤šä¸ªè¯·æ±‚ï¼Œå¹¶ä¿æŒè¾ƒä½çš„å“åº”æ—¶é—´å’Œé«˜ååé‡ã€‚ æ€»ç»“ ä»»ä½•è®¡ç®—æœºç³»ç»Ÿéƒ½éœ€è¦å®Œæˆä¸¤ä¸ªåŸºæœ¬ä»»åŠ¡ï¼š\nå­˜å‚¨ è®¡ç®— éšç€ä»»åŠ¡è§„æ¨¡å˜å¤§ï¼š\n1ã€ä½¿ç”¨å•å°è®¡ç®—æœºï¼Œç¡¬ä»¶å‡çº§ï¼Œæˆæœ¬è¿‡é«˜ 2ã€ä½¿ç”¨å¤šå°è®¡ç®—æœºï¼Œä½¿ç”¨ä¸­æ¡£ã€å¤§ä¼—åŒ–çš„ç¡¬ä»¶ï¼Œæˆæœ¬é™ä½ ä½¿ç”¨å¤šå°è®¡ç®—æœºå­˜åœ¨å¦‚ä¸‹ç‰¹å¾ï¼š\nåˆ†å¸ƒæ€§ã€‚è®¡ç®—æœºèŠ‚ç‚¹åˆ†å¸ƒåœ¨ä¸åŒçš„ä½ç½®ã€‚ å¹¶è¡Œæ€§ã€‚è®¡ç®—æœºèŠ‚ç‚¹å¯ä»¥åŒæ—¶è¿›è¡Œè®¡ç®—å’Œå¤„ç†ä»»åŠ¡ã€‚ å¯æ‰©å±•æ€§ï¼šå¯ä»¥æ·»åŠ èŠ‚ç‚¹ï¼Œæé«˜å¤„ç†èƒ½åŠ›ã€‚ ä¸ç¡®å®šæ€§ã€‚ç”±äºèŠ‚ç‚¹ä¹‹é—´é€šä¿¡æœ‰å»¶è¿Ÿæˆ–è€…å­˜åœ¨æ•…éšœï¼Œä¼šå¯¼è‡´æ¶ˆæ¯ä¼ é€’æœ‰å»¶è¿Ÿã€èŠ‚ç‚¹ä¿¡æ¯å­˜åœ¨ä¸ä¸€è‡´ ä½¿ç”¨å¤šå°è®¡ç®—æœºé¢ä¸´çš„é—®é¢˜ï¼š\nèŠ‚ç‚¹çš„æ•°é‡ã€‚\næ•°é‡å˜å¤šï¼Œå¢åŠ ç³»ç»Ÿæ•…éšœæ¦‚ç‡ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±æˆ–ç³»ç»Ÿä¸å¯ç”¨ã€‚ æ•°é‡å˜å¤šï¼Œå¹¶è¡Œè¯»å†™æ•°æ®ï¼Œä¼šå¯¼è‡´å¹¶å‘å†²çªå’Œæ•°æ®ä¸ä¸€è‡´ã€‚ èŠ‚ç‚¹ä¹‹é—´çš„è·ç¦»ã€‚\næ¯ä¸ªèŠ‚ç‚¹çš„æ—¶é’Ÿä¸åŒæ­¥ï¼Œä¼šå¯¼è‡´ç½‘ç»œå»¶è¿Ÿ èŠ‚ç‚¹ä¹‹é—´æ•°æ®éœ€è¦å¤åˆ¶å’ŒåŒæ­¥ï¼Œä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´æ€§ã€‚ èŠ‚ç‚¹ä¹‹é—´è·ç¦»å˜è¿œï¼Œä¼šé™ä½æŸäº›æ“ä½œçš„æ€§èƒ½ã€‚ æ‰€ä»¥ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿè¦æä¾›ä»¥ä¸‹èƒ½åŠ›ï¼š\nå¯ç”¨æ€§ã€‚ å¯æ‰©å±•æ€§ã€‚å¯ä»¥å¢åŠ èŠ‚ç‚¹æ•°é‡å’Œæé«˜èŠ‚ç‚¹å¤„ç†èƒ½åŠ›ã€‚ ä¸€è‡´æ€§ã€‚æé«˜æ•°æ®ä¸€è‡´æ€§ã€‚ å¯é æ€§ã€‚ç³»ç»Ÿæ•…éšœæ—¶ï¼Œä»ç„¶èƒ½æ­£å¸¸è¿è¡Œã€‚ æ€§èƒ½ã€‚ ","permalink":"https://blog.chensoul.cc/posts/2023/11/14/distributed-system-basic/","summary":"ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼Ÿ åˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯æŒ‡ç”±å¤šä¸ªç‹¬ç«‹çš„è®¡ç®—æœºèŠ‚ç‚¹ï¼ˆæˆ–æœåŠ¡å™¨ï¼‰é€šè¿‡ç½‘ç»œç›¸äº’è¿æ¥å’Œåä½œï¼Œå…±åŒå®ŒæˆæŸä¸ªä»»åŠ¡æˆ–æä¾›æŸä¸ªæœåŠ¡çš„ç³»ç»Ÿã€‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå„ä¸ªèŠ‚ç‚¹å¯ä»¥åŒæ—¶è¿›è¡Œè®¡ç®—ã€å­˜å‚¨å’Œé€šä¿¡ï¼Œå¹¶é€šè¿‡æ¶ˆæ¯ä¼ é€’ç­‰æ–¹å¼è¿›è¡Œåè°ƒå’ŒåŒæ­¥ã€‚\nåˆ†å¸ƒå¼ç³»ç»Ÿçš„è®¾è®¡ç›®æ ‡æ˜¯æé«˜ç³»ç»Ÿçš„æ€§èƒ½ã€å¯é æ€§å’Œå¯æ‰©å±•æ€§ï¼ŒåŒæ—¶å‡å°‘å•ç‚¹æ•…éšœå’Œæé«˜ç³»ç»Ÿçš„å®¹é”™æ€§ã€‚é€šè¿‡å°†ä»»åŠ¡å’Œæ•°æ®åˆ†å¸ƒåˆ°å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿå¯ä»¥å®ç°æ›´é«˜çš„å¹¶è¡Œæ€§å’Œå¤„ç†èƒ½åŠ›ã€‚æ­¤å¤–ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿè¿˜å¯ä»¥æä¾›æ›´å¥½çš„è´Ÿè½½å‡è¡¡ï¼Œä»¥åº”å¯¹ä¸æ–­å¢é•¿çš„å·¥ä½œè´Ÿè½½ã€‚\nåˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸»è¦ç‰¹å¾ åˆ†å¸ƒå¼ç³»ç»Ÿå…·æœ‰ä»¥ä¸‹ä¸»è¦ç‰¹å¾ï¼š\nåˆ†å¸ƒæ€§ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„è®¡ç®—æœºèŠ‚ç‚¹åˆ†å¸ƒåœ¨ä¸åŒçš„ç‰©ç†æˆ–é€»è¾‘ä½ç½®ä¸Šï¼Œå¯ä»¥æ˜¯åŒä¸€å±€åŸŸç½‘å†…çš„å¤šå°æœºå™¨ï¼Œä¹Ÿå¯ä»¥æ˜¯åˆ†å¸ƒåœ¨å…¨çƒä¸åŒåœ°åŒºçš„æœåŠ¡å™¨ã€‚ å¹¶è¡Œæ€§ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹å¯ä»¥åŒæ—¶è¿›è¡Œè®¡ç®—å’Œå¤„ç†ä»»åŠ¡ï¼Œä»è€Œå®ç°å¹¶è¡Œå¤„ç†å’Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½ã€‚å¹¶è¡Œæ€§å¯ä»¥é€šè¿‡å°†ä»»åŠ¡åˆ’åˆ†ä¸ºå­ä»»åŠ¡ï¼Œå¹¶åœ¨ä¸åŒèŠ‚ç‚¹ä¸Šå¹¶è¡Œæ‰§è¡Œæ¥å®ç°ã€‚ é€šä¿¡ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿé€šè¿‡ç½‘ç»œè¿›è¡ŒèŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡å’Œæ•°æ®ä¼ è¾“ï¼Œä»¥å®ç°åä½œå’Œä¿¡æ¯äº¤æ¢ã€‚èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡å¯ä»¥é€šè¿‡æ¶ˆæ¯ä¼ é€’ã€è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰æˆ–åˆ†å¸ƒå¼å…±äº«å†…å­˜ç­‰æ–¹å¼å®ç°ã€‚ ç¼ºä¹å…¨å±€æ—¶é’Ÿï¼šç”±äºèŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡å»¶è¿Ÿå’Œä¸å¯é æ€§ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿå¾€å¾€æ— æ³•ä¾èµ–å…¨å±€æ—¶é’Ÿæ¥è¿›è¡ŒåŒæ­¥ã€‚å› æ­¤ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿéœ€è¦é‡‡ç”¨ä¸€äº›åˆ†å¸ƒå¼ç®—æ³•æ¥å®ç°ä¸€è‡´æ€§å’Œåè°ƒï¼Œå¦‚åˆ†å¸ƒå¼é”ã€ä¸€è‡´æ€§åè®®ç­‰ã€‚ å®¹é”™æ€§ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿéœ€è¦å…·å¤‡å®¹é”™æœºåˆ¶ï¼Œä»¥åº”å¯¹èŠ‚ç‚¹æ•…éšœã€ç½‘ç»œæ•…éšœæˆ–å…¶ä»–å¼‚å¸¸æƒ…å†µã€‚å®¹é”™æ€§çš„å®ç°é€šå¸¸åŒ…æ‹¬å¤‡ä»½å’Œå†—ä½™ï¼Œä¾‹å¦‚ä½¿ç”¨å†—ä½™èŠ‚ç‚¹ã€æ•°æ®å¤åˆ¶å’Œå‰¯æœ¬æœºåˆ¶ï¼Œä»¥ç¡®ä¿ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œæ•°æ®çš„å®Œæ•´æ€§ã€‚ å¯æ‰©å±•æ€§ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿåº”å…·å¤‡è‰¯å¥½çš„å¯æ‰©å±•æ€§ï¼Œå³èƒ½å¤Ÿæ–¹ä¾¿åœ°æ‰©å±•èŠ‚ç‚¹æ•°é‡å’Œå¤„ç†èƒ½åŠ›ï¼Œä»¥é€‚åº”ä¸æ–­å¢é•¿çš„å·¥ä½œè´Ÿè½½ã€‚å¯æ‰©å±•æ€§çš„å®ç°å¯èƒ½åŒ…æ‹¬æ°´å¹³æ‰©å±•ã€å‚ç›´æ‰©å±•ã€è´Ÿè½½å‡è¡¡ç­‰æŠ€æœ¯æ‰‹æ®µã€‚ ä¸ç¡®å®šæ€§ï¼šç”±äºèŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡å»¶è¿Ÿå’Œä¸å¯é æ€§ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ“ä½œå¯èƒ½å­˜åœ¨ä¸ç¡®å®šæ€§ã€‚ä¾‹å¦‚ï¼Œæ¶ˆæ¯ä¼ é€’å¯èƒ½ä¼šæœ‰å»¶è¿Ÿï¼Œç½‘ç»œå¯èƒ½ä¼šå‘ç”Ÿåˆ†åŒºï¼Œå¯¼è‡´èŠ‚ç‚¹ä¹‹é—´çš„ä¿¡æ¯ä¸ä¸€è‡´ã€‚å› æ­¤ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿéœ€è¦è€ƒè™‘å’Œå¤„ç†è¿™ç§ä¸ç¡®å®šæ€§æƒ…å†µã€‚ è¿™äº›ç‰¹å¾ä½¿å¾—åˆ†å¸ƒå¼ç³»ç»Ÿèƒ½å¤Ÿå®ç°é«˜æ€§èƒ½ã€é«˜å¯ç”¨æ€§å’Œå¯æ‰©å±•æ€§ï¼Œä½†ä¹Ÿå¸¦æ¥äº†æŒ‘æˆ˜ï¼Œå¦‚ä¸€è‡´æ€§é—®é¢˜ã€å¹¶å‘æ§åˆ¶ã€æ•…éšœå¤„ç†ç­‰ã€‚å› æ­¤ï¼Œåœ¨è®¾è®¡å’Œå¼€å‘åˆ†å¸ƒå¼ç³»ç»Ÿæ—¶ï¼Œéœ€è¦è€ƒè™‘è¿™äº›ç‰¹å¾ï¼Œå¹¶é€‰æ‹©åˆé€‚çš„æŠ€æœ¯å’Œç®—æ³•æ¥è§£å†³ç›¸å…³é—®é¢˜ã€‚\nåˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é—®é¢˜ åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é—®é¢˜åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\nä¸€è‡´æ€§é—®é¢˜ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ•°æ®çš„å¤åˆ¶å’ŒåŒæ­¥æ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚èŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®å¤åˆ¶å¯èƒ½å­˜åœ¨å»¶è¿Ÿå’Œä¸ä¸€è‡´æ€§ï¼Œéœ€è¦é‡‡ç”¨åˆé€‚çš„å¤åˆ¶ç­–ç•¥å’ŒåŒæ­¥æœºåˆ¶ï¼Œå¦‚ä¸»ä»å¤åˆ¶ã€å¤šä¸»å¤åˆ¶ã€ä¸€è‡´æ€§å“ˆå¸Œç­‰ã€‚ å¹¶å‘æ§åˆ¶ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¤šä¸ªèŠ‚ç‚¹åŒæ—¶å¯¹å…±äº«èµ„æºè¿›è¡Œè¯»å†™æ“ä½œå¯èƒ½å¯¼è‡´å¹¶å‘å†²çªå’Œæ•°æ®ä¸ä¸€è‡´ã€‚å¹¶å‘æ§åˆ¶æœºåˆ¶ï¼Œå¦‚åˆ†å¸ƒå¼é”ã€ç‰ˆæœ¬æ§åˆ¶ã€ä¹è§‚å¹¶å‘æ§åˆ¶ç­‰ï¼Œç”¨äºç¡®ä¿å¯¹å…±äº«èµ„æºçš„è®¿é—®æ˜¯å®‰å…¨å’Œæœ‰åºçš„ã€‚ æ•…éšœå¤„ç†å’Œå®¹é”™æ€§ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹å¯èƒ½ä¼šå‘ç”Ÿæ•…éšœï¼Œå¦‚èŠ‚ç‚¹å´©æºƒã€ç½‘ç»œåˆ†åŒºç­‰ï¼Œè¿™å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±æˆ–ç³»ç»Ÿä¸å¯ç”¨ã€‚ä¸ºäº†ä¿è¯ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œæ•°æ®çš„å®Œæ•´æ€§ï¼Œéœ€è¦é‡‡ç”¨æ•…éšœæ£€æµ‹å’Œæ¢å¤æœºåˆ¶ï¼Œå¦‚å¿ƒè·³æ£€æµ‹ã€æ•…éšœè½¬ç§»ã€æ•°æ®å¤‡ä»½ç­‰ã€‚ åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ï¼šéšç€ç”¨æˆ·å’Œæ•°æ®é‡çš„å¢é•¿ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿéœ€è¦èƒ½å¤Ÿæ–¹ä¾¿åœ°æ‰©å±•èŠ‚ç‚¹æ•°é‡å’Œå¤„ç†èƒ½åŠ›ã€‚è®¾è®¡å’Œå®ç°å…·æœ‰è‰¯å¥½å¯æ‰©å±•æ€§çš„åˆ†å¸ƒå¼ç³»ç»Ÿéœ€è¦è€ƒè™‘è´Ÿè½½å‡è¡¡ã€æ•°æ®åˆ†ç‰‡ã€åˆ†å¸ƒå¼ç¼“å­˜ç­‰æŠ€æœ¯æ‰‹æ®µã€‚ ç›‘æ§å’Œç®¡ç†ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç”±äºèŠ‚ç‚¹æ•°é‡ä¼—å¤šï¼Œç›‘æ§å’Œç®¡ç†å˜å¾—æ›´åŠ å¤æ‚ã€‚éœ€è¦å»ºç«‹æœ‰æ•ˆçš„ç›‘æ§ç³»ç»Ÿæ¥æ”¶é›†å’Œåˆ†æç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡ï¼Œå¹¶é‡‡ç”¨è‡ªåŠ¨åŒ–çš„ç®¡ç†å·¥å…·æ¥ç®¡ç†èŠ‚ç‚¹ã€é…ç½®å’Œéƒ¨ç½²ç³»ç»Ÿã€‚ è¡¡é‡åˆ†å¸ƒå¼ç³»ç»Ÿçš„æŒ‡æ ‡ è¡¡é‡åˆ†å¸ƒå¼ç³»ç»Ÿæ€§èƒ½å’Œè´¨é‡çš„æŒ‡æ ‡å¯ä»¥åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\nå¯ç”¨æ€§ï¼šæŒ‡ç³»ç»Ÿå¤„äºæ­£å¸¸è¿è¡ŒçŠ¶æ€çš„æ—¶é—´æ¯”ä¾‹ã€‚å¦‚æœç”¨æˆ·æ— æ³•è®¿é—®ç³»ç»Ÿï¼Œåˆ™ç§°ç³»ç»Ÿä¸å¯ç”¨ã€‚é€šå¸¸ä»¥ç™¾åˆ†æ¯”ï¼ˆå¦‚99.9%ï¼‰è¡¨ç¤ºã€‚è¾ƒé«˜çš„å¯ç”¨æ€§æ„å‘³ç€ç³»ç»Ÿæ›´å¯é ï¼Œç”¨æˆ·èƒ½å¤Ÿæ›´ç¨³å®šåœ°è®¿é—®å’Œä½¿ç”¨ç³»ç»Ÿã€‚\nä»æŠ€æœ¯è§’åº¦æ¥çœ‹ï¼Œå¯ç”¨æ€§ä¸»è¦ä¸å®¹é”™æ€§æœ‰å…³ã€‚å› ä¸ºæ•…éšœå‘ç”Ÿçš„æ¦‚ç‡éšç€ç»„ä»¶æ•°é‡çš„å¢åŠ è€Œå¢åŠ ï¼Œç³»ç»Ÿåº”è¯¥èƒ½å¤Ÿè¿›è¡Œè¡¥å¿ï¼Œä»¥ç¡®ä¿éšç€ç»„ä»¶æ•°é‡çš„å¢åŠ ï¼Œç³»ç»Ÿçš„å¯é æ€§ä¸ä¼šé™ä½ã€‚\nå®¹é”™æ€§æ˜¯æŒ‡ç³»ç»Ÿåœ¨å‘ç”Ÿæ•…éšœæ—¶ä»èƒ½ä»¥æ˜ç¡®å®šä¹‰çš„æ–¹å¼ç»§ç»­è¿è¡Œçš„èƒ½åŠ›ã€‚\n**å¯æ‰©å±•æ€§ï¼šè¡¡é‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é¢å¯¹ä¸æ–­å¢é•¿çš„å·¥ä½œè´Ÿè½½æ—¶ï¼Œèƒ½å¤Ÿæ–¹ä¾¿åœ°æ‰©å±•èŠ‚ç‚¹æ•°é‡å’Œå¤„ç†èƒ½åŠ›çš„èƒ½åŠ›ã€‚**å¯æ‰©å±•æ€§å¯ä»¥åŒ…æ‹¬æ°´å¹³æ‰©å±•ï¼ˆå¢åŠ èŠ‚ç‚¹æ•°é‡ï¼‰å’Œå‚ç›´æ‰©å±•ï¼ˆå¢åŠ èŠ‚ç‚¹çš„å¤„ç†èƒ½åŠ›ï¼‰ã€‚\n**ä¸€è‡´æ€§ï¼šè¡¨ç¤ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ•°æ®å‰¯æœ¬åœ¨ä¸åŒèŠ‚ç‚¹ä¹‹é—´ä¿æŒä¸€è‡´çš„ç¨‹åº¦ã€‚**è¾ƒé«˜çš„ä¸€è‡´æ€§æ„å‘³ç€ç³»ç»Ÿä¸­çš„æ•°æ®åœ¨ä¸åŒèŠ‚ç‚¹ä¸Šçš„è®¿é—®ç»“æœæ˜¯ç›¸åŒçš„ï¼Œè€Œè¾ƒä½çš„ä¸€è‡´æ€§å¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚\n**å¯é æ€§ï¼šè¡¨ç¤ºåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é¢å¯¹èŠ‚ç‚¹æ•…éšœã€ç½‘ç»œæ•…éšœæˆ–å…¶ä»–å¼‚å¸¸æƒ…å†µæ—¶èƒ½å¤Ÿç»§ç»­æ­£å¸¸è¿è¡Œçš„èƒ½åŠ›ã€‚**å¯é æ€§é€šå¸¸ä¸å®¹é”™æ€§ç›¸å…³ï¼ŒåŒ…æ‹¬æ•…éšœæ£€æµ‹ã€æ•…éšœè½¬ç§»ã€æ•°æ®å¤‡ä»½ç­‰æœºåˆ¶ã€‚\næ€§èƒ½ï¼šæ˜¯æŒ‡è®¡ç®—æœºç³»ç»Ÿåœ¨ä½¿ç”¨çš„æ—¶é—´å’Œèµ„æºç›¸å¯¹äºæ‰€å®Œæˆçš„æœ‰ç”¨å·¥ä½œé‡æ¥è¡¡é‡çš„ç‰¹å¾ã€‚\nååé‡ï¼šè¡¨ç¤ºåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å•ä½æ—¶é—´å†…èƒ½å¤Ÿå¤„ç†çš„è¯·æ±‚æˆ–äº‹åŠ¡æ•°é‡ã€‚ååé‡è¶Šé«˜ï¼Œç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›è¶Šå¼ºï¼Œèƒ½å¤Ÿæ›´é«˜æ•ˆåœ°å¤„ç†ç”¨æˆ·è¯·æ±‚å’Œæ•°æ®å¤„ç†ä»»åŠ¡ã€‚ å“åº”æ—¶é—´ï¼šè¡¨ç¤ºåˆ†å¸ƒå¼ç³»ç»Ÿå¯¹äºç”¨æˆ·è¯·æ±‚çš„å“åº”é€Ÿåº¦ã€‚è¾ƒä½çš„å“åº”æ—¶é—´æ„å‘³ç€ç³»ç»Ÿèƒ½å¤Ÿæ›´å¿«åœ°å“åº”ç”¨æˆ·è¯·æ±‚ï¼Œæä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚ å¹¶å‘æ€§èƒ½ï¼šè¡¡é‡ç³»ç»Ÿåœ¨å¤„ç†å¹¶å‘è¯·æ±‚æ—¶çš„èƒ½åŠ›ã€‚è¾ƒå¥½çš„å¹¶å‘æ€§èƒ½æ„å‘³ç€ç³»ç»Ÿèƒ½å¤ŸåŒæ—¶å¤„ç†å¤šä¸ªè¯·æ±‚ï¼Œå¹¶ä¿æŒè¾ƒä½çš„å“åº”æ—¶é—´å’Œé«˜ååé‡ã€‚ æ€»ç»“ ä»»ä½•è®¡ç®—æœºç³»ç»Ÿéƒ½éœ€è¦å®Œæˆä¸¤ä¸ªåŸºæœ¬ä»»åŠ¡ï¼š\nå­˜å‚¨ è®¡ç®— éšç€ä»»åŠ¡è§„æ¨¡å˜å¤§ï¼š\n1ã€ä½¿ç”¨å•å°è®¡ç®—æœºï¼Œç¡¬ä»¶å‡çº§ï¼Œæˆæœ¬è¿‡é«˜ 2ã€ä½¿ç”¨å¤šå°è®¡ç®—æœºï¼Œä½¿ç”¨ä¸­æ¡£ã€å¤§ä¼—åŒ–çš„ç¡¬ä»¶ï¼Œæˆæœ¬é™ä½ ä½¿ç”¨å¤šå°è®¡ç®—æœºå­˜åœ¨å¦‚ä¸‹ç‰¹å¾ï¼š\nåˆ†å¸ƒæ€§ã€‚è®¡ç®—æœºèŠ‚ç‚¹åˆ†å¸ƒåœ¨ä¸åŒçš„ä½ç½®ã€‚ å¹¶è¡Œæ€§ã€‚è®¡ç®—æœºèŠ‚ç‚¹å¯ä»¥åŒæ—¶è¿›è¡Œè®¡ç®—å’Œå¤„ç†ä»»åŠ¡ã€‚ å¯æ‰©å±•æ€§ï¼šå¯ä»¥æ·»åŠ èŠ‚ç‚¹ï¼Œæé«˜å¤„ç†èƒ½åŠ›ã€‚ ä¸ç¡®å®šæ€§ã€‚ç”±äºèŠ‚ç‚¹ä¹‹é—´é€šä¿¡æœ‰å»¶è¿Ÿæˆ–è€…å­˜åœ¨æ•…éšœï¼Œä¼šå¯¼è‡´æ¶ˆæ¯ä¼ é€’æœ‰å»¶è¿Ÿã€èŠ‚ç‚¹ä¿¡æ¯å­˜åœ¨ä¸ä¸€è‡´ ä½¿ç”¨å¤šå°è®¡ç®—æœºé¢ä¸´çš„é—®é¢˜ï¼š\nèŠ‚ç‚¹çš„æ•°é‡ã€‚\næ•°é‡å˜å¤šï¼Œå¢åŠ ç³»ç»Ÿæ•…éšœæ¦‚ç‡ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±æˆ–ç³»ç»Ÿä¸å¯ç”¨ã€‚ æ•°é‡å˜å¤šï¼Œå¹¶è¡Œè¯»å†™æ•°æ®ï¼Œä¼šå¯¼è‡´å¹¶å‘å†²çªå’Œæ•°æ®ä¸ä¸€è‡´ã€‚ èŠ‚ç‚¹ä¹‹é—´çš„è·ç¦»ã€‚\næ¯ä¸ªèŠ‚ç‚¹çš„æ—¶é’Ÿä¸åŒæ­¥ï¼Œä¼šå¯¼è‡´ç½‘ç»œå»¶è¿Ÿ èŠ‚ç‚¹ä¹‹é—´æ•°æ®éœ€è¦å¤åˆ¶å’ŒåŒæ­¥ï¼Œä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´æ€§ã€‚ èŠ‚ç‚¹ä¹‹é—´è·ç¦»å˜è¿œï¼Œä¼šé™ä½æŸäº›æ“ä½œçš„æ€§èƒ½ã€‚ æ‰€ä»¥ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿè¦æä¾›ä»¥ä¸‹èƒ½åŠ›ï¼š\nå¯ç”¨æ€§ã€‚ å¯æ‰©å±•æ€§ã€‚å¯ä»¥å¢åŠ èŠ‚ç‚¹æ•°é‡å’Œæé«˜èŠ‚ç‚¹å¤„ç†èƒ½åŠ›ã€‚ ä¸€è‡´æ€§ã€‚æé«˜æ•°æ®ä¸€è‡´æ€§ã€‚ å¯é æ€§ã€‚ç³»ç»Ÿæ•…éšœæ—¶ï¼Œä»ç„¶èƒ½æ­£å¸¸è¿è¡Œã€‚ æ€§èƒ½ã€‚ ","title":"åˆ†å¸ƒå¼åŸºç¡€çŸ¥è¯†"},{"content":"æˆ‘ä¸€ç›´åœ¨æ€è€ƒåˆ†å¸ƒå¼ç³»ç»Ÿå·¥ç¨‹å¸ˆåœ¨å·¥ä½œä¸­å­¦åˆ°çš„æ•™è®­ã€‚æˆ‘ä»¬å¤§éƒ¨åˆ†çš„æ•™å¯¼éƒ½æ¥è‡ªäºåœ¨ç”Ÿäº§ç¯å¢ƒä¸­çŠ¯è¿‡çš„é”™è¯¯ç•™ä¸‹çš„ä¼¤ç—•ã€‚è¿™äº›ä¼¤ç—•å›ºç„¶æ˜¯æœ‰ç”¨çš„æé†’ï¼Œä½†è®©æ›´å¤šçš„å·¥ç¨‹å¸ˆèƒ½å¤Ÿå®Œæ•´åœ°ä¿ç•™æ‰‹æŒ‡ä¼šæ›´å¥½ã€‚\næ–°çš„ç³»ç»Ÿå·¥ç¨‹å¸ˆåœ¨è‡ªæˆ‘å­¦ä¹ ä¸­ä¼šé‡åˆ°åˆ†å¸ƒå¼è®¡ç®—çš„è°¬è®ºå’ŒCAPå®šç†ã€‚ä½†è¿™äº›éƒ½æ˜¯æŠ½è±¡çš„æ¦‚å¿µï¼Œç¼ºä¹é’ˆå¯¹ç»éªŒä¸è¶³çš„å·¥ç¨‹å¸ˆç›´æ¥å¯è¡Œçš„å»ºè®®ã€‚è®©äººæƒŠè®¶çš„æ˜¯ï¼Œæ–°å·¥ç¨‹å¸ˆåœ¨å¼€å§‹å·¥ä½œæ—¶æ‰€äº†è§£åˆ°çš„èƒŒæ™¯ä¿¡æ¯æ˜¯å¦‚æ­¤ä¹‹å°‘ã€‚\nä¸‹é¢æ˜¯æˆ‘ä½œä¸ºä¸€ååˆ†å¸ƒå¼ç³»ç»Ÿå·¥ç¨‹å¸ˆå­¦åˆ°çš„ä¸€äº›ç»éªŒæ•™è®­ï¼Œå€¼å¾—å‘Šè¯‰æ–°å·¥ç¨‹å¸ˆã€‚å…¶ä¸­ä¸€äº›ç»éªŒæ˜¯å¾®å¦™çš„ï¼Œä¸€äº›æ˜¯ä»¤äººæƒŠè®¶çš„ï¼Œä½†æ²¡æœ‰ä¸€æ¡æ˜¯æœ‰äº‰è®®çš„ã€‚è¿™ä¸ªåˆ—è¡¨æ˜¯ä¸ºäº†å¼•å¯¼æ–°çš„åˆ†å¸ƒå¼ç³»ç»Ÿå·¥ç¨‹å¸ˆæ€è€ƒä»–ä»¬æ‰€ä»äº‹é¢†åŸŸçš„é—®é¢˜ï¼Œè™½ç„¶ä¸æ˜¯å…¨é¢çš„ï¼Œä½†æ˜¯æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å¼€å§‹ã€‚\nè¿™ä¸ªåˆ—è¡¨æœ€ç³Ÿç³•çš„ç‰¹ç‚¹æ˜¯å®ƒä¸»è¦å…³æ³¨æŠ€æœ¯é—®é¢˜ï¼Œå¾ˆå°‘è®¨è®ºå·¥ç¨‹å¸ˆå¯èƒ½é‡åˆ°çš„ç¤¾äº¤é—®é¢˜ã€‚ç”±äºåˆ†å¸ƒå¼ç³»ç»Ÿéœ€è¦æ›´å¤šçš„æœºå™¨å’Œèµ„æœ¬ï¼Œå®ƒä»¬çš„å·¥ç¨‹å¸ˆå¾€å¾€éœ€è¦ä¸æ›´å¤šçš„å›¢é˜Ÿå’Œæ›´å¤§çš„ç»„ç»‡åˆä½œã€‚ç¤¾äº¤é—®é¢˜é€šå¸¸æ˜¯ä»»ä½•è½¯ä»¶å¼€å‘è€…å·¥ä½œä¸­æœ€å›°éš¾çš„éƒ¨åˆ†ï¼Œä¹Ÿè®¸å¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿçš„å¼€å‘æ¥è¯´å°¤å…¶å¦‚æ­¤ã€‚\næˆ‘ä»¬çš„èƒŒæ™¯ã€æ•™è‚²å’Œç»éªŒä½¿æˆ‘ä»¬å€¾å‘äºé‡‡ç”¨æŠ€æœ¯è§£å†³æ–¹æ¡ˆï¼Œå³ä½¿ç¤¾äº¤è§£å†³æ–¹æ¡ˆå¯èƒ½æ›´é«˜æ•ˆã€æ›´ä»¤äººæ»¡æ„ã€‚è®©æˆ‘ä»¬è¯•ç€çº æ­£è¿™ä¸€ç‚¹ã€‚ä¸è®¡ç®—æœºç›¸æ¯”ï¼Œäººä»¬å¹¶ä¸é‚£ä¹ˆæŒ‘å‰”ï¼Œå³ä½¿ä»–ä»¬çš„æ¥å£æ²¡æœ‰é‚£ä¹ˆæ ‡å‡†åŒ–ã€‚\nå¥½äº†ï¼Œæˆ‘ä»¬å¼€å§‹å§ã€‚\nåˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯ä¸åŒçš„ï¼Œå› ä¸ºå®ƒä»¬ç»å¸¸å¤±è´¥ã€‚ å½“è¢«é—®åŠæ˜¯ä»€ä¹ˆå°†åˆ†å¸ƒå¼ç³»ç»Ÿä¸è½¯ä»¶å·¥ç¨‹çš„å…¶ä»–é¢†åŸŸåŒºåˆ†å¼€æ¥æ—¶ï¼Œè¿™ä½æ–°å·¥ç¨‹å¸ˆç»å¸¸å¼•ç”¨å»¶è¿Ÿï¼Œè®¤ä¸ºè¿™æ˜¯ä½¿åˆ†å¸ƒå¼è®¡ç®—å˜å¾—å›°éš¾çš„åŸå› ã€‚\nä½†ä»–ä»¬é”™äº†ã€‚åˆ†å¸ƒå¼ç³»ç»Ÿå·¥ç¨‹çš„åŒºåˆ«åœ¨äºå¤±è´¥çš„æ¦‚ç‡ï¼Œæ›´ç³Ÿç³•çš„æ˜¯ï¼Œéƒ¨åˆ†å¤±è´¥çš„æ¦‚ç‡ã€‚å¦‚æœæ ¼å¼è‰¯å¥½çš„äº’æ–¥é”è§£é”å¤±è´¥å¹¶å‡ºç°é”™è¯¯ï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾è¯¥è¿‡ç¨‹ä¸ç¨³å®šå¹¶ä½¿å…¶å´©æºƒã€‚ä½†æ˜¯ï¼Œåˆ†å¸ƒå¼äº’æ–¥é”è§£é”çš„å¤±è´¥å¿…é¡»å†…ç½®åˆ°é”å®šåè®®ä¸­ã€‚\næ²¡æœ‰ä»äº‹è¿‡åˆ†å¸ƒå¼è®¡ç®—çš„ç³»ç»Ÿå·¥ç¨‹å¸ˆä¼šæƒ³å‡ºä¸€äº›æƒ³æ³•ï¼Œæ¯”å¦‚â€œå¥½å§ï¼Œå®ƒåªæ˜¯å°†å†™å…¥å‘é€åˆ°ä¸¤å°æœºå™¨â€æˆ–â€œå®ƒä¼šä¸æ–­é‡è¯•å†™å…¥ï¼Œç›´åˆ°å®ƒæˆåŠŸâ€ã€‚è¿™äº›å·¥ç¨‹å¸ˆè¿˜æ²¡æœ‰å®Œå…¨æ¥å—ï¼ˆå°½ç®¡ä»–ä»¬é€šå¸¸åœ¨ç†æ™ºä¸Šè®¤è¯†åˆ°ï¼‰ç½‘ç»œç³»ç»Ÿæ¯”åªå­˜åœ¨äºä¸€å°æœºå™¨ä¸Šçš„ç³»ç»Ÿæ›´å®¹æ˜“å¤±è´¥ï¼Œè€Œä¸”æ•…éšœå¾€å¾€æ˜¯éƒ¨åˆ†çš„è€Œä¸æ˜¯å…¨éƒ¨çš„ã€‚\nå…¶ä¸­ä¸€ä¸ªå†™å…¥å¯èƒ½ä¼šæˆåŠŸï¼Œè€Œå¦ä¸€ä¸ªå†™å…¥å¤±è´¥ï¼Œé‚£ä¹ˆç°åœ¨æˆ‘ä»¬å¦‚ä½•è·å¾—ä¸€è‡´çš„æ•°æ®è§†å›¾å‘¢ï¼Ÿè¿™äº›éƒ¨åˆ†æ•…éšœæ›´éš¾æ¨ç†ã€‚\näº¤æ¢æœºæ•…éšœã€åƒåœ¾å›æ”¶æš‚åœå¯¼è‡´é¢†å¯¼è€…â€œæ¶ˆå¤±â€ã€å¥—æ¥å­—å†™æ“ä½œä¼¼ä¹æˆåŠŸä½†å®é™…ä¸Šåœ¨å¦ä¸€å°æœºå™¨ä¸Šå¤±è´¥ã€ä¸€å°æœºå™¨ä¸Šçš„æ…¢é€Ÿç£ç›˜é©±åŠ¨å¼•èµ·æ•´ä¸ªé›†ç¾¤ä¸­çš„é€šä¿¡åè®®å˜æ…¢ç­‰ç­‰ã€‚ä»æœ¬åœ°å†…å­˜è¯»å–æ¯”é€šè¿‡å‡ ä¸ªäº¤æ¢æœºè¯»å–æ›´ç¨³å®šã€‚ã€‚\nä¸ºå¤±è´¥è€Œè®¾è®¡ï¼\nç¼–å†™å¥å£®çš„åˆ†å¸ƒå¼ç³»ç»Ÿæ¯”ç¼–å†™å¥å£®çš„å•æœºç³»ç»Ÿæˆæœ¬æ›´é«˜ã€‚ ä¸å•æœºè§£å†³æ–¹æ¡ˆç›¸æ¯”ï¼Œåˆ›å»ºå¼ºå¤§çš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆéœ€è¦æ›´å¤šçš„èµ„é‡‘ï¼Œå› ä¸ºåªæœ‰è®¸å¤šè®¡ç®—æœºæ‰ä¼šå‘ç”Ÿæ•…éšœã€‚è™šæ‹Ÿæœºå’Œäº‘æŠ€æœ¯ä½¿åˆ†å¸ƒå¼ç³»ç»Ÿå·¥ç¨‹æ›´ä¾¿å®œï¼Œä½†ä¸åƒèƒ½å¤Ÿåœ¨æ‚¨å·²ç»æ‹¥æœ‰çš„è®¡ç®—æœºä¸Šè¿›è¡Œè®¾è®¡ã€å®æ–½å’Œæµ‹è¯•é‚£æ ·ä¾¿å®œã€‚å¹¶ä¸”å­˜åœ¨éš¾ä»¥åœ¨å•å°æœºå™¨ä¸Šå¤åˆ¶çš„æ•…éšœæ¡ä»¶ã€‚\næ— è®ºæ˜¯å› ä¸ºå®ƒä»¬åªå‘ç”Ÿåœ¨æ¯”å…±äº«æœºå™¨ä¸Šå¯ä»¥å®¹çº³çš„æ•°æ®é›†å¤§å°å¤§å¾—å¤šçš„æ•°æ®é›†ä¸Šï¼Œè¿˜æ˜¯åœ¨æ•°æ®ä¸­å¿ƒçš„ç½‘ç»œæ¡ä»¶ä¸‹ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿå¾€å¾€éœ€è¦å®é™…çš„ï¼ˆè€Œä¸æ˜¯æ¨¡æ‹Ÿçš„ï¼‰åˆ†å‘æ¥æ¸…é™¤å®ƒä»¬çš„é”™è¯¯ã€‚å½“ç„¶ï¼Œæ¨¡æ‹Ÿéå¸¸æœ‰ç”¨ã€‚\nå¥å£®çš„å¼€æºåˆ†å¸ƒå¼ç³»ç»Ÿè¿œä¸å¦‚å¥å£®çš„å•æœºç³»ç»Ÿå¸¸è§ã€‚é•¿æ—¶é—´è¿è¡Œå¤šå°æœºå™¨çš„æˆæœ¬æ˜¯å¼€æºç¤¾åŒºçš„è´Ÿæ‹…ã€‚ä¸šä½™çˆ±å¥½è€…å’Œä¸šä½™çˆ±å¥½è€…æ˜¯å¼€æºè½¯ä»¶çš„å¼•æ“ï¼Œä»–ä»¬æ²¡æœ‰å¯ç”¨çš„è´¢åŠ¡èµ„æºæ¥æ¢ç´¢æˆ–è§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿå°†é‡åˆ°çš„è®¸å¤šé—®é¢˜ã€‚ä¸šä½™çˆ±å¥½è€…åœ¨ç©ºé—²æ—¶é—´ä½¿ç”¨ä»–ä»¬å·²ç»æ‹¥æœ‰çš„æœºå™¨ç¼–å†™å¼€æºä»£ç ä»¥å–ä¹ã€‚\nè¦æ‰¾åˆ°æ„¿æ„å¯åŠ¨ã€ç»´æŠ¤å’Œæ”¯ä»˜ä¸€å †æœºå™¨çš„å¼€æºå¼€å‘äººå‘˜è¦å›°éš¾å¾—å¤šã€‚\nä¸ºå…¬å¸å®ä½“å·¥ä½œçš„å·¥ç¨‹å¸ˆå·²ç»å¡«è¡¥äº†éƒ¨åˆ†ç©ºç¼ºã€‚ä½†æ˜¯ï¼Œå…¶ç»„ç»‡çš„ä¼˜å…ˆçº§å¯èƒ½ä¸ç»„ç»‡çš„ä¼˜å…ˆçº§ä¸ä¸€è‡´ã€‚\nè™½ç„¶å¼€æºç¤¾åŒºä¸­çš„ä¸€äº›äººå·²ç»æ„è¯†åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œä½†å®ƒè¿˜æ²¡æœ‰å¾—åˆ°è§£å†³ã€‚è¿™å¾ˆéš¾ã€‚\nåè°ƒéå¸¸å›°éš¾ã€‚ å°½å¯èƒ½é¿å…åè°ƒæœºå™¨ã€‚è¿™é€šå¸¸è¢«æè¿°ä¸ºâ€œæ°´å¹³å¯ä¼¸ç¼©æ€§â€ã€‚æ°´å¹³å¯æ‰©å±•æ€§çš„çœŸæ­£è¯€çªæ˜¯ç‹¬ç«‹æ€§â€”â€”èƒ½å¤Ÿå°†æ•°æ®ä¼ é€åˆ°æœºå™¨ä¸Šï¼Œä»è€Œå°†è¿™äº›æœºå™¨ä¹‹é—´çš„é€šä¿¡å’Œå…±è¯†ä¿æŒåœ¨æœ€ä½é™åº¦ã€‚æ¯å½“ä¸¤å°æœºå™¨å¿…é¡»å°±æŸä»¶äº‹è¾¾æˆä¸€è‡´æ—¶ï¼ŒæœåŠ¡å°±ä¼šå˜å¾—æ›´éš¾å®ç°ã€‚\nä¿¡æ¯çš„ä¼ æ’­é€Ÿåº¦æ˜¯æœ‰ä¸Šé™çš„ï¼Œç½‘ç»œé€šä¿¡æ¯”ä½ æƒ³è±¡çš„è¦è„†å¼±ï¼Œä½ å¯¹ä»€ä¹ˆæ˜¯å…±è¯†çš„æƒ³æ³•å¯èƒ½æ˜¯é”™è¯¯çš„ã€‚åœ¨è¿™é‡Œï¼Œäº†è§£ Two Generals å’Œ æ‹œå åº­å°†å†› çš„é—®é¢˜å¾ˆæœ‰ç”¨ã€‚ï¼ˆå“¦ï¼ŒPaxosçœŸçš„å¾ˆéš¾å®ç°ï¼›è¿™ä¸æ˜¯è„¾æ°”æš´èºçš„è€å·¥ç¨‹å¸ˆè®¤ä¸ºä»–ä»¬æ¯”ä½ æ›´äº†è§£ã€‚ï¼‰\nå¦‚æœä½ èƒ½æŠŠä½ çš„é—®é¢˜æ”¾åœ¨å†…å­˜ä¸­ï¼Œé‚£å¯èƒ½æ˜¯å¾®ä¸è¶³é“çš„ã€‚ å¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿå·¥ç¨‹å¸ˆæ¥è¯´ï¼Œä¸€å°æœºå™¨çš„æœ¬åœ°é—®é¢˜å¾ˆå®¹æ˜“è§£å†³ã€‚å½“æ•°æ®è·ç¦»å‡ ä¸ªå¼€å…³è€Œä¸æ˜¯å‡ ä¸ªæŒ‡é’ˆå–æ¶ˆå¼•ç”¨æ—¶ï¼Œå¼„æ¸…æ¥šå¦‚ä½•å¿«é€Ÿå¤„ç†æ•°æ®ä¼šæ›´éš¾ã€‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œè‡ªè®¡ç®—æœºç§‘å­¦å¼€å§‹ä»¥æ¥å°±è®°å½•çš„é™ˆæ—§æ•ˆç‡æŠ€å·§ä¸å†é€‚ç”¨ã€‚\nå¯¹äºåœ¨å•å°æœºå™¨ä¸Šè¿è¡Œçš„ç®—æ³•ï¼Œæœ‰å¤§é‡çš„æ–‡çŒ®å’Œå®ç°ï¼Œå› ä¸ºå¤§éƒ¨åˆ†è®¡ç®—éƒ½æ˜¯åœ¨å•ä¸€çš„ã€ä¸åè°ƒçš„æœºå™¨ä¸Šå®Œæˆçš„ã€‚å¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´ï¼Œå­˜åœ¨çš„æ•°é‡è¦å°‘å¾—å¤šã€‚\nâ€œå¾ˆæ…¢â€æ˜¯ä½ è°ƒè¯•è¿‡çš„æœ€éš¾çš„é—®é¢˜ã€‚ â€œé€Ÿåº¦æ…¢â€å¯èƒ½æ„å‘³ç€æ‰§è¡Œç”¨æˆ·è¯·æ±‚æ‰€æ¶‰åŠçš„ä¸€ä¸ªæˆ–å¤šä¸ªç³»ç»Ÿé€Ÿåº¦è¾ƒæ…¢ã€‚è¿™å¯èƒ½æ„å‘³ç€è·¨å¤šå°è®¡ç®—æœºçš„è½¬æ¢ç®¡é“çš„ä¸€ä¸ªæˆ–å¤šä¸ªéƒ¨åˆ†é€Ÿåº¦è¾ƒæ…¢ã€‚â€œå®ƒå¾ˆæ…¢â€å¾ˆéš¾ï¼Œéƒ¨åˆ†åŸå› æ˜¯é—®é¢˜é™ˆè¿°æ²¡æœ‰æä¾›å¾ˆå¤šå…³äºç¼ºé™·ä½ç½®çš„çº¿ç´¢ã€‚éƒ¨åˆ†æ•…éšœï¼Œå³é‚£äº›æ²¡æœ‰å‡ºç°åœ¨ä½ é€šå¸¸æŸ¥æ‰¾çš„å›¾è¡¨ä¸Šçš„æ•…éšœï¼Œæ½œä¼åœ¨ä¸€ä¸ªé»‘æš—çš„è§’è½é‡Œã€‚\nè€Œä¸”ï¼Œåœ¨é€€åŒ–å˜å¾—éå¸¸æ˜æ˜¾ä¹‹å‰ï¼Œæ‚¨å°†æ— æ³•è·å¾—é‚£ä¹ˆå¤šçš„èµ„æºï¼ˆæ—¶é—´ã€é‡‘é’±å’Œå·¥å…·ï¼‰æ¥è§£å†³å®ƒã€‚Dapper å’Œ Zipkin çš„å‡ºç°æ˜¯æœ‰åŸå› çš„ã€‚\n**åœ¨æ•´ä¸ªç³»ç»Ÿä¸­å®ç°åå‹æœºåˆ¶ã€‚**åå‹æ˜¯æœåŠ¡ç³»ç»Ÿå‘è¯·æ±‚ç³»ç»Ÿå‘å‡ºæ•…éšœä¿¡å·ï¼Œå¹¶ç”±è¯·æ±‚ç³»ç»Ÿå¤„ç†è¿™äº›æ•…éšœä»¥é˜²æ­¢è‡ªèº«å’ŒæœåŠ¡ç³»ç»Ÿè¿‡è½½ã€‚è®¾è®¡åå‹æ„å‘³ç€åœ¨è´Ÿè½½è¿‡é‡å’Œç³»ç»Ÿæ•…éšœæ—¶é™åˆ¶èµ„æºä½¿ç”¨ã€‚è¿™æ˜¯åˆ›å»ºå¥å£®çš„åˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºæœ¬æ„å»ºå—ä¹‹ä¸€ã€‚\nå®ç°åå‹é€šå¸¸æ¶‰åŠä»¥ä¸‹ä¸¤ç§æ–¹å¼ä¹‹ä¸€ï¼šè¦ä¹ˆå°†æ–°æ¶ˆæ¯ä¸¢å¼ƒï¼Œè¦ä¹ˆåœ¨èµ„æºå—é™æˆ–å‘ç”Ÿæ•…éšœæ—¶å°†é”™è¯¯è¿”å›ç»™ç”¨æˆ·ï¼ˆå¹¶åœ¨ä¸¤ç§æƒ…å†µä¸‹å¢åŠ æŒ‡æ ‡ï¼‰ã€‚å¯¹äºä¸å…¶ä»–ç³»ç»Ÿçš„è¿æ¥å’Œè¯·æ±‚ï¼Œè¶…æ—¶å’ŒæŒ‡æ•°é€€é¿ä¹Ÿæ˜¯è‡³å…³é‡è¦çš„ã€‚\nå¦‚æœæ²¡æœ‰åå‹æœºåˆ¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿçº§è”æ•…éšœæˆ–æ„å¤–æ¶ˆæ¯ä¸¢å¤±ã€‚å½“ä¸€ä¸ªç³»ç»Ÿæ— æ³•å¤„ç†å¦ä¸€ä¸ªç³»ç»Ÿçš„æ•…éšœæ—¶ï¼Œå®ƒå€¾å‘äºå°†æ•…éšœä¼ æ’­ç»™ä¾èµ–å®ƒçš„å¦ä¸€ä¸ªç³»ç»Ÿã€‚\nå¯»æ‰¾å®ç°éƒ¨åˆ†å¯ç”¨æ€§çš„æ–¹æ³•ã€‚ éƒ¨åˆ†å¯ç”¨æ€§æ˜¯æŒ‡å³ä½¿ç³»ç»Ÿçš„æŸäº›éƒ¨åˆ†å‘ç”Ÿæ•…éšœï¼Œä»èƒ½è¿”å›ä¸€äº›ç»“æœã€‚\næœç´¢æ˜¯ä¸€ä¸ªç†æƒ³çš„æ¡ˆä¾‹æ¥æ¢è®¨è¿™ä¸ªé—®é¢˜ã€‚æœç´¢ç³»ç»Ÿåœ¨ç»“æœè´¨é‡å’Œç”¨æˆ·ç­‰å¾…æ—¶é—´ä¹‹é—´è¿›è¡Œæƒè¡¡ã€‚ä¸€ä¸ªå…¸å‹çš„æœç´¢ç³»ç»Ÿä¼šè®¾ç½®ä¸€ä¸ªæ—¶é—´é™åˆ¶ï¼Œå¦‚æœåœ¨æœç´¢æ‰€æœ‰æ–‡æ¡£ä¹‹å‰è¶…è¿‡äº†æ—¶é—´é™åˆ¶ï¼Œå®ƒä¼šè¿”å›å·²ç»æ”¶é›†åˆ°çš„ç»“æœã€‚è¿™ä½¿å¾—æœç´¢åœ¨é¢å¯¹é—´æ­‡æ€§å‡é€Ÿå’Œé”™è¯¯æ—¶æ›´å®¹æ˜“æ‰©å±•ï¼Œå› ä¸ºè¿™äº›æ•…éšœè¢«è§†ä¸ºæ— æ³•æœç´¢æ‰€æœ‰æ–‡æ¡£çš„æƒ…å†µã€‚ç³»ç»Ÿå…è®¸è¿”å›éƒ¨åˆ†ç»“æœç»™ç”¨æˆ·ï¼Œå¹¶å¢åŠ äº†å…¶å¼¹æ€§ã€‚\nå†ä»¥Webåº”ç”¨ç¨‹åºä¸­çš„ç§å¯†æ¶ˆæ¯åŠŸèƒ½ä¸ºä¾‹ã€‚æ— è®ºä½ åšä»€ä¹ˆï¼Œç§å¯†æ¶ˆæ¯çš„å­˜å‚¨æœºå™¨éƒ½å¯èƒ½åŒæ—¶å®•æœºï¼Œç”¨æˆ·ä¼šæ³¨æ„åˆ°è¿™ä¸€ç‚¹ã€‚é‚£ä¹ˆåœ¨è¿™ä¸ªç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›å‡ºç°ä»€ä¹ˆæ ·çš„éƒ¨åˆ†æ•…éšœå‘¢ï¼Ÿ\nè¿™éœ€è¦ä¸€äº›æ€è€ƒã€‚ä¸€èˆ¬æ¥è¯´ï¼Œäººä»¬å¯¹äºæ— æ³•ä½¿ç”¨ç§å¯†æ¶ˆæ¯åŠŸèƒ½ï¼ˆæˆ–è®¸æ˜¯å…¶ä»–ä¸€äº›ç”¨æˆ·ä¹Ÿæ— æ³•ä½¿ç”¨ï¼‰ä¼šæ›´å®¹å¿ï¼Œè€Œå¯¹äºæ‰€æœ‰ç”¨æˆ·ä¸­æœ‰ä¸€äº›æ¶ˆæ¯ä¸¢å¤±åˆ™æ›´ä¸ºä¸æ»¡æ„ã€‚å¦‚æœæœåŠ¡è¿‡è½½æˆ–å…¶ä¸­ä¸€å°æœºå™¨æ•…éšœï¼Œåªè®©ä¸€å°éƒ¨åˆ†ç”¨æˆ·æ— æ³•ä½¿ç”¨æ¯”è®©æ›´å¤§æ¯”ä¾‹çš„ç”¨æˆ·ä¸¢å¤±æ•°æ®æ›´å¯å–ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬å¯èƒ½ä¸å¸Œæœ›ä¸€ä¸ªæ— å…³çš„åŠŸèƒ½ï¼ˆæ¯”å¦‚å…¬å…±å›¾ç‰‡ä¸Šä¼ ï¼‰å—åˆ°å½±å“ï¼Œåªå› ä¸ºç§å¯†æ¶ˆæ¯åŠŸèƒ½å‡ºç°é—®é¢˜ã€‚æˆ‘ä»¬æ„¿æ„ä»˜å‡ºå¤šå°‘åŠªåŠ›æ¥ä¿æŒè¿™äº›æ•…éšœåŸŸçš„ç‹¬ç«‹ï¼Ÿ\nèƒ½å¤Ÿåœ¨éƒ¨åˆ†å¯ç”¨æ€§ä¸­è¯†åˆ«è¿™äº›æƒè¡¡æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚\næŒ‡æ ‡æ˜¯å®Œæˆå·¥ä½œçš„å”¯ä¸€é€”å¾„ã€‚ å…¬å¼€æŒ‡æ ‡ï¼ˆå¦‚å»¶è¿Ÿç™¾åˆ†æ¯”ã€ç‰¹å®šæ“ä½œçš„è®¡æ•°å™¨å¢åŠ ã€å˜åŒ–é€Ÿç‡ç­‰ï¼‰æ˜¯å¼¥åˆæ‚¨å¯¹ç³»ç»Ÿåœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ‰€åšçš„å‡è®¾ä¸å®é™…æƒ…å†µä¹‹é—´å·®è·çš„å”¯ä¸€é€”å¾„ã€‚äº†è§£ç³»ç»Ÿåœ¨ç¬¬20å¤©çš„è¡Œä¸ºä¸ç¬¬15å¤©çš„è¡Œä¸ºæœ‰ä½•ä¸åŒï¼Œæ˜¯æˆåŠŸå·¥ç¨‹å’Œå¤±è´¥å·«æœ¯ä¹‹é—´çš„åŒºåˆ«ã€‚å½“ç„¶ï¼ŒæŒ‡æ ‡æ˜¯äº†è§£é—®é¢˜å’Œè¡Œä¸ºçš„å¿…è¦æ‰‹æ®µï¼Œä½†å¹¶ä¸è¶³ä»¥çŸ¥é“æ¥ä¸‹æ¥è¯¥åšä»€ä¹ˆã€‚\nç¨å¾®æä¸€ä¸‹æ—¥å¿—è®°å½•ã€‚æ—¥å¿—æ–‡ä»¶æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œä½†å®ƒä»¬å¾€å¾€ä¼šæ¬ºéª—äººã€‚ä¾‹å¦‚ï¼Œå¾ˆå¸¸è§çš„æƒ…å†µæ˜¯å‡ ä¸ªé”™è¯¯ç±»åˆ«çš„æ—¥å¿—è®°å½•å æ®äº†æ—¥å¿—æ–‡ä»¶çš„å¾ˆå¤§æ¯”ä¾‹ï¼Œä½†å®é™…ä¸Šåœ¨è¯·æ±‚ä¸­çš„æ¯”ä¾‹éå¸¸ä½ã€‚å› ä¸ºåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹è®°å½•æˆåŠŸæ˜¯å¤šä½™çš„ï¼ˆå¹¶ä¸”åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä¼šè€—å°½ç£ç›˜ç©ºé—´ï¼‰ï¼Œè€Œä¸”å·¥ç¨‹å¸ˆç»å¸¸é”™è¯¯åœ°çŒœæµ‹å“ªäº›é”™è¯¯ç±»åˆ«æ˜¯æœ‰ç”¨çš„ï¼Œæ‰€ä»¥æ—¥å¿—æ–‡ä»¶ä¸­å……æ–¥ç€å„ç§å¥‡æ€ªçš„ä¿¡æ¯ã€‚æœ€å¥½ä»¥ä¸€ç§å‡è®¾æœ‰äººä¼šé˜…è¯»æ—¥å¿—ä½†æ²¡æœ‰çœ‹è¿‡ä»£ç çš„æ–¹å¼è¿›è¡Œæ—¥å¿—è®°å½•ã€‚\næˆ‘è§è¿‡å¾ˆå¤šæ¬¡ç”±äºå¦ä¸€ä½å·¥ç¨‹å¸ˆï¼ˆæˆ–è€…æˆ‘è‡ªå·±ï¼‰è¿‡äºå¼ºè°ƒæ—¥å¿—ä¸­çš„ä¸€äº›å¥‡æ€ªç°è±¡è€Œå¯¼è‡´æ•…éšœå»¶é•¿ï¼Œè€Œæ²¡æœ‰å…ˆå°†å…¶ä¸æŒ‡æ ‡è¿›è¡Œå¯¹æ¯”ã€‚æˆ‘è¿˜è§è¿‡å¦ä¸€ä½å·¥ç¨‹å¸ˆï¼ˆæˆ–è€…æˆ‘è‡ªå·±ï¼‰ä»å°‘æ•°å‡ è¡Œæ—¥å¿—ä¸­æ¨æ–­å‡ºæ•´å¥—å¤±è´¥è¡Œä¸ºçš„æƒ…å†µã€‚ä½†è¯·æ³¨æ„ï¼ša) æˆ‘ä»¬ä¹‹æ‰€ä»¥è®°ä½è¿™äº›æˆåŠŸæ¡ˆä¾‹ï¼Œæ˜¯å› ä¸ºå®ƒä»¬éå¸¸ç½•è§ï¼›b) é™¤éæŒ‡æ ‡æˆ–å®éªŒè¯å®äº†æ•…äº‹ï¼Œå¦åˆ™ä½ å¹¶ä¸æ˜¯ç¦å°”æ‘©æ–¯ï¼ˆSherlockï¼‰ã€‚\nä½¿ç”¨ç™¾åˆ†ä½æ•°è€Œä¸æ˜¯å¹³å‡å€¼ã€‚ åœ¨ç»å¤§å¤šæ•°åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç™¾åˆ†ä½æ•°ï¼ˆ50thã€99thã€99.9thã€99.99thï¼‰æ¯”å¹³å‡å€¼æ›´å‡†ç¡®ã€æ›´æœ‰ä¿¡æ¯é‡ã€‚ä½¿ç”¨å¹³å‡å€¼å‡è®¾æ­£åœ¨è¯„ä¼°çš„æŒ‡æ ‡éµå¾ªæ­£æ€åˆ†å¸ƒæ›²çº¿ï¼Œä½†åœ¨å®è·µä¸­ï¼Œè¿™åªé€‚ç”¨äºå°‘æ•°å·¥ç¨‹å¸ˆå…³å¿ƒçš„æŒ‡æ ‡ã€‚ \u0026ldquo;å¹³å‡å»¶è¿Ÿ\u0026rdquo; æ˜¯ä¸€ä¸ªå¸¸è§çš„æŠ¥å‘ŠæŒ‡æ ‡ï¼Œä½†æˆ‘ä»æœªè§è¿‡ä¸€ä¸ªå»¶è¿Ÿéµå¾ªæ­£æ€åˆ†å¸ƒæ›²çº¿çš„åˆ†å¸ƒå¼ç³»ç»Ÿã€‚å¦‚æœæŒ‡æ ‡ä¸éµå¾ªæ­£æ€åˆ†å¸ƒæ›²çº¿ï¼Œå¹³å‡å€¼å°±æ²¡æœ‰æ„ä¹‰ï¼Œä¼šå¯¼è‡´é”™è¯¯çš„å†³ç­–å’Œç†è§£ã€‚é€šè¿‡ä½¿ç”¨ç™¾åˆ†ä½æ•°æ¥é¿å…è¿™ä¸ªé™·é˜±ã€‚é»˜è®¤ä½¿ç”¨ç™¾åˆ†ä½æ•°ï¼Œä½ å°†æ›´å¥½åœ°äº†è§£ç”¨æˆ·çœŸæ­£çœ‹å¾…ä½ çš„ç³»ç»Ÿçš„æ–¹å¼ã€‚\nå­¦ä¼šä¼°ç®—ä½ çš„å®¹é‡ã€‚ å› æ­¤ï¼Œä½ å°†ä¼šçŸ¥é“ä¸€å¤©æœ‰å¤šå°‘ç§’ã€‚çŸ¥é“ä½ éœ€è¦å¤šå°‘å°æœºå™¨æ¥æ‰§è¡Œä¸€ä¸ªä»»åŠ¡æ˜¯ä¸€ä¸ªæŒä¹…ç³»ç»Ÿå’Œä¸€ä¸ªåœ¨å·¥ä½œå¼€å§‹3ä¸ªæœˆåéœ€è¦è¢«æ›¿æ¢çš„ç³»ç»Ÿä¹‹é—´çš„åŒºåˆ«ã€‚æˆ–è€…æ›´ç³Ÿç³•çš„æ˜¯ï¼Œåœ¨ä½ å®Œæˆå°†å…¶æŠ•å…¥ç”Ÿäº§ä¹‹å‰å°±éœ€è¦è¢«æ›¿æ¢ã€‚\nä»¥æ¨æ–‡ä¸ºä¾‹ã€‚åœ¨ä¸€å°æ™®é€šçš„æœºå™¨ä¸Šï¼Œä½ å¯ä»¥å°†å¤šå°‘ä¸ªæ¨æ–‡IDå­˜æ”¾åœ¨å†…å­˜ä¸­? å—¯ï¼Œåˆ°2012å¹´åº•ï¼Œä¸€å°å…¸å‹çš„æœºå™¨æœ‰24 GBçš„å†…å­˜ï¼Œä½ éœ€è¦4-5 GBçš„å¼€é”€æ¥è¿è¡Œæ“ä½œç³»ç»Ÿï¼Œå¦å¤–è¿˜éœ€è¦è‡³å°‘å‡ ä¸ªGBæ¥å¤„ç†è¯·æ±‚ï¼Œè€Œä¸€ä¸ªæ¨æ–‡IDå ç”¨8ä¸ªå­—èŠ‚ã€‚è¿™æ˜¯ä½ å¯èƒ½ä¼šè¿›è¡Œçš„ç²—ç•¥è®¡ç®—ã€‚Jeff Deançš„ã€Šæ¯ä¸ªäººéƒ½åº”è¯¥çŸ¥é“çš„æ•°å­—ã€‹å¹»ç¯ç‰‡æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æœŸæœ›è®¾å®šå·¥å…·ã€‚\nç‰¹æ€§æ ‡å¿—ï¼ˆFeature flagsï¼‰æ˜¯åŸºç¡€è®¾æ–½æ¨å‡ºçš„æ–¹å¼ã€‚ ç‰¹æ€§æ ‡å¿—æ˜¯äº§å“å·¥ç¨‹å¸ˆåœ¨ç³»ç»Ÿä¸­æ¨å‡ºæ–°åŠŸèƒ½çš„å¸¸ç”¨æ–¹å¼ã€‚ç‰¹æ€§æ ‡å¿—é€šå¸¸ä¸å‰ç«¯A/Bæµ‹è¯•ç›¸å…³è”ï¼Œç”¨äºå‘éƒ¨åˆ†ç”¨æˆ·å±•ç¤ºæ–°çš„è®¾è®¡æˆ–åŠŸèƒ½ã€‚ä½†å®ƒä»¬ä¹Ÿæ˜¯æ›¿æ¢åŸºç¡€è®¾æ–½çš„å¼ºå¤§æ–¹å¼ã€‚\nå¾ˆå¤šé¡¹ç›®å› ä¸ºé€‰æ‹©äº†â€œå¤§åˆ‡æ¢â€æˆ–ä¸€ç³»åˆ—â€œå¤§åˆ‡æ¢â€ï¼Œç„¶åç”±äºå‘ç°äº†å¤ªæ™šçš„é”™è¯¯è€Œè¢«è¿«å›æ»šï¼Œä»è€Œå¯¼è‡´å¤±è´¥ã€‚é€šè¿‡ä½¿ç”¨ç‰¹æ€§æ ‡å¿—ï¼Œä½ å°†å¢å¼ºå¯¹é¡¹ç›®çš„ä¿¡å¿ƒå¹¶å‡è½»å¤±è´¥çš„æˆæœ¬ã€‚\nå‡è®¾ä½ è¦ä»å•ä¸€æ•°æ®åº“è¿ç§»åˆ°ä¸€ä¸ªéšè—äº†æ–°å­˜å‚¨è§£å†³æ–¹æ¡ˆç»†èŠ‚çš„æœåŠ¡ã€‚ä½¿ç”¨ç‰¹æ€§æ ‡å¿—ï¼Œä½ å¯ä»¥é€æ­¥å°†å†™æ“ä½œè½¬ç§»åˆ°æ–°æœåŠ¡ï¼Œä¸å¯¹æ—§æ•°æ®åº“çš„å†™æ“ä½œå¹¶è¡Œè¿›è¡Œï¼Œä»¥ç¡®ä¿å…¶å†™è·¯å¾„çš„æ­£ç¡®æ€§å’Œé€Ÿåº¦è¶³å¤Ÿå¿«ã€‚åœ¨å†™è·¯å¾„è¾¾åˆ°100%å¹¶å°†æ•°æ®å›å¡«åˆ°æœåŠ¡çš„æ•°æ®å­˜å‚¨å®Œæˆåï¼Œä½ å¯ä»¥ä½¿ç”¨å•ç‹¬çš„ç‰¹æ€§æ ‡å¿—å¼€å§‹ä»è¯¥æœåŠ¡è¯»å–ï¼Œè€Œä¸åœ¨ç”¨æˆ·å“åº”ä¸­ä½¿ç”¨è¯¥æ•°æ®ï¼Œä»¥æ£€æŸ¥æ€§èƒ½é—®é¢˜ã€‚å¦ä¸€ä¸ªç‰¹æ€§æ ‡å¿—å¯ä»¥ç”¨äºæ¯”è¾ƒä»æ—§ç³»ç»Ÿå’Œæ–°ç³»ç»Ÿè¯»å–çš„æ•°æ®ã€‚æœ€åä¸€ä¸ªæ ‡å¿—å¯ä»¥ç”¨äºé€æ­¥å¢åŠ ä»æ–°ç³»ç»Ÿè¿›è¡Œâ€œçœŸå®â€è¯»å–æ“ä½œã€‚\né€šè¿‡å°†éƒ¨ç½²æ‹†åˆ†ä¸ºå¤šä¸ªæ­¥éª¤ï¼Œå¹¶é€šè¿‡ç‰¹æ€§æ ‡å¿—æä¾›å¿«é€Ÿå’Œéƒ¨åˆ†ååº”ï¼Œä½ å¯ä»¥æ›´å®¹æ˜“åœ°åœ¨æ‰©å±•è¿‡ç¨‹ä¸­å‘ç°é”™è¯¯å’Œæ€§èƒ½é—®é¢˜ï¼Œè€Œä¸æ˜¯åœ¨â€œä¸€æ¬¡æ€§å‘å¸ƒâ€æ—¶å‘ç°ã€‚å¦‚æœå‡ºç°é—®é¢˜ï¼Œä½ åªéœ€ç«‹å³å°†ç‰¹æ€§æ ‡å¿—è®¾ç½®é™ä½åˆ°è¾ƒä½ï¼ˆå¯èƒ½æ˜¯é›¶ï¼‰çš„è®¾ç½®ã€‚é€šè¿‡è°ƒæ•´é€Ÿç‡ï¼Œä½ å¯ä»¥åœ¨ä¸åŒçš„æµé‡é‡çº§ä¸‹è¿›è¡Œè°ƒè¯•å’Œå®éªŒï¼ŒçŸ¥é“ä»»ä½•é—®é¢˜éƒ½ä¸ä¼šé€ æˆç¾éš¾ã€‚ä½¿ç”¨ç‰¹æ€§æ ‡å¿—ï¼Œä½ è¿˜å¯ä»¥é€‰æ‹©å…¶ä»–è¿ç§»ç­–ç•¥ï¼Œä¾‹å¦‚åŸºäºæ¯ä¸ªç”¨æˆ·çš„æ–¹å¼å°†è¯·æ±‚è½¬ç§»åˆ°æ–°ç³»ç»Ÿï¼Œä»¥æä¾›å¯¹æ–°ç³»ç»Ÿçš„æ›´å¥½æ´å¯Ÿã€‚å½“ä½ çš„æ–°æœåŠ¡ä»åœ¨åŸå‹é˜¶æ®µæ—¶ï¼Œä½ å¯ä»¥å°†ç‰¹æ€§æ ‡å¿—è®¾ç½®ä¸ºè¾ƒä½ï¼Œä»¥å‡å°‘æ–°ç³»ç»Ÿçš„èµ„æºæ¶ˆè€—ã€‚\nç°åœ¨ï¼Œç‰¹æ€§æ ‡å¿—å¯¹äºç»å…¸è®­ç»ƒçš„å¼€å‘äººå‘˜æˆ–æ–°å·¥ç¨‹å¸ˆæ¥è¯´å¯èƒ½å¬èµ·æ¥åƒæ˜¯ä¸€å †æ¡ä»¶è¯­å¥çš„å¯æ€•æ··ä¹±ã€‚è€Œä½¿ç”¨ç‰¹æ€§æ ‡å¿—æ„å‘³ç€æ¥å—å¤šä¸ªåŸºç¡€è®¾æ–½å’Œæ•°æ®ç‰ˆæœ¬æ˜¯ä¸€ç§å¸¸æ€ï¼Œè€Œä¸æ˜¯ç½•è§æƒ…å†µã€‚è¿™æ˜¯ä¸€ä¸ªæ·±åˆ»çš„æ•™è®­ã€‚åœ¨å•æœºç³»ç»Ÿä¸­æœ‰æ•ˆçš„æ–¹æ³•åœ¨é¢å¯¹åˆ†å¸ƒå¼é—®é¢˜æ—¶æœ‰æ—¶ä¼šå¤±è´¥ã€‚\nç‰¹æ€§æ ‡å¿—æœ€å¥½è¢«ç†è§£ä¸ºä¸€ç§æƒè¡¡ï¼Œä»¥åœ¨ä»£ç å’Œä¸€ä¸ªç³»ç»Ÿä¸­äº¤æ¢å±€éƒ¨å¤æ‚æ€§ï¼Œä»¥è·å¾—å…¨å±€çš„ç®€å•æ€§å’Œå¼¹æ€§ã€‚\n**æ˜æ™ºåœ°é€‰æ‹©IDç©ºé—´ã€‚ **ä½ ä¸ºç³»ç»Ÿé€‰æ‹©çš„IDç©ºé—´å°†å¡‘é€ ä½ çš„ç³»ç»Ÿã€‚\nè¦è·å–æ•°æ®æ‰€éœ€çš„IDæ•°é‡è¶Šå¤šï¼Œå°±è¶Šæœ‰é€‰æ‹©å°†æ•°æ®è¿›è¡Œåˆ†åŒºçš„é€‰é¡¹ã€‚è¦è·å–æ•°æ®æ‰€éœ€çš„IDæ•°é‡è¶Šå°‘ï¼Œæ¶ˆè´¹ä½ çš„ç³»ç»Ÿè¾“å‡ºå°±è¶Šå®¹æ˜“ã€‚\nä»¥Twitter APIçš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ä¸ºä¾‹ã€‚æ‰€æœ‰è·å–ã€åˆ›å»ºå’Œåˆ é™¤æ¨æ–‡çš„æ“ä½œéƒ½æ˜¯åŸºäºæ¯ä¸ªæ¨æ–‡çš„å•ä¸ªæ•°å­—IDè¿›è¡Œçš„ã€‚æ¨æ–‡IDæ˜¯ä¸€ä¸ªç®€å•çš„64ä½æ•°å­—ï¼Œä¸ä¸ä»»ä½•å…¶ä»–æ•°æ®ç›¸å…³è”ã€‚éšç€æ¨æ–‡æ•°é‡çš„å¢åŠ ï¼Œäººä»¬æ„è¯†åˆ°ï¼Œå¦‚æœå°†åŒä¸€ç”¨æˆ·çš„æ‰€æœ‰æ¨æ–‡å­˜å‚¨åœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œå¯ä»¥æœ‰æ•ˆåœ°æ„å»ºç”¨æˆ·çš„æ¨æ–‡æ—¶é—´çº¿å’Œå…¶ä»–ç”¨æˆ·è®¢é˜…çš„æ—¶é—´çº¿ã€‚\nä½†å…¬å…±APIè¦æ±‚æ¯ä¸ªæ¨æ–‡åªèƒ½é€šè¿‡æ¨æ–‡IDè¿›è¡Œè®¿é—®ã€‚è¦æŒ‰ç”¨æˆ·å¯¹æ¨æ–‡è¿›è¡Œåˆ†åŒºï¼Œéœ€è¦æ„å»ºä¸€ä¸ªæŸ¥æ‰¾æœåŠ¡ï¼Œå®ƒçŸ¥é“å“ªä¸ªç”¨æˆ·æ‹¥æœ‰å“ªä¸ªæ¨æ–‡IDã€‚å¦‚æœå¿…è¦ï¼Œè¿™æ˜¯å¯è¡Œçš„ï¼Œä½†æˆæœ¬ä¸å¯å¿½è§†ã€‚\nå¦ä¸€ç§é€‰æ‹©æ˜¯åœ¨ä»»ä½•æ¨æ–‡æŸ¥æ‰¾æ—¶è¦æ±‚ç”¨æˆ·IDï¼Œå¹¶ä¸”æœ€åˆåªæ˜¯ä½¿ç”¨æ¨æ–‡IDè¿›è¡Œå­˜å‚¨ï¼Œç›´åˆ°ç”¨æˆ·åˆ†åŒºå­˜å‚¨ä¸Šçº¿ã€‚å¦ä¸€ç§é€‰æ‹©æ˜¯åœ¨æ¨æ–‡IDæœ¬èº«ä¸­åŒ…å«ç”¨æˆ·IDï¼Œè¿™æ ·åšçš„ä»£ä»·æ˜¯æ¨æ–‡IDä¸å†å…·æœ‰k-sortableå’Œæ•°å­—çš„ç‰¹æ€§ã€‚\nè¦æ³¨æ„åœ¨IDä¸­æ˜ç¡®å’Œéšå«åœ°ç¼–ç äº†å“ªç§ç±»å‹çš„ä¿¡æ¯ã€‚å®¢æˆ·ç«¯å¯èƒ½åˆ©ç”¨IDçš„ç»“æ„æ¥å»åŒ¿ååŒ–ç§äººæ•°æ®ï¼Œä»¥æ„æƒ³ä¸åˆ°çš„æ–¹å¼çˆ¬å–ä½ çš„ç³»ç»Ÿï¼ˆè‡ªå¢IDé€šå¸¸æ˜¯ä¸€ä¸ªç—›ç‚¹ï¼‰ï¼Œæˆ–è¿›è¡Œå…¶ä»–ä¸€ç³»åˆ—æ”»å‡»ã€‚\nåˆ©ç”¨æ•°æ®å±€éƒ¨æ€§ã€‚ å°†æ•°æ®çš„å¤„ç†å’Œç¼“å­˜ä¸å…¶æŒä¹…å­˜å‚¨ä¿æŒé è¿‘ï¼Œå¤„ç†æ•ˆç‡æ›´é«˜ï¼ŒåŒæ—¶ä¿æŒç¼“å­˜ä¸€è‡´æ€§å’Œå¿«é€Ÿæ€§æ›´å®¹æ˜“ã€‚ä¸æŒ‡é’ˆè§£å¼•ç”¨å’Œfreadï¼ˆ3ï¼‰ç›¸æ¯”ï¼Œç½‘ç»œæ•…éšœå’Œå»¶è¿Ÿæ›´å¤šã€‚\nå½“ç„¶ï¼Œæ•°æ®å±€éƒ¨æ€§æ„å‘³ç€åœ¨ç©ºé—´ä¸Šé è¿‘ï¼Œä½†ä¹Ÿæ„å‘³ç€åœ¨æ—¶é—´ä¸Šé è¿‘ã€‚å¦‚æœå¤šä¸ªç”¨æˆ·å‡ ä¹åŒæ—¶è¿›è¡Œç›¸åŒçš„æ˜‚è´µè¯·æ±‚ï¼Œä¹Ÿè®¸å¯ä»¥å°†å®ƒä»¬çš„è¯·æ±‚åˆå¹¶ä¸ºä¸€ä¸ªè¯·æ±‚ã€‚å¦‚æœåœ¨ç›¸è¿‘çš„æ—¶é—´å†…å‘å‡ºäº†å¤šä¸ªç›¸åŒç±»å‹çš„æ•°æ®è¯·æ±‚ï¼Œå¯ä»¥å°†å®ƒä»¬åˆå¹¶ä¸ºä¸€ä¸ªæ›´å¤§çš„è¯·æ±‚ã€‚è¿™æ ·åšé€šå¸¸å¯ä»¥é™ä½é€šä¿¡å¼€é”€å¹¶æ›´å®¹æ˜“è¿›è¡Œæ•…éšœç®¡ç†ã€‚\n**å°†ç¼“å­˜æ•°æ®å†™å›æŒä¹…å­˜å‚¨æ˜¯ä¸å¥½çš„ã€‚ **è¿™ç§æƒ…å†µåœ¨æ¯”æƒ³è±¡ä¸­æ›´å¤šçš„ç³»ç»Ÿä¸­å‘ç”Ÿã€‚å°¤å…¶æ˜¯é‚£äº›æœ€åˆç”±ç¼ºä¹åˆ†å¸ƒå¼ç³»ç»Ÿç»éªŒçš„äººè®¾è®¡çš„ç³»ç»Ÿã€‚ä½ å°†ç»§æ‰¿è®¸å¤šå…·æœ‰æ­¤ç¼ºé™·çš„ç³»ç»Ÿã€‚å¦‚æœå®æ–½è€…è°ˆåˆ°â€œä¿„ç½—æ–¯å¥—å¨ƒç¼“å­˜â€ï¼Œä½ å¾ˆæœ‰å¯èƒ½é‡åˆ°éå¸¸æ˜æ˜¾çš„é”™è¯¯ã€‚è¿™ä¸ªæ¡ç›®æœ¬å¯ä»¥ä»åˆ—è¡¨ä¸­çœç•¥ï¼Œä½†æˆ‘å¯¹æ­¤ç‰¹åˆ«ç—›æ¨ã€‚è¿™ç§ç¼ºé™·çš„å¸¸è§è¡¨ç°æ˜¯ç”¨æˆ·ä¿¡æ¯ï¼ˆä¾‹å¦‚å±å¹•åç§°ã€ç”µå­é‚®ä»¶å’Œå“ˆå¸Œå¯†ç ï¼‰ç¥ç§˜åœ°æ¢å¤åˆ°å…ˆå‰çš„å€¼ã€‚\nè®¡ç®—æœºçš„èƒ½åŠ›è¶…ä¹ä½ çš„æƒ³è±¡ã€‚ ç°åœ¨çš„ç°åœºå­˜åœ¨å¾ˆå¤šå…³äºæœºå™¨èƒ½åŠ›çš„é”™è¯¯ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯æ¥è‡ªäºæ²¡æœ‰å¤ªå¤šç»éªŒçš„ä»ä¸šè€…ã€‚\nåœ¨2012å¹´åº•ï¼Œè½»å‹WebæœåŠ¡å™¨æ‹¥æœ‰6ä¸ªæˆ–æ›´å¤šå¤„ç†å™¨ï¼Œ24GBå†…å­˜å’Œæ¯”ä½ èƒ½ä½¿ç”¨çš„æ›´å¤šç£ç›˜ç©ºé—´ã€‚åœ¨ç°ä»£è¯­è¨€è¿è¡Œæ—¶ç¯å¢ƒä¸­ï¼Œä¸€ä¸ªç›¸å¯¹å¤æ‚çš„CRUDåº”ç”¨ç¨‹åºåœ¨å•ä¸ªæœºå™¨ä¸Šå¯ä»¥åœ¨å‡ ç™¾æ¯«ç§’å†…è½»æ¾å¤„ç†æ•°åƒä¸ªè¯·æ±‚æ¯ç§’ã€‚è¿™è¿˜åªæ˜¯ä¸‹é™ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ¯å°æœºå™¨æ¯ç§’å¤„ç†æ•°ç™¾ä¸ªè¯·æ±‚å¹¶ä¸å€¼å¾—å¤¸è€€ã€‚\nè·å¾—æ›´é«˜çš„æ€§èƒ½å¹¶ä¸éš¾ï¼Œå°¤å…¶æ˜¯å¦‚æœä½ æ„¿æ„å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œæ€§èƒ½åˆ†æï¼Œå¹¶æ ¹æ®æµ‹é‡ç»“æœå¼•å…¥æ•ˆç‡ã€‚\n**åˆ©ç”¨CAPå®šç†å¯¹ç³»ç»Ÿè¿›è¡Œæ‰¹åˆ¤ã€‚ **CAPå®šç†ä¸èƒ½ç”¨ä½œæ„å»ºç³»ç»Ÿçš„åŸºç¡€ã€‚å®ƒä¸æ˜¯ä¸€ä¸ªå¯ä»¥ä½œä¸ºç¬¬ä¸€åŸåˆ™å¹¶ä»ä¸­æ¨å¯¼å‡ºä¸€ä¸ªå¯è¡Œç³»ç»Ÿçš„å®šç†ã€‚å®ƒçš„é€‚ç”¨èŒƒå›´è¿‡äºå¹¿æ³›ï¼Œå¯èƒ½çš„è§£å†³æ–¹æ¡ˆç©ºé—´ä¹Ÿè¿‡äºå®½æ³›ã€‚\nç„¶è€Œï¼ŒCAPå®šç†éå¸¸é€‚åˆç”¨äºå¯¹åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡è¿›è¡Œæ‰¹åˆ¤ï¼Œå¹¶ç†è§£éœ€è¦åšå‡ºçš„æƒè¡¡ã€‚é€šè¿‡å¯¹ç³»ç»Ÿè®¾è®¡è¿›è¡Œè¿­ä»£ï¼Œè€ƒè™‘CAPå¯¹å…¶å­ç³»ç»Ÿæ–½åŠ çš„çº¦æŸï¼Œæœ€ç»ˆå¯ä»¥å¾—åˆ°æ›´å¥½çš„è®¾è®¡ã€‚ä½œä¸šä¸­ï¼Œå°†CAPå®šç†çš„çº¦æŸåº”ç”¨äºä¿„ç½—æ–¯å¥—å¨ƒç¼“å­˜çš„å®é™…å®ç°ã€‚\næœ€åéœ€è¦æ³¨æ„çš„æ˜¯ï¼šåœ¨ä¸€è‡´æ€§ï¼ˆCï¼‰ã€å¯ç”¨æ€§ï¼ˆAï¼‰å’Œåˆ†åŒºå®¹å¿æ€§ï¼ˆPï¼‰ä¸­ï¼Œä¸èƒ½é€‰æ‹©CAã€‚\n**æå–æœåŠ¡ã€‚ **è¿™é‡Œçš„\u0026quot;æœåŠ¡\u0026quot;æŒ‡çš„æ˜¯\u0026quot;ä¸€ä¸ªåŒ…å«é«˜çº§é€»è¾‘çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œé€šå¸¸å…·æœ‰è¯·æ±‚-å“åº”å¼çš„API\u0026quot;ã€‚è¦ç•™æ„é‚£äº›å¦‚æœå­˜åœ¨äºä¸€ä¸ªå•ç‹¬çš„æœåŠ¡ä¸­è€Œä¸æ˜¯ä½ çš„ç³»ç»Ÿä¸­ï¼Œå°†æ›´å®¹æ˜“è¿›è¡Œçš„ä»£ç æ›´æ”¹ã€‚\næå–å‡ºä¸€ä¸ªæœåŠ¡æä¾›äº†å°è£…çš„å¥½å¤„ï¼Œé€šå¸¸ä¸åˆ›å»ºåº“ç›¸æå¹¶è®ºã€‚ç„¶è€Œï¼Œæå–å‡ºä¸€ä¸ªæœåŠ¡æ”¹è¿›äº†åˆ›å»ºåº“çš„æ–¹å¼ï¼Œå› ä¸ºå®ƒå…è®¸æ›´å¿«ã€æ›´å®¹æ˜“åœ°éƒ¨ç½²å˜æ›´ï¼Œè€Œä¸åƒå‡çº§å®¢æˆ·ç³»ç»Ÿä¸­çš„åº“é‚£æ ·éº»çƒ¦ã€‚ï¼ˆå½“ç„¶ï¼Œå¦‚æœæå–å‡ºçš„æœåŠ¡éš¾ä»¥éƒ¨ç½²ï¼Œé‚£ä¹ˆå®¢æˆ·ç³»ç»Ÿå°†å˜å¾—æ›´å®¹æ˜“éƒ¨ç½²ã€‚ï¼‰è¿™ç§ä¾¿åˆ©æ˜¯ç”±äºè¾ƒå°ã€æå–å‡ºçš„æœåŠ¡ä¸­çš„ä»£ç å’Œæ“ä½œä¾èµ–è¾ƒå°‘ï¼Œå¹¶ä¸”å…¶åˆ›å»ºçš„ä¸¥æ ¼è¾¹ç•Œä½¿å¾—å¾ˆéš¾\u0026quot;èµ°æ·å¾„\u0026quot;ï¼Œè€Œåº“åˆ™å…è®¸è¿™ç§èµ°æ·å¾„ã€‚è¿™äº›èµ°æ·å¾„é€šå¸¸ä¼šä½¿è¿ç§»å†…éƒ¨æˆ–å®¢æˆ·ç³»ç»Ÿåˆ°æ–°ç‰ˆæœ¬å˜å¾—æ›´åŠ å›°éš¾ã€‚\nå½“å­˜åœ¨å¤šä¸ªå®¢æˆ·ç³»ç»Ÿæ—¶ï¼Œä½¿ç”¨æœåŠ¡çš„åè°ƒæˆæœ¬ä¹Ÿæ¯”ä½¿ç”¨å…±äº«åº“è¦ä½å¾—å¤šã€‚å³ä½¿ä¸éœ€è¦è¿›è¡ŒAPIæ›´æ”¹ï¼Œå‡çº§åº“ä¹Ÿéœ€è¦åè°ƒæ¯ä¸ªå®¢æˆ·ç³»ç»Ÿçš„éƒ¨ç½²ã€‚å¦‚æœéƒ¨ç½²æ¬¡åºé¢ å€’ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®æŸåï¼ˆè€Œä¸”å¾ˆéš¾é¢„æµ‹è¿™ç§æƒ…å†µï¼‰ï¼Œè¿™ä½¿å¾—å‡çº§åº“å˜å¾—æ›´åŠ å›°éš¾ã€‚å¦‚æœå®¢æˆ·ç³»ç»Ÿç”±ä¸åŒçš„ç»´æŠ¤è€…è´Ÿè´£ï¼Œå‡çº§åº“çš„ç¤¾äº¤åè°ƒæˆæœ¬ä¹Ÿæ¯”éƒ¨ç½²æœåŠ¡æ›´é«˜ã€‚è®©å…¶ä»–äººæ„è¯†åˆ°å¹¶æ„¿æ„å‡çº§æ˜¯éå¸¸å›°éš¾çš„ï¼Œå› ä¸ºä»–ä»¬çš„ä¼˜å…ˆäº‹é¡¹å¯èƒ½ä¸ä½ çš„ä¸ä¸€è‡´ã€‚\nå…¸å‹çš„æœåŠ¡ä½¿ç”¨æ¡ˆä¾‹æ˜¯éšè—ä¸€ä¸ªå°†è¦è¿›è¡Œå˜æ›´çš„å­˜å‚¨å±‚ã€‚æå–å‡ºçš„æœåŠ¡å…·æœ‰æ›´æ–¹ä¾¿ä¸”è¡¨é¢ç§¯æ›´å°çš„APIï¼Œä¸å…¶å‰ç«¯çš„å­˜å‚¨å±‚ç›¸æ¯”ã€‚é€šè¿‡æå–æœåŠ¡ï¼Œå®¢æˆ·ç³»ç»Ÿæ— éœ€äº†è§£è¿ç§»åˆ°æ–°çš„å­˜å‚¨ç³»ç»Ÿæˆ–æ ¼å¼çš„å¤æ‚æ€§ï¼Œåªéœ€è¦è¯„ä¼°æ–°æœåŠ¡ä¸­è‚¯å®šä¼šå‘ç°çš„ä¸æ–°å­˜å‚¨å¸ƒå±€ç›¸å…³çš„é”™è¯¯ã€‚\nåœ¨æ‰§è¡Œæ­¤æ“ä½œæ—¶ï¼Œéœ€è¦è€ƒè™‘è®¸å¤šæ“ä½œå’Œç¤¾äº¤é—®é¢˜ã€‚åœ¨è¿™é‡Œæ— æ³•å¯¹å®ƒä»¬è¿›è¡Œå……åˆ†é˜è¿°ã€‚éœ€è¦æ’°å†™å¦ä¸€ç¯‡æ–‡ç« å¯¹æ­¤è¿›è¡Œè¯¦ç»†è¯´æ˜ã€‚\næˆ‘å¯¹æˆ‘çš„å®¡ç¨¿äººBill de hÃ“raã€Coda Haleã€JD Maturenã€Micaela McDonaldå’ŒTed Nymanè¡¨ç¤ºè¡·å¿ƒæ„Ÿè°¢ã€‚ä½ ä»¬çš„è§è§£å’Œå…³å¿ƒæ˜¯æ— ä»·çš„ã€‚\næ›´æ–°ï¼ˆ2016-08-15ï¼‰ï¼šæˆ‘ä¸ºæ¯ä¸ªéƒ¨åˆ†æ·»åŠ äº†æ°¸ä¹…é“¾æ¥ï¼Œå¹¶å¯¹åè°ƒã€æ•°æ®æœ¬åœ°æ€§ã€åŠŸèƒ½æ ‡å¿—å’ŒèƒŒå‹ç­‰éƒ¨åˆ†çš„æ–‡æœ¬è¿›è¡Œäº†ä¸€äº›æ¸…ç†ã€‚\nåŸæ–‡é“¾æ¥ï¼šNotes on Distributed Systems for Young Bloods\n","permalink":"https://blog.chensoul.cc/posts/2023/11/10/notes-on-distributed-systems-for-young-bloods/","summary":"æˆ‘ä¸€ç›´åœ¨æ€è€ƒåˆ†å¸ƒå¼ç³»ç»Ÿå·¥ç¨‹å¸ˆåœ¨å·¥ä½œä¸­å­¦åˆ°çš„æ•™è®­ã€‚æˆ‘ä»¬å¤§éƒ¨åˆ†çš„æ•™å¯¼éƒ½æ¥è‡ªäºåœ¨ç”Ÿäº§ç¯å¢ƒä¸­çŠ¯è¿‡çš„é”™è¯¯ç•™ä¸‹çš„ä¼¤ç—•ã€‚è¿™äº›ä¼¤ç—•å›ºç„¶æ˜¯æœ‰ç”¨çš„æé†’ï¼Œä½†è®©æ›´å¤šçš„å·¥ç¨‹å¸ˆèƒ½å¤Ÿå®Œæ•´åœ°ä¿ç•™æ‰‹æŒ‡ä¼šæ›´å¥½ã€‚\næ–°çš„ç³»ç»Ÿå·¥ç¨‹å¸ˆåœ¨è‡ªæˆ‘å­¦ä¹ ä¸­ä¼šé‡åˆ°åˆ†å¸ƒå¼è®¡ç®—çš„è°¬è®ºå’ŒCAPå®šç†ã€‚ä½†è¿™äº›éƒ½æ˜¯æŠ½è±¡çš„æ¦‚å¿µï¼Œç¼ºä¹é’ˆå¯¹ç»éªŒä¸è¶³çš„å·¥ç¨‹å¸ˆç›´æ¥å¯è¡Œçš„å»ºè®®ã€‚è®©äººæƒŠè®¶çš„æ˜¯ï¼Œæ–°å·¥ç¨‹å¸ˆåœ¨å¼€å§‹å·¥ä½œæ—¶æ‰€äº†è§£åˆ°çš„èƒŒæ™¯ä¿¡æ¯æ˜¯å¦‚æ­¤ä¹‹å°‘ã€‚\nä¸‹é¢æ˜¯æˆ‘ä½œä¸ºä¸€ååˆ†å¸ƒå¼ç³»ç»Ÿå·¥ç¨‹å¸ˆå­¦åˆ°çš„ä¸€äº›ç»éªŒæ•™è®­ï¼Œå€¼å¾—å‘Šè¯‰æ–°å·¥ç¨‹å¸ˆã€‚å…¶ä¸­ä¸€äº›ç»éªŒæ˜¯å¾®å¦™çš„ï¼Œä¸€äº›æ˜¯ä»¤äººæƒŠè®¶çš„ï¼Œä½†æ²¡æœ‰ä¸€æ¡æ˜¯æœ‰äº‰è®®çš„ã€‚è¿™ä¸ªåˆ—è¡¨æ˜¯ä¸ºäº†å¼•å¯¼æ–°çš„åˆ†å¸ƒå¼ç³»ç»Ÿå·¥ç¨‹å¸ˆæ€è€ƒä»–ä»¬æ‰€ä»äº‹é¢†åŸŸçš„é—®é¢˜ï¼Œè™½ç„¶ä¸æ˜¯å…¨é¢çš„ï¼Œä½†æ˜¯æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å¼€å§‹ã€‚\nè¿™ä¸ªåˆ—è¡¨æœ€ç³Ÿç³•çš„ç‰¹ç‚¹æ˜¯å®ƒä¸»è¦å…³æ³¨æŠ€æœ¯é—®é¢˜ï¼Œå¾ˆå°‘è®¨è®ºå·¥ç¨‹å¸ˆå¯èƒ½é‡åˆ°çš„ç¤¾äº¤é—®é¢˜ã€‚ç”±äºåˆ†å¸ƒå¼ç³»ç»Ÿéœ€è¦æ›´å¤šçš„æœºå™¨å’Œèµ„æœ¬ï¼Œå®ƒä»¬çš„å·¥ç¨‹å¸ˆå¾€å¾€éœ€è¦ä¸æ›´å¤šçš„å›¢é˜Ÿå’Œæ›´å¤§çš„ç»„ç»‡åˆä½œã€‚ç¤¾äº¤é—®é¢˜é€šå¸¸æ˜¯ä»»ä½•è½¯ä»¶å¼€å‘è€…å·¥ä½œä¸­æœ€å›°éš¾çš„éƒ¨åˆ†ï¼Œä¹Ÿè®¸å¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿçš„å¼€å‘æ¥è¯´å°¤å…¶å¦‚æ­¤ã€‚\næˆ‘ä»¬çš„èƒŒæ™¯ã€æ•™è‚²å’Œç»éªŒä½¿æˆ‘ä»¬å€¾å‘äºé‡‡ç”¨æŠ€æœ¯è§£å†³æ–¹æ¡ˆï¼Œå³ä½¿ç¤¾äº¤è§£å†³æ–¹æ¡ˆå¯èƒ½æ›´é«˜æ•ˆã€æ›´ä»¤äººæ»¡æ„ã€‚è®©æˆ‘ä»¬è¯•ç€çº æ­£è¿™ä¸€ç‚¹ã€‚ä¸è®¡ç®—æœºç›¸æ¯”ï¼Œäººä»¬å¹¶ä¸é‚£ä¹ˆæŒ‘å‰”ï¼Œå³ä½¿ä»–ä»¬çš„æ¥å£æ²¡æœ‰é‚£ä¹ˆæ ‡å‡†åŒ–ã€‚\nå¥½äº†ï¼Œæˆ‘ä»¬å¼€å§‹å§ã€‚\nåˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯ä¸åŒçš„ï¼Œå› ä¸ºå®ƒä»¬ç»å¸¸å¤±è´¥ã€‚ å½“è¢«é—®åŠæ˜¯ä»€ä¹ˆå°†åˆ†å¸ƒå¼ç³»ç»Ÿä¸è½¯ä»¶å·¥ç¨‹çš„å…¶ä»–é¢†åŸŸåŒºåˆ†å¼€æ¥æ—¶ï¼Œè¿™ä½æ–°å·¥ç¨‹å¸ˆç»å¸¸å¼•ç”¨å»¶è¿Ÿï¼Œè®¤ä¸ºè¿™æ˜¯ä½¿åˆ†å¸ƒå¼è®¡ç®—å˜å¾—å›°éš¾çš„åŸå› ã€‚\nä½†ä»–ä»¬é”™äº†ã€‚åˆ†å¸ƒå¼ç³»ç»Ÿå·¥ç¨‹çš„åŒºåˆ«åœ¨äºå¤±è´¥çš„æ¦‚ç‡ï¼Œæ›´ç³Ÿç³•çš„æ˜¯ï¼Œéƒ¨åˆ†å¤±è´¥çš„æ¦‚ç‡ã€‚å¦‚æœæ ¼å¼è‰¯å¥½çš„äº’æ–¥é”è§£é”å¤±è´¥å¹¶å‡ºç°é”™è¯¯ï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾è¯¥è¿‡ç¨‹ä¸ç¨³å®šå¹¶ä½¿å…¶å´©æºƒã€‚ä½†æ˜¯ï¼Œåˆ†å¸ƒå¼äº’æ–¥é”è§£é”çš„å¤±è´¥å¿…é¡»å†…ç½®åˆ°é”å®šåè®®ä¸­ã€‚\næ²¡æœ‰ä»äº‹è¿‡åˆ†å¸ƒå¼è®¡ç®—çš„ç³»ç»Ÿå·¥ç¨‹å¸ˆä¼šæƒ³å‡ºä¸€äº›æƒ³æ³•ï¼Œæ¯”å¦‚â€œå¥½å§ï¼Œå®ƒåªæ˜¯å°†å†™å…¥å‘é€åˆ°ä¸¤å°æœºå™¨â€æˆ–â€œå®ƒä¼šä¸æ–­é‡è¯•å†™å…¥ï¼Œç›´åˆ°å®ƒæˆåŠŸâ€ã€‚è¿™äº›å·¥ç¨‹å¸ˆè¿˜æ²¡æœ‰å®Œå…¨æ¥å—ï¼ˆå°½ç®¡ä»–ä»¬é€šå¸¸åœ¨ç†æ™ºä¸Šè®¤è¯†åˆ°ï¼‰ç½‘ç»œç³»ç»Ÿæ¯”åªå­˜åœ¨äºä¸€å°æœºå™¨ä¸Šçš„ç³»ç»Ÿæ›´å®¹æ˜“å¤±è´¥ï¼Œè€Œä¸”æ•…éšœå¾€å¾€æ˜¯éƒ¨åˆ†çš„è€Œä¸æ˜¯å…¨éƒ¨çš„ã€‚\nå…¶ä¸­ä¸€ä¸ªå†™å…¥å¯èƒ½ä¼šæˆåŠŸï¼Œè€Œå¦ä¸€ä¸ªå†™å…¥å¤±è´¥ï¼Œé‚£ä¹ˆç°åœ¨æˆ‘ä»¬å¦‚ä½•è·å¾—ä¸€è‡´çš„æ•°æ®è§†å›¾å‘¢ï¼Ÿè¿™äº›éƒ¨åˆ†æ•…éšœæ›´éš¾æ¨ç†ã€‚\näº¤æ¢æœºæ•…éšœã€åƒåœ¾å›æ”¶æš‚åœå¯¼è‡´é¢†å¯¼è€…â€œæ¶ˆå¤±â€ã€å¥—æ¥å­—å†™æ“ä½œä¼¼ä¹æˆåŠŸä½†å®é™…ä¸Šåœ¨å¦ä¸€å°æœºå™¨ä¸Šå¤±è´¥ã€ä¸€å°æœºå™¨ä¸Šçš„æ…¢é€Ÿç£ç›˜é©±åŠ¨å¼•èµ·æ•´ä¸ªé›†ç¾¤ä¸­çš„é€šä¿¡åè®®å˜æ…¢ç­‰ç­‰ã€‚ä»æœ¬åœ°å†…å­˜è¯»å–æ¯”é€šè¿‡å‡ ä¸ªäº¤æ¢æœºè¯»å–æ›´ç¨³å®šã€‚ã€‚\nä¸ºå¤±è´¥è€Œè®¾è®¡ï¼\nç¼–å†™å¥å£®çš„åˆ†å¸ƒå¼ç³»ç»Ÿæ¯”ç¼–å†™å¥å£®çš„å•æœºç³»ç»Ÿæˆæœ¬æ›´é«˜ã€‚ ä¸å•æœºè§£å†³æ–¹æ¡ˆç›¸æ¯”ï¼Œåˆ›å»ºå¼ºå¤§çš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆéœ€è¦æ›´å¤šçš„èµ„é‡‘ï¼Œå› ä¸ºåªæœ‰è®¸å¤šè®¡ç®—æœºæ‰ä¼šå‘ç”Ÿæ•…éšœã€‚è™šæ‹Ÿæœºå’Œäº‘æŠ€æœ¯ä½¿åˆ†å¸ƒå¼ç³»ç»Ÿå·¥ç¨‹æ›´ä¾¿å®œï¼Œä½†ä¸åƒèƒ½å¤Ÿåœ¨æ‚¨å·²ç»æ‹¥æœ‰çš„è®¡ç®—æœºä¸Šè¿›è¡Œè®¾è®¡ã€å®æ–½å’Œæµ‹è¯•é‚£æ ·ä¾¿å®œã€‚å¹¶ä¸”å­˜åœ¨éš¾ä»¥åœ¨å•å°æœºå™¨ä¸Šå¤åˆ¶çš„æ•…éšœæ¡ä»¶ã€‚\næ— è®ºæ˜¯å› ä¸ºå®ƒä»¬åªå‘ç”Ÿåœ¨æ¯”å…±äº«æœºå™¨ä¸Šå¯ä»¥å®¹çº³çš„æ•°æ®é›†å¤§å°å¤§å¾—å¤šçš„æ•°æ®é›†ä¸Šï¼Œè¿˜æ˜¯åœ¨æ•°æ®ä¸­å¿ƒçš„ç½‘ç»œæ¡ä»¶ä¸‹ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿå¾€å¾€éœ€è¦å®é™…çš„ï¼ˆè€Œä¸æ˜¯æ¨¡æ‹Ÿçš„ï¼‰åˆ†å‘æ¥æ¸…é™¤å®ƒä»¬çš„é”™è¯¯ã€‚å½“ç„¶ï¼Œæ¨¡æ‹Ÿéå¸¸æœ‰ç”¨ã€‚\nå¥å£®çš„å¼€æºåˆ†å¸ƒå¼ç³»ç»Ÿè¿œä¸å¦‚å¥å£®çš„å•æœºç³»ç»Ÿå¸¸è§ã€‚é•¿æ—¶é—´è¿è¡Œå¤šå°æœºå™¨çš„æˆæœ¬æ˜¯å¼€æºç¤¾åŒºçš„è´Ÿæ‹…ã€‚ä¸šä½™çˆ±å¥½è€…å’Œä¸šä½™çˆ±å¥½è€…æ˜¯å¼€æºè½¯ä»¶çš„å¼•æ“ï¼Œä»–ä»¬æ²¡æœ‰å¯ç”¨çš„è´¢åŠ¡èµ„æºæ¥æ¢ç´¢æˆ–è§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿå°†é‡åˆ°çš„è®¸å¤šé—®é¢˜ã€‚ä¸šä½™çˆ±å¥½è€…åœ¨ç©ºé—²æ—¶é—´ä½¿ç”¨ä»–ä»¬å·²ç»æ‹¥æœ‰çš„æœºå™¨ç¼–å†™å¼€æºä»£ç ä»¥å–ä¹ã€‚\nè¦æ‰¾åˆ°æ„¿æ„å¯åŠ¨ã€ç»´æŠ¤å’Œæ”¯ä»˜ä¸€å †æœºå™¨çš„å¼€æºå¼€å‘äººå‘˜è¦å›°éš¾å¾—å¤šã€‚\nä¸ºå…¬å¸å®ä½“å·¥ä½œçš„å·¥ç¨‹å¸ˆå·²ç»å¡«è¡¥äº†éƒ¨åˆ†ç©ºç¼ºã€‚ä½†æ˜¯ï¼Œå…¶ç»„ç»‡çš„ä¼˜å…ˆçº§å¯èƒ½ä¸ç»„ç»‡çš„ä¼˜å…ˆçº§ä¸ä¸€è‡´ã€‚\nè™½ç„¶å¼€æºç¤¾åŒºä¸­çš„ä¸€äº›äººå·²ç»æ„è¯†åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œä½†å®ƒè¿˜æ²¡æœ‰å¾—åˆ°è§£å†³ã€‚è¿™å¾ˆéš¾ã€‚\nåè°ƒéå¸¸å›°éš¾ã€‚ å°½å¯èƒ½é¿å…åè°ƒæœºå™¨ã€‚è¿™é€šå¸¸è¢«æè¿°ä¸ºâ€œæ°´å¹³å¯ä¼¸ç¼©æ€§â€ã€‚æ°´å¹³å¯æ‰©å±•æ€§çš„çœŸæ­£è¯€çªæ˜¯ç‹¬ç«‹æ€§â€”â€”èƒ½å¤Ÿå°†æ•°æ®ä¼ é€åˆ°æœºå™¨ä¸Šï¼Œä»è€Œå°†è¿™äº›æœºå™¨ä¹‹é—´çš„é€šä¿¡å’Œå…±è¯†ä¿æŒåœ¨æœ€ä½é™åº¦ã€‚æ¯å½“ä¸¤å°æœºå™¨å¿…é¡»å°±æŸä»¶äº‹è¾¾æˆä¸€è‡´æ—¶ï¼ŒæœåŠ¡å°±ä¼šå˜å¾—æ›´éš¾å®ç°ã€‚\nä¿¡æ¯çš„ä¼ æ’­é€Ÿåº¦æ˜¯æœ‰ä¸Šé™çš„ï¼Œç½‘ç»œé€šä¿¡æ¯”ä½ æƒ³è±¡çš„è¦è„†å¼±ï¼Œä½ å¯¹ä»€ä¹ˆæ˜¯å…±è¯†çš„æƒ³æ³•å¯èƒ½æ˜¯é”™è¯¯çš„ã€‚åœ¨è¿™é‡Œï¼Œäº†è§£ Two Generals å’Œ æ‹œå åº­å°†å†› çš„é—®é¢˜å¾ˆæœ‰ç”¨ã€‚ï¼ˆå“¦ï¼ŒPaxosçœŸçš„å¾ˆéš¾å®ç°ï¼›è¿™ä¸æ˜¯è„¾æ°”æš´èºçš„è€å·¥ç¨‹å¸ˆè®¤ä¸ºä»–ä»¬æ¯”ä½ æ›´äº†è§£ã€‚ï¼‰\nå¦‚æœä½ èƒ½æŠŠä½ çš„é—®é¢˜æ”¾åœ¨å†…å­˜ä¸­ï¼Œé‚£å¯èƒ½æ˜¯å¾®ä¸è¶³é“çš„ã€‚ å¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿå·¥ç¨‹å¸ˆæ¥è¯´ï¼Œä¸€å°æœºå™¨çš„æœ¬åœ°é—®é¢˜å¾ˆå®¹æ˜“è§£å†³ã€‚å½“æ•°æ®è·ç¦»å‡ ä¸ªå¼€å…³è€Œä¸æ˜¯å‡ ä¸ªæŒ‡é’ˆå–æ¶ˆå¼•ç”¨æ—¶ï¼Œå¼„æ¸…æ¥šå¦‚ä½•å¿«é€Ÿå¤„ç†æ•°æ®ä¼šæ›´éš¾ã€‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œè‡ªè®¡ç®—æœºç§‘å­¦å¼€å§‹ä»¥æ¥å°±è®°å½•çš„é™ˆæ—§æ•ˆç‡æŠ€å·§ä¸å†é€‚ç”¨ã€‚\nå¯¹äºåœ¨å•å°æœºå™¨ä¸Šè¿è¡Œçš„ç®—æ³•ï¼Œæœ‰å¤§é‡çš„æ–‡çŒ®å’Œå®ç°ï¼Œå› ä¸ºå¤§éƒ¨åˆ†è®¡ç®—éƒ½æ˜¯åœ¨å•ä¸€çš„ã€ä¸åè°ƒçš„æœºå™¨ä¸Šå®Œæˆçš„ã€‚å¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´ï¼Œå­˜åœ¨çš„æ•°é‡è¦å°‘å¾—å¤šã€‚\nâ€œå¾ˆæ…¢â€æ˜¯ä½ è°ƒè¯•è¿‡çš„æœ€éš¾çš„é—®é¢˜ã€‚ â€œé€Ÿåº¦æ…¢â€å¯èƒ½æ„å‘³ç€æ‰§è¡Œç”¨æˆ·è¯·æ±‚æ‰€æ¶‰åŠçš„ä¸€ä¸ªæˆ–å¤šä¸ªç³»ç»Ÿé€Ÿåº¦è¾ƒæ…¢ã€‚è¿™å¯èƒ½æ„å‘³ç€è·¨å¤šå°è®¡ç®—æœºçš„è½¬æ¢ç®¡é“çš„ä¸€ä¸ªæˆ–å¤šä¸ªéƒ¨åˆ†é€Ÿåº¦è¾ƒæ…¢ã€‚â€œå®ƒå¾ˆæ…¢â€å¾ˆéš¾ï¼Œéƒ¨åˆ†åŸå› æ˜¯é—®é¢˜é™ˆè¿°æ²¡æœ‰æä¾›å¾ˆå¤šå…³äºç¼ºé™·ä½ç½®çš„çº¿ç´¢ã€‚éƒ¨åˆ†æ•…éšœï¼Œå³é‚£äº›æ²¡æœ‰å‡ºç°åœ¨ä½ é€šå¸¸æŸ¥æ‰¾çš„å›¾è¡¨ä¸Šçš„æ•…éšœï¼Œæ½œä¼åœ¨ä¸€ä¸ªé»‘æš—çš„è§’è½é‡Œã€‚\nè€Œä¸”ï¼Œåœ¨é€€åŒ–å˜å¾—éå¸¸æ˜æ˜¾ä¹‹å‰ï¼Œæ‚¨å°†æ— æ³•è·å¾—é‚£ä¹ˆå¤šçš„èµ„æºï¼ˆæ—¶é—´ã€é‡‘é’±å’Œå·¥å…·ï¼‰æ¥è§£å†³å®ƒã€‚Dapper å’Œ Zipkin çš„å‡ºç°æ˜¯æœ‰åŸå› çš„ã€‚\n**åœ¨æ•´ä¸ªç³»ç»Ÿä¸­å®ç°åå‹æœºåˆ¶ã€‚**åå‹æ˜¯æœåŠ¡ç³»ç»Ÿå‘è¯·æ±‚ç³»ç»Ÿå‘å‡ºæ•…éšœä¿¡å·ï¼Œå¹¶ç”±è¯·æ±‚ç³»ç»Ÿå¤„ç†è¿™äº›æ•…éšœä»¥é˜²æ­¢è‡ªèº«å’ŒæœåŠ¡ç³»ç»Ÿè¿‡è½½ã€‚è®¾è®¡åå‹æ„å‘³ç€åœ¨è´Ÿè½½è¿‡é‡å’Œç³»ç»Ÿæ•…éšœæ—¶é™åˆ¶èµ„æºä½¿ç”¨ã€‚è¿™æ˜¯åˆ›å»ºå¥å£®çš„åˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºæœ¬æ„å»ºå—ä¹‹ä¸€ã€‚\nå®ç°åå‹é€šå¸¸æ¶‰åŠä»¥ä¸‹ä¸¤ç§æ–¹å¼ä¹‹ä¸€ï¼šè¦ä¹ˆå°†æ–°æ¶ˆæ¯ä¸¢å¼ƒï¼Œè¦ä¹ˆåœ¨èµ„æºå—é™æˆ–å‘ç”Ÿæ•…éšœæ—¶å°†é”™è¯¯è¿”å›ç»™ç”¨æˆ·ï¼ˆå¹¶åœ¨ä¸¤ç§æƒ…å†µä¸‹å¢åŠ æŒ‡æ ‡ï¼‰ã€‚å¯¹äºä¸å…¶ä»–ç³»ç»Ÿçš„è¿æ¥å’Œè¯·æ±‚ï¼Œè¶…æ—¶å’ŒæŒ‡æ•°é€€é¿ä¹Ÿæ˜¯è‡³å…³é‡è¦çš„ã€‚\nå¦‚æœæ²¡æœ‰åå‹æœºåˆ¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿçº§è”æ•…éšœæˆ–æ„å¤–æ¶ˆæ¯ä¸¢å¤±ã€‚å½“ä¸€ä¸ªç³»ç»Ÿæ— æ³•å¤„ç†å¦ä¸€ä¸ªç³»ç»Ÿçš„æ•…éšœæ—¶ï¼Œå®ƒå€¾å‘äºå°†æ•…éšœä¼ æ’­ç»™ä¾èµ–å®ƒçš„å¦ä¸€ä¸ªç³»ç»Ÿã€‚\nå¯»æ‰¾å®ç°éƒ¨åˆ†å¯ç”¨æ€§çš„æ–¹æ³•ã€‚ éƒ¨åˆ†å¯ç”¨æ€§æ˜¯æŒ‡å³ä½¿ç³»ç»Ÿçš„æŸäº›éƒ¨åˆ†å‘ç”Ÿæ•…éšœï¼Œä»èƒ½è¿”å›ä¸€äº›ç»“æœã€‚\næœç´¢æ˜¯ä¸€ä¸ªç†æƒ³çš„æ¡ˆä¾‹æ¥æ¢è®¨è¿™ä¸ªé—®é¢˜ã€‚æœç´¢ç³»ç»Ÿåœ¨ç»“æœè´¨é‡å’Œç”¨æˆ·ç­‰å¾…æ—¶é—´ä¹‹é—´è¿›è¡Œæƒè¡¡ã€‚ä¸€ä¸ªå…¸å‹çš„æœç´¢ç³»ç»Ÿä¼šè®¾ç½®ä¸€ä¸ªæ—¶é—´é™åˆ¶ï¼Œå¦‚æœåœ¨æœç´¢æ‰€æœ‰æ–‡æ¡£ä¹‹å‰è¶…è¿‡äº†æ—¶é—´é™åˆ¶ï¼Œå®ƒä¼šè¿”å›å·²ç»æ”¶é›†åˆ°çš„ç»“æœã€‚è¿™ä½¿å¾—æœç´¢åœ¨é¢å¯¹é—´æ­‡æ€§å‡é€Ÿå’Œé”™è¯¯æ—¶æ›´å®¹æ˜“æ‰©å±•ï¼Œå› ä¸ºè¿™äº›æ•…éšœè¢«è§†ä¸ºæ— æ³•æœç´¢æ‰€æœ‰æ–‡æ¡£çš„æƒ…å†µã€‚ç³»ç»Ÿå…è®¸è¿”å›éƒ¨åˆ†ç»“æœç»™ç”¨æˆ·ï¼Œå¹¶å¢åŠ äº†å…¶å¼¹æ€§ã€‚\nå†ä»¥Webåº”ç”¨ç¨‹åºä¸­çš„ç§å¯†æ¶ˆæ¯åŠŸèƒ½ä¸ºä¾‹ã€‚æ— è®ºä½ åšä»€ä¹ˆï¼Œç§å¯†æ¶ˆæ¯çš„å­˜å‚¨æœºå™¨éƒ½å¯èƒ½åŒæ—¶å®•æœºï¼Œç”¨æˆ·ä¼šæ³¨æ„åˆ°è¿™ä¸€ç‚¹ã€‚é‚£ä¹ˆåœ¨è¿™ä¸ªç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›å‡ºç°ä»€ä¹ˆæ ·çš„éƒ¨åˆ†æ•…éšœå‘¢ï¼Ÿ\nè¿™éœ€è¦ä¸€äº›æ€è€ƒã€‚ä¸€èˆ¬æ¥è¯´ï¼Œäººä»¬å¯¹äºæ— æ³•ä½¿ç”¨ç§å¯†æ¶ˆæ¯åŠŸèƒ½ï¼ˆæˆ–è®¸æ˜¯å…¶ä»–ä¸€äº›ç”¨æˆ·ä¹Ÿæ— æ³•ä½¿ç”¨ï¼‰ä¼šæ›´å®¹å¿ï¼Œè€Œå¯¹äºæ‰€æœ‰ç”¨æˆ·ä¸­æœ‰ä¸€äº›æ¶ˆæ¯ä¸¢å¤±åˆ™æ›´ä¸ºä¸æ»¡æ„ã€‚å¦‚æœæœåŠ¡è¿‡è½½æˆ–å…¶ä¸­ä¸€å°æœºå™¨æ•…éšœï¼Œåªè®©ä¸€å°éƒ¨åˆ†ç”¨æˆ·æ— æ³•ä½¿ç”¨æ¯”è®©æ›´å¤§æ¯”ä¾‹çš„ç”¨æˆ·ä¸¢å¤±æ•°æ®æ›´å¯å–ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬å¯èƒ½ä¸å¸Œæœ›ä¸€ä¸ªæ— å…³çš„åŠŸèƒ½ï¼ˆæ¯”å¦‚å…¬å…±å›¾ç‰‡ä¸Šä¼ ï¼‰å—åˆ°å½±å“ï¼Œåªå› ä¸ºç§å¯†æ¶ˆæ¯åŠŸèƒ½å‡ºç°é—®é¢˜ã€‚æˆ‘ä»¬æ„¿æ„ä»˜å‡ºå¤šå°‘åŠªåŠ›æ¥ä¿æŒè¿™äº›æ•…éšœåŸŸçš„ç‹¬ç«‹ï¼Ÿ\nèƒ½å¤Ÿåœ¨éƒ¨åˆ†å¯ç”¨æ€§ä¸­è¯†åˆ«è¿™äº›æƒè¡¡æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚\næŒ‡æ ‡æ˜¯å®Œæˆå·¥ä½œçš„å”¯ä¸€é€”å¾„ã€‚ å…¬å¼€æŒ‡æ ‡ï¼ˆå¦‚å»¶è¿Ÿç™¾åˆ†æ¯”ã€ç‰¹å®šæ“ä½œçš„è®¡æ•°å™¨å¢åŠ ã€å˜åŒ–é€Ÿç‡ç­‰ï¼‰æ˜¯å¼¥åˆæ‚¨å¯¹ç³»ç»Ÿåœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ‰€åšçš„å‡è®¾ä¸å®é™…æƒ…å†µä¹‹é—´å·®è·çš„å”¯ä¸€é€”å¾„ã€‚äº†è§£ç³»ç»Ÿåœ¨ç¬¬20å¤©çš„è¡Œä¸ºä¸ç¬¬15å¤©çš„è¡Œä¸ºæœ‰ä½•ä¸åŒï¼Œæ˜¯æˆåŠŸå·¥ç¨‹å’Œå¤±è´¥å·«æœ¯ä¹‹é—´çš„åŒºåˆ«ã€‚å½“ç„¶ï¼ŒæŒ‡æ ‡æ˜¯äº†è§£é—®é¢˜å’Œè¡Œä¸ºçš„å¿…è¦æ‰‹æ®µï¼Œä½†å¹¶ä¸è¶³ä»¥çŸ¥é“æ¥ä¸‹æ¥è¯¥åšä»€ä¹ˆã€‚\nç¨å¾®æä¸€ä¸‹æ—¥å¿—è®°å½•ã€‚æ—¥å¿—æ–‡ä»¶æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œä½†å®ƒä»¬å¾€å¾€ä¼šæ¬ºéª—äººã€‚ä¾‹å¦‚ï¼Œå¾ˆå¸¸è§çš„æƒ…å†µæ˜¯å‡ ä¸ªé”™è¯¯ç±»åˆ«çš„æ—¥å¿—è®°å½•å æ®äº†æ—¥å¿—æ–‡ä»¶çš„å¾ˆå¤§æ¯”ä¾‹ï¼Œä½†å®é™…ä¸Šåœ¨è¯·æ±‚ä¸­çš„æ¯”ä¾‹éå¸¸ä½ã€‚å› ä¸ºåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹è®°å½•æˆåŠŸæ˜¯å¤šä½™çš„ï¼ˆå¹¶ä¸”åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä¼šè€—å°½ç£ç›˜ç©ºé—´ï¼‰ï¼Œè€Œä¸”å·¥ç¨‹å¸ˆç»å¸¸é”™è¯¯åœ°çŒœæµ‹å“ªäº›é”™è¯¯ç±»åˆ«æ˜¯æœ‰ç”¨çš„ï¼Œæ‰€ä»¥æ—¥å¿—æ–‡ä»¶ä¸­å……æ–¥ç€å„ç§å¥‡æ€ªçš„ä¿¡æ¯ã€‚æœ€å¥½ä»¥ä¸€ç§å‡è®¾æœ‰äººä¼šé˜…è¯»æ—¥å¿—ä½†æ²¡æœ‰çœ‹è¿‡ä»£ç çš„æ–¹å¼è¿›è¡Œæ—¥å¿—è®°å½•ã€‚\næˆ‘è§è¿‡å¾ˆå¤šæ¬¡ç”±äºå¦ä¸€ä½å·¥ç¨‹å¸ˆï¼ˆæˆ–è€…æˆ‘è‡ªå·±ï¼‰è¿‡äºå¼ºè°ƒæ—¥å¿—ä¸­çš„ä¸€äº›å¥‡æ€ªç°è±¡è€Œå¯¼è‡´æ•…éšœå»¶é•¿ï¼Œè€Œæ²¡æœ‰å…ˆå°†å…¶ä¸æŒ‡æ ‡è¿›è¡Œå¯¹æ¯”ã€‚æˆ‘è¿˜è§è¿‡å¦ä¸€ä½å·¥ç¨‹å¸ˆï¼ˆæˆ–è€…æˆ‘è‡ªå·±ï¼‰ä»å°‘æ•°å‡ è¡Œæ—¥å¿—ä¸­æ¨æ–­å‡ºæ•´å¥—å¤±è´¥è¡Œä¸ºçš„æƒ…å†µã€‚ä½†è¯·æ³¨æ„ï¼ša) æˆ‘ä»¬ä¹‹æ‰€ä»¥è®°ä½è¿™äº›æˆåŠŸæ¡ˆä¾‹ï¼Œæ˜¯å› ä¸ºå®ƒä»¬éå¸¸ç½•è§ï¼›b) é™¤éæŒ‡æ ‡æˆ–å®éªŒè¯å®äº†æ•…äº‹ï¼Œå¦åˆ™ä½ å¹¶ä¸æ˜¯ç¦å°”æ‘©æ–¯ï¼ˆSherlockï¼‰ã€‚\nä½¿ç”¨ç™¾åˆ†ä½æ•°è€Œä¸æ˜¯å¹³å‡å€¼ã€‚ åœ¨ç»å¤§å¤šæ•°åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç™¾åˆ†ä½æ•°ï¼ˆ50thã€99thã€99.9thã€99.99thï¼‰æ¯”å¹³å‡å€¼æ›´å‡†ç¡®ã€æ›´æœ‰ä¿¡æ¯é‡ã€‚ä½¿ç”¨å¹³å‡å€¼å‡è®¾æ­£åœ¨è¯„ä¼°çš„æŒ‡æ ‡éµå¾ªæ­£æ€åˆ†å¸ƒæ›²çº¿ï¼Œä½†åœ¨å®è·µä¸­ï¼Œè¿™åªé€‚ç”¨äºå°‘æ•°å·¥ç¨‹å¸ˆå…³å¿ƒçš„æŒ‡æ ‡ã€‚ \u0026ldquo;å¹³å‡å»¶è¿Ÿ\u0026rdquo; æ˜¯ä¸€ä¸ªå¸¸è§çš„æŠ¥å‘ŠæŒ‡æ ‡ï¼Œä½†æˆ‘ä»æœªè§è¿‡ä¸€ä¸ªå»¶è¿Ÿéµå¾ªæ­£æ€åˆ†å¸ƒæ›²çº¿çš„åˆ†å¸ƒå¼ç³»ç»Ÿã€‚å¦‚æœæŒ‡æ ‡ä¸éµå¾ªæ­£æ€åˆ†å¸ƒæ›²çº¿ï¼Œå¹³å‡å€¼å°±æ²¡æœ‰æ„ä¹‰ï¼Œä¼šå¯¼è‡´é”™è¯¯çš„å†³ç­–å’Œç†è§£ã€‚é€šè¿‡ä½¿ç”¨ç™¾åˆ†ä½æ•°æ¥é¿å…è¿™ä¸ªé™·é˜±ã€‚é»˜è®¤ä½¿ç”¨ç™¾åˆ†ä½æ•°ï¼Œä½ å°†æ›´å¥½åœ°äº†è§£ç”¨æˆ·çœŸæ­£çœ‹å¾…ä½ çš„ç³»ç»Ÿçš„æ–¹å¼ã€‚\nå­¦ä¼šä¼°ç®—ä½ çš„å®¹é‡ã€‚ å› æ­¤ï¼Œä½ å°†ä¼šçŸ¥é“ä¸€å¤©æœ‰å¤šå°‘ç§’ã€‚çŸ¥é“ä½ éœ€è¦å¤šå°‘å°æœºå™¨æ¥æ‰§è¡Œä¸€ä¸ªä»»åŠ¡æ˜¯ä¸€ä¸ªæŒä¹…ç³»ç»Ÿå’Œä¸€ä¸ªåœ¨å·¥ä½œå¼€å§‹3ä¸ªæœˆåéœ€è¦è¢«æ›¿æ¢çš„ç³»ç»Ÿä¹‹é—´çš„åŒºåˆ«ã€‚æˆ–è€…æ›´ç³Ÿç³•çš„æ˜¯ï¼Œåœ¨ä½ å®Œæˆå°†å…¶æŠ•å…¥ç”Ÿäº§ä¹‹å‰å°±éœ€è¦è¢«æ›¿æ¢ã€‚\nä»¥æ¨æ–‡ä¸ºä¾‹ã€‚åœ¨ä¸€å°æ™®é€šçš„æœºå™¨ä¸Šï¼Œä½ å¯ä»¥å°†å¤šå°‘ä¸ªæ¨æ–‡IDå­˜æ”¾åœ¨å†…å­˜ä¸­? å—¯ï¼Œåˆ°2012å¹´åº•ï¼Œä¸€å°å…¸å‹çš„æœºå™¨æœ‰24 GBçš„å†…å­˜ï¼Œä½ éœ€è¦4-5 GBçš„å¼€é”€æ¥è¿è¡Œæ“ä½œç³»ç»Ÿï¼Œå¦å¤–è¿˜éœ€è¦è‡³å°‘å‡ ä¸ªGBæ¥å¤„ç†è¯·æ±‚ï¼Œè€Œä¸€ä¸ªæ¨æ–‡IDå ç”¨8ä¸ªå­—èŠ‚ã€‚è¿™æ˜¯ä½ å¯èƒ½ä¼šè¿›è¡Œçš„ç²—ç•¥è®¡ç®—ã€‚Jeff Deançš„ã€Šæ¯ä¸ªäººéƒ½åº”è¯¥çŸ¥é“çš„æ•°å­—ã€‹å¹»ç¯ç‰‡æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æœŸæœ›è®¾å®šå·¥å…·ã€‚\nç‰¹æ€§æ ‡å¿—ï¼ˆFeature flagsï¼‰æ˜¯åŸºç¡€è®¾æ–½æ¨å‡ºçš„æ–¹å¼ã€‚ ç‰¹æ€§æ ‡å¿—æ˜¯äº§å“å·¥ç¨‹å¸ˆåœ¨ç³»ç»Ÿä¸­æ¨å‡ºæ–°åŠŸèƒ½çš„å¸¸ç”¨æ–¹å¼ã€‚ç‰¹æ€§æ ‡å¿—é€šå¸¸ä¸å‰ç«¯A/Bæµ‹è¯•ç›¸å…³è”ï¼Œç”¨äºå‘éƒ¨åˆ†ç”¨æˆ·å±•ç¤ºæ–°çš„è®¾è®¡æˆ–åŠŸèƒ½ã€‚ä½†å®ƒä»¬ä¹Ÿæ˜¯æ›¿æ¢åŸºç¡€è®¾æ–½çš„å¼ºå¤§æ–¹å¼ã€‚\nå¾ˆå¤šé¡¹ç›®å› ä¸ºé€‰æ‹©äº†â€œå¤§åˆ‡æ¢â€æˆ–ä¸€ç³»åˆ—â€œå¤§åˆ‡æ¢â€ï¼Œç„¶åç”±äºå‘ç°äº†å¤ªæ™šçš„é”™è¯¯è€Œè¢«è¿«å›æ»šï¼Œä»è€Œå¯¼è‡´å¤±è´¥ã€‚é€šè¿‡ä½¿ç”¨ç‰¹æ€§æ ‡å¿—ï¼Œä½ å°†å¢å¼ºå¯¹é¡¹ç›®çš„ä¿¡å¿ƒå¹¶å‡è½»å¤±è´¥çš„æˆæœ¬ã€‚\nå‡è®¾ä½ è¦ä»å•ä¸€æ•°æ®åº“è¿ç§»åˆ°ä¸€ä¸ªéšè—äº†æ–°å­˜å‚¨è§£å†³æ–¹æ¡ˆç»†èŠ‚çš„æœåŠ¡ã€‚ä½¿ç”¨ç‰¹æ€§æ ‡å¿—ï¼Œä½ å¯ä»¥é€æ­¥å°†å†™æ“ä½œè½¬ç§»åˆ°æ–°æœåŠ¡ï¼Œä¸å¯¹æ—§æ•°æ®åº“çš„å†™æ“ä½œå¹¶è¡Œè¿›è¡Œï¼Œä»¥ç¡®ä¿å…¶å†™è·¯å¾„çš„æ­£ç¡®æ€§å’Œé€Ÿåº¦è¶³å¤Ÿå¿«ã€‚åœ¨å†™è·¯å¾„è¾¾åˆ°100%å¹¶å°†æ•°æ®å›å¡«åˆ°æœåŠ¡çš„æ•°æ®å­˜å‚¨å®Œæˆåï¼Œä½ å¯ä»¥ä½¿ç”¨å•ç‹¬çš„ç‰¹æ€§æ ‡å¿—å¼€å§‹ä»è¯¥æœåŠ¡è¯»å–ï¼Œè€Œä¸åœ¨ç”¨æˆ·å“åº”ä¸­ä½¿ç”¨è¯¥æ•°æ®ï¼Œä»¥æ£€æŸ¥æ€§èƒ½é—®é¢˜ã€‚å¦ä¸€ä¸ªç‰¹æ€§æ ‡å¿—å¯ä»¥ç”¨äºæ¯”è¾ƒä»æ—§ç³»ç»Ÿå’Œæ–°ç³»ç»Ÿè¯»å–çš„æ•°æ®ã€‚æœ€åä¸€ä¸ªæ ‡å¿—å¯ä»¥ç”¨äºé€æ­¥å¢åŠ ä»æ–°ç³»ç»Ÿè¿›è¡Œâ€œçœŸå®â€è¯»å–æ“ä½œã€‚\né€šè¿‡å°†éƒ¨ç½²æ‹†åˆ†ä¸ºå¤šä¸ªæ­¥éª¤ï¼Œå¹¶é€šè¿‡ç‰¹æ€§æ ‡å¿—æä¾›å¿«é€Ÿå’Œéƒ¨åˆ†ååº”ï¼Œä½ å¯ä»¥æ›´å®¹æ˜“åœ°åœ¨æ‰©å±•è¿‡ç¨‹ä¸­å‘ç°é”™è¯¯å’Œæ€§èƒ½é—®é¢˜ï¼Œè€Œä¸æ˜¯åœ¨â€œä¸€æ¬¡æ€§å‘å¸ƒâ€æ—¶å‘ç°ã€‚å¦‚æœå‡ºç°é—®é¢˜ï¼Œä½ åªéœ€ç«‹å³å°†ç‰¹æ€§æ ‡å¿—è®¾ç½®é™ä½åˆ°è¾ƒä½ï¼ˆå¯èƒ½æ˜¯é›¶ï¼‰çš„è®¾ç½®ã€‚é€šè¿‡è°ƒæ•´é€Ÿç‡ï¼Œä½ å¯ä»¥åœ¨ä¸åŒçš„æµé‡é‡çº§ä¸‹è¿›è¡Œè°ƒè¯•å’Œå®éªŒï¼ŒçŸ¥é“ä»»ä½•é—®é¢˜éƒ½ä¸ä¼šé€ æˆç¾éš¾ã€‚ä½¿ç”¨ç‰¹æ€§æ ‡å¿—ï¼Œä½ è¿˜å¯ä»¥é€‰æ‹©å…¶ä»–è¿ç§»ç­–ç•¥ï¼Œä¾‹å¦‚åŸºäºæ¯ä¸ªç”¨æˆ·çš„æ–¹å¼å°†è¯·æ±‚è½¬ç§»åˆ°æ–°ç³»ç»Ÿï¼Œä»¥æä¾›å¯¹æ–°ç³»ç»Ÿçš„æ›´å¥½æ´å¯Ÿã€‚å½“ä½ çš„æ–°æœåŠ¡ä»åœ¨åŸå‹é˜¶æ®µæ—¶ï¼Œä½ å¯ä»¥å°†ç‰¹æ€§æ ‡å¿—è®¾ç½®ä¸ºè¾ƒä½ï¼Œä»¥å‡å°‘æ–°ç³»ç»Ÿçš„èµ„æºæ¶ˆè€—ã€‚\nç°åœ¨ï¼Œç‰¹æ€§æ ‡å¿—å¯¹äºç»å…¸è®­ç»ƒçš„å¼€å‘äººå‘˜æˆ–æ–°å·¥ç¨‹å¸ˆæ¥è¯´å¯èƒ½å¬èµ·æ¥åƒæ˜¯ä¸€å †æ¡ä»¶è¯­å¥çš„å¯æ€•æ··ä¹±ã€‚è€Œä½¿ç”¨ç‰¹æ€§æ ‡å¿—æ„å‘³ç€æ¥å—å¤šä¸ªåŸºç¡€è®¾æ–½å’Œæ•°æ®ç‰ˆæœ¬æ˜¯ä¸€ç§å¸¸æ€ï¼Œè€Œä¸æ˜¯ç½•è§æƒ…å†µã€‚è¿™æ˜¯ä¸€ä¸ªæ·±åˆ»çš„æ•™è®­ã€‚åœ¨å•æœºç³»ç»Ÿä¸­æœ‰æ•ˆçš„æ–¹æ³•åœ¨é¢å¯¹åˆ†å¸ƒå¼é—®é¢˜æ—¶æœ‰æ—¶ä¼šå¤±è´¥ã€‚\nç‰¹æ€§æ ‡å¿—æœ€å¥½è¢«ç†è§£ä¸ºä¸€ç§æƒè¡¡ï¼Œä»¥åœ¨ä»£ç å’Œä¸€ä¸ªç³»ç»Ÿä¸­äº¤æ¢å±€éƒ¨å¤æ‚æ€§ï¼Œä»¥è·å¾—å…¨å±€çš„ç®€å•æ€§å’Œå¼¹æ€§ã€‚\n**æ˜æ™ºåœ°é€‰æ‹©IDç©ºé—´ã€‚ **ä½ ä¸ºç³»ç»Ÿé€‰æ‹©çš„IDç©ºé—´å°†å¡‘é€ ä½ çš„ç³»ç»Ÿã€‚\nè¦è·å–æ•°æ®æ‰€éœ€çš„IDæ•°é‡è¶Šå¤šï¼Œå°±è¶Šæœ‰é€‰æ‹©å°†æ•°æ®è¿›è¡Œåˆ†åŒºçš„é€‰é¡¹ã€‚è¦è·å–æ•°æ®æ‰€éœ€çš„IDæ•°é‡è¶Šå°‘ï¼Œæ¶ˆè´¹ä½ çš„ç³»ç»Ÿè¾“å‡ºå°±è¶Šå®¹æ˜“ã€‚\nä»¥Twitter APIçš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ä¸ºä¾‹ã€‚æ‰€æœ‰è·å–ã€åˆ›å»ºå’Œåˆ é™¤æ¨æ–‡çš„æ“ä½œéƒ½æ˜¯åŸºäºæ¯ä¸ªæ¨æ–‡çš„å•ä¸ªæ•°å­—IDè¿›è¡Œçš„ã€‚æ¨æ–‡IDæ˜¯ä¸€ä¸ªç®€å•çš„64ä½æ•°å­—ï¼Œä¸ä¸ä»»ä½•å…¶ä»–æ•°æ®ç›¸å…³è”ã€‚éšç€æ¨æ–‡æ•°é‡çš„å¢åŠ ï¼Œäººä»¬æ„è¯†åˆ°ï¼Œå¦‚æœå°†åŒä¸€ç”¨æˆ·çš„æ‰€æœ‰æ¨æ–‡å­˜å‚¨åœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œå¯ä»¥æœ‰æ•ˆåœ°æ„å»ºç”¨æˆ·çš„æ¨æ–‡æ—¶é—´çº¿å’Œå…¶ä»–ç”¨æˆ·è®¢é˜…çš„æ—¶é—´çº¿ã€‚\nä½†å…¬å…±APIè¦æ±‚æ¯ä¸ªæ¨æ–‡åªèƒ½é€šè¿‡æ¨æ–‡IDè¿›è¡Œè®¿é—®ã€‚è¦æŒ‰ç”¨æˆ·å¯¹æ¨æ–‡è¿›è¡Œåˆ†åŒºï¼Œéœ€è¦æ„å»ºä¸€ä¸ªæŸ¥æ‰¾æœåŠ¡ï¼Œå®ƒçŸ¥é“å“ªä¸ªç”¨æˆ·æ‹¥æœ‰å“ªä¸ªæ¨æ–‡IDã€‚å¦‚æœå¿…è¦ï¼Œè¿™æ˜¯å¯è¡Œçš„ï¼Œä½†æˆæœ¬ä¸å¯å¿½è§†ã€‚\nå¦ä¸€ç§é€‰æ‹©æ˜¯åœ¨ä»»ä½•æ¨æ–‡æŸ¥æ‰¾æ—¶è¦æ±‚ç”¨æˆ·IDï¼Œå¹¶ä¸”æœ€åˆåªæ˜¯ä½¿ç”¨æ¨æ–‡IDè¿›è¡Œå­˜å‚¨ï¼Œç›´åˆ°ç”¨æˆ·åˆ†åŒºå­˜å‚¨ä¸Šçº¿ã€‚å¦ä¸€ç§é€‰æ‹©æ˜¯åœ¨æ¨æ–‡IDæœ¬èº«ä¸­åŒ…å«ç”¨æˆ·IDï¼Œè¿™æ ·åšçš„ä»£ä»·æ˜¯æ¨æ–‡IDä¸å†å…·æœ‰k-sortableå’Œæ•°å­—çš„ç‰¹æ€§ã€‚\nè¦æ³¨æ„åœ¨IDä¸­æ˜ç¡®å’Œéšå«åœ°ç¼–ç äº†å“ªç§ç±»å‹çš„ä¿¡æ¯ã€‚å®¢æˆ·ç«¯å¯èƒ½åˆ©ç”¨IDçš„ç»“æ„æ¥å»åŒ¿ååŒ–ç§äººæ•°æ®ï¼Œä»¥æ„æƒ³ä¸åˆ°çš„æ–¹å¼çˆ¬å–ä½ çš„ç³»ç»Ÿï¼ˆè‡ªå¢IDé€šå¸¸æ˜¯ä¸€ä¸ªç—›ç‚¹ï¼‰ï¼Œæˆ–è¿›è¡Œå…¶ä»–ä¸€ç³»åˆ—æ”»å‡»ã€‚\nåˆ©ç”¨æ•°æ®å±€éƒ¨æ€§ã€‚ å°†æ•°æ®çš„å¤„ç†å’Œç¼“å­˜ä¸å…¶æŒä¹…å­˜å‚¨ä¿æŒé è¿‘ï¼Œå¤„ç†æ•ˆç‡æ›´é«˜ï¼ŒåŒæ—¶ä¿æŒç¼“å­˜ä¸€è‡´æ€§å’Œå¿«é€Ÿæ€§æ›´å®¹æ˜“ã€‚ä¸æŒ‡é’ˆè§£å¼•ç”¨å’Œfreadï¼ˆ3ï¼‰ç›¸æ¯”ï¼Œç½‘ç»œæ•…éšœå’Œå»¶è¿Ÿæ›´å¤šã€‚\nå½“ç„¶ï¼Œæ•°æ®å±€éƒ¨æ€§æ„å‘³ç€åœ¨ç©ºé—´ä¸Šé è¿‘ï¼Œä½†ä¹Ÿæ„å‘³ç€åœ¨æ—¶é—´ä¸Šé è¿‘ã€‚å¦‚æœå¤šä¸ªç”¨æˆ·å‡ ä¹åŒæ—¶è¿›è¡Œç›¸åŒçš„æ˜‚è´µè¯·æ±‚ï¼Œä¹Ÿè®¸å¯ä»¥å°†å®ƒä»¬çš„è¯·æ±‚åˆå¹¶ä¸ºä¸€ä¸ªè¯·æ±‚ã€‚å¦‚æœåœ¨ç›¸è¿‘çš„æ—¶é—´å†…å‘å‡ºäº†å¤šä¸ªç›¸åŒç±»å‹çš„æ•°æ®è¯·æ±‚ï¼Œå¯ä»¥å°†å®ƒä»¬åˆå¹¶ä¸ºä¸€ä¸ªæ›´å¤§çš„è¯·æ±‚ã€‚è¿™æ ·åšé€šå¸¸å¯ä»¥é™ä½é€šä¿¡å¼€é”€å¹¶æ›´å®¹æ˜“è¿›è¡Œæ•…éšœç®¡ç†ã€‚\n**å°†ç¼“å­˜æ•°æ®å†™å›æŒä¹…å­˜å‚¨æ˜¯ä¸å¥½çš„ã€‚ **è¿™ç§æƒ…å†µåœ¨æ¯”æƒ³è±¡ä¸­æ›´å¤šçš„ç³»ç»Ÿä¸­å‘ç”Ÿã€‚å°¤å…¶æ˜¯é‚£äº›æœ€åˆç”±ç¼ºä¹åˆ†å¸ƒå¼ç³»ç»Ÿç»éªŒçš„äººè®¾è®¡çš„ç³»ç»Ÿã€‚ä½ å°†ç»§æ‰¿è®¸å¤šå…·æœ‰æ­¤ç¼ºé™·çš„ç³»ç»Ÿã€‚å¦‚æœå®æ–½è€…è°ˆåˆ°â€œä¿„ç½—æ–¯å¥—å¨ƒç¼“å­˜â€ï¼Œä½ å¾ˆæœ‰å¯èƒ½é‡åˆ°éå¸¸æ˜æ˜¾çš„é”™è¯¯ã€‚è¿™ä¸ªæ¡ç›®æœ¬å¯ä»¥ä»åˆ—è¡¨ä¸­çœç•¥ï¼Œä½†æˆ‘å¯¹æ­¤ç‰¹åˆ«ç—›æ¨ã€‚è¿™ç§ç¼ºé™·çš„å¸¸è§è¡¨ç°æ˜¯ç”¨æˆ·ä¿¡æ¯ï¼ˆä¾‹å¦‚å±å¹•åç§°ã€ç”µå­é‚®ä»¶å’Œå“ˆå¸Œå¯†ç ï¼‰ç¥ç§˜åœ°æ¢å¤åˆ°å…ˆå‰çš„å€¼ã€‚\nè®¡ç®—æœºçš„èƒ½åŠ›è¶…ä¹ä½ çš„æƒ³è±¡ã€‚ ç°åœ¨çš„ç°åœºå­˜åœ¨å¾ˆå¤šå…³äºæœºå™¨èƒ½åŠ›çš„é”™è¯¯ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯æ¥è‡ªäºæ²¡æœ‰å¤ªå¤šç»éªŒçš„ä»ä¸šè€…ã€‚\nåœ¨2012å¹´åº•ï¼Œè½»å‹WebæœåŠ¡å™¨æ‹¥æœ‰6ä¸ªæˆ–æ›´å¤šå¤„ç†å™¨ï¼Œ24GBå†…å­˜å’Œæ¯”ä½ èƒ½ä½¿ç”¨çš„æ›´å¤šç£ç›˜ç©ºé—´ã€‚åœ¨ç°ä»£è¯­è¨€è¿è¡Œæ—¶ç¯å¢ƒä¸­ï¼Œä¸€ä¸ªç›¸å¯¹å¤æ‚çš„CRUDåº”ç”¨ç¨‹åºåœ¨å•ä¸ªæœºå™¨ä¸Šå¯ä»¥åœ¨å‡ ç™¾æ¯«ç§’å†…è½»æ¾å¤„ç†æ•°åƒä¸ªè¯·æ±‚æ¯ç§’ã€‚è¿™è¿˜åªæ˜¯ä¸‹é™ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ¯å°æœºå™¨æ¯ç§’å¤„ç†æ•°ç™¾ä¸ªè¯·æ±‚å¹¶ä¸å€¼å¾—å¤¸è€€ã€‚\nè·å¾—æ›´é«˜çš„æ€§èƒ½å¹¶ä¸éš¾ï¼Œå°¤å…¶æ˜¯å¦‚æœä½ æ„¿æ„å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œæ€§èƒ½åˆ†æï¼Œå¹¶æ ¹æ®æµ‹é‡ç»“æœå¼•å…¥æ•ˆç‡ã€‚\n**åˆ©ç”¨CAPå®šç†å¯¹ç³»ç»Ÿè¿›è¡Œæ‰¹åˆ¤ã€‚ **CAPå®šç†ä¸èƒ½ç”¨ä½œæ„å»ºç³»ç»Ÿçš„åŸºç¡€ã€‚å®ƒä¸æ˜¯ä¸€ä¸ªå¯ä»¥ä½œä¸ºç¬¬ä¸€åŸåˆ™å¹¶ä»ä¸­æ¨å¯¼å‡ºä¸€ä¸ªå¯è¡Œç³»ç»Ÿçš„å®šç†ã€‚å®ƒçš„é€‚ç”¨èŒƒå›´è¿‡äºå¹¿æ³›ï¼Œå¯èƒ½çš„è§£å†³æ–¹æ¡ˆç©ºé—´ä¹Ÿè¿‡äºå®½æ³›ã€‚\nç„¶è€Œï¼ŒCAPå®šç†éå¸¸é€‚åˆç”¨äºå¯¹åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡è¿›è¡Œæ‰¹åˆ¤ï¼Œå¹¶ç†è§£éœ€è¦åšå‡ºçš„æƒè¡¡ã€‚é€šè¿‡å¯¹ç³»ç»Ÿè®¾è®¡è¿›è¡Œè¿­ä»£ï¼Œè€ƒè™‘CAPå¯¹å…¶å­ç³»ç»Ÿæ–½åŠ çš„çº¦æŸï¼Œæœ€ç»ˆå¯ä»¥å¾—åˆ°æ›´å¥½çš„è®¾è®¡ã€‚ä½œä¸šä¸­ï¼Œå°†CAPå®šç†çš„çº¦æŸåº”ç”¨äºä¿„ç½—æ–¯å¥—å¨ƒç¼“å­˜çš„å®é™…å®ç°ã€‚\næœ€åéœ€è¦æ³¨æ„çš„æ˜¯ï¼šåœ¨ä¸€è‡´æ€§ï¼ˆCï¼‰ã€å¯ç”¨æ€§ï¼ˆAï¼‰å’Œåˆ†åŒºå®¹å¿æ€§ï¼ˆPï¼‰ä¸­ï¼Œä¸èƒ½é€‰æ‹©CAã€‚\n**æå–æœåŠ¡ã€‚ **è¿™é‡Œçš„\u0026quot;æœåŠ¡\u0026quot;æŒ‡çš„æ˜¯\u0026quot;ä¸€ä¸ªåŒ…å«é«˜çº§é€»è¾‘çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œé€šå¸¸å…·æœ‰è¯·æ±‚-å“åº”å¼çš„API\u0026quot;ã€‚è¦ç•™æ„é‚£äº›å¦‚æœå­˜åœ¨äºä¸€ä¸ªå•ç‹¬çš„æœåŠ¡ä¸­è€Œä¸æ˜¯ä½ çš„ç³»ç»Ÿä¸­ï¼Œå°†æ›´å®¹æ˜“è¿›è¡Œçš„ä»£ç æ›´æ”¹ã€‚\næå–å‡ºä¸€ä¸ªæœåŠ¡æä¾›äº†å°è£…çš„å¥½å¤„ï¼Œé€šå¸¸ä¸åˆ›å»ºåº“ç›¸æå¹¶è®ºã€‚ç„¶è€Œï¼Œæå–å‡ºä¸€ä¸ªæœåŠ¡æ”¹è¿›äº†åˆ›å»ºåº“çš„æ–¹å¼ï¼Œå› ä¸ºå®ƒå…è®¸æ›´å¿«ã€æ›´å®¹æ˜“åœ°éƒ¨ç½²å˜æ›´ï¼Œè€Œä¸åƒå‡çº§å®¢æˆ·ç³»ç»Ÿä¸­çš„åº“é‚£æ ·éº»çƒ¦ã€‚ï¼ˆå½“ç„¶ï¼Œå¦‚æœæå–å‡ºçš„æœåŠ¡éš¾ä»¥éƒ¨ç½²ï¼Œé‚£ä¹ˆå®¢æˆ·ç³»ç»Ÿå°†å˜å¾—æ›´å®¹æ˜“éƒ¨ç½²ã€‚ï¼‰è¿™ç§ä¾¿åˆ©æ˜¯ç”±äºè¾ƒå°ã€æå–å‡ºçš„æœåŠ¡ä¸­çš„ä»£ç å’Œæ“ä½œä¾èµ–è¾ƒå°‘ï¼Œå¹¶ä¸”å…¶åˆ›å»ºçš„ä¸¥æ ¼è¾¹ç•Œä½¿å¾—å¾ˆéš¾\u0026quot;èµ°æ·å¾„\u0026quot;ï¼Œè€Œåº“åˆ™å…è®¸è¿™ç§èµ°æ·å¾„ã€‚è¿™äº›èµ°æ·å¾„é€šå¸¸ä¼šä½¿è¿ç§»å†…éƒ¨æˆ–å®¢æˆ·ç³»ç»Ÿåˆ°æ–°ç‰ˆæœ¬å˜å¾—æ›´åŠ å›°éš¾ã€‚\nå½“å­˜åœ¨å¤šä¸ªå®¢æˆ·ç³»ç»Ÿæ—¶ï¼Œä½¿ç”¨æœåŠ¡çš„åè°ƒæˆæœ¬ä¹Ÿæ¯”ä½¿ç”¨å…±äº«åº“è¦ä½å¾—å¤šã€‚å³ä½¿ä¸éœ€è¦è¿›è¡ŒAPIæ›´æ”¹ï¼Œå‡çº§åº“ä¹Ÿéœ€è¦åè°ƒæ¯ä¸ªå®¢æˆ·ç³»ç»Ÿçš„éƒ¨ç½²ã€‚å¦‚æœéƒ¨ç½²æ¬¡åºé¢ å€’ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®æŸåï¼ˆè€Œä¸”å¾ˆéš¾é¢„æµ‹è¿™ç§æƒ…å†µï¼‰ï¼Œè¿™ä½¿å¾—å‡çº§åº“å˜å¾—æ›´åŠ å›°éš¾ã€‚å¦‚æœå®¢æˆ·ç³»ç»Ÿç”±ä¸åŒçš„ç»´æŠ¤è€…è´Ÿè´£ï¼Œå‡çº§åº“çš„ç¤¾äº¤åè°ƒæˆæœ¬ä¹Ÿæ¯”éƒ¨ç½²æœåŠ¡æ›´é«˜ã€‚è®©å…¶ä»–äººæ„è¯†åˆ°å¹¶æ„¿æ„å‡çº§æ˜¯éå¸¸å›°éš¾çš„ï¼Œå› ä¸ºä»–ä»¬çš„ä¼˜å…ˆäº‹é¡¹å¯èƒ½ä¸ä½ çš„ä¸ä¸€è‡´ã€‚\nå…¸å‹çš„æœåŠ¡ä½¿ç”¨æ¡ˆä¾‹æ˜¯éšè—ä¸€ä¸ªå°†è¦è¿›è¡Œå˜æ›´çš„å­˜å‚¨å±‚ã€‚æå–å‡ºçš„æœåŠ¡å…·æœ‰æ›´æ–¹ä¾¿ä¸”è¡¨é¢ç§¯æ›´å°çš„APIï¼Œä¸å…¶å‰ç«¯çš„å­˜å‚¨å±‚ç›¸æ¯”ã€‚é€šè¿‡æå–æœåŠ¡ï¼Œå®¢æˆ·ç³»ç»Ÿæ— éœ€äº†è§£è¿ç§»åˆ°æ–°çš„å­˜å‚¨ç³»ç»Ÿæˆ–æ ¼å¼çš„å¤æ‚æ€§ï¼Œåªéœ€è¦è¯„ä¼°æ–°æœåŠ¡ä¸­è‚¯å®šä¼šå‘ç°çš„ä¸æ–°å­˜å‚¨å¸ƒå±€ç›¸å…³çš„é”™è¯¯ã€‚\nåœ¨æ‰§è¡Œæ­¤æ“ä½œæ—¶ï¼Œéœ€è¦è€ƒè™‘è®¸å¤šæ“ä½œå’Œç¤¾äº¤é—®é¢˜ã€‚åœ¨è¿™é‡Œæ— æ³•å¯¹å®ƒä»¬è¿›è¡Œå……åˆ†é˜è¿°ã€‚éœ€è¦æ’°å†™å¦ä¸€ç¯‡æ–‡ç« å¯¹æ­¤è¿›è¡Œè¯¦ç»†è¯´æ˜ã€‚\næˆ‘å¯¹æˆ‘çš„å®¡ç¨¿äººBill de hÃ“raã€Coda Haleã€JD Maturenã€Micaela McDonaldå’ŒTed Nymanè¡¨ç¤ºè¡·å¿ƒæ„Ÿè°¢ã€‚ä½ ä»¬çš„è§è§£å’Œå…³å¿ƒæ˜¯æ— ä»·çš„ã€‚","title":"[è¯‘]ç»™å¹´è½»çš„å·¥ç¨‹å¸ˆä»¬çš„å…³äºåˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€äº›ç¬”è®°"},{"content":" ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹æ˜¯ä¸€æœ¬å¹¿å—æ¬¢è¿çš„èµ„æºï¼Œç”¨äºç†è§£å’Œå­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿã€‚è¯¥ä¹¦ç”±ä½œè€…Mikito Takadaæ’°å†™ï¼Œä»‹ç»äº†æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºæœ¬æ¦‚å¿µã€åŸåˆ™å’ŒæŒ‘æˆ˜ã€‚\nè¿™æœ¬ä¹¦æ¶µç›–äº†ä¸åˆ†å¸ƒå¼ç³»ç»Ÿç›¸å…³çš„å¹¿æ³›ä¸»é¢˜ï¼ŒåŒ…æ‹¬ç½‘ç»œã€å®¹é”™æ€§ã€ä¸€è‡´æ€§æ¨¡å‹ã€åˆ†å¸ƒå¼ç®—æ³•ã€å¯æ‰©å±•æ€§ç­‰ç­‰ã€‚å®ƒæ—¨åœ¨ä»¥æ¸…æ™°æ˜“æ‡‚çš„æ–¹å¼è§£é‡Šå¤æ‚çš„æ¦‚å¿µï¼Œé€‚åˆåˆå­¦è€…å’Œæœ‰ç»éªŒçš„åˆ†å¸ƒå¼ç³»ç»Ÿä»ä¸šè€…é˜…è¯»ã€‚\nåœ¨æ•´æœ¬ä¹¦ä¸­ï¼Œä½œè€…æä¾›äº†å„ç§å®é™…æ¡ˆä¾‹å’Œæ¡ˆä¾‹ç ”ç©¶ï¼Œä»¥è¯´æ˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®é™…åº”ç”¨å’Œå®è·µæ–¹é¢ã€‚å®ƒè¿˜å¼ºè°ƒäº†æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿæ¶‰åŠçš„æƒè¡¡å’Œè®¾è®¡è€ƒè™‘ï¼Œå¸®åŠ©è¯»è€…å…¨é¢ç†è§£è¿™ä¸ªä¸»é¢˜ã€‚\nã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹ä½œä¸ºå¼€æºèµ„æºï¼Œå¯ä»¥å…è´¹åœ¨çº¿è·å–ï¼Œéå¸¸é€‚åˆä»»ä½•å¯¹å­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿæ„Ÿå…´è¶£çš„äººã€‚\nåŸæ–‡é“¾æ¥ï¼šDistributed systems: for fun and profit\n6. è¿›ä¸€æ­¥é˜…è¯»å’Œé™„å½• å¦‚æœæ‚¨å·²ç»åšåˆ°äº†è¿™ä¸€ç‚¹ï¼Œè°¢è°¢æ‚¨ã€‚\nå¦‚æœæ‚¨å–œæ¬¢è¿™æœ¬ä¹¦ï¼Œè¯·åœ¨ Githubï¼ˆæˆ– Twitterï¼‰ä¸Šå…³æ³¨æˆ‘ã€‚æˆ‘å¾ˆé«˜å…´çœ‹åˆ°æˆ‘äº§ç”Ÿäº†æŸç§ç§¯æçš„å½±å“ã€‚ â€œåˆ›é€ çš„ä»·å€¼æ¯”ä½ è·å–çš„ä»·å€¼æ›´å¤šâ€ç­‰ç­‰ã€‚\néå¸¸æ„Ÿè°¢ï¼šlogpathã€alexrasã€globalcitizenã€graueã€franksheararã€roryokaneã€jpfuentes2ã€eerorã€cmeiklejohnã€stevenproctor eos2102 å’Œ steveloughran çš„å¸®åŠ©ï¼å½“ç„¶ï¼Œä»»ä½•é”™è¯¯å’Œé—æ¼éƒ½æ˜¯æˆ‘çš„é”™ï¼\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘å…³äºæœ€ç»ˆä¸€è‡´æ€§çš„ç« èŠ‚ç›¸å½“ä»¥ä¼¯å…‹åˆ©ä¸ºä¸­å¿ƒï¼›æˆ‘æƒ³æ”¹å˜è¿™ä¸€ç‚¹ã€‚æˆ‘è¿˜è·³è¿‡äº†ä¸€ä¸ªé‡è¦çš„æ—¶é—´ç”¨ä¾‹ï¼šä¸€è‡´çš„å¿«ç…§ã€‚æˆ‘è¿˜åº”è¯¥æ‰©å±•å‡ ä¸ªä¸»é¢˜ï¼šå³ï¼Œå¯¹å®‰å…¨æ€§å’Œæ´»æ€§å±æ€§çš„æ˜ç¡®è®¨è®ºä»¥åŠå¯¹ä¸€è‡´æ€§å“ˆå¸Œçš„æ›´è¯¦ç»†è®¨è®ºã€‚ä¸è¿‡ï¼Œæˆ‘è¦å»ã€ŠStrange Loop 2013ã€‹äº†ï¼Œæ‰€ä»¥æ— è®ºå¦‚ä½•ã€‚\nå¦‚æœè¿™æœ¬ä¹¦æœ‰ç¬¬å…­ç« ï¼Œå®ƒå¯èƒ½æ˜¯å…³äºå¦‚ä½•åˆ©ç”¨å’Œå¤„ç†å¤§é‡æ•°æ®çš„ã€‚ä¼¼ä¹æœ€å¸¸è§çš„â€œå¤§æ•°æ®â€è®¡ç®—ç±»å‹æ˜¯é€šè¿‡å•ä¸ªç®€å•ç¨‹åºä¼ é€’å¤§å‹æ•°æ®é›†çš„è®¡ç®—ã€‚æˆ‘ä¸ç¡®å®šåç»­ç« èŠ‚ä¼šæ˜¯ä»€ä¹ˆï¼ˆä¹Ÿè®¸æ˜¯é«˜æ€§èƒ½è®¡ç®—ï¼Œå› ä¸ºå½“å‰çš„é‡ç‚¹æ˜¯å¯è¡Œæ€§ï¼‰ï¼Œä½†æˆ‘å¯èƒ½ä¼šåœ¨å‡ å¹´åçŸ¥é“ã€‚\næœ‰å…³åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¹¦ç± Distributed Algorithms (Lynch) è¿™å¯èƒ½æ˜¯æœ€å¸¸æ¨èçš„åˆ†å¸ƒå¼ç®—æ³•ä¹¦ç±ã€‚æˆ‘ä¹Ÿæ¨èå®ƒï¼Œä½†æœ‰ä¸€ä¸ªè­¦å‘Šã€‚å®ƒéå¸¸å…¨é¢ï¼Œä½†æ˜¯æ˜¯ä¸ºç ”ç©¶ç”Ÿè¯»è€…ç¼–å†™çš„ï¼Œå› æ­¤åœ¨äº†è§£ä»ä¸šè€…æœ€æ„Ÿå…´è¶£çš„å†…å®¹ä¹‹å‰ï¼Œæ‚¨å°†èŠ±è´¹å¤§é‡æ—¶é—´é˜…è¯»åŒæ­¥ç³»ç»Ÿå’Œå…±äº«å†…å­˜ç®—æ³•ã€‚\nIntroduction to Reliable and Secure Distributed Programming (Cachin, Guerraoui \u0026amp; Rodrigues) å¯¹äºä¸€ä¸ªä¿®ç‚¼è€…æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä»¶æœ‰è¶£çš„äº‹ã€‚å®ƒå¾ˆçŸ­å¹¶ä¸”å……æ»¡äº†å®é™…çš„ç®—æ³•å®ç°ã€‚\nReplication: Theory and Practice å¦‚æœæ‚¨å¯¹å¤åˆ¶æ„Ÿå…´è¶£ï¼Œè¿™æœ¬ä¹¦éå¸¸æ£’ã€‚å…³äºå¤åˆ¶çš„ç« èŠ‚ä¸»è¦åŸºäºå¯¹æœ¬ä¹¦æœ‰è¶£éƒ¨åˆ†ä»¥åŠæœ€è¿‘é˜…è¯»çš„å†…å®¹çš„ç»¼åˆã€‚\nDistributed Systems: An Algorithmic Approach (Ghosh) Introduction to Distributed Algorithms (Tel) Transactional Information Systems: Theory, Algorithms, and the Practice of Concurrency Control and Recovery (Weikum \u0026amp; Vossen) æœ¬ä¹¦ä»‹ç»çš„æ˜¯ä¼ ç»Ÿçš„äº¤æ˜“ä¿¡æ¯ç³»ç»Ÿï¼Œä¾‹å¦‚ï¼šæœ¬åœ° RDBMSã€‚æœ€åæœ‰ä¸¤ç« ä»‹ç»åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä½†æœ¬ä¹¦çš„é‡ç‚¹æ˜¯äº‹åŠ¡å¤„ç†ã€‚\nTransaction Processing: Concepts and Techniques by Gray and Reuter ç»å…¸ä¹‹ä½œã€‚æˆ‘å‘ç° Weikum \u0026amp; Vossen æ›´æ›´æ–°ã€‚\nå¼€åˆ›æ€§è®ºæ–‡ æ¯å¹´ï¼ŒEdsger W. Dijkstra åˆ†å¸ƒå¼è®¡ç®—å¥–éƒ½ä¼šé¢å‘ç»™æœ‰å…³åˆ†å¸ƒå¼è®¡ç®—åŸç†çš„æ°å‡ºè®ºæ–‡ã€‚æŸ¥çœ‹å®Œæ•´åˆ—è¡¨çš„é“¾æ¥ï¼Œå…¶ä¸­åŒ…æ‹¬ç»å…¸å†…å®¹ï¼Œä¾‹å¦‚ï¼š\n\u0026ldquo;Time, Clocks and Ordering of Events in a Distributed System\u0026rdquo; - Leslie Lamport \u0026ldquo;Impossibility of Distributed Consensus With One Faulty Process\u0026rdquo; - Fisher, Lynch, Patterson \u0026ldquo;Unreliable failure detectors and reliable distributed systems\u0026rdquo; - Chandra and Toueg Microsoft å­¦æœ¯æœç´¢æœ‰ä¸€ä¸ªåˆ†å¸ƒå¼å’Œå¹¶è¡Œè®¡ç®—é¢†åŸŸçš„é¡¶çº§å‡ºç‰ˆç‰©åˆ—è¡¨ï¼ŒæŒ‰å¼•ç”¨æ¬¡æ•°æ’åº - è¿™å¯èƒ½æ˜¯ä¸€ä¸ªæœ‰è¶£çš„åˆ—è¡¨ï¼Œå¯ä»¥æµè§ˆæ›´å¤šç»å…¸è‘—ä½œã€‚\nä»¥ä¸‹æ˜¯ä¸€äº›é¢å¤–çš„æ¨èè®ºæ–‡åˆ—è¡¨ï¼š\nNancy Lynch\u0026rsquo;s recommended reading list from her course on Distributed systems. NoSQL Summer paper list - a curated list of papers related to this buzzword. A Quora question on seminal papers in distributed systems. ç³»ç»Ÿ The Google File System - Ghemawat, Gobioff and Leung MapReduce: Simplified Data Processing on Large Clusters - Dean and Ghemawat Dynamo: Amazonâ€™s Highly Available Key-value Store - DeCandia et al. Bigtable: A Distributed Storage System for Structured Data - Chang et al. The Chubby Lock Service for Loosely-Coupled Distributed Systems - Burrows ZooKeeper: Wait-free coordination for Internet-scale systems - Hunt, Konar, Junqueira, Reed, 2010 ","permalink":"https://blog.chensoul.cc/posts/2023/11/10/distributed-systems-06/","summary":"ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹æ˜¯ä¸€æœ¬å¹¿å—æ¬¢è¿çš„èµ„æºï¼Œç”¨äºç†è§£å’Œå­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿã€‚è¯¥ä¹¦ç”±ä½œè€…Mikito Takadaæ’°å†™ï¼Œä»‹ç»äº†æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºæœ¬æ¦‚å¿µã€åŸåˆ™å’ŒæŒ‘æˆ˜ã€‚\nè¿™æœ¬ä¹¦æ¶µç›–äº†ä¸åˆ†å¸ƒå¼ç³»ç»Ÿç›¸å…³çš„å¹¿æ³›ä¸»é¢˜ï¼ŒåŒ…æ‹¬ç½‘ç»œã€å®¹é”™æ€§ã€ä¸€è‡´æ€§æ¨¡å‹ã€åˆ†å¸ƒå¼ç®—æ³•ã€å¯æ‰©å±•æ€§ç­‰ç­‰ã€‚å®ƒæ—¨åœ¨ä»¥æ¸…æ™°æ˜“æ‡‚çš„æ–¹å¼è§£é‡Šå¤æ‚çš„æ¦‚å¿µï¼Œé€‚åˆåˆå­¦è€…å’Œæœ‰ç»éªŒçš„åˆ†å¸ƒå¼ç³»ç»Ÿä»ä¸šè€…é˜…è¯»ã€‚\nåœ¨æ•´æœ¬ä¹¦ä¸­ï¼Œä½œè€…æä¾›äº†å„ç§å®é™…æ¡ˆä¾‹å’Œæ¡ˆä¾‹ç ”ç©¶ï¼Œä»¥è¯´æ˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®é™…åº”ç”¨å’Œå®è·µæ–¹é¢ã€‚å®ƒè¿˜å¼ºè°ƒäº†æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿæ¶‰åŠçš„æƒè¡¡å’Œè®¾è®¡è€ƒè™‘ï¼Œå¸®åŠ©è¯»è€…å…¨é¢ç†è§£è¿™ä¸ªä¸»é¢˜ã€‚\nã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹ä½œä¸ºå¼€æºèµ„æºï¼Œå¯ä»¥å…è´¹åœ¨çº¿è·å–ï¼Œéå¸¸é€‚åˆä»»ä½•å¯¹å­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿæ„Ÿå…´è¶£çš„äººã€‚\nåŸæ–‡é“¾æ¥ï¼šDistributed systems: for fun and profit\n6. è¿›ä¸€æ­¥é˜…è¯»å’Œé™„å½• å¦‚æœæ‚¨å·²ç»åšåˆ°äº†è¿™ä¸€ç‚¹ï¼Œè°¢è°¢æ‚¨ã€‚\nå¦‚æœæ‚¨å–œæ¬¢è¿™æœ¬ä¹¦ï¼Œè¯·åœ¨ Githubï¼ˆæˆ– Twitterï¼‰ä¸Šå…³æ³¨æˆ‘ã€‚æˆ‘å¾ˆé«˜å…´çœ‹åˆ°æˆ‘äº§ç”Ÿäº†æŸç§ç§¯æçš„å½±å“ã€‚ â€œåˆ›é€ çš„ä»·å€¼æ¯”ä½ è·å–çš„ä»·å€¼æ›´å¤šâ€ç­‰ç­‰ã€‚\néå¸¸æ„Ÿè°¢ï¼šlogpathã€alexrasã€globalcitizenã€graueã€franksheararã€roryokaneã€jpfuentes2ã€eerorã€cmeiklejohnã€stevenproctor eos2102 å’Œ steveloughran çš„å¸®åŠ©ï¼å½“ç„¶ï¼Œä»»ä½•é”™è¯¯å’Œé—æ¼éƒ½æ˜¯æˆ‘çš„é”™ï¼\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘å…³äºæœ€ç»ˆä¸€è‡´æ€§çš„ç« èŠ‚ç›¸å½“ä»¥ä¼¯å…‹åˆ©ä¸ºä¸­å¿ƒï¼›æˆ‘æƒ³æ”¹å˜è¿™ä¸€ç‚¹ã€‚æˆ‘è¿˜è·³è¿‡äº†ä¸€ä¸ªé‡è¦çš„æ—¶é—´ç”¨ä¾‹ï¼šä¸€è‡´çš„å¿«ç…§ã€‚æˆ‘è¿˜åº”è¯¥æ‰©å±•å‡ ä¸ªä¸»é¢˜ï¼šå³ï¼Œå¯¹å®‰å…¨æ€§å’Œæ´»æ€§å±æ€§çš„æ˜ç¡®è®¨è®ºä»¥åŠå¯¹ä¸€è‡´æ€§å“ˆå¸Œçš„æ›´è¯¦ç»†è®¨è®ºã€‚ä¸è¿‡ï¼Œæˆ‘è¦å»ã€ŠStrange Loop 2013ã€‹äº†ï¼Œæ‰€ä»¥æ— è®ºå¦‚ä½•ã€‚\nå¦‚æœè¿™æœ¬ä¹¦æœ‰ç¬¬å…­ç« ï¼Œå®ƒå¯èƒ½æ˜¯å…³äºå¦‚ä½•åˆ©ç”¨å’Œå¤„ç†å¤§é‡æ•°æ®çš„ã€‚ä¼¼ä¹æœ€å¸¸è§çš„â€œå¤§æ•°æ®â€è®¡ç®—ç±»å‹æ˜¯é€šè¿‡å•ä¸ªç®€å•ç¨‹åºä¼ é€’å¤§å‹æ•°æ®é›†çš„è®¡ç®—ã€‚æˆ‘ä¸ç¡®å®šåç»­ç« èŠ‚ä¼šæ˜¯ä»€ä¹ˆï¼ˆä¹Ÿè®¸æ˜¯é«˜æ€§èƒ½è®¡ç®—ï¼Œå› ä¸ºå½“å‰çš„é‡ç‚¹æ˜¯å¯è¡Œæ€§ï¼‰ï¼Œä½†æˆ‘å¯èƒ½ä¼šåœ¨å‡ å¹´åçŸ¥é“ã€‚\næœ‰å…³åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¹¦ç± Distributed Algorithms (Lynch) è¿™å¯èƒ½æ˜¯æœ€å¸¸æ¨èçš„åˆ†å¸ƒå¼ç®—æ³•ä¹¦ç±ã€‚æˆ‘ä¹Ÿæ¨èå®ƒï¼Œä½†æœ‰ä¸€ä¸ªè­¦å‘Šã€‚å®ƒéå¸¸å…¨é¢ï¼Œä½†æ˜¯æ˜¯ä¸ºç ”ç©¶ç”Ÿè¯»è€…ç¼–å†™çš„ï¼Œå› æ­¤åœ¨äº†è§£ä»ä¸šè€…æœ€æ„Ÿå…´è¶£çš„å†…å®¹ä¹‹å‰ï¼Œæ‚¨å°†èŠ±è´¹å¤§é‡æ—¶é—´é˜…è¯»åŒæ­¥ç³»ç»Ÿå’Œå…±äº«å†…å­˜ç®—æ³•ã€‚\nIntroduction to Reliable and Secure Distributed Programming (Cachin, Guerraoui \u0026amp; Rodrigues) å¯¹äºä¸€ä¸ªä¿®ç‚¼è€…æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä»¶æœ‰è¶£çš„äº‹ã€‚å®ƒå¾ˆçŸ­å¹¶ä¸”å……æ»¡äº†å®é™…çš„ç®—æ³•å®ç°ã€‚\nReplication: Theory and Practice å¦‚æœæ‚¨å¯¹å¤åˆ¶æ„Ÿå…´è¶£ï¼Œè¿™æœ¬ä¹¦éå¸¸æ£’ã€‚å…³äºå¤åˆ¶çš„ç« èŠ‚ä¸»è¦åŸºäºå¯¹æœ¬ä¹¦æœ‰è¶£éƒ¨åˆ†ä»¥åŠæœ€è¿‘é˜…è¯»çš„å†…å®¹çš„ç»¼åˆã€‚\nDistributed Systems: An Algorithmic Approach (Ghosh) Introduction to Distributed Algorithms (Tel) Transactional Information Systems: Theory, Algorithms, and the Practice of Concurrency Control and Recovery (Weikum \u0026amp; Vossen) æœ¬ä¹¦ä»‹ç»çš„æ˜¯ä¼ ç»Ÿçš„äº¤æ˜“ä¿¡æ¯ç³»ç»Ÿï¼Œä¾‹å¦‚ï¼šæœ¬åœ° RDBMSã€‚æœ€åæœ‰ä¸¤ç« ä»‹ç»åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œä½†æœ¬ä¹¦çš„é‡ç‚¹æ˜¯äº‹åŠ¡å¤„ç†ã€‚\nTransaction Processing: Concepts and Techniques by Gray and Reuter ç»å…¸ä¹‹ä½œã€‚æˆ‘å‘ç° Weikum \u0026amp; Vossen æ›´æ›´æ–°ã€‚\nå¼€åˆ›æ€§è®ºæ–‡ æ¯å¹´ï¼ŒEdsger W. Dijkstra åˆ†å¸ƒå¼è®¡ç®—å¥–éƒ½ä¼šé¢å‘ç»™æœ‰å…³åˆ†å¸ƒå¼è®¡ç®—åŸç†çš„æ°å‡ºè®ºæ–‡ã€‚æŸ¥çœ‹å®Œæ•´åˆ—è¡¨çš„é“¾æ¥ï¼Œå…¶ä¸­åŒ…æ‹¬ç»å…¸å†…å®¹ï¼Œä¾‹å¦‚ï¼š\n\u0026ldquo;Time, Clocks and Ordering of Events in a Distributed System\u0026rdquo; - Leslie Lamport \u0026ldquo;Impossibility of Distributed Consensus With One Faulty Process\u0026rdquo; - Fisher, Lynch, Patterson \u0026ldquo;Unreliable failure detectors and reliable distributed systems\u0026rdquo; - Chandra and Toueg Microsoft å­¦æœ¯æœç´¢æœ‰ä¸€ä¸ªåˆ†å¸ƒå¼å’Œå¹¶è¡Œè®¡ç®—é¢†åŸŸçš„é¡¶çº§å‡ºç‰ˆç‰©åˆ—è¡¨ï¼ŒæŒ‰å¼•ç”¨æ¬¡æ•°æ’åº - è¿™å¯èƒ½æ˜¯ä¸€ä¸ªæœ‰è¶£çš„åˆ—è¡¨ï¼Œå¯ä»¥æµè§ˆæ›´å¤šç»å…¸è‘—ä½œã€‚","title":"[è¯‘]ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹6.è¿›ä¸€æ­¥é˜…è¯»å’Œé™„å½•"},{"content":" ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹æ˜¯ä¸€æœ¬å¹¿å—æ¬¢è¿çš„èµ„æºï¼Œç”¨äºç†è§£å’Œå­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿã€‚è¯¥ä¹¦ç”±ä½œè€… Mikito Takada æ’°å†™ï¼Œä»‹ç»äº†æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºæœ¬æ¦‚å¿µã€åŸåˆ™å’ŒæŒ‘æˆ˜ã€‚\nè¿™æœ¬ä¹¦æ¶µç›–äº†ä¸åˆ†å¸ƒå¼ç³»ç»Ÿç›¸å…³çš„å¹¿æ³›ä¸»é¢˜ï¼ŒåŒ…æ‹¬ç½‘ç»œã€å®¹é”™æ€§ã€ä¸€è‡´æ€§æ¨¡å‹ã€åˆ†å¸ƒå¼ç®—æ³•ã€å¯æ‰©å±•æ€§ç­‰ç­‰ã€‚å®ƒæ—¨åœ¨ä»¥æ¸…æ™°æ˜“æ‡‚çš„æ–¹å¼è§£é‡Šå¤æ‚çš„æ¦‚å¿µï¼Œé€‚åˆåˆå­¦è€…å’Œæœ‰ç»éªŒçš„åˆ†å¸ƒå¼ç³»ç»Ÿä»ä¸šè€…é˜…è¯»ã€‚\nåœ¨æ•´æœ¬ä¹¦ä¸­ï¼Œä½œè€…æä¾›äº†å„ç§å®é™…æ¡ˆä¾‹å’Œæ¡ˆä¾‹ç ”ç©¶ï¼Œä»¥è¯´æ˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®é™…åº”ç”¨å’Œå®è·µæ–¹é¢ã€‚å®ƒè¿˜å¼ºè°ƒäº†æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿæ¶‰åŠçš„æƒè¡¡å’Œè®¾è®¡è€ƒè™‘ï¼Œå¸®åŠ©è¯»è€…å…¨é¢ç†è§£è¿™ä¸ªä¸»é¢˜ã€‚\nã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹ä½œä¸ºå¼€æºèµ„æºï¼Œå¯ä»¥å…è´¹åœ¨çº¿è·å–ï¼Œéå¸¸é€‚åˆä»»ä½•å¯¹å­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿæ„Ÿå…´è¶£çš„äººã€‚\nåŸæ–‡é“¾æ¥ï¼šDistributed systems: for fun and profit\n5. å¤åˆ¶ï¼šå¼±ä¸€è‡´æ€§æ¨¡å‹åè®® ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»ç ”ç©¶äº†ä¸€äº›å¯ä»¥åœ¨è¶Šæ¥è¶Šç°å®çš„æ•…éšœæƒ…å†µä¸‹å®æ–½å•å‰¯æœ¬ä¸€è‡´æ€§çš„åè®®ï¼Œè®©æˆ‘ä»¬è½¬å‘å½“æˆ‘ä»¬æ”¾å¼ƒå•å‰¯æœ¬ä¸€è‡´æ€§çš„è¦æ±‚æ—¶æ‰€æ‰“å¼€çš„é€‰æ‹©ä¸–ç•Œã€‚\næ€»çš„æ¥è¯´ï¼Œå¾ˆéš¾æ‰¾åˆ°ä¸€ä¸ªå•ä¸€çš„ç»´åº¦æ¥å®šä¹‰æˆ–æè¿°å…è®¸å‰¯æœ¬å‘æ•£çš„åè®®ã€‚å¤§å¤šæ•°è¿™æ ·çš„åè®®éƒ½å…·æœ‰é«˜å¯ç”¨æ€§ï¼Œå…³é”®é—®é¢˜æ›´å¤šåœ°åœ¨äºæœ€ç»ˆç”¨æˆ·æ˜¯å¦å‘ç°è¿™äº›ä¿è¯ã€æŠ½è±¡å’Œ API å¯¹ä»–ä»¬çš„ç›®çš„æœ‰ç”¨ï¼Œå°½ç®¡åœ¨èŠ‚ç‚¹å’Œ/æˆ–ç½‘ç»œæ•…éšœå‘ç”Ÿæ—¶å‰¯æœ¬å¯èƒ½å‘æ•£ã€‚\nä¸ºä»€ä¹ˆå¼±ä¸€è‡´æ€§ç³»ç»Ÿæ²¡æœ‰æ›´å—æ¬¢è¿å‘¢ï¼Ÿ\næ­£å¦‚æˆ‘åœ¨ä»‹ç»ä¸­æ‰€è¿°ï¼Œæˆ‘è®¤ä¸ºåˆ†å¸ƒå¼ç¼–ç¨‹å¾ˆå¤§ç¨‹åº¦ä¸Šæ¶‰åŠå¤„ç†åˆ†å¸ƒçš„ä¸¤ä¸ªç»“æœæ‰€å¸¦æ¥çš„å½±å“ï¼š\nä¿¡æ¯ä»¥å…‰é€Ÿä¼ æ’­ï¼› ç‹¬ç«‹çš„äº‹ç‰©ç‹¬ç«‹åœ°å‘ç”Ÿæ•…éšœã€‚ ç”±äºä¿¡æ¯ä¼ è¾“é€Ÿåº¦å—é™ï¼ŒèŠ‚ç‚¹ä»¥ä¸åŒä¸”ç‹¬ç‰¹çš„æ–¹å¼ä½“éªŒä¸–ç•Œã€‚åœ¨å•ä¸ªèŠ‚ç‚¹ä¸Šè¿›è¡Œè®¡ç®—å¾ˆå®¹æ˜“ï¼Œå› ä¸ºä¸€åˆ‡éƒ½æŒ‰ç…§å¯é¢„æµ‹çš„å…¨å±€æ€»åºå‘ç”Ÿã€‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸Šè¿›è¡Œè®¡ç®—å¾ˆå›°éš¾ï¼Œå› ä¸ºæ²¡æœ‰å…¨å±€æ€»åºã€‚\né•¿æœŸä»¥æ¥ï¼ˆä¾‹å¦‚å‡ åå¹´çš„ç ”ç©¶æ—¶é—´ï¼‰ï¼Œæˆ‘ä»¬é€šè¿‡å¼•å…¥å…¨å±€æ€»åºæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘å·²ç»è®¨è®ºäº†è®¸å¤šå®ç°å¼ºä¸€è‡´æ€§çš„æ–¹æ³•ï¼Œé€šè¿‡åœ¨æ²¡æœ‰è‡ªç„¶æ€»åºçš„æƒ…å†µä¸‹ä»¥å®¹é”™æ–¹å¼åˆ›å»ºé¡ºåºçš„æ–¹æ³•ã€‚\nå½“ç„¶ï¼Œé—®é¢˜åœ¨äºå¼ºåˆ¶æ‰§è¡Œé¡ºåºæ˜¯æ˜‚è´µçš„ã€‚è¿™åœ¨å¤§è§„æ¨¡çš„äº’è”ç½‘ç³»ç»Ÿä¸­ç‰¹åˆ«çªå‡ºï¼Œå› ä¸ºç³»ç»Ÿéœ€è¦ä¿æŒå¯ç”¨æ€§ã€‚å¼ºä¸€è‡´æ€§çš„ç³»ç»Ÿä¸åƒåˆ†å¸ƒå¼ç³»ç»Ÿé‚£æ ·è¿è¡Œï¼Œè€Œæ˜¯åƒå•ä¸ªç³»ç»Ÿï¼Œè¿™å¯¹äºåˆ†åŒºæœŸé—´çš„å¯ç”¨æ€§æ˜¯ä¸åˆ©çš„ã€‚\næ­¤å¤–ï¼Œå¯¹äºæ¯ä¸ªæ“ä½œï¼Œé€šå¸¸éœ€è¦è”ç³»å¤§å¤šæ•°èŠ‚ç‚¹ï¼Œè€Œä¸”é€šå¸¸ä¸æ­¢ä¸€æ¬¡ï¼ˆæ­£å¦‚æ‚¨åœ¨å…³äº 2PC çš„è®¨è®ºä¸­æ‰€çœ‹åˆ°çš„ï¼‰ã€‚è¿™åœ¨éœ€è¦åœ¨åœ°ç†ä¸Šåˆ†å¸ƒä»¥ä¸ºå…¨çƒç”¨æˆ·æä¾›è¶³å¤Ÿæ€§èƒ½çš„ç³»ç»Ÿä¸­å°¤å…¶å›°éš¾ã€‚\nå› æ­¤ï¼Œé»˜è®¤æƒ…å†µä¸‹åƒå•ä¸ªç³»ç»Ÿä¸€æ ·è¿è¡Œå¯èƒ½å¹¶ä¸ç†æƒ³ã€‚\nä¹Ÿè®¸æˆ‘ä»¬å¸Œæœ›æ‹¥æœ‰ä¸€ç§å¯ä»¥ç¼–å†™ä¸ä½¿ç”¨æ˜‚è´µåè°ƒçš„ä»£ç ï¼Œä½†ä»è¿”å›ä¸€ä¸ªâ€œå¯ç”¨â€å€¼çš„ç³»ç»Ÿã€‚æˆ‘ä»¬å°†å…è®¸ä¸åŒçš„å‰¯æœ¬å½¼æ­¤å‘æ•£-æ—¢ä¸ºäº†ä¿æŒæ•ˆç‡ï¼Œä¹Ÿä¸ºäº†å®¹å¿åˆ†åŒº-ç„¶åå°è¯•ä»¥æŸç§æ–¹å¼å¤„ç†è¿™ç§å‘æ•£ã€‚\næœ€ç»ˆä¸€è‡´æ€§è¡¨è¾¾äº†è¿™ä¸ªæƒ³æ³•ï¼šèŠ‚ç‚¹åœ¨ä¸€æ®µæ—¶é—´å†…å¯ä»¥ç›¸äº’å‘æ•£ï¼Œä½†æœ€ç»ˆå®ƒä»¬å°†è¾¾æˆä¸€è‡´çš„å€¼ã€‚\nåœ¨æä¾›æœ€ç»ˆä¸€è‡´æ€§çš„ç³»ç»Ÿé›†åˆä¸­ï¼Œæœ‰ä¸¤ç§ç±»å‹çš„ç³»ç»Ÿè®¾è®¡ï¼š\nå¸¦æœ‰æ¦‚ç‡ä¿è¯çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚è¿™ç§ç±»å‹çš„ç³»ç»Ÿå¯ä»¥åœ¨ä»¥åçš„æŸä¸ªæ—¶é—´ç‚¹æ£€æµ‹åˆ°å†²çªçš„å†™æ“ä½œï¼Œä½†ä¸èƒ½ä¿è¯ç»“æœä¸æŸä¸ªæ­£ç¡®çš„é¡ºåºæ‰§è¡Œç­‰æ•ˆã€‚æ¢å¥è¯è¯´ï¼Œå†²çªçš„æ›´æ–°æœ‰æ—¶ä¼šå¯¼è‡´å°†è¾ƒæ–°çš„å€¼è¦†ç›–ä¸ºè¾ƒæ—§çš„å€¼ï¼Œå¹¶ä¸”åœ¨æ­£å¸¸æ“ä½œï¼ˆæˆ–åˆ†åŒºï¼‰æœŸé—´å¯èƒ½ä¼šå‡ºç°ä¸€äº›å¼‚å¸¸æƒ…å†µã€‚\nè¿‘å¹´æ¥ï¼Œæœ€æœ‰å½±å“åŠ›çš„æä¾›å•å‰¯æœ¬ä¸€è‡´æ€§çš„ç³»ç»Ÿè®¾è®¡æ˜¯äºšé©¬é€Šçš„ Dynamoï¼Œæˆ‘å°†ä»¥å®ƒä½œä¸ºæä¾›å¸¦æœ‰æ¦‚ç‡ä¿è¯çš„æœ€ç»ˆä¸€è‡´æ€§ç³»ç»Ÿç¤ºä¾‹è¿›è¡Œè®¨è®ºã€‚\nå¸¦æœ‰å¼ºä¿è¯çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚è¿™ç§ç±»å‹çš„ç³»ç»Ÿä¿è¯æœ€ç»ˆç»“æœä¼šæ”¶æ•›åˆ°ä¸€ä¸ªå…±åŒçš„å€¼ï¼Œè¯¥å€¼ç­‰åŒäºæŸä¸ªæ­£ç¡®çš„é¡ºåºæ‰§è¡Œã€‚æ¢å¥è¯è¯´ï¼Œè¿™æ ·çš„ç³»ç»Ÿä¸ä¼šäº§ç”Ÿä»»ä½•å¼‚å¸¸ç»“æœï¼›åœ¨æ²¡æœ‰ä»»ä½•åè°ƒçš„æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥æ„å»ºç›¸åŒæœåŠ¡çš„å‰¯æœ¬ï¼Œå¹¶ä¸”è¿™äº›å‰¯æœ¬å¯ä»¥ä»¥ä»»ä½•æ¨¡å¼è¿›è¡Œé€šä¿¡å¹¶ä»¥ä»»ä½•é¡ºåºæ¥æ”¶æ›´æ–°ï¼Œåªè¦å®ƒä»¬éƒ½çœ‹åˆ°ç›¸åŒçš„ä¿¡æ¯ï¼Œå®ƒä»¬æœ€ç»ˆä¼šå°±æœ€ç»ˆç»“æœè¾¾æˆä¸€è‡´ã€‚\nCRDTï¼ˆæ”¶æ•›å¤åˆ¶æ•°æ®ç±»å‹ï¼‰æ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œå®ƒä¿è¯åœ¨ç½‘ç»œå»¶è¿Ÿã€åˆ†åŒºå’Œæ¶ˆæ¯é‡æ’åºçš„æƒ…å†µä¸‹æ”¶æ•›åˆ°ç›¸åŒçš„å€¼ã€‚å®ƒä»¬å¯ä»¥è¢«è¯æ˜æ˜¯æ”¶æ•›çš„ï¼Œä½†å¯ä»¥å®ç°ä¸º CRDT çš„æ•°æ®ç±»å‹æ˜¯æœ‰é™çš„ã€‚\nCALMï¼ˆä¸€è‡´æ€§ä½œä¸ºé€»è¾‘å•è°ƒæ€§ï¼‰çŒœæƒ³æ˜¯ç›¸åŒåŸåˆ™çš„å¦ä¸€ç§è¡¨è¾¾æ–¹å¼ï¼šå®ƒå°†é€»è¾‘å•è°ƒæ€§ä¸æ”¶æ•›ç­‰åŒèµ·æ¥ã€‚å¦‚æœæˆ‘ä»¬å¯ä»¥å¾—å‡ºæŸä¸ªä¸œè¥¿åœ¨é€»è¾‘ä¸Šæ˜¯å•è°ƒçš„ï¼Œé‚£ä¹ˆåœ¨æ²¡æœ‰åè°ƒçš„æƒ…å†µä¸‹è¿è¡Œå®ƒä¹Ÿæ˜¯å®‰å…¨çš„ã€‚æ”¶æ•›åˆ†æ-ç‰¹åˆ«æ˜¯åœ¨ Bloom ç¼–ç¨‹è¯­è¨€ä¸­çš„åº”ç”¨-å¯ç”¨äºæŒ‡å¯¼ç¨‹åºå‘˜åœ¨ä½•æ—¶ä½•åœ°ä½¿ç”¨å¼ºä¸€è‡´æ€§ç³»ç»Ÿçš„åè°ƒæŠ€æœ¯ä»¥åŠåœ¨ä½•æ—¶å¯ä»¥å®‰å…¨åœ°æ‰§è¡Œæ— éœ€åè°ƒçš„æ“ä½œã€‚\nåè°ƒä¸åŒçš„æ“ä½œæŒ‡ä»¤ ä¸å¼ºåˆ¶æ‰§è¡Œå•å‰¯æœ¬ä¸€è‡´æ€§çš„ç³»ç»Ÿæ˜¯ä»€ä¹ˆæ ·å­å‘¢ï¼Ÿè®©æˆ‘ä»¬é€šè¿‡å‡ ä¸ªä¾‹å­æ¥æ›´å…·ä½“åœ°äº†è§£ã€‚\nä¹Ÿè®¸æœ€æ˜æ˜¾çš„éå¼ºåˆ¶æ‰§è¡Œå•å‰¯æœ¬ä¸€è‡´æ€§ç³»ç»Ÿçš„ç‰¹å¾æ˜¯å®ƒä»¬å…è®¸å‰¯æœ¬å½¼æ­¤å‘æ•£ã€‚è¿™æ„å‘³ç€æ²¡æœ‰ä¸¥æ ¼å®šä¹‰çš„é€šä¿¡æ¨¡å¼ï¼šå‰¯æœ¬å¯ä»¥ç›¸äº’åˆ†ç¦»ï¼Œä½†ä»ç„¶ä¿æŒå¯ç”¨å¹¶æ¥å—å†™æ“ä½œã€‚\nè®©æˆ‘ä»¬æƒ³è±¡ä¸€ä¸ªç”±ä¸‰ä¸ªå‰¯æœ¬ç»„æˆçš„ç³»ç»Ÿï¼Œæ¯ä¸ªå‰¯æœ¬å½¼æ­¤åˆ†ç¦»ã€‚ä¾‹å¦‚ï¼Œè¿™äº›å‰¯æœ¬å¯èƒ½ä½äºä¸åŒçš„æ•°æ®ä¸­å¿ƒï¼Œå¹¶å› æŸç§åŸå› æ— æ³•é€šä¿¡ã€‚åœ¨åˆ†ç¦»æœŸé—´ï¼Œæ¯ä¸ªå‰¯æœ¬ä»ç„¶å¯ç”¨ï¼Œå¯ä»¥æ¥å—ä¸€äº›å®¢æˆ·ç«¯çš„è¯»å†™æ“ä½œï¼š\n[Clients] - \u0026gt; [A] --- Partition --- [Clients] - \u0026gt; [B] --- Partition --- [Clients] - \u0026gt; [C] ä¸€æ®µæ—¶é—´åï¼Œåˆ†åŒºä¼šä¿®å¤å¹¶ä¸”å‰¯æœ¬æœåŠ¡å™¨ä¼šäº¤æ¢ä¿¡æ¯ã€‚ä»–ä»¬ä»ä¸åŒçš„å®¢æˆ·é‚£é‡Œæ”¶åˆ°äº†ä¸åŒçš„æ›´æ–°ï¼Œå¹¶ä¸”å½¼æ­¤å­˜åœ¨åˆ†æ­§ï¼Œå› æ­¤éœ€è¦è¿›è¡ŒæŸç§åè°ƒã€‚æˆ‘ä»¬å¸Œæœ›æ‰€æœ‰çš„å‰¯æœ¬éƒ½æ”¶æ•›åˆ°ç›¸åŒçš„ç»“æœã€‚\n[A] \\ --\u0026gt; [merge] [B] / | | [C] ----[merge]---\u0026gt; result è€ƒè™‘å…·æœ‰å¼±ä¸€è‡´æ€§ä¿è¯çš„ç³»ç»Ÿçš„å¦ä¸€ç§æ–¹æ³•æ˜¯æƒ³è±¡ä¸€ç»„å®¢æˆ·ç«¯æŒ‰æŸç§é¡ºåºå‘ä¸¤ä¸ªå‰¯æœ¬å‘é€æ¶ˆæ¯ã€‚ç”±äºæ²¡æœ‰å¼ºåˆ¶æ‰§è¡Œå•ä¸€æ€»é¡ºåºçš„åè°ƒåè®®ï¼Œå› æ­¤æ¶ˆæ¯å¯ä»¥åœ¨ä¸¤ä¸ªå‰¯æœ¬ä¸Šä»¥ä¸åŒçš„é¡ºåºä¼ é€’ï¼š\n[Clients] --\u0026gt; [A] 1, 2, 3 [Clients] --\u0026gt; [B] 2, 3, 1 ä»æœ¬è´¨ä¸Šè®²ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬éœ€è¦åè°ƒåè®®çš„åŸå› ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬å°è¯•è¿æ¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¶ˆæ¯ 1ã€2 å’Œ 3 ä¸­çš„æ“ä½œä¸ºï¼š\n1: { operation: concat(\u0026#39;Hello \u0026#39;) } 2: { operation: concat(\u0026#39;World\u0026#39;) } 3: { operation: concat(\u0026#39;!\u0026#39;) } ç„¶åï¼Œå¦‚æœæ²¡æœ‰åè°ƒï¼ŒA å°†äº§ç”Ÿâ€œHello World!â€ï¼ŒB å°†äº§ç”Ÿâ€œWorld!Helloâ€ã€‚\nA: concat(concat(concat(\u0026#39;\u0026#39;, \u0026#39;Hello \u0026#39;), \u0026#39;World\u0026#39;), \u0026#39;!\u0026#39;) = \u0026#39;Hello World!\u0026#39; B: concat(concat(concat(\u0026#39;\u0026#39;, \u0026#39;World\u0026#39;), \u0026#39;!\u0026#39;), \u0026#39;Hello \u0026#39;) = \u0026#39;World!Hello \u0026#39; è¿™å½“ç„¶æ˜¯ä¸æ­£ç¡®çš„ã€‚åŒæ ·ï¼Œæˆ‘ä»¬å¸Œæœ›å‰¯æœ¬æ”¶æ•›åˆ°ç›¸åŒçš„ç»“æœã€‚\nè®°ä½è¿™ä¸¤ä¸ªä¾‹å­ï¼Œè®©æˆ‘ä»¬é¦–å…ˆçœ‹çœ‹äºšé©¬é€Šçš„ Dynamo æ¥å»ºç«‹åŸºçº¿ï¼Œç„¶åè®¨è®ºä¸€äº›æ„å»ºå…·æœ‰å¼±ä¸€è‡´æ€§ä¿è¯çš„ç³»ç»Ÿçš„æ–°æ–¹æ³•ï¼Œä¾‹å¦‚ CRDT å’Œ CALM å®šç†ã€‚\nAmazon\u0026rsquo;s Dynamo äºšé©¬é€Šçš„ Dynamo ç³»ç»Ÿè®¾è®¡ï¼ˆ2007 å¹´ï¼‰å¯èƒ½æ˜¯æœ€è‘—åçš„æä¾›å¼±ä¸€è‡´æ€§ä¿è¯ä½†é«˜å¯ç”¨æ€§çš„ç³»ç»Ÿã€‚å®ƒæ˜¯è®¸å¤šå…¶ä»–å®é™…ç³»ç»Ÿçš„åŸºç¡€ï¼ŒåŒ…æ‹¬ LinkedIn çš„ Voldemortã€Facebook çš„ Cassandra å’Œ Basho çš„ Riakã€‚\nDynamo æ˜¯ä¸€ä¸ªæœ€ç»ˆä¸€è‡´æ€§ä¸”é«˜å¯ç”¨çš„é”®å€¼å­˜å‚¨ç³»ç»Ÿã€‚é”®å€¼å­˜å‚¨ç±»ä¼¼äºä¸€ä¸ªå¤§çš„å“ˆå¸Œè¡¨ï¼šå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨ set(key, value)è®¾ç½®å€¼ï¼Œå¹¶é€šè¿‡é”®ä½¿ç”¨ get(key)æ£€ç´¢å€¼ã€‚Dynamo é›†ç¾¤ç”± N ä¸ªå¯¹ç­‰èŠ‚ç‚¹ç»„æˆï¼›æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£å­˜å‚¨ä¸€ç»„é”®ã€‚\nDynamo ä¼˜å…ˆä¿è¯å¯ç”¨æ€§è€Œä¸æ˜¯ä¸€è‡´æ€§ï¼›å®ƒä¸ä¿è¯å•å‰¯æœ¬ä¸€è‡´æ€§ã€‚ç›¸åï¼Œå½“å†™å…¥å€¼æ—¶ï¼Œå‰¯æœ¬å¯èƒ½ä¼šå‘æ•£ï¼›å½“è¯»å–ä¸€ä¸ªé”®æ—¶ï¼Œåœ¨å°†å€¼è¿”å›ç»™å®¢æˆ·ç«¯ä¹‹å‰ï¼Œä¼šæœ‰ä¸€ä¸ªè¯»å–åè°ƒé˜¶æ®µï¼Œå°è¯•è§£å†³å‰¯æœ¬ä¹‹é—´çš„å·®å¼‚ã€‚\nå¯¹äºäºšé©¬é€Šçš„è®¸å¤šåŠŸèƒ½è€Œè¨€ï¼Œé¿å…åœæœºæ¯”ç¡®ä¿æ•°æ®å®Œå…¨ä¸€è‡´æ›´ä¸ºé‡è¦ï¼Œå› ä¸ºåœæœºå¯èƒ½å¯¼è‡´ä¸šåŠ¡æŸå¤±å’Œä¿¡èª‰æŸå¤±ã€‚æ­¤å¤–ï¼Œå¦‚æœæ•°æ®å¹¶ä¸æ˜¯ç‰¹åˆ«é‡è¦ï¼Œé‚£ä¹ˆå¼±ä¸€è‡´æ€§ç³»ç»Ÿå¯ä»¥ä»¥æ¯”ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“æ›´ä½çš„æˆæœ¬æä¾›æ›´å¥½çš„æ€§èƒ½å’Œæ›´é«˜çš„å¯ç”¨æ€§ã€‚\nç”±äº Dynamo æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç³»ç»Ÿè®¾è®¡ï¼Œé™¤äº†æ ¸å¿ƒå¤åˆ¶ä»»åŠ¡ä¹‹å¤–ï¼Œè¿˜æœ‰è®¸å¤šä¸åŒçš„éƒ¨åˆ†éœ€è¦è€ƒè™‘ã€‚ä¸‹é¢çš„å›¾ç¤ºäº†ä¸€äº›ä»»åŠ¡ï¼Œç‰¹åˆ«æ˜¯å†™å…¥å¦‚ä½•è·¯ç”±åˆ°èŠ‚ç‚¹å¹¶å†™å…¥å¤šä¸ªå‰¯æœ¬ã€‚\n[ Client ] | ( Mapping keys to nodes ) | V [ Node A ] | \\ ( Synchronous replication task: minimum durability ) | \\ [ Node B] [ Node C ] A | ( Conflict detection; asynchronous replication task: ensuring that partitioned / recovered nodes recover ) | V [ Node D] åœ¨äº†è§£æœ€åˆå¦‚ä½•æ¥å—å†™å…¥ä¹‹åï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•æ£€æµ‹å†²çªä»¥åŠå¼‚æ­¥å‰¯æœ¬åŒæ­¥ä»»åŠ¡ã€‚ç”±äºé«˜å¯ç”¨æ€§è®¾è®¡ï¼ŒèŠ‚ç‚¹å¯èƒ½æš‚æ—¶ä¸å¯ç”¨ï¼ˆå®•æœºæˆ–åˆ†åŒºï¼‰ï¼Œå› æ­¤éœ€è¦æ‰§è¡Œæ­¤ä»»åŠ¡ã€‚å‰¯æœ¬åŒæ­¥ä»»åŠ¡ç¡®ä¿èŠ‚ç‚¹å³ä½¿åœ¨å‘ç”Ÿæ•…éšœåä¹Ÿèƒ½ç›¸å½“å¿«åœ°èµ¶ä¸Šã€‚\nä¸€è‡´çš„æ•£åˆ— æ— è®ºæˆ‘ä»¬æ˜¯è¯»è¿˜æ˜¯å†™ï¼Œé¦–å…ˆéœ€è¦åšçš„å°±æ˜¯æ‰¾åˆ°æ•°æ®åœ¨ç³»ç»Ÿä¸Šçš„ä½ç½®ã€‚è¿™éœ€è¦æŸç§ç±»å‹çš„é”®åˆ°èŠ‚ç‚¹æ˜ å°„ã€‚\nåœ¨ Dynamo ä¸­ï¼Œé”®ä½¿ç”¨ç§°ä¸ºä¸€è‡´æ€§å“ˆå¸Œçš„å“ˆå¸ŒæŠ€æœ¯ï¼ˆæˆ‘ä¸ä¼šè¯¦ç»†è®¨è®ºï¼‰æ˜ å°„åˆ°èŠ‚ç‚¹ã€‚ä¸»è¦æ€æƒ³æ˜¯ï¼Œé€šè¿‡å®¢æˆ·ç«¯ä¸Šçš„ç®€å•è®¡ç®—ï¼Œå¯ä»¥å°†å¯†é’¥æ˜ å°„åˆ°è´Ÿè´£å®ƒçš„ä¸€ç»„èŠ‚ç‚¹ã€‚è¿™æ„å‘³ç€å®¢æˆ·ç«¯å¯ä»¥å®šä½å¯†é’¥ï¼Œè€Œæ— éœ€å‘ç³»ç»ŸæŸ¥è¯¢æ¯ä¸ªå¯†é’¥çš„ä½ç½®ï¼›è¿™å¯ä»¥èŠ‚çœç³»ç»Ÿèµ„æºï¼Œå› ä¸ºæ•£åˆ—é€šå¸¸æ¯”æ‰§è¡Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨æ›´å¿«ã€‚\néƒ¨åˆ†æ³•å®šäººæ•° ä¸€æ—¦æˆ‘ä»¬çŸ¥é“å¯†é’¥åº”è¯¥å­˜å‚¨åœ¨å“ªé‡Œï¼Œæˆ‘ä»¬å°±éœ€è¦åšä¸€äº›å·¥ä½œæ¥ä¿å­˜è¯¥å€¼ã€‚è¿™æ˜¯ä¸€ä¸ªåŒæ­¥ä»»åŠ¡ï¼›æˆ‘ä»¬ç«‹å³å°†å€¼å†™å…¥å¤šä¸ªèŠ‚ç‚¹çš„åŸå› æ˜¯ä¸ºäº†æä¾›æ›´é«˜çº§åˆ«çš„æŒä¹…æ€§ï¼ˆä¾‹å¦‚ï¼Œé˜²æ­¢èŠ‚ç‚¹ç«‹å³å‘ç”Ÿæ•…éšœï¼‰ã€‚\nå°±åƒ Paxos æˆ– Raft ä¸€æ ·ï¼ŒDynamo ä½¿ç”¨ä»²è£è¿›è¡Œå¤åˆ¶ã€‚ç„¶è€Œï¼ŒDynamo çš„æ³•å®šäººæ•°æ˜¯è‰ç‡ï¼ˆéƒ¨åˆ†ï¼‰æ³•å®šäººæ•°ï¼Œè€Œä¸æ˜¯ä¸¥æ ¼ï¼ˆå¤šæ•°ï¼‰æ³•å®šäººæ•°ã€‚\néæ­£å¼åœ°ï¼Œä¸¥æ ¼æ³•å®šäººæ•°ç³»ç»Ÿæ˜¯æŒ‡å…·æœ‰æ³•å®šäººæ•°ç³»ç»Ÿä¸­ä»»æ„ä¸¤ä¸ªæ³•å®šäººæ•°ï¼ˆé›†åˆï¼‰é‡å çš„å±æ€§çš„æ³•å®šäººæ•°ç³»ç»Ÿã€‚åœ¨æ¥å—æ›´æ–°ä¹‹å‰è¦æ±‚å¤šæ•°æŠ•ç¥¨æ”¯æŒæ›´æ–°å¯ä»¥ä¿è¯åªæ¥å—å•ä¸ªå†å²è®°å½•ï¼Œå› ä¸ºæ¯ä¸ªå¤šæ•°ä»²è£å¿…é¡»åœ¨è‡³å°‘ä¸€ä¸ªèŠ‚ç‚¹ä¸­é‡å ã€‚ä¾‹å¦‚ï¼Œè¿™å°±æ˜¯ Paxos æ‰€ä¾èµ–çš„å±æ€§ã€‚\néƒ¨åˆ†æ³•å®šäººæ•°ä¸å…·å¤‡è¯¥å±æ€§ï¼›è¿™æ„å‘³ç€ä¸éœ€è¦å¤šæ•°ï¼Œå¹¶ä¸”æ³•å®šäººæ•°çš„ä¸åŒå­é›†å¯èƒ½åŒ…å«ç›¸åŒæ•°æ®çš„ä¸åŒç‰ˆæœ¬ã€‚ç”¨æˆ·å¯ä»¥é€‰æ‹©è¦å†™å…¥å’Œè¯»å–çš„èŠ‚ç‚¹æ•°é‡ï¼š\nç”¨æˆ·å¯ä»¥é€‰æ‹©å†™å…¥æˆåŠŸæ‰€éœ€çš„ W-of-N èŠ‚ç‚¹æ•°é‡ï¼›å’Œ ç”¨æˆ·å¯ä»¥æŒ‡å®šè¯»å–æœŸé—´è¦è”ç³»çš„èŠ‚ç‚¹æ•° (R-of-N)ã€‚ W å’Œ R æŒ‡å®šå†™å…¥æˆ–è¯»å–éœ€è¦æ¶‰åŠçš„èŠ‚ç‚¹æ•°ã€‚å†™å…¥æ›´å¤šèŠ‚ç‚¹ä¼šä½¿å†™å…¥é€Ÿåº¦ç¨æ…¢ï¼Œä½†ä¼šå¢åŠ å€¼ä¸ä¸¢å¤±çš„æ¦‚ç‡ï¼›ä»æ›´å¤šèŠ‚ç‚¹è¯»å–ä¼šå¢åŠ è¯»å–çš„å€¼æ˜¯æœ€æ–°çš„æ¦‚ç‡ã€‚\né€šå¸¸çš„å»ºè®®æ˜¯ R + W \u0026gt; N ï¼Œå› ä¸ºè¿™æ„å‘³ç€è¯»å–å’Œå†™å…¥ä»²è£åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸­é‡å  - ä½¿å¾—è¿”å›è¿‡æ—¶å€¼çš„å¯èƒ½æ€§è¾ƒå°ã€‚å…¸å‹çš„é…ç½®æ˜¯ N = 3 ï¼ˆä¾‹å¦‚æ¯ä¸ªå€¼æ€»å…±ä¸‰ä¸ªå‰¯æœ¬ï¼‰ï¼›è¿™æ„å‘³ç€ç”¨æˆ·å¯ä»¥é€‰æ‹©ï¼š\nR = 1, W = 3; R = 2, W = 2 or R = 3, W = 1 æ›´ä¸€èˆ¬åœ°è¯´ï¼Œå†æ¬¡å‡è®¾ R + W \u0026gt; N ï¼š\nR = 1, W = N: è¯»å–å¿«ï¼Œå†™å…¥æ…¢ R = N, W = 1: å†™å…¥é€Ÿåº¦å¿«ï¼Œè¯»å–é€Ÿåº¦æ…¢ R = N/2 and W = N/2 + 1: å¯¹ä¸¤è€…éƒ½æœ‰åˆ© N å¾ˆå°‘è¶…è¿‡ 3ï¼Œå› ä¸ºä¿ç•™å¤§é‡æ•°æ®çš„è®¸å¤šå‰¯æœ¬ä¼šå˜å¾—æ˜‚è´µï¼\næ­£å¦‚æˆ‘ä¹‹å‰æåˆ°çš„ï¼ŒDynamo çº¸å¯å‘äº†è®¸å¤šå…¶ä»–ç±»ä¼¼çš„è®¾è®¡ã€‚å®ƒä»¬éƒ½ä½¿ç”¨ç›¸åŒçš„åŸºäºéƒ¨åˆ†ä»²è£çš„å¤åˆ¶æ–¹æ³•ï¼Œä½† Nã€W å’Œ R çš„é»˜è®¤å€¼ä¸åŒï¼š\nBasho\u0026rsquo;s Riak (N = 3, R = 2, W = 2 default) Linkedin\u0026rsquo;s Voldemort (N = 2 or 3, R = 1, W = 1 default) Apache\u0026rsquo;s Cassandra (N = 3, R = 1, W = 1 default) è¿˜æœ‰ä¸€ä¸ªç»†èŠ‚ï¼šå‘é€è¯»æˆ–å†™è¯·æ±‚æ—¶ï¼Œæ˜¯è¦æ±‚æ‰€æœ‰ N ä¸ªèŠ‚ç‚¹å“åº”ï¼ˆRiakï¼‰ï¼Œè¿˜æ˜¯ä»…è¦æ±‚æ»¡è¶³æœ€å°å€¼çš„å¤šä¸ªèŠ‚ç‚¹ï¼ˆä¾‹å¦‚ R æˆ– Wï¼›Voldemortï¼‰ã€‚\nâ€œsend-to-allâ€æ–¹æ³•é€Ÿåº¦æ›´å¿«ï¼Œå¯¹å»¶è¿Ÿä¸å¤ªæ•æ„Ÿï¼ˆå› ä¸ºå®ƒåªç­‰å¾… N ä¸­æœ€å¿«çš„ R æˆ– W èŠ‚ç‚¹ï¼‰ï¼Œä½†æ•ˆç‡ä¹Ÿè¾ƒä½ï¼Œè€Œâ€œsend-tominimumâ€æ–¹æ³•å¯¹å»¶è¿Ÿæ›´æ•æ„Ÿã€‚å»¶è¿Ÿï¼ˆå› ä¸ºä¸å•ä¸ªèŠ‚ç‚¹é€šä¿¡çš„å»¶è¿Ÿä¼šå»¶è¿Ÿæ“ä½œï¼‰ï¼Œè€Œä¸”æ•ˆç‡æ›´é«˜ï¼ˆæ€»ä½“ä¸Šæ¶ˆæ¯/è¿æ¥æ›´å°‘ï¼‰ã€‚\nå½“è¯»å–å’Œå†™å…¥ä»²è£é‡å æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œä¾‹å¦‚ï¼ˆ R + W \u0026gt; N ï¼‰ï¼Ÿå…·ä½“æ¥è¯´ï¼Œäººä»¬ç»å¸¸å£°ç§°è¿™ä¼šå¯¼è‡´â€œå¼ºä¸€è‡´æ€§â€ã€‚\nR + W \u0026gt; N ç­‰åŒäºâ€œå¼ºä¸€è‡´æ€§â€å—ï¼Ÿ No\nè¿™å¹¶ä¸æ˜¯å®Œå…¨é”™è¯¯çš„ï¼š R + W \u0026gt; N å¯ä»¥æ£€æµ‹è¯»/å†™å†²çªçš„ç³»ç»Ÿï¼Œå› ä¸ºä»»ä½•è¯»ä»²è£å’Œä»»ä½•å†™ä»²è£å…±äº«ä¸€ä¸ªæˆå‘˜ã€‚ä¾‹å¦‚ã€‚ä¸¤ä¸ªä»²è£ä¸­è‡³å°‘æœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼š\n1 2 N/2+1 N/2+2 N [...] [R] [R + W] [W] [...] è¿™ç¡®ä¿äº†å…ˆå‰çš„å†™æ“ä½œå°†è¢«åç»­çš„è¯»å–æ“ä½œçœ‹åˆ°ã€‚ç„¶è€Œï¼Œè¿™ä»…åœ¨ N ä¸­çš„èŠ‚ç‚¹æ°¸ä¸æ”¹å˜çš„æƒ…å†µä¸‹æˆç«‹ã€‚å› æ­¤ï¼ŒDynamo å¹¶ä¸ç¬¦åˆè¿™ä¸ªè¦æ±‚ï¼Œå› ä¸ºåœ¨ Dynamo ä¸­ï¼Œå¦‚æœèŠ‚ç‚¹å¤±è´¥ï¼Œé›†ç¾¤æˆå‘˜èµ„æ ¼å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚\nDynamo è¢«è®¾è®¡ä¸ºå§‹ç»ˆå¯å†™ã€‚å®ƒå…·æœ‰å¤„ç†èŠ‚ç‚¹æ•…éšœçš„æœºåˆ¶ï¼Œå³åœ¨åŸå§‹æœåŠ¡å™¨å®•æœºæ—¶ï¼Œå°†ä¸€ä¸ªä¸ç›¸å…³çš„æœåŠ¡å™¨æ·»åŠ åˆ°è´Ÿè´£æŸäº›é”®çš„èŠ‚ç‚¹é›†åˆä¸­ã€‚è¿™æ„å‘³ç€æ³•å®šäººæ•°ä¸å†ä¿è¯å§‹ç»ˆé‡å ã€‚å³ä½¿ R = W = N ä¹Ÿä¸ç¬¦åˆæ¡ä»¶ï¼Œå› ä¸ºå°½ç®¡æ³•å®šäººæ•°çš„å¤§å°ç­‰äº Nï¼Œä½†åœ¨æ•…éšœæœŸé—´ï¼Œè¿™äº›æ³•å®šäººæ•°ä¸­çš„èŠ‚ç‚¹å¯ä»¥å‘ç”Ÿå˜åŒ–ã€‚å…·ä½“è€Œè¨€ï¼Œåœ¨åˆ†åŒºæœŸé—´ï¼Œå¦‚æœæ— æ³•è¾¾åˆ°è¶³å¤Ÿæ•°é‡çš„èŠ‚ç‚¹ï¼ŒDynamo å°†ä»ä¸ç›¸å…³ä½†å¯è®¿é—®çš„èŠ‚ç‚¹ä¸­æ·»åŠ æ–°èŠ‚ç‚¹åˆ°æ³•å®šäººæ•°ä¸­ã€‚\næ­¤å¤–ï¼ŒDynamo ä¸ä»¥å¼ºä¸€è‡´æ€§æ¨¡å‹æ‰€å¼ºåˆ¶çš„æ–¹å¼å¤„ç†åˆ†åŒºï¼šå³åœ¨åˆ†åŒºçš„ä¸¤ä¾§éƒ½å…è®¸å†™æ“ä½œï¼Œè¿™æ„å‘³ç€ç³»ç»Ÿåœ¨æŸäº›æ—¶é—´å†…ä¸ä½œä¸ºå•ä¸€å‰¯æœ¬è¿è¡Œã€‚å› æ­¤ï¼Œå°† R + W \u0026gt; N ç§°ä¸º\u0026quot;å¼ºä¸€è‡´æ€§\u0026quot;æ˜¯å…·æœ‰è¯¯å¯¼æ€§çš„ï¼›è¿™ä¸ªä¿è¯ä»…ä»…æ˜¯æ¦‚ç‡æ€§çš„ï¼Œè€Œä¸æ˜¯å¼ºä¸€è‡´æ€§æ‰€æŒ‡çš„æ„æ€ã€‚\nå†²çªæ£€æµ‹å’Œè¯»å–ä¿®å¤ ä¸ºäº†è§£å†³å…è®¸å‰¯æœ¬å‘æ•£çš„ç³»ç»Ÿå¿…é¡»æœ‰ä¸€ç§æ–¹æ³•æ¥æœ€ç»ˆåè°ƒä¸¤ä¸ªä¸åŒçš„å€¼ï¼Œé€šå¸¸ä¼šé€šè¿‡è¡¥å……ä¸€äº›å…ƒæ•°æ®æ¥è·Ÿè¸ªæ•°æ®çš„å› æœå†å²ã€‚å½“å®¢æˆ·ç«¯ä»ç³»ç»Ÿä¸­è¯»å–æ•°æ®æ—¶ï¼Œå¿…é¡»ä¿ç•™å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¹¶åœ¨å†™å…¥æ•°æ®åº“æ—¶è¿”å›ç›¸åº”çš„å…ƒæ•°æ®å€¼ã€‚\næˆ‘ä»¬å·²ç»ä»‹ç»äº†ä¸€ç§ç”¨äºå®ç°è¿™ä¸€ç›®çš„çš„æ–¹æ³•ï¼šå‘é‡æ—¶é’Ÿå¯ä»¥ç”¨äºè¡¨ç¤ºå€¼çš„å†å²ã€‚å®é™…ä¸Šï¼Œè¿™å°±æ˜¯åŸå§‹çš„ Dynamo è®¾è®¡ç”¨äºæ£€æµ‹å†²çªçš„æ–¹æ³•ã€‚\nç„¶è€Œï¼Œä½¿ç”¨å‘é‡æ—¶é’Ÿå¹¶ä¸æ˜¯å”¯ä¸€çš„é€‰æ‹©ã€‚é€šè¿‡æŸ¥çœ‹ç³»ç»Ÿè·Ÿè¸ªçš„å…ƒæ•°æ®ï¼Œæ‚¨å¯ä»¥æ¨æ–­å‡ºè®¸å¤šå®é™…ç³»ç»Ÿè®¾è®¡çš„å·¥ä½œæ–¹å¼ã€‚\næ²¡æœ‰å…ƒæ•°æ®ã€‚å½“ç³»ç»Ÿä¸è·Ÿè¸ªå…ƒæ•°æ®ï¼Œä»…è¿”å›å€¼ï¼ˆä¾‹å¦‚é€šè¿‡å®¢æˆ·ç«¯ APIï¼‰æ—¶ï¼Œå®ƒå®é™…ä¸Šæ— æ³•å¯¹å¹¶å‘å†™å…¥æ‰§è¡Œä»»ä½•ç‰¹æ®Šæ“ä½œã€‚ä¸€ä¸ªå¸¸è§çš„è§„åˆ™æ˜¯æœ€åå†™å…¥è€…è·èƒœï¼šæ¢å¥è¯è¯´ï¼Œå¦‚æœä¸¤ä¸ªå†™å…¥è€…åŒæ—¶å†™å…¥ï¼Œåªæœ‰æœ€æ…¢çš„å†™å…¥è€…çš„å€¼è¢«ä¿ç•™ã€‚\næ—¶é—´æˆ³ã€‚é€šå¸¸ï¼Œå…·æœ‰è¾ƒé«˜æ—¶é—´æˆ³å€¼çš„å€¼è·èƒœã€‚ç„¶è€Œï¼Œå¦‚æœæ—¶é—´æ²¡æœ‰è¢«ç²¾ç¡®åŒæ­¥ï¼Œè®¸å¤šå¥‡æ€ªçš„äº‹æƒ…å¯èƒ½å‘ç”Ÿï¼Œå…¶ä¸­æ¥è‡ªå…·æœ‰æ•…éšœæˆ–å¿«é€Ÿæ—¶é’Ÿçš„ç³»ç»Ÿçš„æ—§æ•°æ®è¦†ç›–äº†è¾ƒæ–°çš„å€¼ã€‚Facebook çš„ Cassandra æ˜¯ Dynamo çš„ä¸€ä¸ªå˜ç§ï¼Œå®ƒä½¿ç”¨æ—¶é—´æˆ³è€Œä¸æ˜¯å‘é‡æ—¶é’Ÿã€‚\nç‰ˆæœ¬å·ã€‚ç‰ˆæœ¬å·å¯ä»¥é¿å…ä½¿ç”¨æ—¶é—´æˆ³æ—¶çš„ä¸€äº›é—®é¢˜ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“å­˜åœ¨å¤šä¸ªå¯èƒ½çš„å†å²æ—¶ï¼Œå¯ä»¥å‡†ç¡®è·Ÿè¸ªå› æœå…³ç³»çš„æœ€å°æœºåˆ¶æ˜¯å‘é‡æ—¶é’Ÿï¼Œè€Œä¸æ˜¯ç‰ˆæœ¬å·ã€‚\nå‘é‡æ—¶é’Ÿã€‚ä½¿ç”¨å‘é‡æ—¶é’Ÿï¼Œå¯ä»¥æ£€æµ‹å¹¶å‘å’Œè¿‡æ—¶çš„æ›´æ–°ã€‚ç„¶åå¯ä»¥æ‰§è¡Œè¯»ä¿®å¤æ“ä½œï¼Œå°½ç®¡åœ¨æŸäº›æƒ…å†µä¸‹ï¼ˆå¹¶å‘æ›´æ”¹ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦è¦æ±‚å®¢æˆ·ç«¯é€‰æ‹©ä¸€ä¸ªå€¼ã€‚è¿™æ˜¯å› ä¸ºå¦‚æœæ›´æ”¹æ˜¯å¹¶å‘çš„ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯¹æ•°æ®æ²¡æœ‰æ›´å¤šäº†è§£ï¼ˆå°±åƒç®€å•çš„é”®å€¼å­˜å‚¨ä¸€æ ·ï¼‰ï¼Œé‚£ä¹ˆè¯¢é—®æ¯”ä»»æ„ä¸¢å¼ƒæ•°æ®æ›´å¥½ã€‚\nåœ¨è¯»å–å€¼æ—¶ï¼Œå®¢æˆ·ç«¯è”ç³» N ä¸ªèŠ‚ç‚¹ä¸­çš„ R ä¸ªèŠ‚ç‚¹ï¼Œå¹¶è¯·æ±‚å®ƒä»¬ä¸ºæŸä¸ªé”®æä¾›æœ€æ–°çš„å€¼ã€‚å®ƒæ¥æ”¶æ‰€æœ‰çš„å“åº”ï¼Œä¸¢å¼ƒä¸¥æ ¼è¾ƒæ—§çš„å€¼ï¼ˆä½¿ç”¨å‘é‡æ—¶é’Ÿå€¼æ¥æ£€æµ‹ï¼‰ã€‚å¦‚æœåªæœ‰ä¸€ä¸ªå”¯ä¸€çš„å‘é‡æ—¶é’Ÿ+å€¼å¯¹ï¼Œåˆ™è¿”å›è¯¥å€¼ã€‚å¦‚æœæœ‰å¤šä¸ªå¹¶å‘ç¼–è¾‘çš„å‘é‡æ—¶é’Ÿ+å€¼å¯¹ï¼ˆä¾‹å¦‚ä¸å¯æ¯”è¾ƒï¼‰ï¼Œåˆ™è¿”å›æ‰€æœ‰è¿™äº›å€¼ã€‚\næ˜¾ç„¶ï¼Œä»ä¸Šè¿°å†…å®¹å¯ä»¥çœ‹å‡ºï¼Œè¯»ä¿®å¤å¯èƒ½ä¼šè¿”å›å¤šä¸ªå€¼ã€‚è¿™æ„å‘³ç€å®¢æˆ·ç«¯/åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜å¿…é¡»æ ¹æ®ç‰¹å®šç”¨ä¾‹çš„æ ‡å‡†å¶å°”å¤„ç†è¿™äº›æƒ…å†µï¼Œå¹¶é€‰æ‹©ä¸€ä¸ªå€¼ã€‚\næ­¤å¤–ï¼Œå®é™…å‘é‡æ—¶é’Ÿç³»ç»Ÿçš„ä¸€ä¸ªå…³é”®ç»„æˆéƒ¨åˆ†æ˜¯ä¸èƒ½è®©æ—¶é’Ÿæ— é™å¢é•¿-å› æ­¤éœ€è¦å®šæœŸä»¥å®‰å…¨çš„æ–¹å¼å›æ”¶æ—¶é’Ÿï¼Œä»¥åœ¨å®¹é”™æ€§å’Œå­˜å‚¨éœ€æ±‚ä¹‹é—´ä¿æŒå¹³è¡¡ã€‚\nå‰¯æœ¬åŒæ­¥ï¼šgossip å’Œ Merkle æ ‘ åœ¨ Dynamo ç³»ç»Ÿè®¾è®¡ä¸­ï¼Œè€ƒè™‘åˆ°èŠ‚ç‚¹æ•…éšœå’Œç½‘ç»œåˆ†åŒºçš„å®¹é”™æ€§ï¼Œéœ€è¦ä¸€ç§å¤„ç†èŠ‚ç‚¹é‡æ–°åŠ å…¥é›†ç¾¤çš„æ–¹å¼ï¼Œæ— è®ºæ˜¯åœ¨è¢«åˆ†åŒºåè¿˜æ˜¯åœ¨æ›¿æ¢æˆ–éƒ¨åˆ†æ¢å¤å¤±è´¥çš„èŠ‚ç‚¹ä¹‹åã€‚\nå‰¯æœ¬åŒæ­¥ç”¨äºåœ¨æ•…éšœåä½¿èŠ‚ç‚¹ä¿æŒæœ€æ–°çŠ¶æ€ï¼Œå¹¶å®šæœŸä½¿å‰¯æœ¬ä¹‹é—´åŒæ­¥ã€‚\nå…«å¦ï¼ˆGossipï¼‰æ˜¯ä¸€ç§ç”¨äºåŒæ­¥å‰¯æœ¬çš„æ¦‚ç‡æ€§æŠ€æœ¯ã€‚é€šä¿¡æ¨¡å¼ï¼ˆä¾‹å¦‚å“ªä¸ªèŠ‚ç‚¹ä¸å“ªä¸ªèŠ‚ç‚¹è”ç³»ï¼‰ä¸æ˜¯é¢„å…ˆç¡®å®šçš„ã€‚ç›¸åï¼ŒèŠ‚ç‚¹å…·æœ‰å°è¯•ç›¸äº’åŒæ­¥çš„æ¦‚ç‡ pã€‚æ¯éš” t ç§’ï¼Œæ¯ä¸ªèŠ‚ç‚¹é€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œé€šä¿¡ã€‚è¿™æä¾›äº†é™¤åŒæ­¥ä»»åŠ¡ï¼ˆä¾‹å¦‚éƒ¨åˆ†æ³•å®šäººæ•°å†™å…¥ï¼‰ä¹‹å¤–çš„å¦ä¸€ç§æœºåˆ¶ï¼Œä½¿å‰¯æœ¬ä¿æŒæœ€æ–°ã€‚\nå…«å¦å…·æœ‰å¯æ‰©å±•æ€§ï¼Œæ²¡æœ‰å•ç‚¹æ•…éšœï¼Œä½†åªèƒ½æä¾›æ¦‚ç‡æ€§çš„ä¿è¯ã€‚\nä¸ºäº†ä½¿å‰¯æœ¬åŒæ­¥è¿‡ç¨‹ä¸­çš„ä¿¡æ¯äº¤æ¢æ›´é«˜æ•ˆï¼ŒDynamo ä½¿ç”¨ä¸€ç§ç§°ä¸º Merkle æ ‘çš„æŠ€æœ¯ï¼Œæˆ‘å°†ä¸è¯¦ç»†ä»‹ç»ã€‚å…³é”®æ€æƒ³æ˜¯æ•°æ®å­˜å‚¨å¯ä»¥åœ¨å¤šä¸ªä¸åŒçš„ç²’åº¦çº§åˆ«ä¸Šè¿›è¡Œå“ˆå¸Œï¼šè¡¨ç¤ºæ•´ä¸ªå†…å®¹çš„å“ˆå¸Œï¼Œä¸€åŠçš„é”®ï¼Œå››åˆ†ä¹‹ä¸€çš„é”®ç­‰ç­‰ã€‚\né€šè¿‡ä¿æŒè¿™ç§ç›¸å½“ç»†ç²’åº¦çš„å“ˆå¸Œï¼ŒèŠ‚ç‚¹å¯ä»¥æ¯”æœ´ç´ æŠ€æœ¯æ›´é«˜æ•ˆåœ°æ¯”è¾ƒå…¶æ•°æ®å­˜å‚¨å†…å®¹ã€‚ä¸€æ—¦èŠ‚ç‚¹ç¡®å®šäº†å“ªäº›é”®å…·æœ‰ä¸åŒçš„å€¼ï¼Œå®ƒä»¬ä¼šäº¤æ¢å¿…è¦çš„ä¿¡æ¯ä»¥ä½¿å‰¯æœ¬ä¿æŒæœ€æ–°ã€‚\nDynamo å®è·µï¼šæ¦‚ç‡æœ‰ç•Œé™ˆæ—§æ€§ (PBS) è¿™åŸºæœ¬ä¸Šæ¶µç›–äº† Dynamo ç³»ç»Ÿçš„è®¾è®¡ï¼š\nä¸€è‡´æ€§å“ˆå¸Œç”¨äºç¡®å®šé”®çš„å­˜æ”¾ä½ç½® éƒ¨åˆ†æ³•å®šäººæ•°ç”¨äºè¯»å–å’Œå†™å…¥ é€šè¿‡å‘é‡æ—¶é’Ÿè¿›è¡Œå†²çªæ£€æµ‹å’Œè¯»ä¿®å¤ é€šè¿‡å…«å¦è¿›è¡Œå‰¯æœ¬åŒæ­¥ æˆ‘ä»¬å¦‚ä½•æè¿°è¿™æ ·ä¸€ä¸ªç³»ç»Ÿçš„è¡Œä¸ºï¼ŸBailis ç­‰äººï¼ˆ2012 å¹´ï¼‰çš„ä¸€ç¯‡ç›¸å¯¹è¾ƒæ–°çš„è®ºæ–‡æè¿°äº†ä¸€ç§ç§°ä¸º PBSï¼ˆæ¦‚ç‡æœ‰ç•Œé™ˆæ—§åº¦ï¼‰çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä½¿ç”¨æ¨¡æ‹Ÿå’Œä»çœŸå®ç³»ç»Ÿæ”¶é›†çš„æ•°æ®æ¥æè¿°è¿™æ ·ä¸€ä¸ªç³»ç»Ÿçš„é¢„æœŸè¡Œä¸ºã€‚\nPBS é€šè¿‡ä½¿ç”¨åç†µï¼ˆgossipï¼‰é€Ÿç‡ã€ç½‘ç»œå»¶è¿Ÿå’Œæœ¬åœ°å¤„ç†å»¶è¿Ÿçš„ä¿¡æ¯æ¥ä¼°è®¡ä¸ä¸€è‡´ç¨‹åº¦ï¼Œä»è€Œä¼°è®¡è¯»å–çš„ä¸€è‡´æ€§æ°´å¹³çš„é¢„æœŸå€¼ã€‚å®ƒå·²ç»åœ¨ Cassandra ä¸­å®ç°ï¼Œåœ¨å…¶ä»–æ¶ˆæ¯ä¸Šé™„åŠ äº†è®¡æ—¶ä¿¡æ¯ï¼Œå¹¶åŸºäºæ­¤ä¿¡æ¯çš„æ ·æœ¬åœ¨è’™ç‰¹å¡æ´›æ¨¡æ‹Ÿä¸­è®¡ç®—å‡ºä¸€ä¸ªä¼°è®¡å€¼ã€‚\næ ¹æ®è¯¥è®ºæ–‡ï¼Œåœ¨æ­£å¸¸è¿è¡ŒæœŸé—´ï¼Œæœ€ç»ˆä¸€è‡´æ€§çš„æ•°æ®å­˜å‚¨é€šå¸¸æ›´å¿«ï¼Œå¹¶ä¸”å¯ä»¥åœ¨å‡ ååˆ°å‡ ç™¾æ¯«ç§’å†…è¯»å–ä¸€è‡´çš„çŠ¶æ€ã€‚ä¸‹è¡¨æè¿°äº†ä» LinkedInï¼ˆSSD å’Œ 15k RPM ç£ç›˜ï¼‰å’Œ Yammer çš„å®è¯è®¡æ—¶æ•°æ®ä¸­ï¼Œä»¥ä¸åŒçš„ R å’Œ W è®¾ç½®ä¸‹ï¼Œä»¥ 99.9%çš„ä¸€è‡´æ€§è¯»å–æ¦‚ç‡æ‰€éœ€çš„æ—¶é—´ï¼š\nä¾‹å¦‚ï¼Œåœ¨ Yammer æ¡ˆä¾‹ä¸­ï¼Œä» R=1 ã€ W=1 åˆ° R=2 ã€ W=1 å°†ä¸ä¸€è‡´çª—å£ä» 1352 æ¯«ç§’å‡å°‘åˆ° 202 æ¯«ç§’- åŒæ—¶ä¿æŒè¯»å–å»¶è¿Ÿï¼ˆ32.6 æ¯«ç§’ï¼‰ä½äºæœ€å¿«çš„ä¸¥æ ¼ä»²è£ï¼ˆ R=3 ã€ W=1 ï¼›219.27 æ¯«ç§’ï¼‰ã€‚\næœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ PBS ç½‘ç«™å’Œç›¸å…³è®ºæ–‡ã€‚\næ— åºç¼–ç¨‹ è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹æˆ‘ä»¬å¸Œæœ›è§£å†³çš„æƒ…å†µçš„ç¤ºä¾‹ã€‚ç¬¬ä¸€ä¸ªåœºæ™¯åŒ…æ‹¬ä¸‰ä¸ªä¸åŒçš„æœåŠ¡å™¨åœ¨åˆ†åŒºåï¼Œå½“åˆ†åŒºæ¢å¤æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›è¿™äº›æœåŠ¡å™¨æ”¶æ•›åˆ°ç›¸åŒçš„å€¼ã€‚äºšé©¬é€Šçš„ Dynamo é€šè¿‡ä» N ä¸ªèŠ‚ç‚¹ä¸­è¯»å– R ä¸ªèŠ‚ç‚¹ï¼Œç„¶åæ‰§è¡Œè¯»å–åè°ƒæ“ä½œæ¥å®ç°è¿™ä¸€ç‚¹ã€‚\nåœ¨ç¬¬äºŒä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬è€ƒè™‘äº†ä¸€ä¸ªæ›´å…·ä½“çš„æ“ä½œï¼šå­—ç¬¦ä¸²è¿æ¥ã€‚äº‹å®è¯æ˜ï¼Œæ²¡æœ‰å·²çŸ¥çš„æŠ€æœ¯å¯ä»¥ä½¿å­—ç¬¦ä¸²è¿æ¥çš„ç»“æœè¾¾åˆ°ç›¸åŒçš„å€¼ï¼Œè€Œä¸éœ€è¦å¯¹æ“ä½œè¿›è¡Œæ’åºï¼ˆä¾‹å¦‚ï¼Œä¸éœ€è¦æ˜‚è´µçš„åè°ƒï¼‰ã€‚ç„¶è€Œï¼Œæœ‰äº›æ“ä½œå¯ä»¥ä»¥ä»»ä½•é¡ºåºå®‰å…¨åœ°åº”ç”¨ï¼Œè€Œç®€å•çš„å¯„å­˜å™¨åˆ™æ— æ³•åšåˆ°è¿™ä¸€ç‚¹ã€‚æ­£å¦‚ Pat Helland æ‰€å†™ï¼š\nâ€¦â€¦æ“ä½œä¸­å¿ƒçš„å·¥ä½œå¯ä»¥é€šè¿‡æ­£ç¡®çš„æ“ä½œå’Œæ­£ç¡®çš„è¯­ä¹‰å˜å¾—å¯äº¤æ¢ï¼Œè€Œç®€å•çš„è¯»å–/å†™å…¥è¯­ä¹‰åˆ™ä¸é€‚åˆå¯äº¤æ¢æ€§ã€‚\nä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸ªå®ç°ç®€å•ä¼šè®¡ç³»ç»Ÿçš„ç³»ç»Ÿï¼Œå…¶ä¸­å€Ÿè®°å’Œè´·è®°æ“ä½œä»¥ä¸¤ç§ä¸åŒçš„æ–¹å¼å®ç°ï¼š\nä½¿ç”¨å…·æœ‰è¯»å–å’Œå†™å…¥æ“ä½œçš„å¯„å­˜å™¨ ä½¿ç”¨å…·æœ‰æœ¬åœ°å€Ÿè®°å’Œè´·è®°æ“ä½œçš„æ•´æ•°æ•°æ®ç±»å‹ åä¸€ç§å®ç°å¯¹æ•°æ®ç±»å‹çš„å†…éƒ¨æœ‰æ›´å¤šäº†è§£ï¼Œå› æ­¤å®ƒå¯ä»¥åœ¨æ“ä½œè¢«é‡æ–°æ’åºçš„æƒ…å†µä¸‹ä¿ç•™æ“ä½œçš„æ„å›¾ã€‚å€Ÿè®°æˆ–è´·è®°å¯ä»¥ä»¥ä»»ä½•é¡ºåºåº”ç”¨ï¼Œæœ€ç»ˆç»“æœæ˜¯ç›¸åŒçš„ï¼š\n100 + credit(10) + credit(20) = 130 and 100 + credit(20) + credit(10) = 130 ä½†æ˜¯ï¼Œå†™å…¥å›ºå®šå€¼ä¸èƒ½æŒ‰ä»»ä½•é¡ºåºå®Œæˆï¼šå¦‚æœé‡æ–°æ’åºå†™å…¥ï¼Œåˆ™å…¶ä¸­ä¸€ä¸ªå†™å…¥å°†è¦†ç›–å¦ä¸€ä¸ªï¼š\n100 + write(110) + write(130) = 130 but 100 + write(130) + write(110) = 110 è®©æˆ‘ä»¬é‡‡ç”¨æœ¬ç« å¼€å¤´çš„ç¤ºä¾‹ï¼Œä½†ä½¿ç”¨ä¸åŒçš„æ“ä½œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯å°†æ¶ˆæ¯å‘é€åˆ°ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œè¿™ä¸¤ä¸ªèŠ‚ç‚¹ä»¥ä¸åŒçš„é¡ºåºæŸ¥çœ‹æ“ä½œï¼š\n[Clients] --\u0026gt; [A] 1, 2, 3 [Clients] --\u0026gt; [B] 2, 3, 1 å‡è®¾æˆ‘ä»¬æ­£åœ¨å¯»æ‰¾ä¸€ç»„æ•´æ•°çš„æœ€å¤§å€¼ï¼ˆä¾‹å¦‚ MAX()ï¼‰ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²è¿æ¥ã€‚æ¶ˆæ¯ 1ã€2 å’Œ 3 æ˜¯ï¼š\n1: { operation: max(previous, 3) } 2: { operation: max(previous, 5) } 3: { operation: max(previous, 7) } é‚£ä¹ˆï¼Œå¦‚æœæ²¡æœ‰åè°ƒï¼ŒA å’Œ B éƒ½ä¼šæ”¶æ•›åˆ° 7ï¼Œä¾‹å¦‚ï¼š\nA: max(max(max(0, 3), 5), 7) = 7 B: max(max(max(0, 5), 7), 3) = 7 åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œä¸¤ä¸ªå‰¯æœ¬éƒ½ä¼šä»¥ä¸åŒçš„é¡ºåºçœ‹åˆ°æ›´æ–°ï¼Œä½†æ˜¯æ— è®ºé¡ºåºå¦‚ä½•ï¼Œæˆ‘ä»¬éƒ½èƒ½å¤Ÿä»¥å…·æœ‰ç›¸åŒç»“æœçš„æ–¹å¼åˆå¹¶ç»“æœã€‚ç”±äºæˆ‘ä»¬ä½¿ç”¨äº†åˆå¹¶è¿‡ç¨‹ ( max )ï¼Œä¸¤ç§æƒ…å†µä¸‹çš„ç»“æœéƒ½ä¼šæ”¶æ•›åˆ°ç›¸åŒçš„ç­”æ¡ˆã€‚\nç¼–å†™é€‚ç”¨äºæ‰€æœ‰æ•°æ®ç±»å‹çš„åˆå¹¶è¿‡ç¨‹å¯èƒ½æ˜¯ä¸å¯èƒ½çš„ã€‚åœ¨ Dynamo ä¸­ï¼Œå€¼æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶ blobï¼Œå› æ­¤æœ€å¥½çš„åŠæ³•å°±æ˜¯å…¬å¼€å®ƒå¹¶è¦æ±‚åº”ç”¨ç¨‹åºå¤„ç†æ¯ä¸ªå†²çªã€‚\nä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬çŸ¥é“æ•°æ®å±äºæ›´å…·ä½“çš„ç±»å‹ï¼Œåˆ™å¤„ç†æ­¤ç±»å†²çªå°±æˆä¸ºå¯èƒ½ã€‚ CRDT æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œæ—¨åœ¨æä¾›å§‹ç»ˆæ”¶æ•›çš„æ•°æ®ç±»å‹ï¼Œåªè¦å®ƒä»¬çœ‹åˆ°ç›¸åŒçš„æ“ä½œé›†ï¼ˆä»¥ä»»ä½•é¡ºåºï¼‰ã€‚\nCRDTï¼šèšåˆå¤åˆ¶æ•°æ®ç±»å‹ CRDTï¼ˆæ”¶æ•›å¤åˆ¶æ•°æ®ç±»å‹ï¼‰åˆ©ç”¨æœ‰å…³ç‰¹å®šæ•°æ®ç±»å‹ä¸Šç‰¹å®šæ“ä½œçš„äº¤æ¢æ€§å’Œå…³è”æ€§çš„çŸ¥è¯†ã€‚\nä¸ºäº†åœ¨å‰¯æœ¬ä»…å¶å°”é€šä¿¡çš„ç¯å¢ƒä¸­ä½¿ä¸€ç»„æ“ä½œæ”¶æ•›äºç›¸åŒçš„å€¼ï¼Œè¿™äº›æ“ä½œéœ€è¦ä¸é¡ºåºæ— å…³å¹¶ä¸”å¯¹ï¼ˆæ¶ˆæ¯ï¼‰å¤åˆ¶/é‡æ–°ä¼ é€’ä¸æ•æ„Ÿã€‚å› æ­¤ï¼Œä»–ä»¬çš„æ“ä½œéœ€è¦æ˜¯ï¼š\nå…³è” ( a+(b+c)=(a+b)+c )ï¼Œå› æ­¤åˆ†ç»„å¹¶ä¸é‡è¦ å¯äº¤æ¢ ( a+b=b+a )ï¼Œå› æ­¤åº”ç”¨ç¨‹åºçš„é¡ºåºå¹¶ä¸é‡è¦ å¹‚ç­‰ ( a+a=a )ï¼Œå› æ­¤é‡å¤å¹¶ä¸é‡è¦ åŸæ¥è¿™äº›ç»“æ„åœ¨æ•°å­¦ä¸­å·²ç»è¢«ç§°ä¸º\u0026quot;join\u0026quot;æˆ–\u0026quot;meet\u0026quot;åŠæ ¼ã€‚\næ ¼æ˜¯ä¸€ä¸ªå…·æœ‰æ˜ç¡®çš„é¡¶éƒ¨ï¼ˆæœ€å°ä¸Šç•Œï¼‰å’Œæ˜ç¡®çš„åº•éƒ¨ï¼ˆæœ€å¤§ä¸‹ç•Œï¼‰çš„ååºé›†åˆã€‚åŠæ ¼ç±»ä¼¼äºæ ¼ï¼Œä½†åªæœ‰ä¸€ä¸ªæ˜ç¡®çš„é¡¶éƒ¨æˆ–åº•éƒ¨ã€‚\u0026ldquo;join\u0026quot;åŠæ ¼å…·æœ‰æ˜ç¡®çš„é¡¶éƒ¨ï¼ˆæœ€å°ä¸Šç•Œï¼‰ï¼Œè€Œ\u0026quot;meet\u0026quot;åŠæ ¼å…·æœ‰æ˜ç¡®çš„åº•éƒ¨ï¼ˆæœ€å¤§ä¸‹ç•Œï¼‰ã€‚\nä»»ä½•å¯ä»¥è¡¨ç¤ºä¸ºåŠæ ¼çš„æ•°æ®ç±»å‹éƒ½å¯ä»¥å®ç°ä¸ºä¿è¯æ”¶æ•›çš„æ•°æ®ç»“æ„ã€‚ä¾‹å¦‚ï¼Œè®¡ç®—ä¸€ç»„å€¼çš„æœ€å¤§å€¼(max())å°†å§‹ç»ˆè¿”å›ç›¸åŒçš„ç»“æœï¼Œæ— è®ºæ¥æ”¶å€¼çš„é¡ºåºå¦‚ä½•ï¼Œåªè¦æ‰€æœ‰å€¼æœ€ç»ˆéƒ½è¢«æ¥æ”¶åˆ°ï¼Œå› ä¸ºæœ€å¤§å€¼(max())æ“ä½œæ˜¯å¯ç»“åˆçš„ã€å¯äº¤æ¢çš„å’Œå¹‚ç­‰çš„ã€‚\nä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯ä¸¤ä¸ªæ ¼çš„ç¤ºä¾‹ï¼šä¸€ä¸ªç”¨äºè¡¨ç¤ºé›†åˆï¼Œå…¶ä¸­åˆå¹¶æ“ä½œç¬¦æ˜¯ union(items)ï¼›å¦ä¸€ä¸ªç”¨äºè¡¨ç¤ºä¸¥æ ¼é€’å¢çš„æ•´æ•°è®¡æ•°å™¨ï¼Œå…¶ä¸­åˆå¹¶æ“ä½œç¬¦æ˜¯ max(values)ï¼š\n{ a, b, c } 7 / | \\ / \\ {a, b} {b,c} {a,c} 5 7 | \\ / | / / | \\ {a} {b} {c} 3 5 7 ä½¿ç”¨å¯ä»¥è¡¨ç¤ºä¸ºåŠæ ¼çš„æ•°æ®ç±»å‹ï¼Œæ‚¨å¯ä»¥è®©å‰¯æœ¬ä»¥ä»»ä½•æ¨¡å¼è¿›è¡Œé€šä¿¡å¹¶ä»¥ä»»ä½•é¡ºåºæ¥æ”¶æ›´æ–°ï¼Œåªè¦å®ƒä»¬éƒ½çœ‹åˆ°ç›¸åŒçš„ä¿¡æ¯ï¼Œå®ƒä»¬æœ€ç»ˆå°±ä¼šå°±æœ€ç»ˆç»“æœè¾¾æˆä¸€è‡´ã€‚è¿™æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å±æ€§ï¼Œåªè¦æ»¡è¶³å…ˆå†³æ¡ä»¶ï¼Œå°±å¯ä»¥å¾—åˆ°ä¿è¯ã€‚\nç„¶è€Œï¼Œå°†æ•°æ®ç±»å‹è¡¨ç¤ºä¸ºåŠæ ¼é€šå¸¸éœ€è¦ä¸€å®šç¨‹åº¦çš„è§£é‡Šã€‚è®¸å¤šæ•°æ®ç±»å‹çš„æ“ä½œå®é™…ä¸Šä¸é¡ºåºæ— å…³ã€‚ä¾‹å¦‚ï¼Œå°†é¡¹ç›®æ·»åŠ åˆ°é›†åˆä¸­æ˜¯å…³è”çš„ã€å¯äº¤æ¢çš„å’Œå¹‚ç­‰çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è¿˜å…è®¸ä»é›†åˆä¸­åˆ é™¤é¡¹ç›®ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦æŸç§æ–¹æ³•æ¥è§£å†³å†²çªçš„æ“ä½œï¼Œä¾‹å¦‚ add(A) å’Œ remove(A) ã€‚å¦‚æœæœ¬åœ°å‰¯æœ¬ä»æœªæ·»åŠ è¿‡æŸä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆåˆ é™¤è¯¥å…ƒç´ æ„å‘³ç€ä»€ä¹ˆï¼Ÿè¯¥åˆ†è¾¨ç‡å¿…é¡»ä»¥ä¸é¡ºåºæ— å…³çš„æ–¹å¼æŒ‡å®šï¼Œå¹¶ä¸”æœ‰å‡ ç§ä¸åŒçš„é€‰æ‹©å’Œä¸åŒçš„æƒè¡¡ã€‚\nè¿™æ„å‘³ç€ä¸€äº›ç†Ÿæ‚‰çš„æ•°æ®ç±»å‹å…·æœ‰æ›´ä¸“ä¸šçš„å®ç°ï¼Œä¾‹å¦‚ CRDTï¼Œå®ƒä»¬ä¼šè¿›è¡Œä¸åŒçš„æƒè¡¡ï¼Œä»¥ä¾¿ä»¥ä¸é¡ºåºæ— å…³çš„æ–¹å¼è§£å†³å†²çªã€‚ä¸ä»…å¤„ç†å¯„å­˜å™¨ï¼ˆä¾‹å¦‚ï¼Œä»ç³»ç»Ÿè§’åº¦æ¥çœ‹æ˜¯ä¸é€æ˜ blob çš„å€¼ï¼‰çš„é”®å€¼å­˜å‚¨ä¸åŒï¼Œä½¿ç”¨ CRDT çš„äººå¿…é¡»ä½¿ç”¨æ­£ç¡®çš„æ•°æ®ç±»å‹ä»¥é¿å…å¼‚å¸¸ã€‚\næŒ‡å®šä¸º CRDT çš„ä¸åŒæ•°æ®ç±»å‹çš„ä¸€äº›ç¤ºä¾‹åŒ…æ‹¬ï¼š\nè®¡æ•°å™¨\nä»…å¢é•¿è®¡æ•°å™¨ï¼ˆåˆå¹¶ = max(å€¼)ï¼›æœ‰æ•ˆè´Ÿè½½ = å•ä¸ªæ•´æ•°ï¼‰ æ­£è´Ÿè®¡æ•°å™¨ï¼ˆç”±ä¸¤ä¸ªå¢é•¿è®¡æ•°å™¨ç»„æˆï¼Œä¸€ä¸ªç”¨äºå¢é‡ï¼Œå¦ä¸€ä¸ªç”¨äºå‡é‡ï¼‰ å¯„å­˜å™¨\næœ€åå†™å…¥è·èƒœ -registerï¼ˆæ—¶é—´æˆ³æˆ–ç‰ˆæœ¬å·ï¼›merge = max(ts)ï¼›payload = blobï¼‰ å¤šå€¼å¯„å­˜å™¨ï¼ˆçŸ¢é‡æ—¶é’Ÿï¼›åˆå¹¶=ä¸¤è€…å…¼è€Œæœ‰ä¹‹ï¼‰ é›†åˆ\nä»…å¢é•¿é›†ï¼ˆåˆå¹¶ = union(items)ï¼›æœ‰æ•ˆè´Ÿè½½ = è®¾ç½®ï¼›ä¸åˆ é™¤ï¼‰ ä¸¤ç›¸é›†åˆï¼ˆç”±ä¸¤ä¸ªé›†åˆç»„æˆï¼Œä¸€ä¸ªç”¨äºæ·»åŠ ï¼Œå¦ä¸€ä¸ªç”¨äºåˆ é™¤ï¼›å…ƒç´ å¯ä»¥æ·»åŠ ä¸€æ¬¡ï¼Œåˆ é™¤ä¸€æ¬¡ï¼‰ ç‹¬ç‰¹é›†ï¼ˆä¸¤ç›¸é›†çš„ä¼˜åŒ–ç‰ˆæœ¬ï¼‰ æœ€åä¸€æ¬¡å†™å…¥è·èƒœè®¾ç½®ï¼ˆåˆå¹¶ = max(ts)ï¼›æœ‰æ•ˆè´Ÿè½½ = è®¾ç½®ï¼‰ æ­£è´Ÿç»„ï¼ˆæ¯ç»„é¡¹ç›®åŒ…å«ä¸€ä¸ª PN è®¡æ•°å™¨ï¼‰ è§‚å¯Ÿ-ç§»é™¤é›† å›¾å½¢å’Œæ–‡æœ¬åºåˆ—ï¼ˆå‚è§è®ºæ–‡ï¼‰\nä¸ºäº†ç¡®ä¿æ— å¼‚å¸¸æ“ä½œï¼Œæ‚¨éœ€è¦ä¸ºæ‚¨çš„ç‰¹å®šåº”ç”¨ç¨‹åºæ‰¾åˆ°æ­£ç¡®çš„æ•°æ®ç±»å‹ - ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çŸ¥é“æ‚¨åªä¼šåˆ é™¤ä¸€ä¸ªé¡¹ç›®ä¸€æ¬¡ï¼Œé‚£ä¹ˆä¸¤é˜¶æ®µé›†å°±å¯ä»¥å·¥ä½œï¼›å¦‚æœæ‚¨åªå°†é¡¹ç›®æ·»åŠ åˆ°é›†åˆä¸­å¹¶ä¸”ä»ä¸åˆ é™¤å®ƒä»¬ï¼Œé‚£ä¹ˆä»…å¢é•¿é›†åˆå°±å¯ä»¥äº†ã€‚\nå¹¶éæ‰€æœ‰æ•°æ®ç»“æ„éƒ½æœ‰ CRDT çš„å®ç°ï¼Œä½†åœ¨ Shapiro ç­‰äººæœ€è¿‘ï¼ˆ2011 å¹´ï¼‰çš„è°ƒæŸ¥è®ºæ–‡ä¸­ï¼Œæœ‰å¸ƒå°”å€¼ã€è®¡æ•°å™¨ã€é›†åˆã€å¯„å­˜å™¨å’Œå›¾å½¢çš„ CRDT å®ç°ã€‚\næœ‰è¶£çš„æ˜¯ï¼Œå¯„å­˜å™¨å®ç°ç›´æ¥ä¸é”®å€¼å­˜å‚¨ä½¿ç”¨çš„å®ç°ç›¸å¯¹åº”ï¼šæœ€åå†™å…¥è·èƒœå¯„å­˜å™¨ä½¿ç”¨æ—¶é—´æˆ³æˆ–æŸäº›ç­‰æ•ˆé¡¹ï¼Œå¹¶ä¸”ç®€å•åœ°æ”¶æ•›åˆ°æœ€å¤§æ—¶é—´æˆ³å€¼ï¼›å¤šå€¼å¯„å­˜å™¨å¯¹åº”äºä¿ç•™ã€å…¬å¼€å’Œåè°ƒå¹¶å‘æ›´æ”¹çš„ Dynamo ç­–ç•¥ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œæˆ‘å»ºè®®æ‚¨æŸ¥çœ‹æœ¬ç« å»¶ä¼¸é˜…è¯»éƒ¨åˆ†ä¸­çš„è®ºæ–‡ã€‚\nCALM å®šç† æ‚¨æåˆ°çš„ CRDT æ•°æ®ç»“æ„æ˜¯åŸºäºä¸€ç§è®¤è¯†ï¼Œå³å¯è¡¨ç¤ºä¸ºåŠæ ¼çš„æ•°æ®ç»“æ„æ˜¯æ”¶æ•›çš„ã€‚ä½†æ˜¯ï¼Œç¼–ç¨‹ä¸ä»…ä»…æ¶‰åŠçŠ¶æ€çš„æ¼”åŒ–ï¼Œé™¤éæ‚¨åªæ˜¯åœ¨å®ç°ä¸€ä¸ªæ•°æ®å­˜å‚¨ã€‚\næ˜¾ç„¶ï¼Œæ— åºæ€§æ˜¯ä»»ä½•æ”¶æ•›è®¡ç®—çš„é‡è¦å±æ€§ï¼šå¦‚æœæ•°æ®é¡¹æ¥æ”¶çš„é¡ºåºå½±å“è®¡ç®—çš„ç»“æœï¼Œé‚£ä¹ˆæ²¡æœ‰åŠæ³•åœ¨ä¸ä¿è¯é¡ºåºçš„æƒ…å†µä¸‹æ‰§è¡Œè®¡ç®—ã€‚\nç„¶è€Œï¼Œåœ¨è®¸å¤šç¼–ç¨‹æ¨¡å‹ä¸­ï¼Œè¯­å¥çš„é¡ºåºå¹¶ä¸èµ·é‡è¦ä½œç”¨ã€‚ä¾‹å¦‚ï¼Œåœ¨ MapReduce æ¨¡å‹ä¸­ï¼ŒMap å’Œ Reduce ä»»åŠ¡éƒ½è¢«æŒ‡å®šä¸ºæ— çŠ¶æ€çš„å…ƒç»„å¤„ç†ä»»åŠ¡ï¼Œéœ€è¦åœ¨æ•°æ®é›†ä¸Šè¿è¡Œã€‚å…³äºå¦‚ä½•ä»¥åŠä»¥ä»€ä¹ˆé¡ºåºå°†æ•°æ®è·¯ç”±åˆ°ä»»åŠ¡çš„å…·ä½“å†³ç­–å¹¶æ²¡æœ‰æ˜ç¡®æŒ‡å®šï¼Œè€Œæ˜¯ç”±æ‰¹å¤„ç†ä½œä¸šè°ƒåº¦å™¨è´Ÿè´£å°†ä»»åŠ¡å®‰æ’åœ¨é›†ç¾¤ä¸Šè¿è¡Œã€‚\nç±»ä¼¼åœ°ï¼Œåœ¨ SQL ä¸­ï¼Œæˆ‘ä»¬åªæŒ‡å®šæŸ¥è¯¢ï¼Œè€Œä¸æŒ‡å®šæŸ¥è¯¢çš„æ‰§è¡Œæ–¹å¼ã€‚æŸ¥è¯¢åªæ˜¯ä»»åŠ¡çš„å£°æ˜æ€§æè¿°ï¼ŒæŸ¥è¯¢ä¼˜åŒ–å™¨è´Ÿè´£æ‰¾å‡ºæ‰§è¡ŒæŸ¥è¯¢çš„é«˜æ•ˆæ–¹å¼ï¼ˆè·¨å¤šä¸ªæœºå™¨ã€æ•°æ®åº“å’Œè¡¨ï¼‰ã€‚\nå½“ç„¶ï¼Œè¿™äº›ç¼–ç¨‹æ¨¡å‹å¹¶ä¸åƒé€šç”¨ç¼–ç¨‹è¯­è¨€é‚£æ ·è‡ªç”±ã€‚MapReduce ä»»åŠ¡éœ€è¦åœ¨æ— ç¯æ•°æ®æµç¨‹åºä¸­è¡¨è¾¾ä¸ºæ— çŠ¶æ€ä»»åŠ¡ï¼›SQL è¯­å¥å¯ä»¥æ‰§è¡Œç›¸å½“å¤æ‚çš„è®¡ç®—ï¼Œä½†å¾ˆå¤šä¸œè¥¿å¾ˆéš¾ç”¨å®ƒæ¥è¡¨è¾¾ã€‚\nç„¶è€Œï¼Œä»è¿™ä¸¤ä¸ªç¤ºä¾‹å¯ä»¥æ¸…æ¥šåœ°çœ‹å‡ºï¼Œæœ‰è®¸å¤šç§æ•°æ®å¤„ç†ä»»åŠ¡å¯ä»¥åœ¨å£°æ˜æ€§è¯­è¨€ä¸­è¡¨è¾¾ï¼Œè€Œä¸éœ€è¦æ˜ç¡®æŒ‡å®šæ‰§è¡Œé¡ºåºã€‚è¡¨è¾¾æ‰€éœ€ç»“æœçš„ç¼–ç¨‹æ¨¡å‹ï¼ŒåŒæ—¶å°†è¯­å¥çš„ç¡®åˆ‡é¡ºåºäº¤ç»™ä¼˜åŒ–å™¨å†³å®šï¼Œå¾€å¾€å…·æœ‰æ— åºæ€§çš„è¯­ä¹‰ã€‚è¿™æ„å‘³ç€è¿™æ ·çš„ç¨‹åºå¯èƒ½å¯ä»¥åœ¨æ²¡æœ‰åè°ƒçš„æƒ…å†µä¸‹æ‰§è¡Œï¼Œå› ä¸ºå®ƒä»¬ä¾èµ–äºæ¥æ”¶åˆ°çš„è¾“å…¥ï¼Œè€Œä¸ä¸€å®šä¾èµ–äºè¾“å…¥çš„ç‰¹å®šé¡ºåºã€‚\nå…³é”®ç‚¹æ˜¯è¿™æ ·çš„ç¨‹åºå¯èƒ½å¯ä»¥åœ¨æ²¡æœ‰åè°ƒçš„æƒ…å†µä¸‹å®‰å…¨åœ°æ‰§è¡Œã€‚å¦‚æœæ²¡æœ‰æ˜ç¡®çš„è§„åˆ™æ¥æè¿°ä»€ä¹ˆå¯ä»¥åœ¨æ²¡æœ‰åè°ƒçš„æƒ…å†µä¸‹æ‰§è¡Œï¼Œä»€ä¹ˆä¸èƒ½ï¼Œåœ¨ä¿è¯ç»“æœæ­£ç¡®çš„å‰æä¸‹ï¼Œæˆ‘ä»¬æ— æ³•å®ç°ä¸€ä¸ªç¨‹åºã€‚\nè¿™å°±æ˜¯ CALM å®šç†çš„å†…å®¹ã€‚CALM å®šç†åŸºäºå¯¹é€»è¾‘å•è°ƒæ€§å’Œæœ‰ç”¨çš„æœ€ç»ˆä¸€è‡´æ€§å½¢å¼ï¼ˆå¦‚æ”¶æ•›æ€§ï¼‰ä¹‹é—´å…³ç³»çš„è®¤è¯†ã€‚å®ƒå£°æ˜é€»è¾‘ä¸Šå•è°ƒçš„ç¨‹åºä¿è¯æœ€ç»ˆä¸€è‡´ã€‚\nå› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬çŸ¥é“æŸä¸ªè®¡ç®—åœ¨é€»è¾‘ä¸Šæ˜¯å•è°ƒçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬çŸ¥é“å®ƒä¹Ÿå¯ä»¥åœ¨æ²¡æœ‰åè°ƒçš„æƒ…å†µä¸‹å®‰å…¨åœ°æ‰§è¡Œã€‚\nä¸ºäº†æ›´å¥½åœ°ç†è§£è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦å°†å•è°ƒé€»è¾‘ï¼ˆæˆ–å•è°ƒè®¡ç®—ï¼‰ä¸éå•è°ƒé€»è¾‘ï¼ˆæˆ–éå•è°ƒè®¡ç®—ï¼‰è¿›è¡Œå¯¹æ¯”ã€‚\nå•è°ƒæ€§ å¦‚æœå¥å­ Ï† æ˜¯ä¸€ç»„å‰æ Î“ çš„ç»“è®ºï¼Œé‚£ä¹ˆå®ƒä¹Ÿå¯ä»¥ä»ä»»ä½•æ‰©å±• Î“ çš„å‰æé›† Î” ä¸­æ¨æ–­å‡ºæ¥ã€‚ å¤§å¤šæ•°æ ‡å‡†é€»è¾‘æ¡†æ¶éƒ½æ˜¯å•è°ƒçš„ï¼šåœ¨è¯¸å¦‚ä¸€é˜¶é€»è¾‘çš„æ¡†æ¶ä¸­è¿›è¡Œçš„ä»»ä½•æ¨ç†ï¼Œä¸€æ—¦ç»è¿‡æ¼”ç»éªŒè¯ï¼Œå°±ä¸ä¼šè¢«æ–°ä¿¡æ¯æ— æ•ˆã€‚éå•è°ƒé€»è¾‘æ˜¯ä¸€ç§ä¸å…·å¤‡è¿™ä¸€å±æ€§çš„ç³»ç»Ÿï¼Œæ¢å¥è¯è¯´ï¼ŒæŸäº›ç»“è®ºå¯èƒ½ä¼šè¢«å­¦ä¹ æ–°çŸ¥è¯†æ‰€å¦å®šã€‚\nåœ¨äººå·¥æ™ºèƒ½é¢†åŸŸï¼Œéå•è°ƒé€»è¾‘ä¸å¯åºŸå¼ƒæ¨ç†ç›¸å…³è”ï¼Œå³åˆ©ç”¨éƒ¨åˆ†ä¿¡æ¯è¿›è¡Œçš„æ–­è¨€å¯ä»¥è¢«å­¦ä¹ æ–°çŸ¥è¯†æ‰€å¦å®šã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬å¾—çŸ¥ Tweety æ˜¯ä¸€åªé¸Ÿï¼Œæˆ‘ä»¬ä¼šè®¤ä¸º Tweety å¯ä»¥é£ï¼›ä½†æ˜¯å¦‚æœæˆ‘ä»¬åæ¥å¾—çŸ¥ Tweety æ˜¯ä¸€åªä¼é¹…ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æˆ‘æ˜ç™½æ‚¨æåˆ°çš„ CALM å®šç†å’Œå•è°ƒæ€§çš„æ¦‚å¿µã€‚CALM å®šç†æŒ‡å‡ºï¼Œåœ¨é€»è¾‘ä¸Šå•è°ƒçš„è®¡ç®—æœ€ç»ˆå°†è¾¾åˆ°ä¸€è‡´çŠ¶æ€ã€‚å•è°ƒæ€§æ˜¯ä¸€ä¸ªé‡è¦çš„ç‰¹æ€§ï¼Œå®ƒè¡¨ç¤ºå½“æˆ‘ä»¬è·å¾—æ›´å¤šçš„ä¿¡æ¯æ—¶ï¼Œæˆ‘ä»¬çš„ç»“è®ºä¸ä¼šè¢«å¦å®šã€‚\nåœ¨ç¼–ç¨‹ä¸­ï¼Œç‰¹å®šçš„ç¼–ç¨‹æ¨¡å‹å¯èƒ½æ˜¯å•è°ƒçš„ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨æ²¡æœ‰åè°ƒçš„æƒ…å†µä¸‹å®‰å…¨åœ°æ‰§è¡Œè¿™äº›æ¨¡å‹ä¸­çš„è®¡ç®—ã€‚ä¾‹å¦‚ï¼Œå…³ç³»ä»£æ•°å’Œ Datalog æ˜¯ä¸¤ç§å…·æœ‰å•è°ƒæ€§çš„ç¼–ç¨‹æ¨¡å‹ã€‚\nåœ¨å…³ç³»ä»£æ•°å’Œ Datalog ä¸­ï¼Œä½¿ç”¨ä¸€ç»„åŸºæœ¬æ“ä½œç¬¦è¿›è¡Œçš„è®¡ç®—è¢«è®¤ä¸ºæ˜¯å•è°ƒçš„ï¼Œä¾‹å¦‚é€‰æ‹©ã€æŠ•å½±ã€è‡ªç„¶è¿æ¥ã€äº¤å‰ä¹˜ç§¯ã€å¹¶é›†å’Œé€’å½’ Datalogï¼ˆä¸åŒ…å«å¦å®šï¼‰ã€‚è€Œä½¿ç”¨æ›´é«˜çº§çš„æ“ä½œç¬¦ï¼ˆå¦å®šã€é›†åˆå·®ã€é™¤æ³•ã€å…¨ç§°é‡åŒ–ã€èšåˆï¼‰ä¼šå¼•å…¥éå•è°ƒæ€§ã€‚\nè¿™æ„å‘³ç€åœ¨è¿™äº›ç³»ç»Ÿä¸­ä½¿ç”¨è®¸å¤šæ“ä½œç¬¦ï¼ˆä¾‹å¦‚ mapã€filterã€joinã€unionã€intersectionï¼‰çš„è®¡ç®—åœ¨é€»è¾‘ä¸Šæ˜¯å•è°ƒçš„ï¼Œå› æ­¤å¯ä»¥åœ¨æ²¡æœ‰åè°ƒçš„æƒ…å†µä¸‹å®‰å…¨è¿è¡Œã€‚è€Œä½¿ç”¨å¦å®šå’Œèšåˆçš„è¡¨è¾¾å¼åˆ™ä¸é€‚åˆåœ¨æ²¡æœ‰åè°ƒçš„æƒ…å†µä¸‹è¿è¡Œã€‚\nç¡®å®šè®¡ç®—æ˜¯å¦å•è°ƒå¹¶ä¸å®¹æ˜“ï¼Œç‰¹åˆ«æ˜¯å¯¹äºä¼ ç»Ÿçš„ç¼–ç¨‹è¯­è¨€ï¼Œå…¶ä¸­é¡ºåºã€é€‰æ‹©å’Œè¿­ä»£æ˜¯æ ¸å¿ƒã€‚å› æ­¤ï¼Œä¸ºäº†èƒ½å¤Ÿæµ‹è¯•å•è°ƒæ€§å¹¶è¿›è¡Œé™æ€åˆ†æï¼Œéœ€è¦ä¸åŒç±»å‹çš„ç¼–ç¨‹è¯­è¨€ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆè®¾è®¡äº† Bloom è¯­è¨€çš„åŸå› ã€‚\næ€»è€Œè¨€ä¹‹ï¼Œå•è°ƒæ€§åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ‰§è¡Œæ˜¯é‡è¦çš„ï¼Œå› ä¸ºå®ƒå¯ä»¥å‡å°‘åè°ƒçš„éœ€è¦ï¼Œå¹¶æé«˜ç³»ç»Ÿçš„æ€§èƒ½ã€‚é€šè¿‡ä½¿ç”¨å•è°ƒæ€§è¿›è¡Œé™æ€åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šå“ªäº›éƒ¨åˆ†çš„è®¡ç®—æ˜¯å•è°ƒçš„ï¼Œå¹¶å¯ä»¥åœ¨æ²¡æœ‰åè°ƒçš„æƒ…å†µä¸‹è¿è¡Œï¼Œä»è€Œå®ç°æ›´é«˜æ•ˆã€æ›´å¯æ‰©å±•çš„è®¡ç®—æ¨¡å‹ã€‚\néå•ä¸€æ€§æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ å•è°ƒæ€§å’Œéå•è°ƒæ€§ä¹‹é—´çš„åŒºåˆ«å¾ˆæœ‰è¶£ã€‚ä¾‹å¦‚ï¼Œå°†ä¸¤ä¸ªæ•°å­—ç›¸åŠ æ˜¯å•è°ƒçš„ï¼Œä½†è®¡ç®—åŒ…å«æ•°å­—çš„ä¸¤ä¸ªèŠ‚ç‚¹çš„èšåˆä¸æ˜¯å•è°ƒçš„ã€‚å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«åœ¨äºä¸€ä¸ªæ˜¯è®¡ç®—ï¼ˆå°†ä¸¤ä¸ªæ•°å­—ç›¸åŠ ï¼‰ï¼Œè€Œå¦ä¸€ä¸ªæ˜¯æ–­è¨€ï¼ˆè®¡ç®—èšåˆï¼‰ã€‚\nè®¡ç®—å’Œæ–­è¨€åœ¨æœ¬è´¨ä¸Šæœ‰æ‰€ä¸åŒã€‚è®¡ç®—æ˜¯æŒ‡æ‰§è¡Œè®¡ç®—æˆ–è¿›è¡Œæ“ä½œä»¥è·å¾—ç»“æœçš„è¿‡ç¨‹ï¼Œå®ƒæ˜¯é€šè¿‡éµå¾ªç‰¹å®šçš„è§„åˆ™å’Œç®—æ³•æ¥è¿›è¡Œçš„ã€‚è®¡ç®—æ˜¯ç¡®å®šæ€§çš„ï¼Œç»™å®šç›¸åŒçš„è¾“å…¥å’Œæ“ä½œï¼Œå®ƒæ€»æ˜¯ä¼šäº§ç”Ÿç›¸åŒçš„è¾“å‡ºã€‚ä¾‹å¦‚ï¼Œå°†ä¸¤ä¸ªæ•°å­—ç›¸åŠ æ‰€éµå¾ªçš„åŠ æ³•è§„åˆ™æ˜¯ç¡®å®šçš„ï¼Œå› æ­¤è®¡ç®—çš„ç»“æœæ€»æ˜¯ä¸€è‡´çš„ã€‚\nç›¸åï¼Œæ–­è¨€æ˜¯å…³äºé™ˆè¿°æˆ–å‘½é¢˜çœŸå®æ€§çš„ä¸»å¼ ã€‚å®ƒè¡¨è¾¾äº†å¯¹æŸä¸ªäº‹å®æˆ–çŸ¥è¯†çš„ä¸»è§‚æ–­å®šã€‚æ–­è¨€æ˜¯åŸºäºå¯ç”¨è¯æ®æˆ–å‡è®¾çš„ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®ä¸åŒçš„ä¸Šä¸‹æ–‡æˆ–è§†è§’è€Œå˜åŒ–ã€‚ä¾‹å¦‚ï¼Œå…³äº\u0026quot;æŠ«è¨æ˜¯è”¬èœ\u0026quot;çš„é™ˆè¿°æ˜¯ä¸€ä¸ªæ–­è¨€ï¼Œæ ¹æ®æ‰€çº¦å®šçš„\u0026quot;è”¬èœ\u0026quot;çš„å®šä¹‰ï¼Œå¯ä»¥è¯„ä¼°å…¶çœŸå®æ€§æˆ–è™šå‡æ€§ã€‚\nå½“æ¨ç†å…³äºæ–­è¨€æ—¶ï¼Œæ¶‰åŠåˆ°å„ç§å‡è®¾å’Œä¸Šä¸‹æ–‡ã€‚å¯¹äºè¿™ä¸ªé—®é¢˜\u0026quot;æŠ«è¨æ˜¯è”¬èœå—ï¼Ÿ\u0026quot;ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘ä½•æ—¶å¯ä»¥æ¨æ–­æŸä¸ªå‘½é¢˜çš„çœŸå®æ€§æˆ–è™šå‡æ€§ã€‚\næœ‰å‡ ç§åˆç†çš„å›ç­”ï¼Œæ¯ä¸ªå›ç­”å¯¹åº”ç€å¯¹æˆ‘ä»¬æ‹¥æœ‰çš„ä¿¡æ¯å’Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•å¤„ç†å®ƒçš„ä¸åŒå‡è®¾ã€‚åœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬æ¥å—äº†ä¸åŒçš„ç­”æ¡ˆã€‚\nåœ¨æ—¥å¸¸æ¨ç†ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ‰€è°“çš„\u0026quot;å¼€æ”¾ä¸–ç•Œå‡è®¾\u0026rdquo;ï¼šæˆ‘ä»¬å‡è®¾æˆ‘ä»¬å¹¶ä¸çŸ¥é“ä¸€åˆ‡ï¼Œå› æ­¤ä¸èƒ½æ ¹æ®ç¼ºä¹çŸ¥è¯†æ¥å¾—å‡ºç»“è®ºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»»ä½•é™ˆè¿°éƒ½å¯èƒ½ä¸ºçœŸã€ä¸ºå‡æˆ–æœªçŸ¥ã€‚æ ¹æ®å¼€æ”¾ä¸–ç•Œå‡è®¾ï¼Œæˆ‘ä»¬ä¸ä¼šä»ç¼ºä¹çŸ¥è¯†ä¸­å¾—å‡ºå¦å®šçš„ç»“è®ºï¼Œè€Œæ˜¯æŒå¼€æ”¾çš„æ€åº¦ï¼Œæ¥å—é™ˆè¿°å¯èƒ½ä¸ºæœªçŸ¥çš„å¯èƒ½æ€§ã€‚\nOWA + | OWA + Monotonic logic | Non-monotonic logic Can derive P(true) | Can assert P(true) | Cannot assert P(true) Can derive P(false) | Can assert P(false) | Cannot assert P(true) Cannot derive P(true) | Unknown | Unknown or P(false) åœ¨è¿›è¡Œå¼€æ”¾ä¸–ç•Œå‡è®¾æ—¶ï¼Œæˆ‘ä»¬åªèƒ½å®‰å…¨åœ°æ–­è¨€æˆ‘ä»¬å¯ä»¥ä»å·²çŸ¥ä¿¡æ¯ä¸­æ¨å¯¼å‡ºçš„å†…å®¹ã€‚æˆ‘ä»¬å‡è®¾å¯¹ä¸–ç•Œçš„ä¿¡æ¯æ˜¯ä¸å®Œå…¨çš„ã€‚\né¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬çŸ¥é“æ¨ç†æ˜¯å•è°ƒçš„æƒ…å†µã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ‹¥æœ‰çš„ä»»ä½•ï¼ˆå¯èƒ½ä¸å®Œæ•´çš„ï¼‰çŸ¥è¯†éƒ½ä¸ä¼šå› ä¸ºå­¦ä¹ æ–°çŸ¥è¯†è€Œå¤±æ•ˆã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥åŸºäºæŸç§æ¨ç†ï¼ˆä¾‹å¦‚ï¼Œâ€œå«æœ‰ä¸¤æ±¤åŒ™ç•ªèŒ„é…±çš„ç‰©å“æ˜¯è”¬èœâ€å’Œâ€œæ¯”è¨å«æœ‰ä¸¤æ±¤åŒ™ç•ªèŒ„é…±â€ï¼‰æ¨æ–­æŸä¸ªé™ˆè¿°ä¸ºçœŸï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¾—å‡ºâ€œæ¯”è¨æ˜¯è”¬èœâ€çš„ç»“è®ºã€‚åŒæ ·ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥æ¨æ–­æŸä¸ªé™ˆè¿°ä¸ºå‡ï¼Œä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚\nç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬æ— æ³•æ¨å¯¼å‡ºä»»ä½•ç»“è®º - ä¾‹å¦‚ï¼Œæˆ‘ä»¬æŒæ¡çš„çŸ¥è¯†é›†åˆåªåŒ…å«é¡¾å®¢ä¿¡æ¯ï¼Œè€Œæ²¡æœ‰å…³äºæ¯”è¨æˆ–è”¬èœçš„ä»»ä½•ä¿¡æ¯ - é‚£ä¹ˆæ ¹æ®å¼€æ”¾ä¸–ç•Œå‡è®¾ï¼Œæˆ‘ä»¬å¿…é¡»è¯´æˆ‘ä»¬æ— æ³•å¾—å‡ºä»»ä½•ç»“è®ºã€‚\nå¯¹äºéå•è°ƒçŸ¥è¯†ï¼Œæˆ‘ä»¬ç°åœ¨æ‰€çŸ¥é“çš„ä»»ä½•å†…å®¹éƒ½æœ‰å¯èƒ½è¢«å¦å®šã€‚å› æ­¤ï¼Œå³ä½¿æˆ‘ä»¬å¯ä»¥ä»å½“å‰æ‰€çŸ¥çš„å†…å®¹ä¸­æ¨å¯¼å‡ºçœŸæˆ–å‡ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½å®‰å…¨åœ°å¾—å‡ºä»»ä½•ç»“è®ºã€‚\nç„¶è€Œï¼Œåœ¨æ•°æ®åº“ä¸Šä¸‹æ–‡ä¸­ï¼Œä»¥åŠåœ¨è®¸å¤šè®¡ç®—æœºç§‘å­¦åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬æ›´å€¾å‘äºå¾—å‡ºæ›´æ˜ç¡®çš„ç»“è®ºã€‚è¿™æ„å‘³ç€é‡‡ç”¨äº†æ‰€è°“çš„å°é—­ä¸–ç•Œå‡è®¾ï¼šå³ä¸èƒ½æ˜¾ç¤ºä¸ºçœŸçš„ä»»ä½•å†…å®¹éƒ½è¢«è®¤ä¸ºæ˜¯å‡çš„ã€‚è¿™æ„å‘³ç€ä¸éœ€è¦æ˜ç¡®å£°æ˜ä¸ºå‡ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å‡è®¾æ‹¥æœ‰çš„äº‹å®æ•°æ®åº“æ˜¯å®Œæ•´ï¼ˆæœ€å°çš„ï¼‰ï¼Œå› æ­¤å¯ä»¥å‡è®¾å…¶ä¸­æ²¡æœ‰çš„ä»»ä½•å†…å®¹éƒ½æ˜¯å‡çš„ã€‚\nä¾‹å¦‚ï¼Œåœ¨å°é—­ä¸–ç•Œå‡è®¾ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬çš„æ•°æ®åº“ä¸­æ²¡æœ‰æ—§é‡‘å±±åˆ°èµ«å°”è¾›åŸºä¹‹é—´çš„èˆªç­ä¿¡æ¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å®‰å…¨åœ°å¾—å‡ºç»“è®ºè¯´ä¸å­˜åœ¨è¿™æ ·çš„èˆªç­ã€‚\næˆ‘ä»¬éœ€è¦å¦å¤–ä¸€ä»¶äº‹æ‰èƒ½å¤Ÿåšå‡ºæ˜ç¡®çš„æ–­è¨€ï¼šé€»è¾‘å°è£…ã€‚å°è£…æ˜¯ä¸€ç§æ¨æµ‹çš„å½¢å¼åŒ–è§„åˆ™ã€‚åŸŸå°è£…å‡è®¾å·²çŸ¥å®ä½“å°±æ˜¯å…¨éƒ¨å®ä½“ã€‚ä¸ºäº†å¾—å‡ºæ˜ç¡®çš„ç»“è®ºï¼Œæˆ‘ä»¬éœ€è¦å‡è®¾æ‰€çŸ¥çš„å®ä½“å°±æ˜¯å…¨éƒ¨å®ä½“ã€‚\nCWA + | CWA + Circumscription + | Circumscription + Monotonic logic | Non-monotonic logic Can derive P(true) | Can assert P(true) | Can assert P(true) Can derive P(false) | Can assert P(false) | Can assert P(false) Cannot derive P(true) | Can assert P(false) | Can assert P(false) or P(false) ç‰¹åˆ«æ˜¯ï¼Œéå•è°ƒæ¨ç†éœ€è¦è¿™ä¸ªå‡è®¾ã€‚åªæœ‰åœ¨æˆ‘ä»¬å‡è®¾æ‹¥æœ‰å®Œæ•´ä¿¡æ¯çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ‰èƒ½åšå‡ºè‡ªä¿¡çš„æ–­è¨€ï¼Œå› ä¸ºé¢å¤–çš„ä¿¡æ¯å¯èƒ½ä¼šå¦å®šæˆ‘ä»¬çš„æ–­è¨€ã€‚\nè¿™åœ¨å®è·µä¸­æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿé¦–å…ˆï¼Œå•è°ƒé€»è¾‘å¯ä»¥åœ¨èƒ½å¤Ÿæ¨å¯¼å‡ºä¸€ä¸ªå¥å­ä¸ºçœŸï¼ˆæˆ–å‡ï¼‰æ—¶å¾—å‡ºç¡®å®šçš„ç»“è®ºã€‚å…¶æ¬¡ï¼Œéå•è°ƒé€»è¾‘éœ€è¦é¢å¤–çš„å‡è®¾ï¼šå·²çŸ¥å®ä½“å°±æ˜¯å…¨éƒ¨å®ä½“ã€‚\né‚£ä¹ˆä¸ºä»€ä¹ˆè¡¨é¢ä¸Šç­‰ä»·çš„ä¸¤ä¸ªæ“ä½œä¼šæœ‰æ‰€ä¸åŒå‘¢ï¼Ÿä¸ºä»€ä¹ˆåŠ æ³•æ˜¯å•è°ƒçš„ï¼Œè€Œåœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šè¿›è¡Œèšåˆè®¡ç®—å´ä¸æ˜¯ï¼Ÿå› ä¸ºèšåˆè®¡ç®—ä¸ä»…è®¡ç®—æ€»å’Œï¼Œè¿˜æ–­è¨€å®ƒå·²ç»çœ‹åˆ°äº†æ‰€æœ‰çš„å€¼ã€‚è€Œè¦ä¿è¯è¿™ä¸€ç‚¹ï¼Œéœ€è¦åœ¨èŠ‚ç‚¹ä¹‹é—´è¿›è¡Œåè°ƒï¼Œç¡®ä¿æ‰§è¡Œè®¡ç®—çš„èŠ‚ç‚¹ç¡®å®åœ¨ç³»ç»Ÿä¸­çœ‹åˆ°äº†æ‰€æœ‰çš„å€¼ã€‚\nå› æ­¤ï¼Œä¸ºäº†å¤„ç†éå•è°ƒæ€§ï¼Œéœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼åè°ƒæ¥ç¡®ä¿åªæœ‰åœ¨äº†è§£æ‰€æœ‰ä¿¡æ¯ä¹‹åæ‰è¿›è¡Œæ–­è¨€ï¼Œæˆ–è€…åœ¨æ–­è¨€ä¸­é™„å¸¦è­¦å‘Šï¼Œå³ç»“è®ºå¯èƒ½åœ¨ä»¥åè¢«å¦å®šã€‚\nå¤„ç†éå•è°ƒæ€§å¯¹äºè¡¨è¾¾èƒ½åŠ›éå¸¸é‡è¦ã€‚è¿™å½’ç»“ä¸ºèƒ½å¤Ÿè¡¨è¾¾éå•è°ƒçš„äº‹ç‰©ï¼›ä¾‹å¦‚ï¼Œèƒ½å¤Ÿè¯´æŸä¸€åˆ—çš„æ€»å’Œæ˜¯ X æ˜¯å¾ˆå¥½çš„ã€‚ç³»ç»Ÿå¿…é¡»æ£€æµ‹åˆ°è¿™ç§è®¡ç®—éœ€è¦å…¨å±€åè°ƒè¾¹ç•Œï¼Œä»¥ç¡®ä¿æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†æ‰€æœ‰çš„å®ä½“ã€‚\nçº¯ç²¹çš„å•è°ƒç³»ç»Ÿå¾ˆå°‘è§ã€‚ä¼¼ä¹å¤§å¤šæ•°åº”ç”¨ç¨‹åºåœ¨æ‹¥æœ‰ä¸å®Œæ•´æ•°æ®æ—¶ä¹Ÿæ˜¯åŸºäºå°é—­ä¸–ç•Œå‡è®¾è¿è¡Œçš„ï¼Œè€Œæˆ‘ä»¬äººç±»å¯¹æ­¤ä¹Ÿæ²¡æœ‰æ„è§ã€‚å½“ä¸€ä¸ªæ•°æ®åº“å‘Šè¯‰ä½ æ—§é‡‘å±±å’Œèµ«å°”è¾›åŸºä¹‹é—´æ²¡æœ‰ç›´è¾¾èˆªç­æ—¶ï¼Œä½ å¯èƒ½ä¼šæŠŠå®ƒç†è§£ä¸ºâ€œæ ¹æ®è¿™ä¸ªæ•°æ®åº“ï¼Œä¸å­˜åœ¨ç›´è¾¾èˆªç­â€ï¼Œä½†ä½ å¹¶ä¸æ’é™¤ç°å®ä¸­å¯èƒ½ä»ç„¶å­˜åœ¨è¿™æ ·ä¸€ç§èˆªç­çš„å¯èƒ½æ€§ã€‚\näº‹å®ä¸Šï¼Œåªæœ‰åœ¨å¤åˆ¶å“å‡ºç°åˆ†æ­§æ—¶ï¼ˆä¾‹å¦‚åœ¨åˆ†åŒºæœŸé—´æˆ–ç”±äºæ­£å¸¸æ“ä½œæœŸé—´çš„å»¶è¿Ÿï¼‰ï¼Œè¿™ä¸ªé—®é¢˜æ‰å˜å¾—æœ‰è¶£ã€‚é‚£æ—¶å°±éœ€è¦æ›´å…·ä½“çš„è€ƒè™‘ï¼šç­”æ¡ˆæ˜¯åŸºäºå½“å‰èŠ‚ç‚¹è¿˜æ˜¯åŸºäºæ•´ä¸ªç³»ç»Ÿã€‚\næ­¤å¤–ï¼Œç”±äºéå•è°ƒæ€§æ˜¯é€šè¿‡åšå‡ºæ–­è¨€æ¥å¼•èµ·çš„ï¼Œè®¸å¤šè®¡ç®—ä¼¼ä¹å¯ä»¥è¿›è¡Œå¾ˆé•¿æ—¶é—´ï¼Œåªæœ‰åœ¨å°†æŸä¸ªç»“æœæˆ–æ–­è¨€ä¼ é€’ç»™ç¬¬ä¸‰æ–¹ç³»ç»Ÿæˆ–æœ€ç»ˆç”¨æˆ·æ—¶æ‰åº”ç”¨åè°ƒã€‚å½“ç„¶ï¼Œå¹¶ä¸éœ€è¦åœ¨ç³»ç»Ÿå†…çš„æ¯ä¸ªè¯»å†™æ“ä½œéƒ½å¼ºåˆ¶æ‰§è¡Œæ€»åºï¼Œå¦‚æœè¿™äº›è¯»å†™æ“ä½œåªæ˜¯é•¿æ—¶é—´è¿è¡Œè®¡ç®—çš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆè¿™æ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚\nå¸ƒéš†è¯­è¨€ Bloom è¯­è¨€æ˜¯ä¸€ç§æ—¨åœ¨åˆ©ç”¨ CALM å®šç†çš„è¯­è¨€ã€‚å®ƒæ˜¯ä¸€ç§ Ruby DSLï¼Œå…¶å½¢å¼åŸºç¡€æ˜¯ä¸€ç§ç§°ä¸º Dedalus çš„æ—¶åºé€»è¾‘ç¼–ç¨‹è¯­è¨€ã€‚\nåœ¨ Bloom ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªç”±é›†åˆå’Œæ ¼ç»„æˆçš„æ•°æ®åº“ã€‚ç¨‹åºè¢«è¡¨ç¤ºä¸ºä¸é›†åˆï¼ˆäº‹å®é›†ï¼‰å’Œæ ¼ï¼ˆCRDTï¼‰äº¤äº’çš„æ— åºè¯­å¥é›†ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯­å¥æ˜¯ä¸é¡ºåºæ— å…³çš„ï¼Œä½†ä¹Ÿå¯ä»¥ç¼–å†™éå•è°ƒå‡½æ•°ã€‚\nè¯·è®¿é—® Bloom ç½‘ç«™å’Œæ•™ç¨‹ï¼Œäº†è§£æœ‰å…³ Bloom çš„æ›´å¤šä¿¡æ¯ã€‚\nè¿›ä¸€æ­¥é˜…è¯» CALM å®šç†ã€æ±‡åˆåˆ†æå’Œ Bloom Joe Hellerstein çš„æ¼”è®²@RICON 2012 å¾ˆå¥½åœ°ä»‹ç»äº†è¯¥ä¸»é¢˜ï¼ŒNeil Conway çš„æ¼”è®²@Basho ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ç‰¹åˆ«æ˜¯å¯¹äº Bloomï¼Œè¯·å‚é˜… Peter Alvaro çš„ talk@Microsoftã€‚\nThe Declarative Imperative: Experiences and Conjectures in Distributed Logic - Hellerstein, 2010 Consistency Analysis in Bloom: a CALM and Collected Approach - Alvaro et al., 2011 Logic and Lattices for Distributed Programming - Conway et al., 2012 Dedalus: Datalog in Time and Space - Alvaro et al., 2011 CRDTs CRDT Marc Shapiro\u0026rsquo;s talk @ Microsoft is a good starting point for understanding CRDT\u0026rsquo;s.\nCRDTs: Consistency Without Concurrency Control - Letitia et al., 2009 A comprehensive study of Convergent and Commutative Replicated Data Types, Shapiro et al., 2011 An Optimized conflict-free Replicated Set - Bieniusa et al., 2012 Dynamo; PBSï¼›ä¹è§‚å¤åˆ¶ Dynamo: Amazonâ€™s Highly Available Key-value Store - DeCandia et al., 2007 PNUTS: Yahoo!\u0026rsquo;s Hosted Data Serving Platform - Cooper et al., 2008 The Bayou Architecture: Support for Data Sharing among Mobile Users - Demers et al. 1994 Probabilistically Bound Staleness for Practical Partial Quorums - Bailis et al., 2012 Eventual Consistency Today: Limitations, Extensions, and Beyond - Bailis \u0026amp; Ghodsi, 2013 Optimistic replication - Saito \u0026amp; Shapiro, 2005 ","permalink":"https://blog.chensoul.cc/posts/2023/11/10/distributed-systems-05/","summary":"ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹æ˜¯ä¸€æœ¬å¹¿å—æ¬¢è¿çš„èµ„æºï¼Œç”¨äºç†è§£å’Œå­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿã€‚è¯¥ä¹¦ç”±ä½œè€… Mikito Takada æ’°å†™ï¼Œä»‹ç»äº†æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºæœ¬æ¦‚å¿µã€åŸåˆ™å’ŒæŒ‘æˆ˜ã€‚\nè¿™æœ¬ä¹¦æ¶µç›–äº†ä¸åˆ†å¸ƒå¼ç³»ç»Ÿç›¸å…³çš„å¹¿æ³›ä¸»é¢˜ï¼ŒåŒ…æ‹¬ç½‘ç»œã€å®¹é”™æ€§ã€ä¸€è‡´æ€§æ¨¡å‹ã€åˆ†å¸ƒå¼ç®—æ³•ã€å¯æ‰©å±•æ€§ç­‰ç­‰ã€‚å®ƒæ—¨åœ¨ä»¥æ¸…æ™°æ˜“æ‡‚çš„æ–¹å¼è§£é‡Šå¤æ‚çš„æ¦‚å¿µï¼Œé€‚åˆåˆå­¦è€…å’Œæœ‰ç»éªŒçš„åˆ†å¸ƒå¼ç³»ç»Ÿä»ä¸šè€…é˜…è¯»ã€‚\nåœ¨æ•´æœ¬ä¹¦ä¸­ï¼Œä½œè€…æä¾›äº†å„ç§å®é™…æ¡ˆä¾‹å’Œæ¡ˆä¾‹ç ”ç©¶ï¼Œä»¥è¯´æ˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®é™…åº”ç”¨å’Œå®è·µæ–¹é¢ã€‚å®ƒè¿˜å¼ºè°ƒäº†æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿæ¶‰åŠçš„æƒè¡¡å’Œè®¾è®¡è€ƒè™‘ï¼Œå¸®åŠ©è¯»è€…å…¨é¢ç†è§£è¿™ä¸ªä¸»é¢˜ã€‚\nã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹ä½œä¸ºå¼€æºèµ„æºï¼Œå¯ä»¥å…è´¹åœ¨çº¿è·å–ï¼Œéå¸¸é€‚åˆä»»ä½•å¯¹å­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿæ„Ÿå…´è¶£çš„äººã€‚\nåŸæ–‡é“¾æ¥ï¼šDistributed systems: for fun and profit\n5. å¤åˆ¶ï¼šå¼±ä¸€è‡´æ€§æ¨¡å‹åè®® ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»ç ”ç©¶äº†ä¸€äº›å¯ä»¥åœ¨è¶Šæ¥è¶Šç°å®çš„æ•…éšœæƒ…å†µä¸‹å®æ–½å•å‰¯æœ¬ä¸€è‡´æ€§çš„åè®®ï¼Œè®©æˆ‘ä»¬è½¬å‘å½“æˆ‘ä»¬æ”¾å¼ƒå•å‰¯æœ¬ä¸€è‡´æ€§çš„è¦æ±‚æ—¶æ‰€æ‰“å¼€çš„é€‰æ‹©ä¸–ç•Œã€‚\næ€»çš„æ¥è¯´ï¼Œå¾ˆéš¾æ‰¾åˆ°ä¸€ä¸ªå•ä¸€çš„ç»´åº¦æ¥å®šä¹‰æˆ–æè¿°å…è®¸å‰¯æœ¬å‘æ•£çš„åè®®ã€‚å¤§å¤šæ•°è¿™æ ·çš„åè®®éƒ½å…·æœ‰é«˜å¯ç”¨æ€§ï¼Œå…³é”®é—®é¢˜æ›´å¤šåœ°åœ¨äºæœ€ç»ˆç”¨æˆ·æ˜¯å¦å‘ç°è¿™äº›ä¿è¯ã€æŠ½è±¡å’Œ API å¯¹ä»–ä»¬çš„ç›®çš„æœ‰ç”¨ï¼Œå°½ç®¡åœ¨èŠ‚ç‚¹å’Œ/æˆ–ç½‘ç»œæ•…éšœå‘ç”Ÿæ—¶å‰¯æœ¬å¯èƒ½å‘æ•£ã€‚\nä¸ºä»€ä¹ˆå¼±ä¸€è‡´æ€§ç³»ç»Ÿæ²¡æœ‰æ›´å—æ¬¢è¿å‘¢ï¼Ÿ\næ­£å¦‚æˆ‘åœ¨ä»‹ç»ä¸­æ‰€è¿°ï¼Œæˆ‘è®¤ä¸ºåˆ†å¸ƒå¼ç¼–ç¨‹å¾ˆå¤§ç¨‹åº¦ä¸Šæ¶‰åŠå¤„ç†åˆ†å¸ƒçš„ä¸¤ä¸ªç»“æœæ‰€å¸¦æ¥çš„å½±å“ï¼š\nä¿¡æ¯ä»¥å…‰é€Ÿä¼ æ’­ï¼› ç‹¬ç«‹çš„äº‹ç‰©ç‹¬ç«‹åœ°å‘ç”Ÿæ•…éšœã€‚ ç”±äºä¿¡æ¯ä¼ è¾“é€Ÿåº¦å—é™ï¼ŒèŠ‚ç‚¹ä»¥ä¸åŒä¸”ç‹¬ç‰¹çš„æ–¹å¼ä½“éªŒä¸–ç•Œã€‚åœ¨å•ä¸ªèŠ‚ç‚¹ä¸Šè¿›è¡Œè®¡ç®—å¾ˆå®¹æ˜“ï¼Œå› ä¸ºä¸€åˆ‡éƒ½æŒ‰ç…§å¯é¢„æµ‹çš„å…¨å±€æ€»åºå‘ç”Ÿã€‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸Šè¿›è¡Œè®¡ç®—å¾ˆå›°éš¾ï¼Œå› ä¸ºæ²¡æœ‰å…¨å±€æ€»åºã€‚\né•¿æœŸä»¥æ¥ï¼ˆä¾‹å¦‚å‡ åå¹´çš„ç ”ç©¶æ—¶é—´ï¼‰ï¼Œæˆ‘ä»¬é€šè¿‡å¼•å…¥å…¨å±€æ€»åºæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘å·²ç»è®¨è®ºäº†è®¸å¤šå®ç°å¼ºä¸€è‡´æ€§çš„æ–¹æ³•ï¼Œé€šè¿‡åœ¨æ²¡æœ‰è‡ªç„¶æ€»åºçš„æƒ…å†µä¸‹ä»¥å®¹é”™æ–¹å¼åˆ›å»ºé¡ºåºçš„æ–¹æ³•ã€‚\nå½“ç„¶ï¼Œé—®é¢˜åœ¨äºå¼ºåˆ¶æ‰§è¡Œé¡ºåºæ˜¯æ˜‚è´µçš„ã€‚è¿™åœ¨å¤§è§„æ¨¡çš„äº’è”ç½‘ç³»ç»Ÿä¸­ç‰¹åˆ«çªå‡ºï¼Œå› ä¸ºç³»ç»Ÿéœ€è¦ä¿æŒå¯ç”¨æ€§ã€‚å¼ºä¸€è‡´æ€§çš„ç³»ç»Ÿä¸åƒåˆ†å¸ƒå¼ç³»ç»Ÿé‚£æ ·è¿è¡Œï¼Œè€Œæ˜¯åƒå•ä¸ªç³»ç»Ÿï¼Œè¿™å¯¹äºåˆ†åŒºæœŸé—´çš„å¯ç”¨æ€§æ˜¯ä¸åˆ©çš„ã€‚\næ­¤å¤–ï¼Œå¯¹äºæ¯ä¸ªæ“ä½œï¼Œé€šå¸¸éœ€è¦è”ç³»å¤§å¤šæ•°èŠ‚ç‚¹ï¼Œè€Œä¸”é€šå¸¸ä¸æ­¢ä¸€æ¬¡ï¼ˆæ­£å¦‚æ‚¨åœ¨å…³äº 2PC çš„è®¨è®ºä¸­æ‰€çœ‹åˆ°çš„ï¼‰ã€‚è¿™åœ¨éœ€è¦åœ¨åœ°ç†ä¸Šåˆ†å¸ƒä»¥ä¸ºå…¨çƒç”¨æˆ·æä¾›è¶³å¤Ÿæ€§èƒ½çš„ç³»ç»Ÿä¸­å°¤å…¶å›°éš¾ã€‚\nå› æ­¤ï¼Œé»˜è®¤æƒ…å†µä¸‹åƒå•ä¸ªç³»ç»Ÿä¸€æ ·è¿è¡Œå¯èƒ½å¹¶ä¸ç†æƒ³ã€‚\nä¹Ÿè®¸æˆ‘ä»¬å¸Œæœ›æ‹¥æœ‰ä¸€ç§å¯ä»¥ç¼–å†™ä¸ä½¿ç”¨æ˜‚è´µåè°ƒçš„ä»£ç ï¼Œä½†ä»è¿”å›ä¸€ä¸ªâ€œå¯ç”¨â€å€¼çš„ç³»ç»Ÿã€‚æˆ‘ä»¬å°†å…è®¸ä¸åŒçš„å‰¯æœ¬å½¼æ­¤å‘æ•£-æ—¢ä¸ºäº†ä¿æŒæ•ˆç‡ï¼Œä¹Ÿä¸ºäº†å®¹å¿åˆ†åŒº-ç„¶åå°è¯•ä»¥æŸç§æ–¹å¼å¤„ç†è¿™ç§å‘æ•£ã€‚\næœ€ç»ˆä¸€è‡´æ€§è¡¨è¾¾äº†è¿™ä¸ªæƒ³æ³•ï¼šèŠ‚ç‚¹åœ¨ä¸€æ®µæ—¶é—´å†…å¯ä»¥ç›¸äº’å‘æ•£ï¼Œä½†æœ€ç»ˆå®ƒä»¬å°†è¾¾æˆä¸€è‡´çš„å€¼ã€‚\nåœ¨æä¾›æœ€ç»ˆä¸€è‡´æ€§çš„ç³»ç»Ÿé›†åˆä¸­ï¼Œæœ‰ä¸¤ç§ç±»å‹çš„ç³»ç»Ÿè®¾è®¡ï¼š\nå¸¦æœ‰æ¦‚ç‡ä¿è¯çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚è¿™ç§ç±»å‹çš„ç³»ç»Ÿå¯ä»¥åœ¨ä»¥åçš„æŸä¸ªæ—¶é—´ç‚¹æ£€æµ‹åˆ°å†²çªçš„å†™æ“ä½œï¼Œä½†ä¸èƒ½ä¿è¯ç»“æœä¸æŸä¸ªæ­£ç¡®çš„é¡ºåºæ‰§è¡Œç­‰æ•ˆã€‚æ¢å¥è¯è¯´ï¼Œå†²çªçš„æ›´æ–°æœ‰æ—¶ä¼šå¯¼è‡´å°†è¾ƒæ–°çš„å€¼è¦†ç›–ä¸ºè¾ƒæ—§çš„å€¼ï¼Œå¹¶ä¸”åœ¨æ­£å¸¸æ“ä½œï¼ˆæˆ–åˆ†åŒºï¼‰æœŸé—´å¯èƒ½ä¼šå‡ºç°ä¸€äº›å¼‚å¸¸æƒ…å†µã€‚\nè¿‘å¹´æ¥ï¼Œæœ€æœ‰å½±å“åŠ›çš„æä¾›å•å‰¯æœ¬ä¸€è‡´æ€§çš„ç³»ç»Ÿè®¾è®¡æ˜¯äºšé©¬é€Šçš„ Dynamoï¼Œæˆ‘å°†ä»¥å®ƒä½œä¸ºæä¾›å¸¦æœ‰æ¦‚ç‡ä¿è¯çš„æœ€ç»ˆä¸€è‡´æ€§ç³»ç»Ÿç¤ºä¾‹è¿›è¡Œè®¨è®ºã€‚\nå¸¦æœ‰å¼ºä¿è¯çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚è¿™ç§ç±»å‹çš„ç³»ç»Ÿä¿è¯æœ€ç»ˆç»“æœä¼šæ”¶æ•›åˆ°ä¸€ä¸ªå…±åŒçš„å€¼ï¼Œè¯¥å€¼ç­‰åŒäºæŸä¸ªæ­£ç¡®çš„é¡ºåºæ‰§è¡Œã€‚æ¢å¥è¯è¯´ï¼Œè¿™æ ·çš„ç³»ç»Ÿä¸ä¼šäº§ç”Ÿä»»ä½•å¼‚å¸¸ç»“æœï¼›åœ¨æ²¡æœ‰ä»»ä½•åè°ƒçš„æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥æ„å»ºç›¸åŒæœåŠ¡çš„å‰¯æœ¬ï¼Œå¹¶ä¸”è¿™äº›å‰¯æœ¬å¯ä»¥ä»¥ä»»ä½•æ¨¡å¼è¿›è¡Œé€šä¿¡å¹¶ä»¥ä»»ä½•é¡ºåºæ¥æ”¶æ›´æ–°ï¼Œåªè¦å®ƒä»¬éƒ½çœ‹åˆ°ç›¸åŒçš„ä¿¡æ¯ï¼Œå®ƒä»¬æœ€ç»ˆä¼šå°±æœ€ç»ˆç»“æœè¾¾æˆä¸€è‡´ã€‚\nCRDTï¼ˆæ”¶æ•›å¤åˆ¶æ•°æ®ç±»å‹ï¼‰æ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œå®ƒä¿è¯åœ¨ç½‘ç»œå»¶è¿Ÿã€åˆ†åŒºå’Œæ¶ˆæ¯é‡æ’åºçš„æƒ…å†µä¸‹æ”¶æ•›åˆ°ç›¸åŒçš„å€¼ã€‚å®ƒä»¬å¯ä»¥è¢«è¯æ˜æ˜¯æ”¶æ•›çš„ï¼Œä½†å¯ä»¥å®ç°ä¸º CRDT çš„æ•°æ®ç±»å‹æ˜¯æœ‰é™çš„ã€‚\nCALMï¼ˆä¸€è‡´æ€§ä½œä¸ºé€»è¾‘å•è°ƒæ€§ï¼‰çŒœæƒ³æ˜¯ç›¸åŒåŸåˆ™çš„å¦ä¸€ç§è¡¨è¾¾æ–¹å¼ï¼šå®ƒå°†é€»è¾‘å•è°ƒæ€§ä¸æ”¶æ•›ç­‰åŒèµ·æ¥ã€‚å¦‚æœæˆ‘ä»¬å¯ä»¥å¾—å‡ºæŸä¸ªä¸œè¥¿åœ¨é€»è¾‘ä¸Šæ˜¯å•è°ƒçš„ï¼Œé‚£ä¹ˆåœ¨æ²¡æœ‰åè°ƒçš„æƒ…å†µä¸‹è¿è¡Œå®ƒä¹Ÿæ˜¯å®‰å…¨çš„ã€‚æ”¶æ•›åˆ†æ-ç‰¹åˆ«æ˜¯åœ¨ Bloom ç¼–ç¨‹è¯­è¨€ä¸­çš„åº”ç”¨-å¯ç”¨äºæŒ‡å¯¼ç¨‹åºå‘˜åœ¨ä½•æ—¶ä½•åœ°ä½¿ç”¨å¼ºä¸€è‡´æ€§ç³»ç»Ÿçš„åè°ƒæŠ€æœ¯ä»¥åŠåœ¨ä½•æ—¶å¯ä»¥å®‰å…¨åœ°æ‰§è¡Œæ— éœ€åè°ƒçš„æ“ä½œã€‚\nåè°ƒä¸åŒçš„æ“ä½œæŒ‡ä»¤ ä¸å¼ºåˆ¶æ‰§è¡Œå•å‰¯æœ¬ä¸€è‡´æ€§çš„ç³»ç»Ÿæ˜¯ä»€ä¹ˆæ ·å­å‘¢ï¼Ÿè®©æˆ‘ä»¬é€šè¿‡å‡ ä¸ªä¾‹å­æ¥æ›´å…·ä½“åœ°äº†è§£ã€‚\nä¹Ÿè®¸æœ€æ˜æ˜¾çš„éå¼ºåˆ¶æ‰§è¡Œå•å‰¯æœ¬ä¸€è‡´æ€§ç³»ç»Ÿçš„ç‰¹å¾æ˜¯å®ƒä»¬å…è®¸å‰¯æœ¬å½¼æ­¤å‘æ•£ã€‚è¿™æ„å‘³ç€æ²¡æœ‰ä¸¥æ ¼å®šä¹‰çš„é€šä¿¡æ¨¡å¼ï¼šå‰¯æœ¬å¯ä»¥ç›¸äº’åˆ†ç¦»ï¼Œä½†ä»ç„¶ä¿æŒå¯ç”¨å¹¶æ¥å—å†™æ“ä½œã€‚\nè®©æˆ‘ä»¬æƒ³è±¡ä¸€ä¸ªç”±ä¸‰ä¸ªå‰¯æœ¬ç»„æˆçš„ç³»ç»Ÿï¼Œæ¯ä¸ªå‰¯æœ¬å½¼æ­¤åˆ†ç¦»ã€‚ä¾‹å¦‚ï¼Œè¿™äº›å‰¯æœ¬å¯èƒ½ä½äºä¸åŒçš„æ•°æ®ä¸­å¿ƒï¼Œå¹¶å› æŸç§åŸå› æ— æ³•é€šä¿¡ã€‚åœ¨åˆ†ç¦»æœŸé—´ï¼Œæ¯ä¸ªå‰¯æœ¬ä»ç„¶å¯ç”¨ï¼Œå¯ä»¥æ¥å—ä¸€äº›å®¢æˆ·ç«¯çš„è¯»å†™æ“ä½œï¼š\n[Clients] - \u0026gt; [A] --- Partition --- [Clients] - \u0026gt; [B] --- Partition --- [Clients] - \u0026gt; [C] ä¸€æ®µæ—¶é—´åï¼Œåˆ†åŒºä¼šä¿®å¤å¹¶ä¸”å‰¯æœ¬æœåŠ¡å™¨ä¼šäº¤æ¢ä¿¡æ¯ã€‚ä»–ä»¬ä»ä¸åŒçš„å®¢æˆ·é‚£é‡Œæ”¶åˆ°äº†ä¸åŒçš„æ›´æ–°ï¼Œå¹¶ä¸”å½¼æ­¤å­˜åœ¨åˆ†æ­§ï¼Œå› æ­¤éœ€è¦è¿›è¡ŒæŸç§åè°ƒã€‚æˆ‘ä»¬å¸Œæœ›æ‰€æœ‰çš„å‰¯æœ¬éƒ½æ”¶æ•›åˆ°ç›¸åŒçš„ç»“æœã€‚\n[A] \\ --\u0026gt; [merge] [B] / | | [C] ----[merge]---\u0026gt; result è€ƒè™‘å…·æœ‰å¼±ä¸€è‡´æ€§ä¿è¯çš„ç³»ç»Ÿçš„å¦ä¸€ç§æ–¹æ³•æ˜¯æƒ³è±¡ä¸€ç»„å®¢æˆ·ç«¯æŒ‰æŸç§é¡ºåºå‘ä¸¤ä¸ªå‰¯æœ¬å‘é€æ¶ˆæ¯ã€‚ç”±äºæ²¡æœ‰å¼ºåˆ¶æ‰§è¡Œå•ä¸€æ€»é¡ºåºçš„åè°ƒåè®®ï¼Œå› æ­¤æ¶ˆæ¯å¯ä»¥åœ¨ä¸¤ä¸ªå‰¯æœ¬ä¸Šä»¥ä¸åŒçš„é¡ºåºä¼ é€’ï¼š\n[Clients] --\u0026gt; [A] 1, 2, 3 [Clients] --\u0026gt; [B] 2, 3, 1 ä»æœ¬è´¨ä¸Šè®²ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬éœ€è¦åè°ƒåè®®çš„åŸå› ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬å°è¯•è¿æ¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¶ˆæ¯ 1ã€2 å’Œ 3 ä¸­çš„æ“ä½œä¸ºï¼š\n1: { operation: concat(\u0026#39;Hello \u0026#39;) } 2: { operation: concat(\u0026#39;World\u0026#39;) } 3: { operation: concat(\u0026#39;!","title":"[è¯‘]ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹5.å¤åˆ¶ï¼šå¼±ä¸€è‡´æ€§æ¨¡å‹åè®®"},{"content":" ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹æ˜¯ä¸€æœ¬å¹¿å—æ¬¢è¿çš„èµ„æºï¼Œç”¨äºç†è§£å’Œå­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿã€‚è¯¥ä¹¦ç”±ä½œè€… Mikito Takada æ’°å†™ï¼Œä»‹ç»äº†æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºæœ¬æ¦‚å¿µã€åŸåˆ™å’ŒæŒ‘æˆ˜ã€‚\nè¿™æœ¬ä¹¦æ¶µç›–äº†ä¸åˆ†å¸ƒå¼ç³»ç»Ÿç›¸å…³çš„å¹¿æ³›ä¸»é¢˜ï¼ŒåŒ…æ‹¬ç½‘ç»œã€å®¹é”™æ€§ã€ä¸€è‡´æ€§æ¨¡å‹ã€åˆ†å¸ƒå¼ç®—æ³•ã€å¯æ‰©å±•æ€§ç­‰ç­‰ã€‚å®ƒæ—¨åœ¨ä»¥æ¸…æ™°æ˜“æ‡‚çš„æ–¹å¼è§£é‡Šå¤æ‚çš„æ¦‚å¿µï¼Œé€‚åˆåˆå­¦è€…å’Œæœ‰ç»éªŒçš„åˆ†å¸ƒå¼ç³»ç»Ÿä»ä¸šè€…é˜…è¯»ã€‚\nåœ¨æ•´æœ¬ä¹¦ä¸­ï¼Œä½œè€…æä¾›äº†å„ç§å®é™…æ¡ˆä¾‹å’Œæ¡ˆä¾‹ç ”ç©¶ï¼Œä»¥è¯´æ˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®é™…åº”ç”¨å’Œå®è·µæ–¹é¢ã€‚å®ƒè¿˜å¼ºè°ƒäº†æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿæ¶‰åŠçš„æƒè¡¡å’Œè®¾è®¡è€ƒè™‘ï¼Œå¸®åŠ©è¯»è€…å…¨é¢ç†è§£è¿™ä¸ªä¸»é¢˜ã€‚\nã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹ä½œä¸ºå¼€æºèµ„æºï¼Œå¯ä»¥å…è´¹åœ¨çº¿è·å–ï¼Œéå¸¸é€‚åˆä»»ä½•å¯¹å­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿæ„Ÿå…´è¶£çš„äººã€‚\nåŸæ–‡é“¾æ¥ï¼šDistributed systems: for fun and profit\n4. å¤åˆ¶ å¤åˆ¶é—®é¢˜æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä¼—å¤šé—®é¢˜ä¹‹ä¸€ã€‚ä¸è¯¸å¦‚é¢†å¯¼è€…é€‰ä¸¾ã€æ•…éšœæ£€æµ‹ã€äº’æ–¥ã€å…±è¯†å’Œå…¨å±€å¿«ç…§ç­‰å…¶ä»–é—®é¢˜ç›¸æ¯”ï¼Œæˆ‘é€‰æ‹©å…³æ³¨å¤åˆ¶é—®é¢˜ï¼Œå› ä¸ºè¿™é€šå¸¸æ˜¯äººä»¬æœ€æ„Ÿå…´è¶£çš„éƒ¨åˆ†ã€‚å¹¶è¡Œæ•°æ®åº“åœ¨å¤åˆ¶ç‰¹æ€§æ–¹é¢çš„å·®å¼‚åŒ–å°±æ˜¯ä¸€ä¸ªä¾‹å­ã€‚æ­¤å¤–ï¼Œå¤åˆ¶ä¸ºè®¸å¤šå­é—®é¢˜æä¾›äº†ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œä¾‹å¦‚é¢†å¯¼è€…é€‰ä¸¾ã€æ•…éšœæ£€æµ‹ã€å…±è¯†å’ŒåŸå­å¹¿æ’­ã€‚\nå¤åˆ¶æ˜¯ä¸€ä¸ªç»„é€šä¿¡é—®é¢˜ã€‚ä»€ä¹ˆæ ·çš„å®‰æ’å’Œé€šä¿¡æ¨¡å¼èƒ½å¤Ÿæ»¡è¶³æˆ‘ä»¬æ‰€æœŸæœ›çš„æ€§èƒ½å’Œå¯ç”¨æ€§ç‰¹æ€§ï¼Ÿåœ¨é¢å¯¹ç½‘ç»œåˆ†åŒºå’ŒåŒæ—¶èŠ‚ç‚¹æ•…éšœçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¦‚ä½•ç¡®ä¿å®¹é”™æ€§ã€è€ä¹…æ€§å’Œéå‘æ•£æ€§ï¼Ÿ\nåŒæ ·ï¼Œæœ‰è®¸å¤šæ–¹æ³•å¯ä»¥è§£å†³å¤åˆ¶é—®é¢˜ã€‚æˆ‘åœ¨è¿™é‡Œé‡‡ç”¨çš„æ–¹æ³•åªæ˜¯çœ‹ä¸€ä¸‹å…·æœ‰å¤åˆ¶åŠŸèƒ½çš„ç³»ç»Ÿå¯èƒ½å…·æœ‰çš„é«˜çº§æ¨¡å¼ã€‚ä»å¯è§†åŒ–çš„è§’åº¦æ¥çœ‹ï¼Œæœ‰åŠ©äºå°†è®¨è®ºé›†ä¸­åœ¨æ•´ä½“æ¨¡å¼ä¸Šï¼Œè€Œä¸æ˜¯å…·ä½“æ¶‰åŠçš„æ¶ˆæ¯ä¼ é€’ã€‚æˆ‘åœ¨è¿™é‡Œçš„ç›®æ ‡æ˜¯æ¢ç´¢è®¾è®¡ç©ºé—´ï¼Œè€Œä¸æ˜¯è§£é‡Šæ¯ä¸ªç®—æ³•çš„å…·ä½“ç»†èŠ‚ã€‚\nè®©æˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸‹å¤åˆ¶æ˜¯ä»€ä¹ˆæ ·å­ã€‚æˆ‘ä»¬å‡è®¾æˆ‘ä»¬æœ‰ä¸€äº›åˆå§‹æ•°æ®åº“ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚æ¥æ”¹å˜æ•°æ®åº“çš„çŠ¶æ€ã€‚\nè¿™ç§å®‰æ’å’Œé€šä¿¡æ¨¡å¼å¯ä»¥åˆ†ä¸ºå‡ ä¸ªé˜¶æ®µï¼š\nï¼ˆè¯·æ±‚ï¼‰å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ ï¼ˆåŒæ­¥ï¼‰è¿›è¡Œå¤åˆ¶çš„åŒæ­¥éƒ¨åˆ† ï¼ˆå“åº”ï¼‰å°†å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ ï¼ˆå¼‚æ­¥ï¼‰è¿›è¡Œå¤åˆ¶çš„å¼‚æ­¥éƒ¨åˆ† æ ¹æ®è¿™äº›é˜¶æ®µï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸åŒçš„é€šä¿¡æ¨¡å¼ã€‚æˆ‘ä»¬é€‰æ‹©çš„æ¨¡å¼å°†å¯¹æ€§èƒ½å’Œå¯ç”¨æ€§äº§ç”Ÿå½±å“ï¼Œå…·ä½“å–å†³äºæ‰€é€‰æ‹©çš„ç®—æ³•ã€‚\nåŒæ­¥å¤åˆ¶ ç¬¬ä¸€ä¸ªæ¨¡å¼æ˜¯åŒæ­¥å¤åˆ¶ï¼ˆä¹Ÿç§°ä¸ºä¸»åŠ¨å¤åˆ¶ã€æ€¥åˆ‡å¤åˆ¶ã€æ¨é€å¤åˆ¶æˆ–æ‚²è§‚å¤åˆ¶ï¼‰ã€‚è®©æˆ‘ä»¬ç”»å‡ºå®ƒçš„ç¤ºæ„å›¾ï¼š\nåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸‰ä¸ªæ˜æ˜¾çš„é˜¶æ®µï¼šé¦–å…ˆï¼Œå®¢æˆ·ç«¯å‘é€è¯·æ±‚ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ‰€ç§°çš„åŒæ­¥å¤åˆ¶çš„éƒ¨åˆ†å‘ç”Ÿã€‚è¿™ä¸ªæœ¯è¯­æŒ‡çš„æ˜¯å®¢æˆ·ç«¯è¢«é˜»å¡ - ç­‰å¾…ç³»ç»Ÿçš„å›å¤ã€‚\nåœ¨åŒæ­¥é˜¶æ®µæœŸé—´ï¼Œç¬¬ä¸€ä¸ªæœåŠ¡å™¨ä¼šè”ç³»å…¶ä»–ä¸¤ä¸ªæœåŠ¡å™¨ï¼Œå¹¶ç­‰å¾…æ”¶åˆ°æ‰€æœ‰å…¶ä»–æœåŠ¡å™¨çš„å›å¤ã€‚æœ€åï¼Œå®ƒå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªå“åº”ï¼Œå‘ŠçŸ¥å…¶ç»“æœï¼ˆä¾‹å¦‚æˆåŠŸæˆ–å¤±è´¥ï¼‰ã€‚\nè¿™ä¸€åˆ‡ä¼¼ä¹å¾ˆç®€å•ã€‚åœ¨ä¸è®¨è®ºåŒæ­¥é˜¶æ®µç®—æ³•çš„ç»†èŠ‚çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬èƒ½ä»è¿™ä¸ªç‰¹å®šçš„é€šä¿¡æ¨¡å¼å®‰æ’ä¸­å¾—å‡ºä»€ä¹ˆç»“è®ºå‘¢ï¼Ÿé¦–å…ˆï¼Œæ³¨æ„è¿™æ˜¯ä¸€ç§ N-å¯¹-N çš„å†™å…¥æ–¹å¼ï¼šåœ¨è¿”å›å“åº”ä¹‹å‰ï¼Œå®ƒå¿…é¡»è¢«ç³»ç»Ÿä¸­çš„æ¯ä¸ªæœåŠ¡å™¨çœ‹åˆ°å¹¶ç¡®è®¤ã€‚\nä»æ€§èƒ½çš„è§’åº¦æ¥çœ‹ï¼Œè¿™æ„å‘³ç€ç³»ç»Ÿçš„é€Ÿåº¦å°†å–å†³äºå…¶ä¸­æœ€æ…¢çš„æœåŠ¡å™¨ã€‚è¯¥ç³»ç»Ÿè¿˜å¯¹ç½‘ç»œå»¶è¿Ÿçš„å˜åŒ–éå¸¸æ•æ„Ÿï¼Œå› ä¸ºå®ƒè¦æ±‚åœ¨ç»§ç»­ä¹‹å‰æ¯ä¸ªæœåŠ¡å™¨éƒ½å¿…é¡»å›å¤ã€‚\nè€ƒè™‘åˆ° N-å¯¹-N çš„æ–¹å¼ï¼Œç³»ç»Ÿæ— æ³•å®¹å¿ä»»ä½•æœåŠ¡å™¨çš„ä¸¢å¤±ã€‚å½“ä¸€ä¸ªæœåŠ¡å™¨ä¸¢å¤±æ—¶ï¼Œç³»ç»Ÿæ— æ³•å†å†™å…¥æ‰€æœ‰èŠ‚ç‚¹ï¼Œå› æ­¤æ— æ³•ç»§ç»­è¿›è¡Œã€‚åœ¨è¿™ç§è®¾è®¡ä¸­ï¼Œå®ƒå¯èƒ½èƒ½å¤Ÿå¯¹æ•°æ®æä¾›åªè¯»è®¿é—®ï¼Œä½†åœ¨èŠ‚ç‚¹æ•…éšœåä¸å…è®¸è¿›è¡Œä¿®æ”¹ã€‚\nè¿™ç§å®‰æ’å¯ä»¥æä¾›éå¸¸å¼ºå¤§çš„è€ä¹…æ€§ä¿è¯ï¼šå½“è¿”å›å“åº”æ—¶ï¼Œå®¢æˆ·ç«¯å¯ä»¥ç¡®ä¿¡æ‰€æœ‰ N ä¸ªæœåŠ¡å™¨éƒ½å·²æ¥æ”¶ã€å­˜å‚¨å’Œç¡®è®¤äº†è¯·æ±‚ã€‚ä¸ºäº†ä¸¢å¤±ä¸€ä¸ªå·²æ¥å—çš„æ›´æ–°ï¼Œæ‰€æœ‰ N ä¸ªå‰¯æœ¬éƒ½éœ€è¦ä¸¢å¤±ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„ä¿è¯ã€‚\nå¼‚æ­¥å¤åˆ¶ è®©æˆ‘ä»¬å°†å…¶ä¸ç¬¬äºŒç§æ¨¡å¼è¿›è¡Œå¯¹æ¯” - å¼‚æ­¥å¤åˆ¶ï¼ˆä¹Ÿç§°ä¸ºè¢«åŠ¨å¤åˆ¶ã€æ‹‰å¼å¤åˆ¶æˆ–æƒ°æ€§å¤åˆ¶ï¼‰ã€‚æ­£å¦‚æ‚¨å¯èƒ½å·²ç»çŒœåˆ°çš„ï¼Œè¿™ä¸åŒæ­¥å¤åˆ¶ç›¸åï¼š\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸»èŠ‚ç‚¹ï¼ˆä¹Ÿç§°ä¸ºé¢†å¯¼è€…æˆ–åè°ƒè€…ï¼‰ç«‹å³å‘å®¢æˆ·ç«¯è¿”å›å“åº”ã€‚å®ƒæœ€å¤šåªä¼šåœ¨æœ¬åœ°å­˜å‚¨æ›´æ–°ï¼Œä½†ä¸ä¼šåŒæ­¥æ‰§è¡Œä»»ä½•é‡è¦å·¥ä½œï¼Œå®¢æˆ·ç«¯ä¹Ÿä¸éœ€è¦ç­‰å¾…æ›´å¤šçš„æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡è½®æ¬¡ã€‚\nåœ¨ç¨åçš„é˜¶æ®µï¼Œå¤åˆ¶ä»»åŠ¡çš„å¼‚æ­¥éƒ¨åˆ†å‘ç”Ÿã€‚åœ¨è¿™é‡Œï¼Œä¸»èŠ‚ç‚¹ä½¿ç”¨æŸç§é€šä¿¡æ¨¡å¼è”ç³»å…¶ä»–æœåŠ¡å™¨ï¼Œå¹¶æ›´æ–°å®ƒä»¬çš„æ•°æ®å‰¯æœ¬ã€‚å…·ä½“çš„å®ç°å–å†³äºæ‰€ä½¿ç”¨çš„ç®—æ³•ã€‚\nåœ¨ä¸æ¶‰åŠç®—æ³•ç»†èŠ‚çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯¹è¿™ç§å…·ä½“çš„å®‰æ’èƒ½å¾—å‡ºä»€ä¹ˆç»“è®ºå‘¢ï¼Ÿå—¯ï¼Œè¿™æ˜¯ä¸€ç§å†™ 1-å¯¹-N çš„æ–¹å¼ï¼šç«‹å³è¿”å›å“åº”ï¼Œæ›´æ–°ä¼ æ’­åœ¨ç¨åå‘ç”Ÿã€‚\nä»æ€§èƒ½çš„è§’åº¦æ¥çœ‹ï¼Œè¿™æ„å‘³ç€ç³»ç»Ÿå¾ˆå¿«ï¼šå®¢æˆ·ç«¯ä¸éœ€è¦é¢å¤–èŠ±è´¹æ—¶é—´ç­‰å¾…ç³»ç»Ÿå†…éƒ¨å®Œæˆå·¥ä½œã€‚ç³»ç»Ÿå¯¹ç½‘ç»œå»¶è¿Ÿæ›´å…·å®¹å¿æ€§ï¼Œå› ä¸ºå†…éƒ¨å»¶è¿Ÿçš„æ³¢åŠ¨ä¸ä¼šå¯¼è‡´å®¢æˆ·ç«¯éœ€è¦é¢å¤–ç­‰å¾…ã€‚\nè¿™ç§å®‰æ’åªèƒ½æä¾›å¼±çš„æˆ–æ¦‚ç‡æ€§çš„è€ä¹…æ€§ä¿è¯ã€‚å¦‚æœæ²¡æœ‰å‡ºç°é—®é¢˜ï¼Œæ•°æ®æœ€ç»ˆä¼šå¤åˆ¶åˆ°æ‰€æœ‰ N å°æœºå™¨ä¸Šã€‚ç„¶è€Œï¼Œå¦‚æœåœ¨æ­¤ä¹‹å‰åŒ…å«æ•°æ®çš„å”¯ä¸€æœåŠ¡å™¨ä¸¢å¤±ï¼Œæ•°æ®å°†æ°¸ä¹…ä¸¢å¤±ã€‚\nè€ƒè™‘åˆ° 1-å¯¹-N çš„æ–¹å¼ï¼Œåªè¦è‡³å°‘æœ‰ä¸€ä¸ªèŠ‚ç‚¹æ­£å¸¸è¿è¡Œï¼Œç³»ç»Ÿå°±å¯ä»¥ä¿æŒå¯ç”¨æ€§ï¼ˆç†è®ºä¸Šè‡³å°‘å¦‚æ­¤ï¼Œä½†å®é™…ä¸Šè´Ÿè½½å¯èƒ½ä¼šå¤ªé«˜ï¼‰ã€‚è¿™ç§çº¯ç²¹çš„æƒ°æ€§æ–¹å¼ä¸æä¾›è€ä¹…æ€§æˆ–ä¸€è‡´æ€§ä¿è¯ï¼›ä½ å¯ä»¥å‘ç³»ç»Ÿå†™å…¥æ•°æ®ï¼Œä½†å¦‚æœå‘ç”Ÿä»»ä½•æ•…éšœï¼Œä¸èƒ½ä¿è¯èƒ½å¤Ÿè¯»å–ä½ æ‰€å†™å…¥çš„å†…å®¹ã€‚\næœ€åå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¢«åŠ¨å¤åˆ¶æ— æ³•ç¡®ä¿ç³»ç»Ÿä¸­çš„æ‰€æœ‰èŠ‚ç‚¹å§‹ç»ˆåŒ…å«ç›¸åŒçš„çŠ¶æ€ã€‚å¦‚æœåœ¨å¤šä¸ªä½ç½®æ¥å—å†™å…¥æ“ä½œï¼Œå¹¶ä¸”ä¸è¦æ±‚è¿™äº›èŠ‚ç‚¹åŒæ­¥ä¸€è‡´ï¼Œé‚£ä¹ˆå°±ä¼šå­˜åœ¨å‘æ•£çš„é£é™©ï¼šä¸åŒä½ç½®çš„è¯»å–å¯èƒ½è¿”å›ä¸åŒçš„ç»“æœï¼ˆç‰¹åˆ«æ˜¯åœ¨èŠ‚ç‚¹æ•…éšœå’Œæ¢å¤åï¼‰ï¼Œå¹¶ä¸”æ— æ³•å¼ºåˆ¶æ‰§è¡Œå…¨å±€çº¦æŸï¼ˆéœ€è¦ä¸æ‰€æœ‰äººé€šä¿¡ï¼‰ã€‚\næˆ‘æ²¡æœ‰è¯¦ç»†è®¨è®ºè¯»å–ï¼ˆè€Œä¸æ˜¯å†™å…¥ï¼‰æ—¶çš„é€šä¿¡æ¨¡å¼ï¼Œå› ä¸ºè¯»å–æ¨¡å¼å®é™…ä¸Šæ˜¯æ ¹æ®å†™å…¥æ¨¡å¼æ¥ç¡®å®šçš„ï¼šåœ¨è¯»å–è¿‡ç¨‹ä¸­ï¼Œä½ å¸Œæœ›ä¸å°½å¯èƒ½å°‘çš„èŠ‚ç‚¹è¿›è¡Œè”ç³»ã€‚æˆ‘ä»¬å°†åœ¨ä»²è£æœºåˆ¶çš„èƒŒæ™¯ä¸‹è¿›ä¸€æ­¥è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚\næˆ‘ä»¬åªè®¨è®ºäº†ä¸¤ç§åŸºæœ¬çš„å®‰æ’ï¼Œå¹¶æ²¡æœ‰æ¶‰åŠå…·ä½“çš„ç®—æ³•ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å·²ç»èƒ½å¤Ÿäº†è§£å¯èƒ½çš„é€šä¿¡æ¨¡å¼ä»¥åŠå®ƒä»¬çš„æ€§èƒ½ã€è€ä¹…æ€§ä¿è¯å’Œå¯ç”¨æ€§ç‰¹æ€§çš„ä¸€äº›ä¿¡æ¯ã€‚\nä¸»è¦å¤åˆ¶æ–¹æ³•æ¦‚è¿° åœ¨è®¨è®ºäº†åŒæ­¥å’Œå¼‚æ­¥å¤åˆ¶è¿™ä¸¤ç§åŸºæœ¬å¤åˆ¶æ–¹æ³•ä¹‹åï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸»è¦çš„å¤åˆ¶ç®—æ³•ã€‚\næœ‰å¾ˆå¤šä¸åŒçš„æ–¹å¼æ¥å¯¹å¤åˆ¶æŠ€æœ¯è¿›è¡Œåˆ†ç±»ã€‚åœ¨åŒæ­¥ä¸å¼‚æ­¥ä¹‹åï¼Œæˆ‘æƒ³å¼•å…¥çš„ç¬¬äºŒä¸ªåŒºåˆ«æ˜¯ï¼š\né˜²æ­¢å‘æ•£çš„å¤åˆ¶æ–¹æ³•ï¼ˆå•å‰¯æœ¬ç³»ç»Ÿï¼‰å’Œ å­˜åœ¨å‘æ•£é£é™©çš„å¤åˆ¶æ–¹æ³•ï¼ˆå¤šä¸»ç³»ç»Ÿï¼‰ ç¬¬ä¸€ç»„æ–¹æ³•å…·æœ‰â€œè¡Œä¸ºåƒå•ä¸€ç³»ç»Ÿâ€çš„ç‰¹æ€§ã€‚ç‰¹åˆ«æ˜¯åœ¨éƒ¨åˆ†æ•…éšœå‘ç”Ÿæ—¶ï¼Œç³»ç»Ÿç¡®ä¿åªæœ‰ä¸€ä¸ªå‰¯æœ¬å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚æ­¤å¤–ï¼Œç³»ç»Ÿç¡®ä¿å‰¯æœ¬å§‹ç»ˆä¿æŒä¸€è‡´ã€‚è¿™è¢«ç§°ä¸ºå…±è¯†é—®é¢˜ã€‚\nå½“å¤šä¸ªè¿›ç¨‹ï¼ˆæˆ–è®¡ç®—æœºï¼‰å°±æŸä¸ªå€¼è¾¾æˆå…±è¯†æ—¶ï¼Œå®ƒä»¬å®ç°äº†å…±è¯†ã€‚æ›´å…·ä½“åœ°è¯´ï¼š\nä¸€è‡´æ€§ï¼šæ¯ä¸ªæ­£ç¡®çš„è¿›ç¨‹å¿…é¡»å°±åŒä¸€ä¸ªå€¼è¾¾æˆä¸€è‡´ã€‚ å®Œæ•´æ€§ï¼šæ¯ä¸ªæ­£ç¡®çš„è¿›ç¨‹æœ€å¤šå†³å®šä¸€ä¸ªå€¼ï¼Œå¹¶ä¸”å¦‚æœå®ƒå†³å®šäº†æŸä¸ªå€¼ï¼Œåˆ™è¯¥å€¼å¿…é¡»ç”±æŸä¸ªè¿›ç¨‹æå‡ºã€‚ ç»ˆæ­¢æ€§ï¼šæ‰€æœ‰è¿›ç¨‹æœ€ç»ˆéƒ½ä¼šè¾¾æˆå†³ç­–ã€‚ æœ‰æ•ˆæ€§ï¼šå¦‚æœæ‰€æœ‰æ­£ç¡®çš„è¿›ç¨‹æè®®ç›¸åŒçš„å€¼ Vï¼Œåˆ™æ‰€æœ‰æ­£ç¡®çš„è¿›ç¨‹éƒ½å†³å®š Vã€‚ äº’æ–¥ã€é¢†å¯¼è€…é€‰ä¸¾ã€ç»„æ’­å’ŒåŸå­å¹¿æ’­éƒ½æ˜¯å…±è¯†é—®é¢˜çš„æ›´ä¸€èˆ¬å®ä¾‹ã€‚ç»´æŠ¤å•ä¸€å‰¯æœ¬ä¸€è‡´æ€§çš„å¤åˆ¶ç³»ç»Ÿéœ€è¦ä»¥æŸç§æ–¹å¼è§£å†³å…±è¯†é—®é¢˜ã€‚ ç»´æŠ¤å•ä¸€å‰¯æœ¬ä¸€è‡´æ€§çš„å¤åˆ¶ç®—æ³•åŒ…æ‹¬ï¼š\n1n æ¶ˆæ¯ï¼ˆå¼‚æ­¥ä¸»/å¤‡ä»½ï¼‰ 2n æ¶ˆæ¯ï¼ˆåŒæ­¥ä¸»/å¤‡ä»½ï¼‰ 4n æ¶ˆæ¯ï¼ˆä¸¤é˜¶æ®µæäº¤ï¼Œå¤š Paxosï¼‰ 6n æ¶ˆæ¯ï¼ˆä¸‰é˜¶æ®µæäº¤ï¼Œå¸¦æœ‰é‡å¤é¢†å¯¼è€…é€‰ä¸¾çš„ Paxosï¼‰ è¿™äº›ç®—æ³•åœ¨å®¹é”™æ€§æ–¹é¢æœ‰æ‰€ä¸åŒï¼ˆä¾‹å¦‚ï¼Œå®ƒä»¬å¯ä»¥å®¹å¿çš„æ•…éšœç±»å‹ï¼‰ã€‚æˆ‘æ ¹æ®ç®—æ³•æ‰§è¡ŒæœŸé—´äº¤æ¢çš„æ¶ˆæ¯æ•°é‡è¿›è¡Œäº†ç®€å•çš„åˆ†ç±»ï¼Œå› ä¸ºæˆ‘è®¤ä¸ºå°è¯•å›ç­”â€œé€šè¿‡å¢åŠ æ¶ˆæ¯äº¤æ¢æˆ‘ä»¬å¾—åˆ°äº†ä»€ä¹ˆï¼Ÿâ€è¿™ä¸ªé—®é¢˜å¾ˆæœ‰è¶£ã€‚\nä¸‹é¢çš„å›¾è¡¨ï¼Œæ”¹ç¼–è‡ª Google çš„ Ryan Barretï¼Œæè¿°äº†ä¸åŒé€‰é¡¹çš„ä¸€äº›æ–¹é¢ï¼š\nä¸Šè¿°å›¾è¡¨ä¸­çš„ä¸€è‡´æ€§ã€å»¶è¿Ÿã€ååé‡ã€æ•°æ®ä¸¢å¤±å’Œæ•…éšœè½¬ç§»ç‰¹æ€§å®é™…ä¸Šå¯ä»¥è¿½æº¯åˆ°ä¸¤ç§ä¸åŒçš„å¤åˆ¶æ–¹æ³•ï¼šåŒæ­¥å¤åˆ¶ï¼ˆä¾‹å¦‚ï¼Œåœ¨å“åº”ä¹‹å‰ç­‰å¾…ï¼‰å’Œå¼‚æ­¥å¤åˆ¶ã€‚å½“æ‚¨ç­‰å¾…æ—¶ï¼Œæ€§èƒ½ä¼šå˜å·®ï¼Œä½†å¯ä»¥è·å¾—æ›´å¼ºçš„ä¿è¯ã€‚åœ¨è®¨è®ºåˆ†åŒºï¼ˆå’Œå»¶è¿Ÿï¼‰å®¹å¿æ€§æ—¶ï¼Œ2PC å’Œä»²è£ç³»ç»Ÿä¹‹é—´çš„ååé‡å·®å¼‚å°†å˜å¾—æ˜æ˜¾ã€‚\nåœ¨è¯¥å›¾è¡¨ä¸­ï¼Œå¼ºåˆ¶å¼±ï¼ˆ/æœ€ç»ˆï¼‰ä¸€è‡´æ€§çš„ç®—æ³•è¢«å½’ç±»ä¸ºä¸€ç±»ï¼ˆ\u0026ldquo;gossip\u0026rdquo;ï¼‰ã€‚ç„¶è€Œï¼Œæˆ‘å°†æ›´è¯¦ç»†åœ°è®¨è®ºå¼±ä¸€è‡´æ€§çš„å¤åˆ¶æ–¹æ³• - gossip å’Œï¼ˆéƒ¨åˆ†ï¼‰ä»²è£ç³»ç»Ÿã€‚\u0026ldquo;äº‹åŠ¡\u0026quot;è¡Œå®é™…ä¸Šæ›´å¤šåœ°æ¶‰åŠå…¨å±€è°“è¯è¯„ä¼°ï¼Œè€Œåœ¨å…·æœ‰å¼±ä¸€è‡´æ€§çš„ç³»ç»Ÿä¸­ä¸æ”¯æŒï¼ˆå°½ç®¡å¯ä»¥æ”¯æŒæœ¬åœ°è°“è¯è¯„ä¼°ï¼‰ã€‚\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¼ºåˆ¶å¼±ä¸€è‡´æ€§è¦æ±‚çš„ç³»ç»Ÿæ‹¥æœ‰è¾ƒå°‘çš„é€šç”¨ç®—æ³•ï¼Œè€Œæ›´å¤šçš„æ˜¯å¯ä»¥é€‰æ‹©æ€§åº”ç”¨çš„æŠ€æœ¯ã€‚ç”±äºä¸å¼ºåˆ¶å•å‰¯æœ¬ä¸€è‡´æ€§çš„ç³»ç»Ÿå¯ä»¥åƒç”±å¤šä¸ªèŠ‚ç‚¹ç»„æˆçš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸€æ ·è‡ªç”±æ“ä½œï¼Œå› æ­¤ä¿®å¤çš„ç›®æ ‡è¾ƒå°‘ï¼Œé‡ç‚¹æ›´å¤šåœ°æ”¾åœ¨ä¸ºäººä»¬æä¾›ä¸€ç§æ¨ç†ç³»ç»Ÿç‰¹æ€§çš„æ–¹å¼ä¸Šã€‚\nä¾‹å¦‚ï¼š\nä»¥å®¢æˆ·ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹è¯•å›¾æä¾›æ›´å¯ç†è§£çš„ä¸€è‡´æ€§ä¿è¯ï¼ŒåŒæ—¶å…è®¸å‘æ•£ã€‚ CRDTsï¼ˆæ”¶æ•›ä¸”å¯äº¤æ¢çš„å¤åˆ¶æ•°æ®ç±»å‹ï¼‰åˆ©ç”¨æŸäº›çŠ¶æ€å’ŒåŸºäºæ“ä½œçš„æ•°æ®ç±»å‹çš„åŠæ ¼ç‰¹æ€§ï¼ˆç»“åˆå¾‹ã€äº¤æ¢å¾‹ã€å¹‚ç­‰æ€§ï¼‰ã€‚ æ”¶æ•›åˆ†æï¼ˆå¦‚ Bloom è¯­è¨€ä¸­çš„åˆ†æï¼‰åˆ©ç”¨å…³äºè®¡ç®—å•è°ƒæ€§çš„ä¿¡æ¯æ¥æœ€å¤§ç¨‹åº¦åœ°åˆ©ç”¨æ— åºæ€§ã€‚ PBSï¼ˆæ¦‚ç‡æœ‰ç•Œé™ˆæ—§åº¦ï¼‰ä½¿ç”¨æ¨¡æ‹Ÿå’Œä»ç°å®ç³»ç»Ÿæ”¶é›†çš„ä¿¡æ¯æ¥è¡¨å¾éƒ¨åˆ†ä»²è£ç³»ç»Ÿçš„é¢„æœŸè¡Œä¸ºã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘å°†ç¨å¾®ä»‹ç»æ‰€æœ‰è¿™äº›å†…å®¹ï¼Œé¦–å…ˆè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç»´æŠ¤å•å‰¯æœ¬ä¸€è‡´æ€§çš„å¤åˆ¶ç®—æ³•ã€‚ ä¸»/å¤‡ä»½å¤åˆ¶ ä¸»/å¤‡ä»½å¤åˆ¶ï¼ˆä¹Ÿç§°ä¸ºä¸»å‰¯æœ¬å¤åˆ¶ã€ä¸»ä»å¤åˆ¶æˆ–æ—¥å¿—ä¼ é€ï¼‰å¯èƒ½æ˜¯æœ€å¸¸ç”¨çš„å¤åˆ¶æ–¹æ³•å’Œæœ€åŸºæœ¬çš„ç®—æ³•ã€‚æ‰€æœ‰æ›´æ–°éƒ½åœ¨ä¸»èŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼Œå¹¶é€šè¿‡ç½‘ç»œå°†æ“ä½œæ—¥å¿—ï¼ˆæˆ–æ›´æ”¹ï¼‰å‘é€åˆ°å¤‡ä»½å‰¯æœ¬ã€‚æœ‰ä¸¤ç§å˜ä½“ï¼š\nå¼‚æ­¥ä¸»/å¤‡ä»½å¤åˆ¶ åŒæ­¥ä¸»/å¤‡ä»½å¤åˆ¶ åŒæ­¥ç‰ˆæœ¬éœ€è¦ä¸¤ä¸ªæ¶ˆæ¯ï¼ˆ\u0026ldquo;æ›´æ–°\u0026rdquo; + \u0026ldquo;ç¡®è®¤æ¥æ”¶\u0026rdquo;ï¼‰ï¼Œè€Œå¼‚æ­¥ç‰ˆæœ¬åªéœ€è¦ä¸€ä¸ªæ¶ˆæ¯ï¼ˆ\u0026ldquo;æ›´æ–°\u0026rdquo;ï¼‰å°±å¯ä»¥è¿è¡Œã€‚\nä¸»/å¤‡ä»½å¤åˆ¶éå¸¸å¸¸è§ã€‚ä¾‹å¦‚ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒMySQL å¤åˆ¶ä½¿ç”¨å¼‚æ­¥å˜ä½“ã€‚MongoDB ä¹Ÿä½¿ç”¨ä¸»/å¤‡ä»½å¤åˆ¶ï¼ˆå¹¶é™„å¸¦ä¸€äº›æ•…éšœè½¬ç§»çš„é¢å¤–è¿‡ç¨‹ï¼‰ã€‚æ‰€æœ‰æ“ä½œéƒ½åœ¨ä¸€ä¸ªä¸»æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼Œå®ƒå°†å®ƒä»¬åºåˆ—åŒ–åˆ°æœ¬åœ°æ—¥å¿—ï¼Œç„¶åå¼‚æ­¥åœ°å¤åˆ¶åˆ°å¤‡ä»½æœåŠ¡å™¨ã€‚\næ­£å¦‚æˆ‘ä»¬åœ¨å¼‚æ­¥å¤åˆ¶çš„èƒŒæ™¯ä¸‹è®¨è®ºè¿‡çš„é‚£æ ·ï¼Œä»»ä½•å¼‚æ­¥å¤åˆ¶ç®—æ³•åªèƒ½æä¾›å¼±æŒä¹…æ€§ä¿è¯ã€‚åœ¨ MySQL å¤åˆ¶ä¸­ï¼Œè¿™è¡¨ç°ä¸ºå¤åˆ¶å»¶è¿Ÿï¼šå¼‚æ­¥å¤‡ä»½å§‹ç»ˆè‡³å°‘è½åäºä¸»èŠ‚ç‚¹ä¸€ä¸ªæ“ä½œã€‚å¦‚æœä¸»èŠ‚ç‚¹å¤±è´¥ï¼Œåˆ™å°šæœªå‘é€åˆ°å¤‡ä»½çš„æ›´æ–°å°†ä¸¢å¤±ã€‚\nåŒæ­¥ä¸»/å¤‡ä»½å¤åˆ¶çš„å˜ä½“ç¡®ä¿åœ¨è¿”å›ç»™å®¢æˆ·ç«¯ä¹‹å‰å·²å°†å†™æ“ä½œå­˜å‚¨åœ¨å…¶ä»–èŠ‚ç‚¹ä¸Šï¼Œä½†éœ€è¦ç­‰å¾…å…¶ä»–å‰¯æœ¬çš„å“åº”ã€‚ç„¶è€Œï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå³ä½¿è¿™ä¸ªå˜ä½“ä¹Ÿåªèƒ½æä¾›å¼±ä¿è¯ã€‚è€ƒè™‘ä»¥ä¸‹ç®€å•çš„æ•…éšœåœºæ™¯ï¼š\nä¸»èŠ‚ç‚¹æ¥æ”¶åˆ°å†™æ“ä½œå¹¶å°†å…¶å‘é€åˆ°å¤‡ä»½å‰¯æœ¬ã€‚ å¤‡ä»½å‰¯æœ¬æŒä¹…åŒ–å¹¶ç¡®è®¤å†™æ“ä½œã€‚ ç„¶åä¸»èŠ‚ç‚¹åœ¨å‘é€ç¡®è®¤ç»™å®¢æˆ·ç«¯ä¹‹å‰å¤±è´¥ã€‚ ç°åœ¨å®¢æˆ·ç«¯å‡è®¾æäº¤å¤±è´¥ï¼Œä½†å¤‡ä»½å‰¯æœ¬å·²ç»æäº¤äº†å®ƒï¼›å¦‚æœå°†å¤‡ä»½å‰¯æœ¬æå‡ä¸ºä¸»èŠ‚ç‚¹ï¼Œé‚£å°†æ˜¯é”™è¯¯çš„ã€‚å¯èƒ½éœ€è¦æ‰‹åŠ¨æ¸…ç†æ¥è°ƒå’Œå¤±è´¥çš„ä¸»èŠ‚ç‚¹æˆ–ä¸ä¸€è‡´çš„å¤‡ä»½ã€‚\nå½“ç„¶ï¼Œæˆ‘åœ¨è¿™é‡Œè¿›è¡Œäº†ç®€åŒ–ã€‚å°½ç®¡æ‰€æœ‰ä¸»/å¤‡ä»½å¤åˆ¶ç®—æ³•éƒ½éµå¾ªç›¸åŒçš„ä¸€èˆ¬æ¶ˆæ¯æ¨¡å¼ï¼Œä½†å®ƒä»¬åœ¨æ•…éšœè½¬ç§»ã€å‰¯æœ¬é•¿æ—¶é—´ç¦»çº¿ç­‰æ–¹é¢çš„å¤„ç†æ–¹å¼æœ‰æ‰€ä¸åŒã€‚ç„¶è€Œï¼Œåœ¨è¿™ç§æ–¹æ¡ˆä¸­ï¼Œæ— æ³•å¯¹ä¸»èŠ‚ç‚¹çš„ä¸é€‚æ—¶æ•…éšœå…·æœ‰å¼¹æ€§ã€‚\nåœ¨åŸºäºæ—¥å¿—ä¼ é€/ä¸»/å¤‡ä»½çš„æ–¹æ¡ˆä¸­ï¼Œå…³é”®åœ¨äºå®ƒä»¬åªèƒ½æä¾›å°½åŠ›è€Œä¸ºçš„ä¿è¯ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœèŠ‚ç‚¹åœ¨ä¸é€‚æ—¶æ•…éšœï¼Œå¯èƒ½ä¼šå‡ºç°ä¸¢å¤±æ›´æ–°æˆ–ä¸æ­£ç¡®æ›´æ–°çš„æƒ…å†µï¼‰ã€‚æ­¤å¤–ï¼Œä¸»/å¤‡ä»½æ–¹æ¡ˆå®¹æ˜“å‡ºç°åˆ†è£‚è„‘ï¼ˆsplit-brainï¼‰é—®é¢˜ï¼Œå³ç”±äºä¸´æ—¶ç½‘ç»œé—®é¢˜å¯¼è‡´åˆ‡æ¢åˆ°å¤‡ä»½ï¼Œä½¿å¾—ä¸»èŠ‚ç‚¹å’Œå¤‡ä»½åŒæ—¶å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚\nä¸ºäº†é˜²æ­¢ä¸é€‚æ—¶æ•…éšœå¯¼è‡´ä¸€è‡´æ€§ä¿è¯è¢«è¿åï¼Œæˆ‘ä»¬éœ€è¦å¢åŠ å¦ä¸€è½®æ¶ˆæ¯äº¤æ¢ï¼Œè¿™å°†å¾—åˆ°ä¸¤é˜¶æ®µæäº¤åè®®ï¼ˆ2PCï¼‰ã€‚\nä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰ ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰æ˜¯è®¸å¤šç»å…¸å…³ç³»æ•°æ®åº“ä¸­ä½¿ç”¨çš„åè®®ã€‚ä¾‹å¦‚ï¼ŒMySQL Clusterï¼ˆä¸è¦ä¸å¸¸è§„ MySQL æ··æ·†ï¼‰ä½¿ç”¨ 2PC æä¾›åŒæ­¥å¤åˆ¶ã€‚ä¸‹å›¾è¯´æ˜äº†æ¶ˆæ¯æµï¼š\n[ Coordinator ] -\u0026gt; OK to commit? [ Peers ] \u0026lt;- Yes / No [ Coordinator ] -\u0026gt; Commit / Rollback [ Peers ] \u0026lt;- ACK åœ¨ç¬¬ä¸€é˜¶æ®µï¼ˆæŠ•ç¥¨é˜¶æ®µï¼‰ä¸­ï¼Œåè°ƒè€…å°†æ›´æ–°å‘é€ç»™æ‰€æœ‰å‚ä¸è€…ã€‚æ¯ä¸ªå‚ä¸è€…å¤„ç†æ›´æ–°å¹¶æŠ•ç¥¨å†³å®šæ˜¯å¦æäº¤æˆ–ä¸­æ­¢ã€‚å½“æŠ•ç¥¨å†³å®šæäº¤æ—¶ï¼Œå‚ä¸è€…å°†æ›´æ–°å­˜å‚¨åœ¨ä¸´æ—¶åŒºåŸŸï¼ˆé¢„å†™æ—¥å¿—ï¼‰ä¸­ã€‚åœ¨ç¬¬äºŒé˜¶æ®µå®Œæˆä¹‹å‰ï¼Œæ›´æ–°è¢«è§†ä¸ºä¸´æ—¶çš„ã€‚\nåœ¨ç¬¬äºŒé˜¶æ®µï¼ˆå†³ç­–é˜¶æ®µï¼‰ä¸­ï¼Œåè°ƒè€…å†³å®šæœ€ç»ˆç»“æœå¹¶é€šçŸ¥æ¯ä¸ªå‚ä¸è€…ã€‚å¦‚æœæ‰€æœ‰å‚ä¸è€…éƒ½æŠ•ç¥¨å†³å®šæäº¤ï¼Œé‚£ä¹ˆæ›´æ–°å°†ä»ä¸´æ—¶åŒºåŸŸä¸­å–å‡ºå¹¶å˜ä¸ºæ°¸ä¹…æ€§ã€‚\nåœ¨æäº¤å˜ä¸ºæ°¸ä¹…æ€§ä¹‹å‰å¼•å…¥ç¬¬äºŒé˜¶æ®µæ˜¯æœ‰ç”¨çš„ï¼Œå› ä¸ºå®ƒå…è®¸ç³»ç»Ÿåœ¨èŠ‚ç‚¹æ•…éšœæ—¶å›æ»šæ›´æ–°ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œåœ¨ä¸»/å¤‡ä»½ï¼ˆ\u0026ldquo;1PC\u0026rdquo;ï¼‰ä¸­ï¼Œæ²¡æœ‰å›æ»šæ“ä½œçš„æ­¥éª¤ï¼Œå› æ­¤åœ¨ä¸€äº›èŠ‚ç‚¹ä¸Šå¤±è´¥è€Œåœ¨å…¶ä»–èŠ‚ç‚¹ä¸ŠæˆåŠŸçš„æ“ä½œå¯èƒ½å¯¼è‡´å‰¯æœ¬å‘æ•£ã€‚\nä¸¤é˜¶æ®µæäº¤å®¹æ˜“å—åˆ°é˜»å¡çš„å½±å“ï¼Œå› ä¸ºå•ä¸ªèŠ‚ç‚¹æ•…éšœï¼ˆå‚ä¸è€…æˆ–åè°ƒè€…ï¼‰ä¼šé˜»å¡è¿›å±•ï¼Œç›´åˆ°èŠ‚ç‚¹æ¢å¤ã€‚åœ¨ç¬¬äºŒé˜¶æ®µæœŸé—´ï¼Œç”±äºå…¶ä»–èŠ‚ç‚¹è¢«å‘ŠçŸ¥ç³»ç»ŸçŠ¶æ€ï¼Œå› æ­¤é€šå¸¸å¯ä»¥è¿›è¡Œæ¢å¤ã€‚è¯·æ³¨æ„ï¼Œä¸¤é˜¶æ®µæäº¤å‡è®¾æ¯ä¸ªèŠ‚ç‚¹çš„ç¨³å®šå­˜å‚¨æ•°æ®æ°¸è¿œä¸ä¼šä¸¢å¤±ï¼Œå¹¶ä¸”æ²¡æœ‰èŠ‚ç‚¹æ°¸ä¹…å´©æºƒã€‚å¦‚æœç¨³å®šå­˜å‚¨ä¸­çš„æ•°æ®åœ¨å´©æºƒæ—¶æŸåï¼Œä»ç„¶å¯èƒ½å‘ç”Ÿæ•°æ®ä¸¢å¤±ã€‚\næœ‰å…³èŠ‚ç‚¹æ•…éšœæœŸé—´çš„æ¢å¤ç¨‹åºçš„è¯¦ç»†ä¿¡æ¯éå¸¸å¤æ‚ï¼Œæ‰€ä»¥æˆ‘ä¸ä¼šè¯¦ç»†ä»‹ç»ã€‚ä¸»è¦ä»»åŠ¡åŒ…æ‹¬ç¡®ä¿å†™å…¥ç£ç›˜æ˜¯æŒä¹…çš„ï¼ˆä¾‹å¦‚ï¼Œåˆ·æ–°åˆ°ç£ç›˜è€Œä¸æ˜¯ç¼“å­˜ï¼‰ä»¥åŠç¡®ä¿è¿›è¡Œæ­£ç¡®çš„æ¢å¤å†³ç­–ï¼ˆä¾‹å¦‚ï¼Œäº†è§£è½®æ¬¡çš„ç»“æœï¼Œç„¶åæœ¬åœ°é‡æ–°æ‰§è¡Œæˆ–æ’¤æ¶ˆæ›´æ–°ï¼‰ã€‚\næ­£å¦‚æˆ‘ä»¬åœ¨æœ‰å…³ CAP çš„ç« èŠ‚ä¸­äº†è§£åˆ°çš„é‚£æ ·ï¼Œä¸¤é˜¶æ®µæäº¤æ˜¯ CAï¼ˆä¸€è‡´æ€§å’Œå¯ç”¨æ€§ï¼‰çš„ï¼Œè€Œä¸æ˜¯åˆ†åŒºå®¹å¿æ€§ã€‚ä¸¤é˜¶æ®µæäº¤æ‰€æ¶‰åŠçš„æ•…éšœæ¨¡å‹ä¸åŒ…æ‹¬ç½‘ç»œåˆ†åŒºï¼›ä»ä¸€ä¸ªèŠ‚ç‚¹æ•…éšœä¸­æ¢å¤çš„è§„å®šæ–¹æ³•æ˜¯ç­‰å¾…ç½‘ç»œåˆ†åŒºæ¢å¤ã€‚æ²¡æœ‰å®‰å…¨çš„æ–¹å¼æ¥æå‡æ–°çš„åè°ƒè€…å¦‚æœä¸€ä¸ªå¤±è´¥ï¼›ç›¸åï¼Œéœ€è¦æ‰‹åŠ¨å¹²é¢„ã€‚ä¸¤é˜¶æ®µæäº¤å¯¹å»¶è¿Ÿä¹Ÿéå¸¸æ•æ„Ÿï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªå†™ N-of-N çš„æ–¹æ³•ï¼Œåœ¨æœ€æ…¢çš„èŠ‚ç‚¹ç¡®è®¤ä¹‹å‰æ— æ³•è¿›è¡Œå†™å…¥ã€‚\nä¸¤é˜¶æ®µæäº¤åœ¨æ€§èƒ½å’Œå®¹é”™æ€§ä¹‹é—´å–å¾—äº†å¾ˆå¥½çš„å¹³è¡¡ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒåœ¨å…³ç³»æ•°æ®åº“ä¸­éå¸¸æµè¡Œçš„åŸå› ã€‚ç„¶è€Œï¼Œè¾ƒæ–°çš„ç³»ç»Ÿé€šå¸¸ä½¿ç”¨å…·æœ‰åˆ†åŒºå®¹å¿æ€§çš„å…±è¯†ç®—æ³•ï¼Œå› ä¸ºè¿™ç§ç®—æ³•å¯ä»¥æä¾›ä»ä¸´æ—¶ç½‘ç»œåˆ†åŒºè‡ªåŠ¨æ¢å¤ä»¥åŠæ›´ä¼˜é›…åœ°å¤„ç†èŠ‚ç‚¹ä¹‹é—´å»¶è¿Ÿå¢åŠ çš„èƒ½åŠ›ã€‚\nè®©æˆ‘ä»¬æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹åˆ†åŒºå®¹å¿çš„å…±è¯†ç®—æ³•ã€‚\nåˆ†åŒºå®¹å¿å…±è¯†ç®—æ³• åˆ†åŒºå®¹å¿çš„å…±è¯†ç®—æ³•æ˜¯æˆ‘ä»¬åœ¨ç»´æŠ¤å•å‰¯æœ¬ä¸€è‡´æ€§æ–¹é¢æ‰€èƒ½è¾¾åˆ°çš„æœ€é«˜å®¹é”™ç®—æ³•ã€‚è¿˜æœ‰ä¸€ç±»æ›´è¿›ä¸€æ­¥çš„å®¹é”™ç®—æ³•ï¼šèƒ½å¤Ÿå®¹å¿ä»»æ„ï¼ˆæ‹œå åº­ï¼‰æ•…éšœçš„ç®—æ³•ï¼›è¿™äº›æ•…éšœåŒ…æ‹¬ä»¥æ¶æ„æ–¹å¼è¿ä½œçš„èŠ‚ç‚¹ã€‚è¿™ç±»ç®—æ³•åœ¨å•†ä¸šç³»ç»Ÿä¸­å¾ˆå°‘ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä»¬çš„è¿è¡Œæˆæœ¬æ›´é«˜ï¼Œå®ç°èµ·æ¥æ›´å¤æ‚ï¼Œå› æ­¤æˆ‘å°†ä¸å¯¹å…¶è¿›è¡Œä»‹ç»ã€‚\nå½“æ¶‰åŠåˆ°åˆ†åŒºå®¹å¿çš„å…±è¯†ç®—æ³•æ—¶ï¼Œæœ€è‘—åçš„ç®—æ³•æ˜¯ Paxos ç®—æ³•ã€‚ç„¶è€Œï¼ŒPaxos ç®—æ³•ä»¥å…¶éš¾ä»¥å®ç°å’Œè§£é‡Šè€Œé—»åï¼Œå› æ­¤æˆ‘å°†é‡ç‚¹ä»‹ç» Raft ç®—æ³•ï¼Œè¿™æ˜¯ä¸€ç§è¾ƒæ–°çš„ï¼ˆçº¦äº 2013 å¹´åˆï¼‰æ—¨åœ¨æ˜“äºæ•™å­¦å’Œå®ç°çš„ç®—æ³•ã€‚è®©æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹ç½‘ç»œåˆ†åŒºä»¥åŠåˆ†åŒºå®¹å¿çš„å…±è¯†ç®—æ³•çš„ä¸€èˆ¬ç‰¹ç‚¹ã€‚\nä»€ä¹ˆæ˜¯ç½‘ç»œåˆ†åŒºï¼Ÿ ç½‘ç»œåˆ†åŒºæ˜¯æŒ‡ç½‘ç»œé“¾è·¯å¯¹ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹çš„æ•…éšœã€‚èŠ‚ç‚¹æœ¬èº«ç»§ç»­ä¿æŒæ´»åŠ¨çŠ¶æ€ï¼Œç”šè‡³å¯ä»¥æ¥æ”¶æ¥è‡ªç½‘ç»œåˆ†åŒºä¸€ä¾§çš„å®¢æˆ·ç«¯è¯·æ±‚ã€‚æ­£å¦‚æˆ‘ä»¬ä¹‹å‰åœ¨è®¨è®º CAP å®šç†æ—¶äº†è§£åˆ°çš„é‚£æ ·ï¼Œç½‘ç»œåˆ†åŒºç¡®å®ä¼šå‘ç”Ÿï¼Œè€Œä¸æ˜¯æ‰€æœ‰ç³»ç»Ÿéƒ½èƒ½ä¼˜é›…åœ°å¤„ç†å®ƒä»¬ã€‚\nç½‘ç»œåˆ†åŒºå¾ˆæ£˜æ‰‹ï¼Œå› ä¸ºåœ¨ç½‘ç»œåˆ†åŒºæœŸé—´ï¼Œæ— æ³•åŒºåˆ†è¿œç¨‹èŠ‚ç‚¹çš„æ•…éšœå’ŒèŠ‚ç‚¹çš„ä¸å¯è®¿é—®æ€§ã€‚å¦‚æœå‘ç”Ÿç½‘ç»œåˆ†åŒºä½†æ²¡æœ‰èŠ‚ç‚¹æ•…éšœï¼Œé‚£ä¹ˆç³»ç»Ÿå°†åˆ†ä¸ºä¸¤ä¸ªåŒæ—¶æ´»åŠ¨çš„åˆ†åŒºã€‚ä¸‹é¢çš„ä¸¤ä¸ªå›¾ç¤ºå±•ç¤ºäº†ç½‘ç»œåˆ†åŒºå¦‚ä½•ä¸èŠ‚ç‚¹æ•…éšœç±»ä¼¼ã€‚\nä¸¤ä¸ªèŠ‚ç‚¹çš„ç³»ç»Ÿï¼Œä¸€ä¸ªæ˜¯æ•…éšœï¼Œä¸€ä¸ªæ˜¯ç½‘ç»œåˆ†åŒºï¼š\nå…·æœ‰ 3 ä¸ªèŠ‚ç‚¹çš„ç³»ç»Ÿï¼Œå‡ºç°æ•…éšœä¸ç½‘ç»œåˆ†åŒºï¼š\nå¼ºåˆ¶æ‰§è¡Œå•å‰¯æœ¬ä¸€è‡´æ€§çš„ç³»ç»Ÿå¿…é¡»æœ‰ä¸€ç§æ–¹æ³•æ¥æ‰“ç ´å¯¹ç§°æ€§ï¼Œå¦åˆ™å®ƒå°†åˆ†è£‚ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„ç³»ç»Ÿï¼Œè¿™äº›ç³»ç»Ÿå¯èƒ½ä¼šå‘æ•£ï¼Œå¹¶ä¸”æ— æ³•å†ä¿æŒå•å‰¯æœ¬çš„å¹»è±¡ã€‚\nå¯¹äºå¼ºåˆ¶æ‰§è¡Œå•å‰¯æœ¬ä¸€è‡´æ€§çš„ç³»ç»Ÿæ¥è¯´ï¼Œç½‘ç»œåˆ†åŒºå®¹å¿è¦æ±‚åœ¨ç½‘ç»œåˆ†åŒºæœŸé—´ï¼Œåªæœ‰ç³»ç»Ÿçš„ä¸€ä¸ªåˆ†åŒºä¿æŒæ´»åŠ¨çŠ¶æ€ï¼Œå› ä¸ºåœ¨ç½‘ç»œåˆ†åŒºæœŸé—´æ— æ³•é˜²æ­¢å‘æ•£ï¼ˆä¾‹å¦‚ï¼ŒCAP å®šç†ï¼‰çš„å‘ç”Ÿã€‚\nå¤šæ•°å†³å®š è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåˆ†åŒºå®¹å¿çš„å…±è¯†ç®—æ³•ä¾èµ–å¤šæ•°æŠ•ç¥¨ã€‚è¦æ±‚å¤§å¤šæ•°èŠ‚ç‚¹ï¼ˆè€Œä¸æ˜¯å…¨éƒ¨èŠ‚ç‚¹ï¼Œå¦‚ 2PC ä¸­çš„æƒ…å†µï¼‰å¯¹æ›´æ–°è¾¾æˆä¸€è‡´æ„è§ï¼Œå¯ä»¥å®¹å¿å°‘æ•°èŠ‚ç‚¹æ•…éšœã€è¿è¡Œç¼“æ…¢æˆ–ç”±äºç½‘ç»œåˆ†åŒºè€Œæ— æ³•è®¿é—®çš„æƒ…å†µã€‚åªè¦æœ‰ï¼ˆN/2 + 1ï¼‰ä¸ªæˆ–æ›´å¤šçš„èŠ‚ç‚¹æ­£å¸¸è¿è¡Œå¹¶å¯è®¿é—®ï¼Œç³»ç»Ÿå°±å¯ä»¥ç»§ç»­è¿è¡Œã€‚\nåˆ†åŒºå®¹å¿çš„å…±è¯†ç®—æ³•ä½¿ç”¨å¥‡æ•°ä¸ªèŠ‚ç‚¹ï¼ˆä¾‹å¦‚ 3ã€5 æˆ– 7ï¼‰ã€‚å¦‚æœåªæœ‰ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œå‘ç”Ÿæ•…éšœåå°±æ— æ³•å½¢æˆæ˜ç¡®çš„å¤šæ•°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœèŠ‚ç‚¹æ•°ä¸ºä¸‰ï¼Œé‚£ä¹ˆç³»ç»Ÿå¯ä»¥å®¹å¿ä¸€ä¸ªèŠ‚ç‚¹æ•…éšœï¼›å¦‚æœæœ‰äº”ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆç³»ç»Ÿå¯ä»¥å®¹å¿ä¸¤ä¸ªèŠ‚ç‚¹æ•…éšœã€‚\nå½“å‘ç”Ÿç½‘ç»œåˆ†åŒºæ—¶ï¼Œä¸åŒåˆ†åŒºçš„è¡Œä¸ºæ˜¯ä¸å¯¹ç§°çš„ã€‚ä¸€ä¸ªåˆ†åŒºå°†åŒ…å«å¤§å¤šæ•°èŠ‚ç‚¹ï¼Œè€Œå°‘æ•°åˆ†åŒºå°†åœæ­¢å¤„ç†æ“ä½œï¼Œä»¥é˜²æ­¢åœ¨ç½‘ç»œåˆ†åŒºæœŸé—´å‘ç”Ÿå‘æ•£ï¼Œä½†æ˜¯å¤šæ•°åˆ†åŒºå¯ä»¥ä¿æŒæ´»åŠ¨çŠ¶æ€ã€‚è¿™ç¡®ä¿åªæœ‰ç³»ç»ŸçŠ¶æ€çš„å•ä¸ªå‰¯æœ¬ä¿æŒæ´»åŠ¨ã€‚\nå¤šæ•°æŠ•ç¥¨ä¹Ÿæœ‰åŠ©äºå®¹å¿ä¸åŒæ„è§ï¼šå¦‚æœå‘ç”Ÿå¹²æ‰°æˆ–æ•…éšœï¼ŒèŠ‚ç‚¹å¯èƒ½ä¼šæŠ•ç¥¨å‡ºç°ä¸åŒçš„ç»“æœã€‚ç„¶è€Œï¼Œç”±äºåªèƒ½æœ‰ä¸€ä¸ªå¤šæ•°å†³ç­–ï¼Œä¸´æ—¶çš„ä¸ä¸€è‡´æœ€å¤šåªèƒ½é˜»å¡åè®®çš„ç»§ç»­è¿›è¡Œï¼ˆæ”¾å¼ƒæ´»æ€§ï¼‰ï¼Œä½†ä¸èƒ½è¿åå•å‰¯æœ¬ä¸€è‡´æ€§å‡†åˆ™ï¼ˆå®‰å…¨æ€§å±æ€§ï¼‰ã€‚\nè§’è‰² ç³»ç»Ÿå¯ä»¥é‡‡ç”¨ä¸¤ç§æ–¹å¼è¿›è¡Œç»“æ„åŒ–ï¼šæ‰€æœ‰èŠ‚ç‚¹å¯ä»¥å…·æœ‰ç›¸åŒçš„è´£ä»»ï¼Œæˆ–è€…èŠ‚ç‚¹å¯ä»¥å…·æœ‰ç‹¬ç«‹çš„ã€ä¸åŒçš„è§’è‰²ã€‚\nå¤åˆ¶çš„å…±è¯†ç®—æ³•é€šå¸¸é€‰æ‹©ä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ†é…ä¸åŒçš„è§’è‰²ã€‚æ‹¥æœ‰å•ä¸ªå›ºå®šçš„é¢†å¯¼è€…æˆ–ä¸»æœåŠ¡å™¨æ˜¯ä¸€ç§ä¼˜åŒ–ï¼Œå¯ä»¥ä½¿ç³»ç»Ÿæ›´é«˜æ•ˆï¼Œå› ä¸ºæˆ‘ä»¬çŸ¥é“æ‰€æœ‰çš„æ›´æ–°éƒ½å¿…é¡»é€šè¿‡è¯¥æœåŠ¡å™¨è¿›è¡Œã€‚éé¢†å¯¼è€…èŠ‚ç‚¹åªéœ€å°†å…¶è¯·æ±‚è½¬å‘ç»™é¢†å¯¼è€…ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‹¥æœ‰ä¸åŒçš„è§’è‰²å¹¶ä¸æ„å‘³ç€ç³»ç»Ÿæ— æ³•ä»é¢†å¯¼è€…ï¼ˆæˆ–ä»»ä½•å…¶ä»–è§’è‰²ï¼‰çš„æ•…éšœä¸­æ¢å¤ã€‚å³ä½¿åœ¨æ­£å¸¸æ“ä½œæœŸé—´è§’è‰²æ˜¯å›ºå®šçš„ï¼Œä¹Ÿå¹¶ä¸æ„å‘³ç€åœ¨æ•…éšœå‘ç”Ÿåä¸èƒ½é€šè¿‡é‡æ–°åˆ†é…è§’è‰²ï¼ˆä¾‹å¦‚é€šè¿‡é¢†å¯¼è€…é€‰ä¸¾é˜¶æ®µï¼‰æ¥æ¢å¤ã€‚èŠ‚ç‚¹å¯ä»¥é‡å¤ä½¿ç”¨é¢†å¯¼è€…é€‰ä¸¾çš„ç»“æœï¼Œç›´åˆ°å‘ç”ŸèŠ‚ç‚¹æ•…éšœå’Œ/æˆ–ç½‘ç»œåˆ†åŒºã€‚\nPaxos å’Œ Raft éƒ½ä½¿ç”¨äº†ä¸åŒçš„èŠ‚ç‚¹è§’è‰²ã€‚ç‰¹åˆ«æ˜¯ï¼Œå®ƒä»¬éƒ½æœ‰ä¸€ä¸ªé¢†å¯¼è€…èŠ‚ç‚¹ï¼ˆPaxos ä¸­ç§°ä¸º\u0026quot;proposer\u0026rdquo;ï¼‰ï¼Œè´Ÿè´£åœ¨æ­£å¸¸æ“ä½œæœŸé—´è¿›è¡Œåè°ƒã€‚åœ¨æ­£å¸¸æ“ä½œæœŸé—´ï¼Œå…¶ä½™çš„èŠ‚ç‚¹æ˜¯è·Ÿéšè€…ï¼ˆPaxos ä¸­çš„\u0026quot;acceptors\u0026quot;æˆ–\u0026quot;voters\u0026quot;ï¼‰ã€‚\nçºªå…ƒ æ¯ä¸ªæ­£å¸¸è¿è¡ŒæœŸé—´åœ¨ Paxos å’Œ Raft ä¸­è¢«ç§°ä¸ºä¸€ä¸ªæ—¶ä»£ï¼ˆåœ¨ Raft ä¸­ç§°ä¸º\u0026quot;term\u0026quot;ï¼‰ã€‚åœ¨æ¯ä¸ªæ—¶ä»£ä¸­ï¼Œåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹è¢«æŒ‡å®šä¸ºé¢†å¯¼è€…ï¼ˆç±»ä¼¼çš„ç³»ç»Ÿåœ¨æ—¥æœ¬è¢«ç”¨äºå¤©çš‡ç»§ä½æ—¶æ›´æ¢å¹´å·ï¼‰ã€‚\né€‰ä¸¾æˆåŠŸåï¼ŒåŒä¸€é¢†å¯¼è€…å°†åè°ƒå·¥ä½œç›´åˆ°æ—¶ä»£ç»“æŸã€‚å¦‚ Raft è®ºæ–‡ä¸­æ‰€ç¤ºçš„å›¾è¡¨ï¼Œæœ‰äº›é€‰ä¸¾å¯èƒ½ä¼šå¤±è´¥ï¼Œå¯¼è‡´æ—¶ä»£ç«‹å³ç»“æŸã€‚\næ—¶ä»£å……å½“é€»è¾‘æ—¶é’Ÿçš„ä½œç”¨ï¼Œå…è®¸å…¶ä»–èŠ‚ç‚¹è¯†åˆ«è¿‡æ—¶èŠ‚ç‚¹å¼€å§‹é€šä¿¡çš„æ—¶é—´ã€‚é‚£äº›è¢«åˆ’åˆ†æˆ–å¤„äºåœæ­¢è¿è¡ŒçŠ¶æ€çš„èŠ‚ç‚¹å°†å…·æœ‰è¾ƒå°çš„æ—¶ä»£ç¼–å·ï¼Œå…¶å‘½ä»¤å°†è¢«å¿½ç•¥ã€‚\né€šè¿‡å†³æ–—æ›´æ¢é¢†å¯¼è€… åœ¨æ­£å¸¸è¿è¡ŒæœŸé—´ï¼Œå…·æœ‰åˆ†åŒºå®¹é”™æ€§çš„å…±è¯†ç®—æ³•ç›¸å¯¹è¾ƒç®€å•ã€‚æ­£å¦‚ä¹‹å‰æ‰€çœ‹åˆ°çš„ï¼Œå¦‚æœæˆ‘ä»¬ä¸å…³å¿ƒå®¹é”™æ€§ï¼Œå¯ä»¥ä½¿ç”¨ä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰ã€‚å¤§éƒ¨åˆ†å¤æ‚æ€§å®é™…ä¸Šæ˜¯ç”±äºç¡®ä¿ä¸€æ—¦è¾¾æˆå…±è¯†å†³ç­–ï¼Œå®ƒå°†ä¸ä¼šä¸¢å¤±ï¼Œå¹¶ä¸”åè®®èƒ½å¤Ÿå¤„ç†ç”±äºç½‘ç»œæˆ–èŠ‚ç‚¹æ•…éšœè€Œå¼•èµ·çš„é¢†å¯¼è€…æ›´æ”¹ã€‚\næ‰€æœ‰èŠ‚ç‚¹æœ€åˆéƒ½æ˜¯è·Ÿéšè€…ï¼›åœ¨å¼€å§‹æ—¶é€‰ä¸¾ä¸€ä¸ªèŠ‚ç‚¹æˆä¸ºé¢†å¯¼è€…ã€‚åœ¨æ­£å¸¸è¿è¡ŒæœŸé—´ï¼Œé¢†å¯¼è€…ä¼šå‘é€å¿ƒè·³ä¿¡å·ï¼Œä»¥ä¾¿è·Ÿéšè€…å¯ä»¥æ£€æµ‹åˆ°é¢†å¯¼è€…æ˜¯å¦å¤±æ•ˆæˆ–åˆ†åŒºã€‚\nå½“èŠ‚ç‚¹æ£€æµ‹åˆ°é¢†å¯¼è€…å˜ä¸ºæ— å“åº”çŠ¶æ€ï¼ˆæˆ–åœ¨åˆå§‹æƒ…å†µä¸‹æ²¡æœ‰é¢†å¯¼è€…å­˜åœ¨ï¼‰ï¼Œå®ƒå°†åˆ‡æ¢åˆ°ä¸€ä¸ªä¸­é—´çŠ¶æ€ï¼ˆåœ¨ Raft ä¸­ç§°ä¸º\u0026quot;candidate\u0026quot;ï¼‰ï¼Œæ­¤æ—¶å®ƒä¼šå°†æ—¶ä»£/è½®æ¬¡å€¼å¢åŠ ä¸€ï¼Œå¹¶å‘èµ·é¢†å¯¼è€…é€‰ä¸¾å¹¶ç«äº‰æˆä¸ºæ–°çš„é¢†å¯¼è€…ã€‚\nä¸ºäº†å½“é€‰ä¸ºé¢†å¯¼è€…ï¼Œä¸€ä¸ªèŠ‚ç‚¹å¿…é¡»è·å¾—å¤§å¤šæ•°çš„é€‰ç¥¨ã€‚ä¸€ç§åˆ†é…é€‰ç¥¨çš„æ–¹æ³•æ˜¯ç®€å•åœ°æŒ‰ç…§å…ˆåˆ°å…ˆå¾—çš„åŸåˆ™è¿›è¡Œåˆ†é…ï¼›è¿™æ ·ï¼Œæœ€ç»ˆä¼šé€‰å‡ºä¸€ä¸ªé¢†å¯¼è€…ã€‚åœ¨å°è¯•å½“é€‰æ—¶æ·»åŠ éšæœºçš„ç­‰å¾…æ—¶é—´å¯ä»¥å‡å°‘åŒæ—¶å°è¯•å½“é€‰çš„èŠ‚ç‚¹æ•°é‡ã€‚\nä¸€ä¸ªçºªå…ƒå†…çš„ç¼–å·ææ¡ˆ åœ¨æ¯ä¸ªæ—¶æœŸï¼Œé¢†å¯¼è€…æ¯æ¬¡éƒ½ä¼šæå‡ºä¸€ä¸ªå€¼è¿›è¡ŒæŠ•ç¥¨ã€‚åœ¨æ¯ä¸ªæ—¶æœŸå†…ï¼Œæ¯ä¸ªææ¡ˆéƒ½ä½¿ç”¨å”¯ä¸€çš„ä¸¥æ ¼é€’å¢çš„ç¼–å·è¿›è¡Œç¼–å·ã€‚è¿½éšè€…ï¼ˆæŠ•ç¥¨è€…/æ¥å—è€…ï¼‰æ¥å—ä»–ä»¬æ”¶åˆ°çš„é’ˆå¯¹ç‰¹å®šææ¡ˆç¼–å·çš„ç¬¬ä¸€ä¸ªææ¡ˆã€‚\næ­£å¸¸è¿è¡ŒæœŸ åœ¨æ­£å¸¸è¿è¡ŒæœŸé—´ï¼Œæ‰€æœ‰ææ¡ˆéƒ½é€šè¿‡é¢†å¯¼è€…èŠ‚ç‚¹è¿›è¡Œå¤„ç†ã€‚å½“å®¢æˆ·ç«¯æäº¤ä¸€ä¸ªææ¡ˆï¼ˆä¾‹å¦‚æ›´æ–°æ“ä½œï¼‰æ—¶ï¼Œé¢†å¯¼è€…ä¼šè”ç³»é…é¢ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚å¦‚æœæ²¡æœ‰ç«äº‰æ€§çš„ææ¡ˆå­˜åœ¨ï¼ˆåŸºäºè·Ÿéšè€…çš„å“åº”ï¼‰ï¼Œé¢†å¯¼è€…æå‡ºè¯¥å€¼ã€‚å¦‚æœå¤§å¤šæ•°è·Ÿéšè€…æ¥å—è¯¥å€¼ï¼Œé‚£ä¹ˆè¯¥å€¼è¢«è§†ä¸ºå·²æ¥å—ã€‚\nç”±äºå¯èƒ½æœ‰å¦ä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿåœ¨å°è¯•å……å½“é¢†å¯¼è€…ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿ä¸€æ—¦ä¸€ä¸ªææ¡ˆè¢«æ¥å—ï¼Œå…¶å€¼å°±ä¸èƒ½æ”¹å˜ã€‚å¦åˆ™ï¼Œå·²ç»è¢«æ¥å—çš„ææ¡ˆå¯èƒ½ä¼šè¢«ç«äº‰å¯¹æ‰‹é¢†å¯¼è€…æ’¤é”€ã€‚Lamport å°†æ­¤è§„å®šä¸ºï¼š\nP2ï¼šå¦‚æœé€‰æ‹©äº†ä¸€ä¸ªå€¼ä¸º v çš„ææ¡ˆï¼Œé‚£ä¹ˆè¢«é€‰æ‹©çš„æ¯ä¸ªæ›´é«˜ç¼–å·çš„ææ¡ˆéƒ½å…·æœ‰å€¼ vã€‚\nç¡®ä¿è¯¥å±æ€§æˆç«‹è¦æ±‚è·Ÿéšè€…å’Œæè®®è€…éƒ½å—åˆ°ç®—æ³•çš„çº¦æŸï¼Œä¸èƒ½æ”¹å˜å·²è¢«å¤§å¤šæ•°æ¥å—çš„å€¼ã€‚æ³¨æ„ï¼Œâ€œå€¼æ°¸è¿œä¸ä¼šæ”¹å˜â€æ˜¯æŒ‡åè®®çš„å•ä¸ªæ‰§è¡Œï¼ˆæˆ–è¿è¡Œ/å®ä¾‹/å†³ç­–ï¼‰çš„å€¼ã€‚å…¸å‹çš„å¤åˆ¶ç®—æ³•å°†è¿è¡Œå¤šä¸ªç®—æ³•çš„æ‰§è¡Œï¼Œä½†å¤§å¤šæ•°å…³äºç®—æ³•çš„è®¨è®ºéƒ½é›†ä¸­åœ¨å•ä¸ªè¿è¡Œä¸Šï¼Œä»¥ä¿æŒç®€å•ã€‚æˆ‘ä»¬å¸Œæœ›é˜²æ­¢å†³ç­–å†å²è¢«ä¿®æ”¹æˆ–è¦†ç›–ã€‚\nä¸ºäº†å¼ºåˆ¶æ‰§è¡Œè¿™ä¸ªå±æ€§ï¼Œæè®®è€…å¿…é¡»é¦–å…ˆå‘è·Ÿéšè€…è¯¢é—®å®ƒä»¬ï¼ˆæœ€é«˜ç¼–å·çš„ï¼‰å·²æ¥å—çš„ææ¡ˆå’Œå€¼ã€‚å¦‚æœæè®®è€…å‘ç°å·²ç»å­˜åœ¨ä¸€ä¸ªææ¡ˆï¼Œé‚£ä¹ˆå®ƒå¿…é¡»ç®€å•åœ°å®Œæˆè¯¥åè®®çš„æ‰§è¡Œï¼Œè€Œä¸æ˜¯æå‡ºè‡ªå·±çš„ææ¡ˆã€‚Lamport å°†æ­¤è§„å®šä¸ºï¼š\nP2b. å¦‚æœé€‰æ‹©äº†ä¸€ä¸ªå€¼ä¸º v çš„ææ¡ˆï¼Œé‚£ä¹ˆç”±ä»»ä½•æè®®è€…å‘å‡ºçš„æ¯ä¸ªæ›´é«˜ç¼–å·çš„ææ¡ˆéƒ½å…·æœ‰å€¼ vã€‚\næ›´å…·ä½“åœ°è¯´ï¼š\nP2c. å¯¹äºä»»ä½• v å’Œ nï¼Œå¦‚æœä¸€ä¸ªå€¼ä¸º v ä¸”ç¼–å·ä¸º n çš„ææ¡ˆè¢«å‘å‡ºï¼ˆç”±é¢†å¯¼è€…ï¼‰ï¼Œé‚£ä¹ˆå­˜åœ¨ä¸€ä¸ªç”±å¤§å¤šæ•°æ¥å—è€…ï¼ˆè·Ÿéšè€…ï¼‰ç»„æˆçš„é›†åˆ Sï¼Œå…¶ä¸­è¦ä¹ˆï¼ˆaï¼‰S ä¸­çš„æ²¡æœ‰æ¥å—ä»»ä½•ç¼–å·å°äº n çš„ææ¡ˆçš„æ¥å—è€…ï¼Œè¦ä¹ˆï¼ˆbï¼‰v æ˜¯ S ä¸­çš„è·Ÿéšè€…æ¥å—çš„æ‰€æœ‰ç¼–å·å°äº n çš„ææ¡ˆä¸­æœ€é«˜ç¼–å·ææ¡ˆçš„å€¼ã€‚\nè¿™æ˜¯ Paxos ç®—æ³•ä»¥åŠä»ä¸­è¡ç”Ÿçš„ç®—æ³•çš„æ ¸å¿ƒã€‚è¦æå‡ºçš„å€¼ç›´åˆ°åè®®çš„ç¬¬äºŒé˜¶æ®µæ‰ä¼šè¢«é€‰æ‹©ã€‚ä¸ºäº†ç¡®ä¿å®‰å…¨æ€§ï¼ˆä¾‹å¦‚ P2c ä¸­çš„ b æ¡æ¬¾ï¼‰ï¼Œæè®®è€…æœ‰æ—¶å¿…é¡»ç®€å•åœ°é‡ä¼ å…ˆå‰åšå‡ºçš„å†³ç­–ï¼Œç›´åˆ°è¾¾åˆ°ä¸€ä¸ªä»–ä»¬çŸ¥é“å¯ä»¥è‡ªç”±æå‡ºè‡ªå·±çš„ææ¡ˆå€¼çš„ç‚¹ï¼ˆä¾‹å¦‚ P2c ä¸­çš„ a æ¡æ¬¾ï¼‰ã€‚\nå¦‚æœå­˜åœ¨å¤šä¸ªå…ˆå‰çš„ææ¡ˆï¼Œåˆ™æè®®çš„æ˜¯æœ€é«˜ç¼–å·çš„ææ¡ˆå€¼ã€‚åªæœ‰åœ¨æ²¡æœ‰ç«äº‰æ€§ææ¡ˆçš„æƒ…å†µä¸‹ï¼Œæè®®è€…æ‰å¯ä»¥å°è¯•æ–½åŠ è‡ªå·±çš„å€¼ã€‚\nä¸ºäº†ç¡®ä¿åœ¨æè®®è€…è¯¢é—®æ¯ä¸ªæ¥å—è€…å…¶æœ€æ–°å€¼ä¹‹é—´ä¸ä¼šå‡ºç°ç«äº‰æ€§ææ¡ˆï¼Œæè®®è€…è¦æ±‚è·Ÿéšè€…ä¸æ¥å—ä½äºå½“å‰ææ¡ˆç¼–å·çš„ææ¡ˆã€‚\nå°†è¿™äº›éƒ¨åˆ†æ•´åˆåœ¨ä¸€èµ·ï¼Œä½¿ç”¨ Paxos è¾¾æˆå†³ç­–éœ€è¦ä¸¤è½®é€šä¿¡ï¼š\n[ Proposer ] -\u0026gt; Prepare(n) [ Followers ] \u0026lt;- Promise(n; previous proposal number and previous value if accepted a proposal in the past) [ Proposer ] -\u0026gt; AcceptRequest(n, own value or the value [ Followers ] associated with the highest proposal number reported by the followers) \u0026lt;- Accepted(n, value) å‡†å¤‡é˜¶æ®µå…è®¸æè®®è€…äº†è§£ä»»ä½•ç«äº‰æˆ–å…ˆå‰çš„ææ¡ˆã€‚ç¬¬äºŒé˜¶æ®µæ˜¯æå‡ºæ–°å€¼æˆ–å…ˆå‰æ¥å—çš„å€¼çš„é˜¶æ®µã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ¯”å¦‚åŒæ—¶å­˜åœ¨ä¸¤ä¸ªæè®®è€…ï¼ˆç«äº‰ï¼‰ï¼Œæ¶ˆæ¯ä¸¢å¤±ï¼Œæˆ–è€…å¤§å¤šæ•°èŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶ï¼Œæ²¡æœ‰ææ¡ˆè¢«å¤§å¤šæ•°æ¥å—ã€‚ä½†è¿™æ˜¯å¯ä»¥æ¥å—çš„ï¼Œå› ä¸ºå…³äºæå‡ºå“ªä¸ªå€¼çš„å†³ç­–è§„åˆ™ä¼šè¶‹å‘äºæ”¶æ•›åˆ°ä¸€ä¸ªå€¼ï¼ˆä¸Šä¸€æ¬¡å°è¯•ä¸­å…·æœ‰æœ€é«˜ææ¡ˆç¼–å·çš„å€¼ï¼‰ã€‚\nçš„ç¡®ï¼Œæ ¹æ® FLP ä¸å¯èƒ½æ€§ç»“æœï¼Œè¿™æ˜¯æˆ‘ä»¬èƒ½åšåˆ°çš„æœ€å¥½çš„ï¼šè§£å†³å…±è¯†é—®é¢˜çš„ç®—æ³•åœ¨æ¶ˆæ¯ä¼ é€’çš„ç•Œé™ä¸æ»¡è¶³æ—¶ï¼Œå¿…é¡»åœ¨å®‰å…¨æ€§å’Œæ´»æ€§ä¹‹é—´åšå‡ºæƒè¡¡ã€‚Paxos æ”¾å¼ƒäº†æ´»æ€§ï¼šå®ƒå¯èƒ½ä¸å¾—ä¸æ— é™æœŸåœ°å»¶è¿Ÿå†³ç­–ï¼Œç›´åˆ°æ²¡æœ‰ç«äº‰çš„é¢†å¯¼è€…ï¼Œå¹¶ä¸”å¤§å¤šæ•°èŠ‚ç‚¹æ¥å—ææ¡ˆã€‚è¿™æ¯”è¿åå®‰å…¨æ€§ä¿è¯è¦å¥½ã€‚\nå½“ç„¶ï¼Œå®ç°è¿™ä¸ªç®—æ³•è¦æ¯”å¬èµ·æ¥çš„è¦å›°éš¾å¾—å¤šã€‚å³ä½¿åœ¨ä¸“å®¶çš„æ‰‹ä¸­ï¼Œè®¸å¤šå°é—®é¢˜åŠ åœ¨ä¸€èµ·ä¹Ÿä¼šå½¢æˆç›¸å½“å¤§é‡çš„ä»£ç ã€‚è¿™äº›é—®é¢˜åŒ…æ‹¬ï¼š\nå®é™…ä¼˜åŒ–ï¼š é€šè¿‡é¢†å¯¼ç§Ÿçº¦ï¼ˆè€Œä¸æ˜¯å¿ƒè·³ï¼‰é¿å…é‡å¤çš„é¢†å¯¼è€…é€‰ä¸¾ åœ¨å¤„äºç¨³å®šçŠ¶æ€ä¸”é¢†å¯¼è€…èº«ä»½ä¸å˜çš„æƒ…å†µä¸‹é¿å…é‡å¤çš„æå‡ºæ¶ˆæ¯ ç¡®ä¿è·Ÿéšè€…å’Œæè®®è€…ä¸ä¼šä¸¢å¤±ç¨³å®šå­˜å‚¨ä¸­çš„é¡¹ç›®ï¼Œå¹¶ä¸”ç¨³å®šå­˜å‚¨ä¸­çš„ç»“æœä¸ä¼šè¢«ç»†å¾®æŸåï¼ˆä¾‹å¦‚ç£ç›˜æŸåï¼‰ ä»¥å®‰å…¨æ–¹å¼å¯ç”¨ç¾¤é›†æˆå‘˜èµ„æ ¼çš„æ›´æ”¹ï¼ˆä¾‹å¦‚ï¼ŒåŸºæœ¬çš„ Paxos ä¾èµ–äºå¤§å¤šæ•°èŠ‚ç‚¹æ€»æ˜¯åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸­ç›¸äº¤ï¼Œå¦‚æœæˆå‘˜èµ„æ ¼å¯ä»¥ä»»æ„æ›´æ”¹ï¼Œåˆ™ä¸æˆç«‹ï¼‰ åœ¨å´©æºƒã€ç£ç›˜ä¸¢å¤±æˆ–æ–°èŠ‚ç‚¹ä¾›åº”æ—¶ä»¥å®‰å…¨é«˜æ•ˆçš„æ–¹å¼ä½¿æ–°å‰¯æœ¬ä¿æŒæœ€æ–° åœ¨ä¸€æ®µåˆç†çš„æ—¶é—´åå¯¹ä¿è¯å®‰å…¨æ€§æ‰€éœ€çš„æ•°æ®è¿›è¡Œå¿«ç…§å’Œåƒåœ¾å›æ”¶çš„ç¨‹åºï¼ˆä¾‹å¦‚ï¼Œå¹³è¡¡å­˜å‚¨éœ€æ±‚å’Œå®¹é”™éœ€æ±‚ï¼‰ Google çš„ã€ŠPaxos Made Liveã€‹è®ºæ–‡è¯¦ç»†ä»‹ç»äº†å…¶ä¸­çš„ä¸€äº›æŒ‘æˆ˜ã€‚ åˆ†åŒºå®¹å¿å…±è¯†ç®—æ³•ï¼šPaxosã€Raftã€ZAB å¸Œæœ›è¿™äº›ä¿¡æ¯è®©ä½ å¯¹å®¹é”™å…±è¯†ç®—æ³•çš„å·¥ä½œåŸç†æœ‰äº†ä¸€å®šçš„äº†è§£ã€‚æˆ‘é¼“åŠ±ä½ é˜…è¯»è¿›ä¸€æ­¥é˜…è¯»éƒ¨åˆ†ä¸­çš„å…¶ä¸­ä¸€ç¯‡è®ºæ–‡ï¼Œä»¥æ›´å¥½åœ°äº†è§£ä¸åŒç®—æ³•çš„å…·ä½“ç»†èŠ‚ã€‚\nPaxosï¼šPaxos æ˜¯ç¼–å†™å¼ºä¸€è‡´æ€§å®¹é”™å¤åˆ¶ç³»ç»Ÿæ—¶æœ€é‡è¦çš„ç®—æ³•ä¹‹ä¸€ã€‚å®ƒè¢«å¹¿æ³›åº”ç”¨äºè°·æ­Œçš„è®¸å¤šç³»ç»Ÿä¸­ï¼ŒåŒ…æ‹¬ BigTable/Megastore ä½¿ç”¨çš„ Chubby é”ç®¡ç†å™¨ã€Google æ–‡ä»¶ç³»ç»Ÿä»¥åŠ Spannerã€‚\nPaxos çš„åç§°æ¥è‡ªå¸Œè…Šå²›å±¿å¸•å…‹ç´¢æ–¯ï¼Œæœ€åˆç”± Leslie Lamport åœ¨ 1998 å¹´çš„ä¸€ç¯‡åä¸ºã€Šå…¼èŒè®®ä¼šã€‹çš„è®ºæ–‡ä¸­æå‡ºã€‚äººä»¬é€šå¸¸è®¤ä¸º Paxos çš„å®ç°å¾ˆå›°éš¾ï¼Œå› æ­¤æœ‰ä¸€ç³»åˆ—æ¥è‡ªåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé¢†åŸŸå…·æœ‰ç›¸å½“ç»éªŒçš„å…¬å¸çš„è®ºæ–‡ï¼Œè¿›ä¸€æ­¥è§£é‡Šäº†å®é™…ç»†èŠ‚ï¼ˆè¯·å‚é˜…è¿›ä¸€æ­¥é˜…è¯»éƒ¨åˆ†ï¼‰ã€‚ä½ å¯èƒ½ä¼šæƒ³é˜…è¯» Lamport åœ¨æ­¤é—®é¢˜ä¸Šçš„è¯„è®ºï¼ˆé“¾æ¥ 1 å’Œé“¾æ¥ 2ï¼‰ã€‚\nè¿™äº›é—®é¢˜ä¸»è¦ä¸ Paxos è¢«æè¿°ä¸ºä¸€è½®å…±è¯†å†³ç­–ç›¸å…³ï¼Œä½†å®é™…çš„å·¥ä½œå®æ–½é€šå¸¸å¸Œæœ›èƒ½å¤Ÿé«˜æ•ˆåœ°è¿è¡Œå¤šè½®å…±è¯†ã€‚è¿™å¯¼è‡´äº†è®¸å¤šå¯¹æ ¸å¿ƒåè®®çš„æ‰©å±•çš„å¼€å‘ï¼Œä»»ä½•æƒ³æ„å»ºåŸºäº Paxos çš„ç³»ç»Ÿçš„äººéƒ½éœ€è¦ç†è§£è¿™äº›æ‰©å±•ã€‚æ­¤å¤–ï¼Œè¿˜å­˜åœ¨å…¶ä»–å®é™…æŒ‘æˆ˜ï¼Œä¾‹å¦‚å¦‚ä½•å®ç°é›†ç¾¤æˆå‘˜èµ„æ ¼çš„å˜æ›´ã€‚\nZABï¼šZABï¼ˆZookeeper Atomic Broadcastï¼‰åè®®åœ¨ Apache Zookeeper ä¸­ä½¿ç”¨ã€‚Zookeeper æ˜¯ä¸€ä¸ªä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿæä¾›åè°ƒåŸè¯­çš„ç³»ç»Ÿï¼Œè®¸å¤šä»¥ Hadoop ä¸ºä¸­å¿ƒçš„åˆ†å¸ƒå¼ç³»ç»Ÿç”¨äºåè°ƒï¼ˆä¾‹å¦‚ HBaseã€Stormã€Kafkaï¼‰ã€‚Zookeeper åŸºæœ¬ä¸Šæ˜¯å¼€æºç¤¾åŒºå¯¹ Chubby çš„å®ç°ã€‚ä»æŠ€æœ¯ä¸Šè®²ï¼ŒåŸå­å¹¿æ’­æ˜¯ä¸€ä¸ªä¸çº¯å…±è¯†ä¸åŒçš„é—®é¢˜ï¼Œä½†å®ƒä»å±äºç¡®ä¿å¼ºä¸€è‡´æ€§çš„å®¹é”™ç®—æ³•çš„èŒƒç•´ã€‚\nRaftï¼šRaft æ˜¯è¿™ç±»ç®—æ³•çš„æœ€æ–°æˆå‘˜ï¼ˆäº 2013 å¹´æå‡ºï¼‰ã€‚å®ƒçš„è®¾è®¡ç›®æ ‡æ˜¯æ¯” Paxos æ›´å®¹æ˜“æ•™æˆï¼ŒåŒæ—¶æä¾›ç›¸åŒçš„ä¿è¯ã€‚ç‰¹åˆ«æ˜¯ï¼Œè¯¥ç®—æ³•çš„ä¸åŒéƒ¨åˆ†æ›´æ¸…æ™°åœ°åˆ†ç¦»ï¼Œè®ºæ–‡è¿˜æè¿°äº†ä¸€ç§é›†ç¾¤æˆå‘˜èµ„æ ¼å˜æ›´çš„æœºåˆ¶ã€‚æœ€è¿‘ï¼Œetcd åœ¨å—åˆ° ZooKeeper çš„å¯å‘ä¸‹å¼€å§‹é‡‡ç”¨ Raftã€‚\nå¼ºä¸€è‡´æ€§çš„å¤åˆ¶æ–¹æ³• åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬ç ”ç©¶äº†å¼ºä¸€è‡´æ€§çš„å¤åˆ¶æ–¹æ³•ã€‚ä»åŒæ­¥å·¥ä½œå’Œå¼‚æ­¥å·¥ä½œçš„å¯¹æ¯”å¼€å§‹ï¼Œé€æ­¥ä»‹ç»äº†èƒ½å¤Ÿå®¹å¿è¶Šæ¥è¶Šå¤æ‚æ•…éšœçš„ç®—æ³•ã€‚ä»¥ä¸‹æ˜¯æ¯ä¸ªç®—æ³•çš„ä¸€äº›å…³é”®ç‰¹ç‚¹ï¼š\nä¸»/å¤‡ä»½\nå•ä¸ªå›ºå®šçš„ä¸»èŠ‚ç‚¹ å¤åˆ¶æ—¥å¿—ï¼Œä»èŠ‚ç‚¹ä¸å‚ä¸æ‰§è¡Œæ“ä½œ æ²¡æœ‰å¯¹å¤åˆ¶å»¶è¿Ÿè®¾ç½®ç•Œé™ ä¸å…·å¤‡å®¹é”™æ€§ï¼Œä¸æ”¯æŒåˆ†åŒºå®¹å¿æ€§ æ‰‹åŠ¨/ä¸´æ—¶æ•…éšœè½¬ç§»ï¼Œä¸å…·å¤‡å®¹é”™æ€§ï¼Œçƒ­å¤‡ä»½ 2PCï¼ˆä¸¤é˜¶æ®µæäº¤ï¼‰\nå…¨ä½“æŠ•ç¥¨ï¼šæäº¤æˆ–ä¸­æ­¢ é™æ€ä¸»èŠ‚ç‚¹ 2PC æ— æ³•åœ¨åè°ƒè€…å’ŒèŠ‚ç‚¹åœ¨æäº¤æœŸé—´åŒæ—¶å‘ç”Ÿæ•…éšœæ—¶ç”Ÿå­˜ ä¸å…·å¤‡å®¹é”™æ€§ï¼Œå¯¹å°¾å»¶è¿Ÿæ•æ„Ÿ Paxos\nå¤šæ•°æ´¾æŠ•ç¥¨ åŠ¨æ€ä¸»èŠ‚ç‚¹ ä½œä¸ºåè®®çš„ä¸€éƒ¨åˆ†ï¼Œèƒ½å¤Ÿå®¹å¿ n/2-1 åŒæ—¶å‘ç”Ÿçš„æ•…éšœ å¯¹å°¾å»¶è¿Ÿä¸å¤ªæ•æ„Ÿ è¿›ä¸€æ­¥é˜…è¯» ä¸»å¤‡å’Œ 2PC Replication techniques for availability - Robbert van Renesse \u0026amp; Rachid Guerraoui, 2010 Concurrency Control and Recovery in Database Systems Paxos The Part-Time Parliament - Leslie Lamport Paxos Made Simple - Leslie Lamport, 2001 Paxos Made Live - An Engineering Perspective - Chandra et al Paxos Made Practical - Mazieres, 2007 Revisiting the Paxos Algorithm - Lynch et al How to build a highly available system with consensus - Butler Lampson Reconfiguring a State Machine - Lamport et al - changing cluster membership Implementing Fault-Tolerant Services Using the State Machine Approach: a Tutorial - Fred Schneider Raft and ZAB In Search of an Understandable Consensus Algorithm, Diego Ongaro, John Ousterhout, 2013 Raft Lecture - User Study A simple totally ordered broadcast protocol - Junqueira, Reed, 2008 ZooKeeper Atomic Broadcast - Reed, 2011 ","permalink":"https://blog.chensoul.cc/posts/2023/11/10/distributed-systems-04/","summary":"ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹æ˜¯ä¸€æœ¬å¹¿å—æ¬¢è¿çš„èµ„æºï¼Œç”¨äºç†è§£å’Œå­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿã€‚è¯¥ä¹¦ç”±ä½œè€… Mikito Takada æ’°å†™ï¼Œä»‹ç»äº†æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºæœ¬æ¦‚å¿µã€åŸåˆ™å’ŒæŒ‘æˆ˜ã€‚\nè¿™æœ¬ä¹¦æ¶µç›–äº†ä¸åˆ†å¸ƒå¼ç³»ç»Ÿç›¸å…³çš„å¹¿æ³›ä¸»é¢˜ï¼ŒåŒ…æ‹¬ç½‘ç»œã€å®¹é”™æ€§ã€ä¸€è‡´æ€§æ¨¡å‹ã€åˆ†å¸ƒå¼ç®—æ³•ã€å¯æ‰©å±•æ€§ç­‰ç­‰ã€‚å®ƒæ—¨åœ¨ä»¥æ¸…æ™°æ˜“æ‡‚çš„æ–¹å¼è§£é‡Šå¤æ‚çš„æ¦‚å¿µï¼Œé€‚åˆåˆå­¦è€…å’Œæœ‰ç»éªŒçš„åˆ†å¸ƒå¼ç³»ç»Ÿä»ä¸šè€…é˜…è¯»ã€‚\nåœ¨æ•´æœ¬ä¹¦ä¸­ï¼Œä½œè€…æä¾›äº†å„ç§å®é™…æ¡ˆä¾‹å’Œæ¡ˆä¾‹ç ”ç©¶ï¼Œä»¥è¯´æ˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®é™…åº”ç”¨å’Œå®è·µæ–¹é¢ã€‚å®ƒè¿˜å¼ºè°ƒäº†æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿæ¶‰åŠçš„æƒè¡¡å’Œè®¾è®¡è€ƒè™‘ï¼Œå¸®åŠ©è¯»è€…å…¨é¢ç†è§£è¿™ä¸ªä¸»é¢˜ã€‚\nã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹ä½œä¸ºå¼€æºèµ„æºï¼Œå¯ä»¥å…è´¹åœ¨çº¿è·å–ï¼Œéå¸¸é€‚åˆä»»ä½•å¯¹å­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿæ„Ÿå…´è¶£çš„äººã€‚\nåŸæ–‡é“¾æ¥ï¼šDistributed systems: for fun and profit\n4. å¤åˆ¶ å¤åˆ¶é—®é¢˜æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä¼—å¤šé—®é¢˜ä¹‹ä¸€ã€‚ä¸è¯¸å¦‚é¢†å¯¼è€…é€‰ä¸¾ã€æ•…éšœæ£€æµ‹ã€äº’æ–¥ã€å…±è¯†å’Œå…¨å±€å¿«ç…§ç­‰å…¶ä»–é—®é¢˜ç›¸æ¯”ï¼Œæˆ‘é€‰æ‹©å…³æ³¨å¤åˆ¶é—®é¢˜ï¼Œå› ä¸ºè¿™é€šå¸¸æ˜¯äººä»¬æœ€æ„Ÿå…´è¶£çš„éƒ¨åˆ†ã€‚å¹¶è¡Œæ•°æ®åº“åœ¨å¤åˆ¶ç‰¹æ€§æ–¹é¢çš„å·®å¼‚åŒ–å°±æ˜¯ä¸€ä¸ªä¾‹å­ã€‚æ­¤å¤–ï¼Œå¤åˆ¶ä¸ºè®¸å¤šå­é—®é¢˜æä¾›äº†ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œä¾‹å¦‚é¢†å¯¼è€…é€‰ä¸¾ã€æ•…éšœæ£€æµ‹ã€å…±è¯†å’ŒåŸå­å¹¿æ’­ã€‚\nå¤åˆ¶æ˜¯ä¸€ä¸ªç»„é€šä¿¡é—®é¢˜ã€‚ä»€ä¹ˆæ ·çš„å®‰æ’å’Œé€šä¿¡æ¨¡å¼èƒ½å¤Ÿæ»¡è¶³æˆ‘ä»¬æ‰€æœŸæœ›çš„æ€§èƒ½å’Œå¯ç”¨æ€§ç‰¹æ€§ï¼Ÿåœ¨é¢å¯¹ç½‘ç»œåˆ†åŒºå’ŒåŒæ—¶èŠ‚ç‚¹æ•…éšœçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¦‚ä½•ç¡®ä¿å®¹é”™æ€§ã€è€ä¹…æ€§å’Œéå‘æ•£æ€§ï¼Ÿ\nåŒæ ·ï¼Œæœ‰è®¸å¤šæ–¹æ³•å¯ä»¥è§£å†³å¤åˆ¶é—®é¢˜ã€‚æˆ‘åœ¨è¿™é‡Œé‡‡ç”¨çš„æ–¹æ³•åªæ˜¯çœ‹ä¸€ä¸‹å…·æœ‰å¤åˆ¶åŠŸèƒ½çš„ç³»ç»Ÿå¯èƒ½å…·æœ‰çš„é«˜çº§æ¨¡å¼ã€‚ä»å¯è§†åŒ–çš„è§’åº¦æ¥çœ‹ï¼Œæœ‰åŠ©äºå°†è®¨è®ºé›†ä¸­åœ¨æ•´ä½“æ¨¡å¼ä¸Šï¼Œè€Œä¸æ˜¯å…·ä½“æ¶‰åŠçš„æ¶ˆæ¯ä¼ é€’ã€‚æˆ‘åœ¨è¿™é‡Œçš„ç›®æ ‡æ˜¯æ¢ç´¢è®¾è®¡ç©ºé—´ï¼Œè€Œä¸æ˜¯è§£é‡Šæ¯ä¸ªç®—æ³•çš„å…·ä½“ç»†èŠ‚ã€‚\nè®©æˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸‹å¤åˆ¶æ˜¯ä»€ä¹ˆæ ·å­ã€‚æˆ‘ä»¬å‡è®¾æˆ‘ä»¬æœ‰ä¸€äº›åˆå§‹æ•°æ®åº“ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚æ¥æ”¹å˜æ•°æ®åº“çš„çŠ¶æ€ã€‚\nè¿™ç§å®‰æ’å’Œé€šä¿¡æ¨¡å¼å¯ä»¥åˆ†ä¸ºå‡ ä¸ªé˜¶æ®µï¼š\nï¼ˆè¯·æ±‚ï¼‰å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ ï¼ˆåŒæ­¥ï¼‰è¿›è¡Œå¤åˆ¶çš„åŒæ­¥éƒ¨åˆ† ï¼ˆå“åº”ï¼‰å°†å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ ï¼ˆå¼‚æ­¥ï¼‰è¿›è¡Œå¤åˆ¶çš„å¼‚æ­¥éƒ¨åˆ† æ ¹æ®è¿™äº›é˜¶æ®µï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸åŒçš„é€šä¿¡æ¨¡å¼ã€‚æˆ‘ä»¬é€‰æ‹©çš„æ¨¡å¼å°†å¯¹æ€§èƒ½å’Œå¯ç”¨æ€§äº§ç”Ÿå½±å“ï¼Œå…·ä½“å–å†³äºæ‰€é€‰æ‹©çš„ç®—æ³•ã€‚\nåŒæ­¥å¤åˆ¶ ç¬¬ä¸€ä¸ªæ¨¡å¼æ˜¯åŒæ­¥å¤åˆ¶ï¼ˆä¹Ÿç§°ä¸ºä¸»åŠ¨å¤åˆ¶ã€æ€¥åˆ‡å¤åˆ¶ã€æ¨é€å¤åˆ¶æˆ–æ‚²è§‚å¤åˆ¶ï¼‰ã€‚è®©æˆ‘ä»¬ç”»å‡ºå®ƒçš„ç¤ºæ„å›¾ï¼š\nåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸‰ä¸ªæ˜æ˜¾çš„é˜¶æ®µï¼šé¦–å…ˆï¼Œå®¢æˆ·ç«¯å‘é€è¯·æ±‚ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ‰€ç§°çš„åŒæ­¥å¤åˆ¶çš„éƒ¨åˆ†å‘ç”Ÿã€‚è¿™ä¸ªæœ¯è¯­æŒ‡çš„æ˜¯å®¢æˆ·ç«¯è¢«é˜»å¡ - ç­‰å¾…ç³»ç»Ÿçš„å›å¤ã€‚\nåœ¨åŒæ­¥é˜¶æ®µæœŸé—´ï¼Œç¬¬ä¸€ä¸ªæœåŠ¡å™¨ä¼šè”ç³»å…¶ä»–ä¸¤ä¸ªæœåŠ¡å™¨ï¼Œå¹¶ç­‰å¾…æ”¶åˆ°æ‰€æœ‰å…¶ä»–æœåŠ¡å™¨çš„å›å¤ã€‚æœ€åï¼Œå®ƒå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªå“åº”ï¼Œå‘ŠçŸ¥å…¶ç»“æœï¼ˆä¾‹å¦‚æˆåŠŸæˆ–å¤±è´¥ï¼‰ã€‚\nè¿™ä¸€åˆ‡ä¼¼ä¹å¾ˆç®€å•ã€‚åœ¨ä¸è®¨è®ºåŒæ­¥é˜¶æ®µç®—æ³•çš„ç»†èŠ‚çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬èƒ½ä»è¿™ä¸ªç‰¹å®šçš„é€šä¿¡æ¨¡å¼å®‰æ’ä¸­å¾—å‡ºä»€ä¹ˆç»“è®ºå‘¢ï¼Ÿé¦–å…ˆï¼Œæ³¨æ„è¿™æ˜¯ä¸€ç§ N-å¯¹-N çš„å†™å…¥æ–¹å¼ï¼šåœ¨è¿”å›å“åº”ä¹‹å‰ï¼Œå®ƒå¿…é¡»è¢«ç³»ç»Ÿä¸­çš„æ¯ä¸ªæœåŠ¡å™¨çœ‹åˆ°å¹¶ç¡®è®¤ã€‚\nä»æ€§èƒ½çš„è§’åº¦æ¥çœ‹ï¼Œè¿™æ„å‘³ç€ç³»ç»Ÿçš„é€Ÿåº¦å°†å–å†³äºå…¶ä¸­æœ€æ…¢çš„æœåŠ¡å™¨ã€‚è¯¥ç³»ç»Ÿè¿˜å¯¹ç½‘ç»œå»¶è¿Ÿçš„å˜åŒ–éå¸¸æ•æ„Ÿï¼Œå› ä¸ºå®ƒè¦æ±‚åœ¨ç»§ç»­ä¹‹å‰æ¯ä¸ªæœåŠ¡å™¨éƒ½å¿…é¡»å›å¤ã€‚\nè€ƒè™‘åˆ° N-å¯¹-N çš„æ–¹å¼ï¼Œç³»ç»Ÿæ— æ³•å®¹å¿ä»»ä½•æœåŠ¡å™¨çš„ä¸¢å¤±ã€‚å½“ä¸€ä¸ªæœåŠ¡å™¨ä¸¢å¤±æ—¶ï¼Œç³»ç»Ÿæ— æ³•å†å†™å…¥æ‰€æœ‰èŠ‚ç‚¹ï¼Œå› æ­¤æ— æ³•ç»§ç»­è¿›è¡Œã€‚åœ¨è¿™ç§è®¾è®¡ä¸­ï¼Œå®ƒå¯èƒ½èƒ½å¤Ÿå¯¹æ•°æ®æä¾›åªè¯»è®¿é—®ï¼Œä½†åœ¨èŠ‚ç‚¹æ•…éšœåä¸å…è®¸è¿›è¡Œä¿®æ”¹ã€‚\nè¿™ç§å®‰æ’å¯ä»¥æä¾›éå¸¸å¼ºå¤§çš„è€ä¹…æ€§ä¿è¯ï¼šå½“è¿”å›å“åº”æ—¶ï¼Œå®¢æˆ·ç«¯å¯ä»¥ç¡®ä¿¡æ‰€æœ‰ N ä¸ªæœåŠ¡å™¨éƒ½å·²æ¥æ”¶ã€å­˜å‚¨å’Œç¡®è®¤äº†è¯·æ±‚ã€‚ä¸ºäº†ä¸¢å¤±ä¸€ä¸ªå·²æ¥å—çš„æ›´æ–°ï¼Œæ‰€æœ‰ N ä¸ªå‰¯æœ¬éƒ½éœ€è¦ä¸¢å¤±ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„ä¿è¯ã€‚\nå¼‚æ­¥å¤åˆ¶ è®©æˆ‘ä»¬å°†å…¶ä¸ç¬¬äºŒç§æ¨¡å¼è¿›è¡Œå¯¹æ¯” - å¼‚æ­¥å¤åˆ¶ï¼ˆä¹Ÿç§°ä¸ºè¢«åŠ¨å¤åˆ¶ã€æ‹‰å¼å¤åˆ¶æˆ–æƒ°æ€§å¤åˆ¶ï¼‰ã€‚æ­£å¦‚æ‚¨å¯èƒ½å·²ç»çŒœåˆ°çš„ï¼Œè¿™ä¸åŒæ­¥å¤åˆ¶ç›¸åï¼š\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸»èŠ‚ç‚¹ï¼ˆä¹Ÿç§°ä¸ºé¢†å¯¼è€…æˆ–åè°ƒè€…ï¼‰ç«‹å³å‘å®¢æˆ·ç«¯è¿”å›å“åº”ã€‚å®ƒæœ€å¤šåªä¼šåœ¨æœ¬åœ°å­˜å‚¨æ›´æ–°ï¼Œä½†ä¸ä¼šåŒæ­¥æ‰§è¡Œä»»ä½•é‡è¦å·¥ä½œï¼Œå®¢æˆ·ç«¯ä¹Ÿä¸éœ€è¦ç­‰å¾…æ›´å¤šçš„æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡è½®æ¬¡ã€‚\nåœ¨ç¨åçš„é˜¶æ®µï¼Œå¤åˆ¶ä»»åŠ¡çš„å¼‚æ­¥éƒ¨åˆ†å‘ç”Ÿã€‚åœ¨è¿™é‡Œï¼Œä¸»èŠ‚ç‚¹ä½¿ç”¨æŸç§é€šä¿¡æ¨¡å¼è”ç³»å…¶ä»–æœåŠ¡å™¨ï¼Œå¹¶æ›´æ–°å®ƒä»¬çš„æ•°æ®å‰¯æœ¬ã€‚å…·ä½“çš„å®ç°å–å†³äºæ‰€ä½¿ç”¨çš„ç®—æ³•ã€‚\nåœ¨ä¸æ¶‰åŠç®—æ³•ç»†èŠ‚çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯¹è¿™ç§å…·ä½“çš„å®‰æ’èƒ½å¾—å‡ºä»€ä¹ˆç»“è®ºå‘¢ï¼Ÿå—¯ï¼Œè¿™æ˜¯ä¸€ç§å†™ 1-å¯¹-N çš„æ–¹å¼ï¼šç«‹å³è¿”å›å“åº”ï¼Œæ›´æ–°ä¼ æ’­åœ¨ç¨åå‘ç”Ÿã€‚\nä»æ€§èƒ½çš„è§’åº¦æ¥çœ‹ï¼Œè¿™æ„å‘³ç€ç³»ç»Ÿå¾ˆå¿«ï¼šå®¢æˆ·ç«¯ä¸éœ€è¦é¢å¤–èŠ±è´¹æ—¶é—´ç­‰å¾…ç³»ç»Ÿå†…éƒ¨å®Œæˆå·¥ä½œã€‚ç³»ç»Ÿå¯¹ç½‘ç»œå»¶è¿Ÿæ›´å…·å®¹å¿æ€§ï¼Œå› ä¸ºå†…éƒ¨å»¶è¿Ÿçš„æ³¢åŠ¨ä¸ä¼šå¯¼è‡´å®¢æˆ·ç«¯éœ€è¦é¢å¤–ç­‰å¾…ã€‚\nè¿™ç§å®‰æ’åªèƒ½æä¾›å¼±çš„æˆ–æ¦‚ç‡æ€§çš„è€ä¹…æ€§ä¿è¯ã€‚å¦‚æœæ²¡æœ‰å‡ºç°é—®é¢˜ï¼Œæ•°æ®æœ€ç»ˆä¼šå¤åˆ¶åˆ°æ‰€æœ‰ N å°æœºå™¨ä¸Šã€‚ç„¶è€Œï¼Œå¦‚æœåœ¨æ­¤ä¹‹å‰åŒ…å«æ•°æ®çš„å”¯ä¸€æœåŠ¡å™¨ä¸¢å¤±ï¼Œæ•°æ®å°†æ°¸ä¹…ä¸¢å¤±ã€‚\nè€ƒè™‘åˆ° 1-å¯¹-N çš„æ–¹å¼ï¼Œåªè¦è‡³å°‘æœ‰ä¸€ä¸ªèŠ‚ç‚¹æ­£å¸¸è¿è¡Œï¼Œç³»ç»Ÿå°±å¯ä»¥ä¿æŒå¯ç”¨æ€§ï¼ˆç†è®ºä¸Šè‡³å°‘å¦‚æ­¤ï¼Œä½†å®é™…ä¸Šè´Ÿè½½å¯èƒ½ä¼šå¤ªé«˜ï¼‰ã€‚è¿™ç§çº¯ç²¹çš„æƒ°æ€§æ–¹å¼ä¸æä¾›è€ä¹…æ€§æˆ–ä¸€è‡´æ€§ä¿è¯ï¼›ä½ å¯ä»¥å‘ç³»ç»Ÿå†™å…¥æ•°æ®ï¼Œä½†å¦‚æœå‘ç”Ÿä»»ä½•æ•…éšœï¼Œä¸èƒ½ä¿è¯èƒ½å¤Ÿè¯»å–ä½ æ‰€å†™å…¥çš„å†…å®¹ã€‚\næœ€åå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¢«åŠ¨å¤åˆ¶æ— æ³•ç¡®ä¿ç³»ç»Ÿä¸­çš„æ‰€æœ‰èŠ‚ç‚¹å§‹ç»ˆåŒ…å«ç›¸åŒçš„çŠ¶æ€ã€‚å¦‚æœåœ¨å¤šä¸ªä½ç½®æ¥å—å†™å…¥æ“ä½œï¼Œå¹¶ä¸”ä¸è¦æ±‚è¿™äº›èŠ‚ç‚¹åŒæ­¥ä¸€è‡´ï¼Œé‚£ä¹ˆå°±ä¼šå­˜åœ¨å‘æ•£çš„é£é™©ï¼šä¸åŒä½ç½®çš„è¯»å–å¯èƒ½è¿”å›ä¸åŒçš„ç»“æœï¼ˆç‰¹åˆ«æ˜¯åœ¨èŠ‚ç‚¹æ•…éšœå’Œæ¢å¤åï¼‰ï¼Œå¹¶ä¸”æ— æ³•å¼ºåˆ¶æ‰§è¡Œå…¨å±€çº¦æŸï¼ˆéœ€è¦ä¸æ‰€æœ‰äººé€šä¿¡ï¼‰ã€‚\næˆ‘æ²¡æœ‰è¯¦ç»†è®¨è®ºè¯»å–ï¼ˆè€Œä¸æ˜¯å†™å…¥ï¼‰æ—¶çš„é€šä¿¡æ¨¡å¼ï¼Œå› ä¸ºè¯»å–æ¨¡å¼å®é™…ä¸Šæ˜¯æ ¹æ®å†™å…¥æ¨¡å¼æ¥ç¡®å®šçš„ï¼šåœ¨è¯»å–è¿‡ç¨‹ä¸­ï¼Œä½ å¸Œæœ›ä¸å°½å¯èƒ½å°‘çš„èŠ‚ç‚¹è¿›è¡Œè”ç³»ã€‚æˆ‘ä»¬å°†åœ¨ä»²è£æœºåˆ¶çš„èƒŒæ™¯ä¸‹è¿›ä¸€æ­¥è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚\næˆ‘ä»¬åªè®¨è®ºäº†ä¸¤ç§åŸºæœ¬çš„å®‰æ’ï¼Œå¹¶æ²¡æœ‰æ¶‰åŠå…·ä½“çš„ç®—æ³•ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å·²ç»èƒ½å¤Ÿäº†è§£å¯èƒ½çš„é€šä¿¡æ¨¡å¼ä»¥åŠå®ƒä»¬çš„æ€§èƒ½ã€è€ä¹…æ€§ä¿è¯å’Œå¯ç”¨æ€§ç‰¹æ€§çš„ä¸€äº›ä¿¡æ¯ã€‚\nä¸»è¦å¤åˆ¶æ–¹æ³•æ¦‚è¿° åœ¨è®¨è®ºäº†åŒæ­¥å’Œå¼‚æ­¥å¤åˆ¶è¿™ä¸¤ç§åŸºæœ¬å¤åˆ¶æ–¹æ³•ä¹‹åï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸»è¦çš„å¤åˆ¶ç®—æ³•ã€‚\næœ‰å¾ˆå¤šä¸åŒçš„æ–¹å¼æ¥å¯¹å¤åˆ¶æŠ€æœ¯è¿›è¡Œåˆ†ç±»ã€‚åœ¨åŒæ­¥ä¸å¼‚æ­¥ä¹‹åï¼Œæˆ‘æƒ³å¼•å…¥çš„ç¬¬äºŒä¸ªåŒºåˆ«æ˜¯ï¼š\né˜²æ­¢å‘æ•£çš„å¤åˆ¶æ–¹æ³•ï¼ˆå•å‰¯æœ¬ç³»ç»Ÿï¼‰å’Œ å­˜åœ¨å‘æ•£é£é™©çš„å¤åˆ¶æ–¹æ³•ï¼ˆå¤šä¸»ç³»ç»Ÿï¼‰ ç¬¬ä¸€ç»„æ–¹æ³•å…·æœ‰â€œè¡Œä¸ºåƒå•ä¸€ç³»ç»Ÿâ€çš„ç‰¹æ€§ã€‚ç‰¹åˆ«æ˜¯åœ¨éƒ¨åˆ†æ•…éšœå‘ç”Ÿæ—¶ï¼Œç³»ç»Ÿç¡®ä¿åªæœ‰ä¸€ä¸ªå‰¯æœ¬å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚æ­¤å¤–ï¼Œç³»ç»Ÿç¡®ä¿å‰¯æœ¬å§‹ç»ˆä¿æŒä¸€è‡´ã€‚è¿™è¢«ç§°ä¸ºå…±è¯†é—®é¢˜ã€‚\nå½“å¤šä¸ªè¿›ç¨‹ï¼ˆæˆ–è®¡ç®—æœºï¼‰å°±æŸä¸ªå€¼è¾¾æˆå…±è¯†æ—¶ï¼Œå®ƒä»¬å®ç°äº†å…±è¯†ã€‚æ›´å…·ä½“åœ°è¯´ï¼š\nä¸€è‡´æ€§ï¼šæ¯ä¸ªæ­£ç¡®çš„è¿›ç¨‹å¿…é¡»å°±åŒä¸€ä¸ªå€¼è¾¾æˆä¸€è‡´ã€‚ å®Œæ•´æ€§ï¼šæ¯ä¸ªæ­£ç¡®çš„è¿›ç¨‹æœ€å¤šå†³å®šä¸€ä¸ªå€¼ï¼Œå¹¶ä¸”å¦‚æœå®ƒå†³å®šäº†æŸä¸ªå€¼ï¼Œåˆ™è¯¥å€¼å¿…é¡»ç”±æŸä¸ªè¿›ç¨‹æå‡ºã€‚ ç»ˆæ­¢æ€§ï¼šæ‰€æœ‰è¿›ç¨‹æœ€ç»ˆéƒ½ä¼šè¾¾æˆå†³ç­–ã€‚ æœ‰æ•ˆæ€§ï¼šå¦‚æœæ‰€æœ‰æ­£ç¡®çš„è¿›ç¨‹æè®®ç›¸åŒçš„å€¼ Vï¼Œåˆ™æ‰€æœ‰æ­£ç¡®çš„è¿›ç¨‹éƒ½å†³å®š Vã€‚ äº’æ–¥ã€é¢†å¯¼è€…é€‰ä¸¾ã€ç»„æ’­å’ŒåŸå­å¹¿æ’­éƒ½æ˜¯å…±è¯†é—®é¢˜çš„æ›´ä¸€èˆ¬å®ä¾‹ã€‚ç»´æŠ¤å•ä¸€å‰¯æœ¬ä¸€è‡´æ€§çš„å¤åˆ¶ç³»ç»Ÿéœ€è¦ä»¥æŸç§æ–¹å¼è§£å†³å…±è¯†é—®é¢˜ã€‚ ç»´æŠ¤å•ä¸€å‰¯æœ¬ä¸€è‡´æ€§çš„å¤åˆ¶ç®—æ³•åŒ…æ‹¬ï¼š\n1n æ¶ˆæ¯ï¼ˆå¼‚æ­¥ä¸»/å¤‡ä»½ï¼‰ 2n æ¶ˆæ¯ï¼ˆåŒæ­¥ä¸»/å¤‡ä»½ï¼‰ 4n æ¶ˆæ¯ï¼ˆä¸¤é˜¶æ®µæäº¤ï¼Œå¤š Paxosï¼‰ 6n æ¶ˆæ¯ï¼ˆä¸‰é˜¶æ®µæäº¤ï¼Œå¸¦æœ‰é‡å¤é¢†å¯¼è€…é€‰ä¸¾çš„ Paxosï¼‰ è¿™äº›ç®—æ³•åœ¨å®¹é”™æ€§æ–¹é¢æœ‰æ‰€ä¸åŒï¼ˆä¾‹å¦‚ï¼Œå®ƒä»¬å¯ä»¥å®¹å¿çš„æ•…éšœç±»å‹ï¼‰ã€‚æˆ‘æ ¹æ®ç®—æ³•æ‰§è¡ŒæœŸé—´äº¤æ¢çš„æ¶ˆæ¯æ•°é‡è¿›è¡Œäº†ç®€å•çš„åˆ†ç±»ï¼Œå› ä¸ºæˆ‘è®¤ä¸ºå°è¯•å›ç­”â€œé€šè¿‡å¢åŠ æ¶ˆæ¯äº¤æ¢æˆ‘ä»¬å¾—åˆ°äº†ä»€ä¹ˆï¼Ÿâ€è¿™ä¸ªé—®é¢˜å¾ˆæœ‰è¶£ã€‚\nä¸‹é¢çš„å›¾è¡¨ï¼Œæ”¹ç¼–è‡ª Google çš„ Ryan Barretï¼Œæè¿°äº†ä¸åŒé€‰é¡¹çš„ä¸€äº›æ–¹é¢ï¼š\nä¸Šè¿°å›¾è¡¨ä¸­çš„ä¸€è‡´æ€§ã€å»¶è¿Ÿã€ååé‡ã€æ•°æ®ä¸¢å¤±å’Œæ•…éšœè½¬ç§»ç‰¹æ€§å®é™…ä¸Šå¯ä»¥è¿½æº¯åˆ°ä¸¤ç§ä¸åŒçš„å¤åˆ¶æ–¹æ³•ï¼šåŒæ­¥å¤åˆ¶ï¼ˆä¾‹å¦‚ï¼Œåœ¨å“åº”ä¹‹å‰ç­‰å¾…ï¼‰å’Œå¼‚æ­¥å¤åˆ¶ã€‚å½“æ‚¨ç­‰å¾…æ—¶ï¼Œæ€§èƒ½ä¼šå˜å·®ï¼Œä½†å¯ä»¥è·å¾—æ›´å¼ºçš„ä¿è¯ã€‚åœ¨è®¨è®ºåˆ†åŒºï¼ˆå’Œå»¶è¿Ÿï¼‰å®¹å¿æ€§æ—¶ï¼Œ2PC å’Œä»²è£ç³»ç»Ÿä¹‹é—´çš„ååé‡å·®å¼‚å°†å˜å¾—æ˜æ˜¾ã€‚\nåœ¨è¯¥å›¾è¡¨ä¸­ï¼Œå¼ºåˆ¶å¼±ï¼ˆ/æœ€ç»ˆï¼‰ä¸€è‡´æ€§çš„ç®—æ³•è¢«å½’ç±»ä¸ºä¸€ç±»ï¼ˆ\u0026ldquo;gossip\u0026rdquo;ï¼‰ã€‚ç„¶è€Œï¼Œæˆ‘å°†æ›´è¯¦ç»†åœ°è®¨è®ºå¼±ä¸€è‡´æ€§çš„å¤åˆ¶æ–¹æ³• - gossip å’Œï¼ˆéƒ¨åˆ†ï¼‰ä»²è£ç³»ç»Ÿã€‚\u0026ldquo;äº‹åŠ¡\u0026quot;è¡Œå®é™…ä¸Šæ›´å¤šåœ°æ¶‰åŠå…¨å±€è°“è¯è¯„ä¼°ï¼Œè€Œåœ¨å…·æœ‰å¼±ä¸€è‡´æ€§çš„ç³»ç»Ÿä¸­ä¸æ”¯æŒï¼ˆå°½ç®¡å¯ä»¥æ”¯æŒæœ¬åœ°è°“è¯è¯„ä¼°ï¼‰ã€‚","title":"[è¯‘]ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹4.å¤åˆ¶"},{"content":" ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹æ˜¯ä¸€æœ¬å¹¿å—æ¬¢è¿çš„èµ„æºï¼Œç”¨äºç†è§£å’Œå­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿã€‚è¯¥ä¹¦ç”±ä½œè€… Mikito Takada æ’°å†™ï¼Œä»‹ç»äº†æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºæœ¬æ¦‚å¿µã€åŸåˆ™å’ŒæŒ‘æˆ˜ã€‚\nè¿™æœ¬ä¹¦æ¶µç›–äº†ä¸åˆ†å¸ƒå¼ç³»ç»Ÿç›¸å…³çš„å¹¿æ³›ä¸»é¢˜ï¼ŒåŒ…æ‹¬ç½‘ç»œã€å®¹é”™æ€§ã€ä¸€è‡´æ€§æ¨¡å‹ã€åˆ†å¸ƒå¼ç®—æ³•ã€å¯æ‰©å±•æ€§ç­‰ç­‰ã€‚å®ƒæ—¨åœ¨ä»¥æ¸…æ™°æ˜“æ‡‚çš„æ–¹å¼è§£é‡Šå¤æ‚çš„æ¦‚å¿µï¼Œé€‚åˆåˆå­¦è€…å’Œæœ‰ç»éªŒçš„åˆ†å¸ƒå¼ç³»ç»Ÿä»ä¸šè€…é˜…è¯»ã€‚\nåœ¨æ•´æœ¬ä¹¦ä¸­ï¼Œä½œè€…æä¾›äº†å„ç§å®é™…æ¡ˆä¾‹å’Œæ¡ˆä¾‹ç ”ç©¶ï¼Œä»¥è¯´æ˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®é™…åº”ç”¨å’Œå®è·µæ–¹é¢ã€‚å®ƒè¿˜å¼ºè°ƒäº†æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿæ¶‰åŠçš„æƒè¡¡å’Œè®¾è®¡è€ƒè™‘ï¼Œå¸®åŠ©è¯»è€…å…¨é¢ç†è§£è¿™ä¸ªä¸»é¢˜ã€‚\nã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹ä½œä¸ºå¼€æºèµ„æºï¼Œå¯ä»¥å…è´¹åœ¨çº¿è·å–ï¼Œéå¸¸é€‚åˆä»»ä½•å¯¹å­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿæ„Ÿå…´è¶£çš„äººã€‚\nåŸæ–‡é“¾æ¥ï¼šDistributed systems: for fun and profit\n3. æ—¶é—´åŠé¡ºåº ä»€ä¹ˆæ˜¯é¡ºåºï¼Œä¸ºä»€ä¹ˆå®ƒå¾ˆé‡è¦ï¼Ÿ\nä½ è¯´çš„â€œä»€ä¹ˆæ˜¯é¡ºåºâ€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ\næˆ‘çš„æ„æ€æ˜¯ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬å¯¹é¡ºåºå¦‚æ­¤ç€è¿·ï¼Ÿä¸ºä»€ä¹ˆæˆ‘ä»¬å…³å¿ƒ A æ˜¯å¦å‘ç”Ÿåœ¨ B ä¹‹å‰ï¼Ÿä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸å…³å¿ƒå…¶ä»–å±æ€§ï¼Œæ¯”å¦‚â€œé¢œè‰²â€ï¼Ÿ\nå¥½å§ï¼Œæˆ‘çš„ç–¯ç‹‚æœ‹å‹ï¼Œè®©æˆ‘ä»¬å›åˆ°åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®šä¹‰æ¥å›ç­”è¿™ä¸ªé—®é¢˜ã€‚\nä½ å¯èƒ½è¿˜è®°å¾—ï¼Œæˆ‘å°†åˆ†å¸ƒå¼ç¼–ç¨‹æè¿°ä¸ºä½¿ç”¨å¤šå°è®¡ç®—æœºè§£å†³å•å°è®¡ç®—æœºå¯ä»¥è§£å†³çš„åŒä¸€ä¸ªé—®é¢˜çš„è‰ºæœ¯ã€‚\näº‹å®ä¸Šï¼Œè¿™æ­£æ˜¯å¯¹é¡ºåºå¦‚æ­¤ç€è¿·çš„æ ¸å¿ƒæ‰€åœ¨ã€‚ä»»ä½•åªèƒ½ä¸€æ¬¡æ‰§è¡Œä¸€é¡¹ä»»åŠ¡çš„ç³»ç»Ÿéƒ½ä¼šåˆ›å»ºæ“ä½œçš„æ€»ä½“é¡ºåºã€‚å°±åƒäººä»¬é€šè¿‡ä¸€æ‰‡é—¨ä¸€æ ·ï¼Œæ¯ä¸ªæ“ä½œéƒ½æœ‰æ˜ç¡®å®šä¹‰çš„å‰ä»»å’Œåç»§ã€‚è¿™åŸºæœ¬ä¸Šæ˜¯æˆ‘ä»¬åŠªåŠ›ä¿ç•™çš„ç¼–ç¨‹æ¨¡å‹ã€‚\nä¼ ç»Ÿçš„æ¨¡å‹æ˜¯ï¼šä¸€ä¸ªç¨‹åºï¼Œä¸€ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªåœ¨ä¸€ä¸ª CPU ä¸Šè¿è¡Œçš„å†…å­˜ç©ºé—´ã€‚æ“ä½œç³»ç»ŸæŠ½è±¡äº†å¯èƒ½å­˜åœ¨å¤šä¸ª CPU å’Œå¤šä¸ªç¨‹åºçš„äº‹å®ï¼Œä»¥åŠè®¡ç®—æœºå†…å­˜å®é™…ä¸Šæ˜¯å¤šä¸ªç¨‹åºå…±äº«çš„ã€‚æˆ‘å¹¶ä¸æ˜¯è¯´çº¿ç¨‹ç¼–ç¨‹å’Œäº‹ä»¶é©±åŠ¨ç¼–ç¨‹ä¸å­˜åœ¨ï¼›åªæ˜¯å®ƒä»¬æ˜¯â€œä¸€ä¸ª/ä¸€ä¸ª/ä¸€ä¸ªâ€æ¨¡å‹ä¹‹ä¸Šçš„ç‰¹æ®ŠæŠ½è±¡ã€‚ç¨‹åºè¢«ç¼–å†™æˆæŒ‰ç…§ä¸€å®šé¡ºåºæ‰§è¡Œï¼šä»ä¸Šå¾€ä¸‹æ‰§è¡Œã€‚\né¡ºåºä½œä¸ºä¸€ç§å±æ€§å—åˆ°äº†å¦‚æ­¤å¤šçš„å…³æ³¨ï¼Œæ˜¯å› ä¸ºå®šä¹‰â€œæ­£ç¡®æ€§â€çš„æœ€ç®€å•æ–¹æ³•æ˜¯è¯´â€œå®ƒçš„å·¥ä½œæ–¹å¼ä¸å•å°è®¡ç®—æœºä¸Šçš„å·¥ä½œæ–¹å¼ç›¸åŒâ€ã€‚è€Œé€šå¸¸è¿™æ„å‘³ç€ aï¼‰æˆ‘ä»¬è¿è¡Œç›¸åŒçš„æ“ä½œï¼Œbï¼‰æˆ‘ä»¬æŒ‰ç…§ç›¸åŒçš„é¡ºåºè¿è¡Œå®ƒä»¬ - å³ä½¿æœ‰å¤šå°è®¡ç®—æœºã€‚\nä¿æŒé¡ºåºï¼ˆå¦‚å•ä¸ªç³»ç»Ÿå®šä¹‰çš„é¡ºåºï¼‰çš„åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¼˜ç‚¹åœ¨äºå®ƒä»¬æ˜¯é€šç”¨çš„ã€‚ä½ ä¸éœ€è¦å…³å¿ƒæ“ä½œæ˜¯ä»€ä¹ˆï¼Œå› ä¸ºå®ƒä»¬å°†ä¸åœ¨å•å°è®¡ç®—æœºä¸Šå®Œå…¨ç›¸åŒçš„æ–¹å¼æ‰§è¡Œã€‚è¿™å¾ˆæ£’ï¼Œå› ä¸ºä½ çŸ¥é“æ— è®ºæ“ä½œæ˜¯ä»€ä¹ˆï¼Œä½ éƒ½å¯ä»¥ä½¿ç”¨ç›¸åŒçš„ç³»ç»Ÿã€‚\nå®é™…ä¸Šï¼Œåˆ†å¸ƒå¼ç¨‹åºåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œå…·æœ‰å¤šä¸ª CPU å’Œå¤šä¸ªæ“ä½œæµã€‚ä½ ä»ç„¶å¯ä»¥åˆ†é…ä¸€ä¸ªæ€»ä½“é¡ºåºï¼Œä½†è¿™éœ€è¦å‡†ç¡®çš„æ—¶é’Ÿæˆ–æŸç§å½¢å¼çš„é€šä¿¡ã€‚ä½ å¯ä»¥ä½¿ç”¨å®Œå…¨å‡†ç¡®çš„æ—¶é’Ÿä¸ºæ¯ä¸ªæ“ä½œæ ‡è®°æ—¶é—´æˆ³ï¼Œç„¶ååˆ©ç”¨å®ƒæ¥ç¡®å®šæ€»ä½“é¡ºåºã€‚æˆ–è€…ä½ å¯ä»¥ä½¿ç”¨æŸç§é€šä¿¡ç³»ç»Ÿï¼Œä½¿å¾—å¯ä»¥åˆ†é…ç±»ä¼¼æ€»ä½“é¡ºåºçš„è¿ç»­ç¼–å·ã€‚\nå…¨åºå’Œååº åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œè‡ªç„¶çŠ¶æ€æ˜¯ååºã€‚ç½‘ç»œå’Œç‹¬ç«‹èŠ‚ç‚¹éƒ½ä¸å¯¹ç›¸å¯¹é¡ºåºåšå‡ºä»»ä½•ä¿è¯ï¼Œä½†åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼Œä½ å¯ä»¥è§‚å¯Ÿåˆ°ä¸€ä¸ªå±€éƒ¨é¡ºåºã€‚\næ€»åºæ˜¯ä¸€ç§äºŒå…ƒå…³ç³»ï¼Œå®ƒä¸ºæŸä¸ªé›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ å®šä¹‰äº†ä¸€ä¸ªé¡ºåºã€‚\nå½“ä¸¤ä¸ªä¸åŒçš„å…ƒç´ å¯æ¯”è¾ƒæ—¶ï¼Œå…¶ä¸­ä¸€ä¸ªå¤§äºå¦ä¸€ä¸ªã€‚åœ¨ååºé›†ä¸­ï¼ŒæŸäº›å…ƒç´ å¯¹ä¸å¯æ¯”è¾ƒï¼Œå› æ­¤ååºå¹¶ä¸æŒ‡å®šæ¯ä¸ªé¡¹ç›®çš„ç¡®åˆ‡é¡ºåºã€‚\næ€»åºå’Œååºéƒ½æ˜¯ä¼ é€’æ€§å’Œåå¯¹ç§°æ€§çš„ã€‚å¯¹äºé›†åˆ X ä¸­çš„æ‰€æœ‰ aã€b å’Œ cï¼Œä»¥ä¸‹é™ˆè¿°åœ¨æ€»åºå’Œååºä¸­éƒ½æˆç«‹ï¼š\nIf a â‰¤ b and b â‰¤ a then a = b (antisymmetry); If a â‰¤ b and b â‰¤ c then a â‰¤ c (transitivity); ç„¶è€Œï¼Œæ€»åºæ˜¯å®Œå…¨çš„ï¼š\na â‰¤ b or b â‰¤ a (totality) for all a, b in X è€Œååºæ˜¯è‡ªåçš„ï¼š\na â‰¤ a (reflexivity) for all a in X æ³¨æ„ï¼Œå…¨åºæ€§è•´å«è‡ªåæ€§ï¼›å› æ­¤ï¼Œååºæ˜¯æ€»åºçš„ä¸€ç§è¾ƒå¼±çš„å˜ä½“ã€‚åœ¨ååºä¸­çš„æŸäº›å…ƒç´ ä¸Šï¼Œå…¨åºæ€§ä¸æˆç«‹ - æ¢å¥è¯è¯´ï¼Œå…¶ä¸­ä¸€äº›å…ƒç´ ä¸å¯æ¯”è¾ƒã€‚\nGit åˆ†æ”¯æ˜¯ååºçš„ä¸€ä¸ªä¾‹å­ã€‚æ­£å¦‚ä½ å¯èƒ½çŸ¥é“çš„ï¼ŒGit ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿå…è®¸ä½ ä»å•ä¸ªåŸºç¡€åˆ†æ”¯ï¼ˆä¾‹å¦‚ä¸»åˆ†æ”¯ï¼‰åˆ›å»ºå¤šä¸ªåˆ†æ”¯ã€‚æ¯ä¸ªåˆ†æ”¯è¡¨ç¤ºåŸºäºå…±åŒç¥–å…ˆçš„æºä»£ç æ›´æ”¹å†å²ï¼š\n[ branch A (1,2,0)] [ master (3,0,0) ] [ branch B (1,0,2) ] [ branch A (1,1,0)] [ master (2,0,0) ] [ branch B (1,0,1) ] \\ [ master (1,0,0) ] / åˆ†æ”¯ A å’Œåˆ†æ”¯ B æ˜¯ä»ä¸€ä¸ªå…±åŒçš„ç¥–å…ˆæ´¾ç”Ÿå‡ºæ¥çš„ï¼Œä½†å®ƒä»¬ä¹‹é—´æ²¡æœ‰ç¡®å®šçš„é¡ºåºï¼šå®ƒä»¬ä»£è¡¨ä¸åŒçš„å†å²ï¼Œä¸èƒ½ç®€åŒ–ä¸ºå•ä¸€çš„çº¿æ€§å†å²è€Œä¸ç»è¿‡é¢å¤–çš„å·¥ä½œï¼ˆåˆå¹¶ï¼‰ã€‚å½“ç„¶ï¼Œä½ å¯ä»¥æŒ‰æŸç§ä»»æ„é¡ºåºæ”¾ç½®æ‰€æœ‰æäº¤ï¼ˆä¾‹å¦‚ï¼Œé¦–å…ˆæŒ‰ç¥–å…ˆæ’åºï¼Œç„¶åæŒ‰ç…§ A åœ¨ B ä¹‹å‰æˆ– B åœ¨ A ä¹‹å‰çš„é¡ºåºæ’åºï¼‰ï¼Œä½†è¿™ä¼šé€šè¿‡å¼ºåˆ¶å­˜åœ¨ä¸å­˜åœ¨çš„æ€»åºæ¥ä¸¢å¤±ä¿¡æ¯ã€‚\nåœ¨ç”±ä¸€ä¸ªèŠ‚ç‚¹ç»„æˆçš„ç³»ç»Ÿä¸­ï¼Œæ€»åºæ˜¯å¿…ç„¶äº§ç”Ÿçš„ï¼šæŒ‡ä»¤åœ¨å•ä¸ªç¨‹åºä¸­ä»¥ç‰¹å®šçš„å¯è§‚å¯Ÿé¡ºåºæ‰§è¡Œï¼Œæ¶ˆæ¯ä»¥ç‰¹å®šçš„é¡ºåºå¤„ç†ã€‚æˆ‘ä»¬å·²ç»ä¾èµ–äºè¿™ä¸ªæ€»åº - å®ƒä½¿ç¨‹åºçš„æ‰§è¡Œå¯é¢„æµ‹ã€‚åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¯ä»¥ç»´æŠ¤è¿™ç§é¡ºåºï¼Œä½†ä»£ä»·å¾ˆå¤§ï¼šé€šä¿¡æ˜¯æ˜‚è´µçš„ï¼Œæ—¶é—´åŒæ­¥æ˜¯å›°éš¾ä¸”è„†å¼±çš„ã€‚\næ—¶é—´æ˜¯ä»€ä¹ˆï¼Ÿ æ—¶é—´æ˜¯ä¸€ç§ç§©åºçš„æ¥æºï¼Œå®ƒå…è®¸æˆ‘ä»¬å®šä¹‰æ“ä½œçš„é¡ºåºï¼Œè€Œè¿™ä¸ªé¡ºåºä¹Ÿæœ‰äººä»¬å¯ä»¥ç†è§£çš„è§£é‡Šï¼ˆç§’ã€åˆ†é’Ÿã€å¤©ç­‰ï¼‰ã€‚\nä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œæ—¶é—´å°±åƒä»»ä½•å…¶ä»–æ•´æ•°è®¡æ•°å™¨ä¸€æ ·ã€‚å®ƒåªæ˜¯å› ä¸ºå¤ªé‡è¦ï¼Œä»¥è‡³äºå¤§å¤šæ•°è®¡ç®—æœºéƒ½æœ‰ä¸€ä¸ªä¸“ç”¨çš„æ—¶é—´ä¼ æ„Ÿå™¨ï¼Œä¹Ÿç§°ä¸ºæ—¶é’Ÿã€‚å®ƒéå¸¸é‡è¦ï¼Œä»¥è‡³äºæˆ‘ä»¬å·²ç»æ‰¾å‡ºäº†å¦‚ä½•ä½¿ç”¨ä¸€äº›ä¸å®Œå–„çš„ç‰©ç†ç³»ç»Ÿï¼ˆä»èœ¡çƒ›åˆ°é“¯åŸå­ï¼‰åˆæˆåŒä¸€ä¸ªè®¡æ•°å™¨çš„è¿‘ä¼¼å€¼ã€‚æˆ‘æ‰€è¯´çš„â€œåˆæˆâ€ï¼Œæ˜¯æŒ‡æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸäº›ç‰©ç†å±æ€§åœ¨ç‰©ç†ä¸Šç›¸è·è¾ƒè¿œçš„åœ°æ–¹è¿‘ä¼¼è®¡ç®—æ•´æ•°è®¡æ•°å™¨çš„å€¼ï¼Œè€Œä¸éœ€è¦ç›´æ¥è¿›è¡Œé€šä¿¡ã€‚\næ—¶é—´æˆ³å®é™…ä¸Šæ˜¯ä¸€ä¸ªç®€å†™å€¼ï¼Œç”¨äºè¡¨ç¤ºä»å®‡å®™èµ·æºåˆ°å½“å‰æ—¶åˆ»çš„ä¸–ç•ŒçŠ¶æ€ - å¦‚æœæŸä¸ªäº‹ç‰©å‘ç”Ÿåœ¨ç‰¹å®šçš„æ—¶é—´æˆ³ä¸Šï¼Œé‚£ä¹ˆå®ƒå¯èƒ½å—åˆ°ä¹‹å‰å‘ç”Ÿçš„ä¸€åˆ‡äº‹ç‰©çš„å½±å“ã€‚è¿™ä¸ªæƒ³æ³•å¯ä»¥æ¨å¹¿ä¸ºä¸€ä¸ªå› æœæ—¶é’Ÿï¼Œå®ƒæ˜ç¡®è·Ÿè¸ªåŸå› ï¼ˆä¾èµ–å…³ç³»ï¼‰ï¼Œè€Œä¸ä»…ä»…å‡è®¾å‰ä¸€ä¸ªæ—¶é—´æˆ³ä¹‹å‰çš„ä¸€åˆ‡éƒ½æ˜¯ç›¸å…³çš„ã€‚å½“ç„¶ï¼Œé€šå¸¸çš„å‡è®¾æ˜¯æˆ‘ä»¬åªå…³å¿ƒç‰¹å®šç³»ç»Ÿçš„çŠ¶æ€ï¼Œè€Œä¸æ˜¯æ•´ä¸ªä¸–ç•Œã€‚\nå‡è®¾æ—¶é—´åœ¨ä»»ä½•åœ°æ–¹ä»¥ç›¸åŒçš„é€Ÿåº¦æµé€ - è¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„å‡è®¾ï¼Œæˆ‘ä¸€ä¼šå„¿ä¼šå›åˆ°è¿™ä¸ªé—®é¢˜ä¸Š - æ—¶é—´å’Œæ—¶é—´æˆ³åœ¨ç¨‹åºä¸­ä½¿ç”¨æ—¶æœ‰å‡ ç§æœ‰ç”¨çš„è§£é‡Šã€‚è¿™ä¸‰ç§è§£é‡Šåˆ†åˆ«æ˜¯ï¼š\né¡ºåº\næŒç»­æ—¶é—´\nè§£é‡Š\né¡ºåºã€‚å½“æˆ‘è¯´æ—¶é—´æ˜¯ç§©åºçš„æ¥æºæ—¶ï¼Œæˆ‘çš„æ„æ€æ˜¯ï¼š\næˆ‘ä»¬å¯ä»¥å°†æ—¶é—´æˆ³é™„åŠ åˆ°æ— åºäº‹ä»¶ä¸Šä»¥å¯¹å®ƒä»¬è¿›è¡Œæ’åºã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ—¶é—´æˆ³æ¥å¼ºåˆ¶æ‰§è¡Œæ“ä½œçš„ç‰¹å®šé¡ºåºæˆ–æ¶ˆæ¯çš„ä¼ é€’ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœæ“ä½œåˆ°è¾¾çš„é¡ºåºé”™è¯¯ï¼Œåˆ™å»¶è¿Ÿè¯¥æ“ä½œï¼‰ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ—¶é—´æˆ³çš„å€¼æ¥ç¡®å®šæŸä»¶äº‹åœ¨æ—¶é—´ä¸Šæ˜¯å¦å‘ç”Ÿåœ¨å¦ä¸€ä»¶äº‹ä¹‹å‰ã€‚ è§£é‡Š - æ—¶é—´ä½œä¸ºå¯æ™®éæ¯”è¾ƒçš„å€¼ã€‚æ—¶é—´æˆ³çš„ç»å¯¹å€¼å¯ä»¥è§£é‡Šä¸ºæ—¥æœŸï¼Œå¯¹äººç±»æ¥è¯´å¾ˆæœ‰ç”¨ã€‚é€šè¿‡æ—¥å¿—æ–‡ä»¶ä¸­åœæœºå¼€å§‹çš„æ—¶é—´æˆ³ï¼Œä½ å¯ä»¥çŸ¥é“é‚£æ˜¯ä¸Šä¸ªæ˜ŸæœŸå…­ï¼Œå½“æ—¶æœ‰ä¸€åœºé›·æš´ã€‚\næŒç»­æ—¶é—´ - ä»¥æ—¶é—´ä¸ºå•ä½æµ‹é‡çš„æŒç»­æ—¶é—´ä¸ç°å®ä¸–ç•Œæœ‰ä¸€å®šçš„å…³ç³»ã€‚ç®—æ³•é€šå¸¸ä¸å…³å¿ƒæ—¶é’Ÿçš„ç»å¯¹å€¼æˆ–å…¶ä½œä¸ºæ—¥æœŸçš„è§£é‡Šï¼Œä½†å®ƒä»¬å¯èƒ½ä½¿ç”¨æŒç»­æ—¶é—´è¿›è¡ŒæŸäº›åˆ¤æ–­ã€‚ç‰¹åˆ«æ˜¯ï¼Œç­‰å¾…çš„æ—¶é—´é•¿åº¦å¯ä»¥æä¾›æœ‰å…³ç³»ç»Ÿæ˜¯å¦åˆ†åŒºæˆ–ä»…é‡åˆ°é«˜å»¶è¿Ÿçš„çº¿ç´¢ã€‚\nç”±äºåˆ†å¸ƒå¼ç³»ç»Ÿçš„ç‰¹æ€§ï¼Œå…¶ç»„ä»¶çš„è¡Œä¸ºå¹¶ä¸å¯é¢„æµ‹ã€‚å®ƒä»¬ä¸ä¿è¯ä»»ä½•ç‰¹å®šçš„é¡ºåºã€å‰è¿›é€Ÿåº¦æˆ–æ— å»¶è¿Ÿã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€äº›å±€éƒ¨é¡ºåº - å› ä¸ºæ‰§è¡Œæ˜¯ï¼ˆå¤§è‡´ä¸Šï¼‰é¡ºåºæ‰§è¡Œçš„ - ä½†è¿™äº›å±€éƒ¨é¡ºåºå½¼æ­¤ç‹¬ç«‹ã€‚\nå¼ºåŠ ï¼ˆæˆ–å‡è®¾ï¼‰é¡ºåºæ˜¯å‡å°‘å¯èƒ½æ‰§è¡Œå’Œå¯èƒ½å‘ç”Ÿæƒ…å†µç©ºé—´çš„ä¸€ç§æ–¹å¼ã€‚å½“äº‹ç‰©å¯ä»¥ä»¥ä»»ä½•é¡ºåºå‘ç”Ÿæ—¶ï¼Œäººä»¬å¾ˆéš¾æ¨ç†äº‹ç‰© - è¦è€ƒè™‘çš„æ’åˆ—ç»„åˆå¤ªå¤šäº†ã€‚\næ—¶é—´åœ¨ä»»ä½•åœ°æ–¹éƒ½ä»¥ç›¸åŒçš„é€Ÿåº¦å‰è¿›å—ï¼Ÿ æˆ‘ä»¬æ¯ä¸ªäººéƒ½æ ¹æ®è‡ªå·±çš„ä¸ªäººç»éªŒå¯¹æ—¶é—´æœ‰ä¸€ç§ç›´è§‚çš„æ¦‚å¿µã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™ç§ç›´è§‚çš„æ—¶é—´è§‚å¿µæ›´å®¹æ˜“æƒ³è±¡å‡ºå®Œå…¨é¡ºåºè€Œä¸æ˜¯éƒ¨åˆ†é¡ºåºã€‚æˆ‘ä»¬æ›´å®¹æ˜“æƒ³è±¡äº‹ç‰©ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°å‘ç”Ÿçš„é¡ºåºï¼Œè€Œä¸æ˜¯åŒæ—¶å‘ç”Ÿã€‚å¯¹äºæ¶ˆæ¯çš„å•ä¸€é¡ºåºè¿›è¡Œæ¨ç†æ¯”æ¨ç†ä»¥ä¸åŒé¡ºåºå’Œä¸åŒå»¶è¿Ÿåˆ°è¾¾çš„æ¶ˆæ¯æ›´å®¹æ˜“ã€‚\nç„¶è€Œï¼Œåœ¨å®æ–½åˆ†å¸ƒå¼ç³»ç»Ÿæ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›é¿å…å¯¹æ—¶é—´å’Œé¡ºåºåšå‡ºå¼ºçƒˆçš„å‡è®¾ï¼Œå› ä¸ºå‡è®¾è¶Šå¼ºï¼Œç³»ç»Ÿå¯¹äºâ€œæ—¶é—´ä¼ æ„Ÿå™¨â€æˆ–å†…éƒ¨æ—¶é’Ÿçš„é—®é¢˜å°±è¶Šè„†å¼±ã€‚æ­¤å¤–ï¼Œå¼ºåŠ ä¸€ç§é¡ºåºæ˜¯æœ‰ä»£ä»·çš„ã€‚æˆ‘ä»¬èƒ½å¤Ÿå®¹å¿çš„æ—¶é—´éç¡®å®šæ€§è¶Šå¤šï¼Œå°±è¶Šèƒ½å……åˆ†åˆ©ç”¨åˆ†å¸ƒå¼è®¡ç®—çš„ä¼˜åŠ¿ã€‚\nå¯¹äºâ€œæ—¶é—´æ˜¯å¦åœ¨ä»»ä½•åœ°æ–¹ä»¥ç›¸åŒçš„é€Ÿç‡æµé€â€çš„é—®é¢˜ï¼Œæœ‰ä¸‰ç§å¸¸è§çš„å›ç­”ã€‚å®ƒä»¬åˆ†åˆ«æ˜¯ï¼š\nâ€œå…¨å±€æ—¶é’Ÿâ€ï¼šæ˜¯çš„ â€œæœ¬åœ°æ—¶é’Ÿâ€ï¼šä¸æ˜¯ï¼Œä½†æ˜¯ â€œæ— æ—¶é’Ÿâ€ï¼šä¸æ˜¯ï¼ è¿™äº›å¤§è‡´å¯¹åº”äºæˆ‘åœ¨ç¬¬äºŒç« ä¸­æåˆ°çš„ä¸‰ç§æ—¶é—´å‡è®¾ï¼šåŒæ­¥ç³»ç»Ÿæ¨¡å‹å…·æœ‰å…¨å±€æ—¶é’Ÿï¼Œéƒ¨åˆ†åŒæ­¥æ¨¡å‹å…·æœ‰æœ¬åœ°æ—¶é’Ÿï¼Œåœ¨å¼‚æ­¥ç³»ç»Ÿæ¨¡å‹ä¸­æ ¹æœ¬ä¸èƒ½ä½¿ç”¨æ—¶é’Ÿã€‚è®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°çœ‹çœ‹è¿™äº›ã€‚\nå…·æœ‰â€œå…¨çƒæ—¶é’Ÿâ€å‡è®¾çš„æ—¶é—´ å…¨çƒæ—¶é’Ÿå‡è®¾æ˜¯å­˜åœ¨ä¸€ä¸ªå®Œå…¨ç²¾ç¡®çš„å…¨çƒæ—¶é’Ÿï¼Œå¹¶ä¸”æ¯ä¸ªäººéƒ½å¯ä»¥ä½¿ç”¨è¯¥æ—¶é’Ÿã€‚è¿™å°±æ˜¯æˆ‘ä»¬æ€è€ƒæ—¶é—´çš„æ–¹å¼ï¼Œå› ä¸ºåœ¨äººç±»äº’åŠ¨ä¸­ï¼Œæ—¶é—´ä¸Šçš„å¾®å°å·®å¼‚å¹¶ä¸é‡è¦ã€‚\nå…¨å±€æ—¶é’ŸåŸºæœ¬ä¸Šæ˜¯æ€»åºçš„æ¥æºï¼ˆå³ä½¿è¿™äº›èŠ‚ç‚¹ä»æœªè¿›è¡Œè¿‡é€šä¿¡ï¼Œä¹Ÿèƒ½ç²¾ç¡®ç¡®å®šæ‰€æœ‰èŠ‚ç‚¹ä¸Šæ¯ä¸ªæ“ä½œçš„é¡ºåºï¼‰ã€‚\nç„¶è€Œï¼Œè¿™æ˜¯å¯¹ä¸–ç•Œçš„ç†æƒ³åŒ–è§‚ç‚¹ï¼šå®é™…ä¸Šï¼Œæ—¶é’ŸåŒæ­¥åªèƒ½ä»¥æœ‰é™çš„ç²¾åº¦è¿›è¡Œã€‚è¿™å—é™äºå•†å“è®¡ç®—æœºæ—¶é’Ÿçš„å‡†ç¡®æ€§ä¸è¶³ï¼Œå—é™äºä½¿ç”¨è¯¸å¦‚ NTP çš„æ—¶é’ŸåŒæ­¥åè®®æ—¶çš„å»¶è¿Ÿï¼Œä»¥åŠåŸºæœ¬ä¸Šå—é™äºæ—¶ç©ºçš„æœ¬è´¨ã€‚\nå‡è®¾åˆ†å¸ƒå¼èŠ‚ç‚¹ä¸Šçš„æ—¶é’Ÿå®Œå…¨åŒæ­¥æ„å‘³ç€å‡è®¾æ—¶é’Ÿä»ç›¸åŒçš„å€¼å¼€å§‹ï¼Œæ°¸è¿œä¸ä¼šæ¼‚ç§»ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å‡è®¾ï¼Œå› ä¸ºä½ å¯ä»¥è‡ªç”±ä½¿ç”¨æ—¶é—´æˆ³æ¥ç¡®å®šå…¨å±€æ€»åº - ä»¥æ—¶é’Ÿæ¼‚ç§»ä¸ºç•Œé™ï¼Œè€Œä¸æ˜¯å»¶è¿Ÿ - ä½†è¿™æ˜¯ä¸€ä¸ªéå¹³å‡¡çš„æ“ä½œæŒ‘æˆ˜å’Œæ½œåœ¨çš„å¼‚å¸¸æºã€‚å­˜åœ¨è®¸å¤šä¸åŒçš„æƒ…å†µï¼Œå…¶ä¸­ç®€å•çš„æ•…éšœ - æ¯”å¦‚ç”¨æˆ·æ„å¤–æ›´æ”¹æœºå™¨ä¸Šçš„æœ¬åœ°æ—¶é—´ï¼Œæˆ–è€…è¿‡æ—¶çš„æœºå™¨åŠ å…¥é›†ç¾¤ï¼Œæˆ–è€…åŒæ­¥çš„æ—¶é’Ÿä»¥ç¨å¾®ä¸åŒçš„é€Ÿç‡æ¼‚ç§»ç­‰ç­‰ - å¯èƒ½ä¼šå¯¼è‡´éš¾ä»¥è¿½è¸ªçš„å¼‚å¸¸ã€‚\nå°½ç®¡å¦‚æ­¤ï¼Œæœ‰ä¸€äº›ç°å®ä¸–ç•Œçš„ç³»ç»Ÿåšå‡ºäº†è¿™ç§å‡è®¾ã€‚Facebook çš„ Cassandra å°±æ˜¯ä¸€ä¸ªå‡è®¾æ—¶é’ŸåŒæ­¥çš„ç³»ç»Ÿç¤ºä¾‹ã€‚å®ƒä½¿ç”¨æ—¶é—´æˆ³æ¥è§£å†³å†™å…¥å†²çª - å…·æœ‰è¾ƒæ–°æ—¶é—´æˆ³çš„å†™å…¥æ“ä½œè·èƒœã€‚è¿™æ„å‘³ç€å¦‚æœæ—¶é’Ÿæ¼‚ç§»ï¼Œæ–°æ•°æ®å¯èƒ½ä¼šè¢«æ—§æ•°æ®å¿½ç•¥æˆ–è¦†ç›–ï¼›åŒæ ·ï¼Œè¿™æ˜¯ä¸€ä¸ªæ“ä½œä¸Šçš„æŒ‘æˆ˜ï¼ˆæ®æˆ‘æ‰€å¬è¯´çš„ï¼Œäººä»¬å¯¹æ­¤éå¸¸æ¸…æ¥šï¼‰ã€‚å¦ä¸€ä¸ªæœ‰è¶£çš„ä¾‹å­æ˜¯ Google çš„ Spannerï¼šè¯¥è®ºæ–‡æè¿°äº†ä»–ä»¬çš„ TrueTime APIï¼Œå®ƒåŒæ­¥æ—¶é—´ä½†ä¹Ÿä¼°è®¡æœ€åæƒ…å†µä¸‹çš„æ—¶é’Ÿæ¼‚ç§»ã€‚\nâ€œæœ¬åœ°æ—¶é’Ÿâ€å‡è®¾çš„æ—¶é—´ ç¬¬äºŒä¸ªä¹Ÿè®¸æ›´åˆç†çš„å‡è®¾æ˜¯æ¯å°æœºå™¨éƒ½æœ‰è‡ªå·±çš„æ—¶é’Ÿï¼Œä½†æ²¡æœ‰å…¨å±€æ—¶é’Ÿã€‚è¿™æ„å‘³ç€æ‚¨æ— æ³•ä½¿ç”¨æœ¬åœ°æ—¶é’Ÿæ¥ç¡®å®šè¿œç¨‹æ—¶é—´æˆ³æ˜¯å‘ç”Ÿåœ¨æœ¬åœ°æ—¶é—´æˆ³ä¹‹å‰è¿˜æ˜¯ä¹‹åï¼›æ¢å¥è¯è¯´ï¼Œæ‚¨æ— æ³•æœ‰æ„ä¹‰åœ°æ¯”è¾ƒä¸¤å°ä¸åŒæœºå™¨çš„æ—¶é—´æˆ³ã€‚\næœ¬åœ°æ—¶é’Ÿå‡è®¾æ›´æ¥è¿‘äºç°å®ä¸–ç•Œã€‚å®ƒå»ºç«‹äº†ä¸€ä¸ªéƒ¨åˆ†é¡ºåºï¼šæ¯ä¸ªç³»ç»Ÿä¸Šçš„äº‹ä»¶è¢«æ’åºï¼Œä½†é€šè¿‡ä»…ä½¿ç”¨æ—¶é’Ÿæ— æ³•å¯¹è·¨ç³»ç»Ÿçš„äº‹ä»¶è¿›è¡Œæ’åºã€‚\nç„¶è€Œï¼Œåœ¨å•ä¸ªæœºå™¨ä¸Šï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ—¶é—´æˆ³å¯¹äº‹ä»¶è¿›è¡Œæ’åºï¼›åªè¦å°å¿ƒä¸å…è®¸æ—¶é’Ÿè·³åŠ¨ï¼Œæ‚¨å¯ä»¥åœ¨å•ä¸ªæœºå™¨ä¸Šä½¿ç”¨è¶…æ—¶ã€‚å½“ç„¶ï¼Œåœ¨ç”±æœ€ç»ˆç”¨æˆ·æ§åˆ¶çš„æœºå™¨ä¸Šï¼Œè¿™å¯èƒ½å‡è®¾å¾—å¤ªå¤šäº†ï¼šä¾‹å¦‚ï¼Œç”¨æˆ·åœ¨ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„æ—¥æœŸæ§ä»¶æŸ¥æ‰¾æ—¥æœŸæ—¶å¯èƒ½ä¼šæ„å¤–æ›´æ”¹æ—¥æœŸä¸ºå…¶ä»–å€¼ã€‚\nåœ¨å®é™…çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä»…ä¾é æœ¬åœ°æ—¶é’Ÿæ¥å¯¹è·¨ä¸åŒæœºå™¨çš„äº‹ä»¶è¿›è¡Œæ’åºå¯èƒ½å¯¼è‡´ä¸ä¸€è‡´æ€§ï¼Œå¹¶ä¸”åœ¨å®ç°å¯¹ç³»ç»ŸçŠ¶æ€çš„å…¨å±€è§†å›¾æ–¹é¢å­˜åœ¨æŒ‘æˆ˜ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜å¹¶åœ¨ç³»ç»Ÿé—´å»ºç«‹äº‹ä»¶çš„éƒ¨åˆ†é¡ºåºï¼Œä½¿ç”¨å„ç§åŒæ­¥æœºåˆ¶å’Œç®—æ³•ï¼Œä¾‹å¦‚é€»è¾‘æ—¶é’Ÿæˆ–å‘é‡æ—¶é’Ÿã€‚è¿™äº›æœºåˆ¶é€šå¸¸åˆ©ç”¨èŠ‚ç‚¹ä¹‹é—´çš„æ¶ˆæ¯äº¤æ¢å’Œåè°ƒæ¥å®ç°å¯¹åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€è‡´è§†å›¾ã€‚\nâ€œæ— æ—¶é’Ÿâ€å‡è®¾çš„æ—¶é—´ æœ€åï¼Œè¿˜æœ‰é€»è¾‘æ—¶é—´çš„æ¦‚å¿µã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ ¹æœ¬ä¸ä½¿ç”¨æ—¶é’Ÿï¼Œè€Œæ˜¯ä»¥æŸç§å…¶ä»–æ–¹å¼è·Ÿè¸ªå› æœå…³ç³»ã€‚è¯·è®°ä½ï¼Œæ—¶é—´æˆ³åªæ˜¯å¯¹è¯¥æ—¶åˆ»ä¹‹å‰ä¸–ç•ŒçŠ¶æ€çš„ä¸€ç§ç®€å†™ - å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è®¡æ•°å™¨å’Œé€šä¿¡æ¥ç¡®å®šæŸä¸ªäº‹ä»¶æ˜¯åœ¨å¦ä¸€ä¸ªäº‹ä»¶ä¹‹å‰ã€ä¹‹åè¿˜æ˜¯åŒæ—¶å‘ç”Ÿã€‚\né€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šä¸åŒæœºå™¨ä¹‹é—´äº‹ä»¶çš„é¡ºåºï¼Œä½†æ— æ³•å¯¹æ—¶é—´é—´éš”è¿›è¡Œä»»ä½•è¯´æ˜ï¼Œä¹Ÿæ— æ³•ä½¿ç”¨è¶…æ—¶ï¼ˆå› ä¸ºæˆ‘ä»¬å‡è®¾æ²¡æœ‰\u0026quot;æ—¶é—´ä¼ æ„Ÿå™¨\u0026quot;ï¼‰ã€‚è¿™æ˜¯ä¸€ä¸ªéƒ¨åˆ†é¡ºåºï¼šåœ¨å•ä¸ªç³»ç»Ÿä¸Šï¼Œå¯ä»¥ä½¿ç”¨è®¡æ•°å™¨è€Œæ— éœ€é€šä¿¡æ¥å¯¹äº‹ä»¶è¿›è¡Œæ’åºï¼Œä½†åœ¨ç³»ç»Ÿé—´å¯¹äº‹ä»¶è¿›è¡Œæ’åºåˆ™éœ€è¦è¿›è¡Œæ¶ˆæ¯äº¤æ¢ã€‚\nåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒLamport å…³äºæ—¶é—´ã€æ—¶é’Ÿå’Œäº‹ä»¶æ’åºçš„è®ºæ–‡æ˜¯æœ€è¢«å¼•ç”¨çš„ä¹‹ä¸€ã€‚å‘é‡æ—¶é’Ÿæ˜¯è¯¥æ¦‚å¿µçš„æ¨å¹¿ï¼ˆæˆ‘å°†æ›´è¯¦ç»†åœ°ä»‹ç»å®ƒï¼‰ï¼Œå®ƒæ˜¯ä¸€ç§åœ¨ä¸ä½¿ç”¨æ—¶é’Ÿçš„æƒ…å†µä¸‹è·Ÿè¸ªå› æœå…³ç³»çš„æ–¹æ³•ã€‚Cassandra çš„è¿‘äº²äº§å“ Riakï¼ˆBashoï¼‰å’Œ Voldemortï¼ˆLinkedinï¼‰ä½¿ç”¨å‘é‡æ—¶é’Ÿè€Œä¸æ˜¯å‡è®¾èŠ‚ç‚¹å…·æœ‰å®Œå…¨å‡†ç¡®çš„å…¨å±€æ—¶é’Ÿã€‚è¿™ä½¿å¾—è¿™äº›ç³»ç»Ÿèƒ½å¤Ÿé¿å…ä¹‹å‰æåˆ°çš„æ—¶é’Ÿå‡†ç¡®æ€§é—®é¢˜ã€‚\nå½“ä¸ä½¿ç”¨æ—¶é’Ÿæ—¶ï¼Œè·¨è¿œç¨‹æœºå™¨å¯¹äº‹ä»¶è¿›è¡Œæ’åºçš„æœ€å¤§ç²¾åº¦å—åˆ°é€šä¿¡å»¶è¿Ÿçš„é™åˆ¶ã€‚\nåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ—¶é—´æ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼Ÿ æ—¶é—´çš„å¥½å¤„åœ¨äºï¼š\nå®šä¹‰ç³»ç»Ÿä¸­çš„é¡ºåºï¼ˆæ— éœ€é€šä¿¡ï¼‰ï¼šæ—¶é—´å¯ä»¥åœ¨ç³»ç»Ÿä¸­å®šä¹‰äº‹ä»¶çš„é¡ºåºï¼Œå³ä½¿æ²¡æœ‰ç›´æ¥çš„é€šä¿¡ã€‚é€šè¿‡æ—¶é—´æˆ³æˆ–é€»è¾‘æ—¶é’Ÿï¼Œå¯ä»¥å°†äº‹ä»¶æŒ‰ç…§å®ƒä»¬å‘ç”Ÿçš„é¡ºåºè¿›è¡Œæ’åºã€‚ ä¸ºç®—æ³•å®šä¹‰è¾¹ç•Œæ¡ä»¶ï¼šæ—¶é—´å¯ä»¥ç”¨æ¥åˆ’å®šç®—æ³•çš„è¾¹ç•Œæ¡ä»¶ï¼Œç‰¹åˆ«æ˜¯åŒºåˆ†â€œé«˜å»¶è¿Ÿâ€å’Œâ€œæœåŠ¡å™¨æˆ–ç½‘ç»œè¿æ¥æ–­å¼€â€ã€‚è¿™æ˜¯éå¸¸é‡è¦çš„åº”ç”¨åœºæ™¯ï¼›åœ¨å¤§å¤šæ•°ç°å®ä¸–ç•Œçš„ç³»ç»Ÿä¸­ï¼Œè¶…æ—¶ç”¨äºç¡®å®šè¿œç¨‹æœºå™¨æ˜¯å¦å¤±è´¥ï¼Œæˆ–è€…å®ƒæ˜¯å¦ä»…ä»…æ˜¯é‡åˆ°äº†é«˜ç½‘ç»œå»¶è¿Ÿã€‚ç”¨äºè¿›è¡Œæ­¤ç±»åˆ¤æ–­çš„ç®—æ³•ç§°ä¸ºæ•…éšœæ£€æµ‹å™¨ï¼ˆfailure detectorsï¼‰ã€‚ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œäº‹ä»¶çš„é¡ºåºéå¸¸é‡è¦ï¼Œå› ä¸ºè®¸å¤šåˆ†å¸ƒå¼ç³»ç»Ÿçš„æ€§è´¨æ˜¯é€šè¿‡æ“ä½œ/äº‹ä»¶çš„é¡ºåºæ¥å®šä¹‰çš„ï¼š\næ­£ç¡®æ€§å–å†³äºï¼ˆå¯¹äº‹ä»¶é¡ºåºçš„ï¼‰æ­£ç¡®ä¸€è‡´æ€§ï¼Œä¾‹å¦‚åœ¨åˆ†å¸ƒå¼æ•°æ®åº“ä¸­çš„å¯ä¸²è¡ŒåŒ–æ€§ã€‚ å½“èµ„æºäº‰ç”¨å‘ç”Ÿæ—¶ï¼Œé¡ºåºå¯ä»¥ç”¨ä½œå†³å®šæ€§å› ç´ ï¼Œä¾‹å¦‚å¦‚æœæœ‰ä¸¤ä¸ªå¯¹äºä¸€ä¸ªå°éƒ¨ä»¶çš„è®¢å•ï¼Œå¯ä»¥æ»¡è¶³ç¬¬ä¸€ä¸ªè®¢å•å¹¶å–æ¶ˆç¬¬äºŒä¸ªè®¢å•ã€‚ å…¨å±€æ—¶é’Ÿå°†å…è®¸åœ¨ä¸¤å°ä¸åŒçš„æœºå™¨ä¸Šçš„æ“ä½œè¿›è¡Œæ’åºï¼Œè€Œæ— éœ€è¿™ä¸¤å°æœºå™¨ç›´æ¥é€šä¿¡ã€‚æ²¡æœ‰å…¨å±€æ—¶é’Ÿï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡é€šä¿¡æ¥ç¡®å®šé¡ºåºã€‚\nå› æ­¤ï¼Œæ—¶é—´åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å…·æœ‰é‡è¦çš„ä½œç”¨ï¼Œå¯ä»¥å¸®åŠ©å®ç°äº‹ä»¶çš„é¡ºåºç¡®å®šã€ç®—æ³•çš„è¾¹ç•Œæ¡ä»¶åˆ’å®šä»¥åŠæ•…éšœæ£€æµ‹ç­‰å…³é”®åŠŸèƒ½ã€‚\nçŸ¢é‡æ—¶é’Ÿï¼ˆå› æœé¡ºåºçš„æ—¶é—´ï¼‰ ä¹‹å‰æˆ‘ä»¬è®¨è®ºäº†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ—¶é—´è¿›å±•é€Ÿç‡çš„ä¸åŒå‡è®¾ã€‚å‡è®¾æˆ‘ä»¬æ— æ³•å®ç°å‡†ç¡®çš„æ—¶é’ŸåŒæ­¥ï¼Œæˆ–è€…ä»¥ç³»ç»Ÿä¸å¯¹æ—¶é—´åŒæ­¥é—®é¢˜æ•æ„Ÿä¸ºç›®æ ‡ï¼Œæˆ‘ä»¬å¦‚ä½•å¯¹äº‹ä»¶è¿›è¡Œæ’åºå‘¢ï¼Ÿ\nLamport æ—¶é’Ÿå’Œå‘é‡æ—¶é’Ÿæ˜¯æ›¿ä»£ç‰©ç†æ—¶é’Ÿçš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒä»¬ä¾é è®¡æ•°å™¨å’Œé€šä¿¡æ¥ç¡®å®šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­äº‹ä»¶çš„é¡ºåºã€‚è¿™äº›æ—¶é’Ÿæä¾›äº†ä¸€ä¸ªå¯åœ¨ä¸åŒèŠ‚ç‚¹ä¹‹é—´è¿›è¡Œæ¯”è¾ƒçš„è®¡æ•°å™¨ã€‚\nLamport æ—¶é’Ÿå¾ˆç®€å•ã€‚æ¯ä¸ªè¿›ç¨‹ä½¿ç”¨ä»¥ä¸‹è§„åˆ™æ¥ç»´æŠ¤ä¸€ä¸ªè®¡æ•°å™¨ï¼š\næ¯å½“è¿›ç¨‹æ‰§è¡Œå·¥ä½œæ—¶ï¼Œå¢åŠ è®¡æ•°å™¨çš„å€¼ã€‚ æ¯å½“è¿›ç¨‹å‘é€æ¶ˆæ¯æ—¶ï¼Œå°†è®¡æ•°å™¨çš„å€¼åŒ…å«åœ¨æ¶ˆæ¯ä¸­ã€‚ å½“æ¥æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œå°†è®¡æ•°å™¨è®¾ç½®ä¸ºmax(local_counter, received_counter) + 1ã€‚ ä»¥ä¸‹æ˜¯ç”¨ä»£ç è¡¨è¾¾çš„ç¤ºä¾‹ï¼š\nfunction LamportClock() { this.value = 1; } LamportClock.prototype.get = function () { return this.value; }; LamportClock.prototype.increment = function () { this.value++; }; LamportClock.prototype.merge = function (other) { this.value = Math.max(this.value, other.value) + 1; }; Lamport æ—¶é’Ÿå…è®¸åœ¨ç³»ç»Ÿä¹‹é—´æ¯”è¾ƒè®¡æ•°å™¨ï¼Œä½†æœ‰ä¸€ä¸ªé™åˆ¶ï¼šLamport æ—¶é’Ÿå®šä¹‰äº†ä¸€ä¸ªååºå…³ç³»ã€‚å¦‚æœ timestamp(a) \u0026lt; timestamp(b)ï¼š\na å¯èƒ½åœ¨ b ä¹‹å‰å‘ç”Ÿï¼Œæˆ–è€… a ä¸ b ä¸å¯æ¯”è¾ƒ è¿™è¢«ç§°ä¸ºæ—¶é’Ÿä¸€è‡´æ€§æ¡ä»¶ï¼šå¦‚æœä¸€ä¸ªäº‹ä»¶åœ¨å¦ä¸€ä¸ªäº‹ä»¶ä¹‹å‰å‘ç”Ÿï¼Œåˆ™è¯¥äº‹ä»¶çš„é€»è¾‘æ—¶é’Ÿåœ¨å…¶ä»–äº‹ä»¶ä¹‹å‰ã€‚å¦‚æœ a å’Œ b æ¥è‡ªåŒä¸€å› æœå†å²ï¼Œä¾‹å¦‚ä¸¤ä¸ªæ—¶é—´æˆ³å€¼éƒ½æ¥è‡ªåŒä¸€ä¸ªè¿›ç¨‹ï¼Œæˆ–è€… b æ˜¯å¯¹ a å‘é€çš„æ¶ˆæ¯çš„å“åº”ï¼Œé‚£ä¹ˆæˆ‘ä»¬çŸ¥é“ a åœ¨ b ä¹‹å‰å‘ç”Ÿã€‚\nç›´è§‚ä¸Šè®²ï¼Œè¿™æ˜¯å› ä¸º Lamport æ—¶é’Ÿåªèƒ½æºå¸¦å…³äºä¸€ä¸ªæ—¶é—´çº¿/å†å²çš„ä¿¡æ¯ï¼›å› æ­¤ï¼Œå°†ä»æœªç›¸äº’é€šä¿¡çš„ç³»ç»Ÿçš„ Lamport æ—¶é—´æˆ³è¿›è¡Œæ¯”è¾ƒå¯èƒ½å¯¼è‡´å¹¶å‘äº‹ä»¶åœ¨æ²¡æœ‰é¡ºåºå…³ç³»çš„æƒ…å†µä¸‹è¢«æ’åºã€‚\næƒ³è±¡ä¸€ä¸ªç³»ç»Ÿï¼Œåœ¨åˆå§‹é˜¶æ®µä¹‹ååˆ†ä¸ºä¸¤ä¸ªæ°¸ä¸ç›¸äº’é€šä¿¡çš„ç‹¬ç«‹å­ç³»ç»Ÿã€‚\nå¯¹äºæ¯ä¸ªç‹¬ç«‹ç³»ç»Ÿä¸­çš„æ‰€æœ‰äº‹ä»¶ï¼Œå¦‚æœ a åœ¨ b ä¹‹å‰å‘ç”Ÿï¼Œåˆ™ ts(a) \u0026lt; ts(b)ï¼›ä½†æ˜¯ï¼Œå¦‚æœä½ ä»ä¸åŒçš„ç‹¬ç«‹ç³»ç»Ÿä¸­é€‰æ‹©ä¸¤ä¸ªäº‹ä»¶ï¼ˆå³å½¼æ­¤æ— å› æœå…³ç³»çš„äº‹ä»¶ï¼‰ï¼Œåˆ™æ— æ³•å¯¹å®ƒä»¬çš„ç›¸å¯¹é¡ºåºåšå‡ºæœ‰æ„ä¹‰çš„åˆ¤æ–­ã€‚è™½ç„¶ç³»ç»Ÿçš„æ¯ä¸ªéƒ¨åˆ†å·²ç»ä¸ºäº‹ä»¶åˆ†é…äº†æ—¶é—´æˆ³ï¼Œä½†è¿™äº›æ—¶é—´æˆ³ä¹‹é—´æ²¡æœ‰å…³è”ã€‚å³ä½¿ä¸¤ä¸ªäº‹ä»¶æ— å…³ï¼Œå®ƒä»¬å¯èƒ½çœ‹èµ·æ¥æ˜¯æœ‰åºçš„ã€‚\nç„¶è€Œï¼Œä»å•å°æœºå™¨çš„è§’åº¦æ¥çœ‹ï¼Œä»ç„¶æœ‰ä¸€ä¸ªæœ‰ç”¨çš„æ€§è´¨ï¼šä»¥ ts(a)å‘é€çš„ä»»ä½•æ¶ˆæ¯éƒ½ä¼šæ”¶åˆ°ä¸€ä¸ª ts(b) \u0026gt; ts(a)çš„å“åº”ã€‚\nå‘é‡æ—¶é’Ÿæ˜¯ Lamport æ—¶é’Ÿçš„æ‰©å±•ï¼Œå®ƒç»´æŠ¤äº†ä¸€ä¸ªåŒ…å« N ä¸ªé€»è¾‘æ—¶é’Ÿï¼ˆæ¯ä¸ªèŠ‚ç‚¹ä¸€ä¸ªï¼‰çš„æ•°ç»„[t1, t2, \u0026hellip;]ã€‚æ¯ä¸ªèŠ‚ç‚¹åœ¨æ¯ä¸ªå†…éƒ¨äº‹ä»¶ä¸­ä¸æ˜¯é€’å¢ä¸€ä¸ªå…¬å…±è®¡æ•°å™¨ï¼Œè€Œæ˜¯é€’å¢å‘é‡ä¸­è¡¨ç¤ºè¯¥èŠ‚ç‚¹çš„é€»è¾‘æ—¶é’Ÿçš„å€¼ã€‚å› æ­¤ï¼Œæ›´æ–°è§„åˆ™å¦‚ä¸‹ï¼š\nå½“ä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œå·¥ä½œæ—¶ï¼Œå¢åŠ å‘é‡ä¸­èŠ‚ç‚¹çš„é€»è¾‘æ—¶é’Ÿå€¼ã€‚\nå½“ä¸€ä¸ªè¿›ç¨‹å‘é€æ¶ˆæ¯æ—¶ï¼ŒåŒ…æ‹¬å®Œæ•´çš„é€»è¾‘æ—¶é’Ÿå‘é‡ã€‚\nå½“æ¥æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯æ—¶ï¼š\nå°†å‘é‡ä¸­çš„æ¯ä¸ªå…ƒç´ æ›´æ–°ä¸ºæœ¬åœ°å’Œæ¥æ”¶åˆ°çš„å€¼çš„æœ€å¤§å€¼ã€‚\nå¢åŠ è¡¨ç¤ºå½“å‰èŠ‚ç‚¹çš„é€»è¾‘æ—¶é’Ÿå€¼çš„å‘é‡ä¸­çš„å…ƒç´ ã€‚\nä»¥ä¸‹æ˜¯ç›¸åº”çš„ä»£ç å®ç°ï¼š\nfunction VectorClock(value) { // expressed as a hash keyed by node id: e.g. { node1: 1, node2: 3 } this.value = value || {}; } VectorClock.prototype.get = function () { return this.value; }; VectorClock.prototype.increment = function (nodeId) { if (typeof this.value[nodeId] == \u0026#34;undefined\u0026#34;) { this.value[nodeId] = 1; } else { this.value[nodeId]++; } }; VectorClock.prototype.merge = function (other) { var result = {}, last, a = this.value, b = other.value; // This filters out duplicate keys in the hash Object.keys(a) .concat(b) .sort() .filter(function (key) { var isDuplicate = key == last; last = key; return !isDuplicate; }) .forEach(function (key) { result[key] = Math.max(a[key] || 0, b[key] || 0); }); this.value = result; }; æ­¤å›¾ï¼ˆæ¥æºï¼‰æ˜¾ç¤ºäº†çŸ¢é‡æ—¶é’Ÿï¼š\næ¯ä¸ªèŠ‚ç‚¹ï¼ˆAã€Bã€Cï¼‰éƒ½è·Ÿè¸ªå‘é‡æ—¶é’Ÿã€‚éšç€äº‹ä»¶å‘ç”Ÿï¼Œå®ƒä»¬ä¼šè¢«æ ‡è®°ä¸Šå½“å‰å‘é‡æ—¶é’Ÿçš„å€¼ã€‚é€šè¿‡æ£€æŸ¥å‘é‡æ—¶é’Ÿï¼Œä¾‹å¦‚{ A: 2, B: 4, C: 1 }ï¼Œæˆ‘ä»¬å¯ä»¥å‡†ç¡®åœ°ç¡®å®šï¼ˆå¯èƒ½ï¼‰å½±å“è¯¥äº‹ä»¶çš„æ¶ˆæ¯ã€‚\nå‘é‡æ—¶é’Ÿçš„é—®é¢˜ä¸»è¦åœ¨äºå®ƒä»¬éœ€è¦æ¯ä¸ªèŠ‚ç‚¹ä¸€ä¸ªæ¡ç›®ï¼Œè¿™æ„å‘³ç€å¯¹äºå¤§å‹ç³»ç»Ÿæ¥è¯´ï¼Œå®ƒä»¬å¯èƒ½ä¼šå˜å¾—éå¸¸åºå¤§ã€‚ä¸ºäº†å‡å°å‘é‡æ—¶é’Ÿçš„å¤§å°ï¼Œå·²ç»åº”ç”¨äº†å„ç§æŠ€æœ¯ï¼ˆä¾‹å¦‚å®šæœŸè¿›è¡Œåƒåœ¾å›æ”¶ï¼Œæˆ–é€šè¿‡é™åˆ¶å¤§å°æ¥é™ä½å‡†ç¡®æ€§ï¼‰ã€‚\næˆ‘ä»¬å·²ç»çœ‹è¿‡å¦‚ä½•åœ¨æ²¡æœ‰ç‰©ç†æ—¶é’Ÿçš„æƒ…å†µä¸‹è·Ÿè¸ªé¡ºåºå’Œå› æœå…³ç³»ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨æ—¶é—´æŒç»­æœŸè¿›è¡Œæˆªæ­¢ã€‚\næ•…éšœæ£€æµ‹å™¨ï¼ˆæˆªæ­¢æ—¶é—´ï¼‰ å¦‚æˆ‘ä¹‹å‰æ‰€è¿°ï¼Œç­‰å¾…çš„æ—¶é—´é‡å¯ä»¥æä¾›å…³äºç³»ç»Ÿæ˜¯åˆ†åŒºè¿˜æ˜¯ä»…é‡åˆ°é«˜å»¶è¿Ÿçš„çº¿ç´¢ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸éœ€è¦å‡è®¾ä¸€ä¸ªå®Œå…¨å‡†ç¡®çš„å…¨å±€æ—¶é’Ÿï¼Œåªéœ€è¦æœ‰ä¸€ä¸ªè¶³å¤Ÿå¯é çš„æœ¬åœ°æ—¶é’Ÿå³å¯ã€‚\nç»™å®šåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„ç¨‹åºï¼Œå®ƒå¦‚ä½•åˆ¤æ–­è¿œç¨‹èŠ‚ç‚¹æ˜¯å¦å¤±è´¥ï¼Ÿåœ¨æ²¡æœ‰å‡†ç¡®ä¿¡æ¯çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æ¨æ–­åœ¨ç»è¿‡ä¸€æ®µåˆç†çš„æ—¶é—´åï¼Œæ— å“åº”çš„è¿œç¨‹èŠ‚ç‚¹å·²ç»å¤±è´¥ã€‚\nä½†æ˜¯ï¼Œä»€ä¹ˆæ˜¯â€œåˆç†çš„æ—¶é—´â€ï¼Ÿè¿™å–å†³äºæœ¬åœ°å’Œè¿œç¨‹èŠ‚ç‚¹ä¹‹é—´çš„å»¶è¿Ÿã€‚ä¸å…¶æ˜ç¡®åœ°æŒ‡å®šå…·æœ‰ç‰¹å®šå€¼çš„ç®—æ³•ï¼ˆåœ¨æŸäº›æƒ…å†µä¸‹ä¸å¯é¿å…åœ°æ˜¯é”™è¯¯çš„ï¼‰ï¼Œæœ€å¥½å¤„ç†ä¸€ä¸ªåˆé€‚çš„æŠ½è±¡æ¦‚å¿µã€‚\næ•…éšœæ£€æµ‹å™¨æ˜¯ä¸€ç§ç”¨äºæŠ½è±¡åŒ–å‡†ç¡®è®¡æ—¶å‡è®¾çš„æ–¹æ³•ã€‚æ•…éšœæ£€æµ‹å™¨ä½¿ç”¨å¿ƒè·³æ¶ˆæ¯å’Œå®šæ—¶å™¨å®ç°ã€‚è¿›ç¨‹äº¤æ¢å¿ƒè·³æ¶ˆæ¯ã€‚å¦‚æœåœ¨è¶…æ—¶ä¹‹å‰æœªæ”¶åˆ°æ¶ˆæ¯å“åº”ï¼Œåˆ™è¿›ç¨‹æ€€ç–‘å…¶ä»–è¿›ç¨‹ã€‚\nåŸºäºè¶…æ—¶çš„æ•…éšœæ£€æµ‹å™¨å­˜åœ¨è¿‡äºæ¿€è¿›ï¼ˆå®£å¸ƒèŠ‚ç‚¹å¤±è´¥ï¼‰æˆ–è¿‡äºä¿å®ˆï¼ˆéœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½æ£€æµ‹åˆ°å´©æºƒï¼‰çš„é£é™©ã€‚æ•…éšœæ£€æµ‹å™¨éœ€è¦å¤šå‡†ç¡®æ‰èƒ½ä½¿ç”¨ï¼Ÿ\nChandra ç­‰äººï¼ˆ1996ï¼‰åœ¨è§£å†³å…±è¯†é—®é¢˜çš„èƒŒæ™¯ä¸‹è®¨è®ºäº†æ•…éšœæ£€æµ‹å™¨ï¼Œè¿™æ˜¯ä¸€ä¸ªç‰¹åˆ«ç›¸å…³çš„é—®é¢˜ï¼Œå› ä¸ºå®ƒæ˜¯å¤§å¤šæ•°å¤åˆ¶é—®é¢˜çš„åŸºç¡€ï¼Œå…¶ä¸­å‰¯æœ¬éœ€è¦åœ¨å…·æœ‰å»¶è¿Ÿå’Œç½‘ç»œåˆ†åŒºçš„ç¯å¢ƒä¸­è¾¾æˆä¸€è‡´ã€‚\nä»–ä»¬ä½¿ç”¨ä¸¤ä¸ªå±æ€§æ¥æè¿°æ•…éšœæ£€æµ‹å™¨ï¼šå®Œæ•´æ€§å’Œå‡†ç¡®æ€§ï¼š\nå¼ºå®Œæ•´æ€§ã€‚æ¯ä¸ªå´©æºƒçš„è¿›ç¨‹æœ€ç»ˆè¢«æ¯ä¸ªæ­£ç¡®çš„è¿›ç¨‹æ€€ç–‘ã€‚ å¼±å®Œæ•´æ€§ã€‚æ¯ä¸ªå´©æºƒçš„è¿›ç¨‹æœ€ç»ˆè¢«æŸä¸ªæ­£ç¡®çš„è¿›ç¨‹æ€€ç–‘ã€‚ å¼ºå‡†ç¡®æ€§ã€‚æ²¡æœ‰æ­£ç¡®çš„è¿›ç¨‹è¢«æ€€ç–‘ã€‚ å¼±å‡†ç¡®æ€§ã€‚æŸä¸ªæ­£ç¡®çš„è¿›ç¨‹ä»æœªè¢«æ€€ç–‘ã€‚ å®Œæ•´æ€§æ¯”å‡†ç¡®æ€§æ›´å®¹æ˜“å®ç°ï¼›äº‹å®ä¸Šï¼Œæ‰€æœ‰é‡è¦çš„æ•…éšœæ£€æµ‹å™¨éƒ½å¯ä»¥è¾¾åˆ°å®ƒ - ä½ æ‰€éœ€è¦åšçš„å°±æ˜¯ä¸æ°¸è¿œç­‰å¾…æ¥æ€€ç–‘æŸäººã€‚Chandra ç­‰äººæŒ‡å‡ºï¼Œå…·æœ‰å¼±å®Œæ•´æ€§çš„æ•…éšœæ£€æµ‹å™¨å¯ä»¥è½¬åŒ–ä¸ºå…·æœ‰å¼ºå®Œæ•´æ€§çš„æ•…éšœæ£€æµ‹å™¨ï¼ˆé€šè¿‡å¹¿æ’­æœ‰å…³è¢«æ€€ç–‘è¿›ç¨‹çš„ä¿¡æ¯ï¼‰ï¼Œä»è€Œä½¿æˆ‘ä»¬å¯ä»¥é›†ä¸­å…³æ³¨å‡†ç¡®æ€§å±æ€§çš„èŒƒå›´ã€‚\né™¤éæ‚¨èƒ½å¤Ÿå‡è®¾æ¶ˆæ¯å»¶è¿Ÿå­˜åœ¨ç¡¬ä¸Šé™ï¼Œå¦åˆ™å¾ˆéš¾é¿å…é”™è¯¯åœ°æ€€ç–‘éæ•…éšœè¿›ç¨‹ã€‚è¿™ä¸ªå‡è®¾å¯ä»¥åœ¨åŒæ­¥ç³»ç»Ÿæ¨¡å‹ä¸­è¿›è¡Œ - å› æ­¤ï¼Œåœ¨è¿™ç§ç³»ç»Ÿä¸­ï¼Œæ•…éšœæ£€æµ‹å™¨å¯ä»¥æ˜¯å¼ºå‡†ç¡®çš„ã€‚åœ¨ä¸å¯¹æ¶ˆæ¯å»¶è¿Ÿæ–½åŠ ç¡¬é™åˆ¶çš„ç³»ç»Ÿæ¨¡å‹ä¸‹ï¼Œæ•…éšœæ£€æµ‹æœ€å¤šåªèƒ½æ˜¯æœ€ç»ˆå‡†ç¡®çš„ã€‚\nChandra ç­‰äººè¡¨æ˜ï¼Œå³ä½¿æ˜¯éå¸¸å¼±çš„æ•…éšœæ£€æµ‹å™¨ - æœ€ç»ˆå¼±æ•…éšœæ£€æµ‹å™¨ â‹„Wï¼ˆæœ€ç»ˆå¼±å‡†ç¡®æ€§+å¼±å®Œæ•´æ€§ï¼‰ - ä¹Ÿå¯ä»¥ç”¨äºè§£å†³å…±è¯†é—®é¢˜ã€‚ä¸‹é¢çš„å›¾è¡¨ï¼ˆæ¥è‡ªè®ºæ–‡ï¼‰è¯´æ˜äº†ç³»ç»Ÿæ¨¡å‹å’Œé—®é¢˜å¯è§£æ€§ä¹‹é—´çš„å…³ç³»ï¼š\næ­£å¦‚æ‚¨ä¸Šé¢æ‰€çœ‹åˆ°çš„ï¼Œåœ¨å¼‚æ­¥ç³»ç»Ÿä¸­ï¼Œå¦‚æœæ²¡æœ‰æ•…éšœæ£€æµ‹å™¨ï¼ˆæˆ–å¯¹æ—¶é—´è¾¹ç•Œçš„å¼ºå‡è®¾ï¼Œä¾‹å¦‚åŒæ­¥ç³»ç»Ÿæ¨¡å‹ï¼‰ï¼Œå°±æ— æ³•ç¡®å®šè¿œç¨‹èŠ‚ç‚¹æ˜¯å´©æºƒäº†è¿˜æ˜¯ä»…ä»…é‡åˆ°äº†é«˜å»¶è¿Ÿã€‚å¯¹äºä»»ä½•è¿½æ±‚å•ä¸€å‰¯æœ¬ä¸€è‡´æ€§çš„ç³»ç»Ÿæ¥è¯´ï¼Œè¿™ç§åŒºåˆ†æ˜¯é‡è¦çš„ï¼šæ•…éšœèŠ‚ç‚¹å¯ä»¥è¢«å¿½ç•¥ï¼Œå› ä¸ºå®ƒä»¬ä¸ä¼šå¯¼è‡´æ•°æ®çš„åˆ†æ­§ï¼Œä½†åˆ†åŒºèŠ‚ç‚¹åˆ™ä¸èƒ½è¢«å®‰å…¨åœ°å¿½ç•¥ã€‚\nå¦‚ä½•å®ç°æ•…éšœæ£€æµ‹å™¨å‘¢ï¼Ÿä»æ¦‚å¿µä¸Šè®²ï¼Œä¸€ä¸ªç®€å•çš„æ•…éšœæ£€æµ‹å™¨å¹¶æ²¡æœ‰å¤ªå¤šå¤æ‚çš„å†…å®¹ï¼Œå®ƒåªæ˜¯åœ¨è¶…æ—¶åæ£€æµ‹åˆ°å¤±è´¥ã€‚æœ€æœ‰è¶£çš„éƒ¨åˆ†æ¶‰åŠå¦‚ä½•åˆ¤æ–­è¿œç¨‹èŠ‚ç‚¹æ˜¯å¦å¤±è´¥ã€‚\nç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›æ•…éšœæ£€æµ‹å™¨èƒ½å¤Ÿè‡ªé€‚åº”ä¸æ–­å˜åŒ–çš„ç½‘ç»œæ¡ä»¶ï¼Œå¹¶é¿å…å°†è¶…æ—¶å€¼ç¡¬ç¼–ç åˆ°å…¶ä¸­ã€‚ä¾‹å¦‚ï¼ŒCassandra ä½¿ç”¨äº†ä¸€ç§ç§°ä¸ºç´¯ç§¯æ•…éšœæ£€æµ‹å™¨çš„æ–¹æ³•ï¼Œå®ƒä¼šè¾“å‡ºä¸€ä¸ªæ€€ç–‘çº§åˆ«ï¼ˆä»‹äº 0 å’Œ 1 ä¹‹é—´çš„å€¼ï¼‰ï¼Œè€Œä¸æ˜¯äºŒè¿›åˆ¶çš„â€œä¸Šâ€æˆ–â€œä¸‹â€åˆ¤æ–­ã€‚è¿™ä½¿å¾—ä½¿ç”¨æ•…éšœæ£€æµ‹å™¨çš„åº”ç”¨ç¨‹åºå¯ä»¥æ ¹æ®å‡†ç¡®æ€§å’Œæ—©æœŸæ£€æµ‹ä¹‹é—´çš„æƒè¡¡åšå‡ºè‡ªå·±çš„å†³ç­–ã€‚\nç´¯ç§¯æ•…éšœæ£€æµ‹å™¨çš„å®ç°æ–¹å¼å¯ä»¥æ ¹æ®å…·ä½“çš„ç®—æ³•å’Œç³»ç»Ÿéœ€æ±‚è€Œæœ‰æ‰€ä¸åŒã€‚å®ƒé€šå¸¸åŸºäºå¿ƒè·³æœºåˆ¶ï¼Œä½¿ç”¨å¿ƒè·³æ¶ˆæ¯å’Œå®šæ—¶å™¨æ¥æ£€æµ‹èŠ‚ç‚¹çš„å­˜æ´»çŠ¶æ€ã€‚å…·ä½“çš„å®ç°å¯èƒ½æ¶‰åŠè¶…æ—¶æ—¶é—´çš„é€‰æ‹©ã€å¯ç–‘çº§åˆ«çš„è®¡ç®—æ–¹æ³•ä»¥åŠå¦‚ä½•æ ¹æ®ç´¯ç§¯çš„ä¿¡æ¯è¿›è¡Œåˆ¤æ–­ç­‰ã€‚\né€šè¿‡ä½¿ç”¨ç´¯ç§¯æ•…éšœæ£€æµ‹å™¨æˆ–ç±»ä¼¼çš„æ–¹æ³•ï¼Œå¯ä»¥ä½¿æ•…éšœæ£€æµ‹å™¨èƒ½å¤Ÿæ ¹æ®ç½‘ç»œæ¡ä»¶çš„å˜åŒ–è¿›è¡ŒåŠ¨æ€è°ƒæ•´ï¼Œå¹¶æä¾›æ›´çµæ´»çš„åˆ¤æ–­ç»“æœï¼Œä»¥æ»¡è¶³ç³»ç»Ÿçš„éœ€æ±‚ã€‚è¿™æ ·çš„æ•…éšœæ£€æµ‹å™¨å¯ä»¥å¸®åŠ©ç³»ç»Ÿåœ¨å¼‚æ­¥ç¯å¢ƒä¸­å®ç°æ›´å¯é çš„ä¸€è‡´æ€§ã€‚\næ—¶é—´ã€é¡ºåºå’Œè¡¨ç° ä¹‹å‰ï¼Œæˆ‘æåˆ°äº†éœ€è¦ä¸ºé¡ºåºä»˜å‡ºä»£ä»·ï¼Œæ‚¨æƒ³çŸ¥é“è¿™æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ\nå¦‚æœæ‚¨æ­£åœ¨ç¼–å†™ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½æ‹¥æœ‰å¤šå°è®¡ç®—æœºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯¹äºäº‹ä»¶çš„è‡ªç„¶ï¼ˆä¹Ÿæ˜¯ç°å®ï¼‰è§‚ç‚¹æ˜¯éƒ¨åˆ†é¡ºåºè€Œä¸æ˜¯æ€»é¡ºåºã€‚æ‚¨å¯ä»¥å°†éƒ¨åˆ†é¡ºåºè½¬åŒ–ä¸ºæ€»é¡ºåºï¼Œä½†è¿™éœ€è¦é€šä¿¡ã€ç­‰å¾…ï¼Œå¹¶ä¸”ä¼šæ–½åŠ é™åˆ¶ï¼Œé™åˆ¶äº†åœ¨ä»»ä½•ç‰¹å®šæ—¶é—´ç‚¹ä¸Šå¯ä»¥å·¥ä½œçš„è®¡ç®—æœºæ•°é‡ã€‚\næ‰€æœ‰æ—¶é’Ÿéƒ½åªæ˜¯è¿‘ä¼¼å€¼ï¼Œå—ç½‘ç»œå»¶è¿Ÿï¼ˆé€»è¾‘æ—¶é—´ï¼‰æˆ–ç‰©ç†é™åˆ¶ã€‚å³ä½¿åœ¨å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´ä¿æŒä¸€ä¸ªç®€å•çš„æ•´æ•°è®¡æ•°å™¨åŒæ­¥ä¹Ÿæ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚\nå°½ç®¡æ—¶é—´å’Œé¡ºåºç»å¸¸ä¸€èµ·è®¨è®ºï¼Œä½†æ—¶é—´æœ¬èº«å¹¶ä¸æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å±æ€§ã€‚ç®—æ³•å…³å¿ƒçš„ä¸æ˜¯æ—¶é—´ï¼Œè€Œæ˜¯æ›´æŠ½è±¡çš„å±æ€§ï¼š\näº‹ä»¶çš„å› æœé¡ºåº æ•…éšœæ£€æµ‹ï¼ˆä¾‹å¦‚ï¼Œæ¶ˆæ¯ä¼ é€’çš„ä¸Šç•Œè¿‘ä¼¼ï¼‰ ä¸€è‡´å¿«ç…§ï¼ˆä¾‹å¦‚ï¼Œåœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šæ£€æŸ¥ç³»ç»ŸçŠ¶æ€çš„èƒ½åŠ›ï¼›æ­¤å¤„ä¸è®¨è®ºï¼‰ å¼ºåˆ¶æ–½åŠ æ€»é¡ºåºæ˜¯å¯èƒ½çš„ï¼Œä½†ä»£ä»·å¾ˆé«˜ã€‚è¿™è¦æ±‚æ‚¨ä»¥æœ€å¸¸è§ï¼ˆæœ€ä½ï¼‰çš„é€Ÿåº¦è¿›è¡Œæ“ä½œã€‚é€šå¸¸ï¼Œç¡®ä¿äº‹ä»¶æŒ‰æŸç§å®šä¹‰çš„é¡ºåºä¼ é€’çš„æœ€ç®€å•æ–¹æ³•æ˜¯æŒ‡å®šä¸€ä¸ªå•ä¸€ï¼ˆç“¶é¢ˆï¼‰èŠ‚ç‚¹ï¼Œæ‰€æœ‰æ“ä½œéƒ½é€šè¿‡è¯¥èŠ‚ç‚¹è¿›è¡Œã€‚\næ—¶é—´/é¡ºåº/åŒæ­¥çœŸçš„æ˜¯å¿…éœ€çš„å—ï¼Ÿè¿™å–å†³äºæƒ…å†µã€‚åœ¨æŸäº›ç”¨ä¾‹ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›æ¯ä¸ªä¸­é—´æ“ä½œå°†ç³»ç»Ÿä»ä¸€ä¸ªä¸€è‡´çŠ¶æ€ç§»åŠ¨åˆ°å¦ä¸€ä¸ªä¸€è‡´çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œåœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›æ•°æ®åº“çš„å“åº”è¡¨ç¤ºæ‰€æœ‰å¯ç”¨çš„ä¿¡æ¯ï¼Œå¹¶ä¸”å¸Œæœ›é¿å…å¤„ç†ç³»ç»Ÿå¯èƒ½è¿”å›ä¸ä¸€è‡´ç»“æœçš„é—®é¢˜ã€‚\nä½†åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½ä¸éœ€è¦é‚£ä¹ˆå¤šçš„æ—¶é—´/é¡ºåº/åŒæ­¥ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æ­£åœ¨è¿è¡Œä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„è®¡ç®—ï¼Œå¹¶ä¸”åœ¨æœ€åé˜¶æ®µä¹‹å‰å¹¶ä¸å…³å¿ƒç³»ç»Ÿçš„æ“ä½œï¼Œé‚£ä¹ˆåªè¦èƒ½å¤Ÿä¿è¯ç­”æ¡ˆæ­£ç¡®ï¼Œå°±ä¸éœ€è¦å¤ªå¤šçš„åŒæ­¥ã€‚\nåŒæ­¥é€šå¸¸è¢«ä½œä¸ºä¸€ç§ç²—ç³™çš„å·¥å…·åº”ç”¨äºæ‰€æœ‰æ“ä½œï¼Œè€Œå®é™…ä¸Šåªæœ‰ä¸€éƒ¨åˆ†æƒ…å†µå¯¹æœ€ç»ˆç»“æœçœŸæ­£é‡è¦ã€‚ä½•æ—¶éœ€è¦é¡ºåºæ¥ä¿è¯æ­£ç¡®æ€§ï¼ŸCALM å®šç†æä¾›äº†ä¸€ä¸ªç­”æ¡ˆï¼Œæˆ‘å°†åœ¨æœ€åä¸€ç« ä¸­è®¨è®ºã€‚\nåœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œæ¥å—åªè¡¨ç¤ºæœ€ä½³å·²çŸ¥ä¼°è®¡çš„ç­”æ¡ˆæ˜¯å¯ä»¥æ¥å—çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒåªåŸºäºç³»ç»Ÿä¸­åŒ…å«çš„æ€»ä¿¡æ¯çš„ä¸€ä¸ªå­é›†ã€‚ç‰¹åˆ«æ˜¯åœ¨ç½‘ç»œåˆ†åŒºæœŸé—´ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ç³»ç»Ÿçš„éƒ¨åˆ†æ¥å›ç­”æŸ¥è¯¢ã€‚åœ¨å…¶ä»–ç”¨ä¾‹ä¸­ï¼Œæœ€ç»ˆç”¨æˆ·å®é™…ä¸Šæ— æ³•åŒºåˆ†ç›¸å¯¹è¾ƒæ–°ä¸”å¯ä»¥å»‰ä»·è·å–çš„ç­”æ¡ˆä¸ä¿è¯æ­£ç¡®ä¸”è®¡ç®—æˆæœ¬é«˜æ˜‚çš„ç­”æ¡ˆã€‚ä¾‹å¦‚ï¼ŒTwitter ç”¨æˆ· X çš„å…³æ³¨è€…æ•°é‡æ˜¯ X è¿˜æ˜¯ X+1ï¼Ÿæˆ–è€…å¯¹äºæŸä¸ªæŸ¥è¯¢ï¼Œç”µå½± Aã€B å’Œ C æ˜¯å¦æ˜¯ç»å¯¹æœ€ä½³çš„ç­”æ¡ˆï¼Ÿè¿›è¡Œæ›´ä¾¿å®œã€åŸºæœ¬æ­£ç¡®çš„â€œå°½åŠ›è€Œä¸ºâ€å¯èƒ½æ˜¯å¯ä»¥æ¥å—çš„ã€‚\nåœ¨æ¥ä¸‹æ¥çš„ä¸¤ç« ä¸­ï¼Œæˆ‘ä»¬å°†ç ”ç©¶å®¹é”™å¼ºä¸€è‡´æ€§ç³»ç»Ÿçš„å¤åˆ¶â€”â€”è¿™äº›ç³»ç»Ÿåœ¨æä¾›å¼ºä¿è¯çš„åŒæ—¶ï¼Œå¯¹æ•…éšœå…·æœ‰è¶Šæ¥è¶Šå¼ºçš„éŸ§æ€§ã€‚è¿™äº›ç³»ç»Ÿæä¾›äº†ç¬¬ä¸€ç§æƒ…å†µçš„è§£å†³æ–¹æ¡ˆï¼šå½“æ‚¨éœ€è¦ä¿è¯æ­£ç¡®æ€§å¹¶æ„¿æ„ä¸ºæ­¤ä»˜å‡ºä»£ä»·æ—¶ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†è®¨è®ºå…·æœ‰å¼±ä¸€è‡´æ€§ä¿è¯çš„ç³»ç»Ÿï¼Œè¿™äº›ç³»ç»Ÿå¯ä»¥åœ¨åˆ†åŒºçš„æƒ…å†µä¸‹ä¿æŒå¯ç”¨ï¼Œä½†åªèƒ½ç»™å‡ºä¹‹åŠ›æ±‚æœ€ä½³çš„ç­”æ¡ˆã€‚\nè¿›ä¸€æ­¥é˜…è¯» å…°æ³¢ç‰¹æ—¶é’Ÿï¼ŒçŸ¢é‡æ—¶é’Ÿ Time, Clocks and Ordering of Events in a Distributed System - Leslie Lamport, 1978 æ•…éšœæ£€æµ‹ Unreliable failure detectors and reliable distributed systems - Chandra and Toueg Latency- and Bandwidth-Minimizing Optimal Failure Detectors - So \u0026amp; Sirer, 2007 The failure detector abstraction, Freiling, Guerraoui \u0026amp; Kuznetsov, 2011 å¿«ç…§ Consistent global states of distributed systems: Fundamental concepts and mechanisms, Ozalp Babaogly and Keith Marzullo, 1993 Distributed snapshots: Determining global states of distributed systems, K. Mani Chandy and Leslie Lamport, 1985 å› æœå…³ç³» Detecting Causal Relationships in Distributed Computations: In Search of the Holy Grail - Schwarz \u0026amp; Mattern, 1994 Understanding the Limitations of Causally and Totally Ordered Communication - Cheriton \u0026amp; Skeen, 1993 ","permalink":"https://blog.chensoul.cc/posts/2023/11/10/distributed-systems-03/","summary":"ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹æ˜¯ä¸€æœ¬å¹¿å—æ¬¢è¿çš„èµ„æºï¼Œç”¨äºç†è§£å’Œå­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿã€‚è¯¥ä¹¦ç”±ä½œè€… Mikito Takada æ’°å†™ï¼Œä»‹ç»äº†æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºæœ¬æ¦‚å¿µã€åŸåˆ™å’ŒæŒ‘æˆ˜ã€‚\nè¿™æœ¬ä¹¦æ¶µç›–äº†ä¸åˆ†å¸ƒå¼ç³»ç»Ÿç›¸å…³çš„å¹¿æ³›ä¸»é¢˜ï¼ŒåŒ…æ‹¬ç½‘ç»œã€å®¹é”™æ€§ã€ä¸€è‡´æ€§æ¨¡å‹ã€åˆ†å¸ƒå¼ç®—æ³•ã€å¯æ‰©å±•æ€§ç­‰ç­‰ã€‚å®ƒæ—¨åœ¨ä»¥æ¸…æ™°æ˜“æ‡‚çš„æ–¹å¼è§£é‡Šå¤æ‚çš„æ¦‚å¿µï¼Œé€‚åˆåˆå­¦è€…å’Œæœ‰ç»éªŒçš„åˆ†å¸ƒå¼ç³»ç»Ÿä»ä¸šè€…é˜…è¯»ã€‚\nåœ¨æ•´æœ¬ä¹¦ä¸­ï¼Œä½œè€…æä¾›äº†å„ç§å®é™…æ¡ˆä¾‹å’Œæ¡ˆä¾‹ç ”ç©¶ï¼Œä»¥è¯´æ˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®é™…åº”ç”¨å’Œå®è·µæ–¹é¢ã€‚å®ƒè¿˜å¼ºè°ƒäº†æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿæ¶‰åŠçš„æƒè¡¡å’Œè®¾è®¡è€ƒè™‘ï¼Œå¸®åŠ©è¯»è€…å…¨é¢ç†è§£è¿™ä¸ªä¸»é¢˜ã€‚\nã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹ä½œä¸ºå¼€æºèµ„æºï¼Œå¯ä»¥å…è´¹åœ¨çº¿è·å–ï¼Œéå¸¸é€‚åˆä»»ä½•å¯¹å­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿæ„Ÿå…´è¶£çš„äººã€‚\nåŸæ–‡é“¾æ¥ï¼šDistributed systems: for fun and profit\n3. æ—¶é—´åŠé¡ºåº ä»€ä¹ˆæ˜¯é¡ºåºï¼Œä¸ºä»€ä¹ˆå®ƒå¾ˆé‡è¦ï¼Ÿ\nä½ è¯´çš„â€œä»€ä¹ˆæ˜¯é¡ºåºâ€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ\næˆ‘çš„æ„æ€æ˜¯ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬å¯¹é¡ºåºå¦‚æ­¤ç€è¿·ï¼Ÿä¸ºä»€ä¹ˆæˆ‘ä»¬å…³å¿ƒ A æ˜¯å¦å‘ç”Ÿåœ¨ B ä¹‹å‰ï¼Ÿä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸å…³å¿ƒå…¶ä»–å±æ€§ï¼Œæ¯”å¦‚â€œé¢œè‰²â€ï¼Ÿ\nå¥½å§ï¼Œæˆ‘çš„ç–¯ç‹‚æœ‹å‹ï¼Œè®©æˆ‘ä»¬å›åˆ°åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®šä¹‰æ¥å›ç­”è¿™ä¸ªé—®é¢˜ã€‚\nä½ å¯èƒ½è¿˜è®°å¾—ï¼Œæˆ‘å°†åˆ†å¸ƒå¼ç¼–ç¨‹æè¿°ä¸ºä½¿ç”¨å¤šå°è®¡ç®—æœºè§£å†³å•å°è®¡ç®—æœºå¯ä»¥è§£å†³çš„åŒä¸€ä¸ªé—®é¢˜çš„è‰ºæœ¯ã€‚\näº‹å®ä¸Šï¼Œè¿™æ­£æ˜¯å¯¹é¡ºåºå¦‚æ­¤ç€è¿·çš„æ ¸å¿ƒæ‰€åœ¨ã€‚ä»»ä½•åªèƒ½ä¸€æ¬¡æ‰§è¡Œä¸€é¡¹ä»»åŠ¡çš„ç³»ç»Ÿéƒ½ä¼šåˆ›å»ºæ“ä½œçš„æ€»ä½“é¡ºåºã€‚å°±åƒäººä»¬é€šè¿‡ä¸€æ‰‡é—¨ä¸€æ ·ï¼Œæ¯ä¸ªæ“ä½œéƒ½æœ‰æ˜ç¡®å®šä¹‰çš„å‰ä»»å’Œåç»§ã€‚è¿™åŸºæœ¬ä¸Šæ˜¯æˆ‘ä»¬åŠªåŠ›ä¿ç•™çš„ç¼–ç¨‹æ¨¡å‹ã€‚\nä¼ ç»Ÿçš„æ¨¡å‹æ˜¯ï¼šä¸€ä¸ªç¨‹åºï¼Œä¸€ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªåœ¨ä¸€ä¸ª CPU ä¸Šè¿è¡Œçš„å†…å­˜ç©ºé—´ã€‚æ“ä½œç³»ç»ŸæŠ½è±¡äº†å¯èƒ½å­˜åœ¨å¤šä¸ª CPU å’Œå¤šä¸ªç¨‹åºçš„äº‹å®ï¼Œä»¥åŠè®¡ç®—æœºå†…å­˜å®é™…ä¸Šæ˜¯å¤šä¸ªç¨‹åºå…±äº«çš„ã€‚æˆ‘å¹¶ä¸æ˜¯è¯´çº¿ç¨‹ç¼–ç¨‹å’Œäº‹ä»¶é©±åŠ¨ç¼–ç¨‹ä¸å­˜åœ¨ï¼›åªæ˜¯å®ƒä»¬æ˜¯â€œä¸€ä¸ª/ä¸€ä¸ª/ä¸€ä¸ªâ€æ¨¡å‹ä¹‹ä¸Šçš„ç‰¹æ®ŠæŠ½è±¡ã€‚ç¨‹åºè¢«ç¼–å†™æˆæŒ‰ç…§ä¸€å®šé¡ºåºæ‰§è¡Œï¼šä»ä¸Šå¾€ä¸‹æ‰§è¡Œã€‚\né¡ºåºä½œä¸ºä¸€ç§å±æ€§å—åˆ°äº†å¦‚æ­¤å¤šçš„å…³æ³¨ï¼Œæ˜¯å› ä¸ºå®šä¹‰â€œæ­£ç¡®æ€§â€çš„æœ€ç®€å•æ–¹æ³•æ˜¯è¯´â€œå®ƒçš„å·¥ä½œæ–¹å¼ä¸å•å°è®¡ç®—æœºä¸Šçš„å·¥ä½œæ–¹å¼ç›¸åŒâ€ã€‚è€Œé€šå¸¸è¿™æ„å‘³ç€ aï¼‰æˆ‘ä»¬è¿è¡Œç›¸åŒçš„æ“ä½œï¼Œbï¼‰æˆ‘ä»¬æŒ‰ç…§ç›¸åŒçš„é¡ºåºè¿è¡Œå®ƒä»¬ - å³ä½¿æœ‰å¤šå°è®¡ç®—æœºã€‚\nä¿æŒé¡ºåºï¼ˆå¦‚å•ä¸ªç³»ç»Ÿå®šä¹‰çš„é¡ºåºï¼‰çš„åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¼˜ç‚¹åœ¨äºå®ƒä»¬æ˜¯é€šç”¨çš„ã€‚ä½ ä¸éœ€è¦å…³å¿ƒæ“ä½œæ˜¯ä»€ä¹ˆï¼Œå› ä¸ºå®ƒä»¬å°†ä¸åœ¨å•å°è®¡ç®—æœºä¸Šå®Œå…¨ç›¸åŒçš„æ–¹å¼æ‰§è¡Œã€‚è¿™å¾ˆæ£’ï¼Œå› ä¸ºä½ çŸ¥é“æ— è®ºæ“ä½œæ˜¯ä»€ä¹ˆï¼Œä½ éƒ½å¯ä»¥ä½¿ç”¨ç›¸åŒçš„ç³»ç»Ÿã€‚\nå®é™…ä¸Šï¼Œåˆ†å¸ƒå¼ç¨‹åºåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œå…·æœ‰å¤šä¸ª CPU å’Œå¤šä¸ªæ“ä½œæµã€‚ä½ ä»ç„¶å¯ä»¥åˆ†é…ä¸€ä¸ªæ€»ä½“é¡ºåºï¼Œä½†è¿™éœ€è¦å‡†ç¡®çš„æ—¶é’Ÿæˆ–æŸç§å½¢å¼çš„é€šä¿¡ã€‚ä½ å¯ä»¥ä½¿ç”¨å®Œå…¨å‡†ç¡®çš„æ—¶é’Ÿä¸ºæ¯ä¸ªæ“ä½œæ ‡è®°æ—¶é—´æˆ³ï¼Œç„¶ååˆ©ç”¨å®ƒæ¥ç¡®å®šæ€»ä½“é¡ºåºã€‚æˆ–è€…ä½ å¯ä»¥ä½¿ç”¨æŸç§é€šä¿¡ç³»ç»Ÿï¼Œä½¿å¾—å¯ä»¥åˆ†é…ç±»ä¼¼æ€»ä½“é¡ºåºçš„è¿ç»­ç¼–å·ã€‚\nå…¨åºå’Œååº åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œè‡ªç„¶çŠ¶æ€æ˜¯ååºã€‚ç½‘ç»œå’Œç‹¬ç«‹èŠ‚ç‚¹éƒ½ä¸å¯¹ç›¸å¯¹é¡ºåºåšå‡ºä»»ä½•ä¿è¯ï¼Œä½†åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼Œä½ å¯ä»¥è§‚å¯Ÿåˆ°ä¸€ä¸ªå±€éƒ¨é¡ºåºã€‚\næ€»åºæ˜¯ä¸€ç§äºŒå…ƒå…³ç³»ï¼Œå®ƒä¸ºæŸä¸ªé›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ å®šä¹‰äº†ä¸€ä¸ªé¡ºåºã€‚\nå½“ä¸¤ä¸ªä¸åŒçš„å…ƒç´ å¯æ¯”è¾ƒæ—¶ï¼Œå…¶ä¸­ä¸€ä¸ªå¤§äºå¦ä¸€ä¸ªã€‚åœ¨ååºé›†ä¸­ï¼ŒæŸäº›å…ƒç´ å¯¹ä¸å¯æ¯”è¾ƒï¼Œå› æ­¤ååºå¹¶ä¸æŒ‡å®šæ¯ä¸ªé¡¹ç›®çš„ç¡®åˆ‡é¡ºåºã€‚\næ€»åºå’Œååºéƒ½æ˜¯ä¼ é€’æ€§å’Œåå¯¹ç§°æ€§çš„ã€‚å¯¹äºé›†åˆ X ä¸­çš„æ‰€æœ‰ aã€b å’Œ cï¼Œä»¥ä¸‹é™ˆè¿°åœ¨æ€»åºå’Œååºä¸­éƒ½æˆç«‹ï¼š\nIf a â‰¤ b and b â‰¤ a then a = b (antisymmetry); If a â‰¤ b and b â‰¤ c then a â‰¤ c (transitivity); ç„¶è€Œï¼Œæ€»åºæ˜¯å®Œå…¨çš„ï¼š\na â‰¤ b or b â‰¤ a (totality) for all a, b in X è€Œååºæ˜¯è‡ªåçš„ï¼š\na â‰¤ a (reflexivity) for all a in X æ³¨æ„ï¼Œå…¨åºæ€§è•´å«è‡ªåæ€§ï¼›å› æ­¤ï¼Œååºæ˜¯æ€»åºçš„ä¸€ç§è¾ƒå¼±çš„å˜ä½“ã€‚åœ¨ååºä¸­çš„æŸäº›å…ƒç´ ä¸Šï¼Œå…¨åºæ€§ä¸æˆç«‹ - æ¢å¥è¯è¯´ï¼Œå…¶ä¸­ä¸€äº›å…ƒç´ ä¸å¯æ¯”è¾ƒã€‚","title":"[è¯‘]ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹3.æ—¶é—´åŠé¡ºåº"},{"content":" ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹æ˜¯ä¸€æœ¬å¹¿å—æ¬¢è¿çš„èµ„æºï¼Œç”¨äºç†è§£å’Œå­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿã€‚è¯¥ä¹¦ç”±ä½œè€… Mikito Takada æ’°å†™ï¼Œä»‹ç»äº†æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºæœ¬æ¦‚å¿µã€åŸåˆ™å’ŒæŒ‘æˆ˜ã€‚\nè¿™æœ¬ä¹¦æ¶µç›–äº†ä¸åˆ†å¸ƒå¼ç³»ç»Ÿç›¸å…³çš„å¹¿æ³›ä¸»é¢˜ï¼ŒåŒ…æ‹¬ç½‘ç»œã€å®¹é”™æ€§ã€ä¸€è‡´æ€§æ¨¡å‹ã€åˆ†å¸ƒå¼ç®—æ³•ã€å¯æ‰©å±•æ€§ç­‰ç­‰ã€‚å®ƒæ—¨åœ¨ä»¥æ¸…æ™°æ˜“æ‡‚çš„æ–¹å¼è§£é‡Šå¤æ‚çš„æ¦‚å¿µï¼Œé€‚åˆåˆå­¦è€…å’Œæœ‰ç»éªŒçš„åˆ†å¸ƒå¼ç³»ç»Ÿä»ä¸šè€…é˜…è¯»ã€‚\nåœ¨æ•´æœ¬ä¹¦ä¸­ï¼Œä½œè€…æä¾›äº†å„ç§å®é™…æ¡ˆä¾‹å’Œæ¡ˆä¾‹ç ”ç©¶ï¼Œä»¥è¯´æ˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®é™…åº”ç”¨å’Œå®è·µæ–¹é¢ã€‚å®ƒè¿˜å¼ºè°ƒäº†æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿæ¶‰åŠçš„æƒè¡¡å’Œè®¾è®¡è€ƒè™‘ï¼Œå¸®åŠ©è¯»è€…å…¨é¢ç†è§£è¿™ä¸ªä¸»é¢˜ã€‚\nã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹ä½œä¸ºå¼€æºèµ„æºï¼Œå¯ä»¥å…è´¹åœ¨çº¿è·å–ï¼Œéå¸¸é€‚åˆä»»ä½•å¯¹å­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿæ„Ÿå…´è¶£çš„äººã€‚\nåŸæ–‡é“¾æ¥ï¼šDistributed systems: for fun and profit\n2. æŠ½è±¡å±‚æ¬¡çš„ä¸Šä¸‹ åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨æŠ½è±¡å±‚æ¬¡ä¹‹é—´ç©¿æ¢­ï¼Œæ¢è®¨ä¸€äº›ä¸å¯èƒ½æ€§ç»“æœï¼ˆCAP å’Œ FLPï¼‰ï¼Œç„¶åå‡ºäºæ€§èƒ½è€ƒè™‘å›å½’åˆ°æ›´ä½å±‚æ¬¡ã€‚\nå¦‚æœä½ æœ‰è¿›è¡Œè¿‡ç¼–ç¨‹ï¼ŒæŠ½è±¡å±‚æ¬¡çš„æ¦‚å¿µå¯èƒ½å¯¹ä½ æ¥è¯´å¾ˆç†Ÿæ‚‰ã€‚ä½ æ€»æ˜¯åœ¨æŸä¸ªæŠ½è±¡å±‚æ¬¡ä¸Šè¿›è¡Œå·¥ä½œï¼Œé€šè¿‡æŸä¸ª API ä¸è¾ƒä½å±‚æ¬¡çš„æ¥å£è¿›è¡Œäº¤äº’ï¼Œå¹¶å¯èƒ½ä¸ºç”¨æˆ·æä¾›ä¸€äº›æ›´é«˜å±‚æ¬¡çš„ API æˆ–ç”¨æˆ·ç•Œé¢ã€‚è®¡ç®—æœºç½‘ç»œçš„ä¸ƒå±‚ OSI æ¨¡å‹å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚\nåˆ†å¸ƒå¼ç¼–ç¨‹å¾ˆå¤§ç¨‹åº¦ä¸Šæ¶‰åŠå¤„ç†åˆ†å¸ƒçš„åæœï¼ˆæ˜¾è€Œæ˜“è§ï¼ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬é¢ä¸´ç€ç°å®ä¸­å­˜åœ¨è®¸å¤šèŠ‚ç‚¹çš„ç°å®å’Œæˆ‘ä»¬å¸Œæœ›ç³»ç»Ÿâ€œåƒä¸€ä¸ªå•ä¸€ç³»ç»Ÿä¸€æ ·å·¥ä½œâ€çš„æ„¿æœ›ä¹‹é—´å­˜åœ¨ç€ç´§å¼ å…³ç³»ã€‚è¿™æ„å‘³ç€éœ€è¦æ‰¾åˆ°ä¸€ä¸ªè‰¯å¥½çš„æŠ½è±¡ï¼Œå¹³è¡¡å¯èƒ½æ€§ã€å¯ç†è§£æ€§å’Œæ€§èƒ½ã€‚\nå½“æˆ‘ä»¬è¯´ X æ¯” Y æ›´æŠ½è±¡æ—¶ï¼Œæˆ‘ä»¬æ˜¯æŒ‡ X æ²¡æœ‰å¼•å…¥ä»»ä½•ä¸ Y æ ¹æœ¬ä¸åŒçš„æ–°å†…å®¹ã€‚äº‹å®ä¸Šï¼ŒX å¯èƒ½ä¼šå»é™¤ Y çš„æŸäº›æ–¹é¢æˆ–ä»¥æ›´æ˜“äºå¤„ç†çš„æ–¹å¼å‘ˆç°å®ƒä»¬ã€‚å…¶æ¬¡ï¼ŒX åœ¨æŸç§æ„ä¹‰ä¸Šæ¯” Y æ›´å®¹æ˜“ç†è§£ï¼Œå‡è®¾ X ä» Y ä¸­å»é™¤çš„å†…å®¹å¯¹äºå½“å‰é—®é¢˜å¹¶ä¸é‡è¦ã€‚\nå¦‚å°¼é‡‡æ‰€å†™ï¼š\næ¯ä¸ªæ¦‚å¿µéƒ½æ˜¯é€šè¿‡æˆ‘ä»¬å°†ä¸ç›¸ç­‰çš„äº‹ç‰©ç­‰åŒèµ·æ¥å½¢æˆçš„ã€‚æ²¡æœ‰ä¸€ç‰‡å¶å­å®Œå…¨ç­‰åŒäºå¦ä¸€ç‰‡å¶å­ï¼Œæ¦‚å¿µâ€œå¶å­â€æ˜¯é€šè¿‡å¯¹è¿™äº›ä¸ªä½“å·®å¼‚è¿›è¡Œä»»æ„æŠ½è±¡è€Œå½¢æˆçš„ï¼Œé€šè¿‡é—å¿˜åŒºåˆ«ï¼›ç°åœ¨å®ƒäº§ç”Ÿäº†ä¸€ä¸ªæƒ³æ³•ï¼Œå³åœ¨è‡ªç„¶ç•Œä¸­å¯èƒ½å­˜åœ¨é™¤äº†å¶å­ä¹‹å¤–çš„ä¸œè¥¿ï¼Œè¿™äº›ä¸œè¥¿å°†æ˜¯â€œå¶å­â€çš„ä¸€ç§åŸå§‹å½¢å¼ - æ‰€æœ‰å¶å­éƒ½å·²ç»è¢«ç¼–ç»‡ã€æ ‡è®°ã€å¤åˆ¶ã€ç€è‰²ã€å·æ›²å’Œç»˜åˆ¶ï¼Œä½†æ˜¯ç”±äºæŠ€æœ¯ä¸ç†Ÿç»ƒï¼Œæ²¡æœ‰ä¸€ä»½å‰¯æœ¬èƒ½å¤Ÿæˆä¸ºåŸå§‹å½¢å¼çš„æ­£ç¡®ã€å¯é å’Œå¿ å®çš„å›¾åƒã€‚\næŠ½è±¡æœ¬è´¨ä¸Šæ˜¯è™šæ„çš„ã€‚æ¯ç§æƒ…å†µéƒ½æ˜¯ç‹¬ç‰¹çš„ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä½†æ˜¯æŠ½è±¡ä½¿å¾—ä¸–ç•Œå˜å¾—å¯ç®¡ç†ï¼šç®€åŒ–çš„é—®é¢˜é™ˆè¿° - ä¸å—ç°å®çº¦æŸ - æ›´æ˜“äºåˆ†æï¼Œå¹¶ä¸”åªè¦æˆ‘ä»¬æ²¡æœ‰å¿½ç•¥ä»»ä½•é‡è¦çš„ä¸œè¥¿ï¼Œè§£å†³æ–¹æ¡ˆå°±æ˜¯å¹¿æ³›é€‚ç”¨çš„ã€‚\näº‹å®ä¸Šï¼Œå¦‚æœæˆ‘ä»¬ä¿ç•™ä¸‹æ¥çš„ä¸œè¥¿æ˜¯é‡è¦çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¾—å‡ºçš„ç»“æœå°±ä¼šå…·æœ‰å¹¿æ³›çš„é€‚ç”¨æ€§ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸å¯èƒ½æ€§ç»“æœå¦‚æ­¤é‡è¦ï¼šå®ƒä»¬é‡‡ç”¨äº†é—®é¢˜çš„æœ€ç®€å•å¯èƒ½çš„è¡¨è¿°ï¼Œå¹¶è¯æ˜åœ¨ä¸€äº›çº¦æŸæˆ–å‡è®¾æ¡ä»¶ä¸‹æ— æ³•è§£å†³è¯¥é—®é¢˜ã€‚\næ‰€æœ‰çš„æŠ½è±¡éƒ½ä¼šå¿½ç•¥ä¸€äº›ä¸ç°å®ç‹¬ç‰¹çš„ä¸œè¥¿ï¼Œä»¥ä¾¿å°†å®ƒä»¬ç­‰åŒèµ·æ¥ã€‚å…³é”®æ˜¯è¦æ‘†è„±ä¸€åˆ‡éå¿…è¦çš„ä¸œè¥¿ã€‚ä½ å¦‚ä½•çŸ¥é“ä»€ä¹ˆæ˜¯å¿…è¦çš„ï¼Ÿå—¯ï¼Œä½ å¯èƒ½äº‹å…ˆä¸çŸ¥é“ã€‚\næ¯æ¬¡æˆ‘ä»¬åœ¨ç³»ç»Ÿè§„èŒƒä¸­æ’é™¤ç³»ç»Ÿçš„æŸä¸ªæ–¹é¢æ—¶ï¼Œæˆ‘ä»¬éƒ½å­˜åœ¨å¼•å…¥é”™è¯¯å’Œ/æˆ–æ€§èƒ½é—®é¢˜çš„é£é™©ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæœ‰æ—¶æˆ‘ä»¬éœ€è¦æœç€ç›¸åçš„æ–¹å‘å‰è¿›ï¼Œå¹¶æœ‰é€‰æ‹©æ€§åœ°å¼•å…¥ä¸€äº›çœŸå®ç¡¬ä»¶å’Œç°å®ä¸–ç•Œé—®é¢˜çš„æ–¹é¢ã€‚é‡æ–°å¼•å…¥ä¸€äº›ç‰¹å®šçš„ç¡¬ä»¶ç‰¹æ€§ï¼ˆä¾‹å¦‚ç‰©ç†é¡ºåºæ€§ï¼‰æˆ–å…¶ä»–ç‰©ç†ç‰¹æ€§å¯èƒ½è¶³ä»¥è·å¾—è¶³å¤Ÿå¥½çš„æ€§èƒ½çš„ç³»ç»Ÿã€‚\nç³»ç»Ÿæ¨¡å‹ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œåˆ†å¸ƒæ˜¯ä¸€ä¸ªå…³é”®ç‰¹æ€§ã€‚å…·ä½“è€Œè¨€ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ç¨‹åºå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\nåœ¨ç‹¬ç«‹èŠ‚ç‚¹ä¸Šå¹¶å‘è¿è¡Œ\u0026hellip; é€šè¿‡å¯èƒ½å¼•å…¥éç¡®å®šæ€§å’Œæ¶ˆæ¯ä¸¢å¤±çš„ç½‘ç»œè¿æ¥\u0026hellip; æ²¡æœ‰å…±äº«å†…å­˜æˆ–å…±äº«æ—¶é’Ÿã€‚ è¿™æœ‰è®¸å¤šå«ä¹‰ï¼š\næ¯ä¸ªèŠ‚ç‚¹å¹¶å‘æ‰§è¡Œç¨‹åºã€‚ çŸ¥è¯†æ˜¯å±€éƒ¨çš„ï¼šèŠ‚ç‚¹ä»…èƒ½å¿«é€Ÿè®¿é—®æœ¬åœ°çŠ¶æ€ï¼Œå¯¹äºå…¨å±€çŠ¶æ€çš„ä»»ä½•ä¿¡æ¯éƒ½å¯èƒ½è¿‡æ—¶ã€‚ èŠ‚ç‚¹å¯ä»¥ç‹¬ç«‹å‘ç”Ÿæ•…éšœå¹¶è¿›è¡Œæ¢å¤ã€‚ æ¶ˆæ¯å¯èƒ½ä¼šå»¶è¿Ÿæˆ–ä¸¢å¤±ï¼ˆä¸èŠ‚ç‚¹æ•…éšœæ— å…³ï¼›å¾ˆéš¾åŒºåˆ†ç½‘ç»œæ•…éšœå’ŒèŠ‚ç‚¹æ•…éšœï¼‰ã€‚ è€Œä¸”èŠ‚ç‚¹ä¹‹é—´çš„æ—¶é’Ÿä¸åŒæ­¥ï¼ˆæœ¬åœ°æ—¶é—´æˆ³ä¸å…¨å±€å®é™…æ—¶é—´é¡ºåºä¸å¯¹åº”ï¼Œå¾ˆéš¾è§‚å¯Ÿåˆ°ï¼‰ã€‚ ç³»ç»Ÿæ¨¡å‹åˆ—ä¸¾äº†ä¸ç‰¹å®šç³»ç»Ÿè®¾è®¡ç›¸å…³çš„è®¸å¤šå‡è®¾ã€‚\nç³»ç»Ÿæ¨¡å‹æ˜¯å…³äºå®ç°åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç¯å¢ƒå’Œè®¾æ–½çš„ä¸€ç»„å‡è®¾ã€‚\nç³»ç»Ÿæ¨¡å‹åœ¨å…¶å¯¹ç¯å¢ƒå’Œè®¾æ–½çš„å‡è®¾æ–¹é¢å­˜åœ¨å·®å¼‚ã€‚è¿™äº›å‡è®¾åŒ…æ‹¬ï¼š\nèŠ‚ç‚¹çš„èƒ½åŠ›å’Œæ•…éšœæ–¹å¼ é€šä¿¡é“¾è·¯çš„æ“ä½œæ–¹å¼ä»¥åŠå¯èƒ½çš„æ•…éšœæ–¹å¼ æ•´ä¸ªç³»ç»Ÿçš„å±æ€§ï¼Œä¾‹å¦‚æœ‰å…³æ—¶é—´å’Œé¡ºåºçš„å‡è®¾ å¥å£®çš„ç³»ç»Ÿæ¨¡å‹æ˜¯å¯¹å‡è®¾æœ€å¼±çš„æ¨¡å‹ï¼šé’ˆå¯¹è¿™ç§ç³»ç»Ÿç¼–å†™çš„ä»»ä½•ç®—æ³•éƒ½å¯¹ä¸åŒçš„ç¯å¢ƒéå¸¸å®¹å¿ï¼Œå› ä¸ºå®ƒæœ‰éå¸¸å°‘ä¸”éå¸¸å¼±çš„å‡è®¾ã€‚\nå¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿›è¡Œå¼ºå‡è®¾æ¥åˆ›å»ºä¸€ä¸ªæ˜“äºæ¨ç†çš„ç³»ç»Ÿæ¨¡å‹ã€‚ä¾‹å¦‚ï¼Œå‡è®¾èŠ‚ç‚¹ä¸ä¼šå‘ç”Ÿæ•…éšœæ„å‘³ç€æˆ‘ä»¬çš„ç®—æ³•ä¸éœ€è¦å¤„ç†èŠ‚ç‚¹æ•…éšœã€‚ç„¶è€Œï¼Œè¿™æ ·çš„ç³»ç»Ÿæ¨¡å‹æ˜¯ä¸ç°å®çš„ï¼Œå› æ­¤åœ¨å®è·µä¸­å¾ˆéš¾åº”ç”¨ã€‚\nè®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°çœ‹ä¸€ä¸‹èŠ‚ç‚¹ã€é“¾è·¯ã€æ—¶é—´å’Œé¡ºåºçš„å±æ€§ã€‚\næˆ‘ä»¬ç³»ç»Ÿæ¨¡å‹ä¸­çš„èŠ‚ç‚¹ èŠ‚ç‚¹ä½œä¸ºè®¡ç®—å’Œå­˜å‚¨çš„ä¸»æœºã€‚å®ƒä»¬å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\nèƒ½å¤Ÿæ‰§è¡Œç¨‹åºã€‚ èƒ½å¤Ÿå°†æ•°æ®å­˜å‚¨åˆ°æ˜“å¤±æ€§å†…å­˜ï¼ˆåœ¨æ•…éšœæ—¶å¯èƒ½ä¸¢å¤±ï¼‰å’Œç¨³å®šçŠ¶æ€ï¼ˆåœ¨æ•…éšœåå¯ä»¥è¯»å–ï¼‰ã€‚ æ—¶é’Ÿï¼ˆå¯ä»¥è¢«å‡è®¾ä¸ºå‡†ç¡®æˆ–ä¸å‡†ç¡®ï¼‰ã€‚ èŠ‚ç‚¹æ‰§è¡Œç¡®å®šæ€§ç®—æ³•ï¼šå±€éƒ¨è®¡ç®—ã€è®¡ç®—åçš„æœ¬åœ°çŠ¶æ€å’Œå‘é€çš„æ¶ˆæ¯æ˜¯æ ¹æ®æ¥æ”¶åˆ°çš„æ¶ˆæ¯å’Œæ¥æ”¶æ¶ˆæ¯æ—¶çš„æœ¬åœ°çŠ¶æ€å”¯ä¸€ç¡®å®šçš„ã€‚\næœ‰è®¸å¤šå¯èƒ½çš„æ•…éšœæ¨¡å‹æè¿°äº†èŠ‚ç‚¹å¯èƒ½å‘ç”Ÿçš„æ•…éšœæ–¹å¼ã€‚åœ¨å®è·µä¸­ï¼Œå¤§å¤šæ•°ç³»ç»Ÿå‡è®¾ä½¿ç”¨å´©æºƒæ¢å¤æ•…éšœæ¨¡å‹ï¼šä¹Ÿå°±æ˜¯è¯´ï¼ŒèŠ‚ç‚¹åªèƒ½é€šè¿‡å´©æºƒæ¥å‘ç”Ÿæ•…éšœï¼Œå¹¶ä¸”å¯ä»¥åœ¨ç¨åæŸä¸ªæ—¶é—´ç‚¹ï¼ˆå¯èƒ½ï¼‰è¿›è¡Œæ¢å¤ã€‚\nå¦ä¸€ç§é€‰æ‹©æ˜¯å‡è®¾èŠ‚ç‚¹å¯ä»¥ä»¥ä»»æ„æ–¹å¼å‘ç”Ÿæ•…éšœã€‚è¿™è¢«ç§°ä¸ºæ‹œå åº­å®¹é”™ã€‚æ‹œå åº­æ•…éšœåœ¨å®é™…çš„å•†ä¸šç³»ç»Ÿä¸­å¾ˆå°‘å¤„ç†ï¼Œå› ä¸ºå¯¹ä»»æ„æ•…éšœå…·æœ‰å¼¹æ€§çš„ç®—æ³•è¿è¡Œæˆæœ¬æ›´é«˜ï¼Œå®ç°æ›´å¤æ‚ã€‚åœ¨è¿™é‡Œæˆ‘ä¸ä¼šè®¨è®ºæ‹œå åº­å®¹é”™ã€‚\næˆ‘ä»¬ç³»ç»Ÿæ¨¡å‹ä¸­çš„é€šä¿¡é“¾è·¯ é€šä¿¡é“¾æ¥å°†å„ä¸ªèŠ‚ç‚¹å½¼æ­¤è¿æ¥ï¼Œå¹¶å…è®¸æ¶ˆæ¯åœ¨ä»»æ„æ–¹å‘ä¸Šå‘é€ã€‚è®¸å¤šè®¨è®ºåˆ†å¸ƒå¼ç®—æ³•çš„ä¹¦ç±å‡è®¾æ¯å¯¹èŠ‚ç‚¹ä¹‹é—´éƒ½æœ‰ç‹¬ç«‹çš„é“¾æ¥ï¼Œè¿™äº›é“¾æ¥ä¸ºæ¶ˆæ¯æä¾›äº†å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„é¡ºåºï¼Œåªèƒ½ä¼ é€’å·²å‘é€çš„æ¶ˆæ¯ï¼Œå¹¶ä¸”å·²å‘é€çš„æ¶ˆæ¯å¯èƒ½ä¼šä¸¢å¤±ã€‚\næŸäº›ç®—æ³•å‡è®¾ç½‘ç»œæ˜¯å¯é çš„ï¼šæ¶ˆæ¯æ°¸è¿œä¸ä¼šä¸¢å¤±ï¼Œä¹Ÿä¸ä¼šæ— é™æœŸåœ°å»¶è¿Ÿã€‚è¿™åœ¨æŸäº›å®é™…æƒ…å†µä¸‹å¯èƒ½æ˜¯åˆç†çš„å‡è®¾ï¼Œä½†ä¸€èˆ¬æ¥è¯´ï¼Œæ›´å€¾å‘äºå°†ç½‘ç»œè§†ä¸ºä¸å¯é çš„ï¼Œå¯èƒ½ä¼šå‘ç”Ÿæ¶ˆæ¯ä¸¢å¤±å’Œå»¶è¿Ÿçš„æƒ…å†µã€‚\nå½“ç½‘ç»œå‘ç”Ÿæ•…éšœè€ŒèŠ‚ç‚¹æœ¬èº«ä»å¯è¿è¡Œæ—¶ï¼Œå°±ä¼šå‘ç”Ÿç½‘ç»œåˆ†åŒºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯å¯èƒ½ä¼šä¸¢å¤±æˆ–å»¶è¿Ÿï¼Œç›´åˆ°ç½‘ç»œåˆ†åŒºè¢«ä¿®å¤ã€‚åˆ†åŒºçš„èŠ‚ç‚¹å¯èƒ½å¯¹æŸäº›å®¢æˆ·ç«¯æ˜¯å¯è®¿é—®çš„ï¼Œå› æ­¤å¿…é¡»ä¸å´©æºƒçš„èŠ‚ç‚¹è¿›è¡Œä¸åŒå¤„ç†ã€‚ä¸‹å›¾è¯´æ˜äº†èŠ‚ç‚¹æ•…éšœå’Œç½‘ç»œåˆ†åŒºçš„åŒºåˆ«ï¼š\né€šå¸¸å¾ˆå°‘å¯¹é€šä¿¡é“¾æ¥åšè¿›ä¸€æ­¥çš„å‡è®¾ã€‚æˆ‘ä»¬å¯ä»¥å‡è®¾é“¾æ¥åªèƒ½å•å‘å·¥ä½œï¼Œæˆ–è€…å¯ä»¥ä¸ºä¸åŒçš„é“¾æ¥å¼•å…¥ä¸åŒçš„é€šä¿¡æˆæœ¬ï¼ˆä¾‹å¦‚ç”±äºç‰©ç†è·ç¦»å¼•èµ·çš„å»¶è¿Ÿï¼‰ã€‚ç„¶è€Œï¼Œåœ¨å•†ä¸šç¯å¢ƒä¸­ï¼Œé™¤äº†é•¿è·ç¦»é“¾æ¥ï¼ˆå¹¿åŸŸç½‘å»¶è¿Ÿï¼‰ä¹‹å¤–ï¼Œè¿™äº›å¾ˆå°‘æ˜¯å…³æ³¨çš„é—®é¢˜ï¼Œå› æ­¤æˆ‘åœ¨è¿™é‡Œä¸ä¼šè®¨è®ºå®ƒä»¬ï¼›æˆæœ¬å’Œæ‹“æ‰‘çš„æ›´è¯¦ç»†æ¨¡å‹å¯ä»¥åœ¨å¤æ‚æ€§çš„ä»£ä»·ä¸‹å®ç°æ›´å¥½çš„ä¼˜åŒ–ã€‚\næ—¶é—´/é¡ºåºå‡è®¾ ç‰©ç†åˆ†å¸ƒçš„ä¸€ä¸ªç»“æœæ˜¯æ¯ä¸ªèŠ‚ç‚¹ä»¥ç‹¬ç‰¹çš„æ–¹å¼ä½“éªŒä¸–ç•Œã€‚è¿™æ˜¯æ— æ³•é¿å…çš„ï¼Œå› ä¸ºä¿¡æ¯åªèƒ½ä»¥å…‰é€Ÿä¼ æ’­ã€‚å¦‚æœèŠ‚ç‚¹ä¹‹é—´çš„è·ç¦»ä¸åŒï¼Œé‚£ä¹ˆä»ä¸€ä¸ªèŠ‚ç‚¹å‘é€åˆ°å…¶ä»–èŠ‚ç‚¹çš„ä»»ä½•æ¶ˆæ¯éƒ½ä¼šåœ¨å…¶ä»–èŠ‚ç‚¹ä»¥ä¸åŒçš„æ—¶é—´åˆ°è¾¾ï¼Œå¹¶æœ‰å¯èƒ½ä»¥ä¸åŒçš„é¡ºåºåˆ°è¾¾ã€‚\næ—¶é—´å‡è®¾æ˜¯æ•æ‰æˆ‘ä»¬åœ¨å¤šå¤§ç¨‹åº¦ä¸Šè€ƒè™‘è¿™ä¸ªç°å®çš„ä¾¿æ·æ–¹å¼ã€‚ä¸»è¦çš„ä¸¤ç§é€‰æ‹©æ˜¯ï¼š\nåŒæ­¥ç³»ç»Ÿæ¨¡å‹ã€‚è¿›ç¨‹ä»¥åŒæ­¥æ–¹å¼æ‰§è¡Œï¼›æ¶ˆæ¯ä¼ è¾“å»¶è¿Ÿæœ‰å·²çŸ¥çš„ä¸Šç•Œï¼›æ¯ä¸ªè¿›ç¨‹å…·æœ‰å‡†ç¡®çš„æ—¶é’Ÿã€‚ å¼‚æ­¥ç³»ç»Ÿæ¨¡å‹ã€‚æ²¡æœ‰æ—¶é—´å‡è®¾ - ä¾‹å¦‚è¿›ç¨‹ä»¥ç‹¬ç«‹çš„é€Ÿç‡æ‰§è¡Œï¼›æ¶ˆæ¯ä¼ è¾“å»¶è¿Ÿæ²¡æœ‰ä¸Šç•Œï¼›æ²¡æœ‰å¯é çš„æ—¶é’Ÿå­˜åœ¨ã€‚ åŒæ­¥ç³»ç»Ÿæ¨¡å‹å¯¹æ—¶é—´å’Œé¡ºåºæ–½åŠ äº†è®¸å¤šé™åˆ¶ã€‚å®ƒåŸºæœ¬ä¸Šå‡è®¾èŠ‚ç‚¹æœ‰ç›¸åŒçš„ä½“éªŒï¼šå‘é€çš„æ¶ˆæ¯æ€»æ˜¯åœ¨ç‰¹å®šçš„æœ€å¤§ä¼ è¾“å»¶è¿Ÿå†…æ¥æ”¶ï¼Œå¹¶ä¸”è¿›ç¨‹ä»¥åŒæ­¥æ–¹å¼æ‰§è¡Œã€‚è¿™å¾ˆæ–¹ä¾¿ï¼Œå› ä¸ºå®ƒå…è®¸æ‚¨ä½œä¸ºç³»ç»Ÿè®¾è®¡è€…å¯¹æ—¶é—´å’Œé¡ºåºåšå‡ºå‡è®¾ï¼Œè€Œå¼‚æ­¥ç³»ç»Ÿæ¨¡å‹åˆ™ä¸å…è®¸ã€‚\nå¼‚æ­¥æ€§æ˜¯ä¸€ç§éå‡è®¾ï¼šå®ƒåªæ˜¯å‡è®¾æ‚¨ä¸èƒ½ä¾èµ–äºæ—¶é—´ï¼ˆæˆ–â€œæ—¶é—´ä¼ æ„Ÿå™¨â€ï¼‰ã€‚\nåœ¨åŒæ­¥ç³»ç»Ÿæ¨¡å‹ä¸­è§£å†³é—®é¢˜æ›´å®¹æ˜“ï¼Œå› ä¸ºå¯¹æ‰§è¡Œé€Ÿåº¦ã€æœ€å¤§æ¶ˆæ¯ä¼ è¾“å»¶è¿Ÿå’Œæ—¶é’Ÿå‡†ç¡®æ€§çš„å‡è®¾æœ‰åŠ©äºè§£å†³é—®é¢˜ï¼Œæ‚¨å¯ä»¥æ ¹æ®è¿™äº›å‡è®¾è¿›è¡Œæ¨æ–­ï¼Œå¹¶å‡è®¾ä¸æ–¹ä¾¿çš„æ•…éšœåœºæ™¯ä»ä¸å‘ç”Ÿã€‚\nå½“ç„¶ï¼Œå‡è®¾åŒæ­¥ç³»ç»Ÿæ¨¡å‹å¹¶ä¸ç‰¹åˆ«ç°å®ã€‚ç°å®ä¸–ç•Œçš„ç½‘ç»œä¼šå‡ºç°æ•…éšœï¼Œå¹¶ä¸”æ¶ˆæ¯å»¶è¿Ÿæ²¡æœ‰å›ºå®šçš„ä¸Šé™ã€‚ç°å®ä¸–ç•Œçš„ç³»ç»Ÿæœ€å¤šæ˜¯éƒ¨åˆ†åŒæ­¥çš„ï¼šå®ƒä»¬å¯èƒ½ä¼šå¶å°”æ­£ç¡®å·¥ä½œå¹¶æä¾›ä¸€äº›ä¸Šé™ï¼Œä½†ä¹Ÿä¼šæœ‰æ¶ˆæ¯æ— é™æœŸå»¶è¿Ÿå’Œæ—¶é’Ÿä¸åŒæ­¥çš„æ—¶å€™ã€‚æˆ‘åœ¨è¿™é‡Œä¸ä¼šè¯¦ç»†è®¨è®ºåŒæ­¥ç³»ç»Ÿçš„ç®—æ³•ï¼Œä½†æ‚¨å¯èƒ½ä¼šåœ¨è®¸å¤šå…¶ä»–å…¥é—¨ä¹¦ç±ä¸­é‡åˆ°å®ƒä»¬ï¼Œå› ä¸ºå®ƒä»¬åœ¨åˆ†æä¸Šæ›´å®¹æ˜“ï¼ˆä½†ä¸ç°å®ï¼‰ã€‚\nå…±è¯†é—®é¢˜ åœ¨æ¥ä¸‹æ¥çš„æ–‡æœ¬ä¸­ï¼Œæˆ‘ä»¬å°†æ”¹å˜ç³»ç»Ÿæ¨¡å‹çš„å‚æ•°ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ¢è®¨ä¸¤ä¸ªç³»ç»Ÿå±æ€§çš„å˜åŒ–å¯¹ç³»ç»Ÿè®¾è®¡é€‰æ‹©çš„å½±å“ï¼š\næ˜¯å¦å°†ç½‘ç»œåˆ†åŒºåŒ…å«åœ¨æ•…éšœæ¨¡å‹ä¸­ã€‚ åŒæ­¥ä¸å¼‚æ­¥çš„æ—¶é—´å‡è®¾ã€‚ æˆ‘ä»¬å°†é€šè¿‡è®¨è®ºä¸¤ä¸ªä¸å¯èƒ½æ€§ç»“æœï¼ˆFLP å’Œ CAPï¼‰æ¥è¯´æ˜è¿™äº›å½±å“ã€‚\nå½“ç„¶ï¼Œä¸ºäº†è¿›è¡Œè®¨è®ºï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¼•å…¥ä¸€ä¸ªéœ€è¦è§£å†³çš„é—®é¢˜ã€‚æˆ‘å°†è®¨è®ºçš„é—®é¢˜æ˜¯å…±è¯†é—®é¢˜ã€‚\nå¦‚æœå¤šå°è®¡ç®—æœºï¼ˆæˆ–èŠ‚ç‚¹ï¼‰è¾¾æˆå…±è¯†ï¼Œåˆ™å®ƒä»¬éƒ½åŒæ„æŸä¸ªå€¼ã€‚æ›´æ­£å¼åœ°è¯´ï¼š\nä¸€è‡´æ€§ï¼šæ¯ä¸ªæ­£ç¡®çš„è¿›ç¨‹å¿…é¡»å°±åŒä¸€ä¸ªå€¼è¾¾æˆä¸€è‡´ã€‚ å®Œæ•´æ€§ï¼šæ¯ä¸ªæ­£ç¡®çš„è¿›ç¨‹æœ€å¤šå†³å®šä¸€ä¸ªå€¼ï¼Œå¦‚æœå®ƒå†³å®šäº†æŸä¸ªå€¼ï¼Œåˆ™è¯¥å€¼å¿…é¡»ç”±æŸä¸ªè¿›ç¨‹æè®®ã€‚ ç»ˆæ­¢æ€§ï¼šæ‰€æœ‰è¿›ç¨‹æœ€ç»ˆéƒ½ä¼šè¾¾æˆå†³ç­–ã€‚ æœ‰æ•ˆæ€§ï¼šå¦‚æœæ‰€æœ‰æ­£ç¡®çš„è¿›ç¨‹æè®®ç›¸åŒçš„å€¼ Vï¼Œåˆ™æ‰€æœ‰æ­£ç¡®çš„è¿›ç¨‹å†³å®šçš„å€¼å¿…é¡»ä¸º Vã€‚ å…±è¯†é—®é¢˜æ˜¯è®¸å¤šå•†ä¸šåˆ†å¸ƒå¼ç³»ç»Ÿçš„æ ¸å¿ƒã€‚æ¯•ç«Ÿï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨ä¸å¿…å¤„ç†åˆ†å¸ƒçš„åæœï¼ˆä¾‹å¦‚èŠ‚ç‚¹ä¹‹é—´çš„åˆ†æ­§/åç¦»ï¼‰çš„æƒ…å†µä¸‹è·å¾—åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¯é æ€§å’Œæ€§èƒ½ï¼Œè€Œè§£å†³å…±è¯†é—®é¢˜ä½¿å¾—è§£å†³ä¸€äº›ç›¸å…³çš„æ›´é«˜çº§é—®é¢˜æˆä¸ºå¯èƒ½ï¼Œä¾‹å¦‚åŸå­å¹¿æ’­å’ŒåŸå­æäº¤ã€‚\nä¸¤ä¸ªä¸å¯èƒ½çš„ç»“æœ ç¬¬ä¸€ä¸ªä¸å¯èƒ½æ€§ç»“æœæ˜¯ FLP ä¸å¯èƒ½æ€§ç»“æœï¼Œå®ƒæ˜¯ä¸€ä¸ªä¸è®¾è®¡åˆ†å¸ƒå¼ç®—æ³•ç›¸å…³çš„ä¸å¯èƒ½æ€§ç»“æœï¼Œå¯¹åˆ†å¸ƒå¼ç®—æ³•è®¾è®¡è€…å°¤ä¸ºé‡è¦ã€‚ç¬¬äºŒä¸ªç»“æœæ˜¯ CAP å®šç†ï¼Œå®ƒæ˜¯ä¸€ä¸ªç›¸å…³çš„ç»“æœï¼Œæ›´ä¸å®è·µè€…ç›¸å…³ï¼Œå³éœ€è¦åœ¨ä¸åŒç³»ç»Ÿè®¾è®¡ä¹‹é—´è¿›è¡Œé€‰æ‹©ä½†ä¸ç›´æ¥æ¶‰åŠç®—æ³•è®¾è®¡çš„äººã€‚\nFLP ä¸å¯èƒ½ç»“æœ FLP ä¸å¯èƒ½æ€§ç»“æœï¼ˆä»¥å…¶ä½œè€… Fischerã€Lynch å’Œ Patterson å‘½åï¼‰åªåšç®€è¦æ¦‚è¿°ï¼Œå°½ç®¡åœ¨å­¦æœ¯ç•Œè¢«è®¤ä¸ºæ›´ä¸ºé‡è¦ã€‚FLP ä¸å¯èƒ½æ€§ç»“æœè€ƒå¯Ÿäº†å¼‚æ­¥ç³»ç»Ÿæ¨¡å‹ä¸‹çš„å…±è¯†é—®é¢˜ï¼ˆä¸¥æ ¼æ¥è¯´æ˜¯åè®®é—®é¢˜ï¼Œå®ƒæ˜¯å…±è¯†é—®é¢˜çš„ä¸€ç§éå¸¸å¼±çš„å½¢å¼ï¼‰ã€‚å‡è®¾èŠ‚ç‚¹åªèƒ½é€šè¿‡å´©æºƒæ¥å¤±è´¥ï¼Œç½‘ç»œæ˜¯å¯é çš„ï¼Œå¹¶ä¸”å¼‚æ­¥ç³»ç»Ÿæ¨¡å‹çš„å…¸å‹æ—¶åºå‡è®¾æˆç«‹ï¼Œä¾‹å¦‚æ¶ˆæ¯å»¶è¿Ÿæ²¡æœ‰ä¸Šç•Œã€‚\nåœ¨è¿™äº›å‡è®¾ä¸‹ï¼ŒFLP ç»“æœè¡¨æ˜ï¼šâ€œåœ¨ä¸€ä¸ªå¼‚æ­¥ç³»ç»Ÿä¸­ï¼Œä¸å­˜åœ¨è§£å†³å…±è¯†é—®é¢˜çš„ï¼ˆç¡®å®šæ€§ï¼‰ç®—æ³•ï¼Œå³ä½¿æ¶ˆæ¯æ°¸è¿œä¸ä¼šä¸¢å¤±ï¼Œæœ€å¤šåªæœ‰ä¸€ä¸ªè¿›ç¨‹å¯èƒ½å¤±è´¥ï¼Œå¹¶ä¸”åªèƒ½é€šè¿‡å´©æºƒï¼ˆåœæ­¢æ‰§è¡Œï¼‰æ¥å¤±è´¥ã€‚â€\nè¿™ä¸ªç»“æœæ„å‘³ç€åœ¨ä¸€ä¸ªéå¸¸ç®€åŒ–çš„ç³»ç»Ÿæ¨¡å‹ä¸‹ï¼Œæ²¡æœ‰åŠæ³•è§£å†³å…±è¯†é—®é¢˜ï¼Œè€Œä¸”è§£å†³æ–¹æ¡ˆå¯èƒ½è¢«æ— é™å»¶è¿Ÿã€‚è®ºè¯æ˜¯ï¼Œå¦‚æœè¿™æ ·çš„ç®—æ³•å­˜åœ¨ï¼Œé‚£ä¹ˆå¯ä»¥è®¾è®¡ä¸€ç§æ‰§è¡Œè¯¥ç®—æ³•çš„æ–¹å¼ï¼Œå…¶ä¸­é€šè¿‡å»¶è¿Ÿæ¶ˆæ¯ä¼ é€’ï¼Œå®ƒå°†ä¿æŒæœªå†³çŠ¶æ€ï¼ˆ\u0026ldquo;bivalent\u0026rdquo;ï¼‰çš„æ—¶é—´å¯ä»¥æ˜¯ä»»æ„é•¿çš„ï¼Œè€Œè¿™åœ¨å¼‚æ­¥ç³»ç»Ÿæ¨¡å‹ä¸­æ˜¯å…è®¸çš„ã€‚å› æ­¤ï¼Œè¿™æ ·çš„ç®—æ³•æ˜¯ä¸å¯èƒ½å­˜åœ¨çš„ã€‚\nè¿™ä¸ªä¸å¯èƒ½æ€§ç»“æœå¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒå¼ºè°ƒäº†åœ¨å¼‚æ­¥ç³»ç»Ÿæ¨¡å‹ä¸‹çš„ä¸€ä¸ªæƒè¡¡ï¼šè§£å†³å…±è¯†é—®é¢˜çš„ç®—æ³•å¿…é¡»åœ¨æ¶ˆæ¯ä¼ é€’çš„ç•Œé™ä¸æ»¡è¶³æ—¶æ”¾å¼ƒå®‰å…¨æ€§æˆ–æ´»æ€§ã€‚\nè¿™ä¸ªæ´å¯Ÿå¯¹äºè®¾è®¡ç®—æ³•çš„äººä»¬ç‰¹åˆ«é‡è¦ï¼Œå› ä¸ºå®ƒå¯¹æˆ‘ä»¬æ‰€çŸ¥é“çš„åœ¨å¼‚æ­¥ç³»ç»Ÿæ¨¡å‹ä¸­å¯è§£å†³çš„é—®é¢˜æ–½åŠ äº†ä¸¥æ ¼é™åˆ¶ã€‚CAP å®šç†æ˜¯ä¸€ä¸ªç›¸å…³çš„å®šç†ï¼Œå¯¹ä»ä¸šè€…æ›´ä¸ºç›¸å…³ï¼šå®ƒåšå‡ºç¨å¾®ä¸åŒçš„å‡è®¾ï¼ˆç½‘ç»œæ•…éšœè€Œä¸æ˜¯èŠ‚ç‚¹æ•…éšœï¼‰ï¼Œå¹¶å¯¹ä»ä¸šè€…åœ¨ç³»ç»Ÿè®¾è®¡ä¹‹é—´çš„é€‰æ‹©æœ‰æ›´æ˜ç¡®çš„å½±å“ã€‚\nCAP å®šç† CAP å®šç†æœ€åˆæ˜¯ç”±è®¡ç®—æœºç§‘å­¦å®¶ Eric Brewer æå‡ºçš„ä¸€ä¸ªçŒœæƒ³ã€‚å®ƒæ˜¯ä¸€ç§æµè¡Œä¸”ç›¸å½“æœ‰ç”¨çš„æ€è€ƒç³»ç»Ÿè®¾è®¡ä¸­æ‰€ä½œå‡ºçš„ä¿è¯ä¹‹é—´æƒè¡¡çš„æ–¹å¼ã€‚å®é™…ä¸Šï¼Œå®ƒè¿˜è¢« Gilbert å’Œ Lynch è¿›è¡Œäº†å½¢å¼åŒ–è¯æ˜ï¼Œå¹¶ä¸”ä¸æŸä¸ªç‰¹å®šè®¨è®ºç«™ç‚¹è®¤ä¸ºçš„ä¸åŒï¼ŒNathan Marz å¹¶æ²¡æœ‰æ­ç©¿å®ƒã€‚\nè¯¥å®šç†æŒ‡å‡ºï¼Œåœ¨ä»¥ä¸‹ä¸‰ä¸ªå±æ€§ä¸­ï¼š\nä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šæ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´çœ‹åˆ°ç›¸åŒçš„æ•°æ®ã€‚ å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰ï¼šèŠ‚ç‚¹æ•…éšœä¸ä¼šé˜»æ­¢å­˜æ´»èŠ‚ç‚¹ç»§ç»­è¿è¡Œã€‚ åˆ†åŒºå®¹å¿æ€§ï¼ˆPartition toleranceï¼‰ï¼šå°½ç®¡ç”±äºç½‘ç»œå’Œ/æˆ–èŠ‚ç‚¹æ•…éšœå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼Œç³»ç»Ÿä»ç„¶å¯ä»¥ç»§ç»­è¿è¡Œã€‚ åªèƒ½åŒæ—¶æ»¡è¶³å…¶ä¸­ä¸¤ä¸ªå±æ€§ã€‚æˆ‘ä»¬ç”šè‡³å¯ä»¥å°†å…¶ç»˜åˆ¶ä¸ºä¸€ä¸ªæ¼‚äº®çš„å›¾è¡¨ï¼Œä»ä¸‰ä¸ªå±æ€§ä¸­é€‰æ‹©ä¸¤ä¸ªï¼Œå¯ä»¥å¾—åˆ°å¯¹åº”äºä¸åŒäº¤å‰ç‚¹çš„ä¸‰ç§ä¸åŒç±»å‹çš„ç³»ç»Ÿï¼š\nè¯·æ³¨æ„ï¼Œè¯¥å®šç†æŒ‡å‡ºä¸­é—´éƒ¨åˆ†ï¼ˆåŒæ—¶å…·æœ‰ä¸‰ä¸ªå±æ€§ï¼‰æ˜¯ä¸å¯å®ç°çš„ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸‰ç§ä¸åŒçš„ç³»ç»Ÿç±»å‹ï¼š\nCAï¼ˆä¸€è‡´æ€§ + å¯ç”¨æ€§ï¼‰ã€‚ä¾‹å¦‚ï¼Œå®Œå…¨ä¸¥æ ¼çš„æ³•å®šäººæ•°åè®®ï¼Œå¦‚ä¸¤é˜¶æ®µæäº¤åè®®ã€‚ CPï¼ˆä¸€è‡´æ€§ + åˆ†åŒºå®¹å¿æ€§ï¼‰ã€‚ä¾‹å¦‚ï¼Œå¤šæ•°æ³•å®šäººæ•°åè®®ï¼Œåœ¨è¿™ç§åè®®ä¸­ï¼Œå°‘æ•°åˆ†åŒºæ˜¯ä¸å¯ç”¨çš„ï¼Œæ¯”å¦‚ Paxos åè®®ã€‚ APï¼ˆå¯ç”¨æ€§ + åˆ†åŒºå®¹å¿æ€§ï¼‰ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨å†²çªè§£å†³çš„åè®®ï¼Œå¦‚ Dynamo åè®®ã€‚ CA å’Œ CP ç³»ç»Ÿè®¾è®¡éƒ½æä¾›ç›¸åŒçš„ä¸€è‡´æ€§æ¨¡å‹ï¼šå¼ºä¸€è‡´æ€§ã€‚å”¯ä¸€çš„åŒºåˆ«åœ¨äºï¼ŒCA ç³»ç»Ÿæ— æ³•å®¹å¿ä»»ä½•èŠ‚ç‚¹æ•…éšœï¼›CP ç³»ç»Ÿå¯ä»¥å®¹å¿åœ¨éæ‹œå åº­æ•…éšœæ¨¡å‹ä¸­ç»™å®š 2f+1 ä¸ªèŠ‚ç‚¹çš„æƒ…å†µä¸‹æœ€å¤š f ä¸ªæ•…éšœï¼ˆæ¢å¥è¯è¯´ï¼Œåªè¦å¤šæ•° f+1 ä¸ªèŠ‚ç‚¹ä¿æŒè¿è¡Œï¼Œå®ƒå°±å¯ä»¥å®¹å¿å°‘æ•° f ä¸ªèŠ‚ç‚¹çš„æ•…éšœï¼‰ã€‚åŸå› å¾ˆç®€å•ï¼š\nCA ç³»ç»Ÿä¸åŒºåˆ†èŠ‚ç‚¹æ•…éšœå’Œç½‘ç»œæ•…éšœï¼Œå› æ­¤å¿…é¡»åœæ­¢åœ¨ä»»ä½•åœ°æ–¹æ¥å—å†™æ“ä½œï¼Œä»¥é¿å…å¼•å…¥åˆ†æ­§ï¼ˆå¤šä¸ªå‰¯æœ¬ï¼‰ã€‚å®ƒæ— æ³•åˆ¤æ–­è¿œç¨‹èŠ‚ç‚¹æ˜¯åœæœºè¿˜æ˜¯ä»…ä»…æ˜¯ç½‘ç»œè¿æ¥æ–­å¼€ï¼šå› æ­¤ï¼Œå”¯ä¸€å®‰å…¨çš„åšæ³•æ˜¯åœæ­¢æ¥å—å†™æ“ä½œã€‚ CP ç³»ç»Ÿé€šè¿‡å¯¹åˆ†åŒºçš„ä¸¤ä¾§æ–½åŠ ä¸å¯¹ç§°è¡Œä¸ºæ¥é˜²æ­¢åˆ†æ­§ï¼ˆä¾‹å¦‚ä¿æŒå•ä¸€å‰¯æœ¬ä¸€è‡´æ€§ï¼‰ã€‚å®ƒåªä¿ç•™å¤šæ•°åˆ†åŒºï¼Œå¹¶è¦æ±‚å°‘æ•°åˆ†åŒºä¸å¯ç”¨ï¼ˆä¾‹å¦‚åœæ­¢æ¥å—å†™æ“ä½œï¼‰ï¼Œè¿™ä¿æŒäº†ä¸€å®šç¨‹åº¦çš„å¯ç”¨æ€§ï¼ˆå¤šæ•°åˆ†åŒºï¼‰å¹¶ç¡®ä¿äº†å•ä¸€å‰¯æœ¬ä¸€è‡´æ€§ã€‚ æˆ‘å°†åœ¨åé¢å…³äºå¤åˆ¶çš„ç« èŠ‚ä¸­è¯¦ç»†è®¨è®ºè¿™ä¸ªé—®é¢˜ï¼Œå½“æˆ‘è®¨è®º Paxos æ—¶ä¼šæ›´è¯¦ç»†åœ°è®¨è®ºã€‚é‡è¦çš„æ˜¯ï¼ŒCP ç³»ç»Ÿå°†ç½‘ç»œåˆ†åŒºçº³å…¥å…¶æ•…éšœæ¨¡å‹ï¼Œå¹¶ä½¿ç”¨åƒ Paxosã€Raft æˆ– viewstamped replication è¿™æ ·çš„ç®—æ³•åŒºåˆ†å¤šæ•°åˆ†åŒºå’Œå°‘æ•°åˆ†åŒºã€‚CA ç³»ç»Ÿä¸å…·å¤‡åˆ†åŒºæ„ŸçŸ¥èƒ½åŠ›ï¼Œå¹¶ä¸”åœ¨å†å²ä¸Šæ›´å¸¸è§ï¼šå®ƒä»¬é€šå¸¸ä½¿ç”¨ä¸¤é˜¶æ®µæäº¤ç®—æ³•ï¼Œåœ¨ä¼ ç»Ÿçš„åˆ†å¸ƒå¼å…³ç³»æ•°æ®åº“ä¸­å¾ˆå¸¸è§ã€‚\nå‡è®¾å‘ç”Ÿåˆ†åŒºï¼Œè¯¥å®šç†å°±ä¼šç®€åŒ–ä¸ºå¯ç”¨æ€§å’Œä¸€è‡´æ€§ä¹‹é—´çš„äºŒé€‰ä¸€ã€‚\né¦–å…ˆï¼Œæ—©æœŸåˆ†å¸ƒå¼å…³ç³»æ•°æ®åº“ç³»ç»Ÿä¸­ä½¿ç”¨çš„è®¸å¤šç³»ç»Ÿè®¾è®¡æ²¡æœ‰è€ƒè™‘åˆ°åˆ†åŒºå®¹å¿æ€§ï¼ˆä¾‹å¦‚ï¼Œå®ƒä»¬æ˜¯ CA è®¾è®¡ï¼‰ã€‚åœ¨ç°ä»£ç³»ç»Ÿä¸­ï¼Œåˆ†åŒºå®¹å¿æ€§æ˜¯ä¸€ä¸ªé‡è¦çš„å±æ€§ï¼Œå› ä¸ºå¦‚æœç³»ç»Ÿåœ¨åœ°ç†ä¸Šåˆ†å¸ƒï¼ˆæ­£å¦‚è®¸å¤šå¤§å‹ç³»ç»Ÿæ‰€åšçš„é‚£æ ·ï¼‰ï¼Œç½‘ç»œåˆ†åŒºå˜å¾—æ›´åŠ å¸¸è§ã€‚\nå…¶æ¬¡ï¼Œåœ¨ç½‘ç»œåˆ†åŒºæœŸé—´ï¼Œå¼ºä¸€è‡´æ€§å’Œé«˜å¯ç”¨æ€§ä¹‹é—´å­˜åœ¨ç´§å¼ å…³ç³»ã€‚CAP å®šç†è¯´æ˜äº†åœ¨å¼ºä¸€è‡´æ€§ä¿è¯å’Œåˆ†å¸ƒå¼è®¡ç®—ä¹‹é—´çš„æƒè¡¡ã€‚\nä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œæ‰¿è¯ºä¸€ä¸ªç”±ä¸å¯é¢„æµ‹ç½‘ç»œè¿æ¥çš„ç‹¬ç«‹èŠ‚ç‚¹ç»„æˆçš„åˆ†å¸ƒå¼ç³»ç»Ÿâ€œè¡Œä¸ºä¸éåˆ†å¸ƒå¼ç³»ç»Ÿä¸å¯åŒºåˆ†â€æ˜¯ç›¸å½“å›°éš¾çš„ã€‚\næˆ‘å°†åœ¨ç¨åå…³äºå¤åˆ¶çš„ç« èŠ‚ä¸­è¯¦ç»†è®¨è®ºè¿™ä¸ªé—®é¢˜ï¼Œå½“æˆ‘è®¨è®º Paxos æ—¶ä¼šæ›´è¯¦ç»†åœ°è®¨è®ºã€‚é‡è¦çš„æ˜¯ï¼ŒCP ç³»ç»Ÿå°†ç½‘ç»œåˆ†åŒºçº³å…¥å…¶æ•…éšœæ¨¡å‹ï¼Œå¹¶ä½¿ç”¨åƒ Paxosã€Raft æˆ– viewstamped replication è¿™æ ·çš„ç®—æ³•åŒºåˆ†å¤šæ•°åˆ†åŒºå’Œå°‘æ•°åˆ†åŒºã€‚CA ç³»ç»Ÿä¸å…·å¤‡åˆ†åŒºæ„ŸçŸ¥èƒ½åŠ›ï¼Œå¹¶ä¸”åœ¨å†å²ä¸Šæ›´å¸¸è§ï¼šå®ƒä»¬é€šå¸¸ä½¿ç”¨ä¸¤é˜¶æ®µæäº¤ç®—æ³•ï¼Œåœ¨ä¼ ç»Ÿçš„åˆ†å¸ƒå¼å…³ç³»æ•°æ®åº“ä¸­å¾ˆå¸¸è§ã€‚\nå‡è®¾å‘ç”Ÿåˆ†åŒºï¼Œè¯¥å®šç†å°±ä¼šç®€åŒ–ä¸ºå¯ç”¨æ€§å’Œä¸€è‡´æ€§ä¹‹é—´çš„äºŒé€‰ä¸€ã€‚\nè¯·æ³¨æ„ï¼ŒCAP å®šç†å®é™…ä¸Šæä¾›äº†å››ä¸ªç»“è®ºã€‚è¿™äº›ç»“è®ºå¼ºè°ƒäº†åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æƒè¡¡å’ŒæŒ‘æˆ˜ï¼Œå¹¶æé†’ç³»ç»Ÿè®¾è®¡äººå‘˜éœ€è¦æ ¹æ®åº”ç”¨ç¨‹åºçš„éœ€æ±‚åšå‡ºåˆé€‚çš„é€‰æ‹©ã€‚\nå¼ºä¸€è‡´æ€§ä¿è¯è¦æ±‚åœ¨åˆ†åŒºæœŸé—´æ”¾å¼ƒå¯ç”¨æ€§ã€‚è¿™æ˜¯å› ä¸ºåœ¨ä¸¤ä¸ªæ— æ³•äº’ç›¸é€šä¿¡çš„å‰¯æœ¬ä¹‹é—´ç»§ç»­æ¥å—å†™æ“ä½œæ—¶ï¼Œæ— æ³•é˜²æ­¢å®ƒä»¬å‘ç”Ÿå·®å¼‚ã€‚\nå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿå¯ä»¥é€šè¿‡åŠ å¼ºå‡è®¾ï¼ˆå‡è®¾æ²¡æœ‰åˆ†åŒºï¼‰æˆ–é™ä½ä¿è¯æ¥è§£å†³ã€‚ä¸€è‡´æ€§å¯ä»¥ä¸å¯ç”¨æ€§ï¼ˆä»¥åŠä¸ç¦»çº¿å¯è®¿é—®æ€§å’Œä½å»¶è¿Ÿç›¸å…³çš„åŠŸèƒ½ï¼‰è¿›è¡Œæƒè¡¡ã€‚å¦‚æœå°†\u0026quot;ä¸€è‡´æ€§\u0026quot;å®šä¹‰ä¸º\u0026quot;æ‰€æœ‰èŠ‚ç‚¹åŒæ—¶çœ‹åˆ°ç›¸åŒçš„æ•°æ®\u0026quot;çš„è¦æ±‚ä¹‹ä¸‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åŒæ—¶å®ç°å¯ç”¨æ€§å’ŒæŸç§ï¼ˆè¾ƒå¼±çš„ï¼‰ä¸€è‡´æ€§ä¿è¯ã€‚\nç¬¬ä¸‰ï¼Œå¼ºä¸€è‡´æ€§å’Œæ€§èƒ½åœ¨æ­£å¸¸æ“ä½œä¸­å­˜åœ¨ç´§å¼ å…³ç³»ã€‚\nå¼ºä¸€è‡´æ€§/å•å‰¯æœ¬ä¸€è‡´æ€§è¦æ±‚èŠ‚ç‚¹åœ¨æ¯ä¸ªæ“ä½œä¸Šè¿›è¡Œé€šä¿¡å’Œè¾¾æˆä¸€è‡´ã€‚è¿™å¯¼è‡´åœ¨æ­£å¸¸æ“ä½œæœŸé—´å‡ºç°é«˜å»¶è¿Ÿã€‚\nå¦‚æœä½ å¯ä»¥æ¥å—é™¤ç»å…¸ä¸€è‡´æ€§æ¨¡å‹ä¹‹å¤–çš„ä¸€è‡´æ€§æ¨¡å‹ï¼Œå³å…è®¸å‰¯æœ¬æ»åæˆ–å‘ç”Ÿå·®å¼‚ï¼Œé‚£ä¹ˆä½ å¯ä»¥åœ¨æ­£å¸¸æ“ä½œæœŸé—´é™ä½å»¶è¿Ÿï¼Œå¹¶åœ¨åˆ†åŒºçš„æƒ…å†µä¸‹ä¿æŒå¯ç”¨æ€§ã€‚\nå½“æ¶‰åŠçš„æ¶ˆæ¯å’ŒèŠ‚ç‚¹è¾ƒå°‘æ—¶ï¼Œæ“ä½œå¯ä»¥æ›´å¿«åœ°å®Œæˆã€‚ä½†å”¯ä¸€çš„æ–¹æ³•æ˜¯æ”¾æ¾ä¿è¯ï¼šè®©ä¸€äº›èŠ‚ç‚¹æ›´å°‘åœ°è¢«è®¿é—®ï¼Œè¿™æ„å‘³ç€èŠ‚ç‚¹å¯èƒ½åŒ…å«æ—§æ•°æ®ã€‚\nè¿™ä¹Ÿå¯èƒ½å¯¼è‡´å¼‚å¸¸æƒ…å†µçš„å‘ç”Ÿã€‚ä½ ä¸èƒ½å†ä¿è¯è·å¾—æœ€æ–°çš„å€¼ã€‚æ ¹æ®æ‰€åšçš„ä¿è¯ç±»å‹ï¼Œä½ å¯èƒ½è¯»å–åˆ°æ¯”é¢„æœŸæ›´æ—§çš„å€¼ï¼Œç”šè‡³å¯èƒ½ä¸¢å¤±ä¸€äº›æ›´æ–°ã€‚\nç¬¬å››ï¼Œå¹¶ä¸”é—´æ¥åœ°ï¼Œå¦‚æœæˆ‘ä»¬ä¸æƒ³åœ¨ç½‘ç»œåˆ†åŒºæœŸé—´æ”¾å¼ƒå¯ç”¨æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦æ¢ç´¢é™¤å¼ºä¸€è‡´æ€§ä¹‹å¤–çš„å…¶ä»–ä¸€è‡´æ€§æ¨¡å‹æ˜¯å¦é€‚ç”¨äºæˆ‘ä»¬çš„ç›®çš„ã€‚\nä¾‹å¦‚ï¼Œå³ä½¿ç”¨æˆ·æ•°æ®åœ¨å¤šä¸ªæ•°æ®ä¸­å¿ƒè¿›è¡Œäº†åœ°ç†å¤åˆ¶ï¼Œè€Œè¿™ä¸¤ä¸ªæ•°æ®ä¸­å¿ƒä¹‹é—´çš„è¿æ¥æš‚æ—¶ä¸­æ–­ï¼Œåœ¨è®¸å¤šæƒ…å†µä¸‹æˆ‘ä»¬ä»ç„¶å¸Œæœ›å…è®¸ç”¨æˆ·ä½¿ç”¨ç½‘ç«™/æœåŠ¡ã€‚è¿™æ„å‘³ç€ç¨åéœ€è¦åè°ƒä¸¤ä¸ªä¸åŒçš„æ•°æ®é›†ï¼Œè¿™æ—¢æ˜¯æŠ€æœ¯ä¸Šçš„æŒ‘æˆ˜ï¼Œä¹Ÿæ˜¯ä¸šåŠ¡é£é™©ã€‚ä½†é€šå¸¸æƒ…å†µä¸‹ï¼ŒæŠ€æœ¯æŒ‘æˆ˜å’Œä¸šåŠ¡é£é™©æ˜¯å¯ä»¥ç®¡ç†çš„ï¼Œå› æ­¤æä¾›é«˜å¯ç”¨æ€§æ›´å¯å–ã€‚\nä¸€è‡´æ€§å’Œå¯ç”¨æ€§å¹¶ä¸æ˜¯äºŒå…ƒé€‰æ‹©ï¼Œé™¤éä½ å°†è‡ªå·±é™åˆ¶åœ¨å¼ºä¸€è‡´æ€§ä¸Šã€‚ä½†å¼ºä¸€è‡´æ€§åªæ˜¯ä¸€ç§ä¸€è‡´æ€§æ¨¡å‹ï¼šåœ¨è¿™ç§æ¨¡å‹ä¸­ï¼Œä¸ºäº†é˜²æ­¢æ•°æ®çš„å¤šä¸ªå‰¯æœ¬åŒæ—¶æ´»è·ƒï¼Œä½ å¿…é¡»æ”¾å¼ƒå¯ç”¨æ€§ã€‚æ­£å¦‚Brewer æœ¬äººæŒ‡å‡ºçš„é‚£æ ·ï¼Œâ€œ3 é€‰ 2â€è§£é‡Šæ˜¯è¯¯å¯¼æ€§çš„ã€‚\nå¦‚æœä½ ä»è¿™æ¬¡è®¨è®ºä¸­åªå¾—åˆ°ä¸€ä¸ªè§‚ç‚¹ï¼Œé‚£å°±æ˜¯\u0026quot;ä¸€è‡´æ€§\u0026quot;ä¸æ˜¯ä¸€ä¸ªå•ä¸€ã€æ˜ç¡®çš„å±æ€§ã€‚è¯·è®°ä½ï¼š\nACID consistency != CAP consistency != Oatmeal consistency\nç›¸åï¼Œä¸€è‡´æ€§æ¨¡å‹æ˜¯æ•°æ®å­˜å‚¨ä¸ºä½¿ç”¨å®ƒçš„ç¨‹åºæä¾›çš„ä»»ä½•ä¿è¯ã€‚\nä¸€è‡´æ€§æ¨¡å‹æ˜¯ç¨‹åºå‘˜å’Œç³»ç»Ÿä¹‹é—´çš„å¥‘çº¦ï¼Œç³»ç»Ÿä¿è¯å¦‚æœç¨‹åºå‘˜éµå¾ªä¸€äº›ç‰¹å®šè§„åˆ™ï¼Œå¯¹æ•°æ®å­˜å‚¨çš„æ“ä½œç»“æœå°†æ˜¯å¯é¢„æµ‹çš„ã€‚\nCAP ä¸­çš„\u0026quot;C\u0026quot;ä»£è¡¨\u0026quot;å¼ºä¸€è‡´æ€§\u0026quot;ï¼Œä½†\u0026quot;ä¸€è‡´æ€§\u0026quot;å¹¶ä¸ç­‰åŒäº\u0026quot;å¼ºä¸€è‡´æ€§\u0026quot;ã€‚\nè®©æˆ‘ä»¬æ¥çœ‹ä¸€äº›æ›¿ä»£çš„ä¸€è‡´æ€§æ¨¡å‹ã€‚\nå¼ºä¸€è‡´æ€§ä¸å…¶ä»–ä¸€è‡´æ€§æ¨¡å‹ ä¸€è‡´æ€§æ¨¡å‹å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼šå¼ºä¸€è‡´æ€§æ¨¡å‹å’Œå¼±ä¸€è‡´æ€§æ¨¡å‹ï¼š\nå¼ºä¸€è‡´æ€§æ¨¡å‹ï¼ˆèƒ½å¤Ÿç»´æŠ¤å•ä¸ªå‰¯æœ¬ï¼‰\nçº¿æ€§ä¸€è‡´æ€§ï¼ˆLinearizable consistencyï¼‰ é¡ºåºä¸€è‡´æ€§ï¼ˆSequential consistencyï¼‰ å¼±ä¸€è‡´æ€§æ¨¡å‹ï¼ˆä¸æ˜¯å¼ºä¸€è‡´æ€§ï¼‰\nä»¥å®¢æˆ·ç«¯ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹ï¼ˆClient-centric consistency modelsï¼‰ å› æœä¸€è‡´æ€§ï¼ˆCausal consistencyï¼‰ï¼šæœ€å¼ºçš„ä¸€è‡´æ€§æ¨¡å‹ æœ€ç»ˆä¸€è‡´æ€§æ¨¡å‹ï¼ˆEventual consistency modelsï¼‰ å¼ºä¸€è‡´æ€§æ¨¡å‹ä¿è¯äº†æ›´æ–°çš„è¡¨é¢é¡ºåºå’Œå¯è§æ€§ä¸éå¤åˆ¶ç³»ç»Ÿç­‰æ•ˆã€‚è€Œå¼±ä¸€è‡´æ€§æ¨¡å‹åˆ™ä¸æä¾›è¿™æ ·çš„ä¿è¯ã€‚\nè¯·æ³¨æ„ï¼Œè¿™å¹¶ä¸æ˜¯ä¸€ä¸ªè¯¦å°½æ— é—çš„åˆ—è¡¨ã€‚å†æ¬¡å¼ºè°ƒï¼Œä¸€è‡´æ€§æ¨¡å‹åªæ˜¯ç¨‹åºå‘˜å’Œç³»ç»Ÿä¹‹é—´çš„ä»»æ„å¥‘çº¦ï¼Œå› æ­¤å¯ä»¥æ˜¯å‡ ä¹ä»»ä½•å½¢å¼ã€‚\nå¼ºä¸€è‡´æ€§æ¨¡å‹ å¼ºä¸€è‡´æ€§æ¨¡å‹è¿›ä¸€æ­¥å¯ä»¥åˆ†ä¸ºä¸¤ç§ç›¸ä¼¼ä½†ç¨æœ‰ä¸åŒçš„ä¸€è‡´æ€§æ¨¡å‹ï¼š\nçº¿æ€§ä¸€è‡´æ€§ï¼ˆLinearizable consistencyï¼‰ï¼šåœ¨çº¿æ€§ä¸€è‡´æ€§ä¸‹ï¼Œæ‰€æœ‰æ“ä½œä¼¼ä¹ä»¥ä¸å…¨å±€å®æ—¶æ“ä½œé¡ºåºä¸€è‡´çš„é¡ºåºåŸå­åœ°æ‰§è¡Œã€‚ï¼ˆHerlihy å’Œ Wingï¼Œ1991 å¹´ï¼‰ é¡ºåºä¸€è‡´æ€§ï¼ˆSequential consistencyï¼‰ï¼šåœ¨é¡ºåºä¸€è‡´æ€§ä¸‹ï¼Œæ‰€æœ‰æ“ä½œä¼¼ä¹ä»¥æŸä¸ªä¸å„ä¸ªèŠ‚ç‚¹æ‰€è§çš„é¡ºåºä¸€è‡´ä¸”åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šç›¸ç­‰çš„é¡ºåºåŸå­åœ°æ‰§è¡Œã€‚ï¼ˆLamportï¼Œ1979 å¹´ï¼‰ å…³é”®çš„åŒºåˆ«åœ¨äºï¼Œçº¿æ€§ä¸€è‡´æ€§è¦æ±‚æ“ä½œäº§ç”Ÿæ•ˆæœçš„é¡ºåºä¸å®é™…å®æ—¶æ“ä½œé¡ºåºç›¸ç­‰ã€‚è€Œé¡ºåºä¸€è‡´æ€§å…è®¸å¯¹æ“ä½œè¿›è¡Œé‡æ–°æ’åºï¼Œåªè¦åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè§‚å¯Ÿåˆ°çš„é¡ºåºä¿æŒä¸€è‡´å³å¯ã€‚åªæœ‰å½“èƒ½å¤Ÿè§‚å¯Ÿåˆ°ç³»ç»Ÿä¸­æ‰€æœ‰çš„è¾“å…¥å’Œæ—¶é—´æ—¶ï¼Œæ‰èƒ½åŒºåˆ†è¿™ä¸¤ç§æ¨¡å‹ï¼›ä»å®¢æˆ·ç«¯ä¸èŠ‚ç‚¹äº¤äº’çš„è§’åº¦æ¥çœ‹ï¼Œä¸¤è€…æ˜¯ç­‰ä»·çš„ã€‚\nè¿™ç§å·®å¼‚ä¼¼ä¹å¾®ä¸è¶³é“ï¼Œä½†å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œé¡ºåºä¸€è‡´æ€§ä¸å…·å¤‡ç»„åˆæ€§ã€‚\nå¼ºä¸€è‡´æ€§æ¨¡å‹å…è®¸ç¨‹åºå‘˜å°†å•ä¸ªæœåŠ¡å™¨æ›¿æ¢ä¸ºåˆ†å¸ƒå¼èŠ‚ç‚¹é›†ç¾¤ï¼Œè€Œä¸ä¼šé‡åˆ°ä»»ä½•é—®é¢˜ã€‚\nä¸ä¿è¯å¼ºä¸€è‡´æ€§çš„ç³»ç»Ÿç›¸æ¯”ï¼Œæ‰€æœ‰å…¶ä»–ä¸€è‡´æ€§æ¨¡å‹éƒ½å­˜åœ¨å¼‚å¸¸è¡Œä¸ºï¼Œå› ä¸ºå®ƒä»¬çš„è¡Œä¸ºä¸éå¤åˆ¶ç³»ç»Ÿæœ‰æ‰€åŒºåˆ«ã€‚ä½†é€šå¸¸è¿™äº›å¼‚å¸¸è¡Œä¸ºæ˜¯å¯ä»¥æ¥å—çš„ï¼Œè¦ä¹ˆæ˜¯å› ä¸ºæˆ‘ä»¬ä¸å…³å¿ƒå¶å°”å‡ºç°çš„é—®é¢˜ï¼Œè¦ä¹ˆæ˜¯å› ä¸ºæˆ‘ä»¬ç¼–å†™äº†èƒ½å¤Ÿå¤„ç†å‘ç”Ÿä¸€è‡´æ€§é—®é¢˜çš„ä»£ç ã€‚\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºå¼±ä¸€è‡´æ€§æ¨¡å‹ï¼Œå®é™…ä¸Šæ²¡æœ‰æ™®éé€‚ç”¨çš„åˆ†ç±»æ–¹æ³•ï¼Œå› ä¸ºâ€œä¸æ˜¯å¼ºä¸€è‡´æ€§æ¨¡å‹â€ï¼ˆä¾‹å¦‚â€œåœ¨æŸç§ç¨‹åº¦ä¸Šä¸éå¤åˆ¶ç³»ç»Ÿæœ‰æ‰€åŒºåˆ«â€ï¼‰å¯ä»¥æ˜¯å‡ ä¹ä»»ä½•å½¢å¼ã€‚\nä»¥å®¢æˆ·ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹ ä»¥å®¢æˆ·ç«¯ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹æ˜¯ä¸€ç§æ¶‰åŠå®¢æˆ·ç«¯æˆ–ä¼šè¯æ¦‚å¿µçš„ä¸€è‡´æ€§æ¨¡å‹ã€‚ä¾‹å¦‚ï¼Œä»¥å®¢æˆ·ç«¯ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹å¯èƒ½ä¿è¯å®¢æˆ·ç«¯æ°¸è¿œä¸ä¼šçœ‹åˆ°æ•°æ®é¡¹çš„æ—§ç‰ˆæœ¬ã€‚é€šå¸¸ï¼Œè¿™æ˜¯é€šè¿‡åœ¨å®¢æˆ·ç«¯åº“ä¸­æ„å»ºé¢å¤–çš„ç¼“å­˜æ¥å®ç°çš„ï¼Œå› æ­¤ï¼Œå¦‚æœå®¢æˆ·ç«¯åˆ‡æ¢åˆ°åŒ…å«æ—§æ•°æ®çš„å‰¯æœ¬èŠ‚ç‚¹ï¼Œå®¢æˆ·ç«¯åº“ä¼šè¿”å›å…¶ç¼“å­˜çš„å€¼ï¼Œè€Œä¸æ˜¯å‰¯æœ¬ä¸­çš„æ—§å€¼ã€‚\nå¦‚æœå®¢æˆ·ç«¯æ‰€åœ¨çš„å‰¯æœ¬èŠ‚ç‚¹ä¸åŒ…å«æœ€æ–°ç‰ˆæœ¬çš„æ•°æ®ï¼Œå®¢æˆ·ç«¯ä»ç„¶å¯èƒ½çœ‹åˆ°æ—§ç‰ˆæœ¬çš„æ•°æ®ï¼Œä½†å®ƒä»¬æ°¸è¿œä¸ä¼šçœ‹åˆ°æ—§å€¼é‡æ–°å‡ºç°çš„å¼‚å¸¸æƒ…å†µï¼ˆä¾‹å¦‚ï¼Œå› ä¸ºå®ƒä»¬è¿æ¥åˆ°äº†ä¸åŒçš„å‰¯æœ¬ï¼‰ã€‚è¯·æ³¨æ„ï¼Œæœ‰è®¸å¤šä»¥å®¢æˆ·ç«¯ä¸ºä¸­å¿ƒçš„ä¸€è‡´æ€§æ¨¡å‹å­˜åœ¨ã€‚\næœ€ç»ˆä¸€è‡´æ€§ æœ€ç»ˆä¸€è‡´æ€§æ¨¡å‹è¡¨ç¤ºï¼Œå¦‚æœåœæ­¢æ›´æ”¹å€¼ï¼Œé‚£ä¹ˆåœ¨ä¸€æ®µä¸ç¡®å®šçš„æ—¶é—´åï¼Œæ‰€æœ‰å‰¯æœ¬å°†è¾¾æˆç›¸åŒçš„å€¼ã€‚è¿™æ„å‘³ç€åœ¨æ­¤ä¹‹å‰ï¼Œå‰¯æœ¬ä¹‹é—´çš„ç»“æœä»¥æŸç§ä¸ç¡®å®šçš„æ–¹å¼ä¸ä¸€è‡´ã€‚ç”±äºå®ƒæ˜¯å¹³å‡¡å¯æ»¡è¶³çš„ï¼ˆä»…å…·å¤‡æ´»æ€§å±æ€§ï¼‰ï¼Œå¦‚æœæ²¡æœ‰è¡¥å……ä¿¡æ¯ï¼Œå®ƒå°±æ˜¯æ²¡æœ‰ç”¨å¤„çš„ã€‚\nä»…ä»…è¯´æŸä¸ªä¸œè¥¿æ˜¯æœ€ç»ˆä¸€è‡´æ€§çš„ï¼Œå°±åƒè¯´â€œäººæœ€ç»ˆä¼šæ­»äº¡â€ä¸€æ ·ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸å¼±çš„çº¦æŸæ¡ä»¶ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›å¯¹ä¸¤ä¸ªæ–¹é¢è¿›è¡Œæ›´å…·ä½“çš„æè¿°ï¼š\né¦–å…ˆï¼Œ\u0026ldquo;æœ€ç»ˆ\u0026quot;æ˜¯å¤šä¹…çš„æ—¶é—´ï¼Ÿæœ‰ä¸€ä¸ªä¸¥æ ¼çš„ä¸‹é™æˆ–è€…è‡³å°‘å¯¹ç³»ç»Ÿæ”¶æ•›åˆ°ç›¸åŒå€¼é€šå¸¸éœ€è¦å¤šé•¿æ—¶é—´çš„ä¸€äº›æ¦‚å¿µå°†æ˜¯æœ‰ç”¨çš„ã€‚\nå…¶æ¬¡ï¼Œå‰¯æœ¬å¦‚ä½•è¾¾æˆä¸€è‡´çš„å€¼ï¼Ÿä¸€ä¸ªå§‹ç»ˆè¿”å›\u0026quot;42\u0026quot;çš„ç³»ç»Ÿæ˜¯æœ€ç»ˆä¸€è‡´æ€§çš„ï¼šæ‰€æœ‰å‰¯æœ¬éƒ½åŒæ„ç›¸åŒçš„å€¼ã€‚ä½†å®ƒä¸ä¼šæ”¶æ•›åˆ°ä¸€ä¸ªæœ‰ç”¨çš„å€¼ï¼Œå› ä¸ºå®ƒåªä¼šæŒç»­è¿”å›ç›¸åŒçš„å›ºå®šå€¼ã€‚ç›¸åï¼Œæˆ‘ä»¬å¸Œæœ›å¯¹æ–¹æ³•æœ‰æ›´å¥½çš„ç†è§£ã€‚ä¾‹å¦‚ï¼Œä¸€ç§å†³ç­–æ–¹æ³•æ˜¯å§‹ç»ˆé€‰æ‹©å…·æœ‰æœ€å¤§æ—¶é—´æˆ³çš„å€¼ã€‚\nå› æ­¤ï¼Œå½“ä¾›åº”å•†æåˆ°\u0026quot;æœ€ç»ˆä¸€è‡´æ€§\u0026quot;æ—¶ï¼Œä»–ä»¬æŒ‡çš„æ˜¯ä¸€äº›æ›´å…·ä½“çš„æœ¯è¯­ï¼Œä¾‹å¦‚\u0026quot;æœ€ç»ˆè°å†™å…¥çš„ä¼˜å…ˆï¼ŒåŒæ—¶è¯»å–æœ€æ–°è§‚å¯Ÿåˆ°çš„å€¼\u0026quot;çš„ä¸€è‡´æ€§ã€‚\u0026ldquo;å¦‚ä½•ï¼Ÿ\u0026ldquo;å¾ˆé‡è¦ï¼Œå› ä¸ºç³Ÿç³•çš„æ–¹æ³•å¯èƒ½å¯¼è‡´å†™å…¥ä¸¢å¤±ï¼Œä¾‹å¦‚å¦‚æœä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„æ—¶é’Ÿè®¾ç½®ä¸æ­£ç¡®å¹¶ä¸”ä½¿ç”¨æ—¶é—´æˆ³ã€‚\næˆ‘å°†åœ¨å¼±ä¸€è‡´æ€§æ¨¡å‹çš„å¤åˆ¶æ–¹æ³•ç« èŠ‚ä¸­æ›´è¯¦ç»†åœ°ç ”ç©¶è¿™ä¸¤ä¸ªé—®é¢˜ã€‚\nFurther reading è¿›ä¸€æ­¥é˜…è¯» Brewer\u0026rsquo;s Conjecture and the Feasibility of Consistent, Available, Partition-Tolerant Web Services - Gilbert \u0026amp; Lynch, 2002 Impossibility of distributed consensus with one faulty process - Fischer, Lynch and Patterson, 1985 Perspectives on the CAP Theorem - Gilbert \u0026amp; Lynch, 2012 CAP Twelve Years Later: How the \u0026ldquo;Rules\u0026rdquo; Have Changed - Brewer, 2012 Uniform consensus is harder than consensus - Charron-Bost \u0026amp; Schiper, 2000 Replicated Data Consistency Explained Through Baseball - Terry, 2011 Life Beyond Distributed Transactions: an Apostate\u0026rsquo;s Opinion - Helland, 2007 If you have too much data, then \u0026lsquo;good enough\u0026rsquo; is good enough - Helland, 2011 Building on Quicksand - Helland \u0026amp; Campbell, 2009 ","permalink":"https://blog.chensoul.cc/posts/2023/11/10/distributed-systems-02/","summary":"ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹æ˜¯ä¸€æœ¬å¹¿å—æ¬¢è¿çš„èµ„æºï¼Œç”¨äºç†è§£å’Œå­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿã€‚è¯¥ä¹¦ç”±ä½œè€… Mikito Takada æ’°å†™ï¼Œä»‹ç»äº†æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºæœ¬æ¦‚å¿µã€åŸåˆ™å’ŒæŒ‘æˆ˜ã€‚\nè¿™æœ¬ä¹¦æ¶µç›–äº†ä¸åˆ†å¸ƒå¼ç³»ç»Ÿç›¸å…³çš„å¹¿æ³›ä¸»é¢˜ï¼ŒåŒ…æ‹¬ç½‘ç»œã€å®¹é”™æ€§ã€ä¸€è‡´æ€§æ¨¡å‹ã€åˆ†å¸ƒå¼ç®—æ³•ã€å¯æ‰©å±•æ€§ç­‰ç­‰ã€‚å®ƒæ—¨åœ¨ä»¥æ¸…æ™°æ˜“æ‡‚çš„æ–¹å¼è§£é‡Šå¤æ‚çš„æ¦‚å¿µï¼Œé€‚åˆåˆå­¦è€…å’Œæœ‰ç»éªŒçš„åˆ†å¸ƒå¼ç³»ç»Ÿä»ä¸šè€…é˜…è¯»ã€‚\nåœ¨æ•´æœ¬ä¹¦ä¸­ï¼Œä½œè€…æä¾›äº†å„ç§å®é™…æ¡ˆä¾‹å’Œæ¡ˆä¾‹ç ”ç©¶ï¼Œä»¥è¯´æ˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®é™…åº”ç”¨å’Œå®è·µæ–¹é¢ã€‚å®ƒè¿˜å¼ºè°ƒäº†æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿæ¶‰åŠçš„æƒè¡¡å’Œè®¾è®¡è€ƒè™‘ï¼Œå¸®åŠ©è¯»è€…å…¨é¢ç†è§£è¿™ä¸ªä¸»é¢˜ã€‚\nã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹ä½œä¸ºå¼€æºèµ„æºï¼Œå¯ä»¥å…è´¹åœ¨çº¿è·å–ï¼Œéå¸¸é€‚åˆä»»ä½•å¯¹å­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿæ„Ÿå…´è¶£çš„äººã€‚\nåŸæ–‡é“¾æ¥ï¼šDistributed systems: for fun and profit\n2. æŠ½è±¡å±‚æ¬¡çš„ä¸Šä¸‹ åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨æŠ½è±¡å±‚æ¬¡ä¹‹é—´ç©¿æ¢­ï¼Œæ¢è®¨ä¸€äº›ä¸å¯èƒ½æ€§ç»“æœï¼ˆCAP å’Œ FLPï¼‰ï¼Œç„¶åå‡ºäºæ€§èƒ½è€ƒè™‘å›å½’åˆ°æ›´ä½å±‚æ¬¡ã€‚\nå¦‚æœä½ æœ‰è¿›è¡Œè¿‡ç¼–ç¨‹ï¼ŒæŠ½è±¡å±‚æ¬¡çš„æ¦‚å¿µå¯èƒ½å¯¹ä½ æ¥è¯´å¾ˆç†Ÿæ‚‰ã€‚ä½ æ€»æ˜¯åœ¨æŸä¸ªæŠ½è±¡å±‚æ¬¡ä¸Šè¿›è¡Œå·¥ä½œï¼Œé€šè¿‡æŸä¸ª API ä¸è¾ƒä½å±‚æ¬¡çš„æ¥å£è¿›è¡Œäº¤äº’ï¼Œå¹¶å¯èƒ½ä¸ºç”¨æˆ·æä¾›ä¸€äº›æ›´é«˜å±‚æ¬¡çš„ API æˆ–ç”¨æˆ·ç•Œé¢ã€‚è®¡ç®—æœºç½‘ç»œçš„ä¸ƒå±‚ OSI æ¨¡å‹å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚\nåˆ†å¸ƒå¼ç¼–ç¨‹å¾ˆå¤§ç¨‹åº¦ä¸Šæ¶‰åŠå¤„ç†åˆ†å¸ƒçš„åæœï¼ˆæ˜¾è€Œæ˜“è§ï¼ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬é¢ä¸´ç€ç°å®ä¸­å­˜åœ¨è®¸å¤šèŠ‚ç‚¹çš„ç°å®å’Œæˆ‘ä»¬å¸Œæœ›ç³»ç»Ÿâ€œåƒä¸€ä¸ªå•ä¸€ç³»ç»Ÿä¸€æ ·å·¥ä½œâ€çš„æ„¿æœ›ä¹‹é—´å­˜åœ¨ç€ç´§å¼ å…³ç³»ã€‚è¿™æ„å‘³ç€éœ€è¦æ‰¾åˆ°ä¸€ä¸ªè‰¯å¥½çš„æŠ½è±¡ï¼Œå¹³è¡¡å¯èƒ½æ€§ã€å¯ç†è§£æ€§å’Œæ€§èƒ½ã€‚\nå½“æˆ‘ä»¬è¯´ X æ¯” Y æ›´æŠ½è±¡æ—¶ï¼Œæˆ‘ä»¬æ˜¯æŒ‡ X æ²¡æœ‰å¼•å…¥ä»»ä½•ä¸ Y æ ¹æœ¬ä¸åŒçš„æ–°å†…å®¹ã€‚äº‹å®ä¸Šï¼ŒX å¯èƒ½ä¼šå»é™¤ Y çš„æŸäº›æ–¹é¢æˆ–ä»¥æ›´æ˜“äºå¤„ç†çš„æ–¹å¼å‘ˆç°å®ƒä»¬ã€‚å…¶æ¬¡ï¼ŒX åœ¨æŸç§æ„ä¹‰ä¸Šæ¯” Y æ›´å®¹æ˜“ç†è§£ï¼Œå‡è®¾ X ä» Y ä¸­å»é™¤çš„å†…å®¹å¯¹äºå½“å‰é—®é¢˜å¹¶ä¸é‡è¦ã€‚\nå¦‚å°¼é‡‡æ‰€å†™ï¼š\næ¯ä¸ªæ¦‚å¿µéƒ½æ˜¯é€šè¿‡æˆ‘ä»¬å°†ä¸ç›¸ç­‰çš„äº‹ç‰©ç­‰åŒèµ·æ¥å½¢æˆçš„ã€‚æ²¡æœ‰ä¸€ç‰‡å¶å­å®Œå…¨ç­‰åŒäºå¦ä¸€ç‰‡å¶å­ï¼Œæ¦‚å¿µâ€œå¶å­â€æ˜¯é€šè¿‡å¯¹è¿™äº›ä¸ªä½“å·®å¼‚è¿›è¡Œä»»æ„æŠ½è±¡è€Œå½¢æˆçš„ï¼Œé€šè¿‡é—å¿˜åŒºåˆ«ï¼›ç°åœ¨å®ƒäº§ç”Ÿäº†ä¸€ä¸ªæƒ³æ³•ï¼Œå³åœ¨è‡ªç„¶ç•Œä¸­å¯èƒ½å­˜åœ¨é™¤äº†å¶å­ä¹‹å¤–çš„ä¸œè¥¿ï¼Œè¿™äº›ä¸œè¥¿å°†æ˜¯â€œå¶å­â€çš„ä¸€ç§åŸå§‹å½¢å¼ - æ‰€æœ‰å¶å­éƒ½å·²ç»è¢«ç¼–ç»‡ã€æ ‡è®°ã€å¤åˆ¶ã€ç€è‰²ã€å·æ›²å’Œç»˜åˆ¶ï¼Œä½†æ˜¯ç”±äºæŠ€æœ¯ä¸ç†Ÿç»ƒï¼Œæ²¡æœ‰ä¸€ä»½å‰¯æœ¬èƒ½å¤Ÿæˆä¸ºåŸå§‹å½¢å¼çš„æ­£ç¡®ã€å¯é å’Œå¿ å®çš„å›¾åƒã€‚\næŠ½è±¡æœ¬è´¨ä¸Šæ˜¯è™šæ„çš„ã€‚æ¯ç§æƒ…å†µéƒ½æ˜¯ç‹¬ç‰¹çš„ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä½†æ˜¯æŠ½è±¡ä½¿å¾—ä¸–ç•Œå˜å¾—å¯ç®¡ç†ï¼šç®€åŒ–çš„é—®é¢˜é™ˆè¿° - ä¸å—ç°å®çº¦æŸ - æ›´æ˜“äºåˆ†æï¼Œå¹¶ä¸”åªè¦æˆ‘ä»¬æ²¡æœ‰å¿½ç•¥ä»»ä½•é‡è¦çš„ä¸œè¥¿ï¼Œè§£å†³æ–¹æ¡ˆå°±æ˜¯å¹¿æ³›é€‚ç”¨çš„ã€‚\näº‹å®ä¸Šï¼Œå¦‚æœæˆ‘ä»¬ä¿ç•™ä¸‹æ¥çš„ä¸œè¥¿æ˜¯é‡è¦çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å¾—å‡ºçš„ç»“æœå°±ä¼šå…·æœ‰å¹¿æ³›çš„é€‚ç”¨æ€§ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸å¯èƒ½æ€§ç»“æœå¦‚æ­¤é‡è¦ï¼šå®ƒä»¬é‡‡ç”¨äº†é—®é¢˜çš„æœ€ç®€å•å¯èƒ½çš„è¡¨è¿°ï¼Œå¹¶è¯æ˜åœ¨ä¸€äº›çº¦æŸæˆ–å‡è®¾æ¡ä»¶ä¸‹æ— æ³•è§£å†³è¯¥é—®é¢˜ã€‚\næ‰€æœ‰çš„æŠ½è±¡éƒ½ä¼šå¿½ç•¥ä¸€äº›ä¸ç°å®ç‹¬ç‰¹çš„ä¸œè¥¿ï¼Œä»¥ä¾¿å°†å®ƒä»¬ç­‰åŒèµ·æ¥ã€‚å…³é”®æ˜¯è¦æ‘†è„±ä¸€åˆ‡éå¿…è¦çš„ä¸œè¥¿ã€‚ä½ å¦‚ä½•çŸ¥é“ä»€ä¹ˆæ˜¯å¿…è¦çš„ï¼Ÿå—¯ï¼Œä½ å¯èƒ½äº‹å…ˆä¸çŸ¥é“ã€‚\næ¯æ¬¡æˆ‘ä»¬åœ¨ç³»ç»Ÿè§„èŒƒä¸­æ’é™¤ç³»ç»Ÿçš„æŸä¸ªæ–¹é¢æ—¶ï¼Œæˆ‘ä»¬éƒ½å­˜åœ¨å¼•å…¥é”™è¯¯å’Œ/æˆ–æ€§èƒ½é—®é¢˜çš„é£é™©ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæœ‰æ—¶æˆ‘ä»¬éœ€è¦æœç€ç›¸åçš„æ–¹å‘å‰è¿›ï¼Œå¹¶æœ‰é€‰æ‹©æ€§åœ°å¼•å…¥ä¸€äº›çœŸå®ç¡¬ä»¶å’Œç°å®ä¸–ç•Œé—®é¢˜çš„æ–¹é¢ã€‚é‡æ–°å¼•å…¥ä¸€äº›ç‰¹å®šçš„ç¡¬ä»¶ç‰¹æ€§ï¼ˆä¾‹å¦‚ç‰©ç†é¡ºåºæ€§ï¼‰æˆ–å…¶ä»–ç‰©ç†ç‰¹æ€§å¯èƒ½è¶³ä»¥è·å¾—è¶³å¤Ÿå¥½çš„æ€§èƒ½çš„ç³»ç»Ÿã€‚\nç³»ç»Ÿæ¨¡å‹ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œåˆ†å¸ƒæ˜¯ä¸€ä¸ªå…³é”®ç‰¹æ€§ã€‚å…·ä½“è€Œè¨€ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ç¨‹åºå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\nåœ¨ç‹¬ç«‹èŠ‚ç‚¹ä¸Šå¹¶å‘è¿è¡Œ\u0026hellip; é€šè¿‡å¯èƒ½å¼•å…¥éç¡®å®šæ€§å’Œæ¶ˆæ¯ä¸¢å¤±çš„ç½‘ç»œè¿æ¥\u0026hellip; æ²¡æœ‰å…±äº«å†…å­˜æˆ–å…±äº«æ—¶é’Ÿã€‚ è¿™æœ‰è®¸å¤šå«ä¹‰ï¼š\næ¯ä¸ªèŠ‚ç‚¹å¹¶å‘æ‰§è¡Œç¨‹åºã€‚ çŸ¥è¯†æ˜¯å±€éƒ¨çš„ï¼šèŠ‚ç‚¹ä»…èƒ½å¿«é€Ÿè®¿é—®æœ¬åœ°çŠ¶æ€ï¼Œå¯¹äºå…¨å±€çŠ¶æ€çš„ä»»ä½•ä¿¡æ¯éƒ½å¯èƒ½è¿‡æ—¶ã€‚ èŠ‚ç‚¹å¯ä»¥ç‹¬ç«‹å‘ç”Ÿæ•…éšœå¹¶è¿›è¡Œæ¢å¤ã€‚ æ¶ˆæ¯å¯èƒ½ä¼šå»¶è¿Ÿæˆ–ä¸¢å¤±ï¼ˆä¸èŠ‚ç‚¹æ•…éšœæ— å…³ï¼›å¾ˆéš¾åŒºåˆ†ç½‘ç»œæ•…éšœå’ŒèŠ‚ç‚¹æ•…éšœï¼‰ã€‚ è€Œä¸”èŠ‚ç‚¹ä¹‹é—´çš„æ—¶é’Ÿä¸åŒæ­¥ï¼ˆæœ¬åœ°æ—¶é—´æˆ³ä¸å…¨å±€å®é™…æ—¶é—´é¡ºåºä¸å¯¹åº”ï¼Œå¾ˆéš¾è§‚å¯Ÿåˆ°ï¼‰ã€‚ ç³»ç»Ÿæ¨¡å‹åˆ—ä¸¾äº†ä¸ç‰¹å®šç³»ç»Ÿè®¾è®¡ç›¸å…³çš„è®¸å¤šå‡è®¾ã€‚\nç³»ç»Ÿæ¨¡å‹æ˜¯å…³äºå®ç°åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç¯å¢ƒå’Œè®¾æ–½çš„ä¸€ç»„å‡è®¾ã€‚\nç³»ç»Ÿæ¨¡å‹åœ¨å…¶å¯¹ç¯å¢ƒå’Œè®¾æ–½çš„å‡è®¾æ–¹é¢å­˜åœ¨å·®å¼‚ã€‚è¿™äº›å‡è®¾åŒ…æ‹¬ï¼š\nèŠ‚ç‚¹çš„èƒ½åŠ›å’Œæ•…éšœæ–¹å¼ é€šä¿¡é“¾è·¯çš„æ“ä½œæ–¹å¼ä»¥åŠå¯èƒ½çš„æ•…éšœæ–¹å¼ æ•´ä¸ªç³»ç»Ÿçš„å±æ€§ï¼Œä¾‹å¦‚æœ‰å…³æ—¶é—´å’Œé¡ºåºçš„å‡è®¾ å¥å£®çš„ç³»ç»Ÿæ¨¡å‹æ˜¯å¯¹å‡è®¾æœ€å¼±çš„æ¨¡å‹ï¼šé’ˆå¯¹è¿™ç§ç³»ç»Ÿç¼–å†™çš„ä»»ä½•ç®—æ³•éƒ½å¯¹ä¸åŒçš„ç¯å¢ƒéå¸¸å®¹å¿ï¼Œå› ä¸ºå®ƒæœ‰éå¸¸å°‘ä¸”éå¸¸å¼±çš„å‡è®¾ã€‚\nå¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿›è¡Œå¼ºå‡è®¾æ¥åˆ›å»ºä¸€ä¸ªæ˜“äºæ¨ç†çš„ç³»ç»Ÿæ¨¡å‹ã€‚ä¾‹å¦‚ï¼Œå‡è®¾èŠ‚ç‚¹ä¸ä¼šå‘ç”Ÿæ•…éšœæ„å‘³ç€æˆ‘ä»¬çš„ç®—æ³•ä¸éœ€è¦å¤„ç†èŠ‚ç‚¹æ•…éšœã€‚ç„¶è€Œï¼Œè¿™æ ·çš„ç³»ç»Ÿæ¨¡å‹æ˜¯ä¸ç°å®çš„ï¼Œå› æ­¤åœ¨å®è·µä¸­å¾ˆéš¾åº”ç”¨ã€‚\nè®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°çœ‹ä¸€ä¸‹èŠ‚ç‚¹ã€é“¾è·¯ã€æ—¶é—´å’Œé¡ºåºçš„å±æ€§ã€‚\næˆ‘ä»¬ç³»ç»Ÿæ¨¡å‹ä¸­çš„èŠ‚ç‚¹ èŠ‚ç‚¹ä½œä¸ºè®¡ç®—å’Œå­˜å‚¨çš„ä¸»æœºã€‚å®ƒä»¬å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\nèƒ½å¤Ÿæ‰§è¡Œç¨‹åºã€‚ èƒ½å¤Ÿå°†æ•°æ®å­˜å‚¨åˆ°æ˜“å¤±æ€§å†…å­˜ï¼ˆåœ¨æ•…éšœæ—¶å¯èƒ½ä¸¢å¤±ï¼‰å’Œç¨³å®šçŠ¶æ€ï¼ˆåœ¨æ•…éšœåå¯ä»¥è¯»å–ï¼‰ã€‚ æ—¶é’Ÿï¼ˆå¯ä»¥è¢«å‡è®¾ä¸ºå‡†ç¡®æˆ–ä¸å‡†ç¡®ï¼‰ã€‚ èŠ‚ç‚¹æ‰§è¡Œç¡®å®šæ€§ç®—æ³•ï¼šå±€éƒ¨è®¡ç®—ã€è®¡ç®—åçš„æœ¬åœ°çŠ¶æ€å’Œå‘é€çš„æ¶ˆæ¯æ˜¯æ ¹æ®æ¥æ”¶åˆ°çš„æ¶ˆæ¯å’Œæ¥æ”¶æ¶ˆæ¯æ—¶çš„æœ¬åœ°çŠ¶æ€å”¯ä¸€ç¡®å®šçš„ã€‚\næœ‰è®¸å¤šå¯èƒ½çš„æ•…éšœæ¨¡å‹æè¿°äº†èŠ‚ç‚¹å¯èƒ½å‘ç”Ÿçš„æ•…éšœæ–¹å¼ã€‚åœ¨å®è·µä¸­ï¼Œå¤§å¤šæ•°ç³»ç»Ÿå‡è®¾ä½¿ç”¨å´©æºƒæ¢å¤æ•…éšœæ¨¡å‹ï¼šä¹Ÿå°±æ˜¯è¯´ï¼ŒèŠ‚ç‚¹åªèƒ½é€šè¿‡å´©æºƒæ¥å‘ç”Ÿæ•…éšœï¼Œå¹¶ä¸”å¯ä»¥åœ¨ç¨åæŸä¸ªæ—¶é—´ç‚¹ï¼ˆå¯èƒ½ï¼‰è¿›è¡Œæ¢å¤ã€‚\nå¦ä¸€ç§é€‰æ‹©æ˜¯å‡è®¾èŠ‚ç‚¹å¯ä»¥ä»¥ä»»æ„æ–¹å¼å‘ç”Ÿæ•…éšœã€‚è¿™è¢«ç§°ä¸ºæ‹œå åº­å®¹é”™ã€‚æ‹œå åº­æ•…éšœåœ¨å®é™…çš„å•†ä¸šç³»ç»Ÿä¸­å¾ˆå°‘å¤„ç†ï¼Œå› ä¸ºå¯¹ä»»æ„æ•…éšœå…·æœ‰å¼¹æ€§çš„ç®—æ³•è¿è¡Œæˆæœ¬æ›´é«˜ï¼Œå®ç°æ›´å¤æ‚ã€‚åœ¨è¿™é‡Œæˆ‘ä¸ä¼šè®¨è®ºæ‹œå åº­å®¹é”™ã€‚\næˆ‘ä»¬ç³»ç»Ÿæ¨¡å‹ä¸­çš„é€šä¿¡é“¾è·¯ é€šä¿¡é“¾æ¥å°†å„ä¸ªèŠ‚ç‚¹å½¼æ­¤è¿æ¥ï¼Œå¹¶å…è®¸æ¶ˆæ¯åœ¨ä»»æ„æ–¹å‘ä¸Šå‘é€ã€‚è®¸å¤šè®¨è®ºåˆ†å¸ƒå¼ç®—æ³•çš„ä¹¦ç±å‡è®¾æ¯å¯¹èŠ‚ç‚¹ä¹‹é—´éƒ½æœ‰ç‹¬ç«‹çš„é“¾æ¥ï¼Œè¿™äº›é“¾æ¥ä¸ºæ¶ˆæ¯æä¾›äº†å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„é¡ºåºï¼Œåªèƒ½ä¼ é€’å·²å‘é€çš„æ¶ˆæ¯ï¼Œå¹¶ä¸”å·²å‘é€çš„æ¶ˆæ¯å¯èƒ½ä¼šä¸¢å¤±ã€‚\næŸäº›ç®—æ³•å‡è®¾ç½‘ç»œæ˜¯å¯é çš„ï¼šæ¶ˆæ¯æ°¸è¿œä¸ä¼šä¸¢å¤±ï¼Œä¹Ÿä¸ä¼šæ— é™æœŸåœ°å»¶è¿Ÿã€‚è¿™åœ¨æŸäº›å®é™…æƒ…å†µä¸‹å¯èƒ½æ˜¯åˆç†çš„å‡è®¾ï¼Œä½†ä¸€èˆ¬æ¥è¯´ï¼Œæ›´å€¾å‘äºå°†ç½‘ç»œè§†ä¸ºä¸å¯é çš„ï¼Œå¯èƒ½ä¼šå‘ç”Ÿæ¶ˆæ¯ä¸¢å¤±å’Œå»¶è¿Ÿçš„æƒ…å†µã€‚\nå½“ç½‘ç»œå‘ç”Ÿæ•…éšœè€ŒèŠ‚ç‚¹æœ¬èº«ä»å¯è¿è¡Œæ—¶ï¼Œå°±ä¼šå‘ç”Ÿç½‘ç»œåˆ†åŒºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯å¯èƒ½ä¼šä¸¢å¤±æˆ–å»¶è¿Ÿï¼Œç›´åˆ°ç½‘ç»œåˆ†åŒºè¢«ä¿®å¤ã€‚åˆ†åŒºçš„èŠ‚ç‚¹å¯èƒ½å¯¹æŸäº›å®¢æˆ·ç«¯æ˜¯å¯è®¿é—®çš„ï¼Œå› æ­¤å¿…é¡»ä¸å´©æºƒçš„èŠ‚ç‚¹è¿›è¡Œä¸åŒå¤„ç†ã€‚ä¸‹å›¾è¯´æ˜äº†èŠ‚ç‚¹æ•…éšœå’Œç½‘ç»œåˆ†åŒºçš„åŒºåˆ«ï¼š\né€šå¸¸å¾ˆå°‘å¯¹é€šä¿¡é“¾æ¥åšè¿›ä¸€æ­¥çš„å‡è®¾ã€‚æˆ‘ä»¬å¯ä»¥å‡è®¾é“¾æ¥åªèƒ½å•å‘å·¥ä½œï¼Œæˆ–è€…å¯ä»¥ä¸ºä¸åŒçš„é“¾æ¥å¼•å…¥ä¸åŒçš„é€šä¿¡æˆæœ¬ï¼ˆä¾‹å¦‚ç”±äºç‰©ç†è·ç¦»å¼•èµ·çš„å»¶è¿Ÿï¼‰ã€‚ç„¶è€Œï¼Œåœ¨å•†ä¸šç¯å¢ƒä¸­ï¼Œé™¤äº†é•¿è·ç¦»é“¾æ¥ï¼ˆå¹¿åŸŸç½‘å»¶è¿Ÿï¼‰ä¹‹å¤–ï¼Œè¿™äº›å¾ˆå°‘æ˜¯å…³æ³¨çš„é—®é¢˜ï¼Œå› æ­¤æˆ‘åœ¨è¿™é‡Œä¸ä¼šè®¨è®ºå®ƒä»¬ï¼›æˆæœ¬å’Œæ‹“æ‰‘çš„æ›´è¯¦ç»†æ¨¡å‹å¯ä»¥åœ¨å¤æ‚æ€§çš„ä»£ä»·ä¸‹å®ç°æ›´å¥½çš„ä¼˜åŒ–ã€‚\næ—¶é—´/é¡ºåºå‡è®¾ ç‰©ç†åˆ†å¸ƒçš„ä¸€ä¸ªç»“æœæ˜¯æ¯ä¸ªèŠ‚ç‚¹ä»¥ç‹¬ç‰¹çš„æ–¹å¼ä½“éªŒä¸–ç•Œã€‚è¿™æ˜¯æ— æ³•é¿å…çš„ï¼Œå› ä¸ºä¿¡æ¯åªèƒ½ä»¥å…‰é€Ÿä¼ æ’­ã€‚å¦‚æœèŠ‚ç‚¹ä¹‹é—´çš„è·ç¦»ä¸åŒï¼Œé‚£ä¹ˆä»ä¸€ä¸ªèŠ‚ç‚¹å‘é€åˆ°å…¶ä»–èŠ‚ç‚¹çš„ä»»ä½•æ¶ˆæ¯éƒ½ä¼šåœ¨å…¶ä»–èŠ‚ç‚¹ä»¥ä¸åŒçš„æ—¶é—´åˆ°è¾¾ï¼Œå¹¶æœ‰å¯èƒ½ä»¥ä¸åŒçš„é¡ºåºåˆ°è¾¾ã€‚\næ—¶é—´å‡è®¾æ˜¯æ•æ‰æˆ‘ä»¬åœ¨å¤šå¤§ç¨‹åº¦ä¸Šè€ƒè™‘è¿™ä¸ªç°å®çš„ä¾¿æ·æ–¹å¼ã€‚ä¸»è¦çš„ä¸¤ç§é€‰æ‹©æ˜¯ï¼š\nåŒæ­¥ç³»ç»Ÿæ¨¡å‹ã€‚è¿›ç¨‹ä»¥åŒæ­¥æ–¹å¼æ‰§è¡Œï¼›æ¶ˆæ¯ä¼ è¾“å»¶è¿Ÿæœ‰å·²çŸ¥çš„ä¸Šç•Œï¼›æ¯ä¸ªè¿›ç¨‹å…·æœ‰å‡†ç¡®çš„æ—¶é’Ÿã€‚ å¼‚æ­¥ç³»ç»Ÿæ¨¡å‹ã€‚æ²¡æœ‰æ—¶é—´å‡è®¾ - ä¾‹å¦‚è¿›ç¨‹ä»¥ç‹¬ç«‹çš„é€Ÿç‡æ‰§è¡Œï¼›æ¶ˆæ¯ä¼ è¾“å»¶è¿Ÿæ²¡æœ‰ä¸Šç•Œï¼›æ²¡æœ‰å¯é çš„æ—¶é’Ÿå­˜åœ¨ã€‚ åŒæ­¥ç³»ç»Ÿæ¨¡å‹å¯¹æ—¶é—´å’Œé¡ºåºæ–½åŠ äº†è®¸å¤šé™åˆ¶ã€‚å®ƒåŸºæœ¬ä¸Šå‡è®¾èŠ‚ç‚¹æœ‰ç›¸åŒçš„ä½“éªŒï¼šå‘é€çš„æ¶ˆæ¯æ€»æ˜¯åœ¨ç‰¹å®šçš„æœ€å¤§ä¼ è¾“å»¶è¿Ÿå†…æ¥æ”¶ï¼Œå¹¶ä¸”è¿›ç¨‹ä»¥åŒæ­¥æ–¹å¼æ‰§è¡Œã€‚è¿™å¾ˆæ–¹ä¾¿ï¼Œå› ä¸ºå®ƒå…è®¸æ‚¨ä½œä¸ºç³»ç»Ÿè®¾è®¡è€…å¯¹æ—¶é—´å’Œé¡ºåºåšå‡ºå‡è®¾ï¼Œè€Œå¼‚æ­¥ç³»ç»Ÿæ¨¡å‹åˆ™ä¸å…è®¸ã€‚\nå¼‚æ­¥æ€§æ˜¯ä¸€ç§éå‡è®¾ï¼šå®ƒåªæ˜¯å‡è®¾æ‚¨ä¸èƒ½ä¾èµ–äºæ—¶é—´ï¼ˆæˆ–â€œæ—¶é—´ä¼ æ„Ÿå™¨â€ï¼‰ã€‚","title":"[è¯‘]ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹2.æŠ½è±¡å±‚æ¬¡çš„ä¸Šä¸‹"},{"content":" ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹æ˜¯ä¸€æœ¬å¹¿å—æ¬¢è¿çš„èµ„æºï¼Œç”¨äºç†è§£å’Œå­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿã€‚è¯¥ä¹¦ç”±ä½œè€… Mikito Takada æ’°å†™ï¼Œä»‹ç»äº†æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºæœ¬æ¦‚å¿µã€åŸåˆ™å’ŒæŒ‘æˆ˜ã€‚\nè¿™æœ¬ä¹¦æ¶µç›–äº†ä¸åˆ†å¸ƒå¼ç³»ç»Ÿç›¸å…³çš„å¹¿æ³›ä¸»é¢˜ï¼ŒåŒ…æ‹¬ç½‘ç»œã€å®¹é”™æ€§ã€ä¸€è‡´æ€§æ¨¡å‹ã€åˆ†å¸ƒå¼ç®—æ³•ã€å¯æ‰©å±•æ€§ç­‰ç­‰ã€‚å®ƒæ—¨åœ¨ä»¥æ¸…æ™°æ˜“æ‡‚çš„æ–¹å¼è§£é‡Šå¤æ‚çš„æ¦‚å¿µï¼Œé€‚åˆåˆå­¦è€…å’Œæœ‰ç»éªŒçš„åˆ†å¸ƒå¼ç³»ç»Ÿä»ä¸šè€…é˜…è¯»ã€‚\nåœ¨æ•´æœ¬ä¹¦ä¸­ï¼Œä½œè€…æä¾›äº†å„ç§å®é™…æ¡ˆä¾‹å’Œæ¡ˆä¾‹ç ”ç©¶ï¼Œä»¥è¯´æ˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®é™…åº”ç”¨å’Œå®è·µæ–¹é¢ã€‚å®ƒè¿˜å¼ºè°ƒäº†æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿæ¶‰åŠçš„æƒè¡¡å’Œè®¾è®¡è€ƒè™‘ï¼Œå¸®åŠ©è¯»è€…å…¨é¢ç†è§£è¿™ä¸ªä¸»é¢˜ã€‚\nã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹ä½œä¸ºå¼€æºèµ„æºï¼Œå¯ä»¥å…è´¹åœ¨çº¿è·å–ï¼Œéå¸¸é€‚åˆä»»ä½•å¯¹å­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿæ„Ÿå…´è¶£çš„äººã€‚\nåŸæ–‡é“¾æ¥ï¼šDistributed systems: for fun and profit\n1. é«˜å±‚åˆ†å¸ƒå¼ç³»ç»Ÿ åˆ†å¸ƒå¼ç¼–ç¨‹æ˜¯åˆ©ç”¨å¤šå°è®¡ç®—æœºè§£å†³åœ¨å•å°è®¡ç®—æœºä¸Šå¯ä»¥è§£å†³çš„ç›¸åŒé—®é¢˜çš„ä¸€ç§æŠ€æœ¯ã€‚\nä»»ä½•è®¡ç®—æœºç³»ç»Ÿéƒ½éœ€è¦å®Œæˆä¸¤ä¸ªåŸºæœ¬ä»»åŠ¡ï¼š\nå­˜å‚¨ è®¡ç®— åˆ†å¸ƒå¼ç¼–ç¨‹æ˜¯ä¸€ç§è‰ºæœ¯ï¼Œé€šè¿‡åˆ©ç”¨å¤šå°è®¡ç®—æœºè§£å†³åœ¨å•å°è®¡ç®—æœºä¸Šå¯ä»¥è§£å†³çš„ç›¸åŒé—®é¢˜ï¼Œé€šå¸¸æ˜¯å› ä¸ºè¯¥é—®é¢˜å·²ç»è¶…å‡ºäº†å•å°è®¡ç®—æœºçš„å¤„ç†èƒ½åŠ›ã€‚\nå®é™…ä¸Šï¼Œå¹¶æ²¡æœ‰å¼ºåˆ¶è¦æ±‚æˆ‘ä»¬ä½¿ç”¨åˆ†å¸ƒå¼ç³»ç»Ÿã€‚å¦‚æœæ‹¥æœ‰æ— é™çš„èµ„é‡‘å’Œæ— é™çš„ç ”å‘æ—¶é—´ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦åˆ†å¸ƒå¼ç³»ç»Ÿã€‚æ‰€æœ‰çš„è®¡ç®—å’Œå­˜å‚¨å¯ä»¥åœ¨ä¸€ä¸ªé­”ç›’ä¸Šå®Œæˆï¼Œè¿™æ˜¯ä¸€å°å•ä¸€çš„ã€æå…¶å¿«é€Ÿå’Œå¯é çš„ç³»ç»Ÿï¼Œä½ å¯ä»¥æ”¯ä»˜ç»™åˆ«äººæ¥ä¸ºä½ è®¾è®¡ã€‚\nç„¶è€Œï¼Œå¾ˆå°‘æœ‰äººæ‹¥æœ‰æ— é™çš„èµ„æºã€‚å› æ­¤ï¼Œä»–ä»¬å¿…é¡»åœ¨ç°å®ä¸–ç•Œçš„æˆæœ¬æ•ˆç›Šæ›²çº¿ä¸Šæ‰¾åˆ°åˆé€‚çš„ä½ç½®ã€‚åœ¨å°è§„æ¨¡æƒ…å†µä¸‹ï¼Œå‡çº§ç¡¬ä»¶æ˜¯ä¸€ç§å¯è¡Œçš„ç­–ç•¥ã€‚ç„¶è€Œï¼Œéšç€é—®é¢˜è§„æ¨¡çš„å¢åŠ ï¼Œä½ ä¼šè¾¾åˆ°ä¸€ä¸ªé˜¶æ®µï¼Œåœ¨è¿™ä¸ªé˜¶æ®µï¼Œè¦ä¹ˆä¸å­˜åœ¨å¯ä»¥è®©ä½ åœ¨å•ä¸ªèŠ‚ç‚¹ä¸Šè§£å†³é—®é¢˜çš„ç¡¬ä»¶å‡çº§ï¼Œè¦ä¹ˆæˆæœ¬è¿‡é«˜ã€‚åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘æ¬¢è¿ä½ è¿›å…¥åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸–ç•Œã€‚\nå½“å‰çš„ç°å®æ˜¯ï¼Œåªè¦é€šè¿‡å®¹é”™è½¯ä»¶å°†ç»´æŠ¤æˆæœ¬æ§åˆ¶åœ¨è¾ƒä½æ°´å¹³ï¼Œä¸­æ¡£ã€å¤§ä¼—åŒ–ç¡¬ä»¶æä¾›äº†æœ€ä½³çš„æ€§ä»·æ¯”ã€‚\nè®¡ç®—ä¸»è¦å—ç›Šäºé«˜ç«¯ç¡¬ä»¶ï¼Œå°¤å…¶æ˜¯åœ¨èƒ½å¤Ÿé€šè¿‡å†…éƒ¨å†…å­˜è®¿é—®å–ä»£ç¼“æ…¢çš„ç½‘ç»œè®¿é—®æ—¶ã€‚åœ¨éœ€è¦èŠ‚ç‚¹é—´å¤§é‡é€šä¿¡çš„ä»»åŠ¡ä¸­ï¼Œé«˜ç«¯ç¡¬ä»¶çš„æ€§èƒ½ä¼˜åŠ¿æœ‰é™ã€‚\næ­£å¦‚ Barrosoã€Clidaras å’Œ HÃ¶lzle çš„ä¸Šå›¾æ‰€ç¤ºï¼Œå‡è®¾æ‰€æœ‰èŠ‚ç‚¹éƒ½é‡‡ç”¨ç»Ÿä¸€çš„å†…å­˜è®¿é—®æ¨¡å¼ï¼Œé«˜ç«¯ç¡¬ä»¶å’Œå•†ç”¨ç¡¬ä»¶ä¹‹é—´çš„æ€§èƒ½å·®è·ä¼šéšç€é›†ç¾¤è§„æ¨¡çš„æ‰©å¤§è€Œç¼©å°ã€‚\nç†æƒ³æƒ…å†µä¸‹ï¼Œæ·»åŠ ä¸€å°æ–°çš„æœºå™¨å°†çº¿æ€§å¢åŠ ç³»ç»Ÿçš„æ€§èƒ½å’Œå®¹é‡ã€‚ä½†æ˜¯ï¼Œç°å®æƒ…å†µå¹¶éå¦‚æ­¤ï¼Œå› ä¸ºç”±äºå­˜åœ¨ç‹¬ç«‹çš„è®¡ç®—æœºï¼Œä¼šäº§ç”Ÿä¸€äº›å¼€é”€ã€‚æ•°æ®éœ€è¦åœ¨è®¡ç®—æœºä¹‹é—´è¿›è¡Œå¤åˆ¶ï¼Œè®¡ç®—ä»»åŠ¡éœ€è¦è¿›è¡Œåè°ƒç­‰ç­‰ã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå€¼å¾—ç ”ç©¶åˆ†å¸ƒå¼ç®—æ³•çš„åŸå› â€”â€”å®ƒä»¬æä¾›äº†é’ˆå¯¹ç‰¹å®šé—®é¢˜çš„é«˜æ•ˆè§£å†³æ–¹æ¡ˆï¼Œä»¥åŠå…³äºå¯èƒ½æ€§ã€æ­£ç¡®å®ç°çš„æœ€ä½æˆæœ¬ä»¥åŠä¸å¯èƒ½æ€§çš„æŒ‡å¯¼ã€‚\nè¿™æ®µæ–‡å­—çš„é‡ç‚¹æ˜¯åœ¨ä¸€ä¸ªå¹³å‡¡ä½†å•†ä¸šç›¸å…³çš„ç¯å¢ƒä¸­ï¼Œå³æ•°æ®ä¸­å¿ƒçš„åˆ†å¸ƒå¼ç¼–ç¨‹å’Œç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œæˆ‘ä¸ä¼šè®¨è®ºç”±äºå…·æœ‰å¼‚ä¹å¯»å¸¸çš„ç½‘ç»œé…ç½®æˆ–åœ¨å…±äº«å†…å­˜è®¾ç½®ä¸­å‡ºç°çš„ä¸“é—¨é—®é¢˜ã€‚æ­¤å¤–ï¼Œé‡ç‚¹æ˜¯æ¢ç´¢ç³»ç»Ÿè®¾è®¡ç©ºé—´ï¼Œè€Œä¸æ˜¯ä¼˜åŒ–ä»»ä½•ç‰¹å®šè®¾è®¡â€”â€”åè€…æ˜¯ä¸€ä¸ªæ›´ä¸“é—¨çš„æ–‡æœ¬ä¸»é¢˜ã€‚\næˆ‘ä»¬æƒ³è¦å®ç°çš„ç›®æ ‡ï¼šå¯æ‰©å±•æ€§å’Œå…¶ä»–å¥½çš„ä¸œè¥¿ ä»æˆ‘çœ‹æ¥ï¼Œä¸€åˆ‡éƒ½å§‹äºå¤„ç†è§„æ¨¡çš„éœ€æ±‚ã€‚\nåœ¨å°è§„æ¨¡ä¸‹ï¼Œå¤§å¤šæ•°äº‹æƒ…éƒ½æ˜¯å¾®ä¸è¶³é“çš„ï¼Œè€ŒåŒæ ·çš„é—®é¢˜ä¸€æ—¦è¶…è¿‡ä¸€å®šçš„å¤§å°ã€å®¹é‡æˆ–å…¶ä»–ç‰©ç†é™åˆ¶ï¼Œå°±ä¼šå˜å¾—æ›´åŠ å›°éš¾ã€‚ä¸¾èµ·ä¸€å—å·§å…‹åŠ›å¾ˆå®¹æ˜“ï¼Œä½†ä¸¾èµ·ä¸€åº§å±±å°±å¾ˆå›°éš¾ã€‚æ•°ä¸€ä¸‹æˆ¿é—´é‡Œæœ‰å¤šå°‘äººå¾ˆå®¹æ˜“ï¼Œä½†æ•°ä¸€ä¸‹å›½å®¶é‡Œæœ‰å¤šå°‘äººå°±å¾ˆéš¾ã€‚\næ‰€ä»¥ä¸€åˆ‡éƒ½å§‹äºè§„æ¨¡â€”â€”å¯æ‰©å±•æ€§ã€‚éæ­£å¼åœ°è¯´ï¼Œåœ¨ä¸€ä¸ªå¯æ‰©å±•çš„ç³»ç»Ÿä¸­ï¼Œå½“æˆ‘ä»¬ä»å°è§„æ¨¡å‘å¤§è§„æ¨¡è¿‡æ¸¡æ—¶ï¼Œäº‹æƒ…ä¸åº”è¯¥é€æ¸å˜å¾—æ›´ç³Ÿã€‚ä»¥ä¸‹æ˜¯å¦ä¸€ç§å®šä¹‰ï¼š\nå¯æ‰©å±•æ€§æ˜¯æŒ‡ç³»ç»Ÿã€ç½‘ç»œæˆ–è¿›ç¨‹å¤„ç†ä¸æ–­å¢é•¿çš„å·¥ä½œè´Ÿè½½çš„èƒ½åŠ›ï¼Œæˆ–è€…è¯´å®ƒèƒ½å¤Ÿè¢«æ‰©å¤§ä»¥é€‚åº”è¿™ç§å¢é•¿çš„èƒ½åŠ›ã€‚\nä»€ä¹ˆæ˜¯åœ¨å¢é•¿å‘¢ï¼Ÿå—¯ï¼Œä½ å¯ä»¥ç”¨å‡ ä¹ä»»ä½•æ–¹å¼æ¥è¡¡é‡å¢é•¿ï¼ˆäººæ•°ã€ç”¨ç”µé‡ç­‰ï¼‰ã€‚ä½†æœ‰ä¸‰ä¸ªç‰¹åˆ«æœ‰è¶£çš„æ–¹é¢å€¼å¾—å…³æ³¨ï¼š\nè§„æ¨¡å¯æ‰©å±•æ€§ï¼šå¢åŠ æ›´å¤šèŠ‚ç‚¹åº”è¯¥ä½¿ç³»ç»Ÿçº¿æ€§åŠ å¿«ï¼›å¢åŠ æ•°æ®é›†çš„å¤§å°ä¸åº”å¢åŠ å»¶è¿Ÿã€‚ åœ°ç†å¯æ‰©å±•æ€§ï¼šåº”è¯¥å¯ä»¥åˆ©ç”¨å¤šä¸ªæ•°æ®ä¸­å¿ƒæ¥ç¼©çŸ­å“åº”ç”¨æˆ·æŸ¥è¯¢æ‰€éœ€çš„æ—¶é—´ï¼ŒåŒæ—¶ä»¥æŸç§åˆç†çš„æ–¹å¼å¤„ç†è·¨æ•°æ®ä¸­å¿ƒçš„å»¶è¿Ÿã€‚ ç®¡ç†å¯æ‰©å±•æ€§ï¼šæ·»åŠ æ›´å¤šèŠ‚ç‚¹ä¸åº”å¢åŠ ç³»ç»Ÿçš„ç®¡ç†æˆæœ¬ï¼ˆä¾‹å¦‚ç®¡ç†å‘˜ä¸æœºå™¨çš„æ¯”ç‡ï¼‰ã€‚ å½“ç„¶ï¼Œåœ¨çœŸå®çš„ç³»ç»Ÿä¸­ï¼Œå¢é•¿åŒæ—¶å‘ç”Ÿåœ¨å¤šä¸ªä¸åŒçš„è½´ä¸Šï¼›æ¯ä¸ªæŒ‡æ ‡ä»…åæ˜ å¢é•¿çš„æŸäº›æ–¹é¢ã€‚\nå¯æ‰©å±•çš„ç³»ç»Ÿæ˜¯ä¸€ç§éšç€è§„æ¨¡çš„å¢åŠ è€ŒæŒç»­æ»¡è¶³ç”¨æˆ·éœ€æ±‚çš„ç³»ç»Ÿã€‚æœ‰ä¸¤ä¸ªç‰¹åˆ«ç›¸å…³çš„æ–¹é¢â€”â€”æ€§èƒ½å’Œå¯ç”¨æ€§â€”â€”å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼æ¥è¡¡é‡ã€‚\næ€§èƒ½ï¼ˆå’Œå»¶è¿Ÿï¼‰ æ€§èƒ½æ˜¯æŒ‡è®¡ç®—æœºç³»ç»Ÿåœ¨ä½¿ç”¨çš„æ—¶é—´å’Œèµ„æºç›¸å¯¹äºæ‰€å®Œæˆçš„æœ‰ç”¨å·¥ä½œé‡æ¥è¡¡é‡çš„ç‰¹å¾ã€‚\næ ¹æ®å…·ä½“æƒ…å†µï¼Œè¿™å¯èƒ½æ¶‰åŠå®ç°ä»¥ä¸‹ä¸€é¡¹æˆ–å¤šé¡¹ï¼š\nå¯¹äºç»™å®šçš„å·¥ä½œï¼Œå“åº”æ—¶é—´çŸ­/å»¶è¿Ÿä½ é«˜ååé‡ï¼ˆå¤„ç†å·¥ä½œç‡ï¼‰ è®¡ç®—èµ„æºåˆ©ç”¨ç‡ä½ é’ˆå¯¹ä»»ä½•è¿™äº›ç»“æœè¿›è¡Œä¼˜åŒ–éƒ½éœ€è¦æƒè¡¡ã€‚ä¾‹å¦‚ï¼Œç³»ç»Ÿå¯ä»¥é€šè¿‡å¤„ç†æ›´å¤§æ‰¹é‡çš„å·¥ä½œæ¥å®ç°æ›´é«˜çš„ååé‡ï¼Œä»è€Œå‡å°‘æ“ä½œå¼€é”€ã€‚ç”±äºæ‰¹å¤„ç†ï¼Œæƒè¡¡å°†æ˜¯ä¸ªåˆ«å·¥ä½œçš„å“åº”æ—¶é—´æ›´é•¿ã€‚\næˆ‘å‘ç°ä½å»¶è¿Ÿï¼ˆå®ç°è¾ƒçŸ­çš„å“åº”æ—¶é—´ï¼‰æ˜¯æ€§èƒ½ä¸­æœ€æœ‰è¶£çš„æ–¹é¢ï¼Œå› ä¸ºå®ƒä¸ç‰©ç†ï¼ˆè€Œä¸æ˜¯è´¢åŠ¡ï¼‰é™åˆ¶å¯†åˆ‡ç›¸å…³ã€‚ä½¿ç”¨è´¢åŠ¡èµ„æºæ¥è§£å†³å»¶è¿Ÿé—®é¢˜æ¯”æ€§èƒ½çš„å…¶ä»–æ–¹é¢æ›´éš¾ã€‚\nå¯¹äºå»¶è¿Ÿæœ‰å¾ˆå¤šéå¸¸å…·ä½“çš„å®šä¹‰ï¼Œä½†æˆ‘çœŸçš„å¾ˆå–œæ¬¢è¿™ä¸ªè¯çš„è¯æºæ‰€å”¤èµ·çš„æƒ³æ³•ï¼š\nå»¶è¿Ÿæ˜¯æŒ‡æ½œä¼çŠ¶æ€ï¼Œå»¶è¿Ÿçš„æˆ–åœ¨æŸäº‹ç‰©å¼€å§‹å’Œå‘ç”Ÿä¹‹é—´çš„ä¸€æ®µæ—¶é—´ã€‚\nâ€œæ½œåœ¨çš„â€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ\næ½œåœ¨çš„æ˜¯æŒ‡æŸç‰©å­˜åœ¨æˆ–å‡ºç°ï¼Œä½†è¢«éšè—ã€éšè”½æˆ–å¤„äºä¸æ´»åŠ¨çŠ¶æ€ã€‚å®ƒæè¿°äº†ä¸€ç§å­˜åœ¨å´ä¸å®¹æ˜“å¯Ÿè§‰æˆ–å¯è§çš„çŠ¶æ€ï¼Œä½†å®ƒä»ä»¥éšè—æˆ–æ½œåœ¨çš„å½¢å¼å­˜åœ¨ã€‚\nè¿™ä¸ªå®šä¹‰éå¸¸é…·ï¼Œå› ä¸ºå®ƒå¼ºè°ƒäº†å»¶è¿Ÿæ˜¯æŒ‡æŸä»¶äº‹å‘ç”Ÿåˆ°å®ƒäº§ç”Ÿå½±å“æˆ–å˜å¾—å¯è§ä¹‹é—´çš„æ—¶é—´ã€‚\nä¾‹å¦‚ï¼Œå‡è®¾æ‚¨æ„ŸæŸ“äº†ä¸€ç§ç©ºæ°”ä¼ æ’­çš„ç—…æ¯’ï¼Œè¯¥ç—…æ¯’ä¼šå°†äººå˜æˆåƒµå°¸ã€‚æ½œä¼æœŸæ˜¯æŒ‡ä»ä½ è¢«æ„ŸæŸ“åˆ°å˜æˆåƒµå°¸ä¹‹é—´çš„æ—¶é—´ã€‚è¿™å°±æ˜¯æ½œä¼æœŸï¼šå·²ç»å‘ç”Ÿçš„äº‹æƒ…è¢«éšè—èµ·æ¥çš„æ—¶é—´ã€‚\nè®©æˆ‘ä»¬å‡è®¾æˆ‘ä»¬çš„åˆ†å¸ƒå¼ç³»ç»Ÿåªæ‰§è¡Œä¸€é¡¹é«˜çº§ä»»åŠ¡ï¼šç»™å®šä¸€ä¸ªæŸ¥è¯¢ï¼Œå®ƒä¼šè·å–ç³»ç»Ÿä¸­çš„æ‰€æœ‰æ•°æ®å¹¶è®¡ç®—ä¸€ä¸ªç»“æœã€‚æ¢å¥è¯è¯´ï¼Œå°†åˆ†å¸ƒå¼ç³»ç»Ÿè§†ä¸ºä¸€ä¸ªæ•°æ®å­˜å‚¨ï¼Œèƒ½å¤Ÿå¯¹å…¶å½“å‰å†…å®¹è¿è¡Œå•ä¸ªç¡®å®šæ€§è®¡ç®—ï¼ˆå‡½æ•°ï¼‰ï¼š\nresult = query(all data in the system) é‚£ä¹ˆï¼Œå¯¹å»¶è¿Ÿæ¥è¯´é‡è¦çš„ä¸æ˜¯æ—§æ•°æ®çš„æ•°é‡ï¼Œè€Œæ˜¯æ–°æ•°æ®åœ¨ç³»ç»Ÿä¸­â€œç”Ÿæ•ˆâ€çš„é€Ÿåº¦ã€‚ä¾‹å¦‚ï¼Œå»¶è¿Ÿå¯ä»¥æ ¹æ®å†™å…¥å¯¹è¯»è€…å¯è§æ‰€éœ€çš„æ—¶é—´æ¥è¡¡é‡ã€‚\nåŸºäºè¿™ä¸ªå®šä¹‰çš„å¦ä¸€ä¸ªå…³é”®ç‚¹æ˜¯ï¼Œå¦‚æœä»€ä¹ˆéƒ½æ²¡æœ‰å‘ç”Ÿï¼Œå°±æ²¡æœ‰â€œæ½œä¼æœŸâ€ã€‚æ•°æ®ä¸æ”¹å˜çš„ç³»ç»Ÿä¸ä¼šï¼ˆæˆ–ä¸åº”è¯¥ï¼‰å­˜åœ¨å»¶è¿Ÿé—®é¢˜ã€‚\nåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªæ— æ³•å…‹æœçš„æœ€å°å»¶è¿Ÿï¼šå…‰é€Ÿé™åˆ¶äº†ä¿¡æ¯ä¼ è¾“çš„é€Ÿåº¦ï¼Œè€Œç¡¬ä»¶ç»„ä»¶æ¯ä¸ªæ“ä½œéƒ½ä¼šäº§ç”Ÿä¸€å®šçš„æœ€å°å»¶è¿Ÿæˆæœ¬ï¼ˆä¾‹å¦‚å†…å­˜ã€ç¡¬ç›˜ä»¥åŠ CPUï¼‰ã€‚\næœ€å°å»¶è¿Ÿå¯¹æŸ¥è¯¢çš„å½±å“ç¨‹åº¦å–å†³äºè¿™äº›æŸ¥è¯¢çš„æ€§è´¨ä»¥åŠä¿¡æ¯éœ€è¦ä¼ è¾“çš„ç‰©ç†è·ç¦»ã€‚\nå¯ç”¨æ€§ï¼ˆå’Œå®¹é”™ï¼‰ å¯æ‰©å±•ç³»ç»Ÿçš„ç¬¬äºŒä¸ªæ–¹é¢æ˜¯å¯ç”¨æ€§ã€‚\nå¯ç”¨æ€§æ˜¯æŒ‡ç³»ç»Ÿå¤„äºæ­£å¸¸è¿è¡ŒçŠ¶æ€çš„æ—¶é—´æ¯”ä¾‹ã€‚å¦‚æœç”¨æˆ·æ— æ³•è®¿é—®ç³»ç»Ÿï¼Œåˆ™ç§°ç³»ç»Ÿä¸å¯ç”¨ã€‚\nåˆ†å¸ƒå¼ç³»ç»Ÿä½¿æˆ‘ä»¬èƒ½å¤Ÿå®ç°åœ¨å•ä¸€ç³»ç»Ÿä¸Šå¾ˆéš¾å®ç°çš„ç†æƒ³ç‰¹æ€§ã€‚ä¾‹å¦‚ï¼Œå•ä¸ªæœºå™¨æ— æ³•å®¹å¿ä»»ä½•æ•…éšœï¼Œå› ä¸ºå®ƒè¦ä¹ˆå‘ç”Ÿæ•…éšœï¼Œè¦ä¹ˆæ­£å¸¸è¿è¡Œã€‚\nåˆ†å¸ƒå¼ç³»ç»Ÿå¯ä»¥é‡‡ç”¨ä¸€å †ä¸å¯é çš„ç»„ä»¶ï¼Œå¹¶åœ¨å®ƒä»¬ä¹‹ä¸Šæ„å»ºä¸€ä¸ªå¯é çš„ç³»ç»Ÿã€‚\næ²¡æœ‰å†—ä½™çš„ç³»ç»Ÿåªèƒ½è¾¾åˆ°å…¶åº•å±‚ç»„ä»¶çš„å¯ç”¨æ€§ã€‚è€Œå…·å¤‡å†—ä½™çš„ç³»ç»Ÿå¯ä»¥å®¹å¿éƒ¨åˆ†æ•…éšœï¼Œä»è€Œæé«˜å¯ç”¨æ€§ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œâ€œå†—ä½™â€å¯ä»¥åœ¨ä¸åŒå±‚é¢ä¸Šæœ‰ä¸åŒçš„å«ä¹‰ï¼Œæ¯”å¦‚ç»„ä»¶ã€æœåŠ¡å™¨ã€æ•°æ®ä¸­å¿ƒç­‰ã€‚\nä»å…¬å¼ä¸Šè®²ï¼Œå¯ç”¨æ€§ä¸ºï¼š Availability = uptime / (uptime + downtime) ã€‚\nä»æŠ€æœ¯è§’åº¦æ¥çœ‹ï¼Œå¯ç”¨æ€§ä¸»è¦ä¸å®¹é”™æ€§æœ‰å…³ã€‚å› ä¸ºæ•…éšœå‘ç”Ÿçš„æ¦‚ç‡éšç€ç»„ä»¶æ•°é‡çš„å¢åŠ è€Œå¢åŠ ï¼Œç³»ç»Ÿåº”è¯¥èƒ½å¤Ÿè¿›è¡Œè¡¥å¿ï¼Œä»¥ç¡®ä¿éšç€ç»„ä»¶æ•°é‡çš„å¢åŠ ï¼Œç³»ç»Ÿçš„å¯é æ€§ä¸ä¼šé™ä½ã€‚\nä¾‹å¦‚ï¼š\nå¯ç”¨æ€§ ï¼… 90%ï¼ˆâ€œä¸€ä¸ªä¹â€ï¼‰ ä¸€ä¸ªå¤šæœˆäº† 99%ï¼ˆâ€œä¸¤ä¸ªä¹â€ï¼‰ å°‘äº 4 å¤© 99.9%ï¼ˆâ€œä¸‰ä¸ªä¹â€ï¼‰ ä¸åˆ° 9 å°æ—¶ 99.99%ï¼ˆâ€œå››ä¸ªä¹â€ï¼‰ ä¸åˆ°ä¸€ä¸ªå°æ—¶ 99.999%ï¼ˆâ€œäº”ä¸ªä¹â€ï¼‰ ã€œ5 åˆ†é’Ÿ 99.9999%ï¼ˆâ€œå…­ä¸ªä¹â€ï¼‰ ã€œ 31 ç§’ å¯ç”¨æ€§åœ¨æŸç§æ„ä¹‰ä¸Šæ¯”è¿è¡Œæ—¶é—´æ›´å¹¿æ³›ï¼Œå› ä¸ºæœåŠ¡çš„å¯ç”¨æ€§è¿˜å¯èƒ½å—åˆ°ç½‘ç»œä¸­æ–­æˆ–å…¬å¸ç ´äº§ç­‰å› ç´ çš„å½±å“ï¼ˆè¿™äº›å› ç´ ä¸å®¹é”™æ€§å¹¶ä¸ç›´æ¥ç›¸å…³ï¼Œä½†ä»ä¼šå½±å“ç³»ç»Ÿçš„å¯ç”¨æ€§ï¼‰ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ²¡æœ‰äº†è§£ç³»ç»Ÿçš„æ¯ä¸€ä¸ªå…·ä½“æ–¹é¢ï¼Œæˆ‘ä»¬èƒ½åšçš„æœ€å¥½çš„å°±æ˜¯è®¾è®¡å®¹é”™æ€§ã€‚\nå®¹é”™æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ\nå®¹é”™æ€§æ˜¯æŒ‡ç³»ç»Ÿåœ¨å‘ç”Ÿæ•…éšœæ—¶ä»èƒ½ä»¥æ˜ç¡®å®šä¹‰çš„æ–¹å¼ç»§ç»­è¿è¡Œçš„èƒ½åŠ›ã€‚\nå®¹é”™æ€§å½’ç»“ä¸ºä»¥ä¸‹å‡ ç‚¹ï¼šé¦–å…ˆå®šä¹‰æ‚¨æ‰€é¢„æœŸçš„æ•…éšœï¼Œç„¶åè®¾è®¡ä¸€ä¸ªèƒ½å¤Ÿå®¹å¿è¿™äº›æ•…éšœçš„ç³»ç»Ÿæˆ–ç®—æ³•ã€‚æ‚¨æ— æ³•å®¹å¿æ‚¨æœªè€ƒè™‘åˆ°çš„æ•…éšœã€‚\næ˜¯ä»€ä¹ˆé˜»ç¢æˆ‘ä»¬å–å¾—ç¾å¥½çš„æˆæœï¼Ÿ åˆ†å¸ƒå¼ç³»ç»Ÿå—åˆ°ä¸¤ä¸ªç‰©ç†å› ç´ çš„çº¦æŸï¼š\nèŠ‚ç‚¹æ•°é‡ï¼ˆéšç€æ‰€éœ€å­˜å‚¨å’Œè®¡ç®—èƒ½åŠ›çš„å¢åŠ è€Œå¢åŠ ï¼‰ èŠ‚ç‚¹ä¹‹é—´çš„è·ç¦»ï¼ˆä¿¡æ¯æœ€å¤šä»¥å…‰é€Ÿä¼ æ’­ï¼‰ åœ¨è¿™äº›é™åˆ¶ä¸‹å·¥ä½œï¼š\nç‹¬ç«‹èŠ‚ç‚¹æ•°é‡çš„å¢åŠ ä¼šå¢åŠ ç³»ç»Ÿæ•…éšœçš„æ¦‚ç‡ï¼ˆé™ä½å¯ç”¨æ€§å¹¶å¢åŠ ç®¡ç†æˆæœ¬ï¼‰ã€‚ ç‹¬ç«‹èŠ‚ç‚¹æ•°é‡çš„å¢åŠ å¯èƒ½ä¼šå¢åŠ èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡éœ€æ±‚ï¼ˆéšç€è§„æ¨¡çš„å¢åŠ å¯¼è‡´æ€§èƒ½ä¸‹é™ï¼‰ã€‚ åœ°ç†è·ç¦»çš„å¢åŠ ä¼šå¢åŠ è¿œç¨‹èŠ‚ç‚¹ä¹‹é—´é€šä¿¡çš„æœ€å°å»¶è¿Ÿï¼ˆé™ä½æŸäº›æ“ä½œçš„æ€§èƒ½ï¼‰ã€‚ åœ¨ç³»ç»Ÿè®¾è®¡é€‰é¡¹ä¸­ï¼Œé™¤äº†ç‰©ç†çº¦æŸä¹‹å¤–ï¼Œè¿˜å­˜åœ¨ä¸æ€§èƒ½ã€å¯ç”¨æ€§å’Œå¯ç†è§£æ€§ç›¸å…³çš„è€ƒè™‘å› ç´ ã€‚\næ€§èƒ½å’Œå¯ç”¨æ€§å–å†³äºç³»ç»Ÿæä¾›çš„å¤–éƒ¨ä¿è¯ã€‚å¯ä»¥å°†è¿™äº›ä¿è¯è§†ä¸ºç³»ç»Ÿçš„æœåŠ¡çº§åˆ«åè®®ï¼ˆSLAï¼‰ï¼šå¦‚æœå†™å…¥æ•°æ®ï¼Œæˆ‘èƒ½å¤šå¿«åœ¨å…¶ä»–åœ°æ–¹è®¿é—®å®ƒï¼Ÿæ•°æ®å†™å…¥åï¼Œå¯¹æŒä¹…æ€§æœ‰ä½•ä¿è¯ï¼Ÿå¦‚æœè¦æ±‚ç³»ç»Ÿè¿è¡Œè®¡ç®—ï¼Œç»“æœå°†å¤šå¿«è¿”å›ï¼Ÿå½“ç»„ä»¶å‘ç”Ÿæ•…éšœæˆ–åœæ­¢è¿è¡Œæ—¶ï¼Œå¯¹ç³»ç»Ÿä¼šäº§ç”Ÿä»€ä¹ˆå½±å“ï¼Ÿ\nè¿˜æœ‰ä¸€ä¸ªæ ‡å‡†ï¼Œè™½ç„¶æ²¡æœ‰æ˜ç¡®æåˆ°ä½†éšå«å…¶ä¸­ï¼šå¯ç†è§£æ€§ã€‚æ‰€åšçš„ä¿è¯æœ‰å¤šå®¹æ˜“ç†è§£ï¼Ÿå½“ç„¶ï¼Œå¯¹äºå¯ç†è§£æ€§æ²¡æœ‰ç®€å•çš„åº¦é‡æ ‡å‡†ã€‚\nåœ¨æˆ‘å¾ˆæƒ³å°†â€œå¯ç†è§£æ€§â€å½’ç±»ä¸ºç‰©ç†é™åˆ¶ä¹‹ä¸‹ã€‚æ¯•ç«Ÿï¼Œå¯¹äºæˆ‘ä»¬äººç±»æ¥è¯´ï¼Œç†è§£æ¶‰åŠæ¯”æˆ‘ä»¬çš„æ‰‹æŒ‡æ•°é‡æ›´å¤šçš„è¿åŠ¨ç‰©ä½“çš„ä»»ä½•äº‹ç‰©éƒ½å¾ˆå›°éš¾ã€‚è¿™å°±æ˜¯é”™è¯¯å’Œå¼‚å¸¸ä¹‹é—´çš„åŒºåˆ«-é”™è¯¯æ˜¯ä¸æ­£ç¡®çš„è¡Œä¸ºï¼Œè€Œå¼‚å¸¸æ˜¯æ„å¤–çš„è¡Œä¸ºã€‚å¦‚æœä½ æ›´èªæ˜ï¼Œä½ ä¼šé¢„æ–™åˆ°å¼‚å¸¸çš„å‘ç”Ÿã€‚\næŠ½è±¡å’Œæ¨¡å‹ è¿™æ—¶å€™æŠ½è±¡å’Œæ¨¡å‹å°±å‘æŒ¥ä½œç”¨äº†ã€‚æŠ½è±¡é€šè¿‡å»é™¤ä¸è§£å†³é—®é¢˜æ— å…³çš„ç°å®ä¸–ç•Œæ–¹é¢ï¼Œä½¿äº‹ç‰©æ›´æ˜“äºç®¡ç†ã€‚æ¨¡å‹ä»¥å‡†ç¡®çš„æ–¹å¼æè¿°äº†åˆ†å¸ƒå¼ç³»ç»Ÿçš„å…³é”®å±æ€§ã€‚åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘å°†è®¨è®ºè®¸å¤šç§ç±»å‹çš„æ¨¡å‹ï¼Œä¾‹å¦‚ï¼š\nç³»ç»Ÿæ¨¡å‹ï¼ˆå¼‚æ­¥/åŒæ­¥ï¼‰ æ•…éšœæ¨¡å‹ï¼ˆå´©æºƒ-æ•…éšœã€åˆ†åŒºã€æ‹œå åº­ï¼‰ ä¸€è‡´æ€§æ¨¡å‹ï¼ˆå¼ºã€æœ€ç»ˆï¼‰ ä¸€ä¸ªè‰¯å¥½çš„æŠ½è±¡ä½¿å¾—ä¸ç³»ç»Ÿçš„å·¥ä½œæ›´æ˜“äºç†è§£ï¼ŒåŒæ—¶æ•æ‰åˆ°ä¸ç‰¹å®šç›®çš„ç›¸å…³çš„å› ç´ ã€‚\nç°å®ä¸­å­˜åœ¨è®¸å¤šèŠ‚ç‚¹ï¼Œè€Œæˆ‘ä»¬å¸Œæœ›ç³»ç»Ÿâ€œåƒä¸€ä¸ªå•ä¸€ç³»ç»Ÿä¸€æ ·å·¥ä½œâ€çš„æ„¿æœ›ä¹‹é—´å­˜åœ¨ä¸€ç§ç´§å¼ å…³ç³»ã€‚é€šå¸¸ï¼Œæœ€ç†Ÿæ‚‰çš„æ¨¡å‹ï¼ˆä¾‹å¦‚ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸Šå®ç°å…±äº«å†…å­˜æŠ½è±¡ï¼‰æˆæœ¬å¤ªé«˜ã€‚\nä¸€ä¸ªç³»ç»Ÿæä¾›çš„ä¿è¯è¶Šä½ï¼Œå®ƒå°±æœ‰æ›´å¤§çš„è‡ªç”±åº¦å’Œæ½œåœ¨çš„æ€§èƒ½ä¼˜åŠ¿ï¼Œä½†åŒæ—¶ä¹Ÿå¯èƒ½æ›´éš¾æ¨ç†ã€‚äººä»¬æ›´æ“…é•¿æ¨ç†åƒä¸€ä¸ªå•ä¸€ç³»ç»Ÿä¸€æ ·å·¥ä½œçš„ç³»ç»Ÿï¼Œè€Œä¸æ˜¯ä¸€ç»„èŠ‚ç‚¹ã€‚\né€šè¿‡æš´éœ²ç³»ç»Ÿå†…éƒ¨æ›´å¤šçš„ç»†èŠ‚ï¼Œé€šå¸¸å¯ä»¥æé«˜æ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œåœ¨åˆ—å­˜å‚¨ä¸­ï¼Œç”¨æˆ·å¯ä»¥ï¼ˆåœ¨æŸç§ç¨‹åº¦ä¸Šï¼‰æ¨ç†ç³»ç»Ÿå†…çš„é”®å€¼å¯¹çš„å±€éƒ¨æ€§ï¼Œå¹¶å› æ­¤åšå‡ºå½±å“å…¸å‹æŸ¥è¯¢æ€§èƒ½çš„å†³ç­–ã€‚éšè—è¿™äº›ç»†èŠ‚çš„ç³»ç»Ÿæ›´æ˜“äºç†è§£ï¼ˆå› ä¸ºå®ƒä»¬æ›´åƒå•ä¸ªå•å…ƒï¼Œéœ€è¦è€ƒè™‘çš„ç»†èŠ‚æ›´å°‘ï¼‰ï¼Œè€Œæš´éœ²æ›´å¤šçœŸå®ä¸–ç•Œç»†èŠ‚çš„ç³»ç»Ÿå¯èƒ½æ›´å…·æ€§èƒ½ï¼ˆå› ä¸ºå®ƒä»¬æ›´æ¥è¿‘çœŸå®æƒ…å†µï¼‰ã€‚\nç¼–å†™åƒå•ä¸€ç³»ç»Ÿä¸€æ ·å·¥ä½œçš„åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´ç€å‡ ç§ç±»å‹çš„æ•…éšœå›°éš¾ã€‚ç½‘ç»œå»¶è¿Ÿå’Œç½‘ç»œåˆ†åŒºï¼ˆä¾‹å¦‚ï¼ŒæŸäº›èŠ‚ç‚¹ä¹‹é—´çš„å®Œå…¨ç½‘ç»œæ•…éšœï¼‰æ„å‘³ç€ç³»ç»Ÿæœ‰æ—¶éœ€è¦åœ¨å‘ç”Ÿè¿™äº›æ•…éšœæ—¶åšå‡ºè‰°éš¾çš„é€‰æ‹©ï¼Œæ˜¯æ›´å¥½åœ°ä¿æŒå¯ç”¨æ€§ä½†å¤±å»ä¸€äº›æ— æ³•å¼ºåˆ¶æ‰§è¡Œçš„å…³é”®ä¿è¯ï¼Œè¿˜æ˜¯ä¿å®ˆè¡Œäº‹å¹¶åœ¨è¿™äº›æ•…éšœå‘ç”Ÿæ—¶æ‹’ç»å®¢æˆ·ç«¯ã€‚\nCAP å®šç† - æˆ‘å°†åœ¨ä¸‹ä¸€ç« ä¸­è®¨è®ºå®ƒ - æ•æ‰åˆ°äº†è¿™äº›ç´§å¼ å…³ç³»ã€‚æœ€ç†æƒ³çš„ç³»ç»Ÿæœ€ç»ˆæ—¢æ»¡è¶³ç¨‹åºå‘˜çš„éœ€æ±‚ï¼ˆæ¸…æ™°çš„è¯­ä¹‰ï¼‰ï¼Œåˆæ»¡è¶³ä¸šåŠ¡éœ€æ±‚ï¼ˆå¯ç”¨æ€§/ä¸€è‡´æ€§/å»¶è¿Ÿï¼‰ã€‚\nè®¾è®¡æŠ€æœ¯ï¼šåˆ†åŒºå’Œå¤åˆ¶ æ•°æ®é›†åœ¨å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´çš„åˆ†å¸ƒæ–¹å¼éå¸¸é‡è¦ã€‚ä¸ºäº†è¿›è¡Œä»»ä½•è®¡ç®—ï¼Œæˆ‘ä»¬éœ€è¦å®šä½æ•°æ®ï¼Œç„¶åå¯¹å…¶è¿›è¡Œæ“ä½œã€‚\nâ€œåˆ†è€Œæ²»ä¹‹â€ - æˆ‘çš„æ„æ€æ˜¯ï¼Œåˆ†åŒºå’Œå¤åˆ¶ã€‚\nä¸‹é¢çš„å›¾ç‰‡è¯´æ˜äº†è¿™ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«ï¼šåˆ†åŒºæ•°æ®ï¼ˆä¸‹æ–¹çš„ A å’Œ Bï¼‰è¢«åˆ†æˆç‹¬ç«‹çš„é›†åˆï¼Œè€Œå¤åˆ¶æ•°æ®ï¼ˆä¸‹æ–¹çš„ Cï¼‰åˆ™è¢«å¤åˆ¶åˆ°å¤šä¸ªä½ç½®ã€‚\nè¿™æ˜¯è§£å†³æ¶‰åŠåˆ†å¸ƒå¼è®¡ç®—çš„ä»»ä½•é—®é¢˜çš„å…³é”®ã€‚å½“ç„¶ï¼Œå…³é”®åœ¨äºé€‰æ‹©é€‚åˆæ‚¨å…·ä½“å®ç°çš„æ­£ç¡®æŠ€æœ¯ï¼›æœ‰è®¸å¤šå®ç°å¤åˆ¶å’Œåˆ†åŒºçš„ç®—æ³•ï¼Œæ¯ç§ç®—æ³•éƒ½æœ‰ä¸åŒçš„é™åˆ¶å’Œä¼˜åŠ¿ï¼Œéœ€è¦æ ¹æ®æ‚¨çš„è®¾è®¡ç›®æ ‡è¿›è¡Œè¯„ä¼°ã€‚\nåˆ†åŒº åˆ†åŒºæ˜¯å°†æ•°æ®é›†åˆ’åˆ†ä¸ºè¾ƒå°çš„ç‹¬ç«‹é›†åˆï¼›è¿™ç”¨äºå‡å°‘æ•°æ®é›†å¢é•¿çš„å½±å“ï¼Œå› ä¸ºæ¯ä¸ªåˆ†åŒºéƒ½æ˜¯æ•°æ®çš„å­é›†ã€‚\nåˆ†åŒºé€šè¿‡é™åˆ¶è¦æ£€æŸ¥çš„æ•°æ®é‡å¹¶å°†ç›¸å…³æ•°æ®å®šä½åœ¨åŒä¸€åˆ†åŒºä¸­æ¥æé«˜æ€§èƒ½ã€‚ åˆ†åŒºé€šè¿‡å…è®¸åˆ†åŒºå•ç‹¬å¤±è´¥ï¼Œå¢åŠ äº†éœ€è¦å¤±è´¥çš„èŠ‚ç‚¹æ•°é‡ï¼Œä»è€Œæé«˜äº†å¯ç”¨æ€§ï¼Œé™ä½äº†ç‰ºç‰²å¯ç”¨æ€§çš„é£é™©ã€‚ åˆ†åŒºä¹Ÿéå¸¸ä¾èµ–äºå…·ä½“åº”ç”¨ç¨‹åºï¼Œæ‰€ä»¥åœ¨ä¸äº†è§£å…·ä½“æƒ…å†µçš„æƒ…å†µä¸‹å¾ˆéš¾åšå‡ºè¯¦ç»†è¯´æ˜ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¤§å¤šæ•°æ–‡æœ¬ï¼ŒåŒ…æ‹¬æœ¬æ–‡ï¼Œéƒ½å°†é‡ç‚¹æ”¾åœ¨å¤åˆ¶ä¸Šã€‚\nåˆ†åŒºä¸»è¦æ˜¯æ ¹æ®æ‚¨è®¤ä¸ºä¸»è¦è®¿é—®æ¨¡å¼å°†æ˜¯ä»€ä¹ˆæ¥å®šä¹‰åˆ†åŒºï¼Œå¹¶å¤„ç†ç”±äºå­˜åœ¨ç‹¬ç«‹åˆ†åŒºè€Œå¸¦æ¥çš„é™åˆ¶ï¼ˆä¾‹å¦‚ï¼Œè·¨åˆ†åŒºçš„è®¿é—®æ•ˆç‡ä½ä¸‹ï¼Œå¢é•¿é€Ÿåº¦ä¸åŒç­‰ï¼‰çš„é—®é¢˜ã€‚\nå¤åˆ¶ å¤åˆ¶æ˜¯å°†ç›¸åŒçš„æ•°æ®å¤åˆ¶åˆ°å¤šå°æœºå™¨ä¸Šçš„è¿‡ç¨‹ï¼›è¿™æ ·å¯ä»¥è®©æ›´å¤šçš„æœåŠ¡å™¨å‚ä¸è®¡ç®—ã€‚\nè®©æˆ‘ä¸å¤ªå‡†ç¡®åœ°å¼•ç”¨ Homer J. Simpsonï¼š\nä¸ºäº†å¤åˆ¶ï¼ç”Ÿæ´»ä¸­æ‰€æœ‰é—®é¢˜çš„èµ·å› å’Œè§£å†³ä¹‹é“ã€‚\nå¤åˆ¶ - å¤åˆ¶æˆ–å†ç°æŸä¸ªä¸œè¥¿ - æ˜¯æˆ‘ä»¬å¯¹æŠ—å»¶è¿Ÿçš„ä¸»è¦æ–¹å¼ã€‚\nå¤åˆ¶é€šè¿‡ä½¿é¢å¤–çš„è®¡ç®—èƒ½åŠ›å’Œå¸¦å®½é€‚ç”¨äºæ•°æ®çš„æ–°å‰¯æœ¬æ¥æé«˜æ€§èƒ½ã€‚ å¤åˆ¶é€šè¿‡åˆ›å»ºæ•°æ®çš„é¢å¤–å‰¯æœ¬ï¼Œå¢åŠ äº†éœ€è¦å¤±è´¥çš„èŠ‚ç‚¹æ•°é‡ï¼Œä»è€Œæé«˜äº†å¯ç”¨æ€§ã€‚ å¤åˆ¶æ˜¯æä¾›é¢å¤–å¸¦å®½å’Œåœ¨å…³é”®ä½ç½®è¿›è¡Œç¼“å­˜çš„æ–¹å¼ã€‚å®ƒè¿˜æ¶‰åŠæŒ‰ç…§æŸç§ä¸€è‡´æ€§æ¨¡å‹ä»¥æŸç§æ–¹å¼ä¿æŒä¸€è‡´æ€§ã€‚\nå¤åˆ¶ä½¿æˆ‘ä»¬èƒ½å¤Ÿå®ç°å¯æ‰©å±•æ€§ã€æ€§èƒ½å’Œå®¹é”™æ€§ã€‚æ‹…å¿ƒå¯ç”¨æ€§ä¸§å¤±æˆ–æ€§èƒ½é™ä½ï¼Ÿå¤åˆ¶æ•°æ®ä»¥é¿å…ç“¶é¢ˆæˆ–å•ç‚¹æ•…éšœã€‚è®¡ç®—é€Ÿåº¦æ…¢ï¼Ÿå°†è®¡ç®—å¤åˆ¶åˆ°å¤šä¸ªç³»ç»Ÿä¸Šã€‚I/O é€Ÿåº¦æ…¢ï¼Ÿå°†æ•°æ®å¤åˆ¶åˆ°æœ¬åœ°ç¼“å­˜ä»¥å‡å°‘å»¶è¿Ÿï¼Œæˆ–è€…å¤åˆ¶åˆ°å¤šå°æœºå™¨ä¸Šä»¥å¢åŠ ååé‡ã€‚\nå¤åˆ¶ä¹Ÿæ˜¯è®¸å¤šé—®é¢˜çš„æ ¹æºï¼Œå› ä¸ºç°åœ¨åœ¨å¤šå°æœºå™¨ä¸Šå¿…é¡»ä¿æŒæ•°æ®åŒæ­¥çš„ç‹¬ç«‹å‰¯æœ¬å­˜åœ¨ - è¿™æ„å‘³ç€ç¡®ä¿å¤åˆ¶éµå¾ªä¸€è‡´æ€§æ¨¡å‹ã€‚\nä¸€è‡´æ€§æ¨¡å‹çš„é€‰æ‹©éå¸¸å…³é”®ï¼šä¸€ä¸ªè‰¯å¥½çš„ä¸€è‡´æ€§æ¨¡å‹ä¸ºç¨‹åºå‘˜æä¾›æ¸…æ™°çš„è¯­ä¹‰ï¼ˆæ¢å¥è¯è¯´ï¼Œå®ƒæ‰€ä¿è¯çš„å±æ€§æ˜“äºæ¨ç†ï¼‰ï¼Œå¹¶æ»¡è¶³é«˜å¯ç”¨æ€§æˆ–å¼ºä¸€è‡´æ€§ç­‰ä¸šåŠ¡/è®¾è®¡ç›®æ ‡ã€‚\nå¯¹äºå¤åˆ¶ï¼Œåªæœ‰ä¸€ç§ä¸€è‡´æ€§æ¨¡å‹ - å¼ºä¸€è‡´æ€§ - å…è®¸æ‚¨åƒæ²¡æœ‰å¤åˆ¶åŸºç¡€æ•°æ®ä¸€æ ·è¿›è¡Œç¼–ç¨‹ã€‚å…¶ä»–ä¸€è‡´æ€§æ¨¡å‹å‘ç¨‹åºå‘˜æš´éœ²äº†ä¸€äº›å¤åˆ¶çš„å†…éƒ¨ç»†èŠ‚ã€‚ç„¶è€Œï¼Œè¾ƒå¼±çš„ä¸€è‡´æ€§æ¨¡å‹å¯ä»¥æä¾›è¾ƒä½çš„å»¶è¿Ÿå’Œæ›´é«˜çš„å¯ç”¨æ€§ - å¹¶ä¸ä¸€å®šæ›´éš¾ç†è§£ï¼Œåªæ˜¯ä¸åŒè€Œå·²ã€‚\nè¿›ä¸€æ­¥é˜…è¯» The Datacenter as a Computer - An Introduction to the Design of Warehouse-Scale Machines Fallacies of Distributed Computing Notes on Distributed Systems for Young Bloods ","permalink":"https://blog.chensoul.cc/posts/2023/11/10/distributed-systems-01/","summary":"ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹æ˜¯ä¸€æœ¬å¹¿å—æ¬¢è¿çš„èµ„æºï¼Œç”¨äºç†è§£å’Œå­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿã€‚è¯¥ä¹¦ç”±ä½œè€… Mikito Takada æ’°å†™ï¼Œä»‹ç»äº†æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºæœ¬æ¦‚å¿µã€åŸåˆ™å’ŒæŒ‘æˆ˜ã€‚\nè¿™æœ¬ä¹¦æ¶µç›–äº†ä¸åˆ†å¸ƒå¼ç³»ç»Ÿç›¸å…³çš„å¹¿æ³›ä¸»é¢˜ï¼ŒåŒ…æ‹¬ç½‘ç»œã€å®¹é”™æ€§ã€ä¸€è‡´æ€§æ¨¡å‹ã€åˆ†å¸ƒå¼ç®—æ³•ã€å¯æ‰©å±•æ€§ç­‰ç­‰ã€‚å®ƒæ—¨åœ¨ä»¥æ¸…æ™°æ˜“æ‡‚çš„æ–¹å¼è§£é‡Šå¤æ‚çš„æ¦‚å¿µï¼Œé€‚åˆåˆå­¦è€…å’Œæœ‰ç»éªŒçš„åˆ†å¸ƒå¼ç³»ç»Ÿä»ä¸šè€…é˜…è¯»ã€‚\nåœ¨æ•´æœ¬ä¹¦ä¸­ï¼Œä½œè€…æä¾›äº†å„ç§å®é™…æ¡ˆä¾‹å’Œæ¡ˆä¾‹ç ”ç©¶ï¼Œä»¥è¯´æ˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®é™…åº”ç”¨å’Œå®è·µæ–¹é¢ã€‚å®ƒè¿˜å¼ºè°ƒäº†æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿæ¶‰åŠçš„æƒè¡¡å’Œè®¾è®¡è€ƒè™‘ï¼Œå¸®åŠ©è¯»è€…å…¨é¢ç†è§£è¿™ä¸ªä¸»é¢˜ã€‚\nã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹ä½œä¸ºå¼€æºèµ„æºï¼Œå¯ä»¥å…è´¹åœ¨çº¿è·å–ï¼Œéå¸¸é€‚åˆä»»ä½•å¯¹å­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿæ„Ÿå…´è¶£çš„äººã€‚\nåŸæ–‡é“¾æ¥ï¼šDistributed systems: for fun and profit\n1. é«˜å±‚åˆ†å¸ƒå¼ç³»ç»Ÿ åˆ†å¸ƒå¼ç¼–ç¨‹æ˜¯åˆ©ç”¨å¤šå°è®¡ç®—æœºè§£å†³åœ¨å•å°è®¡ç®—æœºä¸Šå¯ä»¥è§£å†³çš„ç›¸åŒé—®é¢˜çš„ä¸€ç§æŠ€æœ¯ã€‚\nä»»ä½•è®¡ç®—æœºç³»ç»Ÿéƒ½éœ€è¦å®Œæˆä¸¤ä¸ªåŸºæœ¬ä»»åŠ¡ï¼š\nå­˜å‚¨ è®¡ç®— åˆ†å¸ƒå¼ç¼–ç¨‹æ˜¯ä¸€ç§è‰ºæœ¯ï¼Œé€šè¿‡åˆ©ç”¨å¤šå°è®¡ç®—æœºè§£å†³åœ¨å•å°è®¡ç®—æœºä¸Šå¯ä»¥è§£å†³çš„ç›¸åŒé—®é¢˜ï¼Œé€šå¸¸æ˜¯å› ä¸ºè¯¥é—®é¢˜å·²ç»è¶…å‡ºäº†å•å°è®¡ç®—æœºçš„å¤„ç†èƒ½åŠ›ã€‚\nå®é™…ä¸Šï¼Œå¹¶æ²¡æœ‰å¼ºåˆ¶è¦æ±‚æˆ‘ä»¬ä½¿ç”¨åˆ†å¸ƒå¼ç³»ç»Ÿã€‚å¦‚æœæ‹¥æœ‰æ— é™çš„èµ„é‡‘å’Œæ— é™çš„ç ”å‘æ—¶é—´ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦åˆ†å¸ƒå¼ç³»ç»Ÿã€‚æ‰€æœ‰çš„è®¡ç®—å’Œå­˜å‚¨å¯ä»¥åœ¨ä¸€ä¸ªé­”ç›’ä¸Šå®Œæˆï¼Œè¿™æ˜¯ä¸€å°å•ä¸€çš„ã€æå…¶å¿«é€Ÿå’Œå¯é çš„ç³»ç»Ÿï¼Œä½ å¯ä»¥æ”¯ä»˜ç»™åˆ«äººæ¥ä¸ºä½ è®¾è®¡ã€‚\nç„¶è€Œï¼Œå¾ˆå°‘æœ‰äººæ‹¥æœ‰æ— é™çš„èµ„æºã€‚å› æ­¤ï¼Œä»–ä»¬å¿…é¡»åœ¨ç°å®ä¸–ç•Œçš„æˆæœ¬æ•ˆç›Šæ›²çº¿ä¸Šæ‰¾åˆ°åˆé€‚çš„ä½ç½®ã€‚åœ¨å°è§„æ¨¡æƒ…å†µä¸‹ï¼Œå‡çº§ç¡¬ä»¶æ˜¯ä¸€ç§å¯è¡Œçš„ç­–ç•¥ã€‚ç„¶è€Œï¼Œéšç€é—®é¢˜è§„æ¨¡çš„å¢åŠ ï¼Œä½ ä¼šè¾¾åˆ°ä¸€ä¸ªé˜¶æ®µï¼Œåœ¨è¿™ä¸ªé˜¶æ®µï¼Œè¦ä¹ˆä¸å­˜åœ¨å¯ä»¥è®©ä½ åœ¨å•ä¸ªèŠ‚ç‚¹ä¸Šè§£å†³é—®é¢˜çš„ç¡¬ä»¶å‡çº§ï¼Œè¦ä¹ˆæˆæœ¬è¿‡é«˜ã€‚åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘æ¬¢è¿ä½ è¿›å…¥åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸–ç•Œã€‚\nå½“å‰çš„ç°å®æ˜¯ï¼Œåªè¦é€šè¿‡å®¹é”™è½¯ä»¶å°†ç»´æŠ¤æˆæœ¬æ§åˆ¶åœ¨è¾ƒä½æ°´å¹³ï¼Œä¸­æ¡£ã€å¤§ä¼—åŒ–ç¡¬ä»¶æä¾›äº†æœ€ä½³çš„æ€§ä»·æ¯”ã€‚\nè®¡ç®—ä¸»è¦å—ç›Šäºé«˜ç«¯ç¡¬ä»¶ï¼Œå°¤å…¶æ˜¯åœ¨èƒ½å¤Ÿé€šè¿‡å†…éƒ¨å†…å­˜è®¿é—®å–ä»£ç¼“æ…¢çš„ç½‘ç»œè®¿é—®æ—¶ã€‚åœ¨éœ€è¦èŠ‚ç‚¹é—´å¤§é‡é€šä¿¡çš„ä»»åŠ¡ä¸­ï¼Œé«˜ç«¯ç¡¬ä»¶çš„æ€§èƒ½ä¼˜åŠ¿æœ‰é™ã€‚\næ­£å¦‚ Barrosoã€Clidaras å’Œ HÃ¶lzle çš„ä¸Šå›¾æ‰€ç¤ºï¼Œå‡è®¾æ‰€æœ‰èŠ‚ç‚¹éƒ½é‡‡ç”¨ç»Ÿä¸€çš„å†…å­˜è®¿é—®æ¨¡å¼ï¼Œé«˜ç«¯ç¡¬ä»¶å’Œå•†ç”¨ç¡¬ä»¶ä¹‹é—´çš„æ€§èƒ½å·®è·ä¼šéšç€é›†ç¾¤è§„æ¨¡çš„æ‰©å¤§è€Œç¼©å°ã€‚\nç†æƒ³æƒ…å†µä¸‹ï¼Œæ·»åŠ ä¸€å°æ–°çš„æœºå™¨å°†çº¿æ€§å¢åŠ ç³»ç»Ÿçš„æ€§èƒ½å’Œå®¹é‡ã€‚ä½†æ˜¯ï¼Œç°å®æƒ…å†µå¹¶éå¦‚æ­¤ï¼Œå› ä¸ºç”±äºå­˜åœ¨ç‹¬ç«‹çš„è®¡ç®—æœºï¼Œä¼šäº§ç”Ÿä¸€äº›å¼€é”€ã€‚æ•°æ®éœ€è¦åœ¨è®¡ç®—æœºä¹‹é—´è¿›è¡Œå¤åˆ¶ï¼Œè®¡ç®—ä»»åŠ¡éœ€è¦è¿›è¡Œåè°ƒç­‰ç­‰ã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå€¼å¾—ç ”ç©¶åˆ†å¸ƒå¼ç®—æ³•çš„åŸå› â€”â€”å®ƒä»¬æä¾›äº†é’ˆå¯¹ç‰¹å®šé—®é¢˜çš„é«˜æ•ˆè§£å†³æ–¹æ¡ˆï¼Œä»¥åŠå…³äºå¯èƒ½æ€§ã€æ­£ç¡®å®ç°çš„æœ€ä½æˆæœ¬ä»¥åŠä¸å¯èƒ½æ€§çš„æŒ‡å¯¼ã€‚\nè¿™æ®µæ–‡å­—çš„é‡ç‚¹æ˜¯åœ¨ä¸€ä¸ªå¹³å‡¡ä½†å•†ä¸šç›¸å…³çš„ç¯å¢ƒä¸­ï¼Œå³æ•°æ®ä¸­å¿ƒçš„åˆ†å¸ƒå¼ç¼–ç¨‹å’Œç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œæˆ‘ä¸ä¼šè®¨è®ºç”±äºå…·æœ‰å¼‚ä¹å¯»å¸¸çš„ç½‘ç»œé…ç½®æˆ–åœ¨å…±äº«å†…å­˜è®¾ç½®ä¸­å‡ºç°çš„ä¸“é—¨é—®é¢˜ã€‚æ­¤å¤–ï¼Œé‡ç‚¹æ˜¯æ¢ç´¢ç³»ç»Ÿè®¾è®¡ç©ºé—´ï¼Œè€Œä¸æ˜¯ä¼˜åŒ–ä»»ä½•ç‰¹å®šè®¾è®¡â€”â€”åè€…æ˜¯ä¸€ä¸ªæ›´ä¸“é—¨çš„æ–‡æœ¬ä¸»é¢˜ã€‚\næˆ‘ä»¬æƒ³è¦å®ç°çš„ç›®æ ‡ï¼šå¯æ‰©å±•æ€§å’Œå…¶ä»–å¥½çš„ä¸œè¥¿ ä»æˆ‘çœ‹æ¥ï¼Œä¸€åˆ‡éƒ½å§‹äºå¤„ç†è§„æ¨¡çš„éœ€æ±‚ã€‚\nåœ¨å°è§„æ¨¡ä¸‹ï¼Œå¤§å¤šæ•°äº‹æƒ…éƒ½æ˜¯å¾®ä¸è¶³é“çš„ï¼Œè€ŒåŒæ ·çš„é—®é¢˜ä¸€æ—¦è¶…è¿‡ä¸€å®šçš„å¤§å°ã€å®¹é‡æˆ–å…¶ä»–ç‰©ç†é™åˆ¶ï¼Œå°±ä¼šå˜å¾—æ›´åŠ å›°éš¾ã€‚ä¸¾èµ·ä¸€å—å·§å…‹åŠ›å¾ˆå®¹æ˜“ï¼Œä½†ä¸¾èµ·ä¸€åº§å±±å°±å¾ˆå›°éš¾ã€‚æ•°ä¸€ä¸‹æˆ¿é—´é‡Œæœ‰å¤šå°‘äººå¾ˆå®¹æ˜“ï¼Œä½†æ•°ä¸€ä¸‹å›½å®¶é‡Œæœ‰å¤šå°‘äººå°±å¾ˆéš¾ã€‚\næ‰€ä»¥ä¸€åˆ‡éƒ½å§‹äºè§„æ¨¡â€”â€”å¯æ‰©å±•æ€§ã€‚éæ­£å¼åœ°è¯´ï¼Œåœ¨ä¸€ä¸ªå¯æ‰©å±•çš„ç³»ç»Ÿä¸­ï¼Œå½“æˆ‘ä»¬ä»å°è§„æ¨¡å‘å¤§è§„æ¨¡è¿‡æ¸¡æ—¶ï¼Œäº‹æƒ…ä¸åº”è¯¥é€æ¸å˜å¾—æ›´ç³Ÿã€‚ä»¥ä¸‹æ˜¯å¦ä¸€ç§å®šä¹‰ï¼š\nå¯æ‰©å±•æ€§æ˜¯æŒ‡ç³»ç»Ÿã€ç½‘ç»œæˆ–è¿›ç¨‹å¤„ç†ä¸æ–­å¢é•¿çš„å·¥ä½œè´Ÿè½½çš„èƒ½åŠ›ï¼Œæˆ–è€…è¯´å®ƒèƒ½å¤Ÿè¢«æ‰©å¤§ä»¥é€‚åº”è¿™ç§å¢é•¿çš„èƒ½åŠ›ã€‚\nä»€ä¹ˆæ˜¯åœ¨å¢é•¿å‘¢ï¼Ÿå—¯ï¼Œä½ å¯ä»¥ç”¨å‡ ä¹ä»»ä½•æ–¹å¼æ¥è¡¡é‡å¢é•¿ï¼ˆäººæ•°ã€ç”¨ç”µé‡ç­‰ï¼‰ã€‚ä½†æœ‰ä¸‰ä¸ªç‰¹åˆ«æœ‰è¶£çš„æ–¹é¢å€¼å¾—å…³æ³¨ï¼š\nè§„æ¨¡å¯æ‰©å±•æ€§ï¼šå¢åŠ æ›´å¤šèŠ‚ç‚¹åº”è¯¥ä½¿ç³»ç»Ÿçº¿æ€§åŠ å¿«ï¼›å¢åŠ æ•°æ®é›†çš„å¤§å°ä¸åº”å¢åŠ å»¶è¿Ÿã€‚ åœ°ç†å¯æ‰©å±•æ€§ï¼šåº”è¯¥å¯ä»¥åˆ©ç”¨å¤šä¸ªæ•°æ®ä¸­å¿ƒæ¥ç¼©çŸ­å“åº”ç”¨æˆ·æŸ¥è¯¢æ‰€éœ€çš„æ—¶é—´ï¼ŒåŒæ—¶ä»¥æŸç§åˆç†çš„æ–¹å¼å¤„ç†è·¨æ•°æ®ä¸­å¿ƒçš„å»¶è¿Ÿã€‚ ç®¡ç†å¯æ‰©å±•æ€§ï¼šæ·»åŠ æ›´å¤šèŠ‚ç‚¹ä¸åº”å¢åŠ ç³»ç»Ÿçš„ç®¡ç†æˆæœ¬ï¼ˆä¾‹å¦‚ç®¡ç†å‘˜ä¸æœºå™¨çš„æ¯”ç‡ï¼‰ã€‚ å½“ç„¶ï¼Œåœ¨çœŸå®çš„ç³»ç»Ÿä¸­ï¼Œå¢é•¿åŒæ—¶å‘ç”Ÿåœ¨å¤šä¸ªä¸åŒçš„è½´ä¸Šï¼›æ¯ä¸ªæŒ‡æ ‡ä»…åæ˜ å¢é•¿çš„æŸäº›æ–¹é¢ã€‚\nå¯æ‰©å±•çš„ç³»ç»Ÿæ˜¯ä¸€ç§éšç€è§„æ¨¡çš„å¢åŠ è€ŒæŒç»­æ»¡è¶³ç”¨æˆ·éœ€æ±‚çš„ç³»ç»Ÿã€‚æœ‰ä¸¤ä¸ªç‰¹åˆ«ç›¸å…³çš„æ–¹é¢â€”â€”æ€§èƒ½å’Œå¯ç”¨æ€§â€”â€”å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼æ¥è¡¡é‡ã€‚\næ€§èƒ½ï¼ˆå’Œå»¶è¿Ÿï¼‰ æ€§èƒ½æ˜¯æŒ‡è®¡ç®—æœºç³»ç»Ÿåœ¨ä½¿ç”¨çš„æ—¶é—´å’Œèµ„æºç›¸å¯¹äºæ‰€å®Œæˆçš„æœ‰ç”¨å·¥ä½œé‡æ¥è¡¡é‡çš„ç‰¹å¾ã€‚\næ ¹æ®å…·ä½“æƒ…å†µï¼Œè¿™å¯èƒ½æ¶‰åŠå®ç°ä»¥ä¸‹ä¸€é¡¹æˆ–å¤šé¡¹ï¼š\nå¯¹äºç»™å®šçš„å·¥ä½œï¼Œå“åº”æ—¶é—´çŸ­/å»¶è¿Ÿä½ é«˜ååé‡ï¼ˆå¤„ç†å·¥ä½œç‡ï¼‰ è®¡ç®—èµ„æºåˆ©ç”¨ç‡ä½ é’ˆå¯¹ä»»ä½•è¿™äº›ç»“æœè¿›è¡Œä¼˜åŒ–éƒ½éœ€è¦æƒè¡¡ã€‚ä¾‹å¦‚ï¼Œç³»ç»Ÿå¯ä»¥é€šè¿‡å¤„ç†æ›´å¤§æ‰¹é‡çš„å·¥ä½œæ¥å®ç°æ›´é«˜çš„ååé‡ï¼Œä»è€Œå‡å°‘æ“ä½œå¼€é”€ã€‚ç”±äºæ‰¹å¤„ç†ï¼Œæƒè¡¡å°†æ˜¯ä¸ªåˆ«å·¥ä½œçš„å“åº”æ—¶é—´æ›´é•¿ã€‚\næˆ‘å‘ç°ä½å»¶è¿Ÿï¼ˆå®ç°è¾ƒçŸ­çš„å“åº”æ—¶é—´ï¼‰æ˜¯æ€§èƒ½ä¸­æœ€æœ‰è¶£çš„æ–¹é¢ï¼Œå› ä¸ºå®ƒä¸ç‰©ç†ï¼ˆè€Œä¸æ˜¯è´¢åŠ¡ï¼‰é™åˆ¶å¯†åˆ‡ç›¸å…³ã€‚ä½¿ç”¨è´¢åŠ¡èµ„æºæ¥è§£å†³å»¶è¿Ÿé—®é¢˜æ¯”æ€§èƒ½çš„å…¶ä»–æ–¹é¢æ›´éš¾ã€‚\nå¯¹äºå»¶è¿Ÿæœ‰å¾ˆå¤šéå¸¸å…·ä½“çš„å®šä¹‰ï¼Œä½†æˆ‘çœŸçš„å¾ˆå–œæ¬¢è¿™ä¸ªè¯çš„è¯æºæ‰€å”¤èµ·çš„æƒ³æ³•ï¼š\nå»¶è¿Ÿæ˜¯æŒ‡æ½œä¼çŠ¶æ€ï¼Œå»¶è¿Ÿçš„æˆ–åœ¨æŸäº‹ç‰©å¼€å§‹å’Œå‘ç”Ÿä¹‹é—´çš„ä¸€æ®µæ—¶é—´ã€‚\nâ€œæ½œåœ¨çš„â€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ\næ½œåœ¨çš„æ˜¯æŒ‡æŸç‰©å­˜åœ¨æˆ–å‡ºç°ï¼Œä½†è¢«éšè—ã€éšè”½æˆ–å¤„äºä¸æ´»åŠ¨çŠ¶æ€ã€‚å®ƒæè¿°äº†ä¸€ç§å­˜åœ¨å´ä¸å®¹æ˜“å¯Ÿè§‰æˆ–å¯è§çš„çŠ¶æ€ï¼Œä½†å®ƒä»ä»¥éšè—æˆ–æ½œåœ¨çš„å½¢å¼å­˜åœ¨ã€‚\nè¿™ä¸ªå®šä¹‰éå¸¸é…·ï¼Œå› ä¸ºå®ƒå¼ºè°ƒäº†å»¶è¿Ÿæ˜¯æŒ‡æŸä»¶äº‹å‘ç”Ÿåˆ°å®ƒäº§ç”Ÿå½±å“æˆ–å˜å¾—å¯è§ä¹‹é—´çš„æ—¶é—´ã€‚\nä¾‹å¦‚ï¼Œå‡è®¾æ‚¨æ„ŸæŸ“äº†ä¸€ç§ç©ºæ°”ä¼ æ’­çš„ç—…æ¯’ï¼Œè¯¥ç—…æ¯’ä¼šå°†äººå˜æˆåƒµå°¸ã€‚æ½œä¼æœŸæ˜¯æŒ‡ä»ä½ è¢«æ„ŸæŸ“åˆ°å˜æˆåƒµå°¸ä¹‹é—´çš„æ—¶é—´ã€‚è¿™å°±æ˜¯æ½œä¼æœŸï¼šå·²ç»å‘ç”Ÿçš„äº‹æƒ…è¢«éšè—èµ·æ¥çš„æ—¶é—´ã€‚\nè®©æˆ‘ä»¬å‡è®¾æˆ‘ä»¬çš„åˆ†å¸ƒå¼ç³»ç»Ÿåªæ‰§è¡Œä¸€é¡¹é«˜çº§ä»»åŠ¡ï¼šç»™å®šä¸€ä¸ªæŸ¥è¯¢ï¼Œå®ƒä¼šè·å–ç³»ç»Ÿä¸­çš„æ‰€æœ‰æ•°æ®å¹¶è®¡ç®—ä¸€ä¸ªç»“æœã€‚æ¢å¥è¯è¯´ï¼Œå°†åˆ†å¸ƒå¼ç³»ç»Ÿè§†ä¸ºä¸€ä¸ªæ•°æ®å­˜å‚¨ï¼Œèƒ½å¤Ÿå¯¹å…¶å½“å‰å†…å®¹è¿è¡Œå•ä¸ªç¡®å®šæ€§è®¡ç®—ï¼ˆå‡½æ•°ï¼‰ï¼š\nresult = query(all data in the system) é‚£ä¹ˆï¼Œå¯¹å»¶è¿Ÿæ¥è¯´é‡è¦çš„ä¸æ˜¯æ—§æ•°æ®çš„æ•°é‡ï¼Œè€Œæ˜¯æ–°æ•°æ®åœ¨ç³»ç»Ÿä¸­â€œç”Ÿæ•ˆâ€çš„é€Ÿåº¦ã€‚ä¾‹å¦‚ï¼Œå»¶è¿Ÿå¯ä»¥æ ¹æ®å†™å…¥å¯¹è¯»è€…å¯è§æ‰€éœ€çš„æ—¶é—´æ¥è¡¡é‡ã€‚\nåŸºäºè¿™ä¸ªå®šä¹‰çš„å¦ä¸€ä¸ªå…³é”®ç‚¹æ˜¯ï¼Œå¦‚æœä»€ä¹ˆéƒ½æ²¡æœ‰å‘ç”Ÿï¼Œå°±æ²¡æœ‰â€œæ½œä¼æœŸâ€ã€‚æ•°æ®ä¸æ”¹å˜çš„ç³»ç»Ÿä¸ä¼šï¼ˆæˆ–ä¸åº”è¯¥ï¼‰å­˜åœ¨å»¶è¿Ÿé—®é¢˜ã€‚\nåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªæ— æ³•å…‹æœçš„æœ€å°å»¶è¿Ÿï¼šå…‰é€Ÿé™åˆ¶äº†ä¿¡æ¯ä¼ è¾“çš„é€Ÿåº¦ï¼Œè€Œç¡¬ä»¶ç»„ä»¶æ¯ä¸ªæ“ä½œéƒ½ä¼šäº§ç”Ÿä¸€å®šçš„æœ€å°å»¶è¿Ÿæˆæœ¬ï¼ˆä¾‹å¦‚å†…å­˜ã€ç¡¬ç›˜ä»¥åŠ CPUï¼‰ã€‚\næœ€å°å»¶è¿Ÿå¯¹æŸ¥è¯¢çš„å½±å“ç¨‹åº¦å–å†³äºè¿™äº›æŸ¥è¯¢çš„æ€§è´¨ä»¥åŠä¿¡æ¯éœ€è¦ä¼ è¾“çš„ç‰©ç†è·ç¦»ã€‚\nå¯ç”¨æ€§ï¼ˆå’Œå®¹é”™ï¼‰ å¯æ‰©å±•ç³»ç»Ÿçš„ç¬¬äºŒä¸ªæ–¹é¢æ˜¯å¯ç”¨æ€§ã€‚\nå¯ç”¨æ€§æ˜¯æŒ‡ç³»ç»Ÿå¤„äºæ­£å¸¸è¿è¡ŒçŠ¶æ€çš„æ—¶é—´æ¯”ä¾‹ã€‚å¦‚æœç”¨æˆ·æ— æ³•è®¿é—®ç³»ç»Ÿï¼Œåˆ™ç§°ç³»ç»Ÿä¸å¯ç”¨ã€‚\nåˆ†å¸ƒå¼ç³»ç»Ÿä½¿æˆ‘ä»¬èƒ½å¤Ÿå®ç°åœ¨å•ä¸€ç³»ç»Ÿä¸Šå¾ˆéš¾å®ç°çš„ç†æƒ³ç‰¹æ€§ã€‚ä¾‹å¦‚ï¼Œå•ä¸ªæœºå™¨æ— æ³•å®¹å¿ä»»ä½•æ•…éšœï¼Œå› ä¸ºå®ƒè¦ä¹ˆå‘ç”Ÿæ•…éšœï¼Œè¦ä¹ˆæ­£å¸¸è¿è¡Œã€‚\nåˆ†å¸ƒå¼ç³»ç»Ÿå¯ä»¥é‡‡ç”¨ä¸€å †ä¸å¯é çš„ç»„ä»¶ï¼Œå¹¶åœ¨å®ƒä»¬ä¹‹ä¸Šæ„å»ºä¸€ä¸ªå¯é çš„ç³»ç»Ÿã€‚\næ²¡æœ‰å†—ä½™çš„ç³»ç»Ÿåªèƒ½è¾¾åˆ°å…¶åº•å±‚ç»„ä»¶çš„å¯ç”¨æ€§ã€‚è€Œå…·å¤‡å†—ä½™çš„ç³»ç»Ÿå¯ä»¥å®¹å¿éƒ¨åˆ†æ•…éšœï¼Œä»è€Œæé«˜å¯ç”¨æ€§ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œâ€œå†—ä½™â€å¯ä»¥åœ¨ä¸åŒå±‚é¢ä¸Šæœ‰ä¸åŒçš„å«ä¹‰ï¼Œæ¯”å¦‚ç»„ä»¶ã€æœåŠ¡å™¨ã€æ•°æ®ä¸­å¿ƒç­‰ã€‚\nä»å…¬å¼ä¸Šè®²ï¼Œå¯ç”¨æ€§ä¸ºï¼š Availability = uptime / (uptime + downtime) ã€‚\nä»æŠ€æœ¯è§’åº¦æ¥çœ‹ï¼Œå¯ç”¨æ€§ä¸»è¦ä¸å®¹é”™æ€§æœ‰å…³ã€‚å› ä¸ºæ•…éšœå‘ç”Ÿçš„æ¦‚ç‡éšç€ç»„ä»¶æ•°é‡çš„å¢åŠ è€Œå¢åŠ ï¼Œç³»ç»Ÿåº”è¯¥èƒ½å¤Ÿè¿›è¡Œè¡¥å¿ï¼Œä»¥ç¡®ä¿éšç€ç»„ä»¶æ•°é‡çš„å¢åŠ ï¼Œç³»ç»Ÿçš„å¯é æ€§ä¸ä¼šé™ä½ã€‚\nä¾‹å¦‚ï¼š\nå¯ç”¨æ€§ ï¼… 90%ï¼ˆâ€œä¸€ä¸ªä¹â€ï¼‰ ä¸€ä¸ªå¤šæœˆäº† 99%ï¼ˆâ€œä¸¤ä¸ªä¹â€ï¼‰ å°‘äº 4 å¤© 99.9%ï¼ˆâ€œä¸‰ä¸ªä¹â€ï¼‰ ä¸åˆ° 9 å°æ—¶ 99.","title":"[è¯‘]ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹1.é«˜å±‚åˆ†å¸ƒå¼ç³»ç»Ÿ"},{"content":" ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹æ˜¯ä¸€æœ¬å¹¿å—æ¬¢è¿çš„èµ„æºï¼Œç”¨äºç†è§£å’Œå­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿã€‚è¯¥ä¹¦ç”±ä½œè€…Mikito Takadaæ’°å†™ï¼Œä»‹ç»äº†æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºæœ¬æ¦‚å¿µã€åŸåˆ™å’ŒæŒ‘æˆ˜ã€‚\nè¿™æœ¬ä¹¦æ¶µç›–äº†ä¸åˆ†å¸ƒå¼ç³»ç»Ÿç›¸å…³çš„å¹¿æ³›ä¸»é¢˜ï¼ŒåŒ…æ‹¬ç½‘ç»œã€å®¹é”™æ€§ã€ä¸€è‡´æ€§æ¨¡å‹ã€åˆ†å¸ƒå¼ç®—æ³•ã€å¯æ‰©å±•æ€§ç­‰ç­‰ã€‚å®ƒæ—¨åœ¨ä»¥æ¸…æ™°æ˜“æ‡‚çš„æ–¹å¼è§£é‡Šå¤æ‚çš„æ¦‚å¿µï¼Œé€‚åˆåˆå­¦è€…å’Œæœ‰ç»éªŒçš„åˆ†å¸ƒå¼ç³»ç»Ÿä»ä¸šè€…é˜…è¯»ã€‚\nåœ¨æ•´æœ¬ä¹¦ä¸­ï¼Œä½œè€…æä¾›äº†å„ç§å®é™…æ¡ˆä¾‹å’Œæ¡ˆä¾‹ç ”ç©¶ï¼Œä»¥è¯´æ˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®é™…åº”ç”¨å’Œå®è·µæ–¹é¢ã€‚å®ƒè¿˜å¼ºè°ƒäº†æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿæ¶‰åŠçš„æƒè¡¡å’Œè®¾è®¡è€ƒè™‘ï¼Œå¸®åŠ©è¯»è€…å…¨é¢ç†è§£è¿™ä¸ªä¸»é¢˜ã€‚\nã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹ä½œä¸ºå¼€æºèµ„æºï¼Œå¯ä»¥å…è´¹åœ¨çº¿è·å–ï¼Œéå¸¸é€‚åˆä»»ä½•å¯¹å­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿæ„Ÿå…´è¶£çš„äººã€‚\nåŸæ–‡é“¾æ¥ï¼šDistributed systems: for fun and profit\nä»‹ç» æˆ‘æƒ³è¦ä¸€æœ¬èƒ½å¤Ÿæ±‡é›†è®¸å¤šæœ€æ–°åˆ†å¸ƒå¼ç³»ç»Ÿï¼ˆä¾‹å¦‚ Amazon çš„ Dynamoã€Google çš„ BigTable å’Œ MapReduceã€Apache çš„ Hadoop ç­‰ç³»ç»Ÿï¼‰èƒŒåçš„æ€æƒ³çš„æ–‡æœ¬ã€‚\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘è¯•å›¾æä¾›æ›´æ˜“äºç†è§£çš„åˆ†å¸ƒå¼ç³»ç»Ÿä»‹ç»ã€‚å¯¹æˆ‘æ¥è¯´ï¼Œè¿™æ„å‘³ç€ä¸¤ä»¶äº‹ï¼šä»‹ç»æ‚¨éœ€è¦çš„å…³é”®æ¦‚å¿µï¼Œä»¥ä¾¿æ‚¨å¯ä»¥æ„‰å¿«åœ°é˜…è¯»æ›´ä¸¥è‚ƒçš„æ–‡æœ¬ï¼Œå¹¶æä¾›è¶³å¤Ÿè¯¦ç»†çš„å™è¿°ï¼Œä»¥ä¾¿æ‚¨äº†è§£æ­£åœ¨å‘ç”Ÿçš„äº‹æƒ…çš„è¦ç‚¹ï¼Œè€Œä¸ä¼šé™·å…¥å›°å¢ƒå…³äºç»†èŠ‚ã€‚ç°åœ¨æ˜¯ 2013 å¹´ï¼Œæ‚¨å·²ç»æœ‰äº†äº’è”ç½‘ï¼Œæ‚¨å¯ä»¥æœ‰é€‰æ‹©åœ°é˜…è¯»æ›´å¤šæ‚¨è®¤ä¸ºæœ€æ„Ÿå…´è¶£çš„ä¸»é¢˜ã€‚\nåœ¨æˆ‘çœ‹æ¥ï¼Œåˆ†å¸ƒå¼ç¼–ç¨‹çš„å¤§éƒ¨åˆ†å†…å®¹éƒ½æ˜¯å…³äºå¤„ç†åˆ†å¸ƒå¼çš„ä¸¤ä¸ªåæœçš„å½±å“ï¼š\nä¿¡æ¯ä»¥å…‰é€Ÿä¼ æ’­ ç‹¬ç«‹çš„äº‹ç‰©ä¼šç‹¬ç«‹å¤±è´¥ æ¢å¥è¯è¯´ï¼Œåˆ†å¸ƒå¼ç¼–ç¨‹çš„æ ¸å¿ƒæ˜¯å¤„ç†è·ç¦»ï¼ˆåºŸè¯ï¼ï¼‰å¹¶ä¸”æ‹¥æœ‰ä¸æ­¢ä¸€ä»¶äº‹ï¼ˆåºŸè¯ï¼ï¼‰ã€‚è¿™äº›çº¦æŸå®šä¹‰äº†å¯èƒ½çš„ç³»ç»Ÿè®¾è®¡ç©ºé—´ï¼Œæˆ‘å¸Œæœ›è¯»å®Œæœ¬æ–‡åæ‚¨å°†æ›´å¥½åœ°äº†è§£è·ç¦»ã€æ—¶é—´å’Œä¸€è‡´æ€§æ¨¡å‹å¦‚ä½•ç›¸äº’ä½œç”¨ã€‚\næœ¬æ–‡é‡ç‚¹ä»‹ç»ç†è§£æ•°æ®ä¸­å¿ƒå•†ä¸šç³»ç»Ÿæ‰€éœ€çš„åˆ†å¸ƒå¼ç¼–ç¨‹å’Œç³»ç»Ÿæ¦‚å¿µã€‚è¯•å›¾æ¶µç›–ä¸€åˆ‡å°†æ˜¯ç–¯ç‹‚çš„ã€‚æ‚¨å°†å­¦ä¹ è®¸å¤šå…³é”®åè®®å’Œç®—æ³•ï¼ˆä¾‹å¦‚ï¼Œæ¶µç›–è¯¥å­¦ç§‘ä¸­è®¸å¤šè¢«å¼•ç”¨æ¬¡æ•°æœ€å¤šçš„è®ºæ–‡ï¼‰ï¼ŒåŒ…æ‹¬ä¸€äº›å°šæœªè¿›å…¥å¤§å­¦æ•™ç§‘ä¹¦çš„æœ€ç»ˆä¸€è‡´æ€§çš„ä»¤äººå…´å¥‹çš„æ–°æ–¹æ³• - ä¾‹å¦‚ CRDTå’Œ CALM å®šç†ã€‚\næˆ‘å¸Œæœ›ä½ å–œæ¬¢å®ƒï¼å¦‚æœæ‚¨æƒ³è¡¨è¾¾æ„Ÿè°¢ï¼Œè¯·åœ¨ Githubï¼ˆæˆ– Twitterï¼‰ä¸Šå…³æ³¨æˆ‘ã€‚å¦‚æœå‘ç°é”™è¯¯ï¼Œè¯·åœ¨ Github ä¸Šæäº¤æ‹‰å–è¯·æ±‚ã€‚\n1. åŸºç¡€çŸ¥è¯† ç¬¬ä¸€ç« é€šè¿‡ä»‹ç»ä¸€äº›é‡è¦çš„æœ¯è¯­å’Œæ¦‚å¿µï¼Œä»é«˜å±‚æ¬¡ä¸Šä»‹ç»äº†åˆ†å¸ƒå¼ç³»ç»Ÿã€‚å®ƒæ¶µç›–äº†é«˜çº§åˆ«ç›®æ ‡ï¼Œä¾‹å¦‚å¯æ‰©å±•æ€§ã€å¯ç”¨æ€§ã€æ€§èƒ½ã€å»¶è¿Ÿå’Œå®¹é”™ï¼›è¿™äº›æ˜¯å¦‚ä½•éš¾ä»¥å®ç°çš„ï¼Œä»¥åŠæŠ½è±¡å’Œæ¨¡å‹ä»¥åŠåˆ†åŒºå’Œå¤åˆ¶å¦‚ä½•å‘æŒ¥ä½œç”¨ã€‚\n2. æŠ½è±¡å±‚æ¬¡çš„ä¸Šä¸‹ ç¬¬äºŒç« æ›´æ·±å…¥åœ°æ¢è®¨æŠ½è±¡å’Œä¸å¯èƒ½æ€§çš„ç»“æœã€‚å®ƒä»¥å°¼é‡‡çš„åè¨€å¼€å§‹ï¼Œç„¶åä»‹ç»ç³»ç»Ÿæ¨¡å‹ä»¥åŠå…¸å‹ç³»ç»Ÿæ¨¡å‹ä¸­æ‰€åšçš„è®¸å¤šå‡è®¾ã€‚ç„¶åè®¨è®ºäº† CAP å®šç†å¹¶æ€»ç»“äº† FLP ä¸å¯èƒ½æ€§ç»“æœã€‚ç„¶åè½¬å‘ CAP å®šç†çš„å«ä¹‰ï¼Œå…¶ä¸­ä¹‹ä¸€æ˜¯äººä»¬åº”è¯¥æ¢ç´¢å…¶ä»–ä¸€è‡´æ€§æ¨¡å‹ã€‚ç„¶åè®¨è®ºäº†è®¸å¤šä¸€è‡´æ€§æ¨¡å‹ã€‚\n3. æ—¶é—´åŠé¡ºåº ç†è§£åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†æ˜¯ç†è§£æ—¶é—´å’Œé¡ºåºã€‚å¦‚æœæˆ‘ä»¬æ— æ³•ç†è§£å’Œå»ºæ¨¡æ—¶é—´ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿå°±ä¼šå¤±è´¥ã€‚ç¬¬ä¸‰ç« è®¨è®ºæ—¶é—´å’Œé¡ºåºã€æ—¶é’Ÿä»¥åŠæ—¶é—´ã€é¡ºåºå’Œæ—¶é’Ÿçš„å„ç§ç”¨é€”ï¼ˆä¾‹å¦‚çŸ¢é‡æ—¶é’Ÿå’Œæ•…éšœæ£€æµ‹å™¨ï¼‰ã€‚\n4. å¤åˆ¶ï¼šé˜²æ­¢å‘æ•£ ç¬¬å››ç« ä»‹ç»äº†å¤åˆ¶é—®é¢˜ä»¥åŠæ‰§è¡Œè¯¥é—®é¢˜çš„ä¸¤ç§åŸºæœ¬æ–¹æ³•ã€‚äº‹å®è¯æ˜ï¼Œå¤§å¤šæ•°ç›¸å…³ç‰¹å¾éƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªç®€å•çš„è¡¨å¾æ¥è®¨è®ºã€‚ç„¶åï¼Œä»æœ€ä½å®¹é”™ï¼ˆ2PCï¼‰åˆ°Paxosè®¨è®ºäº†ç»´æŒå•å‰¯æœ¬ä¸€è‡´æ€§çš„å¤åˆ¶æ–¹æ³•ã€‚\n5. å¤åˆ¶ï¼šæ¥å—åˆ†æ­§ ç¬¬äº”ç« è®¨è®ºäº†å…·æœ‰å¼±ä¸€è‡´æ€§ä¿è¯çš„å¤åˆ¶ã€‚å®ƒå¼•å…¥äº†ä¸€ä¸ªåŸºæœ¬çš„åè°ƒåœºæ™¯ï¼Œå…¶ä¸­åˆ†åŒºå‰¯æœ¬å°è¯•è¾¾æˆä¸€è‡´ã€‚ç„¶åï¼Œå®ƒè®¨è®ºäº† Amazon çš„ Dynamo ä½œä¸ºå…·æœ‰å¼±ä¸€è‡´æ€§ä¿è¯çš„ç³»ç»Ÿè®¾è®¡çš„ç¤ºä¾‹ã€‚æœ€åï¼Œè®¨è®ºäº†æ— åºç¼–ç¨‹çš„ä¸¤ä¸ªè§‚ç‚¹ï¼šCRDT å’Œ CALM å®šç†ã€‚\nAppendix é™„å½• é™„å½•åŒ…å«è¿›ä¸€æ­¥é˜…è¯»çš„å»ºè®®ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/11/09/distributed-systems-intro/","summary":"ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹æ˜¯ä¸€æœ¬å¹¿å—æ¬¢è¿çš„èµ„æºï¼Œç”¨äºç†è§£å’Œå­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿã€‚è¯¥ä¹¦ç”±ä½œè€…Mikito Takadaæ’°å†™ï¼Œä»‹ç»äº†æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºæœ¬æ¦‚å¿µã€åŸåˆ™å’ŒæŒ‘æˆ˜ã€‚\nè¿™æœ¬ä¹¦æ¶µç›–äº†ä¸åˆ†å¸ƒå¼ç³»ç»Ÿç›¸å…³çš„å¹¿æ³›ä¸»é¢˜ï¼ŒåŒ…æ‹¬ç½‘ç»œã€å®¹é”™æ€§ã€ä¸€è‡´æ€§æ¨¡å‹ã€åˆ†å¸ƒå¼ç®—æ³•ã€å¯æ‰©å±•æ€§ç­‰ç­‰ã€‚å®ƒæ—¨åœ¨ä»¥æ¸…æ™°æ˜“æ‡‚çš„æ–¹å¼è§£é‡Šå¤æ‚çš„æ¦‚å¿µï¼Œé€‚åˆåˆå­¦è€…å’Œæœ‰ç»éªŒçš„åˆ†å¸ƒå¼ç³»ç»Ÿä»ä¸šè€…é˜…è¯»ã€‚\nåœ¨æ•´æœ¬ä¹¦ä¸­ï¼Œä½œè€…æä¾›äº†å„ç§å®é™…æ¡ˆä¾‹å’Œæ¡ˆä¾‹ç ”ç©¶ï¼Œä»¥è¯´æ˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®é™…åº”ç”¨å’Œå®è·µæ–¹é¢ã€‚å®ƒè¿˜å¼ºè°ƒäº†æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿæ¶‰åŠçš„æƒè¡¡å’Œè®¾è®¡è€ƒè™‘ï¼Œå¸®åŠ©è¯»è€…å…¨é¢ç†è§£è¿™ä¸ªä¸»é¢˜ã€‚\nã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹ä½œä¸ºå¼€æºèµ„æºï¼Œå¯ä»¥å…è´¹åœ¨çº¿è·å–ï¼Œéå¸¸é€‚åˆä»»ä½•å¯¹å­¦ä¹ åˆ†å¸ƒå¼ç³»ç»Ÿæ„Ÿå…´è¶£çš„äººã€‚\nåŸæ–‡é“¾æ¥ï¼šDistributed systems: for fun and profit\nä»‹ç» æˆ‘æƒ³è¦ä¸€æœ¬èƒ½å¤Ÿæ±‡é›†è®¸å¤šæœ€æ–°åˆ†å¸ƒå¼ç³»ç»Ÿï¼ˆä¾‹å¦‚ Amazon çš„ Dynamoã€Google çš„ BigTable å’Œ MapReduceã€Apache çš„ Hadoop ç­‰ç³»ç»Ÿï¼‰èƒŒåçš„æ€æƒ³çš„æ–‡æœ¬ã€‚\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘è¯•å›¾æä¾›æ›´æ˜“äºç†è§£çš„åˆ†å¸ƒå¼ç³»ç»Ÿä»‹ç»ã€‚å¯¹æˆ‘æ¥è¯´ï¼Œè¿™æ„å‘³ç€ä¸¤ä»¶äº‹ï¼šä»‹ç»æ‚¨éœ€è¦çš„å…³é”®æ¦‚å¿µï¼Œä»¥ä¾¿æ‚¨å¯ä»¥æ„‰å¿«åœ°é˜…è¯»æ›´ä¸¥è‚ƒçš„æ–‡æœ¬ï¼Œå¹¶æä¾›è¶³å¤Ÿè¯¦ç»†çš„å™è¿°ï¼Œä»¥ä¾¿æ‚¨äº†è§£æ­£åœ¨å‘ç”Ÿçš„äº‹æƒ…çš„è¦ç‚¹ï¼Œè€Œä¸ä¼šé™·å…¥å›°å¢ƒå…³äºç»†èŠ‚ã€‚ç°åœ¨æ˜¯ 2013 å¹´ï¼Œæ‚¨å·²ç»æœ‰äº†äº’è”ç½‘ï¼Œæ‚¨å¯ä»¥æœ‰é€‰æ‹©åœ°é˜…è¯»æ›´å¤šæ‚¨è®¤ä¸ºæœ€æ„Ÿå…´è¶£çš„ä¸»é¢˜ã€‚\nåœ¨æˆ‘çœ‹æ¥ï¼Œåˆ†å¸ƒå¼ç¼–ç¨‹çš„å¤§éƒ¨åˆ†å†…å®¹éƒ½æ˜¯å…³äºå¤„ç†åˆ†å¸ƒå¼çš„ä¸¤ä¸ªåæœçš„å½±å“ï¼š\nä¿¡æ¯ä»¥å…‰é€Ÿä¼ æ’­ ç‹¬ç«‹çš„äº‹ç‰©ä¼šç‹¬ç«‹å¤±è´¥ æ¢å¥è¯è¯´ï¼Œåˆ†å¸ƒå¼ç¼–ç¨‹çš„æ ¸å¿ƒæ˜¯å¤„ç†è·ç¦»ï¼ˆåºŸè¯ï¼ï¼‰å¹¶ä¸”æ‹¥æœ‰ä¸æ­¢ä¸€ä»¶äº‹ï¼ˆåºŸè¯ï¼ï¼‰ã€‚è¿™äº›çº¦æŸå®šä¹‰äº†å¯èƒ½çš„ç³»ç»Ÿè®¾è®¡ç©ºé—´ï¼Œæˆ‘å¸Œæœ›è¯»å®Œæœ¬æ–‡åæ‚¨å°†æ›´å¥½åœ°äº†è§£è·ç¦»ã€æ—¶é—´å’Œä¸€è‡´æ€§æ¨¡å‹å¦‚ä½•ç›¸äº’ä½œç”¨ã€‚\næœ¬æ–‡é‡ç‚¹ä»‹ç»ç†è§£æ•°æ®ä¸­å¿ƒå•†ä¸šç³»ç»Ÿæ‰€éœ€çš„åˆ†å¸ƒå¼ç¼–ç¨‹å’Œç³»ç»Ÿæ¦‚å¿µã€‚è¯•å›¾æ¶µç›–ä¸€åˆ‡å°†æ˜¯ç–¯ç‹‚çš„ã€‚æ‚¨å°†å­¦ä¹ è®¸å¤šå…³é”®åè®®å’Œç®—æ³•ï¼ˆä¾‹å¦‚ï¼Œæ¶µç›–è¯¥å­¦ç§‘ä¸­è®¸å¤šè¢«å¼•ç”¨æ¬¡æ•°æœ€å¤šçš„è®ºæ–‡ï¼‰ï¼ŒåŒ…æ‹¬ä¸€äº›å°šæœªè¿›å…¥å¤§å­¦æ•™ç§‘ä¹¦çš„æœ€ç»ˆä¸€è‡´æ€§çš„ä»¤äººå…´å¥‹çš„æ–°æ–¹æ³• - ä¾‹å¦‚ CRDTå’Œ CALM å®šç†ã€‚\næˆ‘å¸Œæœ›ä½ å–œæ¬¢å®ƒï¼å¦‚æœæ‚¨æƒ³è¡¨è¾¾æ„Ÿè°¢ï¼Œè¯·åœ¨ Githubï¼ˆæˆ– Twitterï¼‰ä¸Šå…³æ³¨æˆ‘ã€‚å¦‚æœå‘ç°é”™è¯¯ï¼Œè¯·åœ¨ Github ä¸Šæäº¤æ‹‰å–è¯·æ±‚ã€‚\n1. åŸºç¡€çŸ¥è¯† ç¬¬ä¸€ç« é€šè¿‡ä»‹ç»ä¸€äº›é‡è¦çš„æœ¯è¯­å’Œæ¦‚å¿µï¼Œä»é«˜å±‚æ¬¡ä¸Šä»‹ç»äº†åˆ†å¸ƒå¼ç³»ç»Ÿã€‚å®ƒæ¶µç›–äº†é«˜çº§åˆ«ç›®æ ‡ï¼Œä¾‹å¦‚å¯æ‰©å±•æ€§ã€å¯ç”¨æ€§ã€æ€§èƒ½ã€å»¶è¿Ÿå’Œå®¹é”™ï¼›è¿™äº›æ˜¯å¦‚ä½•éš¾ä»¥å®ç°çš„ï¼Œä»¥åŠæŠ½è±¡å’Œæ¨¡å‹ä»¥åŠåˆ†åŒºå’Œå¤åˆ¶å¦‚ä½•å‘æŒ¥ä½œç”¨ã€‚\n2. æŠ½è±¡å±‚æ¬¡çš„ä¸Šä¸‹ ç¬¬äºŒç« æ›´æ·±å…¥åœ°æ¢è®¨æŠ½è±¡å’Œä¸å¯èƒ½æ€§çš„ç»“æœã€‚å®ƒä»¥å°¼é‡‡çš„åè¨€å¼€å§‹ï¼Œç„¶åä»‹ç»ç³»ç»Ÿæ¨¡å‹ä»¥åŠå…¸å‹ç³»ç»Ÿæ¨¡å‹ä¸­æ‰€åšçš„è®¸å¤šå‡è®¾ã€‚ç„¶åè®¨è®ºäº† CAP å®šç†å¹¶æ€»ç»“äº† FLP ä¸å¯èƒ½æ€§ç»“æœã€‚ç„¶åè½¬å‘ CAP å®šç†çš„å«ä¹‰ï¼Œå…¶ä¸­ä¹‹ä¸€æ˜¯äººä»¬åº”è¯¥æ¢ç´¢å…¶ä»–ä¸€è‡´æ€§æ¨¡å‹ã€‚ç„¶åè®¨è®ºäº†è®¸å¤šä¸€è‡´æ€§æ¨¡å‹ã€‚\n3. æ—¶é—´åŠé¡ºåº ç†è§£åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†æ˜¯ç†è§£æ—¶é—´å’Œé¡ºåºã€‚å¦‚æœæˆ‘ä»¬æ— æ³•ç†è§£å’Œå»ºæ¨¡æ—¶é—´ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿå°±ä¼šå¤±è´¥ã€‚ç¬¬ä¸‰ç« è®¨è®ºæ—¶é—´å’Œé¡ºåºã€æ—¶é’Ÿä»¥åŠæ—¶é—´ã€é¡ºåºå’Œæ—¶é’Ÿçš„å„ç§ç”¨é€”ï¼ˆä¾‹å¦‚çŸ¢é‡æ—¶é’Ÿå’Œæ•…éšœæ£€æµ‹å™¨ï¼‰ã€‚\n4. å¤åˆ¶ï¼šé˜²æ­¢å‘æ•£ ç¬¬å››ç« ä»‹ç»äº†å¤åˆ¶é—®é¢˜ä»¥åŠæ‰§è¡Œè¯¥é—®é¢˜çš„ä¸¤ç§åŸºæœ¬æ–¹æ³•ã€‚äº‹å®è¯æ˜ï¼Œå¤§å¤šæ•°ç›¸å…³ç‰¹å¾éƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªç®€å•çš„è¡¨å¾æ¥è®¨è®ºã€‚ç„¶åï¼Œä»æœ€ä½å®¹é”™ï¼ˆ2PCï¼‰åˆ°Paxosè®¨è®ºäº†ç»´æŒå•å‰¯æœ¬ä¸€è‡´æ€§çš„å¤åˆ¶æ–¹æ³•ã€‚\n5. å¤åˆ¶ï¼šæ¥å—åˆ†æ­§ ç¬¬äº”ç« è®¨è®ºäº†å…·æœ‰å¼±ä¸€è‡´æ€§ä¿è¯çš„å¤åˆ¶ã€‚å®ƒå¼•å…¥äº†ä¸€ä¸ªåŸºæœ¬çš„åè°ƒåœºæ™¯ï¼Œå…¶ä¸­åˆ†åŒºå‰¯æœ¬å°è¯•è¾¾æˆä¸€è‡´ã€‚ç„¶åï¼Œå®ƒè®¨è®ºäº† Amazon çš„ Dynamo ä½œä¸ºå…·æœ‰å¼±ä¸€è‡´æ€§ä¿è¯çš„ç³»ç»Ÿè®¾è®¡çš„ç¤ºä¾‹ã€‚æœ€åï¼Œè®¨è®ºäº†æ— åºç¼–ç¨‹çš„ä¸¤ä¸ªè§‚ç‚¹ï¼šCRDT å’Œ CALM å®šç†ã€‚\nAppendix é™„å½• é™„å½•åŒ…å«è¿›ä¸€æ­¥é˜…è¯»çš„å»ºè®®ã€‚","title":"[è¯‘]ã€Šåˆ†å¸ƒå¼ç³»ç»Ÿï¼šä¸ºäº†ä¹è¶£å’Œåˆ©ç›Šã€‹ä»‹ç»"},{"content":"JHipster æ˜¯ä¸€ä¸ªå¼€å‘å¹³å°ï¼Œå¯ä»¥å¿«é€Ÿç”Ÿæˆï¼Œå¼€å‘å’Œéƒ¨ç½²ç°ä»£ Web åº”ç”¨ç¨‹åº+å¾®æœåŠ¡æ¶æ„ã€‚\nJHipster æˆ–è€…ç§° Java Hipsterï¼Œæ˜¯ä¸€ä¸ªåº”ç”¨ä»£ç äº§ç”Ÿå™¨ï¼Œèƒ½å¤Ÿåˆ›å»º Spring Boot/Spring Cloud + React/VueJs/AngularJS çš„åº”ç”¨ã€‚ä½¿ç”¨ JHipsterï¼Œé¦–å…ˆä½ è¦é…ç½®å¥½ Java ã€Git ä»¥åŠ Maven æˆ–è€… Gradle çš„ç¯å¢ƒï¼Œç„¶åé€šè¿‡ NodeJs ç®¡ç†å·¥å…·å®‰è£… JHipster ã€‚\nä»‹ç» JHipster å®˜ç½‘ï¼š https://www.jhipster.tech/ ï¼Œæˆªæ­¢æœ¬æ–‡å‘å¸ƒæ—¶ï¼Œæœ€æ–°ç‰ˆæœ¬ä¸º 8.0.0 ã€‚\nJHipster å®¢æˆ·ç«¯ä½¿ç”¨åˆ°çš„æŠ€æœ¯æ ˆæœ‰ï¼š\næœåŠ¡ç«¯ä½¿ç”¨çš„æŠ€æœ¯æ ˆæœ‰ï¼š\næ”¯æŒä»¥ä¸‹éƒ¨ç½²æ–¹å¼ï¼š\nJHipster æä¾›äº†ä¸€ä¸ª CLI å·¥å…· generator-jhipster å’Œåœ¨çº¿ç½‘ç«™ https://start.jhipster.tech/ ï¼Œæ¥åˆ›å»ºåº”ç”¨ã€‚generator-jhipster æ”¯æŒæœ¬åœ°å®‰è£…å’Œ docker å®‰è£…ä¸¤ç§æ–¹å¼ã€‚å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªè½»é‡çº§çš„å®šåˆ¶å·¥å…· jhipseter-lite å¯ä»¥æ›´ç»†åŠ›åº¦çš„å®šåˆ¶ã€‚\nJHipster Pro æ˜¯ä¸€ä¸ª JHipster å›½å†…è½åœ°æ–¹æ¡ˆï¼Œç¬¦åˆå›½æƒ…çš„ä»£ç ç”Ÿæˆå™¨è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒ MyBatisã€SMSã€OSSã€‚å½“å‰æœ€æ–°ç‰ˆæœ¬å¯¹åº” JHipster å®˜æ–¹ç‰ˆæœ¬ï¼šv7.1.0ï¼Œç½‘ç«™æœ€è¿‘ä¸€æ¬¡è·Ÿæ–°æ˜¯åœ¨ 2021 å¹´ 8 æœˆä»½ã€‚\nå®‰è£… generator-jhipster å‰ææ¡ä»¶å®‰è£… Java å’Œ NodeJsï¼Œç„¶åé€šè¿‡ npm æˆ–è€… yarn å®‰è£… generator-jhipsterã€‚ä»¥ä¸‹æ˜¯é€šè¿‡ npm å®‰è£…ï¼š\nnpm install -g generator-jhipster æŸ¥çœ‹ç‰ˆæœ¬ï¼š\n$ npx jhipster --version 8.0.0-rc.1 å¦å¤–ï¼Œå¯ä»¥åœ¨ docker é‡Œé¢å®‰è£…ï¼š\ndocker image pull jhipster/jhipster docker container run --name jhipster -v ~/jhipster:/home/jhipster/app -v ~/.m2:/home/jhipster/.m2 -p 8080:8080 -p 9000:9000 -p 3001:3001 -d -t jhipster/jhipster docker container exec -it jhipster bash åˆ›å»ºåº”ç”¨ ä¸ºäº†æ–¹ä¾¿ç ”ç©¶ä»£ç ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒæŠ€æœ¯åˆ†å¤šæ¬¡åˆ›å»ºåº”ç”¨ã€‚\né¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªæœ€å°åŒ–çš„ç®€å•åº”ç”¨ï¼š\nmkdir jhipster-simple-demo è½¬åˆ°è¯¥ç›®å½•ï¼š\ncd jhipster-simple-demo/ è¦ç”Ÿæˆæ‚¨çš„åº”ç”¨ç¨‹åºï¼Œè¯·è¾“å…¥ï¼š\njhipster æ¥ä¸‹æ¥æ ¹æ®ä½ çš„éœ€æ±‚æ¥è¿›è¡Œé€‰æ‹©ï¼Œæ¯”å¦‚ï¼Œæˆ‘éœ€è¦åˆ›å»ºä¸€ä¸ªæœ€å°åŒ–çš„å•ä½“åº”ç”¨ï¼Œåˆ™é€‰æ‹©å¦‚ä¸‹ï¼š\nå•ä½“åº”ç”¨ ä½¿ç”¨ Gatling æµ‹è¯•æ¡†æ¶ ä¸ä½¿ç”¨ Spring WebFlux ä½¿ç”¨ HTTP Session Authentication è®¤è¯ ä¸ä½¿ç”¨æ•°æ®åº“ ä¸ä½¿ç”¨ç¼“å­˜ ä½¿ç”¨ Maven ä½¿ç”¨ OpenAPI-generator ä¸ç”Ÿæˆå‰ç«¯å®¢æˆ·ç«¯ ä½¿ç”¨å›½é™…åŒ– å¯¹åº”ä½¿ç”¨ maven çš„é¡¹ç›®ï¼Œå¦‚ä¸‹æ–¹å¼å¯åŠ¨åº”ç”¨ï¼š\n./mvnw #æˆ–è€… ./mvnw spring-boot:run ä¸å‡ºæ„å¤–çš„è¯ï¼Œå°±å¯ä»¥çœ‹åˆ°é¡¹ç›®é¡ºåˆ©çš„è·‘èµ·æ¥äº†ã€‚å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ http://127.0.0.1:8080 æŸ¥çœ‹åº”ç”¨çš„è¿è¡Œæƒ…å†µã€‚ é»˜è®¤çš„ç™»å½•ç”¨æˆ·åå’Œå¯†ç éƒ½æ˜¯ adminã€‚\nå¦‚æœä½ é€‰æ‹©äº†æ•°æ®åº“æˆ–è€…ç¼“å­˜ï¼Œåˆ™éœ€è¦ä½¿ç”¨ docker å¯åŠ¨å®¹å™¨ã€‚\næ¯”å¦‚ï¼Œå¯åŠ¨ mysqlï¼š\ndocker compose -f src/main/docker/mysql.yml up -d å¯åŠ¨ redisï¼š\ndocker compose -f src/main/docker/redis.yml up -d Maven æ’ä»¶ 1ã€Maven ç¦»çº¿ç¼–è¯‘æ–¹æ³• å‚è€ƒæ–‡ç«  https://xdcsy.github.io/Text/Section0038.xhtml ã€‚\n./mvnw dependency:go-offline 2ã€jib-maven-plugin jib-maven-plugin æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºå’Œæ¨é€ Docker é•œåƒçš„ Maven æ’ä»¶ã€‚å®ƒå¯ä»¥ç®€åŒ–å°†åº”ç”¨ç¨‹åºæ‰“åŒ…ä¸º Docker é•œåƒå¹¶å°†å…¶æ¨é€åˆ°å®¹å™¨æ³¨å†Œè¡¨çš„è¿‡ç¨‹ã€‚\nç›¸å…³ç¤ºä¾‹ï¼Œå¯ä»¥å‚è€ƒ https://github.com/GoogleContainerTools/jib/tree/master/examples ã€‚\n3ã€spring-boot-maven-plugin \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${spring-boot.version}\u0026lt;/version\u0026gt; \u0026lt;executions\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;repackage\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;/executions\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;mainClass\u0026gt;${start-class}\u0026lt;/mainClass\u0026gt; \u0026lt;!-- Enable the line below to have remote debugging of your application on port 5005 \u0026lt;jvmArguments\u0026gt;-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005\u0026lt;/jvmArguments\u0026gt; --\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt; è¿è¡Œå‘½ä»¤ï¼š\n./mvnw -Dspring-boot.run.jvmArguments=\u0026#34;-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:8000\u0026#34; 4ã€maven-javadoc-plugin maven-javadoc-plugin æ˜¯ä¸€ä¸ªç”¨äºç”Ÿæˆ Java ä»£ç çš„ Javadoc æ–‡æ¡£çš„ Maven æ’ä»¶ã€‚å®ƒå¯ä»¥æ ¹æ®ä»£ç ä¸­çš„æ³¨é‡Šè‡ªåŠ¨ç”Ÿæˆè¯¦ç»†çš„ API æ–‡æ¡£ï¼Œå¹¶æ”¯æŒå®šåˆ¶åŒ–é…ç½®ã€‚\næ‰¹å¤„ç†æ¨¡å¼ä¸‹ç”Ÿæˆ Java æ–‡æ¡£ï¼š\n./mvnw javadoc:javadoc -B è§£é‡Šä¸€ä¸‹æ¯ä¸ªéƒ¨åˆ†çš„å«ä¹‰ï¼š\n./mvnwï¼šè¿™æ˜¯ Maven Wrapper çš„è„šæœ¬ï¼Œå®ƒå…è®¸ä½ åœ¨æ²¡æœ‰å…¨å±€ Maven å®‰è£…çš„æƒ…å†µä¸‹è¿è¡Œ Maven å‘½ä»¤ã€‚./mvnwæ˜¯ç”¨äº Unix/Linux ç³»ç»Ÿçš„è„šæœ¬ï¼Œå¦‚æœä½ åœ¨ Windows ç³»ç»Ÿä¸Šè¿è¡Œï¼Œè¯·ä½¿ç”¨mvnwï¼ˆæ— å‰ç¼€çš„ç‚¹å’Œæ–œæ ï¼‰ã€‚ -ntpï¼šè¿™æ˜¯--no-transfer-progressçš„ç¼©å†™ï¼Œå®ƒç¦ç”¨ä¼ è¾“è¿›åº¦çš„æ˜¾ç¤ºã€‚è¿™æ ·åšå¯ä»¥å‡å°‘è¾“å‡ºï¼Œä½¿å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹æ›´åŠ ç®€æ´ã€‚ javadoc:javadocï¼šè¿™æ˜¯ Maven æ’ä»¶çš„ç›®æ ‡ï¼Œç”¨äºç”Ÿæˆ Javadoc æ–‡æ¡£ã€‚é€šè¿‡æ‰§è¡Œæ­¤ç›®æ ‡ï¼ŒMaven å°†å¤„ç†é¡¹ç›®æºä»£ç å¹¶ç”Ÿæˆç›¸åº”çš„ Javadoc æ–‡æ¡£ã€‚ --batch-modeï¼šè¿™æ˜¯æŒ‡å®š Maven åœ¨æ‰¹å¤„ç†æ¨¡å¼ä¸‹è¿è¡Œçš„é€‰é¡¹ã€‚æ‰¹å¤„ç†æ¨¡å¼ç¦ç”¨äº¤äº’å¼æ¨¡å¼ï¼Œä½¿å¾— Maven å‘½ä»¤ä¸ä¼šè¦æ±‚ç”¨æˆ·è¾“å…¥ã€‚ 5ã€maven-enforcer-plugin maven-enforcer-plugin æ˜¯ä¸€ä¸ªç”¨äºå¼ºåˆ¶æ‰§è¡Œ Maven æ„å»ºè§„åˆ™çš„æ’ä»¶ã€‚å®ƒå¯ä»¥å¸®åŠ©å›¢é˜Ÿç¡®ä¿é¡¹ç›®çš„æ„å»ºç¬¦åˆç‰¹å®šçš„è¦æ±‚å’Œè§„èŒƒã€‚\n\u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-enforcer-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.4.1\u0026lt;/version\u0026gt; \u0026lt;executions\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;id\u0026gt;enforce-versions\u0026lt;/id\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;enforce\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;id\u0026gt;enforce-dependencyConvergence\u0026lt;/id\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;rules\u0026gt; \u0026lt;DependencyConvergence/\u0026gt; \u0026lt;/rules\u0026gt; \u0026lt;fail\u0026gt;false\u0026lt;/fail\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;enforce\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;/executions\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;rules\u0026gt; \u0026lt;requireMavenVersion\u0026gt; \u0026lt;message\u0026gt;You are running an older version of Maven. JHipster requires at least Maven 3.2.5\u0026lt;/message\u0026gt; \u0026lt;version\u0026gt;[3.2.5,)\u0026lt;/version\u0026gt; \u0026lt;/requireMavenVersion\u0026gt; \u0026lt;requireJavaVersion\u0026gt; \u0026lt;message\u0026gt;You are running an incompatible version of Java. JHipster supports JDK 17 to 21.\u0026lt;/message\u0026gt; \u0026lt;version\u0026gt;[17,18),[18,19),[19,20),[20,21),[21,22)\u0026lt;/version\u0026gt; \u0026lt;/requireJavaVersion\u0026gt; \u0026lt;/rules\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt; 6ã€spotless-maven-plugin spotless-maven-plugin æ˜¯ä¸€ä¸ªç”¨äºåœ¨ Maven æ„å»ºè¿‡ç¨‹ä¸­æ‰§è¡Œä»£ç æ ¼å¼åŒ–çš„æ’ä»¶ã€‚å®ƒå¯ä»¥å¸®åŠ©å›¢é˜Ÿä¿æŒä¸€è‡´çš„ä»£ç é£æ ¼ï¼Œå¹¶è‡ªåŠ¨ä¿®å¤æ ¼å¼é”™è¯¯ã€‚\n\u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;com.diffplug.spotless\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spotless-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.40.0\u0026lt;/version\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;java\u0026gt; \u0026lt;!-- \u0026lt;removeUnusedImports/\u0026gt; --\u0026gt; \u0026lt;/java\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;executions\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;id\u0026gt;spotless\u0026lt;/id\u0026gt; \u0026lt;phase\u0026gt;process-sources\u0026lt;/phase\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;apply\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;/executions\u0026gt; \u0026lt;/plugin\u0026gt; 7ã€modernizer-maven-plugin modernizer-maven-plugin æ˜¯ä¸€ä¸ªç”¨äºåœ¨ Maven æ„å»ºè¿‡ç¨‹ä¸­æ‰§è¡Œä»£ç ç°ä»£åŒ–åˆ†æçš„æ’ä»¶ã€‚å®ƒå¯ä»¥å¸®åŠ©å›¢é˜Ÿè¯†åˆ«è¿‡æ—¶çš„ä»£ç å’Œä½¿ç”¨ä¸æ¨èçš„ APIï¼Œä»¥ä¾¿è¿›è¡Œæ›´æ–°å’Œä¿®å¤ã€‚\n\u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.gaul\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;modernizer-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.7.0\u0026lt;/version\u0026gt; \u0026lt;executions\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;id\u0026gt;modernizer\u0026lt;/id\u0026gt; \u0026lt;phase\u0026gt;package\u0026lt;/phase\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;modernizer\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;/executions\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;javaVersion\u0026gt;17\u0026lt;/javaVersion\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt; 8ã€sonar-maven-plugin sonar-maven-plugin æ˜¯ä¸€ä¸ªç”¨äºä¸ SonarQube é›†æˆçš„ Maven æ’ä»¶ã€‚SonarQube æ˜¯ä¸€ä¸ªç”¨äºé™æ€ä»£ç åˆ†æã€ä»£ç è´¨é‡ç®¡ç†å’ŒæŒç»­é›†æˆçš„å¼€æºå¹³å°ã€‚sonar-maven-plugin å¯ä»¥å°† Maven é¡¹ç›®çš„ä»£ç å’Œåˆ†æç»“æœä¸Šä¼ åˆ° SonarQube æœåŠ¡å™¨ï¼Œå¹¶ç”Ÿæˆè¯¦ç»†çš„ä»£ç è´¨é‡æŠ¥å‘Šã€‚\n\u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.sonarsource.scanner.maven\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;sonar-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.10.0.2594\u0026lt;/version\u0026gt; \u0026lt;/plugin\u0026gt; å¯åŠ¨ docker å®¹å™¨ï¼š\ndocker compose -f src/main/docker/sonar.yml up -d è¿è¡Œï¼š\n./mvnw -Pprod clean verify sonar:sonar -Dsonar.login=admin -Dsonar.password=admin å†æ¬¡è¿è¡Œï¼š\n./mvnw initialize sonar:sonar -Dsonar.login=admin -Dsonar.password=admin Sonar çš„é…ç½®æ–‡ä»¶ sonar-project.properties æ˜¯é€šè¿‡ maven æ’ä»¶åŠ è½½çš„ã€‚\n\u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.codehaus.mojo\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;properties-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${properties-maven-plugin.version}\u0026lt;/version\u0026gt; \u0026lt;executions\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;phase\u0026gt;initialize\u0026lt;/phase\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;read-project-properties\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;files\u0026gt; \u0026lt;file\u0026gt;sonar-project.properties\u0026lt;/file\u0026gt; \u0026lt;/files\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;/executions\u0026gt; \u0026lt;/plugin\u0026gt; 9ã€jacoco-maven-plugin jacoco-maven-plugin æ˜¯ä¸€ä¸ªç”¨äºåœ¨ Maven é¡¹ç›®ä¸­ç”Ÿæˆä»£ç è¦†ç›–ç‡æŠ¥å‘Šçš„æ’ä»¶ã€‚å®ƒä½¿ç”¨ JaCoCoï¼ˆJava Code Coverageï¼‰å·¥å…·æ¥åˆ†æé¡¹ç›®çš„æµ‹è¯•è¦†ç›–ç‡ï¼Œå¹¶ç”Ÿæˆè¯¦ç»†çš„æŠ¥å‘Šï¼Œå¸®åŠ©å¼€å‘å›¢é˜Ÿè¯„ä¼°æµ‹è¯•çš„æœ‰æ•ˆæ€§å’Œä»£ç è´¨é‡ã€‚\n\u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.jacoco\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jacoco-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${jacoco-maven-plugin.version}\u0026lt;/version\u0026gt; \u0026lt;executions\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;id\u0026gt;pre-unit-tests\u0026lt;/id\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;prepare-agent\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;!-- Ensures that the code coverage report for unit tests is created after unit tests have been run --\u0026gt; \u0026lt;id\u0026gt;post-unit-test\u0026lt;/id\u0026gt; \u0026lt;phase\u0026gt;test\u0026lt;/phase\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;report\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;id\u0026gt;pre-integration-tests\u0026lt;/id\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;prepare-agent-integration\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;!-- Ensures that the code coverage report for integration tests is created after integration tests have been run --\u0026gt; \u0026lt;id\u0026gt;post-integration-tests\u0026lt;/id\u0026gt; \u0026lt;phase\u0026gt;post-integration-test\u0026lt;/phase\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;report-integration\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;/executions\u0026gt; \u0026lt;/plugin\u0026gt; 10ã€openapi-generator-maven-plugin ç”¨äºæ ¹æ® OpenAPI è§„èŒƒï¼ˆä»¥å‰ç§°ä¸º Swagger è§„èŒƒï¼‰ç”Ÿæˆå®¢æˆ·ç«¯ä»£ç æˆ–æœåŠ¡å™¨ç«¯æ¡†æ¶ã€‚\n\u0026lt;plugin\u0026gt; \u0026lt;!-- Plugin that provides API-first development using openapi-generator-cli to generate Spring-MVC endpoint stubs at compile time from an OpenAPI definition file --\u0026gt; \u0026lt;groupId\u0026gt;org.openapitools\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;openapi-generator-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${openapi-generator-maven-plugin.version}\u0026lt;/version\u0026gt; \u0026lt;executions\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;generate\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;inputSpec\u0026gt;${project.basedir}/src/main/resources/swagger/api.yml\u0026lt;/inputSpec\u0026gt; \u0026lt;generatorName\u0026gt;spring\u0026lt;/generatorName\u0026gt; \u0026lt;apiPackage\u0026gt;com.mycompany.myapp.web.api\u0026lt;/apiPackage\u0026gt; \u0026lt;modelPackage\u0026gt;com.mycompany.myapp.service.api.dto\u0026lt;/modelPackage\u0026gt; \u0026lt;supportingFilesToGenerate\u0026gt;ApiUtil.java\u0026lt;/supportingFilesToGenerate\u0026gt; \u0026lt;skipValidateSpec\u0026gt;false\u0026lt;/skipValidateSpec\u0026gt; \u0026lt;configOptions\u0026gt; \u0026lt;delegatePattern\u0026gt;true\u0026lt;/delegatePattern\u0026gt; \u0026lt;title\u0026gt;jhipster-sample-application\u0026lt;/title\u0026gt; \u0026lt;useSpringBoot3\u0026gt;true\u0026lt;/useSpringBoot3\u0026gt; \u0026lt;/configOptions\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;/executions\u0026gt; \u0026lt;/plugin\u0026gt; 11ã€frontend-maven-plugin frontend-maven-plugin æ˜¯ä¸€ä¸ª Maven æ’ä»¶ï¼Œç”¨äºåœ¨æ„å»ºè¿‡ç¨‹ä¸­æ‰§è¡Œå‰ç«¯ç›¸å…³çš„ä»»åŠ¡ï¼Œä¾‹å¦‚å®‰è£…ä¾èµ–ã€è¿è¡Œæ„å»ºè„šæœ¬ã€æ‰“åŒ…å‰ç«¯èµ„æºç­‰ã€‚å®ƒå¯ä»¥å°†å‰ç«¯å¼€å‘ä¸åç«¯æ„å»ºè¿‡ç¨‹æ— ç¼é›†æˆï¼Œç®€åŒ–äº†å¤šæ¨¡å—é¡¹ç›®çš„æ„å»ºå’Œéƒ¨ç½²ã€‚\n\u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;com.github.eirslett\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;frontend-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${frontend-maven-plugin.version}\u0026lt;/version\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;installDirectory\u0026gt;target\u0026lt;/installDirectory\u0026gt; \u0026lt;nodeVersion\u0026gt;${node.version}\u0026lt;/nodeVersion\u0026gt; \u0026lt;npmVersion\u0026gt;${npm.version}\u0026lt;/npmVersion\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt; 12ã€git-commit-id-maven-plugin git-commit-id-maven-plugin æ˜¯ä¸€ä¸ª Maven æ’ä»¶ï¼Œç”¨äºä» Git ä»£ç åº“ä¸­è·å–å½“å‰æ„å»ºçš„ Git æäº¤ä¿¡æ¯ï¼Œå¹¶å°†å…¶æ³¨å…¥åˆ°æ„å»ºè¿‡ç¨‹ä¸­ï¼Œä¾‹å¦‚ç”Ÿæˆçš„ç±»æ–‡ä»¶æˆ–èµ„æºæ–‡ä»¶ä¸­ã€‚\n\u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;io.github.git-commit-id\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;git-commit-id-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${git-commit-id-maven-plugin.version}\u0026lt;/version\u0026gt; \u0026lt;executions\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;revision\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;/executions\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;failOnNoGitDirectory\u0026gt;false\u0026lt;/failOnNoGitDirectory\u0026gt; \u0026lt;failOnUnableToExtractRepoInfo\u0026gt;false\u0026lt;/failOnUnableToExtractRepoInfo\u0026gt; \u0026lt;generateGitPropertiesFile\u0026gt;true\u0026lt;/generateGitPropertiesFile\u0026gt; \u0026lt;includeOnlyProperties\u0026gt; \u0026lt;includeOnlyProperty\u0026gt;^git.commit.id.abbrev$\u0026lt;/includeOnlyProperty\u0026gt; \u0026lt;includeOnlyProperty\u0026gt;^git.commit.id.describe$\u0026lt;/includeOnlyProperty\u0026gt; \u0026lt;includeOnlyProperty\u0026gt;^git.branch$\u0026lt;/includeOnlyProperty\u0026gt; \u0026lt;/includeOnlyProperties\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt; spring boot åŠ è½½ git.properties æ–‡ä»¶\n@Configuration class GitInfoConfiguration { @Bean public PropertySourcesPlaceholderConfigurer placeholderConfigurer() { PropertySourcesPlaceholderConfigurer propsConfig = new PropertySourcesPlaceholderConfigurer(); propsConfig.setLocation(new ClassPathResource(\u0026#34;git.properties\u0026#34;)); propsConfig.setIgnoreResourceNotFound(true); propsConfig.setIgnoreUnresolvablePlaceholders(true); return propsConfig; } } 13ã€maven-checkstyle-plugin maven-checkstyle-plugin æ˜¯ä¸€ä¸ªç”¨äºåœ¨ Maven é¡¹ç›®ä¸­æ‰§è¡Œä»£ç é£æ ¼æ£€æŸ¥çš„æ’ä»¶ã€‚å®ƒå¯ä»¥å¸®åŠ©å›¢é˜Ÿåœ¨å¼€å‘è¿‡ç¨‹ä¸­ç»´æŒä¸€è‡´çš„ä»£ç é£æ ¼ï¼Œå¹¶æä¾›é™æ€ä»£ç åˆ†æçš„åŠŸèƒ½ã€‚\n\u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-checkstyle-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${maven-checkstyle-plugin.version}\u0026lt;/version\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;configLocation\u0026gt;checkstyle.xml\u0026lt;/configLocation\u0026gt; \u0026lt;includeTestSourceDirectory\u0026gt;true\u0026lt;/includeTestSourceDirectory\u0026gt; \u0026lt;consoleOutput\u0026gt;true\u0026lt;/consoleOutput\u0026gt; \u0026lt;failsOnError\u0026gt;true\u0026lt;/failsOnError\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;executions\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;id\u0026gt;validate\u0026lt;/id\u0026gt; \u0026lt;phase\u0026gt;validate\u0026lt;/phase\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;check\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;/executions\u0026gt; \u0026lt;/plugin\u0026gt; ç”Ÿæˆ siteï¼š\n\u0026lt;reporting\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-checkstyle-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;/reporting\u0026gt; 13ã€maven-failsafe-plugin maven-failsafe-plugin æ˜¯ä¸€ä¸ªç”¨äºåœ¨ Maven é¡¹ç›®ä¸­è¿è¡Œé›†æˆæµ‹è¯•çš„æ’ä»¶ã€‚å®ƒæä¾›äº†ä¸€ç§ä¾¿æ·çš„æ–¹å¼æ¥æ‰§è¡Œå’ŒéªŒè¯é¡¹ç›®ä¸­çš„é›†æˆæµ‹è¯•ã€‚\n\u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-failsafe-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${failsafe-plugin.version}\u0026lt;/version\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;!-- Due to spring-boot repackage, without adding this property test classes are not found See https://github.com/spring-projects/spring-boot/issues/6254 --\u0026gt; \u0026lt;classesDirectory\u0026gt;${project.build.outputDirectory}\u0026lt;/classesDirectory\u0026gt; \u0026lt;!-- Force alphabetical order to have a reproducible build --\u0026gt; \u0026lt;runOrder\u0026gt;alphabetical\u0026lt;/runOrder\u0026gt; \u0026lt;includes\u0026gt; \u0026lt;include\u0026gt;**/*IT*\u0026lt;/include\u0026gt; \u0026lt;include\u0026gt;**/*CucumberTest*\u0026lt;/include\u0026gt; \u0026lt;/includes\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;executions\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;id\u0026gt;integration-test\u0026lt;/id\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;integration-test\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;id\u0026gt;verify\u0026lt;/id\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;verify\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;/executions\u0026gt; \u0026lt;/plugin\u0026gt; 14ã€maven-surefire-plugin maven-surefire-plugin æ˜¯ä¸€ä¸ªç”¨äºåœ¨ Maven é¡¹ç›®ä¸­è¿è¡Œå•å…ƒæµ‹è¯•çš„æ’ä»¶ã€‚å®ƒæä¾›äº†æ‰§è¡Œå’Œç®¡ç†å•å…ƒæµ‹è¯•çš„åŠŸèƒ½ï¼Œå¹¶ç”Ÿæˆæµ‹è¯•æŠ¥å‘Šã€‚\n\u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-surefire-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${surefire-plugin.version}\u0026lt;/version\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;!-- Force alphabetical order to have a reproducible build --\u0026gt; \u0026lt;runOrder\u0026gt;alphabetical\u0026lt;/runOrder\u0026gt; \u0026lt;excludes\u0026gt; \u0026lt;exclude\u0026gt;**/*IT*\u0026lt;/exclude\u0026gt; \u0026lt;exclude\u0026gt;**/*CucumberTest*\u0026lt;/exclude\u0026gt; \u0026lt;/excludes\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt; Docker src/main/docker ä¸­æœ‰ä¸€äº›å¸¸è§åº”ç”¨çš„ docker-compoe ç¼–æ’æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\næœ‰çš„æä¾›äº†å¥åº·æ£€æŸ¥ å®¹å™¨ç«¯å£åªæ˜ å°„åˆ° 127.0.0.1 mysql mysql.yml\n# This configuration is intended for development purpose, it\u0026#39;s **your** responsibility to harden it for production name: jhipstersampleapplication services: mysql: image: mysql:8.1.0 volumes: - ./config/mysql:/etc/mysql/conf.d # - ~/volumes/jhipster/jhipsterSampleApplication/mysql/:/var/lib/mysql/ environment: - MYSQL_ALLOW_EMPTY_PASSWORD=yes - MYSQL_DATABASE=jhipstersampleapplication # If you want to expose these ports outside your dev PC, # remove the \u0026#34;127.0.0.1:\u0026#34; prefix ports: - 127.0.0.1:3306:3306 command: mysqld --lower_case_table_names=1 --skip-ssl --character_set_server=utf8mb4 --explicit_defaults_for_timestamp healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;mysql\u0026#34;, \u0026#34;-e\u0026#34;, \u0026#34;SHOW DATABASES;\u0026#34;] interval: 5s timeout: 5s retries: 10 postgresql # This configuration is intended for development purpose, it\u0026#39;s **your** responsibility to harden it for production name: jhipstersampleapplication services: postgresql: image: postgres:16.0 # volumes: # - ~/volumes/jhipster/jhipsterSampleApplication/postgresql/:/var/lib/postgresql/data/ environment: - POSTGRES_USER=jhipsterSampleApplication - POSTGRES_PASSWORD= - POSTGRES_HOST_AUTH_METHOD=trust healthcheck: test: [\u0026#34;CMD-SHELL\u0026#34;, \u0026#34;pg_isready -U $${POSTGRES_USER}\u0026#34;] interval: 5s timeout: 5s retries: 10 # If you want to expose these ports outside your dev PC, # remove the \u0026#34;127.0.0.1:\u0026#34; prefix ports: - 127.0.0.1:5432:5432 redis redis.yml\n# This configuration is intended for development purpose, it\u0026#39;s **your** responsibility to harden it for production name: jhipstersampleapplication services: redis: image: redis:7.2.1 # If you want to expose these ports outside your dev PC, # remove the \u0026#34;127.0.0.1:\u0026#34; prefix ports: - 127.0.0.1:6379:6379 sonar sonar.yml\n# This configuration is intended for development purpose, it\u0026#39;s **your** responsibility to harden it for production name: jhipstersampleapplication services: sonar: container_name: sonarqube image: sonarqube:10.2.1-community platform: linux/x86_64 # Forced authentication redirect for UI is turned off for out of the box experience while trying out SonarQube # For real use cases delete SONAR_FORCEAUTHENTICATION variable or set SONAR_FORCEAUTHENTICATION=true environment: - SONAR_FORCEAUTHENTICATION=false # If you want to expose these ports outside your dev PC, # remove the \u0026#34;127.0.0.1:\u0026#34; prefix ports: - 127.0.0.1:9001:9000 - 127.0.0.1:9000:9000 swagger-editor # This configuration is intended for development purpose, it\u0026#39;s **your** responsibility to harden it for production name: jhipstersampleapplication services: swagger-editor: image: swaggerapi/swagger-editor:latest ports: - 127.0.0.1:7742:8080 ","permalink":"https://blog.chensoul.cc/posts/2023/11/02/jhipster-intro/","summary":"JHipster æ˜¯ä¸€ä¸ªå¼€å‘å¹³å°ï¼Œå¯ä»¥å¿«é€Ÿç”Ÿæˆï¼Œå¼€å‘å’Œéƒ¨ç½²ç°ä»£ Web åº”ç”¨ç¨‹åº+å¾®æœåŠ¡æ¶æ„ã€‚\nJHipster æˆ–è€…ç§° Java Hipsterï¼Œæ˜¯ä¸€ä¸ªåº”ç”¨ä»£ç äº§ç”Ÿå™¨ï¼Œèƒ½å¤Ÿåˆ›å»º Spring Boot/Spring Cloud + React/VueJs/AngularJS çš„åº”ç”¨ã€‚ä½¿ç”¨ JHipsterï¼Œé¦–å…ˆä½ è¦é…ç½®å¥½ Java ã€Git ä»¥åŠ Maven æˆ–è€… Gradle çš„ç¯å¢ƒï¼Œç„¶åé€šè¿‡ NodeJs ç®¡ç†å·¥å…·å®‰è£… JHipster ã€‚\nä»‹ç» JHipster å®˜ç½‘ï¼š https://www.jhipster.tech/ ï¼Œæˆªæ­¢æœ¬æ–‡å‘å¸ƒæ—¶ï¼Œæœ€æ–°ç‰ˆæœ¬ä¸º 8.0.0 ã€‚\nJHipster å®¢æˆ·ç«¯ä½¿ç”¨åˆ°çš„æŠ€æœ¯æ ˆæœ‰ï¼š\næœåŠ¡ç«¯ä½¿ç”¨çš„æŠ€æœ¯æ ˆæœ‰ï¼š\næ”¯æŒä»¥ä¸‹éƒ¨ç½²æ–¹å¼ï¼š\nJHipster æä¾›äº†ä¸€ä¸ª CLI å·¥å…· generator-jhipster å’Œåœ¨çº¿ç½‘ç«™ https://start.jhipster.tech/ ï¼Œæ¥åˆ›å»ºåº”ç”¨ã€‚generator-jhipster æ”¯æŒæœ¬åœ°å®‰è£…å’Œ docker å®‰è£…ä¸¤ç§æ–¹å¼ã€‚å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªè½»é‡çº§çš„å®šåˆ¶å·¥å…· jhipseter-lite å¯ä»¥æ›´ç»†åŠ›åº¦çš„å®šåˆ¶ã€‚\nJHipster Pro æ˜¯ä¸€ä¸ª JHipster å›½å†…è½åœ°æ–¹æ¡ˆï¼Œç¬¦åˆå›½æƒ…çš„ä»£ç ç”Ÿæˆå™¨è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒ MyBatisã€SMSã€OSSã€‚å½“å‰æœ€æ–°ç‰ˆæœ¬å¯¹åº” JHipster å®˜æ–¹ç‰ˆæœ¬ï¼šv7.1.0ï¼Œç½‘ç«™æœ€è¿‘ä¸€æ¬¡è·Ÿæ–°æ˜¯åœ¨ 2021 å¹´ 8 æœˆä»½ã€‚\nå®‰è£… generator-jhipster å‰ææ¡ä»¶å®‰è£… Java å’Œ NodeJsï¼Œç„¶åé€šè¿‡ npm æˆ–è€… yarn å®‰è£… generator-jhipsterã€‚ä»¥ä¸‹æ˜¯é€šè¿‡ npm å®‰è£…ï¼š\nnpm install -g generator-jhipster æŸ¥çœ‹ç‰ˆæœ¬ï¼š\n$ npx jhipster --version 8.0.0-rc.1 å¦å¤–ï¼Œå¯ä»¥åœ¨ docker é‡Œé¢å®‰è£…ï¼š\ndocker image pull jhipster/jhipster docker container run --name jhipster -v ~/jhipster:/home/jhipster/app -v ~/.","title":"JHipsterå®‰è£…å’Œä»‹ç»"},{"content":"æœ¬æ–‡ä¸»è¦ä»‹ç» Circuit Breaker æ–­è·¯å™¨æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nä»‹ç» æ–­è·¯å™¨æ¨¡å¼ï¼ˆCircuit Breaker Patternï¼‰æ˜¯ä¸€ç§åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¤„ç†æ•…éšœå’Œæé«˜ç³»ç»Ÿå¯é æ€§çš„è®¾è®¡æ¨¡å¼ã€‚å®ƒçš„ä¸»è¦ç›®æ ‡æ˜¯é˜²æ­¢æ•…éšœçš„ä¼ é€’ï¼Œå¹¶åœ¨æ•…éšœå‘ç”Ÿæ—¶æä¾›ä¼˜é›…çš„æ•…éšœå¤„ç†æœºåˆ¶ã€‚\nåœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸å¯é¿å…åœ°ä¼šå‡ºç°è®¸å¤šå¤–éƒ¨ä¾èµ–ï¼Œå¦‚æ•°æ®åº“ã€ç½‘ç»œæœåŠ¡ç­‰ã€‚è¿™äº›å¤–éƒ¨ä¾èµ–å¯èƒ½ä¼šå‘ç”Ÿæ•…éšœã€å»¶è¿Ÿæˆ–ä¸å¯ç”¨çš„æƒ…å†µã€‚å¦‚æœæ²¡æœ‰é€‚å½“çš„æªæ–½ï¼Œè¿™äº›æ•…éšœå¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½ä¸‹é™ï¼Œç”šè‡³ç³»ç»Ÿå´©æºƒã€‚\næ–­è·¯å™¨æ¨¡å¼é€šè¿‡åœ¨åº”ç”¨ç¨‹åºå’Œå¤–éƒ¨ä¾èµ–ä¹‹é—´å¼•å…¥ä¸€ä¸ªæ–­è·¯å™¨æ¥å£æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æ–­è·¯å™¨æ¥å£å……å½“ä¸€ä¸ªä¸­é—´å±‚ï¼Œç›‘è§†å¯¹å¤–éƒ¨ä¾èµ–çš„è°ƒç”¨ã€‚å½“å¤–éƒ¨ä¾èµ–å‘ç”Ÿæ•…éšœæ—¶ï¼Œæ–­è·¯å™¨å¯ä»¥è¿…é€Ÿåœ°ä¸­æ–­å¯¹å¤–éƒ¨ä¾èµ–çš„è°ƒç”¨ï¼Œé¿å…èµ„æºçš„æµªè´¹å’Œæ•…éšœçš„ä¼ é€’ã€‚\né™¤äº†æ–­è·¯å™¨æ¥å£ä¹‹å¤–ï¼Œæ–­è·¯å™¨æ¨¡å¼è¿˜æ¶‰åŠä»¥ä¸‹å‡ ä¸ªé‡è¦çš„çŸ¥è¯†ç‚¹ï¼š\næ•…éšœé˜ˆå€¼ï¼ˆFailure Thresholdï¼‰ï¼šæ–­è·¯å™¨æ¨¡å¼é€šè¿‡è®¾ç½®æ•…éšœé˜ˆå€¼æ¥åˆ¤æ–­æœåŠ¡çš„å¥åº·çŠ¶æ€ã€‚å½“æœåŠ¡çš„å¤±è´¥æ¬¡æ•°è¾¾åˆ°æˆ–è¶…è¿‡æ•…éšœé˜ˆå€¼æ—¶ï¼Œæ–­è·¯å™¨ä¼šæ‰“å¼€ï¼Œé˜»æ­¢å¯¹æœåŠ¡çš„è¿›ä¸€æ­¥è°ƒç”¨ã€‚ å›é€€å“åº”ï¼ˆFallback Responseï¼‰ï¼šå½“æ–­è·¯å™¨æ‰“å¼€æ—¶ï¼Œå¯ä»¥ä¸ºè°ƒç”¨æ–¹æä¾›å›é€€å“åº”ã€‚å›é€€å“åº”æ˜¯ä¸€ä¸ªé¢„å®šä¹‰çš„å“åº”ï¼Œç”¨äºä»£æ›¿æ— æ³•æ­£å¸¸è°ƒç”¨çš„æœåŠ¡çš„å“åº”ã€‚å›é€€å“åº”å¯ä»¥æ˜¯äº‹å…ˆå®šä¹‰å¥½çš„é™æ€å“åº”ï¼Œæˆ–è€…æ˜¯é€šè¿‡è°ƒç”¨å¤‡ç”¨æœåŠ¡æ¥è·å–çš„å“åº”ã€‚ æ–­è·¯å™¨çŠ¶æ€ï¼ˆCircuit Breaker Stateï¼‰ï¼šæ–­è·¯å™¨å¯ä»¥å¤„äºä¸åŒçš„çŠ¶æ€ï¼Œå¦‚å…³é—­ï¼ˆClosedï¼‰ã€æ‰“å¼€ï¼ˆOpenï¼‰å’ŒåŠå¼€ï¼ˆHalf-Openï¼‰ã€‚åˆå§‹çŠ¶æ€é€šå¸¸æ˜¯å…³é—­çŠ¶æ€ï¼Œè¡¨ç¤ºæœåŠ¡æ­£å¸¸å¯ç”¨ã€‚å½“æœåŠ¡çš„å¤±è´¥æ¬¡æ•°è¾¾åˆ°æ•…éšœé˜ˆå€¼æ—¶ï¼Œæ–­è·¯å™¨ä¼šæ‰“å¼€ï¼Œé˜»æ­¢å¯¹æœåŠ¡çš„è¿›ä¸€æ­¥è°ƒç”¨ã€‚åœ¨ä¸€å®šæ—¶é—´åï¼Œæ–­è·¯å™¨ä¼šè¿›å…¥åŠå¼€çŠ¶æ€ï¼Œå…è®¸å‘èµ·ä¸€æ¬¡æµ‹è¯•è°ƒç”¨ã€‚å¦‚æœæµ‹è¯•è°ƒç”¨æˆåŠŸï¼Œæ–­è·¯å™¨å°†é‡æ–°å…³é—­ï¼›å¦‚æœæµ‹è¯•è°ƒç”¨ä»ç„¶å¤±è´¥ï¼Œæ–­è·¯å™¨å°†é‡æ–°æ‰“å¼€ã€‚ æ–­è·¯å™¨çš„è‡ªåŠ¨æ¢å¤ï¼ˆAutomatic Recoveryï¼‰ï¼šæ–­è·¯å™¨æ¨¡å¼é€šå¸¸å…·æœ‰è‡ªåŠ¨æ¢å¤åŠŸèƒ½ã€‚åœ¨æ–­è·¯å™¨æ‰“å¼€çš„çŠ¶æ€ä¸‹ï¼Œä¸€æ®µæ—¶é—´è¿‡å»åï¼Œæ–­è·¯å™¨ä¼šå°è¯•é‡æ–°å…³é—­ï¼Œä»¥å…è®¸å¯¹æœåŠ¡çš„æ­£å¸¸è°ƒç”¨ã€‚è‡ªåŠ¨æ¢å¤å¯ä»¥é˜²æ­¢é•¿æ—¶é—´çš„æœåŠ¡ä¸­æ–­ï¼Œæä¾›ç»™æœåŠ¡ä¸€ä¸ªæœºä¼šæ¥æ¢å¤æ­£å¸¸è¿è¡Œã€‚ å¥åº·æ£€æŸ¥ï¼ˆHealth Checkï¼‰ï¼šæ–­è·¯å™¨æ¨¡å¼å¯ä»¥é€šè¿‡å®šæœŸçš„å¥åº·æ£€æŸ¥æ¥ç›‘æ§æœåŠ¡çš„çŠ¶æ€ã€‚å¥åº·æ£€æŸ¥å¯ä»¥æ˜¯å®šæœŸå‘é€å¿ƒè·³è¯·æ±‚æˆ–æ‰§è¡Œä¸€äº›ç‰¹å®šçš„å¥åº·æ£€æŸ¥æ“ä½œã€‚é€šè¿‡å¥åº·æ£€æŸ¥ï¼Œå¯ä»¥åŠæ—¶å‘ç°æœåŠ¡çš„æ•…éšœæˆ–ä¸å¯ç”¨çŠ¶æ€ï¼Œå¹¶ç›¸åº”åœ°æ‰“å¼€æ–­è·¯å™¨ã€‚ ç¤ºä¾‹ é¦–å…ˆï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªç›‘æ§æœåŠ¡ç±»ï¼Œå®ƒå°†ä½¿ç”¨æ–­è·¯å™¨æ¥åŒ…è£…è¿œç¨‹æœåŠ¡çš„è°ƒç”¨ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ç›‘æ§æœåŠ¡ç±»çš„ä»£ç ï¼š\npublic class MonitoringService { private final CircuitBreaker delayedService; private final CircuitBreaker quickService; public MonitoringService(CircuitBreaker delayedService, CircuitBreaker quickService) { this.delayedService = delayedService; this.quickService = quickService; } public String localResourceResponse() { return \u0026#34;Local Service is working\u0026#34;; } public String delayedServiceResponse() { try { return this.delayedService.attemptRequest(); } catch (RemoteServiceException e) { return e.getMessage(); } } public String quickServiceResponse() { try { return this.quickService.attemptRequest(); } catch (RemoteServiceException e) { return e.getMessage(); } } } åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼ŒMonitoringService ç±»æ¥å—ä¸¤ä¸ªæ–­è·¯å™¨å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œåˆ†åˆ«ç”¨äºåŒ…è£…å»¶è¿ŸæœåŠ¡å’Œå¿«é€ŸæœåŠ¡çš„è¿œç¨‹è°ƒç”¨ã€‚å®ƒè¿˜åŒ…å«ä¸€ä¸ªç”¨äºè·å–æœ¬åœ°èµ„æºçš„æ–¹æ³•ã€‚\næ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªé»˜è®¤çš„æ–­è·¯å™¨å®ç°ç±»ï¼Œå®ç° CircuitBreaker æ¥å£ï¼Œå¹¶æ ¹æ®éœ€è¦è‡ªå®šä¹‰é€»è¾‘ã€‚\npublic interface CircuitBreaker { void recordSuccess(); void recordFailure(String response); void evaluateState(); } CircuitBreakeræ¥å£å®šä¹‰äº†ä¸‰ä¸ªæ–¹æ³•ï¼š\nrecordSuccess(): å½“ä¾èµ–çš„æœåŠ¡è°ƒç”¨æˆåŠŸæ—¶è°ƒç”¨è¯¥æ–¹æ³•ï¼Œç”¨äºè®°å½•æˆåŠŸçš„äº‹ä»¶ã€‚ recordFailure(String response): å½“ä¾èµ–çš„æœåŠ¡è°ƒç”¨å¤±è´¥æ—¶è°ƒç”¨è¯¥æ–¹æ³•ï¼Œç”¨äºè®°å½•å¤±è´¥çš„äº‹ä»¶ã€‚æ–¹æ³•æ¥å—ä¸€ä¸ªå“åº”å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ã€‚ evaluateState(): è¯¥æ–¹æ³•ç”¨äºè¯„ä¼°å½“å‰æ–­è·¯å™¨çš„çŠ¶æ€ã€‚æ ¹æ®é¢„å®šä¹‰çš„æ¡ä»¶ï¼Œå¦‚æ•…éšœé˜ˆå€¼ã€æ•…éšœè®¡æ•°å’Œæœ€åæ•…éšœæ—¶é—´ç­‰ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦æ”¹å˜æ–­è·¯å™¨çš„çŠ¶æ€ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹çš„é»˜è®¤æ–­è·¯å™¨å®ç°ç±»çš„ä»£ç ï¼š\npublic class DefaultCircuitBreaker implements CircuitBreaker { private final long timeout; private final long retryTimePeriod; private final RemoteService service; private long lastFailureTime; private String lastFailureResponse; private int failureCount; private final int failureThreshold; private State state; private final long futureTime = 1000 * 1000 * 1000 * 1000; public DefaultCircuitBreaker(RemoteService serviceToCall, long timeout, int failureThreshold, long retryTimePeriod) { this.service = serviceToCall; this.state = State.CLOSED; this.failureThreshold = failureThreshold; this.timeout = timeout; this.retryTimePeriod = retryTimePeriod; this.lastFailureTime = System.nanoTime() + futureTime; this.failureCount = 0; } @Override public void recordSuccess() { this.failureCount = 0; this.lastFailureTime = System.nanoTime() + futureTime; this.state = State.CLOSED; } @Override public void recordFailure(String response) { failureCount = failureCount + 1; this.lastFailureTime = System.nanoTime(); this.lastFailureResponse = response; } protected void evaluateState() { if (failureCount \u0026gt;= failureThreshold) { if ((System.nanoTime() - lastFailureTime) \u0026gt; retryTimePeriod) { state = State.HALF_OPEN; } else { state = State.OPEN; } } else { state = State.CLOSED; } } @Override public String getState() { evaluateState(); return state.name(); } @Override public void setState(State state) { this.state = state; switch (state) { case OPEN: this.failureCount = failureThreshold; break; case HALF_OPEN: this.failureCount = 0; break; case CLOSED: this.failureCount = 0; this.lastFailureTime = System.nanoTime() + futureTime; break; } } @Override public String attemptRequest() throws RemoteServiceException { if (state == State.OPEN) { return lastFailureResponse; } try { // Simulate the remote service call return service.call(); } catch (RemoteServiceException e) { recordFailure(e.getMessage()); throw e; } } } ä¸Šè¿°ä»£ç ä¸­çš„ DefaultCircuitBreaker ç±»æ˜¯ä¸€ä¸ªé»˜è®¤çš„æ–­è·¯å™¨å®ç°ç±»ã€‚å®ƒåŒ…å«äº†è®°å½•æˆåŠŸå’Œå¤±è´¥çš„æ–¹æ³•ï¼Œè¯„ä¼°å½“å‰çŠ¶æ€çš„æ–¹æ³•ï¼Œè·å–å½“å‰çŠ¶æ€çš„æ–¹æ³•ï¼Œä»¥åŠå°è¯•å‘èµ·è¯·æ±‚çš„æ–¹æ³•ã€‚æ ¹æ®çŠ¶æ€ï¼Œå®ƒå¯ä»¥æ§åˆ¶æ˜¯å¦å…è®¸è¯·æ±‚é€šè¿‡æˆ–è¿”å›ä¸Šä¸€æ¬¡çš„å¤±è´¥å“åº”ã€‚\næœ€åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ç¤ºä¾‹æ¥æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨æ–­è·¯å™¨ï¼š\n@Slf4j public class App { private static final Logger LOGGER = LoggerFactory.getLogger(App.class); /** * Program entry point. * * @param args command line args */ public static void main(String[] args) { var serverStartTime = System.nanoTime(); var delayedService = new DelayedRemoteService(serverStartTime, 5); var delayedServiceCircuitBreaker = new DefaultCircuitBreaker(delayedService, 3000, 2, 2000 * 1000 * 1000); var quickService = new QuickRemoteService(); var quickServiceCircuitBreaker = new DefaultCircuitBreaker(quickService, 3000, 2, 2000 * 1000 * 1000); // åˆ›å»ºä¸€ä¸ªå¯ä»¥è¿›è¡Œæœ¬åœ°å’Œè¿œç¨‹è°ƒç”¨çš„ç›‘æ§æœåŠ¡å¯¹è±¡ var monitoringService = new MonitoringService(delayedServiceCircuitBreaker, quickServiceCircuitBreaker); // è·å–æœ¬åœ°èµ„æº LOGGER.info(monitoringService.localResourceResponse()); // ä»å»¶è¿ŸæœåŠ¡ä¸­è·å–å“åº” 2 æ¬¡ï¼Œä»¥æ»¡è¶³å¤±è´¥é˜ˆå€¼ LOGGER.info(monitoringService.delayedServiceResponse()); LOGGER.info(monitoringService.delayedServiceResponse()); // åœ¨è¶…è¿‡æ•…éšœé˜ˆå€¼é™åˆ¶åè·å–å»¶è¿ŸæœåŠ¡æ–­è·¯å™¨çš„å½“å‰çŠ¶æ€ // ç°åœ¨æ˜¯æ‰“å¼€çŠ¶æ€ LOGGER.info(delayedServiceCircuitBreaker.getState()); // åŒæ—¶ï¼Œå»¶è¿ŸæœåŠ¡å®•æœºï¼Œä»å¥åº·å¿«é€ŸæœåŠ¡è·å–å“åº” LOGGER.info(monitoringService.quickServiceResponse()); LOGGER.info(quickServiceCircuitBreaker.getState()); // ç­‰å¾…å»¶è¿Ÿçš„æœåŠ¡å“åº” try { LOGGER.info(\u0026#34;Waiting for delayed service to become responsive\u0026#34;); Thread.sleep(5000); } catch (InterruptedException e) { e.printStackTrace(); } // æ£€æŸ¥å»¶æ—¶æ–­è·¯å™¨çš„çŠ¶æ€ï¼Œåº”è¯¥æ˜¯HALF_OPEN LOGGER.info(delayedServiceCircuitBreaker.getState()); // ä»å»¶è¿ŸæœåŠ¡ä¸­è·å–å“åº”ï¼Œç°åœ¨åº”è¯¥æ˜¯å¥åº·çš„ LOGGER.info(monitoringService.delayedServiceResponse()); // è·å–æˆåŠŸå“åº”åï¼Œå®ƒçš„çŠ¶æ€åº”è¯¥æ˜¯å…³é—­ã€‚ LOGGER.info(delayedServiceCircuitBreaker.getState()); } } ç±»å›¾ é€‚ç”¨åœºæ™¯ æ–­è·¯å™¨æ¨¡å¼åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿå’Œå¾®æœåŠ¡æ¶æ„ä¸­æœ‰è®¸å¤šå¸¸è§çš„åº”ç”¨åœºæ™¯ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„åº”ç”¨åœºæ™¯ï¼š\nå¤–éƒ¨ä¾èµ–è°ƒç”¨ï¼šåœ¨ä½¿ç”¨å¤–éƒ¨æœåŠ¡æˆ–èµ„æºæ—¶ï¼Œä¾‹å¦‚æ•°æ®åº“ã€ç½‘ç»œæœåŠ¡ã€APIè°ƒç”¨ç­‰ï¼Œæ–­è·¯å™¨æ¨¡å¼å¯ä»¥ç”¨æ¥å¤„ç†å¤–éƒ¨ä¾èµ–çš„æ•…éšœã€‚å®ƒå¯ä»¥é˜²æ­¢æ•…éšœçš„ä¼ é€’ï¼Œå‡å°‘å¯¹æ•…éšœä¾èµ–çš„è°ƒç”¨ï¼Œå¹¶æä¾›æ•…éšœå¤„ç†æœºåˆ¶ã€‚ é™æµå’Œç†”æ–­ï¼šæ–­è·¯å™¨æ¨¡å¼å¯ä»¥ç”¨äºå®ç°é™æµå’Œç†”æ–­æœºåˆ¶ï¼Œä»¥ä¿æŠ¤ç³»ç»Ÿå…å—å¤–éƒ¨ä¾èµ–çš„è¿‡è½½æˆ–æ•…éšœã€‚å®ƒå¯ä»¥ç›‘æ§è¯·æ±‚çš„é¢‘ç‡å’Œå“åº”æ—¶é—´ï¼Œå¹¶åœ¨è¾¾åˆ°é˜ˆå€¼æ—¶é˜»æ­¢å¯¹å¤–éƒ¨ä¾èµ–çš„è°ƒç”¨ï¼Œä»¥é¿å…ç³»ç»Ÿå´©æºƒã€‚ é™çº§å’Œå®¹é”™ï¼šåœ¨é¢å¯¹å¤–éƒ¨ä¾èµ–æ•…éšœæ—¶ï¼Œæ–­è·¯å™¨æ¨¡å¼å¯ä»¥æä¾›é™çº§å’Œå®¹é”™æœºåˆ¶ã€‚å®ƒå¯ä»¥åˆ‡æ¢åˆ°å¤‡ç”¨é€»è¾‘æˆ–æœåŠ¡ï¼Œä»¥æä¾›åŸºæœ¬çš„åŠŸèƒ½æˆ–é»˜è®¤å€¼ï¼Œä¿æŒç³»ç»Ÿçš„éƒ¨åˆ†å¯ç”¨æ€§ã€‚ é‡è¯•å’Œæ¢å¤ï¼šæ–­è·¯å™¨æ¨¡å¼å¯ä»¥ç”¨äºå®ç°æ•…éšœé‡è¯•å’Œæ¢å¤æœºåˆ¶ã€‚å½“å¤–éƒ¨ä¾èµ–å‘ç”Ÿæ•…éšœæ—¶ï¼Œæ–­è·¯å™¨å¯ä»¥å°è¯•é‡æ–°è¿æ¥æˆ–é‡æ–°è°ƒç”¨ä¾èµ–ï¼Œä»¥å°½å¿«æ¢å¤æ­£å¸¸æ“ä½œã€‚ ç›‘æ§å’ŒæŠ¥å‘Šï¼šæ–­è·¯å™¨æ¨¡å¼é€šå¸¸ä¸ç›‘æ§å’ŒæŠ¥å‘Šæœºåˆ¶ç»“åˆä½¿ç”¨ï¼Œä»¥æä¾›å¯¹ç³»ç»ŸçŠ¶æ€å’Œæ•…éšœçš„å¯è§†åŒ–å’Œè­¦æŠ¥ã€‚å®ƒå¯ä»¥è®°å½•æ•…éšœä¿¡æ¯ã€è¯·æ±‚ç»Ÿè®¡ã€é”™è¯¯ç‡ç­‰æŒ‡æ ‡ï¼Œå¸®åŠ©å¼€å‘äººå‘˜å’Œè¿ç»´å›¢é˜Ÿç›‘æ§ç³»ç»Ÿå¥åº·çŠ¶å†µã€‚ æ€»ä¹‹ï¼Œæ–­è·¯å™¨æ¨¡å¼é€‚ç”¨äºä»»ä½•å¯èƒ½é‡åˆ°å¤–éƒ¨ä¾èµ–æ•…éšœçš„åœºæ™¯ã€‚å®ƒå¯ä»¥æä¾›æ•…éšœéš”ç¦»ã€å¼¹æ€§å’Œè‡ªæ„ˆèƒ½åŠ›ï¼Œæé«˜ç³»ç»Ÿçš„å¯ç”¨æ€§ã€å¯é æ€§å’Œæ€§èƒ½ã€‚\nFAQ å†æä¾›ä¸€ä¸ªä½¿ç”¨æ–­è·¯å™¨æ¨¡å¼çš„ä¾‹å­ï¼Ÿ å½“æ¶‰åŠåˆ°ä½¿ç”¨æ–­è·¯å™¨æ¨¡å¼çš„ä¾‹å­æ—¶ï¼Œä¸€ä¸ªå¸¸è§çš„åº”ç”¨åœºæ™¯æ˜¯åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ä¿æŠ¤å¯¹å…¶ä»–æœåŠ¡çš„è°ƒç”¨ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š\nå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç”µå­å•†åŠ¡åº”ç”¨ç¨‹åºï¼Œå®ƒåŒ…å«è®¢å•æœåŠ¡å’Œåº“å­˜æœåŠ¡ã€‚è®¢å•æœåŠ¡è´Ÿè´£å¤„ç†ç”¨æˆ·çš„è®¢å•ï¼Œè€Œåº“å­˜æœåŠ¡åˆ™è´Ÿè´£ç®¡ç†äº§å“çš„åº“å­˜ä¿¡æ¯ã€‚ä¸ºäº†ä¿æŠ¤è®¢å•æœåŠ¡å¯¹åº“å­˜æœåŠ¡çš„è°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ–­è·¯å™¨æ¨¡å¼ã€‚\npublic class OrderService { private CircuitBreaker circuitBreaker; private InventoryService inventoryService; public OrderService() { // åˆå§‹åŒ–æ–­è·¯å™¨ circuitBreaker = new CircuitBreaker(); // åˆå§‹åŒ–åº“å­˜æœåŠ¡ inventoryService = new InventoryService(); } public void placeOrder(Order order) { try { // æ£€æŸ¥æ–­è·¯å™¨çŠ¶æ€ if (circuitBreaker.isClosed()) { // è°ƒç”¨åº“å­˜æœåŠ¡æ£€æŸ¥åº“å­˜ boolean hasStock = inventoryService.checkStock(order.getProduct()); if (hasStock) { // æ‰§è¡Œè®¢å•å¤„ç†é€»è¾‘ // ... // è®¢å•å¤„ç†æˆåŠŸï¼Œè®°å½•æˆåŠŸäº‹ä»¶ circuitBreaker.recordSuccess(); } else { // åº“å­˜ä¸è¶³ï¼Œè®°å½•å¤±è´¥äº‹ä»¶ circuitBreaker.recordFailure(\u0026#34;Insufficient stock\u0026#34;); throw new RuntimeException(\u0026#34;Insufficient stock\u0026#34;); } } else { // æ–­è·¯å™¨æ‰“å¼€ï¼Œæ‰§è¡Œå›é€€é€»è¾‘ throw new RuntimeException(\u0026#34;Order service is currently unavailable. Please try again later.\u0026#34;); } } catch (Exception e) { // å¤„ç†å¼‚å¸¸æƒ…å†µï¼Œè®°å½•å¤±è´¥äº‹ä»¶ circuitBreaker.recordFailure(e.getMessage()); throw e; } } } åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼ŒOrderServiceç±»æ˜¯è®¢å•æœåŠ¡çš„å®ç°ã€‚å®ƒé€šè¿‡ä½¿ç”¨CircuitBreakerç±»æ¥ä¿æŠ¤å¯¹åº“å­˜æœåŠ¡çš„è°ƒç”¨ã€‚åœ¨placeOrder()æ–¹æ³•ä¸­ï¼Œé¦–å…ˆæ£€æŸ¥æ–­è·¯å™¨çš„çŠ¶æ€ã€‚å¦‚æœæ–­è·¯å™¨å¤„äºå…³é—­çŠ¶æ€ï¼ˆå³å¯ç”¨çŠ¶æ€ï¼‰ï¼Œåˆ™è°ƒç”¨åº“å­˜æœåŠ¡çš„checkStock()æ–¹æ³•æ¥æ£€æŸ¥äº§å“çš„åº“å­˜æƒ…å†µã€‚å¦‚æœåº“å­˜è¶³å¤Ÿï¼Œè®¢å•å¤„ç†æˆåŠŸï¼Œå¹¶è®°å½•æˆåŠŸäº‹ä»¶ï¼›å¦‚æœåº“å­˜ä¸è¶³ï¼Œè®¢å•å¤„ç†å¤±è´¥ï¼Œå¹¶è®°å½•å¤±è´¥äº‹ä»¶ã€‚\nå¦‚æœæ–­è·¯å™¨å¤„äºæ‰“å¼€çŠ¶æ€ï¼Œè¯´æ˜åº“å­˜æœåŠ¡ä¸å¯ç”¨ï¼Œæ­¤æ—¶å°†æ‰§è¡Œå›é€€é€»è¾‘ï¼ŒæŠ›å‡ºå¼‚å¸¸æˆ–æä¾›ç›¸åº”çš„å›é€€å“åº”ã€‚æ— è®ºæ˜¯æ‰§è¡Œå›é€€é€»è¾‘è¿˜æ˜¯å¤„ç†å¼‚å¸¸æƒ…å†µï¼Œéƒ½éœ€è¦è®°å½•å¤±è´¥äº‹ä»¶ã€‚\né€šè¿‡ä½¿ç”¨æ–­è·¯å™¨æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥ä¿æŠ¤è®¢å•æœåŠ¡å…å—åº“å­˜æœåŠ¡æ•…éšœçš„å½±å“ã€‚æ–­è·¯å™¨ä¼šç›‘æ§åº“å­˜æœåŠ¡çš„å¥åº·çŠ¶æ€ï¼Œå¹¶åœ¨æ•…éšœå‘ç”Ÿæ—¶æ‰“å¼€æ–­è·¯å™¨ï¼Œé˜»æ­¢å¯¹åº“å­˜æœåŠ¡çš„è¿›ä¸€æ­¥è°ƒç”¨ã€‚è¿™æ ·ï¼Œå³ä½¿åº“å­˜æœåŠ¡ä¸å¯ç”¨ï¼Œè®¢å•æœåŠ¡ä»ç„¶èƒ½å¤Ÿæä¾›æ°å½“çš„å“åº”ï¼Œå¹¶é¿å…å› è¿é”æ•…éšœè€Œå¯¼è‡´æ•´ä¸ªç³»ç»Ÿå´©æºƒã€‚\nå¦‚ä½•ä¼˜åŒ–æ–­è·¯å™¨æ¨¡å¼çš„ä»£ç ï¼Ÿ å½“ç¼–å†™æ–­è·¯å™¨æ¨¡å¼çš„ä»£ç æ—¶ï¼Œå¯ä»¥è¿›è¡Œä¸€äº›ä¼˜åŒ–å’Œæ”¹è¿›ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½çš„ä¼˜åŒ–æ–¹æ³•ï¼š\nä½¿ç”¨ç°æœ‰çš„åº“æˆ–æ¡†æ¶ï¼šæ–­è·¯å™¨æ¨¡å¼æ˜¯ä¸€ä¸ªå¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œè®¸å¤šæµè¡Œçš„Javaåº“å’Œæ¡†æ¶å·²ç»æä¾›äº†æ–­è·¯å™¨å®ç°ï¼Œä¾‹å¦‚ Netflixçš„Hystrixã€Resilience4jç­‰ã€‚ä½¿ç”¨è¿™äº›åº“å¯ä»¥å‡å°‘æ‚¨è‡ªå·±ç¼–å†™å’Œç»´æŠ¤æ–­è·¯å™¨ä»£ç çš„å·¥ä½œé‡ï¼Œå¹¶ä¸”å®ƒä»¬é€šå¸¸å…·æœ‰æ›´å¤šçš„åŠŸèƒ½å’Œé…ç½®é€‰é¡¹ã€‚ è¶…æ—¶è®¾ç½®ï¼šåœ¨æ–­è·¯å™¨æ¨¡å¼ä¸­ï¼Œè®¾ç½®é€‚å½“çš„è¶…æ—¶æ—¶é—´éå¸¸é‡è¦ã€‚æ‚¨å¯ä»¥ä½¿ç”¨Javaçš„Futureã€CompletableFutureæˆ–ç¬¬ä¸‰æ–¹åº“æ¥å®ç°è°ƒç”¨çš„è¶…æ—¶æ§åˆ¶ã€‚ç¡®ä¿åœ¨è¶…è¿‡è¶…æ—¶æ—¶é—´åï¼Œå–æ¶ˆæˆ–ä¸­æ–­æ­£åœ¨è¿›è¡Œçš„è¯·æ±‚ï¼Œå¹¶è®°å½•ä¸ºå¤±è´¥ã€‚ é”™è¯¯è®¡æ•°å™¨å’Œé‡ç½®ç­–ç•¥ï¼šæ ¹æ®å¤±è´¥è®¡æ•°å™¨å’Œé‡ç½®ç­–ç•¥ï¼Œæ‚¨å¯ä»¥æ›´å‡†ç¡®åœ°ç¡®å®šä½•æ—¶æ‰“å¼€ã€å…³é—­æˆ–åŠå¼€æ–­è·¯å™¨ã€‚è€ƒè™‘ä½¿ç”¨æ»‘åŠ¨çª—å£æˆ–æ»‘åŠ¨æ—¶é—´çª—å£æ¥è®¡ç®—é”™è¯¯è®¡æ•°ï¼Œå¹¶æ ¹æ®é¢„å®šä¹‰çš„è§„åˆ™è¿›è¡ŒçŠ¶æ€è½¬æ¢ã€‚ ç†”æ–­æŒ‡æ ‡å’Œç›‘æ§ï¼šåœ¨å¤§å‹åº”ç”¨ç¨‹åºä¸­ï¼Œäº†è§£æ–­è·¯å™¨çš„ä½¿ç”¨æƒ…å†µå’Œæ€§èƒ½æŒ‡æ ‡éå¸¸é‡è¦ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æŒ‡æ ‡æ”¶é›†åº“ï¼ˆä¾‹å¦‚Micrometerï¼‰å’Œç›‘æ§ç³»ç»Ÿï¼ˆä¾‹å¦‚Prometheusã€Grafanaï¼‰æ¥æ”¶é›†å’Œå¯è§†åŒ–æ–­è·¯å™¨çš„æŒ‡æ ‡æ•°æ®ï¼Œä»¥ä¾¿è¿›è¡Œç›‘æ§å’Œæ•…éšœæ’é™¤ã€‚ å¼‚æ­¥æ”¯æŒï¼šå¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºéœ€è¦è¿›è¡Œå¤§é‡çš„å¹¶å‘è¯·æ±‚ï¼Œè€ƒè™‘ä½¿ç”¨å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ï¼ˆä¾‹å¦‚Javaçš„CompletableFutureã€å“åº”å¼ç¼–ç¨‹åº“ç­‰ï¼‰ã€‚è¿™æ ·å¯ä»¥æ›´å¥½åœ°åˆ©ç”¨èµ„æºï¼Œå¹¶æé«˜åº”ç”¨ç¨‹åºçš„ååé‡å’Œæ€§èƒ½ã€‚ ä½ èƒ½æ¨èä¸€äº›å¸¸ç”¨çš„æ–­è·¯å™¨æ¨¡å¼çš„Javaåº“å—ï¼Ÿ å½“æ¶‰åŠåˆ°æ–­è·¯å™¨æ¨¡å¼çš„Javaåº“æ—¶ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„é€‰æ‹©ï¼š\nNetflix Hystrixï¼šHystrixæ˜¯ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„æ–­è·¯å™¨åº“ï¼Œä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿæä¾›æ•…éšœå®¹é”™å’Œå¼¹æ€§åŠŸèƒ½ã€‚å®ƒå…·æœ‰è‡ªé€‚åº”çš„æ–­è·¯å™¨é€»è¾‘ã€è¯·æ±‚è¶…æ—¶ã€çº¿ç¨‹æ± éš”ç¦»ã€å›é€€é€»è¾‘ç­‰åŠŸèƒ½ã€‚ç„¶è€Œï¼Œè¯·æ³¨æ„ï¼ŒNetflixå®£å¸ƒåœæ­¢Hystrixçš„ç»´æŠ¤å’Œå¼€å‘ï¼Œæ¨èä½¿ç”¨Resilience4jæˆ–å…¶ä»–æ›¿ä»£åº“ã€‚ Resilience4jï¼šResilience4jæ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ–­è·¯å™¨å’Œå¼¹æ€§åº“ï¼Œä¸“ä¸ºJava 8+åº”ç”¨ç¨‹åºè®¾è®¡ã€‚å®ƒæä¾›äº†æ–­è·¯å™¨ã€é™æµã€é‡è¯•ã€è¶…æ—¶ç­‰åŠŸèƒ½ï¼Œå¹¶ä¸Javaå‡½æ•°å¼ç¼–ç¨‹é£æ ¼å¾ˆå¥½åœ°é…åˆã€‚Resilience4jè¿˜ä¸Spring Booté›†æˆå¾—å¾ˆå¥½ï¼Œå¯ä»¥è½»æ¾åœ°åœ¨Springåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ã€‚ Sentinelï¼šSentinelæ˜¯é˜¿é‡Œå·´å·´å¼€æºçš„ä¸€æ¬¾å¼¹æ€§æµæ§æ¡†æ¶ï¼Œå®ƒæä¾›äº†æ–­è·¯å™¨ã€æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ç­‰åŠŸèƒ½ã€‚Sentinelæ”¯æŒé’ˆå¯¹æµé‡å®æ—¶ç›‘æ§å’Œè§„åˆ™é…ç½®ï¼Œå¯ä»¥å¸®åŠ©æ‚¨ä¿æŠ¤åº”ç”¨ç¨‹åºå…å—å¼‚å¸¸æµé‡å’Œæ•…éšœçš„å½±å“ã€‚ Akka Circuit Breakerï¼šAkkaæ˜¯ä¸€ä¸ªç”¨äºæ„å»ºé«˜å¹¶å‘å’Œåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºçš„å·¥å…·åŒ…ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€ä¸ªåä¸ºCircuit Breakerçš„æ¨¡å—ã€‚Akkaçš„Circuit Breakeræ¨¡å—æä¾›äº†æ–­è·¯å™¨åŠŸèƒ½ï¼Œå¹¶ä¸Akkaçš„Actoræ¨¡å‹å’Œæ¶ˆæ¯ä¼ é€’æœºåˆ¶é›†æˆå¾—å¾ˆå¥½ã€‚ Spring Cloud Circuit Breakerï¼šSpring Cloud Circuit Breakeræ˜¯Spring Cloudç”Ÿæ€ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæä¾›äº†ä¸å¤šä¸ªæ–­è·¯å™¨å®ç°ï¼ˆå¦‚Hystrixã€Resilience4jã€Sentinelç­‰ï¼‰çš„é›†æˆã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©åˆé€‚çš„æ–­è·¯å™¨å®ç°ï¼Œå¹¶åœ¨Springåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å®ƒä»¬ã€‚ Spring Cloud Circuit Breakerå¦‚ä½•å®ç°æ–­è·¯å™¨æ¨¡å¼ï¼Ÿ Spring Cloud Circuit Breakeræ˜¯Spring Cloudæä¾›çš„ä¸€ä¸ªæ¨¡å—ï¼Œç”¨äºå®ç°æ–­è·¯å™¨æ¨¡å¼ã€‚å®ƒåŸºäºæŠ½è±¡çš„CircuitBreakeræ¥å£ï¼Œå¹¶æä¾›äº†ä¸ä¸åŒæ–­è·¯å™¨å®ç°çš„é›†æˆã€‚\nSpring Cloud Circuit Breakeré€šè¿‡ä¸å„ç§æ–­è·¯å™¨å®ç°ï¼ˆå¦‚Netflix Hystrixã€Resilience4jã€Sentinelç­‰ï¼‰çš„æ•´åˆï¼Œä¸ºå¼€å‘äººå‘˜æä¾›äº†ä¸€è‡´çš„ç¼–ç¨‹æ¨¡å‹å’ŒAPIï¼Œä»¥ä¾¿åœ¨å¾®æœåŠ¡æ¶æ„ä¸­å®ç°æ–­è·¯å™¨æ¨¡å¼ã€‚\nä»¥ä¸‹æ˜¯ä½¿ç”¨Spring Cloud Circuit Breakerå®ç°æ–­è·¯å™¨æ¨¡å¼çš„ä¸€èˆ¬æ­¥éª¤ï¼š\næ·»åŠ ä¾èµ–ï¼šåœ¨é¡¹ç›®çš„æ„å»ºæ–‡ä»¶ä¸­ï¼Œæ·»åŠ Spring Cloud Circuit Breakerç›¸åº”çš„ä¾èµ–ï¼Œä¾‹å¦‚ä½¿ç”¨Netflix Hystrixï¼š \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-starter-circuitbreaker-hystrix\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; åˆ›å»ºæ–­è·¯å™¨æ–¹æ³•ï¼šåœ¨éœ€è¦ä¿æŠ¤çš„æ–¹æ³•ä¸Šï¼Œä½¿ç”¨@CircuitBreakeræ³¨è§£æ ‡è®°è¯¥æ–¹æ³•ï¼ŒæŒ‡å®šæ–­è·¯å™¨çš„åç§°ã€‚ä¾‹å¦‚ï¼š import org.springframework.cloud.circuitbreaker.annotation.CircuitBreaker; @CircuitBreaker(name = \u0026#34;myCircuitBreaker\u0026#34;) public String performRemoteCall() { // è¿œç¨‹æœåŠ¡è°ƒç”¨é€»è¾‘ // ... } é…ç½®æ–­è·¯å™¨å±æ€§ï¼šå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶ï¼ˆå¦‚application.propertiesæˆ–application.ymlï¼‰æ¥è®¾ç½®æ–­è·¯å™¨çš„å±æ€§ï¼Œå¦‚è¶…æ—¶æ—¶é—´ã€æ•…éšœé˜ˆå€¼ç­‰ã€‚ä¾‹å¦‚ï¼š spring: cloud: circuitbreaker: enabled: true default-config: timeout: 1000 circuit-breaker: request-volume-threshold: 10 failure-ratio: 0.5 wait-duration-in-open-state: 5000 å¤„ç†å›é€€é€»è¾‘ï¼šå¯ä»¥é€šè¿‡åœ¨æ–¹æ³•ä¸Šå®šä¹‰ä¸€ä¸ªå¤‡ç”¨æ–¹æ³•ï¼ˆfallback methodï¼‰æ¥æŒ‡å®šåœ¨æ–­è·¯å™¨æ‰“å¼€æ—¶æ‰§è¡Œçš„å›é€€é€»è¾‘ã€‚å¯ä»¥ä½¿ç”¨@Fallbackæ³¨è§£æ ‡è®°è¯¥å¤‡ç”¨æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š import org.springframework.cloud.circuitbreaker.annotation.Fallback; @Fallback(fallbackMethod = \u0026#34;fallbackMethod\u0026#34;) public String performRemoteCall() { // è¿œç¨‹æœåŠ¡è°ƒç”¨é€»è¾‘ // ... } public String fallbackMethod(Exception e) { // å›é€€é€»è¾‘ // ... } é€šè¿‡ä¸Šè¿°æ­¥éª¤ï¼ŒSpring Cloud Circuit Breakerä¼šæ ¹æ®æ–­è·¯å™¨çš„é…ç½®å’ŒçŠ¶æ€æ¥ä¿æŠ¤è¢«@CircuitBreakeræ³¨è§£æ ‡è®°çš„æ–¹æ³•ã€‚å½“æ–¹æ³•è°ƒç”¨å‘ç”Ÿæ•…éšœæˆ–è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œæ–­è·¯å™¨å°†æ‰“å¼€ï¼Œå¹¶æ‰§è¡Œå¤‡ç”¨æ–¹æ³•ã€‚å¤‡ç”¨æ–¹æ³•å¯ä»¥æä¾›ä¸€ä¸ªé¢„å®šä¹‰çš„å“åº”æˆ–æ‰§è¡Œä¸€äº›å›é€€é€»è¾‘ï¼Œä»¥ç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå…·ä½“çš„é…ç½®å’Œç”¨æ³•å¯èƒ½å› ä½¿ç”¨çš„æ–­è·¯å™¨å®ç°ï¼ˆå¦‚Hystrixã€Resilience4jç­‰ï¼‰è€Œæœ‰æ‰€å·®å¼‚ã€‚å› æ­¤ï¼Œå»ºè®®å‚è€ƒSpring Cloud Circuit Breakerçš„å®˜æ–¹æ–‡æ¡£å’Œç›¸å…³ç¤ºä¾‹ï¼Œä»¥äº†è§£æ›´å¤šå…³äºç‰¹å®šæ–­è·¯å™¨å®ç°çš„è¯¦ç»†ä¿¡æ¯å’Œç”¨æ³•ã€‚\nSpring Cloud Circuit Breakerå’Œå¸¸è§„çš„æ–­è·¯å™¨å®ç°çš„åŒºåˆ«ï¼Ÿ Spring Cloud Circuit Breaker æ˜¯åŸºäº Spring Cloud çš„æ–­è·¯å™¨æ¨¡å—ï¼Œæä¾›äº†å¯¹æ–­è·¯å™¨æ¨¡å¼çš„æ”¯æŒã€‚å®ƒä¸å¸¸è§„çš„æ–­è·¯å™¨å®ç°ï¼ˆå¦‚ Hystrixã€Resilience4j ç­‰ï¼‰ç›¸æ¯”ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªåŒºåˆ«ï¼š\nç»Ÿä¸€çš„æŠ½è±¡æ¥å£ï¼šSpring Cloud Circuit Breaker æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„æŠ½è±¡æ¥å£ï¼Œå³ CircuitBreaker æ¥å£ï¼Œç”¨äºå®šä¹‰æ–­è·¯å™¨çš„è¡Œä¸ºå’ŒçŠ¶æ€ã€‚è¿™ä¸ªæ¥å£ä½¿å¾—å¯ä»¥åœ¨ä¸åŒçš„æ–­è·¯å™¨å®ç°ä¹‹é—´è¿›è¡Œåˆ‡æ¢å’Œæ›¿æ¢ï¼Œè€Œä¸éœ€è¦æ›´æ”¹åº”ç”¨ç¨‹åºçš„ä»£ç ã€‚\nä»¥ä¸‹æ˜¯ CircuitBreaker æ¥å£çš„å®šä¹‰ï¼š\npublic interface CircuitBreaker { String getId(); \u0026lt;T\u0026gt; T run(Supplier\u0026lt;T\u0026gt; toRun); \u0026lt;T\u0026gt; T runCallable(Callable\u0026lt;T\u0026gt; toRun) throws Exception; void reset(); CircuitBreaker.State getState(); default boolean isOpen() { return getState() == CircuitBreaker.State.OPEN; } default boolean isClosed() { return getState() == CircuitBreaker.State.CLOSED; } default boolean isHalfOpen() { return getState() == CircuitBreaker.State.HALF_OPEN; } enum State { CLOSED, OPEN, HALF_OPEN } } CircuitBreaker æ¥å£å®šä¹‰äº†ä»¥ä¸‹æ–¹æ³•ï¼š\ngetId()ï¼šè·å–æ–­è·¯å™¨çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚ run(Supplier\u0026lt;T\u0026gt; toRun)ï¼šè¿è¡Œä¸€ä¸ªå¸¦æœ‰è¿”å›å€¼çš„æ“ä½œï¼ˆé€šè¿‡ Supplier æä¾›ï¼‰ï¼Œå¹¶è¿”å›æ“ä½œçš„ç»“æœã€‚å¦‚æœæ–­è·¯å™¨å¤„äºæ‰“å¼€çŠ¶æ€ï¼Œå°†ä¼šè§¦å‘æ–­è·¯å™¨æ‰“å¼€çš„é€»è¾‘ã€‚ runCallable(Callable\u0026lt;T\u0026gt; toRun)ï¼šè¿è¡Œä¸€ä¸ªå¸¦æœ‰è¿”å›å€¼çš„æ“ä½œï¼ˆé€šè¿‡ Callable æä¾›ï¼‰ï¼Œå¹¶è¿”å›æ“ä½œçš„ç»“æœã€‚ä¸ run(Supplier\u0026lt;T\u0026gt; toRun) ç±»ä¼¼ï¼Œå¦‚æœæ–­è·¯å™¨å¤„äºæ‰“å¼€çŠ¶æ€ï¼Œå°†ä¼šè§¦å‘æ–­è·¯å™¨æ‰“å¼€çš„é€»è¾‘ã€‚ reset()ï¼šé‡ç½®æ–­è·¯å™¨çš„çŠ¶æ€ã€‚å°†æ–­è·¯å™¨çŠ¶æ€é‡ç½®ä¸ºå…³é—­çŠ¶æ€ã€‚ getState()ï¼šè·å–æ–­è·¯å™¨çš„å½“å‰çŠ¶æ€ï¼Œè¿”å›ä¸€ä¸ª CircuitBreaker.State æšä¸¾å€¼ï¼Œè¡¨ç¤ºå…³é—­çŠ¶æ€ã€æ‰“å¼€çŠ¶æ€æˆ–åŠå¼€çŠ¶æ€ã€‚ isOpen()ã€isClosed()ã€isHalfOpen()ï¼šè¿™äº›æ–¹æ³•æ˜¯å¯¹çŠ¶æ€çš„ä¾¿æ·åˆ¤æ–­æ–¹æ³•ï¼Œç”¨äºåˆ¤æ–­æ–­è·¯å™¨å½“å‰çš„çŠ¶æ€ã€‚ å¤šä¸ªæ–­è·¯å™¨å®ç°çš„æ”¯æŒï¼šSpring Cloud Circuit Breaker æ”¯æŒå¤šä¸ªæ–­è·¯å™¨å®ç°ï¼Œå¦‚ Hystrixã€Resilience4jã€Sentinel ç­‰ã€‚è¿™æ ·ï¼Œå¼€å‘äººå‘˜å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚å’Œåå¥½é€‰æ‹©é€‚åˆçš„æ–­è·¯å™¨å®ç°ã€‚\nä¸ Spring Cloud æ•´åˆï¼šSpring Cloud Circuit Breaker ä¸ Spring Cloud ç”Ÿæ€ç³»ç»Ÿæ— ç¼é›†æˆï¼Œå¯ä»¥ä¸å…¶ä»– Spring Cloud ç»„ä»¶ï¼ˆå¦‚æœåŠ¡æ³¨å†Œä¸å‘ç°ã€è´Ÿè½½å‡è¡¡ç­‰ï¼‰ä¸€èµ·ä½¿ç”¨ã€‚å®ƒå¯ä»¥é€šè¿‡æ³¨è§£æˆ–ç¼–ç¨‹æ–¹å¼ä¸ Spring Boot åº”ç”¨ç¨‹åºé›†æˆï¼Œç®€åŒ–äº†æ–­è·¯å™¨çš„é…ç½®å’Œä½¿ç”¨ã€‚\nå¯æ’æ‹”çš„å®ç°ï¼šSpring Cloud Circuit Breaker çš„è®¾è®¡å…è®¸å¼€å‘äººå‘˜è¿›è¡Œè‡ªå®šä¹‰çš„æ–­è·¯å™¨å®ç°ã€‚é€šè¿‡å®ç° CircuitBreakerFactory æ¥å£ï¼Œå¯ä»¥åˆ›å»ºè‡ªå®šä¹‰çš„æ–­è·¯å™¨å®ä¾‹ï¼Œå¹¶å°†å…¶é›†æˆåˆ° Spring Cloud Circuit Breaker ä¸­ã€‚\næ€»çš„æ¥è¯´ï¼ŒSpring Cloud Circuit Breaker æä¾›äº†ä¸€ç§æ›´çµæ´»ã€å¯æ‰©å±•å’Œä¸ Spring Cloud é›†æˆçš„æ–¹å¼æ¥å®ç°æ–­è·¯å™¨æ¨¡å¼ã€‚å®ƒä½¿å¾—å¼€å‘äººå‘˜å¯ä»¥é€‰æ‹©é€‚åˆè‡ªå·±é¡¹ç›®éœ€æ±‚çš„æ–­è·¯å™¨å®ç°ï¼Œå¹¶èƒ½å¤Ÿä¸å…¶ä»– Spring Cloud ç»„ä»¶æ— ç¼åä½œã€‚\nå‚è€ƒèµ„æ–™ Understanding Circuit Breaker Patter Martin Fowler on Circuit Breaker Fault tolerance in a high volume, distributed system Circuit Breaker pattern ","permalink":"https://blog.chensoul.cc/posts/2023/10/26/java-design-patterns-circuit-breaker/","summary":"æœ¬æ–‡ä¸»è¦ä»‹ç» Circuit Breaker æ–­è·¯å™¨æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nä»‹ç» æ–­è·¯å™¨æ¨¡å¼ï¼ˆCircuit Breaker Patternï¼‰æ˜¯ä¸€ç§åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¤„ç†æ•…éšœå’Œæé«˜ç³»ç»Ÿå¯é æ€§çš„è®¾è®¡æ¨¡å¼ã€‚å®ƒçš„ä¸»è¦ç›®æ ‡æ˜¯é˜²æ­¢æ•…éšœçš„ä¼ é€’ï¼Œå¹¶åœ¨æ•…éšœå‘ç”Ÿæ—¶æä¾›ä¼˜é›…çš„æ•…éšœå¤„ç†æœºåˆ¶ã€‚\nåœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸å¯é¿å…åœ°ä¼šå‡ºç°è®¸å¤šå¤–éƒ¨ä¾èµ–ï¼Œå¦‚æ•°æ®åº“ã€ç½‘ç»œæœåŠ¡ç­‰ã€‚è¿™äº›å¤–éƒ¨ä¾èµ–å¯èƒ½ä¼šå‘ç”Ÿæ•…éšœã€å»¶è¿Ÿæˆ–ä¸å¯ç”¨çš„æƒ…å†µã€‚å¦‚æœæ²¡æœ‰é€‚å½“çš„æªæ–½ï¼Œè¿™äº›æ•…éšœå¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªç³»ç»Ÿçš„æ€§èƒ½ä¸‹é™ï¼Œç”šè‡³ç³»ç»Ÿå´©æºƒã€‚\næ–­è·¯å™¨æ¨¡å¼é€šè¿‡åœ¨åº”ç”¨ç¨‹åºå’Œå¤–éƒ¨ä¾èµ–ä¹‹é—´å¼•å…¥ä¸€ä¸ªæ–­è·¯å™¨æ¥å£æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æ–­è·¯å™¨æ¥å£å……å½“ä¸€ä¸ªä¸­é—´å±‚ï¼Œç›‘è§†å¯¹å¤–éƒ¨ä¾èµ–çš„è°ƒç”¨ã€‚å½“å¤–éƒ¨ä¾èµ–å‘ç”Ÿæ•…éšœæ—¶ï¼Œæ–­è·¯å™¨å¯ä»¥è¿…é€Ÿåœ°ä¸­æ–­å¯¹å¤–éƒ¨ä¾èµ–çš„è°ƒç”¨ï¼Œé¿å…èµ„æºçš„æµªè´¹å’Œæ•…éšœçš„ä¼ é€’ã€‚\né™¤äº†æ–­è·¯å™¨æ¥å£ä¹‹å¤–ï¼Œæ–­è·¯å™¨æ¨¡å¼è¿˜æ¶‰åŠä»¥ä¸‹å‡ ä¸ªé‡è¦çš„çŸ¥è¯†ç‚¹ï¼š\næ•…éšœé˜ˆå€¼ï¼ˆFailure Thresholdï¼‰ï¼šæ–­è·¯å™¨æ¨¡å¼é€šè¿‡è®¾ç½®æ•…éšœé˜ˆå€¼æ¥åˆ¤æ–­æœåŠ¡çš„å¥åº·çŠ¶æ€ã€‚å½“æœåŠ¡çš„å¤±è´¥æ¬¡æ•°è¾¾åˆ°æˆ–è¶…è¿‡æ•…éšœé˜ˆå€¼æ—¶ï¼Œæ–­è·¯å™¨ä¼šæ‰“å¼€ï¼Œé˜»æ­¢å¯¹æœåŠ¡çš„è¿›ä¸€æ­¥è°ƒç”¨ã€‚ å›é€€å“åº”ï¼ˆFallback Responseï¼‰ï¼šå½“æ–­è·¯å™¨æ‰“å¼€æ—¶ï¼Œå¯ä»¥ä¸ºè°ƒç”¨æ–¹æä¾›å›é€€å“åº”ã€‚å›é€€å“åº”æ˜¯ä¸€ä¸ªé¢„å®šä¹‰çš„å“åº”ï¼Œç”¨äºä»£æ›¿æ— æ³•æ­£å¸¸è°ƒç”¨çš„æœåŠ¡çš„å“åº”ã€‚å›é€€å“åº”å¯ä»¥æ˜¯äº‹å…ˆå®šä¹‰å¥½çš„é™æ€å“åº”ï¼Œæˆ–è€…æ˜¯é€šè¿‡è°ƒç”¨å¤‡ç”¨æœåŠ¡æ¥è·å–çš„å“åº”ã€‚ æ–­è·¯å™¨çŠ¶æ€ï¼ˆCircuit Breaker Stateï¼‰ï¼šæ–­è·¯å™¨å¯ä»¥å¤„äºä¸åŒçš„çŠ¶æ€ï¼Œå¦‚å…³é—­ï¼ˆClosedï¼‰ã€æ‰“å¼€ï¼ˆOpenï¼‰å’ŒåŠå¼€ï¼ˆHalf-Openï¼‰ã€‚åˆå§‹çŠ¶æ€é€šå¸¸æ˜¯å…³é—­çŠ¶æ€ï¼Œè¡¨ç¤ºæœåŠ¡æ­£å¸¸å¯ç”¨ã€‚å½“æœåŠ¡çš„å¤±è´¥æ¬¡æ•°è¾¾åˆ°æ•…éšœé˜ˆå€¼æ—¶ï¼Œæ–­è·¯å™¨ä¼šæ‰“å¼€ï¼Œé˜»æ­¢å¯¹æœåŠ¡çš„è¿›ä¸€æ­¥è°ƒç”¨ã€‚åœ¨ä¸€å®šæ—¶é—´åï¼Œæ–­è·¯å™¨ä¼šè¿›å…¥åŠå¼€çŠ¶æ€ï¼Œå…è®¸å‘èµ·ä¸€æ¬¡æµ‹è¯•è°ƒç”¨ã€‚å¦‚æœæµ‹è¯•è°ƒç”¨æˆåŠŸï¼Œæ–­è·¯å™¨å°†é‡æ–°å…³é—­ï¼›å¦‚æœæµ‹è¯•è°ƒç”¨ä»ç„¶å¤±è´¥ï¼Œæ–­è·¯å™¨å°†é‡æ–°æ‰“å¼€ã€‚ æ–­è·¯å™¨çš„è‡ªåŠ¨æ¢å¤ï¼ˆAutomatic Recoveryï¼‰ï¼šæ–­è·¯å™¨æ¨¡å¼é€šå¸¸å…·æœ‰è‡ªåŠ¨æ¢å¤åŠŸèƒ½ã€‚åœ¨æ–­è·¯å™¨æ‰“å¼€çš„çŠ¶æ€ä¸‹ï¼Œä¸€æ®µæ—¶é—´è¿‡å»åï¼Œæ–­è·¯å™¨ä¼šå°è¯•é‡æ–°å…³é—­ï¼Œä»¥å…è®¸å¯¹æœåŠ¡çš„æ­£å¸¸è°ƒç”¨ã€‚è‡ªåŠ¨æ¢å¤å¯ä»¥é˜²æ­¢é•¿æ—¶é—´çš„æœåŠ¡ä¸­æ–­ï¼Œæä¾›ç»™æœåŠ¡ä¸€ä¸ªæœºä¼šæ¥æ¢å¤æ­£å¸¸è¿è¡Œã€‚ å¥åº·æ£€æŸ¥ï¼ˆHealth Checkï¼‰ï¼šæ–­è·¯å™¨æ¨¡å¼å¯ä»¥é€šè¿‡å®šæœŸçš„å¥åº·æ£€æŸ¥æ¥ç›‘æ§æœåŠ¡çš„çŠ¶æ€ã€‚å¥åº·æ£€æŸ¥å¯ä»¥æ˜¯å®šæœŸå‘é€å¿ƒè·³è¯·æ±‚æˆ–æ‰§è¡Œä¸€äº›ç‰¹å®šçš„å¥åº·æ£€æŸ¥æ“ä½œã€‚é€šè¿‡å¥åº·æ£€æŸ¥ï¼Œå¯ä»¥åŠæ—¶å‘ç°æœåŠ¡çš„æ•…éšœæˆ–ä¸å¯ç”¨çŠ¶æ€ï¼Œå¹¶ç›¸åº”åœ°æ‰“å¼€æ–­è·¯å™¨ã€‚ ç¤ºä¾‹ é¦–å…ˆï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªç›‘æ§æœåŠ¡ç±»ï¼Œå®ƒå°†ä½¿ç”¨æ–­è·¯å™¨æ¥åŒ…è£…è¿œç¨‹æœåŠ¡çš„è°ƒç”¨ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ç›‘æ§æœåŠ¡ç±»çš„ä»£ç ï¼š\npublic class MonitoringService { private final CircuitBreaker delayedService; private final CircuitBreaker quickService; public MonitoringService(CircuitBreaker delayedService, CircuitBreaker quickService) { this.delayedService = delayedService; this.quickService = quickService; } public String localResourceResponse() { return \u0026#34;Local Service is working\u0026#34;; } public String delayedServiceResponse() { try { return this.delayedService.attemptRequest(); } catch (RemoteServiceException e) { return e.getMessage(); } } public String quickServiceResponse() { try { return this.quickService.attemptRequest(); } catch (RemoteServiceException e) { return e.getMessage(); } } } åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼ŒMonitoringService ç±»æ¥å—ä¸¤ä¸ªæ–­è·¯å™¨å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œåˆ†åˆ«ç”¨äºåŒ…è£…å»¶è¿ŸæœåŠ¡å’Œå¿«é€ŸæœåŠ¡çš„è¿œç¨‹è°ƒç”¨ã€‚å®ƒè¿˜åŒ…å«ä¸€ä¸ªç”¨äºè·å–æœ¬åœ°èµ„æºçš„æ–¹æ³•ã€‚","title":"Javaè®¾è®¡æ¨¡å¼ï¼šCircuit Breaker"},{"content":"æœ¬æ–‡ä¸»è¦ä»‹ç» Chain æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nç›®çš„ é€šè¿‡ç»™å¤šä¸ªå¯¹è±¡ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„æœºä¼šï¼Œé¿å…è¯·æ±‚çš„å‘é€è€…å’Œå®ƒçš„æ¥æ”¶è€…è€¦åˆã€‚ä¸²è”æ¥æ”¶å¯¹è±¡å¹¶åœ¨é“¾æ¡ä¸­ä¼ é€’è¯·æ±‚ç›´åˆ°ä¸€ä¸ªå¯¹è±¡å¤„ç†å®ƒã€‚\nä»‹ç» è´£ä»»é“¾æ¨¡å¼ï¼ˆChain of Responsibility Patternï¼‰æ˜¯ä¸€ç§è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸å¤šä¸ªå¯¹è±¡æŒ‰ç…§é¡ºåºå¤„ç†è¯·æ±‚ï¼Œç›´åˆ°å…¶ä¸­ä¸€ä¸ªå¯¹è±¡èƒ½å¤Ÿå¤„ç†è¯¥è¯·æ±‚ä¸ºæ­¢ã€‚è¯¥æ¨¡å¼å°†è¯·æ±‚å‘é€è€…å’Œæ¥æ”¶è€…è§£è€¦ï¼Œä½¿å¤šä¸ªå¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼ŒåŒæ—¶é¿å…è¯·æ±‚å‘é€è€…ä¸æ¥æ”¶è€…ä¹‹é—´çš„ç›´æ¥è€¦åˆã€‚\nåœ¨è´£ä»»é“¾æ¨¡å¼ä¸­ï¼Œé€šå¸¸ä¼šæ„å»ºä¸€ä¸ªå¤„ç†è¯·æ±‚çš„é“¾æ¡ï¼Œé“¾æ¡ä¸Šçš„æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚å½“è¯·æ±‚åˆ°è¾¾é“¾æ¡çš„èµ·ç‚¹æ—¶ï¼Œå®ƒä¼šä¾æ¬¡ç»è¿‡é“¾æ¡ä¸Šçš„æ¯ä¸ªå¯¹è±¡ï¼Œç›´åˆ°æ‰¾åˆ°èƒ½å¤Ÿå¤„ç†è¯·æ±‚çš„å¯¹è±¡ä¸ºæ­¢ã€‚æ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥å†³å®šæ˜¯å¦å¤„ç†è¯·æ±‚ï¼Œæˆ–è€…å°†è¯·æ±‚ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¯¹è±¡ã€‚\nä»¥ä¸‹æ˜¯è´£ä»»é“¾æ¨¡å¼çš„å‡ ä¸ªå…³é”®è§’è‰²ï¼š\næŠ½è±¡å¤„ç†å™¨ï¼ˆHandlerï¼‰ï¼šå®šä¹‰å¤„ç†è¯·æ±‚çš„æ¥å£ï¼Œå¹¶åŒ…å«ä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªå¤„ç†å™¨çš„å¼•ç”¨ã€‚é€šå¸¸ä¼šæä¾›ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„æ–¹æ³•ã€‚ å…·ä½“å¤„ç†å™¨ï¼ˆConcreteHandlerï¼‰ï¼šå®ç°æŠ½è±¡å¤„ç†å™¨çš„æ¥å£ï¼Œå…·ä½“å¤„ç†è¯·æ±‚çš„é€»è¾‘ã€‚å¦‚æœè‡ªå·±æ— æ³•å¤„ç†è¯·æ±‚ï¼Œåˆ™å°†è¯·æ±‚ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†å™¨ã€‚ å®¢æˆ·ç«¯ï¼ˆClientï¼‰ï¼šåˆ›å»ºè´£ä»»é“¾ï¼Œå¹¶å°†è¯·æ±‚å‘é€ç»™é“¾æ¡çš„èµ·ç‚¹ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œè¯´æ˜å¦‚ä½•ä½¿ç”¨è´£ä»»é“¾æ¨¡å¼å¤„ç†è¯·æ±‚ï¼š\n// æŠ½è±¡å¤„ç†å™¨ public abstract class Handler { protected Handler nextHandler; public void setNextHandler(Handler nextHandler) { this.nextHandler = nextHandler; } public abstract void handleRequest(Request request); } // å…·ä½“å¤„ç†å™¨ public class ConcreteHandler1 extends Handler { @Override public void handleRequest(Request request) { if (æ»¡è¶³å¤„ç†æ¡ä»¶) { // å¤„ç†è¯·æ±‚çš„é€»è¾‘ } else if (nextHandler != null) { // å°†è¯·æ±‚ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†å™¨ nextHandler.handleRequest(request); } } } // å…·ä½“å¤„ç†å™¨2å’Œå…·ä½“å¤„ç†å™¨3çš„å®šä¹‰ä¸å…·ä½“å¤„ç†å™¨1ç±»ä¼¼ // å®¢æˆ·ç«¯ public class Client { public static void main(String[] args) { Handler handler1 = new ConcreteHandler1(); Handler handler2 = new ConcreteHandler2(); Handler handler3 = new ConcreteHandler3(); // æ„å»ºè´£ä»»é“¾ handler1.setNextHandler(handler2); handler2.setNextHandler(handler3); // åˆ›å»ºè¯·æ±‚ Request request = new Request(); // å‘é€è¯·æ±‚ç»™è´£ä»»é“¾çš„èµ·ç‚¹ handler1.handleRequest(request); } } åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼ŒæŠ½è±¡å¤„ç†å™¨ï¼ˆHandlerï¼‰å®šä¹‰äº†å¤„ç†è¯·æ±‚çš„æ¥å£ï¼Œå¹¶åŒ…å«ä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªå¤„ç†å™¨çš„å¼•ç”¨ã€‚å…·ä½“å¤„ç†å™¨ï¼ˆConcreteHandlerï¼‰ç»§æ‰¿è‡ªæŠ½è±¡å¤„ç†å™¨ï¼Œå®ç°äº†å¤„ç†è¯·æ±‚çš„é€»è¾‘ï¼Œå¦‚æœè‡ªå·±æ— æ³•å¤„ç†è¯·æ±‚ï¼Œåˆ™å°†è¯·æ±‚ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†å™¨ã€‚å®¢æˆ·ç«¯ï¼ˆClientï¼‰åˆ›å»ºäº†å…·ä½“å¤„ç†å™¨çš„å®ä¾‹ï¼Œå¹¶æ„å»ºäº†è´£ä»»é“¾ï¼Œç„¶åå°†è¯·æ±‚å‘é€ç»™è´£ä»»é“¾çš„èµ·ç‚¹ã€‚\nè´£ä»»é“¾æ¨¡å¼çš„ä¼˜ç‚¹åŒ…æ‹¬ï¼š\nè§£è€¦è¯·æ±‚å‘é€è€…å’Œæ¥æ”¶è€…ï¼Œè®©å¤šä¸ªå¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ã€‚ çµæ´»æ€§é«˜ï¼Œå¯ä»¥åŠ¨æ€åœ°æ”¹å˜è´£ä»»é“¾çš„ç»“æ„å’Œé¡ºåºã€‚ å¯ä»¥ç®€åŒ–å¯¹è±¡ä¹‹é—´çš„äº¤äº’ï¼Œæ¯ä¸ªå¯¹è±¡åªéœ€è¦å…³æ³¨è‡ªå·±çš„å¤„ç†é€»è¾‘ã€‚ ç„¶è€Œï¼Œè´£ä»»é“¾æ¨¡å¼ä¹Ÿæœ‰ä¸€äº›æ³¨æ„äº‹é¡¹ï¼š\néœ€è¦æ³¨æ„é“¾æ¡çš„æ„å»ºé¡ºåºï¼Œç¡®ä¿è¯·æ±‚å¯ä»¥è¢«æ­£ç¡®åœ°å¤„ç†ã€‚ å¦‚æœè´£ä»»é“¾è¿‡é•¿æˆ–å¤„ç†é€»è¾‘å¤æ‚ï¼Œå¯èƒ½ä¼šå½±å“æ€§èƒ½ã€‚ è¯·æ±‚å¯èƒ½æ— æ³•è¢«å¤„ç†ï¼Œéœ€è¦åœ¨è®¾è®¡ä¸­è€ƒè™‘é»˜è®¤å¤„ç†æˆ–å¼‚å¸¸å¤„ç†æœºåˆ¶ã€‚ é€‚ç”¨åœºæ™¯ è´£ä»»é“¾æ¨¡å¼åœ¨ä»¥ä¸‹å‡ ç§åº”ç”¨åœºæ™¯ä¸­ç»å¸¸è¢«ä½¿ç”¨ï¼š\nè¯·æ±‚å¤„ç†é“¾ï¼šå½“ä¸€ä¸ªè¯·æ±‚éœ€è¦ç»è¿‡å¤šä¸ªå¤„ç†å™¨è¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸”æ¯ä¸ªå¤„ç†å™¨éƒ½æœ‰å¯èƒ½å¤„ç†è¯¥è¯·æ±‚æˆ–å°†å…¶ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†å™¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è´£ä»»é“¾æ¨¡å¼ã€‚ä¾‹å¦‚ï¼ŒWebå¼€å‘ä¸­çš„è¯·æ±‚å¤„ç†ã€æ—¥å¿—è®°å½•ç³»ç»Ÿä¸­çš„æ—¥å¿—å¤„ç†ç­‰ã€‚ å¼‚å¸¸å¤„ç†ï¼šåœ¨å¤„ç†å¼‚å¸¸æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è´£ä»»é“¾æ¨¡å¼æ¥å¤„ç†ä¸åŒç±»å‹çš„å¼‚å¸¸ã€‚æ¯ä¸ªå¤„ç†å™¨è´Ÿè´£å¤„ç†ä¸€ç§ç±»å‹çš„å¼‚å¸¸ï¼Œå¦‚æœæ— æ³•å¤„ç†ï¼Œåˆ™å°†å¼‚å¸¸ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†å™¨ã€‚è¿™æ ·å¯ä»¥å®ç°å¼‚å¸¸å¤„ç†çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚ æƒé™éªŒè¯ï¼šåœ¨ä¸€ä¸ªç³»ç»Ÿä¸­ï¼Œå¯ä»¥ä½¿ç”¨è´£ä»»é“¾æ¨¡å¼æ¥è¿›è¡Œæƒé™éªŒè¯ã€‚æ¯ä¸ªå¤„ç†å™¨å¯ä»¥éªŒè¯æŸä¸ªç‰¹å®šæƒé™ï¼Œå¦‚æœæ— æ³•éªŒè¯ï¼Œåˆ™å°†éªŒè¯è¯·æ±‚ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†å™¨ã€‚è¿™æ ·å¯ä»¥å®ç°æƒé™éªŒè¯çš„çµæ´»ç»„åˆå’ŒåŠ¨æ€è°ƒæ•´ã€‚ æ—¥å¿—è®°å½•ï¼šåœ¨æ—¥å¿—è®°å½•ç³»ç»Ÿä¸­ï¼Œå¯ä»¥ä½¿ç”¨è´£ä»»é“¾æ¨¡å¼æ¥å¤„ç†ä¸åŒçº§åˆ«çš„æ—¥å¿—ä¿¡æ¯ã€‚æ¯ä¸ªå¤„ç†å™¨è´Ÿè´£è®°å½•ç‰¹å®šçº§åˆ«çš„æ—¥å¿—ï¼Œå¦‚æœæ— æ³•å¤„ç†ï¼Œåˆ™å°†æ—¥å¿—ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†å™¨ã€‚è¿™æ ·å¯ä»¥å®ç°æ—¥å¿—è®°å½•çš„åˆ†çº§å’Œçµæ´»é…ç½®ã€‚ ç¼“å­˜å¤„ç†ï¼šåœ¨ç¼“å­˜ç³»ç»Ÿä¸­ï¼Œå¯ä»¥ä½¿ç”¨è´£ä»»é“¾æ¨¡å¼æ¥å¤„ç†ç¼“å­˜è¯»å–è¯·æ±‚ã€‚æ¯ä¸ªå¤„ç†å™¨å¯ä»¥æ ¹æ®ä¸€å®šçš„ç­–ç•¥åˆ¤æ–­æ˜¯å¦å‘½ä¸­ç¼“å­˜ï¼Œå¦‚æœæœªå‘½ä¸­åˆ™å°†è¯·æ±‚ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†å™¨ã€‚è¿™æ ·å¯ä»¥å®ç°ç¼“å­˜çš„å±‚çº§å’Œçµæ´»çš„ç¼“å­˜ç­–ç•¥ã€‚ æ•°æ®éªŒè¯å™¨ï¼ˆData Validatorï¼‰ï¼šåœ¨æ•°æ®éªŒè¯è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨è´£ä»»é“¾æ¨¡å¼æ¥å¯¹æ•°æ®è¿›è¡Œä¸åŒç±»å‹çš„éªŒè¯ã€‚æ¯ä¸ªéªŒè¯å™¨è´Ÿè´£éªŒè¯ç‰¹å®šçš„æ•°æ®è§„åˆ™ï¼Œå¦‚æœæ— æ³•éªŒè¯ï¼Œåˆ™å°†éªŒè¯è¯·æ±‚ä¼ é€’ç»™ä¸‹ä¸€ä¸ªéªŒè¯å™¨ã€‚è¿™æ ·å¯ä»¥å®ç°æ•°æ®éªŒè¯çš„åˆ†æ­¥å¤„ç†å’Œçµæ´»çš„éªŒè¯è§„åˆ™ç»„åˆã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè´£ä»»é“¾æ¨¡å¼é€‚ç”¨äºå¤„ç†è¯·æ±‚çš„åœºæ™¯ï¼Œå…¶ä¸­æ¯ä¸ªå¤„ç†å™¨éƒ½æœ‰å¯èƒ½å¤„ç†è¯·æ±‚æˆ–å°†å…¶ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†å™¨ã€‚åœ¨é€‰æ‹©ä½¿ç”¨è´£ä»»é“¾æ¨¡å¼æ—¶ï¼Œéœ€ç¡®ä¿è¯·æ±‚èƒ½å¤Ÿè¢«æ­£ç¡®å¤„ç†ï¼Œå¹¶ä¸”é“¾æ¡çš„æ„å»ºé¡ºåºæ˜¯åˆç†çš„ï¼Œé¿å…å‡ºç°æ­»å¾ªç¯æˆ–è¯·æ±‚æ— æ³•è¢«å¤„ç†çš„æƒ…å†µã€‚\nä¸¾ä¾‹ è¿™æ®µä»£ç å±•ç¤ºäº†ä¸€ä¸ªç®€å•çš„æ³›å‹è´£ä»»é“¾æ¨¡å¼å®ç°ï¼Œå…¶ä¸­åŒ…æ‹¬Handleræ¥å£å’ŒPipelineç±»ã€‚\npublic interface Handler\u0026lt;I, O\u0026gt; { O process(I input); } public class Pipeline\u0026lt;I, O\u0026gt; { private final Handler\u0026lt;I, O\u0026gt; currentHandler; public Pipeline(Handler\u0026lt;I, O\u0026gt; currentHandler) { this.currentHandler = currentHandler; } public \u0026lt;K\u0026gt; Pipeline\u0026lt;I, K\u0026gt; addHandler(Handler\u0026lt;O, K\u0026gt; newHandler) { return new Pipeline\u0026lt;\u0026gt;(input -\u0026gt; newHandler.process(currentHandler.process(input))); } public O execute(I input) { return currentHandler.process(input); } } åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼ŒHandleræ¥å£å®šä¹‰äº†ä¸€ä¸ªå¤„ç†è¾“å…¥ç±»å‹ä¸ºIï¼Œè¾“å‡ºç±»å‹ä¸ºOçš„æ“ä½œã€‚å®ƒåŒ…å«ä¸€ä¸ªprocessæ–¹æ³•ï¼Œç”¨äºæ‰§è¡Œå¤„ç†é€»è¾‘ã€‚\nPipelineç±»æ˜¯ä¸€ä¸ªæ³›å‹ç±»ï¼Œå®ƒæ¥å—è¾“å…¥ç±»å‹Iå’Œè¾“å‡ºç±»å‹Oã€‚åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œé€šè¿‡ä¼ å…¥ä¸€ä¸ªåˆå§‹çš„currentHandlerï¼Œåˆ›å»ºä¸€ä¸ªè´£ä»»é“¾çš„èµ·ç‚¹ã€‚\nPipelineç±»æä¾›äº†addHandleræ–¹æ³•ï¼Œç”¨äºæ·»åŠ æ–°çš„å¤„ç†å™¨åˆ°è´£ä»»é“¾ä¸­ã€‚è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªå®ç°äº†Handleræ¥å£çš„newHandlerï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„Pipelineå¯¹è±¡ï¼Œæ–°çš„è´£ä»»é“¾åŒ…æ‹¬ä¹‹å‰çš„å¤„ç†å™¨å’Œæ–°çš„å¤„ç†å™¨ã€‚\nexecuteæ–¹æ³•ç”¨äºæ‰§è¡Œæ•´ä¸ªè´£ä»»é“¾ã€‚å®ƒæ¥å—è¾“å…¥å‚æ•°inputï¼Œå¹¶é€šè¿‡è°ƒç”¨å½“å‰å¤„ç†å™¨çš„processæ–¹æ³•ï¼Œä¾æ¬¡æ‰§è¡Œè´£ä»»é“¾ä¸­çš„æ¯ä¸ªå¤„ç†å™¨ï¼Œå¹¶è¿”å›æœ€ç»ˆçš„è¾“å‡ºç»“æœã€‚\nä½¿ç”¨è¿™ä¸ªç®€å•çš„æ³›å‹è´£ä»»é“¾æ¨¡å¼ï¼Œä½ å¯ä»¥æ ¹æ®å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚åˆ›å»ºä¸åŒç±»å‹çš„å¤„ç†å™¨ï¼Œå¹¶é€šè¿‡addHandleræ–¹æ³•å°†å®ƒä»¬è¿æ¥åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªå¤„ç†æµç¨‹ã€‚ç„¶åï¼Œä½ å¯ä»¥ä½¿ç”¨executeæ–¹æ³•å°†è¾“å…¥æ•°æ®ä¼ å…¥è´£ä»»é“¾ä¸­ï¼Œä¾æ¬¡ç»è¿‡æ¯ä¸ªå¤„ç†å™¨è¿›è¡Œå¤„ç†ï¼Œæœ€ç»ˆå¾—åˆ°è¾“å‡ºç»“æœã€‚\nå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¤„ç†å™¨é“¾ï¼Œç”¨äºå¤„ç†å­—ç¬¦ä¸²çš„è½¬æ¢æ“ä½œï¼š\npublic class StringToUpperHandler implements Handler\u0026lt;String, String\u0026gt; { @Override public String process(String input) { return input.toUpperCase(); } } public class StringTrimHandler implements Handler\u0026lt;String, String\u0026gt; { @Override public String process(String input) { return input.trim(); } } public class StringReverseHandler implements Handler\u0026lt;String, String\u0026gt; { @Override public String process(String input) { return new StringBuilder(input).reverse().toString(); } } ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™äº›å¤„ç†å™¨æ¥åˆ›å»ºä¸€ä¸ªå¤„ç†æµç¨‹ï¼Œå¹¶æ‰§è¡Œè¾“å…¥å­—ç¬¦ä¸²çš„è½¬æ¢æ“ä½œï¼š\npublic class Main { public static void main(String[] args) { // åˆ›å»ºå¤„ç†å™¨å’Œå¤„ç†æµç¨‹ Handler\u0026lt;String, String\u0026gt; toUpperHandler = new StringToUpperHandler(); Handler\u0026lt;String, String\u0026gt; trimHandler = new StringTrimHandler(); Handler\u0026lt;String, String\u0026gt; reverseHandler = new StringReverseHandler(); Pipeline\u0026lt;String, String\u0026gt; pipeline = new Pipeline\u0026lt;\u0026gt;(toUpperHandler) .addHandler(trimHandler) .addHandler(reverseHandler); // æ‰§è¡Œå¤„ç†æµç¨‹ String input = \u0026#34; Hello, World! \u0026#34;; String output = pipeline.execute(input); System.out.println(\u0026#34;Output: \u0026#34; + output); } } åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸‰ä¸ªå¤„ç†å™¨ï¼šStringToUpperHandlerã€StringTrimHandlerå’ŒStringReverseHandlerï¼Œå®ƒä»¬åˆ†åˆ«ç”¨äºå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¤§å†™ã€å»é™¤ç©ºæ ¼å’Œåè½¬å­—ç¬¦ä¸²ã€‚\nç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨è¿™äº›å¤„ç†å™¨åˆ›å»ºäº†ä¸€ä¸ªå¤„ç†æµç¨‹ï¼Œé€šè¿‡è°ƒç”¨addHandleræ–¹æ³•å°†å®ƒä»¬é€æ­¥é“¾æ¥åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªå¤„ç†å™¨é“¾ã€‚\næœ€åï¼Œæˆ‘ä»¬æ‰§è¡Œå¤„ç†æµç¨‹ï¼Œå°†è¾“å…¥å­—ç¬¦ä¸²\u0026quot; Hello, World! \u0026quot;ä¼ å…¥executeæ–¹æ³•ä¸­ã€‚è¯¥è¾“å…¥å­—ç¬¦ä¸²é¦–å…ˆç»è¿‡toUpperHandlerå¤„ç†å™¨å¤„ç†ï¼Œç„¶åä¼ é€’ç»™trimHandlerè¿›è¡Œå¤„ç†ï¼Œæœ€åä¼ é€’ç»™reverseHandlerè¿›è¡Œå¤„ç†ã€‚å¤„ç†å®Œæˆåï¼Œå¾—åˆ°æœ€ç»ˆçš„è¾“å‡ºç»“æœã€‚\nåœ¨æœ¬ä¾‹ä¸­ï¼Œè¾“å‡ºç»“æœä¸º\u0026quot;!DLROW ,OLLEH\u0026quot;ï¼Œè¿™æ˜¯é€šè¿‡ä¾æ¬¡åº”ç”¨å¤„ç†å™¨é“¾ä¸­çš„æ¯ä¸ªå¤„ç†å™¨å¯¹è¾“å…¥å­—ç¬¦ä¸²è¿›è¡Œè½¬æ¢è€Œå¾—åˆ°çš„ã€‚\nJavaä¸­çš„ä¾‹å­ java.util.logging.Logger#log() Apache Commons Chain javax.servlet.Filter#doFilter() ","permalink":"https://blog.chensoul.cc/posts/2023/10/16/java-design-patterns-chain/","summary":"æœ¬æ–‡ä¸»è¦ä»‹ç» Chain æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nç›®çš„ é€šè¿‡ç»™å¤šä¸ªå¯¹è±¡ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„æœºä¼šï¼Œé¿å…è¯·æ±‚çš„å‘é€è€…å’Œå®ƒçš„æ¥æ”¶è€…è€¦åˆã€‚ä¸²è”æ¥æ”¶å¯¹è±¡å¹¶åœ¨é“¾æ¡ä¸­ä¼ é€’è¯·æ±‚ç›´åˆ°ä¸€ä¸ªå¯¹è±¡å¤„ç†å®ƒã€‚\nä»‹ç» è´£ä»»é“¾æ¨¡å¼ï¼ˆChain of Responsibility Patternï¼‰æ˜¯ä¸€ç§è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸å¤šä¸ªå¯¹è±¡æŒ‰ç…§é¡ºåºå¤„ç†è¯·æ±‚ï¼Œç›´åˆ°å…¶ä¸­ä¸€ä¸ªå¯¹è±¡èƒ½å¤Ÿå¤„ç†è¯¥è¯·æ±‚ä¸ºæ­¢ã€‚è¯¥æ¨¡å¼å°†è¯·æ±‚å‘é€è€…å’Œæ¥æ”¶è€…è§£è€¦ï¼Œä½¿å¤šä¸ªå¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼ŒåŒæ—¶é¿å…è¯·æ±‚å‘é€è€…ä¸æ¥æ”¶è€…ä¹‹é—´çš„ç›´æ¥è€¦åˆã€‚\nåœ¨è´£ä»»é“¾æ¨¡å¼ä¸­ï¼Œé€šå¸¸ä¼šæ„å»ºä¸€ä¸ªå¤„ç†è¯·æ±‚çš„é“¾æ¡ï¼Œé“¾æ¡ä¸Šçš„æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚å½“è¯·æ±‚åˆ°è¾¾é“¾æ¡çš„èµ·ç‚¹æ—¶ï¼Œå®ƒä¼šä¾æ¬¡ç»è¿‡é“¾æ¡ä¸Šçš„æ¯ä¸ªå¯¹è±¡ï¼Œç›´åˆ°æ‰¾åˆ°èƒ½å¤Ÿå¤„ç†è¯·æ±‚çš„å¯¹è±¡ä¸ºæ­¢ã€‚æ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥å†³å®šæ˜¯å¦å¤„ç†è¯·æ±‚ï¼Œæˆ–è€…å°†è¯·æ±‚ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¯¹è±¡ã€‚\nä»¥ä¸‹æ˜¯è´£ä»»é“¾æ¨¡å¼çš„å‡ ä¸ªå…³é”®è§’è‰²ï¼š\næŠ½è±¡å¤„ç†å™¨ï¼ˆHandlerï¼‰ï¼šå®šä¹‰å¤„ç†è¯·æ±‚çš„æ¥å£ï¼Œå¹¶åŒ…å«ä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€ä¸ªå¤„ç†å™¨çš„å¼•ç”¨ã€‚é€šå¸¸ä¼šæä¾›ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„æ–¹æ³•ã€‚ å…·ä½“å¤„ç†å™¨ï¼ˆConcreteHandlerï¼‰ï¼šå®ç°æŠ½è±¡å¤„ç†å™¨çš„æ¥å£ï¼Œå…·ä½“å¤„ç†è¯·æ±‚çš„é€»è¾‘ã€‚å¦‚æœè‡ªå·±æ— æ³•å¤„ç†è¯·æ±‚ï¼Œåˆ™å°†è¯·æ±‚ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†å™¨ã€‚ å®¢æˆ·ç«¯ï¼ˆClientï¼‰ï¼šåˆ›å»ºè´£ä»»é“¾ï¼Œå¹¶å°†è¯·æ±‚å‘é€ç»™é“¾æ¡çš„èµ·ç‚¹ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œè¯´æ˜å¦‚ä½•ä½¿ç”¨è´£ä»»é“¾æ¨¡å¼å¤„ç†è¯·æ±‚ï¼š\n// æŠ½è±¡å¤„ç†å™¨ public abstract class Handler { protected Handler nextHandler; public void setNextHandler(Handler nextHandler) { this.nextHandler = nextHandler; } public abstract void handleRequest(Request request); } // å…·ä½“å¤„ç†å™¨ public class ConcreteHandler1 extends Handler { @Override public void handleRequest(Request request) { if (æ»¡è¶³å¤„ç†æ¡ä»¶) { // å¤„ç†è¯·æ±‚çš„é€»è¾‘ } else if (nextHandler != null) { // å°†è¯·æ±‚ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†å™¨ nextHandler.handleRequest(request); } } } // å…·ä½“å¤„ç†å™¨2å’Œå…·ä½“å¤„ç†å™¨3çš„å®šä¹‰ä¸å…·ä½“å¤„ç†å™¨1ç±»ä¼¼ // å®¢æˆ·ç«¯ public class Client { public static void main(String[] args) { Handler handler1 = new ConcreteHandler1(); Handler handler2 = new ConcreteHandler2(); Handler handler3 = new ConcreteHandler3(); // æ„å»ºè´£ä»»é“¾ handler1.","title":"Javaè®¾è®¡æ¨¡å¼ï¼šChain"},{"content":"æœ¬æ–‡ä¸»è¦ä»‹ç» Callback æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nä»‹ç» å›è°ƒï¼ˆCallbackï¼‰æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸­ï¼Œä¸€ä¸ªå¯æ‰§è¡Œçš„ä»£ç è¢«ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–ä»£ç ï¼Œæ¥æ”¶æ–¹çš„ä»£ç å¯ä»¥åœ¨é€‚å½“çš„æ—¶å€™è°ƒç”¨å®ƒã€‚\nåœ¨çœŸå®ä¸–ç•Œçš„ä¾‹å­ä¸­ï¼Œå½“æˆ‘ä»¬éœ€è¦åœ¨ä»»åŠ¡å®Œæˆæ—¶è¢«é€šçŸ¥æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªå›è°ƒæ–¹æ³•ä¼ é€’ç»™è°ƒç”¨è€…ï¼Œå¹¶ç­‰å¾…å®ƒè°ƒç”¨ä»¥é€šçŸ¥æˆ‘ä»¬ã€‚ç®€å•åœ°è¯´ï¼Œå›è°ƒæ˜¯ä¸€ä¸ªä¼ é€’ç»™è°ƒç”¨è€…çš„æ–¹æ³•ï¼Œåœ¨å®šä¹‰çš„æ—¶åˆ»è¢«è°ƒç”¨ã€‚\nç»´åŸºç™¾ç§‘è¯´\nåœ¨è®¡ç®—æœºç¼–ç¨‹ä¸­ï¼Œå›è°ƒåˆè¢«ç§°ä¸ºâ€œç¨åè°ƒç”¨â€å‡½æ•°ï¼Œå¯ä»¥æ˜¯ä»»ä½•å¯æ‰§è¡Œçš„ä»£ç ç”¨æ¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–ä»£ç ï¼›å…¶å®ƒä»£ç è¢«æœŸæœ›åœ¨ç»™å®šæ—¶é—´å†…è°ƒç”¨å›è°ƒæ–¹æ³•ã€‚\nä»£ç  å›è°ƒæ˜¯ä¸€ä¸ªåªæœ‰ä¸€ä¸ªæ–¹æ³•çš„ç®€å•æ¥å£ã€‚\npublic interface Callback { void call(); } ä¸‹é¢æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªä»»åŠ¡å®ƒå°†åœ¨ä»»åŠ¡æ‰§è¡Œå®Œæˆåæ‰§è¡Œå›è°ƒã€‚\npublic abstract class Task { final void executeWith(Callback callback) { execute(); Optional.ofNullable(callback).ifPresent(Callback::call); } public abstract void execute(); } public final class SimpleTask extends Task { private static final Logger LOGGER = getLogger(SimpleTask.class); @Override public void execute() { LOGGER.info(\u0026#34;Perform some important activity and after call the callback method.\u0026#34;); } } æœ€åè¿™é‡Œæ˜¯æˆ‘ä»¬å¦‚ä½•æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ç„¶åæ¥æ”¶ä¸€ä¸ªå›è°ƒå½“å®ƒå®Œæˆæ—¶ã€‚\nvar task = new SimpleTask(); task.executeWith(() -\u0026gt; LOGGER.info(\u0026#34;I\u0026#39;m done now.\u0026#34;)); ç±»å›¾ é€‚ç”¨åœºæ™¯ å›è°ƒæ¨¡å¼é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š\nå¼‚æ­¥æ“ä½œï¼šå½“éœ€è¦åœ¨å¼‚æ­¥æ“ä½œå®Œæˆåæ‰§è¡ŒæŸäº›æ“ä½œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨å›è°ƒæ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œåœ¨ç½‘ç»œè¯·æ±‚ä¸­ï¼Œå¯ä»¥ä¼ é€’ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œåœ¨è¯·æ±‚å®Œæˆåè°ƒç”¨è¯¥å‡½æ•°å¤„ç†å“åº”æ•°æ®ã€‚ äº‹ä»¶å¤„ç†ï¼šå½“éœ€è¦å¯¹äº‹ä»¶è¿›è¡Œå“åº”å’Œå¤„ç†æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å›è°ƒæ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œåœ¨å›¾å½¢ç•Œé¢å¼€å‘ä¸­ï¼Œå¯ä»¥æ³¨å†ŒæŸä¸ªæ§ä»¶çš„å›è°ƒå‡½æ•°ï¼Œä»¥ä¾¿åœ¨ç”¨æˆ·è§¦å‘äº‹ä»¶æ—¶æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚ æ’ä»¶æ‰©å±•ï¼šå½“éœ€è¦ä¸ºåº”ç”¨ç¨‹åºæä¾›æ‰©å±•æ€§ï¼Œå…è®¸ç¬¬ä¸‰æ–¹æ’ä»¶åœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶è¿›è¡Œè‡ªå®šä¹‰æ“ä½œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨å›è°ƒæ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œæ¸¸æˆå¼•æ“ä¸­çš„äº‹ä»¶ç³»ç»Ÿå…è®¸å¼€å‘è€…æ³¨å†Œå›è°ƒå‡½æ•°ä»¥å“åº”æ¸¸æˆä¸­çš„ç‰¹å®šäº‹ä»¶ã€‚ å›è°ƒé“¾ï¼šå½“éœ€è¦æŒ‰ç‰¹å®šé¡ºåºæ‰§è¡Œå¤šä¸ªå›è°ƒå‡½æ•°ï¼Œå¹¶å°†å‰ä¸€ä¸ªå›è°ƒå‡½æ•°çš„ç»“æœä¼ é€’ç»™ä¸‹ä¸€ä¸ªå›è°ƒå‡½æ•°æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å›è°ƒæ¨¡å¼ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå›è°ƒå‡½æ•°å½¢æˆäº†ä¸€ä¸ªå›è°ƒé“¾ã€‚ æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼šå›è°ƒæ¨¡å¼å¸¸ä¸æ¨¡æ¿æ–¹æ³•æ¨¡å¼ç»“åˆä½¿ç”¨ã€‚æ¨¡æ¿æ–¹æ³•æ¨¡å¼å®šä¹‰äº†ä¸€ä¸ªç®—æ³•çš„éª¨æ¶ï¼Œè€Œå…·ä½“çš„æ­¥éª¤ç”±å­ç±»å®ç°ã€‚å¯ä»¥ä½¿ç”¨å›è°ƒæ¨¡å¼å°†å­ç±»ä¸­çš„å…·ä½“æ­¥éª¤ä½œä¸ºå›è°ƒå‡½æ•°ä¼ é€’ç»™æ¨¡æ¿æ–¹æ³•ã€‚ æ€»çš„æ¥è¯´ï¼Œå›è°ƒæ¨¡å¼é€‚ç”¨äºéœ€è¦åœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿåæ‰§è¡ŒæŸäº›æ“ä½œçš„æƒ…å†µï¼Œä»¥åŠéœ€è¦å®ç°è§£è€¦å’Œçµæ´»æ€§çš„åœºæ™¯ã€‚å®ƒæä¾›äº†ä¸€ç§åœ¨ä»£ç é—´é€šä¿¡çš„æ–¹å¼ï¼Œä½¿å¾—ä»£ç å¯ä»¥æ›´åŠ æ¨¡å—åŒ–å’Œå¯å¤ç”¨ã€‚\nJava ä¾‹å­ CyclicBarrier æ„é€ å‡½æ•°å¯ä»¥æ¥å—å›è°ƒï¼Œè¯¥å›è°ƒå°†åœ¨æ¯æ¬¡éšœç¢è¢«è§¦å‘æ—¶è§¦å‘ã€‚ FAQ å›è°ƒæ¨¡å¼å¦‚ä½•å®ç°è§£è€¦å’Œçµæ´»æ€§ï¼Ÿ å›è°ƒæ¨¡å¼é€šè¿‡å°†ä¸€ä¸ªå¯æ‰§è¡Œçš„ä»£ç å—ï¼ˆå›è°ƒå‡½æ•°ï¼‰ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–ä»£ç ï¼Œå®ç°äº†è§£è€¦å’Œçµæ´»æ€§ã€‚\nè§£è€¦æ€§ï¼šå›è°ƒæ¨¡å¼å¯ä»¥å°†è°ƒç”¨æ–¹ä¸è¢«è°ƒç”¨æ–¹è§£è€¦ï¼Œä½¿å®ƒä»¬ä¹‹é—´çš„å…³ç³»æ›´åŠ æ¾æ•£ã€‚è°ƒç”¨æ–¹åªéœ€è¦çŸ¥é“å›è°ƒå‡½æ•°çš„æ¥å£ï¼Œè€Œä¸éœ€è¦äº†è§£å…·ä½“çš„å®ç°ç»†èŠ‚ã€‚è¢«è°ƒç”¨æ–¹åœ¨ç‰¹å®šçš„æ—¶æœºè°ƒç”¨å›è°ƒå‡½æ•°ï¼Œè€Œä¸éœ€è¦çŸ¥é“è°ƒç”¨æ–¹çš„å…·ä½“å®ç°ã€‚è¿™ç§è§£è€¦æ€§ä½¿å¾—ç³»ç»Ÿä¸­çš„ä¸åŒéƒ¨åˆ†å¯ä»¥ç‹¬ç«‹åœ°è¿›è¡Œä¿®æ”¹å’Œæ‰©å±•ï¼Œè€Œä¸ä¼šå¯¹å½¼æ­¤äº§ç”Ÿè¿‡å¤šçš„ä¾èµ–ã€‚\nçµæ´»æ€§ï¼šå›è°ƒæ¨¡å¼æä¾›äº†ä¸€ç§çµæ´»çš„æ‰©å±•æœºåˆ¶ã€‚é€šè¿‡ä¼ é€’ä¸åŒçš„å›è°ƒå‡½æ•°ï¼Œå¯ä»¥æ”¹å˜ç¨‹åºçš„è¡Œä¸ºæˆ–é€»è¾‘ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹åŸæœ‰çš„ä»£ç ã€‚è¿™ç§çµæ´»æ€§ä½¿å¾—ç³»ç»Ÿå¯ä»¥é€‚åº”ä¸åŒçš„éœ€æ±‚å’Œå˜åŒ–ï¼Œè€Œä¸éœ€è¦è¿›è¡Œå¤§è§„æ¨¡çš„ä¿®æ”¹æˆ–é‡æ„ã€‚åŒæ—¶ï¼Œå›è°ƒæ¨¡å¼ä¹Ÿå…è®¸åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°ä¿®æ”¹å›è°ƒå‡½æ•°ï¼Œä»è€Œå®ç°æ›´é«˜çº§çš„åŠ¨æ€è¡Œä¸ºã€‚\né€šè¿‡ä½¿ç”¨å›è°ƒæ¨¡å¼ï¼Œç³»ç»Ÿçš„ä¸åŒéƒ¨åˆ†å¯ä»¥ç›¸äº’ç‹¬ç«‹åœ°æ¼”åŒ–å’Œæ‰©å±•ï¼Œè€Œä¸ä¼šå¼•å…¥è¿‡å¤šçš„ç´§è€¦åˆå…³ç³»ã€‚è¿™ä½¿å¾—ä»£ç æ›´åŠ æ¨¡å—åŒ–ã€å¯å¤ç”¨å’Œå¯ç»´æŠ¤ã€‚æ­¤å¤–ï¼Œå›è°ƒæ¨¡å¼è¿˜å¯ä»¥æé«˜ä»£ç çš„å¯æµ‹è¯•æ€§ï¼Œå› ä¸ºå¯ä»¥ä½¿ç”¨æ¨¡æ‹Ÿæˆ–æ›¿ä»£çš„å›è°ƒå‡½æ•°æ¥è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚\næ€»è€Œè¨€ä¹‹ï¼Œå›è°ƒæ¨¡å¼é€šè¿‡è§£è€¦å’Œçµæ´»æ€§çš„ç‰¹æ€§ï¼Œå¸®åŠ©æé«˜äº†ä»£ç çš„å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§å’Œå¯æµ‹è¯•æ€§ï¼Œä½¿ç³»ç»Ÿæ›´åŠ çµæ´»å’Œé€‚åº”å˜åŒ–ã€‚\nå›è°ƒæ¨¡å¼å’Œäº‹ä»¶é©±åŠ¨æ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ å›è°ƒæ¨¡å¼å’Œäº‹ä»¶é©±åŠ¨æ¨¡å¼æ˜¯ä¸¤ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒä»¬åœ¨æŸäº›æ–¹é¢æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œä½†ä¹Ÿå­˜åœ¨ä¸€äº›åŒºåˆ«ã€‚\nå›è°ƒæ¨¡å¼ï¼š\nåœ¨å›è°ƒæ¨¡å¼ä¸­ï¼Œä¸€ä¸ªå¯æ‰§è¡Œçš„ä»£ç å—ï¼ˆå›è°ƒå‡½æ•°ï¼‰è¢«ä¼ é€’ç»™å…¶ä»–ä»£ç ï¼Œä»¥ä¾¿åœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶è¢«è°ƒç”¨ã€‚ å›è°ƒå‡½æ•°é€šå¸¸ç”±è°ƒç”¨æ–¹æä¾›ï¼Œç”¨äºå®šä¹‰åœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶åº”è¯¥æ‰§è¡Œçš„æ“ä½œã€‚ å›è°ƒæ¨¡å¼ç”¨äºå®ç°è§£è€¦å’Œçµæ´»æ€§ï¼Œå…è®¸ä¸åŒæ¨¡å—ä¹‹é—´é€šè¿‡å›è°ƒå‡½æ•°è¿›è¡Œé€šä¿¡ï¼Œä½†ä¸ä¾èµ–äºå…·ä½“çš„å®ç°ç»†èŠ‚ã€‚ äº‹ä»¶é©±åŠ¨æ¨¡å¼ï¼š\näº‹ä»¶é©±åŠ¨æ¨¡å¼æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œå…¶ä¸­ç³»ç»Ÿçš„è¡Œä¸ºå’Œæ§åˆ¶æ˜¯ç”±äº‹ä»¶çš„å‘ç”Ÿå’Œå¤„ç†é©±åŠ¨çš„ã€‚ åœ¨äº‹ä»¶é©±åŠ¨æ¨¡å¼ä¸­ï¼Œç»„ä»¶ï¼ˆå¦‚æ§ä»¶ã€å¯¹è±¡ç­‰ï¼‰å¯ä»¥äº§ç”Ÿäº‹ä»¶ï¼Œå¹¶å°†å…¶å‘é€åˆ°äº‹ä»¶å¤„ç†ç¨‹åºè¿›è¡Œå¤„ç†ã€‚ äº‹ä»¶å¤„ç†ç¨‹åºæ˜¯äº‹å…ˆå®šä¹‰å¥½çš„ï¼Œç”¨äºå“åº”ç‰¹å®šç±»å‹çš„äº‹ä»¶ã€‚ äº‹ä»¶é©±åŠ¨æ¨¡å¼é€šå¸¸æ¶‰åŠäº‹ä»¶çš„å‘å¸ƒã€è®¢é˜…å’Œåˆ†å‘æœºåˆ¶ï¼Œä»¥ä¾¿å°†äº‹ä»¶è·¯ç”±åˆ°æ­£ç¡®çš„å¤„ç†ç¨‹åºã€‚ åŒºåˆ«ï¼š\nè§’è‰²å’Œé€šä¿¡æ–¹å¼ï¼šåœ¨å›è°ƒæ¨¡å¼ä¸­ï¼Œå›è°ƒå‡½æ•°æ˜¯è¢«è°ƒç”¨æ–¹æä¾›ç»™è°ƒç”¨æ–¹çš„ï¼Œé€šè¿‡å‡½æ•°å‚æ•°è¿›è¡Œä¼ é€’ã€‚è€Œåœ¨äº‹ä»¶é©±åŠ¨æ¨¡å¼ä¸­ï¼Œç»„ä»¶äº§ç”Ÿäº‹ä»¶å¹¶å°†å…¶å‘é€ç»™äº‹ä»¶å¤„ç†ç¨‹åºè¿›è¡Œå¤„ç†ã€‚ æ§åˆ¶æµï¼šåœ¨å›è°ƒæ¨¡å¼ä¸­ï¼Œè°ƒç”¨æ–¹ä¸»åŠ¨è°ƒç”¨å›è°ƒå‡½æ•°æ¥ä¼ é€’æ§åˆ¶æƒï¼Œä»¥å“åº”ç‰¹å®šäº‹ä»¶ã€‚è€Œåœ¨äº‹ä»¶é©±åŠ¨æ¨¡å¼ä¸­ï¼Œæ§åˆ¶æµæ˜¯ç”±äº‹ä»¶çš„å‘ç”Ÿå’Œå¤„ç†é©±åŠ¨çš„ï¼Œäº‹ä»¶å¤„ç†ç¨‹åºè¢«åŠ¨åœ°ç­‰å¾…äº‹ä»¶çš„å‘ç”Ÿã€‚ çµæ´»æ€§å’Œæ‰©å±•æ€§ï¼šå›è°ƒæ¨¡å¼æ›´åŠ çµæ´»ï¼Œå› ä¸ºå¯ä»¥å°†ä¸åŒçš„å›è°ƒå‡½æ•°ä¼ é€’ç»™ç›¸åŒçš„è°ƒç”¨æ–¹ï¼Œä»è€Œæ”¹å˜å…¶è¡Œä¸ºã€‚è€Œäº‹ä»¶é©±åŠ¨æ¨¡å¼æ›´åŠ é€‚ç”¨äºå¤§å‹ç³»ç»Ÿï¼Œå› ä¸ºå¯ä»¥é€šè¿‡æ·»åŠ ã€ç§»é™¤æˆ–æ›¿æ¢äº‹ä»¶å¤„ç†ç¨‹åºæ¥æ‰©å±•ç³»ç»Ÿçš„åŠŸèƒ½ã€‚ é€šä¿¡æœºåˆ¶ï¼šå›è°ƒæ¨¡å¼é€šå¸¸ä½¿ç”¨å‡½æ•°å‚æ•°è¿›è¡Œé€šä¿¡ï¼Œè€Œäº‹ä»¶é©±åŠ¨æ¨¡å¼é€šå¸¸ä½¿ç”¨å‘å¸ƒ-è®¢é˜…æˆ–è§‚å¯Ÿè€…æ¨¡å¼æ¥å®ç°äº‹ä»¶çš„ä¼ é€’å’Œå¤„ç†ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå›è°ƒæ¨¡å¼å’Œäº‹ä»¶é©±åŠ¨æ¨¡å¼å¹¶ä¸æ˜¯äº’æ–¥çš„ï¼Œå®ƒä»¬å¯ä»¥åŒæ—¶å­˜åœ¨äºä¸€ä¸ªç³»ç»Ÿä¸­ï¼Œç›¸äº’é…åˆä½¿ç”¨æ¥å®ç°ä¸åŒçš„éœ€æ±‚ã€‚\nå›è°ƒæ¨¡å¼å’Œè§‚å¯Ÿè€…æ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ å›è°ƒæ¨¡å¼å’Œè§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä¸¤ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒä»¬åœ¨æŸäº›æ–¹é¢æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œä½†ä¹Ÿå­˜åœ¨ä¸€äº›åŒºåˆ«ã€‚\nå›è°ƒæ¨¡å¼ï¼š\nåœ¨å›è°ƒæ¨¡å¼ä¸­ï¼Œä¸€ä¸ªå¯æ‰§è¡Œçš„ä»£ç å—ï¼ˆå›è°ƒå‡½æ•°ï¼‰è¢«ä¼ é€’ç»™å…¶ä»–ä»£ç ï¼Œä»¥ä¾¿åœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶è¢«è°ƒç”¨ã€‚ å›è°ƒå‡½æ•°é€šå¸¸ç”±è°ƒç”¨æ–¹æä¾›ï¼Œç”¨äºå®šä¹‰åœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶åº”è¯¥æ‰§è¡Œçš„æ“ä½œã€‚ å›è°ƒæ¨¡å¼ç”¨äºå®ç°è§£è€¦å’Œçµæ´»æ€§ï¼Œå…è®¸ä¸åŒæ¨¡å—ä¹‹é—´é€šè¿‡å›è°ƒå‡½æ•°è¿›è¡Œé€šä¿¡ï¼Œä½†ä¸ä¾èµ–äºå…·ä½“çš„å®ç°ç»†èŠ‚ã€‚ è§‚å¯Ÿè€…æ¨¡å¼ï¼š\nè§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä¸€ç§å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼Œç”¨äºåœ¨å¯¹è±¡ä¹‹é—´å»ºç«‹ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ã€‚å½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒä¼šé€šçŸ¥æ‰€æœ‰ä¾èµ–äºå®ƒçš„è§‚å¯Ÿè€…å¯¹è±¡ã€‚ è§‚å¯Ÿè€…æ¨¡å¼é€šå¸¸ç”±ä¸€ä¸ªä¸»é¢˜ï¼ˆè¢«è§‚å¯Ÿè€…ï¼‰å’Œå¤šä¸ªè§‚å¯Ÿè€…ç»„æˆã€‚ä¸»é¢˜ç»´æŠ¤è§‚å¯Ÿè€…åˆ—è¡¨ï¼Œå¹¶åœ¨çŠ¶æ€å˜åŒ–æ—¶é€šçŸ¥è§‚å¯Ÿè€…ã€‚ è§‚å¯Ÿè€…æ¨¡å¼ç”¨äºå®ç°å¯¹è±¡ä¹‹é—´çš„æ¾è€¦åˆï¼Œä½¿å¾—ä¸»é¢˜å’Œè§‚å¯Ÿè€…å¯ä»¥ç‹¬ç«‹å˜åŒ–ï¼Œè€Œä¸ä¼šç›¸äº’å½±å“ã€‚ åŒºåˆ«ï¼š\nè§’è‰²å’Œé€šä¿¡æ–¹å¼ï¼šåœ¨å›è°ƒæ¨¡å¼ä¸­ï¼Œå›è°ƒå‡½æ•°æ˜¯è¢«è°ƒç”¨æ–¹æä¾›ç»™è°ƒç”¨æ–¹çš„ï¼Œé€šè¿‡å‡½æ•°å‚æ•°è¿›è¡Œä¼ é€’ã€‚è€Œåœ¨è§‚å¯Ÿè€…æ¨¡å¼ä¸­ï¼Œä¸»é¢˜é€šå¸¸ç»´æŠ¤è§‚å¯Ÿè€…åˆ—è¡¨ï¼Œå¹¶é€šè¿‡é€šçŸ¥æ–¹æ³•å°†çŠ¶æ€å˜åŒ–ä¿¡æ¯ä¼ é€’ç»™è§‚å¯Ÿè€…ã€‚ æ§åˆ¶æµï¼šåœ¨å›è°ƒæ¨¡å¼ä¸­ï¼Œè°ƒç”¨æ–¹ä¸»åŠ¨è°ƒç”¨å›è°ƒå‡½æ•°æ¥ä¼ é€’æ§åˆ¶æƒï¼Œä»¥å“åº”ç‰¹å®šäº‹ä»¶ã€‚è€Œåœ¨è§‚å¯Ÿè€…æ¨¡å¼ä¸­ï¼Œä¸»é¢˜å¯¹è±¡åœ¨çŠ¶æ€å˜åŒ–æ—¶è¢«åŠ¨åœ°é€šçŸ¥è§‚å¯Ÿè€…ï¼Œå¹¶ç”±è§‚å¯Ÿè€…å†³å®šå¦‚ä½•å¤„ç†é€šçŸ¥ã€‚ å…³æ³¨ç‚¹ï¼šå›è°ƒæ¨¡å¼æ›´å…³æ³¨äºäº‹ä»¶å‘ç”Ÿåçš„å›è°ƒæ“ä½œã€‚è§‚å¯Ÿè€…æ¨¡å¼æ›´å…³æ³¨äºä¸»é¢˜å’Œè§‚å¯Ÿè€…ä¹‹é—´çš„çŠ¶æ€å˜åŒ–é€šçŸ¥å’Œå¤„ç†ã€‚ ä¾èµ–å…³ç³»ï¼šåœ¨å›è°ƒæ¨¡å¼ä¸­ï¼Œè°ƒç”¨æ–¹å’Œè¢«è°ƒç”¨æ–¹ä¹‹é—´å­˜åœ¨ç›´æ¥ä¾èµ–å…³ç³»ï¼Œå› ä¸ºå›è°ƒå‡½æ•°æ˜¯ç”±è°ƒç”¨æ–¹æä¾›çš„ã€‚è€Œåœ¨è§‚å¯Ÿè€…æ¨¡å¼ä¸­ï¼Œä¸»é¢˜å’Œè§‚å¯Ÿè€…ä¹‹é—´æ¾è€¦åˆï¼Œå®ƒä»¬åªé€šè¿‡æ¥å£è¿›è¡Œé€šä¿¡ï¼Œä¸ç›´æ¥ä¾èµ–äºå…·ä½“çš„å®ç°ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå›è°ƒæ¨¡å¼å’Œè§‚å¯Ÿè€…æ¨¡å¼å¯ä»¥æ ¹æ®å…·ä½“çš„åº”ç”¨åœºæ™¯è¿›è¡Œé€‰æ‹©å’Œç»„åˆä½¿ç”¨ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå®ƒä»¬å¯ä»¥äº’ä¸ºè¡¥å……ï¼Œå®ç°æ›´çµæ´»å’Œå¯æ‰©å±•çš„ç³»ç»Ÿè®¾è®¡ã€‚\nä½¿ç”¨å›è°ƒæ¨¡å¼ï¼Œä¼šå­˜åœ¨å†…å­˜æ³„éœ²å—ï¼Ÿ åœ¨ Java ä¸­ä½¿ç”¨å›è°ƒæ¨¡å¼æ—¶ï¼Œä¹Ÿå­˜åœ¨æ½œåœ¨çš„å†…å­˜æ³„æ¼é—®é¢˜ã€‚å†…å­˜æ³„æ¼å¯èƒ½å‘ç”Ÿåœ¨ä»¥ä¸‹æƒ…å†µä¸‹ï¼š\né•¿æœŸæŒæœ‰å›è°ƒå¯¹è±¡ï¼šå¦‚æœä¸€ä¸ªå¯¹è±¡æŒæœ‰ä¸€ä¸ªå›è°ƒå¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶ä¸”è¯¥å›è°ƒå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸæ¯”æŒæœ‰å¯¹è±¡æ›´é•¿ï¼Œé‚£ä¹ˆå³ä½¿æŒæœ‰å¯¹è±¡ä¸å†ä½¿ç”¨ï¼Œå›è°ƒå¯¹è±¡ä»ç„¶ä¿æŒå¯¹å…¶çš„å¼•ç”¨ï¼Œä»è€Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚ åŒ¿åå†…éƒ¨ç±»å›è°ƒï¼šå½“ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»ä½œä¸ºå›è°ƒå¯¹è±¡æ—¶ï¼Œå¦‚æœåŒ¿åå†…éƒ¨ç±»å¼•ç”¨äº†å¤–éƒ¨ç±»çš„å®ä¾‹ï¼Œä¸”è¯¥å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸæ¯”å›è°ƒå¯¹è±¡æ›´é•¿ï¼Œé‚£ä¹ˆå³ä½¿å¤–éƒ¨ç±»å®ä¾‹ä¸å†éœ€è¦ï¼Œå›è°ƒå¯¹è±¡ä»ç„¶ä¿æŒå¯¹å…¶çš„å¼•ç”¨ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚ ä½¿ç”¨å›è°ƒæ¨¡å¼ï¼Œå¦‚ä½•é¿å…å†…å­˜æ³„éœ²ï¼Ÿ ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„æ–¹æ³•æ¥é¿å…å†…å­˜æ³„æ¼ï¼š\nåŠæ—¶é‡Šæ”¾å¯¹è±¡å¼•ç”¨ï¼šç¡®ä¿åœ¨ä¸å†éœ€è¦å¯¹è±¡æ—¶ï¼Œæ˜¾å¼åœ°å°†å…¶å¼•ç”¨è®¾ç½®ä¸º nullã€‚è¿™æ ·å¯ä»¥ä½¿åƒåœ¾å›æ”¶å™¨èƒ½å¤Ÿå›æ”¶å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ã€‚ SomeObject obj = new SomeObject(); // ä½¿ç”¨objå¯¹è±¡... obj = null; // ä¸å†éœ€è¦objå¯¹è±¡æ—¶ï¼Œå°†å…¶å¼•ç”¨è®¾ç½®ä¸ºnull é¿å…é•¿æœŸæŒæœ‰å¯¹è±¡å¼•ç”¨ï¼šå½“ä¸€ä¸ªå¯¹è±¡æŒæœ‰å¦ä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨æ—¶ï¼Œç¡®ä¿æŒæœ‰å¼•ç”¨çš„å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸä¸æ¯”è¢«å¼•ç”¨å¯¹è±¡æ›´é•¿ã€‚åœ¨ä¸å†éœ€è¦æŒæœ‰å¯¹è±¡æ—¶ï¼ŒåŠæ—¶å°†å…¶å¼•ç”¨è®¾ç½®ä¸º nullã€‚ public class SomeClass { private Callback callback; public void setCallback(Callback callback) { this.callback = callback; } public void doSomething() { // ä½¿ç”¨callbackå¯¹è±¡... callback = null; // ä¸å†éœ€è¦callbackå¯¹è±¡æ—¶ï¼Œå°†å…¶å¼•ç”¨è®¾ç½®ä¸ºnull } } ä½¿ç”¨å¼±å¼•ç”¨æˆ–è½¯å¼•ç”¨ï¼šå¯¹äºæŸäº›æƒ…å†µä¸‹ï¼Œå½“å¯¹è±¡ä¸å†è¢«å¼ºå¼•ç”¨å¼•ç”¨æ—¶ï¼Œå¸Œæœ›èƒ½å¤Ÿè¢«åƒåœ¾å›æ”¶ï¼Œå¯ä»¥ä½¿ç”¨å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰æˆ–è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰æ¥æŒæœ‰å¯¹è±¡ã€‚è¿™æ ·ï¼Œåœ¨å†…å­˜ä¸è¶³æ—¶ï¼Œåƒåœ¾å›æ”¶å™¨å¯ä»¥å›æ”¶è¿™äº›å¯¹è±¡ã€‚ SomeObject obj = new SomeObject(); WeakReference\u0026lt;SomeObject\u0026gt; weakRef = new WeakReference\u0026lt;\u0026gt;(obj); // ä½¿ç”¨weakRefå¯¹è±¡... obj = null; // ä¸å†éœ€è¦objå¯¹è±¡æ—¶ï¼Œå°†å…¶å¼•ç”¨è®¾ç½®ä¸ºnull // åœ¨é€‚å½“çš„æ—¶æœºï¼Œæ£€æŸ¥å¼±å¼•ç”¨æ˜¯å¦è¿˜æŒæœ‰å¯¹è±¡ if (weakRef.get() == null) { // å¯¹è±¡å·²è¢«åƒåœ¾å›æ”¶ } é¿å…åŒ¿åå†…éƒ¨ç±»å¼•ç”¨å¤–éƒ¨å¯¹è±¡ï¼šåœ¨ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»æ—¶ï¼Œé¿å…åœ¨å†…éƒ¨ç±»ä¸­å¼•ç”¨å¤–éƒ¨ç±»çš„å®ä¾‹ï¼Œæˆ–è€…ä½¿ç”¨é™æ€å†…éƒ¨ç±»æ¥é¿å…è¯¥é—®é¢˜ã€‚å¦‚æœåŒ¿åå†…éƒ¨ç±»å¼•ç”¨äº†å¤–éƒ¨ç±»å®ä¾‹ï¼Œå¹¶ä¸”å¤–éƒ¨ç±»å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸæ¯”å†…éƒ¨ç±»æ›´é•¿ï¼Œå°±ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚ public class SomeClass { public void doSomething() { final SomeObject obj = new SomeObject(); Runnable runnable = new Runnable() { @Override public void run() { // ä½¿ç”¨objå¯¹è±¡... } }; // ä½¿ç”¨runnableå¯¹è±¡... } } åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼ŒåŒ¿åå†…éƒ¨ç±»å¼•ç”¨äº†å¤–éƒ¨ç±»çš„SomeObjectå®ä¾‹objã€‚å¦‚æœåœ¨run()æ–¹æ³•ä¸­æŒç»­å¼•ç”¨äº†objï¼Œé‚£ä¹ˆå³ä½¿doSomething()æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œobjä»ç„¶æ— æ³•è¢«åƒåœ¾å›æ”¶ã€‚ä¸ºé¿å…è¯¥é—®é¢˜ï¼Œå¯ä»¥å°†SomeObjectå£°æ˜ä¸ºfinalï¼Œæˆ–è€…ä½¿ç”¨é™æ€å†…éƒ¨ç±»ã€‚\n1ã€åœ¨ Java ä¸­ï¼Œå°†SomeObjectå£°æ˜ä¸ºfinalå¯ä»¥å¸®åŠ©é¿å…åŒ¿åå†…éƒ¨ç±»å¼•èµ·çš„å†…å­˜æ³„æ¼é—®é¢˜ã€‚\nå½“å†…éƒ¨ç±»å¼•ç”¨å¤–éƒ¨ç±»çš„å®ä¾‹æ—¶ï¼Œå¦‚æœå¤–éƒ¨ç±»çš„å®ä¾‹ä¸å†éœ€è¦ï¼Œä½†å†…éƒ¨ç±»ä»ç„¶æŒæœ‰å¯¹å¤–éƒ¨ç±»å®ä¾‹çš„å¼•ç”¨ï¼Œå°±å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ã€‚\nå½“å°†SomeObjectå£°æ˜ä¸ºfinalæ—¶ï¼Œç¼–è¯‘å™¨ä¼šç¡®ä¿åœ¨åŒ¿åå†…éƒ¨ç±»ä¸­ä½¿ç”¨çš„å¤–éƒ¨ç±»å®ä¾‹ä¸å¯å˜ã€‚è¿™æ„å‘³ç€åœ¨ç¼–è¯‘æ—¶ï¼Œç¼–è¯‘å™¨ä¼šå°†å¯¹å¤–éƒ¨ç±»å®ä¾‹çš„å¼•ç”¨å¤åˆ¶ç»™å†…éƒ¨ç±»çš„æˆå‘˜å˜é‡ï¼Œå¹¶ä¸”è¯¥å¼•ç”¨åœ¨æ•´ä¸ªå†…éƒ¨ç±»çš„ç”Ÿå‘½å‘¨æœŸä¸­ä¿æŒä¸å˜ã€‚\nç”±äºå¼•ç”¨æ˜¯ä¸å¯å˜çš„ï¼Œå› æ­¤ä¸ä¼šå‡ºç°å¤–éƒ¨ç±»å®ä¾‹è¢«å†…éƒ¨ç±»æŒæœ‰ï¼Œä»è€Œå¯¼è‡´å¤–éƒ¨ç±»å®ä¾‹æ— æ³•è¢«åƒåœ¾å›æ”¶çš„æƒ…å†µã€‚ä¸€æ—¦å¤–éƒ¨ç±»å®ä¾‹ä¸å†è¢«å¼•ç”¨ï¼Œå³ä½¿åŒ¿åå†…éƒ¨ç±»ä»ç„¶å­˜åœ¨ï¼Œå¤–éƒ¨ç±»å®ä¾‹ä¹Ÿå¯ä»¥è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚\né€šè¿‡å°†SomeObjectå£°æ˜ä¸ºfinalï¼Œå¯ä»¥ç¡®ä¿åœ¨åŒ¿åå†…éƒ¨ç±»ä¸­å¯¹å¤–éƒ¨ç±»å®ä¾‹çš„å¼•ç”¨æ˜¯å®‰å…¨çš„ï¼Œä¸ä¼šå¯¼è‡´å†…å­˜æ³„æ¼é—®é¢˜ã€‚è¿™æ˜¯å› ä¸ºç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ä¼šç”Ÿæˆæ­£ç¡®çš„ä»£ç ï¼Œç¡®ä¿å†…éƒ¨ç±»ä¸ä¼šæŒæœ‰å¤–éƒ¨ç±»å®ä¾‹çš„å¼•ç”¨è¶…è¿‡å…¶ç”Ÿå‘½å‘¨æœŸã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶ä½¿ç”¨finalä¿®é¥°å¤–éƒ¨ç±»å¼•ç”¨å¯ä»¥å¸®åŠ©é¿å…å†…å­˜æ³„æ¼é—®é¢˜ï¼Œä½†è¿™å¹¶ä¸æ˜¯è§£å†³æ‰€æœ‰å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼çš„æƒ…å†µçš„é€šç”¨è§£å†³æ–¹æ¡ˆã€‚åœ¨å¤„ç†å›è°ƒæˆ–å†…éƒ¨ç±»æ—¶ï¼Œè¿˜éœ€è¦ä»”ç»†è€ƒè™‘å¯¹è±¡å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶é‡‡å–é€‚å½“çš„æªæ–½æ¥é¿å…æ½œåœ¨çš„å†…å­˜æ³„æ¼ã€‚\n2ã€ä½¿ç”¨é™æ€å†…éƒ¨ç±»å¯ä»¥å¸®åŠ©é¿å…å†…éƒ¨ç±»å¼•èµ·çš„å†…å­˜æ³„æ¼é—®é¢˜ã€‚\né™æ€å†…éƒ¨ç±»ä¸å¤–éƒ¨ç±»ä¹‹é—´çš„å¼•ç”¨æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œè¿™æ„å‘³ç€é™æ€å†…éƒ¨ç±»ä¸ä¼šéšå¼åœ°æŒæœ‰å¯¹å¤–éƒ¨ç±»å®ä¾‹çš„å¼•ç”¨ã€‚\nå½“å†…éƒ¨ç±»æ˜¯é™æ€å†…éƒ¨ç±»æ—¶ï¼Œå®ƒä¸ä¼šéšå¼åœ°æŒæœ‰å¯¹å¤–éƒ¨ç±»å®ä¾‹çš„å¼•ç”¨ã€‚è¿™æ„å‘³ç€å³ä½¿å¤–éƒ¨ç±»å®ä¾‹ä¸å†è¢«å¼•ç”¨ï¼Œé™æ€å†…éƒ¨ç±»ä»ç„¶å¯ä»¥ç‹¬ç«‹å­˜åœ¨ï¼Œè€Œä¸ä¼šé˜»æ­¢å¤–éƒ¨ç±»å®ä¾‹è¢«åƒåœ¾å›æ”¶ã€‚\nç”±äºé™æ€å†…éƒ¨ç±»ä¸æŒæœ‰å¯¹å¤–éƒ¨ç±»å®ä¾‹çš„å¼•ç”¨ï¼Œå› æ­¤åœ¨å¤–éƒ¨ç±»å®ä¾‹ä¸å†éœ€è¦æ—¶ï¼Œå¯ä»¥å®‰å…¨åœ°å°†å…¶è®¾ç½®ä¸º nullï¼Œå¹¶å…è®¸åƒåœ¾å›æ”¶å™¨å›æ”¶å†…å­˜ã€‚\nä»¥ä¸‹æ˜¯ä½¿ç”¨é™æ€å†…éƒ¨ç±»çš„ç¤ºä¾‹ï¼š\npublic class SomeClass { private static class CallbackImpl implements Callback { // å®ç°å›è°ƒæ¥å£çš„æ–¹æ³• } public void doSomething() { Callback callback = new CallbackImpl(); // ä½¿ç”¨callbackå¯¹è±¡... callback = null; // ä¸å†éœ€è¦callbackå¯¹è±¡æ—¶ï¼Œå°†å…¶å¼•ç”¨è®¾ç½®ä¸ºnull } } åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼ŒCallbackImplæ˜¯é™æ€å†…éƒ¨ç±»ï¼Œå®ƒå®ç°äº†Callbackæ¥å£ã€‚åœ¨doSomething()æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†CallbackImplçš„å®ä¾‹ï¼Œå¹¶ä½¿ç”¨å®ƒè¿›è¡Œå›è°ƒæ“ä½œã€‚å½“ä¸å†éœ€è¦callbackå¯¹è±¡æ—¶ï¼Œå°†å…¶å¼•ç”¨è®¾ç½®ä¸º nullï¼Œä»¥å…è®¸åƒåœ¾å›æ”¶å™¨å›æ”¶å†…å­˜ã€‚\nä½¿ç”¨é™æ€å†…éƒ¨ç±»å¯ä»¥æœ‰æ•ˆåœ°é¿å…å†…å­˜æ³„æ¼é—®é¢˜ï¼Œå› ä¸ºå®ƒä»¬ä¸ä¼šæŒæœ‰å¯¹å¤–éƒ¨ç±»å®ä¾‹çš„å¼•ç”¨ï¼Œä»è€Œä½¿å¾—å¤–éƒ¨ç±»å®ä¾‹å¯ä»¥åœ¨ä¸å†éœ€è¦æ—¶è¢«åƒåœ¾å›æ”¶ã€‚è¿™ä½¿å¾—é™æ€å†…éƒ¨ç±»æˆä¸ºä¸€ç§å¸¸è§çš„å¤„ç†å›è°ƒæˆ–å¤æ‚é€»è¾‘çš„æœ‰æ•ˆæ–¹å¼ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/10/13/java-design-patterns-callback/","summary":"æœ¬æ–‡ä¸»è¦ä»‹ç» Callback æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nä»‹ç» å›è°ƒï¼ˆCallbackï¼‰æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸­ï¼Œä¸€ä¸ªå¯æ‰§è¡Œçš„ä»£ç è¢«ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–ä»£ç ï¼Œæ¥æ”¶æ–¹çš„ä»£ç å¯ä»¥åœ¨é€‚å½“çš„æ—¶å€™è°ƒç”¨å®ƒã€‚\nåœ¨çœŸå®ä¸–ç•Œçš„ä¾‹å­ä¸­ï¼Œå½“æˆ‘ä»¬éœ€è¦åœ¨ä»»åŠ¡å®Œæˆæ—¶è¢«é€šçŸ¥æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªå›è°ƒæ–¹æ³•ä¼ é€’ç»™è°ƒç”¨è€…ï¼Œå¹¶ç­‰å¾…å®ƒè°ƒç”¨ä»¥é€šçŸ¥æˆ‘ä»¬ã€‚ç®€å•åœ°è¯´ï¼Œå›è°ƒæ˜¯ä¸€ä¸ªä¼ é€’ç»™è°ƒç”¨è€…çš„æ–¹æ³•ï¼Œåœ¨å®šä¹‰çš„æ—¶åˆ»è¢«è°ƒç”¨ã€‚\nç»´åŸºç™¾ç§‘è¯´\nåœ¨è®¡ç®—æœºç¼–ç¨‹ä¸­ï¼Œå›è°ƒåˆè¢«ç§°ä¸ºâ€œç¨åè°ƒç”¨â€å‡½æ•°ï¼Œå¯ä»¥æ˜¯ä»»ä½•å¯æ‰§è¡Œçš„ä»£ç ç”¨æ¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–ä»£ç ï¼›å…¶å®ƒä»£ç è¢«æœŸæœ›åœ¨ç»™å®šæ—¶é—´å†…è°ƒç”¨å›è°ƒæ–¹æ³•ã€‚\nä»£ç  å›è°ƒæ˜¯ä¸€ä¸ªåªæœ‰ä¸€ä¸ªæ–¹æ³•çš„ç®€å•æ¥å£ã€‚\npublic interface Callback { void call(); } ä¸‹é¢æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªä»»åŠ¡å®ƒå°†åœ¨ä»»åŠ¡æ‰§è¡Œå®Œæˆåæ‰§è¡Œå›è°ƒã€‚\npublic abstract class Task { final void executeWith(Callback callback) { execute(); Optional.ofNullable(callback).ifPresent(Callback::call); } public abstract void execute(); } public final class SimpleTask extends Task { private static final Logger LOGGER = getLogger(SimpleTask.class); @Override public void execute() { LOGGER.info(\u0026#34;Perform some important activity and after call the callback method.\u0026#34;); } } æœ€åè¿™é‡Œæ˜¯æˆ‘ä»¬å¦‚ä½•æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ç„¶åæ¥æ”¶ä¸€ä¸ªå›è°ƒå½“å®ƒå®Œæˆæ—¶ã€‚\nvar task = new SimpleTask(); task.executeWith(() -\u0026gt; LOGGER.info(\u0026#34;I\u0026#39;m done now.\u0026#34;)); ç±»å›¾ é€‚ç”¨åœºæ™¯ å›è°ƒæ¨¡å¼é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š\nå¼‚æ­¥æ“ä½œï¼šå½“éœ€è¦åœ¨å¼‚æ­¥æ“ä½œå®Œæˆåæ‰§è¡ŒæŸäº›æ“ä½œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨å›è°ƒæ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œåœ¨ç½‘ç»œè¯·æ±‚ä¸­ï¼Œå¯ä»¥ä¼ é€’ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œåœ¨è¯·æ±‚å®Œæˆåè°ƒç”¨è¯¥å‡½æ•°å¤„ç†å“åº”æ•°æ®ã€‚ äº‹ä»¶å¤„ç†ï¼šå½“éœ€è¦å¯¹äº‹ä»¶è¿›è¡Œå“åº”å’Œå¤„ç†æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å›è°ƒæ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œåœ¨å›¾å½¢ç•Œé¢å¼€å‘ä¸­ï¼Œå¯ä»¥æ³¨å†ŒæŸä¸ªæ§ä»¶çš„å›è°ƒå‡½æ•°ï¼Œä»¥ä¾¿åœ¨ç”¨æˆ·è§¦å‘äº‹ä»¶æ—¶æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚ æ’ä»¶æ‰©å±•ï¼šå½“éœ€è¦ä¸ºåº”ç”¨ç¨‹åºæä¾›æ‰©å±•æ€§ï¼Œå…è®¸ç¬¬ä¸‰æ–¹æ’ä»¶åœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶è¿›è¡Œè‡ªå®šä¹‰æ“ä½œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨å›è°ƒæ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œæ¸¸æˆå¼•æ“ä¸­çš„äº‹ä»¶ç³»ç»Ÿå…è®¸å¼€å‘è€…æ³¨å†Œå›è°ƒå‡½æ•°ä»¥å“åº”æ¸¸æˆä¸­çš„ç‰¹å®šäº‹ä»¶ã€‚ å›è°ƒé“¾ï¼šå½“éœ€è¦æŒ‰ç‰¹å®šé¡ºåºæ‰§è¡Œå¤šä¸ªå›è°ƒå‡½æ•°ï¼Œå¹¶å°†å‰ä¸€ä¸ªå›è°ƒå‡½æ•°çš„ç»“æœä¼ é€’ç»™ä¸‹ä¸€ä¸ªå›è°ƒå‡½æ•°æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å›è°ƒæ¨¡å¼ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå›è°ƒå‡½æ•°å½¢æˆäº†ä¸€ä¸ªå›è°ƒé“¾ã€‚ æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼šå›è°ƒæ¨¡å¼å¸¸ä¸æ¨¡æ¿æ–¹æ³•æ¨¡å¼ç»“åˆä½¿ç”¨ã€‚æ¨¡æ¿æ–¹æ³•æ¨¡å¼å®šä¹‰äº†ä¸€ä¸ªç®—æ³•çš„éª¨æ¶ï¼Œè€Œå…·ä½“çš„æ­¥éª¤ç”±å­ç±»å®ç°ã€‚å¯ä»¥ä½¿ç”¨å›è°ƒæ¨¡å¼å°†å­ç±»ä¸­çš„å…·ä½“æ­¥éª¤ä½œä¸ºå›è°ƒå‡½æ•°ä¼ é€’ç»™æ¨¡æ¿æ–¹æ³•ã€‚ æ€»çš„æ¥è¯´ï¼Œå›è°ƒæ¨¡å¼é€‚ç”¨äºéœ€è¦åœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿåæ‰§è¡ŒæŸäº›æ“ä½œçš„æƒ…å†µï¼Œä»¥åŠéœ€è¦å®ç°è§£è€¦å’Œçµæ´»æ€§çš„åœºæ™¯ã€‚å®ƒæä¾›äº†ä¸€ç§åœ¨ä»£ç é—´é€šä¿¡çš„æ–¹å¼ï¼Œä½¿å¾—ä»£ç å¯ä»¥æ›´åŠ æ¨¡å—åŒ–å’Œå¯å¤ç”¨ã€‚\nJava ä¾‹å­ CyclicBarrier æ„é€ å‡½æ•°å¯ä»¥æ¥å—å›è°ƒï¼Œè¯¥å›è°ƒå°†åœ¨æ¯æ¬¡éšœç¢è¢«è§¦å‘æ—¶è§¦å‘ã€‚ FAQ å›è°ƒæ¨¡å¼å¦‚ä½•å®ç°è§£è€¦å’Œçµæ´»æ€§ï¼Ÿ å›è°ƒæ¨¡å¼é€šè¿‡å°†ä¸€ä¸ªå¯æ‰§è¡Œçš„ä»£ç å—ï¼ˆå›è°ƒå‡½æ•°ï¼‰ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–ä»£ç ï¼Œå®ç°äº†è§£è€¦å’Œçµæ´»æ€§ã€‚\nè§£è€¦æ€§ï¼šå›è°ƒæ¨¡å¼å¯ä»¥å°†è°ƒç”¨æ–¹ä¸è¢«è°ƒç”¨æ–¹è§£è€¦ï¼Œä½¿å®ƒä»¬ä¹‹é—´çš„å…³ç³»æ›´åŠ æ¾æ•£ã€‚è°ƒç”¨æ–¹åªéœ€è¦çŸ¥é“å›è°ƒå‡½æ•°çš„æ¥å£ï¼Œè€Œä¸éœ€è¦äº†è§£å…·ä½“çš„å®ç°ç»†èŠ‚ã€‚è¢«è°ƒç”¨æ–¹åœ¨ç‰¹å®šçš„æ—¶æœºè°ƒç”¨å›è°ƒå‡½æ•°ï¼Œè€Œä¸éœ€è¦çŸ¥é“è°ƒç”¨æ–¹çš„å…·ä½“å®ç°ã€‚è¿™ç§è§£è€¦æ€§ä½¿å¾—ç³»ç»Ÿä¸­çš„ä¸åŒéƒ¨åˆ†å¯ä»¥ç‹¬ç«‹åœ°è¿›è¡Œä¿®æ”¹å’Œæ‰©å±•ï¼Œè€Œä¸ä¼šå¯¹å½¼æ­¤äº§ç”Ÿè¿‡å¤šçš„ä¾èµ–ã€‚\nçµæ´»æ€§ï¼šå›è°ƒæ¨¡å¼æä¾›äº†ä¸€ç§çµæ´»çš„æ‰©å±•æœºåˆ¶ã€‚é€šè¿‡ä¼ é€’ä¸åŒçš„å›è°ƒå‡½æ•°ï¼Œå¯ä»¥æ”¹å˜ç¨‹åºçš„è¡Œä¸ºæˆ–é€»è¾‘ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹åŸæœ‰çš„ä»£ç ã€‚è¿™ç§çµæ´»æ€§ä½¿å¾—ç³»ç»Ÿå¯ä»¥é€‚åº”ä¸åŒçš„éœ€æ±‚å’Œå˜åŒ–ï¼Œè€Œä¸éœ€è¦è¿›è¡Œå¤§è§„æ¨¡çš„ä¿®æ”¹æˆ–é‡æ„ã€‚åŒæ—¶ï¼Œå›è°ƒæ¨¡å¼ä¹Ÿå…è®¸åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°ä¿®æ”¹å›è°ƒå‡½æ•°ï¼Œä»è€Œå®ç°æ›´é«˜çº§çš„åŠ¨æ€è¡Œä¸ºã€‚","title":"Javaè®¾è®¡æ¨¡å¼ï¼šCallback"},{"content":"Spring Boot 3.0 äº 2022 å¹´ 11 æœˆæ­£å¼å‘å¸ƒï¼ŒåŒ…å«ä¸€äº›æ–°åŠŸèƒ½å’Œæ”¹è¿›ã€‚è¿™æ˜¯ç»§å¤§çº¦ 4.5 å¹´å‰å‘å¸ƒ Spring Boot 2.0 å Spring Boot çš„ç¬¬ä¸€ä¸ªä¸»è¦ç‰ˆæœ¬ã€‚å®ƒä¹Ÿæ˜¯ç¬¬ä¸€ä¸ªæ”¯æŒ Spring Framework 6.0 çš„ Spring Boot GA ç‰ˆæœ¬ã€‚ä½œä¸ºå¼€å‘äººå‘˜ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£è¿™äº›æ›´æ–°ï¼Œæ‰èƒ½é¡ºåˆ©ä½¿ç”¨ Spring Bootã€‚æ¯«æ— ç–‘é—®ï¼Œæ–°ç‰ˆæœ¬ä¸­æœ€å¤§çš„è½¬å˜ä¹‹ä¸€æ˜¯æ”¾å¼ƒäº†å¯¹æ—§ç‰ˆæœ¬ Java çš„æ”¯æŒã€‚\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºâ€œSpring Boot 3 å’Œ Spring 6 ä¸­çš„æ–°åŠŸèƒ½â€ã€‚\nSpring 3.0 ç‰ˆæœ¬æœ‰å“ªäº›ä¸»è¦äº®ç‚¹ï¼Ÿ Spring 3.0 ç‰ˆæœ¬çš„äº®ç‚¹åŒ…æ‹¬ï¼š\nJava 17 åŸºçº¿ æ”¯æŒ Jakarta EE 10 å’Œ EE 9 åŸºçº¿ æ”¯æŒä½¿ç”¨ GraalVM ç”Ÿæˆæœ¬æœºæ˜ åƒï¼Œå–ä»£å®éªŒæ€§ Spring Native é¡¹ç›® é€šè¿‡æµ‹å¾®è®¡å’Œæµ‹å¾®è®¡è¿½è¸ªæé«˜äº†å¯è§‚æµ‹æ€§ è°å¯ä»¥çœŸæ­£ä½¿ç”¨ Spring Boot 3ï¼Ÿ å¦‚å‰æ‰€è¿°ï¼ŒSpring Boot 3.0 æœ€å¤§çš„è½¬å˜æ˜¯å¿½ç•¥äº†å¯¹æ—§ç‰ˆæœ¬ Java çš„æ”¯æŒã€‚æ˜¯çš„ï¼Œæˆ‘ä»¬è‡³å°‘éœ€è¦ Java 17 æ‰èƒ½ä½¿ç”¨ Spring Boot 3.0ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨ Spring Boot 3.0 ä¹‹å‰å¿…é¡»å…·å¤‡ JDK 17 ç¯å¢ƒã€‚\nSpring Boot 3 å’Œ Spring 6 æœ‰å“ªäº›æ–°åŠŸèƒ½ï¼Ÿ è¿™é‡Œéœ€è¦æ³¨æ„çš„é‡è¦ä¸€ç‚¹æ˜¯ Spring Boot 3.0 æ„å»ºäº Spring Framework 6 ä¹‹ä¸Šå¹¶éœ€è¦ Spring Framework 6ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨çš„ pom.xml æŒ‡å‘ Spring Boot ç‰ˆæœ¬ 3.0.0ï¼Œå®ƒå°†è‡ªåŠ¨ä¸‹è½½ Spring Framework 6 æ‰€éœ€çš„ä¾èµ–é¡¹ã€‚å› æ­¤ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‚¨åœ¨ä½¿ç”¨ Spring Boot 3.0 æ—¶å°†ä½¿ç”¨ Spring Framework 6ã€‚è¯·è®¿é—®å•ç‹¬çš„æ–‡ç« äº†è§£ Spring Framework 6.0 ä¸­çš„æ–°åŠŸèƒ½ã€‚è¿™é‡Œåªè®¨è®º Spring Boot 3 ä¸­çš„æ–°åŠŸèƒ½ã€‚\nJava 17 åŸºçº¿å’Œ Java 19 æ”¯æŒ æˆ‘ä»¬éœ€è¦ Java 17 ä½œä¸ºæœ€ä½ç‰ˆæœ¬æ‰èƒ½ä¸ Spring 3.0 é…åˆä½¿ç”¨ã€‚å¦‚æœæ‚¨å½“å‰ä½¿ç”¨çš„æ˜¯ Java 8ã€Java 11 æˆ– Java 14 ç­‰è¾ƒä½ç‰ˆæœ¬ï¼Œåˆ™éœ€è¦å…ˆå°† JDK å‡çº§åˆ° JDK 17ï¼Œç„¶åå†å¼€å§‹ä½¿ç”¨ Spring Boot 3.0 å¼€å‘åº”ç”¨ç¨‹åºã€‚ç›®å‰ Java çš„æœ€æ–°ç‰ˆæœ¬æ˜¯ JDK 19ã€‚ä¸è¿‡ï¼ŒSpring Boot 3.0 ä¹Ÿè¿è¡Œè‰¯å¥½ï¼Œå¹¶ä¸”å·²ç»åœ¨ JDK 19 ä¸Šè¿›è¡Œäº†æµ‹è¯•ã€‚\næ‚¨è¿˜å¯ä»¥é˜…è¯»ï¼šJava 17 ç‰¹æ€§ã€‚\nç¬¬ä¸‰æ–¹åº“å‡çº§ ç”±äº Java EE å·²æ›´æ”¹ä¸º Jakarta EEï¼ŒSpring Boot 3.0 ä¹Ÿå°†æ‰€æœ‰ä¾èµ–é¡¹çš„ API ä» Java EE è¿ç§»åˆ° Jakarta EE APIã€‚å› æ­¤ï¼Œä»¥â€œjavaxâ€å¼€å¤´çš„åŒ…åç§°éœ€è¦ç›¸åº”åœ°æ›´æ”¹ä¸ºâ€œjakartaâ€ã€‚ ä¾‹å¦‚ï¼Œä¸€äº›å¸¸ç”¨çš„åŒ…å°†è¢«æ›´æ”¹å¦‚ä¸‹ï¼š\njavax.persistence.* -\u0026gt; jakarta.persistence.* javax.validation.* -\u0026gt; jakarta.validation.* javax.servlet.* -\u0026gt; jakarta.servlet.* javax.annotation.* -\u0026gt; jakarta.annotation.* javax.transaction.* -\u0026gt; jakarta.transaction.* æ³¨æ„ï¼šè¯·æ³¨æ„ï¼Œjavax.sql._ å’Œ javax.crypto._ ç­‰åŒ…ä¸ä¼šæ›´æ”¹ä¸ºâ€œjakarta.*â€ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ Java 17 JDK çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯ Java EE çš„ä¸€éƒ¨åˆ†ã€‚åªæœ‰å±äº Java EE çš„é‚£äº›åŒ…æ‰ä¼šæ›´æ”¹ä¸º Jakarta EEã€‚\nåªè¦æœ‰å¯èƒ½ï¼Œæˆ‘ä»¬éƒ½ä¼šé€‰æ‹© Jakarta EE 10 å…¼å®¹çš„ä¾èµ–é¡¹ï¼ŒåŒ…æ‹¬ï¼š\nJakarta Activation 2.1 Jakarta JMS 3.1 Jakarta JSON 2.1 Jakarta JSON Bind 3.0 Jakarta Mail 2.1 Jakarta Persistence 3.1 Jakarta Servlet 6.0 Jakarta Servlet JSP JSTL 3.0 Jakarta Transaction 2.0 Jakarta Validation 3.0 Jakarta WebSocket 2.1 Jakarta WS RS 3.1 Jakarta XML SOAP 3.0 Jakarta XML WS 4.0 éšç€ Spring æ¡†æ¶å‡çº§åˆ°ç‰ˆæœ¬ 6ï¼Œå…¶ä»– Spring é¡¹ç›®ä¹Ÿåœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­å‡çº§ï¼Œå®ƒä»¬æ˜¯ï¼š Spring AMQP 3.0. Spring Batch 5.0. Spring Data 2022.0. Spring GraphQL 1.1. Spring HATEOAS 2.0. Spring Integration 6.0. Spring Kafka 3.0. Spring LDAP 3.0. Spring REST Docs 3.0. Spring Retry 2.0. Spring Security 6.0 (see also whatâ€™s new). Spring Session 3.0 Spring WS 4.0. ç¬¬ä¸‰æ–¹ jar çš„æœ€æ–°ç¨³å®šç‰ˆæœ¬ä¹Ÿä¼šå°½å¯èƒ½å‡çº§ã€‚ä¸€äº›å¸¸ç”¨çš„ä¾èµ–é¡¹å‡çº§åŒ…æ‹¬ï¼š Couchbase Client 3.4 Ehcache 3.10 Elasticsearch Client 8.5 Flyway 9 Groovy 4.0 Hibernate 6.1 Hibernate Validator 8.0 Jackson 2.14 Jersey 3.1 Jetty 11 jOOQ 3.16 Kotlin 1.7.20 Liquibase 4.13 Lettuce 6.2 Log4j 2.18 Logback 1.4 Micrometer 1.10 Micrometer Tracing 1.0 Neo4j Java Driver 5.2 Netty 4.1.77.Final OkHttp 4.10 R2DBC 1.0 Reactor 2022.0 SLF4J 2.0 SnakeYAML 1.32 Tomcat 10 Thymeleaf 3.1.0.M2 Undertow 2.2.20.Final GraalVM æœ¬æœºæ˜ åƒæ”¯æŒ GraalVM Native Images æä¾›äº†ä¸€ç§éƒ¨ç½²å’Œè¿è¡Œ Java åº”ç”¨ç¨‹åºçš„æ–°æ–¹æ³•ã€‚ä¸ Java è™šæ‹Ÿæœºç›¸æ¯”ï¼Œæœ¬æœºæ˜ åƒå¯ä»¥ä»¥æ›´å°çš„å†…å­˜å ç”¨å’Œæ›´å¿«çš„å¯åŠ¨æ—¶é—´è¿è¡Œã€‚\nGraalVM æ˜¯ä¸€ç§é«˜æ€§èƒ½ JDKï¼Œæ—¨åœ¨åŠ å¿«ç”¨ Java å’Œå…¶ä»– JVM è¯­è¨€ç¼–å†™çš„åº”ç”¨ç¨‹åºçš„æ‰§è¡Œé€Ÿåº¦ï¼ŒåŒæ—¶è¿˜ä¸º JavaScriptã€Python å’Œè®¸å¤šå…¶ä»–æµè¡Œè¯­è¨€æä¾›è¿è¡Œæ—¶ã€‚ GraalVM æä¾›äº†ä¸¤ç§è¿è¡Œ Java åº”ç”¨ç¨‹åºçš„æ–¹æ³•ï¼šåœ¨å¸¦æœ‰ Graal å³æ—¶ (JIT) ç¼–è¯‘å™¨çš„ HotSpot JVM ä¸Šæˆ–ä½œä¸ºæå‰ (AOT) ç¼–è¯‘çš„æœ¬æœºå¯æ‰§è¡Œæ–‡ä»¶ã€‚\nGraalVM æœ¬æœºæ˜ åƒæ˜¯ç‹¬ç«‹çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡æå‰å¤„ç†å·²ç¼–è¯‘çš„ Java åº”ç”¨ç¨‹åºæ¥ç”Ÿæˆã€‚åŸç”Ÿæ˜ åƒé€šå¸¸æ¯” JVM æ˜ åƒå…·æœ‰æ›´å°çš„å†…å­˜å ç”¨å¹¶ä¸”å¯åŠ¨é€Ÿåº¦æ›´å¿«ã€‚å®ƒä»¬éå¸¸é€‚åˆä½¿ç”¨å®¹å™¨æ˜ åƒéƒ¨ç½²çš„åº”ç”¨ç¨‹åºã€‚ GraalVM Native Image æ˜¯ä¸€ä¸ªå®Œæ•´çš„ã€ç‰¹å®šäºå¹³å°çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚æˆ‘ä»¬ä¸éœ€è¦æä¾› Java è™šæ‹Ÿæœºæ¥è¿è¡Œæœ¬æœºæ˜ åƒã€‚\nå¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šä¿¡æ¯å¹¶å°è¯•ä½¿ç”¨ GraalVMï¼Œæ‚¨å¯ä»¥ç»§ç»­é˜…è¯»æœ‰å…³â€œGraalVM Native Image Supportâ€çš„å®˜æ–¹æ–‡æ¡£ã€‚\né€šè¿‡æµ‹å¾®è®¡å’Œæµ‹å¾®è®¡è¿½è¸ªæé«˜å¯è§‚æµ‹æ€§ å¯è§‚å¯Ÿæ€§æ˜¯ä»å¤–éƒ¨è§‚å¯Ÿæ­£åœ¨è¿è¡Œçš„ç³»ç»Ÿçš„å†…éƒ¨çŠ¶æ€çš„èƒ½åŠ›ã€‚æ¢å¥è¯è¯´ï¼Œâ€œé€šè¿‡æ£€æŸ¥ç³»ç»Ÿçš„è¾“å‡ºï¼Œæ‚¨å¯ä»¥åœ¨å¤šå¤§ç¨‹åº¦ä¸Šäº†è§£ç³»ç»Ÿçš„å†…éƒ¨ç»“æ„â€ã€‚å®ƒç”±æ—¥å¿—è®°å½•ã€æŒ‡æ ‡å’Œè·Ÿè¸ªä¸‰å¤§æ”¯æŸ±ç»„æˆã€‚å¯¹äºæŒ‡æ ‡å’Œè·Ÿè¸ªï¼ŒSpring Boot ä½¿ç”¨ Micrometer Observationã€‚è¦åˆ›å»ºæ‚¨è‡ªå·±çš„è§‚å¯Ÿï¼ˆè¿™å°†äº§ç”ŸæŒ‡æ ‡å’Œè·Ÿè¸ªï¼‰ï¼Œæ‚¨å¯ä»¥æ³¨å…¥ ObservationRegistryã€‚\nSpring Boot 3.0 æ”¯æŒ Micrometer 1.10 ä¸­å¼•å…¥çš„æ–°è§‚å¯Ÿ APIã€‚æ–°çš„ ObservationRegistry ç•Œé¢å¯ç”¨äºåˆ›å»ºè§‚å¯Ÿç»“æœï¼Œä¸ºæŒ‡æ ‡å’Œè·Ÿè¸ªæä¾›å•ä¸€ APIã€‚ Spring Boot ç°åœ¨ä¼šè‡ªåŠ¨ä¸ºæ‚¨é…ç½® ObservationRegistry å®ä¾‹ã€‚ä¸‹é¢çš„ä»£ç ç‰‡æ®µæ¼”ç¤ºäº† ObervationRegistry çš„æ¦‚å¿µã€‚ @Component public class MyCustomObservation { private final ObservationRegistry observationRegistry; public MyCustomObservation(ObservationRegistry observationRegistry) { this.observationRegistry = observationRegistry; } public void doSomething() { Observation.createNotStarted(\u0026#34;doSomething\u0026#34;, this.observationRegistry) .lowCardinalityKeyValue(\u0026#34;locale\u0026#34;, \u0026#34;en-US\u0026#34;) .highCardinalityKeyValue(\u0026#34;userId\u0026#34;, \u0026#34;42\u0026#34;) .observe(() -\u0026gt; { // Execute business logic here }); } } Spring Boot ç°åœ¨ä¼šè‡ªåŠ¨ä¸ºæ‚¨é…ç½® Micrometer Tracingã€‚è¿™åŒ…æ‹¬å¯¹ Braveã€OpenTelemetryã€Zipkin å’Œ Wavefront çš„æ”¯æŒã€‚ Spring Cloud Sleuth åœ¨æ–°ç‰ˆæœ¬ä¸­è¢« Micrometer Tracing Framework å–ä»£ã€‚ ä½¿ç”¨ Spring Boot 3.0 çš„ Spring Security UserDetailsService ç¤ºä¾‹ æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€ç¯‡å•ç‹¬çš„æ–‡ç« ä½œä¸º Spring Security UserDetailsSâ€‹â€‹ervice ä½¿ç”¨ Spring Boot 3 çš„ç¤ºä¾‹ï¼Œè¯¥æ–‡ç« å®Œå…¨ä½¿ç”¨ Spring Boot 3.0 å¹¶éµå¾ª Spring å®˜æ–¹æ–‡æ¡£æä¾›çš„åˆ†æ­¥æŒ‡å—è¿›è¡Œå¼€å‘ã€‚æ­¤å¤–ï¼Œæ‚¨å¯ä»¥é˜…è¯»ã€ŠSpring Boot 3.0 è¿ç§»æŒ‡å—ã€‹æ¥å½»åº•äº†è§£è¿ç§»è¿‡ç¨‹ã€‚\nè¿™æ˜¯ç›®å‰çš„åŠŸèƒ½åˆ—è¡¨ã€‚æ˜¾ç„¶ï¼Œè¿˜æœ‰æ›´å¤šã€‚æˆ‘ä»¬å°†ä¸æ—¶æ›´æ–°æ–‡ç« ã€‚\næœ‰å…³ Spring Boot çš„å…¶ä»–æ•™ç¨‹ï¼Œæ‚¨å¯ä»¥è®¿é—® Spring Boot æ•™ç¨‹é¡µé¢ã€‚\nSpring Boot 3 å’Œ Spring 6 ç‰ˆæœ¬å¦‚ä½•äº’è¿ï¼Ÿ å¦‚ä¸Šæ‰€è¿°ï¼ŒSpring Boot 3.0 æ„å»ºåœ¨ Spring Framework 6.0 ä¹‹ä¸Šã€‚ä¸¤è€…çš„å‘å¸ƒä¹‹é—´æœ‰ä¸€å‘¨çš„é—´éš”ã€‚ Spring Framework 6.0.0 æ¯” Spring Boot 3.0 å‘å¸ƒæ—©ä¸€å‘¨å‘å¸ƒã€‚æ¢å¥è¯è¯´ï¼ŒSpring Framework 6.0.0 æ˜¯ Spring Boot 3.0 çš„åŸºç¡€ã€‚æ­¤å¤–ï¼Œå¦‚æœæ‚¨çš„ pom.xml æŒ‡å‘ Spring Boot ç‰ˆæœ¬ 3.0.0ï¼Œå®ƒå°†è‡ªåŠ¨ä¸‹è½½ Spring Framework 6 æ‰€éœ€çš„ä¾èµ–é¡¹ã€‚å› æ­¤ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‚¨åœ¨ä½¿ç”¨ Spring Boot 3.0 æ—¶å°†ä½¿ç”¨ Spring Framework 6ã€‚\nè™½ç„¶æå‰ï¼ˆAOTï¼‰å’Œ GraalVM æ˜¯ Spring Framework 6.0 çš„æ–°åŠŸèƒ½ï¼Œä½†å¦‚æœæ²¡æœ‰å®Œæ•´çš„ Spring Boot å †æ ˆï¼Œå®ƒä»¬å°±æ²¡æœ‰ç”¨ã€‚å®ƒä»¬åœ¨åŸºäº Spring çš„ç‹¬ç«‹åº”ç”¨ç¨‹åºä¸­è¿˜ä¸å¤Ÿå¥½ã€‚\nä¸‹ä¸€ä¸ªç‰ˆæœ¬ Spring Framework 6.1 GA å°†äºæ˜å¹´å³ 2023 å¹´ 11 æœˆå‘å¸ƒã€‚å¦ä¸€æ–¹é¢ï¼Œåˆ° 2023 å¹´ 11 æœˆï¼ŒSpring Boot å°†æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œå³ Spring Boot 3.0 å’Œ 3.1ã€‚è¿™æ„å‘³ç€ Spring Framework å°†æœ‰æ¯å¹´å‘å¸ƒä¸€ä¸ªç‰ˆæœ¬ï¼Œè€Œ Spring boot æ¯å¹´å‘å¸ƒä¸¤ä¸ªç‰ˆæœ¬ï¼Œå¹¶æ”¯æŒæœ€æ–°çš„ JDK ç‰ˆæœ¬ã€‚æŒ‰ç…§ JDK çš„å¸¸è§„å‘å¸ƒï¼ŒJDK 21(LTS) å°†äº 2023 å¹´ 9 æœˆå‘å¸ƒï¼Œå³ Spring Framework 6.1 GA å‘å¸ƒä¹‹å‰ã€‚\nFAQ Spring Boot 3 å¯ä»¥ä¸ Java 11 ä¸€èµ·ä½¿ç”¨å—ï¼Ÿ ä¸€ç‚¹ä¹Ÿä¸ã€‚ Spring Boot 3.0.0 éœ€è¦ JDK 17 ä½œä¸ºæœ€ä½ç‰ˆæœ¬æ‰èƒ½ä½¿ç”¨ã€‚ Spring Boot 3.0 å‘å¸ƒæ–‡æ¡£ä¸­æ˜ç¡®æåˆ°äº†è¿™ä¸€ç‚¹ã€‚å¦‚æœæ‚¨æƒ³ä½¿ç”¨ä½äº Java 17 çš„ Java ç‰ˆæœ¬ï¼Œåˆ™å¿…é¡»ä½¿ç”¨ Spring Boot 2.0ã€‚\nSpring Boot 3 æ”¯æŒ Java 8 å—ï¼Ÿ æ ¹æœ¬ä¸éœ€è¦ã€‚ä¸ºäº†ä½¿ç”¨ Spring Boot 3ï¼Œæ‚¨çš„ç³»ç»Ÿä¸­å¿…é¡»è‡³å°‘å®‰è£… Java 17ã€‚ä¸ä»…å®‰è£…äº†ï¼Œæ‚¨çš„ä»£ç è¿˜å¿…é¡»ä½¿ç”¨ JDK 17 è¿›è¡Œç¼–è¯‘ã€‚ä½¿ç”¨ JDK 17 æˆ–æ›´é«˜ç‰ˆæœ¬ç¼–è¯‘çš„ä»£ç å°†ä»…è¢« Spring Boot 3 æ¥å—ã€‚\nåŸæ–‡é“¾æ¥ï¼šhttps://javatechonline.com/new-features-in-spring-boot-3-and-spring-6/\n","permalink":"https://blog.chensoul.cc/posts/2023/10/13/new-features-in-spring-boot-3-and-spring-6/","summary":"Spring Boot 3.0 äº 2022 å¹´ 11 æœˆæ­£å¼å‘å¸ƒï¼ŒåŒ…å«ä¸€äº›æ–°åŠŸèƒ½å’Œæ”¹è¿›ã€‚è¿™æ˜¯ç»§å¤§çº¦ 4.5 å¹´å‰å‘å¸ƒ Spring Boot 2.0 å Spring Boot çš„ç¬¬ä¸€ä¸ªä¸»è¦ç‰ˆæœ¬ã€‚å®ƒä¹Ÿæ˜¯ç¬¬ä¸€ä¸ªæ”¯æŒ Spring Framework 6.0 çš„ Spring Boot GA ç‰ˆæœ¬ã€‚ä½œä¸ºå¼€å‘äººå‘˜ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£è¿™äº›æ›´æ–°ï¼Œæ‰èƒ½é¡ºåˆ©ä½¿ç”¨ Spring Bootã€‚æ¯«æ— ç–‘é—®ï¼Œæ–°ç‰ˆæœ¬ä¸­æœ€å¤§çš„è½¬å˜ä¹‹ä¸€æ˜¯æ”¾å¼ƒäº†å¯¹æ—§ç‰ˆæœ¬ Java çš„æ”¯æŒã€‚\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºâ€œSpring Boot 3 å’Œ Spring 6 ä¸­çš„æ–°åŠŸèƒ½â€ã€‚\nSpring 3.0 ç‰ˆæœ¬æœ‰å“ªäº›ä¸»è¦äº®ç‚¹ï¼Ÿ Spring 3.0 ç‰ˆæœ¬çš„äº®ç‚¹åŒ…æ‹¬ï¼š\nJava 17 åŸºçº¿ æ”¯æŒ Jakarta EE 10 å’Œ EE 9 åŸºçº¿ æ”¯æŒä½¿ç”¨ GraalVM ç”Ÿæˆæœ¬æœºæ˜ åƒï¼Œå–ä»£å®éªŒæ€§ Spring Native é¡¹ç›® é€šè¿‡æµ‹å¾®è®¡å’Œæµ‹å¾®è®¡è¿½è¸ªæé«˜äº†å¯è§‚æµ‹æ€§ è°å¯ä»¥çœŸæ­£ä½¿ç”¨ Spring Boot 3ï¼Ÿ å¦‚å‰æ‰€è¿°ï¼ŒSpring Boot 3.0 æœ€å¤§çš„è½¬å˜æ˜¯å¿½ç•¥äº†å¯¹æ—§ç‰ˆæœ¬ Java çš„æ”¯æŒã€‚æ˜¯çš„ï¼Œæˆ‘ä»¬è‡³å°‘éœ€è¦ Java 17 æ‰èƒ½ä½¿ç”¨ Spring Boot 3.0ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨ Spring Boot 3.0 ä¹‹å‰å¿…é¡»å…·å¤‡ JDK 17 ç¯å¢ƒã€‚\nSpring Boot 3 å’Œ Spring 6 æœ‰å“ªäº›æ–°åŠŸèƒ½ï¼Ÿ è¿™é‡Œéœ€è¦æ³¨æ„çš„é‡è¦ä¸€ç‚¹æ˜¯ Spring Boot 3.0 æ„å»ºäº Spring Framework 6 ä¹‹ä¸Šå¹¶éœ€è¦ Spring Framework 6ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨çš„ pom.","title":"[è¯‘]Spring Boot3å’ŒSpring6ä¸­çš„æ–°ç‰¹æ€§"},{"content":"HTTP æ˜¯æ¯ä¸ª Web å¼€å‘äººå‘˜éƒ½åº”è¯¥äº†è§£çš„åè®®ï¼Œå› ä¸ºå®ƒä¸ºæ•´ä¸ª Web æä¾›åŠ¨åŠ›ã€‚äº†è§£ HTTP å½“ç„¶å¯ä»¥å¸®åŠ©æ‚¨å¼€å‘æ›´å¥½çš„åº”ç”¨ç¨‹åºã€‚\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†è®¨è®º HTTP æ˜¯ä»€ä¹ˆã€å®ƒæ˜¯å¦‚ä½•äº§ç”Ÿçš„ã€å®ƒä»Šå¤©çš„çŠ¶å†µä»¥åŠæˆ‘ä»¬æ˜¯å¦‚ä½•èµ°åˆ°è¿™ä¸€æ­¥çš„\nä»€ä¹ˆæ˜¯ HTTPï¼Ÿ é¦–å…ˆï¼Œä»€ä¹ˆæ˜¯ HTTPï¼Ÿ HTTP æ˜¯åŸºäº TCP/IP çš„åº”ç”¨å±‚é€šä¿¡åè®®ï¼Œå®ƒæ ‡å‡†åŒ–äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ–¹å¼ã€‚å®ƒå®šä¹‰äº†å¦‚ä½•é€šè¿‡äº’è”ç½‘è¯·æ±‚å’Œä¼ è¾“å†…å®¹ã€‚é€šè¿‡åº”ç”¨å±‚åè®®ï¼Œæˆ‘çš„æ„æ€æ˜¯å®ƒåªæ˜¯ä¸€ä¸ªæ ‡å‡†åŒ–ä¸»æœºï¼ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼‰é€šä¿¡æ–¹å¼çš„æŠ½è±¡å±‚ã€‚ HTTP æœ¬èº«ä¾èµ–äº TCP/IP æ¥è·å–å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„è¯·æ±‚å’Œå“åº”ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨ TCP ç«¯å£ 80ï¼Œä½†ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–ç«¯å£ã€‚ç„¶è€Œï¼ŒHTTPS ä½¿ç”¨ç«¯å£ 443ã€‚\nHTTP/0.9 - One Liner (1991) HTTP çš„ç¬¬ä¸€ä¸ªæœ‰è®°å½•çš„ç‰ˆæœ¬æ˜¯ 1991 å¹´æå‡ºçš„ HTTP/0.9ã€‚å®ƒæ˜¯æœ‰å²ä»¥æ¥æœ€ç®€å•çš„åè®®ï¼›æœ‰ä¸€ä¸ªåä¸º GET çš„æ–¹æ³•ã€‚å¦‚æœå®¢æˆ·ç«¯å¿…é¡»è®¿é—®æœåŠ¡å™¨ä¸Šçš„æŸä¸ªç½‘é¡µï¼Œå®ƒä¼šå‘å‡ºå¦‚ä¸‹æ‰€ç¤ºçš„ç®€å•è¯·æ±‚\nGET /index.html æœåŠ¡å™¨çš„å“åº”å¦‚ä¸‹æ‰€ç¤º\n(response body) (connection closed) ä¹Ÿå°±æ˜¯è¯´ï¼ŒæœåŠ¡å™¨å°†æ”¶åˆ°è¯·æ±‚ï¼Œå›å¤ HTML ä½œä¸ºå“åº”ï¼Œä¸€æ—¦å†…å®¹ä¼ è¾“å®Œæ¯•ï¼Œè¿æ¥å°±ä¼šå…³é—­ã€‚æœ‰\næ— æ ‡é¢˜ GET æ˜¯å”¯ä¸€å…è®¸çš„æ–¹æ³• å“åº”å¿…é¡»æ˜¯ HTML æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œè¯¥åè®®å®é™…ä¸Šåªä¸è¿‡æ˜¯æœªæ¥çš„è¸è„šçŸ³ã€‚\nHTTP/1.0 - 1996 1996 å¹´ï¼ŒHTTP çš„ä¸‹ä¸€ä¸ªç‰ˆæœ¬ï¼ˆå³ HTTP/1.0ï¼‰å¾—åˆ°äº†å‘å±•ï¼Œæ¯”åŸå§‹ç‰ˆæœ¬æœ‰äº†å¾ˆå¤§çš„æ”¹è¿›ã€‚ä¸ä»…é’ˆå¯¹ HTML å“åº”è®¾è®¡çš„ HTTP/0.9 ä¸åŒï¼ŒHTTP/1.0 ç°åœ¨ä¹Ÿå¯ä»¥å¤„ç†å…¶ä»–å“åº”æ ¼å¼ï¼Œå³å›¾åƒã€è§†é¢‘æ–‡ä»¶ã€çº¯æ–‡æœ¬æˆ–ä»»ä½•å…¶ä»–å†…å®¹ç±»å‹ã€‚å®ƒæ·»åŠ äº†æ›´å¤šæ–¹æ³•ï¼ˆå³ POST å’Œ HEADï¼‰ã€æ›´æ”¹äº†è¯·æ±‚/å“åº”æ ¼å¼ã€å°† HTTP æ ‡å¤´æ·»åŠ åˆ°è¯·æ±‚å’Œå“åº”ä¸­ã€æ·»åŠ äº†çŠ¶æ€ä»£ç æ¥æ ‡è¯†å“åº”ã€å¼•å…¥äº†å­—ç¬¦é›†æ”¯æŒã€å¤šéƒ¨åˆ†ç±»å‹ã€æˆæƒã€ç¼“å­˜ã€å†…å®¹ç¼–ç ç­‰éƒ½åŒ…æ‹¬åœ¨å†…ã€‚\nä»¥ä¸‹æ˜¯ç¤ºä¾‹ HTTP/1.0 è¯·æ±‚å’Œå“åº”çš„æ ·å­ï¼š\nGET / HTTP/1.0 Host: cs.fyi User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) Accept: */* æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œé™¤äº†è¯·æ±‚ä¹‹å¤–ï¼Œå®¢æˆ·ç«¯è¿˜å‘é€äº†å®ƒçš„ä¸ªäººä¿¡æ¯ã€æ‰€éœ€çš„å“åº”ç±»å‹ç­‰ã€‚è€Œåœ¨ HTTP/0.9 ä¸­ï¼Œå®¢æˆ·ç«¯æ°¸è¿œæ— æ³•å‘é€æ­¤ç±»ä¿¡æ¯ï¼Œå› ä¸ºæ²¡æœ‰æ ‡å¤´ã€‚\nå¯¹ä¸Šè¿°è¯·æ±‚çš„å“åº”ç¤ºä¾‹å¯èƒ½å¦‚ä¸‹æ‰€ç¤º\nHTTP/1.0 200 OK Content-Type: text/plain Content-Length: 137582 Expires: Thu, 05 Dec 1997 16:00:00 GMT Last-Modified: Wed, 5 August 1996 15:55:28 GMT Server: Apache 0.84 (response body) (connection closed) å“åº”çš„å¼€å¤´æ˜¯ HTTP/1.0ï¼ˆHTTP åè·Ÿç‰ˆæœ¬å·ï¼‰ï¼Œç„¶åæ˜¯çŠ¶æ€ä»£ç  200ï¼Œåè·ŸåŸå› çŸ­è¯­ï¼ˆæˆ–è€…çŠ¶æ€ä»£ç çš„æè¿°ï¼Œå¦‚æœæ‚¨æ„¿æ„çš„è¯ï¼‰ã€‚\nåœ¨æ­¤è¾ƒæ–°ç‰ˆæœ¬ä¸­ï¼Œè¯·æ±‚å’Œå“åº”æ ‡å¤´ä»ä¿ç•™ä¸º ASCII ç¼–ç ï¼Œä½†å“åº”æ­£æ–‡å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼Œå³å›¾åƒã€è§†é¢‘ã€HTMLã€çº¯æ–‡æœ¬æˆ–ä»»ä½•å…¶ä»–å†…å®¹ç±»å‹ã€‚å› æ­¤ï¼Œç°åœ¨æœåŠ¡å™¨å¯ä»¥å‘å®¢æˆ·ç«¯å‘é€ä»»ä½•å†…å®¹ç±»å‹ï¼›æ¨å‡ºåä¸ä¹…ï¼ŒHTTP ä¸­çš„â€œè¶…æ–‡æœ¬â€ä¸€è¯å°±å˜å¾—ç”¨è¯ä¸å½“ã€‚ HMTP æˆ–è¶…åª’ä½“ä¼ è¾“åè®®å¯èƒ½æ›´æœ‰æ„ä¹‰ï¼Œä½†æˆ‘æƒ³ï¼Œæˆ‘ä»¬ç»ˆç”Ÿéƒ½åšæŒè¿™ä¸ªåå­—ã€‚\nHTTP/1.0 çš„ä¸»è¦ç¼ºç‚¹ä¹‹ä¸€æ˜¯æ¯ä¸ªè¿æ¥ä¸èƒ½æœ‰å¤šä¸ªè¯·æ±‚ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯å½“å®¢æˆ·ç«¯éœ€è¦ä»æœåŠ¡å™¨è·å–æŸäº›å†…å®¹æ—¶ï¼Œå®ƒéƒ½å¿…é¡»æ‰“å¼€ä¸€ä¸ªæ–°çš„ TCP è¿æ¥ï¼Œå¹¶ä¸”åœ¨æ»¡è¶³è¯¥å•ä¸ªè¯·æ±‚åï¼Œè¿æ¥å°†è¢«å…³é—­ã€‚å¯¹äºä»»ä½•ä¸‹ä¸€ä¸ªè¦æ±‚ï¼Œéƒ½å¿…é¡»å»ºç«‹åœ¨æ–°çš„è¿æ¥ä¸Šã€‚ä¸ºä»€ä¹ˆä¸å¥½ï¼Ÿ\nå¥½å§ï¼Œå‡è®¾æ‚¨è®¿é—®çš„ç½‘é¡µåŒ…å« 10 ä¸ªå›¾åƒã€5 ä¸ªæ ·å¼è¡¨å’Œ 5 ä¸ª JavaScript æ–‡ä»¶ï¼Œæ€»å…±æœ‰ 20 ä¸ªé¡¹ç›®éœ€è¦åœ¨å‘è¯¥ç½‘é¡µå‘å‡ºè¯·æ±‚æ—¶è·å–ã€‚ç”±äºæœåŠ¡å™¨åœ¨æ»¡è¶³è¯·æ±‚åç«‹å³å…³é—­è¿æ¥ï¼Œå› æ­¤å°†å­˜åœ¨ä¸€ç³»åˆ— 20 ä¸ªå•ç‹¬çš„è¿æ¥ï¼Œå…¶ä¸­æ¯ä¸ªé¡¹ç›®éƒ½å°†åœ¨å…¶å•ç‹¬çš„è¿æ¥ä¸Šä¸€ä¸ªæ¥ä¸€ä¸ªåœ°æä¾›æœåŠ¡ã€‚\nå¦‚æ­¤å¤§é‡çš„è¿æ¥ä¼šå¯¼è‡´ä¸¥é‡çš„æ€§èƒ½æŸå¤±ï¼Œå› ä¸ºç”±äºä¸‰å‘æ¡æ‰‹å’Œæ…¢å¯åŠ¨ï¼Œéœ€è¦æ–°çš„ TCP è¿æ¥ä¼šé€ æˆæ˜¾ç€çš„æ€§èƒ½æŸå¤±ã€‚\nä¸‰æ–¹æ¡æ‰‹ ä¸‰å‘æ¡æ‰‹æœ€ç®€å•çš„å½¢å¼æ˜¯ï¼Œæ‰€æœ‰ TCP è¿æ¥éƒ½ä»¥ä¸‰å‘æ¡æ‰‹å¼€å§‹ï¼Œå…¶ä¸­å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åœ¨å¼€å§‹å…±äº«åº”ç”¨ç¨‹åºæ•°æ®ä¹‹å‰å…±äº«ä¸€ç³»åˆ—æ•°æ®åŒ…ã€‚\nSYN - å®¢æˆ·ç«¯é€‰å–ä¸€ä¸ªéšæœºæ•°ï¼ˆå‡è®¾ä¸º xï¼‰å¹¶å°†å…¶å‘é€åˆ°æœåŠ¡å™¨ã€‚ SYN ACK - æœåŠ¡å™¨é€šè¿‡å°† ACK æ•°æ®åŒ…å‘é€å›å®¢æˆ·ç«¯æ¥ç¡®è®¤è¯·æ±‚ï¼Œè¯¥æ•°æ®åŒ…ç”±éšæœºæ•°ç»„æˆï¼Œå‡è®¾æœåŠ¡å™¨æ‹¾å– y å’Œæ•°å­— x+1ï¼Œå…¶ä¸­ x æ˜¯å®¢æˆ·ç«¯å‘é€çš„æ•°å­— ACK - å®¢æˆ·ç«¯é€’å¢ä»æœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ•°å­— yï¼Œå¹¶å‘é€å›å¸¦æœ‰æ•°å­— y+1 çš„ ACK æ•°æ®åŒ… ä¸€æ—¦ä¸‰å‘æ¡æ‰‹å®Œæˆï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®å…±äº«å°±å¯ä»¥å¼€å§‹ã€‚åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œå®¢æˆ·ç«¯å¯ä»¥åœ¨å‘é€æœ€åä¸€ä¸ª ACKâ€‹â€‹ æ•°æ®åŒ…åç«‹å³å¼€å§‹å‘é€åº”ç”¨ç¨‹åºæ•°æ®ï¼Œä½†æœåŠ¡å™¨ä»ç„¶å¿…é¡»ç­‰å¾…æ”¶åˆ° ACK æ•°æ®åŒ…æ‰èƒ½æ»¡è¶³è¯·æ±‚ã€‚\nç„¶è€Œï¼ŒHTTP/1.0 çš„ä¸€äº›å®ç°è¯•å›¾é€šè¿‡å¼•å…¥ä¸€ä¸ªåä¸º Connection: keep-alive çš„æ–°æ ‡å¤´æ¥å…‹æœè¿™ä¸ªé—®é¢˜ï¼Œè¯¥æ ‡å¤´æ—¨åœ¨å‘Šè¯‰æœåŠ¡å™¨â€œå˜¿æœåŠ¡å™¨ï¼Œä¸è¦å…³é—­æ­¤è¿æ¥ï¼Œæˆ‘å†æ¬¡éœ€è¦å®ƒâ€ã€‚ä½†å®ƒä»ç„¶æ²¡æœ‰å¾—åˆ°å¹¿æ³›çš„æ”¯æŒï¼Œé—®é¢˜ä»ç„¶å­˜åœ¨ã€‚\né™¤äº†æ— è¿æ¥ä¹‹å¤–ï¼ŒHTTP ä¹Ÿæ˜¯ä¸€ç§æ— çŠ¶æ€åè®®ï¼Œå³æœåŠ¡å™¨ä¸ç»´æŠ¤æœ‰å…³å®¢æˆ·ç«¯çš„ä¿¡æ¯ï¼Œå› æ­¤æ¯ä¸ªè¯·æ±‚éƒ½å¿…é¡»å…·æœ‰æœåŠ¡å™¨è‡ªå·±å®Œæˆè¯·æ±‚æ‰€éœ€çš„ä¿¡æ¯ï¼Œè€Œä¸ä¸ä»»ä½•æ—§åè®®æœ‰ä»»ä½•å…³è”ã€‚è¦æ±‚ã€‚å› æ­¤ï¼Œè¿™ç«ä¸Šæµ‡æ²¹ï¼Œå³é™¤äº†å®¢æˆ·ç«¯å¿…é¡»æ‰“å¼€å¤§é‡è¿æ¥ä¹‹å¤–ï¼Œå®ƒè¿˜å¿…é¡»åœ¨çº¿è·¯ä¸Šå‘é€ä¸€äº›å†—ä½™æ•°æ®ï¼Œä»è€Œå¯¼è‡´å¸¦å®½ä½¿ç”¨é‡å¢åŠ ã€‚\nHTTP/1.1 - 1997 HTTP/1.0 ä»…ä»… 3 å¹´åï¼Œä¸‹ä¸€ä¸ªç‰ˆæœ¬å³ HTTP/1.1 äº 1999 å¹´å‘å¸ƒï¼›æ¯”å‰èº«åšäº†å¾ˆå¤šæ”¹è¿›ã€‚ç›¸å¯¹äº HTTP/1.0 çš„ä¸»è¦æ”¹è¿›åŒ…æ‹¬\næ·»åŠ äº†æ–°çš„ HTTP æ–¹æ³•ï¼Œå…¶ä¸­å¼•å…¥äº† PUTã€PATCHã€OPTIONSã€DELETE\nä¸»æœºåæ ‡è¯† åœ¨ HTTP/1.0 ä¸­ï¼Œä¸»æœºæ ‡å¤´ä¸æ˜¯å¿…éœ€çš„ï¼Œä½† HTTP/1.1 ä½¿å…¶æˆä¸ºå¿…éœ€çš„ã€‚\næŒä¹…è¿æ¥ å¦‚ä¸Šæ‰€è¿°ï¼Œåœ¨ HTTP/1.0 ä¸­ï¼Œæ¯ä¸ªè¿æ¥åªæœ‰ä¸€ä¸ªè¯·æ±‚ï¼Œä¸€æ—¦è¯·æ±‚å®Œæˆï¼Œè¿æ¥å°±ä¼šå…³é—­ï¼Œè¿™ä¼šå¯¼è‡´ä¸¥é‡çš„æ€§èƒ½å½±å“å’Œå»¶è¿Ÿé—®é¢˜ã€‚ HTTP/1.1 å¼•å…¥äº†æŒä¹…è¿æ¥ï¼Œå³è¿æ¥é»˜è®¤æƒ…å†µä¸‹ä¸ä¼šå…³é—­ï¼Œè€Œæ˜¯ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œä»è€Œå…è®¸å¤šä¸ªè¿ç»­è¯·æ±‚ã€‚è¦å…³é—­è¿æ¥ï¼Œè¯·æ±‚å¤´ Connection: close å¿…é¡»å¯ç”¨ã€‚\nå®¢æˆ·ç«¯é€šå¸¸åœ¨æœ€åä¸€ä¸ªè¯·æ±‚ä¸­å‘é€æ­¤æ ‡å¤´ä»¥å®‰å…¨åœ°å…³é—­è¿æ¥ã€‚\nç®¡é“åŒ– å®ƒè¿˜å¼•å…¥äº†å¯¹ç®¡é“åŒ–çš„æ”¯æŒï¼Œå®¢æˆ·ç«¯å¯ä»¥åœ¨åŒä¸€è¿æ¥ä¸Šå‘æœåŠ¡å™¨å‘é€å¤šä¸ªè¯·æ±‚ï¼Œè€Œæ— éœ€ç­‰å¾…æœåŠ¡å™¨çš„å“åº”ï¼Œå¹¶ä¸”æœåŠ¡å™¨å¿…é¡»æŒ‰ç…§æ¥æ”¶è¯·æ±‚çš„é¡ºåºå‘é€å“åº”ã€‚ä½†æ˜¯ï¼Œæ‚¨å¯èƒ½ä¼šé—®ï¼Œå®¢æˆ·ç«¯å¦‚ä½•çŸ¥é“è¿™æ˜¯ç¬¬ä¸€ä¸ªå“åº”ä¸‹è½½å®Œæˆå¹¶ä¸”ä¸‹ä¸€ä¸ªå“åº”å†…å®¹å¼€å§‹çš„ç‚¹ï¼\nå¥½å§ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¿…é¡»å­˜åœ¨ Content-Length æ ‡å¤´ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨å®ƒæ¥è¯†åˆ«å“åº”ç»“æŸçš„ä½ç½®ï¼Œå¹¶ä¸”å¯ä»¥å¼€å§‹ç­‰å¾…ä¸‹ä¸€ä¸ªå“åº”ã€‚\nåº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œä¸ºäº†ä»æŒä¹…è¿æ¥æˆ–ç®¡é“ä¸­å—ç›Šï¼ŒContent-Length æ ‡å¤´å¿…é¡»åœ¨å“åº”ä¸Šå¯ç”¨ï¼Œå› ä¸ºè¿™ä¼šè®©å®¢æˆ·ç«¯çŸ¥é“ä¼ è¾“ä½•æ—¶å®Œæˆå¹¶ä¸”å¯ä»¥å‘é€ä¸‹ä¸€ä¸ªè¯·æ±‚ï¼ˆä»¥æ­£å¸¸çš„é¡ºåºæ–¹å¼ï¼‰å‘é€è¯·æ±‚ï¼‰æˆ–å¼€å§‹ç­‰å¾…ä¸‹ä¸€ä¸ªå“åº”ï¼ˆå½“å¯ç”¨ç®¡é“æ—¶ï¼‰ã€‚\nä½†è¿™ç§æ–¹æ³•ä»ç„¶å­˜åœ¨ä¸€ä¸ªé—®é¢˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ•°æ®æ˜¯åŠ¨æ€çš„å¹¶ä¸”æœåŠ¡å™¨æ— æ³•äº‹å…ˆæ‰¾åˆ°å†…å®¹é•¿åº¦æ€ä¹ˆåŠï¼Ÿé‚£ä¹ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨çœŸçš„æ— æ³•ä»æŒä¹…è¿æ¥ä¸­å—ç›Šï¼Œä¸æ˜¯å—ï¼Ÿï¼ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒHTTP/1.1 å¼•å…¥äº†åˆ†å—ç¼–ç ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨å¯èƒ½ä¼šçœç•¥å†…å®¹é•¿åº¦ä»¥æ”¯æŒåˆ†å—ç¼–ç ï¼ˆç¨åä¼šè¯¦ç»†ä»‹ç»ï¼‰ã€‚ä½†æ˜¯ï¼Œå¦‚æœå®ƒä»¬éƒ½ä¸å¯ç”¨ï¼Œåˆ™å¿…é¡»åœ¨è¯·æ±‚ç»“æŸæ—¶å…³é—­è¿æ¥ã€‚\nåˆ†å—ä¼ è¾“ åœ¨åŠ¨æ€å†…å®¹çš„æƒ…å†µä¸‹ï¼Œå½“æœåŠ¡å™¨åœ¨ä¼ è¾“å¼€å§‹æ—¶æ— æ³•çœŸæ­£æ‰¾å‡º Content-Length æ—¶ï¼Œå®ƒå¯èƒ½ä¼šå¼€å§‹åˆ†å—ï¼ˆé€å—ï¼‰å‘é€å†…å®¹ï¼Œå¹¶åœ¨å‘é€æ—¶ä¸ºæ¯ä¸ªå—æ·»åŠ  Content-Length ã€‚å½“æ‰€æœ‰å—éƒ½å‘é€å®Œæ¯•ï¼ˆå³æ•´ä¸ªä¼ è¾“å·²å®Œæˆï¼‰æ—¶ï¼Œå®ƒä¼šå‘é€ä¸€ä¸ªç©ºå—ï¼ˆå³ Content-Length è®¾ç½®ä¸ºé›¶çš„å—ï¼‰ï¼Œä»¥ä¾¿è¯†åˆ«ä¼ è¾“å·²å®Œæˆçš„å®¢æˆ·ç«¯ã€‚\nä¸ºäº†é€šçŸ¥å®¢æˆ·ç«¯æœ‰å…³åˆ†å—ä¼ è¾“çš„ä¿¡æ¯ï¼ŒæœåŠ¡å™¨åŒ…å«æ ‡å¤´ Transfer-Encoding: chunked\nä¸ä»…å…·æœ‰åŸºæœ¬èº«ä»½éªŒè¯çš„ HTTP/1.0 ä¸åŒï¼ŒHTTP/1.1 åŒ…æ‹¬æ‘˜è¦å’Œä»£ç†èº«ä»½éªŒè¯\nç¼“å­˜\nå­—èŠ‚èŒƒå›´\nå­—ç¬¦é›†\nè¯­è¨€è°ˆåˆ¤\nå®¢æˆ·ç«¯ cookie\nå¢å¼ºçš„å‹ç¼©æ”¯æŒ\næ–°çš„çŠ¶æ€ä»£ç \næ›´å¤š\næˆ‘ä¸ä¼šåœ¨è¿™ç¯‡æ–‡ç« ä¸­è¯¦ç»†ä»‹ç» HTTP/1.1 çš„æ‰€æœ‰åŠŸèƒ½ï¼Œå› ä¸ºå®ƒæœ¬èº«å°±æ˜¯ä¸€ä¸ªä¸»é¢˜ï¼Œæ‚¨å·²ç»å¯ä»¥æ‰¾åˆ°å¾ˆå¤šç›¸å…³å†…å®¹ã€‚æˆ‘å»ºè®®æ‚¨é˜…è¯»çš„è¿™æ ·ä¸€ä»½æ–‡æ¡£æ˜¯ HTTP/1.0 å’Œ HTTP/1.1 ä¹‹é—´çš„å…³é”®å·®å¼‚ï¼Œè¿™é‡Œæ˜¯ä¼˜ç§€è€…çš„åŸå§‹ RFC é“¾æ¥ã€‚\nHTTP/1.1 äº 1999 å¹´æ¨å‡ºï¼Œå¤šå¹´æ¥ä¸€ç›´æ˜¯ä¸€ä¸ªæ ‡å‡†ã€‚å°½ç®¡å¦‚æ­¤ï¼Œå®ƒæ¯”å®ƒçš„å‰èº«æœ‰äº†å¾ˆå¤§çš„æ”¹è¿›ï¼›éšç€ç½‘ç»œæ¯å¤©éƒ½åœ¨å˜åŒ–ï¼Œå®ƒå¼€å§‹æ˜¾ç¤ºå‡ºå®ƒçš„å¹´é¾„ã€‚å¦‚ä»ŠåŠ è½½ç½‘é¡µæ¯”ä»¥å¾€æ›´åŠ æ¶ˆè€—èµ„æºã€‚å¦‚ä»Šï¼Œä¸€ä¸ªç®€å•çš„ç½‘é¡µå¿…é¡»æ‰“å¼€ 30 å¤šä¸ªè¿æ¥ã€‚é‚£ä¹ˆ HTTP/1.1 æœ‰æŒä¹…è¿æ¥ï¼Œé‚£ä¸ºä»€ä¹ˆæœ‰è¿™ä¹ˆå¤šè¿æ¥å‘¢ï¼Ÿä½ è¯´ï¼åŸå› æ˜¯ï¼Œåœ¨ HTTP/1.1 ä¸­ï¼Œä»»ä½•æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªæœªå®Œæˆçš„è¿æ¥ã€‚\nHTTP/1.1 è¯•å›¾é€šè¿‡å¼•å…¥ç®¡é“æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†å®ƒå¹¶æ²¡æœ‰å®Œå…¨è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºé˜Ÿå¤´é˜»å¡ï¼Œç¼“æ…¢æˆ–ç¹é‡çš„è¯·æ±‚å¯èƒ½ä¼šé˜»å¡åé¢çš„è¯·æ±‚ï¼Œä¸€æ—¦è¯·æ±‚å¡åœ¨ç®¡é“ä¸­ï¼Œå®ƒå°±ä¼šè¢«é˜»å¡ã€‚å¿…é¡»ç­‰å¾…ä¸‹ä¸€ä¸ªè¯·æ±‚å¾—åˆ°æ»¡è¶³ã€‚\nä¸ºäº†å…‹æœ HTTP/1.1 çš„è¿™äº›ç¼ºç‚¹ï¼Œå¼€å‘äººå‘˜å¼€å§‹å®æ–½è§£å†³æ–¹æ³•ï¼Œä¾‹å¦‚ä½¿ç”¨ spritesheetã€CSS ä¸­çš„ç¼–ç å›¾åƒã€å•ä¸ªåºå¤§çš„ CSS/Javascript æ–‡ä»¶ã€åŸŸåˆ†ç‰‡ç­‰ã€‚\nSPDY-2009 è°·æ­Œç»§ç»­å°è¯•æ›¿ä»£åè®®ï¼Œä»¥æé«˜ç½‘ç»œé€Ÿåº¦å¹¶æé«˜ç½‘ç»œå®‰å…¨æ€§ï¼ŒåŒæ—¶å‡å°‘ç½‘é¡µå»¶è¿Ÿã€‚ 2009 å¹´ï¼Œä»–ä»¬å®£å¸ƒäº† SPDYã€‚\nSPDY æ˜¯ Google çš„å•†æ ‡ï¼Œè€Œä¸æ˜¯ç¼©å†™è¯ã€‚\nå¯ä»¥çœ‹å‡ºï¼Œå¦‚æœæˆ‘ä»¬ä¸æ–­å¢åŠ å¸¦å®½ï¼Œç½‘ç»œæ€§èƒ½ä¸€å¼€å§‹ä¼šæœ‰æ‰€æé«˜ï¼Œä½†åˆ°äº†æŸä¸ªé˜¶æ®µï¼Œæ€§èƒ½å¢ç›Šå°±ä¸ä¼šå¤ªå¤§äº†ã€‚ä½†å¦‚æœä½ å¯¹å»¶è¿Ÿä¹Ÿé‡‡å–åŒæ ·çš„åšæ³•ï¼Œå³å¦‚æœæˆ‘ä»¬ä¸æ–­é™ä½å»¶è¿Ÿï¼Œé‚£ä¹ˆæ€§èƒ½å°±ä¼šæŒç»­æå‡ã€‚è¿™æ˜¯ SPDY èƒŒåæ€§èƒ½å¢ç›Šçš„æ ¸å¿ƒæ€æƒ³ï¼Œå‡å°‘å»¶è¿Ÿä»¥æé«˜ç½‘ç»œæ€§èƒ½ã€‚\nå¯¹äºé‚£äº›ä¸çŸ¥é“åŒºåˆ«çš„äººæ¥è¯´ï¼Œå»¶è¿Ÿæ˜¯å»¶è¿Ÿï¼Œå³æ•°æ®åœ¨æºå’Œç›®çš„åœ°ä¹‹é—´ä¼ è¾“æ‰€éœ€çš„æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ï¼Œè€Œå¸¦å®½æ˜¯æ¯ç§’ä¼ è¾“çš„æ•°æ®é‡ï¼ˆæ¯ç§’æ¯”ç‰¹æ•°ï¼‰ã€‚\nSPDY çš„åŠŸèƒ½åŒ…æ‹¬å¤šè·¯å¤ç”¨ã€å‹ç¼©ã€ä¼˜å…ˆçº§ã€å®‰å…¨æ€§ç­‰ã€‚æˆ‘ä¸æ‰“ç®—è¯¦ç»†ä»‹ç» SPDYï¼Œå› ä¸ºå½“æˆ‘ä»¬åœ¨ä¸‹ä¸€èŠ‚ä¸­æ·±å…¥äº†è§£ HTTP/2 çš„æœ¬è´¨æ—¶ï¼Œæ‚¨å°±ä¼šæ˜ç™½äº†ã€‚æ®è¯´ HTTP/2 ä¸»è¦æ˜¯å—åˆ° SPDY çš„å¯å‘ã€‚\nSPDY å¹¶æ²¡æœ‰çœŸæ­£å°è¯•å–ä»£ HTTPï¼›è€Œæ˜¯å®ƒæ˜¯ HTTP ä¸Šçš„è½¬æ¢å±‚ï¼Œå­˜åœ¨äºåº”ç”¨ç¨‹åºå±‚å¹¶åœ¨å°†è¯·æ±‚å‘é€åˆ°çº¿è·¯ä¹‹å‰å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚å®ƒå¼€å§‹æˆä¸ºäº‹å®ä¸Šçš„æ ‡å‡†ï¼Œå¤§å¤šæ•°æµè§ˆå™¨å¼€å§‹å®ç°å®ƒã€‚\n2015 å¹´ï¼Œåœ¨ Googleï¼Œä»–ä»¬ä¸æƒ³æœ‰ä¸¤ä¸ªç›¸äº’ç«äº‰çš„æ ‡å‡†ï¼Œå› æ­¤å†³å®šå°†å…¶åˆå¹¶åˆ° HTTP ä¸­ï¼ŒåŒæ—¶è¯ç”Ÿäº† HTTP/2 å¹¶å¼ƒç”¨äº† SPDYã€‚\nHTTP/2 - 2015 åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæ‚¨å¿…é¡»ç¡®ä¿¡ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å¯¹ HTTP åè®®è¿›è¡Œå¦ä¸€æ¬¡ä¿®è®¢ã€‚ HTTP/2 ä¸“ä¸ºä½å»¶è¿Ÿå†…å®¹ä¼ è¾“è€Œè®¾è®¡ã€‚ä¸æ—§ç‰ˆæœ¬ HTTP/1.1 çš„ä¸»è¦åŠŸèƒ½æˆ–åŒºåˆ«åŒ…æ‹¬\näºŒè¿›åˆ¶è€Œä¸æ˜¯æ–‡æœ¬ å¤šè·¯å¤ç”¨ - å•ä¸ªè¿æ¥ä¸Šçš„å¤šä¸ªå¼‚æ­¥ HTTP è¯·æ±‚ ä½¿ç”¨ HPACK è¿›è¡Œæ ‡å¤´å‹ç¼© æœåŠ¡å™¨æ¨é€ - å•ä¸ªè¯·æ±‚çš„å¤šä¸ªå“åº” è¯·æ±‚ä¼˜å…ˆçº§ å®‰å…¨ 1. äºŒè¿›åˆ¶åè®® HTTP/2 å€¾å‘äºé€šè¿‡ä½¿å…¶æˆä¸ºäºŒè¿›åˆ¶åè®®æ¥è§£å†³ HTTP/1.x ä¸­å­˜åœ¨çš„å»¶è¿Ÿå¢åŠ çš„é—®é¢˜ã€‚ä½œä¸ºä¸€ç§äºŒè¿›åˆ¶åè®®ï¼Œå®ƒæ›´å®¹æ˜“è§£æï¼Œä½†ä¸ HTTP/1.x ä¸åŒï¼Œå®ƒä¸å†æ˜¯äººçœ¼å¯è¯»çš„ã€‚ HTTP/2 çš„ä¸»è¦æ„å»ºå—æ˜¯å¸§å’Œæµ\nå¸§å’Œæµ HTTP æ¶ˆæ¯ç°åœ¨ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå¸§ç»„æˆã€‚æœ‰ä¸€ä¸ªç”¨äºå…ƒæ•°æ®çš„ HEADERS å¸§å’Œç”¨äºæœ‰æ•ˆè´Ÿè½½çš„ DATA å¸§ï¼Œå¹¶ä¸”å­˜åœ¨å¤šç§å…¶ä»–ç±»å‹çš„å¸§ï¼ˆHEADERSã€DATAã€RST_STREAMã€SETTINGSã€PRIORITY ç­‰ï¼‰ï¼Œæ‚¨å¯ä»¥é€šè¿‡ HTTP/2 è§„èŒƒè¿›è¡Œæ£€æŸ¥ã€‚\næ¯ä¸ª HTTP/2 è¯·æ±‚å’Œå“åº”éƒ½ä¼šè¢«èµ‹äºˆä¸€ä¸ªå”¯ä¸€çš„æµ IDï¼Œå¹¶è¢«åˆ†ä¸ºå¸§ã€‚å¸§åªä¸è¿‡æ˜¯äºŒè¿›åˆ¶æ•°æ®ã€‚å¸§çš„é›†åˆç§°ä¸ºæµã€‚æ¯ä¸ªå¸§éƒ½æœ‰ä¸€ä¸ªæµ IDï¼Œç”¨äºæ ‡è¯†å…¶æ‰€å±çš„æµï¼Œå¹¶ä¸”æ¯ä¸ªå¸§éƒ½æœ‰ä¸€ä¸ªå…¬å…±æ ‡å¤´ã€‚å¦å¤–ï¼Œé™¤äº†æµ ID æ˜¯å”¯ä¸€çš„ä¹‹å¤–ï¼Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œå®¢æˆ·ç«¯å‘èµ·çš„ä»»ä½•è¯·æ±‚éƒ½ä½¿ç”¨å¥‡æ•°ï¼Œè€ŒæœåŠ¡å™¨å“åº”çš„æµ ID åˆ™ä¸ºå¶æ•°ã€‚\né™¤äº† HEADERS å’Œ DATA ä¹‹å¤–ï¼Œæˆ‘è®¤ä¸ºè¿™é‡Œå€¼å¾—ä¸€æçš„å¦ä¸€ç§å¸§ç±»å‹æ˜¯ RST_STREAMï¼Œå®ƒæ˜¯ä¸€ç§ç‰¹æ®Šçš„å¸§ç±»å‹ï¼Œç”¨äºä¸­æ­¢æŸäº›æµï¼Œå³å®¢æˆ·ç«¯å¯ä»¥å‘é€æ­¤å¸§ä»¥è®©æœåŠ¡å™¨çŸ¥é“æˆ‘ä¸éœ€è¦æ­¤æµä¸å†äº†ã€‚åœ¨ HTTP/1.1 ä¸­ï¼Œä½¿æœåŠ¡å™¨åœæ­¢å‘å®¢æˆ·ç«¯å‘é€å“åº”çš„å”¯ä¸€æ–¹æ³•æ˜¯å…³é—­è¿æ¥ï¼Œè¿™ä¼šå¯¼è‡´å»¶è¿Ÿå¢åŠ ï¼Œå› ä¸ºå¿…é¡»ä¸ºä»»ä½•è¿ç»­è¯·æ±‚æ‰“å¼€æ–°è¿æ¥ã€‚\nåœ¨ HTTP/2 ä¸­ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨ RST_STREAM å¹¶åœæ­¢æ¥æ”¶ç‰¹å®šæµï¼ŒåŒæ—¶è¿æ¥ä»å¤„äºæ‰“å¼€çŠ¶æ€å¹¶ä¸”å…¶ä»–æµä»å°†åœ¨æ’­æ”¾ä¸­ã€‚\n2. å¤šè·¯å¤ç”¨ ç”±äº HTTP/2 ç°åœ¨æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶åè®®ï¼Œå¹¶ä¸”æ­£å¦‚æˆ‘ä¸Šé¢æ‰€è¯´ï¼Œå®ƒä½¿ç”¨å¸§å’Œæµæ¥è¿›è¡Œè¯·æ±‚å’Œå“åº”ï¼Œå› æ­¤ä¸€æ—¦æ‰“å¼€ TCP è¿æ¥ï¼Œæ‰€æœ‰æµéƒ½å°†é€šè¿‡åŒä¸€è¿æ¥å¼‚æ­¥å‘é€ï¼Œè€Œæ— éœ€æ‰“å¼€ä»»ä½•å…¶ä»–è¿æ¥ã€‚åè¿‡æ¥ï¼ŒæœåŠ¡å™¨ä»¥ç›¸åŒçš„å¼‚æ­¥æ–¹å¼å“åº”ï¼Œå³å“åº”æ²¡æœ‰é¡ºåºï¼Œå®¢æˆ·ç«¯ä½¿ç”¨åˆ†é…çš„æµ ID æ¥æ ‡è¯†ç‰¹å®šæ•°æ®åŒ…æ‰€å±çš„æµã€‚\nè¿™ä¹Ÿè§£å†³äº† HTTP/1.x ä¸­å­˜åœ¨çš„é˜Ÿå¤´é˜»å¡é—®é¢˜ï¼Œå³å®¢æˆ·ç«¯ä¸å¿…ç­‰å¾…éœ€è¦æ—¶é—´çš„è¯·æ±‚ï¼Œè€Œå…¶ä»–è¯·æ±‚ä»å°†å¾—åˆ°å¤„ç†ã€‚\n3. æŠ¥å¤´å‹ç¼© å®ƒæ˜¯å•ç‹¬ RFC çš„ä¸€éƒ¨åˆ†ï¼Œä¸“é—¨ç”¨äºä¼˜åŒ–å‘é€çš„æ ‡å¤´ã€‚å…¶æœ¬è´¨æ˜¯ï¼Œå½“æˆ‘ä»¬ä¸æ–­åœ°ä»åŒä¸€ä¸ªå®¢æˆ·ç«¯è®¿é—®æœåŠ¡å™¨æ—¶ï¼Œæˆ‘ä»¬ä¼šåœ¨æ ‡å¤´ä¸­ä¸€éåˆä¸€éåœ°å‘é€å¤§é‡å†—ä½™æ•°æ®ï¼Œæœ‰æ—¶å¯èƒ½ä¼šæœ‰ cookie å¢åŠ æ ‡å¤´å¤§å°ï¼Œä»è€Œå¯¼è‡´å¸¦å®½ä½¿ç”¨å’Œå»¶è¿Ÿå¢åŠ ã€‚ä¸ºäº†å…‹æœè¿™ä¸ªé—®é¢˜ï¼ŒHTTP/2 å¼•å…¥äº†æ ‡å¤´å‹ç¼©ã€‚\nä¸è¯·æ±‚å’Œå“åº”ä¸åŒï¼Œæ ‡å¤´ä¸ä¼šä»¥ gzip æˆ– compress ç­‰æ ¼å¼å‹ç¼©ï¼Œä½†æ ‡å¤´å‹ç¼©æœ‰ä¸åŒçš„æœºåˆ¶ï¼Œå³ä½¿ç”¨éœå¤«æ›¼ä»£ç å¯¹æ–‡å­—å€¼è¿›è¡Œç¼–ç ï¼Œæ ‡å¤´è¡¨ç”±å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä»¥åŠå®¢æˆ·ç«¯ç»´æŠ¤æœåŠ¡å™¨åœ¨åç»­è¯·æ±‚ä¸­çœç•¥ä»»ä½•é‡å¤çš„æ ‡å¤´ï¼ˆä¾‹å¦‚ç”¨æˆ·ä»£ç†ç­‰ï¼‰ï¼Œå¹¶ä½¿ç”¨ä¸¤è€…ç»´æŠ¤çš„æ ‡å¤´è¡¨å¼•ç”¨å®ƒä»¬ã€‚å½“æˆ‘ä»¬è°ˆè®ºæ ‡å¤´æ—¶ï¼Œè®©æˆ‘åœ¨è¿™é‡Œè¡¥å……ä¸€ç‚¹ï¼Œæ ‡å¤´ä»ç„¶ä¸ HTTP/1.1 ä¸­çš„ç›¸åŒï¼Œé™¤äº†æ·»åŠ ä¸€äº›ä¼ªæ ‡å¤´ï¼Œå³ :method ã€ :scheme ã€ :host å’Œ :path\n4. æœåŠ¡å™¨æ¨é€ æœåŠ¡å™¨æ¨é€æ˜¯ HTTP/2 çš„å¦ä¸€ä¸ªå·¨å¤§åŠŸèƒ½ï¼ŒæœåŠ¡å™¨çŸ¥é“å®¢æˆ·ç«¯å°†è¯·æ±‚æŸä¸ªèµ„æºï¼Œå¯ä»¥å°†å…¶æ¨é€ç»™å®¢æˆ·ç«¯ï¼Œç”šè‡³æ— éœ€å®¢æˆ·ç«¯è¯·æ±‚ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æµè§ˆå™¨åŠ è½½ç½‘é¡µï¼Œå®ƒä¼šè§£ææ•´ä¸ªé¡µé¢ä»¥æ‰¾å‡ºå¿…é¡»ä»æœåŠ¡å™¨åŠ è½½çš„è¿œç¨‹å†…å®¹ï¼Œç„¶åå‘æœåŠ¡å™¨å‘é€åç»­è¯·æ±‚ä»¥è·å–è¯¥å†…å®¹ã€‚\næœåŠ¡å™¨æ¨é€å…è®¸æœåŠ¡å™¨é€šè¿‡æ¨é€å®ƒçŸ¥é“å®¢æˆ·ç«¯å°†éœ€è¦çš„æ•°æ®æ¥å‡å°‘å¾€è¿”æ¬¡æ•°ã€‚å…¶å·¥ä½œåŸç†æ˜¯ï¼ŒæœåŠ¡å™¨å‘é€ä¸€ä¸ªåä¸º PUSH_PROMISE çš„ç‰¹æ®Šå¸§ï¼Œé€šçŸ¥å®¢æˆ·ç«¯ï¼šâ€œå˜¿ï¼Œæˆ‘å³å°†å°†æ­¤èµ„æºå‘é€ç»™æ‚¨ï¼åˆ«å‘æˆ‘è¦ã€‚â€ PUSH_PROMISE å¸§ä¸å¯¼è‡´æ¨é€å‘ç”Ÿçš„æµç›¸å…³è”ï¼Œå®ƒåŒ…å«æ‰¿è¯ºçš„æµ IDï¼Œå³æœåŠ¡å™¨å°†åœ¨å…¶ä¸Šå‘é€è¦æ¨é€çš„èµ„æºçš„æµã€‚\n5. è¯·æ±‚ä¼˜å…ˆçº§ å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡åœ¨æ‰“å¼€æµçš„ HEADERS å¸§ä¸­åŒ…å«ä¼˜å…ˆçº§ä¿¡æ¯æ¥ä¸ºæµåˆ†é…ä¼˜å…ˆçº§ã€‚åœ¨ä»»ä½•å…¶ä»–æ—¶é—´ï¼Œå®¢æˆ·ç«¯éƒ½å¯ä»¥å‘é€ PRIORITY å¸§æ¥æ›´æ”¹æµçš„ä¼˜å…ˆçº§ã€‚\næ²¡æœ‰ä»»ä½•ä¼˜å…ˆçº§ä¿¡æ¯ï¼ŒæœåŠ¡å™¨å¼‚æ­¥å¤„ç†è¯·æ±‚ï¼Œå³æ²¡æœ‰ä»»ä½•é¡ºåºã€‚å¦‚æœä¸ºæµåˆ†é…äº†ä¼˜å…ˆçº§ï¼Œåˆ™æœåŠ¡å™¨æ ¹æ®æ­¤ä¼˜å…ˆçº§ä¿¡æ¯å†³å®šéœ€è¦åˆ†é…å¤šå°‘èµ„æºæ¥å¤„ç†å“ªä¸ªè¯·æ±‚ã€‚\n6. å®‰å…¨ å…³äºæ˜¯å¦åº”è¯¥å¯¹ HTTP/2 å¼ºåˆ¶æ‰§è¡Œå®‰å…¨æ€§ï¼ˆé€šè¿‡ TLSï¼‰è¿›è¡Œäº†å¹¿æ³›çš„è®¨è®ºã€‚æœ€ç»ˆå†³å®šä¸å¼ºåˆ¶æ‰§è¡Œã€‚ç„¶è€Œï¼Œå¤§å¤šæ•°ä¾›åº”å•†è¡¨ç¤ºï¼Œä»–ä»¬ä»…åœ¨é€šè¿‡ TLS ä½¿ç”¨ HTTP/2 æ—¶æ‰æ”¯æŒ HTTP/2ã€‚å› æ­¤ï¼Œå°½ç®¡ HTTP/2 ä¸è¦æ±‚æŒ‰è§„èŒƒè¿›è¡ŒåŠ å¯†ï¼Œä½†æ— è®ºå¦‚ä½•å®ƒåœ¨é»˜è®¤æƒ…å†µä¸‹å·²æˆä¸ºå¼ºåˆ¶æ€§çš„ã€‚æ’é™¤äº†è¿™ä¸€ç‚¹ï¼ŒHTTP/2 åœ¨é€šè¿‡ TLS å®ç°æ—¶ç¡®å®æå‡ºäº†ä¸€äº›è¦æ±‚ï¼Œå³å¿…é¡»ä½¿ç”¨ TLS ç‰ˆæœ¬ 1.2 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œå¿…é¡»æœ‰ä¸€å®šæ°´å¹³çš„æœ€å°å¯†é’¥å¤§å°ï¼Œéœ€è¦ä¸´æ—¶å¯†é’¥ç­‰ã€‚\nåŸæ–‡é“¾æ¥ï¼šhttps://cs.fyi/guide/http-in-depth\n","permalink":"https://blog.chensoul.cc/posts/2023/10/12/http-in-depth/","summary":"HTTP æ˜¯æ¯ä¸ª Web å¼€å‘äººå‘˜éƒ½åº”è¯¥äº†è§£çš„åè®®ï¼Œå› ä¸ºå®ƒä¸ºæ•´ä¸ª Web æä¾›åŠ¨åŠ›ã€‚äº†è§£ HTTP å½“ç„¶å¯ä»¥å¸®åŠ©æ‚¨å¼€å‘æ›´å¥½çš„åº”ç”¨ç¨‹åºã€‚\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†è®¨è®º HTTP æ˜¯ä»€ä¹ˆã€å®ƒæ˜¯å¦‚ä½•äº§ç”Ÿçš„ã€å®ƒä»Šå¤©çš„çŠ¶å†µä»¥åŠæˆ‘ä»¬æ˜¯å¦‚ä½•èµ°åˆ°è¿™ä¸€æ­¥çš„\nä»€ä¹ˆæ˜¯ HTTPï¼Ÿ é¦–å…ˆï¼Œä»€ä¹ˆæ˜¯ HTTPï¼Ÿ HTTP æ˜¯åŸºäº TCP/IP çš„åº”ç”¨å±‚é€šä¿¡åè®®ï¼Œå®ƒæ ‡å‡†åŒ–äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ–¹å¼ã€‚å®ƒå®šä¹‰äº†å¦‚ä½•é€šè¿‡äº’è”ç½‘è¯·æ±‚å’Œä¼ è¾“å†…å®¹ã€‚é€šè¿‡åº”ç”¨å±‚åè®®ï¼Œæˆ‘çš„æ„æ€æ˜¯å®ƒåªæ˜¯ä¸€ä¸ªæ ‡å‡†åŒ–ä¸»æœºï¼ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼‰é€šä¿¡æ–¹å¼çš„æŠ½è±¡å±‚ã€‚ HTTP æœ¬èº«ä¾èµ–äº TCP/IP æ¥è·å–å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„è¯·æ±‚å’Œå“åº”ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨ TCP ç«¯å£ 80ï¼Œä½†ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–ç«¯å£ã€‚ç„¶è€Œï¼ŒHTTPS ä½¿ç”¨ç«¯å£ 443ã€‚\nHTTP/0.9 - One Liner (1991) HTTP çš„ç¬¬ä¸€ä¸ªæœ‰è®°å½•çš„ç‰ˆæœ¬æ˜¯ 1991 å¹´æå‡ºçš„ HTTP/0.9ã€‚å®ƒæ˜¯æœ‰å²ä»¥æ¥æœ€ç®€å•çš„åè®®ï¼›æœ‰ä¸€ä¸ªåä¸º GET çš„æ–¹æ³•ã€‚å¦‚æœå®¢æˆ·ç«¯å¿…é¡»è®¿é—®æœåŠ¡å™¨ä¸Šçš„æŸä¸ªç½‘é¡µï¼Œå®ƒä¼šå‘å‡ºå¦‚ä¸‹æ‰€ç¤ºçš„ç®€å•è¯·æ±‚\nGET /index.html æœåŠ¡å™¨çš„å“åº”å¦‚ä¸‹æ‰€ç¤º\n(response body) (connection closed) ä¹Ÿå°±æ˜¯è¯´ï¼ŒæœåŠ¡å™¨å°†æ”¶åˆ°è¯·æ±‚ï¼Œå›å¤ HTML ä½œä¸ºå“åº”ï¼Œä¸€æ—¦å†…å®¹ä¼ è¾“å®Œæ¯•ï¼Œè¿æ¥å°±ä¼šå…³é—­ã€‚æœ‰\næ— æ ‡é¢˜ GET æ˜¯å”¯ä¸€å…è®¸çš„æ–¹æ³• å“åº”å¿…é¡»æ˜¯ HTML æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œè¯¥åè®®å®é™…ä¸Šåªä¸è¿‡æ˜¯æœªæ¥çš„è¸è„šçŸ³ã€‚\nHTTP/1.0 - 1996 1996 å¹´ï¼ŒHTTP çš„ä¸‹ä¸€ä¸ªç‰ˆæœ¬ï¼ˆå³ HTTP/1.0ï¼‰å¾—åˆ°äº†å‘å±•ï¼Œæ¯”åŸå§‹ç‰ˆæœ¬æœ‰äº†å¾ˆå¤§çš„æ”¹è¿›ã€‚ä¸ä»…é’ˆå¯¹ HTML å“åº”è®¾è®¡çš„ HTTP/0.9 ä¸åŒï¼ŒHTTP/1.0 ç°åœ¨ä¹Ÿå¯ä»¥å¤„ç†å…¶ä»–å“åº”æ ¼å¼ï¼Œå³å›¾åƒã€è§†é¢‘æ–‡ä»¶ã€çº¯æ–‡æœ¬æˆ–ä»»ä½•å…¶ä»–å†…å®¹ç±»å‹ã€‚å®ƒæ·»åŠ äº†æ›´å¤šæ–¹æ³•ï¼ˆå³ POST å’Œ HEADï¼‰ã€æ›´æ”¹äº†è¯·æ±‚/å“åº”æ ¼å¼ã€å°† HTTP æ ‡å¤´æ·»åŠ åˆ°è¯·æ±‚å’Œå“åº”ä¸­ã€æ·»åŠ äº†çŠ¶æ€ä»£ç æ¥æ ‡è¯†å“åº”ã€å¼•å…¥äº†å­—ç¬¦é›†æ”¯æŒã€å¤šéƒ¨åˆ†ç±»å‹ã€æˆæƒã€ç¼“å­˜ã€å†…å®¹ç¼–ç ç­‰éƒ½åŒ…æ‹¬åœ¨å†…ã€‚\nä»¥ä¸‹æ˜¯ç¤ºä¾‹ HTTP/1.0 è¯·æ±‚å’Œå“åº”çš„æ ·å­ï¼š\nGET / HTTP/1.0 Host: cs.fyi User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) Accept: */* æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œé™¤äº†è¯·æ±‚ä¹‹å¤–ï¼Œå®¢æˆ·ç«¯è¿˜å‘é€äº†å®ƒçš„ä¸ªäººä¿¡æ¯ã€æ‰€éœ€çš„å“åº”ç±»å‹ç­‰ã€‚è€Œåœ¨ HTTP/0.9 ä¸­ï¼Œå®¢æˆ·ç«¯æ°¸è¿œæ— æ³•å‘é€æ­¤ç±»ä¿¡æ¯ï¼Œå› ä¸ºæ²¡æœ‰æ ‡å¤´ã€‚\nå¯¹ä¸Šè¿°è¯·æ±‚çš„å“åº”ç¤ºä¾‹å¯èƒ½å¦‚ä¸‹æ‰€ç¤º\nHTTP/1.0 200 OK Content-Type: text/plain Content-Length: 137582 Expires: Thu, 05 Dec 1997 16:00:00 GMT Last-Modified: Wed, 5 August 1996 15:55:28 GMT Server: Apache 0.","title":"[è¯‘]å…³äº HTTP æ‚¨éœ€è¦äº†è§£çš„ä¸€åˆ‡"},{"content":"å‰ç«¯å­¦ä¹ è·¯çº¿å›¾:\nInternetï¼š HTTP DNS HTML Basic Semantic HTML Forms and Validations Accessibility SEO CSS Basic Layout Responsive Design JavaScript Baisc DOM Fetch API / Ajax Package Manager npm pnpm yarn Framework Angular Vue.js React Svelte Solid JS Qwik Writing CSS Tailwind Radix UI Shadcn UI CSS Architecture BEM CSS Preprocessors SASS PostCSS Build Module Bundlers parcel Rollup Webpack esbuild Vite Task Runners npm scripts Linters and Formatters Prettier ESLint Test Vitest Jest Playwirte Cypress Authentication Strategies JWT OAuth SSO Basic Auth Session Auth Web Security Basics CORS HTTPS CSP OWASP Security Risks Web Components HTML Templates Custom Elements Shadow DOM Type Checkers TypeScript Server Side Rendering(SSR) Svelte Svelte Kit Vue.js Nuxt.js Angular Universal React Next.js Remix GraphQL Apollo Relay Modern Static Site Generators Vuepress Jekyll Hugo Nuxt.js Astro Eleventy Next.js Remix Progressive Web App Mobel Applications React Native Flutter Ionic NativeScript Desktop Applications Bonus Content ","permalink":"https://blog.chensoul.cc/posts/2023/10/12/frontend-roadmap/","summary":"å‰ç«¯å­¦ä¹ è·¯çº¿å›¾:\nInternetï¼š HTTP DNS HTML Basic Semantic HTML Forms and Validations Accessibility SEO CSS Basic Layout Responsive Design JavaScript Baisc DOM Fetch API / Ajax Package Manager npm pnpm yarn Framework Angular Vue.js React Svelte Solid JS Qwik Writing CSS Tailwind Radix UI Shadcn UI CSS Architecture BEM CSS Preprocessors SASS PostCSS Build Module Bundlers parcel Rollup Webpack esbuild Vite Task Runners npm scripts Linters and Formatters Prettier ESLint Test Vitest Jest Playwirte Cypress Authentication Strategies JWT OAuth SSO Basic Auth Session Auth Web Security Basics CORS HTTPS CSP OWASP Security Risks Web Components HTML Templates Custom Elements Shadow DOM Type Checkers TypeScript Server Side Rendering(SSR) Svelte Svelte Kit Vue.","title":"å‰ç«¯å­¦ä¹ è·¯çº¿å›¾"},{"content":"æ¬¢è¿æ¥åˆ° Git é¢è¯•å‡†å¤‡æŒ‡å—ï¼Œæˆ‘ä»¬å°†åœ¨è¿™é‡Œå‘åˆå­¦è€…å’Œç»éªŒä¸°å¯Œçš„ä¸“ä¸šäººå£«è®¨è®ºæœ€å¸¸è§çš„ Git é¢è¯•é—®é¢˜ã€‚æ— è®ºæ‚¨æ˜¯å‡†å¤‡å‚åŠ  DevOps æˆ–æµ‹è¯•é¢è¯•ï¼Œè¿˜æ˜¯å¸Œæœ›æé«˜ Git æŠ€èƒ½ï¼Œæ­¤èµ„æºéƒ½å¯ä»¥é€šè¿‡æ·±å…¥ç ”ç©¶ä¸€äº›ä¸ Git åŸºæœ¬æ¦‚å¿µå’Œå®è·µç›¸å…³çš„æœ€å¸¸è§é¢è¯•é—®é¢˜æ¥å¸®åŠ©æ‚¨ã€‚\næˆ‘ä»¬å°†æ¶µç›–æ‰€æœ‰é‡è¦ä¸»é¢˜ï¼Œä¾‹å¦‚åˆ†æ”¯ã€å­˜å‚¨åº“ç®¡ç†ã€å¤„ç†åˆå¹¶å†²çªå’Œåä½œå·¥ä½œæµç¨‹ã€‚é€šè¿‡æ¢ç´¢è¿™äº›é—®é¢˜ï¼Œæ‚¨å°†æ›´æ·±å…¥åœ°äº†è§£ Git çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œå¹¶æ›´å¥½åœ°åº”å¯¹å¼€å‘é¡¹ç›®ä¸­çš„ç°å®æŒ‘æˆ˜ã€‚\n1.ä»€ä¹ˆæ˜¯ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Ÿ ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ (VCS) æ˜¯ä¸€ç§å¸®åŠ©è·Ÿè¸ªå’Œç®¡ç†æ–‡ä»¶å’Œä»£ç éšæ—¶é—´å˜åŒ–çš„è½¯ä»¶ã€‚å®ƒå…è®¸å¤šäººåä½œå¤„ç†ä¸€ä¸ªé¡¹ç›®ï¼Œè·Ÿè¸ªä¿®è®¢ï¼Œå¹¶åœ¨éœ€è¦æ—¶è½»æ¾æ¢å¤åˆ°ä»¥å‰çš„ç‰ˆæœ¬ã€‚\nç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸»è¦åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼š\næœ¬åœ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ (LVCS)ï¼šåœ¨ LVCS ä¸­ï¼Œç‰ˆæœ¬æ§åˆ¶æ•°æ®åº“å­˜å‚¨åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šã€‚æ›´æ”¹å’Œä¿®è®¢åœ¨ä½äºç”¨æˆ·è®¡ç®—æœºä¸Šçš„æœ¬åœ°å­˜å‚¨åº“ä¸­è¿›è¡Œè·Ÿè¸ªã€‚ä½†æ­¤ç±»ç³»ç»Ÿç¼ºä¹åä½œåŠŸèƒ½ï¼Œä¸åˆ©äºå›¢é˜Ÿå¼€å‘ã€‚ é›†ä¸­ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ (CVCS)ï¼šåœ¨ CVCS ä¸­ï¼Œç‰ˆæœ¬æ§åˆ¶æ•°æ®åº“å­˜å‚¨åœ¨ä¸­å¤®æœåŠ¡å™¨ä¸Šã€‚ç”¨æˆ·å¯ä»¥ä»æœåŠ¡å™¨æ£€å‡ºæ–‡ä»¶ã€è¿›è¡Œæ›´æ”¹å¹¶å°†å…¶æäº¤å›æœåŠ¡å™¨ã€‚è¿™å…è®¸å¤šä¸ªç”¨æˆ·åœ¨åŒä¸€é¡¹ç›®ä¸Šè¿›è¡Œåä½œï¼Œå¹¶æä¾›å¯¹å­˜å‚¨åº“çš„é›†ä¸­æ§åˆ¶ã€‚ç„¶è€Œï¼ŒCVCS çš„ä¸€ä¸ªç¼ºç‚¹æ˜¯ï¼Œå¦‚æœä¸­å¤®æœåŠ¡å™¨å‡ºç°æ•…éšœï¼Œåä½œè€…å°†æ— æ³•æ‰§è¡ŒæŸäº›æ“ä½œï¼Œç›´åˆ°æœåŠ¡å™¨æ¢å¤ä¸ºæ­¢ã€‚ åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ (DVCS)ï¼šåœ¨ DVCS ä¸­ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªåŒ…å«æ•´ä¸ªç‰ˆæœ¬å†å²è®°å½•çš„æœ¬åœ°å­˜å‚¨åº“ã€‚è¿™æ„å‘³ç€æ¯ä¸ªç”¨æˆ·éƒ½æ‹¥æœ‰é¡¹ç›®å­˜å‚¨åº“çš„å®Œæ•´å‰¯æœ¬ï¼ŒåŒ…æ‹¬æ‰€æœ‰åˆ†æ”¯å’Œä¿®è®¢ã€‚ç”¨æˆ·å¯ä»¥åœ¨æœ¬åœ°å­˜å‚¨åº“ä¸Šç‹¬ç«‹å·¥ä½œï¼Œå¹¶ä¸å…¶ä»–å­˜å‚¨åº“åŒæ­¥æ›´æ”¹ã€‚ DVCS ä¸ºåˆ†å¸ƒå¼å’Œåˆ†æ•£å¼å·¥ä½œæµç¨‹æä¾›æ›´å¥½çš„æ”¯æŒï¼Œå…è®¸ç”¨æˆ·ç¦»çº¿å·¥ä½œå¹¶æ›´æœ‰æ•ˆåœ°åä½œã€‚ 2. Git ä¸­çš„ Origin æ˜¯ä»€ä¹ˆï¼Ÿ åœ¨ Git ä¸­ï¼Œâ€œoriginâ€æ˜¯æŒ‡æˆ‘ä»¬ä»ä¸­å…‹éš†çš„è¿œç¨‹å­˜å‚¨åº“ã€‚å½“æˆ‘ä»¬ä»è¿œç¨‹æœåŠ¡å™¨å…‹éš†å­˜å‚¨åº“æ—¶ï¼ŒGit ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªåä¸ºâ€œoriginâ€çš„è¿œç¨‹å¼•ç”¨ï¼Œè¯¥å¼•ç”¨æŒ‡å‘åŸå§‹è¿œç¨‹å­˜å‚¨åº“ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬å…‹éš†å­˜å‚¨åº“æ—¶ï¼ŒGit ä¼šè®¾ç½®â€œæ¥æºâ€å¹¶å°†å…¶ä¸æˆ‘ä»¬å…‹éš†çš„åŸå§‹å­˜å‚¨åº“å…³è”èµ·æ¥ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿è¡Œå‘½ä»¤â€œgit remote -vâ€æ¥éªŒè¯è¿™ä¸€ç‚¹ã€‚æ­¤å‘½ä»¤æ˜¾ç¤ºä¸æœ¬åœ°å­˜å‚¨åº“å…³è”çš„è¿œç¨‹å­˜å‚¨åº“åˆ—è¡¨åŠå…¶ URLã€‚\ngit remote -v origin https://github.com/lokeshgupta1981/Spring-Boot3-Demos.git (fetch) origin https://github.com/lokeshgupta1981/Spring-Boot3-Demos.git (push) è¯·æ³¨æ„ï¼Œâ€œoriginâ€åªæ˜¯ä¸€ä¸ªæœªç¡¬ç¼–ç çš„åˆ«åï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æç¤ºç¬¦è¿›è¡Œæ›´æ”¹ï¼š\ngit remote rename origin newName 3.æˆ‘ä»¬å¦‚ä½•åœ¨ Git ä¸­é…ç½®å…¨å±€ç”¨æˆ·åå’Œç”µå­é‚®ä»¶ï¼Ÿ è®¾ç½®å…¨å±€ä¸€è‡´çš„ç”¨æˆ·åå’Œç”µå­é‚®ä»¶åœ°å€éå¸¸é‡è¦ï¼Œå› ä¸º Git ä½¿ç”¨æ­¤ä¿¡æ¯å°†æäº¤ä¸æ­£ç¡®çš„ä½œè€…å…³è”èµ·æ¥ã€‚å®ƒæœ‰åŠ©äºè¯†åˆ«æ¯ä¸ªæäº¤çš„äººå‘˜ï¼Œå¹¶å…è®¸åœ¨é¡¹ç›®å†…è¿›è¡Œé€‚å½“çš„åä½œå’Œå½’å±ã€‚\nè¦åœ¨ Git ä¸­é…ç½®å…¨å±€ç”¨æˆ·åå’Œç”µå­é‚®ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š\ngit config --global user.name \u0026#34;MyName\u0026#34; git config --global user.email \u0026#34;myname@gmail.com\u0026#34; è¿™äº›å‘½ä»¤å°†å…¨å±€è®¾ç½®ç”¨æˆ·åå’Œç”µå­é‚®ä»¶ï¼Œè¿™æ„å‘³ç€å®ƒä»¬å°†ç”¨äºæ‚¨è®¡ç®—æœºä¸Šçš„æ‰€æœ‰ Git å­˜å‚¨åº“ï¼Œé™¤éåœ¨å­˜å‚¨åº“çº§åˆ«è¦†ç›–ã€‚\næ‚¨å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥éªŒè¯æ›´æ”¹ã€‚è¿™äº›å‘½ä»¤å°†åˆ†åˆ«æ˜¾ç¤ºé…ç½®çš„ç”¨æˆ·åå’Œç”µå­é‚®ä»¶ã€‚\ngit config --global user.name # Prints \u0026#39;lokeshgupta1981\u0026#39; git config --global user.email # Prints \u0026#39;howtodoinjava@gmail.com\u0026#39; 4. Git ä¸­çš„â€œæš‚å­˜åŒºâ€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ Git ä¸­çš„â€œæš‚å­˜åŒºåŸŸâ€ä¹Ÿç§°ä¸ºâ€œç´¢å¼•â€ï¼Œæ˜¯ä¸€ä¸ªä¸­é—´åŒºåŸŸï¼Œåœ¨å°†æ–‡ä»¶æäº¤åˆ° Git å­˜å‚¨åº“ä¹‹å‰ï¼Œåœ¨æ­¤åŒºåŸŸå‡†å¤‡å¯¹æ–‡ä»¶çš„æ›´æ”¹ã€‚\nå½“æˆ‘ä»¬å¯¹é¡¹ç›®æ–‡ä»¶è¿›è¡Œæ›´æ”¹æ—¶ï¼ŒGit æä¾›äº†ä¸€ä¸ªä¸¤æ­¥è¿‡ç¨‹æ¥æäº¤è¿™äº›æ›´æ”¹ã€‚æš‚å­˜åŒºåŸŸå……å½“å·¥ä½œç›®å½•ï¼ˆè¿›è¡Œä¿®æ”¹çš„ä½ç½®ï¼‰å’Œå­˜å‚¨åº“ï¼ˆå­˜å‚¨æäº¤çš„ä½ç½® =\u0026gt; .git æ–‡ä»¶å¤¹ï¼‰ä¹‹é—´çš„æ¡¥æ¢ã€‚\né€šè¿‡ä½¿ç”¨æš‚å­˜åŒºï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸ç›¸å…³çš„æ›´æ”¹åˆ†ç¦»åˆ°å¤šä¸ªæäº¤ä¸­ï¼Œæˆ–è€…æœ‰é€‰æ‹©åœ°åŒ…å«ç‰¹å®šä¿®æ”¹è€Œæ’é™¤å…¶ä»–ä¿®æ”¹ã€‚å®ƒæä¾›äº†ä¸€ä¸ªåœ¨å˜æ›´æˆä¸ºé¡¹ç›®å†å²çš„ä¸€éƒ¨åˆ†ä¹‹å‰å®¡æŸ¥å’Œå®Œå–„æˆ‘ä»¬çš„å˜æ›´çš„æœºä¼šã€‚\n5. Git ä¸­çš„åˆ†å‰ã€åˆ†æ”¯å’Œå…‹éš†ä¹‹é—´çš„åŒºåˆ«ï¼Ÿ åˆ†å‰ã€åˆ†æ”¯å’Œå…‹éš†éƒ½æ˜¯ Git æ“ä½œï¼Œåœ¨ç‰ˆæœ¬æ§åˆ¶å·¥ä½œæµç¨‹ä¸­å…·æœ‰ä¸åŒçš„ç”¨é€”ã€‚åœ¨æ·±å…¥ç ”ç©¶ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆå¯¹å®ƒä»¬è¿›è¡Œæ¯”è¾ƒã€‚\nä»¥ä¸‹æ˜¯ Git ä¸­åˆ†å‰ã€åˆ†æ”¯å’Œå…‹éš†çš„è¡¨æ ¼æ¯”è¾ƒï¼š\nç‰¹å¾ åˆ†å‰ åˆ†æ å…‹éš† ç›®çš„ åœ¨æ‚¨çš„ GitHub å¸æˆ·ä¸Šåˆ›å»ºè¿œç¨‹å­˜å‚¨åº“çš„å‰¯æœ¬ã€‚ åœ¨ Git å­˜å‚¨åº“ä¸­åˆ›å»ºå•ç‹¬çš„å¼€å‘çº¿ã€‚ åœ¨æ‚¨çš„è®¡ç®—æœºä¸Šåˆ›å»º Git å­˜å‚¨åº“çš„æœ¬åœ°å‰¯æœ¬ã€‚ æ‰€æœ‰æƒ åˆ›å»ºä¸€ä¸ªç”±æ‚¨æ‹¥æœ‰çš„å®Œå…¨ç‹¬ç«‹çš„å­˜å‚¨åº“ã€‚ åœ¨åŒä¸€å­˜å‚¨åº“ä¸­ï¼Œåˆ†æ”¯å½’åŸå§‹å­˜å‚¨åº“æ‰€æœ‰ã€‚ æœ¬åœ°å‰¯æœ¬ï¼›æ‰€æœ‰æƒæ²¡æœ‰å˜åŒ–ã€‚ èµ·æº æºè‡ªè¿œç¨‹å­˜å‚¨åº“ï¼Œé€šå¸¸ä½äº GitHub ä¸Šã€‚ æºè‡ªç°æœ‰çš„æœ¬åœ°æˆ–è¿œç¨‹å­˜å‚¨åº“ã€‚ æºè‡ªç°æœ‰çš„è¿œç¨‹æˆ–æœ¬åœ°å­˜å‚¨åº“ã€‚ æ”¹å˜å¯è§æ€§ åœ¨åˆ›å»ºæ‹‰å–è¯·æ±‚ä¹‹å‰ï¼Œåœ¨åˆ†å‰ä¸­æ‰€åšçš„æ›´æ”¹ç‹¬ç«‹äºåŸå§‹å­˜å‚¨åº“ã€‚ åœ¨åˆ†æ”¯ä¸­æ‰€åšçš„æ›´æ”¹å°†è¢«éš”ç¦»ï¼Œç›´åˆ°æ‚¨å°†å®ƒä»¬åˆå¹¶å›ä¸»åˆ†æ”¯ã€‚ åœ¨å°†æ›´æ”¹æ¨é€åˆ°è¿œç¨‹å­˜å‚¨åº“ä¹‹å‰ï¼Œæ›´æ”¹éƒ½æ˜¯æœ¬åœ°çš„ã€‚ ç”¨ä¾‹ é€šå¸¸ç”¨äºä¸ºå¼€æºé¡¹ç›®åšå‡ºè´¡çŒ®æˆ–åˆ›å»ºå•ç‹¬çš„å‰¯æœ¬ä¾›ä¸ªäººä½¿ç”¨ã€‚ ç”¨äºåä½œç¯å¢ƒä¸­çš„åŠŸèƒ½å¼€å‘ã€é”™è¯¯ä¿®å¤å’Œéš”ç¦»æ›´æ”¹ã€‚ ç”¨äºå¤„ç†å­˜å‚¨åº“çš„æœ¬åœ°å‰¯æœ¬ï¼Œé€šå¸¸ç”¨äºä¸ªäººå¼€å‘ã€‚ åˆ†å‰ åˆ†å‰æ˜¯ä¸€ä¸ªä¸è¿œç¨‹å­˜å‚¨åº“ç›¸å…³çš„æ¦‚å¿µï¼Œç‰¹åˆ«æ˜¯åœ¨ GitHubã€GitLab å’Œ Bitbucket ç­‰å¹³å°ä¸Šã€‚åˆ†å‰åœ¨æˆ‘ä»¬è‡ªå·±çš„å¸æˆ·ä¸­åˆ›å»ºåŸå§‹å­˜å‚¨åº“çš„å‰¯æœ¬ã€‚\nè¦åœ¨ GitHubï¼ˆæˆ–ç±»ä¼¼å¹³å°ï¼‰ä¸Šåˆ†å‰å­˜å‚¨åº“ï¼Œé€šå¸¸åœ¨å­˜å‚¨åº“é¡µé¢ä¸Šæœ‰ä¸€ä¸ªâ€œåˆ†å‰â€æŒ‰é’®ã€‚å•å‡»æ­¤æŒ‰é’®å°†åœ¨æ‚¨çš„ GitHub å¸æˆ·ä¸­åˆ›å»ºåŸå§‹å­˜å‚¨åº“çš„åˆ†æ”¯ã€‚\nå½“æˆ‘ä»¬æƒ³è¦ä¸ºå¼€æºé¡¹ç›®åšå‡ºè´¡çŒ®æˆ–åˆ›å»ºæˆ‘ä»¬è‡ªå·±çš„ç‹¬ç«‹é¡¹ç›®ç‰ˆæœ¬æ—¶ï¼Œé€šå¸¸ä¼šä½¿ç”¨åˆ†å‰ã€‚åˆ†å‰å­˜å‚¨åº“ä¸åŸå§‹å­˜å‚¨åº“åˆ†å¼€ï¼Œå…è®¸æˆ‘ä»¬è¿›è¡Œæ›´æ”¹ã€å®éªŒå’Œæäº¤æ‹‰å–è¯·æ±‚ï¼Œè€Œä¸ä¼šå½±å“åŸå§‹é¡¹ç›®ã€‚\nåˆ†æ åˆ†æ”¯å…è®¸åœ¨å­˜å‚¨åº“ä¸­åˆ›å»ºå•ç‹¬çš„å¼€å‘çº¿ã€‚å®ƒä½¿æˆ‘ä»¬èƒ½å¤Ÿå½¼æ­¤ç‹¬ç«‹åœ°å¤„ç†ä¸åŒçš„åŠŸèƒ½ã€é”™è¯¯ä¿®å¤æˆ–å®éªŒã€‚\nè¦åœ¨ Git ä¸­åˆ›å»ºåˆ†æ”¯ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š\ngit branch \u0026lt;branch_name\u0026gt; é€šè¿‡åˆ›å»ºåˆ†æ”¯ï¼Œæˆ‘ä»¬å®è´¨ä¸Šåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„æ—¶é—´çº¿ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸å½±å“ä¸»åˆ†æ”¯ï¼ˆé€šå¸¸ç§°ä¸ºâ€œmasterâ€æˆ–â€œmainâ€ï¼‰çš„æƒ…å†µä¸‹è¿›è¡Œæ›´æ”¹ã€‚ä¸€æ—¦æˆ‘ä»¬å¯¹åˆ†æ”¯ä¸­æ‰€åšçš„æ›´æ”¹æ„Ÿåˆ°æ»¡æ„ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†åˆ†æ”¯åˆå¹¶å›ä¸»åˆ†æ”¯ä»¥åˆå¹¶æ›´æ”¹ã€‚\nåˆ†æ”¯æ˜¯åä½œå¼€å‘çš„å¼ºå¤§å·¥å…·ï¼Œä½¿å¤šä¸ªå¼€å‘äººå‘˜èƒ½å¤ŸåŒæ—¶å¤„ç†ä¸åŒçš„ä»»åŠ¡ï¼ŒåŒæ—¶ä¿æŒå¹²å‡€ä¸”æœ‰ç»„ç»‡çš„æäº¤å†å²è®°å½•ã€‚\nå…‹éš† å…‹éš†åˆ›å»ºè¿œç¨‹å­˜å‚¨åº“çš„æœ¬åœ°å‰¯æœ¬ã€‚å½“æˆ‘ä»¬å…‹éš†å­˜å‚¨åº“æ—¶ï¼Œæˆ‘ä»¬ä¼šå°†æ•´ä¸ªé¡¹ç›®çš„å†å²è®°å½•ã€æ–‡ä»¶å’Œåˆ†æ”¯ä¸‹è½½åˆ°æœ¬åœ°è®¡ç®—æœºã€‚\nè¦å°†è¿œç¨‹å­˜å‚¨åº“å…‹éš†åˆ°æœ¬åœ°è®¡ç®—æœºï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š\ngit clone \u0026lt;repository_url\u0026gt; å…‹éš†åœ¨æœ¬åœ°å­˜å‚¨åº“å’Œè¿œç¨‹å­˜å‚¨åº“ä¹‹é—´å»ºç«‹è¿æ¥ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿè·å–æ›´æ–°ã€æ¨é€æ›´æ”¹ä»¥åŠä¸å…¶ä»–äººåä½œã€‚å½“æˆ‘ä»¬æƒ³è¦å¼€å§‹ä½¿ç”¨ç°æœ‰å­˜å‚¨åº“æ—¶ï¼Œé€šå¸¸ä¼šè¿›è¡Œå…‹éš†ã€‚\n6. ä»€ä¹ˆæ˜¯ Git Stashï¼Ÿ åœ¨ Git ä¸­ï¼Œâ€œå­˜å‚¨â€åŠŸèƒ½å…è®¸æˆ‘ä»¬ä¸´æ—¶ä¿å­˜å¯¹å·¥ä½œç›®å½•æ‰€åšçš„æ›´æ”¹ï¼Œè€Œæ— éœ€æäº¤å®ƒä»¬ã€‚å®ƒæä¾›äº†ä¸€ç§å­˜å‚¨æˆ‘ä»¬çš„ä¿®æ”¹å¹¶åˆ‡æ¢åˆ°ä¸åŒåˆ†æ”¯æˆ–åº”ç”¨å…¶ä»–æ“ä½œçš„æ–¹æ³•ï¼Œè€Œæ— éœ€æäº¤ä¸å®Œæ•´æˆ–å®éªŒæ€§æ›´æ”¹ã€‚\nå­˜å‚¨å­˜å‚¨åœ¨æœ¬åœ°ï¼Œä¸ä¼šæ¨é€åˆ°è¿œç¨‹å­˜å‚¨åº“ï¼Œè¿™ä½¿å¾—å®ƒä»¬é€‚åˆä¸ªäººå·¥ä½œæµç¨‹ç»„ç»‡å’Œå®éªŒã€‚\ngit stash å‘½ä»¤ç”¨äºåˆ›å»ºå’Œç®¡ç†å­˜å‚¨ã€‚ä»¥ä¸‹æ˜¯ä¸ Git stash ç›¸å…³çš„ä¸€äº›å¸¸è§ç”¨ä¾‹å’Œå‘½ä»¤ï¼š\nCreating a stash git stash save \u0026#34;Stash message\u0026#34; æ­¤å‘½ä»¤å°†æˆ‘ä»¬çš„ä¿®æ”¹ä¿å­˜åœ¨æ–°çš„å­˜å‚¨ä¸­ï¼Œå¹¶å¸¦æœ‰æè¿°å­˜å‚¨çš„å¯é€‰æ¶ˆæ¯ã€‚ Git å°†ä»æˆ‘ä»¬çš„å·¥ä½œç›®å½•ä¸­æ¢å¤æ›´æ”¹ï¼Œä½¿å…¶ä¿æŒå¹²å‡€ã€‚\nViewing stashes git stash list æ­¤å‘½ä»¤æ˜¾ç¤ºæ‚¨å·²åˆ›å»ºçš„å­˜å‚¨çš„åˆ—è¡¨ï¼Œä»¥åŠå®ƒä»¬çš„å­˜å‚¨å¼•ç”¨å’Œæ¶ˆæ¯ã€‚\nApplying a stash git stash apply stash@{n} // n in [0.....P] æ­¤å‘½ä»¤å°†ç‰¹å®šå­˜å‚¨ä¸­çš„æ›´æ”¹åº”ç”¨åˆ°å½“å‰åˆ†æ”¯ã€‚ stash@{n} æŒ‡çš„æ˜¯åˆ—è¡¨ä¸­çš„å­˜å‚¨å¼•ç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒé€‚ç”¨äºæœ€æ–°çš„å­˜å‚¨ã€‚\nApplying and removing a stash git stash pop stash@{n} æ­¤å‘½ä»¤åº”ç”¨ç‰¹å®šå­˜å‚¨ä¸­çš„æ›´æ”¹ï¼Œå¹¶ä¸€æ­¥å°†å…¶ä»å­˜å‚¨åˆ—è¡¨ä¸­åˆ é™¤ã€‚å®ƒç›¸å½“äºåº”ç”¨å­˜å‚¨ç„¶åä½¿ç”¨ git stash drop å°†å…¶åˆ é™¤ã€‚\nApplying a stash to a different branch git stash branch branch-name stash@{n} æ­¤å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯ ( new-branch-name ) å¹¶å°†ç‰¹å®šå­˜å‚¨ä¸­çš„æ›´æ”¹åº”ç”¨åˆ°è¯¥åˆ†æ”¯ã€‚è¿™æ˜¯åˆ‡æ¢åˆ°æ–°åˆ†æ”¯å¹¶ä¸€æ­¥åº”ç”¨éšè—çš„æ›´æ”¹çš„ä¾¿æ·æ–¹æ³•ã€‚\nDiscarding a stash git stash drop stash@{n} æ­¤å‘½ä»¤ä»å­˜å‚¨åˆ—è¡¨ä¸­åˆ é™¤ç‰¹å®šå­˜å‚¨ï¼Œè€Œä¸åº”ç”¨å…¶æ›´æ”¹ã€‚\nå½“æˆ‘ä»¬æ­£åœ¨å¤„ç†æŸä»¶äº‹ä½†éœ€è¦åˆ‡æ¢åˆ°ä¸åŒçš„ä»»åŠ¡æˆ–åˆ†æ”¯æ—¶ï¼ŒGit stash éå¸¸æœ‰ç”¨ã€‚å®ƒå…è®¸æˆ‘ä»¬æš‚æ—¶ä¿å­˜æ›´æ”¹ã€åˆ‡æ¢ä¸Šä¸‹æ–‡ï¼Œç„¶åè¿”å›åˆ°ä¿å­˜çš„çŠ¶æ€ä»¥ç»§ç»­æˆ‘ä»¬ä¸Šæ¬¡ä¸­æ–­çš„åœ°æ–¹ã€‚\n7. â€˜git fetchâ€™ å’Œ â€˜git pullâ€™ æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ git fetch å’Œ git pull éƒ½ç”¨äºä»è¿œç¨‹å­˜å‚¨åº“è·å–æ›´æ”¹å¹¶å°†å…¶åˆå¹¶åˆ°æœ¬åœ°å­˜å‚¨åº“ä¸­ã€‚ç„¶è€Œï¼Œå®ƒä»¬åœ¨å¤„ç†è·å–çš„æ›´æ”¹å’Œæ›´æ–°æœ¬åœ°åˆ†æ”¯çš„æ–¹å¼ä¸Šæœ‰æ‰€ä¸åŒã€‚\nä»¥ä¸‹æ˜¯ git fetch å’Œ git pull ä¹‹é—´çš„ä¸»è¦åŒºåˆ«ï¼š\ngit fetch git è·å– ä»è¿œç¨‹å­˜å‚¨åº“æ£€ç´¢æœ€æ–°æ›´æ”¹ï¼ŒåŒ…æ‹¬æ–°åˆ†æ”¯ã€æäº¤å’Œæ ‡ç­¾ï¼Œè€Œä¸è‡ªåŠ¨å°†å®ƒä»¬åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ä¸­ã€‚ æ›´æ–°è¿œç¨‹è·Ÿè¸ªåˆ†æ”¯ï¼ˆä¾‹å¦‚ origin/master ï¼‰ä»¥åæ˜ è¿œç¨‹å­˜å‚¨åº“çš„çŠ¶æ€ã€‚ ä¸ä¿®æ”¹æ‚¨çš„æœ¬åœ°åˆ†æ”¯æˆ–å·¥ä½œç›®å½•ã€‚ å…è®¸æˆ‘ä»¬åœ¨æ‰‹åŠ¨åˆå¹¶ä¹‹å‰æ£€æŸ¥å’Œå®¡æŸ¥è·å–çš„æ›´æ”¹ï¼Œä»è€Œæä¾›å†³å®šå¦‚ä½•é›†æˆæ›´æ”¹çš„æœºä¼šã€‚ è¦ä»è¿œç¨‹å­˜å‚¨åº“è·å–æœ€æ–°æ›´æ”¹ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š\ngit fetch origin git pull æ‰§è¡Œ git fetch ï¼Œç„¶åå°†è·å–çš„æ›´æ”¹è‡ªåŠ¨åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ä¸­ã€‚ æ›´æ–°è¿œç¨‹è·Ÿè¸ªåˆ†æ”¯å’Œæœ¬åœ°åˆ†æ”¯ï¼Œåˆå¹¶è·å–çš„æ›´æ”¹ã€‚ å¦‚æœå½“å‰åˆ†æ”¯æœ‰æœ¬åœ°ä¿®æ”¹ï¼Œ git pull ä¼šå°è¯•è‡ªåŠ¨åˆå¹¶æ›´æ”¹ã€‚å¦‚æœå­˜åœ¨å†²çªï¼Œåˆ™éœ€è¦æ‰‹åŠ¨è§£å†³ã€‚ è‡ªåŠ¨æ›´æ–°æ‚¨çš„å·¥ä½œç›®å½•ä»¥åæ˜ åˆå¹¶çš„æ›´æ”¹ã€‚ è¦ä»è¿œç¨‹å­˜å‚¨åº“ä¸­æå–æœ€æ–°æ›´æ”¹ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š\ngit pull git fetch å’Œ git pull ä¹‹é—´çš„é€‰æ‹©å–å†³äºæˆ‘ä»¬çš„å·¥ä½œæµç¨‹ä»¥åŠæˆ‘ä»¬æƒ³è¦å¯¹é›†æˆæ›´æ”¹è¿›è¡Œæ§åˆ¶çš„çº§åˆ«ã€‚\nå¦‚æœæˆ‘ä»¬æƒ³åœ¨åˆå¹¶ä¹‹å‰æŸ¥çœ‹æ›´æ”¹å¹¶å¯¹é›†æˆè¿‡ç¨‹æœ‰æ›´å¤šçš„æ§åˆ¶ï¼Œ git fetch æ˜¯åˆé€‚çš„ã€‚ å¦‚æœæˆ‘ä»¬æ›´å–œæ¬¢æ›´è‡ªåŠ¨åŒ–çš„æ–¹æ³•å¹¶ä¸”å¯¹è‡ªåŠ¨åˆå¹¶æ›´æ”¹æœ‰ä¿¡å¿ƒï¼Œ git pull å¯èƒ½ä¼šæ›´æ–¹ä¾¿ã€‚ 8. è§£é‡Šä¸€ä¸‹ Git checkoutã€rebase å’Œ mergeï¼Ÿ è¿™æ˜¯ Git ä¸­çš„ä¸‰ä¸ªé‡è¦å‘½ä»¤ï¼Œç”¨äºç®¡ç†åˆ†æ”¯å¹¶å°†æ›´æ”¹ä»ä¸€ä¸ªåˆ†æ”¯åˆå¹¶åˆ°å¦ä¸€ä¸ªåˆ†æ”¯ã€‚\ngit å‘½ä»¤ ç›®çš„ å¸¸è§ç”¨ä¾‹ checkout åˆ‡æ¢åˆ°ä¸åŒçš„åˆ†æ”¯æˆ–æäº¤ï¼Œä½¿å…¶æˆä¸ºå½“å‰å·¥ä½œåˆ†æ”¯/æäº¤ã€‚ â€“ åˆ†æ”¯çš„åˆ›å»ºå’Œåˆ‡æ¢ - æ£€æŸ¥ç‰¹å®šæäº¤ä»¥è¿›è¡Œæ£€æŸ¥æˆ–æµ‹è¯• rebase å°†æ›´æ”¹ä»ä¸€ä¸ªåˆ†æ”¯é‡æ–°åº”ç”¨åˆ°å¦ä¸€åˆ†æ”¯ã€‚é€šå¸¸ç”¨äºç»´æŠ¤çº¿æ€§æäº¤å†å²è®°å½•ã€‚ â€“ å°†åŠŸèƒ½åˆ†æ”¯é›†æˆåˆ°ä¸»åˆ†æ”¯ä¸­ â€“ ç»´æŠ¤å¹²å‡€ã€çº¿æ€§çš„æäº¤å†å²è®°å½• merge å°†ä¸€ä¸ªåˆ†æ”¯çš„æ›´æ”¹åˆå¹¶åˆ°å¦ä¸€ä¸ªåˆ†æ”¯ã€‚ä¿ç•™æäº¤ï¼Œåˆ›å»ºåˆå¹¶æäº¤ã€‚ â€“ å°†åŠŸèƒ½åˆ†æ”¯é›†æˆåˆ°ä¸»åˆ†æ”¯ä¸­ â€“ åˆå¹¶å¤šä¸ªè´¡çŒ®è€…çš„æ›´æ”¹ è®©æˆ‘ä»¬é€ä¸€è§£é‡Šä¸€ä¸‹ï¼š\ngit checkout git checkout ç”¨äºåœ¨é¡¹ç›®çš„ä¸åŒåˆ†æ”¯æˆ–ç‰ˆæœ¬ä¹‹é—´åˆ‡æ¢ã€‚\nè¦åˆ‡æ¢åˆ°å¦ä¸€ä¸ªåˆ†æ”¯ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š\ngit checkout \u0026lt;branch-name\u0026gt; å½“æ‚¨è¿è¡Œ git checkout \u0026lt;branch-name\u0026gt; æ—¶ï¼Œå®ƒä¼šæ›´æ–°æ‚¨çš„å·¥ä½œç›®å½•ä»¥åŒ¹é…æŒ‡å®šåˆ†æ”¯çš„å†…å®¹ã€‚ æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ git checkout åˆ‡æ¢åˆ°ç‰¹å®šçš„æäº¤æˆ–æ ‡è®°ï¼Œä»è€Œå…è®¸æ‚¨æŸ¥çœ‹å†å²è®°å½•ä¸­ç‰¹å®šçŠ¶æ€çš„é¡¹ç›®ã€‚ æ­¤å¤–ï¼Œ git checkout -b \u0026lt;new-branch-name\u0026gt; åˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯å¹¶åœ¨å•ä¸ªå‘½ä»¤ä¸­åˆ‡æ¢åˆ°å®ƒã€‚ git rebase git rebase ç”¨äºå°†ä¸€ä¸ªåˆ†æ”¯çš„æ›´æ”¹é›†æˆåˆ°å¦ä¸€ä¸ªåˆ†æ”¯ï¼Œé€šå¸¸ç”¨äºå°†åŠŸèƒ½åˆ†æ”¯çš„æ›´æ”¹åˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¸­ã€‚\nå‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªåˆ†æ”¯ï¼šæºåˆ†æ”¯ï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œfeatureâ€ï¼‰å’Œç›®æ ‡åˆ†æ”¯ï¼ˆé€šå¸¸æ˜¯â€œmasterâ€æˆ–â€œmainâ€ï¼‰ã€‚ â€œfeatureâ€åˆ†æ”¯åŒ…å«ä¸€äº›æ›´æ”¹ï¼Œæˆ‘ä»¬å¸Œæœ›å°†è¿™äº›æ›´æ”¹åˆå¹¶åˆ°â€œmasterâ€åˆ†æ”¯ä¸­ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸æƒ³æ‰§è¡Œæ ‡å‡†åˆå¹¶ï¼Œå› ä¸ºæˆ‘ä»¬æƒ³ç»´æŠ¤çº¿æ€§æäº¤å†å²è®°å½•ã€‚\né¦–å…ˆï¼Œæ‚¨éœ€è¦ç¡®ä¿æ‚¨ä½äºç›®æ ‡åˆ†æ”¯ï¼ˆgit checkout masterï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒå°†æ˜¯ masterï¼Œç„¶åï¼Œå¯åŠ¨ rebase å‘½ä»¤ï¼ŒæŒ‡å®šè¦ rebase åˆ°å½“å‰åˆ†æ”¯ï¼ˆç›®æ ‡åˆ†æ”¯ï¼‰çš„æºåˆ†æ”¯ã€‚\ngit rebase feature å½“æ‚¨è¿è¡Œ git rebase \u0026lt;target-branch\u0026gt; æ—¶ï¼ŒGit ä¼šè¯†åˆ«å½“å‰åˆ†æ”¯å’Œç›®æ ‡åˆ†æ”¯çš„å…±åŒç¥–å…ˆï¼Œç„¶åå°†å½“å‰åˆ†æ”¯çš„æäº¤é‡æ–°åº”ç”¨åˆ°ç›®æ ‡åˆ†æ”¯ä¹‹ä¸Šã€‚ Rebase é€šè¿‡æŒ‰é¡ºåºæ”¾ç½®æäº¤æ¥å…è®¸çº¿æ€§å†å²è®°å½•ï¼Œä½¿å…¶çœ‹èµ·æ¥å¥½åƒæ›´æ”¹æ˜¯ç›´æ¥åœ¨ç›®æ ‡åˆ†æ”¯ä¹‹ä¸Šè¿›è¡Œçš„ã€‚ è¿™å¯ä»¥å¸®åŠ©ç»´æŠ¤å¹²å‡€çš„æäº¤å†å²è®°å½•ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†é•¿æœŸå­˜åœ¨çš„åŠŸèƒ½åˆ†æ”¯æ—¶ã€‚ git merge git merge å°†ä¸åŒåˆ†æ”¯çš„æ›´æ”¹åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ä¸­ã€‚\nè¦å°†åˆ†æ”¯çš„æ›´æ”¹åˆå¹¶åˆ°ç›®æ ‡åˆ†æ”¯ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼ˆåœ¨ git checkout ä¹‹åï¼‰ï¼š\ngit merge \u0026lt;source-branch\u0026gt; å½“æ‚¨è¿è¡Œ git merge \u0026lt;source-branch\u0026gt; æ—¶ï¼ŒGit ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æäº¤ï¼Œå°†æºåˆ†æ”¯ä¸­çš„æ›´æ”¹åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ä¸­ã€‚ åˆå¹¶æäº¤ä¿ç•™äº†ä¸¤ä¸ªåˆ†æ”¯çš„å†å²è®°å½•ï¼ŒåŒ…æ‹¬å®ƒä»¬åˆ†æ­§çš„ç‚¹ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœå¯èƒ½ï¼ŒGit ä¼šæ‰§è¡Œâ€œå¿«è¿›â€åˆå¹¶ï¼Œè¿™æ„å‘³ç€å®ƒå°†å½“å‰åˆ†æ”¯æŒ‡é’ˆå‘å‰ç§»åŠ¨åˆ°æºåˆ†æ”¯çš„æäº¤ï¼Œè€Œä¸åˆ›å»ºé¢å¤–çš„åˆå¹¶æäº¤ã€‚ ä½†æ˜¯ï¼Œå¦‚æœç”±äºä¸åŒçš„æ›´æ”¹è€Œæ— æ³•è¿›è¡Œå¿«è¿›åˆå¹¶ï¼ŒGit ä¼šæ‰§è¡Œâ€œé€’å½’â€æˆ–â€œéå¿«è¿›â€åˆå¹¶ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„åˆå¹¶æäº¤ã€‚ 9. â€œgitcherry-pickâ€å‘½ä»¤çš„ç”¨é€”æ˜¯ä»€ä¹ˆï¼Ÿ â€œgitcherry-pickâ€å‘½ä»¤ç”¨äºå°†ç‰¹å®šæäº¤ä»ä¸€ä¸ªåˆ†æ”¯åº”ç”¨åˆ°å¦ä¸€ä¸ªåˆ†æ”¯ã€‚å®ƒå…è®¸æˆ‘ä»¬é€‰æ‹©å•ç‹¬çš„æäº¤å¹¶å°†å®ƒä»¬åº”ç”¨åˆ°ä¸åŒçš„åˆ†æ”¯ï¼Œå°†å®ƒä»¬çš„æ›´æ”¹åˆå¹¶åˆ°ç›®æ ‡åˆ†æ”¯ä¸­ã€‚\nä»¥ä¸‹æ˜¯æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨ git cherry-pick å‘½ä»¤ï¼š\nè¯†åˆ«æäº¤ï¼šç¡®å®šè¦åº”ç”¨äºå¦ä¸€ä¸ªåˆ†æ”¯çš„æäº¤ã€‚æ‚¨å¯ä»¥æ‰¾åˆ°æäº¤å“ˆå¸Œæˆ–ä½¿ç”¨å…¶ä»– Git å‘½ä»¤ï¼ˆä¾‹å¦‚ git log æˆ– gitk ï¼‰æ¥å¯è§†åŒ–æäº¤å†å²è®°å½•ã€‚ åˆ‡æ¢åˆ°ç›®æ ‡åˆ†æ”¯ï¼šç¡®ä¿æ‚¨ä½äºè¦åº”ç”¨æ‰€é€‰æäº¤çš„åˆ†æ”¯ä¸Šã€‚æ‚¨å¯ä»¥ä½¿ç”¨ git checkout åˆ‡æ¢åˆ°ç›®æ ‡åˆ†æ”¯ã€‚ è¿è¡Œ git cherry-pick ï¼šæ‰§è¡Œ git cherry-pick å‘½ä»¤ï¼Œåè·Ÿè¦åº”ç”¨çš„æäº¤çš„æäº¤å“ˆå¸Œå€¼ã€‚ä¾‹å¦‚ï¼š git cherry-pick \u0026lt;commit-hash\u0026gt; éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ git cherry-pick ä¼šå¤åˆ¶é€‰å®šçš„æäº¤å¹¶å°†å®ƒä»¬ä½œä¸ºæ–°æäº¤åº”ç”¨åˆ°ç›®æ ‡åˆ†æ”¯ä¸Šã€‚è¿™æ„å‘³ç€æ–°æäº¤å°†å…·æœ‰ä¸åŒçš„æäº¤å“ˆå¸Œå€¼ï¼Œå› ä¸ºå®ƒä»¬æ˜¯å•ç‹¬çš„å‰¯æœ¬ï¼Œè€Œä¸æ˜¯åŸå§‹æäº¤çš„ç›´æ¥ä¼ è¾“ã€‚\n10. è§£é‡Š Git é‡ç½®å’Œæ¢å¤ åœ¨ Git ä¸­ï¼Œé‡ç½®å’Œæ¢å¤æ˜¯æ’¤æ¶ˆæ›´æ”¹çš„ä¸¤ç§ä¸åŒæ–¹æ³•ã€‚å®ƒä»¬ç”¨äºçº æ­£é”™è¯¯ã€æ’¤æ¶ˆæäº¤æˆ–å°†å­˜å‚¨åº“æ¢å¤åˆ°ä»¥å‰çš„çŠ¶æ€ã€‚\nAction Git Reset Git Revert ç›®çš„ å°† HEAD å’Œåˆ†æ”¯æŒ‡é’ˆç§»åŠ¨åˆ°æŒ‡å®šçš„æäº¤ã€‚ åˆ›å»ºä¸€ä¸ªæ–°çš„æäº¤æ¥æ’¤æ¶ˆç‰¹å®šæäº¤æ‰€åšçš„æ›´æ”¹ã€‚ å¸¸è§ç”¨ä¾‹ â€“ åœ¨æ¨é€åˆ°è¿œç¨‹å­˜å‚¨åº“ä¹‹å‰åœ¨æœ¬åœ°æ’¤æ¶ˆæäº¤ â€“ é‡ç»„æäº¤å†å² â€“ ä»æš‚å­˜åŒºåˆ é™¤æ›´æ”¹ â€“ å®‰å…¨æ’¤æ¶ˆæäº¤è€Œä¸æ›´æ”¹æäº¤å†å²è®°å½• â€“ åä½œä»£ç ä¿®æ­£ git reset git reset å°†å½“å‰åˆ†æ”¯æŒ‡é’ˆç§»åŠ¨åˆ°ç‰¹å®šæäº¤ï¼Œä»è€Œæœ‰æ•ˆåœ°å°†åˆ†æ”¯é‡ç½®ä¸ºè¯¥æäº¤ã€‚\n#Let\u0026#39;s say we have a commit history like this: A - B - C - D (master) #To Perform a hard reset to move the branch pointer to commit B, discarding changes in C and D. git reset --hard B å¤ä½å‘½ä»¤æœ‰ä¸‰ç§æ¨¡å¼ï¼šè½¯å¤ä½ã€æ··åˆå¤ä½å’Œç¡¬å¤ä½ã€‚\nè½¯é‡ç½® ( git reset --soft ) å°†åˆ†æ”¯æŒ‡é’ˆç§»åŠ¨åˆ°æŒ‡å®šçš„æäº¤ï¼ŒåŒæ—¶ä¿æŒæš‚å­˜åŒºåŸŸå’Œå·¥ä½œç›®å½•ä¸­çš„æ›´æ”¹ä¸å˜ã€‚å®ƒå…è®¸æ‚¨â€œæ’¤æ¶ˆâ€æäº¤å¹¶æ ¹æ®å…ˆå‰çš„çŠ¶æ€è¿›è¡Œå…¶ä»–ä¿®æ”¹ã€‚ æ··åˆé‡ç½®ï¼ˆé»˜è®¤è¡Œä¸ºï¼Œ git reset --mixed ï¼‰å°†åˆ†æ”¯æŒ‡é’ˆç§»åŠ¨åˆ°æŒ‡å®šçš„æäº¤ï¼Œé‡ç½®æš‚å­˜åŒºåŸŸï¼Œä½†ä¿ç•™å·¥ä½œç›®å½•ä¸­çš„æ›´æ”¹ã€‚å®ƒâ€œå–æ¶ˆæš‚å­˜â€æ›´æ”¹ï¼Œå…è®¸æ‚¨åœ¨æäº¤ä¹‹å‰ä¿®æ”¹å¹¶å†æ¬¡æš‚å­˜å®ƒä»¬ã€‚ ç¡¬é‡ç½® ( git reset --hard ) å°†åˆ†æ”¯æŒ‡é’ˆç§»åŠ¨åˆ°æŒ‡å®šçš„æäº¤ï¼Œä¸¢å¼ƒæš‚å­˜åŒºåŸŸå’Œå·¥ä½œç›®å½•ä¸­çš„ä»»ä½•æ›´æ”¹ã€‚å®ƒå®Œå…¨åˆ é™¤æ›´æ”¹ï¼Œå°†åˆ†æ”¯å’Œæ•´ä¸ªå­˜å‚¨åº“æ¢å¤åˆ°æŒ‡å®šæäº¤çš„çŠ¶æ€ã€‚ git revert git revert åˆ›å»ºä¸€ä¸ªæ–°çš„æäº¤ï¼Œæ’¤æ¶ˆå…ˆå‰æäº¤ä¸­æ‰€åšçš„æ›´æ”¹ã€‚å®ƒæä¾›äº†ä¸€ç§å®‰å…¨çš„æ–¹å¼æ¥æ’¤æ¶ˆæäº¤è€Œä¸æ›´æ”¹æäº¤å†å²è®°å½•ã€‚\ngit revert C # This command will Create a new commit that undoes the changes in commit C. git revert åˆ›å»ºæ–°çš„æäº¤æ¥åè½¬æŒ‡å®šæäº¤å¼•å…¥çš„æ›´æ”¹ï¼Œè€Œä¸æ˜¯ä¿®æ”¹æˆ–åˆ é™¤ç°æœ‰æäº¤ã€‚æ¯ä¸ªæ¢å¤æäº¤éƒ½ä¸“é—¨ç”¨äºæ’¤æ¶ˆç‰¹å®šæäº¤çš„æ›´æ”¹ï¼Œç¡®ä¿æäº¤å†å²è®°å½•ä¿æŒå®Œæ•´ã€‚\n11.â€œ.gitignoreâ€æ–‡ä»¶çš„ç”¨é€”æ˜¯ä»€ä¹ˆï¼Ÿ .gitignore æ–‡ä»¶æŒ‡å®šä¸åº”æäº¤åˆ°å­˜å‚¨åº“çš„æœ‰æ„æœªè·Ÿè¸ªçš„æ–‡ä»¶å’Œç›®å½•ã€‚å®ƒå…è®¸æˆ‘ä»¬å®šä¹‰ Git åœ¨è·Ÿè¸ªæ›´æ”¹å’Œæš‚å­˜æ–‡ä»¶æ—¶åº”å¿½ç•¥çš„æ–‡ä»¶å’Œç›®å½•åç§°æ¨¡å¼ã€‚\nä½¿ç”¨â€œ.gitignoreâ€æ–‡ä»¶çš„ä¸€äº›å¸¸è§ç”¨ä¾‹å’Œå¥½å¤„åŒ…æ‹¬ï¼š\nå¿½ç•¥æ„å»ºå·¥ä»¶ï¼Œä¾‹å¦‚ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€ç›®æ ‡æ–‡ä»¶ã€æ—¥å¿—æ–‡ä»¶æˆ–ä¸´æ—¶æ–‡ä»¶ã€‚ å¿½ç•¥å•ç‹¬ç®¡ç†çš„ä¾èµ–é¡¹æˆ–åº“ã€‚åœ¨å­˜å‚¨åº“ä¸­åŒ…å«è¿™äº›ä¾èµ–é¡¹æ˜¯ä¸å¿…è¦çš„ï¼Œå¹¶ä¸”å¯èƒ½ä¼šå¯¼è‡´å­˜å‚¨åº“è‡ƒè‚¿ã€‚ å¿½ç•¥åŒ…å« API å¯†é’¥ã€æ•°æ®åº“å‡­æ®æˆ–ç‰¹å®šäºç¯å¢ƒçš„è®¾ç½®ç­‰æ•æ„Ÿä¿¡æ¯çš„é…ç½®æ–‡ä»¶ã€‚ å¿½ç•¥ä¸å…¶ä»–å›¢é˜Ÿæˆå‘˜æ— å…³çš„ä¸ªäººå¼€å‘ç¯å¢ƒæ–‡ä»¶ï¼Œä¾‹å¦‚é¡¹ç›®è®¾ç½®ã€ç¼–è¾‘å™¨å¤‡ä»½æ–‡ä»¶æˆ–ç¼“å­˜æ–‡ä»¶ã€‚ ä»¥ä¸‹æ˜¯åŒ…å« 3 ä¸ªæ¡ç›®çš„ .gitignore æ–‡ä»¶çš„ç¤ºä¾‹ï¼š\n# Ignore build artifacts *.exe *.o *.log # Ignore dependency directories /node_modules /vendor # Ignore sensitive configuration files config.ini secrets.json 12. Git reflog å’Œ log æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ git log ä¸»è¦ç”¨äºæŸ¥çœ‹ç‰¹å®šåˆ†æ”¯æˆ–æäº¤çš„æäº¤å†å²è®°å½•ï¼Œè€Œ git reflog æ›´ä¸“æ³¨äºè·Ÿè¸ªæ•´ä¸ªå­˜å‚¨åº“ä¸­çš„å¼•ç”¨ç§»åŠ¨ï¼Œè¿™ä½¿å¾—å®ƒå¯¹äºæ¢å¤å’Œæäº¤ç‰¹åˆ«æœ‰ç”¨ã€‚è°ƒè¯•ç›®çš„ã€‚\næ–¹é¢ git log git reflog ç›®çš„ æ˜¾ç¤ºåˆ†æ”¯çš„æäº¤å†å²è®°å½•ã€‚ æ˜¾ç¤ºå­˜å‚¨åº“çš„å‚è€ƒæ—¥å¿—ã€‚ å¸¸è§ç”¨ä¾‹ â€“ å›é¡¾é¡¹ç›®å†å² â€“æ£€æŸ¥æäº¤æ¶ˆæ¯å’Œéšæ—¶é—´æ‰€åšçš„æ›´æ”¹ã€‚ â€“æ¢å¤ä¸¢å¤±çš„æäº¤æˆ–åˆ†æ”¯ â€“ è°ƒè¯•å’Œäº†è§£å­˜å‚¨åº“ä¸­çš„æ›´æ”¹ã€‚ git log git log å‘½ä»¤æä¾›å­˜å‚¨åº“ä¸­æŒ‰æ—¶é—´é¡ºåºæäº¤çš„åˆ—è¡¨ï¼Œæ˜¾ç¤ºæäº¤å“ˆå¸Œã€ä½œè€…ã€æ—¥æœŸå’Œæäº¤æ¶ˆæ¯ç­‰è¯¦ç»†ä¿¡æ¯ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒæ˜¾ç¤ºå½“å‰åˆ†æ”¯çš„æäº¤å†å²è®°å½•ï¼Œä»æœ€è¿‘çš„æäº¤å¼€å§‹å¹¶æŒ‰æ—¶é—´å€’é€€ã€‚å„ç§é€‰é¡¹å’Œæ ‡å¿—å…è®¸è‡ªå®šä¹‰ï¼Œä¾‹å¦‚æŒ‰ä½œè€…ã€æ—¥æœŸèŒƒå›´æˆ–åˆ†æ”¯è¿›è¡Œè¿‡æ»¤ã€‚\n# To see the commit history for the current branch git log è¦ä»¥ç´§å‡‘çš„ä¸€è¡Œæ ¼å¼æ˜¾ç¤ºæäº¤å†å²è®°å½•ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š\ngit log --oneline git reflog å¦ä¸€æ–¹é¢ï¼Œ git reflog ç»™å‡ºäº†å¼•ç”¨ï¼ˆåˆ†æ”¯æˆ–æ ‡ç­¾ï¼‰æ›´æ–°å’Œä¿®æ”¹æäº¤æŒ‡é’ˆçš„å…¶ä»–æ“ä½œçš„è¯¦ç»†æ—¥å¿—ã€‚\n# To view the reflog for the repository git reflog ä¸ git log ä¸åŒï¼Œå¼•ç”¨æ—¥å¿—è®°å½•å½±å“æäº¤å†å²è®°å½•çš„åˆ†æ”¯ç§»åŠ¨å’Œæ“ä½œï¼Œå³ä½¿ä¸åˆ›å»ºæ–°çš„æäº¤ä¹Ÿæ˜¯å¦‚æ­¤ã€‚å®ƒæ˜¯æ¢å¤ä¸¢å¤±çš„æäº¤æˆ–å¯èƒ½è¢«æ„å¤–åˆ é™¤æˆ–ç§»åŠ¨çš„åˆ†æ”¯çš„å®è´µå·¥å…·ï¼Œåœ¨å‘ç”Ÿé”™è¯¯æˆ–ä¸å¯é¢„è§çš„äº‹ä»¶æ—¶å……å½“å®‰å…¨ç½‘ã€‚\n13.â€œgit bisectâ€å‘½ä»¤çš„ç”¨é€”æ˜¯ä»€ä¹ˆï¼Ÿ git bisect å‘½ä»¤é€šè¿‡æäº¤å†å²è®°å½•æ‰§è¡ŒäºŒåˆ†æœç´¢ï¼Œä»¥è¯†åˆ«å¼•å…¥é”™è¯¯æˆ–å¯¼è‡´å›å½’çš„ç‰¹å®šæäº¤ã€‚å®ƒé€šè¿‡æœ‰æ•ˆåœ°ç¼©å°è¦è°ƒæŸ¥çš„æäº¤èŒƒå›´ï¼Œæœ‰åŠ©äºéš”ç¦»å’ŒæŸ¥æ˜è´Ÿè´£ç‰¹å®šé—®é¢˜çš„æäº¤ã€‚\nä»¥ä¸‹æ˜¯ git bisect å·¥ä½œåŸç†çš„æ¦‚è¿°ï¼š\nè¯†åˆ«å·²çŸ¥çš„å¥½çš„å’Œåçš„æäº¤ï¼šé¦–å…ˆè¯†åˆ«é¡¹ç›®å†å²è®°å½•ä¸­çš„ä¸¤ä¸ªæäº¤ï¼šä¸€ä¸ªä»£è¡¨å·²çŸ¥çš„è‰¯å¥½çŠ¶æ€ï¼ˆä¸å­˜åœ¨é”™è¯¯æˆ–é—®é¢˜çš„æäº¤ï¼‰ï¼Œå¦ä¸€ä¸ªä»£è¡¨å·²çŸ¥çš„åçŠ¶æ€ï¼ˆä¸å­˜åœ¨ bug æˆ–é—®é¢˜çš„æäº¤ï¼‰å­˜åœ¨é”™è¯¯æˆ–é—®é¢˜ï¼‰ã€‚ å¼€å§‹äºŒç­‰åˆ†è¿‡ç¨‹ï¼šä½¿ç”¨ git bisect start å¼€å§‹äºŒç­‰åˆ†è¿‡ç¨‹ã€‚ä½¿ç”¨ git bisect good \u0026lt;commit\u0026gt; æŒ‡å®šå·²çŸ¥è‰¯å¥½çŠ¶æ€çš„æäº¤å“ˆå¸Œï¼Œä½¿ç”¨ git bisect bad \u0026lt;commit\u0026gt; æŒ‡å®šå·²çŸ¥ä¸è‰¯çŠ¶æ€çš„æäº¤å“ˆå¸Œã€‚ Git å°†åœ¨å·²çŸ¥çš„å¥½çŠ¶æ€å’ŒåçŠ¶æ€ä¹‹é—´åˆ›å»ºä¸€ç³»åˆ—æäº¤ã€‚ git bisect start git bisect good \u0026lt;good_commit_hash\u0026gt; git bisect bad \u0026lt;bad_commit_hash\u0026gt; 14. æˆ‘ä»¬å¦‚ä½•åœ¨ Git ä¸­å°†å¤šä¸ªæäº¤å‹ç¼©ä¸ºå•ä¸ªæäº¤ï¼Ÿ ä¸ºäº†åœ¨ Git ä¸­å°†å¤šä¸ªæäº¤å‹ç¼©ä¸ºå•ä¸ªæäº¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨äº¤äº’å¼å˜åŸºåŠŸèƒ½ã€‚ç¡®ä¿æˆ‘ä»¬ä½äºåŒ…å«æˆ‘ä»¬æƒ³è¦å‹ç¼©çš„æäº¤çš„åˆ†æ”¯ä¸Šã€‚\nè¿è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨äº¤äº’å¼å˜åŸºï¼š\ngit rebase -i HEAD~n å°† n æ›¿æ¢ä¸ºæˆ‘ä»¬æƒ³è¦å‹ç¼©çš„æäº¤æ•°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å‹ç¼©æœ€å 3 æ¬¡æäº¤ï¼Œè¯·ä½¿ç”¨ HEAD~3 ã€‚\nå°†æ‰“å¼€ä¸€ä¸ªäº¤äº’å¼æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæ˜¾ç¤ºæˆ‘ä»¬åœ¨ä¸Šä¸€æ­¥ä¸­æŒ‡å®šçš„æäº¤åˆ—è¡¨ã€‚æ¯ä¸ªæäº¤å‰é¢éƒ½ä¼šæœ‰â€œpickâ€ä¸€è¯ã€‚\nè¦å‹ç¼©æäº¤ï¼Œè¯·å°†é™¤ç¬¬ä¸€ä¸ªæäº¤ä¹‹å¤–çš„æ‰€æœ‰æäº¤çš„â€œpickâ€æ›´æ”¹ä¸ºâ€œsquashâ€ï¼ˆæˆ–â€œsâ€ï¼‰ã€‚å°†ç¬¬ä¸€ä¸ªæäº¤ä¿ç•™ä¸ºâ€œpickâ€ï¼Œå› ä¸ºå®ƒå°†æ˜¯ç”Ÿæˆçš„æäº¤æ¶ˆæ¯ã€‚å¦‚æœéœ€è¦ï¼Œæ‚¨è¿˜å¯ä»¥é€šè¿‡ç§»åŠ¨æ–‡æœ¬ç¼–è¾‘å™¨ä¸­çš„è¡Œæ¥é‡æ–°æ’åˆ—æäº¤çš„é¡ºåºã€‚\nä¿å­˜å¹¶é€€å‡ºæ–‡æœ¬ç¼–è¾‘å™¨ã€‚ å°†æ‰“å¼€å¦ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œå…è®¸æ‚¨ä¿®æ”¹æäº¤æ¶ˆæ¯ã€‚æ‚¨å¯ä»¥åˆå¹¶å‹ç¼©æäº¤çš„æäº¤æ¶ˆæ¯æˆ–å†™å…¥æ–°æ¶ˆæ¯ã€‚æ ¹æ®éœ€è¦ç¼–è¾‘æ¶ˆæ¯ï¼Œä¿å­˜å¹¶é€€å‡ºç¼–è¾‘å™¨ã€‚ Git å°†æ‰§è¡Œå˜åŸºï¼Œå°†æäº¤å‹ç¼©ä¸ºå•ä¸ªæäº¤ã€‚ å¦‚æœå˜åŸºæˆåŠŸï¼Œæ‚¨å°†çœ‹åˆ°ä¸€æ¡æ¶ˆæ¯ï¼Œè¡¨æ˜å˜åŸºå·²å®Œæˆã€‚ å¦‚æœå­˜åœ¨ä»»ä½•å†²çªï¼ŒGit å°†åœæ­¢ rebase è¿‡ç¨‹å¹¶å…è®¸æˆ‘ä»¬è§£å†³å®ƒä»¬ã€‚è§£å†³å†²çªåï¼Œä½¿ç”¨ git rebase --continue ç»§ç»­å˜åŸºè¿‡ç¨‹ã€‚ å¦‚æœ‰å¿…è¦ï¼Œå°†æ›´æ”¹æ¨é€åˆ°è¿œç¨‹å­˜å‚¨åº“ã€‚ è­¦å‘Šï¼šå‹ç¼©æäº¤æ—¶è¦å°å¿ƒï¼Œå› ä¸ºå®ƒä¼šé‡å†™å†å²ã€‚å¦‚æœæäº¤å·²ç»è¢«æ¨é€åˆ°å…±äº«å­˜å‚¨åº“å¹¶ä¸”å…¶ä»–äººå·²ç»åŸºäºè¿™äº›æäº¤è¿›è¡Œäº†å·¥ä½œï¼Œé€šå¸¸ä¸å»ºè®®å‹ç¼©å®ƒä»¬ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šå¯¼è‡´å…¶ä»–å›¢é˜Ÿæˆå‘˜å‘ç”Ÿå†²çªã€‚\n15ã€å¦‚ä½•åˆ¤æ–­æŸä¸ªåˆ†æ”¯æ˜¯å¦å·²ç»åˆå¹¶åˆ° Master ä¸­ï¼Ÿ è¦è¯†åˆ«æŸä¸ªåˆ†æ”¯æ˜¯å¦å·²åˆå¹¶åˆ° Git ä¸­çš„ master åˆ†æ”¯ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\ngit checkout master ç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°† \u0026lt;branch_name\u0026gt; æ›¿æ¢ä¸ºæˆ‘ä»¬è¦æ£€æŸ¥çš„åˆ†æ”¯åç§°ï¼š\ngit branch --merged \u0026lt;branch_name\u0026gt; å¦‚æœåˆ†æ”¯å·²åˆå¹¶åˆ° master ä¸­ï¼Œå®ƒå°†å‡ºç°åœ¨è¿è¡Œæ­¤å‘½ä»¤åæ˜¾ç¤ºçš„åˆ†æ”¯åˆ—è¡¨ä¸­ã€‚ å¦‚æœåˆ†æ”¯å°šæœªåˆå¹¶åˆ° master ä¸­ï¼Œå®ƒå°†ä¸ä¼šå‡ºç°åœ¨åˆå¹¶åˆ†æ”¯åˆ—è¡¨ä¸­ã€‚ æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹åˆå¹¶åˆ†æ”¯çš„ç®€æ˜è§†å›¾ï¼š\ngit branch --merged æ­¤å‘½ä»¤å°†åˆ—å‡ºå·²åˆå¹¶åˆ°å½“å‰åˆ†æ”¯çš„æ‰€æœ‰åˆ†æ”¯ï¼Œåœ¨æœ¬ä¾‹ä¸­ä¸º master ã€‚\n16. ä»€ä¹ˆæ˜¯ Git å­˜å‚¨åº“ï¼Ÿå¦‚ä½•åˆå§‹åŒ– Git å­˜å‚¨åº“ï¼Ÿ Git å­˜å‚¨åº“æ˜¯ Git è·Ÿè¸ªå’Œç®¡ç†ä¸€ç»„æ–‡ä»¶å’Œç›®å½•æ›´æ”¹çš„å­˜å‚¨ä½ç½®ã€‚å®ƒåŒ…å«å¯¹æ–‡ä»¶æ‰€åšçš„æ‰€æœ‰æ›´æ”¹çš„å®Œæ•´å†å²è®°å½•ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿè·Ÿè¸ªå’Œæ¢å¤æ›´æ”¹ã€ä¸å…¶ä»–äººåä½œä»¥åŠç»´æŠ¤é¡¹ç›®çš„ä¸åŒç‰ˆæœ¬ã€‚\nè¦åˆå§‹åŒ–ç›®å½•ä¸­çš„ Git å­˜å‚¨åº“ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ git init å‘½ä»¤ã€‚æˆ‘ä»¬æ˜¯è¿™æ ·åšçš„ï¼š\ncd /path/to/your/local-repo-path git init æ­¤å‘½ä»¤åœ¨å½“å‰ç›®å½•ä¸­åˆå§‹åŒ–ä¸€ä¸ªç©ºçš„ Git å­˜å‚¨åº“ã€‚ Git åˆ›å»ºä¸€ä¸ªéšè—çš„ .git ç›®å½•ï¼Œå…¶ä¸­å­˜å‚¨æ‰€æœ‰å­˜å‚¨åº“æ•°æ®ï¼ŒåŒ…æ‹¬æäº¤å†å²è®°å½•å’Œé…ç½®ã€‚\n17. å¦‚ä½•æ˜¾ç¤ºç‰ˆæœ¬åº“çš„å½“å‰çŠ¶æ€ï¼ŒåŒ…æ‹¬ä¿®æ”¹çš„æ–‡ä»¶å’Œåˆ†æ”¯ä¿¡æ¯ï¼Ÿ è¦æ˜¾ç¤ºå­˜å‚¨åº“çš„å½“å‰çŠ¶æ€ï¼ŒåŒ…æ‹¬ä¿®æ”¹çš„æ–‡ä»¶å’Œåˆ†æ”¯ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ git status å‘½ä»¤ã€‚\ngit status # Sample Output Changes not staged for commit: (use \u0026#34;git add \u0026lt;file\u0026gt;...\u0026#34; to update what will be committed) (use \u0026#34;git restore \u0026lt;file\u0026gt;...\u0026#34; to discard changes in working directory) modified: spring-boot-actuator-example/pom.xml modified: spring-boot-actuator-example/src/main/java/com/howtodoinjava/demo/SimpleRestController.java modified: spring-boot-actuator-example/src/main/resources/application.properties modified: spring-webflux-demo/src/test/java/com/howtodoinjava/demo/EmployeeControllerTest.java no changes added to commit (use \u0026#34;git add\u0026#34; and/or \u0026#34;git commit -a\u0026#34;) æ­¤å‘½ä»¤å°†æ˜¾ç¤ºæˆ‘ä»¬çš„å­˜å‚¨åº“å½“å‰çŠ¶æ€çš„æ‘˜è¦ã€‚å®ƒå°†å‘æˆ‘ä»¬æ˜¾ç¤ºä»¥ä¸‹ä¿¡æ¯ï¼š\næˆ‘ä»¬å½“å‰æ‰€åœ¨çš„åˆ†æ”¯ã€‚ æœªè·Ÿè¸ªçš„æ–‡ä»¶ï¼ˆGit å½“å‰æœªè·Ÿè¸ªçš„æ–‡ä»¶ï¼‰ã€‚ å·²ä¿®æ”¹çš„æ–‡ä»¶ï¼ˆå·²ä¿®æ”¹ä½†æœªæš‚å­˜çš„æ–‡ä»¶ï¼‰ã€‚ æš‚å­˜æ–‡ä»¶ï¼ˆå·²ä¿®æ”¹å¹¶æš‚å­˜ä»¥ä¾›ä¸‹ä¸€æ¬¡æäº¤çš„æ–‡ä»¶ï¼‰ã€‚ åˆ†æ”¯çŠ¶æ€ï¼ˆä¾‹å¦‚ï¼Œâ€œæ‚¨çš„åˆ†æ”¯å·²æ›´æ–°ä¸ºâ€˜origin/masterâ€™â€ï¼‰ã€‚ 18. å¦‚ä½•è¿æ¥æœ¬åœ°ä»“åº“åˆ°è¿œç¨‹ä»“åº“ï¼Ÿ è¦å°†æœ¬åœ°å­˜å‚¨åº“è¿æ¥åˆ°è¿œç¨‹å­˜å‚¨åº“ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿œç¨‹ URL æ·»åŠ åˆ°æœ¬åœ° Git å­˜å‚¨åº“ã€‚æ­¤è¿œç¨‹ URL æŒ‡å‘æˆ‘ä»¬è¦å­˜å‚¨å’ŒåŒæ­¥ä»£ç çš„è¿œç¨‹å­˜å‚¨åº“çš„ä½ç½®ï¼ˆä¾‹å¦‚ï¼Œåœ¨ GitHubã€GitLab æˆ– Bitbucket ä¸Šï¼‰ã€‚\ngit remote add origin \u0026lt;remote_url\u0026gt; æ­¤å‘½ä»¤æ·»åŠ ä¸€ä¸ªåä¸ºâ€œoriginâ€çš„è¿œç¨‹ï¼ˆå¦‚æœæ„¿æ„ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸åŒçš„åç§°ï¼‰å¹¶å°†å…¶ä¸æŒ‡å®šçš„è¿œç¨‹ URL å…³è”ã€‚\n19. å¦‚ä½•åˆ—å‡ºå·²æœ‰çš„åˆ†è¡Œï¼Ÿå¦‚ä½•åˆ›å»ºæ–°åˆ†æ”¯ï¼Ÿ è¦åˆ—å‡ºç°æœ‰åˆ†æ”¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨â€œgitbranchâ€å‘½ä»¤ã€‚å®ƒæ˜¾ç¤ºå­˜å‚¨åº“ä¸­æ‰€æœ‰åˆ†æ”¯çš„åˆ—è¡¨ï¼Œå¹¶çªå‡ºæ˜¾ç¤ºå½“å‰åˆ†æ”¯ã€‚\ngit branch è¦åˆ›å»ºæ–°åˆ†æ”¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š\ngit branch \u0026lt;branch-name\u0026gt; 20. å¦‚ä½•åˆ‡æ¢åˆ°ç‰¹å®šåˆ†æ”¯ï¼Ÿ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ‡æ¢åˆ°ç‰¹å®šåˆ†æ”¯ï¼š\ngit checkout \u0026lt;branch-name\u0026gt; 21. å¦‚ä½•å°†ä¸åŒåˆ†æ”¯çš„æ›´æ”¹åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ï¼Ÿ ç¡®ä¿æˆ‘ä»¬ä½äºè¦åˆå¹¶æ›´æ”¹çš„åˆ†æ”¯ï¼ˆä¾‹å¦‚ main åˆ†æ”¯ï¼‰åï¼Œä½¿ç”¨ merge å‘½ä»¤å°†æŒ‡å®šåˆ†æ”¯çš„æ›´æ”¹åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ã€‚\ngit checkout \u0026lt; main-branch \u0026gt; git merge \u0026lt;branch-name\u0026gt; 22.å¦‚ä½•åˆ é™¤ Git ä¸­çš„åˆ†æ”¯ï¼Ÿ è¦åˆ é™¤åˆ†æ”¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ é€’ -d æ ‡å¿—ã€‚\ngit branch -d \u0026lt;branch-name\u0026gt; 23. å¦‚ä½•å°†æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒºï¼Ÿ è¦å°†æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒºï¼Œæˆ‘ä»¬ä½¿ç”¨ git add å‘½ä»¤ï¼š\ngit add \u0026lt;file\u0026gt; ä¸ºäº†è½»æ¾åœ°å°†æ‰€æœ‰æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒºåŸŸï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨â€œ.â€ã€‚è€Œä¸æ˜¯ç‰¹å®šçš„æ–‡ä»¶ï¼š\ngit add . 24. å¦‚ä½•ä½¿ç”¨æè¿°æ€§æ¶ˆæ¯åœ¨æš‚å­˜åŒºæäº¤æ›´æ”¹ï¼Ÿ å°†æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒºåŸŸåï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æäº¤æ›´æ”¹ï¼š\ngit commit -m \u0026#34;message\u0026#34;. å°†â€œæ¶ˆæ¯â€æ›¿æ¢ä¸ºæ€»ç»“æ›´æ”¹çš„æè¿°æ€§æ¶ˆæ¯ã€‚\n25. å¦‚ä½•å°†æäº¤çš„æ›´æ”¹æ¨é€åˆ°è¿œç¨‹å­˜å‚¨åº“ï¼Ÿ è¦å°†æäº¤çš„æ›´æ”¹æ¨é€åˆ°è¿œç¨‹å­˜å‚¨åº“ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š\ngit push \u0026lt;remote-name\u0026gt; \u0026lt;branch-name\u0026gt; 26. å¦‚ä½•æ’¤æ¶ˆ Git ä¸­çš„æœ€åä¸€æ¬¡æäº¤ï¼Ÿ è¦æ’¤æ¶ˆæœ€åä¸€æ¬¡æäº¤ï¼ŒåŒæ—¶å°†æ›´æ”¹ä¿ç•™ä¸ºæœªæäº¤çš„ä¿®æ”¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š\ngit reset HEAD~1 è¿™ä¼šå°† HEAD æŒ‡é’ˆå‘åç§»åŠ¨ä¸€æ¬¡æäº¤ã€‚æ›´æ”¹ä»å°†åœ¨æ‚¨çš„å·¥ä½œç›®å½•ä¸­ï¼Œå…è®¸æˆ‘ä»¬ä¿®æ”¹å®ƒä»¬æˆ–è¿›è¡Œæ–°çš„æäº¤ã€‚\n27. ä»€ä¹ˆæ˜¯åˆå¹¶å†²çªï¼Œå¦‚ä½•è§£å†³ï¼Ÿ å½“ Git ç”±äºåŒä¸€è¡Œä»£ç ä¸Šçš„ä¿®æ”¹å†²çªè€Œæ— æ³•è‡ªåŠ¨åˆå¹¶æ¥è‡ªä¸åŒåˆ†æ”¯çš„æ›´æ”¹æ—¶ï¼Œå°±ä¼šå‘ç”Ÿåˆå¹¶å†²çªã€‚\nè¦è§£å†³åˆå¹¶å†²çªï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨ç¼–è¾‘å†²çªæ–‡ä»¶ï¼Œä»¥é€‰æ‹©æ‰€éœ€çš„æ›´æ”¹ã€‚è§£å†³å†²çªåï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ å¹¶æäº¤æ›´æ”¹ä»¥å®Œæˆåˆå¹¶ã€‚\n28. å¦‚ä½•ä»è¿œç¨‹å­˜å‚¨åº“ä¸­æå–æ›´æ”¹ï¼Ÿ è¦ä» Git ä¸­çš„è¿œç¨‹å­˜å‚¨åº“æå–æ›´æ”¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ git pull å‘½ä»¤ã€‚ git pull å‘½ä»¤ä»è¿œç¨‹å­˜å‚¨åº“è·å–æœ€æ–°æ›´æ”¹å¹¶å°†å®ƒä»¬åˆå¹¶åˆ°æˆ‘ä»¬çš„æœ¬åœ°åˆ†æ”¯ä¸­ã€‚\ngit pull origin \u0026lt;branch-name\u0026gt; ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ä» master åˆ†æ”¯ä¸­æå–æ›´æ”¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ git pull origin master ã€‚å¦‚æœæˆ‘ä»¬å…‹éš†å­˜å‚¨åº“ï¼Œé»˜è®¤è¿œç¨‹åç§°é€šå¸¸ä¸º origin ï¼Œä½†å¦‚æœæ‚¨è‡ªå®šä¹‰å®ƒï¼Œå®ƒå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚\nå¦‚æœæœ‰ä»»ä½•å†²çªï¼ŒGit ä¼šé€šçŸ¥æˆ‘ä»¬ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è§£å†³å†²çªã€‚å¦‚æœåˆå¹¶æˆåŠŸï¼Œæˆ‘ä»¬çš„æœ¬åœ°åˆ†æ”¯å°†ä½¿ç”¨è¿œç¨‹å­˜å‚¨åº“ä¸­çš„æœ€æ–°æ›´æ”¹è¿›è¡Œæ›´æ–°ã€‚\nåœ¨æ‹‰å–æ›´æ”¹ä¹‹å‰ï¼Œå»ºè®®æäº¤æˆ–å­˜å‚¨æœ¬åœ°æ›´æ”¹ä»¥é¿å…å†²çªã€‚å¦‚æœæ‚¨æœ‰æœªæäº¤çš„æ›´æ”¹ï¼ŒGit å¯èƒ½ä¼šæ‹’ç»æ‹‰å–ï¼Œç›´åˆ°æ‚¨æäº¤æˆ–å­˜å‚¨å®ƒä»¬ã€‚\n29. å¦‚ä½•æ˜¾ç¤ºä¸¤æ¬¡æäº¤ä¹‹é—´çš„å·®å¼‚ï¼Ÿ è¦æ˜¾ç¤ºä¸¤ä¸ª Git æäº¤ä¹‹é—´çš„å·®å¼‚ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š\ngit diff \u0026lt;commit1\u0026gt; \u0026lt;commit2\u0026gt; 30. å¦‚ä½•åœ¨ Git ä¸­æ¢å¤æäº¤ï¼Ÿ è¦æ¢å¤æäº¤å¹¶åˆ›å»ºä¸€ä¸ªæ’¤æ¶ˆæ›´æ”¹çš„æ–°æäº¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š\ngit revert \u0026lt;commit-hash\u0026gt; å°† æ›¿æ¢ä¸ºæ‚¨è¦æ¢å¤çš„æäº¤å“ˆå¸Œã€‚ Git å°†åˆ›å»ºä¸€ä¸ªæ–°çš„æäº¤æ¥æ’¤æ¶ˆåœ¨æŒ‡å®šæäº¤ä¸­æ‰€åšçš„æ›´æ”¹ã€‚\n31.å¦‚ä½•æŸ¥çœ‹ Git ä¸­çš„æäº¤å†å²è®°å½•ï¼Ÿ Git ä¸­çš„æ¯ä¸ªåˆ†æ”¯éƒ½ç»´æŠ¤è‡ªå·±çš„æäº¤å†å²è®°å½•ã€‚è¦è®¿é—®å’ŒæŸ¥çœ‹ä¸ç‰¹å®šåˆ†æ”¯å…³è”çš„æäº¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š\ngit log branch-name ä»¥ä¸‹æ˜¯ä½¿ç”¨â€œgit logâ€çš„ä¸åŒåœºæ™¯ï¼š\nä¸æŒ‡å®šåˆ†æ”¯åç§°ï¼šâ€œgit logâ€æ˜¾ç¤ºå½“å‰ç­¾å‡ºçš„åˆ†æ”¯çš„æäº¤å†å²è®°å½•ã€‚å¦‚æœæ²¡æœ‰ç­¾å‡ºåˆ†æ”¯ï¼Œå®ƒä¼šæ˜¾ç¤ºæ•´ä¸ªå­˜å‚¨åº“çš„æäº¤å†å²è®°å½•ã€‚ ä½¿ç”¨ç‰¹å®šåˆ†æ”¯åç§°ï¼šâ€œgit log â€æ˜¾ç¤ºæŒ‡å®šåˆ†æ”¯çš„æäº¤å†å²è®°å½•ï¼ŒåŒ…æ‹¬å…¶çˆ¶åˆ†æ”¯å…±äº«çš„ä»»ä½•æäº¤ã€‚ 32. å¦‚ä½•å–æ¶ˆæš‚å­˜æ–‡ä»¶ï¼Ÿ è¦åœ¨ Git ä¸­å–æ¶ˆæš‚å­˜æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š\ngit reset HEAD -- path/to/file ä¸é€’å½’ä½¿ç”¨â€œgit addâ€ç±»ä¼¼ï¼Œæ‚¨å¯ä»¥æŒ‰ç›®å½•å–æ¶ˆæš‚å­˜æ–‡ä»¶æˆ–æ‰§è¡Œæ‰¹é‡å–æ¶ˆæš‚å­˜æ“ä½œã€‚è¦ç«‹å³å–æ¶ˆæ‰€æœ‰å†…å®¹ï¼Œè¯·ä»å­˜å‚¨åº“çš„æ ¹ç›®å½•è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\ngit reset HEAD -- . 33. å¦‚ä½•ä»è¿œç¨‹å­˜å‚¨åº“ä¸­åˆ é™¤æ–‡ä»¶ï¼Ÿ è¦ä»è¿œç¨‹å­˜å‚¨åº“ä¸­åˆ é™¤æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š\ngit rm \u0026lt;file\u0026gt; è¿™å°†ä»å·¥ä½œç›®å½•å’Œ Git å­˜å‚¨åº“ä¸­åˆ é™¤è¯¥æ–‡ä»¶ã€‚åˆ é™¤æ–‡ä»¶åï¼Œæ‚¨éœ€è¦æäº¤å¹¶æ¨é€æ›´æ”¹ä»¥æ›´æ–°è¿œç¨‹å­˜å‚¨åº“ã€‚\nç»“è®º æ€»ä¹‹ï¼Œè¿™ä»½å…³äºå¸¸è§ Git é¢è¯•é—®é¢˜å’Œç­”æ¡ˆçš„ç»¼åˆæŒ‡å—å¯¹ Git ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­çš„åŸºæœ¬æ¦‚å¿µå’Œå®è·µè¿›è¡Œäº†å½»åº•çš„æ¢ç´¢ã€‚\né€šè¿‡æ·±å…¥ç ”ç©¶å­˜å‚¨åº“ç®¡ç†ã€åˆ†æ”¯ã€åˆå¹¶ã€è§£å†³å†²çªå’Œåä½œå·¥ä½œæµç¨‹ç­‰ä¸»é¢˜ï¼Œæ‚¨å¯ä»¥å¯¹ Git çš„å…³é”®æ–¹é¢æœ‰æ·±å…¥çš„äº†è§£ã€‚\nå¿«ä¹å­¦ä¹ ï¼\nåŸæ–‡é“¾æ¥ï¼šGit Interview Questions for DevOps and Testers ","permalink":"https://blog.chensoul.cc/posts/2023/10/12/git-interview-questions/","summary":"æ¬¢è¿æ¥åˆ° Git é¢è¯•å‡†å¤‡æŒ‡å—ï¼Œæˆ‘ä»¬å°†åœ¨è¿™é‡Œå‘åˆå­¦è€…å’Œç»éªŒä¸°å¯Œçš„ä¸“ä¸šäººå£«è®¨è®ºæœ€å¸¸è§çš„ Git é¢è¯•é—®é¢˜ã€‚æ— è®ºæ‚¨æ˜¯å‡†å¤‡å‚åŠ  DevOps æˆ–æµ‹è¯•é¢è¯•ï¼Œè¿˜æ˜¯å¸Œæœ›æé«˜ Git æŠ€èƒ½ï¼Œæ­¤èµ„æºéƒ½å¯ä»¥é€šè¿‡æ·±å…¥ç ”ç©¶ä¸€äº›ä¸ Git åŸºæœ¬æ¦‚å¿µå’Œå®è·µç›¸å…³çš„æœ€å¸¸è§é¢è¯•é—®é¢˜æ¥å¸®åŠ©æ‚¨ã€‚\næˆ‘ä»¬å°†æ¶µç›–æ‰€æœ‰é‡è¦ä¸»é¢˜ï¼Œä¾‹å¦‚åˆ†æ”¯ã€å­˜å‚¨åº“ç®¡ç†ã€å¤„ç†åˆå¹¶å†²çªå’Œåä½œå·¥ä½œæµç¨‹ã€‚é€šè¿‡æ¢ç´¢è¿™äº›é—®é¢˜ï¼Œæ‚¨å°†æ›´æ·±å…¥åœ°äº†è§£ Git çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œå¹¶æ›´å¥½åœ°åº”å¯¹å¼€å‘é¡¹ç›®ä¸­çš„ç°å®æŒ‘æˆ˜ã€‚\n1.ä»€ä¹ˆæ˜¯ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Ÿ ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ (VCS) æ˜¯ä¸€ç§å¸®åŠ©è·Ÿè¸ªå’Œç®¡ç†æ–‡ä»¶å’Œä»£ç éšæ—¶é—´å˜åŒ–çš„è½¯ä»¶ã€‚å®ƒå…è®¸å¤šäººåä½œå¤„ç†ä¸€ä¸ªé¡¹ç›®ï¼Œè·Ÿè¸ªä¿®è®¢ï¼Œå¹¶åœ¨éœ€è¦æ—¶è½»æ¾æ¢å¤åˆ°ä»¥å‰çš„ç‰ˆæœ¬ã€‚\nç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸»è¦åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼š\næœ¬åœ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ (LVCS)ï¼šåœ¨ LVCS ä¸­ï¼Œç‰ˆæœ¬æ§åˆ¶æ•°æ®åº“å­˜å‚¨åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šã€‚æ›´æ”¹å’Œä¿®è®¢åœ¨ä½äºç”¨æˆ·è®¡ç®—æœºä¸Šçš„æœ¬åœ°å­˜å‚¨åº“ä¸­è¿›è¡Œè·Ÿè¸ªã€‚ä½†æ­¤ç±»ç³»ç»Ÿç¼ºä¹åä½œåŠŸèƒ½ï¼Œä¸åˆ©äºå›¢é˜Ÿå¼€å‘ã€‚ é›†ä¸­ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ (CVCS)ï¼šåœ¨ CVCS ä¸­ï¼Œç‰ˆæœ¬æ§åˆ¶æ•°æ®åº“å­˜å‚¨åœ¨ä¸­å¤®æœåŠ¡å™¨ä¸Šã€‚ç”¨æˆ·å¯ä»¥ä»æœåŠ¡å™¨æ£€å‡ºæ–‡ä»¶ã€è¿›è¡Œæ›´æ”¹å¹¶å°†å…¶æäº¤å›æœåŠ¡å™¨ã€‚è¿™å…è®¸å¤šä¸ªç”¨æˆ·åœ¨åŒä¸€é¡¹ç›®ä¸Šè¿›è¡Œåä½œï¼Œå¹¶æä¾›å¯¹å­˜å‚¨åº“çš„é›†ä¸­æ§åˆ¶ã€‚ç„¶è€Œï¼ŒCVCS çš„ä¸€ä¸ªç¼ºç‚¹æ˜¯ï¼Œå¦‚æœä¸­å¤®æœåŠ¡å™¨å‡ºç°æ•…éšœï¼Œåä½œè€…å°†æ— æ³•æ‰§è¡ŒæŸäº›æ“ä½œï¼Œç›´åˆ°æœåŠ¡å™¨æ¢å¤ä¸ºæ­¢ã€‚ åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ (DVCS)ï¼šåœ¨ DVCS ä¸­ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸€ä¸ªåŒ…å«æ•´ä¸ªç‰ˆæœ¬å†å²è®°å½•çš„æœ¬åœ°å­˜å‚¨åº“ã€‚è¿™æ„å‘³ç€æ¯ä¸ªç”¨æˆ·éƒ½æ‹¥æœ‰é¡¹ç›®å­˜å‚¨åº“çš„å®Œæ•´å‰¯æœ¬ï¼ŒåŒ…æ‹¬æ‰€æœ‰åˆ†æ”¯å’Œä¿®è®¢ã€‚ç”¨æˆ·å¯ä»¥åœ¨æœ¬åœ°å­˜å‚¨åº“ä¸Šç‹¬ç«‹å·¥ä½œï¼Œå¹¶ä¸å…¶ä»–å­˜å‚¨åº“åŒæ­¥æ›´æ”¹ã€‚ DVCS ä¸ºåˆ†å¸ƒå¼å’Œåˆ†æ•£å¼å·¥ä½œæµç¨‹æä¾›æ›´å¥½çš„æ”¯æŒï¼Œå…è®¸ç”¨æˆ·ç¦»çº¿å·¥ä½œå¹¶æ›´æœ‰æ•ˆåœ°åä½œã€‚ 2. Git ä¸­çš„ Origin æ˜¯ä»€ä¹ˆï¼Ÿ åœ¨ Git ä¸­ï¼Œâ€œoriginâ€æ˜¯æŒ‡æˆ‘ä»¬ä»ä¸­å…‹éš†çš„è¿œç¨‹å­˜å‚¨åº“ã€‚å½“æˆ‘ä»¬ä»è¿œç¨‹æœåŠ¡å™¨å…‹éš†å­˜å‚¨åº“æ—¶ï¼ŒGit ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªåä¸ºâ€œoriginâ€çš„è¿œç¨‹å¼•ç”¨ï¼Œè¯¥å¼•ç”¨æŒ‡å‘åŸå§‹è¿œç¨‹å­˜å‚¨åº“ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬å…‹éš†å­˜å‚¨åº“æ—¶ï¼ŒGit ä¼šè®¾ç½®â€œæ¥æºâ€å¹¶å°†å…¶ä¸æˆ‘ä»¬å…‹éš†çš„åŸå§‹å­˜å‚¨åº“å…³è”èµ·æ¥ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿è¡Œå‘½ä»¤â€œgit remote -vâ€æ¥éªŒè¯è¿™ä¸€ç‚¹ã€‚æ­¤å‘½ä»¤æ˜¾ç¤ºä¸æœ¬åœ°å­˜å‚¨åº“å…³è”çš„è¿œç¨‹å­˜å‚¨åº“åˆ—è¡¨åŠå…¶ URLã€‚\ngit remote -v origin https://github.com/lokeshgupta1981/Spring-Boot3-Demos.git (fetch) origin https://github.com/lokeshgupta1981/Spring-Boot3-Demos.git (push) è¯·æ³¨æ„ï¼Œâ€œoriginâ€åªæ˜¯ä¸€ä¸ªæœªç¡¬ç¼–ç çš„åˆ«åï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æç¤ºç¬¦è¿›è¡Œæ›´æ”¹ï¼š\ngit remote rename origin newName 3.æˆ‘ä»¬å¦‚ä½•åœ¨ Git ä¸­é…ç½®å…¨å±€ç”¨æˆ·åå’Œç”µå­é‚®ä»¶ï¼Ÿ è®¾ç½®å…¨å±€ä¸€è‡´çš„ç”¨æˆ·åå’Œç”µå­é‚®ä»¶åœ°å€éå¸¸é‡è¦ï¼Œå› ä¸º Git ä½¿ç”¨æ­¤ä¿¡æ¯å°†æäº¤ä¸æ­£ç¡®çš„ä½œè€…å…³è”èµ·æ¥ã€‚å®ƒæœ‰åŠ©äºè¯†åˆ«æ¯ä¸ªæäº¤çš„äººå‘˜ï¼Œå¹¶å…è®¸åœ¨é¡¹ç›®å†…è¿›è¡Œé€‚å½“çš„åä½œå’Œå½’å±ã€‚\nè¦åœ¨ Git ä¸­é…ç½®å…¨å±€ç”¨æˆ·åå’Œç”µå­é‚®ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š\ngit config --global user.name \u0026#34;MyName\u0026#34; git config --global user.email \u0026#34;myname@gmail.com\u0026#34; è¿™äº›å‘½ä»¤å°†å…¨å±€è®¾ç½®ç”¨æˆ·åå’Œç”µå­é‚®ä»¶ï¼Œè¿™æ„å‘³ç€å®ƒä»¬å°†ç”¨äºæ‚¨è®¡ç®—æœºä¸Šçš„æ‰€æœ‰ Git å­˜å‚¨åº“ï¼Œé™¤éåœ¨å­˜å‚¨åº“çº§åˆ«è¦†ç›–ã€‚\næ‚¨å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥éªŒè¯æ›´æ”¹ã€‚è¿™äº›å‘½ä»¤å°†åˆ†åˆ«æ˜¾ç¤ºé…ç½®çš„ç”¨æˆ·åå’Œç”µå­é‚®ä»¶ã€‚\ngit config --global user.name # Prints \u0026#39;lokeshgupta1981\u0026#39; git config --global user.email # Prints \u0026#39;howtodoinjava@gmail.com\u0026#39; 4.","title":"[è¯‘]DevOps å’Œæµ‹è¯•äººå‘˜çš„ Git é¢è¯•é—®é¢˜"},{"content":"æœ¬é¢è¯•å‡†å¤‡æŒ‡å—å°†è®¨è®ºä¸€äº›å¸¸è§çš„ Spring Security é¢è¯•é—®é¢˜ã€‚æ— è®ºæ‚¨æ˜¯å‡†å¤‡é¢è¯•è¿˜æ˜¯åªæ˜¯æƒ³å¢å¼ºå¯¹ Spring Security çš„äº†è§£ï¼Œè¿™äº›é—®é¢˜éƒ½å°†å¸®åŠ©æ‚¨ç†è§£å…³é”®æ¦‚å¿µå¹¶æŒ‡å¯¼æ‚¨è®¾è®¡å¸¸è§å®‰å…¨é—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚\n1. Spring Security çš„æ ¸å¿ƒç‰¹æ€§æ˜¯ä»€ä¹ˆï¼Ÿ Spring Security æä¾›çš„ä¸¤ä¸ªæœ€çªå‡ºçš„åŠŸèƒ½æ˜¯èº«ä»½éªŒè¯å’Œæˆæƒã€‚è¿™äº›åŠŸèƒ½åœ¨ç¡®ä¿åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§æ–¹é¢å‘æŒ¥ç€è‡³å…³é‡è¦çš„ä½œç”¨ã€‚ç„¶è€Œï¼ŒSpring Security è¶…è¶Šäº†èº«ä»½éªŒè¯å’Œæˆæƒï¼Œè¿˜æä¾›äº†é¢å¤–çš„åŠŸèƒ½æ¥é˜²æ­¢æ¼æ´åˆ©ç”¨å¹¶ä¸å…¶ä»–æ¡†æ¶é›†æˆã€‚\n1.1.éªŒè¯ èº«ä»½éªŒè¯æ˜¯éªŒè¯å°è¯•è®¿é—®åº”ç”¨ç¨‹åºçš„ç”¨æˆ·èº«ä»½çš„è¿‡ç¨‹ã€‚ Spring Security æä¾›å¤šç§èº«ä»½éªŒè¯æ–¹æ³•ï¼ˆåŸºäºè¡¨å•çš„èº«ä»½éªŒè¯ã€HTTP åŸºæœ¬èº«ä»½éªŒè¯ã€OAuth2ã€Siteminderã€OpenID Connectã€LDAPã€JDBC ç­‰ï¼‰ï¼Œå…è®¸åº”ç”¨ç¨‹åºä½¿ç”¨å„ç§æ–¹æ³•å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ã€‚\nå®ƒè¿˜æ”¯æŒè‡ªå®šä¹‰ï¼Œå½“é»˜è®¤é€‰é¡¹ä¸æ»¡è¶³è¦æ±‚æ—¶ï¼Œå¯ä»¥å®ç°è‡ªå®šä¹‰çš„èº«ä»½éªŒè¯æœºåˆ¶ã€‚\n1.2.æˆæƒ æˆæƒæ˜¯å‘ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·æˆ–å®ä½“æˆäºˆè®¸å¯æˆ–æƒåˆ©çš„è¿‡ç¨‹ã€‚ç”¨æˆ·æˆ–å®ä½“æˆåŠŸé€šè¿‡èº«ä»½éªŒè¯åï¼Œæˆæƒå°†å†³å®šä»–ä»¬å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­è®¿é—®å“ªäº›æ“ä½œæˆ–èµ„æºã€‚ Spring Security ä¸ºå¼€å‘äººå‘˜æä¾›äº†å¤šç§æ–¹æ³•æ¥å®ç°æˆæƒå¹¶æ§åˆ¶ç”¨æˆ·å¯¹åº”ç”¨ç¨‹åºä¸åŒéƒ¨åˆ†çš„è®¿é—®ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„æ–¹æ³•ï¼š\nåŸºäº Web URL çš„æˆæƒï¼šå¯ä»¥æ ¹æ®ç‰¹å®šçš„ URL æˆ– URL æ¨¡å¼å®æ–½è®¿é—®æ§åˆ¶ï¼Œè§„èŒƒå“ªäº›ç”¨æˆ·å¯ä»¥è®¿é—®æŸäº›èµ„æºã€‚ æ–¹æ³•çº§æˆæƒï¼šå¦‚æœéœ€è¦ï¼Œç”šè‡³å¯ä»¥å¯¹ Java Bean ä¸­çš„æ–¹æ³•è¿›è¡Œè®¿é—®æ§åˆ¶ï¼Œä»è€Œåœ¨æ–¹æ³•çº§æä¾›ç»†ç²’åº¦çš„æˆæƒã€‚ åŸŸå®ä¾‹çº§æˆæƒï¼šSpring Security æä¾›äº†æ§åˆ¶å¯¹ç‰¹å®šåŸŸå®ä¾‹çš„è®¿é—®çš„èƒ½åŠ›ï¼Œå…è®¸åŸºäºæŸäº›å®ä½“çš„æ‰€æœ‰æƒæˆ–å…³è”è¿›è¡Œæˆæƒã€‚ 1.3.é˜²æ­¢æ¼æ´åˆ©ç”¨ Spring Security æä¾›äº†å¤šç§åŠŸèƒ½æ¥é˜²èŒƒå¸¸è§çš„ Web åº”ç”¨ç¨‹åºå®‰å…¨æ¼æ´ã€‚ä¸€äº›æ˜¾ç€çš„åŠŸèƒ½åŒ…æ‹¬ï¼š\nè·¨ç«™è¯·æ±‚ä¼ªé€  (CSRF) ä¿æŠ¤ï¼šSpring Security ä¼šè‡ªåŠ¨å°† CSRF ä»¤ç‰Œæ·»åŠ åˆ°è¡¨å•å’Œ AJAX è¯·æ±‚ä¸­ï¼Œä»è€Œé˜²æ­¢ CSRF æ”»å‡»ã€‚ è·¨ç«™è„šæœ¬ (XSS) ä¿æŠ¤ï¼šSpring Security æ”¯æŒè¾“å‡ºç¼–ç ï¼Œå¹¶æä¾›å®ç”¨ç¨‹åºé€šè¿‡æ¸…ç†ç”¨æˆ·è¾“å…¥æ¥é˜²æ­¢ XSS æ”»å‡»ã€‚ ç‚¹å‡»åŠ«æŒä¿æŠ¤ï¼šSpring Security åŒ…æ‹¬ X-Frame-Options æ”¯æŒï¼Œä»¥é˜²æ­¢ç‚¹å‡»åŠ«æŒæ”»å‡»ã€‚ 1.4.é›†æˆ Spring Security ä¸å…¶ä»–æ¡†æ¶å’Œåº“æ— ç¼é›†æˆï¼Œä»¥å¢å¼ºåº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ã€‚ä¸€äº›å…³é”®çš„é›†æˆæ˜¯ï¼š\nSpring MVCï¼šSpring Security ä¸ Spring MVC é›†æˆï¼Œä¸º Web åº”ç”¨ç¨‹åºæä¾›æ— ç¼çš„å®‰å…¨åŠŸèƒ½ã€‚å®ƒå¯ä»¥å®‰å…¨åœ°å¤„ç†è¯·æ±‚ã€èº«ä»½éªŒè¯ã€æˆæƒå¹¶é˜²æ­¢å¸¸è§çš„ Web æ¼æ´ã€‚ Spring Dataï¼šSpring Security ä¸ Spring Data é›†æˆï¼Œä»¥ä¾¿åœ¨æŸ¥è¯¢ä¸­å¼•ç”¨å½“å‰ç”¨æˆ·ã€‚è¿™ç§é›†æˆç¡®ä¿å¯ä»¥æ ¹æ®èº«ä»½éªŒè¯å’Œæˆæƒè§„åˆ™è½»æ¾è®¿é—®å’Œè¿‡æ»¤ç”¨æˆ·ç‰¹å®šçš„æ•°æ®ã€‚ Jacksonï¼šJackson çš„æ”¯æŒå¯ä»¥å®ç° Spring Security ç›¸å…³ç±»çš„é«˜æ•ˆåºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨åˆ†å¸ƒå¼ä¼šè¯æˆ– Spring Session ç­‰æ¡†æ¶æ—¶ï¼Œä»è€Œæé«˜æ•ˆç‡å’Œå¯æ‰©å±•æ€§ã€‚ å¯†ç å­¦ï¼šSpring Security ä¸å„ç§å¯†ç åº“å’Œç®—æ³•é›†æˆï¼Œä»¥æä¾›æ•æ„Ÿä¿¡æ¯çš„å®‰å…¨å­˜å‚¨å’Œä¼ è¾“ã€‚è¿™ç§é›†æˆåŒ…æ‹¬å¯†ç æ•£åˆ—ã€åŠ å¯†å’Œå®‰å…¨é€šä¿¡åè®®ç­‰åŠŸèƒ½ï¼Œä»¥ä¿æŠ¤æ•°æ®çš„æœºå¯†æ€§å’Œå®Œæ•´æ€§ã€‚ æœ‰å…³ Spring Security åŠŸèƒ½çš„æ›´è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…å®˜æ–¹æ–‡æ¡£ã€‚\n2.è§£é‡Šä¸€ä¸‹ Spring Security çš„æ ¸å¿ƒç»„ä»¶ï¼Ÿ å½“è°ˆåˆ° Spring Security æ—¶ï¼Œå‡ ä¸ªæ ¸å¿ƒç»„ä»¶åœ¨ä¸º Java åº”ç”¨ç¨‹åºæä¾›å®‰å…¨åŠŸèƒ½æ–¹é¢å‘æŒ¥ç€è‡³å…³é‡è¦çš„ä½œç”¨ã€‚è¿™äº›ç»„ä»¶ååŒå·¥ä½œä»¥ç¡®ä¿å¼ºå¤§çš„èº«ä»½éªŒè¯ã€æˆæƒå’Œå…¶ä»–å®‰å…¨åŠŸèƒ½ã€‚\n2.1.å§”æ‰˜è¿‡æ»¤ä»£ç† DelegatingFilterProxyæ˜¯ Spring æ¡†æ¶æä¾›çš„ä¸€ä¸ªç‰¹æ®Šçš„ Servlet Filterã€‚å®ƒå……å½“å¤„ç†å®‰å…¨ç›¸å…³è¯·æ±‚çš„å…¥å£ç‚¹ã€‚å½“æ”¶åˆ°è¯·æ±‚æ—¶ï¼ŒDelegatingFilterProxy å°†è¯·æ±‚å§”æ‰˜ç»™ Spring FilterChainProxy bean è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ï¼ˆspringSecurityFilterChain beanï¼‰ã€‚ FilterChainProxy åˆ©ç”¨SecurityFilterChain æ¥ç¡®å®šä¸ºå½“å‰è¯·æ±‚è°ƒç”¨çš„é€‚å½“çš„è¿‡æ»¤å™¨é›†ã€‚\n2.2.è¿‡æ»¤å™¨é“¾ä»£ç† FilterChainProxy æ ¹æ®ä¼ å…¥è¯·æ±‚çš„ URL æ¨¡å¼å’Œå®šä¹‰çš„å®‰å…¨é…ç½®ç¡®å®šè¦åº”ç”¨å“ªäº›è¿‡æ»¤å™¨ã€‚å®ƒæ ¹æ®é…ç½®çš„å®‰å…¨è§„åˆ™è¯„ä¼°è¯·æ±‚å¹¶é€‰æ‹©é€‚å½“çš„è¿‡æ»¤å™¨é“¾ï¼ˆä½¿ç”¨@EnableWebSecurityï¼Œ FilterChainProxy è‡ªåŠ¨åˆ›å»ºä¸º beanã€‚å®ƒåŒ…è£…å®é™…çš„å®‰å…¨è¿‡æ»¤å™¨é“¾å¹¶å……å½“å¤„ç†è¯·æ±‚çš„å§”æ‰˜ï¼‰ã€‚\n2.3.å®‰å…¨è¿‡æ»¤é“¾ å½“æ”¶åˆ°è¯·æ±‚æ—¶ï¼ŒFilterChainProxy ä¼šæ‰¾åˆ°ç›¸åº”çš„ SecurityFilterChain å¹¶æ‰§è¡Œè¯¥é“¾ä¸­çš„è¿‡æ»¤å™¨åˆ—è¡¨ã€‚æ¯ä¸ªè¿‡æ»¤å™¨æ ¹æ®åº”ç”¨ç¨‹åºçš„å®‰å…¨é…ç½®æ‰§è¡Œå…¶æŒ‡å®šçš„ä»»åŠ¡ã€‚è¿‡æ»¤å™¨å¯ä»¥ä¿®æ”¹è¯·æ±‚ã€æ‰§è¡Œèº«ä»½éªŒè¯æ£€æŸ¥ã€éªŒè¯æƒé™æˆ–å¤„ç†ä¸ä¼šè¯ç›¸å…³çš„æ“ä½œã€‚\nSpring Security ä¸­çš„ä¸€äº›é‡è¦å®‰å…¨è¿‡æ»¤å™¨åŒ…æ‹¬ï¼š\nUsernamePasswordAuthenticationFilterï¼šæ­¤è¿‡æ»¤å™¨é€šè¿‡æ‹¦æˆªç™»å½•è¯·æ±‚å¹¶æ ¹æ®ç”¨æˆ·æä¾›çš„å‡­æ®å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯æ¥å¤„ç†åŸºäºè¡¨å•çš„èº«ä»½éªŒè¯ã€‚ BasicAuthenticationFilterï¼šæ­¤è¿‡æ»¤å™¨å¤„ç†åŸºæœ¬èº«ä»½éªŒè¯ï¼Œç”¨æˆ·åœ¨ HTTP æ ‡å¤´ä¸­ä»¥ç”¨æˆ·åå’Œå¯†ç çš„å½¢å¼æä¾›å‡­æ®ã€‚ RememberMeAuthenticationFilterï¼šæ­¤è¿‡æ»¤å™¨å¯ç”¨ Remember-Me åŠŸèƒ½ï¼Œå…è®¸ç”¨æˆ·ä½¿ç”¨å­˜å‚¨åœ¨ cookie ä¸­çš„æŒä¹…ä»¤ç‰Œè‡ªåŠ¨ç™»å½•ã€‚ LogoutFilterï¼šæ­¤è¿‡æ»¤å™¨å¤„ç†æ³¨é”€è¿‡ç¨‹ã€ä½¿ç”¨æˆ·ä¼šè¯æ— æ•ˆã€æ¸…é™¤èº«ä»½éªŒè¯è¯¦ç»†ä¿¡æ¯ä»¥åŠæ‰§è¡Œå…¶ä»–æ“ä½œï¼ˆä¾‹å¦‚é‡å®šå‘åˆ°ç‰¹å®šæ³¨é”€é¡µé¢ï¼‰ã€‚ ExceptionTranslationFilterï¼šæ­¤è¿‡æ»¤å™¨æ•è·è¯·æ±‚å¤„ç†æœŸé—´å¼•å‘çš„ä»»ä½•èº«ä»½éªŒè¯æˆ–è®¿é—®ç›¸å…³çš„å¼‚å¸¸ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºæœ‰æ„ä¹‰çš„å“åº”ï¼Œä¾‹å¦‚é‡å®šå‘åˆ°ç™»å½•é¡µé¢æˆ–è¿”å›ç¦æ­¢çš„å“åº”ã€‚ ä¸€æ—¦è¯·æ±‚åˆ°è¾¾SecurityFilterChainå†…æ³¨å†Œçš„è¿‡æ»¤å™¨ï¼Œç›¸åº”çš„è¿‡æ»¤å™¨å°±ä¼šå°†è¯·æ±‚å§”æ‰˜ç»™å…¶ä»– bean æ¥æ‰§è¡Œç›¸åº”çš„ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼ŒAuthenticationProcessingFilter å‡†å¤‡ Authentication å®ä¾‹å¹¶å°†å…¶å§”æ‰˜ç»™ AuthenticationManager è¿›è¡Œèº«ä»½éªŒè¯æµç¨‹ã€‚\n2.4.è®¤è¯ç®¡ç†å™¨ AuthenticationManager è´Ÿè´£å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ã€‚å®ƒæœ‰ä¸€ä¸ªåä¸º authenticate () çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°† Authentication å®ä¾‹ä½œä¸ºå‚æ•°ã€‚ authenticate () æ–¹æ³•è´Ÿè´£éªŒè¯æ‰€æä¾›çš„å‡­æ®ï¼ˆåœ¨ AuthenticationProvider çš„é€‚å½“å®ç°çš„å¸®åŠ©ä¸‹ï¼‰ï¼Œå¹¶åœ¨èº«ä»½éªŒè¯æˆåŠŸæ—¶è¿”å›ç»è¿‡èº«ä»½éªŒè¯çš„ Authentication å¯¹è±¡ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Security æä¾›äº†ä¸€ä¸ªåä¸º ProviderManager çš„ AuthenticationManager æ¥å£çš„å®ç°ã€‚ ProviderManager å°†èº«ä»½éªŒè¯è¿‡ç¨‹å§”æ‰˜ç»™ AuthenticationProvider å®ä¾‹åˆ—è¡¨ã€‚\n2.5.è®¤è¯æä¾›è€… AuthenticationProvider è´Ÿè´£éªŒè¯ç‰¹å®šç±»å‹çš„å‡­è¯æˆ–èº«ä»½éªŒè¯æœºåˆ¶ã€‚å®ƒå®šä¹‰äº†é’ˆå¯¹ç‰¹å®šæºï¼ˆä¾‹å¦‚ç”¨æˆ·æ•°æ®åº“ã€å¤–éƒ¨èº«ä»½éªŒè¯æœåŠ¡æˆ–ä»»ä½•å…¶ä»–è‡ªå®šä¹‰èº«ä»½éªŒè¯æœºåˆ¶ï¼‰æ‰§è¡Œèº«ä»½éªŒè¯çš„åˆåŒã€‚\nå½“åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å¤šç§èº«ä»½éªŒè¯æœºåˆ¶æ—¶ï¼Œå¯ä»¥é…ç½®å¤šä¸ª AuthenticationProvider å®ä¾‹æ¥å•ç‹¬å¤„ç†æ¯ç§æœºåˆ¶ã€‚\næ›´å¤šä¿¡æ¯è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚\n3. Spring Security å¦‚ä½•å¤„ç†ç”¨æˆ·è®¤è¯ï¼Ÿ åœ¨è¾ƒé«˜çº§åˆ«ä¸Šï¼ŒSpring Security é€šè¿‡ä¸€ç³»åˆ—æ­¥éª¤å¤„ç†ç”¨æˆ·èº«ä»½éªŒè¯ã€‚å¤§å¤šæ•°æ­¥éª¤å¯¹äºå„ç§èº«ä»½éªŒè¯éƒ½æ˜¯é€šç”¨çš„ï¼Œä½†å¾ˆå°‘æœ‰èº«ä»½éªŒè¯æµç¨‹éœ€è¦ç‰¹å®šæ­¥éª¤ã€‚\nä»¥ä¸‹æ­¥éª¤æ¼”ç¤ºäº†åŸºäºè¡¨å•ç™»å½•çš„èº«ä»½éªŒè¯ï¼Œå…¶ä¸­ç”¨æˆ·åœ¨è¯·æ±‚ä¸­è¾“å…¥ç”¨æˆ·å/å¯†ç ç»„åˆã€‚\nç”¨æˆ·å°è¯•è®¿é—®å—ä¿æŠ¤çš„èµ„æºæˆ–å‘èµ·ç™»å½•è¯·æ±‚ï¼Œè¯¥è¯·æ±‚è¢« Spring Security æ‹¦æˆªï¼Œå¹¶å°†æˆ‘ä»¬é‡å®šå‘åˆ°ç™»å½•é¡µé¢ã€‚ èº«ä»½éªŒè¯è¿‡æ»¤å™¨ UsernamePasswordAuthenticationFilter è´Ÿè´£ä»è¯·æ±‚ä¸­æ•è·ç”¨æˆ·çš„å‡­æ®ï¼ˆé€šå¸¸ä¸ºæ¯ä¸ªå¯¹ /login å‘å‡ºçš„è¯·æ±‚è°ƒç”¨ UsernamePasswordAuthenticationFilter ï¼‰ã€‚ UsernamePasswordAuthenticationFilter æå–ç”¨æˆ·åå’Œå¯†ç å¹¶åˆ›å»ºä¸€ä¸ª Authentication å¯¹è±¡ï¼ˆæ¥è‡ª UsernamePasswordAuthenticationToken çš„å®ä¾‹ï¼‰ã€‚ ç„¶åå°† Authentication å¯¹è±¡ä¼ é€’ç»™ AuthenticationManagerã€‚ AuthenticationManager å°†èº«ä»½éªŒè¯è¿‡ç¨‹å§”æ‰˜ç»™ä¸€ä¸ªæˆ–å¤šä¸ª AuthenticationProviderã€‚ AuthenticationProvider ä½¿ç”¨å…·æœ‰æ–¹æ³• loadUserByUsername(username) çš„ UserDetailsSâ€‹â€‹ervice bean éªŒè¯å‡­æ®ã€‚å®ƒè¿”å›åŒ…å«ç”¨æˆ·æ•°æ®çš„ UserDetails å¯¹è±¡ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°å…·æœ‰ç»™å®šç”¨æˆ·åçš„ç”¨æˆ·ï¼Œåˆ™æŠ›å‡º UsernameNotFoundException ã€‚ å¦‚æœèº«ä»½éªŒè¯æˆåŠŸï¼Œåˆ™å°†åŒ…å«ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ä¿¡æ¯çš„ Authentication å¯¹è±¡è¿”å›åˆ° AuthenticationManagerã€‚ AuthenticationManager å°†ç»è¿‡èº«ä»½éªŒè¯çš„ Authentication å¯¹è±¡å­˜å‚¨åœ¨ SecurityContext ä¸­ã€‚ å®‰å…¨ä¸Šä¸‹æ–‡é€šå¸¸å­˜å‚¨åœ¨çº¿ç¨‹å±€éƒ¨å˜é‡ä¸­ï¼Œä½¿å…¶å¯ä»¥åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­è®¿é—®ã€‚ ç”¨æˆ·ç»è¿‡èº«ä»½éªŒè¯åï¼ŒSpring Security å…è®¸ç”¨æˆ·è®¿é—®è¯·æ±‚çš„èµ„æºæˆ–ç»§ç»­æ‰§è¡Œè¯·æ±‚çš„æ“ä½œã€‚ 4. AuthenticationManager å¦‚ä½•ç¡®å®šåˆé€‚çš„ AuthenticationProviderï¼Ÿ åœ¨èº«ä»½éªŒè¯è¿‡ç¨‹ä¸­ï¼ŒAuthenticationManager æ¥æ”¶ä»£è¡¨ç”¨æˆ·å‡­æ®çš„ Authentication å¯¹è±¡ã€‚ AuthenticationManager å¾ªç¯è®¿é—®æ¯ä¸ª AuthenticationProvider å¹¶è°ƒç”¨å®ƒä»¬çš„ supports(Class\u0026lt;?\u0026gt; authentication) æ–¹æ³•æ¥ç¡®å®šæä¾›ç¨‹åºæ˜¯å¦æ”¯æŒç‰¹å®šç±»å‹çš„ Authentication å¯¹è±¡ã€‚æ¯ä¸ª AuthenticationProvider éƒ½å®ç°æ­¤æ–¹æ³•ï¼Œå¹¶ä¸”é€šå¸¸æ£€æŸ¥æä¾›ç¨‹åºæ˜¯å¦å¯ä»¥æ ¹æ®èº«ä»½éªŒè¯å¯¹è±¡çš„ç±»å¤„ç†èº«ä»½éªŒè¯è¯·æ±‚ã€‚\nè¿™æ˜¯ ProviderManager æºä»£ç ä¸­çš„ä»£ç ç‰‡æ®µï¼Œå®ƒæ˜¯ AuthenticationManager çš„é»˜è®¤å®ç°ï¼š\npublic Authentication authenticate(Authentication authentication) throws AuthenticationException { Class\u0026lt;? extends Authentication\u0026gt; toTest = authentication.getClass(); // ....... for (AuthenticationProvider provider : getProviders()) { if (!provider.supports(toTest)) { continue; } // ...... } ä¸€æ—¦æ‰¾åˆ°æ”¯æŒç»™å®šèº«ä»½éªŒè¯å¯¹è±¡çš„ AuthenticationProviderï¼ŒAuthenticationManager å°±ä¼šè°ƒç”¨æä¾›ç¨‹åºçš„ authenticate(Authentication authentication) æ–¹æ³•ã€‚æ­¤æ–¹æ³•æ‰§è¡Œç‰¹å®šäºè¯¥æä¾›ç¨‹åºçš„èº«ä»½éªŒè¯é€»è¾‘ï¼Œä¾‹å¦‚æ ¹æ®ç”¨æˆ·æ•°æ®åº“æˆ–å¤–éƒ¨èº«ä»½éªŒè¯æœåŠ¡éªŒè¯å‡­æ®ã€‚\n5. Spring Security å¦‚ä½•å¤„ç†ç”¨æˆ·æˆæƒï¼Ÿ åœ¨è¾ƒé«˜çš„å±‚é¢ä¸Šï¼ŒSpring Security é€šè¿‡ä¸€ä¸ªæ¶‰åŠå¤šä¸ªç»„ä»¶ååŒå·¥ä½œçš„è¿‡ç¨‹æ¥å¤„ç†ç”¨æˆ·æˆæƒã€‚\nä»¥ä¸‹æ˜¯è¯¥è¿‡ç¨‹çš„æ¦‚è¿°ã€‚\nä¸€æ—¦è¯·æ±‚é€šè¿‡èº«ä»½éªŒè¯ï¼Œå°±ä¼šè¿›å…¥æˆæƒé˜¶æ®µã€‚ FilterChainProxy è°ƒç”¨è¿‡æ»¤å™¨é“¾ä¸­é€‚å½“çš„æˆæƒè¿‡æ»¤å™¨ã€‚ AuthorizationFilter ä» SecurityContextHolder æ£€ç´¢ Authentication å¯¹è±¡ã€‚ç„¶åï¼Œå®ƒå°†æˆæƒè¿‡ç¨‹å§”æ‰˜ç»™ AuthorizationManagerï¼Œåè€…è´Ÿè´£æ ¹æ®é…ç½®çš„è®¿é—®æ§åˆ¶è§„åˆ™å’Œæƒé™åšå‡ºæœ€ç»ˆçš„æˆæƒå†³ç­–ã€‚ AuthorizationManager å–ä»£ AccessDecisionManager å’Œ AccessDecisionVoterã€‚ AuthorizationFilter ä½¿ç”¨ Authentication å¯¹è±¡å’Œ HTTP è¯·æ±‚æ„é€ Supplier å¯¹è±¡ã€‚ç„¶åå°†æ­¤ä¾›åº”å•†ä¼ é€’ç»™RequestMatcherDelegatingAuthorizationManager çš„ check () æ–¹æ³•ï¼Œè¿™æ˜¯ Spring Security ä½¿ç”¨çš„é»˜è®¤AuthorizationManagerã€‚ RequestMatcherDelegatingAuthorizationManager æ ¹æ®é…ç½®çš„ RequestMatcher å®ä¾‹è¯„ä¼°æä¾›çš„ Supplier ï¼Œä»¥ç¡®å®šè¯·æ±‚çš„èµ„æºæ˜¯å¦ä¸ä»»ä½•æŒ‡å®šçš„è®¿é—®æ§åˆ¶è§„åˆ™åŒ¹é…ã€‚ RequestMatcherDelegatingAuthorizationManager çš„ check æ–¹æ³•è¿”å›ä¸€ä¸ª AuthorizationDecision å¯¹è±¡ã€‚å¦‚æœæˆæƒå†³ç­–æ˜¯ false ï¼Œè¡¨ç¤ºè®¿é—®è¢«æ‹’ç»ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ï¼ˆé€šå¸¸æ˜¯ 403 Access Denied å¼‚å¸¸ï¼‰ã€‚ å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæˆæƒå†³ç­–æ˜¯ true ï¼Œè¡¨ç¤ºæˆäºˆè®¿é—®æƒé™ï¼Œåˆ™è¿‡æ»¤å™¨é“¾å°†ç»§ç»­æ‰§è¡Œï¼Œç›´åˆ°åˆ°è¾¾ DispatcherServletã€‚é“¾ä¸­çš„æ¯ä¸ªè¿‡æ»¤å™¨æ‰§è¡Œå…¶æŒ‡å®šçš„ä»»åŠ¡ï¼Œä¾‹å¦‚è¯·æ±‚é¢„å¤„ç†ã€å®‰å…¨æ£€æŸ¥æˆ–ä»»ä½•å…¶ä»–è‡ªå®šä¹‰åŠŸèƒ½ã€‚ 6.ä»€ä¹ˆæ˜¯å¯†ç ç¼–ç å™¨ï¼Ÿé»˜è®¤ç¼–ç å™¨æ˜¯ä»€ä¹ˆï¼Ÿ PasswordEncoder æ˜¯ä¸€ä¸ªç”¨äºä½¿ç”¨ encode() å’Œ matches() æ–¹æ³•å¯¹å¯†ç è¿›è¡Œç¼–ç å’ŒéªŒè¯çš„æ¥å£ã€‚å®ƒè´Ÿè´£è·å–ç”¨æˆ·çš„å¯†ç ï¼Œåº”ç”¨å•å‘å“ˆå¸Œç®—æ³•ï¼Œå¹¶å®‰å…¨åœ°å­˜å‚¨å“ˆå¸Œå¯†ç ã€‚å½“ç”¨æˆ·å°è¯•ç™»å½•æ—¶ï¼Œè¾“å…¥çš„å¯†ç ä¼šä½¿ç”¨ç›¸åŒçš„ç®—æ³•å†æ¬¡è¿›è¡Œå“ˆå¸Œå¤„ç†ï¼Œå¹¶å°†ç”Ÿæˆçš„å“ˆå¸Œå€¼ä¸å­˜å‚¨çš„å“ˆå¸Œå¯†ç è¿›è¡Œæ¯”è¾ƒä»¥è¿›è¡Œèº«ä»½ â€‹â€‹ éªŒè¯ã€‚\né»˜è®¤å¯†ç ç¼–ç å™¨æ˜¯ BCryptPasswordEncoderã€‚ BCrypt æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„å®‰å…¨å“ˆå¸Œç®—æ³•ï¼Œå®ƒç»“åˆäº†åŠ ç›å’Œæˆæœ¬å› ç´ ï¼Œä»¥é˜²æ­¢å„ç§ç±»å‹çš„æ”»å‡»ï¼ŒåŒ…æ‹¬æš´åŠ›æ”»å‡»ã€‚ BCryptPasswordEncoder æ˜¯å¯†ç å­˜å‚¨çš„ä¸é”™é€‰æ‹©ï¼Œå› ä¸ºå®ƒæä¾›äº†é«˜çº§åˆ«çš„å®‰å…¨æ€§ã€‚\n@Bean public PasswordEncoder passwordEncoder() { return new BCryptPasswordEncoder(); } å¯¹äºè‡ªå®šä¹‰è¦æ±‚ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é…ç½®è‡ªå®šä¹‰å¯†ç ç¼–ç å™¨ã€‚\nå®ç° PasswordEncoder æ¥å£ åˆ›å»ºä¸€ä¸ªå®ç° PasswordEncoder æ¥å£çš„ç±»ã€‚æ­¤ç±»å°†æä¾›ç¼–ç å’ŒéªŒè¯å¯†ç çš„å®ç°ã€‚\npublic class CustomPasswordEncoder implements PasswordEncoder { @Override public String encode(CharSequence rawPassword) // Implement your password encoding logic here // Return the encoded password as a String } @Override public boolean matches(CharSequence rawPassword, String encodedPassword) { // Implement your password verification logic here // Compare the rawPassword with the encodedPassword and return true or false } } é…ç½®è‡ªå®šä¹‰å¯†ç ç¼–ç å™¨ åœ¨ Spring Security é…ç½®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®šä¹‰ PasswordEncoder bean æ¥æŒ‡å®šè‡ªå®šä¹‰å¯†ç ç¼–ç å™¨çš„ä½¿ç”¨ã€‚ Spring Security å°†ä½¿ç”¨è¿™ä¸ª bean è¿›è¡Œå¯†ç ç¼–ç å’ŒéªŒè¯ã€‚\n@Configuration @EnableWebSecurity public class SecurityConfig { @Bean public PasswordEncoder passwordEncoder() { return new CustomPasswordEncoder(); } // Other security configuration code } 7. å¦‚ä½•åœ¨é Spring boot åº”ç”¨ç¨‹åºä¸­å¯ç”¨ Spring å®‰å…¨æ€§ï¼Ÿ å½“è°ˆåˆ°åœ¨é Spring Boot åº”ç”¨ç¨‹åºä¸­å¯ç”¨ Spring Security æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡å–å‡ ç§æ–¹æ³•ã€‚è®©æˆ‘ä»¬æ¢è®¨ä¸¤ç§æ ‡å‡†æ–¹æ³•ï¼š\nåŸºäº Java çš„é…ç½® åŸºäº XML çš„é…ç½® ä½¿ç”¨ AbstractSecurityWebApplicationInitializer è¿›è¡ŒåŸºäº Java çš„é…ç½® åœ¨ Java é…ç½®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰©å±• AbstractSecurityWebApplicationInitializer ç±»å¹¶é€‰æ‹©æ€§åœ°é‡å†™å…¶æ–¹æ³•æ¥é…ç½® DelegatingFilterProxy å¹¶å°†å…¶ä¸ springSecurityFilterChain bean å…³è”æ¥å¯ç”¨ Spring Securityã€‚å®ƒé¿å…åœ¨ web.xml æ–‡ä»¶ä¸­å†™å…¥ servlet-filter é…ç½®ã€‚\næˆ‘ä»¬å¯ä»¥åœ¨ SecurityConfig.java ä¸­å®šä¹‰è‡ªå®šä¹‰å®‰å…¨ beanã€‚\npublic class SpringSecurityInitializer extends AbstractSecurityWebApplicationInitializer { public SpringSecurityInitializer() { super(SecurityConfig.class); } } åŸºäº XML çš„é…ç½® åœ¨ XML é…ç½®ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ˜¾å¼å®šä¹‰ DelegatingFilterProxy bean å¹¶ä½¿ç”¨è¿‡æ»¤å™¨åç§°å°†å…¶æ˜ å°„åˆ° springSecurityFilterChain beanã€‚æ­¤é“¾æ¥é€šå¸¸åœ¨ web.xml æ–‡ä»¶ä¸­å®Œæˆï¼š\n\u0026lt;filter\u0026gt; \u0026lt;filter-name\u0026gt;springSecurityFilterChain\u0026lt;/filter-name\u0026gt; \u0026lt;filter-class\u0026gt;org.springframework.web.filter.DelegatingFilterProxy\u0026lt;/filter-class\u0026gt; \u0026lt;/filter\u0026gt; \u0026lt;filter-mapping\u0026gt; \u0026lt;filter-name\u0026gt;springSecurityFilterChain\u0026lt;/filter-name\u0026gt; \u0026lt;url-pattern\u0026gt;/*\u0026lt;/url-pattern\u0026gt; \u0026lt;dispatcher\u0026gt;ERROR\u0026lt;/dispatcher\u0026gt; \u0026lt;dispatcher\u0026gt;REQUEST\u0026lt;/dispatcher\u0026gt; \u0026lt;/filter-mapping\u0026gt; 8. å¦‚ä½•åœ¨ Spring boot åº”ç”¨ç¨‹åºä¸­å¯ç”¨ Spring å®‰å…¨æ€§ï¼Ÿ å¦‚æœæˆ‘ä»¬ä½¿ç”¨ Spring Bootï¼Œå¯ç”¨ Spring Security å°±éå¸¸ç®€å•ã€‚æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯å°† Spring Security starter æ·»åŠ åˆ°é¡¹ç›®çš„ä¾èµ–é¡¹ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹è‡ªåŠ¨é…ç½®å°†å¯ç”¨ã€‚è¿™æ˜¯å› ä¸ºå½“ Spring Security ä½äºç±»è·¯å¾„ä¸­æ—¶ï¼ŒWebSecurityEnablerConfiguration ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬æ¿€æ´» @EnableWebSecurity æ³¨è§£ã€‚\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-security\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; 9. Spring Security ä¸­@EnableWebSecurity çš„ç”¨é€”æ˜¯ä»€ä¹ˆï¼Ÿ @EnableWebSecurity æ³¨è§£ç”¨äºå¯ç”¨åº”ç”¨ç¨‹åºçš„ Web å®‰å…¨æ€§ã€‚å½“æ­¤æ³¨é‡Šæ·»åŠ åˆ°é…ç½®ç±»æ—¶ï¼Œè¡¨ç¤ºè¯¥ç±»å°†æä¾›å¿…è¦çš„é…ç½®å’Œè®¾ç½®æ¥ä¿æŠ¤ Web åº”ç”¨ç¨‹åºã€‚\nåœ¨é Spring boot åº”ç”¨ç¨‹åºä¸­ï¼Œ@EnableWebSecurity æ³¨é‡Šé™¤äº†æä¾›å¼€å‘äººå‘˜ç¼–å†™çš„è‡ªå®šä¹‰é…ç½® bean ä¹‹å¤–ï¼Œè¿˜ä¼šéšå¼æ‰§è¡Œä»¥ä¸‹ä»»åŠ¡ã€‚\nåˆ›å»º Spring Security è¿‡æ»¤å™¨é“¾ï¼šå®ƒåˆå§‹åŒ–å¹¶é…ç½®è´Ÿè´£å¤„ç†ä¼ å…¥è¯·æ±‚å’Œåº”ç”¨å®‰å…¨æªæ–½çš„è¿‡æ»¤å™¨é“¾ã€‚ é…ç½®å®‰å…¨ä¸Šä¸‹æ–‡ï¼šå®ƒè®¾ç½®ç”¨äºå¤„ç†èº«ä»½éªŒè¯å’Œæˆæƒçš„å®‰å…¨ä¸Šä¸‹æ–‡ã€‚å®‰å…¨ä¸Šä¸‹æ–‡ä¿å­˜æœ‰å…³å½“å‰ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·åŠå…¶æˆäºˆçš„æƒé™çš„ä¿¡æ¯ã€‚ åœ¨ Spring boot åº”ç”¨ç¨‹åºä¸­ï¼Œä½¿ç”¨ @EnableWebSecurity æ³¨é‡Šæ˜¯å¯é€‰çš„ã€‚ Spring boot å®‰å…¨è‡ªåŠ¨é…ç½®æä¾›äº†ä¸ä½¿ç”¨@EnableWebSecurity æ³¨é‡Šå‡ ä¹ç›¸åŒçš„åŠŸèƒ½ã€‚\nå½“åœ¨ Spring boot åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ @EnableWebSecurity æ—¶ï¼Œé»˜è®¤çš„è‡ªåŠ¨é…ç½®ä¼šåé€€ï¼Œå¹¶æä¾›çš„é…ç½®ä¼˜å…ˆã€‚\n@Configuration @EnableWebSecurity public class SecurityConfig { @Bean public WebSecurityCustomizer webSecurityCustomizer() { return (web) -\u0026gt; web.ignoring() .requestMatchers(\u0026#34;/resources/**\u0026#34;); } @Bean public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception { http.authorizeHttpRequests() .requestMatchers(\u0026#34;/public/**\u0026#34;).permitAll() .anyRequest().hasRole(\u0026#34;USER\u0026#34;) .and() .formLogin().permitAll(); return http.build(); } // Possibly more bean methods ... } 10. Spring Security ä¸­çš„è§’è‰²å’Œæƒé™æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ åœ¨ Spring Security ä¸­ï¼Œè§’è‰²å’Œæƒé™éƒ½ç”¨äºå®šä¹‰å’Œç®¡ç†ç”¨æˆ·æƒé™ã€‚ç„¶è€Œï¼Œä¸¤è€…ä¹‹é—´æœ‰ä¸€ä¸ªå¾®å¦™çš„åŒºåˆ«ï¼š\nè§’è‰²ï¼šè§’è‰²ä»£è¡¨å¹¿æ³›çš„æƒé™ç±»åˆ«æˆ–æƒé™ç»„ã€‚å®ƒé€šå¸¸ç”¨äºå°†ç›¸å…³æƒé™åˆ†ç»„åœ¨ä¸€èµ·ã€‚å¯ä»¥å°†è§’è‰²åˆ†é…ç»™ç”¨æˆ·ï¼Œå¹¶ä¸”ç”¨æˆ·å¯ä»¥æ‹¥æœ‰å¤šä¸ªè§’è‰²ã€‚ä¾‹å¦‚ï¼Œè§’è‰²å¯ä»¥æ˜¯â€œç®¡ç†å‘˜â€ã€â€œç”¨æˆ·â€æˆ–â€œç®¡ç†å‘˜â€ã€‚è§’è‰²é€šå¸¸ç”¨äºé«˜çº§è®¿é—®æ§åˆ¶å†³ç­–ã€‚ æƒé™ï¼šæƒé™ä¹Ÿç§°ä¸ºæƒé™æˆ–ç‰¹æƒï¼Œè¡¨ç¤ºç”¨æˆ·å¯ä»¥æ‹¥æœ‰çš„ç‰¹å®šæƒé™ã€‚å®ƒå®šä¹‰äº†ç»†ç²’åº¦çš„è®¿é—®æ§åˆ¶çº§åˆ«ã€‚æƒé™ç›´æ¥æˆ–é€šè¿‡è§’è‰²æˆäºˆç”¨æˆ·ã€‚ä¾‹å¦‚ï¼Œæƒé™å¯ä»¥æ˜¯â€œREAD_DATAâ€ã€â€œWRITE_DATAâ€æˆ–â€œDELETE_DATAâ€ã€‚æƒå¨æœºæ„ç”¨äºç²¾ç¡®çš„è®¿é—®æ§åˆ¶å†³ç­–ã€‚ 11.å¦‚ä½•ä½¿ç”¨æ³¨è§£å®ç°æ–¹æ³•å®‰å…¨ï¼Ÿ é™¤äº† URL çº§åˆ«çš„å®‰å…¨æ€§ä¹‹å¤–ï¼ŒSpring Security è¿˜æ”¯æŒæ–¹æ³•çº§åˆ«çš„å®‰å…¨æ€§ã€‚è¦åœ¨ Spring Security ä¸­ä½¿ç”¨æ³¨è§£å®ç°æ–¹æ³•çº§å®‰å…¨æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨@EnableMethodSecurity æ³¨è§£ä»»ä½•@Configuration ç±»ã€‚\n@Configuration @EnableWebSecurity @EnableMethodSecurity public class SecurityConfig { //.. } ç°åœ¨æˆ‘ä»¬å¯ä»¥é€šè¿‡@Securedã€@PreAuthorizeã€@PostAuthorizeã€@PreFilter å’Œ@PostFilter æ³¨è§£æ¥æˆæƒæ–¹æ³•è°ƒç”¨ï¼ŒåŒ…æ‹¬è¾“å…¥å‚æ•°å’Œè¿”å›å€¼ã€‚\nåœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œ deleteProduct æ–¹æ³•ä½¿ç”¨ @PreAuthorize æ³¨é‡Šè¿›è¡Œä¿æŠ¤ï¼Œè¡¨è¾¾å¼ hasRole('ADMIN') ç¡®ä¿åªæœ‰å…·æœ‰â€œADMINâ€è§’è‰²çš„ç”¨æˆ·æ‰èƒ½è°ƒç”¨æ­¤æ–¹æ³•ã€‚\n@PreAuthorize(\u0026#34;hasRole(\u0026#39;ADMIN\u0026#39;)\u0026#34;) public void deleteProduct(Long productId) { // Method logic for deleting a product } é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring boot ä¸­æ–¹æ³•å®‰å…¨æ€§æ˜¯ç¦ç”¨çš„ã€‚\n12.ä»€ä¹ˆæ˜¯åŸºæœ¬èº«ä»½éªŒè¯ï¼Ÿå¦‚ä½•å®æ–½ï¼Ÿ åŸºæœ¬èº«ä»½éªŒè¯æ˜¯ä¸€ç§ç®€å•çš„èº«ä»½éªŒè¯æœºåˆ¶ï¼Œå…¶ä¸­å®¢æˆ·ç«¯åœ¨æ¯ä¸ªè¯·æ±‚çš„ HTTP æ ‡å¤´ä¸­åŒ…å«ç”¨æˆ·åå’Œå¯†ç ï¼ˆå‡­æ®ä»¥â€œ username:password â€æ ¼å¼å‘é€ï¼Œç„¶ååœ¨åŒ…å«ä¹‹å‰è¿›è¡Œ Base64 ç¼–ç åœ¨ Authorization æ ‡å¤´ä¸­ï¼‰ã€‚ç„¶åï¼ŒæœåŠ¡å™¨éªŒè¯å‡­æ®ï¼Œå¦‚æœæ­£ç¡®ï¼Œåˆ™æˆäºˆå¯¹æ‰€è¯·æ±‚èµ„æºçš„è®¿é—®æƒé™ã€‚\nä¸ºäº†åœ¨ Spring Security ä¸­å¯ç”¨åŸºæœ¬èº«ä»½éªŒè¯ï¼Œæˆ‘ä»¬ä½¿ç”¨ *httpBasic*() æ–¹æ³•ã€‚\n@Bean public SecurityFilterChain securityFilterChain (HttpSecurity http) throws Exception { http.authorizeHttpRequests() .anyRequest().authenticated() .and() .httpBasic(); return http.build(); } 13.ä»€ä¹ˆæ˜¯ JWT è®¤è¯ï¼Ÿå¦‚ä½•å®æ–½ï¼Ÿ JWTï¼ˆJSON Web Tokenï¼‰èº«ä»½éªŒè¯æ˜¯ä¸€ç§æµè¡Œçš„èº«ä»½éªŒè¯æœºåˆ¶ï¼Œå®ƒä½¿ç”¨åŸºäº JSON çš„ä»¤ç‰Œåœ¨å„æ–¹ä¹‹é—´å®‰å…¨åœ°ä¼ è¾“èº«ä»½éªŒè¯å’Œæˆæƒä¿¡æ¯ã€‚å®ƒæ”¯æŒæ— çŠ¶æ€èº«ä»½éªŒè¯ï¼Œå¹¶ä¸”æ— éœ€åœ¨æœåŠ¡å™¨ç«¯å­˜å‚¨ä¼šè¯ã€‚\nè¦åœ¨ Spring Security ä¸­å®ç° JWT èº«ä»½éªŒè¯ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š\nåŒ…å«å¿…è¦çš„ä¾èµ–é¡¹ï¼š spring-security-jwt å’Œç”¨äº JWT å¤„ç†çš„åº“ï¼ˆä¾‹å¦‚ jjwt ï¼‰ã€‚ å®ç° JWT ä»¤ç‰Œæä¾›ç¨‹åºï¼šåˆ›å»ºä¸€ä¸ªè´Ÿè´£ç”Ÿæˆ JWT ä»¤ç‰Œçš„ç±»ã€‚æ­¤ç±»åº”åŒ…å«ç”¨äºåˆ›å»ºå’Œç­¾ç½² JWTã€è®¾ç½®å£°æ˜ä»¥åŠæŒ‡å®šè¿‡æœŸæ—¶é—´çš„æ–¹æ³•ã€‚ å®ç° JWT èº«ä»½éªŒè¯è¿‡æ»¤å™¨ï¼šåˆ›å»ºè‡ªå®šä¹‰è¿‡æ»¤å™¨æ¥æ‹¦æˆªä¼ å…¥è¯·æ±‚ï¼Œä»è¯·æ±‚æ ‡å¤´ä¸­æå– JWT ä»¤ç‰Œå¹¶å¯¹å…¶è¿›è¡ŒéªŒè¯ã€‚æ­¤è¿‡æ»¤å™¨åº”ä½¿ç”¨ JWT ä»¤ç‰Œæä¾›ç¨‹åºæ¥éªŒè¯ä»¤ç‰Œçš„ç­¾åå¹¶æå–å¿…è¦çš„ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ã€‚ ä½¿ç”¨ Spring Security é…ç½® JWT èº«ä»½éªŒè¯è¿‡æ»¤å™¨ï¼šæˆ‘ä»¬åº”è¯¥é…ç½® JWT èº«ä»½éªŒè¯è¿‡æ»¤å™¨ä»¥ç”¨äºå¤„ç†èº«ä»½éªŒè¯è¯·æ±‚ å®ç°ç”¨æˆ·è¯¦ç»†ä¿¡æ¯æœåŠ¡ï¼šåˆ›å»ºä¸€ä¸ªç”¨æˆ·è¯¦ç»†ä¿¡æ¯æœåŠ¡ï¼Œæ ¹æ® JWT ä»¤ç‰Œä¸­å­˜å‚¨çš„ä¿¡æ¯æ£€ç´¢ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ã€‚è¯¥æœåŠ¡è´Ÿè´£ä»ç”¨æˆ·å­˜å‚¨åº“æˆ–ä»»ä½•å…¶ä»–æ•°æ®æºè·å–ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ã€‚ æœ‰å…³å®ç°ç»†èŠ‚çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·é˜…è¯» Spring Security ä¸­çš„ JWT èº«ä»½éªŒè¯ä¸€æ–‡ã€‚\n14. å¦‚ä½•å®ç° OAuth2 å®‰å…¨æ€§ï¼Ÿ OAuth2 æ˜¯ä¸€ä¸ªæˆæƒæ¡†æ¶ï¼Œå…è®¸åº”ç”¨ç¨‹åºè·å¾—å¯¹ç”¨æˆ·å¸æˆ·çš„æœ‰é™è®¿é—®æƒé™ã€‚å®ƒæ¶‰åŠå¤šä¸ªç»„ä»¶ï¼ŒåŒ…æ‹¬æˆæƒæœåŠ¡å™¨å’Œèµ„æºæœåŠ¡å™¨ã€‚æˆæƒæœåŠ¡å™¨å¤„ç†èº«ä»½éªŒè¯å¹¶é¢å‘è®¿é—®ä»¤ç‰Œï¼Œè€Œèµ„æºæœåŠ¡å™¨æ‰˜ç®¡å—ä¿æŠ¤çš„èµ„æºå¹¶éªŒè¯è®¿é—®ä»¤ç‰Œã€‚\nè¦å®ç° OAuth2 å®‰å…¨æ€§ï¼Œæ‚¨éœ€è¦é…ç½®æˆæƒæœåŠ¡å™¨å’Œèµ„æºæœåŠ¡å™¨ã€‚\næˆæƒæœåŠ¡å™¨ æˆæƒæœåŠ¡å™¨è´Ÿè´£å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯å¹¶é¢å‘è®¿é—®ä»¤ç‰Œã€‚åœ¨ Spring Security ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ AuthorizationServerConfigurerAdapter ç±»æ¥é…ç½®æˆæƒæœåŠ¡å™¨ã€‚\nä»¥ä¸‹ç±»è®¾ç½®æˆæƒæœåŠ¡å™¨ï¼Œå®šä¹‰å®‰å…¨çº¦æŸï¼Œå¹¶é…ç½®å¯ä»¥è®¿é—®æœåŠ¡å™¨çš„å®¢æˆ·ç«¯ä»¥è·å–è®¿é—®ä»¤ç‰Œä»¥è¿›è¡Œèº«ä»½ â€‹â€‹ éªŒè¯å’Œæˆæƒã€‚\n@Configuration @EnableAuthorizationServer public class OAuth2AuthorizationServer extends AuthorizationServerConfigurerAdapter { @Autowired private BCryptPasswordEncoder passwordEncoder; @Override public void configure(AuthorizationServerSecurityConfigurer security) throws Exception { security .tokenKeyAccess(\u0026#34;permitAll()\u0026#34;) .checkTokenAccess(\u0026#34;isAuthenticated()\u0026#34;); .allowFormAuthenticationForClients(); } @Override public void configure(ClientDetailsServiceConfigurer clients) throws Exception { clients.inMemory() .withClient(\u0026#34;client-id\u0026#34;) .secret(\u0026#34;client-secret\u0026#34;) .authorizedGrantTypes(\u0026#34;authorization_code\u0026#34;, \u0026#34;password\u0026#34;, \u0026#34;refresh_token\u0026#34;) .scopes(\u0026#34;read\u0026#34;, \u0026#34;write\u0026#34;) .accessTokenValiditySeconds(3600) .refreshTokenValiditySeconds(86400); } } èµ„æºæœåŠ¡å™¨ èµ„æºæœåŠ¡å™¨æ‰˜ç®¡å—ä¿æŠ¤çš„èµ„æºå¹¶éªŒè¯è®¿é—®ä»¤ç‰Œã€‚åœ¨ Spring Security ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ResourceServerConfigurerAdapter ç±»æ¥é…ç½®èµ„æºæœåŠ¡å™¨ã€‚\nåœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼ŒOAuth2ResourceServerConfig é€šè¿‡æŒ‡å®šä¸åŒ API ç«¯ç‚¹çš„è®¿é—®è§„åˆ™æ¥é…ç½®èµ„æºæœåŠ¡å™¨ã€‚å®ƒå…è®¸ä¸å—é™åˆ¶åœ°è®¿é—®å…¬å…±èµ„æºï¼ŒåŒæ—¶è¦æ±‚å¯¹ç§äººè®¿é—®è¿›è¡Œèº«ä»½éªŒè¯ã€‚\n@Configuration @EnableResourceServer public class OAuth2ResourceServerConfig extends ResourceServerConfigurerAdapter { @Override public void configure(HttpSecurity http) throws Exception { http.authorizeRequests() .antMatchers(\u0026#34;/api/public/**\u0026#34;).permitAll() .antMatchers(\u0026#34;/api/private/**\u0026#34;).authenticated(); } } èµ„æºæœåŠ¡å™¨éœ€è¦éªŒè¯è®¿é—®ä»¤ç‰Œï¼Œä»¥ç¡®ä¿å®ƒæ˜¯ç”±å—ä¿¡ä»»çš„æˆæƒæœåŠ¡å™¨é¢å‘çš„ï¼Œå¹¶ä¸”æ²¡æœ‰è¿‡æœŸæˆ–è¢«ç¯¡æ”¹ã€‚\nä¸€ç§å¸¸è§çš„æ–¹æ³•æ˜¯ä½¿ç”¨ Spring Security æä¾›çš„ RemoteTokenServices ç±»ã€‚èµ„æºæœåŠ¡å™¨å‘æˆæƒæœåŠ¡å™¨çš„ /oauth/check_token ç«¯ç‚¹å‘å‡ºè¯·æ±‚ï¼Œå¹¶å°†è®¿é—®ä»¤ç‰Œä½œä¸ºå‚æ•°ä¼ é€’ã€‚\n@Bean public ResourceServerTokenServices tokenService() { RemoteTokenServices tokenServices = new RemoteTokenServices(); tokenServices.setClientId(\u0026#34;client-id\u0026#34;); tokenServices.setClientSecret(\u0026#34;client-secret\u0026#34;); tokenServices.setCheckTokenEndpointUrl(\u0026#34;http://localhost:8080/oauth/check_token\u0026#34;); return tokenServices; } 15. Spring Security ä¸­çš„ CSRF ä¿æŠ¤æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•å®æ–½ï¼Ÿ CSRFï¼ˆè·¨ç«™ç‚¹è¯·æ±‚ä¼ªé€ ï¼‰ä¿æŠ¤æ˜¯ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œå¯é˜²æ­¢æ”»å‡»è€…åˆ©ç”¨ç”¨æˆ·å’Œç½‘ç«™ä¹‹é—´çš„ä¿¡ä»»ã€‚å®ƒå¯ä»¥é˜²èŒƒ CSRF æ”»å‡»ï¼Œå³æ”»å‡»è€…åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…æˆ–æœªåŒæ„çš„æƒ…å†µä¸‹è¯±éª—ç”¨æˆ·çš„æµè§ˆå™¨åœ¨ç½‘ç«™ä¸Šæ‰§è¡Œä¸éœ€è¦çš„æ“ä½œã€‚\nè¦åœ¨ Spring Security ä¸­å®ç° CSRF ä¿æŠ¤ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š\nåœ¨å®¢æˆ·ç«¯ä»£ç ï¼ˆé€šå¸¸é‡‡ç”¨ HTML è¡¨å•ï¼‰ä¸­ï¼Œå‘åº”ç”¨ç¨‹åºç«¯ç‚¹å‘å‡ºè¯·æ±‚æ—¶ï¼Œå°† CSRF ä»¤ç‰Œä½œä¸ºéšè—å­—æ®µæˆ–è¯·æ±‚æ ‡å¤´åŒ…å«åœ¨å†…ã€‚ åœ¨æœåŠ¡å™¨ç«¯ï¼Œé…ç½® Spring Security ä»¥æœŸæœ›å¹¶éªŒè¯ä¼ å…¥è¯·æ±‚ä¸­çš„ CSRF ä»¤ç‰Œã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Security è‡ªåŠ¨å¯ç”¨ CSRF ä¿æŠ¤ã€‚å®ƒå°† CSRF ä»¤ç‰Œæ·»åŠ åˆ°è¡¨å•ä¸­å¹¶å°†å…¶åŒ…å«åœ¨åç»­è¯·æ±‚ä¸­ã€‚\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨ csrf() æ–¹æ³•åœ¨ Spring Security ä¸­é…ç½®/è‡ªå®šä¹‰ CSRF ä¿æŠ¤ã€‚\n@Configuration public class SecurityWithCsrfCookieConfig { @Bean public SecurityFilterChain filterChain(HttpSecurity http) throws Exception { http .csrf() .csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse()); return http.build(); } } åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°† CSRF ä¿æŠ¤é…ç½®ä¸ºä½¿ç”¨ CookieCsrfTokenRepository å¹¶é€šè¿‡è®¾ç½® withHttpOnlyFalse() ç¡®ä¿ JavaScript å¯ä»¥è®¿é—® CSRF ä»¤ç‰Œã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®æˆ‘ä»¬çš„éœ€æ±‚é€‰æ‹©ä¸åŒçš„ CsrfTokenRepository å®ç°ã€‚\n16. ä»€ä¹ˆæ˜¯ CORS ä»¥åŠ Spring Security ä¸­å¦‚ä½•å¤„ç†å®ƒï¼Ÿ CORSï¼ˆè·¨æºèµ„æºå…±äº«ï¼‰æ˜¯ Web æµè§ˆå™¨å¼ºåˆ¶æ‰§è¡Œçš„ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œç”¨äºé™åˆ¶è·¨æº HTTP è¯·æ±‚ã€‚å®ƒå…è®¸æœåŠ¡å™¨æŒ‡å®šå…è®¸å“ªäº›æºï¼ˆåŸŸï¼‰è®¿é—®å…¶èµ„æºã€‚\nåœ¨ Spring Security ä¸­ï¼Œæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­é…ç½® CORSï¼š\nå…¨å±€é…ç½® æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»º CorsConfigurationSource ç±»çš„ bean æ¥å…¨å±€é…ç½® CORS æ”¯æŒã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°† CORS ç­–ç•¥é…ç½®ä¸ºå…è®¸æ¥è‡ªæŒ‡å®šæºï¼ˆæœ¬ä¾‹ä¸­ä¸º http://localhost:8081 ï¼‰çš„è·¨æºè¯·æ±‚ã€‚\n@Bean public CorsConfigurationSource corsConfigurationSource() { CorsConfiguration config = new CorsConfiguration(); config.setAllowCredentials(true); config.addAllowedHeader(\u0026#34;*\u0026#34;); config.addAllowedMethod(\u0026#34;*\u0026#34;); config.addAllowedOrigin(\u0026#34;http://localhost:8081\u0026#34;); UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource(); source.registerCorsConfiguration(\u0026#34;/**\u0026#34;, config); return source; } å¤„ç†ç¨‹åºæ–¹æ³•ç‰¹å®šçš„é…ç½® å¦‚æœæˆ‘ä»¬åªéœ€è¦ç‰¹å®šç«¯ç‚¹çš„ CORSï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ–¹æ³•çº§åˆ«ä½¿ç”¨ @CrossOrigin æ³¨é‡Šã€‚è¿™å…è®¸æˆ‘ä»¬æŒ‡å®šå…è®¸çš„æºã€HTTP æ–¹æ³•å’Œå…¶ä»–é…ç½®ã€‚\nåœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ /api/resource ç«¯ç‚¹ä»…å…è®¸ä½¿ç”¨æŒ‡å®š HTTP æ–¹æ³•æ¥è‡ª http://example.com çš„è·¨æºè¯·æ±‚ã€‚\n@RestController public class MyController { @GetMapping(\u0026#34;/api/resource\u0026#34;) @CrossOrigin(origins = \u0026#34;http://example.com\u0026#34;, methods = {RequestMethod.GET, RequestMethod.POST}) public String getResource() { //... } } 17.è§£é‡Šä¸€ä¸‹åŸºäºä¼šè¯çš„èº«ä»½éªŒè¯ï¼Ÿ åŸºäºä¼šè¯çš„èº«ä»½éªŒè¯æ˜¯ Web åº”ç”¨ç¨‹åºä¸­ç®¡ç†ç”¨æˆ·èº«ä»½éªŒè¯çš„å¸¸ç”¨æ–¹æ³•ã€‚å®ƒæ¶‰åŠä½¿ç”¨ä¼šè¯å’Œ cookie æ¥ç»´æŠ¤èº«ä»½éªŒè¯çŠ¶æ€å¹¶è¯†åˆ«ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ã€‚\nåŸºäºä¼šè¯çš„èº«ä»½éªŒè¯çš„å·¥ä½œåŸç†å¦‚ä¸‹ï¼š\nç”¨æˆ·èº«ä»½éªŒè¯ï¼šå½“ç”¨æˆ·ä½¿ç”¨æœ‰æ•ˆå‡­æ®ç™»å½•åº”ç”¨ç¨‹åºæ—¶ï¼ŒæœåŠ¡å™¨ä¼šéªŒè¯å‡­æ®å¹¶ä¸ºç”¨æˆ·åˆ›å»ºæ–°ä¼šè¯ã€‚ä¼šè¯é€šå¸¸ç”±å”¯ä¸€çš„ä¼šè¯ ID ç»„æˆã€‚ ä¼šè¯åˆ›å»ºï¼šæœåŠ¡å™¨å°†ç”¨æˆ·çš„ä¼šè¯ ID å­˜å‚¨åœ¨ä¼šè¯å­˜å‚¨ï¼ˆä¾‹å¦‚å†…å­˜æˆ–æ•°æ®åº“ï¼‰ä¸­ï¼Œå¹¶å°†å…¶ä¸ç”¨æˆ·çš„èº«ä»½éªŒè¯è¯¦ç»†ä¿¡æ¯å’Œä»»ä½•ç›¸å…³ä¼šè¯æ•°æ®ï¼ˆä¾‹å¦‚ç”¨æˆ·è§’è‰²ã€æƒé™ï¼‰ç›¸å…³è”ã€‚ ä¼šè¯ ID å­˜å‚¨ï¼šæœåŠ¡å™¨å°†ä¼šè¯ ID ä½œä¸º cookie æˆ–å“åº”è´Ÿè½½çš„ä¸€éƒ¨åˆ†å‘é€å›å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯çš„ Web æµè§ˆå™¨å­˜å‚¨æ­¤ä¼šè¯ IDã€‚ åç»­è¯·æ±‚ï¼šå®¢æˆ·ç«¯çš„ Web æµè§ˆå™¨è‡ªåŠ¨å°†ä¼šè¯ ID åŒ…å«åœ¨åç»­è¯·æ±‚çš„è¯·æ±‚æ ‡å¤´ï¼ˆé€šå¸¸ä½œä¸º cookieï¼‰ä¸­ã€‚è¿™å…è®¸æœåŠ¡å™¨è¯†åˆ«ç”¨æˆ·çš„ä¼šè¯å¹¶æ£€ç´¢ç›¸å…³çš„èº«ä»½éªŒè¯è¯¦ç»†ä¿¡æ¯ã€‚ ä¼šè¯éªŒè¯ï¼šæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚åï¼Œä¼šéªŒè¯ä¼šè¯ IDï¼Œä»¥ç¡®ä¿å…¶çœŸå®æ€§å’Œå®Œæ•´æ€§ã€‚å®ƒæ£€æŸ¥ä¼šè¯æ˜¯å¦å­˜åœ¨å¹¶ä¸”ä»ç„¶æœ‰æ•ˆï¼ˆä¾‹å¦‚ï¼Œæœªè¿‡æœŸæˆ–æ— æ•ˆï¼‰ã€‚å¦‚æœä¼šè¯æœ‰æ•ˆï¼ŒæœåŠ¡å™¨å°†è®¤ä¸ºç”¨æˆ·å·²é€šè¿‡èº«ä»½éªŒè¯å¹¶ç»§ç»­å¤„ç†è¯·æ±‚ã€‚ ä¼šè¯è¿‡æœŸï¼šä¼šè¯é€šå¸¸æœ‰ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œä»¥ç¡®ä¿å®‰å…¨æ€§å’Œç®¡ç†æœåŠ¡å™¨èµ„æºã€‚ä¸€æ—¦ä¼šè¯è¿‡æœŸï¼Œç”¨æˆ·éœ€è¦é€šè¿‡é‡æ–°ç™»å½•æ¥é‡æ–°è¿›è¡Œèº«ä»½éªŒè¯ã€‚ æ³¨é”€ï¼šå½“ç”¨æˆ·æ³¨é”€æ—¶ï¼ŒæœåŠ¡å™¨ä¼šé€šè¿‡å°†ä¼šè¯ä»ä¼šè¯å­˜å‚¨ä¸­åˆ é™¤æ¥ä½¿å…¶æ— æ•ˆã€‚å®¢æˆ·ç«¯çš„ Web æµè§ˆå™¨è¿˜ä¼šåˆ é™¤ä¼šè¯ ID cookieã€‚ 18. å¦‚ä½•é˜²æ­¢æš´åŠ›ç ´è§£ï¼Ÿ é˜²æ­¢æš´åŠ›æ”»å‡»æ¶‰åŠå®æ–½ä¸€äº›æªæ–½ï¼Œä½¿æ”»å‡»è€…éš¾ä»¥é€šè¿‡é‡å¤ç™»å½•å°è¯•çŒœæµ‹æœ‰æ•ˆå‡­æ®ã€‚\nä»¥ä¸‹æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨æ¥é™ä½æš´åŠ›æ”»å‡»é£é™©çš„ä¸€äº›ç­–ç•¥ï¼š\nå¸æˆ·é”å®šï¼šå®æ–½å¸æˆ·é”å®šæœºåˆ¶ï¼Œåœ¨ä¸€å®šæ¬¡æ•°çš„ç™»å½•å°è¯•å¤±è´¥åä¸´æ—¶é”å®šç”¨æˆ·å¸æˆ·ã€‚è¿™å¯ä»¥é˜»æ­¢æ”»å‡»è€…ä¸æ–­çŒœæµ‹å¯†ç ã€‚å¸æˆ·è¢«é”å®šåï¼Œç”¨æˆ·å¯ä»¥æ”¶åˆ°é€šçŸ¥æˆ–è·å¾—å®‰å…¨è§£é”å¸æˆ·çš„æ–¹æ³•ï¼Œä¾‹å¦‚é€šè¿‡å¯†ç é‡ç½®è¿‡ç¨‹æˆ–è”ç³»å®¢æˆ·æ”¯æŒã€‚ é€Ÿç‡é™åˆ¶ï¼šåº”ç”¨é€Ÿç‡é™åˆ¶æŠ€æœ¯æ¥é™åˆ¶ç‰¹å®šæ—¶é—´èŒƒå›´å†…çš„ç™»å½•å°è¯•æ¬¡æ•°ã€‚è¿™å¯ä»¥é˜²æ­¢æ”»å‡»è€…å¿«é€Ÿè¿ç»­å‘å‡ºå¤šä¸ªç™»å½•è¯·æ±‚ã€‚å®æ–½é€Ÿç‡é™åˆ¶å¯ä»¥å‡æ…¢æ”»å‡»è¿‡ç¨‹å¹¶é™ä½å…¶æ•ˆç‡ï¼Œä»è€Œå¸®åŠ©å‡è½»æš´åŠ›æ”»å‡»ã€‚ CAPTCHA æˆ– reCAPTCHAï¼šå°† CAPTCHAï¼ˆåŒºåˆ†è®¡ç®—æœºå’Œäººç±»çš„å®Œå…¨è‡ªåŠ¨åŒ–å…¬å…±å›¾çµæµ‹è¯•ï¼‰æˆ– reCAPTCHA æŒ‘æˆ˜é›†æˆåˆ°æ‚¨çš„ç™»å½•è¡¨å•ä¸­ã€‚è¿™äº›æŒ‘æˆ˜è¦æ±‚ç”¨æˆ·è§£å†³è°œé¢˜æˆ–è¾“å…¥æ‰­æ›²å›¾åƒä¸­æ˜¾ç¤ºçš„å­—ç¬¦ï¼Œè¿™æœ‰åŠ©äºç¡®ä¿ç™»å½•å°è¯•æ˜¯ç”±äººç±»ç”¨æˆ·è€Œä¸æ˜¯è‡ªåŠ¨è„šæœ¬è¿›è¡Œçš„ã€‚ åŒå› ç´ èº«ä»½éªŒè¯ (2FA)ï¼šå®æ–½åŒå› ç´ èº«ä»½éªŒè¯ä»¥æ·»åŠ é¢å¤–çš„å®‰å…¨å±‚ã€‚ä½¿ç”¨ 2FAï¼Œé™¤äº†ç”¨æˆ·åå’Œå¯†ç ä¹‹å¤–ï¼Œç”¨æˆ·è¿˜éœ€è¦æä¾›ç¬¬äºŒç§å½¢å¼çš„èº«ä»½éªŒè¯ï¼Œä¾‹å¦‚å‘é€åˆ°å…¶ç§»åŠ¨è®¾å¤‡çš„å”¯ä¸€ä»£ç ã€‚å³ä½¿æ”»å‡»è€…è®¾æ³•è·å¾—æœ‰æ•ˆå‡­æ®ï¼Œè¿™ä¹Ÿå¤§å¤§é™ä½äº†æš´åŠ›æ”»å‡»æˆåŠŸçš„é£é™©ã€‚ 19. Spring Security ä¸­å¦‚ä½•å¤„ç†æ³¨é”€ï¼Ÿ åœ¨åŸºäºä¼šè¯çš„èº«ä»½éªŒè¯ä¸­ï¼Œæ³¨é”€æ¶‰åŠé”€æ¯ä¼šè¯å¯¹è±¡å¹¶åˆ é™¤ç”¨æˆ·æµè§ˆå™¨ä¸­çš„ä¼šè¯ cookieã€‚è¿™å¯ä»¥é€šè¿‡é…ç½® HttpSecurity æ¥å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nhttp // Other security configurations... .logout() .invalidateHttpSession(true) // Invalidate the user\u0026#39;s HttpSession .deleteCookies(\u0026#34;JSESSIONID\u0026#34;) // Remove the session cookie .logoutSuccessUrl(\u0026#34;/login?logout\u0026#34;) // Redirect to the logout success URL .permitAll(); // Allow anyone to access the logout URL 20. è¿ç§»è¿‡ç¨‹ä¸­å¦‚ä½•æ”¯æŒå¤šä¸ªå¯†ç ç¼–ç å™¨ï¼Ÿ è¦åœ¨ Spring Security è¿ç§»æœŸé—´æ”¯æŒå¤šä¸ªå¯†ç ç¼–ç å™¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Spring Security æä¾›çš„ DelegatingPasswordEncoderã€‚ DelegatingPasswordEncoder å…è®¸æ‚¨é…ç½®å¤šä¸ªå¯†ç ç¼–ç å™¨ï¼Œå¹¶å°†æ¯ä¸ªç¼–ç å™¨ä¸æ ‡è¯†ç¬¦æˆ–â€œidâ€ç›¸å…³è”ã€‚\n@Bean public PasswordEncoder passwordEncoder() { Map\u0026lt;String, PasswordEncoder\u0026gt; encoders = new HashMap\u0026lt;\u0026gt;(); encoders.put(\u0026#34;bcrypt\u0026#34;, new BCryptPasswordEncoder()); encoders.put(\u0026#34;custom\u0026#34;, new CustomPasswordEncoder()); // Replace with your custom encoder return new DelegatingPasswordEncoder(\u0026#34;bcrypt\u0026#34;, encoders); } åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é…ç½®äº†ä¸¤ä¸ªå¯†ç ç¼–ç å™¨ï¼š\nBCryptPasswordEncoder CustomPasswordEncoder DelegatingPasswordEncoder ä½¿ç”¨é»˜è®¤ç¼–ç å™¨ IDï¼ˆâ€œbcryptâ€ï¼‰å’Œç¼–ç å™¨æ˜ å°„è¿›è¡Œåˆå§‹åŒ–ã€‚åœ¨èº«ä»½éªŒè¯è¿‡ç¨‹ä¸­ï¼ŒSpring Security å°†æ ¹æ®ç¼–ç å¯†ç çš„å‰ç¼€æˆ–æä¾›çš„ç¼–ç å™¨ ID ç¡®å®šé€‚å½“çš„ç¼–ç å™¨ã€‚\n21.ä¿æŠ¤ REST-API çš„æœ€ä½³å®è·µï¼Ÿ å®æ–½ REST API å®‰å…¨æ€§æ¶‰åŠå¤šç§æ³¨æ„äº‹é¡¹ï¼Œä»¥ä¿æŠ¤ API å…å—æœªç»æˆæƒçš„è®¿é—®å¹¶ç¡®ä¿æ•°æ®å®Œæ•´æ€§ã€‚\nèº«ä»½éªŒè¯ï¼šå®æ–½å®‰å…¨çš„èº«ä»½éªŒè¯æœºåˆ¶æ¥éªŒè¯å‘å‡º API è¯·æ±‚çš„å®¢æˆ·ç«¯çš„èº«ä»½ã€‚å¸¸è§æ–¹æ³•åŒ…æ‹¬åŸºäºä»¤ç‰Œçš„èº«ä»½éªŒè¯ï¼ˆä¾‹å¦‚ JWTï¼‰ã€OAuth 2.0 æˆ– API å¯†é’¥ã€‚é€‰æ‹©é€‚åˆåº”ç”¨ç¨‹åºè¦æ±‚çš„èº«ä»½éªŒè¯æ–¹æ³•å¹¶å°†å…¶é›†æˆåˆ° API ç«¯ç‚¹ä¸­ã€‚ æˆæƒï¼šå®šä¹‰è®¿é—®æ§åˆ¶è§„åˆ™ä»¥ç¡®å®šæ¯ä¸ªç»è¿‡èº«ä»½éªŒè¯çš„å®¢æˆ·ç«¯å¯ä»¥è®¿é—®å“ªäº›æ“ä½œæˆ–èµ„æºã€‚ä½¿ç”¨åŸºäºè§’è‰²æˆ–åŸºäºæƒé™çš„æˆæƒæœºåˆ¶å¯¹ API ç«¯ç‚¹å®æ–½é™åˆ¶ã€‚ Spring Security æä¾›äº†è¯¸å¦‚ @PreAuthorize æˆ– @RolesAllowed ä¹‹ç±»çš„æ³¨é‡Šæ¥åœ¨æ–¹æ³•æˆ–ç«¯ç‚¹çº§åˆ«é…ç½®æˆæƒè§„åˆ™ã€‚ å®‰å…¨ä¼ è¾“å±‚ï¼šé€šè¿‡å¼ºåˆ¶æ‰§è¡Œ HTTPS ç¡®ä¿å®¢æˆ·ç«¯å’Œ API æœåŠ¡å™¨ä¹‹é—´çš„å®‰å…¨é€šä¿¡ã€‚è¿™å¯¹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´äº¤æ¢çš„æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œé˜²æ­¢å…¶è¢«çªƒå¬å’Œç¯¡æ”¹ã€‚é…ç½®æ‚¨çš„æœåŠ¡å™¨ä»¥ä½¿ç”¨ SSL/TLS è¯ä¹¦å¹¶ä¸ºæ‰€æœ‰ API ç«¯ç‚¹å¯ç”¨ HTTPSã€‚ è¾“å…¥éªŒè¯ï¼šéªŒè¯å’Œæ¸…ç†ç”¨æˆ·è¾“å…¥ï¼Œä»¥é˜²æ­¢å¸¸è§çš„å®‰å…¨æ¼æ´ï¼Œä¾‹å¦‚ SQL æ³¨å…¥ã€è·¨ç«™ç‚¹è„šæœ¬ (XSS) æˆ–å…¶ä»–æ³¨å…¥æ”»å‡»ã€‚åº”ç”¨è¾“å…¥éªŒè¯æŠ€æœ¯å’Œæ¡†æ¶æ¥æ¸…ç†å’ŒéªŒè¯ç”¨æˆ·æä¾›çš„æ•°æ®ï¼Œä»¥é™ä½å®‰å…¨æ¼æ´çš„é£é™©ã€‚ é€Ÿç‡é™åˆ¶ï¼šå®æ–½é€Ÿç‡é™åˆ¶æœºåˆ¶ä»¥é˜²æ­¢æ»¥ç”¨å¹¶ç¡®ä¿ API èµ„æºçš„å…¬å¹³ä½¿ç”¨ã€‚å®šä¹‰ç‰¹å®šæ—¶é—´æ®µå†…æ¯ä¸ªå®¢æˆ·ç«¯æˆ–æ¯ä¸ª API ç«¯ç‚¹å…è®¸çš„è¯·æ±‚æ•°é‡çš„é™åˆ¶ã€‚è¿™æœ‰åŠ©äºé˜²æ­¢ DoSï¼ˆæ‹’ç»æœåŠ¡ï¼‰æ”»å‡»å¹¶ç¡®ä¿ API çš„å¯ç”¨æ€§å’Œæ€§èƒ½ã€‚ æ—¥å¿—è®°å½•å’Œç›‘æ§ï¼šå½“æˆ‘ä»¬å¿…é¡»è§£å†³ä¸æ˜æ˜¾ä¸”éš¾ä»¥é‡ç°çš„é—®é¢˜æ—¶ï¼Œæ—¥å¿—è®°å½•å’Œç›‘æ§æœ‰åŠ©äºåœ¨é›¨å¤©è¿›è¡Œè°ƒè¯•ã€‚ 22. Spring Security å¦‚ä½•ä¸ Mobile App Security é…åˆä½¿ç”¨ï¼Ÿ Spring Security èƒ½å¤Ÿä¸ç§»åŠ¨åº”ç”¨ç¨‹åºå®‰å…¨æ€§æ— ç¼é›†æˆï¼Œæä¾›å¼ºå¤§çš„èº«ä»½éªŒè¯å’ŒæˆæƒåŠŸèƒ½ã€‚\nä¸€ç§æµè¡Œçš„æ–¹æ³•æ˜¯åŸºäºä»¤ç‰Œçš„å®‰å…¨æ€§ï¼Œå…¶ä¸­ç§»åŠ¨åº”ç”¨ç¨‹åºå‘æœåŠ¡å™¨å‘é€èº«ä»½éªŒè¯è¯·æ±‚å¹¶è·å–ä»¤ç‰Œï¼ˆä¾‹å¦‚ JWTï¼‰ä½œä¸ºå“åº”ã€‚éšåï¼Œè¯¥ä»¤ç‰Œå°†åŒ…å«åœ¨æ‰€æœ‰åç»­ API è¯·æ±‚ä¸­ï¼Œä»¥ç”¨ä½œæˆæƒæœºåˆ¶ã€‚\nç»“è®º è¿™æœ¬å¸¸è§ Spring Security é¢è¯•é—®é¢˜å’Œç­”æ¡ˆçš„ç»¼åˆæŒ‡å—æ¢è®¨äº†èº«ä»½éªŒè¯ã€æˆæƒå’Œ Spring Security çš„å„ç§ç»„ä»¶ç­‰å…³é”®æ¦‚å¿µã€‚æˆ‘ä»¬æ·±å…¥ç ”ç©¶äº†å¯†ç ç¼–ç ã€è¯·æ±‚åŒ¹é…ã€æ–¹æ³•å®‰å…¨æ³¨é‡Šä»¥åŠä¸å…¶ä»–æ¡†æ¶çš„é›†æˆç­‰ä¸»é¢˜ã€‚é€šè¿‡ç†Ÿæ‚‰è¿™äº›é¢è¯•é—®é¢˜åŠå…¶ç­”æ¡ˆï¼Œæ‚¨å¯ä»¥åœ¨é¢è¯•æœŸé—´è‡ªä¿¡åœ°å¤„ç† Spring Security ç›¸å…³çš„è®¨è®ºã€‚\nå¿«ä¹å­¦ä¹ ï¼\nåŸæ–‡é“¾æ¥ï¼šSpring Security Interview Questions\n","permalink":"https://blog.chensoul.cc/posts/2023/10/12/spring-security-interview-questions/","summary":"æœ¬é¢è¯•å‡†å¤‡æŒ‡å—å°†è®¨è®ºä¸€äº›å¸¸è§çš„ Spring Security é¢è¯•é—®é¢˜ã€‚æ— è®ºæ‚¨æ˜¯å‡†å¤‡é¢è¯•è¿˜æ˜¯åªæ˜¯æƒ³å¢å¼ºå¯¹ Spring Security çš„äº†è§£ï¼Œè¿™äº›é—®é¢˜éƒ½å°†å¸®åŠ©æ‚¨ç†è§£å…³é”®æ¦‚å¿µå¹¶æŒ‡å¯¼æ‚¨è®¾è®¡å¸¸è§å®‰å…¨é—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚\n1. Spring Security çš„æ ¸å¿ƒç‰¹æ€§æ˜¯ä»€ä¹ˆï¼Ÿ Spring Security æä¾›çš„ä¸¤ä¸ªæœ€çªå‡ºçš„åŠŸèƒ½æ˜¯èº«ä»½éªŒè¯å’Œæˆæƒã€‚è¿™äº›åŠŸèƒ½åœ¨ç¡®ä¿åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§æ–¹é¢å‘æŒ¥ç€è‡³å…³é‡è¦çš„ä½œç”¨ã€‚ç„¶è€Œï¼ŒSpring Security è¶…è¶Šäº†èº«ä»½éªŒè¯å’Œæˆæƒï¼Œè¿˜æä¾›äº†é¢å¤–çš„åŠŸèƒ½æ¥é˜²æ­¢æ¼æ´åˆ©ç”¨å¹¶ä¸å…¶ä»–æ¡†æ¶é›†æˆã€‚\n1.1.éªŒè¯ èº«ä»½éªŒè¯æ˜¯éªŒè¯å°è¯•è®¿é—®åº”ç”¨ç¨‹åºçš„ç”¨æˆ·èº«ä»½çš„è¿‡ç¨‹ã€‚ Spring Security æä¾›å¤šç§èº«ä»½éªŒè¯æ–¹æ³•ï¼ˆåŸºäºè¡¨å•çš„èº«ä»½éªŒè¯ã€HTTP åŸºæœ¬èº«ä»½éªŒè¯ã€OAuth2ã€Siteminderã€OpenID Connectã€LDAPã€JDBC ç­‰ï¼‰ï¼Œå…è®¸åº”ç”¨ç¨‹åºä½¿ç”¨å„ç§æ–¹æ³•å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ã€‚\nå®ƒè¿˜æ”¯æŒè‡ªå®šä¹‰ï¼Œå½“é»˜è®¤é€‰é¡¹ä¸æ»¡è¶³è¦æ±‚æ—¶ï¼Œå¯ä»¥å®ç°è‡ªå®šä¹‰çš„èº«ä»½éªŒè¯æœºåˆ¶ã€‚\n1.2.æˆæƒ æˆæƒæ˜¯å‘ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·æˆ–å®ä½“æˆäºˆè®¸å¯æˆ–æƒåˆ©çš„è¿‡ç¨‹ã€‚ç”¨æˆ·æˆ–å®ä½“æˆåŠŸé€šè¿‡èº«ä»½éªŒè¯åï¼Œæˆæƒå°†å†³å®šä»–ä»¬å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­è®¿é—®å“ªäº›æ“ä½œæˆ–èµ„æºã€‚ Spring Security ä¸ºå¼€å‘äººå‘˜æä¾›äº†å¤šç§æ–¹æ³•æ¥å®ç°æˆæƒå¹¶æ§åˆ¶ç”¨æˆ·å¯¹åº”ç”¨ç¨‹åºä¸åŒéƒ¨åˆ†çš„è®¿é—®ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„æ–¹æ³•ï¼š\nåŸºäº Web URL çš„æˆæƒï¼šå¯ä»¥æ ¹æ®ç‰¹å®šçš„ URL æˆ– URL æ¨¡å¼å®æ–½è®¿é—®æ§åˆ¶ï¼Œè§„èŒƒå“ªäº›ç”¨æˆ·å¯ä»¥è®¿é—®æŸäº›èµ„æºã€‚ æ–¹æ³•çº§æˆæƒï¼šå¦‚æœéœ€è¦ï¼Œç”šè‡³å¯ä»¥å¯¹ Java Bean ä¸­çš„æ–¹æ³•è¿›è¡Œè®¿é—®æ§åˆ¶ï¼Œä»è€Œåœ¨æ–¹æ³•çº§æä¾›ç»†ç²’åº¦çš„æˆæƒã€‚ åŸŸå®ä¾‹çº§æˆæƒï¼šSpring Security æä¾›äº†æ§åˆ¶å¯¹ç‰¹å®šåŸŸå®ä¾‹çš„è®¿é—®çš„èƒ½åŠ›ï¼Œå…è®¸åŸºäºæŸäº›å®ä½“çš„æ‰€æœ‰æƒæˆ–å…³è”è¿›è¡Œæˆæƒã€‚ 1.3.é˜²æ­¢æ¼æ´åˆ©ç”¨ Spring Security æä¾›äº†å¤šç§åŠŸèƒ½æ¥é˜²èŒƒå¸¸è§çš„ Web åº”ç”¨ç¨‹åºå®‰å…¨æ¼æ´ã€‚ä¸€äº›æ˜¾ç€çš„åŠŸèƒ½åŒ…æ‹¬ï¼š\nè·¨ç«™è¯·æ±‚ä¼ªé€  (CSRF) ä¿æŠ¤ï¼šSpring Security ä¼šè‡ªåŠ¨å°† CSRF ä»¤ç‰Œæ·»åŠ åˆ°è¡¨å•å’Œ AJAX è¯·æ±‚ä¸­ï¼Œä»è€Œé˜²æ­¢ CSRF æ”»å‡»ã€‚ è·¨ç«™è„šæœ¬ (XSS) ä¿æŠ¤ï¼šSpring Security æ”¯æŒè¾“å‡ºç¼–ç ï¼Œå¹¶æä¾›å®ç”¨ç¨‹åºé€šè¿‡æ¸…ç†ç”¨æˆ·è¾“å…¥æ¥é˜²æ­¢ XSS æ”»å‡»ã€‚ ç‚¹å‡»åŠ«æŒä¿æŠ¤ï¼šSpring Security åŒ…æ‹¬ X-Frame-Options æ”¯æŒï¼Œä»¥é˜²æ­¢ç‚¹å‡»åŠ«æŒæ”»å‡»ã€‚ 1.4.é›†æˆ Spring Security ä¸å…¶ä»–æ¡†æ¶å’Œåº“æ— ç¼é›†æˆï¼Œä»¥å¢å¼ºåº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ã€‚ä¸€äº›å…³é”®çš„é›†æˆæ˜¯ï¼š\nSpring MVCï¼šSpring Security ä¸ Spring MVC é›†æˆï¼Œä¸º Web åº”ç”¨ç¨‹åºæä¾›æ— ç¼çš„å®‰å…¨åŠŸèƒ½ã€‚å®ƒå¯ä»¥å®‰å…¨åœ°å¤„ç†è¯·æ±‚ã€èº«ä»½éªŒè¯ã€æˆæƒå¹¶é˜²æ­¢å¸¸è§çš„ Web æ¼æ´ã€‚ Spring Dataï¼šSpring Security ä¸ Spring Data é›†æˆï¼Œä»¥ä¾¿åœ¨æŸ¥è¯¢ä¸­å¼•ç”¨å½“å‰ç”¨æˆ·ã€‚è¿™ç§é›†æˆç¡®ä¿å¯ä»¥æ ¹æ®èº«ä»½éªŒè¯å’Œæˆæƒè§„åˆ™è½»æ¾è®¿é—®å’Œè¿‡æ»¤ç”¨æˆ·ç‰¹å®šçš„æ•°æ®ã€‚ Jacksonï¼šJackson çš„æ”¯æŒå¯ä»¥å®ç° Spring Security ç›¸å…³ç±»çš„é«˜æ•ˆåºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨åˆ†å¸ƒå¼ä¼šè¯æˆ– Spring Session ç­‰æ¡†æ¶æ—¶ï¼Œä»è€Œæé«˜æ•ˆç‡å’Œå¯æ‰©å±•æ€§ã€‚ å¯†ç å­¦ï¼šSpring Security ä¸å„ç§å¯†ç åº“å’Œç®—æ³•é›†æˆï¼Œä»¥æä¾›æ•æ„Ÿä¿¡æ¯çš„å®‰å…¨å­˜å‚¨å’Œä¼ è¾“ã€‚è¿™ç§é›†æˆåŒ…æ‹¬å¯†ç æ•£åˆ—ã€åŠ å¯†å’Œå®‰å…¨é€šä¿¡åè®®ç­‰åŠŸèƒ½ï¼Œä»¥ä¿æŠ¤æ•°æ®çš„æœºå¯†æ€§å’Œå®Œæ•´æ€§ã€‚ æœ‰å…³ Spring Security åŠŸèƒ½çš„æ›´è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…å®˜æ–¹æ–‡æ¡£ã€‚","title":"[è¯‘]Spring Security é¢è¯•é—®é¢˜"},{"content":"æœ¬æ–‡ä¸»è¦ä»‹ç» Caching æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nä»‹ç» ç¼“å­˜æ¨¡å¼ï¼ˆCaching Patternï¼‰æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œæ—¨åœ¨é€šè¿‡åœ¨èµ„æºä½¿ç”¨åå°†å…¶ä¿ç•™åœ¨æŸä¸ªå¿«é€Ÿè®¿é—®çš„å­˜å‚¨ä¸­ï¼Œå¹¶åœ¨éœ€è¦æ—¶é‡æ–°ä½¿ç”¨èµ„æºï¼Œä»¥é¿å…æ˜‚è´µçš„èµ„æºé‡æ–°è·å–ã€‚\nç¼“å­˜æ¨¡å¼çš„ç›®çš„æ˜¯å‡å°‘é‡å¤è·å–ã€åˆå§‹åŒ–å’Œé‡Šæ”¾åŒä¸€èµ„æºæ‰€å¸¦æ¥çš„ä¸å¿…è¦æ€§èƒ½å¼€é”€ã€‚é€šè¿‡å°†èµ„æºä¿ç•™åœ¨ç¼“å­˜ä¸­ï¼Œå¯ä»¥é¿å…å†æ¬¡è·å–èµ„æºï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å“åº”é€Ÿåº¦å’Œæ€§èƒ½ã€‚\nåœ¨ç¼“å­˜æ¨¡å¼ä¸­ï¼Œå½“éœ€è¦è®¿é—®èµ„æºæ—¶ï¼Œé¦–å…ˆæ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨è¯¥èµ„æºçš„å‰¯æœ¬ã€‚å¦‚æœç¼“å­˜ä¸­å­˜åœ¨èµ„æºï¼Œåˆ™ç›´æ¥ä»ç¼“å­˜ä¸­è·å–å¹¶è¿”å›ç»™è°ƒç”¨æ–¹ã€‚å¦‚æœç¼“å­˜ä¸­ä¸å­˜åœ¨èµ„æºï¼Œåˆ™éœ€è¦ä»åŸå§‹æ•°æ®æºæˆ–å…¶ä»–é€”å¾„è·å–èµ„æºï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ç¼“å­˜ä¸­ï¼Œä»¥ä¾›åç»­ä½¿ç”¨ã€‚\nç¼“å­˜æ¨¡å¼é€‚ç”¨äºé‚£äº›éœ€è¦é¢‘ç¹è®¿é—®ã€è®¡ç®—æˆæœ¬è¾ƒé«˜çš„èµ„æºçš„æƒ…å†µï¼Œä¾‹å¦‚æ•°æ®åº“æŸ¥è¯¢ã€ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶è¯»å†™ç­‰ã€‚é€šè¿‡ä½¿ç”¨ç¼“å­˜æ¨¡å¼ï¼Œå¯ä»¥æ˜¾è‘—æå‡ç³»ç»Ÿçš„æ€§èƒ½å’Œå“åº”é€Ÿåº¦ï¼Œå‡å°‘å¯¹åŸå§‹æ•°æ®æºçš„è®¿é—®æ¬¡æ•°ï¼Œä»è€Œé™ä½ç³»ç»Ÿçš„è´Ÿè½½ã€‚\nå…³äºç¼“å­˜æ¨¡å¼çš„æ›´å¤šä¿¡æ¯å’Œå®ç°æ–¹å¼ï¼Œæ‚¨å¯ä»¥å‚è€ƒä»¥ä¸‹èµ„æºï¼š\nWrite-Through, Write-Around, Write-Back: Cache Explainedï¼šå¯¹ç¼“å­˜æ¨¡å¼è¿›è¡Œäº†è¯¦ç»†è§£é‡Šå’Œè¯´æ˜ï¼Œæä¾›äº†ä¸åŒçš„ç¼“å­˜ç­–ç•¥å’Œå®ç°æ–¹å¼ã€‚ Read-Through, Write-Through, Write-Behind, and Refresh-Ahead Cachingï¼šä»‹ç»äº†ä¸åŒç±»å‹çš„ç¼“å­˜æ“ä½œå’Œç­–ç•¥ï¼ŒåŒ…æ‹¬è¯»å–ã€å†™å…¥ã€åˆ·æ–°ç­‰ã€‚ Cache-Aside Patternï¼šä»‹ç»äº†ç¼“å­˜æ¨¡å¼ä¸­çš„ä¸€ç§å¸¸è§å®ç°æ–¹å¼ï¼Œå³\u0026quot;Cache-Aside\u0026quot;æ¨¡å¼ï¼ŒåŒ…æ‹¬å…¶å·¥ä½œåŸç†å’Œä½¿ç”¨æ–¹æ³•ã€‚ å®ç°ç­–ç•¥ ç¼“å­˜æ¨¡å¼æœ‰å¤šç§å¸¸è§çš„å®ç°ç­–ç•¥ï¼Œä»¥ä¸‹æ˜¯å…¶ä¸­ä¸€äº›å¸¸è§çš„å®ç°ç­–ç•¥ï¼š\nå†™å…¥ç©¿é€ï¼ˆWrite-Throughï¼‰ï¼šå½“ä»æ•°æ®æºè·å–æ•°æ®æ—¶ï¼Œå°†æ•°æ®åŒæ—¶å†™å…¥ç¼“å­˜ã€‚è¿™æ ·ï¼Œåœ¨ä¸‹ä¸€æ¬¡éœ€è¦ç›¸åŒæ•°æ®æ—¶ï¼Œå¯ä»¥ä»ç¼“å­˜ä¸­è·å–ï¼Œé¿å…å†æ¬¡è®¿é—®æ•°æ®æºã€‚å†™å…¥ç©¿é€ç­–ç•¥ç¡®ä¿ç¼“å­˜ä¸­å§‹ç»ˆä¿æŒæœ€æ–°çš„æ•°æ®ã€‚ å†™å…¥å›å†™ï¼ˆWrite-Backï¼‰ï¼šåœ¨æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé¦–å…ˆå°†æ•°æ®å†™å…¥ç¼“å­˜ï¼Œç„¶åå†å®šæœŸå°†ç¼“å­˜ä¸­çš„æ•°æ®æ‰¹é‡å†™å›åˆ°æ•°æ®æºã€‚å†™å…¥å›å†™ç­–ç•¥å¯ä»¥å‡å°‘å¯¹æ•°æ®æºçš„é¢‘ç¹å†™å…¥æ“ä½œï¼Œæé«˜æ€§èƒ½ã€‚ å†™å…¥æ—è·¯ï¼ˆWrite-Aroundï¼‰ï¼šå°†å†™æ“ä½œç›´æ¥å‘é€åˆ°æ•°æ®æºï¼Œè€Œä¸æ˜¯é€šè¿‡ç¼“å­˜ã€‚è¿™æ ·å¯ä»¥é¿å…å°†ä¸ç»å¸¸è®¿é—®çš„æ•°æ®å†™å…¥ç¼“å­˜ï¼Œä»è€ŒèŠ‚çœç¼“å­˜ç©ºé—´ã€‚åªæœ‰å½“æ•°æ®è¢«è¯»å–æ—¶ï¼Œæ‰ä¼šå°†å…¶æ”¾å…¥ç¼“å­˜ã€‚ åˆ·æ–°é¢„å–ï¼ˆRefresh-Aheadï¼‰ï¼šåœ¨ç¼“å­˜ä¸­å­˜å‚¨æ•°æ®çš„åŒæ—¶ï¼Œé¢„å…ˆè·å–å’Œæ›´æ–°ä¸å½“å‰æ•°æ®ç›¸å…³çš„å…¶ä»–æ•°æ®ã€‚è¿™æ ·ï¼Œå½“éœ€è¦è®¿é—®ç›¸å…³æ•°æ®æ—¶ï¼Œå¯ä»¥ç›´æ¥ä»ç¼“å­˜ä¸­è·å–ï¼Œå‡å°‘ç­‰å¾…æ—¶é—´ã€‚ æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLeast Recently Used, LRUï¼‰ï¼šæ ¹æ®æ•°æ®çš„è®¿é—®é¢‘ç‡å’Œæ—¶é—´è¿›è¡Œç¼“å­˜æ·˜æ±°ã€‚å½“ç¼“å­˜ç©ºé—´ä¸è¶³æ—¶ï¼Œä¼˜å…ˆæ·˜æ±°æœ€è¿‘æœ€å°‘è¢«è®¿é—®çš„æ•°æ®ï¼Œä»¥ä¿ç•™æœ€å¸¸ç”¨çš„æ•°æ®ã€‚ å›ºå®šæ—¶é—´è¿‡æœŸï¼ˆTime-To-Live, TTLï¼‰ï¼šä¸ºç¼“å­˜ä¸­çš„æ¯ä¸ªæ•°æ®é¡¹è®¾ç½®ä¸€ä¸ªå›ºå®šçš„è¿‡æœŸæ—¶é—´ã€‚ä¸€æ—¦æ•°æ®é¡¹è¶…è¿‡è¿‡æœŸæ—¶é—´ï¼Œå°†è¢«è§†ä¸ºè¿‡æœŸå¹¶ä»ç¼“å­˜ä¸­ç§»é™¤ã€‚ å¼‚æ­¥åˆ·æ–°ï¼ˆAsynchronous Refreshï¼‰ï¼šåœ¨æ•°æ®è¿‡æœŸæˆ–æ— æ•ˆæ—¶ï¼Œé€šè¿‡å¼‚æ­¥æ–¹å¼ä»æ•°æ®æºè·å–æ–°æ•°æ®å¹¶æ›´æ–°ç¼“å­˜ã€‚è¿™æ ·å¯ä»¥é¿å…é˜»å¡è°ƒç”¨æ–¹ï¼Œæé«˜ç³»ç»Ÿçš„å“åº”é€Ÿåº¦ã€‚ ç¼“å­˜æ¡†æ¶ å½“æ¶‰åŠåˆ°ç¼“å­˜æ¡†æ¶æˆ–å·¥å…·æ—¶ï¼Œæœ‰å‡ ä¸ªå¸¸è§ä¸”å¹¿æ³›ä½¿ç”¨çš„é€‰é¡¹å¯ä»¥è€ƒè™‘ã€‚ä»¥ä¸‹æ˜¯å…¶ä¸­ä¸€äº›å¸¸è§çš„ç¼“å­˜æ¡†æ¶æˆ–å·¥å…·ï¼š\nEhcache: Ehcache æ˜¯ä¸€ä¸ªæµè¡Œçš„å¼€æº Java ç¼“å­˜æ¡†æ¶ï¼Œæä¾›äº†å„ç§ç¼“å­˜ç­–ç•¥å’ŒåŠŸèƒ½ï¼ŒåŒ…æ‹¬å†…å­˜ç¼“å­˜ã€ç£ç›˜ç¼“å­˜ã€åˆ†å¸ƒå¼ç¼“å­˜ç­‰ã€‚å®ƒæ˜“äºä½¿ç”¨ä¸”æ€§èƒ½ä¼˜ç§€ï¼Œå¯ä»¥è½»æ¾é›†æˆåˆ° Java åº”ç”¨ç¨‹åºä¸­ã€‚ Redis: Redis æ˜¯ä¸€ä¸ªå¼€æºçš„é«˜æ€§èƒ½å†…å­˜æ•°æ®ç»“æ„å­˜å‚¨ç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥ç”¨ä½œç¼“å­˜ã€‚å®ƒæ”¯æŒå¤šç§æ•°æ®ç»“æ„å’Œä¸°å¯Œçš„ç¼“å­˜åŠŸèƒ½ï¼Œå¦‚æ•°æ®è¿‡æœŸã€æŒä¹…åŒ–ã€åˆ†å¸ƒå¼ç¼“å­˜ç­‰ã€‚Redis å¯ä»¥ä½œä¸ºç‹¬ç«‹çš„ç¼“å­˜æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥ä¸åº”ç”¨ç¨‹åºé›†æˆä½¿ç”¨ã€‚ Memcached: Memcached æ˜¯ä¸€ä¸ªç®€å•è€Œé«˜æ•ˆçš„åˆ†å¸ƒå¼å†…å­˜å¯¹è±¡ç¼“å­˜ç³»ç»Ÿã€‚å®ƒä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨æ•°æ®ï¼Œå¹¶æä¾›äº†åˆ†å¸ƒå¼ç¼“å­˜çš„æ”¯æŒã€‚Memcached é€‚ç”¨äºé«˜å¹¶å‘ç¯å¢ƒä¸‹çš„ç¼“å­˜éœ€æ±‚ï¼Œå¯ä»¥å‡è½»åç«¯æ•°æ®åº“çš„å‹åŠ›ã€‚ Caffeine: Caffeine æ˜¯ä¸€ä¸ªåŸºäº Java çš„é«˜æ€§èƒ½ç¼“å­˜åº“ï¼Œä¸“æ³¨äºæä¾›å¿«é€Ÿçš„ç¼“å­˜è®¿é—®å’Œé«˜æ•ˆçš„å†…å­˜ç®¡ç†ã€‚å®ƒæ”¯æŒå„ç§ç¼“å­˜ç­–ç•¥å’ŒåŠŸèƒ½ï¼Œå¹¶æä¾›äº†çº¿ç¨‹å®‰å…¨å’Œå¼‚æ­¥åŠ è½½ç­‰ç‰¹æ€§ã€‚ Hazelcast: Hazelcast æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨å’Œè®¡ç®—å¹³å°ï¼Œå…¶ä¸­åŒ…æ‹¬äº†åˆ†å¸ƒå¼ç¼“å­˜çš„åŠŸèƒ½ã€‚å®ƒæä¾›äº†é«˜å¯ç”¨æ€§å’Œå¯æ‰©å±•æ€§ï¼Œå¹¶æ”¯æŒå¤šç§ç¼“å­˜ç­–ç•¥å’Œåˆ†å¸ƒå¼ç¼“å­˜æ¨¡å¼ã€‚ Guava Cache: Guava Cache æ˜¯ Google çš„ Guava åº“ä¸­æä¾›çš„ä¸€ä¸ªæœ¬åœ°ç¼“å­˜å®ç°ã€‚å®ƒæä¾›äº†ç®€å•æ˜“ç”¨çš„ APIï¼Œæ”¯æŒå„ç§ç¼“å­˜ç­–ç•¥å’ŒåŠŸèƒ½ï¼Œå¦‚è¿‡æœŸæ—¶é—´ã€æœ€å¤§ç¼“å­˜å¤§å°ã€ç¼“å­˜ç»Ÿè®¡ç­‰ã€‚ Apache Ignite: Apache Ignite æ˜¯ä¸€ä¸ªå†…å­˜è®¡ç®—å¹³å°ï¼Œæä¾›äº†åˆ†å¸ƒå¼ç¼“å­˜å’Œè®¡ç®—èƒ½åŠ›ã€‚å®ƒå¯ä»¥ä½œä¸ºä¸€ä¸ªåˆ†å¸ƒå¼ç¼“å­˜å­˜å‚¨æ•°æ®ï¼Œå¹¶æ”¯æŒ SQL æŸ¥è¯¢ã€åˆ†å¸ƒå¼è®¡ç®—ã€æµå¤„ç†ç­‰åŠŸèƒ½ã€‚ Couchbase: Couchbase æ˜¯ä¸€ä¸ªé¢å‘ä¼ä¸šåº”ç”¨çš„ NoSQL æ•°æ®åº“å’Œç¼“å­˜å¹³å°ã€‚å®ƒæä¾›äº†å¯æ‰©å±•çš„å†…å­˜ç¼“å­˜åŠŸèƒ½ï¼Œå¹¶æ”¯æŒæ•°æ®æŒä¹…åŒ–å’Œåˆ†å¸ƒå¼ç¼“å­˜é›†ç¾¤ã€‚ Aerospike: Aerospike æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ NoSQL æ•°æ®åº“å’Œç¼“å­˜å¹³å°ï¼Œä¸“æ³¨äºæä¾›ä½å»¶è¿Ÿå’Œé«˜ååé‡çš„æ•°æ®è®¿é—®ã€‚å®ƒæ”¯æŒå†…å­˜å’Œé—ªå­˜å­˜å‚¨ï¼Œå¹¶å…·æœ‰åˆ†å¸ƒå¼ç¼“å­˜çš„åŠŸèƒ½ã€‚ Oracle Coherence: Oracle Coherence æ˜¯ä¸€ä¸ªä¼ä¸šçº§çš„åˆ†å¸ƒå¼ç¼“å­˜å’Œæ•°æ®ç½‘æ ¼è§£å†³æ–¹æ¡ˆã€‚å®ƒæä¾›äº†é«˜å¯ç”¨æ€§ã€å¯æ‰©å±•æ€§å’Œäº‹åŠ¡æ”¯æŒï¼Œå¹¶æ”¯æŒå¤šç§ç¼“å­˜ç­–ç•¥å’Œæ•°æ®å¤åˆ¶æ¨¡å¼ã€‚ ","permalink":"https://blog.chensoul.cc/posts/2023/09/25/java-design-patterns-cahcing/","summary":"æœ¬æ–‡ä¸»è¦ä»‹ç» Caching æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nä»‹ç» ç¼“å­˜æ¨¡å¼ï¼ˆCaching Patternï¼‰æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œæ—¨åœ¨é€šè¿‡åœ¨èµ„æºä½¿ç”¨åå°†å…¶ä¿ç•™åœ¨æŸä¸ªå¿«é€Ÿè®¿é—®çš„å­˜å‚¨ä¸­ï¼Œå¹¶åœ¨éœ€è¦æ—¶é‡æ–°ä½¿ç”¨èµ„æºï¼Œä»¥é¿å…æ˜‚è´µçš„èµ„æºé‡æ–°è·å–ã€‚\nç¼“å­˜æ¨¡å¼çš„ç›®çš„æ˜¯å‡å°‘é‡å¤è·å–ã€åˆå§‹åŒ–å’Œé‡Šæ”¾åŒä¸€èµ„æºæ‰€å¸¦æ¥çš„ä¸å¿…è¦æ€§èƒ½å¼€é”€ã€‚é€šè¿‡å°†èµ„æºä¿ç•™åœ¨ç¼“å­˜ä¸­ï¼Œå¯ä»¥é¿å…å†æ¬¡è·å–èµ„æºï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å“åº”é€Ÿåº¦å’Œæ€§èƒ½ã€‚\nåœ¨ç¼“å­˜æ¨¡å¼ä¸­ï¼Œå½“éœ€è¦è®¿é—®èµ„æºæ—¶ï¼Œé¦–å…ˆæ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨è¯¥èµ„æºçš„å‰¯æœ¬ã€‚å¦‚æœç¼“å­˜ä¸­å­˜åœ¨èµ„æºï¼Œåˆ™ç›´æ¥ä»ç¼“å­˜ä¸­è·å–å¹¶è¿”å›ç»™è°ƒç”¨æ–¹ã€‚å¦‚æœç¼“å­˜ä¸­ä¸å­˜åœ¨èµ„æºï¼Œåˆ™éœ€è¦ä»åŸå§‹æ•°æ®æºæˆ–å…¶ä»–é€”å¾„è·å–èµ„æºï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ç¼“å­˜ä¸­ï¼Œä»¥ä¾›åç»­ä½¿ç”¨ã€‚\nç¼“å­˜æ¨¡å¼é€‚ç”¨äºé‚£äº›éœ€è¦é¢‘ç¹è®¿é—®ã€è®¡ç®—æˆæœ¬è¾ƒé«˜çš„èµ„æºçš„æƒ…å†µï¼Œä¾‹å¦‚æ•°æ®åº“æŸ¥è¯¢ã€ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶è¯»å†™ç­‰ã€‚é€šè¿‡ä½¿ç”¨ç¼“å­˜æ¨¡å¼ï¼Œå¯ä»¥æ˜¾è‘—æå‡ç³»ç»Ÿçš„æ€§èƒ½å’Œå“åº”é€Ÿåº¦ï¼Œå‡å°‘å¯¹åŸå§‹æ•°æ®æºçš„è®¿é—®æ¬¡æ•°ï¼Œä»è€Œé™ä½ç³»ç»Ÿçš„è´Ÿè½½ã€‚\nå…³äºç¼“å­˜æ¨¡å¼çš„æ›´å¤šä¿¡æ¯å’Œå®ç°æ–¹å¼ï¼Œæ‚¨å¯ä»¥å‚è€ƒä»¥ä¸‹èµ„æºï¼š\nWrite-Through, Write-Around, Write-Back: Cache Explainedï¼šå¯¹ç¼“å­˜æ¨¡å¼è¿›è¡Œäº†è¯¦ç»†è§£é‡Šå’Œè¯´æ˜ï¼Œæä¾›äº†ä¸åŒçš„ç¼“å­˜ç­–ç•¥å’Œå®ç°æ–¹å¼ã€‚ Read-Through, Write-Through, Write-Behind, and Refresh-Ahead Cachingï¼šä»‹ç»äº†ä¸åŒç±»å‹çš„ç¼“å­˜æ“ä½œå’Œç­–ç•¥ï¼ŒåŒ…æ‹¬è¯»å–ã€å†™å…¥ã€åˆ·æ–°ç­‰ã€‚ Cache-Aside Patternï¼šä»‹ç»äº†ç¼“å­˜æ¨¡å¼ä¸­çš„ä¸€ç§å¸¸è§å®ç°æ–¹å¼ï¼Œå³\u0026quot;Cache-Aside\u0026quot;æ¨¡å¼ï¼ŒåŒ…æ‹¬å…¶å·¥ä½œåŸç†å’Œä½¿ç”¨æ–¹æ³•ã€‚ å®ç°ç­–ç•¥ ç¼“å­˜æ¨¡å¼æœ‰å¤šç§å¸¸è§çš„å®ç°ç­–ç•¥ï¼Œä»¥ä¸‹æ˜¯å…¶ä¸­ä¸€äº›å¸¸è§çš„å®ç°ç­–ç•¥ï¼š\nå†™å…¥ç©¿é€ï¼ˆWrite-Throughï¼‰ï¼šå½“ä»æ•°æ®æºè·å–æ•°æ®æ—¶ï¼Œå°†æ•°æ®åŒæ—¶å†™å…¥ç¼“å­˜ã€‚è¿™æ ·ï¼Œåœ¨ä¸‹ä¸€æ¬¡éœ€è¦ç›¸åŒæ•°æ®æ—¶ï¼Œå¯ä»¥ä»ç¼“å­˜ä¸­è·å–ï¼Œé¿å…å†æ¬¡è®¿é—®æ•°æ®æºã€‚å†™å…¥ç©¿é€ç­–ç•¥ç¡®ä¿ç¼“å­˜ä¸­å§‹ç»ˆä¿æŒæœ€æ–°çš„æ•°æ®ã€‚ å†™å…¥å›å†™ï¼ˆWrite-Backï¼‰ï¼šåœ¨æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé¦–å…ˆå°†æ•°æ®å†™å…¥ç¼“å­˜ï¼Œç„¶åå†å®šæœŸå°†ç¼“å­˜ä¸­çš„æ•°æ®æ‰¹é‡å†™å›åˆ°æ•°æ®æºã€‚å†™å…¥å›å†™ç­–ç•¥å¯ä»¥å‡å°‘å¯¹æ•°æ®æºçš„é¢‘ç¹å†™å…¥æ“ä½œï¼Œæé«˜æ€§èƒ½ã€‚ å†™å…¥æ—è·¯ï¼ˆWrite-Aroundï¼‰ï¼šå°†å†™æ“ä½œç›´æ¥å‘é€åˆ°æ•°æ®æºï¼Œè€Œä¸æ˜¯é€šè¿‡ç¼“å­˜ã€‚è¿™æ ·å¯ä»¥é¿å…å°†ä¸ç»å¸¸è®¿é—®çš„æ•°æ®å†™å…¥ç¼“å­˜ï¼Œä»è€ŒèŠ‚çœç¼“å­˜ç©ºé—´ã€‚åªæœ‰å½“æ•°æ®è¢«è¯»å–æ—¶ï¼Œæ‰ä¼šå°†å…¶æ”¾å…¥ç¼“å­˜ã€‚ åˆ·æ–°é¢„å–ï¼ˆRefresh-Aheadï¼‰ï¼šåœ¨ç¼“å­˜ä¸­å­˜å‚¨æ•°æ®çš„åŒæ—¶ï¼Œé¢„å…ˆè·å–å’Œæ›´æ–°ä¸å½“å‰æ•°æ®ç›¸å…³çš„å…¶ä»–æ•°æ®ã€‚è¿™æ ·ï¼Œå½“éœ€è¦è®¿é—®ç›¸å…³æ•°æ®æ—¶ï¼Œå¯ä»¥ç›´æ¥ä»ç¼“å­˜ä¸­è·å–ï¼Œå‡å°‘ç­‰å¾…æ—¶é—´ã€‚ æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLeast Recently Used, LRUï¼‰ï¼šæ ¹æ®æ•°æ®çš„è®¿é—®é¢‘ç‡å’Œæ—¶é—´è¿›è¡Œç¼“å­˜æ·˜æ±°ã€‚å½“ç¼“å­˜ç©ºé—´ä¸è¶³æ—¶ï¼Œä¼˜å…ˆæ·˜æ±°æœ€è¿‘æœ€å°‘è¢«è®¿é—®çš„æ•°æ®ï¼Œä»¥ä¿ç•™æœ€å¸¸ç”¨çš„æ•°æ®ã€‚ å›ºå®šæ—¶é—´è¿‡æœŸï¼ˆTime-To-Live, TTLï¼‰ï¼šä¸ºç¼“å­˜ä¸­çš„æ¯ä¸ªæ•°æ®é¡¹è®¾ç½®ä¸€ä¸ªå›ºå®šçš„è¿‡æœŸæ—¶é—´ã€‚ä¸€æ—¦æ•°æ®é¡¹è¶…è¿‡è¿‡æœŸæ—¶é—´ï¼Œå°†è¢«è§†ä¸ºè¿‡æœŸå¹¶ä»ç¼“å­˜ä¸­ç§»é™¤ã€‚ å¼‚æ­¥åˆ·æ–°ï¼ˆAsynchronous Refreshï¼‰ï¼šåœ¨æ•°æ®è¿‡æœŸæˆ–æ— æ•ˆæ—¶ï¼Œé€šè¿‡å¼‚æ­¥æ–¹å¼ä»æ•°æ®æºè·å–æ–°æ•°æ®å¹¶æ›´æ–°ç¼“å­˜ã€‚è¿™æ ·å¯ä»¥é¿å…é˜»å¡è°ƒç”¨æ–¹ï¼Œæé«˜ç³»ç»Ÿçš„å“åº”é€Ÿåº¦ã€‚ ç¼“å­˜æ¡†æ¶ å½“æ¶‰åŠåˆ°ç¼“å­˜æ¡†æ¶æˆ–å·¥å…·æ—¶ï¼Œæœ‰å‡ ä¸ªå¸¸è§ä¸”å¹¿æ³›ä½¿ç”¨çš„é€‰é¡¹å¯ä»¥è€ƒè™‘ã€‚ä»¥ä¸‹æ˜¯å…¶ä¸­ä¸€äº›å¸¸è§çš„ç¼“å­˜æ¡†æ¶æˆ–å·¥å…·ï¼š\nEhcache: Ehcache æ˜¯ä¸€ä¸ªæµè¡Œçš„å¼€æº Java ç¼“å­˜æ¡†æ¶ï¼Œæä¾›äº†å„ç§ç¼“å­˜ç­–ç•¥å’ŒåŠŸèƒ½ï¼ŒåŒ…æ‹¬å†…å­˜ç¼“å­˜ã€ç£ç›˜ç¼“å­˜ã€åˆ†å¸ƒå¼ç¼“å­˜ç­‰ã€‚å®ƒæ˜“äºä½¿ç”¨ä¸”æ€§èƒ½ä¼˜ç§€ï¼Œå¯ä»¥è½»æ¾é›†æˆåˆ° Java åº”ç”¨ç¨‹åºä¸­ã€‚ Redis: Redis æ˜¯ä¸€ä¸ªå¼€æºçš„é«˜æ€§èƒ½å†…å­˜æ•°æ®ç»“æ„å­˜å‚¨ç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥ç”¨ä½œç¼“å­˜ã€‚å®ƒæ”¯æŒå¤šç§æ•°æ®ç»“æ„å’Œä¸°å¯Œçš„ç¼“å­˜åŠŸèƒ½ï¼Œå¦‚æ•°æ®è¿‡æœŸã€æŒä¹…åŒ–ã€åˆ†å¸ƒå¼ç¼“å­˜ç­‰ã€‚Redis å¯ä»¥ä½œä¸ºç‹¬ç«‹çš„ç¼“å­˜æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥ä¸åº”ç”¨ç¨‹åºé›†æˆä½¿ç”¨ã€‚ Memcached: Memcached æ˜¯ä¸€ä¸ªç®€å•è€Œé«˜æ•ˆçš„åˆ†å¸ƒå¼å†…å­˜å¯¹è±¡ç¼“å­˜ç³»ç»Ÿã€‚å®ƒä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨æ•°æ®ï¼Œå¹¶æä¾›äº†åˆ†å¸ƒå¼ç¼“å­˜çš„æ”¯æŒã€‚Memcached é€‚ç”¨äºé«˜å¹¶å‘ç¯å¢ƒä¸‹çš„ç¼“å­˜éœ€æ±‚ï¼Œå¯ä»¥å‡è½»åç«¯æ•°æ®åº“çš„å‹åŠ›ã€‚ Caffeine: Caffeine æ˜¯ä¸€ä¸ªåŸºäº Java çš„é«˜æ€§èƒ½ç¼“å­˜åº“ï¼Œä¸“æ³¨äºæä¾›å¿«é€Ÿçš„ç¼“å­˜è®¿é—®å’Œé«˜æ•ˆçš„å†…å­˜ç®¡ç†ã€‚å®ƒæ”¯æŒå„ç§ç¼“å­˜ç­–ç•¥å’ŒåŠŸèƒ½ï¼Œå¹¶æä¾›äº†çº¿ç¨‹å®‰å…¨å’Œå¼‚æ­¥åŠ è½½ç­‰ç‰¹æ€§ã€‚ Hazelcast: Hazelcast æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨å’Œè®¡ç®—å¹³å°ï¼Œå…¶ä¸­åŒ…æ‹¬äº†åˆ†å¸ƒå¼ç¼“å­˜çš„åŠŸèƒ½ã€‚å®ƒæä¾›äº†é«˜å¯ç”¨æ€§å’Œå¯æ‰©å±•æ€§ï¼Œå¹¶æ”¯æŒå¤šç§ç¼“å­˜ç­–ç•¥å’Œåˆ†å¸ƒå¼ç¼“å­˜æ¨¡å¼ã€‚ Guava Cache: Guava Cache æ˜¯ Google çš„ Guava åº“ä¸­æä¾›çš„ä¸€ä¸ªæœ¬åœ°ç¼“å­˜å®ç°ã€‚å®ƒæä¾›äº†ç®€å•æ˜“ç”¨çš„ APIï¼Œæ”¯æŒå„ç§ç¼“å­˜ç­–ç•¥å’ŒåŠŸèƒ½ï¼Œå¦‚è¿‡æœŸæ—¶é—´ã€æœ€å¤§ç¼“å­˜å¤§å°ã€ç¼“å­˜ç»Ÿè®¡ç­‰ã€‚ Apache Ignite: Apache Ignite æ˜¯ä¸€ä¸ªå†…å­˜è®¡ç®—å¹³å°ï¼Œæä¾›äº†åˆ†å¸ƒå¼ç¼“å­˜å’Œè®¡ç®—èƒ½åŠ›ã€‚å®ƒå¯ä»¥ä½œä¸ºä¸€ä¸ªåˆ†å¸ƒå¼ç¼“å­˜å­˜å‚¨æ•°æ®ï¼Œå¹¶æ”¯æŒ SQL æŸ¥è¯¢ã€åˆ†å¸ƒå¼è®¡ç®—ã€æµå¤„ç†ç­‰åŠŸèƒ½ã€‚ Couchbase: Couchbase æ˜¯ä¸€ä¸ªé¢å‘ä¼ä¸šåº”ç”¨çš„ NoSQL æ•°æ®åº“å’Œç¼“å­˜å¹³å°ã€‚å®ƒæä¾›äº†å¯æ‰©å±•çš„å†…å­˜ç¼“å­˜åŠŸèƒ½ï¼Œå¹¶æ”¯æŒæ•°æ®æŒä¹…åŒ–å’Œåˆ†å¸ƒå¼ç¼“å­˜é›†ç¾¤ã€‚ Aerospike: Aerospike æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ NoSQL æ•°æ®åº“å’Œç¼“å­˜å¹³å°ï¼Œä¸“æ³¨äºæä¾›ä½å»¶è¿Ÿå’Œé«˜ååé‡çš„æ•°æ®è®¿é—®ã€‚å®ƒæ”¯æŒå†…å­˜å’Œé—ªå­˜å­˜å‚¨ï¼Œå¹¶å…·æœ‰åˆ†å¸ƒå¼ç¼“å­˜çš„åŠŸèƒ½ã€‚ Oracle Coherence: Oracle Coherence æ˜¯ä¸€ä¸ªä¼ä¸šçº§çš„åˆ†å¸ƒå¼ç¼“å­˜å’Œæ•°æ®ç½‘æ ¼è§£å†³æ–¹æ¡ˆã€‚å®ƒæä¾›äº†é«˜å¯ç”¨æ€§ã€å¯æ‰©å±•æ€§å’Œäº‹åŠ¡æ”¯æŒï¼Œå¹¶æ”¯æŒå¤šç§ç¼“å­˜ç­–ç•¥å’Œæ•°æ®å¤åˆ¶æ¨¡å¼ã€‚ ","title":"Javaè®¾è®¡æ¨¡å¼ï¼šCaching"},{"content":"åœ¨ React ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å¤šç§æ–¹æ³•æ¥åˆå§‹åŒ–ä¸€ä¸ªåº”ç”¨ç¨‹åºã€‚ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„æ–¹æ³•ï¼š\nä½¿ç”¨ Create React Appï¼ˆCRAï¼‰ã€‚Create React App æ˜¯ä¸€ä¸ªå®˜æ–¹æä¾›çš„è„šæ‰‹æ¶å·¥å…·ï¼Œç”¨äºå¿«é€Ÿåˆ›å»º React åº”ç”¨ç¨‹åºçš„åŸºæœ¬ç»“æ„å’Œé…ç½®ã€‚ ä½¿ç”¨ Viteã€‚Vite æ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€å•ä¸”ç°ä»£åŒ–çš„å‰ç«¯æ„å»ºå·¥å…·ã€‚ create-react-app create-react-app æ˜¯ä¸€ä¸ªç”¨äºå¿«é€Ÿåˆ›å»º React åº”ç”¨ç¨‹åºçš„å‘½ä»¤è¡Œå·¥å…·ã€‚å®ƒæä¾›äº†ä¸€ä¸ªç®€å•çš„æ–¹å¼æ¥è®¾ç½®å’Œé…ç½®ä¸€ä¸ªå…¨æ–°çš„ React é¡¹ç›®ï¼ŒåŒ…æ‹¬æ„å»ºã€å¼€å‘æœåŠ¡å™¨å’Œå…¶ä»–å¸¸è§çš„é…ç½®ã€‚\nè¦ä½¿ç”¨ create-react-app åˆ›å»ºä¸€ä¸ªæ–°çš„ React é¡¹ç›®ï¼Œæ‚¨å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œï¼š\nå®‰è£… Node.js\nåˆ›å»º React åº”ç”¨ï¼šä¸€æ—¦ä½ å®‰è£…äº† Node.jsï¼Œä½ å¯ä»¥ä½¿ç”¨ create-react-app å·¥å…·å¿«é€Ÿåˆ›å»ºä¸€ä¸ªæ–°çš„ React åº”ç”¨ã€‚\nåœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å…¨å±€å®‰è£… create-react-appï¼š\nnpm install -g create-react-app åˆ›å»ºæ–°çš„ React åº”ç”¨ï¼šä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–°çš„ React åº”ç”¨ï¼š create-react-app my-app æç¤ºï¼š\nnpx æ˜¯åœ¨è¿è¡Œå‘½ä»¤æ—¶ä¸´æ—¶å®‰è£…å’Œæ‰§è¡ŒåŒ…çš„å·¥å…·ã€‚è¿™æ„å‘³ç€æ‚¨æ— éœ€å…¨å±€å®‰è£… create-react-appï¼Œè€Œæ˜¯åœ¨è¿è¡Œ npx create-react-app å‘½ä»¤æ—¶è‡ªåŠ¨ä¸‹è½½å’Œä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ create-react-appã€‚\nnpx create-react-app my-app è¿™å°†åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º \u0026quot;my-app\u0026quot; çš„æ–°æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨æ­¤æ–‡ä»¶å¤¹é‡Œåšäº†å¦‚ä¸‹å·¥ä½œï¼š\nä¸ºä½ çš„åº”ç”¨ç¨‹åºå®‰è£…äº†ä¸€äº› npm åŒ…ï¼› å†™å…¥ react åº”ç”¨å¯åŠ¨æ‰€éœ€è¦çš„è„šæœ¬æ–‡ä»¶ï¼› åˆ›å»ºä¸€ç³»åˆ—ç»“æ„åŒ–çš„å­æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ï¼› å¦‚æœä½ çš„ç”µè„‘ä¸Šå®‰è£…äº† git çš„è¯ï¼Œé¡ºä¾¿å¸®ä½ æŠŠ git ä»“åº“ä¹Ÿå»ºå¥½ã€‚ å¦‚æœä½ çš„ç”µè„‘ä¸Šå®‰è£…äº† yarn çš„è¯ï¼Œcreate-react-app ä¼šé»˜è®¤ä½¿ç”¨ yarn è€Œé npmã€‚å¦‚æœä½ åŒæ—¶å®‰è£…äº† yarn å’Œ npmï¼Œä½†ä½ å¸Œæœ›ä½¿ç”¨ npm çš„è¯ï¼Œåœ¨ create-react-app çš„æ—¶å€™éœ€è¦è¾“å…¥ --use-npm ï¼š\ncreate-react-app my-app --use-npm è¿›å…¥åº”ç”¨ç›®å½•ï¼šè¿›å…¥æ–°åˆ›å»ºçš„åº”ç”¨ç¨‹åºç›®å½•ã€‚åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š cd my-app å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼šè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨ React å¼€å‘æœåŠ¡å™¨ï¼š npm start å…ˆå‰ç”± create-react-app åˆ›å»ºçš„è„šæœ¬ä¼šå¯åŠ¨ä¸€ä¸ªåœ°æœåŠ¡ localhost:3000ï¼Œå¹¶æ‰“å¼€ä½ çš„é»˜è®¤æµè§ˆå™¨æ¥è®¿é—®è¿™ä¸ªæœåŠ¡ã€‚æˆåŠŸå¯åŠ¨æµè§ˆå™¨çš„è¯ï¼Œä½ çš„æµè§ˆå™¨ä¸Šä¼šæ˜¾ç¤ºå¦‚ä¸‹ç”»é¢ï¼š\nåº”ç”¨ç»“æ„\ncreate-react-app æä¾›äº†å¼€å‘ React åº”ç”¨æ‰€éœ€çš„å·¥å…·ã€‚å®ƒçš„åˆå§‹æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š\nmy-app â”œâ”€â”€ README.md â”œâ”€â”€ node_modules â”œâ”€â”€ package.json â”œâ”€â”€ package-lock.json â”œâ”€â”€ .gitignore â”œâ”€â”€ public â”‚ â”œâ”€â”€ favicon.ico â”‚ â”œâ”€â”€ index.html â”‚ â””â”€â”€ manifest.json â””â”€â”€ src â”œâ”€â”€ App.css â”œâ”€â”€ App.js â”œâ”€â”€ App.test.js â”œâ”€â”€ index.css â”œâ”€â”€ index.js â”œâ”€â”€ logo.svg â””â”€â”€ reportWebVitals.js å„ç›®å½•å’Œæ–‡ä»¶è¯´æ˜ï¼š\nç›®å½• src æ˜¯æˆ‘ä»¬èŠ±è´¹æ—¶é—´æœ€å¤šçš„åœ°æ–¹ï¼Œå› ä¸ºå®ƒæ˜¯æˆ‘ä»¬ React åº”ç”¨æºç å­˜æ”¾çš„ç›®å½•ã€‚\nç›®å½• public åŒ…å«äº†å¼€å‘åº”ç”¨æ—¶æµè§ˆå™¨ä¼šè¯»å–çš„æ–‡ä»¶ï¼Œå…¶ä¸­æœ€é‡è¦çš„å°±æ˜¯ index.htmlã€‚React å°†ç›®å½• src ä¸­çš„ä»£ç åµŒå…¥è¿™ä¸ªæ–‡ä»¶ï¼Œä»è€Œæµè§ˆå™¨æ‰èƒ½è¿è¡Œæ­¤æ–‡ä»¶ã€‚ index.htmlä¸­çš„æœ‰äº›å†…å®¹å…³ä¹ create-react-app çš„è¿ä½œï¼Œå› æ­¤é™¤éä½ çŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆæ ·çš„ä¿®æ”¹ï¼Œå¦åˆ™ä¸å»ºè®®ç¼–è¾‘è¿™ä¸ªæ–‡ä»¶ã€‚å½“ç„¶ï¼Œä½ å¯ä»¥ä¿®æ”¹index.htmlä¸­çš„ title å…ƒç´ çš„å†…å®¹æ¥è¡¨ç°æ­¤åº”ç”¨ç¨‹åºé€šä¿—æ˜“æ‡‚çš„åç§°ã€‚\nç›®å½• public ä¼šåœ¨å»ºç«‹å¹¶éƒ¨ç½²æ­¤åº”ç”¨çš„æ—¶å€™æ›´æ–°ã€‚\næ–‡ä»¶ package.json åŒ…å«äº† Node.js/npm ä¸ºäº†å»ºç«‹è¯¥åº”ç”¨ç¨‹åºæ‰€ç®¡ç†ç€çš„æ–‡ä»¶ä¿¡æ¯ã€‚\nç¼–è¾‘ React ç»„ä»¶ã€‚åœ¨ src ç›®å½•ä¸­ï¼Œå¯ä»¥æ‰¾åˆ°åä¸º App.js çš„æ–‡ä»¶ã€‚è¿™æ˜¯ React åº”ç”¨çš„ä¸»è¦ç»„ä»¶ã€‚ä½ å¯ä»¥ç¼–è¾‘è¯¥æ–‡ä»¶ä»¥æ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤ç»„ä»¶çš„å†…å®¹ã€‚\ncreate-react-app æ·»åŠ äº†ä¸€äº›æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­å®Œå…¨ä¸ä¼šç”¨åˆ°çš„æ–‡ä»¶ã€‚\næˆ‘ä»¬ä¸æ‰“ç®—å†™æ¯ä¸ªç»„ä»¶çš„æ ·å¼è¡¨ï¼Œæ‰€ä»¥é¦–å…ˆä» App.js çš„é¡¶éƒ¨åˆ é™¤ App.css çš„å¯¼å…¥ã€‚ æˆ‘ä»¬ä¹Ÿä¸æ‰“ç®—ä½¿ç”¨ logo.svg æ–‡ä»¶ï¼Œæ‰€ä»¥ä¹Ÿè¦åˆ é™¤è¿™ä¸ªå¯¼å…¥ã€‚ cd src # Delete a few files rm -- App.test.js App.css logo.svg reportWebVitals.js setupTests.js # Move back up to the root of the project cd .. ä¿®æ”¹ src/App.js å¦‚ä¸‹ï¼š\nimport \u0026#34;./App.css\u0026#34;; function App() { return ( \u0026lt;div className=\u0026#34;App\u0026#34;\u0026gt; \u0026lt;header\u0026gt; \u0026lt;p\u0026gt;Hello React\u0026lt;/p\u0026gt; \u0026lt;/header\u0026gt; \u0026lt;/div\u0026gt; ); } export default App; ä¿®æ”¹ src/index.js å¦‚ä¸‹ï¼š\nimport React from \u0026#34;react\u0026#34;; import ReactDOM from \u0026#34;react-dom/client\u0026#34;; import \u0026#34;./index.css\u0026#34;; import App from \u0026#34;./App\u0026#34;; const root = ReactDOM.createRoot(document.getElementById(\u0026#34;root\u0026#34;)); root.render( \u0026lt;React.StrictMode\u0026gt; \u0026lt;App /\u0026gt; \u0026lt;/React.StrictMode\u0026gt; ); æŸ¥çœ‹åº”ç”¨ç¨‹åºï¼šåœ¨ä½ è¿›è¡Œç¼–è¾‘å¹¶ä¿å­˜ä»£ç åï¼Œå¼€å‘æœåŠ¡å™¨å°†è‡ªåŠ¨é‡æ–°åŠ è½½å¹¶åˆ·æ–°åº”ç”¨ç¨‹åºã€‚ä½ å¯ä»¥åœ¨é»˜è®¤æµè§ˆå™¨ä¸­æŸ¥çœ‹æ›´æ–°åçš„åº”ç”¨ç¨‹åºã€‚\nvite è¦ä½¿ç”¨ Vite åˆ›å»ºä¸€ä¸ª React é¡¹ç›®ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œï¼š\nç¡®ä¿ä½ å·²ç»å®‰è£…äº† Node.jsã€‚ å®‰è£… Viteï¼šåœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å…¨å±€å®‰è£… Viteï¼š npm install -g create-vite åˆ›å»ºæ–°çš„ React é¡¹ç›®ï¼šä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–°çš„ React é¡¹ç›®ï¼š create-vite my-app-vite --template react --template react å‚æ•°å‘Šè¯‰ Vite ä½¿ç”¨ React æ¨¡æ¿æ¥åˆ›å»ºé¡¹ç›®ã€‚\nè¿›å…¥é¡¹ç›®ç›®å½•ï¼šè¿›å…¥æ–°åˆ›å»ºçš„é¡¹ç›®ç›®å½•ã€‚åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š cd my-app-vite å®‰è£…ä¾èµ–é¡¹ï¼šåœ¨é¡¹ç›®ç›®å½•ä¸­ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…é¡¹ç›®çš„ä¾èµ–é¡¹ï¼š npm install å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼šè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨ Vite å¼€å‘æœåŠ¡å™¨ï¼š npm run dev è¿™å°†å¯åŠ¨å¼€å‘æœåŠ¡å™¨å¹¶åœ¨é»˜è®¤æµè§ˆå™¨ä¸­æ‰“å¼€é¡¹ç›®ã€‚ä½ å¯ä»¥åœ¨å¼€å‘æœåŠ¡å™¨è¿è¡ŒæœŸé—´è¿›è¡Œä»£ç ç¼–è¾‘ï¼Œå¹¶å®æ—¶æŸ¥çœ‹é¡¹ç›®çš„æ›´æ”¹ã€‚\nç¼–è¾‘ React ç»„ä»¶ï¼šåœ¨ src ç›®å½•ä¸­ï¼Œå¯ä»¥æ‰¾åˆ°åä¸º App.jsx çš„æ–‡ä»¶ã€‚è¿™æ˜¯ React é¡¹ç›®çš„ä¸»è¦ç»„ä»¶ã€‚ä½ å¯ä»¥ç¼–è¾‘è¯¥æ–‡ä»¶ä»¥æ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤ç»„ä»¶çš„å†…å®¹ã€‚\næŸ¥çœ‹é¡¹ç›®ï¼šåœ¨ä½ è¿›è¡Œç¼–è¾‘å¹¶ä¿å­˜ä»£ç åï¼Œå¼€å‘æœåŠ¡å™¨å°†è‡ªåŠ¨é‡æ–°åŠ è½½å¹¶åˆ·æ–°é¡¹ç›®ã€‚ä½ å¯ä»¥åœ¨é»˜è®¤æµè§ˆå™¨ä¸­æŸ¥çœ‹æ›´æ–°åçš„é¡¹ç›®ã€‚\ncreate-react-app å’Œ vite åŒºåˆ« Create React App (CRA) å’Œ Vite æ˜¯ä¸¤ç§å¸¸ç”¨çš„å·¥å…·ï¼Œç”¨äºåˆ›å»ºå’Œå¼€å‘ React åº”ç”¨ç¨‹åºï¼Œå®ƒä»¬åœ¨ä¸€äº›æ–¹é¢æœ‰æ‰€åŒºåˆ«ã€‚\næ„å»ºæ–¹å¼ï¼š Create React Appï¼šCRA æ˜¯ä¸€ä¸ªç”¨äºæ„å»º React åº”ç”¨ç¨‹åºçš„è„šæ‰‹æ¶å·¥å…·ã€‚å®ƒä½¿ç”¨ Webpack ä½œä¸ºæ„å»ºå·¥å…·ï¼Œå¹¶é…ç½®äº†ä¸€ç»„é»˜è®¤çš„æ„å»ºé…ç½®ï¼Œä½¿å¾—å¼€å‘è€…æ— éœ€æ‰‹åŠ¨é…ç½®å³å¯å¼€å§‹å¼€å‘ React åº”ç”¨ç¨‹åºã€‚ Viteï¼šVite æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„æ„å»ºå·¥å…·ï¼Œä¸“ä¸ºç°ä»£ Web å¼€å‘è€Œè®¾è®¡ã€‚å®ƒä½¿ç”¨ ES æ¨¡å—ä½œä¸ºå¼€å‘æ—¶çš„æ„å»ºæ–¹å¼ï¼Œåˆ©ç”¨æµè§ˆå™¨åŸç”Ÿæ”¯æŒçš„æ¨¡å—è§£æåŠŸèƒ½ï¼Œå®ç°äº†å¿«é€Ÿçš„å†·å¯åŠ¨å’Œçƒ­æ¨¡å—æ›¿æ¢ï¼ˆHMRï¼‰ã€‚ å¼€å‘ä½“éªŒï¼š Create React Appï¼šCRA æä¾›äº†ä¸€ä¸ªç®€å•ä¸”ä¸€è‡´çš„å¼€å‘ç¯å¢ƒï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥ä¸“æ³¨äºç¼–å†™ React ç»„ä»¶å’Œä¸šåŠ¡é€»è¾‘ã€‚å®ƒéšè—äº†å¤§éƒ¨åˆ†çš„æ„å»ºé…ç½®ç»†èŠ‚ï¼Œä½¿å¾—å¼€å‘è€…æ— éœ€å…³å¿ƒåº•å±‚çš„æ„å»ºé…ç½®ã€‚ Viteï¼šVite åœ¨å¼€å‘ç¯å¢ƒä¸­å…·æœ‰å‡ºè‰²çš„å¼€å‘ä½“éªŒã€‚å®ƒé€šè¿‡ä½¿ç”¨ ES æ¨¡å—çš„ç›´æ¥å¯¼å…¥ï¼Œé¿å…äº†ä¼ ç»Ÿçš„æ„å»ºæ­¥éª¤ï¼Œå¤§å¤§å‡å°‘äº†å†·å¯åŠ¨æ—¶é—´ï¼ŒåŒæ—¶æä¾›äº†å¿«é€Ÿçš„çƒ­æ¨¡å—æ›¿æ¢ï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿæ›´å¿«åœ°çœ‹åˆ°ä»£ç æ›´æ”¹çš„æ•ˆæœã€‚ æ„å»ºé€Ÿåº¦ï¼š Create React Appï¼šCRA ä½¿ç”¨ Webpack è¿›è¡Œæ„å»ºï¼Œé€šå¸¸åœ¨é¡¹ç›®è¾ƒå¤§æ—¶ï¼Œæ„å»ºæ—¶é—´ä¼šç›¸å¯¹è¾ƒé•¿ã€‚ Viteï¼šVite åˆ©ç”¨äº†ç°ä»£æµè§ˆå™¨å¯¹ ES æ¨¡å—çš„åŸç”Ÿæ”¯æŒï¼Œæ„å»ºé€Ÿåº¦éå¸¸å¿«ï¼Œå°¤å…¶åœ¨å¼€å‘ç¯å¢ƒä¸­ã€‚ é…ç½®çµæ´»æ€§ï¼š Create React Appï¼šCRA æä¾›äº†é¢„å®šä¹‰çš„æ„å»ºé…ç½®ï¼Œå¯¹äºå¤§å¤šæ•°åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œè¿™äº›é…ç½®å·²ç»è¶³å¤Ÿã€‚å¦‚æœä½ éœ€è¦æ›´æ”¹æ„å»ºé…ç½®ï¼Œä½ éœ€è¦ä½¿ç”¨ eject å‘½ä»¤å°†é…ç½®æš´éœ²å‡ºæ¥ï¼Œå¹¶è‡ªå·±è¿›è¡Œé…ç½®ã€‚ Viteï¼šVite çš„é…ç½®æ–¹å¼éå¸¸çµæ´»ï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦è‡ªå®šä¹‰é…ç½®ã€‚Vite ä½¿ç”¨äº†ä¸€ç§åŸºäºæ’ä»¶çš„æ–¹å¼æ¥æ‰©å±•å’Œä¿®æ”¹æ„å»ºé…ç½®ï¼Œä½¿å¾—é…ç½®æ›´åŠ ç›´è§‚å’Œå¯ç»´æŠ¤ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼ŒCreate React App é€‚åˆé‚£äº›å¸Œæœ›å¿«é€Ÿå¯åŠ¨ React é¡¹ç›®ä¸”ä¸éœ€è¦è¿‡å¤šè‡ªå®šä¹‰é…ç½®çš„å¼€å‘è€…ã€‚è€Œ Vite åˆ™é€‚åˆå¯¹å¼€å‘ä½“éªŒå’Œæ„å»ºé€Ÿåº¦æœ‰è¾ƒé«˜è¦æ±‚çš„å¼€å‘è€…ï¼Œå¹¶æä¾›äº†æ›´å¤§çš„é…ç½®çµæ´»æ€§ã€‚é€‰æ‹©ä½¿ç”¨å“ªä¸ªå·¥å…·å–å†³äºä½ çš„å…·ä½“éœ€æ±‚å’Œé¡¹ç›®ç‰¹ç‚¹ã€‚\nå‚è€ƒæ–‡ç«  React å…¥é—¨ ","permalink":"https://blog.chensoul.cc/posts/2023/09/22/react-create-project/","summary":"åœ¨ React ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å¤šç§æ–¹æ³•æ¥åˆå§‹åŒ–ä¸€ä¸ªåº”ç”¨ç¨‹åºã€‚ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„æ–¹æ³•ï¼š\nä½¿ç”¨ Create React Appï¼ˆCRAï¼‰ã€‚Create React App æ˜¯ä¸€ä¸ªå®˜æ–¹æä¾›çš„è„šæ‰‹æ¶å·¥å…·ï¼Œç”¨äºå¿«é€Ÿåˆ›å»º React åº”ç”¨ç¨‹åºçš„åŸºæœ¬ç»“æ„å’Œé…ç½®ã€‚ ä½¿ç”¨ Viteã€‚Vite æ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€å•ä¸”ç°ä»£åŒ–çš„å‰ç«¯æ„å»ºå·¥å…·ã€‚ create-react-app create-react-app æ˜¯ä¸€ä¸ªç”¨äºå¿«é€Ÿåˆ›å»º React åº”ç”¨ç¨‹åºçš„å‘½ä»¤è¡Œå·¥å…·ã€‚å®ƒæä¾›äº†ä¸€ä¸ªç®€å•çš„æ–¹å¼æ¥è®¾ç½®å’Œé…ç½®ä¸€ä¸ªå…¨æ–°çš„ React é¡¹ç›®ï¼ŒåŒ…æ‹¬æ„å»ºã€å¼€å‘æœåŠ¡å™¨å’Œå…¶ä»–å¸¸è§çš„é…ç½®ã€‚\nè¦ä½¿ç”¨ create-react-app åˆ›å»ºä¸€ä¸ªæ–°çš„ React é¡¹ç›®ï¼Œæ‚¨å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œï¼š\nå®‰è£… Node.js\nåˆ›å»º React åº”ç”¨ï¼šä¸€æ—¦ä½ å®‰è£…äº† Node.jsï¼Œä½ å¯ä»¥ä½¿ç”¨ create-react-app å·¥å…·å¿«é€Ÿåˆ›å»ºä¸€ä¸ªæ–°çš„ React åº”ç”¨ã€‚\nåœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å…¨å±€å®‰è£… create-react-appï¼š\nnpm install -g create-react-app åˆ›å»ºæ–°çš„ React åº”ç”¨ï¼šä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–°çš„ React åº”ç”¨ï¼š create-react-app my-app æç¤ºï¼š\nnpx æ˜¯åœ¨è¿è¡Œå‘½ä»¤æ—¶ä¸´æ—¶å®‰è£…å’Œæ‰§è¡ŒåŒ…çš„å·¥å…·ã€‚è¿™æ„å‘³ç€æ‚¨æ— éœ€å…¨å±€å®‰è£… create-react-appï¼Œè€Œæ˜¯åœ¨è¿è¡Œ npx create-react-app å‘½ä»¤æ—¶è‡ªåŠ¨ä¸‹è½½å’Œä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ create-react-appã€‚\nnpx create-react-app my-app è¿™å°†åœ¨å½“å‰ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º \u0026quot;my-app\u0026quot; çš„æ–°æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨æ­¤æ–‡ä»¶å¤¹é‡Œåšäº†å¦‚ä¸‹å·¥ä½œï¼š\nä¸ºä½ çš„åº”ç”¨ç¨‹åºå®‰è£…äº†ä¸€äº› npm åŒ…ï¼› å†™å…¥ react åº”ç”¨å¯åŠ¨æ‰€éœ€è¦çš„è„šæœ¬æ–‡ä»¶ï¼› åˆ›å»ºä¸€ç³»åˆ—ç»“æ„åŒ–çš„å­æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ï¼› å¦‚æœä½ çš„ç”µè„‘ä¸Šå®‰è£…äº† git çš„è¯ï¼Œé¡ºä¾¿å¸®ä½ æŠŠ git ä»“åº“ä¹Ÿå»ºå¥½ã€‚ å¦‚æœä½ çš„ç”µè„‘ä¸Šå®‰è£…äº† yarn çš„è¯ï¼Œcreate-react-app ä¼šé»˜è®¤ä½¿ç”¨ yarn è€Œé npmã€‚å¦‚æœä½ åŒæ—¶å®‰è£…äº† yarn å’Œ npmï¼Œä½†ä½ å¸Œæœ›ä½¿ç”¨ npm çš„è¯ï¼Œåœ¨ create-react-app çš„æ—¶å€™éœ€è¦è¾“å…¥ --use-npm ï¼š\ncreate-react-app my-app --use-npm è¿›å…¥åº”ç”¨ç›®å½•ï¼šè¿›å…¥æ–°åˆ›å»ºçš„åº”ç”¨ç¨‹åºç›®å½•ã€‚åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š cd my-app å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼šè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨ React å¼€å‘æœåŠ¡å™¨ï¼š npm start å…ˆå‰ç”± create-react-app åˆ›å»ºçš„è„šæœ¬ä¼šå¯åŠ¨ä¸€ä¸ªåœ°æœåŠ¡ localhost:3000ï¼Œå¹¶æ‰“å¼€ä½ çš„é»˜è®¤æµè§ˆå™¨æ¥è®¿é—®è¿™ä¸ªæœåŠ¡ã€‚æˆåŠŸå¯åŠ¨æµè§ˆå™¨çš„è¯ï¼Œä½ çš„æµè§ˆå™¨ä¸Šä¼šæ˜¾ç¤ºå¦‚ä¸‹ç”»é¢ï¼š","title":"Reactå…¥é—¨ï¼šåˆå§‹åŒ–åº”ç”¨çš„ä¸¤ç§æ–¹æ³•"},{"content":"æœ¬æ–‡ä¸»è¦ä»‹ç» Bytecode æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nä»‹ç» å­—èŠ‚ç è®¾è®¡æ¨¡å¼æ˜¯ä¸€ç§è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸ä»¥æ•°æ®é©±åŠ¨çš„æ–¹å¼å®šä¹‰å’Œæ‰§è¡Œè¡Œä¸ºã€‚åœ¨å­—èŠ‚ç è®¾è®¡æ¨¡å¼ä¸­ï¼Œè¡Œä¸ºè¢«è¡¨ç¤ºä¸ºä¸€ç³»åˆ—è™šæ‹ŸæœºæŒ‡ä»¤ï¼Œè¿™äº›æŒ‡ä»¤è¢«ç¼–ç ä¸ºå­—èŠ‚ç ï¼Œå¹¶åœ¨è¿è¡Œæ—¶æ‰§è¡Œã€‚\nå­—èŠ‚ç è®¾è®¡æ¨¡å¼çš„ç›®çš„æ˜¯å°†è¡Œä¸ºä¸ä»£ç åˆ†ç¦»ï¼Œä½¿å¾—è¡Œä¸ºå¯ä»¥åœ¨ä¸ä¿®æ”¹æºä»£ç çš„æƒ…å†µä¸‹è¿›è¡ŒåŠ¨æ€è°ƒæ•´å’Œæ‰©å±•ã€‚é€šè¿‡å°†è¡Œä¸ºä»¥æ•°æ®çš„å½¢å¼è¡¨ç¤ºï¼Œå¹¶ä½¿ç”¨å­—èŠ‚ç æŒ‡ä»¤è¿›è¡Œæ‰§è¡Œï¼Œå¯ä»¥å®ç°æ›´çµæ´»å’Œå¯é…ç½®çš„è¡Œä¸ºé€»è¾‘ã€‚\nä¸‹é¢æ˜¯å­—èŠ‚ç è®¾è®¡æ¨¡å¼çš„ä¸€äº›å…³é”®è¦ç‚¹ï¼š\næŒ‡ä»¤é›†ï¼šå­—èŠ‚ç è®¾è®¡æ¨¡å¼é€šè¿‡å®šä¹‰ä¸€ç»„æŒ‡ä»¤é›†æ¥è¡¨ç¤ºä¸åŒçš„è¡Œä¸ºã€‚æ¯ä¸ªæŒ‡ä»¤éƒ½æœ‰è‡ªå·±çš„è¯­ä¹‰å’Œæ“ä½œæ–¹å¼ï¼Œç”¨äºæ‰§è¡Œç‰¹å®šçš„è¡Œä¸ºé€»è¾‘ã€‚ è™šæ‹Ÿæœºï¼šå­—èŠ‚ç è®¾è®¡æ¨¡å¼éœ€è¦ä¸€ä¸ªè™šæ‹Ÿæœºæ¥æ‰§è¡ŒæŒ‡ä»¤é›†ã€‚è™šæ‹Ÿæœºè´Ÿè´£è§£é‡Šå’Œæ‰§è¡Œå­—èŠ‚ç æŒ‡ä»¤ï¼Œå¹¶æ ¹æ®æŒ‡ä»¤çš„è¦æ±‚è¿›è¡Œç›¸åº”çš„æ“ä½œã€‚ æ•°æ®é©±åŠ¨çš„è¡Œä¸ºï¼šå­—èŠ‚ç è®¾è®¡æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†è¡Œä¸ºè¡¨ç¤ºä¸ºæ•°æ®è€Œä¸æ˜¯ä»£ç ã€‚è¡Œä¸ºé€»è¾‘ç”±å­—èŠ‚ç æŒ‡ä»¤å’Œç›¸å…³æ•°æ®ç»„æˆï¼Œè¿™äº›æ•°æ®å¯ä»¥åœ¨è¿è¡Œæ—¶è¿›è¡Œä¿®æ”¹å’Œé…ç½®ï¼Œä»è€Œæ”¹å˜ç¨‹åºçš„è¡Œä¸ºã€‚ åŠ¨æ€æ€§å’Œçµæ´»æ€§ï¼šç”±äºè¡Œä¸ºä»¥æ•°æ®å½¢å¼å­˜åœ¨ï¼Œå¹¶ä¸”å¯ä»¥åœ¨è¿è¡Œæ—¶è¿›è¡Œè°ƒæ•´ï¼Œå­—èŠ‚ç è®¾è®¡æ¨¡å¼å…·æœ‰å¾ˆé«˜çš„åŠ¨æ€æ€§å’Œçµæ´»æ€§ã€‚è¿™ä½¿å¾—å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®éœ€è¦åŠ¨æ€åœ°é…ç½®å’Œä¿®æ”¹è¡Œä¸ºï¼Œè€Œæ— éœ€ä¿®æ”¹æºä»£ç ã€‚ å¯é‡ç”¨æ€§å’Œæ‰©å±•æ€§ï¼šå­—èŠ‚ç è®¾è®¡æ¨¡å¼æä¾›äº†ä¸€ç§å¯é‡ç”¨å’Œå¯æ‰©å±•çš„æ–¹å¼æ¥å®šä¹‰è¡Œä¸ºã€‚é€šè¿‡å®šä¹‰ä¸åŒçš„æŒ‡ä»¤å’ŒæŒ‡ä»¤é›†ï¼Œå¯ä»¥æ„å»ºå…·æœ‰ä¸åŒè¡Œä¸ºçš„æ¨¡å—ï¼Œå¹¶åœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¸­é‡å¤ä½¿ç”¨è¿™äº›æ¨¡å—ã€‚ å­—èŠ‚ç è®¾è®¡æ¨¡å¼åœ¨æ¸¸æˆå¼€å‘ã€æ¨¡æ‹Ÿå™¨ã€è„šæœ¬å¼•æ“ç­‰é¢†åŸŸä¸­å…·æœ‰å¹¿æ³›çš„åº”ç”¨ã€‚å®ƒä½¿å¾—å¼€å‘äººå‘˜èƒ½å¤Ÿä»¥æ›´çµæ´»å’ŒåŠ¨æ€çš„æ–¹å¼å®šä¹‰å’Œç®¡ç†ç¨‹åºçš„è¡Œä¸ºï¼Œä»è€Œæä¾›äº†æ›´é«˜çš„å¯é…ç½®æ€§å’Œå¯æ‰©å±•æ€§ã€‚\nä¸¾ä¾‹ ä¸€ä¸ªå¸¸è§çš„ä¾‹å­æ˜¯åœ¨æ¸¸æˆå¼€å‘ä¸­ä½¿ç”¨å­—èŠ‚ç è®¾è®¡æ¨¡å¼æ¥å®šä¹‰è§’è‰²çš„è¡Œä¸ºã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè§’è‰²ç±»ï¼ˆCharacterï¼‰ï¼Œå®ƒå…·æœ‰å„ç§è¡Œä¸ºï¼Œä¾‹å¦‚æ”»å‡»ã€é˜²å¾¡ã€ç§»åŠ¨ç­‰ã€‚è€Œè¿™äº›è¡Œä¸ºçš„å…·ä½“é€»è¾‘å¯èƒ½ä¼šæ ¹æ®æ¸¸æˆçš„éœ€æ±‚è€Œå˜åŒ–ã€‚\nä½¿ç”¨å­—èŠ‚ç è®¾è®¡æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†è§’è‰²çš„è¡Œä¸ºè¡¨ç¤ºä¸ºä¸€ç³»åˆ—å­—èŠ‚ç æŒ‡ä»¤ï¼Œå¹¶é€šè¿‡è™šæ‹Ÿæœºæ¥æ‰§è¡Œè¿™äº›æŒ‡ä»¤ï¼Œä»¥å®ç°è§’è‰²çš„è¡Œä¸ºé€»è¾‘ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªç®€åŒ–çš„ç¤ºä¾‹ï¼š\nå®šä¹‰æŒ‡ä»¤é›†ï¼š æˆ‘ä»¬å®šä¹‰ä¸€ç»„æŒ‡ä»¤æ¥è¡¨ç¤ºè§’è‰²çš„è¡Œä¸ºï¼Œä¾‹å¦‚ï¼š ATTACKï¼šè¿›è¡Œæ”»å‡»æ“ä½œ DEFENDï¼šè¿›è¡Œé˜²å¾¡æ“ä½œ MOVEï¼šè¿›è¡Œç§»åŠ¨æ“ä½œ åˆ›å»ºè™šæ‹Ÿæœºï¼š æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºï¼ˆVirtualMachineï¼‰ç±»ï¼Œå®ƒæ¥æ”¶å­—èŠ‚ç ä½œä¸ºè¾“å…¥ï¼Œå¹¶æ‰§è¡Œç›¸åº”çš„æŒ‡ä»¤ã€‚è™šæ‹Ÿæœºå¯ä»¥è§£é‡Šå­—èŠ‚ç æŒ‡ä»¤ï¼Œå¹¶æ ¹æ®æŒ‡ä»¤çš„è¦æ±‚æ‰§è¡Œç›¸åº”çš„è¡Œä¸ºé€»è¾‘ã€‚\nå®šä¹‰è§’è‰²è¡Œä¸ºï¼š æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè§’è‰²ï¼ˆCharacterï¼‰ç±»ï¼Œå®ƒåŒ…å«ä¸€ä¸ªå­—èŠ‚ç æ•°ç»„ï¼Œç”¨äºè¡¨ç¤ºè§’è‰²çš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼š\nbyte[] bytecode = {ATTACK, MOVE, ATTACK, DEFEND}; æ‰§è¡Œè§’è‰²è¡Œä¸ºï¼š æˆ‘ä»¬å°†è§’è‰²çš„å­—èŠ‚ç ä¼ é€’ç»™è™šæ‹Ÿæœºï¼Œå¹¶æ‰§è¡Œè§’è‰²çš„è¡Œä¸ºé€»è¾‘ï¼š\nVirtualMachine vm = new VirtualMachine(); vm.execute(bytecode); è™šæ‹Ÿæœºä¼šè§£é‡Šå­—èŠ‚ç æŒ‡ä»¤ï¼Œå¹¶æ ¹æ®æŒ‡ä»¤æ‰§è¡Œç›¸åº”çš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œå½“é‡åˆ° ATTACK æŒ‡ä»¤æ—¶ï¼Œè™šæ‹Ÿæœºä¼šæ‰§è¡Œæ”»å‡»æ“ä½œï¼›å½“é‡åˆ° MOVE æŒ‡ä»¤æ—¶ï¼Œè™šæ‹Ÿæœºä¼šæ‰§è¡Œç§»åŠ¨æ“ä½œï¼Œä¾æ­¤ç±»æ¨ã€‚\né™¤äº†æ¸¸æˆå¼€å‘ä¹‹å¤–ï¼Œå­—èŠ‚ç è®¾è®¡æ¨¡å¼è¿˜åœ¨å…¶ä»–é¢†åŸŸä¸­æœ‰ä¸€äº›åº”ç”¨ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„åº”ç”¨é¢†åŸŸï¼š\nè„šæœ¬å¼•æ“ï¼šå­—èŠ‚ç è®¾è®¡æ¨¡å¼å¯ç”¨äºå®ç°è„šæœ¬å¼•æ“ï¼Œå…¶ä¸­è„šæœ¬è¯­è¨€çš„è¡Œä¸ºé€»è¾‘è¢«è¡¨ç¤ºä¸ºå­—èŠ‚ç æŒ‡ä»¤ã€‚è¿™ç§è®¾è®¡ä½¿å¾—è„šæœ¬çš„æ‰§è¡Œå¯ä»¥æ›´é«˜æ•ˆå’Œçµæ´»ï¼ŒåŒæ—¶è¿˜å¯ä»¥æä¾›åŠ¨æ€æ€§å’Œæ‰©å±•æ€§ã€‚ æ¨¡æ‹Ÿå™¨ï¼šåœ¨æ¨¡æ‹Ÿå™¨å¼€å‘ä¸­ï¼Œå­—èŠ‚ç è®¾è®¡æ¨¡å¼å¯ä»¥ç”¨äºå®šä¹‰å’Œæ‰§è¡Œæ¨¡æ‹Ÿå™¨çš„æŒ‡ä»¤é›†ã€‚æ¨¡æ‹Ÿå™¨å¯ä»¥é€šè¿‡è§£é‡Šå’Œæ‰§è¡Œå­—èŠ‚ç æŒ‡ä»¤æ¥æ¨¡æ‹Ÿä¸åŒçš„æ“ä½œå’Œè¡Œä¸ºï¼Œä»è€Œå®ç°å¯¹ç‰¹å®šç³»ç»Ÿæˆ–ç¯å¢ƒçš„æ¨¡æ‹Ÿã€‚ åŠ¨æ€ç¼–ç¨‹è¯­è¨€ï¼šä¸€äº›åŠ¨æ€ç¼–ç¨‹è¯­è¨€ï¼ˆå¦‚ Pythonã€Ruby ç­‰ï¼‰ä½¿ç”¨å­—èŠ‚ç è®¾è®¡æ¨¡å¼æ¥å®ç°åŠ¨æ€æ€§å’Œçµæ´»æ€§ã€‚è¿™äº›è¯­è¨€å°†ä»£ç ç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼Œå¹¶ä½¿ç”¨è™šæ‹Ÿæœºæ¥æ‰§è¡Œå­—èŠ‚ç æŒ‡ä»¤ï¼Œä»è€Œæä¾›åŠ¨æ€ç±»å‹ã€åŠ¨æ€ç»‘å®šå’Œè¿è¡Œæ—¶ä¿®æ”¹ä»£ç ç­‰ç‰¹æ€§ã€‚ JIT ç¼–è¯‘å™¨ï¼šå³æ—¶ç¼–è¯‘å™¨ï¼ˆJust-in-Time Compilerï¼‰å¯ä»¥ä½¿ç”¨å­—èŠ‚ç è®¾è®¡æ¨¡å¼æ¥å®ç°ä»£ç çš„å³æ—¶ç¼–è¯‘å’Œä¼˜åŒ–ã€‚åœ¨è¿è¡Œæ—¶ï¼Œå³æ—¶ç¼–è¯‘å™¨å°†å­—èŠ‚ç è½¬æ¢ä¸ºæœ¬åœ°æœºå™¨ç ï¼Œå¹¶å¯¹ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œä»¥æé«˜æ‰§è¡Œæ•ˆç‡ã€‚ é¢†åŸŸç‰¹å®šè¯­è¨€ï¼ˆDSLï¼‰ï¼šå­—èŠ‚ç è®¾è®¡æ¨¡å¼å¯ä»¥ç”¨äºå¼€å‘é¢†åŸŸç‰¹å®šè¯­è¨€ï¼Œå…¶ä¸­ DSL çš„è¡Œä¸ºé€»è¾‘è¢«è¡¨ç¤ºä¸ºå­—èŠ‚ç æŒ‡ä»¤ã€‚è¿™ç§è®¾è®¡ä½¿å¾— DSL çš„æ‰§è¡Œæ›´é«˜æ•ˆï¼Œå¹¶æä¾›äº†æ›´å¤§çš„çµæ´»æ€§å’Œå¯é…ç½®æ€§ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå­—èŠ‚ç è®¾è®¡æ¨¡å¼çš„åº”ç”¨ä¸ä»…é™äºä»¥ä¸Šé¢†åŸŸï¼Œå®ƒå¯ä»¥åœ¨éœ€è¦åŠ¨æ€æ€§ã€çµæ´»æ€§å’Œå¯é…ç½®æ€§çš„ä»»ä½•é¢†åŸŸä¸­å‘æŒ¥ä½œç”¨ã€‚ç”±äºå­—èŠ‚ç è®¾è®¡æ¨¡å¼æä¾›äº†ä¸€ç§å°†è¡Œä¸ºè¡¨ç¤ºä¸ºæ•°æ®çš„æ–¹å¼ï¼Œä½¿å¾—è¡Œä¸ºå¯ä»¥åœ¨è¿è¡Œæ—¶è¿›è¡Œè°ƒæ•´å’Œä¿®æ”¹ï¼Œå› æ­¤åœ¨è®¸å¤šè½¯ä»¶å¼€å‘å’Œç³»ç»Ÿè®¾è®¡çš„åœºæ™¯ä¸­éƒ½å…·æœ‰æ½œåœ¨çš„åº”ç”¨ä»·å€¼ã€‚\né€‚ç”¨åœºæ™¯ å­—èŠ‚ç è®¾è®¡æ¨¡å¼é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š\nåŠ¨æ€è¡Œä¸ºéœ€æ±‚ï¼šå½“ç³»ç»Ÿéœ€è¦åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°å®šä¹‰ã€é…ç½®æˆ–ä¿®æ”¹è¡Œä¸ºæ—¶ï¼Œå­—èŠ‚ç è®¾è®¡æ¨¡å¼å¯ä»¥æä¾›ä¸€ç§çµæ´»çš„æ–¹å¼ã€‚å®ƒå…è®¸å°†è¡Œä¸ºè¡¨ç¤ºä¸ºå­—èŠ‚ç æŒ‡ä»¤ï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶è¿›è¡Œè°ƒæ•´å’Œä¿®æ”¹ï¼Œè€Œæ— éœ€ä¿®æ”¹æºä»£ç ã€‚ å¯é…ç½®æ€§å’Œå¯æ‰©å±•æ€§è¦æ±‚ï¼šå¦‚æœç³»ç»Ÿéœ€è¦å…·æœ‰é«˜åº¦å¯é…ç½®å’Œå¯æ‰©å±•çš„è¡Œä¸ºé€»è¾‘ï¼Œå­—èŠ‚ç è®¾è®¡æ¨¡å¼å¯ä»¥æä¾›ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡å°†è¡Œä¸ºè¡¨ç¤ºä¸ºå­—èŠ‚ç æŒ‡ä»¤å’Œç›¸å…³æ•°æ®ï¼Œå¼€å‘äººå‘˜å¯ä»¥è½»æ¾åœ°å®šä¹‰å’Œç®¡ç†ä¸åŒçš„è¡Œä¸ºæ¨¡å—ï¼Œå¹¶åœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¸­é‡å¤ä½¿ç”¨è¿™äº›æ¨¡å—ã€‚ è„šæœ¬å¼•æ“å’ŒåŠ¨æ€è¯­è¨€å®ç°ï¼šå­—èŠ‚ç è®¾è®¡æ¨¡å¼å¯ä»¥ç”¨äºå®ç°è„šæœ¬å¼•æ“æˆ–æ”¯æŒåŠ¨æ€è¯­è¨€çš„è¿è¡Œæ—¶ç¯å¢ƒã€‚å®ƒå¯ä»¥å°†è„šæœ¬è¡Œä¸ºè¡¨ç¤ºä¸ºå­—èŠ‚ç æŒ‡ä»¤ï¼Œä»è€Œæä¾›åŠ¨æ€æ€§ã€çµæ´»æ€§å’Œæ‰§è¡Œæ•ˆç‡ã€‚ æ¨¡æ‹Ÿå’Œä»¿çœŸç³»ç»Ÿï¼šåœ¨æ¨¡æ‹Ÿå’Œä»¿çœŸç³»ç»Ÿä¸­ï¼Œå­—èŠ‚ç è®¾è®¡æ¨¡å¼å¯ä»¥ç”¨äºå®šä¹‰å’Œæ‰§è¡Œæ¨¡æ‹Ÿå™¨çš„è¡Œä¸ºã€‚é€šè¿‡ä½¿ç”¨å­—èŠ‚ç æŒ‡ä»¤æ¥è¡¨ç¤ºå„ç§æ“ä½œå’Œè¡Œä¸ºï¼Œå¯ä»¥å®ç°å¯¹ç‰¹å®šç³»ç»Ÿæˆ–ç¯å¢ƒçš„å‡†ç¡®æ¨¡æ‹Ÿã€‚ ç¼–è¯‘å™¨å’Œä¼˜åŒ–å™¨å¼€å‘ï¼šå­—èŠ‚ç è®¾è®¡æ¨¡å¼å¯ç”¨äºå¼€å‘ç¼–è¯‘å™¨ã€ä¼˜åŒ–å™¨å’Œå³æ—¶ç¼–è¯‘å™¨ã€‚å®ƒæä¾›äº†ä¸€ç§å°†æºä»£ç è½¬æ¢ä¸ºå­—èŠ‚ç æŒ‡ä»¤ï¼Œå¹¶åœ¨è¿è¡Œæ—¶è¿›è¡Œä¼˜åŒ–å’Œæ‰§è¡Œçš„æ–¹å¼ï¼Œä»¥æé«˜ç¨‹åºçš„æ€§èƒ½å’Œæ•ˆç‡ã€‚ æ€»çš„æ¥è¯´ï¼Œå­—èŠ‚ç è®¾è®¡æ¨¡å¼åœ¨éœ€è¦åŠ¨æ€æ€§ã€çµæ´»æ€§ã€å¯é…ç½®æ€§å’Œå¯æ‰©å±•æ€§çš„åœºæ™¯ä¸­éƒ½æœ‰åº”ç”¨ä»·å€¼ã€‚å®ƒå¯ä»¥ç”¨äºå¼€å‘å„ç§ç±»å‹çš„ç³»ç»Ÿï¼ŒåŒ…æ‹¬æ¸¸æˆå¼•æ“ã€è„šæœ¬å¼•æ“ã€æ¨¡æ‹Ÿå™¨ã€ç¼–è¯‘å™¨ã€ä¼˜åŒ–å™¨ç­‰ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/09/22/java-design-patterns-bytecode/","summary":"æœ¬æ–‡ä¸»è¦ä»‹ç» Bytecode æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nä»‹ç» å­—èŠ‚ç è®¾è®¡æ¨¡å¼æ˜¯ä¸€ç§è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸ä»¥æ•°æ®é©±åŠ¨çš„æ–¹å¼å®šä¹‰å’Œæ‰§è¡Œè¡Œä¸ºã€‚åœ¨å­—èŠ‚ç è®¾è®¡æ¨¡å¼ä¸­ï¼Œè¡Œä¸ºè¢«è¡¨ç¤ºä¸ºä¸€ç³»åˆ—è™šæ‹ŸæœºæŒ‡ä»¤ï¼Œè¿™äº›æŒ‡ä»¤è¢«ç¼–ç ä¸ºå­—èŠ‚ç ï¼Œå¹¶åœ¨è¿è¡Œæ—¶æ‰§è¡Œã€‚\nå­—èŠ‚ç è®¾è®¡æ¨¡å¼çš„ç›®çš„æ˜¯å°†è¡Œä¸ºä¸ä»£ç åˆ†ç¦»ï¼Œä½¿å¾—è¡Œä¸ºå¯ä»¥åœ¨ä¸ä¿®æ”¹æºä»£ç çš„æƒ…å†µä¸‹è¿›è¡ŒåŠ¨æ€è°ƒæ•´å’Œæ‰©å±•ã€‚é€šè¿‡å°†è¡Œä¸ºä»¥æ•°æ®çš„å½¢å¼è¡¨ç¤ºï¼Œå¹¶ä½¿ç”¨å­—èŠ‚ç æŒ‡ä»¤è¿›è¡Œæ‰§è¡Œï¼Œå¯ä»¥å®ç°æ›´çµæ´»å’Œå¯é…ç½®çš„è¡Œä¸ºé€»è¾‘ã€‚\nä¸‹é¢æ˜¯å­—èŠ‚ç è®¾è®¡æ¨¡å¼çš„ä¸€äº›å…³é”®è¦ç‚¹ï¼š\næŒ‡ä»¤é›†ï¼šå­—èŠ‚ç è®¾è®¡æ¨¡å¼é€šè¿‡å®šä¹‰ä¸€ç»„æŒ‡ä»¤é›†æ¥è¡¨ç¤ºä¸åŒçš„è¡Œä¸ºã€‚æ¯ä¸ªæŒ‡ä»¤éƒ½æœ‰è‡ªå·±çš„è¯­ä¹‰å’Œæ“ä½œæ–¹å¼ï¼Œç”¨äºæ‰§è¡Œç‰¹å®šçš„è¡Œä¸ºé€»è¾‘ã€‚ è™šæ‹Ÿæœºï¼šå­—èŠ‚ç è®¾è®¡æ¨¡å¼éœ€è¦ä¸€ä¸ªè™šæ‹Ÿæœºæ¥æ‰§è¡ŒæŒ‡ä»¤é›†ã€‚è™šæ‹Ÿæœºè´Ÿè´£è§£é‡Šå’Œæ‰§è¡Œå­—èŠ‚ç æŒ‡ä»¤ï¼Œå¹¶æ ¹æ®æŒ‡ä»¤çš„è¦æ±‚è¿›è¡Œç›¸åº”çš„æ“ä½œã€‚ æ•°æ®é©±åŠ¨çš„è¡Œä¸ºï¼šå­—èŠ‚ç è®¾è®¡æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†è¡Œä¸ºè¡¨ç¤ºä¸ºæ•°æ®è€Œä¸æ˜¯ä»£ç ã€‚è¡Œä¸ºé€»è¾‘ç”±å­—èŠ‚ç æŒ‡ä»¤å’Œç›¸å…³æ•°æ®ç»„æˆï¼Œè¿™äº›æ•°æ®å¯ä»¥åœ¨è¿è¡Œæ—¶è¿›è¡Œä¿®æ”¹å’Œé…ç½®ï¼Œä»è€Œæ”¹å˜ç¨‹åºçš„è¡Œä¸ºã€‚ åŠ¨æ€æ€§å’Œçµæ´»æ€§ï¼šç”±äºè¡Œä¸ºä»¥æ•°æ®å½¢å¼å­˜åœ¨ï¼Œå¹¶ä¸”å¯ä»¥åœ¨è¿è¡Œæ—¶è¿›è¡Œè°ƒæ•´ï¼Œå­—èŠ‚ç è®¾è®¡æ¨¡å¼å…·æœ‰å¾ˆé«˜çš„åŠ¨æ€æ€§å’Œçµæ´»æ€§ã€‚è¿™ä½¿å¾—å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®éœ€è¦åŠ¨æ€åœ°é…ç½®å’Œä¿®æ”¹è¡Œä¸ºï¼Œè€Œæ— éœ€ä¿®æ”¹æºä»£ç ã€‚ å¯é‡ç”¨æ€§å’Œæ‰©å±•æ€§ï¼šå­—èŠ‚ç è®¾è®¡æ¨¡å¼æä¾›äº†ä¸€ç§å¯é‡ç”¨å’Œå¯æ‰©å±•çš„æ–¹å¼æ¥å®šä¹‰è¡Œä¸ºã€‚é€šè¿‡å®šä¹‰ä¸åŒçš„æŒ‡ä»¤å’ŒæŒ‡ä»¤é›†ï¼Œå¯ä»¥æ„å»ºå…·æœ‰ä¸åŒè¡Œä¸ºçš„æ¨¡å—ï¼Œå¹¶åœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¸­é‡å¤ä½¿ç”¨è¿™äº›æ¨¡å—ã€‚ å­—èŠ‚ç è®¾è®¡æ¨¡å¼åœ¨æ¸¸æˆå¼€å‘ã€æ¨¡æ‹Ÿå™¨ã€è„šæœ¬å¼•æ“ç­‰é¢†åŸŸä¸­å…·æœ‰å¹¿æ³›çš„åº”ç”¨ã€‚å®ƒä½¿å¾—å¼€å‘äººå‘˜èƒ½å¤Ÿä»¥æ›´çµæ´»å’ŒåŠ¨æ€çš„æ–¹å¼å®šä¹‰å’Œç®¡ç†ç¨‹åºçš„è¡Œä¸ºï¼Œä»è€Œæä¾›äº†æ›´é«˜çš„å¯é…ç½®æ€§å’Œå¯æ‰©å±•æ€§ã€‚\nä¸¾ä¾‹ ä¸€ä¸ªå¸¸è§çš„ä¾‹å­æ˜¯åœ¨æ¸¸æˆå¼€å‘ä¸­ä½¿ç”¨å­—èŠ‚ç è®¾è®¡æ¨¡å¼æ¥å®šä¹‰è§’è‰²çš„è¡Œä¸ºã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè§’è‰²ç±»ï¼ˆCharacterï¼‰ï¼Œå®ƒå…·æœ‰å„ç§è¡Œä¸ºï¼Œä¾‹å¦‚æ”»å‡»ã€é˜²å¾¡ã€ç§»åŠ¨ç­‰ã€‚è€Œè¿™äº›è¡Œä¸ºçš„å…·ä½“é€»è¾‘å¯èƒ½ä¼šæ ¹æ®æ¸¸æˆçš„éœ€æ±‚è€Œå˜åŒ–ã€‚\nä½¿ç”¨å­—èŠ‚ç è®¾è®¡æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†è§’è‰²çš„è¡Œä¸ºè¡¨ç¤ºä¸ºä¸€ç³»åˆ—å­—èŠ‚ç æŒ‡ä»¤ï¼Œå¹¶é€šè¿‡è™šæ‹Ÿæœºæ¥æ‰§è¡Œè¿™äº›æŒ‡ä»¤ï¼Œä»¥å®ç°è§’è‰²çš„è¡Œä¸ºé€»è¾‘ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªç®€åŒ–çš„ç¤ºä¾‹ï¼š\nå®šä¹‰æŒ‡ä»¤é›†ï¼š æˆ‘ä»¬å®šä¹‰ä¸€ç»„æŒ‡ä»¤æ¥è¡¨ç¤ºè§’è‰²çš„è¡Œä¸ºï¼Œä¾‹å¦‚ï¼š ATTACKï¼šè¿›è¡Œæ”»å‡»æ“ä½œ DEFENDï¼šè¿›è¡Œé˜²å¾¡æ“ä½œ MOVEï¼šè¿›è¡Œç§»åŠ¨æ“ä½œ åˆ›å»ºè™šæ‹Ÿæœºï¼š æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºï¼ˆVirtualMachineï¼‰ç±»ï¼Œå®ƒæ¥æ”¶å­—èŠ‚ç ä½œä¸ºè¾“å…¥ï¼Œå¹¶æ‰§è¡Œç›¸åº”çš„æŒ‡ä»¤ã€‚è™šæ‹Ÿæœºå¯ä»¥è§£é‡Šå­—èŠ‚ç æŒ‡ä»¤ï¼Œå¹¶æ ¹æ®æŒ‡ä»¤çš„è¦æ±‚æ‰§è¡Œç›¸åº”çš„è¡Œä¸ºé€»è¾‘ã€‚\nå®šä¹‰è§’è‰²è¡Œä¸ºï¼š æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè§’è‰²ï¼ˆCharacterï¼‰ç±»ï¼Œå®ƒåŒ…å«ä¸€ä¸ªå­—èŠ‚ç æ•°ç»„ï¼Œç”¨äºè¡¨ç¤ºè§’è‰²çš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼š\nbyte[] bytecode = {ATTACK, MOVE, ATTACK, DEFEND}; æ‰§è¡Œè§’è‰²è¡Œä¸ºï¼š æˆ‘ä»¬å°†è§’è‰²çš„å­—èŠ‚ç ä¼ é€’ç»™è™šæ‹Ÿæœºï¼Œå¹¶æ‰§è¡Œè§’è‰²çš„è¡Œä¸ºé€»è¾‘ï¼š\nVirtualMachine vm = new VirtualMachine(); vm.execute(bytecode); è™šæ‹Ÿæœºä¼šè§£é‡Šå­—èŠ‚ç æŒ‡ä»¤ï¼Œå¹¶æ ¹æ®æŒ‡ä»¤æ‰§è¡Œç›¸åº”çš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œå½“é‡åˆ° ATTACK æŒ‡ä»¤æ—¶ï¼Œè™šæ‹Ÿæœºä¼šæ‰§è¡Œæ”»å‡»æ“ä½œï¼›å½“é‡åˆ° MOVE æŒ‡ä»¤æ—¶ï¼Œè™šæ‹Ÿæœºä¼šæ‰§è¡Œç§»åŠ¨æ“ä½œï¼Œä¾æ­¤ç±»æ¨ã€‚\né™¤äº†æ¸¸æˆå¼€å‘ä¹‹å¤–ï¼Œå­—èŠ‚ç è®¾è®¡æ¨¡å¼è¿˜åœ¨å…¶ä»–é¢†åŸŸä¸­æœ‰ä¸€äº›åº”ç”¨ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„åº”ç”¨é¢†åŸŸï¼š\nè„šæœ¬å¼•æ“ï¼šå­—èŠ‚ç è®¾è®¡æ¨¡å¼å¯ç”¨äºå®ç°è„šæœ¬å¼•æ“ï¼Œå…¶ä¸­è„šæœ¬è¯­è¨€çš„è¡Œä¸ºé€»è¾‘è¢«è¡¨ç¤ºä¸ºå­—èŠ‚ç æŒ‡ä»¤ã€‚è¿™ç§è®¾è®¡ä½¿å¾—è„šæœ¬çš„æ‰§è¡Œå¯ä»¥æ›´é«˜æ•ˆå’Œçµæ´»ï¼ŒåŒæ—¶è¿˜å¯ä»¥æä¾›åŠ¨æ€æ€§å’Œæ‰©å±•æ€§ã€‚ æ¨¡æ‹Ÿå™¨ï¼šåœ¨æ¨¡æ‹Ÿå™¨å¼€å‘ä¸­ï¼Œå­—èŠ‚ç è®¾è®¡æ¨¡å¼å¯ä»¥ç”¨äºå®šä¹‰å’Œæ‰§è¡Œæ¨¡æ‹Ÿå™¨çš„æŒ‡ä»¤é›†ã€‚æ¨¡æ‹Ÿå™¨å¯ä»¥é€šè¿‡è§£é‡Šå’Œæ‰§è¡Œå­—èŠ‚ç æŒ‡ä»¤æ¥æ¨¡æ‹Ÿä¸åŒçš„æ“ä½œå’Œè¡Œä¸ºï¼Œä»è€Œå®ç°å¯¹ç‰¹å®šç³»ç»Ÿæˆ–ç¯å¢ƒçš„æ¨¡æ‹Ÿã€‚ åŠ¨æ€ç¼–ç¨‹è¯­è¨€ï¼šä¸€äº›åŠ¨æ€ç¼–ç¨‹è¯­è¨€ï¼ˆå¦‚ Pythonã€Ruby ç­‰ï¼‰ä½¿ç”¨å­—èŠ‚ç è®¾è®¡æ¨¡å¼æ¥å®ç°åŠ¨æ€æ€§å’Œçµæ´»æ€§ã€‚è¿™äº›è¯­è¨€å°†ä»£ç ç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼Œå¹¶ä½¿ç”¨è™šæ‹Ÿæœºæ¥æ‰§è¡Œå­—èŠ‚ç æŒ‡ä»¤ï¼Œä»è€Œæä¾›åŠ¨æ€ç±»å‹ã€åŠ¨æ€ç»‘å®šå’Œè¿è¡Œæ—¶ä¿®æ”¹ä»£ç ç­‰ç‰¹æ€§ã€‚ JIT ç¼–è¯‘å™¨ï¼šå³æ—¶ç¼–è¯‘å™¨ï¼ˆJust-in-Time Compilerï¼‰å¯ä»¥ä½¿ç”¨å­—èŠ‚ç è®¾è®¡æ¨¡å¼æ¥å®ç°ä»£ç çš„å³æ—¶ç¼–è¯‘å’Œä¼˜åŒ–ã€‚åœ¨è¿è¡Œæ—¶ï¼Œå³æ—¶ç¼–è¯‘å™¨å°†å­—èŠ‚ç è½¬æ¢ä¸ºæœ¬åœ°æœºå™¨ç ï¼Œå¹¶å¯¹ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œä»¥æé«˜æ‰§è¡Œæ•ˆç‡ã€‚ é¢†åŸŸç‰¹å®šè¯­è¨€ï¼ˆDSLï¼‰ï¼šå­—èŠ‚ç è®¾è®¡æ¨¡å¼å¯ä»¥ç”¨äºå¼€å‘é¢†åŸŸç‰¹å®šè¯­è¨€ï¼Œå…¶ä¸­ DSL çš„è¡Œä¸ºé€»è¾‘è¢«è¡¨ç¤ºä¸ºå­—èŠ‚ç æŒ‡ä»¤ã€‚è¿™ç§è®¾è®¡ä½¿å¾— DSL çš„æ‰§è¡Œæ›´é«˜æ•ˆï¼Œå¹¶æä¾›äº†æ›´å¤§çš„çµæ´»æ€§å’Œå¯é…ç½®æ€§ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå­—èŠ‚ç è®¾è®¡æ¨¡å¼çš„åº”ç”¨ä¸ä»…é™äºä»¥ä¸Šé¢†åŸŸï¼Œå®ƒå¯ä»¥åœ¨éœ€è¦åŠ¨æ€æ€§ã€çµæ´»æ€§å’Œå¯é…ç½®æ€§çš„ä»»ä½•é¢†åŸŸä¸­å‘æŒ¥ä½œç”¨ã€‚ç”±äºå­—èŠ‚ç è®¾è®¡æ¨¡å¼æä¾›äº†ä¸€ç§å°†è¡Œä¸ºè¡¨ç¤ºä¸ºæ•°æ®çš„æ–¹å¼ï¼Œä½¿å¾—è¡Œä¸ºå¯ä»¥åœ¨è¿è¡Œæ—¶è¿›è¡Œè°ƒæ•´å’Œä¿®æ”¹ï¼Œå› æ­¤åœ¨è®¸å¤šè½¯ä»¶å¼€å‘å’Œç³»ç»Ÿè®¾è®¡çš„åœºæ™¯ä¸­éƒ½å…·æœ‰æ½œåœ¨çš„åº”ç”¨ä»·å€¼ã€‚\né€‚ç”¨åœºæ™¯ å­—èŠ‚ç è®¾è®¡æ¨¡å¼é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š\nåŠ¨æ€è¡Œä¸ºéœ€æ±‚ï¼šå½“ç³»ç»Ÿéœ€è¦åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°å®šä¹‰ã€é…ç½®æˆ–ä¿®æ”¹è¡Œä¸ºæ—¶ï¼Œå­—èŠ‚ç è®¾è®¡æ¨¡å¼å¯ä»¥æä¾›ä¸€ç§çµæ´»çš„æ–¹å¼ã€‚å®ƒå…è®¸å°†è¡Œä¸ºè¡¨ç¤ºä¸ºå­—èŠ‚ç æŒ‡ä»¤ï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶è¿›è¡Œè°ƒæ•´å’Œä¿®æ”¹ï¼Œè€Œæ— éœ€ä¿®æ”¹æºä»£ç ã€‚ å¯é…ç½®æ€§å’Œå¯æ‰©å±•æ€§è¦æ±‚ï¼šå¦‚æœç³»ç»Ÿéœ€è¦å…·æœ‰é«˜åº¦å¯é…ç½®å’Œå¯æ‰©å±•çš„è¡Œä¸ºé€»è¾‘ï¼Œå­—èŠ‚ç è®¾è®¡æ¨¡å¼å¯ä»¥æä¾›ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡å°†è¡Œä¸ºè¡¨ç¤ºä¸ºå­—èŠ‚ç æŒ‡ä»¤å’Œç›¸å…³æ•°æ®ï¼Œå¼€å‘äººå‘˜å¯ä»¥è½»æ¾åœ°å®šä¹‰å’Œç®¡ç†ä¸åŒçš„è¡Œä¸ºæ¨¡å—ï¼Œå¹¶åœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¸­é‡å¤ä½¿ç”¨è¿™äº›æ¨¡å—ã€‚ è„šæœ¬å¼•æ“å’ŒåŠ¨æ€è¯­è¨€å®ç°ï¼šå­—èŠ‚ç è®¾è®¡æ¨¡å¼å¯ä»¥ç”¨äºå®ç°è„šæœ¬å¼•æ“æˆ–æ”¯æŒåŠ¨æ€è¯­è¨€çš„è¿è¡Œæ—¶ç¯å¢ƒã€‚å®ƒå¯ä»¥å°†è„šæœ¬è¡Œä¸ºè¡¨ç¤ºä¸ºå­—èŠ‚ç æŒ‡ä»¤ï¼Œä»è€Œæä¾›åŠ¨æ€æ€§ã€çµæ´»æ€§å’Œæ‰§è¡Œæ•ˆç‡ã€‚ æ¨¡æ‹Ÿå’Œä»¿çœŸç³»ç»Ÿï¼šåœ¨æ¨¡æ‹Ÿå’Œä»¿çœŸç³»ç»Ÿä¸­ï¼Œå­—èŠ‚ç è®¾è®¡æ¨¡å¼å¯ä»¥ç”¨äºå®šä¹‰å’Œæ‰§è¡Œæ¨¡æ‹Ÿå™¨çš„è¡Œä¸ºã€‚é€šè¿‡ä½¿ç”¨å­—èŠ‚ç æŒ‡ä»¤æ¥è¡¨ç¤ºå„ç§æ“ä½œå’Œè¡Œä¸ºï¼Œå¯ä»¥å®ç°å¯¹ç‰¹å®šç³»ç»Ÿæˆ–ç¯å¢ƒçš„å‡†ç¡®æ¨¡æ‹Ÿã€‚ ç¼–è¯‘å™¨å’Œä¼˜åŒ–å™¨å¼€å‘ï¼šå­—èŠ‚ç è®¾è®¡æ¨¡å¼å¯ç”¨äºå¼€å‘ç¼–è¯‘å™¨ã€ä¼˜åŒ–å™¨å’Œå³æ—¶ç¼–è¯‘å™¨ã€‚å®ƒæä¾›äº†ä¸€ç§å°†æºä»£ç è½¬æ¢ä¸ºå­—èŠ‚ç æŒ‡ä»¤ï¼Œå¹¶åœ¨è¿è¡Œæ—¶è¿›è¡Œä¼˜åŒ–å’Œæ‰§è¡Œçš„æ–¹å¼ï¼Œä»¥æé«˜ç¨‹åºçš„æ€§èƒ½å’Œæ•ˆç‡ã€‚ æ€»çš„æ¥è¯´ï¼Œå­—èŠ‚ç è®¾è®¡æ¨¡å¼åœ¨éœ€è¦åŠ¨æ€æ€§ã€çµæ´»æ€§ã€å¯é…ç½®æ€§å’Œå¯æ‰©å±•æ€§çš„åœºæ™¯ä¸­éƒ½æœ‰åº”ç”¨ä»·å€¼ã€‚å®ƒå¯ä»¥ç”¨äºå¼€å‘å„ç§ç±»å‹çš„ç³»ç»Ÿï¼ŒåŒ…æ‹¬æ¸¸æˆå¼•æ“ã€è„šæœ¬å¼•æ“ã€æ¨¡æ‹Ÿå™¨ã€ç¼–è¯‘å™¨ã€ä¼˜åŒ–å™¨ç­‰ã€‚","title":"Javaè®¾è®¡æ¨¡å¼ï¼šBytecode"},{"content":"å¦‚æœæ‚¨å¿«é€Ÿæœç´¢å¦‚ä½•ä½¿ç”¨ JSON Web Tokens åœ¨ Spring Boot ä¸­ä¿æŠ¤ REST APIï¼Œæ‚¨ä¼šå‘ç°å¾ˆå¤šç›¸åŒçš„ç»“æœã€‚è¿™äº›ç»“æœåŒ…å«ä¸€ç§æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¶‰åŠç¼–å†™è‡ªå®šä¹‰è¿‡æ»¤å™¨é“¾å¹¶å¼•å…¥ç¬¬ä¸‰æ–¹åº“æ¥ç¼–ç å’Œè§£ç  JWTã€‚\nåœ¨çœ‹å®Œè¿™äº›ä»¤äººè´¹è§£ä¸”ä»¤äººå›°æƒ‘çš„æ•™ç¨‹åï¼Œæˆ‘è¯´å¿…é¡»æœ‰ä¸€ç§æ›´ç®€å•çš„æ–¹æ³•æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚æˆ‘åšäº†ä»»ä½•ç›´æ¥æ¥è§¦ Spring Security å›¢é˜Ÿçš„äººéƒ½ä¼šåšçš„äº‹æƒ…ï¼Œæˆ‘å‘ä»–ä»¬å¯»æ±‚å¸®åŠ©ã€‚ä»–ä»¬å‘Šè¯‰æˆ‘ï¼ŒSpring Security ç¡®å®ä½¿ç”¨ oAuth2 èµ„æºæœåŠ¡å™¨å†…ç½®äº†å¯¹ JWT çš„æ”¯æŒã€‚\nåœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ JSON Web Tokens (JWT) å’Œ Spring Security æ¥ä¿æŠ¤æ‚¨çš„ APIã€‚æˆ‘å¹¶ä¸æ˜¯è¯´è¿™ç§æ–¹æ³•æ— è®ºå¦‚ä½•éƒ½å¾ˆå®¹æ˜“ï¼Œä½†å¯¹æˆ‘æ¥è¯´ï¼Œå®ƒæ¯”å…¶ä»–é€‰æ‹©æ›´æœ‰æ„ä¹‰ã€‚\nGithub å­˜å‚¨åº“\nåº”ç”¨æ¶æ„ åœ¨æˆ‘ä»¬å¼€å§‹ç¼–å†™ä¸€äº›ä»£ç ä¹‹å‰ï¼Œæˆ‘æƒ³ç¡®ä¿æˆ‘ä»¬å¯¹äºæˆ‘ä»¬æ­£åœ¨æ„å»ºçš„å†…å®¹éƒ½è¾¾æˆå…±è¯†ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæ‚¨æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼Œå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªç®€å•çš„å‘½ä»¤è¡Œåº”ç”¨ç¨‹åºã€ä¸€ä¸ªç”¨ Angular æˆ– Vue ç­‰ç¼–å†™çš„å®Œæ•´å‰ç«¯åº”ç”¨ç¨‹åºï¼Œæˆ–è€…ç³»ç»Ÿä¸­çš„å…¶ä»–ä¸€äº›æœåŠ¡ã€‚\nè¯¥å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå°†è°ƒç”¨ä½¿ç”¨ Spring Boot ç¼–å†™çš„æœåŠ¡å™¨åº”ç”¨ç¨‹åºï¼Œè¯¥åº”ç”¨ç¨‹åºé€šè¿‡ REST API å…¬å¼€æ•°æ®ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ•´ä½“ï¼Œä½†å¦‚æœæ‚¨æœ‰åˆ†å¸ƒå¼æ¶æ„ï¼Œåˆ™åŒæ ·é€‚ç”¨ã€‚å½“å‰æœ‰ 3 ä¸ª REST æ§åˆ¶å™¨å…¬å¼€èµ„æºäº§å“ã€è®¢å•å’Œå®¢æˆ·ã€‚\næ‚¨è¦åšçš„æ˜¯ä¿æŠ¤æ‰€æœ‰èµ„æºï¼Œä»¥ä¾¿å½“å®¢æˆ·ç«¯è°ƒç”¨ REST API æ—¶ï¼Œå®¢æˆ·ç«¯å°†æ”¶åˆ° 401ï¼ˆæœªç»æˆæƒï¼‰ï¼Œè¿™æ„å‘³ç€å®¢æˆ·ç«¯è¯·æ±‚å°šæœªå®Œæˆï¼Œå› ä¸ºå®ƒç¼ºå°‘æ‰€è¯·æ±‚èµ„æºçš„æœ‰æ•ˆèº«ä»½éªŒè¯å‡­æ®ã€‚\nJSON ç½‘ç»œä»¤ç‰Œ (JWT) JSON Web ä»¤ç‰Œæ˜¯ä¸€ç§å¼€æ”¾æ–¹æ³•ï¼Œç”¨äºåœ¨ä¸¤æ–¹ä¹‹é—´å®‰å…¨åœ°è¡¨ç¤ºå£°æ˜ã€‚ JWT æ˜¯ä¸€ç»„å£°æ˜ï¼ˆJSON å±æ€§-å€¼å¯¹ï¼‰ï¼Œå®ƒä»¬å…±åŒæ„æˆä¸€ä¸ª JSON å¯¹è±¡ã€‚å®ƒç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š\nHeader: ç”±ä¸¤ä¸ªå±æ€§ç»„æˆï¼š{ \u0026ldquo;alg\u0026rdquo;: \u0026ldquo;HS256\u0026rdquo;, \u0026ldquo;typ\u0026rdquo;: \u0026ldquo;JWT\u0026rdquo; }ã€‚ alg æ˜¯ç”¨äºåŠ å¯† JWT çš„ç®—æ³•ã€‚ Payload: è¿™æ˜¯å­˜å‚¨è¦å‘é€çš„æ•°æ®çš„åœ°æ–¹ï¼›è¯¥æ•°æ®å­˜å‚¨ä¸º JSON å±æ€§-å€¼å¯¹ã€‚ Signature: è¿™æ˜¯é€šè¿‡åŠ å¯†åˆ›å»ºçš„ï¼Œä½¿ç”¨æ ‡å¤´ä¸­æŒ‡å®šçš„ç®—æ³•ï¼šï¼ˆiï¼‰base64Url ç¼–ç çš„æ ‡å¤´ï¼Œï¼ˆiiï¼‰base64Url ç¼–ç çš„æœ‰æ•ˆè´Ÿè½½ï¼Œä»¥åŠï¼ˆiiiï¼‰ç§˜å¯†ï¼ˆæˆ–ç§é’¥ï¼‰ï¼š HMACSHA256(base64UrlEncode(header) + \u0026#34;.\u0026#34; + base64UrlEncode(payload), secret|privateKey) æœ€ç»ˆçš„ JWT ç”±ä¸‰éƒ¨åˆ†ç»„æˆã€‚æ¯ä¸ªéƒ½æ˜¯ base64Url ç¼–ç çš„ï¼Œå¹¶ä¸”ä¸ä¸‹ä¸€ä¸ªä¹‹é—´ç”¨ç‚¹åˆ†éš”ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… openid.net å’Œ jwt.io ç½‘ç«™ã€‚\næ‚¨å°†å¼•å…¥ä¸€ä¸ªæ–°çš„èº«ä»½éªŒè¯æ§åˆ¶å™¨ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨å…¶èº«ä»½éªŒè¯å‡­æ®ï¼ˆç”¨æˆ·å + å¯†ç ï¼‰å‘è¯¥æ§åˆ¶å™¨å‘å‡ºè¯·æ±‚ï¼Œå¹¶ä¸”å½“æˆåŠŸé€šè¿‡èº«ä»½éªŒè¯æ—¶ï¼ŒæœåŠ¡å°†è¿”å› JWTã€‚\nç„¶åï¼Œå®¢æˆ·ç«¯å°†å­˜å‚¨ JWTï¼Œå¹¶ä¸”æ¯ä¸ªåç»­è¯·æ±‚å°†é€šè¿‡ Authorization æ ‡å¤´ä¼ é€’å®ƒã€‚å½“æœåŠ¡å™¨åº”ç”¨ç¨‹åºæ”¶åˆ°å¸¦æœ‰ JWT çš„è¯·æ±‚æ—¶ï¼Œå®ƒå°†éªŒè¯å®ƒæ˜¯å¦æ˜¯æœ‰æ•ˆä»¤ç‰Œï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å…è®¸è¯·æ±‚ç»§ç»­ã€‚\nå…¥é—¨ é¦–å…ˆï¼Œæ‚¨å°†å‰å¾€ start.spring.io å¹¶åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ã€‚å¡«å†™é¡¹ç›®çš„å…ƒæ•°æ®å¹¶æ·»åŠ ä»¥ä¸‹ä¾èµ–é¡¹ï¼š\nSpring Web oAuth2 Resource Server oAuth2 Spring Configuration Processor è¿™å°†åœ¨æ‚¨çš„ pom.xml ä¸­ç”Ÿæˆä»¥ä¸‹ä¾èµ–é¡¹\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-oauth2-resource-server\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-configuration-processor\u0026lt;/artifactId\u0026gt; \u0026lt;optional\u0026gt;true\u0026lt;/optional\u0026gt; \u0026lt;/dependency\u0026gt; æˆ‘çŸ¥é“ä½ åœ¨æƒ³ä»€ä¹ˆï¼ŒSpring Security æ€ä¹ˆæ ·ï¼Ÿå¦‚æœæ‚¨æ·±å…¥ç ”ç©¶ spring-boot-starter-oauth2-resource-server ï¼Œæ‚¨ä¼šå‘ç°å®ƒåŒ…å« Spring Security Starterï¼Œå…¶ä¸­åŒ…å«æ‚¨éœ€è¦çš„ä¸€åˆ‡ã€‚\nREST API æ‚¨éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯åˆ›å»ºä¸€ä¸ªæ‚¨æƒ³è¦ä¿æŠ¤çš„ REST APIã€‚å‡ºäºæ¼”ç¤ºç›®çš„å¹¶ä¿æŒç®€å•ï¼Œä½¿ç”¨è¿”å›å­—ç¬¦ä¸²çš„å•ä¸ªæ–¹æ³•åœ¨ controller åŒ…ä¸­åˆ›å»º HomeController ã€‚è¯·æ±‚æ˜ å°„å¤„ç†ç¨‹åºæ–¹æ³•å¯ä»¥æ¥å—ä¸€ç³»åˆ—å‚æ•°ï¼Œå…¶ä¸­ä¹‹ä¸€æ˜¯ java.security.Principal ã€‚è¿™å°†å…è®¸æ‚¨æ‰“å°å‡ºå½“å‰ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·çš„ç”¨æˆ·åã€‚\nSpring Security é‡‡ç”¨é»˜è®¤å®‰å…¨çš„å®‰å…¨æ–¹æ³•ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœæ‚¨å¯åŠ¨åº”ç”¨ç¨‹åºå¹¶å°è¯•è®¿é—® http://localhost:8080ï¼Œæ‚¨å°†è¢«é‡å®šå‘åˆ°ç™»å½•é¡µé¢ã€‚å¦‚æœæ‚¨æƒ³ç™»å½•ï¼Œå¯ä»¥è¾“å…¥ç”¨æˆ·å user ï¼Œå¯†ç å°†ç”Ÿæˆå¹¶åº”åœ¨æ§åˆ¶å°è¾“å‡ºä¸­åˆ—å‡ºã€‚\n@RestController public class HomeController { @GetMapping public String home(Principal principal) { return \u0026#34;Hello, \u0026#34; + principal.getName(); } } SPRING å®‰å…¨é…ç½® é»˜è®¤çš„å®‰å…¨é…ç½®è¶³ä»¥è®©æ‚¨å¯åŠ¨å¹¶è¿è¡Œï¼Œä½†æ‚¨éœ€è¦æä¾›è‡ªå·±çš„å®‰å…¨é…ç½®æ¥æ»¡è¶³åº”ç”¨ç¨‹åºçš„éœ€æ±‚ã€‚è¿‡å»ï¼Œæ‚¨å¯ä»¥æ‰©å±• WebSecurityConfigurerAdapter ï¼Œä½†è¿™åœ¨ Spring Security 5.7.x ä¸­å·²è¢«å¼ƒç”¨ã€‚å¦‚æœæ‚¨æœ‰å…´è¶£äº†è§£æœ‰å…³æ­¤æ›´æ”¹çš„æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥æŸ¥çœ‹æœ¬æ•™ç¨‹ã€‚\né¦–å…ˆï¼Œåœ¨ config åŒ…ä¸­åˆ›å»ºä¸€ä¸ªåä¸º SecurityConfig çš„æ–°ç±»ã€‚è¯¥ç±»å°†å…·æœ‰ä»¥ä¸‹é…ç½®ï¼š\n@Configuration @EnableWebSecurity public class SecurityConfig { @Bean public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception { return http .csrf(csrf -\u0026gt; csrf.disable()) // (1) .authorizeRequests( auth -\u0026gt; auth .anyRequest().authenticated() // (2) ) .sessionManagement(session -\u0026gt; session.sessionCreationPolicy(SessionCreationPolicy.STATELESS)) // (3) .httpBasic(Customizer.withDefaults()) // (4) .build(); } } ç¦ç”¨è·¨ç«™ç‚¹è¯·æ±‚ä¼ªé€  (CSRF) åº”é’ˆå¯¹åº”ç”¨ç¨‹åºä¸­çš„ä»»ä½•è¯·æ±‚å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ã€‚ Spring Security æ°¸è¿œä¸ä¼šåˆ›å»º HttpSessionï¼Œä¹Ÿæ°¸è¿œä¸ä¼šä½¿ç”¨å®ƒæ¥è·å–å®‰å…¨ä¸Šä¸‹æ–‡ã€‚ Spring Security çš„ HTTP åŸºæœ¬èº«ä»½éªŒè¯æ”¯æŒé»˜è®¤å¯ç”¨ã€‚ä½†æ˜¯ï¼Œä¸€æ—¦æä¾›ä»»ä½•åŸºäº servlet çš„é…ç½®ï¼Œå°±å¿…é¡»æ˜¾å¼æä¾› HTTP Basicã€‚ âš ï¸ è­¦å‘Šï¼šåœ¨å¯ç”¨ä¼šè¯ç®¡ç†çš„åŒæ—¶ï¼Œåˆ‡å‹¿ç¦ç”¨ CSRF ä¿æŠ¤ï¼è¿™æ ·åšä¼šä½¿æ‚¨é¢ä¸´è·¨ç«™ç‚¹è¯·æ±‚ä¼ªé€ æ”»å‡»ã€‚\nç°åœ¨æ‚¨å·²ç»æœ‰äº†è‡ªå®šä¹‰å®‰å…¨é…ç½®ï¼Œæ‚¨éœ€è¦ä¸€ä¸ªä¸æ˜¯ Spring Boot æä¾›çš„é»˜è®¤ç”¨æˆ·çš„ç”¨æˆ·ã€‚ä»¥ä¸‹é…ç½®å°†ä½¿ç”¨ NoOpPasswordEncoder åˆ›å»ºå†…å­˜ä¸­ç”¨æˆ·ã€‚è¿™æ˜¯ä¸€ä¸ªå¯†ç ç¼–ç å™¨ï¼Œä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼Œå¯¹äºæµ‹è¯•å¾ˆæœ‰ç”¨ï¼Œä½†ä¸åº”åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨ã€‚\n@Bean public InMemoryUserDetailsManager users() { return new InMemoryUserDetailsManager( User.withUsername(\u0026#34;dvega\u0026#34;) .password(\u0026#34;{noop}password\u0026#34;) .authorities(\u0026#34;read\u0026#34;) .build() ); } é…ç½®æ–°ç”¨æˆ·åï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿé‡æ–°å¯åŠ¨åº”ç”¨ç¨‹åºå¹¶è®¿é—® http://localhost:8080ã€‚æ‚¨å°†çœ‹åˆ°ä¸€ä¸ªå¯¹è¯æ¡†ï¼Œè¦æ±‚è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œå¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿä½¿ç”¨ dvega + password ç™»å½•ã€‚\nOAUTH 2.0 èµ„æºæœåŠ¡å™¨ å¦‚æœæ‚¨çœ‹è¿‡æˆ‘ä¹‹å‰çš„æ•™ç¨‹ï¼Œé‚£ä¹ˆæ‚¨åˆ°ç›®å‰ä¸ºæ­¢æ‰€åšçš„ä¸€åˆ‡åº”è¯¥å¾ˆç†Ÿæ‚‰ï¼Œä½†æˆ‘çŸ¥é“è¿™ä¸æ˜¯æ‚¨æ¥è¿™é‡Œçš„ç›®çš„ã€‚ Spring Security æ”¯æŒä½¿ç”¨ä¸¤ç§å½¢å¼çš„ OAuth 2.0 ä¸è®°åä»¤ç‰Œä¿æŠ¤ç«¯ç‚¹ï¼š\nJWT Opaque Tokens åœ¨åº”ç”¨ç¨‹åºå°†å…¶æƒé™ç®¡ç†å§”æ‰˜ç»™æˆæƒæœåŠ¡å™¨ï¼ˆä¾‹å¦‚ï¼ŒOkta æˆ– Spring æˆæƒæœåŠ¡å™¨ï¼‰çš„æƒ…å†µä¸‹ï¼Œè¿™éå¸¸æ–¹ä¾¿ã€‚èµ„æºæœåŠ¡å™¨å¯ä»¥å’¨è¯¢è¯¥æˆæƒæœåŠ¡å™¨æ¥æˆæƒè¯·æ±‚ â€‹â€‹ã€‚\nåœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†ä½¿ç”¨è‡ªç­¾å JWTï¼Œè¿™å°†æ— éœ€å¼•å…¥æˆæƒæœåŠ¡å™¨ã€‚è™½ç„¶è¿™é€‚ç”¨äºæœ¬ç¤ºä¾‹ï¼Œä½†æ‚¨çš„åº”ç”¨ç¨‹åºè¦æ±‚å¯èƒ½æœ‰æ‰€ä¸åŒï¼Œå› æ­¤ä»€ä¹ˆæ—¶å€™ä¸å†æ¥å—ä½¿ç”¨è‡ªç­¾å JWTï¼Ÿæˆ‘ä¹Ÿå‘ Spring Security å›¢é˜Ÿæå‡ºäº†è¿™ä¸ªé—®é¢˜ï¼Œå¹¶å¾—åˆ°äº†ä¸€äº›éå¸¸å¥½çš„ç­”æ¡ˆã€‚\nå½“æ‚¨è¾¾åˆ°æ— æ³•æ¥å—è‡ªç­¾å JWT çš„æƒè¡¡æ—¶ã€‚ä¸€ä¸ªä¾‹å­å¯èƒ½æ˜¯æ‚¨æƒ³è¦å¼•å…¥åˆ·æ–°ä»¤ç‰Œçš„æ—¶åˆ»ã€‚\næˆ‘æƒ³è¡¥å……ä¸€ç‚¹ï¼Œå½“æ‚¨æ‹¥æœ‰å¤šä¸ªæœåŠ¡æˆ–è€…æ‚¨å¸Œæœ›èƒ½å¤Ÿå¼ºåŒ–å®‰å…¨æ€§æ—¶ï¼Œä¸åŒçš„æˆæƒæœåŠ¡å™¨æ›´æœ‰æ„ä¹‰ï¼ˆéš”ç¦»åƒèº«ä»½éªŒè¯è¿™æ ·é‡è¦çš„ä¸œè¥¿å¯ä»¥æä¾›ä»·å€¼ï¼Œå› ä¸ºæ”»å‡»é¢å‡å°‘äº†ï¼‰\næˆ‘ä»¬å¯èƒ½ä¼šèŠ±å¾ˆå¤šæ—¶é—´è®¨è®ºæˆæƒå’Œèµ„æºæœåŠ¡å™¨ã€‚ä¸ºäº†è®©æœ¬æ•™ç¨‹å›´ç»•è¿™ä¸ªä¸»é¢˜ï¼Œæˆ‘å°†ç»™æ‚¨ç•™ä¸‹ä¸€äº›éå¸¸å¥½çš„èµ„æºï¼Œæˆ‘å»ºè®®æ‚¨åœ¨æœ‰æ—¶é—´æ—¶é˜…è¯»å®ƒä»¬ã€‚\nOAuth2 Resource Server OAuth2 Resource Server JWT Spring Authorization Server OAUTH 2 èµ„æºæœåŠ¡å™¨é…ç½® ç°åœ¨æ‚¨å·²ç»çŸ¥é“ä»€ä¹ˆæ˜¯èµ„æºæœåŠ¡å™¨ä»¥åŠå®ƒçš„ç”¨é€”ï¼Œæ‚¨éœ€è¦é…ç½®ä¸€ä¸ªã€‚æ‚¨å¯ä»¥é€šè¿‡è®¾ç½® .oauth2ResourceServer() åœ¨å®‰å…¨é…ç½®ä¸­æ‰§è¡Œæ­¤æ“ä½œã€‚è¿™å¯ä»¥æ˜¯è‡ªå®šä¹‰èµ„æºæœåŠ¡å™¨é…ç½®å™¨ï¼Œæˆ–è€…æ‚¨å¯ä»¥ä½¿ç”¨ Spring æä¾›çš„ OAuth2ResourceServerConfigurer ç±»ã€‚\nOAuth2ResourceServerConfigurer æ˜¯ OAuth 2.0 èµ„æºæœåŠ¡å™¨æ”¯æŒçš„ AbstractHttpConfigurer ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¼šè¿æ¥ä¸€ä¸ª BearerTokenAuthenticationFilter ï¼Œå®ƒå¯ç”¨äºè§£æå¯¹æ‰¿è½½ä»¤ç‰Œçš„è¯·æ±‚å¹¶è¿›è¡Œèº«ä»½éªŒè¯å°è¯•ã€‚\nè¯¥é…ç½®ç±»æœ‰ä»¥ä¸‹å¯ç”¨é€‰é¡¹ï¼š\naccessDeniedHandler - è‡ªå®šä¹‰å¤„ç†æ‹’ç»è®¿é—®é”™è¯¯çš„æ–¹å¼ã€‚ authenticationEntryPoint - è‡ªå®šä¹‰å¦‚ä½•å¤„ç†èº«ä»½éªŒè¯å¤±è´¥ã€‚ bearerTokenResolver - è‡ªå®šä¹‰å¦‚ä½•ä»è¯·æ±‚ä¸­è§£ææ‰¿è½½ä»¤ç‰Œã€‚ jwt(Customizer) - å¯ç”¨ Jwt ç¼–ç çš„ä¸è®°åä»¤ç‰Œæ”¯æŒã€‚ opaqueToken(Customizer) -å¯ç”¨ä¸é€æ˜çš„ä¸è®°åä»¤ç‰Œæ”¯æŒã€‚ æ‚¨å°†ä½¿ç”¨ JWTï¼Œå› æ­¤é…ç½®é€‰é¡¹å¯ä»¥ä½¿ç”¨æ–¹æ³•å¼•ç”¨ï¼Œå¹¶ä¸”çœ‹èµ·æ¥åƒ OAuth2ResourceServerConfigurer::jwt\n@Bean public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception { return http .csrf(csrf -\u0026gt; csrf.disable()) .authorizeRequests( auth -\u0026gt; auth .anyRequest().authenticated() ) .oauth2ResourceServer(OAuth2ResourceServerConfigurer::jwt) .sessionManagement(session -\u0026gt; session.sessionCreationPolicy(SessionCreationPolicy.STATELESS)) .httpBasic(withDefaults()) .build(); } å½“æ‚¨ä½¿ç”¨ JWT å®šåˆ¶å™¨æ—¶ï¼Œæ‚¨éœ€è¦æä¾›ä»¥ä¸‹å…¶ä¸­ä¸€é¡¹ï¼š\né€šè¿‡ OAuth2ResourceServerConfigurer.JwtConfigurer.jwkSetUri æä¾› Jwk Set Uri é€šè¿‡ OAuth2ResourceServerConfigurer.JwtConfigurer.decoder æä¾› JwtDecoder å®ä¾‹ å…¬å¼€ JwtDecoder beanã€‚ å¦‚æœæ‚¨å°è¯•è¿è¡Œè¯¥åº”ç”¨ç¨‹åºè€Œä¸æä¾›ä¸Šè¿°é€‰é¡¹ä¹‹ä¸€ï¼Œæ‚¨å°†æ”¶åˆ°ä»¥ä¸‹é”™è¯¯ï¼š\nDescription: Parameter 0 of method setFilterChains in org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration required a bean of type \u0026#39;org.springframework.security.oauth2.jwt.JwtDecoder\u0026#39; that could not be found. Action: Consider defining a bean of type \u0026#39;org.springframework.security.oauth2.jwt.JwtDecoder\u0026#39; in your configuration. ç­¾ç½² JSON ç½‘ç»œä»¤ç‰Œ ä¸‹ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ JwtDecoder beanï¼Œä½†æˆ‘è®¤ä¸ºæˆ‘ä»¬éœ€è¦è®¨è®ºä¸€ä¸‹æˆ‘ä»¬å°†åœ¨è¿™é‡Œåšä»€ä¹ˆã€‚æ­£å¦‚æ‚¨ä¹‹å‰äº†è§£åˆ°çš„ï¼ŒJWT ç”± 3 ä¸ªéƒ¨åˆ†ç»„æˆï¼šæ ‡å¤´ã€æœ‰æ•ˆè´Ÿè½½å’Œç­¾åã€‚ç­¾åæ˜¯é€šè¿‡åŠ å¯†æ ‡å¤´+æœ‰æ•ˆè´Ÿè½½å’Œç§˜å¯†ï¼ˆæˆ–ç§é’¥ï¼‰æ¥åˆ›å»ºçš„ã€‚\nJWT å¯ä»¥ä½¿ç”¨å¯¹ç§°å¯†é’¥ï¼ˆå…±äº«å¯†é’¥ï¼‰æˆ–éå¯¹ç§°å¯†é’¥ï¼ˆç§æœ‰-å…¬å…±å¯¹çš„ç§æœ‰å¯†é’¥ï¼‰è¿›è¡ŒåŠ å¯†ã€‚\nå¯¹ç§°å¯†é’¥ï¼šç›¸åŒçš„å¯†é’¥ç”¨äºåŠ å¯†ï¼ˆåˆ›å»º JWT æ—¶ï¼‰å’Œè§£å¯†ï¼ˆMobileTogether Server ä½¿ç”¨è¯¥å¯†é’¥æ¥éªŒè¯ JWTï¼‰ã€‚å¯¹ç§°å¯†é’¥ï¼ˆä¹Ÿç§°ä¸ºå…±äº«å¯†é’¥ï¼‰ä½œä¸ºè®¾ç½®å­˜å‚¨åœ¨ MobileTogether Server ä¸­ã€‚æœ‰å…³ä½¿ç”¨å¯¹ç§°å¯†é’¥çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…å¯¹ç§°å¯†é’¥ï¼šå…±äº«å¯†é’¥ã€‚ éå¯¹ç§°å¯†é’¥ï¼šåŠ å¯†ï¼ˆç§é’¥ï¼‰å’Œè§£å¯†ï¼ˆå…¬é’¥ï¼‰ä½¿ç”¨ä¸åŒçš„å¯†é’¥ã€‚å…¬é’¥ä½œä¸ºè®¾ç½®å­˜å‚¨åœ¨ MobileTogether æœåŠ¡å™¨ä¸­ï¼Œä»¥ä¾¿å¯ä»¥éªŒè¯ JWTã€‚æœ‰å…³å¯¹ JWT ä½¿ç”¨éå¯¹ç§°åŠ å¯†çš„ä¿¡æ¯ï¼Œè¯·å‚é˜…éå¯¹ç§°å¯†é’¥ï¼šå…¬é’¥ã€‚ æ¯ç§æ–¹æ³•éƒ½æœ‰ä¼˜ç‚¹/ç¼ºç‚¹ï¼Œä½†é€šå¸¸å»ºè®®æ‚¨ä½¿ç”¨éå¯¹ç§°å¯†é’¥ï¼Œå› æ­¤è¿™å°±æ˜¯æ‚¨åœ¨æ­¤å¤„é‡‡ç”¨çš„æ–¹æ³•ã€‚\nå…¬é’¥å’Œç§é’¥ æ‚¨å°†åˆ›å»ºä¸€ä¸ªå…¬é’¥/ç§é’¥å¯¹ã€‚æ‚¨å¯ä»¥é€šè¿‡ä»£ç æ¥å®Œæˆæ­¤æ“ä½œï¼Œä½†æˆ‘è®¤ä¸ºå¦‚æœæ‚¨åœ¨è¿™é‡Œæ‰‹åŠ¨æ‰§è¡Œæ­¤æ“ä½œå¯èƒ½ä¼šæ›´æœ‰æ„ä¹‰ã€‚æˆ‘å°†åœ¨ /src/main/rescurces/certs ä¸‹çš„æ–°æ–‡ä»¶å¤¹ä¸­åˆ›å»ºå®ƒä»¬ã€‚æˆ‘å°†ä½¿ç”¨é»˜è®¤å®‰è£…åœ¨ macOS ä¸Šçš„ OpenSSLï¼Œä½†æ‚¨åº”è¯¥èƒ½å¤Ÿåœ¨æ‚¨ä½¿ç”¨çš„ä»»ä½•æ“ä½œç³»ç»Ÿä¸Šå®‰è£…å®ƒã€‚\né€šå¸¸æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥è¿è¡Œå‰ä¸¤ä¸ªå‘½ä»¤ã€‚ç¬¬ä¸‰æ¡å‘½ä»¤çš„åŸå› æ˜¯ç§é’¥éœ€è¦é‡‡ç”¨ PEM ç¼–ç çš„ PKCS#8 æ ¼å¼ã€‚åˆ‡æ¢åˆ°è¯¥ certs ç›®å½•å¹¶åˆ†åˆ«è¿è¡Œä»¥ä¸‹æ¯ä¸ªå‘½ä»¤ã€‚\n# create rsa key pair openssl genrsa -out keypair.pem 2048 # extract public key openssl rsa -in keypair.pem -pubout -out public.pem # create private key in PKCS#8 format openssl pkcs8 -topk8 -inform PEM -outform PEM -nocrypt -in keypair.pem -out private.pem å¦‚æœä¸€åˆ‡è¿è¡Œæ²¡æœ‰é”™è¯¯å¹¶ä¸”æ‚¨åŒæ—¶æ‹¥æœ‰å…¬é’¥å’Œç§é’¥ï¼Œåˆ™å¯ä»¥åˆ é™¤ keypair.pem\nJWTDECODER å…¬é’¥å’Œç§é’¥å°±ä½åï¼Œæ‚¨å¯ä»¥å°†æ³¨æ„åŠ›é›†ä¸­åˆ°å®šä¹‰ JwtDecoder bean ä¸Šã€‚é¦–å…ˆï¼Œåœ¨ config åŒ…ä¸­åˆ›å»ºä¸€ä¸ªåä¸º RsaKeyProperties çš„æ–°è®°å½•ç±»ï¼Œè¿™å°†ç”¨äºå¤–éƒ¨åŒ–å…¬é’¥å’Œç§é’¥ã€‚\n@ConfigurationProperties(prefix = \u0026#34;rsa\u0026#34;) public record RsaKeyProperties(RSAPublicKey publicKey, RSAPrivateKey privateKey) { } å¦‚æœæ‚¨è¿è¡Œæ„å»ºå¹¶æ‰“å¼€ application.properties ï¼Œæ‚¨åº”è¯¥è·å¾—ç§é’¥å’Œå…¬é’¥é…ç½®çš„ IntelliSenseã€‚æ·»åŠ ä»¥ä¸‹é…ç½®ï¼Œä»¥ä¾¿æ‚¨çš„åº”ç”¨ç¨‹åºå¯ä»¥æ‰¾åˆ°æ‚¨çš„å¯†é’¥ã€‚\nrsa.private-key=classpath:certs/private.pem rsa.public-key=classpath:certs/public.pem æ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦åœ¨ä¸»ç±»ä¸Šå¯ç”¨é…ç½®å±æ€§ï¼š\n@SpringBootApplication @EnableConfigurationProperties(RsaKeyProperties.class) public class JwtDemoApplication { public static void main(String[] args) { SpringApplication.run(JwtDemoApplication.class, args); } } å›åˆ° SecurityConfig ï¼Œæ‚¨å¯ä»¥è·å–è‡ªåŠ¨è£…é…çš„å®ä¾‹ï¼š\n@Configuration @EnableWebSecurity public class SecurityConfig { private final RsaKeyProperties rsaKeys; public SecurityConfig(RsaKeyProperties rsaKeys) { this.rsaKeys = rsaKeys; } ç°åœ¨æ‚¨å¯ä»¥ä½¿ç”¨å…¬é’¥åˆ›å»º JwtDecoder ã€‚è¿™æ˜¯æ‚¨é€šå¸¸éœ€è¦å¼•å…¥ç¬¬ä¸‰æ–¹åº“çš„äº‹æƒ…ï¼Œä½†æ‚¨ä¸éœ€è¦è¿™æ ·åšã€‚èµ„æºæœåŠ¡å™¨ä¸ºæ‚¨å¸¦æ¥çš„ä¾èµ–é¡¹ä¹‹ä¸€æ˜¯ ``spring-security-oauth2-jose`ï¼Œå®ƒåŒ…å«ä¸€ä¸ªåä¸º Nimbus Jose JWT çš„åº“ã€‚æ‚¨å¯ä»¥ä½¿ç”¨åˆšåˆšåˆ›å»ºçš„å…¬é’¥è¿”å› Nimbus JWT è§£ç å™¨ã€‚\n@Bean JwtDecoder jwtDecoder() { return NimbusJwtDecoder.withPublicKey(rsaKeys.publicKey()).build(); } æ­¤æ—¶ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿè¿è¡Œè¯¥åº”ç”¨ç¨‹åºè€Œä¸ä¼šå‡ºç°ä»»ä½•é”™è¯¯ã€‚\nèº«ä»½éªŒè¯æ§åˆ¶å™¨å’Œä»¤ç‰ŒæœåŠ¡ æ‚¨å·²å‡†å¤‡å¥½å¯†é’¥å¹¶å®šä¹‰äº†è§£ç å™¨ï¼Œè¿™æ˜¯ä¸€ç§ç ´è¯‘ JWT çš„æ–¹æ³•ã€‚å¦‚æœæ‚¨è¿˜è®°å¾—ä¹‹å‰çš„æ¶æ„å›¾ï¼Œç”¨æˆ·å°†éœ€è¦ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç ç™»å½•ã€‚å¦‚æœä»–ä»¬é€šè¿‡èº«ä»½éªŒè¯ï¼Œæ‚¨å°†ç”Ÿæˆä¸€ä¸ªæ–°çš„ JSON Web ä»¤ç‰Œå¹¶å°†å…¶åœ¨å“åº”ä¸­å‘å›ã€‚\nä¸ºæ­¤ï¼Œæ‚¨é¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ª JwtEncoder ç±»å‹çš„ beanï¼Œå¹¶ä¸”å¯ä»¥åœ¨ SecurityConfig ä¸­æ‰§è¡Œæ­¤æ“ä½œã€‚ç¼–ç å™¨å°†ç”¨äºå°†æˆ‘ä»¬ä¹‹å‰äº†è§£çš„ç­¾åç¼–ç ä¸ºä»¤ç‰Œï¼Œå¹¶ä½¿ç”¨æˆ‘ä»¬çš„ç§é’¥å¯¹å…¶è¿›è¡Œç­¾åã€‚\n@Bean JwtEncoder jwtEncoder() { JWK jwk = new RSAKey.Builder(rsaKeys.publicKey()).privateKey(rsaKeys.privateKey()).build(); JWKSource\u0026lt;SecurityContext\u0026gt; jwks = new ImmutableJWKSet\u0026lt;\u0026gt;(new JWKSet(jwk)); return new NimbusJwtEncoder(jwks); } æ‚¨å¯ä»¥ç›´æ¥åœ¨èº«ä»½éªŒè¯æ§åˆ¶å™¨ä¸­ä½¿ç”¨ç¼–ç å™¨ï¼Œä½†æˆ‘è§‰å¾—æ‚¨åº”è¯¥å°†å…¶æå–åˆ°æœåŠ¡å±‚ã€‚åœ¨åä¸º service çš„æ–°åŒ…ä¸­åˆ›å»ºä¸€ä¸ªåä¸º TokenService çš„æ–°ç±»ï¼Œè¯¥ç±»å°†ä½¿ç”¨æ–°çš„ JwtEncoder ç”Ÿæˆä»¤ç‰Œã€‚åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œä»¤ç‰Œå°†åœ¨ 1 å°æ—¶åè¿‡æœŸï¼Œä½†æ‚¨å¯ä»¥è°ƒæ•´å®ƒä»¥æ»¡è¶³æ‚¨çš„éœ€è¦ã€‚\n@Service public class TokenService { private final JwtEncoder encoder; public TokenService(JwtEncoder encoder) { this.encoder = encoder; } public String generateToken(Authentication authentication) { Instant now = Instant.now(); String scope = authentication.getAuthorities().stream() .map(GrantedAuthority::getAuthority) .collect(Collectors.joining(\u0026#34; \u0026#34;)); JwtClaimsSet claims = JwtClaimsSet.builder() .issuer(\u0026#34;self\u0026#34;) .issuedAt(now) .expiresAt(now.plus(1, ChronoUnit.HOURS)) .subject(authentication.getName()) .claim(\u0026#34;scope\u0026#34;, scope) .build(); return this.encoder.encode(JwtEncoderParameters.from(claims)).getTokenValue(); } } æ¥ä¸‹æ¥åœ¨ controller åŒ…ä¸­åˆ›å»ºä¸€ä¸ªåä¸º AuthController çš„æ–°æ§åˆ¶å™¨ã€‚è¿™å°†åŒ…å«ä¸€ä¸ª POST æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†ä½¿ç”¨æ–°çš„ä»¤ç‰ŒæœåŠ¡ä¸ºç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ç”Ÿæˆä»¤ç‰Œã€‚æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œæœ‰ä¸€äº›ç”¨äºè°ƒè¯•ç›®çš„çš„æ—¥å¿—è®°å½•ï¼Œä»¥ä¾¿åœ¨å¼€å‘ä¸­æ‚¨å°†çœ‹åˆ°ç”¨æˆ·è¯·æ±‚ JWT å’Œåˆ›å»ºçš„ä»¤ç‰Œã€‚\n@RestController public class AuthController { private static final Logger LOG = LoggerFactory.getLogger(AuthController.class); private final TokenService tokenService; public AuthController(TokenService tokenService) { this.tokenService = tokenService; } @PostMapping(\u0026#34;/token\u0026#34;) public String token(Authentication authentication) { LOG.debug(\u0026#34;Token requested for user: \u0026#39;{}\u0026#39;\u0026#34;, authentication.getName()); String token = tokenService.generateToken(authentication); LOG.debug(\u0026#34;Token granted: {}\u0026#34;, token); return token; } } å¦‚æœä¸€åˆ‡éƒ½æ­£ç¡®å®Œæˆï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿæ¯«æ— é”™è¯¯åœ°å¯åŠ¨æ‚¨çš„åº”ç”¨ç¨‹åºã€‚\nSPRING å®‰å…¨æµ‹è¯• è¿™æ ·ï¼Œæ‚¨åº”è¯¥ä½¿ç”¨ JWT ä¿æŠ¤æ‚¨çš„æ ¹è·¯å¾„ã€‚ç°åœ¨æ‚¨åªéœ€è¦æµ‹è¯•ä¸€ä¸‹å³å¯ã€‚\næ‰‹åŠ¨æµ‹è¯• æ‚¨å¯ä»¥é€šè¿‡å¤šç§æ–¹æ³•æ‰‹åŠ¨æµ‹è¯•è¿™ä¸€ç‚¹ï¼Œä½†åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘å°†å‘æ‚¨å±•ç¤º 2.\nPostman\næµ‹è¯•è¿™ä¸€ç‚¹çš„ä¸€ä¸ªç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨ Postman ç­‰å·¥å…·ã€‚å¦‚æœæ‚¨å‘ä»¤ç‰Œç«¯ç‚¹åˆ›å»ºæ–°çš„ POST è¯·æ±‚ï¼Œæ‚¨å¯ä»¥ä»â€œæˆæƒâ€é€‰é¡¹å¡ä¸­é€‰æ‹©â€œåŸºæœ¬èº«ä»½éªŒè¯â€å¹¶è¾“å…¥æ‚¨çš„å‡­æ®ã€‚å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæ‚¨å°†åœ¨å“åº”ä¸­è¿”å›ç”Ÿæˆçš„ JWTã€‚\nå¤åˆ¶ JWT å¹¶ä¸º http://localhost:8080 åˆ›å»ºæ–°çš„ GET è¯·æ±‚ã€‚è½¬åˆ°â€œæˆæƒâ€é€‰é¡¹å¡å¹¶é€‰æ‹©â€œæ‰¿è½½ä»¤ç‰Œâ€å¹¶ç²˜è´´ç”Ÿæˆçš„ä»¤ç‰Œã€‚å¦‚æœæ‚¨å‘é€è¯·æ±‚ï¼Œæ‚¨åº”è¯¥å–å›ä» HomeController ä¸­çš„ home æ–¹æ³•è¿”å›çš„å­—ç¬¦ä¸²ã€‚\nå‘½ä»¤è¡Œ\næˆ‘éå¸¸å–œæ¬¢å‘½ä»¤è¡Œå’Œ httpie å·¥å…·ã€‚å®ƒç®€åŒ–äº†åœ¨ç»ˆç«¯ä¸­æµ‹è¯• API çš„å‘½ä»¤çš„ç¼–å†™ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä½¿ç”¨æ‚¨çš„å‡­æ®å‘ä»¤ç‰Œç«¯ç‚¹å‘é€è¯·æ±‚ï¼š\nhttp POST :8080/token --auth dvega:password -v -v å‚æ•°å°†æ‰“å°è¯·æ±‚å’Œå“åº”\nå“åº”å°†åŒ…å«ç”Ÿæˆçš„ JWT ä»¤ç‰Œã€‚å¦‚æœæ‚¨åœ¨æ²¡æœ‰æˆæƒæ ‡å¤´æˆ–æ²¡æœ‰æ­£ç¡®ä»¤ç‰Œçš„æƒ…å†µä¸‹å‘æ ¹è·¯å¾„å‘å‡ºè¯·æ±‚ï¼Œæ‚¨å°†æ”¶åˆ° 401ï¼ˆæ‹’ç»ï¼‰å“åº”ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨ä»¥æ­£ç¡®çš„æ ¼å¼åŒ…å« Authorization æ ‡å¤´ï¼Œæ‚¨å°†è·å¾—ä» HomeController ä¸­çš„ home æ–¹æ³•è¿”å›çš„å­—ç¬¦ä¸²ã€‚\nhttp :8080 \u0026#39;Authorization: Bearer JWT_TOKEN_HERE\u0026#39; è‡ªåŠ¨åŒ–æµ‹è¯• æ‰‹åŠ¨æµ‹è¯•å¾ˆæ£’ï¼Œå› ä¸ºæ‚¨å¯ä»¥çœ‹åˆ°ä¸€åˆ‡éƒ½æŒ‰é¢„æœŸè¿è¡Œã€‚ä½†æ˜¯ï¼Œæ‚¨å°†éœ€è¦ä¸€äº›é€‚å½“çš„è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œä»¥ä¾¿åœ¨è¿›è¡Œæ›´æ”¹æ—¶æ‚¨å¯ä»¥ç¡®ä¿¡æ²¡æœ‰ä»»ä½•å†…å®¹ç ´åç°æœ‰åŠŸèƒ½ã€‚æˆ‘ä¸ä¼šå¯¹æ­¤è¿›è¡Œè¿‡å¤šè®¨è®ºï¼Œä½†æˆ‘æƒ³ä¸ºæ‚¨æä¾›ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹æ¥è¯´æ˜å¦‚ä½•ç¼–å†™æ­¤ç±»æµ‹è¯•ã€‚\nå½“æ‚¨å¼•å…¥èµ„æºæœåŠ¡å™¨æ—¶ï¼Œæœ‰ä¸€ä¸ªä¾èµ–é¡¹æ²¡æœ‰å¼•å…¥ï¼Œé‚£å°±æ˜¯ spring-security-test ã€‚åœ¨ç¼–å†™ä»»ä½•ä¸å®‰å…¨ç›¸å…³çš„æµ‹è¯•ä¹‹å‰ï¼Œæ‚¨éœ€è¦å°†å…¶æ·»åŠ åˆ°æ‚¨çš„ pom.xml ä¸­ã€‚\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.security\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-security-test\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; å½“æ‚¨ç¼–å†™ä»…å…³æ³¨ Web å±‚é…ç½®çš„åˆ‡ç‰‡æµ‹è¯•æ—¶ï¼ŒæœåŠ¡ç±»å°†ä¸ä¼šæ·»åŠ åˆ°åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­ã€‚ä¸ºäº†ä½¿ä¸€åˆ‡æ­£å¸¸å·¥ä½œï¼Œæ‚¨éœ€è¦æ‰‹åŠ¨å¯¼å…¥ SercurityConfig å’Œ TokenService ç±»ã€‚è¿™äº›æµ‹è¯•åº”è¯¥æ˜¯ä¸è¨€è‡ªæ˜çš„ï¼Œä½†å¦‚æœæ‚¨å¸Œæœ›æˆ‘è¿›è¡Œè¿™äº›æµ‹è¯•ï¼Œè¯·è”ç³»æˆ‘å¹¶å‘Šè¯‰æˆ‘ã€‚\n@WebMvcTest({HomeController.class, AuthController.class}) @Import({SecurityConfig.class, TokenService.class}) class HomeControllerTest { @Autowired MockMvc mvc; @Test void rootWhenUnauthenticatedThen401() throws Exception { this.mvc.perform(get(\u0026#34;/\u0026#34;)) .andExpect(status().isUnauthorized()); } @Test void rootWhenAuthenticatedThenSaysHelloUser() throws Exception { MvcResult result = this.mvc.perform(post(\u0026#34;/token\u0026#34;) .with(httpBasic(\u0026#34;dvega\u0026#34;, \u0026#34;password\u0026#34;))) .andExpect(status().isOk()) .andReturn(); String token = result.getResponse().getContentAsString(); this.mvc.perform(get(\u0026#34;/\u0026#34;) .header(\u0026#34;Authorization\u0026#34;, \u0026#34;Bearer \u0026#34; + token)) .andExpect(content().string(\u0026#34;Hello, dvega\u0026#34;)); } @Test @WithMockUser public void rootWithMockUserStatusIsOK() throws Exception { this.mvc.perform(get(\u0026#34;/\u0026#34;)).andExpect(status().isOk()); } } ç»“è®º å½“æˆ‘å¼€å§‹åˆ›å»ºæœ¬æ•™ç¨‹æ—¶ï¼Œæˆ‘çš„å…¨éƒ¨ç›®æ ‡æ˜¯è®©æ‚¨çŸ¥é“æœ‰ä¸€ç§æ›´ç®€å•çš„æ–¹æ³•å¯ä»¥ä½¿ç”¨ JWT æ¥ä¿æŠ¤æ‚¨çš„ APIã€‚æˆ‘å¸Œæœ›ç°åœ¨æ‚¨çŸ¥é“ Spring Security ä½¿ç”¨ oAuth2 èµ„æºæœåŠ¡å™¨å†…ç½®äº†å¯¹ JSON Web ä»¤ç‰Œçš„æ”¯æŒï¼Œæ‚¨å¯ä»¥åœ¨ä¸‹ä¸€ä¸ªé¡¹ç›®ä¸­ä½¿ç”¨å®ƒã€‚è¿™åªæ˜¯å¦‚ä½•åœ¨ Spring Boot åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ JWT çš„èµ·è·‘çº¿ï¼Œç»ä¸æ˜¯ç»ˆç‚¹çº¿ã€‚å¦‚æœæ‚¨å¯¹å…·ä½“é…ç½®æœ‰ç–‘é—®ï¼Œè¯·ä¸æˆ‘è”ç³»ã€‚\næˆ‘æ„Ÿåˆ°éå¸¸å¹¸è¿ï¼Œèƒ½å¤Ÿåœ¨ VMware è¿™æ ·çš„å…¬å¸å·¥ä½œï¼Œå¹¶ä¸”èƒ½å¤Ÿæ¥è§¦åˆ°ä¸€äº›éå¸¸èªæ˜çš„äººã€‚å½“æ‚¨ä¸ä¸€ç¾¤æ€»æ˜¯æ„¿æ„åˆ†äº«çŸ¥è¯†å’Œæä¾›å¸®åŠ©çš„ä¼˜ç§€äººå£«ä¸€èµ·å·¥ä½œæ—¶ï¼Œè¿™ç§è®¿é—®å°±æ„å‘³ç€æ›´é‡è¦ã€‚æˆ‘è¦ç‰¹åˆ«æ„Ÿè°¢ä»¥ä¸‹å¸®åŠ©æˆ‘å°†è¿™äº›å†…å®¹æ•´åˆåœ¨ä¸€èµ·çš„äººï¼š\nSteve Riesenberg Rob Winch Josh Cummings Toshiaki Maki ","permalink":"https://blog.chensoul.cc/posts/2023/09/19/spring-security-jwt/","summary":"å¦‚æœæ‚¨å¿«é€Ÿæœç´¢å¦‚ä½•ä½¿ç”¨ JSON Web Tokens åœ¨ Spring Boot ä¸­ä¿æŠ¤ REST APIï¼Œæ‚¨ä¼šå‘ç°å¾ˆå¤šç›¸åŒçš„ç»“æœã€‚è¿™äº›ç»“æœåŒ…å«ä¸€ç§æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¶‰åŠç¼–å†™è‡ªå®šä¹‰è¿‡æ»¤å™¨é“¾å¹¶å¼•å…¥ç¬¬ä¸‰æ–¹åº“æ¥ç¼–ç å’Œè§£ç  JWTã€‚\nåœ¨çœ‹å®Œè¿™äº›ä»¤äººè´¹è§£ä¸”ä»¤äººå›°æƒ‘çš„æ•™ç¨‹åï¼Œæˆ‘è¯´å¿…é¡»æœ‰ä¸€ç§æ›´ç®€å•çš„æ–¹æ³•æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚æˆ‘åšäº†ä»»ä½•ç›´æ¥æ¥è§¦ Spring Security å›¢é˜Ÿçš„äººéƒ½ä¼šåšçš„äº‹æƒ…ï¼Œæˆ‘å‘ä»–ä»¬å¯»æ±‚å¸®åŠ©ã€‚ä»–ä»¬å‘Šè¯‰æˆ‘ï¼ŒSpring Security ç¡®å®ä½¿ç”¨ oAuth2 èµ„æºæœåŠ¡å™¨å†…ç½®äº†å¯¹ JWT çš„æ”¯æŒã€‚\nåœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ JSON Web Tokens (JWT) å’Œ Spring Security æ¥ä¿æŠ¤æ‚¨çš„ APIã€‚æˆ‘å¹¶ä¸æ˜¯è¯´è¿™ç§æ–¹æ³•æ— è®ºå¦‚ä½•éƒ½å¾ˆå®¹æ˜“ï¼Œä½†å¯¹æˆ‘æ¥è¯´ï¼Œå®ƒæ¯”å…¶ä»–é€‰æ‹©æ›´æœ‰æ„ä¹‰ã€‚\nGithub å­˜å‚¨åº“\nåº”ç”¨æ¶æ„ åœ¨æˆ‘ä»¬å¼€å§‹ç¼–å†™ä¸€äº›ä»£ç ä¹‹å‰ï¼Œæˆ‘æƒ³ç¡®ä¿æˆ‘ä»¬å¯¹äºæˆ‘ä»¬æ­£åœ¨æ„å»ºçš„å†…å®¹éƒ½è¾¾æˆå…±è¯†ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæ‚¨æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼Œå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªç®€å•çš„å‘½ä»¤è¡Œåº”ç”¨ç¨‹åºã€ä¸€ä¸ªç”¨ Angular æˆ– Vue ç­‰ç¼–å†™çš„å®Œæ•´å‰ç«¯åº”ç”¨ç¨‹åºï¼Œæˆ–è€…ç³»ç»Ÿä¸­çš„å…¶ä»–ä¸€äº›æœåŠ¡ã€‚\nè¯¥å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå°†è°ƒç”¨ä½¿ç”¨ Spring Boot ç¼–å†™çš„æœåŠ¡å™¨åº”ç”¨ç¨‹åºï¼Œè¯¥åº”ç”¨ç¨‹åºé€šè¿‡ REST API å…¬å¼€æ•°æ®ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ•´ä½“ï¼Œä½†å¦‚æœæ‚¨æœ‰åˆ†å¸ƒå¼æ¶æ„ï¼Œåˆ™åŒæ ·é€‚ç”¨ã€‚å½“å‰æœ‰ 3 ä¸ª REST æ§åˆ¶å™¨å…¬å¼€èµ„æºäº§å“ã€è®¢å•å’Œå®¢æˆ·ã€‚\næ‚¨è¦åšçš„æ˜¯ä¿æŠ¤æ‰€æœ‰èµ„æºï¼Œä»¥ä¾¿å½“å®¢æˆ·ç«¯è°ƒç”¨ REST API æ—¶ï¼Œå®¢æˆ·ç«¯å°†æ”¶åˆ° 401ï¼ˆæœªç»æˆæƒï¼‰ï¼Œè¿™æ„å‘³ç€å®¢æˆ·ç«¯è¯·æ±‚å°šæœªå®Œæˆï¼Œå› ä¸ºå®ƒç¼ºå°‘æ‰€è¯·æ±‚èµ„æºçš„æœ‰æ•ˆèº«ä»½éªŒè¯å‡­æ®ã€‚\nJSON ç½‘ç»œä»¤ç‰Œ (JWT) JSON Web ä»¤ç‰Œæ˜¯ä¸€ç§å¼€æ”¾æ–¹æ³•ï¼Œç”¨äºåœ¨ä¸¤æ–¹ä¹‹é—´å®‰å…¨åœ°è¡¨ç¤ºå£°æ˜ã€‚ JWT æ˜¯ä¸€ç»„å£°æ˜ï¼ˆJSON å±æ€§-å€¼å¯¹ï¼‰ï¼Œå®ƒä»¬å…±åŒæ„æˆä¸€ä¸ª JSON å¯¹è±¡ã€‚å®ƒç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š\nHeader: ç”±ä¸¤ä¸ªå±æ€§ç»„æˆï¼š{ \u0026ldquo;alg\u0026rdquo;: \u0026ldquo;HS256\u0026rdquo;, \u0026ldquo;typ\u0026rdquo;: \u0026ldquo;JWT\u0026rdquo; }ã€‚ alg æ˜¯ç”¨äºåŠ å¯† JWT çš„ç®—æ³•ã€‚ Payload: è¿™æ˜¯å­˜å‚¨è¦å‘é€çš„æ•°æ®çš„åœ°æ–¹ï¼›è¯¥æ•°æ®å­˜å‚¨ä¸º JSON å±æ€§-å€¼å¯¹ã€‚ Signature: è¿™æ˜¯é€šè¿‡åŠ å¯†åˆ›å»ºçš„ï¼Œä½¿ç”¨æ ‡å¤´ä¸­æŒ‡å®šçš„ç®—æ³•ï¼šï¼ˆiï¼‰base64Url ç¼–ç çš„æ ‡å¤´ï¼Œï¼ˆiiï¼‰base64Url ç¼–ç çš„æœ‰æ•ˆè´Ÿè½½ï¼Œä»¥åŠï¼ˆiiiï¼‰ç§˜å¯†ï¼ˆæˆ–ç§é’¥ï¼‰ï¼š HMACSHA256(base64UrlEncode(header) + \u0026#34;.\u0026#34; + base64UrlEncode(payload), secret|privateKey) æœ€ç»ˆçš„ JWT ç”±ä¸‰éƒ¨åˆ†ç»„æˆã€‚æ¯ä¸ªéƒ½æ˜¯ base64Url ç¼–ç çš„ï¼Œå¹¶ä¸”ä¸ä¸‹ä¸€ä¸ªä¹‹é—´ç”¨ç‚¹åˆ†éš”ã€‚æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… openid.net å’Œ jwt.io ç½‘ç«™ã€‚","title":"[è¯‘]SPRING BOOT JWT - å¦‚ä½•ä½¿ç”¨ SPRING SECURITY å’Œ JSON WEB ä»¤ç‰Œä¿æŠ¤æ‚¨çš„ REST API"},{"content":"å…è´£å£°æ˜ï¼šSpring Security 5+ å·²å‘å¸ƒ OAuth JWT æ”¯æŒã€‚å»ºè®®ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ OAuth æ¥æ”¯æŒ JWTï¼Œè€Œä¸æ˜¯ä½¿ç”¨è‡ªå®šä¹‰å®‰å…¨æ€§æˆ–è¿‡æ»¤å™¨ã€‚\nSpring è¢«è®¤ä¸ºæ˜¯ Java ç”Ÿæ€ç³»ç»Ÿä¸­å€¼å¾—ä¿¡èµ–çš„æ¡†æ¶ï¼Œå¹¶ä¸”è¢«å¹¿æ³›ä½¿ç”¨ã€‚å°† Spring ç§°ä¸ºæ¡†æ¶ä¸å†æœ‰æ•ˆï¼Œå› ä¸ºå®ƒæ›´å¤šçš„æ˜¯æ¶µç›–å„ç§æ¡†æ¶çš„æ€»æ‹¬æœ¯è¯­ã€‚å…¶ä¸­ä¸€ä¸ªæ¡†æ¶æ˜¯ Spring Securityï¼Œå®ƒæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”å¯å®šåˆ¶çš„èº«ä»½éªŒè¯å’Œæˆæƒæ¡†æ¶ã€‚å®ƒè¢«è®¤ä¸ºæ˜¯ä¿æŠ¤åŸºäº Spring çš„åº”ç”¨ç¨‹åºçš„äº‹å®æ ‡å‡†ï¼Œå› æ­¤ï¼Œå¦‚æœæ‚¨å¸Œæœ›å®ç° Spring JWT ä»¤ç‰Œè§£å†³æ–¹æ¡ˆï¼Œé‚£ä¹ˆå°†å…¶åŸºäº Spring Security æ˜¯æœ‰æ„ä¹‰çš„ã€‚\nå°½ç®¡å®ƒå¾ˆå—æ¬¢è¿ï¼Œä½†æˆ‘å¿…é¡»æ‰¿è®¤ï¼Œå½“æ¶‰åŠåˆ°å•é¡µåº”ç”¨ç¨‹åºæ—¶ï¼ŒSpring çš„é…ç½®å¹¶ä¸ç®€å•å’Œç›´æ¥ã€‚æˆ‘æ€€ç–‘åŸå› æ˜¯å®ƒæ›´å¤šåœ°æ˜¯ä½œä¸ºä¸€ä¸ªé¢å‘åº”ç”¨ç¨‹åºçš„ MVC æ¡†æ¶å¼€å§‹çš„ï¼Œå…¶ä¸­ç½‘é¡µæ¸²æŸ“å‘ç”Ÿåœ¨æœåŠ¡å™¨ç«¯ï¼Œå¹¶ä¸”é€šä¿¡æ˜¯åŸºäºä¼šè¯çš„ã€‚\nå¦‚æœåç«¯åŸºäº Java å’Œ Springï¼Œé‚£ä¹ˆä½¿ç”¨ Spring Security å’Œ JWT è¿›è¡Œèº«ä»½éªŒè¯/æˆæƒå¹¶å°†å…¶é…ç½®ä¸ºæ— çŠ¶æ€é€šä¿¡æ˜¯æœ‰æ„ä¹‰çš„ã€‚è™½ç„¶æœ‰å¾ˆå¤šæ–‡ç« è§£é‡Šäº†è¿™æ˜¯å¦‚ä½•å®Œæˆçš„ï¼Œä½†å¯¹æˆ‘æ¥è¯´ï¼Œç¬¬ä¸€æ¬¡è®¾ç½®å®ƒä»ç„¶ä»¤äººæ²®ä¸§ï¼Œæˆ‘å¿…é¡»é˜…è¯»å¹¶æ€»ç»“æ¥è‡ªå¤šä¸ªæ¥æºçš„ä¿¡æ¯ã€‚è¿™å°±æ˜¯æˆ‘å†³å®šç¼–å†™è¿™ä¸ª Spring Security æ•™ç¨‹çš„åŸå› ï¼Œæˆ‘å°†åœ¨å…¶ä¸­å°è¯•æ€»ç»“å¹¶æ¶µç›–æ‚¨åœ¨é…ç½®è¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°çš„æ‰€æœ‰å¿…éœ€çš„å¾®å¦™ç»†èŠ‚å’Œç¼ºé™·ã€‚\næœ¯è¯­å®šä¹‰ åœ¨æ·±å…¥æ¢è®¨æŠ€æœ¯ç»†èŠ‚ä¹‹å‰ï¼Œæˆ‘æƒ³æ˜ç¡®å®šä¹‰ Spring Security ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨çš„æœ¯è¯­ï¼Œä»¥ç¡®ä¿æˆ‘ä»¬éƒ½ä½¿ç”¨ç›¸åŒçš„è¯­è¨€ã€‚ è¿™äº›æ˜¯æˆ‘ä»¬éœ€è¦è§£å†³çš„æœ¯è¯­ï¼š\nAuthentication éªŒè¯æ˜¯æŒ‡æ ¹æ®æä¾›çš„å‡­æ®éªŒè¯ç”¨æˆ·èº«ä»½çš„è¿‡ç¨‹ã€‚ä¸€ä¸ªå¸¸è§çš„ç¤ºä¾‹æ˜¯åœ¨ç™»å½•ç½‘ç«™æ—¶è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚æ‚¨å¯ä»¥å°†å…¶è§†ä¸ºå¯¹â€œæ‚¨æ˜¯è°ï¼Ÿâ€è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆã€‚ Authorization æˆæƒæ˜¯æŒ‡å‡è®¾ç”¨æˆ·å·²æˆåŠŸé€šè¿‡èº«ä»½éªŒè¯ï¼Œåˆ™ç¡®å®šç”¨æˆ·æ˜¯å¦å…·æœ‰æ‰§è¡Œç‰¹å®šæ“ä½œæˆ–è¯»å–ç‰¹å®šæ•°æ®çš„é€‚å½“æƒé™çš„è¿‡ç¨‹ã€‚æ‚¨å¯ä»¥å°†å…¶è§†ä¸ºâ€œç”¨æˆ·å¯ä»¥æ‰§è¡Œ/é˜…è¯»æ­¤æ“ä½œå—ï¼Ÿâ€é—®é¢˜çš„ç­”æ¡ˆã€‚ Principle åŸåˆ™æ˜¯æŒ‡å½“å‰ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ã€‚ Granted authority æˆäºˆæƒé™æ˜¯æŒ‡ç»è¿‡è®¤è¯çš„ç”¨æˆ·çš„æƒé™ã€‚ Role è§’è‰²æ˜¯æŒ‡ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·çš„ä¸€ç»„æƒé™ã€‚ åˆ›å»ºåŸºæœ¬çš„ Spring åº”ç”¨ç¨‹åº åœ¨å¼€å§‹é…ç½® Spring Security æ¡†æ¶ä¹‹å‰ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„ Spring Web åº”ç”¨ç¨‹åºã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Spring Initializr å¹¶ç”Ÿæˆä¸€ä¸ªæ¨¡æ¿é¡¹ç›®ã€‚å¯¹äºä¸€ä¸ªç®€å•çš„ Web åº”ç”¨ç¨‹åºï¼Œåªéœ€è¦ Spring Web æ¡†æ¶ä¾èµ–å°±è¶³å¤Ÿäº†ï¼š\n\u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; åˆ›å»ºé¡¹ç›®åï¼Œæˆ‘ä»¬å¯ä»¥å‘å…¶ä¸­æ·»åŠ ä¸€ä¸ªç®€å•çš„ REST æ§åˆ¶å™¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n@RestController @RequestMapping(\u0026#34;hello\u0026#34;) public class HelloRestController { @GetMapping(\u0026#34;user\u0026#34;) public String helloUser() { return \u0026#34;Hello User\u0026#34;; } @GetMapping(\u0026#34;admin\u0026#34;) public String helloAdmin() { return \u0026#34;Hello Admin\u0026#34;; } } ä¹‹åï¼Œå¦‚æœæˆ‘ä»¬æ„å»ºå¹¶è¿è¡Œè¯¥é¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Web æµè§ˆå™¨ä¸­è®¿é—®ä»¥ä¸‹ URLï¼š\nhttp://localhost:8080/hello/user å°†è¿”å›å­—ç¬¦ä¸² Hello User ã€‚ http://localhost:8080/hello/admin å°†è¿”å›å­—ç¬¦ä¸² Hello Admin ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥å°† Spring Security æ¡†æ¶æ·»åŠ åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†ä»¥ä¸‹ä¾èµ–é¡¹æ·»åŠ åˆ° pom.xml æ–‡ä»¶ä¸­æ¥å®Œæˆæ­¤æ“ä½œï¼š\n\u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-security\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; åœ¨æˆ‘ä»¬æä¾›ç›¸åº”çš„é…ç½®ä¹‹å‰ï¼Œæ·»åŠ å…¶ä»– Spring æ¡†æ¶ä¾èµ–é¡¹é€šå¸¸ä¸ä¼šç«‹å³å¯¹åº”ç”¨ç¨‹åºäº§ç”Ÿå½±å“ï¼Œä½† Spring Security çš„ä¸åŒä¹‹å¤„åœ¨äºå®ƒç¡®å®ä¼šç«‹å³äº§ç”Ÿå½±å“ï¼Œè¿™é€šå¸¸ä¼šè®©æ–°ç”¨æˆ·æ„Ÿåˆ°å›°æƒ‘ã€‚æ·»åŠ åï¼Œå¦‚æœæˆ‘ä»¬é‡å»ºå¹¶è¿è¡Œé¡¹ç›®ï¼Œç„¶åå°è¯•è®¿é—®ä¸Šè¿° URL ä¹‹ä¸€è€Œä¸æ˜¯æŸ¥çœ‹ç»“æœï¼Œæˆ‘ä»¬å°†è¢«é‡å®šå‘åˆ° http://localhost:8080/login ã€‚è¿™æ˜¯é»˜è®¤è¡Œä¸ºï¼Œå› ä¸º Spring Security æ¡†æ¶è¦æ±‚å¯¹æ‰€æœ‰ URL è¿›è¡Œå¼€ç®±å³ç”¨çš„èº«ä»½éªŒè¯ã€‚\nä¸ºäº†é€šè¿‡èº«ä»½éªŒè¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é»˜è®¤ç”¨æˆ·å user å¹¶åœ¨æ§åˆ¶å°ä¸­æ‰¾åˆ°è‡ªåŠ¨ç”Ÿæˆçš„å¯†ç ï¼š\nUsing generated security password: 1fc15145-dfee-4bec-a009-e32ca21c77ce è¯·è®°ä½ï¼Œæ¯æ¬¡é‡æ–°è¿è¡Œåº”ç”¨ç¨‹åºæ—¶å¯†ç éƒ½ä¼šæ›´æ”¹ã€‚å¦‚æœæˆ‘ä»¬æƒ³æ”¹å˜è¿™ç§è¡Œä¸ºå¹¶ä½¿å¯†ç é™æ€ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä»¥ä¸‹é…ç½®æ·»åŠ åˆ°æˆ‘ä»¬çš„ application.properties æ–‡ä»¶ä¸­ï¼š\nspring.security.user.password=Test12345_ ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ç™»å½•è¡¨å•ä¸­è¾“å…¥å‡­æ®ï¼Œæˆ‘ä»¬å°†è¢«é‡å®šå‘å›æˆ‘ä»¬çš„ URLï¼Œæˆ‘ä»¬å°†çœ‹åˆ°æ­£ç¡®çš„ç»“æœã€‚è¯·æ³¨æ„ï¼Œå¼€ç®±å³ç”¨çš„èº«ä»½éªŒè¯è¿‡ç¨‹æ˜¯åŸºäºä¼šè¯çš„ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æ³¨é”€ï¼Œå¯ä»¥è®¿é—®ä»¥ä¸‹ URLï¼š http://localhost:8080/logout\nè¿™ç§å¼€ç®±å³ç”¨çš„è¡Œä¸ºå¯¹äºå…·æœ‰åŸºäºä¼šè¯èº«ä»½éªŒè¯çš„ç»å…¸ MVC Web åº”ç”¨ç¨‹åºå¯èƒ½å¾ˆæœ‰ç”¨ï¼Œä½†å¯¹äºå•é¡µåº”ç”¨ç¨‹åºæ¥è¯´ï¼Œå®ƒé€šå¸¸æ²¡æœ‰ç”¨ï¼Œå› ä¸ºåœ¨å¤§å¤šæ•°ç”¨ä¾‹ä¸­ï¼Œæˆ‘ä»¬æœ‰å®¢æˆ·ç«¯æ¸²æŸ“å’ŒåŸºäº JWT çš„æ— çŠ¶æ€èº«ä»½éªŒè¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸å¤§é‡å®šåˆ¶ Spring Security æ¡†æ¶ï¼Œæˆ‘ä»¬å°†åœ¨æœ¬æ–‡çš„å…¶ä½™éƒ¨åˆ†ä¸­è¿›è¡Œæ­¤æ“ä½œã€‚\nä¾‹å¦‚ï¼Œæˆ‘ä»¬å°†å®ç°ä¸€ä¸ªç»å…¸çš„ä¹¦åº— Web åº”ç”¨ç¨‹åºï¼Œå¹¶åˆ›å»ºä¸€ä¸ªåç«¯ï¼Œè¯¥åç«¯å°†æä¾›ç”¨äºåˆ›å»ºä½œè€…å’Œä¹¦ç±çš„ CRUD API ä»¥åŠç”¨äºç”¨æˆ·ç®¡ç†å’Œèº«ä»½éªŒè¯çš„ APIã€‚\nSpring Security æ¶æ„æ¦‚è¿° åœ¨å¼€å§‹è‡ªå®šä¹‰é…ç½®ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆè®¨è®ºä¸€ä¸‹ Spring Security èº«ä»½éªŒè¯åœ¨å¹•åæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚\nä¸‹å›¾å±•ç¤ºäº†æµç¨‹å¹¶æ˜¾ç¤ºäº†å¦‚ä½•å¤„ç†èº«ä»½éªŒè¯è¯·æ±‚ï¼š\nç°åœ¨ï¼Œè®©æˆ‘ä»¬å°†æ­¤å›¾åˆ†è§£ä¸ºå¤šä¸ªç»„ä»¶å¹¶åˆ†åˆ«è®¨è®ºæ¯ä¸ªç»„ä»¶ã€‚\nSpring Security è¿‡æ»¤å™¨é“¾ å½“æ‚¨å°† Spring Security æ¡†æ¶æ·»åŠ åˆ°åº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨æ³¨å†Œä¸€ä¸ªè¿‡æ»¤å™¨é“¾æ¥æ‹¦æˆªæ‰€æœ‰ä¼ å…¥è¯·æ±‚ã€‚è¯¥é“¾ç”±å„ç§è¿‡æ»¤å™¨ç»„æˆï¼Œæ¯ä¸ªè¿‡æ»¤å™¨å¤„ç†ä¸€ä¸ªç‰¹å®šçš„ç”¨ä¾‹ã€‚\nä¾‹å¦‚ï¼š\næ ¹æ®é…ç½®æ£€æŸ¥è¯·æ±‚çš„ URL æ˜¯å¦å¯å…¬å¼€è®¿é—®ã€‚ å¦‚æœæ˜¯åŸºäºä¼šè¯çš„èº«ä»½éªŒè¯ï¼Œè¯·æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²åœ¨å½“å‰ä¼šè¯ä¸­é€šè¿‡èº«ä»½éªŒè¯ã€‚ æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æƒæ‰§è¡Œè¯·æ±‚çš„æ“ä½œï¼Œç­‰ç­‰ã€‚ æˆ‘æƒ³æåˆ°çš„ä¸€ä¸ªé‡è¦ç»†èŠ‚æ˜¯ Spring Security è¿‡æ»¤å™¨ä»¥æœ€ä½é¡ºåºæ³¨å†Œï¼Œå¹¶ä¸”æ˜¯ç¬¬ä¸€ä¸ªè¢«è°ƒç”¨çš„è¿‡æ»¤å™¨ã€‚å¯¹äºæŸäº›ç”¨ä¾‹ï¼Œå¦‚æœæ‚¨æƒ³å°†è‡ªå®šä¹‰è¿‡æ»¤å™¨æ”¾åœ¨å®ƒä»¬å‰é¢ï¼Œåˆ™éœ€è¦åœ¨å®ƒä»¬çš„é¡ºåºä¸­æ·»åŠ å¡«å……ã€‚è¿™å¯ä»¥é€šè¿‡ä»¥ä¸‹é…ç½®æ¥å®Œæˆï¼š\nspring.security.filter.order=10 ä¸€æ—¦æˆ‘ä»¬å°†æ­¤é…ç½®æ·»åŠ åˆ° application.properties æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨ Spring Security è¿‡æ»¤å™¨å‰é¢ç•™æœ‰ 10 ä¸ªè‡ªå®šä¹‰è¿‡æ»¤å™¨çš„ç©ºé—´ã€‚\nè®¤è¯ç®¡ç†å™¨ æ‚¨å¯ä»¥å°† AuthenticationManager è§†ä¸ºä¸€ä¸ªåè°ƒå™¨ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æ³¨å†Œå¤šä¸ªæä¾›ç¨‹åºï¼Œå¹¶ä¸”æ ¹æ®è¯·æ±‚ç±»å‹ï¼Œå®ƒå°†å‘æ­£ç¡®çš„æä¾›ç¨‹åºå‘é€èº«ä»½éªŒè¯è¯·æ±‚ã€‚\nè®¤è¯æä¾›è€… AuthenticationProvider å¤„ç†ç‰¹å®šç±»å‹çš„èº«ä»½éªŒè¯ã€‚å®ƒçš„æ¥å£åªå…¬å¼€ä¸¤ä¸ªå‡½æ•°ï¼š\nauthenticate å¯¹è¯·æ±‚æ‰§è¡Œèº«ä»½éªŒè¯ã€‚ supports æ£€æŸ¥æ­¤æä¾›ç¨‹åºæ˜¯å¦æ”¯æŒæŒ‡å®šçš„èº«ä»½éªŒè¯ç±»å‹ã€‚ æˆ‘ä»¬åœ¨ç¤ºä¾‹é¡¹ç›®ä¸­ä½¿ç”¨çš„æ¥å£çš„ä¸€ä¸ªé‡è¦å®ç°æ˜¯ DaoAuthenticationProvider ï¼Œå®ƒä» UserDetailsService æ£€ç´¢ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ã€‚\nUserDetailsService ç”¨æˆ·è¯¦æƒ…æœåŠ¡ UserDetailsService åœ¨ Spring æ–‡æ¡£ä¸­è¢«æè¿°ä¸ºåŠ è½½ç”¨æˆ·ç‰¹å®šæ•°æ®çš„æ ¸å¿ƒæ¥å£ã€‚\nåœ¨å¤§å¤šæ•°ç”¨ä¾‹ä¸­ï¼Œèº«ä»½éªŒè¯æä¾›ç¨‹åºæ ¹æ®æ•°æ®åº“ä¸­çš„å‡­æ®æå–ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼Œç„¶åæ‰§è¡ŒéªŒè¯ã€‚ç”±äºè¿™ä¸ªç”¨ä¾‹éå¸¸å¸¸è§ï¼ŒSpring å¼€å‘äººå‘˜å†³å®šå°†å…¶æå–ä¸ºä¸€ä¸ªå•ç‹¬çš„æ¥å£ï¼Œå…¬å¼€å•ä¸ªå‡½æ•°ï¼š\nloadUserByUsername æ¥å—ç”¨æˆ·åä½œä¸ºå‚æ•°å¹¶è¿”å›ç”¨æˆ·èº«ä»½å¯¹è±¡ã€‚ ä½¿ç”¨ JWT å’Œ Spring Security è¿›è¡Œèº«ä»½éªŒè¯ åœ¨è®¨è®ºäº† Spring Security æ¡†æ¶çš„å†…éƒ¨ç»“æ„ä¹‹åï¼Œè®©æˆ‘ä»¬å°†å…¶é…ç½®ä¸ºä½¿ç”¨ JWT ä»¤ç‰Œè¿›è¡Œæ— çŠ¶æ€èº«ä»½éªŒè¯ã€‚\nè¦è‡ªå®šä¹‰ Spring Security ä»¥ä¾› JWT ä½¿ç”¨ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç±»è·¯å¾„ä¸­ä½¿ç”¨ @EnableWebSecurity æ³¨é‡Šæ¥æ³¨é‡Šçš„é…ç½®ç±»ã€‚æ­¤å¤–ï¼Œä¸ºäº†ç®€åŒ–å®šåˆ¶è¿‡ç¨‹ï¼Œæ¡†æ¶å…¬å¼€äº†ä¸€ä¸ª WebSecurityConfigurerAdapter ç±»ã€‚æˆ‘ä»¬å°†æ‰©å±•æ­¤é€‚é…å™¨å¹¶è¦†ç›–å…¶ä¸¤ä¸ªåŠŸèƒ½ï¼Œä»¥ä¾¿ï¼š\nä½¿ç”¨æ­£ç¡®çš„æä¾›ç¨‹åºé…ç½®èº«ä»½éªŒè¯ç®¡ç†å™¨ é…ç½®ç½‘ç»œå®‰å…¨ï¼ˆå…¬å…± URLã€ç§æœ‰ URLã€æˆæƒç­‰ï¼‰ @EnableWebSecurity public class SecurityConfig extends WebSecurityConfigurerAdapter { @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception { // TODO configure authentication manager } @Override protected void configure(HttpSecurity http) throws Exception { // TODO configure web security } } åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å°†ç”¨æˆ·èº«ä»½å­˜å‚¨åœ¨ MongoDB æ•°æ®åº“çš„ users é›†åˆä¸­ã€‚è¿™äº›èº«ä»½ç”± User å®ä½“æ˜ å°„ï¼Œå®ƒä»¬çš„ CRUD æ“ä½œç”± UserRepo Spring Data å­˜å‚¨åº“å®šä¹‰ã€‚\nç°åœ¨ï¼Œå½“æˆ‘ä»¬æ¥å—èº«ä»½éªŒè¯è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨æä¾›çš„å‡­æ®ä»æ•°æ®åº“ä¸­æ£€ç´¢æ­£ç¡®çš„èº«ä»½ï¼Œç„¶åè¿›è¡ŒéªŒè¯ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å®ç° UserDetailsService æ¥å£ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š\npublic interface UserDetailsService { UserDetails loadUserByUsername(String username) throws UsernameNotFoundException; } åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°éœ€è¦è¿”å›å®ç° UserDetails æ¥å£çš„å¯¹è±¡ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„ User å®ä½“å®ç°äº†å®ƒï¼ˆæœ‰å…³å®ç°çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ç¤ºä¾‹é¡¹ç›®çš„å­˜å‚¨åº“ï¼‰ã€‚è€ƒè™‘åˆ°å®ƒä»…å…¬å¼€å•å‡½æ•°åŸå‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶è§†ä¸ºå‡½æ•°å¼æ¥å£ï¼Œå¹¶ä»¥ lambda è¡¨è¾¾å¼çš„å½¢å¼æä¾›å®ç°ã€‚\n@EnableWebSecurity public class SecurityConfig extends WebSecurityConfigurerAdapter { private final UserRepo userRepo; public SecurityConfig(UserRepo userRepo) { this.userRepo = userRepo; } @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception { auth.userDetailsService(username -\u0026gt; userRepo .findByUsername(username) .orElseThrow( () -\u0026gt; new UsernameNotFoundException( format(\u0026#34;User: %s, not found\u0026#34;, username) ) )); } // Details omitted for brevity } åœ¨è¿™é‡Œï¼Œ auth.userDetailsService å‡½æ•°è°ƒç”¨å°†ä½¿ç”¨æˆ‘ä»¬çš„ UserDetailsService æ¥å£å®ç°æ¥å¯åŠ¨ DaoAuthenticationProvider å®ä¾‹ï¼Œå¹¶å°†å…¶æ³¨å†Œåˆ°èº«ä»½éªŒè¯ç®¡ç†å™¨ä¸­ã€‚\né™¤äº†èº«ä»½éªŒè¯æä¾›ç¨‹åºä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä½¿ç”¨æ­£ç¡®çš„å¯†ç ç¼–ç æ¶æ„æ¥é…ç½®èº«ä»½éªŒè¯ç®¡ç†å™¨ï¼Œè¯¥æ¶æ„å°†ç”¨äºå‡­æ®éªŒè¯ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°† PasswordEncoder æ¥å£çš„é¦–é€‰å®ç°å…¬å¼€ä¸º beanã€‚\nåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ bcrypt å¯†ç å“ˆå¸Œç®—æ³•ã€‚\n@EnableWebSecurity public class SecurityConfig extends WebSecurityConfigurerAdapter { private final UserRepo userRepo; public SecurityConfig(UserRepo userRepo) { this.userRepo = userRepo; } @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception { auth.userDetailsService(username -\u0026gt; userRepo .findByUsername(username) .orElseThrow( () -\u0026gt; new UsernameNotFoundException( format(\u0026#34;User: %s, not found\u0026#34;, username) ) )); } @Bean public PasswordEncoder passwordEncoder() { return new BCryptPasswordEncoder(); } // Details omitted for brevity } é…ç½®èº«ä»½éªŒè¯ç®¡ç†å™¨åï¼Œæˆ‘ä»¬ç°åœ¨éœ€è¦é…ç½® Web å®‰å…¨æ€§ã€‚æˆ‘ä»¬æ­£åœ¨å®ç° REST APIï¼Œéœ€è¦ä½¿ç”¨ JWT ä»¤ç‰Œè¿›è¡Œæ— çŠ¶æ€èº«ä»½éªŒè¯ï¼›å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®ä»¥ä¸‹é€‰é¡¹ï¼š\nå¯ç”¨ CORS å¹¶ç¦ç”¨ CSRFã€‚ å°†ä¼šè¯ç®¡ç†è®¾ç½®ä¸ºæ— çŠ¶æ€ã€‚ è®¾ç½®æœªæˆæƒè¯·æ±‚å¼‚å¸¸å¤„ç†ç¨‹åºã€‚ è®¾ç½®ç«¯ç‚¹çš„æƒé™ã€‚ æ·»åŠ  JWT ä»¤ç‰Œè¿‡æ»¤å™¨ã€‚ è¯¥é…ç½®çš„å®ç°æ–¹å¼å¦‚ä¸‹ï¼š\n@EnableWebSecurity public class SecurityConfig extends WebSecurityConfigurerAdapter { private final UserRepo userRepo; private final JwtTokenFilter jwtTokenFilter; public SecurityConfig(UserRepo userRepo, JwtTokenFilter jwtTokenFilter) { this.userRepo = userRepo; this.jwtTokenFilter = jwtTokenFilter; } // Details omitted for brevity @Override protected void configure(HttpSecurity http) throws Exception { // Enable CORS and disable CSRF http = http.cors().and().csrf().disable(); // Set session management to stateless http = http .sessionManagement() .sessionCreationPolicy(SessionCreationPolicy.STATELESS) .and(); // Set unauthorized requests exception handler http = http .exceptionHandling() .authenticationEntryPoint( (request, response, ex) -\u0026gt; { response.sendError( HttpServletResponse.SC_UNAUTHORIZED, ex.getMessage() ); } ) .and(); // Set permissions on endpoints http.authorizeRequests() // Our public endpoints .antMatchers(\u0026#34;/api/public/**\u0026#34;).permitAll() .antMatchers(HttpMethod.GET, \u0026#34;/api/author/**\u0026#34;).permitAll() .antMatchers(HttpMethod.POST, \u0026#34;/api/author/search\u0026#34;).permitAll() .antMatchers(HttpMethod.GET, \u0026#34;/api/book/**\u0026#34;).permitAll() .antMatchers(HttpMethod.POST, \u0026#34;/api/book/search\u0026#34;).permitAll() // Our private endpoints .anyRequest().authenticated(); // Add JWT token filter http.addFilterBefore( jwtTokenFilter, UsernamePasswordAuthenticationFilter.class ); } // Used by Spring Security if CORS is enabled. @Bean public CorsFilter corsFilter() { UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource(); CorsConfiguration config = new CorsConfiguration(); config.setAllowCredentials(true); config.addAllowedOrigin(\u0026#34;*\u0026#34;); config.addAllowedHeader(\u0026#34;*\u0026#34;); config.addAllowedMethod(\u0026#34;*\u0026#34;); source.registerCorsConfiguration(\u0026#34;/**\u0026#34;, config); return new CorsFilter(source); } } è¯·æ³¨æ„ï¼Œæˆ‘ä»¬åœ¨ Spring Security å†…éƒ¨ UsernamePasswordAuthenticationFilter ä¹‹å‰æ·»åŠ äº† JwtTokenFilter ã€‚æˆ‘ä»¬è¿™æ ·åšæ˜¯å› ä¸ºæ­¤æ—¶æˆ‘ä»¬éœ€è¦è®¿é—®ç”¨æˆ·èº«ä»½æ¥æ‰§è¡Œèº«ä»½éªŒè¯/æˆæƒï¼Œå¹¶ä¸”å…¶æå–å‘ç”Ÿåœ¨åŸºäºæä¾›çš„ JWT ä»¤ç‰Œçš„ JWT ä»¤ç‰Œè¿‡æ»¤å™¨å†…ã€‚å…¶å®ç°æ–¹å¼å¦‚ä¸‹ï¼š\n@Component public class JwtTokenFilter extends OncePerRequestFilter { private final JwtTokenUtil jwtTokenUtil; private final UserRepo userRepo; public JwtTokenFilter(JwtTokenUtil jwtTokenUtil, UserRepo userRepo) { this.jwtTokenUtil = jwtTokenUtil; this.userRepo = userRepo; } @Override protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain chain) throws ServletException, IOException { // Get authorization header and validate final String header = request.getHeader(HttpHeaders.AUTHORIZATION); if (isEmpty(header) || !header.startsWith(\u0026#34;Bearer \u0026#34;)) { chain.doFilter(request, response); return; } // Get jwt token and validate final String token = header.split(\u0026#34; \u0026#34;)[1].trim(); if (!jwtTokenUtil.validate(token)) { chain.doFilter(request, response); return; } // Get user identity and set it on the spring security context UserDetails userDetails = userRepo .findByUsername(jwtTokenUtil.getUsername(token)) .orElse(null); UsernamePasswordAuthenticationToken authentication = new UsernamePasswordAuthenticationToken( userDetails, null, userDetails == null ? List.of() : userDetails.getAuthorities() ); authentication.setDetails( new WebAuthenticationDetailsSource().buildDetails(request) ); SecurityContextHolder.getContext().setAuthentication(authentication); chain.doFilter(request, response); } } åœ¨å®ç°æˆ‘ä»¬çš„ç™»å½• API åŠŸèƒ½ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ‰§è¡Œä¸€æ­¥ - æˆ‘ä»¬éœ€è¦è®¿é—®èº«ä»½éªŒè¯ç®¡ç†å™¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¸å¯å…¬å¼€è®¿é—®ï¼Œæˆ‘ä»¬éœ€è¦åœ¨é…ç½®ç±»ä¸­å°†å…¶æ˜¾å¼å…¬å¼€ä¸º beanã€‚ è¿™å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼å®Œæˆï¼š\n@EnableWebSecurity public class SecurityConfig extends WebSecurityConfigurerAdapter { // Details omitted for brevity @Override @Bean public AuthenticationManager authenticationManagerBean() throws Exception { return super.authenticationManagerBean(); } } ç°åœ¨ï¼Œæˆ‘ä»¬å‡†å¤‡å¥½å®ç°æˆ‘ä»¬çš„ç™»å½• API å‡½æ•°ï¼š\n@Api(tags = \u0026#34;Authentication\u0026#34;) @RestController @RequestMapping(path = \u0026#34;api/public\u0026#34;) public class AuthApi { private final AuthenticationManager authenticationManager; private final JwtTokenUtil jwtTokenUtil; private final UserViewMapper userViewMapper; public AuthApi(AuthenticationManager authenticationManager, JwtTokenUtil jwtTokenUtil, UserViewMapper userViewMapper) { this.authenticationManager = authenticationManager; this.jwtTokenUtil = jwtTokenUtil; this.userViewMapper = userViewMapper; } @PostMapping(\u0026#34;login\u0026#34;) public ResponseEntity\u0026lt;UserView\u0026gt; login(@RequestBody @Valid AuthRequest request) { try { Authentication authenticate = authenticationManager .authenticate( new UsernamePasswordAuthenticationToken( request.getUsername(), request.getPassword() ) ); User user = (User) authenticate.getPrincipal(); return ResponseEntity.ok() .header( HttpHeaders.AUTHORIZATION, jwtTokenUtil.generateAccessToken(user) ) .body(userViewMapper.toUserView(user)); } catch (BadCredentialsException ex) { return ResponseEntity.status(HttpStatus.UNAUTHORIZED).build(); } } } åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨èº«ä»½éªŒè¯ç®¡ç†å™¨éªŒè¯æä¾›çš„å‡­æ®ï¼Œå¦‚æœæˆåŠŸï¼Œæˆ‘ä»¬å°†ç”Ÿæˆ JWT ä»¤ç‰Œå¹¶å°†å…¶ä½œä¸ºå“åº”æ ‡å¤´ä¸å“åº”æ­£æ–‡ä¸­çš„ç”¨æˆ·èº«ä»½ä¿¡æ¯ä¸€èµ·è¿”å›ã€‚\nä½¿ç”¨ Spring Security è¿›è¡Œ JWT æˆæƒ åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®äº† Spring JWT èº«ä»½éªŒè¯è¿‡ç¨‹å¹¶é…ç½®äº†å…¬å…±/ç§æœ‰ URLã€‚å¯¹äºç®€å•çš„åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œè¿™å¯èƒ½å·²ç»è¶³å¤Ÿäº†ï¼Œä½†å¯¹äºå¤§å¤šæ•°å®é™…ç”¨ä¾‹ï¼Œæˆ‘ä»¬å§‹ç»ˆéœ€è¦ä¸ºç”¨æˆ·æä¾›åŸºäºè§’è‰²çš„è®¿é—®ç­–ç•¥ã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†è§£å†³è¿™ä¸ªé—®é¢˜å¹¶ä½¿ç”¨ Spring Security æ¡†æ¶å»ºç«‹åŸºäºè§’è‰²çš„æˆæƒæ¨¡å¼ã€‚\nåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä»¥ä¸‹ä¸‰ä¸ªè§’è‰²ï¼š\nUSER_ADMIN å…è®¸æˆ‘ä»¬ç®¡ç†åº”ç”¨ç¨‹åºç”¨æˆ·ã€‚ AUTHOR_ADMIN å…è®¸æˆ‘ä»¬ç®¡ç†ä½œè€…ã€‚ BOOK_ADMIN å…è®¸æˆ‘ä»¬ç®¡ç†ä¹¦ç±ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒä»¬åº”ç”¨åˆ°ç›¸åº”çš„ URLï¼š\napi/public å¯å…¬å¼€è®¿é—®ã€‚ api/admin/user å¯ä»¥è®¿é—®å…·æœ‰ USER_ADMIN è§’è‰²çš„ç”¨æˆ·ã€‚ api/author å¯ä»¥è®¿é—®å…·æœ‰ AUTHOR_ADMIN è§’è‰²çš„ç”¨æˆ·ã€‚ api/book å¯ä»¥è®¿é—®å…·æœ‰ BOOK_ADMIN è§’è‰²çš„ç”¨æˆ·ã€‚ Spring Security æ¡†æ¶ä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ç§è®¾ç½®æˆæƒæ¨¡å¼çš„é€‰é¡¹ï¼š\nåŸºäº URL çš„é…ç½® åŸºäºæ³¨é‡Šçš„é…ç½® é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹çœ‹åŸºäº URL çš„é…ç½®æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚å®ƒå¯ä»¥åº”ç”¨åˆ° Web å®‰å…¨é…ç½®ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n@EnableWebSecurity public class SecurityConfig extends WebSecurityConfigurerAdapter { // Details omitted for brevity @Override protected void configure(HttpSecurity http) throws Exception { // Enable CORS and disable CSRF http = http.cors().and().csrf().disable(); // Set session management to stateless http = http .sessionManagement() .sessionCreationPolicy(SessionCreationPolicy.STATELESS) .and(); // Set unauthorized requests exception handler http = http .exceptionHandling() .authenticationEntryPoint( (request, response, ex) -\u0026gt; { response.sendError( HttpServletResponse.SC_UNAUTHORIZED, ex.getMessage() ); } ) .and(); // Set permissions on endpoints http.authorizeRequests() // Our public endpoints .antMatchers(\u0026#34;/api/public/**\u0026#34;).permitAll() .antMatchers(HttpMethod.GET, \u0026#34;/api/author/**\u0026#34;).permitAll() .antMatchers(HttpMethod.POST, \u0026#34;/api/author/search\u0026#34;).permitAll() .antMatchers(HttpMethod.GET, \u0026#34;/api/book/**\u0026#34;).permitAll() .antMatchers(HttpMethod.POST, \u0026#34;/api/book/search\u0026#34;).permitAll() // Our private endpoints .antMatchers(\u0026#34;/api/admin/user/**\u0026#34;).hasRole(Role.USER_ADMIN) .antMatchers(\u0026#34;/api/author/**\u0026#34;).hasRole(Role.AUTHOR_ADMIN) .antMatchers(\u0026#34;/api/book/**\u0026#34;).hasRole(Role.BOOK_ADMIN) .anyRequest().authenticated(); // Add JWT token filter http.addFilterBefore( jwtTokenFilter, UsernamePasswordAuthenticationFilter.class ); } // Details omitted for brevity } æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œè¿™ç§æ–¹æ³•ç®€å•æ˜äº†ï¼Œä½†æœ‰ä¸€ä¸ªç¼ºç‚¹ã€‚æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­çš„æˆæƒæ¨¡å¼å¯èƒ½å¾ˆå¤æ‚ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ä¸€ä¸ªåœ°æ–¹å®šä¹‰æ‰€æœ‰è§„åˆ™ï¼Œå®ƒå°†å˜å¾—éå¸¸å¤§ã€å¤æ‚ä¸”éš¾ä»¥é˜…è¯»ã€‚å› æ­¤ï¼Œæˆ‘é€šå¸¸æ›´å–œæ¬¢ä½¿ç”¨åŸºäºæ³¨é‡Šçš„é…ç½®ã€‚\nSpring Security æ¡†æ¶ä¸º Web å®‰å…¨å®šä¹‰äº†ä»¥ä¸‹æ³¨é‡Šï¼š\n@PreAuthorize æ”¯æŒ Spring è¡¨è¾¾å¼è¯­è¨€ï¼Œç”¨äºåœ¨æ‰§è¡Œæ–¹æ³•ä¹‹å‰æä¾›åŸºäºè¡¨è¾¾å¼çš„è®¿é—®æ§åˆ¶ã€‚ @PostAuthorize æ”¯æŒ Spring è¡¨è¾¾å¼è¯­è¨€ï¼Œç”¨äºåœ¨æ‰§è¡Œæ–¹æ³•åæä¾›åŸºäºè¡¨è¾¾å¼çš„è®¿é—®æ§åˆ¶ï¼ˆæä¾›è®¿é—®æ–¹æ³•ç»“æœçš„èƒ½åŠ›ï¼‰ã€‚ @PreFilter æ”¯æŒ Spring è¡¨è¾¾å¼è¯­è¨€ï¼Œç”¨äºåœ¨æ ¹æ®æˆ‘ä»¬å®šä¹‰çš„è‡ªå®šä¹‰å®‰å…¨è§„åˆ™æ‰§è¡Œæ–¹æ³•ä¹‹å‰è¿‡æ»¤é›†åˆæˆ–æ•°ç»„ã€‚ @PostFilter æ”¯æŒ Spring è¡¨è¾¾å¼è¯­è¨€ï¼Œç”¨äºæ ¹æ®æˆ‘ä»¬å®šä¹‰çš„è‡ªå®šä¹‰å®‰å…¨è§„åˆ™è¿‡æ»¤æ‰§è¡Œæ–¹æ³•åè¿”å›çš„é›†åˆæˆ–æ•°ç»„ï¼ˆæä¾›è®¿é—®æ–¹æ³•ç»“æœçš„èƒ½åŠ›ï¼‰ã€‚ @Secured ä¸æ”¯æŒ Spring è¡¨è¾¾å¼è¯­è¨€ï¼Œç”¨äºæŒ‡å®šæ–¹æ³•ä¸Šçš„è§’è‰²åˆ—è¡¨ã€‚ @RolesAllowed ä¸æ”¯æŒ Spring è¡¨è¾¾å¼è¯­è¨€ï¼Œæ˜¯ JSR 250 ä¸­ @Secured æ³¨é‡Šçš„ç­‰æ•ˆæ³¨é‡Šã€‚ è¿™äº›æ³¨é‡Šé»˜è®¤æƒ…å†µä¸‹å¤„äºç¦ç”¨çŠ¶æ€ï¼Œå¯ä»¥åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­å¯ç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n@EnableWebSecurity @EnableGlobalMethodSecurity( securedEnabled = true, jsr250Enabled = true, prePostEnabled = true ) public class SecurityConfig extends WebSecurityConfigurerAdapter { // Details omitted for brevity } securedEnabled = true å¯ç”¨ @Secured æ³¨é‡Šã€‚ jsr250Enabled = true å¯ç”¨ @RolesAllowed æ³¨é‡Šã€‚ prePostEnabled = true å¯ç”¨ @PreAuthorize ã€ @PostAuthorize ã€ @PreFilter ã€ @PostFilter æ³¨é‡Šã€‚\nå¯ç”¨å®ƒä»¬åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ API ç«¯ç‚¹ä¸Šå¼ºåˆ¶æ‰§è¡ŒåŸºäºè§’è‰²çš„è®¿é—®ç­–ç•¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n@Api(tags = \u0026#34;UserAdmin\u0026#34;) @RestController @RequestMapping(path = \u0026#34;api/admin/user\u0026#34;) @RolesAllowed(Role.USER_ADMIN) public class UserAdminApi { // Details omitted for brevity } @Api(tags = \u0026#34;Author\u0026#34;) @RestController @RequestMapping(path = \u0026#34;api/author\u0026#34;) public class AuthorApi { // Details omitted for brevity @RolesAllowed(Role.AUTHOR_ADMIN) @PostMapping public void create() { } @RolesAllowed(Role.AUTHOR_ADMIN) @PutMapping(\u0026#34;{id}\u0026#34;) public void edit() { } @RolesAllowed(Role.AUTHOR_ADMIN) @DeleteMapping(\u0026#34;{id}\u0026#34;) public void delete() { } @GetMapping(\u0026#34;{id}\u0026#34;) public void get() { } @GetMapping(\u0026#34;{id}/book\u0026#34;) public void getBooks() { } @PostMapping(\u0026#34;search\u0026#34;) public void search() { } } @Api(tags = \u0026#34;Book\u0026#34;) @RestController @RequestMapping(path = \u0026#34;api/book\u0026#34;) public class BookApi { // Details omitted for brevity @RolesAllowed(Role.BOOK_ADMIN) @PostMapping public BookView create() { } @RolesAllowed(Role.BOOK_ADMIN) @PutMapping(\u0026#34;{id}\u0026#34;) public void edit() { } @RolesAllowed(Role.BOOK_ADMIN) @DeleteMapping(\u0026#34;{id}\u0026#34;) public void delete() { } @GetMapping(\u0026#34;{id}\u0026#34;) public void get() { } @GetMapping(\u0026#34;{id}/author\u0026#34;) public void getAuthors() { } @PostMapping(\u0026#34;search\u0026#34;) public void search() { } } è¯·æ³¨æ„ï¼Œå®‰å…¨æ³¨é‡Šå¯ä»¥åœ¨ç±»çº§åˆ«å’Œæ–¹æ³•çº§åˆ«ä¸Šæä¾›ã€‚\næ¼”ç¤ºçš„ç¤ºä¾‹å¾ˆç®€å•ï¼Œå¹¶ä¸ä»£è¡¨çœŸå®åœºæ™¯ï¼Œä½† Spring Security æä¾›äº†ä¸€ç»„ä¸°å¯Œçš„æ³¨é‡Šï¼Œå¦‚æœæ‚¨é€‰æ‹©ä½¿ç”¨å®ƒä»¬ï¼Œæ‚¨å¯ä»¥å¤„ç†å¤æ‚çš„æˆæƒæ¨¡å¼ã€‚\nè§’è‰²åç§°é»˜è®¤å‰ç¼€ åœ¨è¿™ä¸ªå•ç‹¬çš„å°èŠ‚ä¸­ï¼Œæˆ‘æƒ³å¼ºè°ƒä¸€ä¸ªè®©å¾ˆå¤šæ–°ç”¨æˆ·æ„Ÿåˆ°å›°æƒ‘çš„æ›´å¾®å¦™çš„ç»†èŠ‚ã€‚\nSpring Security æ¡†æ¶åŒºåˆ†ä¸¤ä¸ªæœ¯è¯­ï¼š\nAuthority ä»£è¡¨ä¸ªäººæƒé™ã€‚ Role ä»£è¡¨ä¸€ç»„æƒé™ã€‚ ä¸¤è€…éƒ½å¯ä»¥ç”¨ä¸€ä¸ªåä¸º GrantedAuthority çš„æ¥å£æ¥è¡¨ç¤ºï¼Œç„¶åä½¿ç”¨ Spring Security æ³¨é‡Šä¸­çš„ Spring è¡¨è¾¾å¼è¯­è¨€è¿›è¡Œæ£€æŸ¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nAuthority: @PreAuthorize(â€œhasAuthority(â€˜EDIT_BOOKâ€™)â€) Role: @PreAuthorize(â€œhasRole(â€˜BOOK_ADMINâ€™)â€) ä¸ºäº†ä½¿è¿™ä¸¤ä¸ªæœ¯è¯­ä¹‹é—´çš„åŒºåˆ«æ›´åŠ æ˜ç¡®ï¼ŒSpring Security æ¡†æ¶é»˜è®¤åœ¨è§’è‰²åç§°ä¸­æ·»åŠ  ROLE_ å‰ç¼€ã€‚å› æ­¤ï¼Œå®ƒä¸ä¼šæ£€æŸ¥åä¸º BOOK_ADMIN çš„è§’è‰²ï¼Œè€Œæ˜¯æ£€æŸ¥ ROLE_BOOK_ADMIN ã€‚\nå°±æˆ‘ä¸ªäººè€Œè¨€ï¼Œæˆ‘å‘ç°è¿™ç§è¡Œä¸ºä»¤äººå›°æƒ‘ï¼Œå¹¶ä¸”æ›´å–œæ¬¢åœ¨æˆ‘çš„åº”ç”¨ç¨‹åºä¸­ç¦ç”¨å®ƒã€‚å¯ä»¥åœ¨ Spring Security é…ç½®ä¸­ç¦ç”¨å®ƒï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n@EnableWebSecurity public class SecurityConfig extends WebSecurityConfigurerAdapter { // Details omitted for brevity @Bean GrantedAuthorityDefaults grantedAuthorityDefaults() { return new GrantedAuthorityDefaults(\u0026#34;\u0026#34;); // Remove the ROLE_ prefix } } æµ‹è¯•æˆ‘ä»¬çš„ Spring Security JWT è§£å†³æ–¹æ¡ˆ è¦åœ¨ä½¿ç”¨ Spring Security æ¡†æ¶æ—¶é€šè¿‡å•å…ƒæµ‹è¯•æˆ–é›†æˆæµ‹è¯•æ¥æµ‹è¯•ç«¯ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ  spring-security-test ä¾èµ–é¡¹ä»¥åŠ spring-boot-starter-test ã€‚æˆ‘ä»¬çš„ pom.xml æ„å»ºæ–‡ä»¶å°†å¦‚ä¸‹æ‰€ç¤ºï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-test\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;exclusions\u0026gt; \u0026lt;exclusion\u0026gt; \u0026lt;groupId\u0026gt;org.junit.vintage\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;junit-vintage-engine\u0026lt;/artifactId\u0026gt; \u0026lt;/exclusion\u0026gt; \u0026lt;/exclusions\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.security\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-security-test\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; è¿™ç§ä¾èµ–å…³ç³»ä½¿æˆ‘ä»¬èƒ½å¤Ÿè®¿é—®ä¸€äº›æ³¨é‡Šï¼Œè¿™äº›æ³¨é‡Šå¯ç”¨äºå‘æˆ‘ä»¬çš„æµ‹è¯•å‡½æ•°æ·»åŠ å®‰å…¨ä¸Šä¸‹æ–‡ã€‚\nThese annotations are: è¿™äº›æ³¨é‡Šæ˜¯ï¼š\n@WithMockUser å¯ä»¥æ·»åŠ åˆ°æµ‹è¯•æ–¹æ³•ä¸­ä»¥æ¨¡æ‹Ÿä½¿ç”¨æ¨¡æ‹Ÿç”¨æˆ·è¿è¡Œã€‚ @WithUserDetails å¯ä»¥æ·»åŠ åˆ°æµ‹è¯•æ–¹æ³•ä¸­ï¼Œä»¥æ¨¡æ‹Ÿä½¿ç”¨ä» UserDetailsService è¿”å›çš„ UserDetails è¿è¡Œã€‚ @WithAnonymousUser å¯ä»¥æ·»åŠ åˆ°æµ‹è¯•æ–¹æ³•ä¸­ä»¥æ¨¡æ‹ŸåŒ¿åç”¨æˆ·çš„è¿è¡Œã€‚å½“ç”¨æˆ·æƒ³è¦ä»¥ç‰¹å®šç”¨æˆ·èº«ä»½è¿è¡Œå¤§éƒ¨åˆ†æµ‹è¯•å¹¶è¦†ç›–ä¸€äº›åŒ¿åæ–¹æ³•æ—¶ï¼Œè¿™éå¸¸æœ‰ç”¨ã€‚ @WithSecurityContext å†³å®šä½¿ç”¨ä»€ä¹ˆ SecurityContext ï¼Œä¸Šé¢æè¿°çš„æ‰€æœ‰ä¸‰ä¸ªæ³¨é‡Šéƒ½åŸºäºå®ƒã€‚å¦‚æœæˆ‘ä»¬æœ‰ç‰¹å®šçš„ç”¨ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºè‡ªå·±çš„æ³¨é‡Šï¼Œä½¿ç”¨ @WithSecurityContext æ¥åˆ›å»ºæˆ‘ä»¬æƒ³è¦çš„ä»»ä½• SecurityContext ã€‚å®ƒçš„è®¨è®ºè¶…å‡ºäº†æˆ‘ä»¬çš„ Spring Security æ•™ç¨‹çš„èŒƒå›´ï¼Œè¯·å‚é˜… Spring Security æ–‡æ¡£ä»¥è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚ å¯¹ç‰¹å®šç”¨æˆ·è¿è¡Œæµ‹è¯•çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨ @WithMockUser æ³¨é‡Šã€‚æˆ‘ä»¬å¯ä»¥ç”¨å®ƒåˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿç”¨æˆ·å¹¶è¿è¡Œæµ‹è¯•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n@Test @WithMockUser(username=\u0026#34;customUsername@example.io\u0026#34;, roles={\u0026#34;USER_ADMIN\u0026#34;}) public void test() { // Details omitted for brevity } ä¸è¿‡ï¼Œè¿™ç§æ–¹æ³•æœ‰ä¸€äº›ç¼ºç‚¹ã€‚é¦–å…ˆï¼Œæ¨¡æ‹Ÿç”¨æˆ·ä¸å­˜åœ¨ï¼Œå¦‚æœè¿è¡Œé›†æˆæµ‹è¯•ï¼Œç¨åä»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œæµ‹è¯•å°†å¤±è´¥ã€‚å…¶æ¬¡ï¼Œmock user æ˜¯ org.springframework.security.core.userdetails.User ç±»çš„å®ä¾‹ï¼Œå®ƒæ˜¯ Spring æ¡†æ¶å¯¹ UserDetails æ¥å£çš„å†…éƒ¨å®ç°ï¼Œå¦‚æœæˆ‘ä»¬æœ‰è‡ªå·±çš„å®ç°ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´åé¢çš„å†²çªï¼Œåœ¨æµ‹è¯•æ‰§è¡ŒæœŸé—´ã€‚\nå¦‚æœå‰é¢çš„ç¼ºç‚¹é˜»ç¢äº†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆ @WithUserDetails æ³¨é‡Šå°±æ˜¯æ­£ç¡®çš„é€‰æ‹©ã€‚å½“æˆ‘ä»¬æœ‰è‡ªå®šä¹‰ UserDetails å’Œ UserDetailsService å®ç°æ—¶ä½¿ç”¨å®ƒã€‚å®ƒå‡è®¾ç”¨æˆ·å­˜åœ¨ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»åœ¨æ•°æ®åº“ä¸­åˆ›å»ºå®é™…è¡Œæˆ–åœ¨è¿è¡Œæµ‹è¯•ä¹‹å‰æä¾› UserDetailsService æ¨¡æ‹Ÿå®ä¾‹ã€‚\næˆ‘ä»¬å¯ä»¥è¿™æ ·ä½¿ç”¨è¿™ä¸ªæ³¨è§£ï¼š\n@Test @WithUserDetails(\u0026#34;customUsername@example.io\u0026#34;) public void test() { // Details omitted for brevity } è¿™æ˜¯æˆ‘ä»¬ç¤ºä¾‹é¡¹ç›®é›†æˆæµ‹è¯•ä¸­çš„é¦–é€‰æ³¨é‡Šï¼Œå› ä¸ºæˆ‘ä»¬æœ‰ä¸Šè¿°æ¥å£çš„è‡ªå®šä¹‰å®ç°ã€‚\nä½¿ç”¨ @WithAnonymousUser å…è®¸ä»¥åŒ¿åç”¨æˆ·èº«ä»½è¿è¡Œã€‚å½“æ‚¨å¸Œæœ›ä½¿ç”¨ç‰¹å®šç”¨æˆ·è¿è¡Œå¤§å¤šæ•°æµ‹è¯•ä½†ä»¥åŒ¿åç”¨æˆ·èº«ä»½è¿è¡Œä¸€äº›æµ‹è¯•æ—¶ï¼Œè¿™å°¤å…¶æ–¹ä¾¿ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹å°†ä½¿ç”¨æ¨¡æ‹Ÿç”¨æˆ·è¿è¡Œ test1 å’Œ test2 æµ‹è¯•ç”¨ä¾‹ï¼Œå¹¶ä½¿ç”¨åŒ¿åç”¨æˆ·è¿è¡Œ test3ï¼š\n@SpringBootTest @AutoConfigureMockMvc @WithMockUser public class WithUserClassLevelAuthenticationTests { @Test public void test1() { // Details omitted for brevity } @Test public void test2() { // Details omitted for brevity } @Test @WithAnonymousUser public void test3() throws Exception { // Details omitted for brevity } } å¾æœ Spring Security JWT å­¦ä¹ æ›²çº¿ æœ€åï¼Œæˆ‘æƒ³æä¸€ä¸‹ï¼ŒSpring Security æ¡†æ¶å¯èƒ½ä¸ä¼šèµ¢å¾—ä»»ä½•é€‰ç¾æ¯”èµ›ï¼Œè€Œä¸”å®ƒçš„å­¦ä¹ æ›²çº¿è‚¯å®šå¾ˆé™¡å³­ã€‚æˆ‘é‡åˆ°è¿‡å¾ˆå¤šæƒ…å†µï¼Œç”±äºå…¶åˆå§‹é…ç½®çš„å¤æ‚æ€§ï¼Œå®ƒè¢«ä¸€äº›è‡ªè¡Œå¼€å‘çš„è§£å†³æ–¹æ¡ˆæ‰€å–ä»£ã€‚ä½†æ˜¯ï¼Œä¸€æ—¦å¼€å‘äººå‘˜äº†è§£å…¶å†…éƒ¨ç»“æ„å¹¶è®¾æ³•è®¾ç½®åˆå§‹é…ç½®ï¼Œå®ƒçš„ä½¿ç”¨å°±ä¼šå˜å¾—ç›¸å¯¹ç®€å•ã€‚\nåœ¨æœ¬ Spring Security æ•™ç¨‹ä¸­ï¼Œæˆ‘å°è¯•æ¼”ç¤ºé…ç½®çš„æ‰€æœ‰å¾®å¦™ç»†èŠ‚ï¼Œå¸Œæœ›æ‚¨ä¼šå‘ç°è¿™äº›ç¤ºä¾‹å¾ˆæœ‰ç”¨ã€‚æœ‰å…³å®Œæ•´çš„ä»£ç ç¤ºä¾‹ï¼Œè¯·å‚é˜…æˆ‘çš„ç¤ºä¾‹ Spring Security é¡¹ç›®çš„ Git å­˜å‚¨åº“ã€‚\nåŸæ–‡é“¾æ¥ï¼šhttps://www.toptal.com/spring/spring-security-tutorial\n","permalink":"https://blog.chensoul.cc/posts/2023/09/19/spring-security-tutorial/","summary":"å…è´£å£°æ˜ï¼šSpring Security 5+ å·²å‘å¸ƒ OAuth JWT æ”¯æŒã€‚å»ºè®®ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ OAuth æ¥æ”¯æŒ JWTï¼Œè€Œä¸æ˜¯ä½¿ç”¨è‡ªå®šä¹‰å®‰å…¨æ€§æˆ–è¿‡æ»¤å™¨ã€‚\nSpring è¢«è®¤ä¸ºæ˜¯ Java ç”Ÿæ€ç³»ç»Ÿä¸­å€¼å¾—ä¿¡èµ–çš„æ¡†æ¶ï¼Œå¹¶ä¸”è¢«å¹¿æ³›ä½¿ç”¨ã€‚å°† Spring ç§°ä¸ºæ¡†æ¶ä¸å†æœ‰æ•ˆï¼Œå› ä¸ºå®ƒæ›´å¤šçš„æ˜¯æ¶µç›–å„ç§æ¡†æ¶çš„æ€»æ‹¬æœ¯è¯­ã€‚å…¶ä¸­ä¸€ä¸ªæ¡†æ¶æ˜¯ Spring Securityï¼Œå®ƒæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”å¯å®šåˆ¶çš„èº«ä»½éªŒè¯å’Œæˆæƒæ¡†æ¶ã€‚å®ƒè¢«è®¤ä¸ºæ˜¯ä¿æŠ¤åŸºäº Spring çš„åº”ç”¨ç¨‹åºçš„äº‹å®æ ‡å‡†ï¼Œå› æ­¤ï¼Œå¦‚æœæ‚¨å¸Œæœ›å®ç° Spring JWT ä»¤ç‰Œè§£å†³æ–¹æ¡ˆï¼Œé‚£ä¹ˆå°†å…¶åŸºäº Spring Security æ˜¯æœ‰æ„ä¹‰çš„ã€‚\nå°½ç®¡å®ƒå¾ˆå—æ¬¢è¿ï¼Œä½†æˆ‘å¿…é¡»æ‰¿è®¤ï¼Œå½“æ¶‰åŠåˆ°å•é¡µåº”ç”¨ç¨‹åºæ—¶ï¼ŒSpring çš„é…ç½®å¹¶ä¸ç®€å•å’Œç›´æ¥ã€‚æˆ‘æ€€ç–‘åŸå› æ˜¯å®ƒæ›´å¤šåœ°æ˜¯ä½œä¸ºä¸€ä¸ªé¢å‘åº”ç”¨ç¨‹åºçš„ MVC æ¡†æ¶å¼€å§‹çš„ï¼Œå…¶ä¸­ç½‘é¡µæ¸²æŸ“å‘ç”Ÿåœ¨æœåŠ¡å™¨ç«¯ï¼Œå¹¶ä¸”é€šä¿¡æ˜¯åŸºäºä¼šè¯çš„ã€‚\nå¦‚æœåç«¯åŸºäº Java å’Œ Springï¼Œé‚£ä¹ˆä½¿ç”¨ Spring Security å’Œ JWT è¿›è¡Œèº«ä»½éªŒè¯/æˆæƒå¹¶å°†å…¶é…ç½®ä¸ºæ— çŠ¶æ€é€šä¿¡æ˜¯æœ‰æ„ä¹‰çš„ã€‚è™½ç„¶æœ‰å¾ˆå¤šæ–‡ç« è§£é‡Šäº†è¿™æ˜¯å¦‚ä½•å®Œæˆçš„ï¼Œä½†å¯¹æˆ‘æ¥è¯´ï¼Œç¬¬ä¸€æ¬¡è®¾ç½®å®ƒä»ç„¶ä»¤äººæ²®ä¸§ï¼Œæˆ‘å¿…é¡»é˜…è¯»å¹¶æ€»ç»“æ¥è‡ªå¤šä¸ªæ¥æºçš„ä¿¡æ¯ã€‚è¿™å°±æ˜¯æˆ‘å†³å®šç¼–å†™è¿™ä¸ª Spring Security æ•™ç¨‹çš„åŸå› ï¼Œæˆ‘å°†åœ¨å…¶ä¸­å°è¯•æ€»ç»“å¹¶æ¶µç›–æ‚¨åœ¨é…ç½®è¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°çš„æ‰€æœ‰å¿…éœ€çš„å¾®å¦™ç»†èŠ‚å’Œç¼ºé™·ã€‚\næœ¯è¯­å®šä¹‰ åœ¨æ·±å…¥æ¢è®¨æŠ€æœ¯ç»†èŠ‚ä¹‹å‰ï¼Œæˆ‘æƒ³æ˜ç¡®å®šä¹‰ Spring Security ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨çš„æœ¯è¯­ï¼Œä»¥ç¡®ä¿æˆ‘ä»¬éƒ½ä½¿ç”¨ç›¸åŒçš„è¯­è¨€ã€‚ è¿™äº›æ˜¯æˆ‘ä»¬éœ€è¦è§£å†³çš„æœ¯è¯­ï¼š\nAuthentication éªŒè¯æ˜¯æŒ‡æ ¹æ®æä¾›çš„å‡­æ®éªŒè¯ç”¨æˆ·èº«ä»½çš„è¿‡ç¨‹ã€‚ä¸€ä¸ªå¸¸è§çš„ç¤ºä¾‹æ˜¯åœ¨ç™»å½•ç½‘ç«™æ—¶è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚æ‚¨å¯ä»¥å°†å…¶è§†ä¸ºå¯¹â€œæ‚¨æ˜¯è°ï¼Ÿâ€è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆã€‚ Authorization æˆæƒæ˜¯æŒ‡å‡è®¾ç”¨æˆ·å·²æˆåŠŸé€šè¿‡èº«ä»½éªŒè¯ï¼Œåˆ™ç¡®å®šç”¨æˆ·æ˜¯å¦å…·æœ‰æ‰§è¡Œç‰¹å®šæ“ä½œæˆ–è¯»å–ç‰¹å®šæ•°æ®çš„é€‚å½“æƒé™çš„è¿‡ç¨‹ã€‚æ‚¨å¯ä»¥å°†å…¶è§†ä¸ºâ€œç”¨æˆ·å¯ä»¥æ‰§è¡Œ/é˜…è¯»æ­¤æ“ä½œå—ï¼Ÿâ€é—®é¢˜çš„ç­”æ¡ˆã€‚ Principle åŸåˆ™æ˜¯æŒ‡å½“å‰ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ã€‚ Granted authority æˆäºˆæƒé™æ˜¯æŒ‡ç»è¿‡è®¤è¯çš„ç”¨æˆ·çš„æƒé™ã€‚ Role è§’è‰²æ˜¯æŒ‡ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·çš„ä¸€ç»„æƒé™ã€‚ åˆ›å»ºåŸºæœ¬çš„ Spring åº”ç”¨ç¨‹åº åœ¨å¼€å§‹é…ç½® Spring Security æ¡†æ¶ä¹‹å‰ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„ Spring Web åº”ç”¨ç¨‹åºã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Spring Initializr å¹¶ç”Ÿæˆä¸€ä¸ªæ¨¡æ¿é¡¹ç›®ã€‚å¯¹äºä¸€ä¸ªç®€å•çš„ Web åº”ç”¨ç¨‹åºï¼Œåªéœ€è¦ Spring Web æ¡†æ¶ä¾èµ–å°±è¶³å¤Ÿäº†ï¼š\n\u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; åˆ›å»ºé¡¹ç›®åï¼Œæˆ‘ä»¬å¯ä»¥å‘å…¶ä¸­æ·»åŠ ä¸€ä¸ªç®€å•çš„ REST æ§åˆ¶å™¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n@RestController @RequestMapping(\u0026#34;hello\u0026#34;) public class HelloRestController { @GetMapping(\u0026#34;user\u0026#34;) public String helloUser() { return \u0026#34;Hello User\u0026#34;; } @GetMapping(\u0026#34;admin\u0026#34;) public String helloAdmin() { return \u0026#34;Hello Admin\u0026#34;; } } ä¹‹åï¼Œå¦‚æœæˆ‘ä»¬æ„å»ºå¹¶è¿è¡Œè¯¥é¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Web æµè§ˆå™¨ä¸­è®¿é—®ä»¥ä¸‹ URLï¼š","title":"[è¯‘]Spring Security ä¸ JWT for REST API"},{"content":"æœ¬æ–‡ä¸»è¦ä»‹ç» Builder æ„é€ å™¨æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nä»‹ç» æ„é€ å™¨æ¨¡å¼ï¼ˆBuilder Patternï¼‰æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œç”¨äºå°†å¤æ‚å¯¹è±¡çš„æ„å»ºè¿‡ç¨‹ä¸å…¶è¡¨ç¤ºåˆ†ç¦»ï¼Œä»è€Œå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ„å»ºè¿‡ç¨‹åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚\nåœ¨æ„é€ å™¨æ¨¡å¼ä¸­ï¼Œé€šå¸¸æœ‰ä¸¤ä¸ªä¸»è¦è§’è‰²ï¼šäº§å“ï¼ˆProductï¼‰å’Œå»ºé€ è€…ï¼ˆBuilderï¼‰ã€‚äº§å“æ˜¯æœ€ç»ˆæ„å»ºçš„å¯¹è±¡ï¼Œè€Œå»ºé€ è€…è´Ÿè´£æ„å»ºäº§å“ã€‚\nä»¥ä¸‹æ˜¯æ„é€ å™¨æ¨¡å¼çš„ç±»å›¾ç¤ºä¾‹ï¼š\n+-------------------+ +----------------------+ | Director | | Builder | +-------------------+ +----------------------+ | construct() | | buildPartA() | | | | buildPartB() | +-------------------+ | getResult() | +----------+-----------+ | v +----------+-----------+ | Product | +----------------------+ | partA | | partB | +----------------------+ åœ¨ä¸Šè¿°ç±»å›¾ä¸­ï¼ŒDirectorï¼ˆæŒ‡å¯¼è€…ï¼‰è´Ÿè´£å®šä¹‰æ„å»ºäº§å“çš„é¡ºåºå’Œæ–¹å¼ï¼Œè€ŒBuilderï¼ˆå»ºé€ è€…ï¼‰è´Ÿè´£å®é™…æ„å»ºäº§å“çš„å…·ä½“æ­¥éª¤ã€‚Productï¼ˆäº§å“ï¼‰æ˜¯æœ€ç»ˆæ„å»ºçš„å¯¹è±¡ã€‚\nä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨æ„é€ å™¨æ¨¡å¼åˆ›å»ºä¸€ä¸ªè§’è‰²ç”Ÿæˆå™¨çš„ä¾‹å­ï¼š\n// äº§å“ç±» public class Character { private String profession; private String name; private String hairColor; private String weapon; // æ„é€ å™¨ç§æœ‰åŒ–ï¼Œåªèƒ½é€šè¿‡å»ºé€ è€…åˆ›å»ºå¯¹è±¡ private Character() {} // Getters public String getProfession() { return profession; } public String getName() { return name; } public String getHairColor() { return hairColor; } public String getWeapon() { return weapon; } // å»ºé€ è€…ç±» public static class CharacterBuilder { private Character character; public CharacterBuilder() { character = new Character(); } public CharacterBuilder withProfession(String profession) { character.profession = profession; return this; } public CharacterBuilder withName(String name) { character.name = name; return this; } public CharacterBuilder withHairColor(String hairColor) { character.hairColor = hairColor; return this; } public CharacterBuilder withWeapon(String weapon) { character.weapon = weapon; return this; } public Character build() { return character; } } } // ä½¿ç”¨ç¤ºä¾‹ public class BuilderExample { public static void main(String[] args) { Character character = new Character.CharacterBuilder() .withProfession(\u0026#34;Warrior\u0026#34;) .withName(\u0026#34;Conan\u0026#34;) .withHairColor(\u0026#34;Black\u0026#34;) .withWeapon(\u0026#34;Sword\u0026#34;) .build(); System.out.println(character.getProfession()); // è¾“å‡ºï¼šWarrior System.out.println(character.getName()); // è¾“å‡ºï¼šConan System.out.println(character.getHairColor()); // è¾“å‡ºï¼šBlack System.out.println(character.getWeapon()); // è¾“å‡ºï¼šSword } } åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼ŒCharacterï¼ˆäº§å“ï¼‰æ˜¯è¦æ„å»ºçš„å¤æ‚å¯¹è±¡ï¼ŒCharacterBuilderï¼ˆå»ºé€ è€…ï¼‰è´Ÿè´£æ„å»ºè¿™ä¸ªå¯¹è±¡çš„å…·ä½“æ­¥éª¤ã€‚é€šè¿‡é“¾å¼è°ƒç”¨å»ºé€ è€…çš„æ–¹æ³•ï¼Œå¯ä»¥è®¾ç½®äº§å“çš„å„ä¸ªå±æ€§ã€‚æœ€åï¼Œè°ƒç”¨build()æ–¹æ³•è¿”å›æœ€ç»ˆæ„å»ºçš„å¯¹è±¡ã€‚\nä¼˜ç¼ºç‚¹ æ„é€ å™¨æ¨¡å¼çš„ä¼˜ç‚¹ï¼š ç®€åŒ–å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼Œæä¾›ä¸€ç§æ¸…æ™°å’Œå¯è¯»çš„åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ã€‚ å…è®¸é€šè¿‡æ„é€ å™¨å‚æ•°æ¥å®šåˆ¶å¯¹è±¡çš„å±æ€§å’Œè¡Œä¸ºã€‚ æ”¯æŒé“¾å¼è°ƒç”¨ï¼Œä½¿å¾—å¯¹è±¡çš„åˆ›å»ºå’Œé…ç½®æ›´åŠ çµæ´»å’Œå¯é…ç½®ã€‚ æä¾›äº†ä¸€ç§æ ‡å‡†åŒ–çš„å¯¹è±¡åˆ›å»ºæ–¹å¼ï¼Œç¬¦åˆé¢å‘å¯¹è±¡è®¾è®¡çš„åŸåˆ™ã€‚ æ„é€ å™¨æ¨¡å¼çš„ç¼ºç‚¹ï¼š å½“æœ‰å¾ˆå¤šå±æ€§éœ€è¦è®¾ç½®æ—¶ï¼Œæ„é€ å™¨å‚æ•°åˆ—è¡¨å¯èƒ½å˜å¾—å¾ˆé•¿ï¼Œä¸æ˜“ç»´æŠ¤ã€‚ å¯¹äºå±æ€§å¯é€‰çš„æƒ…å†µï¼Œéœ€è¦åˆ›å»ºå¤šä¸ªæ„é€ å™¨æˆ–ä½¿ç”¨å¯é€‰å‚æ•°çš„æ–¹å¼ï¼Œå¢åŠ äº†ä»£ç å¤æ‚æ€§ã€‚ ä¸å…¶ä»–æ¨¡å¼åŒºåˆ« æ„é€ å™¨æ¨¡å¼å’Œå…¶ä»–åˆ›å»ºå‹æ¨¡å¼çš„åŒºåˆ«ï¼šæ„é€ å™¨æ¨¡å¼æ˜¯åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ä¹‹ä¸€ï¼Œä¸“æ³¨äºé€šè¿‡æ„é€ å™¨æ¥åˆ›å»ºå¯¹è±¡ã€‚ä¸å…¶ä»–åˆ›å»ºå‹æ¨¡å¼ï¼ˆå¦‚å·¥å‚æ¨¡å¼ã€æŠ½è±¡å·¥å‚æ¨¡å¼ã€å»ºé€ è€…æ¨¡å¼ï¼‰ç›¸æ¯”ï¼Œæ„é€ å™¨æ¨¡å¼æ›´åŠ æ³¨é‡å¯¹è±¡çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œå¹¶é€šè¿‡æ„é€ å™¨å‚æ•°æ¥è®¾ç½®å¯¹è±¡çš„å±æ€§å’ŒçŠ¶æ€ã€‚ æ„é€ å™¨æ¨¡å¼ä¸ JavaBean æ¨¡å¼çš„æ¯”è¾ƒï¼šæ„é€ å™¨æ¨¡å¼å’Œ JavaBean æ¨¡å¼æ˜¯ä¸¤ç§ä¸åŒçš„å¯¹è±¡åˆ›å»ºæ–¹å¼ã€‚ æ„é€ å™¨æ¨¡å¼é€šè¿‡åœ¨æ„é€ å™¨ä¸­ä¼ é€’å‚æ•°æ¥åˆ›å»ºå¯¹è±¡ï¼Œå¼ºè°ƒå¯¹è±¡çš„ä¸å˜æ€§å’Œä¸€æ¬¡æ€§åˆå§‹åŒ–ã€‚ JavaBean æ¨¡å¼ä½¿ç”¨é»˜è®¤æ„é€ å™¨å’Œ setter æ–¹æ³•æ¥è®¾ç½®å¯¹è±¡çš„å±æ€§ï¼Œå¼ºè°ƒå¯å˜æ€§å’Œé€æ­¥åˆå§‹åŒ–ã€‚ æ„é€ å™¨æ¨¡å¼çš„å˜ä½“ï¼š\né™æ€å†…éƒ¨ç±»æ„é€ å™¨æ¨¡å¼ï¼šé€šè¿‡é™æ€å†…éƒ¨ç±»çš„æ–¹å¼æ¥æ„å»ºå¯¹è±¡ï¼Œå®ç°äº†æ‡’åŠ è½½å’Œçº¿ç¨‹å®‰å…¨ã€‚ä¼ ç»Ÿçš„å»ºé€ è€…æ¨¡å¼ç›¸æ¯”ï¼Œé™æ€ Builder æ¨¡å¼å°† Builder ç±»å®šä¹‰ä¸ºé™æ€å†…éƒ¨ç±»ï¼Œä»¥ç®€åŒ–å¯¹è±¡åˆ›å»ºè¿‡ç¨‹ï¼ŒåŒæ—¶ä¿æŒå¯è¯»æ€§å’Œå¯é…ç½®æ€§ã€‚\npublic class Product { private String name; private String description; private int price; private Product(Builder builder) { this.name = builder.name; this.description = builder.description; this.price = builder.price; } public String getName() { return name; } public String getDescription() { return description; } public int getPrice() { return price; } public static class Builder { private String name; private String description; private int price; public Builder() { } public Builder name(String name) { this.name = name; return this; } public Builder description(String description) { this.description = description; return this; } public Builder price(int price) { this.price = price; return this; } public Product build() { return new Product(this); } } } åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼ŒProduct ç±»æ˜¯è¦æ„å»ºçš„äº§å“ç±»ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€äº›å±æ€§ã€‚Product ç±»çš„æ„é€ å‡½æ•°è¢«å®šä¹‰ä¸ºç§æœ‰ï¼Œåªèƒ½é€šè¿‡å†…éƒ¨çš„ Builder ç±»æ¥æ„å»ºå¯¹è±¡ã€‚\nBuilder ç±»æ˜¯ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼Œå®ƒæ‹¥æœ‰ä¸ Product ç±»ç›¸åŒçš„å±æ€§ï¼Œå¹¶æä¾›äº†é“¾å¼è°ƒç”¨çš„æ–¹æ³•æ¥é…ç½®è¿™äº›å±æ€§ã€‚æœ€åï¼Œé€šè¿‡ build() æ–¹æ³•æ¥åˆ›å»º Product å¯¹è±¡ï¼Œå¹¶å°† Builder å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™ Product ç±»çš„ç§æœ‰æ„é€ å‡½æ•°æ¥è¿›è¡Œå¯¹è±¡çš„æ„å»ºã€‚\nä½¿ç”¨é™æ€ Builder æ¨¡å¼ï¼Œå¯ä»¥ä»¥é“¾å¼è°ƒç”¨çš„æ–¹å¼æ¥æ„å»ºå¯¹è±¡ï¼Œä½¿ä»£ç æ›´åŠ ç®€æ´å’Œå¯è¯»ã€‚åŒæ—¶ï¼Œç”±äº Builder ç±»æ˜¯é™æ€å†…éƒ¨ç±»ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ç±»åè¿›è¡Œè®¿é—®ï¼Œæ— éœ€å…ˆåˆ›å»ºå¤–éƒ¨ç±»çš„å®ä¾‹ã€‚è¿™ç§æ¨¡å¼ä¹Ÿæä¾›äº†ä¸€ç§å¯é…ç½®çš„å¯¹è±¡åˆ›å»ºæ–¹å¼ï¼Œå…è®¸æ ¹æ®éœ€è¦é€‰æ‹©æ€§åœ°è®¾ç½®å¯¹è±¡çš„å±æ€§å€¼ã€‚\næ„é€ å™¨å‚æ•°è¿‡å¤šæ—¶ï¼Œä½¿ç”¨æ„é€ å™¨æ¨¡å¼çš„å˜ç§å¯ä»¥æ”¹å–„ä»£ç å¯è¯»æ€§ï¼Œå¦‚ä½¿ç”¨æ„å»ºå™¨æ¨¡å¼ï¼ˆBuilder Patternï¼‰æˆ–æµå¼æ¥å£æ¨¡å¼ï¼ˆFluent Interface Patternï¼‰\né€‚ç”¨åœºæ™¯ æ„é€ å™¨æ¨¡å¼é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š\nå½“éœ€è¦åˆ›å»ºå¤æ‚å¯¹è±¡æ—¶ï¼Œå¯¹è±¡çš„æ„å»ºè¿‡ç¨‹éœ€è¦å¤šä¸ªæ­¥éª¤ï¼Œå¹¶ä¸”è¿™äº›æ­¥éª¤å¯ä»¥çµæ´»ç»„åˆï¼Œäº§ç”Ÿä¸åŒçš„å¯¹è±¡è¡¨ç¤ºã€‚ å½“ä¸€ä¸ªå¯¹è±¡çš„æ„å»ºè¿‡ç¨‹ç‹¬ç«‹äºç»„æˆå¯¹è±¡çš„éƒ¨ä»¶åŠå…¶ç»„è£…æ–¹å¼ï¼Œå¹¶ä¸”å¸Œæœ›é€šè¿‡æ”¹å˜æ„å»ºè¿‡ç¨‹æ¥æ„å»ºä¸åŒçš„è¡¨ç¤ºã€‚ å½“æ„å»ºè¿‡ç¨‹å¿…é¡»å…è®¸æ„å»ºçš„å¯¹è±¡å…·æœ‰ä¸åŒçš„è¡¨ç¤ºå½¢å¼ï¼Œè€Œä¸éœ€è¦æš´éœ²å…¶å†…éƒ¨ç»“æ„ã€‚ å½“åˆ›å»ºè¿‡ç¨‹ä¸­å­˜åœ¨å…±äº«çš„éƒ¨ä»¶ï¼Œå¹¶ä¸”å¸Œæœ›é¿å…é‡å¤åˆ›å»ºç›¸åŒçš„éƒ¨ä»¶ã€‚ ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„é€‚ç”¨åœºæ™¯ç¤ºä¾‹ï¼š\nåˆ›å»ºå¤æ‚çš„é…ç½®å¯¹è±¡ï¼šä¾‹å¦‚ï¼Œä¸€ä¸ªé…ç½®å¯¹è±¡æœ‰å¤šä¸ªå¯é€‰é¡¹å’Œå‚æ•°ï¼Œä½¿ç”¨æ„é€ å™¨æ¨¡å¼å¯ä»¥é€šè¿‡è®¾ç½®ä¸åŒçš„é€‰é¡¹å’Œå‚æ•°æ¥æ„å»ºä¸åŒçš„é…ç½®å¯¹è±¡ã€‚ åˆ›å»ºå…·æœ‰ä¸åŒé€‰é¡¹çš„èœå•é¡¹ï¼šä¾‹å¦‚ï¼Œä¸€ä¸ªèœå•é¡¹å¯ä»¥æœ‰ä¸åŒçš„åç§°ã€å›¾æ ‡ã€å¿«æ·é”®ç­‰é€‰é¡¹ï¼Œä½¿ç”¨æ„é€ å™¨æ¨¡å¼å¯ä»¥æ ¹æ®éœ€è¦ç»„åˆè¿™äº›é€‰é¡¹æ¥æ„å»ºèœå•é¡¹ã€‚ åˆ›å»ºå…·æœ‰å¤šä¸ªæ­¥éª¤çš„è¡¨å•ï¼šä¾‹å¦‚ï¼Œä¸€ä¸ªè¡¨å•éœ€è¦ç”¨æˆ·å¡«å†™å¤šä¸ªå­—æ®µï¼Œä½¿ç”¨æ„é€ å™¨æ¨¡å¼å¯ä»¥å®šä¹‰ä¸åŒçš„æ­¥éª¤æ¥æ„å»ºè¡¨å•ï¼Œå¹¶åœ¨æ¯ä¸ªæ­¥éª¤ä¸­è®¾ç½®ç›¸åº”çš„å­—æ®µã€‚ åˆ›å»ºå¤æ‚çš„å¯¹è±¡å›¾ï¼šä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ªåŒ…å«å¤šä¸ªå¯¹è±¡å’Œå…³è”å…³ç³»çš„å¯¹è±¡å›¾ï¼Œä½¿ç”¨æ„é€ å™¨æ¨¡å¼å¯ä»¥é€šè¿‡é€æ­¥æ„å»ºå¯¹è±¡å¹¶å»ºç«‹å®ƒä»¬ä¹‹é—´çš„å…³è”å…³ç³»æ¥åˆ›å»ºæ•´ä¸ªå¯¹è±¡å›¾ã€‚ åœ¨è®¸å¤šå¼€æºæ¡†æ¶å’Œåº“ä¸­ï¼Œæ„é€ å™¨æ¨¡å¼ç»å¸¸è¢«ä½¿ç”¨ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„å¼€æºæ¡†æ¶ä¸­ä½¿ç”¨æ„é€ å™¨æ¨¡å¼çš„ä¾‹å­ï¼š\nApache HttpClientï¼šApache HttpClient æ˜¯ä¸€ä¸ªæµè¡Œçš„å¼€æºæ¡†æ¶ï¼Œç”¨äºè¿›è¡Œ HTTP é€šä¿¡ã€‚å®ƒä½¿ç”¨äº†æ„é€ å™¨æ¨¡å¼æ¥æ„å»ºHttpClientå’ŒHttpRequestå¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡ä½¿ç”¨HttpClientBuilderç±»çš„æ„é€ å™¨æ¨¡å¼ï¼Œå¯ä»¥åˆ›å»ºè‡ªå®šä¹‰çš„HttpClientå®ä¾‹ã€‚ CloseableHttpClient httpClient = HttpClientBuilder.create() .setConnectionTimeout(5000) .setRetryHandler(new DefaultHttpRequestRetryHandler(3, true)) .build(); Gsonï¼šGson æ˜¯ Google æä¾›çš„ç”¨äºåœ¨ Java å¯¹è±¡å’Œ JSON æ•°æ®ä¹‹é—´è¿›è¡Œè½¬æ¢çš„åº“ã€‚åœ¨ Gson ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ„é€ å™¨æ¨¡å¼æ¥æ„å»ºGsonå¯¹è±¡ï¼Œå¹¶è®¾ç½®ä¸åŒçš„é…ç½®é€‰é¡¹ã€‚ Gson gson = new GsonBuilder() .setDateFormat(\u0026#34;yyyy-MM-dd\u0026#34;) .disableHtmlEscaping() .create(); Retrofitï¼šRetrofit æ˜¯ä¸€ä¸ªç”¨äºè¿›è¡Œ RESTful API é€šä¿¡çš„åº“ã€‚å®ƒä½¿ç”¨æ„é€ å™¨æ¨¡å¼æ¥æ„å»ºRetrofitå®ä¾‹ï¼Œå¹¶è®¾ç½®ä¸åŒçš„é…ç½®é€‰é¡¹ï¼Œä¾‹å¦‚è®¾ç½®åŸºæœ¬ URLã€æ·»åŠ æ‹¦æˆªå™¨ç­‰ã€‚ Retrofit retrofit = new Retrofit.Builder() .baseUrl(\u0026#34;https://api.example.com\u0026#34;) .addConverterFactory(GsonConverterFactory.create()) .build(); JUnitï¼šJUnit æ˜¯ä¸€ä¸ªç”¨äºç¼–å†™å•å…ƒæµ‹è¯•çš„ Java æ¡†æ¶ã€‚åœ¨ JUnit ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ„é€ å™¨æ¨¡å¼æ¥æ„å»ºä¸åŒç±»å‹çš„æµ‹è¯•å¯¹è±¡ï¼Œä¾‹å¦‚ä½¿ç”¨@RunWithæ³¨è§£é…ç½®ä¸åŒçš„æµ‹è¯•è¿è¡Œå™¨ã€‚ @RunWith(Parameterized.class) public class MyParameterizedTest { // constructor with parameters public MyParameterizedTest(String input, int expected) { // ... } } Spring Frameworkï¼šSpring Framework æ˜¯ä¸€ä¸ªå¹¿æ³›åº”ç”¨äº Java ä¼ä¸šåº”ç”¨å¼€å‘çš„å¼€æºæ¡†æ¶ã€‚åœ¨ Spring ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ„é€ å™¨æ¨¡å¼æ¥æ„å»ºä¸åŒçš„å¯¹è±¡ï¼Œä¾‹å¦‚ä½¿ç”¨RestTemplateBuilderæ„å»ºRestTemplateå¯¹è±¡ã€‚ RestTemplate restTemplate = new RestTemplateBuilder() .setConnectTimeout(5000) .setReadTimeout(5000) .build(); Hibernate ORMï¼šHibernate æ˜¯ä¸€ä¸ªæµè¡Œçš„ Java å¯¹è±¡å…³ç³»æ˜ å°„ï¼ˆORMï¼‰æ¡†æ¶ï¼Œç”¨äºå°† Java å¯¹è±¡æ˜ å°„åˆ°æ•°æ®åº“è¡¨ã€‚åœ¨ Hibernate ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ„é€ å™¨æ¨¡å¼æ¥æ„å»ºSessionFactoryå’ŒSessionå¯¹è±¡ã€‚ Configuration configuration = new Configuration() .configure(\u0026#34;hibernate.cfg.xml\u0026#34;) .addAnnotatedClass(User.class); SessionFactory sessionFactory = configuration.buildSessionFactory(); ä»¥ä¸‹æ˜¯ä¸€äº› Java ä¸­ä½¿ç”¨æ„é€ å™¨æ¨¡å¼çš„ä¾‹å­ï¼š\nStringBuilder ç±»ï¼šJava ä¸­çš„ StringBuilder ç±»ä½¿ç”¨æ„é€ å™¨æ¨¡å¼æ¥æ„å»ºå¯å˜çš„å­—ç¬¦ä¸²å¯¹è±¡ã€‚å®ƒå…è®¸é€šè¿‡æ„é€ å™¨é“¾å¼è°ƒç”¨æ¥è¿½åŠ ã€æ’å…¥å’Œä¿®æ”¹å­—ç¬¦ä¸²å†…å®¹ã€‚ StringBuilder sb = new StringBuilder(\u0026#34;Hello\u0026#34;); sb.append(\u0026#34; World\u0026#34;) .insert(5, \u0026#34;,\u0026#34;) .replace(6, 11, \u0026#34;Java\u0026#34;) .deleteCharAt(11); String result = sb.toString(); // \u0026#34;Hello, Java\u0026#34; StringBuffer æ€»ç»“ æ„é€ å™¨æ¨¡å¼æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œæ—¨åœ¨é€šè¿‡ä½¿ç”¨æ„é€ å™¨æ¥åˆ›å»ºå¯¹è±¡ã€‚å®ƒæä¾›äº†ä¸€ç§æ¸…æ™°ã€å¯è¯»å’Œå¯é…ç½®çš„å¯¹è±¡åˆ›å»ºæ–¹å¼ï¼Œå…è®¸é€šè¿‡æ„é€ å™¨å‚æ•°æ¥è®¾ç½®å¯¹è±¡çš„å±æ€§å’ŒçŠ¶æ€ã€‚ä¸‹é¢æ˜¯å¯¹æ„é€ å™¨æ¨¡å¼çš„æ€»ç»“ï¼š\nç›®çš„ï¼šæ„é€ å™¨æ¨¡å¼æ—¨åœ¨æä¾›ä¸€ç§æ ‡å‡†åŒ–çš„å¯¹è±¡åˆ›å»ºæ–¹å¼ï¼Œå°†å¯¹è±¡çš„æ„å»ºå’Œåˆå§‹åŒ–è¿‡ç¨‹å°è£…åœ¨æ„é€ å™¨ä¸­ï¼Œä»¥ä¾¿äºä½¿ç”¨è€…åˆ›å»ºå¯¹è±¡ã€‚ ä¸»è¦ç»„ä»¶ï¼š æ„é€ å™¨ï¼ˆConstructorï¼‰ï¼šæ„é€ å™¨è´Ÿè´£åˆ›å»ºå¯¹è±¡å¹¶è®¾ç½®å…¶å±æ€§å’ŒçŠ¶æ€ã€‚å®ƒå¯ä»¥æ¥æ”¶ä¸€ç»„å‚æ•°æ¥åˆå§‹åŒ–å¯¹è±¡ã€‚ å¯¹è±¡ï¼ˆObjectï¼‰ï¼šæ„é€ å™¨æ¨¡å¼åˆ›å»ºçš„ç›®æ ‡å¯¹è±¡ï¼Œå…·æœ‰ä¸€ç»„å±æ€§å’ŒçŠ¶æ€ã€‚ ä¼˜ç‚¹ï¼š ç®€åŒ–å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼Œæä¾›ä¸€ç§æ¸…æ™°å’Œå¯è¯»çš„åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ã€‚ å…è®¸é€šè¿‡æ„é€ å™¨å‚æ•°æ¥å®šåˆ¶å¯¹è±¡çš„å±æ€§å’Œè¡Œä¸ºã€‚ æ”¯æŒé“¾å¼è°ƒç”¨ï¼Œä½¿å¾—å¯¹è±¡çš„åˆ›å»ºå’Œé…ç½®æ›´åŠ çµæ´»å’Œå¯é…ç½®ã€‚ æä¾›äº†ä¸€ç§æ ‡å‡†åŒ–çš„å¯¹è±¡åˆ›å»ºæ–¹å¼ï¼Œç¬¦åˆé¢å‘å¯¹è±¡è®¾è®¡çš„åŸåˆ™ã€‚ ç¼ºç‚¹ï¼š å½“æœ‰å¾ˆå¤šå±æ€§éœ€è¦è®¾ç½®æ—¶ï¼Œæ„é€ å™¨å‚æ•°åˆ—è¡¨å¯èƒ½å˜å¾—å¾ˆé•¿ï¼Œä¸æ˜“ç»´æŠ¤ã€‚ å¯¹äºå±æ€§å¯é€‰çš„æƒ…å†µï¼Œéœ€è¦åˆ›å»ºå¤šä¸ªæ„é€ å™¨æˆ–ä½¿ç”¨å¯é€‰å‚æ•°çš„æ–¹å¼ï¼Œå¢åŠ äº†ä»£ç å¤æ‚æ€§ã€‚ ä¸å…¶ä»–æ¨¡å¼çš„å…³ç³»ï¼š æ„é€ å™¨æ¨¡å¼ä¸å…¶ä»–åˆ›å»ºå‹æ¨¡å¼ï¼ˆå¦‚å·¥å‚æ¨¡å¼ã€æŠ½è±¡å·¥å‚æ¨¡å¼ã€å»ºé€ è€…æ¨¡å¼ï¼‰ç›¸æ¯”ï¼Œæ›´åŠ æ³¨é‡å¯¹è±¡çš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚ é™æ€å†…éƒ¨ç±»æ„é€ å™¨æ¨¡å¼æ˜¯æ„é€ å™¨æ¨¡å¼çš„ä¸€ç§å˜ä½“ï¼Œé€šè¿‡é™æ€å†…éƒ¨ç±»å®ç°äº†æ‡’åŠ è½½å’Œçº¿ç¨‹å®‰å…¨ã€‚ æ„é€ å™¨æ¨¡å¼å¯ä»¥ä¸å…¶ä»–è®¾è®¡æ¨¡å¼ç»“åˆä½¿ç”¨ï¼Œå¦‚å•ä¾‹æ¨¡å¼ã€é€‚é…å™¨æ¨¡å¼ç­‰ï¼Œä»¥æ»¡è¶³æ›´å¤æ‚çš„éœ€æ±‚ã€‚ æ„é€ å™¨æ¨¡å¼æä¾›äº†ä¸€ç§ç®€å•è€Œå¼ºå¤§çš„å¯¹è±¡åˆ›å»ºæ–¹å¼ï¼Œä½¿å¾—åˆ›å»ºå¯¹è±¡å˜å¾—ç›´è§‚ã€å¯é…ç½®å’Œå¯è¯»ã€‚å®ƒæ˜¯é¢å‘å¯¹è±¡è®¾è®¡ä¸­å¸¸ç”¨çš„æ¨¡å¼ä¹‹ä¸€ï¼Œå¯ä»¥å¸®åŠ©ç¨‹åºå‘˜ç¼–å†™å¯ç»´æŠ¤ã€å¯æ‰©å±•çš„ä»£ç ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/09/05/java-design-patterns-builder/","summary":"æœ¬æ–‡ä¸»è¦ä»‹ç» Builder æ„é€ å™¨æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nä»‹ç» æ„é€ å™¨æ¨¡å¼ï¼ˆBuilder Patternï¼‰æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œç”¨äºå°†å¤æ‚å¯¹è±¡çš„æ„å»ºè¿‡ç¨‹ä¸å…¶è¡¨ç¤ºåˆ†ç¦»ï¼Œä»è€Œå¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ„å»ºè¿‡ç¨‹åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚\nåœ¨æ„é€ å™¨æ¨¡å¼ä¸­ï¼Œé€šå¸¸æœ‰ä¸¤ä¸ªä¸»è¦è§’è‰²ï¼šäº§å“ï¼ˆProductï¼‰å’Œå»ºé€ è€…ï¼ˆBuilderï¼‰ã€‚äº§å“æ˜¯æœ€ç»ˆæ„å»ºçš„å¯¹è±¡ï¼Œè€Œå»ºé€ è€…è´Ÿè´£æ„å»ºäº§å“ã€‚\nä»¥ä¸‹æ˜¯æ„é€ å™¨æ¨¡å¼çš„ç±»å›¾ç¤ºä¾‹ï¼š\n+-------------------+ +----------------------+ | Director | | Builder | +-------------------+ +----------------------+ | construct() | | buildPartA() | | | | buildPartB() | +-------------------+ | getResult() | +----------+-----------+ | v +----------+-----------+ | Product | +----------------------+ | partA | | partB | +----------------------+ åœ¨ä¸Šè¿°ç±»å›¾ä¸­ï¼ŒDirectorï¼ˆæŒ‡å¯¼è€…ï¼‰è´Ÿè´£å®šä¹‰æ„å»ºäº§å“çš„é¡ºåºå’Œæ–¹å¼ï¼Œè€ŒBuilderï¼ˆå»ºé€ è€…ï¼‰è´Ÿè´£å®é™…æ„å»ºäº§å“çš„å…·ä½“æ­¥éª¤ã€‚Productï¼ˆäº§å“ï¼‰æ˜¯æœ€ç»ˆæ„å»ºçš„å¯¹è±¡ã€‚\nä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨æ„é€ å™¨æ¨¡å¼åˆ›å»ºä¸€ä¸ªè§’è‰²ç”Ÿæˆå™¨çš„ä¾‹å­ï¼š\n// äº§å“ç±» public class Character { private String profession; private String name; private String hairColor; private String weapon; // æ„é€ å™¨ç§æœ‰åŒ–ï¼Œåªèƒ½é€šè¿‡å»ºé€ è€…åˆ›å»ºå¯¹è±¡ private Character() {} // Getters public String getProfession() { return profession; } public String getName() { return name; } public String getHairColor() { return hairColor; } public String getWeapon() { return weapon; } // å»ºé€ è€…ç±» public static class CharacterBuilder { private Character character; public CharacterBuilder() { character = new Character(); } public CharacterBuilder withProfession(String profession) { character.","title":"Javaè®¾è®¡æ¨¡å¼ï¼šBuilder"},{"content":"æœ¬æ–‡ä¸»è¦ä»‹ç» Business Delegate ä¸šåŠ¡å§”æ‰˜æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nä»‹ç» ä¸šåŠ¡å§”æ‰˜æ¨¡å¼ï¼ˆBusiness Delegate Patternï¼‰åœ¨è¡¨ç¤ºå±‚å’Œä¸šåŠ¡å±‚ä¹‹é—´å¼•å…¥äº†ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œæ—¨åœ¨å®ç°è¿™ä¸¤ä¸ªå±‚ä¹‹é—´çš„æ¾æ•£è€¦åˆï¼Œå¹¶å°è£…äº†æœ‰å…³å¦‚ä½•å®šä½ã€è¿æ¥å’Œäº¤äº’ä¸šåŠ¡å¯¹è±¡çš„é€»è¾‘ã€‚\nåœ¨è¯¥æ¨¡å¼ä¸­ï¼Œä¸šåŠ¡å§”æ‰˜ï¼ˆBusiness Delegateï¼‰å……å½“ä¸€ä¸ªä¸­é—´äººè§’è‰²ï¼Œè´Ÿè´£å°†è¡¨ç¤ºå±‚çš„è°ƒç”¨å§”æ‰˜ç»™ä¸šåŠ¡å¯¹è±¡ã€‚å®ƒéšè—äº†å…·ä½“ä¸šåŠ¡å¯¹è±¡çš„å®ç°ç»†èŠ‚ï¼ŒåŒ…æ‹¬åº•å±‚æœåŠ¡çš„æŸ¥æ‰¾å’Œå¯è®¿é—®æ€§ï¼Œä»¥æä¾›ç®€åŒ–çš„æ¥å£ä¾›è¡¨ç¤ºå±‚ä½¿ç”¨ã€‚\nä¸šåŠ¡å§”æ‰˜æ¨¡å¼ç”¨äºè§£è€¦è¡¨ç¤ºå±‚å’Œä¸šåŠ¡å±‚ã€‚å®ƒåŸºæœ¬ä¸Šç”¨äºå‡å°‘è¡¨ç¤ºå±‚ä»£ç ä¸­ä¸šåŠ¡å±‚ä»£ç çš„é€šä¿¡æˆ–è¿œç¨‹æŸ¥æ‰¾åŠŸèƒ½ã€‚åœ¨ä¸šåŠ¡å±‚ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹å®ä½“ã€‚\nClient - è¡¨ç¤ºå±‚ä»£ç å¯ä»¥æ˜¯ JSPã€Servlet æˆ– UI java ä»£ç ã€‚ Business Delegate -ä¸šåŠ¡å§”æ‰˜ - å®¢æˆ·ç«¯å®ä½“æä¾›å¯¹ä¸šåŠ¡æœåŠ¡æ–¹æ³•çš„è®¿é—®çš„å•ä¸ªå…¥å£ç‚¹ç±»ã€‚ LookUp Service - æŸ¥æ‰¾æœåŠ¡å¯¹è±¡è´Ÿè´£è·å–ç›¸å…³ä¸šåŠ¡å®ç°å¹¶æä¾›å¯¹ä¸šåŠ¡å§”æ‰˜å¯¹è±¡çš„ä¸šåŠ¡å¯¹è±¡è®¿é—®ã€‚ Business Service - ä¸šåŠ¡æœåŠ¡æ¥å£ã€‚å…·ä½“ç±»å®ç°è¯¥ä¸šåŠ¡æœåŠ¡ä»¥æä¾›å®é™…çš„ä¸šåŠ¡å®ç°é€»è¾‘ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹çš„ç¨‹åºä»£ç ï¼Œæ¼”ç¤ºäº†ä¸šåŠ¡å§”æ‰˜æ¨¡å¼çš„å®ç°ï¼š\npublic interface VideoStreamingService { void doProcessing(); } @Slf4j public class NetflixService implements VideoStreamingService { @Override public void doProcessing() { LOGGER.info(\u0026#34;NetflixService is now processing\u0026#34;); } } @Slf4j public class YouTubeService implements VideoStreamingService { @Override public void doProcessing() { LOGGER.info(\u0026#34;YouTubeService is now processing\u0026#34;); } } @Setter public class BusinessLookup { private NetflixService netflixService; private YouTubeService youTubeService; public VideoStreamingService getBusinessService(String movie) { if (movie.toLowerCase(Locale.ROOT).contains(\u0026#34;die hard\u0026#34;)) { return netflixService; } else { return youTubeService; } } } @Setter public class BusinessDelegate { private BusinessLookup lookupService; public void playbackMovie(String movie) { VideoStreamingService videoStreamingService = lookupService.getBusinessService(movie); videoStreamingService.doProcessing(); } } public class MobileClient { private final BusinessDelegate businessDelegate; public MobileClient(BusinessDelegate businessDelegate) { this.businessDelegate = businessDelegate; } public void playbackMovie(String movie) { businessDelegate.playbackMovie(movie); } } public static void main(String[] args) { // å‡†å¤‡å¯¹è±¡ var businessDelegate = new BusinessDelegate(); var businessLookup = new BusinessLookup(); businessLookup.setNetflixService(new NetflixService()); businessLookup.setYouTubeService(new YouTubeService()); businessDelegate.setLookupService(businessLookup); // åˆ›å»ºå®¢æˆ·ç«¯å¹¶ä½¿ç”¨ä¸šåŠ¡å§”æ‰˜ var client = new MobileClient(businessDelegate); client.playbackMovie(\u0026#34;Die Hard 2\u0026#34;); client.playbackMovie(\u0026#34;Maradona: The Greatest Ever\u0026#34;); } ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼ŒVideoStreamingServiceæ˜¯ä¸€ä¸ªæŠ½è±¡æ¥å£ï¼Œç”±å…·ä½“çš„å®ç°ç±»NetflixServiceå’ŒYouTubeServiceå®ç°ã€‚BusinessLookupè´Ÿè´£æ ¹æ®ç”µå½±åç§°é€‰æ‹©åˆé€‚çš„è§†é¢‘æµæœåŠ¡ã€‚BusinessDelegateåˆ™ä½¿ç”¨BusinessLookupæ¥å°†ç”µå½±æ’­æ”¾è¯·æ±‚è·¯ç”±åˆ°é€‚å½“çš„è§†é¢‘æµæœåŠ¡ã€‚MobileClientä½œä¸ºç§»åŠ¨å®¢æˆ·ç«¯ä½¿ç”¨ä¸šåŠ¡å§”æ‰˜æ¥è°ƒç”¨ä¸šåŠ¡å±‚ã€‚\nç±»å›¾ï¼š\né€‚ç”¨åœºæ™¯ ä¸šåŠ¡å§”æ‰˜æ¨¡å¼é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š\næ¾æ•£è€¦åˆï¼šå½“éœ€è¦åœ¨è¡¨ç¤ºå±‚å’Œä¸šåŠ¡å±‚ä¹‹é—´å®ç°æ¾æ•£è€¦åˆæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸šåŠ¡å§”æ‰˜æ¨¡å¼ã€‚è¯¥æ¨¡å¼é€šè¿‡å¼•å…¥ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œå°†è¡¨ç¤ºå±‚ä¸å…·ä½“çš„ä¸šåŠ¡å¯¹è±¡è§£è€¦ï¼Œä½¿å®ƒä»¬å¯ä»¥ç‹¬ç«‹æ¼”åŒ–å’Œä¿®æ”¹ã€‚ å¤šä¸ªä¸šåŠ¡æœåŠ¡çš„è°ƒç”¨ç¼–æ’ï¼šå½“éœ€è¦å¯¹å¤šä¸ªä¸šåŠ¡æœåŠ¡è¿›è¡Œç¼–æ’å’Œåè°ƒæ—¶ï¼Œä¸šåŠ¡å§”æ‰˜æ¨¡å¼å¯ä»¥æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ä¾›è¡¨ç¤ºå±‚è°ƒç”¨ã€‚å§”æ‰˜å¯¹è±¡è´Ÿè´£å†³å®šå¦‚ä½•åˆ†é…è¯·æ±‚ç»™ä¸åŒçš„ä¸šåŠ¡æœåŠ¡ï¼Œå¹¶å¤„ç†å¯èƒ½çš„é”™è¯¯å’Œå¼‚å¸¸æƒ…å†µã€‚ å°è£…æŸ¥æ‰¾æœåŠ¡å’ŒæœåŠ¡è°ƒç”¨ï¼šä¸šåŠ¡å§”æ‰˜æ¨¡å¼å¯ä»¥å°è£…åº•å±‚æœåŠ¡çš„æŸ¥æ‰¾å’Œè°ƒç”¨è¿‡ç¨‹ã€‚é€šè¿‡å°†è¿™äº›å®ç°ç»†èŠ‚éšè—åœ¨å§”æ‰˜å¯¹è±¡ä¸­ï¼Œè¡¨ç¤ºå±‚å¯ä»¥æ›´ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„å¤„ç†ï¼Œè€Œä¸éœ€è¦å…³æ³¨åº•å±‚æœåŠ¡çš„å…·ä½“å®ç°å’Œè®¿é—®æ–¹å¼ã€‚ è™½ç„¶ä¸šåŠ¡å§”æ‰˜æ¨¡å¼æ²¡æœ‰åœ¨æ‰€æœ‰å¼€æºæ¡†æ¶ä¸­ä»¥æ˜ç¡®çš„å½¢å¼å‡ºç°ï¼Œä½†å®ƒçš„æ ¸å¿ƒæ€æƒ³å¯ä»¥åœ¨è®¸å¤šæ¡†æ¶å’Œåº”ç”¨ç¨‹åºä¸­æ‰¾åˆ°ã€‚\nåœ¨å¼€æºæ¡†æ¶ä¸­ï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ°ä»¥ä¸‹æ–¹å¼æ¥ä½¿ç”¨ä¸šåŠ¡å§”æ‰˜æ¨¡å¼ï¼š\næœåŠ¡ä»£ç†ï¼šè®¸å¤šå¼€æºæ¡†æ¶ä½¿ç”¨ä»£ç†æ¨¡å¼æ¥å°è£…åº•å±‚æœåŠ¡ï¼Œå¹¶ä¸ºå®¢æˆ·ç«¯æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ã€‚è¿™ä¸ªä»£ç†å¯¹è±¡å¯ä»¥è¢«è§†ä¸ºä¸šåŠ¡å§”æ‰˜å¯¹è±¡ï¼Œå®ƒè´Ÿè´£å¤„ç†åº•å±‚æœåŠ¡çš„è°ƒç”¨å’Œé”™è¯¯å¤„ç†ï¼ŒåŒæ—¶éšè—äº†åº•å±‚æœåŠ¡çš„å…·ä½“å®ç°ç»†èŠ‚ã€‚å®¢æˆ·ç«¯åªéœ€è¦ä¸ä»£ç†å¯¹è±¡è¿›è¡Œäº¤äº’ï¼Œè€Œä¸éœ€è¦ç›´æ¥ä¸åº•å±‚æœåŠ¡è¿›è¡Œé€šä¿¡ã€‚ ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰ï¼šå¼€æºæ¡†æ¶é€šå¸¸æ”¯æŒä¾èµ–æ³¨å…¥ï¼Œå®ƒå¯ä»¥ç”¨äºå°†ä¸šåŠ¡å§”æ‰˜å¯¹è±¡æ³¨å…¥åˆ°å…¶ä»–ç»„ä»¶ä¸­ã€‚é€šè¿‡ä¾èµ–æ³¨å…¥ï¼Œä½ å¯ä»¥å°†å…·ä½“çš„ä¸šåŠ¡å§”æ‰˜å¯¹è±¡ä¸å®¢æˆ·ç«¯ä»£ç è§£è€¦ï¼Œä½¿å…¶æ›´æ˜“äºæµ‹è¯•ã€æ‰©å±•å’Œç»´æŠ¤ã€‚æ¡†æ¶é€šå¸¸æä¾›äº†ç›¸åº”çš„æ³¨å…¥æœºåˆ¶ï¼Œå¦‚æ„é€ å‡½æ•°æ³¨å…¥ã€å±æ€§æ³¨å…¥æˆ–ä½¿ç”¨æ³¨è§£è¿›è¡Œæ³¨å…¥ã€‚ ä¸­é—´ä»¶å’Œæ¶ˆæ¯ä»£ç†ï¼šæŸäº›å¼€æºæ¡†æ¶ä¸“æ³¨äºä¸­é—´ä»¶æˆ–æ¶ˆæ¯ä»£ç†ï¼Œç”¨äºå¤„ç†ä¸åŒæœåŠ¡ä¹‹é—´çš„é€šä¿¡ã€‚è¿™äº›æ¡†æ¶å¯èƒ½æä¾›ä¸€ç§æœºåˆ¶ï¼Œå…è®¸ä½ å®šä¹‰ä¸šåŠ¡å§”æ‰˜å¯¹è±¡ï¼Œå¹¶é€šè¿‡ä¸­é—´ä»¶æˆ–æ¶ˆæ¯ä»£ç†å°†è¯·æ±‚è·¯ç”±åˆ°ç›¸åº”çš„æœåŠ¡ã€‚è¿™ç§æ–¹å¼å¯ä»¥å¸®åŠ©å®ç°ä¸šåŠ¡é€»è¾‘çš„è§£è€¦å’Œçµæ´»æ€§ã€‚ éœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œä¸šåŠ¡å§”æ‰˜æ¨¡å¼å¹¶ä¸æ˜¯æ‰€æœ‰å¼€æºæ¡†æ¶ä¸­çš„æ˜¾å¼è®¾è®¡æ¨¡å¼ã€‚ç„¶è€Œï¼Œè®¸å¤šæ¡†æ¶å’Œåº“å€Ÿé‰´äº†ä¸šåŠ¡å§”æ‰˜æ¨¡å¼çš„æ€æƒ³ï¼Œä»¥æä¾›æ›´å¥½çš„æ¨¡å—åŒ–ã€å¯æµ‹è¯•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚åœ¨ä½¿ç”¨å¼€æºæ¡†æ¶æ—¶ï¼Œä½ å¯ä»¥æŸ¥çœ‹æ¡†æ¶çš„æ–‡æ¡£å’Œç¤ºä¾‹ï¼Œä»¥äº†è§£æ˜¯å¦æœ‰ç±»ä¼¼äºä¸šåŠ¡å§”æ‰˜æ¨¡å¼çš„æ¦‚å¿µæˆ–æœ€ä½³å®è·µå¯ä¾›å‚è€ƒã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/09/05/java-design-patterns-business-delegate/","summary":"æœ¬æ–‡ä¸»è¦ä»‹ç» Business Delegate ä¸šåŠ¡å§”æ‰˜æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nä»‹ç» ä¸šåŠ¡å§”æ‰˜æ¨¡å¼ï¼ˆBusiness Delegate Patternï¼‰åœ¨è¡¨ç¤ºå±‚å’Œä¸šåŠ¡å±‚ä¹‹é—´å¼•å…¥äº†ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œæ—¨åœ¨å®ç°è¿™ä¸¤ä¸ªå±‚ä¹‹é—´çš„æ¾æ•£è€¦åˆï¼Œå¹¶å°è£…äº†æœ‰å…³å¦‚ä½•å®šä½ã€è¿æ¥å’Œäº¤äº’ä¸šåŠ¡å¯¹è±¡çš„é€»è¾‘ã€‚\nåœ¨è¯¥æ¨¡å¼ä¸­ï¼Œä¸šåŠ¡å§”æ‰˜ï¼ˆBusiness Delegateï¼‰å……å½“ä¸€ä¸ªä¸­é—´äººè§’è‰²ï¼Œè´Ÿè´£å°†è¡¨ç¤ºå±‚çš„è°ƒç”¨å§”æ‰˜ç»™ä¸šåŠ¡å¯¹è±¡ã€‚å®ƒéšè—äº†å…·ä½“ä¸šåŠ¡å¯¹è±¡çš„å®ç°ç»†èŠ‚ï¼ŒåŒ…æ‹¬åº•å±‚æœåŠ¡çš„æŸ¥æ‰¾å’Œå¯è®¿é—®æ€§ï¼Œä»¥æä¾›ç®€åŒ–çš„æ¥å£ä¾›è¡¨ç¤ºå±‚ä½¿ç”¨ã€‚\nä¸šåŠ¡å§”æ‰˜æ¨¡å¼ç”¨äºè§£è€¦è¡¨ç¤ºå±‚å’Œä¸šåŠ¡å±‚ã€‚å®ƒåŸºæœ¬ä¸Šç”¨äºå‡å°‘è¡¨ç¤ºå±‚ä»£ç ä¸­ä¸šåŠ¡å±‚ä»£ç çš„é€šä¿¡æˆ–è¿œç¨‹æŸ¥æ‰¾åŠŸèƒ½ã€‚åœ¨ä¸šåŠ¡å±‚ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹å®ä½“ã€‚\nClient - è¡¨ç¤ºå±‚ä»£ç å¯ä»¥æ˜¯ JSPã€Servlet æˆ– UI java ä»£ç ã€‚ Business Delegate -ä¸šåŠ¡å§”æ‰˜ - å®¢æˆ·ç«¯å®ä½“æä¾›å¯¹ä¸šåŠ¡æœåŠ¡æ–¹æ³•çš„è®¿é—®çš„å•ä¸ªå…¥å£ç‚¹ç±»ã€‚ LookUp Service - æŸ¥æ‰¾æœåŠ¡å¯¹è±¡è´Ÿè´£è·å–ç›¸å…³ä¸šåŠ¡å®ç°å¹¶æä¾›å¯¹ä¸šåŠ¡å§”æ‰˜å¯¹è±¡çš„ä¸šåŠ¡å¯¹è±¡è®¿é—®ã€‚ Business Service - ä¸šåŠ¡æœåŠ¡æ¥å£ã€‚å…·ä½“ç±»å®ç°è¯¥ä¸šåŠ¡æœåŠ¡ä»¥æä¾›å®é™…çš„ä¸šåŠ¡å®ç°é€»è¾‘ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹çš„ç¨‹åºä»£ç ï¼Œæ¼”ç¤ºäº†ä¸šåŠ¡å§”æ‰˜æ¨¡å¼çš„å®ç°ï¼š\npublic interface VideoStreamingService { void doProcessing(); } @Slf4j public class NetflixService implements VideoStreamingService { @Override public void doProcessing() { LOGGER.info(\u0026#34;NetflixService is now processing\u0026#34;); } } @Slf4j public class YouTubeService implements VideoStreamingService { @Override public void doProcessing() { LOGGER.info(\u0026#34;YouTubeService is now processing\u0026#34;); } } @Setter public class BusinessLookup { private NetflixService netflixService; private YouTubeService youTubeService; public VideoStreamingService getBusinessService(String movie) { if (movie.toLowerCase(Locale.ROOT).contains(\u0026#34;die hard\u0026#34;)) { return netflixService; } else { return youTubeService; } } } @Setter public class BusinessDelegate { private BusinessLookup lookupService; public void playbackMovie(String movie) { VideoStreamingService videoStreamingService = lookupService.","title":"Javaè®¾è®¡æ¨¡å¼ï¼šBusiness Delegate"},{"content":"æœ¬æ–‡ä¸»è¦ä»‹ç» Bridge æ¡¥æ¥æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nä»‹ç» æ¡¥æ¥æ¨¡å¼ï¼ˆBridge Patternï¼‰æ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œç”¨äºå°†æŠ½è±¡ä¸å…¶å®ç°åˆ†ç¦»ï¼Œä½¿å®ƒä»¬å¯ä»¥ç‹¬ç«‹åœ°å˜åŒ–ã€‚æ¡¥æ¥æ¨¡å¼é€šè¿‡åˆ›å»ºä¸¤ä¸ªç‹¬ç«‹çš„å±‚æ¬¡ç»“æ„ï¼Œä¸€ä¸ªæ˜¯æŠ½è±¡éƒ¨åˆ†ï¼Œä¸€ä¸ªæ˜¯å®ç°éƒ¨åˆ†ï¼Œæ¥å®ç°è¿™ç§åˆ†ç¦»ã€‚\nåœ¨æ¡¥æ¥æ¨¡å¼ä¸­ï¼ŒæŠ½è±¡éƒ¨åˆ†åŒ…å«æŠ½è±¡ç±»æˆ–æ¥å£ï¼Œå®šä¹‰äº†é«˜å±‚é€»è¾‘å’ŒåŠŸèƒ½ã€‚å®ç°éƒ¨åˆ†åŒ…å«å…·ä½“å®ç°ç±»ï¼Œè´Ÿè´£å®ç°æŠ½è±¡éƒ¨åˆ†å®šä¹‰çš„æ¥å£æˆ–æ–¹æ³•ã€‚é€šè¿‡æ¡¥æ¥æ¨¡å¼ï¼Œå¯ä»¥åœ¨ä¸¤ä¸ªå±‚æ¬¡ç»“æ„ä¸­ç‹¬ç«‹åœ°æ‰©å±•å’Œå˜åŒ–ç±»ï¼Œè€Œä¸ä¼šç›¸äº’å½±å“ã€‚åŒæ—¶ï¼ŒæŠ½è±¡éƒ¨åˆ†å’Œå®ç°éƒ¨åˆ†ä¹‹é—´çš„è€¦åˆåº¦é™ä½ï¼Œä½¿ç³»ç»Ÿæ›´åŠ çµæ´»å’Œå¯ç»´æŠ¤ã€‚\nä¸¾ä¾‹ è€ƒè™‘ä¸€ä¸‹ä½ æ‹¥æœ‰ä¸€ç§å…·æœ‰ä¸åŒé™„é­”çš„æ­¦å™¨ï¼Œå¹¶ä¸”åº”è¯¥å…è®¸å°†å…·æœ‰ä¸åŒé™„é­”çš„ä¸åŒæ­¦å™¨æ··åˆä½¿ç”¨ã€‚ ä½ ä¼šæ€ä¹ˆåšï¼Ÿ ä¸ºæ¯ä¸ªé™„é­”åˆ›å»ºæ¯ç§æ­¦å™¨çš„å¤šä¸ªå‰¯æœ¬ï¼Œè¿˜æ˜¯åªæ˜¯åˆ›å»ºå•ç‹¬çš„é™„é­”å¹¶æ ¹æ®éœ€è¦ä¸ºæ­¦å™¨è®¾ç½®å®ƒï¼Ÿ æ¡¥æ¥æ¨¡å¼ä½¿æ‚¨å¯ä»¥è¿›è¡Œç¬¬äºŒæ¬¡æ“ä½œã€‚\nç¿»è¯‘ä¸€ä¸‹ä¸Šé¢çš„æ­¦å™¨ç¤ºä¾‹ã€‚ä¸‹é¢æˆ‘ä»¬æœ‰æ­¦å™¨çš„ç±»å±‚çº§ï¼š\npublic interface Weapon { void wield(); void swing(); void unwield(); Enchantment getEnchantment(); } public class Sword implements Weapon { private final Enchantment enchantment; public Sword(Enchantment enchantment) { this.enchantment = enchantment; } @Override public void wield() { LOGGER.info(\u0026#34;The sword is wielded.\u0026#34;); enchantment.onActivate(); } @Override public void swing() { LOGGER.info(\u0026#34;The sword is swinged.\u0026#34;); enchantment.apply(); } @Override public void unwield() { LOGGER.info(\u0026#34;The sword is unwielded.\u0026#34;); enchantment.onDeactivate(); } @Override public Enchantment getEnchantment() { return enchantment; } } public class Hammer implements Weapon { private final Enchantment enchantment; public Hammer(Enchantment enchantment) { this.enchantment = enchantment; } @Override public void wield() { LOGGER.info(\u0026#34;The hammer is wielded.\u0026#34;); enchantment.onActivate(); } @Override public void swing() { LOGGER.info(\u0026#34;The hammer is swinged.\u0026#34;); enchantment.apply(); } @Override public void unwield() { LOGGER.info(\u0026#34;The hammer is unwielded.\u0026#34;); enchantment.onDeactivate(); } @Override public Enchantment getEnchantment() { return enchantment; } } è¿™é‡Œæ˜¯å•ç‹¬çš„é™„é­”ç±»ç»“æ„ï¼š\npublic interface Enchantment { void onActivate(); void apply(); void onDeactivate(); } public class FlyingEnchantment implements Enchantment { @Override public void onActivate() { LOGGER.info(\u0026#34;The item begins to glow faintly.\u0026#34;); } @Override public void apply() { LOGGER.info(\u0026#34;The item flies and strikes the enemies finally returning to owner\u0026#39;s hand.\u0026#34;); } @Override public void onDeactivate() { LOGGER.info(\u0026#34;The item\u0026#39;s glow fades.\u0026#34;); } } public class SoulEatingEnchantment implements Enchantment { @Override public void onActivate() { LOGGER.info(\u0026#34;The item spreads bloodlust.\u0026#34;); } @Override public void apply() { LOGGER.info(\u0026#34;The item eats the soul of enemies.\u0026#34;); } @Override public void onDeactivate() { LOGGER.info(\u0026#34;Bloodlust slowly disappears.\u0026#34;); } } è¿™é‡Œæ˜¯ä¸¤ç§å±‚æ¬¡ç»“æ„çš„å®è·µï¼š\nvar enchantedSword = new Sword(new SoulEatingEnchantment()); enchantedSword.wield(); enchantedSword.swing(); enchantedSword.unwield(); // The sword is wielded. // The item spreads bloodlust. // The sword is swinged. // The item eats the soul of enemies. // The sword is unwielded. // Bloodlust slowly disappears. var hammer = new Hammer(new FlyingEnchantment()); hammer.wield(); hammer.swing(); hammer.unwield(); // The hammer is wielded. // The item begins to glow faintly. // The hammer is swinged. // The item flies and strikes the enemies finally returning to owner\u0026#39;s hand. // The hammer is unwielded. // The item\u0026#39;s glow fades. ç±»å›¾ é€‚ç”¨åœºæ™¯ æ¡¥æ¥æ¨¡å¼é€‚ç”¨äºä»¥ä¸‹æƒ…å†µï¼š\nå½“ä½ å¸Œæœ›åœ¨æŠ½è±¡éƒ¨åˆ†å’Œå®ç°éƒ¨åˆ†ä¹‹é—´å­˜åœ¨ç‹¬ç«‹çš„æ‰©å±•å’Œå˜åŒ–æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ¡¥æ¥æ¨¡å¼ã€‚è¿™æ ·å¯ä»¥é¿å…åœ¨ä¸¤ä¸ªå±‚æ¬¡ç»“æ„ä¹‹é—´çš„ç´§è€¦åˆå…³ç³»ï¼Œä½¿å®ƒä»¬å¯ä»¥ç›¸äº’ç‹¬ç«‹åœ°è¿›è¡Œä¿®æ”¹å’Œæ‰©å±•ã€‚ å½“ä½ æƒ³è¦é¿å…åœ¨ç¼–è¯‘æ—¶å°†æŠ½è±¡éƒ¨åˆ†ä¸å®ç°éƒ¨åˆ†ç»‘å®šåœ¨ä¸€èµ·æ—¶ï¼Œæ¡¥æ¥æ¨¡å¼æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚é€šè¿‡æ¡¥æ¥æ¨¡å¼ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°å°†æŠ½è±¡éƒ¨åˆ†å’Œå®ç°éƒ¨åˆ†è¿›è¡Œç»„åˆï¼Œè€Œä¸éœ€è¦ä¿®æ”¹å®¢æˆ·ç«¯çš„ä»£ç ã€‚ å½“ä½ æœ‰å¤šä¸ªç‹¬ç«‹å˜åŒ–çš„ç»´åº¦æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ¡¥æ¥æ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œåœ¨ç»™å®šçš„ç¤ºä¾‹ä¸­ï¼Œæ­¦å™¨å’Œé™„é­”æ˜¯ä¸¤ä¸ªç‹¬ç«‹å˜åŒ–çš„ç»´åº¦ï¼Œé€šè¿‡æ¡¥æ¥æ¨¡å¼å¯ä»¥çµæ´»åœ°ç»„åˆå®ƒä»¬ï¼Œè€Œä¸éœ€è¦ä¸ºæ¯ç§æ­¦å™¨å’Œæ¯ç§é™„é­”åˆ›å»ºå¤§é‡çš„å­ç±»ã€‚ æ€»çš„æ¥è¯´ï¼Œæ¡¥æ¥æ¨¡å¼é€‚ç”¨äºéœ€è¦åœ¨æŠ½è±¡ä¸å®ç°ä¹‹é—´å­˜åœ¨ç‹¬ç«‹å˜åŒ–å’Œç»„åˆçš„æƒ…å†µï¼Œä»¥åŠéœ€è¦åŠ¨æ€åœ°è¿›è¡Œé€‰æ‹©å’Œå…±äº«å®ç°çš„æƒ…å†µã€‚å®ƒèƒ½å¤Ÿæé«˜ç³»ç»Ÿçš„çµæ´»æ€§ã€å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚\nä¸¾ä¾‹ ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®é™…çš„ä¾‹å­ï¼Œä»¥å¸®åŠ©è¯´æ˜æ¡¥æ¥æ¨¡å¼çš„åº”ç”¨ã€‚\nå‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç»˜å›¾åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­åŒ…å«ä¸åŒç±»å‹çš„å½¢çŠ¶ï¼ˆå¦‚åœ†å½¢ã€çŸ©å½¢ï¼‰å’Œä¸åŒçš„é¢œè‰²ï¼ˆå¦‚çº¢è‰²ã€è“è‰²ï¼‰ã€‚ä½ å¸Œæœ›èƒ½å¤Ÿåœ¨ä»»æ„å½¢çŠ¶ä¸Šåº”ç”¨ä¸åŒçš„é¢œè‰²ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ç§å½¢çŠ¶å’Œé¢œè‰²çš„ç»„åˆåˆ›å»ºå¤§é‡çš„å­ç±»ã€‚\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨æ¡¥æ¥æ¨¡å¼æ¥å®ç°å½¢çŠ¶å’Œé¢œè‰²ä¹‹é—´çš„ç»„åˆã€‚é¦–å…ˆï¼Œå®šä¹‰ä¸€ä¸ªæŠ½è±¡çš„å½¢çŠ¶ç±» Shapeï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªé¢œè‰²å¯¹è±¡çš„å¼•ç”¨ã€‚ç„¶åï¼Œå®šä¹‰ä¸€ä¸ªæŠ½è±¡çš„é¢œè‰²ç±» Colorï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªç»˜åˆ¶æ–¹æ³•ã€‚é€šè¿‡æ¡¥æ¥æ¨¡å¼ï¼Œå°†å½¢çŠ¶å’Œé¢œè‰²è¿›è¡Œåˆ†ç¦»ï¼Œä½¿å®ƒä»¬å¯ä»¥ç‹¬ç«‹åœ°è¿›è¡Œæ‰©å±•å’Œå˜åŒ–ã€‚\nä¸‹é¢æ˜¯ç¤ºä¾‹ä»£ç ï¼š\n// å½¢çŠ¶æŠ½è±¡ç±» abstract class Shape { protected Color color; public Shape(Color color) { this.color = color; } public abstract void draw(); } // é¢œè‰²æŠ½è±¡ç±» interface Color { void applyColor(); } // å…·ä½“å½¢çŠ¶ç±»ï¼šåœ†å½¢ class Circle extends Shape { public Circle(Color color) { super(color); } @Override public void draw() { System.out.print(\u0026#34;ç»˜åˆ¶åœ†å½¢ï¼Œ\u0026#34;); color.applyColor(); } } // å…·ä½“å½¢çŠ¶ç±»ï¼šçŸ©å½¢ class Rectangle extends Shape { public Rectangle(Color color) { super(color); } @Override public void draw() { System.out.print(\u0026#34;ç»˜åˆ¶çŸ©å½¢ï¼Œ\u0026#34;); color.applyColor(); } } // å…·ä½“é¢œè‰²ç±»ï¼šçº¢è‰² class RedColor implements Color { @Override public void applyColor() { System.out.println(\u0026#34;ä½¿ç”¨çº¢è‰²\u0026#34;); } } // å…·ä½“é¢œè‰²ç±»ï¼šè“è‰² class BlueColor implements Color { @Override public void applyColor() { System.out.println(\u0026#34;ä½¿ç”¨è“è‰²\u0026#34;); } } ç°åœ¨ï¼Œä½ å¯ä»¥åˆ›å»ºä¸åŒçš„å½¢çŠ¶å¯¹è±¡ï¼Œå¹¶å°†ä¸åŒçš„é¢œè‰²å¯¹è±¡ä¸ä¹‹ç»„åˆï¼Œè€Œæ— éœ€åˆ›å»ºå¤§é‡çš„å­ç±»ã€‚ä¾‹å¦‚ï¼š\nShape redCircle = new Circle(new RedColor()); Shape blueRectangle = new Rectangle(new BlueColor()); redCircle.draw(); // è¾“å‡ºï¼šç»˜åˆ¶åœ†å½¢ï¼Œä½¿ç”¨çº¢è‰² blueRectangle.draw(); // è¾“å‡ºï¼šç»˜åˆ¶çŸ©å½¢ï¼Œä½¿ç”¨è“è‰² é€šè¿‡æ¡¥æ¥æ¨¡å¼ï¼Œä½ å¯ä»¥è½»æ¾åœ°æ‰©å±•å½¢çŠ¶å’Œé¢œè‰²çš„ç§ç±»ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹ç°æœ‰çš„ä»£ç ã€‚ä½ å¯ä»¥æ·»åŠ æ–°çš„å½¢çŠ¶æˆ–é¢œè‰²ç±»ï¼Œå¹¶å°†å®ƒä»¬ç»„åˆåœ¨ä¸€èµ·ï¼Œä»¥æ»¡è¶³ä¸åŒçš„éœ€æ±‚ï¼ŒåŒæ—¶ä¿æŒäº†å½¢çŠ¶å’Œé¢œè‰²ä¹‹é—´çš„ç‹¬ç«‹æ€§ã€‚\nå¼€æºæ¡†æ¶ä¸­çš„åº”ç”¨ åœ¨å¼€æºæ¡†æ¶ä¸­ï¼Œæœ‰ä¸€äº›ä½¿ç”¨æ¡¥æ¥æ¨¡å¼çš„ä¾‹å­ã€‚ä»¥ä¸‹æ˜¯å…¶ä¸­ä¸€äº›å¸¸è§çš„å¼€æºæ¡†æ¶å’Œå…¶ä½¿ç”¨æ¡¥æ¥æ¨¡å¼çš„ç¤ºä¾‹ï¼š\nJDBCï¼ˆJava æ•°æ®åº“è¿æ¥ï¼‰æ¡†æ¶ï¼šJDBC æ¡†æ¶æ˜¯ Java ä¸­ç”¨äºä¸æ•°æ®åº“è¿›è¡Œäº¤äº’çš„æ ‡å‡† APIã€‚åœ¨ JDBC ä¸­ï¼Œä½¿ç”¨äº†æ¡¥æ¥æ¨¡å¼æ¥è¿æ¥ä¸åŒçš„æ•°æ®åº“é©±åŠ¨ç¨‹åºå’Œåº”ç”¨ç¨‹åºã€‚æ¡¥æ¥æ¨¡å¼å°† JDBC API ä¸ç‰¹å®šçš„æ•°æ®åº“é©±åŠ¨ç¨‹åºå®ç°åˆ†ç¦»ï¼Œä½¿å¾—åº”ç”¨ç¨‹åºå¯ä»¥ç‹¬ç«‹äºä¸åŒçš„æ•°æ®åº“å®ç°è¿›è¡Œå¼€å‘ã€‚ AWTï¼ˆAbstract Window Toolkitï¼‰ï¼šAWT æ˜¯ Java ä¸­ç”¨äºåˆ›å»ºå›¾å½¢ç”¨æˆ·ç•Œé¢ï¼ˆGUIï¼‰çš„åŸå§‹å·¥å…·åŒ…ã€‚åœ¨ AWT ä¸­ï¼Œä½¿ç”¨äº†æ¡¥æ¥æ¨¡å¼æ¥åˆ†ç¦»æŠ½è±¡çš„ GUI ç»„ä»¶ï¼ˆä¾‹å¦‚æŒ‰é’®ã€æ–‡æœ¬æ¡†ï¼‰å’Œå…·ä½“çš„å¹³å°å®ç°ã€‚è¿™æ ·å¯ä»¥ä½¿å¾— AWT å¯ä»¥åœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®ä¸åŒçš„å¹³å°æä¾›ä¸åŒçš„å¤–è§‚å’Œè¡Œä¸ºã€‚ Spring æ¡†æ¶ï¼šSpring æ˜¯ä¸€ä¸ªå¼€æºçš„ Java ä¼ä¸šåº”ç”¨ç¨‹åºå¼€å‘æ¡†æ¶ã€‚åœ¨ Spring ä¸­ï¼Œä½¿ç”¨äº†æ¡¥æ¥æ¨¡å¼æ¥å®ç°ä¸åŒå±‚ä¹‹é—´çš„è§£è€¦ã€‚ä¾‹å¦‚ï¼ŒSpring çš„æ•°æ®è®¿é—®æ¨¡å—ï¼ˆSpring Dataï¼‰ä½¿ç”¨äº†æ¡¥æ¥æ¨¡å¼æ¥è¿æ¥ä¸åŒçš„æ•°æ®è®¿é—®æŠ€æœ¯ï¼Œå¦‚ JPAã€Hibernateã€MyBatis ç­‰ã€‚è¿™æ ·ï¼Œå¼€å‘äººå‘˜å¯ä»¥é€‰æ‹©é€‚åˆå…¶éœ€æ±‚çš„æ•°æ®è®¿é—®æŠ€æœ¯ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹å…¶ä»–éƒ¨åˆ†çš„ä»£ç ã€‚ Apache Log4jï¼šLog4j æ¡†æ¶ä½¿ç”¨äº†æ¡¥æ¥æ¨¡å¼å°†æ—¥å¿—è®°å½•å™¨ï¼ˆLoggerï¼‰ä¸å…·ä½“çš„æ—¥å¿—è¾“å‡ºï¼ˆAppenderï¼‰åˆ†ç¦»ã€‚é€šè¿‡Loggeræ¥å£å’ŒAppenderæ¥å£çš„ç»„åˆä½¿ç”¨ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°å°†æ—¥å¿—è®°å½•å™¨ä¸ä¸åŒçš„æ—¥å¿—è¾“å‡ºå®ç°è¿›è¡Œæ¡¥æ¥ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å°†Loggeræ¡¥æ¥åˆ°FileAppenderã€ConsoleAppenderæˆ–DatabaseAppenderç­‰ä¸åŒçš„å…·ä½“å®ç°ä¸Šã€‚ Apache Commons IOï¼šCommons IO æ˜¯ Apache Commons é¡¹ç›®çš„ä¸€éƒ¨åˆ†ï¼Œæä¾›äº†ä¸€ç»„ç”¨äºå¤„ç† I/O æ“ä½œçš„å®ç”¨å·¥å…·ã€‚åœ¨ Commons IO ä¸­ï¼Œä½¿ç”¨äº†æ¡¥æ¥æ¨¡å¼æ¥åˆ†ç¦»æŠ½è±¡çš„ I/O æ“ä½œï¼ˆå¦‚æ–‡ä»¶è¯»å†™ã€æµå¤„ç†ï¼‰å’Œå…·ä½“çš„å®ç°ã€‚è¿™ä½¿å¾—å¼€å‘äººå‘˜å¯ä»¥åœ¨ä¸åŒçš„ç¯å¢ƒä¸­ä½¿ç”¨ç›¸åŒçš„ API è¿›è¡Œ I/O æ“ä½œã€‚ Hibernate ORMï¼šHibernate ä½¿ç”¨äº†æ¡¥æ¥æ¨¡å¼å°†ä¸åŒæ•°æ®åº“å‚å•†çš„é©±åŠ¨ç¨‹åºä¸æ ¸å¿ƒåŠŸèƒ½åˆ†ç¦»ã€‚å®ƒé€šè¿‡DriverManageræ¥å£å’Œå…·ä½“çš„æ•°æ®åº“é©±åŠ¨ç¨‹åºå®ç°çš„æ¡¥æ¥ï¼Œèƒ½å¤Ÿåœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°é€‰æ‹©å’Œåˆ‡æ¢æ•°æ®åº“é©±åŠ¨ç¨‹åºã€‚è¿™æ ·ï¼Œå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨ç›¸åŒçš„ Hibernate API ä¸ä¸åŒçš„æ•°æ®åº“è¿›è¡Œäº¤äº’ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹æ ¸å¿ƒä»£ç ã€‚ Retrofitï¼šRetrofit åº“ä½¿ç”¨äº†æ¡¥æ¥æ¨¡å¼æ¥å°†ç½‘ç»œè¯·æ±‚çš„æŠ½è±¡è¡¨ç¤ºä¸å…·ä½“çš„ HTTP å®¢æˆ·ç«¯å®ç°åˆ†ç¦»ã€‚å®ƒé€šè¿‡Callæ¥å£å’ŒHttpClientæ¥å£çš„ç»„åˆä½¿ç”¨ï¼Œå¯ä»¥å°†ä¸åŒçš„ HTTP å®¢æˆ·ç«¯åº“ï¼ˆå¦‚ OkHttpã€Apache HttpClientï¼‰æ¡¥æ¥åˆ°ç»Ÿä¸€çš„ç½‘ç»œè¯·æ±‚æŠ½è±¡ä¸Šã€‚è¿™ä½¿å¾—å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©ä¸åŒçš„ HTTP å®¢æˆ·ç«¯å®ç°ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹ä½¿ç”¨ Retrofit çš„ä»£ç ã€‚ Apache HttpClientï¼šHttpClient æ˜¯ Apache è½¯ä»¶åŸºé‡‘ä¼šæä¾›çš„ä¸€ä¸ªç”¨äºå‘é€ HTTP è¯·æ±‚çš„ Java åº“ã€‚å®ƒä½¿ç”¨äº†æ¡¥æ¥æ¨¡å¼æ¥å°†æŠ½è±¡çš„ HTTP è¯·æ±‚å’Œå…·ä½“çš„ HTTP åè®®å®ç°ï¼ˆå¦‚ HTTP/1.1 æˆ– HTTP/2ï¼‰åˆ†ç¦»ã€‚è¿™ä½¿å¾—å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©ä¸åŒçš„ HTTP åè®®ç‰ˆæœ¬ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹ä»£ç ã€‚ Apache Commons Loggingï¼šCommons Logging æ˜¯ Apache Commons é¡¹ç›®ä¸­çš„ä¸€ä¸ªé€šç”¨æ—¥å¿—è®°å½•æ¥å£ã€‚å®ƒä½¿ç”¨äº†æ¡¥æ¥æ¨¡å¼æ¥å°†åº”ç”¨ç¨‹åºä»£ç ä¸åº•å±‚çš„å…·ä½“æ—¥å¿—å®ç°ï¼ˆå¦‚ Log4jã€java.util.logging ç­‰ï¼‰åˆ†ç¦»ã€‚è¿™ä½¿å¾—å¼€å‘äººå‘˜å¯ä»¥åœ¨ä¸åŒçš„ç¯å¢ƒä¸­åˆ‡æ¢å’Œé…ç½®ä¸åŒçš„æ—¥å¿—å®ç°ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºäº†æ¡¥æ¥æ¨¡å¼åœ¨ JDBC æ¡†æ¶ä¸­çš„åº”ç”¨ï¼š\né¦–å…ˆï¼Œå®šä¹‰æ¡¥æ¥æ¥å£ DatabaseDriverï¼Œå®ƒåŒ…å«äº†æ•°æ®åº“æ“ä½œçš„æ–¹æ³•å£°æ˜ï¼š\npublic interface DatabaseDriver { void connect(String url, String username, String password); void executeQuery(String query); void disconnect(); } ç„¶åï¼Œå®ç°å…·ä½“çš„æ•°æ®åº“é©±åŠ¨ç¨‹åºï¼Œä¾‹å¦‚ MySQLDriver å’Œ OracleDriverï¼Œå®ƒä»¬å®ç°äº† DatabaseDriver æ¥å£ï¼š\npublic class MySQLDriver implements DatabaseDriver { // MySQLæ•°æ®åº“ç‰¹å®šçš„å®ç°ä»£ç  @Override public void connect(String url, String username, String password) { // è¿æ¥MySQLæ•°æ®åº“çš„ä»£ç  } @Override public void executeQuery(String query) { // æ‰§è¡ŒMySQLæŸ¥è¯¢çš„ä»£ç  } @Override public void disconnect() { // æ–­å¼€MySQLæ•°æ®åº“è¿æ¥çš„ä»£ç  } } public class OracleDriver implements DatabaseDriver { // Oracleæ•°æ®åº“ç‰¹å®šçš„å®ç°ä»£ç  @Override public void connect(String url, String username, String password) { // è¿æ¥Oracleæ•°æ®åº“çš„ä»£ç  } @Override public void executeQuery(String query) { // æ‰§è¡ŒOracleæŸ¥è¯¢çš„ä»£ç  } @Override public void disconnect() { // æ–­å¼€Oracleæ•°æ®åº“è¿æ¥çš„ä»£ç  } } æ¥ä¸‹æ¥ï¼Œå®šä¹‰ä½¿ç”¨æ¡¥æ¥æ¨¡å¼çš„åº”ç”¨ç¨‹åºä»£ç ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€ä¸ª Database ç±»ä½œä¸ºæŠ½è±¡åŒ–è§’è‰²ï¼Œå®ƒä½¿ç”¨æ¡¥æ¥æ¥å£ DatabaseDriver è¿›è¡Œæ•°æ®åº“æ“ä½œï¼š\npublic class Database { private DatabaseDriver driver; public Database(DatabaseDriver driver) { this.driver = driver; } public void connectToDatabase(String url, String username, String password) { driver.connect(url, username, password); } public void executeQuery(String query) { driver.executeQuery(query); } public void disconnectFromDatabase() { driver.disconnect(); } } æœ€åï¼Œå¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨è¿™äº›ç±»è¿›è¡Œæ•°æ®åº“æ“ä½œï¼š\npublic class Main { public static void main(String[] args) { // åˆ›å»ºMySQLDriverå®ä¾‹ DatabaseDriver mysqlDriver = new MySQLDriver(); // åˆ›å»ºDatabaseå®ä¾‹ï¼Œå¹¶ä½¿ç”¨MySQLDriverè¿›è¡Œæ“ä½œ Database mysqlDatabase = new Database(mysqlDriver); // è¿æ¥åˆ°MySQLæ•°æ®åº“ mysqlDatabase.connectToDatabase(\u0026#34;jdbc:mysql://localhost:3306/mydb\u0026#34;, \u0026#34;username\u0026#34;, \u0026#34;password\u0026#34;); // æ‰§è¡ŒMySQLæŸ¥è¯¢ mysqlDatabase.executeQuery(\u0026#34;SELECT * FROM mytable\u0026#34;); // æ–­å¼€MySQLæ•°æ®åº“è¿æ¥ mysqlDatabase.disconnectFromDatabase(); // åˆ›å»ºOracleDriverå®ä¾‹ DatabaseDriver oracleDriver = new OracleDriver(); // åˆ›å»ºDatabaseå®ä¾‹ï¼Œå¹¶ä½¿ç”¨OracleDriverè¿›è¡Œæ“ä½œ Database oracleDatabase = new Database(oracleDriver); // è¿æ¥åˆ°Oracleæ•°æ®åº“ oracleDatabase.connectToDatabase(\u0026#34;jdbc:oracle:thin:@localhost:1521:xe\u0026#34;, \u0026#34;username\u0026#34;, \u0026#34;password\u0026#34;); // æ‰§è¡ŒOracleæŸ¥è¯¢ oracleDatabase.executeQuery(\u0026#34;SELECT * FROM mytable\u0026#34;); // æ–­å¼€Oracleæ•°æ®åº“è¿æ¥ oracleDatabase.disconnectFromDatabase(); } } è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ¡¥æ¥æ¨¡å¼å°† JDBC API ä¸ç‰¹å®šçš„æ•°æ®åº“é©±åŠ¨ç¨‹åºå®ç°åˆ†ç¦»ã€‚é€šè¿‡åˆ›å»ºä¸åŒçš„æ•°æ®åº“é©±åŠ¨ç¨‹åºå®ä¾‹ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™ Database ç±»ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ç‹¬ç«‹äºä¸åŒçš„æ•°æ®åº“å®ç°è¿›è¡Œå¼€å‘å’Œæ“ä½œã€‚\nå‚è€ƒæ–‡ç«  https://www.digitalocean.com/community/tutorials/bridge-design-pattern-java ","permalink":"https://blog.chensoul.cc/posts/2023/08/28/java-design-patterns-bridge/","summary":"æœ¬æ–‡ä¸»è¦ä»‹ç» Bridge æ¡¥æ¥æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nä»‹ç» æ¡¥æ¥æ¨¡å¼ï¼ˆBridge Patternï¼‰æ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œç”¨äºå°†æŠ½è±¡ä¸å…¶å®ç°åˆ†ç¦»ï¼Œä½¿å®ƒä»¬å¯ä»¥ç‹¬ç«‹åœ°å˜åŒ–ã€‚æ¡¥æ¥æ¨¡å¼é€šè¿‡åˆ›å»ºä¸¤ä¸ªç‹¬ç«‹çš„å±‚æ¬¡ç»“æ„ï¼Œä¸€ä¸ªæ˜¯æŠ½è±¡éƒ¨åˆ†ï¼Œä¸€ä¸ªæ˜¯å®ç°éƒ¨åˆ†ï¼Œæ¥å®ç°è¿™ç§åˆ†ç¦»ã€‚\nåœ¨æ¡¥æ¥æ¨¡å¼ä¸­ï¼ŒæŠ½è±¡éƒ¨åˆ†åŒ…å«æŠ½è±¡ç±»æˆ–æ¥å£ï¼Œå®šä¹‰äº†é«˜å±‚é€»è¾‘å’ŒåŠŸèƒ½ã€‚å®ç°éƒ¨åˆ†åŒ…å«å…·ä½“å®ç°ç±»ï¼Œè´Ÿè´£å®ç°æŠ½è±¡éƒ¨åˆ†å®šä¹‰çš„æ¥å£æˆ–æ–¹æ³•ã€‚é€šè¿‡æ¡¥æ¥æ¨¡å¼ï¼Œå¯ä»¥åœ¨ä¸¤ä¸ªå±‚æ¬¡ç»“æ„ä¸­ç‹¬ç«‹åœ°æ‰©å±•å’Œå˜åŒ–ç±»ï¼Œè€Œä¸ä¼šç›¸äº’å½±å“ã€‚åŒæ—¶ï¼ŒæŠ½è±¡éƒ¨åˆ†å’Œå®ç°éƒ¨åˆ†ä¹‹é—´çš„è€¦åˆåº¦é™ä½ï¼Œä½¿ç³»ç»Ÿæ›´åŠ çµæ´»å’Œå¯ç»´æŠ¤ã€‚\nä¸¾ä¾‹ è€ƒè™‘ä¸€ä¸‹ä½ æ‹¥æœ‰ä¸€ç§å…·æœ‰ä¸åŒé™„é­”çš„æ­¦å™¨ï¼Œå¹¶ä¸”åº”è¯¥å…è®¸å°†å…·æœ‰ä¸åŒé™„é­”çš„ä¸åŒæ­¦å™¨æ··åˆä½¿ç”¨ã€‚ ä½ ä¼šæ€ä¹ˆåšï¼Ÿ ä¸ºæ¯ä¸ªé™„é­”åˆ›å»ºæ¯ç§æ­¦å™¨çš„å¤šä¸ªå‰¯æœ¬ï¼Œè¿˜æ˜¯åªæ˜¯åˆ›å»ºå•ç‹¬çš„é™„é­”å¹¶æ ¹æ®éœ€è¦ä¸ºæ­¦å™¨è®¾ç½®å®ƒï¼Ÿ æ¡¥æ¥æ¨¡å¼ä½¿æ‚¨å¯ä»¥è¿›è¡Œç¬¬äºŒæ¬¡æ“ä½œã€‚\nç¿»è¯‘ä¸€ä¸‹ä¸Šé¢çš„æ­¦å™¨ç¤ºä¾‹ã€‚ä¸‹é¢æˆ‘ä»¬æœ‰æ­¦å™¨çš„ç±»å±‚çº§ï¼š\npublic interface Weapon { void wield(); void swing(); void unwield(); Enchantment getEnchantment(); } public class Sword implements Weapon { private final Enchantment enchantment; public Sword(Enchantment enchantment) { this.enchantment = enchantment; } @Override public void wield() { LOGGER.info(\u0026#34;The sword is wielded.\u0026#34;); enchantment.onActivate(); } @Override public void swing() { LOGGER.info(\u0026#34;The sword is swinged.\u0026#34;); enchantment.apply(); } @Override public void unwield() { LOGGER.info(\u0026#34;The sword is unwielded.\u0026#34;); enchantment.onDeactivate(); } @Override public Enchantment getEnchantment() { return enchantment; } } public class Hammer implements Weapon { private final Enchantment enchantment; public Hammer(Enchantment enchantment) { this.","title":"Javaè®¾è®¡æ¨¡å¼ï¼šBridge"},{"content":"æœ¬æ–‡ä¸»è¦ä»‹ç» Balking æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nä»‹ç» æ­¢æ­¥æ¨¡å¼ï¼ˆBalkingï¼‰æ˜¯ä¸€ç§åœ¨å¯¹è±¡å¤„äºç‰¹å®šçŠ¶æ€æ—¶æ‰æ‰§è¡Œæ“ä½œçš„è®¾è®¡æ¨¡å¼ã€‚å®ƒç”¨äºé˜²æ­¢å¯¹è±¡åœ¨ä¸å®Œæ•´æˆ–ä¸åˆé€‚çš„çŠ¶æ€ä¸‹æ‰§è¡ŒæŸäº›ä»£ç ï¼Œä»è€Œç¡®ä¿ä»£ç çš„æ­£ç¡®æ€§å’Œä¸€è‡´æ€§ã€‚\nè¯¥æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œåœ¨æ‰§è¡Œæ“ä½œä¹‹å‰ï¼Œæ£€æŸ¥å¯¹è±¡çš„çŠ¶æ€ï¼Œå¹¶åªåœ¨ç‰¹å®šçš„çŠ¶æ€ä¸‹æ‰æ‰§è¡Œæ“ä½œã€‚å¦‚æœå¯¹è±¡ä¸å¤„äºé¢„æœŸçŠ¶æ€ï¼Œæ“ä½œå°†è¢«å¿½ç•¥æˆ–æ¨è¿Ÿæ‰§è¡Œï¼Œä»è€Œé¿å…äº†ä¸å¿…è¦çš„æ“ä½œæˆ–ä¸ä¸€è‡´çš„çŠ¶æ€è½¬æ¢ã€‚\nä»¥ä¸‹æ˜¯æ­¢æ­¥æ¨¡å¼çš„è¦ç‚¹å’Œç¤ºä¾‹ï¼š\nå¯¹è±¡çŠ¶æ€æ£€æŸ¥ï¼šåœ¨æ‰§è¡Œæ“ä½œä¹‹å‰ï¼Œå¯¹è±¡ä¼šæ£€æŸ¥è‡ªèº«çš„çŠ¶æ€ã€‚è¿™å¯ä»¥é€šè¿‡ä½¿ç”¨æ¡ä»¶è¯­å¥æˆ–çŠ¶æ€æ ‡å¿—æ¥å®ç°ã€‚ ç‰¹å®šçŠ¶æ€æ‰§è¡Œï¼šåªæœ‰å½“å¯¹è±¡å¤„äºç‰¹å®šçŠ¶æ€æ—¶ï¼Œæ“ä½œæ‰ä¼šè¢«æ‰§è¡Œã€‚å¦‚æœå¯¹è±¡ä¸æ»¡è¶³æ‰§è¡Œæ¡ä»¶ï¼Œæ“ä½œå°†è¢«å¿½ç•¥æˆ–æ¨è¿Ÿæ‰§è¡Œã€‚ çº¿ç¨‹å®‰å…¨è€ƒè™‘ï¼šç”±äºæ­¢æ­¥æ¨¡å¼é€šå¸¸æ¶‰åŠå¤šçº¿ç¨‹ç¯å¢ƒï¼Œéœ€è¦ç¡®ä¿å¯¹å…±äº«èµ„æºçš„è®¿é—®æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¯ä»¥ä½¿ç”¨åŒæ­¥æœºåˆ¶ï¼ˆå¦‚ synchronized å…³é”®å­—ï¼‰æ¥ä¿æŠ¤å…±äº«èµ„æºã€‚ è§£é‡Š çœŸå®ä¸–ç•Œä¾‹å­\næ´—è¡£æœºä¸­æœ‰ä¸€ä¸ªå¼€å§‹æŒ‰é’®ï¼Œç”¨äºå¯åŠ¨è¡£ç‰©æ´—æ¶¤ã€‚å½“æ´—è¡£æœºå¤„äºéæ´»åŠ¨çŠ¶æ€æ—¶ï¼ŒæŒ‰é’®å°†æŒ‰é¢„æœŸå·¥ä½œï¼Œä½†æ˜¯å¦‚æœå·²ç»åœ¨æ´—æ¶¤ï¼Œåˆ™æŒ‰é’®å°†ä¸èµ·ä»»ä½•ä½œç”¨ã€‚\né€šä¿—åœ°è¯´\nä½¿ç”¨æ­¢æ­¥æ¨¡å¼ï¼Œä»…å½“å¯¹è±¡å¤„äºç‰¹å®šçŠ¶æ€æ—¶æ‰æ‰§è¡Œç‰¹å®šä»£ç ã€‚\nç»´åŸºç™¾ç§‘è¯´\nç¦æ­¢æ¨¡å¼æ˜¯ä¸€ç§è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼Œä»…å½“å¯¹è±¡å¤„äºç‰¹å®šçŠ¶æ€æ—¶æ‰å¯¹å¯¹è±¡æ‰§è¡Œæ“ä½œã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå¯¹è±¡è¯»å– zip å‹ç¼©æ–‡ä»¶å¹¶åœ¨å‹ç¼©æ–‡ä»¶æ²¡æ‰“å¼€çš„æ—¶å€™è°ƒç”¨ get æ–¹æ³•ï¼Œå¯¹è±¡å°†åœ¨è¯·æ±‚çš„æ—¶å€™â€æ­¢æ­¥â€œã€‚\nç¨‹åºç¤ºä¾‹\nåœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ WashingMachineæ˜¯ä¸€ä¸ªå…·æœ‰ä¸¤ä¸ªçŠ¶æ€çš„å¯¹è±¡ï¼Œå¯ä»¥å¤„äºä¸¤ç§çŠ¶æ€ï¼šENABLED å’ŒWASHINGã€‚ å¦‚æœæœºå™¨å·²å¯ç”¨ï¼Œåˆ™ä½¿ç”¨çº¿ç¨‹å®‰å…¨æ–¹æ³•å°†çŠ¶æ€æ›´æ”¹ä¸º WASHINGã€‚ å¦ä¸€æ–¹é¢ï¼Œå¦‚æœå·²ç»è¿›è¡Œäº†æ¸…æ´—å¹¶ä¸”ä»»ä½•å…¶ä»–çº¿ç¨‹æ‰§è¡Œ washï¼ˆï¼‰ï¼Œåˆ™å®ƒå°†ä¸æ‰§è¡Œè¯¥æ“ä½œï¼Œè€Œæ˜¯ä¸æ‰§è¡Œä»»ä½•æ“ä½œè€Œè¿”å›ã€‚\nè¿™é‡Œæ˜¯ WashingMachine ç±»ç›¸å…³çš„éƒ¨åˆ†ã€‚\n@Slf4j public class WashingMachine { private final DelayProvider delayProvider; private WashingMachineState washingMachineState; public WashingMachine(DelayProvider delayProvider) { this.delayProvider = delayProvider; this.washingMachineState = WashingMachineState.ENABLED; } public WashingMachineState getWashingMachineState() { return washingMachineState; } public void wash() { synchronized (this) { var machineState = getWashingMachineState(); LOGGER.info(\u0026#34;{}: Actual machine state: {}\u0026#34;, Thread.currentThread().getName(), machineState); if (this.washingMachineState == WashingMachineState.WASHING) { LOGGER.error(\u0026#34;Cannot wash if the machine has been already washing!\u0026#34;); return; } this.washingMachineState = WashingMachineState.WASHING; } LOGGER.info(\u0026#34;{}: Doing the washing\u0026#34;, Thread.currentThread().getName()); this.delayProvider.executeAfterDelay(50, TimeUnit.MILLISECONDS, this::endOfWashing); } public synchronized void endOfWashing() { washingMachineState = WashingMachineState.ENABLED; LOGGER.info(\u0026#34;{}: Washing completed.\u0026#34;, Thread.currentThread().getId()); } } è¿™é‡Œæ˜¯ä¸€ä¸ª WashingMachine æ‰€ä½¿ç”¨çš„ DelayProvider ç®€å•æ¥å£ã€‚\npublic interface DelayProvider { void executeAfterDelay(long interval, TimeUnit timeUnit, Runnable task); } ç°åœ¨ï¼Œæˆ‘ä»¬ä½¿ç”¨WashingMachineä»‹ç»è¯¥åº”ç”¨ç¨‹åºã€‚\npublic static void main(String... args) { final var washingMachine = new WashingMachine(); var executorService = Executors.newFixedThreadPool(3); for (int i = 0; i \u0026lt; 3; i++) { executorService.execute(washingMachine::wash); } executorService.shutdown(); try { executorService.awaitTermination(10, TimeUnit.SECONDS); } catch (InterruptedException ie) { LOGGER.error(\u0026#34;ERROR: Waiting on executor service shutdown!\u0026#34;); Thread.currentThread().interrupt(); } } ä¸‹é¢æ˜¯ç¨‹åºçš„è¾“å‡ºã€‚\n14:02:52.268 [pool-1-thread-2] INFO com.iluwatar.balking.WashingMachine - pool-1-thread-2: Actual machine state: ENABLED 14:02:52.272 [pool-1-thread-2] INFO com.iluwatar.balking.WashingMachine - pool-1-thread-2: Doing the washing 14:02:52.272 [pool-1-thread-3] INFO com.iluwatar.balking.WashingMachine - pool-1-thread-3: Actual machine state: WASHING 14:02:52.273 [pool-1-thread-3] ERROR com.iluwatar.balking.WashingMachine - Cannot wash if the machine has been already washing! 14:02:52.273 [pool-1-thread-1] INFO com.iluwatar.balking.WashingMachine - pool-1-thread-1: Actual machine state: WASHING 14:02:52.273 [pool-1-thread-1] ERROR com.iluwatar.balking.WashingMachine - Cannot wash if the machine has been already washing! 14:02:52.324 [pool-1-thread-2] INFO com.iluwatar.balking.WashingMachine - 14: Washing completed. åœ¨ç¤ºä¾‹ä¸­ï¼Œæ´—è¡£æœºï¼ˆWashingMachineï¼‰æ˜¯ä¸€ä¸ªå…·æœ‰ä¸¤ä¸ªçŠ¶æ€çš„å¯¹è±¡ï¼šENABLEDï¼ˆå·²å¯ç”¨ï¼‰å’Œ WASHINGï¼ˆæ­£åœ¨æ´—æ¶¤ï¼‰ã€‚é€šè¿‡ä½¿ç”¨åŒæ­¥æ–¹æ³•å’ŒçŠ¶æ€æ£€æŸ¥ï¼Œæ´—è¡£æœºå¯ä»¥ç¡®ä¿åœ¨æ­£ç¡®çš„çŠ¶æ€ä¸‹æ‰§è¡Œç‰¹å®šçš„ä»£ç ã€‚å¦‚æœæ´—è¡£æœºå·²ç»åœ¨æ´—æ¶¤è¿‡ç¨‹ä¸­ï¼Œå†æ¬¡è°ƒç”¨æ´—æ¶¤æ–¹æ³•æ—¶å°†ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚\nä½¿ç”¨æ­¢æ­¥æ¨¡å¼å¯ä»¥ç¡®ä¿æ´—è¡£æœºåœ¨é€‚å½“çš„çŠ¶æ€ä¸‹æ‰§è¡Œæ´—æ¶¤æ“ä½œï¼Œé¿å…äº†é‡å¤æ´—æ¶¤æˆ–å¹¶å‘å†²çªã€‚\nç±»å›¾ é€‚ç”¨åœºæ™¯ æ­¢æ­¥æ¨¡å¼é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š\nå¯¹è±¡çŠ¶æ€ä¾èµ–ï¼šå½“å¯¹è±¡çš„æ“ä½œä¾èµ–äºå…¶å½“å‰çŠ¶æ€æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¢æ­¥æ¨¡å¼æ¥ç¡®ä¿æ“ä½œåªåœ¨ç‰¹å®šçŠ¶æ€ä¸‹æ‰§è¡Œã€‚è¿™å¯ä»¥é¿å…åœ¨å¯¹è±¡çŠ¶æ€ä¸ç¬¦åˆè¦æ±‚æ—¶æ‰§è¡Œæ— æ•ˆæˆ–æœ‰å®³çš„æ“ä½œã€‚ çŠ¶æ€è½¬æ¢æ§åˆ¶ï¼šå½“å¯¹è±¡éœ€è¦åœ¨ç‰¹å®šçŠ¶æ€ä¹‹é—´è¿›è¡Œè½¬æ¢æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¢æ­¥æ¨¡å¼æ¥æ§åˆ¶çŠ¶æ€è½¬æ¢çš„å‘ç”Ÿã€‚å®ƒå¯ä»¥é˜²æ­¢ä¸æ­£ç¡®çš„çŠ¶æ€è½¬æ¢å’Œä¸ä¸€è‡´çš„å¯¹è±¡çŠ¶æ€ã€‚ ç½‘ç»œè¿æ¥ç®¡ç†ï¼šåœ¨ä¸€ä¸ªç½‘ç»œåº”ç”¨ç¨‹åºä¸­ï¼Œå½“éœ€è¦ä¸è¿œç¨‹æœåŠ¡å™¨å»ºç«‹è¿æ¥æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¢æ­¥æ¨¡å¼æ¥ç¡®ä¿åªåœ¨æœªå»ºç«‹è¿æ¥æˆ–å·²æ–­å¼€è¿æ¥çš„çŠ¶æ€ä¸‹æ‰§è¡Œè¿æ¥æ“ä½œã€‚è¿™æ ·å¯ä»¥é¿å…é‡å¤è¿æ¥ã€å¹¶å‘è¿æ¥æˆ–åœ¨æ— æ•ˆè¿æ¥ä¸Šæ‰§è¡Œæ“ä½œã€‚ ç³»ç»Ÿå¯åŠ¨å’Œå…³é—­æ§åˆ¶ï¼šåœ¨ç³»ç»Ÿçš„å¯åŠ¨å’Œå…³é—­è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½éœ€è¦é™åˆ¶æŸäº›æ“ä½œåªåœ¨ç‰¹å®šé˜¶æ®µæ‰§è¡Œã€‚ä½¿ç”¨æ­¢æ­¥æ¨¡å¼ï¼Œå¯ä»¥æ£€æŸ¥ç³»ç»Ÿçš„çŠ¶æ€ï¼Œå¹¶åªå…è®¸åœ¨ç‰¹å®šé˜¶æ®µæ‰§è¡Œç›¸åº”çš„æ“ä½œï¼Œä»¥ç¡®ä¿ç³»ç»Ÿçš„æ­£ç¡®å¯åŠ¨å’Œå®‰å…¨å…³é—­ã€‚ å¹¶å‘ç¯å¢ƒä¸‹çš„çŠ¶æ€åŒæ­¥ï¼šåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œæ­¢æ­¥æ¨¡å¼å¯ä»¥ç”¨äºåŒæ­¥å¯¹è±¡çš„çŠ¶æ€ï¼Œä»¥ç¡®ä¿åœ¨å¹¶å‘è®¿é—®æ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œç‰¹å®šæ“ä½œã€‚å®ƒå¯ä»¥é¿å…å¹¶å‘å†²çªå’Œæ•°æ®æŸåã€‚ å¹¶å‘ä»»åŠ¡è°ƒåº¦ï¼šè€ƒè™‘ä¸€ä¸ªä»»åŠ¡è°ƒåº¦å™¨ï¼Œå…è®¸æ·»åŠ å’Œæ‰§è¡Œä»»åŠ¡ã€‚å¦‚æœåœ¨ä»»åŠ¡æ‰§è¡ŒæœŸé—´å°è¯•æ·»åŠ æ–°ä»»åŠ¡ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¹¶å‘å†²çªæˆ–æ‰§è¡Œä¸ä¸€è‡´çš„ç»“æœã€‚é€šè¿‡ä½¿ç”¨æ­¢æ­¥æ¨¡å¼ï¼Œåœ¨ä»»åŠ¡æ‰§è¡Œå¼€å§‹æ—¶æ£€æŸ¥ä»»åŠ¡è°ƒåº¦å™¨çš„çŠ¶æ€ï¼Œå¹¶åªå…è®¸åœ¨ç‰¹å®šçŠ¶æ€ä¸‹æ·»åŠ æ–°ä»»åŠ¡ï¼Œå¯ä»¥é¿å…å¹¶å‘å†²çªå’Œä¸ä¸€è‡´çš„ä»»åŠ¡æ‰§è¡Œã€‚ èµ„æºè®¿é—®æ§åˆ¶ï¼šå½“å¤šä¸ªå¯¹è±¡éœ€è¦è®¿é—®å…±äº«èµ„æºæ—¶ï¼Œæ­¢æ­¥æ¨¡å¼å¯ä»¥ç”¨äºæ§åˆ¶å¯¹èµ„æºçš„è®¿é—®ã€‚å®ƒå¯ä»¥é˜²æ­¢å¤šä¸ªå¯¹è±¡åŒæ—¶è®¿é—®æˆ–ä¿®æ”¹èµ„æºï¼Œä»è€Œç¡®ä¿èµ„æºçš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚ æ–‡ä»¶è¯»å†™æ“ä½œï¼šå‡è®¾æœ‰ä¸€ä¸ªæ–‡ä»¶å¤„ç†ç±»ï¼Œå…¶ä¸­æŸä¸ªæ–¹æ³•è´Ÿè´£è¯»å–æ–‡ä»¶çš„å†…å®¹å¹¶è¿”å›ã€‚å¦‚æœæ–‡ä»¶æ­£åœ¨è¢«å†™å…¥æˆ–ä¿®æ”¹ï¼Œé‚£ä¹ˆè¯»å–æ“ä½œå¯èƒ½ä¼šå¯¼è‡´ä¸ä¸€è‡´çš„ç»“æœã€‚ä½¿ç”¨æ­¢æ­¥æ¨¡å¼ï¼Œå¯ä»¥åœ¨è¯»å–æ“ä½œå¼€å§‹æ—¶æ£€æŸ¥æ–‡ä»¶çš„çŠ¶æ€ï¼Œå¦‚æœæ–‡ä»¶æ­£åœ¨è¢«å†™å…¥ï¼Œåˆ™æ¨è¿Ÿè¯»å–æ“ä½œæˆ–ç›´æ¥å¿½ç•¥ã€‚ ç¼“å­˜æ›´æ–°æ§åˆ¶ï¼šåœ¨ç¼“å­˜ç³»ç»Ÿä¸­ï¼Œå½“æŸä¸ªç¼“å­˜é¡¹è¿‡æœŸæ—¶éœ€è¦æ›´æ–°ï¼Œä½†åŒæ—¶å¯èƒ½æœ‰å¤šä¸ªè¯·æ±‚åŒæ—¶åˆ°è¾¾ã€‚ä½¿ç”¨æ­¢æ­¥æ¨¡å¼ï¼Œå¯ä»¥åœ¨æ›´æ–°æ“ä½œå¼€å§‹æ—¶æ£€æŸ¥ç¼“å­˜é¡¹çš„çŠ¶æ€ï¼Œå¹¶åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œæ›´æ–°æ“ä½œï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…æˆ–å¿½ç•¥æ›´æ–°è¯·æ±‚ï¼Œä»è€Œç¡®ä¿ç¼“å­˜çš„ä¸€è‡´æ€§å’Œé¿å…å¹¶å‘å†²çªã€‚ é”™è¯¯å¤„ç†å’Œå¼‚å¸¸é¿å…ï¼šæ­¢æ­¥æ¨¡å¼å¯ä»¥ç”¨äºæ£€æµ‹å’Œå¤„ç†æ½œåœ¨çš„é”™è¯¯æƒ…å†µï¼Œé¿å…åœ¨ä¸é€‚å½“çš„çŠ¶æ€ä¸‹å¼•å‘å¼‚å¸¸æˆ–å¯¼è‡´é”™è¯¯çš„æ“ä½œã€‚ æ€»çš„æ¥è¯´ï¼Œæ­¢æ­¥æ¨¡å¼é€‚ç”¨äºéœ€è¦åœ¨ç‰¹å®šçŠ¶æ€ä¸‹æ‰§è¡Œæ“ä½œå¹¶ç¡®ä¿çŠ¶æ€ä¸€è‡´æ€§ã€é¿å…å¹¶å‘å†²çªã€æ§åˆ¶èµ„æºè®¿é—®ä»¥åŠå¤„ç†é”™è¯¯çš„åœºæ™¯ã€‚å®ƒæä¾›äº†ä¸€ç§ç®€æ´è€Œæœ‰æ•ˆçš„æ–¹å¼æ¥ç®¡ç†å¯¹è±¡çš„çŠ¶æ€å’Œæ“ä½œã€‚\nä¸¾ä¾‹ æ–‡ä»¶è¯»å†™æ“ä½œ å½“æ¶‰åŠåˆ°æ–‡ä»¶è¯»å†™æ“ä½œæ—¶ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ Java ç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ­¢æ­¥æ¨¡å¼æ¥æ§åˆ¶æ–‡ä»¶è¯»å–æ“ä½œï¼š\nimport java.io.File; import java.io.IOException; public class FileProcessor { private File file; private boolean isWriting; public FileProcessor(String filePath) { this.file = new File(filePath); this.isWriting = false; } public synchronized void processFile() { if (isWriting) { System.out.println(\u0026#34;File is being written. Cannot process at the moment.\u0026#34;); return; } isWriting = true; try { // Perform file processing operations System.out.println(\u0026#34;Processing file: \u0026#34; + file.getName()); // ... // File processing code goes here // ... System.out.println(\u0026#34;File processing completed.\u0026#34;); } catch (IOException e) { // Handle exception e.printStackTrace(); } finally { isWriting = false; } } } åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼ŒFileProcessorç±»ä»£è¡¨äº†ä¸€ä¸ªæ–‡ä»¶å¤„ç†å™¨ï¼Œå…¶ä¸­çš„processFileæ–¹æ³•ç”¨äºå¤„ç†æ–‡ä»¶ã€‚åœ¨æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨synchronizedå…³é”®å­—æ¥ä¿è¯æ–¹æ³•çš„åŒæ­¥æ‰§è¡Œï¼Œä»¥é˜²æ­¢å¹¶å‘è®¿é—®ã€‚\nåœ¨æ–¹æ³•çš„å¼€å¤´ï¼Œæˆ‘ä»¬æ£€æŸ¥isWritingæ ‡å¿—ï¼Œå¦‚æœæ–‡ä»¶æ­£åœ¨è¢«å†™å…¥ï¼Œåˆ™è¾“å‡ºä¸€æ¡æ¶ˆæ¯å¹¶ç›´æ¥è¿”å›ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬å°†isWritingæ ‡å¿—è®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºæ–‡ä»¶æ­£åœ¨è¢«å†™å…¥ã€‚\nç„¶åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨// File processing code goes hereçš„æ³¨é‡Šå¤„ç¼–å†™ç‰¹å®šçš„æ–‡ä»¶å¤„ç†é€»è¾‘ï¼Œä¾‹å¦‚è¯»å–æ–‡ä»¶å†…å®¹ã€ä¿®æ”¹æ–‡ä»¶ç­‰ã€‚\næœ€åï¼Œåœ¨finallyå—ä¸­ï¼Œæˆ‘ä»¬å°†isWritingæ ‡å¿—è®¾ç½®ä¸ºfalseï¼Œè¡¨ç¤ºæ–‡ä»¶å†™å…¥æ“ä½œå·²å®Œæˆã€‚\né€šè¿‡ä½¿ç”¨æ­¢æ­¥æ¨¡å¼ï¼Œæˆ‘ä»¬ç¡®ä¿äº†åœ¨æ–‡ä»¶æ­£åœ¨è¢«å†™å…¥æ—¶ä¸æ‰§è¡Œå¤„ç†æ–‡ä»¶çš„æ“ä½œï¼Œä»è€Œé¿å…äº†ä¸ä¸€è‡´çš„ç»“æœå’Œå¹¶å‘å†²çªã€‚\nè¯·æ³¨æ„ï¼Œä¸Šè¿°ä»£ç æ˜¯ä¸€ä¸ªç®€åŒ–çš„ç¤ºä¾‹ï¼Œå®é™…åº”ç”¨ä¸­å¯èƒ½éœ€è¦è€ƒè™‘æ›´å¤šçš„ç»†èŠ‚å’Œå¼‚å¸¸å¤„ç†ã€‚æ­¤å¤–ï¼Œå…·ä½“çš„æ–‡ä»¶å¤„ç†é€»è¾‘éœ€è¦æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œç¼–å†™ã€‚\nå¹¶å‘ä»»åŠ¡è°ƒåº¦ å½“æ¶‰åŠåˆ°å¹¶å‘ä»»åŠ¡è°ƒåº¦æ—¶ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ Java ç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ­¢æ­¥æ¨¡å¼æ¥æ§åˆ¶ä»»åŠ¡è°ƒåº¦å™¨çš„æ“ä½œï¼š\nimport java.util.concurrent.ExecutorService; import java.util.concurrent.Executors; public class TaskScheduler { private ExecutorService executorService; private boolean isRunning; public TaskScheduler() { this.executorService = Executors.newFixedThreadPool(1); this.isRunning = false; } public synchronized void addTask(Runnable task) { if (isRunning) { System.out.println(\u0026#34;Task scheduler is already running. Cannot add new task at the moment.\u0026#34;); return; } executorService.execute(task); } public synchronized void start() { if (isRunning) { System.out.println(\u0026#34;Task scheduler is already running.\u0026#34;); return; } isRunning = true; System.out.println(\u0026#34;Task scheduler started.\u0026#34;); } public synchronized void stop() { if (!isRunning) { System.out.println(\u0026#34;Task scheduler is not running.\u0026#34;); return; } executorService.shutdown(); isRunning = false; System.out.println(\u0026#34;Task scheduler stopped.\u0026#34;); } } åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼ŒTaskSchedulerç±»ä»£è¡¨äº†ä¸€ä¸ªä»»åŠ¡è°ƒåº¦å™¨ï¼Œå…¶ä¸­çš„addTaskæ–¹æ³•ç”¨äºæ·»åŠ ä»»åŠ¡ï¼Œstartæ–¹æ³•ç”¨äºå¯åŠ¨ä»»åŠ¡è°ƒåº¦å™¨ï¼Œstopæ–¹æ³•ç”¨äºåœæ­¢ä»»åŠ¡è°ƒåº¦å™¨ã€‚\nåœ¨addTaskæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆæ£€æŸ¥isRunningæ ‡å¿—ï¼Œå¦‚æœä»»åŠ¡è°ƒåº¦å™¨æ­£åœ¨è¿è¡Œï¼Œåˆ™è¾“å‡ºä¸€æ¡æ¶ˆæ¯å¹¶ç›´æ¥è¿”å›ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬å°†ä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± ä¸­è¿›è¡Œæ‰§è¡Œã€‚\nåœ¨startæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æ£€æŸ¥isRunningæ ‡å¿—ï¼Œå¦‚æœä»»åŠ¡è°ƒåº¦å™¨å·²ç»åœ¨è¿è¡Œï¼Œåˆ™è¾“å‡ºä¸€æ¡æ¶ˆæ¯å¹¶ç›´æ¥è¿”å›ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬å°†isRunningæ ‡å¿—è®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºä»»åŠ¡è°ƒåº¦å™¨å·²ç»å¯åŠ¨ã€‚\nåœ¨stopæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æ£€æŸ¥isRunningæ ‡å¿—ï¼Œå¦‚æœä»»åŠ¡è°ƒåº¦å™¨æ²¡æœ‰åœ¨è¿è¡Œï¼Œåˆ™è¾“å‡ºä¸€æ¡æ¶ˆæ¯å¹¶ç›´æ¥è¿”å›ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬è°ƒç”¨çº¿ç¨‹æ± çš„shutdownæ–¹æ³•æ¥åœæ­¢ä»»åŠ¡çš„æ‰§è¡Œï¼Œç„¶åå°†isRunningæ ‡å¿—è®¾ç½®ä¸ºfalseï¼Œè¡¨ç¤ºä»»åŠ¡è°ƒåº¦å™¨å·²ç»åœæ­¢ã€‚\né€šè¿‡ä½¿ç”¨æ­¢æ­¥æ¨¡å¼ï¼Œæˆ‘ä»¬ç¡®ä¿äº†åœ¨ä»»åŠ¡è°ƒåº¦å™¨æ­£åœ¨è¿è¡Œæ—¶ä¸æ·»åŠ æ–°ä»»åŠ¡ï¼Œä»¥åŠåœ¨ä»»åŠ¡è°ƒåº¦å™¨æœªè¿è¡Œæ—¶ä¸åœæ­¢ä»»åŠ¡è°ƒåº¦å™¨ï¼Œä»è€Œé¿å…äº†å¹¶å‘å†²çªå’Œä¸ä¸€è‡´çš„ä»»åŠ¡è°ƒåº¦ã€‚\nè¯·æ³¨æ„ï¼Œä¸Šè¿°ä»£ç æ˜¯ä¸€ä¸ªç®€åŒ–çš„ç¤ºä¾‹ï¼Œå®é™…åº”ç”¨ä¸­å¯èƒ½éœ€è¦è€ƒè™‘æ›´å¤šçš„ç»†èŠ‚ã€å¹¶å‘å®‰å…¨æ€§å’Œå¼‚å¸¸å¤„ç†ã€‚æ­¤å¤–ï¼Œå…·ä½“çš„ä»»åŠ¡é€»è¾‘éœ€è¦æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œç¼–å†™ã€‚\nç½‘ç»œè¿æ¥ç®¡ç† å½“æ¶‰åŠåˆ°ç½‘ç»œè¿æ¥ç®¡ç†æ—¶ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ Java ç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ­¢æ­¥æ¨¡å¼æ¥æ§åˆ¶ç½‘ç»œè¿æ¥çš„æ“ä½œï¼š\nimport java.util.concurrent.locks.ReentrantLock; public class NetworkConnectionManager { private ReentrantLock lock; private boolean isConnected; public NetworkConnectionManager() { this.lock = new ReentrantLock(); this.isConnected = false; } public void connect() { lock.lock(); try { if (isConnected) { System.out.println(\u0026#34;Already connected to the network.\u0026#34;); return; } // Perform network connection operation System.out.println(\u0026#34;Connecting to the network...\u0026#34;); // ... // Network connection code goes here // ... isConnected = true; System.out.println(\u0026#34;Successfully connected to the network.\u0026#34;); } finally { lock.unlock(); } } public void disconnect() { lock.lock(); try { if (!isConnected) { System.out.println(\u0026#34;Not currently connected to the network.\u0026#34;); return; } // Perform disconnection operation System.out.println(\u0026#34;Disconnecting from the network...\u0026#34;); // ... // Network disconnection code goes here // ... isConnected = false; System.out.println(\u0026#34;Successfully disconnected from the network.\u0026#34;); } finally { lock.unlock(); } } } åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼ŒNetworkConnectionManagerç±»ä»£è¡¨äº†ä¸€ä¸ªç½‘ç»œè¿æ¥ç®¡ç†å™¨ï¼Œå…¶ä¸­çš„connectæ–¹æ³•ç”¨äºè¿æ¥åˆ°ç½‘ç»œï¼Œdisconnectæ–¹æ³•ç”¨äºæ–­å¼€ç½‘ç»œè¿æ¥ã€‚\nåœ¨connectæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆè·å–é”ï¼Œç„¶åæ£€æŸ¥isConnectedæ ‡å¿—ï¼Œå¦‚æœå·²ç»è¿æ¥åˆ°ç½‘ç»œï¼Œåˆ™è¾“å‡ºä¸€æ¡æ¶ˆæ¯å¹¶ç›´æ¥è¿”å›ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬æ‰§è¡Œç½‘ç»œè¿æ¥æ“ä½œï¼Œç„¶åå°†isConnectedæ ‡å¿—è®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºæˆåŠŸè¿æ¥åˆ°ç½‘ç»œã€‚\nåœ¨disconnectæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬åŒæ ·è·å–é”ï¼Œç„¶åæ£€æŸ¥isConnectedæ ‡å¿—ï¼Œå¦‚æœæœªè¿æ¥åˆ°ç½‘ç»œï¼Œåˆ™è¾“å‡ºä¸€æ¡æ¶ˆæ¯å¹¶ç›´æ¥è¿”å›ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬æ‰§è¡Œç½‘ç»œæ–­å¼€æ“ä½œï¼Œç„¶åå°†isConnectedæ ‡å¿—è®¾ç½®ä¸ºfalseï¼Œè¡¨ç¤ºæˆåŠŸæ–­å¼€ç½‘ç»œè¿æ¥ã€‚\né€šè¿‡ä½¿ç”¨æ­¢æ­¥æ¨¡å¼å’Œå¯é‡å…¥é”ï¼Œæˆ‘ä»¬ç¡®ä¿äº†åœ¨ç½‘ç»œè¿æ¥æœŸé—´ä¸æ‰§è¡Œé‡å¤çš„è¿æ¥æ“ä½œæˆ–åœ¨æœªè¿æ¥æ—¶æ‰§è¡Œæ–­å¼€æ“ä½œï¼Œä»è€Œé¿å…äº†å¹¶å‘å†²çªå’Œä¸ä¸€è‡´çš„ç½‘ç»œçŠ¶æ€ã€‚\nè¯·æ³¨æ„ï¼Œä¸Šè¿°ä»£ç æ˜¯ä¸€ä¸ªç®€åŒ–çš„ç¤ºä¾‹ï¼Œå®é™…åº”ç”¨ä¸­å¯èƒ½éœ€è¦è€ƒè™‘æ›´å¤šçš„ç»†èŠ‚ã€å¹¶å‘å®‰å…¨æ€§å’Œå¼‚å¸¸å¤„ç†ã€‚æ­¤å¤–ï¼Œå…·ä½“çš„ç½‘ç»œè¿æ¥å’Œæ–­å¼€é€»è¾‘éœ€è¦æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œç¼–å†™ã€‚\nç¼“å­˜æ›´æ–°æ§åˆ¶ å½“æ¶‰åŠåˆ°ç¼“å­˜æ›´æ–°æ§åˆ¶æ—¶ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ Java ç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ­¢æ­¥æ¨¡å¼æ¥æ§åˆ¶ç¼“å­˜çš„æ›´æ–°æ“ä½œï¼š\nimport java.util.concurrent.locks.ReentrantLock; public class CacheManager { private ReentrantLock lock; private boolean isUpdating; public CacheManager() { this.lock = new ReentrantLock(); this.isUpdating = false; } public void updateCache() { lock.lock(); try { if (isUpdating) { System.out.println(\u0026#34;Cache is already being updated. Cannot perform update at the moment.\u0026#34;); return; } isUpdating = true; // Perform cache update operation System.out.println(\u0026#34;Updating cache...\u0026#34;); // ... // Cache update code goes here // ... System.out.println(\u0026#34;Cache update completed.\u0026#34;); } finally { isUpdating = false; lock.unlock(); } } } åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼ŒCacheManagerç±»ä»£è¡¨äº†ä¸€ä¸ªç¼“å­˜ç®¡ç†å™¨ï¼Œå…¶ä¸­çš„updateCacheæ–¹æ³•ç”¨äºæ›´æ–°ç¼“å­˜ã€‚\nåœ¨updateCacheæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆè·å–é”ï¼Œç„¶åæ£€æŸ¥isUpdatingæ ‡å¿—ï¼Œå¦‚æœç¼“å­˜æ­£åœ¨è¢«æ›´æ–°ï¼Œåˆ™è¾“å‡ºä¸€æ¡æ¶ˆæ¯å¹¶ç›´æ¥è¿”å›ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬å°†isUpdatingæ ‡å¿—è®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºç¼“å­˜æ­£åœ¨è¢«æ›´æ–°ã€‚\nç„¶åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨// Cache update code goes hereçš„æ³¨é‡Šå¤„ç¼–å†™ç‰¹å®šçš„ç¼“å­˜æ›´æ–°é€»è¾‘ï¼Œä¾‹å¦‚ä»æ•°æ®åº“ä¸­è·å–æœ€æ–°æ•°æ®ã€æ›´æ–°ç¼“å­˜é¡¹ç­‰ã€‚\næœ€åï¼Œåœ¨finallyå—ä¸­ï¼Œæˆ‘ä»¬å°†isUpdatingæ ‡å¿—è®¾ç½®ä¸ºfalseï¼Œè¡¨ç¤ºç¼“å­˜æ›´æ–°æ“ä½œå·²å®Œæˆï¼Œå¹¶é‡Šæ”¾é”ã€‚\né€šè¿‡ä½¿ç”¨æ­¢æ­¥æ¨¡å¼å’Œå¯é‡å…¥é”ï¼Œæˆ‘ä»¬ç¡®ä¿äº†åœ¨ç¼“å­˜æ­£åœ¨è¢«æ›´æ–°æ—¶ä¸æ‰§è¡Œé‡å¤çš„æ›´æ–°æ“ä½œï¼Œä»è€Œé¿å…äº†å¹¶å‘å†²çªå’Œä¸ä¸€è‡´çš„ç¼“å­˜çŠ¶æ€ã€‚\nè¯·æ³¨æ„ï¼Œä¸Šè¿°ä»£ç æ˜¯ä¸€ä¸ªç®€åŒ–çš„ç¤ºä¾‹ï¼Œå®é™…åº”ç”¨ä¸­å¯èƒ½éœ€è¦è€ƒè™‘æ›´å¤šçš„ç»†èŠ‚ã€å¹¶å‘å®‰å…¨æ€§å’Œå¼‚å¸¸å¤„ç†ã€‚æ­¤å¤–ï¼Œå…·ä½“çš„ç¼“å­˜æ›´æ–°é€»è¾‘éœ€è¦æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œç¼–å†™ã€‚\nèµ„æºåˆ†é…å’Œé‡Šæ”¾ å½“æ¶‰åŠåˆ°èµ„æºåˆ†é…å’Œé‡Šæ”¾æ—¶ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ Java ç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ­¢æ­¥æ¨¡å¼æ¥æ§åˆ¶èµ„æºçš„è·å–å’Œé‡Šæ”¾æ“ä½œï¼š\nimport java.util.concurrent.Semaphore; public class ResourceManager { private Semaphore semaphore; public ResourceManager(int resourceCount) { this.semaphore = new Semaphore(resourceCount); } public void acquireResource() { try { semaphore.acquire(); System.out.println(\u0026#34;Resource acquired.\u0026#34;); // Perform resource allocation and usage here // ... // Simulating resource usage Thread.sleep(2000); System.out.println(\u0026#34;Resource released.\u0026#34;); semaphore.release(); } catch (InterruptedException e) { e.printStackTrace(); } } } åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼ŒResourceManagerç±»ä»£è¡¨äº†ä¸€ä¸ªèµ„æºç®¡ç†å™¨ï¼Œå…¶ä¸­çš„acquireResourceæ–¹æ³•ç”¨äºè·å–å’Œé‡Šæ”¾èµ„æºã€‚\nåœ¨acquireResourceæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆè°ƒç”¨semaphore.acquire()æ¥è·å–ä¸€ä¸ªå¯ç”¨èµ„æºã€‚å¦‚æœæ²¡æœ‰å¯ç”¨èµ„æºï¼Œå½“å‰çº¿ç¨‹ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰èµ„æºå¯ç”¨ã€‚\nä¸€æ—¦æˆåŠŸè·å–èµ„æºï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è·å–èµ„æºåçš„ä»£ç å—ä¸­æ‰§è¡Œèµ„æºçš„åˆ†é…å’Œä½¿ç”¨é€»è¾‘ã€‚è¿™é‡Œåªæ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œä½ å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚ç¼–å†™ä½ è‡ªå·±çš„èµ„æºåˆ†é…å’Œä½¿ç”¨é€»è¾‘ã€‚\nåœ¨æ¨¡æ‹Ÿèµ„æºä½¿ç”¨çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬ä½¿ç”¨Thread.sleep(2000)æ¥æ¨¡æ‹Ÿèµ„æºçš„å®é™…ä½¿ç”¨ï¼Œè¿™é‡Œæš‚åœ 2 ç§’é’Ÿã€‚ç„¶åï¼Œæˆ‘ä»¬é‡Šæ”¾èµ„æºï¼Œè°ƒç”¨semaphore.release()æ¥é€šçŸ¥ä¿¡å·é‡ï¼Œè¡¨ç¤ºèµ„æºå·²ç»é‡Šæ”¾ã€‚\né€šè¿‡ä½¿ç”¨æ­¢æ­¥æ¨¡å¼å’Œä¿¡å·é‡ï¼ˆSemaphoreï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶èµ„æºçš„è·å–å’Œé‡Šæ”¾æ“ä½œï¼Œç¡®ä¿èµ„æºåœ¨è¢«ä½¿ç”¨æ—¶ä¸ä¼šè¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ï¼Œä»è€Œé¿å…äº†èµ„æºå†²çªå’Œä¸ä¸€è‡´çš„ç»“æœã€‚\nè¯·æ³¨æ„ï¼Œä¸Šè¿°ä»£ç æ˜¯ä¸€ä¸ªç®€åŒ–çš„ç¤ºä¾‹ï¼Œå®é™…åº”ç”¨ä¸­å¯èƒ½éœ€è¦è€ƒè™‘æ›´å¤šçš„ç»†èŠ‚ã€å¹¶å‘å®‰å…¨æ€§å’Œå¼‚å¸¸å¤„ç†ã€‚æ­¤å¤–ï¼Œå…·ä½“çš„èµ„æºåˆ†é…å’Œé‡Šæ”¾é€»è¾‘éœ€è¦æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œç¼–å†™ã€‚\næ•°æ®åº“äº‹åŠ¡ç®¡ç† å½“æ¶‰åŠåˆ°æ•°æ®åº“äº‹åŠ¡ç®¡ç†æ—¶ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ Java ç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ­¢æ­¥æ¨¡å¼æ¥æ§åˆ¶æ•°æ®åº“äº‹åŠ¡çš„æ“ä½œï¼š\nimport java.sql.Connection; import java.sql.DriverManager; import java.sql.SQLException; public class DatabaseManager { private Connection connection; private boolean inTransaction; public DatabaseManager() { this.connection = null; this.inTransaction = false; } public void startTransaction() throws SQLException { if (inTransaction) { System.out.println(\u0026#34;Transaction is already in progress.\u0026#34;); return; } connection = DriverManager.getConnection(\u0026#34;jdbc:mysql://localhost:3306/mydb\u0026#34;, \u0026#34;username\u0026#34;, \u0026#34;password\u0026#34;); connection.setAutoCommit(false); inTransaction = true; System.out.println(\u0026#34;Transaction started.\u0026#34;); } public void commitTransaction() throws SQLException { if (!inTransaction) { System.out.println(\u0026#34;No transaction in progress.\u0026#34;); return; } connection.commit(); connection.setAutoCommit(true); connection.close(); connection = null; inTransaction = false; System.out.println(\u0026#34;Transaction committed and connection closed.\u0026#34;); } public void rollbackTransaction() throws SQLException { if (!inTransaction) { System.out.println(\u0026#34;No transaction in progress.\u0026#34;); return; } connection.rollback(); connection.setAutoCommit(true); connection.close(); connection = null; inTransaction = false; System.out.println(\u0026#34;Transaction rolled back and connection closed.\u0026#34;); } } åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼ŒDatabaseManagerç±»ä»£è¡¨äº†ä¸€ä¸ªæ•°æ®åº“ç®¡ç†å™¨ï¼Œå…¶ä¸­çš„startTransactionæ–¹æ³•ç”¨äºå¼€å§‹äº‹åŠ¡ï¼ŒcommitTransactionæ–¹æ³•ç”¨äºæäº¤äº‹åŠ¡ï¼ŒrollbackTransactionæ–¹æ³•ç”¨äºå›æ»šäº‹åŠ¡ã€‚\nåœ¨startTransactionæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆæ£€æŸ¥inTransactionæ ‡å¿—ï¼Œå¦‚æœå·²ç»å­˜åœ¨ä¸€ä¸ªäº‹åŠ¡æ­£åœ¨è¿›è¡Œï¼Œåˆ™è¾“å‡ºä¸€æ¡æ¶ˆæ¯å¹¶ç›´æ¥è¿”å›ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬é€šè¿‡DriverManagerè·å–æ•°æ®åº“è¿æ¥ï¼Œå¹¶å°†è‡ªåŠ¨æäº¤è®¾ç½®ä¸ºfalseï¼Œè¡¨ç¤ºæ‰‹åŠ¨ç®¡ç†äº‹åŠ¡ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†inTransactionæ ‡å¿—è®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºäº‹åŠ¡å·²å¼€å§‹ã€‚\nåœ¨commitTransactionæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æ£€æŸ¥inTransactionæ ‡å¿—ï¼Œå¦‚æœæ²¡æœ‰è¿›è¡Œä¸­çš„äº‹åŠ¡ï¼Œåˆ™è¾“å‡ºä¸€æ¡æ¶ˆæ¯å¹¶ç›´æ¥è¿”å›ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬è°ƒç”¨connection.commit()æäº¤äº‹åŠ¡ï¼Œç„¶åå°†è‡ªåŠ¨æäº¤è®¾ç½®ä¸ºtrueï¼Œå…³é—­æ•°æ®åº“è¿æ¥ï¼Œå¹¶å°†ç›¸å…³å˜é‡é‡ç½®ä¸ºåˆå§‹çŠ¶æ€ã€‚\nåœ¨rollbackTransactionæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬åŒæ ·æ£€æŸ¥inTransactionæ ‡å¿—ï¼Œå¦‚æœæ²¡æœ‰è¿›è¡Œä¸­çš„äº‹åŠ¡ï¼Œåˆ™è¾“å‡ºä¸€æ¡æ¶ˆæ¯å¹¶ç›´æ¥è¿”å›ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬è°ƒç”¨connection.rollback()å›æ»šäº‹åŠ¡ï¼Œç„¶åå°†è‡ªåŠ¨æäº¤è®¾ç½®ä¸ºtrueï¼Œå…³é—­æ•°æ®åº“è¿æ¥ï¼Œå¹¶å°†ç›¸å…³å˜é‡é‡ç½®ä¸ºåˆå§‹çŠ¶æ€ã€‚\né€šè¿‡ä½¿ç”¨æ­¢æ­¥æ¨¡å¼å’Œæ•°æ®åº“äº‹åŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿åœ¨åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªäº‹åŠ¡åœ¨è¿›è¡Œï¼Œé¿å…äº†å¹¶å‘å†²çªå’Œä¸ä¸€è‡´çš„æ•°æ®åº“çŠ¶æ€ã€‚\nè¯·æ³¨æ„ï¼Œä¸Šè¿°ä»£ç æ˜¯ä¸€ä¸ªç®€åŒ–çš„ç¤ºä¾‹ï¼Œå®é™…åº”ç”¨ä¸­å¯èƒ½éœ€è¦è€ƒè™‘æ›´å¤šçš„ç»†èŠ‚ã€å¼‚å¸¸å¤„ç†å’Œè¿æ¥æ± ç®¡ç†ã€‚æ­¤å¤–ï¼Œå…·ä½“çš„æ•°æ®åº“æ“ä½œå’Œäº‹åŠ¡é€»è¾‘éœ€è¦æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œç¼–å†™ã€‚\nçº¿ç¨‹é—´çš„åè°ƒå’ŒåŒæ­¥ å½“æ¶‰åŠåˆ°çº¿ç¨‹é—´çš„åè°ƒå’ŒåŒæ­¥æ—¶ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ Java ç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ­¢æ­¥æ¨¡å¼å’Œæ¡ä»¶å˜é‡æ¥å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼š\nimport java.util.LinkedList; import java.util.Queue; import java.util.concurrent.locks.Condition; import java.util.concurrent.locks.ReentrantLock; public class ProducerConsumer { private Queue\u0026lt;Integer\u0026gt; buffer; private int maxSize; private ReentrantLock lock; private Condition notFull; private Condition notEmpty; public ProducerConsumer(int maxSize) { this.buffer = new LinkedList\u0026lt;\u0026gt;(); this.maxSize = maxSize; this.lock = new ReentrantLock(); this.notFull = lock.newCondition(); this.notEmpty = lock.newCondition(); } public void produce() throws InterruptedException { lock.lock(); try { while (buffer.size() == maxSize) { System.out.println(\u0026#34;Buffer is full. Producer is waiting.\u0026#34;); notFull.await(); } int item = generateItem(); buffer.offer(item); System.out.println(\u0026#34;Produced item: \u0026#34; + item); notEmpty.signalAll(); } finally { lock.unlock(); } } public void consume() throws InterruptedException { lock.lock(); try { while (buffer.isEmpty()) { System.out.println(\u0026#34;Buffer is empty. Consumer is waiting.\u0026#34;); notEmpty.await(); } int item = buffer.poll(); System.out.println(\u0026#34;Consumed item: \u0026#34; + item); notFull.signalAll(); } finally { lock.unlock(); } } private int generateItem() { // Generate a random item return (int) (Math.random() * 100); } } åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼ŒProducerConsumerç±»ä»£è¡¨äº†ä¸€ä¸ªç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹çš„å®ç°ï¼Œå…¶ä¸­çš„produceæ–¹æ³•ç”¨äºç”Ÿäº§é¡¹ç›®ï¼Œconsumeæ–¹æ³•ç”¨äºæ¶ˆè´¹é¡¹ç›®ã€‚\nåœ¨æ„é€ å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬åˆå§‹åŒ–äº†ä¸€ä¸ªé˜Ÿåˆ—bufferä½œä¸ºç¼“å†²åŒºï¼Œä»¥åŠä¸€ä¸ªmaxSizeå˜é‡è¡¨ç¤ºç¼“å†²åŒºçš„æœ€å¤§å®¹é‡ã€‚æˆ‘ä»¬è¿˜åˆ›å»ºäº†ä¸€ä¸ªå¯é‡å…¥é”lockï¼Œä»¥åŠä¸¤ä¸ªæ¡ä»¶å˜é‡notFullå’ŒnotEmptyï¼Œç”¨äºåè°ƒç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´çš„æ“ä½œã€‚\nåœ¨produceæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆè·å–é”ï¼Œå¹¶ä½¿ç”¨whileå¾ªç¯æ¥æ£€æŸ¥ç¼“å†²åŒºæ˜¯å¦å·²æ»¡ã€‚å¦‚æœå·²æ»¡ï¼Œè¡¨ç¤ºæ— æ³•ç»§ç»­ç”Ÿäº§ï¼Œç”Ÿäº§è€…çº¿ç¨‹ä¼šç­‰å¾…åœ¨notFullæ¡ä»¶å˜é‡ä¸Šã€‚ä¸€æ—¦æœ‰ç©ºé—²ç©ºé—´ï¼Œç”Ÿäº§è€…ä¼šç”Ÿæˆä¸€ä¸ªé¡¹ç›®ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°ç¼“å†²åŒºä¸­ã€‚ç„¶åï¼Œæˆ‘ä»¬å”¤é†’æ‰€æœ‰ç­‰å¾…åœ¨notEmptyæ¡ä»¶å˜é‡ä¸Šçš„æ¶ˆè´¹è€…çº¿ç¨‹ã€‚\nåœ¨consumeæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬åŒæ ·è·å–é”ï¼Œå¹¶ä½¿ç”¨whileå¾ªç¯æ¥æ£€æŸ¥ç¼“å†²åŒºæ˜¯å¦ä¸ºç©ºã€‚å¦‚æœä¸ºç©ºï¼Œè¡¨ç¤ºæ— æ³•ç»§ç»­æ¶ˆè´¹ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹ä¼šç­‰å¾…åœ¨notEmptyæ¡ä»¶å˜é‡ä¸Šã€‚ä¸€æ—¦æœ‰é¡¹ç›®å¯ä¾›æ¶ˆè´¹ï¼Œæ¶ˆè´¹è€…ä¼šä»ç¼“å†²åŒºä¸­å–å‡ºä¸€ä¸ªé¡¹ç›®ã€‚ç„¶åï¼Œæˆ‘ä»¬å”¤é†’æ‰€æœ‰ç­‰å¾…åœ¨notFullæ¡ä»¶å˜é‡ä¸Šçš„ç”Ÿäº§è€…çº¿ç¨‹ã€‚\né€šè¿‡ä½¿ç”¨æ­¢æ­¥æ¨¡å¼ã€å¯é‡å…¥é”å’Œæ¡ä»¶å˜é‡ï¼Œæˆ‘ä»¬å®ç°äº†ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼çš„çº¿ç¨‹åè°ƒå’ŒåŒæ­¥ï¼Œç¡®ä¿äº†ç”Ÿäº§è€…åœ¨ç¼“å†²åŒºå·²æ»¡æ—¶ç­‰å¾…ï¼Œæ¶ˆè´¹è€…åœ¨ç¼“å†²åŒºä¸ºç©ºæ—¶ç­‰å¾…ï¼Œä»è€Œé¿å…äº†å¹¶å‘å†²çªå’Œä¸ä¸€è‡´çš„ç»“æœã€‚\nè¯·æ³¨æ„ï¼Œä¸Šè¿°ä»£ç æ˜¯ä¸€ä¸ªç®€åŒ–çš„ç¤ºä¾‹ï¼Œå®é™…åº”ç”¨ä¸­å¯èƒ½éœ€è¦è€ƒè™‘æ›´å¤šçš„ç»†èŠ‚ã€å¼‚å¸¸å¤„ç†å’Œçº¿ç¨‹å®‰å…¨æ€§ã€‚æ­¤å¤–ï¼Œå…·ä½“çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…é€»è¾‘éœ€è¦æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œç¼–å†™ã€‚\né”™è¯¯å¤„ç†å’Œå¼‚å¸¸é¿å… å½“æ¶‰åŠåˆ°é”™è¯¯å¤„ç†å’Œå¼‚å¸¸é¿å…æ—¶ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ Java ç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨å¼‚å¸¸å¤„ç†å’Œé˜²å¾¡æ€§ç¼–ç¨‹æ¥å¤„ç†æ½œåœ¨çš„é”™è¯¯æƒ…å†µï¼š\nimport java.io.File; import java.io.FileNotFoundException; import java.io.FileReader; import java.io.IOException; public class ErrorHandling { public static void main(String[] args) { try { readFile(\u0026#34;myfile.txt\u0026#34;); } catch (FileNotFoundException e) { System.out.println(\u0026#34;File not found: \u0026#34; + e.getMessage()); } catch (IOException e) { System.out.println(\u0026#34;Error reading file: \u0026#34; + e.getMessage()); } } public static void readFile(String filename) throws IOException { File file = new File(filename); if (!file.exists()) { throw new FileNotFoundException(\u0026#34;File not found: \u0026#34; + filename); } FileReader reader = null; try { reader = new FileReader(file); // è¯»å–æ–‡ä»¶å†…å®¹ } finally { if (reader != null) { try { reader.close(); } catch (IOException e) { System.out.println(\u0026#34;Error closing file: \u0026#34; + e.getMessage()); } } } } } åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°è¯•è¯»å–åä¸ºmyfile.txtçš„æ–‡ä»¶ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è°ƒç”¨readFileæ–¹æ³•ï¼Œå¹¶åœ¨æ–¹æ³•ç­¾åä¸­å£°æ˜å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹IOExceptionã€‚\nåœ¨readFileæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªFileå¯¹è±¡ï¼Œè¡¨ç¤ºè¦è¯»å–çš„æ–‡ä»¶ã€‚ç„¶åï¼Œæˆ‘ä»¬æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼ŒæŠ›å‡ºFileNotFoundExceptionå¼‚å¸¸ã€‚\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªFileReaderå¯¹è±¡æ¥è¯»å–æ–‡ä»¶å†…å®¹ã€‚åœ¨finallyå—ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨é˜²å¾¡æ€§ç¼–ç¨‹çš„æ–¹å¼å…³é—­æ–‡ä»¶è¯»å–å™¨ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æ£€æŸ¥è¯»å–å™¨æ˜¯å¦ä¸ºnullï¼Œå¦‚æœä¸ä¸ºnullï¼Œåˆ™è°ƒç”¨closeæ–¹æ³•å…³é—­è¯»å–å™¨ã€‚åœ¨å…³é—­è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œæˆ‘ä»¬æ•è·å¹¶å¤„ç†å®ƒï¼Œå¹¶è¾“å‡ºç›¸åº”çš„é”™è¯¯æ¶ˆæ¯ã€‚\nåœ¨mainæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨try-catchå—æ¥æ•è·å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬æ•è·å¹¶å¤„ç†FileNotFoundExceptionï¼Œå¦‚æœåœ¨è¯»å–æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯ï¼Œæˆ‘ä»¬æ•è·å¹¶å¤„ç†IOExceptionã€‚åœ¨å¼‚å¸¸å¤„ç†å—ä¸­ï¼Œæˆ‘ä»¬è¾“å‡ºç›¸åº”çš„é”™è¯¯æ¶ˆæ¯ã€‚\né€šè¿‡ä½¿ç”¨å¼‚å¸¸å¤„ç†å’Œé˜²å¾¡æ€§ç¼–ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥æ•è·å’Œå¤„ç†æ½œåœ¨çš„é”™è¯¯æƒ…å†µï¼Œä»è€Œé¿å…ç¨‹åºå› é”™è¯¯è€Œå´©æºƒï¼Œå¹¶æä¾›æœ‰ç”¨çš„é”™è¯¯ä¿¡æ¯ã€‚\nè¯·æ³¨æ„ï¼Œä¸Šè¿°ä»£ç æ˜¯ä¸€ä¸ªç®€åŒ–çš„ç¤ºä¾‹ï¼Œå®é™…åº”ç”¨ä¸­å¯èƒ½éœ€è¦è€ƒè™‘æ›´å¤šçš„ç»†èŠ‚å’Œç‰¹å®šçš„é”™è¯¯å¤„ç†æ–¹å¼ã€‚æ­¤å¤–ï¼Œå…·ä½“çš„é”™è¯¯å¤„ç†å’Œå¼‚å¸¸é¿å…ç­–ç•¥éœ€è¦æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œç¼–å†™ã€‚\nç›¸å…³æ¨¡å¼ ä¿æŠ¤æ€§æš‚æŒ‚æ¨¡å¼ åŒé‡æ£€æŸ¥é”æ¨¡å¼ é¸£è°¢ Patterns in Java: A Catalog of Reusable Design Patterns Illustrated with UML, 2nd Edition, Volume 1 åŸæ–‡é“¾æ¥ï¼šhttps://java-design-patterns.com/zh/patterns/balking/\n","permalink":"https://blog.chensoul.cc/posts/2023/08/25/java-design-patterns-balking/","summary":"æœ¬æ–‡ä¸»è¦ä»‹ç» Balking æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nä»‹ç» æ­¢æ­¥æ¨¡å¼ï¼ˆBalkingï¼‰æ˜¯ä¸€ç§åœ¨å¯¹è±¡å¤„äºç‰¹å®šçŠ¶æ€æ—¶æ‰æ‰§è¡Œæ“ä½œçš„è®¾è®¡æ¨¡å¼ã€‚å®ƒç”¨äºé˜²æ­¢å¯¹è±¡åœ¨ä¸å®Œæ•´æˆ–ä¸åˆé€‚çš„çŠ¶æ€ä¸‹æ‰§è¡ŒæŸäº›ä»£ç ï¼Œä»è€Œç¡®ä¿ä»£ç çš„æ­£ç¡®æ€§å’Œä¸€è‡´æ€§ã€‚\nè¯¥æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œåœ¨æ‰§è¡Œæ“ä½œä¹‹å‰ï¼Œæ£€æŸ¥å¯¹è±¡çš„çŠ¶æ€ï¼Œå¹¶åªåœ¨ç‰¹å®šçš„çŠ¶æ€ä¸‹æ‰æ‰§è¡Œæ“ä½œã€‚å¦‚æœå¯¹è±¡ä¸å¤„äºé¢„æœŸçŠ¶æ€ï¼Œæ“ä½œå°†è¢«å¿½ç•¥æˆ–æ¨è¿Ÿæ‰§è¡Œï¼Œä»è€Œé¿å…äº†ä¸å¿…è¦çš„æ“ä½œæˆ–ä¸ä¸€è‡´çš„çŠ¶æ€è½¬æ¢ã€‚\nä»¥ä¸‹æ˜¯æ­¢æ­¥æ¨¡å¼çš„è¦ç‚¹å’Œç¤ºä¾‹ï¼š\nå¯¹è±¡çŠ¶æ€æ£€æŸ¥ï¼šåœ¨æ‰§è¡Œæ“ä½œä¹‹å‰ï¼Œå¯¹è±¡ä¼šæ£€æŸ¥è‡ªèº«çš„çŠ¶æ€ã€‚è¿™å¯ä»¥é€šè¿‡ä½¿ç”¨æ¡ä»¶è¯­å¥æˆ–çŠ¶æ€æ ‡å¿—æ¥å®ç°ã€‚ ç‰¹å®šçŠ¶æ€æ‰§è¡Œï¼šåªæœ‰å½“å¯¹è±¡å¤„äºç‰¹å®šçŠ¶æ€æ—¶ï¼Œæ“ä½œæ‰ä¼šè¢«æ‰§è¡Œã€‚å¦‚æœå¯¹è±¡ä¸æ»¡è¶³æ‰§è¡Œæ¡ä»¶ï¼Œæ“ä½œå°†è¢«å¿½ç•¥æˆ–æ¨è¿Ÿæ‰§è¡Œã€‚ çº¿ç¨‹å®‰å…¨è€ƒè™‘ï¼šç”±äºæ­¢æ­¥æ¨¡å¼é€šå¸¸æ¶‰åŠå¤šçº¿ç¨‹ç¯å¢ƒï¼Œéœ€è¦ç¡®ä¿å¯¹å…±äº«èµ„æºçš„è®¿é—®æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¯ä»¥ä½¿ç”¨åŒæ­¥æœºåˆ¶ï¼ˆå¦‚ synchronized å…³é”®å­—ï¼‰æ¥ä¿æŠ¤å…±äº«èµ„æºã€‚ è§£é‡Š çœŸå®ä¸–ç•Œä¾‹å­\næ´—è¡£æœºä¸­æœ‰ä¸€ä¸ªå¼€å§‹æŒ‰é’®ï¼Œç”¨äºå¯åŠ¨è¡£ç‰©æ´—æ¶¤ã€‚å½“æ´—è¡£æœºå¤„äºéæ´»åŠ¨çŠ¶æ€æ—¶ï¼ŒæŒ‰é’®å°†æŒ‰é¢„æœŸå·¥ä½œï¼Œä½†æ˜¯å¦‚æœå·²ç»åœ¨æ´—æ¶¤ï¼Œåˆ™æŒ‰é’®å°†ä¸èµ·ä»»ä½•ä½œç”¨ã€‚\né€šä¿—åœ°è¯´\nä½¿ç”¨æ­¢æ­¥æ¨¡å¼ï¼Œä»…å½“å¯¹è±¡å¤„äºç‰¹å®šçŠ¶æ€æ—¶æ‰æ‰§è¡Œç‰¹å®šä»£ç ã€‚\nç»´åŸºç™¾ç§‘è¯´\nç¦æ­¢æ¨¡å¼æ˜¯ä¸€ç§è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼Œä»…å½“å¯¹è±¡å¤„äºç‰¹å®šçŠ¶æ€æ—¶æ‰å¯¹å¯¹è±¡æ‰§è¡Œæ“ä½œã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå¯¹è±¡è¯»å– zip å‹ç¼©æ–‡ä»¶å¹¶åœ¨å‹ç¼©æ–‡ä»¶æ²¡æ‰“å¼€çš„æ—¶å€™è°ƒç”¨ get æ–¹æ³•ï¼Œå¯¹è±¡å°†åœ¨è¯·æ±‚çš„æ—¶å€™â€æ­¢æ­¥â€œã€‚\nç¨‹åºç¤ºä¾‹\nåœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ WashingMachineæ˜¯ä¸€ä¸ªå…·æœ‰ä¸¤ä¸ªçŠ¶æ€çš„å¯¹è±¡ï¼Œå¯ä»¥å¤„äºä¸¤ç§çŠ¶æ€ï¼šENABLED å’ŒWASHINGã€‚ å¦‚æœæœºå™¨å·²å¯ç”¨ï¼Œåˆ™ä½¿ç”¨çº¿ç¨‹å®‰å…¨æ–¹æ³•å°†çŠ¶æ€æ›´æ”¹ä¸º WASHINGã€‚ å¦ä¸€æ–¹é¢ï¼Œå¦‚æœå·²ç»è¿›è¡Œäº†æ¸…æ´—å¹¶ä¸”ä»»ä½•å…¶ä»–çº¿ç¨‹æ‰§è¡Œ washï¼ˆï¼‰ï¼Œåˆ™å®ƒå°†ä¸æ‰§è¡Œè¯¥æ“ä½œï¼Œè€Œæ˜¯ä¸æ‰§è¡Œä»»ä½•æ“ä½œè€Œè¿”å›ã€‚\nè¿™é‡Œæ˜¯ WashingMachine ç±»ç›¸å…³çš„éƒ¨åˆ†ã€‚\n@Slf4j public class WashingMachine { private final DelayProvider delayProvider; private WashingMachineState washingMachineState; public WashingMachine(DelayProvider delayProvider) { this.delayProvider = delayProvider; this.washingMachineState = WashingMachineState.ENABLED; } public WashingMachineState getWashingMachineState() { return washingMachineState; } public void wash() { synchronized (this) { var machineState = getWashingMachineState(); LOGGER.info(\u0026#34;{}: Actual machine state: {}\u0026#34;, Thread.currentThread().getName(), machineState); if (this.washingMachineState == WashingMachineState.WASHING) { LOGGER.error(\u0026#34;Cannot wash if the machine has been already washing!\u0026#34;); return; } this.","title":"Javaè®¾è®¡æ¨¡å¼ï¼šBalking"},{"content":"1. æ¦‚è¿° åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•ä¸º Spring REST API å®ç°å…¨å±€é”™è¯¯å¤„ç†ç¨‹åºã€‚\næˆ‘ä»¬å°†ä½¿ç”¨æ¯ä¸ªå¼‚å¸¸çš„è¯­ä¹‰ä¸ºå®¢æˆ·ç«¯æ„å»ºæœ‰æ„ä¹‰çš„é”™è¯¯æ¶ˆæ¯ï¼Œå…¶æ˜ç¡®çš„ç›®æ ‡æ˜¯ä¸ºå®¢æˆ·ç«¯æä¾›æ‰€æœ‰ä¿¡æ¯ä»¥è½»æ¾è¯Šæ–­é—®é¢˜ã€‚\n2. è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯ è®©æˆ‘ä»¬é¦–å…ˆå®ç°ä¸€ä¸ªç”¨äºé€šè¿‡çº¿è·¯å‘é€é”™è¯¯çš„ç®€å•ç»“æ„ â€” ApiErrorï¼š\npublic class ApiError { private HttpStatus status; private String message; private List\u0026lt;String\u0026gt; errors; public ApiError(HttpStatus status, String message, List\u0026lt;String\u0026gt; errors) { super(); this.status = status; this.message = message; this.errors = errors; } public ApiError(HttpStatus status, String message, String error) { super(); this.status = status; this.message = message; errors = Arrays.asList(error); } } è¿™é‡Œçš„ä¿¡æ¯åº”è¯¥å¾ˆç®€å•ï¼š\nstatus â€“ HTTP çŠ¶æ€ä»£ç  message â€“ ä¸å¼‚å¸¸ç›¸å…³çš„é”™è¯¯æ¶ˆæ¯ error â€“ æ„å»ºçš„é”™è¯¯æ¶ˆæ¯åˆ—è¡¨ å½“ç„¶ï¼Œå¯¹äº Spring ä¸­çš„å®é™…å¼‚å¸¸å¤„ç†é€»è¾‘ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ @ControllerAdvice æ³¨è§£ï¼š\n@ControllerAdvice public class CustomRestExceptionHandler extends ResponseEntityExceptionHandler { ... } 3. å¤„ç†é”™è¯¯è¯·æ±‚å¼‚å¸¸ 3.1.å¤„ç†å¼‚å¸¸ ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å¤„ç†æœ€å¸¸è§çš„å®¢æˆ·ç«¯é”™è¯¯ - åŸºæœ¬ä¸Šæ˜¯å®¢æˆ·ç«¯å‘ API å‘é€æ— æ•ˆè¯·æ±‚çš„æƒ…å†µï¼š\nBindException â€“ å‘ç”Ÿè‡´å‘½ç»‘å®šé”™è¯¯æ—¶æŠ›å‡ºæ­¤å¼‚å¸¸ã€‚ MethodArgumentNotValidException â€“ å½“ä½¿ç”¨ @Valid æ³¨è§£çš„å‚æ•°éªŒè¯å¤±è´¥æ—¶æŠ›å‡ºæ­¤å¼‚å¸¸ï¼š @Override protected ResponseEntity\u0026lt;Object\u0026gt; handleMethodArgumentNotValid( MethodArgumentNotValidException ex, HttpHeaders headers, HttpStatus status, WebRequest request) { List\u0026lt;String\u0026gt; errors = new ArrayList\u0026lt;String\u0026gt;(); for (FieldError error : ex.getBindingResult().getFieldErrors()) { errors.add(error.getField() + \u0026#34;: \u0026#34; + error.getDefaultMessage()); } for (ObjectError error : ex.getBindingResult().getGlobalErrors()) { errors.add(error.getObjectName() + \u0026#34;: \u0026#34; + error.getDefaultMessage()); } ApiError apiError = new ApiError(HttpStatus.BAD_REQUEST, ex.getLocalizedMessage(), errors); return handleExceptionInternal( ex, apiError, headers, apiError.getStatus(), request); } è¯·æ³¨æ„ï¼Œæˆ‘ä»¬æ­£åœ¨é‡å†™ ResponseEntityExceptionHandler çš„åŸºæœ¬æ–¹æ³•å¹¶æä¾›æˆ‘ä»¬è‡ªå·±çš„è‡ªå®šä¹‰å®ç°ã€‚æƒ…å†µå¹¶éæ€»æ˜¯å¦‚æ­¤ã€‚æœ‰æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å¤„ç†åŸºç±»ä¸­æ²¡æœ‰é»˜è®¤å®ç°çš„è‡ªå®šä¹‰å¼‚å¸¸ï¼Œç¨åæˆ‘ä»¬å°†åœ¨è¿™é‡Œçœ‹åˆ°ã€‚\nä¸‹ä¸€ä¸ªï¼š\nMissingServletRequestPartException â€“ å½“æœªæ‰¾åˆ°å¤šéƒ¨åˆ†è¯·æ±‚çš„ä¸€éƒ¨åˆ†æ—¶å¼•å‘æ­¤å¼‚å¸¸ã€‚ MissingServletRequestParameterException â€“ å½“è¯·æ±‚ç¼ºå°‘å‚æ•°æ—¶æŠ›å‡ºæ­¤å¼‚å¸¸ï¼š @Override protected ResponseEntity\u0026lt;Object\u0026gt; handleMissingServletRequestParameter( MissingServletRequestParameterException ex, HttpHeaders headers, HttpStatus status, WebRequest request) { String error = ex.getParameterName() + \u0026#34; parameter is missing\u0026#34;; ApiError apiError = new ApiError(HttpStatus.BAD_REQUEST, ex.getLocalizedMessage(), error); return new ResponseEntity\u0026lt;Object\u0026gt;( apiError, new HttpHeaders(), apiError.getStatus()); } ConstraintViolationException â€“ æ­¤å¼‚å¸¸æŠ¥å‘Šçº¦æŸè¿è§„çš„ç»“æœï¼š @ExceptionHandler({ ConstraintViolationException.class }) public ResponseEntity\u0026lt;Object\u0026gt; handleConstraintViolation( ConstraintViolationException ex, WebRequest request) { List\u0026lt;String\u0026gt; errors = new ArrayList\u0026lt;String\u0026gt;(); for (ConstraintViolation\u0026lt;?\u0026gt; violation : ex.getConstraintViolations()) { errors.add(violation.getRootBeanClass().getName() + \u0026#34; \u0026#34; + violation.getPropertyPath() + \u0026#34;: \u0026#34; + violation.getMessage()); } ApiError apiError = new ApiError(HttpStatus.BAD_REQUEST, ex.getLocalizedMessage(), errors); return new ResponseEntity\u0026lt;Object\u0026gt;( apiError, new HttpHeaders(), apiError.getStatus()); } TypeMismatchException â€“ å½“å°è¯•è®¾ç½®é”™è¯¯ç±»å‹çš„ bean å±æ€§æ—¶æŠ›å‡ºæ­¤å¼‚å¸¸ã€‚ MethodArgumentTypeMismatchException â€“ å½“æ–¹æ³•å‚æ•°ä¸æ˜¯é¢„æœŸç±»å‹æ—¶æŠ›å‡ºæ­¤å¼‚å¸¸ï¼š @ExceptionHandler({ MethodArgumentTypeMismatchException.class }) public ResponseEntity\u0026lt;Object\u0026gt; handleMethodArgumentTypeMismatch( MethodArgumentTypeMismatchException ex, WebRequest request) { String error = ex.getName() + \u0026#34; should be of type \u0026#34; + ex.getRequiredType().getName(); ApiError apiError = new ApiError(HttpStatus.BAD_REQUEST, ex.getLocalizedMessage(), error); return new ResponseEntity\u0026lt;Object\u0026gt;( apiError, new HttpHeaders(), apiError.getStatus()); } 3.2.ä»å®¢æˆ·ç«¯ä½¿ç”¨ API ç°åœ¨è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹é‡åˆ° MethodArgumentTypeMismatchException çš„æµ‹è¯•ã€‚\næˆ‘ä»¬å°†å‘é€ä¸€ä¸ª id ä¸º String è€Œä¸æ˜¯ long çš„è¯·æ±‚ï¼š\n@Test public void whenMethodArgumentMismatch_thenBadRequest() { Response response = givenAuth().get(URL_PREFIX + \u0026#34;/api/foos/ccc\u0026#34;); ApiError error = response.as(ApiError.class); assertEquals(HttpStatus.BAD_REQUEST, error.getStatus()); assertEquals(1, error.getErrors().size()); assertTrue(error.getErrors().get(0).contains(\u0026#34;should be of type\u0026#34;)); } æœ€åï¼Œè€ƒè™‘åˆ°åŒæ ·çš„è¯·æ±‚ï¼š\nRequest method:\tGET Request path:\thttp://localhost:8080/spring-security-rest/api/foos/ccc æ­¤ç±» JSON é”™è¯¯å“åº”å¦‚ä¸‹æ‰€ç¤ºï¼š\n{ \u0026#34;status\u0026#34;: \u0026#34;BAD_REQUEST\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;Failed to convert value of type [java.lang.String] to required type [java.lang.Long]; nested exception is java.lang.NumberFormatException: For input string: \\\u0026#34;ccc\\\u0026#34;\u0026#34;, \u0026#34;errors\u0026#34;: [ \u0026#34;id should be of type java.lang.Long\u0026#34; ] } 4. å¤„ç† NoHandlerFoundException æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ servlet æ¥æŠ›å‡ºæ­¤å¼‚å¸¸ï¼Œè€Œä¸æ˜¯å‘é€ 404 å“åº”ï¼š\n\u0026lt;servlet\u0026gt; \u0026lt;servlet-name\u0026gt;api\u0026lt;/servlet-name\u0026gt; \u0026lt;servlet-class\u0026gt; org.springframework.web.servlet.DispatcherServlet\u0026lt;/servlet-class\u0026gt; \u0026lt;init-param\u0026gt; \u0026lt;param-name\u0026gt;throwExceptionIfNoHandlerFound\u0026lt;/param-name\u0026gt; \u0026lt;param-value\u0026gt;true\u0026lt;/param-value\u0026gt; \u0026lt;/init-param\u0026gt; \u0026lt;/servlet\u0026gt; ç„¶åï¼Œä¸€æ—¦å‘ç”Ÿè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥åƒå¤„ç†ä»»ä½•å…¶ä»–å¼‚å¸¸ä¸€æ ·ç®€å•åœ°å¤„ç†å®ƒï¼š\n@Override protected ResponseEntity\u0026lt;Object\u0026gt; handleNoHandlerFoundException( NoHandlerFoundException ex, HttpHeaders headers, HttpStatus status, WebRequest request) { String error = \u0026#34;No handler found for \u0026#34; + ex.getHttpMethod() + \u0026#34; \u0026#34; + ex.getRequestURL(); ApiError apiError = new ApiError(HttpStatus.NOT_FOUND, ex.getLocalizedMessage(), error); return new ResponseEntity\u0026lt;Object\u0026gt;(apiError, new HttpHeaders(), apiError.getStatus()); } è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æµ‹è¯•ï¼š\n@Test public void whenNoHandlerForHttpRequest_thenNotFound() { Response response = givenAuth().delete(URL_PREFIX + \u0026#34;/api/xx\u0026#34;); ApiError error = response.as(ApiError.class); assertEquals(HttpStatus.NOT_FOUND, error.getStatus()); assertEquals(1, error.getErrors().size()); assertTrue(error.getErrors().get(0).contains(\u0026#34;No handler found\u0026#34;)); }è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å®Œæ•´çš„è¯·æ±‚ï¼š Request method:\tDELETE Request path:\thttp://localhost:8080/spring-security-rest/api/xx ä»¥åŠé”™è¯¯ JSON å“åº”ï¼š\n{ \u0026#34;status\u0026#34;:\u0026#34;NOT_FOUND\u0026#34;, \u0026#34;message\u0026#34;:\u0026#34;No handler found for DELETE /spring-security-rest/api/xx\u0026#34;, \u0026#34;errors\u0026#34;:[ \u0026#34;No handler found for DELETE /spring-security-rest/api/xx\u0026#34; ] } æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†çœ‹çœ‹å¦ä¸€ä¸ªæœ‰è¶£çš„å¼‚å¸¸ã€‚\n5. å¤„ç† HttpRequestMethodNotSupportedException å½“æˆ‘ä»¬ä½¿ç”¨ä¸å—æ”¯æŒçš„ HTTP æ–¹æ³•å‘é€è¯·æ±‚æ—¶ï¼Œä¼šå‘ç”Ÿ HttpRequestMethodNotSupportedExceptionï¼š\n@Override protected ResponseEntity\u0026lt;Object\u0026gt; handleHttpRequestMethodNotSupported( HttpRequestMethodNotSupportedException ex, HttpHeaders headers, HttpStatus status, WebRequest request) { StringBuilder builder = new StringBuilder(); builder.append(ex.getMethod()); builder.append( \u0026#34; method is not supported for this request. Supported methods are \u0026#34;); ex.getSupportedHttpMethods().forEach(t -\u0026gt; builder.append(t + \u0026#34; \u0026#34;)); ApiError apiError = new ApiError(HttpStatus.METHOD_NOT_ALLOWED, ex.getLocalizedMessage(), builder.toString()); return new ResponseEntity\u0026lt;Object\u0026gt;( apiError, new HttpHeaders(), apiError.getStatus()); } è¿™æ˜¯ä¸€ä¸ªé‡ç°æ­¤å¼‚å¸¸çš„ç®€å•æµ‹è¯•ï¼š\n@Test public void whenHttpRequestMethodNotSupported_thenMethodNotAllowed() { Response response = givenAuth().delete(URL_PREFIX + \u0026#34;/api/foos/1\u0026#34;); ApiError error = response.as(ApiError.class); assertEquals(HttpStatus.METHOD_NOT_ALLOWED, error.getStatus()); assertEquals(1, error.getErrors().size()); assertTrue(error.getErrors().get(0).contains(\u0026#34;Supported methods are\u0026#34;)); } è¿™æ˜¯å®Œæ•´çš„è¯·æ±‚ï¼š\nRequest method:\tDELETE Request path:\thttp://localhost:8080/spring-security-rest/api/foos/1 ä»¥åŠé”™è¯¯ JSON å“åº”ï¼š\n{ \u0026#34;status\u0026#34;:\u0026#34;METHOD_NOT_ALLOWED\u0026#34;, \u0026#34;message\u0026#34;:\u0026#34;Request method \u0026#39;DELETE\u0026#39; not supported\u0026#34;, \u0026#34;errors\u0026#34;:[ \u0026#34;DELETE method is not supported for this request. Supported methods are GET \u0026#34; ] } 6. å¤„ç† HttpMediaTypeNotSupportedException ç°åœ¨è®©æˆ‘ä»¬å¤„ç† HttpMediaTypeNotSupportedExceptionï¼Œå½“å®¢æˆ·ç«¯å‘é€ä¸æ”¯æŒçš„åª’ä½“ç±»å‹çš„è¯·æ±‚æ—¶ä¼šå‘ç”Ÿè¯¥å¼‚å¸¸ï¼š\n@Override protected ResponseEntity\u0026lt;Object\u0026gt; handleHttpMediaTypeNotSupported( HttpMediaTypeNotSupportedException ex, HttpHeaders headers, HttpStatus status, WebRequest request) { StringBuilder builder = new StringBuilder(); builder.append(ex.getContentType()); builder.append(\u0026#34; media type is not supported. Supported media types are \u0026#34;); ex.getSupportedMediaTypes().forEach(t -\u0026gt; builder.append(t + \u0026#34;, \u0026#34;)); ApiError apiError = new ApiError(HttpStatus.UNSUPPORTED_MEDIA_TYPE, ex.getLocalizedMessage(), builder.substring(0, builder.length() - 2)); return new ResponseEntity\u0026lt;Object\u0026gt;( apiError, new HttpHeaders(), apiError.getStatus()); } è¿™æ˜¯é’ˆå¯¹æ­¤é—®é¢˜çš„ç®€å•æµ‹è¯•ï¼š\n@Test public void whenSendInvalidHttpMediaType_thenUnsupportedMediaType() { Response response = givenAuth().body(\u0026#34;\u0026#34;).post(URL_PREFIX + \u0026#34;/api/foos\u0026#34;); ApiError error = response.as(ApiError.class); assertEquals(HttpStatus.UNSUPPORTED_MEDIA_TYPE, error.getStatus()); assertEquals(1, error.getErrors().size()); assertTrue(error.getErrors().get(0).contains(\u0026#34;media type is not supported\u0026#34;)); } æœ€åï¼Œè¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹è¯·æ±‚ï¼š\nRequest method:\tPOST Request path:\thttp://localhost:8080/spring-security- Headers:\tContent-Type=text/plain; charset=ISO-8859-1 ä»¥åŠé”™è¯¯ JSON å“åº”ï¼š\n{ \u0026#34;status\u0026#34;:\u0026#34;UNSUPPORTED_MEDIA_TYPE\u0026#34;, \u0026#34;message\u0026#34;:\u0026#34;Content type \u0026#39;text/plain;charset=ISO-8859-1\u0026#39; not supported\u0026#34;, \u0026#34;errors\u0026#34;:[\u0026#34;text/plain;charset=ISO-8859-1 media type is not supported. Supported media types are text/xml application/x-www-form-urlencoded application/*+xml application/json;charset=UTF-8 application/*+json;charset=UTF-8 */\u0026#34; ] } 7. é»˜è®¤å¤„ç†ç¨‹åº æœ€åï¼Œæˆ‘ä»¬å°†å®ç°ä¸€ä¸ªåå¤‡å¤„ç†ç¨‹åº - ä¸€ç§åŒ…ç½—ä¸‡è±¡çš„é€»è¾‘ç±»å‹ï¼Œç”¨äºå¤„ç†æ²¡æœ‰ç‰¹å®šå¤„ç†ç¨‹åºçš„æ‰€æœ‰å…¶ä»–å¼‚å¸¸ï¼š\n@ExceptionHandler({ Exception.class }) public ResponseEntity\u0026lt;Object\u0026gt; handleAll(Exception ex, WebRequest request) { ApiError apiError = new ApiError( HttpStatus.INTERNAL_SERVER_ERROR, ex.getLocalizedMessage(), \u0026#34;error occurred\u0026#34;); return new ResponseEntity\u0026lt;Object\u0026gt;( apiError, new HttpHeaders(), apiError.getStatus()); } 8.ç»“è®º ä¸º Spring REST API æ„å»ºé€‚å½“ã€æˆç†Ÿçš„é”™è¯¯å¤„ç†ç¨‹åºéå¸¸å›°éš¾ï¼Œè€Œä¸”ç»å¯¹æ˜¯ä¸€ä¸ªè¿­ä»£è¿‡ç¨‹ã€‚å¸Œæœ›æœ¬æ•™ç¨‹å°†æ˜¯ä¸€ä¸ªè‰¯å¥½çš„èµ·ç‚¹ï¼Œä¹Ÿæ˜¯å¸®åŠ© API å®¢æˆ·ç«¯å¿«é€Ÿè½»æ¾åœ°è¯Šæ–­é”™è¯¯å¹¶å…‹æœé”™è¯¯çš„è‰¯å¥½é”šç‚¹ã€‚\næœ¬æ•™ç¨‹çš„å®Œæ•´å®ç°å¯ä»¥åœ¨ GitHub é¡¹ç›®ä¸­æ‰¾åˆ°ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºäº Eclipse çš„é¡¹ç›®ï¼Œå› æ­¤åº”è¯¥å¾ˆå®¹æ˜“å¯¼å…¥å¹¶æŒ‰åŸæ ·è¿è¡Œã€‚\nåŸæ–‡é“¾æ¥ï¼šhttps://www.baeldung.com/global-error-handler-in-a-spring-rest-api\n","permalink":"https://blog.chensoul.cc/posts/2023/08/25/global-error-handler-in-a-spring-rest-api/","summary":"1. æ¦‚è¿° åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•ä¸º Spring REST API å®ç°å…¨å±€é”™è¯¯å¤„ç†ç¨‹åºã€‚\næˆ‘ä»¬å°†ä½¿ç”¨æ¯ä¸ªå¼‚å¸¸çš„è¯­ä¹‰ä¸ºå®¢æˆ·ç«¯æ„å»ºæœ‰æ„ä¹‰çš„é”™è¯¯æ¶ˆæ¯ï¼Œå…¶æ˜ç¡®çš„ç›®æ ‡æ˜¯ä¸ºå®¢æˆ·ç«¯æä¾›æ‰€æœ‰ä¿¡æ¯ä»¥è½»æ¾è¯Šæ–­é—®é¢˜ã€‚\n2. è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯ è®©æˆ‘ä»¬é¦–å…ˆå®ç°ä¸€ä¸ªç”¨äºé€šè¿‡çº¿è·¯å‘é€é”™è¯¯çš„ç®€å•ç»“æ„ â€” ApiErrorï¼š\npublic class ApiError { private HttpStatus status; private String message; private List\u0026lt;String\u0026gt; errors; public ApiError(HttpStatus status, String message, List\u0026lt;String\u0026gt; errors) { super(); this.status = status; this.message = message; this.errors = errors; } public ApiError(HttpStatus status, String message, String error) { super(); this.status = status; this.message = message; errors = Arrays.asList(error); } } è¿™é‡Œçš„ä¿¡æ¯åº”è¯¥å¾ˆç®€å•ï¼š\nstatus â€“ HTTP çŠ¶æ€ä»£ç  message â€“ ä¸å¼‚å¸¸ç›¸å…³çš„é”™è¯¯æ¶ˆæ¯ error â€“ æ„å»ºçš„é”™è¯¯æ¶ˆæ¯åˆ—è¡¨ å½“ç„¶ï¼Œå¯¹äº Spring ä¸­çš„å®é™…å¼‚å¸¸å¤„ç†é€»è¾‘ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ @ControllerAdvice æ³¨è§£ï¼š\n@ControllerAdvice public class CustomRestExceptionHandler extends ResponseEntityExceptionHandler { ... } 3. å¤„ç†é”™è¯¯è¯·æ±‚å¼‚å¸¸ 3.1.å¤„ç†å¼‚å¸¸ ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å¤„ç†æœ€å¸¸è§çš„å®¢æˆ·ç«¯é”™è¯¯ - åŸºæœ¬ä¸Šæ˜¯å®¢æˆ·ç«¯å‘ API å‘é€æ— æ•ˆè¯·æ±‚çš„æƒ…å†µï¼š\nBindException â€“ å‘ç”Ÿè‡´å‘½ç»‘å®šé”™è¯¯æ—¶æŠ›å‡ºæ­¤å¼‚å¸¸ã€‚ MethodArgumentNotValidException â€“ å½“ä½¿ç”¨ @Valid æ³¨è§£çš„å‚æ•°éªŒè¯å¤±è´¥æ—¶æŠ›å‡ºæ­¤å¼‚å¸¸ï¼š @Override protected ResponseEntity\u0026lt;Object\u0026gt; handleMethodArgumentNotValid( MethodArgumentNotValidException ex, HttpHeaders headers, HttpStatus status, WebRequest request) { List\u0026lt;String\u0026gt; errors = new ArrayList\u0026lt;String\u0026gt;(); for (FieldError error : ex.","title":"[è¯‘]REST API çš„è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯å¤„ç†"},{"content":"1. æ¦‚è¿° æœ¬æ•™ç¨‹å°†è¯´æ˜å¦‚ä½•ä½¿ç”¨ Spring ä¸º REST API å®ç°å¼‚å¸¸å¤„ç†ã€‚æˆ‘ä»¬è¿˜å°†è·å¾—ä¸€äº›å†å²æ¦‚è¿°ï¼Œå¹¶äº†è§£ä¸åŒç‰ˆæœ¬å¼•å…¥äº†å“ªäº›æ–°é€‰é¡¹ã€‚\nåœ¨ Spring 3.2 ä¹‹å‰ï¼ŒSpring MVC åº”ç”¨ç¨‹åºä¸­å¤„ç†å¼‚å¸¸çš„ä¸¤ç§ä¸»è¦æ–¹æ³•æ˜¯ HandlerExceptionResolver æˆ– @ExceptionHandler æ³¨è§£ã€‚ä¸¤è€…éƒ½æœ‰ä¸€äº›æ˜æ˜¾çš„ç¼ºç‚¹ã€‚\nä» 3.2 å¼€å§‹ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† @ControllerAdvice æ³¨é‡Šæ¥è§£å†³å‰ä¸¤ä¸ªè§£å†³æ–¹æ¡ˆçš„å±€é™æ€§ï¼Œå¹¶ä¿ƒè¿›æ•´ä¸ªåº”ç”¨ç¨‹åºçš„ç»Ÿä¸€å¼‚å¸¸å¤„ç†ã€‚\nç°åœ¨ Spring 5 å¼•å…¥äº† ResponseStatusException ç±»ï¼Œä¸€ç§åœ¨ REST API ä¸­è¿›è¡ŒåŸºæœ¬é”™è¯¯å¤„ç†çš„å¿«é€Ÿæ–¹æ³•ã€‚\næ‰€æœ‰è¿™äº›éƒ½æœ‰ä¸€ä¸ªå…±åŒç‚¹ï¼šå®ƒä»¬å¾ˆå¥½åœ°å¤„ç†äº†å…³æ³¨ç‚¹åˆ†ç¦»ã€‚åº”ç”¨ç¨‹åºå¯ä»¥æ­£å¸¸æŠ›å‡ºå¼‚å¸¸æ¥æŒ‡ç¤ºæŸç§å¤±è´¥ï¼Œç„¶åå°†å•ç‹¬å¤„ç†ã€‚\næœ€åï¼Œæˆ‘ä»¬å°†äº†è§£ Spring Boot å¸¦æ¥çš„åŠŸèƒ½ä»¥åŠå¦‚ä½•é…ç½®å®ƒä»¥æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚\n2.æ–¹æ¡ˆä¸€ï¼šæ§åˆ¶å™¨çº§@ExceptionHandler ç¬¬ä¸€ä¸ªè§£å†³æ–¹æ¡ˆåœ¨ @Controller çº§åˆ«å·¥ä½œã€‚æˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ªå¤„ç†å¼‚å¸¸çš„æ–¹æ³•å¹¶ä½¿ç”¨@ExceptionHandler è¿›è¡Œæ³¨é‡Šï¼š\npublic class FooController{ //... @ExceptionHandler({ CustomException1.class, CustomException2.class }) public void handleException() { // } } è¿™ç§æ–¹æ³•æœ‰ä¸€ä¸ªä¸»è¦ç¼ºç‚¹ï¼šÂ· æ³¨è§£çš„æ–¹æ³•ä»…å¯¹ç‰¹å®šçš„æ§åˆ¶å™¨æœ‰æ•ˆï¼Œè€Œä¸æ˜¯å¯¹æ•´ä¸ªåº”ç”¨ç¨‹åºå…¨å±€æœ‰æ•ˆã€‚å½“ç„¶ï¼Œå°†å…¶æ·»åŠ åˆ°æ¯ä¸ªæ§åˆ¶å™¨ä½¿å…¶ä¸å¤ªé€‚åˆé€šç”¨å¼‚å¸¸å¤„ç†æœºåˆ¶ã€‚\næˆ‘ä»¬å¯ä»¥é€šè¿‡è®©æ‰€æœ‰æ§åˆ¶å™¨æ‰©å±•åŸºæœ¬æ§åˆ¶å™¨ç±»æ¥è§£å†³æ­¤é™åˆ¶ã€‚\nç„¶è€Œï¼Œå¯¹äºæ— è®ºå‡ºäºä½•ç§åŸå› è¿™æ˜¯ä¸å¯èƒ½çš„åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œæ­¤è§£å†³æ–¹æ¡ˆå¯èƒ½æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚ä¾‹å¦‚ï¼Œæ§åˆ¶å™¨å¯èƒ½å·²ç»ä»å¦ä¸€ä¸ªåŸºç±»æ‰©å±•ï¼Œè¯¥åŸºç±»å¯èƒ½ä½äºå¦ä¸€ä¸ª jar ä¸­æˆ–ä¸å¯ç›´æ¥ä¿®æ”¹ï¼Œæˆ–è€…æœ¬èº«å¯èƒ½ä¸å¯ç›´æ¥ä¿®æ”¹ã€‚\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ç ”ç©¶å¦ä¸€ç§è§£å†³å¼‚å¸¸å¤„ç†é—®é¢˜çš„æ–¹æ³• - ä¸€ç§å…¨å±€çš„æ–¹æ³•ï¼Œä¸åŒ…æ‹¬å¯¹ç°æœ‰å·¥ä»¶ï¼ˆä¾‹å¦‚æ§åˆ¶å™¨ï¼‰çš„ä»»ä½•æ›´æ”¹ã€‚\n3.è§£å†³æ–¹æ¡ˆ 2ï¼šHandlerExceptionResolver ç¬¬äºŒç§è§£å†³æ–¹æ¡ˆæ˜¯å®šä¹‰ä¸€ä¸ª HandlerExceptionResolverã€‚è¿™å°†è§£å†³åº”ç”¨ç¨‹åºæŠ›å‡ºçš„ä»»ä½•å¼‚å¸¸ã€‚å®ƒè¿˜å…è®¸æˆ‘ä»¬åœ¨ REST API ä¸­å®ç°ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ã€‚\nåœ¨é€‰æ‹©è‡ªå®šä¹‰è§£æå™¨ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹ç°æœ‰çš„å®ç°ã€‚\n3.1.å¼‚å¸¸å¤„ç†å™¨å¼‚å¸¸è§£æå™¨ è¯¥è§£æå™¨æ˜¯åœ¨ Spring 3.1 ä¸­å¼•å…¥çš„ï¼Œå¹¶ä¸”åœ¨ DispatcherServlet ä¸­é»˜è®¤å¯ç”¨ã€‚è¿™å®é™…ä¸Šæ˜¯å‰é¢ä»‹ç»çš„ @ExceptionHandler æœºåˆ¶å¦‚ä½•å·¥ä½œçš„æ ¸å¿ƒç»„ä»¶ã€‚\n3.2.é»˜è®¤å¤„ç†ç¨‹åºå¼‚å¸¸è§£æå™¨ è¿™ä¸ªè§£æå™¨æ˜¯åœ¨ Spring 3.0 ä¸­å¼•å…¥çš„ï¼Œå¹¶ä¸”åœ¨ DispatcherServlet ä¸­é»˜è®¤å¯ç”¨ã€‚\nå®ƒç”¨äºå°†æ ‡å‡† Spring å¼‚å¸¸è§£æä¸ºå…¶ç›¸åº”çš„ HTTP çŠ¶æ€ä»£ç ï¼Œå³å®¢æˆ·ç«¯é”™è¯¯ 4xx å’ŒæœåŠ¡å™¨é”™è¯¯ 5xx çŠ¶æ€ä»£ç ã€‚ä»¥ä¸‹æ˜¯å®ƒå¤„ç†çš„ Spring å¼‚å¸¸çš„å®Œæ•´åˆ—è¡¨ä»¥åŠå®ƒä»¬å¦‚ä½•æ˜ å°„åˆ°çŠ¶æ€ä»£ç ã€‚\nè™½ç„¶å®ƒç¡®å®æ­£ç¡®è®¾ç½®äº†å“åº”çš„çŠ¶æ€ä»£ç ï¼Œä½†ä¸€ä¸ªé™åˆ¶æ˜¯å®ƒä¸ä¼šå¯¹å“åº”æ­£æ–‡è®¾ç½®ä»»ä½•å†…å®¹ã€‚å¯¹äº REST APIï¼ˆçŠ¶æ€ä»£ç å®é™…ä¸Šä¸è¶³ä»¥å‘å®¢æˆ·ç«¯æä¾›è¶³å¤Ÿçš„ä¿¡æ¯ï¼‰ï¼Œå“åº”è¿˜å¿…é¡»æœ‰ä¸€ä¸ªæ­£æ–‡ï¼Œä»¥å…è®¸åº”ç”¨ç¨‹åºæä¾›æœ‰å…³å¤±è´¥çš„é™„åŠ ä¿¡æ¯ã€‚\nè¿™å¯ä»¥é€šè¿‡ Â· é…ç½®è§†å›¾åˆ†è¾¨ç‡å¹¶æ¸²æŸ“é”™è¯¯å†…å®¹æ¥è§£å†³ï¼Œä½†è¯¥è§£å†³æ–¹æ¡ˆæ˜¾ç„¶ä¸æ˜¯æœ€ä¼˜çš„ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ Spring 3.2 å¼•å…¥äº†ä¸€ä¸ªæ›´å¥½çš„é€‰é¡¹ï¼Œæˆ‘ä»¬å°†åœ¨åé¢çš„éƒ¨åˆ†ä¸­è®¨è®ºã€‚\n3.3.å“åº”çŠ¶æ€å¼‚å¸¸è§£æå™¨ è¿™ä¸ªè§£æå™¨ä¹Ÿåœ¨ Spring 3.0 ä¸­å¼•å…¥ï¼Œå¹¶ä¸”åœ¨ Â· ä¸­é»˜è®¤å¯ç”¨ã€‚\nå®ƒçš„ä¸»è¦èŒè´£æ˜¯ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸ä¸Šå¯ç”¨çš„ @ResponseStatus æ³¨é‡Šå¹¶å°†è¿™äº›å¼‚å¸¸æ˜ å°„åˆ° HTTP çŠ¶æ€ä»£ç ã€‚\nè¿™æ ·çš„è‡ªå®šä¹‰å¼‚å¸¸å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š\n@ResponseStatus(value = HttpStatus.NOT_FOUND) public class MyResourceNotFoundException extends RuntimeException { public MyResourceNotFoundException() { super(); } public MyResourceNotFoundException(String message, Throwable cause) { super(message, cause); } public MyResourceNotFoundException(String message) { super(message); } public MyResourceNotFoundException(Throwable cause) { super(cause); } } ä¸ DefaultHandlerExceptionResolver ç›¸åŒï¼Œæ­¤è§£æå™¨åœ¨å¤„ç†å“åº”æ­£æ–‡çš„æ–¹å¼ä¸Šå—åˆ°é™åˆ¶ - å®ƒç¡®å®å°†çŠ¶æ€ä»£ç æ˜ å°„åˆ°å“åº”ä¸Šï¼Œä½†æ­£æ–‡ä»ç„¶ä¸ºç©ºã€‚\n3.4.è‡ªå®šä¹‰ HandlerExceptionResolver DefaultHandlerExceptionResolver å’Œ ResponseStatusExceptionResolver çš„ç»„åˆå¤§å¤§æœ‰åŠ©äºä¸º Spring RESTful æœåŠ¡æä¾›è‰¯å¥½çš„é”™è¯¯å¤„ç†æœºåˆ¶ã€‚å¦‚å‰æ‰€è¿°ï¼Œç¼ºç‚¹æ˜¯æ— æ³•æ§åˆ¶å“åº”çš„æ­£æ–‡ã€‚\nç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿè¾“å‡º JSON æˆ– XMLï¼Œå…·ä½“å–å†³äºå®¢æˆ·ç«¯è¦æ±‚çš„æ ¼å¼ï¼ˆé€šè¿‡ Accept æ ‡å¤´ï¼‰ã€‚\nä»…æ­¤ä¸€ç‚¹å°±è¯æ˜åˆ›å»ºä¸€ä¸ªæ–°çš„è‡ªå®šä¹‰å¼‚å¸¸è§£æå™¨æ˜¯åˆç†çš„ï¼š\n@Component public class RestResponseStatusExceptionResolver extends AbstractHandlerExceptionResolver { @Override protected ModelAndView doResolveException( HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) { try { if (ex instanceof IllegalArgumentException) { return handleIllegalArgument( (IllegalArgumentException) ex, response, handler); } ... } catch (Exception handlerException) { logger.warn(\u0026#34;Handling of [\u0026#34; + ex.getClass().getName() + \u0026#34;] resulted in Exception\u0026#34;, handlerException); } return null; } private ModelAndView handleIllegalArgument(IllegalArgumentException ex, HttpServletResponse response) throws IOException { response.sendError(HttpServletResponse.SC_CONFLICT); String accept = request.getHeader(HttpHeaders.ACCEPT); ... return new ModelAndView(); } } è¿™é‡Œéœ€è¦æ³¨æ„çš„ä¸€ä¸ªç»†èŠ‚æ˜¯æˆ‘ä»¬å¯ä»¥è®¿é—®è¯·æ±‚æœ¬èº«ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è€ƒè™‘å®¢æˆ·ç«¯å‘é€çš„ Accept æ ‡å¤´çš„å€¼ã€‚\nä¾‹å¦‚ï¼Œå¦‚æœå®¢æˆ·ç«¯è¯·æ±‚ application/jsonï¼Œé‚£ä¹ˆåœ¨å‡ºç°é”™è¯¯æƒ…å†µæ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›ç¡®ä¿è¿”å›ç”¨ application/json ç¼–ç çš„å“åº”æ­£æ–‡ã€‚\nå¦ä¸€ä¸ªé‡è¦çš„å®ç°ç»†èŠ‚æ˜¯æˆ‘ä»¬è¿”å›ä¸€ä¸ª ModelAndViewâ€”â€”è¿™æ˜¯å“åº”çš„ä¸»ä½“ï¼Œå®ƒå°†å…è®¸æˆ‘ä»¬å¯¹å…¶è¿›è¡Œå¿…è¦çš„è®¾ç½®ã€‚\nè¿™ç§æ–¹æ³•æ˜¯ä¸€ç§ä¸€è‡´ä¸”æ˜“äºé…ç½®çš„æœºåˆ¶ï¼Œç”¨äº Spring REST æœåŠ¡çš„é”™ â€‹â€‹ è¯¯å¤„ç†ã€‚\nç„¶è€Œï¼Œå®ƒç¡®å®æœ‰å±€é™æ€§ï¼šå®ƒä¸ä½çº§ HtttpServletResponse äº¤äº’ï¼Œå¹¶ä¸”é€‚åˆä½¿ç”¨ ModelAndView çš„æ—§ MVC æ¨¡å‹ï¼Œå› æ­¤ä»æœ‰æ”¹è¿›çš„ç©ºé—´ã€‚\n4.è§£å†³æ–¹æ¡ˆ 3ï¼š@ControllerAdvice Spring 3.2 é€šè¿‡ @ControllerAdvice æ³¨é‡Šæ”¯æŒå…¨å±€ @ExceptionHandlerã€‚\nè¿™å®ç°äº†ä¸€ç§è„±ç¦»æ—§ MVC æ¨¡å‹çš„æœºåˆ¶ï¼Œå¹¶åˆ©ç”¨ ResponseEntity ä»¥åŠ @ExceptionHandler çš„ç±»å‹å®‰å…¨æ€§å’Œçµæ´»æ€§ï¼š\n@ControllerAdvice public class RestResponseEntityExceptionHandler extends ResponseEntityExceptionHandler { @ExceptionHandler(value = { IllegalArgumentException.class, IllegalStateException.class }) protected ResponseEntity\u0026lt;Object\u0026gt; handleConflict( RuntimeException ex, WebRequest request) { String bodyOfResponse = \u0026#34;This should be application specific\u0026#34;; return handleExceptionInternal(ex, bodyOfResponse, new HttpHeaders(), HttpStatus.CONFLICT, request); } } @ControllerAdvice æ³¨é‡Šå…è®¸æˆ‘ä»¬å°†ä¹‹å‰çš„å¤šä¸ªåˆ†æ•£çš„ @ExceptionHandler åˆå¹¶åˆ°ä¸€ä¸ªå…¨å±€é”™è¯¯å¤„ç†ç»„ä»¶ä¸­ã€‚\nå®é™…çš„æœºåˆ¶éå¸¸ç®€å•ä½†ä¹Ÿéå¸¸çµæ´»ï¼š\nå®ƒä½¿æˆ‘ä»¬èƒ½å¤Ÿå®Œå…¨æ§åˆ¶å“åº”æ­£æ–‡ä»¥åŠçŠ¶æ€ä»£ç ã€‚ å®ƒæä¾›äº†å¤šä¸ªå¼‚å¸¸åˆ°åŒä¸€æ–¹æ³•çš„æ˜ å°„ï¼Œä»¥ä¾¿ä¸€èµ·å¤„ç†ã€‚ å®ƒå……åˆ†åˆ©ç”¨äº†è¾ƒæ–°çš„ RESTful ResposeEntity å“åº”ã€‚ è¿™é‡Œè¦è®°ä½çš„ä¸€ä»¶äº‹æ˜¯å°†ä½¿ç”¨ @ExceptionHandler å£°æ˜çš„å¼‚å¸¸ä¸ç”¨ä½œæ–¹æ³•å‚æ•°çš„å¼‚å¸¸ç›¸åŒ¹é…ã€‚\nå¦‚æœå®ƒä»¬ä¸åŒ¹é…ï¼Œç¼–è¯‘å™¨ä¸ä¼šæŠ±æ€¨â€”â€”æ²¡æœ‰ç†ç”±åº”è¯¥æŠ±æ€¨â€”â€”Spring ä¹Ÿä¸ä¼šæŠ±æ€¨ã€‚\nç„¶è€Œï¼Œå½“å¼‚å¸¸åœ¨è¿è¡Œæ—¶å®é™…æŠ›å‡ºæ—¶ï¼Œå¼‚å¸¸è§£å†³æœºåˆ¶å°†å¤±è´¥ï¼Œå¹¶æ˜¾ç¤ºï¼š\njava.lang.IllegalStateException: No suitable resolver for argument [0] [type=...] HandlerMethod details: ... 5.è§£å†³æ–¹æ¡ˆ 4ï¼šResponseStatusExceptionï¼ˆSpring 5 åŠä»¥ä¸Šç‰ˆæœ¬ï¼‰ Spring 5 å¼•å…¥äº† ResponseStatusException ç±»ã€‚\næˆ‘ä»¬å¯ä»¥åˆ›å»ºå®ƒçš„ä¸€ä¸ªå®ä¾‹ï¼Œæä¾› HttpStatus å’Œå¯é€‰çš„åŸå› ï¼š\n@GetMapping(value = \u0026#34;/{id}\u0026#34;) public Foo findById(@PathVariable(\u0026#34;id\u0026#34;) Long id, HttpServletResponse response) { try { Foo resourceById = RestPreconditions.checkFound(service.findOne(id)); eventPublisher.publishEvent(new SingleResourceRetrievedEvent(this, response)); return resourceById; } catch (MyResourceNotFoundException exc) { throw new ResponseStatusException( HttpStatus.NOT_FOUND, \u0026#34;Foo Not Found\u0026#34;, exc); } } ä½¿ç”¨ ResponseStatusException æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ\néå¸¸é€‚åˆåŸå‹è®¾è®¡ï¼šæˆ‘ä»¬å¯ä»¥éå¸¸å¿«é€Ÿåœ°å®æ–½åŸºæœ¬è§£å†³æ–¹æ¡ˆã€‚ ä¸€ç§ç±»å‹ï¼Œå¤šä¸ªçŠ¶æ€ä»£ç ï¼šä¸€ç§å¼‚å¸¸ç±»å‹å¯ä»¥å¯¼è‡´å¤šç§ä¸åŒçš„å“åº”ã€‚ä¸ @ExceptionHandler ç›¸æ¯”ï¼Œè¿™å‡å°‘äº†ç´§å¯†è€¦åˆã€‚ æˆ‘ä»¬ä¸å¿…åˆ›å»ºé‚£ä¹ˆå¤šè‡ªå®šä¹‰å¼‚å¸¸ç±»ã€‚ ç”±äºå¯ä»¥é€šè¿‡ç¼–ç¨‹æ–¹å¼åˆ›å»ºå¼‚å¸¸ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æ›´å¥½åœ°æ§åˆ¶å¼‚å¸¸å¤„ç†ã€‚ é‚£ä¹ˆæƒè¡¡åˆå¦‚ä½•å‘¢ï¼Ÿ\næ²¡æœ‰ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†æ–¹å¼ï¼šä¸æä¾›å…¨å±€æ–¹æ³•çš„ @ControllerAdvice ç›¸æ¯”ï¼Œå¼ºåˆ¶æ‰§è¡Œä¸€äº›åº”ç”¨ç¨‹åºèŒƒå›´çš„çº¦å®šæ›´åŠ å›°éš¾ã€‚ ä»£ç é‡å¤ï¼šæˆ‘ä»¬å¯èƒ½ä¼šå‘ç°è‡ªå·±åœ¨å¤šä¸ªæ§åˆ¶å™¨ä¸­å¤åˆ¶ä»£ç ã€‚ æˆ‘ä»¬è¿˜åº”è¯¥æ³¨æ„åˆ°ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­ç»„åˆä¸åŒçš„æ–¹æ³•ã€‚\nä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å…¨å±€å®ç° @ControllerAdviceï¼Œä¹Ÿå¯ä»¥åœ¨æœ¬åœ°å®ç° ResponseStatusExceptionsã€‚\nä½†æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦å°å¿ƒï¼šå¦‚æœå¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å¤„ç†ç›¸åŒçš„å¼‚å¸¸ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæ³¨æ„åˆ°ä¸€äº›ä»¤äººæƒŠè®¶çš„è¡Œä¸ºã€‚ä¸€ç§å¯èƒ½çš„çº¦å®šæ˜¯å§‹ç»ˆä»¥ä¸€ç§æ–¹å¼å¤„ç†ä¸€ç§ç‰¹å®šç±»å‹çš„å¼‚å¸¸ã€‚\næœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯å’Œæ›´å¤šç¤ºä¾‹ï¼Œè¯·å‚é˜…æœ‰å…³ ResponseStatusException çš„æ•™ç¨‹ã€‚\n6.å¤„ç† Spring Security ä¸­æ‹’ç»è®¿é—®çš„æƒ…å†µ å½“ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·å°è¯•è®¿é—®ä»–æ²¡æœ‰è¶³å¤Ÿæƒé™è®¿é—®çš„èµ„æºæ—¶ï¼Œå°±ä¼šå‘ç”Ÿè®¿é—®è¢«æ‹’ç»çš„æƒ…å†µã€‚\n6.1. REST å’Œæ–¹æ³•çº§å®‰å…¨æ€§ æœ€åï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å¤„ç†æ–¹æ³•çº§å®‰å…¨æ³¨è§£ @PreAuthorizeã€@PostAuthorize å’Œ @Secure æŠ›å‡ºçš„ Access Denied å¼‚å¸¸ã€‚\nå½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå°†ä½¿ç”¨å‰é¢è®¨è®ºçš„å…¨å±€å¼‚å¸¸å¤„ç†æœºåˆ¶æ¥å¤„ç† AccessDeniedExceptionï¼š\n@ControllerAdvice public class RestResponseEntityExceptionHandler extends ResponseEntityExceptionHandler { @ExceptionHandler({ AccessDeniedException.class }) public ResponseEntity\u0026lt;Object\u0026gt; handleAccessDeniedException( Exception ex, WebRequest request) { return new ResponseEntity\u0026lt;Object\u0026gt;( \u0026#34;Access denied message here\u0026#34;, new HttpHeaders(), HttpStatus.FORBIDDEN); } ... } 7. Spring Boot æ”¯æŒ Spring Boot æä¾›äº† ErrorController å®ç°æ¥ä»¥åˆç†çš„æ–¹å¼å¤„ç†é”™è¯¯ã€‚\nç®€è€Œè¨€ä¹‹ï¼Œå®ƒä¸ºæµè§ˆå™¨æä¾›åå¤‡é”™è¯¯é¡µé¢ï¼ˆä¹Ÿç§°ä¸º Whitelabel é”™è¯¯é¡µé¢ï¼‰ï¼Œå¹¶ä¸º RESTfulã€é HTML è¯·æ±‚æä¾› JSON å“åº”ï¼š\n{ \u0026#34;timestamp\u0026#34;: \u0026#34;2019-01-17T16:12:45.977+0000\u0026#34;, \u0026#34;status\u0026#34;: 500, \u0026#34;error\u0026#34;: \u0026#34;Internal Server Error\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;Error processing the request!\u0026#34;, \u0026#34;path\u0026#34;: \u0026#34;/my-endpoint-with-exceptions\u0026#34; } ä¸å¾€å¸¸ä¸€æ ·ï¼ŒSpring Boot å…è®¸ä½¿ç”¨å±æ€§é…ç½®è¿™äº›åŠŸèƒ½ï¼š\nserver.error.whitelabel.enabled: å¯ç”¨äºç¦ç”¨ Whitelabel é”™è¯¯é¡µé¢å¹¶ä¾èµ– servlet å®¹å™¨æä¾› HTML é”™è¯¯æ¶ˆæ¯ server.error.include-stacktrace: å…·æœ‰å§‹ç»ˆå€¼ï¼›åœ¨ HTML å’Œ JSON é»˜è®¤å“åº”ä¸­åŒ…å«å †æ ˆè·Ÿè¸ª server.error.include-message: ä» 2.3 ç‰ˆæœ¬å¼€å§‹ï¼ŒSpring Boot éšè—äº†å“åº”ä¸­çš„ message å­—æ®µï¼Œä»¥é¿å…æ³„éœ²æ•æ„Ÿä¿¡æ¯ï¼›æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¸¦æœ‰ always å€¼çš„è¿™ä¸ªå±æ€§æ¥å¯ç”¨å®ƒ é™¤äº†è¿™äº›å±æ€§ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä¸º /error æä¾›æˆ‘ä»¬è‡ªå·±çš„è§†å›¾è§£æå™¨æ˜ å°„ï¼Œè¦†ç›–ç™½æ ‡ç­¾é¡µé¢ã€‚\næˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡åœ¨ä¸Šä¸‹æ–‡ä¸­åŒ…å« ErrorAttributes bean æ¥è‡ªå®šä¹‰è¦åœ¨å“åº”ä¸­æ˜¾ç¤ºçš„å±æ€§ã€‚æˆ‘ä»¬å¯ä»¥æ‰©å±• Spring Boot æä¾›çš„ DefaultErrorAttributes ç±»æ¥ä½¿äº‹æƒ…å˜å¾—æ›´ç®€å•ï¼š\n@Component public class MyCustomErrorAttributes extends DefaultErrorAttributes { @Override public Map\u0026lt;String, Object\u0026gt; getErrorAttributes( WebRequest webRequest, ErrorAttributeOptions options) { Map\u0026lt;String, Object\u0026gt; errorAttributes = super.getErrorAttributes(webRequest, options); errorAttributes.put(\u0026#34;locale\u0026#34;, webRequest.getLocale() .toString()); errorAttributes.remove(\u0026#34;error\u0026#34;); //... return errorAttributes; } } å¦‚æœæˆ‘ä»¬æƒ³è¿›ä¸€æ­¥å®šä¹‰ï¼ˆæˆ–è¦†ç›–ï¼‰åº”ç”¨ç¨‹åºå¦‚ä½•å¤„ç†ç‰¹å®šå†…å®¹ç±»å‹çš„é”™è¯¯ï¼Œæˆ‘ä»¬å¯ä»¥æ³¨å†Œä¸€ä¸ª ErrorController beanã€‚\nåŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Spring Boot æä¾›çš„é»˜è®¤ BasicErrorController æ¥å¸®åŠ©æˆ‘ä»¬ã€‚\nä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æƒ³è¦è‡ªå®šä¹‰åº”ç”¨ç¨‹åºå¦‚ä½•å¤„ç† XML ç«¯ç‚¹ä¸­è§¦å‘çš„é”™è¯¯ã€‚æˆ‘ä»¬æ‰€è¦åšçš„å°±æ˜¯ä½¿ç”¨ @RequestMapping å®šä¹‰ä¸€ä¸ªå…¬å…±æ–¹æ³•ï¼Œå¹¶å£°æ˜å®ƒç”Ÿæˆ application/xml åª’ä½“ç±»å‹ï¼š\n@Component public class MyErrorController extends BasicErrorController { public MyErrorController( ErrorAttributes errorAttributes, ServerProperties serverProperties) { super(errorAttributes, serverProperties.getError()); } @RequestMapping(produces = MediaType.APPLICATION_XML_VALUE) public ResponseEntity\u0026lt;Map\u0026lt;String, Object\u0026gt;\u0026gt; xmlError(HttpServletRequest request) { // ... } } æ³¨æ„ï¼šè¿™é‡Œæˆ‘ä»¬ä»ç„¶ä¾èµ–äºæˆ‘ä»¬é¡¹ç›®ä¸­å¯èƒ½å®šä¹‰çš„ server.error.* å¼•å¯¼å±æ€§ï¼Œè¿™äº›å±æ€§ç»‘å®šåˆ° ServerProperties beanã€‚\n8. ç»“è®º æœ¬æ–‡è®¨è®ºäº†åœ¨ Spring ä¸­å®ç° REST API å¼‚å¸¸å¤„ç†æœºåˆ¶çš„å‡ ç§æ–¹æ³•ï¼Œä»æ—§çš„æœºåˆ¶å¼€å§‹ï¼Œç»§ç»­æä¾› Spring 3.2 æ”¯æŒï¼Œä¸€ç›´åˆ° 4.x å’Œ 5.xã€‚\nä¸å¾€å¸¸ä¸€æ ·ï¼Œæœ¬æ–‡ä¸­æä¾›çš„ä»£ç å¯ä»¥åœ¨ GitHub ä¸Šè·å–ã€‚\nSpring Security ç›¸å…³çš„ä»£ç å¯ä»¥æŸ¥çœ‹ spring-security-rest æ¨¡å—ã€‚\nåŸæ–‡é“¾æ¥ï¼šhttps://www.baeldung.com/exception-handling-for-rest-with-spring\n","permalink":"https://blog.chensoul.cc/posts/2023/08/25/exception-handling-for-rest-with-spring/","summary":"1. æ¦‚è¿° æœ¬æ•™ç¨‹å°†è¯´æ˜å¦‚ä½•ä½¿ç”¨ Spring ä¸º REST API å®ç°å¼‚å¸¸å¤„ç†ã€‚æˆ‘ä»¬è¿˜å°†è·å¾—ä¸€äº›å†å²æ¦‚è¿°ï¼Œå¹¶äº†è§£ä¸åŒç‰ˆæœ¬å¼•å…¥äº†å“ªäº›æ–°é€‰é¡¹ã€‚\nåœ¨ Spring 3.2 ä¹‹å‰ï¼ŒSpring MVC åº”ç”¨ç¨‹åºä¸­å¤„ç†å¼‚å¸¸çš„ä¸¤ç§ä¸»è¦æ–¹æ³•æ˜¯ HandlerExceptionResolver æˆ– @ExceptionHandler æ³¨è§£ã€‚ä¸¤è€…éƒ½æœ‰ä¸€äº›æ˜æ˜¾çš„ç¼ºç‚¹ã€‚\nä» 3.2 å¼€å§‹ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† @ControllerAdvice æ³¨é‡Šæ¥è§£å†³å‰ä¸¤ä¸ªè§£å†³æ–¹æ¡ˆçš„å±€é™æ€§ï¼Œå¹¶ä¿ƒè¿›æ•´ä¸ªåº”ç”¨ç¨‹åºçš„ç»Ÿä¸€å¼‚å¸¸å¤„ç†ã€‚\nç°åœ¨ Spring 5 å¼•å…¥äº† ResponseStatusException ç±»ï¼Œä¸€ç§åœ¨ REST API ä¸­è¿›è¡ŒåŸºæœ¬é”™è¯¯å¤„ç†çš„å¿«é€Ÿæ–¹æ³•ã€‚\næ‰€æœ‰è¿™äº›éƒ½æœ‰ä¸€ä¸ªå…±åŒç‚¹ï¼šå®ƒä»¬å¾ˆå¥½åœ°å¤„ç†äº†å…³æ³¨ç‚¹åˆ†ç¦»ã€‚åº”ç”¨ç¨‹åºå¯ä»¥æ­£å¸¸æŠ›å‡ºå¼‚å¸¸æ¥æŒ‡ç¤ºæŸç§å¤±è´¥ï¼Œç„¶åå°†å•ç‹¬å¤„ç†ã€‚\næœ€åï¼Œæˆ‘ä»¬å°†äº†è§£ Spring Boot å¸¦æ¥çš„åŠŸèƒ½ä»¥åŠå¦‚ä½•é…ç½®å®ƒä»¥æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚\n2.æ–¹æ¡ˆä¸€ï¼šæ§åˆ¶å™¨çº§@ExceptionHandler ç¬¬ä¸€ä¸ªè§£å†³æ–¹æ¡ˆåœ¨ @Controller çº§åˆ«å·¥ä½œã€‚æˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ªå¤„ç†å¼‚å¸¸çš„æ–¹æ³•å¹¶ä½¿ç”¨@ExceptionHandler è¿›è¡Œæ³¨é‡Šï¼š\npublic class FooController{ //... @ExceptionHandler({ CustomException1.class, CustomException2.class }) public void handleException() { // } } è¿™ç§æ–¹æ³•æœ‰ä¸€ä¸ªä¸»è¦ç¼ºç‚¹ï¼šÂ· æ³¨è§£çš„æ–¹æ³•ä»…å¯¹ç‰¹å®šçš„æ§åˆ¶å™¨æœ‰æ•ˆï¼Œè€Œä¸æ˜¯å¯¹æ•´ä¸ªåº”ç”¨ç¨‹åºå…¨å±€æœ‰æ•ˆã€‚å½“ç„¶ï¼Œå°†å…¶æ·»åŠ åˆ°æ¯ä¸ªæ§åˆ¶å™¨ä½¿å…¶ä¸å¤ªé€‚åˆé€šç”¨å¼‚å¸¸å¤„ç†æœºåˆ¶ã€‚\næˆ‘ä»¬å¯ä»¥é€šè¿‡è®©æ‰€æœ‰æ§åˆ¶å™¨æ‰©å±•åŸºæœ¬æ§åˆ¶å™¨ç±»æ¥è§£å†³æ­¤é™åˆ¶ã€‚\nç„¶è€Œï¼Œå¯¹äºæ— è®ºå‡ºäºä½•ç§åŸå› è¿™æ˜¯ä¸å¯èƒ½çš„åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œæ­¤è§£å†³æ–¹æ¡ˆå¯èƒ½æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚ä¾‹å¦‚ï¼Œæ§åˆ¶å™¨å¯èƒ½å·²ç»ä»å¦ä¸€ä¸ªåŸºç±»æ‰©å±•ï¼Œè¯¥åŸºç±»å¯èƒ½ä½äºå¦ä¸€ä¸ª jar ä¸­æˆ–ä¸å¯ç›´æ¥ä¿®æ”¹ï¼Œæˆ–è€…æœ¬èº«å¯èƒ½ä¸å¯ç›´æ¥ä¿®æ”¹ã€‚\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ç ”ç©¶å¦ä¸€ç§è§£å†³å¼‚å¸¸å¤„ç†é—®é¢˜çš„æ–¹æ³• - ä¸€ç§å…¨å±€çš„æ–¹æ³•ï¼Œä¸åŒ…æ‹¬å¯¹ç°æœ‰å·¥ä»¶ï¼ˆä¾‹å¦‚æ§åˆ¶å™¨ï¼‰çš„ä»»ä½•æ›´æ”¹ã€‚\n3.è§£å†³æ–¹æ¡ˆ 2ï¼šHandlerExceptionResolver ç¬¬äºŒç§è§£å†³æ–¹æ¡ˆæ˜¯å®šä¹‰ä¸€ä¸ª HandlerExceptionResolverã€‚è¿™å°†è§£å†³åº”ç”¨ç¨‹åºæŠ›å‡ºçš„ä»»ä½•å¼‚å¸¸ã€‚å®ƒè¿˜å…è®¸æˆ‘ä»¬åœ¨ REST API ä¸­å®ç°ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ã€‚\nåœ¨é€‰æ‹©è‡ªå®šä¹‰è§£æå™¨ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹ç°æœ‰çš„å®ç°ã€‚\n3.1.å¼‚å¸¸å¤„ç†å™¨å¼‚å¸¸è§£æå™¨ è¯¥è§£æå™¨æ˜¯åœ¨ Spring 3.1 ä¸­å¼•å…¥çš„ï¼Œå¹¶ä¸”åœ¨ DispatcherServlet ä¸­é»˜è®¤å¯ç”¨ã€‚è¿™å®é™…ä¸Šæ˜¯å‰é¢ä»‹ç»çš„ @ExceptionHandler æœºåˆ¶å¦‚ä½•å·¥ä½œçš„æ ¸å¿ƒç»„ä»¶ã€‚\n3.2.é»˜è®¤å¤„ç†ç¨‹åºå¼‚å¸¸è§£æå™¨ è¿™ä¸ªè§£æå™¨æ˜¯åœ¨ Spring 3.0 ä¸­å¼•å…¥çš„ï¼Œå¹¶ä¸”åœ¨ DispatcherServlet ä¸­é»˜è®¤å¯ç”¨ã€‚\nå®ƒç”¨äºå°†æ ‡å‡† Spring å¼‚å¸¸è§£æä¸ºå…¶ç›¸åº”çš„ HTTP çŠ¶æ€ä»£ç ï¼Œå³å®¢æˆ·ç«¯é”™è¯¯ 4xx å’ŒæœåŠ¡å™¨é”™è¯¯ 5xx çŠ¶æ€ä»£ç ã€‚ä»¥ä¸‹æ˜¯å®ƒå¤„ç†çš„ Spring å¼‚å¸¸çš„å®Œæ•´åˆ—è¡¨ä»¥åŠå®ƒä»¬å¦‚ä½•æ˜ å°„åˆ°çŠ¶æ€ä»£ç ã€‚","title":"[è¯‘]ä½¿ç”¨Springè¿›è¡ŒRESTçš„é”™è¯¯å¤„ç†"},{"content":"1. ç®€ä»‹ åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨ä½¿ç”¨ @Async ä¼ æ’­ Spring Security ä¸»ä½“ é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Security èº«ä»½éªŒè¯ç»‘å®šåˆ° ThreadLocal - å› æ­¤ï¼Œå½“æ‰§è¡Œæµåœ¨å¸¦æœ‰ @Async çš„æ–°çº¿ç¨‹ä¸­è¿è¡Œæ—¶ï¼Œå®ƒä¸ä¼šæ˜¯ç»è¿‡èº«ä»½éªŒè¯çš„ä¸Šä¸‹æ–‡ã€‚\nè¿™å¹¶ä¸ç†æƒ³â€”â€”è®©æˆ‘ä»¬è§£å†³å®ƒã€‚\n2.Maven ä¾èµ– ä¸ºäº†åœ¨ Spring Security ä¸­ä½¿ç”¨å¼‚æ­¥é›†æˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨ pom.xml çš„ä¾èµ–é¡¹ä¸­åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.security\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-security-config\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.7.3\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; å¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ°æœ€æ–°ç‰ˆæœ¬çš„ Spring Security ä¾èµ–é¡¹ã€‚\n3.ä½¿ç”¨@Async è¿›è¡Œ Spring Security ä¼ æ’­ æˆ‘ä»¬å…ˆå†™ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š\n@RequestMapping(method = RequestMethod.GET, value = \u0026#34;/async\u0026#34;) @ResponseBody public Object standardProcessing() throws Exception { log.info(\u0026#34;Outside the @Async logic - before the async call: \u0026#34; + SecurityContextHolder.getContext().getAuthentication().getPrincipal()); asyncService.asyncCall(); log.info(\u0026#34;Inside the @Async logic - after the async call: \u0026#34; + SecurityContextHolder.getContext().getAuthentication().getPrincipal()); return SecurityContextHolder.getContext().getAuthentication().getPrincipal(); } æˆ‘ä»¬æƒ³è¦æ£€æŸ¥ Spring SecurityContext æ˜¯å¦ä¼ æ’­åˆ°æ–°çº¿ç¨‹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨å¼‚æ­¥è°ƒç”¨ä¹‹å‰è®°å½•ä¸Šä¸‹æ–‡ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¿è¡Œå¼‚æ­¥æ–¹æ³•ï¼Œæœ€åå†æ¬¡è®°å½•ä¸Šä¸‹æ–‡ã€‚ asyncCall() æ–¹æ³•å…·æœ‰ä»¥ä¸‹å®ç°ï¼š\n@Async @Override public void asyncCall() { log.info(\u0026#34;Inside the @Async logic: \u0026#34; + SecurityContextHolder.getContext().getAuthentication().getPrincipal()); } æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œåªæœ‰ä¸€è¡Œä»£ç å°†è¾“å‡ºå¼‚æ­¥æ–¹æ³•çš„æ–°çº¿ç¨‹å†…çš„ä¸Šä¸‹æ–‡ã€‚\n4. é»˜è®¤é…ç½® é»˜è®¤æƒ…å†µä¸‹ï¼Œ@Async æ–¹æ³•å†…çš„å®‰å…¨ä¸Šä¸‹æ–‡å°†å…·æœ‰ç©ºå€¼ã€‚\nç‰¹åˆ«æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è¿è¡Œå¼‚æ­¥é€»è¾‘ï¼Œæˆ‘ä»¬å°†èƒ½å¤Ÿåœ¨ä¸»ç¨‹åºä¸­è®°å½• Authentication å¯¹è±¡ï¼Œä½†æ˜¯å½“æˆ‘ä»¬å°†å…¶è®°å½•åœ¨ @Async ä¸­æ—¶ï¼Œå®ƒå°†ä¸º nullã€‚è¿™æ˜¯æ—¥å¿—è¾“å‡ºçš„ç¤ºä¾‹ï¼š\nweb - 2016-12-30 22:41:58,916 [http-nio-8081-exec-3] INFO o.baeldung.web.service.AsyncService - Outside the @Async logic - before the async call: org.springframework.security.core.userdetails.User@76507e51: Username: temporary; ... web - 2016-12-30 22:41:58,921 [http-nio-8081-exec-3] INFO o.baeldung.web.service.AsyncService - Inside the @Async logic - after the async call: org.springframework.security.core.userdetails.User@76507e51: Username: temporary; ... web - 2016-12-30 22:41:58,926 [SimpleAsyncTaskExecutor-1] ERROR o.s.a.i.SimpleAsyncUncaughtExceptionHandler - Unexpected error occurred invoking async method \u0026#39;public void com.baeldung.web.service.AsyncServiceImpl.asyncCall()\u0026#39;. java.lang.NullPointerException: null å› æ­¤ï¼Œæ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œåœ¨æ‰§è¡Œç¨‹åºçº¿ç¨‹å†…ï¼Œæˆ‘ä»¬çš„è°ƒç”¨å¤±è´¥å¹¶å‡ºç° NPEï¼Œæ­£å¦‚é¢„æœŸçš„é‚£æ ·â€”â€”å› ä¸ºä¸»ä½“åœ¨é‚£é‡Œä¸å¯ç”¨ã€‚\n5. å¼‚æ­¥å®‰å…¨ä¸Šä¸‹æ–‡é…ç½® å¦‚æœæˆ‘ä»¬æƒ³è¦è®¿é—®å¼‚æ­¥çº¿ç¨‹å†…éƒ¨çš„ä¸»ä½“ï¼Œå°±åƒæˆ‘ä»¬å¯ä»¥åœ¨å¤–éƒ¨è®¿é—®å®ƒä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»º DelegatingSecurityContextAsyncTaskExecutor beanï¼š\n@Bean public DelegatingSecurityContextAsyncTaskExecutor taskExecutor(ThreadPoolTaskExecutor delegate) { return new DelegatingSecurityContextAsyncTaskExecutor(delegate); } é€šè¿‡è¿™æ ·åšï¼ŒSpring å°†åœ¨æ¯ä¸ª @Async è°ƒç”¨ä¸­ä½¿ç”¨å½“å‰çš„ SecurityContextã€‚\nç°åœ¨ï¼Œè®©æˆ‘ä»¬å†æ¬¡è¿è¡Œè¯¥åº”ç”¨ç¨‹åºå¹¶æŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ä»¥ç¡®ä¿æƒ…å†µç¡®å®å¦‚æ­¤ï¼š\nweb - 2016-12-30 22:45:18,013 [http-nio-8081-exec-3] INFO o.baeldung.web.service.AsyncService - Outside the @Async logic - before the async call: org.springframework.security.core.userdetails.User@76507e51: Username: temporary; ... web - 2016-12-30 22:45:18,018 [http-nio-8081-exec-3] INFO o.baeldung.web.service.AsyncService - Inside the @Async logic - after the async call: org.springframework.security.core.userdetails.User@76507e51: Username: temporary; ... web - 2016-12-30 22:45:18,019 [SimpleAsyncTaskExecutor-1] INFO o.baeldung.web.service.AsyncService - Inside the @Async logic: org.springframework.security.core.userdetails.User@76507e51: Username: temporary; ... æ­£å¦‚æˆ‘ä»¬æ‰€æœŸæœ›çš„ï¼Œæˆ‘ä»¬åœ¨å¼‚æ­¥æ‰§è¡Œå™¨çº¿ç¨‹ä¸­çœ‹åˆ°äº†ç›¸åŒçš„åŸç†ã€‚\n6. ä½¿ç”¨æ¡ˆä¾‹ æœ‰ä¸€äº›æœ‰è¶£çš„ç”¨ä¾‹ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›ç¡®ä¿ SecurityContext åƒè¿™æ ·ä¼ æ’­ï¼š\næˆ‘ä»¬æƒ³è¦å‘å‡ºå¤šä¸ªå¯ä»¥å¹¶è¡Œè¿è¡Œå¹¶ä¸”å¯èƒ½éœ€è¦å¤§é‡æ—¶é—´æ¥æ‰§è¡Œçš„å¤–éƒ¨è¯·æ±‚ æˆ‘ä»¬éœ€è¦åœ¨æœ¬åœ°è¿›è¡Œä¸€äº›é‡è¦çš„å¤„ç†ï¼Œå¹¶ä¸”æˆ‘ä»¬çš„å¤–éƒ¨è¯·æ±‚å¯ä»¥ä¸è¯¥å¤„ç†å¹¶è¡Œæ‰§è¡Œ å…¶ä»–ä»£è¡¨å³å‘å³å¿˜åœºæ™¯ï¼Œä¾‹å¦‚å‘é€ç”µå­é‚®ä»¶ 7.ç»“è®º åœ¨æœ¬å¿«é€Ÿæ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† Spring å¯¹ä½¿ç”¨ä¼ æ’­çš„ SecurityContext å‘é€å¼‚æ­¥è¯·æ±‚çš„æ”¯æŒã€‚ä»ç¼–ç¨‹æ¨¡å‹çš„è§’åº¦æ¥çœ‹ï¼Œæ–°åŠŸèƒ½çœ‹ä¼¼ç®€å•ã€‚\nè¯·æ³¨æ„ï¼Œå¦‚æœå…ˆå‰ä»¥åŒæ­¥æ–¹å¼å°†å¤šä¸ªæ–¹æ³•è°ƒç”¨é“¾æ¥åœ¨ä¸€èµ·ï¼Œåˆ™è½¬æ¢ä¸ºå¼‚æ­¥æ–¹æ³•å¯èƒ½éœ€è¦åŒæ­¥ç»“æœã€‚\næ­¤ ç¤ºä¾‹ ä¹Ÿå¯ä½œä¸º Github ä¸Šçš„ Maven é¡¹ç›®æä¾›ã€‚\nåŸæ–‡é“¾æ¥ï¼šhttps://www.baeldung.com/spring-security-async-principal-propagation\n","permalink":"https://blog.chensoul.cc/posts/2023/08/25/spring-security-async-principal-propagation/","summary":"1. ç®€ä»‹ åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨ä½¿ç”¨ @Async ä¼ æ’­ Spring Security ä¸»ä½“ é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring Security èº«ä»½éªŒè¯ç»‘å®šåˆ° ThreadLocal - å› æ­¤ï¼Œå½“æ‰§è¡Œæµåœ¨å¸¦æœ‰ @Async çš„æ–°çº¿ç¨‹ä¸­è¿è¡Œæ—¶ï¼Œå®ƒä¸ä¼šæ˜¯ç»è¿‡èº«ä»½éªŒè¯çš„ä¸Šä¸‹æ–‡ã€‚\nè¿™å¹¶ä¸ç†æƒ³â€”â€”è®©æˆ‘ä»¬è§£å†³å®ƒã€‚\n2.Maven ä¾èµ– ä¸ºäº†åœ¨ Spring Security ä¸­ä½¿ç”¨å¼‚æ­¥é›†æˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨ pom.xml çš„ä¾èµ–é¡¹ä¸­åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.security\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-security-config\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.7.3\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; å¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ°æœ€æ–°ç‰ˆæœ¬çš„ Spring Security ä¾èµ–é¡¹ã€‚\n3.ä½¿ç”¨@Async è¿›è¡Œ Spring Security ä¼ æ’­ æˆ‘ä»¬å…ˆå†™ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š\n@RequestMapping(method = RequestMethod.GET, value = \u0026#34;/async\u0026#34;) @ResponseBody public Object standardProcessing() throws Exception { log.info(\u0026#34;Outside the @Async logic - before the async call: \u0026#34; + SecurityContextHolder.getContext().getAuthentication().getPrincipal()); asyncService.asyncCall(); log.info(\u0026#34;Inside the @Async logic - after the async call: \u0026#34; + SecurityContextHolder.getContext().getAuthentication().getPrincipal()); return SecurityContextHolder.getContext().getAuthentication().getPrincipal(); } æˆ‘ä»¬æƒ³è¦æ£€æŸ¥ Spring SecurityContext æ˜¯å¦ä¼ æ’­åˆ°æ–°çº¿ç¨‹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨å¼‚æ­¥è°ƒç”¨ä¹‹å‰è®°å½•ä¸Šä¸‹æ–‡ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¿è¡Œå¼‚æ­¥æ–¹æ³•ï¼Œæœ€åå†æ¬¡è®°å½•ä¸Šä¸‹æ–‡ã€‚ asyncCall() æ–¹æ³•å…·æœ‰ä»¥ä¸‹å®ç°ï¼š\n@Async @Override public void asyncCall() { log.info(\u0026#34;Inside the @Async logic: \u0026#34; + SecurityContextHolder.getContext().getAuthentication().getPrincipal()); } æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œåªæœ‰ä¸€è¡Œä»£ç å°†è¾“å‡ºå¼‚æ­¥æ–¹æ³•çš„æ–°çº¿ç¨‹å†…çš„ä¸Šä¸‹æ–‡ã€‚","title":"[è¯‘]ä½¿ç”¨@Asyncè¿›è¡ŒSpring Securityä¸Šä¸‹æ–‡ä¼ æ’­"},{"content":"1. æ¦‚è¿° åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•åœ¨ Spring ä¸­ä½¿ç”¨äº‹ä»¶ã€‚\näº‹ä»¶æ˜¯æ¡†æ¶ä¸­æœ€å®¹æ˜“è¢«å¿½è§†çš„åŠŸèƒ½ä¹‹ä¸€ï¼Œä½†ä¹Ÿæ˜¯æœ€æœ‰ç”¨çš„åŠŸèƒ½ä¹‹ä¸€ã€‚ä¸ Spring ä¸­çš„è®¸å¤šå…¶ä»–åŠŸèƒ½ä¸€æ ·ï¼Œäº‹ä»¶å‘å¸ƒæ˜¯ ApplicationContext æä¾›çš„åŠŸèƒ½ä¹‹ä¸€ã€‚\næœ‰ä¸€äº›ç®€å•çš„å‡†åˆ™éœ€è¦éµå¾ªï¼š\nå¦‚æœæˆ‘ä»¬ä½¿ç”¨ Spring Framework 4.2 ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œäº‹ä»¶ç±»åº”è¯¥æ‰©å±• ApplicationEventã€‚ä» 4.2 ç‰ˆæœ¬å¼€å§‹ï¼Œäº‹ä»¶ç±»ä¸å†éœ€è¦æ‰©å±• ApplicationEvent ç±»ã€‚ å‘å¸ƒè€…åº”è¯¥æ³¨å…¥ä¸€ä¸ª ApplicationEventPublisher å¯¹è±¡ã€‚ ç›‘å¬å™¨åº”è¯¥å®ç° ApplicationListener æ¥å£ã€‚ 2. è‡ªå®šä¹‰äº‹ä»¶ Spring å…è®¸æˆ‘ä»¬åˆ›å»ºå’Œå‘å¸ƒé»˜è®¤æƒ…å†µä¸‹åŒæ­¥çš„è‡ªå®šä¹‰äº‹ä»¶ã€‚è¿™æœ‰ä¸€äº›ä¼˜ç‚¹ï¼Œä¾‹å¦‚ä¾¦å¬å™¨èƒ½å¤Ÿå‚ä¸å‘å¸ƒè€…çš„äº‹åŠ¡ä¸Šä¸‹æ–‡ã€‚\n2.1.ä¸€ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºäº‹ä»¶ è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„äº‹ä»¶ç±»â€”â€”åªæ˜¯ä¸€ä¸ªå­˜å‚¨äº‹ä»¶æ•°æ®çš„å ä½ç¬¦ã€‚\nåœ¨æœ¬ä¾‹ä¸­ï¼Œäº‹ä»¶ç±»ä¿å­˜ä¸€æ¡å­—ç¬¦ä¸²æ¶ˆæ¯ï¼š\npublic class CustomSpringEvent extends ApplicationEvent { private String message; public CustomSpringEvent(Object source, String message) { super(source); this.message = message; } public String getMessage() { return message; } } 2.2.å‘å¸ƒè€… ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºè¯¥äº‹ä»¶çš„å‘å¸ƒè€…ã€‚å‘å¸ƒè€…æ„é€ äº‹ä»¶å¯¹è±¡å¹¶å°†å…¶å‘å¸ƒç»™æ­£åœ¨ä¾¦å¬çš„ä»»ä½•äººã€‚\nè¦å‘å¸ƒäº‹ä»¶ï¼Œå‘å¸ƒè€…åªéœ€æ³¨å…¥ ApplicationEventPublisher å¹¶ä½¿ç”¨ publishEvent() APIï¼š\n@Component public class CustomSpringEventPublisher { @Autowired private ApplicationEventPublisher applicationEventPublisher; public void publishCustomEvent(final String message) { System.out.println(\u0026#34;Publishing custom event. \u0026#34;); CustomSpringEvent customSpringEvent = new CustomSpringEvent(this, message); applicationEventPublisher.publishEvent(customSpringEvent); } } æˆ–è€…ï¼Œå‘å¸ƒè€…ç±»å¯ä»¥å®ç° ApplicationEventPublisherAware æ¥å£ï¼Œè¿™ä¹Ÿå°†åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶æ³¨å…¥äº‹ä»¶å‘å¸ƒè€…ã€‚é€šå¸¸ï¼Œä½¿ç”¨ @Autowire æ³¨å…¥å‘å¸ƒè€…ä¼šæ›´ç®€å•ã€‚\nä» Spring Framework 4.2 å¼€å§‹ï¼ŒApplicationEventPublisher æ¥å£ä¸ºpublishEvent(Object event) æ–¹æ³•æä¾›äº†æ–°çš„é‡è½½ï¼Œè¯¥æ–¹æ³•æ¥å—ä»»ä½•å¯¹è±¡ä½œä¸ºäº‹ä»¶ã€‚å› æ­¤ï¼ŒSpring äº‹ä»¶ä¸å†éœ€è¦æ‰©å±•ApplicationEvent ç±»ã€‚\n2.3.ç›‘å¬è€… æœ€åï¼Œè®©æˆ‘ä»¬åˆ›å»ºç›‘å¬å™¨ã€‚\nç›‘å¬å™¨çš„å”¯ä¸€è¦æ±‚æ˜¯æ˜¯ä¸€ä¸ª bean å¹¶å®ç° ApplicationListener æ¥å£ï¼š\n@Component public class CustomSpringEventListener implements ApplicationListener\u0026lt;CustomSpringEvent\u0026gt; { @Override public void onApplicationEvent(CustomSpringEvent event) { System.out.println(\u0026#34;Received spring custom event - \u0026#34; + event.getMessage()); } } è¯·æ³¨æ„æˆ‘ä»¬çš„è‡ªå®šä¹‰ä¾¦å¬å™¨å¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰äº‹ä»¶çš„é€šç”¨ç±»å‹è¿›è¡Œå‚æ•°åŒ–ï¼Œè¿™ä½¿å¾— onApplicationEvent() æ–¹æ³•ç±»å‹å®‰å…¨ã€‚è¿™ä¹Ÿé¿å…äº†å¿…é¡»æ£€æŸ¥å¯¹è±¡æ˜¯å¦æ˜¯ç‰¹å®šäº‹ä»¶ç±»çš„å®ä¾‹å¹¶è½¬æ¢å®ƒã€‚\nè€Œä¸”ï¼Œæ­£å¦‚å·²ç»è®¨è®ºè¿‡çš„ï¼ˆé»˜è®¤æƒ…å†µä¸‹ Spring äº‹ä»¶æ˜¯åŒæ­¥çš„ï¼‰ï¼Œ doStuffAndPublishAnEvent() æ–¹æ³•ä¼šé˜»å¡ï¼Œç›´åˆ°æ‰€æœ‰ä¾¦å¬å™¨å®Œæˆå¯¹äº‹ä»¶çš„å¤„ç†ã€‚\n3. åˆ›å»ºå¼‚æ­¥äº‹ä»¶ åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒåŒæ­¥å‘å¸ƒäº‹ä»¶å¹¶ä¸æ˜¯æˆ‘ä»¬çœŸæ­£æƒ³è¦çš„â€”â€”æˆ‘ä»¬å¯èƒ½éœ€è¦å¼‚æ­¥å¤„ç†äº‹ä»¶ã€‚\næˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»ºå¸¦æœ‰æ‰§è¡Œå™¨çš„ ApplicationEventMulticaster bean åœ¨é…ç½®ä¸­æ‰“å¼€å®ƒã€‚\nå‡ºäºæˆ‘ä»¬çš„ç›®çš„ï¼ŒSimpleAsyncTaskExecutor æ•ˆæœå¾ˆå¥½ï¼š\n@Configuration public class AsynchronousSpringEventsConfig { @Bean(name = \u0026#34;applicationEventMulticaster\u0026#34;) public ApplicationEventMulticaster simpleApplicationEventMulticaster() { SimpleApplicationEventMulticaster eventMulticaster = new SimpleApplicationEventMulticaster(); eventMulticaster.setTaskExecutor(new SimpleAsyncTaskExecutor()); return eventMulticaster; } } äº‹ä»¶ã€å‘å¸ƒè€…å’Œä¾¦å¬å™¨å®ç°ä¸ä»¥å‰ç›¸åŒï¼Œä½†ç°åœ¨ä¾¦å¬å™¨å°†åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­å¼‚æ­¥å¤„ç†äº‹ä»¶ã€‚\n4.ç°æœ‰æ¡†æ¶äº‹ä»¶ Spring æœ¬èº«å‘å¸ƒäº†å„ç§å¼€ç®±å³ç”¨çš„äº‹ä»¶ã€‚ä¾‹å¦‚ï¼ŒApplicationContext å°†è§¦å‘å„ç§æ¡†æ¶äº‹ä»¶ï¼šContextRefreshedEventã€ContextStartedEventã€RequestHandledEvent ç­‰ã€‚\nè¿™äº›äº‹ä»¶ä¸ºåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜æä¾›äº†ä¸€ä¸ªé€‰é¡¹ï¼Œå¯ä»¥æŒ‚é’©åº”ç”¨ç¨‹åºå’Œä¸Šä¸‹æ–‡çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶åœ¨éœ€è¦æ—¶æ·»åŠ è‡ªå·±çš„è‡ªå®šä¹‰é€»è¾‘ã€‚\nä¸‹é¢æ˜¯ä¾¦å¬å™¨ä¾¦å¬ä¸Šä¸‹æ–‡åˆ·æ–°çš„ç®€å•ç¤ºä¾‹ï¼š\npublic class ContextRefreshedListener implements ApplicationListener\u0026lt;ContextRefreshedEvent\u0026gt; { @Override public void onApplicationEvent(ContextRefreshedEvent cse) { System.out.println(\u0026#34;Handling context re-freshed event. \u0026#34;); } } 5. æ³¨è§£é©±åŠ¨çš„äº‹ä»¶ç›‘å¬å™¨ ä» Spring 4.2 å¼€å§‹ï¼Œäº‹ä»¶ä¾¦å¬å™¨ä¸éœ€è¦æ˜¯å®ç° ApplicationListener æ¥å£çš„ bean â€” å®ƒå¯ä»¥é€šè¿‡ @EventListener æ³¨é‡Šåœ¨æ‰˜ç®¡ bean çš„ä»»ä½•å…¬å…±æ–¹æ³•ä¸Šæ³¨å†Œï¼š\n@Component public class AnnotationDrivenEventListener { @EventListener public void handleContextStart(ContextStartedEvent cse) { System.out.println(\u0026#34;Handling context started event.\u0026#34;); } } å’Œä»¥å‰ä¸€æ ·ï¼Œæ–¹æ³•ç­¾åå£°æ˜å®ƒæ¶ˆè€—çš„äº‹ä»¶ç±»å‹ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œç›‘å¬å™¨æ˜¯åŒæ­¥è°ƒç”¨çš„ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ  @Async æ³¨è§£è½»æ¾ä½¿å…¶å¼‚æ­¥ã€‚æˆ‘ä»¬åªéœ€è¦è®°ä½åœ¨åº”ç”¨ç¨‹åºä¸­å¯ç”¨å¼‚æ­¥æ”¯æŒå³å¯ã€‚\n6. æ³›å‹æ”¯æŒ è¿˜å¯ä»¥ä½¿ç”¨äº‹ä»¶ç±»å‹ä¸­çš„æ³›å‹ä¿¡æ¯æ¥è°ƒåº¦äº‹ä»¶ã€‚\n6.1.é€šç”¨åº”ç”¨ç¨‹åºäº‹ä»¶ è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé€šç”¨äº‹ä»¶ç±»å‹ã€‚\nåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œäº‹ä»¶ç±»åŒ…å«ä»»ä½•å†…å®¹å’ŒæˆåŠŸçŠ¶æ€æŒ‡ç¤ºå™¨ï¼š\npublic class GenericSpringEvent\u0026lt;T\u0026gt; { private T what; protected boolean success; public GenericSpringEvent(T what, boolean success) { this.what = what; this.success = success; } // ... standard getters } è¯·æ³¨æ„ GenericSpringEvent å’Œ CustomSpringEvent ä¹‹é—´çš„åŒºåˆ«ã€‚æˆ‘ä»¬ç°åœ¨å¯ä»¥çµæ´»åœ°å‘å¸ƒä»»ä½•ä»»æ„äº‹ä»¶ï¼Œå¹¶ä¸”ä¸å†éœ€è¦ä» ApplicationEvent è¿›è¡Œæ‰©å±•ã€‚\n6.2.ç›‘å¬è€… ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºè¯¥äº‹ä»¶çš„ä¾¦å¬å™¨ã€‚\næˆ‘ä»¬å¯ä»¥åƒä»¥å‰ä¸€æ ·é€šè¿‡å®ç° ApplicationListener æ¥å£æ¥å®šä¹‰ç›‘å¬å™¨ï¼š\n@Component public class GenericSpringEventListener implements ApplicationListener\u0026lt;GenericSpringEvent\u0026lt;String\u0026gt;\u0026gt; { @Override public void onApplicationEvent(@NonNull GenericSpringEvent\u0026lt;String\u0026gt; event) { System.out.println(\u0026#34;Received spring generic event - \u0026#34; + event.getWhat()); } } ä½†ä¸å¹¸çš„æ˜¯è¿™ä¸ªå®šä¹‰è¦æ±‚æˆ‘ä»¬ä» ApplicationEvent ç±»ç»§æ‰¿ GenericSpringEventã€‚å› æ­¤ï¼Œåœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å‰é¢è®¨è®ºçš„æ³¨é‡Šé©±åŠ¨äº‹ä»¶ä¾¦å¬å™¨ã€‚\nè¿˜å¯ä»¥é€šè¿‡åœ¨ @EventListener æ³¨é‡Šä¸Šå®šä¹‰å¸ƒå°” SpEL è¡¨è¾¾å¼æ¥ä½¿äº‹ä»¶ä¾¦å¬å™¨æˆä¸ºæœ‰æ¡ä»¶çš„ã€‚\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªæœ‰æˆåŠŸçš„ String GenericSpringEvent æ‰ä¼šè°ƒç”¨äº‹ä»¶å¤„ç†ç¨‹åºï¼š\n@Component public class AnnotationDrivenEventListener { @EventListener(condition = \u0026#34;#event.success\u0026#34;) public void handleSuccessful(GenericSpringEvent\u0026lt;String\u0026gt; event) { System.out.println(\u0026#34;Handling generic event (conditional).\u0026#34;); } } Spring è¡¨è¾¾å¼è¯­è¨€ (SpEL) æ˜¯ä¸€ç§åŠŸèƒ½å¼ºå¤§çš„è¡¨è¾¾å¼è¯­è¨€ï¼Œåœ¨å¦ä¸€ä¸ªæ•™ç¨‹ä¸­è¯¦ç»†ä»‹ç»äº†å®ƒã€‚\n6.3.å‘å¸ƒè€… äº‹ä»¶å‘å¸ƒè€…ä¸ä¸Šé¢æè¿°çš„ç±»ä¼¼ã€‚ä½†ç”±äºç±»å‹æ“¦é™¤ï¼Œæˆ‘ä»¬éœ€è¦å‘å¸ƒä¸€ä¸ªäº‹ä»¶æ¥è§£ææˆ‘ä»¬è¦è¿‡æ»¤çš„æ³›å‹å‚æ•°ï¼Œä¾‹å¦‚ï¼Œclass GenericStringSpringEvent extends GenericSpringEventã€‚\næ­¤å¤–ï¼Œè¿˜æœ‰å¦ä¸€ç§å‘å¸ƒäº‹ä»¶çš„æ–¹å¼ã€‚å¦‚æœæˆ‘ä»¬ä»ä½¿ç”¨ @EventListener æ³¨é‡Šçš„æ–¹æ³•è¿”å›ä¸€ä¸ªéç©ºå€¼ä½œä¸ºç»“æœï¼ŒSpring Framework ä¼šå°†è¯¥ç»“æœä½œä¸ºæ–°äº‹ä»¶å‘é€ç»™æˆ‘ä»¬ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†å¤šä¸ªæ–°äº‹ä»¶ä½œä¸ºäº‹ä»¶å¤„ç†çš„ç»“æœè¿”å›åˆ°é›†åˆä¸­æ¥å‘å¸ƒå®ƒä»¬ã€‚\n7. äº¤æ˜“ç»‘å®šäº‹ä»¶ æœ¬èŠ‚ä»‹ç»å¦‚ä½•ä½¿ç”¨ @TransactionalEventListener æ³¨é‡Šã€‚è¦äº†è§£æœ‰å…³äº‹åŠ¡ç®¡ç†çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ Transactions With Spring and JPAã€‚\nä» Spring 4.2 å¼€å§‹ï¼Œæ¡†æ¶æä¾›äº†ä¸€ä¸ªæ–°çš„ @TransactionalEventListener æ³¨è§£ï¼Œå®ƒæ˜¯@EventListener çš„æ‰©å±•ï¼Œå…è®¸å°†äº‹ä»¶çš„ç›‘å¬å™¨ç»‘å®šåˆ°äº‹åŠ¡çš„æŸä¸ªé˜¶æ®µã€‚\nå¯ä»¥å¯¹ä»¥ä¸‹äº¤æ˜“é˜¶æ®µè¿›è¡Œç»‘å®šï¼š\nAFTER_COMMITï¼ˆé»˜è®¤ï¼‰ç”¨äºåœ¨äº‹åŠ¡æˆåŠŸå®Œæˆæ—¶è§¦å‘è¯¥äº‹ä»¶ã€‚ AFTER_ROLLBACK â€“ å¦‚æœäº‹åŠ¡å·²å›æ»š AFTER_COMPLETION â€“ å¦‚æœäº‹åŠ¡å·²å®Œæˆï¼ˆAFTER_COMMIT å’Œ AFTER_ROLLBACK çš„åˆ«åï¼‰ BEFORE_COMMIT â€“ ç”¨äºåœ¨äº‹åŠ¡æäº¤ä¹‹å‰è§¦å‘è¯¥äº‹ä»¶ã€‚ è¿™æ˜¯äº‹åŠ¡äº‹ä»¶ä¾¦å¬å™¨çš„ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼š\n@TransactionalEventListener(phase = TransactionPhase.BEFORE_COMMIT) public void handleCustom(CustomSpringEvent event) { System.out.println(\u0026#34;Handling event inside a transaction BEFORE COMMIT.\u0026#34;); } ä»…å½“äº‹ä»¶ç”Ÿæˆå™¨æ­£åœ¨è¿è¡Œä¸”å³å°†æäº¤çš„äº‹åŠ¡ä¸­æ—¶ï¼Œæ‰ä¼šè°ƒç”¨æ­¤ä¾¦å¬å™¨ã€‚\nå¦‚æœæ²¡æœ‰äº‹åŠ¡æ­£åœ¨è¿è¡Œï¼Œåˆ™æ ¹æœ¬ä¸ä¼šå‘é€äº‹ä»¶ï¼Œé™¤éæˆ‘ä»¬é€šè¿‡å°† FallbackExecution å±æ€§è®¾ç½®ä¸º true æ¥è¦†ç›–å®ƒã€‚\n8. ç»“è®º åœ¨è¿™ç¯‡ç®€çŸ­çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å›é¡¾äº†åœ¨ Spring ä¸­å¤„ç†äº‹ä»¶çš„åŸºç¡€çŸ¥è¯†ï¼ŒåŒ…æ‹¬åˆ›å»ºä¸€ä¸ªç®€å•çš„è‡ªå®šä¹‰äº‹ä»¶ã€å‘å¸ƒå®ƒï¼Œç„¶ååœ¨ä¾¦å¬å™¨ä¸­å¤„ç†å®ƒã€‚\næˆ‘ä»¬è¿˜ç®€è¦äº†è§£äº†å¦‚ä½•åœ¨é…ç½®ä¸­å¯ç”¨äº‹ä»¶çš„å¼‚æ­¥å¤„ç†ã€‚\nç„¶åæˆ‘ä»¬äº†è§£äº† Spring 4.2 ä¸­å¼•å…¥çš„æ”¹è¿›ï¼Œä¾‹å¦‚æ³¨é‡Šé©±åŠ¨çš„ä¾¦å¬å™¨ã€æ›´å¥½çš„æ³›å‹æ”¯æŒä»¥åŠç»‘å®šåˆ°äº‹åŠ¡é˜¶æ®µçš„äº‹ä»¶ã€‚\nä¸å¾€å¸¸ä¸€æ ·ï¼Œæœ¬æ–‡ä¸­æä¾›çš„ä»£ç å¯ä»¥åœ¨ GitHub ä¸Šè·å–ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºäº Maven çš„é¡¹ç›®ï¼Œå› æ­¤åº”è¯¥å¾ˆå®¹æ˜“å¯¼å…¥å¹¶æŒ‰åŸæ ·è¿è¡Œã€‚\nåŸæ–‡é“¾æ¥ï¼šhttps://www.baeldung.com/spring-events\n","permalink":"https://blog.chensoul.cc/posts/2023/08/25/spring-events/","summary":"1. æ¦‚è¿° åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•åœ¨ Spring ä¸­ä½¿ç”¨äº‹ä»¶ã€‚\näº‹ä»¶æ˜¯æ¡†æ¶ä¸­æœ€å®¹æ˜“è¢«å¿½è§†çš„åŠŸèƒ½ä¹‹ä¸€ï¼Œä½†ä¹Ÿæ˜¯æœ€æœ‰ç”¨çš„åŠŸèƒ½ä¹‹ä¸€ã€‚ä¸ Spring ä¸­çš„è®¸å¤šå…¶ä»–åŠŸèƒ½ä¸€æ ·ï¼Œäº‹ä»¶å‘å¸ƒæ˜¯ ApplicationContext æä¾›çš„åŠŸèƒ½ä¹‹ä¸€ã€‚\næœ‰ä¸€äº›ç®€å•çš„å‡†åˆ™éœ€è¦éµå¾ªï¼š\nå¦‚æœæˆ‘ä»¬ä½¿ç”¨ Spring Framework 4.2 ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œäº‹ä»¶ç±»åº”è¯¥æ‰©å±• ApplicationEventã€‚ä» 4.2 ç‰ˆæœ¬å¼€å§‹ï¼Œäº‹ä»¶ç±»ä¸å†éœ€è¦æ‰©å±• ApplicationEvent ç±»ã€‚ å‘å¸ƒè€…åº”è¯¥æ³¨å…¥ä¸€ä¸ª ApplicationEventPublisher å¯¹è±¡ã€‚ ç›‘å¬å™¨åº”è¯¥å®ç° ApplicationListener æ¥å£ã€‚ 2. è‡ªå®šä¹‰äº‹ä»¶ Spring å…è®¸æˆ‘ä»¬åˆ›å»ºå’Œå‘å¸ƒé»˜è®¤æƒ…å†µä¸‹åŒæ­¥çš„è‡ªå®šä¹‰äº‹ä»¶ã€‚è¿™æœ‰ä¸€äº›ä¼˜ç‚¹ï¼Œä¾‹å¦‚ä¾¦å¬å™¨èƒ½å¤Ÿå‚ä¸å‘å¸ƒè€…çš„äº‹åŠ¡ä¸Šä¸‹æ–‡ã€‚\n2.1.ä¸€ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºäº‹ä»¶ è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„äº‹ä»¶ç±»â€”â€”åªæ˜¯ä¸€ä¸ªå­˜å‚¨äº‹ä»¶æ•°æ®çš„å ä½ç¬¦ã€‚\nåœ¨æœ¬ä¾‹ä¸­ï¼Œäº‹ä»¶ç±»ä¿å­˜ä¸€æ¡å­—ç¬¦ä¸²æ¶ˆæ¯ï¼š\npublic class CustomSpringEvent extends ApplicationEvent { private String message; public CustomSpringEvent(Object source, String message) { super(source); this.message = message; } public String getMessage() { return message; } } 2.2.å‘å¸ƒè€… ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºè¯¥äº‹ä»¶çš„å‘å¸ƒè€…ã€‚å‘å¸ƒè€…æ„é€ äº‹ä»¶å¯¹è±¡å¹¶å°†å…¶å‘å¸ƒç»™æ­£åœ¨ä¾¦å¬çš„ä»»ä½•äººã€‚\nè¦å‘å¸ƒäº‹ä»¶ï¼Œå‘å¸ƒè€…åªéœ€æ³¨å…¥ ApplicationEventPublisher å¹¶ä½¿ç”¨ publishEvent() APIï¼š\n@Component public class CustomSpringEventPublisher { @Autowired private ApplicationEventPublisher applicationEventPublisher; public void publishCustomEvent(final String message) { System.out.println(\u0026#34;Publishing custom event. \u0026#34;); CustomSpringEvent customSpringEvent = new CustomSpringEvent(this, message); applicationEventPublisher.publishEvent(customSpringEvent); } } æˆ–è€…ï¼Œå‘å¸ƒè€…ç±»å¯ä»¥å®ç° ApplicationEventPublisherAware æ¥å£ï¼Œè¿™ä¹Ÿå°†åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶æ³¨å…¥äº‹ä»¶å‘å¸ƒè€…ã€‚é€šå¸¸ï¼Œä½¿ç”¨ @Autowire æ³¨å…¥å‘å¸ƒè€…ä¼šæ›´ç®€å•ã€‚","title":"[è¯‘]Spring Events"},{"content":"1. æ¦‚è¿° åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ Spring ä¸­çš„å¼‚æ­¥æ‰§è¡Œæ”¯æŒå’Œ @Async æ³¨è§£ã€‚\nç®€å•åœ°è¯´ï¼Œç”¨ @Async æ³¨è§£ bean çš„æ–¹æ³•å°†ä½¿å…¶åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­æ‰§è¡Œã€‚æ¢å¥è¯è¯´ï¼Œè°ƒç”¨è€…ä¸ä¼šç­‰å¾…è¢«è°ƒç”¨æ–¹æ³•çš„å®Œæˆã€‚\nSpring çš„ä¸€ä¸ªæœ‰è¶£çš„æ–¹é¢æ˜¯ï¼Œæ¡†æ¶ä¸­çš„äº‹ä»¶æ”¯æŒè¿˜ æ”¯æŒå¼‚æ­¥å¤„ç†ï¼ˆå¦‚æœéœ€è¦ï¼‰ã€‚\n2.å¯ç”¨å¼‚æ­¥æ”¯æŒ è®©æˆ‘ä»¬é¦–å…ˆé€šè¿‡ Java æ³¨è§£å¯ç”¨å¼‚æ­¥å¤„ç†ã€‚\næˆ‘ä»¬å°†é€šè¿‡å°† @EnableAsync æ·»åŠ åˆ°é…ç½®ç±»æ¥å®Œæˆæ­¤æ“ä½œï¼š\n@Configuration @EnableAsync public class SpringAsyncConfig { ... } å¯ç”¨æ³¨è§£å°±è¶³å¤Ÿäº†ã€‚ä½†ä¹Ÿæœ‰ä¸€äº›ç®€å•çš„é…ç½®é€‰é¡¹ï¼š\nannotation é»˜è®¤æƒ…å†µä¸‹ï¼Œ@EnableAsync æ£€æµ‹ Spring çš„ @Async æ³¨è§£å’Œ EJB 3.1 javax.ejb.Asynchronousã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨æ­¤é€‰é¡¹æ¥æ£€æµ‹å…¶ä»–ç”¨æˆ·å®šä¹‰çš„æ³¨è§£ç±»å‹ã€‚ mode æŒ‡ç¤ºåº”ä½¿ç”¨çš„å»ºè®®ç±»å‹ - åŸºäº JDK ä»£ç†æˆ– AspectJ ç¼–ç»‡ã€‚ proxyTargetClass æŒ‡ç¤ºåº”ä½¿ç”¨çš„ä»£ç†ç±»å‹ â€” CGLIB æˆ– JDKã€‚ä»…å½“æ¨¡å¼è®¾ç½®ä¸º AdviceMode.PROXY æ—¶ï¼Œæ­¤å±æ€§æ‰æœ‰æ•ˆã€‚ order è®¾ç½®åº”ç”¨ AsyncAnnotationBeanPostProcessor çš„é¡ºåºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒæœ€åè¿è¡Œï¼Œä»¥ä¾¿å®ƒå¯ä»¥è€ƒè™‘æ‰€æœ‰ç°æœ‰ä»£ç†ã€‚ æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ä»»åŠ¡å‘½åç©ºé—´é€šè¿‡ XML é…ç½®å¯ç”¨å¼‚æ­¥å¤„ç†ï¼š\n\u0026lt;task:executor id=\u0026#34;myexecutor\u0026#34; pool-size=\u0026#34;5\u0026#34; /\u0026gt; \u0026lt;task:annotation-driven executor=\u0026#34;myexecutor\u0026#34;/\u0026gt; 3.@Async æ³¨è§£ é¦–å…ˆï¼Œè®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹è§„åˆ™ã€‚ @Async æœ‰ä¸¤ä¸ªé™åˆ¶ï¼š\nå®ƒå¿…é¡»ä»…åº”ç”¨äºå…¬å…±æ–¹æ³•ã€‚ è‡ªè°ƒç”¨ï¼ˆä»åŒä¸€ä¸ªç±»ä¸­è°ƒç”¨å¼‚æ­¥æ–¹æ³•ï¼‰å°†ä¸èµ·ä½œç”¨ã€‚ åŸå› å¾ˆç®€å•ï¼šè¯¥æ–¹æ³•éœ€è¦å…¬å¼€ï¼Œä»¥ä¾¿å¯ä»¥è¢«ä»£ç†ã€‚å¹¶ä¸”è‡ªè°ƒç”¨ä¸èµ·ä½œç”¨ï¼Œå› ä¸ºå®ƒç»•è¿‡ä»£ç†å¹¶ç›´æ¥è°ƒç”¨åº•å±‚æ–¹æ³•ã€‚\n3.1.è¿”å›ç±»å‹ä¸º void çš„æ–¹æ³• è¿™æ˜¯é…ç½®å…·æœ‰ void è¿”å›ç±»å‹çš„æ–¹æ³•ä»¥å¼‚æ­¥è¿è¡Œçš„ç®€å•æ–¹æ³•ï¼š\n@Async public void asyncMethodWithVoidReturnType() { System.out.println(\u0026#34;Execute method asynchronously. \u0026#34; + Thread.currentThread().getName()); } 3.2.å…·æœ‰è¿”å›ç±»å‹çš„æ–¹æ³• æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡å°†å®é™…è¿”å›åŒ…è£…åœ¨ Future ä¸­æ¥å°† @Async åº”ç”¨äºå…·æœ‰è¿”å›ç±»å‹çš„æ–¹æ³•ï¼š\n@Async public Future\u0026lt;String\u0026gt; asyncMethodWithReturnType() { System.out.println(\u0026#34;Execute method asynchronously - \u0026#34; + Thread.currentThread().getName()); try { Thread.sleep(5000); return new AsyncResult\u0026lt;String\u0026gt;(\u0026#34;hello world !!!!\u0026#34;); } catch (InterruptedException e) { // } return null; } Spring è¿˜æä¾›äº†ä¸€ä¸ªå®ç°Futureçš„AsyncResultç±»ã€‚æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥è·Ÿè¸ªå¼‚æ­¥æ–¹æ³•æ‰§è¡Œçš„ç»“æœã€‚\nç°åœ¨è®©æˆ‘ä»¬è°ƒç”¨ä¸Šè¿°æ–¹æ³•å¹¶ä½¿ç”¨ Future å¯¹è±¡æ£€ç´¢å¼‚æ­¥è¿‡ç¨‹çš„ç»“æœã€‚\npublic void testAsyncAnnotationForMethodsWithReturnType() throws InterruptedException, ExecutionException { System.out.println(\u0026#34;Invoking an asynchronous method. \u0026#34; + Thread.currentThread().getName()); Future\u0026lt;String\u0026gt; future = asyncAnnotationExample.asyncMethodWithReturnType(); while (true) { if (future.isDone()) { System.out.println(\u0026#34;Result from asynchronous process - \u0026#34; + future.get()); break; } System.out.println(\u0026#34;Continue doing something else. \u0026#34;); Thread.sleep(1000); } } 4. Executor é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring ä½¿ç”¨ SimpleAsyncTaskExecutor æ¥å®é™…å¼‚æ­¥è¿è¡Œè¿™äº›æ–¹æ³•ã€‚ä½†æˆ‘ä»¬å¯ä»¥åœ¨ä¸¤ä¸ªçº§åˆ«è¦†ç›–é»˜è®¤å€¼ï¼šåº”ç”¨ç¨‹åºçº§åˆ«æˆ–å•ä¸ªæ–¹æ³•çº§åˆ«ã€‚\n4.1.åœ¨æ–¹æ³•çº§åˆ«é‡å†™ Executor æˆ‘ä»¬éœ€è¦åœ¨é…ç½®ç±»ä¸­å£°æ˜æ‰€éœ€çš„æ‰§è¡Œå™¨ï¼š\n@Configuration @EnableAsync public class SpringAsyncConfig { @Bean(name = \u0026#34;threadPoolTaskExecutor\u0026#34;) public Executor threadPoolTaskExecutor() { return new ThreadPoolTaskExecutor(); } } ç„¶åæˆ‘ä»¬åº”è¯¥åœ¨ @Async ä¸­æä¾›æ‰§è¡Œç¨‹åºåç§°ä½œä¸ºå±æ€§ï¼š\n@Async(\u0026#34;threadPoolTaskExecutor\u0026#34;) public void asyncMethodWithConfiguredExecutor() { System.out.println(\u0026#34;Execute method with configured executor - \u0026#34; + Thread.currentThread().getName()); } 4.2.åœ¨åº”ç”¨ç¨‹åºçº§åˆ«è¦†ç›– Executor é…ç½®ç±»åº”å®ç° AsyncConfigurer æ¥å£ã€‚å› æ­¤ï¼Œå®ƒå¿…é¡»å®ç° getAsyncExecutor() æ–¹æ³•ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†è¿”å›æ•´ä¸ªåº”ç”¨ç¨‹åºçš„æ‰§è¡Œå™¨ã€‚ç°åœ¨ï¼Œå®ƒæˆä¸ºè¿è¡Œç”¨ @Async æ³¨è§£çš„æ–¹æ³•çš„é»˜è®¤æ‰§è¡Œå™¨ï¼š\n@Configuration @EnableAsync public class SpringAsyncConfig implements AsyncConfigurer { @Override public Executor getAsyncExecutor() { ThreadPoolTaskExecutor threadPoolTaskExecutor = new ThreadPoolTaskExecutor(); threadPoolTaskExecutor.initialize(); return threadPoolTaskExecutor; } } 5. å¼‚å¸¸å¤„ç† å½“æ–¹æ³•è¿”å›ç±»å‹æ˜¯ Future æ—¶ï¼Œå¼‚å¸¸å¤„ç†å¾ˆå®¹æ˜“ã€‚ Future.get() æ–¹æ³•å°†æŠ›å‡ºå¼‚å¸¸ã€‚\nä½†å¦‚æœè¿”å›ç±»å‹ä¸º voidï¼Œå¼‚å¸¸å°†ä¸ä¼šä¼ æ’­åˆ°è°ƒç”¨çº¿ç¨‹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ é¢å¤–çš„é…ç½®æ¥å¤„ç†å¼‚å¸¸ã€‚\næˆ‘ä»¬å°†é€šè¿‡å®ç° AsyncUncaughtExceptionHandler æ¥å£æ¥åˆ›å»ºè‡ªå®šä¹‰å¼‚æ­¥å¼‚å¸¸å¤„ç†ç¨‹åºã€‚å½“å­˜åœ¨ä»»ä½•æœªæ•è·çš„å¼‚æ­¥å¼‚å¸¸æ—¶ï¼Œå°†è°ƒç”¨ handleUncaughtException() æ–¹æ³•ï¼š\npublic class CustomAsyncExceptionHandler implements AsyncUncaughtExceptionHandler { @Override public void handleUncaughtException( Throwable throwable, Method method, Object... obj) { System.out.println(\u0026#34;Exception message - \u0026#34; + throwable.getMessage()); System.out.println(\u0026#34;Method name - \u0026#34; + method.getName()); for (Object param : obj) { System.out.println(\u0026#34;Parameter value - \u0026#34; + param); } } } åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº†é…ç½®ç±»å®ç°çš„ AsyncConfigurer æ¥å£ã€‚ä½œä¸ºå…¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬è¿˜éœ€è¦é‡å†™ getAsyncUncaughtExceptionHandler() æ–¹æ³•ä»¥è¿”å›æˆ‘ä»¬çš„è‡ªå®šä¹‰å¼‚æ­¥å¼‚å¸¸å¤„ç†ç¨‹åºï¼š\n@Override public AsyncUncaughtExceptionHandler getAsyncUncaughtExceptionHandler() { return new CustomAsyncExceptionHandler(); } 6. ç»“è®º åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ç ”ç©¶äº†ä½¿ç”¨ Spring è¿è¡Œå¼‚æ­¥ä»£ç ã€‚\næˆ‘ä»¬ä»éå¸¸åŸºæœ¬çš„é…ç½®å’Œæ³¨è§£å¼€å§‹ï¼Œä»¥ä½¿å…¶æ­£å¸¸å·¥ä½œã€‚ä½†æˆ‘ä»¬ä¹Ÿç ”ç©¶äº†æ›´é«˜çº§çš„é…ç½®ï¼Œä¾‹å¦‚æä¾›æˆ‘ä»¬è‡ªå·±çš„æ‰§è¡Œå™¨æˆ–å¼‚å¸¸å¤„ç†ç­–ç•¥ã€‚\nä¸å¾€å¸¸ä¸€æ ·ï¼Œæœ¬æ–‡ä¸­æä¾›çš„å®Œæ•´ä»£ç å¯ä»¥åœ¨ GitHub ä¸Šæ‰¾åˆ°ã€‚\nåŸæ–‡é“¾æ¥ï¼šhttps://www.baeldung.com/spring-async\n","permalink":"https://blog.chensoul.cc/posts/2023/08/25/spring-async/","summary":"1. æ¦‚è¿° åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ Spring ä¸­çš„å¼‚æ­¥æ‰§è¡Œæ”¯æŒå’Œ @Async æ³¨è§£ã€‚\nç®€å•åœ°è¯´ï¼Œç”¨ @Async æ³¨è§£ bean çš„æ–¹æ³•å°†ä½¿å…¶åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­æ‰§è¡Œã€‚æ¢å¥è¯è¯´ï¼Œè°ƒç”¨è€…ä¸ä¼šç­‰å¾…è¢«è°ƒç”¨æ–¹æ³•çš„å®Œæˆã€‚\nSpring çš„ä¸€ä¸ªæœ‰è¶£çš„æ–¹é¢æ˜¯ï¼Œæ¡†æ¶ä¸­çš„äº‹ä»¶æ”¯æŒè¿˜ æ”¯æŒå¼‚æ­¥å¤„ç†ï¼ˆå¦‚æœéœ€è¦ï¼‰ã€‚\n2.å¯ç”¨å¼‚æ­¥æ”¯æŒ è®©æˆ‘ä»¬é¦–å…ˆé€šè¿‡ Java æ³¨è§£å¯ç”¨å¼‚æ­¥å¤„ç†ã€‚\næˆ‘ä»¬å°†é€šè¿‡å°† @EnableAsync æ·»åŠ åˆ°é…ç½®ç±»æ¥å®Œæˆæ­¤æ“ä½œï¼š\n@Configuration @EnableAsync public class SpringAsyncConfig { ... } å¯ç”¨æ³¨è§£å°±è¶³å¤Ÿäº†ã€‚ä½†ä¹Ÿæœ‰ä¸€äº›ç®€å•çš„é…ç½®é€‰é¡¹ï¼š\nannotation é»˜è®¤æƒ…å†µä¸‹ï¼Œ@EnableAsync æ£€æµ‹ Spring çš„ @Async æ³¨è§£å’Œ EJB 3.1 javax.ejb.Asynchronousã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨æ­¤é€‰é¡¹æ¥æ£€æµ‹å…¶ä»–ç”¨æˆ·å®šä¹‰çš„æ³¨è§£ç±»å‹ã€‚ mode æŒ‡ç¤ºåº”ä½¿ç”¨çš„å»ºè®®ç±»å‹ - åŸºäº JDK ä»£ç†æˆ– AspectJ ç¼–ç»‡ã€‚ proxyTargetClass æŒ‡ç¤ºåº”ä½¿ç”¨çš„ä»£ç†ç±»å‹ â€” CGLIB æˆ– JDKã€‚ä»…å½“æ¨¡å¼è®¾ç½®ä¸º AdviceMode.PROXY æ—¶ï¼Œæ­¤å±æ€§æ‰æœ‰æ•ˆã€‚ order è®¾ç½®åº”ç”¨ AsyncAnnotationBeanPostProcessor çš„é¡ºåºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒæœ€åè¿è¡Œï¼Œä»¥ä¾¿å®ƒå¯ä»¥è€ƒè™‘æ‰€æœ‰ç°æœ‰ä»£ç†ã€‚ æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ä»»åŠ¡å‘½åç©ºé—´é€šè¿‡ XML é…ç½®å¯ç”¨å¼‚æ­¥å¤„ç†ï¼š\n\u0026lt;task:executor id=\u0026#34;myexecutor\u0026#34; pool-size=\u0026#34;5\u0026#34; /\u0026gt; \u0026lt;task:annotation-driven executor=\u0026#34;myexecutor\u0026#34;/\u0026gt; 3.@Async æ³¨è§£ é¦–å…ˆï¼Œè®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹è§„åˆ™ã€‚ @Async æœ‰ä¸¤ä¸ªé™åˆ¶ï¼š\nå®ƒå¿…é¡»ä»…åº”ç”¨äºå…¬å…±æ–¹æ³•ã€‚ è‡ªè°ƒç”¨ï¼ˆä»åŒä¸€ä¸ªç±»ä¸­è°ƒç”¨å¼‚æ­¥æ–¹æ³•ï¼‰å°†ä¸èµ·ä½œç”¨ã€‚ åŸå› å¾ˆç®€å•ï¼šè¯¥æ–¹æ³•éœ€è¦å…¬å¼€ï¼Œä»¥ä¾¿å¯ä»¥è¢«ä»£ç†ã€‚å¹¶ä¸”è‡ªè°ƒç”¨ä¸èµ·ä½œç”¨ï¼Œå› ä¸ºå®ƒç»•è¿‡ä»£ç†å¹¶ç›´æ¥è°ƒç”¨åº•å±‚æ–¹æ³•ã€‚\n3.1.è¿”å›ç±»å‹ä¸º void çš„æ–¹æ³• è¿™æ˜¯é…ç½®å…·æœ‰ void è¿”å›ç±»å‹çš„æ–¹æ³•ä»¥å¼‚æ­¥è¿è¡Œçš„ç®€å•æ–¹æ³•ï¼š\n@Async public void asyncMethodWithVoidReturnType() { System.out.println(\u0026#34;Execute method asynchronously. \u0026#34; + Thread.currentThread().getName()); } 3.2.å…·æœ‰è¿”å›ç±»å‹çš„æ–¹æ³• æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡å°†å®é™…è¿”å›åŒ…è£…åœ¨ Future ä¸­æ¥å°† @Async åº”ç”¨äºå…·æœ‰è¿”å›ç±»å‹çš„æ–¹æ³•ï¼š","title":"[è¯‘]å¦‚ä½•åœ¨Springä¸­æ‰§è¡Œ@Async"},{"content":"ç”¨æˆ·æ•…äº‹ï¼ˆUser Storiesï¼‰æ˜¯æ•æ·è½¯ä»¶å¼€å‘ä¸­çš„ä¸€ç§éœ€æ±‚è¡¨è¾¾æ–¹å¼ï¼Œç”¨äºæè¿°ç”¨æˆ·çš„éœ€æ±‚ã€æœŸæœ›å’Œä»·å€¼ã€‚å°½ç®¡ç”¨æˆ·æ•…äº‹ä¸»è¦åº”ç”¨äºè½¯ä»¶å¼€å‘å›¢é˜Ÿï¼Œä½†å…¶åŸåˆ™å’Œæ–¹æ³•ä¹Ÿå¯ä»¥åº”ç”¨åˆ°ä¸ªäººç®¡ç†ä¸­ï¼Œä»¥å¸®åŠ©ä¸ªäººæ›´å¥½åœ°ç®¡ç†è‡ªå·±çš„ä»»åŠ¡å’Œç›®æ ‡ã€‚\nåœ¨ä¸ªäººç®¡ç†ä¸­ï¼Œå¯ä»¥å°†ç”¨æˆ·æ•…äº‹çš„æ€ç»´æ–¹å¼åº”ç”¨å¦‚ä¸‹ï¼š\nè§’è‰²å®šä¹‰ï¼šå°†è‡ªå·±ä½œä¸ºä¸€ä¸ªè§’è‰²ï¼Œä¾‹å¦‚â€œä¸ªäººâ€æˆ–â€œè‡ªå·±çš„åå­—â€ã€‚æ˜ç¡®è‡ªå·±çš„èº«ä»½å’Œè§’è‰²ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç†è§£è‡ªå·±çš„éœ€æ±‚å’ŒæœŸæœ›ã€‚ éœ€æ±‚æè¿°ï¼šå°†è‡ªå·±çš„éœ€æ±‚å’ŒæœŸæœ›è½¬åŒ–ä¸ºç”¨æˆ·æ•…äº‹çš„å½¢å¼ã€‚ä¾‹å¦‚ï¼šâ€œä½œä¸ºä¸€ä¸ªä¸ªäººï¼Œæˆ‘å¸Œæœ›æ¯å¤©æ—©æ™¨é”»ç‚¼ï¼Œä»¥ä¿æŒå¥åº·å’Œå¢åŠ æ´»åŠ›ã€‚â€ ä»·å€¼å®šä¹‰ï¼šç¡®å®šæ¯ä¸ªç”¨æˆ·æ•…äº‹çš„ä»·å€¼å’Œæ„ä¹‰ã€‚ä¾‹å¦‚ï¼Œé”»ç‚¼èº«ä½“å¯ä»¥å¢å¼ºå¥åº·ã€æé«˜ç²¾åŠ›å’Œæ”¹å–„å¿ƒæƒ…ï¼Œä»è€Œæå‡æ•´ä½“ç”Ÿæ´»è´¨é‡ã€‚ ä¼˜å…ˆçº§æ’åºï¼šå¯¹ç”¨æˆ·æ•…äº‹è¿›è¡Œä¼˜å…ˆçº§æ’åºï¼Œä»¥ç¡®å®šå“ªäº›æ˜¯æœ€é‡è¦çš„å’Œç´§æ€¥çš„ã€‚è¿™æœ‰åŠ©äºé›†ä¸­ç²¾åŠ›å’Œèµ„æºï¼Œå®ç°æœ€æœ‰ä»·å€¼çš„ç›®æ ‡ã€‚ åˆ¶å®šè®¡åˆ’ï¼šæ ¹æ®ç”¨æˆ·æ•…äº‹çš„ä¼˜å…ˆçº§ï¼Œåˆ¶å®šä¸ªäººç®¡ç†è®¡åˆ’ã€‚å°†æ¯ä¸ªç”¨æˆ·æ•…äº‹è½¬åŒ–ä¸ºå…·ä½“çš„ä»»åŠ¡ã€è¡ŒåŠ¨å’Œæ—¶é—´å®‰æ’ï¼Œä»¥å®ç°æœŸæœ›çš„ç»“æœã€‚ è¿­ä»£å’Œåé¦ˆï¼šå°†ä¸ªäººç®¡ç†è¿‡ç¨‹è§†ä¸ºä¸€ä¸ªè¿­ä»£å¾ªç¯ï¼Œä¸æ–­è¯„ä¼°å’Œè°ƒæ•´ã€‚æ ¹æ®å®é™…æ‰§è¡Œæƒ…å†µå’Œåé¦ˆï¼Œå¯¹è®¡åˆ’è¿›è¡Œè°ƒæ•´å’Œæ”¹è¿›ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªåˆ¶å®šä¸ªäººç®¡ç†è®¡åˆ’çš„ç¤ºä¾‹ï¼š\nç”¨æˆ·æ•…äº‹ï¼šä½œä¸ºä¸€ä¸ªä¸ªäººï¼Œæˆ‘å¸Œæœ›æé«˜å·¥ä½œæ•ˆç‡å’Œæ—¶é—´ç®¡ç†ï¼Œä»¥æ›´å¥½åœ°å®Œæˆä»»åŠ¡å’Œå¢åŠ å·¥ä½œæˆæœã€‚\nè®¡åˆ’ï¼š\nç”¨æˆ·æ•…äº‹ï¼šä½œä¸ºä¸€ä¸ªä¸ªäººï¼Œæˆ‘å¸Œæœ›è®¾å®šæ˜ç¡®çš„ç›®æ ‡å’Œä¼˜å…ˆçº§ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç®¡ç†æˆ‘çš„ä»»åŠ¡ã€‚ ä»»åŠ¡ 1ï¼šåˆ¶å®šé•¿æœŸç›®æ ‡å’ŒçŸ­æœŸç›®æ ‡ï¼Œå¹¶å°†å…¶è®°å½•åœ¨ä¸ªäººç¬”è®°æœ¬æˆ–ä»»åŠ¡ç®¡ç†å·¥å…·ä¸­ã€‚ ä»»åŠ¡ 2ï¼šä¸ºæ¯ä¸ªç›®æ ‡è®¾å®šä¼˜å…ˆçº§ï¼Œä»¥ç¡®å®šæœ€é‡è¦çš„ä»»åŠ¡å’Œæ´»åŠ¨ã€‚ ç”¨æˆ·æ•…äº‹ï¼šä½œä¸ºä¸€ä¸ªä¸ªäººï¼Œæˆ‘å¸Œæœ›æ”¹å–„æ—¶é—´ç®¡ç†ï¼Œä»¥å……åˆ†åˆ©ç”¨æˆ‘çš„æ—¶é—´ã€‚ ä»»åŠ¡ 1ï¼šåˆ†ææˆ‘çš„æ—¥å¸¸æ—¶é—´åˆ†é…ï¼Œå¹¶è¯†åˆ«æ—¶é—´æµªè´¹çš„åŒºåŸŸã€‚ ä»»åŠ¡ 2ï¼šåˆ¶å®šæ—¶é—´è¡¨æˆ–æ—¥ç¨‹å®‰æ’ï¼Œå°†ä»»åŠ¡å’Œæ´»åŠ¨åˆç†åˆ†é…åˆ°ç‰¹å®šæ—¶é—´æ®µã€‚ ä»»åŠ¡ 3ï¼šå­¦ä¹ å’Œé‡‡ç”¨æ—¶é—´ç®¡ç†æŠ€å·§ï¼Œå¦‚ç•ªèŒ„å·¥ä½œæ³•ï¼ˆPomodoro Techniqueï¼‰æˆ–æ—¶é—´å—ï¼ˆTime Blockingï¼‰ã€‚ ç”¨æˆ·æ•…äº‹ï¼šä½œä¸ºä¸€ä¸ªä¸ªäººï¼Œæˆ‘å¸Œæœ›æé«˜ä¸“æ³¨åŠ›å’Œå‡å°‘å¹²æ‰°ï¼Œä»¥æ›´å¥½åœ°å®Œæˆä»»åŠ¡ã€‚ ä»»åŠ¡ 1ï¼šåˆ›å»ºä¸€ä¸ªæœ‰åˆ©äºä¸“æ³¨çš„å·¥ä½œç¯å¢ƒï¼Œå¦‚æ¸…ç†å·¥ä½œåŒºåŸŸã€å…³é—­æ‰‹æœºé€šçŸ¥æˆ–ä½¿ç”¨ä¸“æ³¨åº”ç”¨ç¨‹åºã€‚ ä»»åŠ¡ 2ï¼šå­¦ä¹ å¹¶ä½¿ç”¨æ³¨æ„åŠ›ç®¡ç†æŠ€å·§ï¼Œå¦‚é›†ä¸­æ³¨æ„åŠ›è®­ç»ƒï¼ˆFocused Attention Trainingï¼‰æˆ–å†¥æƒ³ã€‚ ç”¨æˆ·æ•…äº‹ï¼šä½œä¸ºä¸€ä¸ªä¸ªäººï¼Œæˆ‘å¸Œæœ›ä¿æŒå¥åº·å’Œæé«˜ç²¾åŠ›ï¼Œä»¥æ›´å¥½åœ°åº”å¯¹å·¥ä½œå’Œä»»åŠ¡ã€‚ ä»»åŠ¡ 1ï¼šåˆ¶å®šå¥åº·çš„ç”Ÿæ´»ä¹ æƒ¯ï¼Œå¦‚å®šæœŸé”»ç‚¼ã€å¥åº·é¥®é£Ÿå’Œå……è¶³çš„ç¡çœ ã€‚ ä»»åŠ¡ 2ï¼šå®‰æ’ä¼‘æ¯å’Œæ”¾æ¾çš„æ—¶é—´ï¼Œä»¥é¿å…è¿‡åº¦åŠ³ç´¯å’Œç–²åŠ³ã€‚ ç”¨æˆ·æ•…äº‹ï¼šä½œä¸ºä¸€ä¸ªä¸ªäººï¼Œæˆ‘å¸Œæœ›å®šæœŸè¯„ä¼°å’Œè°ƒæ•´æˆ‘çš„ä¸ªäººç®¡ç†è®¡åˆ’ï¼Œä»¥é€‚åº”å˜åŒ–å’Œæ”¹è¿›æ•ˆæœã€‚ ä»»åŠ¡ 1ï¼šæ¯å‘¨æˆ–æ¯æœˆå›é¡¾æˆ‘çš„ä¸ªäººç®¡ç†è®¡åˆ’ï¼Œå¹¶è®°å½•æˆ‘å–å¾—çš„æˆæœå’Œé‡åˆ°çš„æŒ‘æˆ˜ã€‚ ä»»åŠ¡ 2ï¼šæ ¹æ®åé¦ˆå’Œç»éªŒï¼Œè°ƒæ•´è®¡åˆ’ä¸­çš„ä»»åŠ¡å’Œç­–ç•¥ï¼Œä»¥æ”¹è¿›æ•ˆæœå’Œé€‚åº”æ–°çš„éœ€æ±‚ã€‚ è¿™åªæ˜¯ä¸€ä¸ªç¤ºä¾‹ä¸ªäººç®¡ç†è®¡åˆ’ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚å’Œç›®æ ‡è¿›è¡Œå®šåˆ¶å’Œè°ƒæ•´ã€‚è®°å¾—å°†è®¡åˆ’ä¸­çš„ä»»åŠ¡å…·ä½“åŒ–ã€å¯è¡¡é‡ï¼Œå¹¶é€æ­¥å®æ–½ï¼Œä»¥ç¡®ä¿è®¡åˆ’çš„å¯è¡Œæ€§å’Œæœ‰æ•ˆæ€§ã€‚\né€æ­¥å®æ–½ä¸ªäººç®¡ç†è®¡åˆ’æ˜¯ç¡®ä¿è®¡åˆ’å¯è¡Œæ€§å’Œæœ‰æ•ˆæ€§çš„é‡è¦æ­¥éª¤ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æ–¹æ³•æ¥é€æ­¥å®æ–½ä½ çš„ä¸ªäººç®¡ç†è®¡åˆ’ï¼š\nåˆ¶å®šä¼˜å…ˆçº§ï¼šæ ¹æ®è®¡åˆ’ä¸­çš„ä»»åŠ¡å’Œç›®æ ‡ï¼Œç¡®å®šå®ƒä»¬çš„ä¼˜å…ˆçº§é¡ºåºã€‚å°†é‡è¦ä¸”ç´§æ€¥çš„ä»»åŠ¡æ”¾åœ¨é¦–ä½ï¼Œé€æ­¥å¤„ç†å…¶ä»–ä»»åŠ¡ã€‚ åˆ¶å®šè®¡åˆ’ï¼šä¸ºæ¯ä¸ªä»»åŠ¡åˆ¶å®šå…·ä½“çš„è®¡åˆ’å’Œè¡ŒåŠ¨æ­¥éª¤ã€‚å°†ä»»åŠ¡åˆ†è§£ä¸ºæ›´å°çš„å¯ç®¡ç†çš„å­ä»»åŠ¡ï¼Œå¹¶ä¸ºæ¯ä¸ªå­ä»»åŠ¡è®¾å®šæˆªæ­¢æ—¥æœŸæˆ–æ—¶é—´èŒƒå›´ã€‚ è®¾å®šç›®æ ‡ï¼šä¸ºæ¯ä¸ªä»»åŠ¡è®¾å®šæ˜ç¡®çš„ç›®æ ‡å’Œå¯è¡¡é‡çš„æŒ‡æ ‡ã€‚è¿™æ ·å¯ä»¥æ›´å¥½åœ°è·Ÿè¸ªå’Œè¯„ä¼°ä½ çš„è¿›å±•ã€‚ æ—¶é—´ç®¡ç†ï¼šåˆç†å®‰æ’æ—¶é—´ä»¥å®æ–½è®¡åˆ’ã€‚ä½¿ç”¨æ—¶é—´ç®¡ç†æŠ€å·§ï¼Œå¦‚æ—¶é—´å—ï¼Œå°†ä»»åŠ¡å’Œæ´»åŠ¨åˆ†é…åˆ°ç‰¹å®šçš„æ—¶é—´æ®µï¼Œå¹¶è®¾å®šæ—¶é—´é™åˆ¶ä»¥ä¿æŒä¸“æ³¨å’Œé«˜æ•ˆã€‚ å»ºç«‹ä¹ æƒ¯ï¼šå°†è®¡åˆ’ä¸­çš„ä»»åŠ¡å’Œè¡ŒåŠ¨è½¬åŒ–ä¸ºä¹ æƒ¯ã€‚é‡å¤æ‰§è¡Œä»»åŠ¡å¹¶åšæŒä¸€æ®µæ—¶é—´ï¼Œä»¥å½¢æˆè‰¯å¥½çš„ä¹ æƒ¯ã€‚ ç›‘æ§å’Œè¯„ä¼°ï¼šå®šæœŸç›‘æ§å’Œè¯„ä¼°ä½ çš„è¿›å±•ã€‚æ£€æŸ¥å®Œæˆçš„ä»»åŠ¡ï¼Œè¯„ä¼°æ˜¯å¦è¾¾åˆ°é¢„æœŸçš„ç›®æ ‡å’ŒæŒ‡æ ‡ã€‚æ ¹æ®åé¦ˆå’Œç»éªŒï¼Œè¿›è¡Œè°ƒæ•´å’Œæ”¹è¿›ã€‚ é€‚åº”å˜åŒ–ï¼šçµæ´»åº”å¯¹å˜åŒ–å’Œè°ƒæ•´ã€‚å¦‚æœé‡åˆ°æ–°çš„éœ€æ±‚æˆ–æƒ…å†µï¼Œæ ¹æ®å®é™…æƒ…å†µé‡æ–°å®‰æ’ä»»åŠ¡å’Œä¼˜å…ˆçº§ã€‚ æŒç»­æ”¹è¿›ï¼šæ ¹æ®å®æ–½çš„ç»éªŒå’Œåé¦ˆï¼Œä¸æ–­æ”¹è¿›ä¸ªäººç®¡ç†è®¡åˆ’ã€‚å°è¯•æ–°çš„æ–¹æ³•å’Œç­–ç•¥ï¼Œå¯»æ‰¾æé«˜æ•ˆç‡å’Œæˆæœçš„æœºä¼šã€‚ é€æ­¥å®æ–½ä¸ªäººç®¡ç†è®¡åˆ’éœ€è¦è€å¿ƒå’ŒåšæŒï¼Œä¸€æ­¥ä¸€ä¸ªè„šå°åœ°å®Œæˆæ¯ä¸ªä»»åŠ¡ï¼Œå¹¶é€æ¸æ‰©å¤§å’Œæé«˜ç›®æ ‡çš„èŒƒå›´ã€‚è®°å¾—ç»™è‡ªå·±ä¸€å®šçš„å¼¹æ€§å’Œå®¹é”™ç©ºé—´ï¼Œä»¥é€‚åº”æ„å¤–æƒ…å†µå’ŒæŒ‘æˆ˜ã€‚æœ€é‡è¦çš„æ˜¯ä¿æŒç§¯æçš„æ€åº¦å’ŒåŠ¨åŠ›ï¼Œä¸æ–­åŠªåŠ›å®ç°ä¸ªäººç›®æ ‡å’Œæå‡è‡ªæˆ‘ç®¡ç†èƒ½åŠ›ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/08/21/user-stories-in-self-manager/","summary":"ç”¨æˆ·æ•…äº‹ï¼ˆUser Storiesï¼‰æ˜¯æ•æ·è½¯ä»¶å¼€å‘ä¸­çš„ä¸€ç§éœ€æ±‚è¡¨è¾¾æ–¹å¼ï¼Œç”¨äºæè¿°ç”¨æˆ·çš„éœ€æ±‚ã€æœŸæœ›å’Œä»·å€¼ã€‚å°½ç®¡ç”¨æˆ·æ•…äº‹ä¸»è¦åº”ç”¨äºè½¯ä»¶å¼€å‘å›¢é˜Ÿï¼Œä½†å…¶åŸåˆ™å’Œæ–¹æ³•ä¹Ÿå¯ä»¥åº”ç”¨åˆ°ä¸ªäººç®¡ç†ä¸­ï¼Œä»¥å¸®åŠ©ä¸ªäººæ›´å¥½åœ°ç®¡ç†è‡ªå·±çš„ä»»åŠ¡å’Œç›®æ ‡ã€‚\nåœ¨ä¸ªäººç®¡ç†ä¸­ï¼Œå¯ä»¥å°†ç”¨æˆ·æ•…äº‹çš„æ€ç»´æ–¹å¼åº”ç”¨å¦‚ä¸‹ï¼š\nè§’è‰²å®šä¹‰ï¼šå°†è‡ªå·±ä½œä¸ºä¸€ä¸ªè§’è‰²ï¼Œä¾‹å¦‚â€œä¸ªäººâ€æˆ–â€œè‡ªå·±çš„åå­—â€ã€‚æ˜ç¡®è‡ªå·±çš„èº«ä»½å’Œè§’è‰²ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç†è§£è‡ªå·±çš„éœ€æ±‚å’ŒæœŸæœ›ã€‚ éœ€æ±‚æè¿°ï¼šå°†è‡ªå·±çš„éœ€æ±‚å’ŒæœŸæœ›è½¬åŒ–ä¸ºç”¨æˆ·æ•…äº‹çš„å½¢å¼ã€‚ä¾‹å¦‚ï¼šâ€œä½œä¸ºä¸€ä¸ªä¸ªäººï¼Œæˆ‘å¸Œæœ›æ¯å¤©æ—©æ™¨é”»ç‚¼ï¼Œä»¥ä¿æŒå¥åº·å’Œå¢åŠ æ´»åŠ›ã€‚â€ ä»·å€¼å®šä¹‰ï¼šç¡®å®šæ¯ä¸ªç”¨æˆ·æ•…äº‹çš„ä»·å€¼å’Œæ„ä¹‰ã€‚ä¾‹å¦‚ï¼Œé”»ç‚¼èº«ä½“å¯ä»¥å¢å¼ºå¥åº·ã€æé«˜ç²¾åŠ›å’Œæ”¹å–„å¿ƒæƒ…ï¼Œä»è€Œæå‡æ•´ä½“ç”Ÿæ´»è´¨é‡ã€‚ ä¼˜å…ˆçº§æ’åºï¼šå¯¹ç”¨æˆ·æ•…äº‹è¿›è¡Œä¼˜å…ˆçº§æ’åºï¼Œä»¥ç¡®å®šå“ªäº›æ˜¯æœ€é‡è¦çš„å’Œç´§æ€¥çš„ã€‚è¿™æœ‰åŠ©äºé›†ä¸­ç²¾åŠ›å’Œèµ„æºï¼Œå®ç°æœ€æœ‰ä»·å€¼çš„ç›®æ ‡ã€‚ åˆ¶å®šè®¡åˆ’ï¼šæ ¹æ®ç”¨æˆ·æ•…äº‹çš„ä¼˜å…ˆçº§ï¼Œåˆ¶å®šä¸ªäººç®¡ç†è®¡åˆ’ã€‚å°†æ¯ä¸ªç”¨æˆ·æ•…äº‹è½¬åŒ–ä¸ºå…·ä½“çš„ä»»åŠ¡ã€è¡ŒåŠ¨å’Œæ—¶é—´å®‰æ’ï¼Œä»¥å®ç°æœŸæœ›çš„ç»“æœã€‚ è¿­ä»£å’Œåé¦ˆï¼šå°†ä¸ªäººç®¡ç†è¿‡ç¨‹è§†ä¸ºä¸€ä¸ªè¿­ä»£å¾ªç¯ï¼Œä¸æ–­è¯„ä¼°å’Œè°ƒæ•´ã€‚æ ¹æ®å®é™…æ‰§è¡Œæƒ…å†µå’Œåé¦ˆï¼Œå¯¹è®¡åˆ’è¿›è¡Œè°ƒæ•´å’Œæ”¹è¿›ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªåˆ¶å®šä¸ªäººç®¡ç†è®¡åˆ’çš„ç¤ºä¾‹ï¼š\nç”¨æˆ·æ•…äº‹ï¼šä½œä¸ºä¸€ä¸ªä¸ªäººï¼Œæˆ‘å¸Œæœ›æé«˜å·¥ä½œæ•ˆç‡å’Œæ—¶é—´ç®¡ç†ï¼Œä»¥æ›´å¥½åœ°å®Œæˆä»»åŠ¡å’Œå¢åŠ å·¥ä½œæˆæœã€‚\nè®¡åˆ’ï¼š\nç”¨æˆ·æ•…äº‹ï¼šä½œä¸ºä¸€ä¸ªä¸ªäººï¼Œæˆ‘å¸Œæœ›è®¾å®šæ˜ç¡®çš„ç›®æ ‡å’Œä¼˜å…ˆçº§ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç®¡ç†æˆ‘çš„ä»»åŠ¡ã€‚ ä»»åŠ¡ 1ï¼šåˆ¶å®šé•¿æœŸç›®æ ‡å’ŒçŸ­æœŸç›®æ ‡ï¼Œå¹¶å°†å…¶è®°å½•åœ¨ä¸ªäººç¬”è®°æœ¬æˆ–ä»»åŠ¡ç®¡ç†å·¥å…·ä¸­ã€‚ ä»»åŠ¡ 2ï¼šä¸ºæ¯ä¸ªç›®æ ‡è®¾å®šä¼˜å…ˆçº§ï¼Œä»¥ç¡®å®šæœ€é‡è¦çš„ä»»åŠ¡å’Œæ´»åŠ¨ã€‚ ç”¨æˆ·æ•…äº‹ï¼šä½œä¸ºä¸€ä¸ªä¸ªäººï¼Œæˆ‘å¸Œæœ›æ”¹å–„æ—¶é—´ç®¡ç†ï¼Œä»¥å……åˆ†åˆ©ç”¨æˆ‘çš„æ—¶é—´ã€‚ ä»»åŠ¡ 1ï¼šåˆ†ææˆ‘çš„æ—¥å¸¸æ—¶é—´åˆ†é…ï¼Œå¹¶è¯†åˆ«æ—¶é—´æµªè´¹çš„åŒºåŸŸã€‚ ä»»åŠ¡ 2ï¼šåˆ¶å®šæ—¶é—´è¡¨æˆ–æ—¥ç¨‹å®‰æ’ï¼Œå°†ä»»åŠ¡å’Œæ´»åŠ¨åˆç†åˆ†é…åˆ°ç‰¹å®šæ—¶é—´æ®µã€‚ ä»»åŠ¡ 3ï¼šå­¦ä¹ å’Œé‡‡ç”¨æ—¶é—´ç®¡ç†æŠ€å·§ï¼Œå¦‚ç•ªèŒ„å·¥ä½œæ³•ï¼ˆPomodoro Techniqueï¼‰æˆ–æ—¶é—´å—ï¼ˆTime Blockingï¼‰ã€‚ ç”¨æˆ·æ•…äº‹ï¼šä½œä¸ºä¸€ä¸ªä¸ªäººï¼Œæˆ‘å¸Œæœ›æé«˜ä¸“æ³¨åŠ›å’Œå‡å°‘å¹²æ‰°ï¼Œä»¥æ›´å¥½åœ°å®Œæˆä»»åŠ¡ã€‚ ä»»åŠ¡ 1ï¼šåˆ›å»ºä¸€ä¸ªæœ‰åˆ©äºä¸“æ³¨çš„å·¥ä½œç¯å¢ƒï¼Œå¦‚æ¸…ç†å·¥ä½œåŒºåŸŸã€å…³é—­æ‰‹æœºé€šçŸ¥æˆ–ä½¿ç”¨ä¸“æ³¨åº”ç”¨ç¨‹åºã€‚ ä»»åŠ¡ 2ï¼šå­¦ä¹ å¹¶ä½¿ç”¨æ³¨æ„åŠ›ç®¡ç†æŠ€å·§ï¼Œå¦‚é›†ä¸­æ³¨æ„åŠ›è®­ç»ƒï¼ˆFocused Attention Trainingï¼‰æˆ–å†¥æƒ³ã€‚ ç”¨æˆ·æ•…äº‹ï¼šä½œä¸ºä¸€ä¸ªä¸ªäººï¼Œæˆ‘å¸Œæœ›ä¿æŒå¥åº·å’Œæé«˜ç²¾åŠ›ï¼Œä»¥æ›´å¥½åœ°åº”å¯¹å·¥ä½œå’Œä»»åŠ¡ã€‚ ä»»åŠ¡ 1ï¼šåˆ¶å®šå¥åº·çš„ç”Ÿæ´»ä¹ æƒ¯ï¼Œå¦‚å®šæœŸé”»ç‚¼ã€å¥åº·é¥®é£Ÿå’Œå……è¶³çš„ç¡çœ ã€‚ ä»»åŠ¡ 2ï¼šå®‰æ’ä¼‘æ¯å’Œæ”¾æ¾çš„æ—¶é—´ï¼Œä»¥é¿å…è¿‡åº¦åŠ³ç´¯å’Œç–²åŠ³ã€‚ ç”¨æˆ·æ•…äº‹ï¼šä½œä¸ºä¸€ä¸ªä¸ªäººï¼Œæˆ‘å¸Œæœ›å®šæœŸè¯„ä¼°å’Œè°ƒæ•´æˆ‘çš„ä¸ªäººç®¡ç†è®¡åˆ’ï¼Œä»¥é€‚åº”å˜åŒ–å’Œæ”¹è¿›æ•ˆæœã€‚ ä»»åŠ¡ 1ï¼šæ¯å‘¨æˆ–æ¯æœˆå›é¡¾æˆ‘çš„ä¸ªäººç®¡ç†è®¡åˆ’ï¼Œå¹¶è®°å½•æˆ‘å–å¾—çš„æˆæœå’Œé‡åˆ°çš„æŒ‘æˆ˜ã€‚ ä»»åŠ¡ 2ï¼šæ ¹æ®åé¦ˆå’Œç»éªŒï¼Œè°ƒæ•´è®¡åˆ’ä¸­çš„ä»»åŠ¡å’Œç­–ç•¥ï¼Œä»¥æ”¹è¿›æ•ˆæœå’Œé€‚åº”æ–°çš„éœ€æ±‚ã€‚ è¿™åªæ˜¯ä¸€ä¸ªç¤ºä¾‹ä¸ªäººç®¡ç†è®¡åˆ’ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚å’Œç›®æ ‡è¿›è¡Œå®šåˆ¶å’Œè°ƒæ•´ã€‚è®°å¾—å°†è®¡åˆ’ä¸­çš„ä»»åŠ¡å…·ä½“åŒ–ã€å¯è¡¡é‡ï¼Œå¹¶é€æ­¥å®æ–½ï¼Œä»¥ç¡®ä¿è®¡åˆ’çš„å¯è¡Œæ€§å’Œæœ‰æ•ˆæ€§ã€‚\né€æ­¥å®æ–½ä¸ªäººç®¡ç†è®¡åˆ’æ˜¯ç¡®ä¿è®¡åˆ’å¯è¡Œæ€§å’Œæœ‰æ•ˆæ€§çš„é‡è¦æ­¥éª¤ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æ–¹æ³•æ¥é€æ­¥å®æ–½ä½ çš„ä¸ªäººç®¡ç†è®¡åˆ’ï¼š\nåˆ¶å®šä¼˜å…ˆçº§ï¼šæ ¹æ®è®¡åˆ’ä¸­çš„ä»»åŠ¡å’Œç›®æ ‡ï¼Œç¡®å®šå®ƒä»¬çš„ä¼˜å…ˆçº§é¡ºåºã€‚å°†é‡è¦ä¸”ç´§æ€¥çš„ä»»åŠ¡æ”¾åœ¨é¦–ä½ï¼Œé€æ­¥å¤„ç†å…¶ä»–ä»»åŠ¡ã€‚ åˆ¶å®šè®¡åˆ’ï¼šä¸ºæ¯ä¸ªä»»åŠ¡åˆ¶å®šå…·ä½“çš„è®¡åˆ’å’Œè¡ŒåŠ¨æ­¥éª¤ã€‚å°†ä»»åŠ¡åˆ†è§£ä¸ºæ›´å°çš„å¯ç®¡ç†çš„å­ä»»åŠ¡ï¼Œå¹¶ä¸ºæ¯ä¸ªå­ä»»åŠ¡è®¾å®šæˆªæ­¢æ—¥æœŸæˆ–æ—¶é—´èŒƒå›´ã€‚ è®¾å®šç›®æ ‡ï¼šä¸ºæ¯ä¸ªä»»åŠ¡è®¾å®šæ˜ç¡®çš„ç›®æ ‡å’Œå¯è¡¡é‡çš„æŒ‡æ ‡ã€‚è¿™æ ·å¯ä»¥æ›´å¥½åœ°è·Ÿè¸ªå’Œè¯„ä¼°ä½ çš„è¿›å±•ã€‚ æ—¶é—´ç®¡ç†ï¼šåˆç†å®‰æ’æ—¶é—´ä»¥å®æ–½è®¡åˆ’ã€‚ä½¿ç”¨æ—¶é—´ç®¡ç†æŠ€å·§ï¼Œå¦‚æ—¶é—´å—ï¼Œå°†ä»»åŠ¡å’Œæ´»åŠ¨åˆ†é…åˆ°ç‰¹å®šçš„æ—¶é—´æ®µï¼Œå¹¶è®¾å®šæ—¶é—´é™åˆ¶ä»¥ä¿æŒä¸“æ³¨å’Œé«˜æ•ˆã€‚ å»ºç«‹ä¹ æƒ¯ï¼šå°†è®¡åˆ’ä¸­çš„ä»»åŠ¡å’Œè¡ŒåŠ¨è½¬åŒ–ä¸ºä¹ æƒ¯ã€‚é‡å¤æ‰§è¡Œä»»åŠ¡å¹¶åšæŒä¸€æ®µæ—¶é—´ï¼Œä»¥å½¢æˆè‰¯å¥½çš„ä¹ æƒ¯ã€‚ ç›‘æ§å’Œè¯„ä¼°ï¼šå®šæœŸç›‘æ§å’Œè¯„ä¼°ä½ çš„è¿›å±•ã€‚æ£€æŸ¥å®Œæˆçš„ä»»åŠ¡ï¼Œè¯„ä¼°æ˜¯å¦è¾¾åˆ°é¢„æœŸçš„ç›®æ ‡å’ŒæŒ‡æ ‡ã€‚æ ¹æ®åé¦ˆå’Œç»éªŒï¼Œè¿›è¡Œè°ƒæ•´å’Œæ”¹è¿›ã€‚ é€‚åº”å˜åŒ–ï¼šçµæ´»åº”å¯¹å˜åŒ–å’Œè°ƒæ•´ã€‚å¦‚æœé‡åˆ°æ–°çš„éœ€æ±‚æˆ–æƒ…å†µï¼Œæ ¹æ®å®é™…æƒ…å†µé‡æ–°å®‰æ’ä»»åŠ¡å’Œä¼˜å…ˆçº§ã€‚ æŒç»­æ”¹è¿›ï¼šæ ¹æ®å®æ–½çš„ç»éªŒå’Œåé¦ˆï¼Œä¸æ–­æ”¹è¿›ä¸ªäººç®¡ç†è®¡åˆ’ã€‚å°è¯•æ–°çš„æ–¹æ³•å’Œç­–ç•¥ï¼Œå¯»æ‰¾æé«˜æ•ˆç‡å’Œæˆæœçš„æœºä¼šã€‚ é€æ­¥å®æ–½ä¸ªäººç®¡ç†è®¡åˆ’éœ€è¦è€å¿ƒå’ŒåšæŒï¼Œä¸€æ­¥ä¸€ä¸ªè„šå°åœ°å®Œæˆæ¯ä¸ªä»»åŠ¡ï¼Œå¹¶é€æ¸æ‰©å¤§å’Œæé«˜ç›®æ ‡çš„èŒƒå›´ã€‚è®°å¾—ç»™è‡ªå·±ä¸€å®šçš„å¼¹æ€§å’Œå®¹é”™ç©ºé—´ï¼Œä»¥é€‚åº”æ„å¤–æƒ…å†µå’ŒæŒ‘æˆ˜ã€‚æœ€é‡è¦çš„æ˜¯ä¿æŒç§¯æçš„æ€åº¦å’ŒåŠ¨åŠ›ï¼Œä¸æ–­åŠªåŠ›å®ç°ä¸ªäººç›®æ ‡å’Œæå‡è‡ªæˆ‘ç®¡ç†èƒ½åŠ›ã€‚","title":"ç”¨æˆ·æ•…äº‹å¦‚ä½•åº”ç”¨åˆ°ä¸ªäººç®¡ç†"},{"content":"å¦‚ä½•æˆä¸ºä¸€ååˆæ ¼çš„æ¶æ„å¸ˆ æˆä¸ºä¸€ååˆæ ¼çš„æ¶æ„å¸ˆéœ€è¦ä¸æ–­å­¦ä¹ å’Œç§¯ç´¯ç»éªŒã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æ­¥éª¤å’Œå»ºè®®ï¼Œå¯ä»¥å¸®åŠ©ä½ æˆä¸ºä¸€ååˆæ ¼çš„æ¶æ„å¸ˆï¼š\nå­¦ä¹ åŸºç¡€çŸ¥è¯†ï¼šå»ºç«‹åšå®çš„è®¡ç®—æœºç§‘å­¦å’Œè½¯ä»¶å·¥ç¨‹åŸºç¡€ï¼ŒåŒ…æ‹¬æ•°æ®ç»“æ„ã€ç®—æ³•ã€æ“ä½œç³»ç»Ÿã€æ•°æ®åº“ç­‰ã€‚æ·±å…¥å­¦ä¹ ç¼–ç¨‹è¯­è¨€å’Œå¼€å‘æŠ€æœ¯ï¼Œäº†è§£ä¸åŒæŠ€æœ¯æ ˆçš„ä¼˜ç¼ºç‚¹ã€‚\nå®è·µé¡¹ç›®å¼€å‘ï¼šé€šè¿‡å‚ä¸å®é™…çš„è½¯ä»¶å¼€å‘é¡¹ç›®ï¼Œç§¯ç´¯é¡¹ç›®ç®¡ç†å’Œå¼€å‘ç»éªŒã€‚äº²èº«ç»å†è½¯ä»¶å¼€å‘çš„å„ä¸ªé˜¶æ®µï¼Œä»éœ€æ±‚åˆ†æåˆ°è®¾è®¡ã€å¼€å‘ã€æµ‹è¯•å’Œéƒ¨ç½²ï¼Œæ·±å…¥äº†è§£è½¯ä»¶å¼€å‘çš„æµç¨‹å’ŒæŒ‘æˆ˜ã€‚\nå­¦ä¹ ç³»ç»Ÿè®¾è®¡å’Œæ¶æ„ï¼šæ·±å…¥å­¦ä¹ ç³»ç»Ÿè®¾è®¡å’Œæ¶æ„çš„ç›¸å…³çŸ¥è¯†ï¼ŒåŒ…æ‹¬æ¶æ„æ¨¡å¼ã€è®¾è®¡åŸåˆ™ã€‚é˜…è¯»ç›¸å…³çš„ä¹¦ç±ã€æ–‡ç« å’ŒæŠ€æœ¯åšå®¢ï¼Œå‚ä¸æ¶æ„è®¾è®¡è®¨è®ºå’Œç¤¾åŒºæ´»åŠ¨ã€‚\nä»¥ä¸‹æ˜¯å…³äºæ¶æ„æ¨¡å¼ã€è®¾è®¡åŸåˆ™å’Œä¸€äº›å¸¸è§æ¶æ„çš„ç®€è¦ä»‹ç»ï¼š\næ¶æ„æ¨¡å¼ï¼š åˆ†å±‚æ¶æ„ï¼ˆLayered Architectureï¼‰ï¼šå°†ç³»ç»Ÿåˆ’åˆ†ä¸ºå¤šä¸ªå±‚æ¬¡ï¼Œæ¯ä¸ªå±‚æ¬¡æœ‰ä¸åŒçš„èŒè´£å’ŒåŠŸèƒ½ï¼Œå®ç°æ¾è€¦åˆå’Œå¯ç»´æŠ¤æ€§ã€‚ å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å¼ï¼ˆClient-Serverï¼‰ï¼šå°†ç³»ç»Ÿåˆ†ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯å‘é€è¯·æ±‚å¹¶æ¥æ”¶å“åº”ï¼ŒæœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶æä¾›æœåŠ¡ã€‚ å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼ˆPublish-Subscribeï¼‰ï¼šåŸºäºäº‹ä»¶çš„æ¨¡å¼ï¼Œå‘å¸ƒè€…å‘å¸ƒäº‹ä»¶ï¼Œè®¢é˜…è€…è®¢é˜…æ„Ÿå…´è¶£çš„äº‹ä»¶ï¼Œå®ç°è§£è€¦å’Œæ‰©å±•æ€§ã€‚ å¾®æœåŠ¡æ¶æ„ï¼ˆMicroservices Architectureï¼‰ï¼šå°†ç³»ç»Ÿæ‹†åˆ†ä¸ºä¸€ç»„å°å‹ã€è‡ªæ²»çš„æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡ä¸“æ³¨äºä¸€ä¸ªç‰¹å®šçš„ä¸šåŠ¡åŠŸèƒ½ï¼Œé€šè¿‡è½»é‡é€šä¿¡åè®®è¿›è¡Œäº¤äº’ã€‚ äº‹ä»¶é©±åŠ¨æ¶æ„ï¼ˆEvent-Driven Architectureï¼‰ï¼šç³»ç»Ÿçš„ç»„æˆéƒ¨åˆ†é€šè¿‡äº‹ä»¶è¿›è¡Œé€šä¿¡å’Œåè°ƒï¼Œäº‹ä»¶çš„å‘ç”Ÿè§¦å‘ç›¸åº”çš„å¤„ç†å’Œååº”ã€‚ è®¾è®¡åŸåˆ™ï¼š å•ä¸€èŒè´£åŸåˆ™ï¼ˆSingle Responsibility Principleï¼‰ï¼šä¸€ä¸ªæ¨¡å—æˆ–ç±»åº”è¯¥æœ‰ä¸”åªæœ‰ä¸€ä¸ªå•ä¸€çš„è´£ä»»ã€‚ å¼€é—­åŸåˆ™ï¼ˆOpen-Closed Principleï¼‰ï¼šè½¯ä»¶å®ä½“åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­ã€‚ é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLiskov Substitution Principleï¼‰ï¼šå­ç±»åº”è¯¥èƒ½å¤Ÿæ›¿æ¢æ‰çˆ¶ç±»ï¼Œå¹¶ä¸”ä¸ä¼šç ´åç¨‹åºçš„æ­£ç¡®æ€§ã€‚ æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface Segregation Principleï¼‰ï¼šä¸åº”è¯¥å¼ºè¿«å®¢æˆ·ç«¯ä¾èµ–äºå®ƒä»¬ä¸éœ€è¦çš„æ¥å£ã€‚ ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDependency Inversion Principleï¼‰ï¼šåº”è¯¥ä¾èµ–äºæŠ½è±¡è€Œä¸æ˜¯å…·ä½“å®ç°ã€‚ å®è·µæ¶æ„è®¾è®¡ï¼šåœ¨å®é™…é¡¹ç›®ä¸­æ‹…ä»»æ¶æ„å¸ˆçš„è§’è‰²ï¼Œè´Ÿè´£ç³»ç»Ÿçš„æ•´ä½“è®¾è®¡å’Œæ¶æ„å†³ç­–ã€‚é€šè¿‡å®è·µä¸­çš„æŒ‘æˆ˜å’Œç»éªŒï¼Œä¸æ–­æå‡è‡ªå·±çš„æ¶æ„è®¾è®¡èƒ½åŠ›ã€‚\nå­¦ä¹ é¢†åŸŸçŸ¥è¯†ï¼šæ ¹æ®è‡ªå·±çš„å…´è¶£å’Œå‘å±•æ–¹å‘ï¼Œæ·±å…¥å­¦ä¹ ç‰¹å®šé¢†åŸŸçš„çŸ¥è¯†ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ åœ¨é‡‘èé¢†åŸŸå·¥ä½œï¼Œäº†è§£é‡‘èç³»ç»Ÿçš„ç‰¹ç‚¹å’Œè¦æ±‚ï¼ŒæŒæ¡ç›¸å…³çš„æŠ€æœ¯å’Œè§£å†³æ–¹æ¡ˆã€‚\nä¸æ–­å­¦ä¹ å’Œè·Ÿè¿›æŠ€æœ¯è¶‹åŠ¿ï¼šä¿æŒå¯¹æ–°æŠ€æœ¯å’Œè¶‹åŠ¿çš„æ•æ„Ÿæ€§ï¼ŒæŒç»­å­¦ä¹ å’Œè·Ÿè¿›è¡Œä¸šçš„æœ€æ–°å‘å±•ã€‚å‚åŠ æŠ€æœ¯ç ”è®¨ä¼šã€åŸ¹è®­è¯¾ç¨‹å’Œè¡Œä¸šä¼šè®®ï¼Œé˜…è¯»æŠ€æœ¯ä¹¦ç±å’Œåšå®¢ï¼Œä¸åŒè¡Œè¿›è¡Œäº¤æµå’Œè®¨è®ºã€‚\nåŸ¹å…»æ²Ÿé€šå’Œé¢†å¯¼èƒ½åŠ›ï¼šä½œä¸ºæ¶æ„å¸ˆï¼Œä¸å›¢é˜Ÿæˆå‘˜ã€ä¸šåŠ¡éƒ¨é—¨å’Œå…¶ä»–åˆ©ç›Šç›¸å…³è€…è¿›è¡Œæœ‰æ•ˆçš„æ²Ÿé€šå’Œåˆä½œéå¸¸é‡è¦ã€‚åŸ¹å…»è‰¯å¥½çš„æ²Ÿé€šå’Œé¢†å¯¼èƒ½åŠ›ï¼Œèƒ½å¤Ÿæ¸…æ™°åœ°è¡¨è¾¾è®¾è®¡æ€æƒ³å’ŒæŠ€æœ¯æ–¹æ¡ˆï¼Œå¹¶åè°ƒå„æ–¹åˆ©ç›Šã€‚\nå¯»æ±‚ mentor æˆ–å‚ä¸æŒ‡å¯¼é¡¹ç›®ï¼šå¯»æ‰¾ç»éªŒä¸°å¯Œçš„æ¶æ„å¸ˆä½œä¸º mentorï¼Œä»ä»–ä»¬é‚£é‡Œè·å¾—æŒ‡å¯¼å’Œå»ºè®®ã€‚å‚ä¸æŒ‡å¯¼æ€§é¡¹ç›®ï¼Œä¸å…¶ä»–æ¶æ„å¸ˆåˆä½œï¼Œå…±åŒè§£å†³å¤æ‚é—®é¢˜ï¼Œå­¦ä¹ ä»–ä»¬çš„è®¾è®¡æ€è·¯å’Œæ–¹æ³•ã€‚\næŒç»­æ”¹è¿›å’Œåæ€ï¼šæŒç»­æ”¹è¿›è‡ªå·±çš„æŠ€æœ¯èƒ½åŠ›å’Œä¸“ä¸šç´ å…»ã€‚å®šæœŸå›é¡¾å’Œåæ€è‡ªå·±çš„è®¾è®¡å†³ç­–å’Œç»éªŒï¼Œå¯»æ‰¾æ”¹è¿›çš„ç©ºé—´ï¼Œå¹¶ä»å¤±è´¥å’ŒæŒ‘æˆ˜ä¸­å¸å–æ•™è®­ã€‚\næœ€é‡è¦çš„æ˜¯ï¼Œæˆä¸ºä¸€ååˆæ ¼çš„æ¶æ„å¸ˆæ˜¯ä¸€ä¸ªæ¸è¿›çš„è¿‡ç¨‹ï¼Œéœ€è¦ä¸æ–­å­¦ä¹ ã€å®è·µå’Œç§¯ç´¯ç»éªŒã€‚é€šè¿‡ä¸æ–­æå‡è‡ªå·±çš„æŠ€æœ¯æ°´å¹³ã€è®¾è®¡èƒ½åŠ›å’Œæ²Ÿé€šèƒ½åŠ›ï¼Œä½ å°†é€æ­¥æˆä¸ºä¸€åä¼˜ç§€çš„æ¶æ„å¸ˆã€‚\næ¶æ„å¸ˆå¿…å¤‡çš„æŠ€èƒ½å’ŒçŸ¥è¯† ä½œä¸ºæ¶æ„å¸ˆï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¿…å¤‡çš„æŠ€èƒ½å’ŒçŸ¥è¯†ï¼š\nç³»ç»Ÿè®¾è®¡å’Œæ¶æ„ï¼šå…·å¤‡å…¨é¢çš„ç³»ç»Ÿè®¾è®¡å’Œæ¶æ„èƒ½åŠ›ï¼Œèƒ½å¤Ÿè®¾è®¡å¯é ã€å¯æ‰©å±•ã€é«˜æ€§èƒ½å’Œå®‰å…¨çš„ç³»ç»Ÿæ¶æ„ã€‚äº†è§£å¸¸ç”¨çš„æ¶æ„æ¨¡å¼å’Œè®¾è®¡åŸåˆ™ï¼Œå¦‚åˆ†å±‚æ¶æ„ã€å¾®æœåŠ¡æ¶æ„ã€äº‹ä»¶é©±åŠ¨æ¶æ„ç­‰ã€‚ ç¼–ç¨‹å’Œå¼€å‘ç»éªŒï¼šå…·å¤‡æ‰å®çš„ç¼–ç¨‹èƒ½åŠ›å’Œå¼€å‘ç»éªŒï¼Œç†Ÿæ‚‰å¤šç§ç¼–ç¨‹è¯­è¨€å’ŒæŠ€æœ¯æ ˆã€‚èƒ½å¤Ÿç†è§£å’Œè¯„ä¼°ä¸åŒæŠ€æœ¯é€‰å‹çš„ä¼˜ç¼ºç‚¹ï¼Œå¹¶åœ¨éœ€è¦æ—¶èƒ½å¤Ÿè¿›è¡ŒåŸå‹å¼€å‘å’Œæ¼”ç¤ºã€‚ åˆ†å¸ƒå¼ç³»ç»Ÿï¼šäº†è§£åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ¦‚å¿µã€åŸç†å’Œå¸¸è§æŒ‘æˆ˜ï¼Œç†Ÿæ‚‰åˆ†å¸ƒå¼è®¡ç®—ã€åˆ†å¸ƒå¼å­˜å‚¨å’Œåˆ†å¸ƒå¼é€šä¿¡ç­‰ç›¸å…³æŠ€æœ¯ã€‚èƒ½å¤Ÿè®¾è®¡å’Œä¼˜åŒ–åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ¶æ„ï¼Œè§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä¸€è‡´æ€§ã€å®¹é”™å’Œæ€§èƒ½é—®é¢˜ã€‚ æ€§èƒ½ä¼˜åŒ–å’Œè°ƒä¼˜ï¼šå…·å¤‡æ€§èƒ½ä¼˜åŒ–å’Œè°ƒä¼˜çš„ç»éªŒï¼Œèƒ½å¤Ÿåˆ†æå’Œè§£å†³ç³»ç»Ÿæ€§èƒ½ç“¶é¢ˆã€‚ç†Ÿæ‚‰æ€§èƒ½æµ‹è¯•å·¥å…·å’Œæ€§èƒ½ç›‘æ§å·¥å…·ï¼Œèƒ½å¤Ÿè®¾è®¡å’Œå®æ–½æ€§èƒ½æµ‹è¯•è®¡åˆ’ï¼Œå¹¶æå‡ºç›¸åº”çš„ä¼˜åŒ–å»ºè®®ã€‚ å®‰å…¨è®¾è®¡å’Œé˜²å¾¡ï¼šå…·å¤‡ç³»ç»Ÿå®‰å…¨è®¾è®¡å’Œé˜²å¾¡çš„èƒ½åŠ›ï¼Œäº†è§£å¸¸è§çš„å®‰å…¨å¨èƒå’Œæ”»å‡»æ–¹å¼ï¼Œèƒ½å¤Ÿè®¾è®¡å’Œå®æ–½å®‰å…¨ç­–ç•¥å’Œæªæ–½ï¼Œç¡®ä¿ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œæ•°æ®çš„ä¿å¯†æ€§ã€‚ æ•°æ®åº“å’Œå­˜å‚¨ç³»ç»Ÿï¼šç†Ÿæ‚‰å„ç§æ•°æ®åº“å’Œå­˜å‚¨ç³»ç»Ÿçš„åŸç†å’Œä½¿ç”¨ï¼ŒåŒ…æ‹¬å…³ç³»å‹æ•°æ®åº“ã€NoSQL æ•°æ®åº“ã€ç¼“å­˜ç³»ç»Ÿç­‰ã€‚èƒ½å¤Ÿè¿›è¡Œæ•°æ®åº“è®¾è®¡å’Œä¼˜åŒ–ï¼Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å’Œå¯é æ€§ã€‚ äº‘è®¡ç®—å’Œå®¹å™¨æŠ€æœ¯ï¼šäº†è§£äº‘è®¡ç®—å’Œå®¹å™¨æŠ€æœ¯çš„æ¦‚å¿µå’ŒåŸºæœ¬åŸç†ï¼ŒåŒ…æ‹¬è™šæ‹ŸåŒ–ã€å®¹å™¨åŒ–ã€è‡ªåŠ¨åŒ–éƒ¨ç½²ç­‰ã€‚èƒ½å¤Ÿè®¾è®¡å’Œéƒ¨ç½²åŸºäºäº‘è®¡ç®—å’Œå®¹å™¨æŠ€æœ¯çš„ç³»ç»Ÿæ¶æ„ï¼Œå¦‚ä½¿ç”¨ Dockerã€Kubernetes ç­‰ã€‚ æ¶ˆæ¯é˜Ÿåˆ—å’Œäº‹ä»¶é©±åŠ¨ï¼šç†Ÿæ‚‰æ¶ˆæ¯é˜Ÿåˆ—å’Œäº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œäº†è§£æ¶ˆæ¯ä¸­é—´ä»¶çš„é€‰æ‹©å’Œä½¿ç”¨ã€‚èƒ½å¤Ÿè®¾è®¡å’Œå®ç°åŸºäºæ¶ˆæ¯é˜Ÿåˆ—å’Œäº‹ä»¶é©±åŠ¨çš„ç³»ç»Ÿï¼Œå®ç°æ¾è€¦åˆå’Œå¯æ‰©å±•æ€§ã€‚ é«˜å¯ç”¨å’Œå®¹é”™è®¾è®¡ï¼šèƒ½å¤Ÿè®¾è®¡å’Œå®ç°é«˜å¯ç”¨å’Œå®¹é”™çš„ç³»ç»Ÿæ¶æ„ï¼ŒåŒ…æ‹¬æ•…éšœæ¢å¤ã€è´Ÿè½½å‡è¡¡ã€å®¹ç¾å’Œå¤‡ä»½ç­–ç•¥ç­‰ã€‚äº†è§£åˆ†å¸ƒå¼ä¸€è‡´æ€§å’Œå®¹é”™ç®—æ³•ï¼Œå¦‚ Paxosã€Raft ç­‰ã€‚ æ²Ÿé€šå’Œé¢†å¯¼èƒ½åŠ›ï¼šä½œä¸ºæ¶æ„å¸ˆï¼Œéœ€è¦å…·å¤‡è‰¯å¥½çš„æ²Ÿé€šå’Œé¢†å¯¼èƒ½åŠ›ã€‚èƒ½å¤Ÿä¸å›¢é˜Ÿæˆå‘˜ã€ä¸šåŠ¡éƒ¨é—¨å’Œå…¶ä»–åˆ©ç›Šç›¸å…³è€…è¿›è¡Œæœ‰æ•ˆçš„æ²Ÿé€šå’Œåˆä½œï¼Œæ¨åŠ¨é¡¹ç›®çš„é¡ºåˆ©è¿›è¡Œã€‚ è¿™äº›æŠ€èƒ½å’ŒçŸ¥è¯†å°†å¸®åŠ©æ¶æ„å¸ˆåœ¨è®¾è®¡å’Œæ„å»ºå¤æ‚ç³»ç»Ÿæ—¶åšå‡ºæ˜æ™ºçš„å†³ç­–ï¼Œå¹¶ç¡®ä¿ç³»ç»Ÿçš„å¯é æ€§ã€å¯æ‰©å±•æ€§å’Œæ€§èƒ½ã€‚æ­¤å¤–ï¼Œæ¶æ„å¸ˆè¿˜åº”ä¸æ–­å­¦ä¹ å’Œä¿æŒå¯¹æ–°æŠ€æœ¯å’Œè¶‹åŠ¿çš„æ•æ„Ÿæ€§ï¼Œä»¥ä¿æŒåœ¨æŠ€æœ¯é¢†åŸŸçš„ç«äº‰åŠ›ã€‚\næ¶æ„å¸ˆå­¦ä¹ è·¯çº¿å›¾ ä½œä¸ºæ¶æ„å¸ˆï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªå¯èƒ½çš„å­¦ä¹ è·¯çº¿å›¾ï¼Œå¯ä»¥å¸®åŠ©ä½ ç³»ç»Ÿåœ°å­¦ä¹ å’Œå‘å±•æ¶æ„å¸ˆçš„æŠ€èƒ½ï¼š\nåŸºç¡€çŸ¥è¯†ï¼š å­¦ä¹ è½¯ä»¶å¼€å‘åŸºç¡€çŸ¥è¯†ï¼ŒåŒ…æ‹¬ç¼–ç¨‹è¯­è¨€ã€æ•°æ®ç»“æ„å’Œç®—æ³•ç­‰ã€‚ ç†è§£è½¯ä»¶å¼€å‘æµç¨‹å’Œå¸¸ç”¨å¼€å‘æ–¹æ³•ï¼Œå¦‚æ•æ·å¼€å‘å’Œ DevOpsã€‚ å­¦ä¹ é¢å‘å¯¹è±¡è®¾è®¡å’Œè®¾è®¡æ¨¡å¼ã€‚ æ¶æ„è®¾è®¡åŸºç¡€ï¼š å­¦ä¹ è½¯ä»¶æ¶æ„çš„åŸºæœ¬æ¦‚å¿µã€åŸåˆ™å’Œæ¨¡å¼ã€‚ ç ”ç©¶å’Œç†è§£å¸¸è§çš„æ¶æ„æ¨¡å¼ï¼Œå¦‚åˆ†å±‚æ¶æ„ã€å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å¼å’Œå‘å¸ƒ-è®¢é˜…æ¨¡å¼ç­‰ã€‚ æŒæ¡è®¾è®¡åŸåˆ™ï¼Œå¦‚å•ä¸€èŒè´£åŸåˆ™ã€å¼€é—­åŸåˆ™å’Œä¾èµ–å€’ç½®åŸåˆ™ç­‰ã€‚ æ·±å…¥å­¦ä¹ æ¶æ„æ¨¡å¼å’ŒæŠ€æœ¯ï¼š å­¦ä¹ å¾®æœåŠ¡æ¶æ„çš„åŸç†ã€è®¾è®¡å’Œå®æ–½ã€‚ ç ”ç©¶äº‹ä»¶é©±åŠ¨æ¶æ„å’Œæ¶ˆæ¯é˜Ÿåˆ—çš„ä½¿ç”¨ã€‚ æ¢ç´¢å¤§æ•°æ®æ¶æ„å’Œåˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ã€‚ äº†è§£å®¹å™¨åŒ–å’Œå®¹å™¨ç¼–æ’æŠ€æœ¯ï¼Œå¦‚ Docker å’Œ Kubernetesã€‚ å®è·µå’Œé¡¹ç›®ç»éªŒï¼š å‚ä¸å®é™…é¡¹ç›®ï¼Œä»ä¸­å­¦ä¹ æ¶æ„è®¾è®¡å’Œå®æ–½çš„ç»éªŒã€‚ å°è¯•è®¾è®¡å’Œå¼€å‘è‡ªå·±çš„å°å‹é¡¹ç›®ï¼Œå®è·µæ¶æ„è®¾è®¡å’Œè§£å†³å®é™…é—®é¢˜ã€‚ å‚ä¸å¼€æºé¡¹ç›®æˆ–è´¡çŒ®ï¼Œä¸å…¶ä»–æ¶æ„å¸ˆäº¤æµå’Œåˆ†äº«ç»éªŒã€‚ æŒç»­å­¦ä¹ å’Œå‘å±•ï¼š å…³æ³¨è¡Œä¸šè¶‹åŠ¿å’Œæ–°å…´æŠ€æœ¯ï¼Œå¦‚äººå·¥æ™ºèƒ½ã€ç‰©è”ç½‘å’ŒåŒºå—é“¾ç­‰ã€‚ å‚åŠ æ¶æ„å¸ˆåŸ¹è®­å’Œè®¤è¯è¯¾ç¨‹ï¼Œå¦‚ TOGAFã€AWS Certified Solutions Architect ç­‰ã€‚ å‚ä¸æ¶æ„å¸ˆç¤¾åŒºå’Œè®ºå›ï¼Œä¸å…¶ä»–ä¸“ä¸šäººå£«äº¤æµå’Œå­¦ä¹ ã€‚ è¯·æ³¨æ„ï¼Œè¿™åªæ˜¯ä¸€ä¸ªç¤ºä¾‹å­¦ä¹ è·¯çº¿å›¾ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„å…´è¶£ã€ç›®æ ‡å’Œå®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´å’Œæ‰©å±•ã€‚é‡è¦çš„æ˜¯ä¿æŒæŒç»­å­¦ä¹ å’Œä¸æ–­å®è·µï¼Œé€šè¿‡å®é™…é¡¹ç›®å’Œç»éªŒæ¥æå‡è‡ªå·±çš„æ¶æ„å¸ˆæŠ€èƒ½ã€‚\næ¶æ„å¸ˆå­¦ä¹ èµ„æº ä»¥ä¸‹æ˜¯ä¸€äº›å…³äºç³»ç»Ÿè®¾è®¡å’Œæ¶æ„çš„ç»å…¸ä¹¦ç±ï¼š\nã€Šè½¯ä»¶æ¶æ„å®è·µã€‹ï¼ˆSoftware Architecture in Practiceï¼‰ - Len Bassã€Paul Clementsã€Rick Kazman ã€Šå¤§è§„æ¨¡åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿã€‹ï¼ˆDesigning Data-Intensive Applicationsï¼‰ - Martin Kleppmann ã€Šä¼ä¸šé›†æˆæ¨¡å¼ã€‹ï¼ˆEnterprise Integration Patternsï¼‰ - Gregor Hohpeã€Bobby Woolf ã€Šæ¶æ„ä¹‹ç¾ã€‹ï¼ˆBeautiful Architectureï¼‰ - Diomidis Spinellisã€Georgios Gousios ã€Šæ¶æ„è®¾è®¡åŸåˆ™ã€‹ï¼ˆThe Art of Software Architecture: Design Methods and Techniquesï¼‰ - Stephen T. Albinã€Wei-Tek Tsai ã€Šé¢†åŸŸé©±åŠ¨è®¾è®¡ã€‹ï¼ˆDomain-Driven Design: Tackling Complexity in the Heart of Softwareï¼‰ - Eric Evans ã€Šç³»ç»Ÿæ¶æ„è®¾è®¡å¸ˆçš„æŒ‡å—ã€‹ï¼ˆA Practical Guide to SysML: The Systems Modeling Languageï¼‰ - Sanford Friedenthalã€Alan Mooreã€Rick Steiner ã€Šå¾®æœåŠ¡è®¾è®¡ã€‹ï¼ˆBuilding Microservicesï¼‰ - Sam Newman ã€Šè®¾è®¡æ•°æ®å¯†é›†å‹åº”ç”¨ã€‹ï¼ˆDesigning Data-Intensive Applicationsï¼‰ - Martin Kleppmann ã€Šæ¨¡å¼è¯­è¨€ã€‹ï¼ˆPattern-Oriented Software Architecture: A System of Patternsï¼‰ - Frank Buschmannã€Regine Meunierã€Hans Rohnertã€Peter Sommerladã€Michael Stal è¿™äº›ä¹¦ç±æ¶µç›–äº†ç³»ç»Ÿè®¾è®¡å’Œæ¶æ„çš„ä¸åŒæ–¹é¢ï¼Œä»åŸºæœ¬åŸç†åˆ°å®è·µæŒ‡å—éƒ½æœ‰æ‰€æ¶‰åŠã€‚é€šè¿‡é˜…è¯»è¿™äº›ä¹¦ç±ï¼Œä½ å¯ä»¥æ·±å…¥äº†è§£ç³»ç»Ÿè®¾è®¡å’Œæ¶æ„çš„æ¦‚å¿µã€åŸåˆ™å’Œæœ€ä½³å®è·µï¼Œå¹¶ä»å®é™…æ¡ˆä¾‹ä¸­å­¦ä¹ ã€‚è®°ä½ï¼Œå®è·µæ˜¯æå‡æ¶æ„èƒ½åŠ›çš„å…³é”®ï¼Œæ‰€ä»¥åœ¨é˜…è¯»çš„åŒæ—¶ï¼Œå°½é‡å°†æ‰€å­¦åº”ç”¨åˆ°å®é™…é¡¹ç›®ä¸­ã€‚\nä»¥ä¸‹æ˜¯ä¸€äº›å…³äºç³»ç»Ÿè®¾è®¡å’Œæ¶æ„çš„åœ¨çº¿èµ„æºï¼ŒåŒ…æ‹¬åšå®¢ã€ç½‘ç«™å’Œåœ¨çº¿è¯¾ç¨‹ï¼š\næ¶æ„å¸ˆåšå®¢å’Œæ–‡ç« ï¼š Martin Fowler\u0026rsquo;s Blog: https://martinfowler.com/ ThoughtWorks Insights: https://www.thoughtworks.com/insights InfoQ Architecture \u0026amp; Design: https://www.infoq.com/architecture-design/ High Scalability: http://highscalability.com/ æ¶æ„å¸ˆç¤¾åŒºå’Œè®ºå›ï¼š Reddit /r/SoftwareArchitecture: https://www.reddit.com/r/SoftwareArchitecture/ Stack Exchange - Software Engineering: https://softwareengineering.stackexchange.com/ åœ¨çº¿è¯¾ç¨‹å’Œå­¦ä¹ å¹³å°ï¼š Coursera: æœ‰è®¸å¤šä¸è½¯ä»¶æ¶æ„å’Œç³»ç»Ÿè®¾è®¡ç›¸å…³çš„è¯¾ç¨‹ï¼Œå¦‚ã€ŠSoftware Architecture for the Internet of Thingsã€‹ã€ã€ŠSoftware Design and Architecture Specializationã€‹ç­‰ã€‚ Udemy: æä¾›å¹¿æ³›çš„ç³»ç»Ÿè®¾è®¡å’Œæ¶æ„è¯¾ç¨‹ï¼Œå¦‚ã€ŠSoftware Architecture: Complete Guideã€‹ã€ã€ŠMicroservices Architecture and Designã€‹ç­‰ã€‚ edX: æœ‰ä¸€äº›ä¸è½¯ä»¶æ¶æ„å’Œç³»ç»Ÿè®¾è®¡ç›¸å…³çš„è¯¾ç¨‹ï¼Œå¦‚ã€ŠSoftware Construction and Architectureã€‹ç­‰ã€‚ æ¶æ„æ¨¡å¼å’Œè®¾è®¡æ¨¡å¼ï¼š Martin Fowler\u0026rsquo;s Patterns of Enterprise Application Architecture: https://martinfowler.com/eaaCatalog/ Design Patterns by the Gang of Four: https://sourcemaking.com/design_patterns è¿™äº›èµ„æºæä¾›äº†å¹¿æ³›çš„æ¶æ„è®¾è®¡å’Œç³»ç»Ÿè®¾è®¡çš„å†…å®¹å’Œè®¨è®ºï¼Œä½ å¯ä»¥é€šè¿‡é˜…è¯»æ–‡ç« ã€å‚ä¸ç¤¾åŒºè®¨è®ºå’Œå®Œæˆåœ¨çº¿è¯¾ç¨‹æ¥åŠ æ·±å¯¹ç³»ç»Ÿè®¾è®¡å’Œæ¶æ„çš„ç†è§£ã€‚åŒæ—¶ï¼Œä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„å…´è¶£å’Œéœ€æ±‚ï¼Œè¿›ä¸€æ­¥æ¢ç´¢å…¶ä»–ç›¸å…³èµ„æºã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/08/21/architecture/","summary":"å¦‚ä½•æˆä¸ºä¸€ååˆæ ¼çš„æ¶æ„å¸ˆ æˆä¸ºä¸€ååˆæ ¼çš„æ¶æ„å¸ˆéœ€è¦ä¸æ–­å­¦ä¹ å’Œç§¯ç´¯ç»éªŒã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æ­¥éª¤å’Œå»ºè®®ï¼Œå¯ä»¥å¸®åŠ©ä½ æˆä¸ºä¸€ååˆæ ¼çš„æ¶æ„å¸ˆï¼š\nå­¦ä¹ åŸºç¡€çŸ¥è¯†ï¼šå»ºç«‹åšå®çš„è®¡ç®—æœºç§‘å­¦å’Œè½¯ä»¶å·¥ç¨‹åŸºç¡€ï¼ŒåŒ…æ‹¬æ•°æ®ç»“æ„ã€ç®—æ³•ã€æ“ä½œç³»ç»Ÿã€æ•°æ®åº“ç­‰ã€‚æ·±å…¥å­¦ä¹ ç¼–ç¨‹è¯­è¨€å’Œå¼€å‘æŠ€æœ¯ï¼Œäº†è§£ä¸åŒæŠ€æœ¯æ ˆçš„ä¼˜ç¼ºç‚¹ã€‚\nå®è·µé¡¹ç›®å¼€å‘ï¼šé€šè¿‡å‚ä¸å®é™…çš„è½¯ä»¶å¼€å‘é¡¹ç›®ï¼Œç§¯ç´¯é¡¹ç›®ç®¡ç†å’Œå¼€å‘ç»éªŒã€‚äº²èº«ç»å†è½¯ä»¶å¼€å‘çš„å„ä¸ªé˜¶æ®µï¼Œä»éœ€æ±‚åˆ†æåˆ°è®¾è®¡ã€å¼€å‘ã€æµ‹è¯•å’Œéƒ¨ç½²ï¼Œæ·±å…¥äº†è§£è½¯ä»¶å¼€å‘çš„æµç¨‹å’ŒæŒ‘æˆ˜ã€‚\nå­¦ä¹ ç³»ç»Ÿè®¾è®¡å’Œæ¶æ„ï¼šæ·±å…¥å­¦ä¹ ç³»ç»Ÿè®¾è®¡å’Œæ¶æ„çš„ç›¸å…³çŸ¥è¯†ï¼ŒåŒ…æ‹¬æ¶æ„æ¨¡å¼ã€è®¾è®¡åŸåˆ™ã€‚é˜…è¯»ç›¸å…³çš„ä¹¦ç±ã€æ–‡ç« å’ŒæŠ€æœ¯åšå®¢ï¼Œå‚ä¸æ¶æ„è®¾è®¡è®¨è®ºå’Œç¤¾åŒºæ´»åŠ¨ã€‚\nä»¥ä¸‹æ˜¯å…³äºæ¶æ„æ¨¡å¼ã€è®¾è®¡åŸåˆ™å’Œä¸€äº›å¸¸è§æ¶æ„çš„ç®€è¦ä»‹ç»ï¼š\næ¶æ„æ¨¡å¼ï¼š åˆ†å±‚æ¶æ„ï¼ˆLayered Architectureï¼‰ï¼šå°†ç³»ç»Ÿåˆ’åˆ†ä¸ºå¤šä¸ªå±‚æ¬¡ï¼Œæ¯ä¸ªå±‚æ¬¡æœ‰ä¸åŒçš„èŒè´£å’ŒåŠŸèƒ½ï¼Œå®ç°æ¾è€¦åˆå’Œå¯ç»´æŠ¤æ€§ã€‚ å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å¼ï¼ˆClient-Serverï¼‰ï¼šå°†ç³»ç»Ÿåˆ†ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯å‘é€è¯·æ±‚å¹¶æ¥æ”¶å“åº”ï¼ŒæœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶æä¾›æœåŠ¡ã€‚ å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼ˆPublish-Subscribeï¼‰ï¼šåŸºäºäº‹ä»¶çš„æ¨¡å¼ï¼Œå‘å¸ƒè€…å‘å¸ƒäº‹ä»¶ï¼Œè®¢é˜…è€…è®¢é˜…æ„Ÿå…´è¶£çš„äº‹ä»¶ï¼Œå®ç°è§£è€¦å’Œæ‰©å±•æ€§ã€‚ å¾®æœåŠ¡æ¶æ„ï¼ˆMicroservices Architectureï¼‰ï¼šå°†ç³»ç»Ÿæ‹†åˆ†ä¸ºä¸€ç»„å°å‹ã€è‡ªæ²»çš„æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡ä¸“æ³¨äºä¸€ä¸ªç‰¹å®šçš„ä¸šåŠ¡åŠŸèƒ½ï¼Œé€šè¿‡è½»é‡é€šä¿¡åè®®è¿›è¡Œäº¤äº’ã€‚ äº‹ä»¶é©±åŠ¨æ¶æ„ï¼ˆEvent-Driven Architectureï¼‰ï¼šç³»ç»Ÿçš„ç»„æˆéƒ¨åˆ†é€šè¿‡äº‹ä»¶è¿›è¡Œé€šä¿¡å’Œåè°ƒï¼Œäº‹ä»¶çš„å‘ç”Ÿè§¦å‘ç›¸åº”çš„å¤„ç†å’Œååº”ã€‚ è®¾è®¡åŸåˆ™ï¼š å•ä¸€èŒè´£åŸåˆ™ï¼ˆSingle Responsibility Principleï¼‰ï¼šä¸€ä¸ªæ¨¡å—æˆ–ç±»åº”è¯¥æœ‰ä¸”åªæœ‰ä¸€ä¸ªå•ä¸€çš„è´£ä»»ã€‚ å¼€é—­åŸåˆ™ï¼ˆOpen-Closed Principleï¼‰ï¼šè½¯ä»¶å®ä½“åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­ã€‚ é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLiskov Substitution Principleï¼‰ï¼šå­ç±»åº”è¯¥èƒ½å¤Ÿæ›¿æ¢æ‰çˆ¶ç±»ï¼Œå¹¶ä¸”ä¸ä¼šç ´åç¨‹åºçš„æ­£ç¡®æ€§ã€‚ æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface Segregation Principleï¼‰ï¼šä¸åº”è¯¥å¼ºè¿«å®¢æˆ·ç«¯ä¾èµ–äºå®ƒä»¬ä¸éœ€è¦çš„æ¥å£ã€‚ ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDependency Inversion Principleï¼‰ï¼šåº”è¯¥ä¾èµ–äºæŠ½è±¡è€Œä¸æ˜¯å…·ä½“å®ç°ã€‚ å®è·µæ¶æ„è®¾è®¡ï¼šåœ¨å®é™…é¡¹ç›®ä¸­æ‹…ä»»æ¶æ„å¸ˆçš„è§’è‰²ï¼Œè´Ÿè´£ç³»ç»Ÿçš„æ•´ä½“è®¾è®¡å’Œæ¶æ„å†³ç­–ã€‚é€šè¿‡å®è·µä¸­çš„æŒ‘æˆ˜å’Œç»éªŒï¼Œä¸æ–­æå‡è‡ªå·±çš„æ¶æ„è®¾è®¡èƒ½åŠ›ã€‚\nå­¦ä¹ é¢†åŸŸçŸ¥è¯†ï¼šæ ¹æ®è‡ªå·±çš„å…´è¶£å’Œå‘å±•æ–¹å‘ï¼Œæ·±å…¥å­¦ä¹ ç‰¹å®šé¢†åŸŸçš„çŸ¥è¯†ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ åœ¨é‡‘èé¢†åŸŸå·¥ä½œï¼Œäº†è§£é‡‘èç³»ç»Ÿçš„ç‰¹ç‚¹å’Œè¦æ±‚ï¼ŒæŒæ¡ç›¸å…³çš„æŠ€æœ¯å’Œè§£å†³æ–¹æ¡ˆã€‚\nä¸æ–­å­¦ä¹ å’Œè·Ÿè¿›æŠ€æœ¯è¶‹åŠ¿ï¼šä¿æŒå¯¹æ–°æŠ€æœ¯å’Œè¶‹åŠ¿çš„æ•æ„Ÿæ€§ï¼ŒæŒç»­å­¦ä¹ å’Œè·Ÿè¿›è¡Œä¸šçš„æœ€æ–°å‘å±•ã€‚å‚åŠ æŠ€æœ¯ç ”è®¨ä¼šã€åŸ¹è®­è¯¾ç¨‹å’Œè¡Œä¸šä¼šè®®ï¼Œé˜…è¯»æŠ€æœ¯ä¹¦ç±å’Œåšå®¢ï¼Œä¸åŒè¡Œè¿›è¡Œäº¤æµå’Œè®¨è®ºã€‚\nåŸ¹å…»æ²Ÿé€šå’Œé¢†å¯¼èƒ½åŠ›ï¼šä½œä¸ºæ¶æ„å¸ˆï¼Œä¸å›¢é˜Ÿæˆå‘˜ã€ä¸šåŠ¡éƒ¨é—¨å’Œå…¶ä»–åˆ©ç›Šç›¸å…³è€…è¿›è¡Œæœ‰æ•ˆçš„æ²Ÿé€šå’Œåˆä½œéå¸¸é‡è¦ã€‚åŸ¹å…»è‰¯å¥½çš„æ²Ÿé€šå’Œé¢†å¯¼èƒ½åŠ›ï¼Œèƒ½å¤Ÿæ¸…æ™°åœ°è¡¨è¾¾è®¾è®¡æ€æƒ³å’ŒæŠ€æœ¯æ–¹æ¡ˆï¼Œå¹¶åè°ƒå„æ–¹åˆ©ç›Šã€‚\nå¯»æ±‚ mentor æˆ–å‚ä¸æŒ‡å¯¼é¡¹ç›®ï¼šå¯»æ‰¾ç»éªŒä¸°å¯Œçš„æ¶æ„å¸ˆä½œä¸º mentorï¼Œä»ä»–ä»¬é‚£é‡Œè·å¾—æŒ‡å¯¼å’Œå»ºè®®ã€‚å‚ä¸æŒ‡å¯¼æ€§é¡¹ç›®ï¼Œä¸å…¶ä»–æ¶æ„å¸ˆåˆä½œï¼Œå…±åŒè§£å†³å¤æ‚é—®é¢˜ï¼Œå­¦ä¹ ä»–ä»¬çš„è®¾è®¡æ€è·¯å’Œæ–¹æ³•ã€‚\næŒç»­æ”¹è¿›å’Œåæ€ï¼šæŒç»­æ”¹è¿›è‡ªå·±çš„æŠ€æœ¯èƒ½åŠ›å’Œä¸“ä¸šç´ å…»ã€‚å®šæœŸå›é¡¾å’Œåæ€è‡ªå·±çš„è®¾è®¡å†³ç­–å’Œç»éªŒï¼Œå¯»æ‰¾æ”¹è¿›çš„ç©ºé—´ï¼Œå¹¶ä»å¤±è´¥å’ŒæŒ‘æˆ˜ä¸­å¸å–æ•™è®­ã€‚\næœ€é‡è¦çš„æ˜¯ï¼Œæˆä¸ºä¸€ååˆæ ¼çš„æ¶æ„å¸ˆæ˜¯ä¸€ä¸ªæ¸è¿›çš„è¿‡ç¨‹ï¼Œéœ€è¦ä¸æ–­å­¦ä¹ ã€å®è·µå’Œç§¯ç´¯ç»éªŒã€‚é€šè¿‡ä¸æ–­æå‡è‡ªå·±çš„æŠ€æœ¯æ°´å¹³ã€è®¾è®¡èƒ½åŠ›å’Œæ²Ÿé€šèƒ½åŠ›ï¼Œä½ å°†é€æ­¥æˆä¸ºä¸€åä¼˜ç§€çš„æ¶æ„å¸ˆã€‚\næ¶æ„å¸ˆå¿…å¤‡çš„æŠ€èƒ½å’ŒçŸ¥è¯† ä½œä¸ºæ¶æ„å¸ˆï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¿…å¤‡çš„æŠ€èƒ½å’ŒçŸ¥è¯†ï¼š\nç³»ç»Ÿè®¾è®¡å’Œæ¶æ„ï¼šå…·å¤‡å…¨é¢çš„ç³»ç»Ÿè®¾è®¡å’Œæ¶æ„èƒ½åŠ›ï¼Œèƒ½å¤Ÿè®¾è®¡å¯é ã€å¯æ‰©å±•ã€é«˜æ€§èƒ½å’Œå®‰å…¨çš„ç³»ç»Ÿæ¶æ„ã€‚äº†è§£å¸¸ç”¨çš„æ¶æ„æ¨¡å¼å’Œè®¾è®¡åŸåˆ™ï¼Œå¦‚åˆ†å±‚æ¶æ„ã€å¾®æœåŠ¡æ¶æ„ã€äº‹ä»¶é©±åŠ¨æ¶æ„ç­‰ã€‚ ç¼–ç¨‹å’Œå¼€å‘ç»éªŒï¼šå…·å¤‡æ‰å®çš„ç¼–ç¨‹èƒ½åŠ›å’Œå¼€å‘ç»éªŒï¼Œç†Ÿæ‚‰å¤šç§ç¼–ç¨‹è¯­è¨€å’ŒæŠ€æœ¯æ ˆã€‚èƒ½å¤Ÿç†è§£å’Œè¯„ä¼°ä¸åŒæŠ€æœ¯é€‰å‹çš„ä¼˜ç¼ºç‚¹ï¼Œå¹¶åœ¨éœ€è¦æ—¶èƒ½å¤Ÿè¿›è¡ŒåŸå‹å¼€å‘å’Œæ¼”ç¤ºã€‚ åˆ†å¸ƒå¼ç³»ç»Ÿï¼šäº†è§£åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ¦‚å¿µã€åŸç†å’Œå¸¸è§æŒ‘æˆ˜ï¼Œç†Ÿæ‚‰åˆ†å¸ƒå¼è®¡ç®—ã€åˆ†å¸ƒå¼å­˜å‚¨å’Œåˆ†å¸ƒå¼é€šä¿¡ç­‰ç›¸å…³æŠ€æœ¯ã€‚èƒ½å¤Ÿè®¾è®¡å’Œä¼˜åŒ–åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ¶æ„ï¼Œè§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä¸€è‡´æ€§ã€å®¹é”™å’Œæ€§èƒ½é—®é¢˜ã€‚ æ€§èƒ½ä¼˜åŒ–å’Œè°ƒä¼˜ï¼šå…·å¤‡æ€§èƒ½ä¼˜åŒ–å’Œè°ƒä¼˜çš„ç»éªŒï¼Œèƒ½å¤Ÿåˆ†æå’Œè§£å†³ç³»ç»Ÿæ€§èƒ½ç“¶é¢ˆã€‚ç†Ÿæ‚‰æ€§èƒ½æµ‹è¯•å·¥å…·å’Œæ€§èƒ½ç›‘æ§å·¥å…·ï¼Œèƒ½å¤Ÿè®¾è®¡å’Œå®æ–½æ€§èƒ½æµ‹è¯•è®¡åˆ’ï¼Œå¹¶æå‡ºç›¸åº”çš„ä¼˜åŒ–å»ºè®®ã€‚ å®‰å…¨è®¾è®¡å’Œé˜²å¾¡ï¼šå…·å¤‡ç³»ç»Ÿå®‰å…¨è®¾è®¡å’Œé˜²å¾¡çš„èƒ½åŠ›ï¼Œäº†è§£å¸¸è§çš„å®‰å…¨å¨èƒå’Œæ”»å‡»æ–¹å¼ï¼Œèƒ½å¤Ÿè®¾è®¡å’Œå®æ–½å®‰å…¨ç­–ç•¥å’Œæªæ–½ï¼Œç¡®ä¿ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œæ•°æ®çš„ä¿å¯†æ€§ã€‚ æ•°æ®åº“å’Œå­˜å‚¨ç³»ç»Ÿï¼šç†Ÿæ‚‰å„ç§æ•°æ®åº“å’Œå­˜å‚¨ç³»ç»Ÿçš„åŸç†å’Œä½¿ç”¨ï¼ŒåŒ…æ‹¬å…³ç³»å‹æ•°æ®åº“ã€NoSQL æ•°æ®åº“ã€ç¼“å­˜ç³»ç»Ÿç­‰ã€‚èƒ½å¤Ÿè¿›è¡Œæ•°æ®åº“è®¾è®¡å’Œä¼˜åŒ–ï¼Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å’Œå¯é æ€§ã€‚ äº‘è®¡ç®—å’Œå®¹å™¨æŠ€æœ¯ï¼šäº†è§£äº‘è®¡ç®—å’Œå®¹å™¨æŠ€æœ¯çš„æ¦‚å¿µå’ŒåŸºæœ¬åŸç†ï¼ŒåŒ…æ‹¬è™šæ‹ŸåŒ–ã€å®¹å™¨åŒ–ã€è‡ªåŠ¨åŒ–éƒ¨ç½²ç­‰ã€‚èƒ½å¤Ÿè®¾è®¡å’Œéƒ¨ç½²åŸºäºäº‘è®¡ç®—å’Œå®¹å™¨æŠ€æœ¯çš„ç³»ç»Ÿæ¶æ„ï¼Œå¦‚ä½¿ç”¨ Dockerã€Kubernetes ç­‰ã€‚ æ¶ˆæ¯é˜Ÿåˆ—å’Œäº‹ä»¶é©±åŠ¨ï¼šç†Ÿæ‚‰æ¶ˆæ¯é˜Ÿåˆ—å’Œäº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œäº†è§£æ¶ˆæ¯ä¸­é—´ä»¶çš„é€‰æ‹©å’Œä½¿ç”¨ã€‚èƒ½å¤Ÿè®¾è®¡å’Œå®ç°åŸºäºæ¶ˆæ¯é˜Ÿåˆ—å’Œäº‹ä»¶é©±åŠ¨çš„ç³»ç»Ÿï¼Œå®ç°æ¾è€¦åˆå’Œå¯æ‰©å±•æ€§ã€‚ é«˜å¯ç”¨å’Œå®¹é”™è®¾è®¡ï¼šèƒ½å¤Ÿè®¾è®¡å’Œå®ç°é«˜å¯ç”¨å’Œå®¹é”™çš„ç³»ç»Ÿæ¶æ„ï¼ŒåŒ…æ‹¬æ•…éšœæ¢å¤ã€è´Ÿè½½å‡è¡¡ã€å®¹ç¾å’Œå¤‡ä»½ç­–ç•¥ç­‰ã€‚äº†è§£åˆ†å¸ƒå¼ä¸€è‡´æ€§å’Œå®¹é”™ç®—æ³•ï¼Œå¦‚ Paxosã€Raft ç­‰ã€‚ æ²Ÿé€šå’Œé¢†å¯¼èƒ½åŠ›ï¼šä½œä¸ºæ¶æ„å¸ˆï¼Œéœ€è¦å…·å¤‡è‰¯å¥½çš„æ²Ÿé€šå’Œé¢†å¯¼èƒ½åŠ›ã€‚èƒ½å¤Ÿä¸å›¢é˜Ÿæˆå‘˜ã€ä¸šåŠ¡éƒ¨é—¨å’Œå…¶ä»–åˆ©ç›Šç›¸å…³è€…è¿›è¡Œæœ‰æ•ˆçš„æ²Ÿé€šå’Œåˆä½œï¼Œæ¨åŠ¨é¡¹ç›®çš„é¡ºåˆ©è¿›è¡Œã€‚ è¿™äº›æŠ€èƒ½å’ŒçŸ¥è¯†å°†å¸®åŠ©æ¶æ„å¸ˆåœ¨è®¾è®¡å’Œæ„å»ºå¤æ‚ç³»ç»Ÿæ—¶åšå‡ºæ˜æ™ºçš„å†³ç­–ï¼Œå¹¶ç¡®ä¿ç³»ç»Ÿçš„å¯é æ€§ã€å¯æ‰©å±•æ€§å’Œæ€§èƒ½ã€‚æ­¤å¤–ï¼Œæ¶æ„å¸ˆè¿˜åº”ä¸æ–­å­¦ä¹ å’Œä¿æŒå¯¹æ–°æŠ€æœ¯å’Œè¶‹åŠ¿çš„æ•æ„Ÿæ€§ï¼Œä»¥ä¿æŒåœ¨æŠ€æœ¯é¢†åŸŸçš„ç«äº‰åŠ›ã€‚\næ¶æ„å¸ˆå­¦ä¹ è·¯çº¿å›¾ ä½œä¸ºæ¶æ„å¸ˆï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªå¯èƒ½çš„å­¦ä¹ è·¯çº¿å›¾ï¼Œå¯ä»¥å¸®åŠ©ä½ ç³»ç»Ÿåœ°å­¦ä¹ å’Œå‘å±•æ¶æ„å¸ˆçš„æŠ€èƒ½ï¼š\nåŸºç¡€çŸ¥è¯†ï¼š å­¦ä¹ è½¯ä»¶å¼€å‘åŸºç¡€çŸ¥è¯†ï¼ŒåŒ…æ‹¬ç¼–ç¨‹è¯­è¨€ã€æ•°æ®ç»“æ„å’Œç®—æ³•ç­‰ã€‚ ç†è§£è½¯ä»¶å¼€å‘æµç¨‹å’Œå¸¸ç”¨å¼€å‘æ–¹æ³•ï¼Œå¦‚æ•æ·å¼€å‘å’Œ DevOpsã€‚ å­¦ä¹ é¢å‘å¯¹è±¡è®¾è®¡å’Œè®¾è®¡æ¨¡å¼ã€‚ æ¶æ„è®¾è®¡åŸºç¡€ï¼š å­¦ä¹ è½¯ä»¶æ¶æ„çš„åŸºæœ¬æ¦‚å¿µã€åŸåˆ™å’Œæ¨¡å¼ã€‚ ç ”ç©¶å’Œç†è§£å¸¸è§çš„æ¶æ„æ¨¡å¼ï¼Œå¦‚åˆ†å±‚æ¶æ„ã€å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å¼å’Œå‘å¸ƒ-è®¢é˜…æ¨¡å¼ç­‰ã€‚ æŒæ¡è®¾è®¡åŸåˆ™ï¼Œå¦‚å•ä¸€èŒè´£åŸåˆ™ã€å¼€é—­åŸåˆ™å’Œä¾èµ–å€’ç½®åŸåˆ™ç­‰ã€‚ æ·±å…¥å­¦ä¹ æ¶æ„æ¨¡å¼å’ŒæŠ€æœ¯ï¼š å­¦ä¹ å¾®æœåŠ¡æ¶æ„çš„åŸç†ã€è®¾è®¡å’Œå®æ–½ã€‚ ç ”ç©¶äº‹ä»¶é©±åŠ¨æ¶æ„å’Œæ¶ˆæ¯é˜Ÿåˆ—çš„ä½¿ç”¨ã€‚ æ¢ç´¢å¤§æ•°æ®æ¶æ„å’Œåˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ã€‚ äº†è§£å®¹å™¨åŒ–å’Œå®¹å™¨ç¼–æ’æŠ€æœ¯ï¼Œå¦‚ Docker å’Œ Kubernetesã€‚ å®è·µå’Œé¡¹ç›®ç»éªŒï¼š å‚ä¸å®é™…é¡¹ç›®ï¼Œä»ä¸­å­¦ä¹ æ¶æ„è®¾è®¡å’Œå®æ–½çš„ç»éªŒã€‚ å°è¯•è®¾è®¡å’Œå¼€å‘è‡ªå·±çš„å°å‹é¡¹ç›®ï¼Œå®è·µæ¶æ„è®¾è®¡å’Œè§£å†³å®é™…é—®é¢˜ã€‚ å‚ä¸å¼€æºé¡¹ç›®æˆ–è´¡çŒ®ï¼Œä¸å…¶ä»–æ¶æ„å¸ˆäº¤æµå’Œåˆ†äº«ç»éªŒã€‚ æŒç»­å­¦ä¹ å’Œå‘å±•ï¼š å…³æ³¨è¡Œä¸šè¶‹åŠ¿å’Œæ–°å…´æŠ€æœ¯ï¼Œå¦‚äººå·¥æ™ºèƒ½ã€ç‰©è”ç½‘å’ŒåŒºå—é“¾ç­‰ã€‚ å‚åŠ æ¶æ„å¸ˆåŸ¹è®­å’Œè®¤è¯è¯¾ç¨‹ï¼Œå¦‚ TOGAFã€AWS Certified Solutions Architect ç­‰ã€‚ å‚ä¸æ¶æ„å¸ˆç¤¾åŒºå’Œè®ºå›ï¼Œä¸å…¶ä»–ä¸“ä¸šäººå£«äº¤æµå’Œå­¦ä¹ ã€‚ è¯·æ³¨æ„ï¼Œè¿™åªæ˜¯ä¸€ä¸ªç¤ºä¾‹å­¦ä¹ è·¯çº¿å›¾ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„å…´è¶£ã€ç›®æ ‡å’Œå®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´å’Œæ‰©å±•ã€‚é‡è¦çš„æ˜¯ä¿æŒæŒç»­å­¦ä¹ å’Œä¸æ–­å®è·µï¼Œé€šè¿‡å®é™…é¡¹ç›®å’Œç»éªŒæ¥æå‡è‡ªå·±çš„æ¶æ„å¸ˆæŠ€èƒ½ã€‚\næ¶æ„å¸ˆå­¦ä¹ èµ„æº ä»¥ä¸‹æ˜¯ä¸€äº›å…³äºç³»ç»Ÿè®¾è®¡å’Œæ¶æ„çš„ç»å…¸ä¹¦ç±ï¼š\nã€Šè½¯ä»¶æ¶æ„å®è·µã€‹ï¼ˆSoftware Architecture in Practiceï¼‰ - Len Bassã€Paul Clementsã€Rick Kazman ã€Šå¤§è§„æ¨¡åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿã€‹ï¼ˆDesigning Data-Intensive Applicationsï¼‰ - Martin Kleppmann ã€Šä¼ä¸šé›†æˆæ¨¡å¼ã€‹ï¼ˆEnterprise Integration Patternsï¼‰ - Gregor Hohpeã€Bobby Woolf ã€Šæ¶æ„ä¹‹ç¾ã€‹ï¼ˆBeautiful Architectureï¼‰ - Diomidis Spinellisã€Georgios Gousios ã€Šæ¶æ„è®¾è®¡åŸåˆ™ã€‹ï¼ˆThe Art of Software Architecture: Design Methods and Techniquesï¼‰ - Stephen T.","title":"å¦‚ä½•æˆä¸ºä¸€ååˆæ ¼çš„æ¶æ„å¸ˆ"},{"content":"è½¯ä»¶å¼€å‘æµç¨‹å’Œå¸¸ç”¨å¼€å‘æ–¹æ³•ï¼Œå¦‚æ•æ·å¼€å‘å’Œ DevOpsï¼Œå¯¹äºæ¶æ„å¸ˆæ¥è¯´éå¸¸é‡è¦ã€‚ä¸‹é¢æˆ‘å°†ç®€è¦ä»‹ç»è¿™äº›æ¦‚å¿µï¼š\nè½¯ä»¶å¼€å‘æµç¨‹ï¼š\nè½¯ä»¶å¼€å‘æµç¨‹æ˜¯æŒ‡åœ¨å¼€å‘è½¯ä»¶æ—¶ï¼ŒæŒ‰ç…§ä¸€å®šçš„æ­¥éª¤å’Œé˜¶æ®µè¿›è¡Œå·¥ä½œçš„è¿‡ç¨‹ã€‚å¸¸è§çš„è½¯ä»¶å¼€å‘æµç¨‹åŒ…æ‹¬ç€‘å¸ƒæ¨¡å‹ã€è¿­ä»£æ¨¡å‹å’Œå¢é‡æ¨¡å‹ç­‰ã€‚è¿™äº›æµç¨‹ä»¥ä¸åŒçš„æ–¹å¼ç»„ç»‡å’Œç®¡ç†å¼€å‘è¿‡ç¨‹ï¼ŒåŒ…æ‹¬éœ€æ±‚åˆ†æã€è®¾è®¡ã€ç¼–ç ã€æµ‹è¯•å’Œéƒ¨ç½²ç­‰é˜¶æ®µã€‚\næ•æ·å¼€å‘ï¼š\næ•æ·å¼€å‘æ˜¯ä¸€ç§è¿­ä»£å’Œå¢é‡çš„è½¯ä»¶å¼€å‘æ–¹æ³•ï¼Œå¼ºè°ƒå›¢é˜Ÿåä½œã€å¿«é€Ÿå“åº”å˜åŒ–å’ŒæŒç»­äº¤ä»˜ã€‚æ•æ·å¼€å‘å¼ºè°ƒé€šè¿‡è¿­ä»£å‘¨æœŸï¼ˆå¦‚ Scrum ä¸­çš„ Sprintï¼‰æ¥å¼€å‘è½¯ä»¶ï¼Œæ¯ä¸ªè¿­ä»£éƒ½ä¼šäº§ç”Ÿå¯éƒ¨ç½²çš„è½¯ä»¶åŠŸèƒ½ã€‚å¸¸è§çš„æ•æ·æ–¹æ³•åŒ…æ‹¬ Scrumã€XPï¼ˆæé™ç¼–ç¨‹ï¼‰å’Œ Kanban ç­‰ã€‚\nDevOpsï¼š\nDevOps æ˜¯ä¸€ç§è½¯ä»¶å¼€å‘å’Œè¿ç»´çš„æ–¹æ³•è®ºï¼Œæ—¨åœ¨é€šè¿‡è‡ªåŠ¨åŒ–å’Œåä½œæ¥åŠ é€Ÿè½¯ä»¶äº¤ä»˜å’Œæé«˜è´¨é‡ã€‚DevOps å¼ºè°ƒå¼€å‘å›¢é˜Ÿå’Œè¿ç»´å›¢é˜Ÿä¹‹é—´çš„åä½œå’Œå…±äº«è´£ä»»ï¼Œå€ŸåŠ©è‡ªåŠ¨åŒ–å·¥å…·å’Œæµç¨‹æ¥å®ç°æŒç»­é›†æˆã€æŒç»­äº¤ä»˜å’ŒæŒç»­éƒ¨ç½²ã€‚\nå¼€å‘æµç¨‹ è½¯ä»¶å¼€å‘æµç¨‹é€šå¸¸åŒ…æ‹¬ä»¥ä¸‹é˜¶æ®µï¼š\néœ€æ±‚æ”¶é›†ï¼šæ”¶é›†å’Œè®°å½•è½¯ä»¶çš„åŠŸèƒ½å’ŒéåŠŸèƒ½æ€§éœ€æ±‚ã€‚ åˆ†æä¸è§„åˆ’ï¼šåˆ†æéœ€æ±‚å¹¶è§„åˆ’å¼€å‘è¿‡ç¨‹ï¼ŒåŒ…æ‹¬èµ„æºåˆ†é…ã€æ—¶é—´è¡¨å’Œäº¤ä»˜ç‰©ã€‚ è®¾è®¡ï¼šåŸºäºéœ€æ±‚åˆ›å»ºè½¯ä»¶æ¶æ„ã€æ¨¡å—å’Œç»„ä»¶çš„è¯¦ç»†è®¾è®¡ã€‚ å®ç°ï¼šç¼–å†™ä»£ç å¹¶é›†æˆè®¾è®¡çš„ç»„ä»¶ï¼Œè¿›è¡Œè½¯ä»¶å¼€å‘ã€‚ æµ‹è¯•ï¼šè¿›è¡Œå„ç§æµ‹è¯•æ´»åŠ¨ï¼Œå¦‚å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•å’Œç³»ç»Ÿæµ‹è¯•ï¼Œç¡®ä¿è½¯ä»¶æŒ‰é¢„æœŸåŠŸèƒ½ã€‚ éƒ¨ç½²ï¼šå‘å¸ƒè½¯ä»¶å¹¶åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å‘æœ€ç»ˆç”¨æˆ·æä¾›ä½¿ç”¨ã€‚ ç»´æŠ¤ä¸æ”¯æŒï¼šåœ¨éƒ¨ç½²åæä¾›æŒç»­çš„ç»´æŠ¤ã€é”™è¯¯ä¿®å¤å’Œæ”¯æŒã€‚ åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œéµå¾ªç‰ˆæœ¬æ§åˆ¶ã€æ–‡æ¡£åŒ–å’Œåä½œç­‰æœ€ä½³å®è·µæ˜¯éå¸¸é‡è¦çš„ï¼Œä»¥ç¡®ä¿è½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸçš„é¡ºåˆ©å’Œé«˜æ•ˆè¿›è¡Œã€‚\nå¸¸è§çš„è½¯ä»¶å¼€å‘æµç¨‹åŒ…æ‹¬ç€‘å¸ƒæ¨¡å‹ã€è¿­ä»£æ¨¡å‹å’Œå¢é‡æ¨¡å‹ç­‰ï¼š\nç€‘å¸ƒæ¨¡å‹ï¼ˆWaterfall Modelï¼‰ï¼š ç€‘å¸ƒæ¨¡å‹æ˜¯ä¸€ç§çº¿æ€§é¡ºåºçš„è½¯ä»¶å¼€å‘æµç¨‹ï¼ŒæŒ‰ç…§å›ºå®šçš„é˜¶æ®µä¾æ¬¡æ‰§è¡Œï¼Œæ¯ä¸ªé˜¶æ®µçš„è¾“å‡ºä½œä¸ºä¸‹ä¸€ä¸ªé˜¶æ®µçš„è¾“å…¥ã€‚å…¸å‹çš„é˜¶æ®µåŒ…æ‹¬éœ€æ±‚åˆ†æã€ç³»ç»Ÿè®¾è®¡ã€ç¼–ç ã€æµ‹è¯•å’Œç»´æŠ¤ç­‰ã€‚ç€‘å¸ƒæ¨¡å‹é€‚ç”¨äºéœ€æ±‚ç¨³å®šä¸”è¾ƒå°è§„æ¨¡çš„é¡¹ç›®ï¼Œä½†ç¼ºä¹çµæ´»æ€§å’Œé€‚åº”å˜åŒ–çš„èƒ½åŠ›ã€‚\nä¸‹é¢æ˜¯ç€‘å¸ƒæ¨¡å‹çš„å…¸å‹é˜¶æ®µï¼š\néœ€æ±‚åˆ†æé˜¶æ®µï¼šåœ¨è¿™ä¸ªé˜¶æ®µï¼Œä¸ç”¨æˆ·å’Œåˆ©ç›Šç›¸å…³è€…ä¸€èµ·æ”¶é›†å’Œæ˜ç¡®è½¯ä»¶ç³»ç»Ÿçš„éœ€æ±‚ã€‚å®šä¹‰ç³»ç»Ÿçš„åŠŸèƒ½å’Œæ€§èƒ½è¦æ±‚ï¼Œå¹¶ç¼–å†™è¯¦ç»†çš„éœ€æ±‚è§„æ ¼è¯´æ˜ä¹¦ã€‚ ç³»ç»Ÿè®¾è®¡é˜¶æ®µï¼šåœ¨éœ€æ±‚åˆ†æå®Œæˆåï¼Œè¿›è¡Œç³»ç»Ÿè®¾è®¡ã€‚è¿™åŒ…æ‹¬å®šä¹‰ç³»ç»Ÿçš„æ•´ä½“æ¶æ„ã€æ¨¡å—åˆ’åˆ†ã€æ•°æ®ç»“æ„å’Œç®—æ³•è®¾è®¡ç­‰ã€‚è®¾è®¡ç»“æœé€šå¸¸ä»¥æ–‡æ¡£å½¢å¼å‘ˆç°ã€‚ ç¼–ç é˜¶æ®µï¼šåœ¨ç³»ç»Ÿè®¾è®¡å®Œæˆåï¼Œå¼€å‘å›¢é˜Ÿå¼€å§‹å®é™…çš„ç¼–ç å·¥ä½œã€‚æ ¹æ®è®¾è®¡æ–‡æ¡£ï¼Œå¼€å‘äººå‘˜ç¼–å†™ä»£ç å¹¶å®ç°ç³»ç»Ÿçš„å„ä¸ªåŠŸèƒ½æ¨¡å—ã€‚ æµ‹è¯•é˜¶æ®µï¼šåœ¨ç¼–ç å®Œæˆåï¼Œè¿›è¡Œç³»ç»Ÿæµ‹è¯•ã€‚æµ‹è¯•äººå‘˜æ ¹æ®éœ€æ±‚å’Œè®¾è®¡è§„èŒƒæ‰§è¡ŒåŠŸèƒ½æµ‹è¯•ã€é›†æˆæµ‹è¯•å’Œç³»ç»Ÿæµ‹è¯•ï¼Œä»¥éªŒè¯ç³»ç»Ÿçš„æ­£ç¡®æ€§å’Œç¨³å®šæ€§ã€‚ é›†æˆå’Œéƒ¨ç½²é˜¶æ®µï¼šåœ¨æµ‹è¯•é€šè¿‡åï¼Œå°†å„ä¸ªæ¨¡å—è¿›è¡Œé›†æˆï¼Œå¹¶è¿›è¡Œç³»ç»Ÿçº§çš„æµ‹è¯•å’Œéƒ¨ç½²å‡†å¤‡ã€‚ç¡®ä¿æ•´ä¸ªç³»ç»Ÿèƒ½å¤ŸååŒå·¥ä½œï¼Œå¹¶å‡†å¤‡å¥½éƒ¨ç½²åˆ°ç›®æ ‡ç¯å¢ƒä¸­ã€‚ è¿ç»´å’Œç»´æŠ¤é˜¶æ®µï¼šä¸€æ—¦ç³»ç»Ÿéƒ¨ç½²å¹¶æŠ•å…¥ä½¿ç”¨ï¼Œè¿›å…¥è¿ç»´å’Œç»´æŠ¤é˜¶æ®µã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œå›¢é˜Ÿè´Ÿè´£ç›‘æ§ç³»ç»Ÿçš„è¿è¡ŒçŠ¶å†µï¼Œå¤„ç†é—®é¢˜å’Œé”™è¯¯ï¼Œå¹¶è¿›è¡Œå¿…è¦çš„ä¿®å¤å’Œæ›´æ–°ã€‚ ç€‘å¸ƒæ¨¡å‹çš„ç‰¹ç‚¹æ˜¯æ¯ä¸ªé˜¶æ®µçš„å·¥ä½œæ˜¯çº¿æ€§ã€é¡ºåºçš„ï¼Œä¸‹ä¸€ä¸ªé˜¶æ®µçš„å¼€å§‹ä¾èµ–äºå‰ä¸€ä¸ªé˜¶æ®µçš„å®Œæˆã€‚è¿™ç§æ¨¡å‹é€‚åˆéœ€æ±‚ç¨³å®šã€é¡¹ç›®è§„æ¨¡è¾ƒå°ã€æŠ€æœ¯é£é™©è¾ƒä½çš„é¡¹ç›®ã€‚ç„¶è€Œï¼Œç€‘å¸ƒæ¨¡å‹ç¼ºä¹çµæ´»æ€§å’Œå¯¹å˜åŒ–çš„é€‚åº”èƒ½åŠ›ï¼Œéš¾ä»¥åº”å¯¹éœ€æ±‚å˜æ›´å’Œé¡¹ç›®å»¶æœŸç­‰é—®é¢˜ã€‚\nå› æ­¤ï¼Œåœ¨é¢å¯¹éœ€æ±‚å˜åŒ–é¢‘ç¹ã€é¡¹ç›®å¤æ‚åº¦é«˜ã€é£é™©è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œæ•æ·å¼€å‘æ–¹æ³•å¦‚ Scrum å’Œ Kanban ç­‰æ›´ä¸ºé€‚ç”¨ï¼Œå®ƒä»¬å¼ºè°ƒè¿­ä»£ã€å¢é‡å’ŒæŒç»­äº¤ä»˜ï¼Œèƒ½æ›´å¥½åœ°æ»¡è¶³å®¢æˆ·éœ€æ±‚å¹¶å¿«é€Ÿå“åº”å˜åŒ–ã€‚\nè¿­ä»£æ¨¡å‹ï¼ˆIterative Modelï¼‰ï¼š è¿­ä»£æ¨¡å‹å¼ºè°ƒé€šè¿‡å¤šä¸ªè¿­ä»£å‘¨æœŸæ¥é€æ­¥æ„å»ºå’Œå®Œå–„è½¯ä»¶ã€‚æ¯ä¸ªè¿­ä»£å‘¨æœŸåŒ…æ‹¬éœ€æ±‚åˆ†æã€è®¾è®¡ã€ç¼–ç ã€æµ‹è¯•å’Œéƒ¨ç½²ç­‰é˜¶æ®µï¼Œæ¯ä¸ªè¿­ä»£éƒ½ä¼šäº§ç”Ÿå¯éƒ¨ç½²çš„è½¯ä»¶ç‰ˆæœ¬ã€‚è¿­ä»£æ¨¡å‹é€‚ç”¨äºéœ€æ±‚ä¸å®Œå…¨æ˜ç¡®æˆ–å¯èƒ½å˜åŒ–çš„é¡¹ç›®ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°é€‚åº”å˜åŒ–å’Œå¿«é€Ÿåé¦ˆã€‚\nä»¥ä¸‹æ˜¯è¿­ä»£æ¨¡å‹çš„ä¸€èˆ¬æµç¨‹ï¼š\né˜¶æ®µè§„åˆ’ï¼šç¡®å®šæ¯ä¸ªè¿­ä»£å‘¨æœŸçš„ç›®æ ‡ã€èŒƒå›´å’Œè®¡åˆ’ã€‚è¿™åŒ…æ‹¬ç¡®å®šè¦å¼€å‘çš„åŠŸèƒ½ã€åˆ†é…èµ„æºã€åˆ¶å®šæ—¶é—´è¡¨ç­‰ã€‚ éœ€æ±‚åˆ†æï¼šåœ¨æ¯ä¸ªè¿­ä»£çš„å¼€å§‹é˜¶æ®µï¼Œä¸ç”¨æˆ·å’Œåˆ©ç›Šç›¸å…³è€…ä¸€èµ·æ”¶é›†å’Œåˆ†æéœ€æ±‚ï¼Œå¹¶æ˜ç¡®æ¯ä¸ªè¿­ä»£çš„åŠŸèƒ½å’Œä¼˜å…ˆçº§ã€‚ è®¾è®¡å’Œå¼€å‘ï¼šæ ¹æ®éœ€æ±‚åˆ†æçš„ç»“æœï¼Œè¿›è¡Œç³»ç»Ÿè®¾è®¡å’Œå¼€å‘å·¥ä½œã€‚åœ¨æ¯ä¸ªè¿­ä»£ä¸­ï¼Œç³»ç»Ÿçš„æŸä¸ªéƒ¨åˆ†ä¼šè¢«è®¾è®¡ã€å¼€å‘å’Œæµ‹è¯•ã€‚ æµ‹è¯•å’ŒéªŒè¯ï¼šåœ¨æ¯ä¸ªè¿­ä»£å‘¨æœŸç»“æŸæ—¶ï¼Œè¿›è¡Œç³»ç»Ÿçš„å†…éƒ¨æµ‹è¯•å’ŒéªŒè¯ã€‚ç¡®ä¿å¼€å‘çš„åŠŸèƒ½ç¬¦åˆéœ€æ±‚ï¼Œå¹¶æ»¡è¶³é¢„æœŸçš„è´¨é‡æ ‡å‡†ã€‚ è¯„å®¡å’Œåé¦ˆï¼šåœ¨æ¯ä¸ªè¿­ä»£å‘¨æœŸç»“æŸåï¼Œä¸ç”¨æˆ·å’Œåˆ©ç›Šç›¸å…³è€…è¿›è¡Œè¯„å®¡å’Œåé¦ˆã€‚ä»–ä»¬æä¾›å¯¹å½“å‰åŠŸèƒ½çš„è¯„ä»·å’Œå»ºè®®ï¼Œä»¥æŒ‡å¯¼ä¸‹ä¸€ä¸ªè¿­ä»£çš„å¼€å‘å·¥ä½œã€‚ è¿­ä»£è°ƒæ•´ï¼šæ ¹æ®ç”¨æˆ·çš„åé¦ˆå’Œè¯„å®¡ç»“æœï¼Œå¯¹ä¸‹ä¸€ä¸ªè¿­ä»£çš„è®¡åˆ’è¿›è¡Œè°ƒæ•´å’Œä¼˜åŒ–ã€‚å¯èƒ½éœ€è¦é‡æ–°å®šä¹‰éœ€æ±‚ã€è°ƒæ•´åŠŸèƒ½ä¼˜å…ˆçº§ã€å¢åŠ æ–°çš„éœ€æ±‚ç­‰ã€‚ é‡å¤è¿­ä»£ï¼šé€šè¿‡ä¸æ–­é‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œæ¯ä¸ªè¿­ä»£å‘¨æœŸéƒ½ä¼šé€æ­¥å¢åŠ ç³»ç»Ÿçš„åŠŸèƒ½ã€å®Œå–„ç³»ç»Ÿçš„æ€§èƒ½ï¼Œå¹¶åœ¨æ¯ä¸ªè¿­ä»£ä¸­äº¤ä»˜ä¸€ä¸ªå¯ç”¨çš„è½¯ä»¶å¢é‡ã€‚ è¿­ä»£æ¨¡å‹çš„ä¼˜åŠ¿åœ¨äºèƒ½å¤Ÿå¿«é€Ÿå“åº”å˜åŒ–å’Œä¸æ–­æä¾›å¢å€¼ã€‚å®ƒå…è®¸åœ¨å¼€å‘è¿‡ç¨‹ä¸­çµæ´»è°ƒæ•´éœ€æ±‚ï¼Œå¹¶é€šè¿‡æ¯ä¸ªè¿­ä»£çš„åé¦ˆå’Œè¯„å®¡æ¥æ”¹è¿›äº§å“ã€‚ç„¶è€Œï¼Œè¿­ä»£æ¨¡å‹ä¹Ÿéœ€è¦é€‚å½“çš„è®¡åˆ’å’Œç®¡ç†ï¼Œä»¥ç¡®ä¿æ¯ä¸ªè¿­ä»£éƒ½èƒ½æŒ‰æ—¶äº¤ä»˜ï¼Œå¹¶æ§åˆ¶å¼€å‘è¿‡ç¨‹ä¸­çš„é£é™©ã€‚\næ•æ·æ–¹æ³•å¦‚ Scrum å’Œ Kanban æ˜¯è¿­ä»£æ¨¡å‹çš„å…¸å‹å®è·µï¼Œå®ƒä»¬æ›´åŠ å¼ºè°ƒå›¢é˜Ÿçš„åä½œã€è‡ªç»„ç»‡å’ŒæŒç»­äº¤ä»˜ï¼Œé€‚ç”¨äºéœ€æ±‚å˜åŒ–é¢‘ç¹å’Œé¡¹ç›®å¤æ‚åº¦è¾ƒé«˜çš„ç¯å¢ƒ\nå¢é‡æ¨¡å‹ï¼ˆIncremental Modelï¼‰ï¼š å¢é‡æ¨¡å‹å°†è½¯ä»¶æŒ‰æ¨¡å—æˆ–åŠŸèƒ½è¿›è¡Œåˆ’åˆ†ï¼Œæ¯ä¸ªæ¨¡å—æˆ–åŠŸèƒ½è¢«ç§°ä¸ºä¸€ä¸ªå¢é‡ï¼Œé€šè¿‡é€æ­¥æ·»åŠ å¢é‡æ¥é€æ¸æ„å»ºå®Œæ•´çš„è½¯ä»¶ç³»ç»Ÿã€‚æ¯ä¸ªå¢é‡éƒ½ç»å†éœ€æ±‚åˆ†æã€è®¾è®¡ã€å¼€å‘å’Œæµ‹è¯•ç­‰é˜¶æ®µã€‚å¢é‡æ¨¡å‹é€‚ç”¨äºå¤§è§„æ¨¡é¡¹ç›®å’Œéœ€è¦åˆ†é˜¶æ®µäº¤ä»˜çš„æƒ…å†µï¼Œå¯ä»¥æä¾›æ›´æ—©çš„ä»·å€¼äº¤ä»˜å’Œæ›´å¥½çš„é£é™©ç®¡ç†ã€‚\nä»¥ä¸‹æ˜¯å¢é‡æ¨¡å‹çš„ä¸€èˆ¬æµç¨‹ï¼š\né˜¶æ®µåˆ’åˆ†ï¼šå°†æ•´ä¸ªè½¯ä»¶ç³»ç»Ÿåˆ’åˆ†ä¸ºå¤šä¸ªå¢é‡ï¼Œæ¯ä¸ªå¢é‡éƒ½ä»£è¡¨ä¸€ä¸ªå¯ç”¨çš„è½¯ä»¶éƒ¨åˆ†ã€‚åˆ’åˆ†çš„æ–¹å¼å¯ä»¥åŸºäºåŠŸèƒ½ã€æ¨¡å—ã€ä¸šåŠ¡æµç¨‹ç­‰æ¥å®šä¹‰ã€‚ éœ€æ±‚åˆ†æï¼šåœ¨æ¯ä¸ªå¢é‡å¼€å§‹æ—¶ï¼Œä¸ç”¨æˆ·å’Œåˆ©ç›Šç›¸å…³è€…ä¸€èµ·æ”¶é›†å’Œæ˜ç¡®å…³äºè¯¥å¢é‡çš„éœ€æ±‚å’ŒåŠŸèƒ½ã€‚ç¡®å®šæ¯ä¸ªå¢é‡çš„ä¼˜å…ˆçº§å’ŒèŒƒå›´ã€‚ è®¾è®¡å’Œå¼€å‘ï¼šæ ¹æ®éœ€æ±‚åˆ†æçš„ç»“æœï¼Œè¿›è¡Œç³»ç»Ÿè®¾è®¡å’Œå¼€å‘å·¥ä½œã€‚æ¯ä¸ªå¢é‡çš„è®¾è®¡å’Œå¼€å‘éƒ½æ˜¯ç‹¬ç«‹è¿›è¡Œçš„ï¼Œå¯ä»¥é‡‡ç”¨é€‚åˆçš„å¼€å‘æ–¹æ³•å’ŒæŠ€æœ¯ã€‚ æµ‹è¯•å’ŒéªŒè¯ï¼šåœ¨æ¯ä¸ªå¢é‡å®Œæˆå¼€å‘åï¼Œè¿›è¡Œç³»ç»Ÿçš„æµ‹è¯•å’ŒéªŒè¯ã€‚ç¡®ä¿è¯¥å¢é‡çš„åŠŸèƒ½ç¬¦åˆéœ€æ±‚ï¼Œå¹¶æ»¡è¶³é¢„æœŸçš„è´¨é‡æ ‡å‡†ã€‚ å¢é‡äº¤ä»˜ï¼šç»è¿‡æµ‹è¯•å’ŒéªŒè¯åï¼Œå°†è¯¥å¢é‡äº¤ä»˜ç»™ç”¨æˆ·æˆ–åˆ©ç›Šç›¸å…³è€…ã€‚ç”¨æˆ·å¯ä»¥å¼€å§‹ä½¿ç”¨è¯¥å¢é‡ï¼Œå¹¶æä¾›åé¦ˆå’Œå»ºè®®ä»¥è¿›ä¸€æ­¥æ”¹è¿›å’Œä¼˜åŒ–ã€‚ å¢é‡æ•´åˆï¼šåœ¨å®Œæˆä¸€ä¸ªå¢é‡çš„äº¤ä»˜åï¼Œå°†è¯¥å¢é‡ä¸ä¹‹å‰äº¤ä»˜çš„å¢é‡è¿›è¡Œæ•´åˆã€‚ç¡®ä¿ä¸åŒå¢é‡ä¹‹é—´çš„åŠŸèƒ½å’Œæ¨¡å—å¯ä»¥ååŒå·¥ä½œï¼Œå¹¶å½¢æˆä¸€ä¸ªå®Œæ•´çš„è½¯ä»¶ç³»ç»Ÿã€‚ é€šè¿‡ä¸æ–­é‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œæ¯ä¸ªå¢é‡éƒ½é€æ­¥å¢åŠ ç³»ç»Ÿçš„åŠŸèƒ½å’Œå®Œå–„ç³»ç»Ÿçš„æ€§èƒ½ã€‚å¢é‡æ¨¡å‹å…è®¸åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¿«é€Ÿäº¤ä»˜å¯ç”¨çš„è½¯ä»¶éƒ¨åˆ†ï¼Œå¹¶æ ¹æ®ç”¨æˆ·çš„åé¦ˆå’Œéœ€æ±‚å˜åŒ–è¿›è¡Œè°ƒæ•´ã€‚å®ƒå¯ä»¥æé«˜è½¯ä»¶å¼€å‘çš„å¯è§æ€§å’Œç”¨æˆ·æ»¡æ„åº¦ï¼Œé™ä½é¡¹ç›®é£é™©ã€‚\nä¸è¿­ä»£æ¨¡å‹ç›¸æ¯”ï¼Œå¢é‡æ¨¡å‹æ›´åŠ å¼ºè°ƒä¸åŒå¢é‡ä¹‹é—´çš„ç‹¬ç«‹æ€§å’Œå¯ç”¨æ€§ã€‚æ¯ä¸ªå¢é‡éƒ½æ˜¯ä¸€ä¸ªå¯ç”¨çš„è½¯ä»¶éƒ¨åˆ†ï¼Œç”¨æˆ·å¯ä»¥åœ¨å¼€å‘è¿‡ç¨‹ä¸­é€æ­¥ä½¿ç”¨å’Œè¯„ä¼°ç³»ç»ŸåŠŸèƒ½ã€‚ç„¶è€Œï¼Œå¢é‡æ¨¡å‹å¯èƒ½éœ€è¦æ›´å¥½çš„è§„åˆ’å’Œç®¡ç†ï¼Œä»¥ç¡®ä¿å¢é‡ä¹‹é—´çš„é›†æˆå’Œæ•´åˆé¡ºåˆ©è¿›è¡Œï¼Œå¹¶é¿å…ç³»ç»Ÿæ¶æ„ä¸Šçš„é—®é¢˜ã€‚\næ•æ·å¼€å‘ æ•æ·å¼€å‘ï¼ˆAgile Developmentï¼‰æ˜¯ä¸€ç§ä»¥è¿­ä»£ã€å¢é‡å’Œåä½œä¸ºæ ¸å¿ƒçš„è½¯ä»¶å¼€å‘æ–¹æ³•ã€‚å®ƒå¼ºè°ƒå›¢é˜Ÿåˆä½œã€å¿«é€Ÿå“åº”å˜åŒ–å’ŒæŒç»­äº¤ä»˜ï¼Œä»¥æé«˜å®¢æˆ·æ»¡æ„åº¦å’Œé¡¹ç›®æˆåŠŸç‡ã€‚ä»¥ä¸‹æ˜¯æ•æ·å¼€å‘çš„æ ¸å¿ƒåŸåˆ™å’Œå¸¸ç”¨å®è·µï¼š\næ ¸å¿ƒåŸåˆ™ï¼š\nä¸ªä½“å’Œäº’åŠ¨èƒœè¿‡æµç¨‹å’Œå·¥å…·ï¼ˆIndividuals and interactions over processes and toolsï¼‰ï¼šå¼ºè°ƒå›¢é˜Ÿæˆå‘˜ä¹‹é—´çš„æ²Ÿé€šã€åˆä½œå’Œç›¸äº’æ”¯æŒï¼Œé‡è§†äººä¸äººä¹‹é—´çš„äº¤æµã€‚ å¯å·¥ä½œçš„è½¯ä»¶èƒœè¿‡è¯¦å°½çš„æ–‡æ¡£ï¼ˆWorking software over comprehensive documentationï¼‰ï¼šæ³¨é‡ä»¥å¯å·¥ä½œçš„è½¯ä»¶ä½œä¸ºéªŒè¯å’Œæ²Ÿé€šçš„æ‰‹æ®µï¼Œè€Œä¸æ˜¯è¿‡å¤šä¾èµ–ç¹æ‚çš„æ–‡æ¡£ã€‚ å®¢æˆ·åˆä½œèƒœè¿‡åˆåŒè°ˆåˆ¤ï¼ˆCustomer collaboration over contract negotiationï¼‰ï¼šé¼“åŠ±ä¸å®¢æˆ·å¯†åˆ‡åˆä½œï¼ŒåŠæ—¶è·å–åé¦ˆå¹¶æ ¹æ®éœ€æ±‚å˜åŒ–è¿›è¡Œè°ƒæ•´ã€‚ å“åº”å˜åŒ–èƒœè¿‡éµå¾ªè®¡åˆ’ï¼ˆResponding to change over following a planï¼‰ï¼šçµæ´»åº”å¯¹éœ€æ±‚å˜åŒ–ï¼Œé€šè¿‡è¿­ä»£å’Œå¢é‡çš„æ–¹å¼å¿«é€Ÿé€‚åº”å˜åŒ–çš„ç¯å¢ƒã€‚ å¸¸ç”¨å®è·µï¼š\nScrumï¼šScrum æ˜¯ä¸€ç§å¸¸ç”¨çš„æ•æ·å¼€å‘æ¡†æ¶ï¼Œé€šè¿‡è¿­ä»£å‘¨æœŸï¼ˆç§°ä¸º Sprintï¼‰æ¥ç»„ç»‡å·¥ä½œï¼Œæ¯ä¸ª Sprint éƒ½ä¼šäº§ç”Ÿå¯éƒ¨ç½²çš„è½¯ä»¶åŠŸèƒ½ã€‚Scrum å¼ºè°ƒè‡ªç»„ç»‡å›¢é˜Ÿã€äº§å“å¾…åŠæ¸…å•ã€Sprint è®¡åˆ’ä¼šè®®ã€æ¯æ—¥ç«™ä¼šå’Œå›é¡¾ç­‰å®è·µã€‚\nScrum æä¾›äº†ä¸€ç»„æ˜ç¡®å®šä¹‰çš„è§’è‰²ã€ä»ªå¼å’Œå·¥ä»¶ï¼Œä»¥ä¿ƒè¿›å›¢é˜Ÿåˆä½œå’Œé«˜æ•ˆäº¤ä»˜ã€‚\nä»¥ä¸‹æ˜¯ Scrum æ¡†æ¶ä¸­çš„æ ¸å¿ƒå…ƒç´ ï¼š\nScrum å›¢é˜Ÿï¼š äº§å“è´Ÿè´£äººï¼ˆProduct Ownerï¼‰ï¼šè´Ÿè´£æ˜ç¡®å¹¶ä¼˜å…ˆæ’åºäº§å“å¾…åŠæ¸…å•ï¼ˆProduct Backlogï¼‰ï¼Œç¡®ä¿å›¢é˜Ÿå¼€å‘å‡ºæœ‰ä»·å€¼çš„äº§å“ã€‚ å¼€å‘å›¢é˜Ÿï¼ˆDevelopment Teamï¼‰ï¼šè´Ÿè´£å®é™…çš„è½¯ä»¶å¼€å‘å·¥ä½œï¼Œè‡ªç»„ç»‡ã€è·¨åŠŸèƒ½ä¸”å…·å¤‡è‡ªæˆ‘ç®¡ç†çš„å›¢é˜Ÿã€‚ Scrum ä¸»ç®¡ï¼ˆScrum Masterï¼‰ï¼šè´Ÿè´£ä¿ƒè¿› Scrum æ¡†æ¶çš„å®æ–½ï¼ŒååŠ©å›¢é˜Ÿç§»é™¤éšœç¢å¹¶ä¿æŒå›¢é˜Ÿé«˜æ•ˆè¿ä½œã€‚ ä»ªå¼ï¼ˆCeremoniesï¼‰ï¼š äº§å“å¾…åŠæ¸…å•ä¼šè®®ï¼ˆProduct Backlog Refinementï¼‰ï¼šäº§å“è´Ÿè´£äººä¸å¼€å‘å›¢é˜Ÿä¸€èµ·å®¡æŸ¥ã€ç»†åŒ–å’Œä¼˜åŒ–äº§å“å¾…åŠæ¸…å•ã€‚ è®¡åˆ’ä¼šè®®ï¼ˆSprint Planningï¼‰ï¼šå›¢é˜Ÿç¡®å®šä¸‹ä¸€ä¸ª Sprint è¦å®Œæˆçš„å·¥ä½œï¼Œå¹¶åˆ¶å®šè¾¾æˆç›®æ ‡çš„è®¡åˆ’ã€‚ æ¯æ—¥ç«™ä¼šï¼ˆDaily Scrumï¼‰ï¼šå›¢é˜Ÿæˆå‘˜æ¯å¤©ä¸¾è¡ŒçŸ­æš‚ä¼šè®®ï¼Œåˆ†äº«è¿›å±•ã€è®¨è®ºé—®é¢˜å’Œåè°ƒå·¥ä½œã€‚ è¯„å®¡ä¼šè®®ï¼ˆSprint Reviewï¼‰ï¼šåœ¨ Sprint ç»“æŸæ—¶ï¼Œå›¢é˜Ÿå±•ç¤ºå¹¶å›é¡¾å·²å®Œæˆçš„å·¥ä½œï¼Œè·å¾—åˆ©ç›Šç›¸å…³è€…çš„åé¦ˆã€‚ å›é¡¾ä¼šè®®ï¼ˆSprint Retrospectiveï¼‰ï¼šå›¢é˜Ÿå›é¡¾ Sprint è¿‡ç¨‹ï¼Œè¯†åˆ«é—®é¢˜å¹¶åˆ¶å®šæ”¹è¿›æªæ–½ã€‚ å·¥ä»¶ï¼ˆArtifactsï¼‰ï¼š äº§å“å¾…åŠæ¸…å•ï¼ˆProduct Backlogï¼‰ï¼šæŒ‰ä¼˜å…ˆçº§æ’åºçš„éœ€æ±‚åˆ—è¡¨ï¼ŒåŒ…å«æ‰€æœ‰å¾…å¼€å‘çš„åŠŸèƒ½å’Œä»»åŠ¡ã€‚ å†²åˆºå¾…åŠæ¸…å•ï¼ˆSprint Backlogï¼‰ï¼šé€‰å®šçš„äº§å“å¾…åŠæ¸…å•ä¸­çš„ä»»åŠ¡ï¼Œå›¢é˜Ÿåœ¨ Sprint æœŸé—´æ‰¿è¯ºå®Œæˆçš„å·¥ä½œã€‚ å†²åˆºç›®æ ‡ï¼ˆSprint Goalï¼‰ï¼šæ¯ä¸ª Sprint çš„æ€»ä½“ç›®æ ‡ï¼ŒæŒ‡å¯¼å›¢é˜Ÿçš„å·¥ä½œå¹¶æä¾›ä»·å€¼äº¤ä»˜çš„æ–¹å‘ã€‚ å¢é‡ï¼ˆIncrementï¼‰ï¼šæ¯ä¸ª Sprint ç»“æŸæ—¶å¯éƒ¨ç½²çš„è½¯ä»¶äº§å“çš„å¯å·¥ä½œç‰ˆæœ¬ã€‚ ç”¨æˆ·æ•…äº‹ï¼ˆUser Storiesï¼‰ï¼šç”¨æˆ·æ•…äº‹æ˜¯ç”¨ç®€çŸ­ã€å¯ç†è§£çš„æ–¹å¼æè¿°ç³»ç»Ÿçš„åŠŸèƒ½éœ€æ±‚ï¼Œä»¥ç”¨æˆ·è§’åº¦æ¥é˜è¿°éœ€æ±‚ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç†è§£å’Œæ»¡è¶³ç”¨æˆ·æœŸæœ›ã€‚\nç”¨æˆ·æ•…äº‹ï¼ˆUser Storiesï¼‰æ˜¯æ•æ·å¼€å‘ä¸­ç”¨äºæè¿°è½¯ä»¶ç³»ç»ŸåŠŸèƒ½éœ€æ±‚çš„ç®€æ´ã€å¯ç†è§£çš„æ–¹å¼ã€‚å®ƒä»¬ä»ç”¨æˆ·çš„è§’åº¦æè¿°äº†ç³»ç»Ÿåº”è¯¥å…·å¤‡çš„åŠŸèƒ½æˆ–ç‰¹æ€§ï¼Œä»¥ä¾¿å¼€å‘å›¢é˜Ÿç†è§£å’Œæ»¡è¶³ç”¨æˆ·çš„éœ€æ±‚ã€‚\nä¸€ä¸ªç”¨æˆ·æ•…äº‹é€šå¸¸ç”±ä»¥ä¸‹å‡ ä¸ªå…ƒç´ ç»„æˆï¼š\nç”¨æˆ·è§’è‰²ï¼ˆUser Roleï¼‰ï¼šæè¿°ä½¿ç”¨ç³»ç»Ÿçš„ç”¨æˆ·è§’è‰²æˆ–èº«ä»½ï¼Œä¾‹å¦‚\u0026quot;é¡¾å®¢\u0026quot;ã€\u0026ldquo;ç®¡ç†å‘˜\u0026rdquo;ã€\u0026ldquo;æ¸¸å®¢\u0026quot;ç­‰ã€‚ æ´»åŠ¨ï¼ˆActivityï¼‰ï¼šè¯´æ˜ç”¨æˆ·åœ¨ç³»ç»Ÿä¸­è¦æ‰§è¡Œçš„æ“ä½œæˆ–ä»»åŠ¡ï¼Œå¼ºè°ƒç”¨æˆ·çš„ç›®æ ‡å’Œè¡Œä¸ºï¼Œä¾‹å¦‚\u0026quot;æŸ¥çœ‹è®¢å•å†å²\u0026rdquo;ã€\u0026ldquo;å‘å¸ƒè¯„è®º\u0026quot;ç­‰ã€‚ ä¸šåŠ¡ä»·å€¼ï¼ˆBusiness Valueï¼‰ï¼šæè¿°ç”¨æˆ·ä»å®Œæˆè¯¥åŠŸèƒ½ä¸­è·å¾—çš„ä»·å€¼æˆ–å¥½å¤„ï¼Œä¾‹å¦‚\u0026quot;æé«˜ç”¨æˆ·æ»¡æ„åº¦\u0026rdquo;ã€\u0026ldquo;åŠ å¿«è®¢å•å¤„ç†æ—¶é—´\u0026quot;ç­‰ã€‚ ç”¨æˆ·æ•…äº‹é€šå¸¸ä»¥ç®€çŸ­ã€ç®€æ´çš„è¯­å¥å½¢å¼ç¼–å†™ï¼Œä¾‹å¦‚ï¼š\nä½œä¸ºä¸€ä¸ªé¡¾å®¢ï¼Œæˆ‘å¸Œæœ›èƒ½å¤Ÿæµè§ˆå•†å“ç›®å½•ï¼Œä»¥ä¾¿æŸ¥æ‰¾æ„Ÿå…´è¶£çš„äº§å“ã€‚ ä½œä¸ºä¸€ä¸ªç®¡ç†å‘˜ï¼Œæˆ‘å¸Œæœ›èƒ½å¤Ÿæ·»åŠ æ–°ç”¨æˆ·ï¼Œä»¥ä¾¿ç®¡ç†ç³»ç»Ÿçš„ç”¨æˆ·è´¦æˆ·ã€‚ ä»¥ä¸‹æ˜¯ç”¨æˆ·æ•…äº‹å¦‚ä½•è½åœ°çš„ä¸€èˆ¬æ­¥éª¤ï¼š\næ•…äº‹æ‹†åˆ†ï¼šé¦–å…ˆï¼Œå°†å¤§å‹ç”¨æˆ·æ•…äº‹æ‹†åˆ†ä¸ºæ›´å°ã€å¯æ‰§è¡Œçš„éƒ¨åˆ†ã€‚è¿™é€šå¸¸é€šè¿‡å°†ç”¨æˆ·æ•…äº‹åˆ†è§£ä¸ºæ›´å°çš„ä»»åŠ¡ã€åŠŸèƒ½æˆ–å­æ•…äº‹æ¥å®Œæˆã€‚ç¡®ä¿æ¯ä¸ªæ‹†åˆ†åçš„éƒ¨åˆ†éƒ½å…·æœ‰ç‹¬ç«‹çš„ä»·å€¼ï¼Œå¹¶èƒ½å¤Ÿåœ¨è¾ƒçŸ­æ—¶é—´å†…å®Œæˆã€‚ ä»»åŠ¡å®šä¹‰ï¼šé’ˆå¯¹æ¯ä¸ªæ‹†åˆ†åçš„ç”¨æˆ·æ•…äº‹ï¼Œæ˜ç¡®å®šä¹‰éœ€è¦è¿›è¡Œçš„å…·ä½“ä»»åŠ¡ã€‚ä»»åŠ¡åº”è¯¥æ˜¯æ¸…æ™°ã€å…·ä½“å’Œå¯æµ‹é‡çš„ã€‚ä»»åŠ¡å¯ä»¥åŒ…æ‹¬è®¾è®¡ã€ç¼–ç ã€æµ‹è¯•ã€æ–‡æ¡£ç¼–å†™ç­‰ã€‚ ä»»åŠ¡ä¼°ç®—ï¼šå¯¹æ¯ä¸ªä»»åŠ¡è¿›è¡Œä¼°ç®—ï¼Œä»¥ç¡®å®šå®Œæˆä»»åŠ¡æ‰€éœ€çš„æ—¶é—´å’Œèµ„æºã€‚å¯ä»¥ä½¿ç”¨å›¢é˜Ÿå…±è¯†ã€ä¸“å®¶è¯„ä¼°ã€å†å²æ•°æ®ç­‰æ–¹æ³•è¿›è¡Œä¼°ç®—ã€‚ç¡®ä¿ä»»åŠ¡çš„ä¼°ç®—æ˜¯åˆç†å’Œå¯å®ç°çš„ã€‚ ä»»åŠ¡åˆ†é…ï¼šå°†ä»»åŠ¡åˆ†é…ç»™å›¢é˜Ÿæˆå‘˜ï¼Œå¹¶ç¡®ä¿æ¯ä¸ªäººéƒ½æ¸…æ¥šè‡ªå·±è´Ÿè´£çš„ä»»åŠ¡å’Œæˆªæ­¢æ—¥æœŸã€‚æ ¹æ®æ¯ä¸ªæˆå‘˜çš„æŠ€èƒ½å’Œä¸“é•¿è¿›è¡Œä»»åŠ¡åˆ†é…ï¼Œä»¥æœ€å¤§ç¨‹åº¦åœ°æé«˜æ•ˆç‡å’Œè´¨é‡ã€‚ ä»»åŠ¡æ‰§è¡Œï¼šå›¢é˜Ÿæˆå‘˜æ ¹æ®ä»»åŠ¡çš„åˆ†é…å’Œä¼˜å…ˆçº§è¿›è¡Œä»»åŠ¡çš„æ‰§è¡Œã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œå¼€å‘äººå‘˜è¿›è¡Œç¼–ç ã€è®¾è®¡å¸ˆè¿›è¡Œè®¾è®¡ã€æµ‹è¯•äººå‘˜è¿›è¡Œæµ‹è¯•ç­‰ã€‚å›¢é˜Ÿæˆå‘˜åº”ä¿æŒè‰¯å¥½çš„åä½œå’Œæ²Ÿé€šï¼Œç¡®ä¿ä»»åŠ¡æŒ‰æ—¶å®Œæˆã€‚ éªŒæ”¶æµ‹è¯•ï¼šå®Œæˆä»»åŠ¡åï¼Œè¿›è¡ŒéªŒæ”¶æµ‹è¯•ä»¥ç¡®ä¿ä»»åŠ¡è¾¾åˆ°é¢„æœŸçš„è¦æ±‚å’Œè´¨é‡æ ‡å‡†ã€‚éªŒæ”¶æµ‹è¯•åº”åŸºäºç”¨æˆ·æ•…äº‹çš„å®šä¹‰å’ŒéªŒæ”¶æ ‡å‡†ï¼Œä»¥éªŒè¯ä»»åŠ¡çš„åŠŸèƒ½å’Œå¯ç”¨æ€§ã€‚ ç”¨æˆ·éªŒæ”¶ï¼šå°†ä»»åŠ¡äº¤ä»˜ç»™ç”¨æˆ·æˆ–åˆ©ç›Šç›¸å…³è€…è¿›è¡Œæœ€ç»ˆçš„ç”¨æˆ·éªŒæ”¶ã€‚ç”¨æˆ·æ ¹æ®ç”¨æˆ·æ•…äº‹çš„å®šä¹‰ï¼Œæ£€æŸ¥ä»»åŠ¡æ˜¯å¦æ»¡è¶³ä»–ä»¬çš„éœ€æ±‚å’ŒæœŸæœ›ã€‚ä»–ä»¬æä¾›åé¦ˆå’Œå»ºè®®ï¼Œä»¥ä¾¿è¿›ä¸€æ­¥æ”¹è¿›å’Œä¼˜åŒ–ã€‚ é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œç”¨æˆ·æ•…äº‹å¯ä»¥è¢«æœ‰æ•ˆåœ°è½åœ°å¹¶è½¬åŒ–ä¸ºå®é™…çš„åŠŸèƒ½å’Œä»»åŠ¡ã€‚è¿™ç§è¿­ä»£çš„æ–¹å¼ä½¿å›¢é˜Ÿèƒ½å¤Ÿå¿«é€Ÿå“åº”éœ€æ±‚å˜åŒ–ï¼Œé€æ­¥äº¤ä»˜å¢å€¼ï¼Œæé«˜äº§å“çš„è´¨é‡å’Œç”¨æˆ·æ»¡æ„åº¦ã€‚åŒæ—¶ï¼Œä¿æŒè‰¯å¥½çš„æ²Ÿé€šå’Œåä½œï¼Œä»¥åŠåŠæ—¶çš„ç”¨æˆ·åé¦ˆï¼Œå¯¹äºæˆåŠŸè½åœ°ç”¨æˆ·æ•…äº‹ä¹Ÿéå¸¸é‡è¦ã€‚\nè¿­ä»£å¼€å‘å’ŒæŒç»­é›†æˆï¼šé‡‡ç”¨è¿­ä»£çš„æ–¹å¼è¿›è¡Œå¼€å‘ï¼Œæ¯ä¸ªè¿­ä»£å‘¨æœŸäº§ç”Ÿå¯éƒ¨ç½²çš„è½¯ä»¶ç‰ˆæœ¬ã€‚åŒæ—¶ï¼Œå€ŸåŠ©æŒç»­é›†æˆå·¥å…·å’Œå®è·µï¼Œå®ç°é¢‘ç¹åœ°é›†æˆå’Œè‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œä»¥ç¡®ä¿è½¯ä»¶è´¨é‡ã€‚\nè¿­ä»£å¼€å‘ï¼ˆIterative Developmentï¼‰å’ŒæŒç»­é›†æˆï¼ˆContinuous Integrationï¼‰æ˜¯æ•æ·å¼€å‘ä¸­å¸¸ç”¨çš„å®è·µæ–¹æ³•ï¼Œæ—¨åœ¨æé«˜è½¯ä»¶å¼€å‘çš„æ•ˆç‡ã€è´¨é‡å’Œçµæ´»æ€§ã€‚\nè¿­ä»£å¼€å‘æ˜¯ä¸€ç§é€šè¿‡å¤šæ¬¡è¿­ä»£å¾ªç¯æ¥å¼€å‘è½¯ä»¶çš„æ–¹æ³•ã€‚æ¯ä¸ªè¿­ä»£å‘¨æœŸï¼ˆé€šå¸¸ç§°ä¸º Sprintï¼‰éƒ½åŒ…å«äº†å®Œæ•´çš„è½¯ä»¶å¼€å‘æµç¨‹ï¼ŒåŒ…æ‹¬éœ€æ±‚åˆ†æã€è®¾è®¡ã€ç¼–ç ã€æµ‹è¯•å’Œéƒ¨ç½²ã€‚åœ¨æ¯ä¸ªè¿­ä»£çš„ç»“æŸï¼Œå›¢é˜Ÿä¼šäº§ç”Ÿä¸€ä¸ªå¯éƒ¨ç½²çš„è½¯ä»¶ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªå¯å·¥ä½œçš„å¢é‡ã€‚è¿­ä»£å¼€å‘å¼ºè°ƒå¿«é€Ÿäº¤ä»˜å’ŒæŒç»­æ”¹è¿›ï¼Œå›¢é˜Ÿé€šè¿‡ä¸æ–­è¿­ä»£ï¼Œé€æ­¥å®Œå–„è½¯ä»¶å¹¶æ»¡è¶³ç”¨æˆ·éœ€æ±‚ã€‚\nè¿­ä»£å¼€å‘çš„ä¸»è¦ä¼˜åŠ¿åŒ…æ‹¬ï¼š\nå¿«é€Ÿäº¤ä»˜ä»·å€¼ï¼šæ¯ä¸ªè¿­ä»£éƒ½äº§ç”Ÿå¯å·¥ä½œçš„è½¯ä»¶ç‰ˆæœ¬ï¼Œå¯ä»¥å¿«é€Ÿäº¤ä»˜ç»™ç”¨æˆ·ï¼Œè·å¾—åŠæ—©åé¦ˆã€‚ é«˜åº¦çµæ´»æ€§ï¼šè¿­ä»£å¼€å‘å¯ä»¥æ›´å¥½åœ°åº”å¯¹éœ€æ±‚å˜åŒ–å’Œæ–°çš„å‘ç°ï¼Œå›¢é˜Ÿå¯ä»¥åœ¨æ¯ä¸ªè¿­ä»£ä¸­è°ƒæ•´è®¡åˆ’å’Œä¼˜å…ˆçº§ã€‚ å‡å°‘é£é™©ï¼šé€šè¿‡è¿­ä»£å’Œå¢é‡äº¤ä»˜ï¼Œé£é™©å¯ä»¥æ›´æ—©åœ°è¢«å‘ç°å’Œè§£å†³ï¼Œå‡å°‘äº†é¡¹ç›®å¤±è´¥çš„é£é™©ã€‚ æŒç»­é›†æˆæ˜¯ä¸€ç§è½¯ä»¶å¼€å‘å®è·µï¼Œæ—¨åœ¨é¢‘ç¹åœ°å°†å¼€å‘äººå‘˜çš„ä»£ç é›†æˆåˆ°å…±äº«ä»£ç åº“ä¸­ï¼Œå¹¶é€šè¿‡è‡ªåŠ¨åŒ–çš„æ„å»ºå’Œæµ‹è¯•æµç¨‹ï¼Œç¡®ä¿æ•´ä½“ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œè´¨é‡ã€‚æŒç»­é›†æˆè¦æ±‚å¼€å‘äººå‘˜é¢‘ç¹åœ°æäº¤ä»£ç å˜æ›´ï¼Œå¹¶å°†å…¶é›†æˆåˆ°ä¸»å¹²ä»£ç åº“ä¸­ã€‚é›†æˆè¿‡ç¨‹ä¼šè§¦å‘è‡ªåŠ¨åŒ–çš„æ„å»ºã€ç¼–è¯‘ã€æµ‹è¯•å’Œéƒ¨ç½²æµç¨‹ï¼Œä»¥ç¡®ä¿ä»£ç çš„ä¸€è‡´æ€§å’Œå¯é æ€§ã€‚\næŒç»­é›†æˆçš„ä¸»è¦ä¼˜åŠ¿åŒ…æ‹¬ï¼š\nå¿«é€Ÿå‘ç°é—®é¢˜ï¼šé€šè¿‡é¢‘ç¹åœ°é›†æˆå’Œè‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå¯ä»¥æ›´æ—©åœ°å‘ç°ä»£ç é—®é¢˜å’Œé”™è¯¯ï¼Œå‡å°‘é—®é¢˜çš„ç§¯ç´¯å’Œä¿®å¤æˆæœ¬ã€‚ æé«˜å›¢é˜Ÿåä½œï¼šæŒç»­é›†æˆè¦æ±‚å¼€å‘äººå‘˜é¢‘ç¹åœ°æäº¤ä»£ç å˜æ›´ï¼Œä¿ƒè¿›å›¢é˜Ÿä¹‹é—´çš„æ²Ÿé€šå’Œåˆä½œï¼Œå‡å°‘ä»£ç å†²çªå’Œé›†æˆé—®é¢˜ã€‚ è‡ªåŠ¨åŒ–æ„å»ºå’Œéƒ¨ç½²ï¼šæŒç»­é›†æˆé€šè¿‡è‡ªåŠ¨åŒ–çš„æ„å»ºå’Œéƒ¨ç½²æµç¨‹ï¼Œç®€åŒ–äº†å¼€å‘äººå‘˜çš„å·¥ä½œï¼Œæé«˜äº†äº¤ä»˜é€Ÿåº¦å’Œè´¨é‡ã€‚ è¿­ä»£å¼€å‘å’ŒæŒç»­é›†æˆç›¸äº’é…åˆï¼Œå¯ä»¥åŠ å¼ºå›¢é˜Ÿçš„åä½œã€äº¤ä»˜èƒ½åŠ›å’Œè½¯ä»¶è´¨é‡ã€‚è¿­ä»£å¼€å‘æä¾›äº†ä¸€ä¸ªæ˜ç¡®çš„å·¥ä½œå‘¨æœŸï¼Œæ¯ä¸ªè¿­ä»£ç»“æŸæ—¶éƒ½è¿›è¡Œé›†æˆå’Œæµ‹è¯•ï¼Œè€ŒæŒç»­é›†æˆåˆ™é€šè¿‡é¢‘ç¹çš„ä»£ç é›†æˆå’Œè‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œç¡®ä¿æ¯æ¬¡é›†æˆéƒ½æ˜¯ç¨³å®šå’Œå¯é çš„ã€‚è¿™ä¸¤ç§å®è·µæ–¹æ³•çš„ç»“åˆå¯ä»¥å¸®åŠ©å›¢é˜Ÿæ›´å¥½åœ°åº”å¯¹éœ€æ±‚å˜åŒ–ã€æé«˜äº¤ä»˜é€Ÿåº¦å’Œè´¨é‡ï¼Œä»¥åŠå¢å¼ºé¡¹ç›®çš„å¯æ§æ€§å’Œé€æ˜åº¦ã€‚\nç‡ƒå°½å›¾ï¼ˆBurn-down Chartï¼‰ï¼šç‡ƒå°½å›¾æ˜¯ä¸€ç§å¯è§†åŒ–å·¥å…·ï¼Œç”¨äºè·Ÿè¸ªé¡¹ç›®è¿›åº¦å’Œå‰©ä½™å·¥ä½œé‡ã€‚å®ƒå±•ç¤ºäº†å›¢é˜Ÿå®Œæˆå·¥ä½œçš„é€Ÿåº¦ï¼Œå¸®åŠ©å›¢é˜Ÿé¢„æµ‹é¡¹ç›®å®Œæˆæ—¶é—´å’Œè°ƒæ•´è®¡åˆ’ã€‚\nç‡ƒå°½å›¾ï¼ˆBurn-down Chartï¼‰æ˜¯æ•æ·å¼€å‘ä¸­çš„ä¸€ç§å¯è§†åŒ–å·¥å…·ï¼Œç”¨äºè·Ÿè¸ªé¡¹ç›®çš„è¿›åº¦å’Œå·¥ä½œé‡ã€‚å®ƒä»¥å›¾è¡¨çš„å½¢å¼æ˜¾ç¤ºå›¢é˜Ÿåœ¨ä¸€ä¸ªè¿­ä»£å‘¨æœŸï¼ˆé€šå¸¸æ˜¯ Sprintï¼‰ä¸­å‰©ä½™å·¥ä½œçš„ä¼°è®¡é‡ï¼Œä»¥åŠæ—¶é—´çš„æ¨ç§»è€Œæ¶ˆè€—çš„å·¥ä½œé‡ã€‚\nç‡ƒå°½å›¾é€šå¸¸ä»¥æ¨ªè½´è¡¨ç¤ºæ—¶é—´ï¼Œçºµè½´è¡¨ç¤ºå·¥ä½œé‡ï¼ˆé€šå¸¸ä»¥ä»»åŠ¡æ•°é‡ã€æ•…äº‹ç‚¹æˆ–å°æ—¶æ•°è¡¨ç¤ºï¼‰ã€‚å›¾è¡¨çš„èµ·ç‚¹æ˜¯è¯¥è¿­ä»£å‘¨æœŸçš„å·¥ä½œé‡æ€»æ•°ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œå›¢é˜Ÿä¼šè®°å½•æ¯å¤©çš„å·¥ä½œé‡å˜åŒ–ï¼Œä»¥æ˜¾ç¤ºå‰©ä½™å·¥ä½œçš„å‡å°‘æƒ…å†µã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œç‡ƒå°½å›¾çš„çº¿æ¡åº”è¯¥è¶‹è¿‘äºæ–œç‡ä¸ºè´Ÿçš„ç›´çº¿ï¼Œè¡¨ç¤ºå›¢é˜ŸæŒ‰è®¡åˆ’é€æ¸å®Œæˆå‰©ä½™å·¥ä½œã€‚\né€šè¿‡è§‚å¯Ÿç‡ƒå°½å›¾ï¼Œå›¢é˜Ÿå’Œåˆ©ç›Šç›¸å…³è€…å¯ä»¥äº†è§£é¡¹ç›®çš„è¿›åº¦å’Œå·¥ä½œé‡çš„å˜åŒ–æƒ…å†µã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ç‡ƒå°½å›¾çš„å¸¸è§ç‰¹å¾ï¼š\nç†æƒ³ç‡ƒå°½çº¿ï¼ˆIdeal Burn-down Lineï¼‰ï¼šè¿™æ˜¯ä¸€æ¡ç†æƒ³çš„ç›´çº¿ï¼Œè¡¨ç¤ºå¦‚æœå›¢é˜ŸæŒ‰è®¡åˆ’å®Œæˆæ¯å¤©å›ºå®šæ•°é‡çš„å·¥ä½œï¼Œå°†åœ¨è¿­ä»£ç»“æŸæ—¶å®Œæˆæ‰€æœ‰å·¥ä½œã€‚å®ƒç”¨äºä¸å®é™…ç‡ƒå°½çº¿è¿›è¡Œæ¯”è¾ƒï¼Œè¯„ä¼°å›¢é˜Ÿçš„è¿›åº¦ã€‚ å®é™…ç‡ƒå°½çº¿ï¼ˆActual Burn-down Lineï¼‰ï¼šè¿™æ˜¯å®é™…çš„å·¥ä½œé‡æ¶ˆè€—æ›²çº¿ï¼Œæ ¹æ®æ¯å¤©è®°å½•çš„å·¥ä½œé‡æ›´æ–°ã€‚å®ƒæ˜¾ç¤ºäº†å›¢é˜Ÿå®é™…å®Œæˆå·¥ä½œçš„é€Ÿåº¦å’Œå‰©ä½™å·¥ä½œçš„å˜åŒ–ã€‚ æå‰æˆ–æ»åï¼šç‡ƒå°½å›¾å¯ä»¥æ˜¾ç¤ºå›¢é˜Ÿçš„å·¥ä½œé‡æ¶ˆè€—æ˜¯å¦ä¸ç†æƒ³æƒ…å†µç›¸ç¬¦ã€‚å¦‚æœå®é™…ç‡ƒå°½çº¿åœ¨ç†æƒ³ç‡ƒå°½çº¿ä¹‹ä¸Šï¼Œè¡¨ç¤ºå›¢é˜Ÿè¿›åº¦æ»åï¼›å¦‚æœå®é™…ç‡ƒå°½çº¿åœ¨ç†æƒ³ç‡ƒå°½çº¿ä¹‹ä¸‹ï¼Œè¡¨ç¤ºå›¢é˜Ÿè¿›åº¦æå‰ã€‚ Sprint ç›®æ ‡å’Œå·¥ä½œé‡è°ƒæ•´ï¼šé€šè¿‡è§‚å¯Ÿç‡ƒå°½å›¾ï¼Œå›¢é˜Ÿå¯ä»¥æ ¹æ®å®é™…è¿›åº¦è°ƒæ•´å·¥ä½œé‡å’Œä¼˜å…ˆçº§ï¼Œä»¥ç¡®ä¿åœ¨è¿­ä»£ç»“æŸæ—¶èƒ½å¤Ÿå®Œæˆç›®æ ‡ã€‚ ç‡ƒå°½å›¾æ˜¯ä¸€ç§å¼ºå¤§çš„å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©å›¢é˜Ÿå’Œåˆ©ç›Šç›¸å…³è€…äº†è§£é¡¹ç›®çš„è¿›å±•æƒ…å†µï¼Œå¹¶åŠæ—¶é‡‡å–æªæ–½æ¥è§£å†³é—®é¢˜æˆ–è°ƒæ•´è®¡åˆ’ã€‚å®ƒæä¾›äº†ä¸€ä¸ªå¯è§†åŒ–çš„æ–¹å¼æ¥è·Ÿè¸ªå·¥ä½œé‡æ¶ˆè€—ï¼Œä¿ƒè¿›å›¢é˜Ÿçš„é€æ˜åº¦å’Œè‡ªæˆ‘ç»„ç»‡èƒ½åŠ›ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç®¡ç†é¡¹ç›®å’Œäº¤ä»˜æœ‰ä»·å€¼çš„æˆæœã€‚\nå®¢æˆ·åé¦ˆå’Œè¿­ä»£æ”¹è¿›ï¼šé¼“åŠ±ä¸å®¢æˆ·ä¿æŒç´§å¯†æ²Ÿé€šï¼ŒåŠæ—¶è·å–åé¦ˆå¹¶è¿›è¡Œè¿­ä»£æ”¹è¿›ã€‚é€šè¿‡æŒç»­åé¦ˆå’Œæ”¹è¿›ï¼Œä¸æ–­æé«˜è½¯ä»¶çš„è´¨é‡å’Œæ»¡è¶³å®¢æˆ·çš„éœ€æ±‚ã€‚\nä»¥ä¸‹æ˜¯å®¢æˆ·åé¦ˆå’Œè¿­ä»£æ”¹è¿›çš„ä¸€èˆ¬æµç¨‹ï¼š\næ”¶é›†å®¢æˆ·åé¦ˆï¼šä¸å®¢æˆ·å’Œåˆ©ç›Šç›¸å…³è€…è¿›è¡Œæ²Ÿé€šï¼Œæ”¶é›†ä»–ä»¬å¯¹äº§å“çš„æ„è§ã€å»ºè®®å’Œéœ€æ±‚ã€‚å¯ä»¥é€šè¿‡é¢å¯¹é¢çš„ä¼šè®®ã€ç”¨æˆ·è°ƒæŸ¥ã€ç”¨æˆ·æµ‹è¯•ã€ç”¨æˆ·åˆ†æç­‰æ–¹å¼è·å–åé¦ˆã€‚ åˆ†æå’Œä¼˜å…ˆçº§æ’åºï¼šå¯¹æ”¶é›†åˆ°çš„åé¦ˆè¿›è¡Œåˆ†æå’Œè¯„ä¼°ï¼Œç†è§£å®¢æˆ·éœ€æ±‚çš„é‡è¦æ€§å’Œç´§è¿«æ€§ã€‚æ ¹æ®åé¦ˆçš„ä»·å€¼å’Œä¼˜å…ˆçº§ï¼Œå°†å…¶å½’ç±»å¹¶ç¡®å®šä¸‹ä¸€æ­¥çš„è¡ŒåŠ¨è®¡åˆ’ã€‚ åˆ¶å®šè¿­ä»£è®¡åˆ’ï¼šåŸºäºå®¢æˆ·åé¦ˆå’Œä¼˜å…ˆçº§ï¼Œåˆ¶å®šä¸‹ä¸€ä¸ªè¿­ä»£å‘¨æœŸçš„è®¡åˆ’ã€‚ç¡®å®šè¦åœ¨ä¸‹ä¸€ä¸ªè¿­ä»£ä¸­æ”¹è¿›ã€æ–°å¢æˆ–è°ƒæ•´çš„åŠŸèƒ½å’Œä»»åŠ¡ã€‚ è¿­ä»£å¼€å‘å’Œæµ‹è¯•ï¼šæ ¹æ®åˆ¶å®šçš„è®¡åˆ’ï¼Œå¼€å±•è¿­ä»£å¼€å‘å’Œæµ‹è¯•å·¥ä½œã€‚åœ¨æ¯ä¸ªè¿­ä»£å‘¨æœŸç»“æŸæ—¶ï¼Œäº§ç”Ÿä¸€ä¸ªå¯éƒ¨ç½²çš„è½¯ä»¶å¢é‡ï¼Œä»¥ä¾¿å®¢æˆ·è¿›è¡Œè¯„ä¼°å’Œåé¦ˆã€‚ å®¢æˆ·è¯„ä¼°å’Œåé¦ˆï¼šå°†è¿­ä»£ç»“æŸåçš„å¢é‡äº¤ä»˜ç»™å®¢æˆ·è¿›è¡Œè¯„ä¼°ã€‚å®¢æˆ·å¯ä»¥é€šè¿‡ä½¿ç”¨äº§å“ã€è¿›è¡Œæµ‹è¯•ã€æä¾›æ„è§å’Œå»ºè®®ç­‰æ–¹å¼æä¾›åé¦ˆã€‚ è¿­ä»£æ”¹è¿›ï¼šæ ¹æ®å®¢æˆ·çš„è¯„ä¼°å’Œåé¦ˆï¼Œå›¢é˜Ÿè¿›è¡Œè¿­ä»£æ”¹è¿›ã€‚æ ¹æ®åé¦ˆï¼Œä¿®å¤é—®é¢˜ã€è°ƒæ•´åŠŸèƒ½ã€ä¼˜åŒ–ç”¨æˆ·ä½“éªŒç­‰ã€‚è¿™äº›æ”¹è¿›ä¼šçº³å…¥ä¸‹ä¸€ä¸ªè¿­ä»£çš„è®¡åˆ’ä¸­ã€‚ åå¤è¿­ä»£ï¼šé‡å¤ä»¥ä¸Šæ­¥éª¤ï¼Œä¸æ–­æ”¶é›†å®¢æˆ·åé¦ˆï¼Œè¿›è¡Œæ”¹è¿›ï¼Œå¹¶æŒç»­äº¤ä»˜å¢é‡ã€‚æ¯ä¸ªè¿­ä»£éƒ½å¯ä»¥å¸¦æ¥æ›´å¥½çš„äº§å“ç‰ˆæœ¬å’Œæ›´æ»¡æ„çš„ç”¨æˆ·ä½“éªŒã€‚ é€šè¿‡å®¢æˆ·åé¦ˆå’Œè¿­ä»£æ”¹è¿›çš„å¾ªç¯ï¼Œå›¢é˜Ÿèƒ½å¤Ÿæ›´å¥½åœ°ç†è§£å®¢æˆ·éœ€æ±‚ï¼ŒåŠæ—¶è°ƒæ•´äº§å“æ–¹å‘å’ŒåŠŸèƒ½ï¼Œæä¾›æ›´å…·ä»·å€¼çš„äº§å“ã€‚è¿™ç§æŒç»­çš„è¿­ä»£å’Œæ”¹è¿›è¿‡ç¨‹ä½¿å›¢é˜Ÿèƒ½å¤Ÿé€‚åº”å˜åŒ–ã€å¿«é€Ÿå“åº”å®¢æˆ·éœ€æ±‚ï¼Œå¹¶ä¸æ–­æé«˜äº§å“è´¨é‡å’Œç”¨æˆ·æ»¡æ„åº¦ã€‚\næ•æ·å¼€å‘æ–¹æ³•å¯ä»¥æé«˜å›¢é˜Ÿçš„çµæ´»æ€§ã€ååº”é€Ÿåº¦å’Œäº¤ä»˜ä»·å€¼çš„èƒ½åŠ›ã€‚å®ƒé€‚ç”¨äºéœ€æ±‚å˜åŒ–é¢‘ç¹ã€åˆ›æ–°æ€§å¼ºæˆ–å›¢é˜Ÿåä½œé‡è¦çš„é¡¹ç›®ã€‚ç„¶è€Œï¼Œæ•æ·å¼€å‘å¹¶éé€‚ç”¨äºæ‰€æœ‰é¡¹ç›®ï¼Œå› æ­¤åœ¨é€‰æ‹©å’Œå®æ–½æ•æ·å¼€å‘æ—¶ï¼Œéœ€è¦æ ¹æ®å…·ä½“æƒ…å†µè¿›è¡Œè¯„ä¼°å’Œé€‚åº”ã€‚\nDevOps DevOps æ˜¯ä¸€ç§è½¯ä»¶å¼€å‘å’Œè¿ç»´ï¼ˆOperationsï¼‰çš„æ–¹æ³•è®ºå’Œå®è·µï¼Œæ—¨åœ¨é€šè¿‡åŠ å¼ºå¼€å‘å›¢é˜Ÿå’Œè¿ç»´å›¢é˜Ÿä¹‹é—´çš„åä½œå’Œæ•´åˆï¼Œå®ç°å¿«é€Ÿã€å¯é çš„è½¯ä»¶äº¤ä»˜å’ŒæŒç»­æ”¹è¿›ã€‚\nDevOps å¼ºè°ƒä»¥ä¸‹å…³é”®åŸåˆ™å’Œå®è·µï¼š\næ–‡åŒ–å˜é©ï¼šDevOps é¼“åŠ±å¼€å‘å›¢é˜Ÿå’Œè¿ç»´å›¢é˜Ÿä¹‹é—´çš„åä½œã€æ²Ÿé€šå’Œå…±äº«è´£ä»»çš„æ–‡åŒ–å˜é©ã€‚é€šè¿‡æ‰“ç ´ç»„ç»‡å†…çš„å£å’ï¼Œä¿ƒè¿›å›¢é˜Ÿé—´çš„åˆä½œå’Œç†è§£ã€‚ è‡ªåŠ¨åŒ–ï¼šè‡ªåŠ¨åŒ–æ˜¯ DevOps çš„æ ¸å¿ƒè¦ç´ ã€‚é€šè¿‡ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·å’Œæµç¨‹ï¼Œæé«˜è½¯ä»¶äº¤ä»˜çš„é€Ÿåº¦å’Œè´¨é‡ã€‚åŒ…æ‹¬è‡ªåŠ¨åŒ–æ„å»ºã€æµ‹è¯•ã€éƒ¨ç½²ã€ç›‘æ§ç­‰ç¯èŠ‚ã€‚ æŒç»­é›†æˆå’ŒæŒç»­äº¤ä»˜ï¼šæŒç»­é›†æˆï¼ˆContinuous Integrationï¼‰å’ŒæŒç»­äº¤ä»˜ï¼ˆContinuous Deliveryï¼‰æ˜¯ DevOps çš„å…³é”®å®è·µã€‚æŒç»­é›†æˆè¦æ±‚å¼€å‘å›¢é˜Ÿé¢‘ç¹åœ°å°†ä»£ç é›†æˆåˆ°å…±äº«ä»£ç åº“ä¸­ï¼Œå¹¶è¿›è¡Œè‡ªåŠ¨åŒ–çš„æ„å»ºå’Œæµ‹è¯•ã€‚æŒç»­äº¤ä»˜åˆ™è¦æ±‚åœ¨æ¯æ¬¡é›†æˆé€šè¿‡åï¼Œèƒ½å¤Ÿè‡ªåŠ¨ã€å¯é åœ°éƒ¨ç½²è½¯ä»¶åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ã€‚ ç›‘æ§å’Œåé¦ˆï¼šDevOps å¼ºè°ƒå¯¹è½¯ä»¶ç³»ç»Ÿçš„æŒç»­ç›‘æ§å’Œåé¦ˆã€‚é€šè¿‡å®æ—¶ç›‘æµ‹ç³»ç»Ÿçš„æ€§èƒ½ã€ç¨³å®šæ€§å’Œç”¨æˆ·åé¦ˆï¼ŒåŠæ—¶å‘ç°å’Œè§£å†³é—®é¢˜ï¼ŒæŒç»­æ”¹è¿›è½¯ä»¶è´¨é‡å’Œç”¨æˆ·ä½“éªŒã€‚ åŸºç¡€è®¾æ–½å³ä»£ç ï¼šDevOps å€¡å¯¼ä½¿ç”¨ä»£ç å’Œè‡ªåŠ¨åŒ–å·¥å…·æ¥ç®¡ç†å’Œé…ç½®åŸºç¡€è®¾æ–½ï¼Œå®ç°å¼¹æ€§ã€å¯ä¼¸ç¼©çš„éƒ¨ç½²å’Œç®¡ç†ã€‚é€šè¿‡åŸºç¡€è®¾æ–½å³ä»£ç çš„å®è·µï¼Œèƒ½å¤Ÿå¿«é€Ÿæ­å»ºã€ä¿®æ”¹å’Œå¤åˆ¶æ•´ä¸ªç¯å¢ƒã€‚ DevOps çš„ç›®æ ‡æ˜¯ç¼©çŸ­è½¯ä»¶äº¤ä»˜çš„å‘¨æœŸã€æé«˜äº¤ä»˜çš„é¢‘ç‡ã€å¢å¼ºè½¯ä»¶çš„è´¨é‡å’Œå¯é æ€§ï¼Œå¹¶åŠ å¼ºå›¢é˜Ÿä¹‹é—´çš„åä½œå’Œæ²Ÿé€šã€‚é€šè¿‡ DevOps çš„å®è·µï¼Œå¼€å‘å›¢é˜Ÿå’Œè¿ç»´å›¢é˜Ÿèƒ½å¤Ÿæ›´å¥½åœ°å“åº”å˜åŒ–ã€é™ä½é£é™©ã€æé«˜æ•ˆç‡ï¼Œå¹¶ä¸ºç”¨æˆ·æä¾›æ›´å¥½çš„è½¯ä»¶äº§å“å’ŒæœåŠ¡ã€‚\nDevOps å¹¶éå•ä¸€çš„å·¥å…·æˆ–æ–¹æ³•ï¼Œè€Œæ˜¯ä¸€ç§æ•´ä½“çš„æ–‡åŒ–å’Œå®è·µï¼Œå¯ä»¥æ ¹æ®ç»„ç»‡çš„éœ€æ±‚å’Œæƒ…å†µè¿›è¡Œå®šåˆ¶å’Œå®æ–½ã€‚åœ¨å®è·µä¸­ï¼Œå¸¸è§çš„ DevOps å·¥å…·åŒ…æ‹¬ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆå¦‚ Gitï¼‰ã€è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ï¼ˆå¦‚ Jenkinsï¼‰ã€é…ç½®ç®¡ç†å·¥å…·ï¼ˆå¦‚ Ansibleï¼‰ã€å®¹å™¨åŒ–å¹³å°ï¼ˆå¦‚ Dockerã€Kubernetesï¼‰ç­‰ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/08/21/the-software-development-process/","summary":"è½¯ä»¶å¼€å‘æµç¨‹å’Œå¸¸ç”¨å¼€å‘æ–¹æ³•ï¼Œå¦‚æ•æ·å¼€å‘å’Œ DevOpsï¼Œå¯¹äºæ¶æ„å¸ˆæ¥è¯´éå¸¸é‡è¦ã€‚ä¸‹é¢æˆ‘å°†ç®€è¦ä»‹ç»è¿™äº›æ¦‚å¿µï¼š\nè½¯ä»¶å¼€å‘æµç¨‹ï¼š\nè½¯ä»¶å¼€å‘æµç¨‹æ˜¯æŒ‡åœ¨å¼€å‘è½¯ä»¶æ—¶ï¼ŒæŒ‰ç…§ä¸€å®šçš„æ­¥éª¤å’Œé˜¶æ®µè¿›è¡Œå·¥ä½œçš„è¿‡ç¨‹ã€‚å¸¸è§çš„è½¯ä»¶å¼€å‘æµç¨‹åŒ…æ‹¬ç€‘å¸ƒæ¨¡å‹ã€è¿­ä»£æ¨¡å‹å’Œå¢é‡æ¨¡å‹ç­‰ã€‚è¿™äº›æµç¨‹ä»¥ä¸åŒçš„æ–¹å¼ç»„ç»‡å’Œç®¡ç†å¼€å‘è¿‡ç¨‹ï¼ŒåŒ…æ‹¬éœ€æ±‚åˆ†æã€è®¾è®¡ã€ç¼–ç ã€æµ‹è¯•å’Œéƒ¨ç½²ç­‰é˜¶æ®µã€‚\næ•æ·å¼€å‘ï¼š\næ•æ·å¼€å‘æ˜¯ä¸€ç§è¿­ä»£å’Œå¢é‡çš„è½¯ä»¶å¼€å‘æ–¹æ³•ï¼Œå¼ºè°ƒå›¢é˜Ÿåä½œã€å¿«é€Ÿå“åº”å˜åŒ–å’ŒæŒç»­äº¤ä»˜ã€‚æ•æ·å¼€å‘å¼ºè°ƒé€šè¿‡è¿­ä»£å‘¨æœŸï¼ˆå¦‚ Scrum ä¸­çš„ Sprintï¼‰æ¥å¼€å‘è½¯ä»¶ï¼Œæ¯ä¸ªè¿­ä»£éƒ½ä¼šäº§ç”Ÿå¯éƒ¨ç½²çš„è½¯ä»¶åŠŸèƒ½ã€‚å¸¸è§çš„æ•æ·æ–¹æ³•åŒ…æ‹¬ Scrumã€XPï¼ˆæé™ç¼–ç¨‹ï¼‰å’Œ Kanban ç­‰ã€‚\nDevOpsï¼š\nDevOps æ˜¯ä¸€ç§è½¯ä»¶å¼€å‘å’Œè¿ç»´çš„æ–¹æ³•è®ºï¼Œæ—¨åœ¨é€šè¿‡è‡ªåŠ¨åŒ–å’Œåä½œæ¥åŠ é€Ÿè½¯ä»¶äº¤ä»˜å’Œæé«˜è´¨é‡ã€‚DevOps å¼ºè°ƒå¼€å‘å›¢é˜Ÿå’Œè¿ç»´å›¢é˜Ÿä¹‹é—´çš„åä½œå’Œå…±äº«è´£ä»»ï¼Œå€ŸåŠ©è‡ªåŠ¨åŒ–å·¥å…·å’Œæµç¨‹æ¥å®ç°æŒç»­é›†æˆã€æŒç»­äº¤ä»˜å’ŒæŒç»­éƒ¨ç½²ã€‚\nå¼€å‘æµç¨‹ è½¯ä»¶å¼€å‘æµç¨‹é€šå¸¸åŒ…æ‹¬ä»¥ä¸‹é˜¶æ®µï¼š\néœ€æ±‚æ”¶é›†ï¼šæ”¶é›†å’Œè®°å½•è½¯ä»¶çš„åŠŸèƒ½å’ŒéåŠŸèƒ½æ€§éœ€æ±‚ã€‚ åˆ†æä¸è§„åˆ’ï¼šåˆ†æéœ€æ±‚å¹¶è§„åˆ’å¼€å‘è¿‡ç¨‹ï¼ŒåŒ…æ‹¬èµ„æºåˆ†é…ã€æ—¶é—´è¡¨å’Œäº¤ä»˜ç‰©ã€‚ è®¾è®¡ï¼šåŸºäºéœ€æ±‚åˆ›å»ºè½¯ä»¶æ¶æ„ã€æ¨¡å—å’Œç»„ä»¶çš„è¯¦ç»†è®¾è®¡ã€‚ å®ç°ï¼šç¼–å†™ä»£ç å¹¶é›†æˆè®¾è®¡çš„ç»„ä»¶ï¼Œè¿›è¡Œè½¯ä»¶å¼€å‘ã€‚ æµ‹è¯•ï¼šè¿›è¡Œå„ç§æµ‹è¯•æ´»åŠ¨ï¼Œå¦‚å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•å’Œç³»ç»Ÿæµ‹è¯•ï¼Œç¡®ä¿è½¯ä»¶æŒ‰é¢„æœŸåŠŸèƒ½ã€‚ éƒ¨ç½²ï¼šå‘å¸ƒè½¯ä»¶å¹¶åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å‘æœ€ç»ˆç”¨æˆ·æä¾›ä½¿ç”¨ã€‚ ç»´æŠ¤ä¸æ”¯æŒï¼šåœ¨éƒ¨ç½²åæä¾›æŒç»­çš„ç»´æŠ¤ã€é”™è¯¯ä¿®å¤å’Œæ”¯æŒã€‚ åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œéµå¾ªç‰ˆæœ¬æ§åˆ¶ã€æ–‡æ¡£åŒ–å’Œåä½œç­‰æœ€ä½³å®è·µæ˜¯éå¸¸é‡è¦çš„ï¼Œä»¥ç¡®ä¿è½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸçš„é¡ºåˆ©å’Œé«˜æ•ˆè¿›è¡Œã€‚\nå¸¸è§çš„è½¯ä»¶å¼€å‘æµç¨‹åŒ…æ‹¬ç€‘å¸ƒæ¨¡å‹ã€è¿­ä»£æ¨¡å‹å’Œå¢é‡æ¨¡å‹ç­‰ï¼š\nç€‘å¸ƒæ¨¡å‹ï¼ˆWaterfall Modelï¼‰ï¼š ç€‘å¸ƒæ¨¡å‹æ˜¯ä¸€ç§çº¿æ€§é¡ºåºçš„è½¯ä»¶å¼€å‘æµç¨‹ï¼ŒæŒ‰ç…§å›ºå®šçš„é˜¶æ®µä¾æ¬¡æ‰§è¡Œï¼Œæ¯ä¸ªé˜¶æ®µçš„è¾“å‡ºä½œä¸ºä¸‹ä¸€ä¸ªé˜¶æ®µçš„è¾“å…¥ã€‚å…¸å‹çš„é˜¶æ®µåŒ…æ‹¬éœ€æ±‚åˆ†æã€ç³»ç»Ÿè®¾è®¡ã€ç¼–ç ã€æµ‹è¯•å’Œç»´æŠ¤ç­‰ã€‚ç€‘å¸ƒæ¨¡å‹é€‚ç”¨äºéœ€æ±‚ç¨³å®šä¸”è¾ƒå°è§„æ¨¡çš„é¡¹ç›®ï¼Œä½†ç¼ºä¹çµæ´»æ€§å’Œé€‚åº”å˜åŒ–çš„èƒ½åŠ›ã€‚\nä¸‹é¢æ˜¯ç€‘å¸ƒæ¨¡å‹çš„å…¸å‹é˜¶æ®µï¼š\néœ€æ±‚åˆ†æé˜¶æ®µï¼šåœ¨è¿™ä¸ªé˜¶æ®µï¼Œä¸ç”¨æˆ·å’Œåˆ©ç›Šç›¸å…³è€…ä¸€èµ·æ”¶é›†å’Œæ˜ç¡®è½¯ä»¶ç³»ç»Ÿçš„éœ€æ±‚ã€‚å®šä¹‰ç³»ç»Ÿçš„åŠŸèƒ½å’Œæ€§èƒ½è¦æ±‚ï¼Œå¹¶ç¼–å†™è¯¦ç»†çš„éœ€æ±‚è§„æ ¼è¯´æ˜ä¹¦ã€‚ ç³»ç»Ÿè®¾è®¡é˜¶æ®µï¼šåœ¨éœ€æ±‚åˆ†æå®Œæˆåï¼Œè¿›è¡Œç³»ç»Ÿè®¾è®¡ã€‚è¿™åŒ…æ‹¬å®šä¹‰ç³»ç»Ÿçš„æ•´ä½“æ¶æ„ã€æ¨¡å—åˆ’åˆ†ã€æ•°æ®ç»“æ„å’Œç®—æ³•è®¾è®¡ç­‰ã€‚è®¾è®¡ç»“æœé€šå¸¸ä»¥æ–‡æ¡£å½¢å¼å‘ˆç°ã€‚ ç¼–ç é˜¶æ®µï¼šåœ¨ç³»ç»Ÿè®¾è®¡å®Œæˆåï¼Œå¼€å‘å›¢é˜Ÿå¼€å§‹å®é™…çš„ç¼–ç å·¥ä½œã€‚æ ¹æ®è®¾è®¡æ–‡æ¡£ï¼Œå¼€å‘äººå‘˜ç¼–å†™ä»£ç å¹¶å®ç°ç³»ç»Ÿçš„å„ä¸ªåŠŸèƒ½æ¨¡å—ã€‚ æµ‹è¯•é˜¶æ®µï¼šåœ¨ç¼–ç å®Œæˆåï¼Œè¿›è¡Œç³»ç»Ÿæµ‹è¯•ã€‚æµ‹è¯•äººå‘˜æ ¹æ®éœ€æ±‚å’Œè®¾è®¡è§„èŒƒæ‰§è¡ŒåŠŸèƒ½æµ‹è¯•ã€é›†æˆæµ‹è¯•å’Œç³»ç»Ÿæµ‹è¯•ï¼Œä»¥éªŒè¯ç³»ç»Ÿçš„æ­£ç¡®æ€§å’Œç¨³å®šæ€§ã€‚ é›†æˆå’Œéƒ¨ç½²é˜¶æ®µï¼šåœ¨æµ‹è¯•é€šè¿‡åï¼Œå°†å„ä¸ªæ¨¡å—è¿›è¡Œé›†æˆï¼Œå¹¶è¿›è¡Œç³»ç»Ÿçº§çš„æµ‹è¯•å’Œéƒ¨ç½²å‡†å¤‡ã€‚ç¡®ä¿æ•´ä¸ªç³»ç»Ÿèƒ½å¤ŸååŒå·¥ä½œï¼Œå¹¶å‡†å¤‡å¥½éƒ¨ç½²åˆ°ç›®æ ‡ç¯å¢ƒä¸­ã€‚ è¿ç»´å’Œç»´æŠ¤é˜¶æ®µï¼šä¸€æ—¦ç³»ç»Ÿéƒ¨ç½²å¹¶æŠ•å…¥ä½¿ç”¨ï¼Œè¿›å…¥è¿ç»´å’Œç»´æŠ¤é˜¶æ®µã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œå›¢é˜Ÿè´Ÿè´£ç›‘æ§ç³»ç»Ÿçš„è¿è¡ŒçŠ¶å†µï¼Œå¤„ç†é—®é¢˜å’Œé”™è¯¯ï¼Œå¹¶è¿›è¡Œå¿…è¦çš„ä¿®å¤å’Œæ›´æ–°ã€‚ ç€‘å¸ƒæ¨¡å‹çš„ç‰¹ç‚¹æ˜¯æ¯ä¸ªé˜¶æ®µçš„å·¥ä½œæ˜¯çº¿æ€§ã€é¡ºåºçš„ï¼Œä¸‹ä¸€ä¸ªé˜¶æ®µçš„å¼€å§‹ä¾èµ–äºå‰ä¸€ä¸ªé˜¶æ®µçš„å®Œæˆã€‚è¿™ç§æ¨¡å‹é€‚åˆéœ€æ±‚ç¨³å®šã€é¡¹ç›®è§„æ¨¡è¾ƒå°ã€æŠ€æœ¯é£é™©è¾ƒä½çš„é¡¹ç›®ã€‚ç„¶è€Œï¼Œç€‘å¸ƒæ¨¡å‹ç¼ºä¹çµæ´»æ€§å’Œå¯¹å˜åŒ–çš„é€‚åº”èƒ½åŠ›ï¼Œéš¾ä»¥åº”å¯¹éœ€æ±‚å˜æ›´å’Œé¡¹ç›®å»¶æœŸç­‰é—®é¢˜ã€‚\nå› æ­¤ï¼Œåœ¨é¢å¯¹éœ€æ±‚å˜åŒ–é¢‘ç¹ã€é¡¹ç›®å¤æ‚åº¦é«˜ã€é£é™©è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œæ•æ·å¼€å‘æ–¹æ³•å¦‚ Scrum å’Œ Kanban ç­‰æ›´ä¸ºé€‚ç”¨ï¼Œå®ƒä»¬å¼ºè°ƒè¿­ä»£ã€å¢é‡å’ŒæŒç»­äº¤ä»˜ï¼Œèƒ½æ›´å¥½åœ°æ»¡è¶³å®¢æˆ·éœ€æ±‚å¹¶å¿«é€Ÿå“åº”å˜åŒ–ã€‚\nè¿­ä»£æ¨¡å‹ï¼ˆIterative Modelï¼‰ï¼š è¿­ä»£æ¨¡å‹å¼ºè°ƒé€šè¿‡å¤šä¸ªè¿­ä»£å‘¨æœŸæ¥é€æ­¥æ„å»ºå’Œå®Œå–„è½¯ä»¶ã€‚æ¯ä¸ªè¿­ä»£å‘¨æœŸåŒ…æ‹¬éœ€æ±‚åˆ†æã€è®¾è®¡ã€ç¼–ç ã€æµ‹è¯•å’Œéƒ¨ç½²ç­‰é˜¶æ®µï¼Œæ¯ä¸ªè¿­ä»£éƒ½ä¼šäº§ç”Ÿå¯éƒ¨ç½²çš„è½¯ä»¶ç‰ˆæœ¬ã€‚è¿­ä»£æ¨¡å‹é€‚ç”¨äºéœ€æ±‚ä¸å®Œå…¨æ˜ç¡®æˆ–å¯èƒ½å˜åŒ–çš„é¡¹ç›®ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°é€‚åº”å˜åŒ–å’Œå¿«é€Ÿåé¦ˆã€‚\nä»¥ä¸‹æ˜¯è¿­ä»£æ¨¡å‹çš„ä¸€èˆ¬æµç¨‹ï¼š\né˜¶æ®µè§„åˆ’ï¼šç¡®å®šæ¯ä¸ªè¿­ä»£å‘¨æœŸçš„ç›®æ ‡ã€èŒƒå›´å’Œè®¡åˆ’ã€‚è¿™åŒ…æ‹¬ç¡®å®šè¦å¼€å‘çš„åŠŸèƒ½ã€åˆ†é…èµ„æºã€åˆ¶å®šæ—¶é—´è¡¨ç­‰ã€‚ éœ€æ±‚åˆ†æï¼šåœ¨æ¯ä¸ªè¿­ä»£çš„å¼€å§‹é˜¶æ®µï¼Œä¸ç”¨æˆ·å’Œåˆ©ç›Šç›¸å…³è€…ä¸€èµ·æ”¶é›†å’Œåˆ†æéœ€æ±‚ï¼Œå¹¶æ˜ç¡®æ¯ä¸ªè¿­ä»£çš„åŠŸèƒ½å’Œä¼˜å…ˆçº§ã€‚ è®¾è®¡å’Œå¼€å‘ï¼šæ ¹æ®éœ€æ±‚åˆ†æçš„ç»“æœï¼Œè¿›è¡Œç³»ç»Ÿè®¾è®¡å’Œå¼€å‘å·¥ä½œã€‚åœ¨æ¯ä¸ªè¿­ä»£ä¸­ï¼Œç³»ç»Ÿçš„æŸä¸ªéƒ¨åˆ†ä¼šè¢«è®¾è®¡ã€å¼€å‘å’Œæµ‹è¯•ã€‚ æµ‹è¯•å’ŒéªŒè¯ï¼šåœ¨æ¯ä¸ªè¿­ä»£å‘¨æœŸç»“æŸæ—¶ï¼Œè¿›è¡Œç³»ç»Ÿçš„å†…éƒ¨æµ‹è¯•å’ŒéªŒè¯ã€‚ç¡®ä¿å¼€å‘çš„åŠŸèƒ½ç¬¦åˆéœ€æ±‚ï¼Œå¹¶æ»¡è¶³é¢„æœŸçš„è´¨é‡æ ‡å‡†ã€‚ è¯„å®¡å’Œåé¦ˆï¼šåœ¨æ¯ä¸ªè¿­ä»£å‘¨æœŸç»“æŸåï¼Œä¸ç”¨æˆ·å’Œåˆ©ç›Šç›¸å…³è€…è¿›è¡Œè¯„å®¡å’Œåé¦ˆã€‚ä»–ä»¬æä¾›å¯¹å½“å‰åŠŸèƒ½çš„è¯„ä»·å’Œå»ºè®®ï¼Œä»¥æŒ‡å¯¼ä¸‹ä¸€ä¸ªè¿­ä»£çš„å¼€å‘å·¥ä½œã€‚ è¿­ä»£è°ƒæ•´ï¼šæ ¹æ®ç”¨æˆ·çš„åé¦ˆå’Œè¯„å®¡ç»“æœï¼Œå¯¹ä¸‹ä¸€ä¸ªè¿­ä»£çš„è®¡åˆ’è¿›è¡Œè°ƒæ•´å’Œä¼˜åŒ–ã€‚å¯èƒ½éœ€è¦é‡æ–°å®šä¹‰éœ€æ±‚ã€è°ƒæ•´åŠŸèƒ½ä¼˜å…ˆçº§ã€å¢åŠ æ–°çš„éœ€æ±‚ç­‰ã€‚ é‡å¤è¿­ä»£ï¼šé€šè¿‡ä¸æ–­é‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œæ¯ä¸ªè¿­ä»£å‘¨æœŸéƒ½ä¼šé€æ­¥å¢åŠ ç³»ç»Ÿçš„åŠŸèƒ½ã€å®Œå–„ç³»ç»Ÿçš„æ€§èƒ½ï¼Œå¹¶åœ¨æ¯ä¸ªè¿­ä»£ä¸­äº¤ä»˜ä¸€ä¸ªå¯ç”¨çš„è½¯ä»¶å¢é‡ã€‚ è¿­ä»£æ¨¡å‹çš„ä¼˜åŠ¿åœ¨äºèƒ½å¤Ÿå¿«é€Ÿå“åº”å˜åŒ–å’Œä¸æ–­æä¾›å¢å€¼ã€‚å®ƒå…è®¸åœ¨å¼€å‘è¿‡ç¨‹ä¸­çµæ´»è°ƒæ•´éœ€æ±‚ï¼Œå¹¶é€šè¿‡æ¯ä¸ªè¿­ä»£çš„åé¦ˆå’Œè¯„å®¡æ¥æ”¹è¿›äº§å“ã€‚ç„¶è€Œï¼Œè¿­ä»£æ¨¡å‹ä¹Ÿéœ€è¦é€‚å½“çš„è®¡åˆ’å’Œç®¡ç†ï¼Œä»¥ç¡®ä¿æ¯ä¸ªè¿­ä»£éƒ½èƒ½æŒ‰æ—¶äº¤ä»˜ï¼Œå¹¶æ§åˆ¶å¼€å‘è¿‡ç¨‹ä¸­çš„é£é™©ã€‚\næ•æ·æ–¹æ³•å¦‚ Scrum å’Œ Kanban æ˜¯è¿­ä»£æ¨¡å‹çš„å…¸å‹å®è·µï¼Œå®ƒä»¬æ›´åŠ å¼ºè°ƒå›¢é˜Ÿçš„åä½œã€è‡ªç»„ç»‡å’ŒæŒç»­äº¤ä»˜ï¼Œé€‚ç”¨äºéœ€æ±‚å˜åŒ–é¢‘ç¹å’Œé¡¹ç›®å¤æ‚åº¦è¾ƒé«˜çš„ç¯å¢ƒ\nå¢é‡æ¨¡å‹ï¼ˆIncremental Modelï¼‰ï¼š å¢é‡æ¨¡å‹å°†è½¯ä»¶æŒ‰æ¨¡å—æˆ–åŠŸèƒ½è¿›è¡Œåˆ’åˆ†ï¼Œæ¯ä¸ªæ¨¡å—æˆ–åŠŸèƒ½è¢«ç§°ä¸ºä¸€ä¸ªå¢é‡ï¼Œé€šè¿‡é€æ­¥æ·»åŠ å¢é‡æ¥é€æ¸æ„å»ºå®Œæ•´çš„è½¯ä»¶ç³»ç»Ÿã€‚æ¯ä¸ªå¢é‡éƒ½ç»å†éœ€æ±‚åˆ†æã€è®¾è®¡ã€å¼€å‘å’Œæµ‹è¯•ç­‰é˜¶æ®µã€‚å¢é‡æ¨¡å‹é€‚ç”¨äºå¤§è§„æ¨¡é¡¹ç›®å’Œéœ€è¦åˆ†é˜¶æ®µäº¤ä»˜çš„æƒ…å†µï¼Œå¯ä»¥æä¾›æ›´æ—©çš„ä»·å€¼äº¤ä»˜å’Œæ›´å¥½çš„é£é™©ç®¡ç†ã€‚\nä»¥ä¸‹æ˜¯å¢é‡æ¨¡å‹çš„ä¸€èˆ¬æµç¨‹ï¼š\né˜¶æ®µåˆ’åˆ†ï¼šå°†æ•´ä¸ªè½¯ä»¶ç³»ç»Ÿåˆ’åˆ†ä¸ºå¤šä¸ªå¢é‡ï¼Œæ¯ä¸ªå¢é‡éƒ½ä»£è¡¨ä¸€ä¸ªå¯ç”¨çš„è½¯ä»¶éƒ¨åˆ†ã€‚åˆ’åˆ†çš„æ–¹å¼å¯ä»¥åŸºäºåŠŸèƒ½ã€æ¨¡å—ã€ä¸šåŠ¡æµç¨‹ç­‰æ¥å®šä¹‰ã€‚ éœ€æ±‚åˆ†æï¼šåœ¨æ¯ä¸ªå¢é‡å¼€å§‹æ—¶ï¼Œä¸ç”¨æˆ·å’Œåˆ©ç›Šç›¸å…³è€…ä¸€èµ·æ”¶é›†å’Œæ˜ç¡®å…³äºè¯¥å¢é‡çš„éœ€æ±‚å’ŒåŠŸèƒ½ã€‚ç¡®å®šæ¯ä¸ªå¢é‡çš„ä¼˜å…ˆçº§å’ŒèŒƒå›´ã€‚ è®¾è®¡å’Œå¼€å‘ï¼šæ ¹æ®éœ€æ±‚åˆ†æçš„ç»“æœï¼Œè¿›è¡Œç³»ç»Ÿè®¾è®¡å’Œå¼€å‘å·¥ä½œã€‚æ¯ä¸ªå¢é‡çš„è®¾è®¡å’Œå¼€å‘éƒ½æ˜¯ç‹¬ç«‹è¿›è¡Œçš„ï¼Œå¯ä»¥é‡‡ç”¨é€‚åˆçš„å¼€å‘æ–¹æ³•å’ŒæŠ€æœ¯ã€‚ æµ‹è¯•å’ŒéªŒè¯ï¼šåœ¨æ¯ä¸ªå¢é‡å®Œæˆå¼€å‘åï¼Œè¿›è¡Œç³»ç»Ÿçš„æµ‹è¯•å’ŒéªŒè¯ã€‚ç¡®ä¿è¯¥å¢é‡çš„åŠŸèƒ½ç¬¦åˆéœ€æ±‚ï¼Œå¹¶æ»¡è¶³é¢„æœŸçš„è´¨é‡æ ‡å‡†ã€‚ å¢é‡äº¤ä»˜ï¼šç»è¿‡æµ‹è¯•å’ŒéªŒè¯åï¼Œå°†è¯¥å¢é‡äº¤ä»˜ç»™ç”¨æˆ·æˆ–åˆ©ç›Šç›¸å…³è€…ã€‚ç”¨æˆ·å¯ä»¥å¼€å§‹ä½¿ç”¨è¯¥å¢é‡ï¼Œå¹¶æä¾›åé¦ˆå’Œå»ºè®®ä»¥è¿›ä¸€æ­¥æ”¹è¿›å’Œä¼˜åŒ–ã€‚ å¢é‡æ•´åˆï¼šåœ¨å®Œæˆä¸€ä¸ªå¢é‡çš„äº¤ä»˜åï¼Œå°†è¯¥å¢é‡ä¸ä¹‹å‰äº¤ä»˜çš„å¢é‡è¿›è¡Œæ•´åˆã€‚ç¡®ä¿ä¸åŒå¢é‡ä¹‹é—´çš„åŠŸèƒ½å’Œæ¨¡å—å¯ä»¥ååŒå·¥ä½œï¼Œå¹¶å½¢æˆä¸€ä¸ªå®Œæ•´çš„è½¯ä»¶ç³»ç»Ÿã€‚ é€šè¿‡ä¸æ–­é‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œæ¯ä¸ªå¢é‡éƒ½é€æ­¥å¢åŠ ç³»ç»Ÿçš„åŠŸèƒ½å’Œå®Œå–„ç³»ç»Ÿçš„æ€§èƒ½ã€‚å¢é‡æ¨¡å‹å…è®¸åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¿«é€Ÿäº¤ä»˜å¯ç”¨çš„è½¯ä»¶éƒ¨åˆ†ï¼Œå¹¶æ ¹æ®ç”¨æˆ·çš„åé¦ˆå’Œéœ€æ±‚å˜åŒ–è¿›è¡Œè°ƒæ•´ã€‚å®ƒå¯ä»¥æé«˜è½¯ä»¶å¼€å‘çš„å¯è§æ€§å’Œç”¨æˆ·æ»¡æ„åº¦ï¼Œé™ä½é¡¹ç›®é£é™©ã€‚\nä¸è¿­ä»£æ¨¡å‹ç›¸æ¯”ï¼Œå¢é‡æ¨¡å‹æ›´åŠ å¼ºè°ƒä¸åŒå¢é‡ä¹‹é—´çš„ç‹¬ç«‹æ€§å’Œå¯ç”¨æ€§ã€‚æ¯ä¸ªå¢é‡éƒ½æ˜¯ä¸€ä¸ªå¯ç”¨çš„è½¯ä»¶éƒ¨åˆ†ï¼Œç”¨æˆ·å¯ä»¥åœ¨å¼€å‘è¿‡ç¨‹ä¸­é€æ­¥ä½¿ç”¨å’Œè¯„ä¼°ç³»ç»ŸåŠŸèƒ½ã€‚ç„¶è€Œï¼Œå¢é‡æ¨¡å‹å¯èƒ½éœ€è¦æ›´å¥½çš„è§„åˆ’å’Œç®¡ç†ï¼Œä»¥ç¡®ä¿å¢é‡ä¹‹é—´çš„é›†æˆå’Œæ•´åˆé¡ºåˆ©è¿›è¡Œï¼Œå¹¶é¿å…ç³»ç»Ÿæ¶æ„ä¸Šçš„é—®é¢˜ã€‚\næ•æ·å¼€å‘ æ•æ·å¼€å‘ï¼ˆAgile Developmentï¼‰æ˜¯ä¸€ç§ä»¥è¿­ä»£ã€å¢é‡å’Œåä½œä¸ºæ ¸å¿ƒçš„è½¯ä»¶å¼€å‘æ–¹æ³•ã€‚å®ƒå¼ºè°ƒå›¢é˜Ÿåˆä½œã€å¿«é€Ÿå“åº”å˜åŒ–å’ŒæŒç»­äº¤ä»˜ï¼Œä»¥æé«˜å®¢æˆ·æ»¡æ„åº¦å’Œé¡¹ç›®æˆåŠŸç‡ã€‚ä»¥ä¸‹æ˜¯æ•æ·å¼€å‘çš„æ ¸å¿ƒåŸåˆ™å’Œå¸¸ç”¨å®è·µï¼š\næ ¸å¿ƒåŸåˆ™ï¼š\nä¸ªä½“å’Œäº’åŠ¨èƒœè¿‡æµç¨‹å’Œå·¥å…·ï¼ˆIndividuals and interactions over processes and toolsï¼‰ï¼šå¼ºè°ƒå›¢é˜Ÿæˆå‘˜ä¹‹é—´çš„æ²Ÿé€šã€åˆä½œå’Œç›¸äº’æ”¯æŒï¼Œé‡è§†äººä¸äººä¹‹é—´çš„äº¤æµã€‚ å¯å·¥ä½œçš„è½¯ä»¶èƒœè¿‡è¯¦å°½çš„æ–‡æ¡£ï¼ˆWorking software over comprehensive documentationï¼‰ï¼šæ³¨é‡ä»¥å¯å·¥ä½œçš„è½¯ä»¶ä½œä¸ºéªŒè¯å’Œæ²Ÿé€šçš„æ‰‹æ®µï¼Œè€Œä¸æ˜¯è¿‡å¤šä¾èµ–ç¹æ‚çš„æ–‡æ¡£ã€‚ å®¢æˆ·åˆä½œèƒœè¿‡åˆåŒè°ˆåˆ¤ï¼ˆCustomer collaboration over contract negotiationï¼‰ï¼šé¼“åŠ±ä¸å®¢æˆ·å¯†åˆ‡åˆä½œï¼ŒåŠæ—¶è·å–åé¦ˆå¹¶æ ¹æ®éœ€æ±‚å˜åŒ–è¿›è¡Œè°ƒæ•´ã€‚ å“åº”å˜åŒ–èƒœè¿‡éµå¾ªè®¡åˆ’ï¼ˆResponding to change over following a planï¼‰ï¼šçµæ´»åº”å¯¹éœ€æ±‚å˜åŒ–ï¼Œé€šè¿‡è¿­ä»£å’Œå¢é‡çš„æ–¹å¼å¿«é€Ÿé€‚åº”å˜åŒ–çš„ç¯å¢ƒã€‚ å¸¸ç”¨å®è·µï¼š","title":"è½¯ä»¶å¼€å‘æµç¨‹å’Œå¸¸ç”¨å¼€å‘æ–¹æ³•"},{"content":" æ²¡æœ‰äººå¯ä»¥å¦è®¤è¿™æ ·ä¸€ä¸ªäº‹å®ï¼šå®‰å…¨æ€§æ˜¯ç”Ÿäº§å°±ç»ªåº”ç”¨ç¨‹åºçš„ä¸€é¡¹é‡è¦åŠŸèƒ½ã€‚å°½ç®¡æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å†…å­˜èº«ä»½éªŒè¯ã€JDBC èº«ä»½éªŒè¯æˆ–é€šè¿‡ UserDetailsSâ€‹â€‹ervice æ¥ä¿æŠ¤ä¸€ä¸ª Web åº”ç”¨ç¨‹åºçš„å®‰å…¨ã€‚ä½†æ˜¯ï¼Œå½“ä¸€ä¸ªåº”ç”¨ç¨‹åºåœ¨å†…éƒ¨ä½¿ç”¨å…¶ä»–åº”ç”¨ç¨‹åºçš„æœåŠ¡æ—¶ï¼Œä½¿ç”¨ Web æœåŠ¡æ¦‚å¿µå®ç°å®‰å…¨æ€§å°±å˜å¾—å¾ˆé‡è¦ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨å…·æœ‰ç‰¹å®šæœ‰æ•ˆæœŸçš„ä»¤ç‰Œæ¥ä¿æŠ¤æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å°†å­¦ä¹ â€œå¦‚ä½•åœ¨ Spring Boot é¡¹ç›®ä¸­å®ç° JWT èº«ä»½éªŒè¯ï¼Ÿâ€ä»¥æ•´ä½“äº†è§£ JWTï¼ˆJSON Web Tokenï¼‰èº«ä»½éªŒè¯èƒŒåçš„æ¦‚å¿µã€‚\nç”±äº JWT ä»£è¡¨â€œJSON Web Tokenâ€ï¼Œå¾ˆæ˜æ˜¾ï¼Œè¯¥ä»¤ç‰Œä»…ä»¥ JSON å½¢å¼ä¿å­˜æ•°æ®ã€‚\næ­¤å¤–ï¼Œä¸ä¸Šè¿°èº«ä»½éªŒè¯æŠ€æœ¯ä¸åŒï¼ŒJWT å±äºæ— çŠ¶æ€èº«ä»½éªŒè¯ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå®ƒæ²¡æœ‰æ•°æ®ã€‚é€šå¸¸ï¼Œè¿™ç§ç±»å‹çš„èº«ä»½éªŒè¯ç”¨äº Web æœåŠ¡ã€æœåŠ¡å™¨çš„æ°´å¹³æ‰©å±•ï¼Œç”šè‡³åœ¨æŸç§ç¨‹åº¦ä¸Šç”¨äº OAuth æŠ€æœ¯ã€‚ä¸ºäº†è¯´æ˜è¯¥ç½‘ç»œæœåŠ¡ï¼Œè®©æˆ‘ä»¬å¯è§†åŒ–ä»äºšé©¬é€Šé¢„è®¢è®¢å•çš„è¿‡ç¨‹ã€‚åœ¨è¿™é‡Œï¼Œç”¨æˆ·ä¸ Amazon åº”ç”¨ç¨‹åºäº¤äº’ï¼Œè€Œ Amazon åº”ç”¨ç¨‹åºåœ¨å†…éƒ¨é€šè¿‡ Web æœåŠ¡è°ƒç”¨ä¸æ”¯ä»˜ç½‘å…³åº”ç”¨ç¨‹åºäº¤äº’ã€‚\nç°åœ¨è®©æˆ‘ä»¬å¼€å§‹è®¨è®ºæˆ‘ä»¬çš„ä¸»é¢˜â€œå¦‚ä½•åœ¨ Spring Boot é¡¹ç›®ä¸­å®ç° JWT èº«ä»½éªŒè¯ï¼Ÿâ€ä»¥åŠç›¸å…³ç‚¹ã€‚\næ‚¨å¯¹æ•´ç¯‡æ–‡ç« æœ‰ä½•æœŸæœ›ï¼Ÿ è¯»å®Œæœ¬æ–‡åï¼Œæ‚¨å°†èƒ½å¤Ÿå›ç­”ï¼š\nä»€ä¹ˆæ˜¯å®‰å…¨ä¸Šä¸‹æ–‡ä¸­çš„æ— çŠ¶æ€å’Œæœ‰çŠ¶æ€èº«ä»½éªŒè¯ï¼Ÿ æ— çŠ¶æ€è®¤è¯å’Œæœ‰çŠ¶æ€è®¤è¯æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ é‚£ä¹ˆä»€ä¹ˆæ˜¯ Tokenï¼Œä»€ä¹ˆæ˜¯ JWT(JSON Web Token)ï¼Ÿ\nä½¿ç”¨ JWT è®¤è¯æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ\nJWT å†…éƒ¨å¦‚ä½•è¿ä½œï¼Ÿ\næˆ‘ä»¬åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨ JWT èº«ä»½éªŒè¯ï¼Ÿ\næ­¤å¤–ï¼ŒJWT èº«ä»½éªŒè¯å’ŒçŠ¶æ€èº«ä»½éªŒè¯ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\næ­¤å¤–ï¼Œå¦‚ä½•ç”Ÿæˆ JWT ç¼–ç ä»¤ç‰Œä»¥åŠå¦‚ä½•å°†å…¶è§£ç å›æ¥ï¼Ÿ\nå¦‚ä½•åœ¨ Spring Boot é¡¹ç›®ä¸­é€æ­¥å®ç° JWT è®¤è¯ï¼Ÿ\nåœ¨ Spring Boot 3.0 ä¸­ï¼Œå¦‚ä½•åœ¨ä¸ä½¿ç”¨ WebSecurityConfigurerAdapter çš„æƒ…å†µä¸‹ç¼–å†™å®‰å…¨é…ç½®ç±»ï¼Ÿ\næœ€åï¼Œå¦‚ä½•æµ‹è¯•å¯ç”¨ JWT å®‰å…¨çš„åº”ç”¨ç¨‹åºï¼Ÿ\nä»€ä¹ˆæ˜¯æ— çŠ¶æ€å’Œæœ‰çŠ¶æ€èº«ä»½éªŒè¯ï¼Ÿ é€šå¸¸æœ‰ä¸¤ç§ç±»å‹çš„è®¤è¯æŠ€æœ¯ã€‚ä¸¤è€…éƒ½å‘ç”Ÿåœ¨å®¢æˆ·ç«¯æœåŠ¡å™¨æ¦‚å¿µä¸­ï¼ŒæœåŠ¡å™¨ä»…åœ¨èº«ä»½éªŒè¯åæ‰å‘å®¢æˆ·ç«¯æä¾›æœåŠ¡ã€‚è¿™é‡Œçš„å®¢æˆ·ç«¯å¯ä»¥æ˜¯æµè§ˆå™¨ï¼Œä¹Ÿå¯ä»¥æ˜¯å¦ä¸€ä¸ªæœåŠ¡å™¨ã€‚\nçŠ¶æ€è®¤è¯ åœ¨è¿™ç§ç±»å‹çš„èº«ä»½éªŒè¯ä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´æ¶‰åŠä¼šè¯ç®¡ç†ã€‚å½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨è¯·æ±‚æœåŠ¡æ—¶ï¼Œå®ƒé¦–å…ˆç™»å½•åˆ°æœåŠ¡å™¨ã€‚ç„¶åæœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªä¼šè¯å¹¶ä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨è¯¥ä¿¡æ¯ã€‚è¿™ä¸ªä¼šè¯æ˜¯æœåŠ¡å™¨ç«¯çš„ä¸€ç§å†…å­˜ã€‚æˆ‘ä»¬ä¹Ÿç§°å…¶ä¸º HttpSessionï¼Œå› ä¸º Http åè®®ç®¡ç†å®ƒã€‚\næ­¤å¤–ï¼Œä¸ºäº†å“åº”å®¢æˆ·ç«¯è¯·æ±‚ï¼ŒæœåŠ¡å™¨ä»¥ Cookie çš„å½¢å¼å‘å®¢æˆ·ç«¯æä¾›å¸¦æœ‰å“åº”çš„ä¼šè¯ idã€‚è¯¥ cookie å­˜å‚¨åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨ä¸­ã€‚å½“åŒä¸€ä¸ªå®¢æˆ·ç«¯ç¬¬äºŒæ¬¡å‘å‡ºè¯·æ±‚æ—¶ï¼Œè¯·æ±‚å¤´ä¸­ä¹Ÿä¼šå¸¦æœ‰ cookieã€‚å› æ­¤ï¼ŒæœåŠ¡å™¨ä¼šæ£€æŸ¥è¯·æ±‚æ ‡å¤´ï¼Œå¦‚æœåœ¨ cookie ä¸­å‘ç°ç›¸åŒçš„ SIDï¼ˆä¼šè¯ IDï¼‰ï¼Œåˆ™å‡å®šè¯¥è¯·æ±‚æ¥è‡ªåŒä¸€å®¢æˆ·ç«¯ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä¼šè¯ç®¡ç†å°±å‘ç”Ÿäº†ã€‚\nå½“å®¢æˆ·ç«¯ä»æœåŠ¡å™¨æ³¨é”€æ—¶ï¼Œä¼šè¯ä¼šç›¸åº”åœ°è¢«é”€æ¯ã€‚ç»“æœï¼ŒæœåŠ¡å™¨ç›¸åº”åœ°ä»å†…å­˜ä¸­åˆ é™¤ä¼šè¯ä¿¡æ¯ï¼ˆé”®å€¼ï¼‰ã€‚åŒæ ·é‡è¦çš„æ˜¯ï¼Œå¯¹äºæ¯ä¸ªæ–°å®¢æˆ·ç«¯ï¼ŒæœåŠ¡å™¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°ä¼šè¯ï¼ˆå†…å­˜ï¼‰ã€‚\næ— çŠ¶æ€èº«ä»½éªŒè¯ å½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€æœåŠ¡è¯·æ±‚æ—¶ï¼Œå®ƒé¦–å…ˆç™»å½•åˆ°æœåŠ¡å™¨ã€‚å› æ­¤ï¼ŒæœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªä»¤ç‰Œï¼ˆç¼–ç æ ¼å¼çš„æ•°æ®ï¼‰å¹¶å°†å“åº”å‘é€åˆ°å®¢æˆ·ç«¯ã€‚åœ¨å‘å‡ºç¬¬äºŒä¸ªè¯·æ±‚æ—¶ï¼Œå®¢æˆ·ç«¯å°†ç›¸åŒçš„ä»¤ç‰Œä¸è¯·æ±‚ä¸€èµ·å‘é€åˆ°æœåŠ¡å™¨ã€‚ç°åœ¨ï¼ŒæœåŠ¡å™¨ä»è¯·æ±‚ä¸­è¯»å–ä»¤ç‰Œå¹¶éªŒè¯ä»¤ç‰Œã€‚äº‹å®ä¸Šï¼Œä»ç¬¬ä¸€ä¸ªè¯·æ±‚å¼€å§‹ï¼ŒæœåŠ¡å™¨å°±æ£€æŸ¥å®¢æˆ·ç«¯çš„æœ‰æ•ˆç™»å½•ï¼ˆå‡­æ®ï¼‰ã€‚\nå¦‚æœå®ƒæ˜¯æœ‰æ•ˆçš„ç™»å½•ï¼Œé‚£ä¹ˆæœåŠ¡å™¨åªä¼šåˆ›å»ºä¸€ä¸ªä»¤ç‰Œã€‚\næ­¤å¤–ï¼Œåœ¨ç¬¬äºŒä¸ªè¯·æ±‚æ—¶ï¼Œå®ƒä¼šéªŒè¯ä»¤ç‰Œã€‚å¦‚æœä»¤ç‰Œæœ‰æ•ˆï¼Œåˆ™å‘é€è¯·æ±‚çš„å“åº”ï¼Œå¦åˆ™è¦æ±‚å®¢æˆ·ç«¯å†æ¬¡ç™»å½•ã€‚ä½†æ¯ä¸ª Token éƒ½ä¼šæœ‰ä¸€ä¸ªæœ‰æ•ˆæ—¶é—´æ®µï¼Œæ¯”å¦‚ 30 åˆ†é’Ÿã€1 å°æ—¶ç­‰ã€‚æ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼ŒToken çš„æœ‰æ•ˆæœŸå¯ä»¥é…ç½®ã€‚\nå¯¹äº Token æ¥è¯´ï¼Œæ²¡æœ‰æ³¨é”€çš„æ¦‚å¿µã€‚ç›¸åï¼Œå®¢æˆ·ç«¯å¯ä»¥å‘å‡ºè¯·æ±‚å¹¶è·å–å“åº”ï¼Œç›´åˆ°ä»¤ç‰Œè¿‡æœŸã€‚\nä»€ä¹ˆæ˜¯ä»¤ç‰Œã€JWT èº«ä»½éªŒè¯æ˜¯ä»€ä¹ˆä»¥åŠä½¿ç”¨å®ƒçš„å¥½å¤„æ˜¯ä»€ä¹ˆï¼Ÿ ç®€å•æ¥è¯´ï¼ŒToken å°±æ˜¯ä¸€ç§ç¼–ç æ ¼å¼çš„æ•°æ®ã€‚å®ƒå¯ä»¥ä½¿ç”¨å¯†é’¥ï¼ˆä¸€ç§å¯†ç ï¼‰ç”Ÿæˆã€‚ JWT æ˜¯â€œJSON Web Tokenâ€çš„ç¼©å†™ï¼Œå®ƒæ˜¯ç”Ÿæˆä»¤ç‰Œçš„æ ‡å‡†æœºåˆ¶ã€‚å®ƒå®šä¹‰äº†ä¸€ç§ç´§å‡‘ä¸”ç‹¬ç«‹çš„æ–¹å¼ï¼Œä»¥ JSON å¯¹è±¡çš„å½¢å¼åœ¨å„ â€‹â€‹ æ–¹ï¼ˆå¤šä¸ªæœåŠ¡å™¨ï¼‰ä¹‹é—´å®‰å…¨åœ°ä¼ è¾“ä¿¡æ¯ã€‚ JWT ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šæ ‡å¤´ã€æœ‰æ•ˆè´Ÿè½½å’Œç­¾åã€‚æ¯ä¸ªéƒ¨åˆ†éƒ½ç”¨é€—å·åˆ†éš”ã€‚å®ƒæ˜¯ä¸€ä¸ªå¼€æº APIã€‚\nJWT æ¦‚å¿µä¸ä»…å­˜åœ¨äº Java ä¸­ï¼Œä¹Ÿå­˜åœ¨äºå…¶ä»–è¯­è¨€ä¸­ã€‚\nader : åŒ…å« JWT ç‰¹å®šä¿¡æ¯ Payload : æœ‰æ•ˆè´Ÿè½½ï¼ŒåŒ…å«å£°æ˜ï¼ˆå®¢æˆ· IDã€å®¢æˆ·åç§°ã€å‘è¡Œäººåç§°ã€å—ä¼—åç§°ã€å‘è¡Œæ—¥æœŸã€åˆ°æœŸæ—¥æœŸç­‰\u0026hellip;ï¼‰ Signature: ç­¾åï¼Œæ ‡å¤´å’Œæœ‰æ•ˆè´Ÿè½½çš„ Base64 ç¼–ç å½¢å¼ã€‚å¦å¤–ï¼Œç”¨å¯†é’¥ç­¾å ä»¥ä¸‹æ˜¯æ ¼å¼ç¤ºä¾‹ï¼š\naaaaaaaaaaa.bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb.cccccccccccccccccccccccccccccccccc ç¼–ç åçš„ JWT ä¾‹å­ :\neyJhbGciOiJIUzUxMiJ9 .eyJqdGkiOiIzNDMyIiwic3ViIjoiZHMyNTI1IiwiaXNzIjoiQUJDX0x0ZCIsImF1ZCI6IlhZWl9MdGQiLCJpYXQiOjE2MDc0NDI1NzQsImV4cCI6MTYwNzQ0NjE3NH0 .3fIcXIvL9Uz0WtZgaXC95Wj8Hn7ONWKkaaspRwCT6v5Q8QSxZx7hiDQY3klYUMkfe5t2ioasYzEulM_OGc_GEw JWT èº«ä»½éªŒè¯å¦‚ä½•å·¥ä½œï¼Ÿ å½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨è¯·æ±‚æœåŠ¡æ—¶ï¼Œå®ƒé¦–å…ˆç™»å½•åˆ°æœåŠ¡å™¨ã€‚å› æ­¤ï¼ŒæœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªä»¤ç‰Œï¼ˆç¼–ç æ ¼å¼çš„æ•°æ®ï¼‰å¹¶å°†å…¶ä¸å“åº”ä¸€èµ·å‘é€ç»™å®¢æˆ·ç«¯ã€‚åœ¨å‘å‡ºç¬¬äºŒä¸ªè¯·æ±‚æ—¶ï¼Œå®¢æˆ·ç«¯å°†ä»¤ç‰Œä¸è¯·æ±‚ä¸€èµ·å‘é€åˆ°æœåŠ¡å™¨ã€‚ç°åœ¨æœåŠ¡å™¨ä»è¯·æ±‚ä¸­è¯»å–ä»¤ç‰Œå¹¶éªŒè¯ä»¤ç‰Œã€‚åœ¨éªŒè¯å®¢æˆ·ç«¯éšè¯·æ±‚å‘é€çš„ä»¤ç‰Œæ—¶ï¼ŒæœåŠ¡å™¨å†æ¬¡éœ€è¦è¯¥å¯†é’¥æ¥å¯¹å…¶è¿›è¡Œè§£ç ã€‚\næ­¤å¤–ï¼Œä¸ºäº†éªŒè¯ä»¤ç‰ŒæœåŠ¡å™¨å§‹ç»ˆéœ€è¦å¯†é’¥ã€‚å³ä½¿åœ¨æˆåŠŸç™»å½•åï¼ŒæœåŠ¡å™¨ä¹Ÿä»…åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨å¯†é’¥ç”Ÿæˆä»¤ç‰Œã€‚æ€»ä¹‹ï¼ŒæœåŠ¡å™¨åœ¨ç”Ÿæˆä»¤ç‰Œæ—¶ç”šè‡³åœ¨éªŒè¯ä»¤ç‰Œæ—¶ä¹Ÿéœ€è¦å¯†é’¥ã€‚\nä¸çŠ¶æ€èº«ä»½éªŒè¯ä¸åŒï¼Œè¿™é‡ŒæœåŠ¡å™¨ä»…åœ¨æœåŠ¡å™¨ç«¯ç»´æŠ¤ä»¤ç‰Œã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œåœ¨çŠ¶æ€è®¤è¯ä¸­ï¼Œæµè§ˆå™¨ï¼ˆå®¢æˆ·ç«¯ï¼‰ä»¥ cookie çš„å½¢å¼å­˜å‚¨ä¼šè¯ IDã€‚\nå‡è®¾æˆ‘ä»¬é€šè¿‡ JWT åº”ç”¨ç¨‹åºé¢„è®¢è®¢å•ã€‚æ•´ä½“è‡³å°‘éœ€è¦ä¸‰åå‚ä¸è€…æ‰èƒ½å®Œæˆé¢„è®¢ã€‚ç”¨æˆ·ã€äºšé©¬é€Šåº”ç”¨ç¨‹åºå’Œæ”¯ä»˜ç½‘å…³åº”ç”¨ç¨‹åºã€‚è¿™é‡Œæ”¯ä»˜ç½‘å…³åº”ç”¨ç¨‹åºéªŒè¯äºšé©¬é€Šåº”ç”¨ç¨‹åºè€Œä¸æ˜¯å®¢æˆ·ç«¯ã€‚å‘ç”Ÿè¿™ç§æƒ…å†µæ˜¯ç”±äºä»¤ç‰Œèº«ä»½éªŒè¯æŠ€æœ¯ã€‚æ­¤å¤–ï¼Œä¸€æ—¦ä»˜æ¬¾å®Œæˆï¼Œäºšé©¬é€Šåº”ç”¨ç¨‹åºå°†ä¸å†ä½¿ç”¨æ”¯ä»˜ç½‘å…³çš„æœåŠ¡ã€‚å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä»¤ç‰Œèº«ä»½éªŒè¯æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚æœ‰å…³æ™ºå¨æ±¤é€Šçš„æ›´å¤šå†…éƒ¨è¯¦ç»†ä¿¡æ¯ï¼Œè¯·è®¿é—®æ™ºå¨æ±¤é€Šç½‘ç«™ã€‚\nå¦‚ä½•ç”Ÿæˆ JWT ç¼–ç ä»¤ç‰Œå¹¶å†æ¬¡è§£ç ï¼ˆé˜…è¯»å£°æ˜ï¼‰ï¼Ÿ è¿™é‡Œçš„å£°æ˜æ˜¯é€šè¿‡æä¾›ä¸¤ä¸ªè¾“å…¥æ¥è¯»å–æˆ–è§£æ JWT è¯¦ç»†ä¿¡æ¯çš„è¿‡ç¨‹ï¼šä»¤ç‰Œå’Œå¯†é’¥\nä¸ºäº†å®ç°â€œå¦‚ä½•ç”Ÿæˆå’Œè¯»å–å£°æ˜â€çš„ POCï¼ˆæ¦‚å¿µéªŒè¯ï¼‰ï¼Œæˆ‘ä»¬åº”è¯¥è€ƒè™‘ä¸º JWT æ‰¾åˆ°ä¸€ä¸ª JAVA APIã€‚æ¯«æ— ç–‘é—®ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº† jjwt.jar æ¥ä½¿å®ƒæˆä¸ºå¯èƒ½ã€‚ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª POC æ¥é€æ­¥å®ç°æˆ‘ä»¬çš„åŠŸèƒ½ã€‚\næ­¥éª¤#1ï¼šåœ¨ Eclipse æˆ– STS ä¸­åˆ›å»ºä¸€ä¸ªç®€å•çš„ Maven é¡¹ç›®ã€‚ æ‰“å¼€ Eclipse å¹¶é€‰æ‹© File\u0026gt;New\u0026gt;Otherï¼Œç„¶åæœç´¢â€œMaven Projectâ€ã€‚ç„¶åå•å‡»â€œä¸‹ä¸€æ­¥â€ï¼Œé€‰æ‹©â€œåˆ›å»ºä¸€ä¸ªç®€å•é¡¹ç›®â€å¤é€‰æ¡†ã€‚ç°åœ¨ç‚¹å‡»â€œä¸‹ä¸€æ­¥â€ã€‚è¾“å…¥â€œGroup Idâ€å’Œâ€œArtifact idâ€ä½œä¸ºæ‚¨çš„é¡¹ç›®è¯¦ç»†ä¿¡æ¯ã€‚æœ€åç‚¹å‡»â€œå®Œæˆâ€ã€‚\næ­¥éª¤#2ï¼šåœ¨ pom.xml ä¸­åŒ…å« jjwt ä¾èµ–é¡¹ã€‚ åŒ…å«â€œjjwtâ€ä¾èµ–é¡¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚æ­¤å¤–ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ JDK8 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œæ‚¨è¿˜éœ€è¦åŒ…å«â€œjaxbâ€ä¾èµ–é¡¹ã€‚\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;io.jsonwebtoken\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jjwt\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.9.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;javax.xml.bind\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jaxb-api\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.3.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; æ­¥éª¤#3ï¼šåˆ›å»ºç±»å¹¶å®ç°åŠŸèƒ½ å› æ­¤ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸¤ä¸ªç±»ï¼šJWTUtil.java å’Œ JWT_Test.java\nåœ¨ JWTUtil.java ä¸­ï¼Œæˆ‘ä»¬å°†å…·æœ‰å¯ä»¥ä½œä¸ºå®ç”¨ç¨‹åºç±»å·¥ä½œçš„å®ç°é€»è¾‘ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å°†ç›¸åº”åœ°ä» JWT_Test.java æµ‹è¯•æˆ‘ä»¬çš„ POCã€‚\nJWTUtil.java\nackage com.dev.spring.security.jwt; import java.util.Base64; import java.util.Date; import java.util.concurrent.TimeUnit; import io.jsonwebtoken.Claims; import io.jsonwebtoken.Jwts; import io.jsonwebtoken.SignatureAlgorithm; public class JWTUtil { // code to generate Token public static String generateToken(String subject, String secret_key) { return Jwts.builder() .setId(\u0026#34;tk9931\u0026#34;) .setSubject(subject) .setIssuer(\u0026#34;ABC_Ltd\u0026#34;) .setAudience(\u0026#34;XYZ_Ltd\u0026#34;) .setIssuedAt(new Date(System.currentTimeMillis())) .setExpiration(new Date(System.currentTimeMillis() + TimeUnit.HOURS.toMillis(1))) .signWith(SignatureAlgorithm.HS512, Base64.getEncoder().encode(secret_key.getBytes())) .compact(); } //code to get Claims public static Claims getClaims(String token, String secret_key) { return Jwts.parser() .setSigningKey(Base64.getEncoder().encode(secret_key.getBytes())) .parseClaimsJws(token) .getBody(); } } JWT_Test.java\npackage com.dev.spring.security.jwt; import java.util.Base64; import io.jsonwebtoken.Claims; import io.jsonwebtoken.Jwts; public class JWT_Test { private static String secret_key = \u0026#34;J@!gt*K\u0026#34;; public static void main(String[] args) { // code to test generated Token String token= JWTUtil.generateToken(\u0026#34;Token1\u0026#34;, secret_key); System.out.println(\u0026#34;------------------------TOKEN----------------------------------------------------\u0026#34;); System.out.println(token); System.out.println(); System.out.println(\u0026#34;------------------------CLAIMS----------------------------------------------------\u0026#34;); //code to test parsed token : Claims Claims claims= Jwts.parser() .setSigningKey(Base64.getEncoder().encode(secret_key.getBytes())) .parseClaimsJws(token) .getBody(); System.out.println(\u0026#34;Token ID: \u0026#34;+claims.getId()); System.out.println(\u0026#34;Token Subject: \u0026#34;+claims.getSubject()); System.out.println(\u0026#34;Token Issuer: \u0026#34;+claims.getIssuer()); System.out.println(\u0026#34;Token Issue Date: \u0026#34;+claims.getIssuedAt()); System.out.println(\u0026#34;Token Expiration Date: \u0026#34;+claims.getExpiration()); System.out.println(\u0026#34;Token Audience: \u0026#34;+claims.getAudience()); } } è¾“å‡º ä»¥ä¸‹æ˜¯æˆ‘ä»¬çš„ POC çš„è¾“å‡ºã€‚\n------------------------TOKEN---------------------------------------------------- eyJhbGciOiJIUzUxMiJ9.eyJqdGkiOiJ0azk5MzEiLCJzdWIiOiJUb2tlbjEiLCJpc3MiOiJBQkNfTHRkIiwiYXVkIjoiWFlaX0x0ZCIsImlhdCI6MTYwNzUwNjY0OCwiZXhwIjoxNjA3NTEwMjQ4fQ.lFA0_Jvnt0o69CnotXbTIyYANpWjjeTGxvv6avVihlCqKnuw1bXADp_y3s-NMdohcD2Sq0Cft16wLo7rwvTHpQ ------------------------CLAIMS---------------------------------------------------- Token ID: tk9931 Token Subject: Token1 Token Issuer: ABC_Ltd Token Issue Date: Wed Dec 09 15:07:28 IST 2020 Token Expiration Date: Wed Dec 09 16:07:28 IST 2020 Token Audience: XYZ_Ltd å¦‚ä½•åœ¨ Spring Boot é¡¹ç›®ä¸­å®ç° JWT è®¤è¯ï¼Ÿ ä¸ºäº†è¯´æ˜ JWT èº«ä»½éªŒè¯çš„å®ç°ï¼Œæˆ‘ä»¬è‚¯å®šéœ€è¦ä¸€ä¸ª Web æœåŠ¡è°ƒç”¨ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ REST Web æœåŠ¡å°†ä¸€äº›ç”¨æˆ·æ³¨å†Œåˆ°æ•°æ®åº“ä¸­ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ POSTMAN è½¯ä»¶ï¼Œå› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬ä¸ä¼šæœ‰æ³¨å†Œè¡¨ã€‚ç„¶åæˆ‘ä»¬å°† JWT å®‰å…¨åŠŸèƒ½åº”ç”¨åˆ°æˆ‘ä»¬çš„ä»£ç ä¸­ã€‚æœ€åï¼Œæˆ‘ä»¬å°†é€šè¿‡æµ‹è¯•éªŒè¯æˆ‘ä»¬çº³å…¥çš„å®‰å…¨åŠŸèƒ½ã€‚è®©æˆ‘ä»¬å¼€å§‹ç›¸åº”åœ°å®æ–½å®ƒã€‚\næ‚¨éœ€è¦ä»€ä¹ˆè½¯ä»¶/æŠ€æœ¯ï¼Ÿ STS (Spring Tool Suite) : Version-\u0026gt; 4.7.1.RELEASE Dependent Starters : Spring Security, Spring Web, Lombok, Spring Data JPA, MySQL Driver, Spring Boot DevTools MySQL Database : Version -\u0026gt;8.0.19 MySQL Community Server JDK8 or later versions (Extremely tested on JDK8, JDK11 and JDK14) æ­¥éª¤#1ï¼šåœ¨ STS(Spring Tool Suite) ä¸­åˆ›å»º Spring Boot Starter é¡¹ç›® åˆ›å»ºå…¥é—¨é¡¹ç›®æ—¶ï¼Œé€‰æ‹©â€œSpring Securityâ€ã€â€œSpring Webâ€ã€â€œSpring Data JPAâ€ã€â€œMySQL Driverâ€ã€â€œLombokâ€å’Œâ€œSpring Boot DevToolsâ€ä½œä¸ºå…¥é—¨é¡¹ç›®ä¾èµ–é¡¹ã€‚å¦å¤–ï¼Œå¦‚ä¸Šæ‰€è¿°ï¼Œåœ¨ pom.xml ä¸­æ·»åŠ â€œjaxbâ€ä¾èµ–é¡¹ã€‚å³ä½¿æ‚¨ä¸çŸ¥é“å¦‚ä½•åˆ›å»º Spring Boot Starter é¡¹ç›®ï¼Œä¹Ÿè¯·è®¿é—®å†…éƒ¨é“¾æ¥ã€‚å¦å¤–ï¼Œå¦‚æœæ‚¨æƒ³äº†è§£æœ‰å…³ Lombok çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—® Lombok ä¸Šçš„å†…éƒ¨é“¾æ¥ã€‚\næ­¥éª¤#2Aï¼šåˆ›å»ºå®ä½“ç±» User.java ï¼ˆé€‚ç”¨äºä½äº Spring Boot 3.0 çš„ç‰ˆæœ¬ï¼‰ User.java\npackage com.dev.spring.security.jwt.entity; import java.util.Set; import javax.persistence.CollectionTable; import javax.persistence.Column; import javax.persistence.ElementCollection; import javax.persistence.Entity; import javax.persistence.FetchType; import javax.persistence.GeneratedValue; import javax.persistence.Id; import javax.persistence.JoinColumn; import javax.persistence.Table; import lombok.Data; @Data @Entity @Table(name=\u0026#34;users\u0026#34;) public class User { @Id @GeneratedValue @Column(name=\u0026#34;user_id\u0026#34;) private Integer id; @Column(name=\u0026#34;user_name\u0026#34;) private String username; @Column(name=\u0026#34;user_passwd\u0026#34;) private String password; @Column(name=\u0026#34;user_email\u0026#34;) private String email; @ElementCollection(fetch= FetchType.EAGER) @CollectionTable( name=\u0026#34;roles\u0026#34;, joinColumns = @JoinColumn(name=\u0026#34;user_id\u0026#34;) ) @Column(name=\u0026#34;user_role\u0026#34;) private Set\u0026lt;String\u0026gt; roles; } æ­¥éª¤#2Bï¼šåˆ›å»ºå®ä½“ç±» User.javaï¼ˆé€‚ç”¨äº Spring Boot 3.0 åŠæ›´é«˜ç‰ˆæœ¬ï¼‰ åœ¨ import è¯­å¥ä¸­ï¼Œä½¿ç”¨â€œjakartaâ€ä»£æ›¿â€œjavaxâ€ã€‚ä¾‹å¦‚ï¼šä½¿ç”¨â€œjakarta.persistence.Entity;â€ä»£æ›¿â€œjavax.persistence.Entity;â€ã€‚\nUser.java\npackage com.dev.spring.security.jwt.entity; import java.util.Set; import jakarta.persistence.CollectionTable; import jakarta.persistence.Column; import jakarta.persistence.ElementCollection; import jakarta.persistence.Entity; import jakarta.persistence.FetchType; import jakarta.persistence.GeneratedValue; import jakarta.persistence.Id; import jakarta.persistence.JoinColumn; import jakarta.persistence.Table; import lombok.Data; @Data @Entity @Table(name=\u0026#34;users\u0026#34;) public class User { @Id @GeneratedValue @Column(name=\u0026#34;user_id\u0026#34;) private Integer id; @Column(name=\u0026#34;user_name\u0026#34;) private String username; @Column(name=\u0026#34;user_passwd\u0026#34;) private String password; @Column(name=\u0026#34;user_email\u0026#34;) private String email; @ElementCollection(fetch= FetchType.EAGER) @CollectionTable( name=\u0026#34;roles\u0026#34;, joinColumns = @JoinColumn(name=\u0026#34;user_id\u0026#34;) ) @Column(name=\u0026#34;user_role\u0026#34;) private Set\u0026lt;String\u0026gt; roles; } æ­¥éª¤#3ï¼šæ›´æ–° application.properties #application.properties #-------------------- Server Properties --------------- server.port=8080 #--------------------- DB Connection Properties ------------------ #AutoLoading of driver class since JDBC 4 #spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver spring.datasource.url=jdbc:mysql://localhost:3306/testJWTSecurity spring.datasource.username=root spring.datasource.password=devs #--------------------JPA Properties----------------- spring.jpa.show-sql=true spring.jpa.hibernate.ddl-auto=update #spring.jpa.database-platform=org.hibernet.dialect.MySQL8Dialect #------------------Security Specific Properties------- app.secret.key=J@!gt*K æ­¥éª¤#4ï¼šåˆ›å»ºæ¥å£ UserRepository.java UserRepository.java\npackage com.dev.spring.security.jwt.repo; import java.util.Optional; import org.springframework.data.jpa.repository.JpaRepository; import com.dev.spring.security.jwt.entity.User; public interface UserRepository extends JpaRepository\u0026lt;User, Integer\u0026gt; { Optional\u0026lt;User\u0026gt; findByUsername(String username); } æ­¥éª¤#5ï¼šåˆ›å»º AppConfig.java AppConfig.java\npackage com.dev.spring.security.jwt.config; import org.springframework.context.annotation.Bean; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; import org.springframework.stereotype.Component; @Component public class AppConfig { @Bean public BCryptPasswordEncoder encodePassword() { return new BCryptPasswordEncoder(); } } æ­¥éª¤#6ï¼šåˆ›å»ºç”¨æˆ·æœåŠ¡æ¥å£åŠå…¶å®ç°ç±» IUserService.java\npackage com.dev.spring.security.jwt.service; import java.util.Optional; import com.dev.spring.security.jwt.entity.User; public interface IUserService { Integer saveUser(User user); Optional\u0026lt;User\u0026gt; findByUsername(String username); } UserServiceImpl.java\npackage com.dev.spring.security.jwt.service; import java.util.HashSet; import java.util.Optional; import java.util.Set; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.security.core.GrantedAuthority; import org.springframework.security.core.authority.SimpleGrantedAuthority; import org.springframework.security.core.userdetails.UserDetails; import org.springframework.security.core.userdetails.UserDetailsService; import org.springframework.security.core.userdetails.UsernameNotFoundException; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; import org.springframework.stereotype.Service; import com.dev.spring.security.jwt.entity.User; import com.dev.spring.security.jwt.repo.UserRepository; @Service public class UserServiceImpl implements IUserService, UserDetailsService { @Autowired private UserRepository userRepo; @Autowired private BCryptPasswordEncoder bCryptEncoder; @Override public Integer saveUser(User user) { //Encode password before saving to DB user.setPassword(bCryptEncoder.encode(user.getPassword())); return userRepo.save(user).getId(); } //find user by username @Override public Optional\u0026lt;User\u0026gt; findByUsername(String username) { return userRepo.findByUsername(username); } @Override public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException { Optional\u0026lt;User\u0026gt; opt = userRepo.findByUsername(username); org.springframework.security.core.userdetails.User springUser=null; if(opt.isEmpty()) { throw new UsernameNotFoundException(\u0026#34;User with username: \u0026#34; +username +\u0026#34; not found\u0026#34;); }else { User user =opt.get();\t//retrieving user from DB Set\u0026lt;String\u0026gt; roles = user.getRoles(); Set\u0026lt;GrantedAuthority\u0026gt; ga = new HashSet\u0026lt;\u0026gt;(); for(String role:roles) { ga.add(new SimpleGrantedAuthority(role)); } springUser = new org.springframework.security.core.userdetails.User( username, user.getPassword(), ga ); } return springUser; } } æ­¥éª¤#7ï¼šåˆ›å»º JWTUtil.java JWTUtil.java\npackage com.dev.spring.security.jwt.util; import java.util.Base64; import java.util.Date; import java.util.Random; import java.util.concurrent.TimeUnit; import org.springframework.beans.factory.annotation.Value; import org.springframework.stereotype.Component; import io.jsonwebtoken.Claims; import io.jsonwebtoken.Jwts; import io.jsonwebtoken.SignatureAlgorithm; @Component public class JWTUtil { @Value(\u0026#34;${app.secret.key}\u0026#34;) private String secret_key; // code to generate Token public String generateToken(String subject) { String tokenId= String.valueOf(new Random().nextInt(10000)); return Jwts.builder() .setId(tokenId) .setSubject(subject) .setIssuer(\u0026#34;ABC_Ltd\u0026#34;) .setAudience(\u0026#34;XYZ_Ltd\u0026#34;) .setIssuedAt(new Date(System.currentTimeMillis())) .setExpiration(new Date(System.currentTimeMillis() + TimeUnit.HOURS.toMillis(1))) .signWith(SignatureAlgorithm.HS512, Base64.getEncoder().encode(secret_key.getBytes())) .compact(); } // code to get Claims public Claims getClaims(String token) { return Jwts.parser() .setSigningKey(Base64.getEncoder().encode(secret_key.getBytes())) .parseClaimsJws(token) .getBody(); } // code to check if token is valid public boolean isValidToken(String token) { return getClaims(token).getExpiration().after(new Date(System.currentTimeMillis())); } // code to check if token is valid as per username public boolean isValidToken(String token,String username) { String tokenUserName=getSubject(token); return (username.equals(tokenUserName) \u0026amp;\u0026amp; !isTokenExpired(token)); } // code to check if token is expired public boolean isTokenExpired(String token) { return getExpirationDate(token).before(new Date(System.currentTimeMillis())); } //code to get expiration date public Date getExpirationDate(String token) { return getClaims(token).getExpiration(); } //code to get expiration date public String getSubject(String token) { return getClaims(token).getSubject(); } } æ­¥éª¤#7ï¼šåˆ›å»º UserRequest å’Œ UserResponse æ¨¡å‹ UserRequest.java\npackage com.dev.spring.security.jwt.entity; import lombok.Data; @Data public class UserRequest { private String username; private String password; } UserResponse.java\npackage com.dev.spring.security.jwt.entity; import lombok.AllArgsConstructor; import lombok.Data; import lombok.NoArgsConstructor; @Data @NoArgsConstructor @AllArgsConstructor public class UserResponse { private String token; private String message; } æ­¥éª¤#8ï¼šåˆ›å»º UserRestController.java UserRestController.java\npackage com.dev.spring.security.jwt.controller; import java.security.Principal; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.http.ResponseEntity; import org.springframework.security.authentication.AuthenticationManager; import org.springframework.security.authentication.UsernamePasswordAuthenticationToken; import org.springframework.stereotype.Controller; import org.springframework.web.bind.annotation.PostMapping; import org.springframework.web.bind.annotation.RequestBody; import org.springframework.web.bind.annotation.RequestMapping; import com.dev.spring.security.jwt.entity.User; import com.dev.spring.security.jwt.entity.UserRequest; import com.dev.spring.security.jwt.entity.UserResponse; import com.dev.spring.security.jwt.service.IUserService; import com.dev.spring.security.jwt.util.JWTUtil; @Controller @RequestMapping(\u0026#34;/user\u0026#34;) public class UserRestController { @Autowired private IUserService userService; @Autowired private JWTUtil util; @Autowired private AuthenticationManager authenticationManager; @PostMapping(\u0026#34;/saveUser\u0026#34;) public ResponseEntity\u0026lt;String\u0026gt; saveUser(@RequestBody User user) { Integer id = userService.saveUser(user); String message= \u0026#34;User with id \u0026#39;\u0026#34;+id+\u0026#34;\u0026#39; saved succssfully!\u0026#34;; //return new ResponseEntity\u0026lt;String\u0026gt;(message, HttpStatus.OK); return ResponseEntity.ok(message); } @PostMapping(\u0026#34;/loginUser\u0026#34;) public ResponseEntity\u0026lt;UserResponse\u0026gt; login(@RequestBody UserRequest request){ //Validate username/password with DB(required in case of Stateless Authentication) authenticationManager.authenticate(new UsernamePasswordAuthenticationToken( request.getUsername(), request.getPassword())); String token =util.generateToken(request.getUsername()); return ResponseEntity.ok(new UserResponse(token,\u0026#34;Token generated successfully!\u0026#34;)); } @PostMapping(\u0026#34;/getData\u0026#34;) public ResponseEntity\u0026lt;String\u0026gt; testAfterLogin(Principal p){ return ResponseEntity.ok(\u0026#34;You are accessing data after a valid Login. You are :\u0026#34; +p.getName()); } } æ­¥éª¤ï¼ƒ9ï¼šåˆ›å»º SecurityFilter.java SecurityFilter.java\npackage com.dev.spring.security.jwt.filter; import java.io.IOException; import javax.servlet.FilterChain; import javax.servlet.ServletException; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.security.authentication.UsernamePasswordAuthenticationToken; import org.springframework.security.core.context.SecurityContextHolder; import org.springframework.security.core.userdetails.UserDetails; import org.springframework.security.core.userdetails.UserDetailsService; import org.springframework.security.web.authentication.WebAuthenticationDetailsSource; import org.springframework.stereotype.Component; import org.springframework.web.filter.OncePerRequestFilter; import com.dev.spring.security.jwt.util.JWTUtil; @Component public class SecurityFilter extends OncePerRequestFilter { @Autowired private JWTUtil util; @Autowired private UserDetailsService userDetailsService; @Override protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException { // Reading Token from Authorization Header String token= request.getHeader(\u0026#34;Authorization\u0026#34;); if(token !=null) { String username= util.getSubject(token); //if username is not null \u0026amp; Context Authentication must be null if(username !=null \u0026amp;\u0026amp; SecurityContextHolder.getContext().getAuthentication()==null) { UserDetails user= userDetailsService.loadUserByUsername(username); boolean isValid=util.isValidToken(token, user.getUsername()); if(isValid) { UsernamePasswordAuthenticationToken authToken= new UsernamePasswordAuthenticationToken(username, user.getPassword(), user.getAuthorities()); authToken.setDetails(new WebAuthenticationDetailsSource().buildDetails(request)); SecurityContextHolder.getContext().setAuthentication(authToken); } } } filterChain.doFilter(request, response); } } æ­¥éª¤#10ï¼šåˆ›å»º UnAuthorizedUserAuthenticationEntryPoint.java UnAuthorizedUserAuthenticationEntryPoint.java\npackage com.dev.spring.security.jwt.config; import java.io.IOException; import javax.servlet.ServletException; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; import org.springframework.security.core.AuthenticationException; import org.springframework.security.web.AuthenticationEntryPoint; import org.springframework.stereotype.Component; @Component public class UnAuthorizedUserAuthenticationEntryPoint implements AuthenticationEntryPoint { @Override public void commence(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException) throws IOException, ServletException { response.sendError(HttpServletResponse.SC_UNAUTHORIZED,\u0026#34;UnAuthorized User\u0026#34;); } } æ­¥éª¤#11Aï¼šåˆ›å»º SecurityConfig.javaï¼ˆé€‚ç”¨äºä½äº Spring Security 5.7 çš„ç‰ˆæœ¬ï¼‰ SecurityConfig.java\npackage com.dev.spring.security.jwt.config; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.authentication.AuthenticationManager; import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity; import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter; import org.springframework.security.config.http.SessionCreationPolicy; import org.springframework.security.core.userdetails.UserDetailsService; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter; import com.dev.spring.security.jwt.filter.SecurityFilter; @EnableWebSecurity @Configuration public class SecurityConfig extends WebSecurityConfigurerAdapter { @Autowired private UserDetailsService userDetailsService; @Autowired private BCryptPasswordEncoder bCryptEncoder; @Autowired private UnAuthorizedUserAuthenticationEntryPoint authenticationEntryPoint; @Autowired private SecurityFilter secFilter; //Required in case of Stateless Authentication @Override @Bean protected AuthenticationManager authenticationManager() throws Exception { return super.authenticationManager(); } @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception { auth.userDetailsService(userDetailsService) .passwordEncoder(bCryptEncoder); } @Override protected void configure(HttpSecurity http) throws Exception { http .csrf().disable() //Disabling CSRF as not using form based login .authorizeRequests() .antMatchers(\u0026#34;/user/saveUser\u0026#34;,\u0026#34;/user/loginUser\u0026#34;).permitAll() .anyRequest().authenticated() .and() .exceptionHandling() .authenticationEntryPoint(authenticationEntryPoint) .and() .sessionManagement() .sessionCreationPolicy(SessionCreationPolicy.STATELESS) //To Verify user from second request onwards............ .and() .addFilterBefore(secFilter, UsernamePasswordAuthenticationFilter.class) ; } } æ­¥éª¤#11Bï¼šåˆ›å»º SecurityConfig.javaï¼ˆé€‚ç”¨äºé«˜äº Spring Security 5.7 ä¸”ä½äº Spring Security 6.0 çš„ç‰ˆæœ¬ï¼‰ ç”±äºæ ¹æ® Spring å®˜ç½‘å‘å¸ƒçš„å…¬å‘Šï¼ŒWebSecurityConfigurerAdapter å·²ä» Spring Security 5.7.0-M2 ä¸­å¼ƒç”¨ï¼Œå› æ­¤ï¼Œ2022 å¹´ 2 æœˆ 21 æ—¥ï¼Œæˆ‘ä»¬å°†ä¸ä½¿ç”¨ WebSecurityConfigurerAdapter æ¥ç¼–å†™ SecurityConfig ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nSecurityConfig.java\npackage com.dev.spring.security.jwt.config; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.authentication.AuthenticationProvider; import org.springframework.security.authentication.dao.DaoAuthenticationProvider; import org.springframework.security.authentication.AuthenticationManager; import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity; import org.springframework.security.config.http.SessionCreationPolicy; import org.springframework.security.core.userdetails.UserDetailsService; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; import org.springframework.security.web.SecurityFilterChain; import org.springframework.security.web.util.matcher.AntPathRequestMatcher; import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter; import com.dev.spring.security.jwt.filter.SecurityFilter; @EnableWebSecurity @Configuration public class SecurityConfig { @Autowired private UserDetailsService userDetailsService; @Autowired private BCryptPasswordEncoder bCryptEncoder; @Autowired private UnAuthorizedUserAuthenticationEntryPoint authenticationEntryPoint; @Autowired private SecurityFilter secFilter; //Required in case of Stateless Authentication @Override @Bean protected AuthenticationManager authenticationManager() throws Exception { return super.authenticationManager(); } @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception { auth.userDetailsService(userDetailsService) .passwordEncoder(bCryptEncoder); } @Override protected SecurityFilterChain filterChain(HttpSecurity http) throws Exception { http // .csrf().disable() //Disabling CSRF as not using form based login .authorizeRequests() .antMatchers(\u0026#34;/user/saveUser\u0026#34;,\u0026#34;/user/loginUser\u0026#34;).permitAll() .anyRequest().authenticated() .and() .exceptionHandling() .authenticationEntryPoint(authenticationEntryPoint) .and() .sessionManagement() .sessionCreationPolicy(SessionCreationPolicy.STATELESS) //To Verify user from second request onwards............ .and() .addFilterBefore(secFilter, UsernamePasswordAuthenticationFilter.class) .and() .authenticationProvider(authenticationProvider()); return http.build(); } @Bean public AuthenticationProvider authenticationProvider() { DaoAuthenticationProvider authenticationProvider = new DaoAuthenticationProvider(); authenticationProvider.setUserDetailsService(userDetailsService); authenticationProvider.setPasswordEncoder(bCryptEncoder); return authenticationProvider; } } æ­¥éª¤ï¼ƒ11Cï¼šåˆ›å»º SecurityConfig.javaï¼ˆå¯¹äº Spring Security 6.0 åŠæ›´é«˜ç‰ˆæœ¬ï¼šSpring Boot 3.0ï¼‰ ä» Spring Security 6.0ï¼ˆ2022 å¹´ 11 æœˆå‘å¸ƒï¼‰å¼€å§‹ï¼ŒWebSecurityConfigurerAdapter å·²ä» Spring Security API ä¸­å®Œå…¨åˆ é™¤ã€‚å®ƒè¿˜å½±å“äº† 2022 å¹´ 11 æœˆæ–°å‘å¸ƒçš„ Spring Boot 3.0ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ Spring Framework 6.0+ æˆ– Spring Boot 3.0+ï¼Œæ— è®ºå“ªç§æƒ…å†µï¼ŒSecurityConfig.java çš„å®ç°åº”å¦‚ä¸‹æ‰€ç¤ºã€‚æ­¤å¤–ï¼Œæ‚¨è¿˜å¯ä»¥æ£€æŸ¥ Spring Framework 6.0 ä¸­ä¸ Spring Security ç›¸å…³çš„æ›´æ”¹ã€‚\nSecurityConfig.java\npackage com.dev.spring.security.jwt.config; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.authentication.AuthenticationProvider; import org.springframework.security.authentication.dao.DaoAuthenticationProvider; import org.springframework.security.authentication.AuthenticationManager; import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity; import org.springframework.security.config.http.SessionCreationPolicy; import org.springframework.security.core.userdetails.UserDetailsService; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; import org.springframework.security.web.SecurityFilterChain; import org.springframework.security.web.util.matcher.AntPathRequestMatcher; import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter; import com.dev.spring.security.jwt.filter.SecurityFilter; @EnableWebSecurity @Configuration public class SecurityConfig { @Autowired private UserDetailsService userDetailsService; @Autowired private BCryptPasswordEncoder bCryptEncoder; @Autowired private UnAuthorizedUserAuthenticationEntryPoint authenticationEntryPoint; @Autowired private SecurityFilter secFilter; //Required in case of Stateless Authentication @Override @Bean protected AuthenticationManager authenticationManager() throws Exception { return super.authenticationManager(); } @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception { auth.userDetailsService(userDetailsService) .passwordEncoder(bCryptEncoder); } @Override protected SecurityFilterChain filterChain(HttpSecurity http) throws Exception { http // .csrf().disable() //Disabling CSRF as not using form based login .authorizeHttpRequests() .requestMatchers(\u0026#34;/user/saveUser\u0026#34;,\u0026#34;/user/loginUser\u0026#34;).permitAll() .anyRequest().authenticated() .and() .exceptionHandling() .authenticationEntryPoint(authenticationEntryPoint) .and() .sessionManagement() .sessionCreationPolicy(SessionCreationPolicy.STATELESS) //To Verify user from second request onwards............ .and() .addFilterBefore(secFilter, UsernamePasswordAuthenticationFilter.class) .and() .authenticationProvider(authenticationProvider()); return http.build(); } @Bean public AuthenticationProvider authenticationProvider() { DaoAuthenticationProvider authenticationProvider = new DaoAuthenticationProvider(); authenticationProvider.setUserDetailsService(userDetailsService); authenticationProvider.setPasswordEncoder(bCryptEncoder); return authenticationProvider; } } Finally, your project structure should look like below screenshot. æœ€åï¼Œæ‚¨çš„é¡¹ç›®ç»“æ„åº”å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\nå¦‚ä½•æµ‹è¯•å¯ç”¨ JWT å®‰å…¨çš„åº”ç”¨ç¨‹åºï¼Ÿ è™½ç„¶â€œæµ‹è¯•â€è¿™ä¸ªè¯å¯¹å¼€å‘äººå‘˜æ¥è¯´çœ‹èµ·æ¥å¾ˆå®¹æ˜“ï¼Œä½†å®ƒåŒæ ·é‡è¦ï¼Œå› ä¸ºå®ƒæä¾›äº†æˆ‘ä»¬æ•´ä½“å®æ–½çš„ç»“æœã€‚å› æ­¤ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š\n1) ä½¿ç”¨ Postman é€šè¿‡ REST è°ƒç”¨æ³¨å†Œç”¨æˆ· åœ¨ Postman ä¸­è¾“å…¥ URL http://localhost:8080/user/saveUserï¼Œé€‰æ‹© POST æ–¹æ³•ï¼Œç„¶ååˆ†åˆ«é€‰æ‹© Body\u0026gt;Raw\u0026gt;JSONã€‚ç°åœ¨ç²˜è´´ä¸‹é¢çš„ JSON æ•°æ®ï¼Œç„¶åå•å‡»â€œå‘é€â€æŒ‰é’®ã€‚\n{ â€œusernameâ€: â€œds2525â€, â€œpasswordâ€: â€œdonotforgetmeâ€, â€œemailâ€: â€œds2525@gmail.comâ€, â€œrolesâ€: [â€œAdminâ€,â€Managerâ€] } æ‚¨åº”è¯¥å¾—åˆ°ä»¥ä¸‹å›å¤ï¼š\nUser with id â€˜1â€™ saved succssfully! 2ï¼‰ä»¥ç”¨æˆ·èº«ä»½ç™»å½•ç”Ÿæˆä»¤ç‰Œ åœ¨ Postman ä¸­è¾“å…¥ URL http://localhost:8080/user/loginUserï¼Œé€‰æ‹© POST æ–¹æ³•ï¼Œç„¶ååˆ†åˆ«é€‰æ‹© Body\u0026gt;Raw\u0026gt;JSONã€‚ç°åœ¨ç²˜è´´ä¸‹é¢çš„ JSON æ•°æ®ï¼Œç„¶åå•å‡»â€œå‘é€â€æŒ‰é’®ã€‚\n{ â€œusernameâ€: â€œds2525â€, â€œç”¨æˆ·åâ€ï¼šâ€œds2525â€ï¼Œ â€œpasswordâ€: â€œdonotforgetmeâ€, â€œå¯†ç â€ï¼šâ€œä¸è¦å¿˜è®°æˆ‘â€ï¼Œ } æ‚¨åº”è¯¥å¾—åˆ°ä»¥ä¸‹å›å¤ï¼š\n{ \u0026#34;token\u0026#34;:\u0026#34;eyJhbGciOiJIUzUxMiJ9.eyJqdGkiOiI0MzI5Iiwic3ViIjoiZHMyNDI0IiwiaXNzIjoiQUJDX0x0ZCIsImF1ZCI6IlhZWl9MdGQiLCJpYXQiOjE2MDc0MzA5OTIsImV4cCI6MTYwNzQzNDU5Mn0.hIET_EjL6dqgdUMX-dH9a7msPHSO5-GlLFfSotXWWvvxO69hVOLjkiUGYKBZDyux0QRA_bb75Mpp34EOXLHYiw\u0026#34;,\u0026#34;message\u0026#34;: \u0026#34;Token generated successfully!\u0026#34;; } å¦‚æœè¾“å…¥äº†é”™è¯¯çš„ç”¨æˆ·å/å¯†ç ï¼Œåˆ™è¾“å‡ºå°†å¦‚ä¸‹æ‰€ç¤ºï¼š\n{ \u0026#34;timestamp\u0026#34;: \u0026#34;2020-12-08T12:38:25.778+00:00\u0026#34;, \u0026#34;status\u0026#34;: 401, \u0026#34;error\u0026#34;: \u0026#34;Unauthorized\u0026#34;, \u0026#34;trace\u0026#34;: \u0026#34;org.springframework.security.authentication.BadCredentialsException: Bad credentials\\r\\n\\tat org..................................... \u0026#34;message\u0026#34;: \u0026#34;UnAuthorized User\u0026#34;, \u0026#34;path\u0026#34;: \u0026#34;/user/loginUser\u0026#34; } 3ï¼‰åœ¨ token æœ‰æ•ˆæœŸå†…è®¿é—®æ•°æ®/èµ„æº åœ¨ Postman URL æ ä¸­è¾“å…¥ URL http://localhost:8080/user/getDataï¼Œé€‰æ‹© POST æ–¹æ³•ï¼Œç„¶åé€‰æ‹© Headersã€‚åœ¨æ ‡é¢˜ä¸‹é€‰æ‹©å¯†é’¥ä½œä¸ºâ€œæˆæƒâ€ã€‚ç°åœ¨å°†ä»¤ç‰Œç²˜è´´ä¸ºæˆæƒå€¼ï¼Œå¦‚ä¸‹é¢çš„å±å¹•æˆªå›¾æ‰€ç¤ºã€‚ç„¶åå•å‡»â€œå‘é€â€æŒ‰é’®ã€‚\nä½œä¸ºæˆåŠŸçš„å“åº”ï¼Œæ‚¨åº”è¯¥å¾—åˆ°ä»¥ä¸‹è¾“å‡ºï¼š\nYou are accessing data after a valid Login. You are :ds2525 æ¦‚æ‹¬ åœ¨å®Œæˆâ€œå¦‚ä½•åœ¨ Spring Boot é¡¹ç›®ä¸­å®ç° JWT èº«ä»½éªŒè¯ï¼Ÿâ€çš„æ‰€æœ‰ç†è®ºå’Œç¤ºä¾‹éƒ¨åˆ†ä¹‹åï¼Œæœ€åï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨ Spring Boot é¡¹ç›®ä¸­å®ç° JWT èº«ä»½éªŒè¯å®‰å…¨æ€§ã€‚å½“ç„¶ï¼Œåœ¨è¿™ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬å·²ç»å½»åº•äº†è§£äº† JWT è®¤è¯ç‰¹æ€§ã€‚åŒæ ·ï¼Œæˆ‘ä»¬å¸Œæœ›æ‚¨è¿›ä¸€æ­¥æ‰©å±•æ­¤ç¤ºä¾‹å¹¶åœ¨æ‚¨çš„é¡¹ç›®ä¸­ç›¸åº”åœ°å®ç°å®ƒã€‚å¦å¤–ï¼Œå¦‚æœå°†æ¥æœ‰ä»»ä½•å˜åŒ–ï¼Œæˆ‘ä»¬å°†ç›¸åº”åœ°æ›´æ–°æ–‡ç« ã€‚\nå¦å¤–ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºæå‡ºä½ çš„æ„è§ã€‚\nåŸæ–‡é“¾æ¥ï¼šhttps://javatechonline.com/how-to-implement-jwt-authentication-in-spring-boot-project/\n","permalink":"https://blog.chensoul.cc/posts/2023/08/18/how-to-implement-jwt-authentication-in-spring-boot-project/","summary":"æ²¡æœ‰äººå¯ä»¥å¦è®¤è¿™æ ·ä¸€ä¸ªäº‹å®ï¼šå®‰å…¨æ€§æ˜¯ç”Ÿäº§å°±ç»ªåº”ç”¨ç¨‹åºçš„ä¸€é¡¹é‡è¦åŠŸèƒ½ã€‚å°½ç®¡æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å†…å­˜èº«ä»½éªŒè¯ã€JDBC èº«ä»½éªŒè¯æˆ–é€šè¿‡ UserDetailsSâ€‹â€‹ervice æ¥ä¿æŠ¤ä¸€ä¸ª Web åº”ç”¨ç¨‹åºçš„å®‰å…¨ã€‚ä½†æ˜¯ï¼Œå½“ä¸€ä¸ªåº”ç”¨ç¨‹åºåœ¨å†…éƒ¨ä½¿ç”¨å…¶ä»–åº”ç”¨ç¨‹åºçš„æœåŠ¡æ—¶ï¼Œä½¿ç”¨ Web æœåŠ¡æ¦‚å¿µå®ç°å®‰å…¨æ€§å°±å˜å¾—å¾ˆé‡è¦ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨å…·æœ‰ç‰¹å®šæœ‰æ•ˆæœŸçš„ä»¤ç‰Œæ¥ä¿æŠ¤æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å°†å­¦ä¹ â€œå¦‚ä½•åœ¨ Spring Boot é¡¹ç›®ä¸­å®ç° JWT èº«ä»½éªŒè¯ï¼Ÿâ€ä»¥æ•´ä½“äº†è§£ JWTï¼ˆJSON Web Tokenï¼‰èº«ä»½éªŒè¯èƒŒåçš„æ¦‚å¿µã€‚\nç”±äº JWT ä»£è¡¨â€œJSON Web Tokenâ€ï¼Œå¾ˆæ˜æ˜¾ï¼Œè¯¥ä»¤ç‰Œä»…ä»¥ JSON å½¢å¼ä¿å­˜æ•°æ®ã€‚\næ­¤å¤–ï¼Œä¸ä¸Šè¿°èº«ä»½éªŒè¯æŠ€æœ¯ä¸åŒï¼ŒJWT å±äºæ— çŠ¶æ€èº«ä»½éªŒè¯ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå®ƒæ²¡æœ‰æ•°æ®ã€‚é€šå¸¸ï¼Œè¿™ç§ç±»å‹çš„èº«ä»½éªŒè¯ç”¨äº Web æœåŠ¡ã€æœåŠ¡å™¨çš„æ°´å¹³æ‰©å±•ï¼Œç”šè‡³åœ¨æŸç§ç¨‹åº¦ä¸Šç”¨äº OAuth æŠ€æœ¯ã€‚ä¸ºäº†è¯´æ˜è¯¥ç½‘ç»œæœåŠ¡ï¼Œè®©æˆ‘ä»¬å¯è§†åŒ–ä»äºšé©¬é€Šé¢„è®¢è®¢å•çš„è¿‡ç¨‹ã€‚åœ¨è¿™é‡Œï¼Œç”¨æˆ·ä¸ Amazon åº”ç”¨ç¨‹åºäº¤äº’ï¼Œè€Œ Amazon åº”ç”¨ç¨‹åºåœ¨å†…éƒ¨é€šè¿‡ Web æœåŠ¡è°ƒç”¨ä¸æ”¯ä»˜ç½‘å…³åº”ç”¨ç¨‹åºäº¤äº’ã€‚\nç°åœ¨è®©æˆ‘ä»¬å¼€å§‹è®¨è®ºæˆ‘ä»¬çš„ä¸»é¢˜â€œå¦‚ä½•åœ¨ Spring Boot é¡¹ç›®ä¸­å®ç° JWT èº«ä»½éªŒè¯ï¼Ÿâ€ä»¥åŠç›¸å…³ç‚¹ã€‚\næ‚¨å¯¹æ•´ç¯‡æ–‡ç« æœ‰ä½•æœŸæœ›ï¼Ÿ è¯»å®Œæœ¬æ–‡åï¼Œæ‚¨å°†èƒ½å¤Ÿå›ç­”ï¼š\nä»€ä¹ˆæ˜¯å®‰å…¨ä¸Šä¸‹æ–‡ä¸­çš„æ— çŠ¶æ€å’Œæœ‰çŠ¶æ€èº«ä»½éªŒè¯ï¼Ÿ æ— çŠ¶æ€è®¤è¯å’Œæœ‰çŠ¶æ€è®¤è¯æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ é‚£ä¹ˆä»€ä¹ˆæ˜¯ Tokenï¼Œä»€ä¹ˆæ˜¯ JWT(JSON Web Token)ï¼Ÿ\nä½¿ç”¨ JWT è®¤è¯æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ\nJWT å†…éƒ¨å¦‚ä½•è¿ä½œï¼Ÿ\næˆ‘ä»¬åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨ JWT èº«ä»½éªŒè¯ï¼Ÿ\næ­¤å¤–ï¼ŒJWT èº«ä»½éªŒè¯å’ŒçŠ¶æ€èº«ä»½éªŒè¯ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ\næ­¤å¤–ï¼Œå¦‚ä½•ç”Ÿæˆ JWT ç¼–ç ä»¤ç‰Œä»¥åŠå¦‚ä½•å°†å…¶è§£ç å›æ¥ï¼Ÿ\nå¦‚ä½•åœ¨ Spring Boot é¡¹ç›®ä¸­é€æ­¥å®ç° JWT è®¤è¯ï¼Ÿ\nåœ¨ Spring Boot 3.0 ä¸­ï¼Œå¦‚ä½•åœ¨ä¸ä½¿ç”¨ WebSecurityConfigurerAdapter çš„æƒ…å†µä¸‹ç¼–å†™å®‰å…¨é…ç½®ç±»ï¼Ÿ\næœ€åï¼Œå¦‚ä½•æµ‹è¯•å¯ç”¨ JWT å®‰å…¨çš„åº”ç”¨ç¨‹åºï¼Ÿ\nä»€ä¹ˆæ˜¯æ— çŠ¶æ€å’Œæœ‰çŠ¶æ€èº«ä»½éªŒè¯ï¼Ÿ é€šå¸¸æœ‰ä¸¤ç§ç±»å‹çš„è®¤è¯æŠ€æœ¯ã€‚ä¸¤è€…éƒ½å‘ç”Ÿåœ¨å®¢æˆ·ç«¯æœåŠ¡å™¨æ¦‚å¿µä¸­ï¼ŒæœåŠ¡å™¨ä»…åœ¨èº«ä»½éªŒè¯åæ‰å‘å®¢æˆ·ç«¯æä¾›æœåŠ¡ã€‚è¿™é‡Œçš„å®¢æˆ·ç«¯å¯ä»¥æ˜¯æµè§ˆå™¨ï¼Œä¹Ÿå¯ä»¥æ˜¯å¦ä¸€ä¸ªæœåŠ¡å™¨ã€‚\nçŠ¶æ€è®¤è¯ åœ¨è¿™ç§ç±»å‹çš„èº«ä»½éªŒè¯ä¸­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´æ¶‰åŠä¼šè¯ç®¡ç†ã€‚å½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨è¯·æ±‚æœåŠ¡æ—¶ï¼Œå®ƒé¦–å…ˆç™»å½•åˆ°æœåŠ¡å™¨ã€‚ç„¶åæœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªä¼šè¯å¹¶ä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨è¯¥ä¿¡æ¯ã€‚è¿™ä¸ªä¼šè¯æ˜¯æœåŠ¡å™¨ç«¯çš„ä¸€ç§å†…å­˜ã€‚æˆ‘ä»¬ä¹Ÿç§°å…¶ä¸º HttpSessionï¼Œå› ä¸º Http åè®®ç®¡ç†å®ƒã€‚\næ­¤å¤–ï¼Œä¸ºäº†å“åº”å®¢æˆ·ç«¯è¯·æ±‚ï¼ŒæœåŠ¡å™¨ä»¥ Cookie çš„å½¢å¼å‘å®¢æˆ·ç«¯æä¾›å¸¦æœ‰å“åº”çš„ä¼šè¯ idã€‚è¯¥ cookie å­˜å‚¨åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨ä¸­ã€‚å½“åŒä¸€ä¸ªå®¢æˆ·ç«¯ç¬¬äºŒæ¬¡å‘å‡ºè¯·æ±‚æ—¶ï¼Œè¯·æ±‚å¤´ä¸­ä¹Ÿä¼šå¸¦æœ‰ cookieã€‚å› æ­¤ï¼ŒæœåŠ¡å™¨ä¼šæ£€æŸ¥è¯·æ±‚æ ‡å¤´ï¼Œå¦‚æœåœ¨ cookie ä¸­å‘ç°ç›¸åŒçš„ SIDï¼ˆä¼šè¯ IDï¼‰ï¼Œåˆ™å‡å®šè¯¥è¯·æ±‚æ¥è‡ªåŒä¸€å®¢æˆ·ç«¯ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä¼šè¯ç®¡ç†å°±å‘ç”Ÿäº†ã€‚\nå½“å®¢æˆ·ç«¯ä»æœåŠ¡å™¨æ³¨é”€æ—¶ï¼Œä¼šè¯ä¼šç›¸åº”åœ°è¢«é”€æ¯ã€‚ç»“æœï¼ŒæœåŠ¡å™¨ç›¸åº”åœ°ä»å†…å­˜ä¸­åˆ é™¤ä¼šè¯ä¿¡æ¯ï¼ˆé”®å€¼ï¼‰ã€‚åŒæ ·é‡è¦çš„æ˜¯ï¼Œå¯¹äºæ¯ä¸ªæ–°å®¢æˆ·ç«¯ï¼ŒæœåŠ¡å™¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°ä¼šè¯ï¼ˆå†…å­˜ï¼‰ã€‚\næ— çŠ¶æ€èº«ä»½éªŒè¯ å½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€æœåŠ¡è¯·æ±‚æ—¶ï¼Œå®ƒé¦–å…ˆç™»å½•åˆ°æœåŠ¡å™¨ã€‚å› æ­¤ï¼ŒæœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªä»¤ç‰Œï¼ˆç¼–ç æ ¼å¼çš„æ•°æ®ï¼‰å¹¶å°†å“åº”å‘é€åˆ°å®¢æˆ·ç«¯ã€‚åœ¨å‘å‡ºç¬¬äºŒä¸ªè¯·æ±‚æ—¶ï¼Œå®¢æˆ·ç«¯å°†ç›¸åŒçš„ä»¤ç‰Œä¸è¯·æ±‚ä¸€èµ·å‘é€åˆ°æœåŠ¡å™¨ã€‚ç°åœ¨ï¼ŒæœåŠ¡å™¨ä»è¯·æ±‚ä¸­è¯»å–ä»¤ç‰Œå¹¶éªŒè¯ä»¤ç‰Œã€‚äº‹å®ä¸Šï¼Œä»ç¬¬ä¸€ä¸ªè¯·æ±‚å¼€å§‹ï¼ŒæœåŠ¡å™¨å°±æ£€æŸ¥å®¢æˆ·ç«¯çš„æœ‰æ•ˆç™»å½•ï¼ˆå‡­æ®ï¼‰ã€‚","title":"[è¯‘]Spring Booté¡¹ç›®å¦‚ä½•å®ç°JWTè®¤è¯ï¼Ÿ"},{"content":" åœ¨ Spring Security æ¨¡å—çš„ä¸Šä¸‹æ–‡ä¸­ï¼ŒWebSecurityConfigurerAdapter æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæ ¹æ® Spring å®˜æ–¹ç½‘ç«™ 2022 å¹´ 2 æœˆ 21 æ—¥å‘å¸ƒçš„å…¬å‘Šï¼Œè¯¥ç±»å·²ä» Spring Security 5.7.0-M2 ä¸­å¼ƒç”¨ã€‚å®ƒé€šå¸¸ç”¨äºæ‰©å±• configure() æ–¹æ³•ç”±è‡ªå®šä¹‰é…ç½®å­ç±»å®ç°ã€‚å› æ­¤ï¼Œå®ƒé¼“åŠ±ç”¨æˆ·è½¬å‘åŸºäºç»„ä»¶çš„å®‰å…¨é…ç½®ã€‚ä¸ºäº†æ”¯æŒå¯¹è¿™ç§æ–°é…ç½®è®¾è®¡çš„æ›´æ”¹ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¸¸è§ç”¨ä¾‹åˆ—è¡¨å’Œæœªæ¥å»ºè®®çš„æ›¿ä»£æ–¹æ¡ˆã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†è®¨è®ºæ²¡æœ‰ WebSecurityConfigurerAdapter çš„ Spring Security ç”¨ä¾‹çš„å®ç°ã€‚\näº†è§£è¿™ä¸€å˜åŒ–å¾ˆé‡è¦ï¼Œå› ä¸ºè¿Ÿæ—©æˆ‘ä»¬å°†ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ Spring Security æ¥å¼€å‘å®‰å…¨åŠŸèƒ½ã€‚è®©æˆ‘ä»¬è®¨è®ºâ€œæ²¡æœ‰ WebSecurityConfigurerAdapter çš„ Spring Securityâ€ä¸»é¢˜åŠå…¶ç›¸å…³æ¦‚å¿µã€‚\nä»€ä¹ˆæ˜¯ WebSecurityConfigurerAdapterï¼Ÿ WebSecurityConfigurerAdapter æ˜¯ Spring Security æ¨¡å—æä¾›çš„ä¸€ä¸ªæŠ½è±¡ç±»ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒæ¥é‡å†™å®ƒçš„ configure()æ–¹æ³•æ¥å®šä¹‰æˆ‘ä»¬çš„å®‰å…¨é…ç½®ç±»ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åºä¸­å®ç° Spring Security æ—¶ä½¿ç”¨ä¸¤ä¸ªå…·æœ‰ä¸åŒå‚æ•°çš„ configure() æ–¹æ³•ã€‚ä¸€ç§ç”¨äºå£°æ˜ä¸èº«ä»½éªŒè¯ç›¸å…³çš„é…ç½®ï¼Œå¦ä¸€ç§ç”¨äºå£°æ˜ä¸æˆæƒç›¸å…³çš„é…ç½®ã€‚è¯¥ä»£ç ç±»ä¼¼äºä¸‹é¢çš„ä»£ç ç‰‡æ®µã€‚\n@Configuration @EnableWebSecurity public class SecurityConfiguration extends WebSecurityConfigurerAdapter { @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception { // configure Authentication ...... } @Override protected void configure(HttpSecurity http) throws Exception { // configure Authorization ...... } } ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å­¦ä¹ è¿™ä¸ªæ”¹å˜ï¼Ÿ å¦‚æœæ‚¨ä½¿ç”¨ Spring Boot 2.7.0 å’Œ mavenï¼Œå®ƒå°†è‡ªåŠ¨ä¸‹è½½ Spring Security 5.7.0 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨ä¼šå‘ç° WebSecurityConfigurerAdapter å·²è¢«å¼ƒç”¨ã€‚å¦‚æœæ‚¨ä»ç„¶æƒ³ä½¿ç”¨æ­¤ç±»è€Œä¸å¼ƒç”¨ï¼Œæ‚¨å¯ä»¥åœ¨ pom.xml ä¸­å°† Spring Boot ç‰ˆæœ¬æ›´æ”¹ä¸ºè¾ƒä½ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ 2.6.6 ï¼‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚å®ƒå°†è‡ªåŠ¨ä¸‹è½½ä½äº 5.7.0 çš„ Spring Security ç‰ˆæœ¬ï¼Œå¹¶ä¸”å¼ƒç”¨è­¦å‘Šå°†æ¶ˆå¤±ã€‚\nä½†æ˜¯ï¼Œå¦‚æœæ‚¨ä¸ä½¿ç”¨ Spring Bootï¼Œè€Œæ˜¯ä½¿ç”¨ç®€å•çš„ Spring Security æ¨¡å—ï¼Œæ‚¨ç”šè‡³å¯ä»¥é™ä½ Spring Security çš„ç‰ˆæœ¬ã€‚\n\u0026lt;parent\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-parent\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.6.6\u0026lt;/version\u0026gt; \u0026lt;/parent\u0026gt; è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æ²¡æœ‰ WebSecurityConfigurerAdapter çš„æƒ…å†µä¸‹å®ç° Spring Securityã€‚\næˆ‘ä»¬éœ€è¦åœ¨å“ªé‡Œå®æ–½è¿™ä¸€æ”¹å˜ï¼Ÿ ä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½å®æ–½æ­¤æ›´æ”¹çš„æƒ…å†µã€‚\nå¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Spring Boot 2.7.0 æˆ–æ›´é«˜ç‰ˆæœ¬\nå¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨ Spring Security 5.7.0 æˆ–æ›´é«˜ç‰ˆæœ¬\nå¦‚æœä½ çš„é¡¹ç›®å¾—åˆ°å¦‚ä¸Šæ‰€è¿°å‡çº§æˆ–è¿ç§»åˆ°æ›´é«˜ç‰ˆæœ¬\nå¦‚æœæ‚¨æƒ³ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ Spring Boot è‡ªå®šä¹‰ Spring Security é…ç½®\nå¦‚æœæ‚¨æƒ³åˆ é™¤ WebSecurityConfigurerAdapter Deprecated çš„çƒ¦äººè­¦å‘Š\nå¦‚æœä½ æƒ³åœ¨æ²¡æœ‰ WebSecurityConfigurerAdapter çš„æƒ…å†µä¸‹å®ç° Spring Securityã€‚\nå¦‚ä½•åˆ é™¤å·²å¼ƒç”¨çš„è­¦å‘Šï¼Ÿ ä¸‹é¢å°±è®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥å­¦ä¹ å§ï¼š\nå¦‚æœæ‚¨ä½¿ç”¨ STS ä½œä¸º IDE æ¥å¼€å‘é¡¹ç›®ï¼Œåˆ™éœ€è¦é™ä½ Spring Boot çš„ç‰ˆæœ¬ã€‚å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Spring Boot 2.7.0 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œè¯·å°†å…¶è®¾ä¸º 2.6.xï¼ˆä¾‹å¦‚ 2.6.6ï¼‰ã€‚æ‚¨å¯ä»¥é€šè¿‡æ›´æ–° pom.xml æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚å®Œæˆåï¼Œå®ƒå°†è‡ªåŠ¨ä¸‹è½½ Spring Security æ¨¡å—çš„å…¼å®¹ç‰ˆæœ¬ã€‚\næ£€æŸ¥æ‚¨çš„é…ç½®ç±»æ˜¯å¦æ‰©å±•äº† WebSecurityConfigurerAdapter ç±»ã€‚å·²å¼ƒç”¨çš„è­¦å‘Šåº”è¯¥æ¶ˆå¤±ã€‚ç°åœ¨æ‚¨å¯ä»¥åœ¨æ²¡æœ‰ WebSecurityConfigurerAdapter çš„æƒ…å†µä¸‹å®ç° Spring Securityã€‚\nå¦‚ä½•åœ¨æ²¡æœ‰ WebSecurityConfigurerAdapter çš„æƒ…å†µä¸‹ä½¿ç”¨ Spring Securityï¼Ÿ å¦‚ä¸Šæ‰€è¿°ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šåœ¨è‡ªå®šä¹‰é…ç½®ç±»ä¸­ç»§æ‰¿ WebSecurityConfigurerAdapter çš„ configure() æ–¹æ³•ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°è¿™äº›æ–¹æ³•çš„æ›¿ä»£æ–¹æ¡ˆï¼Œå› ä¸ºè‡ª Spring Security 5.7.0-M2 å‘å¸ƒä»¥æ¥ï¼ŒWebSecurityConfigurerAdapter å·²è¢«å¼ƒç”¨ã€‚\nè®©æˆ‘ä»¬è®¨è®ºä¸€äº›ä¾‹å­\nç¤ºä¾‹#1ï¼šä½¿ç”¨ WebSecurityConfigurerAdapter æ­¤ç¤ºä¾‹æ¼”ç¤ºäº† HttpSecurity é…ç½®ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬ç¼–å†™å®ƒæ¥å£°æ˜æˆæƒå·¥ä»¶ã€‚\n@Configuration @EnableWebSecurity public class WebSecurityConfig extends WebSecurityConfigurerAdapter { @Override protected void configure(HttpSecurity http) throws Exception { http.cors().and().csrf().disable() .and().sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS) .and().authorizeRequests() .antMatchers(\u0026#34;/home\u0026#34;).permitAll() .antMatchers(\u0026#34;/welcome\u0026#34;).authenticated() .antMatchers(\u0026#34;/admin\u0026#34;).hasAuthority(\u0026#34;ADMIN\u0026#34;) .antMatchers(\u0026#34;/emp\u0026#34;).hasAuthority(\u0026#34;EMPLOYEE\u0026#34;) .antMatchers(\u0026#34;/mgr\u0026#34;).hasAuthority(\u0026#34;MANAGER\u0026#34;) .anyRequest().authenticated() ; } } ç¤ºä¾‹#1ï¼šæ²¡æœ‰ WebSecurityConfigurerAdapter ä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†åœ¨æ²¡æœ‰ WebSecurityConfigurerAdapter çš„æƒ…å†µä¸‹å®ç° Spring Security çš„å¯èƒ½è§£å†³æ–¹æ¡ˆã€‚\n@Configuration @EnableWebSecurity public class WebSecurityConfig { @Bean public SecurityFilterChain filterChain(HttpSecurity http) throws Exception { http.cors().and().csrf().disable() .and().sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS) .and().authorizeRequests() .antMatchers(\u0026#34;/home\u0026#34;).permitAll() .antMatchers(\u0026#34;/welcome\u0026#34;).authenticated() .antMatchers(\u0026#34;/admin\u0026#34;).hasAuthority(\u0026#34;ADMIN\u0026#34;) .antMatchers(\u0026#34;/emp\u0026#34;).hasAuthority(\u0026#34;EMPLOYEE\u0026#34;) .antMatchers(\u0026#34;/mgr\u0026#34;).hasAuthority(\u0026#34;MANAGER\u0026#34;) .anyRequest().authenticated(); return http.build(); } } åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š\næ­¥éª¤#1ï¼šåˆ é™¤@overrideï¼Œå› ä¸ºæˆ‘ä»¬ä¸ä¼šä»ä»»ä½•ç±»ä¸­æ‰©å±•å’Œè¦†ç›–å®ƒã€‚ æ­¥éª¤ï¼ƒ2ï¼šåœ¨æ­¤æ–¹æ³•ä¸Šåº”ç”¨@Bean æ³¨è§£ æ­¥éª¤#3ï¼šç°åœ¨å°†æ–¹æ³•è¿”å›ç±»å‹å£°æ˜ä¸º SecurityFilterChainï¼Œè€Œä¸æ˜¯ void æ­¥éª¤#4ï¼šæ ¹æ®éœ€è¦æ›´æ–°æ–¹æ³•åç§°ã€‚æ¯”å¦‚è¯´ filterChainã€‚ æ­¥éª¤#5ï¼šæ–¹æ³•ç»“æŸæ—¶ï¼Œä¸»ä½“è¿”å› http.build()ã€‚è¿™é‡Œ http æ˜¯ HttpSecurity ç±»å‹çš„å˜é‡ã€‚ ç¤ºä¾‹#2ï¼šä½¿ç”¨ WebSecurityConfigurerAdapter åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†è¿™ä¸¤ç§æ–¹æ³•ã€‚\nimport org.springframework.context.annotation.Configuration; import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity; import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter; import org.springframework.security.web.util.matcher.AntPathRequestMatcher; @Configuration @EnableWebSecurity public class SecurityConfig extends WebSecurityConfigurerAdapter { @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception { // {noop} =\u0026gt; No operation for password encoder (no password encoding needed) auth.inMemoryAuthentication() .withUser(\u0026#34;devs\u0026#34;) .password (\u0026#34;{noop} devs\u0026#34;) //no password encoding needed .authorities(\u0026#34;ADMIN\u0026#34;); auth.inMemoryAuthentication().withUser(\u0026#34;ns\u0026#34;).password(\u0026#34;{noop}ns\u0026#34;).authorities(\u0026#34;EMPLOYEE\u0026#34;); auth.inMemoryAuthentication().withUser(\u0026#34;vs\u0026#34;).password(\u0026#34;{noop}vs\u0026#34;).authorities(\u0026#34;MANAGER\u0026#34;); } @Override protected void configure(HttpSecurity http) throws Exception { //declares which Page(URL) will have What access type http.authorizeRequests() .antMatchers(\u0026#34;/home\u0026#34;).permitAll() .antMatchers(\u0026#34;/welcome\u0026#34;).authenticated() .antMatchers(\u0026#34;/admin\u0026#34;).hasAuthority(\u0026#34;ADMIN\u0026#34;) .antMatchers(\u0026#34;/emp\u0026#34;).hasAuthority(\u0026#34;EMPLOYEE\u0026#34;) .antMatchers(\u0026#34;/mgr\u0026#34;).hasAuthority(\u0026#34;MANAGER\u0026#34;) .antMatchers(\u0026#34;/common\u0026#34;).hasAnyAuthority(\u0026#34;EMPLOYEE\u0026#34;,\u0026#34;MANAGER\u0026#34;) // Any other URLs which are not configured in above antMatchers // generally declared aunthenticated() in real time .anyRequest().authenticated() // Login Form Details .and() .formLogin() .defaultSuccessUrl(\u0026#34;/welcome\u0026#34;, true) // Logout Form Details .and() .logout() .logoutRequestMatcher(new AntPathRequestMatcher(\u0026#34;/logout\u0026#34;)) // Exception Details .and() .exceptionHandling() .accessDeniedPage(\u0026#34;/accessDenied\u0026#34;) ; } } ç¤ºä¾‹#2ï¼šæ²¡æœ‰ WebSecurityConfigurerAdapter ä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†åœ¨æ²¡æœ‰ WebSecurityConfigurerAdapter çš„æƒ…å†µä¸‹å®ç° Spring Security çš„å¯èƒ½è§£å†³æ–¹æ¡ˆã€‚\nimport java.util.ArrayList; import java.util.List; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity; import org.springframework.security.core.GrantedAuthority; import org.springframework.security.core.authority.SimpleGrantedAuthority; import org.springframework.security.core.userdetails.User; import org.springframework.security.core.userdetails.UserDetails; import org.springframework.security.provisioning.InMemoryUserDetailsManager; import org.springframework.security.web.SecurityFilterChain; import org.springframework.security.web.util.matcher.AntPathRequestMatcher; @Configuration @EnableWebSecurity public class SecurityConfigNew { @Bean protected InMemoryUserDetailsManager configAuthentication() { List\u0026lt;UserDetails\u0026gt; users = new ArrayList\u0026lt;\u0026gt;(); List\u0026lt;GrantedAuthority\u0026gt; adminAuthority = new ArrayList\u0026lt;\u0026gt;(); adminAuthority.add(new SimpleGrantedAuthority(\u0026#34;ADMIN\u0026#34;)); UserDetails admin= new User(\u0026#34;devs\u0026#34;, \u0026#34;{noop}devs\u0026#34;, adminAuthority); users.add(admin); List\u0026lt;GrantedAuthority\u0026gt; employeeAuthority = new ArrayList\u0026lt;\u0026gt;(); adminAuthority.add(new SimpleGrantedAuthority(\u0026#34;EMPLOYEE\u0026#34;)); UserDetails employee= new User(\u0026#34;ns\u0026#34;, \u0026#34;{noop}ns\u0026#34;, employeeAuthority); users.add(employee); List\u0026lt;GrantedAuthority\u0026gt; managerAuthority = new ArrayList\u0026lt;\u0026gt;(); adminAuthority.add(new SimpleGrantedAuthority(\u0026#34;MANAGER\u0026#34;)); UserDetails manager= new User(\u0026#34;vs\u0026#34;, \u0026#34;{noop}vs\u0026#34;, managerAuthority); users.add(manager); return new InMemoryUserDetailsManager(users); } @Bean protected SecurityFilterChain filterChain(HttpSecurity http) throws Exception { //declares which Page(URL) will have What access type http.authorizeRequests() .antMatchers(\u0026#34;/home\u0026#34;).permitAll() .antMatchers(\u0026#34;/welcome\u0026#34;).authenticated() .antMatchers(\u0026#34;/admin\u0026#34;).hasAuthority(\u0026#34;ADMIN\u0026#34;) .antMatchers(\u0026#34;/emp\u0026#34;).hasAuthority(\u0026#34;EMPLOYEE\u0026#34;) .antMatchers(\u0026#34;/mgr\u0026#34;).hasAuthority(\u0026#34;MANAGER\u0026#34;) .antMatchers(\u0026#34;/common\u0026#34;).hasAnyAuthority(\u0026#34;EMPLOYEE\u0026#34;,\u0026#34;MANAGER\u0026#34;) // Any other URLs which are not configured in above antMatchers // generally declared aunthenticated() in real time .anyRequest().authenticated() // Login Form Details .and() .formLogin() .defaultSuccessUrl(\u0026#34;/welcome\u0026#34;, true) // Logout Form Details .and() .logout() .logoutRequestMatcher(new AntPathRequestMatcher(\u0026#34;/logout\u0026#34;)) // Exception Details .and() .exceptionHandling() .accessDeniedPage(\u0026#34;/accessDenied\u0026#34;) ; return http.build(); } } ä¸Šé¢çš„ä»£ç ç‰‡æ®µæ˜¯ä½¿ç”¨ Spring Security çš„å†…å­˜ä¸­èº«ä»½éªŒè¯çš„ç¤ºä¾‹ã€‚\nç¤ºä¾‹#3ï¼šä½¿ç”¨ WebSecurityConfigurerAdapter @Configuration @EnableWebSecurity public class WebSecurityConfig extends WebSecurityConfigurerAdapter { @Autowire UserDetailsService userDetailsService; @Override public void configure(AuthenticationManagerBuilder authenticationManagerBuilder) throws Exception { authenticationManagerBuilder.userDetailsService(userDetailsService).passwordEncoder(passwordEncoder()); } @Bean public PasswordEncoder passwordEncoder() { return new BCryptPasswordEncoder(); } } ç¤ºä¾‹#3ï¼šæ²¡æœ‰ WebSecurityConfigurerAdapter ä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†åœ¨æ²¡æœ‰ WebSecurityConfigurerAdapter çš„æƒ…å†µä¸‹å®ç° Spring Security çš„å¯èƒ½è§£å†³æ–¹æ¡ˆã€‚\n@Configuration @EnableWebSecurity public class WebSecurityConfig { @Bean AuthenticationManager authenticationManager(AuthenticationConfiguration authenticationConfiguration) throws Exception { return authenticationConfiguration.getAuthenticationManager(); } } åœ¨è¿™é‡Œï¼Œåœ¨æ—§ç‰ˆæœ¬ä¸­æˆ‘ä»¬æ³¨å…¥ AuthenticationManagerBuilderï¼Œè®¾ç½® userDetailsSâ€‹â€‹erviceã€passwordEncoder å¹¶æ„å»ºå®ƒã€‚ä½†æ˜¯ AuthenticationManager å·²ç»åœ¨è¿™ä¸€æ­¥ä¸­åˆ›å»ºäº†ã€‚å®ƒæ˜¯æŒ‰ç…§æˆ‘ä»¬æƒ³è¦çš„æ–¹å¼åˆ›å»ºçš„ï¼ˆä½¿ç”¨ userDetailsSâ€‹â€‹ervice å’Œ passwordEncoderï¼‰ã€‚\nç¤ºä¾‹#4ï¼šä½¿ç”¨ WebSecurityConfigurerAdapter åœ¨å®ç°ç½‘ç»œå®‰å…¨é…ç½®æ—¶ï¼ŒWebSecurityCustomizer æ˜¯ä¸€ä¸ªå›è°ƒæ¥å£ï¼Œå¯ç”¨äºè‡ªå®šä¹‰ WebSecurityã€‚\n@Configuration @EnableWebSecurity public class SecurityConfiguration extends WebSecurityConfigurerAdapter { @Override public void configure(WebSecurity web) { web.ignoring().antMatchers(\u0026#34;/ignore1\u0026#34;, \u0026#34;/ignore2\u0026#34;); } } ç¤ºä¾‹#4ï¼šæ²¡æœ‰ WebSecurityConfigurerAdapter ä» Spring Security 5.7.0-M2 å¼€å§‹ï¼Œæ¨èçš„æ–¹æ³•æ˜¯æ³¨å†Œ WebSecurityCustomizer beanã€‚ä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†åœ¨æ²¡æœ‰ WebSecurityConfigurerAdapter çš„æƒ…å†µä¸‹å®ç° Spring Security çš„å¯èƒ½è§£å†³æ–¹æ¡ˆï¼š\n@Configuration @EnableWebSecurity public class SecurityConfiguration { @Bean public WebSecurityCustomizer webSecurityCustomizer() { return (web) -\u0026gt; web.ignoring().antMatchers(\u0026#34;/ignore1\u0026#34;, \u0026#34;/ignore2\u0026#34;); } } ç¤ºä¾‹#5ï¼šä½¿ç”¨ WebSecurityConfigurerAdapter ä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº† Spring Security ä¸Šä¸‹æ–‡ä¸­ JDBC èº«ä»½éªŒè¯çš„å˜åŒ–ã€‚\nong\u0026gt;@Configuration @EnableWebSecurity public class SecurityConfig extends WebSecurityConfigurerAdapter { @Autowired private DataSource dataSource; @Autowired private BCryptPasswordEncoder passwordEncoder; @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception { auth.jdbcAuthentication() .dataSource(dataSource) //creates database connection .usersByUsernameQuery(\u0026#34;select user_name,user_pwd,user_enabled from user where user_name=?\u0026#34;) .authoritiesByUsernameQuery(\u0026#34;select user_name,user_role from user where user_name=?\u0026#34;) .passwordEncoder(passwordEncoder); } } ç¤ºä¾‹#5ï¼šæ²¡æœ‰ WebSecurityConfigurerAdapter å±•æœ›æœªæ¥ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åœ¨æ²¡æœ‰ WebSecurityConfigurerAdapter çš„æƒ…å†µä¸‹å®ç° Spring Securityï¼Œæ–°ä»£ç å°†å¦‚ä¸‹æ‰€ç¤ºã€‚\n@Configuration @EnableWebSecurity public class SecurityConfig { @Autowired private DataSource dataSource; @Bean public UserDetailsManager authenticateUsers() { UserDetails user = User.withUsername(\u0026#34;username\u0026#34;) .password(PasswordEncoderFactories.createDelegatingPasswordEncoder().encode(\u0026#34;password\u0026#34;)).build(); JdbcUserDetailsManager users = new JdbcUserDetailsManager(dataSource); users.setAuthoritiesByUsernameQuery(\u0026#34;select user_name,user_pwd,user_enabled from user where user_name=?\u0026#34;); users.setUsersByUsernameQuery(\u0026#34;select user_name,user_role from user where user_name=?\u0026#34;); users.createUser(user); return users; } } æ–°çš„å®ç°å°†å¦‚ä¸Šæ‰€ç¤ºã€‚è¿™å¯èƒ½ä¸æ˜¯ç¡®åˆ‡çš„è§£å†³æ–¹æ¡ˆã€‚\nSpring Security 6.0.0 æˆ–æ›´é«˜ç‰ˆæœ¬ä¸­æœ‰å“ªäº›å¼ƒç”¨æ›´æ–°ï¼Ÿ å¦‚æœæ‚¨ä½¿ç”¨ Spring Security 6.0.0 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼ˆä»¥åŠ Spring Boot 3.0 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰ï¼Œæ‚¨è¿˜ä¼šçœ‹åˆ°å…¶ä»– API å¼ƒç”¨ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯éœ€è¦è¿›è¡Œçš„ä¸€äº›æ›´æ”¹ï¼š\nauthorizeRequests() -\u0026gt;authorizeHttpRequests()\nantMatchers() -\u0026gt; requestMatchers()\nregexMatchers() -\u0026gt; RegexRequestMatchers()\nFAQ åœ¨å“ªé‡Œå¯ä»¥æ‰¾åˆ°â€œæ²¡æœ‰ WebSecurityConfigurerAdapter çš„ Spring Security çš„å®Œæ•´ç¤ºä¾‹ï¼Ÿâ€ ä»¥ä¸‹æ˜¯æŸ¥æ‰¾â€œæ²¡æœ‰ WebSecurityConfigurerAdapter çš„ Spring Securityâ€å®Œæ•´ç¤ºä¾‹çš„é“¾æ¥ï¼š\nHow To Implement Security In Spring Boot Project?\nHow to implement Role Based Spring Security Without WebSecurityConfigurerAdapter in Spring Boot using UserDetailsService?\nHow to implement JWT Authentication in Spring Boot Project?\nç»“è®º åœ¨å®Œæˆäº†â€œæ²¡æœ‰ WebSecurityConfigurerAdapter çš„ Spring Securityâ€çš„æ‰€æœ‰ç†è®ºå’Œç¤ºä¾‹éƒ¨åˆ†ä¹‹åï¼Œæœ€åï¼Œæˆ‘ä»¬åº”è¯¥å‡†å¤‡å¥½åœ¨å®æ—¶é¡¹ç›®ä¸­å¤„ç†è­¦å‘Šâ€œWebSecurityConfigurerAdapter Deprecatedâ€ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¸Œæœ›æ‚¨æ‰©å±•â€œæ²¡æœ‰ WebSecurityConfigurerAdapter çš„ Spring Securityâ€ä¸€æ–‡ä¸­æä¾›çš„çŸ¥è¯†ï¼Œå¹¶åœ¨æ‚¨çš„é¡¹ç›®ä¸­ç›¸åº”åœ°å®ç°è¯¥æ¦‚å¿µã€‚å¦‚éœ€è¿›ä¸€æ­¥å­¦ä¹  Spring Securityï¼Œæ‚¨å¯ä»¥è®¿é—® Spring Security ä½¿ç”¨ Spring Boot ç³»åˆ—æ•™ç¨‹ã€‚å¦å¤–ï¼Œå¦‚æœåç»­æœ‰ä»»ä½•æ›´æ–°ï¼Œæˆ‘ä»¬ä¹Ÿä¼šå¯¹æ–‡ç« è¿›è¡Œç›¸åº”çš„æ›´æ–°ã€‚æ­¤å¤–ï¼Œè¯·éšæ—¶åœ¨ä¸‹é¢çš„è¯„è®ºéƒ¨åˆ†æä¾›æ‚¨çš„æ„è§ã€‚\nåŸæ–‡é“¾æ¥ï¼šhttps://javatechonline.com/spring-security-without-websecurityconfigureradapter/\n","permalink":"https://blog.chensoul.cc/posts/2023/08/18/spring-security-without-websecurityconfigureradapter/","summary":"åœ¨ Spring Security æ¨¡å—çš„ä¸Šä¸‹æ–‡ä¸­ï¼ŒWebSecurityConfigurerAdapter æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæ ¹æ® Spring å®˜æ–¹ç½‘ç«™ 2022 å¹´ 2 æœˆ 21 æ—¥å‘å¸ƒçš„å…¬å‘Šï¼Œè¯¥ç±»å·²ä» Spring Security 5.7.0-M2 ä¸­å¼ƒç”¨ã€‚å®ƒé€šå¸¸ç”¨äºæ‰©å±• configure() æ–¹æ³•ç”±è‡ªå®šä¹‰é…ç½®å­ç±»å®ç°ã€‚å› æ­¤ï¼Œå®ƒé¼“åŠ±ç”¨æˆ·è½¬å‘åŸºäºç»„ä»¶çš„å®‰å…¨é…ç½®ã€‚ä¸ºäº†æ”¯æŒå¯¹è¿™ç§æ–°é…ç½®è®¾è®¡çš„æ›´æ”¹ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¸¸è§ç”¨ä¾‹åˆ—è¡¨å’Œæœªæ¥å»ºè®®çš„æ›¿ä»£æ–¹æ¡ˆã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†è®¨è®ºæ²¡æœ‰ WebSecurityConfigurerAdapter çš„ Spring Security ç”¨ä¾‹çš„å®ç°ã€‚\näº†è§£è¿™ä¸€å˜åŒ–å¾ˆé‡è¦ï¼Œå› ä¸ºè¿Ÿæ—©æˆ‘ä»¬å°†ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ Spring Security æ¥å¼€å‘å®‰å…¨åŠŸèƒ½ã€‚è®©æˆ‘ä»¬è®¨è®ºâ€œæ²¡æœ‰ WebSecurityConfigurerAdapter çš„ Spring Securityâ€ä¸»é¢˜åŠå…¶ç›¸å…³æ¦‚å¿µã€‚\nä»€ä¹ˆæ˜¯ WebSecurityConfigurerAdapterï¼Ÿ WebSecurityConfigurerAdapter æ˜¯ Spring Security æ¨¡å—æä¾›çš„ä¸€ä¸ªæŠ½è±¡ç±»ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒæ¥é‡å†™å®ƒçš„ configure()æ–¹æ³•æ¥å®šä¹‰æˆ‘ä»¬çš„å®‰å…¨é…ç½®ç±»ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åºä¸­å®ç° Spring Security æ—¶ä½¿ç”¨ä¸¤ä¸ªå…·æœ‰ä¸åŒå‚æ•°çš„ configure() æ–¹æ³•ã€‚ä¸€ç§ç”¨äºå£°æ˜ä¸èº«ä»½éªŒè¯ç›¸å…³çš„é…ç½®ï¼Œå¦ä¸€ç§ç”¨äºå£°æ˜ä¸æˆæƒç›¸å…³çš„é…ç½®ã€‚è¯¥ä»£ç ç±»ä¼¼äºä¸‹é¢çš„ä»£ç ç‰‡æ®µã€‚\n@Configuration @EnableWebSecurity public class SecurityConfiguration extends WebSecurityConfigurerAdapter { @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception { // configure Authentication ...... } @Override protected void configure(HttpSecurity http) throws Exception { // configure Authorization ...... } } ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å­¦ä¹ è¿™ä¸ªæ”¹å˜ï¼Ÿ å¦‚æœæ‚¨ä½¿ç”¨ Spring Boot 2.7.0 å’Œ mavenï¼Œå®ƒå°†è‡ªåŠ¨ä¸‹è½½ Spring Security 5.7.0 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨ä¼šå‘ç° WebSecurityConfigurerAdapter å·²è¢«å¼ƒç”¨ã€‚å¦‚æœæ‚¨ä»ç„¶æƒ³ä½¿ç”¨æ­¤ç±»è€Œä¸å¼ƒç”¨ï¼Œæ‚¨å¯ä»¥åœ¨ pom.xml ä¸­å°† Spring Boot ç‰ˆæœ¬æ›´æ”¹ä¸ºè¾ƒä½ç‰ˆæœ¬ï¼ˆä¾‹å¦‚ 2.6.6 ï¼‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚å®ƒå°†è‡ªåŠ¨ä¸‹è½½ä½äº 5.","title":"[è¯‘]æ²¡æœ‰WebSecurityConfigurerAdapterçš„Spring Security.md"},{"content":" ç»§ç»­ä¸Šä¸€ç¯‡å…³äºå®ç° Spring Security çš„ä¸¤ç§ä¸åŒæ–¹æ³•çš„æ–‡ç« ï¼Œåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ ç¬¬ä¸‰ç§æ–¹æ³•â€œå¦‚ä½•ä½¿ç”¨ UserDetailsSâ€‹â€‹ervice åœ¨ Spring Boot ä¸­å®ç° Securityï¼Ÿâ€ã€‚ç»è¿‡ä¸Šä¸€ç¯‡æ–‡ç« åï¼Œæˆ‘å¸Œæœ›æˆ‘ä»¬éƒ½éå¸¸ç†Ÿæ‚‰å®‰å…¨æ€§çš„åŸºç¡€çŸ¥è¯†ï¼Œç”šè‡³æ˜¯ Spring Boot åº”ç”¨ç¨‹åºä¸­çš„å®‰å…¨æ€§åŸºç¡€çŸ¥è¯†ã€‚è¿™æ¬¡æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç”¨æˆ·æ³¨å†Œè¡¨å¹¶å°†ç”¨æˆ·åŠå…¶è§’è‰²ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚\nç„¶åï¼Œæ ¹æ®ç”¨æˆ·è§’è‰²ï¼Œæˆ‘ä»¬å°†å€ŸåŠ©é¢„å®šä¹‰çš„ UserDetailsSâ€‹â€‹ervice æ£€æŸ¥èº«ä»½éªŒè¯å’ŒæˆæƒåŠŸèƒ½ã€‚\nå¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾â€œå¦‚ä½•åœ¨ Spring Boot 3 åŠä»¥ä¸Šç‰ˆæœ¬ä¸­ä½¿ç”¨ UserDetailsSâ€‹â€‹ervice åœ¨ Spring Boot ä¸­å®ç°å®‰å…¨æ€§ï¼Ÿâ€ï¼Œè¯·è®¿é—®æœ‰å…³ä½¿ç”¨ Spring Boot 3 çš„ Spring Security UserDetailsSâ€‹â€‹ervice çš„å•ç‹¬æ–‡ç« ã€‚\nä¸ºäº†è¯´æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†æŠŠä¸€äº›è§’è‰²å‘æŒ¥ä½œç”¨ï¼Œå¹¶åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­å›´ç»•å®ƒä»¬è¿›è¡Œå‘æŒ¥ï¼Œä»¥ä½¿å…¶å˜å¾—æ¸…æ™°ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å°†æœ‰ä¸€äº›é¡µé¢å¹¶é™åˆ¶å®ƒä»¬ä»…å¯ç”±æŸäº›ç‰¹å®šè§’è‰²è®¿é—®ã€‚åŒæ ·é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬å¿…é¡»åˆ›å»ºä¸€ä¸ªå°å‹ MVC Web åº”ç”¨ç¨‹åºï¼Œä»¥ä½¿æ³¨å†Œè¿‡ç¨‹å‘ç”¨æˆ·å¼€æ”¾ã€‚ç”¨æˆ·åœ¨æ³¨å†Œæ—¶å°†è¾“å…¥è‡ªå·±çš„è§’è‰²ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¹‹ä¸Šå®ç°å®‰å…¨åŠŸèƒ½ã€‚\nè®©æˆ‘ä»¬å¼€å§‹ç›¸åº”çš„ä¸»é¢˜â€œå¦‚ä½•ä½¿ç”¨ UserDetailsSâ€‹â€‹ervice åœ¨ Spring Boot ä¸­å®ç°å®‰å…¨æ€§ï¼Ÿâ€ã€‚\næ€»ä½“è€Œè¨€ï¼Œæ‚¨å¯¹è¿™ç¯‡æ–‡ç« æœ‰ä½•æœŸæœ›ï¼Ÿ Spring Security ä¸Šä¸‹æ–‡ä¸­çš„ UserDetailsSâ€‹â€‹ervice æ¦‚å¿µæ˜¯ä»€ä¹ˆï¼Ÿ\nå®æ–½ UserDetailsService æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ\nå¦‚ä½•ä½¿ç”¨ UserDetailsService åœ¨ Spring Boot ä¸­å®ç°å®‰å…¨æ€§ï¼Ÿ\nUserDetailsService åœ¨ Spring Security åº”ç”¨ç¨‹åºä¸­å¦‚ä½•å†…éƒ¨å·¥ä½œå¹¶å¸¦æœ‰æµç¨‹å›¾ï¼Ÿ\nå¦å¤–ï¼Œå¦‚ä½•ä½¿ç”¨æ³¨è§£ï¼š@EnableWebSecurityã€@Configurationã€@Beanã€@GetMappingã€@Autowiredã€@Dataã€@Entityã€@Tableã€@Idã€@GenerateValueã€@Columnã€@ElementCollectionã€@CollectionTableã€@JoinColumn ï¼Œ @æœåŠ¡\nå¦‚ä½•ä½¿ç”¨ Spring MVC å’Œ Thymeleaf å¼€å‘ç”¨æˆ·æ³¨å†Œåº”ç”¨ç¨‹åºï¼Ÿ\nå¦‚ä½•æµ‹è¯•å¯ç”¨å®‰å…¨çš„åº”ç”¨ç¨‹åºï¼Ÿ\nå¦‚ä½•åœ¨æ²¡æœ‰ WebSecurityConfigurerAdapter çš„æƒ…å†µä¸‹ä½¿ç”¨ UserDetailsService åœ¨ Spring Boot ä¸­å®ç°å®‰å…¨æ€§ï¼Ÿ\nUserDetailsService æ˜¯åšä»€ä¹ˆçš„ï¼Ÿä½¿ç”¨å®ƒæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ UserDetailsSâ€‹â€‹ervice æ˜¯ Spring ä¸­ org.springframework.security.core.userdetails åŒ…ä¸‹çš„é¢„å®šä¹‰æ¥å£ã€‚æˆ‘ä»¬çš„å®ç°ç±»å®ç°äº†è¿™ä¸ªæ¥å£å¹¶é‡å†™äº†å®ƒçš„ loadUserByUsername(String username) æ–¹æ³•ã€‚æ­¤æ–¹æ³•è¿”å› UserDetailsï¼Œå®ƒåˆæ˜¯ä¸€ä¸ªæ¥å£ã€‚é¢„å®šä¹‰çš„ User ç±»ï¼ˆorg.springframework.security.core.userdetails.Userï¼‰æ˜¯ UserDetails æ¥å£çš„å®ç°ã€‚æ€»ä¹‹ï¼Œåœ¨ loadUserByUsername(String username) æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä¼ é€’ç”¨æˆ·åï¼Œå®ƒè¿”å›æˆ‘ä»¬é¢„å®šä¹‰çš„ User å¯¹è±¡ï¼ˆorg.springframework.security.core.userdetails.Userï¼‰ã€‚\näº‹å®ä¸Šï¼Œæˆ‘ä»¬åªå‘ UserDetailsSâ€‹â€‹ervice æä¾›ç”¨æˆ·åå’Œä¸€äº›å°çš„é…ç½®ï¼Œå¹¶ä¸”æˆ‘ä»¬å°†æ‰€æœ‰åŸºäºè§’è‰²çš„å®‰å…¨åŠŸèƒ½ä½œä¸ºæ¡†æ¶çš„ä¸€éƒ¨åˆ†å®ç°ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨å®æ–½å®‰å…¨æ€§æ–¹é¢èŠ‚çœäº†å¤§é‡ç²¾åŠ›ã€‚\nå¦‚ä½•åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­å®ç° UserDetailsService å®‰å…¨æ€§ï¼Ÿ é¦–å…ˆï¼Œæ‚¨å¿…é¡»æœ‰ä¸€ä¸ª Spring Boot Web åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­æ‚¨å°†æœ‰ä¸€ä¸ªè¡¨å•ï¼Œå³ä¸€ç§ç”¨æˆ·æ³¨å†Œè¡¨å•ã€‚ä½œä¸º Spring MVC ç»“æ„çš„ä¸€éƒ¨åˆ†ï¼Œæ‚¨å°†æ‹¥æœ‰ä¸€ä¸ª UserService å®ç°ç±»ã€‚å‡è®¾å®ƒæ˜¯ UserServiceImpl.javaã€‚è¦è®°ä½çš„ç¬¬äºŒä»¶äº‹æ˜¯ï¼Œæ‚¨å¿…é¡»å°† User å¯¹è±¡è½¬æ¢ä¸ºé¢„å®šä¹‰çš„ Spring User å¯¹è±¡ã€‚æ­¤å¤–ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¸­å®ç° UserDetailsServiceã€‚\n1ï¼‰ä½ çš„ç”¨æˆ·æœåŠ¡ç±»â€˜UserServiceImpl.javaâ€™åº”è¯¥å®ç°æ¥å£ UserDetailsService.javaï¼ˆç”± Spring æä¾›ï¼‰\n2ï¼‰åŒæ ·é‡è¦çš„æ˜¯ï¼Œé‡å†™ UserServiceImpl ç±»ä¸­ UserDetailsService æ¥å£çš„ loadUserByUsername(String username) æ–¹æ³•ã€‚\n3ï¼‰ä½œä¸ºå®æ–½çš„ä¸€éƒ¨åˆ†ï¼Œ(A) å€ŸåŠ© UserRepository ä¸­çš„ç”¨æˆ·å/ç”µå­é‚®ä»¶è·å–æ‚¨çš„ç”¨æˆ·å¯¹è±¡ã€‚ (B) å°†ä½ çš„ User å¯¹è±¡ç›¸åº”åœ°è½¬æ¢ä¸º Spring é¢„å®šä¹‰çš„ User å¯¹è±¡(org.springframework.security.core.userdetails.User)ã€‚ (C) è¿”å› Spring å®šä¹‰çš„ User å¯¹è±¡ï¼Œå®ƒæ˜¯ UserDetailsï¼ˆæ–¹æ³•çš„è¿”å›ç±»å‹ï¼‰çš„å®ç°ã€‚\nä¸‹é¢çš„ä»£ç ä»£è¡¨äº† UserDetailsService çš„å®ç°ã€‚ä½†æ˜¯ï¼Œæ‚¨å°†åœ¨ä¸‹é¢çš„éƒ¨åˆ†ä¸­çœ‹åˆ°å®Œæ•´çš„ä»£ç ã€‚\nUserServiceImpl.java\nimport org.springframework.beans.factory.annotation.Autowired; import org.springframework.stereotype.Service; import java.util.HashSet; import java.util.List; import java.util.Optional; import java.util.Set; import java.util.stream.Collectors; @Service public class UserServiceImpl implements IUserService, UserDetailsService { @Autowired private UserRepository userRepo; @Override public UserDetails loadUserByUsername(String email) throws UsernameNotFoundException { Optional\u0026lt;User\u0026gt; opt = userRepo.findUserByEmail(email); org.springframework.security.core.userdetails.User springUser = null; if (opt.isEmpty()) { throw new UsernameNotFoundException(\u0026#34;User with email: \u0026#34; + email + \u0026#34; not found\u0026#34;); } else { User user = opt.get(); List\u0026lt;String\u0026gt; roles = user.getRoles(); Set\u0026lt;GrantedAuthority\u0026gt; ga = new HashSet\u0026lt;\u0026gt;(); for (String role : roles) { ga.add(new SimpleGrantedAuthority(role)); } springUser = new org.springframework.security.core.userdetails.User( email, user.getPassword(), ga); } return springUser; } //Other Approach: Using Lambda \u0026amp; Stream API of Java 8 //\t@Override //\tpublic UserDetails loadUserByUsername(String email) //\tthrows UsernameNotFoundException { // //\tOptional\u0026lt;User\u0026gt; opt = userRepo.findUserByEmail(email); // //\tif (opt.isEmpty()) //\tthrow new UsernameNotFoundException(\u0026#34;User with email: \u0026#34; + email + \u0026#34; not found !\u0026#34;); //\telse { //\tUser user = opt.get(); //\treturn new org.springframework.security.core.userdetails.User( //\tuser.getEmail(), //\tuser.getPassword(), //\tuser.getRoles() //\t.stream() //\t.map(role -\u0026gt; new SimpleGrantedAuthority(role)) //\t.collect(Collectors.toSet()) //\t); //\t} //\t} } UserDetailsService åœ¨ Spring Security åº”ç”¨ç¨‹åºå†…éƒ¨å¦‚ä½•å·¥ä½œï¼Ÿ ` ä¸€æ—¦ç”¨æˆ·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç å¹¶å•å‡»â€œç™»å½•â€æŒ‰é’®ï¼Œå°±ä¼šè°ƒç”¨ WebSecurityConfigurerAdapterï¼Œè¯¥é€‚é…å™¨åœ¨å†…éƒ¨è°ƒç”¨ UserServiceImpl.javaï¼ˆå®ç°ç±»ï¼Œç”±ç¨‹åºå‘˜æä¾›ï¼‰ã€‚æ­¤å¤–ï¼ŒUserServiceImpl.java ä¸­å®ç°çš„ loadUserByUserName()æ–¹æ³•å°†æˆ‘ä»¬çš„ User å¯¹è±¡è½¬æ¢ä¸º Spring æä¾›çš„ User å¯¹è±¡ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬çš„ SecurityConfig.java æ‰©å±•äº† WebSecurityConfigurerAdapter å¹¶é€šè¿‡ä¸¤ç§æ–¹æ³•æä¾›äº†èº«ä»½éªŒè¯å’Œæˆæƒé€»è¾‘çš„å®ç°ï¼›åˆ†åˆ«é…ç½®ï¼ˆAuthenticationManagerBuilderï¼‰å’Œé…ç½®ï¼ˆHttpSecurityï¼‰ï¼Œå¦‚ä¸‹é¢çš„ä»£ç æ‰€ç¤ºã€‚\nSecurityConfig.java\nimport org.springframework.beans.factory.annotation.Autowired; import org.springframework.context.annotation.Configuration; @EnableWebSecurity @Configuration public class SecurityConfig extends WebSecurityConfigurerAdapter { @Autowired private UserDetailsService uds; @Autowired private BCryptPasswordEncoder encoder; @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception { auth.userDetailsService(uds).passwordEncoder(encoder); } @Override protected void configure(HttpSecurity http) throws Exception { http.authorizeRequests() .antMatchers(\u0026#34;/home\u0026#34;, \u0026#34;/register\u0026#34;, \u0026#34;/saveUser\u0026#34;).permitAll() .antMatchers(\u0026#34;/welcome\u0026#34;).authenticated() .antMatchers(\u0026#34;/admin\u0026#34;).hasAuthority(\u0026#34;Admin\u0026#34;) .antMatchers(\u0026#34;/mgr\u0026#34;).hasAuthority(\u0026#34;Manager\u0026#34;) .antMatchers(\u0026#34;/emp\u0026#34;).hasAuthority(\u0026#34;Employee\u0026#34;) .antMatchers(\u0026#34;/hr\u0026#34;).hasAuthority(\u0026#34;HR\u0026#34;) .antMatchers(\u0026#34;/common\u0026#34;).hasAnyAuthority(\u0026#34;Employeee,Manager,Admin\u0026#34;) .anyRequest().authenticated().and() .formLogin() .defaultSuccessUrl(\u0026#34;/welcome\u0026#34;, true).and() .logout() .logoutRequestMatcher(new AntPathRequestMatcher(\u0026#34;/logout\u0026#34;)).and() .exceptionHandling() .accessDeniedPage(\u0026#34;/accessDenied\u0026#34;); } } æ³¨æ„ï¼šä» Spring Security 5.7.0-M2 å¼€å§‹ï¼ŒWebSecurityConfigurerAdapter å·²è¢«å¼ƒç”¨ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ Spring Security 5.7.0-M2 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œè¯·æ›´æ–°æ‚¨çš„å®ç°ï¼Œå¦‚ä¸‹é¢çš„ä»£ç ç‰‡æ®µæ‰€ç¤ºã€‚æ­¤å¤–ï¼Œä¸ºäº†äº†è§£å®ç°è‡ªå®šä¹‰é…ç½®ç±»çš„æ–°æ–¹æ³•ï¼Œè¯·è®¿é—®æœ‰å…³ä¸ä½¿ç”¨ WebSecurityConfigurerAdapter çš„ Spring Security çš„å•ç‹¬æ–‡ç« ã€‚\nSecurityConfig.java\npackage com.dev.springboot.security.UserDetailsService.config; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.authentication.AuthenticationProvider; import org.springframework.security.authentication.dao.DaoAuthenticationProvider; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity; import org.springframework.security.core.userdetails.UserDetailsService; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; import org.springframework.security.web.SecurityFilterChain; import org.springframework.security.web.util.matcher.AntPathRequestMatcher; @EnableWebSecurity @Configuration public class SecurityConfig { @Autowired private UserDetailsService uds; @Autowired private BCryptPasswordEncoder encoder; @Bean public SecurityFilterChain filterChain(HttpSecurity http) throws Exception { http.authorizeRequests() .antMatchers(\u0026#34;/home\u0026#34;,\u0026#34;/register\u0026#34;,\u0026#34;/saveUser\u0026#34;).permitAll() .antMatchers(\u0026#34;/welcome\u0026#34;).authenticated() .antMatchers(\u0026#34;/admin\u0026#34;).hasAuthority(\u0026#34;Admin\u0026#34;) .antMatchers(\u0026#34;/mgr\u0026#34;).hasAuthority(\u0026#34;Manager\u0026#34;) .antMatchers(\u0026#34;/emp\u0026#34;).hasAuthority(\u0026#34;Employee\u0026#34;) .antMatchers(\u0026#34;/hr\u0026#34;).hasAuthority(\u0026#34;HR\u0026#34;) .antMatchers(\u0026#34;/common\u0026#34;).hasAnyAuthority(\u0026#34;Employeee,Manager,Admin\u0026#34;) .anyRequest().authenticated() .and() .formLogin() .defaultSuccessUrl(\u0026#34;/welcome\u0026#34;,true) .and() .logout() .logoutRequestMatcher(new AntPathRequestMatcher(\u0026#34;/logout\u0026#34;)) .and() .exceptionHandling() .accessDeniedPage(\u0026#34;/accessDenied\u0026#34;) .and() .authenticationProvider(authenticationProvider()); return http.build(); } @Bean public AuthenticationProvider authenticationProvider() { DaoAuthenticationProvider authenticationProvider = new DaoAuthenticationProvider(); authenticationProvider.setUserDetailsService(uds); authenticationProvider.setPasswordEncoder(encoder); return authenticationProvider; } } å®ç° UserDetailsService çš„ç¤ºä¾‹ ä¸ºäº†è¯´æ˜ UserDetailsSâ€‹â€‹ervice çš„å®ç°ï¼Œæˆ‘ä»¬å‡è®¾ä¸€ä¸ªå°å…¬å¸çš„å†…éƒ¨é—¨æˆ·ã€‚åœ¨å…¬å¸ä¸­ï¼Œæˆ‘ä»¬çš„å‘˜å·¥æ‰®æ¼”ç€å„ç§è§’è‰²ï¼Œä¾‹å¦‚ç®¡ç†å‘˜ã€äººåŠ›èµ„æºã€ç»ç†ï¼Œå½“ç„¶è¿˜æœ‰å‘˜å·¥ã€‚æ­¤å¤–ï¼Œé—¨æˆ·è¿˜å…·æœ‰åŸºäºè§’è‰²çš„é¡µé¢è®¿é—®æƒé™ã€‚ç”šè‡³æŸäº›é¡µé¢å¯ä¾›æ‰€æœ‰è§’è‰²è®¿é—®ï¼Œè€Œå…¶ä»–é¡µé¢åˆ™ä»…é™äºæŸäº›ç‰¹å®šè§’è‰²ã€‚\nåŒæ ·é‡è¦çš„æ˜¯ï¼Œå…¬å¸å°†æœ‰ä¸€ä¸ªç”¨æˆ·æ³¨å†Œé¡µé¢ï¼Œå³ä½¿æ²¡æœ‰ç™»å½•ï¼Œæ‰€æœ‰ç”¨æˆ·ä¹Ÿå¿…é¡»å¯ä»¥è®¿é—®è¯¥é¡µé¢ã€‚ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ ‡å‡†ç”¨æˆ·æ³¨å†Œæµç¨‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚\næ­¥éª¤#1ï¼šåœ¨ STS(Spring Tool Suite)ä¸­åˆ›å»ºä¸€ä¸ª Spring Boot Starter é¡¹ç›® åˆ›å»ºå…¥é—¨é¡¹ç›®æ—¶ï¼Œé€‰æ‹©â€œSpring Securityâ€ã€â€œThymeleafâ€ã€â€œSpring Webâ€ã€â€œSpring Data JPAâ€ã€â€œMySQL Driverâ€ã€â€œLombokâ€å’Œâ€œSpring Boot DevToolsâ€ä½œä¸ºå…¥é—¨é¡¹ç›®ä¾èµ–é¡¹ã€‚å³ä½¿æ‚¨ä¸çŸ¥é“å¦‚ä½•åˆ›å»º Spring Boot å…¥é—¨é¡¹ç›®ï¼Œä¹Ÿè¯·è®¿é—®â€œå¦‚ä½•åœ¨ Spring boot ä¸­åˆ›å»ºå…¥é—¨é¡¹ç›®ï¼Ÿâ€çš„å†…éƒ¨é“¾æ¥ã€‚å¦å¤–ï¼Œå¦‚æœæ‚¨æƒ³äº†è§£æœ‰å…³ Lombok çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—® Lombok ä¸Šçš„å†…éƒ¨é“¾æ¥ã€‚\næ­¥éª¤#2ï¼šæ›´æ–°æ•°æ®åº“é…ç½® æ›´æ–° application.properties ä»¥è¿æ¥åˆ° MySQL æ•°æ®åº“ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çœç•¥ driver-class-nameï¼Œå› ä¸º Spring Boot ä¼šè‡ªåŠ¨ä»æ•°æ®åº“ URL ä¸­æ‰¾åˆ°å®ƒï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ä¸è¿‡ï¼Œå»ºè®®ä¿ç•™ã€‚\n#application.properties --------------------------------------------------------------------- #-------------------- server properties --------------- server.port=8080 #--------------------- DB Connection ------------------ #AutoLoading of driver class since JDBC 4 #spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver spring.datasource.url=jdbc:mysql://localhost:3306/testBootSecurity spring.datasource.username=root spring.datasource.password=devs #--------------------JPA-ORM Properties----------------- spring.jpa.show-sql=true spring.jpa.hibernate.ddl-auto=update #spring.jpa.database-platform=org.hibernet.dialect.MySQL8Dialect æ­¥éª¤#3ï¼šåˆ›å»ºç”¨æˆ·å®ä½“å’Œå­˜å‚¨åº“ç±» ç°åœ¨åˆ›å»º User.java å’Œ UserRepositoty.java å¦‚ä¸‹ã€‚åŒæ ·é‡è¦çš„æ˜¯ï¼ŒUser.java æœ‰ä¸€ä¸ª List ç±»å‹çš„å˜é‡â€œrolesâ€ã€‚å®ƒå°†åœ¨æ•°æ®åº“ä¸­åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„è¡¨ï¼Œå…¶ä¸­ç›¸åº”åœ°åŒ…å«ä¸¤åˆ— user_id å’Œ user_role ã€‚æ­¤å¤–ï¼Œ@ElementCollection(fetch= FetchType.EAGER)è¡¨ç¤ºåœ¨è·å– User å¯¹è±¡çš„åŒæ—¶ï¼Œä¹ŸåŒæ—¶è·å–è§’è‰²ã€‚å¦ä¸€æ–¹é¢ï¼ŒUserRepository æ‰©å±•äº†â€œJpaRepositoryâ€ä»¥åˆ©ç”¨å†…ç½®æ•°æ®åº“æ“ä½œã€‚\nUser.java\npackage com.dev.springboot.security.UserDetailsService.model; import java.util.List; import javax.persistence.CollectionTable; import javax.persistence.Column; import javax.persistence.ElementCollection; import javax.persistence.Entity; import javax.persistence.FetchType; import javax.persistence.GeneratedValue; import javax.persistence.Id; import javax.persistence.JoinColumn; import javax.persistence.Table; import lombok.Data; @Data @Entity @Table(name=\u0026#34;users\u0026#34;) public class User { @Id @GeneratedValue @Column(name=\u0026#34;user_id\u0026#34;) private Integer id; @Column(name=\u0026#34;user_name\u0026#34;) private String name; @Column(name=\u0026#34;user_passwd\u0026#34;) private String password; @Column(name=\u0026#34;user_email\u0026#34;) private String email; @ElementCollection(fetch= FetchType.EAGER) @CollectionTable( name=\u0026#34;roles\u0026#34;, joinColumns = @JoinColumn(name=\u0026#34;user_id\u0026#34;) ) @Column(name=\u0026#34;user_role\u0026#34;) private List\u0026lt;String\u0026gt; roles; } UserRepository.java\npackage com.dev.springboot.security.UserDetailsService.repo; import java.util.Optional; import org.springframework.data.jpa.repository.JpaRepository; import com.dev.springboot.security.UserDetailsService.model.User; public interface UserRepository extends JpaRepository\u0026lt;User, Integer\u0026gt; { Optional\u0026lt;User\u0026gt; findUserByEmail(String email); } æ­¥éª¤#4ï¼šåˆ›å»º AppConfig ç±»æ¥å®ä¾‹åŒ– BCryptPasswordEncoder ç”±äº BCryptPasswordEncoder æ˜¯ä¸€ä¸ªé¢„å®šä¹‰çš„ç±»ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨ AppConfig.java ä¸­æä¾›å®ƒçš„å®ä¾‹åŒ–ä»£ç ä½œä¸ºé…ç½®ç±»ã€‚æ­¤å¤–ï¼Œéœ€è¦ BCryptPasswordEncoder åœ¨å…¶ä»–ç±»ä¸­å¯¹æˆ‘ä»¬çš„å¯†ç å€¼è¿›è¡Œç¼–ç ã€‚\nAppConfig.java\npackage com.dev.springboot.security.UserDetailsService.config; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; @Configuration public class AppConfig { @Bean public BCryptPasswordEncoder passwordEncoder() { return new BCryptPasswordEncoder(); } } æ­¥éª¤#5ï¼šåˆ›å»ºæœåŠ¡æ¥å£å’ŒæœåŠ¡å®ç°ç±» ç›¸åº”åœ°åˆ›å»ºæœåŠ¡æ¥å£å’ŒæœåŠ¡ Impl ç±»ä½œä¸º IUserService.java å’Œ UserServiceImpl.javaï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚äº‹å®ä¸Šï¼ŒUserServiceImpl.java ä¸­ loadUserByUsername(String email) æ–¹æ³•çš„å®ç°æ˜¯æ•´ä¸ª UserDetailsSâ€‹â€‹ervice ä¸­æœ€é‡è¦çš„éƒ¨åˆ†ã€‚\nIUserService.java\npackage com.dev.springboot.security.UserDetailsService.service; import com.dev.springboot.security.UserDetailsService.model.User; public interface IUserService { public Integer saveUser(User user); } UserServiceImpl.java\npackage com.dev.springboot.security.UserDetailsService.service.impl; import java.util.HashSet; import java.util.List; import java.util.Optional; import java.util.Set; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.security.core.GrantedAuthority; import org.springframework.security.core.authority.SimpleGrantedAuthority; import org.springframework.security.core.userdetails.UserDetails; import org.springframework.security.core.userdetails.UserDetailsService; import org.springframework.security.core.userdetails.UsernameNotFoundException; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; import org.springframework.stereotype.Service; import com.dev.springboot.security.UserDetailsService.model.User; import com.dev.springboot.security.UserDetailsService.repo.UserRepository; import com.dev.springboot.security.UserDetailsService.service.IUserService; @Service public class UserServiceImpl implements IUserService, UserDetailsService{ @Autowired private UserRepository userRepo; @Autowired private BCryptPasswordEncoder passwordEncoder; @Override public Integer saveUser(User user) { String passwd= user.getPassword(); String encodedPasswod = passwordEncoder.encode(passwd); user.setPassword(encodedPasswod); user = userRepo.save(user); return user.getId(); } @Override public UserDetails loadUserByUsername(String email) throws UsernameNotFoundException { Optional\u0026lt;User\u0026gt; opt = userRepo.findUserByEmail(email); org.springframework.security.core.userdetails.User springUser=null; if(opt.isEmpty()) { throw new UsernameNotFoundException(\u0026#34;User with email: \u0026#34; +email +\u0026#34; not found\u0026#34;); }else { User user =opt.get(); List\u0026lt;String\u0026gt; roles = user.getRoles(); Set\u0026lt;GrantedAuthority\u0026gt; ga = new HashSet\u0026lt;\u0026gt;(); for(String role:roles) { ga.add(new SimpleGrantedAuthority(role)); } springUser = new org.springframework.security.core.userdetails.User( email, user.getPassword(), ga ); } return springUser; } //Other Approach: Using Lambda \u0026amp; Stream API of Java 8 /*@Override public UserDetails loadUserByUsername(String email) throws UsernameNotFoundException { Optional\u0026lt;User\u0026gt; opt = userRepo.findUserByEmail(email); if(opt.isEmpty()) throw new UsernameNotFoundException(\u0026#34;User with email: \u0026#34; +email +\u0026#34; not found !\u0026#34;); else { User user = opt.get(); return new org.springframework.security.core.userdetails.User( user.getEmail(), user.getPassword(), user.getRoles() .stream() .map(role-\u0026gt; new SimpleGrantedAuthority(role)) .collect(Collectors.toSet()) ); }*/ } æ­¥éª¤#6ï¼šåˆ›å»ºä¸€ä¸ª UserController ç±» éšåï¼Œä¸ºç”¨æˆ·ç¼–å†™ä¸€ä¸ªæ§åˆ¶å™¨ç±»â€œUserController.javaâ€ï¼Œå®ƒå°†æ§åˆ¶ç”¨æˆ·æ³¨å†Œé¡µé¢ã€‚\nUserController.java\npackage com.dev.springboot.security.UserDetailsService.controller; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.stereotype.Controller; import org.springframework.ui.Model; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.ModelAttribute; import org.springframework.web.bind.annotation.PostMapping; import com.dev.springboot.security.UserDetailsService.model.User; import com.dev.springboot.security.UserDetailsService.service.IUserService; @Controller public class UserController { @Autowired private IUserService userService; // Go to Registration Page @GetMapping(\u0026#34;/register\u0026#34;) public String register() { return \u0026#34;registerUser\u0026#34;; } // Read Form data to save into DB @PostMapping(\u0026#34;/saveUser\u0026#34;) public String saveUser( @ModelAttribute User user, Model model ) { Integer id = userService.saveUser(user); String message = \u0026#34;User \u0026#39;\u0026#34;+id+\u0026#34;\u0026#39; saved successfully !\u0026#34;; model.addAttribute(\u0026#34;msg\u0026#34;, message); return \u0026#34;registerUser\u0026#34;; } } æ­¥éª¤#7ï¼šç¼–å†™ä¸€ä¸ªæ§åˆ¶å™¨ç±»æ¥æµè§ˆé¡µé¢ é™¤äº† UserControllerï¼Œå†ç¼–å†™ä¸€ä¸ªæ§åˆ¶å™¨ç±»å¹¶å°†å…¶å‘½åä¸ºâ€œHomeController.javaâ€ã€‚è¯¥ç±»å°†è´Ÿè´£æµè§ˆä¸åŒçš„é¡µé¢ã€‚\nHomeController.java\npackage com.dev.springboot.security.UserDetailsService.controller; import org.springframework.stereotype.Controller; import org.springframework.web.bind.annotation.GetMapping; @Controller public class HomeController { @GetMapping(\u0026#34;/home\u0026#34;) public String getHomePage() { return \u0026#34;homePage\u0026#34;; } @GetMapping(\u0026#34;/welcome\u0026#34;) public String getWelcomePage() { return \u0026#34;welcomePage\u0026#34;; } @GetMapping(\u0026#34;/admin\u0026#34;) public String getAdminPage() { return \u0026#34;adminPage\u0026#34;; } @GetMapping(\u0026#34;/emp\u0026#34;) public String getEmployeePage() { return \u0026#34;empPage\u0026#34;; } @GetMapping(\u0026#34;/mgr\u0026#34;) public String getManagerPage() { return \u0026#34;mgrPage\u0026#34;; } @GetMapping(\u0026#34;/hr\u0026#34;) public String getHrPage() { return \u0026#34;hrPage\u0026#34;; } @GetMapping(\u0026#34;/common\u0026#34;) public String getCommonPage() { return \u0026#34;commonPage\u0026#34;; } @GetMapping(\u0026#34;/accessDenied\u0026#34;) public String getAccessDeniedPage() { return \u0026#34;accessDeniedPage\u0026#34;; } } æ­¥éª¤#8ï¼šç¼–å†™ UI é¡µé¢(Thymeleaf) ä»¥ä¸‹æ˜¯ UI é¡µé¢çš„ .html æ–‡ä»¶ã€‚å°†è¿™äº›é¡µé¢ç›¸åº”åœ°æ”¾å…¥â€œsrc/main/resources/templatesâ€æ–‡ä»¶å¤¹ä¸­ã€‚\nregisterUser.html\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html xmlns:th=\u0026#34;http://www.thymeleaf.org\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;ISO-8859-1\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;User Registration\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h3\u0026gt;User Registration\u0026lt;/h3\u0026gt; \u0026lt;form action=\u0026#34;saveUser\u0026#34; method=\u0026#34;post\u0026#34;\u0026gt; \u0026lt;pre\u0026gt; Name : \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;name\u0026#34;/\u0026gt; Email: \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;email\u0026#34;/\u0026gt; Password: \u0026lt;input type=\u0026#34;password\u0026#34; name=\u0026#34;password\u0026#34;/\u0026gt; Role(s): \u0026lt;input type=\u0026#34;checkbox\u0026#34; name=\u0026#34;roles\u0026#34; value=\u0026#34;Admin\u0026#34;/\u0026gt;Admin \u0026lt;input type=\u0026#34;checkbox\u0026#34; name=\u0026#34;roles\u0026#34; value=\u0026#34;Manager\u0026#34;/\u0026gt;Manager \u0026lt;input type=\u0026#34;checkbox\u0026#34; name=\u0026#34;roles\u0026#34; value=\u0026#34;HR\u0026#34;/\u0026gt;HR \u0026lt;input type=\u0026#34;checkbox\u0026#34; name=\u0026#34;roles\u0026#34; value=\u0026#34;Employee\u0026#34;/\u0026gt;Employee \u0026lt;input type=\u0026#34;hidden\u0026#34; th:name=\u0026#34;${_csrf.parameterName}\u0026#34; th:value=\u0026#34;${_csrf.token}\u0026#34;/\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;Register\u0026#34;/\u0026gt; \u0026lt;/pre\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;div th:text=\u0026#34;${msg}\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; homePage.html\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html xmlns:th=\u0026#34;http://www.thymeleaf.org\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;ISO-8859-1\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Insert title here\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h3\u0026gt;welcome to the Home Page\u0026lt;/h3\u0026gt; This page is accessible to ALL. \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; welcomePage.html\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html xmlns:th=\u0026#34;http://www.thymeleaf.org\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;ISO-8859-1\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Insert title here\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h3\u0026gt;Welcome Page after successful Login\u0026lt;/h3\u0026gt; \u0026lt;a th:href=\u0026#34;@{/logout}\u0026#34;\u0026gt;LOGOUT\u0026lt;/a\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; adminPage.html\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html xmlns:th=\u0026#34;http://www.thymeleaf.org\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;ISO-8859-1\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Insert title here\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h3\u0026gt;Admin Page\u0026lt;/h3\u0026gt; Welcome to Admin page.!!! \u0026lt;a th:href=\u0026#34;@{/logout}\u0026#34;\u0026gt;LOGOUT\u0026lt;/a\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; empPage.html\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html xmlns:th=\u0026#34;http://www.thymeleaf.org\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;ISO-8859-1\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Insert title here\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h3\u0026gt;Employee Page\u0026lt;/h3\u0026gt; \u0026lt;a th:href=\u0026#34;@{/logout}\u0026#34;\u0026gt;LOGOUT\u0026lt;/a\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; mgrPage.html\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html xmlns:th=\u0026#34;http://www.thymeleaf.org\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;ISO-8859-1\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Insert title here\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h3\u0026gt;Manager Page\u0026lt;/h3\u0026gt; \u0026lt;a th:href=\u0026#34;@{/logout}\u0026#34;\u0026gt;LOGOUT\u0026lt;/a\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; hrPage.html\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html xmlns:th=\u0026#34;http://www.thymeleaf.org\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;ISO-8859-1\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Insert title here\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h3\u0026gt;HR Page\u0026lt;/h3\u0026gt; \u0026lt;a th:href=\u0026#34;@{/logout}\u0026#34;\u0026gt;LOGOUT\u0026lt;/a\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; commonPage.html\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html xmlns:th=\u0026#34;http://www.thymeleaf.org\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;ISO-8859-1\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Insert title here\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h3\u0026gt;You are not allowed to access this page. Please go to Welcome Page\u0026lt;/h3\u0026gt; \u0026lt;a th:href=\u0026#34;@{/welcome}\u0026#34;\u0026gt;Welcome\u0026lt;/a\u0026gt; \u0026lt;a th:href=\u0026#34;@{/logout}\u0026#34;\u0026gt;LOGOUT\u0026lt;/a\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; accessDeniedPage.html\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html xmlns:th=\u0026#34;http://www.thymeleaf.org\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;ISO-8859-1\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Insert title here\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h3\u0026gt;You are not allowed to access this page. Please go to Welcome Page\u0026lt;/h3\u0026gt; \u0026lt;a th:href=\u0026#34;@{/welcome}\u0026#34;\u0026gt;Welcome\u0026lt;/a\u0026gt; \u0026lt;a th:href=\u0026#34;@{/logout}\u0026#34;\u0026gt;LOGOUT\u0026lt;/a\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; æ­¥éª¤ï¼ƒ9ï¼šç¼–å†™ SecurityConfig ç±» æœ€åï¼Œç¼–å†™å¦ä¸€ä¸ªé‡è¦çš„ç±» SecurityConfig.java ï¼Œå®ƒå°†æ‰©å±•é¢„å®šä¹‰çš„ç±» WebSecurityConfigurerAdapter.java å¹¶ç›¸åº”åœ°å®ç°ä¸¤ä¸ª configure() æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚\nSecurityConfig.java\npackage com.dev.springboot.security.UserDetailsService.config; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.context.annotation.Configuration; import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity; import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter; import org.springframework.security.core.userdetails.UserDetailsService; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; import org.springframework.security.web.util.matcher.AntPathRequestMatcher; @EnableWebSecurity @Configuration public class SecurityConfig extends WebSecurityConfigurerAdapter { @Autowired private UserDetailsService uds; @Autowired private BCryptPasswordEncoder encoder; @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception { auth.userDetailsService(uds).passwordEncoder(encoder); } @Override protected void configure(HttpSecurity http) throws Exception { http.authorizeRequests() .antMatchers(\u0026#34;/home\u0026#34;,\u0026#34;/register\u0026#34;,\u0026#34;/saveUser\u0026#34;).permitAll() .antMatchers(\u0026#34;/welcome\u0026#34;).authenticated() .antMatchers(\u0026#34;/admin\u0026#34;).hasAuthority(\u0026#34;Admin\u0026#34;) .antMatchers(\u0026#34;/mgr\u0026#34;).hasAuthority(\u0026#34;Manager\u0026#34;) .antMatchers(\u0026#34;/emp\u0026#34;).hasAuthority(\u0026#34;Employee\u0026#34;) .antMatchers(\u0026#34;/hr\u0026#34;).hasAuthority(\u0026#34;HR\u0026#34;) .antMatchers(\u0026#34;/common\u0026#34;).hasAnyAuthority(\u0026#34;Employeee,Manager,Admin\u0026#34;) .anyRequest().authenticated() .and() .formLogin() .defaultSuccessUrl(\u0026#34;/welcome\u0026#34;,true) .and() .logout() .logoutRequestMatcher(new AntPathRequestMatcher(\u0026#34;/logout\u0026#34;)) .and() .exceptionHandling() .accessDeniedPage(\u0026#34;/accessDenied\u0026#34;); } } æ­¥éª¤ï¼ƒ9Aï¼šç¼–å†™ SecurityConfig ç±»è€Œä¸ä½¿ç”¨ WebSecurityConfigurerAdapter å¦‚å‰æ‰€è¿°ï¼Œä» Spring Security 5.7.0-M2 å¼€å§‹ï¼ŒWebSecurityConfigurerAdapter å·²è¢«å¼ƒç”¨ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ Spring Security 5.7.0-M2 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œè¯·æ›´æ–°æ‚¨çš„å®ç°ï¼Œå¦‚ä¸‹é¢çš„ä»£ç ç‰‡æ®µæ‰€ç¤ºã€‚\nSecurityConfig.java\npackage com.dev.springboot.security.UserDetailsService.config; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.authentication.AuthenticationProvider; import org.springframework.security.authentication.dao.DaoAuthenticationProvider; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity; import org.springframework.security.core.userdetails.UserDetailsService; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; import org.springframework.security.web.SecurityFilterChain; import org.springframework.security.web.util.matcher.AntPathRequestMatcher; @EnableWebSecurity @Configuration public class SecurityConfig { @Autowired private UserDetailsService uds; @Autowired private BCryptPasswordEncoder encoder; @Bean public SecurityFilterChain filterChain(HttpSecurity http) throws Exception { http.authorizeRequests() .antMatchers(\u0026#34;/home\u0026#34;,\u0026#34;/register\u0026#34;,\u0026#34;/saveUser\u0026#34;).permitAll() .antMatchers(\u0026#34;/welcome\u0026#34;).authenticated() .antMatchers(\u0026#34;/admin\u0026#34;).hasAuthority(\u0026#34;Admin\u0026#34;) .antMatchers(\u0026#34;/mgr\u0026#34;).hasAuthority(\u0026#34;Manager\u0026#34;) .antMatchers(\u0026#34;/emp\u0026#34;).hasAuthority(\u0026#34;Employee\u0026#34;) .antMatchers(\u0026#34;/hr\u0026#34;).hasAuthority(\u0026#34;HR\u0026#34;) .antMatchers(\u0026#34;/common\u0026#34;).hasAnyAuthority(\u0026#34;Employeee,Manager,Admin\u0026#34;) .anyRequest().authenticated() .and() .formLogin() .defaultSuccessUrl(\u0026#34;/welcome\u0026#34;,true) .and() .logout() .logoutRequestMatcher(new AntPathRequestMatcher(\u0026#34;/logout\u0026#34;)) .and() .exceptionHandling() .accessDeniedPage(\u0026#34;/accessDenied\u0026#34;) .and() .authenticationProvider(authenticationProvider()); return http.build(); } @Bean public AuthenticationProvider authenticationProvider() { DaoAuthenticationProvider authenticationProvider = new DaoAuthenticationProvider(); authenticationProvider.setUserDetailsService(uds); authenticationProvider.setPasswordEncoder(encoder); return authenticationProvider; } } æœ€åæˆ‘ä»¬å®Œæˆäº†ç¼–ç éƒ¨åˆ†ã€‚\nå¦‚ä½•æµ‹è¯•å¯ç”¨å®‰å…¨çš„åº”ç”¨ç¨‹åºï¼Ÿ è™½ç„¶â€œæµ‹è¯•â€è¿™ä¸ªè¯å¯¹äºå¼€å‘äººå‘˜æ¥è¯´çœ‹èµ·æ¥å¾ˆå®¹æ˜“ï¼Œä½†å®ƒåŒæ ·é‡è¦ï¼Œå› ä¸ºå®ƒæä¾›äº†æˆ‘ä»¬æ•´ä½“å®ç°çš„ç»“æœã€‚åœ¨æµ‹è¯•åº”ç”¨ç¨‹åºæ—¶ï¼Œæ‚¨åº”è¯¥å°† SecurityConfig ç±»çš„ configure(HttpSecurity http) æ–¹æ³•ä¿ç•™åœ¨æ‚¨é¢å‰ï¼Œç„¶åæŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š\nå¯åŠ¨åº”ç”¨ç¨‹åºï¼šå³é”®å•å‡»é¡¹ç›®ï¼Œç„¶åé€‰æ‹©â€œRun Asâ€\u0026raquo;â€œSpring Boot Appâ€ã€‚\nè¾“å…¥æ³¨å†Œé¡µé¢ç½‘å€ http://localhost:8080/registerï¼Œç„¶åæ£€æŸ¥æ˜¯å¦æ¯ä¸ªäººéƒ½å¯ä»¥è®¿é—®ï¼Œç”šè‡³ä¸éœ€è¦ç™»å½•åº”ç”¨ç¨‹åºã€‚\nè¾“å…¥å¿…å¡«å­—æ®µå€¼å¹¶ç›¸åº”åœ°å•å‡»â€œæ³¨å†Œâ€æŒ‰é’®å®Œæˆæ³¨å†Œè¿‡ç¨‹ã€‚\nç°åœ¨è¾“å…¥æ‚¨åœ¨æ³¨å†Œæ—¶é€‰æ‹©çš„è§’è‰²ç‰¹å®šçš„ä»»ä½• URLã€‚å‡è®¾æ‚¨è¾“å…¥ URL http://localhost:8080/adminï¼Œé‚£ä¹ˆå®ƒåº”è¯¥å°†æ‚¨é‡å®šå‘åˆ°å†…ç½®çš„ç™»å½•é¡µé¢ã€‚\nè¾“å…¥å‡­æ®ï¼ˆç”µå­é‚®ä»¶ ID ä»£æ›¿ç”¨æˆ·åï¼‰å¹¶ç™»å½•åˆ°åº”ç”¨ç¨‹åºã€‚å®ƒä¼šå°†æ‚¨é‡å®šå‘åˆ°é»˜è®¤çš„æˆåŠŸ URLï¼Œå³æ¬¢è¿é¡µé¢ã€‚\nç°åœ¨è¾“å…¥ç½‘å€ http://localhost:8080/admin\nå¯¹å…¶ä»–è§’è‰²ä¹Ÿé‡å¤ä¸Šè¿°æ­¥éª¤ã€‚\næ­¤å¤–ï¼Œå¦‚ä¸Šæ‰€è¿°ï¼Œå°†ä»£ç æ”¾åœ¨æ‚¨é¢å‰å¹¶éšåæµ‹è¯•æ¯ä¸ªåœºæ™¯ã€‚\næ¦‚æ‹¬ åœ¨å®Œæˆâ€œå¦‚ä½•ä½¿ç”¨ UserDetailsSâ€‹â€‹ervice åœ¨ Spring Boot ä¸­å®ç°å®‰å…¨æ€§ï¼Ÿâ€çš„æ‰€æœ‰ç†è®ºå’Œç¤ºä¾‹éƒ¨åˆ†ä¹‹åï¼Œæœ€åï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨ Spring Boot é¡¹ç›®ä¸­å®ç° Web å®‰å…¨æ€§ã€‚å½“ç„¶ï¼Œåœ¨æœ¬æ–‡ä¸­æˆ‘ä»¬ä»‹ç»äº†å®ç°å®‰å…¨åŠŸèƒ½çš„ç¬¬ä¸‰ç§æ–¹æ³•ã€‚åŒæ ·ï¼Œæˆ‘ä»¬å°†åœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­è®¨è®ºæ›´å¤šå®‰å…¨æ–¹æ³•ï¼Œä¾‹å¦‚ REST å®‰å…¨æ€§ã€‚æœªæ¥è‹¥æœ‰ä»»ä½•å˜åŒ–ï¼Œæˆ‘ä»¬å°†è¿›è¡Œç›¸åº”æ›´æ–°ã€‚\nå¦‚æœæ‚¨æƒ³äº†è§£æœ‰å…³ Spring Security çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—® spring.io æ–‡æ¡£ã€‚å¦å¤–ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºæå‡ºä½ çš„æ„è§ã€‚\nåŸæ–‡é“¾æ¥ï¼šhttps://javatechonline.com/how-to-implement-security-in-spring-boot-using-userdetailsservice/\n","permalink":"https://blog.chensoul.cc/posts/2023/08/18/how-to-implement-security-in-spring-boot2-using-userdetailsservice/","summary":"ç»§ç»­ä¸Šä¸€ç¯‡å…³äºå®ç° Spring Security çš„ä¸¤ç§ä¸åŒæ–¹æ³•çš„æ–‡ç« ï¼Œåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ ç¬¬ä¸‰ç§æ–¹æ³•â€œå¦‚ä½•ä½¿ç”¨ UserDetailsSâ€‹â€‹ervice åœ¨ Spring Boot ä¸­å®ç° Securityï¼Ÿâ€ã€‚ç»è¿‡ä¸Šä¸€ç¯‡æ–‡ç« åï¼Œæˆ‘å¸Œæœ›æˆ‘ä»¬éƒ½éå¸¸ç†Ÿæ‚‰å®‰å…¨æ€§çš„åŸºç¡€çŸ¥è¯†ï¼Œç”šè‡³æ˜¯ Spring Boot åº”ç”¨ç¨‹åºä¸­çš„å®‰å…¨æ€§åŸºç¡€çŸ¥è¯†ã€‚è¿™æ¬¡æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç”¨æˆ·æ³¨å†Œè¡¨å¹¶å°†ç”¨æˆ·åŠå…¶è§’è‰²ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚\nç„¶åï¼Œæ ¹æ®ç”¨æˆ·è§’è‰²ï¼Œæˆ‘ä»¬å°†å€ŸåŠ©é¢„å®šä¹‰çš„ UserDetailsSâ€‹â€‹ervice æ£€æŸ¥èº«ä»½éªŒè¯å’ŒæˆæƒåŠŸèƒ½ã€‚\nå¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾â€œå¦‚ä½•åœ¨ Spring Boot 3 åŠä»¥ä¸Šç‰ˆæœ¬ä¸­ä½¿ç”¨ UserDetailsSâ€‹â€‹ervice åœ¨ Spring Boot ä¸­å®ç°å®‰å…¨æ€§ï¼Ÿâ€ï¼Œè¯·è®¿é—®æœ‰å…³ä½¿ç”¨ Spring Boot 3 çš„ Spring Security UserDetailsSâ€‹â€‹ervice çš„å•ç‹¬æ–‡ç« ã€‚\nä¸ºäº†è¯´æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†æŠŠä¸€äº›è§’è‰²å‘æŒ¥ä½œç”¨ï¼Œå¹¶åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­å›´ç»•å®ƒä»¬è¿›è¡Œå‘æŒ¥ï¼Œä»¥ä½¿å…¶å˜å¾—æ¸…æ™°ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å°†æœ‰ä¸€äº›é¡µé¢å¹¶é™åˆ¶å®ƒä»¬ä»…å¯ç”±æŸäº›ç‰¹å®šè§’è‰²è®¿é—®ã€‚åŒæ ·é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬å¿…é¡»åˆ›å»ºä¸€ä¸ªå°å‹ MVC Web åº”ç”¨ç¨‹åºï¼Œä»¥ä½¿æ³¨å†Œè¿‡ç¨‹å‘ç”¨æˆ·å¼€æ”¾ã€‚ç”¨æˆ·åœ¨æ³¨å†Œæ—¶å°†è¾“å…¥è‡ªå·±çš„è§’è‰²ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¹‹ä¸Šå®ç°å®‰å…¨åŠŸèƒ½ã€‚\nè®©æˆ‘ä»¬å¼€å§‹ç›¸åº”çš„ä¸»é¢˜â€œå¦‚ä½•ä½¿ç”¨ UserDetailsSâ€‹â€‹ervice åœ¨ Spring Boot ä¸­å®ç°å®‰å…¨æ€§ï¼Ÿâ€ã€‚\næ€»ä½“è€Œè¨€ï¼Œæ‚¨å¯¹è¿™ç¯‡æ–‡ç« æœ‰ä½•æœŸæœ›ï¼Ÿ Spring Security ä¸Šä¸‹æ–‡ä¸­çš„ UserDetailsSâ€‹â€‹ervice æ¦‚å¿µæ˜¯ä»€ä¹ˆï¼Ÿ\nå®æ–½ UserDetailsService æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ\nå¦‚ä½•ä½¿ç”¨ UserDetailsService åœ¨ Spring Boot ä¸­å®ç°å®‰å…¨æ€§ï¼Ÿ\nUserDetailsService åœ¨ Spring Security åº”ç”¨ç¨‹åºä¸­å¦‚ä½•å†…éƒ¨å·¥ä½œå¹¶å¸¦æœ‰æµç¨‹å›¾ï¼Ÿ\nå¦å¤–ï¼Œå¦‚ä½•ä½¿ç”¨æ³¨è§£ï¼š@EnableWebSecurityã€@Configurationã€@Beanã€@GetMappingã€@Autowiredã€@Dataã€@Entityã€@Tableã€@Idã€@GenerateValueã€@Columnã€@ElementCollectionã€@CollectionTableã€@JoinColumn ï¼Œ @æœåŠ¡\nå¦‚ä½•ä½¿ç”¨ Spring MVC å’Œ Thymeleaf å¼€å‘ç”¨æˆ·æ³¨å†Œåº”ç”¨ç¨‹åºï¼Ÿ\nå¦‚ä½•æµ‹è¯•å¯ç”¨å®‰å…¨çš„åº”ç”¨ç¨‹åºï¼Ÿ\nå¦‚ä½•åœ¨æ²¡æœ‰ WebSecurityConfigurerAdapter çš„æƒ…å†µä¸‹ä½¿ç”¨ UserDetailsService åœ¨ Spring Boot ä¸­å®ç°å®‰å…¨æ€§ï¼Ÿ\nUserDetailsService æ˜¯åšä»€ä¹ˆçš„ï¼Ÿä½¿ç”¨å®ƒæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ UserDetailsSâ€‹â€‹ervice æ˜¯ Spring ä¸­ org.springframework.security.core.userdetails åŒ…ä¸‹çš„é¢„å®šä¹‰æ¥å£ã€‚æˆ‘ä»¬çš„å®ç°ç±»å®ç°äº†è¿™ä¸ªæ¥å£å¹¶é‡å†™äº†å®ƒçš„ loadUserByUsername(String username) æ–¹æ³•ã€‚æ­¤æ–¹æ³•è¿”å› UserDetailsï¼Œå®ƒåˆæ˜¯ä¸€ä¸ªæ¥å£ã€‚é¢„å®šä¹‰çš„ User ç±»ï¼ˆorg.springframework.security.core.userdetails.Userï¼‰æ˜¯ UserDetails æ¥å£çš„å®ç°ã€‚æ€»ä¹‹ï¼Œåœ¨ loadUserByUsername(String username) æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä¼ é€’ç”¨æˆ·åï¼Œå®ƒè¿”å›æˆ‘ä»¬é¢„å®šä¹‰çš„ User å¯¹è±¡ï¼ˆorg.","title":"[è¯‘]å¦‚ä½•åœ¨Spring Boot2ä¸­ä½¿ç”¨UserDetailsServiceå®ç°å®‰å…¨æ€§ï¼Ÿ"},{"content":" ä½œä¸ºæœ‰å…³ Spring Security çš„ç³»åˆ—æ–‡ç« çš„ç»§ç»­ï¼Œåœ¨æœ¬æ–‡ä¸­æˆ‘ä»¬å°†å­¦ä¹ â€œå¦‚ä½•åœ¨ Spring Boot 3 ä¸­ä½¿ç”¨ UserDetailsService å®ç° Spring Boot ä¸­çš„å®‰å…¨æ€§ï¼Ÿâ€ã€‚ç»è¿‡å‰é¢çš„æ–‡ç« ï¼Œæˆ‘å¸Œæœ›æˆ‘ä»¬éƒ½éå¸¸ç†Ÿæ‚‰å®‰å…¨æ€§çš„åŸºç¡€çŸ¥è¯†ï¼Œç”šè‡³ Spring Boot åº”ç”¨ç¨‹åºä¸­çš„å®‰å…¨æ€§åŸºç¡€çŸ¥è¯†ã€‚ Spring Boot 3 å‘å¸ƒåï¼Œæˆ‘ä»¬å°†åœ¨è¿™é‡Œå®ç°â€œä½¿ç”¨ Spring Boot 3 çš„ Spring Security UserDetailsServiceâ€ã€‚\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç”¨æˆ·æ³¨å†Œè¡¨å•å¹¶å°†ç”¨æˆ·åŠå…¶è§’è‰²ä¿å­˜åœ¨æ•°æ®åº“ä¸­ã€‚ç„¶åï¼Œæ ¹æ®ç”¨æˆ·è§’è‰²ï¼Œæˆ‘ä»¬å°†å€ŸåŠ©é¢„å®šä¹‰çš„ UserDetailsSâ€‹â€‹ervice æ£€æŸ¥èº«ä»½éªŒè¯å’ŒæˆæƒåŠŸèƒ½ã€‚\næ‚¨å¯¹æ•´ç¯‡æ–‡ç« æœ‰ä½•æœŸæœ›ï¼Ÿ Spring Security ä¸Šä¸‹æ–‡ä¸­çš„ UserDetailsSâ€‹â€‹ervice æ¦‚å¿µæ˜¯ä»€ä¹ˆï¼Ÿ\nå®æ–½ UserDetailsService æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ\nå¦‚ä½•ä½¿ç”¨ Spring Boot 3 å®ç° Spring Security UserDetailsServiceï¼Ÿ\nå¦‚ä½•åœ¨åŸºäº Spring çš„åº”ç”¨ç¨‹åºä¸­å®ç°åŸºäºè§’è‰²çš„å®‰å…¨æ€§ï¼Ÿ\næ­¤å¤–ï¼Œå¦‚ä½•ä»¥åŠåœ¨å“ªé‡Œä½¿ç”¨æ³¨é‡Šï¼š@EnableWebSecurityï¼Œ@Configurationï¼Œ@Beanï¼Œ@GetMappingï¼Œ@Autowiredï¼Œ@Dataï¼Œ@Entityï¼Œ@Tableï¼Œ@Idï¼Œ@GenerateValueï¼Œ@Columnï¼Œ@ElementCollectionï¼Œ@CollectionTableï¼Œ @JoinColumnï¼Œ@Service\nå¦‚ä½•ä½¿ç”¨ Spring MVC å’Œ Thymeleaf å¼€å‘ç”¨æˆ·æ³¨å†Œåº”ç”¨ç¨‹åºï¼Ÿ\nå¦‚ä½•æµ‹è¯•å¯ç”¨å®‰å…¨çš„åº”ç”¨ç¨‹åºï¼Ÿ\nå¦‚ä½•åœ¨æ²¡æœ‰ WebSecurityConfigurerAdapter çš„æƒ…å†µä¸‹ä½¿ç”¨ UserDetailsService åœ¨ Spring Boot ä¸­å®ç°å®‰å…¨æ€§ï¼Ÿ\nç¤ºä¾‹ä¸­ä½¿ç”¨çš„è½¯ä»¶/æŠ€æœ¯ æœ‰æ—¶æŸäº›ç‰ˆæœ¬ä¸å…¶ä»–ç‰ˆæœ¬å†²çªã€‚å› æ­¤ï¼Œåˆ—å‡ºç»è¿‡æµ‹è¯•å¯ä»¥ç›¸äº’åä½œçš„ç»„åˆã€‚ä¸‹é¢æ˜¯ç»è¿‡æµ‹è¯•çš„è½¯ä»¶ç»„åˆï¼Œç”¨äºä½¿ç”¨ Spring Boot 3 å¼€å‘ Spring Security UserDetailsSâ€‹â€‹erviceã€‚å®ƒä¹Ÿä½¿å®ç°å®Œç¾æ— ç¼ºã€‚\nSpring Boot 3.0.0\nJDK 17 or later\nMaven 3.8.1 3ï¼‰Maven 3.8.1\nIDE â€“ STS 4.7.1. RELEASE\nIDE â€“ STS 4.7.1ã€‚å‘å¸ƒ\nJars Used ä¸‹é¢æ˜¯è¿™äº›ç¤ºä¾‹ä¸­ maven ä½¿ç”¨ pom.xml è‡ªåŠ¨ä¸‹è½½çš„ä¸»è¦ jar çš„åˆ—è¡¨ã€‚å¦‚æœæ‚¨åœ¨æ‰§è¡Œä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œå®ƒä»¬å¯èƒ½æœ‰åŠ©äºäº¤å‰éªŒè¯ã€‚\nspring-boot-3.0.0.jar\nspring-boot-starter-3.0.0.jar\nspring-boot-starter-security-3.0.0.jar\nspring-core-6.0.2.jar\nspring-security-core-6.0.0.jar\nthymeleaf-spring6-3.1.0.RELEASE.jar\nUserDetailsService æ˜¯åšä»€ä¹ˆçš„ï¼Ÿä½¿ç”¨å®ƒæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ UserDetailsSâ€‹â€‹ervice æ˜¯ Spring æ¡†æ¶åœ¨ org.springframework.security.core.userdetails åŒ…ä¸‹æä¾›çš„é¢„å®šä¹‰æ¥å£ã€‚ä¸ºäº†ä½¿ç”¨ UserDetailsSâ€‹â€‹erviceï¼Œæˆ‘ä»¬çš„å®ç°ç±»å®ç°äº†è¿™ä¸ªæ¥å£å¹¶é‡å†™äº†å®ƒçš„ loadUserByUsername(String username) æ–¹æ³•ã€‚è¯¥æ–¹æ³•çš„è¿”å›ç±»å‹æ˜¯ UserDetailsï¼Œå®ƒåˆæ˜¯ä¸€ä¸ªæ¥å£ã€‚é¢„å®šä¹‰çš„ User ç±»ï¼ˆorg.springframework.security.core.userdetails.Userï¼‰æ˜¯ UserDetails æ¥å£çš„å®ç°ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬åœ¨ loadUserByUsername(String username) æ–¹æ³•ä¸­ä¼ é€’ç”¨æˆ·åï¼Œå®ƒè¿”å›æˆ‘ä»¬é¢„å®šä¹‰çš„ User å¯¹è±¡ï¼ˆorg.springframework.security.core.userdetails.Userï¼‰ã€‚\näº‹å®ä¸Šï¼Œæˆ‘ä»¬åªå‘ UserDetailsSâ€‹â€‹ervice æä¾›ç”¨æˆ·åå’Œä¸€äº›å°é…ç½®ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰åŸºäºè§’è‰²çš„å†…ç½®å®‰å…¨åŠŸèƒ½ä½œä¸ºæ¡†æ¶çš„ä¸€éƒ¨åˆ†å®ç°ã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ UserDetailsSâ€‹â€‹ervice æ¥å£æ—¶ï¼Œæˆ‘ä»¬åœ¨å®ç°å®‰å…¨æ€§æ–¹é¢èŠ‚çœäº†å¾ˆå¤šç²¾åŠ›ã€‚\nå¦‚ä½•å°† UserDetailsService å®‰å…¨æ€§åˆå¹¶åˆ°æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ï¼Ÿ é¦–å…ˆï¼Œæ‚¨å¿…é¡»æœ‰ä¸€ä¸ª Spring Boot Web åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­æ‚¨å°†æœ‰ä¸€ä¸ªè¡¨å•ï¼Œå³ä¸€ç§ç”¨æˆ·æ³¨å†Œè¡¨å•ã€‚ä½œä¸º Spring MVC ç»“æ„çš„ä¸€éƒ¨åˆ†ï¼Œæ‚¨å°†æ‹¥æœ‰ä¸€ä¸ª UserService å®ç°ç±»ã€‚å‡è®¾å®ƒæ˜¯ UserServiceImpl.javaã€‚è¦è®°ä½çš„ç¬¬äºŒä»¶äº‹æ˜¯ï¼Œæ‚¨å¿…é¡»å°† User å¯¹è±¡è½¬æ¢ä¸ºé¢„å®šä¹‰çš„ Spring User å¯¹è±¡ã€‚æ­¤å¤–ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¸­å®ç° UserDetailsSâ€‹â€‹erviceã€‚\n1) ä½ çš„ç”¨æˆ·æœåŠ¡ç±»â€˜UserServiceImpl.javaâ€™åº”è¯¥å®ç°æ¥å£ UserDetailsSâ€‹â€‹ervice.javaï¼ˆç”± Spring æä¾›ï¼‰\n2) åŒæ ·é‡è¦çš„æ˜¯ï¼Œé‡å†™ UserServiceImpl ç±»ä¸­ UserDetailsSâ€‹â€‹ervice æ¥å£çš„ loadUserByUsername(String username) æ–¹æ³•ã€‚\n3) ä½œä¸ºå®æ–½çš„ä¸€éƒ¨åˆ†ï¼Œ\n(A) å€ŸåŠ© UserRepository ä¸­çš„ç”¨æˆ·å/ç”µå­é‚®ä»¶è·å–æ‚¨çš„ç”¨æˆ·å¯¹è±¡ã€‚ (B) å°†ä½ çš„ User å¯¹è±¡ç›¸åº”åœ°è½¬æ¢ä¸º Spring é¢„å®šä¹‰çš„ User å¯¹è±¡(org.springframework.security.core.userdetails.User)ã€‚ (C) è¿”å› Spring å®šä¹‰çš„ User å¯¹è±¡ï¼Œå®ƒæ˜¯ UserDetailsï¼ˆæ–¹æ³•çš„è¿”å›ç±»å‹ï¼‰çš„å®ç°ã€‚\nä¸‹é¢çš„ä»£ç ä»£è¡¨äº† UserDetailsSâ€‹â€‹ervice çš„å®ç°ã€‚ä½†æ˜¯ï¼Œæ‚¨å°†åœ¨ä¸‹é¢çš„éƒ¨åˆ†ä¸­çœ‹åˆ°å®Œæ•´çš„ä»£ç ã€‚\nUserServiceImpl.java\nimport java.util.Optional; import java.util.stream.Collectors; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.security.core.authority.SimpleGrantedAuthority; import org.springframework.security.core.userdetails.UserDetails; import org.springframework.security.core.userdetails.UserDetailsService; import org.springframework.security.core.userdetails.UsernameNotFoundException; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; import org.springframework.stereotype.Service; import com.dev.springboot.security.UserDetailsService.model.User; import com.dev.springboot.security.UserDetailsService.repo.UserRepository; import com.dev.springboot.security.UserDetailsService.service.IUserService; @Service public class UserServiceImpl implements IUserService, UserDetailsService{ @Autowired private UserRepository userRepo; @Autowired private BCryptPasswordEncoder passwordEncoder; @Override public Integer saveUser(User user) { String passwd= user.getPassword(); String encodedPasswod = passwordEncoder.encode(passwd); user.setPassword(encodedPasswod); user = userRepo.save(user); return user.getId(); } @Override public UserDetails loadUserByUsername(String email) throws UsernameNotFoundException { Optional\u0026lt;User\u0026gt; opt = userRepo.findUserByEmail(email); if(opt.isEmpty()) throw new UsernameNotFoundException(\u0026#34;User with email: \u0026#34; +email +\u0026#34; not found !\u0026#34;); else { User user = opt.get(); return new org.springframework.security.core.userdetails.User( user.getEmail(), user.getPassword(), user.getRoles() .stream() .map(role-\u0026gt; new SimpleGrantedAuthority(role)) .collect(Collectors.toSet()) ); } } //Other Approach: Without Using Lambda \u0026amp; Stream API Of Java 8 /** @Override public UserDetails loadUserByUsername(String email) throws UsernameNotFoundException { Optional\u0026lt;User\u0026gt; opt = userRepo.findUserByEmail(email); org.springframework.security.core.userdetails.User springUser=null; if(opt.isEmpty()) { throw new UsernameNotFoundException(\u0026#34;User with email: \u0026#34; +email +\u0026#34; not found\u0026#34;); } User user =opt.get(); List\u0026lt;String\u0026gt; roles = user.getRoles(); Set\u0026lt;GrantedAuthority\u0026gt; ga = new HashSet\u0026lt;\u0026gt;(); for(String role:roles) { ga.add(new SimpleGrantedAuthority(role)); } springUser = new org.springframework.security.core.userdetails.User( email, user.getPassword(), ga ); return springUser; } */ } æˆ‘ä»¬å¦‚ä½•åœ¨åŸºäº Spring çš„åº”ç”¨ç¨‹åºä¸­å®ç°åŸºäºè§’è‰²çš„å®‰å…¨æ€§ï¼Ÿ é€šå¸¸ï¼Œåœ¨åŸºäº Spring çš„åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬é€šè¿‡åˆ›å»ºä¸€ä¸ª java ç±»å¹¶åœ¨å…¶ä¸Šåº”ç”¨ @EnableWebSecurity å’Œ @Configuration æ¥å®ç°åŸºäºè§’è‰²çš„è®¿é—®ã€‚ @EnableWebSecurity åœ¨åº”ç”¨ç¨‹åºä¸­å¯ç”¨ Spring Security åŠŸèƒ½ï¼Œè€Œ @Configuration è¡¨ç¤ºè¯¥ç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†åŸºäºè§’è‰²çš„å®‰å…¨æ€§çš„å®ç°ã€‚\nSecurityConfig.java\npackage com.dev.springboot.security.UserDetailsService.config; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.authentication.AuthenticationProvider; import org.springframework.security.authentication.dao.DaoAuthenticationProvider; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity; import org.springframework.security.core.userdetails.UserDetailsService; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; import org.springframework.security.web.SecurityFilterChain; import org.springframework.security.web.util.matcher.AntPathRequestMatcher; @EnableWebSecurity @Configuration public class SecurityConfig { @Autowired private UserDetailsService uds; @Autowired private BCryptPasswordEncoder encoder; @Bean public SecurityFilterChain filterChain(HttpSecurity http) throws Exception { http.authorizeRequests() .antMatchers(\u0026#34;/home\u0026#34;,\u0026#34;/register\u0026#34;,\u0026#34;/saveUser\u0026#34;).permitAll() .antMatchers(\u0026#34;/welcome\u0026#34;).authenticated() .antMatchers(\u0026#34;/admin\u0026#34;).hasAuthority(\u0026#34;Admin\u0026#34;) .antMatchers(\u0026#34;/mgr\u0026#34;).hasAuthority(\u0026#34;Manager\u0026#34;) .antMatchers(\u0026#34;/emp\u0026#34;).hasAuthority(\u0026#34;Employee\u0026#34;) .antMatchers(\u0026#34;/hr\u0026#34;).hasAuthority(\u0026#34;HR\u0026#34;) .antMatchers(\u0026#34;/common\u0026#34;).hasAnyAuthority(\u0026#34;Employeee,Manager,Admin\u0026#34;) .anyRequest().authenticated() .and() .formLogin() .defaultSuccessUrl(\u0026#34;/welcome\u0026#34;,true) .and() .logout() .logoutRequestMatcher(new AntPathRequestMatcher(\u0026#34;/logout\u0026#34;)) .and() .exceptionHandling() .accessDeniedPage(\u0026#34;/accessDenied\u0026#34;) .and() .authenticationProvider(authenticationProvider()); return http.build(); } @Bean public AuthenticationProvider authenticationProvider() { DaoAuthenticationProvider authenticationProvider = new DaoAuthenticationProvider(); authenticationProvider.setUserDetailsService(uds); authenticationProvider.setPasswordEncoder(encoder); return authenticationProvider; } } ä½¿ç”¨ Spring Boot 3 çš„ Spring Security UserDetailsService ç¤ºä¾‹ ä¸ºäº†ç®€åŒ–ä½¿ç”¨ Spring Boot 3 çš„ Spring Security UserDetailsSâ€‹â€‹ervice çš„å®ç°ï¼Œè®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªç”¨ä¾‹ã€‚\nUse case Details ç”¨ä¾‹è¯¦ç»†ä¿¡æ¯ è®©æˆ‘ä»¬å‡è®¾ä¸€ä¸ªå°å‹ç»„ç»‡çš„å†…éƒ¨é—¨æˆ·ã€‚åœ¨ç»„ç»‡ä¸­ï¼Œæˆ‘ä»¬çš„å‘˜å·¥æ‰®æ¼”ç€å„ç§è§’è‰²ï¼Œä¾‹å¦‚ç®¡ç†å‘˜ã€äººåŠ›èµ„æºã€ç»ç†ï¼Œå½“ç„¶è¿˜æœ‰å‘˜å·¥ã€‚æ­¤å¤–ï¼Œé—¨æˆ·è¿˜å…·æœ‰åŸºäºè§’è‰²çš„é¡µé¢è®¿é—®æƒé™ã€‚æ­¤å¤–ï¼ŒæŸäº›é¡µé¢åº”è¯¥å¯ä¾›æ‰€æœ‰è§’è‰²è®¿é—®ï¼Œä¾‹å¦‚æ³¨å†Œå’Œå…¬å…±ä¿¡æ¯é¡µé¢ï¼Œè€Œå…¶ä»–é¡µé¢åˆ™åº”ä»…é™äºå„è‡ªçš„è§’è‰²ã€‚\nä¸ç”¨è¯´ï¼Œè¯¥ç»„ç»‡å°†æœ‰ä¸€ä¸ªç”¨æˆ·æ³¨å†Œé¡µé¢ï¼Œå³ä½¿æ²¡æœ‰ç™»å½•ï¼Œæ‰€æœ‰ç”¨æˆ·ä¹Ÿå¿…é¡»å¯ä»¥è®¿é—®è¯¥é¡µé¢ã€‚ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ ‡å‡†ç”¨æˆ·æ³¨å†Œæµç¨‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚\næ­¥éª¤#1ï¼šåœ¨ STS(Spring Tool Suite)ä¸­åˆ›å»ºä¸€ä¸ª Spring Boot Starter é¡¹ç›® åˆ›å»ºå…¥é—¨é¡¹ç›®æ—¶ï¼Œé€‰æ‹©â€œSpring Securityâ€ã€â€œThymeleafâ€ã€â€œSpring Webâ€ã€â€œSpring Data JPAâ€ã€â€œMySQL Driverâ€ã€â€œLombokâ€å’Œâ€œSpring Boot DevToolsâ€ä½œä¸ºå…¥é—¨é¡¹ç›®ä¾èµ–é¡¹ã€‚å³ä½¿æ‚¨ä¸çŸ¥é“å¦‚ä½•åˆ›å»º Spring Boot å…¥é—¨é¡¹ç›®ï¼Œä¹Ÿè¯·è®¿é—®â€œå¦‚ä½•åœ¨ Spring boot ä¸­åˆ›å»ºå…¥é—¨é¡¹ç›®ï¼Ÿâ€çš„å†…éƒ¨é“¾æ¥ã€‚å¦å¤–ï¼Œå¦‚æœæ‚¨æƒ³äº†è§£æœ‰å…³ Lombok çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—® Lombok ä¸Šçš„å†…éƒ¨é“¾æ¥ã€‚\næ­¥éª¤#2ï¼šæ›´æ–° application.properties æ–‡ä»¶ä¸­çš„æ•°æ®åº“å±æ€§ æ›´æ–° application.properties ä»¥è¿æ¥åˆ° MySQL æ•°æ®åº“ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çœç•¥ driver-class-nameï¼Œå› ä¸º Spring Boot ä¼šè‡ªåŠ¨ä»æ•°æ®åº“ URL ä¸­æ‰¾åˆ°å®ƒï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ä¸è¿‡ï¼Œå»ºè®®ä¿ç•™ã€‚\n#application.properties #-------------------- server properties --------------- server.port=8080 #--------------------- DB Connection ------------------ #AutoLoading of driver class since JDBC 4 #spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver spring.datasource.url=jdbc:mysql://localhost:3306/testBootSecurity spring.datasource.username=root spring.datasource.password=devs #--------------------JPA-ORM Properties----------------- spring.jpa.show-sql=true spring.jpa.hibernate.ddl-auto=update #spring.jpa.database-platform=org.hibernet.dialect.MySQL8Dialect æ­¥éª¤#3ï¼šåˆ›å»ºç”¨æˆ·å®ä½“å’Œå­˜å‚¨åº“ç±» ç°åœ¨åˆ›å»º User.java å’Œ UserRepositoty.java å¦‚ä¸‹ã€‚è¯·æ³¨æ„ï¼Œä» Spring Boot 3.0.0 å’Œ Spring Security 6.0 å¼€å§‹ï¼Œæ‰€æœ‰ä»¥â€œjavaxâ€å¼€å¤´çš„å¯¼å…¥è¯­å¥éƒ½å°†æ›¿æ¢ä¸ºâ€œjakartaâ€ï¼Œå¦‚ä¸‹é¢çš„ä»£ç æ‰€ç¤ºã€‚ä¾‹å¦‚ï¼šâ€œjavax.persistence.Entity;â€åº”æ›¿æ¢ä¸ºâ€œjakarta.persistence.Entity;â€ã€‚\nåŒæ ·é‡è¦çš„æ˜¯ï¼ŒUser.java æœ‰ä¸€ä¸ª List ç±»å‹çš„å˜é‡â€œrolesâ€ã€‚å®ƒå°†åœ¨æ•°æ®åº“ä¸­åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„è¡¨ï¼Œå…¶ä¸­åŒ…å«ä¸¤åˆ— user_id å’Œ user_roleã€‚æ­¤å¤–ï¼Œ@ElementCollection(fetch= FetchType.EAGER)è¡¨ç¤ºåœ¨è·å– User å¯¹è±¡çš„åŒæ—¶ï¼Œä¹ŸåŒæ—¶è·å–è§’è‰²ã€‚å¦ä¸€æ–¹é¢ï¼ŒUserRepository æ‰©å±•äº†â€œJpaRepositoryâ€ä»¥åˆ©ç”¨å†…ç½®æ•°æ®åº“æ“ä½œã€‚\nUser.java\npackage com.dev.springboot.security.UserDetailsService.model; import java.util.List; import jakarta.persistence.CollectionTable; import jakarta.persistence.Column; import jakarta.persistence.ElementCollection; import jakarta.persistence.Entity; import jakarta.persistence.FetchType; import jakarta.persistence.GeneratedValue; import jakarta.persistence.Id; import jakarta.persistence.JoinColumn; import jakarta.persistence.Table; import lombok.Data; @Data @Entity @Table(name=\u0026#34;users\u0026#34;) public class User { @Id @GeneratedValue @Column(name=\u0026#34;user_id\u0026#34;) private Integer id; @Column(name=\u0026#34;user_name\u0026#34;) private String name; @Column(name=\u0026#34;user_passwd\u0026#34;) private String password; @Column(name=\u0026#34;user_email\u0026#34;) private String email; @ElementCollection(fetch= FetchType.EAGER) @CollectionTable( name=\u0026#34;roles\u0026#34;, joinColumns = @JoinColumn(name=\u0026#34;user_id\u0026#34;) ) @Column(name=\u0026#34;user_role\u0026#34;) private List\u0026lt;String\u0026gt; roles; } UserRepository.java\npackage com.dev.springboot.security.UserDetailsService.repo; import java.util.Optional; import org.springframework.data.jpa.repository.JpaRepository; import com.dev.springboot.security.UserDetailsService.model.User; public interface UserRepository extends JpaRepository\u0026lt;User, Integer\u0026gt; { Optional\u0026lt;User\u0026gt; findUserByEmail(String email); } æ­¥éª¤#4ï¼šåˆ›å»º AppConfig ç±»æ¥å®ä¾‹åŒ– BCryptPasswordEncoder ç”±äº BCryptPasswordEncoder æ˜¯ä¸€ä¸ªé¢„å®šä¹‰çš„ç±»ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨ AppConfig.java ä¸­æä¾›å®ƒçš„å®ä¾‹åŒ–ä»£ç ä½œä¸ºé…ç½®ç±»ã€‚æ­¤å¤–ï¼Œéœ€è¦ BCryptPasswordEncoder åœ¨å…¶ä»–ç±»ä¸­å¯¹æˆ‘ä»¬çš„å¯†ç å€¼è¿›è¡Œç¼–ç ã€‚\nAppConfig.java\npackage com.dev.springboot.security.UserDetailsService.config; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; @Configuration public class AppConfig { @Bean public BCryptPasswordEncoder passwordEncoder() { return new BCryptPasswordEncoder(); } } æ­¥éª¤#5ï¼šåˆ›å»ºæœåŠ¡æ¥å£å’ŒæœåŠ¡å®ç°ç±» ç›¸åº”åœ°åˆ›å»ºæœåŠ¡æ¥å£å’ŒæœåŠ¡ Impl ç±»ä½œä¸º IUserService.java å’Œ UserServiceImpl.javaï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚äº‹å®ä¸Šï¼ŒUserServiceImpl.java ä¸­ loadUserByUsername(String email) æ–¹æ³•çš„å®ç°æ˜¯æ•´ä¸ª UserDetailsSâ€‹â€‹ervice ä¸­æœ€é‡è¦çš„éƒ¨åˆ†ã€‚\nIUserService.java\npackage com.dev.springboot.security.UserDetailsService.service; import com.dev.springboot.security.UserDetailsService.model.User; public interface IUserService { public Integer saveUser(User user); } UserServiceImpl.java\npackage com.dev.springboot.security.UserDetailsService.service.impl; import java.util.Optional; import java.util.stream.Collectors; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.security.core.authority.SimpleGrantedAuthority; import org.springframework.security.core.userdetails.UserDetails; import org.springframework.security.core.userdetails.UserDetailsService; import org.springframework.security.core.userdetails.UsernameNotFoundException; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; import org.springframework.stereotype.Service; import com.dev.springboot.security.UserDetailsService.model.User; import com.dev.springboot.security.UserDetailsService.repo.UserRepository; import com.dev.springboot.security.UserDetailsService.service.IUserService; @Service public class UserServiceImpl implements IUserService, UserDetailsService{ @Autowired private UserRepository userRepo; @Autowired private BCryptPasswordEncoder passwordEncoder; @Override public Integer saveUser(User user) { String passwd= user.getPassword(); String encodedPasswod = passwordEncoder.encode(passwd); user.setPassword(encodedPasswod); user = userRepo.save(user); return user.getId(); } @Override public UserDetails loadUserByUsername(String email) throws UsernameNotFoundException { Optional\u0026lt;User\u0026gt; opt = userRepo.findUserByEmail(email); if(opt.isEmpty()) throw new UsernameNotFoundException(\u0026#34;User with email: \u0026#34; +email +\u0026#34; not found !\u0026#34;); else { User user = opt.get(); return new org.springframework.security.core.userdetails.User( user.getEmail(), user.getPassword(), user.getRoles() .stream() .map(role-\u0026gt; new SimpleGrantedAuthority(role)) .collect(Collectors.toSet()) ); } } //Other Approach: Without Using Lambda \u0026amp; Stream API Of Java 8 /** @Override public UserDetails loadUserByUsername(String email) throws UsernameNotFoundException { Optional\u0026lt;User\u0026gt; opt = userRepo.findUserByEmail(email); org.springframework.security.core.userdetails.User springUser=null; if(opt.isEmpty()) { throw new UsernameNotFoundException(\u0026#34;User with email: \u0026#34; +email +\u0026#34; not found\u0026#34;); } User user =opt.get(); List\u0026lt;String\u0026gt; roles = user.getRoles(); Set\u0026lt;GrantedAuthority\u0026gt; ga = new HashSet\u0026lt;\u0026gt;(); for(String role:roles) { ga.add(new SimpleGrantedAuthority(role)); } springUser = new org.springframework.security.core.userdetails.User( email, user.getPassword(), ga ); return springUser; } */ } æ­¥éª¤#6ï¼šåˆ›å»ºä¸€ä¸ª UserController ç±» éšåï¼Œä¸ºç”¨æˆ·ç¼–å†™ä¸€ä¸ªæ§åˆ¶å™¨ç±»â€œUserController.javaâ€ï¼Œå®ƒå°†æ§åˆ¶ç”¨æˆ·æ³¨å†Œé¡µé¢ã€‚\nUserController.java\npackage com.dev.springboot.security.UserDetailsService.controller; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.stereotype.Controller; import org.springframework.ui.Model; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.ModelAttribute; import org.springframework.web.bind.annotation.PostMapping; import com.dev.springboot.security.UserDetailsService.model.User; import com.dev.springboot.security.UserDetailsService.service.IUserService; @Controller public class UserController { @Autowired private IUserService userService; // Go to Registration Page @GetMapping(\u0026#34;/register\u0026#34;) public String register() { return \u0026#34;registerUser\u0026#34;; } // Read Form data to save into DB @PostMapping(\u0026#34;/saveUser\u0026#34;) public String saveUser( @ModelAttribute User user, Model model ) { Integer id = userService.saveUser(user); String message = \u0026#34;User \u0026#39;\u0026#34;+id+\u0026#34;\u0026#39; saved successfully !\u0026#34;; model.addAttribute(\u0026#34;msg\u0026#34;, message); return \u0026#34;registerUser\u0026#34;; } } æ­¥éª¤#7ï¼šç¼–å†™ä¸€ä¸ªæ§åˆ¶å™¨ç±»æ¥æµè§ˆé¡µé¢ é™¤äº† UserControllerï¼Œå†ç¼–å†™ä¸€ä¸ªæ§åˆ¶å™¨ç±»å¹¶å°†å…¶å‘½åä¸ºâ€œHomeController.javaâ€ã€‚è¯¥ç±»å°†è´Ÿè´£æµè§ˆä¸åŒçš„é¡µé¢ã€‚\nHomeController.java\npackage com.dev.springboot.security.UserDetailsService.controller; import org.springframework.stereotype.Controller; import org.springframework.web.bind.annotation.GetMapping; @Controller public class HomeController { @GetMapping(\u0026#34;/home\u0026#34;) public String getHomePage() { return \u0026#34;homePage\u0026#34;; } @GetMapping(\u0026#34;/welcome\u0026#34;) public String getWelcomePage() { return \u0026#34;welcomePage\u0026#34;; } @GetMapping(\u0026#34;/admin\u0026#34;) public String getAdminPage() { return \u0026#34;adminPage\u0026#34;; } @GetMapping(\u0026#34;/emp\u0026#34;) public String getEmployeePage() { return \u0026#34;empPage\u0026#34;; } @GetMapping(\u0026#34;/mgr\u0026#34;) public String getManagerPage() { return \u0026#34;mgrPage\u0026#34;; } @GetMapping(\u0026#34;/hr\u0026#34;) public String getHrPage() { return \u0026#34;hrPage\u0026#34;; } @GetMapping(\u0026#34;/common\u0026#34;) public String getCommonPage() { return \u0026#34;commonPage\u0026#34;; } @GetMapping(\u0026#34;/accessDenied\u0026#34;) public String getAccessDeniedPage() { return \u0026#34;accessDeniedPage\u0026#34;; } } æ­¥éª¤#8ï¼šç¼–å†™ UI é¡µé¢(Thymeleaf) ä»¥ä¸‹æ˜¯ UI é¡µé¢çš„ .html æ–‡ä»¶ã€‚å°†è¿™äº›é¡µé¢ç›¸åº”åœ°æ”¾å…¥â€œsrc/main/resources/templatesâ€æ–‡ä»¶å¤¹ä¸­ã€‚\nregisterUser.html\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html xmlns:th=\u0026#34;http://www.thymeleaf.org\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;ISO-8859-1\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;User Registration\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h3\u0026gt;User Registration\u0026lt;/h3\u0026gt; \u0026lt;form action=\u0026#34;saveUser\u0026#34; method=\u0026#34;post\u0026#34;\u0026gt; \u0026lt;pre\u0026gt; Name : \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;name\u0026#34;/\u0026gt; Email: \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;email\u0026#34;/\u0026gt; Password: \u0026lt;input type=\u0026#34;password\u0026#34; name=\u0026#34;password\u0026#34;/\u0026gt; Role(s): \u0026lt;input type=\u0026#34;checkbox\u0026#34; name=\u0026#34;roles\u0026#34; value=\u0026#34;Admin\u0026#34;/\u0026gt;Admin \u0026lt;input type=\u0026#34;checkbox\u0026#34; name=\u0026#34;roles\u0026#34; value=\u0026#34;Manager\u0026#34;/\u0026gt;Manager \u0026lt;input type=\u0026#34;checkbox\u0026#34; name=\u0026#34;roles\u0026#34; value=\u0026#34;HR\u0026#34;/\u0026gt;HR \u0026lt;input type=\u0026#34;checkbox\u0026#34; name=\u0026#34;roles\u0026#34; value=\u0026#34;Employee\u0026#34;/\u0026gt;Employee \u0026lt;input type=\u0026#34;hidden\u0026#34; th:name=\u0026#34;${_csrf.parameterName}\u0026#34; th:value=\u0026#34;${_csrf.token}\u0026#34;/\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;Register\u0026#34;/\u0026gt; \u0026lt;/pre\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;div th:text=\u0026#34;${msg}\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; homePage.html\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html xmlns:th=\u0026#34;http://www.thymeleaf.org\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;ISO-8859-1\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Insert title here\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h3\u0026gt;welcome to the Home Page\u0026lt;/h3\u0026gt; This page is accessible to ALL. \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; welcomePage.html\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html xmlns:th=\u0026#34;http://www.thymeleaf.org\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;ISO-8859-1\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Insert title here\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h3\u0026gt;Welcome Page after successful Login\u0026lt;/h3\u0026gt; \u0026lt;a th:href=\u0026#34;@{/logout}\u0026#34;\u0026gt;LOGOUT\u0026lt;/a\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; adminPage.html\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html xmlns:th=\u0026#34;http://www.thymeleaf.org\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;ISO-8859-1\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Insert title here\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h3\u0026gt;Admin Page\u0026lt;/h3\u0026gt; Welcome to Admin page.!!! \u0026lt;a th:href=\u0026#34;@{/logout}\u0026#34;\u0026gt;LOGOUT\u0026lt;/a\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; empPage.html\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html xmlns:th=\u0026#34;http://www.thymeleaf.org\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;ISO-8859-1\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Insert title here\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h3\u0026gt;Employee Page\u0026lt;/h3\u0026gt; \u0026lt;a th:href=\u0026#34;@{/logout}\u0026#34;\u0026gt;LOGOUT\u0026lt;/a\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; mgrPage.html\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html xmlns:th=\u0026#34;http://www.thymeleaf.org\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;ISO-8859-1\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Insert title here\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h3\u0026gt;Manager Page\u0026lt;/h3\u0026gt; \u0026lt;a th:href=\u0026#34;@{/logout}\u0026#34;\u0026gt;LOGOUT\u0026lt;/a\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; hrPage.html\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html xmlns:th=\u0026#34;http://www.thymeleaf.org\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;ISO-8859-1\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Insert title here\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h3\u0026gt;HR Page\u0026lt;/h3\u0026gt; \u0026lt;a th:href=\u0026#34;@{/logout}\u0026#34;\u0026gt;LOGOUT\u0026lt;/a\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; commonPage.html\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html xmlns:th=\u0026#34;http://www.thymeleaf.org\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;ISO-8859-1\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Insert title here\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h3\u0026gt;You are not allowed to access this page. Please go to Welcome Page\u0026lt;/h3\u0026gt; \u0026lt;a th:href=\u0026#34;@{/welcome}\u0026#34;\u0026gt;Welcome\u0026lt;/a\u0026gt; \u0026lt;a th:href=\u0026#34;@{/logout}\u0026#34;\u0026gt;LOGOUT\u0026lt;/a\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; accessDeniedPage.html\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html xmlns:th=\u0026#34;http://www.thymeleaf.org\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;ISO-8859-1\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Insert title here\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h3\u0026gt;You are not allowed to access this page. Please go to Welcome Page\u0026lt;/h3\u0026gt; \u0026lt;a th:href=\u0026#34;@{/welcome}\u0026#34;\u0026gt;Welcome\u0026lt;/a\u0026gt; \u0026lt;a th:href=\u0026#34;@{/logout}\u0026#34;\u0026gt;LOGOUT\u0026lt;/a\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; æ­¥éª¤ï¼ƒ9ï¼šç¼–å†™ SecurityConfig ç±»è€Œä¸ä½¿ç”¨ WebSecurityConfigurerAdapter æœ€åï¼Œç¼–å†™å¦ä¸€ä¸ªé‡è¦çš„ç±» SecurityConfig.javaã€‚åœ¨ Spring Security 5.7.0-M2 ä¹‹å‰ï¼Œæ­¤ç±»åº”è¯¥æ‰©å±•é¢„å®šä¹‰çš„ç±» WebSecurityConfigurerAdapter.java å¹¶ç›¸åº”åœ°å®ç°ä¸¤ä¸ª configure() æ–¹æ³•ã€‚ä½†ä» Spring Security 5.7.0-M2 å¼€å§‹ï¼ŒWebSecurityConfigurerAdapter å·²è¢«å¼ƒç”¨ã€‚æ­¤å¤–ï¼Œä» Spring Boot 3.0.0 å’Œ Spring Security 6.0 å¼€å§‹ï¼ŒWebSecurityConfigurerAdapter å·²ä» Spring Security API ä¸­å®Œå…¨åˆ é™¤ã€‚\nå› æ­¤ï¼Œæ‰€éœ€çš„å®ç°è‡ª Spring 3.0.0 èµ·å°±é€‚ç”¨ï¼Œå¦‚ä¸‹é¢çš„ä»£ç ç‰‡æ®µæ‰€ç¤ºã€‚\nSecurityConfig.java\npackage com.dev.springboot.security.UserDetailsService.config; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.authentication.AuthenticationProvider; import org.springframework.security.authentication.dao.DaoAuthenticationProvider; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity; import org.springframework.security.core.userdetails.UserDetailsService; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; import org.springframework.security.web.SecurityFilterChain; import org.springframework.security.web.util.matcher.AntPathRequestMatcher; @EnableWebSecurity @Configuration public class SecurityConfig { @Autowired private UserDetailsService uds; @Autowired private BCryptPasswordEncoder encoder; @Bean public SecurityFilterChain filterChain(HttpSecurity http) throws Exception { http.authorizeHttpRequests() .requestMatchers(\u0026#34;/home\u0026#34;,\u0026#34;/register\u0026#34;,\u0026#34;/saveUser\u0026#34;).permitAll() .requestMatchers(\u0026#34;/welcome\u0026#34;).authenticated() .requestMatchers(\u0026#34;/admin\u0026#34;).hasAuthority(\u0026#34;Admin\u0026#34;) .requestMatchers(\u0026#34;/mgr\u0026#34;).hasAuthority(\u0026#34;Manager\u0026#34;) .requestMatchers(\u0026#34;/emp\u0026#34;).hasAuthority(\u0026#34;Employee\u0026#34;) .requestMatchers(\u0026#34;/hr\u0026#34;).hasAuthority(\u0026#34;HR\u0026#34;) .requestMatchers(\u0026#34;/common\u0026#34;).hasAnyAuthority(\u0026#34;Employeee\u0026#34;, \u0026#34;Manager\u0026#34;, \u0026#34;Admin\u0026#34;) .anyRequest().authenticated() .and() .formLogin() .defaultSuccessUrl(\u0026#34;/welcome\u0026#34;,true) .and() .logout() .logoutRequestMatcher(new AntPathRequestMatcher(\u0026#34;/logout\u0026#34;)) .and() .exceptionHandling() .accessDeniedPage(\u0026#34;/accessDenied\u0026#34;) .and() .authenticationProvider(authenticationProvider()); return http.build(); } @Bean public AuthenticationProvider authenticationProvider() { DaoAuthenticationProvider authenticationProvider = new DaoAuthenticationProvider(); authenticationProvider.setUserDetailsService(uds); authenticationProvider.setPasswordEncoder(encoder); return authenticationProvider; } } ä»ä¸Šé¢çš„ SecurityConfig å®ç°ä¸­å¯ä»¥æ˜æ˜¾çœ‹å‡ºï¼Œæ—§ç‰ˆæœ¬ä¸­çš„ä¸€äº›æ–¹æ³•ä¹Ÿè¢«åˆ é™¤äº†ã€‚ä¾‹å¦‚ï¼š\nauthorizeRequests() -\u0026gt; authorizeHttpRequests()\nantMatchers() -\u0026gt; requestMatchers()\nregexMatchers() -\u0026gt; RegexRequestMatchers()\næœ€åï¼Œæˆ‘ä»¬å®Œæˆäº†ç¼–ç éƒ¨åˆ†ã€‚\nå¦‚ä½•æµ‹è¯•å¯ç”¨å®‰å…¨æ€§çš„åº”ç”¨ç¨‹åºï¼Ÿ è™½ç„¶â€œæµ‹è¯•â€è¿™ä¸ªè¯å¯¹äºå¼€å‘äººå‘˜æ¥è¯´çœ‹èµ·æ¥å¾ˆå®¹æ˜“ï¼Œä½†å®ƒåŒæ ·é‡è¦ï¼Œå› ä¸ºå®ƒæä¾›äº†æˆ‘ä»¬æ•´ä½“å®ç°çš„ç»“æœã€‚åœ¨æµ‹è¯•åº”ç”¨ç¨‹åºæ—¶ï¼Œæ‚¨åº”è¯¥å°† SecurityConfig ç±»çš„ configure(HttpSecurity http) æ–¹æ³•ä¿ç•™åœ¨æ‚¨é¢å‰ï¼Œç„¶åæŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š\nå¯åŠ¨åº”ç”¨ç¨‹åºï¼šå³é”®å•å‡»é¡¹ç›®ï¼Œç„¶åé€‰æ‹©â€œRun Asâ€\u0026raquo;â€œSpring Boot Appâ€ã€‚\nè¾“å…¥æ³¨å†Œé¡µé¢ URL http://localhost:8080/registerï¼Œç„¶åæ£€æŸ¥æ˜¯å¦æ¯ä¸ªäººéƒ½å¯ä»¥è®¿é—®ï¼Œç”šè‡³ä¸éœ€è¦ç™»å½•åº”ç”¨ç¨‹åºã€‚\nè¾“å…¥å¿…å¡«å­—æ®µå€¼å¹¶ç›¸åº”åœ°å•å‡»â€œæ³¨å†Œâ€æŒ‰é’®å®Œæˆæ³¨å†Œè¿‡ç¨‹ã€‚\nç°åœ¨è¾“å…¥æ‚¨åœ¨æ³¨å†Œæ—¶é€‰æ‹©çš„è§’è‰²ç‰¹å®šçš„ä»»ä½• URLã€‚å‡è®¾æ‚¨è¾“å…¥ URL http://localhost:8080/adminï¼Œé‚£ä¹ˆå®ƒåº”è¯¥å°†æ‚¨é‡å®šå‘åˆ°å†…ç½®çš„ç™»å½•é¡µé¢ã€‚\nè¾“å…¥å‡­æ®å¹¶ç™»å½•åˆ°åº”ç”¨ç¨‹åºã€‚å®ƒä¼šå°†æ‚¨é‡å®šå‘åˆ°é»˜è®¤çš„æˆåŠŸ URLï¼Œå³æ¬¢è¿é¡µé¢ã€‚\nç°åœ¨å†æ¬¡è¾“å…¥ URL http://localhost:8080/adminï¼Œè¿™æ¬¡æ‚¨å°†èƒ½å¤Ÿè®¿é—®ç®¡ç†é¡µé¢ã€‚\nå¯¹å…¶ä»–è§’è‰²ä¹Ÿé‡å¤ä¸Šè¿°æ­¥éª¤ã€‚\næ­¤å¤–ï¼Œå¦‚ä¸Šæ‰€è¿°ï¼Œå°† SecurityConfig.java ä»£ç ä¿ç•™åœ¨æ‚¨é¢å‰ï¼Œå¹¶éšåæµ‹è¯•æ¯ä¸ªåœºæ™¯ã€‚\nå¦‚ä½•ä½¿ç”¨ Spring Boot 3 å°†ä»¥å‰çš„å®ç°è¿ç§»åˆ° Spring Security UserDetailsServiceï¼Ÿ ä»¥ä¸‹æ˜¯ä¸€äº›åˆ†æ­¥æŒ‡å—ï¼Œæ‚¨å¯ä»¥æŒ‰ç…§è¿™äº›æŒ‡å—ä»æ—§ç‰ˆæœ¬å®ç°è¿ç§»åˆ°ä½¿ç”¨ Spring Boot 3 çš„ Spring Security UserDetailsSâ€‹â€‹erviceã€‚\næ ¹æ®æ¨è Spring å®˜æ–¹æ–‡æ¡£ï¼Œå¦‚æœä½¿ç”¨è¾ƒä½ç‰ˆæœ¬å®ç°ï¼Œè¯·å…ˆå°†å®ç°å‡çº§åˆ° Spring Boot 2.7.0ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ›´æ–° pom.xml ä¸­çš„ Spring Boot ç‰ˆæœ¬æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ \u0026lt;parent\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-parent\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.7.0\u0026lt;/version\u0026gt; \u0026lt;relativePath/\u0026gt; \u0026lt;!-- lookup parent from repository --\u0026gt; \u0026lt;/parent\u0026gt; æ›´æ–°åï¼Œä¿å­˜ pom.xml å¹¶è®© Maven ä¸‹è½½æ–°çš„ä¾èµ–é¡¹ã€‚\nå¯¹äºæ­¤ç¤ºä¾‹ï¼Œæ‚¨å°†å‘ç° WebSecurityConfigurerAdapter å·²è¢«å¼ƒç”¨ã€‚æä¾›æ–°çš„å®ç°ï¼Œè€Œä¸ä½¿ç”¨ WebSecurityConfigurerAdapterã€‚æ‚¨å¯ä»¥ä½¿ç”¨æœ¬æ–‡ä¸­çš„ SecurityConfig.java å®ç°ã€‚å¦‚æœè¿˜æœ‰å…¶ä»–é”™è¯¯ï¼Œä¹Ÿè¯·ä¿®å¤å®ƒä»¬ã€‚\nä¸‹ä¸€æ­¥ï¼ŒæŒ‰ç…§ Spring Boot å®˜æ–¹æ–‡æ¡£çš„å»ºè®®åœ¨é¡¹ç›®ä¸­é…ç½® JDK 17 ç¯å¢ƒã€‚\nåœ¨ pom.xml ä¸­å°† Spring Boot ç‰ˆæœ¬æ›´æ–°ä¸ºâ€œ3.0.0â€ï¼Œä¿å­˜æ–‡ä»¶å¹¶è®© maven ä¸‹è½½æ–°çš„ä¾èµ–é¡¹ã€‚\nä¿®å¤ç¼–è¯‘é”™è¯¯ï¼Œå¦‚ä¸‹å›¾ï¼š\n(A) I åœ¨ SecurityConfig.java ä¸­ï¼š\nå°† authorizeRequests() æ›¿æ¢ä¸º authorizeHttpRequests()\nå°† antMatchers() æ›¿æ¢ä¸º requestMatchers()\nå°† regexMatchers() æ›¿æ¢ä¸º RegexRequestMatchers()\n(B) åœ¨å®ä½“ç±»ä¸­ï¼š\nå°†æ‰€æœ‰å‡ºç°çš„â€œjavaxâ€æ›¿æ¢ä¸ºâ€œjakartaâ€ã€‚ä¾‹å¦‚ï¼šâ€œjavax.persistence.Entity;â€åº”æ›¿æ¢ä¸ºâ€œjakarta.persistence.Entity;â€ã€‚\næ•…éšœæ’é™¤ å°† Spring Boot ç‰ˆæœ¬å‡çº§åˆ° 3.0.0 æ—¶ï¼Œæ‚¨å¯èƒ½ä¼šé‡åˆ°ä»¥ä¸‹é”™è¯¯ï¼š\n[ERROR] Some problems were encountered while processing the POMs: [ERROR] \u0026#39;dependencies.dependency.version\u0026#39; for org.thymeleaf.extras:thymeleaf-extras-springsecurity5:jar is missing. ä¸ºäº†è§£å†³æ­¤é”™è¯¯ï¼Œè¯·æ›´æ–° Thymeleaf çš„ç‰ˆæœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.thymeleaf.extras\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;thymeleaf-extras-springsecurity5\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.0.4.RELEASE\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; æ›´æ–°å®Œæˆåï¼Œmaven ä¼šè‡ªåŠ¨ä¸‹è½½åˆé€‚çš„ä¾èµ–é¡¹ã€‚\næ¦‚æ‹¬ åœ¨å®Œæˆâ€œä½¿ç”¨ Spring Boot 3 çš„ Spring Security UserDetailsSâ€‹â€‹erviceâ€çš„æ‰€æœ‰ç†è®ºå’Œç¤ºä¾‹éƒ¨åˆ†ä¹‹åï¼Œæœ€åï¼Œæˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿåœ¨ Spring Boot é¡¹ç›®ä¸­å®ç°åŸºäºè§’è‰²çš„ Web å®‰å…¨æ€§ã€‚å½“ç„¶ï¼Œåœ¨æœ¬æ–‡ä¸­æˆ‘ä»¬ä»‹ç»äº†å®ç°å®‰å…¨åŠŸèƒ½çš„ç¬¬ä¸‰ç§æ–¹æ³•ã€‚åŒæ ·ï¼Œæˆ‘ä»¬å°†åœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­è®¨è®ºæ›´å¤šå®‰å…¨æ–¹æ³•ã€‚æœªæ¥è‹¥æœ‰ä»»ä½•å˜åŒ–ï¼Œæˆ‘ä»¬å°†è¿›è¡Œç›¸åº”æ›´æ–°ã€‚\nå¦‚æœæ‚¨æƒ³äº†è§£ Spring Boot 3.0 ä¸­çš„æ–°å¢åŠŸèƒ½ï¼Œè¯·è®¿é—®æˆ‘ä»¬å…³äºâ€œSpring Boot 3 ä¸­çš„æ–°åŠŸèƒ½â€çš„å•ç‹¬æ–‡ç« ã€‚å¦å¤–ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºæå‡ºä½ çš„æ„è§ã€‚\nåŸæ–‡é“¾æ¥ï¼šhttps://javatechonline.com/spring-security-userdetailsservice-using-spring-boot-3/\n","permalink":"https://blog.chensoul.cc/posts/2023/08/18/how-to-implement-security-in-spring-boot3-using-userdetailsservice/","summary":"ä½œä¸ºæœ‰å…³ Spring Security çš„ç³»åˆ—æ–‡ç« çš„ç»§ç»­ï¼Œåœ¨æœ¬æ–‡ä¸­æˆ‘ä»¬å°†å­¦ä¹ â€œå¦‚ä½•åœ¨ Spring Boot 3 ä¸­ä½¿ç”¨ UserDetailsService å®ç° Spring Boot ä¸­çš„å®‰å…¨æ€§ï¼Ÿâ€ã€‚ç»è¿‡å‰é¢çš„æ–‡ç« ï¼Œæˆ‘å¸Œæœ›æˆ‘ä»¬éƒ½éå¸¸ç†Ÿæ‚‰å®‰å…¨æ€§çš„åŸºç¡€çŸ¥è¯†ï¼Œç”šè‡³ Spring Boot åº”ç”¨ç¨‹åºä¸­çš„å®‰å…¨æ€§åŸºç¡€çŸ¥è¯†ã€‚ Spring Boot 3 å‘å¸ƒåï¼Œæˆ‘ä»¬å°†åœ¨è¿™é‡Œå®ç°â€œä½¿ç”¨ Spring Boot 3 çš„ Spring Security UserDetailsServiceâ€ã€‚\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªç”¨æˆ·æ³¨å†Œè¡¨å•å¹¶å°†ç”¨æˆ·åŠå…¶è§’è‰²ä¿å­˜åœ¨æ•°æ®åº“ä¸­ã€‚ç„¶åï¼Œæ ¹æ®ç”¨æˆ·è§’è‰²ï¼Œæˆ‘ä»¬å°†å€ŸåŠ©é¢„å®šä¹‰çš„ UserDetailsSâ€‹â€‹ervice æ£€æŸ¥èº«ä»½éªŒè¯å’ŒæˆæƒåŠŸèƒ½ã€‚\næ‚¨å¯¹æ•´ç¯‡æ–‡ç« æœ‰ä½•æœŸæœ›ï¼Ÿ Spring Security ä¸Šä¸‹æ–‡ä¸­çš„ UserDetailsSâ€‹â€‹ervice æ¦‚å¿µæ˜¯ä»€ä¹ˆï¼Ÿ\nå®æ–½ UserDetailsService æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ\nå¦‚ä½•ä½¿ç”¨ Spring Boot 3 å®ç° Spring Security UserDetailsServiceï¼Ÿ\nå¦‚ä½•åœ¨åŸºäº Spring çš„åº”ç”¨ç¨‹åºä¸­å®ç°åŸºäºè§’è‰²çš„å®‰å…¨æ€§ï¼Ÿ\næ­¤å¤–ï¼Œå¦‚ä½•ä»¥åŠåœ¨å“ªé‡Œä½¿ç”¨æ³¨é‡Šï¼š@EnableWebSecurityï¼Œ@Configurationï¼Œ@Beanï¼Œ@GetMappingï¼Œ@Autowiredï¼Œ@Dataï¼Œ@Entityï¼Œ@Tableï¼Œ@Idï¼Œ@GenerateValueï¼Œ@Columnï¼Œ@ElementCollectionï¼Œ@CollectionTableï¼Œ @JoinColumnï¼Œ@Service\nå¦‚ä½•ä½¿ç”¨ Spring MVC å’Œ Thymeleaf å¼€å‘ç”¨æˆ·æ³¨å†Œåº”ç”¨ç¨‹åºï¼Ÿ\nå¦‚ä½•æµ‹è¯•å¯ç”¨å®‰å…¨çš„åº”ç”¨ç¨‹åºï¼Ÿ\nå¦‚ä½•åœ¨æ²¡æœ‰ WebSecurityConfigurerAdapter çš„æƒ…å†µä¸‹ä½¿ç”¨ UserDetailsService åœ¨ Spring Boot ä¸­å®ç°å®‰å…¨æ€§ï¼Ÿ\nç¤ºä¾‹ä¸­ä½¿ç”¨çš„è½¯ä»¶/æŠ€æœ¯ æœ‰æ—¶æŸäº›ç‰ˆæœ¬ä¸å…¶ä»–ç‰ˆæœ¬å†²çªã€‚å› æ­¤ï¼Œåˆ—å‡ºç»è¿‡æµ‹è¯•å¯ä»¥ç›¸äº’åä½œçš„ç»„åˆã€‚ä¸‹é¢æ˜¯ç»è¿‡æµ‹è¯•çš„è½¯ä»¶ç»„åˆï¼Œç”¨äºä½¿ç”¨ Spring Boot 3 å¼€å‘ Spring Security UserDetailsSâ€‹â€‹erviceã€‚å®ƒä¹Ÿä½¿å®ç°å®Œç¾æ— ç¼ºã€‚\nSpring Boot 3.0.0\nJDK 17 or later\nMaven 3.8.1 3ï¼‰Maven 3.8.1\nIDE â€“ STS 4.7.1. RELEASE\nIDE â€“ STS 4.7.1ã€‚å‘å¸ƒ\nJars Used ä¸‹é¢æ˜¯è¿™äº›ç¤ºä¾‹ä¸­ maven ä½¿ç”¨ pom.","title":"[è¯‘]å¦‚ä½•åœ¨Spring Boot3ä¸­ä½¿ç”¨UserDetailsServiceå®ç°å®‰å…¨æ€§ï¼Ÿ"},{"content":" å¦‚ä»Šï¼Œå‡ ä¹æ¯ä¸ªå®¢æˆ·éƒ½è¦æ±‚åœ¨å®æ—¶åº”ç”¨ç¨‹åºä¸­å®ç°å¼ºå¤§çš„å®‰å…¨åŠŸèƒ½ã€‚å®‰å…¨åŠŸèƒ½å¯¹äºä¿æŒæœºå¯†æ€§ã€å®Œæ•´æ€§å’Œå¯ç”¨æ€§çš„éœ€æ±‚æ˜¯éå¸¸æœ‰æ•ˆçš„ã€‚ç°å®ä¸–ç•Œä¸­æœ‰å¾ˆå¤šç±»å‹çš„å®‰å…¨æ€§ï¼Œä½†æˆ‘ä»¬ä½œä¸ºå¼€å‘äººå‘˜å°†é‡ç‚¹å…³æ³¨åº”ç”¨ç¨‹åº/è½¯ä»¶å®‰å…¨æ€§ã€‚\næ­¤å¤–ï¼Œåœ¨åº”ç”¨ç¨‹åºå®‰å…¨æ–¹é¢ï¼Œæˆ‘ä»¬çš„å·¥ä½œåŸºæœ¬ä¸Šæ˜¯ç¡®ä¿ä¸¤ä»¶äº‹ã€‚é¦–å…ˆï¼Œåªæœ‰æœ‰æ•ˆçš„ç”¨æˆ·æ‰èƒ½è®¿é—®è¯¥åº”ç”¨ç¨‹åºã€‚å…¶æ¬¡ï¼Œå¦‚æœç”¨æˆ·æœ‰æ•ˆï¼Œä»–/å¥¹åªèƒ½è®¿é—®è¯¥åº”ç”¨ç¨‹åºä¸­å…è®¸çš„æ•°æ®/ä¿¡æ¯ã€‚æˆ‘è®¤ä¸ºï¼Œæ²¡æœ‰ä»€ä¹ˆå¯ä»¥è§£é‡Šå®ƒä»¬ï¼Œå› ä¸ºæ‚¨å¿…é¡»å·²ç»äº†è§£è¿™ä¸¤ä¸ªæœ¯è¯­ï¼Œå³èº«ä»½éªŒè¯å’Œæˆæƒã€‚\næ‚¨å¯èƒ½å·²ç»çŒœåˆ°æˆ‘ä»¬å°†åœ¨å½“å‰ä¸»é¢˜â€œå¦‚ä½•åœ¨ Spring Boot é¡¹ç›®ä¸­å®ç°å®‰å…¨æ€§ï¼Ÿâ€ä¸­è®¨è®ºä»€ä¹ˆå†…å®¹ã€‚\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä»åŸºæœ¬åŸç†å¼€å§‹å­¦ä¹ ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†é€æ­¥ç»“æŸå®ƒï¼Œç›´åˆ°æˆ‘ä»¬æœ‰ä¿¡å¿ƒåœ¨ Spring Boot åº”ç”¨ç¨‹åºä¸­å®ç°å®‰å…¨åŠŸèƒ½ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬å¼€å§‹é€æ­¥è®¨è®ºâ€œå¦‚ä½•åœ¨ Spring Boot é¡¹ç›®ä¸­å®ç°å®‰å…¨æ€§ï¼Ÿâ€ã€‚ Spring Boot æ•™ç¨‹é¡µé¢ä¸Šæœ‰ä¸€ç³»åˆ—æœ‰å…³ Spring Boot Security çš„æ•™ç¨‹ã€‚\næˆ‘ä»¬åœ¨æœ¬æ–‡ä¸­ä»‹ç»äº†ä¸¤ä¸ªç‰ˆæœ¬çš„â€œå¦‚ä½•åœ¨ Spring Boot é¡¹ç›®ä¸­å®ç°å®‰å…¨æ€§ï¼Ÿâ€çš„ç¤ºä¾‹ï¼šä½¿ç”¨ WebSecurityConfigurerAdapter å’Œä¸ä½¿ç”¨ WebSecurityConfigurerAdapterã€‚æ­¤å¤–ï¼Œè¿˜æ¶µç›–äº†ä½¿ç”¨ Spring Boot 3.0 åŠæ›´é«˜ç‰ˆæœ¬çš„â€œå¦‚ä½•åœ¨ Spring Boot é¡¹ç›®ä¸­å®ç°å®‰å…¨æ€§ï¼Ÿâ€çš„ç¤ºä¾‹ã€‚\næ‚¨å°†ä»æœ¬æ–‡ä¸­å­¦åˆ°ä»€ä¹ˆï¼Ÿ ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦åœ¨ Spring Boot åº”ç”¨ç¨‹åºä¸­å®ç°å®‰å…¨æ€§ï¼Ÿ\nSecurity åœ¨ Spring Boot åº”ç”¨ç¨‹åºå†…éƒ¨å¦‚ä½•å·¥ä½œï¼Ÿ\njavax.servlet.Filter åœ¨ Spring Boot åº”ç”¨ç¨‹åºä¸­å®ç°å®‰å…¨æ€§æ–¹é¢çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ\nSpring Boot é¡¹ç›®ä¸­ä½¿ç”¨äº†å¤šå°‘ç§æˆæƒç±»å‹ï¼Ÿ\nSpring Boot é¡¹ç›®ä¸­æœ‰å¤šå°‘ç§å®ç°å®‰å…¨æ€§çš„æ–¹æ³•ï¼Ÿ\nåœ¨ Spring Boot é¡¹ç›®ä¸­å®ç° WebSecurity çš„æ­¥éª¤æ˜¯ä»€ä¹ˆï¼Ÿ\nå¦å¤–ï¼Œå¦‚ä½•åœ¨ Spring Boot é¡¹ç›®ä¸­ä½¿ç”¨@EnableWebSecurityã€@Configurationã€@Beanï¼Ÿ\nå¦‚ä½•å®ç°å†…å­˜ä¸­èº«ä»½éªŒè¯å®‰å…¨ç¤ºä¾‹\nå¦‚ä½•å®ç° JDBC è®¤è¯å®‰å…¨ç¤ºä¾‹\nå¦‚ä½•åœ¨ Spring Boot é¡¹ç›®ä¸­ä½¿ç”¨ Thymeleaf ï¼Ÿ\nå¦‚ä½•æµ‹è¯•å¯ç”¨å®‰å…¨çš„åŠŸèƒ½ï¼Ÿ\nç›¸åï¼Œå¦‚ä½•ç¦ç”¨åº”ç”¨ç¨‹åºçš„å®‰å…¨åŠŸèƒ½ï¼Ÿ\næœ€åä½†å¹¶éæœ€ä¸é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œæ‚¨å°†å­¦ä¹ â€œå¦‚ä½•åœ¨ Spring Boot é¡¹ç›®ä¸­å®ç°å®‰å…¨æ€§ï¼Ÿâ€ä½¿ç”¨ WebSecurityConfigurerAdapter å’Œä¸ä½¿ç”¨ WebSecurityConfigurerAdapterã€‚\nä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦åº”ç”¨ç¨‹åºä¸­çš„å®‰å…¨æ€§ï¼Ÿ ç°åœ¨ï¼Œéšç€æ¶æ„æ”»å‡»å°†é‡ç‚¹ä»æ“ä½œç³»ç»Ÿå’Œç½‘ç»œè½¬ç§»åˆ°åº”ç”¨ç¨‹åº/è½¯ä»¶å’Œç§»åŠ¨è®¾å¤‡/è®¾å¤‡ï¼Œä¸€å¤©çš„æ•°æ®é¢ä¸´æœ€å¤§çš„é£é™©ã€‚æ­¤å¤–ï¼Œä»ä¸šåŠ¡/å®¢æˆ·çš„è§’åº¦æ¥çœ‹ï¼Œåº”ç”¨ç¨‹åºå®‰å…¨åœ¨ç»´æŠ¤ä¿¡ä»»ã€å»ºç«‹å“ç‰Œå½¢è±¡å’Œé™ä½é£é™©æ–¹é¢å‘æŒ¥ç€é‡è¦ä½œç”¨ã€‚äº‹å®ä¸Šï¼Œæ²¡æœ‰å…¶ä¸­ä»»ä½•ä¸€é¡¹ï¼Œéƒ½æ— æ³•æƒ³è±¡ä¸€å®¶æˆåŠŸçš„ä¼ä¸šã€‚\næ€»ä¹‹ï¼Œæ— è®ºæ‚¨æ˜¯ä¸ºäº†å†…éƒ¨ä½¿ç”¨ã€é”€å”®ç›®çš„è¿˜æ˜¯è´­ä¹°ç›®çš„è€Œåˆ›å»ºåº”ç”¨ç¨‹åºï¼Œå®‰å…¨æ€§éƒ½æ˜¯æ¯ä¸ªåº”ç”¨ç¨‹åºæœ€é‡è¦çš„åŠŸèƒ½ã€‚\næ ¹æ®æœ€æ–°çš„ 2020 å¹´ Verizon æ•°æ®æ³„éœ²è°ƒæŸ¥æŠ¥å‘Šï¼Œæ‰€æœ‰æ•°æ®æ³„éœ²ä¸­æœ‰ 43% æ˜¯é’ˆå¯¹ Web åº”ç”¨ç¨‹åºçš„æ”»å‡»ã€‚è¿™ä¸€æ•°å­—æ¯” 2019 å¹´å¢åŠ äº†ä¸€å€ã€‚æ­¤å¤–ï¼Œ86% çš„è¿è§„è¡Œä¸ºéƒ½æ˜¯å‡ºäºç»æµåŠ¨æœºã€‚\nSpring Boot åº”ç”¨ç¨‹åºå†…éƒ¨å®‰å…¨æ€§å¦‚ä½•å·¥ä½œï¼Ÿ ä»æ ¹æœ¬ä¸Šæ¥è¯´ï¼ŒSpring Security çš„å·¥ä½œåŸç†æ˜¯ JAASï¼ˆJava èº«ä»½éªŒè¯å’ŒæˆæƒæœåŠ¡ï¼‰ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå®ƒé€‚ç”¨äº Filter (javax.servlet.Filter) æ¦‚å¿µã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åœ¨ servlet è¯·æ±‚ä¹‹å‰åº”ç”¨ä¸€äº›é¢„å¤„ç†é€»è¾‘ï¼Œå¯ä»¥ä½¿ç”¨è¿‡æ»¤å™¨ã€‚åŒæ ·çš„æ¦‚å¿µä¹Ÿè¢«åº”ç”¨äºåœ¨ Spring boot é¡¹ç›®ä¸­å®ç°å®‰å…¨åŠŸèƒ½ã€‚\nDelegatingFilterProxy æ˜¯ Spring Security æ¨¡å—æä¾›çš„ org.springframework.web.filter åŒ…ä¸‹çš„é¢„å®šä¹‰ç±»ï¼Œåœ¨è¿™é‡Œå……å½“è¿‡æ»¤å™¨ã€‚\nå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå½“ç”¨æˆ·å‘åº”ç”¨ç¨‹åºå‘é€è¯·æ±‚æ—¶ï¼Œè¯·æ±‚ä¼šå…ˆç»è¿‡å®‰å…¨è¿‡æ»¤å™¨ï¼Œç„¶åå†å‘é€ç»™ DispatcherServletã€‚å¦‚æœç”¨æˆ·éªŒè¯æ­¤è¿‡æ»¤å™¨çš„å®‰å…¨æ€§ï¼Œåˆ™åªæœ‰è¯·æ±‚æ‰ä¼šå‘é€åˆ° DispatcherServlet æ¥æ»¡è¶³ç”¨æˆ·çš„ç›®çš„ã€‚\nSpring Boot åº”ç”¨ç¨‹åºä½¿ç”¨äº†å¤šå°‘ç§æˆæƒç±»å‹ï¼Ÿ æœ‰å››ç§æœ€å¸¸ç”¨çš„æˆæƒå®ç°ç±»å‹ã€‚ä»–ä»¬æ˜¯ ï¼š\n1) permitAll å…è®¸å…¨éƒ¨ PermitAll è¡¨ç¤ºæ— éœ€ä»»ä½•æˆæƒå³å¯è®¿é—®å½“å‰é¡µé¢ã€‚\nç¤ºä¾‹ URLï¼š/loginã€/homeã€/contactUsã€/aboutUs ..ç­‰ã€‚\n2) authenticated å·²è®¤è¯ å®ƒè¡¨ç¤ºéœ€è¦ç™»å½•ï¼ˆç”¨æˆ·å/å¯†ç ï¼‰å¹¶ä¸”ä¸éœ€è¦æˆæƒï¼ˆåŸºäºè§’è‰²çš„è®¿é—®ï¼‰ã€‚\nç¤ºä¾‹ URLï¼š/updateUserDetailsã€/inboxã€/settings ç­‰ã€‚\n3) hasAuthority hasAuthority è¡¨ç¤ºç”¨æˆ·åº”è¯¥å…·æœ‰èº«ä»½éªŒè¯å’ŒåŸºäºè§’è‰²çš„æˆæƒè®¿é—®æƒé™ã€‚\nç¤ºä¾‹ URL+roleï¼š/approveRequest + MANAGERã€/blockUser + ADMINã€/addUser + ADMIN â€¦ç­‰ã€‚\n4) hasAnyAuthority æœ‰ä»»ä½•æƒé™ å®ƒè¡¨ç¤ºç”¨æˆ·åº”è¯¥å…·æœ‰èº«ä»½éªŒè¯å’ŒåŸºäºå¤šä¸ªè§’è‰²çš„æˆæƒè®¿é—®ã€‚å°±åƒç»ç†å’ŒäººåŠ›èµ„æºè¿™ä¸¤ä¸ªè§’è‰²éƒ½å¯ä»¥è®¿é—®ç‰¹å®šé¡µé¢ã€‚ ç¤ºä¾‹ URLs+role: /approveRequest + (MANAGER \u0026amp; HR)\nåœ¨ Spring Boot Web åº”ç”¨ç¨‹åºä¸­å®ç°å®‰å…¨æ€§æœ‰å“ªäº›ä¸åŒçš„æ–¹æ³•ï¼Ÿ ç®€è€Œè¨€ä¹‹ï¼Œåœ¨ Spring Boot Web åº”ç”¨ç¨‹åºä¸­å®ç°å®‰å…¨æ€§æœ‰ä¸‰ç§æœ€å¸¸è§çš„æ–¹æ³•ã€‚ä»–ä»¬æ˜¯\nIn-Memory Security å†…å­˜å®‰å…¨ åœ¨è¿™ç§ç±»å‹çš„å®ç°ä¸­ï¼Œæˆ‘ä»¬å°†æ•°æ®å­˜å‚¨åœ¨ RAMï¼ˆå†…å­˜ä¸­ï¼‰ä¸­ï¼Œå¹¶åœ¨æœ‰è¯·æ±‚æ—¶éªŒè¯æ•°æ®ã€‚æˆ‘ä»¬åœ¨æµ‹è¯•æˆ–å¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚åœ¨ç”Ÿäº§åº”ç”¨ä¸­ä¸å»ºè®®ä½¿ç”¨æ­¤æ–¹æ³•ã€‚\nä½¿ç”¨æ•°æ®åº“(JDBC) åœ¨è¿™ç§ç±»å‹çš„å®ç°ä¸­ï¼Œæˆ‘ä»¬å°†æ•°æ®å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå¹¶åœ¨è¯·æ±‚åˆ°æ¥æ—¶éªŒè¯æ•°æ®/ç™»å½•ã€‚ä½†å®ƒæ˜¯åŸºäºç¨‹åºå‘˜æä¾›çš„ SQL æŸ¥è¯¢æ¥å·¥ä½œçš„ã€‚\nUsing UserDetailsService ä½¿ç”¨ç”¨æˆ·è¯¦ç»†ä¿¡æ¯æœåŠ¡ æˆ‘ä»¬å°†æ•°æ®å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå¹¶åœ¨è¯·æ±‚åˆ°æ¥æ—¶éªŒè¯æ•°æ®ã€‚ä½† UserDetailsSâ€‹â€‹ervice æ˜¯åŸºäº ORMï¼ˆSpring Data JPAï¼‰å·¥ä½œçš„ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒUserDetailsSâ€‹â€‹ervice æ˜¯ Spring Security æ¨¡å—æä¾›çš„ä¸€ä¸ªæ¥å£ã€‚åœ¨ç™»å½•è¡¨å•ä¸­è¾“å…¥ç”¨æˆ·ååï¼Œå½“æˆ‘ä»¬å•å‡»ç™»å½•æŒ‰é’®æ—¶ï¼Œå°†è°ƒç”¨è¯¥æœåŠ¡ã€‚éšåï¼Œå®ƒæ ¹æ®æä¾›çš„ç”¨æˆ·åæ‰¾åˆ°ç”¨æˆ·ã€‚å®ƒåŒ…å«ä¸€ä¸ªæ–¹æ³• loadUserByUsername(String username) è¿”å› UserDetails å¯¹è±¡ã€‚æ­¤å¤–ï¼ŒUserDetails å¯¹è±¡ä¸ºæˆ‘ä»¬æä¾›äº†ç”¨æˆ·åã€‚\nåœ¨ Spring Boot åº”ç”¨ç¨‹åºä¸­å®ç° Web å®‰å…¨çš„æ­¥éª¤æ˜¯ä»€ä¹ˆï¼Ÿ ä»¥ä¸‹æ˜¯æ­¥éª¤ï¼š\nç¼–å†™ä¸€ä¸ªç±»â€œSecurityConfig.javaâ€ï¼Œå®ƒæ‰©å±•äº†é¢„å®šä¹‰çš„æŠ½è±¡ç±» WebSecurityConfigurerAdapter.java\nåœ¨â€œSecurityConfig.javaâ€ä¹‹ä¸Šç›¸åº”åœ°åº”ç”¨æ³¨é‡Š@Configuration å’Œ@EnableWebSecurityã€‚ä¸ç”¨è¯´ï¼Œæ³¨é‡Š@EnableWebSecurity æ˜¯ä¸ºäº†åœ¨ Web åº”ç”¨ç¨‹åºä¸­å¯ç”¨å®‰å…¨åŠŸèƒ½ã€‚\nè¦†ç›–ä¸‹é¢ä¸¤ç§æ–¹æ³•åŒæ—¶å®ç°èº«ä»½éªŒè¯å’Œæˆæƒé€»è¾‘ã€‚\nconfigure(AuthenticationManagerBuilder auth) configure(HttpSecurity http) æ­¤å¤–ï¼Œé€šè¿‡ä½¿ç”¨@Autowiredï¼ˆå¦‚ DataSourceã€BCryptPasswordEncoder ç­‰ï¼‰æ³¨å…¥å…¶ä»–å¯¹è±¡ä¾èµ–é¡¹ï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œå¹¶åœ¨éœ€è¦çš„åœ°æ–¹ä½¿ç”¨å®ƒä»¬ã€‚\nåŒæ ·é‡è¦çš„æ˜¯ï¼Œæ ¹æ®éœ€è¦ç¼–å†™æ§åˆ¶å™¨ç±»å’Œè§†å›¾é¡µé¢ã€‚\næœ€åï¼Œå¦‚æœæ‚¨ä¸å®æ–½å†…å­˜ä¸­èº«ä»½éªŒè¯ï¼Œè¯·æ›´æ–° application.properties æ–‡ä»¶ä¸­çš„æ•°æ®åº“å±æ€§ã€‚\næ³¨æ„ï¼šä» Spring Security 5.7.0-M2 å¼€å§‹ï¼ŒWebSecurityConfigurerAdapter å·²è¢«å¼ƒç”¨ã€‚ä¸ºäº†äº†è§£å®ç°è‡ªå®šä¹‰é…ç½®ç±»çš„æ–°æ–¹æ³•ï¼Œè¯·è®¿é—®æœ‰å…³ä¸ä½¿ç”¨ WebSecurityConfigurerAdapter çš„ Spring Security çš„å•ç‹¬æ–‡ç« ã€‚\nå¦‚ä½•å®ç°å†…å­˜ä¸­èº«ä»½éªŒè¯å®‰å…¨æ€§çš„ç¤ºä¾‹ ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªå°å‹ç»„ç»‡çš„åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­æˆ‘ä»¬æœ‰ä¸‰ä¸ªè§’è‰²ï¼šå‘˜å·¥ã€ç»ç†å’Œç®¡ç†å‘˜ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å°†å¯¹æŸäº›ç‰¹å®šé¡µé¢è¿›è¡ŒåŸºäºè§’è‰²çš„é™åˆ¶è®¿é—®ã€‚ä¸€æ–¹é¢ï¼ŒæŸäº›é¡µé¢å¯ä¾›å¤šä¸ªè§’è‰²è®¿é—®ï¼Œå¦ä¸€æ–¹é¢ï¼ŒæŸäº›é¡µé¢æ²¡æœ‰é™åˆ¶ï¼ˆæ‰€æœ‰è§’è‰²å‡å¯è®¿é—®ï¼‰ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ thymeleaf æ¥åˆ›å»ºé¡µé¢ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å°†æœ‰ä¸€ä¸ªæ§åˆ¶å™¨ç±»æ¥æ»¡è¶³ç”¨æˆ·çš„è¯·æ±‚ã€‚\nSoftware/Technologies Used ä½¿ç”¨çš„è½¯ä»¶/æŠ€æœ¯ STS (Spring Tool Suite) : Version-\u0026gt; 4.7.1.RELEASE JDK14 (JDK8 or later versions are sufficient) æ­¥éª¤#1ï¼šåœ¨ STS(Spring Tool Suite)ä¸­åˆ›å»ºä¸€ä¸ª Spring Boot Starter é¡¹ç›® åˆ›å»ºå…¥é—¨é¡¹ç›®æ—¶ï¼Œé€‰æ‹©â€œSpring Securityâ€ã€â€œThymeleafâ€ã€â€œSpring Webâ€å’Œâ€œSpring Boot DevToolsâ€ä½œä¸ºå…¥é—¨é¡¹ç›®ä¾èµ–é¡¹ã€‚è¦äº†è§£â€œå¦‚ä½•åˆ›å»º Spring Boot Starter é¡¹ç›®ï¼Ÿâ€ï¼Œè¯·è®¿é—®å†…éƒ¨é“¾æ¥ã€‚\næ­¥éª¤#2ï¼šç¼–å†™æ§åˆ¶å™¨ç±» è¯·æ£€æŸ¥ä»¥ä¸‹ä»£ç ä½œä¸ºæ§åˆ¶å™¨ç±»ã€‚\nHomeController.java\npackage com.dev.springboot.security.controller; import org.springframework.stereotype.Controller; import org.springframework.web.bind.annotation.GetMapping; @Controller public class HomeController { @GetMapping(\u0026#34;/home\u0026#34;) public String getHomePage() { return \u0026#34;homePage\u0026#34;; } @GetMapping(\u0026#34;/welcome\u0026#34;) public String getWelcomePage() { return \u0026#34;welcomePage\u0026#34;; } @GetMapping(\u0026#34;/admin\u0026#34;) public String getAdminPage() { return \u0026#34;adminPage\u0026#34;; } @GetMapping(\u0026#34;/emp\u0026#34;) public String getEmployeePage() { return \u0026#34;empPage\u0026#34;; } @GetMapping(\u0026#34;/mgr\u0026#34;) public String getManagerPage() { return \u0026#34;mgrPage\u0026#34;; } @GetMapping(\u0026#34;/common\u0026#34;) public String getCommonPage() { return \u0026#34;commonPage\u0026#34;; } @GetMapping(\u0026#34;/accessDenied\u0026#34;) public String getAccessDeniedPage() { return \u0026#34;accessDeniedPage\u0026#34;; } } æ­¥éª¤#3ï¼šç¼–å†™ UI é¡µé¢ (Thymeleaf) ä»¥ä¸‹æ–‡ä»¶æ˜¯ UI é¡µé¢ã€‚å› æ­¤ï¼Œä»…å°†å®ƒä»¬æ”¾åœ¨â€œsrc/main/resources/templatesâ€æ–‡ä»¶å¤¹ä¸­ã€‚\nhomepage.html\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html xmlns:th=\u0026#34;http://www.thymeleaf.org\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;ISO-8859-1\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Insert title here\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h3\u0026gt;welcome to Home Page\u0026lt;/h3\u0026gt; This page is accessible to ALL. \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; welcomePage.html\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html xmlns:th=\u0026#34;http://www.thymeleaf.org\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;ISO-8859-1\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Insert title here\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h3\u0026gt;Welcome Page after successful Login\u0026lt;/h3\u0026gt; \u0026lt;a th:href=\u0026#34;@{/logout}\u0026#34;\u0026gt;LOGOUT\u0026lt;/a\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; adminPage.html\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html xmlns:th=\u0026#34;http://www.thymeleaf.org\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;ISO-8859-1\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Insert title here\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h3\u0026gt;Admin Page\u0026lt;/h3\u0026gt; Only Admins are allowed to access this page.!!! \u0026lt;a th:href=\u0026#34;@{/logout}\u0026#34;\u0026gt;LOGOUT\u0026lt;/a\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; empPage.html\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html xmlns:th=\u0026#34;http://www.thymeleaf.org\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;ISO-8859-1\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Insert title here\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h3\u0026gt;Employee Page\u0026lt;/h3\u0026gt; \u0026lt;a th:href=\u0026#34;@{/logout}\u0026#34;\u0026gt;LOGOUT\u0026lt;/a\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; mgrPage.html\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html xmlns:th=\u0026#34;http://www.thymeleaf.org\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;ISO-8859-1\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Insert title here\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h3\u0026gt;Manager Page\u0026lt;/h3\u0026gt; \u0026lt;a th:href=\u0026#34;@{/logout}\u0026#34;\u0026gt;LOGOUT\u0026lt;/a\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; commonPage.html\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html xmlns:th=\u0026#34;http://www.thymeleaf.org\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;ISO-8859-1\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Insert title here\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h3\u0026gt;COMMON Page\u0026lt;/h3\u0026gt; Both Manager \u0026amp; Employee are allowed to access this page. ! \u0026lt;a th:href=\u0026#34;@{/logout}\u0026#34;\u0026gt;LOGOUT\u0026lt;/a\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; accessDeniedPage.html\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html xmlns:th=\u0026#34;http://www.thymeleaf.org\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;ISO-8859-1\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Insert title here\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h3\u0026gt;You are not allowed to access this page. Please go to Welcome Page\u0026lt;/h3\u0026gt; \u0026lt;a th:href=\u0026#34;@{/welcome}\u0026#34;\u0026gt;Welcome\u0026lt;/a\u0026gt; \u0026lt;a th:href=\u0026#34;@{/logout}\u0026#34;\u0026gt;LOGOUT\u0026lt;/a\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; æ­¥éª¤#4ï¼šç¼–å†™ SecurityConfig ç±» æ­¤ç±»å¯¹äºå®ç°åŒ…å«æ‰€æœ‰å®‰å…¨ç›¸å…³é€»è¾‘çš„å®‰å…¨åŠŸèƒ½è€Œè¨€æ˜¯æœ€é‡è¦çš„ã€‚å¦‚ä¸‹é¢çš„ä»£ç ç¤ºä¾‹æ‰€ç¤ºï¼Œå¦‚æœæˆ‘ä»¬ä¸æƒ³å¯¹å¯†ç è¿›è¡Œç¼–ç ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¯†ç å€¼ä¹‹å‰ä½¿ç”¨â€œ{noop}â€ã€‚\næ­¥éª¤#4Aï¼šSpring Security 5.7.0 ä»¥ä¸‹ç‰ˆæœ¬çš„ä»£ç  SecurityConfig.java\npackage com.dev.springboot.security; import org.springframework.context.annotation.Configuration; import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity; import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter; import org.springframework.security.web.util.matcher.AntPathRequestMatcher; @Configuration @EnableWebSecurity public class SecurityConfig extends WebSecurityConfigurerAdapter { @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception { // {noop} =\u0026gt; No operation for password encoder\t(no password encoding needed) auth.inMemoryAuthentication().withUser(\u0026#34;devs\u0026#34;).password(\u0026#34;{noop}devs\u0026#34;).authorities(\u0026#34;ADMIN\u0026#34;); auth.inMemoryAuthentication().withUser(\u0026#34;ns\u0026#34;).password(\u0026#34;{noop}ns\u0026#34;).authorities(\u0026#34;EMPLOYEE\u0026#34;); auth.inMemoryAuthentication().withUser(\u0026#34;vs\u0026#34;).password(\u0026#34;{noop}vs\u0026#34;).authorities(\u0026#34;MANAGER\u0026#34;); } @Override protected void configure(HttpSecurity http) throws Exception { //declares which Page(URL) will have What access type http.authorizeRequests() .antMatchers(\u0026#34;/home\u0026#34;).permitAll() .antMatchers(\u0026#34;/welcome\u0026#34;).authenticated() .antMatchers(\u0026#34;/admin\u0026#34;).hasAuthority(\u0026#34;ADMIN\u0026#34;) .antMatchers(\u0026#34;/emp\u0026#34;).hasAuthority(\u0026#34;EMPLOYEE\u0026#34;) .antMatchers(\u0026#34;/mgr\u0026#34;).hasAuthority(\u0026#34;MANAGER\u0026#34;) .antMatchers(\u0026#34;/common\u0026#34;).hasAnyAuthority(\u0026#34;EMPLOYEE\u0026#34;,\u0026#34;MANAGER\u0026#34;) // Any other URLs which are not configured in above antMatchers // generally declared aunthenticated() in real time .anyRequest().authenticated() //Login Form Details .and() .formLogin() .defaultSuccessUrl(\u0026#34;/welcome\u0026#34;, true) //Logout Form Details .and() .logout() .logoutRequestMatcher(new AntPathRequestMatcher(\u0026#34;/logout\u0026#34;)) //Exception Details .and() .exceptionHandling() .accessDeniedPage(\u0026#34;/accessDenied\u0026#34;) ; } } æ­¥éª¤#4Bï¼šSpring Security 5.7 ä»¥ä¸Šç‰ˆæœ¬å’Œ Spring Security 6.0 ä»¥ä¸‹ç‰ˆæœ¬çš„ä»£ç  ç”±äºæ ¹æ® Spring å®˜ç½‘å‘å¸ƒçš„å…¬å‘Šï¼ŒWebSecurityConfigurerAdapter å·²ä» Spring Security 5.7.0-M2 ä¸­å¼ƒç”¨ï¼Œå› æ­¤ï¼Œ2022 å¹´ 2 æœˆ 21 æ—¥ï¼Œæˆ‘ä»¬å°†ä¸ä½¿ç”¨ WebSecurityConfigurerAdapter æ¥ç¼–å†™ SecurityConfig ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nSecurityConfig.java\npackage com.dev.springboot.security; import java.util.ArrayList; import java.util.List; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity; import org.springframework.security.core.GrantedAuthority; import org.springframework.security.core.authority.SimpleGrantedAuthority; import org.springframework.security.core.userdetails.User; import org.springframework.security.core.userdetails.UserDetails; import org.springframework.security.provisioning.InMemoryUserDetailsManager; import org.springframework.security.web.SecurityFilterChain; import org.springframework.security.web.util.matcher.AntPathRequestMatcher; @Configuration @EnableWebSecurity public class SecurityConfig { @Bean protected InMemoryUserDetailsManager configAuthentication() { List\u0026lt;UserDetails\u0026gt; users = new ArrayList\u0026lt;\u0026gt;(); List\u0026lt;GrantedAuthority\u0026gt; adminAuthority = new ArrayList\u0026lt;\u0026gt;(); adminAuthority.add(new SimpleGrantedAuthority(\u0026#34;ADMIN\u0026#34;)); UserDetails admin= new User(\u0026#34;devs\u0026#34;, \u0026#34;{noop}devs\u0026#34;, adminAuthority); users.add(admin); List\u0026lt;GrantedAuthority\u0026gt; employeeAuthority = new ArrayList\u0026lt;\u0026gt;(); adminAuthority.add(new SimpleGrantedAuthority(\u0026#34;EMPLOYEE\u0026#34;)); UserDetails employee= new User(\u0026#34;ns\u0026#34;, \u0026#34;{noop}ns\u0026#34;, employeeAuthority); users.add(employee); List\u0026lt;GrantedAuthority\u0026gt; managerAuthority = new ArrayList\u0026lt;\u0026gt;(); adminAuthority.add(new SimpleGrantedAuthority(\u0026#34;MANAGER\u0026#34;)); UserDetails manager= new User(\u0026#34;vs\u0026#34;, \u0026#34;{noop}vs\u0026#34;, managerAuthority); users.add(manager); return new InMemoryUserDetailsManager(users); } @Bean protected SecurityFilterChain filterChain(HttpSecurity http) throws Exception { //declares which Page(URL) will have What access type http.authorizeRequests() .antMatchers(\u0026#34;/home\u0026#34;).permitAll() .antMatchers(\u0026#34;/welcome\u0026#34;).authenticated() .antMatchers(\u0026#34;/admin\u0026#34;).hasAuthority(\u0026#34;ADMIN\u0026#34;) .antMatchers(\u0026#34;/emp\u0026#34;).hasAuthority(\u0026#34;EMPLOYEE\u0026#34;) .antMatchers(\u0026#34;/mgr\u0026#34;).hasAuthority(\u0026#34;MANAGER\u0026#34;) .antMatchers(\u0026#34;/common\u0026#34;).hasAnyAuthority(\u0026#34;EMPLOYEE\u0026#34;,\u0026#34;MANAGER\u0026#34;) // Any other URLs which are not configured in above antMatchers // generally declared aunthenticated() in real time .anyRequest().authenticated() //Login Form Details .and() .formLogin() .defaultSuccessUrl(\u0026#34;/welcome\u0026#34;, true) //Logout Form Details .and() .logout() .logoutRequestMatcher(new AntPathRequestMatcher(\u0026#34;/logout\u0026#34;)) //Exception Details .and() .exceptionHandling() .accessDeniedPage(\u0026#34;/accessDenied\u0026#34;) ; return http.build(); } } æ­¥éª¤#4Cï¼šSpring Security 6.0.0 åŠæ›´é«˜ç‰ˆæœ¬çš„ä»£ç ï¼ˆSpring Boot 3.0+ï¼‰ ä» Spring Security 6.0ï¼ˆ2022 å¹´ 11 æœˆå‘å¸ƒï¼‰å¼€å§‹ï¼ŒWebSecurityConfigurerAdapter å·²ä» Spring Security API ä¸­å®Œå…¨åˆ é™¤ã€‚å®ƒè¿˜å½±å“äº† 2022 å¹´ 11 æœˆæ–°å‘å¸ƒçš„ Spring Boot 3.0ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ Spring Framework 6.0+ æˆ– Spring Boot 3.0+ï¼Œæ— è®ºå“ªç§æƒ…å†µï¼ŒSecurityConfig.java çš„å®ç°åº”å¦‚ä¸‹æ‰€ç¤ºã€‚æ­¤å¤–ï¼Œæ‚¨è¿˜å¯ä»¥æ£€æŸ¥Spring Framework 6.0 ä¸­ä¸ Spring Security ç›¸å…³çš„æ›´æ”¹ã€‚\nSecurityConfig.java\npackage com.dev.springboot.security; import java.util.ArrayList; import java.util.List; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity; import org.springframework.security.core.GrantedAuthority; import org.springframework.security.core.authority.SimpleGrantedAuthority; import org.springframework.security.core.userdetails.User; import org.springframework.security.core.userdetails.UserDetails; import org.springframework.security.provisioning.InMemoryUserDetailsManager; import org.springframework.security.web.SecurityFilterChain; import org.springframework.security.web.util.matcher.AntPathRequestMatcher; @Configuration @EnableWebSecurity public class SecurityConfig { @Bean protected InMemoryUserDetailsManager configAuthentication() { List\u0026lt;UserDetails\u0026gt; users = new ArrayList\u0026lt;\u0026gt;(); List\u0026lt;GrantedAuthority\u0026gt; adminAuthority = new ArrayList\u0026lt;\u0026gt;(); adminAuthority.add(new SimpleGrantedAuthority(\u0026#34;ADMIN\u0026#34;)); UserDetails admin= new User(\u0026#34;devs\u0026#34;, \u0026#34;{noop}devs\u0026#34;, adminAuthority); users.add(admin); List\u0026lt;GrantedAuthority\u0026gt; employeeAuthority = new ArrayList\u0026lt;\u0026gt;(); adminAuthority.add(new SimpleGrantedAuthority(\u0026#34;EMPLOYEE\u0026#34;)); UserDetails employee= new User(\u0026#34;ns\u0026#34;, \u0026#34;{noop}ns\u0026#34;, employeeAuthority); users.add(employee); List\u0026lt;GrantedAuthority\u0026gt; managerAuthority = new ArrayList\u0026lt;\u0026gt;(); adminAuthority.add(new SimpleGrantedAuthority(\u0026#34;MANAGER\u0026#34;)); UserDetails manager= new User(\u0026#34;vs\u0026#34;, \u0026#34;{noop}vs\u0026#34;, managerAuthority); users.add(manager); return new InMemoryUserDetailsManager(users); } @Bean protected SecurityFilterChain filterChain(HttpSecurity http) throws Exception { //declares which Page(URL) will have What access type http.authorizeHttpRequests() .requestMatchers(\u0026#34;/home\u0026#34;).permitAll() .requestMatchers(\u0026#34;/welcome\u0026#34;).authenticated() .requestMatchers(\u0026#34;/admin\u0026#34;).hasAuthority(\u0026#34;ADMIN\u0026#34;) .requestMatchers(\u0026#34;/emp\u0026#34;).hasAuthority(\u0026#34;EMPLOYEE\u0026#34;) .requestMatchers(\u0026#34;/mgr\u0026#34;).hasAuthority(\u0026#34;MANAGER\u0026#34;) .requestMatchers(\u0026#34;/common\u0026#34;).hasAnyAuthority(\u0026#34;EMPLOYEE\u0026#34;,\u0026#34;MANAGER\u0026#34;) // Any other URLs which are not configured in above antMatchers // generally declared aunthenticated() in real time .anyRequest().authenticated() //Login Form Details .and() .formLogin() .defaultSuccessUrl(\u0026#34;/welcome\u0026#34;, true) //Logout Form Details .and() .logout() .logoutRequestMatcher(new AntPathRequestMatcher(\u0026#34;/logout\u0026#34;)) //Exception Details .and() .exceptionHandling() .accessDeniedPage(\u0026#34;/accessDenied\u0026#34;) ; return http.build(); } } æ³¨æ„ï¼šåœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œè§‚å¯Ÿ Spring Security 6.0 ä¸­çš„ API å˜åŒ–ï¼šantMatchers()è¢« requestMatchers()æ›¿æ¢ï¼ŒauthorizeRequests()è¢« authorizeHttpRequests()æ›¿æ¢ã€‚\næ‚¨çš„é¡¹ç›®ç»“æ„å°†å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\nå¦‚ä½•å®ç° JDBC èº«ä»½éªŒè¯å®‰å…¨æ€§ç¤ºä¾‹ åœ¨è¿™ç§èº«ä»½éªŒè¯æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æ ¹æ®æ•°æ®åº“ä¸­çš„ç°æœ‰å€¼éªŒè¯å‡­æ®å’Œè§’è‰²ã€‚æ­¤å¤–ï¼Œåœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬è¿˜å°†ç ”ç©¶å¯†ç åŠ å¯†é€»è¾‘ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å°†åœ¨æ•°æ®åº“ä¸­æ’å…¥ä¸€äº›è™šæ‹Ÿæ•°æ®ï¼Œç„¶åç›¸åº”åœ°æµ‹è¯•å®‰å…¨åŠŸèƒ½ã€‚å½’æ ¹ç»“åº•ï¼Œå¦‚æœæˆ‘ä»¬æ¯”è¾ƒå‰é¢ç¤ºä¾‹çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å°†æŠŠç”¨æˆ·å‡­æ®å’Œè§’è‰²ä¿å­˜åˆ°æ•°æ®åº“è€Œä¸æ˜¯ RAM ä¸­ã€‚\næ­¤å¤–ï¼Œåœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†æä¾›ç”¨äºå®ç°å¯†ç åŠ å¯†é€»è¾‘çš„é™„åŠ ä»£ç ã€‚å› æ­¤ï¼Œä¸Šä¸€ä¸ªç¤ºä¾‹ä¸­çš„æ‰€æœ‰æ–‡ä»¶åœ¨æ­¤ç¤ºä¾‹ä¸­ä¹Ÿå°†æœ‰æ•ˆã€‚\næ­¤å¤–ï¼Œæˆ‘ä»¬å°†æœ‰ä¸€ä¸ªé…ç½®ç±»æ¥åˆ›å»º BCryptPasswordEncoder å¯¹è±¡æ¥å¯¹å¯†ç è¿›è¡Œç¼–ç ï¼Œå¹¶åœ¨ application.properties ä¸­åˆ›å»ºæ•°æ®åº“å±æ€§æ¡ç›®ä»¥è¿æ¥æ•°æ®åº“ã€‚ä¸ç”¨è¯´ï¼ŒSecurityConfig ç±»çš„å®ç°è¿™æ¬¡ä¼šæœ‰æ‰€ä¸åŒã€‚\nä½¿ç”¨çš„è½¯ä»¶/æŠ€æœ¯ STS (Spring Tool Suite) : Version-\u0026gt; 4.7.1.RELEASE MySQL Database : Version -\u0026gt;8.0.19 MySQL Community Server JDK14 (JDK8 or later versions are sufficient) æ­¥éª¤#1ï¼šåœ¨æ•°æ®åº“ä¸­æ’å…¥ä¸€äº›è™šæ‹Ÿè®°å½• è¯·æ³¨æ„ï¼Œæ­¤æ­¥éª¤ä»…ç”¨äºæµ‹è¯•ç›®çš„ã€‚å¦‚æœæ‚¨æœ€è¿‘å·²ç»ä½¿ç”¨ç”¨æˆ·å‡­æ®å’Œè§’è‰²æ˜ å°„åˆ›å»ºäº†æ•°æ®åº“ï¼Œè¯·å¿½ç•¥æ­¤æ­¥éª¤ã€‚åœ¨æ­¥éª¤#1A ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€äº›å¯†ç ç¼–ç å€¼ï¼Œç„¶ååœ¨æ­¥éª¤#1B ä¸­å°†å®ƒä»¬æ’å…¥åˆ°æ•°æ®åº“ä¸­ã€‚\næ­¥éª¤#1Aï¼šä½¿ç”¨ BCryptPasswordEncoder åˆ›å»ºç¼–ç å¯†ç å€¼ æˆ‘ä»¬å°†ä½¿ç”¨ BCryptPasswordEncoder ç”Ÿæˆä¸€äº›ç¼–ç å¯†ç å€¼ï¼Œå¦‚ä¸‹æ‰€ç¤º\nBCryptPasswordEncoderTest.java\npackage com.dev.springboot.security.util; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; public class BCryptPasswordEncoderTest { public static void main(String[] args) { BCryptPasswordEncoder bpe = new BCryptPasswordEncoder(); String encodedPWD = bpe.encode(\u0026#34;devs@A!5003\u0026#34;); System.out.println(encodedPWD); } } è¾“å‡º\n$2a$10$qnOB2PH1CqRvw8f5epvHzOlrounRkVGi.Y5ho6ENdmj/C1DmPdAsy æ­¥éª¤#1Bï¼šåˆ›å»ºæ•°æ®åº“å¹¶æ’å…¥è™šæ‹Ÿè®°å½• æ‰§è¡Œ MySQL DB å‘½ä»¤å¦‚ä¸‹ï¼š\nTo create the database as \u0026#39;testbootsecurity\u0026#39; â™¦ create database testbootsecurity; To take \u0026#39;testbootsecurity\u0026#39; in use: â™¦ use testbootsecurity; To create the user table: â™¦ create table user (user_id int, user_name varchar(30), user_pwd varchar(100), user_role varchar(20), user_enabled int); To check the description of user table: â™¦ desc user; INSERT INTO user values(501,\u0026#39;devs\u0026#39;,\u0026#39;$2a$10$qnOB2PH1CqRvw8f5epvHzOlrounRkVGi.Y5ho6ENdmj/C1DmPdAsy\u0026#39;,\u0026#39;ADMIN\u0026#39;,1); INSERT INTO user values(502,\u0026#39;ns\u0026#39;,\u0026#39;$2a$10$mmUMC5ZwoVnEQYV7/R6m.uWWtj7EiIo3lKasBObkOCc12huVUWpMC\u0026#39;,\u0026#39;EMPLOYEE\u0026#39;,1); INSERT INTO user values(503,\u0026#39;vs\u0026#39;,\u0026#39;$2a$10$kqEC/fhQ7SNDhnncOQ9pb.yXXxJ/c7a1SQx2QPNZ.47fUmvF3Wb.i\u0026#39;,\u0026#39;MANAGER\u0026#39;,1); â™¦ select * from user; (To check if values are inserted into DB) æ­¤å¤–ï¼Œåœ¨å®ç° SecurityConfig.java ç±»çš„ configure(AuthenticationManagerBuilder auth) æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬å°†éœ€è¦ä»¥ä¸‹ä¸¤ä¸ªæŸ¥è¯¢ã€‚\nQuery#1 : Retrieve username,password,enabled using username ; â™¦ select user_name,user_pwd,user_enabled from user where user_name=?; Query#2 : Retrieve username,role using username; â™¦ select user_name,user_role from user where user_name=?; æ­¥éª¤#2ï¼šåœ¨ STS(Spring Tool Suite)ä¸­åˆ›å»ºä¸€ä¸ª Spring Boot Starter é¡¹ç›® åˆ›å»ºå…¥é—¨é¡¹ç›®æ—¶ï¼Œé€‰æ‹©â€œSpring Securityâ€ã€â€œThymeleafâ€ã€â€œSpring Webâ€ã€â€œJDBC APIâ€ã€â€œMySQL Driverâ€å’Œâ€œSpring Boot DevToolsâ€ä½œä¸ºå…¥é—¨é¡¹ç›®ä¾èµ–é¡¹ã€‚\næ­¥éª¤#3ï¼šä»ä¸Šä¸€ä¸ªç¤ºä¾‹å¤åˆ¶æ§åˆ¶å™¨ç±»å’Œ UI é¡µé¢ å¤åˆ¶ HomeController.java ä»¥åŠå‰é¢ç¤ºä¾‹ä¸­çš„æ‰€æœ‰ thymeleaf é¡µé¢ã€‚\næ­¥éª¤#4ï¼šåˆ›å»º AppConfig.java ä»¥åˆ›å»º BCryptPasswordEncoder å¯¹è±¡ å¦‚ä¸‹åˆ›å»º AppConfig.javaã€‚åœ¨å®ç° SecurityConfig.java ç±»æ—¶ï¼Œæˆ‘ä»¬å°†éœ€è¦ BCryptPasswordEncoder å¯¹è±¡ã€‚\nAppConfig.java\npackage com.dev.springboot.security.jdbc.config; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; @Configuration public class AppConfig { @Bean public BCryptPasswordEncoder encode() { return new BCryptPasswordEncoder(); } } æ­¥éª¤#5ï¼šæ›´æ–° application.properties æ–‡ä»¶ä¸­çš„æ•°æ®åº“å±æ€§ æ›´æ–° application.properties ä»¥è¿æ¥åˆ° MySQL DBï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å¯ä»¥çœç•¥ driver-class-nameï¼Œå› ä¸º Spring Boot ä¼šè‡ªåŠ¨ä»æ•°æ®åº“ URL ä¸­æ‰¾åˆ°å®ƒã€‚\n#application.properties ------------------------------------------------------------------- spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver spring.datasource.url=jdbc:mysql://localhost:3306/testBootSecurity spring.datasource.username=root spring.datasource.password=devs æ­¥éª¤#6ï¼šæ›´æ–° SecurityConfig.java ä»å‰é¢çš„ç¤ºä¾‹ä¸­å¤åˆ¶ SecurityConfig.java å¹¶æ›´æ–° configure( AuthenticationManagerBuilder auth) æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚\næ­¥éª¤#6Aï¼šSpring Security 5.7.0 ä»¥ä¸‹ç‰ˆæœ¬çš„ä»£ç  SecurityConfig.java\npackage com.dev.springboot.security.jdbc.config; import javax.sql.DataSource; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.context.annotation.Configuration; import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity; import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; import org.springframework.security.web.util.matcher.AntPathRequestMatcher; @Configuration @EnableWebSecurity public class SecurityConfig extends WebSecurityConfigurerAdapter { @Autowired private DataSource dataSource; @Autowired private BCryptPasswordEncoder passwordEncoder; @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception { auth.jdbcAuthentication() .dataSource(dataSource) //creates database connection .usersByUsernameQuery(\u0026#34;select user_name,user_pwd,user_enabled from user where user_name=?\u0026#34;) .authoritiesByUsernameQuery(\u0026#34;select user_name,user_role from user where user_name=?\u0026#34;) .passwordEncoder(passwordEncoder); } @Override public void configure(HttpSecurity http) throws Exception { http.authorizeRequests() .antMatchers(\u0026#34;/home\u0026#34;).permitAll() .antMatchers(\u0026#34;/welcome\u0026#34;).authenticated() .antMatchers(\u0026#34;/admin\u0026#34;).hasAuthority(\u0026#34;ADMIN\u0026#34;) .antMatchers(\u0026#34;/emp\u0026#34;).hasAuthority(\u0026#34;EMPLOYEE\u0026#34;) .antMatchers(\u0026#34;/mgr\u0026#34;).hasAuthority(\u0026#34;MANAGER\u0026#34;) .anyRequest().authenticated() .and() .formLogin() .defaultSuccessUrl(\u0026#34;/welcome\u0026#34;,true) .and() .logout() .logoutRequestMatcher(new AntPathRequestMatcher(\u0026#34;/logout\u0026#34;)) .and() .exceptionHandling() .accessDeniedPage(\u0026#34;/accessDenied\u0026#34;) ; } } æ­¥éª¤#6Bï¼šSpring Security 5.7.0 ä»¥ä¸Šç‰ˆæœ¬å’Œ Spring Security 6.0.0 ä»¥ä¸‹ç‰ˆæœ¬çš„ä»£ç  ç”±äºæ ¹æ® Spring å®˜ç½‘å‘å¸ƒçš„å…¬å‘Šï¼ŒWebSecurityConfigurerAdapter å·²ä» Spring Security 5.7.0-M2 ä¸­å¼ƒç”¨ï¼Œå› æ­¤ï¼Œ2022 å¹´ 2 æœˆ 21 æ—¥ï¼Œæˆ‘ä»¬å°†ä¸ä½¿ç”¨ WebSecurityConfigurerAdapter æ¥ç¼–å†™ SecurityConfig ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nSecurityConfig.java\npackage com.dev.springboot.security.jdbc.config; import javax.sql.DataSource; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity; import org.springframework.security.core.userdetails.User; import org.springframework.security.core.userdetails.UserDetails; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; import org.springframework.security.crypto.factory.PasswordEncoderFactories; import org.springframework.security.provisioning.JdbcUserDetailsManager; import org.springframework.security.provisioning.UserDetailsManager; import org.springframework.security.web.SecurityFilterChain; import org.springframework.security.web.util.matcher.AntPathRequestMatcher; @Configuration @EnableWebSecurity public class SecurityConfig { @Autowired private DataSource dataSource; @Autowired private BCryptPasswordEncoder passwordEncoder; @Bean public UserDetailsManager authenticateUsers() { UserDetails user = User.withUsername(\u0026#34;devs\u0026#34;). password(PasswordEncoderFactories.createDelegatingPasswordEncoder().encode(\u0026#34;password\u0026#34;)).build(); JdbcUserDetailsManager users = new JdbcUserDetailsManager(dataSource); users.setAuthoritiesByUsernameQuery(\u0026#34;select user_name,user_pwd,user_enabled from user where user_name=?\u0026#34;); users.setUsersByUsernameQuery(\u0026#34;select user_name,user_role from user where user_name=?\u0026#34;); users.createUser(user); return users; } @Bean protected SecurityFilterChain filterChain(HttpSecurity http) throws Exception { http.authorizeRequests() .antMatchers(\u0026#34;/home\u0026#34;).permitAll() .antMatchers(\u0026#34;/welcome\u0026#34;).authenticated() .antMatchers(\u0026#34;/admin\u0026#34;).hasAuthority(\u0026#34;ADMIN\u0026#34;) .antMatchers(\u0026#34;/emp\u0026#34;).hasAuthority(\u0026#34;EMPLOYEE\u0026#34;) .antMatchers(\u0026#34;/mgr\u0026#34;).hasAuthority(\u0026#34;MANAGER\u0026#34;) .anyRequest().authenticated() .and() .formLogin() .defaultSuccessUrl(\u0026#34;/welcome\u0026#34;,true) .and() .logout() .logoutRequestMatcher(new AntPathRequestMatcher(\u0026#34;/logout\u0026#34;)) .and() .exceptionHandling() .accessDeniedPage(\u0026#34;/accessDenied\u0026#34;) ; return http.build(); } } æ­¥éª¤#6Cï¼šSpring Security 6.0.0 åŠæ›´é«˜ç‰ˆæœ¬çš„ä»£ç ï¼ˆSpring Boot 3.0+ï¼‰ ä» Spring Security 6.0ï¼ˆ2022 å¹´ 11 æœˆå‘å¸ƒï¼‰å¼€å§‹ï¼ŒWebSecurityConfigurerAdapter å·²ä» Spring Security API ä¸­å®Œå…¨åˆ é™¤ã€‚å®ƒè¿˜å½±å“äº† 2022 å¹´ 11 æœˆæ–°å‘å¸ƒçš„ Spring Boot 3.0ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ Spring Framework 6.0+ æˆ– Spring Boot 3.0+ï¼Œæ— è®ºå“ªç§æƒ…å†µï¼ŒSecurityConfig.java çš„å®ç°åº”å¦‚ä¸‹æ‰€ç¤ºã€‚æ­¤å¤–ï¼Œæ‚¨è¿˜å¯ä»¥æ£€æŸ¥ Spring Framework 6.0 ä¸­ä¸ Spring Security ç›¸å…³çš„æ›´æ”¹ã€‚\nSecurityConfig.java\npackage com.dev.springboot.security.jdbc.config; import javax.sql.DataSource; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity; import org.springframework.security.core.userdetails.User; import org.springframework.security.core.userdetails.UserDetails; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; import org.springframework.security.crypto.factory.PasswordEncoderFactories; import org.springframework.security.provisioning.JdbcUserDetailsManager; import org.springframework.security.provisioning.UserDetailsManager; import org.springframework.security.web.SecurityFilterChain; import org.springframework.security.web.util.matcher.AntPathRequestMatcher; @Configuration @EnableWebSecurity public class SecurityConfig { @Autowired private DataSource dataSource; @Autowired private BCryptPasswordEncoder passwordEncoder; @Bean public UserDetailsManager authenticateUsers() { UserDetails user = User.withUsername(\u0026#34;devs\u0026#34;). password(PasswordEncoderFactories.createDelegatingPasswordEncoder().encode(\u0026#34;password\u0026#34;)).build(); JdbcUserDetailsManager users = new JdbcUserDetailsManager(dataSource); users.setAuthoritiesByUsernameQuery(\u0026#34;select user_name,user_pwd,user_enabled from user where user_name=?\u0026#34;); users.setUsersByUsernameQuery(\u0026#34;select user_name,user_role from user where user_name=?\u0026#34;); users.createUser(user); return users; } @Bean protected SecurityFilterChain filterChain(HttpSecurity http) throws Exception { http.authorizeHttpRequests() .requestMatchers(\u0026#34;/home\u0026#34;).permitAll() .requestMatchers(\u0026#34;/welcome\u0026#34;).authenticated() .requestMatchers(\u0026#34;/admin\u0026#34;).hasAuthority(\u0026#34;ADMIN\u0026#34;) .requestMatchers(\u0026#34;/emp\u0026#34;).hasAuthority(\u0026#34;EMPLOYEE\u0026#34;) .requestMatchers(\u0026#34;/mgr\u0026#34;).hasAuthority(\u0026#34;MANAGER\u0026#34;) .anyRequest().authenticated() .and() .formLogin() .defaultSuccessUrl(\u0026#34;/welcome\u0026#34;,true) .and() .logout() .logoutRequestMatcher(new AntPathRequestMatcher(\u0026#34;/logout\u0026#34;)) .and() .exceptionHandling() .accessDeniedPage(\u0026#34;/accessDenied\u0026#34;) ; return http.build(); } } æ³¨æ„ï¼šåœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œè§‚å¯Ÿ Spring Security 6.0 ä¸­çš„ API å˜åŒ–ï¼šantMatchers()è¢« requestMatchers()æ›¿æ¢ï¼ŒauthorizeRequests()è¢« authorizeHttpRequests()æ›¿æ¢ã€‚\nå¦‚ä½•æµ‹è¯•å¯ç”¨å®‰å…¨çš„åº”ç”¨ç¨‹åºï¼Ÿ åŒæ—¶å®Œæˆå¤§é‡ç†è®ºå’Œç¼–ç æ­¥éª¤ä¹‹åï¼Œæ˜¯æ—¶å€™æµ‹è¯•â€œå¦‚ä½•åœ¨ Spring Boot é¡¹ç›®ä¸­å®ç°å®‰å…¨æ€§ï¼Ÿâ€äº†ã€‚è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œã€‚\nå¯åŠ¨åº”ç”¨ç¨‹åºï¼Œç„¶åå³é”®å•å‡»è¯¥é¡¹ç›®ï¼Œç„¶åé€‰æ‹©â€œRun Asâ€\u0026raquo;â€œSpring Boot Appâ€ã€‚\nè¾“å…¥é¦–é¡µç½‘å€ http://localhost:8080/homeï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨æ¯ä¸ªäººéƒ½å¯ä»¥è®¿é—®ï¼Œç”šè‡³æ— éœ€ç™»å½•åº”ç”¨ç¨‹åºã€‚\nè¾“å…¥ç®¡ç†é¡µé¢ URL http://localhost:8080/adminï¼Œç„¶åå®ƒåº”è¯¥è¢«é‡å®šå‘åˆ°å†…ç½®ç™»å½•é¡µé¢ï¼ˆç”± Spring Security æä¾›ï¼‰\nä½¿ç”¨æä¾›çš„ç®¡ç†å‘˜å‡­æ®ç™»å½•ï¼Œæ‚¨å°†è¢«é‡å®šå‘åˆ°æ¬¢è¿é¡µé¢ã€‚\nè¾“å…¥ URL http://localhost:8080/adminï¼Œç„¶åæ‚¨å°±å¯ä»¥çœ‹åˆ°ç®¡ç†é¡µé¢äº†ã€‚\nå½“æ‚¨ä½¿ç”¨ç®¡ç†å‘˜å‡­æ®ç™»å½•æ—¶ï¼Œæ‚¨è¿˜å¯ä»¥é€šè¿‡ç‚¹å‡»å…¶ä»–é¡µé¢ URL æ¥æŸ¥çœ‹æ‰€æœ‰é¡µé¢ã€‚\néšåå¯¹å…¶ä»–è§’è‰²ä¹Ÿé‡å¤ä¸Šè¿°æ­¥éª¤å¹¶æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å¯ä»¥æ ¹æ®æˆäºˆçš„è§’è‰²è®¿é—®è¯¥é¡µé¢ã€‚\nSpring Boot é¡¹ç›®å¦‚ä½•å®ç°å®‰å…¨æ€§ï¼Ÿ ï¼šSpring Boot 3.0 åŠä»¥ä¸Š Spring Boot 3.0 åœ¨ Spring Security æ¨¡å—ä¸­è¿›è¡Œäº†é‡å¤§ API çº§åˆ«æ›´æ”¹ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ Spring Boot 3.0 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œåˆ™éœ€è¦éµå¾ªä»¥ä¸‹æŒ‡å—ä»¥åŠä½¿ç”¨ JDK 17ã€‚\nåœ¨ SecurityConfig.java ä¸­ï¼š ä½¿ç”¨ authorizeHttpRequests()ä»£æ›¿ authorizeRequests()\nä½¿ç”¨ requestMatchers() ä»£æ›¿ antMatchers()\nä½¿ç”¨ RegexRequestMatchers() ä»£æ›¿ regexMatchers()\nåœ¨å®ä½“ç±»ä¸­ï¼š åœ¨ import è¯­å¥ä¸­ï¼Œä½¿ç”¨â€œjakartaâ€ä»£æ›¿â€œjavaxâ€ã€‚ä¾‹å¦‚ï¼šä½¿ç”¨â€œjakarta.persistence.Entity;â€ä»£æ›¿â€œjavax.persistence.Entity;â€ã€‚ FAQ å¦‚ä½•ç¦ç”¨åº”ç”¨ç¨‹åºçš„å®‰å…¨åŠŸèƒ½ï¼Ÿ åŒæ ·é‡è¦çš„æ˜¯ï¼Œæœ‰æ—¶æˆ‘ä»¬éœ€è¦ç¦ç”¨å®‰å…¨åŠŸèƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒä¸­ï¼Œä»¥é¿å…å†æ¬¡è¾“å…¥å‡­æ®ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç›¸åº”åœ°åœ¨ pom.xml æ–‡ä»¶ä¸­æ³¨é‡Šä»¥ä¸‹ä¸¤ä¸ªä¾èµ–é¡¹ã€‚\n\u0026lt;!-- \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-security\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-thymeleaf\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; --\u0026gt; æ¦‚æ‹¬ éšåï¼Œé€šè¿‡â€œå¦‚ä½•åœ¨ Spring Boot é¡¹ç›®ä¸­å®ç°å®‰å…¨æ€§ï¼Ÿâ€çš„æ‰€æœ‰ç†è®ºå’Œç¤ºä¾‹éƒ¨åˆ†ï¼Œæœ€åï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨ Spring Boot é¡¹ç›®ä¸­å®ç° Web å®‰å…¨æ€§ã€‚å½“ç„¶ï¼Œåœ¨æœ¬æ–‡ä¸­æˆ‘ä»¬ä»‹ç»äº†ä¸¤ç§å®ç°å®‰å…¨åŠŸèƒ½çš„æ–¹æ³•ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¦ä¸€ç¯‡æ–‡ç« ä¸­äº†è§£ UserDetailsSâ€‹â€‹erviceï¼ˆå®ç°å®‰å…¨æ€§çš„ç¬¬ä¸‰ç§æ–¹å¼ï¼‰ã€‚æ­¤å¤–ï¼Œæœ‰å…³ Spring Boot Security çš„å®Œæ•´æ•™ç¨‹è¯·è®¿é—®æ­¤å¤„ã€‚åç»­å¦‚æœ‰æ›´æ–°ï¼Œæˆ‘ä»¬ä¹Ÿä¼šåŠæ—¶æ›´æ–°ã€‚ä¹Ÿè¯·éšæ—¶åœ¨ä¸‹é¢çš„è¯„è®ºéƒ¨åˆ†æä¾›æ‚¨çš„æ„è§ã€‚\nåŸæ–‡é“¾æ¥ï¼šhttps://javatechonline.com/how-to-implement-security-in-spring-boot-project/\n","permalink":"https://blog.chensoul.cc/posts/2023/08/18/how-to-implement-security-in-spring-boot-project/","summary":"å¦‚ä»Šï¼Œå‡ ä¹æ¯ä¸ªå®¢æˆ·éƒ½è¦æ±‚åœ¨å®æ—¶åº”ç”¨ç¨‹åºä¸­å®ç°å¼ºå¤§çš„å®‰å…¨åŠŸèƒ½ã€‚å®‰å…¨åŠŸèƒ½å¯¹äºä¿æŒæœºå¯†æ€§ã€å®Œæ•´æ€§å’Œå¯ç”¨æ€§çš„éœ€æ±‚æ˜¯éå¸¸æœ‰æ•ˆçš„ã€‚ç°å®ä¸–ç•Œä¸­æœ‰å¾ˆå¤šç±»å‹çš„å®‰å…¨æ€§ï¼Œä½†æˆ‘ä»¬ä½œä¸ºå¼€å‘äººå‘˜å°†é‡ç‚¹å…³æ³¨åº”ç”¨ç¨‹åº/è½¯ä»¶å®‰å…¨æ€§ã€‚\næ­¤å¤–ï¼Œåœ¨åº”ç”¨ç¨‹åºå®‰å…¨æ–¹é¢ï¼Œæˆ‘ä»¬çš„å·¥ä½œåŸºæœ¬ä¸Šæ˜¯ç¡®ä¿ä¸¤ä»¶äº‹ã€‚é¦–å…ˆï¼Œåªæœ‰æœ‰æ•ˆçš„ç”¨æˆ·æ‰èƒ½è®¿é—®è¯¥åº”ç”¨ç¨‹åºã€‚å…¶æ¬¡ï¼Œå¦‚æœç”¨æˆ·æœ‰æ•ˆï¼Œä»–/å¥¹åªèƒ½è®¿é—®è¯¥åº”ç”¨ç¨‹åºä¸­å…è®¸çš„æ•°æ®/ä¿¡æ¯ã€‚æˆ‘è®¤ä¸ºï¼Œæ²¡æœ‰ä»€ä¹ˆå¯ä»¥è§£é‡Šå®ƒä»¬ï¼Œå› ä¸ºæ‚¨å¿…é¡»å·²ç»äº†è§£è¿™ä¸¤ä¸ªæœ¯è¯­ï¼Œå³èº«ä»½éªŒè¯å’Œæˆæƒã€‚\næ‚¨å¯èƒ½å·²ç»çŒœåˆ°æˆ‘ä»¬å°†åœ¨å½“å‰ä¸»é¢˜â€œå¦‚ä½•åœ¨ Spring Boot é¡¹ç›®ä¸­å®ç°å®‰å…¨æ€§ï¼Ÿâ€ä¸­è®¨è®ºä»€ä¹ˆå†…å®¹ã€‚\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä»åŸºæœ¬åŸç†å¼€å§‹å­¦ä¹ ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†é€æ­¥ç»“æŸå®ƒï¼Œç›´åˆ°æˆ‘ä»¬æœ‰ä¿¡å¿ƒåœ¨ Spring Boot åº”ç”¨ç¨‹åºä¸­å®ç°å®‰å…¨åŠŸèƒ½ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬å¼€å§‹é€æ­¥è®¨è®ºâ€œå¦‚ä½•åœ¨ Spring Boot é¡¹ç›®ä¸­å®ç°å®‰å…¨æ€§ï¼Ÿâ€ã€‚ Spring Boot æ•™ç¨‹é¡µé¢ä¸Šæœ‰ä¸€ç³»åˆ—æœ‰å…³ Spring Boot Security çš„æ•™ç¨‹ã€‚\næˆ‘ä»¬åœ¨æœ¬æ–‡ä¸­ä»‹ç»äº†ä¸¤ä¸ªç‰ˆæœ¬çš„â€œå¦‚ä½•åœ¨ Spring Boot é¡¹ç›®ä¸­å®ç°å®‰å…¨æ€§ï¼Ÿâ€çš„ç¤ºä¾‹ï¼šä½¿ç”¨ WebSecurityConfigurerAdapter å’Œä¸ä½¿ç”¨ WebSecurityConfigurerAdapterã€‚æ­¤å¤–ï¼Œè¿˜æ¶µç›–äº†ä½¿ç”¨ Spring Boot 3.0 åŠæ›´é«˜ç‰ˆæœ¬çš„â€œå¦‚ä½•åœ¨ Spring Boot é¡¹ç›®ä¸­å®ç°å®‰å…¨æ€§ï¼Ÿâ€çš„ç¤ºä¾‹ã€‚\næ‚¨å°†ä»æœ¬æ–‡ä¸­å­¦åˆ°ä»€ä¹ˆï¼Ÿ ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦åœ¨ Spring Boot åº”ç”¨ç¨‹åºä¸­å®ç°å®‰å…¨æ€§ï¼Ÿ\nSecurity åœ¨ Spring Boot åº”ç”¨ç¨‹åºå†…éƒ¨å¦‚ä½•å·¥ä½œï¼Ÿ\njavax.servlet.Filter åœ¨ Spring Boot åº”ç”¨ç¨‹åºä¸­å®ç°å®‰å…¨æ€§æ–¹é¢çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ\nSpring Boot é¡¹ç›®ä¸­ä½¿ç”¨äº†å¤šå°‘ç§æˆæƒç±»å‹ï¼Ÿ\nSpring Boot é¡¹ç›®ä¸­æœ‰å¤šå°‘ç§å®ç°å®‰å…¨æ€§çš„æ–¹æ³•ï¼Ÿ\nåœ¨ Spring Boot é¡¹ç›®ä¸­å®ç° WebSecurity çš„æ­¥éª¤æ˜¯ä»€ä¹ˆï¼Ÿ\nå¦å¤–ï¼Œå¦‚ä½•åœ¨ Spring Boot é¡¹ç›®ä¸­ä½¿ç”¨@EnableWebSecurityã€@Configurationã€@Beanï¼Ÿ\nå¦‚ä½•å®ç°å†…å­˜ä¸­èº«ä»½éªŒè¯å®‰å…¨ç¤ºä¾‹\nå¦‚ä½•å®ç° JDBC è®¤è¯å®‰å…¨ç¤ºä¾‹\nå¦‚ä½•åœ¨ Spring Boot é¡¹ç›®ä¸­ä½¿ç”¨ Thymeleaf ï¼Ÿ\nå¦‚ä½•æµ‹è¯•å¯ç”¨å®‰å…¨çš„åŠŸèƒ½ï¼Ÿ\nç›¸åï¼Œå¦‚ä½•ç¦ç”¨åº”ç”¨ç¨‹åºçš„å®‰å…¨åŠŸèƒ½ï¼Ÿ\næœ€åä½†å¹¶éæœ€ä¸é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œæ‚¨å°†å­¦ä¹ â€œå¦‚ä½•åœ¨ Spring Boot é¡¹ç›®ä¸­å®ç°å®‰å…¨æ€§ï¼Ÿâ€ä½¿ç”¨ WebSecurityConfigurerAdapter å’Œä¸ä½¿ç”¨ WebSecurityConfigurerAdapterã€‚\nä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦åº”ç”¨ç¨‹åºä¸­çš„å®‰å…¨æ€§ï¼Ÿ ç°åœ¨ï¼Œéšç€æ¶æ„æ”»å‡»å°†é‡ç‚¹ä»æ“ä½œç³»ç»Ÿå’Œç½‘ç»œè½¬ç§»åˆ°åº”ç”¨ç¨‹åº/è½¯ä»¶å’Œç§»åŠ¨è®¾å¤‡/è®¾å¤‡ï¼Œä¸€å¤©çš„æ•°æ®é¢ä¸´æœ€å¤§çš„é£é™©ã€‚æ­¤å¤–ï¼Œä»ä¸šåŠ¡/å®¢æˆ·çš„è§’åº¦æ¥çœ‹ï¼Œåº”ç”¨ç¨‹åºå®‰å…¨åœ¨ç»´æŠ¤ä¿¡ä»»ã€å»ºç«‹å“ç‰Œå½¢è±¡å’Œé™ä½é£é™©æ–¹é¢å‘æŒ¥ç€é‡è¦ä½œç”¨ã€‚äº‹å®ä¸Šï¼Œæ²¡æœ‰å…¶ä¸­ä»»ä½•ä¸€é¡¹ï¼Œéƒ½æ— æ³•æƒ³è±¡ä¸€å®¶æˆåŠŸçš„ä¼ä¸šã€‚\næ€»ä¹‹ï¼Œæ— è®ºæ‚¨æ˜¯ä¸ºäº†å†…éƒ¨ä½¿ç”¨ã€é”€å”®ç›®çš„è¿˜æ˜¯è´­ä¹°ç›®çš„è€Œåˆ›å»ºåº”ç”¨ç¨‹åºï¼Œå®‰å…¨æ€§éƒ½æ˜¯æ¯ä¸ªåº”ç”¨ç¨‹åºæœ€é‡è¦çš„åŠŸèƒ½ã€‚\næ ¹æ®æœ€æ–°çš„ 2020 å¹´ Verizon æ•°æ®æ³„éœ²è°ƒæŸ¥æŠ¥å‘Šï¼Œæ‰€æœ‰æ•°æ®æ³„éœ²ä¸­æœ‰ 43% æ˜¯é’ˆå¯¹ Web åº”ç”¨ç¨‹åºçš„æ”»å‡»ã€‚è¿™ä¸€æ•°å­—æ¯” 2019 å¹´å¢åŠ äº†ä¸€å€ã€‚æ­¤å¤–ï¼Œ86% çš„è¿è§„è¡Œä¸ºéƒ½æ˜¯å‡ºäºç»æµåŠ¨æœºã€‚","title":"[è¯‘]Spring Booté¡¹ç›®å¦‚ä½•å®ç°Securityï¼Ÿ"},{"content":"Spring Security æ˜¯ä¸€ä¸ªæœ‰åŠ©äºä¿æŠ¤ä¼ä¸šåº”ç”¨ç¨‹åºå®‰å…¨çš„æ¡†æ¶ã€‚é€šè¿‡ä¸ Spring MVCã€Spring Webflux æˆ– Spring Boot é›†æˆï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå¼ºå¤§ä¸”é«˜åº¦å¯å®šåˆ¶çš„èº«ä»½éªŒè¯å’Œè®¿é—®æ§åˆ¶æ¡†æ¶ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è§£é‡Šæ ¸å¿ƒæ¦‚å¿µå¹¶ä»”ç»†ç ”ç©¶ Spring Security æä¾›çš„é»˜è®¤é…ç½®åŠå…¶å·¥ä½œåŸç†ã€‚æˆ‘ä»¬å°†è¿›ä¸€æ­¥å°è¯•è‡ªå®šä¹‰å®ƒä»¬å¹¶åˆ†æå®ƒä»¬å¯¹ç¤ºä¾‹ Spring Boot åº”ç”¨ç¨‹åºçš„å½±å“ã€‚\nç¤ºä¾‹ä»£ç  æœ¬æ–‡é™„æœ‰ GitHub ä¸Šçš„å·¥ä½œä»£ç ç¤ºä¾‹ã€‚\nåˆ›å»ºç¤ºä¾‹åº”ç”¨ç¨‹åº è®©æˆ‘ä»¬ä»å¤´å¼€å§‹æ„å»ºä¸€ä¸ª Spring Boot åº”ç”¨ç¨‹åºï¼Œçœ‹çœ‹ spring å¦‚ä½•é…ç½®å’Œæä¾›å®‰å…¨æ€§ã€‚è®©æˆ‘ä»¬ä» spring starter åˆ›å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºå¹¶æ·»åŠ æ‰€éœ€çš„æœ€å°‘ä¾èµ–é¡¹ã€‚\nç”Ÿæˆé¡¹ç›®åï¼Œæˆ‘ä»¬å°†å…¶å¯¼å…¥åˆ° IDE ä¸­å¹¶å°†å…¶é…ç½®ä¸ºåœ¨ç«¯å£ 8083 ä¸Šè¿è¡Œã€‚\nmvnw clean verify spring-boot:run (for Windows) ./mvnw clean verify spring-boot:run (for Linux) åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥çœ‹åˆ°ä¸€ä¸ªç™»å½•é¡µé¢ã€‚\næ§åˆ¶å°æ—¥å¿—æ‰“å°ä½œä¸ºé»˜è®¤å®‰å…¨é…ç½®çš„ä¸€éƒ¨åˆ†éšæœºç”Ÿæˆçš„é»˜è®¤å¯†ç ï¼š\nä½¿ç”¨é»˜è®¤ç”¨æˆ·å user å’Œé»˜è®¤å¯†ç ï¼ˆæ¥è‡ªæ—¥å¿—ï¼‰ï¼Œæˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿç™»å½•è¯¥åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬å¯ä»¥åœ¨ application.yml ä¸­è¦†ç›–è¿™äº›é»˜è®¤å€¼ï¼š\nspring: security: user: name: admin password: passw@rd ç°åœ¨ï¼Œæˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿä½¿ç”¨ç”¨æˆ· admin å’Œå¯†ç  passw@rd ç™»å½•ã€‚\nä¾èµ–ç‰ˆæœ¬ åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Spring Boot 2.7.5 ç‰ˆæœ¬ã€‚åŸºäºæ­¤ç‰ˆæœ¬ï¼ŒSpring Boot å†…éƒ¨å°† Spring Security ç‰ˆæœ¬è§£æä¸º 5.7.4ã€‚ä½†æ˜¯ï¼Œå¦‚æœéœ€è¦ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ pom.xml ä¸­è¦†ç›–è¿™äº›ç‰ˆæœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\u0026lt;properties\u0026gt; \u0026lt;spring-security.version\u0026gt;5.2.5.RELEASE\u0026lt;/spring-security.version\u0026gt; \u0026lt;/properties\u0026gt; äº†è§£å®‰å…¨ç»„ä»¶ è¦äº†è§£é»˜è®¤é…ç½®çš„å·¥ä½œåŸç†ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ä»¥ä¸‹å†…å®¹ï¼š\nServlet Filters è¿‡æ»¤å™¨ Authentication è®¤è¯ Authorization æˆæƒ Servlet Filters è®©æˆ‘ä»¬ä»”ç»†çœ‹çœ‹åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶çš„æ§åˆ¶å°æ—¥å¿—ã€‚æˆ‘ä»¬çœ‹åˆ° DefaultSecurityFilterChain åœ¨è¯·æ±‚åˆ°è¾¾ DispatcherServlet ä¹‹å‰è§¦å‘ä¸€ç³»åˆ—è¿‡æ»¤å™¨ã€‚ DispatcherServlet æ˜¯ Web æ¡†æ¶ä¸­çš„å…³é”®ç»„ä»¶ï¼Œç”¨äºå¤„ç†ä¼ å…¥çš„ Web è¯·æ±‚å¹¶å°†å®ƒä»¬åˆ†æ´¾åˆ°é€‚å½“çš„å¤„ç†ç¨‹åºè¿›è¡Œå¤„ç†ã€‚\no.s.s.web.DefaultSecurityFilterChain : Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@2fd954f, org.springframework.security.web.context.request.async. WebAsyncManagerIntegrationFilter@5731d3a, org.springframework.security.web.context.SecurityContextPersistenceFilter@5626d18c, org.springframework.security.web.header.HeaderWriterFilter@52b3bf03, org.springframework.security.web.csrf.CsrfFilter@30c4e352, org.springframework.security.web.authentication.logout.LogoutFilter@37ad042b, org.springframework.security.web.authentication. UsernamePasswordAuthenticationFilter@1e60b459, org.springframework.security.web.authentication.ui. DefaultLoginPageGeneratingFilter@29b40b3, org.springframework.security.web.authentication.ui. DefaultLogoutPageGeneratingFilter@6a0f2853, org.springframework.security.web.authentication.www. BasicAuthenticationFilter@254449bb, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@3dc95b8b, org.springframework.security.web.servletapi. SecurityContextHolderAwareRequestFilter@2d55e826, org.springframework.security.web.authentication. AnonymousAuthenticationFilter@1eff3cfb, org.springframework.security.web.session.SessionManagementFilter@462abec3, org.springframework.security.web.access.ExceptionTranslationFilter@6f8aba08, org.springframework.security.web.access.intercept. FilterSecurityInterceptor@7ce85af2] è¦äº†è§£ FilterChain çš„å·¥ä½œåŸç†ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ Spring Security æ–‡æ¡£ä¸­çš„æµç¨‹å›¾\nç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å‚ä¸è¿‡æ»¤å™¨é“¾çš„æ ¸å¿ƒç»„ä»¶ï¼š\nDelegatingFilterProxy Spring æä¾›çš„ä¸€ä¸ª servlet è¿‡æ»¤å™¨ï¼Œå……å½“ Servlet å®¹å™¨å’Œ Spring Application Context ä¹‹é—´çš„æ¡¥æ¢ã€‚ DelegatingFilterProxy ç±»è´Ÿè´£å°†ä»»ä½•å®ç° javax.servlet.Filter çš„ç±»è¿æ¥åˆ°è¿‡æ»¤å™¨é“¾ä¸­ã€‚ FilterChainProxy Spring å®‰å…¨æ€§åœ¨å†…éƒ¨åˆ›å»ºä¸€ä¸ªåä¸º springSecurityFilterChain çš„ FilterChainProxy beanï¼ŒåŒ…è£…åœ¨ DelegatingFilterProxy ä¸­ã€‚ FilterChainProxy æ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œå®ƒæ ¹æ®å®‰å…¨é…ç½®é“¾æ¥å¤šä¸ªè¿‡æ»¤å™¨ã€‚å› æ­¤ï¼Œ DelegatingFilterProxy å°†è¯·æ±‚å§”æ‰˜ç»™ FilterChainProxy ï¼Œåè€…ç¡®å®šè¦è°ƒç”¨çš„è¿‡æ»¤å™¨ã€‚ SecurityFilterChain: SecurityFilterChain ä¸­çš„å®‰å…¨è¿‡æ»¤å™¨æ˜¯ç”¨ FilterChainProxy æ³¨å†Œçš„ beanã€‚ä¸€ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥æœ‰å¤šä¸ª SecurityFilterChain ã€‚ FilterChainProxy ä½¿ç”¨ HttpServletRequest ä¸Šçš„ RequestMatcher æ¥å£æ¥ç¡®å®šéœ€è¦è°ƒç”¨å“ªä¸ª SecurityFilterChain ã€‚ Spring Security Chain è¡¥å……è¯´æ˜ Spring Boot åº”ç”¨ç¨‹åºä¸­çš„é»˜è®¤åå¤‡è¿‡æ»¤å™¨é“¾æœ‰ä¸€ä¸ªè¯·æ±‚åŒ¹é…å™¨ /** ï¼Œè¿™æ„å‘³ç€å®ƒå°†åº”ç”¨äºæ‰€æœ‰è¯·æ±‚ã€‚ é»˜è®¤è¿‡æ»¤å™¨é“¾å…·æœ‰é¢„å®šä¹‰çš„ @Order SecurityProperties.BASIC_AUTH_ORDERã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½® security.basic.enabled=false æ¥æ’é™¤è¿™ä¸ªå®Œæ•´çš„è¿‡æ»¤å™¨é“¾ã€‚ æˆ‘ä»¬å¯ä»¥å®šä¹‰å¤šä¸ªè¿‡æ»¤å™¨é“¾çš„é¡ºåºã€‚ä¾‹å¦‚ï¼Œè¦åœ¨é»˜è®¤è¿‡æ»¤å™¨é“¾ä¹‹å‰è°ƒç”¨è‡ªå®šä¹‰è¿‡æ»¤å™¨é“¾ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®è¾ƒä½çš„ @Order ã€‚ç¤ºä¾‹ @Order(SecurityProperties.BASIC_AUTH_ORDER - 10) ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ FilterRegistrationBean æˆ–æ‰©å±• OncePerRequestFilter åœ¨ç°æœ‰è¿‡æ»¤å™¨é“¾ä¸­æ’å…¥è‡ªå®šä¹‰è¿‡æ»¤å™¨ï¼ˆéšæ—¶è°ƒç”¨æˆ–é’ˆå¯¹ç‰¹å®š URL æ¨¡å¼è°ƒç”¨ï¼‰ã€‚ å¯¹äºå®šä¹‰çš„è‡ªå®šä¹‰è¿‡æ»¤å™¨ï¼Œå¦‚æœæœªæŒ‡å®š@Orderï¼Œåˆ™å®ƒæ˜¯å®‰å…¨é“¾ä¸­çš„æœ€åä¸€ä¸ªã€‚ ï¼ˆå…·æœ‰é»˜è®¤é¡ºåº LOWEST_PRECEDENCE ã€‚ï¼‰ æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨æ–¹æ³• addFilterAfter() ã€ addFilterAt() å’Œ addFilterBefore() æ¥æ›´å¥½åœ°æ§åˆ¶æˆ‘ä»¬å®šä¹‰çš„è‡ªå®šä¹‰è¿‡æ»¤å™¨çš„é¡ºåºã€‚ æˆ‘ä»¬å°†åœ¨åé¢çš„éƒ¨åˆ†ä¸­å®šä¹‰è‡ªå®šä¹‰è¿‡æ»¤å™¨å’Œè¿‡æ»¤å™¨é“¾ã€‚\nç°åœ¨æˆ‘ä»¬çŸ¥é“ Spring Security ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªé»˜è®¤çš„è¿‡æ»¤å™¨é“¾ï¼Œå®ƒè°ƒç”¨ä¸€ç»„é¢„å®šä¹‰ä¸”æœ‰åºçš„è¿‡æ»¤å™¨ï¼Œè®©æˆ‘ä»¬å°è¯•ç®€è¦äº†è§£é“¾ä¸­å‡ ä¸ªé‡è¦è¿‡æ»¤å™¨çš„è§’è‰²ã€‚\norg.springframework.security.web.csrf.CsrfFilter : æ­¤è¿‡æ»¤å™¨é»˜è®¤å°† CSRF ä¿æŠ¤åº”ç”¨äºæ‰€æœ‰ REST ç«¯ç‚¹ã€‚è¦è¯¦ç»†äº†è§£ Spring Boot å’Œ Spring Security ä¸­çš„ CSRF åŠŸèƒ½ï¼Œè¯·å‚è€ƒè¿™ç¯‡æ–‡ç« ã€‚ org.springframework.security.web.authentication.logout.LogoutFilter : å½“ç”¨æˆ·æ³¨é”€åº”ç”¨ç¨‹åºæ—¶è°ƒç”¨æ­¤è¿‡æ»¤å™¨ã€‚è°ƒç”¨é»˜è®¤æ³¨å†Œçš„ LogoutHandler å®ä¾‹ï¼Œè´Ÿè´£ä½¿ä¼šè¯æ— æ•ˆå¹¶æ¸…é™¤ SecurityContext ã€‚æ¥ä¸‹æ¥ï¼Œ LogoutSuccessHandler çš„é»˜è®¤å®ç°å°†ç”¨æˆ·é‡å®šå‘åˆ°æ–°é¡µé¢ ( /login?logout )ã€‚ org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter : ä½¿ç”¨å¯åŠ¨æ—¶æä¾›çš„é»˜è®¤å‡­æ®éªŒè¯ URL ( /login ) çš„ç”¨æˆ·åå’Œå¯†ç ã€‚ org.springframework.security.web.authentication.ui.DefaultLoginPageGeneratingFilter : åœ¨ /login å¤„ç”Ÿæˆé»˜è®¤ç™»å½•é¡µé¢ html org.springframework.security.web.authentication.ui.DefaultLogoutPageGeneratingFilter : åœ¨ /login?logout å¤„ç”Ÿæˆé»˜è®¤æ³¨é”€é¡µé¢ html org.springframework.security.web.authentication.www.BasicAuthenticationFilter : æ­¤è¿‡æ»¤å™¨è´Ÿè´£å¤„ç†ä»»ä½•å…·æœ‰æˆæƒã€åŸºæœ¬èº«ä»½éªŒè¯æ–¹æ¡ˆã€Base64 ç¼–ç çš„ç”¨æˆ·åå¯†ç çš„ HTTP è¯·æ±‚æ ‡å¤´çš„è¯·æ±‚ã€‚èº«ä»½éªŒè¯æˆåŠŸåï¼Œ Authentication å¯¹è±¡å°†è¢«æ”¾ç½®åœ¨ SecurityContextHolder ä¸­ã€‚ org.springframework.security.web.authentication.AnonymousAuthenticationFilter : å¦‚æœåœ¨ SecurityContext ä¸­æ‰¾ä¸åˆ° Authentication å¯¹è±¡ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªå…·æœ‰ä¸»ä½“ anonymousUser å’Œè§’è‰²ã€‚ org.springframework.security.web.access.ExceptionTranslationFilter :å¤„ç†è¿‡æ»¤å™¨é“¾ä¸­æŠ›å‡ºçš„ AccessDeniedException å’Œ AuthenticationException ã€‚å¯¹äº AuthenticationException ï¼Œéœ€è¦ AuthenticationEntryPoint å®ä¾‹æ¥å¤„ç†å“åº”ã€‚å¯¹äº AccessDeniedException ï¼Œæ­¤è¿‡æ»¤å™¨å°†å§”æ‰˜ç»™ AccessDeniedHandler ï¼Œå…¶é»˜è®¤å®ç°ä¸º AccessDeniedHandlerImpl ã€‚ org.springframework.security.web.access.intercept.FilterSecurityInterceptor : æ­¤è¿‡æ»¤å™¨è´Ÿè´£åœ¨è¯·æ±‚åˆ°è¾¾æ§åˆ¶å™¨ä¹‹å‰å¯¹é€šè¿‡è¿‡æ»¤å™¨é“¾çš„æ¯ä¸ªè¯·æ±‚è¿›è¡Œæˆæƒã€‚ Authentication èº«ä»½éªŒè¯æ˜¯éªŒè¯ç”¨æˆ·å‡­æ®å¹¶ç¡®ä¿å…¶æœ‰æ•ˆæ€§çš„è¿‡ç¨‹ã€‚è®©æˆ‘ä»¬äº†è§£ä¸€ä¸‹ spring æ¡†æ¶å¦‚ä½•éªŒè¯åˆ›å»ºçš„é»˜è®¤å‡­æ®ï¼š\næ­¥éª¤ 1ï¼šå½“å¯ç”¨ FormLogin æ—¶ï¼Œå³å‘ URL /login å‘å‡ºè¯·æ±‚æ—¶ï¼Œ UsernamePasswordAuthenticationFilter è¢«è°ƒç”¨ä½œä¸ºå®‰å…¨è¿‡æ»¤å™¨é“¾çš„ä¸€éƒ¨åˆ†ã€‚è¯¥ç±»æ˜¯åŸºç±» AbstractAuthenticationProcessingFilter çš„å…·ä½“å®ç°ã€‚å½“å°è¯•è¿›è¡Œèº«ä»½éªŒè¯æ—¶ï¼Œè¿‡æ»¤å™¨ä¼šå°†è¯·æ±‚è½¬å‘åˆ° AuthenticationManager ã€‚\næ­¥éª¤ 2ï¼š UsernamePasswordAuthenticationToken æ˜¯ Authentication æ¥å£çš„å®ç°ã€‚æ­¤ç±»æŒ‡å®šèº«ä»½éªŒè¯æœºåˆ¶å¿…é¡»é€šè¿‡ç”¨æˆ·å-å¯†ç è¿›è¡Œã€‚\næ­¥éª¤ 3ï¼šè·å¾—èº«ä»½éªŒè¯è¯¦ç»†ä¿¡æ¯åï¼Œ AuthenticationManager å°è¯•åœ¨ AuthenticationProvider çš„é€‚å½“å®ç°å’Œç»è¿‡å®Œå…¨èº«ä»½éªŒè¯çš„ Authentication å¯¹è±¡çš„å¸®åŠ©ä¸‹å¯¹è¯·æ±‚è¿›è¡Œèº«ä»½éªŒè¯è¢«è¿”å›ã€‚é»˜è®¤å®ç°æ˜¯ DaoAuthenticationProvider ï¼Œå®ƒä» UserDetailsService æ£€ç´¢ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ã€‚å¦‚æœèº«ä»½éªŒè¯å¤±è´¥ï¼Œåˆ™æŠ›å‡º AuthenticationException ã€‚\næ­¥éª¤ 4ï¼š UserDetailsService çš„ loadUserByUsername(username) æ–¹æ³•è¿”å›åŒ…å«ç”¨æˆ·æ•°æ®çš„ UserDetails å¯¹è±¡ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°å…·æœ‰ç»™å®šç”¨æˆ·åçš„ç”¨æˆ·ï¼Œåˆ™æŠ›å‡º UsernameNotFoundException ã€‚\næ­¥éª¤ 5ï¼šèº«ä»½éªŒè¯æˆåŠŸåï¼Œ SecurityContext å°†æ›´æ–°ä¸ºå½“å‰ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ã€‚\nä¸ºäº†ç†è§£ä¸Šé¢æ¦‚è¿°çš„æ­¥éª¤ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ Spring Security æ–‡æ¡£ä¸­å®šä¹‰çš„èº«ä»½éªŒè¯æ¶æ„ã€‚\nProviderManager æ˜¯ AuthenticationManager æœ€å¸¸è§çš„å®ç°ã€‚å¦‚å›¾æ‰€ç¤ºï¼Œ ProviderManager å°†è¯·æ±‚å§”æ‰˜ç»™å·²é…ç½®çš„ AuthenticationProvider åˆ—è¡¨ï¼Œæ¯ä¸ªåˆ—è¡¨éƒ½ä¼šè¢«æŸ¥è¯¢ä»¥æŸ¥çœ‹æ˜¯å¦å¯ä»¥æ‰§è¡Œèº«ä»½éªŒè¯ã€‚å¦‚æœè®¤è¯å¤±è´¥ï¼Œè¿”å› ProviderNotFoundException ï¼Œè¿™æ˜¯ AuthenticationException çš„ç‰¹æ®Šç±»å‹ï¼Œè¯´æ˜ ProviderManager ä¸æ”¯æŒ Authentication\nAuthenticationEntryPoint æ˜¯ä¸€ä¸ªå……å½“èº«ä»½éªŒè¯å…¥å£ç‚¹çš„æ¥å£ï¼Œç”¨äºç¡®å®šå®¢æˆ·ç«¯åœ¨è¯·æ±‚èµ„æºæ—¶æ˜¯å¦åŒ…å«æœ‰æ•ˆçš„å‡­æ®ã€‚å¦‚æœæ²¡æœ‰ï¼Œåˆ™ä½¿ç”¨è¯¥æ¥å£çš„é€‚å½“å®ç°æ¥å‘å®¢æˆ·ç«¯è¯·æ±‚å‡­è¯ã€‚\nç°åœ¨ï¼Œè®©æˆ‘ä»¬äº†è§£ Authentication å¯¹è±¡å¦‚ä½•ç»‘å®šæ•´ä¸ªèº«ä»½éªŒè¯è¿‡ç¨‹ã€‚ Authentication æ¥å£æœ‰ä»¥ä¸‹ç”¨é€”ï¼š\nå‘ AuthenticationManager æä¾›ç”¨æˆ·å‡­æ®ã€‚ ä»£è¡¨ SecurityContext ä¸­å½“å‰ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ã€‚ Authentication çš„æ¯ä¸ªå®ä¾‹éƒ½å¿…é¡»åŒ…å« principal - è¿™æ˜¯æ ‡è¯†ç”¨æˆ·çš„ UserDetails å®ä¾‹ã€‚ credentials - å‡­è¯ authorities - GrantedAuthority GrantedAuthority çš„å®ä¾‹åœ¨æˆæƒè¿‡ç¨‹ä¸­å‘æŒ¥ç€é‡è¦ä½œç”¨ã€‚ å…³äº Spring èº«ä»½éªŒè¯çš„é™„åŠ è¯´æ˜ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦åœ¨å•ç‹¬æˆæƒçš„æƒ…å†µä¸‹ä½¿ç”¨ Spring Securityï¼Œå› ä¸ºåœ¨è®¿é—®æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¹‹å‰å®ƒå·²ç»ç”±å¤–éƒ¨ç³»ç»Ÿè¿›è¡Œäº†å¯é çš„èº«ä»½éªŒè¯ã€‚è¯·å‚é˜…é¢„è®¤è¯æ–‡æ¡£äº†è§£å¦‚ä½•é…ç½®å’Œå¤„ç†æ­¤ç±»åœºæ™¯ã€‚ Spring å…è®¸é€šè¿‡å¤šç§æ–¹å¼æ¥å®šåˆ¶èº«ä»½éªŒè¯æœºåˆ¶ï¼Œæˆ‘ä»¬å°†åœ¨åé¢çš„éƒ¨åˆ†ä¸­ä»‹ç»å…¶ä¸­çš„å‡ ç§ã€‚ Authorization æˆæƒ æˆæƒæ˜¯ç¡®ä¿è®¿é—®èµ„æºçš„ç”¨æˆ·æˆ–ç³»ç»Ÿå…·æœ‰æœ‰æ•ˆæƒé™çš„è¿‡ç¨‹ã€‚\nåœ¨ Spring security è¿‡æ»¤å™¨é“¾ä¸­ï¼Œ FilterSecurityInterceptor è§¦å‘æˆæƒæ£€æŸ¥ã€‚ä»è¿‡æ»¤å™¨çš„æ‰§è¡Œé¡ºåºå¯ä»¥çœ‹å‡ºï¼Œè®¤è¯å…ˆäºæˆæƒè¿è¡Œã€‚è¯¥è¿‡æ»¤å™¨åœ¨ç”¨æˆ·æˆåŠŸé€šè¿‡èº«ä»½éªŒè¯åæ£€æŸ¥æœ‰æ•ˆæƒé™ã€‚å¦‚æœæˆæƒå¤±è´¥ï¼Œåˆ™ä¼šæŠ›å‡º AccessDeniedException ã€‚\næˆäºˆæƒé™ å¦‚ä¸Šä¸€èŠ‚æ‰€ç¤ºï¼Œæ¯ä¸ªç”¨æˆ·å®ä¾‹éƒ½åŒ…å«ä¸€ä¸ª GrantedAuthority å¯¹è±¡åˆ—è¡¨ã€‚ GrantedAuthority æ˜¯ä¸€ä¸ªå…·æœ‰å•ä¸€æ–¹æ³•çš„æ¥å£ï¼š\npublic interface GrantedAuthority extends Serializable { String getAuthority(); } Spring security é»˜è®¤æƒ…å†µä¸‹è°ƒç”¨å…·ä½“çš„ GrantedAuthority å®ç° SimpleGrantedAuthority ã€‚ SimpleGrantedAuthority å…è®¸æˆ‘ä»¬å°†è§’è‰²æŒ‡å®šä¸ºå­—ç¬¦ä¸²ï¼Œè‡ªåŠ¨å°†å®ƒä»¬æ˜ å°„åˆ° GrantedAuthority å®ä¾‹ä¸­ã€‚ AuthenticationManager è´Ÿè´£å°† GrantedAuthority å¯¹è±¡åˆ—è¡¨æ’å…¥åˆ° Authentication å¯¹è±¡ä¸­ã€‚ç„¶å AccessDecisionManager ä½¿ç”¨ getAuthority() æ¥å†³å®šæˆæƒæ˜¯å¦æˆåŠŸã€‚\næˆäºˆçš„æƒé™ä¸è§’è‰² Spring Security åˆ†åˆ«ä½¿ç”¨ hasAuthority() å’Œ hasRole() æ–¹æ³•é€šè¿‡æˆäºˆçš„æƒé™å’Œè§’è‰²æä¾›æˆæƒæ”¯æŒã€‚è¿™äº›æ–¹æ³•ç”¨äºåŸºäºè¡¨è¾¾å¼çš„å®‰å…¨æ€§ï¼Œå¹¶ä¸”æ˜¯æ¥å£ SecurityExpressionOperations çš„ä¸€éƒ¨åˆ†ã€‚å¯¹äºå¤§å¤šæ•°æƒ…å†µï¼Œè¿™ä¸¤ç§æ–¹æ³•å¯ä»¥äº’æ¢ä½¿ç”¨ï¼Œæœ€æ˜¾ç€çš„åŒºåˆ«æ˜¯ hasRole() ä¸éœ€è¦æŒ‡å®š ROLE å‰ç¼€ï¼Œè€Œ hasAuthority() éœ€è¦æ˜¾å¼æŒ‡å®šå®Œæ•´çš„å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œ hasAuthority(\u0026quot;ROLE_ADMIN\u0026quot;) å’Œ hasRole(\u0026quot;ADMIN\u0026quot;) æ‰§è¡Œç›¸åŒçš„ä»»åŠ¡ã€‚\nSpring æˆæƒçš„è¡¥å……è¯´æ˜ Spring å…è®¸æˆ‘ä»¬ä½¿ç”¨ @PreAuthorize å’Œ @PostAuthorize æ³¨é‡Šæ¥é…ç½®æ–¹æ³•çº§å®‰å…¨æ€§ã€‚æ­£å¦‚åç§°æ‰€ç¤ºï¼Œå®ƒä»¬å…è®¸æˆ‘ä»¬åœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰å’Œä¹‹åå¯¹ç”¨æˆ·è¿›è¡Œæˆæƒã€‚æˆæƒæ£€æŸ¥çš„æ¡ä»¶å¯ä»¥åœ¨ Spring è¡¨è¾¾å¼è¯­è¨€ (SpEL) ä¸­æŒ‡å®šã€‚æˆ‘ä»¬å°†åœ¨åé¢çš„éƒ¨åˆ†ä¸­æŸ¥çœ‹ä¸€äº›ç¤ºä¾‹ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡å…¬å¼€ GrantedAuthorityDefaults bean å°†æˆæƒè§„åˆ™é…ç½®ä¸ºä½¿ç”¨ä¸åŒçš„å‰ç¼€ï¼ˆ ROLE_ é™¤å¤–ï¼‰ã€‚ å¸¸è§æ¼æ´ä¿æŠ¤ é»˜è®¤çš„ spring security é…ç½®å¸¦æœ‰é»˜è®¤å¯ç”¨çš„é’ˆå¯¹å„ç§æ”»å‡»çš„ä¿æŠ¤åŠŸèƒ½ã€‚æˆ‘ä»¬ä¸ä¼šåœ¨æœ¬æ–‡ä¸­ä»‹ç»è¿™äº›ç»†èŠ‚ã€‚æ‚¨å¯ä»¥å‚è€ƒ Spring æ–‡æ¡£ä»¥è·å–è¯¦ç»†æŒ‡å—ã€‚ä½†æ˜¯ï¼Œè¦äº†è§£ CORS å’Œ CSRF ä¸Šçš„æ·±å…¥ Spring Security é…ç½®ï¼Œè¯·å‚é˜…ä»¥ä¸‹æ–‡ç« ï¼š\nCORS in Spring Security CSRF in Spring Security å®ç°å®‰å…¨é…ç½® ç°åœ¨æˆ‘ä»¬å·²ç»ç†Ÿæ‚‰äº† Spring Security å·¥ä½œåŸç†çš„ç»†èŠ‚ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬äº†è§£åº”ç”¨ç¨‹åºä¸­çš„é…ç½®è®¾ç½®ï¼Œä»¥å¤„ç†æˆ‘ä»¬åœ¨å‰é¢å‡ èŠ‚ä¸­ç®€è¦æåˆ°çš„å„ç§åœºæ™¯ã€‚\né»˜è®¤é…ç½® org.springframework.boot.autoconfigure.security.servlet åŒ…ä¸­çš„ SpringBootWebSecurityConfiguration ç±»ä¸º Spring Boot åº”ç”¨ç¨‹åºæä¾›äº†ä¸€ç»„é»˜è®¤çš„ Spring å®‰å…¨é…ç½®ã€‚è¯¥ç±»çš„åç¼–è¯‘ç‰ˆæœ¬å¦‚ä¸‹æ‰€ç¤ºï¼š\nclass SpringBootWebSecurityConfiguration { @ConditionalOnDefaultWebSecurity static class SecurityFilterChainConfiguration { SecurityFilterChainConfiguration() { } @Bean @Order(2147483642) SecurityFilterChain defaultSecurityFilterChain(HttpSecurity http) throws Exception { ((AuthorizedUrl) http.authorizeRequests().anyRequest()).authenticated(); http.formLogin(); http.httpBasic(); return (SecurityFilterChain) http.build(); } } } Spring ä½¿ç”¨ä¸Šè¿°é…ç½®æ¥åˆ›å»ºé»˜è®¤çš„ SecurityFilterChainBean ï¼š\nauthorizeRequests() åŸºäº RequestMatcher å®ç°é™åˆ¶è®¿é—®ã€‚è¿™é‡Œ authorizeRequests().anyRequest() å°†å…è®¸æ‰€æœ‰è¯·æ±‚ã€‚ä¸ºäº†æ›´å¥½åœ°æ§åˆ¶é™åˆ¶è®¿é—®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ antMatchers() æŒ‡å®š URL æ¨¡å¼ã€‚ authenticated() è¦æ±‚æ‰€æœ‰è°ƒç”¨çš„ç«¯ç‚¹åœ¨è¿›å…¥è¿‡æ»¤å™¨é“¾ä¹‹å‰éƒ½ç»è¿‡èº«ä»½éªŒè¯ã€‚ formLogin() è°ƒç”¨é»˜è®¤çš„ FormLoginConfigurer ç±»ï¼Œè¯¥ç±»åŠ è½½ç™»å½•é¡µé¢ä»¥é€šè¿‡ç”¨æˆ·åå¯†ç è¿›è¡Œèº«ä»½éªŒè¯ï¼Œå¹¶ç›¸åº”åœ°é‡å®šå‘åˆ°ç›¸åº”çš„å¤±è´¥æˆ–æˆåŠŸå¤„ç†ç¨‹åºã€‚æœ‰å…³è¡¨å•ç™»å½•å·¥ä½œåŸç†çš„å›¾ç¤ºï¼Œè¯·å‚é˜… Spring æ–‡æ¡£ä¸­çš„è¯¦ç»†è¯´æ˜ã€‚ httpBasic() è°ƒç”¨è®¾ç½®é»˜è®¤å€¼çš„ HttpBasicConfigurer ä»¥å¸®åŠ©è¿›è¡ŒåŸºæœ¬èº«ä»½éªŒè¯ã€‚è¯¦ç»†ç†è§£å¯ä»¥å‚è€ƒ Spring æ–‡æ¡£ã€‚ Spring Security ä¸ SecurityFilterChain ä» Spring Security 5.7.0-M2 å¼€å§‹ï¼Œ WebSecurityConfigurerAdapter å·²è¢«å¼ƒç”¨å¹¶æ›¿æ¢ä¸º SecurityFilterChain ï¼Œä»è€Œè¿›å…¥åŸºäºç»„ä»¶çš„å®‰å…¨é…ç½®ã€‚ è¦äº†è§£å·®å¼‚ï¼Œè¯·å‚é˜…è¿™ç¯‡ Spring åšå®¢æ–‡ç« ã€‚ æœ¬æ–‡ä¸­çš„æ‰€æœ‰ç¤ºä¾‹éƒ½å°†ä½¿ç”¨ä½¿ç”¨ SecurityFilterChain çš„è¾ƒæ–°é…ç½®ã€‚ å¸¸è§ç”¨ä¾‹ ç°åœ¨æˆ‘ä»¬äº†è§£äº† Spring Security é»˜è®¤å€¼çš„å·¥ä½œåŸç†ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€äº›åœºæ™¯å¹¶ç›¸åº”åœ°è‡ªå®šä¹‰é…ç½®ã€‚\n1. è‡ªå®šä¹‰é»˜è®¤é…ç½® @Configuration @EnableWebSecurity public class SecurityConfiguration { public static final String[] ENDPOINTS_WHITELIST = { \u0026#34;/css/**\u0026#34;, \u0026#34;/\u0026#34;, \u0026#34;/login\u0026#34;, \u0026#34;/home\u0026#34; }; public static final String LOGIN_URL = \u0026#34;/login\u0026#34;; public static final String LOGOUT_URL = \u0026#34;/logout\u0026#34;; public static final String LOGIN_FAIL_URL = LOGIN_URL + \u0026#34;?error\u0026#34;; public static final String DEFAULT_SUCCESS_URL = \u0026#34;/home\u0026#34;; public static final String USERNAME = \u0026#34;username\u0026#34;; public static final String PASSWORD = \u0026#34;password\u0026#34;; @Bean public SecurityFilterChain filterChain(HttpSecurity http) throws Exception { http.authorizeRequests(request -\u0026gt; request.antMatchers(ENDPOINTS_WHITELIST).permitAll() .anyRequest().authenticated()) .csrf().disable() .formLogin(form -\u0026gt; form .loginPage(LOGIN_URL) .loginProcessingUrl(LOGIN_URL) .failureUrl(LOGIN_FAIL_URL) .usernameParameter(USERNAME) .passwordParameter(PASSWORD) .defaultSuccessUrl(DEFAULT_SUCCESS_URL)); return http.build(); } } æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ç™»å½•çš„å„ä¸ªæ–¹é¢ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ spring security ç™»å½•é»˜è®¤è®¾ç½®ï¼š\nloginPage - è‡ªå®šä¹‰é»˜è®¤ç™»å½•é¡µé¢ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªè‡ªå®šä¹‰ login.html åŠå…¶ç›¸åº”çš„ LoginController ç±»ã€‚ loginProcessingUrl - éªŒè¯ç”¨æˆ·åå’Œå¯†ç çš„ URLã€‚ failureUrl - ç™»å½•å¤±è´¥æ—¶å®šå‘åˆ°çš„ URLã€‚ defaultSuccessUrl - æˆåŠŸç™»å½•åå®šå‘åˆ°çš„ URLã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªè‡ªå®šä¹‰ homePage.html åŠå…¶ç›¸åº”çš„ HomeController ç±»ã€‚ antMatchers() - è¿‡æ»¤æ‰å°†æˆä¸ºç™»å½•è¿‡ç¨‹ä¸€éƒ¨åˆ†çš„ URLã€‚ åŒæ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æ³¨é”€è¿‡ç¨‹ã€‚\n@Bean public SecurityFilterChain filterChain(HttpSecurity http) throws Exception { http.authorizeRequests(request -\u0026gt; request.antMatchers(ENDPOINTS_WHITELIST).permitAll() .anyRequest().authenticated()) .csrf().disable() .formLogin(form -\u0026gt; form .loginPage(LOGIN_URL) .loginProcessingUrl(LOGIN_URL) .failureUrl(LOGIN_FAIL_URL) .usernameParameter(USERNAME) .passwordParameter(PASSWORD) .defaultSuccessUrl(DEFAULT_SUCCESS_URL)) .logout(logout -\u0026gt; logout .logoutUrl(\u0026#34;/logout\u0026#34;) .invalidateHttpSession(true) .deleteCookies(\u0026#34;JSESSIONID\u0026#34;) .logoutSuccessUrl(LOGIN_URL + \u0026#34;?logout\u0026#34;)); return http.build(); } åœ¨è¿™é‡Œï¼Œå½“ç”¨æˆ·æ³¨é”€æ—¶ï¼Œhttp ä¼šè¯å°†å¤±æ•ˆï¼Œä½†ä¼šè¯ cookie ä¸ä¼šè¢«æ¸…é™¤ã€‚ä½¿ç”¨ deleteCookies(\u0026quot;JSESSIONID\u0026quot;) æœ‰åŠ©äºé¿å…åŸºäºä¼šè¯çš„å†²çªã€‚\næ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ Spring Security ç®¡ç†å’Œé…ç½®ä¼šè¯ã€‚\n@Bean public SecurityFilterChain filterChain(HttpSecurity http) throws Exception { http.authorizeRequests(request -\u0026gt; request.antMatchers(ENDPOINTS_WHITELIST).permitAll() .anyRequest().authenticated()) .csrf().disable() .formLogin(form -\u0026gt; form .loginPage(LOGIN_URL) .loginProcessingUrl(LOGIN_URL) .failureUrl(LOGIN_FAIL_URL) .usernameParameter(USERNAME) .passwordParameter(PASSWORD) .defaultSuccessUrl(DEFAULT_SUCCESS_URL)) .logout(logout -\u0026gt; logout .logoutUrl(\u0026#34;/logout\u0026#34;) .invalidateHttpSession(true) .deleteCookies(\u0026#34;JSESSIONID\u0026#34;) .logoutSuccessUrl(LOGIN_URL + \u0026#34;?logout\u0026#34;)) .sessionManagement(session -\u0026gt; session .sessionCreationPolicy(SessionCreationPolicy.ALWAYS) .invalidSessionUrl(\u0026#34;/invalidSession.htm\u0026#34;) .maximumSessions(1) .maxSessionsPreventsLogin(true)); return http.build(); } å®ƒä¸ºæˆ‘ä»¬æä¾›äº†ä»¥ä¸‹ä¼šè¯å±æ€§ sessionCreationPolicy å€¼ï¼š\nSessionCreationPolicy.STATELESS - ä¸ä¼šåˆ›å»ºæˆ–ä½¿ç”¨ä»»ä½•ä¼šè¯ã€‚ SessionCreationPolicy.ALWAYS - å¦‚æœä¼šè¯ä¸å­˜åœ¨ï¼Œåˆ™å§‹ç»ˆä¼šåˆ›å»ºè¯¥ä¼šè¯ã€‚ SessionCreationPolicy.NEVER - æ°¸è¿œä¸ä¼šåˆ›å»ºä¼šè¯ã€‚ä½†å¦‚æœä¼šè¯å­˜åœ¨ï¼Œå°±ä¼šä½¿ç”¨å®ƒã€‚ SessionCreationPolicy.IF_REQUIRED - å¦‚æœéœ€è¦ï¼Œå°†åˆ›å»ºä¼šè¯ã€‚ ï¼ˆé»˜è®¤é…ç½®ï¼‰ Other options include: å…¶ä»–é€‰é¡¹åŒ…æ‹¬ï¼š\ninvalidSessionUrl - æ£€æµ‹åˆ°æ— æ•ˆä¼šè¯æ—¶é‡å®šå‘åˆ°çš„ URLã€‚ maximumSessions - é™åˆ¶å•ä¸ªç”¨æˆ·å¯ä»¥åŒæ—¶æ‹¥æœ‰çš„æ´»åŠ¨ä¼šè¯æ•°ã€‚ maxSessionsPreventsLogin - é»˜è®¤å€¼ä¸º false ï¼Œè¡¨ç¤ºåœ¨ç°æœ‰ç”¨æˆ·çš„ä¼šè¯è¿‡æœŸæ—¶å…è®¸ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·è®¿é—®ã€‚ true è¡¨ç¤ºåˆ°è¾¾ SessionManagementConfigurer.maximumSessions(int) æ—¶ä¸ä¼šå¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“æ£€æµ‹åˆ°å¤šæ¬¡ç™»å½•æ—¶ï¼Œå®ƒå°†é‡å®šå‘åˆ° /invalidSession ã€‚ 2. é…ç½®å¤šä¸ªè¿‡æ»¤å™¨é“¾ Spring Security å…è®¸æˆ‘ä»¬æ‹¥æœ‰å¤šä¸ªå…±å­˜çš„å®‰å…¨é…ç½®ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿæ›´å¥½åœ°æ§åˆ¶åº”ç”¨ç¨‹åºã€‚ä¸ºäº†æ¼”ç¤ºè¿™ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬ä¸ºå›¾ä¹¦é¦†åº”ç”¨ç¨‹åºåˆ›å»º REST ç«¯ç‚¹ï¼Œè¯¥åº”ç”¨ç¨‹åºä½¿ç”¨ H2 æ•°æ®åº“æ ¹æ®ä½“è£å­˜å‚¨ä¹¦ç±ã€‚æˆ‘ä»¬çš„ BookController ç±»å°†æœ‰ä¸€ä¸ªç«¯ç‚¹å®šä¹‰å¦‚ä¸‹ï¼š\n@GetMapping(\u0026#34;/library/books\u0026#34;) public ResponseEntity\u0026lt;List\u0026lt;BookDto\u0026gt;\u0026gt; getBooks(@RequestParam String genre) { return ResponseEntity.ok().body(bookService.getBook(genre)); } ä¸ºäº†ä¿æŠ¤æ­¤ç«¯ç‚¹ï¼Œè®©æˆ‘ä»¬åœ¨ SecurityConfiguration ç±»ä¸­ä½¿ç”¨åŸºæœ¬èº«ä»½éªŒè¯å¹¶é…ç½®è¯¦ç»†ä¿¡æ¯ï¼š\n@Configuration @EnableWebSecurity @EnableConfigurationProperties(BasicAuthProperties.class) public class SecurityConfiguration { private final BasicAuthProperties props; public SecurityConfiguration(BasicAuthProperties props) { this.props = props; } @Bean @Order(1) public SecurityFilterChain bookFilterChain(HttpSecurity http) throws Exception { http .csrf().disable() .sessionManagement(session -\u0026gt; session .sessionCreationPolicy(SessionCreationPolicy.STATELESS)) .antMatcher(\u0026#34;/library/**\u0026#34;) .authorizeRequests() .antMatchers(HttpMethod.GET, \u0026#34;/library/**\u0026#34;).hasRole(\u0026#34;USER\u0026#34;) .anyRequest().authenticated() .and() .httpBasic() .and() .exceptionHandling(exception -\u0026gt; exception .authenticationEntryPoint(userAuthenticationErrorHandler()) .accessDeniedHandler(new UserForbiddenErrorHandler())); return http.build(); } @Bean public UserDetailsService userDetailsService() { return new InMemoryUserDetailsManager(props.getUserDetails()); } @Bean public AuthenticationEntryPoint userAuthenticationErrorHandler() { UserAuthenticationErrorHandler userAuthenticationErrorHandler = new UserAuthenticationErrorHandler(); userAuthenticationErrorHandler.setRealmName(\u0026#34;Basic Authentication\u0026#34;); return userAuthenticationErrorHandler; } public static final String[] ENDPOINTS_WHITELIST = { \u0026#34;/css/**\u0026#34;, \u0026#34;/login\u0026#34;, \u0026#34;/home\u0026#34; }; public static final String LOGIN_URL = \u0026#34;/login\u0026#34;; public static final String LOGIN_FAIL_URL = LOGIN_URL + \u0026#34;?error\u0026#34;; public static final String DEFAULT_SUCCESS_URL = \u0026#34;/home\u0026#34;; public static final String USERNAME = \u0026#34;username\u0026#34;; public static final String PASSWORD = \u0026#34;password\u0026#34;; @Bean @Order(2) public SecurityFilterChain filterChain(HttpSecurity http) throws Exception { http.authorizeRequests(request -\u0026gt; request.antMatchers(ENDPOINTS_WHITELIST).permitAll() .anyRequest().authenticated()) .csrf().disable() .antMatcher(\u0026#34;/login\u0026#34;) .formLogin(form -\u0026gt; form .loginPage(LOGIN_URL) .loginProcessingUrl(LOGIN_URL) .failureUrl(LOGIN_FAIL_URL) .usernameParameter(USERNAME) .passwordParameter(PASSWORD) .defaultSuccessUrl(DEFAULT_SUCCESS_URL)) .logout(logout -\u0026gt; logout .logoutUrl(\u0026#34;/logout\u0026#34;) .invalidateHttpSession(true) .deleteCookies(\u0026#34;JSESSIONID\u0026#34;) .logoutSuccessUrl(LOGIN_URL + \u0026#34;?logout\u0026#34;)) .sessionManagement(session -\u0026gt; session .sessionCreationPolicy(SessionCreationPolicy.ALWAYS) .invalidSessionUrl(\u0026#34;/invalidSession\u0026#34;) .maximumSessions(1) .maxSessionsPreventsLogin(true)); return http.build(); } } è®©æˆ‘ä»¬ä»”ç»†çœ‹çœ‹ä»£ç ï¼š\næˆ‘ä»¬æœ‰ä¸¤ä¸ª SecurityFilterChain æ–¹æ³• bookFilterChain() å’Œ filterChain() æ–¹æ³•ä»¥åŠ @Order(1) å’Œ @Order(2) ã€‚å®ƒä»¬éƒ½å°†æŒ‰ä¸Šè¿°é¡ºåºæ‰§è¡Œã€‚ ç”±äºä¸¤ä¸ªè¿‡æ»¤å™¨é“¾éƒ½æ»¡è¶³ä¸åŒçš„ç«¯ç‚¹ï¼Œå› æ­¤ application.yml ä¸­å­˜åœ¨ä¸åŒçš„å‡­æ® auth: users: loginadmin: role: admin password: loginpass bookadmin: role: user password: bookpass ä¸ºäº†è®© Spring Security ä½¿ç”¨è¿™äº›å‡­æ®ï¼Œæˆ‘ä»¬å°† UserDetailsService è‡ªå®šä¹‰ä¸ºï¼š\n@Bean public UserDetailsService userDetailsService() { return new InMemoryUserDetailsManager(props.getUserDetails()); } ä¸ºäº†æ»¡è¶³ AuthenticationException å’Œ AccessDeniedException ï¼Œæˆ‘ä»¬å®šåˆ¶äº† exceptionHandling() å¹¶é…ç½®äº†è‡ªå®šä¹‰ç±» UserAuthenticationErrorHandler å’Œ UserForbiddenErrorHandler ã€‚ ä½¿ç”¨æ­¤é…ç½®ï¼ŒREST ç«¯ç‚¹çš„é‚®é€’å‘˜å“åº”å¦‚ä¸‹æ‰€ç¤ºï¼š\næˆåŠŸçš„å›åº”:\næœªç»æˆæƒçš„å›åº”ï¼š\nç¦æ­¢çš„å›åº”ï¼š\n3. é»˜è®¤æƒ…å†µä¸‹ä¿æŠ¤çš„å…¶ä»–ç«¯ç‚¹ ä¸€æ—¦ä¸ºè¯·æ±‚åŒ¹é…å™¨é…ç½®äº† Spring Securityï¼Œé»˜è®¤æƒ…å†µä¸‹æ·»åŠ çš„å…¶ä»–ç«¯ç‚¹å°±ä¼šå—åˆ°ä¿æŠ¤ã€‚ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬å‘ BookController ç±»æ·»åŠ ä¸€ä¸ªç«¯ç‚¹\n@GetMapping(\u0026#34;/library/books/all\u0026#34;) public ResponseEntity\u0026lt;List\u0026lt;BookDto\u0026gt;\u0026gt; getAllBooks() { return ResponseEntity.ok().body(bookService.getAllBooks()); } ä¸ºäº†æˆåŠŸè°ƒç”¨æ­¤ç«¯ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦æä¾›åŸºæœ¬çš„èº«ä»½éªŒè¯å‡­æ®ã€‚\næ²¡æœ‰é€šè¿‡å‡­æ®æ—¶çš„é”™è¯¯å“åº”ï¼š\næˆåŠŸçš„å›åº”ï¼š\n4. ä¸å®‰å…¨çš„ç‰¹å®šç«¯ç‚¹ æˆ‘ä»¬å¯ä»¥æŒ‡å®šéœ€è¦ä»å®‰å…¨é…ç½®ä¸­æ’é™¤çš„ç«¯ç‚¹åˆ—è¡¨ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬é¦–å…ˆå‘ BookController ç±»æ·»åŠ å¦ä¸€ä¸ªç«¯ç‚¹ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š\n@GetMapping(\u0026#34;/library/info\u0026#34;) public ResponseEntity\u0026lt;LibraryInfo\u0026gt; getInfo() { return ResponseEntity.ok().body(bookService.getLibraryInfo()); } @Bean public WebSecurityCustomizer webSecurityCustomizer() { return (web) -\u0026gt; web.ignoring().antMatchers(\u0026#34;/library/info\u0026#34;); } ç°åœ¨ï¼Œæˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿåœ¨ä¸ä¼ é€’å‡­æ®çš„æƒ…å†µä¸‹ä»é‚®é€’å‘˜åˆ°è¾¾ç«¯ç‚¹ï¼š\n5. æ·»åŠ è‡ªå®šä¹‰è¿‡æ»¤å™¨ Spring é€šè¿‡æ‰§è¡Œé“¾ä¸­çš„ä¸€ç³»åˆ—è¿‡æ»¤å™¨æ¥æä¾›å®‰å…¨æ€§ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨è¯·æ±‚åˆ°è¾¾æ§åˆ¶å™¨ä¹‹å‰å¯¹å…¶æ·»åŠ é¢å¤–çš„æ£€æŸ¥ï¼ŒSpring Security ä¸ºæˆ‘ä»¬æä¾›äº†ä»¥ä¸‹æ–¹æ³•ï¼Œå¸®åŠ©æˆ‘ä»¬åœ¨é“¾ä¸­æ‰€éœ€çš„ä½ç½®æ·»åŠ è‡ªå®šä¹‰è¿‡æ»¤å™¨ã€‚\naddFilterBefore(Filter filter, Class beforeFilter)ï¼šæ­¤æ–¹æ³•å…è®¸æˆ‘ä»¬åœ¨é“¾ä¸­æŒ‡å®šè¿‡æ»¤å™¨ä¹‹å‰æ·»åŠ è‡ªå®šä¹‰è¿‡æ»¤å™¨ã€‚ addFilterAfter(Filter filter, Class afterFilter)ï¼šæ­¤æ–¹æ³•å…è®¸æˆ‘ä»¬åœ¨é“¾ä¸­æŒ‡å®šè¿‡æ»¤å™¨ä¹‹åæ·»åŠ è‡ªå®šä¹‰è¿‡æ»¤å™¨ã€‚ addFilterAt(Filter filter, Class atFilter)ï¼šæ­¤æ–¹æ³•å…è®¸æˆ‘ä»¬ä»¥ç›¸åŒçš„ä¼˜å…ˆçº§åœ¨é“¾ä¸­çš„æŒ‡å®šè¿‡æ»¤å™¨å¤„æ·»åŠ è‡ªå®šä¹‰è¿‡æ»¤å™¨ã€‚æ·»åŠ è‡ªå®šä¹‰è¿‡æ»¤å™¨åï¼Œè¿™ä¸¤ä¸ªè¿‡æ»¤å™¨éƒ½å°†åœ¨è¿‡æ»¤å™¨é“¾ä¸­è¢«è°ƒç”¨ï¼ˆæ— ç‰¹å®šé¡ºåºï¼‰ã€‚ è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ç¤ºä¾‹é…ç½®ï¼š\n@Configuration @EnableWebSecurity @EnableConfigurationProperties(BasicAuthProperties.class) public class SecurityConfiguration { private final BasicAuthProperties props; public SecurityConfiguration(BasicAuthProperties props) { this.props = props; } @Bean @Order(1) public SecurityFilterChain bookFilterChain(HttpSecurity http) throws Exception { http .csrf().disable() .sessionManagement(session -\u0026gt; session .sessionCreationPolicy(SessionCreationPolicy.STATELESS)) .antMatcher(\u0026#34;/library/**\u0026#34;) .authorizeRequests() .antMatchers(HttpMethod.GET, \u0026#34;/library/**\u0026#34;).hasRole(\u0026#34;USER\u0026#34;) .anyRequest().authenticated() .and() .httpBasic() .and() .exceptionHandling(exception -\u0026gt; exception .authenticationEntryPoint(userAuthenticationErrorHandler()) .accessDeniedHandler(new UserForbiddenErrorHandler())); http.addFilterBefore(customHeaderValidatorFilter(), BasicAuthenticationFilter.class); return http.build(); } @Bean public CustomHeaderValidatorFilter customHeaderValidatorFilter() { return new CustomHeaderValidatorFilter(); } } ä¸ºäº†ç¼–å†™è‡ªå®šä¹‰è¿‡æ»¤å™¨ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç±» CustomHeaderValidatorFilter ï¼Œå®ƒæ‰©å±•äº†ä¸ºæ­¤ç›®çš„è€Œåˆ›å»ºçš„ç‰¹æ®Šè¿‡æ»¤å™¨ OncePerRequestFilter ã€‚è¿™ç¡®ä¿æˆ‘ä»¬çš„è¿‡æ»¤å™¨å¯¹äºæ¯ä¸ªè¯·æ±‚ä»…è¢«è°ƒç”¨ä¸€æ¬¡ã€‚\npublic class CustomHeaderValidatorFilter extends OncePerRequestFilter { private static final Logger log = LoggerFactory.getLogger (CustomHeaderValidatorFilter.class); @Override protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException { log.info(\u0026#34;Custom filter called...\u0026#34;); if (StringUtils.isEmpty(request.getHeader(\u0026#34;X-Application-Name\u0026#34;))) { response.setStatus(HttpServletResponse.SC_FORBIDDEN); response.setContentType(\u0026#34;application/json\u0026#34;); response.getOutputStream().println(new ObjectMapper(). writeValueAsString(CommonException.headerError())); } else { filterChain.doFilter(request, response); } } } åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é‡å†™äº† doFilterInternal() å¹¶æ·»åŠ äº†æˆ‘ä»¬çš„é€»è¾‘ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»…å½“è¯·æ±‚ä¸­ä¼ é€’äº†æ‰€éœ€çš„æ ‡å¤´ X-Application-Name æ—¶ï¼Œè¯·æ±‚æ‰ä¼šåœ¨è¿‡æ»¤å™¨é“¾ä¸­ç»§ç»­è¿›è¡Œã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥éªŒè¯è¯¥è¿‡æ»¤å™¨æ˜¯å¦å·²ä»æ—¥å¿—è¿æ¥åˆ°æˆ‘ä»¬çš„ SecurityConfiguration ç±»ã€‚\nWill secure Ant [pattern=\u0026#39;/library/**\u0026#39;] with [org.springframework.security.web.session.DisableEncodeUrlFilter@669469c9, org.springframework.security.web.context.request.async. WebAsyncManagerIntegrationFilter@7f39ad3f, org.springframework.security.web.context.SecurityContextPersistenceFilter@1b901f7b, org.springframework.security.web.header.HeaderWriterFilter@64f49b3, org.springframework.security.web.authentication.logout.LogoutFilter@628aea61, com.reflectoring.security.CustomHeaderValidatorFilter@3d40a3b4, org.springframework.security.web.authentication.www. BasicAuthenticationFilter@8d23cd8, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@1a1e38ab, org.springframework.security.web.servletapi. SecurityContextHolderAwareRequestFilter@5bfdabf3, org.springframework.security.web.authentication. AnonymousAuthenticationFilter@7524125c, org.springframework.security.web.session.SessionManagementFilter@3dc14f80, org.springframework.security.web.access.ExceptionTranslationFilter@58c16efd, org.springframework.security.web.access.intercept.FilterSecurityInterceptor@5ab06829] è¿™é‡Œä¸ºæ‰€æœ‰ç«¯ç‚¹ /library/** è°ƒç”¨è¿‡æ»¤å™¨ã€‚ä¸ºäº†è¿›ä¸€æ­¥é™åˆ¶å®ƒä»¥æ»¡è¶³ç‰¹å®šçš„ç«¯ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥å°† Filter ç±»ä¿®æ”¹ä¸ºï¼š\n@Override protected boolean shouldNotFilter(HttpServletRequest request) throws ServletException { String path = request.getRequestURI(); return path.startsWith(\u0026#34;/library/books/all\u0026#34;); } é€šè¿‡æ­¤æ›´æ”¹ï¼Œå¯¹äºç«¯ç‚¹ /library/books/all ï¼Œå°†ä¸ä¼šæ‰§è¡Œ doFilterInternal() æ–¹æ³•ã€‚ç›¸åŒçš„æ¦‚å¿µé€‚ç”¨äºä½¿ç”¨ addFilterAt() å’Œ addFilterAfter() æ–¹æ³•æ·»åŠ çš„è¿‡æ»¤å™¨ã€‚\n6. åŸºäºè§’è‰²çš„æˆæƒ åœ¨ Spring Security çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œæˆæƒæ˜¯åœ¨ç”¨æˆ·é€šè¿‡èº«ä»½éªŒè¯åå‘ç”Ÿçš„ã€‚åœ¨å‰é¢çš„éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬æŸ¥çœ‹äº†å¤„ç† AccessDeniedException çš„ç¤ºä¾‹ã€‚å½“ç”¨æˆ·æˆæƒå¤±è´¥æ—¶æŠ›å‡ºè¯¥å¼‚å¸¸ã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨ application.yml ä¸­ä¸ºç”¨æˆ· bookadmin å’Œ loginadmin å®šä¹‰äº†è§’è‰²ï¼š\nauth: users: loginadmin: role: admin password: loginpass bookadmin: role: user password: bookpass ä¸ºäº†ç¡®ä¿æˆæƒï¼Œæˆ‘ä»¬å°† Spring Security é…ç½®ä¸ºï¼š\npublic class SecurityConfiguration { @Bean @Order(1) public SecurityFilterChain filterChain(HttpSecurity http) throws Exception { http.authorizeRequests(request -\u0026gt; request.antMatchers(ENDPOINTS_WHITELIST).hasRole(\u0026#34;ADMIN\u0026#34;) .anyRequest().authenticated()); /* Code continued.. */ return http.build(); } } ä»¥åŠ\npublic class SecurityConfiguration { @Bean @Order(2) public SecurityFilterChain bookFilterChain(HttpSecurity http) throws Exception { http .csrf().disable() .sessionManagement(session -\u0026gt; session .sessionCreationPolicy(SessionCreationPolicy.STATELESS)) .antMatcher(\u0026#34;/library/**\u0026#34;) .authorizeRequests() .antMatchers(HttpMethod.GET, \u0026#34;/library/**\u0026#34;).hasRole(\u0026#34;USER\u0026#34;) .anyRequest().authenticated(); /* Code continued.. */ return http.build(); } } è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¯ç”¨äºæˆæƒç«¯ç‚¹çš„æ–¹æ³•ã€‚\nhasRole(String role) : å¦‚æœå½“å‰ä¸»ä½“å…·æœ‰æŒ‡å®šè§’è‰²ï¼Œåˆ™è¿”å› true ã€‚ä¾‹å¦‚ã€‚ hasRole(\u0026quot;ADMIN\u0026quot;) hasAnyRole(String... roles) :å¯ä»¥æŒ‡å®šå¤šä¸ªè§’è‰²ã€‚å¦‚æœä»»ä½•è§’è‰²åŒ¹é…ï¼Œåˆ™è¿”å› true ã€‚ä¾‹å¦‚ã€‚ hasAnyRole(\u0026quot;ADMIN\u0026quot;, \u0026quot;USER\u0026quot;) æ³¨æ„ï¼šåœ¨ä¸Šè¿°ä¸¤ç§æƒ…å†µä¸‹ï¼Œ ROLE_ å‰ç¼€é»˜è®¤æ·»åŠ åˆ°æä¾›çš„è§’è‰²å­—ç¬¦ä¸²ä¸­ã€‚ hasAuthority(String authority) :å¦‚æœå½“å‰ä¸»ä½“å…·æœ‰æŒ‡å®šçš„æƒé™ï¼Œåˆ™è¿”å› true ã€‚ä¾‹å¦‚ã€‚ hasAuthority(ROLE_ADMIN) hasAnyAuthority(String... authorities) : å¯ä»¥æŒ‡å®šå¤šä¸ªæƒé™ã€‚å¦‚æœä»»ä½•æƒé™åŒ¹é…ï¼Œåˆ™è¿”å› true ã€‚ä¾‹å¦‚ã€‚ hasAnyAuthority(\u0026quot;ROLE_ADMIN\u0026quot;, \u0026quot;ROLE_USER\u0026quot;) Spring Security è®¿é—®æ§åˆ¶çš„é™„åŠ è¯´æ˜ ä¸Šé¢è®¨è®ºçš„æ‰€æœ‰æ–¹æ³•éƒ½ä½¿ç”¨ spEL æ¥æ”¯æŒæ›´å¤æ‚çš„è®¿é—®æ§åˆ¶ã€‚è¿™å…è®¸æˆ‘ä»¬ä½¿ç”¨ç‰¹å®šçš„ç±»æ¥å®ç° Web å’Œæ–¹æ³•å®‰å…¨æ€§æ¥è®¿é—®å½“å‰ä¸»ä½“ç­‰å€¼ã€‚è¦äº†è§£å¦‚ä½•åˆ©ç”¨ spELï¼Œè¯·å‚é˜…æ­¤ Spring æ–‡æ¡£ å¦å¤–ï¼Œå¦‚æœæˆ‘ä»¬ä¸éœ€è¦è®¾ç½®æˆæƒï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ–¹æ³• permitAll() å’Œ denyAll() åˆ†åˆ«å…è®¸æˆ–æ‹’ç»æ‰€æœ‰è§’è‰²å’Œæƒé™ã€‚ è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸€ä¸ªç¤ºä¾‹é…ç½®ï¼Œè¯¥é…ç½®åœ¨åŒä¸€æ–¹æ³•ä¸­ä¸ºä¸åŒç«¯ç‚¹ä½¿ç”¨ä¸åŒçš„è§’è‰²ã€‚\npublic class SecurityConfiguration { @Bean public SecurityFilterChain bookFilterChain(HttpSecurity http) throws Exception { http .authorizeRequests() .antMatchers(HttpMethod.GET, \u0026#34;/library/info\u0026#34;).permitAll() .antMatchers(HttpMethod.GET, \u0026#34;/library/books\u0026#34;).hasRole(\u0026#34;USER\u0026#34;) .antMatchers(HttpMethod.GET, \u0026#34;/library/books/all\u0026#34;).hasRole(\u0026#34;ADMIN\u0026#34;); return http.build(); } } 7.@PreAuthorize å’Œ@PostAuthorize Spring Security å…è®¸æˆ‘ä»¬é€šè¿‡ @PreAuthorize å’Œ @PostAuthorize æ³¨è§£å°†å®‰å…¨æœºåˆ¶æ‰©å±•åˆ°æ–¹æ³•ã€‚è¿™äº›æ³¨é‡Šä½¿ç”¨ spEL æ ¹æ®ä¼ é€’çš„å‚æ•°è¿›è¡Œè¯„ä¼°å’Œæˆæƒã€‚\n@PreAuthorize: åœ¨æ‰§è¡Œæ–¹æ³•ä¹‹å‰æˆæƒæ¡ä»¶ã€‚ @PostAuthorize: æˆæƒæ–¹æ³•æ‰§è¡Œåçš„æ¡ä»¶ã€‚ä¸ºäº†ä½¿è¿™äº›æ³¨é‡Šèµ·ä½œç”¨ï¼Œæˆ‘ä»¬éœ€è¦å°† @EnableGlobalMethodSecurity(prePostEnabled = true) æ·»åŠ åˆ°æˆ‘ä»¬çš„é…ç½®ç±»ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š @Configuration @EnableWebSecurity @EnableGlobalMethodSecurity(prePostEnabled = true) @EnableConfigurationProperties(BasicAuthProperties.class) public class SecurityConfiguration { /* ... */ } æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨è¿™äº›æ³¨è§£ã€‚è¿™é‡Œæˆ‘ä»¬åœ¨ Controller ç±»ä¸­ä½¿ç”¨äº† @PreAuthorize ã€‚\n@Controller public class BookController { private static final Logger log = LoggerFactory.getLogger(BookController.class); private final BookService bookService; public BookController(BookService bookService) { this.bookService = bookService; } @GetMapping(\u0026#34;/library/books\u0026#34;) @PreAuthorize(\u0026#34;#user == authentication.principal.username\u0026#34;) public ResponseEntity\u0026lt;List\u0026lt;BookDto\u0026gt;\u0026gt; getBooks(@RequestParam String genre, @RequestParam String user) { return ResponseEntity.ok().body(bookService.getBook(genre)); } @GetMapping(\u0026#34;/library/books/all\u0026#34;) @PreAuthorize(\u0026#34;hasRole(\u0026#39;ROLE_USER\u0026#39;)\u0026#34;) public ResponseEntity\u0026lt;List\u0026lt;BookDto\u0026gt;\u0026gt; getAllBooks() { return ResponseEntity.ok().body(bookService.getAllBooks()); } } åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ¼”ç¤ºäº†ä½¿ç”¨ @PreAuthorize æ³¨é‡Šçš„ä¸¤ç§æ–¹æ³•ã€‚\nç™»å½•çš„ç”¨æˆ·åä½œä¸ºè¯·æ±‚å‚æ•°ä¼ é€’ï¼Œå¹¶ä½¿ç”¨å½“å‰ä¸»ä½“è¿›è¡ŒéªŒè¯ã€‚å¯¹äºæˆåŠŸçš„åŒ¹é…ï¼Œé‚®é€’å‘˜ä¼šè¿”å›æœ‰æ•ˆçš„å“åº”ã€‚ å¦‚æœå‡ºç°é”™è¯¯ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ï¼š\n@PreAuthorize(\u0026quot;hasRole('ROLE_USER')\u0026quot;) : ä»…å½“å½“å‰ä¸»ä½“å…·æœ‰ USER è§’è‰²æ—¶ï¼Œæˆ‘ä»¬æ‰ä¼šæ”¶åˆ°æˆåŠŸå“åº”ã€‚ æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬åœ¨ Repository ç±»ä¸­ä½¿ â€‹â€‹ ç”¨ @PostAuthorize ã€‚\n@Repository public interface BookRepository extends JpaRepository\u0026lt;Book, Long\u0026gt; { List\u0026lt;Book\u0026gt; findByGenre(String genre); @PostAuthorize(\u0026#34;returnObject.size() \u0026gt; 0\u0026#34;) List\u0026lt;Book\u0026gt; findAll(); } è¿™é‡Œï¼Œ returnObject è¡¨ç¤º List\u0026lt;Book\u0026gt; ã€‚å› æ­¤ï¼Œå½“ size() è¿”å› 0 æ—¶ï¼Œæˆ‘ä»¬å°†å¾—åˆ°ä¸€ä¸ªé”™è¯¯å“åº”ã€‚\nè‡ªå®šä¹‰æˆæƒ è¦è‡ªå®šä¹‰è¡¨è¾¾å¼çš„å¤„ç†æ–¹å¼ï¼Œæˆ‘ä»¬éœ€è¦å°† MethodSecurityExpressionHandler å…¬å¼€ä¸º beanã€‚ Spring æ–¹æ³•å®‰å…¨æ€§æ˜¯ä½¿ç”¨ Spring AOP æ„å»ºçš„ã€‚æœ‰å…³æ›´å¤šç¤ºä¾‹ï¼Œè¯·å‚é˜…æ–¹æ³•å®‰å…¨æ–‡æ¡£ã€‚ 8. åŸºäºæ•°æ®åº“çš„è®¤è¯å’Œæˆæƒ åœ¨ä¹‹å‰çš„æ‰€æœ‰ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬éƒ½ä½¿ç”¨ InMemoryUserDetailsManager é…ç½®ç”¨æˆ·ã€å¯†ç ã€è§’è‰²ã€‚ Spring Security å…è®¸æˆ‘ä»¬è‡ªå®šä¹‰èº«ä»½éªŒè¯å’Œæˆæƒè¿‡ç¨‹ã€‚æˆ‘ä»¬è¿˜å¯ä»¥åœ¨æ•°æ®åº“ä¸­é…ç½®è¿™äº›è¯¦ç»†ä¿¡æ¯ï¼Œå¹¶è®© Spring Security ç›¸åº”åœ°è®¿é—®å®ƒä»¬ã€‚\næœ‰å…³å·¥ä½œç¤ºä¾‹ï¼Œè¯·å‚é˜…æœ¬æ–‡ã€‚å®ƒè¿˜è§£é‡Šäº†ä¸ºäº†æé«˜å®‰å…¨æ€§è€Œåº”é‡‡ç”¨çš„ä¸åŒæ–¹å¼å¤„ç†å¯†ç ã€‚\nè®©æˆ‘ä»¬æ¦‚è¿°ä¸€ä¸‹ä½¿æ­¤é…ç½®æ­£å¸¸å·¥ä½œæ‰€éœ€çš„æ­¥éª¤ã€‚\nStep.1 : é€šè¿‡é‡å†™ loadUserByUsername() è‡ªå®šä¹‰ UserDetailsService ä»¥ä»æ•°æ®åº“åŠ è½½ç”¨æˆ·å‡­æ®ã€‚\nStep.2 : æ ¹æ®ä½¿ç”¨çš„ç¼–ç æœºåˆ¶åˆ›å»º PasswordEncoder beanã€‚\nStep.3 : ç”±äº AuthenticationProvider è´Ÿè´£éªŒè¯å‡­æ®ï¼Œå› æ­¤è‡ªå®šä¹‰å¹¶è¦†ç›– authenticate() ä»¥ä½¿ç”¨æ•°æ®åº“å‡­æ®è¿›è¡ŒéªŒè¯ã€‚\næœ‰å…³å¯†ç ç¼–ç å™¨çš„é™„åŠ ä¿¡æ¯ åœ¨ Spring Security 5.0 ä¹‹å‰ï¼Œé»˜è®¤çš„ PasswordEncoder æ˜¯ NoOpPasswordEncoder ï¼Œå®ƒéœ€è¦çº¯æ–‡æœ¬å¯†ç ã€‚ ä» Spring Security 5.0 å¼€å§‹ï¼Œæˆ‘ä»¬ä½¿ç”¨ DelegatingPasswordEncoder ç¡®ä¿ä½¿ç”¨å½“å‰å¯†ç å­˜å‚¨å»ºè®®å¯¹å¯†ç è¿›è¡Œç¼–ç ã€‚ æœ‰å…³ DelegatingPasswordEncoder çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æ­¤æ–‡æ¡£ ä½¿ç”¨ Spring Security è¿›è¡Œæµ‹è¯• ç°åœ¨æˆ‘ä»¬å·²ç»äº†è§£äº†å„ç§å®‰å…¨é…ç½®çš„å·¥ä½œåŸç†ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å®ƒä»¬çš„å•å…ƒæµ‹è¯•ã€‚ Spring security ä¸ºæˆ‘ä»¬æä¾›äº†ä»¥ä¸‹ä¾èµ–ï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.security\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-security-test\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜æ·»åŠ äº† Hamcrest ä¾èµ–é¡¹ã€‚ Hamcrest æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œå…è®¸æˆ‘ä»¬åœ¨æ–­è¨€ä¸­ä½¿ç”¨ Matcher å¯¹è±¡æ¥è¿›è¡Œæ›´å…·è¡¨ç°åŠ›çš„å“åº”åŒ¹é…ã€‚è¯·å‚é˜… Hamcrest æ–‡æ¡£ä»¥æ·±å…¥äº†è§£å…¶åŠŸèƒ½ã€‚\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.hamcrest\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;hamcrest-library\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.2\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; é¦–å…ˆï¼Œè®©æˆ‘ä»¬è®¾ç½® ApplicationContext æ¥æµ‹è¯• BookController ç±»ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ @Sql å®šä¹‰äº†ä¸€ä¸ªç¤ºä¾‹æµ‹è¯•æ•°æ®\n@SpringBootTest @AutoConfigureMockMvc @SqlGroup({ @Sql(value = \u0026#34;classpath:init/first.sql\u0026#34;, executionPhase = BEFORE_TEST_METHOD), @Sql(value = \u0026#34;classpath:init/second.sql\u0026#34;, executionPhase = BEFORE_TEST_METHOD) }) public class BookControllerTest { } ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¯ç”¨äºæµ‹è¯•åŸºæœ¬èº«ä»½éªŒè¯å®‰å…¨ç«¯ç‚¹çš„å„ç§é€‰é¡¹ã€‚\n@WithMockUser é¡¾åæ€ä¹‰ï¼Œæˆ‘ä»¬å°†æ­¤æ³¨é‡Šä¸é»˜è®¤ç”¨æˆ·å user ã€å¯†ç  password å’Œè§’è‰² ROLE_USER ä¸€èµ·ä½¿ç”¨ã€‚ç”±äºæˆ‘ä»¬æ­£åœ¨æ¨¡æ‹Ÿç”¨æˆ·ï¼Œå› æ­¤ç”¨æˆ·ä¸éœ€è¦å®é™…å­˜åœ¨ã€‚åªè¦æˆ‘ä»¬çš„ç«¯ç‚¹æ˜¯å®‰å…¨çš„ï¼Œ @WithMockUser å°±ä¼šæˆåŠŸã€‚\npublic class BookControllerTest { @Autowired private MockMvc mockMvc; @Test @DisplayName(\u0026#34;TestCase1 Check if spring security applies to the endpoint\u0026#34;) @WithMockUser(username = \u0026#34;bookadmin\u0026#34;, roles = {\u0026#34;USER\u0026#34;}) void successIfSecurityApplies() throws Exception { mockMvc.perform(get(\u0026#34;/library/books\u0026#34;) .param(\u0026#34;genre\u0026#34;, \u0026#34;Fiction\u0026#34;) .param(\u0026#34;user\u0026#34;, \u0026#34;bookadmin\u0026#34;) .header(\u0026#34;X-Application-Name\u0026#34;, \u0026#34;Library\u0026#34;)) .andDo(print()) .andExpect(status().isOk()) .andExpect(authenticated().withUsername(\u0026#34;bookadmin\u0026#34;)) .andExpect(authenticated().withRoles(\u0026#34;USER\u0026#34;)) .andExpect(jsonPath(\u0026#34;$\u0026#34;, hasSize(3))) ; } @Test @DisplayName(\u0026#34;TestCase2 Fails when wrong roles are provided\u0026#34;) @WithMockUser(username = \u0026#34;bookadmin\u0026#34;, roles = {\u0026#34;ADMIN\u0026#34;}) void failsForWrongAuthorization() throws Exception { mockMvc.perform(get(\u0026#34;/library/books\u0026#34;) .param(\u0026#34;genre\u0026#34;, \u0026#34;Fiction\u0026#34;) .param(\u0026#34;user\u0026#34;, \u0026#34;bookadmin\u0026#34;) .header(\u0026#34;X-Application-Name\u0026#34;, \u0026#34;Library\u0026#34;)) .andDo(print()) .andExpect(status().isForbidden()) ; } @Test @DisplayName(\u0026#34;TestCase3 Fails when we run the test with no security\u0026#34;) void failsIfSecurityApplies() throws Exception { mockMvc.perform(get(\u0026#34;/library/books\u0026#34;) .param(\u0026#34;genre\u0026#34;, \u0026#34;Fiction\u0026#34;) .param(\u0026#34;user\u0026#34;, \u0026#34;bookadmin\u0026#34;) .header(\u0026#34;X-Application-Name\u0026#34;, \u0026#34;Library\u0026#34;)) .andDo(print()) .andExpect(status().isUnauthorized()) ; } } @WithMockUser(username = \u0026quot;bookadmin\u0026quot;, roles = {\u0026quot;USER\u0026quot;}) :è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ç”¨æˆ·å bookadmin å’Œè§’è‰² USER è¿è¡Œæµ‹è¯•ã€‚æ­¤æµ‹è¯•ä»…ç”¨äºéªŒè¯ç«¯ç‚¹æ˜¯å¦å®‰å…¨ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜ä½¿ç”¨æ–¹æ³• authenticated() æ¥éªŒè¯èº«ä»½éªŒè¯è¯¦ç»†ä¿¡æ¯ï¼Œå¹¶ä½¿ç”¨ hamcrest åŒ¹é…å™¨ hasSize() æ¥éªŒè¯å“åº”å¯¹è±¡ã€‚ @WithMockUser(username = \u0026quot;bookadmin\u0026quot;, roles = {\u0026quot;ADMIN\u0026quot;}) : åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ”¶åˆ° Forbidden å“åº”ï¼Œå› ä¸ºè§’è‰²ä¸åŒ¹é…ã€‚å°½ç®¡ç”¨æˆ·è¢«å˜²ç¬‘ï¼Œä½†è§’è‰²éœ€è¦åŒ¹é…æ‰èƒ½è·å¾—æˆåŠŸå“åº”ã€‚ å½“æ²¡æœ‰æŒ‡å®šç”¨æˆ·ç»†èŠ‚æ—¶ï¼Œç«¯ç‚¹æ²¡æœ‰å¾—åˆ°ä¿æŠ¤ï¼Œå› æ­¤æˆ‘ä»¬æ”¶åˆ°äº†æœªæˆæƒçš„å“åº”ã€‚ @WithUserDetails æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨åœ¨ SecurityConfiguration ç±»ä¸­åˆ›å»ºçš„ UserDetailsService beanï¼Œè€Œä¸æ˜¯æ¨¡æ‹Ÿç”¨æˆ·ã€‚\npublic class BookControllerTest { @Autowired private MockMvc mockMvc; @Test @DisplayName(\u0026#34;TestCase4 Run the test with configured UserDetailsService\u0026#34;) @WithUserDetails(value = \u0026#34;bookadmin\u0026#34;, userDetailsServiceBeanName = \u0026#34;userDetailsService\u0026#34;) void testBookWithConfiguredUserDetails() throws Exception { mockMvc.perform(get(\u0026#34;/library/books\u0026#34;) .param(\u0026#34;genre\u0026#34;, \u0026#34;Fantasy\u0026#34;) .param(\u0026#34;user\u0026#34;, \u0026#34;bookadmin\u0026#34;) .header(\u0026#34;X-Application-Name\u0026#34;, \u0026#34;Library\u0026#34;)) .andDo(print()) .andExpect(status().isOk()) .andExpect(jsonPath(\u0026#34;$\u0026#34;, hasSize(1))) ; } @Test @DisplayName(\u0026#34;TestCase5 Fails when execution of CustomHeaderValidatorFilter \u0026#34; + \u0026#34;does not meet the criteria\u0026#34;) @WithUserDetails(value = \u0026#34;bookadmin\u0026#34;, userDetailsServiceBeanName = \u0026#34;userDetailsService\u0026#34;) void failsIfMandatoryHeaderIsMissing() throws Exception { mockMvc.perform(get(\u0026#34;/library/books\u0026#34;) .param(\u0026#34;genre\u0026#34;, \u0026#34;Fantasy\u0026#34;) .param(\u0026#34;user\u0026#34;, \u0026#34;bookadmin\u0026#34;)) .andDo(print()) .andExpect(status().isForbidden()) ; } @Test @DisplayName(\u0026#34;TestCase6 Fails when preauthorization \u0026#34; + \u0026#34;of current principal fails\u0026#34;) @WithUserDetails(value = \u0026#34;bookadmin\u0026#34;, userDetailsServiceBeanName = \u0026#34;userDetailsService\u0026#34;) void failsIfPreAuthorizeConditionFails() throws Exception { mockMvc.perform(get(\u0026#34;/library/books\u0026#34;) .param(\u0026#34;genre\u0026#34;, \u0026#34;Fantasy\u0026#34;) .param(\u0026#34;user\u0026#34;, \u0026#34;bookuser\u0026#34;) .header(\u0026#34;X-Application-Name\u0026#34;, \u0026#34;Library\u0026#34;)) .andDo(print()) .andExpect(status().isForbidden()) ; } @Test @DisplayName(\u0026#34;TestCase7 Fails when wrong basic auth credentials are applied\u0026#34;) void testBookWithWrongCredentialsUserDetails() throws Exception { mockMvc.perform(get(\u0026#34;/library/books\u0026#34;) .param(\u0026#34;genre\u0026#34;, \u0026#34;Fantasy\u0026#34;) .param(\u0026#34;user\u0026#34;, \u0026#34;bookadmin\u0026#34;) .header(\u0026#34;X-Application-Name\u0026#34;, \u0026#34;Library\u0026#34;) .with(httpBasic(\u0026#34;bookadmin\u0026#34;, \u0026#34;password\u0026#34;))) .andDo(print()) .andExpect(status().isUnauthorized()); } } é€šè¿‡æ­¤é…ç½®ï¼Œç«¯ç‚¹å°†ä½¿ç”¨ userDetailsService bean è¿›è¡Œèº«ä»½éªŒè¯ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ httpBasic() æ¥ç¡®ä¿æ‹’ç»é”™è¯¯çš„å‡­æ®ã€‚æ­¤å¤–ï¼Œä¸Šè¿°æµ‹è¯•éªŒè¯äº†é¢„æˆæƒå’Œè‡ªå®šä¹‰è¿‡æ»¤å™¨æ£€æŸ¥ã€‚\nç»“è®º åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ç ”ç©¶äº†é€‚ç”¨äº Spring Security çš„åŸºæœ¬æ¦‚å¿µã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜è§£é‡Šäº† spring æä¾›çš„é»˜è®¤é…ç½®ä»¥åŠå¦‚ä½•è¦†ç›–å®ƒä»¬ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜ç ”ç©¶äº†ä¸€äº›å¸¸è§çš„ç”¨ä¾‹ï¼Œå¹¶é€šè¿‡å•å…ƒæµ‹è¯•å¯¹å…¶è¿›è¡Œäº†éªŒè¯ã€‚æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼ŒSpring æä¾›äº†å¾ˆå¤§çš„çµæ´»æ€§ï¼Œå…è®¸æˆ‘ä»¬ä¸ºå¤æ‚çš„åº”ç”¨ç¨‹åºå®šåˆ¶å®‰å…¨æ€§ã€‚æˆ‘ä»¬å¯ä»¥æ‰©å±• GitHub ä¸Šåº”ç”¨ç¨‹åºä¸­åº”ç”¨çš„ç¤ºä¾‹é…ç½®ä»¥æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚\nåŸæ–‡é“¾æ¥ï¼šhttps://reflectoring.io/spring-security/\n","permalink":"https://blog.chensoul.cc/posts/2023/08/16/spring-security/","summary":"Spring Security æ˜¯ä¸€ä¸ªæœ‰åŠ©äºä¿æŠ¤ä¼ä¸šåº”ç”¨ç¨‹åºå®‰å…¨çš„æ¡†æ¶ã€‚é€šè¿‡ä¸ Spring MVCã€Spring Webflux æˆ– Spring Boot é›†æˆï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå¼ºå¤§ä¸”é«˜åº¦å¯å®šåˆ¶çš„èº«ä»½éªŒè¯å’Œè®¿é—®æ§åˆ¶æ¡†æ¶ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è§£é‡Šæ ¸å¿ƒæ¦‚å¿µå¹¶ä»”ç»†ç ”ç©¶ Spring Security æä¾›çš„é»˜è®¤é…ç½®åŠå…¶å·¥ä½œåŸç†ã€‚æˆ‘ä»¬å°†è¿›ä¸€æ­¥å°è¯•è‡ªå®šä¹‰å®ƒä»¬å¹¶åˆ†æå®ƒä»¬å¯¹ç¤ºä¾‹ Spring Boot åº”ç”¨ç¨‹åºçš„å½±å“ã€‚\nç¤ºä¾‹ä»£ç  æœ¬æ–‡é™„æœ‰ GitHub ä¸Šçš„å·¥ä½œä»£ç ç¤ºä¾‹ã€‚\nåˆ›å»ºç¤ºä¾‹åº”ç”¨ç¨‹åº è®©æˆ‘ä»¬ä»å¤´å¼€å§‹æ„å»ºä¸€ä¸ª Spring Boot åº”ç”¨ç¨‹åºï¼Œçœ‹çœ‹ spring å¦‚ä½•é…ç½®å’Œæä¾›å®‰å…¨æ€§ã€‚è®©æˆ‘ä»¬ä» spring starter åˆ›å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºå¹¶æ·»åŠ æ‰€éœ€çš„æœ€å°‘ä¾èµ–é¡¹ã€‚\nç”Ÿæˆé¡¹ç›®åï¼Œæˆ‘ä»¬å°†å…¶å¯¼å…¥åˆ° IDE ä¸­å¹¶å°†å…¶é…ç½®ä¸ºåœ¨ç«¯å£ 8083 ä¸Šè¿è¡Œã€‚\nmvnw clean verify spring-boot:run (for Windows) ./mvnw clean verify spring-boot:run (for Linux) åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥çœ‹åˆ°ä¸€ä¸ªç™»å½•é¡µé¢ã€‚\næ§åˆ¶å°æ—¥å¿—æ‰“å°ä½œä¸ºé»˜è®¤å®‰å…¨é…ç½®çš„ä¸€éƒ¨åˆ†éšæœºç”Ÿæˆçš„é»˜è®¤å¯†ç ï¼š\nä½¿ç”¨é»˜è®¤ç”¨æˆ·å user å’Œé»˜è®¤å¯†ç ï¼ˆæ¥è‡ªæ—¥å¿—ï¼‰ï¼Œæˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿç™»å½•è¯¥åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬å¯ä»¥åœ¨ application.yml ä¸­è¦†ç›–è¿™äº›é»˜è®¤å€¼ï¼š\nspring: security: user: name: admin password: passw@rd ç°åœ¨ï¼Œæˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿä½¿ç”¨ç”¨æˆ· admin å’Œå¯†ç  passw@rd ç™»å½•ã€‚\nä¾èµ–ç‰ˆæœ¬ åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Spring Boot 2.7.5 ç‰ˆæœ¬ã€‚åŸºäºæ­¤ç‰ˆæœ¬ï¼ŒSpring Boot å†…éƒ¨å°† Spring Security ç‰ˆæœ¬è§£æä¸º 5.7.4ã€‚ä½†æ˜¯ï¼Œå¦‚æœéœ€è¦ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ pom.xml ä¸­è¦†ç›–è¿™äº›ç‰ˆæœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\u0026lt;properties\u0026gt; \u0026lt;spring-security.version\u0026gt;5.2.5.RELEASE\u0026lt;/spring-security.version\u0026gt; \u0026lt;/properties\u0026gt; äº†è§£å®‰å…¨ç»„ä»¶ è¦äº†è§£é»˜è®¤é…ç½®çš„å·¥ä½œåŸç†ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ä»¥ä¸‹å†…å®¹ï¼š\nServlet Filters è¿‡æ»¤å™¨ Authentication è®¤è¯ Authorization æˆæƒ Servlet Filters è®©æˆ‘ä»¬ä»”ç»†çœ‹çœ‹åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶çš„æ§åˆ¶å°æ—¥å¿—ã€‚æˆ‘ä»¬çœ‹åˆ° DefaultSecurityFilterChain åœ¨è¯·æ±‚åˆ°è¾¾ DispatcherServlet ä¹‹å‰è§¦å‘ä¸€ç³»åˆ—è¿‡æ»¤å™¨ã€‚ DispatcherServlet æ˜¯ Web æ¡†æ¶ä¸­çš„å…³é”®ç»„ä»¶ï¼Œç”¨äºå¤„ç†ä¼ å…¥çš„ Web è¯·æ±‚å¹¶å°†å®ƒä»¬åˆ†æ´¾åˆ°é€‚å½“çš„å¤„ç†ç¨‹åºè¿›è¡Œå¤„ç†ã€‚","title":"[è¯‘]Spring Security å’Œ Spring Boot å…¥é—¨"},{"content":"å®¹å™¨å·²æˆä¸ºæ‰“åŒ…å…·æœ‰æ‰€æœ‰è½¯ä»¶å’Œæ“ä½œç³»ç»Ÿä¾èµ–é¡¹çš„åº”ç”¨ç¨‹åºï¼Œç„¶åå°†å…¶ä¼ é€åˆ°ä¸åŒç¯å¢ƒçš„é¦–é€‰æ–¹å¼ã€‚\næœ¬æ–‡ç€çœ¼äºå®¹å™¨åŒ– Spring Boot åº”ç”¨ç¨‹åºçš„ä¸åŒæ–¹æ³•ï¼š\nä½¿ç”¨ Docker æ–‡ä»¶æ„å»º Docker é•œåƒï¼Œ ä½¿ç”¨ Cloud-Native Buildpack ä»æºä»£ç æ„å»º OCI æ˜ åƒï¼Œ é€šè¿‡ä½¿ç”¨åˆ†å±‚å·¥å…·å°† JAR çš„å„ä¸ªéƒ¨åˆ†æ‹†åˆ†ä¸ºä¸åŒçš„å±‚ï¼Œåœ¨è¿è¡Œæ—¶ä¼˜åŒ–æ˜ åƒã€‚ ç¤ºä¾‹ä»£ç  æœ¬æ–‡é™„æœ‰ GitHub ä¸Šçš„å·¥ä½œä»£ç ç¤ºä¾‹ã€‚\nå®¹å™¨æœ¯è¯­ æˆ‘ä»¬å°†ä»æ•´ç¯‡æ–‡ç« ä¸­ä½¿ç”¨çš„å®¹å™¨æœ¯è¯­å¼€å§‹ï¼š\nContainer image: å…·æœ‰ç‰¹å®šæ ¼å¼çš„æ–‡ä»¶ã€‚æˆ‘ä»¬é€šè¿‡è¿è¡Œæ„å»ºå·¥å…·å°†åº”ç”¨ç¨‹åºè½¬æ¢ä¸ºå®¹å™¨æ˜ åƒã€‚ Container: å®¹å™¨é•œåƒçš„è¿è¡Œæ—¶å®ä¾‹ã€‚ Container engine: t è´Ÿè´£è¿è¡Œ Container çš„å®ˆæŠ¤è¿›ç¨‹ã€‚ Container host: å®¹å™¨å¼•æ“è¿è¡Œçš„ä¸»æœºã€‚ Container registry: ç”¨äºå‘å¸ƒå’Œåˆ†å‘å®¹å™¨æ˜ åƒçš„å…±äº«ä½ç½®ã€‚ OCI Standard: å¼€æ”¾å®¹å™¨å€¡è®® (OCI) æ˜¯åœ¨ Linux åŸºé‡‘ä¼šä¸‹å½¢æˆçš„ä¸€ä¸ªè½»é‡çº§ã€å¼€æ”¾çš„æ²»ç†ç»“æ„ã€‚ OCI é•œåƒè§„èŒƒå®šä¹‰äº†å®¹å™¨é•œåƒæ ¼å¼å’Œè¿è¡Œæ—¶çš„è¡Œä¸šæ ‡å‡†ï¼Œä»¥ç¡®ä¿æ‰€æœ‰å®¹å™¨å¼•æ“éƒ½å¯ä»¥è¿è¡Œä»»ä½•æ„å»ºå·¥å…·ç”Ÿæˆçš„å®¹å™¨é•œåƒã€‚ ä¸ºäº†å®¹å™¨åŒ–åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬å°†åº”ç”¨ç¨‹åºå°è£…åœ¨å®¹å™¨æ˜ åƒä¸­ï¼Œå¹¶å°†è¯¥æ˜ åƒå‘å¸ƒåˆ°å…±äº«æ³¨å†Œè¡¨ã€‚å®¹å™¨è¿è¡Œæ—¶ä»æ³¨å†Œè¡¨ä¸­æå–è¯¥æ˜ åƒï¼Œè§£å‹è¯¥æ˜ åƒï¼Œç„¶ååœ¨å…¶ä¸­è¿è¡Œåº”ç”¨ç¨‹åºã€‚\nSpring Boot 2.3 ç‰ˆæœ¬æä¾›äº†ç”¨äºæ„å»º OCI æ˜ åƒçš„æ’ä»¶ã€‚\nDocker æ°å¥½æ˜¯æœ€å¸¸ç”¨çš„å®¹å™¨å®ç°ï¼Œå¹¶ä¸”æˆ‘ä»¬åœ¨ç¤ºä¾‹ä¸­ä½¿ç”¨ Dockerï¼Œå› æ­¤æœ¬æ–‡ä¸­æ‰€æœ‰åç»­å¯¹å®¹å™¨çš„å¼•ç”¨éƒ½å°†æŒ‡ Dockerã€‚\nä»¥ä¼ ç»Ÿæ–¹å¼æ„å»ºå®¹å™¨é•œåƒ é€šè¿‡å‘ Docker æ–‡ä»¶æ·»åŠ ä¸€äº›æŒ‡ä»¤ï¼Œå¯ä»¥éå¸¸è½»æ¾åœ°åˆ›å»º Spring Boot åº”ç”¨ç¨‹åºçš„ Docker é•œåƒã€‚\næˆ‘ä»¬é¦–å…ˆæ„å»ºä¸€ä¸ªå¯æ‰§è¡Œ JARï¼Œå¹¶ä½œä¸º Docker æ–‡ä»¶æŒ‡ä»¤çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨åº”ç”¨å¿…è¦çš„è‡ªå®šä¹‰åå°†å¯æ‰§è¡Œ JAR å¤åˆ¶åˆ°åŸºæœ¬ JRE æ˜ åƒä¸Šã€‚\nè®©æˆ‘ä»¬ä» Spring Initializr åˆ›å»ºå¸¦æœ‰ web ã€ lombok å’Œ actuator ä¾èµ–é¡¹çš„ Spring Boot åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬è¿˜æ·»åŠ äº†ä¸€ä¸ªä¼‘æ¯æ§åˆ¶å™¨æ¥ä½¿ç”¨ GET æ–¹æ³•å…¬å¼€ APIã€‚\nåˆ›å»º Docker æ–‡ä»¶ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡æ·»åŠ  Dockerfile æ¥å®¹å™¨åŒ–è¯¥åº”ç”¨ç¨‹åºï¼š\nFROM adoptopenjdk:11-jre-hotspot ARG JAR_FILE=target/*.jar COPY ${JAR_FILE} application.jar EXPOSE 8080 ENTRYPOINT [\u0026#34;java\u0026#34;,\u0026#34;-jar\u0026#34;,\u0026#34;/application.jar\u0026#34;] æˆ‘ä»¬çš„ Docker æ–‡ä»¶åŒ…å«æ¥è‡ª adoptopenjdk çš„åŸºæœ¬æ˜ åƒï¼Œæˆ‘ä»¬åœ¨è¯¥æ˜ åƒä¸Šå¤åˆ¶ JAR æ–‡ä»¶ï¼Œç„¶åå…¬å¼€å°†ä¾¦å¬è¯·æ±‚çš„ç«¯å£ 8080 ã€‚\næ„å»ºåº”ç”¨ç¨‹åº æˆ‘ä»¬é¦–å…ˆä½¿ç”¨ Maven æˆ– Gradle æ„å»ºåº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨ Mavenï¼š\nmvn clean package è¿™å°†åˆ›å»ºåº”ç”¨ç¨‹åºçš„å¯æ‰§è¡Œ JARã€‚æˆ‘ä»¬éœ€è¦å°†è¿™ä¸ªå¯æ‰§è¡Œ JAR è½¬æ¢ä¸º Docker æ˜ åƒï¼Œä»¥ä¾¿åœ¨ Docker å¼•æ“ä¸­è¿è¡Œã€‚\næ„å»ºå®¹å™¨é•œåƒ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡ä»åŒ…å«ä¹‹å‰åˆ›å»ºçš„ Docker æ–‡ä»¶çš„æ ¹é¡¹ç›®ç›®å½•è¿è¡Œ docker build å‘½ä»¤ï¼Œå°†æ­¤å¯æ‰§è¡Œ JAR æ”¾å…¥ Docker æ˜ åƒä¸­ï¼š\ndocker build -t usersignup:v1 . æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ—å‡ºçš„å›¾åƒï¼š\ndocker images ä¸Šè¿°å‘½ä»¤çš„è¾“å‡ºåŒ…æ‹¬æˆ‘ä»¬çš„æ˜ åƒ usersignup ä»¥åŠ Docker æ–‡ä»¶ä¸­æŒ‡å®šçš„åŸºç¡€æ˜ åƒ adoptopenjdk ã€‚\nREPOSITORY TAG SIZE usersignup v1 249MB adoptopenjdk 11-jre-hotspot 229MB æŸ¥çœ‹å®¹å™¨é•œåƒå†…çš„å±‚ è®©æˆ‘ä»¬çœ‹çœ‹å›¾åƒå†…çš„å›¾å±‚å †æ ˆã€‚æˆ‘ä»¬å°†ä½¿ç”¨ dive tool æ¥æŸ¥çœ‹è¿™äº›å›¾å±‚ï¼š\ndive usersignup:v1 ä»¥ä¸‹æ˜¯è¿è¡Œ Dive å‘½ä»¤çš„éƒ¨åˆ†è¾“å‡ºï¼š\næ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œåº”ç”¨å±‚æ„æˆäº†å›¾åƒå¤§å°çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚ä½œä¸ºä¼˜åŒ–çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯åœ¨ä»¥ä¸‹éƒ¨åˆ†ä¸­å‡å°è¯¥å±‚çš„å¤§å°ã€‚\nä½¿ç”¨ Buildpack æ„å»ºå®¹å™¨é•œåƒ Buildpacks æ˜¯å„ç§å¹³å°å³æœåŠ¡ (PAAS) äº§å“ä½¿ç”¨çš„é€šç”¨æœ¯è¯­ï¼Œç”¨äºä»æºä»£ç æ„å»ºå®¹å™¨æ˜ åƒã€‚å®ƒç”± Heroku äº 2011 å¹´å‘èµ·ï¼Œæ­¤åå·²è¢« Cloud Foundryã€Google App Engineã€Gitlabã€Knative ç­‰é‡‡ç”¨ã€‚\näº‘åŸç”Ÿ Buildpack çš„ä¼˜åŠ¿ ä½¿ç”¨ Buildpack æ„å»ºæ˜ åƒçš„ä¸€ä¸ªä¸»è¦ä¼˜ç‚¹æ˜¯ï¼Œå¯ä»¥åœ¨é›†ä¸­ä½ç½®ï¼ˆæ„å»ºå™¨ï¼‰ç®¡ç†å¯¹æ˜ åƒé…ç½®çš„æ›´æ”¹ï¼Œå¹¶å°†å…¶ä¼ æ’­åˆ°ä½¿ç”¨è¯¥æ„å»ºå™¨çš„æ‰€æœ‰åº”ç”¨ç¨‹åºã€‚\nBuildpack ä¸å¹³å°ç´§å¯†è€¦åˆã€‚äº‘åŸç”Ÿ Buildpack é€šè¿‡æ”¯æŒ OCI æ˜ åƒæ ¼å¼å®ç°è·¨å¹³å°æ ‡å‡†åŒ–ï¼Œç¡®ä¿æ˜ åƒå¯ä»¥ç”± Docker å¼•æ“è¿è¡Œã€‚\nä½¿ç”¨ Spring Boot æ’ä»¶ Spring Boot æ’ä»¶ä½¿ç”¨ Buildpack ä»æºä»£ç åˆ›å»º OCI æ˜ åƒã€‚æ˜ åƒæ˜¯ä½¿ç”¨ bootBuildImage ä»»åŠ¡ (Gradle) æˆ– spring-boot:build-image ç›®æ ‡ (Maven) å’Œæœ¬åœ° Docker å®‰è£…æ„å»ºçš„ã€‚\næˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ image tag ä¸­æŒ‡å®šåç§°æ¥è‡ªå®šä¹‰æ¨é€åˆ° Docker æ³¨å†Œè¡¨æ‰€éœ€çš„é•œåƒåç§°ï¼š\n\u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;image\u0026gt; \u0026lt;name\u0026gt;docker.io/pratikdas/${project.artifactId}:v1\u0026lt;/name\u0026gt; \u0026lt;/image\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt; è®©æˆ‘ä»¬ä½¿ç”¨ Maven è¿è¡Œ build-image ç›®æ ‡æ¥æ„å»ºåº”ç”¨ç¨‹åºå¹¶åˆ›å»ºå®¹å™¨æ˜ åƒã€‚æˆ‘ä»¬ç°åœ¨æ²¡æœ‰ä½¿ç”¨ä»»ä½• Docker æ–‡ä»¶ã€‚\nmvn spring-boot:build-image è¿è¡Œæ­¤å‘½ä»¤å°†äº§ç”Ÿç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„è¾“å‡ºï¼š\n[INFO] --- spring-boot-maven-plugin:2.3.3.RELEASE:build-image (default-cli) @ usersignup --- [INFO] Building image \u0026#39;docker.io/pratikdas/usersignup:v1\u0026#39; [INFO] [INFO] \u0026gt; Pulling builder image \u0026#39;gcr.io/paketo-buildpacks/builder:base-platform-api-0.3\u0026#39; 0% . . .. [creator] Adding label \u0026#39;org.springframework.boot.version\u0026#39; .. [creator] *** Images (c311fe74ec73): .. [creator] docker.io/pratikdas/usersignup:v1 [INFO] [INFO] Successfully built image \u0026#39;docker.io/pratikdas/usersignup:v1\u0026#39; ä»è¾“å‡ºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° paketo Cloud-Native buildpack è¢«ç”¨æ¥æ„å»ºå¯è¿è¡Œçš„ OCI æ˜ åƒã€‚æ­£å¦‚æˆ‘ä»¬ä¹‹å‰æ‰€åšçš„é‚£æ ·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹åˆ—ä¸º Docker æ˜ åƒçš„æ˜ åƒï¼š\ndocker images è¾“å‡ºï¼š\nREPOSITORY SIZE paketobuildpacks/run 84.3MB gcr.io/paketo-buildpacks/builder 652MB pratikdas/usersignup 257MB ä½¿ç”¨ Jib æ„å»ºå®¹å™¨é•œåƒ Jib æ˜¯ Google çš„ä¸€ä¸ªé•œåƒæ„å»ºå™¨æ’ä»¶ï¼Œæä¾›äº†ä¸€ç§ä»æºä»£ç æ„å»ºå®¹å™¨é•œåƒçš„æ›¿ä»£æ–¹æ³•ã€‚\næˆ‘ä»¬åœ¨ pom.xml ä¸­é…ç½® jib-maven-plugin ï¼š\n\u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;com.google.cloud.tools\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jib-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.5.2\u0026lt;/version\u0026gt; \u0026lt;/plugin\u0026gt; æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ Maven å‘½ä»¤è§¦å‘ Jib æ’ä»¶æ¥æ„å»ºåº”ç”¨ç¨‹åºå¹¶åˆ›å»ºå®¹å™¨æ˜ åƒã€‚å’Œä»¥å‰ä¸€æ ·ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œæ²¡æœ‰ä½¿ç”¨ä»»ä½• Docker æ–‡ä»¶ï¼š\nmvn compile jib:build -Dimage=\u0026lt;docker registry name\u0026gt;/usersignup:v1 è¿è¡Œä¸Šè¿° Maven å‘½ä»¤åï¼Œæˆ‘ä»¬å¾—åˆ°ä»¥ä¸‹è¾“å‡ºï¼š\n[INFO] Containerizing application to pratikdas/usersignup:v1... . . [INFO] Container entrypoint set to [java, -cp, /app/resources:/app/classes:/app/libs/*, io.pratik.users.UsersignupApplication] [INFO] [INFO] Built and pushed image as pratikdas/usersignup:v1 [INFO] Executing tasks: [INFO] [==============================] 100.0% complete è¾“å‡ºæ˜¾ç¤ºå®¹å™¨æ˜ åƒå·²æ„å»ºå¹¶æ¨é€åˆ°æ³¨å†Œè¡¨ã€‚\næ„å»ºä¼˜åŒ–é•œåƒçš„åŠ¨æœºå’ŒæŠ€æœ¯ æˆ‘ä»¬ä¼˜åŒ–çš„ä¸»è¦åŠ¨æœºæœ‰ä¸¤ä¸ªï¼š\næ€§èƒ½ï¼šåœ¨å®¹å™¨ç¼–æ’ç³»ç»Ÿä¸­ï¼Œå®¹å™¨é•œåƒä»é•œåƒä»“åº“æ‹‰å–åˆ°è¿è¡Œå®¹å™¨å¼•æ“çš„ä¸»æœºä¸Šã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºè°ƒåº¦ã€‚ä»æ³¨å†Œè¡¨ä¸­æå–å¤§å‹æ˜ åƒä¼šå¯¼è‡´å®¹å™¨ç¼–æ’ç³»ç»Ÿä¸­çš„è°ƒåº¦æ—¶é—´è¾ƒé•¿ä»¥åŠ CI ç®¡é“ä¸­çš„æ„å»ºæ—¶é—´è¾ƒé•¿ã€‚ å®‰å…¨æ€§ï¼šå¤§å°ºå¯¸å›¾åƒä¹Ÿæœ‰æ›´å¤§çš„æ¼æ´è¡¨é¢ç§¯ã€‚ Docker é•œåƒç”±ä¸€å †å±‚ç»„æˆï¼Œæ¯ä¸ªå±‚ä»£è¡¨ Dockerfile ä¸­çš„ä¸€æ¡æŒ‡ä»¤ã€‚æ¯ä¸€å±‚éƒ½æ˜¯åº•å±‚å˜åŒ–çš„å¢é‡ã€‚å½“æˆ‘ä»¬ä»æ³¨å†Œä¸­å¿ƒæ‹‰å– Docker é•œåƒæ—¶ï¼Œå®ƒæ˜¯è¢«åˆ†å±‚æ‹‰å–å¹¶ç¼“å­˜åœ¨ä¸»æœºä¸­çš„ã€‚\nSpring Boot ä½¿ç”¨â€œfat JARâ€ä½œä¸ºå…¶é»˜è®¤æ‰“åŒ…æ ¼å¼ã€‚å½“æˆ‘ä»¬æ£€æŸ¥ fat JAR æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯¥åº”ç”¨ç¨‹åºåªå æ•´ä¸ª JAR çš„å¾ˆå°ä¸€éƒ¨åˆ†ã€‚è¿™æ˜¯å˜åŒ–æœ€é¢‘ç¹çš„éƒ¨åˆ†ã€‚å…¶ä½™éƒ¨åˆ†ç”± Spring æ¡†æ¶ä¾èµ–é¡¹ç»„æˆã€‚\nä¼˜åŒ–å…¬å¼çš„æ ¸å¿ƒæ˜¯å°†åº”ç”¨ç¨‹åºä¸ Spring æ¡†æ¶ä¾èµ–é¡¹éš”ç¦»åˆ°ä¸€ä¸ªå•ç‹¬çš„å±‚ä¸­ã€‚\næ„æˆ fat JAR å¤§éƒ¨åˆ†çš„ä¾èµ–é¡¹å±‚ä»…ä¸‹è½½ä¸€æ¬¡å¹¶ç¼“å­˜åœ¨ä¸»æœºç³»ç»Ÿä¸­ã€‚\nåœ¨åº”ç”¨ç¨‹åºæ›´æ–°å’Œå®¹å™¨è°ƒåº¦æœŸé—´ï¼Œä»…æ‹‰å–åº”ç”¨ç¨‹åºçš„è–„å±‚ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nè®©æˆ‘ä»¬åœ¨æ¥ä¸‹æ¥çš„éƒ¨åˆ†ä¸­äº†è§£å¦‚ä½•ä¸º Spring Boot åº”ç”¨ç¨‹åºæ„å»ºè¿™äº›ä¼˜åŒ–çš„æ˜ åƒã€‚\nä½¿ç”¨ Buildpack ä¸º Spring Boot åº”ç”¨ç¨‹åºæ„å»ºä¼˜åŒ–çš„å®¹å™¨æ˜ åƒ Spring Boot 2.3 é€šè¿‡å°† fat JAR çš„å„ä¸ªéƒ¨åˆ†æå–åˆ°å•ç‹¬çš„å±‚ä¸­æ¥æ”¯æŒåˆ†å±‚ã€‚åˆ†å±‚åŠŸèƒ½é»˜è®¤å…³é—­ï¼Œéœ€è¦ä½¿ç”¨ Spring Boot Maven æ’ä»¶æ˜¾å¼å¯ç”¨ï¼š\n\u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;layers\u0026gt; \u0026lt;enabled\u0026gt;true\u0026lt;/enabled\u0026gt; \u0026lt;/layers\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt; æˆ‘ä»¬å°†ä½¿ç”¨æ­¤é…ç½®é¦–å…ˆä½¿ç”¨ Buildpack ç”Ÿæˆå®¹å™¨æ˜ åƒï¼Œç„¶ååœ¨ä»¥ä¸‹éƒ¨åˆ†ä¸­ä½¿ç”¨ Docker ç”Ÿæˆå®¹å™¨æ˜ åƒã€‚\nè®©æˆ‘ä»¬è¿è¡Œ Maven build-image ç›®æ ‡æ¥åˆ›å»ºå®¹å™¨æ˜ åƒï¼šimages/stock/-1200x628-branded.jpg\nmvn spring-boot:build-image å¦‚æœæˆ‘ä»¬è¿è¡Œ Dive æ¥æŸ¥çœ‹ç”Ÿæˆå›¾åƒä¸­çš„å„å±‚ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åº”ç”¨ç¨‹åºå±‚ï¼ˆä»¥çº¢è‰²åœˆå‡ºï¼‰åœ¨åƒå­—èŠ‚èŒƒå›´å†…æ¯”æˆ‘ä»¬ä½¿ç”¨ fat JAR æ ¼å¼è·å¾—çš„è¦å°å¾—å¤šï¼š\nä½¿ç”¨ Docker ä¸º Spring Boot åº”ç”¨ç¨‹åºæ„å»ºä¼˜åŒ–çš„å®¹å™¨æ˜ åƒ æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ Docker æ–‡ä»¶åˆ›å»ºåˆ†å±‚çš„ JAR Docker é•œåƒï¼Œè€Œä¸æ˜¯ä½¿ç”¨ Maven æˆ– Gradle æ’ä»¶ã€‚\nå½“æˆ‘ä»¬ä½¿ç”¨ Docker æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œä¸¤ä¸ªé¢å¤–çš„æ­¥éª¤æ¥æå–å±‚å¹¶å°†å…¶å¤åˆ¶åˆ°æœ€ç»ˆæ˜ åƒä¸­ã€‚\nä½¿ç”¨ Maven æ„å»ºå¹¶å¯ç”¨åˆ†å±‚åŠŸèƒ½åï¼Œç”Ÿæˆçš„ JAR å†…å®¹å°†å¦‚ä¸‹æ‰€ç¤ºï¼š\nMETA-INF/ . BOOT-INF/lib/ . BOOT-INF/lib/spring-boot-jarmode-layertools-2.3.3.RELEASE.jar BOOT-INF/classpath.idx BOOT-INF/layers.idx è¾“å‡ºæ˜¾ç¤ºä¸€ä¸ªåä¸º spring-boot-jarmode-layertools çš„é™„åŠ  JAR å’Œä¸€ä¸ª layersfle.idx æ–‡ä»¶ã€‚åˆ†å±‚åŠŸèƒ½ç”±è¿™ä¸ªé™„åŠ  JAR æä¾›ï¼Œå¦‚ä¸‹ä¸€èŠ‚æ‰€è¿°ã€‚\nå–ä¸åŒå±‚ä¸­çš„ä¾èµ–å…³ç³» è¦æŸ¥çœ‹å¹¶ä»åˆ†å±‚ JAR ä¸­æå–å±‚ï¼Œæˆ‘ä»¬ä½¿ç”¨ç³»ç»Ÿå±æ€§ -Djarmode=layertools æ¥å¯åŠ¨ spring-boot-jarmode-layertools JAR è€Œä¸æ˜¯åº”ç”¨ç¨‹åºï¼š\njava -Djarmode=layertools -jar target/usersignup-0.0.1-SNAPSHOT.jar è¿è¡Œæ­¤å‘½ä»¤ä¼šç”ŸæˆåŒ…å«å¯ç”¨å‘½ä»¤é€‰é¡¹çš„è¾“å‡ºï¼š\nUsage: java -Djarmode=layertools -jar usersignup-0.0.1-SNAPSHOT.jar Available commands: list List layers from the jar that can be extracted extract Extracts layers from the jar for image creation help Help about any command è¾“å‡ºæ˜¾ç¤ºå‘½ä»¤ list ã€ extract å’Œ help ï¼Œå…¶ä¸­ help æ˜¯é»˜è®¤å‘½ä»¤ã€‚è®©æˆ‘ä»¬ä½¿ç”¨ list é€‰é¡¹è¿è¡Œå‘½ä»¤ï¼š\njava -Djarmode=layertools -jar target/usersignup-0.0.1-SNAPSHOT.jar list dependencies spring-boot-loader snapshot-dependencies application æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¯ä»¥ä½œä¸ºå±‚æ·»åŠ çš„ä¾èµ–é¡¹åˆ—è¡¨ã€‚\né»˜è®¤å±‚æ˜¯ï¼š\nå›¾å±‚åç§° å†…å®¹ dependencies ç‰ˆæœ¬ä¸åŒ…å« SNAPSHOT çš„ä»»ä½•ä¾èµ–é¡¹ spring-boot-loader JAR åŠ è½½å™¨ç±» snapshot-dependencies ç‰ˆæœ¬åŒ…å« SNAPSHOT çš„ä»»ä½•ä¾èµ–é¡¹ application åº”ç”¨ç¨‹åºç±»å’Œèµ„æº è¿™äº›å±‚æŒ‰ç…§åº”æ·»åŠ åˆ° Docker æ˜ åƒçš„é¡ºåºåœ¨ layers.idx æ–‡ä»¶ä¸­å®šä¹‰ã€‚è¿™äº›å±‚åœ¨ç¬¬ä¸€æ¬¡æ‹‰å–åä¼šç¼“å­˜åœ¨ä¸»æœºä¸­ï¼Œå› ä¸ºå®ƒä»¬ä¸ä¼šæ›´æ”¹ã€‚ä»…å°†æ›´æ–°çš„åº”ç”¨ç¨‹åºå±‚ä¸‹è½½åˆ°ä¸»æœºï¼Œç”±äºå¤§å°å‡å°ï¼Œé€Ÿåº¦æ›´å¿«ã€‚\nä½¿ç”¨åœ¨å•ç‹¬å±‚ä¸­æå–çš„ä¾èµ–é¡¹æ„å»ºå›¾åƒ æˆ‘ä»¬å°†ä½¿ç”¨ç§°ä¸ºå¤šé˜¶æ®µæ„å»ºçš„æ–¹æ³•åˆ†ä¸¤ä¸ªé˜¶æ®µæ„å»ºæœ€ç»ˆå›¾åƒã€‚åœ¨ç¬¬ä¸€é˜¶æ®µï¼Œæˆ‘ä»¬å°†æå–ä¾èµ–é¡¹ï¼Œåœ¨ç¬¬äºŒé˜¶æ®µï¼Œæˆ‘ä»¬å°†æå–çš„ä¾èµ–é¡¹å¤åˆ¶åˆ°æœ€ç»ˆæ˜ åƒã€‚\nè®©æˆ‘ä»¬ä¿®æ”¹ Docker æ–‡ä»¶ä»¥è¿›è¡Œå¤šé˜¶æ®µæ„å»ºï¼š\n# the first stage of our build will extract the layers FROM adoptopenjdk:14-jre-hotspot as builder WORKDIR application ARG JAR_FILE=target/*.jar COPY ${JAR_FILE} application.jar RUN java -Djarmode=layertools -jar application.jar extract # the second stage of our build will copy the extracted layers FROM adoptopenjdk:14-jre-hotspot WORKDIR application COPY --from=builder application/dependencies/ ./ COPY --from=builder application/spring-boot-loader/ ./ COPY --from=builder application/snapshot-dependencies/ ./ COPY --from=builder application/application/ ./ ENTRYPOINT [\u0026#34;java\u0026#34;, \u0026#34;org.springframework.boot.loader.JarLauncher\u0026#34;] æˆ‘ä»¬å°†æ­¤é…ç½®ä¿å­˜åœ¨å•ç‹¬çš„æ–‡ä»¶ä¸­ - Dockerfile2 ã€‚\næˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ„å»º Docker é•œåƒï¼š\ndocker build -f Dockerfile2 -t usersignup:v1 . è¿è¡Œæ­¤å‘½ä»¤åï¼Œæˆ‘ä»¬å¾—åˆ°ä»¥ä¸‹è¾“å‡ºï¼š\nSending build context to Docker daemon 20.41MB Step 1/12 : FROM adoptopenjdk:14-jre-hotspot as builder 14-jre-hotspot: Pulling from library/adoptopenjdk . . Successfully built a9ebf6970841 Successfully tagged userssignup:v1 æˆ‘ä»¬å¯ä»¥çœ‹åˆ° Docker é•œåƒæ˜¯ä½¿ç”¨é•œåƒ ID åˆ›å»ºçš„ï¼Œç„¶åè¢«æ ‡è®°çš„ã€‚\næœ€åï¼Œæˆ‘ä»¬åƒä»¥å‰ä¸€æ ·è¿è¡Œ Dive å‘½ä»¤æ¥æ£€æŸ¥ç”Ÿæˆçš„ Docker é•œåƒå†…çš„å±‚ã€‚æˆ‘ä»¬å¯ä»¥æŒ‡å®šå›¾åƒ ID æˆ–æ ‡ç­¾ä½œä¸º Dive å‘½ä»¤çš„è¾“å…¥ï¼š\ndive userssignup:v1 æ­£å¦‚æˆ‘ä»¬åœ¨è¾“å‡ºä¸­çœ‹åˆ°çš„ï¼ŒåŒ…å«åº”ç”¨ç¨‹åºçš„å±‚ç°åœ¨åªæœ‰ 11 kBï¼Œä¾èµ–é¡¹ç¼“å­˜åœ¨å•ç‹¬çš„å±‚ä¸­ã€‚\næå–ä¸åŒå±‚ä¸­çš„å†…éƒ¨ä¾èµ–å…³ç³» æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨å•ç‹¬çš„å±‚ä¸­æå–ä»»ä½•è‡ªå®šä¹‰ä¾èµ–é¡¹æ¥è¿›ä¸€æ­¥å‡å°åº”ç”¨ç¨‹åºå±‚çš„å¤§å°ï¼Œè€Œä¸æ˜¯é€šè¿‡åœ¨åä¸º layers.idx çš„ yml ç±»ä¼¼æ–‡ä»¶ä¸­å£°æ˜å®ƒä»¬æ¥å°†å®ƒä»¬ä¸åº”ç”¨ç¨‹åºä¸€èµ·æ‰“åŒ…ï¼š\n- \u0026#34;dependencies\u0026#34;: - \u0026#34;BOOT-INF/lib/\u0026#34; - \u0026#34;spring-boot-loader\u0026#34;: - \u0026#34;org/\u0026#34; - \u0026#34;snapshot-dependencies\u0026#34;: - \u0026#34;custom-dependencies\u0026#34;: - \u0026#34;io/myorg/\u0026#34; - \u0026#34;application\u0026#34;: - \u0026#34;BOOT-INF/classes/\u0026#34; - \u0026#34;BOOT-INF/classpath.idx\u0026#34; - \u0026#34;BOOT-INF/layers.idx\u0026#34; - \u0026#34;META-INF/\u0026#34; åœ¨æ­¤æ–‡ä»¶ä¸­ - layers.idx æˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªåä¸º io.myorg çš„è‡ªå®šä¹‰ä¾èµ–é¡¹ï¼Œå…¶ä¸­åŒ…å«ä»å…±äº«å­˜å‚¨åº“ä¸­æå–çš„ç»„ç»‡ä¾èµ–é¡¹ã€‚\nç»“è®º åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ç ”ç©¶äº†ä½¿ç”¨äº‘åŸç”Ÿ Buildpack ç›´æ¥ä»æºä»£ç åˆ›å»ºå®¹å™¨æ˜ åƒã€‚è¿™æ˜¯ä½¿ç”¨ Docker æ„å»ºå®¹å™¨æ˜ åƒçš„ä¼ ç»Ÿæ–¹å¼çš„æ›¿ä»£æ–¹æ¡ˆï¼Œé¦–å…ˆæ„å»º fat å¯æ‰§è¡Œ JARï¼Œç„¶åé€šè¿‡åœ¨ Dockerfile ä¸­æŒ‡å®šæŒ‡ä»¤å°†å…¶æ‰“åŒ…åˆ°å®¹å™¨æ˜ åƒä¸­ã€‚\næˆ‘ä»¬è¿˜è€ƒè™‘é€šè¿‡å¯ç”¨åˆ†å±‚åŠŸèƒ½æ¥ä¼˜åŒ–æˆ‘ä»¬çš„å®¹å™¨ï¼Œè¯¥åŠŸèƒ½æå–ç¼“å­˜åœ¨ä¸»æœºä¸­çš„å•ç‹¬å±‚ä¸­çš„ä¾èµ–é¡¹ï¼Œå¹¶åœ¨å®¹å™¨è¿è¡Œæ—¶å¼•æ“çš„è°ƒåº¦æœŸé—´ä¸‹è½½åº”ç”¨ç¨‹åºçš„è–„å±‚ã€‚\næ–‡ç« ä¸­ä½¿ç”¨çš„æ‰€æœ‰æºç å¯ä»¥å‚è€ƒGithubä¸Šçš„ã€‚\nå‘½ä»¤å‚è€ƒ ä»¥ä¸‹æ˜¯æˆ‘ä»¬åœ¨æœ¬æ–‡ä¸­ä½¿ç”¨çš„å‘½ä»¤æ‘˜è¦ï¼Œä»¥ä¾›å¿«é€Ÿå‚è€ƒã€‚\næ¸…æ´æˆ‘ä»¬çš„ç¯å¢ƒï¼š\ndocker system prune -a ä½¿ç”¨ Docker æ–‡ä»¶æ„å»ºå®¹å™¨é•œåƒï¼š\ndocker build -f \u0026lt;Docker file name\u0026gt; -t \u0026lt;tag\u0026gt; . ä»æºä»£ç æ„å»ºå®¹å™¨é•œåƒï¼ˆæ²¡æœ‰ Dockerfileï¼‰ï¼š\nmvn spring-boot:build-image æŸ¥çœ‹ä¾èµ–å…³ç³»å±‚ã€‚åœ¨æ„å»ºåº”ç”¨ç¨‹åº JAR ä¹‹å‰ï¼Œç¡®ä¿åœ¨ spring-boot-maven-plugin ä¸­å¯ç”¨åˆ†å±‚åŠŸèƒ½ï¼š\njava -Djarmode=layertools -jar application.jar list æå–ä¾èµ–å±‚ã€‚åœ¨æ„å»ºåº”ç”¨ç¨‹åº JAR ä¹‹å‰ï¼Œç¡®ä¿åœ¨ spring-boot-maven-plugin ä¸­å¯ç”¨åˆ†å±‚åŠŸèƒ½ï¼š\njava -Djarmode=layertools -jar application.jar extract æŸ¥çœ‹å®¹å™¨é•œåƒåˆ—è¡¨\ndocker images æŸ¥çœ‹å®¹å™¨é•œåƒå†…çš„å±‚ï¼ˆç¡®ä¿å·²å®‰è£… dive tool å·¥å…·ï¼‰ï¼š\ndive \u0026lt;image ID or image tag\u0026gt; åŸæ–‡é“¾æ¥ï¼šhttps://reflectoring.io/spring-boot-docker/\n","permalink":"https://blog.chensoul.cc/posts/2023/08/16/spring-boot-docker/","summary":"å®¹å™¨å·²æˆä¸ºæ‰“åŒ…å…·æœ‰æ‰€æœ‰è½¯ä»¶å’Œæ“ä½œç³»ç»Ÿä¾èµ–é¡¹çš„åº”ç”¨ç¨‹åºï¼Œç„¶åå°†å…¶ä¼ é€åˆ°ä¸åŒç¯å¢ƒçš„é¦–é€‰æ–¹å¼ã€‚\næœ¬æ–‡ç€çœ¼äºå®¹å™¨åŒ– Spring Boot åº”ç”¨ç¨‹åºçš„ä¸åŒæ–¹æ³•ï¼š\nä½¿ç”¨ Docker æ–‡ä»¶æ„å»º Docker é•œåƒï¼Œ ä½¿ç”¨ Cloud-Native Buildpack ä»æºä»£ç æ„å»º OCI æ˜ åƒï¼Œ é€šè¿‡ä½¿ç”¨åˆ†å±‚å·¥å…·å°† JAR çš„å„ä¸ªéƒ¨åˆ†æ‹†åˆ†ä¸ºä¸åŒçš„å±‚ï¼Œåœ¨è¿è¡Œæ—¶ä¼˜åŒ–æ˜ åƒã€‚ ç¤ºä¾‹ä»£ç  æœ¬æ–‡é™„æœ‰ GitHub ä¸Šçš„å·¥ä½œä»£ç ç¤ºä¾‹ã€‚\nå®¹å™¨æœ¯è¯­ æˆ‘ä»¬å°†ä»æ•´ç¯‡æ–‡ç« ä¸­ä½¿ç”¨çš„å®¹å™¨æœ¯è¯­å¼€å§‹ï¼š\nContainer image: å…·æœ‰ç‰¹å®šæ ¼å¼çš„æ–‡ä»¶ã€‚æˆ‘ä»¬é€šè¿‡è¿è¡Œæ„å»ºå·¥å…·å°†åº”ç”¨ç¨‹åºè½¬æ¢ä¸ºå®¹å™¨æ˜ åƒã€‚ Container: å®¹å™¨é•œåƒçš„è¿è¡Œæ—¶å®ä¾‹ã€‚ Container engine: t è´Ÿè´£è¿è¡Œ Container çš„å®ˆæŠ¤è¿›ç¨‹ã€‚ Container host: å®¹å™¨å¼•æ“è¿è¡Œçš„ä¸»æœºã€‚ Container registry: ç”¨äºå‘å¸ƒå’Œåˆ†å‘å®¹å™¨æ˜ åƒçš„å…±äº«ä½ç½®ã€‚ OCI Standard: å¼€æ”¾å®¹å™¨å€¡è®® (OCI) æ˜¯åœ¨ Linux åŸºé‡‘ä¼šä¸‹å½¢æˆçš„ä¸€ä¸ªè½»é‡çº§ã€å¼€æ”¾çš„æ²»ç†ç»“æ„ã€‚ OCI é•œåƒè§„èŒƒå®šä¹‰äº†å®¹å™¨é•œåƒæ ¼å¼å’Œè¿è¡Œæ—¶çš„è¡Œä¸šæ ‡å‡†ï¼Œä»¥ç¡®ä¿æ‰€æœ‰å®¹å™¨å¼•æ“éƒ½å¯ä»¥è¿è¡Œä»»ä½•æ„å»ºå·¥å…·ç”Ÿæˆçš„å®¹å™¨é•œåƒã€‚ ä¸ºäº†å®¹å™¨åŒ–åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬å°†åº”ç”¨ç¨‹åºå°è£…åœ¨å®¹å™¨æ˜ åƒä¸­ï¼Œå¹¶å°†è¯¥æ˜ åƒå‘å¸ƒåˆ°å…±äº«æ³¨å†Œè¡¨ã€‚å®¹å™¨è¿è¡Œæ—¶ä»æ³¨å†Œè¡¨ä¸­æå–è¯¥æ˜ åƒï¼Œè§£å‹è¯¥æ˜ åƒï¼Œç„¶ååœ¨å…¶ä¸­è¿è¡Œåº”ç”¨ç¨‹åºã€‚\nSpring Boot 2.3 ç‰ˆæœ¬æä¾›äº†ç”¨äºæ„å»º OCI æ˜ åƒçš„æ’ä»¶ã€‚\nDocker æ°å¥½æ˜¯æœ€å¸¸ç”¨çš„å®¹å™¨å®ç°ï¼Œå¹¶ä¸”æˆ‘ä»¬åœ¨ç¤ºä¾‹ä¸­ä½¿ç”¨ Dockerï¼Œå› æ­¤æœ¬æ–‡ä¸­æ‰€æœ‰åç»­å¯¹å®¹å™¨çš„å¼•ç”¨éƒ½å°†æŒ‡ Dockerã€‚\nä»¥ä¼ ç»Ÿæ–¹å¼æ„å»ºå®¹å™¨é•œåƒ é€šè¿‡å‘ Docker æ–‡ä»¶æ·»åŠ ä¸€äº›æŒ‡ä»¤ï¼Œå¯ä»¥éå¸¸è½»æ¾åœ°åˆ›å»º Spring Boot åº”ç”¨ç¨‹åºçš„ Docker é•œåƒã€‚\næˆ‘ä»¬é¦–å…ˆæ„å»ºä¸€ä¸ªå¯æ‰§è¡Œ JARï¼Œå¹¶ä½œä¸º Docker æ–‡ä»¶æŒ‡ä»¤çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨åº”ç”¨å¿…è¦çš„è‡ªå®šä¹‰åå°†å¯æ‰§è¡Œ JAR å¤åˆ¶åˆ°åŸºæœ¬ JRE æ˜ åƒä¸Šã€‚\nè®©æˆ‘ä»¬ä» Spring Initializr åˆ›å»ºå¸¦æœ‰ web ã€ lombok å’Œ actuator ä¾èµ–é¡¹çš„ Spring Boot åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬è¿˜æ·»åŠ äº†ä¸€ä¸ªä¼‘æ¯æ§åˆ¶å™¨æ¥ä½¿ç”¨ GET æ–¹æ³•å…¬å¼€ APIã€‚\nåˆ›å»º Docker æ–‡ä»¶ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡æ·»åŠ  Dockerfile æ¥å®¹å™¨åŒ–è¯¥åº”ç”¨ç¨‹åºï¼š","title":"[è¯‘]ä¸º Spring Boot åº”ç”¨ç¨‹åºåˆ›å»ºä¼˜åŒ–çš„ Docker æ˜ åƒ"},{"content":"æ‚¨å¯ä»¥ä½¿ç”¨æœ¬æŒ‡å—æ¥äº†è§£ Spring Security æ˜¯ä»€ä¹ˆä»¥åŠå…¶æ ¸å¿ƒåŠŸèƒ½ï¼ˆå¦‚èº«ä»½éªŒè¯ã€æˆæƒæˆ–å¸¸è§æ¼æ´ä¿æŠ¤ï¼‰å¦‚ä½•å·¥ä½œã€‚æ­¤å¤–ï¼Œè¿˜æœ‰å…¨é¢çš„å¸¸è§é—®é¢˜è§£ç­”ã€‚\nï¼ˆç¼–è€…æ³¨ï¼šå¤§çº¦ 6500 å­—ï¼Œæ‚¨å¯èƒ½ä¸æƒ³å°è¯•åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šé˜…è¯»æœ¬æ–‡ã€‚å°†å…¶æ·»åŠ ä¸ºä¹¦ç­¾ï¼Œç¨åå†å›æ¥ã€‚ï¼‰\nä»‹ç» è¿Ÿæ—©æ¯ä¸ªäººéƒ½éœ€è¦ä¸ºå…¶é¡¹ç›®æ·»åŠ å®‰å…¨æ€§ï¼Œåœ¨ Spring ç”Ÿæ€ç³»ç»Ÿä¸­ï¼Œæ‚¨å¯ä»¥å€ŸåŠ© Spring Security åº“æ¥å®ç°è¿™ä¸€ç‚¹ã€‚\nå› æ­¤ï¼Œæ‚¨ç»§ç»­å°† Spring Security æ·»åŠ åˆ°æ‚¨çš„ Spring Bootï¼ˆæˆ–æ™®é€š Springï¼‰é¡¹ç›®ä¸­ï¼Œç„¶åçªç„¶â€¦â€¦â€‹\n\u0026hellip;æ‚¨æœ‰è‡ªåŠ¨ç”Ÿæˆçš„ç™»å½•é¡µé¢ã€‚ \u0026hellip;æ‚¨æ— æ³•å†æ‰§è¡Œ POST è¯·æ±‚ã€‚ \u0026hellip;â€‹ æ‚¨çš„æ•´ä¸ªåº”ç”¨ç¨‹åºå¤„äºé”å®šçŠ¶æ€ï¼Œå¹¶æç¤ºæ‚¨è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚ åœ¨ç»å†äº†éšåçš„ç²¾ç¥å´©æºƒä¹‹åï¼Œæ‚¨å¯èƒ½ä¼šå¯¹è¿™ä¸€åˆ‡æ˜¯å¦‚ä½•è¿ä½œçš„æ„Ÿå…´è¶£ã€‚\nä»€ä¹ˆæ˜¯ Spring Security ä»¥åŠå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ ç®€çŸ­çš„å›ç­”ï¼š ä»æœ¬è´¨ä¸Šè®²ï¼ŒSpring Security å®é™…ä¸Šåªæ˜¯ä¸€å † servlet è¿‡æ»¤å™¨ï¼Œå¯å¸®åŠ©æ‚¨å‘ Web åº”ç”¨ç¨‹åºæ·»åŠ èº«ä»½éªŒè¯å’Œæˆæƒã€‚ å®ƒè¿˜ä¸ Spring Web MVCï¼ˆæˆ– Spring Bootï¼‰ç­‰æ¡†æ¶ä»¥åŠ OAuth2 æˆ– SAML ç­‰æ ‡å‡†å¾ˆå¥½åœ°é›†æˆã€‚å®ƒä¼šè‡ªåŠ¨ç”Ÿæˆç™»å½•/æ³¨é”€é¡µé¢å¹¶é˜²æ­¢ CSRF ç­‰å¸¸è§æ¼æ´ã€‚ ç°åœ¨ï¼Œè¿™å¹¶æ²¡æœ‰ä»€ä¹ˆå¸®åŠ©ï¼Œä¸æ˜¯å—ï¼Ÿ å¹¸è¿çš„æ˜¯ï¼Œè¿˜æœ‰ä¸€ä¸ªå¾ˆé•¿çš„ç­”æ¡ˆï¼šæœ¬æ–‡çš„å…¶ä½™éƒ¨åˆ†ã€‚\nç½‘ç»œåº”ç”¨ç¨‹åºå®‰å…¨ï¼š101 åœ¨æˆä¸º Spring Security å¤§å¸ˆä¹‹å‰ï¼Œæ‚¨éœ€è¦äº†è§£ä¸‰ä¸ªé‡è¦æ¦‚å¿µï¼š\nAuthentication éªŒè¯ Authorization æˆæƒ Servlet Filters è¿‡æ»¤å™¨ å»ºè®®ï¼šä¸è¦è·³è¿‡æœ¬èŠ‚ï¼Œå› ä¸ºå®ƒæ˜¯ Spring Security æ‰€åšçš„ä¸€åˆ‡çš„åŸºç¡€ã€‚å¦å¤–ï¼Œæˆ‘ä¼šè®©å®ƒå°½å¯èƒ½æœ‰è¶£ã€‚\n1. è®¤è¯ é¦–å…ˆï¼Œå¦‚æœæ‚¨æ­£åœ¨è¿è¡Œå…¸å‹çš„ï¼ˆWebï¼‰åº”ç”¨ç¨‹åºï¼Œæ‚¨éœ€è¦ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ã€‚è¿™æ„å‘³ç€æ‚¨çš„åº”ç”¨ç¨‹åºéœ€è¦éªŒè¯ç”¨æˆ·æ˜¯å¦æ˜¯ä»–æ‰€å£°ç§°çš„äººï¼Œé€šå¸¸é€šè¿‡ç”¨æˆ·åå’Œå¯†ç æ£€æŸ¥æ¥å®Œæˆã€‚\nç”¨æˆ·ï¼šâ€œæˆ‘æ˜¯ç¾å›½æ€»ç»Ÿã€‚æˆ‘çš„ *username* æ˜¯ï¼špotusï¼â€ æ‚¨çš„ç½‘ç»œåº”ç”¨ç¨‹åºï¼šâ€œå½“ç„¶å¯ä»¥ï¼Œé‚£ä¹ˆæ‚¨çš„ *password* æ˜¯ä»€ä¹ˆï¼Œæ€»ç»Ÿå…ˆç”Ÿï¼Ÿâ€ ç”¨æˆ·ï¼šâ€œæˆ‘çš„å¯†ç æ˜¯ï¼šth3don4ldâ€ã€‚ æ‚¨çš„ç½‘ç»œåº”ç”¨ç¨‹åºï¼šâ€œæ­£ç¡®ã€‚æ¬¢è¿ï¼Œå…ˆç”Ÿï¼â€\n2ã€æˆæƒ åœ¨æ›´ç®€å•çš„åº”ç”¨ç¨‹åºä¸­ï¼Œèº«ä»½éªŒè¯å¯èƒ½å°±è¶³å¤Ÿäº†ï¼šç”¨æˆ·ç»è¿‡èº«ä»½éªŒè¯åï¼Œå¥¹å°±å¯ä»¥è®¿é—®åº”ç”¨ç¨‹åºçš„æ¯ä¸ªéƒ¨åˆ†ã€‚\nä½†å¤§å¤šæ•°åº”ç”¨ç¨‹åºéƒ½æœ‰æƒé™ï¼ˆæˆ–è§’è‰²ï¼‰çš„æ¦‚å¿µã€‚æƒ³è±¡ä¸€ä¸‹ï¼šå¯ä»¥è®¿é—®æ‚¨çš„ç½‘ä¸Šå•†åº—é¢å‘å…¬ä¼—çš„å‰ç«¯çš„å®¢æˆ·ï¼Œä»¥åŠå¯ä»¥è®¿é—®å•ç‹¬ç®¡ç†åŒºåŸŸçš„ç®¡ç†å‘˜ã€‚\nä¸¤ç§ç±»å‹çš„ç”¨æˆ·éƒ½éœ€è¦ç™»å½•ï¼Œä½†èº«ä»½éªŒè¯è¿™ä¸€äº‹å®å¹¶ä¸èƒ½è¯´æ˜ä»–ä»¬å¯ä»¥åœ¨ç³»ç»Ÿä¸­æ‰§è¡Œå“ªäº›æ“ä½œã€‚å› æ­¤ï¼Œæ‚¨è¿˜éœ€è¦æ£€æŸ¥ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·çš„æƒé™ï¼Œå³æ‚¨éœ€è¦æˆæƒè¯¥ç”¨æˆ·ã€‚\nç”¨æˆ·ï¼šâ€œè®©æˆ‘ç©é‚£ä¸ªæ ¸è¶³çƒ\u0026hellip;\u0026hellip;â€ã€‚ æ‚¨çš„ç½‘ç»œåº”ç”¨ç¨‹åºï¼šâ€œç­‰ä¸€ä¸‹ï¼Œæˆ‘éœ€è¦å…ˆæ£€æŸ¥æ‚¨çš„ *permissions* â€¦â€¦æ˜¯çš„ï¼Œæ€»ç»Ÿå…ˆç”Ÿï¼Œæ‚¨æ‹¥æœ‰æ­£ç¡®çš„è®¸å¯çº§åˆ«ã€‚å°½æƒ…äº«å—å§ã€‚â€ ç”¨æˆ·ï¼šâ€œé‚£ä¸ªçº¢è‰²æŒ‰é’®åˆæ˜¯ä»€ä¹ˆâ€¦â€¦â€‹ï¼Ÿâ€\n3.Servlet è¿‡æ»¤å™¨ æœ€åä½†å¹¶éæœ€ä¸é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ Servlet è¿‡æ»¤å™¨ã€‚å®ƒä»¬ä¸èº«ä»½éªŒè¯å’Œæˆæƒæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ ï¼ˆå¦‚æœæ‚¨å¯¹ Java Servlet æˆ– Filter å®Œå…¨é™Œç”Ÿï¼Œæˆ‘å»ºè®®æ‚¨é˜…è¯»æ—§çš„ä½†ä»ç„¶éå¸¸æœ‰æ•ˆçš„ Head First Servlets ä¹¦ã€‚ï¼‰\nä¸ºä»€ä¹ˆä½¿ç”¨ Servlet è¿‡æ»¤å™¨ï¼Ÿ å›æƒ³ä¸€ä¸‹æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å‘ç°åŸºæœ¬ä¸Šä»»ä½• Spring Web åº”ç”¨ç¨‹åºéƒ½åªæ˜¯ä¸€ä¸ª servletï¼šSpring çš„æ—§å¼ DispatcherServletï¼Œå®ƒå°†ä¼ å…¥çš„ HTTP è¯·æ±‚ï¼ˆä¾‹å¦‚æ¥è‡ªæµè§ˆå™¨ï¼‰é‡å®šå‘åˆ° @Controllers æˆ– @RestControllersã€‚ é—®é¢˜æ˜¯ï¼šDispatcherServlet ä¸­æ²¡æœ‰ç¡¬ç¼–ç å®‰å…¨æ€§ï¼Œè€Œä¸”æ‚¨ä¹Ÿå¾ˆå¯èƒ½ä¸æƒ³åœ¨ @Controllers ä¸­æ‘¸ç´¢åŸå§‹ HTTP Basic Auth æ ‡å¤´ã€‚æœ€ä½³æƒ…å†µä¸‹ï¼Œèº«ä»½éªŒè¯å’Œæˆæƒåº”è¯¥åœ¨è¯·æ±‚åˆ°è¾¾ @Controller ä¹‹å‰å®Œæˆã€‚ å¹¸è¿çš„æ˜¯ï¼Œåœ¨ Java Web ä¸–ç•Œä¸­æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼šæ‚¨å¯ä»¥å°†è¿‡æ»¤å™¨æ”¾åœ¨ servlet å‰é¢ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥è€ƒè™‘ç¼–å†™ä¸€ä¸ª SecurityFilter å¹¶åœ¨ Tomcatï¼ˆservlet å®¹å™¨/åº”ç”¨ç¨‹åºæœåŠ¡å™¨ï¼‰ä¸­é…ç½®å®ƒæ¥è¿‡æ»¤æ¯ä¸ªä¼ å…¥çš„å†…å®¹ HTTP è¯·æ±‚åœ¨åˆ°è¾¾æ‚¨çš„ servlet ä¹‹å‰ã€‚\nä¸€ä¸ªåŸç”Ÿçš„å®‰å…¨è¿‡æ»¤å™¨ SecurityFilter å¤§çº¦æœ‰ 4 ä¸ªä»»åŠ¡ï¼Œç®€å•ä¸”è¿‡äºç®€åŒ–çš„å®ç°å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š\nimport javax.servlet.*; import javax.servlet.http.HttpFilter; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; import java.io.IOException; public class SecurityServletFilter extends HttpFilter { @Override protected void doFilter(HttpServletRequest request, HttpServletResponse response, FilterChain chain) throws IOException, ServletException { UsernamePasswordToken token = extractUsernameAndPasswordFrom(request); // (1) if (notAuthenticated(token)) { // (2) // either no or wrong username/password // unfortunately the HTTP status code is called \u0026#34;unauthorized\u0026#34;, instead of \u0026#34;unauthenticated\u0026#34; response.setStatus(HttpServletResponse.SC_UNAUTHORIZED); // HTTP 401. return; } if (notAuthorized(token, request)) { // (3) // you are logged in, but don\u0026#39;t have the proper rights response.setStatus(HttpServletResponse.SC_FORBIDDEN); // HTTP 403 return; } // allow the HttpRequest to go to Spring\u0026#39;s DispatcherServlet // and @RestControllers/@Controllers. chain.doFilter(request, response); // (4) } private UsernamePasswordToken extractUsernameAndPasswordFrom(HttpServletRequest request) { // Either try and read in a Basic Auth HTTP Header, which comes in the form of user:password // Or try and find form login request parameters or POST bodies, i.e. \u0026#34;username=me\u0026#34; \u0026amp; \u0026#34;password=\u0026#34;myPass\u0026#34; return checkVariousLoginOptions(request); } private boolean notAuthenticated(UsernamePasswordToken token) { // compare the token with what you have in your database...or in-memory...or in LDAP... return false; } private boolean notAuthorized(UsernamePasswordToken token, HttpServletRequest request) { // check if currently authenticated user has the permission/role to access this request\u0026#39;s /URI // e.g. /admin needs a ROLE_ADMIN , /callcenter needs ROLE_CALLCENTER, etc. return false; } } é¦–å…ˆï¼Œè¿‡æ»¤å™¨éœ€è¦ä»è¯·æ±‚ä¸­æå–ç”¨æˆ·å/å¯†ç ã€‚å®ƒå¯ä»¥é€šè¿‡åŸºæœ¬èº«ä»½éªŒè¯ HTTP æ ‡å¤´ã€è¡¨å•å­—æ®µæˆ– cookie ç­‰å®ç°ã€‚ ç„¶åï¼Œè¿‡æ»¤å™¨éœ€è¦æ ¹æ®æŸäº›å†…å®¹ï¼ˆä¾‹å¦‚æ•°æ®åº“ï¼‰éªŒè¯ç”¨æˆ·å/å¯†ç ç»„åˆã€‚ æˆåŠŸéªŒè¯åï¼Œè¿‡æ»¤å™¨éœ€è¦æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰æƒè®¿é—®æ‰€è¯·æ±‚çš„ URIã€‚ å¦‚æœè¯·æ±‚é€šè¿‡äº†æ‰€æœ‰è¿™äº›æ£€æŸ¥ï¼Œé‚£ä¹ˆè¿‡æ»¤å™¨å¯ä»¥è®©è¯·æ±‚ä¼ é€’åˆ°æ‚¨çš„ DispatcherServletï¼Œå³æ‚¨çš„ @Controllerã€‚ è¿‡æ»¤å™¨é“¾ ç°å®æ£€æŸ¥ï¼šè™½ç„¶ä¸Šè¿°ä»£ç å¯ä»¥ç¼–è¯‘ï¼Œä½†å®ƒè¿Ÿæ—©ä¼šå¯¼è‡´ä¸€ä¸ªæ€ªç‰©è¿‡æ»¤å™¨ï¼Œå…¶ä¸­åŒ…å«å¤§é‡ç”¨äºå„ç§èº«ä»½éªŒè¯å’Œæˆæƒæœºåˆ¶çš„ä»£ç ã€‚\nç„¶è€Œï¼Œåœ¨ç°å®ä¸–ç•Œä¸­ï¼Œæ‚¨å¯ä»¥å°†è¿™ä¸ªè¿‡æ»¤å™¨æ‹†åˆ†ä¸ºå¤šä¸ªè¿‡æ»¤å™¨ï¼Œç„¶åå°†å®ƒä»¬é“¾æ¥åœ¨ä¸€èµ·ã€‚\nä¾‹å¦‚ï¼Œä¼ å…¥çš„ HTTP è¯·æ±‚å°†\u0026hellip;â€‹\né¦–å…ˆï¼Œé€šè¿‡ LoginMethodFilter\u0026hellip;â€‹ ç„¶åï¼Œé€šè¿‡ AuthenticationFilter\u0026hellip;â€‹ ç„¶åï¼Œé€šè¿‡æˆæƒè¿‡æ»¤å™¨\u0026hellip;â€‹ æœ€åï¼Œç‚¹å‡»æ‚¨çš„ servletã€‚ è¿™ä¸ªæ¦‚å¿µç§°ä¸º FilterChainï¼Œä¸Šé¢è¿‡æ»¤å™¨ä¸­çš„æœ€åä¸€ä¸ªæ–¹æ³•è°ƒç”¨å®é™…ä¸Šå§”æ‰˜ç»™äº†è¯¥é“¾ï¼š\nchain.doFilter(request, response); ä½¿ç”¨è¿™æ ·çš„è¿‡æ»¤å™¨ï¼ˆé“¾ï¼‰ï¼Œæ‚¨åŸºæœ¬ä¸Šå¯ä»¥å¤„ç†åº”ç”¨ç¨‹åºä¸­å­˜åœ¨çš„æ¯ä¸ªèº«ä»½éªŒè¯æˆ–æˆæƒé—®é¢˜ï¼Œè€Œæ— éœ€æ›´æ”¹å®é™…çš„åº”ç”¨ç¨‹åºå®ç°ï¼ˆæƒ³æƒ³ï¼šæ‚¨çš„@RestControllers / @Controllersï¼‰ã€‚\næœ‰äº†è¿™äº›çŸ¥è¯†ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ Spring Security å¦‚ä½•åˆ©ç”¨è¿™ç§è¿‡æ»¤é­”æ³•ã€‚\nFilterChain å’Œå®‰å…¨é…ç½® DSL æˆ‘ä»¬å°†ä» Spring Security çš„ FilterChain å¼€å§‹ï¼Œä»¥ä¸ä¸Šä¸€ç« ç›¸åçš„æ–¹å‘å¼€å§‹ä»‹ç» Spring Securityã€‚\nSpring çš„ DefaultSecurityFilterChain å‡è®¾æ‚¨æ­£ç¡®è®¾ç½®äº† Spring Securityï¼Œç„¶åå¯åŠ¨æ‚¨çš„ Web åº”ç”¨ç¨‹åºã€‚æ‚¨å°†çœ‹åˆ°ä»¥ä¸‹æ—¥å¿—æ¶ˆæ¯ï¼š\n2020-02-25 10:24:27.875 INFO 11116 --- [ main] o.s.s.web.DefaultSecurityFilterChain : Creating filter chain: any request, [org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@46320c9a, org.springframework.security.web.context.SecurityContextPersistenceFilter@4d98e41b, org.springframework.security.web.header.HeaderWriterFilter@52bd9a27, org.springframework.security.web.csrf.CsrfFilter@51c65a43, org.springframework.security.web.authentication.logout.LogoutFilter@124d26ba, org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter@61e86192, org.springframework.security.web.authentication.ui.DefaultLoginPageGeneratingFilter@10980560, org.springframework.security.web.authentication.ui.DefaultLogoutPageGeneratingFilter@32256e68, org.springframework.security.web.authentication.www.BasicAuthenticationFilter@52d0f583, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@5696c927, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@5f025000, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@5e7abaf7, org.springframework.security.web.session.SessionManagementFilter@681c0ae6, org.springframework.security.web.access.ExceptionTranslationFilter@15639d09, org.springframework.security.web.access.intercept.FilterSecurityInterceptor@4f7be6c8]| å¦‚æœå°†è¿™ä¸€è¡Œå±•å¼€åˆ°åˆ—è¡¨ä¸­ï¼Œçœ‹èµ·æ¥ Spring Security ä¸ä»…ä»…å®‰è£…ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œè€Œæ˜¯å®‰è£…ç”± 15 ä¸ªï¼ˆï¼ï¼‰ä¸åŒè¿‡æ»¤å™¨ç»„æˆçš„æ•´ä¸ªè¿‡æ»¤å™¨é“¾ã€‚\nå› æ­¤ï¼Œå½“ HTTPRequest ä¼ å…¥æ—¶ï¼Œå®ƒå°†é€šè¿‡æ‰€æœ‰è¿™ 15 ä¸ªè¿‡æ»¤å™¨ï¼Œç„¶åæ‚¨çš„è¯·æ±‚æœ€ç»ˆåˆ°è¾¾ @RestControllersã€‚é¡ºåºä¹Ÿå¾ˆé‡è¦ï¼Œä»åˆ—è¡¨çš„é¡¶éƒ¨å¼€å§‹ä¸€ç›´åˆ°åº•éƒ¨ã€‚\nåˆ†æ Spring çš„ FilterChain è¯¦ç»†æŸ¥çœ‹è¯¥é“¾ä¸­çš„æ¯ä¸ªè¿‡æ»¤å™¨å°±å¤ªè¿‡åˆ†äº†ï¼Œä½†è¿™é‡Œæ˜¯å¯¹å…¶ä¸­ä¸€äº›è¿‡æ»¤å™¨çš„è§£é‡Šã€‚è¯·éšæ„æŸ¥çœ‹ Spring Security çš„æºä»£ç ä»¥äº†è§£å…¶ä»–è¿‡æ»¤å™¨ã€‚\nBasicAuthenticationFilter: å°è¯•åœ¨è¯·æ±‚ä¸­æŸ¥æ‰¾åŸºæœ¬èº«ä»½éªŒè¯ HTTP æ ‡å¤´ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œåˆ™å°è¯•ä½¿ç”¨æ ‡å¤´çš„ç”¨æˆ·åå’Œå¯†ç å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ã€‚ UsernamePasswordAuthenticationFilter: T å°è¯•æŸ¥æ‰¾ç”¨æˆ·å/å¯†ç è¯·æ±‚å‚æ•°/POST æ­£æ–‡ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œåˆ™å°è¯•ä½¿ç”¨è¿™äº›å€¼å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ã€‚ DefaultLoginPageGeneratingFilter: å¦‚æœæ‚¨æ²¡æœ‰æ˜ç¡®ç¦ç”¨è¯¥åŠŸèƒ½ï¼Œåˆ™ä¸ºæ‚¨ç”Ÿæˆç™»å½•é¡µé¢ã€‚è¿™ä¸ªè¿‡æ»¤å™¨å°±æ˜¯æ‚¨åœ¨å¯ç”¨ Spring Security æ—¶è·å¾—é»˜è®¤ç™»å½•é¡µé¢çš„åŸå› ã€‚ DefaultLogoutPageGeneratingFilter: å¦‚æœæ‚¨æ²¡æœ‰æ˜ç¡®ç¦ç”¨è¯¥åŠŸèƒ½ï¼Œåˆ™ä¸ºæ‚¨ç”Ÿæˆä¸€ä¸ªæ³¨é”€é¡µé¢ã€‚ FilterSecurityInterceptor: æ˜¯å¦ç»è¿‡æ‚¨çš„æˆæƒã€‚ å› æ­¤ï¼Œé€šè¿‡è¿™ä¸¤ä¸ªè¿‡æ»¤å™¨ï¼ŒSpring Security ä¸ºæ‚¨æä¾›äº†ä¸€ä¸ªç™»å½•/æ³¨é”€é¡µé¢ï¼Œä»¥åŠä½¿ç”¨åŸºæœ¬èº«ä»½éªŒè¯æˆ–è¡¨å•ç™»å½•è¿›è¡Œç™»å½•çš„èƒ½åŠ›ï¼Œä»¥åŠä¸€äº›é¢å¤–çš„å¥½ä¸œè¥¿ï¼Œä¾‹å¦‚ CsrfFilterï¼Œæˆ‘ä»¬å°†æœ‰ä¸€ä¸ªç¨åå†çœ‹ã€‚\nä¸­åœºä¼‘æ¯ï¼šè¿™äº›è¿‡æ»¤å™¨å¤§éƒ¨åˆ†æ˜¯ Spring Securityã€‚ä¸å¤šä¹Ÿä¸å°‘ã€‚ä»–ä»¬åšæ‰€æœ‰çš„å·¥ä½œã€‚å‰©ä¸‹çš„å°±æ˜¯é…ç½®å®ƒä»¬çš„å·¥ä½œæ–¹å¼ï¼Œå³è¦ä¿æŠ¤å“ªäº› URLã€è¦å¿½ç•¥å“ªäº› URL ä»¥åŠä½¿ç”¨å“ªäº›æ•°æ®åº“è¡¨è¿›è¡Œèº«ä»½éªŒè¯ã€‚\nå› æ­¤ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦çœ‹çœ‹å¦‚ä½•é…ç½® Spring Securityã€‚\nå¦‚ä½•é…ç½® Spring Securityï¼šWebSecurityConfigurerAdapter ä½¿ç”¨æœ€æ–°çš„ Spring Security å’Œ/æˆ– Spring Boot ç‰ˆæœ¬ï¼Œé…ç½® Spring Security çš„æ–¹æ³•æ˜¯ä½¿ç”¨ä¸€ä¸ªç±»ï¼š\nä½¿ç”¨@EnableWebSecurity è¿›è¡Œæ³¨é‡Šã€‚ æ‰©å±• WebSecurityConfigurerï¼Œå®ƒåŸºæœ¬ä¸Šä¸ºæ‚¨æä¾›é…ç½® DSL/æ–¹æ³•ã€‚ä½¿ç”¨è¿™äº›æ–¹æ³•ï¼Œæ‚¨å¯ä»¥æŒ‡å®šåº”ç”¨ç¨‹åºä¸­è¦ä¿æŠ¤çš„ URI æˆ–è¦å¯ç”¨/ç¦ç”¨çš„æ¼æ´åˆ©ç”¨ä¿æŠ¤ã€‚ å…¸å‹çš„ WebSecurityConfigurerAdapter å¦‚ä¸‹æ‰€ç¤ºï¼š\n@Configuration @EnableWebSecurity // (1) public class WebSecurityConfig extends WebSecurityConfigurerAdapter { // (1) @Override protected void configure(HttpSecurity http) throws Exception { // (2) http .authorizeRequests() .antMatchers(\u0026#34;/\u0026#34;, \u0026#34;/home\u0026#34;).permitAll() // (3) .anyRequest().authenticated() // (4) .and() .formLogin() // (5) .loginPage(\u0026#34;/login\u0026#34;) // (5) .permitAll() .and() .logout() // (6) .permitAll() .and() .httpBasic(); // (7) } } å¸¦æœ‰ @EnableWebSecurity æ³¨é‡Šçš„æ™®é€š Spring @Configurationï¼Œä» WebSecurityConfigurerAdapter æ‰©å±•ã€‚ é€šè¿‡é‡å†™é€‚é…å™¨çš„ configure(HttpSecurity)æ–¹æ³•ï¼Œæ‚¨å°†è·å¾—ä¸€ä¸ªæ¼‚äº®çš„å° DSLï¼Œæ‚¨å¯ä»¥ç”¨å®ƒæ¥é…ç½®æ‚¨çš„ FilterChainã€‚ æ‰€æœ‰å‘é€è‡³ */* å’Œ */home* çš„è¯·æ±‚å‡è¢«å…è®¸ï¼ˆå…è®¸ï¼‰ - ç”¨æˆ·æ— éœ€è¿›è¡Œèº«ä»½éªŒè¯ã€‚æ‚¨æ­£åœ¨ä½¿ç”¨ antMatcherï¼Œè¿™æ„å‘³ç€æ‚¨è¿˜å¯ä»¥åœ¨å­—ç¬¦ä¸²ä¸­ä½¿ç”¨é€šé…ç¬¦ï¼ˆ*ã€**ã€?ï¼‰ã€‚ ä»»ä½•å…¶ä»–è¯·æ±‚éƒ½éœ€è¦é¦–å…ˆå¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ï¼Œå³ç”¨æˆ·éœ€è¦ç™»å½•ã€‚ æ‚¨å…è®¸ä½¿ç”¨è‡ªå®šä¹‰ç™»å½•é¡µé¢ï¼ˆ */login* ï¼Œå³ä¸æ˜¯ Spring Security è‡ªåŠ¨ç”Ÿæˆçš„ï¼‰è¿›è¡Œè¡¨å•ç™»å½•ï¼ˆè¡¨å•ä¸­çš„ç”¨æˆ·å/å¯†ç ï¼‰ã€‚ä»»ä½•äººéƒ½åº”è¯¥èƒ½å¤Ÿè®¿é—®ç™»å½•é¡µé¢ï¼Œè€Œä¸å¿…å…ˆç™»å½•ï¼ˆpermitAllï¼›å¦åˆ™æˆ‘ä»¬å°±ä¼šé‡åˆ°ç¬¬ 22 æ¡å†›è§„ï¼ï¼‰ã€‚ æ³¨é”€é¡µé¢ä¹Ÿæ˜¯å¦‚æ­¤ æœ€é‡è¦çš„æ˜¯ï¼Œæ‚¨è¿˜å…è®¸åŸºæœ¬èº«ä»½éªŒè¯ï¼Œå³å‘é€ HTTP åŸºæœ¬èº«ä»½éªŒè¯æ ‡å¤´è¿›è¡Œèº«ä»½éªŒè¯ã€‚ å¦‚ä½•ä½¿ç”¨ Spring Security çš„é…ç½® DSL ä¹ æƒ¯è¯¥ DSL éœ€è¦ä¸€äº›æ—¶é—´ï¼Œä½†æ‚¨å¯ä»¥åœ¨å¸¸è§é—®é¢˜è§£ç­”éƒ¨åˆ†æ‰¾åˆ°æ›´å¤šç¤ºä¾‹ï¼šAntMatchersï¼šå¸¸è§ç¤ºä¾‹ã€‚\nç°åœ¨é‡è¦çš„æ˜¯ï¼Œæ‚¨å¯ä»¥åœ¨è¿™ä¸ª *configure* æ–¹æ³•ä¸­æŒ‡å®šï¼š\nè¦ä¿æŠ¤å“ªäº› URL (authenticated()) ä»¥åŠå…è®¸å“ªäº› URL (permitAll())ã€‚ å…è®¸å“ªäº›èº«ä»½éªŒè¯æ–¹æ³•ï¼ˆformLogin()ã€httpBasic()ï¼‰ä»¥åŠå®ƒä»¬çš„é…ç½®æ–¹å¼ã€‚ ç®€è€Œè¨€ä¹‹ï¼šæ‚¨çš„åº”ç”¨ç¨‹åºçš„å®Œæ•´å®‰å…¨é…ç½®ã€‚ æ³¨æ„ï¼šæ‚¨ä¸éœ€è¦ç«‹å³è¦†ç›–é€‚é…å™¨çš„é…ç½®æ–¹æ³•ï¼Œå› ä¸ºå®ƒå¸¦æœ‰ä¸€ä¸ªéå¸¸åˆç†çš„å®ç° - é»˜è®¤æƒ…å†µä¸‹ã€‚å®ƒçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š\npublic abstract class WebSecurityConfigurerAdapter implements WebSecurityConfigurer\u0026lt;WebSecurity\u0026gt; { protected void configure(HttpSecurity http) throws Exception { http .authorizeRequests() .anyRequest().authenticated() // (1) .and() .formLogin().and() // (2) .httpBasic(); // (3) } } è¦è®¿é—®åº”ç”¨ç¨‹åºä¸Šçš„ä»»ä½• URI ( *anyRequest()* )ï¼Œæ‚¨éœ€è¦è¿›è¡Œèº«ä»½éªŒè¯ (authenticated())ã€‚ å¯ç”¨é»˜è®¤è®¾ç½®çš„è¡¨å•ç™»å½• ( *formLogin()* )ã€‚ HTTP åŸºæœ¬èº«ä»½éªŒè¯ ( *httpBasic()* ) ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ æ­¤é»˜è®¤é…ç½®å°±æ˜¯æ‚¨çš„åº”ç”¨ç¨‹åºåœ¨æ·»åŠ  Spring Security åç«‹å³å¤„äºé”å®šçŠ¶æ€çš„åŸå› ã€‚å¾ˆç®€å•ï¼Œä¸æ˜¯å—ï¼Ÿ\næ€»ç»“ï¼šWebSecurityConfigurerAdapter çš„ DSL é…ç½® æˆ‘ä»¬äº†è§£åˆ° Spring Security ç”±å‡ ä¸ªä½¿ç”¨ WebSecurityConfigurerAdapter @Configuration ç±»é…ç½®çš„è¿‡æ»¤å™¨ç»„æˆã€‚\nä½†ç¼ºå°‘ä¸€ä¸ªå…³é”®çš„éƒ¨åˆ†ã€‚æˆ‘ä»¬ä»¥ Spring çš„ BasicAuthFilter ä¸ºä¾‹ã€‚å®ƒå¯ä»¥ä» HTTP Basic Auth æ ‡å¤´ä¸­æå–ç”¨æˆ·å/å¯†ç ï¼Œä½†å®ƒæ ¹æ®ä»€ä¹ˆæ¥éªŒè¯è¿™äº›å‡­æ®å‘¢ï¼Ÿ\nè¿™è‡ªç„¶å¼•å‡ºäº†æˆ‘ä»¬çš„é—®é¢˜ï¼šèº«ä»½éªŒè¯å¦‚ä½•ä¸ Spring Security ä¸€èµ·å·¥ä½œã€‚\nä½¿ç”¨ Spring Security è¿›è¡Œèº«ä»½éªŒè¯ å½“æ¶‰åŠåˆ°èº«ä»½éªŒè¯å’Œ Spring Security æ—¶ï¼Œæ‚¨å¤§è‡´ä¼šé‡åˆ°ä¸‰ç§æƒ…å†µï¼š\né»˜è®¤å€¼ï¼šæ‚¨å¯ä»¥è®¿é—®ç”¨æˆ·çš„ï¼ˆæ•£åˆ—ï¼‰å¯†ç ï¼Œå› ä¸ºæ‚¨å°†ä»–çš„è¯¦ç»†ä¿¡æ¯ï¼ˆç”¨æˆ·åã€å¯†ç ï¼‰ä¿å­˜åœ¨ä¾‹å¦‚ä¸€ä¸ªæ•°æ®åº“è¡¨ã€‚ ä¸å¤ªå¸¸è§ï¼šæ‚¨æ— æ³•è®¿é—®ç”¨æˆ·çš„ï¼ˆæ•£åˆ—ï¼‰å¯†ç ã€‚å¦‚æœæ‚¨çš„ç”¨æˆ·å’Œå¯†ç å­˜å‚¨åœ¨å…¶ä»–åœ°æ–¹ï¼ˆä¾‹å¦‚æä¾› REST èº«ä»½éªŒè¯æœåŠ¡çš„ç¬¬ä¸‰æ–¹èº«ä»½ç®¡ç†äº§å“ï¼‰ï¼Œå°±ä¼šå‡ºç°è¿™ç§æƒ…å†µã€‚æƒ³æƒ³ï¼šAtlassian Crowdã€‚ ä¹Ÿå¾ˆå—æ¬¢è¿ï¼šæ‚¨æƒ³ä½¿ç”¨ OAuth2 æˆ–â€œä½¿ç”¨ Google/Twitter/ç­‰ç™»å½•â€ã€‚ (OpenID)ï¼Œå¯èƒ½ä¸ JWT ç»“åˆä½¿ç”¨ã€‚é‚£ä¹ˆä»¥ä¸‹å†…å®¹éƒ½ä¸é€‚ç”¨ï¼Œæ‚¨åº”è¯¥ç›´æ¥è¿›å…¥ OAuth2 ç« èŠ‚ã€‚ æ³¨æ„ï¼šæ ¹æ®æ‚¨çš„åœºæ™¯ï¼Œæ‚¨éœ€è¦æŒ‡å®šä¸åŒçš„ @Bean æ‰èƒ½ä½¿ Spring Security æ­£å¸¸å·¥ä½œï¼Œå¦åˆ™æ‚¨æœ€ç»ˆä¼šå¾—åˆ°éå¸¸æ··ä¹±çš„å¼‚å¸¸ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœæ‚¨å¿˜è®°æŒ‡å®š PasswordEncoderï¼Œåˆ™ä¼šå‡ºç° NullPointerExceptionï¼‰ã€‚è®°ä½è¿™ä¸€ç‚¹ã€‚\nè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æœ€é‡è¦çš„ä¸¤ä¸ªåœºæ™¯ã€‚\n1. UserDetailsServiceï¼šè·å–ç”¨æˆ·å¯†ç  å‡è®¾æ‚¨æœ‰ä¸€ä¸ªå­˜å‚¨ç”¨æˆ·çš„æ•°æ®åº“è¡¨ã€‚å®ƒæœ‰å‡ åˆ—ï¼Œä½†æœ€é‡è¦çš„æ˜¯å®ƒæœ‰ä¸€ä¸ªç”¨æˆ·åå’Œå¯†ç åˆ—ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­å­˜å‚¨ç”¨æˆ·çš„æ•£åˆ—ï¼ˆï¼ï¼‰å¯†ç ã€‚\ncreate table users (id int auto_increment primary key, username varchar(255), password varchar(255)); åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒSpring Security éœ€è¦æ‚¨å®šä¹‰ä¸¤ä¸ª bean æ¥å¯åŠ¨å¹¶è¿è¡Œèº«ä»½éªŒè¯ã€‚\nç”¨æˆ·è¯¦ç»†ä¿¡æ¯æœåŠ¡ã€‚ å¯†ç ç¼–ç å™¨ã€‚ æŒ‡å®š UserDetailsSâ€‹â€‹ervice å°±è¿™ä¹ˆç®€å•ï¼š\n@Bean public UserDetailsService userDetailsService() { return new MyDatabaseUserDetailsService(); // (1) } MyDatabaseUserDetailsSâ€‹â€‹ervice å®ç°äº† UserDetailsSâ€‹â€‹erviceï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„æ¥å£ï¼Œå®ƒç”±ä¸€ä¸ªè¿”å› UserDetails å¯¹è±¡çš„æ–¹æ³•ç»„æˆï¼š public class MyDatabaseUserDetailsService implements UserDetailsService { UserDetails loadUserByUsername(String username) throws UsernameNotFoundException { // (1) // 1. Load the user from the users table by username. If not found, throw UsernameNotFoundException. // 2. Convert/wrap the user to a UserDetails object and return it. return someUserDetails; } } public interface UserDetails extends Serializable { // (2) String getUsername(); String getPassword(); // \u0026lt;3\u0026gt; more methods: // isAccountNonExpired,isAccountNonLocked, // isCredentialsNonExpired,isEnabled } UserDetailsSâ€‹â€‹ervice é€šè¿‡ç”¨æˆ·çš„ç”¨æˆ·ååŠ è½½ UserDetailsã€‚è¯·æ³¨æ„ï¼Œè¯¥æ–¹æ³•ä»…é‡‡ç”¨ä¸€ä¸ªå‚æ•°ï¼šç”¨æˆ·åï¼ˆè€Œä¸æ˜¯å¯†ç ï¼‰ã€‚ UserDetails æ¥å£å…·æœ‰è·å–ï¼ˆæ•£åˆ—ï¼ï¼‰å¯†ç çš„æ–¹æ³•å’Œè·å–ç”¨æˆ·åçš„æ–¹æ³•ã€‚ UserDetails æœ‰æ›´å¤šæ–¹æ³•ï¼Œä¾‹å¦‚å¸æˆ·å¤„äºæ´»åŠ¨çŠ¶æ€è¿˜æ˜¯è¢«é˜»æ­¢ã€å‡­æ®æ˜¯å¦å·²è¿‡æœŸæˆ–ç”¨æˆ·æ‹¥æœ‰ä»€ä¹ˆæƒé™ - ä½†æˆ‘ä»¬ä¸ä¼šåœ¨è¿™é‡Œä»‹ç»å®ƒä»¬ã€‚ å› æ­¤ï¼Œæ‚¨å¯ä»¥åƒæˆ‘ä»¬ä¸Šé¢é‚£æ ·è‡ªå·±å®ç°è¿™äº›æ¥å£ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Spring Security æä¾›çš„ç°æœ‰æ¥å£ã€‚\nç°æˆçš„å®æ–½ ç®€å•è¯´æ˜ä¸€ä¸‹ï¼šæ‚¨å§‹ç»ˆå¯ä»¥è‡ªå·±å®ç° UserDetailsSâ€‹â€‹ervice å’Œ UserDetails æ¥å£ã€‚\nä½†æ˜¯ï¼Œæ‚¨è¿˜ä¼šå‘ç° Spring Security æä¾›çš„ç°æˆå®ç°ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨/é…ç½®/æ‰©å±•/è¦†ç›–ã€‚\nJdbcUserDetailsManager, è¿™æ˜¯ä¸€ä¸ªåŸºäº JDBCï¼ˆæ•°æ®åº“ï¼‰çš„ UserDetailsSâ€‹â€‹erviceã€‚æ‚¨å¯ä»¥é…ç½®å®ƒä»¥åŒ¹é…æ‚¨çš„ç”¨æˆ·è¡¨/åˆ—ç»“æ„ã€‚ InMemoryUserDetailsManager, å®ƒå°†æ‰€æœ‰ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ä¿ç•™åœ¨å†…å­˜ä¸­ï¼Œéå¸¸é€‚åˆæµ‹è¯•ã€‚ org.springframework.security.core.userdetail.User, è¿™æ˜¯æ‚¨å¯ä»¥ä½¿ç”¨çš„åˆç†çš„é»˜è®¤ UserDetails å®ç°ã€‚è¿™æ„å‘³ç€å®ä½“/æ•°æ®åº“è¡¨å’Œæ­¤ç”¨æˆ·ç±»ä¹‹é—´å¯èƒ½å­˜åœ¨æ˜ å°„/å¤åˆ¶ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥ç®€å•åœ°è®©æ‚¨çš„å®ä½“å®ç° UserDetails æ¥å£ã€‚ å®Œæ•´çš„ç”¨æˆ·è¯¦ç»†ä¿¡æ¯å·¥ä½œæµç¨‹ï¼šHTTP åŸºæœ¬èº«ä»½éªŒè¯ ç°åœ¨å›æƒ³ä¸€ä¸‹æ‚¨çš„ HTTP åŸºæœ¬èº«ä»½éªŒè¯ï¼Œè¿™æ„å‘³ç€æ‚¨æ­£åœ¨ä½¿ç”¨ Spring Security å’ŒåŸºæœ¬èº«ä»½éªŒè¯æ¥ä¿æŠ¤æ‚¨çš„åº”ç”¨ç¨‹åºã€‚å½“æ‚¨æŒ‡å®š UserDetailsSâ€‹â€‹ervice å¹¶å°è¯•ç™»å½•æ—¶ä¼šå‘ç”Ÿä»¥ä¸‹æƒ…å†µï¼š\nä»è¿‡æ»¤å™¨ä¸­çš„ HTTP Basic Auth æ ‡å¤´ä¸­æå–ç”¨æˆ·å/å¯†ç ç»„åˆã€‚æ‚¨æ— éœ€ä¸ºæ­¤åšä»»ä½•äº‹æƒ…ï¼Œå®ƒä¼šåœ¨å¹•åå‘ç”Ÿã€‚ è°ƒç”¨ MyDatabaseUserDetailsSâ€‹â€‹ervice ä»æ•°æ®åº“åŠ è½½ç›¸åº”çš„ç”¨æˆ·ï¼ŒåŒ…è£…ä¸º UserDetails å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å…¬å¼€ç”¨æˆ·çš„å“ˆå¸Œå¯†ç ã€‚ ä» HTTP Basic Auth æ ‡å¤´ä¸­è·å–æå–çš„å¯†ç ï¼Œè‡ªåŠ¨å¯¹å…¶è¿›è¡Œå“ˆå¸Œå¤„ç†ï¼Œå¹¶å°†å…¶ä¸ UserDetails å¯¹è±¡ä¸­çš„å“ˆå¸Œå¯†ç è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœä¸¤è€…åŒ¹é…ï¼Œåˆ™ç”¨æˆ·èº«ä»½éªŒè¯æˆåŠŸã€‚ è¿™é‡Œçš„æ‰€æœ‰éƒ½æ˜¯å®ƒçš„ã€‚ä½†æ˜¯ç­‰ä¸€ä¸‹ï¼ŒSpring Security å¦‚ä½•å¯¹æ¥è‡ªå®¢æˆ·ç«¯çš„å¯†ç è¿›è¡Œå“ˆå¸Œå¤„ç†ï¼ˆæ­¥éª¤ 3ï¼‰ï¼Ÿç”¨ä»€ä¹ˆç®—æ³•ï¼Ÿ\nå¯†ç ç¼–ç å™¨ Spring Security æ— æ³•ç¥å¥‡åœ°çŒœæµ‹æ‚¨é¦–é€‰çš„å¯†ç å“ˆå¸Œç®—æ³•ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ éœ€è¦æŒ‡å®šå¦ä¸€ä¸ª@Beanï¼Œä¸€ä¸ª PasswordEncoderã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³å¯¹æ‰€æœ‰å¯†ç ä½¿ç”¨ BCrypt å¯†ç å“ˆå¸Œå‡½æ•°ï¼ˆSpring Security çš„é»˜è®¤å€¼ï¼‰ï¼Œåˆ™å¯ä»¥åœ¨ SecurityConfig ä¸­æŒ‡å®šæ­¤ @Beanã€‚\n@Bean public BCryptPasswordEncoder bCryptPasswordEncoder() { return new BCryptPasswordEncoder(); } å¦‚æœæ‚¨æœ‰å¤šç§å¯†ç å“ˆå¸Œç®—æ³•ï¼Œå› ä¸ºæ‚¨æœ‰ä¸€äº›æ—§ç”¨æˆ·çš„å¯†ç æ˜¯ä½¿ç”¨ MD5 å­˜å‚¨çš„ï¼ˆä¸è¦è¿™æ ·åšï¼‰ï¼Œè€Œè¾ƒæ–°çš„ç”¨æˆ·åˆ™ä½¿ç”¨ Bcrypt ç”šè‡³æ˜¯ SHA-256 ç­‰ç¬¬ä¸‰ç§ç®—æ³•ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿç„¶åæ‚¨å°†ä½¿ç”¨ä»¥ä¸‹ç¼–ç å™¨ï¼š\n@Bean public PasswordEncoder passwordEncoder() { return PasswordEncoderFactories.createDelegatingPasswordEncoder(); } è¿™ä¸ªå§”æ‰˜ç¼–ç å™¨å¦‚ä½•å·¥ä½œï¼Ÿå®ƒå°†æŸ¥çœ‹ UserDetail çš„å“ˆå¸Œå¯†ç ï¼ˆæ¥è‡ªä¾‹å¦‚æ‚¨çš„æ•°æ®åº“è¡¨ï¼‰ï¼Œè¯¥å¯†ç ç°åœ¨å¿…é¡»ä»¥ *{prefix}* å¼€å¤´ã€‚é‚£ä¸ªå‰ç¼€ï¼Œå°±æ˜¯ä½ çš„å“ˆå¸Œæ–¹æ³•ï¼æ‚¨çš„æ•°æ®åº“è¡¨å°†å¦‚ä¸‹æ‰€ç¤ºï¼š\nusername ç”¨æˆ·å password å¯†ç  john@doe.com {bcrypt}$2y$12$6t86Rpr3llMANhCUt26oUen2WhvXr/A89Xo9zJion8W7gWgZ/zA0C {bcrypt}$2y$12$6t86Rpr3llMANhCUt26oUen2WhvXr/A89Xo9zJion8W7gWgZ/zA0C my@user.com {sha256}5ffa39f5757a0dad5dfada519d02c6b71b61ab1df51b4ed1f3beed6abe0ff5f6 {sha256}5ffa39f5757a0dad5dfada519d02c6b71b61ab1df51b4ed1f3beed6abe0ff5f6 Spring Security å°†ï¼š\nè¯»å…¥è¿™äº›å¯†ç å¹¶å»æ‰å‰ç¼€ï¼ˆ {bcrypt} æˆ– {sha256} ï¼‰ã€‚ æ ¹æ®å‰ç¼€å€¼ï¼Œä½¿ç”¨æ­£ç¡®çš„å¯†ç ç¼–ç å™¨ï¼ˆå³ BCryptEncoder æˆ– SHA256Encoderï¼‰ ä½¿ç”¨è¯¥å¯†ç ç¼–ç å™¨å¯¹ä¼ å…¥çš„åŸå§‹å¯†ç è¿›è¡Œå“ˆå¸Œå¤„ç†ï¼Œå¹¶å°†å…¶ä¸å­˜å‚¨çš„å¯†ç è¿›è¡Œæ¯”è¾ƒã€‚ è¿™å°±æ˜¯å¯†ç ç¼–ç å™¨çš„å…¨éƒ¨å†…å®¹ã€‚\næ‘˜è¦ï¼šè·å–ç”¨æˆ·å¯†ç  æœ¬èŠ‚çš„è¦ç‚¹æ˜¯ï¼šå¦‚æœæ‚¨ä½¿ç”¨ Spring Security å¹¶æœ‰æƒè®¿é—®ç”¨æˆ·çš„å¯†ç ï¼Œé‚£ä¹ˆï¼š\næŒ‡å®š UserDetailsSâ€‹â€‹erviceã€‚è¦ä¹ˆæ˜¯è‡ªå®šä¹‰å®ç°ï¼Œè¦ä¹ˆä½¿ç”¨å¹¶é…ç½® Spring Security æä¾›çš„å®ç°ã€‚ æŒ‡å®šå¯†ç ç¼–ç å™¨ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œè¿™å°±æ˜¯ Spring Security èº«ä»½éªŒè¯ã€‚ 2. AuthenticationProviderï¼šæ— æƒè®¿é—®ç”¨æˆ·çš„å¯†ç  ç°åœ¨ï¼Œå‡è®¾æ‚¨æ­£åœ¨ä½¿ç”¨ Atlassian Crowd è¿›è¡Œé›†ä¸­èº«ä»½ç®¡ç†ã€‚è¿™æ„å‘³ç€æ‚¨æ‰€æœ‰åº”ç”¨ç¨‹åºçš„æ‰€æœ‰ç”¨æˆ·å’Œå¯†ç éƒ½å­˜å‚¨åœ¨ Atlassian Crowd ä¸­ï¼Œè€Œä¸å†å­˜å‚¨åœ¨æ•°æ®åº“è¡¨ä¸­ã€‚\nè¿™æœ‰ä¸¤ä¸ªå«ä¹‰ï¼š\næ‚¨çš„åº”ç”¨ç¨‹åºä¸­ä¸å†æœ‰ç”¨æˆ·å¯†ç ï¼Œå› ä¸ºæ‚¨ä¸èƒ½è¦æ±‚ Crowd åªæä¾›è¿™äº›å¯†ç ã€‚ ä½†æ˜¯ï¼Œæ‚¨ç¡®å®æœ‰ä¸€ä¸ª REST APIï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ‚¨çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•ã€‚ ï¼ˆå¯¹ */rest/usermanagement/1/authentication* REST ç«¯ç‚¹çš„ POST è¯·æ±‚ï¼‰ã€‚ å¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œæ‚¨ä¸èƒ½å†ä½¿ç”¨ UserDetailsSâ€‹â€‹erviceï¼Œè€Œæ˜¯éœ€è¦å®ç°å¹¶æä¾› AuthenticationProvider @Beanã€‚\n@Bean public AuthenticationProvider authenticationProvider() { return new AtlassianCrowdAuthenticationProvider(); } AuthenticationProvider ä¸»è¦åŒ…å«ä¸€ç§æ–¹æ³•ï¼Œç®€å•çš„å®ç°å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š\npublic class AtlassianCrowdAuthenticationProvider implements AuthenticationProvider { Authentication authenticate(Authentication authentication) // (1) throws AuthenticationException { String username = authentication.getPrincipal().toString(); // (1) String password = authentication.getCredentials().toString(); // (1) User user = callAtlassianCrowdRestService(username, password); // (2) if (user == null) { // (3) throw new AuthenticationException(\u0026#34;could not login\u0026#34;); } return new UserNamePasswordAuthenticationToken(user.getUsername(), user.getPassword(), user.getAuthorities()); // (4) } // other method ignored } ä¸åªèƒ½è®¿é—®ç”¨æˆ·åçš„ UserDetails load() æ–¹æ³•ç›¸æ¯”ï¼Œæ‚¨ç°åœ¨å¯ä»¥è®¿é—®å®Œæ•´çš„èº«ä»½éªŒè¯å°è¯•ï¼Œé€šå¸¸åŒ…å«ç”¨æˆ·åå’Œå¯†ç ã€‚ æ‚¨å¯ä»¥æ‰§è¡Œä»»ä½•æ‚¨æƒ³è¦éªŒè¯ç”¨æˆ·èº«ä»½çš„æ“ä½œï¼Œä¾‹å¦‚è°ƒç”¨ REST æœåŠ¡ã€‚ å¦‚æœèº«ä»½éªŒè¯å¤±è´¥ï¼Œåˆ™éœ€è¦æŠ›å‡ºå¼‚å¸¸ã€‚ å¦‚æœè®¤è¯æˆåŠŸï¼Œéœ€è¦è¿”å›ä¸€ä¸ªå®Œå…¨åˆå§‹åŒ–çš„ UsernamePasswordAuthenticationTokenã€‚å®ƒæ˜¯ Authentication æ¥å£çš„å®ç°ï¼Œéœ€è¦å°† authentiated å­—æ®µè®¾ç½®ä¸º trueï¼ˆä¸Šé¢ä½¿ç”¨çš„æ„é€ å‡½æ•°ä¼šè‡ªåŠ¨è®¾ç½®ï¼‰ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç« ä»‹ç»æƒå¨ã€‚ å®Œæ•´çš„ AuthenticationProvider å·¥ä½œæµç¨‹ï¼šHTTP åŸºæœ¬èº«ä»½éªŒè¯ ç°åœ¨å›æƒ³ä¸€ä¸‹æ‚¨çš„ HTTP åŸºæœ¬èº«ä»½éªŒè¯ï¼Œè¿™æ„å‘³ç€æ‚¨æ­£åœ¨ä½¿ç”¨ Spring Security å’ŒåŸºæœ¬èº«ä»½éªŒè¯æ¥ä¿æŠ¤æ‚¨çš„åº”ç”¨ç¨‹åºã€‚å½“æ‚¨æŒ‡å®š AuthenticationProvider å¹¶å°è¯•ç™»å½•æ—¶ä¼šå‘ç”Ÿä»¥ä¸‹æƒ…å†µï¼š\nä»è¿‡æ»¤å™¨ä¸­çš„ HTTP Basic Auth æ ‡å¤´ä¸­æå–ç”¨æˆ·å/å¯†ç ç»„åˆã€‚æ‚¨æ— éœ€ä¸ºæ­¤åšä»»ä½•äº‹æƒ…ï¼Œå®ƒä¼šåœ¨å¹•åå‘ç”Ÿã€‚ ä½¿ç”¨è¯¥ç”¨æˆ·åå’Œå¯†ç è°ƒç”¨æ‚¨çš„ AuthenticationProviderï¼ˆä¾‹å¦‚ AtlassianCrowdAuthenticationProviderï¼‰ï¼Œä»¥ä¾¿æ‚¨è‡ªå·±è¿›è¡Œèº«ä»½éªŒè¯ï¼ˆä¾‹å¦‚ REST è°ƒç”¨ï¼‰ã€‚ æ²¡æœ‰å¯†ç æ•£åˆ—æˆ–ç±»ä¼¼çš„äº‹æƒ…å‘ç”Ÿï¼Œå› ä¸ºæ‚¨æœ¬è´¨ä¸Šæ˜¯å§”æ‰˜ç¬¬ä¸‰æ–¹è¿›è¡Œå®é™…çš„ç”¨æˆ·å/å¯†ç æ£€æŸ¥ã€‚ç®€è€Œè¨€ä¹‹ï¼Œè¿™å°±æ˜¯ AuthenticationProvider èº«ä»½éªŒè¯ï¼\næ‘˜è¦ï¼šèº«ä»½éªŒè¯æä¾›è€… æœ¬èŠ‚çš„è¦ç‚¹æ˜¯ï¼šå¦‚æœæ‚¨ä½¿ç”¨ Spring Security å¹¶ä¸”æ— æƒè®¿é—®ç”¨æˆ·çš„å¯†ç ï¼Œåˆ™å®ç°å¹¶æä¾› AuthenticationProvider @Beanã€‚\nSpring Security æˆæƒ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªè®¨è®ºäº†èº«ä»½éªŒè¯ï¼Œä¾‹å¦‚ç”¨æˆ·åå’Œå¯†ç æ£€æŸ¥ã€‚\nç°åœ¨è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ Spring Security ä¸­çš„æƒé™ï¼Œæˆ–è€…æ›´ç¡®åˆ‡åœ°è¯´æ˜¯è§’è‰²å’Œæƒé™ã€‚\nä»€ä¹ˆæ˜¯æˆæƒï¼Ÿ ä»¥å…¸å‹çš„ç”µå­å•†åŠ¡ç½‘ä¸Šå•†åº—ä¸ºä¾‹ã€‚å®ƒå¯èƒ½ç”±ä»¥ä¸‹å‡ éƒ¨åˆ†ç»„æˆï¼š\nç½‘ä¸Šå•†åº—æœ¬èº«ã€‚æˆ‘ä»¬å‡è®¾å®ƒçš„ URL æ˜¯ *www.youramazinshop.com* ã€‚ ä¹Ÿè®¸æ˜¯å‘¼å«ä¸­å¿ƒä»£ç†çš„åŒºåŸŸï¼Œä»–ä»¬å¯ä»¥ç™»å½•å¹¶æŸ¥çœ‹å®¢æˆ·æœ€è¿‘è´­ä¹°äº†ä»€ä¹ˆæˆ–ä»–ä»¬çš„åŒ…è£¹åœ¨å“ªé‡Œã€‚å®ƒçš„ URL å¯ä»¥æ˜¯ *www.youramazinshop.com/callcenter* ã€‚ ä¸€ä¸ªå•ç‹¬çš„ç®¡ç†åŒºåŸŸï¼Œç®¡ç†å‘˜å¯ä»¥åœ¨å…¶ä¸­ç™»å½•å’Œç®¡ç†å‘¼å«ä¸­å¿ƒä»£ç†æˆ–ç½‘ä¸Šå•†åº—çš„å…¶ä»–æŠ€æœ¯æ–¹é¢ï¼ˆå¦‚ä¸»é¢˜ã€æ€§èƒ½ç­‰ï¼‰ã€‚å®ƒçš„ URL å¯ä»¥æ˜¯ *www.youramazinshop.com/admin* ã€‚ è¿™å…·æœ‰ä»¥ä¸‹å«ä¹‰ï¼Œå› ä¸ºä»…ä»…å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯å·²ç»ä¸å¤Ÿäº†ï¼š\nå®¢æˆ·æ˜¾ç„¶ä¸åº”è¯¥èƒ½å¤Ÿè®¿é—®å‘¼å«ä¸­å¿ƒæˆ–ç®¡ç†åŒºåŸŸã€‚ä»–åªè¢«å…è®¸åœ¨ç½‘ç«™ä¸Šè´­ç‰©ã€‚ å‘¼å«ä¸­å¿ƒä»£ç†ä¸åº”è¯¥èƒ½å¤Ÿè®¿é—®ç®¡ç†åŒºåŸŸã€‚ è€Œç®¡ç†å‘˜å¯ä»¥è®¿é—®ç½‘ä¸Šå•†åº—ã€å‘¼å«ä¸­å¿ƒåŒºåŸŸå’Œç®¡ç†åŒºåŸŸã€‚ ç®€è€Œè¨€ä¹‹ï¼Œæ‚¨å¸Œæœ›æ ¹æ®ä¸åŒçš„ç”¨æˆ·çš„æƒé™æˆ–è§’è‰²æ¥å…è®¸ä¸åŒçš„è®¿é—®æƒé™ã€‚\nä»€ä¹ˆæ˜¯æƒé™ï¼Ÿä»€ä¹ˆæ˜¯è§’è‰²ï¼Ÿ ç®€å•çš„ï¼š\næƒé™ï¼ˆæœ€ç®€å•çš„å½¢å¼ï¼‰åªæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒå¯ä»¥æ˜¯ä»»ä½•ç±»ä¼¼çš„å†…å®¹ï¼šuserã€ADMINã€ROLE_ADMIN æˆ– 53cr37_r0l3ã€‚ è§’è‰²æ˜¯å…·æœ‰ *ROLE_* å‰ç¼€çš„æƒé™ã€‚å› æ­¤ï¼Œåä¸º *ADMIN* çš„è§’è‰²ä¸åä¸º *ROLE_ADMIN* çš„æƒé™ç›¸åŒã€‚ è§’è‰²å’Œæƒé™ä¹‹é—´çš„åŒºåˆ«çº¯ç²¹æ˜¯æ¦‚å¿µæ€§çš„ï¼Œè¿™å¸¸å¸¸è®© Spring Security çš„æ–°æ‰‹æ„Ÿåˆ°å›°æƒ‘ã€‚\nä¸ºä»€ä¹ˆè§’è‰²å’Œæƒé™ä¹‹é—´æœ‰åŒºåˆ«ï¼Ÿ è€å®è¯´ï¼Œæˆ‘å·²ç»é˜…è¯»äº† Spring Security æ–‡æ¡£ä»¥åŠå…³äºè¿™ä¸ªé—®é¢˜çš„å‡ ä¸ªç›¸å…³ StackOverflow çº¿ç¨‹ï¼Œä½†æˆ‘æ— æ³•ç»™ä½ ä¸€ä¸ªæ˜ç¡®çš„ã€å¥½çš„ç­”æ¡ˆã€‚\nä»€ä¹ˆæ˜¯æˆäºˆæƒé™ï¼Ÿä»€ä¹ˆæ˜¯ SimpleGrantedAuthoritiesï¼Ÿ å½“ç„¶ï¼ŒSpring Security ä¸ä¼šè®©ä½ åªä½¿ç”¨å­—ç¬¦ä¸²å°±å¯ä»¥é€ƒè„±æƒ©ç½šã€‚æœ‰ä¸€ä¸ª Java ç±»ä»£è¡¨æ‚¨çš„æƒé™ Stringï¼Œä¸€ä¸ªæµè¡Œçš„ç±»æ˜¯ SimpleGrantedAuthorityã€‚\npublic final class SimpleGrantedAuthority implements GrantedAuthority { private final String role; @Override public String getAuthority() { return role; } } ï¼ˆæ³¨æ„ï¼šè¿˜æœ‰å…¶ä»–æƒé™ç±»ï¼Œå¯ä»¥è®©æ‚¨åœ¨å­—ç¬¦ä¸²æ—è¾¹å­˜å‚¨å…¶ä»–å¯¹è±¡ï¼ˆä¾‹å¦‚ä¸»ä½“ï¼‰ï¼Œæˆ‘ä¸ä¼šåœ¨è¿™é‡Œä»‹ç»å®ƒä»¬ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä»…ä½¿ç”¨ SimpleGrantedAuthorityã€‚ï¼‰\n1. UserDetailsServiceï¼šåœ¨å“ªé‡Œå­˜å‚¨å’Œè·å–æƒé™ï¼Ÿ å‡è®¾æ‚¨å°†ç”¨æˆ·å­˜å‚¨åœ¨è‡ªå·±çš„åº”ç”¨ç¨‹åºä¸­ï¼ˆæƒ³æƒ³ï¼šUserDetailsSâ€‹â€‹erviceï¼‰ï¼Œæ‚¨å°†æœ‰ä¸€ä¸ª Users è¡¨ã€‚\nç°åœ¨ï¼Œæ‚¨åªéœ€å‘å…¶ä¸­æ·»åŠ ä¸€ä¸ªåä¸ºâ€œauthoritiesâ€çš„åˆ—å³å¯ã€‚å¯¹äºæœ¬æ–‡ï¼Œæˆ‘åœ¨è¿™é‡Œé€‰æ‹©äº†ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²åˆ—ï¼Œå°½ç®¡å®ƒå¯ä»¥åŒ…å«å¤šä¸ªä»¥é€—å·åˆ†éš”çš„å€¼ã€‚æˆ–è€…ï¼Œæˆ‘ä¹Ÿå¯ä»¥æœ‰ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„è¡¨ AUTHORITIESï¼Œä½†å¯¹äºæœ¬æ–‡çš„èŒƒå›´æ¥è¯´ï¼Œè¿™æ ·åšå°±å¯ä»¥äº†ã€‚\næ³¨æ„ï¼šè¯·å‚é˜…ä»€ä¹ˆæ˜¯æƒé™ï¼Ÿä»€ä¹ˆæ˜¯è§’è‰²ï¼Ÿï¼šæ‚¨å°†æƒé™ï¼ˆå³å­—ç¬¦ä¸²ï¼‰ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚ç¢°å·§è¿™äº›æƒé™ä»¥ ROLE_ å‰ç¼€å¼€å¤´ï¼Œå› æ­¤ï¼Œå°± Spring Security è€Œè¨€ï¼Œè¿™äº›æƒé™ä¹Ÿæ˜¯è§’è‰²ã€‚\nusername ç”¨æˆ·å password å¯†ç  authorities å½“å±€ john@doe.com {bcrypt}â€¦ {bcrypt}\u0026hellip; ROLEADMIN ROLEç®¡ç†å‘˜ my@callcenter.com {sha256}â€¦ {sha256}â€¦ ROLE_CALLCENTER ROLE_CALLCENTER å‰©ä¸‹è¦åšçš„å”¯ä¸€ä¸€ä»¶äº‹å°±æ˜¯è°ƒæ•´æ‚¨çš„ UserDetailsSâ€‹â€‹ervice ä»¥åœ¨è¯¥æƒé™åˆ—ä¸­è¯»å–ã€‚\npublic class MyDatabaseUserDetailsService implements UserDetailsService { UserDetails loadUserByUsername(String username) throws UsernameNotFoundException { User user = userDao.findByUsername(username); List\u0026lt;SimpleGrantedAuthority\u0026gt; grantedAuthorities = user.getAuthorities().map(authority -\u0026gt; new SimpleGrantedAuthority(authority)).collect(Collectors.toList()); // (1) return new org.springframework.security.core.userdetails.User(user.getUsername(), user.getPassword(), grantedAuthorities); // (2) } } æ‚¨åªéœ€å°†æ•°æ®åº“åˆ—ä¸­çš„ä»»ä½•å†…å®¹æ˜ å°„åˆ° SimpleGrantedAuthorities åˆ—è¡¨å³å¯ã€‚å®Œæ¯•ã€‚ åŒæ ·ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨ Spring Security çš„ UserDetails åŸºæœ¬å®ç°ã€‚æ‚¨è¿˜å¯ä»¥åœ¨æ­¤å¤„ä½¿ç”¨è‡ªå·±çš„ç±»å®ç° UserDetailsï¼Œç”šè‡³å¯èƒ½ä¸éœ€è¦æ˜ å°„ã€‚ 2. AuthenticationManagerï¼šåœ¨å“ªé‡Œå­˜å‚¨å’Œè·å–æƒé™ï¼Ÿ å½“ç”¨æˆ·æ¥è‡ªç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºï¼ˆä¾‹å¦‚ Atlassian Cloudï¼‰æ—¶ï¼Œæ‚¨éœ€è¦æ‰¾å‡ºä»–ä»¬ä½¿ç”¨ä»€ä¹ˆæ¦‚å¿µæ¥æ”¯æŒå½“å±€ã€‚ Atlassian Crowd æœ‰â€œè§’è‰²â€çš„æ¦‚å¿µï¼Œä½†ä¸èµæˆä½¿ç”¨â€œç»„â€ã€‚\nå› æ­¤ï¼Œæ ¹æ®æ‚¨ä½¿ç”¨çš„å®é™…äº§å“ï¼Œæ‚¨éœ€è¦å°†å…¶æ˜ å°„åˆ° AuthenticationProvider ä¸­çš„ Spring Security æƒé™ã€‚\npublic class AtlassianCrowdAuthenticationProvider implements AuthenticationProvider { Authentication authenticate(Authentication authentication) throws AuthenticationException { String username = authentication.getPrincipal().toString(); String password = authentication.getCredentials().toString(); atlassian.crowd.User user = callAtlassianCrowdRestService(username, password); // (1) if (user == null) { throw new AuthenticationException(\u0026#34;could not login\u0026#34;); } return new UserNamePasswordAuthenticationToken(user.getUsername(), user.getPassword(), mapToAuthorities(user.getGroups())); // (2) } // other method ignored } æ³¨æ„ï¼šè¿™ä¸æ˜¯å®é™…çš„ Atlassian Crowd ä»£ç ï¼Œä½†è¾¾åˆ°äº†å…¶ç›®çš„ã€‚æ‚¨é’ˆå¯¹ REST æœåŠ¡è¿›è¡Œèº«ä»½éªŒè¯å¹¶è·å– JSON User å¯¹è±¡ï¼Œç„¶åè¯¥å¯¹è±¡å°†è½¬æ¢ä¸º atlassian.crowd.User å¯¹è±¡ã€‚ è¯¥ç”¨æˆ·å¯ä»¥æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªç»„çš„æˆå‘˜ï¼Œæ­¤å¤„å‡å®šè¿™äº›ç»„åªæ˜¯å­—ç¬¦ä¸²ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥ç®€å•åœ°å°†è¿™äº›ç»„æ˜ å°„åˆ° Spring çš„â€œSimpleGrantedAuthorityâ€ã€‚ é‡æ–°å®¡è§† WebSecurityConfigurerAdapter åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬è®¨è®ºäº†å¾ˆå¤šæœ‰å…³åœ¨ Spring Security ä¸­å­˜å‚¨å’Œæ£€ç´¢ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·çš„æƒé™çš„å†…å®¹ã€‚ä½†æ˜¯å¦‚ä½•ä½¿ç”¨ Spring Security çš„ DSL ä¿æŠ¤å…·æœ‰ä¸åŒæƒé™çš„ URLï¼Ÿç®€å•çš„ï¼š\n@Configuration @EnableWebSecurity public class WebSecurityConfig extends WebSecurityConfigurerAdapter { @Override protected void configure(HttpSecurity http) throws Exception { http .authorizeRequests() .antMatchers(\u0026#34;/admin\u0026#34;).hasAuthority(\u0026#34;ROLE_ADMIN\u0026#34;) // (1) .antMatchers(\u0026#34;/callcenter\u0026#34;).hasAnyAuthority(\u0026#34;ROLE_ADMIN\u0026#34;, \u0026#34;ROLE_CALLCENTER\u0026#34;) // (2) .anyRequest().authenticated() // (3) .and() .formLogin() .and() .httpBasic(); } } è¦è®¿é—® */admin* åŒºåŸŸï¼Œæ‚¨ï¼ˆå³ç”¨æˆ·ï¼‰éœ€è¦ç»è¿‡èº«ä»½éªŒè¯å¹¶æ‹¥æœ‰æƒé™ï¼ˆä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²ï¼‰ROLE_ADMINã€‚ è¦è®¿é—® */callcenter* åŒºåŸŸï¼Œæ‚¨éœ€è¦ç»è¿‡èº«ä»½éªŒè¯å¹¶æ‹¥æœ‰æƒé™ ROLE_ADMIN æˆ– ROLE_CALLCENTERã€‚ å¯¹äºä»»ä½•å…¶ä»–è¯·æ±‚ï¼Œæ‚¨ä¸éœ€è¦ç‰¹å®šè§’è‰²ï¼Œä½†ä»éœ€è¦è¿›è¡Œèº«ä»½éªŒè¯ã€‚ è¯·æ³¨æ„ï¼Œä¸Šé¢çš„ä»£ç  (1,2) ç­‰æ•ˆäºä»¥ä¸‹å†…å®¹ï¼š\nhttp .authorizeRequests() .antMatchers(\u0026#34;/admin\u0026#34;).hasRole(\u0026#34;ADMIN\u0026#34;) // (1) .antMatchers(\u0026#34;/callcenter\u0026#34;).hasAnyRole(\u0026#34;ADMIN\u0026#34;, \u0026#34;CALLCENTER\u0026#34;) // (2) ç°åœ¨ï¼Œæ‚¨ä¸å†è°ƒç”¨â€œhasAuthorityâ€ï¼Œè€Œæ˜¯è°ƒç”¨â€œhasRoleâ€ã€‚æ³¨æ„ï¼šSpring Security å°†åœ¨ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ä¸ŠæŸ¥æ‰¾åä¸º *ROLE_ADMIN* çš„æƒé™ã€‚ ç°åœ¨ï¼Œæ‚¨ä¸å†è°ƒç”¨â€œhasAnyAuthorityâ€ï¼Œè€Œæ˜¯è°ƒç”¨â€œhasAnyRoleâ€ã€‚æ³¨æ„ï¼šSpring Security å°†åœ¨ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ä¸ŠæŸ¥æ‰¾åä¸º *ROLE_ADMIN* æˆ– *ROLE_CALLCENTER* çš„æƒé™ã€‚ hasAccess å’Œ SpEL æœ€åä½†å¹¶éæœ€ä¸é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œé…ç½®æˆæƒçš„æœ€å¼ºå¤§æ–¹æ³•æ˜¯ä½¿ç”¨è®¿é—®æ–¹æ³•ã€‚å®ƒå…è®¸æ‚¨æŒ‡å®šå‡ ä¹ä»»ä½•æœ‰æ•ˆçš„ SpEL è¡¨è¾¾å¼ã€‚\nhttp .authorizeRequests() .antMatchers(\u0026#34;/admin\u0026#34;).access(\u0026#34;hasRole(\u0026#39;admin\u0026#39;) and hasIpAddress(\u0026#39;192.168.1.0/24\u0026#39;) and @myCustomBean.checkAccess(authentication,request)\u0026#34;) // (1) æ‚¨æ­£åœ¨æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å…·æœ‰ ROLE_ADMINã€ç‰¹å®šçš„ IP åœ°å€ä»¥åŠè‡ªå®šä¹‰ bean æ£€æŸ¥ã€‚ è¦å…¨é¢äº†è§£ Spring åŸºäºè¡¨è¾¾å¼çš„è®¿é—®æ§åˆ¶çš„åŠŸèƒ½ï¼Œè¯·æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚\nå¸¸è§æ¼æ´ä¿æŠ¤ Spring Security å¯ä»¥å¸®åŠ©æ‚¨é˜²èŒƒå¤šç§å¸¸è§æ”»å‡»ã€‚å®ƒä»è®¡æ—¶æ”»å‡»å¼€å§‹ï¼ˆå³ Spring Security å§‹ç»ˆä¼šåœ¨ç™»å½•æ—¶å¯¹æä¾›çš„å¯†ç è¿›è¡Œå“ˆå¸Œå¤„ç†ï¼Œå³ä½¿ç”¨æˆ·ä¸å­˜åœ¨ï¼‰ï¼Œæœ€ç»ˆæä¾›é’ˆå¯¹ç¼“å­˜æ§åˆ¶æ”»å‡»ã€å†…å®¹å—…æ¢ã€ç‚¹å‡»åŠ«æŒã€è·¨ç«™ç‚¹è„šæœ¬ç­‰çš„ä¿æŠ¤ã€‚\nåœ¨æœ¬æŒ‡å—çš„èŒƒå›´å†…ä¸å¯èƒ½è¯¦ç»†ä»‹ç»æ¯ç§æ”»å‡»ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åªä¼šå…³æ³¨ä¸€ç§æœ€è®©å¤§å¤šæ•° Spring Security æ–°æ‰‹æœ›è€Œå´æ­¥çš„ä¿æŠ¤æªæ–½ï¼šè·¨ç«™ç‚¹è¯·æ±‚ä¼ªé€ ã€‚\nè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼šCSRF å¦‚æœæ‚¨å¯¹ CSRF å®Œå…¨é™Œç”Ÿï¼Œæ‚¨å¯èƒ½éœ€è¦è§‚çœ‹æ­¤ YouTube è§†é¢‘æ¥å¿«é€Ÿäº†è§£å®ƒã€‚ç„¶è€Œï¼Œå¿«é€Ÿçš„ç»“è®ºæ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ Spring Security ä½¿ç”¨æœ‰æ•ˆçš„ CSRF ä»¤ç‰Œä¿æŠ¤ä»»ä½•ä¼ å…¥çš„ POSTï¼ˆæˆ– PUT/DELETE/PATCHï¼‰è¯·æ±‚ã€‚\nè¿™æ„å‘³ç€ä»€ä¹ˆï¼Ÿ\nCSRF å’ŒæœåŠ¡å™¨ç«¯æ¸²æŸ“çš„ HTML æƒ³è±¡ä¸€ä¸‹é“¶è¡Œè½¬è´¦è¡¨å•æˆ–ä»»ä½•è¡¨å•ï¼ˆå¦‚ç™»å½•è¡¨å•ï¼‰ï¼Œè¿™äº›è¡¨å•æ˜¯ç”± @Controller å€ŸåŠ© Thymeleaf æˆ– Freemarker ç­‰æ¨¡æ¿æŠ€æœ¯å‘ˆç°çš„ã€‚\n\u0026lt;form action=\u0026#34;/transfer\u0026#34; method=\u0026#34;post\u0026#34;\u0026gt; \u0026lt;!-- 1 --\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;amount\u0026#34; /\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;routingNumber\u0026#34; /\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;account\u0026#34; /\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;Transfer\u0026#34; /\u0026gt; \u0026lt;/form\u0026gt; å¯ç”¨ Spring Security åï¼Œæ‚¨å°†æ— æ³•å†æäº¤è¯¥è¡¨å•ã€‚å› ä¸º Spring Security çš„ CSRFFilter æ­£åœ¨ä»»ä½• POST (PUT/DELETE) è¯·æ±‚ä¸Šå¯»æ‰¾é¢å¤–çš„éšè—å‚æ•°ï¼šæ‰€è°“çš„ CSRF ä»¤ç‰Œã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¼šä¸ºæ¯ä¸ª HTTP ä¼šè¯ç”Ÿæˆè¿™æ ·çš„ä»¤ç‰Œå¹¶å°†å…¶å­˜å‚¨åœ¨é‚£é‡Œã€‚æ‚¨éœ€è¦ç¡®ä¿å°†å…¶æ³¨å…¥åˆ°æ‚¨çš„ä»»ä½• HTML è¡¨å•ä¸­ã€‚\nCSRF ä»¤ç‰Œå’Œ Thymeleaf ç”±äº Thymeleaf ä¸ Spring Security å…·æœ‰è‰¯å¥½çš„é›†æˆï¼ˆå½“ä¸ Spring Boot ä¸€èµ·ä½¿ç”¨æ—¶ï¼‰ï¼Œæ‚¨åªéœ€å°†ä»¥ä¸‹ä»£ç ç‰‡æ®µæ·»åŠ åˆ°ä»»ä½•è¡¨å•ä¸­ï¼Œæ‚¨å°±å¯ä»¥å°†ä»¤ç‰Œä»ä¼šè¯ä¸­è‡ªåŠ¨æ³¨å…¥åˆ°æ‚¨çš„è¡¨å•ä¸­ã€‚æ›´å¥½çš„æ˜¯ï¼Œå¦‚æœæ‚¨åœ¨è¡¨å•ä¸­ä½¿ç”¨â€œth:actionâ€ï¼ŒThymeleaf ä¼šè‡ªåŠ¨ä¸ºæ‚¨æ³¨å…¥è¯¥éšè—å­—æ®µï¼Œè€Œæ— éœ€æ‰‹åŠ¨æ‰§è¡Œã€‚\n\u0026lt;form action=\u0026#34;/transfer\u0026#34; method=\u0026#34;post\u0026#34;\u0026gt; \u0026lt;!-- 1 --\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;amount\u0026#34; /\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;routingNumber\u0026#34; /\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;account\u0026#34; /\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;Transfer\u0026#34; /\u0026gt; \u0026lt;input type=\u0026#34;hidden\u0026#34; name=\u0026#34;${_csrf.parameterName}\u0026#34; value=\u0026#34;${_csrf.token}\u0026#34; /\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;!-- OR --\u0026gt; \u0026lt;form th:action=\u0026#34;/transfer\u0026#34; method=\u0026#34;post\u0026#34;\u0026gt; \u0026lt;!-- 2 --\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;amount\u0026#34; /\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;routingNumber\u0026#34; /\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;account\u0026#34; /\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;Transfer\u0026#34; /\u0026gt; \u0026lt;/form\u0026gt; åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ‰‹åŠ¨æ·»åŠ  CSRF å‚æ•°ã€‚ åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ Thymeleaf çš„è¡¨å•æ”¯æŒã€‚ æ³¨æ„ï¼šæœ‰å…³ Thymeleaf çš„ CSRF æ”¯æŒçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…å®˜æ–¹æ–‡æ¡£ã€‚\nCSRF å’Œå…¶ä»–æ¨¡æ¿åº“ æˆ‘æ— æ³•æ¶µç›–æœ¬èŠ‚ä¸­çš„æ‰€æœ‰æ¨¡æ¿åº“ï¼Œä½†ä½œä¸ºæœ€åçš„æ‰‹æ®µï¼Œæ‚¨å§‹ç»ˆå¯ä»¥å°† CSRFToken æ³¨å…¥åˆ°ä»»ä½• @Controller æ–¹æ³•ä¸­ï¼Œç„¶åå°†å…¶ç®€å•åœ°æ·»åŠ åˆ°æ¨¡å‹ä¸­ä»¥åœ¨è§†å›¾ä¸­å‘ˆç°å®ƒæˆ–ç›´æ¥ä½œä¸º HttpServletRequest è¯·æ±‚å±æ€§è®¿é—®å®ƒã€‚\n@Controller public class MyController { @GetMaping(\u0026#34;/login\u0026#34;) public String login(Model model, CsrfToken token) { // the token will be injected automatically return \u0026#34;/templates/login\u0026#34;; } } CSRF å’Œ React æˆ– Angular å¯¹äº Javascript åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œæƒ…å†µæœ‰äº›ä¸åŒï¼Œä¾‹å¦‚ React æˆ– Angular å•é¡µåº”ç”¨ç¨‹åºã€‚æ‚¨éœ€è¦æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š\né…ç½® Spring Security ä»¥ä½¿ç”¨ CookieCsrfTokenRepositoryï¼Œå®ƒå°†æŠŠ CSRFToken æ”¾å…¥ cookieâ€œXSRF-TOKENâ€ï¼ˆå¹¶å°†å…¶å‘é€åˆ°æµè§ˆå™¨ï¼‰ã€‚ è®©æ‚¨çš„ Javascript åº”ç”¨ç¨‹åºé‡‡ç”¨è¯¥ cookie å€¼ï¼Œå¹¶å°†å…¶ä½œä¸ºâ€œX-XSRF-TOKENâ€æ ‡å¤´ä¸æ¯ä¸ª POST(/PUT/PATCH/DELETE) è¯·æ±‚ä¸€èµ·å‘é€ã€‚ æœ‰å…³å®Œæ•´çš„å¤åˆ¶ç²˜è´´ React ç¤ºä¾‹ï¼Œè¯·æŸ¥çœ‹è¿™ç¯‡ç²¾å½©çš„åšå®¢æ–‡ç« ï¼šhttps://developer.okta.com/blog/2018/07/19/simple-crud-react-and-spring-bootã€‚\nç¦ç”¨ CSRF å¦‚æœæ‚¨ä»…æä¾›æ— çŠ¶æ€ REST APIï¼Œå…¶ä¸­ CSRF ä¿æŠ¤æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œæ‚¨å°†å®Œå…¨ç¦ç”¨ CSRF ä¿æŠ¤ã€‚æ‚¨å°†è¿™æ ·åšï¼š\n@EnableWebSecurity @Configuration public class WebSecurityConfig extends WebSecurityConfigurerAdapter { @Override protected void configure(HttpSecurity http) throws Exception { http .csrf().disable(); } } OAuth2 Spring Security çš„ OAuth2 é›†æˆæ˜¯ä¸€ä¸ªå¤æ‚çš„ä¸»é¢˜ï¼Œå¦å¤– 7,000 å­—å°±è¶³å¤Ÿäº†ï¼Œè¿™ä¸å±äºæœ¬æ–‡çš„èŒƒå›´ã€‚\nSpring é›†æˆ Spring Security \u0026amp; Spring Framework åœ¨æœ¬æ–‡çš„å¤§éƒ¨åˆ†å†…å®¹ä¸­ï¼Œæ‚¨ä»…åœ¨åº”ç”¨ç¨‹åºçš„ Web å±‚ä¸ŠæŒ‡å®šäº†å®‰å…¨é…ç½®ã€‚æ‚¨ä½¿ç”¨ antMatcher æˆ– regexMatchers ä»¥åŠ WebSecurityConfigurerAdapter çš„ DSL æ¥ä¿æŠ¤æŸäº› URLã€‚è¿™æ˜¯ä¸€ç§å®Œç¾ä¸”æ ‡å‡†çš„å®‰å…¨æ–¹æ³•ã€‚\né™¤äº†ä¿æŠ¤æ‚¨çš„ç½‘ç»œå±‚ä¹‹å¤–ï¼Œè¿˜æœ‰â€œçºµæ·±é˜²å¾¡â€çš„æƒ³æ³•ã€‚è¿™æ„å‘³ç€é™¤äº†ä¿æŠ¤ URL ä¹‹å¤–ï¼Œæ‚¨å¯èƒ½è¿˜æƒ³ä¿æŠ¤ä¸šåŠ¡é€»è¾‘æœ¬èº«ã€‚æƒ³æƒ³ï¼šä½ çš„@Controllersã€@Componentsã€@Services ç”šè‡³@Repositoriesã€‚ç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯æ‚¨çš„ Spring beansã€‚\næ–¹æ³•å®‰å…¨æ€§ è¯¥æ–¹æ³•ç§°ä¸º *method security* å¹¶é€šè¿‡æ³¨é‡Šå·¥ä½œï¼Œæ‚¨åŸºæœ¬ä¸Šå¯ä»¥å°†è¿™äº›æ³¨é‡Šæ”¾åœ¨ Spring bean çš„ä»»ä½•å…¬å…±æ–¹æ³•ä¸Šã€‚æ‚¨è¿˜éœ€è¦é€šè¿‡åœ¨ ApplicationContextConfiguration ä¸Šæ”¾ç½® @EnableGlobalMethodSecurity æ³¨é‡Šæ¥æ˜¾å¼å¯ç”¨æ–¹æ³•å®‰å…¨æ€§ã€‚\n@Configuration @EnableGlobalMethodSecurity( prePostEnabled = true, // (1) securedEnabled = true, // (2) jsr250Enabled = true) // (3) public class YourSecurityConfig extends WebSecurityConfigurerAdapter{ } prePostEnabled å±æ€§å¯ç”¨å¯¹ Spring çš„ *@PreAuthorize* å’Œ *@PostAuthorize* æ³¨é‡Šçš„æ”¯æŒã€‚æ”¯æŒæ„å‘³ç€ï¼Œé™¤éæ‚¨å°†æ ‡å¿—è®¾ç½®ä¸º trueï¼Œå¦åˆ™ Spring å°†å¿½ç•¥æ­¤æ³¨é‡Šã€‚ secureEnabled å±æ€§å¯ç”¨å¯¹ *@Secured* æ³¨é‡Šçš„æ”¯æŒã€‚æ”¯æŒæ„å‘³ç€ï¼Œé™¤éæ‚¨å°†æ ‡å¿—è®¾ç½®ä¸º trueï¼Œå¦åˆ™ Spring å°†å¿½ç•¥æ­¤æ³¨é‡Šã€‚ jsr250Enabled å±æ€§å¯ç”¨å¯¹ *@RolesAllowed* æ³¨é‡Šçš„æ”¯æŒã€‚æ”¯æŒæ„å‘³ç€ï¼Œé™¤éæ‚¨å°†æ ‡å¿—è®¾ç½®ä¸º trueï¼Œå¦åˆ™ Spring å°†å¿½ç•¥æ­¤æ³¨é‡Šã€‚ @PreAuthorizeã€@Secured å’Œ @RolesAllowed ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ @Secured å’Œ @RolesAllowed åŸºæœ¬ä¸Šæ˜¯ç›¸åŒçš„ï¼Œå°½ç®¡ @Secured æ˜¯ Spring ç‰¹å®šçš„æ³¨é‡Šï¼Œå¸¦æœ‰ spring-security-core ä¾èµ–é¡¹ï¼Œè€Œ @RolesAllowed æ˜¯ä¸€ä¸ªæ ‡å‡†åŒ–æ³¨é‡Šï¼Œå­˜åœ¨äº javax.annotation-api ä¾èµ–é¡¹ä¸­ã€‚ä¸¤ä¸ªæ³¨é‡Šéƒ½é‡‡ç”¨æƒé™/è§’è‰²å­—ç¬¦ä¸²ä½œä¸ºå€¼ã€‚\n@PreAuthorize/@PostAuthorize ä¹Ÿæ˜¯ï¼ˆè¾ƒæ–°çš„ï¼‰Spring ç‰¹å®šæ³¨é‡Šï¼Œå¹¶ä¸”æ¯”ä¸Šè¿°æ³¨é‡Šæ›´å¼ºå¤§ï¼Œå› ä¸ºå®ƒä»¬ä¸ä»…å¯ä»¥åŒ…å«æƒé™/è§’è‰²ï¼Œè¿˜å¯ä»¥åŒ…å«ä»»ä½•æœ‰æ•ˆçš„ SpEL è¡¨è¾¾å¼ã€‚\næœ€åï¼Œå¦‚æœæ‚¨å°è¯•ä½¿ç”¨æƒé™/è§’è‰²ä¸è¶³è®¿é—®å—ä¿æŠ¤çš„æ–¹æ³•ï¼Œæ‰€æœ‰è¿™äº›æ³¨é‡Šéƒ½ä¼šå¼•å‘ *AccessDeniedException* ã€‚\né‚£ä¹ˆï¼Œè®©æˆ‘ä»¬æœ€ç»ˆçœ‹çœ‹è¿™äº›æ³¨é‡Šçš„å®é™…æ•ˆæœã€‚\n@Service public class SomeService { @Secured(\u0026#34;ROLE_CALLCENTER\u0026#34;) // (1) // == @RolesAllowed(\u0026#34;ADMIN\u0026#34;) public BankAccountInfo get(...) { } @PreAuthorize(\u0026#34;isAnonymous()\u0026#34;) // (2) // @PreAuthorize(\u0026#34;#contact.name == principal.name\u0026#34;) // @PreAuthorize(\u0026#34;ROLE_ADMIN\u0026#34;) public void trackVisit(Long id); } } å¦‚å‰æ‰€è¿°ï¼Œ@Secured å°†æƒé™/è§’è‰²ä½œä¸ºå‚æ•°ã€‚ @RolesAllowedï¼ŒåŒæ ·ã€‚æ³¨æ„ï¼šè¯·è®°ä½ *@RolesAllowed(\u0026quot;ADMIN\u0026quot;)* å°†æ£€æŸ¥æˆäºˆçš„æƒé™ *ROLE_ADMIN* ã€‚ å¦‚å‰æ‰€è¿°ï¼Œ@PreAuthorize æ¥å—æƒé™ï¼Œä½†ä¹Ÿæ¥å—ä»»ä½•æœ‰æ•ˆçš„ SpEL è¡¨è¾¾å¼ã€‚æœ‰å…³å¸¸è§å†…ç½®å®‰å…¨è¡¨è¾¾å¼ï¼ˆå¦‚ä¸Šé¢çš„ *isAnonymous()* ï¼‰çš„åˆ—è¡¨ï¼Œè€Œä¸æ˜¯ç¼–å†™æ‚¨è‡ªå·±çš„ SpEL è¡¨è¾¾å¼ï¼Œè¯·æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚ æˆ‘åº”è¯¥ä½¿ç”¨å“ªä¸ªæ³¨é‡Šï¼Ÿ è¿™ä¸»è¦æ˜¯åŒè´¨æ€§é—®é¢˜ï¼Œè€Œä¸æ˜¯å°†è‡ªå·±è¿‡å¤šåœ°æŸç¼šäº Spring ç‰¹å®šçš„ APIï¼ˆè¿™æ˜¯ä¸€ä¸ªç»å¸¸æå‡ºçš„è®ºç‚¹ï¼‰ã€‚\nå¦‚æœä½¿ç”¨ @Securedï¼Œè¯·åšæŒä¸‹å»ï¼Œä¸è¦åœ¨ 28% çš„å…¶ä»– bean ä¸­ä½¿ç”¨ @RolesAllowed æ³¨é‡Šæ¥åŠªåŠ›æ ‡å‡†åŒ–ï¼Œä½†æ°¸è¿œä¸ä¼šå®Œå…¨å®ç°ã€‚\né¦–å…ˆï¼Œæ‚¨å§‹ç»ˆå¯ä»¥ä½¿ç”¨ @Secured å¹¶åœ¨éœ€è¦æ—¶ç«‹å³åˆ‡æ¢åˆ° @PreAuthorizeã€‚\nSpring Security å’Œ Spring Web MVC è‡³äºä¸ Spring WebMVC çš„é›†æˆï¼ŒSpring Security å…è®¸æ‚¨æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š\né™¤äº† antMatchers å’Œ regexMatchers ä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨ mvcMatchersã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼Œè™½ç„¶ antMatchers å’Œ regexMatchers åŸºæœ¬ä¸Šä½¿ç”¨é€šé…ç¬¦åŒ¹é… URI å­—ç¬¦ä¸²ï¼Œä½† mvcMatchers çš„è¡Œä¸ºä¸ @RequestMappings å®Œå…¨ç›¸åŒã€‚ å°†å½“å‰ç»è¿‡èº«ä»½éªŒè¯çš„ä¸»ä½“æ³¨å…¥åˆ° @Controller/@RestController æ–¹æ³•ä¸­ã€‚ å°†å½“å‰ä¼šè¯ CSRFToken æ³¨å…¥åˆ° @Controller/@RestController æ–¹æ³•ä¸­ã€‚ æ­£ç¡®å¤„ç†å¼‚æ­¥è¯·æ±‚å¤„ç†çš„å®‰å…¨æ€§ã€‚ @Controller public class MyController { @RequestMapping(\u0026#34;/messages/inbox\u0026#34;) public ModelAndView findMessagesForUser(@AuthenticationPrincipal CustomUser customUser, CsrfToken token) { // (1) (2) // .. find messages for this user and return them ... } } å¦‚æœç”¨æˆ·ç»è¿‡èº«ä»½éªŒè¯ï¼Œ@AuthenticationPrincipal å°†æ³¨å…¥ä¸»ä½“ï¼›å¦‚æœæ²¡æœ‰ç”¨æˆ·ç»è¿‡èº«ä»½éªŒè¯ï¼Œåˆ™ @AuthenticationPrincipal å°†æ³¨å…¥ nullã€‚è¯¥ä¸»ä½“æ˜¯æ¥è‡ª UserDetailsSâ€‹â€‹ervice/AuthenticationManager çš„å¯¹è±¡ï¼ æˆ–è€…æ‚¨å¯ä»¥å°†å½“å‰ä¼šè¯ CSRFToken æ³¨å…¥æ¯ä¸ªæ–¹æ³•ä¸­ã€‚ å¦‚æœæ‚¨ä¸ä½¿ç”¨ @AuthenticationPrincipal æ³¨é‡Šï¼Œåˆ™å¿…é¡»é€šè¿‡ SecurityContextHolder è‡ªè¡Œè·å–ä¸»ä½“ã€‚è¿™æ˜¯ä¸€ç§åœ¨é—ç•™ Spring Security åº”ç”¨ç¨‹åºä¸­å¸¸è§çš„æŠ€æœ¯ã€‚\n@Controller public class MyController { @RequestMapping(\u0026#34;/messages/inbox\u0026#34;) public ModelAndView findMessagesForUser(CsrfToken token) { SecurityContext context = SecurityContextHolder.getContext(); Authentication authentication = context.getAuthentication(); if (authentication != null \u0026amp;\u0026amp; authentication.getPrincipal() instanceof UserDetails) { CustomUser customUser = (CustomUser) authentication.getPrincipal(); // .. find messages for this user and return them ... } // todo } } Spring Security \u0026amp; Spring Boot æ¯å½“æ‚¨å°† spring-boot-starter-security ä¾èµ–é¡¹æ·»åŠ åˆ° Spring Boot é¡¹ç›®æ—¶ï¼ŒSpring Boot å®é™…ä¸Šåªä¼šä¸ºæ‚¨é¢„å…ˆé…ç½® Spring Securityã€‚\né™¤æ­¤ä¹‹å¤–ï¼Œæ‰€æœ‰å®‰å…¨é…ç½®éƒ½æ˜¯é€šè¿‡ç®€å•çš„ Spring Security æ¦‚å¿µï¼ˆä¾‹å¦‚ï¼šWebSecurityConfigurerAdapterã€èº«ä»½éªŒè¯å’Œæˆæƒè§„åˆ™ï¼‰å®Œæˆçš„ï¼Œè¿™äº›æ¦‚å¿µæœ¬èº«ä¸ Spring Boot æ— å…³ã€‚\nå› æ­¤ï¼Œæ‚¨åœ¨æœ¬æŒ‡å—ä¸­é˜…è¯»çš„æ‰€æœ‰å†…å®¹éƒ½ä¸€ä¸€é€‚ç”¨äºå°† Spring Security ä¸ Spring Boot ç»“åˆä½¿ç”¨ã€‚å¦‚æœæ‚¨ä¸äº†è§£ç®€å•çš„å®‰å…¨æ€§ï¼Œå°±ä¸è¦æŒ‡æœ›æ­£ç¡®ç†è§£è¿™ä¸¤ç§æŠ€æœ¯å¦‚ä½•ååŒå·¥ä½œã€‚\nSpring Security \u0026amp; Thymeleaf Spring Security ä¸ Thymeleaf é›†æˆè‰¯å¥½ã€‚å®ƒæä¾›äº†ä¸€ç§ç‰¹æ®Šçš„ Spring Security Thymeleaf æ–¹è¨€ï¼Œå…è®¸æ‚¨å°†å®‰å…¨è¡¨è¾¾å¼ç›´æ¥æ”¾å…¥ Thymeleaf HTML æ¨¡æ¿ä¸­ã€‚\n\u0026lt;div sec:authorize=\u0026#34;isAuthenticated()\u0026#34;\u0026gt; This content is only shown to authenticated users. \u0026lt;/div\u0026gt; \u0026lt;div sec:authorize=\u0026#34;hasRole(\u0026#39;ROLE_ADMIN\u0026#39;)\u0026#34;\u0026gt; This content is only shown to administrators. \u0026lt;/div\u0026gt; \u0026lt;div sec:authorize=\u0026#34;hasRole(\u0026#39;ROLE_USER\u0026#39;)\u0026#34;\u0026gt; This content is only shown to users. \u0026lt;/div\u0026gt; æœ‰å…³è¿™ä¸¤ç§æŠ€æœ¯å¦‚ä½•ååŒå·¥ä½œçš„å®Œæ•´ä¸”æ›´è¯¦ç»†çš„æ¦‚è¿°ï¼Œè¯·æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚\nFAQ Spring Security çš„æœ€æ–°ç‰ˆæœ¬æ˜¯ä»€ä¹ˆï¼Ÿ æˆªè‡³ 2022 å¹´ 5 æœˆï¼Œå³ä¸º 5.7.1.RELEASEã€‚\nè¯·æ³¨æ„ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ Spring Boot å®šä¹‰çš„ Spring Security ä¾èµ–é¡¹ï¼Œæ‚¨å¯èƒ½ä½¿ç”¨çš„æ˜¯ç¨æ—§çš„ Spring Security ç‰ˆæœ¬ï¼Œä¾‹å¦‚ 5.2.1ã€‚\nè¾ƒæ—§çš„ Spring Security ç‰ˆæœ¬æ˜¯å¦ä¸æœ€æ–°ç‰ˆæœ¬å…¼å®¹ï¼Ÿ Spring Security æœ€è¿‘ç»å†äº†ä¸€äº›é‡å¤§å˜åŒ–ã€‚å› æ­¤ï¼Œæ‚¨éœ€è¦æ‰¾åˆ°ç›®æ ‡ç‰ˆæœ¬çš„è¿ç§»æŒ‡å—å¹¶å®Œæˆå®ƒä»¬ï¼š\nSpring Security 3.x åˆ° 4.x â†’ https://docs.spring.io/spring-security/site/migrate/current/3-to-4/html5/migrate-3-to-4-jc.html Spring Security 4.x åˆ° 5.x(\u0026lt; 5.3) â†’ https://docs.spring.io/spring-security/site/docs/5.0.15.RELEASE/reference/htmlsingle/#new ï¼ˆä¸æ˜¯è¿ç§»æŒ‡å—ï¼Œä½†æœ‰ä»€ä¹ˆæ–°é²œäº‹ï¼‰ Spring Security 5.x åˆ° 5.3 â†’ https://docs.spring.io/spring-security/site/docs/5.3.1.RELEASE/reference/html5/#new ï¼ˆä¸æ˜¯è¿ç§»æŒ‡å—ï¼Œè€Œæ˜¯æ–°åŠŸèƒ½ï¼‰ Spring Security æœ€æ–°ç‰ˆæœ¬ â†’ https://docs.spring.io/spring-security/reference/whats-new.htmlï¼ˆä¸æ˜¯è¿ç§»æŒ‡å—ï¼Œè€Œæ˜¯æ–°åŠŸèƒ½ï¼‰ æˆ‘éœ€è¦æ·»åŠ å“ªäº›ä¾èµ–é¡¹æ‰èƒ½ä½¿ Spring Security æ­£å¸¸å·¥ä½œï¼Ÿ Plain Spring Project å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯æ™®é€š Spring é¡¹ç›®ï¼ˆä¸æ˜¯ Spring Bootï¼‰ï¼Œåˆ™éœ€è¦å°†ä»¥ä¸‹ä¸¤ä¸ª Maven/Gradle ä¾èµ–é¡¹æ·»åŠ åˆ°æ‚¨çš„é¡¹ç›®ä¸­ï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.security\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-security-web\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.7.1.RELEASE\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.security\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-security-config\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.7.1.RELEASE\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; æ‚¨è¿˜éœ€è¦åœ¨ web.xml æˆ– Java é…ç½®ä¸­é…ç½® SecurityFilterChainã€‚è¯·å‚é˜…æ­¤å¤„å¦‚ä½•æ“ä½œã€‚\nSpring Boot Project å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨ Spring Boot é¡¹ç›®ï¼Œåˆ™éœ€è¦å°†ä»¥ä¸‹ Maven/Gradle ä¾èµ–é¡¹æ·»åŠ åˆ°æ‚¨çš„é¡¹ç›®ä¸­ï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-security\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; å…¶ä»–æ‰€æœ‰å†…å®¹éƒ½ä¼šè‡ªåŠ¨ä¸ºæ‚¨é…ç½®ï¼Œæ‚¨å¯ä»¥ç«‹å³å¼€å§‹ç¼–å†™ WebSecurityConfigurerAdapterã€‚\nå¦‚ä½•ä»¥ç¼–ç¨‹æ–¹å¼è®¿é—® Spring Security ä¸­å½“å‰ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ï¼Ÿ æ­£å¦‚æœ¬æ–‡ä¸­æåˆ°çš„ï¼ŒSpring Security å°†å½“å‰ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·ï¼ˆæˆ–è€…æ›´ç¡®åˆ‡åœ°è¯´æ˜¯ SecurityContextï¼‰å­˜å‚¨åœ¨ SecurityContextHolder å†…çš„çº¿ç¨‹å±€éƒ¨å˜é‡ä¸­ã€‚æ‚¨å¯ä»¥åƒè¿™æ ·è®¿é—®å®ƒï¼š\nSecurityContext context = SecurityContextHolder.getContext(); Authentication authentication = context.getAuthentication(); String username = authentication.getName(); Object principal = authentication.getPrincipal(); Collection\u0026lt;? extends GrantedAuthority\u0026gt; authorities = authentication.getAuthorities(); è¯·æ³¨æ„ï¼Œå¦‚æœæ‚¨æœªç™»å½•ï¼ŒSpring Security é»˜è®¤æƒ…å†µä¸‹ä¼šåœ¨ SecurityContextHolder ä¸Šè®¾ç½® *AnonymousAuthenticationToken* ä½œä¸ºèº«ä»½éªŒè¯ã€‚è¿™ä¼šå¯¼è‡´ä¸€äº›æ··ä¹±ï¼Œå› ä¸ºäººä»¬è‡ªç„¶ä¼šæœŸæœ›é‚£é‡Œæœ‰ä¸€ä¸ª null å€¼ã€‚\nAntMatchersï¼šå¸¸è§ç¤ºä¾‹ ä¸€ä¸ªæ— æ„ä¹‰çš„ç¤ºä¾‹æ˜¾ç¤ºäº†æœ€æœ‰ç”¨çš„ antMatchers ï¼ˆå’Œ regexMatcher/mvcMatcherï¼‰å¯èƒ½æ€§ï¼š\n@Override protected void configure(HttpSecurity http) throws Exception { http .authorizeRequests() .antMatchers(\u0026#34;/api/user/**\u0026#34;, \u0026#34;/api/ticket/**\u0026#34;, \u0026#34;/index\u0026#34;).hasAuthority(\u0026#34;ROLE_USER\u0026#34;) .antMatchers(HttpMethod.POST, \u0026#34;/forms/**\u0026#34;).hasAnyRole(\u0026#34;ADMIN\u0026#34;, \u0026#34;CALLCENTER\u0026#34;) .antMatchers(\u0026#34;/user/**\u0026#34;).access(\u0026#34;@webSecurity.check(authentication,request)\u0026#34;); } å¦‚ä½•åœ¨ Spring Security ä¸­ä½¿ç”¨è‡ªå®šä¹‰ç™»å½•é¡µé¢ï¼Ÿ @Override protected void configure(HttpSecurity http) throws Exception { http .authorizeRequests() .anyRequest().authenticated() .and() .formLogin() .loginPage(\u0026#34;/login\u0026#34;) // (1) .permitAll(); } æ‚¨çš„è‡ªå®šä¹‰ç™»å½•é¡µé¢çš„ URLã€‚ä¸€æ—¦æŒ‡å®šæ­¤é€‰é¡¹ï¼Œè‡ªåŠ¨ç”Ÿæˆçš„ç™»å½•é¡µé¢å°±ä¼šæ¶ˆå¤±ã€‚ å¦‚ä½•ä½¿ç”¨ Spring Security è¿›è¡Œç¼–ç¨‹ç™»å½•ï¼Ÿ UserDetails principal = userDetailsService.loadUserByUsername(username); Authentication authentication = new UsernamePasswordAuthenticationToken(principal, principal.getPassword(), principal.getAuthorities()); SecurityContext context = SecurityContextHolder.createEmptyContext(); context.setAuthentication(authentication); å¦‚ä½•ä»…é’ˆå¯¹æŸäº›è·¯å¾„ç¦ç”¨ CSRFï¼Ÿ @Override protected void configure(HttpSecurity http) throws Exception { http .csrf().ignoringAntMatchers(\u0026#34;/api/**\u0026#34;); } Fin å¦‚æœæ‚¨å·²ç»è¯»åˆ°è¿™é‡Œï¼Œæ‚¨ç°åœ¨åº”è¯¥å¯¹ Spring Security ç”Ÿæ€ç³»ç»Ÿçš„å¤æ‚æ€§æœ‰äº†å¾ˆå¥½çš„äº†è§£ï¼Œå³ä½¿æ²¡æœ‰ OAuth2ã€‚æ€»ç»“ä¸€ä¸‹ï¼š\nå¦‚æœæ‚¨å¯¹ Spring Security çš„ FilterChain å¦‚ä½•å·¥ä½œä»¥åŠå®ƒçš„é»˜è®¤æ¼æ´ä¿æŠ¤æœ‰ä»€ä¹ˆåŸºæœ¬äº†è§£ï¼ˆæƒ³æƒ³ï¼šCSRFï¼‰ï¼Œè¿™ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚ ç¡®ä¿äº†è§£èº«ä»½éªŒè¯å’Œæˆæƒä¹‹é—´çš„åŒºåˆ«ã€‚è¿˜æœ‰æ‚¨éœ€è¦ä¸ºç‰¹å®šèº«ä»½éªŒè¯å·¥ä½œæµç¨‹æŒ‡å®šå“ªäº› @Beansã€‚ ç¡®ä¿æ‚¨äº†è§£ Spring Security çš„ WebSecurityConfigurerAdapter çš„ DSL ä»¥åŠåŸºäºæ³¨é‡Šçš„æ–¹æ³•å®‰å…¨æ€§ã€‚ æœ€åä½†å¹¶éæœ€ä¸é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œå®ƒæœ‰åŠ©äºä»”ç»†æ£€æŸ¥ Spring Security ä¸å…¶ä»–æ¡†æ¶å’Œåº“ï¼ˆå¦‚ Spring MVC æˆ– Thymeleafï¼‰çš„é›†æˆã€‚ ä»Šå¤©å°±å¤Ÿäº†ï¼Œå› ä¸ºè¿™çœŸæ˜¯ä¸€æ®µæ—…ç¨‹ï¼Œä¸æ˜¯å—ï¼Ÿè°¢è°¢é˜…è¯»ï¼\nè‡´è°¢ å‘ Patricio \u0026ldquo;Pato\u0026rdquo; Moschcovich è‡´ä»¥æ·±æ·±çš„è°¢æ„ï¼Œä»–ä¸ä»…å¯¹æœ¬æ–‡è¿›è¡Œäº†æ ¡å¯¹ï¼Œè¿˜æä¾›äº†å®è´µçš„åé¦ˆï¼\nåŸæ–‡é“¾æ¥ï¼šhttps://www.marcobehler.com/guides/spring-security\n","permalink":"https://blog.chensoul.cc/posts/2023/08/16/spring-security-authentication-and-authorization/","summary":"æ‚¨å¯ä»¥ä½¿ç”¨æœ¬æŒ‡å—æ¥äº†è§£ Spring Security æ˜¯ä»€ä¹ˆä»¥åŠå…¶æ ¸å¿ƒåŠŸèƒ½ï¼ˆå¦‚èº«ä»½éªŒè¯ã€æˆæƒæˆ–å¸¸è§æ¼æ´ä¿æŠ¤ï¼‰å¦‚ä½•å·¥ä½œã€‚æ­¤å¤–ï¼Œè¿˜æœ‰å…¨é¢çš„å¸¸è§é—®é¢˜è§£ç­”ã€‚\nï¼ˆç¼–è€…æ³¨ï¼šå¤§çº¦ 6500 å­—ï¼Œæ‚¨å¯èƒ½ä¸æƒ³å°è¯•åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šé˜…è¯»æœ¬æ–‡ã€‚å°†å…¶æ·»åŠ ä¸ºä¹¦ç­¾ï¼Œç¨åå†å›æ¥ã€‚ï¼‰\nä»‹ç» è¿Ÿæ—©æ¯ä¸ªäººéƒ½éœ€è¦ä¸ºå…¶é¡¹ç›®æ·»åŠ å®‰å…¨æ€§ï¼Œåœ¨ Spring ç”Ÿæ€ç³»ç»Ÿä¸­ï¼Œæ‚¨å¯ä»¥å€ŸåŠ© Spring Security åº“æ¥å®ç°è¿™ä¸€ç‚¹ã€‚\nå› æ­¤ï¼Œæ‚¨ç»§ç»­å°† Spring Security æ·»åŠ åˆ°æ‚¨çš„ Spring Bootï¼ˆæˆ–æ™®é€š Springï¼‰é¡¹ç›®ä¸­ï¼Œç„¶åçªç„¶â€¦â€¦â€‹\n\u0026hellip;æ‚¨æœ‰è‡ªåŠ¨ç”Ÿæˆçš„ç™»å½•é¡µé¢ã€‚ \u0026hellip;æ‚¨æ— æ³•å†æ‰§è¡Œ POST è¯·æ±‚ã€‚ \u0026hellip;â€‹ æ‚¨çš„æ•´ä¸ªåº”ç”¨ç¨‹åºå¤„äºé”å®šçŠ¶æ€ï¼Œå¹¶æç¤ºæ‚¨è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚ åœ¨ç»å†äº†éšåçš„ç²¾ç¥å´©æºƒä¹‹åï¼Œæ‚¨å¯èƒ½ä¼šå¯¹è¿™ä¸€åˆ‡æ˜¯å¦‚ä½•è¿ä½œçš„æ„Ÿå…´è¶£ã€‚\nä»€ä¹ˆæ˜¯ Spring Security ä»¥åŠå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ ç®€çŸ­çš„å›ç­”ï¼š ä»æœ¬è´¨ä¸Šè®²ï¼ŒSpring Security å®é™…ä¸Šåªæ˜¯ä¸€å † servlet è¿‡æ»¤å™¨ï¼Œå¯å¸®åŠ©æ‚¨å‘ Web åº”ç”¨ç¨‹åºæ·»åŠ èº«ä»½éªŒè¯å’Œæˆæƒã€‚ å®ƒè¿˜ä¸ Spring Web MVCï¼ˆæˆ– Spring Bootï¼‰ç­‰æ¡†æ¶ä»¥åŠ OAuth2 æˆ– SAML ç­‰æ ‡å‡†å¾ˆå¥½åœ°é›†æˆã€‚å®ƒä¼šè‡ªåŠ¨ç”Ÿæˆç™»å½•/æ³¨é”€é¡µé¢å¹¶é˜²æ­¢ CSRF ç­‰å¸¸è§æ¼æ´ã€‚ ç°åœ¨ï¼Œè¿™å¹¶æ²¡æœ‰ä»€ä¹ˆå¸®åŠ©ï¼Œä¸æ˜¯å—ï¼Ÿ å¹¸è¿çš„æ˜¯ï¼Œè¿˜æœ‰ä¸€ä¸ªå¾ˆé•¿çš„ç­”æ¡ˆï¼šæœ¬æ–‡çš„å…¶ä½™éƒ¨åˆ†ã€‚\nç½‘ç»œåº”ç”¨ç¨‹åºå®‰å…¨ï¼š101 åœ¨æˆä¸º Spring Security å¤§å¸ˆä¹‹å‰ï¼Œæ‚¨éœ€è¦äº†è§£ä¸‰ä¸ªé‡è¦æ¦‚å¿µï¼š\nAuthentication éªŒè¯ Authorization æˆæƒ Servlet Filters è¿‡æ»¤å™¨ å»ºè®®ï¼šä¸è¦è·³è¿‡æœ¬èŠ‚ï¼Œå› ä¸ºå®ƒæ˜¯ Spring Security æ‰€åšçš„ä¸€åˆ‡çš„åŸºç¡€ã€‚å¦å¤–ï¼Œæˆ‘ä¼šè®©å®ƒå°½å¯èƒ½æœ‰è¶£ã€‚\n1. è®¤è¯ é¦–å…ˆï¼Œå¦‚æœæ‚¨æ­£åœ¨è¿è¡Œå…¸å‹çš„ï¼ˆWebï¼‰åº”ç”¨ç¨‹åºï¼Œæ‚¨éœ€è¦ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ã€‚è¿™æ„å‘³ç€æ‚¨çš„åº”ç”¨ç¨‹åºéœ€è¦éªŒè¯ç”¨æˆ·æ˜¯å¦æ˜¯ä»–æ‰€å£°ç§°çš„äººï¼Œé€šå¸¸é€šè¿‡ç”¨æˆ·åå’Œå¯†ç æ£€æŸ¥æ¥å®Œæˆã€‚\nç”¨æˆ·ï¼šâ€œæˆ‘æ˜¯ç¾å›½æ€»ç»Ÿã€‚æˆ‘çš„ *username* æ˜¯ï¼špotusï¼â€ æ‚¨çš„ç½‘ç»œåº”ç”¨ç¨‹åºï¼šâ€œå½“ç„¶å¯ä»¥ï¼Œé‚£ä¹ˆæ‚¨çš„ *password* æ˜¯ä»€ä¹ˆï¼Œæ€»ç»Ÿå…ˆç”Ÿï¼Ÿâ€ ç”¨æˆ·ï¼šâ€œæˆ‘çš„å¯†ç æ˜¯ï¼šth3don4ldâ€ã€‚ æ‚¨çš„ç½‘ç»œåº”ç”¨ç¨‹åºï¼šâ€œæ­£ç¡®ã€‚æ¬¢è¿ï¼Œå…ˆç”Ÿï¼â€\n2ã€æˆæƒ åœ¨æ›´ç®€å•çš„åº”ç”¨ç¨‹åºä¸­ï¼Œèº«ä»½éªŒè¯å¯èƒ½å°±è¶³å¤Ÿäº†ï¼šç”¨æˆ·ç»è¿‡èº«ä»½éªŒè¯åï¼Œå¥¹å°±å¯ä»¥è®¿é—®åº”ç”¨ç¨‹åºçš„æ¯ä¸ªéƒ¨åˆ†ã€‚\nä½†å¤§å¤šæ•°åº”ç”¨ç¨‹åºéƒ½æœ‰æƒé™ï¼ˆæˆ–è§’è‰²ï¼‰çš„æ¦‚å¿µã€‚æƒ³è±¡ä¸€ä¸‹ï¼šå¯ä»¥è®¿é—®æ‚¨çš„ç½‘ä¸Šå•†åº—é¢å‘å…¬ä¼—çš„å‰ç«¯çš„å®¢æˆ·ï¼Œä»¥åŠå¯ä»¥è®¿é—®å•ç‹¬ç®¡ç†åŒºåŸŸçš„ç®¡ç†å‘˜ã€‚\nä¸¤ç§ç±»å‹çš„ç”¨æˆ·éƒ½éœ€è¦ç™»å½•ï¼Œä½†èº«ä»½éªŒè¯è¿™ä¸€äº‹å®å¹¶ä¸èƒ½è¯´æ˜ä»–ä»¬å¯ä»¥åœ¨ç³»ç»Ÿä¸­æ‰§è¡Œå“ªäº›æ“ä½œã€‚å› æ­¤ï¼Œæ‚¨è¿˜éœ€è¦æ£€æŸ¥ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·çš„æƒé™ï¼Œå³æ‚¨éœ€è¦æˆæƒè¯¥ç”¨æˆ·ã€‚\nç”¨æˆ·ï¼šâ€œè®©æˆ‘ç©é‚£ä¸ªæ ¸è¶³çƒ\u0026hellip;\u0026hellip;â€ã€‚ æ‚¨çš„ç½‘ç»œåº”ç”¨ç¨‹åºï¼šâ€œç­‰ä¸€ä¸‹ï¼Œæˆ‘éœ€è¦å…ˆæ£€æŸ¥æ‚¨çš„ *permissions* â€¦â€¦æ˜¯çš„ï¼Œæ€»ç»Ÿå…ˆç”Ÿï¼Œæ‚¨æ‹¥æœ‰æ­£ç¡®çš„è®¸å¯çº§åˆ«ã€‚å°½æƒ…äº«å—å§ã€‚â€ ç”¨æˆ·ï¼šâ€œé‚£ä¸ªçº¢è‰²æŒ‰é’®åˆæ˜¯ä»€ä¹ˆâ€¦â€¦â€‹ï¼Ÿâ€\n3.Servlet è¿‡æ»¤å™¨ æœ€åä½†å¹¶éæœ€ä¸é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ Servlet è¿‡æ»¤å™¨ã€‚å®ƒä»¬ä¸èº«ä»½éªŒè¯å’Œæˆæƒæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ ï¼ˆå¦‚æœæ‚¨å¯¹ Java Servlet æˆ– Filter å®Œå…¨é™Œç”Ÿï¼Œæˆ‘å»ºè®®æ‚¨é˜…è¯»æ—§çš„ä½†ä»ç„¶éå¸¸æœ‰æ•ˆçš„ Head First Servlets ä¹¦ã€‚ï¼‰","title":"[è¯‘]Spring Securityï¼šæ·±å…¥äº†è§£èº«ä»½éªŒè¯å’Œæˆæƒ"},{"content":"æ‚¨å¯ä»¥ä½¿ç”¨æœ¬æŒ‡å—æ¥ç®€å•å®ç”¨åœ°äº†è§£ Spring ä½¿ç”¨ @Transactional æ³¨é‡Šè¿›è¡Œäº‹åŠ¡ç®¡ç†çš„å·¥ä½œåŸç†ã€‚\nå”¯ä¸€çš„å…ˆå†³æ¡ä»¶ï¼Ÿæ‚¨éœ€è¦å¯¹ ACID æœ‰ä¸€ä¸ªç²—ç•¥çš„äº†è§£ï¼Œå³ä»€ä¹ˆæ˜¯æ•°æ®åº“äº‹åŠ¡ä»¥åŠä¸ºä»€ä¹ˆä½¿ç”¨å®ƒä»¬ã€‚æ­¤å¤–ï¼Œè¿™é‡Œä¸è®¨è®ºåˆ†å¸ƒå¼äº‹åŠ¡æˆ–ååº”å¼äº‹åŠ¡ï¼Œä½†å°± Spring è€Œè¨€ï¼Œä¸€èˆ¬åŸåˆ™ä»ç„¶é€‚ç”¨ã€‚\nä»‹ç» åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæ‚¨å°†äº†è§£ Spring æ ¸å¿ƒäº‹åŠ¡æŠ½è±¡æ¡†æ¶çš„ä¸»è¦æ”¯æŸ±ï¼ˆè¿™æ˜¯ä¸€ä¸ªä»¤äººå›°æƒ‘çš„æœ¯è¯­ï¼Œä¸æ˜¯å—ï¼Ÿï¼‰ - ç”¨å¤§é‡ä»£ç ç¤ºä¾‹è¿›è¡Œæè¿°ï¼š\n@Transactional ï¼ˆå£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼‰ä¸ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†ã€‚ ç‰©ç†äº‹åŠ¡ä¸é€»è¾‘äº‹åŠ¡ã€‚ Spring @Transactional ä¸ JPA/Hibernate é›†æˆã€‚ Spring @Transactional ä¸ Spring Boot æˆ– Spring MVC é›†æˆã€‚ å›æ»šã€ä»£ç†ã€å¸¸è§é™·é˜±ç­‰ç­‰ã€‚ ä¸ Spring å®˜æ–¹æ–‡æ¡£ç›¸åï¼Œæœ¬æŒ‡å—ä¸ä¼šç›´æ¥æ·±å…¥æ¢è®¨ Spring-first ä¸»é¢˜ï¼Œä»è€Œè®©æ‚¨æ„Ÿåˆ°å›°æƒ‘ã€‚\nç›¸åï¼Œæ‚¨å°†ä»¥éå¸¸è§„çš„æ–¹å¼å­¦ä¹  Spring äº‹åŠ¡ç®¡ç†ï¼šä»å¤´å¼€å§‹ï¼Œä¸€æ­¥ä¸€æ­¥ã€‚è¿™æ„å‘³ç€ï¼Œä»æ™®é€šçš„è€å¼ JDBC äº‹åŠ¡ç®¡ç†å¼€å§‹ã€‚\nWhy? ä¸ºä»€ä¹ˆï¼Ÿ\nå› ä¸º Spring æ‰€åšçš„ä¸€åˆ‡éƒ½æ˜¯åŸºäºè¿™äº› JDBC åŸºç¡€çŸ¥è¯†ã€‚å¦‚æœæ‚¨æŒæ¡äº†è¿™äº›åŸºç¡€çŸ¥è¯†ï¼Œç¨åæ‚¨å°†å¯ä»¥ä½¿ç”¨ Spring çš„ @Transactional æ³¨é‡ŠèŠ‚çœå¤§é‡æ—¶é—´ã€‚\næ™®é€š JDBC äº‹åŠ¡ç®¡ç†çš„å·¥ä½œåŸç† å¦‚æœæ‚¨åœ¨ä¸å®Œå…¨äº†è§£ JDBC äº‹åŠ¡çš„æƒ…å†µä¸‹è€ƒè™‘è·³è¿‡æœ¬èŠ‚ï¼šè¯·ä¸è¦è¿™æ ·åšã€‚\nå¦‚ä½•å¯åŠ¨ã€æäº¤æˆ–å›æ»š JDBC äº‹åŠ¡ ç¬¬ä¸€ä¸ªé‡è¦çš„æ”¶è·æ˜¯ï¼šæ— è®ºæ‚¨ä½¿ç”¨ Spring çš„ @Transactional æ³¨é‡Šã€æ™®é€š Hibernateã€jOOQ è¿˜æ˜¯ä»»ä½•å…¶ä»–æ•°æ®åº“åº“ï¼Œéƒ½æ²¡æœ‰å…³ç³»ã€‚\næœ€åï¼Œå®ƒä»¬éƒ½æ‰§è¡Œç›¸åŒçš„æ“ä½œæ¥æ‰“å¼€å’Œå…³é—­ï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œç®¡ç†â€ï¼‰æ•°æ®åº“äº‹åŠ¡ã€‚æ™®é€šçš„ JDBC äº‹åŠ¡ç®¡ç†ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\nimport java.sql.Connection; Connection connection = dataSource.getConnection(); // (1) try (connection) { connection.setAutoCommit(false); // (2) // execute some SQL statements... connection.commit(); // (3) } catch (SQLException e) { connection.rollback(); // (4) } æ‚¨éœ€è¦è¿æ¥åˆ°æ•°æ®åº“æ‰èƒ½å¯åŠ¨äº‹åŠ¡ã€‚ DriverManager.getConnectionï¼ˆurlï¼Œuserï¼Œpasswordï¼‰ä¹Ÿå¯ä»¥å·¥ä½œï¼Œå°½ç®¡åœ¨å¤§å¤šæ•°ä¼ä¸šåº”ç”¨ç¨‹åºä¸­ï¼Œæ‚¨å°†é…ç½®ä¸€ä¸ªæ•°æ®æºå¹¶ä»ä¸­è·å–è¿æ¥ã€‚ è¿™æ˜¯åœ¨ Java ä¸­â€œå¯åŠ¨â€æ•°æ®åº“äº‹åŠ¡çš„å”¯ä¸€æ–¹æ³•ï¼Œå°½ç®¡è¿™ä¸ªåå­—å¬èµ·æ¥æœ‰ç‚¹ä¸å¯¹åŠ²ã€‚ setAutoCommit(true) ç¡®ä¿æ¯ä¸ª SQL è¯­å¥è‡ªåŠ¨åŒ…è£…åœ¨è‡ªå·±çš„äº‹åŠ¡ä¸­ï¼Œè€Œ setAutoCommit(false) åˆ™ç›¸åï¼šæ‚¨æ˜¯äº‹åŠ¡çš„ä¸»äººï¼Œæ‚¨éœ€è¦å¼€å§‹è°ƒç”¨ *commit* æ ‡å¿—åœ¨è¿æ¥æ‰“å¼€çš„æ•´ä¸ªæ—¶é—´å†…éƒ½æœ‰æ•ˆï¼Œè¿™æ„å‘³ç€æ‚¨åªéœ€è°ƒç”¨è¯¥æ–¹æ³•ä¸€æ¬¡ï¼Œè€Œä¸æ˜¯é‡å¤ã€‚ è®©æˆ‘ä»¬æäº¤æˆ‘ä»¬çš„äº¤æ˜“\u0026hellip;â€‹ æˆ–è€…ï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ï¼Œåˆ™å›æ»šæˆ‘ä»¬çš„æ›´æ”¹ã€‚ æ˜¯çš„ï¼Œè¿™ 4 è¡Œï¼ˆè¿‡äºç®€å•åŒ–çš„ï¼‰æ˜¯å½“ä½ ä½¿ç”¨ @Transactional æ³¨é‡Šæ—¶ Spring æ‰€åšçš„ä¸€åˆ‡ã€‚åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæ‚¨å°†äº†è§£å…¶å·¥ä½œåŸç†ã€‚ä½†åœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰ï¼Œæ‚¨è¿˜éœ€è¦å­¦ä¹ ä¸€äº›çŸ¥è¯†ã€‚\nï¼ˆèªæ˜äººçš„ä¸€ä¸ªå¿«é€Ÿè¯´æ˜ï¼šåƒ HikariCP è¿™æ ·çš„è¿æ¥æ± åº“å¯èƒ½ä¼šæ ¹æ®é…ç½®è‡ªåŠ¨ä¸ºæ‚¨åˆ‡æ¢è‡ªåŠ¨æäº¤æ¨¡å¼ã€‚ä½†è¿™æ˜¯ä¸€ä¸ªé«˜çº§ä¸»é¢˜ã€‚ï¼‰\nå¦‚ä½•ä½¿ç”¨ JDBC éš”ç¦»çº§åˆ«å’Œä¿å­˜ç‚¹ å¦‚æœæ‚¨å·²ç»ä½¿ç”¨è¿‡ Spring çš„ @Transactional æ³¨é‡Šï¼Œæ‚¨å¯èƒ½é‡åˆ°è¿‡ç±»ä¼¼çš„æƒ…å†µï¼š\n@Transactional(propagation=TransactionDefinition.NESTED, isolation=TransactionDefinition.ISOLATION_READ_UNCOMMITTED) ç¨åæˆ‘ä»¬å°†æ›´è¯¦ç»†åœ°ä»‹ç»åµŒå¥— Spring äº‹åŠ¡å’Œéš”ç¦»çº§åˆ«ï¼Œä½†å†æ¬¡äº†è§£è¿™äº›å‚æ•°éƒ½å¯ä»¥å½’ç»“ä¸ºä»¥ä¸‹åŸºæœ¬ JDBC ä»£ç ä¼šæœ‰æ‰€å¸®åŠ©ï¼š\nimport java.sql.Connection; // isolation=TransactionDefinition.ISOLATION_READ_UNCOMMITTED connection.setTransactionIsolation(Connection.TRANSACTION_READ_UNCOMMITTED); // (1) // propagation=TransactionDefinition.NESTED Savepoint savePoint = connection.setSavepoint(); // (2) ... connection.rollback(savePoint); è¿™å°±æ˜¯ Spring åœ¨æ•°æ®åº“è¿æ¥ä¸Šè®¾ç½®éš”ç¦»çº§åˆ«çš„æ–¹å¼ã€‚ä¸å®Œå…¨æ˜¯ç«ç®­ç§‘å­¦ï¼Œæ˜¯å—ï¼Ÿ Spring ä¸­çš„åµŒå¥—äº‹åŠ¡åªæ˜¯ JDBC/æ•°æ®åº“ä¿å­˜ç‚¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨ä¸çŸ¥é“ä»€ä¹ˆæ˜¯ä¿å­˜ç‚¹ï¼Œè¯·æŸ¥çœ‹æœ¬æ•™ç¨‹ã€‚è¯·æ³¨æ„ï¼Œä¿å­˜ç‚¹æ”¯æŒå–å†³äºæ‚¨çš„ JDBC é©±åŠ¨ç¨‹åº/æ•°æ®åº“ã€‚ Spring æˆ– Spring Boot çš„äº‹åŠ¡ç®¡ç†å¦‚ä½•å·¥ä½œ ç°åœ¨æ‚¨å·²ç»å¯¹ JDBC äº‹åŠ¡æœ‰äº†å¾ˆå¥½çš„äº†è§£ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ç®€å•çš„ã€æ ¸å¿ƒçš„ Spring æ˜¯å¦‚ä½•ç®¡ç†äº‹åŠ¡çš„ã€‚è¿™é‡Œçš„æ‰€æœ‰å†…å®¹éƒ½ä¸€ä¸€é€‚ç”¨äº Spring Boot å’Œ Spring MVCï¼Œç¨åä¼šè¯¦ç»†ä»‹ç»ã€‚\nSpring çš„äº‹åŠ¡ç®¡ç†æˆ–å…¶ï¼ˆåç§°ç›¸å½“ä»¤äººå›°æƒ‘çš„ï¼‰äº‹åŠ¡æŠ½è±¡æ¡†æ¶å®é™…ä¸Šæ˜¯ä»€ä¹ˆï¼Ÿ\nè¯·è®°ä½ï¼Œäº‹åŠ¡ç®¡ç†ç®€å•åœ°è¯´å°±æ˜¯ï¼šSpring å¦‚ä½•å¯åŠ¨ã€æäº¤æˆ–å›æ»š JDBC äº‹åŠ¡ï¼Ÿè¿™å¬èµ·æ¥æ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Ÿ\né—®é¢˜æ˜¯ï¼šä½¿ç”¨æ™®é€š JDBCï¼Œæ‚¨åªæœ‰ä¸€ç§æ–¹æ³• (setAutocommit(false)) æ¥ç®¡ç†äº‹åŠ¡ï¼Œè€Œ Spring ä¸ºæ‚¨æä¾›äº†è®¸å¤šä¸åŒçš„ã€æ›´æ–¹ä¾¿çš„æ–¹æ³•æ¥å®ç°ç›¸åŒçš„ç›®çš„ã€‚\nå¦‚ä½•ä½¿ç”¨ Spring çš„ç¨‹åºåŒ–äº‹åŠ¡ç®¡ç†ï¼Ÿ åœ¨ Spring ä¸­å®šä¹‰äº‹åŠ¡çš„ç¬¬ä¸€ç§ä½†å¾ˆå°‘ä½¿ç”¨çš„æ–¹æ³•æ˜¯é€šè¿‡ç¼–ç¨‹æ–¹å¼ï¼šé€šè¿‡ TransactionTemplate æˆ–ç›´æ¥é€šè¿‡ PlatformTransactionManagerã€‚ä»ä»£ç è§’åº¦æ¥çœ‹ï¼Œå®ƒçœ‹èµ·æ¥åƒè¿™æ ·ï¼š\n@Service public class UserService { @Autowired private TransactionTemplate template; public Long registerUser(User user) { Long id = template.execute(status -\u0026gt; { // execute some SQL that e.g. // inserts the user into the db and returns the autogenerated id return id; }); } } ä¸æ™®é€š JDBC ç¤ºä¾‹ç›¸æ¯”ï¼š\næ‚¨ä¸å¿…è‡ªå·±æä¹±æ‰“å¼€æˆ–å…³é—­æ•°æ®åº“è¿æ¥ï¼ˆtry-finallyï¼‰ã€‚ç›¸åï¼Œæ‚¨ä½¿ç”¨äº‹åŠ¡å›è°ƒã€‚ æ‚¨ä¹Ÿä¸å¿…æ•è· SQLExceptionï¼Œå› ä¸º Spring ä¼šä¸ºæ‚¨å°†è¿™äº›å¼‚å¸¸è½¬æ¢ä¸ºè¿è¡Œæ—¶å¼‚å¸¸ã€‚ å¹¶ä¸”æ‚¨å¯ä»¥æ›´å¥½åœ°èå…¥ Spring ç”Ÿæ€ç³»ç»Ÿã€‚ TransactionTemplate å°†åœ¨å†…éƒ¨ä½¿ç”¨ TransactionManagerï¼Œå®ƒå°†ä½¿ç”¨æ•°æ®æºã€‚æ‰€æœ‰è¿™äº›éƒ½æ˜¯æ‚¨å¿…é¡»åœ¨ Spring ä¸Šä¸‹æ–‡é…ç½®ä¸­æŒ‡å®šçš„ beanï¼Œä½†ä»¥åä¸å¿…å†æ‹…å¿ƒã€‚ è™½ç„¶è¿™ç®—æ˜¯ä¸€ä¸ªå°å°çš„æ”¹è¿›ï¼Œä½†ç¨‹åºåŒ–äº‹åŠ¡ç®¡ç†å¹¶ä¸æ˜¯ Spring äº‹åŠ¡æ¡†æ¶çš„ä¸»è¦åŠŸèƒ½ã€‚ç›¸åï¼Œè¿™éƒ½æ˜¯å…³äºå£°æ˜å¼äº‹åŠ¡ç®¡ç†çš„ã€‚è®©æˆ‘ä»¬çœ‹çœ‹é‚£æ˜¯ä»€ä¹ˆã€‚\nå¦‚ä½•ä½¿ç”¨ Spring çš„ XML å£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼Ÿ è¿‡å»ï¼Œå½“ XML é…ç½®æˆä¸º Spring é¡¹ç›®çš„æ ‡å‡†æ—¶ï¼Œæ‚¨å¯ä»¥ç›´æ¥åœ¨ XML ä¸­é…ç½®äº‹åŠ¡ã€‚é™¤äº†ä¸€äº›é—ç•™çš„ä¼ä¸šé¡¹ç›®ä¹‹å¤–ï¼Œæ‚¨å°†ä¸å†åœ¨é‡å¤–æ‰¾åˆ°è¿™ç§æ–¹æ³•ï¼Œå› ä¸ºå®ƒå·²è¢«æ›´ç®€å•çš„ @Transactional æ³¨é‡Šæ‰€å–ä»£ã€‚\næˆ‘ä»¬ä¸ä¼šåœ¨æœ¬æŒ‡å—ä¸­è¯¦ç»†ä»‹ç» XML é…ç½®ï¼Œä½†æ‚¨å¯ä»¥ä½¿ç”¨æ­¤ç¤ºä¾‹ä½œä¸ºæ·±å…¥ç ”ç©¶çš„èµ·ç‚¹ - å¦‚æœéœ€è¦çš„è¯ï¼ˆç›´æ¥å–è‡ª Spring å®˜æ–¹æ–‡æ¡£ï¼‰ï¼š\n\u0026lt;!-- the transactional advice (what \u0026#39;happens\u0026#39;; see the \u0026lt;aop:advisor/\u0026gt; bean below) --\u0026gt; \u0026lt;tx:advice id=\u0026#34;txAdvice\u0026#34; transaction-manager=\u0026#34;txManager\u0026#34;\u0026gt; \u0026lt;!-- the transactional semantics... --\u0026gt; \u0026lt;tx:attributes\u0026gt; \u0026lt;!-- all methods starting with \u0026#39;get\u0026#39; are read-only --\u0026gt; \u0026lt;tx:method name=\u0026#34;get*\u0026#34; read-only=\u0026#34;true\u0026#34;/\u0026gt; \u0026lt;!-- other methods use the default transaction settings (see below) --\u0026gt; \u0026lt;tx:method name=\u0026#34;*\u0026#34;/\u0026gt; \u0026lt;/tx:attributes\u0026gt; \u0026lt;/tx:advice\u0026gt; æ‚¨ä½¿ç”¨ä¸Šé¢çš„ XML å—æŒ‡å®š AOP å»ºè®®ï¼ˆé¢å‘æ–¹é¢ â€‹â€‹ çš„ç¼–ç¨‹ï¼‰ï¼Œç„¶åå¯ä»¥å°†å…¶åº”ç”¨åˆ° UserService beanï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\u0026lt;aop:config\u0026gt; \u0026lt;aop:pointcut id=\u0026#34;userServiceOperation\u0026#34; expression=\u0026#34;execution(* x.y.service.UserService.*(..))\u0026#34;/\u0026gt; \u0026lt;aop:advisor advice-ref=\u0026#34;txAdvice\u0026#34; pointcut-ref=\u0026#34;userServiceOperation\u0026#34;/\u0026gt; \u0026lt;/aop:config\u0026gt; \u0026lt;bean id=\u0026#34;userService\u0026#34; class=\u0026#34;x.y.service.UserService\u0026#34;/\u0026gt; æ‚¨çš„ UserService bean å°†å¦‚ä¸‹æ‰€ç¤ºï¼š\npublic class UserService { public Long registerUser(User user) { // execute some SQL that e.g. // inserts the user into the db and retrieves the autogenerated id return id; } } ä» Java ä»£ç çš„è§’åº¦æ¥çœ‹ï¼Œè¿™ç§å£°æ˜å¼äº‹åŠ¡æ–¹æ³•çœ‹èµ·æ¥æ¯”ç¼–ç¨‹æ–¹æ³•ç®€å•å¾—å¤šã€‚ä½†å®ƒä¼šå¯¼è‡´å¤§é‡å¤æ‚ã€å†—é•¿çš„ XMLï¼Œä»¥åŠåˆ‡å…¥ç‚¹å’Œé¡¾é—®ç¨‹åºé…ç½®ã€‚\nå› æ­¤ï¼Œè¿™å°±å¼•å‡ºäº†ä¸€ä¸ªé—®é¢˜ï¼šæ˜¯å¦æœ‰æ¯” XML æ›´å¥½çš„å£°æ˜å¼äº‹åŠ¡ç®¡ç†æ–¹æ³•ï¼Ÿæ˜¯çš„ï¼Œæœ‰ï¼š@Transactional æ³¨é‡Šã€‚\nå¦‚ä½•ä½¿ç”¨ Spring çš„@Transactional æ³¨è§£ï¼ˆå£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼‰ ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹ç°ä»£ Spring äº‹åŠ¡ç®¡ç†é€šå¸¸æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼š\npublic class UserService { @Transactional public Long registerUser(User user) { // execute some SQL that e.g. // inserts the user into the db and retrieves the autogenerated id // userDao.save(user); return id; } } è¿™æ€ä¹ˆå¯èƒ½ï¼Ÿä¸å†éœ€è¦ XML é…ç½®ï¼Œä¹Ÿä¸éœ€è¦å…¶ä»–ä»£ç ã€‚ç›¸åï¼Œæ‚¨ç°åœ¨éœ€è¦åšä¸¤ä»¶äº‹ï¼š\nç¡®ä¿æ‚¨çš„ Spring é…ç½®å¸¦æœ‰ @EnableTransactionManagement æ³¨é‡Šï¼ˆåœ¨ Spring Boot ä¸­ï¼Œè¿™å°†è‡ªåŠ¨ä¸ºæ‚¨å®Œæˆï¼‰ã€‚ ç¡®ä¿æ‚¨åœ¨ Spring é…ç½®ä¸­æŒ‡å®šäº†äº‹åŠ¡ç®¡ç†å™¨ï¼ˆæ— è®ºå¦‚ä½•æ‚¨éƒ½éœ€è¦è¿™æ ·åšï¼‰ã€‚ ç„¶å Spring è¶³å¤Ÿæ™ºèƒ½ï¼Œå¯ä»¥é€æ˜åœ°ä¸ºæ‚¨å¤„ç†äº‹åŠ¡ï¼šæ‚¨ç”¨ @Transactional æ³¨é‡Šæ³¨é‡Šçš„ä»»ä½• bean çš„å…¬å…±æ–¹æ³•éƒ½å°†åœ¨æ•°æ®åº“äº‹åŠ¡å†…æ‰§è¡Œï¼ˆæ³¨æ„ï¼šå­˜åœ¨ä¸€äº›é™·é˜±ï¼‰ã€‚ å› æ­¤ï¼Œè¦ä½¿ @Transactional æ³¨é‡Šæ­£å¸¸å·¥ä½œï¼Œæ‚¨éœ€è¦åšçš„å°±æ˜¯ï¼š\n@Configuration @EnableTransactionManagement public class MySpringConfig { @Bean public PlatformTransactionManager txManager() { return yourTxManager; // more on that later } } ç°åœ¨ï¼Œå½“æˆ‘è¯´ Spring é€æ˜åœ°ä¸ºæ‚¨å¤„ç†äº‹åŠ¡æ—¶ã€‚é‚£ä¸ªçš„çœŸå®æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ\nå€ŸåŠ© JDBC äº‹åŠ¡ç¤ºä¾‹ä¸­çš„çŸ¥è¯†ï¼Œä¸Šé¢çš„ @Transactional UserService ä»£ç å¯ä»¥ç›´æ¥è½¬æ¢ï¼ˆç®€åŒ–ï¼‰ä¸ºï¼š\npublic class UserService { public Long registerUser(User user) { Connection connection = dataSource.getConnection(); // (1) try (connection) { connection.setAutoCommit(false); // (1) // execute some SQL that e.g. // inserts the user into the db and retrieves the autogenerated id // userDao.save(user); \u0026lt;(2) connection.commit(); // (1) } catch (SQLException e) { connection.rollback(); // (1) } } } è¿™åªæ˜¯ JDBC è¿æ¥çš„æ ‡å‡†æ‰“å¼€å’Œå…³é—­ã€‚è¿™å°±æ˜¯ Spring çš„äº‹åŠ¡æ³¨é‡Šè‡ªåŠ¨ä¸ºæ‚¨åšçš„äº‹æƒ…ï¼Œè€Œæ— éœ€æ‚¨æ˜¾å¼åœ°ç¼–å†™å®ƒã€‚ è¿™æ˜¯æ‚¨è‡ªå·±çš„ä»£ç ï¼Œé€šè¿‡ DAO æˆ–ç±»ä¼¼çš„ä¸œè¥¿ä¿å­˜ç”¨æˆ·ã€‚ è¿™ä¸ªä¾‹å­å¯èƒ½çœ‹èµ·æ¥æœ‰ç‚¹ç¥å¥‡ï¼Œä½†æ˜¯è®©æˆ‘ä»¬çœ‹çœ‹ Spring å¦‚ä½•ä¸ºæ‚¨æ’å…¥è¿™ä¸ªè¿æ¥ä»£ç ã€‚\nCGlib å’Œ JDK ä»£ç† - @Transactional çš„å¹•åé»‘æ‰‹ Spring æ— æ³•çœŸæ­£é‡å†™æ‚¨çš„ Java ç±»ï¼Œå°±åƒæˆ‘ä¸Šé¢æ‰€åšçš„é‚£æ ·ï¼Œä»¥æ’å…¥è¿æ¥ä»£ç ï¼ˆé™¤éæ‚¨ä½¿ç”¨å­—èŠ‚ç ç¼–ç»‡ç­‰é«˜çº§æŠ€æœ¯ï¼Œä½†æˆ‘ä»¬ç°åœ¨å¿½ç•¥å®ƒï¼‰ã€‚\nä½ çš„ registerUser() æ–¹æ³•å®é™…ä¸Šåªæ˜¯è°ƒç”¨ userDao.save(user) ï¼Œæ²¡æœ‰åŠæ³•åŠ¨æ€æ”¹å˜å®ƒã€‚\nä½† Spring æœ‰ä¸€ä¸ªä¼˜åŠ¿ã€‚å®ƒçš„æ ¸å¿ƒæ˜¯ä¸€ä¸ª IoC å®¹å™¨ã€‚å®ƒä¸ºæ‚¨å®ä¾‹åŒ–ä¸€ä¸ª UserService å¹¶ç¡®ä¿å°†è¯¥ UserService è‡ªåŠ¨è£…é…åˆ°ä»»ä½•å…¶ä»–éœ€è¦ UserService çš„ bean ä¸­ã€‚\nç°åœ¨ï¼Œæ¯å½“æ‚¨åœ¨ bean ä¸Šä½¿ç”¨ @Transactional æ—¶ï¼ŒSpring éƒ½ä¼šä½¿ç”¨ä¸€ä¸ªå°æŠ€å·§ã€‚å®ƒä¸ä»…å®ä¾‹åŒ– UserServiceï¼Œè€Œä¸”è¿˜å®ä¾‹åŒ–è¯¥ UserService çš„äº‹åŠ¡ä»£ç†ã€‚\nå®ƒåœ¨ Cglib åº“çš„å¸®åŠ©ä¸‹é€šè¿‡ä¸€ç§ç§°ä¸ºä»£ç†é€šè¿‡å­ç±»åŒ–çš„æ–¹æ³•æ¥å®ç°è¿™ä¸€ç‚¹ã€‚è¿˜æœ‰å…¶ä»–æ„å»ºä»£ç†çš„æ–¹æ³•ï¼ˆä¾‹å¦‚åŠ¨æ€ JDK ä»£ç†ï¼‰ï¼Œä½†æˆ‘ä»¬æš‚æ—¶å°±è¿™æ ·å§ã€‚\nè®©æˆ‘ä»¬çœ‹çœ‹è¿™å¼ å›¾ä¸­ä»£ç†çš„ä½œç”¨ï¼š\nä»è¯¥å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œä»£ç†æœ‰ä¸€é¡¹å·¥ä½œã€‚\næ‰“å¼€å’Œå…³é—­æ•°æ®åº“è¿æ¥/äº‹åŠ¡ã€‚ ç„¶åå§”æ‰˜ç»™çœŸæ­£çš„ UserServiceï¼Œå³æ‚¨ç¼–å†™çš„é‚£ä¸ªã€‚ è€Œå…¶ä»– beanï¼Œä¾‹å¦‚ UserRestControllerï¼Œæ°¸è¿œä¸ä¼šçŸ¥é“å®ƒä»¬æ­£åœ¨ä¸ä»£ç†é€šä¿¡ï¼Œè€Œä¸æ˜¯ä¸çœŸå®çš„äº‹ç‰©é€šä¿¡ã€‚ å¿«é€Ÿè€ƒè¯•\nçœ‹ä¸€ä¸‹ä¸‹é¢çš„æºä»£ç ï¼Œå‘Šè¯‰æˆ‘ Spring è‡ªåŠ¨æ„é€ ä»€ä¹ˆç±»å‹çš„ UserServiceï¼Œå‡è®¾å®ƒå¸¦æœ‰ @Transactional æ ‡è®°æˆ–å…·æœ‰ @Transactional æ–¹æ³•ã€‚\n@Configuration @EnableTransactionManagement public static class MyAppConfig { @Bean public UserService userService() { // (1) return new UserService(); } } æ­£ç¡®çš„ã€‚ Spring åœ¨è¿™é‡Œä¸ºæ‚¨çš„ UserService ç±»æ„é€ ä¸€ä¸ªåŠ¨æ€ CGLib ä»£ç†ï¼Œå®ƒå¯ä»¥ä¸ºæ‚¨æ‰“å¼€å’Œå…³é—­æ•°æ®åº“äº‹åŠ¡ã€‚æ‚¨æˆ–ä»»ä½•å…¶ä»– bean ç”šè‡³ä¸ä¼šæ³¨æ„åˆ°å®ƒä¸æ˜¯æ‚¨çš„ UserServiceï¼Œè€Œæ˜¯åŒ…è£…æ‚¨çš„ UserService çš„ä»£ç†ã€‚ ä¸ºä»€ä¹ˆéœ€è¦äº‹åŠ¡ç®¡ç†å™¨ï¼ˆå¦‚ PlatformTransactionManagerï¼‰ï¼Ÿ ç°åœ¨åªç¼ºå°‘ä¸€æ¡å…³é”®ä¿¡æ¯ï¼Œå°½ç®¡æˆ‘ä»¬å·²ç»æåˆ°è¿‡å‡ æ¬¡äº†ã€‚\næ‚¨çš„ UserService ä¼šåŠ¨æ€è¢«ä»£ç†ï¼Œå¹¶ä¸”ä»£ç†ä¼šä¸ºæ‚¨ç®¡ç†äº‹åŠ¡ã€‚ä½†å¤„ç†æ‰€æœ‰äº‹åŠ¡çŠ¶æ€ï¼ˆæ‰“å¼€ã€æäº¤ã€å…³é—­ï¼‰çš„ä¸æ˜¯ä»£ç†æœ¬èº«ï¼Œè€Œæ˜¯ä»£ç†å§”æ‰˜ç»™äº‹åŠ¡ç®¡ç†å™¨ã€‚\nSpring ä¸ºæ‚¨æä¾›äº† PlatformTransactionManager / TransactionManager æ¥å£ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒé™„å¸¦äº†ä¸€äº›æ–¹ä¾¿çš„å®ç°ã€‚å…¶ä¸­ä¹‹ä¸€æ˜¯æ•°æ®æºäº‹åŠ¡ç®¡ç†å™¨ã€‚\nå®ƒæ‰€åšçš„æ­£æ˜¯æ‚¨è¿„ä»Šä¸ºæ­¢æ‰€åšçš„ç®¡ç†äº‹åŠ¡çš„æ“ä½œï¼Œä½†é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æ‰€éœ€çš„ Spring é…ç½®ï¼š\n@Bean public DataSource dataSource() { return new MysqlDataSource(); // (1) } @Bean public PlatformTransactionManager txManager() { return new DataSourceTransactionManager(dataSource()); // (2) } æ‚¨å¯ä»¥åœ¨æ­¤å¤„åˆ›å»ºç‰¹å®šäºæ•°æ®åº“æˆ–ç‰¹å®šäºè¿æ¥æ± çš„æ•°æ®æºã€‚æœ¬ç¤ºä¾‹ä½¿ç”¨ MySQLã€‚ åœ¨è¿™é‡Œï¼Œæ‚¨åˆ›å»ºäº‹åŠ¡ç®¡ç†å™¨ï¼Œå®ƒéœ€è¦ä¸€ä¸ªæ•°æ®æºæ‰èƒ½ç®¡ç†äº‹åŠ¡ã€‚ ç®€å•å¦‚ã€‚ç„¶åï¼Œæ‰€æœ‰äº‹åŠ¡ç®¡ç†å™¨éƒ½æœ‰åƒâ€œdoBeginâ€ï¼ˆç”¨äºå¯åŠ¨äº‹åŠ¡ï¼‰æˆ–â€œdoCommitâ€è¿™æ ·çš„æ–¹æ³•ï¼Œå®ƒä»¬çœ‹èµ·æ¥åƒè¿™æ ·â€”â€”ç›´æ¥å–è‡ª Spring çš„æºä»£ç å¹¶è¿›è¡Œäº†ä¸€äº›ç®€åŒ–ï¼š\npublic class DataSourceTransactionManager implements PlatformTransactionManager { @Override protected void doBegin(Object transaction, TransactionDefinition definition) { Connection newCon = obtainDataSource().getConnection(); // ... con.setAutoCommit(false); // yes, that\u0026#39;s it! } @Override protected void doCommit(DefaultTransactionStatus status) { // ... Connection connection = status.getTransaction().getConnectionHolder().getConnection(); try { con.commit(); } catch (SQLException ex) { throw new TransactionSystemException(\u0026#34;Could not commit JDBC transaction\u0026#34;, ex); } } } å› æ­¤ï¼Œæ•°æ®æºäº‹åŠ¡ç®¡ç†å™¨åœ¨ç®¡ç†äº‹åŠ¡æ—¶ä½¿ç”¨ä¸æ‚¨åœ¨ JDBC éƒ¨åˆ†ä¸­çœ‹åˆ°çš„å®Œå…¨ç›¸åŒçš„ä»£ç ã€‚\nè€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬ä»ä¸Šé¢æ‰©å±•æˆ‘ä»¬çš„å›¾ç‰‡ï¼š\næ€»ç»“ä¸€ä¸‹ï¼š\nå¦‚æœ Spring æ£€æµ‹åˆ° bean ä¸Šçš„ @Transactional æ³¨é‡Šï¼Œå®ƒä¼šåˆ›å»ºè¯¥ bean çš„åŠ¨æ€ä»£ç†ã€‚ ä»£ç†å¯ä»¥è®¿é—®äº‹åŠ¡ç®¡ç†å™¨ï¼Œå¹¶è¦æ±‚å®ƒæ‰“å¼€å’Œå…³é—­äº‹åŠ¡/è¿æ¥ã€‚ äº‹åŠ¡ç®¡ç†å™¨æœ¬èº«å°†ç®€å•åœ°æ‰§è¡Œæ‚¨åœ¨æ™®é€š Java éƒ¨åˆ†ä¸­æ‰€åšçš„æ“ä½œï¼šç®¡ç†è‰¯å¥½çš„æ—§ JDBC è¿æ¥ã€‚ ç‰©ç†äº‹åŠ¡å’Œé€»è¾‘äº‹åŠ¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ æƒ³è±¡ä¸€ä¸‹ä»¥ä¸‹ä¸¤ä¸ªäº‹åŠ¡ç±»ã€‚\n@Service public class UserService { @Autowired private InvoiceService invoiceService; @Transactional public void invoice() { invoiceService.createPdf(); // send invoice as email, etc. } } @Service public class InvoiceService { @Transactional public void createPdf() { // ... } } UserService æœ‰ä¸€ä¸ªäº‹åŠ¡æ€§ Invoice() æ–¹æ³•ã€‚å®ƒè°ƒç”¨ InvoiceService ä¸Šçš„å¦ä¸€ä¸ªäº‹åŠ¡æ–¹æ³• createPdf()ã€‚\nç°åœ¨å°±æ•°æ®åº“äº‹åŠ¡è€Œè¨€ï¼Œè¿™å®é™…ä¸Šåº”è¯¥åªæ˜¯ä¸€ä¸ªæ•°æ®åº“äº‹åŠ¡ã€‚ ï¼ˆè®°ä½ï¼šgetConnection().setAutocommit(false).commit()ã€‚ï¼‰Spring è°ƒç”¨æ­¤ç‰©ç†äº‹åŠ¡ï¼Œå°½ç®¡ä¸€å¼€å§‹è¿™å¬èµ·æ¥æœ‰ç‚¹ä»¤äººå›°æƒ‘ã€‚\nç„¶è€Œï¼Œä» Spring çš„è§’åº¦æ¥çœ‹ï¼Œå‘ç”Ÿäº†ä¸¤ä¸ªé€»è¾‘äº‹åŠ¡ï¼šç¬¬ä¸€ä¸ªåœ¨ UserService ä¸­ï¼Œå¦ä¸€ä¸ªåœ¨ InvoiceService ä¸­ã€‚ Spring å¿…é¡»è¶³å¤Ÿèªæ˜ï¼ŒçŸ¥é“è¿™ä¸¤ä¸ª @Transactional æ–¹æ³•åº”è¯¥ä½¿ç”¨ç›¸åŒçš„åº•å±‚ç‰©ç†æ•°æ®åº“äº‹åŠ¡ã€‚\nå¦‚æœå¯¹ InvoiceService è¿›è¡Œä»¥ä¸‹æ›´æ”¹ï¼Œæƒ…å†µä¼šæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ\n@Service public class InvoiceService { @Transactional(propagation = Propagation.REQUIRES_NEW) public void createPdf() { // ... } } å°†ä¼ æ’­æ¨¡å¼æ›´æ”¹ä¸º require_new æ˜¯å‘Šè¯‰ Spring createPDF() éœ€è¦åœ¨è‡ªå·±çš„äº‹åŠ¡ä¸­æ‰§è¡Œï¼Œç‹¬ç«‹äºä»»ä½•å…¶ä»–å·²å­˜åœ¨çš„äº‹åŠ¡ã€‚å›æƒ³ä¸€ä¸‹æœ¬æŒ‡å—çš„çº¯ Java éƒ¨åˆ†ï¼Œæ‚¨æ˜¯å¦çœ‹åˆ°äº†å°†äº‹åŠ¡â€œæ‹†åˆ†â€ä¸ºä¸¤åŠçš„æ–¹æ³•ï¼Ÿæˆ‘ä¹Ÿä¸ã€‚\nè¿™åŸºæœ¬ä¸Šæ„å‘³ç€æ‚¨çš„ä»£ç å°†æ‰“å¼€ä¸¤ä¸ªåˆ°æ•°æ®åº“çš„ï¼ˆç‰©ç†ï¼‰è¿æ¥/äº‹åŠ¡ã€‚ ï¼ˆå†æ¬¡ï¼šgetConnection() x2.setAutocommit(false) x2.commit() x2ï¼‰Spring ç°åœ¨å¿…é¡»è¶³å¤Ÿæ™ºèƒ½ï¼Œä¸¤ä¸ªé€»è¾‘äº‹åŠ¡éƒ¨åˆ† (invoice()/createPdf()) ç°åœ¨ä¹Ÿæ˜ å°„åˆ°ä¸¤ä¸ªä¸åŒçš„ç‰©ç†æ•°æ®åº“äº¤æ˜“ã€‚\næ‰€ä»¥ï¼Œæ€»ç»“ä¸€ä¸‹ï¼š\nç‰©ç†äº‹åŠ¡ï¼šæ˜¯æ‚¨å®é™…çš„ JDBC äº‹åŠ¡ã€‚ é€»è¾‘äº‹åŠ¡ï¼šæ˜¯ï¼ˆå¯èƒ½åµŒå¥—çš„ï¼‰@Transactional æ³¨è§£çš„ï¼ˆSpringï¼‰æ–¹æ³•ã€‚ è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿæ›´è¯¦ç»†åœ°ä»‹ç»ä¼ æ’­æ¨¡å¼ã€‚\n@Transactional ä¼ æ’­çº§åˆ«çš„ç”¨é€”æ˜¯ä»€ä¹ˆï¼Ÿ æŸ¥çœ‹ Spring æºä»£ç æ—¶ï¼Œæ‚¨ä¼šå‘ç°å¯ä»¥æ’å…¥ @Transactional æ–¹æ³•çš„å„ç§ä¼ æ’­çº§åˆ«æˆ–æ¨¡å¼ã€‚\n@Transactional(propagation = Propagation.REQUIRED) // or @Transactional(propagation = Propagation.REQUIRES_NEW) // etc å®Œæ•´åˆ—è¡¨ï¼š\nREQUIRED å¿…éœ€çš„ SUPPORTS æ”¯æŒ MANDATORY å¼ºåˆ¶çš„ REQUIRES_NEW REQUIRES_NEW NOT_SUPPORTED ä¸æ”¯æŒ NEVER ç»ä¸ NESTED åµŒå¥— ç»ƒä¹ ï¼š\nåœ¨æ™®é€š Java éƒ¨åˆ†ä¸­ï¼Œæˆ‘å‘æ‚¨å±•ç¤ºäº† JDBC åœ¨äº‹åŠ¡æ–¹é¢å¯ä»¥æ‰§è¡Œçš„æ‰€æœ‰æ“ä½œã€‚èŠ±ç‚¹æ—¶é—´æ€è€ƒä¸€ä¸‹æ¯ä¸ª Spring ä¼ æ’­æ¨¡å¼æœ€ç»ˆå¯¹æ‚¨çš„æ•°æ®æºï¼ˆæˆ–è€…æ›´ç¡®åˆ‡åœ°è¯´ï¼Œæ‚¨çš„ JDBC è¿æ¥ï¼‰åˆ°åº•åšäº†ä»€ä¹ˆã€‚\né‚£å°±çœ‹çœ‹ä¸‹é¢çš„å›ç­”å§ã€‚\nç­”æ¡ˆï¼š\nRequired (default)ï¼šæˆ‘çš„æ–¹æ³•éœ€è¦ä¸€ä¸ªäº‹åŠ¡ï¼Œè¦ä¹ˆä¸ºæˆ‘æ‰“å¼€ä¸€ä¸ªäº‹åŠ¡ï¼Œè¦ä¹ˆä½¿ç”¨ç°æœ‰çš„äº‹åŠ¡ â†’ getConnection()ã€‚è®¾ç½®è‡ªåŠ¨æäº¤ï¼ˆå‡ï¼‰ã€‚çŠ¯ç½ªï¼ˆï¼‰ã€‚ Supportsï¼šæˆ‘å¹¶ä¸å…³å¿ƒäº‹åŠ¡æ˜¯å¦æ‰“å¼€ï¼Œæˆ‘å¯ä»¥ä»¥ä»»ä½•ä¸€ç§æ–¹å¼å·¥ä½œ â†’ ä¸ JDBC æ— å…³ Mandatoryï¼šæˆ‘è‡ªå·±ä¸ä¼šæ‰“å¼€ä¸€ä¸ªäº‹åŠ¡ï¼Œä½†æ˜¯å¦‚æœæ²¡æœ‰äººæ‰“å¼€ä¸€ä¸ªäº‹åŠ¡æˆ‘ä¼šå“­ â†’ ä¸ JDBC æ— å…³ Require_newï¼šæˆ‘æƒ³è¦å®Œå…¨è‡ªå·±çš„äº‹åŠ¡ â†’ getConnection()ã€‚è®¾ç½®è‡ªåŠ¨æäº¤ï¼ˆå‡ï¼‰ã€‚çŠ¯ç½ªï¼ˆï¼‰ã€‚ Not_Supportedï¼šæˆ‘çœŸçš„ä¸å–œæ¬¢äº‹åŠ¡ï¼Œæˆ‘ä»€è‡³ä¼šå°è¯•æŒ‚èµ·å½“å‰æ­£åœ¨è¿è¡Œçš„äº‹åŠ¡ â†’ ä¸ JDBC æ— å…³ **Neverï¼š**å¦‚æœå…¶ä»–äººå¯åŠ¨äº‹åŠ¡æˆ‘ä¼šå“­ â†’ ä¸ JDBC æ— å…³ Nestedï¼š å¬èµ·æ¥å¾ˆå¤æ‚ï¼Œä½†æˆ‘ä»¬åªæ˜¯åœ¨è°ˆè®ºä¿å­˜ç‚¹ï¼ â†’ è¿æ¥.setSavepoint() æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œå¤§å¤šæ•°ä¼ æ’­æ¨¡å¼å®é™…ä¸Šä¸æ•°æ®åº“æˆ– JDBC æ— å…³ï¼Œè€Œæ›´å¤šåœ°ä¸æ‚¨å¦‚ä½•ä½¿ç”¨ Spring æ„å»ºç¨‹åºä»¥åŠ Spring æœŸæœ›äº‹åŠ¡å‡ºç°çš„æ–¹å¼/æ—¶é—´/åœ°ç‚¹æœ‰å…³ã€‚\nçœ‹è¿™ä¸ªä¾‹å­ï¼š\npublic class UserService { @Transactional(propagation = Propagation.MANDATORY) public void myMethod() { // execute some sql } } åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯å½“æ‚¨è°ƒç”¨ UserService ç±»çš„ myMethod() æ—¶ï¼ŒSpring éƒ½ä¼šæœŸæœ›æ‰“å¼€ä¸€ä¸ªäº‹åŠ¡ã€‚å®ƒæœ¬èº«ä¸ä¼šæ‰“å¼€ä¸€ä¸ªæ–¹æ³•ï¼Œç›¸åï¼Œå¦‚æœæ‚¨åœ¨æ²¡æœ‰é¢„å…ˆå­˜åœ¨çš„äº‹åŠ¡çš„æƒ…å†µä¸‹è°ƒç”¨è¯¥æ–¹æ³•ï¼ŒSpring å°†æŠ›å‡ºå¼‚å¸¸ã€‚è¯·è®°ä½è¿™ä¸€ç‚¹ï¼Œä½œä¸ºâ€œé€»è¾‘äº‹åŠ¡å¤„ç†â€çš„é™„åŠ ç‚¹ã€‚\n@Transactional éš”ç¦»çº§åˆ«æœ‰ä»€ä¹ˆç”¨ï¼Ÿ æ­¤æ—¶è¿™å‡ ä¹æ˜¯ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼Œä½†æ˜¯å½“æ‚¨åƒè¿™æ ·é…ç½® @Transactional æ³¨é‡Šæ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ\n@Transactional(isolation = Isolation.REPEATABLE_READ) æ˜¯çš„ï¼Œå®ƒç¡®å®ä¼šå¯¼è‡´è¿™æ ·çš„ç»“æœï¼š\nconnection.setTransactionIsolation(Connection.TRANSACTION_REPEATABLE_READ); ç„¶è€Œï¼Œæ•°æ®åº“éš”ç¦»çº§åˆ«æ˜¯ä¸€ä¸ªå¤æ‚çš„ä¸»é¢˜ï¼Œæ‚¨åº”è¯¥èŠ±ä¸€äº›æ—¶é—´æ¥å®Œå…¨æŒæ¡å®ƒä»¬ã€‚ä¸€ä¸ªå¥½çš„å¼€å§‹æ˜¯ Postgres å®˜æ–¹æ–‡æ¡£åŠå…¶æœ‰å…³éš”ç¦»çº§åˆ«çš„éƒ¨åˆ†ã€‚\nå¦è¯·æ³¨æ„ï¼Œåœ¨äº‹åŠ¡æœŸé—´åˆ‡æ¢éš”ç¦»çº§åˆ«æ—¶ï¼Œæ‚¨å¿…é¡»ç¡®ä¿å’¨è¯¢ JDBC é©±åŠ¨ç¨‹åº/æ•°æ®åº“ä»¥äº†è§£æ”¯æŒå“ªäº›åœºæ™¯ï¼Œå“ªäº›ä¸æ”¯æŒã€‚\næœ€å¸¸è§çš„@Transactional é™·é˜± Spring åˆå­¦è€…é€šå¸¸ä¼šé‡åˆ°ä¸€ä¸ªé™·é˜±ã€‚çœ‹ä¸€ä¸‹ä¸‹é¢çš„ä»£ç ï¼š\n@Service public class UserService { @Transactional public void invoice() { createPdf(); // send invoice as email, etc. } @Transactional(propagation = Propagation.REQUIRES_NEW) public void createPdf() { // ... } } æ‚¨æœ‰ä¸€ä¸ªå¸¦æœ‰äº‹åŠ¡å‘ç¥¨æ–¹æ³•çš„ UserService ç±»ã€‚å®ƒè°ƒç”¨ createPDF()ï¼Œè¿™ä¹Ÿæ˜¯äº‹åŠ¡æ€§çš„ã€‚\nä¸€æ—¦æœ‰äººè°ƒç”¨ invoice()ï¼Œæ‚¨æœŸæœ›æ‰“å¼€å¤šå°‘å®é™…äº¤æ˜“ï¼Ÿ\nä¸ï¼Œç­”æ¡ˆä¸æ˜¯ä¸¤ä¸ªï¼Œè€Œæ˜¯ä¸€ä¸ªã€‚ä¸ºä»€ä¹ˆï¼Ÿ\nè®©æˆ‘ä»¬å›åˆ°æœ¬æŒ‡å—çš„ä»£ç†éƒ¨åˆ†ã€‚ Spring ä¸ºæ‚¨åˆ›å»ºäº‹åŠ¡æ€§ UserService ä»£ç†ï¼Œä½†æ˜¯ä¸€æ—¦æ‚¨è¿›å…¥ UserService ç±»å¹¶è°ƒç”¨å…¶ä»–å†…éƒ¨æ–¹æ³•ï¼Œå°±ä¸å†æ¶‰åŠä»£ç†ã€‚è¿™æ„å‘³ç€ï¼Œæ‚¨æ²¡æœ‰æ–°çš„äº¤æ˜“ã€‚\næˆ‘ä»¬ç”¨ä¸€å¼ å›¾æ¥çœ‹çœ‹ï¼š\næ‚¨å¯ä»¥ä½¿ç”¨ä¸€äº›æŠ€å·§ï¼ˆä¾‹å¦‚è‡ªæ³¨å…¥ï¼‰æ¥ç»•è¿‡æ­¤é™åˆ¶ã€‚ä½†ä¸»è¦çš„è¦ç‚¹æ˜¯ï¼šå§‹ç»ˆç‰¢è®°ä»£ç†äº‹åŠ¡è¾¹ç•Œã€‚\nå¦‚ä½•åœ¨ Spring Boot æˆ– Spring MVC ä¸­ä½¿ç”¨ @Transactional åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªè®¨è®ºäº†ç®€å•çš„ã€æ ¸å¿ƒçš„ Springã€‚ä½†æ˜¯ Spring Boot å‘¢ï¼Ÿè¿˜æ˜¯ Spring Web MVCï¼Ÿä»–ä»¬å¤„ç†äº¤æ˜“çš„æ–¹å¼æœ‰ä»€ä¹ˆä¸åŒå—ï¼Ÿ\næœ€ç®€æ´çš„ç­”æ¡ˆæ˜¯ä¸ã€‚\nå¯¹äºä»»ä¸€æ¡†æ¶ï¼ˆæˆ–è€…æ›´ç¡®åˆ‡åœ°è¯´ï¼šSpring ç”Ÿæ€ç³»ç»Ÿä¸­çš„æ‰€æœ‰æ¡†æ¶ï¼‰ï¼Œæ‚¨å°†å§‹ç»ˆä½¿ç”¨ *@Transactional* æ³¨é‡Šï¼Œå¹¶ç»“åˆäº‹åŠ¡ç®¡ç†å™¨å’Œ @EnableTransactionManagement æ³¨é‡Šã€‚æ²¡æœ‰å…¶ä»–åŠæ³•ã€‚\nç„¶è€Œï¼Œä¸ Spring Boot çš„å”¯ä¸€åŒºåˆ«æ˜¯ï¼Œå®ƒä½¿ç”¨ JDBC è‡ªåŠ¨é…ç½®è‡ªåŠ¨è®¾ç½® *@EnableTransactionManagement* æ³¨é‡Šå¹¶ä¸ºæ‚¨åˆ›å»º *PlatformTransactionManager* ã€‚åœ¨æ­¤å¤„äº†è§£æœ‰å…³è‡ªåŠ¨é…ç½®çš„æ›´å¤šä¿¡æ¯ã€‚\nSpring å¦‚ä½•å¤„ç†å›æ»šï¼ˆä»¥åŠé»˜è®¤å›æ»šç­–ç•¥ï¼‰ æœ‰å…³ Spring å›æ»šçš„éƒ¨åˆ†å°†åœ¨æœ¬æŒ‡å—çš„ä¸‹ä¸€ç‰ˆæœ¬ä¸­å¤„ç†ã€‚\nSpring å’Œ JPA/Hibernate äº‹åŠ¡ç®¡ç†å¦‚ä½•å·¥ä½œ ç›®æ ‡ï¼šåŒæ­¥ Spring çš„ @Transactional å’Œ Hibernate / JPA åœ¨æŸäº›æ—¶å€™ï¼Œæ‚¨ä¼šå¸Œæœ› Spring åº”ç”¨ç¨‹åºä¸å¦ä¸€ä¸ªæ•°æ®åº“åº“é›†æˆï¼Œä¾‹å¦‚ Hibernateï¼ˆä¸€ç§æµè¡Œçš„ JPA å®ç°ï¼‰æˆ– Jooq ç­‰ã€‚\nè®©æˆ‘ä»¬ä»¥æ™®é€š Hibernate ä¸ºä¾‹ï¼ˆæ³¨æ„ï¼šç›´æ¥ä½¿ç”¨ Hibernateï¼Œæˆ–è€…é€šè¿‡ JPA ä½¿ç”¨ Hibernate å¹¶ä¸é‡è¦ï¼‰ã€‚\nå°†ä¹‹å‰çš„ UserService é‡å†™ä¸º Hibernate å¦‚ä¸‹æ‰€ç¤ºï¼š\npublic class UserService { @Autowired private SessionFactory sessionFactory; // (1) public void registerUser(User user) { Session session = sessionFactory.openSession(); // (2) // lets open up a transaction. remember setAutocommit(false)! session.beginTransaction(); // save == insert our objects session.save(user); // and commit it session.getTransaction().commit(); // close the session == our jdbc connection session.close(); } } è¿™æ˜¯ä¸€ä¸ªæ™®é€šçš„ã€æ—§çš„ Hibernate SessionFactoryï¼Œæ˜¯æ‰€æœ‰ Hibernate æŸ¥è¯¢çš„å…¥å£ç‚¹ã€‚ ä½¿ç”¨ Hibernate API æ‰‹åŠ¨ç®¡ç†ä¼šè¯ï¼ˆå³ï¼šæ•°æ®åº“è¿æ¥ï¼‰å’Œäº‹åŠ¡ã€‚ ç„¶è€Œï¼Œä¸Šé¢çš„ä»£ç æœ‰ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼š\nHibernate ä¸ä¼šçŸ¥é“ Spring çš„ @Transactional æ³¨é‡Šã€‚ Spring çš„ @Transactional å¯¹ Hibernate çš„äº‹åŠ¡ä¸€æ— æ‰€çŸ¥ã€‚ ä½†æˆ‘ä»¬å®é™…ä¸Šå¸Œæœ› Spring å’Œ Hibernate èƒ½å¤Ÿæ— ç¼é›†æˆï¼Œè¿™æ„å‘³ç€å®ƒä»¬äº†è§£å½¼æ­¤çš„äº‹åŠ¡ã€‚\nç”¨çº¯ä»£ç è¡¨ç¤ºï¼š\n@Service public class UserService { @Autowired private SessionFactory sessionFactory; // (1) @Transactional public void registerUser(User user) { sessionFactory.getCurrentSession().save(user); // (2) } } ä¸ä¹‹å‰ç›¸åŒçš„ SessionFactory ä½†ä¸å†éœ€è¦æ‰‹åŠ¨çŠ¶æ€ç®¡ç†ã€‚ç›¸åï¼Œ getCurrentSession() å’Œ @Transactional æ˜¯åŒæ­¥çš„ã€‚ åˆ°é‚£é‡Œæ€ä¹ˆèµ°ï¼Ÿ\nä½¿ç”¨ HibernateTransactionManager å¯¹äºè¿™ä¸ªé›†æˆé—®é¢˜æœ‰ä¸€ä¸ªéå¸¸ç®€å•çš„è§£å†³æ–¹æ³•ï¼š\næ‚¨å°†ä½¿ç”¨ HibernateTransactionManagerï¼ˆå¦‚æœä½¿ç”¨æ™®é€š Hibernateï¼‰æˆ– JpaTransactionManagerï¼ˆå¦‚æœé€šè¿‡ JPA ä½¿ç”¨ Hibernateï¼‰ï¼Œè€Œä¸æ˜¯åœ¨ Spring é…ç½®ä¸­ä½¿ç”¨ DataSourcePlatformTransactionManagerã€‚\nä¸“é—¨çš„ HibernateTransactionManager å°†ç¡®ä¿ï¼š\né€šè¿‡ Hibernateï¼ˆå³ SessionFactoryï¼‰ç®¡ç†äº‹åŠ¡ã€‚ è¶³å¤Ÿèªæ˜ï¼Œå…è®¸ Spring åœ¨é Hibernate ä¸­ä½¿ç”¨ç›¸åŒçš„äº‹åŠ¡ï¼Œå³ @Transactional Spring ä»£ç ã€‚ ä¸å¾€å¸¸ä¸€æ ·ï¼Œå›¾ç‰‡å¯èƒ½æ›´å®¹æ˜“ç†è§£ï¼ˆä½†è¯·æ³¨æ„ï¼Œä»£ç†å’Œå®é™…æœåŠ¡ä¹‹é—´çš„æµç¨‹ä»…åœ¨æ¦‚å¿µä¸Šæ­£ç¡®ä¸”è¿‡äºç®€å•ï¼‰ã€‚\nç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯å¦‚ä½•é›†æˆ Spring å’Œ Hibernateã€‚\nå¯¹äºå…¶ä»–é›†æˆæˆ–æ›´æ·±å…¥çš„ç†è§£ï¼Œå¿«é€ŸæŸ¥çœ‹ Spring æä¾›çš„æ‰€æœ‰å¯èƒ½çš„ PlatformTransactionManager å®ç°ä¼šæœ‰æ‰€å¸®åŠ©ã€‚\nFin åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ‚¨åº”è¯¥å¯¹äº‹åŠ¡ç®¡ç†å¦‚ä½•ä¸ Spring æ¡†æ¶é…åˆä½¿ç”¨ä»¥åŠå®ƒå¦‚ä½•åº”ç”¨äºå…¶ä»– Spring åº“ï¼ˆå¦‚ Spring Boot æˆ– Spring WebMVCï¼‰æœ‰ä¸€ä¸ªå¾ˆå¥½çš„æ¦‚è¿°ã€‚æœ€å¤§çš„æ”¶è·åº”è¯¥æ˜¯ï¼Œæœ€ç»ˆä½¿ç”¨å“ªä¸ªæ¡†æ¶å¹¶ä¸é‡è¦ï¼Œè¿™éƒ½ä¸ JDBC åŸºç¡€çŸ¥è¯†æœ‰å…³ã€‚\nå¦‚æœå®ƒä»¬æ­£ç¡®ï¼ˆè®°ä½ï¼šgetConnection().setAutocommit(false).commit().ï¼‰ï¼Œæ‚¨å°†æ›´å®¹æ˜“ç†è§£ç¨ååœ¨å¤æ‚çš„ä¼ä¸šåº”ç”¨ç¨‹åºä¸­å‘ç”Ÿçš„æƒ…å†µã€‚\nè°¢è°¢é˜…è¯»ã€‚\nè‡´è°¢ æ„Ÿè°¢ Andreas Eisele å¯¹æœ¬æŒ‡å—æ—©æœŸç‰ˆæœ¬çš„åé¦ˆã€‚æ„Ÿè°¢ Ben Horsfield æä¾›äº†æ€¥éœ€çš„ Javascript ç‰‡æ®µæ¥å¢å¼ºæœ¬æŒ‡å—ã€‚\nåŸæ–‡é“¾æ¥ï¼šhttps://www.marcobehler.com/guides/spring-transaction-management-transactional-in-depth\n","permalink":"https://blog.chensoul.cc/posts/2023/08/16/spring-transaction-management-transactional-in-depth/","summary":"æ‚¨å¯ä»¥ä½¿ç”¨æœ¬æŒ‡å—æ¥ç®€å•å®ç”¨åœ°äº†è§£ Spring ä½¿ç”¨ @Transactional æ³¨é‡Šè¿›è¡Œäº‹åŠ¡ç®¡ç†çš„å·¥ä½œåŸç†ã€‚\nå”¯ä¸€çš„å…ˆå†³æ¡ä»¶ï¼Ÿæ‚¨éœ€è¦å¯¹ ACID æœ‰ä¸€ä¸ªç²—ç•¥çš„äº†è§£ï¼Œå³ä»€ä¹ˆæ˜¯æ•°æ®åº“äº‹åŠ¡ä»¥åŠä¸ºä»€ä¹ˆä½¿ç”¨å®ƒä»¬ã€‚æ­¤å¤–ï¼Œè¿™é‡Œä¸è®¨è®ºåˆ†å¸ƒå¼äº‹åŠ¡æˆ–ååº”å¼äº‹åŠ¡ï¼Œä½†å°± Spring è€Œè¨€ï¼Œä¸€èˆ¬åŸåˆ™ä»ç„¶é€‚ç”¨ã€‚\nä»‹ç» åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæ‚¨å°†äº†è§£ Spring æ ¸å¿ƒäº‹åŠ¡æŠ½è±¡æ¡†æ¶çš„ä¸»è¦æ”¯æŸ±ï¼ˆè¿™æ˜¯ä¸€ä¸ªä»¤äººå›°æƒ‘çš„æœ¯è¯­ï¼Œä¸æ˜¯å—ï¼Ÿï¼‰ - ç”¨å¤§é‡ä»£ç ç¤ºä¾‹è¿›è¡Œæè¿°ï¼š\n@Transactional ï¼ˆå£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼‰ä¸ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†ã€‚ ç‰©ç†äº‹åŠ¡ä¸é€»è¾‘äº‹åŠ¡ã€‚ Spring @Transactional ä¸ JPA/Hibernate é›†æˆã€‚ Spring @Transactional ä¸ Spring Boot æˆ– Spring MVC é›†æˆã€‚ å›æ»šã€ä»£ç†ã€å¸¸è§é™·é˜±ç­‰ç­‰ã€‚ ä¸ Spring å®˜æ–¹æ–‡æ¡£ç›¸åï¼Œæœ¬æŒ‡å—ä¸ä¼šç›´æ¥æ·±å…¥æ¢è®¨ Spring-first ä¸»é¢˜ï¼Œä»è€Œè®©æ‚¨æ„Ÿåˆ°å›°æƒ‘ã€‚\nç›¸åï¼Œæ‚¨å°†ä»¥éå¸¸è§„çš„æ–¹å¼å­¦ä¹  Spring äº‹åŠ¡ç®¡ç†ï¼šä»å¤´å¼€å§‹ï¼Œä¸€æ­¥ä¸€æ­¥ã€‚è¿™æ„å‘³ç€ï¼Œä»æ™®é€šçš„è€å¼ JDBC äº‹åŠ¡ç®¡ç†å¼€å§‹ã€‚\nWhy? ä¸ºä»€ä¹ˆï¼Ÿ\nå› ä¸º Spring æ‰€åšçš„ä¸€åˆ‡éƒ½æ˜¯åŸºäºè¿™äº› JDBC åŸºç¡€çŸ¥è¯†ã€‚å¦‚æœæ‚¨æŒæ¡äº†è¿™äº›åŸºç¡€çŸ¥è¯†ï¼Œç¨åæ‚¨å°†å¯ä»¥ä½¿ç”¨ Spring çš„ @Transactional æ³¨é‡ŠèŠ‚çœå¤§é‡æ—¶é—´ã€‚\næ™®é€š JDBC äº‹åŠ¡ç®¡ç†çš„å·¥ä½œåŸç† å¦‚æœæ‚¨åœ¨ä¸å®Œå…¨äº†è§£ JDBC äº‹åŠ¡çš„æƒ…å†µä¸‹è€ƒè™‘è·³è¿‡æœ¬èŠ‚ï¼šè¯·ä¸è¦è¿™æ ·åšã€‚\nå¦‚ä½•å¯åŠ¨ã€æäº¤æˆ–å›æ»š JDBC äº‹åŠ¡ ç¬¬ä¸€ä¸ªé‡è¦çš„æ”¶è·æ˜¯ï¼šæ— è®ºæ‚¨ä½¿ç”¨ Spring çš„ @Transactional æ³¨é‡Šã€æ™®é€š Hibernateã€jOOQ è¿˜æ˜¯ä»»ä½•å…¶ä»–æ•°æ®åº“åº“ï¼Œéƒ½æ²¡æœ‰å…³ç³»ã€‚\næœ€åï¼Œå®ƒä»¬éƒ½æ‰§è¡Œç›¸åŒçš„æ“ä½œæ¥æ‰“å¼€å’Œå…³é—­ï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œç®¡ç†â€ï¼‰æ•°æ®åº“äº‹åŠ¡ã€‚æ™®é€šçš„ JDBC äº‹åŠ¡ç®¡ç†ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\nimport java.sql.Connection; Connection connection = dataSource.getConnection(); // (1) try (connection) { connection.setAutoCommit(false); // (2) // execute some SQL statements... connection.commit(); // (3) } catch (SQLException e) { connection.","title":"[è¯‘]æ·±å…¥äº†è§£Springäº‹åŠ¡ç®¡ç†ï¼š@Transactional"},{"content":"ç®€ä»‹å’Œæ¦‚è¿° JSON Web Token æˆ– JWTï¼ˆæ›´å¸¸è§çš„åç§°ï¼‰æ˜¯ä¸€ç§å¼€æ”¾çš„äº’è”ç½‘æ ‡å‡† (RFC 7519)ï¼Œç”¨äºä»¥ç´§å‡‘çš„æ–¹å¼åœ¨å„æ–¹ä¹‹é—´å®‰å…¨åœ°ä¼ è¾“å¯ä¿¡ä¿¡æ¯ã€‚ä»¤ç‰ŒåŒ…å«ç¼–ç ä¸º JSON å¯¹è±¡çš„å£°æ˜ï¼Œå¹¶ä½¿ç”¨ç§æœ‰å¯†é’¥æˆ–å…¬é’¥/ç§é’¥å¯¹è¿›è¡Œæ•°å­—ç­¾åã€‚å®ƒä»¬æ˜¯ç‹¬ç«‹ä¸”å¯éªŒè¯çš„ï¼Œå› ä¸ºå®ƒä»¬ç»è¿‡æ•°å­—ç­¾åã€‚ JWT å¯ä»¥è¿›è¡Œç­¾åå’Œ/æˆ–åŠ å¯†ã€‚\nç­¾åçš„ä»¤ç‰ŒéªŒè¯ä»¤ç‰Œä¸­åŒ…å«çš„å£°æ˜çš„å®Œæ•´æ€§ï¼Œè€ŒåŠ å¯†çš„ä»¤ç‰Œåˆ™å‘å…¶ä»–æ–¹éšè—å£°æ˜ã€‚\nJWT ä¹Ÿå¯ç”¨äºä¿¡æ¯äº¤æ¢ï¼Œå°½ç®¡å®ƒä»¬æ›´å¸¸ç”¨äºæˆæƒï¼Œå› ä¸ºå®ƒä»¬æ¯”ä½¿ç”¨å†…å­˜ä¸­éšæœºä»¤ç‰Œçš„ä¼šè¯ç®¡ç†å…·æœ‰å¾ˆå¤šä¼˜åŠ¿ã€‚å…¶ä¸­æœ€é‡è¦çš„æ˜¯å…è®¸å°†èº«ä»½éªŒè¯é€»è¾‘å§”æ‰˜ç»™ç¬¬ä¸‰æ–¹æœåŠ¡å™¨ï¼Œä¾‹å¦‚ AuthO ç­‰ã€‚\nJWT ä»¤ç‰Œåˆ†ä¸º 3 éƒ¨åˆ†ï¼Œå³æ ‡å¤´ã€æœ‰æ•ˆè´Ÿè½½å’Œç­¾åï¼Œæ ¼å¼ä¸º\n[Header].[Payload].[Signature] Header âˆ’ JWT ä»¤ç‰Œçš„æ ‡å¤´åŒ…å«åº”ç”¨äº JWT çš„åŠ å¯†æ“ä½œåˆ—è¡¨ã€‚è¿™å¯ä»¥æ˜¯ç­¾åæŠ€æœ¯ã€æœ‰å…³å†…å®¹ç±»å‹çš„å…ƒæ•°æ®ä¿¡æ¯ç­‰ã€‚æ ‡å¤´ä»¥ JSON å¯¹è±¡çš„å½¢å¼å‘ˆç°ï¼Œè¯¥å¯¹è±¡è¢«ç¼–ç ä¸º base64URLã€‚æœ‰æ•ˆ JWT æ ‡å¤´çš„ç¤ºä¾‹æ˜¯ { \u0026#34;alg\u0026#34;: \u0026#34;HS256\u0026#34;, \u0026#34;typ\u0026#34;: \u0026#34;JWT\u0026#34; } è¿™é‡Œï¼Œâ€œalgâ€ä¸ºæˆ‘ä»¬æä¾›äº†æœ‰å…³æ‰€ç”¨ç®—æ³•ç±»å‹çš„ä¿¡æ¯ï¼Œâ€œtypâ€ä¸ºæˆ‘ä»¬æä¾›äº†ä¿¡æ¯çš„ç±»å‹ã€‚\nPayload âˆ’ JWT çš„æœ‰æ•ˆè´Ÿè½½éƒ¨åˆ†åŒ…å«ä½¿ç”¨ä»¤ç‰Œä¼ è¾“çš„å®é™…æ•°æ®ã€‚è¿™éƒ¨åˆ†ä¹Ÿç§°ä¸º JWT ä»¤ç‰Œçš„â€œå£°æ˜â€éƒ¨åˆ†ã€‚ç´¢èµ”å¯ä»¥åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼šæ³¨å†Œç´¢èµ”ã€å…¬å¼€ç´¢èµ”å’Œç§äººç´¢èµ”ã€‚ æ³¨å†Œçš„å£°æ˜æ˜¯æ¨èçš„ä½†ä¸æ˜¯å¼ºåˆ¶çš„å£°æ˜ï¼Œä¾‹å¦‚ iss(å‘è¡Œè€…)ã€sub(ä¸»é¢˜)ã€aud(å—ä¼—) ç­‰ã€‚ å…¬å…±å£°æ˜æ˜¯é‚£äº›ä½¿ç”¨ JWT çš„äººå®šä¹‰çš„å£°æ˜ã€‚ ç§äººå£°æ˜æˆ–è‡ªå®šä¹‰å£°æ˜æ˜¯ä¸ºäº†åœ¨ç›¸å…³æ–¹ä¹‹é—´å…±äº«ä¿¡æ¯è€Œåˆ›å»ºçš„ç”¨æˆ·å®šä¹‰çš„å£°æ˜ã€‚ æœ‰æ•ˆè´Ÿè½½å¯¹è±¡çš„ç¤ºä¾‹å¯ä»¥æ˜¯ã€‚\n{ \u0026#34;sub\u0026#34;: \u0026#34;12345\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;Johnny Hill\u0026#34;, \u0026#34;admin\u0026#34;: false } æœ‰æ•ˆè´Ÿè½½å¯¹è±¡ä¸æ ‡å¤´å¯¹è±¡ä¸€æ ·ï¼Œä¹Ÿé‡‡ç”¨ base64Url ç¼–ç ï¼Œå¹¶ä¸”è¯¥å­—ç¬¦ä¸²æ„æˆ JWT çš„ç¬¬äºŒéƒ¨åˆ†ã€‚\nSignatureâˆ’ JWT çš„ç­¾åéƒ¨åˆ†ç”¨äºéªŒè¯æ¶ˆæ¯åœ¨æ­¤è¿‡ç¨‹ä¸­æ²¡æœ‰æ›´æ”¹ã€‚å¦‚æœä»¤ç‰Œæ˜¯ç”¨ç§é’¥ç­¾åçš„ï¼Œå®ƒè¿˜ä¼šéªŒè¯å‘é€è€…çš„èº«ä»½ã€‚å®ƒæ˜¯ä½¿ç”¨ç¼–ç çš„æ ‡å¤´ã€ç¼–ç çš„æœ‰æ•ˆè´Ÿè½½ã€ç§˜å¯†å’Œæ ‡å¤´ä¸­æŒ‡å®šçš„ç®—æ³•åˆ›å»ºçš„ã€‚ç­¾åçš„ä¸€ä¸ªä¾‹å­æ˜¯ã€‚ HMACSHA256(base64UrlEncode(header) + \u0026#34;.\u0026#34; + base64UrlEncode(payload), secret); å¦‚æœæˆ‘ä»¬è¾“å…¥æ ‡å¤´ã€æœ‰æ•ˆè´Ÿè½½å’Œç­¾åï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªä»¤ç‰Œï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚\neyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6I kpvaG4gRG9lIiwiYWRtaW4iOmZhbHNlfQ.gWDlJdpCTIHVYKkJSfAVNUn0ZkAjMxskDDm-5Fhe WJ7xXgW8k5CllcGk4C9qPrfa1GdqfBrbX_1x1E39JY8BYLobAfAg1fs_Ky8Z7U1oCl6HL63yJq_ wVNBHp49hWzg3-ERxkqiuTv0tIuDOasIdZ5FtBdtIP5LM9Oc1tsuMXQXCGR8GqGf1Hl2qv8MCyn NZJuVdJKO_L3WGBJouaTpK1u2SEleVFGI2HFvrX_jS2ySzDxoO9KjbydK0LNv_zOI7kWv-gAmA j-v0mHdJrLbxD7LcZJEGRScCSyITzo6Z59_jG_97oNLFgBKJbh12nvvPibHpUYWmZuHkoGvuy5RLUA ç°åœ¨ï¼Œå¯ä»¥ä½¿ç”¨æ‰¿è½½æ¨¡å¼åœ¨æˆæƒæ ‡å¤´ä¸­ä½¿ç”¨æ­¤ä»¤ç‰Œã€‚\nAuthorization âˆ’ Bearer æˆæƒ - æŒæœ‰è€…\nä½¿ç”¨ JWT ä»¤ç‰Œè¿›è¡Œæˆæƒæ˜¯å…¶æœ€å¸¸è§çš„åº”ç”¨ã€‚ä»¤ç‰Œé€šå¸¸åœ¨æœåŠ¡å™¨ä¸­ç”Ÿæˆå¹¶å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œå¹¶å­˜å‚¨åœ¨ä¼šè¯å­˜å‚¨æˆ–æœ¬åœ°å­˜å‚¨ä¸­ã€‚è¦è®¿é—®å—ä¿æŠ¤çš„èµ„æºï¼Œå®¢æˆ·ç«¯å°†åœ¨æ ‡å¤´ä¸­å‘é€ JWTï¼Œå¦‚ä¸Šæ‰€è¿°ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹é¢çš„éƒ¨åˆ†ä¸­çœ‹åˆ° Spring Security ä¸­çš„ JWT å®ç°ã€‚\nä½¿ç”¨ JWT å¼€å§‹ä½¿ç”¨ Spring Security æˆ‘ä»¬è¦å¼€å‘çš„åº”ç”¨ç¨‹åºå°†ä½¿ç”¨ JWT å¤„ç†åŸºæœ¬çš„ç”¨æˆ·èº«ä»½éªŒè¯å’Œæˆæƒã€‚è®©æˆ‘ä»¬å¼€å§‹è®¿é—® start.spring.ioï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ªå…·æœ‰ä»¥ä¸‹ä¾èµ–é¡¹çš„ Maven åº”ç”¨ç¨‹åºã€‚\nSpring Web Spring Security æˆ‘ä»¬ç”Ÿæˆé¡¹ç›®ï¼Œä¸‹è½½åå°†å…¶è§£å‹åˆ°æˆ‘ä»¬é€‰æ‹©çš„æ–‡ä»¶å¤¹ä¸­ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æˆ‘ä»¬é€‰æ‹©çš„ä»»ä½• IDEã€‚æˆ‘å°†ä½¿ç”¨ Spring Tools Suite 4ï¼Œå› ä¸ºå®ƒé’ˆå¯¹ Spring åº”ç”¨ç¨‹åºè¿›è¡Œäº†æœ€ä¼˜åŒ–ã€‚\né™¤äº†ä¸Šè¿°ä¾èµ–é¡¹ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å°†åŒ…å«æ¥è‡ª Maven ä¸­å¤®å­˜å‚¨åº“çš„ io.jsonwebtoken çš„ jwt ä¾èµ–é¡¹ï¼Œå› ä¸ºå®ƒä¸åŒ…å«åœ¨ spring åˆå§‹åŒ–ç¨‹åºä¸­ã€‚è¿™ç§ä¾èµ–å…³ç³»è´Ÿè´£æ¶‰åŠ JWT çš„æ‰€æœ‰æ“ä½œï¼ŒåŒ…æ‹¬æ„å»ºä»¤ç‰Œã€è§£æä»¤ç‰Œä»¥è·å–å£°æ˜ç­‰ã€‚\n\u0026lt;dependency\u0026gt; \u0026lt;artifactId\u0026gt;jjwt\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.9.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; æˆ‘ä»¬çš„ pom.xml æ–‡ä»¶ç°åœ¨åº”è¯¥ä¸æ­¤ç±»ä¼¼ã€‚\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;parent\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-parent\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.3.1.RELEASE\u0026lt;version\u0026gt; \u0026lt;relativePath /\u0026gt; \u0026lt;!-- lookup parent from repository --\u0026gt; \u0026lt;/parent\u0026gt; \u0026lt;groupId\u0026gt;com.spring.security\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jwtbasic\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.0.1-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;name\u0026gt;jwtbasic\u0026lt;/name\u0026gt; \u0026lt;description\u0026gt;Demo project for Spring Boot\u0026lt;/description\u0026gt; \u0026lt;properties\u0026gt; \u0026lt;java.version\u0026gt;1.8\u0026lt;/java.version\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-security\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;io.jsonwebtoken\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jjwt\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.9.1\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;javax.xml.bind\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;jaxb-api\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-test\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;exclusions\u0026gt; \u0026lt;exclusion\u0026gt; \u0026lt;groupId\u0026gt;org.junit.vintage\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;junit-vintage-engine\u0026lt;/artifactId\u0026gt; \u0026lt;/exclusion\u0026gt; \u0026lt;/exclusions\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.security\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-security-test\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;scope\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;build\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;/build\u0026gt; \u0026lt;/project\u0026gt; ç°åœ¨æˆ‘ä»¬çš„é¡¹ç›®å·²ç»è®¾ç½®å®Œæ¯•ï¼Œæˆ‘ä»¬å°†åˆ›å»ºæ§åˆ¶å™¨ç±» Hello Controllerï¼Œå®ƒå…¬å¼€ä¸€ä¸ª Get ç«¯ç‚¹ã€‚\npackage com.spring.security.jwtbasic.controllers; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.RestController; @RestController public class HelloController { @GetMapping(\u0026#34;/hello\u0026#34;) public String hello() { return \u0026#34;hello\u0026#34;; } } ç°åœ¨æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåä¸º config çš„åŒ…ï¼Œåœ¨å…¶ä¸­æ·»åŠ æ‰©å±• Spring Security çš„ WebSecurityConfigurerAdapter ç±»çš„é…ç½®ç±»ã€‚è¿™å°†ä¸ºæˆ‘ä»¬æä¾›é¡¹ç›®é…ç½®å’Œåº”ç”¨ç¨‹åºå®‰å…¨æ€§æ‰€éœ€çš„æ‰€æœ‰åŠŸèƒ½å’Œå®šä¹‰ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬é€šè¿‡å®ç°ç”Ÿæˆç›¸åŒå®ä¾‹çš„æ–¹æ³•æ¥æä¾› BcryptPasswordEncoder å®ä¾‹ã€‚æˆ‘ä»¬ç”¨ @Bean æ³¨é‡Šè¯¥æ–¹æ³•ä»¥æ·»åŠ åˆ° Spring ä¸Šä¸‹æ–‡ä¸­ã€‚\npackage com.spring.security.jwtbasic.config; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.authentication.AuthenticationManager; import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter; import org.springframework.security.config.http.SessionCreationPolicy; import org.springframework.security.core.userdetails.UserDetailsService; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; import org.springframework.security.crypto.password.PasswordEncoder; import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter; import com.spring.security.jwtbasic.jwtutils.JwtAuthenticationEntryPoint; import com.spring.security.jwtbasic.jwtutils.JwtFilter; @Configuration public class WebSecurityConfig extends WebSecurityConfigurerAdapter { @Bean public PasswordEncoder passwordEncoder() { return new BCryptPasswordEncoder(); } } The JWT includes a secret which we will define in our application.properties file as given below. JWT åŒ…å«ä¸€ä¸ªç§˜å¯†ï¼Œæˆ‘ä»¬å°†åœ¨ application.properties æ–‡ä»¶ä¸­å®šä¹‰è¯¥ç§˜å¯†ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚\nsecret=somerandomsecret ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º jwtutils çš„åŒ…ã€‚è¯¥åŒ…å°†åŒ…å«ä¸ JWT æ“ä½œç›¸å…³çš„æ‰€æœ‰ç±»å’Œæ¥å£ï¼Œå…¶ä¸­åŒ…æ‹¬ã€‚\nç”Ÿæˆä»¤ç‰Œ éªŒè¯ä»¤ç‰Œ æ£€æŸ¥ç­¾å éªŒè¯å£°æ˜å’Œæƒé™ åœ¨æ­¤åŒ…ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºç¬¬ä¸€ä¸ªç±»ï¼Œç§°ä¸ºä»¤ç‰Œç®¡ç†å™¨ã€‚æ­¤ç±»å°†è´Ÿè´£ä½¿ç”¨ io.jsonwebtoken.Jwts åˆ›å»ºå’ŒéªŒè¯ä»¤ç‰Œã€‚\npackage com.spring.security.jwtbasic.jwtutils; import java.io.Serializable; import java.util.Base64; import java.util.Date; import java.util.HashMap; import java.util.Map; import org.springframework.beans.factory.annotation.Value; import org.springframework.security.core.userdetails.UserDetails; import org.springframework.stereotype.Component; import io.jsonwebtoken.Claims; import io.jsonwebtoken.Jwts; import io.jsonwebtoken.SignatureAlgorithm; @Component public class TokenManager implements Serializable { /** * */ private static final long serialVersionUID = 7008375124389347049L; public static final long TOKEN_VALIDITY = 10 * 60 * 60; @Value(\u0026#34;${secret}\u0026#34;) private String jwtSecret; public String generateJwtToken(UserDetails userDetails) { Map\u0026lt;String, Object\u0026gt; claims = new HashMap\u0026lt;\u0026gt;(); return Jwts.builder().setClaims(claims).setSubject(userDetails.getUsername()) .setIssuedAt(new Date(System.currentTimeMillis())) .setExpiration(new Date(System.currentTimeMillis() + TOKEN_VALIDITY * 1000)) .signWith(SignatureAlgorithm.HS512, jwtSecret).compact(); } public Boolean validateJwtToken(String token, UserDetails userDetails) { String username = getUsernameFromToken(token); Claims claims = Jwts.parser().setSigningKey(jwtSecret).parseClaimsJws(token).getBody(); Boolean isTokenExpired = claims.getExpiration().before(new Date()); return (username.equals(userDetails.getUsername()) \u0026amp;\u0026amp; !isTokenExpired); } public String getUsernameFromToken(String token) { final Claims claims = Jwts.parser().setSigningKey(jwtSecret).parseClaimsJws(token).getBody(); return claims.getSubject(); } } åœ¨è¿™é‡Œï¼Œç”±äºæ‰€æœ‰ä»¤ç‰Œéƒ½åº”è¯¥æœ‰ä¸€ä¸ªåˆ°æœŸæ—¥æœŸï¼Œå› æ­¤æˆ‘ä»¬ä»ä»¤ç‰Œæœ‰æ•ˆæ€§å¸¸é‡å¼€å§‹ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„ä»¤ç‰Œåœ¨ç”Ÿæˆå 10 åˆ†é’Ÿå†…æœ‰æ•ˆã€‚å½“æˆ‘ä»¬ç”Ÿæˆä»¤ç‰Œæ—¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸ªå€¼ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ @Value æ³¨é‡Šå°†æ­Œå”±é”®çš„å€¼ä» application.properties æ–‡ä»¶ä¸­æå–åˆ° jwtSecret å­—æ®µä¸­ã€‚\næˆ‘ä»¬è¿™é‡Œæœ‰ä¸¤ç§æ–¹æ³• -\ngenerateJwtToken() âˆ’ æ­¤æ–¹æ³•ç”¨äºåœ¨ç”¨æˆ·æˆåŠŸè¿›è¡Œèº«ä»½éªŒè¯æ—¶ç”Ÿæˆä»¤ç‰Œã€‚è¦åœ¨æ­¤å¤„åˆ›å»ºä»¤ç‰Œï¼Œæˆ‘ä»¬ä½¿ç”¨ç”¨æˆ·åã€ä»¤ç‰Œå‘è¡Œæ—¥æœŸå’Œä»¤ç‰Œåˆ°æœŸæ—¥æœŸã€‚æ­£å¦‚æˆ‘ä»¬ä¹‹å‰è®¨è®ºçš„ï¼Œè¿™å°†å½¢æˆä»¤ç‰Œæˆ–å£°æ˜çš„æœ‰æ•ˆè´Ÿè½½éƒ¨åˆ†ã€‚ä¸ºäº†ç”Ÿæˆä»¤ç‰Œï¼Œæˆ‘ä»¬ä½¿ç”¨ Jwts çš„ builder() æ–¹æ³•ã€‚æ­¤æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„ JwtBuilder å®ä¾‹ï¼Œå¯ç”¨äºåˆ›å»ºç´§å‡‘çš„ JWT åºåˆ—åŒ–å­—ç¬¦ä¸²ã€‚ ä¸ºäº†è®¾ç½®å£°æ˜ï¼Œæˆ‘ä»¬ä½¿ç”¨ setClaims() æ–¹æ³•ï¼Œç„¶åè®¾ç½®æ¯ä¸ªå£°æ˜ã€‚å¯¹äºè¿™ä¸ªä»¤ç‰Œï¼Œæˆ‘ä»¬æœ‰ setSubject(username)ã€å‘è¡Œæ—¥æœŸå’Œåˆ°æœŸæ—¥æœŸã€‚æˆ‘ä»¬è¿˜å¯ä»¥åƒä¸Šé¢è®¨è®ºçš„é‚£æ ·æå‡ºè‡ªå®šä¹‰å£°æ˜ã€‚è¿™å¯ä»¥æ˜¯æˆ‘ä»¬æƒ³è¦çš„ä»»ä½•å€¼ï¼Œå…¶ä¸­å¯èƒ½åŒ…æ‹¬ç”¨æˆ·è§’è‰²ã€ç”¨æˆ·æƒé™ç­‰ã€‚\nç„¶åæˆ‘ä»¬è®¾ç½®ä»¤ç‰Œçš„ç­¾åéƒ¨åˆ†ã€‚è¿™æ˜¯ä½¿ç”¨ signWith() æ–¹æ³•å®Œæˆçš„ï¼Œæˆ‘ä»¬è®¾ç½®æˆ‘ä»¬å–œæ¬¢ä½¿ç”¨çš„å“ˆå¸Œç®—æ³•å’Œå¯†é’¥ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ compact()æ–¹æ³•æ„å»º JWTï¼Œå¹¶æ ¹æ® JWT ç´§å‡‘åºåˆ—åŒ–è§„åˆ™å°†å…¶åºåˆ—åŒ–ä¸ºç´§å‡‘çš„ã€URL å®‰å…¨çš„å­—ç¬¦ä¸²ã€‚\nvalidateJwtToken() âˆ’ ç°åœ¨å·²ç»å¤„ç†äº†ä»¤ç‰Œçš„ç”Ÿæˆï¼Œæˆ‘ä»¬åº”è¯¥å…³æ³¨ä»¤ç‰Œä½œä¸ºè¯·æ±‚çš„ä¸€éƒ¨åˆ†æ—¶çš„éªŒè¯è¿‡ç¨‹ã€‚éªŒè¯ä»¤ç‰Œæ„å‘³ç€éªŒè¯è¯·æ±‚æ˜¯å¦ç»è¿‡èº«ä»½éªŒè¯ï¼Œå¹¶ä¸”ä»¤ç‰Œæ˜¯ç”Ÿæˆå¹¶å‘é€ç»™ç”¨æˆ·çš„ä»¤ç‰Œã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦è§£æä»¤ç‰Œä»¥è·å–ç”¨æˆ·åã€è§’è‰²ã€æƒé™ã€æœ‰æ•ˆæœŸç­‰å£°æ˜ã€‚ ä¸ºäº†éªŒè¯ä»¤ç‰Œï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆè§£æå®ƒã€‚è¿™æ˜¯ä½¿ç”¨ Jwts çš„ parser() æ–¹æ³•å®Œæˆçš„ã€‚ç„¶åï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®ç”¨äºç”Ÿæˆä»¤ç‰Œçš„ç­¾åå¯†é’¥ï¼Œç„¶ååœ¨ä»¤ç‰Œä¸Šä½¿ç”¨ parseClaimsJws() æ–¹æ³•æ ¹æ®æ„å»ºå™¨çš„å½“å‰é…ç½®çŠ¶æ€è§£æç´§å‡‘çš„åºåˆ—åŒ– JWS å­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›ç”Ÿæˆçš„ Claims JWS å®ä¾‹ã€‚ç„¶åä½¿ç”¨ getBody() æ–¹æ³•è¿”å›ç”Ÿæˆä»¤ç‰Œæ—¶ä½¿ç”¨çš„å£°æ˜å®ä¾‹ã€‚\nä»è·å¾—çš„å£°æ˜å®ä¾‹ä¸­ï¼Œæˆ‘ä»¬æå–ä¸»é¢˜å’Œåˆ°æœŸæ—¥æœŸä»¥éªŒè¯ä»¤ç‰Œçš„æœ‰æ•ˆæ€§ã€‚ç”¨æˆ·ååº”è¯¥æ˜¯ç”¨æˆ·çš„ç”¨æˆ·åï¼Œå¹¶ä¸”ä»¤ç‰Œä¸åº”è¿‡æœŸã€‚å¦‚æœæ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œæˆ‘ä»¬å°†è¿”å› trueï¼Œè¿™è¡¨ç¤ºä»¤ç‰Œæœ‰æ•ˆã€‚\næˆ‘ä»¬è¦åˆ›å»ºçš„ä¸‹ä¸€ä¸ªç±»æ˜¯ JwtUserDetailsSâ€‹â€‹erviceã€‚è¿™ä¸ªç±»å°†æ‰©å±• Spring security çš„ UserDetailsSâ€‹â€‹erviceï¼Œæˆ‘ä»¬å°†å®ç° loadUserByUsername() æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤º -\npackage com.spring.security.jwtbasic.jwtutils; import java.util.ArrayList; import org.springframework.security.core.userdetails.User; import org.springframework.security.core.userdetails.UserDetails; import org.springframework.security.core.userdetails.UserDetailsService; import org.springframework.security.core.userdetails.UsernameNotFoundException; import org.springframework.stereotype.Service; @Service public class JwtUserDetailsService implements UserDetailsService { @Override public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException { if (\u0026#34;randomuser123\u0026#34;.equals(username)) { return new User(\u0026#34;randomuser123\u0026#34;, \u0026#34;$2a$10$slYQmyNdGzTn7ZLBXBChFOC9f6kFjAqPhccnP6DxlWXx2lPk1C3G6\u0026#34;, new ArrayList\u0026lt;\u0026gt;()); } else { throw new UsernameNotFoundException(\u0026#34;User not found with username: \u0026#34; + username); } } } åœ¨è¿™é‡Œï¼Œç”±äºè¿™æ˜¯ä¸€ä¸ªåŸºæœ¬åº”ç”¨ç¨‹åºï¼Œå…¶å”¯ä¸€ç›®çš„æ˜¯æ¼”ç¤º JWT èº«ä»½éªŒè¯ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨äº†ä¸€ç»„ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ•°æ®åº“ã€‚ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬å°†ç”¨æˆ·åæŒ‡å®šä¸ºâ€œrandomuser123â€ï¼Œå¹¶å°†å¯†ç ï¼ˆå³â€œå¯†ç â€ï¼‰ç¼–ç ä¸ºâ€œ$2a$10$slYQmyNdGzTn7ZLBXBChFOC9f6kFjAqPhccnP6DxlWXx2lPk1C3G6â€ã€‚\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸ºè¯·æ±‚å’Œå“åº”æ¨¡å‹åˆ›å»ºç±»ã€‚è¿™äº›æ¨¡å‹å†³å®šäº†æˆ‘ä»¬çš„è¯·æ±‚å’Œå“åº”æ ¼å¼å¦‚ä½•è¿›è¡Œèº«ä»½éªŒè¯ã€‚ä¸‹é¢ç»™å‡ºçš„ç¬¬ä¸€ä¸ªå¿«ç…§æ˜¯è¯·æ±‚æ¨¡å‹ã€‚æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬å°†åœ¨è¯·æ±‚ä¸­æ¥å—ä¸¤ä¸ªå±æ€§â€”â€”ç”¨æˆ·åå’Œå¯†ç ã€‚\npackage com.spring.security.jwtbasic.jwtutils.models; import java.io.Serializable; public class JwtRequestModel implements Serializable { /** * */ private static final long serialVersionUID = 2636936156391265891L; private String username; private String password; public JwtRequestModel() { } public JwtRequestModel(String username, String password) { super(); this.username = username; this.password = password; } public String getUsername() { return username; } public void setUsername(String username) { this.username = username; } public String getPassword() { return password; } public void setPassword(String password) { this.password = password; } } ä»¥ä¸‹æ˜¯èº«ä»½éªŒè¯æˆåŠŸåçš„å“åº”æ¨¡å‹çš„ä»£ç ã€‚æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œåœ¨èº«ä»½éªŒè¯æˆåŠŸåï¼Œæˆ‘ä»¬å°†æŠŠä»¤ç‰Œå‘é€å›ç”¨æˆ·ã€‚\npackage com.spring.security.jwtbasic.jwtutils.models; import java.io.Serializable; public class JwtResponseModel implements Serializable { /** * */ private static final long serialVersionUID = 1L; private final String token; public JwtResponseModel(String token) { this.token = token; } public String getToken() { return token; } } ç°åœ¨ä¸ºäº†è¿›è¡Œèº«ä»½éªŒè¯ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ§åˆ¶å™¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚\npackage com.spring.security.jwtbasic.jwtutils; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.http.ResponseEntity; import org.springframework.security.authentication.AuthenticationManager; import org.springframework.security.authentication.BadCredentialsException; import org.springframework.security.authentication.DisabledException; import org.springframework.security.authentication.UsernamePasswordAuthenticationToken; import org.springframework.security.core.userdetails.UserDetails; import org.springframework.web.bind.annotation.CrossOrigin; import org.springframework.web.bind.annotation.PostMapping; import org.springframework.web.bind.annotation.RequestBody; import org.springframework.web.bind.annotation.RestController; import com.spring.security.jwtbasic.jwtutils.models.JwtRequestModel; import com.spring.security.jwtbasic.jwtutils.models.JwtResponseModel; @RestController @CrossOrigin public class JwtController { @Autowired private JwtUserDetailsService userDetailsService; @Autowired private AuthenticationManager authenticationManager; @Autowired private TokenManager tokenManager; @PostMapping(\u0026#34;/login\u0026#34;) public ResponseEntity\u0026lt;\u0026gt; createToken(@RequestBody JwtRequestModel request) throws Exception { try { authenticationManager.authenticate( new UsernamePasswordAuthenticationToken(request.getUsername(), request.getPassword()) ); } catch (DisabledException e) { throw new Exception(\u0026#34;USER_DISABLED\u0026#34;, e); } catch (BadCredentialsException e) { throw new Exception(\u0026#34;INVALID_CREDENTIALS\u0026#34;, e); } final UserDetails userDetails = userDetailsService.loadUserByUsername(request.getUsername()); final String jwtToken = tokenManager.generateJwtToken(userDetails); return ResponseEntity.ok(new JwtResponseModel(jwtToken)); } } å¦‚æœæˆ‘ä»¬æŸ¥çœ‹ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬è‡ªåŠ¨è£…é…äº†ä¸‰ä¸ªä¾èµ–é¡¹ï¼Œå³ JwtUserDetailsSâ€‹â€‹erviceã€AuthenticationManager å’Œ TokenManagerã€‚è™½ç„¶æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†ä¸Šé¢ JwtUserDetailsSâ€‹â€‹ervice å’Œ TokenManager ç±»çš„å®ç°ï¼Œä½†èº«ä»½éªŒè¯ç®¡ç†å™¨ bean æ˜¯æˆ‘ä»¬å°†åœ¨ WebSecurityConfig ç±»ä¸­åˆ›å»ºçš„ä¸€ä¸ªã€‚\nAuthenticationManager ç±»å°†è´Ÿè´£æˆ‘ä»¬çš„èº«ä»½éªŒè¯ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ UsernamePasswordAuthenticationToken æ¨¡å‹æ¥éªŒè¯è¯·æ±‚ã€‚å¦‚æœèº«ä»½éªŒè¯æˆåŠŸï¼Œæˆ‘ä»¬å°†ä¸ºç”¨æˆ·ç”Ÿæˆä¸€ä¸ª JWTï¼Œè¯¥ JWT å¯ä»¥åœ¨åç»­è¯·æ±‚çš„ Authorization æ ‡å¤´ä¸­å‘é€ä»¥è·å–ä»»ä½•èµ„æºã€‚\næ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ JwtUserDetailsSâ€‹â€‹ervice ç±»çš„ loadUserByUsername() æ–¹æ³•å’Œ TokenManager ç±»ä¸­çš„ generateJwtToken()ã€‚\nå¦‚ä¸Šæ‰€è¿°ï¼Œç”Ÿæˆçš„ JWT ä½œä¸ºæˆåŠŸèº«ä»½éªŒè¯çš„å“åº”å‘é€ç»™ç”¨æˆ·ã€‚\nç°åœ¨æ˜¯æˆ‘ä»¬åˆ›å»ºè¿‡æ»¤å™¨çš„æ—¶å€™äº†ã€‚è¿‡æ»¤å™¨ç±»å°†ç”¨äºè·Ÿè¸ªæˆ‘ä»¬çš„è¯·æ±‚å¹¶æ£€æµ‹å®ƒä»¬æ˜¯å¦åœ¨æ ‡å¤´ä¸­åŒ…å«æœ‰æ•ˆä»¤ç‰Œã€‚å¦‚æœä»¤ç‰Œæœ‰æ•ˆï¼Œæˆ‘ä»¬å°†ç»§ç»­è¯·æ±‚ï¼Œå¦åˆ™æˆ‘ä»¬å°†å‘é€ 401 é”™è¯¯ï¼ˆæœªç»æˆæƒï¼‰ã€‚\npackage com.spring.security.jwtbasic.jwtutils; import java.io.IOException; import javax.servlet.FilterChain; import javax.servlet.ServletException; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.security.authentication.UsernamePasswordAuthenticationToken; import org.springframework.security.core.context.SecurityContextHolder; import org.springframework.security.core.userdetails.UserDetails; import org.springframework.security.web.authentication.WebAuthenticationDetailsSource; import org.springframework.stereotype.Component; import org.springframework.web.filter.OncePerRequestFilter; import io.jsonwebtoken.ExpiredJwtException; @Component public class JwtFilter extends OncePerRequestFilter { @Autowired private JwtUserDetailsService userDetailsService; @Autowired private TokenManager tokenManager; @Override protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain) throws ServletException, IOException { String tokenHeader = request.getHeader(\u0026#34;Authorization\u0026#34;); String username = null; String token = null; if (tokenHeader != null \u0026amp;\u0026amp; tokenHeader.startsWith(\u0026#34;Bearer \u0026#34;)) { token = tokenHeader.substring(7); try { username = tokenManager.getUsernameFromToken(token); } catch (IllegalArgumentException e) { System.out.println(\u0026#34;Unable to get JWT Token\u0026#34;); } catch (ExpiredJwtException e) { System.out.println(\u0026#34;JWT Token has expired\u0026#34;); } } else { System.out.println(\u0026#34;Bearer String not found in token\u0026#34;); } if (null != username \u0026amp;\u0026amp;SecurityContextHolder.getContext().getAuthentication() == null) { UserDetails userDetails = userDetailsService.loadUserByUsername(username); if (tokenManager.validateJwtToken(token, userDetails)) { UsernamePasswordAuthenticationToken authenticationToken = new UsernamePasswordAuthenticationToken( userDetails, null, userDetails.getAuthorities()); authenticationToken.setDetails(new WebAuthenticationDetailsSource().buildDetails(request)); SecurityContextHolder.getContext().setAuthentication(authenticationToken); } } filterChain.doFilter(request, response); } } æ­£å¦‚æˆ‘ä»¬åœ¨ä¸Šé¢çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬ä¹Ÿåœ¨è¿™é‡Œè‡ªåŠ¨è£…é…äº† JwtUserDetailsSâ€‹â€‹ervice å’Œ TokenManager ç±»ã€‚æˆ‘ä»¬æ‰©å±•äº† SpringSecurity çš„ OncePerRequestFilterï¼Œç¡®ä¿è¿‡æ»¤å™¨é’ˆå¯¹æ¯ä¸ªè¯·æ±‚è¿è¡Œã€‚æˆ‘ä»¬å·²ç»ä¸º OncePerRequestFilter ç±»çš„é‡å†™æ–¹æ³• doFilterInternal() æä¾›äº†å®ç°ã€‚\nè¿™é‡Œçš„æ–¹æ³•ä»æ ‡å¤´ä¸­æå–ä»¤ç‰Œå¹¶å€ŸåŠ© TokenManager ç±»çš„ validateJwtToken() æ–¹æ³•å¯¹å…¶è¿›è¡ŒéªŒè¯ã€‚åœ¨éªŒè¯è¿‡ç¨‹ä¸­ï¼Œå®ƒä¼šæ£€æŸ¥ç”¨æˆ·åå’Œåˆ°æœŸæ—¥æœŸã€‚å¦‚æœä¸¤ä¸ªå€¼éƒ½æœ‰æ•ˆï¼Œæˆ‘ä»¬ä¼šå°†èº«ä»½éªŒè¯ä¿å­˜åœ¨ Spring Security ä¸Šä¸‹æ–‡ä¸­ï¼Œå¹¶è®©ä»£ç ç»§ç»­æ‰§è¡Œè¿‡æ»¤å™¨é“¾ä¸­çš„ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨ã€‚å¦‚æœä»»ä½•éªŒè¯å¤±è´¥æˆ–ä»¤ç‰Œå­˜åœ¨é—®é¢˜ï¼Œæˆ–è€…æœªæ‰¾åˆ°ä»¤ç‰Œï¼Œæˆ‘ä»¬ä¼šæŠ›å‡ºé€‚å½“çš„å¼‚å¸¸å¹¶å‘å›é€‚å½“çš„å“åº”ï¼ŒåŒæ—¶é˜»æ­¢è¯·æ±‚ç»§ç»­è¿›è¡Œã€‚\nä¸ºæˆ‘ä»¬çš„è¯·æ±‚åˆ›å»ºè¿‡æ»¤å™¨åï¼Œæˆ‘ä»¬ç°åœ¨åˆ›å»º JwtAutheticationEntryPoint ç±»ã€‚è¯¥ç±»æ‰©å±•äº† Spring çš„ AuthenticationEntryPoint ç±»ï¼Œå¹¶æ‹’ç»æ¯ä¸ªæœªç»èº«ä»½éªŒè¯çš„è¯·æ±‚ï¼Œå¹¶å‘å®¢æˆ·ç«¯å‘é€é”™è¯¯ä»£ç  401ã€‚æˆ‘ä»¬é‡å†™äº† AuthenticationEntryPoint ç±»çš„ begin() æ–¹æ³•æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚\npackage com.spring.security.jwtbasic.jwtutils; import java.io.IOException; import java.io.Serializable; import javax.servlet.ServletException; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; import org.springframework.security.core.AuthenticationException; import org.springframework.security.web.AuthenticationEntryPoint; import org.springframework.stereotype.Component; @Component public class JwtAuthenticationEntryPoint implements AuthenticationEntryPoint, Serializable { @Override public void commence(HttpServletRequest request, HttpServletResponse response, AuthenticationException authException) throws IOException, ServletException { response.sendError(HttpServletResponse.SC_UNAUTHORIZED, \u0026#34;Unauthorized\u0026#34;); } } ç°åœ¨ï¼Œè®©æˆ‘ä»¬å›åˆ° WebSecurityConfig ç±»å¹¶å®Œæˆå…¶ä½™çš„é…ç½®ã€‚å¦‚æœæˆ‘ä»¬è¿˜è®°å¾—çš„è¯ï¼Œæˆ‘ä»¬å°†éœ€è¦æˆ‘ä»¬çš„ Jwt æ§åˆ¶å™¨ç±»çš„ AuthenticationManager beanï¼Œå¹¶å°†æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„è¿‡æ»¤å™¨æ·»åŠ åˆ°æˆ‘ä»¬çš„é…ç½®ä¸­ã€‚æˆ‘ä»¬è¿˜å°†é…ç½®å“ªäº›è¯·æ±‚éœ€è¦è¿›è¡Œèº«ä»½éªŒè¯ï¼Œå“ªäº›è¯·æ±‚ä¸éœ€è¦è¿›è¡Œèº«ä»½éªŒè¯ã€‚æˆ‘ä»¬è¿˜å°† AuthenticationEntryPoint æ·»åŠ åˆ°è¯·æ±‚ä¸­ä»¥å‘å› 401 é”™è¯¯å“åº”ã€‚å› ä¸ºï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ jwt æ—¶ä¹Ÿä¸éœ€è¦ç»´æŠ¤ä¼šè¯å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ä¼šè¯æˆä¸ºæ— çŠ¶æ€çš„ã€‚\npackage com.spring.security.jwtbasic.config; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.authentication.AuthenticationManager; import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter; import org.springframework.security.config.http.SessionCreationPolicy; import org.springframework.security.core.userdetails.UserDetailsService; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; import org.springframework.security.crypto.password.PasswordEncoder; import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter; import com.spring.security.jwtbasic.jwtutils.JwtAuthenticationEntryPoint; import com.spring.security.jwtbasic.jwtutils.JwtFilter; @Configuration public class WebSecurityConfig extends WebSecurityConfigurerAdapter { @Autowired private JwtAuthenticationEntryPoint authenticationEntryPoint; @Autowired private UserDetailsService userDetailsService; @Autowired private JwtFilter filter; @Bean public PasswordEncoder passwordEncoder() { return new BCryptPasswordEncoder(); } @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception { auth.userDetailsService(userDetailsService).passwordEncoder(passwordEncoder()); } @Bean @Override public AuthenticationManager authenticationManagerBean() throws Exception { return super.authenticationManagerBean(); } @Override protected void configure(HttpSecurity http) throws Exception { http.csrf().disable() .authorizeRequests().antMatchers(\u0026#34;/login\u0026#34;).permitAll() .anyRequest().authenticated() .and() .exceptionHandling().authenticationEntryPoint(authenticationEntryPoint) .and() .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS); http.addFilterBefore(filter, UsernamePasswordAuthenticationFilter.class); } } æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†æ‰€æœ‰è¿™äº›ï¼Œç°åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå·²å‡†å¤‡å°±ç»ªã€‚è®©æˆ‘ä»¬å¯åŠ¨åº”ç”¨ç¨‹åºå¹¶ä½¿ç”¨é‚®é€’å‘˜æ¥å‘å‡ºæˆ‘ä»¬çš„è¯·æ±‚ã€‚\nåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å‘å‡ºäº†ç¬¬ä¸€ä¸ªè·å–ä»¤ç‰Œçš„è¯·æ±‚ï¼Œæ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œåœ¨æä¾›æ­£ç¡®çš„ç”¨æˆ·å/å¯†ç ç»„åˆåï¼Œæˆ‘ä»¬å°†å–å›ä»¤ç‰Œã€‚\nç°åœ¨ï¼Œåœ¨æ ‡å¤´ä¸­ä½¿ç”¨è¯¥æ ‡è®°ï¼Œè®©æˆ‘ä»¬è°ƒç”¨ /hello ç«¯ç‚¹ã€‚\næ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œç”±äºè¯·æ±‚å·²é€šè¿‡èº«ä»½éªŒè¯ï¼Œæˆ‘ä»¬å¾—åˆ°äº†æ‰€éœ€çš„å“åº”ã€‚ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬ç¯¡æ”¹ä»¤ç‰Œæˆ–ä¸å‘é€ Authorization æ ‡å¤´ï¼Œæˆ‘ä»¬å°†æ”¶åˆ°åº”ç”¨ç¨‹åºä¸­é…ç½®çš„ 401 é”™è¯¯ã€‚è¿™ç¡®ä¿äº†ä½¿ç”¨ JWT ä¿æŠ¤æˆ‘ä»¬çš„è¯·æ±‚ã€‚\nåŸæ–‡é“¾æ¥ï¼šhttps://www.tutorialspoint.com/spring_security/spring_security_with_jwt.htm\n","permalink":"https://blog.chensoul.cc/posts/2023/08/16/spring-security-with-jwt/","summary":"ç®€ä»‹å’Œæ¦‚è¿° JSON Web Token æˆ– JWTï¼ˆæ›´å¸¸è§çš„åç§°ï¼‰æ˜¯ä¸€ç§å¼€æ”¾çš„äº’è”ç½‘æ ‡å‡† (RFC 7519)ï¼Œç”¨äºä»¥ç´§å‡‘çš„æ–¹å¼åœ¨å„æ–¹ä¹‹é—´å®‰å…¨åœ°ä¼ è¾“å¯ä¿¡ä¿¡æ¯ã€‚ä»¤ç‰ŒåŒ…å«ç¼–ç ä¸º JSON å¯¹è±¡çš„å£°æ˜ï¼Œå¹¶ä½¿ç”¨ç§æœ‰å¯†é’¥æˆ–å…¬é’¥/ç§é’¥å¯¹è¿›è¡Œæ•°å­—ç­¾åã€‚å®ƒä»¬æ˜¯ç‹¬ç«‹ä¸”å¯éªŒè¯çš„ï¼Œå› ä¸ºå®ƒä»¬ç»è¿‡æ•°å­—ç­¾åã€‚ JWT å¯ä»¥è¿›è¡Œç­¾åå’Œ/æˆ–åŠ å¯†ã€‚\nç­¾åçš„ä»¤ç‰ŒéªŒè¯ä»¤ç‰Œä¸­åŒ…å«çš„å£°æ˜çš„å®Œæ•´æ€§ï¼Œè€ŒåŠ å¯†çš„ä»¤ç‰Œåˆ™å‘å…¶ä»–æ–¹éšè—å£°æ˜ã€‚\nJWT ä¹Ÿå¯ç”¨äºä¿¡æ¯äº¤æ¢ï¼Œå°½ç®¡å®ƒä»¬æ›´å¸¸ç”¨äºæˆæƒï¼Œå› ä¸ºå®ƒä»¬æ¯”ä½¿ç”¨å†…å­˜ä¸­éšæœºä»¤ç‰Œçš„ä¼šè¯ç®¡ç†å…·æœ‰å¾ˆå¤šä¼˜åŠ¿ã€‚å…¶ä¸­æœ€é‡è¦çš„æ˜¯å…è®¸å°†èº«ä»½éªŒè¯é€»è¾‘å§”æ‰˜ç»™ç¬¬ä¸‰æ–¹æœåŠ¡å™¨ï¼Œä¾‹å¦‚ AuthO ç­‰ã€‚\nJWT ä»¤ç‰Œåˆ†ä¸º 3 éƒ¨åˆ†ï¼Œå³æ ‡å¤´ã€æœ‰æ•ˆè´Ÿè½½å’Œç­¾åï¼Œæ ¼å¼ä¸º\n[Header].[Payload].[Signature] Header âˆ’ JWT ä»¤ç‰Œçš„æ ‡å¤´åŒ…å«åº”ç”¨äº JWT çš„åŠ å¯†æ“ä½œåˆ—è¡¨ã€‚è¿™å¯ä»¥æ˜¯ç­¾åæŠ€æœ¯ã€æœ‰å…³å†…å®¹ç±»å‹çš„å…ƒæ•°æ®ä¿¡æ¯ç­‰ã€‚æ ‡å¤´ä»¥ JSON å¯¹è±¡çš„å½¢å¼å‘ˆç°ï¼Œè¯¥å¯¹è±¡è¢«ç¼–ç ä¸º base64URLã€‚æœ‰æ•ˆ JWT æ ‡å¤´çš„ç¤ºä¾‹æ˜¯ { \u0026#34;alg\u0026#34;: \u0026#34;HS256\u0026#34;, \u0026#34;typ\u0026#34;: \u0026#34;JWT\u0026#34; } è¿™é‡Œï¼Œâ€œalgâ€ä¸ºæˆ‘ä»¬æä¾›äº†æœ‰å…³æ‰€ç”¨ç®—æ³•ç±»å‹çš„ä¿¡æ¯ï¼Œâ€œtypâ€ä¸ºæˆ‘ä»¬æä¾›äº†ä¿¡æ¯çš„ç±»å‹ã€‚\nPayload âˆ’ JWT çš„æœ‰æ•ˆè´Ÿè½½éƒ¨åˆ†åŒ…å«ä½¿ç”¨ä»¤ç‰Œä¼ è¾“çš„å®é™…æ•°æ®ã€‚è¿™éƒ¨åˆ†ä¹Ÿç§°ä¸º JWT ä»¤ç‰Œçš„â€œå£°æ˜â€éƒ¨åˆ†ã€‚ç´¢èµ”å¯ä»¥åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼šæ³¨å†Œç´¢èµ”ã€å…¬å¼€ç´¢èµ”å’Œç§äººç´¢èµ”ã€‚ æ³¨å†Œçš„å£°æ˜æ˜¯æ¨èçš„ä½†ä¸æ˜¯å¼ºåˆ¶çš„å£°æ˜ï¼Œä¾‹å¦‚ iss(å‘è¡Œè€…)ã€sub(ä¸»é¢˜)ã€aud(å—ä¼—) ç­‰ã€‚ å…¬å…±å£°æ˜æ˜¯é‚£äº›ä½¿ç”¨ JWT çš„äººå®šä¹‰çš„å£°æ˜ã€‚ ç§äººå£°æ˜æˆ–è‡ªå®šä¹‰å£°æ˜æ˜¯ä¸ºäº†åœ¨ç›¸å…³æ–¹ä¹‹é—´å…±äº«ä¿¡æ¯è€Œåˆ›å»ºçš„ç”¨æˆ·å®šä¹‰çš„å£°æ˜ã€‚ æœ‰æ•ˆè´Ÿè½½å¯¹è±¡çš„ç¤ºä¾‹å¯ä»¥æ˜¯ã€‚\n{ \u0026#34;sub\u0026#34;: \u0026#34;12345\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;Johnny Hill\u0026#34;, \u0026#34;admin\u0026#34;: false } æœ‰æ•ˆè´Ÿè½½å¯¹è±¡ä¸æ ‡å¤´å¯¹è±¡ä¸€æ ·ï¼Œä¹Ÿé‡‡ç”¨ base64Url ç¼–ç ï¼Œå¹¶ä¸”è¯¥å­—ç¬¦ä¸²æ„æˆ JWT çš„ç¬¬äºŒéƒ¨åˆ†ã€‚\nSignatureâˆ’ JWT çš„ç­¾åéƒ¨åˆ†ç”¨äºéªŒè¯æ¶ˆæ¯åœ¨æ­¤è¿‡ç¨‹ä¸­æ²¡æœ‰æ›´æ”¹ã€‚å¦‚æœä»¤ç‰Œæ˜¯ç”¨ç§é’¥ç­¾åçš„ï¼Œå®ƒè¿˜ä¼šéªŒè¯å‘é€è€…çš„èº«ä»½ã€‚å®ƒæ˜¯ä½¿ç”¨ç¼–ç çš„æ ‡å¤´ã€ç¼–ç çš„æœ‰æ•ˆè´Ÿè½½ã€ç§˜å¯†å’Œæ ‡å¤´ä¸­æŒ‡å®šçš„ç®—æ³•åˆ›å»ºçš„ã€‚ç­¾åçš„ä¸€ä¸ªä¾‹å­æ˜¯ã€‚ HMACSHA256(base64UrlEncode(header) + \u0026#34;.\u0026#34; + base64UrlEncode(payload), secret); å¦‚æœæˆ‘ä»¬è¾“å…¥æ ‡å¤´ã€æœ‰æ•ˆè´Ÿè½½å’Œç­¾åï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªä»¤ç‰Œï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚\neyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6I kpvaG4gRG9lIiwiYWRtaW4iOmZhbHNlfQ.gWDlJdpCTIHVYKkJSfAVNUn0ZkAjMxskDDm-5Fhe WJ7xXgW8k5CllcGk4C9qPrfa1GdqfBrbX_1x1E39JY8BYLobAfAg1fs_Ky8Z7U1oCl6HL63yJq_ wVNBHp49hWzg3-ERxkqiuTv0tIuDOasIdZ5FtBdtIP5LM9Oc1tsuMXQXCGR8GqGf1Hl2qv8MCyn NZJuVdJKO_L3WGBJouaTpK1u2SEleVFGI2HFvrX_jS2ySzDxoO9KjbydK0LNv_zOI7kWv-gAmA j-v0mHdJrLbxD7LcZJEGRScCSyITzo6Z59_jG_97oNLFgBKJbh12nvvPibHpUYWmZuHkoGvuy5RLUA ç°åœ¨ï¼Œå¯ä»¥ä½¿ç”¨æ‰¿è½½æ¨¡å¼åœ¨æˆæƒæ ‡å¤´ä¸­ä½¿ç”¨æ­¤ä»¤ç‰Œã€‚\nAuthorization âˆ’ Bearer æˆæƒ - æŒæœ‰è€…\nä½¿ç”¨ JWT ä»¤ç‰Œè¿›è¡Œæˆæƒæ˜¯å…¶æœ€å¸¸è§çš„åº”ç”¨ã€‚ä»¤ç‰Œé€šå¸¸åœ¨æœåŠ¡å™¨ä¸­ç”Ÿæˆå¹¶å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œå¹¶å­˜å‚¨åœ¨ä¼šè¯å­˜å‚¨æˆ–æœ¬åœ°å­˜å‚¨ä¸­ã€‚è¦è®¿é—®å—ä¿æŠ¤çš„èµ„æºï¼Œå®¢æˆ·ç«¯å°†åœ¨æ ‡å¤´ä¸­å‘é€ JWTï¼Œå¦‚ä¸Šæ‰€è¿°ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹é¢çš„éƒ¨åˆ†ä¸­çœ‹åˆ° Spring Security ä¸­çš„ JWT å®ç°ã€‚","title":"[è¯‘]Spring Security - JWT"},{"content":"OAuth 2.0 åŸºç¡€çŸ¥è¯† OAuth 2.0 ç”± IETF OAuth å·¥ä½œç»„å¼€å‘å¹¶äº 2012 å¹´ 10 æœˆå‘å¸ƒã€‚å®ƒä½œä¸ºä¸€ç§å¼€æ”¾æˆæƒåè®®ï¼Œä½¿ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºèƒ½å¤Ÿä»£è¡¨èµ„æºæ‰€æœ‰è€…å¯¹ HTTP æœåŠ¡è¿›è¡Œæœ‰é™è®¿é—®ã€‚å®ƒå¯ä»¥åœ¨ä¸æ³„éœ²ç”¨æˆ·èº«ä»½æˆ–é•¿æœŸå‡­è¯çš„æƒ…å†µä¸‹åšåˆ°è¿™ä¸€ç‚¹ã€‚ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºæœ¬èº«ä¹Ÿå¯ä»¥ä»£è¡¨å…¶ä½¿ç”¨å®ƒã€‚\nOAuth çš„å·¥ä½œåŸç†åŒ…æ‹¬å°†ç”¨æˆ·èº«ä»½éªŒè¯å§”æ‰˜ç»™æ‰˜ç®¡ç”¨æˆ·å¸æˆ·çš„æœåŠ¡ï¼Œå¹¶æˆæƒç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºè®¿é—®ç”¨æˆ·çš„å¸æˆ·ã€‚\nè®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªä¾‹å­ã€‚å‡è®¾æˆ‘ä»¬è¦ç™»å½•ç½‘ç«™â€œclientsite.comâ€ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ Facebookã€Githubã€Google æˆ– Microsoft ç™»å½•ã€‚æˆ‘ä»¬é€‰æ‹©ä¸Šé¢ç»™å‡ºçš„é€‰é¡¹ä¸­çš„ä»»ä½•é€‰é¡¹ï¼Œç„¶åæˆ‘ä»¬å°†è¢«é‡å®šå‘åˆ°ç›¸åº”çš„ç½‘ç«™è¿›è¡Œç™»å½•ã€‚å¦‚æœç™»å½•æˆåŠŸï¼Œç³»ç»Ÿä¼šè¯¢é—®æˆ‘ä»¬æ˜¯å¦è¦æˆäºˆ clientsite.com è®¿é—®å…¶è¯·æ±‚çš„ç‰¹å®šæ•°æ®çš„æƒé™ã€‚\næˆ‘ä»¬é€‰æ‹©æ‰€éœ€çš„é€‰é¡¹ï¼Œç„¶åä½¿ç”¨æˆæƒä»£ç æˆ–é”™è¯¯ä»£ç é‡å®šå‘åˆ° clientsite.comï¼Œç™»å½•æ˜¯å¦æˆåŠŸå–å†³äºæˆ‘ä»¬åœ¨ç¬¬ä¸‰æ–¹èµ„æºä¸­çš„æ“ä½œã€‚è¿™å°±æ˜¯ OAuth 2 çš„åŸºæœ¬å·¥ä½œåŸç†ã€‚\nOAuth ç³»ç»Ÿæ¶‰åŠäº”ä¸ªå…³é”®è§’è‰²ã€‚è®©æˆ‘ä»¬æŠŠå®ƒä»¬åˆ—å‡ºæ¥ -\nUser / Resource Owner âˆ’ ç”¨æˆ·/èµ„æºæ‰€æœ‰è€…- æœ€ç»ˆç”¨æˆ·ï¼Œè´Ÿè´£èº«ä»½éªŒè¯å¹¶åŒæ„ä¸å®¢æˆ·ç«¯å…±äº«èµ„æºã€‚ User-Agent âˆ’ ç”¨æˆ·ä»£ç†- ç”¨æˆ·ä½¿ç”¨çš„æµè§ˆå™¨ã€‚ Client âˆ’ å®¢æˆ·ç«¯ - è¯·æ±‚è®¿é—®ä»¤ç‰Œçš„åº”ç”¨ç¨‹åºã€‚ Authorization Server âˆ’ æˆæƒæœåŠ¡å™¨- ç”¨äºéªŒè¯ç”¨æˆ·/å®¢æˆ·ç«¯çš„æœåŠ¡å™¨ã€‚å®ƒé¢å‘è®¿é—®ä»¤ç‰Œå¹¶åœ¨å…¶æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…å¯¹å…¶è¿›è¡Œè·Ÿè¸ªã€‚ Resource Server âˆ’ èµ„æºæœåŠ¡å™¨- æä¾›å¯¹æ‰€è¯·æ±‚èµ„æºçš„è®¿é—®çš„ APIã€‚å®ƒéªŒè¯è®¿é—®ä»¤ç‰Œå¹¶æä¾›æˆæƒã€‚ å…¥é—¨ æˆ‘ä»¬å°†ä½¿ç”¨ Spring Security å’Œ OAuth 2.0 å¼€å‘ä¸€ä¸ª Spring Boot åº”ç”¨ç¨‹åºæ¥è¯´æ˜ä¸Šè¿°å†…å®¹ã€‚æˆ‘ä»¬ç°åœ¨å°†å¼€å‘ä¸€ä¸ªå¸¦æœ‰å†…å­˜æ•°æ®åº“çš„åŸºæœ¬åº”ç”¨ç¨‹åºæ¥å­˜å‚¨ç”¨æˆ·å‡­æ®ã€‚è¯¥åº”ç”¨ç¨‹åºå°†ä½¿æˆ‘ä»¬è½»æ¾äº†è§£ OAuth 2.0 ä¸ Spring Security çš„å·¥ä½œåŸç†ã€‚\nè®©æˆ‘ä»¬ä½¿ç”¨ Spring åˆå§‹åŒ–ç¨‹åºåœ¨ Java 8 ä¸­åˆ›å»ºä¸€ä¸ª Maven é¡¹ç›®ã€‚è®©æˆ‘ä»¬ä» start.spring.io å¼€å§‹ã€‚æˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªå…·æœ‰ä»¥ä¸‹ä¾èµ–é¡¹çš„åº”ç”¨ç¨‹åº -\nSpring Web Spring Security Cloud OAuth2 Spring Boot Devtools é€šè¿‡ä¸Šé¢çš„é…ç½®ï¼Œæˆ‘ä»¬ç‚¹å‡» Generate æŒ‰é’®ç”Ÿæˆä¸€ä¸ªé¡¹ç›®ã€‚è¯¥é¡¹ç›®å°†ä»¥ zip æ–‡ä»¶å½¢å¼ä¸‹è½½ã€‚æˆ‘ä»¬å°† zip è§£å‹åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬é€‰æ‹©çš„ IDE ä¸­æ‰“å¼€è¯¥é¡¹ç›®ã€‚æˆ‘åœ¨è¿™é‡Œä½¿ç”¨ Spring Tools Suiteï¼Œå› ä¸ºå®ƒé’ˆå¯¹ Spring åº”ç”¨ç¨‹åºè¿›è¡Œäº†ä¼˜åŒ–ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦ä½¿ç”¨ Eclipse æˆ– IntelliJ Ideaã€‚\nå› æ­¤ï¼Œæˆ‘ä»¬åœ¨ STS ä¸­æ‰“å¼€é¡¹ç›®ï¼Œè®©ä¾èµ–é¡¹è¢«ä¸‹è½½ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥åœ¨åŒ…èµ„æºç®¡ç†å™¨çª—å£ä¸­çœ‹åˆ°é¡¹ç›®ç»“æ„ã€‚å®ƒåº”è¯¥ç±»ä¼¼äºä¸‹é¢çš„å±å¹•æˆªå›¾ã€‚\nå¦‚æœæˆ‘ä»¬æ‰“å¼€ pom.xml æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ä¸é¡¹ç›®ç›¸å…³çš„ä¾èµ–é¡¹å’Œå…¶ä»–è¯¦ç»†ä¿¡æ¯ã€‚å®ƒåº”è¯¥çœ‹èµ·æ¥åƒè¿™æ ·ã€‚\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;parent\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-parent\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.3.1.RELEASE\u0026lt;/version\u0026gt; \u0026lt;relativePath/\u0026gt; \u0026lt;!-- lookup parent from repository --\u0026gt; \u0026lt;/parent\u0026gt; \u0026lt;groupId\u0026gt;com.tutorial\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring.security.oauth2\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.0.1-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;name\u0026gt;spring.security.oauth2\u0026lt;/name\u0026gt; \u0026lt;description\u0026gt;Demo project for Spring Boot\u0026lt;/description\u0026gt; \u0026lt;properties\u0026gt; \u0026lt;java.version\u0026gt;1.8\u0026lt;/java.version\u0026gt; \u0026lt;spring-cloud.version\u0026gt;Hoxton.SR6\u0026lt;/spring-cloud.version\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-security\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-starter-oauth2\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-devtools\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;runtime\u0026lt;/scope\u0026gt; \u0026lt;optional\u0026gt;true\u0026lt;/optional\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-test\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;exclusions\u0026gt; \u0026lt;exclusion\u0026gt; \u0026lt;groupId\u0026gt;org.junit.vintage\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;junit-vintage-engine\u0026lt;/artifactId\u0026gt; \u0026lt;/exclusion\u0026gt; \u0026lt;/exclusions\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.security\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-security-test\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;dependencyManagement\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-dependencies\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${spring-cloud.version}\u0026lt;/version\u0026gt; \u0026lt;type\u0026gt;pom\u0026lt;/type\u0026gt; \u0026lt;scope\u0026gt;import\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/dependencyManagement\u0026gt;\u0026lt;build\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;/build\u0026gt; \u0026lt;/project\u0026gt; ç°åœ¨ï¼Œåœ¨æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„åŸºç¡€åŒ…ï¼ˆå³ com.tutorial.spring.security.oauth2ï¼‰ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªåä¸º config çš„æ–°åŒ…ï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä¸­æ·»åŠ é…ç½®ç±»ã€‚\nè®©æˆ‘ä»¬åˆ›å»ºç¬¬ä¸€ä¸ªé…ç½®ç±» UserConfigï¼Œå®ƒæ‰©å±•äº† Spring Security çš„ WebSecurityConfigurerAdapter ç±»æ¥ç®¡ç†å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºçš„ç”¨æˆ·ã€‚æˆ‘ä»¬ç»™è¿™ä¸ªç±»åŠ ä¸Š@Configuration æ³¨è§£ï¼Œå‘Šè¯‰ Spring å®ƒæ˜¯ä¸€ä¸ªé…ç½®ç±»ã€‚\npackage com.tutorial.spring.security.oauth2.config; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.authentication.AuthenticationManager; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter; import org.springframework.security.core.userdetails.User; import org.springframework.security.core.userdetails.UserDetails; import org.springframework.security.core.userdetails.UserDetailsService; import org.springframework.security.crypto.password.NoOpPasswordEncoder; import org.springframework.security.crypto.password.PasswordEncoder; import org.springframework.security.provisioning.InMemoryUserDetailsManager; import org.springframework.security.provisioning.UserDetailsManager; @Configuration public class UserConfig extends WebSecurityConfigurerAdapter { @Bean public UserDetailsService userDetailsService() { UserDetailsManager userDetailsManager = new InMemoryUserDetailsManager(); UserDetails user = User.withUsername(\u0026#34;john\u0026#34;) .password(\u0026#34;12345\u0026#34;) .authorities(\u0026#34;read\u0026#34;) .build(); userDetailsManager.createUser(user); return userDetailsManager; } @Bean public PasswordEncoder passwordEncoder() { return NoOpPasswordEncoder.getInstance(); } @Override @Bean public AuthenticationManager authenticationManagerBean() throws Exception { return super.authenticationManagerBean(); } } ç„¶åï¼Œæˆ‘ä»¬æ·»åŠ  UserDetailsSâ€‹â€‹ervice çš„ bean æ¥æ£€ç´¢ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ä»¥è¿›è¡Œèº«ä»½ â€‹â€‹ éªŒè¯å’Œæˆæƒã€‚ä¸ºäº†å°†å…¶æ”¾å…¥ Spring ä¸Šä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬ç”¨ @Bean å¯¹å…¶è¿›è¡Œæ³¨é‡Šã€‚ä¸ºäº†ä½¿æœ¬æ•™ç¨‹ç®€å•æ˜“æ‡‚ï¼Œæˆ‘ä»¬ä½¿ç”¨ InMemoryUserDetailsManager å®ä¾‹ã€‚å¯¹äºå®é™…åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…¶ä»–å®ç°ï¼Œä¾‹å¦‚ JdbcUserDetailsManager æ¥è¿æ¥åˆ°æ•°æ®åº“ç­‰ã€‚ä¸ºäº†èƒ½å¤Ÿåœ¨æ­¤ç¤ºä¾‹ä¸­è½»æ¾åˆ›å»ºç”¨æˆ·ï¼Œæˆ‘ä»¬ä½¿ç”¨ UserDetailsManager æ¥å£ï¼Œè¯¥æ¥å£æ‰©å±•äº† UserDetailsSâ€‹â€‹ervice å¹¶å…·æœ‰ createUser()ã€updateUser() ç­‰æ–¹æ³•ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨æ„å»ºå™¨ç±»åˆ›å»ºä¸€ä¸ªç”¨æˆ·ã€‚æˆ‘ä»¬ç°åœ¨ç»™ä»–ä¸€ä¸ªç”¨æˆ·åã€å¯†ç å’Œâ€œè¯»å–â€æƒé™ã€‚ç„¶åï¼Œä½¿ç”¨ createUser() æ–¹æ³•æ·»åŠ æ–°åˆ›å»ºçš„ç”¨æˆ·å¹¶è¿”å› UserDetailsManager å®ä¾‹ï¼Œä»è€Œå°†å…¶æ”¾å…¥ Spring ä¸Šä¸‹æ–‡ä¸­ã€‚\nä¸ºäº†èƒ½å¤Ÿä½¿ç”¨æˆ‘ä»¬å®šä¹‰çš„ UserDetailsSâ€‹â€‹erviceï¼Œæœ‰å¿…è¦åœ¨ Spring ä¸Šä¸‹æ–‡ä¸­æä¾›ä¸€ä¸ª PasswordEncoder beanã€‚å†æ¬¡å¼ºè°ƒï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬ç°åœ¨ä½¿ç”¨ NoOpPasswordEncoderã€‚ NoOpPasswordEncoder ä¸åº”è¯¥ç”¨äºå®é™…ç”Ÿäº§åº”ç”¨ç¨‹åºï¼Œå› ä¸ºå®ƒä¸å®‰å…¨ã€‚ NoOpPasswordEncoder ä¸ä¼šå¯¹å¯†ç è¿›è¡Œç¼–ç ï¼Œä»…é€‚ç”¨äºå¼€å‘æˆ–æµ‹è¯•åœºæ™¯æˆ–æ¦‚å¿µè¯æ˜ã€‚\næˆ‘ä»¬åº”è¯¥å§‹ç»ˆä½¿ç”¨ Spring Security æä¾›çš„å…¶ä»–é«˜åº¦å®‰å…¨çš„é€‰é¡¹ï¼Œå…¶ä¸­æœ€æµè¡Œçš„æ˜¯ BCryptPasswordEncoderï¼Œæˆ‘ä»¬å°†åœ¨åé¢çš„ç³»åˆ—æ•™ç¨‹ä¸­ä½¿ç”¨å®ƒã€‚ä¸ºäº†å°†å…¶æ”¾å…¥ Spring ä¸Šä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ @Bean æ³¨é‡Šè¯¥æ–¹æ³•ã€‚\nç„¶åï¼Œæˆ‘ä»¬é‡å†™ WebSecurityConfigurerAdapter çš„ AuthenticationManager bean æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å› authenticationManagerBean ä»¥å°†èº«ä»½éªŒè¯ç®¡ç†å™¨æ”¾å…¥ Spring ä¸Šä¸‹æ–‡ä¸­ã€‚\nç°åœ¨ï¼Œä¸ºäº†æ·»åŠ å®¢æˆ·ç«¯é…ç½®ï¼Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªåä¸º AuthorizationServerConfig çš„æ–°é…ç½®ç±»ï¼Œå®ƒæ‰©å±•äº† Spring Security çš„ AuthorizationServerConfigurerAdapter ç±»ã€‚ AuthorizationServerConfigurerAdapter ç±»ç”¨äºä½¿ç”¨ spring security oauth2 æ¨¡å—é…ç½®æˆæƒæœåŠ¡å™¨ã€‚æˆ‘ä»¬ä¹Ÿç”¨@Configuration æ³¨é‡Šè¿™ä¸ªç±»ã€‚è¦å°†æˆæƒæœåŠ¡å™¨åŠŸèƒ½æ·»åŠ åˆ°æ­¤ç±»ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ  @EnableAuthorizationServer æ³¨é‡Šï¼Œä»¥ä¾¿åº”ç”¨ç¨‹åºå¯ä»¥å……å½“æˆæƒæœåŠ¡å™¨ã€‚\npackage com.tutorial.spring.security.oauth2.config; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.context.annotation.Configuration; import org.springframework.security.authentication.AuthenticationManager; import org.springframework.security.oauth2.config.annotation.configurers.ClientDetailsServiceConfigurer; import org.springframework.security.oauth2.config.annotation.web.configuration.AuthorizationServerConfigurerAdapter; import org.springframework.security.oauth2.config.annotation.web.configuration.EnableAuthorizationServer; import org.springframework.security.oauth2.config.annotation.web.configurers.AuthorizationServerEndpointsConfigurer; @Configuration @EnableAuthorizationServer public class AuthorizationServerConfig extends AuthorizationServerConfigurerAdapter { @Autowired private AuthenticationManager authenticationManager; @Override public void configure(ClientDetailsServiceConfigurer clients) throws Exception { clients.inMemory() .withClient(\u0026#34;oauthclient1\u0026#34;) .secret(\u0026#34;oauthsecret1\u0026#34;) .scopes(\u0026#34;read\u0026#34;) .authorizedGrantTypes(\u0026#34;password\u0026#34;) } @Override public void configure(AuthorizationServerEndpointsConfigurer endpoints) throws Exception { endpoints.authenticationManager(authenticationManager); } } ä¸ºäº†æ£€æŸ¥ oauth ä»¤ç‰Œï¼ŒSpring Security oauth å…¬å¼€ä¸¤ä¸ªç«¯ç‚¹ - /oauth/check_token å’Œ /oauth/token_keyã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›ç«¯ç‚¹åœ¨ denyAll() åé¢å—åˆ°ä¿æŠ¤ã€‚ tokenKeyAccess() å’Œ checkTokenAccess() æ–¹æ³•æ‰“å¼€è¿™äº›ç«¯ç‚¹ä»¥ä¾›ä½¿ç”¨ã€‚\næˆ‘ä»¬å°†åœ¨ UserConfig ç±»ä¸­é…ç½®çš„ AuthenticationManager bean è‡ªåŠ¨è£…é…ä¸ºæ­¤å¤„çš„ä¾èµ–é¡¹ï¼Œç¨åæˆ‘ä»¬å°†ä½¿ç”¨å®ƒã€‚\nç„¶åï¼Œæˆ‘ä»¬é‡å†™ AuthorizationServerConfigurerAdapter çš„ä¸¤ä¸ª configure() æ–¹æ³•ï¼Œä»¥æä¾›å®¢æˆ·ç«¯è¯¦ç»†ä¿¡æ¯æœåŠ¡çš„å†…å­˜ä¸­å®ç°ã€‚ç¬¬ä¸€ç§æ–¹æ³•ä½¿ç”¨ ClientDetailsSâ€‹â€‹erviceConfigurer ä½œä¸ºå‚æ•°ï¼Œé¡¾åæ€ä¹‰ï¼Œå…è®¸æˆ‘ä»¬ä¸ºæˆæƒæœåŠ¡å™¨é…ç½®å®¢æˆ·ç«¯ã€‚è¿™äº›å®¢æˆ·ç«¯ä»£è¡¨èƒ½å¤Ÿä½¿ç”¨è¯¥æˆæƒæœåŠ¡å™¨åŠŸèƒ½çš„åº”ç”¨ç¨‹åºã€‚ç”±äºè¿™æ˜¯å­¦ä¹  OAuth2 å®ç°çš„åŸºæœ¬åº”ç”¨ç¨‹åºï¼Œå› æ­¤æˆ‘ä»¬ç°åœ¨å°†ä¿æŒç®€å•å¹¶ä½¿ç”¨å…·æœ‰ä»¥ä¸‹å±æ€§çš„å†…å­˜ä¸­å®ç° -\nclientId âˆ’ å®¢æˆ·ç«¯çš„ IDã€‚å¿…éœ€çš„ã€‚ secret âˆ’ å®¢æˆ·ç«¯å¯†ç ï¼Œå—ä¿¡ä»»çš„å®¢æˆ·ç«¯æ‰€éœ€ scope âˆ’ èŒƒå›´ - å®¢æˆ·ç«¯çš„é™åˆ¶èŒƒå›´ï¼Œæ¢å¥è¯è¯´ï¼Œå®¢æˆ·ç«¯æƒé™ã€‚å¦‚æœç•™ç©ºæˆ–æœªå®šä¹‰ï¼Œåˆ™å®¢æˆ·ç«¯ä¸å—ä»»ä½•èŒƒå›´çš„é™åˆ¶ã€‚ authorizedGrantTypes âˆ’ å®¢æˆ·ç«¯è¢«æˆæƒä½¿ç”¨çš„æˆæƒç±»å‹ã€‚ grant type è¡¨ç¤ºå®¢æˆ·ç«¯ä»æˆæƒæœåŠ¡å™¨è·å– token çš„æ–¹å¼ã€‚æˆ‘ä»¬å°†ä½¿ç”¨â€œå¯†ç â€æˆäºˆç±»å‹ï¼Œå› ä¸ºå®ƒæ˜¯æœ€ç®€å•çš„ã€‚ç¨åï¼Œæˆ‘ä»¬å°†é’ˆå¯¹å¦ä¸€ä¸ªç”¨ä¾‹ä½¿ç”¨å¦ä¸€ç§æˆæƒç±»å‹ã€‚ åœ¨â€œå¯†ç â€æˆæƒæˆäºˆç±»å‹ä¸­ï¼Œç”¨æˆ·éœ€è¦å‘æˆ‘ä»¬çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºæä¾›ä»–/å¥¹çš„ç”¨æˆ·åã€å¯†ç å’ŒèŒƒå›´ï¼Œç„¶åå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä½¿ç”¨è¿™äº›å‡­æ®ä»¥åŠæˆ‘ä»¬æƒ³è¦ä»ä¸­è·å–ä»¤ç‰Œçš„æˆæƒæœåŠ¡å™¨çš„å‡­æ®ã€‚\næˆ‘ä»¬é‡å†™çš„å¦ä¸€ä¸ª configure()æ–¹æ³•ä½¿ç”¨ AuthorizationServerEndpointsConfigurer ä½œä¸ºå‚æ•°ï¼Œç”¨äºå°† AuthenticationManager é™„åŠ åˆ°æˆæƒæœåŠ¡å™¨é…ç½®ã€‚\né€šè¿‡è¿™äº›åŸºæœ¬é…ç½®ï¼Œæˆ‘ä»¬çš„æˆæƒæœåŠ¡å™¨å°±å¯ä»¥ä½¿ç”¨äº†ã€‚è®©æˆ‘ä»¬ç»§ç»­å¯åŠ¨å¹¶ä½¿ç”¨å®ƒã€‚æˆ‘ä»¬å°†ä½¿ç”¨ Postman (h ttps://www.postman.com/downloads/) æ¥æå‡ºæˆ‘ä»¬çš„è¯·æ±‚ã€‚\nä½¿ç”¨ STS æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¯åŠ¨åº”ç”¨ç¨‹åºå¹¶å¼€å§‹åœ¨æ§åˆ¶å°ä¸­æŸ¥çœ‹æ—¥å¿—ã€‚å½“åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ§åˆ¶å°ä¸­æ‰¾åˆ°åº”ç”¨ç¨‹åºå…¬å¼€çš„ oauth2 ç«¯ç‚¹ã€‚åœ¨è¿™äº›ç«¯ç‚¹ä¸­ï¼Œæˆ‘ä»¬ç°åœ¨å°†ä½¿ç”¨ä»¥ä¸‹ä»¤ç‰Œ -\n/oauth/token â€“ ç”¨äºè·å–ä»¤ç‰Œã€‚\nå¦‚æœæˆ‘ä»¬æ£€æŸ¥è¿™é‡Œçš„é‚®é€’å‘˜å¿«ç…§ï¼Œæˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°ä¸€äº›äº‹æƒ…ã€‚è®©æˆ‘ä»¬åœ¨ä¸‹é¢åˆ—å‡ºå®ƒä»¬ã€‚\nURL - æˆ‘ä»¬çš„ Spring Boot åº”ç”¨ç¨‹åºåœ¨æœ¬åœ°è®¡ç®—æœºçš„ç«¯å£ 8080 ä¸Šè¿è¡Œï¼Œå› æ­¤è¯·æ±‚æŒ‡å‘ http://localhost:8080ã€‚æ¥ä¸‹æ¥çš„éƒ¨åˆ†æ˜¯ /oauth/tokenï¼Œæˆ‘ä»¬çŸ¥é“å®ƒæ˜¯ OAuth å…¬å¼€çš„ç”¨äºç”Ÿæˆä»¤ç‰Œçš„ç«¯ç‚¹ã€‚ æŸ¥è¯¢å‚æ•° - ç”±äºè¿™æ˜¯â€œå¯†ç â€æˆæƒæˆäºˆç±»å‹ï¼Œå› æ­¤ç”¨æˆ·éœ€è¦å‘æˆ‘ä»¬çš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºæä¾›ä»–/å¥¹çš„ç”¨æˆ·åã€å¯†ç å’ŒèŒƒå›´ï¼Œç„¶åå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä½¿ç”¨è¿™äº›å‡­æ®åŠå…¶å‡­æ®å‘é€ç»™æˆ‘ä»¬æƒ³è¦ä»¤ç‰Œçš„æˆæƒæœåŠ¡å™¨ä»ã€‚ å®¢æˆ·ç«¯æˆæƒ- Oauth ç³»ç»Ÿè¦æ±‚å®¢æˆ·ç«¯è·å¾—æˆæƒæ‰èƒ½æä¾›ä»¤ç‰Œã€‚å› æ­¤ï¼Œåœ¨æˆæƒæ ‡å¤´ä¸‹ï¼Œæˆ‘ä»¬æä¾›å®¢æˆ·ç«¯èº«ä»½éªŒè¯ä¿¡æ¯ï¼Œå³æˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åºä¸­é…ç½®çš„ç”¨æˆ·åå’Œå¯†ç ã€‚ è®©æˆ‘ä»¬ä»”ç»†çœ‹çœ‹æŸ¥è¯¢å‚æ•°å’Œæˆæƒæ ‡å¤´ -\næŸ¥è¯¢å‚æ•°\nå®¢æˆ·å‡­è¯\nå¦‚æœä¸€åˆ‡æ­£ç¡®ï¼Œæˆ‘ä»¬å°†èƒ½å¤Ÿåœ¨å“åº”ä¸­çœ‹åˆ°ç”Ÿæˆçš„ä»¤ç‰Œä»¥åŠ 200 ok çŠ¶æ€ã€‚\nå“åº”\næˆ‘ä»¬å¯ä»¥é€šè¿‡è¾“å…¥é”™è¯¯çš„å‡­æ®æˆ–ä¸è¾“å…¥å‡­æ®æ¥æµ‹è¯•æˆ‘ä»¬çš„æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å°†æ”¶åˆ°ä¸€ä¸ªé”™è¯¯ï¼Œè¡¨æ˜è¯·æ±‚æœªç»æˆæƒæˆ–å‡­æ®é”™è¯¯ã€‚\nè¿™æ˜¯æˆ‘ä»¬çš„åŸºæœ¬ oauth æˆæƒæœåŠ¡å™¨ï¼Œå®ƒä½¿ç”¨å¯†ç æˆäºˆç±»å‹æ¥ç”Ÿæˆå¹¶æä¾›å¯†ç ã€‚\næ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬å®ç°ä¸€ä¸ªæ›´å®‰å…¨ã€æ›´å¸¸è§çš„ oauth2 èº«ä»½éªŒè¯åº”ç”¨ï¼Œå³ä½¿ç”¨æˆæƒç æˆäºˆç±»å‹ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†æ›´æ–°å½“å‰çš„åº”ç”¨ç¨‹åºã€‚\næˆæƒæˆäºˆç±»å‹ä¸å¯†ç æˆäºˆç±»å‹ä¸åŒï¼Œå› ä¸ºç”¨æˆ·ä¸å¿…ä¸å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå…±äº«å…¶å‡­æ®ã€‚ä»–ä»…ä¸æˆæƒæœåŠ¡å™¨å…±äº«å®ƒä»¬ï¼Œä½œä¸ºå›æŠ¥ï¼Œæˆæƒä»£ç è¢«å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œç”¨äºå¯¹å®¢æˆ·ç«¯è¿›è¡Œèº«ä»½éªŒè¯ã€‚å®ƒæ¯”å¯†ç æˆäºˆç±»å‹æ›´å®‰å…¨ï¼Œå› ä¸ºç”¨æˆ·å‡­æ®ä¸ä¸å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå…±äº«ï¼Œå› æ­¤ç”¨æˆ·çš„ä¿¡æ¯ä¿æŒå®‰å…¨ã€‚\né™¤éå¾—åˆ°ç”¨æˆ·çš„æ‰¹å‡†ï¼Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºæ— æ³•è®¿é—®ä»»ä½•é‡è¦çš„ç”¨æˆ·ä¿¡æ¯ã€‚\né€šè¿‡å‡ ä¸ªç®€å•çš„æ­¥éª¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­è®¾ç½®ä¸€ä¸ªå…·æœ‰æˆæƒæˆäºˆç±»å‹çš„åŸºæœ¬ oauth æœåŠ¡å™¨ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ã€‚\npackage com.tutorial.spring.security.oauth2.config; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.context.annotation.Configuration; import org.springframework.security.authentication.AuthenticationManager; import org.springframework.security.oauth2.config.annotation.configurers.ClientDetailsServiceConfigurer; import org.springframework.security.oauth2.config.annotation.web.configuration.AuthorizationServerConfigurerAdapter; import org.springframework.security.oauth2.config.annotation.web.configuration.EnableAuthorizationServer; import org.springframework.security.oauth2.config.annotation.web.configurers.AuthorizationServerEndpointsConfigurer; @Configuration @EnableAuthorizationServer public class AuthorizationServerConfig extends AuthorizationServerConfigurerAdapter { @Autowired private AuthenticationManager authenticationManager; @Override public void configure(ClientDetailsServiceConfigurer clients) throws Exception { clients.inMemory() .withClient(\u0026#34;oauthclient1\u0026#34;) .secret(\u0026#34;oauthsecret1\u0026#34;) .scopes(\u0026#34;read\u0026#34;) .authorizedGrantTypes(\u0026#34;password\u0026#34;) .and() .withClient(\u0026#34;oauthclient2\u0026#34;) .secret(\u0026#34;oauthsecret2\u0026#34;) .scopes(\u0026#34;read\u0026#34;) .authorizedGrantTypes(\u0026#34;authorization_code\u0026#34;) .redirectUris(\u0026#34;http://locahost:9090\u0026#34;); } @Override public void configure(AuthorizationServerEndpointsConfigurer endpoints) throws Exception { endpoints.authenticationManager(authenticationManager); } } è®©æˆ‘ä»¬ä¸ºæ­¤æ“ä½œæ·»åŠ ç¬¬äºŒä¸ªå®¢æˆ·ç«¯ oauthclient2ï¼Œå¹¶ä½¿ç”¨æ–°çš„å¯†é’¥å’Œè¯»å–èŒƒå›´ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å·²å°†æ­¤å®¢æˆ·ç«¯çš„æˆæƒç±»å‹æ›´æ”¹ä¸ºæˆæƒä»£ç ã€‚æˆ‘ä»¬è¿˜æ·»åŠ äº†é‡å®šå‘ URIï¼Œä»¥ä¾¿æˆæƒæœåŠ¡å™¨å¯ä»¥å›è°ƒå®¢æˆ·ç«¯ã€‚å› æ­¤ï¼ŒåŸºæœ¬ä¸Šé‡å®šå‘ URI å°±æ˜¯å®¢æˆ·ç«¯çš„ URIã€‚\nç°åœ¨ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨ç”¨æˆ·å’ŒæˆæƒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹è¿æ¥ã€‚æˆ‘ä»¬å¿…é¡»ä¸ºæˆæƒæœåŠ¡å™¨è®¾ç½®ä¸€ä¸ªæ¥å£ï¼Œç”¨æˆ·å¯ä»¥åœ¨å…¶ä¸­æä¾›å‡­æ®ã€‚æˆ‘ä»¬ä½¿ç”¨ Spring Security çš„ formLogin() å®ç°æ¥å®ç°è¯¥åŠŸèƒ½ï¼ŒåŒæ—¶ä¿æŒç®€å•ã€‚æˆ‘ä»¬è¿˜ç¡®ä¿æ‰€æœ‰è¯·æ±‚éƒ½ç»è¿‡èº«ä»½éªŒè¯ã€‚\npackage com.tutorial.spring.security.oauth2.config; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.authentication.AuthenticationManager; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter; import org.springframework.security.core.userdetails.User; import org.springframework.security.core.userdetails.UserDetails; import org.springframework.security.core.userdetails.UserDetailsService; import org.springframework.security.crypto.password.NoOpPasswordEncoder; import org.springframework.security.crypto.password.PasswordEncoder; import org.springframework.security.provisioning.InMemoryUserDetailsManager; import org.springframework.security.provisioning.UserDetailsManager; @SuppressWarnings(\u0026#34;deprecation\u0026#34;) @Configuration public class UserConfig extends WebSecurityConfigurerAdapter { @Bean public UserDetailsService userDetailsService() { UserDetailsManager userDetailsManager = new InMemoryUserDetailsManager(); UserDetails user = User.withUsername(\u0026#34;john\u0026#34;) .password(\u0026#34;12345\u0026#34;) .authorities(\u0026#34;read\u0026#34;) .build(); userDetailsManager.createUser(user); return userDetailsManager; } @Bean public PasswordEncoder passwordEncoder() { return NoOpPasswordEncoder.getInstance(); } @Override @Bean public AuthenticationManager authenticationManagerBean() throws Exception { return super.authenticationManagerBean(); } @Override protected void configure(HttpSecurity http) throws Exception { http.formLogin(); http.authorizeRequests().anyRequest().authenticated(); } } è¿™å°±å®Œæˆäº†æˆ‘ä»¬å¯¹æˆæƒæˆäºˆç±»å‹çš„è®¾ç½®ã€‚ç°åœ¨æµ‹è¯•æˆ‘ä»¬çš„è®¾ç½®å¹¶å¯åŠ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬åœ¨ http://localhost:8080/oauth/authorize?response_type=code\u0026amp;client_id=oauthclient2\u0026amp;scope=read å¯åŠ¨æµè§ˆå™¨ã€‚æˆ‘ä»¬å°†é‡å®šå‘åˆ° Spring Security çš„é»˜è®¤è¡¨å•ç™»å½•é¡µé¢ã€‚\nè¿™é‡Œï¼Œå“åº”ç±»å‹ä»£ç æ„å‘³ç€æˆæƒæœåŠ¡å™¨å°†è¿”å›ä¸€ä¸ªè®¿é—®ä»£ç ï¼Œå®¢æˆ·ç«¯å°†ä½¿ç”¨è¯¥è®¿é—®ä»£ç è¿›è¡Œç™»å½•ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ç”¨æˆ·å‡­æ®æ—¶ï¼Œæˆ‘ä»¬å°†è¢«è¯¢é—®æ˜¯å¦è¦æˆäºˆå®¢æˆ·ç«¯è¯·æ±‚çš„æƒé™ï¼Œåœ¨ç±»ä¼¼çš„å±å¹•å¦‚ä¸‹æ‰€ç¤ºã€‚\nå¦‚æœæˆ‘ä»¬æ‰¹å‡†å¹¶å•å‡»â€œæˆæƒâ€ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°æˆ‘ä»¬è¢«é‡å®šå‘åˆ°ç»™å®šçš„é‡å®šå‘ URL ä»¥åŠè®¿é—®ä»£ç ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è¢«é‡å®šå‘åˆ° http://locahost:9090/?code=7Hibnwï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åºä¸­æŒ‡å®šçš„é‚£æ ·ã€‚æˆ‘ä»¬ç°åœ¨å¯ä»¥ä½¿ç”¨è¯¥ä»£ç ä½œä¸º Postman ä¸­çš„å®¢æˆ·ç«¯æ¥ç™»å½•æˆæƒæœåŠ¡å™¨ã€‚\næ­£å¦‚æˆ‘ä»¬åœ¨è¿™é‡Œæ‰€çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬åœ¨ URL ä¸­ä½¿ç”¨äº†ä»æˆæƒæœåŠ¡å™¨æ”¶åˆ°çš„ä»£ç ï¼Œå¹¶ä¸” grant_type ä½œä¸ºæˆæƒä»£ç ï¼ŒèŒƒå›´ä½œä¸ºè¯»å–ã€‚æˆ‘ä»¬å……å½“å®¢æˆ·ç«¯å¹¶æä¾›åº”ç”¨ç¨‹åºä¸­é…ç½®çš„å®¢æˆ·ç«¯å‡­æ®ã€‚å½“æˆ‘ä»¬å‘å‡ºè¿™ä¸ªè¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥ä½¿ç”¨çš„ access_tokenã€‚\næˆ‘ä»¬å·²ç»äº†è§£äº†å¦‚ä½•ä½¿ç”¨ OAuth 2.0 é…ç½® Spring Securityã€‚è¯¥åº”ç”¨ç¨‹åºéå¸¸ç®€å•ä¸”æ˜“äºç†è§£ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç›¸å½“è½»æ¾åœ°ç†è§£è¯¥è¿‡ç¨‹ã€‚æˆ‘ä»¬ä½¿ç”¨äº†ä¸¤ç§æˆæƒæˆäºˆç±»å‹ï¼Œå¹¶äº†è§£äº†å¦‚ä½•ä½¿ç”¨å®ƒä»¬æ¥è·å–å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºçš„è®¿é—®ä»¤ç‰Œã€‚\nåŸæ–‡é“¾æ¥ï¼šhttps://www.tutorialspoint.com/spring_security/spring_security_with_oauth2.htm\n","permalink":"https://blog.chensoul.cc/posts/2023/08/16/spring-security-with-oauth2/","summary":"OAuth 2.0 åŸºç¡€çŸ¥è¯† OAuth 2.0 ç”± IETF OAuth å·¥ä½œç»„å¼€å‘å¹¶äº 2012 å¹´ 10 æœˆå‘å¸ƒã€‚å®ƒä½œä¸ºä¸€ç§å¼€æ”¾æˆæƒåè®®ï¼Œä½¿ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºèƒ½å¤Ÿä»£è¡¨èµ„æºæ‰€æœ‰è€…å¯¹ HTTP æœåŠ¡è¿›è¡Œæœ‰é™è®¿é—®ã€‚å®ƒå¯ä»¥åœ¨ä¸æ³„éœ²ç”¨æˆ·èº«ä»½æˆ–é•¿æœŸå‡­è¯çš„æƒ…å†µä¸‹åšåˆ°è¿™ä¸€ç‚¹ã€‚ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºæœ¬èº«ä¹Ÿå¯ä»¥ä»£è¡¨å…¶ä½¿ç”¨å®ƒã€‚\nOAuth çš„å·¥ä½œåŸç†åŒ…æ‹¬å°†ç”¨æˆ·èº«ä»½éªŒè¯å§”æ‰˜ç»™æ‰˜ç®¡ç”¨æˆ·å¸æˆ·çš„æœåŠ¡ï¼Œå¹¶æˆæƒç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºè®¿é—®ç”¨æˆ·çš„å¸æˆ·ã€‚\nè®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªä¾‹å­ã€‚å‡è®¾æˆ‘ä»¬è¦ç™»å½•ç½‘ç«™â€œclientsite.comâ€ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ Facebookã€Githubã€Google æˆ– Microsoft ç™»å½•ã€‚æˆ‘ä»¬é€‰æ‹©ä¸Šé¢ç»™å‡ºçš„é€‰é¡¹ä¸­çš„ä»»ä½•é€‰é¡¹ï¼Œç„¶åæˆ‘ä»¬å°†è¢«é‡å®šå‘åˆ°ç›¸åº”çš„ç½‘ç«™è¿›è¡Œç™»å½•ã€‚å¦‚æœç™»å½•æˆåŠŸï¼Œç³»ç»Ÿä¼šè¯¢é—®æˆ‘ä»¬æ˜¯å¦è¦æˆäºˆ clientsite.com è®¿é—®å…¶è¯·æ±‚çš„ç‰¹å®šæ•°æ®çš„æƒé™ã€‚\næˆ‘ä»¬é€‰æ‹©æ‰€éœ€çš„é€‰é¡¹ï¼Œç„¶åä½¿ç”¨æˆæƒä»£ç æˆ–é”™è¯¯ä»£ç é‡å®šå‘åˆ° clientsite.comï¼Œç™»å½•æ˜¯å¦æˆåŠŸå–å†³äºæˆ‘ä»¬åœ¨ç¬¬ä¸‰æ–¹èµ„æºä¸­çš„æ“ä½œã€‚è¿™å°±æ˜¯ OAuth 2 çš„åŸºæœ¬å·¥ä½œåŸç†ã€‚\nOAuth ç³»ç»Ÿæ¶‰åŠäº”ä¸ªå…³é”®è§’è‰²ã€‚è®©æˆ‘ä»¬æŠŠå®ƒä»¬åˆ—å‡ºæ¥ -\nUser / Resource Owner âˆ’ ç”¨æˆ·/èµ„æºæ‰€æœ‰è€…- æœ€ç»ˆç”¨æˆ·ï¼Œè´Ÿè´£èº«ä»½éªŒè¯å¹¶åŒæ„ä¸å®¢æˆ·ç«¯å…±äº«èµ„æºã€‚ User-Agent âˆ’ ç”¨æˆ·ä»£ç†- ç”¨æˆ·ä½¿ç”¨çš„æµè§ˆå™¨ã€‚ Client âˆ’ å®¢æˆ·ç«¯ - è¯·æ±‚è®¿é—®ä»¤ç‰Œçš„åº”ç”¨ç¨‹åºã€‚ Authorization Server âˆ’ æˆæƒæœåŠ¡å™¨- ç”¨äºéªŒè¯ç”¨æˆ·/å®¢æˆ·ç«¯çš„æœåŠ¡å™¨ã€‚å®ƒé¢å‘è®¿é—®ä»¤ç‰Œå¹¶åœ¨å…¶æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…å¯¹å…¶è¿›è¡Œè·Ÿè¸ªã€‚ Resource Server âˆ’ èµ„æºæœåŠ¡å™¨- æä¾›å¯¹æ‰€è¯·æ±‚èµ„æºçš„è®¿é—®çš„ APIã€‚å®ƒéªŒè¯è®¿é—®ä»¤ç‰Œå¹¶æä¾›æˆæƒã€‚ å…¥é—¨ æˆ‘ä»¬å°†ä½¿ç”¨ Spring Security å’Œ OAuth 2.0 å¼€å‘ä¸€ä¸ª Spring Boot åº”ç”¨ç¨‹åºæ¥è¯´æ˜ä¸Šè¿°å†…å®¹ã€‚æˆ‘ä»¬ç°åœ¨å°†å¼€å‘ä¸€ä¸ªå¸¦æœ‰å†…å­˜æ•°æ®åº“çš„åŸºæœ¬åº”ç”¨ç¨‹åºæ¥å­˜å‚¨ç”¨æˆ·å‡­æ®ã€‚è¯¥åº”ç”¨ç¨‹åºå°†ä½¿æˆ‘ä»¬è½»æ¾äº†è§£ OAuth 2.0 ä¸ Spring Security çš„å·¥ä½œåŸç†ã€‚\nè®©æˆ‘ä»¬ä½¿ç”¨ Spring åˆå§‹åŒ–ç¨‹åºåœ¨ Java 8 ä¸­åˆ›å»ºä¸€ä¸ª Maven é¡¹ç›®ã€‚è®©æˆ‘ä»¬ä» start.spring.io å¼€å§‹ã€‚æˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªå…·æœ‰ä»¥ä¸‹ä¾èµ–é¡¹çš„åº”ç”¨ç¨‹åº -\nSpring Web Spring Security Cloud OAuth2 Spring Boot Devtools é€šè¿‡ä¸Šé¢çš„é…ç½®ï¼Œæˆ‘ä»¬ç‚¹å‡» Generate æŒ‰é’®ç”Ÿæˆä¸€ä¸ªé¡¹ç›®ã€‚è¯¥é¡¹ç›®å°†ä»¥ zip æ–‡ä»¶å½¢å¼ä¸‹è½½ã€‚æˆ‘ä»¬å°† zip è§£å‹åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬é€‰æ‹©çš„ IDE ä¸­æ‰“å¼€è¯¥é¡¹ç›®ã€‚æˆ‘åœ¨è¿™é‡Œä½¿ç”¨ Spring Tools Suiteï¼Œå› ä¸ºå®ƒé’ˆå¯¹ Spring åº”ç”¨ç¨‹åºè¿›è¡Œäº†ä¼˜åŒ–ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦ä½¿ç”¨ Eclipse æˆ– IntelliJ Ideaã€‚","title":"[è¯‘]Spring Security - OAuth2"},{"content":"å†…å®¹ ç®€ä»‹å’Œæ¦‚è¿° å…¥é—¨ï¼ˆå®ç”¨æŒ‡å—ï¼‰ ç®€ä»‹å’Œæ¦‚è¿° Spring Security é™„å¸¦äº†å¤§é‡å†…ç½®åŠŸèƒ½å’Œå·¥å…·ï¼Œä¸ºæˆ‘ä»¬æä¾›æ–¹ä¾¿ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå…¶ä¸­ä¸‰ä¸ªæœ‰è¶£ä¸”æœ‰ç”¨çš„åŠŸèƒ½ -\nè¡¨å•ç™»å½• è®°ä½è´¦å· ç™»å‡º è¡¨å•ç™»å½• åŸºäºè¡¨å•çš„ç™»å½•æ˜¯ Spring Security æä¾›æ”¯æŒçš„ä¸€ç§ç”¨æˆ·å/å¯†ç èº«ä»½éªŒè¯å½¢å¼ã€‚è¿™æ˜¯é€šè¿‡ Html è¡¨å•æä¾›çš„ã€‚\næ¯å½“ç”¨æˆ·è¯·æ±‚å—ä¿æŠ¤çš„èµ„æºæ—¶ï¼ŒSpring Security éƒ½ä¼šæ£€æŸ¥è¯·æ±‚çš„èº«ä»½éªŒè¯ã€‚å¦‚æœè¯·æ±‚æœªç»è¿‡èº«ä»½éªŒè¯/æˆæƒï¼Œç”¨æˆ·å°†è¢«é‡å®šå‘åˆ°ç™»å½•é¡µé¢ã€‚ç™»å½•é¡µé¢å¿…é¡»ç”±åº”ç”¨ç¨‹åºä»¥æŸç§æ–¹å¼å‘ˆç°ã€‚ Spring Security é»˜è®¤æä¾›è¯¥ç™»å½•è¡¨å•ã€‚\næ­¤å¤–ï¼Œå¦‚æœéœ€è¦ï¼Œä»»ä½•å…¶ä»–é…ç½®éƒ½å¿…é¡»æ˜ç¡®æä¾›ï¼Œå¦‚ä¸‹æ‰€ç¤º -\nprotected void configure(HttpSecurity http) throws Exception { http // ... .formLogin( form -\u0026gt; form.loginPage(\u0026#34;/login\u0026#34;) .permitAll() ); } æ­¤ä»£ç è¦æ±‚æ¨¡æ¿æ–‡ä»¶å¤¹ä¸­å­˜åœ¨ä¸€ä¸ª login.html æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°†åœ¨ç‚¹å‡» /login æ—¶è¿”å›ã€‚è¯¥ HTML æ–‡ä»¶åº”åŒ…å«ä¸€ä¸ªç™»å½•è¡¨å•ã€‚æ­¤å¤–ï¼Œè¯¥è¯·æ±‚åº”è¯¥æ˜¯å¯¹ /login çš„ post è¯·æ±‚ã€‚å‚æ•°åç§°åº”åˆ†åˆ«ä¸ºç”¨æˆ·åå’Œå¯†ç çš„â€œusernameâ€å’Œâ€œpasswordâ€ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¡¨å•ä¸­è¿˜éœ€è¦åŒ…å« CSRF ä»¤ç‰Œã€‚\nä¸€æ—¦æˆ‘ä»¬å®Œæˆäº†ä»£ç ç»ƒä¹ ï¼Œä¸Šé¢çš„ä»£ç ç‰‡æ®µå°±ä¼šæ›´åŠ æ¸…æ™°ã€‚\nè®°ä½è´¦å· è¿™ç§ç±»å‹çš„èº«ä»½éªŒè¯éœ€è¦å°†è®°ä½æˆ‘çš„ cookie å‘é€åˆ°æµè§ˆå™¨ã€‚è¯¥ cookie å­˜å‚¨ç”¨æˆ·ä¿¡æ¯/èº«ä»½éªŒè¯ä¸»ä½“ï¼Œå¹¶å­˜å‚¨åœ¨æµè§ˆå™¨ä¸­ã€‚å› æ­¤ï¼Œç½‘ç«™å¯ä»¥åœ¨ä¸‹æ¬¡ä¼šè¯å¯åŠ¨æ—¶è®°ä½ç”¨æˆ·çš„èº«ä»½ã€‚ Spring Security å·²ä¸ºæ­¤æ“ä½œå‡†å¤‡äº†å¿…è¦çš„å®ç°ã€‚\nä¸€ç§ä½¿ç”¨æ•£åˆ—æ¥ä¿æŠ¤åŸºäº cookie çš„ä»¤ç‰Œçš„å®‰å…¨æ€§ï¼Œè€Œå¦ä¸€ç§ä½¿ç”¨æ•°æ®åº“æˆ–å…¶ä»–æŒä¹…å­˜å‚¨æœºåˆ¶æ¥å­˜å‚¨ç”Ÿæˆçš„ä»¤ç‰Œã€‚\nç™»å‡º é»˜è®¤ URL /logout é€šè¿‡ä»¥ä¸‹æ–¹å¼æ³¨é”€ç”¨æˆ·ï¼š\nä½¿ HTTP ä¼šè¯å¤±æ•ˆ æ¸…é™¤é…ç½®çš„æ‰€æœ‰ RememberMe èº«ä»½éªŒè¯ æ¸…é™¤ SecurityContextHolder é‡å®šå‘åˆ°/login?logout WebSecurityConfigurerAdapter è‡ªåŠ¨å°†æ³¨é”€åŠŸèƒ½åº”ç”¨äº Spring Boot åº”ç”¨ç¨‹åºã€‚\nGetting Started (Practical Guide) åƒå¾€å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬é¦–å…ˆè®¿é—® start.spring.ioã€‚è¿™é‡Œæˆ‘ä»¬é€‰æ‹©ä¸€ä¸ª maven é¡¹ç›®ã€‚æˆ‘ä»¬å°†é¡¹ç›®å‘½åä¸ºâ€œformloginâ€å¹¶é€‰æ‹©æ‰€éœ€çš„ Java ç‰ˆæœ¬ã€‚æˆ‘åœ¨æ­¤ç¤ºä¾‹ä¸­é€‰æ‹© Java 8ã€‚æˆ‘ä»¬è¿˜ç»§ç»­æ·»åŠ ä»¥ä¸‹ä¾èµ–é¡¹ -\nSpring Web Spring Security Thymeleaf Spring Boot DevTools Thymeleaf æ˜¯ Java çš„æ¨¡æ¿å¼•æ“ã€‚å®ƒå…è®¸æˆ‘ä»¬å¿«é€Ÿå¼€å‘é™æ€æˆ–åŠ¨æ€ç½‘é¡µä»¥åœ¨æµè§ˆå™¨ä¸­å‘ˆç°ã€‚å®ƒå…·æœ‰æå¼ºçš„å¯æ‰©å±•æ€§ï¼Œå…è®¸æˆ‘ä»¬è¯¦ç»†å®šä¹‰å’Œè‡ªå®šä¹‰æ¨¡æ¿çš„å¤„ç†ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ç‚¹å‡»æ­¤é“¾æ¥äº†è§£æœ‰å…³ Thymeleaf çš„æ›´å¤šä¿¡æ¯ã€‚\nè®©æˆ‘ä»¬ç»§ç»­ç”Ÿæˆé¡¹ç›®å¹¶ä¸‹è½½å®ƒã€‚ç„¶åï¼Œæˆ‘ä»¬å°†å…¶è§£å‹åˆ°æˆ‘ä»¬é€‰æ‹©çš„æ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶ä½¿ç”¨ä»»ä½• IDE å°†å…¶æ‰“å¼€ã€‚æˆ‘å°†ä½¿ç”¨ Spring Tools Suite 4ã€‚å®ƒå¯ä»¥ä» https://spring.io/tools ç½‘ç«™å…è´¹ä¸‹è½½ï¼Œå¹¶ä¸”é’ˆå¯¹ Spring åº”ç”¨ç¨‹åºè¿›è¡Œäº†ä¼˜åŒ–ã€‚\nè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ pom.xml æ–‡ä»¶ã€‚å®ƒåº”è¯¥çœ‹èµ·æ¥ä¸æ­¤ç±»ä¼¼ -\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;parent\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-parent\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.3.1.RELEASE\u0026lt;/version\u0026gt; \u0026lt;relativePath /\u0026gt; \u0026lt;!-- lookup parent from repository --\u0026gt; \u0026lt;/parent\u0026gt; \u0026lt;groupId\u0026gt; com.spring.security\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;formlogin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.0.1-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;name\u0026gt;formlogin\u0026lt;/name\u0026gt; \u0026lt;description\u0026gt;Demo project for Spring Boot\u0026lt;/description\u0026gt; \u0026lt;properties\u0026gt; \u0026lt;java.version\u0026gt;1.8\u0026lt;/java.version\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-security\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-thymeleaf\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-devtools\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-test\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;exclusions\u0026gt; \u0026lt;exclusion\u0026gt; \u0026lt;groupId\u0026gt;org.junit.vintage\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;junit-vintage-engine\u0026lt;/artifactId\u0026gt; \u0026lt;/exclusion\u0026gt; \u0026lt;/exclusions\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.security\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-security-test\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;build\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;/build\u0026gt; \u0026lt;/project\u0026gt; è®©æˆ‘ä»¬åœ¨é»˜è®¤åŒ…ä¸‹çš„æ–‡ä»¶å¤¹ /src/main/java ä¸­åˆ›å»ºä¸€ä¸ªåŒ…ã€‚æˆ‘ä»¬å°†å…¶å‘½åä¸º configï¼Œå› ä¸ºæˆ‘ä»¬ä¼šå°†æ‰€æœ‰é…ç½®ç±»æ”¾ç½®åœ¨è¿™é‡Œã€‚å› æ­¤ï¼Œåç§°åº”è¯¥ç±»ä¼¼äº - com.tutorial.spring.security.formlogin.configã€‚\né…ç½®ç±» package com.tutorial.spring.security.formlogin.config; import java.util.List; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter; import org.springframework.security.core.userdetails.User; import org.springframework.security.core.userdetails.UserDetails; import org.springframework.security.core.userdetails.UserDetailsService; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; import org.springframework.security.crypto.password.NoOpPasswordEncoder; import org.springframework.security.crypto.password.PasswordEncoder; import org.springframework.security.provisioning.InMemoryUserDetailsManager; import org.springframework.security.provisioning.UserDetailsManager; import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter; import org.springframework.security.web.util.matcher.AntPathRequestMatcher; import com.spring.security.formlogin.AuthFilter; @Configuration public class WebSecurityConfig extends WebSecurityConfigurerAdapter { @Bean protected UserDetailsService userDetailsService() { UserDetailsManager userDetailsManager = new InMemoryUserDetailsManager(); UserDetails user = User.withUsername(\u0026#34;abby\u0026#34;) .password(passwordEncoder().encode(\u0026#34;12345\u0026#34;)) .authorities(\u0026#34;read\u0026#34;) .build(); userDetailsManager.createUser(user); return userDetailsManager; } @Bean public PasswordEncoder passwordEncoder() { return new BCryptPasswordEncoder(); }; @Override protected void configure(HttpSecurity http) throws Exception { http.csrf().disable() .authorizeRequests().anyRequest() .authenticated() .and() .formLogin() .and() .rememberMe() .and() .logout() .logoutUrl(\u0026#34;/logout\u0026#34;) .logoutSuccessUrl(\u0026#34;/login\u0026#34;) .deleteCookies(\u0026#34;remember-me\u0026#34;); } } ä»£ç åˆ†è§£ åœ¨æˆ‘ä»¬çš„é…ç½®åŒ…ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº† WebSecurityConfig ç±»ã€‚è¯¥ç±»æ‰©å±•äº† Spring Security çš„ WebSecurityConfigurerAdapterã€‚æˆ‘ä»¬å°†ä½¿ç”¨æ­¤ç±»è¿›è¡Œå®‰å…¨é…ç½®ï¼Œå› æ­¤è®©æˆ‘ä»¬ç”¨ @Configuration æ³¨é‡Šæ¥æ³¨é‡Šå®ƒã€‚å› æ­¤ï¼ŒSpring Security çŸ¥é“å°†æ­¤ç±»è§†ä¸ºé…ç½®ç±»ã€‚æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼ŒSpring ä½¿åº”ç”¨ç¨‹åºçš„é…ç½®å˜å¾—éå¸¸å®¹æ˜“ã€‚\nè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æˆ‘ä»¬çš„é…ç½®ç±»ã€‚\né¦–å…ˆï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ userDetailsSâ€‹â€‹ervice() æ–¹æ³•åˆ›å»º UserDetailsSâ€‹â€‹ervice ç±»çš„ beanã€‚æˆ‘ä»¬å°†ä½¿ç”¨æ­¤ bean æ¥ç®¡ç†æ­¤åº”ç”¨ç¨‹åºçš„ç”¨æˆ·ã€‚åœ¨è¿™é‡Œï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ InMemoryUserDetailsManager å®ä¾‹æ¥åˆ›å»ºç”¨æˆ·ã€‚è¯¥ç”¨æˆ·ä»¥åŠæˆ‘ä»¬ç»™å®šçš„ç”¨æˆ·åå’Œå¯†ç å°†åŒ…å«ä¸€ä¸ªç®€å•çš„â€œè¯»å–â€æƒé™ã€‚ ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬çš„å¯†ç ç¼–ç å™¨ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ BCryptPasswordEncoder å®ä¾‹ã€‚å› æ­¤ï¼Œåœ¨åˆ›å»ºç”¨æˆ·æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ passwordEncoder å¯¹æˆ‘ä»¬çš„æ˜æ–‡å¯†ç è¿›è¡Œç¼–ç ï¼Œå¦‚ä¸‹æ‰€ç¤º .password(passwordEncoder().encode(\u0026#34;12345\u0026#34;)) å®Œæˆä¸Šè¿°æ­¥éª¤åï¼Œæˆ‘ä»¬ç»§ç»­è¿›è¡Œä¸‹ä¸€ä¸ªé…ç½®ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬é‡å†™ WebSecurityConfigurerAdapter ç±»çš„ configure æ–¹æ³•ã€‚è¯¥æ–¹æ³•å°† HttpSecurity ä½œä¸ºå‚æ•°ã€‚æˆ‘ä»¬å°†å¯¹å…¶è¿›è¡Œé…ç½®ä»¥ä½¿ç”¨æˆ‘ä»¬çš„è¡¨å•ç™»å½•å’Œæ³¨é”€ä»¥åŠè®°ä½æˆ‘åŠŸèƒ½ã€‚ HTTP å®‰å…¨é…ç½® æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°æ‰€æœ‰è¿™äº›åŠŸèƒ½åœ¨ Spring Security ä¸­éƒ½å¯ç”¨ã€‚è®©æˆ‘ä»¬è¯¦ç»†ç ”ç©¶ä»¥ä¸‹éƒ¨åˆ† -\nhttp.csrf().disable() .authorizeRequests().anyRequest().authenticated() .and() .formLogin() .and() .rememberMe() .and() .logout() .logoutUrl(\u0026#34;/logout\u0026#34;) .logoutSuccessUrl(\u0026#34;/login\u0026#34;) .deleteCookies(\u0026#34;remember-me\u0026#34;); è¿™é‡Œæœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ -\næˆ‘ä»¬å·²ç»ç¦ç”¨äº† csrf æˆ–è·¨ç«™ç‚¹è¯·æ±‚ä¼ªé€ ä¿æŠ¤ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªä»…ç”¨äºæ¼”ç¤ºç›®çš„çš„ç®€å•åº”ç”¨ç¨‹åºï¼Œæ‰€ä»¥æˆ‘ä»¬ç°åœ¨å¯ä»¥å®‰å…¨åœ°ç¦ç”¨å®ƒã€‚\nç„¶åæˆ‘ä»¬æ·»åŠ éœ€è¦å¯¹æ‰€æœ‰è¯·æ±‚è¿›è¡Œèº«ä»½éªŒè¯çš„é…ç½®ã€‚æ­£å¦‚æˆ‘ä»¬ç¨åå°†çœ‹åˆ°çš„ï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†ä¸ºæ­¤åº”ç”¨ç¨‹åºçš„ç´¢å¼•é¡µä½¿ç”¨ä¸€ä¸ªâ€œ/â€ç«¯ç‚¹ã€‚\nä¹‹åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸Šé¢æåˆ°çš„ Spring Security çš„ formLogin() åŠŸèƒ½ã€‚è¿™ä¼šç”Ÿæˆä¸€ä¸ªç®€å•çš„ç™»å½•é¡µé¢ã€‚\nç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ Spring Security çš„ RememberMe() åŠŸèƒ½ã€‚è¿™å°†æ‰§è¡Œä¸¤ä»¶äº‹ã€‚\né¦–å…ˆï¼Œå®ƒä¼šåœ¨æˆ‘ä»¬ä½¿ç”¨ formLogin() ç”Ÿæˆçš„é»˜è®¤ç™»å½•è¡¨å•ä¸­æ·»åŠ ä¸€ä¸ªâ€œè®°ä½æˆ‘â€å¤é€‰æ¡†ã€‚ å…¶æ¬¡ï¼Œå‹¾é€‰å¤é€‰æ¡†ä¼šç”Ÿæˆè®°ä½æˆ‘çš„ cookieã€‚ cookie å­˜å‚¨ç”¨æˆ·çš„èº«ä»½ï¼Œæµè§ˆå™¨å­˜å‚¨å®ƒã€‚ Spring Security åœ¨å°†æ¥çš„ä¼šè¯ä¸­æ£€æµ‹ cookie ä»¥è‡ªåŠ¨ç™»å½•ã€‚å› æ­¤ï¼Œç”¨æˆ·æ— éœ€å†æ¬¡ç™»å½•å³å¯å†æ¬¡è®¿é—®è¯¥åº”ç”¨ç¨‹åºã€‚ æœ€åï¼Œæˆ‘ä»¬æœ‰ logout() åŠŸèƒ½ã€‚ä¸ºæ­¤ï¼ŒSpring security ä¹Ÿæä¾›äº†é»˜è®¤åŠŸèƒ½ã€‚å®ƒåœ¨è¿™é‡Œæ‰§è¡Œä¸¤ä¸ªé‡è¦çš„åŠŸèƒ½ -\nä½¿ Http ä¼šè¯æ— æ•ˆï¼Œå¹¶å–æ¶ˆç»‘å®šåˆ°ä¼šè¯çš„å¯¹è±¡ã€‚ å®ƒä¼šæ¸…é™¤â€œè®°ä½æˆ‘â€cookieã€‚ ä» Spring çš„å®‰å…¨ä¸Šä¸‹æ–‡ä¸­åˆ é™¤èº«ä»½éªŒè¯ã€‚ æˆ‘ä»¬è¿˜æä¾›äº†ä¸€ä¸ª logoutSuccessUrl()ï¼Œä»¥ä¾¿åº”ç”¨ç¨‹åºåœ¨æ³¨é”€åè¿”å›åˆ°ç™»å½•é¡µé¢ã€‚è¿™æ ·å°±å®Œæˆäº†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºé…ç½®ã€‚\nå—ä¿æŠ¤çš„å†…å®¹ï¼ˆå¯é€‰ï¼‰ æˆ‘ä»¬ç°åœ¨å°†åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç´¢å¼•é¡µé¢ï¼Œä¾›ç”¨æˆ·ç™»å½•æ—¶æŸ¥çœ‹ã€‚å®ƒè¿˜å°†åŒ…å«ä¸€ä¸ªæ³¨é”€æŒ‰é’®ã€‚\nåœ¨æˆ‘ä»¬çš„/src/main/resources/templates ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ª index.html æ–‡ä»¶ã€‚ç„¶åå‘å…¶ä¸­æ·»åŠ ä¸€äº› Html å†…å®¹ã€‚\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;!-- Required meta tags --\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34; /\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1, shrink-to-fit=no\u0026#34; /\u0026gt; \u0026lt;!-- Bootstrap CSS --\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css\u0026#34; integrity=\u0026#34;sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Hello, world!\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;Hello, world!\u0026lt;/h1\u0026gt; \u0026lt;a href=\u0026#34;logout\u0026#34;\u0026gt;logout\u0026lt;/a\u0026gt; \u0026lt;!-- Optional JavaScript --\u0026gt; \u0026lt;!-- jQuery first, then Popper.js, then Bootstrap JS --\u0026gt; \u0026lt;script src=\u0026#34;https://code.jquery.com/jquery-3.5.1.slim.min.js\u0026#34; integrity=\u0026#34;sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; \u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js\u0026#34; integrity=\u0026#34;sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; \u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js\u0026#34; integrity=\u0026#34;sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; \u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; æ­¤å†…å®¹æ¥è‡ª Bootstrap 4 å…¥é—¨æ¨¡æ¿ã€‚\næˆ‘ä»¬è¿˜æ·»åŠ \n\u0026lt;a href=\u0026#34;logout\u0026#34;\u0026gt;logout\u0026lt;/a\u0026gt; åˆ°æˆ‘ä»¬çš„æ–‡ä»¶ï¼Œä»¥ä¾¿ç”¨æˆ·å¯ä»¥ä½¿ç”¨æ­¤é“¾æ¥æ³¨é”€åº”ç”¨ç¨‹åºã€‚\nèµ„æºæ§åˆ¶å™¨ æˆ‘ä»¬å·²ç»åˆ›å»ºäº†å—ä¿æŠ¤çš„èµ„æºï¼Œç°åœ¨æ·»åŠ æ§åˆ¶å™¨æ¥æœåŠ¡è¯¥èµ„æºã€‚\npackage com.tutorial.spring.security.formlogin.controllers; import org.springframework.stereotype.Controller; import org.springframework.web.bind.annotation.GetMapping; @Controller public class AuthController { @GetMapping(\u0026#34;/\u0026#34;) public String home() { return \u0026#34;index\u0026#34;; } } æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„æ§åˆ¶å™¨ã€‚å®ƒåªæœ‰ä¸€ä¸ª get ç«¯ç‚¹ï¼Œåœ¨å¯åŠ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ—¶ä¸ºæˆ‘ä»¬çš„ index.html æ–‡ä»¶æä¾›æœåŠ¡ã€‚\nè¿è¡Œåº”ç”¨ç¨‹åº è®©æˆ‘ä»¬å°†åº”ç”¨ç¨‹åºä½œä¸º Spring Boot åº”ç”¨ç¨‹åºè¿è¡Œã€‚å½“åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨ä¸Šè®¿é—® http://localhost:8080ã€‚å®ƒåº”è¯¥è¦æ±‚æˆ‘ä»¬æä¾›ç”¨æˆ·åå’Œå¯†ç ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°â€œè®°ä½æˆ‘â€å¤é€‰æ¡†ã€‚\nç™»å½•é¡µé¢ ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬æä¾›åœ¨ WebSecurity é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„ç”¨æˆ·ä¿¡æ¯ï¼Œæˆ‘ä»¬å°†èƒ½å¤Ÿç™»å½•ã€‚æ­¤å¤–ï¼Œå¦‚æœæˆ‘ä»¬å‹¾é€‰â€œè®°ä½æˆ‘â€å¤é€‰æ¡†ï¼Œæˆ‘ä»¬å°†èƒ½å¤Ÿåœ¨æˆ‘ä»¬çš„ WebSecurity é…ç½®æ–‡ä»¶ä¸­çœ‹åˆ°â€œè®°ä½æˆ‘â€cookie æµè§ˆå™¨çš„å¼€å‘è€…å·¥å…·éƒ¨åˆ†ã€‚\næ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œcookie æ˜¯ä¸æˆ‘ä»¬çš„ç™»å½•è¯·æ±‚ä¸€èµ·å‘é€çš„ã€‚\næ­¤å¤–ï¼Œç½‘é¡µä¸­è¿˜åŒ…å«ä¸€ä¸ªç”¨äºæ³¨é”€çš„é“¾æ¥ã€‚å•å‡»è¯¥é“¾æ¥åï¼Œæˆ‘ä»¬å°†é€€å‡ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¹¶è¿”å›åˆ°æˆ‘ä»¬çš„ç™»å½•é¡µé¢ã€‚\nåŸæ–‡é“¾æ¥ï¼šhttps://www.tutorialspoint.com/spring_security/spring_security_form_login_remember_me_and_logout.htm\n","permalink":"https://blog.chensoul.cc/posts/2023/08/16/spring-security-form-login-remember-me-and-logout/","summary":"å†…å®¹ ç®€ä»‹å’Œæ¦‚è¿° å…¥é—¨ï¼ˆå®ç”¨æŒ‡å—ï¼‰ ç®€ä»‹å’Œæ¦‚è¿° Spring Security é™„å¸¦äº†å¤§é‡å†…ç½®åŠŸèƒ½å’Œå·¥å…·ï¼Œä¸ºæˆ‘ä»¬æä¾›æ–¹ä¾¿ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå…¶ä¸­ä¸‰ä¸ªæœ‰è¶£ä¸”æœ‰ç”¨çš„åŠŸèƒ½ -\nè¡¨å•ç™»å½• è®°ä½è´¦å· ç™»å‡º è¡¨å•ç™»å½• åŸºäºè¡¨å•çš„ç™»å½•æ˜¯ Spring Security æä¾›æ”¯æŒçš„ä¸€ç§ç”¨æˆ·å/å¯†ç èº«ä»½éªŒè¯å½¢å¼ã€‚è¿™æ˜¯é€šè¿‡ Html è¡¨å•æä¾›çš„ã€‚\næ¯å½“ç”¨æˆ·è¯·æ±‚å—ä¿æŠ¤çš„èµ„æºæ—¶ï¼ŒSpring Security éƒ½ä¼šæ£€æŸ¥è¯·æ±‚çš„èº«ä»½éªŒè¯ã€‚å¦‚æœè¯·æ±‚æœªç»è¿‡èº«ä»½éªŒè¯/æˆæƒï¼Œç”¨æˆ·å°†è¢«é‡å®šå‘åˆ°ç™»å½•é¡µé¢ã€‚ç™»å½•é¡µé¢å¿…é¡»ç”±åº”ç”¨ç¨‹åºä»¥æŸç§æ–¹å¼å‘ˆç°ã€‚ Spring Security é»˜è®¤æä¾›è¯¥ç™»å½•è¡¨å•ã€‚\næ­¤å¤–ï¼Œå¦‚æœéœ€è¦ï¼Œä»»ä½•å…¶ä»–é…ç½®éƒ½å¿…é¡»æ˜ç¡®æä¾›ï¼Œå¦‚ä¸‹æ‰€ç¤º -\nprotected void configure(HttpSecurity http) throws Exception { http // ... .formLogin( form -\u0026gt; form.loginPage(\u0026#34;/login\u0026#34;) .permitAll() ); } æ­¤ä»£ç è¦æ±‚æ¨¡æ¿æ–‡ä»¶å¤¹ä¸­å­˜åœ¨ä¸€ä¸ª login.html æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°†åœ¨ç‚¹å‡» /login æ—¶è¿”å›ã€‚è¯¥ HTML æ–‡ä»¶åº”åŒ…å«ä¸€ä¸ªç™»å½•è¡¨å•ã€‚æ­¤å¤–ï¼Œè¯¥è¯·æ±‚åº”è¯¥æ˜¯å¯¹ /login çš„ post è¯·æ±‚ã€‚å‚æ•°åç§°åº”åˆ†åˆ«ä¸ºç”¨æˆ·åå’Œå¯†ç çš„â€œusernameâ€å’Œâ€œpasswordâ€ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¡¨å•ä¸­è¿˜éœ€è¦åŒ…å« CSRF ä»¤ç‰Œã€‚\nä¸€æ—¦æˆ‘ä»¬å®Œæˆäº†ä»£ç ç»ƒä¹ ï¼Œä¸Šé¢çš„ä»£ç ç‰‡æ®µå°±ä¼šæ›´åŠ æ¸…æ™°ã€‚\nè®°ä½è´¦å· è¿™ç§ç±»å‹çš„èº«ä»½éªŒè¯éœ€è¦å°†è®°ä½æˆ‘çš„ cookie å‘é€åˆ°æµè§ˆå™¨ã€‚è¯¥ cookie å­˜å‚¨ç”¨æˆ·ä¿¡æ¯/èº«ä»½éªŒè¯ä¸»ä½“ï¼Œå¹¶å­˜å‚¨åœ¨æµè§ˆå™¨ä¸­ã€‚å› æ­¤ï¼Œç½‘ç«™å¯ä»¥åœ¨ä¸‹æ¬¡ä¼šè¯å¯åŠ¨æ—¶è®°ä½ç”¨æˆ·çš„èº«ä»½ã€‚ Spring Security å·²ä¸ºæ­¤æ“ä½œå‡†å¤‡äº†å¿…è¦çš„å®ç°ã€‚\nä¸€ç§ä½¿ç”¨æ•£åˆ—æ¥ä¿æŠ¤åŸºäº cookie çš„ä»¤ç‰Œçš„å®‰å…¨æ€§ï¼Œè€Œå¦ä¸€ç§ä½¿ç”¨æ•°æ®åº“æˆ–å…¶ä»–æŒä¹…å­˜å‚¨æœºåˆ¶æ¥å­˜å‚¨ç”Ÿæˆçš„ä»¤ç‰Œã€‚\nç™»å‡º é»˜è®¤ URL /logout é€šè¿‡ä»¥ä¸‹æ–¹å¼æ³¨é”€ç”¨æˆ·ï¼š\nä½¿ HTTP ä¼šè¯å¤±æ•ˆ æ¸…é™¤é…ç½®çš„æ‰€æœ‰ RememberMe èº«ä»½éªŒè¯ æ¸…é™¤ SecurityContextHolder é‡å®šå‘åˆ°/login?logout WebSecurityConfigurerAdapter è‡ªåŠ¨å°†æ³¨é”€åŠŸèƒ½åº”ç”¨äº Spring Boot åº”ç”¨ç¨‹åºã€‚\nGetting Started (Practical Guide) åƒå¾€å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬é¦–å…ˆè®¿é—® start.spring.ioã€‚è¿™é‡Œæˆ‘ä»¬é€‰æ‹©ä¸€ä¸ª maven é¡¹ç›®ã€‚æˆ‘ä»¬å°†é¡¹ç›®å‘½åä¸ºâ€œformloginâ€å¹¶é€‰æ‹©æ‰€éœ€çš„ Java ç‰ˆæœ¬ã€‚æˆ‘åœ¨æ­¤ç¤ºä¾‹ä¸­é€‰æ‹© Java 8ã€‚æˆ‘ä»¬è¿˜ç»§ç»­æ·»åŠ ä»¥ä¸‹ä¾èµ–é¡¹ -","title":"[è¯‘]Spring Security - è¡¨å•ç™»å½•ã€è®°ä½æˆ‘å’Œæ³¨é”€"},{"content":"å†…å®¹ ç®€ä»‹å’Œæ¦‚è¿° Spring Security çš„åŸºæœ¬ç»„ä»¶ AuthenticationFilter è®¤è¯è¿‡æ»¤å™¨ AuthenticationManager è®¤è¯ç®¡ç†å™¨ AuthenticationProvider è®¤è¯æä¾›è€… UserDetailsService ç”¨æˆ·è¯¦æƒ…æœåŠ¡ PasswordEncoder å¯†ç ç¼–ç å™¨ Spring å®‰å…¨ä¸Šä¸‹æ–‡ è¡¨å•ç™»å½• ä½¿ç”¨æ•°æ®åº“ç™»å½• ç™»å½•å°è¯•é™åˆ¶ å…¥é—¨ï¼ˆå®ç”¨æŒ‡å—ï¼‰ ç®€ä»‹å’Œæ¦‚è¿° é™¤äº†æä¾›å„ç§å†…ç½®çš„èº«ä»½éªŒè¯å’Œæˆæƒé€‰é¡¹ä¹‹å¤–ï¼ŒSpring Security è¿˜å…è®¸æˆ‘ä»¬æ ¹æ®éœ€è¦è‡ªå®šä¹‰èº«ä»½éªŒè¯è¿‡ç¨‹ã€‚ä»è‡ªå®šä¹‰ç™»å½•é¡µé¢åˆ°æˆ‘ä»¬è‡ªå·±çš„è‡ªå®šä¹‰èº«ä»½éªŒè¯æä¾›ç¨‹åºå’Œèº«ä»½éªŒè¯è¿‡æ»¤å™¨ï¼Œæˆ‘ä»¬å‡ ä¹å¯ä»¥è‡ªå®šä¹‰èº«ä»½éªŒè¯è¿‡ç¨‹çš„å„ä¸ªæ–¹é¢ã€‚\næˆ‘ä»¬å¯ä»¥å®šä¹‰è‡ªå·±çš„èº«ä»½éªŒè¯è¿‡ç¨‹ï¼ŒèŒƒå›´å¯ä»¥ä»ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç çš„åŸºæœ¬èº«ä»½éªŒè¯åˆ°å¤æ‚çš„èº«ä»½éªŒè¯ï¼Œä¾‹å¦‚ä½¿ç”¨ä»¤ç‰Œå’Œ OTP çš„åŒå› ç´ èº«ä»½éªŒè¯ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å„ç§æ•°æ®åº“ - å…³ç³»æ•°æ®åº“å’Œéå…³ç³»æ•°æ®åº“ï¼Œä½¿ç”¨å„ç§å¯†ç ç¼–ç å™¨ï¼Œå°†æ¶æ„ç”¨æˆ·é”å®šåœ¨å…¶å¸æˆ·ä¹‹å¤–ï¼Œç­‰ç­‰ã€‚\nä»Šå¤©ï¼Œæˆ‘ä»¬å°†è®¨è®ºä¸‰ç§æ­¤ç±»è‡ªå®šä¹‰ï¼Œå³è‡ªå®šä¹‰è¡¨å•ç™»å½•ã€æ•°æ®åº“æä¾›çš„èº«ä»½éªŒè¯ä»¥åŠé™åˆ¶ç™»å½•å°è¯•ã€‚å°½ç®¡è¿™äº›éƒ½æ˜¯éå¸¸åŸºæœ¬çš„ç”¨ä¾‹ï¼Œä½†å®ƒä»¬ä»ç„¶å¯ä»¥è®©æˆ‘ä»¬æ›´ä»”ç»†åœ°äº†è§£ Spring Security çš„èº«ä»½éªŒè¯å’Œæˆæƒè¿‡ç¨‹ã€‚æˆ‘ä»¬è¿˜å°†å»ºç«‹ä¸€ä¸ªæ³¨å†Œé¡µé¢ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è¯¥é¡µé¢åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­è¿›è¡Œæ³¨å†Œã€‚\né¦–å…ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹ Spring Security çš„æ¶æ„ã€‚å®ƒä» servlet è¿‡æ»¤å™¨å¼€å§‹ã€‚è¿™äº›è¿‡æ»¤å™¨æ‹¦æˆªè¯·æ±‚ï¼Œå¯¹å…¶æ‰§è¡Œæ“ä½œï¼Œç„¶åå°†è¯·æ±‚ä¼ é€’åˆ°è¿‡æ»¤å™¨é“¾ä¸­çš„ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨æˆ–è¯·æ±‚å¤„ç†ç¨‹åºï¼Œæˆ–è€…åœ¨ä¸æ»¡è¶³æŸäº›æ¡ä»¶æ—¶é˜»æ­¢å®ƒä»¬ã€‚æ­£æ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒSpring Security å¯ä»¥å¯¹è¯·æ±‚è¿›è¡Œèº«ä»½éªŒè¯å¹¶å¯¹è¯·æ±‚æ‰§è¡Œå„ç§èº«ä»½éªŒè¯æ£€æŸ¥ã€‚\nå®ƒè¿˜å¯ä»¥é€šè¿‡ä¸å…è®¸æœªç»èº«ä»½éªŒè¯æˆ–æ¶æ„è¯·æ±‚è®¿é—®æˆ‘ä»¬å—ä¿æŠ¤çš„èµ„æºæ¥é˜»æ­¢å®ƒä»¬é€šè¿‡ã€‚å› æ­¤æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå’Œèµ„æºå—åˆ°ä¿æŠ¤ã€‚\nSpring Security æ¶æ„çš„ç»„ä»¶ æ­£å¦‚æˆ‘ä»¬åœ¨ä¸Šå›¾ä¸­çœ‹åˆ°çš„é‚£æ ·ï¼ŒSpring Security çš„åŸºæœ¬ç»„ä»¶å¦‚ä¸‹æ‰€ç¤ºã€‚æˆ‘ä»¬å°†åœ¨è®¨è®ºè¿‡ç¨‹ä¸­ç®€è¦è®¨è®ºå®ƒä»¬ã€‚æˆ‘ä»¬è¿˜å°†è®¨è®ºå®ƒä»¬åœ¨èº«ä»½éªŒè¯å’Œæˆæƒè¿‡ç¨‹ä¸­çš„è§’è‰²ã€‚\nAuthenticationFilter è®¤è¯è¿‡æ»¤å™¨ è¿™æ˜¯æ‹¦æˆªè¯·æ±‚å¹¶å°è¯•å¯¹å…¶è¿›è¡Œèº«ä»½éªŒè¯çš„è¿‡æ»¤å™¨ã€‚åœ¨ Spring Security ä¸­ï¼Œå®ƒå°†è¯·æ±‚è½¬æ¢ä¸ºèº«ä»½éªŒè¯å¯¹è±¡å¹¶å°†èº«ä»½éªŒè¯å§”æ‰˜ç»™ AuthenticationManagerã€‚\nAuthenticationManager è®¤è¯ç®¡ç†å™¨ å®ƒæ˜¯èº«ä»½éªŒè¯çš„ä¸»è¦ç­–ç•¥æ¥å£ã€‚å®ƒä½¿ç”¨å•ç‹¬çš„æ–¹æ³• authenticate()æ¥éªŒè¯è¯·æ±‚ã€‚ authenticate() æ–¹æ³•æ‰§è¡Œèº«ä»½éªŒè¯ï¼Œå¹¶åœ¨èº«ä»½éªŒè¯æˆåŠŸæ—¶è¿”å› Authentication å¯¹è±¡ï¼Œæˆ–è€…åœ¨èº«ä»½éªŒè¯å¤±è´¥æ—¶æŠ›å‡º AuthenticationExceptionã€‚å¦‚æœè¯¥æ–¹æ³•æ— æ³•å†³å®šï¼Œå®ƒå°†è¿”å› nullã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­çš„è®¤è¯è¿‡ç¨‹å§”æ‰˜ç»™äº†æˆ‘ä»¬æ¥ä¸‹æ¥è¦è®¨è®ºçš„ AuthenticationProviderã€‚\nAuthenticationProvider è®¤è¯æä¾›è€… AuthenticationManager ç”± ProviderManager å®ç°ï¼Œåè€…å°†æµç¨‹å§”æ‰˜ç»™ä¸€ä¸ªæˆ–å¤šä¸ª AuthenticationProvider å®ä¾‹ã€‚ä»»ä½•å®ç° AuthenticationProvider æ¥å£çš„ç±»éƒ½å¿…é¡»å®ç°ä¸¤ä¸ªæ–¹æ³•â€”â€”authenticate() å’Œ supports()ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æ¥è°ˆè°ˆ supports()æ–¹æ³•ã€‚å®ƒç”¨äºæ£€æŸ¥æˆ‘ä»¬çš„ AuthenticationProvider å®ç°ç±»æ˜¯å¦æ”¯æŒç‰¹å®šçš„èº«ä»½éªŒè¯ç±»å‹ã€‚å¦‚æœæ”¯æŒåˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚\næ¥ä¸‹æ¥æ˜¯ authenticate() æ–¹æ³•ã€‚è¿™æ˜¯èº«ä»½éªŒè¯å‘ç”Ÿçš„åœ°æ–¹ã€‚å¦‚æœæ”¯æŒè¯¥è®¤è¯ç±»å‹ï¼Œåˆ™å¯åŠ¨è®¤è¯è¿‡ç¨‹ã€‚è¿™é‡Œè¿™ä¸ªç±»å¯ä»¥ä½¿ç”¨ UserDetailsSâ€‹â€‹ervice å®ç°çš„ loadUserByUsername() æ–¹æ³•ã€‚å¦‚æœæœªæ‰¾åˆ°ç”¨æˆ·ï¼Œåˆ™ä¼šæŠ›å‡º UsernameNotFoundExceptionã€‚\nå¦ä¸€æ–¹é¢ï¼Œå¦‚æœæ‰¾åˆ°ç”¨æˆ·ï¼Œåˆ™ä½¿ç”¨è¯¥ç”¨æˆ·çš„èº«ä»½éªŒè¯è¯¦ç»†ä¿¡æ¯æ¥éªŒè¯è¯¥ç”¨æˆ·ã€‚ä¾‹å¦‚ï¼Œåœ¨åŸºæœ¬è®¤è¯åœºæ™¯ä¸­ï¼Œå¯ä»¥å°†ç”¨æˆ·æä¾›çš„å¯†ç ä¸æ•°æ®åº“ä¸­çš„å¯†ç è¿›è¡Œæ ¸å¯¹ã€‚å¦‚æœå‘ç°å®ƒä»¬å½¼æ­¤åŒ¹é…ï¼Œåˆ™è¯´æ˜æˆåŠŸã€‚ç„¶åæˆ‘ä»¬å¯ä»¥ä»æ­¤æ–¹æ³•è¿”å›ä¸€ä¸ª Authentication å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å°†å­˜å‚¨åœ¨å®‰å…¨ä¸Šä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨ç¨åè®¨è®ºã€‚\nUserDetailsService ç”¨æˆ·è¯¦æƒ…æœåŠ¡ å®ƒæ˜¯ Spring Security çš„æ ¸å¿ƒæ¥å£ä¹‹ä¸€ã€‚ä»»ä½•è¯·æ±‚çš„èº«ä»½éªŒè¯ä¸»è¦å–å†³äº UserDetailsSâ€‹â€‹ervice æ¥å£çš„å®ç°ã€‚å®ƒæœ€å¸¸ç”¨äºæ•°æ®åº“æ”¯æŒçš„èº«ä»½éªŒè¯ä¸­ä»¥æ£€ç´¢ç”¨æˆ·æ•°æ®ã€‚é€šè¿‡å•ç‹¬çš„ loadUserByUsername() æ–¹æ³•çš„å®ç°æ¥æ£€ç´¢æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­æä¾›é€»è¾‘æ¥è·å–ç”¨æˆ·çš„ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ã€‚å¦‚æœæœªæ‰¾åˆ°ç”¨æˆ·ï¼Œè¯¥æ–¹æ³•å°†æŠ›å‡º UsernameNotFoundExceptionã€‚\nå¯†ç ç¼–ç å™¨ åœ¨ Spring Security 4 ä¹‹å‰ï¼ŒPasswordEncoder çš„ä½¿ç”¨æ˜¯å¯é€‰çš„ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨å†…å­˜ä¸­èº«ä»½éªŒè¯æ¥å­˜å‚¨çº¯æ–‡æœ¬å¯†ç ã€‚ä½† Spring Security 5 å¼ºåˆ¶ä½¿ç”¨ PasswordEncoder æ¥å­˜å‚¨å¯†ç ã€‚è¿™ä½¿ç”¨å…¶å¤šç§å®ç°ä¹‹ä¸€å¯¹ç”¨æˆ·çš„å¯†ç è¿›è¡Œç¼–ç ã€‚æœ€å¸¸è§çš„å®ç°æ˜¯ BCryptPasswordEncoderã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ NoOpPasswordEncoder çš„å®ä¾‹æ¥è¿›è¡Œå¼€å‘ã€‚å®ƒå°†å…è®¸å¯†ç ä»¥çº¯æ–‡æœ¬å½¢å¼å­˜å‚¨ã€‚\nä½†å®ƒä¸åº”è¯¥ç”¨äºç”Ÿäº§æˆ–ç°å®ä¸–ç•Œçš„åº”ç”¨ç¨‹åºã€‚\nSpring å®‰å…¨ä¸Šä¸‹æ–‡ è¿™æ˜¯åœ¨æˆåŠŸéªŒè¯åå­˜å‚¨å½“å‰å·²éªŒè¯ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯çš„ä½ç½®ã€‚ç„¶åï¼Œèº«ä»½éªŒè¯å¯¹è±¡åœ¨ä¼šè¯çš„æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å¯ç”¨ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦ç”¨æˆ·åæˆ–ä»»ä½•å…¶ä»–ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆè·å– SecurityContextã€‚è¿™æ˜¯é€šè¿‡ SecurityContextHolderï¼ˆä¸€ä¸ªå¸®åŠ©ç¨‹åºç±»ï¼‰å®Œæˆçš„ï¼Œå®ƒæä¾›å¯¹å®‰å…¨ä¸Šä¸‹æ–‡çš„è®¿é—®ã€‚\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨ setAuthentication() å’Œ getAuthentication() æ–¹æ³•åˆ†åˆ«å­˜å‚¨å’Œæ£€ç´¢ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ã€‚\nç»§ç»­ï¼Œç°åœ¨è®©æˆ‘ä»¬è®¨è®ºæˆ‘ä»¬å°†åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨çš„ä¸‰ä¸ªè‡ªå®šä¹‰å®ç°ã€‚\nè¡¨å•ç™»å½• å½“æˆ‘ä»¬å°† Spring Security æ·»åŠ åˆ°ç°æœ‰ Spring åº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒä¼šæ·»åŠ ä¸€ä¸ªç™»å½•è¡¨å•å¹¶è®¾ç½®ä¸€ä¸ªè™šæ‹Ÿç”¨æˆ·ã€‚è¿™æ˜¯è‡ªåŠ¨é…ç½®æ¨¡å¼ä¸‹çš„ Spring Securityã€‚åœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œå®ƒè¿˜è®¾ç½®é»˜è®¤è¿‡æ»¤å™¨ã€èº«ä»½éªŒè¯ç®¡ç†å™¨ã€èº«ä»½éªŒè¯æä¾›ç¨‹åºç­‰ã€‚æ­¤è®¾ç½®æ˜¯å†…å­˜ä¸­èº«ä»½éªŒè¯è®¾ç½®ã€‚æˆ‘ä»¬å¯ä»¥è¦†ç›–æ­¤è‡ªåŠ¨é…ç½®æ¥è®¾ç½®æˆ‘ä»¬è‡ªå·±çš„ç”¨æˆ·å’Œèº«ä»½éªŒè¯è¿‡ç¨‹ã€‚æˆ‘ä»¬è¿˜å¯ä»¥è®¾ç½®è‡ªå®šä¹‰ç™»å½•æ–¹æ³•ï¼Œä¾‹å¦‚è‡ªå®šä¹‰ç™»å½•è¡¨å•ã€‚\nSpring Security åªéœ€è¦äº†è§£ç™»å½•è¡¨å•çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¾‹å¦‚ç™»å½•è¡¨å•çš„ URIã€ç™»å½•å¤„ç† URL ç­‰ã€‚ç„¶åå®ƒå°†ä¸ºåº”ç”¨ç¨‹åºå‘ˆç°æˆ‘ä»¬çš„ç™»å½•è¡¨å•å¹¶æ‰§è¡Œèº«ä»½éªŒè¯è¿‡ç¨‹å…¶ä»–æä¾›çš„é…ç½®æˆ– Spring è‡ªå·±çš„å®ç°ã€‚\næ­¤è‡ªå®šä¹‰è¡¨å•è®¾ç½®åªéœ€éµå®ˆæŸäº›è§„åˆ™å³å¯ä¸ Spring Security é›†æˆã€‚æˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªç”¨æˆ·åå‚æ•°å’Œä¸€ä¸ªå¯†ç å‚æ•°ï¼Œå‚æ•°åç§°åº”è¯¥æ˜¯â€œç”¨æˆ·åâ€å’Œâ€œå¯†ç â€ï¼Œå› ä¸ºè¿™äº›æ˜¯é»˜è®¤åç§°ã€‚å¦‚æœæˆ‘ä»¬åœ¨è‡ªå®šä¹‰ä¸­å¯¹è¿™äº›å­—æ®µä½¿ç”¨æˆ‘ä»¬è‡ªå·±çš„å‚æ•°åç§°ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨ usernameParameter() å’Œ passwordParameter() æ–¹æ³•é€šçŸ¥ Spring Security è¿™äº›æ›´æ”¹ã€‚\nåŒæ ·ï¼Œå¯¹äºæˆ‘ä»¬å¯¹ç™»å½•è¡¨å•æˆ–è¡¨å•ç™»å½•æ–¹æ³•æ‰€åšçš„æ¯ä¸€æ¬¡æ›´æ”¹ï¼Œæˆ‘ä»¬éƒ½å¿…é¡»ä½¿ç”¨é€‚å½“çš„æ–¹æ³•é€šçŸ¥ Spring Security è¿™äº›æ›´æ”¹ï¼Œä»¥ä¾¿å®ƒå¯ä»¥å°†å®ƒä»¬ä¸èº«ä»½éªŒè¯è¿‡ç¨‹é›†æˆã€‚\nä½¿ç”¨æ•°æ®åº“ç™»å½• æ­£å¦‚æˆ‘ä»¬æ‰€è®¨è®ºçš„ï¼ŒSpring Security é»˜è®¤æƒ…å†µä¸‹è‡ªåŠ¨æä¾›å†…å­˜ä¸­èº«ä»½éªŒè¯å®ç°ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡éªŒè¯å…¶è¯¦ç»†ä¿¡æ¯å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„ç”¨æˆ·æ¥è¦†ç›–è¿™ä¸€ç‚¹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®æ•°æ®åº“ä¸­çš„å‡­æ®éªŒè¯ç”¨æˆ·æä¾›çš„å‡­æ®ä»¥è¿›è¡Œèº«ä»½ â€‹â€‹ éªŒè¯ã€‚æˆ‘ä»¬è¿˜å¯ä»¥è®©æ–°ç”¨æˆ·åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­æ³¨å†Œå¹¶å°†ä»–ä»¬çš„å‡­æ®å­˜å‚¨åœ¨åŒä¸€æ•°æ®åº“ä¸­ã€‚\næ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æä¾›æ›´æ”¹æˆ–æ›´æ–°å…¶å¯†ç ã€è§’è‰²æˆ–å…¶ä»–æ•°æ®çš„æ–¹æ³•ã€‚å› æ­¤ï¼Œè¿™ä¸ºæˆ‘ä»¬æä¾›äº†å¯ä»¥ä½¿ç”¨æ›´é•¿æ—¶é—´çš„æŒä¹…ç”¨æˆ·æ•°æ®ã€‚\nç™»å½•å°è¯•é™åˆ¶ ä¸ºäº†é™åˆ¶åº”ç”¨ç¨‹åºä¸­çš„ç™»å½•å°è¯•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Spring Security çš„ isAccountNonLocked å±æ€§ã€‚ Spring Security çš„ UserDetails ä¸ºæˆ‘ä»¬æä¾›äº†è¯¥å±æ€§ã€‚æˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ç§èº«ä»½éªŒè¯æ–¹æ³•ï¼Œå¦‚æœä»»ä½•ç”¨æˆ·æˆ–å…¶ä»–äººæä¾›ä¸æ­£ç¡®çš„å‡­æ®è¶…è¿‡ä¸€å®šæ¬¡æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é”å®šä»–ä»¬çš„å¸æˆ·ã€‚å³ä½¿ç”¨æˆ·æä¾›äº†æ­£ç¡®çš„å‡­æ®ï¼ŒSpring Security ä¹Ÿä¼šç¦ç”¨é”å®šç”¨æˆ·çš„èº«ä»½éªŒè¯ã€‚è¿™æ˜¯ Spring Security æä¾›çš„å†…ç½®åŠŸèƒ½ã€‚\næˆ‘ä»¬å¯ä»¥å°†é”™è¯¯ç™»å½•å°è¯•çš„æ¬¡æ•°å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚ç„¶åï¼Œé’ˆå¯¹æ¯æ¬¡é”™è¯¯çš„èº«ä»½éªŒè¯å°è¯•ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ–°å¹¶æ£€æŸ¥æ•°æ®åº“è¡¨ã€‚å½“æ­¤ç±»å°è¯•çš„æ¬¡æ•°è¶…è¿‡ç»™å®šæ•°é‡æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç”¨æˆ·é”å®šåœ¨å…¶å¸æˆ·ä¹‹å¤–ã€‚å› æ­¤ï¼Œåœ¨å¸æˆ·è§£é”ä¹‹å‰ï¼Œç”¨æˆ·å°†æ— æ³•å†æ¬¡ç™»å½•ã€‚\nå…¥é—¨ï¼ˆå®ç”¨æŒ‡å—ï¼‰ ç°åœ¨è®©æˆ‘ä»¬å¼€å§‹æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚ä¸‹é¢åˆ—å‡ºäº†æ­¤åº”ç”¨ç¨‹åºæ‰€éœ€çš„å·¥å…· -\nA Java IDE âˆ’ æœ€å¥½æ˜¯ STS 4ï¼Œä½† Eclipseã€IntelliJ Idea æˆ–ä»»ä½•å…¶ä»– IDE éƒ½å¯ä»¥ã€‚ MySql Server Community Edition - æˆ‘ä»¬éœ€è¦åœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸­ä¸‹è½½å¹¶å®‰è£… MySql Community Serverã€‚æˆ‘ä»¬å¯ä»¥ç‚¹å‡»è¿™é‡Œè¿›å…¥å®˜æ–¹ç½‘ç«™ã€‚ MySql Workbench âˆ’ å®ƒæ˜¯ä¸€ä¸ª GUI å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ¥ä¸ MySql æ•°æ®åº“äº¤äº’ã€‚ æ•°æ®åº“è®¾ç½® æˆ‘ä»¬å…ˆè®¾ç½®æ•°æ®åº“ã€‚æˆ‘ä»¬å°†ä¸ºæ­¤åº”ç”¨ç¨‹åºä½¿ç”¨ MySql æ•°æ®åº“å®ä¾‹ã€‚ MySql Server ç¤¾åŒºç‰ˆå¯ä¾›å…è´¹ä¸‹è½½å’Œä½¿ç”¨ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ MySql Workbench ä¸ MySql æœåŠ¡å™¨è¿æ¥ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªåä¸ºâ€œspringâ€çš„æ•°æ®åº“ä»¥ä¸æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸€èµ·ä½¿ç”¨ã€‚\nç„¶åæˆ‘ä»¬å°†åˆ›å»ºä¸¤ä¸ªè¡¨ - ç”¨æˆ·å’Œå°è¯• - æ¥ä¿å­˜æˆ‘ä»¬çš„ç”¨æˆ·å’Œç™»å½•å°è¯•ã€‚å¦‚å‰æ‰€è¿°ï¼Œæ³¨å†Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯å°†å­˜å‚¨åœ¨ users è¡¨ä¸­ã€‚ä»»ä½•ç”¨æˆ·çš„ç™»å½•å°è¯•æ¬¡æ•°å°†æ ¹æ®å…¶ç”¨æˆ·åå­˜å‚¨åœ¨ attempts è¡¨ä¸­ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è·Ÿè¸ªå°è¯•å¹¶é‡‡å–å¿…è¦çš„è¡ŒåŠ¨ã€‚\nè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è®¾ç½®ç”¨æˆ·è¡¨å’Œå°è¯•è¡¨çš„ SQLã€‚\nCREATE TABLE users ( username VARCHAR(45) NOT NULL , password VARCHAR(45) NOT NULL , account_non_locked TINYINT NOT NULL DEFAULT 1 , PRIMARY KEY (username) ); CREATE TABLE attempts ( id int(45) NOT NULL AUTO_INCREMENT, username varchar(45) NOT NULL, attempts varchar(45) NOT NULL, PRIMARY KEY (id) ); æˆ‘ä»¬ç°åœ¨å¯ä»¥å‘æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ·»åŠ ä¸€ä¸ªè™šæ‹Ÿç”¨æˆ·ã€‚\nINSERT INTO users(username,password,account_non_locked) VALUES (\u0026#39;user\u0026#39;,\u0026#39;12345\u0026#39;, true); é¡¹ç›®è®¾ç½® åƒå¾€å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Spring åˆå§‹åŒ–ç¨‹åºæ¥è®¾ç½®æˆ‘ä»¬çš„é¡¹ç›®ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ Spring Boot ç‰ˆæœ¬ 2.3.2 åˆ›å»ºä¸€ä¸ª Maven é¡¹ç›®ã€‚è®©æˆ‘ä»¬å°†é¡¹ç›®å‘½åä¸º formloginï¼ˆæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä»»ä½•æˆ‘ä»¬æƒ³è¦çš„åç§°ï¼‰å’Œç»„ id ä¸º com.tutorial.spring.securityã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å°†åœ¨è¯¥é¡¹ç›®ä¸­ä½¿ç”¨ Java ç‰ˆæœ¬ 8ã€‚\nä¾èµ–å…³ç³» ç°åœ¨ï¼Œè°ˆåˆ°ä¾èµ–é¡¹ï¼Œæˆ‘ä»¬å°†åœ¨æ­¤æ¼”ç¤ºä¸­ä½¿åº”ç”¨ç¨‹åºå°½å¯èƒ½ç®€å•ã€‚æˆ‘ä»¬å°†ç»§ç»­å…³æ³¨ä»Šå¤©è¦æ¢ç´¢çš„åŠŸèƒ½ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†é€‰æ‹©æœ€å°‘æ•°é‡çš„ä¾èµ–é¡¹ï¼Œè¿™å°†æœ‰åŠ©äºæˆ‘ä»¬è®¾ç½®åº”ç”¨ç¨‹åºå¹¶å¿«é€Ÿå¯åŠ¨å’Œè¿è¡Œã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¾èµ–å…³ç³» -\nSpring Web âˆ’ å®ƒæ†ç»‘äº†ä¸ Web å¼€å‘ç›¸å…³çš„æ‰€æœ‰ä¾èµ–é¡¹ï¼ŒåŒ…æ‹¬ Spring MVCã€REST å’ŒåµŒå…¥å¼ Tomcat æœåŠ¡å™¨ã€‚ Spring Security âˆ’ ç”¨äºå®ç° Spring Security æä¾›çš„å®‰å…¨åŠŸèƒ½ã€‚ Thymeleaf âˆ’ ç”¨äº HTML5/XHTML/XML çš„æœåŠ¡å™¨ç«¯ Java æ¨¡æ¿å¼•æ“ã€‚ Spring Data JPA âˆ’ é™¤äº†ä½¿ç”¨ JPA è§„èŒƒå®šä¹‰çš„æ‰€æœ‰åŠŸèƒ½ä¹‹å¤–ï¼ŒSpring Data JPA è¿˜æ·»åŠ äº†è‡ªå·±çš„åŠŸèƒ½ï¼Œä¾‹å¦‚å­˜å‚¨åº“æ¨¡å¼çš„æ— ä»£ç å®ç°ä»¥åŠä»æ–¹æ³•åç§°åˆ›å»ºæ•°æ®åº“æŸ¥è¯¢ã€‚ Mysql Driver âˆ’ ç”¨äº MySQL æ•°æ®åº“é©±åŠ¨ç¨‹åºã€‚ æœ‰äº†è¿™äº”ä¸ªä¾èµ–é¡¹ï¼Œæˆ‘ä»¬ç°åœ¨å°±å¯ä»¥è®¾ç½®æˆ‘ä»¬çš„é¡¹ç›®äº†ã€‚è®©æˆ‘ä»¬ç‚¹å‡»ç”ŸæˆæŒ‰é’®ã€‚è¿™ä¼šå°†æˆ‘ä»¬çš„é¡¹ç›®ä¸‹è½½ä¸º zip æ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥å°†å…¶è§£å‹åˆ°æˆ‘ä»¬é€‰æ‹©çš„æ–‡ä»¶å¤¹ä¸­ã€‚ç„¶åæˆ‘ä»¬åœ¨ IDE ä¸­æ‰“å¼€è¯¥é¡¹ç›®ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Spring Tool Suite 4ã€‚ä¾‹å­ã€‚\nè®©æˆ‘ä»¬å°†é¡¹ç›®åŠ è½½åˆ° STS ä¸­ã€‚æˆ‘ä»¬çš„ IDE éœ€è¦ä¸€äº›æ—¶é—´æ¥ä¸‹è½½ä¾èµ–é¡¹å¹¶éªŒè¯å®ƒä»¬ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ pom.xml æ–‡ä»¶ã€‚\npom.xml\n\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;ISO-8859-1\u0026#34;?\u0026gt; \u0026lt;project xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34;\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;parent\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-parent\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.3.1.RELEASE\u0026lt;/version\u0026gt; \u0026lt;relativePath/\u0026gt; \u0026lt;!-- lookup parent from repository --\u0026gt; \u0026lt;/parent\u0026gt; \u0026lt;groupId\u0026gt;com.tutorial.spring.security\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;formlogin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.0.1-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;name\u0026gt;formlogin\u0026lt;/name\u0026gt; \u0026lt;description\u0026gt;Demo project for Spring Boot\u0026lt;/description\u0026gt; \u0026lt;properties\u0026gt; \u0026lt;java.version\u0026gt;1.8\u0026lt;/java.version\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-data-jpa\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-security\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-thymeleaf\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-devtools\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;runtime\u0026lt;scope\u0026gt; \u0026lt;optional\u0026gt;true\u0026lt;/optional\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;mysql\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;mysql-connector-java\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;runtime\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-test\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;exclusions\u0026gt; \u0026lt;exclusion\u0026gt; \u0026lt;groupId\u0026gt;org.junit.vintage\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;junit-vintage-engine\u0026lt;/artifactId\u0026gt; \u0026lt;/exclusion\u0026gt; \u0026lt;/exclusions\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.security\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-security-test\u0026lt;artifactId\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;build\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;/build\u0026gt; \u0026lt;/project\u0026gt; We can see that our project details along with our dependencies are enlisted here. æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„é¡¹ç›®è¯¦ç»†ä¿¡æ¯ä»¥åŠæˆ‘ä»¬çš„ä¾èµ–é¡¹éƒ½åˆ—åœ¨è¿™é‡Œã€‚\næ•°æ®æº æˆ‘ä»¬å°†åœ¨ application.properties æ–‡ä»¶ä¸­é…ç½®æ•°æ®æºã€‚ç”±äºæˆ‘ä»¬å°†ä½¿ç”¨æœ¬åœ° MySQL æ•°æ®åº“ä½œä¸ºæ•°æ®æºï¼Œå› æ­¤æˆ‘ä»¬åœ¨æ­¤å¤„æä¾›æœ¬åœ°æ•°æ®åº“å®ä¾‹çš„ URLã€ç”¨æˆ·åå’Œå¯†ç ã€‚æˆ‘ä»¬å°†æˆ‘ä»¬çš„æ•°æ®åº“å‘½åä¸ºâ€œspringâ€ã€‚\nspring.datasource.url=jdbc:mysql://localhost:3306/spring spring.datasource.username=root spring.datasource.password=root å®ä½“ ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºæˆ‘ä»¬çš„å®ä½“ã€‚æˆ‘ä»¬ä» User å®ä½“å¼€å§‹ï¼Œå®ƒåŒ…å«ä¸‰ä¸ªå­—æ®µ - ç”¨æˆ·åã€å¯†ç å’Œ accountNonLockedã€‚è¯¥ User ç±»è¿˜å®ç°äº† Spring Security çš„ UserDetails æ¥å£ã€‚æ­¤ç±»æä¾›æ ¸å¿ƒç”¨æˆ·ä¿¡æ¯ã€‚å®ƒç”¨äºå­˜å‚¨ç”¨æˆ·æ•°æ®ï¼Œç¨åå¯ä»¥å°†å…¶å°è£…åˆ° Authentication å¯¹è±¡ä¸­ã€‚ä¸å»ºè®®ç›´æ¥å®ç°æ¥å£ã€‚\nä½†å¯¹äºæˆ‘ä»¬çš„ä¾‹å­ï¼Œç”±äºè¿™æ˜¯ä¸€ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºæ¥æ¼”ç¤ºæ•°æ®åº“ç™»å½•ï¼Œå› æ­¤æˆ‘ä»¬ç›´æ¥åœ¨è¿™é‡Œå®ç°äº†è¿™ä¸ªæ¥å£ä»¥ä¿æŒç®€å•ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ User å®ä½“å‘¨å›´ä½¿ç”¨åŒ…è£…ç±»æ¥å®ç°æ­¤æ¥å£ã€‚\nUser.java\npackage com.tutorial.spring.security.formlogin.model; import java.util.Collection; import java.util.List; import javax.persistence.Column; import javax.persistence.Entity; import javax.persistence.Id; import javax.persistence.Table; import org.springframework.security.core.GrantedAuthority; import org.springframework.security.core.userdetails.UserDetails; @Entity @Table(name = \u0026#34;users\u0026#34;) public class User implements UserDetails { /** * */ private static final long serialVersionUID = 1L; @Id private String username; private String password; @Column(name = \u0026#34;account_non_locked\u0026#34;) private boolean accountNonLocked; public User() { } public User(String username, String password, boolean accountNonLocked) { this.username = username; this.password = password; this.accountNonLocked = accountNonLocked; } @Override public Collection\u0026lt; extends GrantedAuthority\u0026gt; getAuthorities() { return List.of(() -\u0026gt; \u0026#34;read\u0026#34;); } @Override public String getPassword() { return password; } public void setPassword(String password) { this.password = password; } @Override public String getUsername() { return username; } public void setUsername(String username) { this.username = username; } @Override public boolean isAccountNonExpired() { return true; } @Override public boolean isAccountNonLocked() { return accountNonLocked; } @Override public boolean isCredentialsNonExpired() { return true; } @Override public boolean isEnabled() { return true; } public void setAccountNonLocked(Boolean accountNonLocked) { this.accountNonLocked = accountNonLocked; } public boolean getAccountNonLocked() { return accountNonLocked; } } è¿™é‡Œè¦æ³¨æ„ accountNonLocked å­—æ®µã€‚ Spring Security ä¸­çš„æ¯ä¸ªç”¨æˆ·çš„å¸æˆ·é»˜è®¤éƒ½æ˜¯è§£é”çš„ã€‚ä¸ºäº†è¦†ç›–è¯¥å±æ€§å¹¶åœ¨ç”¨æˆ·è¶…è¿‡å…è®¸çš„å°è¯•æ¬¡æ•°åå°†ç”¨æˆ·é”å®šåœ¨å…¶å¸æˆ·ä¹‹å¤–ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¯¥å±æ€§ã€‚å¦‚æœç”¨æˆ·è¶…è¿‡å…è®¸çš„æ— æ•ˆå°è¯•æ¬¡æ•°ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ­¤å±æ€§å°†ä»–é”å®šåœ¨å¸æˆ·ä¹‹å¤–ã€‚ Also, during every authentication attempt, we shall be checking this property with the isAccountNonLocked() method along with the credentials to authenticate the user. Any user with a locked account will not be allowed to authenticate into the application. æ­¤å¤–ï¼Œåœ¨æ¯æ¬¡èº«ä»½éªŒè¯å°è¯•æœŸé—´ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ isAccountNonLocked() æ–¹æ³•æ£€æŸ¥æ­¤å±æ€§ä»¥åŠå‡­æ®ä»¥å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ã€‚ä»»ä½•å¸æˆ·è¢«é”å®šçš„ç”¨æˆ·éƒ½å°†ä¸å…è®¸é€šè¿‡èº«ä»½éªŒè¯è¿›å…¥åº”ç”¨ç¨‹åºã€‚\nå¯¹äº UserDetails æ¥å£çš„å…¶ä»–æ–¹æ³•ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥ç®€å•åœ°æä¾›ä¸€ä¸ªè¿”å› true çš„å®ç°ï¼Œå› ä¸ºæˆ‘ä»¬ä¸ä¼šä¸ºæ­¤åº”ç”¨ç¨‹åºæ¢ç´¢è¿™äº›å±æ€§ã€‚\nå¯¹äºè¯¥ç”¨æˆ·çš„æƒé™åˆ—è¡¨ï¼Œæˆ‘ä»¬ç°åœ¨ä¸ºä»–åˆ†é…ä¸€ä¸ªè™šæ‹Ÿè§’è‰²ã€‚æˆ‘ä»¬ä¹Ÿä¸ä¼šå°†æ­¤å±æ€§ç”¨äºæ­¤åº”ç”¨ç¨‹åºã€‚\nAttempts.java\nç»§ç»­ï¼Œè®©æˆ‘ä»¬åˆ›å»ºå°è¯•å®ä½“æ¥ä¿å­˜æ— æ•ˆå°è¯•è®¡æ•°ã€‚åœ¨æ•°æ®åº“ä¸­åˆ›å»ºæ—¶ï¼Œæˆ‘ä»¬å°†åœ¨æ­¤å¤„åŒ…å«ä¸‰ä¸ªå­—æ®µ - ç”¨æˆ·åã€ä¸€ä¸ªåä¸º attempts çš„æ•´æ•°ï¼ˆç”¨äºè®°å½•å°è¯•æ¬¡æ•°ï¼‰å’Œä¸€ä¸ªæ ‡è¯†ç¬¦ã€‚\npackage com.tutorial.spring.security.formlogin.model; import javax.persistence.Entity; import javax.persistence.GeneratedValue; import javax.persistence.GenerationType; import javax.persistence.Id; @Entity public class Attempts { @Id @GeneratedValue(strategy = GenerationType.IDENTITY) private int id; private String username; private int attempts; /** * @return the id */ public int getId() { return id; } /** * @param id the id to set */ public void setId(int id) { this.id = id; } /** * @return the username */ public String getUsername() { return username; } /** * @param username the username to set */ public void setUsername(String username) { this.username = username; } /** * @return the attempts */ public int getAttempts() { return attempts; } /** * @param attempts the attempts to set */ public void setAttempts(int attempts) { this.attempts = attempts; } } å­˜å‚¨åº“ æˆ‘ä»¬å·²ç»åˆ›å»ºäº†å®ä½“ï¼Œè®©æˆ‘ä»¬åˆ›å»ºå­˜å‚¨åº“æ¥å­˜å‚¨å’Œæ£€ç´¢æ•°æ®ã€‚æˆ‘ä»¬å°†æœ‰ä¸¤ä¸ªå­˜å‚¨åº“ï¼Œæ¯ä¸ªå®ä½“ç±»ä¸€ä¸ªã€‚å¯¹äºè¿™ä¸¤ä¸ªå­˜å‚¨åº“æ¥å£ï¼Œæˆ‘ä»¬å°†æ‰©å±• JpaRepositoryï¼Œå®ƒä¸ºæˆ‘ä»¬æä¾›äº†å†…ç½®å®ç°ï¼Œç”¨äºä¿å­˜å’Œæ£€ç´¢ application.properties æ–‡ä»¶ä¸­é…ç½®çš„æ•°æ®åº“ä¸­çš„æ•°æ®ã€‚é™¤äº†æä¾›çš„æ–¹æ³•æˆ–æŸ¥è¯¢ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨æ­¤å¤„æ·»åŠ æˆ‘ä»¬çš„æ–¹æ³•æˆ–æŸ¥è¯¢ã€‚\nUserRepository.java\npackage com.tutorial.spring.security.formlogin.repository; import java.util.Optional; import org.springframework.data.jpa.repository.JpaRepository; import org.springframework.stereotype.Repository; import com.tutorial.spring.security.formlogin.model.User; @Repository public interface UserRepository extends JpaRepository\u0026lt;User, String\u0026gt; { Optional\u0026lt;User\u0026gt; findUserByUsername(String username); } æ­£å¦‚æ‰€è®¨è®ºçš„ï¼Œæˆ‘ä»¬åœ¨æ­¤å¤„æ·»åŠ äº†é€šè¿‡ç”¨æˆ·åæ£€ç´¢ç”¨æˆ·çš„æ–¹æ³•ã€‚è¿™å°†è¿”å›æˆ‘ä»¬çš„ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·åã€å¯†ç å’Œå¸æˆ·é”å®šçŠ¶æ€ã€‚\nAttemptsRepository.java\npackage com.tutorial.spring.security.formlogin.repository; import java.util.Optional; import org.springframework.data.jpa.repository.JpaRepository; import org.springframework.stereotype.Repository; import com.tutorial.spring.security.formlogin.model.Attempts; @Repository public interface AttemptsRepository extends JpaRepository\u0026lt;Attempts, Integer\u0026gt; { Optional\u0026lt;Attempts\u0026gt; findAttemptsByUsername(String username); } ç±»ä¼¼åœ°ï¼Œå¯¹äº Attemptsï¼Œåœ¨ AttemptsRepository ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªè‡ªå®šä¹‰æ–¹æ³• findAttemptsByUsername(String username) æ¥è·å–æœ‰å…³ä½¿ç”¨ç”¨æˆ·åçš„ç”¨æˆ·å°è¯•çš„æ•°æ®ã€‚è¿™å°†è¿”å›ä¸€ä¸ª Attempts å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«ç”¨æˆ·åå’Œç”¨æˆ·å°è¯•èº«ä»½éªŒè¯å¤±è´¥çš„æ¬¡æ•°ã€‚\né…ç½® ç”±äºæˆ‘ä»¬å°†ä½¿ç”¨è‡ªå®šä¹‰ç™»å½•è¡¨å•ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»è¦†ç›– Spring Security çš„é»˜è®¤é…ç½®ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬åˆ›å»ºé…ç½®ç±»ï¼Œè¯¥ç±»æ‰©å±•äº† Spring Security çš„ WebSecurityConfigurerAdapter ç±»ã€‚\npackage com.tutorial.spring.security.formlogin.config; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; import org.springframework.security.crypto.password.PasswordEncoder; @Configuration public class ApplicationConfig extends WebSecurityConfigurerAdapter { @Bean public PasswordEncoder passwordEncoder() { return new BCryptPasswordEncoder(); } @Override protected void configure(HttpSecurity http) throws Exception { http .csrf().disable() .authorizeRequests().antMatchers(\u0026#34;/register**\u0026#34;) .permitAll() .anyRequest().authenticated() .and() .formLogin() .loginPage(\u0026#34;/login\u0026#34;) .permitAll() .and() .logout() .invalidateHttpSession(true) .clearAuthentication(true) .permitAll(); } } åœ¨è¿™é‡Œæˆ‘ä»¬åšäº†ä¸¤ä»¶äº‹ -\né¦–å…ˆï¼Œæˆ‘ä»¬æŒ‡å®šäº†å°†è¦ä½¿ç”¨çš„ PasswordEncoder æ¥å£çš„å®ç°ã€‚æˆ‘ä»¬ä½¿ç”¨ BCryptPasswordEncoder çš„å®ä¾‹æ¥å¯¹æœ¬ç¤ºä¾‹çš„å¯†ç è¿›è¡Œç¼–ç ã€‚ PasswordEncoder æ¥å£æœ‰å¾ˆå¤šå®ç°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…¶ä¸­ä»»ä½•ä¸€ä¸ªã€‚æˆ‘ä»¬åœ¨è¿™é‡Œé€‰æ‹© BCryptPasswordEncoder ä½œä¸ºæœ€å¸¸ç”¨çš„å®ç°ã€‚å®ƒä½¿ç”¨éå¸¸å¼ºå¤§çš„ BCrypt å“ˆå¸Œç®—æ³•å¯¹å¯†ç è¿›è¡Œç¼–ç ã€‚\nå®ƒé€šè¿‡åŠ å…¥ç›æ¥é˜²æ­¢å½©è™¹è¡¨æ”»å‡»æ¥å®ç°è¿™ä¸€ç‚¹ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œbcrypt æ˜¯ä¸€ä¸ªè‡ªé€‚åº”å‡½æ•°ï¼šéšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¿­ä»£æ¬¡æ•°å¯ä»¥å¢åŠ ä»¥ä½¿å…¶å˜æ…¢ï¼Œå› æ­¤å³ä½¿è®¡ç®—èƒ½åŠ›ä¸æ–­å¢åŠ ï¼Œå®ƒä»ç„¶å¯ä»¥æŠµæŠ—æš´åŠ›æœç´¢æ”»å‡»ã€‚\nå…¶æ¬¡ï¼Œæˆ‘ä»¬é‡å†™äº† configure()æ–¹æ³•æ¥æä¾›ç™»å½•æ–¹æ³•çš„å®ç°ã€‚\næ¯å½“æˆ‘ä»¬ä½¿ç”¨è‡ªå®šä¹‰è¡¨å•ä»£æ›¿ Spring Security æä¾›çš„è¡¨å•è¿›è¡Œèº«ä»½éªŒè¯æ—¶ï¼Œæˆ‘ä»¬éƒ½å¿…é¡»ä½¿ç”¨ formLogin() æ–¹æ³•é€šçŸ¥ Spring Securityã€‚ ç„¶åæˆ‘ä»¬è¿˜æŒ‡å®šç™»å½• URL â€“ /loginã€‚ç¨åæˆ‘ä»¬ä¼šå°† URL æ˜ å°„åˆ°æ§åˆ¶å™¨ä¸­çš„è‡ªå®šä¹‰ç™»å½•é¡µé¢ã€‚ æˆ‘ä»¬è¿˜æŒ‡å®šä»¥ /registerã€/login å¼€å¤´çš„ç«¯ç‚¹å’Œæ³¨é”€é¡µé¢ä¸éœ€è¦å—åˆ°ä¿æŠ¤ã€‚æˆ‘ä»¬ä½¿ç”¨ PermitAll() æ–¹æ³•æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚è¿™å…è®¸æ¯ä¸ªäººè®¿é—®è¿™äº›ç«¯ç‚¹ã€‚é™¤äº†è¿™äº›ç«¯ç‚¹ä¹‹å¤–ï¼Œæ‰€æœ‰ç«¯ç‚¹éƒ½éœ€è¦è¿›è¡Œèº«ä»½éªŒè¯()ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç”¨æˆ·å¿…é¡»ç™»å½•æ‰èƒ½è®¿é—®æ‰€æœ‰å…¶ä»–ç«¯ç‚¹ã€‚ æ³¨é”€æ—¶ï¼Œæˆ‘ä»¬æŒ‡å®šä¼šè¯å¤±æ•ˆï¼Œå¹¶æ¸…é™¤å­˜å‚¨åœ¨åº”ç”¨ç¨‹åº SecurityContext ä¸­çš„èº«ä»½éªŒè¯ã€‚ å®‰å…¨è®¾ç½® ç°åœ¨ï¼Œæˆ‘ä»¬å°†è®¾ç½®èº«ä»½éªŒè¯è¿‡ç¨‹ã€‚æˆ‘ä»¬å°†ä½¿ç”¨æ•°æ®åº“è®¾ç½®èº«ä»½éªŒè¯å¹¶é”å®šç”¨æˆ·å¸æˆ·ã€‚\nè®©æˆ‘ä»¬é¦–å…ˆåˆ›å»º UserDetailsSâ€‹â€‹ervice çš„å®ç°ã€‚æ­£å¦‚æˆ‘ä»¬ä¹‹å‰è®¨è®ºçš„ï¼Œæˆ‘ä»¬éœ€è¦æä¾›ä½¿ç”¨æ•°æ®åº“è¿›è¡Œèº«ä»½éªŒè¯çš„è‡ªå®šä¹‰å®ç°ã€‚è¿™æ˜¯å› ä¸ºï¼Œæ­£å¦‚æˆ‘ä»¬æ‰€çŸ¥ï¼ŒSpring Security é»˜è®¤æƒ…å†µä¸‹ä»…æä¾›å†…å­˜ä¸­çš„èº«ä»½éªŒè¯å®ç°ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨åŸºäºæ•°æ®åº“çš„æµç¨‹æ¥è¦†ç›–è¯¥å®ç°ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦é‡å†™ UserDetailsSâ€‹â€‹ervice çš„ loadUserByUsername() æ–¹æ³•ã€‚\nç”¨æˆ·è¯¦æƒ…æœåŠ¡ package com.tutorial.spring.security.formlogin.security; import java.util.Optional; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.security.core.userdetails.UserDetails; import org.springframework.security.core.userdetails.UserDetailsService; import org.springframework.security.core.userdetails.UsernameNotFoundException; import org.springframework.security.provisioning.UserDetailsManager; import org.springframework.stereotype.Service; import com.tutorial.spring.security.formlogin.model.User; import com.tutorial.spring.security.formlogin.repository.UserRepository; @Service public class SecurityUserDetailsService implements UserDetailsService { @Autowired private UserRepository userRepository; @Override public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException { User user = userRepository.findUserByUsername(username) .orElseThrow(() -\u0026lt; new UsernameNotFoundException(\u0026#34;User not present\u0026#34;)); return user; } public void createUser(UserDetails user) { userRepository.save((User) user); } } æ­£å¦‚æˆ‘ä»¬åœ¨è¿™é‡Œçœ‹åˆ°çš„ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œå®ç°äº† loadUserByUsername() æ–¹æ³•ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ UserRepository æ¥å£ä»æ•°æ®åº“ä¸­è·å–ç”¨æˆ·ã€‚å¦‚æœæœªæ‰¾åˆ°ç”¨æˆ·ï¼Œåˆ™ä¼šæŠ›å‡º UsernameNotFoundExceptionã€‚\næˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ª createUser() æ–¹æ³•ã€‚æˆ‘ä»¬å°†ä½¿ç”¨æ­¤æ–¹æ³•å°†å·²ä½¿ç”¨ UserRepository åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­æ³¨å†Œçš„ç”¨æˆ·æ·»åŠ åˆ°æˆ‘ä»¬çš„æ•°æ®åº“ä¸­ã€‚\nè®¤è¯æä¾›è€… æˆ‘ä»¬ç°åœ¨å°†å®ç°æˆ‘ä»¬çš„è‡ªå®šä¹‰èº«ä»½éªŒè¯æä¾›ç¨‹åºã€‚å®ƒå°†å®ç° AuthenticationProvider æ¥å£ã€‚æˆ‘ä»¬è¿™é‡Œæœ‰ä¸¤ä¸ªå¿…é¡»é‡å†™å’Œå®ç°çš„æ–¹æ³•ã€‚\npackage com.tutorial.spring.security.formlogin.security; import java.util.Optional; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.security.authentication.AuthenticationProvider; import org.springframework.security.authentication.BadCredentialsException; import org.springframework.security.authentication.LockedException; import org.springframework.security.authentication.UsernamePasswordAuthenticationToken; import org.springframework.security.core.Authentication; import org.springframework.security.core.AuthenticationException; import org.springframework.security.crypto.password.PasswordEncoder; import org.springframework.stereotype.Component; import com.tutorial.spring.security.formlogin.model.Attempts; import com.tutorial.spring.security.formlogin.model.User; import com.tutorial.spring.security.formlogin.repository.AttemptsRepository; import com.tutorial.spring.security.formlogin.repository.UserRepository; @Component public class AuthProvider implements AuthenticationProvider { private static final int ATTEMPTS_LIMIT = 3; @Autowired private SecurityUserDetailsService userDetailsService; @Autowired private PasswordEncoder passwordEncoder; @Autowired private AttemptsRepository attemptsRepository; @Autowired private UserRepository userRepository; @Override public Authentication authenticate(Authentication authentication) throws AuthenticationException { String username = authentication.getName(); import com.tutorial.spring.security.formlogin.repository.UserRepository; @Component public class AuthProvider implements AuthenticationProvider { private static final int ATTEMPTS_LIMIT = 3; @Autowired private SecurityUserDetailsService userDetailsService; @Autowired private PasswordEncoder passwordEncoder; @Autowired private AttemptsRepository attemptsRepository; @Autowired private UserRepository userRepository; @Override public Authentication authenticate(Authentication authentication) throws AuthenticationException { String username = authentication.getName(); Optional\u0026lt;Attempts\u0026gt; userAttempts = attemptsRepository.findAttemptsByUsername(username); if (userAttempts.isPresent()) { Attempts attempts = userAttempts.get(); attempts.setAttempts(0); attemptsRepository.save(attempts); } } private void processFailedAttempts(String username, User user) { Optional\u0026lt;Attempts\u0026gt; userAttempts = attemptsRepository.findAttemptsByUsername(username); if (userAttempts.isEmpty()) { Attempts attempts = new Attempts(); attempts.setUsername(username); attempts.setAttempts(1); attemptsRepository.save(attempts); } else { Attempts attempts = userAttempts.get(); attempts.setAttempts(attempts.getAttempts() + 1); attemptsRepository.save(attempts); if (attempts.getAttempts() + 1 \u0026gt; ATTEMPTS_LIMIT) { user.setAccountNonLocked(false); userRepository.save(user); throw new LockedException(\u0026#34;Too many invalid attempts. Account is locked!!\u0026#34;); } } } @Override public boolean supports(Class\u0026lt;?\u0026gt; authentication) { return true; } } authenticate() - æ­¤æ–¹æ³•è¿”å›ä¸€ä¸ªç»è¿‡å®Œå…¨èº«ä»½éªŒè¯çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬æˆåŠŸèº«ä»½éªŒè¯æ—¶çš„å‡­æ®ã€‚ç„¶åå°†è¯¥å¯¹è±¡å­˜å‚¨åœ¨ SecurityContext ä¸­ã€‚ä¸ºäº†æ‰§è¡Œèº«ä»½éªŒè¯ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨åº”ç”¨ç¨‹åºçš„ SecurityUserDetailsSâ€‹â€‹ervice ç±»çš„ loaduserByUsername() æ–¹æ³•ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬æ‰§è¡Œå¤šé¡¹æ“ä½œ -\né¦–å…ˆï¼Œæˆ‘ä»¬ä»èº«ä»½éªŒè¯è¯·æ±‚å¯¹è±¡ä¸­æå–ç”¨æˆ·å‡­æ®ï¼Œè¯¥å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™æˆ‘ä»¬çš„å‡½æ•°ã€‚è¯¥èº«ä»½éªŒè¯å¯¹è±¡ç”± AuthenticationFilter ç±»å‡†å¤‡ï¼Œå¹¶é€šè¿‡ AuthenticationManager å‘ä¸‹ä¼ é€’åˆ° AuthenticationProviderã€‚\næˆ‘ä»¬è¿˜ä½¿ç”¨ loadUserByUsername() æ–¹æ³•ä»æ•°æ®åº“ä¸­è·å–ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ã€‚\nç°åœ¨ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬æ£€æŸ¥ç”¨æˆ·å¸æˆ·æ˜¯å¦ç”±äºä¹‹å‰å¤±è´¥çš„èº«ä»½éªŒè¯å°è¯•è€Œè¢«é”å®šã€‚å¦‚æœæˆ‘ä»¬å‘ç°è´¦æˆ·è¢«é”å®šï¼Œæˆ‘ä»¬ä¼šæŠ›å‡º LockedExceptionï¼Œç”¨æˆ·å°†æ— æ³•è¿›è¡Œèº«ä»½éªŒè¯ï¼Œé™¤éè´¦æˆ·å†æ¬¡è§£é”ã€‚\nå¦‚æœå¸æˆ·æœªé”å®šï¼Œæˆ‘ä»¬ä¼šå°†æä¾›çš„å¯†ç ä¸æ•°æ®åº“ä¸­é’ˆå¯¹è¯¥ç”¨æˆ·å­˜å‚¨çš„å¯†ç è¿›è¡ŒåŒ¹é…ã€‚è¿™æ˜¯ä½¿ç”¨ PasswordEncoder æ¥å£çš„ matches() æ–¹æ³•å®Œæˆçš„ã€‚\nå¦‚æœå¯†ç åŒ¹é…ï¼Œå¹¶ä¸”å¸æˆ·å°šæœªè¢«é”å®šï¼Œæˆ‘ä»¬å°†è¿”å›ä¸€ä¸ªç»è¿‡å®Œå…¨èº«ä»½éªŒè¯çš„å¯¹è±¡ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªå®ä¾‹ UsernamePasswordAuthenticationToken ç±»ï¼ˆå› ä¸ºå®ƒæ˜¯ç”¨æˆ·åå¯†ç èº«ä»½éªŒè¯ï¼‰æ¥å®ç°èº«ä»½éªŒè¯ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜å°†å°è¯•è®¡æ•°å™¨é‡ç½®ä¸º 0ã€‚\nå¦ä¸€æ–¹é¢ï¼Œå¦‚æœå¯†ç ä¸åŒ¹é…ï¼Œæˆ‘ä»¬ä¼šæ£€æŸ¥ä¸€äº›æ¡ä»¶ -\nå¦‚æœè¿™æ˜¯ç”¨æˆ·ç¬¬ä¸€æ¬¡å°è¯•ï¼Œé‚£ä¹ˆä»–çš„åå­—å¯èƒ½ä¸ä¼šå‡ºç°åœ¨æ•°æ®åº“ä¸­ã€‚æˆ‘ä»¬ä½¿ç”¨ AttemptsRepository ä¸­çš„ findAttemptsByUsername() æ–¹æ³•æ¥æ£€æŸ¥è¿™ä¸€ç‚¹ã€‚ å¦‚æœæœªæ‰¾åˆ°ï¼Œæˆ‘ä»¬ä¼šåœ¨æ•°æ®åº“ä¸­ä¸ºè¯¥ç”¨æˆ·åˆ›å»ºä¸€ä¸ªæ¡ç›®ï¼Œå¹¶å°†å°è¯•æ¬¡æ•°è®¾ç½®ä¸º 1ã€‚ å¦‚æœæ‰¾åˆ°ç”¨æˆ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†å°è¯•æ¬¡æ•°å¢åŠ  1ã€‚ ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ä¹‹å‰å®šä¹‰çš„å¸¸é‡å€¼æ£€æŸ¥å…è®¸çš„æœ€å¤§å¤±è´¥å°è¯•æ¬¡æ•°ã€‚ å¦‚æœè¯¥æ¬¡æ•°è¶…è¿‡å…è®¸çš„å°è¯•æ¬¡æ•°ï¼Œåˆ™ç”¨æˆ·å°†è¢«é”å®šåº”ç”¨ç¨‹åºå¹¶å¼•å‘ LockedExceptionã€‚ supports() - æˆ‘ä»¬è¿˜æœ‰ supports æ–¹æ³•æ¥æ£€æŸ¥æˆ‘ä»¬çš„ AuthenticationProvider å®ç°ç±»æ˜¯å¦æ”¯æŒæˆ‘ä»¬çš„èº«ä»½éªŒè¯ç±»å‹ã€‚å¦‚æœåŒ¹é…ã€ä¸åŒ¹é…æˆ–æ— æ³•å†³å®šï¼Œåˆ™åˆ†åˆ«è¿”å› trueã€false æˆ– nullã€‚ç›®å‰æˆ‘ä»¬å·²å°†å…¶ç¡¬ç¼–ç ä¸º trueã€‚\næ§åˆ¶å™¨ ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºæ§åˆ¶å™¨åŒ…ã€‚å®ƒå°†åŒ…å«æˆ‘ä»¬çš„ HelloController ç±»ã€‚ä½¿ç”¨è¿™ä¸ªæ§åˆ¶å™¨ç±»ï¼Œæˆ‘ä»¬å°†æŠŠè§†å›¾æ˜ å°„åˆ°ç«¯ç‚¹ï¼Œå¹¶åœ¨å‘½ä¸­ç›¸åº”çš„ç«¯ç‚¹æ—¶æä¾›è¿™äº›è§†å›¾ã€‚æˆ‘ä»¬è¿˜å°†è‡ªåŠ¨è£…é…è¯¥ç»„ä»¶ä¸­çš„ PasswordEncoder å’Œ UserDetailsSâ€‹â€‹ervice ç±»ã€‚è¿™äº›æ³¨å…¥çš„ä¾èµ–é¡¹å°†ç”¨äºåˆ›å»ºæˆ‘ä»¬çš„ç”¨æˆ·ã€‚ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºç«¯ç‚¹ã€‚\npackage com.tutorial.spring.security.formlogin.controller; import java.util.Map; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpSession; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.http.MediaType; import org.springframework.security.authentication.BadCredentialsException; import org.springframework.security.authentication.LockedException; import org.springframework.security.crypto.password.PasswordEncoder; import org.springframework.stereotype.Controller; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PostMapping; import org.springframework.web.bind.annotation.RequestParam; import com.tutorial.spring.security.formlogin.model.User; import com.tutorial.spring.security.formlogin.security.SecurityUserDetailsService; @Controller public class HelloController { @Autowired private SecurityUserDetailsService userDetailsManager; @Autowired private PasswordEncoder passwordEncoder; @GetMapping(\u0026#34;/\u0026#34;) public String index() { return \u0026#34;index\u0026#34;; } @GetMapping(\u0026#34;/login\u0026#34;) public String login(HttpServletRequest request, HttpSession session) { session.setAttribute( \u0026#34;error\u0026#34;, getErrorMessage(request, \u0026#34;SPRING_SECURITY_LAST_EXCEPTION\u0026#34;) ); return \u0026#34;login\u0026#34;; } @GetMapping(\u0026#34;/register\u0026#34;) public String register() { return \u0026#34;register\u0026#34;; } @PostMapping( value = \u0026#34;/register\u0026#34;, consumes = MediaType.APPLICATION_FORM_URLENCODED_VALUE, produces = { MediaType.APPLICATION_ATOM_XML_VALUE, MediaType.APPLICATION_JSON_VALUE } ) public void addUser(@RequestParam Map\u0026lt;String, String\u0026gt; body) { User user = new User(); user.setUsername(body.get(\u0026#34;username\u0026#34;)); user.setPassword(passwordEncoder.encode(body.get(\u0026#34;password\u0026#34;))); user.setAccountNonLocked(true); userDetailsManager.createUser(user); } private String getErrorMessage(HttpServletRequest request, String key) { Exception exception = (Exception) request.getSession().getAttribute(key); String error = \u0026#34;\u0026#34;; if (exception instanceof BadCredentialsException) { error = \u0026#34;Invalid username and password!\u0026#34;; } else if (exception instanceof LockedException) { error = exception.getMessage(); } else { error = \u0026#34;Invalid username and password!\u0026#34;; } return error; } } index (\u0026quot;/\u0026quot;) â€“ è¯¥ç«¯ç‚¹å°†ä¸ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„ç´¢å¼•é¡µé¢æä¾›æœåŠ¡ã€‚æ­£å¦‚æˆ‘ä»¬ä¹‹å‰é…ç½®çš„é‚£æ ·ï¼Œæˆ‘ä»¬å°†ä¿æŠ¤æ­¤é¡µé¢å¹¶ä»…å…è®¸ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·èƒ½å¤Ÿè®¿é—®æ­¤é¡µé¢ã€‚ login (\u0026quot;/login\u0026quot;) â€“ å¦‚å‰æ‰€è¿°ï¼Œè¿™å°†ç”¨äºæœåŠ¡æˆ‘ä»¬çš„è‡ªå®šä¹‰ç™»å½•é¡µé¢ã€‚ä»»ä½•æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·éƒ½å°†è¢«é‡å®šå‘åˆ°æ­¤ç«¯ç‚¹è¿›è¡Œèº«ä»½éªŒè¯ã€‚ register(\u0026quot;/register\u0026quot;) (GET) â€“ æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°†æœ‰ä¸¤ä¸ªâ€œæ³¨å†Œâ€ç«¯ç‚¹ã€‚å…¶ä¸­ä¹‹ä¸€æ˜¯æä¾›æ³¨å†Œé¡µé¢ã€‚å¦ä¸€é¡¹ä»»åŠ¡æ˜¯å¤„ç†æ³¨å†Œè¿‡ç¨‹ã€‚å› æ­¤ï¼Œå‰è€…å°†ä½¿ç”¨ Http GETï¼Œåè€…å°†ä½¿ç”¨ POST ç«¯ç‚¹ã€‚ register(\u0026quot;/register\u0026quot;) (POST) â€“ æˆ‘ä»¬å°†ä½¿ç”¨æ­¤ç«¯ç‚¹æ¥å¤„ç†ç”¨æˆ·æ³¨å†Œè¿‡ç¨‹ã€‚æˆ‘ä»¬å°†ä»å‚æ•°ä¸­è·å–ç”¨æˆ·åå’Œå¯†ç ã€‚ç„¶åæˆ‘ä»¬å°†ä½¿ç”¨@Autowired åˆ°è¯¥ç»„ä»¶ä¸­çš„ passwordEncoder å¯¹å¯†ç è¿›è¡Œç¼–ç ã€‚æ­¤æ—¶æˆ‘ä»¬è¿˜å°†ç”¨æˆ·å¸æˆ·è®¾ç½®ä¸ºè§£é”ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ createUser() æ–¹æ³•å°†æ­¤ç”¨æˆ·æ•°æ®ä¿å­˜åœ¨ç”¨æˆ·è¡¨ä¸­ã€‚ é™¤äº†ä¸Šé¢çš„æ–¹æ³•ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜æœ‰ getErrorMessage() æ–¹æ³•ã€‚å®ƒç”¨äºç¡®å®šæœ€åæŠ›å‡ºçš„å¼‚å¸¸ä»¥åœ¨æˆ‘ä»¬çš„ç™»å½•æ¨¡æ¿ä¸­æ·»åŠ æ¶ˆæ¯ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„è¯†åˆ°èº«ä»½éªŒè¯é”™è¯¯å¹¶æ˜¾ç¤ºæ­£ç¡®çš„æ¶ˆæ¯ã€‚\nèµ„æº æˆ‘ä»¬å·²ç»åˆ›å»ºäº†ç«¯ç‚¹ï¼Œå”¯ä¸€å‰©ä¸‹çš„å°±æ˜¯åˆ›å»ºè§†å›¾ã€‚\né¦–å…ˆï¼Œæˆ‘ä»¬å°†åˆ›å»ºç´¢å¼•é¡µé¢ã€‚åªæœ‰æˆåŠŸéªŒè¯åï¼Œç”¨æˆ·æ‰èƒ½è®¿é—®æ­¤é¡µé¢ã€‚è¯¥é¡µé¢å¯ä»¥è®¿é—® Servlet è¯·æ±‚å¯¹è±¡ï¼Œä½¿ç”¨è¯¥å¯¹è±¡æˆ‘ä»¬å¯ä»¥æ˜¾ç¤ºç™»å½•ç”¨æˆ·çš„ç”¨æˆ·åã€‚\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html xmlns=\u0026#34;http://www.w3.org/1999/xhtml\u0026#34; xmlns:th=\u0026#34;https://www.thymeleaf.org\u0026#34; xmlns:sec=\u0026#34;https://www.thymeleaf.org/thymeleaf-extras-springsecurity3\u0026#34; \u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;Hello World!\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1 th:inline=\u0026#34;text\u0026#34;\u0026gt;Hello [[${#httpServletRequest.remoteUser}]]!\u0026lt;/h1\u0026gt; \u0026lt;form th:action=\u0026#34;@{/logout}\u0026#34; method=\u0026#34;post\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;Sign Out\u0026#34; /\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;html\u0026gt;\u0026lt;/html\u0026gt; \u0026lt;/html\u0026gt; æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ›å»ºç™»å½•è§†å›¾ã€‚è¿™å°†æ˜¾ç¤ºæˆ‘ä»¬çš„è‡ªå®šä¹‰ç™»å½•è¡¨å•ï¼Œå…¶ä¸­åŒ…å«ç”¨æˆ·åå’Œå¯†ç å­—æ®µã€‚åœ¨æ³¨é”€æˆ–èº«ä»½éªŒè¯å¤±è´¥çš„æƒ…å†µä¸‹ä¹Ÿä¼šå‘ˆç°æ­¤è§†å›¾ï¼Œå¹¶å°†é’ˆå¯¹æ¯ç§æƒ…å†µæ˜¾ç¤ºé€‚å½“çš„æ¶ˆæ¯ã€‚\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html xmlns=\u0026#34;http://www.w3.org/1999/xhtml\u0026#34; xmlns:th=\u0026#34;https://www.thymeleaf.org\u0026#34; xmlns:sec=\u0026#34;https://www.thymeleaf.org/thymeleaf-extras-springsecurity3\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;Spring Security Example\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div th:if=\u0026#34;${param.error}\u0026#34;\u0026gt; \u0026lt;p th:text=\u0026#34;${session.error}\u0026#34; th:unless=\u0026#34;${session == null}\u0026#34;\u0026gt;[...]\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div th:if=\u0026#34;${param.logout}\u0026#34;\u0026gt;You have been logged out.\u0026lt;/div\u0026gt; \u0026lt;form th:action=\u0026#34;@{/login}\u0026#34; method=\u0026#34;post\u0026gt; \u0026lt;div\u0026gt; \u0026lt;label\u0026gt; User Name : \u0026lt;input type=\u0026#34;text\u0026#34; name=\u0026#34;username\u0026#34; /\u0026gt; \u0026lt;/label\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div\u0026gt; \u0026lt;label\u0026gt; Password: \u0026lt;input type=\u0026#34;password\u0026#34; name=\u0026#34;password\u0026#34; /\u0026gt; \u0026lt;/label\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;Sign In\u0026#34; /\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ›å»ºæ‰€éœ€çš„è§†å›¾ï¼Œå³å¯„å­˜å™¨è§†å›¾ã€‚è¯¥è§†å›¾å°†å…è®¸ç”¨æˆ·åœ¨åº”ç”¨ç¨‹åºä¸­æ³¨å†Œè‡ªå·±ã€‚è¯¥ç”¨æˆ·æ•°æ®å°†å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œç„¶åç”¨äºèº«ä»½éªŒè¯ã€‚\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;ISO-8859-1\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Insert title here\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;form action=\u0026#34;/register\u0026#34; method=\u0026#34;post\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;Register\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;Please fill in this form to create an account.\u0026lt;/p\u0026gt; \u0026lt;hr /\u0026gt; \u0026lt;label for=\u0026#34;username\u0026#34;\u0026gt; \u0026lt;b\u0026gt;Username\u0026lt;/b\u0026gt; \u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; placeholder=\u0026#34;Enter Username\u0026#34; name=\u0026#34;username\u0026#34; id=\u0026#34;username\u0026#34; required /\u0026gt; \u0026lt;label for=\u0026#34;password\u0026#34;\u0026gt;\u0026lt;b\u0026gt;Password\u0026lt;/b\u0026gt;\u0026lt;/label\u0026gt; \u0026lt;input type=\u0026#34;password\u0026#34; placeholder=\u0026#34;Enter Password\u0026#34; name=\u0026#34;password\u0026#34; id=\u0026#34;password\u0026#34; required /\u0026gt; \u0026lt;button type=\u0026#34;submit\u0026#34; class=\u0026#34;registerbtn\u0026#34;\u0026gt;Register\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; æœ€ç»ˆé¡¹ç›®ç»“æ„ æˆ‘ä»¬æœ€ç»ˆçš„é¡¹ç›®ç»“æ„åº”è¯¥ä¸æ­¤ç±»ä¼¼ã€‚\nè¿è¡Œåº”ç”¨ç¨‹åº\nç„¶åæˆ‘ä»¬å¯ä»¥å°†åº”ç”¨ç¨‹åºä½œä¸º SpringBootApp è¿è¡Œã€‚å½“æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸Šè®¿é—® localhost:8080 æ—¶ï¼Œå®ƒä¼šå°†æˆ‘ä»¬é‡å®šå‘å›ç™»å½•é¡µé¢ã€‚\nèº«ä»½éªŒè¯æˆåŠŸåï¼Œå®ƒå°†å¸¦æˆ‘ä»¬è¿›å…¥å¸¦æœ‰é—®å€™è¯­çš„ç´¢å¼•è§†å›¾ã€‚\nå› ä¸ºï¼Œåœ¨å¸æˆ·è¢«é”å®šä¹‹å‰ï¼Œæˆ‘ä»¬åªå…è®¸ä¸‰æ¬¡å¤±è´¥çš„å°è¯•ï¼Œå› æ­¤åœ¨ç¬¬ä¸‰æ¬¡å¤±è´¥çš„èº«ä»½éªŒè¯ä¸­ï¼Œç”¨æˆ·å°†è¢«é”å®šï¼Œå¹¶ä¸”è¯¥æ¶ˆæ¯ä¼šæ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚\nåœ¨ç‚¹å‡» /register ç«¯ç‚¹æ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ³¨å†Œä¸€ä¸ªæ–°ç”¨æˆ·ã€‚\nç»“è®º ä»ä»Šå¤©çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨åŸºäºæ³¨é‡Šçš„é…ç½®ä½¿ç”¨æ•°æ®åº“æ¥ä½¿ç”¨è‡ªå®šä¹‰è¡¨å•è¿›è¡Œç™»å½•ã€‚æˆ‘ä»¬è¿˜å­¦ä¹ äº†å¦‚ä½•é˜²æ­¢å¤šæ¬¡ç™»å½•å°è¯•å¤±è´¥ã€‚åœ¨è¿™æ ·åšçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¦‚ä½•å®ç°æˆ‘ä»¬è‡ªå·±çš„ AuthenticationProvider å’Œ UserDetailsSâ€‹â€‹ervice æ¥ä½¿ç”¨æˆ‘ä»¬çš„è‡ªå®šä¹‰èº«ä»½éªŒè¯æµç¨‹å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯ã€‚\nåŸæ–‡é“¾æ¥ï¼šhttps://www.tutorialspoint.com/spring_security/spring_security_form_login_with_database.htm\n","permalink":"https://blog.chensoul.cc/posts/2023/08/16/spring-security-form-login-with-database/","summary":"å†…å®¹ ç®€ä»‹å’Œæ¦‚è¿° Spring Security çš„åŸºæœ¬ç»„ä»¶ AuthenticationFilter è®¤è¯è¿‡æ»¤å™¨ AuthenticationManager è®¤è¯ç®¡ç†å™¨ AuthenticationProvider è®¤è¯æä¾›è€… UserDetailsService ç”¨æˆ·è¯¦æƒ…æœåŠ¡ PasswordEncoder å¯†ç ç¼–ç å™¨ Spring å®‰å…¨ä¸Šä¸‹æ–‡ è¡¨å•ç™»å½• ä½¿ç”¨æ•°æ®åº“ç™»å½• ç™»å½•å°è¯•é™åˆ¶ å…¥é—¨ï¼ˆå®ç”¨æŒ‡å—ï¼‰ ç®€ä»‹å’Œæ¦‚è¿° é™¤äº†æä¾›å„ç§å†…ç½®çš„èº«ä»½éªŒè¯å’Œæˆæƒé€‰é¡¹ä¹‹å¤–ï¼ŒSpring Security è¿˜å…è®¸æˆ‘ä»¬æ ¹æ®éœ€è¦è‡ªå®šä¹‰èº«ä»½éªŒè¯è¿‡ç¨‹ã€‚ä»è‡ªå®šä¹‰ç™»å½•é¡µé¢åˆ°æˆ‘ä»¬è‡ªå·±çš„è‡ªå®šä¹‰èº«ä»½éªŒè¯æä¾›ç¨‹åºå’Œèº«ä»½éªŒè¯è¿‡æ»¤å™¨ï¼Œæˆ‘ä»¬å‡ ä¹å¯ä»¥è‡ªå®šä¹‰èº«ä»½éªŒè¯è¿‡ç¨‹çš„å„ä¸ªæ–¹é¢ã€‚\næˆ‘ä»¬å¯ä»¥å®šä¹‰è‡ªå·±çš„èº«ä»½éªŒè¯è¿‡ç¨‹ï¼ŒèŒƒå›´å¯ä»¥ä»ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç çš„åŸºæœ¬èº«ä»½éªŒè¯åˆ°å¤æ‚çš„èº«ä»½éªŒè¯ï¼Œä¾‹å¦‚ä½¿ç”¨ä»¤ç‰Œå’Œ OTP çš„åŒå› ç´ èº«ä»½éªŒè¯ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å„ç§æ•°æ®åº“ - å…³ç³»æ•°æ®åº“å’Œéå…³ç³»æ•°æ®åº“ï¼Œä½¿ç”¨å„ç§å¯†ç ç¼–ç å™¨ï¼Œå°†æ¶æ„ç”¨æˆ·é”å®šåœ¨å…¶å¸æˆ·ä¹‹å¤–ï¼Œç­‰ç­‰ã€‚\nä»Šå¤©ï¼Œæˆ‘ä»¬å°†è®¨è®ºä¸‰ç§æ­¤ç±»è‡ªå®šä¹‰ï¼Œå³è‡ªå®šä¹‰è¡¨å•ç™»å½•ã€æ•°æ®åº“æä¾›çš„èº«ä»½éªŒè¯ä»¥åŠé™åˆ¶ç™»å½•å°è¯•ã€‚å°½ç®¡è¿™äº›éƒ½æ˜¯éå¸¸åŸºæœ¬çš„ç”¨ä¾‹ï¼Œä½†å®ƒä»¬ä»ç„¶å¯ä»¥è®©æˆ‘ä»¬æ›´ä»”ç»†åœ°äº†è§£ Spring Security çš„èº«ä»½éªŒè¯å’Œæˆæƒè¿‡ç¨‹ã€‚æˆ‘ä»¬è¿˜å°†å»ºç«‹ä¸€ä¸ªæ³¨å†Œé¡µé¢ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è¯¥é¡µé¢åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­è¿›è¡Œæ³¨å†Œã€‚\né¦–å…ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹ Spring Security çš„æ¶æ„ã€‚å®ƒä» servlet è¿‡æ»¤å™¨å¼€å§‹ã€‚è¿™äº›è¿‡æ»¤å™¨æ‹¦æˆªè¯·æ±‚ï¼Œå¯¹å…¶æ‰§è¡Œæ“ä½œï¼Œç„¶åå°†è¯·æ±‚ä¼ é€’åˆ°è¿‡æ»¤å™¨é“¾ä¸­çš„ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨æˆ–è¯·æ±‚å¤„ç†ç¨‹åºï¼Œæˆ–è€…åœ¨ä¸æ»¡è¶³æŸäº›æ¡ä»¶æ—¶é˜»æ­¢å®ƒä»¬ã€‚æ­£æ˜¯åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒSpring Security å¯ä»¥å¯¹è¯·æ±‚è¿›è¡Œèº«ä»½éªŒè¯å¹¶å¯¹è¯·æ±‚æ‰§è¡Œå„ç§èº«ä»½éªŒè¯æ£€æŸ¥ã€‚\nå®ƒè¿˜å¯ä»¥é€šè¿‡ä¸å…è®¸æœªç»èº«ä»½éªŒè¯æˆ–æ¶æ„è¯·æ±‚è®¿é—®æˆ‘ä»¬å—ä¿æŠ¤çš„èµ„æºæ¥é˜»æ­¢å®ƒä»¬é€šè¿‡ã€‚å› æ­¤æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå’Œèµ„æºå—åˆ°ä¿æŠ¤ã€‚\nSpring Security æ¶æ„çš„ç»„ä»¶ æ­£å¦‚æˆ‘ä»¬åœ¨ä¸Šå›¾ä¸­çœ‹åˆ°çš„é‚£æ ·ï¼ŒSpring Security çš„åŸºæœ¬ç»„ä»¶å¦‚ä¸‹æ‰€ç¤ºã€‚æˆ‘ä»¬å°†åœ¨è®¨è®ºè¿‡ç¨‹ä¸­ç®€è¦è®¨è®ºå®ƒä»¬ã€‚æˆ‘ä»¬è¿˜å°†è®¨è®ºå®ƒä»¬åœ¨èº«ä»½éªŒè¯å’Œæˆæƒè¿‡ç¨‹ä¸­çš„è§’è‰²ã€‚\nAuthenticationFilter è®¤è¯è¿‡æ»¤å™¨ è¿™æ˜¯æ‹¦æˆªè¯·æ±‚å¹¶å°è¯•å¯¹å…¶è¿›è¡Œèº«ä»½éªŒè¯çš„è¿‡æ»¤å™¨ã€‚åœ¨ Spring Security ä¸­ï¼Œå®ƒå°†è¯·æ±‚è½¬æ¢ä¸ºèº«ä»½éªŒè¯å¯¹è±¡å¹¶å°†èº«ä»½éªŒè¯å§”æ‰˜ç»™ AuthenticationManagerã€‚\nAuthenticationManager è®¤è¯ç®¡ç†å™¨ å®ƒæ˜¯èº«ä»½éªŒè¯çš„ä¸»è¦ç­–ç•¥æ¥å£ã€‚å®ƒä½¿ç”¨å•ç‹¬çš„æ–¹æ³• authenticate()æ¥éªŒè¯è¯·æ±‚ã€‚ authenticate() æ–¹æ³•æ‰§è¡Œèº«ä»½éªŒè¯ï¼Œå¹¶åœ¨èº«ä»½éªŒè¯æˆåŠŸæ—¶è¿”å› Authentication å¯¹è±¡ï¼Œæˆ–è€…åœ¨èº«ä»½éªŒè¯å¤±è´¥æ—¶æŠ›å‡º AuthenticationExceptionã€‚å¦‚æœè¯¥æ–¹æ³•æ— æ³•å†³å®šï¼Œå®ƒå°†è¿”å› nullã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­çš„è®¤è¯è¿‡ç¨‹å§”æ‰˜ç»™äº†æˆ‘ä»¬æ¥ä¸‹æ¥è¦è®¨è®ºçš„ AuthenticationProviderã€‚\nAuthenticationProvider è®¤è¯æä¾›è€… AuthenticationManager ç”± ProviderManager å®ç°ï¼Œåè€…å°†æµç¨‹å§”æ‰˜ç»™ä¸€ä¸ªæˆ–å¤šä¸ª AuthenticationProvider å®ä¾‹ã€‚ä»»ä½•å®ç° AuthenticationProvider æ¥å£çš„ç±»éƒ½å¿…é¡»å®ç°ä¸¤ä¸ªæ–¹æ³•â€”â€”authenticate() å’Œ supports()ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æ¥è°ˆè°ˆ supports()æ–¹æ³•ã€‚å®ƒç”¨äºæ£€æŸ¥æˆ‘ä»¬çš„ AuthenticationProvider å®ç°ç±»æ˜¯å¦æ”¯æŒç‰¹å®šçš„èº«ä»½éªŒè¯ç±»å‹ã€‚å¦‚æœæ”¯æŒåˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚\næ¥ä¸‹æ¥æ˜¯ authenticate() æ–¹æ³•ã€‚è¿™æ˜¯èº«ä»½éªŒè¯å‘ç”Ÿçš„åœ°æ–¹ã€‚å¦‚æœæ”¯æŒè¯¥è®¤è¯ç±»å‹ï¼Œåˆ™å¯åŠ¨è®¤è¯è¿‡ç¨‹ã€‚è¿™é‡Œè¿™ä¸ªç±»å¯ä»¥ä½¿ç”¨ UserDetailsSâ€‹â€‹ervice å®ç°çš„ loadUserByUsername() æ–¹æ³•ã€‚å¦‚æœæœªæ‰¾åˆ°ç”¨æˆ·ï¼Œåˆ™ä¼šæŠ›å‡º UsernameNotFoundExceptionã€‚\nå¦ä¸€æ–¹é¢ï¼Œå¦‚æœæ‰¾åˆ°ç”¨æˆ·ï¼Œåˆ™ä½¿ç”¨è¯¥ç”¨æˆ·çš„èº«ä»½éªŒè¯è¯¦ç»†ä¿¡æ¯æ¥éªŒè¯è¯¥ç”¨æˆ·ã€‚ä¾‹å¦‚ï¼Œåœ¨åŸºæœ¬è®¤è¯åœºæ™¯ä¸­ï¼Œå¯ä»¥å°†ç”¨æˆ·æä¾›çš„å¯†ç ä¸æ•°æ®åº“ä¸­çš„å¯†ç è¿›è¡Œæ ¸å¯¹ã€‚å¦‚æœå‘ç°å®ƒä»¬å½¼æ­¤åŒ¹é…ï¼Œåˆ™è¯´æ˜æˆåŠŸã€‚ç„¶åæˆ‘ä»¬å¯ä»¥ä»æ­¤æ–¹æ³•è¿”å›ä¸€ä¸ª Authentication å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å°†å­˜å‚¨åœ¨å®‰å…¨ä¸Šä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨ç¨åè®¨è®ºã€‚\nUserDetailsService ç”¨æˆ·è¯¦æƒ…æœåŠ¡ å®ƒæ˜¯ Spring Security çš„æ ¸å¿ƒæ¥å£ä¹‹ä¸€ã€‚ä»»ä½•è¯·æ±‚çš„èº«ä»½éªŒè¯ä¸»è¦å–å†³äº UserDetailsSâ€‹â€‹ervice æ¥å£çš„å®ç°ã€‚å®ƒæœ€å¸¸ç”¨äºæ•°æ®åº“æ”¯æŒçš„èº«ä»½éªŒè¯ä¸­ä»¥æ£€ç´¢ç”¨æˆ·æ•°æ®ã€‚é€šè¿‡å•ç‹¬çš„ loadUserByUsername() æ–¹æ³•çš„å®ç°æ¥æ£€ç´¢æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­æä¾›é€»è¾‘æ¥è·å–ç”¨æˆ·çš„ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ã€‚å¦‚æœæœªæ‰¾åˆ°ç”¨æˆ·ï¼Œè¯¥æ–¹æ³•å°†æŠ›å‡º UsernameNotFoundExceptionã€‚","title":"[è¯‘]Spring Security - ä½¿ç”¨æ•°æ®åº“è¡¨å•ç™»å½•"},{"content":"åœ¨ MySQL ä¸­ï¼Œè®¾è®¡æ ‘å½¢ç»“æ„çš„åŒºåŸŸè¡¨æœ‰å¤šç§æ–¹å¼ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„æ–¹æ¡ˆï¼š\nçˆ¶å­å…³ç³»ï¼ˆParent-Child Relationshipï¼‰æ¨¡å‹ï¼šåœ¨è¿™ç§æ¨¡å‹ä¸­ï¼Œæ¯ä¸ªè¡Œè®°å½•åŒ…å«ä¸€ä¸ªæŒ‡å‘å…¶çˆ¶çº§çš„å¼•ç”¨ã€‚å¯ä»¥ä½¿ç”¨ä¸€ä¸ªé¢å¤–çš„åˆ—æ¥å­˜å‚¨çˆ¶çº§ IDï¼Œæˆ–è€…ä½¿ç”¨è‡ªè¿æ¥è¡¨æ¥è¡¨ç¤ºå…³ç³»ã€‚è¿™ç§æ¨¡å‹ç®€å•ç›´è§‚ï¼Œæ˜“äºç†è§£å’Œç®¡ç†ã€‚ è·¯å¾„ï¼ˆPathï¼‰æ¨¡å‹ï¼šåœ¨è¿™ç§æ¨¡å‹ä¸­ï¼Œæ¯ä¸ªè¡Œè®°å½•éƒ½åŒ…å«ä¸€ä¸ªä»£è¡¨å…¶å®Œæ•´è·¯å¾„çš„å­—æ®µã€‚è·¯å¾„å¯ä»¥æ˜¯ä»¥æŸç§åˆ†éš”ç¬¦ï¼ˆå¦‚æ–œæ ï¼‰åˆ†éš”çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ï¼š/åœ°åŒº/å›½å®¶/åŸå¸‚ã€‚é€šè¿‡è§£æå’Œå¤„ç†è·¯å¾„å­—æ®µï¼Œå¯ä»¥è½»æ¾åœ°æŸ¥è¯¢çˆ¶çº§ã€å­çº§å’Œå…„å¼ŸèŠ‚ç‚¹ã€‚ åµŒå¥—é›†æ¨¡å‹ï¼ˆNested Set Modelï¼‰ï¼šè¿™æ˜¯ä¸€ç§åŸºäºå·¦å³å€¼çš„æ¨¡å‹ï¼Œé€šè¿‡é¢„å…ˆè®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„å·¦å³å€¼ï¼Œå¯ä»¥é«˜æ•ˆåœ°æŸ¥è¯¢æ ‘å½¢ç»“æ„ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªå·¦å€¼å’Œä¸€ä¸ªå³å€¼ï¼Œç”¨äºè¡¨ç¤ºå…¶åœ¨æ ‘ä¸­çš„ä½ç½®ã€‚è¿™ç§æ¨¡å‹é€‚ç”¨äºå¤§å‹æ ‘ç»“æ„ï¼Œä½†éœ€è¦ç‰¹æ®Šçš„æ“ä½œæ¥ç»´æŠ¤å·¦å³å€¼ã€‚ ç‰©åŒ–è·¯å¾„ï¼ˆMaterialized Pathï¼‰æ¨¡å‹ï¼šè¿™æ˜¯è·¯å¾„æ¨¡å‹çš„ä¸€ç§æ”¹è¿›ç‰ˆæœ¬ï¼Œå®ƒä½¿ç”¨é¢å¤–çš„åˆ—æ¥å­˜å‚¨èŠ‚ç‚¹çš„å±‚çº§å…³ç³»ã€‚é™¤äº†è·¯å¾„å­—æ®µå¤–ï¼Œè¿˜å¯ä»¥æ·»åŠ ä¸€ä¸ªè¡¨ç¤ºèŠ‚ç‚¹çº§åˆ«çš„å­—æ®µã€‚è¿™æ ·å¯ä»¥æ›´é«˜æ•ˆåœ°è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶ä¸”å¯ä»¥è½»æ¾åœ°è·å–èŠ‚ç‚¹çš„çˆ¶çº§ã€å­çº§å’Œå…„å¼ŸèŠ‚ç‚¹ã€‚ çˆ¶å­å…³ç³»ï¼ˆParent-Child Relationshipï¼‰æ¨¡å‹ çˆ¶å­å…³ç³»ï¼ˆParent-Child Relationshipï¼‰æ¨¡å‹æ˜¯ä¸€ç§åœ¨ MySQL ä¸­è®¾è®¡æ ‘å½¢ç»“æ„çš„æ–¹å¼ã€‚åœ¨è¯¥æ¨¡å‹ä¸­ï¼Œæ¯ä¸ªåŒºåŸŸè®°å½•åŒ…å«ä¸€ä¸ªæŒ‡å‘å…¶çˆ¶çº§åŒºåŸŸçš„å¼•ç”¨ã€‚é€šè¿‡è¿™ç§çˆ¶å­å…³ç³»ï¼Œå¯ä»¥å»ºç«‹åŒºåŸŸä¹‹é—´çš„å±‚çº§ç»“æ„ã€‚\nä»¥åŒºåŸŸä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸º\u0026quot;area\u0026quot;çš„è¡¨æ¥å­˜å‚¨åŒºåŸŸä¿¡æ¯ã€‚è¯¥è¡¨å¯ä»¥åŒ…å«ä»¥ä¸‹åˆ—ï¼š\nidï¼šåŒºåŸŸçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆä¸»é”®ï¼‰ nameï¼šåŒºåŸŸçš„åç§° parent_idï¼šæŒ‡å‘çˆ¶çº§åŒºåŸŸçš„å¼•ç”¨ é€šè¿‡ä½¿ç”¨çˆ¶å­å…³ç³»æ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä»¥ä¸‹åŒºåŸŸçš„å±‚çº§ç»“æ„ï¼š\nid | name | parent_id --------------------------- 1 | ä¸–ç•Œ | NULL 2 | äºšæ´² | 1 3 | æ¬§æ´² | 1 4 | åŒ—ç¾æ´² | 1 5 | ä¸­å›½ | 2 6 | æ—¥æœ¬ | 2 7 | å¾·å›½ | 3 8 | æ³•å›½ | 3 9 | ç¾å›½ | 4 10 | åŠ æ‹¿å¤§ | 4 11 | åŒ—äº¬å¸‚ | 5 12 | ä¸Šæµ·å¸‚ | 5 13 | ä¸œäº¬éƒ½ | 6 14 | æ¨ªæ»¨å¸‚ | 6 åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œ\u0026ldquo;area\u0026quot;è¡¨çš„æ¯ä¸€è¡Œä»£è¡¨ä¸€ä¸ªåŒºåŸŸï¼Œé€šè¿‡\u0026quot;parent_id\u0026quot;åˆ—å»ºç«‹çˆ¶å­å…³ç³»ã€‚æ ¹åŒºåŸŸï¼ˆä¸–ç•Œï¼‰çš„\u0026quot;parent_id\u0026quot;ä¸º NULLï¼Œè¡¨ç¤ºæ²¡æœ‰çˆ¶çº§åŒºåŸŸã€‚å…¶ä»–åŒºåŸŸé€šè¿‡æŒ‡å®šçˆ¶çº§åŒºåŸŸçš„\u0026quot;id\u0026quot;æ¥å»ºç«‹å±‚çº§å…³ç³»ã€‚\næŸ¥è¯¢çˆ¶åŒºåŸŸ ä½¿ç”¨è¿™ç§æ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°æŸ¥è¯¢åŒºåŸŸçš„çˆ¶çº§ã€å­çº§å’Œå…„å¼ŸèŠ‚ç‚¹ã€‚ä¾‹å¦‚ï¼Œè¦æŸ¥æ‰¾ä¸­å›½çš„çˆ¶çº§åŒºåŸŸï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æŸ¥è¯¢å®ç°ï¼š\nSELECT * FROM area WHERE id = ( SELECT parent_id FROM area WHERE name = \u0026#39;ä¸­å›½\u0026#39; ); è¦æŸ¥è¯¢ä¸­å›½çš„æ‰€æœ‰çˆ¶çº§åŒºåŸŸï¼Œå¯ä»¥ä½¿ç”¨é€’å½’æŸ¥è¯¢ï¼ˆRecursive Queryï¼‰æ¥å®ç°ã€‚åœ¨ MySQL ä¸­ï¼Œé€’å½’æŸ¥è¯¢å¯ä»¥ä½¿ç”¨WITH RECURSIVEå…³é”®å­—è¿›è¡Œæ„å»ºã€‚ä»¥ä¸‹æ˜¯ä¸€æ¡æŸ¥è¯¢ä¸­å›½çš„æ‰€æœ‰çˆ¶çº§åŒºåŸŸçš„ SQL è¯­å¥ï¼š\nWITH RECURSIVE area_hierarchy AS ( SELECT id, name, parent_id FROM area WHERE name = \u0026#39;ä¸­å›½\u0026#39; UNION ALL SELECT r.id, r.name, r.parent_id FROM area r INNER JOIN area_hierarchy rh ON r.id = rh.parent_id ) SELECT * FROM area_hierarchy; ä¸Šè¿°æŸ¥è¯¢è¯­å¥ä½¿ç”¨äº† WITH RECURSIVE å­å¥æ¥åˆ›å»ºåä¸º\u0026quot;area_hierarchy\u0026quot;çš„é€’å½’æŸ¥è¯¢ã€‚åˆå§‹æŸ¥è¯¢é€‰æ‹©åç§°ä¸º\u0026quot;ä¸­å›½\u0026quot;çš„åŒºåŸŸè®°å½•ä½œä¸ºèµ·å§‹ç‚¹ã€‚ç„¶åï¼Œä½¿ç”¨ UNION ALL å°†åˆå§‹æŸ¥è¯¢ç»“æœä¸åç»­çš„é€’å½’æŸ¥è¯¢ç»“æœè¿æ¥èµ·æ¥ï¼Œé€šè¿‡è¿æ¥æ¡ä»¶å°†çˆ¶çº§åŒºåŸŸä¸å­çº§åŒºåŸŸå…³è”èµ·æ¥ï¼Œç›´åˆ°æ²¡æœ‰æ›´å¤šçš„çˆ¶çº§åŒºåŸŸå¯ä¾›è¿æ¥ã€‚\næœ€ç»ˆçš„ SELECT è¯­å¥ä»\u0026quot;area_hierarchy\u0026quot;ä¸­é€‰æ‹©æ‰€æœ‰çš„çˆ¶çº§åŒºåŸŸè®°å½•ï¼Œå¹¶è¿”å›ç»“æœé›†ã€‚\nè¯·æ³¨æ„ï¼Œä¸Šè¿°æŸ¥è¯¢å‡è®¾åŒºåŸŸçš„åç§°ï¼ˆnameï¼‰åˆ—æ˜¯å”¯ä¸€çš„ï¼Œå› æ­¤ä½¿ç”¨åç§°è¿›è¡ŒæŸ¥è¯¢æ˜¯å‡†ç¡®çš„ã€‚å¦‚æœå­˜åœ¨å¤šä¸ªå…·æœ‰ç›¸åŒåç§°çš„åŒºåŸŸè®°å½•ï¼Œå¯èƒ½éœ€è¦æ ¹æ®å…¶ä»–æ¡ä»¶è¿›è¡Œè¿›ä¸€æ­¥çš„ç­›é€‰ã€‚\næŸ¥è¯¢å­åŒºåŸŸ åŒæ ·åœ°ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥è¯¢ä¸­å›½çš„å­çº§åŒºåŸŸï¼Œä¾‹å¦‚ï¼š\nSELECT * FROM area WHERE parent_id = ( SELECT id FROM area WHERE name = \u0026#39;ä¸­å›½\u0026#39; ); è¦æŸ¥è¯¢ä¸­å›½çš„æ‰€æœ‰å­çº§åŒºåŸŸï¼Œå¯ä»¥ä½¿ç”¨é€’å½’æŸ¥è¯¢ï¼ˆRecursive Queryï¼‰æ¥å®ç°ã€‚åœ¨ MySQL ä¸­ï¼Œé€’å½’æŸ¥è¯¢å¯ä»¥ä½¿ç”¨ WITH RECURSIVE å…³é”®å­—è¿›è¡Œæ„å»ºã€‚ä»¥ä¸‹æ˜¯ä¸€æ¡æŸ¥è¯¢ä¸­å›½çš„æ‰€æœ‰å­çº§åŒºåŸŸçš„ SQL è¯­å¥ï¼š\nWITH RECURSIVE area_hierarchy AS ( SELECT id, name, parent_id FROM area WHERE name = \u0026#39;ä¸­å›½\u0026#39; UNION ALL SELECT r.id, r.name, r.parent_id FROM area r INNER JOIN area_hierarchy rh ON r.parent_id = rh.id ) SELECT * FROM area_hierarchy; ä¸Šè¿°æŸ¥è¯¢è¯­å¥ä½¿ç”¨äº† WITH RECURSIVE å­å¥æ¥åˆ›å»ºåä¸º\u0026quot;area_hierarchy\u0026quot;çš„é€’å½’æŸ¥è¯¢ã€‚åˆå§‹æŸ¥è¯¢é€‰æ‹©åç§°ä¸º\u0026quot;ä¸­å›½\u0026quot;çš„åŒºåŸŸè®°å½•ä½œä¸ºèµ·å§‹ç‚¹ã€‚ç„¶åï¼Œä½¿ç”¨ UNION ALL å°†åˆå§‹æŸ¥è¯¢ç»“æœä¸åç»­çš„é€’å½’æŸ¥è¯¢ç»“æœè¿æ¥èµ·æ¥ï¼Œé€šè¿‡è¿æ¥æ¡ä»¶å°†å­çº§åŒºåŸŸä¸çˆ¶çº§åŒºåŸŸå…³è”èµ·æ¥ï¼Œç›´åˆ°æ²¡æœ‰æ›´å¤šçš„å­çº§åŒºåŸŸå¯ä¾›è¿æ¥ã€‚\næœ€ç»ˆçš„ SELECT è¯­å¥ä»\u0026quot;area_hierarchy\u0026quot;ä¸­é€‰æ‹©æ‰€æœ‰çš„å­çº§åŒºåŸŸè®°å½•ï¼Œå¹¶è¿”å›ç»“æœé›†ã€‚\nè¯·æ³¨æ„ï¼Œä¸Šè¿°æŸ¥è¯¢å‡è®¾åŒºåŸŸçš„åç§°ï¼ˆnameï¼‰åˆ—æ˜¯å”¯ä¸€çš„ï¼Œå› æ­¤ä½¿ç”¨åç§°è¿›è¡ŒæŸ¥è¯¢æ˜¯å‡†ç¡®çš„ã€‚å¦‚æœå­˜åœ¨å¤šä¸ªå…·æœ‰ç›¸åŒåç§°çš„åŒºåŸŸè®°å½•ï¼Œå¯èƒ½éœ€è¦æ ¹æ®å…¶ä»–æ¡ä»¶è¿›è¡Œè¿›ä¸€æ­¥çš„ç­›é€‰ã€‚\næŸ¥è¯¢å±‚çº§ è¦æŸ¥è¯¢åŒºåŸŸçš„å±‚çº§ï¼Œå¯ä»¥ä½¿ç”¨é€’å½’æŸ¥è¯¢ï¼ˆRecursive Queryï¼‰æ¥å®ç°ã€‚ä»¥ä¸‹æ˜¯ä¸€æ¡æŸ¥è¯¢åŒºåŸŸçš„å±‚çº§çš„ SQL è¯­å¥ï¼š\nWITH RECURSIVE area_hierarchy AS ( SELECT id, name, parent_id, 0 AS level FROM area WHERE parent_id IS NULL UNION ALL SELECT r.id, r.name, r.parent_id, rh.level + 1 FROM area r INNER JOIN area_hierarchy rh ON r.parent_id = rh.id ) SELECT id, name, level FROM area_hierarchy; ä¸Šè¿°æŸ¥è¯¢è¯­å¥ä½¿ç”¨äº† WITH RECURSIVE å­å¥æ¥åˆ›å»ºåä¸º\u0026quot;area_hierarchy\u0026quot;çš„é€’å½’æŸ¥è¯¢ã€‚åˆå§‹æŸ¥è¯¢é€‰æ‹©æ²¡æœ‰çˆ¶çº§åŒºåŸŸï¼ˆæ ¹åŒºåŸŸï¼‰çš„è®°å½•ä½œä¸ºèµ·å§‹ç‚¹ï¼Œå¹¶å°†å±‚çº§ï¼ˆlevelï¼‰è®¾ç½®ä¸º 0ã€‚ç„¶åï¼Œä½¿ç”¨ UNION ALL å°†åˆå§‹æŸ¥è¯¢ç»“æœä¸åç»­çš„é€’å½’æŸ¥è¯¢ç»“æœè¿æ¥èµ·æ¥ï¼Œé€šè¿‡è¿æ¥æ¡ä»¶å°†å­çº§åŒºåŸŸä¸çˆ¶çº§åŒºåŸŸå…³è”èµ·æ¥ï¼Œå¹¶é€’å¢å±‚çº§ï¼ˆlevelï¼‰ã€‚\næœ€ç»ˆçš„ SELECT è¯­å¥ä»\u0026quot;area_hierarchy\u0026quot;ä¸­é€‰æ‹©åŒºåŸŸçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆidï¼‰ã€åç§°ï¼ˆnameï¼‰å’Œå±‚çº§ï¼ˆlevelï¼‰å­—æ®µï¼Œå¹¶è¿”å›ç»“æœé›†ã€‚\næŸ¥è¯¢ç»“æœå°†åŒ…å«æ¯ä¸ªåŒºåŸŸçš„å”¯ä¸€æ ‡è¯†ç¬¦ã€åç§°å’Œå…¶åœ¨å±‚çº§ç»“æ„ä¸­çš„å±‚çº§ä¿¡æ¯ã€‚\nè¯·æ³¨æ„ï¼Œä¸Šè¿°æŸ¥è¯¢å‡è®¾åŒºåŸŸçš„çˆ¶å­å…³ç³»æ˜¯æ­£ç¡®çš„ï¼Œä¸”æ²¡æœ‰å¾ªç¯ä¾èµ–ã€‚å¦‚æœå­˜åœ¨é”™è¯¯çš„çˆ¶å­å…³ç³»æˆ–å¾ªç¯ä¾èµ–ï¼Œå¯èƒ½ä¼šå¯¼è‡´æŸ¥è¯¢ç»“æœä¸å‡†ç¡®æˆ–äº§ç”Ÿæ— é™é€’å½’ã€‚\nè·¯å¾„ï¼ˆPathï¼‰æ¨¡å‹ è·¯å¾„ï¼ˆPathï¼‰æ¨¡å‹æ˜¯ä¸€ç§åœ¨æ•°æ®åº“ä¸­è¡¨ç¤ºå±‚çº§ç»“æ„çš„æ–¹æ³•ï¼Œå®ƒä½¿ç”¨åŒ…å«å®Œæ•´è·¯å¾„ä¿¡æ¯çš„å­—æ®µæ¥è¡¨ç¤ºæ¯ä¸ªèŠ‚ç‚¹çš„ä½ç½®ã€‚æ¯ä¸ªèŠ‚ç‚¹çš„è·¯å¾„ç”±å…¶ç¥–å…ˆèŠ‚ç‚¹çš„æ ‡è¯†ç¬¦æ„æˆï¼Œä»¥ç‰¹å®šçš„åˆ†éš”ç¬¦åˆ†éš”å¼€æ¥ã€‚è·¯å¾„æ¨¡å‹å¯ä»¥ç”¨äºè¡¨ç¤ºæ ‘å½¢ç»“æ„ã€ç»„ç»‡ç»“æ„ç­‰ã€‚\nä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨è·¯å¾„æ¨¡å‹è¡¨ç¤ºåœ°ç†åŒºåŸŸçš„ç¤ºä¾‹ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º\u0026quot;area\u0026quot;çš„è¡¨ï¼Œå…¶ä¸­åŒ…å«ä»¥ä¸‹åˆ—ï¼š\nidï¼šåŒºåŸŸçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆä¸»é”®ï¼‰ nameï¼šåŒºåŸŸçš„åç§° pathï¼šåŒºåŸŸçš„è·¯å¾„ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è·¯å¾„æ¨¡å‹æ¥è¡¨ç¤ºä»¥ä¸‹åœ°ç†åŒºåŸŸçš„å±‚çº§ç»“æ„ã€‚\nç¬¬ä¸€ç§ï¼Œpath åŒ…æ‹¬çˆ¶èŠ‚ç‚¹ ID å’Œå½“å‰èŠ‚ç‚¹ IDï¼Œä½¿ç”¨/ä½œä¸ºåˆ†éš”ç¬¦ã€‚\nid | name | path --------------------------- 1 | ä¸–ç•Œ | /1/ 2 | äºšæ´² | /1/2/ 3 | æ¬§æ´² | /1/3/ 4 | åŒ—ç¾æ´² | /1/4/ 5 | ä¸­å›½ | /1/2/5/ 6 | æ—¥æœ¬ | /1/2/6/ 7 | å¾·å›½ | /1/3/7/ 8 | æ³•å›½ | /1/3/8/ 9 | ç¾å›½ | /1/4/9/ 10 | åŠ æ‹¿å¤§ | /1/4/10/ 11 | åŒ—äº¬å¸‚ | /1/2/5/11/ 12 | ä¸Šæµ·å¸‚ | /1/2/5/12/ 13 | ä¸œäº¬éƒ½ | /1/2/6/13/ 14 | æ¨ªæ»¨å¸‚ | /1/2/6/14/ åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæ¯ä¸ªåŒºåŸŸçš„è·¯å¾„åˆ—ï¼ˆpathï¼‰éƒ½ä»¥æ–œæ ï¼ˆ/ï¼‰å¼€å§‹å’Œç»“æŸã€‚ä¾‹å¦‚ï¼Œä¸­å›½çš„è·¯å¾„ä¸º\u0026rdquo;/1/2/5/\u0026quot;ï¼Œè¡¨ç¤ºä»æ ¹åŒºåŸŸï¼ˆid ä¸º 1ï¼‰åˆ°ä¸­å›½çš„è·¯å¾„ã€‚\nç¬¬ä¸€ç§ï¼Œpath åŒ…æ‹¬åªçˆ¶èŠ‚ç‚¹ IDï¼Œä¸åŒ…æ‹¬å½“å‰èŠ‚ç‚¹ IDï¼Œä½¿ç”¨/ä½œä¸ºåˆ†éš”ç¬¦ã€‚\nid | name | path ---+----------+--------- 1 | ä¸–ç•Œ | / 2 | äºšæ´² | /1/ 3 | æ¬§æ´² | /1/ 4 | åŒ—ç¾æ´² | /1/ 5 | ä¸­å›½ | /1/2/ 6 | æ—¥æœ¬ | /1/2/ 7 | å¾·å›½ | /1/3/ 8 | æ³•å›½ | /1/3/ 9 | ç¾å›½ | /1/4/ 10 | çº½çº¦ | /1/4/9/ 11 | åŠ åˆ©ç¦å°¼äºš | /1/4/9/ å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œä¸ªäººå€¾å‘äºä½¿ç”¨ç¬¬äºŒç§ã€‚ç¬¬ä¸€ç§ï¼Œéœ€è¦ä¿å­˜åŒºåŸŸä¹‹åï¼Œå°† id æ‹¼æ¥åˆ° path åšä¸€æ¬¡æ›´æ–°æ“ä½œï¼›è€Œç¬¬äºŒç§åªç”¨åšä¸€æ¬¡æ’å…¥æ“ä½œå³å¯ã€‚\nç¬¬äºŒç§å»ºè¡¨è¯­å¥ï¼š\nCREATE TABLE area ( id INT PRIMARY KEY, name VARCHAR(255), path VARCHAR(255) ); æ’å…¥ç¤ºä¾‹æ•°æ®çš„è¯­å¥ï¼š\nINSERT INTO area (id, name, path) VALUES (1, \u0026#39;ä¸–ç•Œ\u0026#39;, \u0026#39;/\u0026#39;), (2, \u0026#39;äºšæ´²\u0026#39;, \u0026#39;/1/\u0026#39;), (3, \u0026#39;æ¬§æ´²\u0026#39;, \u0026#39;/1/\u0026#39;), (4, \u0026#39;åŒ—ç¾æ´²\u0026#39;, \u0026#39;/1/\u0026#39;), (5, \u0026#39;ä¸­å›½\u0026#39;, \u0026#39;/1/2/\u0026#39;), (6, \u0026#39;æ—¥æœ¬\u0026#39;, \u0026#39;/1/2/\u0026#39;), (7, \u0026#39;å¾·å›½\u0026#39;, \u0026#39;/1/3/\u0026#39;), (8, \u0026#39;æ³•å›½\u0026#39;, \u0026#39;/1/3/\u0026#39;), (9, \u0026#39;ç¾å›½\u0026#39;, \u0026#39;/1/4/\u0026#39;), (10, \u0026#39;çº½çº¦\u0026#39;, \u0026#39;/1/4/9/\u0026#39;), (11, \u0026#39;åŠ åˆ©ç¦å°¼äºš\u0026#39;, \u0026#39;/1/4/9/\u0026#39;); æŸ¥è¯¢çˆ¶èŠ‚ç‚¹ æŸ¥è¯¢æŒ‡å®šèŠ‚ç‚¹çš„ç›´æ¥çˆ¶èŠ‚ç‚¹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ SQL æŸ¥è¯¢è¯­å¥ï¼š\nSELECT *, SUBSTRING_INDEX(SUBSTRING_INDEX(path, \u0026#39;/\u0026#39;, -2), \u0026#39;/\u0026#39;, 1) AS parent_id, (LENGTH(path) - LENGTH(REPLACE(path, \u0026#39;/\u0026#39;, \u0026#39;\u0026#39;))) AS level FROM area WHERE \u0026#39;your_specific_path\u0026#39; = CONCAT(path, id, \u0026#39;/\u0026#39;) æŸ¥è¯¢æŒ‡å®šèŠ‚ç‚¹çš„æ‰€æœ‰çˆ¶èŠ‚ç‚¹\nSELECT *, SUBSTRING_INDEX(SUBSTRING_INDEX(path, \u0026#39;/\u0026#39;, -2), \u0026#39;/\u0026#39;, 1) AS parent_id, (LENGTH(path) - LENGTH(REPLACE(path, \u0026#39;/\u0026#39;, \u0026#39;\u0026#39;))) AS level FROM area WHERE \u0026#39;your_specific_path\u0026#39; = CONCAT(path, id, \u0026#39;%\u0026#39;) ORDER BY LENGTH(path); è¯·å°† your_specific_path æ›¿æ¢ä¸ºæ‚¨è¦æŸ¥æ‰¾ç›´æ¥çˆ¶èŠ‚ç‚¹çš„èŠ‚ç‚¹çš„å®é™…è·¯å¾„å€¼ã€‚\næŸ¥è¯¢å­èŠ‚ç‚¹ è¦æŸ¥è¯¢æŒ‡å®šèŠ‚ç‚¹çš„ç›´æ¥å­èŠ‚ç‚¹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ SQL æŸ¥è¯¢è¯­å¥ï¼š\nSELECT *, SUBSTRING_INDEX(SUBSTRING_INDEX(path, \u0026#39;/\u0026#39;, -2), \u0026#39;/\u0026#39;, 1) AS parent_id, (LENGTH(path) - LENGTH(REPLACE(path, \u0026#39;/\u0026#39;, \u0026#39;\u0026#39;))) AS level FROM area WHERE path = CONCAT(\u0026#39;your_specific_path\u0026#39;,\u0026#39;your_specific_id\u0026#39;,\u0026#39;/\u0026#39;) æŸ¥è¯¢æŒ‡å®šèŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼š\nSELECT *, SUBSTRING_INDEX(SUBSTRING_INDEX(path, \u0026#39;/\u0026#39;, -2), \u0026#39;/\u0026#39;, 1) AS parent_id, (LENGTH(path) - LENGTH(REPLACE(path, \u0026#39;/\u0026#39;, \u0026#39;\u0026#39;))) AS level FROM area WHERE path like CONCAT(\u0026#39;your_specific_path\u0026#39;,\u0026#39;your_specific_id\u0026#39;,\u0026#39;%\u0026#39;) æŸ¥è¯¢å…„å¼ŸèŠ‚ç‚¹ æŸ¥è¯¢æŒ‡å®šèŠ‚ç‚¹çš„å…„å¼ŸèŠ‚ç‚¹ï¼š\nSELECT *, SUBSTRING_INDEX(SUBSTRING_INDEX(path, \u0026#39;/\u0026#39;, -2), \u0026#39;/\u0026#39;, 1) AS parent_id, (LENGTH(path) - LENGTH(REPLACE(path, \u0026#39;/\u0026#39;, \u0026#39;\u0026#39;))) AS level FROM area WHERE path = \u0026#39;your_specific_path\u0026#39; and id \u0026lt;\u0026gt; \u0026#39;your_specific_id\u0026#39; æŸ¥è¯¢å¶å­èŠ‚ç‚¹ æŸ¥è¯¢æ‰€æœ‰çš„å¶å­èŠ‚ç‚¹ï¼š\nSELECT *, SUBSTRING_INDEX(SUBSTRING_INDEX(path, \u0026#39;/\u0026#39;, -2), \u0026#39;/\u0026#39;, 1) AS parent_id, (LENGTH(path) - LENGTH(REPLACE(path, \u0026#39;/\u0026#39;, \u0026#39;\u0026#39;))) AS level FROM area WHERE id NOT IN ( SELECT DISTINCT SUBSTRING_INDEX(SUBSTRING_INDEX(path, \u0026#39;/\u0026#39;, -2), \u0026#39;/\u0026#39;, 1) FROM area WHERE path LIKE \u0026#39;/%\u0026#39; ); åˆ¤æ–­æ˜¯å¦ä¸ºå¶å­èŠ‚ç‚¹ åˆ¤æ–­æŒ‡å®šèŠ‚ç‚¹æ˜¯å¦ä¸ºå¶å­èŠ‚ç‚¹ï¼š\nSELECT count(1)=0 FROM area WHERE path LIKE CONCAT(\u0026#39;your_specific_path\u0026#39;,\u0026#39;your_specific_id\u0026#39;,\u0026#39;%\u0026#39;) åµŒå¥—é›†æ¨¡å‹ï¼ˆNested Set Modelï¼‰ åµŒå¥—é›†æ¨¡å‹ï¼ˆNested Set Modelï¼‰æ˜¯ä¸€ç§ç”¨äºè¡¨ç¤ºæ ‘å½¢ç»“æ„æ•°æ®çš„æ•°æ®åº“è®¾è®¡æ¨¡å¼ã€‚å®ƒä½¿ç”¨å·¦å³å€¼ï¼ˆLeft and Right Valuesï¼‰æ¥è¡¨ç¤ºæ¯ä¸ªèŠ‚ç‚¹åœ¨æ ‘ä¸­çš„ä½ç½®å…³ç³»ã€‚åµŒå¥—é›†æ¨¡å‹çš„ç‰¹ç‚¹æ˜¯å¯ä»¥é«˜æ•ˆåœ°æ‰§è¡Œæ ‘å½¢ç»“æ„çš„æŸ¥è¯¢ï¼Œå¦‚è·å–èŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹ã€çˆ¶èŠ‚ç‚¹ã€å…„å¼ŸèŠ‚ç‚¹ç­‰ã€‚\nåœ¨åµŒå¥—é›†æ¨¡å‹ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸¤ä¸ªå€¼ï¼šå·¦å€¼ï¼ˆLeft Valueï¼‰å’Œå³å€¼ï¼ˆRight Valueï¼‰ã€‚å·¦å€¼è¡¨ç¤ºèŠ‚ç‚¹åœ¨æ ‘ä¸­çš„è¿›å…¥é¡ºåºï¼Œå³å€¼è¡¨ç¤ºèŠ‚ç‚¹åœ¨æ ‘ä¸­çš„ç¦»å¼€é¡ºåºã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥ç”¨ä¸€ä¸ªèŒƒå›´ï¼ˆå·¦å€¼å’Œå³å€¼ä¹‹é—´çš„èŒƒå›´ï¼‰æ¥è¡¨ç¤ºã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºäº†ä½¿ç”¨åµŒå¥—é›†æ¨¡å‹è¡¨ç¤ºçš„æ ‘å½¢ç»“æ„ï¼š\nid | name | left_value | right_value ----------------------------------------- 1 | ä¸–ç•Œ | 1 | 14 2 | äºšæ´² | 2 | 9 3 | æ¬§æ´² | 3 | 8 4 | åŒ—ç¾æ´² | 10 | 13 5 | ä¸­å›½ | 4 | 7 6 | æ—¥æœ¬ | 5 | 6 7 | å¾·å›½ | 11 | 12 åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨åµŒå¥—é›†æ¨¡å‹è¡¨ç¤ºäº†ä¸€æ£µæ ‘å½¢ç»“æ„ï¼Œå…¶ä¸­åŒ…å«äº†ä¸–ç•Œã€äºšæ´²ã€æ¬§æ´²ã€åŒ—ç¾æ´²ã€ä¸­å›½ã€æ—¥æœ¬å’Œå¾·å›½ç­‰åŒºåŸŸã€‚\nä¸–ç•Œæ˜¯æ ¹èŠ‚ç‚¹ï¼Œå…¶å·¦å€¼ä¸º 1ï¼Œå³å€¼ä¸º 14ã€‚ äºšæ´²æ˜¯ä¸–ç•Œçš„å­èŠ‚ç‚¹ï¼Œå…¶å·¦å€¼ä¸º 2ï¼Œå³å€¼ä¸º 9ã€‚ æ¬§æ´²æ˜¯ä¸–ç•Œçš„å­èŠ‚ç‚¹ï¼Œå…¶å·¦å€¼ä¸º 3ï¼Œå³å€¼ä¸º 8ã€‚ åŒ—ç¾æ´²æ˜¯ä¸–ç•Œçš„å­èŠ‚ç‚¹ï¼Œå…¶å·¦å€¼ä¸º 10ï¼Œå³å€¼ä¸º 13ã€‚ ä¸­å›½æ˜¯äºšæ´²çš„å­èŠ‚ç‚¹ï¼Œå…¶å·¦å€¼ä¸º 4ï¼Œå³å€¼ä¸º 7ã€‚ æ—¥æœ¬æ˜¯äºšæ´²çš„å­èŠ‚ç‚¹ï¼Œå…¶å·¦å€¼ä¸º 5ï¼Œå³å€¼ä¸º 6ã€‚ å¾·å›½æ˜¯æ¬§æ´²çš„å­èŠ‚ç‚¹ï¼Œå…¶å·¦å€¼ä¸º 11ï¼Œå³å€¼ä¸º 12ã€‚ é€šè¿‡ä½¿ç”¨å·¦å³å€¼ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°æ‰§è¡Œä¸€äº›å¸¸è§çš„æ ‘å½¢ç»“æ„æŸ¥è¯¢ï¼š\nè·å–ä¸­å›½çš„æ‰€æœ‰å­åŒºåŸŸï¼š\nSELECT * FROM area WHERE left_value \u0026gt; 4 AND right_value \u0026lt; 7; è·å–äºšæ´²çš„çˆ¶åŒºåŸŸï¼š\nSELECT * FROM area WHERE left_value \u0026lt; 2 AND right_value \u0026gt; 9 LIMIT 1; è·å–æ—¥æœ¬çš„æ‰€æœ‰å…„å¼ŸåŒºåŸŸï¼š\nSELECT * FROM area WHERE left_value \u0026gt; 4 AND right_value \u0026lt; 7 AND id != 6; ç‰©åŒ–è·¯å¾„ï¼ˆMaterialized Pathï¼‰æ¨¡å‹ ææ–™åŒ–è·¯å¾„ï¼ˆMaterialized Pathï¼‰æ¨¡å‹ï¼šè¿™æ˜¯è·¯å¾„æ¨¡å‹çš„ä¸€ç§æ”¹è¿›ç‰ˆæœ¬ï¼Œå®ƒä½¿ç”¨é¢å¤–çš„åˆ—æ¥å­˜å‚¨èŠ‚ç‚¹çš„å±‚çº§å…³ç³»ã€‚é™¤äº†è·¯å¾„å­—æ®µå¤–ï¼Œè¿˜å¯ä»¥æ·»åŠ ä¸€ä¸ªè¡¨ç¤ºèŠ‚ç‚¹çº§åˆ«çš„å­—æ®µã€‚è¿™æ ·å¯ä»¥æ›´é«˜æ•ˆåœ°è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶ä¸”å¯ä»¥è½»æ¾åœ°è·å–èŠ‚ç‚¹çš„çˆ¶çº§ã€å­çº§å’Œå…„å¼ŸèŠ‚ç‚¹ã€‚\nä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºäº†ä½¿ç”¨å¸¦æœ‰å±‚çº§å­—æ®µçš„è·¯å¾„æ¨¡å‹è¡¨ç¤ºåŒºåŸŸçš„æ•°æ®ï¼š\nid | name | path | depth ------------------------------------- 1 | ä¸–ç•Œ | /1/ | 0 2 | äºšæ´² | /1/2/ | 1 3 | æ¬§æ´² | /1/3/ | 1 4 | åŒ—ç¾æ´² | /1/4/ | 1 5 | ä¸­å›½ | /1/2/5/ | 2 6 | æ—¥æœ¬ | /1/2/6/ | 2 7 | å¾·å›½ | /1/3/7/ | 2 åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œé™¤äº†è·¯å¾„å­—æ®µï¼ˆpathï¼‰å¤–ï¼Œå¢åŠ äº†ä¸€ä¸ªè¡¨ç¤ºèŠ‚ç‚¹å±‚çº§ï¼ˆdepthï¼‰çš„åˆ—ã€‚èŠ‚ç‚¹çš„å±‚çº§ä¿¡æ¯è¡¨ç¤ºäº†èŠ‚ç‚¹åœ¨æ ‘ä¸­çš„æ·±åº¦ï¼Œæ ¹èŠ‚ç‚¹çš„å±‚çº§é€šå¸¸ä¸º 0ã€‚\né€šè¿‡æ·»åŠ å±‚çº§å­—æ®µï¼Œå¯ä»¥æ›´é«˜æ•ˆåœ°è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶ä¸”è½»æ¾åœ°è·å–èŠ‚ç‚¹çš„çˆ¶çº§ã€å­çº§å’Œå…„å¼ŸèŠ‚ç‚¹ã€‚ä¾‹å¦‚ï¼š\nè·å–èŠ‚ç‚¹çš„çˆ¶çº§èŠ‚ç‚¹ï¼š\nSELECT * FROM area WHERE depth = \u0026lt;node_depth\u0026gt; - 1; è·å–èŠ‚ç‚¹çš„çˆ¶çº§èŠ‚ç‚¹\nSELECT * FROM area WHERE depth \u0026lt; \u0026lt;node_depth\u0026gt; åœ¨ä¸Šè¿°æŸ¥è¯¢ä¸­ï¼Œå‡è®¾ \u0026lt;node_depth\u0026gt; æ˜¯è¦æŸ¥è¯¢èŠ‚ç‚¹çš„å±‚çº§ã€‚é€šè¿‡å°†èŠ‚ç‚¹çš„å±‚çº§ä¸æ•°æ®åº“ä¸­çš„ depth å­—æ®µè¿›è¡Œæ¯”è¾ƒï¼Œæˆ‘ä»¬å¯ä»¥ç­›é€‰å‡ºæ‰€æœ‰å±‚çº§å°äºæŒ‡å®šèŠ‚ç‚¹å±‚çº§çš„è®°å½•ï¼Œå³èŠ‚ç‚¹çš„æ‰€æœ‰çˆ¶çº§èŠ‚ç‚¹ã€‚\nè¿™ç§æ–¹æ³•ç›¸å¯¹ç®€å•ä¸”ç›´è§‚ï¼Œæ— éœ€å¯¹è·¯å¾„è¿›è¡Œå­—ç¬¦ä¸²åŒ¹é…å’Œæ¯”è¾ƒã€‚ç„¶è€Œï¼Œä½¿ç”¨ depth å­—æ®µçš„å‰ææ˜¯èŠ‚ç‚¹çš„å±‚çº§ä¿¡æ¯æ˜¯æ­£ç¡®ä¸”ä¸€è‡´çš„ï¼Œå¹¶ä¸”åœ¨æ’å…¥ã€æ›´æ–°å’Œåˆ é™¤èŠ‚ç‚¹æ—¶ï¼Œæ­£ç¡®åœ°ç»´æŠ¤ depth å­—æ®µçš„å€¼ã€‚\nè¯·æ³¨æ„ï¼Œä½¿ç”¨ depth å­—æ®µæ¥è·å–èŠ‚ç‚¹çš„æ‰€æœ‰çˆ¶çº§èŠ‚ç‚¹å¯èƒ½ä¼šå—åˆ°æ€§èƒ½æ–¹é¢çš„é™åˆ¶ï¼Œå°¤å…¶æ˜¯åœ¨å…·æœ‰å¤§é‡è®°å½•å’Œæ·±å±‚æ¬¡æ ‘ç»“æ„çš„æƒ…å†µä¸‹ã€‚å¦‚æœæ€§èƒ½æˆä¸ºé—®é¢˜ï¼Œæ‚¨å¯èƒ½éœ€è¦è€ƒè™‘ä½¿ç”¨å…¶ä»–æ•°æ®æ¨¡å‹æˆ–ç»“åˆç´¢å¼•å’Œç¼“å­˜ç­‰æŠ€æœ¯æ¥æé«˜æŸ¥è¯¢æ€§èƒ½ã€‚\nè·å–èŠ‚ç‚¹çš„å­çº§èŠ‚ç‚¹ï¼š\nSELECT * FROM area WHERE depth = \u0026lt;node_depth\u0026gt; + 1; è·å–èŠ‚ç‚¹çš„æ‰€æœ‰å­çº§èŠ‚ç‚¹ï¼š\nSELECT * FROM area WHERE depth \u0026gt; \u0026lt;node_depth\u0026gt; åœ¨ä¸Šè¿°æŸ¥è¯¢ä¸­ï¼Œå‡è®¾ \u0026lt;node_depth\u0026gt; æ˜¯è¦æŸ¥è¯¢èŠ‚ç‚¹çš„å±‚çº§ã€‚é€šè¿‡å°†èŠ‚ç‚¹çš„å±‚çº§ä¸æ•°æ®åº“ä¸­çš„ depth å­—æ®µè¿›è¡Œæ¯”è¾ƒï¼Œæˆ‘ä»¬å¯ä»¥ç­›é€‰å‡ºæ‰€æœ‰å±‚çº§å¤§äºæŒ‡å®šèŠ‚ç‚¹å±‚çº§çš„è®°å½•ï¼Œå³èŠ‚ç‚¹çš„æ‰€æœ‰å­çº§èŠ‚ç‚¹ã€‚\nè·å–èŠ‚ç‚¹çš„å…„å¼ŸèŠ‚ç‚¹ï¼š\nSELECT * FROM area WHERE depth = \u0026lt;node_depth\u0026gt; AND id != \u0026lt;node_id\u0026gt;; é€šè¿‡ä½¿ç”¨å¸¦æœ‰å±‚çº§å­—æ®µçš„è·¯å¾„æ¨¡å‹ï¼ŒæŸ¥è¯¢å’Œæ“ä½œæ ‘å½¢ç»“æ„æ•°æ®å¯ä»¥æ›´åŠ é«˜æ•ˆå’Œç›´è§‚ã€‚è¿™ç§æ¨¡å‹å¯ä»¥ç»“åˆè·¯å¾„ä¿¡æ¯å’Œå±‚çº§ä¿¡æ¯ï¼Œæä¾›æ›´çµæ´»å’Œä¾¿æ·çš„æŸ¥è¯¢èƒ½åŠ›ã€‚\næ€»ç»“ åœ¨ MySQL ä¸­è®¾è®¡æ ‘å½¢ç»“æ„çš„åŒºåŸŸè¡¨æ—¶ï¼Œæœ‰å¤šç§å¸¸ç”¨çš„æ–¹æ³•å¯ä¾›é€‰æ‹©ï¼š\nçˆ¶èŠ‚ç‚¹å¼•ç”¨ï¼ˆParent-Referenceï¼‰ï¼šåœ¨åŒºåŸŸè¡¨ä¸­æ·»åŠ ä¸€ä¸ªæŒ‡å‘çˆ¶èŠ‚ç‚¹çš„å¤–é”®åˆ—ã€‚ç®€å•ç›´è§‚ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«å…¶çˆ¶èŠ‚ç‚¹çš„å¼•ç”¨ã€‚ä½†æŸ¥è¯¢éœ€è¦ä½¿ç”¨é€’å½’æˆ–è‡ªè¿æ¥ã€‚ è·¯å¾„ï¼ˆPathï¼‰ï¼šåœ¨åŒºåŸŸè¡¨ä¸­æ·»åŠ ä¸€ä¸ªè¡¨ç¤ºèŠ‚ç‚¹è·¯å¾„çš„å­—ç¬¦ä¸²å­—æ®µã€‚è·¯å¾„å¯ä»¥æ˜¯å±‚çº§å…³ç³»çš„å®Œæ•´è¡¨ç¤ºï¼Œæ–¹ä¾¿æŸ¥è¯¢çˆ¶èŠ‚ç‚¹ã€å­èŠ‚ç‚¹å’Œæ•´ä¸ªå­æ ‘ã€‚ å·¦å³å€¼ï¼ˆNested Setï¼‰ï¼šä½¿ç”¨å·¦å³å€¼æ¨¡å‹è¡¨ç¤ºæ ‘å½¢ç»“æ„ï¼Œä¸ºæ¯ä¸ªèŠ‚ç‚¹æ·»åŠ å·¦å³è¾¹ç•Œå­—æ®µã€‚æŸ¥è¯¢èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ã€å­èŠ‚ç‚¹å’Œæ•´ä¸ªå­æ ‘æ—¶ä¸éœ€è¦é€’å½’ï¼Œä½†æ›´æ–°æ“ä½œå¯èƒ½å½±å“æ€§èƒ½ã€‚ åµŒå¥—é›†åˆè·¯å¾„ï¼ˆNested Set Pathï¼‰ï¼šç»“åˆè·¯å¾„å’Œå·¦å³å€¼çš„æ–¹æ³•ï¼Œåœ¨åŒºåŸŸè¡¨ä¸­æ·»åŠ è·¯å¾„å’Œå·¦å³å€¼å­—æ®µã€‚æ–¹ä¾¿æŸ¥è¯¢èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ã€å­èŠ‚ç‚¹å’Œæ•´ä¸ªå­æ ‘ï¼ŒåŒæ—¶é¿å…äº†å·¦å³å€¼æ¨¡å‹çš„æ›´æ–°æ€§èƒ½é—®é¢˜ã€‚ æ¯ç§æ–¹æ³•éƒ½æœ‰å…¶ä¼˜ç‚¹å’Œé™åˆ¶ï¼Œé€‰æ‹©é€‚åˆæ‚¨åº”ç”¨éœ€æ±‚ã€æŸ¥è¯¢é¢‘ç‡ã€æ•°æ®é‡å’Œæ€§èƒ½è¦æ±‚çš„æ–¹æ³•è‡³å…³é‡è¦ã€‚\nåœ¨è®¾è®¡æ ‘å½¢ç»“æ„è¡¨æ—¶ï¼Œéœ€è¦è€ƒè™‘åˆ°æŸ¥è¯¢çš„å¤æ‚æ€§ã€æ•°æ®ä¸€è‡´æ€§ã€æ›´æ–°æ“ä½œçš„æ€§èƒ½å’Œæ•°æ®é‡çš„å¤§å°ã€‚æ ¹æ®å…·ä½“æƒ…å†µè¿›è¡Œæƒè¡¡å’Œé€‰æ‹©åˆé€‚çš„è®¾è®¡æ–¹æ¡ˆã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/08/15/tree-structure-in-database/","summary":"åœ¨ MySQL ä¸­ï¼Œè®¾è®¡æ ‘å½¢ç»“æ„çš„åŒºåŸŸè¡¨æœ‰å¤šç§æ–¹å¼ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„æ–¹æ¡ˆï¼š\nçˆ¶å­å…³ç³»ï¼ˆParent-Child Relationshipï¼‰æ¨¡å‹ï¼šåœ¨è¿™ç§æ¨¡å‹ä¸­ï¼Œæ¯ä¸ªè¡Œè®°å½•åŒ…å«ä¸€ä¸ªæŒ‡å‘å…¶çˆ¶çº§çš„å¼•ç”¨ã€‚å¯ä»¥ä½¿ç”¨ä¸€ä¸ªé¢å¤–çš„åˆ—æ¥å­˜å‚¨çˆ¶çº§ IDï¼Œæˆ–è€…ä½¿ç”¨è‡ªè¿æ¥è¡¨æ¥è¡¨ç¤ºå…³ç³»ã€‚è¿™ç§æ¨¡å‹ç®€å•ç›´è§‚ï¼Œæ˜“äºç†è§£å’Œç®¡ç†ã€‚ è·¯å¾„ï¼ˆPathï¼‰æ¨¡å‹ï¼šåœ¨è¿™ç§æ¨¡å‹ä¸­ï¼Œæ¯ä¸ªè¡Œè®°å½•éƒ½åŒ…å«ä¸€ä¸ªä»£è¡¨å…¶å®Œæ•´è·¯å¾„çš„å­—æ®µã€‚è·¯å¾„å¯ä»¥æ˜¯ä»¥æŸç§åˆ†éš”ç¬¦ï¼ˆå¦‚æ–œæ ï¼‰åˆ†éš”çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ï¼š/åœ°åŒº/å›½å®¶/åŸå¸‚ã€‚é€šè¿‡è§£æå’Œå¤„ç†è·¯å¾„å­—æ®µï¼Œå¯ä»¥è½»æ¾åœ°æŸ¥è¯¢çˆ¶çº§ã€å­çº§å’Œå…„å¼ŸèŠ‚ç‚¹ã€‚ åµŒå¥—é›†æ¨¡å‹ï¼ˆNested Set Modelï¼‰ï¼šè¿™æ˜¯ä¸€ç§åŸºäºå·¦å³å€¼çš„æ¨¡å‹ï¼Œé€šè¿‡é¢„å…ˆè®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„å·¦å³å€¼ï¼Œå¯ä»¥é«˜æ•ˆåœ°æŸ¥è¯¢æ ‘å½¢ç»“æ„ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªå·¦å€¼å’Œä¸€ä¸ªå³å€¼ï¼Œç”¨äºè¡¨ç¤ºå…¶åœ¨æ ‘ä¸­çš„ä½ç½®ã€‚è¿™ç§æ¨¡å‹é€‚ç”¨äºå¤§å‹æ ‘ç»“æ„ï¼Œä½†éœ€è¦ç‰¹æ®Šçš„æ“ä½œæ¥ç»´æŠ¤å·¦å³å€¼ã€‚ ç‰©åŒ–è·¯å¾„ï¼ˆMaterialized Pathï¼‰æ¨¡å‹ï¼šè¿™æ˜¯è·¯å¾„æ¨¡å‹çš„ä¸€ç§æ”¹è¿›ç‰ˆæœ¬ï¼Œå®ƒä½¿ç”¨é¢å¤–çš„åˆ—æ¥å­˜å‚¨èŠ‚ç‚¹çš„å±‚çº§å…³ç³»ã€‚é™¤äº†è·¯å¾„å­—æ®µå¤–ï¼Œè¿˜å¯ä»¥æ·»åŠ ä¸€ä¸ªè¡¨ç¤ºèŠ‚ç‚¹çº§åˆ«çš„å­—æ®µã€‚è¿™æ ·å¯ä»¥æ›´é«˜æ•ˆåœ°è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶ä¸”å¯ä»¥è½»æ¾åœ°è·å–èŠ‚ç‚¹çš„çˆ¶çº§ã€å­çº§å’Œå…„å¼ŸèŠ‚ç‚¹ã€‚ çˆ¶å­å…³ç³»ï¼ˆParent-Child Relationshipï¼‰æ¨¡å‹ çˆ¶å­å…³ç³»ï¼ˆParent-Child Relationshipï¼‰æ¨¡å‹æ˜¯ä¸€ç§åœ¨ MySQL ä¸­è®¾è®¡æ ‘å½¢ç»“æ„çš„æ–¹å¼ã€‚åœ¨è¯¥æ¨¡å‹ä¸­ï¼Œæ¯ä¸ªåŒºåŸŸè®°å½•åŒ…å«ä¸€ä¸ªæŒ‡å‘å…¶çˆ¶çº§åŒºåŸŸçš„å¼•ç”¨ã€‚é€šè¿‡è¿™ç§çˆ¶å­å…³ç³»ï¼Œå¯ä»¥å»ºç«‹åŒºåŸŸä¹‹é—´çš„å±‚çº§ç»“æ„ã€‚\nä»¥åŒºåŸŸä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸º\u0026quot;area\u0026quot;çš„è¡¨æ¥å­˜å‚¨åŒºåŸŸä¿¡æ¯ã€‚è¯¥è¡¨å¯ä»¥åŒ…å«ä»¥ä¸‹åˆ—ï¼š\nidï¼šåŒºåŸŸçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆä¸»é”®ï¼‰ nameï¼šåŒºåŸŸçš„åç§° parent_idï¼šæŒ‡å‘çˆ¶çº§åŒºåŸŸçš„å¼•ç”¨ é€šè¿‡ä½¿ç”¨çˆ¶å­å…³ç³»æ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä»¥ä¸‹åŒºåŸŸçš„å±‚çº§ç»“æ„ï¼š\nid | name | parent_id --------------------------- 1 | ä¸–ç•Œ | NULL 2 | äºšæ´² | 1 3 | æ¬§æ´² | 1 4 | åŒ—ç¾æ´² | 1 5 | ä¸­å›½ | 2 6 | æ—¥æœ¬ | 2 7 | å¾·å›½ | 3 8 | æ³•å›½ | 3 9 | ç¾å›½ | 4 10 | åŠ æ‹¿å¤§ | 4 11 | åŒ—äº¬å¸‚ | 5 12 | ä¸Šæµ·å¸‚ | 5 13 | ä¸œäº¬éƒ½ | 6 14 | æ¨ªæ»¨å¸‚ | 6 åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œ\u0026ldquo;area\u0026quot;è¡¨çš„æ¯ä¸€è¡Œä»£è¡¨ä¸€ä¸ªåŒºåŸŸï¼Œé€šè¿‡\u0026quot;parent_id\u0026quot;åˆ—å»ºç«‹çˆ¶å­å…³ç³»ã€‚æ ¹åŒºåŸŸï¼ˆä¸–ç•Œï¼‰çš„\u0026quot;parent_id\u0026quot;ä¸º NULLï¼Œè¡¨ç¤ºæ²¡æœ‰çˆ¶çº§åŒºåŸŸã€‚å…¶ä»–åŒºåŸŸé€šè¿‡æŒ‡å®šçˆ¶çº§åŒºåŸŸçš„\u0026quot;id\u0026quot;æ¥å»ºç«‹å±‚çº§å…³ç³»ã€‚","title":"æ•°æ®åº“å¦‚ä½•è®¾è®¡æ ‘å½¢ç»“æ„"},{"content":"Spring Security çš„å‘å±•è¿‡ç¨‹ Spring Security æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”å¹¿æ³›ä½¿ç”¨çš„å®‰å…¨æ¡†æ¶ï¼Œä¸ºä¼ä¸šçº§åº”ç”¨ç¨‹åºæä¾›äº†å…¨é¢çš„å®‰å…¨æ€§ã€‚Spring Security æœ€åˆæ˜¯ Acegi Security é¡¹ç›®çš„ä¸€éƒ¨åˆ†ï¼Œäº 2004 å¹´å‘å¸ƒï¼Œç°åœ¨å·²ç»æˆä¸º Spring ç”Ÿæ€ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ã€‚ Spring Security çš„å‘å±•è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š\nç¬¬ä¸€é˜¶æ®µï¼šSpring Security èµ·æºäºä¸€ä¸ªåä¸º Acegi Security çš„å¼€æºé¡¹ç›®ï¼ŒåˆæœŸé‡ç‚¹å®ç°äº† Spring åº”ç”¨çš„èº«ä»½è®¤è¯å’ŒæˆæƒæœåŠ¡åŠŸèƒ½ã€‚2003 å¹´ï¼ŒAcegi Security ä½œä¸ºä¸€ä¸ªå­µåŒ–é¡¹ç›®è¢«æçŒ®ç»™ Spring ç¤¾åŒºã€‚2004 å¹´ï¼Œæ­£å¼ä½œä¸º Spring æ¡†æ¶çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ Absorbed è¿› Springã€‚å¹¶æ›´åä¸º Spring Securityã€‚Spring Security 1.0 ç‰ˆæœ¬ Spring Security 1.0 ç‰ˆæœ¬å‘å¸ƒäº 2004 å¹´ã€‚å®ƒæä¾›äº†æœ€åŸºæœ¬çš„å®‰å…¨åŠŸèƒ½ï¼ŒåŒ…æ‹¬èº«ä»½éªŒè¯å’Œæˆæƒã€‚èº«ä»½éªŒè¯æ˜¯éªŒè¯ç”¨æˆ·æ˜¯å¦æ˜¯ä»–ä»¬æ‰€å£°ç§°çš„äººçš„è¿‡ç¨‹ã€‚æˆæƒæ˜¯ç¡®å®šç”¨æˆ·æ˜¯å¦æœ‰æƒè®¿é—®ç‰¹å®šèµ„æºçš„è¿‡ç¨‹ã€‚ Spring Security 1.0 ç‰ˆæœ¬ä½¿ç”¨äº†ä»¥ä¸‹æŠ€æœ¯æ¥å®ç°èº«ä»½éªŒè¯å’Œæˆæƒï¼š\nè¡¨å•èº«ä»½éªŒè¯ï¼šè¡¨å•èº«ä»½éªŒè¯æ˜¯é€šè¿‡ç”¨æˆ·æäº¤è¡¨å•æ¥éªŒè¯ç”¨æˆ·èº«ä»½çš„è¿‡ç¨‹ã€‚ åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC)ï¼šRBAC æ˜¯ä¸€ç§æˆæƒæ¨¡å‹ï¼Œå®ƒå°†ç”¨æˆ·åˆ†é…åˆ°è§’è‰²ï¼Œç„¶åè¿™äº›è§’è‰²è¢«æˆäºˆå¯¹ç‰¹å®šèµ„æºçš„è®¿é—®æƒé™ã€‚ ç¬¬äºŒé˜¶æ®µï¼šSpring Security 2.0 ç‰ˆæœ¬ Spring Security 2.0 ç‰ˆæœ¬å‘å¸ƒäº 2006 å¹´ã€‚å®ƒæä¾›äº†æ›´å¤šçš„å®‰å…¨åŠŸèƒ½ï¼ŒåŒ…æ‹¬åŠ å¯†å’Œä¼šè¯ç®¡ç†ã€‚åŠ å¯†æ˜¯å°†æ•°æ®è½¬æ¢æˆæ— æ³•è¢«ä»–äººç†è§£çš„å½¢å¼çš„è¿‡ç¨‹ã€‚ä¼šè¯ç®¡ç†æ˜¯è·Ÿè¸ªç”¨æˆ·ä¼šè¯çš„çŠ¶æ€çš„è¿‡ç¨‹ã€‚ Spring Security 2.0 ç‰ˆæœ¬ä½¿ç”¨äº†ä»¥ä¸‹æŠ€æœ¯æ¥å®ç°åŠ å¯†å’Œä¼šè¯ç®¡ç†ï¼š\nå®‰å…¨å¥—æ¥å­—å±‚ (SSL)ï¼šSSL æ˜¯ä¸€ç§åŠ å¯†åè®®ï¼Œå®ƒå¯ä»¥ä¿æŠ¤æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸è¢«çªƒå¬ã€‚ ä¼šè¯ç®¡ç†ï¼šSpring Security æä¾›äº†è‡ªå·±çš„ä¼šè¯ç®¡ç†å®ç°ï¼Œå®ƒå¯ä»¥è·Ÿè¸ªç”¨æˆ·ä¼šè¯çš„çŠ¶æ€ã€‚ ç¬¬ä¸‰é˜¶æ®µï¼šSpring Security 3.0 ç‰ˆæœ¬ Spring Security 3.0 ç‰ˆæœ¬å‘å¸ƒäº 2008 å¹´ã€‚å®ƒæ˜¯ä¸€ä¸ªé‡å¤§çš„ç‰ˆæœ¬æ›´æ–°ï¼Œå®ƒæä¾›äº†è®¸å¤šæ–°çš„å®‰å…¨åŠŸèƒ½ï¼ŒåŒ…æ‹¬ OAuthã€SAML å’Œ OpenIDã€‚ OAuth æ˜¯ä¸€ç§æˆæƒæ¡†æ¶ï¼Œå®ƒå…è®¸ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºè®¿é—®ç”¨æˆ·çš„èµ„æºã€‚SAML æ˜¯ä¸€ç§å•ç‚¹ç™»å½• (SSO) åè®®ï¼Œå®ƒå…è®¸ç”¨æˆ·åœ¨ä¸€ä¸ªåœ°æ–¹ç™»å½•ï¼Œç„¶åè®¿é—®å¤šä¸ªç½‘ç«™ã€‚OpenID æ˜¯ä¸€ç§å¼€æ”¾çš„èº«ä»½éªŒè¯åè®®ï¼Œå®ƒå…è®¸ç”¨æˆ·ä½¿ç”¨ä»–ä»¬é€‰æ‹©çš„èº«ä»½æä¾›å•†æ¥éªŒè¯ä»–ä»¬çš„èº«ä»½ã€‚ Spring Security 3.0 ç‰ˆæœ¬ä½¿ç”¨äº†ä»¥ä¸‹æŠ€æœ¯æ¥å®ç° OAuthã€SAML å’Œ OpenIDï¼š\nOAuthï¼šSpring Security æä¾›äº†è‡ªå·±çš„ OAuth å®ç°ï¼Œå®ƒå¯ä»¥è®©ä½ è½»æ¾åœ°åœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ OAuthã€‚\nSAMLï¼šSpring Security æä¾›äº†è‡ªå·±çš„ SAML å®ç°ï¼Œå®ƒå¯ä»¥è®©ä½ è½»æ¾åœ°åœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ SAMLã€‚\nOpenIDï¼šSpring Security æä¾›äº†è‡ªå·±çš„ OpenID å®ç°ï¼Œå®ƒå¯ä»¥è®©ä½ è½»æ¾åœ°åœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ OpenIDã€‚\nä»¥ä¸‹æ˜¯ Spring Security çš„è¯¦ç»†çš„å‘å±•è¿‡ç¨‹å’Œç‰ˆæœ¬å˜åŒ–ï¼š\nAcegi Securityï¼šAcegi Security æ˜¯ Spring Security çš„å‰èº«ï¼Œæœ€åˆç”± Ben Alex åˆ›å»ºå¹¶äº 2004 å¹´å‘å¸ƒã€‚Acegi Security æä¾›äº†ä¸€ç»„åŸºäº Spring çš„å®‰å…¨æ€§åŠŸèƒ½ï¼Œç”¨äºä¿æŠ¤ Web åº”ç”¨ç¨‹åºã€Web æœåŠ¡å’ŒåŸºäº Spring çš„åº”ç”¨ç¨‹åºã€‚\nSpring Security 2ï¼šSpring Security 2 æ˜¯ Acegi Security çš„ç»§ä»»è€…ï¼Œäº 2006 å¹´å‘å¸ƒã€‚Spring Security 2 æä¾›äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œä¾‹å¦‚å¯¹ OpenIDã€LDAP å’Œ CAS çš„æ”¯æŒï¼Œä»¥åŠæ›´å¥½çš„é›†æˆå’Œé…ç½®é€‰é¡¹ã€‚\nSpring Security 3ï¼šSpring Security 3 äº 2009 å¹´å‘å¸ƒï¼Œæ˜¯ Spring Security çš„ä¸€ä¸ªé‡å¤§æ›´æ–°ã€‚Spring Security 3 æä¾›äº†æ›´å¤šçš„å®‰å…¨åŠŸèƒ½å’Œæ”¹è¿›ï¼Œä¾‹å¦‚å¯¹ RESTful Web æœåŠ¡çš„æ”¯æŒã€åŸºäºæ³¨è§£çš„å®‰å…¨æ€§ã€æ›´å¥½çš„ CSRF é˜²æŠ¤ã€æ›´å¥½çš„å¯†ç å­˜å‚¨å’Œè®¤è¯ç®¡ç†ç­‰ã€‚\nSpring Security 4ï¼šSpring Security 4 äº 2015 å¹´å‘å¸ƒï¼Œå¸¦æ¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œä¾‹å¦‚å¯¹ OAuth2ã€JWT å’Œ Spring Boot çš„æ”¯æŒã€æ›´å¥½çš„ SSO å’Œå¤šå› ç´ è®¤è¯ç­‰ã€‚\nSpring Security 5ï¼šSpring Security 5 äº 2017 å¹´å‘å¸ƒï¼Œæ˜¯ä¸€ä¸ªé‡å¤§çš„æ›´æ–°ï¼Œå¸¦æ¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œä¾‹å¦‚å¯¹ WebFlux å’Œ Reactive Spring çš„æ”¯æŒã€æ›´å¥½çš„ OAuth2 å’Œ OpenID Connect çš„æ”¯æŒã€æ›´å¥½çš„å¯†ç ç¼–ç å’Œè®¤è¯ç®¡ç†ç­‰ã€‚\nSpring Security 5.1ï¼šSpring Security 5.1 å‘å¸ƒäº 2018 å¹´ï¼Œä¸»è¦æä¾›äº†å¯¹ Spring Boot 2.1 çš„æ”¯æŒå’Œä¸€äº›æ–°çš„åŠŸèƒ½ï¼Œå¦‚ Kotlin DSLã€OAuth2 æ”¯æŒçš„ç§æœ‰è¯ä¹¦ã€JWT ç”Ÿæˆå™¨ç­‰ã€‚\nSpring Security 5.2ï¼šSpring Security 5.2 å‘å¸ƒäº 2019 å¹´ï¼Œå¸¦æ¥äº†è®¸å¤šæ”¹è¿›å’Œæ–°ç‰¹æ€§ï¼ŒåŒ…æ‹¬å¯¹ Spring Cloud Gateway å’Œ Spring MVC çš„ WebFlux æ”¯æŒã€OAuth2 å’Œ OpenID Connect çš„æ”¹è¿›ã€æ›´å¥½çš„å¯†ç ç®¡ç†å’Œè®¤è¯ã€æ›´å¥½çš„è·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼‰æ”¯æŒç­‰ã€‚\nSpring Security 5.3ï¼šSpring Security 5.3 å‘å¸ƒäº 2020 å¹´ï¼Œä¸»è¦æä¾›äº†æ›´å¥½çš„ WebFlux å’Œ RSocket æ”¯æŒã€æ›´å¥½çš„ OAuth2 æ”¯æŒã€æ›´å¥½çš„æµ‹è¯•å’Œæ€§èƒ½ã€æ›´å¥½çš„ Kotlin æ”¯æŒã€æ›´å¥½çš„ JUnit 5 æ”¯æŒç­‰ã€‚\nSpring Security 5.4ï¼šSpring Security 5.4 å‘å¸ƒäº 2021 å¹´ï¼Œå¸¦æ¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œä¾‹å¦‚å¯¹ Spring Boot 2.4 çš„æ”¯æŒã€æ›´å¥½çš„ JWT å’Œ OAuth2 æ”¯æŒã€æ›´å¥½çš„å¯†ç ç¼–ç ã€æ›´å¥½çš„ WebFlux å’Œ RSocket æ”¯æŒã€æ›´å¥½çš„æµ‹è¯•å’Œæ€§èƒ½ç­‰ã€‚\nSpring Security 5.5ï¼šæ˜¯å½“å‰æœ€æ–°çš„ç‰ˆæœ¬ï¼Œäº 2022 å¹´å‘å¸ƒã€‚Spring Security 5.5 å¸¦æ¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼ŒåŒ…æ‹¬å¯¹ Spring Framework 6 å’Œ Java 17 çš„æ”¯æŒã€æ›´å¥½çš„å¯†ç ç¼–ç å’Œè®¤è¯ç®¡ç†ã€æ›´å¥½çš„ OAuth2 å’Œ OpenID Connect æ”¯æŒã€æ›´å¥½çš„ WebFlux å’Œ RSocket æ”¯æŒã€æ›´å¥½çš„æµ‹è¯•å’Œæ€§èƒ½ç­‰ã€‚\nSpring Security 5.7ï¼šç”±äºæ ¹æ® Spring å®˜ç½‘å‘å¸ƒçš„å…¬å‘Šï¼ŒWebSecurityConfigurerAdapter å·²ä» Spring Security 5.7.0-M2 ä¸­å¼ƒç”¨ã€‚\nSpring Security 6.0ï¼š2022 å¹´ 11 æœˆå‘å¸ƒï¼ŒWebSecurityConfigurerAdapter å·²ä» Spring Security API ä¸­å®Œå…¨åˆ é™¤ã€‚å®ƒè¿˜å½±å“äº† 2022 å¹´ 11 æœˆæ–°å‘å¸ƒçš„ Spring Boot 3.0ã€‚\né™¤äº†ä¸æ–­æ”¹è¿›å’Œå¢å¼ºç°æœ‰åŠŸèƒ½ä¹‹å¤–ï¼ŒSpring Security è¿˜å¢åŠ äº†å¯¹æ–°çš„å®‰å…¨å¨èƒçš„é˜²å¾¡å’Œæ”¯æŒï¼Œä¾‹å¦‚ CSRFã€XSSã€CSP ç­‰ã€‚æ­¤å¤–ï¼ŒSpring Security è¿˜æä¾›äº†è®¸å¤šæœ‰ç”¨çš„æ‰©å±•å’Œæ’ä»¶ï¼Œä¾‹å¦‚ Spring Security OAuthã€Spring Security SAMLã€Spring Security Kerberos ç­‰ï¼Œä»¥æ»¡è¶³ä¸åŒçš„å®‰å…¨éœ€æ±‚ã€‚\nSpring Security OAuth2 å‘å±• Spring Security OAuth2 æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºå®‰å…¨çš„ OAuth2-based ç½‘ç»œåº”ç”¨çš„æ¡†æ¶ï¼Œå®ƒæ˜¯ Spring Security çš„ä¸€éƒ¨åˆ†ã€‚ä¸‹é¢æ˜¯ Spring Security OAuth2 çš„å‘å±•è¿‡ç¨‹ï¼š\n1. Spring Security OAuth2 V1.x â€“ V2.0 æœ€åˆçš„å‡ ä¸ªç‰ˆæœ¬æ˜¯ä¸ºäº†æ„å»ºä¸€ä¸ªå®‰å…¨çš„ OAuth2-based ç½‘ç»œåº”ç”¨ã€‚æ ¸å¿ƒçš„åŠŸèƒ½åŒ…æ‹¬ï¼š\næ”¯æŒ OAuth2 åè®®çš„å››ç§æˆæƒæ–¹å¼ï¼šæˆæƒç ï¼ˆauthorization codeï¼‰ã€éšå¼æˆæƒï¼ˆimplicitï¼‰ã€å¯†ç æˆæƒï¼ˆresource owner password credentialsï¼‰å’Œå®¢æˆ·ç«¯å‡­æ®ï¼ˆclient credentialsï¼‰ æä¾›äº†ä¸€ä¸ªç®€å•æ˜“ç”¨çš„ API ç”¨äºæ„å»º OAuth2 æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ æ”¯æŒ JWTï¼ˆJSON Web Tokensï¼‰ æä¾›äº†è¯¦ç»†çš„æ–‡æ¡£å’Œç¤ºä¾‹ä»£ç  2. Spring Security OAuth2 V2.1 åœ¨ 2.1 ç‰ˆæœ¬ä¸­ï¼ŒSpring Security OAuth2 è¿›è¡Œäº†ä¸€ç³»åˆ—çš„æ”¹è¿›å’Œæ‰©å±•ï¼ŒåŒ…æ‹¬ï¼š\næ”¯æŒ OpenID Connect 1.0 æ”¯æŒ Token Introspection Endpoint æ›´å¥½çš„æ”¯æŒ JWTï¼ŒåŒ…æ‹¬ JWSï¼ˆJSON Web Signaturesï¼‰å’Œ JWEï¼ˆJSON Web Encryptionï¼‰ 3. Spring Security 5.0 OAuth2 Login and OAuth2 Client åœ¨ Spring Security 5.0 ä¸­ï¼ŒSpring Security OAuth2 çš„éƒ¨åˆ†åŠŸèƒ½è¢«åˆå¹¶åˆ°äº† Spring Security 5.0 ä¸­ï¼Œæä¾›äº† OAuth2 ç™»å½•å’Œå®¢æˆ·ç«¯æ”¯æŒã€‚\n4. Spring Security 5.1 OAuth2 Resource Server åœ¨ Spring Security 5.1 ä¸­ï¼ŒSpring Security OAuth2 çš„èµ„æºæœåŠ¡å™¨åŠŸèƒ½è¢«åˆå¹¶åˆ°äº† Spring Security ä¸­ã€‚\n5. Spring Security 5.2 OAuth2 Authorization Server åœ¨ Spring Security 5.2 ä¸­ï¼ŒSpring Security OAuth2 çš„æˆæƒæœåŠ¡å™¨åŠŸèƒ½è¢«åˆå¹¶åˆ°äº† Spring Security ä¸­ã€‚è¿™æ˜¯ Spring Security OAuth2 çš„æœ€åä¸€ä¸ªç‹¬ç«‹ç‰ˆæœ¬ã€‚\n6. Spring Authorization Server åœ¨ 2020 å¹´ 4 æœˆï¼ŒSpring å®£å¸ƒäº†ä¸€ä¸ªæ–°çš„é¡¹ç›®â€”â€”Spring Authorization Serverï¼Œè¯¥é¡¹ç›®æ—¨åœ¨æä¾›ä¸€ä¸ªç”¨äºå®ç° OAuth 2.1 æˆæƒæœåŠ¡å™¨çš„åŸºç¡€ã€‚\n7. Spring Security 5.3 and beyond åœ¨ Spring Security 5.3 å’Œä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼ŒSpring Security OAuth2 çš„æ‰€æœ‰åŠŸèƒ½éƒ½è¢«åˆå¹¶åˆ°äº† Spring Security ä¸­ï¼Œè€Œ Spring Security OAuth2 ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„é¡¹ç›®å·²ç»åœæ­¢å¼€å‘ã€‚ä¸ä¹‹ç›¸å¯¹åº”çš„ Spring Security OAuth Boot 2 Autoconfig ä¹Ÿåœæ­¢äº†å¼€å‘ã€‚\næ€»ç»“ä¸€ä¸‹ï¼Œç›®å‰ï¼ŒSpring Security OAuth2 çš„æœ€æ–°ç‰ˆæœ¬ä¸º 2.5.2.RELEASEï¼Œå¹¶ä¸”æ‰€æœ‰ç±»éƒ½æ ‡æ³¨ä¸º @Deprecatedï¼Œå®˜æ–¹ä¹Ÿæä¾›äº†ä¸€ä¸ªè¿ç§»æ–‡æ¡£ OAuth 2.0 Migration Guideã€‚\nSpring Boot å’Œ Spring OAuth2 ç‰ˆæœ¬å…³ç³» Spring Boot å’Œ Spring OAuth2 æ˜¯å¯ä»¥é…åˆä½¿ç”¨çš„ï¼Œä¸»è¦æ³¨æ„ç‰ˆæœ¬åŒ¹é…å³å¯ã€‚\nSpring Boot ä½¿ç”¨äº†ç‰¹å®šç‰ˆæœ¬çš„ Spring OAuth2 ä½œä¸ºä¾èµ–ã€‚æ‰€ä»¥ä½¿ç”¨å¯¹åº”çš„ Spring Boot ç‰ˆæœ¬ï¼Œå°±ä¼šè‡ªåŠ¨è·å–åŒ¹é…çš„ Spring OAuth2 ç‰ˆæœ¬ã€‚\nä¸¾å‡ ä¸ªç‰ˆæœ¬çš„ä¾‹å­ï¼š\nSpring Boot 1.5.x ä½¿ç”¨ Spring OAuth2 2.0.x Spring Boot 2.0.x ä½¿ç”¨ Spring OAuth2 2.0.x Spring Boot 2.1.x ä½¿ç”¨ Spring OAuth2 2.1.x Spring Boot 2.2.x ä½¿ç”¨ Spring OAuth2 2.2.x Spring Boot 2.3.x ä½¿ç”¨ Spring OAuth2 2.3.x æ‰€ä»¥ä½¿ç”¨ Spring Boot æ—¶ï¼Œä¸éœ€è¦é¢å¤–æŒ‡å®š Spring OAuth2 çš„ç‰ˆæœ¬ï¼Œåªéœ€è¦é€‰æ‹©åŒ¹é…çš„ Spring Boot ç‰ˆæœ¬å³å¯ã€‚\nåœ¨é…ç½®å’Œä½¿ç”¨ Spring OAuth2 æ—¶ï¼Œåªéœ€è¦å‚è€ƒ Spring OAuth2 çš„æ–‡æ¡£å³å¯ï¼Œä¸éœ€è¦ç‰¹åˆ«å…³æ³¨å…¶ç‰ˆæœ¬ã€‚Spring Boot ä¼šè´Ÿè´£ç®¡ç†ç‰ˆæœ¬åŒ¹é…ã€‚\næ­¤å¤–ï¼Œä» Spring Boot 1.5 å¼€å§‹ï¼ŒSpring Security å·²ç»é›†æˆäº† OAuth2 çš„å®ç°ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ Spring Security æ¥å®ç° OAuth2ï¼Œæ— éœ€å¼•å…¥ Spring OAuth é¡¹ç›®ã€‚\næ€»ä¹‹ï¼ŒSpring Boot å¤§å¤§ç®€åŒ–äº† Spring OAuth2 çš„ä½¿ç”¨ï¼Œåªéœ€è¦å…³æ³¨ Spring Boot ç‰ˆæœ¬å³å¯è‡ªåŠ¨è·å–æ­£ç¡®çš„ Spring OAuth2 ç‰ˆæœ¬ã€‚\nSpring Cloud å’Œ Spring OAuth2 ç‰ˆæœ¬å…³ç³» Spring Cloud å’Œ Spring OAuth2 ç‰ˆæœ¬ä¹‹é—´æ²¡æœ‰å›ºå®šçš„å¯¹åº”å…³ç³»ï¼Œä½†é€šå¸¸æ¥è¯´å»ºè®®ç¬¦åˆä»¥ä¸‹æƒ…å†µï¼š\nSpring Cloud ç‰ˆæœ¬è¶Šæ–°ï¼Œå†…ç½®çš„ Spring OAuth æ”¯æŒä¹Ÿä¼šæ›´ç¨³å®šå’Œå®Œå–„ã€‚ Spring Cloud Hoxton/Greenwich ç­‰ä¸»æµç‰ˆæœ¬ï¼Œå†…ç½®çš„ Spring OAuth æ”¯æŒæ­£å¸¸ä½¿ç”¨ Spring Security OAuth2 ç‰ˆæœ¬ 2.xã€‚ Spring Cloud Edgware åŠæ›´æ—©ç‰ˆæœ¬ï¼Œå†…ç½®çš„ Spring OAuth æ”¯æŒå»ºè®®ä½¿ç”¨ Spring Security OAuth2 ç‰ˆæœ¬ 1.xã€‚ å³ä½¿ Spring Cloud ç‰ˆæœ¬å’Œ Spring Security OAuth ç‰ˆæœ¬ä¸å®Œå…¨åŒ¹é…ï¼Œä¹Ÿæ— å¤§ç¢ï¼Œä½†åŠŸèƒ½å’Œå…¼å®¹æ€§ä¼šå—ä¸€å®šå½±å“ã€‚ æ‰€ä»¥ä¸€èˆ¬æ¥è¯´ï¼š\nSpring Cloud Finch/ Greenwich ç­‰æœ€æ–°ç‰ˆæœ¬ï¼Œå»ºè®®ä½¿ç”¨ Spring Security OAuth2 ç‰ˆæœ¬ 2.3.x åŠä»¥ä¸Šã€‚ Spring Cloud Edgware åˆ° Hoxtonï¼Œå»ºè®®ä½¿ç”¨ Spring Security OAuth2 ç‰ˆæœ¬ 1.5.x åˆ° 2.3.x éƒ½å¯ä»¥ã€‚ Spring Cloud ç‰ˆæœ¬æ¯”è¾ƒæ—©ï¼Œå¦‚ Dalston ä»¥ä¸‹ï¼Œå»ºè®®ä½¿ç”¨ Spring Security OAuth2 ç‰ˆæœ¬ 1.0.x åˆ° 1.5.xã€‚ ä½†ä¸æ˜¯è¯´ç‰ˆæœ¬ä¸€å®šè¦å®Œå…¨åŒ¹é…ï¼Œä¸»è¦çœ‹è‡ªå·±éœ€è¦ç”¨åˆ°çš„ Spring OAuth åŠŸèƒ½æ˜¯å¦å¾—åˆ°æ”¯æŒã€‚é€‰æ‹©ç‰ˆæœ¬æ—¶ä¼˜å…ˆè€ƒè™‘ Spring Cloud ç‰ˆæœ¬çš„å†…ç½®æ”¯æŒç¨‹åº¦ã€‚æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥æ ¹æ®é¡¹ç›®å…¶ä»–ä¾èµ–é€‰æ‹©ä¸€ä¸ªç›¸å¯¹ç¨³å®šçš„ Spring Security OAuth ç‰ˆæœ¬ã€‚\nSpring Cloud Security Spring Cloud Security æä¾›äº†ä¸€ç§é›†æˆåŒ–çš„æ–¹å¼æ¥å®ç°å¾®æœåŠ¡åº”ç”¨çš„å®‰å…¨åŠŸèƒ½ã€‚ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š\nèº«ä»½è®¤è¯(Authentication) Spring Cloud Security æ”¯æŒå¸¸è§çš„è®¤è¯æ–¹å¼ï¼Œæ¯”å¦‚åŸºäº OAuth2.0 çš„è®¤è¯åè®®ã€‚å¯ä»¥å®ç°é›†ä¸­å¼çš„è®¤è¯ç®¡ç†ï¼Œç™»å…¥åè·å–è®¿é—®ä»¤ç‰Œå¹¶åœ¨å„ä¸ªå¾®æœåŠ¡ä¹‹é—´ä¼ é€’ã€‚\næˆæƒ(Authorization) æ”¯æŒåŸºäº RBAC å’Œ ABAC ç­‰æˆæƒæ¨¡å‹ã€‚å¯ä»¥å®ç°é›†ä¸­å¼çš„æˆæƒç®¡ç†ï¼Œç»™ä¸åŒç”¨æˆ·æˆ–ç»„åˆ†é…ä¸åŒçš„è®¿é—®æƒé™ã€‚\nå®‰å…¨ç»ˆç«¯(Security Endpoints) æä¾›äº†å®‰å…¨ç»ˆç«¯çš„å®ç°ï¼Œæ¯”å¦‚/oauth/token ä»¤ç‰Œè®¿é—®ç«¯ç‚¹ã€/userinfo ç”¨æˆ·ä¿¡æ¯ç«¯ç‚¹ç­‰ã€‚\nåŠ å¯†é€šä¿¡(Encryption) æ”¯æŒåœ¨å¾®æœåŠ¡ä¹‹é—´è¿›è¡Œå®‰å…¨çš„ HTTP é€šä¿¡ï¼Œé€šè¿‡ TLS/SSL åŠ å¯†æ•°æ®ä¼ è¾“å’ŒæœåŠ¡é—´è°ƒç”¨ã€‚\næ—¥å¿—å®¡è®¡(Logging \u0026amp; Auditing) æ”¯æŒæ”¶é›†å’Œè®°å½•å®‰å…¨ç›¸å…³çš„å®¡è®¡æ—¥å¿—ï¼Œæ¯”å¦‚æˆæƒé”™è¯¯æ—¥å¿—ã€ç™»å…¥/ç™»å‡ºæ—¥å¿—ç­‰ï¼Œæ–¹ä¾¿ç®¡ç†å’Œç›‘æ§ã€‚\nå®‰å…¨é…ç½®(Security Configuration) æä¾›äº†å¼¹æ€§å’Œæ˜“ç”¨çš„å®‰å…¨é…ç½®èƒ½åŠ›ï¼Œå¦‚åŠ¨æ€é…ç½®å®‰å…¨ç›¸å…³ Bean ç­‰ã€‚\né›†æˆæ”¯æŒ(Integration Support) å¤©ç„¶æ”¯æŒ Spring Cloud å’Œ Springboot é¡¹ç›®ï¼Œæ— ç¼é›†æˆä»è®¤è¯åˆ°æˆæƒçš„å…¨å¥—å®‰å…¨åŠŸèƒ½ã€‚\næ‰€ä»¥æ€»ä½“æ¥è¯´ï¼ŒSpring Cloud Security æä¾›äº†ä¸€ç§æ ‡å‡†åŒ–å’Œé›†æˆçš„æ–¹å¼æ¥å®ç°å¾®æœåŠ¡ç¯å¢ƒä¸‹çš„å®‰å…¨éœ€æ±‚ã€‚å¼€å‘äººå‘˜å¯ä»¥æ›´ä¾¿æ·åœ°åˆ©ç”¨å…¶ä¸°å¯Œçš„åŠŸèƒ½ã€‚\nç¤ºä¾‹ Spring Security å¦‚ä½•å®ç° JSON Web Token çš„åŠŸèƒ½ï¼Ÿ Spring Security å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼å®ç° JSON Web Token(JWT)çš„åŠŸèƒ½ï¼š\nå¯¼å…¥ spring-security-jwt ä¾èµ–ã€‚ \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-security\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.security\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-security-jwt\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; spring-boot-starter-security ç‰ˆæœ¬ä¿¡æ¯å¦‚ä¸‹ï¼š\nspring-boot-starter-parent ç‰ˆæœ¬å·ï¼š2.7.5 ä¾èµ–çš„ spring-boot-starter-security ç‰ˆæœ¬å·ï¼š2.7.5 spring-boot-starter-security æ˜¯ Spring Boot å®‰å…¨åŠŸèƒ½çš„å¯åŠ¨å™¨ä¾èµ–ï¼Œå®ƒä¼šè‡ªåŠ¨å¼•å…¥æ ¸å¿ƒå®‰å…¨ä¾èµ–ï¼š\nspring-security-coreï¼šSpring Security çš„æ ¸å¿ƒæ¨¡å—ï¼Œæä¾›è®¤è¯ã€æˆæƒã€å®‰å…¨ç›¸å…³çš„ä¸»è¦æ¥å£å’Œç»„ä»¶ã€‚\nspring-security-configï¼šæä¾›äº† Spring Security çš„åŸºç¡€é…ç½®èƒ½åŠ›ï¼ŒåŒ…å«è¿‡æ»¤å™¨é“¾ã€å¯†ç ç¼–ç å™¨ç­‰ã€‚\nspring-security-webï¼šæä¾›äº† web å®‰å…¨ç›¸å…³çš„æ”¯æŒï¼Œå¦‚è¿‡æ»¤å™¨ã€ç™»å½•è¡¨å•ã€æ³¨è§£ç­‰ã€‚\nspring-security-cryptoï¼šåŒ…å«å¯†ç å“ˆå¸ŒåŠŸèƒ½çš„å®ç°ç±»ï¼Œç”¨äºå¯¹å¯†ç è¿›è¡Œå®‰å…¨çš„åŠ å¯†å­˜å‚¨ã€‚\nspring-security-dataï¼šåŒ…å«äº†æ”¯æŒ JDBC å’Œ LDAP ç­‰åç«¯æ•°æ®æºçš„å®‰å…¨ç»„ä»¶ã€‚\nspring-security-oauth2-clientï¼šæä¾›äº†å¯¹ OAuth2 å®¢æˆ·ç«¯åŠŸèƒ½çš„æ”¯æŒã€‚ä¸»è¦æä¾›ä»¥ä¸‹ OAuth2 å®¢æˆ·ç«¯ç›¸å…³åŠŸèƒ½ï¼š\nå®¢æˆ·ç«¯æ³¨å†Œå’Œèµ„æºæœåŠ¡å™¨é…ç½®ï¼šæ”¯æŒä¸ºå®¢æˆ·ç«¯åº”ç”¨é…ç½® clientIdã€secret ç­‰ä¿¡æ¯ã€‚ å®¢æˆ·ç«¯å‡­è¯è·å–ï¼šæ”¯æŒ BasicAuth å’Œå¯†ç æ¨¡å¼è·å– client credentialsã€‚ è®¿é—®ä»¤ç‰Œè¯·æ±‚ï¼šå®ç°å®¢æˆ·ç«¯å‘æˆæƒæœåŠ¡å™¨è¯·æ±‚è®¿é—®ä»¤ç‰Œçš„åŠŸèƒ½ï¼Œæ”¯æŒ passwordã€refresh_token ç­‰ grant ç±»å‹ã€‚ ä»¤ç‰Œå­˜å‚¨ï¼šæä¾› TokenStore æ¥å£çš„å®ç°ï¼Œæ”¯æŒåœ¨ä¼šè¯æˆ–æ•°æ®åº“ä¸­å­˜å‚¨/è·å–è®¿é—®ä»¤ç‰Œã€‚ èµ„æºæœåŠ¡å™¨è®¿é—®ï¼šé€šè¿‡è®¿é—®ä»¤ç‰Œæ¥è®¿é—®å—ä¿æŠ¤çš„èµ„æºï¼Œæ”¯æŒä»è¯·æ±‚å¤´æˆ–å‚æ•°ä¸­æå–ä»¤ç‰Œã€‚ åˆ·æ–°ä»¤ç‰Œï¼šå®ç°ä½¿ç”¨ refresh_token æ¥åˆ·æ–°è¿‡æœŸçš„è®¿é—®ä»¤ç‰ŒåŠŸèƒ½ã€‚ ç”¨æˆ·æˆæƒï¼šæä¾›ç±»ä¼¼@PreAuthorize æ³¨è§£æ¥å¤„ç†ç”¨æˆ·æˆæƒé€»è¾‘ã€‚ å®¢æˆ·ç«¯è¯¦æƒ…ï¼šå°è£… ClientDetails å®ç°ç±»ï¼ŒåŒ…å«å®¢æˆ·ç«¯æ³¨å†Œä¿¡æ¯ã€‚ é»˜è®¤ä»¤ç‰ŒæœåŠ¡ï¼šDefaultTokenServices å®ç°ç±»ç®¡ç†ä»¤ç‰Œç”Ÿå‘½å‘¨æœŸã€‚ è¯·æ±‚å·¥å‚ï¼šæä¾› RestTemplate å’Œ Apache HTTP Components ç­‰è¯·æ±‚å®¢æˆ·ç«¯ã€‚ spring-security-oauth2-client æ¨¡å—åŒæ—¶ä¹Ÿæä¾›éƒ¨åˆ†æ”¯æŒå…¶ä»–æˆæƒç±»å‹ï¼š\næˆæƒç æ¨¡å¼(authorization_code)ï¼šä¸»æµæ¨¡å¼ï¼Œå®¢æˆ·ç«¯é€šè¿‡ auth code è·å– access tokenã€‚ å¯†ç æ¨¡å¼(password)ï¼šå®¢æˆ·ç«¯ç›´æ¥æä¾›ç”¨æˆ·åå¯†ç è·å– tokenï¼Œé€‚åˆ trusted å®¢æˆ·ç«¯ã€‚ éšè—å¼æˆæƒæ¨¡å¼(implicit)ï¼šå®¢æˆ·ç«¯ç›´æ¥è·å– access tokenï¼Œä¸æ”¯æŒ refreshã€‚ å®¢æˆ·ç«¯æ¨¡å¼(client_credentials)ï¼šå®¢æˆ·ç«¯ä»¥è‡ªèº«åä¹‰è¯·æ±‚èµ„æºæœåŠ¡ï¼Œé€‚åˆæœºå¯†å®¢æˆ·ç«¯ã€‚ èµ„ä¸»æˆæƒæ¨¡å¼(owner)ï¼šç±»ä¼¼å¯†ç æ¨¡å¼ä½†ç”¨æˆ·éœ€ç¡®è®¤é€šè¿‡ç”¨æˆ·ç•Œé¢ã€‚ è¿è¡Œæ—¶å®¡æ‰¹æ¨¡å¼(approval_prompt)ï¼šç”¨æˆ·æ¯æ¬¡è®¿é—®éƒ½éœ€ç¡®è®¤æˆæƒã€‚ é™¤äº†ä¸Šè¿°å¸¸è§æˆæƒç±»å‹å¤–ï¼Œspring-security-oauth2-client è¿˜æä¾›äº†å¯¹ä»¥ä¸‹æ¨¡å¼çš„é€‰æ‹©æ€§æ”¯æŒï¼š\næ–­è·¯å™¨æ¨¡å¼(urn:ietf:params:oauth:grant-type:device_code) åˆ†é˜¶æ®µæˆæƒæ¨¡å¼(urn:ietf:params:oauth:grant-type:stage) ä»¤ç‰Œäº¤æ¢æ¨¡å¼(urn:ietf:params:oauth:grant-type:token-exchange) spring-security-oauth2-coreï¼šOAuth2 åè®®æ”¯æŒçš„æ ¸å¿ƒéƒ¨ä»¶ã€‚\nå› æ­¤ spring-boot-starter-security çš„ç‰ˆæœ¬å§‹ç»ˆä¿æŒä¸ spring-boot-starters ç‰ˆæœ¬ä¸€è‡´ã€‚\nå½“å‰è¾ƒä¸ºä¸»æµå’Œç¨³å®šçš„ spring-boot ç‰ˆæœ¬æœ‰ï¼š\nSpring Boot 2.7.x æœ€æ–°ç‰ˆ Spring Boot 2.6.x Spring Boot 2.5.x å¯¹åº”çš„ spring-boot-starter-security ç‰ˆæœ¬å¦‚ä¸‹ï¼š\nSpring Boot 2.7.x - spring-boot-starter-security 2.7.x Spring Boot 2.6.x - spring-boot-starter-security 2.6.x Spring Boot 2.5.x - spring-boot-starter-security 2.5.x æ‰€ä»¥åœ¨é€‰æ‹© spring boot ç‰ˆæœ¬æ—¶ï¼Œç›´æ¥ä¾èµ– spring-boot-starter-security è€Œä¸ç”¨å•ç‹¬æŒ‡å®šç‰ˆæœ¬ï¼Œå°±å¯ä»¥ä¿è¯å®‰å…¨åŠŸèƒ½çš„ç‰ˆæœ¬ä¸€è‡´æ€§ã€‚\nç›®å‰å¤§å¤šæ•°åœºæ™¯ä¸‹å¯ä»¥ä½¿ç”¨ Spring Boot 2.6.x æˆ–è€… 2.7.x ä½œä¸ºé€‰æ‹©ï¼Œå®ƒä»¬å†…ç½®çš„ spring-boot-starter-security ç‰ˆæœ¬éƒ½å¾ˆæˆç†Ÿã€‚\né…ç½® JwtToken enhancer æ¥ç”Ÿæˆ JWT ä»¤ç‰Œã€‚ @Bean public JwtAccessTokenConverter jwtTokenEnhancer() { JwtAccessTokenConverter converter = new JwtAccessTokenConverter(); converter.setSigningKey(\u0026#34;123456\u0026#34;); return converter; } å®šä¹‰ JwtTokenStore æ¥ä¿å­˜ JWT ä»¤ç‰Œã€‚ @Bean public TokenStore tokenStore() { return new JwtTokenStore(jwtTokenEnhancer()); } åœ¨ AuthorizationServerConfigurerAdapter é…ç½®ç±»ä¸­è®¾ç½® tokenStoreã€‚ @Override public void configure(AuthorizationServerEndpointsConfigurer endpoints) { endpoints.tokenStore(tokenStore()); } å®¢æˆ·ç«¯ä½¿ç”¨ JWT ä»¤ç‰Œè¿›è¡Œè®¤è¯è®¿é—®èµ„æºæœåŠ¡å™¨ã€‚\nèµ„æºæœåŠ¡å™¨ä½¿ç”¨ JwtTokenStore å’Œ JwtAccessTokenConverter æ ¡éªŒ JWT ä»¤ç‰Œçš„åˆæ³•æ€§ã€‚\nè§£æ JWTpayload è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå®ç°é‰´æƒå†³ç­–ã€‚\nString username = ((Jwt)authentication.getPrincipal()).getSubject(); å®Œæ•´ä»£ç ï¼Œé…ç½®ç±»ï¼š\n@Configuration @EnableWebSecurity public class SecurityConfig extends WebSecurityConfigurerAdapter { @Bean public JwtAccessTokenConverter accessTokenConverter() { JwtAccessTokenConverter converter = new JwtAccessTokenConverter(); converter.setSigningKey(\u0026#34;as123456dfsdf\u0026#34;); return converter; } @Bean public TokenStore tokenStore() { return new JwtTokenStore(accessTokenConverter()); } @Override protected void configure(HttpSecurity http) throws Exception { http.csrf().disable(); http .authorizeRequests() .antMatchers(\u0026#34;/oauth/**\u0026#34;).permitAll(); } @Bean @Primary public DefaultTokenServices tokenServices() { DefaultTokenServices defaultTokenServices = new DefaultTokenServices(); defaultTokenServices.setTokenStore(tokenStore()); defaultTokenServices.setSupportRefreshToken(true); return defaultTokenServices; } } æˆæƒæœåŠ¡å™¨é…ç½®ï¼Œä½¿ç”¨å®¢æˆ·ç«¯æ¨¡å¼é…ç½®ï¼š\n@Configuration public class AuthorizationServerConfig extends AuthorizationServerConfigurerAdapter { @Autowired private TokenStore tokenStore; @Override public void configure(ClientDetailsServiceConfigurer clients) throws Exception { clients.inMemory() .withClient(\u0026#34;clientapp\u0026#34;) .secret(\u0026#34;$2a$10$6aQQyhlhol4M1KAncczPdu4zX7/TgvjpOU.sWzt7j5Xl6W/z5V4cC\u0026#34;) .authorizedGrantTypes(\u0026#34;password\u0026#34;ï¼Œ \u0026#34;refresh_token\u0026#34;) .scopes(\u0026#34;read\u0026#34;ï¼Œ \u0026#34;write\u0026#34;) .accessTokenValiditySeconds(3600); } @Override public void configure(AuthorizationServerEndpointsConfigurer endpoints) throws Exception { endpoints.tokenStore(tokenStore) .authenticationManager(authenticationManager()); } } ä¸»è¦é…ç½®ï¼š\nä½¿ç”¨ ClientDetailsServiceConfigurer é…ç½®å®¢æˆ·ç«¯ä¿¡æ¯ï¼Œå¦‚ clientIdã€secret ç­‰ é…ç½® tokenStore é…ç½® authenticationManager æ¥è·å–ç”¨æˆ·ä¿¡æ¯ è¿™æ ·å°±å®ç°äº†åŸºäºå®¢æˆ·ç«¯æ¨¡å¼ä¸‹çš„æˆæƒæœåŠ¡é…ç½®ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨ clientId/secret è·å–è®¿é—®ä»¤ç‰Œè€Œæ— éœ€ç”¨æˆ·ç™»å½•ã€‚\nå®¢æˆ·ç«¯è®¿é—®ç¤ºä¾‹ï¼š\ncurl -X POST http://localhost:8080/oauth/token -d \u0026#34;grant_type=password\u0026amp;username=user\u0026amp;password=password\u0026amp;client_id=clientapp\u0026amp;client_secret=secret\u0026#34; è®©å®¢æˆ·ç«¯åœ¨åå°è·å–è®¿é—®ä»¤ç‰Œï¼Œèµ„æºæœåŠ¡å†ä½¿ç”¨ä»¤ç‰ŒéªŒè¯æˆæƒã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/08/15/spring-security-oauth2-history/","summary":"Spring Security çš„å‘å±•è¿‡ç¨‹ Spring Security æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ä¸”å¹¿æ³›ä½¿ç”¨çš„å®‰å…¨æ¡†æ¶ï¼Œä¸ºä¼ä¸šçº§åº”ç”¨ç¨‹åºæä¾›äº†å…¨é¢çš„å®‰å…¨æ€§ã€‚Spring Security æœ€åˆæ˜¯ Acegi Security é¡¹ç›®çš„ä¸€éƒ¨åˆ†ï¼Œäº 2004 å¹´å‘å¸ƒï¼Œç°åœ¨å·²ç»æˆä¸º Spring ç”Ÿæ€ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ã€‚ Spring Security çš„å‘å±•è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š\nç¬¬ä¸€é˜¶æ®µï¼šSpring Security èµ·æºäºä¸€ä¸ªåä¸º Acegi Security çš„å¼€æºé¡¹ç›®ï¼ŒåˆæœŸé‡ç‚¹å®ç°äº† Spring åº”ç”¨çš„èº«ä»½è®¤è¯å’ŒæˆæƒæœåŠ¡åŠŸèƒ½ã€‚2003 å¹´ï¼ŒAcegi Security ä½œä¸ºä¸€ä¸ªå­µåŒ–é¡¹ç›®è¢«æçŒ®ç»™ Spring ç¤¾åŒºã€‚2004 å¹´ï¼Œæ­£å¼ä½œä¸º Spring æ¡†æ¶çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ Absorbed è¿› Springã€‚å¹¶æ›´åä¸º Spring Securityã€‚Spring Security 1.0 ç‰ˆæœ¬ Spring Security 1.0 ç‰ˆæœ¬å‘å¸ƒäº 2004 å¹´ã€‚å®ƒæä¾›äº†æœ€åŸºæœ¬çš„å®‰å…¨åŠŸèƒ½ï¼ŒåŒ…æ‹¬èº«ä»½éªŒè¯å’Œæˆæƒã€‚èº«ä»½éªŒè¯æ˜¯éªŒè¯ç”¨æˆ·æ˜¯å¦æ˜¯ä»–ä»¬æ‰€å£°ç§°çš„äººçš„è¿‡ç¨‹ã€‚æˆæƒæ˜¯ç¡®å®šç”¨æˆ·æ˜¯å¦æœ‰æƒè®¿é—®ç‰¹å®šèµ„æºçš„è¿‡ç¨‹ã€‚ Spring Security 1.0 ç‰ˆæœ¬ä½¿ç”¨äº†ä»¥ä¸‹æŠ€æœ¯æ¥å®ç°èº«ä»½éªŒè¯å’Œæˆæƒï¼š\nè¡¨å•èº«ä»½éªŒè¯ï¼šè¡¨å•èº«ä»½éªŒè¯æ˜¯é€šè¿‡ç”¨æˆ·æäº¤è¡¨å•æ¥éªŒè¯ç”¨æˆ·èº«ä»½çš„è¿‡ç¨‹ã€‚ åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ (RBAC)ï¼šRBAC æ˜¯ä¸€ç§æˆæƒæ¨¡å‹ï¼Œå®ƒå°†ç”¨æˆ·åˆ†é…åˆ°è§’è‰²ï¼Œç„¶åè¿™äº›è§’è‰²è¢«æˆäºˆå¯¹ç‰¹å®šèµ„æºçš„è®¿é—®æƒé™ã€‚ ç¬¬äºŒé˜¶æ®µï¼šSpring Security 2.0 ç‰ˆæœ¬ Spring Security 2.0 ç‰ˆæœ¬å‘å¸ƒäº 2006 å¹´ã€‚å®ƒæä¾›äº†æ›´å¤šçš„å®‰å…¨åŠŸèƒ½ï¼ŒåŒ…æ‹¬åŠ å¯†å’Œä¼šè¯ç®¡ç†ã€‚åŠ å¯†æ˜¯å°†æ•°æ®è½¬æ¢æˆæ— æ³•è¢«ä»–äººç†è§£çš„å½¢å¼çš„è¿‡ç¨‹ã€‚ä¼šè¯ç®¡ç†æ˜¯è·Ÿè¸ªç”¨æˆ·ä¼šè¯çš„çŠ¶æ€çš„è¿‡ç¨‹ã€‚ Spring Security 2.0 ç‰ˆæœ¬ä½¿ç”¨äº†ä»¥ä¸‹æŠ€æœ¯æ¥å®ç°åŠ å¯†å’Œä¼šè¯ç®¡ç†ï¼š\nå®‰å…¨å¥—æ¥å­—å±‚ (SSL)ï¼šSSL æ˜¯ä¸€ç§åŠ å¯†åè®®ï¼Œå®ƒå¯ä»¥ä¿æŠ¤æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸è¢«çªƒå¬ã€‚ ä¼šè¯ç®¡ç†ï¼šSpring Security æä¾›äº†è‡ªå·±çš„ä¼šè¯ç®¡ç†å®ç°ï¼Œå®ƒå¯ä»¥è·Ÿè¸ªç”¨æˆ·ä¼šè¯çš„çŠ¶æ€ã€‚ ç¬¬ä¸‰é˜¶æ®µï¼šSpring Security 3.0 ç‰ˆæœ¬ Spring Security 3.0 ç‰ˆæœ¬å‘å¸ƒäº 2008 å¹´ã€‚å®ƒæ˜¯ä¸€ä¸ªé‡å¤§çš„ç‰ˆæœ¬æ›´æ–°ï¼Œå®ƒæä¾›äº†è®¸å¤šæ–°çš„å®‰å…¨åŠŸèƒ½ï¼ŒåŒ…æ‹¬ OAuthã€SAML å’Œ OpenIDã€‚ OAuth æ˜¯ä¸€ç§æˆæƒæ¡†æ¶ï¼Œå®ƒå…è®¸ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºè®¿é—®ç”¨æˆ·çš„èµ„æºã€‚SAML æ˜¯ä¸€ç§å•ç‚¹ç™»å½• (SSO) åè®®ï¼Œå®ƒå…è®¸ç”¨æˆ·åœ¨ä¸€ä¸ªåœ°æ–¹ç™»å½•ï¼Œç„¶åè®¿é—®å¤šä¸ªç½‘ç«™ã€‚OpenID æ˜¯ä¸€ç§å¼€æ”¾çš„èº«ä»½éªŒè¯åè®®ï¼Œå®ƒå…è®¸ç”¨æˆ·ä½¿ç”¨ä»–ä»¬é€‰æ‹©çš„èº«ä»½æä¾›å•†æ¥éªŒè¯ä»–ä»¬çš„èº«ä»½ã€‚ Spring Security 3.0 ç‰ˆæœ¬ä½¿ç”¨äº†ä»¥ä¸‹æŠ€æœ¯æ¥å®ç° OAuthã€SAML å’Œ OpenIDï¼š","title":"Spring Securityå’ŒOAuth2å‘å±•è¿‡ç¨‹"},{"content":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬å››ç« ã€Šç±»å’Œæ¥å£ã€‹çš„å­¦ä¹ ç¬”è®°ï¼šå‡å°‘å¯å˜æ€§ã€‚\nåŸæ–‡ ä¸å¯å˜ç±»æ˜¯å®ä¾‹ä¸èƒ½è¢«ä¿®æ”¹çš„ç±»ã€‚æ¯ä¸ªå®ä¾‹ä¸­åŒ…å«çš„æ‰€æœ‰ä¿¡æ¯åœ¨å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå†…éƒ½æ˜¯å›ºå®šçš„ï¼Œå› æ­¤æ°¸è¿œä¸ä¼šè§‚å¯Ÿåˆ°ä»»ä½•æ›´æ”¹ã€‚Java åº“åŒ…å«è®¸å¤šä¸å¯å˜çš„ç±»ï¼ŒåŒ…æ‹¬ Stringã€åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»ã€BigInteger å’Œ BigDecimalã€‚è¿™ä¹ˆåšæœ‰å¾ˆå¥½çš„ç†ç”±ï¼šä¸å¯å˜ç±»æ¯”å¯å˜ç±»æ›´å®¹æ˜“è®¾è®¡ã€å®ç°å’Œä½¿ç”¨ã€‚å®ƒä»¬ä¸å¤ªå®¹æ˜“å‡ºé”™ï¼Œè€Œä¸”æ›´å®‰å…¨ã€‚\nè¦ä½¿ç±»ä¸å¯å˜ï¼Œè¯·éµå¾ªä»¥ä¸‹ 5 æ¡è§„åˆ™ï¼š\n1ã€ä¸è¦æä¾›ä¿®æ”¹å¯¹è±¡çŠ¶æ€çš„æ–¹æ³•ï¼ˆè¿™ç±»æ–¹æ³•ä¹Ÿè¢«ç§°ä¸ºä¿®æ”¹å™¨ï¼‰\n2ã€ç¡®ä¿ç±»ä¸èƒ½è¢«ç»§æ‰¿ã€‚ è¿™å¯ä»¥é˜²æ­¢ç²—å¿ƒæˆ–æ¶æ„çš„é€šè¿‡å­ç±»å®ä¾‹å¯¹è±¡çŠ¶æ€å¯æ”¹å˜çš„æ–¹å¼ï¼ŒæŸå®³çˆ¶ç±»çš„ä¸å¯å˜è¡Œä¸ºã€‚é˜²æ­¢å­ç±»åŒ–é€šå¸¸ç”¨ final ä¿®é¥°çˆ¶ç±»ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ç§æ›¿ä»£æ–¹æ³•ï¼Œæˆ‘ä»¬å°†åœ¨åé¢è®¨è®ºã€‚\n3ã€æ‰€æœ‰å­—æ®µç”¨ final ä¿®é¥°ã€‚ è¿™æ¸…æ¥šåœ°è¡¨è¾¾äº†æ„å›¾ï¼Œå¹¶ç”±ç³»ç»Ÿå¼ºåˆ¶æ‰§è¡Œã€‚åŒæ ·ï¼Œå¦‚æœåœ¨æ²¡æœ‰åŒæ­¥çš„æƒ…å†µä¸‹ï¼Œå¼•ç”¨æ–°åˆ›å»ºçš„å®ä¾‹å¹¶ä»ä¸€ä¸ªçº¿ç¨‹ä¼ é€’åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆå°±æœ‰å¿…è¦ç¡®ä¿æ­£ç¡®çš„è¡Œä¸ºï¼Œå°±åƒå†…å­˜æ¨¡å‹ä¸­æè¿°çš„é‚£æ ·ã€‚\n4ã€æ‰€æœ‰å­—æ®µè®¾ä¸ºç§æœ‰ã€‚ è¿™å°†é˜»æ­¢å®¢æˆ·ç«¯è®¿é—®å­—æ®µå¼•ç”¨çš„å¯å˜å¯¹è±¡å¹¶ç›´æ¥ä¿®æ”¹è¿™äº›å¯¹è±¡ã€‚è™½ç„¶åœ¨æŠ€æœ¯ä¸Šå…è®¸ä¸å¯å˜ç±»æ‹¥æœ‰åŒ…å«åŸºæœ¬ç±»å‹æˆ–å¯¹ä¸å¯å˜å¯¹è±¡çš„å¼•ç”¨çš„å…¬å…± final å­—æ®µï¼Œä½†ä¸å»ºè®®è¿™æ ·åšï¼Œå› ä¸ºåœ¨ä»¥åçš„ç‰ˆæœ¬ä¸­æ— æ³•æ›´æ”¹å†…éƒ¨è¡¨ç¤ºã€‚\n5ã€ç¡®ä¿å¯¹ä»»ä½•å¯å˜ç»„ä»¶çš„ç‹¬å è®¿é—®ã€‚ å¦‚æœä½ çš„ç±»æœ‰ä»»ä½•å¼•ç”¨å¯å˜å¯¹è±¡çš„å­—æ®µï¼Œè¯·ç¡®ä¿è¯¥ç±»çš„å®¢æˆ·ç«¯æ— æ³•è·å¾—å¯¹è¿™äº›å¯¹è±¡çš„å¼•ç”¨ã€‚æ°¸è¿œä¸è¦å‘æä¾›å¯¹è±¡å¼•ç”¨çš„å®¢æˆ·ç«¯åˆå§‹åŒ–è¿™æ ·çš„å­—æ®µï¼Œä¹Ÿä¸è¦ä»è®¿é—®å™¨è¿”å›å­—æ®µã€‚åœ¨æ„é€ å‡½æ•°ã€è®¿é—®å™¨å’Œ readObject æ–¹æ³•ä¸­åˆ›å»ºé˜²å¾¡æ€§å‰¯æœ¬ã€‚\nå‰é¢æ¡ç›®ä¸­çš„è®¸å¤šç¤ºä¾‹ç±»éƒ½æ˜¯ä¸å¯å˜çš„ã€‚å…¶ä¸­ä¸€ä¸ªç±»æ˜¯ PhoneNumberï¼Œå®ƒçš„æ¯ä¸ªå±æ€§éƒ½æœ‰è®¿é—®å™¨ï¼Œä½†æ²¡æœ‰å¯¹åº”çš„ä¿®æ”¹å™¨ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¨å¾®å¤æ‚çš„ä¾‹å­ï¼š\n// Immutable complex number class public final class Complex { private final double re; private final double im; public Complex(double re, double im) { this.re = re; this.im = im; } public double realPart() { return re; } public double imaginaryPart() { return im; } public Complex plus(Complex c) { return new Complex(re + c.re, im + c.im); } public Complex minus(Complex c) { return new Complex(re - c.re, im - c.im); } public Complex times(Complex c) { return new Complex(re * c.re - im * c.im, re * c.im + im * c.re); } public Complex dividedBy(Complex c) { double tmp = c.re * c.re + c.im * c.im; return new Complex((re * c.re + im * c.im) / tmp, (im * c.re - re * c.im) / tmp); } @Override public boolean equals(Object o) { if (o == this) return true; if (!(o instanceof Complex)) return false; Complex c = (Complex) o; // See page 47 to find out why we use compare instead of == return Double.compare(c.re, re) == 0 \u0026amp;\u0026amp; Double.compare(c.im, im) == 0; } @Override public int hashCode() { return 31 * Double.hashCode(re) + Double.hashCode(im); } @Override public String toString() { return \u0026#34;(\u0026#34; + re + \u0026#34; + \u0026#34; + im + \u0026#34;i)\u0026#34;; } } è¿™ä¸ªç±»è¡¨ç¤ºä¸€ä¸ªå¤æ•°ï¼ˆåŒ…å«å®éƒ¨å’Œè™šéƒ¨çš„æ•°ï¼‰ã€‚é™¤äº†æ ‡å‡†çš„ Object æ–¹æ³•ä¹‹å¤–ï¼Œå®ƒè¿˜ä¸ºå®éƒ¨å’Œè™šéƒ¨æä¾›è®¿é—®å™¨ï¼Œå¹¶æä¾›å››ç§åŸºæœ¬çš„ç®—æœ¯è¿ç®—ï¼šåŠ æ³•ã€å‡æ³•ã€ä¹˜æ³•å’Œé™¤æ³•ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç®—æœ¯æ“ä½œåˆ›å»ºå’Œè¿”å›ä¸€ä¸ªæ–°çš„ Complex å®ä¾‹ï¼Œè€Œä¸æ˜¯ä¿®æ”¹è¿™ä¸ªå®ä¾‹ã€‚è¿™ç§æ¨¡å¼ç§°ä¸ºå‡½æ•°å¼æ–¹æ³•ï¼Œå› ä¸ºæ–¹æ³•è¿”å›çš„ç»“æœæ˜¯å°†å‡½æ•°åº”ç”¨åˆ°å…¶æ“ä½œæ•°ï¼Œè€Œä¸æ˜¯ä¿®æ”¹å®ƒã€‚å°†å…¶ä¸è¿‡ç¨‹å¼æˆ–å‘½ä»¤å¼æ–¹æ³•è¿›è¡Œå¯¹æ¯”ï¼Œåœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œæ–¹æ³•å°†ä¸€ä¸ªè®¡ç®—è¿‡ç¨‹åº”ç”¨äºå®ƒä»¬çš„æ“ä½œæ•°ï¼Œä»è€Œå¯¼è‡´å…¶çŠ¶æ€å‘ç”Ÿå˜åŒ–ã€‚æ³¨æ„ï¼Œæ–¹æ³•åæ˜¯ä»‹è¯ï¼ˆå¦‚ plus)ï¼Œè€Œä¸æ˜¯åŠ¨è¯ï¼ˆå¦‚ add)ã€‚è¿™å¼ºè°ƒäº†è¿™æ ·ä¸€ä¸ªäº‹å®ï¼Œå³æ–¹æ³•ä¸ä¼šæ”¹å˜å¯¹è±¡çš„å€¼ã€‚BigInteger å’Œ BigDecimal ç±»ä¸éµå®ˆè¿™ç§å‘½åçº¦å®šï¼Œè¿™å¯¼è‡´äº†è®¸å¤šä½¿ç”¨é”™è¯¯ã€‚\nå¦‚æœä¸ç†Ÿæ‚‰å‡½æ•°å¼æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒå¯èƒ½çœ‹èµ·æ¥ä¸è‡ªç„¶ï¼Œä½†å®ƒå®ç°äº†ä¸å˜æ€§ï¼Œè¿™ä¹ˆåšæœ‰å¾ˆå¤šä¼˜åŠ¿ã€‚ ä¸å¯å˜å¯¹è±¡å¾ˆç®€å•ã€‚ ä¸å¯å˜å¯¹è±¡å¯ä»¥ä¿æŒå®ƒè¢«åˆ›å»ºæ—¶çš„çŠ¶æ€ã€‚å¦‚æœèƒ½å¤Ÿç¡®ä¿æ‰€æœ‰æ„é€ å‡½æ•°éƒ½å»ºç«‹äº†ç±»ä¸å˜é‡ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä¿è¯è¿™äº›ä¸å˜é‡å°†ä¸€ç›´ä¿æŒï¼Œè€Œæ— éœ€ä½ æˆ–ä½¿ç”¨ç±»çš„ç¨‹åºå‘˜åšè¿›ä¸€æ­¥çš„å·¥ä½œã€‚å¦ä¸€æ–¹é¢ï¼Œå¯å˜å¯¹è±¡å¯ä»¥å…·æœ‰ä»»æ„å¤æ‚çš„çŠ¶æ€ç©ºé—´ã€‚å¦‚æœæ–‡æ¡£æ²¡æœ‰æä¾›ç”±ä¿®æ”¹å™¨æ–¹æ³•æ‰§è¡Œçš„çŠ¶æ€è½¬æ¢çš„ç²¾ç¡®æè¿°ï¼Œé‚£ä¹ˆå°±å¾ˆéš¾æˆ–ä¸å¯èƒ½å¯é åœ°ä½¿ç”¨å¯å˜ç±»ã€‚\nä¸å¯å˜å¯¹è±¡æœ¬è´¨ä¸Šæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼›å®ƒä»¬ä¸éœ€è¦åŒæ­¥ã€‚ å®ƒä»¬ä¸ä¼šå› ä¸ºå¤šçº¿ç¨‹å¹¶å‘è®¿é—®è€ŒæŸåã€‚è¿™æ— ç–‘æ˜¯å®ç°çº¿ç¨‹å®‰å…¨çš„æœ€ç®€å•æ–¹æ³•ã€‚ç”±äºä»»ä½•çº¿ç¨‹éƒ½æ— æ³•è§‚å¯Ÿåˆ°å¦ä¸€ä¸ªçº¿ç¨‹å¯¹ä¸å¯å˜å¯¹è±¡çš„ä»»ä½•å½±å“ï¼Œå› æ­¤ å¯ä»¥è‡ªç”±å…±äº«ä¸å¯å˜å¯¹è±¡ã€‚ åŒæ—¶ï¼Œä¸å¯å˜ç±»åº”è¯¥é¼“åŠ±å®¢æˆ·ç«¯å°½å¯èƒ½å¤ç”¨ç°æœ‰çš„å®ä¾‹ã€‚ä¸€ç§ç®€å•çš„æ–¹æ³•æ˜¯ä¸ºå¸¸ç”¨å€¼æä¾›å…¬å…±é™æ€ final å¸¸é‡ã€‚ä¾‹å¦‚ï¼ŒComplex ç±»å¯èƒ½æä¾›ä»¥ä¸‹å¸¸é‡ï¼š\npublic static final Complex ZERO = new Complex(0, 0); public static final Complex ONE = new Complex(1, 0); public static final Complex I = new Complex(0, 1); è¿™ç§æ–¹æ³•å¯ä»¥æ›´è¿›ä¸€æ­¥ã€‚ä¸å¯å˜ç±»å¯ä»¥æä¾›é™æ€å·¥å‚ï¼Œè¿™äº›å·¥å‚ç¼“å­˜ç»å¸¸è¯·æ±‚çš„å®ä¾‹ï¼Œä»¥é¿å…åœ¨ç°æœ‰å®ä¾‹å¯ç”¨æ—¶åˆ›å»ºæ–°å®ä¾‹ã€‚æ‰€æœ‰åŒ…è£…ç±»å’Œ BigInteger éƒ½æ˜¯è¿™æ ·åšçš„ã€‚ä½¿ç”¨è¿™ç§é™æ€å·¥å‚ä¼šå¯¼è‡´å®¢æˆ·ç«¯å…±äº«å®ä¾‹è€Œä¸æ˜¯åˆ›å»ºæ–°å®ä¾‹ï¼Œä»è€Œå‡å°‘å†…å­˜å ç”¨å’Œåƒåœ¾æ”¶é›†æˆæœ¬ã€‚åœ¨è®¾è®¡æ–°ç±»æ—¶ï¼Œé€‰æ‹©é™æ€å·¥å‚è€Œä¸æ˜¯å…¬å…±æ„é€ å‡½æ•°ï¼Œè¿™å°†ä½¿ä½ èƒ½å¤Ÿçµæ´»åœ°åœ¨ä»¥åæ·»åŠ ç¼“å­˜ï¼Œè€Œæ— éœ€ä¿®æ”¹å®¢æˆ·ç«¯ã€‚\nä¸å¯å˜å¯¹è±¡å¯ä»¥è‡ªç”±å…±äº«è¿™ä¸€äº‹å®çš„ç»“æœä¹‹ä¸€æ˜¯ï¼Œä½ æ°¸è¿œä¸éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œé˜²å¾¡æ€§çš„å¤åˆ¶ã€‚äº‹å®ä¸Šï¼Œä½ æ ¹æœ¬ä¸éœ€è¦åšä»»ä½•æ‹·è´ï¼Œå› ä¸ºæ‹·è´å°†æ°¸è¿œç­‰åŒäºåŸä»¶ã€‚å› æ­¤ï¼Œä½ ä¸éœ€è¦ä¹Ÿä¸åº”è¯¥åœ¨ä¸å¯å˜ç±»ä¸Šæä¾›å…‹éš†æ–¹æ³•æˆ–å¤åˆ¶æ„é€ å‡½æ•°ã€‚è¿™åœ¨ Java å¹³å°çš„æ—©æœŸå¹¶æ²¡æœ‰å¾—åˆ°å¾ˆå¥½çš„ç†è§£ï¼Œå› æ­¤ String ç±»ç¡®å®æœ‰ä¸€ä¸ªå¤åˆ¶æ„é€ å‡½æ•°ï¼Œä½†æ˜¯ï¼Œå³ä½¿æœ‰ï¼Œä¹Ÿåº”è¯¥å°‘ç”¨ã€‚\nä½ ä¸ä»…å¯ä»¥å…±äº«ä¸å¯å˜å¯¹è±¡ï¼Œè€Œä¸”å¯ä»¥å…±äº«å®ƒä»¬çš„å†…éƒ¨å®ç°ã€‚ ä¾‹å¦‚ï¼ŒBigInteger ç±»åœ¨å†…éƒ¨ä½¿ç”¨ç¬¦å·å¤§å°æ¥è¡¨ç¤ºã€‚ç¬¦å·ç”± int è¡¨ç¤ºï¼Œå¤§å°ç”± int æ•°ç»„è¡¨ç¤ºã€‚negate æ–¹æ³•äº§ç”Ÿä¸€ä¸ªæ–°çš„ BigIntegerï¼Œå¤§å°ç›¸åŒï¼Œç¬¦å·ç›¸åã€‚å³ä½¿æ•°ç»„æ˜¯å¯å˜çš„ï¼Œä¹Ÿä¸éœ€è¦å¤åˆ¶ï¼›æ–°åˆ›å»ºçš„ BigInteger æŒ‡å‘ä¸åŸå§‹æ•°ç»„ç›¸åŒçš„å†…éƒ¨æ•°ç»„ã€‚\nä¸å¯å˜å¯¹è±¡å¯ä»¥å¾ˆå¥½çš„ä½œä¸ºå…¶ä»–å¯¹è±¡çš„æ„å»ºæ¨¡å—ï¼Œ æ— è®ºæ˜¯å¯å˜çš„è¿˜æ˜¯ä¸å¯å˜çš„ã€‚å¦‚æœçŸ¥é“å¤æ‚å¯¹è±¡çš„ç»„ä»¶å¯¹è±¡ä¸ä¼šåœ¨å…¶å†…éƒ¨å‘ç”Ÿæ›´æ”¹ï¼Œé‚£ä¹ˆç»´æŠ¤å¤æ‚å¯¹è±¡çš„ä¸å˜æ€§å°±ä¼šå®¹æ˜“å¾—å¤šã€‚è¿™ä¸ªåŸåˆ™çš„ä¸€ä¸ªå…·ä½“çš„ä¾‹å­æ˜¯ï¼Œä¸å¯å˜å¯¹è±¡å¾ˆåˆé€‚ä½œä¸º Map çš„é”®å’Œ Set çš„å…ƒç´ ï¼šä½ ä¸å¿…æ‹…å¿ƒå®ƒä»¬çš„å€¼åœ¨ Map æˆ– Set ä¸­å‘ç”Ÿå˜åŒ–ï¼Œä»è€Œç ´å Map æˆ– Set çš„ä¸å˜æ€§ã€‚\nä¸å¯å˜å¯¹è±¡è‡ªå¸¦æä¾›æ•…éšœåŸå­æ€§ã€‚ä»–ä»¬çš„çŠ¶æ€ä»æœªæ”¹å˜ï¼Œæ‰€ä»¥ä¸å¯èƒ½å‡ºç°æš‚æ—¶çš„ä¸ä¸€è‡´ã€‚\nä¸å¯å˜ç±»çš„ä¸»è¦ç¼ºç‚¹æ˜¯æ¯ä¸ªä¸åŒçš„å€¼éƒ½éœ€è¦ä¸€ä¸ªå•ç‹¬çš„å¯¹è±¡ã€‚ åˆ›å»ºè¿™äº›å¯¹è±¡çš„æˆæœ¬å¯èƒ½å¾ˆé«˜ï¼Œå°¤å…¶æ˜¯å¯¹è±¡å¾ˆå¤§çš„æ—¶å€™ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ªç™¾ä¸‡ä½çš„ BigIntegerï¼Œä½ æƒ³æ”¹å˜å®ƒçš„ä½é˜¶ä½ï¼š\nBigInteger moby = ...; moby = moby.flipBit(0); flipBit æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ BigInteger å®ä¾‹ï¼Œä¹Ÿæœ‰ç™¾ä¸‡ä½é•¿ï¼Œåªåœ¨ä¸€ä¸ªæ¯”ç‰¹ä¸Šä¸åŸå§‹çš„ä¸åŒã€‚è¯¥æ“ä½œéœ€è¦ä¸ BigInteger çš„å¤§å°æˆæ¯”ä¾‹çš„æ—¶é—´å’Œç©ºé—´ã€‚ä¸ java.util.BitSet å½¢æˆå¯¹æ¯”ã€‚ä¸ BigInteger ä¸€æ ·ï¼ŒBitSet è¡¨ç¤ºä»»æ„é•¿çš„ä½åºåˆ—ï¼Œä½†ä¸ BigInteger ä¸åŒï¼ŒBitSet æ˜¯å¯å˜çš„ã€‚BitSet ç±»æä¾›äº†ä¸€ç§æ–¹æ³•ï¼Œå¯ä»¥è®©ä½ åœ¨å›ºå®šçš„æ—¶é—´å†…æ”¹å˜ç™¾ä¸‡ä½å®ä¾‹çš„å•ä¸ªä½çš„çŠ¶æ€ï¼š\nBitSet moby = ...; moby.flip(0); å¦‚æœæ‰§è¡Œå¤šæ­¥æ“ä½œï¼Œåœ¨æ¯ä¸€æ­¥ç”Ÿæˆä¸€ä¸ªæ–°å¯¹è±¡ï¼Œæœ€ç»ˆä¸¢å¼ƒé™¤æœ€ç»ˆç»“æœä¹‹å¤–çš„æ‰€æœ‰å¯¹è±¡ï¼Œé‚£ä¹ˆæ€§èƒ½é—®é¢˜å°±ä¼šè¢«æ”¾å¤§ã€‚æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ç¬¬ä¸€ç§æ–¹æ³•æ˜¯çŒœæµ‹é€šå¸¸éœ€è¦å“ªäº›å¤šæ­¥æ“ä½œï¼Œå¹¶å°†å®ƒä»¬ä½œä¸ºåŸºæœ¬æ•°æ®ç±»å‹æä¾›ã€‚å¦‚æœå°†å¤šæ­¥æ“ä½œä½œä¸ºåŸºæœ¬æ•°æ®ç±»å‹æä¾›ï¼Œåˆ™ä¸å¯å˜ç±»ä¸å¿…åœ¨æ¯ä¸ªæ­¥éª¤ä¸­åˆ›å»ºå•ç‹¬çš„å¯¹è±¡ã€‚åœ¨å†…éƒ¨ï¼Œä¸å¯å˜ç±»å¯ä»¥ä»»æ„èªæ˜ã€‚ä¾‹å¦‚ï¼ŒBigInteger æœ‰ä¸€ä¸ªåŒ…ç§æœ‰çš„å¯å˜ã€Œä¼´éšç±»ã€ï¼Œå®ƒä½¿ç”¨è¿™ä¸ªç±»æ¥åŠ é€Ÿå¤šæ­¥æ“ä½œï¼Œæ¯”å¦‚æ¨¡å—åŒ–æ±‚å¹‚ã€‚ç”±äºå‰é¢åˆ—å‡ºçš„æ‰€æœ‰åŸå› ï¼Œä½¿ç”¨å¯å˜ä¼´éšç±»è¦æ¯”ä½¿ç”¨ BigInteger éš¾å¾—å¤šã€‚å¹¸è¿çš„æ˜¯ï¼Œä½ ä¸å¿…ä½¿ç”¨å®ƒï¼šBigInteger çš„å®ç°è€…ä¸ºä½ åšäº†è‰°è‹¦çš„å·¥ä½œã€‚\nå¦‚æœä½ èƒ½å¤Ÿå‡†ç¡®åœ°é¢„æµ‹å®¢æˆ·ç«¯å¸Œæœ›åœ¨ä¸å¯å˜ç±»ä¸Šæ‰§è¡Œå“ªäº›å¤æ‚æ“ä½œï¼Œé‚£ä¹ˆåŒ…ç§æœ‰å¯å˜ä¼´éšç±»æ–¹æ³•å°±å¯ä»¥å¾ˆå¥½åœ°å·¥ä½œã€‚å¦‚æœä¸æ˜¯ï¼Œé‚£ä¹ˆä½ æœ€å¥½çš„é€‰æ‹©å°±æ˜¯æä¾›ä¸€ä¸ªå…¬å…±å¯å˜ä¼´éšç±»ã€‚è¿™ç§æ–¹æ³•åœ¨ Java åº“ä¸­çš„ä¸»è¦ç¤ºä¾‹æ˜¯ String ç±»ï¼Œå®ƒçš„å¯å˜ä¼´éšç±»æ˜¯ StringBuilderï¼ˆåŠå…¶è¿‡æ—¶çš„å‰èº« StringBuffer)ã€‚\næ—¢ç„¶ä½ å·²ç»çŸ¥é“äº†å¦‚ä½•åˆ›å»ºä¸å¯å˜ç±»ï¼Œå¹¶ä¸”äº†è§£äº†ä¸å¯å˜æ€§çš„ä¼˜ç¼ºç‚¹ï¼Œé‚£ä¹ˆè®©æˆ‘ä»¬æ¥è®¨è®ºä¸€äº›è®¾è®¡æ–¹æ¡ˆã€‚å›æƒ³ä¸€ä¸‹ï¼Œä¸ºäº†ä¿è¯ä¸å˜æ€§ï¼Œç±»ä¸å…è®¸è‡ªå·±è¢«å­ç±»åŒ–ã€‚å¯ä»¥ç”¨ final ä¿®é¥°ä»¥è¾¾åˆ°ç›®çš„ï¼Œä½†æ˜¯è¿˜æœ‰å¦å¤–ä¸€ä¸ªæ›´çµæ´»çš„é€‰æ‹©ï¼Œä½ å¯ä»¥å°†å…¶æ‰€æœ‰æ„é€ å‡½æ•°å˜ä¸ºç§æœ‰æˆ–åŒ…ç§æœ‰ï¼Œå¹¶ä½¿ç”¨å…¬å…±é™æ€å·¥å‚æ–¹æ³•æ¥ä»£æ›¿å…¬å…±çš„æ„é€ å‡½æ•°ã€‚Complex ç±»é‡‡ç”¨è¿™ç§æ–¹å¼ä¿®æ”¹åå¦‚ä¸‹æ‰€ç¤ºï¼š\n// Immutable class with static factories instead of constructors public class Complex { private final double re; private final double im; private Complex(double re, double im) { this.re = re; this.im = im; } public static Complex valueOf(double re, double im) { return new Complex(re, im); } ... // Remainder unchanged } è¿™ç§æ–¹å¼é€šå¸¸æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚å®ƒæ˜¯æœ€çµæ´»çš„ï¼Œå› ä¸ºå®ƒå…è®¸ä½¿ç”¨å¤šä¸ªåŒ…ç§æœ‰å®ç°ç±»ã€‚å¯¹äºé©»ç•™åœ¨åŒ…ä¹‹å¤–çš„å®¢æˆ·ç«¯è€Œè¨€ï¼Œä¸å¯å˜ç±»å®é™…ä¸Šæ˜¯ final ç±»ï¼Œå› ä¸ºä¸å¯èƒ½ç»§æ‰¿è‡ªå¦ä¸€ä¸ªåŒ…çš„ç±»ï¼Œå› ä¸ºå®ƒç¼ºå°‘å…¬å…±æˆ–å—ä¿æŠ¤çš„æ„é€ å‡½æ•°ã€‚é™¤äº†å…è®¸å¤šå®ç°ç±»çš„çµæ´»æ€§ä¹‹å¤–ï¼Œè¿™ç§æ–¹æ³•è¿˜é€šè¿‡æ”¹è¿›é™æ€å·¥å‚çš„å¯¹è±¡ç¼“å­˜åŠŸèƒ½ï¼Œä½¿å¾—åç»­ç‰ˆæœ¬ä¸­è°ƒä¼˜è¯¥ç±»çš„æ€§èƒ½æˆä¸ºå¯èƒ½ã€‚\nå½“ç¼–å†™ BigInteger å’Œ BigDecimal æ—¶ï¼Œä¸å¯å˜ç±»å¿…é¡»æ˜¯æœ‰æ•ˆçš„ final è¿™ä¸€ç‚¹æ²¡æœ‰è¢«å¹¿æ³›ç†è§£ï¼Œå› æ­¤å®ƒä»¬çš„æ‰€æœ‰æ–¹æ³•éƒ½å¯èƒ½è¢«é‡å†™ã€‚é—æ†¾çš„æ˜¯ï¼Œåœ¨ä¿ç•™å‘åå…¼å®¹æ€§çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªé—®é¢˜æ— æ³•å¾—åˆ°çº æ­£ã€‚å¦‚æœä½ ç¼–å†™çš„ç±»çš„å®‰å…¨æ€§ä¾èµ–äºæ¥è‡ªä¸å—ä¿¡ä»»å®¢æˆ·ç«¯çš„ BigInteger æˆ– BigDecimal å‚æ•°çš„ä¸å¯å˜æ€§ï¼Œé‚£ä¹ˆä½ å¿…é¡»æ£€æŸ¥è¯¥å‚æ•°æ˜¯å¦æ˜¯ã€ŒçœŸæ­£çš„ã€BigInteger æˆ– BigDecimalï¼Œè€Œä¸æ˜¯ä¸å—ä¿¡ä»»çš„å­ç±»å®ä¾‹ã€‚å¦‚æœæ˜¯åè€…ï¼Œä½ å¿…é¡»é˜²å¾¡æ€§çš„å¤åˆ¶å®ƒï¼Œå‡è®¾å®ƒå¯èƒ½æ˜¯å¯å˜çš„:\npublic static BigInteger safeInstance(BigInteger val) { return val.getClass() == BigInteger.class ? val : new BigInteger(val.toByteArray()); } è¿™ä¸ªæ¡ç›®å¼€å¤´çš„ä¸å¯å˜ç±»çš„è§„åˆ™åˆ—è¡¨æŒ‡å‡ºï¼Œæ²¡æœ‰æ–¹æ³•å¯ä»¥ä¿®æ”¹å¯¹è±¡ï¼Œå®ƒçš„æ‰€æœ‰å­—æ®µå¿…é¡»æ˜¯ final çš„ã€‚å®é™…ä¸Šï¼Œè¿™äº›è§„åˆ™è¿‡äºä¸¥æ ¼ï¼Œå¯ä»¥é€‚å½“æ”¾æ¾æ¥æé«˜æ€§èƒ½ã€‚å®é™…ä¸Šï¼Œä»»ä½•æ–¹æ³•éƒ½ä¸èƒ½åœ¨å¯¹è±¡çš„çŠ¶æ€ä¸­äº§ç”Ÿå¤–éƒ¨å¯è§çš„æ›´æ”¹ã€‚ç„¶è€Œï¼Œä¸€äº›ä¸å¯å˜ç±»æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªé final å­—æ®µï¼Œå®ƒä»¬åœ¨ç¬¬ä¸€æ¬¡éœ€è¦è¿™äº›å­—æ®µæ—¶ï¼Œå°±ä¼šåœ¨å…¶ä¸­ç¼“å­˜æ˜‚è´µè®¡ç®—çš„ç»“æœã€‚å¦‚æœå†æ¬¡è¯·æ±‚ç›¸åŒçš„å€¼ï¼Œåˆ™è¿”å›ç¼“å­˜çš„å€¼ï¼Œä»è€ŒèŠ‚çœäº†é‡æ–°è®¡ç®—çš„æˆæœ¬ã€‚è¿™ä¸ªæŠ€å·§ä¹‹æ‰€ä»¥æœ‰æ•ˆï¼Œæ˜¯å› ä¸ºå¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œè¿™å°±ä¿è¯äº†é‡å¤è®¡ç®—ä¼šäº§ç”Ÿç›¸åŒçš„ç»“æœã€‚\nä¾‹å¦‚ï¼ŒPhoneNumber çš„ hashCode æ–¹æ³•åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶è®¡ç®—å“ˆå¸Œä»£ç ï¼Œå¹¶ç¼“å­˜å®ƒï¼Œä»¥å¤‡å†æ¬¡è°ƒç”¨ã€‚è¿™ä¸ªæŠ€æœ¯æ˜¯ä¸€ä¸ªå»¶è¿Ÿåˆå§‹åŒ–çš„ä¾‹å­ï¼ŒString ä¹Ÿä½¿ç”¨è¿™ä¸ªæŠ€æœ¯ã€‚\nå…³äºå¯åºåˆ—åŒ–æ€§ï¼Œåº”è¯¥æå‡ºä¸€ä¸ªè­¦å‘Šã€‚å¦‚æœä½ é€‰æ‹©è®©ä¸å¯å˜ç±»å®ç° Serializableï¼Œå¹¶ä¸”è¯¥ç±»åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå¼•ç”¨å¯å˜å¯¹è±¡çš„å­—æ®µï¼Œé‚£ä¹ˆä½ å¿…é¡»æä¾›ä¸€ä¸ªæ˜¾å¼çš„ readObject æˆ– readResolve æ–¹æ³•ï¼Œæˆ–è€…ä½¿ç”¨ ObjectOutputStream.writeUnshared æˆ– ObjectInputStream.readUnshared æ–¹æ³•ï¼Œå³ä½¿é»˜è®¤çš„åºåˆ—åŒ–å½¢å¼æ˜¯å¯ä»¥æ¥å—çš„ã€‚å¦åˆ™æ”»å‡»è€…å¯èƒ½åˆ›å»ºç±»çš„å¯å˜å®ä¾‹ã€‚\næ€»è€Œè¨€ä¹‹ï¼Œä¸è¦æ€¥äºä¸ºæ¯ä¸ª getter éƒ½ç¼–å†™ setterã€‚ç±»åº”è¯¥æ˜¯ä¸å¯å˜çš„ï¼Œé™¤éæœ‰å¾ˆå¥½çš„ç†ç”±è®©å®ƒä»¬å¯å˜ã€‚ ä¸å¯å˜ç±»æä¾›äº†è®¸å¤šä¼˜ç‚¹ï¼Œå®ƒä»¬å”¯ä¸€çš„ç¼ºç‚¹æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½å‡ºç°æ€§èƒ½é—®é¢˜ã€‚ä½ åº”è¯¥å§‹ç»ˆä½¿å°çš„å€¼å¯¹è±¡ï¼ˆå¦‚ PhoneNumber å’Œ Complexï¼‰æˆä¸ºä¸å¯å˜çš„ã€‚ï¼ˆJava åº“ä¸­æœ‰å‡ ä¸ªç±»ï¼Œæ¯”å¦‚ java.util.Date å’Œ java.awt.Pointï¼Œåº”è¯¥æ˜¯ä¸å¯æ”¹å˜çš„ï¼Œä½†äº‹å®å¹¶éå¦‚æ­¤ã€‚ï¼‰ä¹Ÿåº”è¯¥è®¤çœŸè€ƒè™‘å°†è¾ƒå¤§çš„å€¼å¯¹è±¡ï¼ˆå¦‚ String å’Œ BigIntegerï¼‰è®¾ç½®ä¸ºä¸å¯å˜çš„ã€‚åªæœ‰ç¡®è®¤äº†å®ç°ä»¤äººæ»¡æ„çš„æ€§èƒ½æ˜¯å¿…è¦çš„ï¼Œæ‰åº”è¯¥ä¸ºä¸å¯å˜ç±»æä¾›ä¸€ä¸ªå…¬å…±å¯å˜ä¼´éšç±»ã€‚\nå¯¹äºæŸäº›ç±»æ¥è¯´ï¼Œä¸å˜æ€§æ˜¯ä¸åˆ‡å®é™…çš„ã€‚å¦‚æœä¸€ä¸ªç±»ä¸èƒ½æˆä¸ºä¸å¯å˜çš„ï¼Œé‚£ä¹ˆå°±å°½å¯èƒ½åœ°é™åˆ¶å®ƒçš„å¯å˜æ€§ã€‚ å‡å°‘å¯¹è±¡å¯èƒ½å­˜åœ¨çš„çŠ¶æ€æ•°å¯ä»¥æ›´å®¹æ˜“åœ° reason about the object å¹¶å‡å°‘å‡ºé”™çš„å¯èƒ½æ€§ã€‚å› æ­¤ï¼Œé™¤éæœ‰ä»¤äººä¿¡æœçš„ç†ç”±ï¼Œå¦åˆ™æ¯ä¸ªå­—æ®µéƒ½åº”è¯¥ç”¨ final ä¿®é¥°ã€‚å°†æœ¬æ¡ç›®çš„å»ºè®®ä¸ Item-15 çš„å»ºè®®ç»“åˆèµ·æ¥ï¼Œä½ è‡ªç„¶ä¼šå€¾å‘äº å£°æ˜æ¯ä¸ªå­—æ®µä¸ºç§æœ‰ finalï¼Œé™¤éæœ‰å¾ˆå¥½çš„ç†ç”±ä¸è¿™æ ·åšã€‚\næ„é€ å‡½æ•°åº”è¯¥åˆ›å»ºå®Œå…¨åˆå§‹åŒ–çš„å¯¹è±¡ï¼Œå¹¶å»ºç«‹æ‰€æœ‰çš„ä¸å˜é‡ã€‚ é™¤éæœ‰å……åˆ†çš„ç†ç”±ï¼Œå¦åˆ™ä¸è¦æä¾›ä¸æ„é€ å‡½æ•°æˆ–é™æ€å·¥å‚åˆ†ç¦»çš„å…¬å…±åˆå§‹åŒ–æ–¹æ³•ã€‚ç±»ä¼¼åœ°ï¼Œä¸è¦æä¾›ã€Œé‡æ–°åˆå§‹åŒ–ã€çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å…è®¸å¤ç”¨å¯¹è±¡ï¼Œå°±å¥½åƒå®ƒæ˜¯ç”¨ä¸åŒçš„åˆå§‹çŠ¶æ€æ„é€ çš„ä¸€æ ·ã€‚è¿™äº›æ–¹æ³•é€šå¸¸åªæä¾›å¾ˆå°‘çš„æ€§èƒ½æ”¶ç›Šï¼Œè€Œä»£ä»·æ˜¯å¢åŠ äº†å¤æ‚æ€§ã€‚\nCountDownLatch ç±»ä½“ç°äº†è¿™äº›åŸåˆ™ã€‚å®ƒæ˜¯å¯å˜çš„ï¼Œä½†æ˜¯å®ƒçš„çŠ¶æ€ç©ºé—´æ•…æ„ä¿æŒå¾ˆå°ã€‚åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œä½¿ç”¨å®ƒä¸€æ¬¡ï¼Œå®ƒå°±å®Œæˆäº†ä½¿å‘½ï¼šä¸€æ—¦å€’è®¡æ—¶é”å­˜å™¨çš„è®¡æ•°è¾¾åˆ°é›¶ï¼Œä½ å¯èƒ½ä¸ä¼šå¤ç”¨å®ƒã€‚\nå…³äºæœ¬æ¡ç›®ä¸­ Complex ç±»çš„æœ€åä¸€ç‚¹éœ€è¦è¡¥å……çš„è¯´æ˜ã€‚è¿™ä¸ªä¾‹å­åªæ˜¯ä¸ºäº†è¯´æ˜ä¸å˜æ€§ã€‚å®ƒä¸æ˜¯ä¸€ä¸ªå·¥ä¸šçº§å¼ºåº¦çš„å¤æ•°å®ç°ã€‚å®ƒä½¿ç”¨äº†å¤æ‚ä¹˜æ³•å’Œé™¤æ³•çš„æ ‡å‡†å…¬å¼ï¼Œè¿™äº›å…¬å¼æ²¡æœ‰è¢«æ­£ç¡®åœ°å››èˆäº”å…¥ï¼Œå¹¶ä¸”ä¸ºå¤æ‚çš„ NaNs å’Œ infinities æä¾›äº†ç³Ÿç³•çš„è¯­ä¹‰ã€‚\næ‰©å±• å¸¸è§çš„æ–¹æ³•æ¥å‡å°‘å¯å˜æ€§ å‡å°‘å¯å˜æ€§æ˜¯ä¸€ç§é‡è¦çš„ç¼–ç¨‹åŸåˆ™ï¼Œå®ƒæ—¨åœ¨å‡å°‘ä»£ç ä¸­å¯å˜çŠ¶æ€çš„æ•°é‡ï¼Œä»¥æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§ã€å¯æµ‹è¯•æ€§å’Œå¹¶å‘å®‰å…¨æ€§ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„æ–¹æ³•æ¥å‡å°‘å¯å˜æ€§ï¼š\nä½¿ç”¨ä¸å¯å˜ç±»ï¼šä¸å¯å˜ç±»æ˜¯æŒ‡å…¶å®ä¾‹åœ¨åˆ›å»ºåä¸èƒ½è¢«ä¿®æ”¹çš„ç±»ã€‚ä¸å¯å˜ç±»çš„å­—æ®µéƒ½æ˜¯ final çš„ï¼Œå¹¶ä¸”ç±»ä¸­æ²¡æœ‰æä¾›ä¿®æ”¹å­—æ®µçš„æ–¹æ³•ï¼ˆsetterï¼‰ã€‚é€šè¿‡ä½¿ç”¨ä¸å¯å˜ç±»ï¼Œå¯ä»¥ç¡®ä¿å¯¹è±¡çš„çŠ¶æ€ä¸ä¼šè¢«æ„å¤–åœ°ä¿®æ”¹ï¼Œä»è€Œå‡å°‘æ½œåœ¨çš„é”™è¯¯å’Œå¹¶å‘é—®é¢˜ã€‚ å°è£…å¯å˜çŠ¶æ€ï¼šå¦‚æœæŸä¸ªç±»å¿…é¡»å…·æœ‰å¯å˜çŠ¶æ€ï¼Œå»ºè®®å°†å¯å˜çŠ¶æ€å°è£…åœ¨ç±»å†…éƒ¨ï¼Œå¹¶é€šè¿‡è®¿é—®å™¨æ–¹æ³•ï¼ˆgetter å’Œ setterï¼‰æ¥æ§åˆ¶å¯¹çŠ¶æ€çš„è®¿é—®å’Œä¿®æ”¹ã€‚è¿™æ ·å¯ä»¥é™åˆ¶å¯¹çŠ¶æ€çš„ç›´æ¥è®¿é—®ï¼Œæä¾›æ›´å¥½çš„å°è£…å’Œæ§åˆ¶æœºåˆ¶ã€‚ é¿å…å…±äº«å¯å˜å¯¹è±¡ï¼šåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå…±äº«å¯å˜å¯¹è±¡å¯èƒ½å¯¼è‡´å¹¶å‘é—®é¢˜ã€‚ä¸ºäº†å‡å°‘å¯å˜æ€§ï¼Œå¯ä»¥é¿å…å…±äº«å¯å˜å¯¹è±¡ï¼Œæˆ–è€…ç¡®ä¿åœ¨å…±äº«æ—¶è¿›è¡Œé€‚å½“çš„åŒæ­¥ã€‚å¦‚æœå¯èƒ½ï¼Œä½¿ç”¨ä¸å¯å˜å¯¹è±¡æˆ–çº¿ç¨‹å®‰å…¨çš„å¯¹è±¡æ¥ä»£æ›¿å¯å˜å¯¹è±¡ã€‚ ä½¿ç”¨ä¸å¯å˜é›†åˆï¼šJava æä¾›äº†è®¸å¤šä¸å¯å˜é›†åˆç±»ï¼Œå¦‚ Collections.unmodifiableList å’Œ Collections.unmodifiableMap ç­‰ã€‚é€šè¿‡ä½¿ç”¨è¿™äº›ä¸å¯å˜é›†åˆç±»ï¼Œå¯ä»¥ç¡®ä¿é›†åˆå†…å®¹ä¸ä¼šè¢«ä¿®æ”¹ï¼Œä»è€Œå‡å°‘å¯å˜æ€§ã€‚ ä½¿ç”¨å‡½æ•°å¼ç¼–ç¨‹é£æ ¼ï¼šå‡½æ•°å¼ç¼–ç¨‹é¼“åŠ±ä½¿ç”¨ä¸å¯å˜æ•°æ®å’Œæ— å‰¯ä½œç”¨çš„å‡½æ•°ã€‚é€šè¿‡ä½¿ç”¨çº¯å‡½æ•°ï¼ˆæ²¡æœ‰å‰¯ä½œç”¨ï¼Œå¹¶ä¸”å¯¹ç›¸åŒçš„è¾“å…¥å§‹ç»ˆäº§ç”Ÿç›¸åŒçš„è¾“å‡ºï¼‰ï¼Œå¯ä»¥å‡å°‘å¯å˜æ€§ï¼Œå¹¶æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„ä¸å¯å˜æ•°æ®ç»“æ„çš„ä¾‹å­ï¼š\nä¸å¯å˜åˆ—è¡¨ï¼ˆImmutable Listï¼‰ï¼šä¸å¯å˜åˆ—è¡¨æ˜¯æŒ‡ä¸€æ—¦åˆ›å»ºå°±ä¸èƒ½ä¿®æ”¹çš„åˆ—è¡¨ã€‚åœ¨ Java ä¸­ï¼Œå¯ä»¥ä½¿ç”¨java.util.Collections.unmodifiableList()æ–¹æ³•æ¥åˆ›å»ºä¸å¯å˜åˆ—è¡¨ã€‚\nList\u0026lt;String\u0026gt; immutableList = Collections.unmodifiableList(Arrays.asList(\u0026#34;apple\u0026#34;, \u0026#34;banana\u0026#34;, \u0026#34;cherry\u0026#34;)); ä¸Šè¿°ä»£ç åˆ›å»ºäº†ä¸€ä¸ªä¸å¯å˜åˆ—è¡¨ï¼Œæ— æ³•å¯¹å…¶è¿›è¡Œæ·»åŠ ã€åˆ é™¤æˆ–ä¿®æ”¹æ“ä½œã€‚\nä¸å¯å˜æ˜ å°„ï¼ˆImmutable Mapï¼‰ï¼šä¸å¯å˜æ˜ å°„æ˜¯æŒ‡ä¸€æ—¦åˆ›å»ºå°±ä¸èƒ½ä¿®æ”¹çš„æ˜ å°„å…³ç³»ã€‚åœ¨ Java ä¸­ï¼Œå¯ä»¥ä½¿ç”¨java.util.Collections.unmodifiableMap()æ–¹æ³•æ¥åˆ›å»ºä¸å¯å˜æ˜ å°„ã€‚\nMap\u0026lt;String, Integer\u0026gt; immutableMap = Collections.unmodifiableMap(Map.of(\u0026#34;apple\u0026#34;, 1, \u0026#34;banana\u0026#34;, 2, \u0026#34;cherry\u0026#34;, 3)); ä¸Šè¿°ä»£ç åˆ›å»ºäº†ä¸€ä¸ªä¸å¯å˜æ˜ å°„ï¼Œæ— æ³•å¯¹å…¶è¿›è¡Œæ·»åŠ ã€åˆ é™¤æˆ–ä¿®æ”¹æ“ä½œã€‚\nä¸å¯å˜é›†åˆï¼ˆImmutable Setï¼‰ï¼šä¸å¯å˜é›†åˆæ˜¯æŒ‡ä¸€æ—¦åˆ›å»ºå°±ä¸èƒ½ä¿®æ”¹çš„é›†åˆã€‚åœ¨ Java ä¸­ï¼Œå¯ä»¥ä½¿ç”¨java.util.Collections.unmodifiableSet()æ–¹æ³•æ¥åˆ›å»ºä¸å¯å˜é›†åˆã€‚\nSet\u0026lt;String\u0026gt; immutableSet = Collections.unmodifiableSet(Set.of(\u0026#34;apple\u0026#34;, \u0026#34;banana\u0026#34;, \u0026#34;cherry\u0026#34;)); â€‹ ä¸Šè¿°ä»£ç åˆ›å»ºäº†ä¸€ä¸ªä¸å¯å˜é›†åˆï¼Œæ— æ³•å¯¹å…¶è¿›è¡Œæ·»åŠ ã€åˆ é™¤æˆ–ä¿®æ”¹æ“ä½œã€‚\nä¸å¯å˜æ•°æ®ç»“æ„çš„ç‰¹ç‚¹æ˜¯å®ƒä»¬åœ¨åˆ›å»ºåä¸èƒ½è¢«ä¿®æ”¹ï¼Œè¿™æ„å‘³ç€å®ƒä»¬å…·æœ‰å›ºå®šçš„çŠ¶æ€ã€‚å¦‚æœéœ€è¦ä¿®æ”¹æ•°æ®ç»“æ„ï¼Œå¿…é¡»åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸å¯å˜å®ä¾‹ã€‚è¿™ç§ä¸å¯å˜æ€§ä½¿å¾—æ•°æ®ç»“æ„æ›´å®‰å…¨ã€çº¿ç¨‹å®‰å…¨ï¼Œå¹¶ä¸”å¯ä»¥æœ‰æ•ˆåœ°ç”¨äºå¹¶å‘ç¯å¢ƒã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶ä¸å¯å˜æ•°æ®ç»“æ„æœ¬èº«æ˜¯ä¸å¯å˜çš„ï¼Œä½†å…¶ä¸­çš„å…ƒç´ å¯¹è±¡å¯èƒ½æ˜¯å¯å˜çš„ã€‚å¦‚æœéœ€è¦ç¡®ä¿å…ƒç´ å¯¹è±¡ä¹Ÿæ˜¯ä¸å¯å˜çš„ï¼Œåˆ™éœ€è¦é‡‡å–ç›¸åº”çš„æªæ–½æ¥ä¿è¯å…ƒç´ å¯¹è±¡çš„ä¸å¯å˜æ€§ã€‚\nä¸‹é¢æ˜¯ä¸€äº›ä½¿ç”¨å‡½æ•°å¼ç¼–ç¨‹é£æ ¼å‡å°‘å¯å˜æ€§çš„ç¤ºä¾‹ï¼š\nä½¿ç”¨ä¸å¯å˜æ•°æ®ç»“æ„ï¼šå‡½æ•°å¼ç¼–ç¨‹é¼“åŠ±ä½¿ç”¨ä¸å¯å˜çš„æ•°æ®ç»“æ„ï¼Œå¦‚ä¸å¯å˜åˆ—è¡¨ã€ä¸å¯å˜æ˜ å°„ç­‰ã€‚è¿™äº›æ•°æ®ç»“æ„åœ¨åˆ›å»ºåä¸èƒ½è¢«ä¿®æ”¹ï¼Œè€Œæ˜¯é€šè¿‡åˆ›å»ºæ–°çš„ä¸å¯å˜å®ä¾‹æ¥è¡¨ç¤ºä¿®æ”¹åçš„çŠ¶æ€ã€‚ä¾‹å¦‚ï¼ŒJava 8 å¼•å…¥çš„java.util.stream.Streamä¸­çš„æ“ä½œè¿”å›çš„æ˜¯ä¸å¯å˜æµï¼Œå®ƒä»¬æ— æ³•ä¿®æ”¹åŸå§‹æµï¼Œè€Œæ˜¯ç”Ÿæˆä¸€ä¸ªæ–°çš„æµã€‚\nList\u0026lt;Integer\u0026gt; numbers = Arrays.asList(1, 2, 3, 4, 5); List\u0026lt;Integer\u0026gt; doubledNumbers = numbers.stream() .map(n -\u0026gt; n * 2) .collect(Collectors.toList()); System.out.println(doubledNumbers); // è¾“å‡º: [2, 4, 6, 8, 10] åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œé€šè¿‡ä½¿ç”¨mapæ“ä½œåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„æµæ¥è¡¨ç¤ºæ¯ä¸ªå…ƒç´ ç¿»å€åçš„çŠ¶æ€ï¼Œè€ŒåŸå§‹çš„numbersåˆ—è¡¨ä¿æŒä¸å˜ã€‚\né¿å…å‰¯ä½œç”¨ï¼šå‡½æ•°å¼ç¼–ç¨‹é¼“åŠ±ä½¿ç”¨æ— å‰¯ä½œç”¨çš„å‡½æ•°ï¼Œå³å‡½æ•°çš„æ‰§è¡Œä¸ä¼šå¯¹å¤–éƒ¨çŠ¶æ€äº§ç”Ÿå½±å“ã€‚è¿™æ„å‘³ç€å‡½æ•°ä¸åº”è¯¥ä¿®æ”¹ä¼ å…¥çš„å‚æ•°æˆ–ä»»ä½•å¤–éƒ¨çŠ¶æ€ã€‚ç›¸åï¼Œå‡½æ•°åº”è¯¥è¿”å›è®¡ç®—ç»“æœï¼Œå¹¶ä¸”å¯¹äºç›¸åŒçš„è¾“å…¥åº”è¯¥å§‹ç»ˆè¿”å›ç›¸åŒçš„è¾“å‡ºã€‚\n// æœ‰å‰¯ä½œç”¨çš„ç¤ºä¾‹ int counter = 0; void incrementCounter() { counter++; } // æ— å‰¯ä½œç”¨çš„ç¤ºä¾‹ int increment(int value) { return value + 1; } â€‹ åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒincrementCounterå‡½æ•°å¯¹å¤–éƒ¨çŠ¶æ€è¿›è¡Œäº†ä¿®æ”¹ï¼ˆå‰¯ä½œç”¨ï¼‰ï¼Œè€Œincrementå‡½æ•°åˆ™è¿”å›äº†æ–°çš„è®¡ç®—ç»“æœï¼Œè€Œä¸æ”¹å˜ä¼ å…¥çš„å‚æ•°æˆ–ä»»ä½•å¤–éƒ¨çŠ¶æ€ã€‚\né€šè¿‡ä½¿ç”¨ä¸å¯å˜æ•°æ®ç»“æ„å’Œé¿å…å‰¯ä½œç”¨ï¼Œå‡½æ•°å¼ç¼–ç¨‹é£æ ¼å¯ä»¥å‡å°‘å¯å˜æ€§ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯æµ‹è¯•æ€§å’Œå¹¶å‘å®‰å…¨æ€§ã€‚åŒæ—¶ï¼Œè¿™ç§é£æ ¼è¿˜å¯ä»¥ä½¿ä»£ç æ›´æ˜“äºæ¨ç†å’Œè°ƒè¯•ï¼Œå¹¶å‡å°‘æ½œåœ¨çš„é”™è¯¯å’Œ bugã€‚\nå¦‚ä½•ç¡®ä¿ä¸å¯å˜æ•°æ®ç»“æ„ä¸­çš„å…ƒç´ å¯¹è±¡ä¹Ÿæ˜¯ä¸å¯å˜çš„ï¼Ÿ ç¡®ä¿ä¸å¯å˜æ•°æ®ç»“æ„ä¸­çš„å…ƒç´ å¯¹è±¡ä¹Ÿæ˜¯ä¸å¯å˜çš„ï¼Œå¯ä»¥éµå¾ªä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š\nä½¿ç”¨ä¸å¯å˜å¯¹è±¡ï¼šå°½å¯èƒ½ä½¿ç”¨ä¸å¯å˜å¯¹è±¡ä½œä¸ºå…ƒç´ å¯¹è±¡ã€‚ä¸å¯å˜å¯¹è±¡æ˜¯æŒ‡å…¶çŠ¶æ€åœ¨åˆ›å»ºåä¸èƒ½è¢«ä¿®æ”¹çš„å¯¹è±¡ã€‚å¦‚æœä½¿ç”¨ç°æœ‰çš„ä¸å¯å˜ç±»ï¼ˆå¦‚Stringå’ŒIntegerï¼‰ï¼Œåˆ™æ— éœ€é¢å¤–çš„æ­¥éª¤ï¼Œå› ä¸ºå®ƒä»¬æœ¬èº«å°±æ˜¯ä¸å¯å˜çš„ã€‚\nä½¿ç”¨æ·±åº¦ä¸å¯å˜æ€§ï¼šå¦‚æœå…ƒç´ å¯¹è±¡æ˜¯å¯å˜çš„ï¼Œå¹¶ä¸”éœ€è¦ç¡®ä¿å®ƒä»¬ä¸ä¼šè¢«ä¿®æ”¹ï¼Œå¯ä»¥é‡‡ç”¨æ·±åº¦ä¸å¯å˜æ€§çš„æ–¹æ³•ã€‚è¿™æ„å‘³ç€åœ¨åˆ›å»ºä¸å¯å˜æ•°æ®ç»“æ„æ—¶ï¼Œå¯¹äºæ¯ä¸ªå¯å˜å…ƒç´ å¯¹è±¡ï¼Œéƒ½è¦è¿›è¡Œå…‹éš†æˆ–åˆ›å»ºæ–°çš„ä¸å¯å˜å®ä¾‹ï¼Œè€Œä¸æ˜¯ç›´æ¥å¼•ç”¨å¯å˜å¯¹è±¡ã€‚\n// ä»¥ä¸å¯å˜å¯¹è±¡ä½œä¸ºå…ƒç´  List\u0026lt;String\u0026gt; immutableList = List.of(\u0026#34;apple\u0026#34;, \u0026#34;banana\u0026#34;, \u0026#34;cherry\u0026#34;); // ä½¿ç”¨æ·±åº¦ä¸å¯å˜æ€§ List\u0026lt;Person\u0026gt; immutablePersonList = List.of( new Person(\u0026#34;John\u0026#34;, 25), new Person(\u0026#34;Alice\u0026#34;, 30), new Person(\u0026#34;Bob\u0026#34;, 35) ); // Personç±»éœ€è¦æ˜¯ä¸å¯å˜çš„ class Person { private final String name; private final int age; public Person(String name, int age) { this.name = name; this.age = age; } // åªæä¾›getteræ–¹æ³•ï¼Œæ²¡æœ‰setteræ–¹æ³• public String getName() { return name; } public int getAge() { return age; } } ``` åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œ`Person`ç±»æ˜¯ä¸å¯å˜çš„ï¼Œå®ƒæ²¡æœ‰æä¾›ä¿®æ”¹å±æ€§çš„æ–¹æ³•ï¼ˆsetterï¼‰ã€‚é€šè¿‡åˆ›å»ºæ–°çš„`Person`å®ä¾‹ï¼Œå¹¶å°†å…¶ä½œä¸ºä¸å¯å˜åˆ—è¡¨çš„å…ƒç´ ï¼Œç¡®ä¿äº†å…ƒç´ å¯¹è±¡çš„ä¸å¯å˜æ€§ã€‚ é˜²å¾¡æ€§å¤åˆ¶ï¼šå¦‚æœä¸å¯å˜æ•°æ®ç»“æ„ä¸­çš„å…ƒç´ å¯¹è±¡æ˜¯å¯å˜çš„ï¼Œå¹¶ä¸”ä¸å¸Œæœ›å®ƒä»¬è¢«å¤–éƒ¨ä¿®æ”¹ï¼Œå¯ä»¥åœ¨è®¿é—®å™¨æ–¹æ³•ä¸­è¿”å›å…ƒç´ å¯¹è±¡çš„é˜²å¾¡æ€§å¤åˆ¶ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„å‰¯æœ¬ï¼Œè€Œä¸æ˜¯ç›´æ¥è¿”å›åŸå§‹å¯¹è±¡çš„å¼•ç”¨ã€‚\nclass ImmutableDataStructure { private final List\u0026lt;Person\u0026gt; persons; public ImmutableDataStructure(List\u0026lt;Person\u0026gt; persons) { this.persons = new ArrayList\u0026lt;\u0026gt;(persons); // é˜²å¾¡æ€§å¤åˆ¶ } public List\u0026lt;Person\u0026gt; getPersons() { return new ArrayList\u0026lt;\u0026gt;(persons); // é˜²å¾¡æ€§å¤åˆ¶ } } â€‹ åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼ŒImmutableDataStructureç±»åŒ…å«ä¸€ä¸ªpersonsåˆ—è¡¨ï¼Œé€šè¿‡åœ¨æ„é€ å‡½æ•°å’Œè®¿é—®å™¨æ–¹æ³•ä¸­è¿›è¡Œé˜²å¾¡æ€§å¤åˆ¶ï¼Œè¿”å›äº†ä¸€ä¸ªæ–°çš„åˆ—è¡¨å‰¯æœ¬ï¼Œä»è€Œä¿æŠ¤äº†å…ƒç´ å¯¹è±¡çš„ä¸å¯å˜æ€§ã€‚\né€šè¿‡éµå¾ªè¿™äº›æ­¥éª¤ï¼Œå¯ä»¥ç¡®ä¿ä¸å¯å˜æ•°æ®ç»“æ„ä¸­çš„å…ƒç´ å¯¹è±¡ä¹Ÿæ˜¯ä¸å¯å˜çš„ã€‚è¿™æœ‰åŠ©äºä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ã€çº¿ç¨‹å®‰å…¨æ€§ï¼Œå¹¶æä¾›æ›´å¥½çš„å°è£…æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/08/14/minimize-mutability/","summary":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬å››ç« ã€Šç±»å’Œæ¥å£ã€‹çš„å­¦ä¹ ç¬”è®°ï¼šå‡å°‘å¯å˜æ€§ã€‚\nåŸæ–‡ ä¸å¯å˜ç±»æ˜¯å®ä¾‹ä¸èƒ½è¢«ä¿®æ”¹çš„ç±»ã€‚æ¯ä¸ªå®ä¾‹ä¸­åŒ…å«çš„æ‰€æœ‰ä¿¡æ¯åœ¨å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå†…éƒ½æ˜¯å›ºå®šçš„ï¼Œå› æ­¤æ°¸è¿œä¸ä¼šè§‚å¯Ÿåˆ°ä»»ä½•æ›´æ”¹ã€‚Java åº“åŒ…å«è®¸å¤šä¸å¯å˜çš„ç±»ï¼ŒåŒ…æ‹¬ Stringã€åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»ã€BigInteger å’Œ BigDecimalã€‚è¿™ä¹ˆåšæœ‰å¾ˆå¥½çš„ç†ç”±ï¼šä¸å¯å˜ç±»æ¯”å¯å˜ç±»æ›´å®¹æ˜“è®¾è®¡ã€å®ç°å’Œä½¿ç”¨ã€‚å®ƒä»¬ä¸å¤ªå®¹æ˜“å‡ºé”™ï¼Œè€Œä¸”æ›´å®‰å…¨ã€‚\nè¦ä½¿ç±»ä¸å¯å˜ï¼Œè¯·éµå¾ªä»¥ä¸‹ 5 æ¡è§„åˆ™ï¼š\n1ã€ä¸è¦æä¾›ä¿®æ”¹å¯¹è±¡çŠ¶æ€çš„æ–¹æ³•ï¼ˆè¿™ç±»æ–¹æ³•ä¹Ÿè¢«ç§°ä¸ºä¿®æ”¹å™¨ï¼‰\n2ã€ç¡®ä¿ç±»ä¸èƒ½è¢«ç»§æ‰¿ã€‚ è¿™å¯ä»¥é˜²æ­¢ç²—å¿ƒæˆ–æ¶æ„çš„é€šè¿‡å­ç±»å®ä¾‹å¯¹è±¡çŠ¶æ€å¯æ”¹å˜çš„æ–¹å¼ï¼ŒæŸå®³çˆ¶ç±»çš„ä¸å¯å˜è¡Œä¸ºã€‚é˜²æ­¢å­ç±»åŒ–é€šå¸¸ç”¨ final ä¿®é¥°çˆ¶ç±»ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ç§æ›¿ä»£æ–¹æ³•ï¼Œæˆ‘ä»¬å°†åœ¨åé¢è®¨è®ºã€‚\n3ã€æ‰€æœ‰å­—æ®µç”¨ final ä¿®é¥°ã€‚ è¿™æ¸…æ¥šåœ°è¡¨è¾¾äº†æ„å›¾ï¼Œå¹¶ç”±ç³»ç»Ÿå¼ºåˆ¶æ‰§è¡Œã€‚åŒæ ·ï¼Œå¦‚æœåœ¨æ²¡æœ‰åŒæ­¥çš„æƒ…å†µä¸‹ï¼Œå¼•ç”¨æ–°åˆ›å»ºçš„å®ä¾‹å¹¶ä»ä¸€ä¸ªçº¿ç¨‹ä¼ é€’åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆå°±æœ‰å¿…è¦ç¡®ä¿æ­£ç¡®çš„è¡Œä¸ºï¼Œå°±åƒå†…å­˜æ¨¡å‹ä¸­æè¿°çš„é‚£æ ·ã€‚\n4ã€æ‰€æœ‰å­—æ®µè®¾ä¸ºç§æœ‰ã€‚ è¿™å°†é˜»æ­¢å®¢æˆ·ç«¯è®¿é—®å­—æ®µå¼•ç”¨çš„å¯å˜å¯¹è±¡å¹¶ç›´æ¥ä¿®æ”¹è¿™äº›å¯¹è±¡ã€‚è™½ç„¶åœ¨æŠ€æœ¯ä¸Šå…è®¸ä¸å¯å˜ç±»æ‹¥æœ‰åŒ…å«åŸºæœ¬ç±»å‹æˆ–å¯¹ä¸å¯å˜å¯¹è±¡çš„å¼•ç”¨çš„å…¬å…± final å­—æ®µï¼Œä½†ä¸å»ºè®®è¿™æ ·åšï¼Œå› ä¸ºåœ¨ä»¥åçš„ç‰ˆæœ¬ä¸­æ— æ³•æ›´æ”¹å†…éƒ¨è¡¨ç¤ºã€‚\n5ã€ç¡®ä¿å¯¹ä»»ä½•å¯å˜ç»„ä»¶çš„ç‹¬å è®¿é—®ã€‚ å¦‚æœä½ çš„ç±»æœ‰ä»»ä½•å¼•ç”¨å¯å˜å¯¹è±¡çš„å­—æ®µï¼Œè¯·ç¡®ä¿è¯¥ç±»çš„å®¢æˆ·ç«¯æ— æ³•è·å¾—å¯¹è¿™äº›å¯¹è±¡çš„å¼•ç”¨ã€‚æ°¸è¿œä¸è¦å‘æä¾›å¯¹è±¡å¼•ç”¨çš„å®¢æˆ·ç«¯åˆå§‹åŒ–è¿™æ ·çš„å­—æ®µï¼Œä¹Ÿä¸è¦ä»è®¿é—®å™¨è¿”å›å­—æ®µã€‚åœ¨æ„é€ å‡½æ•°ã€è®¿é—®å™¨å’Œ readObject æ–¹æ³•ä¸­åˆ›å»ºé˜²å¾¡æ€§å‰¯æœ¬ã€‚\nå‰é¢æ¡ç›®ä¸­çš„è®¸å¤šç¤ºä¾‹ç±»éƒ½æ˜¯ä¸å¯å˜çš„ã€‚å…¶ä¸­ä¸€ä¸ªç±»æ˜¯ PhoneNumberï¼Œå®ƒçš„æ¯ä¸ªå±æ€§éƒ½æœ‰è®¿é—®å™¨ï¼Œä½†æ²¡æœ‰å¯¹åº”çš„ä¿®æ”¹å™¨ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¨å¾®å¤æ‚çš„ä¾‹å­ï¼š\n// Immutable complex number class public final class Complex { private final double re; private final double im; public Complex(double re, double im) { this.re = re; this.im = im; } public double realPart() { return re; } public double imaginaryPart() { return im; } public Complex plus(Complex c) { return new Complex(re + c.re, im + c.im); } public Complex minus(Complex c) { return new Complex(re - c.","title":"ã€ŠEffective Java 3ã€‹ç¬”è®°17ï¼šå‡å°‘å¯å˜æ€§"},{"content":"æœ¬æ–‡ä¸»è¦ä»‹ç» Async Method Invocation æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nä»‹ç» Async Method Invocationï¼ˆå¼‚æ­¥æ–¹æ³•è°ƒç”¨ï¼‰æ˜¯ä¸€ç§ç¼–ç¨‹æ¨¡å¼ï¼Œç”¨äºå¤„ç†å¼‚æ­¥æ“ä½œå’Œå¹¶å‘æ‰§è¡Œã€‚å®ƒå…è®¸åœ¨æ‰§è¡ŒæŸä¸ªæ“ä½œæ—¶ä¸é˜»å¡ä¸»çº¿ç¨‹ï¼Œè€Œæ˜¯å°†æ“ä½œå§”æ‰˜ç»™å¦ä¸€ä¸ªçº¿ç¨‹æˆ–å¤„ç†ç¨‹åºï¼Œå¹¶åœ¨æ“ä½œå®Œæˆåè·å–ç»“æœæˆ–æ‰§è¡Œå›è°ƒã€‚\nå¼‚æ­¥æ–¹æ³•è°ƒç”¨çš„ä¸»è¦ç›®çš„æ˜¯æé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œå“åº”èƒ½åŠ›ã€‚é€šè¿‡å°†è€—æ—¶çš„æ“ä½œï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶è¯»å†™ã€æ•°æ®åº“æŸ¥è¯¢ç­‰ï¼‰ç½®äºåå°çº¿ç¨‹æˆ–å¼‚æ­¥ä»»åŠ¡ä¸­ï¼Œå¯ä»¥ä½¿ä¸»çº¿ç¨‹èƒ½å¤Ÿç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œè€Œä¸ä¼šè¢«é˜»å¡ã€‚\nå¼‚æ­¥æ–¹æ³•è°ƒç”¨å¯ä»¥åœ¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€å’Œæ¡†æ¶ä¸­ä»¥ä¸åŒçš„æ–¹å¼å®ç°ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å‡ ç§å¸¸è§çš„å½¢å¼ï¼š\nå›è°ƒå‡½æ•°ï¼ˆCallbackï¼‰ï¼šé€šè¿‡å®šä¹‰å›è°ƒå‡½æ•°ï¼Œå°†å¼‚æ­¥æ“ä½œçš„ç»“æœä¼ é€’ç»™è°ƒç”¨æ–¹ã€‚å½“å¼‚æ­¥æ“ä½œå®Œæˆæ—¶ï¼Œå›è°ƒå‡½æ•°ä¼šè¢«è°ƒç”¨å¹¶å¤„ç†ç»“æœã€‚ Future/Promiseï¼ˆFuture/Deferredï¼‰ï¼šé€šè¿‡ Future æˆ– Promise å¯¹è±¡è¡¨ç¤ºå¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œè°ƒç”¨æ–¹å¯ä»¥åœ¨éœ€è¦æ—¶è·å–ç»“æœæˆ–æ·»åŠ å›è°ƒå‡½æ•°æ¥å¤„ç†ç»“æœã€‚ å¼‚æ­¥/awaitï¼šå¼‚æ­¥/await æ˜¯ä¸€ç§è¯­æ³•ç³–ï¼Œç”¨äºç®€åŒ–å¼‚æ­¥ä»£ç çš„ç¼–å†™å’Œç†è§£ã€‚å®ƒå…è®¸ä»¥åŒæ­¥çš„æ–¹å¼ç¼–å†™å¼‚æ­¥æ“ä½œï¼Œä½¿ä»£ç æ›´å…·å¯è¯»æ€§ã€‚ è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserverï¼‰ï¼šé€šè¿‡å®šä¹‰è§‚å¯Ÿè€…å¯¹è±¡ï¼Œå¼‚æ­¥æ“ä½œçš„ç»“æœå¯ä»¥è¢«è§‚å¯Ÿè€…è®¢é˜…ã€‚å½“ç»“æœå¯ç”¨æ—¶ï¼Œè§‚å¯Ÿè€…ä¼šè¢«é€šçŸ¥å¹¶æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚ ä½¿ç”¨å¼‚æ­¥æ–¹æ³•è°ƒç”¨å¯ä»¥æé«˜åº”ç”¨ç¨‹åºçš„å¹¶å‘æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚å®ƒå¯ä»¥åœ¨åå°æ‰§è¡Œè€—æ—¶çš„æ“ä½œï¼Œä½¿ä¸»çº¿ç¨‹ä¿æŒå“åº”ï¼Œå¹¶å…è®¸åº”ç”¨ç¨‹åºåŒæ—¶å¤„ç†å¤šä¸ªå¹¶å‘è¯·æ±‚ã€‚ç„¶è€Œï¼Œå¯¹äºå¹¶å‘æ“ä½œçš„æ­£ç¡®å¤„ç†å’Œç®¡ç†èµ„æºçš„å®‰å…¨æ€§ä»ç„¶éœ€è¦ä»”ç»†è€ƒè™‘å’Œå®æ–½ã€‚\nä¸¾ä¾‹ AsyncResultï¼ˆç”¨äºå¼‚æ­¥è¯„ä¼°å€¼çš„ä¸­é—´å®¹å™¨ï¼‰ï¼ŒAsyncCallbackï¼ˆå¯ä»¥åœ¨ä»»åŠ¡å®Œæˆæ—¶è¢«æ‰§è¡Œï¼‰å’ŒAsyncExecutorï¼ˆç”¨äºç®¡ç†å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œï¼‰ã€‚\npublic interface AsyncResult\u0026lt;T\u0026gt; { boolean isCompleted(); T getValue() throws ExecutionException; void await() throws InterruptedException; } public interface AsyncCallback\u0026lt;T\u0026gt; { void onComplete(T value, Optional\u0026lt;Exception\u0026gt; ex); } public interface AsyncExecutor { \u0026lt;T\u0026gt; AsyncResult\u0026lt;T\u0026gt; startProcess(Callable\u0026lt;T\u0026gt; task); \u0026lt;T\u0026gt; AsyncResult\u0026lt;T\u0026gt; startProcess(Callable\u0026lt;T\u0026gt; task, AsyncCallback\u0026lt;T\u0026gt; callback); \u0026lt;T\u0026gt; T endProcess(AsyncResult\u0026lt;T\u0026gt; asyncResult) throws ExecutionException, InterruptedException; } ThreadAsyncExecutoræ˜¯AsyncExecutorçš„å®ç°ã€‚ æ¥ä¸‹æ¥å°†çªå‡ºæ˜¾ç¤ºå…¶ä¸€äº›å…³é”®éƒ¨åˆ†ã€‚\npublic class ThreadAsyncExecutor implements AsyncExecutor { @Override public \u0026lt;T\u0026gt; AsyncResult\u0026lt;T\u0026gt; startProcess(Callable\u0026lt;T\u0026gt; task) { return startProcess(task, null); } @Override public \u0026lt;T\u0026gt; AsyncResult\u0026lt;T\u0026gt; startProcess(Callable\u0026lt;T\u0026gt; task, AsyncCallback\u0026lt;T\u0026gt; callback) { var result = new CompletableResult\u0026lt;\u0026gt;(callback); new Thread( () -\u0026gt; { try { result.setValue(task.call()); } catch (Exception ex) { result.setException(ex); } }, \u0026#34;executor-\u0026#34; + idx.incrementAndGet()) .start(); return result; } @Override public \u0026lt;T\u0026gt; T endProcess(AsyncResult\u0026lt;T\u0026gt; asyncResult) throws ExecutionException, InterruptedException { if (!asyncResult.isCompleted()) { asyncResult.await(); } return asyncResult.getValue(); } } ç„¶åï¼Œçœ‹çœ‹ä¸€åˆ‡æ˜¯å¦‚ä½•ååŒå·¥ä½œçš„ã€‚\npublic static void main(String[] args) throws Exception { // æ„é€ ä¸€ä¸ªå°†æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡çš„æ–°æ‰§è¡Œç¨‹åº var executor = new ThreadAsyncExecutor(); // ä»¥ä¸åŒçš„å¤„ç†æ—¶é—´å¼€å§‹ä¸€äº›å¼‚æ­¥ä»»åŠ¡ï¼Œæœ€åä¸¤ä¸ªä½¿ç”¨å›è°ƒå¤„ç†ç¨‹åº final var asyncResult1 = executor.startProcess(lazyval(10, 500)); final var asyncResult2 = executor.startProcess(lazyval(\u0026#34;test\u0026#34;, 300)); final var asyncResult3 = executor.startProcess(lazyval(50L, 700)); final var asyncResult4 = executor.startProcess(lazyval(20, 400), callback(\u0026#34;Deploying lunar rover\u0026#34;)); final var asyncResult5 = executor.startProcess(lazyval(\u0026#34;callback\u0026#34;, 600), callback(\u0026#34;Deploying lunar rover\u0026#34;)); // åœ¨å½“å‰çº¿ç¨‹ä¸­æ¨¡æ‹Ÿå¼‚æ­¥ä»»åŠ¡æ­£åœ¨å®ƒä»¬è‡ªå·±çš„çº¿ç¨‹ä¸­æ‰§è¡Œ Thread.sleep(350); // å“¦ï¼Œå…„å¼Ÿï¼Œæˆ‘ä»¬åœ¨è¿™å¾ˆè¾›è‹¦ log(\u0026#34;Mission command is sipping coffee\u0026#34;); // ç­‰å¾…ä»»åŠ¡å®Œæˆ final var result1 = executor.endProcess(asyncResult1); final var result2 = executor.endProcess(asyncResult2); final var result3 = executor.endProcess(asyncResult3); asyncResult4.await(); asyncResult5.await(); // log the results of the tasks, callbacks log immediately when complete // è®°å½•ä»»åŠ¡ç»“æœçš„æ—¥å¿—ï¼Œ å›è°ƒçš„æ—¥å¿—ä¼šåœ¨å›è°ƒå®Œæˆæ—¶ç«‹åˆ»è®°å½• log(\u0026#34;Space rocket \u0026lt;\u0026#34; + result1 + \u0026#34;\u0026gt; launch complete\u0026#34;); log(\u0026#34;Space rocket \u0026lt;\u0026#34; + result2 + \u0026#34;\u0026gt; launch complete\u0026#34;); log(\u0026#34;Space rocket \u0026lt;\u0026#34; + result3 + \u0026#34;\u0026gt; launch complete\u0026#34;); } è¿™æ˜¯ç¨‹åºæ§åˆ¶å°çš„è¾“å‡ºã€‚\n21:47:08.227 [executor-2] INFO com.iluwatar.async.method.invocation.App - Space rocket \u0026lt;test\u0026gt; launched successfully 21:47:08.269 [main] INFO com.iluwatar.async.method.invocation.App - Mission command is sipping coffee 21:47:08.318 [executor-4] INFO com.iluwatar.async.method.invocation.App - Space rocket \u0026lt;20\u0026gt; launched successfully 21:47:08.335 [executor-4] INFO com.iluwatar.async.method.invocation.App - Deploying lunar rover \u0026lt;20\u0026gt; 21:47:08.414 [executor-1] INFO com.iluwatar.async.method.invocation.App - Space rocket \u0026lt;10\u0026gt; launched successfully 21:47:08.519 [executor-5] INFO com.iluwatar.async.method.invocation.App - Space rocket \u0026lt;callback\u0026gt; launched successfully 21:47:08.519 [executor-5] INFO com.iluwatar.async.method.invocation.App - Deploying lunar rover \u0026lt;callback\u0026gt; 21:47:08.616 [executor-3] INFO com.iluwatar.async.method.invocation.App - Space rocket \u0026lt;50\u0026gt; launched successfully 21:47:08.617 [main] INFO com.iluwatar.async.method.invocation.App - Space rocket \u0026lt;10\u0026gt; launch complete 21:47:08.617 [main] INFO com.iluwatar.async.method.invocation.App - Space rocket \u0026lt;test\u0026gt; launch complete 21:47:08.618 [main] INFO com.iluwatar.async.method.invocation.App - Space rocket \u0026lt;50\u0026gt; launch complete ç±»å›¾ æ³¨æ„äº‹é¡¹ çº¿ç¨‹å®‰å…¨æ€§å’Œç®¡ç†å¼‚æ­¥ä»»åŠ¡ åœ¨ä½¿ç”¨å¼‚æ­¥æ–¹æ³•è°ƒç”¨æ¨¡å¼æ—¶ï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨æ€§å’Œç®¡ç†å¼‚æ­¥ä»»åŠ¡æ˜¯éå¸¸é‡è¦çš„ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•å’ŒæŠ€æœ¯ï¼š\nçº¿ç¨‹å®‰å…¨æ€§ï¼š ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„æ•°æ®ç»“æ„ï¼šåœ¨å¼‚æ­¥æ–¹æ³•è°ƒç”¨ä¸­ï¼Œå¤šä¸ªçº¿ç¨‹å¯èƒ½åŒæ—¶è®¿é—®å’Œä¿®æ”¹å…±äº«çš„æ•°æ®ã€‚ä¸ºäº†ç¡®ä¿çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„æ•°æ®ç»“æ„ï¼Œå¦‚ConcurrentHashMapã€ConcurrentLinkedQueueç­‰ï¼Œæ¥ç®¡ç†å…±äº«æ•°æ®ã€‚ ä½¿ç”¨åŒæ­¥æœºåˆ¶ï¼šä½¿ç”¨åŒæ­¥æœºåˆ¶ï¼Œå¦‚synchronizedå…³é”®å­—æˆ–Lockæ¥å£ï¼Œæ¥ä¿æŠ¤å…±äº«èµ„æºçš„è®¿é—®ï¼Œä»¥é¿å…å¹¶å‘è®¿é—®å¯¼è‡´çš„æ•°æ®ç«äº‰å’Œä¸ä¸€è‡´æ€§ã€‚ é¿å…å…±äº«çŠ¶æ€ï¼šå°½å¯èƒ½é¿å…åœ¨å¼‚æ­¥ä»»åŠ¡ä¹‹é—´å…±äº«çŠ¶æ€ï¼Œè€Œæ˜¯é€šè¿‡å‚æ•°ä¼ é€’å’Œè¿”å›å€¼æ¥è¿›è¡Œæ•°æ®äº¤æ¢ã€‚è¿™å¯ä»¥å‡å°‘å¯¹å…±äº«èµ„æºçš„å¹¶å‘è®¿é—®ï¼Œä»è€Œç®€åŒ–çº¿ç¨‹å®‰å…¨æ€§çš„ç®¡ç†ã€‚ å¼‚æ­¥ä»»åŠ¡ç®¡ç†ï¼š ä½¿ç”¨çº¿ç¨‹æ± ï¼šä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥æœ‰æ•ˆåœ°ç®¡ç†å’Œè°ƒåº¦å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œã€‚çº¿ç¨‹æ± å¯ä»¥æ§åˆ¶å¹¶å‘çº¿ç¨‹çš„æ•°é‡ï¼Œé‡ç”¨çº¿ç¨‹ï¼Œé¿å…çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯çš„å¼€é”€ï¼Œå¹¶æä¾›ä»»åŠ¡é˜Ÿåˆ—æ¥ç¼“å†²å¾…æ‰§è¡Œçš„ä»»åŠ¡ã€‚ ä½¿ç”¨ Future å’Œ Promiseï¼šFuture å’Œ Promise æ˜¯ç”¨äºç®¡ç†å¼‚æ­¥ä»»åŠ¡çš„å¸¸ç”¨æ¦‚å¿µã€‚Future è¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡çš„ç»“æœï¼Œå¯ä»¥é€šè¿‡å®ƒæ¥è·å–ä»»åŠ¡çš„è¿”å›å€¼æˆ–ç­‰å¾…ä»»åŠ¡å®Œæˆã€‚Promise æ˜¯ Future çš„æ‰©å±•ï¼Œå®ƒå…è®¸è®¾ç½®å¼‚æ­¥ä»»åŠ¡çš„ç»“æœã€‚é€šè¿‡ä½¿ç”¨ Future å’Œ Promiseï¼Œå¯ä»¥æ›´æ–¹ä¾¿åœ°ç®¡ç†å¼‚æ­¥ä»»åŠ¡çš„çŠ¶æ€å’Œç»“æœã€‚ ä½¿ç”¨å›è°ƒå‡½æ•°ï¼šå›è°ƒå‡½æ•°æ˜¯å¼‚æ­¥æ–¹æ³•è°ƒç”¨ä¸­å¸¸ç”¨çš„ä¸€ç§æ–¹å¼ï¼Œç”¨äºåœ¨ä»»åŠ¡å®Œæˆæ—¶æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚é€šè¿‡å®šä¹‰å›è°ƒå‡½æ•°ï¼Œå¯ä»¥å°†ä»»åŠ¡çš„å¤„ç†é€»è¾‘ä¸ä»»åŠ¡æ‰§è¡Œçš„å¼‚æ­¥æ€§è§£è€¦ï¼Œä»è€Œæ›´çµæ´»åœ°å¤„ç†å¼‚æ­¥ä»»åŠ¡çš„ç»“æœã€‚ åŒæ—¶ï¼Œè¯·æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š\nåœ¨è®¾è®¡å’Œå®ç°å¼‚æ­¥æ–¹æ³•è°ƒç”¨æ—¶ï¼Œéœ€è¦ä»”ç»†è€ƒè™‘çº¿ç¨‹å®‰å…¨æ€§å’Œå¹¶å‘è®¿é—®çš„é—®é¢˜ï¼Œå¹¶è¿›è¡Œé€‚å½“çš„æµ‹è¯•å’ŒéªŒè¯ã€‚ æ ¹æ®å…·ä½“çš„åº”ç”¨åœºæ™¯å’Œéœ€æ±‚ï¼Œé€‰æ‹©é€‚åˆçš„çº¿ç¨‹å®‰å…¨æœºåˆ¶å’Œå¼‚æ­¥ä»»åŠ¡ç®¡ç†ç­–ç•¥ã€‚ åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨å¼‚æ­¥æ–¹æ³•è°ƒç”¨æ—¶ï¼Œè¦æ³¨æ„å¯èƒ½å‡ºç°çš„çº¿ç¨‹å®‰å…¨æ€§é—®é¢˜ï¼Œå¦‚æ•°æ®ç«äº‰ã€æ­»é”å’Œæ´»é”ç­‰ï¼Œå¹¶é‡‡å–ç›¸åº”çš„é¢„é˜²å’Œè§£å†³æªæ–½ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œçº¿ç¨‹å®‰å…¨æ€§å’Œå¼‚æ­¥ä»»åŠ¡ç®¡ç†æ˜¯ç¡®ä¿å¼‚æ­¥æ–¹æ³•è°ƒç”¨æ¨¡å¼æ­£ç¡®è¿è¡Œçš„å…³é”®å› ç´ ï¼Œéœ€è¦ä»”ç»†è®¾è®¡å’Œå®æ–½ç›¸åº”çš„ç­–ç•¥å’Œæœºåˆ¶ã€‚\nå¼‚å¸¸å¤„ç† åœ¨å¼‚æ­¥ä»»åŠ¡ç®¡ç†ä¸­ï¼Œå¤„ç†ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°çš„å¼‚å¸¸æ˜¯å¾ˆé‡è¦çš„ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•å’ŒæŠ€æœ¯ï¼š\nå¼‚å¸¸å¤„ç†æœºåˆ¶ï¼š ä½¿ç”¨ try-catch å—ï¼šåœ¨å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œä»£ç å—å†…ï¼Œä½¿ç”¨ try-catch å—æ•è·å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ï¼Œå¹¶åœ¨ catch å—ä¸­è¿›è¡Œç›¸åº”çš„å¼‚å¸¸å¤„ç†ã€‚å¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©æ°å½“çš„å¼‚å¸¸å¤„ç†ç­–ç•¥ï¼Œå¦‚è®°å½•æ—¥å¿—ã€å‘é€é€šçŸ¥ã€å›æ»šæ“ä½œç­‰ã€‚ ä½¿ç”¨å¼‚å¸¸å›è°ƒå‡½æ•°ï¼šå®šä¹‰ä¸€ä¸ªå¼‚å¸¸å›è°ƒå‡½æ•°ï¼Œç”¨äºåœ¨ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­æ•è·å¼‚å¸¸å¹¶è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚å›è°ƒå‡½æ•°å¯ä»¥æ¥æ”¶å¼‚å¸¸å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå¹¶åœ¨ä»»åŠ¡æ‰§è¡Œå®Œæˆæ—¶è¢«è°ƒç”¨ã€‚è¿™æ ·å¯ä»¥å°†å¼‚å¸¸å¤„ç†é€»è¾‘ä¸ä»»åŠ¡æ‰§è¡Œé€»è¾‘è§£è€¦ï¼Œæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œçµæ´»æ€§ã€‚ å¼‚å¸¸ä¼ é€’å’Œå°è£…ï¼š ä½¿ç”¨ Future å’Œ Promiseï¼šåœ¨å¼‚æ­¥ä»»åŠ¡ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Future å’Œ Promise æ¥ä¼ é€’ä»»åŠ¡çš„æ‰§è¡Œç»“æœå’Œå¼‚å¸¸ã€‚å½“ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå¯ä»¥å°†å¼‚å¸¸ä¿¡æ¯è®¾ç½®åˆ° Promise å¯¹è±¡ä¸­ï¼Œå¹¶é€šè¿‡ Future è·å–å¼‚å¸¸ä¿¡æ¯è¿›è¡Œå¤„ç†ã€‚ å°è£…å¼‚å¸¸ä¿¡æ¯ï¼šåœ¨å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œå¯ä»¥å°†å¼‚å¸¸ä¿¡æ¯å°è£…åˆ°è‡ªå®šä¹‰çš„å¼‚å¸¸ç±»ä¸­ï¼Œå¹¶é€šè¿‡æŠ›å‡ºè¯¥å¼‚å¸¸æ¥è¡¨ç¤ºä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çš„å¼‚å¸¸æƒ…å†µã€‚è°ƒç”¨æ–¹å¯ä»¥é€šè¿‡æ•è·å¹¶å¤„ç†ç›¸åº”çš„å¼‚å¸¸æ¥å¤„ç†ä»»åŠ¡çš„æ‰§è¡Œç»“æœå’Œå¼‚å¸¸æƒ…å†µã€‚ é”™è¯¯å¤„ç†ç­–ç•¥ï¼š é‡è¯•æœºåˆ¶ï¼šå½“ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå¯ä»¥æ ¹æ®ä¸€å®šçš„ç­–ç•¥è¿›è¡Œé‡è¯•ã€‚å¯ä»¥è®¾ç½®æœ€å¤§é‡è¯•æ¬¡æ•°å’Œé‡è¯•é—´éš”æ—¶é—´ï¼Œä»¥ä¾¿åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³ä¸´æ—¶æ€§çš„å¼‚å¸¸æƒ…å†µã€‚ å›é€€ç­–ç•¥ï¼šå½“ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å›é€€ç­–ç•¥æ¥å¤„ç†ã€‚å›é€€ç­–ç•¥å¯ä»¥é€‰æ‹©æ‰§è¡Œå¤‡é€‰æ–¹æ¡ˆæˆ–ä½¿ç”¨é»˜è®¤å€¼ï¼Œä»¥ç¡®ä¿ä»»åŠ¡çš„æ­£å¸¸æ‰§è¡Œã€‚ è¯·æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š\nåœ¨å¼‚æ­¥ä»»åŠ¡ç®¡ç†ä¸­ï¼ŒåŠæ—¶æ•è·å’Œå¤„ç†å¼‚å¸¸æ˜¯éå¸¸é‡è¦çš„ï¼Œä»¥é˜²æ­¢å¼‚å¸¸çš„ä¼ æ’­å’Œå½±å“å…¶ä»–ä»»åŠ¡æˆ–ç³»ç»Ÿçš„æ­£å¸¸è¿è¡Œã€‚ æ ¹æ®å…·ä½“çš„åº”ç”¨åœºæ™¯å’Œéœ€æ±‚ï¼Œé€‰æ‹©é€‚åˆçš„å¼‚å¸¸å¤„ç†æœºåˆ¶å’Œé”™è¯¯å¤„ç†ç­–ç•¥ã€‚ åœ¨å¤„ç†å¼‚å¸¸æ—¶ï¼Œéœ€è¦æ ¹æ®å¼‚å¸¸ç±»å‹å’Œæƒ…å†µè¿›è¡Œé€‚å½“çš„å¤„ç†ï¼Œä»¥ç¡®ä¿ä»»åŠ¡çš„æ­£ç¡®æ‰§è¡Œå’Œç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚ æ€»ç»“è€Œè¨€ï¼Œåœ¨å¼‚æ­¥ä»»åŠ¡ç®¡ç†ä¸­ï¼Œåˆç†å¤„ç†ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çš„å¼‚å¸¸æ˜¯ä¿è¯ç³»ç»Ÿç¨³å®šæ€§å’Œå¯é æ€§çš„å…³é”®å› ç´ ä¹‹ä¸€ã€‚é€šè¿‡é€‚å½“çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ã€å¼‚å¸¸ä¼ é€’å’Œå°è£…ï¼Œä»¥åŠé”™è¯¯å¤„ç†ç­–ç•¥ï¼Œå¯ä»¥æœ‰æ•ˆåœ°å¤„ç†ä»»åŠ¡æ‰§è¡Œä¸­å¯èƒ½å‡ºç°çš„å¼‚å¸¸æƒ…å†µã€‚\né€‚ç”¨æ€§ å¼‚æ­¥æ–¹æ³•è°ƒç”¨æ¨¡å¼é€‚ç”¨äºä»¥ä¸‹æƒ…å†µ:\nå½“æ‚¨æœ‰å¤šä¸ªå¯ä»¥å¹¶è¡Œè¿è¡Œçš„ç‹¬ç«‹ä»»åŠ¡æ—¶ï¼šè¯¥æ¨¡å¼å…è®¸æ‚¨ä»¥å¹¶è¡Œçš„æ–¹å¼å¤„ç†å¤šä¸ªä»»åŠ¡ï¼Œè€Œæ— éœ€ç­‰å¾…å•ä¸ªä»»åŠ¡å®Œæˆã€‚è¿™å¯¹äºå¹¶è¡Œå¤„ç†ç‹¬ç«‹ä»»åŠ¡çš„æƒ…å†µéå¸¸æœ‰ç”¨ï¼Œä»¥æé«˜æ•´ä½“çš„æ‰§è¡Œæ•ˆç‡ã€‚ å½“æ‚¨éœ€è¦æé«˜ä¸€ç»„é¡ºåºä»»åŠ¡çš„æ€§èƒ½æ—¶ï¼šå¦‚æœå­˜åœ¨ä¸€ç»„ä»»åŠ¡æŒ‰ç…§ç‰¹å®šé¡ºåºæ‰§è¡Œï¼Œä½†å…¶ä¸­æŸäº›ä»»åŠ¡å¯èƒ½æ˜¯è€—æ—¶çš„ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å¼‚æ­¥æ–¹æ³•è°ƒç”¨æ¨¡å¼æ¥å¹¶è¡Œå¤„ç†è¿™äº›ä»»åŠ¡ã€‚è¿™æ ·ï¼Œåœ¨ç­‰å¾…æŸä¸ªä»»åŠ¡å®Œæˆæ—¶ï¼Œå…¶ä»–ä»»åŠ¡å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œä»è€Œæé«˜æ•´ä½“æ€§èƒ½ã€‚ å½“æ‚¨çš„å¤„ç†èƒ½åŠ›æˆ–é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡æ•°é‡æœ‰é™ï¼Œå¹¶ä¸”è°ƒç”¨æ–¹ä¸åº”ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæ¯•æ—¶ï¼šå¦‚æœæ‚¨çš„ç³»ç»Ÿèµ„æºæœ‰é™ï¼Œæ— æ³•åŒæ—¶å¤„ç†å¤§é‡çš„é•¿æ—¶é—´è¿è¡Œä»»åŠ¡ï¼Œè€Œä¸”è°ƒç”¨æ–¹ä¸å¸Œæœ›è¢«é˜»å¡ç­‰å¾…ä»»åŠ¡å®Œæˆï¼Œé‚£ä¹ˆå¼‚æ­¥æ–¹æ³•è°ƒç”¨æ¨¡å¼å¯ä»¥å¾ˆå¥½åœ°æ»¡è¶³è¿™ç§éœ€æ±‚ã€‚å®ƒå…è®¸è°ƒç”¨æ–¹ç«‹å³è¿”å›ï¼Œå¹¶åœ¨ä»»åŠ¡å®Œæˆåé€šè¿‡å›è°ƒæˆ–ç­‰å¾…æ¥è·å–ä»»åŠ¡ç»“æœã€‚ å¼‚æ­¥æ–¹æ³•è°ƒç”¨æ¨¡å¼å¯ä»¥æé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€èµ„æºåˆ©ç”¨ç‡å’Œå“åº”èƒ½åŠ›ã€‚é€šè¿‡å¹¶è¡Œå¤„ç†ä»»åŠ¡å’Œå‡å°‘ç­‰å¾…æ—¶é—´ï¼Œå¯ä»¥æ›´å¥½åœ°åˆ©ç”¨ç³»ç»Ÿèµ„æºï¼Œæé«˜æ•´ä½“æ•ˆç‡ã€‚ç„¶è€Œï¼Œä½¿ç”¨è¯¥æ¨¡å¼å¯èƒ½ä¼šå¢åŠ ä»£ç å¤æ‚æ€§ï¼Œéœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨æ€§å’Œå¼‚æ­¥ä»»åŠ¡çš„ç®¡ç†ç­‰é—®é¢˜ã€‚\nè¯·æ³¨æ„ï¼Œé€‚ç”¨æ€§å–å†³äºå…·ä½“çš„åº”ç”¨åœºæ™¯å’Œéœ€æ±‚ã€‚åœ¨å†³å®šæ˜¯å¦ä½¿ç”¨å¼‚æ­¥æ–¹æ³•è°ƒç”¨æ¨¡å¼æ—¶ï¼Œéœ€è¦ç»¼åˆè€ƒè™‘ç³»ç»Ÿçš„è¦æ±‚ã€èµ„æºé™åˆ¶ä»¥åŠä»£ç å¤æ‚æ€§ç­‰å› ç´ ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/08/14/java-design-patterns-async-method-invocation/","summary":"æœ¬æ–‡ä¸»è¦ä»‹ç» Async Method Invocation æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nä»‹ç» Async Method Invocationï¼ˆå¼‚æ­¥æ–¹æ³•è°ƒç”¨ï¼‰æ˜¯ä¸€ç§ç¼–ç¨‹æ¨¡å¼ï¼Œç”¨äºå¤„ç†å¼‚æ­¥æ“ä½œå’Œå¹¶å‘æ‰§è¡Œã€‚å®ƒå…è®¸åœ¨æ‰§è¡ŒæŸä¸ªæ“ä½œæ—¶ä¸é˜»å¡ä¸»çº¿ç¨‹ï¼Œè€Œæ˜¯å°†æ“ä½œå§”æ‰˜ç»™å¦ä¸€ä¸ªçº¿ç¨‹æˆ–å¤„ç†ç¨‹åºï¼Œå¹¶åœ¨æ“ä½œå®Œæˆåè·å–ç»“æœæˆ–æ‰§è¡Œå›è°ƒã€‚\nå¼‚æ­¥æ–¹æ³•è°ƒç”¨çš„ä¸»è¦ç›®çš„æ˜¯æé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œå“åº”èƒ½åŠ›ã€‚é€šè¿‡å°†è€—æ—¶çš„æ“ä½œï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶è¯»å†™ã€æ•°æ®åº“æŸ¥è¯¢ç­‰ï¼‰ç½®äºåå°çº¿ç¨‹æˆ–å¼‚æ­¥ä»»åŠ¡ä¸­ï¼Œå¯ä»¥ä½¿ä¸»çº¿ç¨‹èƒ½å¤Ÿç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œè€Œä¸ä¼šè¢«é˜»å¡ã€‚\nå¼‚æ­¥æ–¹æ³•è°ƒç”¨å¯ä»¥åœ¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€å’Œæ¡†æ¶ä¸­ä»¥ä¸åŒçš„æ–¹å¼å®ç°ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å‡ ç§å¸¸è§çš„å½¢å¼ï¼š\nå›è°ƒå‡½æ•°ï¼ˆCallbackï¼‰ï¼šé€šè¿‡å®šä¹‰å›è°ƒå‡½æ•°ï¼Œå°†å¼‚æ­¥æ“ä½œçš„ç»“æœä¼ é€’ç»™è°ƒç”¨æ–¹ã€‚å½“å¼‚æ­¥æ“ä½œå®Œæˆæ—¶ï¼Œå›è°ƒå‡½æ•°ä¼šè¢«è°ƒç”¨å¹¶å¤„ç†ç»“æœã€‚ Future/Promiseï¼ˆFuture/Deferredï¼‰ï¼šé€šè¿‡ Future æˆ– Promise å¯¹è±¡è¡¨ç¤ºå¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œè°ƒç”¨æ–¹å¯ä»¥åœ¨éœ€è¦æ—¶è·å–ç»“æœæˆ–æ·»åŠ å›è°ƒå‡½æ•°æ¥å¤„ç†ç»“æœã€‚ å¼‚æ­¥/awaitï¼šå¼‚æ­¥/await æ˜¯ä¸€ç§è¯­æ³•ç³–ï¼Œç”¨äºç®€åŒ–å¼‚æ­¥ä»£ç çš„ç¼–å†™å’Œç†è§£ã€‚å®ƒå…è®¸ä»¥åŒæ­¥çš„æ–¹å¼ç¼–å†™å¼‚æ­¥æ“ä½œï¼Œä½¿ä»£ç æ›´å…·å¯è¯»æ€§ã€‚ è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserverï¼‰ï¼šé€šè¿‡å®šä¹‰è§‚å¯Ÿè€…å¯¹è±¡ï¼Œå¼‚æ­¥æ“ä½œçš„ç»“æœå¯ä»¥è¢«è§‚å¯Ÿè€…è®¢é˜…ã€‚å½“ç»“æœå¯ç”¨æ—¶ï¼Œè§‚å¯Ÿè€…ä¼šè¢«é€šçŸ¥å¹¶æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚ ä½¿ç”¨å¼‚æ­¥æ–¹æ³•è°ƒç”¨å¯ä»¥æé«˜åº”ç”¨ç¨‹åºçš„å¹¶å‘æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚å®ƒå¯ä»¥åœ¨åå°æ‰§è¡Œè€—æ—¶çš„æ“ä½œï¼Œä½¿ä¸»çº¿ç¨‹ä¿æŒå“åº”ï¼Œå¹¶å…è®¸åº”ç”¨ç¨‹åºåŒæ—¶å¤„ç†å¤šä¸ªå¹¶å‘è¯·æ±‚ã€‚ç„¶è€Œï¼Œå¯¹äºå¹¶å‘æ“ä½œçš„æ­£ç¡®å¤„ç†å’Œç®¡ç†èµ„æºçš„å®‰å…¨æ€§ä»ç„¶éœ€è¦ä»”ç»†è€ƒè™‘å’Œå®æ–½ã€‚\nä¸¾ä¾‹ AsyncResultï¼ˆç”¨äºå¼‚æ­¥è¯„ä¼°å€¼çš„ä¸­é—´å®¹å™¨ï¼‰ï¼ŒAsyncCallbackï¼ˆå¯ä»¥åœ¨ä»»åŠ¡å®Œæˆæ—¶è¢«æ‰§è¡Œï¼‰å’ŒAsyncExecutorï¼ˆç”¨äºç®¡ç†å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œï¼‰ã€‚\npublic interface AsyncResult\u0026lt;T\u0026gt; { boolean isCompleted(); T getValue() throws ExecutionException; void await() throws InterruptedException; } public interface AsyncCallback\u0026lt;T\u0026gt; { void onComplete(T value, Optional\u0026lt;Exception\u0026gt; ex); } public interface AsyncExecutor { \u0026lt;T\u0026gt; AsyncResult\u0026lt;T\u0026gt; startProcess(Callable\u0026lt;T\u0026gt; task); \u0026lt;T\u0026gt; AsyncResult\u0026lt;T\u0026gt; startProcess(Callable\u0026lt;T\u0026gt; task, AsyncCallback\u0026lt;T\u0026gt; callback); \u0026lt;T\u0026gt; T endProcess(AsyncResult\u0026lt;T\u0026gt; asyncResult) throws ExecutionException, InterruptedException; } ThreadAsyncExecutoræ˜¯AsyncExecutorçš„å®ç°ã€‚ æ¥ä¸‹æ¥å°†çªå‡ºæ˜¾ç¤ºå…¶ä¸€äº›å…³é”®éƒ¨åˆ†ã€‚\npublic class ThreadAsyncExecutor implements AsyncExecutor { @Override public \u0026lt;T\u0026gt; AsyncResult\u0026lt;T\u0026gt; startProcess(Callable\u0026lt;T\u0026gt; task) { return startProcess(task, null); } @Override public \u0026lt;T\u0026gt; AsyncResult\u0026lt;T\u0026gt; startProcess(Callable\u0026lt;T\u0026gt; task, AsyncCallback\u0026lt;T\u0026gt; callback) { var result = new CompletableResult\u0026lt;\u0026gt;(callback); new Thread( () -\u0026gt; { try { result.","title":"Javaè®¾è®¡æ¨¡å¼ï¼šAsync Method Invocation"},{"content":"æœ¬æ–‡ä¸»è¦ä»‹ç» API Gateway æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nç›®çš„ API ç½‘å…³è®¾è®¡æ¨¡å¼æ—¨åœ¨å°†æ‰€æœ‰å¯¹å¾®æœåŠ¡çš„è°ƒç”¨èšåˆåˆ°ä¸€èµ·ã€‚å®¢æˆ·ç«¯é€šè¿‡è°ƒç”¨ API ç½‘å…³æ¥å®ç°å¯¹å¤šä¸ªå¾®æœåŠ¡çš„è®¿é—®ï¼Œè€Œä¸æ˜¯ç›´æ¥è°ƒç”¨æ¯ä¸ªå¾®æœåŠ¡ã€‚è¿™ç§æ¨¡å¼çš„ç›®çš„æ˜¯è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š\nå‡å°‘å®¢æˆ·ç«¯çš„ç½‘ç»œè¯·æ±‚ï¼šå¦‚æœå®¢æˆ·ç«¯ç›´æ¥è°ƒç”¨æ¯ä¸ªå¾®æœåŠ¡ï¼Œä¼šå¯¼è‡´é¢å¤–çš„ç½‘ç»œè¯·æ±‚ï¼Œå¢åŠ åŠ è½½æ—¶é—´ã€‚é€šè¿‡ä½¿ç”¨ API ç½‘å…³ï¼Œå®¢æˆ·ç«¯åªéœ€è¦è¿›è¡Œä¸€æ¬¡è°ƒç”¨ï¼Œè€Œä¸æ˜¯å¤šæ¬¡è°ƒç”¨ã€‚ è§£è€¦å®¢æˆ·ç«¯å’Œå¾®æœåŠ¡ï¼šå¦‚æœå®¢æˆ·ç«¯ç›´æ¥ä¸æ¯ä¸ªå¾®æœåŠ¡è¿›è¡Œé€šä¿¡ï¼Œå®¢æˆ·ç«¯ä¸å¾®æœåŠ¡ä¹‹é—´çš„è€¦åˆåº¦å¾ˆé«˜ã€‚å½“å¾®æœåŠ¡çš„å®ç°å‘ç”Ÿå˜åŒ–æˆ–ä½ç½®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œéœ€è¦æ›´æ–°æ‰€æœ‰å®¢æˆ·ç«¯ã€‚ä½¿ç”¨ API ç½‘å…³å¯ä»¥å°†å®¢æˆ·ç«¯ä¸å…·ä½“çš„å¾®æœåŠ¡è§£è€¦ï¼Œå®¢æˆ·ç«¯åªéœ€è¦ä¸ API ç½‘å…³é€šä¿¡ã€‚ æä¾›é›†ä¸­åŒ–çš„åŠŸèƒ½å’ŒæœåŠ¡ï¼šAPI ç½‘å…³å¯ä»¥å®ç°ä¸€äº›é€šç”¨çš„åŠŸèƒ½å’ŒæœåŠ¡ï¼Œä¾‹å¦‚é™æµã€è®¤è¯ã€æˆæƒã€å®‰å…¨æ€§ç­‰ã€‚è¿™æ ·å¯ä»¥é¿å…æ¯ä¸ªå¾®æœåŠ¡éƒ½å®ç°è¿™äº›åŠŸèƒ½ï¼Œå‡å°‘é‡å¤ä»£ç ã€‚ è§£é‡Š åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒAPI ç½‘å…³é€šå¸¸åŒ…æ‹¬ä¸€ä¸ªè½¬æ¢å¼•æ“ï¼Œç”¨äºå®æ—¶åœ°ç¼–æ’å’Œä¿®æ”¹è¯·æ±‚å’Œå“åº”ã€‚å®ƒè¿˜å¯ä»¥æä¾›æ”¶é›†åˆ†ææ•°æ®å’Œæä¾›ç¼“å­˜ç­‰åŠŸèƒ½ã€‚å¦å¤–ï¼ŒAPI ç½‘å…³è¿˜å¯ä»¥æ”¯æŒèº«ä»½éªŒè¯ã€æˆæƒã€å®‰å…¨æ€§ã€å®¡è®¡å’Œæ³•è§„éµä»æ€§ç­‰åŠŸèƒ½ã€‚\nå‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç”µå­å•†åŠ¡å¹³å°ï¼Œå…¶ä¸­åŒ…å«å¤šä¸ªå¾®æœåŠ¡ï¼Œå¦‚ç”¨æˆ·æœåŠ¡ã€äº§å“æœåŠ¡ã€å›¾ç‰‡æœåŠ¡ã€è®¢å•æœåŠ¡å’Œæ”¯ä»˜æœåŠ¡ç­‰ã€‚æ¯ä¸ªå¾®æœåŠ¡éƒ½æœ‰è‡ªå·±çš„ API å’Œæ•°æ®åº“ã€‚\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥å¼•å…¥ä¸€ä¸ª API ç½‘å…³æ¥å¤„ç†å¯¹è¿™äº›å¾®æœåŠ¡çš„è®¿é—®ã€‚API ç½‘å…³ä½œä¸ºä¸€ä¸ªå…¥å£ç‚¹ï¼Œæ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¹¶å°†è¯·æ±‚è½¬å‘åˆ°é€‚å½“çš„å¾®æœåŠ¡ã€‚\nä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªå®¢æˆ·ç«¯éœ€è¦è·å–æŸä¸ªäº§å“çš„è¯¦ç»†ä¿¡æ¯æ—¶ï¼Œä»–ä»¬å¯ä»¥å‘é€ä¸€ä¸ª HTTP è¯·æ±‚åˆ° API ç½‘å…³çš„ç‰¹å®šç«¯ç‚¹ã€‚API ç½‘å…³ä¼šéªŒè¯è¯·æ±‚å¹¶å°†å…¶è½¬å‘åˆ°äº§å“æœåŠ¡ã€‚äº§å“æœåŠ¡å°†æŸ¥è¯¢æ•°æ®åº“è·å–äº§å“ä¿¡æ¯ï¼Œå¹¶å°†å“åº”è¿”å›ç»™ API ç½‘å…³ã€‚ç„¶åï¼ŒAPI ç½‘å…³å°†äº§å“ä¿¡æ¯è¿”å›ç»™å®¢æˆ·ç«¯ã€‚\nAPI ç½‘å…³å¯ä»¥å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š\nè®¤è¯å’Œæˆæƒï¼šAPI ç½‘å…³å¯ä»¥éªŒè¯å®¢æˆ·ç«¯çš„èº«ä»½å’Œæƒé™ï¼Œç¡®ä¿åªæœ‰ç»è¿‡æˆæƒçš„ç”¨æˆ·èƒ½å¤Ÿè®¿é—®ç‰¹å®šçš„å¾®æœåŠ¡ã€‚ è¯·æ±‚è½¬å‘å’Œè·¯ç”±ï¼šAPI ç½‘å…³æ ¹æ®è¯·æ±‚çš„è·¯å¾„å’Œå‚æ•°å°†è¯·æ±‚è½¬å‘åˆ°é€‚å½“çš„å¾®æœåŠ¡ã€‚å®ƒå¯ä»¥æ‰§è¡Œè´Ÿè½½å‡è¡¡å’Œè·¯ç”±ç­–ç•¥ï¼Œç¡®ä¿è¯·æ±‚è¢«æ­£ç¡®åœ°åˆ†å‘åˆ°ç›¸åº”çš„å¾®æœåŠ¡å®ä¾‹ã€‚ å“åº”èšåˆï¼šå¦‚æœä¸€ä¸ªè¯·æ±‚éœ€è¦ä»å¤šä¸ªå¾®æœåŠ¡è·å–æ•°æ®ï¼ŒAPI ç½‘å…³å¯ä»¥å°†è¿™äº›è¯·æ±‚å‘é€ç»™ç›¸åº”çš„å¾®æœåŠ¡ï¼Œå¹¶å°†å®ƒä»¬çš„å“åº”èšåˆåˆ°ä¸€ä¸ªå“åº”ä¸­è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ ç¼“å­˜å’Œæ€§èƒ½ä¼˜åŒ–ï¼šAPI ç½‘å…³å¯ä»¥ç¼“å­˜å¸¸ç”¨çš„è¯·æ±‚å’Œå“åº”ï¼Œä»¥æé«˜æ€§èƒ½å¹¶å‡è½»åç«¯å¾®æœåŠ¡çš„è´Ÿè½½ã€‚ å®‰å…¨æ€§å’Œç›‘æ§ï¼šAPI ç½‘å…³å¯ä»¥å®æ–½å®‰å…¨ç­–ç•¥ï¼Œä¾‹å¦‚é˜²æ­¢æ¶æ„è¯·æ±‚å’Œ DDoS æ”»å‡»ã€‚å®ƒè¿˜å¯ä»¥ç›‘æ§è¯·æ±‚å’Œå“åº”ï¼Œæ”¶é›†åº”ç”¨ç¨‹åºçš„æŒ‡æ ‡å’Œæ—¥å¿—æ•°æ®ã€‚ ç¨‹åºç¤ºä¾‹\næ­¤å®ç°å±•ç¤ºäº†ç”µå­å•†åŠ¡ç«™ç‚¹çš„ API ç½‘å…³æ¨¡å¼ã€‚ ApiGatewayåˆ†åˆ«ä½¿ç”¨ ImageClientImplå’Œ PriceClientImplæ¥è°ƒç”¨ Image å’Œ Price å¾®æœåŠ¡ã€‚ åœ¨æ¡Œé¢è®¾å¤‡ä¸ŠæŸ¥çœ‹è¯¥ç½‘ç«™çš„å®¢æˆ·å¯ä»¥çœ‹åˆ°ä»·æ ¼ä¿¡æ¯å’Œäº§å“å›¾ç‰‡ï¼Œå› æ­¤ ApiGatewayä¼šè°ƒç”¨è¿™ä¸¤ç§å¾®æœåŠ¡å¹¶åœ¨DesktopProductæ¨¡å‹ä¸­æ±‡æ€»æ•°æ®ã€‚ ä½†æ˜¯ï¼Œç§»åŠ¨ç”¨æˆ·åªèƒ½çœ‹åˆ°ä»·æ ¼ä¿¡æ¯ã€‚ ä»–ä»¬çœ‹ä¸åˆ°äº§å“å›¾ç‰‡ã€‚ å¯¹äºç§»åŠ¨ç”¨æˆ·ï¼ŒApiGatewayä»…æ£€ç´¢ä»·æ ¼ä¿¡æ¯ï¼Œå¹¶å°†å…¶ç”¨äºå¡«å……MobileProductæ¨¡å‹ã€‚\nè¿™ä¸ªæ˜¯å›¾åƒå¾®æœåŠ¡çš„å®ç°ã€‚\npublic interface ImageClient { String getImagePath(); } public class ImageClientImpl implements ImageClient { @Override public String getImagePath() { var httpClient = HttpClient.newHttpClient(); var httpGet = HttpRequest.newBuilder() .GET() .uri(URI.create(\u0026#34;http://localhost:50005/image-path\u0026#34;)) .build(); try { var httpResponse = httpClient.send(httpGet, BodyHandlers.ofString()); return httpResponse.body(); } catch (IOException | InterruptedException e) { e.printStackTrace(); } return null; } } è¿™é‡Œæ˜¯ä»·æ ¼æœåŠ¡çš„å®ç°ã€‚\npublic interface PriceClient { String getPrice(); } public class PriceClientImpl implements PriceClient { @Override public String getPrice() { var httpClient = HttpClient.newHttpClient(); var httpGet = HttpRequest.newBuilder() .GET() .uri(URI.create(\u0026#34;http://localhost:50006/price\u0026#34;)) .build(); try { var httpResponse = httpClient.send(httpGet, BodyHandlers.ofString()); return httpResponse.body(); } catch (IOException | InterruptedException e) { e.printStackTrace(); } return null; } } åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° API ç½‘å…³å¦‚ä½•å°†è¯·æ±‚æ˜ å°„åˆ°å¾®æœåŠ¡ã€‚\npublic class ApiGateway { @Resource private ImageClient imageClient; @Resource private PriceClient priceClient; @RequestMapping(path = \u0026#34;/desktop\u0026#34;, method = RequestMethod.GET) public DesktopProduct getProductDesktop() { var desktopProduct = new DesktopProduct(); desktopProduct.setImagePath(imageClient.getImagePath()); desktopProduct.setPrice(priceClient.getPrice()); return desktopProduct; } @RequestMapping(path = \u0026#34;/mobile\u0026#34;, method = RequestMethod.GET) public MobileProduct getProductMobile() { var mobileProduct = new MobileProduct(); mobileProduct.setPrice(priceClient.getPrice()); return mobileProduct; } } ç±»å›¾ é€‚ç”¨æ€§ API ç½‘å…³æ¨¡å¼é€‚ç”¨äºä»¥ä¸‹æƒ…å†µï¼š\nå¾®æœåŠ¡æ¶æ„ï¼šå½“ä½ çš„åº”ç”¨ç¨‹åºé‡‡ç”¨å¾®æœåŠ¡æ¶æ„æ—¶ï¼Œæ¯ä¸ªå¾®æœåŠ¡è´Ÿè´£ç‰¹å®šçš„ä¸šåŠ¡åŠŸèƒ½ã€‚API ç½‘å…³å¯ä»¥ä½œä¸ºå¾®æœåŠ¡æ¶æ„çš„å…¥å£ç‚¹ï¼Œèšåˆå’Œç®¡ç†æ‰€æœ‰å¾®æœåŠ¡çš„è®¿é—®ã€‚ å¤šæ¸ é“è®¿é—®ï¼šå¦‚æœä½ çš„åº”ç”¨ç¨‹åºéœ€è¦æ”¯æŒå¤šä¸ªå®¢æˆ·ç«¯æ¸ é“ï¼ˆå¦‚ Webã€ç§»åŠ¨åº”ç”¨ã€ç¬¬ä¸‰æ–¹é›†æˆç­‰ï¼‰ï¼ŒAPI ç½‘å…³å¯ä»¥æä¾›ç»Ÿä¸€çš„æ¥å…¥ç‚¹ï¼Œå¤„ç†ä¸åŒæ¸ é“çš„è¯·æ±‚ï¼Œå¹¶å°†å…¶è½¬å‘åˆ°ç›¸åº”çš„å¾®æœåŠ¡ã€‚ å®‰å…¨æ€§å’Œè®¤è¯ï¼šå½“ä½ éœ€è¦å¯¹å®¢æˆ·ç«¯è¿›è¡Œèº«ä»½éªŒè¯å’Œæˆæƒï¼Œå¹¶ç¡®ä¿åªæœ‰åˆæ³•ç”¨æˆ·èƒ½å¤Ÿè®¿é—®ä½ çš„å¾®æœåŠ¡æ—¶ï¼ŒAPI ç½‘å…³å¯ä»¥å®æ–½å®‰å…¨æ€§ç­–ç•¥ï¼Œé›†ä¸­ç®¡ç†è®¤è¯å’Œæˆæƒã€‚ è¯·æ±‚èšåˆå’Œè½¬æ¢ï¼šå¦‚æœå®¢æˆ·ç«¯éœ€è¦ä»å¤šä¸ªå¾®æœåŠ¡è·å–æ•°æ®ï¼Œå¹¶å¸Œæœ›å°†è¿™äº›æ•°æ®èšåˆä¸ºå•ä¸ªå“åº”ï¼ŒAPI ç½‘å…³å¯ä»¥å¤„ç†è¿™ç§è¯·æ±‚èšåˆï¼Œå¹¶åœ¨éœ€è¦æ—¶è½¬æ¢è¯·æ±‚å’Œå“åº”çš„æ ¼å¼ã€‚ æ€§èƒ½ä¼˜åŒ–å’Œç¼“å­˜ï¼šAPI ç½‘å…³å¯ä»¥å®ç°è¯·æ±‚çš„ç¼“å­˜æœºåˆ¶ï¼Œå‡å°‘å¯¹åç«¯å¾®æœåŠ¡çš„é‡å¤è¯·æ±‚ï¼Œæé«˜æ€§èƒ½å’Œå“åº”æ—¶é—´ã€‚ ç›‘æ§å’Œæ—¥å¿—è®°å½•ï¼šé€šè¿‡é›†ä¸­ç®¡ç†è¯·æ±‚å’Œå“åº”çš„æµé‡ï¼ŒAPI ç½‘å…³å¯ä»¥æ”¶é›†åº”ç”¨ç¨‹åºçš„æŒ‡æ ‡å’Œæ—¥å¿—æ•°æ®ï¼Œç”¨äºç›‘æ§å’Œæ•…éšœæ’é™¤ã€‚ æ€»çš„æ¥è¯´ï¼ŒAPI ç½‘å…³æ¨¡å¼é€‚ç”¨äºéœ€è¦å¯¹å¾®æœåŠ¡æ¶æ„è¿›è¡Œç»Ÿä¸€ç®¡ç†ã€å®‰å…¨æ€§æ§åˆ¶ã€è¯·æ±‚èšåˆã€æ€§èƒ½ä¼˜åŒ–å’Œç›‘æ§çš„åœºæ™¯ã€‚å®ƒæä¾›äº†ä¸€ä¸ªä¸­å¿ƒåŒ–çš„å…¥å£ç‚¹ï¼Œç®€åŒ–äº†å®¢æˆ·ç«¯ä¸å¾®æœåŠ¡ä¹‹é—´çš„é€šä¿¡ï¼Œå¹¶æä¾›äº†é¢å¤–çš„åŠŸèƒ½å’ŒæœåŠ¡ã€‚\nå‚è€ƒ \u0026ldquo;API Gateway\u0026rdquo; - Martin Fowler: https://martinfowler.com/articles/microservices.html#APIGateway\n\u0026ldquo;API Gateway\u0026rdquo; - AWS Well-Architected Framework: https://wa.aws.amazon.com/wat.pillar.apigateway.en.html\n\u0026ldquo;Introduction to API Gateways\u0026rdquo; - NGINX: https://www.nginx.com/api-gateway/\nmicroservices.io - API Gateway\nNGINX - Building Microservices: Using an API Gateway\nMicroservices Patterns: With examples in Java\nBuilding Microservices: Designing Fine-Grained Systems\n","permalink":"https://blog.chensoul.cc/posts/2023/08/13/java-design-patterns-api-gateway/","summary":"æœ¬æ–‡ä¸»è¦ä»‹ç» API Gateway æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nç›®çš„ API ç½‘å…³è®¾è®¡æ¨¡å¼æ—¨åœ¨å°†æ‰€æœ‰å¯¹å¾®æœåŠ¡çš„è°ƒç”¨èšåˆåˆ°ä¸€èµ·ã€‚å®¢æˆ·ç«¯é€šè¿‡è°ƒç”¨ API ç½‘å…³æ¥å®ç°å¯¹å¤šä¸ªå¾®æœåŠ¡çš„è®¿é—®ï¼Œè€Œä¸æ˜¯ç›´æ¥è°ƒç”¨æ¯ä¸ªå¾®æœåŠ¡ã€‚è¿™ç§æ¨¡å¼çš„ç›®çš„æ˜¯è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š\nå‡å°‘å®¢æˆ·ç«¯çš„ç½‘ç»œè¯·æ±‚ï¼šå¦‚æœå®¢æˆ·ç«¯ç›´æ¥è°ƒç”¨æ¯ä¸ªå¾®æœåŠ¡ï¼Œä¼šå¯¼è‡´é¢å¤–çš„ç½‘ç»œè¯·æ±‚ï¼Œå¢åŠ åŠ è½½æ—¶é—´ã€‚é€šè¿‡ä½¿ç”¨ API ç½‘å…³ï¼Œå®¢æˆ·ç«¯åªéœ€è¦è¿›è¡Œä¸€æ¬¡è°ƒç”¨ï¼Œè€Œä¸æ˜¯å¤šæ¬¡è°ƒç”¨ã€‚ è§£è€¦å®¢æˆ·ç«¯å’Œå¾®æœåŠ¡ï¼šå¦‚æœå®¢æˆ·ç«¯ç›´æ¥ä¸æ¯ä¸ªå¾®æœåŠ¡è¿›è¡Œé€šä¿¡ï¼Œå®¢æˆ·ç«¯ä¸å¾®æœåŠ¡ä¹‹é—´çš„è€¦åˆåº¦å¾ˆé«˜ã€‚å½“å¾®æœåŠ¡çš„å®ç°å‘ç”Ÿå˜åŒ–æˆ–ä½ç½®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œéœ€è¦æ›´æ–°æ‰€æœ‰å®¢æˆ·ç«¯ã€‚ä½¿ç”¨ API ç½‘å…³å¯ä»¥å°†å®¢æˆ·ç«¯ä¸å…·ä½“çš„å¾®æœåŠ¡è§£è€¦ï¼Œå®¢æˆ·ç«¯åªéœ€è¦ä¸ API ç½‘å…³é€šä¿¡ã€‚ æä¾›é›†ä¸­åŒ–çš„åŠŸèƒ½å’ŒæœåŠ¡ï¼šAPI ç½‘å…³å¯ä»¥å®ç°ä¸€äº›é€šç”¨çš„åŠŸèƒ½å’ŒæœåŠ¡ï¼Œä¾‹å¦‚é™æµã€è®¤è¯ã€æˆæƒã€å®‰å…¨æ€§ç­‰ã€‚è¿™æ ·å¯ä»¥é¿å…æ¯ä¸ªå¾®æœåŠ¡éƒ½å®ç°è¿™äº›åŠŸèƒ½ï¼Œå‡å°‘é‡å¤ä»£ç ã€‚ è§£é‡Š åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒAPI ç½‘å…³é€šå¸¸åŒ…æ‹¬ä¸€ä¸ªè½¬æ¢å¼•æ“ï¼Œç”¨äºå®æ—¶åœ°ç¼–æ’å’Œä¿®æ”¹è¯·æ±‚å’Œå“åº”ã€‚å®ƒè¿˜å¯ä»¥æä¾›æ”¶é›†åˆ†ææ•°æ®å’Œæä¾›ç¼“å­˜ç­‰åŠŸèƒ½ã€‚å¦å¤–ï¼ŒAPI ç½‘å…³è¿˜å¯ä»¥æ”¯æŒèº«ä»½éªŒè¯ã€æˆæƒã€å®‰å…¨æ€§ã€å®¡è®¡å’Œæ³•è§„éµä»æ€§ç­‰åŠŸèƒ½ã€‚\nå‡è®¾ä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªç”µå­å•†åŠ¡å¹³å°ï¼Œå…¶ä¸­åŒ…å«å¤šä¸ªå¾®æœåŠ¡ï¼Œå¦‚ç”¨æˆ·æœåŠ¡ã€äº§å“æœåŠ¡ã€å›¾ç‰‡æœåŠ¡ã€è®¢å•æœåŠ¡å’Œæ”¯ä»˜æœåŠ¡ç­‰ã€‚æ¯ä¸ªå¾®æœåŠ¡éƒ½æœ‰è‡ªå·±çš„ API å’Œæ•°æ®åº“ã€‚\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥å¼•å…¥ä¸€ä¸ª API ç½‘å…³æ¥å¤„ç†å¯¹è¿™äº›å¾®æœåŠ¡çš„è®¿é—®ã€‚API ç½‘å…³ä½œä¸ºä¸€ä¸ªå…¥å£ç‚¹ï¼Œæ¥æ”¶æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¹¶å°†è¯·æ±‚è½¬å‘åˆ°é€‚å½“çš„å¾®æœåŠ¡ã€‚\nä¾‹å¦‚ï¼Œå½“ä¸€ä¸ªå®¢æˆ·ç«¯éœ€è¦è·å–æŸä¸ªäº§å“çš„è¯¦ç»†ä¿¡æ¯æ—¶ï¼Œä»–ä»¬å¯ä»¥å‘é€ä¸€ä¸ª HTTP è¯·æ±‚åˆ° API ç½‘å…³çš„ç‰¹å®šç«¯ç‚¹ã€‚API ç½‘å…³ä¼šéªŒè¯è¯·æ±‚å¹¶å°†å…¶è½¬å‘åˆ°äº§å“æœåŠ¡ã€‚äº§å“æœåŠ¡å°†æŸ¥è¯¢æ•°æ®åº“è·å–äº§å“ä¿¡æ¯ï¼Œå¹¶å°†å“åº”è¿”å›ç»™ API ç½‘å…³ã€‚ç„¶åï¼ŒAPI ç½‘å…³å°†äº§å“ä¿¡æ¯è¿”å›ç»™å®¢æˆ·ç«¯ã€‚\nAPI ç½‘å…³å¯ä»¥å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š\nè®¤è¯å’Œæˆæƒï¼šAPI ç½‘å…³å¯ä»¥éªŒè¯å®¢æˆ·ç«¯çš„èº«ä»½å’Œæƒé™ï¼Œç¡®ä¿åªæœ‰ç»è¿‡æˆæƒçš„ç”¨æˆ·èƒ½å¤Ÿè®¿é—®ç‰¹å®šçš„å¾®æœåŠ¡ã€‚ è¯·æ±‚è½¬å‘å’Œè·¯ç”±ï¼šAPI ç½‘å…³æ ¹æ®è¯·æ±‚çš„è·¯å¾„å’Œå‚æ•°å°†è¯·æ±‚è½¬å‘åˆ°é€‚å½“çš„å¾®æœåŠ¡ã€‚å®ƒå¯ä»¥æ‰§è¡Œè´Ÿè½½å‡è¡¡å’Œè·¯ç”±ç­–ç•¥ï¼Œç¡®ä¿è¯·æ±‚è¢«æ­£ç¡®åœ°åˆ†å‘åˆ°ç›¸åº”çš„å¾®æœåŠ¡å®ä¾‹ã€‚ å“åº”èšåˆï¼šå¦‚æœä¸€ä¸ªè¯·æ±‚éœ€è¦ä»å¤šä¸ªå¾®æœåŠ¡è·å–æ•°æ®ï¼ŒAPI ç½‘å…³å¯ä»¥å°†è¿™äº›è¯·æ±‚å‘é€ç»™ç›¸åº”çš„å¾®æœåŠ¡ï¼Œå¹¶å°†å®ƒä»¬çš„å“åº”èšåˆåˆ°ä¸€ä¸ªå“åº”ä¸­è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ ç¼“å­˜å’Œæ€§èƒ½ä¼˜åŒ–ï¼šAPI ç½‘å…³å¯ä»¥ç¼“å­˜å¸¸ç”¨çš„è¯·æ±‚å’Œå“åº”ï¼Œä»¥æé«˜æ€§èƒ½å¹¶å‡è½»åç«¯å¾®æœåŠ¡çš„è´Ÿè½½ã€‚ å®‰å…¨æ€§å’Œç›‘æ§ï¼šAPI ç½‘å…³å¯ä»¥å®æ–½å®‰å…¨ç­–ç•¥ï¼Œä¾‹å¦‚é˜²æ­¢æ¶æ„è¯·æ±‚å’Œ DDoS æ”»å‡»ã€‚å®ƒè¿˜å¯ä»¥ç›‘æ§è¯·æ±‚å’Œå“åº”ï¼Œæ”¶é›†åº”ç”¨ç¨‹åºçš„æŒ‡æ ‡å’Œæ—¥å¿—æ•°æ®ã€‚ ç¨‹åºç¤ºä¾‹\næ­¤å®ç°å±•ç¤ºäº†ç”µå­å•†åŠ¡ç«™ç‚¹çš„ API ç½‘å…³æ¨¡å¼ã€‚ ApiGatewayåˆ†åˆ«ä½¿ç”¨ ImageClientImplå’Œ PriceClientImplæ¥è°ƒç”¨ Image å’Œ Price å¾®æœåŠ¡ã€‚ åœ¨æ¡Œé¢è®¾å¤‡ä¸ŠæŸ¥çœ‹è¯¥ç½‘ç«™çš„å®¢æˆ·å¯ä»¥çœ‹åˆ°ä»·æ ¼ä¿¡æ¯å’Œäº§å“å›¾ç‰‡ï¼Œå› æ­¤ ApiGatewayä¼šè°ƒç”¨è¿™ä¸¤ç§å¾®æœåŠ¡å¹¶åœ¨DesktopProductæ¨¡å‹ä¸­æ±‡æ€»æ•°æ®ã€‚ ä½†æ˜¯ï¼Œç§»åŠ¨ç”¨æˆ·åªèƒ½çœ‹åˆ°ä»·æ ¼ä¿¡æ¯ã€‚ ä»–ä»¬çœ‹ä¸åˆ°äº§å“å›¾ç‰‡ã€‚ å¯¹äºç§»åŠ¨ç”¨æˆ·ï¼ŒApiGatewayä»…æ£€ç´¢ä»·æ ¼ä¿¡æ¯ï¼Œå¹¶å°†å…¶ç”¨äºå¡«å……MobileProductæ¨¡å‹ã€‚\nè¿™ä¸ªæ˜¯å›¾åƒå¾®æœåŠ¡çš„å®ç°ã€‚\npublic interface ImageClient { String getImagePath(); } public class ImageClientImpl implements ImageClient { @Override public String getImagePath() { var httpClient = HttpClient.newHttpClient(); var httpGet = HttpRequest.newBuilder() .","title":"Javaè®¾è®¡æ¨¡å¼ï¼šAPI Gateway "},{"content":"æœ¬æ–‡ä¸»è¦ä»‹ç» Arrange/Act/Assert æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nä»‹ç» Arrange/Act/Assertï¼ˆå®‰æ’/æ‰§è¡Œ/æ–­è¨€ï¼‰åˆç§° Given/When/Thenï¼Œæ˜¯ä¸€ç§æµ‹è¯•è®¾è®¡æ¨¡å¼ï¼Œç”¨äºç»„ç»‡å’Œç¼–å†™å•å…ƒæµ‹è¯•çš„ç»“æ„ã€‚å®ƒæä¾›äº†ä¸€ç§æ¸…æ™°çš„æµ‹è¯•å¸ƒå±€ï¼Œä½¿å¾—æµ‹è¯•ä»£ç æ˜“äºç†è§£å’Œç»´æŠ¤ã€‚\nè¯¥æ¨¡å¼çš„ä¸‰ä¸ªé˜¶æ®µå¦‚ä¸‹ï¼š\nArrangeï¼ˆå®‰æ’ï¼‰ï¼šåœ¨è¿™ä¸ªé˜¶æ®µï¼Œä½ å‡†å¤‡æµ‹è¯•ç¯å¢ƒå’Œè®¾ç½®æµ‹è¯•æ•°æ®ã€‚è¿™åŒ…æ‹¬åˆ›å»ºå¯¹è±¡ã€è®¾ç½®è¾“å…¥å‚æ•°ã€æ¨¡æ‹Ÿä¾èµ–é¡¹ç­‰ã€‚ä½ çš„ç›®æ ‡æ˜¯ä¸ºå°†è¦è¿›è¡Œçš„æµ‹è¯•åˆ›å»ºä¸€ä¸ªåˆé€‚çš„ç¯å¢ƒã€‚ Actï¼ˆæ‰§è¡Œï¼‰ï¼šåœ¨è¿™ä¸ªé˜¶æ®µï¼Œä½ æ‰§è¡Œè¦æµ‹è¯•çš„æ“ä½œæˆ–è°ƒç”¨è¦æµ‹è¯•çš„æ–¹æ³•ã€‚è¿™æ˜¯ä½ å¯¹è¢«æµ‹è¯•ä»£ç è¿›è¡Œå®é™…è°ƒç”¨çš„åœ°æ–¹ã€‚ Assertï¼ˆæ–­è¨€ï¼‰ï¼šåœ¨è¿™ä¸ªé˜¶æ®µï¼Œä½ éªŒè¯æµ‹è¯•çš„ç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚ä½ ä¼šæ£€æŸ¥å®é™…çš„è¾“å‡ºã€çŠ¶æ€å˜åŒ–æˆ–å¼‚å¸¸æƒ…å†µï¼Œå¹¶ä½¿ç”¨æ–­è¨€è¯­å¥æ¥æ–­è¨€æµ‹è¯•çš„æœŸæœ›ç»“æœã€‚ è¿™ç§æµ‹è¯•ç»“æ„çš„ä¼˜åŠ¿åœ¨äºå®ƒæä¾›äº†æ¸…æ™°çš„åˆ†ç¦»å’Œç»„ç»‡æµ‹è¯•ä»£ç çš„æ–¹å¼ï¼Œå¹¶ä½¿å¾—æµ‹è¯•çš„ç›®çš„å’Œé¢„æœŸç»“æœæ›´å®¹æ˜“ç†è§£ã€‚å®ƒä¹Ÿæœ‰åŠ©äºå‡å°‘æµ‹è¯•ä»£ç ä¸­çš„é‡å¤å’Œå†—ä½™ã€‚\nä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ Arrange/Act/Assert æ¨¡å¼ç¼–å†™çš„ç¤ºä¾‹æµ‹è¯•æ–¹æ³•çš„ä¼ªä»£ç ï¼š\npublic void testCalculateTotalPrice() { // Arrange ShoppingCart cart = new ShoppingCart(); cart.addItem(new Item(\u0026#34;Item 1\u0026#34;, 10.0)); cart.addItem(new Item(\u0026#34;Item 2\u0026#34;, 15.0)); // Act double totalPrice = cart.calculateTotalPrice(); // Assert assertEquals(25.0, totalPrice, 0.01); } åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œé¦–å…ˆåœ¨ Arrange é˜¶æ®µåˆ›å»ºäº†ä¸€ä¸ªè´­ç‰©è½¦å¯¹è±¡ï¼Œå¹¶æ·»åŠ äº†ä¸¤ä¸ªå•†å“ã€‚ç„¶åï¼Œåœ¨ Act é˜¶æ®µè°ƒç”¨äº†calculateTotalPrice()æ–¹æ³•æ¥è®¡ç®—æ€»ä»·æ ¼ã€‚æœ€åï¼Œåœ¨ Assert é˜¶æ®µä½¿ç”¨æ–­è¨€è¯­å¥æ¥éªŒè¯è®¡ç®—çš„ç»“æœæ˜¯å¦ç­‰äºé¢„æœŸçš„æ€»ä»·æ ¼ã€‚\né€‚ç”¨æ€§ Arrange/Act/Assertï¼ˆå®‰æ’/æ‰§è¡Œ/æ–­è¨€ï¼‰è®¾è®¡æ¨¡å¼é€‚ç”¨äºç¼–å†™å•å…ƒæµ‹è¯•ï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹å‡½æ•°ã€æ–¹æ³•æˆ–ç±»çš„å•å…ƒæµ‹è¯•ã€‚å®ƒåœ¨ä»¥ä¸‹æƒ…å†µä¸‹ç‰¹åˆ«æœ‰ç”¨ï¼š\nå•å…ƒæµ‹è¯•ï¼šArrange/Act/Assert æ¨¡å¼é€‚ç”¨äºå¯¹å•ä¸ªå‡½æ•°æˆ–æ–¹æ³•è¿›è¡Œæµ‹è¯•ã€‚å®ƒå¸®åŠ©ä½ ç»„ç»‡æµ‹è¯•ä»£ç ï¼Œä½¿å…¶ç»“æ„æ¸…æ™°ï¼Œå¹¶ç¡®ä¿æ¯ä¸ªæµ‹è¯•åªå…³æ³¨ä¸€ä¸ªç‰¹å®šçš„åŠŸèƒ½æˆ–è¡Œä¸ºã€‚ æ˜“äºç†è§£å’Œç»´æŠ¤ï¼šè¿™ç§æ¨¡å¼æä¾›äº†ä¸€ç§ä¸€è‡´çš„æµ‹è¯•ç»“æ„ï¼Œä½¿å¾—æµ‹è¯•ä»£ç æ˜“äºç†è§£å’Œç»´æŠ¤ã€‚é€šè¿‡æ˜ç¡®çš„å®‰æ’ã€æ‰§è¡Œå’Œæ–­è¨€é˜¶æ®µï¼Œä½ å¯ä»¥æ›´æ¸…æ¥šåœ°äº†è§£æµ‹è¯•çš„ç›®çš„å’Œé¢„æœŸç»“æœã€‚ æµ‹è¯•ä»£ç å¯è¯»æ€§ï¼šArrange/Act/Assert æ¨¡å¼å¯ä»¥ä½¿æµ‹è¯•ä»£ç æ›´å…·å¯è¯»æ€§ã€‚é€šè¿‡æŒ‰ç…§ç»Ÿä¸€çš„ç»“æ„ç»„ç»‡æµ‹è¯•ä»£ç ï¼Œä½¿å¾—æµ‹è¯•é€»è¾‘æ›´åŠ æ¸…æ™°å¯è§ï¼Œæ˜“äºä»–äººç†è§£å’Œå‚ä¸ã€‚ æé«˜å¯ç»´æŠ¤æ€§ï¼šä½¿ç”¨è¿™ç§æ¨¡å¼å¯ä»¥å‡å°‘æµ‹è¯•ä»£ç ä¸­çš„é‡å¤å’Œå†—ä½™ï¼Œä½¿å¾—æµ‹è¯•ä»£ç æ›´æ˜“äºç»´æŠ¤ã€‚åœ¨ Arrange é˜¶æ®µè®¾ç½®æµ‹è¯•ç¯å¢ƒå’Œå‡†å¤‡æ•°æ®ï¼Œå¯ä»¥å‡å°‘åœ¨æ¯ä¸ªæµ‹è¯•ä¸­é‡å¤çš„ä»£ç ã€‚ æµ‹è¯•ç»“æœéªŒè¯ï¼šArrange/Act/Assert æ¨¡å¼æ˜ç¡®äº†æµ‹è¯•ç»“æœçš„éªŒè¯è¿‡ç¨‹ã€‚åœ¨ Assert é˜¶æ®µä½¿ç”¨æ–­è¨€è¯­å¥æ¥éªŒè¯å®é™…ç»“æœä¸é¢„æœŸç»“æœçš„ä¸€è‡´æ€§ï¼Œå¸®åŠ©ä½ ç¡®ä¿è¢«æµ‹è¯•ä»£ç çš„æ­£ç¡®æ€§ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒArrange/Act/Assert æ¨¡å¼ä¸»è¦é€‚ç”¨äºå•å…ƒæµ‹è¯•ï¼Œè€Œå¯¹äºé›†æˆæµ‹è¯•æˆ–ç«¯åˆ°ç«¯æµ‹è¯•ç­‰æ›´å¤§èŒƒå›´çš„æµ‹è¯•ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨å…¶ä»–æµ‹è¯•è®¾è®¡æ¨¡å¼æˆ–æ¡†æ¶æ¥è¿›è¡Œç»„ç»‡å’Œç®¡ç†æµ‹è¯•ä»£ç ã€‚\né™¤äº† Arrange/Act/Assert æ¨¡å¼ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›é€‚ç”¨äºé›†æˆæµ‹è¯•æˆ–ç«¯åˆ°ç«¯æµ‹è¯•çš„è®¾è®¡æ¨¡å¼æˆ–æ¡†æ¶ï¼š\nPage Object æ¨¡å¼ï¼šPage Object æ¨¡å¼æ˜¯ä¸€ç§ç”¨äºç®¡ç†ç”¨æˆ·ç•Œé¢å…ƒç´ å’Œæ“ä½œçš„è®¾è®¡æ¨¡å¼ã€‚å®ƒå°†é¡µé¢çš„å…ƒç´ å’Œæ“ä½œå°è£…åˆ°å¯é‡ç”¨çš„å¯¹è±¡ä¸­ï¼Œä½¿å¾—æµ‹è¯•ä»£ç æ›´å…·å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚Page Object æ¨¡å¼ç‰¹åˆ«é€‚ç”¨äº Web åº”ç”¨ç¨‹åºçš„ç«¯åˆ°ç«¯æµ‹è¯•ã€‚ æ•°æ®æ„å»ºå™¨æ¨¡å¼ï¼šæ•°æ®æ„å»ºå™¨æ¨¡å¼ç”¨äºç”Ÿæˆæµ‹è¯•æ•°æ®ï¼Œä»¥ä¾¿åœ¨é›†æˆæµ‹è¯•æˆ–ç«¯åˆ°ç«¯æµ‹è¯•ä¸­ä½¿ç”¨ã€‚å®ƒæä¾›äº†ä¸€ç§çµæ´»çš„æ–¹å¼æ¥åˆ›å»ºæµ‹è¯•æ•°æ®ï¼ŒåŒ…æ‹¬å¤æ‚çš„æ•°æ®ç»“æ„å’Œå…³è”å…³ç³»ã€‚ æ•°æ®å‡†å¤‡å’Œæ¸…ç†æ¨¡å¼ï¼šåœ¨é›†æˆæµ‹è¯•æˆ–ç«¯åˆ°ç«¯æµ‹è¯•ä¸­ï¼Œé€šå¸¸éœ€è¦å‡†å¤‡æµ‹è¯•æ•°æ®å’Œç¯å¢ƒï¼Œå¹¶åœ¨æµ‹è¯•å®Œæˆåè¿›è¡Œæ¸…ç†ã€‚æ•°æ®å‡†å¤‡å’Œæ¸…ç†æ¨¡å¼æä¾›äº†ä¸€ç§ç»“æ„åŒ–çš„æ–¹æ³•æ¥ç®¡ç†è¿™äº›æ“ä½œï¼Œç¡®ä¿æµ‹è¯•çš„ä¸€è‡´æ€§å’Œå¯é‡å¤æ€§ã€‚ Mock å¯¹è±¡æ¨¡å¼ï¼šMock å¯¹è±¡æ¨¡å¼ç”¨äºæ¨¡æ‹Ÿæˆ–æ›¿ä»£å¤–éƒ¨ä¾èµ–é¡¹ï¼Œä»¥ä¾¿è¿›è¡Œé›†æˆæµ‹è¯•æˆ–ç«¯åˆ°ç«¯æµ‹è¯•ã€‚é€šè¿‡ä½¿ç”¨ Mock å¯¹è±¡ï¼Œä½ å¯ä»¥éš”ç¦»è¢«æµ‹è¯•ä»£ç ä¸å¤–éƒ¨ç³»ç»Ÿçš„äº¤äº’ï¼Œä½¿å¾—æµ‹è¯•æ›´åŠ å¯æ§å’Œç‹¬ç«‹ã€‚ BDDï¼ˆè¡Œä¸ºé©±åŠ¨å¼€å‘ï¼‰æ¡†æ¶ï¼šBDD æ¡†æ¶ï¼ˆå¦‚ Cucumberã€SpecFlow ç­‰ï¼‰æä¾›äº†ä¸€ç§ä»¥è‡ªç„¶è¯­è¨€ç¼–å†™æµ‹è¯•ç”¨ä¾‹å’Œè§„èŒƒçš„æ–¹å¼ã€‚å®ƒå°†æµ‹è¯•ç”¨ä¾‹æè¿°ä¸ºå¯è¯»æ€§å¼ºçš„åœºæ™¯å’Œæ­¥éª¤ï¼Œå¸®åŠ©å¼€å‘äººå‘˜ã€æµ‹è¯•äººå‘˜å’Œä¸šåŠ¡åˆ©ç›Šç›¸å…³è€…ä¹‹é—´çš„æ²Ÿé€šå’Œç†è§£ã€‚ å‚è€ƒ Arrange, Act, Assert: What is AAA Testing? Bill Wake: 3A â€“ Arrange, Act, Assert Martin Fowler: GivenWhenThen xUnit Test Patterns: Refactoring Test Code Unit Testing Principles, Practices, and Patterns Test Driven Development: By Example ","permalink":"https://blog.chensoul.cc/posts/2023/08/13/java-design-patterns-arrange-act-assert/","summary":"æœ¬æ–‡ä¸»è¦ä»‹ç» Arrange/Act/Assert æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nä»‹ç» Arrange/Act/Assertï¼ˆå®‰æ’/æ‰§è¡Œ/æ–­è¨€ï¼‰åˆç§° Given/When/Thenï¼Œæ˜¯ä¸€ç§æµ‹è¯•è®¾è®¡æ¨¡å¼ï¼Œç”¨äºç»„ç»‡å’Œç¼–å†™å•å…ƒæµ‹è¯•çš„ç»“æ„ã€‚å®ƒæä¾›äº†ä¸€ç§æ¸…æ™°çš„æµ‹è¯•å¸ƒå±€ï¼Œä½¿å¾—æµ‹è¯•ä»£ç æ˜“äºç†è§£å’Œç»´æŠ¤ã€‚\nè¯¥æ¨¡å¼çš„ä¸‰ä¸ªé˜¶æ®µå¦‚ä¸‹ï¼š\nArrangeï¼ˆå®‰æ’ï¼‰ï¼šåœ¨è¿™ä¸ªé˜¶æ®µï¼Œä½ å‡†å¤‡æµ‹è¯•ç¯å¢ƒå’Œè®¾ç½®æµ‹è¯•æ•°æ®ã€‚è¿™åŒ…æ‹¬åˆ›å»ºå¯¹è±¡ã€è®¾ç½®è¾“å…¥å‚æ•°ã€æ¨¡æ‹Ÿä¾èµ–é¡¹ç­‰ã€‚ä½ çš„ç›®æ ‡æ˜¯ä¸ºå°†è¦è¿›è¡Œçš„æµ‹è¯•åˆ›å»ºä¸€ä¸ªåˆé€‚çš„ç¯å¢ƒã€‚ Actï¼ˆæ‰§è¡Œï¼‰ï¼šåœ¨è¿™ä¸ªé˜¶æ®µï¼Œä½ æ‰§è¡Œè¦æµ‹è¯•çš„æ“ä½œæˆ–è°ƒç”¨è¦æµ‹è¯•çš„æ–¹æ³•ã€‚è¿™æ˜¯ä½ å¯¹è¢«æµ‹è¯•ä»£ç è¿›è¡Œå®é™…è°ƒç”¨çš„åœ°æ–¹ã€‚ Assertï¼ˆæ–­è¨€ï¼‰ï¼šåœ¨è¿™ä¸ªé˜¶æ®µï¼Œä½ éªŒè¯æµ‹è¯•çš„ç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚ä½ ä¼šæ£€æŸ¥å®é™…çš„è¾“å‡ºã€çŠ¶æ€å˜åŒ–æˆ–å¼‚å¸¸æƒ…å†µï¼Œå¹¶ä½¿ç”¨æ–­è¨€è¯­å¥æ¥æ–­è¨€æµ‹è¯•çš„æœŸæœ›ç»“æœã€‚ è¿™ç§æµ‹è¯•ç»“æ„çš„ä¼˜åŠ¿åœ¨äºå®ƒæä¾›äº†æ¸…æ™°çš„åˆ†ç¦»å’Œç»„ç»‡æµ‹è¯•ä»£ç çš„æ–¹å¼ï¼Œå¹¶ä½¿å¾—æµ‹è¯•çš„ç›®çš„å’Œé¢„æœŸç»“æœæ›´å®¹æ˜“ç†è§£ã€‚å®ƒä¹Ÿæœ‰åŠ©äºå‡å°‘æµ‹è¯•ä»£ç ä¸­çš„é‡å¤å’Œå†—ä½™ã€‚\nä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ Arrange/Act/Assert æ¨¡å¼ç¼–å†™çš„ç¤ºä¾‹æµ‹è¯•æ–¹æ³•çš„ä¼ªä»£ç ï¼š\npublic void testCalculateTotalPrice() { // Arrange ShoppingCart cart = new ShoppingCart(); cart.addItem(new Item(\u0026#34;Item 1\u0026#34;, 10.0)); cart.addItem(new Item(\u0026#34;Item 2\u0026#34;, 15.0)); // Act double totalPrice = cart.calculateTotalPrice(); // Assert assertEquals(25.0, totalPrice, 0.01); } åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œé¦–å…ˆåœ¨ Arrange é˜¶æ®µåˆ›å»ºäº†ä¸€ä¸ªè´­ç‰©è½¦å¯¹è±¡ï¼Œå¹¶æ·»åŠ äº†ä¸¤ä¸ªå•†å“ã€‚ç„¶åï¼Œåœ¨ Act é˜¶æ®µè°ƒç”¨äº†calculateTotalPrice()æ–¹æ³•æ¥è®¡ç®—æ€»ä»·æ ¼ã€‚æœ€åï¼Œåœ¨ Assert é˜¶æ®µä½¿ç”¨æ–­è¨€è¯­å¥æ¥éªŒè¯è®¡ç®—çš„ç»“æœæ˜¯å¦ç­‰äºé¢„æœŸçš„æ€»ä»·æ ¼ã€‚\né€‚ç”¨æ€§ Arrange/Act/Assertï¼ˆå®‰æ’/æ‰§è¡Œ/æ–­è¨€ï¼‰è®¾è®¡æ¨¡å¼é€‚ç”¨äºç¼–å†™å•å…ƒæµ‹è¯•ï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹å‡½æ•°ã€æ–¹æ³•æˆ–ç±»çš„å•å…ƒæµ‹è¯•ã€‚å®ƒåœ¨ä»¥ä¸‹æƒ…å†µä¸‹ç‰¹åˆ«æœ‰ç”¨ï¼š\nå•å…ƒæµ‹è¯•ï¼šArrange/Act/Assert æ¨¡å¼é€‚ç”¨äºå¯¹å•ä¸ªå‡½æ•°æˆ–æ–¹æ³•è¿›è¡Œæµ‹è¯•ã€‚å®ƒå¸®åŠ©ä½ ç»„ç»‡æµ‹è¯•ä»£ç ï¼Œä½¿å…¶ç»“æ„æ¸…æ™°ï¼Œå¹¶ç¡®ä¿æ¯ä¸ªæµ‹è¯•åªå…³æ³¨ä¸€ä¸ªç‰¹å®šçš„åŠŸèƒ½æˆ–è¡Œä¸ºã€‚ æ˜“äºç†è§£å’Œç»´æŠ¤ï¼šè¿™ç§æ¨¡å¼æä¾›äº†ä¸€ç§ä¸€è‡´çš„æµ‹è¯•ç»“æ„ï¼Œä½¿å¾—æµ‹è¯•ä»£ç æ˜“äºç†è§£å’Œç»´æŠ¤ã€‚é€šè¿‡æ˜ç¡®çš„å®‰æ’ã€æ‰§è¡Œå’Œæ–­è¨€é˜¶æ®µï¼Œä½ å¯ä»¥æ›´æ¸…æ¥šåœ°äº†è§£æµ‹è¯•çš„ç›®çš„å’Œé¢„æœŸç»“æœã€‚ æµ‹è¯•ä»£ç å¯è¯»æ€§ï¼šArrange/Act/Assert æ¨¡å¼å¯ä»¥ä½¿æµ‹è¯•ä»£ç æ›´å…·å¯è¯»æ€§ã€‚é€šè¿‡æŒ‰ç…§ç»Ÿä¸€çš„ç»“æ„ç»„ç»‡æµ‹è¯•ä»£ç ï¼Œä½¿å¾—æµ‹è¯•é€»è¾‘æ›´åŠ æ¸…æ™°å¯è§ï¼Œæ˜“äºä»–äººç†è§£å’Œå‚ä¸ã€‚ æé«˜å¯ç»´æŠ¤æ€§ï¼šä½¿ç”¨è¿™ç§æ¨¡å¼å¯ä»¥å‡å°‘æµ‹è¯•ä»£ç ä¸­çš„é‡å¤å’Œå†—ä½™ï¼Œä½¿å¾—æµ‹è¯•ä»£ç æ›´æ˜“äºç»´æŠ¤ã€‚åœ¨ Arrange é˜¶æ®µè®¾ç½®æµ‹è¯•ç¯å¢ƒå’Œå‡†å¤‡æ•°æ®ï¼Œå¯ä»¥å‡å°‘åœ¨æ¯ä¸ªæµ‹è¯•ä¸­é‡å¤çš„ä»£ç ã€‚ æµ‹è¯•ç»“æœéªŒè¯ï¼šArrange/Act/Assert æ¨¡å¼æ˜ç¡®äº†æµ‹è¯•ç»“æœçš„éªŒè¯è¿‡ç¨‹ã€‚åœ¨ Assert é˜¶æ®µä½¿ç”¨æ–­è¨€è¯­å¥æ¥éªŒè¯å®é™…ç»“æœä¸é¢„æœŸç»“æœçš„ä¸€è‡´æ€§ï¼Œå¸®åŠ©ä½ ç¡®ä¿è¢«æµ‹è¯•ä»£ç çš„æ­£ç¡®æ€§ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒArrange/Act/Assert æ¨¡å¼ä¸»è¦é€‚ç”¨äºå•å…ƒæµ‹è¯•ï¼Œè€Œå¯¹äºé›†æˆæµ‹è¯•æˆ–ç«¯åˆ°ç«¯æµ‹è¯•ç­‰æ›´å¤§èŒƒå›´çš„æµ‹è¯•ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨å…¶ä»–æµ‹è¯•è®¾è®¡æ¨¡å¼æˆ–æ¡†æ¶æ¥è¿›è¡Œç»„ç»‡å’Œç®¡ç†æµ‹è¯•ä»£ç ã€‚\né™¤äº† Arrange/Act/Assert æ¨¡å¼ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›é€‚ç”¨äºé›†æˆæµ‹è¯•æˆ–ç«¯åˆ°ç«¯æµ‹è¯•çš„è®¾è®¡æ¨¡å¼æˆ–æ¡†æ¶ï¼š\nPage Object æ¨¡å¼ï¼šPage Object æ¨¡å¼æ˜¯ä¸€ç§ç”¨äºç®¡ç†ç”¨æˆ·ç•Œé¢å…ƒç´ å’Œæ“ä½œçš„è®¾è®¡æ¨¡å¼ã€‚å®ƒå°†é¡µé¢çš„å…ƒç´ å’Œæ“ä½œå°è£…åˆ°å¯é‡ç”¨çš„å¯¹è±¡ä¸­ï¼Œä½¿å¾—æµ‹è¯•ä»£ç æ›´å…·å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚Page Object æ¨¡å¼ç‰¹åˆ«é€‚ç”¨äº Web åº”ç”¨ç¨‹åºçš„ç«¯åˆ°ç«¯æµ‹è¯•ã€‚ æ•°æ®æ„å»ºå™¨æ¨¡å¼ï¼šæ•°æ®æ„å»ºå™¨æ¨¡å¼ç”¨äºç”Ÿæˆæµ‹è¯•æ•°æ®ï¼Œä»¥ä¾¿åœ¨é›†æˆæµ‹è¯•æˆ–ç«¯åˆ°ç«¯æµ‹è¯•ä¸­ä½¿ç”¨ã€‚å®ƒæä¾›äº†ä¸€ç§çµæ´»çš„æ–¹å¼æ¥åˆ›å»ºæµ‹è¯•æ•°æ®ï¼ŒåŒ…æ‹¬å¤æ‚çš„æ•°æ®ç»“æ„å’Œå…³è”å…³ç³»ã€‚ æ•°æ®å‡†å¤‡å’Œæ¸…ç†æ¨¡å¼ï¼šåœ¨é›†æˆæµ‹è¯•æˆ–ç«¯åˆ°ç«¯æµ‹è¯•ä¸­ï¼Œé€šå¸¸éœ€è¦å‡†å¤‡æµ‹è¯•æ•°æ®å’Œç¯å¢ƒï¼Œå¹¶åœ¨æµ‹è¯•å®Œæˆåè¿›è¡Œæ¸…ç†ã€‚æ•°æ®å‡†å¤‡å’Œæ¸…ç†æ¨¡å¼æä¾›äº†ä¸€ç§ç»“æ„åŒ–çš„æ–¹æ³•æ¥ç®¡ç†è¿™äº›æ“ä½œï¼Œç¡®ä¿æµ‹è¯•çš„ä¸€è‡´æ€§å’Œå¯é‡å¤æ€§ã€‚ Mock å¯¹è±¡æ¨¡å¼ï¼šMock å¯¹è±¡æ¨¡å¼ç”¨äºæ¨¡æ‹Ÿæˆ–æ›¿ä»£å¤–éƒ¨ä¾èµ–é¡¹ï¼Œä»¥ä¾¿è¿›è¡Œé›†æˆæµ‹è¯•æˆ–ç«¯åˆ°ç«¯æµ‹è¯•ã€‚é€šè¿‡ä½¿ç”¨ Mock å¯¹è±¡ï¼Œä½ å¯ä»¥éš”ç¦»è¢«æµ‹è¯•ä»£ç ä¸å¤–éƒ¨ç³»ç»Ÿçš„äº¤äº’ï¼Œä½¿å¾—æµ‹è¯•æ›´åŠ å¯æ§å’Œç‹¬ç«‹ã€‚ BDDï¼ˆè¡Œä¸ºé©±åŠ¨å¼€å‘ï¼‰æ¡†æ¶ï¼šBDD æ¡†æ¶ï¼ˆå¦‚ Cucumberã€SpecFlow ç­‰ï¼‰æä¾›äº†ä¸€ç§ä»¥è‡ªç„¶è¯­è¨€ç¼–å†™æµ‹è¯•ç”¨ä¾‹å’Œè§„èŒƒçš„æ–¹å¼ã€‚å®ƒå°†æµ‹è¯•ç”¨ä¾‹æè¿°ä¸ºå¯è¯»æ€§å¼ºçš„åœºæ™¯å’Œæ­¥éª¤ï¼Œå¸®åŠ©å¼€å‘äººå‘˜ã€æµ‹è¯•äººå‘˜å’Œä¸šåŠ¡åˆ©ç›Šç›¸å…³è€…ä¹‹é—´çš„æ²Ÿé€šå’Œç†è§£ã€‚ å‚è€ƒ Arrange, Act, Assert: What is AAA Testing?","title":"Javaè®¾è®¡æ¨¡å¼ï¼šArrange/Act/Assert"},{"content":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-07-10 åˆ° 2023-07-16 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¯»ä¹¦ã€å¥èº«ã€æŠ•èµ„ã€å¸®æœ‹å‹ã€é™ªå®¶äººã€‚\nè¿™æ˜¯æˆ‘çš„ç¬¬ 27 ç¯‡å‘¨æŠ¥ï¼Œç”±äºå·¥ä½œçš„åŸå› ï¼Œå‰ä¸¤å‘¨çš„å‘¨æŠ¥æ˜¯ä¸€èµ·å‘å¸ƒçš„ï¼Œæ‰€ä»¥ç¬¬ 27 ç¯‡å‘¨æŠ¥è¢«è·³è¿‡å»äº†ã€‚\næŠ€æœ¯æ–‡æ¡£èŒƒä¾‹ ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ä¸­æ–‡æ ‡é¢˜çš„æŠ€æœ¯æ–‡æ¡£èŒƒä¾‹ï¼š\nä¸€ã€ä»‹ç» 1.1 ç›®çš„ 1.2 èŒƒå›´ 1.3 å—ä¼— 1.4 å®šä¹‰ã€ç¼©ç•¥è¯­å’Œæœ¯è¯­ äºŒã€æ¦‚è¿° 2.1 ç³»ç»Ÿæ¶æ„ 2.2 ä¸»è¦åŠŸèƒ½ 2.3 ç³»ç»Ÿè¦æ±‚ ä¸‰ã€å…¥é—¨æŒ‡å— 3.1 å®‰è£… 3.2 é…ç½® 3.3 ç¬¬ä¸€æ­¥æ“ä½œ å››ã€ç”¨æˆ·æŒ‡å— 4.1 ç”¨æˆ·ç•Œé¢ 4.2 å¯¼èˆª 4.3 åŠŸèƒ½ äº”ã€ç®¡ç†æŒ‡å— 5.1 ç³»ç»Ÿé…ç½® 5.2 ç”¨æˆ·ç®¡ç† 5.3 å®‰å…¨æ€§ å…­ã€æ•…éšœæ’é™¤ 6.1 å¸¸è§é—®é¢˜ 6.2 é”™è¯¯æ¶ˆæ¯ ä¸ƒã€é™„å½• 7.1 å‘è¡Œè¯´æ˜ 7.2 æœ¯è¯­è¡¨ 7.3 å‚è€ƒæ–‡çŒ® ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨æ•°å­—æ ‡é¢˜çš„ Spring Cloud Gateway æ•™ç¨‹ç¤ºä¾‹ï¼š\n1. ä»‹ç» 1.1 ç›®çš„ 1.2 èŒƒå›´ 1.3 å—ä¼— 1.4 æœ¯è¯­å’Œå®šä¹‰ 2. æ¦‚è¿° 2.1 ä»€ä¹ˆæ˜¯ Spring Cloud Gateway 2.2 Spring Cloud Gateway çš„ä¼˜åŠ¿ 3. å¿«é€Ÿå…¥é—¨ 3.1 ç¯å¢ƒé…ç½® 3.2 åˆ›å»ºSpring Cloud Gatewayé¡¹ç›® 3.3 é…ç½®è·¯ç”±è§„åˆ™ 3.4 è¿è¡Œå’Œæµ‹è¯• 4. è·¯ç”±é…ç½® 4.1 URIè·¯ç”± 4.2 æ–­è¨€è·¯ç”± 4.3 è¿‡æ»¤å™¨ 5. é«˜çº§ç‰¹æ€§ 5.1 ç†”æ–­å™¨ 5.2 é™æµ 5.3 æ—¥å¿—å’Œç›‘æ§ 6. éƒ¨ç½²å’Œç®¡ç† 6.1 éƒ¨ç½²é€‰é¡¹ 6.2 å®¹å™¨åŒ–éƒ¨ç½² 6.3 ç®¡ç†å’Œç›‘æ§ 7. æ•…éšœæ’é™¤ 7.1 å¸¸è§é—®é¢˜ 7.2 æ—¥å¿—åˆ†æ 8. æ€»ç»“å’Œå‚è€ƒèµ„æ–™ 8.1 æ€»ç»“ 8.2 å‚è€ƒèµ„æ–™ è¯»ä¹¦ å¥èº« æˆ‘è·‘è¿‡äº†ä¸€äº›åœ°æ–¹ï¼Œå¸Œæœ›éšç€æ—¶é—´æ¨ç§»ï¼Œåœ°å›¾ç‚¹äº®çš„åœ°æ–¹è¶Šæ¥è¶Šå¤šã€‚2 å¹´é‡Œæˆ‘è·‘è¿‡ 2 ä¸ªçœä»½ 2 ä¸ªåŸå¸‚ã€‚æ›´å¤šè·‘æ­¥æ•°æ®åœ¨æˆ‘çš„ è·‘æ­¥ ä¸»é¡µã€‚\nç†è´¢ è¿™å‘¨æ€»è®¡æ”¯å‡º 5006 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š\n7 æœˆ 16 æ—¥ï¼š4057 å…ƒï¼Œçˆ¶äº²å‡ºé™¢æ”¯ä»˜ 3475 å…ƒ\n7 æœˆ 15 æ—¥ï¼š108 å…ƒ\n7 æœˆ 14 æ—¥ï¼š86 å…ƒ\n7 æœˆ 13 æ—¥ï¼š367 å…ƒ\n7 æœˆ 12 æ—¥ï¼š179 å…ƒ\n7 æœˆ 11 æ—¥ï¼š117 å…ƒ\n7 æœˆ 10 æ—¥ï¼š92 å…ƒ\né™ªå®¶äºº å·¥ä½œ æœ€è¿‘åœ¨å­¦ä¹ çš„å†…å®¹æ¸…å•ï¼š\nEffective Javaï¼ˆç¬¬ 3 ç‰ˆï¼‰ Java Design Patterns (ä¸­æ–‡) Real Python æœ¬å‘¨å®Œæˆä¸€ç¯‡åšå®¢ï¼š\n[è¯‘]ä½¿ç”¨ Spring Boot2 å’Œ Spring Security 5 ä»¥åŠ JDBC ä»¤ç‰Œå­˜å‚¨è¿›è¡Œ Oauth2 é›†ä¸­æˆæƒ æœ¬å‘¨åˆ†äº« å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€ChenSoul Shareã€Telegram é¢‘é“æˆ–è€…æˆ‘çš„ Memos ä¸­ã€‚æˆ‘å†™äº†ä¸€ä¸ª Python è„šæœ¬ä» Memos è¯»å–æœ€è¿‘ä¸€å‘¨å¸¦æœ‰ #memos æ ‡ç­¾çš„è®°å½•ï¼Œåˆ†äº«åˆ°è¿™é‡Œã€‚\nğŸ“Œ2023-07-15 Mysql update è¯­å¥ä½¿ç”¨å­æŸ¥è¯¢ | CHEGVA #memos https://chegva.com/5744.html\nğŸ“Œ2023-07-15 ä¸€ç¯‡ã€ŠOAuth2 æ¦‚è¿°ã€‹ï¼ˆè‹±æ–‡ï¼‰ï¼Œåœ¨å¾ˆçŸ­çš„ç¯‡å¹…é‡Œé¢ï¼Œæ¸…æ¥šåœ°ä»‹ç»äº† OAuthã€‚#memos https://metacpan.org/dist/LWP-Authen-OAuth2/view/lib/LWP/Authen/OAuth2/Overview.pod\nğŸ“Œ2023-07-15 æ‹¥æŠ± TypeScript çš„å†ç¨‹ | Usubeni Fantasy#memos https://ssshooter.com/typescript-tittle-tattle/\nğŸ“Œ2023-07-15 ä¸€ä¸ªç‹¬ç«‹åˆ›é€ è€…çš„äº”å¹´#memos http://hawstein.com/2023/07/12/five-years-of-an-indie-hacker/\nğŸ“Œ2023-07-15 ä¸€ä¸ªçŸ­é“¾æ¥æµè§ˆå™¨æ‰©å±•æ’ä»¶ï¼Œæœˆæ”¶å…¥ 2.6K ç¾é‡‘ #memos https://www.ezindie.com/weekly/issue-95\nğŸ“Œ2023-07-15 é…ç½®è½»é‡çº§ Linux è¿œç¨‹å¼€å‘ç¯å¢ƒï¼ˆFedora 38ï¼‰#memos https://rook1e.com/p/lightweight-remote-linux-devenv-fedora38/\nğŸ“Œ2023-07-11 React Design Patterns #memos https://anuradha.hashnode.dev/react-design-patterns\nğŸ“Œ2023-07-11 æ¨èï¼šéå¸¸è¯¦ç»†çš„ vite å¼€å‘ç¬”è®°ï¼ˆ7k å­—ï¼‰#memos https://juejin.cn/post/7251873578157113401\nä»¥ä¸Šã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/07/27/weekly_review_28/","summary":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-07-10 åˆ° 2023-07-16 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¯»ä¹¦ã€å¥èº«ã€æŠ•èµ„ã€å¸®æœ‹å‹ã€é™ªå®¶äººã€‚\nè¿™æ˜¯æˆ‘çš„ç¬¬ 27 ç¯‡å‘¨æŠ¥ï¼Œç”±äºå·¥ä½œçš„åŸå› ï¼Œå‰ä¸¤å‘¨çš„å‘¨æŠ¥æ˜¯ä¸€èµ·å‘å¸ƒçš„ï¼Œæ‰€ä»¥ç¬¬ 27 ç¯‡å‘¨æŠ¥è¢«è·³è¿‡å»äº†ã€‚\næŠ€æœ¯æ–‡æ¡£èŒƒä¾‹ ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ä¸­æ–‡æ ‡é¢˜çš„æŠ€æœ¯æ–‡æ¡£èŒƒä¾‹ï¼š\nä¸€ã€ä»‹ç» 1.1 ç›®çš„ 1.2 èŒƒå›´ 1.3 å—ä¼— 1.4 å®šä¹‰ã€ç¼©ç•¥è¯­å’Œæœ¯è¯­ äºŒã€æ¦‚è¿° 2.1 ç³»ç»Ÿæ¶æ„ 2.2 ä¸»è¦åŠŸèƒ½ 2.3 ç³»ç»Ÿè¦æ±‚ ä¸‰ã€å…¥é—¨æŒ‡å— 3.1 å®‰è£… 3.2 é…ç½® 3.3 ç¬¬ä¸€æ­¥æ“ä½œ å››ã€ç”¨æˆ·æŒ‡å— 4.1 ç”¨æˆ·ç•Œé¢ 4.2 å¯¼èˆª 4.3 åŠŸèƒ½ äº”ã€ç®¡ç†æŒ‡å— 5.1 ç³»ç»Ÿé…ç½® 5.2 ç”¨æˆ·ç®¡ç† 5.3 å®‰å…¨æ€§ å…­ã€æ•…éšœæ’é™¤ 6.1 å¸¸è§é—®é¢˜ 6.2 é”™è¯¯æ¶ˆæ¯ ä¸ƒã€é™„å½• 7.1 å‘è¡Œè¯´æ˜ 7.2 æœ¯è¯­è¡¨ 7.3 å‚è€ƒæ–‡çŒ® ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨æ•°å­—æ ‡é¢˜çš„ Spring Cloud Gateway æ•™ç¨‹ç¤ºä¾‹ï¼š\n1. ä»‹ç» 1.1 ç›®çš„ 1.2 èŒƒå›´ 1.3 å—ä¼— 1.4 æœ¯è¯­å’Œå®šä¹‰ 2. æ¦‚è¿° 2.1 ä»€ä¹ˆæ˜¯ Spring Cloud Gateway 2.2 Spring Cloud Gateway çš„ä¼˜åŠ¿ 3. å¿«é€Ÿå…¥é—¨ 3.1 ç¯å¢ƒé…ç½® 3.2 åˆ›å»ºSpring Cloud Gatewayé¡¹ç›® 3.3 é…ç½®è·¯ç”±è§„åˆ™ 3.","title":"å‘¨æŠ¥-28ï½œæŠ€æœ¯æ–‡æ¡£èŒƒä¾‹"},{"content":"æ¦‚è¿° åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæˆæƒæœåŠ¡å™¨ï¼Œä¸ºä»»ä½•å®¢æˆ·ç«¯ç”Ÿæˆ access_tokenã€‚è¿™ç§°ä¸º OAuth2 çš„ client_credentials æµç¨‹ã€‚å®ƒä¸»è¦ç”¨äºæœåŠ¡é—´é€šä¿¡ã€‚\næˆ‘ä»¬å°†ä½¿ç”¨ spring boot oauth2 æˆæƒæœåŠ¡å™¨ä¾èµ–é¡¹æ¥åˆ›å»ºèº«ä»½éªŒè¯æœåŠ¡å™¨ã€‚æˆ‘ä»¬è¿˜å°†åˆ›å»ºä¸€ä¸ªèµ„æºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ¥å¯¹å…¶è¿›è¡Œç«¯åˆ°ç«¯æµ‹è¯•ã€‚\nSpring æˆæƒæœåŠ¡å™¨ æˆ‘ä»¬é¦–å…ˆåˆ›å»ºæˆæƒæœåŠ¡å™¨ã€‚\nä¾èµ–é¡¹ï¼š è®©æˆ‘ä»¬å°†ä»¥ä¸‹ä¾èµ–é¡¹æ·»åŠ åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­ã€‚\nimplementation \u0026#39;org.springframework.security:spring-security-oauth2-authorization-server:1.0.0\u0026#39; implementation \u0026#39;org.springframework.boot:spring-boot-starter-security\u0026#39; implementation \u0026#39;org.springframework.boot:spring-boot-starter-web\u0026#39; testImplementation \u0026#39;org.springframework.boot:spring-boot-starter-test\u0026#39; testImplementation \u0026#39;org.springframework.security:spring-security-test\u0026#39; æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ spring oauth2 ä¾èµ–é¡¹çš„æœ€æ–°ï¼ˆå½“æ—¶ï¼‰ç¨³å®šç‰ˆæœ¬ã€‚\nJava å®ç°ï¼š è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º AuthorizationServerConfig çš„é…ç½®ç±»ï¼Œå¹¶å‘è¯¥ç±»æ·»åŠ  @Configuration æ³¨è§£ã€‚ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºä»¥ä¸‹ bean æ¥å®Œæˆé…ç½®ï¼š\nSecurityFilterChain @Bean @Order(Ordered.HIGHEST_PRECEDENCE) public SecurityFilterChain authServerSecurityFilterChain(HttpSecurity http) throws Exception { OAuth2AuthorizationServerConfiguration.applyDefaultSecurity(http); return http.build(); } æˆ‘ä»¬å°†æŠŠ bean çš„é¡ºåºè®¾ç½®ä¸ºæœ€é«˜ï¼Œå› ä¸ºæˆ‘ä»¬æƒ³é¦–å…ˆæ‰§è¡Œå®ƒã€‚\nRegisteredClientRepository @Bean public RegisteredClientRepository registeredClientRepository() { RegisteredClient registeredClient = RegisteredClient.withId(UUID.randomUUID().toString()) .clientId(\u0026#34;oauth-client\u0026#34;) .clientSecret(\u0026#34;{noop}oauth-secret\u0026#34;) .clientAuthenticationMethod(ClientAuthenticationMethod.CLIENT_SECRET_BASIC) .authorizationGrantType(AuthorizationGrantType.CLIENT_CREDENTIALS) .scope(OidcScopes.OPENID) .scope(\u0026#34;articles.read\u0026#34;) .build(); return new InMemoryRegisteredClientRepository(registeredClient); } ç°åœ¨è®©æˆ‘ä»¬ä½¿ç”¨å†…å­˜å­˜å‚¨åº“å¯¹å†…å®¹è¿›è¡Œç¡¬ç¼–ç ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®æˆ‘ä»¬çš„éœ€è¦æ›´æ–°è¿™äº›ã€‚\nJwtDecoder @Bean public JwtDecoder jwtDecoder(JWKSource\u0026lt;SecurityContext\u0026gt; jwkSource) { return OAuth2AuthorizationServerConfiguration.jwtDecoder(jwkSource); } æˆ‘ä»¬å°†ä½¿ç”¨å®ƒæ¥è§£ç ä»¤ç‰Œä»¥è¿›è¡ŒéªŒè¯ã€‚\nJWKSource @Bean public JWKSource\u0026lt;SecurityContext\u0026gt; jwkSource() throws NoSuchAlgorithmException { RSAKey rsaKey = generateRsa(); JWKSet jwkSet = new JWKSet(rsaKey); return (jwkSelector, securityContext) -\u0026gt; jwkSelector.select(jwkSet); } private static RSAKey generateRsa() throws NoSuchAlgorithmException { KeyPair keyPair = generateRsaKey(); RSAPublicKey publicKey = (RSAPublicKey) keyPair.getPublic(); RSAPrivateKey privateKey = (RSAPrivateKey) keyPair.getPrivate(); return new RSAKey.Builder(publicKey) .privateKey(privateKey) .keyID(UUID.randomUUID().toString()) .build(); } private static KeyPair generateRsaKey() throws NoSuchAlgorithmException { KeyPairGenerator keyPairGenerator = KeyPairGenerator.getInstance(\u0026#34;RSA\u0026#34;); keyPairGenerator.initialize(2048); return keyPairGenerator.generateKeyPair(); } æˆ‘ä»¬åœ¨è§£ç å™¨ bean ä¸­ä½¿ç”¨è¿™ä¸ªæºï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®šä¹‰å®ƒã€‚æˆ‘ä»¬ä½¿ç”¨ RSA 2048 å¯†é’¥å¯¹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨éœ€è¦æ—¶æ›´æ”¹å®ƒã€‚\nAuthorizationServerSettings @Bean public AuthorizationServerSettings authorizationServerSettings() { return AuthorizationServerSettings.builder().build(); } ç°åœ¨æˆ‘ä»¬å·²ç»é…ç½®äº†ä¸€åˆ‡ï¼Œè®©æˆ‘ä»¬å°è¯•è¿è¡Œåº”ç”¨ç¨‹åºå¹¶è·å–ä»¤ç‰Œï¼š\ncurl -X POST \u0026#39;http://localhost:9090/oauth2/token?grant_type=client_credentials\u0026#39; \\ --header \u0026#39;Authorization: Basic b2F1dGgtY2xpZW50Om9hdXRoLXNlY3JldA==\u0026#39; æ³¨æ„ï¼šæ ¹æ®æ‚¨çš„é…ç½®æ›´æ–°ç«¯å£å·ã€‚\nå®ƒåº”è¯¥ç»™å‡ºå¦‚ä¸‹å“åº”ï¼š\n{ \u0026#34;access_token\u0026#34;: \u0026#34;eyJraWQiOiJiYWM0ZmMxYS02MGJiLTQ0ZTAtODU4MC1iNzcwYWU2MjkwZWEiLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiJvYXV0aC1jbGllbnQiLCJhdWQiOiJvYXV0aC1jbGllbnQiLCJuYmYiOjE2NzQ5ODYzNjcsImlzcyI6Imh0dHA6Ly9sb2NhbGhvc3Q6OTA5MCIsImV4cCI6MTY3NDk4NjY2NywiaWF0IjoxNjc0OTg2MzY3fQ.DxiIbV7jdRnW15WnnqcjFCLyfXmrU_trl1M3nxej_nIWK60Jx9Vm4HzpxBJugemhrMg-qizQ03TTNswfL9AgTIsLeh_D8TDjcQJy6XFWgElxfUYqUFeZmlXPmQKFmmPyIChlSAFbX1L8QvcgFE1c8GHC900RiKVgGLhT5MOZx5l1WBCbNQ_Rv2u9utcz7EqYTb0y_PjD4EC8UaGdGGlqvEAnKvRVIhxRqFarqh-OW4oUfwfwu1xQIvyWphSDegcOjIERFkhVcQeKO-a3zZS9sfJ03ppZhzAsa5O-qswtbzThO9SWQg7JUgyo7qd-zHIRhwPtEWxDGaBt2QGo7jjopw\u0026#34;, \u0026#34;token_type\u0026#34;: \u0026#34;Bearer\u0026#34;, \u0026#34;expires_in\u0026#34;: 299 } Spring èµ„æºæœåŠ¡å™¨ ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå—æ­¤èº«ä»½éªŒè¯æœåŠ¡å™¨ä¿æŠ¤çš„ API ç«¯ç‚¹ï¼Œå…¶èŒƒå›´ä¸ºæˆ‘ä»¬åœ¨ä»¤ç‰Œåˆ›å»ºä¸­ä½¿ç”¨çš„ articles.readã€‚\nä¾èµ–é¡¹ï¼š è®©æˆ‘ä»¬å°†ä»¥ä¸‹ä¾èµ–é¡¹æ·»åŠ åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼š\nimplementation \u0026#39;org.springframework.boot:spring-boot-starter-oauth2-resource-server\u0026#39; implementation \u0026#39;org.springframework.boot:spring-boot-starter-security\u0026#39; implementation \u0026#39;org.springframework.boot:spring-boot-starter-web\u0026#39; testImplementation \u0026#39;org.springframework.boot:spring-boot-starter-test\u0026#39; testImplementation \u0026#39;org.springframework.security:spring-security-test\u0026#39; Java å®ç°ï¼š è®©æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªç®€å•çš„ rest æ§åˆ¶å™¨ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªé…ç½®ï¼Œä»¥åœ¨æ­£ç¡®çš„èŒƒå›´å†…ä¿æŠ¤è¯¥ APIã€‚ä¹‹åï¼Œæˆ‘ä»¬å°†åœ¨ application.yml æ–‡ä»¶ä¸­é…ç½®èº«ä»½éªŒè¯æœåŠ¡å™¨è®¾ç½®ã€‚\nAPI æ§åˆ¶å™¨ @RestController public class ArticlesController { @GetMapping(\u0026#34;/articles\u0026#34;) public String[] getArticles() { return new String[] { \u0026#34;Article 1\u0026#34;, \u0026#34;Article 2\u0026#34;, \u0026#34;Article 3\u0026#34; }; } } æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ GET API ç«¯ç‚¹ /articlesï¼Œå®ƒå°†è¿”å›æ–‡ç« åˆ—è¡¨ã€‚\nResourceServerConfig @EnableWebSecurity public class ResourceServerConfig { @Bean SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception { http .authorizeRequests() .requestMatchers(\u0026#34;/articles/**\u0026#34;) .access(\u0026#34;hasAuthority(\u0026#39;SCOPE_articles.read\u0026#39;)\u0026#34;) .and() .oauth2ResourceServer() .jwt(); return http.build(); } } æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªé…ç½®ç±»å¹¶ä½¿ç”¨@EnableWebSecurity å¯¹å…¶è¿›è¡Œæ³¨é‡Šã€‚æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª SecurityFilterChain çš„ beanï¼Œåœ¨å…¶ä¸­å®šä¹‰ API å’Œæ‰€éœ€çš„èŒƒå›´ã€‚\napplication.yml spring: security: oauth2: resourceserver: jwt: issuer-uri: http://localhost:9090 æˆ‘ä»¬åœ¨è¿™é‡Œå®šä¹‰ oauth2 é…ç½®ï¼Œæ³¨æ„å°† issuer-url çš„ç«¯å£æ›´æ–°ä¸ºæ­£ç¡®çš„ç«¯å£ã€‚\nç°åœ¨ä¸€åˆ‡éƒ½å·²é…ç½®å®Œæ¯•ï¼Œè®©æˆ‘ä»¬å¯åŠ¨è¯¥æœåŠ¡å¹¶å‘ API å‘å‡ºå¸¦æœ‰æˆ–ä¸å¸¦æœ‰ä»¤ç‰Œçš„è¯·æ±‚ã€‚æ‚¨åº”è¯¥å¾—åˆ°ä¸€ä¸ªæ²¡æœ‰ä»¤ç‰Œæˆ–å¸¦æœ‰æ— æ•ˆä»¤ç‰Œçš„ 401 å“åº”ï¼Œå¹¶ä¸”æ‚¨åº”è¯¥å¾—åˆ°å¸¦æœ‰æœ‰æ•ˆä»¤ç‰Œçš„æ­£ç¡®å“åº”ã€‚\nå®¢æˆ·ç«¯æœåŠ¡å™¨ æˆ‘ä»¬ç°åœ¨å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„ Spring Boot é¡¹ç›®ï¼Œå®ƒå°†ä½¿ç”¨èµ„æºæœåŠ¡å™¨åˆ›å»ºçš„ APIã€‚æˆ‘ä»¬å°†åœ¨æ­¤å¤„é…ç½®èº«ä»½éªŒè¯æœåŠ¡å™¨è¯¦ç»†ä¿¡æ¯ï¼Œä»¥ä¾¿å®ƒåœ¨å‘å‡º API è¯·æ±‚ä¹‹å‰è‡ªåŠ¨è·å–ä»¤ç‰Œã€‚\nä¾èµ–é¡¹ï¼š implementation \u0026#39;org.springframework.boot:spring-boot-starter-oauth2-client\u0026#39; implementation \u0026#39;org.springframework.boot:spring-boot-starter-web\u0026#39; implementation \u0026#39;org.springframework:spring-webflux\u0026#39; testImplementation \u0026#39;org.springframework.boot:spring-boot-starter-test\u0026#39; testImplementation \u0026#39;org.springframework.security:spring-security-test\u0026#39; Java å®ç°ï¼š æˆ‘ä»¬é¦–å…ˆåˆ›å»ºé…ç½®ç±»ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæµ‹è¯• API æ¥å‘èµ„æºæœåŠ¡å™¨å‘å‡ºè¯·æ±‚ã€‚ä¹‹åï¼Œæˆ‘ä»¬å°†åœ¨ application.yml æ–‡ä»¶ä¸­å®šä¹‰ä»¤ç‰Œé…ç½®ã€‚\n**SecurityConfig ** @Configuration public class SecurityConfig { @Bean SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception { return http.oauth2Client().and().build(); } @Bean WebClient webClient(OAuth2AuthorizedClientManager authorizedClientManager) { ServletOAuth2AuthorizedClientExchangeFilterFunction oauth2Client = new ServletOAuth2AuthorizedClientExchangeFilterFunction(authorizedClientManager); return WebClient.builder() .apply(oauth2Client.oauth2Configuration()) .build(); } @Bean OAuth2AuthorizedClientManager authorizedClientManager(ClientRegistrationRepository clientRegistrationRepository, OAuth2AuthorizedClientService oAuth2AuthorizedClientService, OAuth2AccessTokenResponseClient\u0026lt;OAuth2ClientCredentialsGrantRequest\u0026gt; tokenResponseClient) { OAuth2AuthorizedClientProvider authorizedClientProvider = OAuth2AuthorizedClientProviderBuilder.builder() .clientCredentials(r -\u0026gt; r.accessTokenResponseClient(tokenResponseClient)).clientCredentials().build(); var authorizedClientManager = new AuthorizedClientServiceOAuth2AuthorizedClientManager( clientRegistrationRepository, oAuth2AuthorizedClientService); authorizedClientManager.setAuthorizedClientProvider(authorizedClientProvider); return authorizedClientManager; } @Bean OAuth2AccessTokenResponseClient\u0026lt;OAuth2ClientCredentialsGrantRequest\u0026gt; tokenResponseClient() { return new DefaultClientCredentialsTokenResponseClient(); } } application.yml spring: security: oauth2: client: registration: articles-client: client-id: oauth-client client-secret: oauth-secret authorization-grant-type: client_credentials scope: articles.read client-name: spring-client provider: articles-client: token-uri: http://localhost:9090/oauth2/token å®¢æˆ·ç«¯ APIï¼ˆå‘èµ„æºæœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼‰ @RestController public class ArticlesController { @Autowired private WebClient webClient; @GetMapping(value = \u0026#34;/test\u0026#34;) public String[] test() { return this.webClient .get() .uri(\u0026#34;http://127.0.0.1:9091/articles\u0026#34;) .attributes(clientRegistrationId(\u0026#34;articles-client\u0026#34;)) .retrieve() .bodyToMono(String[].class) .block(); } } æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°ï¼Œå½“æˆ‘ä»¬è°ƒç”¨ /test API æ—¶ï¼Œå®ƒä¼šä»æˆ‘ä»¬çš„èº«ä»½éªŒè¯æœåŠ¡å™¨è·å–ä»¤ç‰Œï¼Œç„¶åå‘æˆ‘ä»¬çš„èµ„æºæœåŠ¡å™¨ /articles ç«¯ç‚¹å‘å‡ºè¯·æ±‚å¹¶è¿”å›å“åº”ã€‚\nè®©æˆ‘ä»¬è¿è¡Œæ‰€æœ‰ä¸‰ä¸ªæœåŠ¡å™¨å¹¶å‘å®¢æˆ·ç«¯æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œå®ƒåº”è¯¥è¿”å›æ­£ç¡®çš„å“åº”ã€‚è¯·æ³¨æ„æ›´æ–°æ‰€æœ‰ä½ç½®çš„ç«¯å£å·ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä½¿ç”¨äº†ä»¥ä¸‹ç«¯å£ï¼š\n9090: auth-server 9090ï¼šè®¤è¯æœåŠ¡å™¨ 9091: resource-server 9091ï¼šèµ„æºæœåŠ¡å™¨ 9092: client-server 9092ï¼šå®¢æˆ·ç«¯-æœåŠ¡å™¨ ç»“è®º åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨ Spring Boot åˆ›å»ºæˆæƒæœåŠ¡å™¨ä»¥åŠå¦‚ä½•åœ¨èµ„æºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æœåŠ¡å™¨ä¸­é…ç½®å®ƒã€‚\næ‚¨å¯ä»¥åœ¨æ­¤ GitHub å­˜å‚¨åº“ä¸­æ‰¾åˆ°æ­¤ç¤ºä¾‹çš„ä»£ç ã€‚\nåŸæ–‡é“¾æ¥ï¼šhttps://blog.devgenius.io/spring-boot-authorization-server-825230ae0ed2\n","permalink":"https://blog.chensoul.cc/posts/2023/07/26/spring-boot-authorization-server/","summary":"æ¦‚è¿° åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæˆæƒæœåŠ¡å™¨ï¼Œä¸ºä»»ä½•å®¢æˆ·ç«¯ç”Ÿæˆ access_tokenã€‚è¿™ç§°ä¸º OAuth2 çš„ client_credentials æµç¨‹ã€‚å®ƒä¸»è¦ç”¨äºæœåŠ¡é—´é€šä¿¡ã€‚\næˆ‘ä»¬å°†ä½¿ç”¨ spring boot oauth2 æˆæƒæœåŠ¡å™¨ä¾èµ–é¡¹æ¥åˆ›å»ºèº«ä»½éªŒè¯æœåŠ¡å™¨ã€‚æˆ‘ä»¬è¿˜å°†åˆ›å»ºä¸€ä¸ªèµ„æºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ¥å¯¹å…¶è¿›è¡Œç«¯åˆ°ç«¯æµ‹è¯•ã€‚\nSpring æˆæƒæœåŠ¡å™¨ æˆ‘ä»¬é¦–å…ˆåˆ›å»ºæˆæƒæœåŠ¡å™¨ã€‚\nä¾èµ–é¡¹ï¼š è®©æˆ‘ä»¬å°†ä»¥ä¸‹ä¾èµ–é¡¹æ·»åŠ åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­ã€‚\nimplementation \u0026#39;org.springframework.security:spring-security-oauth2-authorization-server:1.0.0\u0026#39; implementation \u0026#39;org.springframework.boot:spring-boot-starter-security\u0026#39; implementation \u0026#39;org.springframework.boot:spring-boot-starter-web\u0026#39; testImplementation \u0026#39;org.springframework.boot:spring-boot-starter-test\u0026#39; testImplementation \u0026#39;org.springframework.security:spring-security-test\u0026#39; æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ spring oauth2 ä¾èµ–é¡¹çš„æœ€æ–°ï¼ˆå½“æ—¶ï¼‰ç¨³å®šç‰ˆæœ¬ã€‚\nJava å®ç°ï¼š è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º AuthorizationServerConfig çš„é…ç½®ç±»ï¼Œå¹¶å‘è¯¥ç±»æ·»åŠ  @Configuration æ³¨è§£ã€‚ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºä»¥ä¸‹ bean æ¥å®Œæˆé…ç½®ï¼š\nSecurityFilterChain @Bean @Order(Ordered.HIGHEST_PRECEDENCE) public SecurityFilterChain authServerSecurityFilterChain(HttpSecurity http) throws Exception { OAuth2AuthorizationServerConfiguration.applyDefaultSecurity(http); return http.build(); } æˆ‘ä»¬å°†æŠŠ bean çš„é¡ºåºè®¾ç½®ä¸ºæœ€é«˜ï¼Œå› ä¸ºæˆ‘ä»¬æƒ³é¦–å…ˆæ‰§è¡Œå®ƒã€‚\nRegisteredClientRepository @Bean public RegisteredClientRepository registeredClientRepository() { RegisteredClient registeredClient = RegisteredClient.withId(UUID.randomUUID().toString()) .clientId(\u0026#34;oauth-client\u0026#34;) .clientSecret(\u0026#34;{noop}oauth-secret\u0026#34;) .clientAuthenticationMethod(ClientAuthenticationMethod.CLIENT_SECRET_BASIC) .authorizationGrantType(AuthorizationGrantType.CLIENT_CREDENTIALS) .scope(OidcScopes.OPENID) .scope(\u0026#34;articles.read\u0026#34;) .build(); return new InMemoryRegisteredClientRepository(registeredClient); } ç°åœ¨è®©æˆ‘ä»¬ä½¿ç”¨å†…å­˜å­˜å‚¨åº“å¯¹å†…å®¹è¿›è¡Œç¡¬ç¼–ç ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®æˆ‘ä»¬çš„éœ€è¦æ›´æ–°è¿™äº›ã€‚\nJwtDecoder @Bean public JwtDecoder jwtDecoder(JWKSource\u0026lt;SecurityContext\u0026gt; jwkSource) { return OAuth2AuthorizationServerConfiguration.jwtDecoder(jwkSource); } æˆ‘ä»¬å°†ä½¿ç”¨å®ƒæ¥è§£ç ä»¤ç‰Œä»¥è¿›è¡ŒéªŒè¯ã€‚\nJWKSource @Bean public JWKSource\u0026lt;SecurityContext\u0026gt; jwkSource() throws NoSuchAlgorithmException { RSAKey rsaKey = generateRsa(); JWKSet jwkSet = new JWKSet(rsaKey); return (jwkSelector, securityContext) -\u0026gt; jwkSelector.","title":"[è¯‘]Spring BootæˆæƒæœåŠ¡å™¨ - ä½¿ç”¨ Java çš„èµ„æºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å‡­è¯ç¤ºä¾‹"},{"content":"å¤„ç†å¼‚å¸¸æ˜¯æ„å»ºå¥å£®åº”ç”¨ç¨‹åºçš„é‡è¦éƒ¨åˆ†ã€‚ Spring Boot æä¾›äº†ä¸æ­¢ä¸€ç§æ–¹æ³•ã€‚\næœ¬æ–‡å°†æ¢è®¨è¿™äº›æ–¹æ³•ï¼Œå¹¶æä¾›ä¸€äº›å…³äºä½•æ—¶æŸç§ç»™å®šæ–¹æ³•å¯èƒ½ä¼˜äºå¦ä¸€ç§æ–¹æ³•çš„æŒ‡å¯¼ã€‚\nç¤ºä¾‹ä»£ç  æœ¬æ–‡é™„æœ‰ GitHub ä¸Šçš„å·¥ä½œä»£ç ç¤ºä¾‹ã€‚\nä»‹ç» Spring Boot ä¸ºæˆ‘ä»¬æä¾›äº†å¤„ç†å¼‚å¸¸çš„å·¥å…·ï¼Œè€Œä¸ä»…ä»…æ˜¯ç®€å•çš„â€œtry-catchâ€å—ã€‚ä¸ºäº†ä½¿ç”¨è¿™äº›å·¥å…·ï¼Œæˆ‘ä»¬åº”ç”¨äº†ä¸€äº›æ³¨é‡Šï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿå°†å¼‚å¸¸å¤„ç†è§†ä¸ºæ¨ªåˆ‡å…³æ³¨ç‚¹ï¼š\n@ResponseStatus @ExceptionHandler @ControllerAdvice åœ¨æ·±å…¥äº†è§£è¿™äº›æ³¨é‡Šä¹‹å‰ï¼Œæˆ‘ä»¬å°†é¦–å…ˆäº†è§£ Spring å¦‚ä½•å¤„ç† Web æ§åˆ¶å™¨æŠ›å‡ºçš„å¼‚å¸¸â€”â€”è¿™æ˜¯æ•è·å¼‚å¸¸çš„æœ€åä¸€é“é˜²çº¿ã€‚\næˆ‘ä»¬è¿˜å°†æŸ¥çœ‹ Spring Boot æä¾›çš„ä¸€äº›é…ç½®æ¥ä¿®æ”¹é»˜è®¤è¡Œä¸ºã€‚\næˆ‘ä»¬å°†ç¡®å®šè¿™æ ·åšæ—¶é¢ä¸´çš„æŒ‘æˆ˜ï¼Œç„¶åæˆ‘ä»¬å°†å°è¯•ä½¿ç”¨è¿™äº›æ³¨é‡Šæ¥å…‹æœè¿™äº›æŒ‘æˆ˜ã€‚\nSpring Boot é»˜è®¤çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º ProductController çš„æ§åˆ¶å™¨ï¼Œå½“æœªæ‰¾åˆ°å…·æœ‰ç»™å®š id çš„ Product æ—¶ï¼Œå…¶ getProduct(...) æ–¹æ³•ä¼šæŠ›å‡º NoSuchElementFoundException è¿è¡Œæ—¶å¼‚å¸¸ï¼š\n@RestController @RequestMapping(\u0026#34;/product\u0026#34;) public class ProductController { private final ProductService productService; //constructor omitted for brevity... @GetMapping(\u0026#34;/{id}\u0026#34;) public Response getProduct(@PathVariable String id){ // this method throws a \u0026#34;NoSuchElementFoundException\u0026#34; exception return productService.getProduct(id); } } å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ— æ•ˆçš„ id è°ƒç”¨ /product APIï¼ŒæœåŠ¡å°†æŠ›å‡º NoSuchElementFoundException è¿è¡Œæ—¶å¼‚å¸¸ï¼Œæˆ‘ä»¬å°†å¾—åˆ°ä»¥ä¸‹å“åº”ï¼š\n{ \u0026#34;timestamp\u0026#34;: \u0026#34;2020-11-28T13:24:02.239+00:00\u0026#34;, \u0026#34;status\u0026#34;: 500, \u0026#34;error\u0026#34;: \u0026#34;Internal Server Error\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;path\u0026#34;: \u0026#34;/product/1\u0026#34; } æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†æ ¼å¼è‰¯å¥½çš„é”™è¯¯å“åº”ä¹‹å¤–ï¼Œæœ‰æ•ˆè´Ÿè½½æ²¡æœ‰ä¸ºæˆ‘ä»¬æä¾›ä»»ä½•æœ‰ç”¨çš„ä¿¡æ¯ã€‚ç”šè‡³ message å­—æ®µä¹Ÿæ˜¯ç©ºçš„ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›åŒ…å«â€œæœªæ‰¾åˆ° id 1 çš„é¡¹ç›®â€ä¹‹ç±»çš„å†…å®¹ã€‚\nè®©æˆ‘ä»¬ä»ä¿®å¤é”™è¯¯æ¶ˆæ¯é—®é¢˜å¼€å§‹ã€‚\nSpring Boot æä¾›äº†ä¸€äº›å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒä»¬æ·»åŠ å¼‚å¸¸æ¶ˆæ¯ã€å¼‚å¸¸ç±»ï¼Œç”šè‡³å †æ ˆè·Ÿè¸ªä½œä¸ºå“åº”è´Ÿè½½çš„ä¸€éƒ¨åˆ†ï¼š\nserver: error: include-message: always include-binding-errors: always include-stacktrace: on_trace_param include-exception: false åœ¨ application.yml ä¸­ä½¿ç”¨è¿™äº› Spring Boot æœåŠ¡å™¨å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æŸç§ç¨‹åº¦ä¸Šæ”¹å˜é”™è¯¯å“åº”ã€‚\nç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨æ— æ•ˆçš„ id å†æ¬¡è°ƒç”¨ /product APIï¼Œæˆ‘ä»¬å°†å¾—åˆ°ä»¥ä¸‹å“åº”ï¼š\n{ \u0026#34;timestamp\u0026#34;: \u0026#34;2020-11-29T09:42:12.287+00:00\u0026#34;, \u0026#34;status\u0026#34;: 500, \u0026#34;error\u0026#34;: \u0026#34;Internal Server Error\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;Item with id 1 not found\u0026#34;, \u0026#34;path\u0026#34;: \u0026#34;/product/1\u0026#34; } è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å·²å°†å±æ€§ include-stacktrace è®¾ç½®ä¸º on_trace_param ï¼Œè¿™æ„å‘³ç€ä»…å½“æˆ‘ä»¬åœ¨ URL ( ?trace=true ) ä¸­åŒ…å« trace å‚æ•°æ—¶ï¼Œæˆ‘ä»¬æ‰ä¼šåœ¨å“åº”è´Ÿè½½ä¸­è·å¾—å †æ ˆè·Ÿè¸ªï¼š\n{ \u0026#34;timestamp\u0026#34;: \u0026#34;2020-11-29T09:42:12.287+00:00\u0026#34;, \u0026#34;status\u0026#34;: 500, \u0026#34;error\u0026#34;: \u0026#34;Internal Server Error\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;Item with id 1 not found\u0026#34;, \u0026#34;trace\u0026#34;: \u0026#34;io.reflectoring.exception.exception.NoSuchElementFoundException: Item with id 1 not found...\u0026#34;, \u0026#34;path\u0026#34;: \u0026#34;/product/1\u0026#34; } æˆ‘ä»¬å¯èƒ½å¸Œæœ›å°† include-stacktrace æ ‡å¿—çš„å€¼ä¿ç•™ä¸º never ï¼Œè‡³å°‘åœ¨ç”Ÿäº§ä¸­ï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šæ­ç¤ºæˆ‘ä»¬åº”ç”¨ç¨‹åºçš„å†…éƒ¨å·¥ä½œåŸç†ã€‚\nç»§ç»­ï¼çŠ¶æ€å’Œé”™è¯¯æ¶ˆæ¯ - 500 - è¡¨æ˜æˆ‘ä»¬çš„æœåŠ¡å™¨ä»£ç æœ‰é—®é¢˜ï¼Œä½†å®é™…ä¸Šè¿™æ˜¯å®¢æˆ·ç«¯é”™è¯¯ï¼Œå› ä¸ºå®¢æˆ·ç«¯æä¾›äº†æ— æ•ˆçš„ IDã€‚\næˆ‘ä»¬å½“å‰çš„çŠ¶æ€ä»£ç æ²¡æœ‰æ­£ç¡®åæ˜ è¿™ä¸€ç‚¹ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ server.error é…ç½®å±æ€§çš„èŒƒå›´ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»æŸ¥çœ‹ Spring Boot æä¾›çš„æ³¨é‡Šã€‚\n@ResponseStatus é¡¾åæ€ä¹‰ï¼Œ @ResponseStatus å…è®¸æˆ‘ä»¬ä¿®æ”¹å“åº”çš„ HTTP çŠ¶æ€ã€‚å®ƒå¯ä»¥åº”ç”¨åœ¨ä»¥ä¸‹åœ°æ–¹ï¼š\nå…³äºå¼‚å¸¸ç±»æœ¬èº« ä»¥åŠæ–¹æ³•ä¸Šçš„ @ExceptionHandler æ³¨é‡Š ä»¥åŠç±»ä¸Šçš„ @ControllerAdvice æ³¨é‡Š åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»…è®¨è®ºç¬¬ä¸€ç§æƒ…å†µã€‚\nè®©æˆ‘ä»¬å›åˆ°å½“å‰çš„é—®é¢˜ï¼Œå³æˆ‘ä»¬çš„é”™è¯¯å“åº”æ€»æ˜¯ç»™æˆ‘ä»¬ HTTP çŠ¶æ€ 500ï¼Œè€Œä¸æ˜¯æ›´å…·æè¿°æ€§çš„çŠ¶æ€ä»£ç ã€‚\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ @ResponseStatus æ³¨é‡Šæˆ‘ä»¬çš„ Exception ç±»ï¼Œå¹¶åœ¨å…¶ value å±æ€§ä¸­ä¼ å…¥æ‰€éœ€çš„ HTTP å“åº”çŠ¶æ€ï¼š\n@ResponseStatus(value = HttpStatus.NOT_FOUND) public class NoSuchElementFoundException extends RuntimeException { ... } å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ— æ•ˆ ID è°ƒç”¨æ§åˆ¶å™¨ï¼Œæ­¤æ›´æ”¹å°†å¸¦æ¥æ›´å¥½çš„å“åº”ï¼š\n{ \u0026#34;timestamp\u0026#34;: \u0026#34;2020-11-29T09:42:12.287+00:00\u0026#34;, \u0026#34;status\u0026#34;: 404, \u0026#34;error\u0026#34;: \u0026#34;Not Found\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;Item with id 1 not found\u0026#34;, \u0026#34;path\u0026#34;: \u0026#34;/product/1\u0026#34; } å®ç°ç›¸åŒç›®çš„çš„å¦ä¸€ç§æ–¹æ³•æ˜¯æ‰©å±• ResponseStatusException ç±»ï¼š\npublic class NoSuchElementFoundException extends ResponseStatusException { public NoSuchElementFoundException(String message){ super(HttpStatus.NOT_FOUND, message); } @Override public HttpHeaders getResponseHeaders() { // return response headers } } å½“æˆ‘ä»¬æƒ³è¦æ“ä½œå“åº”å¤´æ—¶ï¼Œè¿™ç§æ–¹æ³•ä¼šæ´¾ä¸Šç”¨åœºï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥é‡å†™ getResponseHeaders() æ–¹æ³•ã€‚\n@ResponseStatus ä¸ server.error é…ç½®å±æ€§ç›¸ç»“åˆï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿæ“ä½œ Spring å®šä¹‰çš„é”™è¯¯å“åº”è´Ÿè½½ä¸­çš„å‡ ä¹æ‰€æœ‰å­—æ®µã€‚\nä½†æ˜¯å¦‚æœè¿˜æƒ³æ“çºµå“åº”è´Ÿè½½çš„ç»“æ„æ€ä¹ˆåŠï¼Ÿ\nè®©æˆ‘ä»¬åœ¨ä¸‹ä¸€èŠ‚ä¸­çœ‹çœ‹å¦‚ä½•å®ç°è¿™ä¸€ç›®æ ‡ã€‚\n@ExceptionHandler @ExceptionHandler æ³¨é‡Šåœ¨å¤„ç†å¼‚å¸¸æ–¹é¢ä¸ºæˆ‘ä»¬æä¾›äº†å¾ˆå¤§çš„çµæ´»æ€§ã€‚å¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œè¦ä½¿ç”¨å®ƒï¼Œæˆ‘ä»¬åªéœ€åœ¨æ§åˆ¶å™¨æœ¬èº«æˆ– @ControllerAdvice ç±»ä¸­åˆ›å»ºä¸€ä¸ªæ–¹æ³•ï¼Œå¹¶ç”¨ @ExceptionHandler æ³¨é‡Šå®ƒï¼š\n@RestController @RequestMapping(\u0026#34;/product\u0026#34;) public class ProductController { private final ProductService productService; //constructor omitted for brevity... @GetMapping(\u0026#34;/{id}\u0026#34;) public Response getProduct(@PathVariable String id) { return productService.getProduct(id); } @ExceptionHandler(NoSuchElementFoundException.class) @ResponseStatus(HttpStatus.NOT_FOUND) public ResponseEntity\u0026lt;String\u0026gt; handleNoSuchElementFoundException( NoSuchElementFoundException exception ) { return ResponseEntity .status(HttpStatus.NOT_FOUND) .body(exception.getMessage()); } } å¼‚å¸¸å¤„ç†ç¨‹åºæ–¹æ³•æ¥å—ä¸€ä¸ªå¼‚å¸¸æˆ–å¼‚å¸¸åˆ—è¡¨ä½œä¸ºæˆ‘ä»¬è¦åœ¨å®šä¹‰çš„æ–¹æ³•ä¸­å¤„ç†çš„å‚æ•°ã€‚æˆ‘ä»¬ç”¨ @ExceptionHandler å’Œ @ResponseStatus æ³¨é‡Šè¯¥æ–¹æ³•æ¥å®šä¹‰æˆ‘ä»¬æƒ³è¦å¤„ç†çš„å¼‚å¸¸å’Œæˆ‘ä»¬æƒ³è¦è¿”å›çš„çŠ¶æ€ä»£ç ã€‚\nå¦‚æœæˆ‘ä»¬ä¸æƒ³ä½¿ç”¨è¿™äº›æ³¨é‡Šï¼Œé‚£ä¹ˆåªéœ€å°†å¼‚å¸¸å®šä¹‰ä¸ºæ–¹æ³•çš„å‚æ•°ä¹Ÿå¯ä»¥ï¼š\n@ExceptionHandler public ResponseEntity\u0026lt;String\u0026gt; handleNoSuchElementFoundException( NoSuchElementFoundException exception) å°½ç®¡æˆ‘ä»¬å·²ç»åœ¨æ–¹æ³•ç­¾åä¸­æåˆ°äº†å®ƒï¼Œä½†åœ¨æ³¨é‡Šä¸­æåŠå¼‚å¸¸ç±»æ˜¯ä¸ªå¥½ä¸»æ„ã€‚å®ƒæä¾›äº†æ›´å¥½çš„å¯è¯»æ€§ã€‚\næ­¤å¤–ï¼Œå¤„ç†ç¨‹åºæ–¹æ³•ä¸Šçš„æ³¨é‡Š @ResponseStatus(HttpStatus.NOT_FOUND) ä¸æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºä¼ é€’åˆ° ResponseEnity çš„ HTTP çŠ¶æ€å°†ä¼˜å…ˆï¼Œä½†å‡ºäºç›¸åŒçš„å¯è¯»æ€§åŸå› ï¼Œæˆ‘ä»¬ä»ç„¶ä¿ç•™å®ƒã€‚\né™¤äº†å¼‚å¸¸å‚æ•°ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ HttpServletRequest ã€ WebRequest æˆ– HttpSession ç±»å‹ä½œä¸ºå‚æ•°ã€‚\nåŒæ ·ï¼Œå¤„ç†ç¨‹åºæ–¹æ³•æ”¯æŒå„ç§è¿”å›ç±»å‹ï¼Œä¾‹å¦‚ ResponseEntity ã€ String ç”šè‡³ void ã€‚\nåœ¨ @ExceptionHandler java æ–‡æ¡£ä¸­æŸ¥æ‰¾æ›´å¤šè¾“å…¥å’Œè¿”å›ç±»å‹ã€‚\nåœ¨å¼‚å¸¸å¤„ç†å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¾“å…¥å‚æ•°å’Œè¿”å›ç±»å‹çš„å½¢å¼ä½¿ç”¨è®¸å¤šä¸åŒçš„é€‰é¡¹ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å®Œå…¨æ§åˆ¶é”™è¯¯å“åº”ã€‚\nç°åœ¨ï¼Œè®©æˆ‘ä»¬æœ€ç»ˆç¡®å®š API çš„é”™è¯¯å“åº”è´Ÿè½½ã€‚å¦‚æœå‡ºç°ä»»ä½•é”™è¯¯ï¼Œå®¢æˆ·é€šå¸¸ä¼šæœŸæœ›ä¸¤ä»¶äº‹ï¼š\né”™è¯¯ä»£ç å‘Šè¯‰å®¢æˆ·ç«¯å®ƒæ˜¯ä»€ä¹ˆç±»å‹çš„é”™è¯¯ã€‚å®¢æˆ·ç«¯å¯ä»¥åœ¨å…¶ä»£ç ä¸­ä½¿ç”¨é”™è¯¯ä»£ç æ¥é©±åŠ¨åŸºäºå®ƒçš„æŸäº›ä¸šåŠ¡é€»è¾‘ã€‚é€šå¸¸ï¼Œé”™è¯¯ä»£ç æ˜¯æ ‡å‡†çš„ HTTP çŠ¶æ€ä»£ç ï¼Œä½†æˆ‘ä¹Ÿçœ‹åˆ° API è¿”å›è‡ªå®šä¹‰é”™è¯¯ä»£ç ï¼Œä¾‹å¦‚ E001 ã€‚\nä¸€æ¡é™„åŠ çš„äººç±»å¯è¯»æ¶ˆæ¯ï¼Œæä¾›æœ‰å…³é”™è¯¯çš„æ›´å¤šä¿¡æ¯ï¼Œç”šè‡³æä¾›æœ‰å…³å¦‚ä½•ä¿®å¤é”™è¯¯çš„ä¸€äº›æç¤ºæˆ– API æ–‡æ¡£çš„é“¾æ¥ã€‚\næˆ‘ä»¬è¿˜å°†æ·»åŠ ä¸€ä¸ªå¯é€‰çš„ stackTrace å­—æ®µï¼Œè¿™å°†å¸®åŠ©æˆ‘ä»¬åœ¨å¼€å‘ç¯å¢ƒä¸­è¿›è¡Œè°ƒè¯•ã€‚\næœ€åï¼Œæˆ‘ä»¬è¿˜æƒ³å¤„ç†å“åº”ä¸­çš„éªŒè¯é”™è¯¯ã€‚æ‚¨å¯ä»¥åœ¨è¿™ç¯‡æœ‰å…³ä½¿ç”¨ Spring Boot å¤„ç†éªŒè¯çš„æ–‡ç« ä¸­æ‰¾åˆ°æœ‰å…³ bean éªŒè¯çš„æ›´å¤šä¿¡æ¯ã€‚\nè®°ä½è¿™äº›ç‚¹ï¼Œæˆ‘ä»¬å°†ä¸ºé”™è¯¯å“åº”ä½¿ç”¨ä»¥ä¸‹æœ‰æ•ˆè´Ÿè½½ï¼š\n@Getter @Setter @RequiredArgsConstructor @JsonInclude(JsonInclude.Include.NON_NULL) public class ErrorResponse { private final int status; private final String message; private String stackTrace; private List\u0026lt;ValidationError\u0026gt; errors; @Getter @Setter @RequiredArgsConstructor private static class ValidationError { private final String field; private final String message; } public void addValidationError(String field, String message){ if(Objects.isNull(errors)){ errors = new ArrayList\u0026lt;\u0026gt;(); } errors.add(new ValidationError(field, message)); } } ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°†æ‰€æœ‰è¿™äº›åº”ç”¨åˆ° NoSuchElementFoundException å¤„ç†ç¨‹åºæ–¹æ³•ä¸­ã€‚\n@RestController @RequestMapping(\u0026#34;/product\u0026#34;) @AllArgsConstructor public class ProductController { public static final String TRACE = \u0026#34;trace\u0026#34;; @Value(\u0026#34;${reflectoring.trace:false}\u0026#34;) private boolean printStackTrace; private final ProductService productService; @GetMapping(\u0026#34;/{id}\u0026#34;) public Product getProduct(@PathVariable String id){ return productService.getProduct(id); } @PostMapping public Product addProduct(@RequestBody @Valid ProductInput input){ return productService.addProduct(input); } @ExceptionHandler(NoSuchElementFoundException.class) @ResponseStatus(HttpStatus.NOT_FOUND) public ResponseEntity\u0026lt;ErrorResponse\u0026gt; handleItemNotFoundException( NoSuchElementFoundException exception, WebRequest request ){ log.error(\u0026#34;Failed to find the requested element\u0026#34;, exception); return buildErrorResponse(exception, HttpStatus.NOT_FOUND, request); } @ExceptionHandler(MethodArgumentNotValidException.class) @ResponseStatus(HttpStatus.UNPROCESSABLE_ENTITY) public ResponseEntity\u0026lt;ErrorResponse\u0026gt; handleMethodArgumentNotValid( MethodArgumentNotValidException ex, WebRequest request ) { ErrorResponse errorResponse = new ErrorResponse( HttpStatus.UNPROCESSABLE_ENTITY.value(), \u0026#34;Validation error. Check \u0026#39;errors\u0026#39; field for details.\u0026#34; ); for (FieldError fieldError : ex.getBindingResult().getFieldErrors()) { errorResponse.addValidationError(fieldError.getField(), fieldError.getDefaultMessage()); } return ResponseEntity.unprocessableEntity().body(errorResponse); } @ExceptionHandler(Exception.class) @ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR) public ResponseEntity\u0026lt;ErrorResponse\u0026gt; handleAllUncaughtException( Exception exception, WebRequest request){ log.error(\u0026#34;Unknown error occurred\u0026#34;, exception); return buildErrorResponse( exception, \u0026#34;Unknown error occurred\u0026#34;, HttpStatus.INTERNAL_SERVER_ERROR, request ); } private ResponseEntity\u0026lt;ErrorResponse\u0026gt; buildErrorResponse( Exception exception, HttpStatus httpStatus, WebRequest request ) { return buildErrorResponse( exception, exception.getMessage(), httpStatus, request); } private ResponseEntity\u0026lt;ErrorResponse\u0026gt; buildErrorResponse( Exception exception, String message, HttpStatus httpStatus, WebRequest request ) { ErrorResponse errorResponse = new ErrorResponse( httpStatus.value(), exception.getMessage() ); if(printStackTrace \u0026amp;\u0026amp; isTraceOn(request)){ errorResponse.setStackTrace(ExceptionUtils.getStackTrace(exception)); } return ResponseEntity.status(httpStatus).body(errorResponse); } private boolean isTraceOn(WebRequest request) { String [] value = request.getParameterValues(TRACE); return Objects.nonNull(value) \u0026amp;\u0026amp; value.length \u0026gt; 0 \u0026amp;\u0026amp; value[0].contentEquals(\u0026#34;true\u0026#34;); } } è¿™é‡Œéœ€è¦æ³¨æ„å‡ ç‚¹ï¼š\næä¾›å †æ ˆè·Ÿè¸ª åœ¨é”™è¯¯å“åº”ä¸­æä¾›å †æ ˆè·Ÿè¸ªå¯ä»¥ä½¿æˆ‘ä»¬çš„å¼€å‘äººå‘˜å’Œ QA å·¥ç¨‹å¸ˆå…å»çˆ¬è¡Œæ—¥å¿—æ–‡ä»¶çš„éº»çƒ¦ã€‚\næ­£å¦‚æˆ‘ä»¬åœ¨ Spring Boot çš„é»˜è®¤å¼‚å¸¸å¤„ç†æœºåˆ¶ä¸­çœ‹åˆ°çš„ï¼ŒSpring å·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†è¿™ä¸ªåŠŸèƒ½ã€‚ä½†ç°åœ¨ï¼Œç”±äºæˆ‘ä»¬è‡ªå·±å¤„ç†é”™è¯¯å“åº”ï¼Œå› æ­¤è¿™ä¹Ÿéœ€è¦æˆ‘ä»¬è‡ªå·±å¤„ç†ã€‚\nä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº†ä¸€ä¸ªåä¸º reflectoring.trace çš„æœåŠ¡å™¨ç«¯é…ç½®å±æ€§ï¼Œå¦‚æœå°†å…¶è®¾ç½®ä¸º true ï¼Œä¸ºäº†å®ç°æ­¤ç›®çš„ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº†ä¸€ä¸ªåä¸º reflectoring.trace çš„æœåŠ¡å™¨ç«¯é…ç½®å±æ€§ï¼Œå¦‚æœå°†å…¶è®¾ç½®ä¸º true ï¼Œå°†å¯ç”¨å“åº”ä¸­çš„ stackTrace å­—æ®µã€‚è¦å®é™…åœ¨ API å“åº”ä¸­è·å– stackTrace ï¼Œæˆ‘ä»¬çš„å®¢æˆ·ç«¯è¿˜å¿…é¡»ä¼ é€’å¸¦æœ‰å€¼ true çš„ trace å‚æ•°ï¼š\ncurl --location --request GET \u0026#39;http://localhost:8080/product/1?trace=true\u0026#39; ç°åœ¨ï¼Œç”±äº stackTrace çš„è¡Œä¸ºç”±å±æ€§æ–‡ä»¶ä¸­çš„åŠŸèƒ½æ ‡å¿—æ§åˆ¶ï¼Œå› æ­¤å½“æˆ‘ä»¬åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶åˆ é™¤æˆ–å°†å…¶è®¾ç½®ä¸º false ã€‚\næ•è·æ‰€æœ‰å¼‚å¸¸å¤„ç†ç¨‹åº éœ€è¦æŠŠä»–ä»¬å…¨éƒ½æŠ“åˆ°ï¼š\ntry{ performSomeOperation(); } catch(OperationSpecificException ex){ //... } catch(Exception catchAllExcetion){ //... } ä½œä¸ºä¸€é¡¹è°¨æ…æªæ–½ï¼Œæˆ‘ä»¬ç»å¸¸ç”¨ä¸€ä¸ªåŒ…ç½—ä¸‡è±¡çš„ try-catch å¼‚å¸¸å¤„ç†ç¨‹åºå—åŒ…å›´é¡¶çº§æ–¹æ³•çš„ä¸»ä½“ï¼Œä»¥é¿å…ä»»ä½•ä¸éœ€è¦çš„å‰¯ä½œç”¨æˆ–è¡Œä¸ºã€‚æˆ‘ä»¬æ§åˆ¶å™¨ä¸­çš„ handleAllUncaughtException() æ–¹æ³•çš„è¡Œä¸ºç±»ä¼¼ã€‚å®ƒå°†æ•è·æˆ‘ä»¬æ²¡æœ‰ç‰¹å®šå¤„ç†ç¨‹åºçš„æ‰€æœ‰å¼‚å¸¸ã€‚\næˆ‘æƒ³åœ¨è¿™é‡ŒæŒ‡å‡ºçš„ä¸€ä»¶äº‹æ˜¯ï¼Œå³ä½¿æˆ‘ä»¬æ²¡æœ‰è¿™ä¸ªåŒ…ç½—ä¸‡è±¡çš„å¼‚å¸¸å¤„ç†ç¨‹åºï¼ŒSpring ä¹Ÿä¼šå¤„ç†å®ƒã€‚ä½†æˆ‘ä»¬å¸Œæœ›å“åº”é‡‡ç”¨æˆ‘ä»¬çš„æ ¼å¼è€Œä¸æ˜¯ Spring çš„æ ¼å¼ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»è‡ªå·±å¤„ç†å¼‚å¸¸ã€‚\nåŒ…ç½—ä¸‡è±¡çš„å¤„ç†ç¨‹åºæ–¹æ³•ä¹Ÿæ˜¯è®°å½•å¼‚å¸¸çš„å¥½åœ°æ–¹ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥æ·±å…¥äº†è§£å¯èƒ½çš„é”™è¯¯ã€‚æˆ‘ä»¬å¯ä»¥è·³è¿‡è®°å½•å­—æ®µéªŒè¯å¼‚å¸¸ï¼Œä¾‹å¦‚ MethodArgumentNotValidException ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ç”±äºè¯­æ³•ä¸Šæ— æ•ˆçš„è¾“å…¥è€Œå¼•å‘çš„ï¼Œä½†æˆ‘ä»¬åº”è¯¥å§‹ç»ˆåœ¨æ•è·æ‰€æœ‰å¤„ç†ç¨‹åºä¸­è®°å½•æœªçŸ¥å¼‚å¸¸ã€‚\nå¼‚å¸¸å¤„ç†ç¨‹åºçš„é¡ºåº æåŠå¤„ç†ç¨‹åºæ–¹æ³•çš„é¡ºåºå¹¶ä¸é‡è¦ã€‚ Spring å°†é¦–å…ˆå¯»æ‰¾æœ€å…·ä½“çš„å¼‚å¸¸å¤„ç†æ–¹æ³•ã€‚\nå¦‚æœæ‰¾ä¸åˆ°å®ƒï¼Œé‚£ä¹ˆå®ƒå°†æŸ¥æ‰¾çˆ¶å¼‚å¸¸çš„å¤„ç†ç¨‹åºï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯ RuntimeException ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ handleAllUncaughtException() æ–¹æ³•å°†æœ€ç»ˆå¤„ç†è¯¥å¼‚å¸¸ã€‚\nè¿™åº”è¯¥å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¤„ç†è¿™ä¸ªç‰¹å®šæ§åˆ¶å™¨ä¸­çš„å¼‚å¸¸ï¼Œä½†æ˜¯å¦‚æœå…¶ä»–æ§åˆ¶å™¨ä¹ŸæŠ›å‡ºè¿™äº›ç›¸åŒçš„å¼‚å¸¸æ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬å¦‚ä½•å¤„ç†è¿™äº›ï¼Ÿæˆ‘ä»¬æ˜¯å¦åœ¨æ‰€æœ‰æ§åˆ¶å™¨ä¸­åˆ›å»ºç›¸åŒçš„å¤„ç†ç¨‹åºï¼Œæˆ–è€…åˆ›å»ºå…·æœ‰å…¬å…±å¤„ç†ç¨‹åºçš„åŸºç±»å¹¶åœ¨æ‰€æœ‰æ§åˆ¶å™¨ä¸­æ‰©å±•å®ƒï¼Ÿ\nå¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸å¿…è¿™æ ·åšã€‚ Spring ä»¥â€œæ§åˆ¶å™¨å»ºè®®â€çš„å½¢å¼ä¸ºè¿™ä¸ªé—®é¢˜æä¾›äº†ä¸€ä¸ªéå¸¸ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆã€‚\nè®©æˆ‘ä»¬ç ”ç©¶ä¸€ä¸‹å®ƒä»¬ã€‚\n@ControllerAdvice ä¸ºä»€ä¹ˆç§°ä¸ºâ€œæ§åˆ¶å™¨å»ºè®®â€ï¼Ÿ\nâ€œå»ºè®®â€ä¸€è¯æ¥è‡ªé¢å‘æ–¹é¢ç¼–ç¨‹ (AOP)ï¼Œå®ƒå…è®¸æˆ‘ä»¬å›´ç»•ç°æœ‰æ–¹æ³•æ³¨å…¥æ¨ªåˆ‡ä»£ç ï¼ˆç§°ä¸ºâ€œå»ºè®®â€ï¼‰ã€‚æ§åˆ¶å™¨å»ºè®®å…è®¸æˆ‘ä»¬æ‹¦æˆªå’Œä¿®æ”¹æ§åˆ¶å™¨æ–¹æ³•çš„è¿”å›å€¼ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯ä¸ºäº†å¤„ç†å¼‚å¸¸ã€‚\næ§åˆ¶å™¨å»ºè®®ç±»å…è®¸æˆ‘ä»¬å°†å¼‚å¸¸å¤„ç†ç¨‹åºåº”ç”¨äºåº”ç”¨ç¨‹åºä¸­çš„å¤šä¸ªæˆ–æ‰€æœ‰æ§åˆ¶å™¨ï¼š\n@ControllerAdvice public class GlobalExceptionHandler extends ResponseEntityExceptionHandler { public static final String TRACE = \u0026#34;trace\u0026#34;; @Value(\u0026#34;${reflectoring.trace:false}\u0026#34;) private boolean printStackTrace; @Override @ResponseStatus(HttpStatus.UNPROCESSABLE_ENTITY) protected ResponseEntity\u0026lt;Object\u0026gt; handleMethodArgumentNotValid( MethodArgumentNotValidException ex, HttpHeaders headers, HttpStatus status, WebRequest request ) { //Body omitted as it\u0026#39;s similar to the method of same name // in ProductController example... //..... } @ExceptionHandler(ItemNotFoundException.class) @ResponseStatus(HttpStatus.NOT_FOUND) public ResponseEntity\u0026lt;Object\u0026gt; handleItemNotFoundException( ItemNotFoundException itemNotFoundException, WebRequest request ){ //Body omitted as it\u0026#39;s similar to the method of same name // in ProductController example... //..... } @ExceptionHandler(RuntimeException.class) @ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR) public ResponseEntity\u0026lt;Object\u0026gt; handleAllUncaughtException( RuntimeException exception, WebRequest request ){ //Body omitted as it\u0026#39;s similar to the method of same name // in ProductController example... //..... } //.... @Override public ResponseEntity\u0026lt;Object\u0026gt; handleExceptionInternal( Exception ex, Object body, HttpHeaders headers, HttpStatus status, WebRequest request) { return buildErrorResponse(ex,status,request); } } å¤„ç†å‡½æ•°çš„ä¸»ä½“å’Œå…¶ä»–æ”¯æŒä»£ç è¢«çœç•¥ï¼Œå› ä¸ºå®ƒä»¬ä¸æˆ‘ä»¬åœ¨ @ExceptionHandler éƒ¨åˆ†çœ‹åˆ°çš„ä»£ç å‡ ä¹ç›¸åŒã€‚è¯·åœ¨ Github Repo çš„ GlobalExceptionHandler ç±»ä¸­æ‰¾åˆ°å®Œæ•´çš„ä»£ç ã€‚\næœ‰å‡ ä»¶äº‹æ˜¯æ–°çš„ï¼Œæˆ‘ä»¬ç¨åä¼šè®¨è®ºã€‚è¿™é‡Œçš„ä¸€ä¸ªä¸»è¦åŒºåˆ«æ˜¯è¿™äº›å¤„ç†ç¨‹åºå°†å¤„ç†åº”ç”¨ç¨‹åºä¸­æ‰€æœ‰æ§åˆ¶å™¨æŠ›å‡ºçš„å¼‚å¸¸ï¼Œè€Œä¸ä»…ä»…æ˜¯ ProductController ã€‚\nå¦‚æœæˆ‘ä»¬æƒ³æœ‰é€‰æ‹©åœ°å°†æ§åˆ¶å™¨å»ºè®®çš„èŒƒå›´åº”ç”¨æˆ–é™åˆ¶åˆ°ç‰¹å®šæ§åˆ¶å™¨æˆ–åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ³¨é‡Šæä¾›çš„å±æ€§ï¼š\n@ControllerAdvice(\u0026quot;com.reflectoring.controller\u0026quot;) ï¼šæˆ‘ä»¬å¯ä»¥åœ¨æ³¨é‡Šçš„ value æˆ– basePackages å‚æ•°ä¸­ä¼ é€’åŒ…åç§°æˆ–åŒ…åç§°åˆ—è¡¨ã€‚è¿™æ ·ï¼Œæ§åˆ¶å™¨å»ºè®®å°†ä»…å¤„ç†è¯¥åŒ…æ§åˆ¶å™¨çš„å¼‚å¸¸ã€‚ @ControllerAdvice(annotations = Advised.class) ï¼šåªæœ‰æ ‡æœ‰ @Advised æ³¨é‡Šçš„æ§åˆ¶å™¨æ‰ä¼šç”±æ§åˆ¶å™¨å»ºè®®å¤„ç†ã€‚ åœ¨ @ControllerAdvice æ³¨é‡Šæ–‡æ¡£ä¸­æŸ¥æ‰¾å…¶ä»–å‚æ•°ã€‚\nResponseEntityExceptionHandler ResponseEntityExceptionHandler æ˜¯æ§åˆ¶å™¨å»ºè®®ç±»çš„ä¾¿æ·åŸºç±»ã€‚å®ƒä¸ºå†…éƒ¨ Spring å¼‚å¸¸æä¾›å¼‚å¸¸å¤„ç†ç¨‹åºã€‚å¦‚æœæˆ‘ä»¬ä¸æ‰©å±•å®ƒï¼Œé‚£ä¹ˆæ‰€æœ‰å¼‚å¸¸å°†è¢«é‡å®šå‘åˆ° DefaultHandlerExceptionResolver ï¼Œå®ƒè¿”å›ä¸€ä¸ª ModelAndView å¯¹è±¡ã€‚å› ä¸ºæˆ‘ä»¬çš„ä½¿å‘½æ˜¯å¡‘é€ æˆ‘ä»¬è‡ªå·±çš„é”™è¯¯å“åº”ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¸Œæœ›è¿™æ ·ã€‚\næ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬é‡å†™äº†ä¸¤ä¸ª ResponseEntityExceptionHandler æ–¹æ³•ï¼š\nhandleMethodArgumentNotValid() ï¼šåœ¨ @ExceptionHandler éƒ¨åˆ†ï¼Œæˆ‘ä»¬è‡ªå·±å®ç°äº†ä¸€ä¸ªå¤„ç†ç¨‹åºã€‚åœ¨è¿™é‡Œæˆ‘ä»¬åªæ˜¯è¦†ç›–äº†å®ƒçš„è¡Œä¸ºã€‚ handleExceptionInternal() ï¼š ResponseEntityExceptionHandler ä¸­çš„æ‰€æœ‰å¤„ç†ç¨‹åºéƒ½ä½¿ç”¨æ­¤å‡½æ•°æ¥æ„å»ºç±»ä¼¼äº buildErrorResponse() çš„ ResponseEntity ã€‚å¦‚æœæˆ‘ä»¬ä¸é‡å†™æ­¤æ–¹æ³•ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å°†ä»…æ”¶åˆ°å“åº”æ ‡å¤´ä¸­çš„ HTTP çŠ¶æ€ï¼Œä½†ç”±äºæˆ‘ä»¬ä¹Ÿå¸Œæœ›åœ¨å“åº”æ­£æ–‡ä¸­åŒ…å« HTTP çŠ¶æ€ï¼Œå› æ­¤æˆ‘ä»¬é‡å†™äº†è¯¥æ–¹æ³•ã€‚ å¤„ç† NoHandlerFoundException éœ€è¦ä¸€äº›é¢å¤–çš„æ­¥éª¤ å½“æ‚¨å°è¯•è°ƒç”¨ç³»ç»Ÿä¸­ä¸å­˜åœ¨çš„ API æ—¶ï¼Œä¼šå‡ºç°æ­¤å¼‚å¸¸ã€‚å°½ç®¡æˆ‘ä»¬é€šè¿‡ ResponseEntityExceptionHandler ç±»å®ç°å…¶å¤„ç†ç¨‹åºï¼Œä½†å¼‚å¸¸ä»è¢«é‡å®šå‘åˆ° DefaultHandlerExceptionResolver ã€‚\nè¦å°†å¼‚å¸¸é‡å®šå‘åˆ°æˆ‘ä»¬çš„å»ºè®®ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å±æ€§æ–‡ä»¶ä¸­è®¾ç½®å‡ ä¸ªå±æ€§ï¼š spring.mvc.throw-exception-if-no-handler-found=true å’Œ spring.web.resources.add-mappings=false\nä½¿ç”¨ @ControllerAdvice æ—¶è¦è®°ä½çš„ä¸€äº›è¦ç‚¹ ä¸ºäº†ç®€å•èµ·è§ï¼Œé¡¹ç›®ä¸­å§‹ç»ˆåªæœ‰ä¸€ä¸ªæ§åˆ¶å™¨å»ºè®®ç±»ã€‚æœ€å¥½æœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­æ‰€æœ‰å¼‚å¸¸çš„å•ä¸€å­˜å‚¨åº“ã€‚å¦‚æœæ‚¨åˆ›å»ºå¤šä¸ªæ§åˆ¶å™¨å»ºè®®ï¼Œè¯·å°è¯•ä½¿ç”¨ basePackages æˆ– annotations å±æ€§æ¥æ˜ç¡®å®ƒå°†å»ºè®®å“ªäº›æ§åˆ¶å™¨ã€‚\nSpring å¯ä»¥æŒ‰ä»»ä½•é¡ºåºå¤„ç†æ§åˆ¶å™¨å»ºè®®ç±»ï¼Œé™¤éæˆ‘ä»¬ä½¿ç”¨ @Order æ³¨é‡Šå¯¹å…¶è¿›è¡Œæ³¨é‡Šã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨æœ‰å¤šä¸ªæ§åˆ¶å™¨å»ºè®®ï¼Œé‚£ä¹ˆåœ¨ç¼–å†™ä¸€ä¸ªåŒ…ç½—ä¸‡è±¡çš„å¤„ç†ç¨‹åºæ—¶è¦å°å¿ƒã€‚ç‰¹åˆ«æ˜¯å½“æ‚¨æ²¡æœ‰åœ¨æ³¨é‡Šä¸­æŒ‡å®š basePackages æˆ– annotations æ—¶ã€‚\nSpring å¦‚ä½•å¤„ç†å¼‚å¸¸ï¼Ÿ ç°åœ¨æˆ‘ä»¬å·²ç»ä»‹ç»äº† Spring ä¸­å¤„ç†å¼‚å¸¸çš„å¯ç”¨æœºåˆ¶ï¼Œè®©æˆ‘ä»¬ç®€è¦äº†è§£ Spring å¦‚ä½•å¤„ç†å®ƒä»¥åŠä½•æ—¶ä¸€ç§æœºåˆ¶ä¼˜å…ˆäºå¦ä¸€ç§æœºåˆ¶ã€‚\nå¦‚æœæˆ‘ä»¬è¿˜æ²¡æœ‰æ„å»ºè‡ªå·±çš„å¼‚å¸¸å¤„ç†ç¨‹åºï¼Œè¯·çœ‹ä¸‹é¢çš„æµç¨‹å›¾ï¼Œå®ƒè·Ÿè¸ªäº† Spring å¼‚å¸¸å¤„ç†çš„è¿‡ç¨‹ï¼š\nç»“è®º å½“å¼‚å¸¸è·¨è¶Šæ§åˆ¶å™¨çš„è¾¹ç•Œæ—¶ï¼Œå®ƒæ³¨å®šä¼šä»¥ JSON å“åº”æˆ– HTML ç½‘é¡µçš„å½¢å¼åˆ°è¾¾å®¢æˆ·ç«¯ã€‚\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº† Spring Boot å¦‚ä½•å°†è¿™äº›å¼‚å¸¸è½¬æ¢ä¸ºå®¢æˆ·å‹å¥½çš„è¾“å‡ºï¼Œä»¥åŠé…ç½®å’Œæ³¨é‡Šï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿå°†å®ƒä»¬è¿›ä¸€æ­¥å¡‘é€ æˆæˆ‘ä»¬æƒ³è¦çš„å½¢çŠ¶ã€‚\næ„Ÿè°¢æ‚¨çš„é˜…è¯»ï¼æ‚¨å¯ä»¥åœ¨ GitHub ä¸Šæ‰¾åˆ°å·¥ä½œä»£ç ã€‚\nåŸæ–‡é“¾æ¥ï¼šhttps://reflectoring.io/spring-boot-exception-handling/\n","permalink":"https://blog.chensoul.cc/posts/2023/07/26/spring-boot-exception-handling/","summary":"å¤„ç†å¼‚å¸¸æ˜¯æ„å»ºå¥å£®åº”ç”¨ç¨‹åºçš„é‡è¦éƒ¨åˆ†ã€‚ Spring Boot æä¾›äº†ä¸æ­¢ä¸€ç§æ–¹æ³•ã€‚\næœ¬æ–‡å°†æ¢è®¨è¿™äº›æ–¹æ³•ï¼Œå¹¶æä¾›ä¸€äº›å…³äºä½•æ—¶æŸç§ç»™å®šæ–¹æ³•å¯èƒ½ä¼˜äºå¦ä¸€ç§æ–¹æ³•çš„æŒ‡å¯¼ã€‚\nç¤ºä¾‹ä»£ç  æœ¬æ–‡é™„æœ‰ GitHub ä¸Šçš„å·¥ä½œä»£ç ç¤ºä¾‹ã€‚\nä»‹ç» Spring Boot ä¸ºæˆ‘ä»¬æä¾›äº†å¤„ç†å¼‚å¸¸çš„å·¥å…·ï¼Œè€Œä¸ä»…ä»…æ˜¯ç®€å•çš„â€œtry-catchâ€å—ã€‚ä¸ºäº†ä½¿ç”¨è¿™äº›å·¥å…·ï¼Œæˆ‘ä»¬åº”ç”¨äº†ä¸€äº›æ³¨é‡Šï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿå°†å¼‚å¸¸å¤„ç†è§†ä¸ºæ¨ªåˆ‡å…³æ³¨ç‚¹ï¼š\n@ResponseStatus @ExceptionHandler @ControllerAdvice åœ¨æ·±å…¥äº†è§£è¿™äº›æ³¨é‡Šä¹‹å‰ï¼Œæˆ‘ä»¬å°†é¦–å…ˆäº†è§£ Spring å¦‚ä½•å¤„ç† Web æ§åˆ¶å™¨æŠ›å‡ºçš„å¼‚å¸¸â€”â€”è¿™æ˜¯æ•è·å¼‚å¸¸çš„æœ€åä¸€é“é˜²çº¿ã€‚\næˆ‘ä»¬è¿˜å°†æŸ¥çœ‹ Spring Boot æä¾›çš„ä¸€äº›é…ç½®æ¥ä¿®æ”¹é»˜è®¤è¡Œä¸ºã€‚\næˆ‘ä»¬å°†ç¡®å®šè¿™æ ·åšæ—¶é¢ä¸´çš„æŒ‘æˆ˜ï¼Œç„¶åæˆ‘ä»¬å°†å°è¯•ä½¿ç”¨è¿™äº›æ³¨é‡Šæ¥å…‹æœè¿™äº›æŒ‘æˆ˜ã€‚\nSpring Boot é»˜è®¤çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º ProductController çš„æ§åˆ¶å™¨ï¼Œå½“æœªæ‰¾åˆ°å…·æœ‰ç»™å®š id çš„ Product æ—¶ï¼Œå…¶ getProduct(...) æ–¹æ³•ä¼šæŠ›å‡º NoSuchElementFoundException è¿è¡Œæ—¶å¼‚å¸¸ï¼š\n@RestController @RequestMapping(\u0026#34;/product\u0026#34;) public class ProductController { private final ProductService productService; //constructor omitted for brevity... @GetMapping(\u0026#34;/{id}\u0026#34;) public Response getProduct(@PathVariable String id){ // this method throws a \u0026#34;NoSuchElementFoundException\u0026#34; exception return productService.getProduct(id); } } å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ— æ•ˆçš„ id è°ƒç”¨ /product APIï¼ŒæœåŠ¡å°†æŠ›å‡º NoSuchElementFoundException è¿è¡Œæ—¶å¼‚å¸¸ï¼Œæˆ‘ä»¬å°†å¾—åˆ°ä»¥ä¸‹å“åº”ï¼š\n{ \u0026#34;timestamp\u0026#34;: \u0026#34;2020-11-28T13:24:02.239+00:00\u0026#34;, \u0026#34;status\u0026#34;: 500, \u0026#34;error\u0026#34;: \u0026#34;Internal Server Error\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;path\u0026#34;: \u0026#34;/product/1\u0026#34; } æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†æ ¼å¼è‰¯å¥½çš„é”™è¯¯å“åº”ä¹‹å¤–ï¼Œæœ‰æ•ˆè´Ÿè½½æ²¡æœ‰ä¸ºæˆ‘ä»¬æä¾›ä»»ä½•æœ‰ç”¨çš„ä¿¡æ¯ã€‚ç”šè‡³ message å­—æ®µä¹Ÿæ˜¯ç©ºçš„ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›åŒ…å«â€œæœªæ‰¾åˆ° id 1 çš„é¡¹ç›®â€ä¹‹ç±»çš„å†…å®¹ã€‚\nè®©æˆ‘ä»¬ä»ä¿®å¤é”™è¯¯æ¶ˆæ¯é—®é¢˜å¼€å§‹ã€‚\nSpring Boot æä¾›äº†ä¸€äº›å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒä»¬æ·»åŠ å¼‚å¸¸æ¶ˆæ¯ã€å¼‚å¸¸ç±»ï¼Œç”šè‡³å †æ ˆè·Ÿè¸ªä½œä¸ºå“åº”è´Ÿè½½çš„ä¸€éƒ¨åˆ†ï¼š","title":"[è¯‘]Spring Bootå¼‚å¸¸å¤„ç†å®Œæ•´æŒ‡å—"},{"content":"NullPointerExceptions ï¼ˆé€šå¸¸ç¼©å†™ä¸ºâ€œNPEâ€ï¼‰å¯¹äºæ¯ä¸ª Java ç¨‹åºå‘˜æ¥è¯´éƒ½æ˜¯ä¸€åœºå™©æ¢¦ã€‚\næˆ‘ä»¬å¯ä»¥åœ¨äº’è”ç½‘ä¸Šæ‰¾åˆ°å¤§é‡è§£é‡Šå¦‚ä½•ç¼–å†™ç©ºå®‰å…¨ä»£ç çš„æ–‡ç« ã€‚ç©ºå®‰å…¨ç¡®ä¿æˆ‘ä»¬åœ¨ä»£ç ä¸­æ·»åŠ äº†é€‚å½“çš„æ£€æŸ¥ï¼Œä»¥ä¿è¯å¯¹è±¡å¼•ç”¨ä¸èƒ½ä¸ºç©ºï¼Œæˆ–è€…æ¯•ç«Ÿåœ¨å¯¹è±¡ä¸ºç©ºæ—¶é‡‡å–å¯èƒ½çš„å®‰å…¨æªæ–½ã€‚\nç”±äº NullPointerException æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶å¼‚å¸¸ï¼Œå› æ­¤åœ¨ä»£ç ç¼–è¯‘è¿‡ç¨‹ä¸­å¾ˆéš¾æ‰¾å‡ºè¿™ç§æƒ…å†µã€‚ Java çš„ç±»å‹ç³»ç»Ÿæ²¡æœ‰åŠæ³•å¿«é€Ÿæ¶ˆé™¤å±é™©çš„ç©ºå¯¹è±¡å¼•ç”¨ã€‚\nå¹¸è¿çš„æ˜¯ï¼ŒSpring æ¡†æ¶æä¾›äº†ä¸€äº›æ³¨é‡Šæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨è¿™äº›æ³¨é‡Šé€šè¿‡ Spring Boot ç¼–å†™ç©ºå®‰å…¨ä»£ç ã€‚\nç¤ºä¾‹ä»£ç  æœ¬æ–‡é™„æœ‰ GitHub ä¸Šçš„å·¥ä½œä»£ç ç¤ºä¾‹ã€‚\nSpring ä¸­çš„ç©ºå®‰å…¨æ³¨è§£ åœ¨ Spring æ ¸å¿ƒåŒ… org.springframework.lang ä¸‹ï¼Œæœ‰ 4 ä¸ªè¿™æ ·çš„æ³¨è§£ï¼š\n@NonNull, @NonNull ï¼Œ @NonNullFields, @NonNullFields ï¼Œ @Nullable, @NonNullApi. Eclipse å’Œ IntelliJ IDEA ç­‰æµè¡Œçš„ IDE å¯ä»¥ç†è§£è¿™äº›æ³¨é‡Šã€‚å®ƒä»¬å¯ä»¥åœ¨ç¼–è¯‘æœŸé—´è­¦å‘Šå¼€å‘äººå‘˜æ½œåœ¨çš„é—®é¢˜ã€‚\næˆ‘ä»¬å°†åœ¨æœ¬æ•™ç¨‹ä¸­ä½¿ç”¨ IntelliJ IDEAã€‚è®©æˆ‘ä»¬é€šè¿‡ä¸€äº›ä»£ç ç¤ºä¾‹æ¥äº†è§£æ›´å¤šä¿¡æ¯ã€‚\nè¦åˆ›å»ºåŸºç¡€é¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Spring Initializrã€‚ Spring Boot å¯åŠ¨å™¨å°±æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ï¼Œä¸éœ€è¦æ·»åŠ ä»»ä½•é¢å¤–çš„ä¾èµ–é¡¹ã€‚\nIDE é…ç½® è¯·æ³¨æ„ï¼Œå¹¶éæ‰€æœ‰å¼€å‘å·¥å…·éƒ½å¯ä»¥æ˜¾ç¤ºè¿™äº›ç¼–è¯‘è­¦å‘Šã€‚å¦‚æœæ‚¨æ²¡æœ‰çœ‹åˆ°ç›¸å…³è­¦å‘Šï¼Œè¯·æ£€æŸ¥ IDE ä¸­çš„ç¼–è¯‘å™¨è®¾ç½®ã€‚\nIntelliJ å¯¹äº IntelliJï¼Œæˆ‘ä»¬å¯ä»¥åœ¨â€œBuild, Execution, Deployment -\u0026gt; Compilerâ€ä¸‹æ¿€æ´»æ³¨é‡Šæ£€æŸ¥ï¼š\nEclipse å¯¹äº Eclipseï¼Œæˆ‘ä»¬å¯ä»¥åœ¨â€œJava -\u0026gt; Compiler -\u0026gt; Errors/Warningsâ€ä¸‹æ‰¾åˆ°è®¾ç½®ï¼š\nç¤ºä¾‹ä»£ç  è®©æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ Employee ç±»æ¥ç†è§£æ³¨é‡Šï¼š\npackage io.reflectoring.nullsafety; // imports class Employee { String id; String name; LocalDate joiningDate; String pastEmployment; // standard constructor, getters, setters } @NonNull å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ id å­—æ®µï¼ˆåœ¨ Employee ç±»ä¸­ï¼‰å°†æ˜¯ä¸€ä¸ªä¸å¯ä¸º null çš„å€¼ã€‚å› æ­¤ï¼Œä¸ºäº†é¿å…ä»»ä½•æ½œåœ¨çš„ NullPointerException æˆ‘ä»¬å¯ä»¥å°†æ­¤å­—æ®µæ ‡è®°ä¸º @NonNull ï¼š\nclass Employee { @NonNull String id; //... } ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬ä¸å°å¿ƒå°è¯•åœ¨ä»£ç ä¸­çš„ä»»ä½•ä½ç½®å°† id çš„å€¼è®¾ç½®ä¸º nullï¼ŒIDE å°†æ˜¾ç¤ºç¼–è¯‘è­¦å‘Šï¼š\n@NonNull æ³¨é‡Šå¯ä»¥åœ¨æ–¹æ³•ã€å‚æ•°æˆ–å­—æ®µçº§åˆ«ä½¿ç”¨ã€‚**\næ­¤æ—¶ï¼Œæ‚¨å¯èƒ½ä¼šæƒ³â€œå¦‚æœä¸€ä¸ªç±»æœ‰å¤šä¸ªéç©ºå­—æ®µæ€ä¹ˆåŠï¼Ÿâ€ã€‚å¦‚æœæˆ‘ä»¬å¿…é¡»åœ¨æ¯ä¸€ä¸ªä¹‹å‰æ·»åŠ  @NonNull æ³¨é‡Šï¼Œæ˜¯ä¸æ˜¯å¤ªç½—å—¦äº†ï¼Ÿ\næˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ @NonNullFields æ³¨é‡Šæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\nä»¥ä¸‹æ˜¯ @NonNull çš„å¿«é€Ÿæ‘˜è¦ï¼š\nå¸¦æ³¨é‡Šçš„å…ƒç´  å½±å“ field å½“å­—æ®µä¸ºç©ºæ—¶æ˜¾ç¤ºè­¦å‘Š parameter å½“å‚æ•°ä¸ºç©ºæ—¶æ˜¾ç¤ºè­¦å‘Š method å½“æ–¹æ³•è¿”å› null æ—¶æ˜¾ç¤ºè­¦å‘Š package ä¸é€‚ç”¨ @NonNullFields è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª package-info.java æ–‡ä»¶ä»¥åœ¨åŒ…çº§åˆ«åº”ç”¨éç©ºå­—æ®µæ£€æŸ¥ã€‚è¯¥æ–‡ä»¶å°†åŒ…å«å¸¦æœ‰ @NonNullFields æ³¨é‡Šçš„æ ¹åŒ…åç§°ï¼š\n@NonNullFields package io.reflectoring.nullsafety; import org.springframework.lang.NonNullFields; ç°åœ¨ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦ä½¿ç”¨ @NonNull æ³¨é‡Šæ¥æ³¨é‡Šå­—æ®µã€‚å› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥åŒ…ä¸­ç±»çš„æ‰€æœ‰å­—æ®µç°åœ¨éƒ½è¢«è§†ä¸ºéç©ºã€‚è€Œä¸”ï¼Œæˆ‘ä»¬ä»ç„¶ä¼šçœ‹åˆ°ä¸ä»¥å‰ç›¸åŒçš„è­¦å‘Šï¼š\nè¿™é‡Œè¦æ³¨æ„çš„å¦ä¸€ç‚¹æ˜¯ï¼Œå¦‚æœæœ‰ä»»ä½•æœªåˆå§‹åŒ–çš„å­—æ®µï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†çœ‹åˆ°åˆå§‹åŒ–è¿™äº›å­—æ®µçš„è­¦å‘Šï¼š\nä»¥ä¸‹æ˜¯ @NonNullFields çš„å¿«é€Ÿæ‘˜è¦ï¼š\nå¸¦æ³¨é‡Šçš„å…ƒç´  å½±å“ field ä¸é€‚ç”¨ parameter ä¸é€‚ç”¨ method ä¸é€‚ç”¨ package å¦‚æœæ‰€åº”ç”¨çš„åŒ…çš„ä»»ä½•å­—æ®µä¸ºç©ºï¼Œåˆ™æ˜¾ç¤ºè­¦å‘Š @NonNullApi åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ‚¨å¯èƒ½å·²ç»å‘ç°äº†å¦ä¸€ä¸ªè¦æ±‚ï¼Œå³å¯¹æ–¹æ³•å‚æ•°æˆ–è¿”å›å€¼è¿›è¡Œç±»ä¼¼çš„æ£€æŸ¥ã€‚ @NonNullApi å°†ä¼šæ¥æ‹¯æ•‘æˆ‘ä»¬ã€‚\nä¸ @NonNullFields ç±»ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ package-info.java æ–‡ä»¶å¹¶ä¸ºç›®æ ‡åŒ…æ·»åŠ  @NonNullApi æ³¨é‡Šï¼š\n@NonNullApi package io.reflectoring.nullsafety; import org.springframework.lang.NonNullApi; ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬ç¼–å†™æ–¹æ³•è¿”å› null çš„ä»£ç ï¼š\npackage io.reflectoring.nullsafety; // imports class Employee { String getPastEmployment() { return null; } //... } æˆ‘ä»¬å¯ä»¥çœ‹åˆ° IDE ç°åœ¨è­¦å‘Šæˆ‘ä»¬æœ‰å…³ä¸å¯ä¸º null çš„è¿”å›å€¼ï¼š\nä»¥ä¸‹æ˜¯ @NonNullApi çš„å¿«é€Ÿæ‘˜è¦ï¼š\nå¸¦æ³¨é‡Šçš„å…ƒç´  å½±å“ field ä¸é€‚ç”¨ parameter ä¸é€‚ç”¨ method ä¸é€‚ç”¨ package å¦‚æœæ‰€åº”ç”¨çš„åŒ…çš„ä»»ä½•å‚æ•°æˆ–è¿”å›å€¼ä¸ºç©ºï¼Œåˆ™æ˜¾ç¤ºè­¦å‘Š @Nullable ä½†è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç‰¹å®šå­—æ®µå¯èƒ½ä¸ºç©ºï¼ˆæ— è®ºæˆ‘ä»¬å¤šä¹ˆæƒ³é¿å…å®ƒï¼‰ã€‚\nä¾‹å¦‚ï¼Œ pastEmployment å­—æ®µåœ¨ Employee ç±»ä¸­å¯ä»¥ä¸ºç©ºï¼ˆå¯¹äºä»¥å‰æ²¡æœ‰å·¥ä½œè¿‡çš„äººï¼‰ã€‚ä½†æ ¹æ®æˆ‘ä»¬çš„å®‰å…¨æ£€æŸ¥ï¼ŒIDE è®¤ä¸ºä¸å¯èƒ½ã€‚\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨å­—æ®µä¸Šçš„ @Nullable æ³¨é‡Šæ¥è¡¨è¾¾æˆ‘ä»¬çš„æ„å›¾ã€‚è¿™å°†å‘Šè¯‰ IDE è¯¥å­—æ®µåœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥ä¸ºç©ºï¼Œå› æ­¤æ— éœ€è§¦å‘è­¦æŠ¥ã€‚æ­£å¦‚ JavaDoc æ‰€å»ºè®®çš„ï¼š\nå¯ä»¥ä¸ @NonNullApi æˆ– @NonNullFields ç»“åˆä½¿ç”¨ï¼Œå°†é»˜è®¤çš„ä¸å¯ä¸ºç©ºè¯­ä¹‰è¦†ç›–ä¸ºå¯ä¸ºç©ºã€‚\nä¸ NonNull ç±»ä¼¼ï¼Œ Nullable æ³¨é‡Šå¯ä»¥åº”ç”¨äºæ–¹æ³•ã€å‚æ•°æˆ–å­—æ®µçº§åˆ«ã€‚\næˆ‘ä»¬ç°åœ¨å¯ä»¥å°† pastEmployment å­—æ®µæ ‡è®°ä¸ºå¯ä¸ºç©ºï¼š\npackage io.reflectoring.nullsafety; // imports class Employee { @Nullable String pastEmployment; @Nullable String getPastEmployment() { return pastEmployment; } //... } ä»¥ä¸‹æ˜¯ @Nullable çš„å¿«é€Ÿæ‘˜è¦ï¼š\nå¸¦æ³¨é‡Šçš„å…ƒç´  å½±å“ field è¡¨ç¤ºè¯¥å­—æ®µå¯ä»¥ä¸ºç©º parameter è¡¨ç¤ºå‚æ•°å¯ä»¥ä¸ºç©º method è¡¨ç¤ºè¯¥æ–¹æ³•å¯ä»¥è¿”å› null package ä¸é€‚ç”¨ è‡ªåŠ¨æ„å»ºæ£€æŸ¥ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æ­£åœ¨è®¨è®ºç°ä»£ IDE å¦‚ä½•ä½¿ç¼–å†™ç©ºå®‰å…¨ä»£ç å˜å¾—æ›´å®¹æ˜“ã€‚ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬æƒ³åœ¨æ„å»ºç®¡é“ä¸­è¿›è¡Œä¸€äº›è‡ªåŠ¨ä»£ç æ£€æŸ¥ï¼Œè¿™åœ¨æŸç§ç¨‹åº¦ä¸Šä¹Ÿæ˜¯å¯è¡Œçš„ã€‚\nSpotBugsï¼ˆè‘—åä½†å·²åºŸå¼ƒçš„ FindBugs é¡¹ç›®çš„è½¬ä¸–ï¼‰æä¾›äº†ä¸€ä¸ª Maven/Gradle æ’ä»¶ï¼Œå¯ä»¥æ£€æµ‹ç”±äºå¯ç©ºæ€§è€Œå¯¼è‡´çš„ä»£ç å¼‚å‘³ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨å®ƒã€‚\nå¯¹äº Maven é¡¹ç›®ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–° pom.xml ä»¥æ·»åŠ  SpotBugs Maven æ’ä»¶ï¼š\n\u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;com.github.spotbugs\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spotbugs-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.5.2.0\u0026lt;/version\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;!-- overwrite dependency on spotbugs if you want to specify the version of spotbugs --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.github.spotbugs\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spotbugs\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.5.3\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;/plugin\u0026gt; æ„å»ºé¡¹ç›®åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¥æ’ä»¶çš„ä»¥ä¸‹ç›®æ ‡ï¼š\nspotbugs ç›®æ ‡åˆ†æç›®æ ‡é¡¹ç›®ã€‚\ncheck ç›®æ ‡è¿è¡Œ spotbugs ç›®æ ‡ï¼Œå¦‚æœå‘ç°ä»»ä½•é”™è¯¯ï¼Œåˆ™ä½¿æ„å»ºå¤±è´¥ã€‚\nå¦‚æœæ‚¨ä½¿ç”¨ Gradle è€Œä¸æ˜¯ Mavenï¼Œåˆ™å¯ä»¥åœ¨ build.gradle æ–‡ä»¶ä¸­é…ç½® SpotBugs Gradle æ’ä»¶ï¼š\ndependencies { spotbugsPlugins \u0026#39;com.h3xstream.findsecbugs:findsecbugs-plugin:1.11.0\u0026#39; } spotbugs { toolVersion = \u0026#39;4.5.3\u0026#39; } é¡¹ç›®æ›´æ–°åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ gradle check å‘½ä»¤è¿è¡Œæ£€æŸ¥ã€‚\nSpotBugs æä¾›äº†ä¸€äº›è§„åˆ™ï¼Œé€šè¿‡åœ¨ Maven æ„å»ºæœŸé—´å¤„ç† @NonNull æ³¨é‡Šæ¥æ ‡è®°æ½œåœ¨é—®é¢˜ã€‚æ‚¨å¯ä»¥æŸ¥çœ‹é”™è¯¯æè¿°çš„è¯¦ç»†åˆ—è¡¨ã€‚\nä¾‹å¦‚ï¼Œå¦‚æœä»»ä½•ç”¨ @NonNull æ³¨é‡Šçš„æ–¹æ³•æ„å¤–è¿”å› nullï¼Œåˆ™ SpotBugs æ£€æŸ¥å°†å¤±è´¥ï¼Œå¹¶æ˜¾ç¤ºç±»ä¼¼ä»¥ä¸‹å†…å®¹çš„é”™è¯¯ï¼š\n[ERROR] High: io.reflectoring.nullsafety.Employee.getJoiningDate() may return null, but is declared @Nonnull [io.reflectoring.nullsafety.Employee] At Employee.java:[line 36] NP_NONNULL_RETURN_VIOLATION ç»“è®º è¿™äº›æ³¨è§£å¯¹äº Java ç¨‹åºå‘˜æ¥è¯´ç¡®å®æ˜¯ä¸€ä¸ªç¦éŸ³ï¼Œå¯ä»¥å‡å°‘è¿è¡Œæ—¶å‡ºç° NullPointerException çš„å¯èƒ½æ€§ã€‚ä½†æ˜¯è¯·è®°ä½ï¼Œè¿™å¹¶ä¸èƒ½ä¿è¯å®Œå…¨çš„ç©ºå®‰å…¨ã€‚\nKotlin ä½¿ç”¨è¿™äº›æ³¨é‡Šæ¥æ¨æ–­ Spring API çš„å¯ä¸ºç©ºæ€§ã€‚\næˆ‘å¸Œæœ›æ‚¨ç°åœ¨å·²ç»å‡†å¤‡å¥½åœ¨ Spring Boot ä¸­ç¼–å†™ null å®‰å…¨ä»£ç ï¼\nåŸæ–‡é“¾æ¥ï¼šhttps://reflectoring.io/spring-boot-null-safety-annotations/\n","permalink":"https://blog.chensoul.cc/posts/2023/07/26/spring-boot-null-safety-annotations/","summary":"NullPointerExceptions ï¼ˆé€šå¸¸ç¼©å†™ä¸ºâ€œNPEâ€ï¼‰å¯¹äºæ¯ä¸ª Java ç¨‹åºå‘˜æ¥è¯´éƒ½æ˜¯ä¸€åœºå™©æ¢¦ã€‚\næˆ‘ä»¬å¯ä»¥åœ¨äº’è”ç½‘ä¸Šæ‰¾åˆ°å¤§é‡è§£é‡Šå¦‚ä½•ç¼–å†™ç©ºå®‰å…¨ä»£ç çš„æ–‡ç« ã€‚ç©ºå®‰å…¨ç¡®ä¿æˆ‘ä»¬åœ¨ä»£ç ä¸­æ·»åŠ äº†é€‚å½“çš„æ£€æŸ¥ï¼Œä»¥ä¿è¯å¯¹è±¡å¼•ç”¨ä¸èƒ½ä¸ºç©ºï¼Œæˆ–è€…æ¯•ç«Ÿåœ¨å¯¹è±¡ä¸ºç©ºæ—¶é‡‡å–å¯èƒ½çš„å®‰å…¨æªæ–½ã€‚\nç”±äº NullPointerException æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶å¼‚å¸¸ï¼Œå› æ­¤åœ¨ä»£ç ç¼–è¯‘è¿‡ç¨‹ä¸­å¾ˆéš¾æ‰¾å‡ºè¿™ç§æƒ…å†µã€‚ Java çš„ç±»å‹ç³»ç»Ÿæ²¡æœ‰åŠæ³•å¿«é€Ÿæ¶ˆé™¤å±é™©çš„ç©ºå¯¹è±¡å¼•ç”¨ã€‚\nå¹¸è¿çš„æ˜¯ï¼ŒSpring æ¡†æ¶æä¾›äº†ä¸€äº›æ³¨é‡Šæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨è¿™äº›æ³¨é‡Šé€šè¿‡ Spring Boot ç¼–å†™ç©ºå®‰å…¨ä»£ç ã€‚\nç¤ºä¾‹ä»£ç  æœ¬æ–‡é™„æœ‰ GitHub ä¸Šçš„å·¥ä½œä»£ç ç¤ºä¾‹ã€‚\nSpring ä¸­çš„ç©ºå®‰å…¨æ³¨è§£ åœ¨ Spring æ ¸å¿ƒåŒ… org.springframework.lang ä¸‹ï¼Œæœ‰ 4 ä¸ªè¿™æ ·çš„æ³¨è§£ï¼š\n@NonNull, @NonNull ï¼Œ @NonNullFields, @NonNullFields ï¼Œ @Nullable, @NonNullApi. Eclipse å’Œ IntelliJ IDEA ç­‰æµè¡Œçš„ IDE å¯ä»¥ç†è§£è¿™äº›æ³¨é‡Šã€‚å®ƒä»¬å¯ä»¥åœ¨ç¼–è¯‘æœŸé—´è­¦å‘Šå¼€å‘äººå‘˜æ½œåœ¨çš„é—®é¢˜ã€‚\næˆ‘ä»¬å°†åœ¨æœ¬æ•™ç¨‹ä¸­ä½¿ç”¨ IntelliJ IDEAã€‚è®©æˆ‘ä»¬é€šè¿‡ä¸€äº›ä»£ç ç¤ºä¾‹æ¥äº†è§£æ›´å¤šä¿¡æ¯ã€‚\nè¦åˆ›å»ºåŸºç¡€é¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Spring Initializrã€‚ Spring Boot å¯åŠ¨å™¨å°±æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ï¼Œä¸éœ€è¦æ·»åŠ ä»»ä½•é¢å¤–çš„ä¾èµ–é¡¹ã€‚\nIDE é…ç½® è¯·æ³¨æ„ï¼Œå¹¶éæ‰€æœ‰å¼€å‘å·¥å…·éƒ½å¯ä»¥æ˜¾ç¤ºè¿™äº›ç¼–è¯‘è­¦å‘Šã€‚å¦‚æœæ‚¨æ²¡æœ‰çœ‹åˆ°ç›¸å…³è­¦å‘Šï¼Œè¯·æ£€æŸ¥ IDE ä¸­çš„ç¼–è¯‘å™¨è®¾ç½®ã€‚\nIntelliJ å¯¹äº IntelliJï¼Œæˆ‘ä»¬å¯ä»¥åœ¨â€œBuild, Execution, Deployment -\u0026gt; Compilerâ€ä¸‹æ¿€æ´»æ³¨é‡Šæ£€æŸ¥ï¼š\nEclipse å¯¹äº Eclipseï¼Œæˆ‘ä»¬å¯ä»¥åœ¨â€œJava -\u0026gt; Compiler -\u0026gt; Errors/Warningsâ€ä¸‹æ‰¾åˆ°è®¾ç½®ï¼š\nç¤ºä¾‹ä»£ç  è®©æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ Employee ç±»æ¥ç†è§£æ³¨é‡Šï¼š\npackage io.reflectoring.nullsafety; // imports class Employee { String id; String name; LocalDate joiningDate; String pastEmployment; // standard constructor, getters, setters } @NonNull å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ id å­—æ®µï¼ˆåœ¨ Employee ç±»ä¸­ï¼‰å°†æ˜¯ä¸€ä¸ªä¸å¯ä¸º null çš„å€¼ã€‚å› æ­¤ï¼Œä¸ºäº†é¿å…ä»»ä½•æ½œåœ¨çš„ NullPointerException æˆ‘ä»¬å¯ä»¥å°†æ­¤å­—æ®µæ ‡è®°ä¸º @NonNull ï¼š","title":"[è¯‘]ä½¿ç”¨ Spring çš„ Null-Safety æ³¨è§£ä¿æŠ¤æ‚¨çš„ä»£ç å…å— NullPointerExceptions çš„å½±å“"},{"content":"è·¨æºèµ„æºå…±äº« (CORS) æ˜¯ä¸€ç§åŸºäº HTTP æ ‡å¤´çš„æœºåˆ¶ï¼Œå…è®¸æœåŠ¡å™¨æ˜¾å¼å°†æŸäº›æºåˆ—å…¥ç™½åå•ï¼Œå¹¶å¸®åŠ©ç»•è¿‡åŒæºç­–ç•¥ã€‚\nè¿™æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºæµè§ˆå™¨é»˜è®¤åº”ç”¨åŒæºç­–ç•¥ä»¥ç¡®ä¿å®‰å…¨ã€‚é€šè¿‡åœ¨ Web åº”ç”¨ç¨‹åºä¸­å®æ–½ CORSï¼Œç½‘é¡µå¯ä»¥è¯·æ±‚é¢å¤–çš„èµ„æºå¹¶ä»å…¶ä»–åŸŸåŠ è½½åˆ°æµè§ˆå™¨ä¸­ã€‚\næœ¬æ–‡å°†é‡ç‚¹ä»‹ç»åœ¨åŸºäº Spring çš„åº”ç”¨ç¨‹åºä¸­å®ç° CORS çš„å„ç§æ–¹å¼ã€‚è¦è¯¦ç»†äº†è§£ CORS çš„å·¥ä½œåŸç†ï¼Œè¯·å‚é˜…è¿™ç¯‡ä¼˜ç§€çš„ä»‹ç»æ€§æ–‡ç« ã€‚\nç¤ºä¾‹ä»£ç  æœ¬æ–‡é™„æœ‰ GitHub ä¸Šçš„å·¥ä½œä»£ç ç¤ºä¾‹ã€‚\nCORS ç‰¹å®š HTTP å“åº”æ ‡å¤´æ¦‚è¿° CORS è§„èŒƒå®šä¹‰äº†æœåŠ¡å™¨è¿”å›çš„ä¸€ç»„å“åº”æ ‡å¤´ï¼Œè¿™å°†æ˜¯åç»­éƒ¨åˆ†çš„é‡ç‚¹ã€‚\nå“åº”å¤´ æè¿° Access-Control-Allow-Origin ä»¥é€—å·åˆ†éš”çš„ç™½åå•æ¥æºåˆ—è¡¨æˆ–â€œ*â€ã€‚ Access-Control-Allow-Methods Web æœåŠ¡å™¨å…è®¸è·¨æºè¯·æ±‚çš„ HTTP æ–¹æ³•çš„é€—å·åˆ†éš”åˆ—è¡¨ã€‚ Access-Control-Allow-Headers Web æœåŠ¡å™¨å…è®¸è·¨æºè¯·æ±‚çš„ HTTP æ ‡å¤´çš„é€—å·åˆ†éš”åˆ—è¡¨ã€‚ Access-Control-Expose-Headers å®¢æˆ·ç«¯è„šæœ¬è®¤ä¸ºå¯ä»¥å®‰å…¨æ˜¾ç¤ºçš„ä»¥é€—å·åˆ†éš”çš„ HTTP æ ‡å¤´åˆ—è¡¨ã€‚ Access-Control-Allow-Credentials å¦‚æœæµè§ˆå™¨é€šè¿‡ä¼ é€’å‡­æ®ï¼ˆä»¥ cookie æˆ–æˆæƒæ ‡å¤´çš„å½¢å¼ï¼‰å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œåˆ™å…¶å€¼è®¾ç½®ä¸º true ã€‚ Access-Control-Max-Age æŒ‡ç¤ºé¢„æ£€è¯·æ±‚çš„ç»“æœå¯ä»¥ç¼“å­˜å¤šé•¿æ—¶é—´ã€‚ è®¾ç½®ç¤ºä¾‹å®¢æˆ·ç«¯åº”ç”¨ç¨‹åº æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªç®€å•çš„è§’åº¦åº”ç”¨ç¨‹åºæ¥è°ƒç”¨ REST ç«¯ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æµè§ˆå™¨å¼€å‘äººå‘˜å·¥å…·æ£€æŸ¥è¿™äº›ç«¯ç‚¹ã€‚æ‚¨å¯ä»¥åœ¨ GitHub ä¸ŠæŸ¥çœ‹æºä»£ç ã€‚\nng serve --open æˆ‘ä»¬åº”è¯¥èƒ½å¤ŸæˆåŠŸå¯åŠ¨å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºã€‚\nè®¾ç½®ç¤ºä¾‹æœåŠ¡å™¨åº”ç”¨ç¨‹åº æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªåŸºäº Spring çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­åŒ…å«å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå¯ä»¥è°ƒç”¨çš„ GET å’Œ POST è¯·æ±‚ã€‚è¯·æ³¨æ„ï¼Œæ‚¨ä¼šå‘ç°ä¸¤ä¸ªç‹¬ç«‹çš„åº”ç”¨ç¨‹åºï¼šä¸€ä¸ªä½¿ç”¨ Spring MVC (REST)ï¼Œå¦ä¸€ä¸ªä½¿ç”¨ Spring Reactive å †æ ˆã€‚\nä¸ºç®€å•èµ·è§ï¼Œä¸¤ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´çš„ CORS é…ç½®ç›¸åŒï¼Œå¹¶ä¸”å®šä¹‰äº†ç›¸åŒçš„ç«¯ç‚¹ã€‚ä¸¤å°æœåŠ¡å™¨éƒ½ä»ä¸åŒçš„ç«¯å£ 8091 å’Œ 8092 å¯åŠ¨ã€‚\nä¸åº”ç”¨ç¨‹åºæ†ç»‘åœ¨ä¸€èµ·çš„ Maven Wrapper å°†ç”¨äºå¯åŠ¨æœåŠ¡ã€‚æ‚¨å¯ä»¥æŸ¥çœ‹ Spring REST æºä»£ç å’Œ Spring Reactive æºä»£ç ã€‚\nmvnw clean verify spring-boot:run (for Windows) ./mvnw clean verify spring-boot:run (for Linux) ä¸€æ—¦ Spring åº”ç”¨ç¨‹åºæˆåŠŸå¯åŠ¨ï¼Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºåº”è¯¥èƒ½å¤ŸæˆåŠŸä»æœåŠ¡å™¨åŠ è½½æ•°æ®ã€‚\nè°ƒç”¨ Spring REST æœåŠ¡å™¨ï¼š\nè°ƒç”¨ Spring Reactive æœåŠ¡å™¨ï¼š\näº†è§£ @CrossOrigin å±æ€§ åœ¨ Spring Boot åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ @CrossOrigin æ³¨è§£æ¥å¯ç”¨è·¨åŸŸè°ƒç”¨ã€‚æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ @CrossOrigin æ”¯æŒçš„å±æ€§ã€‚\nå±æ€§ Description æè¿° origins å…è®¸æ‚¨æŒ‡å®šå…è®¸çš„æ¥æºåˆ—è¡¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå…è®¸æ‰€æœ‰æ¥æºã€‚ è¯¥å±æ€§å€¼å°†åœ¨é¢„æ£€å“åº”å’Œå®é™…å“åº”çš„ Access-Control-Allow-Origin æ ‡å¤´ä¸­è®¾ç½®ã€‚ ç”¨æ³•ç¤ºä¾‹ï¼š @CrossOrigin(origins = \u0026quot;http://localhost:8080\u0026quot;) @CrossOrigin(origins = {\u0026quot;http://localhost:8080\u0026quot;, \u0026quot;http://testserver:8087\u0026quot;}) allowedHeaders å…è®¸æ‚¨æŒ‡å®šæµè§ˆå™¨å‘å‡ºè¯·æ±‚æ—¶å°†æ¥å—çš„æ ‡å¤´åˆ—è¡¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä»»ä½•æ ‡å¤´éƒ½å°†è¢«å…è®¸ã€‚æ­¤å±æ€§ä¸­æŒ‡å®šçš„å€¼ç”¨äºé¢„æ£€å“åº”ä¸­çš„ Access-Control-Allow-Headers ä¸­ã€‚ ç”¨æ³•ç¤ºä¾‹ï¼š @CrossOrigin(allowedHeaders = {\u0026quot;Authorization\u0026quot;, \u0026quot;Origin\u0026quot;}) exposedHeaders åœ¨å®é™…å“åº”æ ‡å¤´ä¸­è®¾ç½®çš„æ ‡å¤´åˆ—è¡¨ã€‚å¦‚æœæœªæŒ‡å®šï¼Œåˆ™åªæœ‰å®‰å…¨åˆ—è¡¨ä¸­çš„æ ‡å¤´æ‰ä¼šè¢«è®¤ä¸ºå¯ä»¥å®‰å…¨åœ°ç”±å®¢æˆ·ç«¯è„šæœ¬å…¬å¼€ã€‚ ç”¨æ³•ç¤ºä¾‹ï¼š @CrossOrigin(exposedHeaders = {\u0026quot;Access-Control-Allow-Origin\u0026quot;,\u0026quot;Access-Control-Allow-Credentials\u0026quot;}) allowCredentials å½“éœ€è¦å‡­æ®æ¥è°ƒç”¨ API æ—¶ï¼Œè¯·å°† Access-Control-Allow-Credentials æ ‡å¤´å€¼è®¾ç½®ä¸º trueã€‚å¦‚æœä¸éœ€è¦å‡­æ®ï¼Œè¯·çœç•¥æ ‡å¤´ã€‚ ç”¨æ³•ç¤ºä¾‹ï¼š @CrossOrigin(allowCredentials = true) maxAge é»˜è®¤ maxAge è®¾ç½®ä¸º 1800 ç§’ï¼ˆ30 åˆ†é’Ÿï¼‰ã€‚æŒ‡ç¤ºé¢„æ£€å“åº”å¯ä»¥ç¼“å­˜å¤šé•¿æ—¶é—´ã€‚ ç”¨æ³•ç¤ºä¾‹ï¼š @CrossOrigin(maxAge = 300) å¦‚æœä¸é…ç½® CORS æ€ä¹ˆåŠï¼Ÿ è€ƒè™‘æˆ‘ä»¬çš„ Spring Boot åº”ç”¨ç¨‹åºå°šæœªé…ç½®ä¸º CORS æ”¯æŒã€‚å¦‚æœæˆ‘ä»¬å°è¯•è®¿é—®åœ¨ç«¯å£ 4200 ä¸Šè¿è¡Œçš„ Angular åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬ä¼šåœ¨å¼€å‘äººå‘˜æ§åˆ¶å°ä¸Šçœ‹åˆ°ä»¥ä¸‹é”™è¯¯ï¼š\nAccess to XMLHttpRequest at http://localhost:8091 from origin http://localhost:4200 has been blocked by CORS policy: No \u0026#39;Access-Control-Allow-Origin` header is present on the requested resource è¿™æ˜¯å› ä¸ºï¼Œå³ä½¿ä¸¤ä¸ªåº”ç”¨ç¨‹åºå‡ç”± localhost æä¾›æœåŠ¡ï¼Œä½†ç”±äºç«¯å£ä¸åŒï¼Œå®ƒä»¬ä¸ä¼šè¢«è§†ä¸ºåŒä¸€æ¥æºã€‚\nåœ¨ Spring Web MVC åº”ç”¨ç¨‹åºä¸­é…ç½® CORS ä½¿ç”¨ Spring Initializr åˆ›å»ºçš„åˆå§‹è®¾ç½®åŒ…å«æ‰€æœ‰å¿…éœ€çš„ CORS ä¾èµ–é¡¹ã€‚æ— éœ€æ·»åŠ å¤–éƒ¨ä¾èµ–é¡¹ã€‚è¯·å‚é˜…æ­¤ç¤ºä¾‹ Spring Web åº”ç”¨ç¨‹åºé¡¹ç›®ã€‚\nåœ¨ç±»çº§åˆ«å®šä¹‰ @CrossOrigin @CrossOrigin(maxAge = 3600) @RestController @RequestMapping(\u0026#34;cors-library/managed/books\u0026#34;) public class LibraryController {} ç”±äºæˆ‘ä»¬å·²ç»å®šä¹‰äº† @CrossOrigin ï¼š\næ§åˆ¶å™¨ä¸­çš„æ‰€æœ‰ @RequestMapping æ–¹æ³•ï¼ˆä»¥åŠä½¿ç”¨é€Ÿè®°æ³¨é‡Š @GetMapping ã€ @PostMapping ç­‰çš„æ–¹æ³•ï¼‰éƒ½å°†æ¥å—è·¨åŸŸè¯·æ±‚ã€‚ è‡ª maxAge = 3600 èµ·ï¼Œæ‰€æœ‰é£è¡Œå‰å“åº”å°†è¢«ç¼“å­˜ 60 åˆ†é’Ÿã€‚ åœ¨æ–¹æ³•çº§åˆ«å®šä¹‰ @CrossOrigin @CrossOrigin(origins = \u0026#34;http://localhost:4200\u0026#34;, allowedHeaders = \u0026#34;Requestor-Type\u0026#34;, exposedHeaders = \u0026#34;X-Get-Header\u0026#34;) @GetMapping public ResponseEntity\u0026lt;List\u0026lt;BookDto\u0026gt;\u0026gt; getBooks(@RequestParam String type) { HttpHeaders headers = new HttpHeaders(); headers.set(\u0026#34;X-Get-Header\u0026#34;, \u0026#34;ExampleHeader\u0026#34;); return ResponseEntity.ok().headers(headers).body(libraryService.getAllBooks(type)); } è¿™å°†äº§ç”Ÿä»¥ä¸‹æ•ˆæœï¼š\nä»…æ¥å—æ¥è‡ªæ¥æº http://localhost:4200 çš„è¯·æ±‚ã€‚\nå¦‚æœæˆ‘ä»¬å¸Œæœ›åªæ¥å—æŸäº›æ ‡å¤´ï¼Œåˆ™å¯ä»¥åœ¨ allowedHeaders å±æ€§ä¸­æŒ‡å®šè¿™äº›æ ‡å¤´ã€‚å¦‚æœæµè§ˆå™¨æœªå‘é€ Requestor-Type æ ‡å¤´ï¼Œåˆ™ä¸ä¼šå¤„ç†è¯¥è¯·æ±‚ã€‚\nå¦‚æœæˆ‘ä»¬è®¾ç½®æŸäº›å“åº”æ ‡å¤´ï¼Œä¸ºäº†è®©å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºèƒ½å¤Ÿä½¿ç”¨å®ƒä»¬ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ exposedHeaders å±æ€§æ˜¾å¼è®¾ç½®è¦å…¬å¼€çš„å“åº”æ ‡å¤´åˆ—è¡¨ã€‚\nç±»å’Œæ–¹æ³•çº§åˆ«çš„ @CrossOrigin ç»„åˆ @CrossOrigin(maxAge = 3600) @RestController @RequestMapping(\u0026#34;cors-library/managed/books\u0026#34;) public class LibraryController { private static final Logger log = LoggerFactory.getLogger(LibraryController.class); private final LibraryService libraryService; public LibraryController(LibraryService libraryService) { this.libraryService = libraryService; } @CrossOrigin(origins = \u0026#34;http://localhost:4200\u0026#34;, allowedHeaders = \u0026#34;Requestor-Type\u0026#34;) @GetMapping public ResponseEntity\u0026lt;List\u0026lt;BookDto\u0026gt;\u0026gt; getBooks(@RequestParam String type) { HttpHeaders headers = new HttpHeaders(); headers.set(\u0026#34;X-Get-Header\u0026#34;, \u0026#34;ExampleHeader\u0026#34;); return ResponseEntity.ok().headers(headers).body(libraryService.getAllBooks(type)); } } é€šè¿‡åœ¨ç±»å’Œæ–¹æ³•çº§åˆ«å®šä¹‰æ³¨é‡Šï¼Œå…¶ç»„åˆå±æ€§å°†åº”ç”¨äºæ–¹æ³•ï¼Œå³ï¼ˆ origins ã€ allowedHeaders ã€``ï¼‰\nåœ¨ä¸Šè¿°æ‰€æœ‰æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ @CrossOrigin å®šä¹‰å…¨å±€ CORS cmaxAgeonconfiguration å’Œæœ¬åœ°é…ç½®ã€‚å¯¹äºæ¥å—å¤šä¸ªå€¼çš„å±æ€§ï¼Œå°†åº”ç”¨å…¨å±€å€¼å’Œæœ¬åœ°å€¼çš„ç»„åˆï¼ˆå³å®ƒä»¬è¢«åˆå¹¶ï¼‰ã€‚å¯¹äºä»…æ¥å—å•ä¸ªå€¼çš„å±æ€§ï¼Œæœ¬åœ°å€¼å°†ä¼˜å…ˆäºå…¨å±€å€¼ã€‚\nå…¨å±€å¯ç”¨ CORS æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªé€‚ç”¨äºå®šä¹‰çš„æ‰€æœ‰èµ„æºçš„é€šç”¨ CORS é…ç½®ï¼Œè€Œä¸æ˜¯åˆ†åˆ«å‘æ¯ä¸ªèµ„æºæ·»åŠ  CORSã€‚\nåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ WebMvcConfigurer ï¼Œå®ƒæ˜¯ Spring Web MVC åº“çš„ä¸€éƒ¨åˆ†\né€šè¿‡é‡å†™ addCorsMapping() æ–¹æ³•ï¼Œæˆ‘ä»¬å°†ä¸º Spring Web MVC å¤„ç†çš„æ‰€æœ‰ URL é…ç½® CORSã€‚\nä¸ºäº†å…¨å±€å®šä¹‰ç›¸åŒçš„é…ç½®ï¼ˆå¦‚å‰å‡ èŠ‚æ‰€è¿°ï¼‰ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ application.yml ä¸­å®šä¹‰çš„é…ç½®å‚æ•°æ¥åˆ›å»ºä¸€ä¸ª beanï¼Œå¦‚ä¸‹å®šä¹‰ã€‚\napplication.yml ä¸­å®šä¹‰çš„å±æ€§ï¼ˆ allowed-origins ã€ allowed-methods ã€ max-age ã€ allowed-headers ã€ exposed-headers ) æ˜¯é€šè¿‡ @ConfigurationProperties(prefix = \u0026quot;web\u0026quot;) æ˜ å°„åˆ°è‡ªå®šä¹‰ç±» Cors çš„è‡ªå®šä¹‰å±æ€§\nweb: cors: allowed-origins: \u0026#34;http://localhost:4200\u0026#34; allowed-methods: GET, POST, PATCH, PUT, DELETE, OPTIONS, HEAD max-age: 3600 allowed-headers: \u0026#34;Requestor-Type\u0026#34; exposed-headers: \u0026#34;X-Get-Header\u0026#34; @Bean public WebMvcConfigurer corsMappingConfigurer() { return new WebMvcConfigurer() { @Override public void addCorsMappings(CorsRegistry registry) { WebConfigProperties.Cors cors = webConfigProperties.getCors(); registry.addMapping(\u0026#34;/**\u0026#34;) .allowedOrigins(cors.getAllowedOrigins()) .allowedMethods(cors.getAllowedMethods()) .maxAge(cors.getMaxAge()) .allowedHeaders(cors.getAllowedHeaders()) .exposedHeaders(cors.getExposedHeaders()); } }; } CorsConfiguration é»˜è®¤å€¼ å¦‚æœæœªæ˜¾å¼å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªæ–¹æ³•ï¼ˆ allowedOrigins ã€ allowedMethods ã€ maxAge ã€ allowedHeaders ã€ exposedHeaders ï¼‰ï¼Œåˆ™ addMapping() è¿”å›ä¸€ä¸ª CorsRegistration å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åº”ç”¨é»˜è®¤çš„ CorsConfiguration ã€‚è¯·å‚é˜… Spring åº“æ–¹æ³• CorsConfiguration.applyPermitDefaultValues() ä»¥äº†è§£åº”ç”¨çš„é»˜è®¤å€¼ã€‚\nåœ¨ Spring Webflux åº”ç”¨ç¨‹åºä¸­é…ç½® CORS åˆå§‹è®¾ç½®æ˜¯ä½¿ç”¨ Spring Initializr åˆ›å»ºçš„ï¼Œå¹¶ä½¿ç”¨ Spring Webfluxã€Spring Data R2DBC å’Œ H2 æ•°æ®åº“ã€‚æ— éœ€æ·»åŠ å¤–éƒ¨ä¾èµ–é¡¹ã€‚è¯·å‚é˜…æ­¤ç¤ºä¾‹ Spring Webflux é¡¹ç›®ã€‚\nä½¿ç”¨ @CrossOrigin è¿›è¡Œ Spring Webflux çš„ CORS é…ç½® ä¸ Spring MVC ç±»ä¼¼ï¼Œåœ¨ Spring Webflux ä¸­æˆ‘ä»¬å¯ä»¥åœ¨ç±»çº§åˆ«æˆ–æ–¹æ³•çº§åˆ«å®šä¹‰ @CrossOrigin ã€‚å‰é¢å‡ èŠ‚ä¸­æè¿°çš„ç›¸åŒ @CrossOrigin å±æ€§å°†é€‚ç”¨ã€‚æ­¤å¤–ï¼Œå½“åœ¨ç±»å’Œæ–¹æ³•ä¸­éƒ½å®šä¹‰äº†æ³¨é‡Šæ—¶ï¼Œå…¶ç»„åˆå±æ€§å°†åº”ç”¨äºæ–¹æ³•ã€‚\n@CrossOrigin(origins = \u0026#34;http://localhost:4200\u0026#34;, allowedHeaders = \u0026#34;Requestor-Type\u0026#34;, exposedHeaders = \u0026#34;X-Get-Header\u0026#34;) @GetMapping public ResponseEntity\u0026lt;Mono\u0026lt;List\u0026lt;BookDto\u0026gt;\u0026gt;\u0026gt; getBooks(@RequestParam String type) { HttpHeaders headers = new HttpHeaders(); headers.set(\u0026#34;X-Get-Header\u0026#34;, \u0026#34;ExampleHeader\u0026#34;); return ResponseEntity.ok().headers(headers).body(libraryService.getAllBooks(type)); } åœ¨ Spring Webflux ä¸­å…¨å±€å¯ç”¨ CORS é…ç½® è¦åœ¨ Spring Webflux åº”ç”¨ç¨‹åºä¸­å…¨å±€å®šä¹‰ CORSï¼Œæˆ‘ä»¬ä½¿ç”¨ WebfluxConfigurer å¹¶è¦†ç›– addCorsMappings() ã€‚ä¸ Spring MVC ç±»ä¼¼ï¼Œå®ƒä½¿ç”¨å¸¦æœ‰é»˜è®¤å€¼çš„ CorsConfiguration ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è¦†ç›–é»˜è®¤å€¼ã€‚\n@Bean public WebFluxConfigurer corsMappingConfigurer() { return new WebFluxConfigurer() { @Override public void addCorsMappings(CorsRegistry registry) { WebConfigProperties.Cors cors = webConfigProperties.getCors(); registry.addMapping(\u0026#34;/**\u0026#34;) .allowedOrigins(cors.getAllowedOrigins()) .allowedMethods(cors.getAllowedMethods()) .maxAge(cors.getMaxAge()) .allowedHeaders(cors.getAllowedHeaders()) .exposedHeaders(cors.getExposedHeaders()); } }; } ä½¿ç”¨ WebFilter å¯ç”¨ CORS Webflux æ¡†æ¶å…è®¸é€šè¿‡ CorsWebFilter å…¨å±€è®¾ç½® CORS é…ç½®ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ CorsConfiguration å¯¹è±¡æ¥è®¾ç½®æ‰€éœ€çš„é…ç½®å¹¶æ³¨å†Œè¦ä¸è¿‡æ»¤å™¨ä¸€èµ·ä½¿ç”¨çš„ CorsConfigurationSource ã€‚\nä½†æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿‡æ»¤å™¨ä¸­çš„ CorsConfiguration ä¸ä¼šå°†é»˜è®¤é…ç½®åˆ†é…ç»™ç«¯ç‚¹ï¼åªèƒ½åº”ç”¨æŒ‡å®šçš„é…ç½®ã€‚\nå¦ä¸€ç§é€‰æ‹©æ˜¯æ˜¾å¼è°ƒç”¨ CorsConfiguration.applyPermitDefaultValues() ã€‚\n@Bean public CorsWebFilter corsWebFilter() { CorsConfiguration corsConfig = new CorsConfiguration(); corsConfig.setAllowedOrigins(Arrays.asList(\u0026#34;http://localhost:4200\u0026#34;)); corsConfig.setMaxAge(3600L); corsConfig.addAllowedMethod(\u0026#34;*\u0026#34;); corsConfig.addAllowedHeader(\u0026#34;Requestor-Type\u0026#34;); corsConfig.addExposedHeader(\u0026#34;X-Get-Header\u0026#34;); UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource(); source.registerCorsConfiguration(\u0026#34;/**\u0026#34;, corsConfig); return new CorsWebFilter(source); } ä½¿ç”¨ Spring Security å¯ç”¨ CORS å¦‚æœ Spring Security åº”ç”¨äº Spring åº”ç”¨ç¨‹åºï¼Œåˆ™å¿…é¡»åœ¨ Spring Security ç”Ÿæ•ˆä¹‹å‰å¤„ç† CORSï¼Œå› ä¸ºé¢„æ£€è¯·æ±‚ä¸ä¼šåŒ…å« cookieï¼Œå¹¶ä¸” Spring Security å°†æ‹’ç»è¯¥è¯·æ±‚ï¼Œå› ä¸ºå®ƒå°†ç¡®å®šç”¨æˆ·æœªç»è¿‡èº«ä»½éªŒè¯ã€‚è¿™é‡Œæ˜¾ç¤ºçš„ç¤ºä¾‹å°†æ¼”ç¤ºåŸºæœ¬èº«ä»½éªŒè¯ã€‚\nä¸ºäº†åº”ç”¨ Spring å®‰å…¨æ€§ï¼Œæˆ‘ä»¬å°†æ·»åŠ ä»¥ä¸‹ä¾èµ– Mavenï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-security\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; Gradle:\nimplementation \u0026#39;org.springframework.boot:spring-boot-starter-security\u0026#39; Spring Security åº”ç”¨äº Spring Web MVC Spring security é»˜è®¤ä¿æŠ¤æ¯ä¸ªç«¯ç‚¹ã€‚ä½†æ˜¯ï¼Œè¿™ä¼šå¯¼è‡´ CORS é”™è¯¯ï¼Œå› ä¸ºæµè§ˆå™¨çš„ OPTIONS é¢„æ£€è¯·æ±‚å°†è¢«é˜»æ­¢ã€‚è¦ä½¿ Spring Security ç»•è¿‡é¢„æ£€è¯·æ±‚ï¼Œæˆ‘ä»¬éœ€è¦å°† http.cors() æ·»åŠ åˆ° HTTPSecurity å¯¹è±¡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n@Configuration @EnableConfigurationProperties(BasicAuthConfigProperties.class) @EnableWebSecurity public class SecurityConfiguration extends WebSecurityConfigurerAdapter { private final BasicAuthConfigProperties basicAuth; public SecurityConfiguration(BasicAuthConfigProperties basicAuth) { this.basicAuth = basicAuth; } protected void configure(HttpSecurity http) throws Exception { http.cors(); } } è¦åœ¨ç»•è¿‡é¢„æ£€è¯·æ±‚åä½¿ç”¨ Spring Security è®¾ç½®é¢å¤–çš„ CORS é…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ @CrossOrigin æ³¨é‡Šæ¥é…ç½® CORSï¼š\n@CrossOrigin(maxAge = 3600, allowCredentials = \u0026#34;true\u0026#34;) @RestController @RequestMapping(\u0026#34;cors-library/managed/books\u0026#34;) public class LibraryController { private static final Logger log = LoggerFactory.getLogger(LibraryController.class); private final LibraryService libraryService; public LibraryController(LibraryService libraryService) { this.libraryService = libraryService; } @CrossOrigin(origins = \u0026#34;http://localhost:4200\u0026#34;, allowedHeaders = {\u0026#34;Requestor-Type\u0026#34;, \u0026#34;Authorization\u0026#34;}, exposedHeaders = \u0026#34;X-Get-Header\u0026#34;) @GetMapping public ResponseEntity\u0026lt;List\u0026lt;BookDto\u0026gt;\u0026gt; getBooks(@RequestParam String type) { HttpHeaders headers = new HttpHeaders(); headers.set(\u0026#34;X-Get-Header\u0026#34;, \u0026#34;ExampleHeader\u0026#34;); return ResponseEntity.ok().headers(headers).body(libraryService.getAllBooks(type)); } } æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª CorsConfigurationSource beanï¼š\n@Bean CorsConfigurationSource corsConfigurationSource() { CorsConfiguration configuration = new CorsConfiguration(); configuration.setAllowedOrigins(Arrays.asList(\u0026#34;http://localhost:4200\u0026#34;)); configuration.setAllowedMethods(Arrays.asList(\u0026#34;GET\u0026#34;,\u0026#34;POST\u0026#34;,\u0026#34;PATCH\u0026#34;, \u0026#34;PUT\u0026#34;, \u0026#34;DELETE\u0026#34;, \u0026#34;OPTIONS\u0026#34;, \u0026#34;HEAD\u0026#34;)); configuration.setAllowCredentials(true); configuration.setAllowedHeaders(Arrays.asList(\u0026#34;Authorization\u0026#34;, \u0026#34;Requestor-Type\u0026#34;)); configuration.setExposedHeaders(Arrays.asList(\u0026#34;X-Get-Header\u0026#34;)); configuration.setMaxAge(3600L); UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource(); source.registerCorsConfiguration(\u0026#34;/**\u0026#34;, configuration); return source; } Spring Security åº”ç”¨äº Spring Webflux å¯¹äº Webfluxï¼Œå°½ç®¡ä½¿ç”¨ Spring Securityï¼Œå°† CORS é…ç½®åº”ç”¨äºä¼ å…¥è¯·æ±‚çš„æœ€é¦–é€‰æ–¹æ³•æ˜¯ä½¿ç”¨ CorsWebFilter ã€‚æˆ‘ä»¬å¯ä»¥ç¦ç”¨ CORS ä¸ Spring security çš„é›†æˆï¼Œè€Œæ˜¯é€šè¿‡æä¾› CorsConfigurationSource ä¸ CorsWebFilter é›†æˆï¼š\n@Configuration @EnableWebFluxSecurity @EnableConfigurationProperties(BasicAuthConfigProperties.class) public class SecurityConfiguration { private final BasicAuthConfigProperties basicAuth; public SecurityConfiguration(BasicAuthConfigProperties basicAuth) { this.basicAuth = basicAuth; } @Bean public SecurityWebFilterChain securityWebFilterChain(ServerHttpSecurity http) { http.cors(cors -\u0026gt; cors.disable()) .securityMatcher(new PathPatternParserServerWebExchangeMatcher(\u0026#34;/**\u0026#34;)) .authorizeExchange() .anyExchange().authenticated().and() .httpBasic(); return http.build(); } @Bean public MapReactiveUserDetailsService userDetailsService() { UserDetails user = User.withDefaultPasswordEncoder() .username(basicAuth.getUsername()) .password(basicAuth.getPassword()) .roles(\u0026#34;USER\u0026#34;) .build(); return new MapReactiveUserDetailsService(user); } @Bean public CorsConfigurationSource corsConfiguration() { CorsConfiguration corsConfig = new CorsConfiguration(); corsConfig.applyPermitDefaultValues(); corsConfig.setAllowCredentials(true); corsConfig.addAllowedMethod(\u0026#34;GET\u0026#34;); corsConfig.addAllowedMethod(\u0026#34;PATCH\u0026#34;); corsConfig.addAllowedMethod(\u0026#34;POST\u0026#34;); corsConfig.addAllowedMethod(\u0026#34;OPTIONS\u0026#34;); corsConfig.setAllowedOrigins(Arrays.asList(\u0026#34;http://localhost:4200\u0026#34;)); corsConfig.setAllowedHeaders(Arrays.asList(\u0026#34;Authorization\u0026#34;, \u0026#34;Requestor-Type\u0026#34;)); corsConfig.setExposedHeaders(Arrays.asList(\u0026#34;X-Get-Header\u0026#34;)); UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource(); source.registerCorsConfiguration(\u0026#34;/**\u0026#34;, corsConfig); return source; } @Bean public CorsWebFilter corsWebFilter() { return new CorsWebFilter(corsConfiguration()); } } ç»“è®º ç®€è€Œè¨€ä¹‹ï¼ŒCORS é…ç½®å–å†³äºå¤šä¸ªå› ç´ ï¼š\nSpring Web / Spring Webflux æœ¬åœ°/å…¨å±€ CORS é…ç½® æ˜¯å¦ä½¿ç”¨ Spring Security æ ¹æ®æ¡†æ¶ï¼Œæˆ‘ä»¬å¯ä»¥å†³å®šå“ªç§æ–¹æ³•æ•ˆæœæœ€å¥½å¹¶ä¸”æœ€å®¹æ˜“å®ç°ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é¿å… CORS é”™è¯¯ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ GitHub ä¸Šçš„ç¤ºä¾‹åº”ç”¨ç¨‹åºã€‚\nåŸæ–‡é“¾æ¥ï¼šhttps://reflectoring.io/spring-cors/\n","permalink":"https://blog.chensoul.cc/posts/2023/07/26/spring-cors/","summary":"è·¨æºèµ„æºå…±äº« (CORS) æ˜¯ä¸€ç§åŸºäº HTTP æ ‡å¤´çš„æœºåˆ¶ï¼Œå…è®¸æœåŠ¡å™¨æ˜¾å¼å°†æŸäº›æºåˆ—å…¥ç™½åå•ï¼Œå¹¶å¸®åŠ©ç»•è¿‡åŒæºç­–ç•¥ã€‚\nè¿™æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºæµè§ˆå™¨é»˜è®¤åº”ç”¨åŒæºç­–ç•¥ä»¥ç¡®ä¿å®‰å…¨ã€‚é€šè¿‡åœ¨ Web åº”ç”¨ç¨‹åºä¸­å®æ–½ CORSï¼Œç½‘é¡µå¯ä»¥è¯·æ±‚é¢å¤–çš„èµ„æºå¹¶ä»å…¶ä»–åŸŸåŠ è½½åˆ°æµè§ˆå™¨ä¸­ã€‚\næœ¬æ–‡å°†é‡ç‚¹ä»‹ç»åœ¨åŸºäº Spring çš„åº”ç”¨ç¨‹åºä¸­å®ç° CORS çš„å„ç§æ–¹å¼ã€‚è¦è¯¦ç»†äº†è§£ CORS çš„å·¥ä½œåŸç†ï¼Œè¯·å‚é˜…è¿™ç¯‡ä¼˜ç§€çš„ä»‹ç»æ€§æ–‡ç« ã€‚\nç¤ºä¾‹ä»£ç  æœ¬æ–‡é™„æœ‰ GitHub ä¸Šçš„å·¥ä½œä»£ç ç¤ºä¾‹ã€‚\nCORS ç‰¹å®š HTTP å“åº”æ ‡å¤´æ¦‚è¿° CORS è§„èŒƒå®šä¹‰äº†æœåŠ¡å™¨è¿”å›çš„ä¸€ç»„å“åº”æ ‡å¤´ï¼Œè¿™å°†æ˜¯åç»­éƒ¨åˆ†çš„é‡ç‚¹ã€‚\nå“åº”å¤´ æè¿° Access-Control-Allow-Origin ä»¥é€—å·åˆ†éš”çš„ç™½åå•æ¥æºåˆ—è¡¨æˆ–â€œ*â€ã€‚ Access-Control-Allow-Methods Web æœåŠ¡å™¨å…è®¸è·¨æºè¯·æ±‚çš„ HTTP æ–¹æ³•çš„é€—å·åˆ†éš”åˆ—è¡¨ã€‚ Access-Control-Allow-Headers Web æœåŠ¡å™¨å…è®¸è·¨æºè¯·æ±‚çš„ HTTP æ ‡å¤´çš„é€—å·åˆ†éš”åˆ—è¡¨ã€‚ Access-Control-Expose-Headers å®¢æˆ·ç«¯è„šæœ¬è®¤ä¸ºå¯ä»¥å®‰å…¨æ˜¾ç¤ºçš„ä»¥é€—å·åˆ†éš”çš„ HTTP æ ‡å¤´åˆ—è¡¨ã€‚ Access-Control-Allow-Credentials å¦‚æœæµè§ˆå™¨é€šè¿‡ä¼ é€’å‡­æ®ï¼ˆä»¥ cookie æˆ–æˆæƒæ ‡å¤´çš„å½¢å¼ï¼‰å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œåˆ™å…¶å€¼è®¾ç½®ä¸º true ã€‚ Access-Control-Max-Age æŒ‡ç¤ºé¢„æ£€è¯·æ±‚çš„ç»“æœå¯ä»¥ç¼“å­˜å¤šé•¿æ—¶é—´ã€‚ è®¾ç½®ç¤ºä¾‹å®¢æˆ·ç«¯åº”ç”¨ç¨‹åº æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªç®€å•çš„è§’åº¦åº”ç”¨ç¨‹åºæ¥è°ƒç”¨ REST ç«¯ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æµè§ˆå™¨å¼€å‘äººå‘˜å·¥å…·æ£€æŸ¥è¿™äº›ç«¯ç‚¹ã€‚æ‚¨å¯ä»¥åœ¨ GitHub ä¸ŠæŸ¥çœ‹æºä»£ç ã€‚\nng serve --open æˆ‘ä»¬åº”è¯¥èƒ½å¤ŸæˆåŠŸå¯åŠ¨å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºã€‚\nè®¾ç½®ç¤ºä¾‹æœåŠ¡å™¨åº”ç”¨ç¨‹åº æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªåŸºäº Spring çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­åŒ…å«å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå¯ä»¥è°ƒç”¨çš„ GET å’Œ POST è¯·æ±‚ã€‚è¯·æ³¨æ„ï¼Œæ‚¨ä¼šå‘ç°ä¸¤ä¸ªç‹¬ç«‹çš„åº”ç”¨ç¨‹åºï¼šä¸€ä¸ªä½¿ç”¨ Spring MVC (REST)ï¼Œå¦ä¸€ä¸ªä½¿ç”¨ Spring Reactive å †æ ˆã€‚\nä¸ºç®€å•èµ·è§ï¼Œä¸¤ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´çš„ CORS é…ç½®ç›¸åŒï¼Œå¹¶ä¸”å®šä¹‰äº†ç›¸åŒçš„ç«¯ç‚¹ã€‚ä¸¤å°æœåŠ¡å™¨éƒ½ä»ä¸åŒçš„ç«¯å£ 8091 å’Œ 8092 å¯åŠ¨ã€‚\nä¸åº”ç”¨ç¨‹åºæ†ç»‘åœ¨ä¸€èµ·çš„ Maven Wrapper å°†ç”¨äºå¯åŠ¨æœåŠ¡ã€‚æ‚¨å¯ä»¥æŸ¥çœ‹ Spring REST æºä»£ç å’Œ Spring Reactive æºä»£ç ã€‚\nmvnw clean verify spring-boot:run (for Windows) ./mvnw clean verify spring-boot:run (for Linux) ä¸€æ—¦ Spring åº”ç”¨ç¨‹åºæˆåŠŸå¯åŠ¨ï¼Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºåº”è¯¥èƒ½å¤ŸæˆåŠŸä»æœåŠ¡å™¨åŠ è½½æ•°æ®ã€‚","title":"[è¯‘]ä½¿ç”¨ Spring Boot å’Œ Spring Security é…ç½® CORS"},{"content":"åœ¨åˆ†å¸ƒå¼ã€å¿«èŠ‚å¥çš„ç¯å¢ƒä¸­ï¼Œå¼€å‘å›¢é˜Ÿé€šå¸¸å¸Œæœ›äº†è§£ä»–ä»¬éƒ¨ç½²åº”ç”¨ç¨‹åºçš„æ—¶é—´ã€éƒ¨ç½²çš„åº”ç”¨ç¨‹åºç‰ˆæœ¬ã€éƒ¨ç½²çš„ Git æäº¤ç­‰ç­‰ã€‚\nSpring Boot Actuator å¸®åŠ©æˆ‘ä»¬ç›‘æ§å’Œç®¡ç†åº”ç”¨ç¨‹åºã€‚å®ƒå…¬å¼€äº†æä¾›åº”ç”¨ç¨‹åºè¿è¡ŒçŠ¶å†µã€æŒ‡æ ‡å’Œå…¶ä»–ç›¸å…³ä¿¡æ¯çš„å„ç§ç«¯ç‚¹ã€‚\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•ä½¿ç”¨ Spring Boot Actuator å’Œ Maven/Gradle æ„å»ºæ’ä»¶å°†æ­¤ç±»ä¿¡æ¯æ·»åŠ åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­ã€‚\nç¤ºä¾‹ä»£ç  æœ¬æ–‡é™„æœ‰ GitHub ä¸Šçš„å·¥ä½œä»£ç ç¤ºä¾‹ã€‚\nå¯ç”¨ Spring Boot æ‰§è¡Œå™¨ Spring Boot Actuator æ˜¯ Spring Boot çš„ä¸€ä¸ªå­é¡¹ç›®ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å¿«é€Ÿäº†è§£å¦‚ä½•å¼•å¯¼ç¤ºä¾‹é¡¹ç›®å¹¶å¯ç”¨ /info ç«¯ç‚¹ã€‚å¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šæœ‰å…³ Spring Boot Actuator çš„ä¿¡æ¯ï¼Œå·²ç»æœ‰ä¸€ä¸ªå¾ˆæ£’çš„æ•™ç¨‹äº†ã€‚\nè®©æˆ‘ä»¬ä½¿ç”¨ Spring Initializr å¿«é€Ÿåˆ›å»ºä¸€ä¸ª Spring Boot é¡¹ç›®ã€‚æˆ‘ä»¬å°†éœ€è¦ä»¥ä¸‹ä¾èµ–é¡¹ï¼š\nä¾èµ–æ€§ ç›®çš„ Spring Boot Actuator å…¬å¼€åº”ç”¨ç¨‹åºç®¡ç†ç«¯ç‚¹ï¼Œä¾‹å¦‚ info ã€‚ Spring Web å¯ç”¨ Web åº”ç”¨ç¨‹åºè¡Œä¸ºã€‚ å¦‚æœæœ‰å¸®åŠ©ï¼Œè¿™é‡Œæ˜¯ Maven å’Œ Gradle ä¸­é¢„å¡«å……é¡¹ç›®çš„é“¾æ¥ã€‚\né¡¹ç›®æ„å»ºåï¼Œæˆ‘ä»¬å°†é€šè¿‡ HTTP å…¬å¼€å†…ç½®çš„ /info ç«¯ç‚¹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ /info Web ç«¯ç‚¹å¤„äºç¦ç”¨çŠ¶æ€ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ application.properties é…ç½®ä¸­æ·»åŠ  management.endpoints.web.exposure.include å±æ€§æ¥ç®€å•åœ°å¯ç”¨å®ƒï¼š\nmanagement.endpoints.web.exposure.include=health,info è®©æˆ‘ä»¬è¿è¡Œ Spring Boot åº”ç”¨ç¨‹åºå¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ URL http://localhost:8080/actuator/info ã€‚ç›®å‰è¿˜çœ‹ä¸åˆ°ä»»ä½•æœ‰ç”¨çš„ä¸œè¥¿ï¼Œå› ä¸ºæˆ‘ä»¬ä»ç„¶éœ€è¦è¿›è¡Œä¸€äº›é…ç½®æ›´æ”¹ã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•åœ¨æ­¤å“åº”ä¸­æ·»åŠ ä¿¡æ¯ä¸°å¯Œçš„æ„å»ºä¿¡æ¯ã€‚\nä¿æŠ¤ç«¯ç‚¹ å¦‚æœæ‚¨å…¬å¼€å…¬å¼€ç«¯ç‚¹ï¼Œè¯·ç¡®ä¿é€‚å½“ä¿æŠ¤å®ƒä»¬ã€‚æˆ‘ä»¬ä¸åº”åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ³„éœ²ä»»ä½•æ•æ„Ÿä¿¡æ¯ã€‚\nSpring Boot åº”ç”¨ç¨‹åºä¿¡æ¯ Spring ä»åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­å®šä¹‰çš„å„ç§ InfoContributor bean æ”¶é›†æœ‰ç”¨çš„åº”ç”¨ç¨‹åºä¿¡æ¯ã€‚ä¸‹é¢æ˜¯é»˜è®¤ InfoContributor beans çš„æ‘˜è¦ï¼š\nID Bean Name ç”¨æ³• build BuildInfoContributor å…¬å¼€æ„å»ºä¿¡æ¯ã€‚ env EnvironmentInfoContributor å…¬å¼€ Environment ä¸­åç§°ä»¥ info. å¼€å¤´çš„ä»»ä½•å±æ€§ git GitInfoContributor å…¬å¼€ Git ç›¸å…³ä¿¡æ¯ã€‚ java JavaInfoContributor å…¬å¼€ Java è¿è¡Œæ—¶ä¿¡æ¯ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œ env å’Œ java è´¡çŒ®è€…è¢«ç¦ç”¨ã€‚\né¦–å…ˆï¼Œæˆ‘ä»¬å°†é€šè¿‡åœ¨ application.properties ä¸­æ·»åŠ ä»¥ä¸‹é”®å€¼å¯¹æ¥å¯ç”¨ java è´¡çŒ®è€…ï¼š\nmanagement.info.java.enabled=true è®©æˆ‘ä»¬é‡æ–°è¿è¡Œè¯¥åº”ç”¨ç¨‹åºã€‚å¦‚æœæˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­å†æ¬¡æ‰“å¼€æ‰§è¡Œå™¨ /info ç«¯ç‚¹ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š\n{ \u0026#34;java\u0026#34;: { \u0026#34;vendor\u0026#34;: \u0026#34;Eclipse Adoptium\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;11.0.14\u0026#34;, \u0026#34;runtime\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;OpenJDK Runtime Environment\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;11.0.14+9\u0026#34; }, \u0026#34;jvm\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;OpenJDK 64-Bit Server VM\u0026#34;, \u0026#34;vendor\u0026#34;: \u0026#34;Eclipse Adoptium\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;11.0.14+9\u0026#34; } } } æ ¹æ®å®‰è£…çš„ Java ç‰ˆæœ¬ï¼Œæ‚¨å¯èƒ½ä¼šçœ‹åˆ°ä¸åŒçš„å€¼ã€‚\nç°åœ¨ï¼Œæ˜¯æ—¶å€™æ˜¾ç¤ºç¯å¢ƒå˜é‡äº†ã€‚ Spring ä¼šé€‰å–å±æ€§åç§°ä»¥ info å¼€å¤´çš„ä»»ä½•ç¯å¢ƒå˜é‡ã€‚è¦æŸ¥çœ‹å®é™…æ•ˆæœï¼Œè®©æˆ‘ä»¬åœ¨ application.properties æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å±æ€§ï¼š\nmanagement.info.env.enabled=true info.app.website=reflectoring.io é‡æ–°å¯åŠ¨åº”ç”¨ç¨‹åºåï¼Œæˆ‘ä»¬å°†å¼€å§‹çœ‹åˆ°æ·»åŠ åˆ°æ‰§è¡Œå™¨ info ç«¯ç‚¹çš„ä»¥ä¸‹ä¿¡æ¯ï¼š\n{ \u0026#34;app\u0026#34;: { \u0026#34;website\u0026#34;: \u0026#34;reflectoring.io\u0026#34; } } è¯·éšæ„æ·»åŠ æ‚¨æƒ³è¦çš„ä»»æ„æ•°é‡çš„ä¿¡æ¯å˜é‡:)\nåœ¨ä»¥ä¸‹éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•æ·»åŠ  Git å’Œåº”ç”¨ç¨‹åºæ„å»ºç‰¹å®šä¿¡æ¯ã€‚\næ·»åŠ æ„å»ºä¿¡æ¯ æ·»åŠ æœ‰ç”¨çš„æ„å»ºä¿¡æ¯æœ‰åŠ©äºå¿«é€Ÿè¯†åˆ«æ„å»ºå·¥ä»¶åç§°ã€ç‰ˆæœ¬ã€åˆ›å»ºæ—¶é—´ç­‰ã€‚å®ƒå¯ä»¥æ–¹ä¾¿åœ°æ£€æŸ¥å›¢é˜Ÿæ˜¯å¦éƒ¨ç½²äº†åº”ç”¨ç¨‹åºçš„ç›¸å…³ç‰ˆæœ¬ã€‚ Spring Boot å…è®¸ä½¿ç”¨ Maven æˆ– Gradle æ„å»ºæ’ä»¶è½»æ¾æ·»åŠ æ­¤å†…å®¹ã€‚\nä½¿ç”¨ Maven æ’ä»¶ Spring Boot Maven æ’ä»¶æ†ç»‘äº†è®¸å¤šæœ‰ç”¨çš„åŠŸèƒ½ï¼Œä¾‹å¦‚åˆ›å»ºå¯æ‰§è¡Œ jar æˆ– war å­˜æ¡£ã€è¿è¡Œåº”ç”¨ç¨‹åºç­‰ã€‚å®ƒè¿˜æä¾›äº†ä¸€ç§æ·»åŠ åº”ç”¨ç¨‹åºæ„å»ºä¿¡æ¯çš„æ–¹æ³•ã€‚\nå¦‚æœå­˜åœ¨æœ‰æ•ˆçš„ META-INF/build-info.properties æ–‡ä»¶ï¼ŒSpring Boot Actuator å°†æ˜¾ç¤ºæ„å»ºè¯¦ç»†ä¿¡æ¯ã€‚ Spring Boot Maven æ’ä»¶çš„ build-info ç›®æ ‡æ˜¯åˆ›å»ºæ­¤æ–‡ä»¶ã€‚\nå¦‚æœæ‚¨ä½¿ç”¨ Spring Initializr å¼•å¯¼é¡¹ç›®ï¼Œåˆ™é»˜è®¤æƒ…å†µä¸‹è¯¥æ’ä»¶å°†å‡ºç°åœ¨ pom.xml ä¸­ã€‚æˆ‘ä»¬åªéœ€æ·»åŠ  build-info æ‰§è¡Œç›®æ ‡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.6.4\u0026lt;/version\u0026gt; \u0026lt;executions\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;build-info\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;/executions\u0026gt; \u0026lt;/plugin\u0026gt; å¦‚æœæˆ‘ä»¬ç°åœ¨è¿è¡Œå‘½ä»¤ ./mvnw spring-boot:run ï¼ˆå¯¹äº Linux/macOSï¼‰æˆ– mvnw.bat spring-boot:run ï¼ˆå¯¹äº Windowsï¼‰ï¼Œæ‰€éœ€çš„æ–‡ä»¶å°†åœ¨ target/classes/META-INF/build-info.properties ä¸­åˆ›å»ºã€‚\næ–‡ä»¶å†…å®¹å°†ä¸æ­¤ç±»ä¼¼ï¼š\nbuild.artifact=spring-boot-build-info build.group=io.reflectoring build.name=spring-boot-build-info build.time=2022-03-06T05\\:53\\:45.236Z build.version=0.0.1-SNAPSHOT æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ additionalProperties å±æ€§å°†è‡ªå®šä¹‰å±æ€§æ·»åŠ åˆ°æ­¤åˆ—è¡¨ï¼š\n\u0026lt;execution\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;build-info\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;additionalProperties\u0026gt; \u0026lt;custom.key1\u0026gt;value1\u0026lt;/custom.key1\u0026gt; \u0026lt;custom.key2\u0026gt;value2\u0026lt;/custom.key2\u0026gt; \u0026lt;/additionalProperties\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/execution\u0026gt; å¦‚æœæˆ‘ä»¬ç°åœ¨è¿è¡Œåº”ç”¨ç¨‹åºå¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ http://localhost:8080/actuator/info ç«¯ç‚¹ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„å“åº”ï¼š\n{ \u0026#34;build\u0026#34;: { \u0026#34;custom\u0026#34;: { \u0026#34;key2\u0026#34;: \u0026#34;value2\u0026#34;, \u0026#34;key1\u0026#34;: \u0026#34;value1\u0026#34; }, \u0026#34;version\u0026#34;: \u0026#34;0.0.1-SNAPSHOT\u0026#34;, \u0026#34;artifact\u0026#34;: \u0026#34;spring-boot-build-info\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;spring-boot-build-info\u0026#34;, \u0026#34;time\u0026#34;: \u0026#34;2022-03-06T06:34:30.306Z\u0026#34;, \u0026#34;group\u0026#34;: \u0026#34;io.reflectoring\u0026#34; } } å¦‚æœæ‚¨æƒ³æ’é™¤ä»»ä½•å¯ä»¥ä½¿ç”¨ excludeInfoProperties é…ç½®çš„å±æ€§ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•æ’é™¤ artifact å±æ€§ï¼š\n\u0026lt;configuration\u0026gt; \u0026lt;excludeInfoProperties\u0026gt; \u0026lt;infoProperty\u0026gt;artifact\u0026lt;/infoProperty\u0026gt; \u0026lt;/excludeInfoProperties\u0026gt; \u0026lt;/configuration\u0026gt; è¯·å‚é˜… Spring Boot å®˜æ–¹æ–‡æ¡£äº†è§£æ›´å¤šä¿¡æ¯ã€‚\nç°åœ¨ï¼Œæ˜¯æ—¶å€™çœ‹çœ‹æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨ Spring Boot Gradle æ’ä»¶å®ç°ç›¸åŒçš„è¾“å‡ºäº†ã€‚\nä½¿ç”¨ Gradle æ’ä»¶ æ·»åŠ æ„å»ºä¿¡æ¯çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨æ’ä»¶ DSLã€‚åœ¨ build.gradle æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä»¥ä¸‹å—ï¼š\nspringBoot { buildInfo() } å¦‚æœæˆ‘ä»¬ç°åœ¨åŒæ­¥ Gradle é¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæ–°ä»»åŠ¡ bootBuildInfo å¯ä¾›ä½¿ç”¨ã€‚è¿è¡Œè¯¥ä»»åŠ¡å°†ç”Ÿæˆå¸¦æœ‰æ„å»ºä¿¡æ¯çš„ç±»ä¼¼ build/resources/main/META-INF/build-info.properties æ–‡ä»¶ï¼ˆæºè‡ªé¡¹ç›®ï¼‰ã€‚ä½¿ç”¨ DSLï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ç°æœ‰å€¼æˆ–æ·»åŠ æ–°å±æ€§ï¼š\nspringBoot { buildInfo { properties { name = \u0026#39;Sample App\u0026#39; additional = [ \u0026#39;customKey\u0026#39;: \u0026#39;customValue\u0026#39; ] } } } æ˜¯æ—¶å€™ä½¿ç”¨ ./gradlew bootRun ï¼ˆå¯¹äº macOS/Linuxï¼‰æˆ– gradlew.bat bootRun ï¼ˆå¯¹äº Windowsï¼‰å‘½ä»¤è¿è¡Œåº”ç”¨ç¨‹åºäº†ã€‚åº”ç”¨ç¨‹åºè¿è¡Œåï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ http://localhost:8080/actuator/info ç«¯ç‚¹å¹¶æ‰¾åˆ°å“åº”ï¼š\n{ \u0026#34;build\u0026#34;: { \u0026#34;customKey\u0026#34;: \u0026#34;customValue\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;0.0.1-SNAPSHOT\u0026#34;, \u0026#34;artifact\u0026#34;: \u0026#34;spring-boot-build-info\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;Sample App\u0026#34;, \u0026#34;time\u0026#34;: \u0026#34;2022-03-06T09:11:53.380Z\u0026#34;, \u0026#34;group\u0026#34;: \u0026#34;io.reflectoring\u0026#34; } } æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†å…¶å€¼è®¾ç½®ä¸º null æ¥ä»ç”Ÿæˆçš„æ„å»ºä¿¡æ¯ä¸­æ’é™¤ä»»ä½•é»˜è®¤å±æ€§ã€‚ä¾‹å¦‚ï¼š\nproperties { group = null } æƒ³äº†è§£æ›´å¤šå…³äºè¯¥æ’ä»¶çš„ä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒ Spring Boot å®˜æ–¹æ–‡æ¡£ã€‚\næ·»åŠ  Git ä¿¡æ¯ Git ä¿¡æ¯å¯ä»¥æ–¹ä¾¿åœ°å¿«é€Ÿè¯†åˆ«ç”Ÿäº§ä¸­æ˜¯å¦å­˜åœ¨ç›¸å…³ä»£ç æˆ–è€…åˆ†å¸ƒå¼éƒ¨ç½²æ˜¯å¦ä¸é¢„æœŸåŒæ­¥ã€‚ Spring Boot å¯ä»¥ä½¿ç”¨ Maven å’Œ Gradle æ’ä»¶è½»æ¾åœ°å°† Git å±æ€§åŒ…å«åœ¨ Actuator ç«¯ç‚¹ä¸­ã€‚\nä½¿ç”¨è¿™ä¸ªæ’ä»¶æˆ‘ä»¬å¯ä»¥ç”Ÿæˆä¸€ä¸ª git.properties æ–‡ä»¶ã€‚æ­¤æ–‡ä»¶çš„å­˜åœ¨å°†è‡ªåŠ¨é…ç½® GitProperties beanï¼Œä¾› GitInfoContributor bean ä½¿ç”¨æ¥æ•´ç†ç›¸å…³ä¿¡æ¯ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œå°†å…¬å¼€ä»¥ä¸‹ä¿¡æ¯ï¼š\ngit.branch git.commit.id git.commit.time ä»¥ä¸‹ç®¡ç†åº”ç”¨ç¨‹åºå±æ€§æ§åˆ¶ Git ç›¸å…³ä¿¡æ¯ï¼š\nåº”ç”¨å±æ€§ ç›®çš„ management.info.git.enabled=false å®Œå…¨ä» info ç«¯ç‚¹ç¦ç”¨ Git ä¿¡æ¯ management.info.git.mode=full æ˜¾ç¤º git.properties æ–‡ä»¶ä¸­çš„æ‰€æœ‰å±æ€§ ä½¿ç”¨ Maven æ’ä»¶ Maven Git Commit ID æ’ä»¶é€šè¿‡ spring-boot-starter-parent pom.xml è¿›è¡Œç®¡ç†ã€‚è¦ä½¿ç”¨å®ƒï¼Œæˆ‘ä»¬å¿…é¡»ç¼–è¾‘ pom.xml å¦‚ä¸‹ï¼š\n\u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;pl.project13.maven\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;git-commit-id-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;/plugin\u0026gt; å¦‚æœæˆ‘ä»¬è¿è¡Œè¯¥é¡¹ç›®å¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ /actuator/info ç«¯ç‚¹ï¼Œå®ƒå°†è¿”å› Git ç›¸å…³ä¿¡æ¯ï¼š\n{ \u0026#34;git\u0026#34;: { \u0026#34;branch\u0026#34;: \u0026#34;main\u0026#34;, \u0026#34;commit\u0026#34;: { \u0026#34;id\u0026#34;: \u0026#34;5404bdf\u0026#34;, \u0026#34;time\u0026#34;: \u0026#34;2022-03-06T10:34:16Z\u0026#34; } } } æˆ‘ä»¬è¿˜å¯ä»¥æ£€æŸ¥ target/classes/git.properties ä¸‹ç”Ÿæˆçš„æ–‡ä»¶ã€‚è¿™å¯¹æˆ‘æ¥è¯´æ˜¯è¿™æ ·çš„ï¼š\n#Generated by Git-Commit-Id-Plugin git.branch=main git.build.host=mylaptop git.build.time=2022-03-06T23\\:22\\:16+0530 git.build.user.email=user@email.com git.build.user.name=user git.build.version=0.0.1-SNAPSHOT git.closest.tag.commit.count= git.closest.tag.name= git.commit.author.time=2022-03-06T22\\:46\\:56+0530 git.commit.committer.time=2022-03-06T22\\:46\\:56+0530 git.commit.id=e9fa20d4914367c1632e3a0eb8ca4d2f32b31a89 git.commit.id.abbrev=e9fa20d git.commit.id.describe=e9fa20d-dirty git.commit.id.describe-short=e9fa20d-dirty git.commit.message.full=Update config git.commit.message.short=Update config git.commit.time=2022-03-06T22\\:46\\:56+0530 git.commit.user.email=saikat@email.com git.commit.user.name=Saikat git.dirty=true git.local.branch.ahead=NO_REMOTE git.local.branch.behind=NO_REMOTE git.remote.origin.url=Unknown git.tags= git.total.commit.count=2 è¿™ä¸ªæ’ä»¶å¸¦æœ‰å¾ˆå¤šé…ç½®é€‰é¡¹ã€‚ä¾‹å¦‚ï¼Œè¦åŒ…å«/æ’é™¤ç‰¹å®šå±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ  configuration éƒ¨åˆ†ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\u0026lt;configuration\u0026gt; \u0026lt;excludeProperties\u0026gt; \u0026lt;excludeProperty\u0026gt;time\u0026lt;/excludeProperty\u0026gt; \u0026lt;/excludeProperties\u0026gt; \u0026lt;includeOnlyProperties\u0026gt; \u0026lt;property\u0026gt;git.commit.id\u0026lt;/property\u0026gt; \u0026lt;/includeOnlyProperties\u0026gt; \u0026lt;/configuration\u0026gt; å®ƒå°†ç”Ÿæˆå¦‚ä¸‹è¾“å‡ºï¼š\n{ \u0026#34;git\u0026#34;: { \u0026#34;commit\u0026#34;: { \u0026#34;id\u0026#34;: \u0026#34;5404bdf\u0026#34; } } } è¯‘è€…å¤‡æ³¨ï¼š\nä½¿ç”¨ 4.9.10 ç‰ˆæœ¬æ—¶ï¼Œå¦‚æœæƒ³æŒ‡å®šè¾“å‡ºå†…å®¹ï¼Œéœ€è¦è¿™æ ·è®¾ç½®ï¼š\n\u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;pl.project13.maven\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;git-commit-id-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;4.9.10\u0026lt;/version\u0026gt; \u0026lt;executions\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;revision\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;/executions\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;generateGitPropertiesFile\u0026gt;true\u0026lt;/generateGitPropertiesFile\u0026gt; \u0026lt;dateFormat\u0026gt;yyyy-MM-dd HH:mm:ss\u0026lt;/dateFormat\u0026gt; \u0026lt;dateFormatTimeZone\u0026gt;GMT+8\u0026lt;/dateFormatTimeZone\u0026gt; \u0026lt;includeOnlyProperties\u0026gt;git.branch,git.build.time,git.build.version,git.commit.id,git.commit.time,git.commit.message.full\u0026lt;/includeOnlyProperties\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt; ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹ Gradle ç”¨æˆ·å¯ä»¥ä½¿ç”¨å“ªäº›é€‰é¡¹ã€‚\nä½¿ç”¨ Gradle æ’ä»¶ åœ¨ build.gradle ä¸­ï¼Œæˆ‘ä»¬å°†æ·»åŠ  gradle-git-properties æ’ä»¶ï¼š\nplugins { id \u0026#39;com.gorylenko.gradle-git-properties\u0026#39; version \u0026#39;2.4.0\u0026#39; } ç°åœ¨è®©æˆ‘ä»¬æ„å»º Gradle é¡¹ç›®ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ° build/resources/main/git.properties æ–‡ä»¶å·²åˆ›å»ºã€‚å¹¶ä¸”ï¼Œæ‰§è¡Œå™¨ info ç«¯ç‚¹å°†æ˜¾ç¤ºç›¸åŒçš„æ•°æ®ï¼š\n{ \u0026#34;git\u0026#34;: { \u0026#34;branch\u0026#34;: \u0026#34;main\u0026#34;, \u0026#34;commit\u0026#34;: { \u0026#34;id\u0026#34;: \u0026#34;5404bdf\u0026#34;, \u0026#34;time\u0026#34;: \u0026#34;2022-03-06T10:34:16Z\u0026#34; } } } è¯¥æ’ä»¶ä¹Ÿæä¾›äº†å¤šç§ä½¿ç”¨å±æ€§ gitProperties é…ç½®è¾“å‡ºçš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬é€šè¿‡æ·»åŠ ä»¥ä¸‹å†…å®¹æ¥é™åˆ¶è¦å‡ºç°çš„é”®ï¼š\ngitProperties { keys = [\u0026#39;git.commit.id\u0026#39;] } é‡æ–°è¿è¡Œåº”ç”¨ç¨‹åºç°åœ¨å°†æ˜¾ç¤ºæœ‰é™çš„ Git ä¿¡æ¯ï¼š\n{ \u0026#34;git\u0026#34;: { \u0026#34;commit\u0026#34;: { \u0026#34;id\u0026#34;: \u0026#34;5404bdf\u0026#34; } } } ç»“è®º åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨ Spring Actuator æ¥å…¬å¼€æœ‰å…³æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„ç›¸å…³ä¿¡æ¯ã€‚æˆ‘ä»¬äº†è§£äº†å¦‚ä½•å°†æœ‰å…³æ„å»ºã€ç¯å¢ƒã€Git å’Œ Java ç¯å¢ƒçš„ä¿¡æ¯æ·»åŠ åˆ° Actuator /info ç«¯ç‚¹ã€‚æˆ‘ä»¬è¿˜ç ”ç©¶äº†å¦‚ä½•é€šè¿‡ Maven/Gradle æ„å»ºæ’ä»¶é…ç½®å’Œæ§åˆ¶æ‰€æœ‰è¿™äº›ä¿¡æ¯ã€‚\næ‚¨å¯ä»¥ä½¿ç”¨ GitHub ä¸Šçš„ä»£ç æ¥å°è¯•ä¸€ä¸ªå®Œæ•´çš„åº”ç”¨ç¨‹åºæ¥è¯´æ˜è¿™äº›æƒ³æ³•ã€‚\nåŸæ–‡é“¾æ¥ï¼šhttps://reflectoring.io/spring-boot-info-endpoint/\n","permalink":"https://blog.chensoul.cc/posts/2023/07/26/spring-boot-info-endpoint/","summary":"åœ¨åˆ†å¸ƒå¼ã€å¿«èŠ‚å¥çš„ç¯å¢ƒä¸­ï¼Œå¼€å‘å›¢é˜Ÿé€šå¸¸å¸Œæœ›äº†è§£ä»–ä»¬éƒ¨ç½²åº”ç”¨ç¨‹åºçš„æ—¶é—´ã€éƒ¨ç½²çš„åº”ç”¨ç¨‹åºç‰ˆæœ¬ã€éƒ¨ç½²çš„ Git æäº¤ç­‰ç­‰ã€‚\nSpring Boot Actuator å¸®åŠ©æˆ‘ä»¬ç›‘æ§å’Œç®¡ç†åº”ç”¨ç¨‹åºã€‚å®ƒå…¬å¼€äº†æä¾›åº”ç”¨ç¨‹åºè¿è¡ŒçŠ¶å†µã€æŒ‡æ ‡å’Œå…¶ä»–ç›¸å…³ä¿¡æ¯çš„å„ç§ç«¯ç‚¹ã€‚\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•ä½¿ç”¨ Spring Boot Actuator å’Œ Maven/Gradle æ„å»ºæ’ä»¶å°†æ­¤ç±»ä¿¡æ¯æ·»åŠ åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­ã€‚\nç¤ºä¾‹ä»£ç  æœ¬æ–‡é™„æœ‰ GitHub ä¸Šçš„å·¥ä½œä»£ç ç¤ºä¾‹ã€‚\nå¯ç”¨ Spring Boot æ‰§è¡Œå™¨ Spring Boot Actuator æ˜¯ Spring Boot çš„ä¸€ä¸ªå­é¡¹ç›®ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å¿«é€Ÿäº†è§£å¦‚ä½•å¼•å¯¼ç¤ºä¾‹é¡¹ç›®å¹¶å¯ç”¨ /info ç«¯ç‚¹ã€‚å¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šæœ‰å…³ Spring Boot Actuator çš„ä¿¡æ¯ï¼Œå·²ç»æœ‰ä¸€ä¸ªå¾ˆæ£’çš„æ•™ç¨‹äº†ã€‚\nè®©æˆ‘ä»¬ä½¿ç”¨ Spring Initializr å¿«é€Ÿåˆ›å»ºä¸€ä¸ª Spring Boot é¡¹ç›®ã€‚æˆ‘ä»¬å°†éœ€è¦ä»¥ä¸‹ä¾èµ–é¡¹ï¼š\nä¾èµ–æ€§ ç›®çš„ Spring Boot Actuator å…¬å¼€åº”ç”¨ç¨‹åºç®¡ç†ç«¯ç‚¹ï¼Œä¾‹å¦‚ info ã€‚ Spring Web å¯ç”¨ Web åº”ç”¨ç¨‹åºè¡Œä¸ºã€‚ å¦‚æœæœ‰å¸®åŠ©ï¼Œè¿™é‡Œæ˜¯ Maven å’Œ Gradle ä¸­é¢„å¡«å……é¡¹ç›®çš„é“¾æ¥ã€‚\né¡¹ç›®æ„å»ºåï¼Œæˆ‘ä»¬å°†é€šè¿‡ HTTP å…¬å¼€å†…ç½®çš„ /info ç«¯ç‚¹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ /info Web ç«¯ç‚¹å¤„äºç¦ç”¨çŠ¶æ€ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ application.properties é…ç½®ä¸­æ·»åŠ  management.endpoints.web.exposure.include å±æ€§æ¥ç®€å•åœ°å¯ç”¨å®ƒï¼š\nmanagement.endpoints.web.exposure.include=health,info è®©æˆ‘ä»¬è¿è¡Œ Spring Boot åº”ç”¨ç¨‹åºå¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ URL http://localhost:8080/actuator/info ã€‚ç›®å‰è¿˜çœ‹ä¸åˆ°ä»»ä½•æœ‰ç”¨çš„ä¸œè¥¿ï¼Œå› ä¸ºæˆ‘ä»¬ä»ç„¶éœ€è¦è¿›è¡Œä¸€äº›é…ç½®æ›´æ”¹ã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•åœ¨æ­¤å“åº”ä¸­æ·»åŠ ä¿¡æ¯ä¸°å¯Œçš„æ„å»ºä¿¡æ¯ã€‚\nä¿æŠ¤ç«¯ç‚¹ å¦‚æœæ‚¨å…¬å¼€å…¬å¼€ç«¯ç‚¹ï¼Œè¯·ç¡®ä¿é€‚å½“ä¿æŠ¤å®ƒä»¬ã€‚æˆ‘ä»¬ä¸åº”åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ³„éœ²ä»»ä½•æ•æ„Ÿä¿¡æ¯ã€‚\nSpring Boot åº”ç”¨ç¨‹åºä¿¡æ¯ Spring ä»åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­å®šä¹‰çš„å„ç§ InfoContributor bean æ”¶é›†æœ‰ç”¨çš„åº”ç”¨ç¨‹åºä¿¡æ¯ã€‚ä¸‹é¢æ˜¯é»˜è®¤ InfoContributor beans çš„æ‘˜è¦ï¼š\nID Bean Name ç”¨æ³• build BuildInfoContributor å…¬å¼€æ„å»ºä¿¡æ¯ã€‚ env EnvironmentInfoContributor å…¬å¼€ Environment ä¸­åç§°ä»¥ info.","title":"[è¯‘]ä½¿ç”¨Spring Boot Actuatorå…¬å¼€æœ‰ç”¨çš„ä¿¡æ¯ç«¯ç‚¹"},{"content":"æˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­äº†è§£äº†åŸºæœ¬çš„ OAuth2 æ¦‚å¿µä»¥åŠå¦‚ä½•åœ¨ Spring ä¸­å®ç°å’Œæ‰§è¡Œä¸åŒçš„æˆæƒã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç» OAuth2 çš„å¦ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼šèŒƒå›´ã€‚\nOAuth èŒƒå›´ ä¿æŠ¤å¯¹åº”ç”¨ç¨‹åºçš„è®¿é—®é€šå¸¸åˆ†ä¸¤ä¸ªæ­¥éª¤è¿›è¡Œï¼šèº«ä»½éªŒè¯å’Œæˆæƒã€‚è¦ç†è§£è¿™ä¸¤ä¸ªæ¦‚å¿µï¼Œå‡è®¾æ‚¨åœ¨ç»å¯†æ”¿åºœå¤§æ¥¼å·¥ä½œã€‚åœ¨å¼€å§‹ä¹‹å‰ï¼Œä½ ä¼šå¾—åˆ°ä¸€å¼ å¡ç‰‡ï¼Œå¯ä»¥è®©ä½ è¿›å…¥å»ºç­‘ç‰©ã€‚ OAuth ä»¤ç‰Œå¯ä»¥çœ‹ä½œæ˜¯å…è®¸æ‚¨è®¿é—®çš„å¡ç‰‡ã€‚\nä¸€æ—¦ä½ è¿›å»ï¼Œä½ å†³å®šå»ä¸‰æ¥¼è§ä½ çš„ä¸€ä½åŒäº‹ï¼Œåœ¨å°è¯•ä½¿ç”¨ä½ çš„å¡æ‰“å¼€ä¸‰æ¥¼çš„é—¨åï¼Œä½ å¬åˆ°ä¸€å£°å˜Ÿå˜Ÿå£°ï¼Œå‘Šè¯‰ä½ ä½ æ²¡æœ‰è¢«æˆæƒã€‚åœ¨ OAuth ä¸­ï¼ŒèŒƒå›´æ˜¯ä¸€ç§å®šä¹‰ä»¤ç‰Œå¯ä»¥è®¿é—®å“ªäº›èµ„æºä»¥åŠä¸èƒ½è®¿é—®å“ªäº›èµ„æºçš„æ–¹æ³•ã€‚èŒƒå›´å…è®¸è®¿é—®æ§åˆ¶ï¼Œå¹¶ä¸”å¯ä»¥è¢«è§†ä¸ºç›¸å½“äºä¼ ç»Ÿèº«ä»½éªŒè¯ä¸­çš„ç”¨æˆ·è§’è‰²ã€‚\nå®ç° ä¸ºäº†æ¼”ç¤ºèŒƒå›´ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ç¬¬ 1 éƒ¨åˆ†ä¸­çš„ç¤ºä¾‹ã€‚\nåœ¨èµ„æºæœåŠ¡å™¨çš„æ§åˆ¶å™¨ä¸­ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹ç«¯ç‚¹ï¼š\n@RestController(\u0026#34;/\u0026#34;) public class ResourceController { @GetMapping(\u0026#34;/hello\u0026#34;) public String hello(){ return \u0026#34;hello\u0026#34;; } @GetMapping(\u0026#34;/foo\u0026#34;) public String foo(){ return \u0026#34;foo\u0026#34;; } @PostMapping(\u0026#34;/bar\u0026#34;) public String bar(){ return \u0026#34;bar\u0026#34;; } @DeleteMapping(\u0026#34;/test\u0026#34;) public String test(){ return \u0026#34;test\u0026#34;; } } ç¬¬ä¸€æ­¥æ˜¯ä½¿ç”¨æ‰€éœ€çš„èŒƒå›´é…ç½®æˆæƒæœåŠ¡å™¨ï¼š\nclients.inMemory().withClient(\u0026#34;my-trusted-client\u0026#34;) .authorizedGrantTypes(\u0026#34;password\u0026#34;, \u0026#34;refresh_token\u0026#34;, \u0026#34;implicit\u0026#34;, \u0026#34;client_credentials\u0026#34;, \u0026#34;authorization_code\u0026#34;) .authorities(\u0026#34;CLIENT\u0026#34;) .scopes(\u0026#34;read\u0026#34;, \u0026#34;write\u0026#34;, \u0026#34;trust\u0026#34;) .accessTokenValiditySeconds(60) .redirectUris(\u0026#34;http://localhost:8081/test.html\u0026#34;) .resourceIds(\u0026#34;resource\u0026#34;) .secret(\u0026#34;mysecret\u0026#34;); è¦åœ¨èµ„æºæœåŠ¡å™¨ä¸­å¯ç”¨èŒƒå›´æ£€æŸ¥ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªé€‰é¡¹ï¼šä½¿ç”¨å®‰å…¨é…ç½®æˆ–ä½¿ç”¨æ–¹æ³•å®‰å…¨æ€§ã€‚\nä½¿ç”¨å®‰å…¨é…ç½®ï¼š @Override public void configure(HttpSecurity http) throws Exception { http .authorizeRequests() .antMatchers(HttpMethod.GET,\u0026#34;/hello\u0026#34;).access(\u0026#34;#oauth2.hasScope(\u0026#39;read\u0026#39;)\u0026#34;) .antMatchers(HttpMethod.GET,\u0026#34;/foo\u0026#34;).access(\u0026#34;#oauth2.hasScope(\u0026#39;read\u0026#39;)\u0026#34;) .antMatchers(HttpMethod.POST,\u0026#34;/bar\u0026#34;).access(\u0026#34;#oauth2.hasScope(\u0026#39;write\u0026#39;)\u0026#34;) .antMatchers(HttpMethod.DELETE,\u0026#34;/test\u0026#34;).access(\u0026#34;#oauth2.hasScope(\u0026#39;trust\u0026#39;)\u0026#34;) .anyRequest().authenticated(). and().csrf().disable(); } ä½¿ç”¨æ–¹æ³•å®‰å…¨æ€§ï¼š @PreAuthorize(\u0026#34;#oauth2.hasScope(\u0026#39;read\u0026#39;)\u0026#34;) @GetMapping(\u0026#34;/hello\u0026#34;) public String hello(){ return \u0026#34;hello\u0026#34;; } @PreAuthorize(\u0026#34;#oauth2.hasScope(\u0026#39;read\u0026#39;)\u0026#34;) @GetMapping(\u0026#34;/foo\u0026#34;) public String foo(){ return \u0026#34;foo\u0026#34;; } @PreAuthorize(\u0026#34;#oauth2.hasScope(\u0026#39;write\u0026#39;)\u0026#34;) @PostMapping(\u0026#34;/bar\u0026#34;) public String bar(){ return \u0026#34;bar\u0026#34;; } @PreAuthorize(\u0026#34;#oauth2.hasScope(\u0026#39;trust\u0026#39;)\u0026#34;) @DeleteMapping(\u0026#34;/test\u0026#34;) public String test(){ return \u0026#34;test\u0026#34;; } å¦å¤–ï¼Œæˆ‘ä»¬éœ€è¦å°† @EnableGlobalMethodSecurity(prePostEnabled = true) æ·»åŠ åˆ° Spring å¯ä»¥è·å–çš„ä»»ä½•ç±»ï¼ˆ @Configuration ã€ @Service ç­‰ï¼‰ã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å·²å°†å…¶æ·»åŠ åˆ° ResourceSecurityConfiguration ç±»ä¸­ã€‚ prePostEnabled = true å‘Šè¯‰ Spring å¯ç”¨å‰æ³¨è§£å’Œåæ³¨è§£ï¼Œä¾‹å¦‚ @PreAuthorize ã€ @PostFilter ç­‰\u0026hellip;\u0026hellip;\nå¯¹äºé‚£äº›æƒ³äº†è§£ #oauth2.hasScope('trust') è¿™æ ·çš„è¡¨è¾¾å¼çš„äººæ¥è¯´ï¼Œå®ƒä»¬æ˜¯ä½¿ç”¨ Spring è¡¨è¾¾å¼è¯­è¨€ï¼ˆSpELï¼‰æ„å»ºçš„ã€‚\nè¡ŒåŠ¨èŒƒå›´ é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä»¤ç‰Œè¯·æ±‚ä¸­ä¸å­˜åœ¨èŒƒå›´ï¼ŒSpring ä¼šå‡å®šä»¤ç‰Œå…·æœ‰æ‰€æœ‰é…ç½®çš„èŒƒå›´ã€‚è®©æˆ‘ä»¬é¦–å…ˆè¯·æ±‚ä¸€ä¸ªå…·æœ‰ read èŒƒå›´çš„ä»¤ç‰Œï¼š\ncurl -X POST --user my-trusted-client:mysecret localhost:8081/oauth/token -d \u0026#39;grant_type=client_credentials\u0026amp;client_id=my-trusted-client\u0026amp;scope=read\u0026#39; -H \u0026#34;Accept: application/json\u0026#34; å›å¤ï¼š\n{ \u0026#34;access_token\u0026#34;: \u0026#34;acadbb31-f126-411d-ae5b-6a278cee2ed6\u0026#34;, \u0026#34;token_type\u0026#34;: \u0026#34;bearer\u0026#34;, \u0026#34;expires_in\u0026#34;: 60, \u0026#34;scope\u0026#34;: \u0026#34;read\u0026#34; } ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¤ç‰Œæ¥è®¿é—®å…·æœ‰ read èŒƒå›´è®¿é—®æƒé™çš„ç«¯ç‚¹ï¼š\ncurl -XGET localhost:8989/hello -H \u0026#34;Authorization: Bearer acadbb31-f126-411d-ae5b-6a278cee2ed6\u0026#34; hello curl -XGET localhost:8989/foo -H \u0026#34;Authorization: Bearer acadbb31-f126-411d-ae5b-6a278cee2ed6\u0026#34; foo ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°è¯•åœ¨ä»…æ¥å— write èŒƒå›´çš„ç«¯ç‚¹ä¸Šä½¿ç”¨æ­¤ä»¤ç‰Œï¼š\ncurl -XPOST localhost:8989/bar -H \u0026#34;Authorization: Bearer acadbb31-f126-411d-ae5b-6a278cee2ed6\u0026#34; å›å¤ï¼š\n{ \u0026#34;error\u0026#34;: \u0026#34;access_denied\u0026#34;, \u0026#34;error_description\u0026#34;: \u0026#34;Access is denied\u0026#34; } ç”±äºä»¤ç‰Œä¸å…·æœ‰æ‰€éœ€çš„èŒƒå›´ï¼Œå› æ­¤è®¿é—®è¢«æ‹’ç»ã€‚è®©æˆ‘ä»¬å°è¯•è·å–ä¸€ä¸ªå…·æœ‰ write èŒƒå›´çš„æ–°ä»¤ç‰Œï¼Œç„¶åé‡è¯•ï¼š\ncurl -X POST --user my-trusted-client:mysecret localhost:8081/oauth/token -d \u0026#39;grant_type=client_credentials\u0026amp;client_id=my-trusted-client\u0026amp;scope=write\u0026#39; -H \u0026#34;Accept: application/json\u0026#34; å›å¤ï¼š\n{ \u0026#34;access_token\u0026#34;: \u0026#34;bf0fa83a-23bd-4633-ac6c-a06f40d53e5f\u0026#34;, \u0026#34;token_type\u0026#34;: \u0026#34;bearer\u0026#34;, \u0026#34;expires_in\u0026#34;: 3599, \u0026#34;scope\u0026#34;: \u0026#34;write\u0026#34; } curl -XPOST localhost:8989/bar -H \u0026#34;Authorization: Bearer bf0fa83a-23bd-4633-ac6c-a06f40d53e5f\u0026#34; bar æ€»ç»“ èŒƒå›´æ˜¯ OAuth çš„ä¸€ä¸ªé‡è¦æ–¹é¢ï¼Œå› ä¸ºä»¤ç‰Œä¸æºå¸¦æœ‰å…³å…¶ç”¨æˆ·æˆ–è¯·æ±‚è€…çš„ä¿¡æ¯ã€‚èŒƒå›´å…è®¸é™åˆ¶å¯¹èµ„æºçš„è®¿é—®ï¼Œä»¥å®ç°æ›´å¥½çš„è®¿é—®æ§åˆ¶å’Œå®‰å…¨æ€§ã€‚åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•å°† Google å’Œ Facebook ç­‰å¤–éƒ¨ OAuth æä¾›å•†é›†æˆåˆ°æµç¨‹ä¸­ã€‚\nåŸæ–‡é“¾æ¥ï¼šhttp://www.zakariaamine.com/2018-03-01/using-oauth2-in-spring-scopes/\n","permalink":"https://blog.chensoul.cc/posts/2023/07/26/using-oauth2-in-spring-scopes/","summary":"æˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­äº†è§£äº†åŸºæœ¬çš„ OAuth2 æ¦‚å¿µä»¥åŠå¦‚ä½•åœ¨ Spring ä¸­å®ç°å’Œæ‰§è¡Œä¸åŒçš„æˆæƒã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç» OAuth2 çš„å¦ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼šèŒƒå›´ã€‚\nOAuth èŒƒå›´ ä¿æŠ¤å¯¹åº”ç”¨ç¨‹åºçš„è®¿é—®é€šå¸¸åˆ†ä¸¤ä¸ªæ­¥éª¤è¿›è¡Œï¼šèº«ä»½éªŒè¯å’Œæˆæƒã€‚è¦ç†è§£è¿™ä¸¤ä¸ªæ¦‚å¿µï¼Œå‡è®¾æ‚¨åœ¨ç»å¯†æ”¿åºœå¤§æ¥¼å·¥ä½œã€‚åœ¨å¼€å§‹ä¹‹å‰ï¼Œä½ ä¼šå¾—åˆ°ä¸€å¼ å¡ç‰‡ï¼Œå¯ä»¥è®©ä½ è¿›å…¥å»ºç­‘ç‰©ã€‚ OAuth ä»¤ç‰Œå¯ä»¥çœ‹ä½œæ˜¯å…è®¸æ‚¨è®¿é—®çš„å¡ç‰‡ã€‚\nä¸€æ—¦ä½ è¿›å»ï¼Œä½ å†³å®šå»ä¸‰æ¥¼è§ä½ çš„ä¸€ä½åŒäº‹ï¼Œåœ¨å°è¯•ä½¿ç”¨ä½ çš„å¡æ‰“å¼€ä¸‰æ¥¼çš„é—¨åï¼Œä½ å¬åˆ°ä¸€å£°å˜Ÿå˜Ÿå£°ï¼Œå‘Šè¯‰ä½ ä½ æ²¡æœ‰è¢«æˆæƒã€‚åœ¨ OAuth ä¸­ï¼ŒèŒƒå›´æ˜¯ä¸€ç§å®šä¹‰ä»¤ç‰Œå¯ä»¥è®¿é—®å“ªäº›èµ„æºä»¥åŠä¸èƒ½è®¿é—®å“ªäº›èµ„æºçš„æ–¹æ³•ã€‚èŒƒå›´å…è®¸è®¿é—®æ§åˆ¶ï¼Œå¹¶ä¸”å¯ä»¥è¢«è§†ä¸ºç›¸å½“äºä¼ ç»Ÿèº«ä»½éªŒè¯ä¸­çš„ç”¨æˆ·è§’è‰²ã€‚\nå®ç° ä¸ºäº†æ¼”ç¤ºèŒƒå›´ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ç¬¬ 1 éƒ¨åˆ†ä¸­çš„ç¤ºä¾‹ã€‚\nåœ¨èµ„æºæœåŠ¡å™¨çš„æ§åˆ¶å™¨ä¸­ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹ç«¯ç‚¹ï¼š\n@RestController(\u0026#34;/\u0026#34;) public class ResourceController { @GetMapping(\u0026#34;/hello\u0026#34;) public String hello(){ return \u0026#34;hello\u0026#34;; } @GetMapping(\u0026#34;/foo\u0026#34;) public String foo(){ return \u0026#34;foo\u0026#34;; } @PostMapping(\u0026#34;/bar\u0026#34;) public String bar(){ return \u0026#34;bar\u0026#34;; } @DeleteMapping(\u0026#34;/test\u0026#34;) public String test(){ return \u0026#34;test\u0026#34;; } } ç¬¬ä¸€æ­¥æ˜¯ä½¿ç”¨æ‰€éœ€çš„èŒƒå›´é…ç½®æˆæƒæœåŠ¡å™¨ï¼š\nclients.inMemory().withClient(\u0026#34;my-trusted-client\u0026#34;) .authorizedGrantTypes(\u0026#34;password\u0026#34;, \u0026#34;refresh_token\u0026#34;, \u0026#34;implicit\u0026#34;, \u0026#34;client_credentials\u0026#34;, \u0026#34;authorization_code\u0026#34;) .authorities(\u0026#34;CLIENT\u0026#34;) .scopes(\u0026#34;read\u0026#34;, \u0026#34;write\u0026#34;, \u0026#34;trust\u0026#34;) .accessTokenValiditySeconds(60) .redirectUris(\u0026#34;http://localhost:8081/test.html\u0026#34;) .resourceIds(\u0026#34;resource\u0026#34;) .secret(\u0026#34;mysecret\u0026#34;); è¦åœ¨èµ„æºæœåŠ¡å™¨ä¸­å¯ç”¨èŒƒå›´æ£€æŸ¥ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªé€‰é¡¹ï¼šä½¿ç”¨å®‰å…¨é…ç½®æˆ–ä½¿ç”¨æ–¹æ³•å®‰å…¨æ€§ã€‚\nä½¿ç”¨å®‰å…¨é…ç½®ï¼š @Override public void configure(HttpSecurity http) throws Exception { http .authorizeRequests() .antMatchers(HttpMethod.GET,\u0026#34;/hello\u0026#34;).access(\u0026#34;#oauth2.hasScope(\u0026#39;read\u0026#39;)\u0026#34;) .antMatchers(HttpMethod.GET,\u0026#34;/foo\u0026#34;).access(\u0026#34;#oauth2.hasScope(\u0026#39;read\u0026#39;)\u0026#34;) .antMatchers(HttpMethod.POST,\u0026#34;/bar\u0026#34;).access(\u0026#34;#oauth2.hasScope(\u0026#39;write\u0026#39;)\u0026#34;) .antMatchers(HttpMethod.DELETE,\u0026#34;/test\u0026#34;).access(\u0026#34;#oauth2.hasScope(\u0026#39;trust\u0026#39;)\u0026#34;) .anyRequest().authenticated(). and().csrf().disable(); } ä½¿ç”¨æ–¹æ³•å®‰å…¨æ€§ï¼š @PreAuthorize(\u0026#34;#oauth2.hasScope(\u0026#39;read\u0026#39;)\u0026#34;) @GetMapping(\u0026#34;/hello\u0026#34;) public String hello(){ return \u0026#34;hello\u0026#34;; } @PreAuthorize(\u0026#34;#oauth2.hasScope(\u0026#39;read\u0026#39;)\u0026#34;) @GetMapping(\u0026#34;/foo\u0026#34;) public String foo(){ return \u0026#34;foo\u0026#34;; } @PreAuthorize(\u0026#34;#oauth2.","title":"[è¯‘]åœ¨ Spring ä¸­å®ç° OAuth2ï¼šä½¿ç”¨èŒƒå›´ï¼ˆç¬¬ 2 éƒ¨åˆ†ï¼‰"},{"content":"OAuth2 æ˜¯ä¸€ç»„è§„èŒƒï¼Œä¸»è¦æä¾›å¯¹ Rest API çš„å®‰å…¨è®¿é—®çš„æ–¹æ³•ã€‚ OAuth çš„ä¸»è¦ç›®çš„æ˜¯å…è®¸é€šè¿‡ä½¿ç”¨ä»¤ç‰Œæ¥æ‰§è¡Œèº«ä»½éªŒè¯å’Œæˆæƒï¼Œè€Œä¸å¿…ä¸ºæ¯ä¸ªæ“ä½œæä¾›å‡­æ®ã€‚ç”±äºæœ¬æ–‡çš„é‡ç‚¹æ˜¯å®ç°ï¼Œå¹¶ä¸”ä¸ºäº†ä¸é‡æ–°å‘æ˜è½®å­ï¼Œå¯ä»¥æŸ¥çœ‹ OAuth RFC æˆ–ç»´åŸºç™¾ç§‘ä»¥è·å–æ›´å¤šç†è®ºèƒŒæ™¯ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ Spring ä¸­çš„ OAuth2 å®ç°ä»¥åŠå¦‚ä½•ä½¿ç”¨ä¸åŒçš„æˆæƒç±»å‹ï¼Œä½†åœ¨æ­¤ä¹‹å‰å€¼å¾—æä¾›ä¸€äº›é‡è¦æ¦‚å¿µçš„ç®€è¦å®šä¹‰ã€‚\nè®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œ èº«ä»½éªŒè¯æˆåŠŸåå°†æä¾›è®¿é—®ä»¤ç‰Œä»¥åŠåˆ·æ–°ä»¤ç‰Œã€‚è®¿é—®ä»¤ç‰Œæœ‰ä¸€ä¸ªæœ‰é™çš„æœ‰æ•ˆæœŸï¼ˆæ ‡å‡†ä¸º 1 å°æ—¶ï¼‰ï¼Œä¹‹åéœ€è¦åˆ·æ–°ä»¤ç‰Œæ‰èƒ½è·å–æ–°çš„è®¿é—®ä»¤ç‰Œå’Œæ–°çš„åˆ·æ–°ä»¤ç‰Œã€‚ Referesh ä»¤ç‰Œé€šå¸¸ä¼šåœ¨ä½¿ç”¨åè¿‡æœŸã€‚\nèµ„æºæœåŠ¡å™¨å’ŒæˆæƒæœåŠ¡å™¨ OAuth å¼•å…¥äº†æˆæƒæœåŠ¡å™¨çš„æ¦‚å¿µï¼ŒæˆæƒæœåŠ¡å™¨æ˜¯å‘å‡ºè®¿é—®å’Œåˆ·æ–°ä»¤ç‰Œçš„å®ä½“ï¼Œå¹¶åœ¨æ¯ä¸ªæ“ä½œä¸­è¿›è¡Œå’¨è¯¢ä»¥æŸ¥çœ‹ä»¤ç‰Œæ˜¯å¦æœ‰æ•ˆã€‚èµ„æºæœåŠ¡å™¨åªæ˜¯ç”±ä¸åŒå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼ˆå‰ç«¯åº”ç”¨ç¨‹åºã€ç§»åŠ¨è®¾å¤‡ã€å…¶ä»–åç«¯æœåŠ¡\u0026hellip;\u0026hellip;ï¼‰è®¿é—®çš„å®é™… Rest APIã€‚èµ„æºæœåŠ¡å™¨å’ŒæˆæƒæœåŠ¡å™¨å¯ä»¥æ˜¯ä¸åŒçš„å®ä½“ï¼Œä¹Ÿå¯ä»¥æ˜¯åŒä¸€å®ä½“ã€‚\næˆæƒç±»å‹ OAuth ä¸­æœ€å¸¸ç”¨çš„æˆæƒæœ‰ï¼šå®¢æˆ·ç«¯å‡­æ®ã€å¯†ç ã€æˆæƒç å’Œéšå¼æˆæƒã€‚æ¯é¡¹èµ„åŠ©éƒ½æœ‰ç‰¹å®šçš„æµç¨‹å’Œç”¨ä¾‹ï¼Œä½†ç”±äºæœ¬æ–‡çš„é‡ç‚¹ä¸æ˜¯ç†è®ºï¼Œå› æ­¤æˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨å…¶å®æ–½ã€‚æœ‰å…³æˆæƒåŠå…¶ç”¨é€”çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… OAuth RFCã€‚\nå®ç° åœ¨å®ç°æ–¹é¢ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Spring Boot æ¥åˆ©ç”¨å…¶è‡ªåŠ¨é…ç½®å’Œå¼•å¯¼åŠŸèƒ½ï¼Œå¹¶æ›´å¤šåœ°å…³æ³¨æˆ‘ä»¬çš„æ ¸å¿ƒä¸»é¢˜ã€‚\nèµ„æºæœåŠ¡å™¨ï¼š æˆ‘ä»¬æœ‰ä¸€ä¸ªèµ„æºæœåŠ¡å™¨ï¼Œå…¶ä¸­åŒ…å«æˆ‘ä»¬å¸Œæœ›ä¿æŠ¤çš„ä»¥ä¸‹ç«¯ç‚¹ï¼š\n@RestController(\u0026#34;/\u0026#34;) public class ResourceController { @GetMapping(\u0026#34;/hello\u0026#34;) public String hello(){ return \u0026#34;hello\u0026#34;; } @GetMapping(\u0026#34;/foo\u0026#34;) public String foo(){ return \u0026#34;foo\u0026#34;; } @GetMapping(\u0026#34;/bar\u0026#34;) public String bar(){ return \u0026#34;bar\u0026#34;; } @GetMapping(\u0026#34;/test\u0026#34;) public String test(){ return \u0026#34;test\u0026#34;; } } ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®ä¸€ä¸ªç”¨ @EnableResourceServer æ³¨é‡Šçš„ ResourceServerConfigurerAdapter beanï¼š\n@Configuration @EnableResourceServer public class ResourceSecurityConfiguration extends ResourceServerConfigurerAdapter { @Override public void configure(ResourceServerSecurityConfigurer resources) throws Exception { resources.resourceId(\u0026#34;resource\u0026#34;); } @Override public void configure(HttpSecurity http) throws Exception { http .authorizeRequests().antMatchers(\u0026#34;/foo\u0026#34;, \u0026#34;/bar\u0026#34;, \u0026#34;/hello\u0026#34;, \u0026#34;/test\u0026#34;).authenticated(). and().csrf().disable(); } @Bean public RemoteTokenServices LocalTokenService() { final RemoteTokenServices tokenService = new RemoteTokenServices(); tokenService.setCheckTokenEndpointUrl(\u0026#34;http://localhost:8081/oauth/check_token\u0026#34;); tokenService.setClientId(\u0026#34;my-client\u0026#34;); tokenService.setClientSecret(\u0026#34;mysecret\u0026#34;); return tokenService; } } æˆ‘ä»¬å·²ç»å‘Šè¯‰ spring æ£€æŸ¥ç«¯ç‚¹çš„èº«ä»½éªŒè¯ï¼ˆå¯ä»¥ä½¿ç”¨ \u0026quot;/*\u0026quot; æˆ– .anyRequest() æ¥è¡¨ç¤ºæ‰€æœ‰ç«¯ç‚¹ï¼‰ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜é…ç½®äº†ä¸€ä¸ª RemoteTokenServices bean æ¥å‘Šè¯‰ Spring æä¾›ä»¤ç‰Œæ£€æŸ¥ç«¯ç‚¹ï¼ˆæˆæƒæœåŠ¡å™¨ï¼‰ï¼Œå¹¶é…ç½®äº†å®¢æˆ·ç«¯ id å’Œå¯†é’¥ã€‚è¿™æ ·æˆ‘ä»¬çš„èµ„æºæœåŠ¡å™¨å°±é…ç½®å¥½äº†ã€‚æœ€åï¼Œæˆ‘ä»¬è®¾ç½®äº†èµ„æº idï¼Œå¦‚æœå¤šä¸ªèµ„æºæœåŠ¡å™¨ä½¿ç”¨è¯¥èµ„æºï¼ˆè¿™å¾ˆå¸¸è§ï¼‰ï¼Œåˆ™è¯¥èµ„æº id å¯ä»¥åœ¨æˆæƒæœåŠ¡å™¨ä¸­ç”¨ä½œæ ‡è¯†ã€‚\næˆæƒæœåŠ¡å™¨ï¼š ä¸ºäº†å®ç°æˆæƒæœåŠ¡å™¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å†…å­˜å®¢æˆ·ç«¯é…ç½®ã€‚ Spring Security è¿˜æä¾›äº†å°† oauth å®¢æˆ·ç«¯é…ç½®å­˜å‚¨åœ¨æ›´é€‚åˆç”Ÿäº§åº”ç”¨ç¨‹åºçš„æ•°æ®åº“ä¸­çš„å¯èƒ½æ€§ã€‚\n@Configuration @EnableAuthorizationServer public class AuthorizationSecurityConfig extends AuthorizationServerConfigurerAdapter { @Autowired private AuthenticationManager authenticationManager; @Override public void configure(AuthorizationServerEndpointsConfigurer endpoints) throws Exception { endpoints.authenticationManager(authenticationManager); } @Override public void configure(ClientDetailsServiceConfigurer clients) throws Exception { clients.inMemory().withClient(\u0026#34;my-trusted-client\u0026#34;) .authorizedGrantTypes(\u0026#34;password\u0026#34;, \u0026#34;refresh_token\u0026#34;, \u0026#34;implicit\u0026#34;, \u0026#34;client_credentials\u0026#34;, \u0026#34;authorization_code\u0026#34;) .authorities(\u0026#34;ROLE_CLIENT\u0026#34;, \u0026#34;ROLE_TRUSTED_CLIENT\u0026#34;) .scopes(\u0026#34;read\u0026#34;, \u0026#34;write\u0026#34;, \u0026#34;trust\u0026#34;) .accessTokenValiditySeconds(60) .redirectUris(\u0026#34;http://localhost:8081/test.html\u0026#34;) .resourceIds(\u0026#34;resource\u0026#34;) .secret(\u0026#34;mysecret\u0026#34;); } @Override public void configure(AuthorizationServerSecurityConfigurer oauthServer) throws Exception { oauthServer .tokenKeyAccess(\u0026#34;permitAll()\u0026#34;) .checkTokenAccess(\u0026#34;permitAll()\u0026#34;); } } é™¤äº†æˆ‘ä»¬åœ¨å…¶ä¸­é…ç½®å®¢æˆ·ç«¯ã€å¯†é’¥ã€oauth èŒƒå›´ï¼ˆä¸‹ä¸€ç¯‡æ–‡ç« ä¸­å°†è¯¦ç»†ä»‹ç»ï¼‰ã€æƒé™ï¼ˆä¸ä»¤ç‰Œå…³è”çš„è§’è‰²ï¼‰ã€ä»¤ç‰Œæœ‰æ•ˆæ€§ã€èµ„æº id ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜é…ç½®äº†å¯¹ Spring Boot åœ¨ /oauth/check_token å¤„æä¾›çš„æ£€æŸ¥ä»¤ç‰Œç«¯ç‚¹çš„è®¿é—®ï¼Œä»¥åŠå¯¹ä¹Ÿè‡ªåŠ¨æ˜ å°„åœ¨ /oauth/token å¤„çš„ä»¤ç‰Œå‘è¡Œç«¯ç‚¹çš„è®¿é—®ã€‚\nOAuth çš„å®é™…åº”ç”¨ æˆ‘ä»¬å·²å°†æˆæƒæœåŠ¡å™¨é…ç½®ä¸ºåœ¨ç«¯å£ 8081 ä¸Šè¿è¡Œï¼Œå°†èµ„æºæœåŠ¡å™¨é…ç½®ä¸ºåœ¨ç«¯å£ 8989 ä¸Šè¿è¡Œã€‚å¯¹äºä¸‹é¢çš„æ‰€æœ‰ç¤ºä¾‹ï¼Œéƒ½ä½¿ç”¨ curl ï¼Œä½†å®¢æˆ·ç«¯å¯ä»¥æ˜¯ä»»ä½•åº”ç”¨ç¨‹åºã€‚\næˆ‘ä»¬é¦–å…ˆå°è¯•è®¿é—®èµ„æºæœåŠ¡å™¨ä¸­çš„ä¸€ä¸ªç«¯ç‚¹ï¼š\ncurl localhost:8989/foo { \u0026#34;error\u0026#34;: \u0026#34;unauthorized\u0026#34;, \u0026#34;error_description\u0026#34;: \u0026#34;Full authentication is required to access this resource\u0026#34; } è®©æˆ‘ä»¬è·å–ä¸€ä¸ªä»¤ç‰Œå¹¶é‡è¯•ã€‚\nå®¢æˆ·å‡­è¯æˆäºˆï¼š curl -X POST --user my-trusted-client:mysecret localhost:8081/oauth/token -d \u0026#39;grant_type=client_credentials\u0026amp;client_id=my-trusted-client\u0026#39; -H \u0026#34;Accept: application/json\u0026#34; å›å¤ï¼š\n{ \u0026#34;access_token\u0026#34;: \u0026#34;3670fea1-eab3-4981-b80a-e5c57203b20e\u0026#34;, \u0026#34;token_type\u0026#34;: \u0026#34;bearer\u0026#34;, \u0026#34;expires_in\u0026#34;: 51, \u0026#34;scope\u0026#34;: \u0026#34;read write trust\u0026#34; } æˆ‘ä»¬ç°åœ¨å¯ä»¥ä½¿ç”¨ä»¤ç‰Œæ¥è®¿é—®å—ä¿æŠ¤çš„ç«¯ç‚¹ï¼š\ncurl -v localhost:8989/foo -H \u0026#34;Authorization: Bearer 6bb86f18-e69e-4c2b-8fbf-85d7d5b800a4\u0026#34; foo å®¢æˆ·ç«¯å‡­æ®æˆäºˆä¸æ”¯æŒåˆ·æ–°ä»¤ç‰Œã€‚\nå¯†ç æˆäºˆï¼š å°±è·å–ä»¤ç‰Œçš„æµç¨‹è€Œè¨€ï¼Œå¯†ç æˆäºˆä¸å®¢æˆ·ç«¯å‡­æ®ç±»ä¼¼ï¼Œåªæ˜¯å®ƒä½¿ç”¨å®é™…çš„ç”¨æˆ·å‡­æ®ã€‚å®ƒè¿˜æ„å‘³ç€éœ€è¦ä¸ºåº”ç”¨ç¨‹åºé…ç½®ç”¨æˆ·ã€‚ Web å®‰å…¨é…ç½®å¦‚ä¸‹ï¼š\n@Configuration @EnableWebSecurity public class WebSecurity extends WebSecurityConfigurerAdapter { @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception { auth.inMemoryAuthentication().withUser(\u0026#34;gwidgets\u0026#34;).password(\u0026#34;gwidgets\u0026#34;).authorities(\u0026#34;CLIENT\u0026#34;); } @Override protected void configure(HttpSecurity http) throws Exception { http.authorizeRequests().anyRequest().authenticated().and().formLogin().defaultSuccessUrl(\u0026#34;/test.html\u0026#34;).and().csrf().disable(); } } ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç”¨æˆ·å‡­æ®æ¥è·å–ä»¤ç‰Œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\ncurl -X POST --user my-trusted-client:mysecret localhost:8081/oauth/token -d \u0026#39;grant_type=password\u0026amp;username=gwidgets\u0026amp;password=gwidgets\u0026#39; -H \u0026#34;Accept: application/json\u0026#34; å›å¤ï¼š\n{ \u0026#34;access_token\u0026#34;: \u0026#34;3670fea1-eab3-4981-b80a-e5c57203b20e\u0026#34;, \u0026#34;token_type\u0026#34;: \u0026#34;bearer\u0026#34;, \u0026#34;expires_in\u0026#34;: 51, \u0026#34;scope\u0026#34;: \u0026#34;read write trust\u0026#34; } å¯†ç æˆäºˆä¸æ”¯æŒåˆ·æ–°ä»¤ç‰Œã€‚\néšå¼æˆäºˆï¼š éšå¼æˆæƒæœ€é€‚åˆå‰ç«¯è·¯ç”±åº”ç”¨ç¨‹åºã€‚éšå¼æˆæƒéœ€è¦åŸºæœ¬èº«ä»½éªŒè¯å’Œ HTTP ä¼šè¯ã€‚ä¸ºäº†æ‰§è¡Œéšå¼æˆæƒï¼Œæˆ‘ä»¬å°†å‘æˆæƒæœåŠ¡å™¨æ·»åŠ ä¸€ä¸ªç®€å•çš„ http é¡µé¢ï¼ˆå®ƒå¯ä»¥ä½äºä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼‰ï¼š\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Title\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;we are here\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; è¦æ‰§è¡Œéšå¼æˆäºˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨æµè§ˆå™¨ä¸­å¯¼èˆªåˆ°ä»¥ä¸‹åœ°å€ï¼šhttp://localhost:8081/oauth/authorize?response_type=token\u0026amp;client_id=my-trusted-client\u0026amp;redirect-uri=http://localhost:8081/test.html\nç™»å½•åï¼Œæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ª OAuth å®¡æ‰¹é¡µé¢ï¼ˆspring é»˜è®¤æä¾›ï¼Œä½†å¯ä»¥è‡ªå®šä¹‰ï¼‰ï¼š\næ‰¹å‡†ä»¤ç‰Œçš„èŒƒå›´åï¼Œæˆ‘ä»¬æœ€ç»ˆä¼šé‡å®šå‘åˆ°æˆ‘ä»¬çš„é¡µé¢ï¼Œåœ¨è¯¥é¡µé¢ä¸­æˆ‘ä»¬åœ¨ url çš„å“ˆå¸Œä¸­æ‰¾åˆ°ä»¤ç‰Œï¼š\næˆæƒç æˆäºˆï¼š å¯¹äºæˆæƒç æˆäºˆï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆä»¥ä¸éšå¼æµç¨‹ç›¸åŒçš„æ–¹å¼è¿›è¡Œæˆæƒï¼Œåªä¸è¿‡ response_type ç°åœ¨æ˜¯ code ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å¯¼èˆªåˆ°ï¼šhttp://localhost:8081/oauth/authorize?response_type=code\u0026amp;client_id=my-trusted-client\u0026amp;redirect-uri=http://localhost:8081/test.html\nç„¶åæˆ‘ä»¬è¢«é‡å®šå‘åˆ°ç™»å½•ï¼Œç™»å½•åï¼Œæˆ‘ä»¬è¢«é‡å®šå‘åˆ° OAuth èŒƒå›´æ‰¹å‡†ï¼Œå¦‚ä¸Šä¸€èŠ‚ä¸­çš„éšå¼æµç¨‹ã€‚ä¹‹åï¼Œæˆ‘ä»¬è¢«é‡å®šå‘åˆ°ä»¥ä¸‹åœ°å€ï¼šhttp://localhost:8081/test.html?code=bD0mVbï¼Œè¿™æ˜¯æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„æ¬¢è¿é¡µé¢ï¼Œä½†å¸¦æœ‰ä¸€ä¸ªç‰¹æ®Šçš„æŸ¥è¯¢å‚æ•°ï¼š code ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ curl æ¥è·å–ä»¤ç‰Œä»¥è¿›è¡Œæ¼”ç¤ºï¼Œä½†ä¹Ÿå¯ä»¥ä½¿ç”¨ JavaScript åœ¨é¡µé¢ä¸­å®Œæˆæ­¤æ“ä½œï¼š\ncurl -X POST --user my-trusted-client:mysecret localhost:8081/oauth/token -d \u0026#39;grant_type=authorization_code\u0026amp;code=bD0mVb\u0026amp;redirect_uri=http://localhost:8081/test.html\u0026#39; -H \u0026#34;Accept: application/json\u0026#34; å›å¤ï¼š\n{ \u0026#34;access_token\u0026#34;: \u0026#34;0abe701b-0f5a-4d25-81df-f2c4db2af555\u0026#34;, \u0026#34;token_type\u0026#34;: \u0026#34;bearer\u0026#34;, \u0026#34;refresh_token\u0026#34;: \u0026#34;cf6aa9db-3757-465e-af68-b7d59d1f0b77\u0026#34;, \u0026#34;expires_in\u0026#34;: 59, \u0026#34;scope\u0026#34;: \u0026#34;trust read write\u0026#34; } åˆ·æ–°ä»¤ç‰Œï¼š æˆ‘ä»¬å·²ç»çœ‹åˆ°æˆæƒæˆäºˆæ˜¯å”¯ä¸€æ”¯æŒåˆ·æ–°ä»¤ç‰Œçš„æˆäºˆã€‚ä½¿ç”¨è®¿é—®ä»¤ç‰Œ 60 ç§’åï¼Œå®ƒå°±ä¼šè¿‡æœŸï¼Œæˆ‘ä»¬å¾—åˆ°ä»¥ä¸‹å“åº”ï¼š\n{ \u0026#34;error\u0026#34;: \u0026#34;invalid_token\u0026#34;, \u0026#34;error_description\u0026#34;: \u0026#34;0abe701b-0f5a-4d25-81df-f2c4db2af555\u0026#34; } è¿™æ„å‘³ç€è®¿é—®ä»¤ç‰Œå·²è¿‡æœŸã€‚è¦è·å–æ–°ä»¤ç‰Œï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨åˆ·æ–°ä»¤ç‰Œï¼š\ncurl -X POST --user my-trusted-client:mysecret localhost:8081/oauth/token -d \u0026#39;client_id=my-trusted-client\u0026amp;grant_type=refresh_token\u0026amp;refresh_token=cf6aa9db-3757-465e-af68-b7d59d1f0b77\u0026#39; -H \u0026#34;Accept: application/json\u0026#34; å›å¤ï¼š\n{ \u0026#34;access_token\u0026#34;: \u0026#34;2f9a6609-fc64-4b1e-93a3-8232827da881\u0026#34;, \u0026#34;token_type\u0026#34;: \u0026#34;bearer\u0026#34;, \u0026#34;refresh_token\u0026#34;: \u0026#34;cf6aa9db-3757-465e-af68-b7d59d1f0b77\u0026#34;, \u0026#34;expires_in\u0026#34;: 59, \u0026#34;scope\u0026#34;: \u0026#34;trust read write\u0026#34; } æ¯æ¬¡ä»¤ç‰Œè¿‡æœŸæ—¶éƒ½å¯ä»¥é‡å¤æ­¤è¿‡ç¨‹ã€‚\næ€»ç»“ Spring OAuth æä¾›å¼€ç®±å³ç”¨çš„ OAuth ç«¯ç‚¹å’Œæµç¨‹ï¼Œå¹¶ä¸”å¯ä»¥æˆä¸ºä»¥æœ€å°çš„åŠªåŠ›è®¾ç½® OAuth çš„ç»ä½³è§£å†³æ–¹æ¡ˆã€‚ç„¶è€Œï¼Œå¯¹äºä¸ç†Ÿæ‚‰ Spring çš„å¼€å‘äººå‘˜æ¥è¯´ï¼Œè¿™å¯èƒ½æœ‰ç‚¹ä»¤äººç•æƒ§ï¼Œå› ä¸ºå¾ˆå¤šäº‹æƒ…éƒ½åœ¨å¹•åå‘ç”Ÿã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯ä»¥å¸®åŠ©æ‚¨äº†è§£å…¨å±€ã€‚åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºä½¿ç”¨ OAuth èŒƒå›´æ¥ä¿æŠ¤ç«¯ç‚¹ã€‚\nå®Œæ•´çš„æºä»£ç å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ï¼šhttps://github.com/zak905/oauth2-example\nåŸæ–‡é“¾æ¥ï¼šhttp://www.zakariaamine.com/2018-01-27/using-oauth2-in-spring/\n","permalink":"https://blog.chensoul.cc/posts/2023/07/26/using-oauth2-in-spring/","summary":"OAuth2 æ˜¯ä¸€ç»„è§„èŒƒï¼Œä¸»è¦æä¾›å¯¹ Rest API çš„å®‰å…¨è®¿é—®çš„æ–¹æ³•ã€‚ OAuth çš„ä¸»è¦ç›®çš„æ˜¯å…è®¸é€šè¿‡ä½¿ç”¨ä»¤ç‰Œæ¥æ‰§è¡Œèº«ä»½éªŒè¯å’Œæˆæƒï¼Œè€Œä¸å¿…ä¸ºæ¯ä¸ªæ“ä½œæä¾›å‡­æ®ã€‚ç”±äºæœ¬æ–‡çš„é‡ç‚¹æ˜¯å®ç°ï¼Œå¹¶ä¸”ä¸ºäº†ä¸é‡æ–°å‘æ˜è½®å­ï¼Œå¯ä»¥æŸ¥çœ‹ OAuth RFC æˆ–ç»´åŸºç™¾ç§‘ä»¥è·å–æ›´å¤šç†è®ºèƒŒæ™¯ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ Spring ä¸­çš„ OAuth2 å®ç°ä»¥åŠå¦‚ä½•ä½¿ç”¨ä¸åŒçš„æˆæƒç±»å‹ï¼Œä½†åœ¨æ­¤ä¹‹å‰å€¼å¾—æä¾›ä¸€äº›é‡è¦æ¦‚å¿µçš„ç®€è¦å®šä¹‰ã€‚\nè®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œ èº«ä»½éªŒè¯æˆåŠŸåå°†æä¾›è®¿é—®ä»¤ç‰Œä»¥åŠåˆ·æ–°ä»¤ç‰Œã€‚è®¿é—®ä»¤ç‰Œæœ‰ä¸€ä¸ªæœ‰é™çš„æœ‰æ•ˆæœŸï¼ˆæ ‡å‡†ä¸º 1 å°æ—¶ï¼‰ï¼Œä¹‹åéœ€è¦åˆ·æ–°ä»¤ç‰Œæ‰èƒ½è·å–æ–°çš„è®¿é—®ä»¤ç‰Œå’Œæ–°çš„åˆ·æ–°ä»¤ç‰Œã€‚ Referesh ä»¤ç‰Œé€šå¸¸ä¼šåœ¨ä½¿ç”¨åè¿‡æœŸã€‚\nèµ„æºæœåŠ¡å™¨å’ŒæˆæƒæœåŠ¡å™¨ OAuth å¼•å…¥äº†æˆæƒæœåŠ¡å™¨çš„æ¦‚å¿µï¼ŒæˆæƒæœåŠ¡å™¨æ˜¯å‘å‡ºè®¿é—®å’Œåˆ·æ–°ä»¤ç‰Œçš„å®ä½“ï¼Œå¹¶åœ¨æ¯ä¸ªæ“ä½œä¸­è¿›è¡Œå’¨è¯¢ä»¥æŸ¥çœ‹ä»¤ç‰Œæ˜¯å¦æœ‰æ•ˆã€‚èµ„æºæœåŠ¡å™¨åªæ˜¯ç”±ä¸åŒå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼ˆå‰ç«¯åº”ç”¨ç¨‹åºã€ç§»åŠ¨è®¾å¤‡ã€å…¶ä»–åç«¯æœåŠ¡\u0026hellip;\u0026hellip;ï¼‰è®¿é—®çš„å®é™… Rest APIã€‚èµ„æºæœåŠ¡å™¨å’ŒæˆæƒæœåŠ¡å™¨å¯ä»¥æ˜¯ä¸åŒçš„å®ä½“ï¼Œä¹Ÿå¯ä»¥æ˜¯åŒä¸€å®ä½“ã€‚\næˆæƒç±»å‹ OAuth ä¸­æœ€å¸¸ç”¨çš„æˆæƒæœ‰ï¼šå®¢æˆ·ç«¯å‡­æ®ã€å¯†ç ã€æˆæƒç å’Œéšå¼æˆæƒã€‚æ¯é¡¹èµ„åŠ©éƒ½æœ‰ç‰¹å®šçš„æµç¨‹å’Œç”¨ä¾‹ï¼Œä½†ç”±äºæœ¬æ–‡çš„é‡ç‚¹ä¸æ˜¯ç†è®ºï¼Œå› æ­¤æˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨å…¶å®æ–½ã€‚æœ‰å…³æˆæƒåŠå…¶ç”¨é€”çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… OAuth RFCã€‚\nå®ç° åœ¨å®ç°æ–¹é¢ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Spring Boot æ¥åˆ©ç”¨å…¶è‡ªåŠ¨é…ç½®å’Œå¼•å¯¼åŠŸèƒ½ï¼Œå¹¶æ›´å¤šåœ°å…³æ³¨æˆ‘ä»¬çš„æ ¸å¿ƒä¸»é¢˜ã€‚\nèµ„æºæœåŠ¡å™¨ï¼š æˆ‘ä»¬æœ‰ä¸€ä¸ªèµ„æºæœåŠ¡å™¨ï¼Œå…¶ä¸­åŒ…å«æˆ‘ä»¬å¸Œæœ›ä¿æŠ¤çš„ä»¥ä¸‹ç«¯ç‚¹ï¼š\n@RestController(\u0026#34;/\u0026#34;) public class ResourceController { @GetMapping(\u0026#34;/hello\u0026#34;) public String hello(){ return \u0026#34;hello\u0026#34;; } @GetMapping(\u0026#34;/foo\u0026#34;) public String foo(){ return \u0026#34;foo\u0026#34;; } @GetMapping(\u0026#34;/bar\u0026#34;) public String bar(){ return \u0026#34;bar\u0026#34;; } @GetMapping(\u0026#34;/test\u0026#34;) public String test(){ return \u0026#34;test\u0026#34;; } } ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®ä¸€ä¸ªç”¨ @EnableResourceServer æ³¨é‡Šçš„ ResourceServerConfigurerAdapter beanï¼š\n@Configuration @EnableResourceServer public class ResourceSecurityConfiguration extends ResourceServerConfigurerAdapter { @Override public void configure(ResourceServerSecurityConfigurer resources) throws Exception { resources.resourceId(\u0026#34;resource\u0026#34;); } @Override public void configure(HttpSecurity http) throws Exception { http .","title":"[è¯‘]åœ¨ Spring ä¸­å®ç° OAuth2ï¼šç¬¬ 1 éƒ¨åˆ†"},{"content":"åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•ä½¿ç”¨ Spring Boot 2 å’Œ Spring Security 5 OAuth2 æ¥å®ç°é›†ä¸­æˆæƒçš„æˆæƒæœåŠ¡å™¨ä»¥åŠå¦‚ä½•é€šè¿‡ GUI å¯¹å…¶è¿›è¡Œç®¡ç†ï¼Œè¿˜å°†æä¾›èµ„æºæœåŠ¡å™¨æ¼”ç¤ºä»¥åŠ github ä¸‹çš„æ•´ä¸ªé¡¹ç›®ã€‚\nå¾ˆå¤šç¤ºä¾‹æ¶µç›–äº†åŸºäºæ—©æœŸç‰ˆæœ¬çš„ Spring boot 2 å’Œ Spring Security 5 ä½¿ç”¨å†…å­˜ä»¤ç‰Œå®ç° Oauth2ï¼Œå› æ­¤æƒ³æ³•æ˜¯ä½¿ç”¨ MySql æ•°æ®åº“ä½œä¸ºä»¤ç‰Œå­˜å‚¨ã€‚\nä¸ºäº†æ·±å…¥æ¢è®¨è¿™ä¸ªä¸»é¢˜ï¼Œæˆ‘ä»¬å¿…é¡»ï¼š\né…ç½® Spring å®‰å…¨ã€‚ é…ç½®æ•°æ®åº“ã€‚ åˆ›å»ºæˆæƒæœåŠ¡å™¨ã€‚ åˆ›å»ºèµ„æºæœåŠ¡å™¨ã€‚ ä½¿ç”¨ curl å®¢æˆ·ç«¯ä½¿ç”¨è®¿é—®ä»¤ç‰Œè·å–å®‰å…¨èµ„æºã€‚ ä»€ä¹ˆæ˜¯ Oauth 2ï¼Ÿ OAuth 2.0 æ˜¯è¡Œä¸šæ ‡å‡†æˆæƒåè®®ã€‚ OAuth 2.0 å–ä»£äº† 2006 å¹´åˆ›å»ºçš„åŸå§‹ OAuth åè®®ä¸Šæ‰€åšçš„å·¥ä½œã€‚OAuth 2.0 æ³¨é‡å®¢æˆ·ç«¯å¼€å‘äººå‘˜çš„ç®€å•æ€§ï¼ŒåŒæ—¶ä¸º Web åº”ç”¨ç¨‹åºã€æ¡Œé¢åº”ç”¨ç¨‹åºã€ç§»åŠ¨ç”µè¯å’Œå®¢å…è®¾å¤‡æä¾›ç‰¹å®šçš„æˆæƒæµç¨‹ã€‚\nè¯¥è§„èŒƒåŠå…¶æ‰©å±•æ­£åœ¨ IETF OAuth å·¥ä½œç»„å†…å¼€å‘ã€‚\nOauth 2 è§’è‰² OAuth2 å®šä¹‰äº† 4 ä¸ªè§’è‰²ï¼š\nèµ„æºæ‰€æœ‰è€…ï¼šé€šå¸¸æ˜¯æ‚¨è‡ªå·±ã€‚\nèµ„æºæœåŠ¡å™¨ï¼šæ‰˜ç®¡å—ä¿æŠ¤æ•°æ®çš„æœåŠ¡å™¨ï¼ˆä¾‹å¦‚ Google æ‰˜ç®¡æ‚¨çš„ä¸ªäººèµ„æ–™å’Œä¸ªäººä¿¡æ¯ï¼‰ã€‚\nå®¢æˆ·ç«¯ï¼šè¯·æ±‚è®¿é—®èµ„æºæœåŠ¡å™¨çš„åº”ç”¨ç¨‹åºï¼ˆç½‘ç«™ã€Javascript åº”ç”¨ç¨‹åºæˆ–ç§»åŠ¨åº”ç”¨ç¨‹åº\u0026hellip;\u0026hellip;ï¼‰ã€‚\næˆæƒæœåŠ¡å™¨ï¼šå‘å®¢æˆ·ç«¯é¢å‘è®¿é—®ä»¤ç‰Œçš„æœåŠ¡å™¨ã€‚è¯¥ä»¤ç‰Œå°†ç”¨äºå®¢æˆ·ç«¯è¯·æ±‚èµ„æºæœåŠ¡å™¨ã€‚è¯¥æœåŠ¡å™¨å¯ä»¥ä¸èµ„æºæœåŠ¡å™¨ç›¸åŒï¼ˆç›¸åŒçš„ç‰©ç†æœåŠ¡å™¨å’Œç›¸åŒçš„åº”ç”¨ç¨‹åºï¼‰ï¼Œè€Œä¸”ç»å¸¸æ˜¯è¿™ç§æƒ…å†µã€‚\nä¸‹å›¾è¯´æ˜äº†è§’è‰²æµç¨‹ï¼š\næˆæƒç±»å‹ OAuth 2 ä¸ºä¸åŒçš„ç”¨ä¾‹æä¾›äº†å¤šç§â€œæˆæƒç±»å‹â€ã€‚å®šä¹‰çš„æˆæƒç±»å‹å‹æœ‰ï¼š\næˆæƒç ï¼šæˆæƒç æˆäºˆæ˜¯ä½¿ç”¨æ‚¨çš„ Facebook æˆ– Google å¸æˆ·ç™»å½•åº”ç”¨ç¨‹åºçš„åŠŸèƒ½ã€‚ å¯†ç ï¼šæ—¨åœ¨ç”¨äºåŸºäºç”¨æˆ·ä»£ç†çš„å®¢æˆ·ç«¯ã€‚å…¶æ¬¡ï¼ŒæˆæƒæœåŠ¡å™¨ä¸ä¼šåƒæˆæƒä»£ç æˆäºˆé‚£æ ·è¿”å›æˆæƒä»£ç æ¥äº¤æ¢è®¿é—®ä»¤ç‰Œï¼Œè€Œæ˜¯è¿”å›è®¿é—®ä»¤ç‰Œã€‚ å®¢æˆ·ç«¯å‡­æ®ï¼šå®¢æˆ·ç«¯å¯ä»¥ä»…ä½¿ç”¨å…¶å®¢æˆ·ç«¯å‡­æ®ï¼ˆæˆ–å…¶ä»–æ”¯æŒçš„èº«ä»½éªŒè¯æ–¹å¼ï¼‰è¯·æ±‚è®¿é—®ä»¤ç‰Œï¼Œå½“å®¢æˆ·ç«¯è¯·æ±‚è®¿é—®å…¶ä¸‹çš„å—ä¿æŠ¤èµ„æºæ§åˆ¶æƒï¼Œæˆ–å…ˆå‰å·²è¢«å…¶ä»–èµ„æºæ‰€æœ‰è€…æ§åˆ¶çš„ä¸æˆæƒæœåŠ¡å™¨å®‰æ’ã€‚ éšå¼æˆæƒï¼šéšå¼æˆæƒæ˜¯ä¸€ç§ç®€åŒ–çš„æˆæƒä»£ç æµï¼Œé’ˆå¯¹ä½¿ç”¨ JavaScript ç­‰è„šæœ¬è¯­è¨€åœ¨æµè§ˆå™¨ä¸­å®ç°çš„å®¢æˆ·ç«¯è¿›è¡Œäº†ä¼˜åŒ–ã€‚åœ¨éšå¼æµç¨‹ä¸­ï¼Œè€Œä¸æ˜¯å‘å®¢æˆ·ç«¯å‘å‡ºæˆæƒä»£ç ï¼Œç›´æ¥å‘å®¢æˆ·ç«¯é¢å‘è®¿é—®ä»¤ç‰Œã€‚ ç¤ºèŒƒ è®©æˆ‘ä»¬åŠ¨æ‰‹å§\nä¸šåŠ¡å±‚ ä¸ºç®€å•èµ·è§ï¼Œæˆ‘ä»¬çš„ä¸»è¦ä¸šåŠ¡åº”ç”¨ç¨‹åºå°†æ˜¯ä½¿ç”¨ä¸€ä¸ªå®ä½“çš„äº§å“ APIï¼Œæˆ‘ä»¬çš„è®¿é—®è§„åˆ™å°†æ˜¯ï¼š\nPRODUCT_CREATE PRODUCT_UPDATE PRODUCT_DISPLAY PRODUCT_ADMIN OAuth2 å®¢æˆ·ç«¯è®¾ç½® è¦è®¾ç½® Oauth 2 å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸‹è¡¨ [æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…é“¾æ¥]\nOAUTH_CLIENT_DETAILS OAUTH_CLIENT_DETAILS OAUTH_CLIENT_TOKEN OAUTH_CLIENT_TOKEN OAUTH_ACCESS_TOKEN OAUTH_ACCESS_TOKEN OAUTH_REFRESH_TOKEN OAUTH_REFRESH_TOKEN OAUTHCODE OAUTHä»£ç  OAUTH_APPROVALS OAUTH_APPROVALS æˆ‘ä»¬å°†è°ƒç”¨åƒâ€œproduct_apiâ€è¿™æ ·çš„èµ„æºæœåŠ¡å™¨ å¯¹äºè¯¥æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œç§°ä¸ºï¼š\nè¯»-å†™-å®¢æˆ·ç«¯ï¼ˆæˆæƒæˆæƒç±»å‹ï¼šè¯»ã€å†™ï¼‰ INSERT INTO OAUTH_CLIENT_DETAILS(CLIENT_ID, RESOURCE_IDS, CLIENT_SECRET, SCOPE, AUTHORIZED_GRANT_TYPES, AUTHORITIES, ACCESS_TOKEN_VALIDITY, REFRESH_TOKEN_VALIDITY) VALUES (\u0026#39;read-write-client\u0026#39;, \u0026#39;product-api\u0026#39;,\u0026#39;$2a$10$BurTWIy5NTF9GJJH4magz.9Bd4bBurWYG8tmXxeQh1vs7r/wnCFG2\u0026#39;,\u0026#39;read,write\u0026#39;, \u0026#39;client_credentials\u0026#39;, \u0026#39;ROLE_PRODUCT_ADMIN\u0026#39;, 10800, 2592000); #password [hashed with BCCrypt] :user æƒé™å’Œç”¨æˆ·è®¾ç½® Spring Security é™„å¸¦ä¸¤ä¸ªæœ‰ç”¨çš„æ¥å£ï¼š\nUserDetails â€” æä¾›æ ¸å¿ƒç”¨æˆ·ä¿¡æ¯ã€‚\nGrantedAuthority â€” è¡¨ç¤ºæˆäºˆèº«ä»½éªŒè¯å¯¹è±¡çš„æƒé™ã€‚\nä¸‹é¢çš„è„šæœ¬å°†åŠ è½½æ‰€æœ‰æƒé™å’Œå‡­æ®ï¼ˆç”¨æˆ·ï¼‰ï¼š\nINSERT INTO authority VALUES(1,\u0026#39;ROLE_OAUTH_ADMIN\u0026#39;); INSERT INTO authority VALUES(2,\u0026#39;ROLE_ADMIN_PRODUCT\u0026#39;); INSERT INTO authority VALUES(3,\u0026#39;ROLE_RESOURCE_ADMIN\u0026#39;); INSERT INTO credentials VALUES(1,b\u0026#39;1\u0026#39;,\u0026#39;oauth_admin\u0026#39;,\u0026#39;$2a$10$BurTWIy5NTF9GJJH4magz.9Bd4bBurWYG8tmXxeQh1vs7r/wnCFG2\u0026#39;,\u0026#39;0\u0026#39;); INSERT INTO credentials VALUES(2,b\u0026#39;1\u0026#39;,\u0026#39;resource_admin\u0026#39;,\u0026#39;$2a$10$BurTWIy5NTF9GJJH4magz.9Bd4bBurWYG8tmXxeQh1vs7r/wnCFG2\u0026#39;,\u0026#39;0\u0026#39;); INSERT INTO credentials VALUES(3,b\u0026#39;1\u0026#39;,\u0026#39;user\u0026#39;,\u0026#39;$2a$10$BurTWIy5NTF9GJJH4magz.9Bd4bBurWYG8tmXxeQh1vs7r/wnCFG2\u0026#39;,\u0026#39;0\u0026#39;); INSERT INTO credentials_authorities VALUES (1, 1); INSERT INTO credentials_authorities VALUES (2, 3); INSERT INTO credentials_authorities VALUES (3, 2); #Password : user API å±‚ å¯¹äºæ¼”ç¤ºï¼ŒåŸºäº Spring Boot å¼€å‘äº† RESTful åº”ç”¨ç¨‹åºå¹¶å…¬å¼€ä»¥ä¸‹ç«¯ç‚¹ï¼š\nSpring å®‰å…¨é…ç½® æˆ‘ä»¬å¿…é¡»æä¾› UserDetailsService æ¥å£çš„å®ç°ï¼Œä»¥ä¾¿è·å–ç”¨æˆ·å‡­æ®å’Œæƒé™ï¼Œå¦‚ä¸‹æ‰€ç¤º\nä¸ºäº†å‘åº”ç”¨ç¨‹åºæä¾›å®‰å…¨æ€§ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ @EnableWebSecurity æ³¨è§£å’Œ WebSecurityConfigurerAdapter\npackage com.aak.configuration; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.builders.WebSecurity; import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity; import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter; import org.springframework.security.core.userdetails.UserDetailsService; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; import org.springframework.security.crypto.password.PasswordEncoder; import org.springframework.security.provisioning.JdbcUserDetailsManager; import org.springframework.security.web.util.matcher.AntPathRequestMatcher; /** * Created by ahmed on 20.5.18. */ @EnableWebSecurity @Configuration public class WebSecurityConfiguration extends WebSecurityConfigurerAdapter { @Bean public PasswordEncoder passwordEncoder() { return new BCryptPasswordEncoder(); } @Bean @Override public UserDetailsService userDetailsServiceBean() throws Exception { return new JdbcUserDetails(); } @Override public void configure(WebSecurity web) throws Exception { web.ignoring().antMatchers(\u0026#34;/webjars/**\u0026#34;); } @Override protected void configure(HttpSecurity http) throws Exception { http .authorizeRequests() .antMatchers(\u0026#34;/login\u0026#34;,\u0026#34;/logout.do\u0026#34;).permitAll() .antMatchers(\u0026#34;/**\u0026#34;).authenticated() .and() .formLogin() .loginProcessingUrl(\u0026#34;/login.do\u0026#34;) .usernameParameter(\u0026#34;username\u0026#34;) .passwordParameter(\u0026#34;password\u0026#34;) .loginPage(\u0026#34;/login\u0026#34;) .and() .logout() .logoutRequestMatcher(new AntPathRequestMatcher(\u0026#34;/logout.do\u0026#34;)) .and() .userDetailsService(userDetailsServiceBean()); } @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception { auth.userDetailsService(userDetailsServiceBean()) .passwordEncoder(passwordEncoder()); } } OAuth2 é…ç½® è¦è®¾ç½® Oauth 2ï¼Œéœ€è¦å®ç°ä¸¤ä¸ªç»„ä»¶\nAuthorization Server æˆæƒæœåŠ¡å™¨ Resource Server èµ„æºæœåŠ¡å™¨ æˆæƒæœåŠ¡å™¨ æˆæƒæœåŠ¡å™¨è´Ÿè´£éªŒè¯ç”¨æˆ·èº«ä»½å¹¶æä¾›ä»¤ç‰Œï¼Œä½¿ç”¨@EnableAuthorizationServer æ³¨è§£å¯ç”¨æˆæƒæœåŠ¡å™¨é…ç½®\npackage com.aak.configuration; import org.springframework.boot.context.properties.ConfigurationProperties; import org.springframework.boot.jdbc.DataSourceBuilder; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.oauth2.config.annotation.configurers.ClientDetailsServiceConfigurer; import org.springframework.security.oauth2.config.annotation.web.configuration.AuthorizationServerConfigurerAdapter; import org.springframework.security.oauth2.config.annotation.web.configuration.EnableAuthorizationServer; import org.springframework.security.oauth2.config.annotation.web.configurers.AuthorizationServerEndpointsConfigurer; import org.springframework.security.oauth2.config.annotation.web.configurers.AuthorizationServerSecurityConfigurer; import org.springframework.security.oauth2.provider.approval.ApprovalStore; import org.springframework.security.oauth2.provider.approval.JdbcApprovalStore; import org.springframework.security.oauth2.provider.client.JdbcClientDetailsService; import org.springframework.security.oauth2.provider.code.AuthorizationCodeServices; import org.springframework.security.oauth2.provider.code.JdbcAuthorizationCodeServices; import org.springframework.security.oauth2.provider.token.TokenStore; import org.springframework.security.oauth2.provider.token.store.JdbcTokenStore; import javax.sql.DataSource; /** * Created by ahmed on 21.5.18. */ @Configuration @EnableAuthorizationServer public class AuthorizationServerConfiguration extends AuthorizationServerConfigurerAdapter { @Bean @ConfigurationProperties(prefix = \u0026#34;spring.datasource\u0026#34;) public DataSource oauthDataSource() { return DataSourceBuilder.create().build(); } @Bean public JdbcClientDetailsService clientDetailsService() { return new JdbcClientDetailsService(oauthDataSource()); } @Bean public TokenStore tokenStore() { return new JdbcTokenStore(oauthDataSource()); } @Bean public ApprovalStore approvalStore() { return new JdbcApprovalStore(oauthDataSource()); } @Bean public AuthorizationCodeServices authorizationCodeServices() { return new JdbcAuthorizationCodeServices(oauthDataSource()); } @Override public void configure(ClientDetailsServiceConfigurer clients) throws Exception { clients.withClientDetails(clientDetailsService()); } @Override public void configure(AuthorizationServerSecurityConfigurer oauthServer) throws Exception { } @Override public void configure(AuthorizationServerEndpointsConfigurer endpoints) throws Exception { endpoints .approvalStore(approvalStore()) .authorizationCodeServices(authorizationCodeServices()) .tokenStore(tokenStore()); } } æˆåŠŸé…ç½®è¿è¡ŒæˆæƒæœåŠ¡å™¨åï¼Œæ‚¨å°†è·å¾—ç™»å½•é¡µé¢æ¥ç®¡ç†æˆæƒæœåŠ¡å™¨\nä½¿ç”¨ oauth_admin/user ä½œä¸ºç”¨æˆ·å/å¯†ç è®¿é—® Oauth2 ä»ªè¡¨æ¿ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­åˆ›å»ºæœåŠ¡å™¨å®¢æˆ·ç«¯\nèµ„æºæœåŠ¡å™¨ èµ„æºæœåŠ¡å™¨æ‰˜ç®¡å— OAuth2 ä»¤ç‰Œä¿æŠ¤çš„èµ„æºï¼ˆåŸºæœ¬ä¸Šæ˜¯æˆ‘ä»¬çš„äº§å“ APIï¼‰\npackage com.aak.configuration; import org.springframework.boot.context.properties.ConfigurationProperties; import org.springframework.boot.jdbc.DataSourceBuilder; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.http.HttpMethod; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.oauth2.config.annotation.web.configuration.EnableResourceServer; import org.springframework.security.oauth2.config.annotation.web.configuration.ResourceServerConfigurerAdapter; import org.springframework.security.oauth2.config.annotation.web.configurers.ResourceServerSecurityConfigurer; import org.springframework.security.oauth2.provider.token.TokenStore; import org.springframework.security.oauth2.provider.token.store.JdbcTokenStore; import javax.sql.DataSource; /** * Created by ahmed on 30.5.18. */ @EnableResourceServer @Configuration public class ResourcesServerConfiguration extends ResourceServerConfigurerAdapter { @Bean @ConfigurationProperties(prefix=\u0026#34;spring.datasource\u0026#34;) public DataSource ouathDataSource(){return DataSourceBuilder.create().build();} @Override public void configure(ResourceServerSecurityConfigurer resources)throws Exception{ TokenStore tokenStore=new JdbcTokenStore(ouathDataSource()); resources.resourceId(\u0026#34;product_api\u0026#34;).tokenStore(tokenStore); } @Override public void configure(HttpSecurity http) throws Exception{ http .authorizeRequests() .antMatchers(HttpMethod.GET, \u0026#34;/**\u0026#34;).access(\u0026#34;#oauth2.hasScope(\u0026#39;read\u0026#39;)\u0026#34;) .antMatchers(HttpMethod.POST, \u0026#34;/**\u0026#34;).access(\u0026#34;#oauth2.hasScope(\u0026#39;write\u0026#39;)\u0026#34;) .antMatchers(HttpMethod.PATCH, \u0026#34;/**\u0026#34;).access(\u0026#34;#oauth2.hasScope(\u0026#39;write\u0026#39;)\u0026#34;) .antMatchers(HttpMethod.PUT, \u0026#34;/**\u0026#34;).access(\u0026#34;#oauth2.hasScope(\u0026#39;write\u0026#39;)\u0026#34;) .antMatchers(HttpMethod.DELETE, \u0026#34;/**\u0026#34;).access(\u0026#34;#oauth2.hasScope(\u0026#39;write\u0026#39;)\u0026#34;) .and() .headers().addHeaderWriter((request, response) -\u0026gt; { response.addHeader(\u0026#34;Access-Control-Allow-Origin\u0026#34;, \u0026#34;*\u0026#34;); if (request.getMethod().equals(\u0026#34;OPTIONS\u0026#34;)) { response.setHeader(\u0026#34;Access-Control-Allow-Methods\u0026#34;, request.getHeader(\u0026#34;Access-Control-Request-Method\u0026#34;)); response.setHeader(\u0026#34;Access-Control-Allow-Headers\u0026#34;, request.getHeader(\u0026#34;Access-Control-Request-Headers\u0026#34;)); } }); } } ä½¿ç”¨ä»¥ä¸‹ Curl å®¢æˆ·ç«¯æµ‹è¯•äº§å“åˆ—è¡¨ç«¯ç‚¹ï¼š\n#!/bin/sh TOKEN=`curl -s -u curl_client:user -X POST localhost:8081/oauth/token\\?grant_type=client_credentials | egrep -o â€˜[a-f0â€“9-]{20,}â€™` echo â€œ tGot token for curl client as :$TOKENâ€ curl localhost:8083/product/products -H â€œAuthorization: Bearer $TOKENâ€ è¿è¡Œ Curl å®¢æˆ·ç«¯ bash è„šæœ¬åå¾—åˆ°å“åº”ï¼š\n$ ./client.sh Got token for curl client as : 3be01519â€“0cab-4049-b87d-617c48bda502 [{â€œversionâ€:0,â€nameâ€:â€product_1\u0026#34;,â€availableâ€:false},{â€œversionâ€:0,â€nameâ€:â€product_2\u0026#34;,â€availableâ€:true}] ä» github ä¸ŠæŸ¥çœ‹æ•´ä¸ªä»£ç ï¼šhttps://github.com/Akourtiim/oauth2-spring-boot-2.0.2.git\nå‚è€ƒï¼š\nhttps://tools.ietf.org/html/rfc6749 https://dzone.com/articles/secure-spring-rest-with-spring-security-and-oauth2 http://www.bubblecode.net/en/2016/01/22/understanding-oauth2/ https://github.com/FrontierPsychiatrist/spring-oauth-example åŸæ–‡é“¾æ¥ï¼šOauth 2 Centralized Authorization with Spring Boot 2.0.2 and Spring Security 5 and JDBC token store\n","permalink":"https://blog.chensoul.cc/posts/2023/07/14/oauth-2-centralized-authorization-with-spring-boot-2-and-spring-security-5-and-jdbc-token-store/","summary":"åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•ä½¿ç”¨ Spring Boot 2 å’Œ Spring Security 5 OAuth2 æ¥å®ç°é›†ä¸­æˆæƒçš„æˆæƒæœåŠ¡å™¨ä»¥åŠå¦‚ä½•é€šè¿‡ GUI å¯¹å…¶è¿›è¡Œç®¡ç†ï¼Œè¿˜å°†æä¾›èµ„æºæœåŠ¡å™¨æ¼”ç¤ºä»¥åŠ github ä¸‹çš„æ•´ä¸ªé¡¹ç›®ã€‚\nå¾ˆå¤šç¤ºä¾‹æ¶µç›–äº†åŸºäºæ—©æœŸç‰ˆæœ¬çš„ Spring boot 2 å’Œ Spring Security 5 ä½¿ç”¨å†…å­˜ä»¤ç‰Œå®ç° Oauth2ï¼Œå› æ­¤æƒ³æ³•æ˜¯ä½¿ç”¨ MySql æ•°æ®åº“ä½œä¸ºä»¤ç‰Œå­˜å‚¨ã€‚\nä¸ºäº†æ·±å…¥æ¢è®¨è¿™ä¸ªä¸»é¢˜ï¼Œæˆ‘ä»¬å¿…é¡»ï¼š\né…ç½® Spring å®‰å…¨ã€‚ é…ç½®æ•°æ®åº“ã€‚ åˆ›å»ºæˆæƒæœåŠ¡å™¨ã€‚ åˆ›å»ºèµ„æºæœåŠ¡å™¨ã€‚ ä½¿ç”¨ curl å®¢æˆ·ç«¯ä½¿ç”¨è®¿é—®ä»¤ç‰Œè·å–å®‰å…¨èµ„æºã€‚ ä»€ä¹ˆæ˜¯ Oauth 2ï¼Ÿ OAuth 2.0 æ˜¯è¡Œä¸šæ ‡å‡†æˆæƒåè®®ã€‚ OAuth 2.0 å–ä»£äº† 2006 å¹´åˆ›å»ºçš„åŸå§‹ OAuth åè®®ä¸Šæ‰€åšçš„å·¥ä½œã€‚OAuth 2.0 æ³¨é‡å®¢æˆ·ç«¯å¼€å‘äººå‘˜çš„ç®€å•æ€§ï¼ŒåŒæ—¶ä¸º Web åº”ç”¨ç¨‹åºã€æ¡Œé¢åº”ç”¨ç¨‹åºã€ç§»åŠ¨ç”µè¯å’Œå®¢å…è®¾å¤‡æä¾›ç‰¹å®šçš„æˆæƒæµç¨‹ã€‚\nè¯¥è§„èŒƒåŠå…¶æ‰©å±•æ­£åœ¨ IETF OAuth å·¥ä½œç»„å†…å¼€å‘ã€‚\nOauth 2 è§’è‰² OAuth2 å®šä¹‰äº† 4 ä¸ªè§’è‰²ï¼š\nèµ„æºæ‰€æœ‰è€…ï¼šé€šå¸¸æ˜¯æ‚¨è‡ªå·±ã€‚\nèµ„æºæœåŠ¡å™¨ï¼šæ‰˜ç®¡å—ä¿æŠ¤æ•°æ®çš„æœåŠ¡å™¨ï¼ˆä¾‹å¦‚ Google æ‰˜ç®¡æ‚¨çš„ä¸ªäººèµ„æ–™å’Œä¸ªäººä¿¡æ¯ï¼‰ã€‚\nå®¢æˆ·ç«¯ï¼šè¯·æ±‚è®¿é—®èµ„æºæœåŠ¡å™¨çš„åº”ç”¨ç¨‹åºï¼ˆç½‘ç«™ã€Javascript åº”ç”¨ç¨‹åºæˆ–ç§»åŠ¨åº”ç”¨ç¨‹åº\u0026hellip;\u0026hellip;ï¼‰ã€‚\næˆæƒæœåŠ¡å™¨ï¼šå‘å®¢æˆ·ç«¯é¢å‘è®¿é—®ä»¤ç‰Œçš„æœåŠ¡å™¨ã€‚è¯¥ä»¤ç‰Œå°†ç”¨äºå®¢æˆ·ç«¯è¯·æ±‚èµ„æºæœåŠ¡å™¨ã€‚è¯¥æœåŠ¡å™¨å¯ä»¥ä¸èµ„æºæœåŠ¡å™¨ç›¸åŒï¼ˆç›¸åŒçš„ç‰©ç†æœåŠ¡å™¨å’Œç›¸åŒçš„åº”ç”¨ç¨‹åºï¼‰ï¼Œè€Œä¸”ç»å¸¸æ˜¯è¿™ç§æƒ…å†µã€‚\nä¸‹å›¾è¯´æ˜äº†è§’è‰²æµç¨‹ï¼š\næˆæƒç±»å‹ OAuth 2 ä¸ºä¸åŒçš„ç”¨ä¾‹æä¾›äº†å¤šç§â€œæˆæƒç±»å‹â€ã€‚å®šä¹‰çš„æˆæƒç±»å‹å‹æœ‰ï¼š\næˆæƒç ï¼šæˆæƒç æˆäºˆæ˜¯ä½¿ç”¨æ‚¨çš„ Facebook æˆ– Google å¸æˆ·ç™»å½•åº”ç”¨ç¨‹åºçš„åŠŸèƒ½ã€‚ å¯†ç ï¼šæ—¨åœ¨ç”¨äºåŸºäºç”¨æˆ·ä»£ç†çš„å®¢æˆ·ç«¯ã€‚å…¶æ¬¡ï¼ŒæˆæƒæœåŠ¡å™¨ä¸ä¼šåƒæˆæƒä»£ç æˆäºˆé‚£æ ·è¿”å›æˆæƒä»£ç æ¥äº¤æ¢è®¿é—®ä»¤ç‰Œï¼Œè€Œæ˜¯è¿”å›è®¿é—®ä»¤ç‰Œã€‚ å®¢æˆ·ç«¯å‡­æ®ï¼šå®¢æˆ·ç«¯å¯ä»¥ä»…ä½¿ç”¨å…¶å®¢æˆ·ç«¯å‡­æ®ï¼ˆæˆ–å…¶ä»–æ”¯æŒçš„èº«ä»½éªŒè¯æ–¹å¼ï¼‰è¯·æ±‚è®¿é—®ä»¤ç‰Œï¼Œå½“å®¢æˆ·ç«¯è¯·æ±‚è®¿é—®å…¶ä¸‹çš„å—ä¿æŠ¤èµ„æºæ§åˆ¶æƒï¼Œæˆ–å…ˆå‰å·²è¢«å…¶ä»–èµ„æºæ‰€æœ‰è€…æ§åˆ¶çš„ä¸æˆæƒæœåŠ¡å™¨å®‰æ’ã€‚ éšå¼æˆæƒï¼šéšå¼æˆæƒæ˜¯ä¸€ç§ç®€åŒ–çš„æˆæƒä»£ç æµï¼Œé’ˆå¯¹ä½¿ç”¨ JavaScript ç­‰è„šæœ¬è¯­è¨€åœ¨æµè§ˆå™¨ä¸­å®ç°çš„å®¢æˆ·ç«¯è¿›è¡Œäº†ä¼˜åŒ–ã€‚åœ¨éšå¼æµç¨‹ä¸­ï¼Œè€Œä¸æ˜¯å‘å®¢æˆ·ç«¯å‘å‡ºæˆæƒä»£ç ï¼Œç›´æ¥å‘å®¢æˆ·ç«¯é¢å‘è®¿é—®ä»¤ç‰Œã€‚ ç¤ºèŒƒ è®©æˆ‘ä»¬åŠ¨æ‰‹å§\nä¸šåŠ¡å±‚ ä¸ºç®€å•èµ·è§ï¼Œæˆ‘ä»¬çš„ä¸»è¦ä¸šåŠ¡åº”ç”¨ç¨‹åºå°†æ˜¯ä½¿ç”¨ä¸€ä¸ªå®ä½“çš„äº§å“ APIï¼Œæˆ‘ä»¬çš„è®¿é—®è§„åˆ™å°†æ˜¯ï¼š\nPRODUCT_CREATE PRODUCT_UPDATE PRODUCT_DISPLAY PRODUCT_ADMIN OAuth2 å®¢æˆ·ç«¯è®¾ç½® è¦è®¾ç½® Oauth 2 å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸‹è¡¨ [æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…é“¾æ¥]","title":"[è¯‘]ä½¿ç”¨Spring Boot2å’ŒSpring Security 5ä»¥åŠJDBCä»¤ç‰Œå­˜å‚¨è¿›è¡ŒOauth2é›†ä¸­æˆæƒ"},{"content":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-06-26 åˆ° 2023-07-09 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¯»ä¹¦ã€å¥èº«ã€æŠ•èµ„ã€å¸®æœ‹å‹ã€é™ªå®¶äººã€‚\nè¿™ä¸¤å‘¨ä¸»è¦æ˜¯å¿™äºå·¥ä½œï¼ŒWekatime ä¸Šç»Ÿè®¡çš„ä¸Šå‘¨æ¯å¤©å¹³å‡ç¼–ç¨‹æ—¶é—´è¾¾åˆ°äº† 6 hrs 52 minsï¼ŒåŸºæœ¬ä¸Šæ¯å¤©éƒ½æ˜¯æ—©ä¸ƒæ™šä¸ƒçš„ä¸Šç­èŠ‚å¥ã€‚äºæ˜¯ï¼Œå­¦ä¹ çš„æ—¶é—´éƒ½è¢«å·¥ä½œå ç”¨äº†ã€‚å·¥ä½œçš„å†…å®¹ä¸»è¦æ˜¯æ•´åˆå¤šä¸ªç³»ç»Ÿå®ç° sso ç™»å½•ï¼Œç”¨åˆ°çš„æŠ€æœ¯æœ‰ SpringCloudã€Spring Security Oauth2 ç­‰ç­‰ã€‚\nå¦å¤–ï¼Œæœ¬å‘¨å®Œæˆäº†ä¸ŠåŠå¹´çš„ç»©æ•ˆæ€»ç»“ï¼Œå›é¡¾äº†è¿™åŠå¹´çš„å·¥ä½œå†…å®¹ã€‚\nç»©æ•ˆæ€»ç»“ 1ã€é¡¹ç›®æ–¹é¢çš„æˆæœï¼š\naã€å®Œæˆäº†æ™ºèƒ½å®‰é˜²å¤šä¸ªé¡¹ç›®çš„è¿­ä»£å¼€å‘å’Œä¸Šçº¿ï¼ŒåŒ…æ‹¬ç”¨æˆ·åˆ‡æ¢ç§Ÿæˆ·ã€æŠ¥è¡¨å‘é€åˆ°é£ä¹¦ã€åä¸ºè½¦ç‰Œè¯†åˆ«ã€å¤œæ”¶æ¨¡å—æ‹†åˆ†ã€å·¡æ£€åœºæ™¯åŠŸèƒ½ä¼˜åŒ–ç­‰ã€‚åŒæ—¶ï¼Œä¹Ÿå®Œæˆäº†é€šçŸ¥æ¨¡å—é‡æ„ã€å¤§å±æŠ¥è¡¨æ”¯æŒå¤šç§Ÿæˆ·å’Œé—¨åº—ã€Dmallai å¯¼èˆªç­‰éœ€æ±‚çš„å¼€å‘ã€‚è¿™äº›å·¥ä½œçš„å®Œæˆï¼Œä¸ºç³»ç»Ÿçš„ç¨³å®šæ€§å’ŒåŠŸèƒ½æ‰©å±•æä¾›äº†æœ‰åŠ›çš„æ”¯æŒã€‚\nbã€å…±å‘å¸ƒäº† 32 æ¬¡ç‰ˆæœ¬ï¼Œå…¶ä¸­ 7 æ¬¡ä¸ºåŠŸèƒ½è¿­ä»£ï¼Œ25 æ¬¡ä¸º bug ä¿®å¤ã€‚å¹³å‡æ¯æœˆå®Œæˆäº† 1 æ¬¡é¡¹ç›®è¿­ä»£å’Œ 4 æ¬¡ bug ä¿®å¤ï¼Œåšåˆ°äº†åŠæ—¶å“åº”å’Œå¿«é€Ÿè§£å†³é—®é¢˜ï¼Œæå‡äº†ç”¨æˆ·çš„ä½¿ç”¨ä½“éªŒå’Œæ»¡æ„åº¦ï¼Œæé«˜äº†ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œé™ä½ç³»ç»Ÿçš„æ•…éšœç‡å’Œç”¨æˆ·çš„æŠ•è¯‰ç‡ï¼Œæ²¡æœ‰å‡ºç° P3 çº§åˆ«ä»¥ä¸Šæ•…éšœã€‚\n2ã€æŠ€æœ¯æ–¹é¢çš„æˆæœï¼š\nåˆ©ç”¨ç©ºä½™æ—¶é—´å­¦ä¹ æ–°æŠ€æœ¯å’Œæ¡†æ¶ï¼Œå¦‚ Pyhonã€Rustã€Reactï¼Œæ¯å‘¨å†™å‘¨æŠ¥å’Œå­¦ä¹ æ€»ç»“ï¼Œæ€»è®¡è¾“å‡º 66 ç¯‡æ–‡ç« ã€‚\nä¸æ–­ä¼˜åŒ–å’Œè¿­ä»£ Rose æ¡†æ¶ï¼Œå¹¶å°† Rose åˆå¹¶åˆ° Cocktail cloudï¼Œæ–¹ä¾¿ä»£ç ç®¡ç†å’Œç»´æŠ¤ã€‚åŒæ—¶ï¼ŒCocktail cloud è¿˜å¢åŠ äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œç‰¹æ€§ï¼Œå¦‚å›½é™…åŒ–ã€æ—¥å¿—æ‰“å°ã€åä¸ºäº‘æ¥å£å°è£…ç­‰ã€‚\nåˆ©ç”¨è®¾è®¡æ¨¡å¼é‡æ„é€šçŸ¥æ¨¡å—ï¼Œæå‡ä»£ç è´¨é‡ï¼ŒåŒæ—¶ç³»ç»Ÿæ‰©å±•æ€§å’Œå¹¶å‘ä¹Ÿå¾—åˆ°å¾ˆå¤§çš„æå‡ã€‚\n3ã€ä¸ªäººå‘å±•æ–¹é¢çš„æˆæœï¼š\né€šè¿‡ä¸æ–­å­¦ä¹ å’Œå®è·µï¼Œæé«˜äº†è‡ªå·±çš„æ²Ÿé€šèƒ½åŠ›å’Œæ—¶é—´ç®¡ç†çš„èƒ½åŠ›ã€‚æ¯å¤©æ—©ä¸Š 7 ç‚¹åˆ°å…¬å¸å­¦ä¹ ï¼Œæé«˜äº†ä¸ªäººå·¥ä½œæ•ˆç‡å’Œæ‰§è¡ŒåŠ›ã€‚\n4ã€å›¢é˜Ÿåˆä½œæ–¹é¢çš„æˆæœï¼š\nåŠ å¼ºäº†å’ŒåŒäº‹ä¹‹é—´çš„æ²Ÿé€šå’Œåä½œï¼ŒåŠæ—¶è®¨è®ºé¡¹ç›®éœ€æ±‚å’Œè¿›åº¦ï¼Œä¿éšœé¡¹ç›®æŒ‰æ—¶ä¸Šçº¿ã€‚\nè¯»ä¹¦ å¥èº« æˆ‘è·‘è¿‡äº†ä¸€äº›åœ°æ–¹ï¼Œå¸Œæœ›éšç€æ—¶é—´æ¨ç§»ï¼Œåœ°å›¾ç‚¹äº®çš„åœ°æ–¹è¶Šæ¥è¶Šå¤šã€‚2 å¹´é‡Œæˆ‘è·‘è¿‡ 2 ä¸ªçœä»½ 2 ä¸ªåŸå¸‚ã€‚æ›´å¤šè·‘æ­¥æ•°æ®åœ¨æˆ‘çš„ è·‘æ­¥ ä¸»é¡µã€‚\nç†è´¢ è¿™å‘¨æ€»è®¡æ”¯å‡º 1483 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š\n7 æœˆ 2 æ—¥ï¼š1276 å…ƒï¼Œå…¶ä¸­ 1000 å…ƒåŠ æ²¹\n7 æœˆ 1 æ—¥ï¼š32 å…ƒ\n6 æœˆ 30 æ—¥ï¼š35 å…ƒ\n6 æœˆ 29 æ—¥ï¼š15 å…ƒ\n6 æœˆ 28 æ—¥ï¼š41 å…ƒ\n6 æœˆ 27 æ—¥ï¼š41 å…ƒ\n6 æœˆ 26 æ—¥ï¼š43 å…ƒ\né™ªå®¶äºº å·¥ä½œ æœ€è¿‘åœ¨å­¦ä¹ çš„å†…å®¹æ¸…å•ï¼š\nEffective Javaï¼ˆç¬¬ 3 ç‰ˆï¼‰ Java Design Patterns (ä¸­æ–‡) Real Python æœ¬å‘¨å®Œæˆä¸‰ç¯‡åšå®¢ï¼š\nJava è®¾è®¡æ¨¡å¼ï¼šAmbassador Python å­¦ä¹  6ï¼šæ¨¡å—å’ŒåŒ… Python å­¦ä¹  7ï¼šè¾“å…¥å’Œè¾“å‡º æœ¬å‘¨åˆ†äº« å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€ChenSoul Shareã€Telegram é¢‘é“æˆ–è€…æˆ‘çš„ Memos ä¸­ã€‚æˆ‘å†™äº†ä¸€ä¸ª Python è„šæœ¬ä» Memos è¯»å–æœ€è¿‘ä¸€å‘¨å¸¦æœ‰ #memos æ ‡ç­¾çš„è®°å½•ï¼Œåˆ†äº«åˆ°è¿™é‡Œã€‚\nğŸ“Œ2023-06-27 #å·¥ç¨‹å¸ˆå·¥å…· æœ‰å°ä¼™ä¼´å¼€å§‹ç©è¿™ä¸ªç‰›é€¼çš„ AI PS å·¥å…·äº†å—ï¼Ÿå« DragGANï¼Œä»£ç å¼€æºäº†ï¼ŒCC-BY-NC è®¸å¯ï¼Œç®€å•æ¥è¯´å°±æ˜¯é€šè¿‡æ‹–åŠ¨ä»¥åŠç®€å•æ“ä½œçš„æ–¹å¼å¯¹å›¾ä¸­å¯¹è±¡è¿›è¡Œå§¿åŠ¿ã€å½¢çŠ¶ã€è¡¨æƒ…å’Œå¸ƒå±€å…·æœ‰çµæ´»è€Œç²¾ç¡®çš„æ§åˆ¶ï¼Œæ•ˆæœå¤ªç‰›é€¼äº†ï¼Œå¯ç©ç©çœ‹ã€‚ https://github.com/XingangPan/DragGAN #memos https://twitter.com/hitw93/status/1673700825989013504?s=12\u0026amp;t=N9Km7vJe9ghZkB_zBEJh4A\nğŸ“Œ2023-06-27 Z-Library å‘å¸ƒæ¡Œé¢å®¢æˆ·ç«¯ï¼Œæ”¯æŒ Windowsã€macOSã€Linuxï¼Œé’ˆå¯¹ä¸­å›½è¿æ¥ç¨³å®šæ€§ä¼˜åŒ– https://ift.tt/h8KyIdF #memos https://twitter.com/appinn/status/1673640410156093441?s=12\u0026amp;t=N9Km7vJe9ghZkB_zBEJh4A\nğŸ“Œ2023-06-27 èƒ½ä¸‹è½½å…¨ç½‘ï¼ˆMac/Win å‡å¯ï¼‰æ‰€æœ‰éŸ³ã€è§†é¢‘çš„æ•ˆç‡æ’ä»¶å·¥å…·ï¼Œæ˜¯æˆ‘è‡ªå·±å¤šå¹´æ¥çš„æ”¶è—ï¼Œä¹Ÿæ˜¯æˆ‘å¹³å¸¸åƒé¥­ç”¨çš„å®¶ä¼™ï¼Œã€æ­é…ä½¿ç”¨ã€‘æ•ˆæœæ›´ä½³ 1ã€æµè§ˆå™¨ä¸‹è½½æ’ä»¶å›¾ 1 https://cococut.net 2ã€ç½‘é¡µåœ¨çº¿ä¸‹è½½å›¾ 2 https://y2mate.com/en640 3ã€B ç«™è§†é¢‘åœ¨çº¿ä¸‹è½½å›¾ 3 https://xbeibeix.com/api/bilibili/ #memos https://twitter.com/mooenychu/status/1673489537472008192?s=12\u0026amp;t=N9Km7vJe9ghZkB_zBEJh4A\nğŸ“Œ2023-06-27 Mac å…¶å®è¿˜æœ‰ä¸€ä¸ªä¸‡èƒ½ä¸‹è½½å™¨å·¥å…·ï¼šDownie4ï¼Œæ¨ç‰¹è§†é¢‘ï¼Œæ²¹ç®¡è§†é¢‘ï¼ŒB ç«™è§†é¢‘ç­‰ç­‰ï¼Œåªè¦é“¾æ¥å¤åˆ¶è¿›å»å°±å¯ä»¥è‡ªåŠ¨ä¸‹è½½å†…å®¹å’Œå­—å¹•ï¼Œå¾ˆå¥½ç”¨ï¼Œæœ‰éœ€è¦çš„æœ‹å‹æ‰¾æ¥å®‰è£…ä½¿ç”¨ã€‚éè‹¹æœç”¨æˆ·å¦‚æœæœ‰è¿™æ–¹é¢çš„éœ€æ±‚ï¼Œæˆ‘å¯ä»¥æŠŠè¿™å‡ å¹´ä¸€ç›´åœ¨ç”¨èƒ½ä¸‹æ‰€æœ‰åœºæ™¯ä¸‹çš„åƒé¥­å®¶ä¼™åˆ†äº«å‡ºæ¥ï¼Œéœ€è¦çš„è¯„è®ºåŒºç•™è¨€å§ï¼Œä¸Šç­å»äº†ã€‚videodownlaod #memos https://twitter.com/mooenychu/status/1673144297389174784?s=12\u0026amp;t=N9Km7vJe9ghZkB_zBEJh4A\nğŸ“Œ2023-06-27 å‘Šè¯‰å¤§å®¶ä¸€ä¸ªå…è´¹ç”¨ MySQL äº‘æ•°æ®åº“çš„æ¸ é“ï¼š ç›´æ¥ç”¨ TiDB Cloud çš„ Serverless å®ä¾‹å½“ä½œå…è´¹äº‘æ•°æ®åº“å°±å¥½äº† æä¾› 5GiB å…è´¹å­˜å‚¨å’Œäº”åƒä¸‡è¯·æ±‚å•å…ƒ(ä¸€ç§ Serverless ç”¨é‡ç»Ÿè®¡æŒ‡æ ‡) åƒæ˜¯ä¸ªäººçš„åšå®¢ ä¾‹å¦‚ wordpress ä¸€äº›ä¸­å°å‹ä¼ä¸šç½‘ç«™çš„ CMS ç³»ç»Ÿ ä¸ªäººå°é¡¹ç›®ç”¨åº”è¯¥æ˜¯è¶³å¤Ÿäº† region è¦†ç›–ä¸œäºšå’ŒåŒ—ç¾ ç›´è¿é€Ÿåº¦ä¹Ÿè¿˜ä¸é”™ #memos https://twitter.com/changwei1006/status/1673169925710700545?s=12\u0026amp;t=N9Km7vJe9ghZkB_zBEJh4A\nä»¥ä¸Šã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/07/11/weekly_review_26/","summary":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-06-26 åˆ° 2023-07-09 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¯»ä¹¦ã€å¥èº«ã€æŠ•èµ„ã€å¸®æœ‹å‹ã€é™ªå®¶äººã€‚\nè¿™ä¸¤å‘¨ä¸»è¦æ˜¯å¿™äºå·¥ä½œï¼ŒWekatime ä¸Šç»Ÿè®¡çš„ä¸Šå‘¨æ¯å¤©å¹³å‡ç¼–ç¨‹æ—¶é—´è¾¾åˆ°äº† 6 hrs 52 minsï¼ŒåŸºæœ¬ä¸Šæ¯å¤©éƒ½æ˜¯æ—©ä¸ƒæ™šä¸ƒçš„ä¸Šç­èŠ‚å¥ã€‚äºæ˜¯ï¼Œå­¦ä¹ çš„æ—¶é—´éƒ½è¢«å·¥ä½œå ç”¨äº†ã€‚å·¥ä½œçš„å†…å®¹ä¸»è¦æ˜¯æ•´åˆå¤šä¸ªç³»ç»Ÿå®ç° sso ç™»å½•ï¼Œç”¨åˆ°çš„æŠ€æœ¯æœ‰ SpringCloudã€Spring Security Oauth2 ç­‰ç­‰ã€‚\nå¦å¤–ï¼Œæœ¬å‘¨å®Œæˆäº†ä¸ŠåŠå¹´çš„ç»©æ•ˆæ€»ç»“ï¼Œå›é¡¾äº†è¿™åŠå¹´çš„å·¥ä½œå†…å®¹ã€‚\nç»©æ•ˆæ€»ç»“ 1ã€é¡¹ç›®æ–¹é¢çš„æˆæœï¼š\naã€å®Œæˆäº†æ™ºèƒ½å®‰é˜²å¤šä¸ªé¡¹ç›®çš„è¿­ä»£å¼€å‘å’Œä¸Šçº¿ï¼ŒåŒ…æ‹¬ç”¨æˆ·åˆ‡æ¢ç§Ÿæˆ·ã€æŠ¥è¡¨å‘é€åˆ°é£ä¹¦ã€åä¸ºè½¦ç‰Œè¯†åˆ«ã€å¤œæ”¶æ¨¡å—æ‹†åˆ†ã€å·¡æ£€åœºæ™¯åŠŸèƒ½ä¼˜åŒ–ç­‰ã€‚åŒæ—¶ï¼Œä¹Ÿå®Œæˆäº†é€šçŸ¥æ¨¡å—é‡æ„ã€å¤§å±æŠ¥è¡¨æ”¯æŒå¤šç§Ÿæˆ·å’Œé—¨åº—ã€Dmallai å¯¼èˆªç­‰éœ€æ±‚çš„å¼€å‘ã€‚è¿™äº›å·¥ä½œçš„å®Œæˆï¼Œä¸ºç³»ç»Ÿçš„ç¨³å®šæ€§å’ŒåŠŸèƒ½æ‰©å±•æä¾›äº†æœ‰åŠ›çš„æ”¯æŒã€‚\nbã€å…±å‘å¸ƒäº† 32 æ¬¡ç‰ˆæœ¬ï¼Œå…¶ä¸­ 7 æ¬¡ä¸ºåŠŸèƒ½è¿­ä»£ï¼Œ25 æ¬¡ä¸º bug ä¿®å¤ã€‚å¹³å‡æ¯æœˆå®Œæˆäº† 1 æ¬¡é¡¹ç›®è¿­ä»£å’Œ 4 æ¬¡ bug ä¿®å¤ï¼Œåšåˆ°äº†åŠæ—¶å“åº”å’Œå¿«é€Ÿè§£å†³é—®é¢˜ï¼Œæå‡äº†ç”¨æˆ·çš„ä½¿ç”¨ä½“éªŒå’Œæ»¡æ„åº¦ï¼Œæé«˜äº†ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œé™ä½ç³»ç»Ÿçš„æ•…éšœç‡å’Œç”¨æˆ·çš„æŠ•è¯‰ç‡ï¼Œæ²¡æœ‰å‡ºç° P3 çº§åˆ«ä»¥ä¸Šæ•…éšœã€‚\n2ã€æŠ€æœ¯æ–¹é¢çš„æˆæœï¼š\nåˆ©ç”¨ç©ºä½™æ—¶é—´å­¦ä¹ æ–°æŠ€æœ¯å’Œæ¡†æ¶ï¼Œå¦‚ Pyhonã€Rustã€Reactï¼Œæ¯å‘¨å†™å‘¨æŠ¥å’Œå­¦ä¹ æ€»ç»“ï¼Œæ€»è®¡è¾“å‡º 66 ç¯‡æ–‡ç« ã€‚\nä¸æ–­ä¼˜åŒ–å’Œè¿­ä»£ Rose æ¡†æ¶ï¼Œå¹¶å°† Rose åˆå¹¶åˆ° Cocktail cloudï¼Œæ–¹ä¾¿ä»£ç ç®¡ç†å’Œç»´æŠ¤ã€‚åŒæ—¶ï¼ŒCocktail cloud è¿˜å¢åŠ äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œç‰¹æ€§ï¼Œå¦‚å›½é™…åŒ–ã€æ—¥å¿—æ‰“å°ã€åä¸ºäº‘æ¥å£å°è£…ç­‰ã€‚\nåˆ©ç”¨è®¾è®¡æ¨¡å¼é‡æ„é€šçŸ¥æ¨¡å—ï¼Œæå‡ä»£ç è´¨é‡ï¼ŒåŒæ—¶ç³»ç»Ÿæ‰©å±•æ€§å’Œå¹¶å‘ä¹Ÿå¾—åˆ°å¾ˆå¤§çš„æå‡ã€‚\n3ã€ä¸ªäººå‘å±•æ–¹é¢çš„æˆæœï¼š\né€šè¿‡ä¸æ–­å­¦ä¹ å’Œå®è·µï¼Œæé«˜äº†è‡ªå·±çš„æ²Ÿé€šèƒ½åŠ›å’Œæ—¶é—´ç®¡ç†çš„èƒ½åŠ›ã€‚æ¯å¤©æ—©ä¸Š 7 ç‚¹åˆ°å…¬å¸å­¦ä¹ ï¼Œæé«˜äº†ä¸ªäººå·¥ä½œæ•ˆç‡å’Œæ‰§è¡ŒåŠ›ã€‚\n4ã€å›¢é˜Ÿåˆä½œæ–¹é¢çš„æˆæœï¼š\nåŠ å¼ºäº†å’ŒåŒäº‹ä¹‹é—´çš„æ²Ÿé€šå’Œåä½œï¼ŒåŠæ—¶è®¨è®ºé¡¹ç›®éœ€æ±‚å’Œè¿›åº¦ï¼Œä¿éšœé¡¹ç›®æŒ‰æ—¶ä¸Šçº¿ã€‚\nè¯»ä¹¦ å¥èº« æˆ‘è·‘è¿‡äº†ä¸€äº›åœ°æ–¹ï¼Œå¸Œæœ›éšç€æ—¶é—´æ¨ç§»ï¼Œåœ°å›¾ç‚¹äº®çš„åœ°æ–¹è¶Šæ¥è¶Šå¤šã€‚2 å¹´é‡Œæˆ‘è·‘è¿‡ 2 ä¸ªçœä»½ 2 ä¸ªåŸå¸‚ã€‚æ›´å¤šè·‘æ­¥æ•°æ®åœ¨æˆ‘çš„ è·‘æ­¥ ä¸»é¡µã€‚\nç†è´¢ è¿™å‘¨æ€»è®¡æ”¯å‡º 1483 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š\n7 æœˆ 2 æ—¥ï¼š1276 å…ƒï¼Œå…¶ä¸­ 1000 å…ƒåŠ æ²¹\n7 æœˆ 1 æ—¥ï¼š32 å…ƒ\n6 æœˆ 30 æ—¥ï¼š35 å…ƒ\n6 æœˆ 29 æ—¥ï¼š15 å…ƒ\n6 æœˆ 28 æ—¥ï¼š41 å…ƒ","title":"å‘¨æŠ¥-26ï½œä¸ŠåŠå¹´çš„ç»©æ•ˆæ€»ç»“"},{"content":"åœ¨ Python ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ input() å‡½æ•°ä»æ ‡å‡†è¾“å…¥è¯»å–ç”¨æˆ·è¾“å…¥çš„æ•°æ®ï¼Œå¹¶ä½¿ç”¨ print() å‡½æ•°å°†æ•°æ®è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„è¾“å…¥è¾“å‡ºæ–¹æ³•ï¼š\n1ã€ä½¿ç”¨ input() å‡½æ•°è¯»å–ç”¨æˆ·è¾“å…¥\ninput() å‡½æ•°ä¼šä»æ ‡å‡†è¾“å…¥è¯»å–ç”¨æˆ·è¾“å…¥çš„æ•°æ®ï¼Œå¹¶è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å€¼ã€‚ä¾‹å¦‚ï¼š\nname = input(\u0026#34;What\u0026#39;s your name? \u0026#34;) print(\u0026#34;Hello, \u0026#34; + name + \u0026#34;!\u0026#34;) åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ input() å‡½æ•°è¯»å–ç”¨æˆ·è¾“å…¥çš„å§“åï¼Œå¹¶ä½¿ç”¨ print() å‡½æ•°è¾“å‡ºé—®å€™è¯­ã€‚\n2ã€ä½¿ç”¨ print() å‡½æ•°è¾“å‡ºå­—ç¬¦ä¸²\nprint() å‡½æ•°å¯ä»¥å°†å­—ç¬¦ä¸²è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚å¯ä»¥ä½¿ç”¨åŠ å·ï¼ˆ+ï¼‰å°†å¤šä¸ªå­—ç¬¦ä¸²è¿æ¥èµ·æ¥ï¼Œå¹¶ä½¿ç”¨é€—å·ï¼ˆ,ï¼‰å°†å¤šä¸ªå‚æ•°è¾“å‡ºåˆ°åŒä¸€è¡Œã€‚ä¾‹å¦‚ï¼š\nprint(\u0026#34;Hello, World!\u0026#34;) print(\u0026#34;The answer is\u0026#34;, 42) åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ print() å‡½æ•°è¾“å‡ºäº†ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œç¬¬äºŒä¸ªå­—ç¬¦ä¸²åŒ…å«äº†ä¸€ä¸ªæ•°å­—ã€‚\n3ã€ä½¿ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²è¾“å‡ºæ•°æ®\nå¯ä»¥ä½¿ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²å°†å˜é‡çš„å€¼æ’å…¥åˆ°å­—ç¬¦ä¸²ä¸­ã€‚å¯ä»¥ä½¿ç”¨èŠ±æ‹¬å·ï¼ˆ{}ï¼‰è¡¨ç¤ºå˜é‡çš„ä½ç½®ï¼Œå¹¶ä½¿ç”¨ format() æ–¹æ³•å°†å˜é‡çš„å€¼æ’å…¥åˆ°èŠ±æ‹¬å·ä¸­ã€‚ä¾‹å¦‚ï¼š\nname = \u0026#34;Alice\u0026#34; age = 25 print(\u0026#34;My name is {} and I\u0026#39;m {} years old.\u0026#34;.format(name, age)) åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ format() æ–¹æ³•å°†å˜é‡ name å’Œ age çš„å€¼æ’å…¥åˆ°å­—ç¬¦ä¸²ä¸­ã€‚\n4ã€ä½¿ç”¨ f-å­—ç¬¦ä¸²è¾“å‡ºæ•°æ®\nåœ¨ Python 3.6 åŠä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ f-å­—ç¬¦ä¸²æ¥æ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚f-å­—ç¬¦ä¸²æ˜¯ä¸€ç§ç‰¹æ®Šçš„å­—ç¬¦ä¸²ï¼Œä»¥å­—æ¯ f æˆ– F å¼€å¤´ï¼Œå¹¶ä»¥èŠ±æ‹¬å·è¡¨ç¤ºå˜é‡çš„ä½ç½®ã€‚åœ¨èŠ±æ‹¬å·ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨å˜é‡åï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼è®¡ç®—å˜é‡çš„å€¼ã€‚ä¾‹å¦‚ï¼š\nname = \u0026#34;Bob\u0026#34; age = 32 print(f\u0026#34;My name is {name.upper()} and I\u0026#39;m {age * 2} years old.\u0026#34;) åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ f-å­—ç¬¦ä¸²å°†å˜é‡ name çš„å€¼è½¬æ¢ä¸ºå¤§å†™å­—æ¯ï¼Œå¹¶å°†å˜é‡ age çš„å€¼ä¹˜ä»¥ 2ã€‚\n5ã€ä½¿ç”¨æ–‡ä»¶è¯»å†™æ•°æ®\nPython æä¾›äº†å¤šç§æ–¹å¼è¯»å†™æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ open() å‡½æ•°æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ read()ã€write() å’Œ close() æ–¹æ³•è¯»å†™æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼š\nlivecodeserver\n# è¯»å–æ–‡ä»¶ with open(\u0026#34;input.txt\u0026#34;, \u0026#34;r\u0026#34;) as f: data = f.read() print(data) # å†™å…¥æ–‡ä»¶ with open(\u0026#34;output.txt\u0026#34;, \u0026#34;w\u0026#34;) as f: f.write(\u0026#34;Hello, World!\u0026#34;) åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ with è¯­å¥æ‰“å¼€æ–‡ä»¶å¹¶è¯»å–æˆ–å†™å…¥æ•°æ®ã€‚ä½¿ç”¨ \u0026ldquo;r\u0026rdquo; å‚æ•°è¡¨ç¤ºè¯»å–æ–‡ä»¶ï¼Œä½¿ç”¨ \u0026ldquo;w\u0026rdquo; å‚æ•°è¡¨ç¤ºå†™å…¥æ–‡ä»¶ã€‚ä½¿ç”¨ read() æ–¹æ³•è¯»å–æ–‡ä»¶å†…å®¹ï¼Œä½¿ç”¨ write() æ–¹æ³•å†™å…¥æ–‡ä»¶å†…å®¹ã€‚\n6ã€ä½¿ç”¨æ ‡å‡†é”™è¯¯è¾“å‡ºé”™è¯¯ä¿¡æ¯\né™¤äº†ä½¿ç”¨ print() å‡½æ•°è¾“å‡ºå­—ç¬¦ä¸²åˆ°æ ‡å‡†è¾“å‡ºå¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨æ ‡å‡†é”™è¯¯å°†é”™è¯¯ä¿¡æ¯è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚å¯ä»¥ä½¿ç”¨ sys æ¨¡å—ä¸­çš„ stderr å±æ€§æ¥è¾“å‡ºé”™è¯¯ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š\nimport sys try: x = int(input(\u0026#34;Enter a number: \u0026#34;)) print(10 / x) except ValueError: print(\u0026#34;Invalid input.\u0026#34;, file=sys.stderr) except ZeroDivisionError: print(\u0026#34;Cannot divide by zero.\u0026#34;, file=sys.stderr) åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ try-except è¯­å¥å¤„ç†è¾“å…¥é”™è¯¯å’Œé™¤ä»¥é›¶é”™è¯¯ï¼Œå¹¶ä½¿ç”¨ print() å‡½æ•°å°†é”™è¯¯ä¿¡æ¯è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯ã€‚\n7ã€ä½¿ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„é«˜çº§ç‰¹æ€§\né™¤äº†ç®€å•çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„é«˜çº§ç‰¹æ€§æ¥æ ¼å¼åŒ–è¾“å‡ºã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ {name:width} æ ¼å¼æ¥æŒ‡å®šå­—ç¬¦ä¸²çš„å®½åº¦ï¼Œä½¿ç”¨ {name:.2f} æ ¼å¼æ¥æŒ‡å®šæµ®ç‚¹æ•°çš„å°æ•°ä½æ•°ã€‚ä¾‹å¦‚ï¼š\nname = \u0026#34;Alice\u0026#34; age = 25 score = 85.1234 print(f\u0026#34;{\u0026#39;Name:\u0026#39;:\u0026lt;10}{name:\u0026gt;10}\u0026#34;) print(f\u0026#34;{\u0026#39;Age:\u0026#39;:\u0026lt;10}{age:\u0026gt;10}\u0026#34;) print(f\u0026#34;{\u0026#39;Score:\u0026#39;:\u0026lt;10}{score:\u0026gt;10.2f}\u0026#34;) åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ f-å­—ç¬¦ä¸²å’Œ {} æ ¼å¼æŒ‡å®šå­—ç¬¦ä¸²çš„å®½åº¦å’Œå¯¹é½æ–¹å¼ï¼Œå¹¶ä½¿ç”¨ {:.2f} æ ¼å¼æŒ‡å®šæµ®ç‚¹æ•°çš„å°æ•°ä½æ•°ã€‚\n8ã€ä½¿ç”¨ pprint æ¨¡å—ç¾åŒ–è¾“å‡º\npprint æ¨¡å—å¯ä»¥ç¾åŒ– Python æ•°æ®ç»“æ„çš„è¾“å‡ºï¼Œä»¥ä¾¿æ›´å¥½åœ°æŸ¥çœ‹å’Œè°ƒè¯•æ•°æ®ã€‚å¯ä»¥ä½¿ç”¨ pprint æ¨¡å—ä¸­çš„ pprint() å‡½æ•°å°†æ•°æ®ç»“æ„è¾“å‡ºä¸ºç¾åŒ–çš„æ ¼å¼ã€‚ä¾‹å¦‚ï¼š\nimport pprint data = {\u0026#34;name\u0026#34;: \u0026#34;Alice\u0026#34;, \u0026#34;age\u0026#34;: 25, \u0026#34;scores\u0026#34;: [80, 85, 90]} pprint.pprint(data) åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ pprint.pprint() å‡½æ•°å°†æ•°æ®ç»“æ„ data è¾“å‡ºä¸ºç¾åŒ–çš„æ ¼å¼ã€‚\n9ã€ä½¿ç”¨ logging æ¨¡å—è¾“å‡ºæ—¥å¿—ä¿¡æ¯\nlogging æ¨¡å—å¯ä»¥ç”¨äºè¾“å‡ºæ—¥å¿—ä¿¡æ¯ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç†è§£ç¨‹åºçš„è¿è¡ŒçŠ¶æ€å’Œé”™è¯¯ä¿¡æ¯ã€‚å¯ä»¥ä½¿ç”¨ logging æ¨¡å—ä¸­çš„ getLogger() æ–¹æ³•åˆ›å»º Logger å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨è¯¥å¯¹è±¡çš„ä¸åŒæ–¹æ³•è¾“å‡ºä¸åŒçº§åˆ«çš„æ—¥å¿—ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š\nimport logging logging.basicConfig(level=logging.DEBUG, format=\u0026#39;%(asctime)s %(levelname)s %(message)s\u0026#39;) logger = logging.getLogger(__name__) def divide(x, y): logger.info(f\u0026#34;Dividing {x} by {y}\u0026#34;) try: result = x / y except ZeroDivisionError: logger.error(\u0026#34;Division by zero!\u0026#34;) return None else: logger.info(f\u0026#34;Result is {result}\u0026#34;) return result åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ logging.basicConfig() æ–¹æ³•é…ç½®æ—¥å¿—çº§åˆ«å’Œæ ¼å¼ï¼Œä½¿ç”¨ getLogger() æ–¹æ³•åˆ›å»º Logger å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨ info()ã€error() ç­‰æ–¹æ³•è¾“å‡ºä¸åŒçº§åˆ«çš„æ—¥å¿—ä¿¡æ¯ã€‚\n10ã€ä½¿ç”¨ traceback æ¨¡å—è¾“å‡ºå¼‚å¸¸ä¿¡æ¯\ntraceback æ¨¡å—å¯ä»¥ç”¨äºè¾“å‡ºå¼‚å¸¸ä¿¡æ¯ï¼Œä»¥ä¾¿æ›´å¥½åœ°å®šä½å’Œè§£å†³ç¨‹åºé”™è¯¯ã€‚å¯ä»¥ä½¿ç”¨ traceback æ¨¡å—ä¸­çš„ print_exc() å‡½æ•°è¾“å‡ºå¼‚å¸¸ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š\nimport traceback try: x = int(input(\u0026#34;Enter a number: \u0026#34;)) print(10 / x) except: traceback.print_exc() åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ try-except è¯­å¥æ•è·æ‰€æœ‰å¼‚å¸¸ï¼Œå¹¶ä½¿ç”¨ traceback.print_exc() å‡½æ•°è¾“å‡ºå¼‚å¸¸ä¿¡æ¯ã€‚\n11ã€ä½¿ç”¨ cProfile æ¨¡å—åˆ†æç¨‹åºæ€§èƒ½\ncProfile æ¨¡å—å¯ä»¥ç”¨äºåˆ†æç¨‹åºçš„æ€§èƒ½ï¼Œä»¥ä¾¿æ›´å¥½åœ°ä¼˜åŒ–ç¨‹åºè¿è¡Œæ•ˆç‡ã€‚å¯ä»¥ä½¿ç”¨ cProfile æ¨¡å—ä¸­çš„ run() æ–¹æ³•åˆ†æç¨‹åºæ€§èƒ½ã€‚ä¾‹å¦‚ï¼š\nimport cProfile # å®šä¹‰ç¨‹åº def func(): for i in range(10000): for j in range(10000): k = i * j # åˆ†æç¨‹åºæ€§èƒ½ cProfile.run(\u0026#39;func()\u0026#39;) åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå®šä¹‰ä¸€ä¸ªç¨‹åº func() è¿›è¡Œè®¡ç®—ï¼Œä½¿ç”¨ cProfile.run() æ–¹æ³•åˆ†æç¨‹åºæ€§èƒ½ã€‚\n12ã€ä½¿ç”¨ argparse æ¨¡å—è§£æå‘½ä»¤è¡Œå‚æ•°\nargparse æ¨¡å—å¯ä»¥ç”¨äºè§£æå‘½ä»¤è¡Œå‚æ•°ï¼Œä»¥ä¾¿æ›´å¥½åœ°æ§åˆ¶ç¨‹åºçš„è¡Œä¸ºå’Œè¾“å…¥è¾“å‡ºã€‚å¯ä»¥ä½¿ç”¨ argparse æ¨¡å—ä¸­çš„ ArgumentParser ç±»åˆ›å»ºè§£æå™¨å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨è¯¥å¯¹è±¡çš„ add_argument() æ–¹æ³•æ·»åŠ å‘½ä»¤è¡Œå‚æ•°ã€‚ä¾‹å¦‚ï¼š\nimport argparse parser = argparse.ArgumentParser(description=\u0026#39;Process some integers.\u0026#39;) parser.add_argument(\u0026#39;integers\u0026#39;, metavar=\u0026#39;N\u0026#39;, type=int, nargs=\u0026#39;+\u0026#39;, help=\u0026#39;an integer for the accumulator\u0026#39;) parser.add_argument(\u0026#39;--sum\u0026#39;, dest=\u0026#39;accumulate\u0026#39;, action=\u0026#39;store_const\u0026#39;, const=sum, default=max, help=\u0026#39;sum the integers (default: find the max)\u0026#39;) args = parser.parse_args() print(args.accumulate(args.integers)) åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ ArgumentParser ç±»åˆ›å»ºè§£æå™¨å¯¹è±¡ï¼Œä½¿ç”¨ add_argument() æ–¹æ³•æ·»åŠ å‘½ä»¤è¡Œå‚æ•°ï¼Œä½¿ç”¨ parse_args() æ–¹æ³•è§£æå‘½ä»¤è¡Œå‚æ•°ï¼Œå¹¶ä½¿ç”¨ argparse.Namespace å¯¹è±¡è®¿é—®è§£æç»“æœã€‚\n13ã€ä½¿ç”¨ pprint æ¨¡å—è¾“å‡ºå¯¹è±¡ä¿¡æ¯\npprint æ¨¡å—å¯ä»¥ç”¨äºè¾“å‡º Python å¯¹è±¡çš„ä¿¡æ¯ï¼Œä»¥ä¾¿æ›´å¥½åœ°æŸ¥çœ‹å’Œè°ƒè¯•å¯¹è±¡ã€‚å¯ä»¥ä½¿ç”¨ pprint æ¨¡å—ä¸­çš„ pprint() å‡½æ•°å°†å¯¹è±¡è¾“å‡ºä¸ºç¾åŒ–çš„æ ¼å¼ã€‚ä¾‹å¦‚ï¼š\nimport pprint class Person: def __init__(self, name, age): self.name = name self.age = age def __repr__(self): return f\u0026#34;Person(name=\u0026#39;{self.name}\u0026#39;, age={self.age})\u0026#34; person = Person(\u0026#34;Alice\u0026#34;, 25) pprint.pprint(person) åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ pprint.pprint() å‡½æ•°å°†å¯¹è±¡ person è¾“å‡ºä¸ºç¾åŒ–çš„æ ¼å¼ï¼Œä½¿ç”¨ repr() æ–¹æ³•å®šä¹‰å¯¹è±¡çš„è¡¨ç¤ºå½¢å¼ã€‚\n14ã€ä½¿ç”¨ csv æ¨¡å—è¯»å†™ CSV æ–‡ä»¶\ncsv æ¨¡å—å¯ä»¥ç”¨äºè¯»å†™ CSV æ–‡ä»¶ï¼Œä»¥ä¾¿æ›´å¥½åœ°å¤„ç†è¡¨æ ¼æ•°æ®ã€‚å¯ä»¥ä½¿ç”¨ csv æ¨¡å—ä¸­çš„ reader() å’Œ writer() å‡½æ•°è¯»å†™ CSV æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼š\nimport csv # è¯»å– CSV æ–‡ä»¶ with open(\u0026#34;data.csv\u0026#34;, \u0026#34;r\u0026#34;) as f: reader = csv.reader(f) for row in reader: print(row) # å†™å…¥ CSV æ–‡ä»¶ with open(\u0026#34;data.csv\u0026#34;, \u0026#34;w\u0026#34;, newline=\u0026#34;\u0026#34;) as f: writer = csv.writer(f) writer.writerow([\u0026#34;Name\u0026#34;, \u0026#34;Age\u0026#34;, \u0026#34;Score\u0026#34;]) writer.writerow([\u0026#34;Alice\u0026#34;, 25, 85]) writer.writerow([\u0026#34;Bob\u0026#34;, 32, 90]) åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ csv.reader() å‡½æ•°è¯»å– CSV æ–‡ä»¶ï¼Œä½¿ç”¨ csv.writer() å‡½æ•°å†™å…¥ CSV æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ newline=\u0026quot;\u0026quot; å‚æ•°æŒ‡å®šè¡Œç»“æŸç¬¦ã€‚\n15ã€ä½¿ç”¨ json æ¨¡å—è¯»å†™ JSON æ•°æ®\njson æ¨¡å—å¯ä»¥ç”¨äºè¯»å†™ JSON æ•°æ®ï¼Œä»¥ä¾¿æ›´å¥½åœ°å¤„ç†æ•°æ®äº¤æ¢å’Œå­˜å‚¨ã€‚å¯ä»¥ä½¿ç”¨ json æ¨¡å—ä¸­çš„ loads() å’Œ dumps() å‡½æ•°è¯»å†™ JSON æ•°æ®ã€‚ä¾‹å¦‚ï¼š\nimport json # è¯»å– JSON æ•°æ® data = \u0026#39;{\u0026#34;name\u0026#34;: \u0026#34;Alice\u0026#34;, \u0026#34;age\u0026#34;: 25, \u0026#34;scores\u0026#34;: [80, 85, 90]}\u0026#39; json_data = json.loads(data) print(json_data) # å†™å…¥ JSON æ•°æ® data = {\u0026#34;name\u0026#34;: \u0026#34;Bob\u0026#34;, \u0026#34;age\u0026#34;: 32, \u0026#34;scores\u0026#34;: [90, 95, 100]} json_data = json.dumps(data) print(json_data) åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ json.loads() å‡½æ•°è¯»å– JSON æ•°æ®ï¼Œä½¿ç”¨ json.dumps() å‡½æ•°å†™å…¥ JSON æ•°æ®ã€‚\n16ã€ä½¿ç”¨ xml.etree.ElementTree æ¨¡å—è¯»å†™ XML æ•°æ®\nxml.etree.ElementTree æ¨¡å—å¯ä»¥ç”¨äºè¯»å†™ XML æ•°æ®ï¼Œä»¥ä¾¿æ›´å¥½åœ°å¤„ç†æ•°æ®äº¤æ¢å’Œå­˜å‚¨ã€‚å¯ä»¥ä½¿ç”¨ xml.etree.ElementTree æ¨¡å—ä¸­çš„ ElementTree ç±»å’Œ Element ç±»è¯»å†™ XML æ•°æ®ã€‚ä¾‹å¦‚ï¼š\nimport xml.etree.ElementTree as ET # è¯»å– XML æ•°æ® tree = ET.parse(\u0026#34;data.xml\u0026#34;) root = tree.getroot() for child in root: print(child.tag, child.attrib) # å†™å…¥ XML æ•°æ® root = ET.Element(\u0026#34;data\u0026#34;) child1 = ET.SubElement(root, \u0026#34;name\u0026#34;) child1.text = \u0026#34;Alice\u0026#34; child2 = ET.SubElement(root, \u0026#34;age\u0026#34;) child2.text = \u0026#34;25\u0026#34; tree = ET.ElementTree(root) tree.write(\u0026#34;data.xml\u0026#34;) åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ ET.parse() æ–¹æ³•è¯»å– XML æ–‡ä»¶ï¼Œä½¿ç”¨ Element å¯¹è±¡å’Œ SubElement() æ–¹æ³•åˆ›å»º XML å…ƒç´ ï¼Œä½¿ç”¨ ElementTree å¯¹è±¡å’Œ write() æ–¹æ³•å†™å…¥ XML æ–‡ä»¶ã€‚\n17ã€ä½¿ç”¨ sqlite3 æ¨¡å—è¯»å†™ SQLite æ•°æ®åº“\nsqlite3 æ¨¡å—å¯ä»¥ç”¨äºè¯»å†™ SQLite æ•°æ®åº“ï¼Œä»¥ä¾¿æ›´å¥½åœ°æŒä¹…åŒ–æ•°æ®ã€‚å¯ä»¥ä½¿ç”¨ sqlite3 æ¨¡å—ä¸­çš„ connect() å’Œ cursor() æ–¹æ³•è¿æ¥æ•°æ®åº“å’Œæ‰§è¡Œ SQL è¯­å¥ã€‚ä¾‹å¦‚ï¼š\nimport sqlite3 # è¿æ¥æ•°æ®åº“ conn = sqlite3.connect(\u0026#34;data.db\u0026#34;) # åˆ›å»ºè¡¨æ ¼ c = conn.cursor() c.execute(\u0026#39;\u0026#39;\u0026#39;CREATE TABLE IF NOT EXISTS students (id INTEGER PRIMARY KEY, name TEXT, age INTEGER, score REAL)\u0026#39;\u0026#39;\u0026#39;) # æ’å…¥æ•°æ® c.execute(\u0026#34;INSERT INTO students (name, age, score) VALUES (?, ?, ?)\u0026#34;, (\u0026#34;Alice\u0026#34;, 25, 85)) c.execute(\u0026#34;INSERT INTO students (name, age, score) VALUES (?, ?, ?)\u0026#34;, (\u0026#34;Bob\u0026#34;, 32, 90)) # æŸ¥è¯¢æ•°æ® c.execute(\u0026#34;SELECT * FROM students\u0026#34;) rows = c.fetchall() for row in rows: print(row) # å…³é—­æ•°æ®åº“ conn.commit() conn.close() åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ sqlite3.connect() æ–¹æ³•è¿æ¥æ•°æ®åº“ï¼Œä½¿ç”¨ cursor() æ–¹æ³•æ‰§è¡Œ SQL è¯­å¥ï¼Œä½¿ç”¨ fetchall() æ–¹æ³•è·å–æŸ¥è¯¢ç»“æœï¼Œä½¿ç”¨ commit() æ–¹æ³•æäº¤äº‹åŠ¡å¹¶å…³é—­æ•°æ®åº“ã€‚\n18ã€ä½¿ç”¨ Pillow æ¨¡å—è¯»å†™å›¾ç‰‡æ–‡ä»¶\nPillow æ¨¡å—å¯ä»¥ç”¨äºè¯»å†™å›¾ç‰‡æ–‡ä»¶ï¼Œä»¥ä¾¿æ›´å¥½åœ°å¤„ç†å›¾åƒæ•°æ®ã€‚å¯ä»¥ä½¿ç”¨ Pillow æ¨¡å—ä¸­çš„ Image ç±»è¯»å†™å›¾ç‰‡æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼š\nfrom PIL import Image # è¯»å–å›¾ç‰‡æ–‡ä»¶ im = Image.open(\u0026#34;image.jpg\u0026#34;) print(im.format, im.size, im.mode) # æ˜¾ç¤ºå›¾ç‰‡ im.show() # ä¿å­˜å›¾ç‰‡æ–‡ä»¶ im.save(\u0026#34;image.png\u0026#34;) åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ Image.open() æ–¹æ³•è¯»å–å›¾ç‰‡æ–‡ä»¶ï¼Œä½¿ç”¨ formatã€size å’Œ mode å±æ€§è·å–å›¾ç‰‡ä¿¡æ¯ï¼Œä½¿ç”¨ show() æ–¹æ³•æ˜¾ç¤ºå›¾ç‰‡ï¼Œä½¿ç”¨ save() æ–¹æ³•ä¿å­˜å›¾ç‰‡æ–‡ä»¶ã€‚\n19ã€ä½¿ç”¨ matplotlib æ¨¡å—ç»˜åˆ¶å›¾è¡¨\nmatplotlib æ¨¡å—å¯ä»¥ç”¨äºç»˜åˆ¶å„ç§ç±»å‹çš„å›¾è¡¨ï¼Œä»¥ä¾¿æ›´å¥½åœ°å±•ç¤ºæ•°æ®åˆ†å¸ƒå’Œè¶‹åŠ¿ã€‚å¯ä»¥ä½¿ç”¨ matplotlib æ¨¡å—ä¸­çš„ pyplot æ¨¡å—ç»˜åˆ¶å›¾è¡¨ã€‚ä¾‹å¦‚ï¼š\nimport matplotlib.pyplot as plt # ç»˜åˆ¶æŠ˜çº¿å›¾ x = [1, 2, 3, 4, 5] y = [1, 4, 9, 16, 25] plt.plot(x, y) plt.xlabel(\u0026#34;X Label\u0026#34;) plt.ylabel(\u0026#34;Y Label\u0026#34;) plt.title(\u0026#34;Line Chart\u0026#34;) plt.show() # ç»˜åˆ¶æŸ±çŠ¶å›¾ x = [\u0026#34;Apple\u0026#34;, \u0026#34;Banana\u0026#34;, \u0026#34;Orange\u0026#34;] y = [50, 30, 70] plt.bar(x, y) plt.xlabel(\u0026#34;Fruit\u0026#34;) plt.ylabel(\u0026#34;Quantity\u0026#34;) plt.title(\u0026#34;Bar Chart\u0026#34;) plt.show() åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ plt.plot() æ–¹æ³•ç»˜åˆ¶æŠ˜çº¿å›¾ï¼Œä½¿ç”¨ plt.bar() æ–¹æ³•ç»˜åˆ¶æŸ±çŠ¶å›¾ï¼Œä½¿ç”¨ xlabelã€ylabel å’Œ title æ–¹æ³•è®¾ç½®å›¾è¡¨æ ‡ç­¾ï¼Œä½¿ç”¨ show() æ–¹æ³•æ˜¾ç¤ºå›¾è¡¨ã€‚\n20ã€ä½¿ç”¨ Pygame æ¨¡å—ç»˜åˆ¶æ¸¸æˆç•Œé¢\nPygame æ¨¡å—å¯ä»¥ç”¨äºç»˜åˆ¶æ¸¸æˆç•Œé¢ï¼Œä»¥ä¾¿æ›´å¥½åœ°å®ç°æ¸¸æˆåŠŸèƒ½ã€‚å¯ä»¥ä½¿ç”¨ Pygame æ¨¡å—ä¸­çš„å„ç§ç±»å’Œæ–¹æ³•ç»˜åˆ¶æ¸¸æˆç•Œé¢å’Œå¤„ç†æ¸¸æˆäº‹ä»¶ã€‚ä¾‹å¦‚ï¼š\nimport pygame # åˆå§‹åŒ– Pygame pygame.init() # åˆ›å»ºæ¸¸æˆçª—å£ screen = pygame.display.set_mode((400, 300)) pygame.display.set_caption(\u0026#34;My Game\u0026#34;) # åˆ›å»ºæ¸¸æˆå¾ªç¯ running = True while running: # å¤„ç†æ¸¸æˆäº‹ä»¶ for event in pygame.event.get(): if event.type == pygame.QUIT: running = False # ç»˜åˆ¶æ¸¸æˆç•Œé¢ screen.fill((255, 255, 255)) pygame.draw.circle(screen, (255, 0, 0), (200, 150), 50) pygame.display.update() # é€€å‡º Pygame pygame.quit() åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ pygame.init() åˆå§‹åŒ– Pygameï¼Œä½¿ç”¨ pygame.display.set_mode() åˆ›å»ºæ¸¸æˆçª—å£ï¼Œä½¿ç”¨ pygame.event.get() å¤„ç†æ¸¸æˆäº‹ä»¶ï¼Œä½¿ç”¨ pygame.draw.circle() ç»˜åˆ¶æ¸¸æˆç•Œé¢ï¼Œä½¿ç”¨ pygame.display.update() æ›´æ–°æ¸¸æˆç•Œé¢ï¼Œä½¿ç”¨ pygame.quit() é€€å‡º Pygameã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/07/08/python-input-and-output/","summary":"åœ¨ Python ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ input() å‡½æ•°ä»æ ‡å‡†è¾“å…¥è¯»å–ç”¨æˆ·è¾“å…¥çš„æ•°æ®ï¼Œå¹¶ä½¿ç”¨ print() å‡½æ•°å°†æ•°æ®è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„è¾“å…¥è¾“å‡ºæ–¹æ³•ï¼š\n1ã€ä½¿ç”¨ input() å‡½æ•°è¯»å–ç”¨æˆ·è¾“å…¥\ninput() å‡½æ•°ä¼šä»æ ‡å‡†è¾“å…¥è¯»å–ç”¨æˆ·è¾“å…¥çš„æ•°æ®ï¼Œå¹¶è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å€¼ã€‚ä¾‹å¦‚ï¼š\nname = input(\u0026#34;What\u0026#39;s your name? \u0026#34;) print(\u0026#34;Hello, \u0026#34; + name + \u0026#34;!\u0026#34;) åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ input() å‡½æ•°è¯»å–ç”¨æˆ·è¾“å…¥çš„å§“åï¼Œå¹¶ä½¿ç”¨ print() å‡½æ•°è¾“å‡ºé—®å€™è¯­ã€‚\n2ã€ä½¿ç”¨ print() å‡½æ•°è¾“å‡ºå­—ç¬¦ä¸²\nprint() å‡½æ•°å¯ä»¥å°†å­—ç¬¦ä¸²è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚å¯ä»¥ä½¿ç”¨åŠ å·ï¼ˆ+ï¼‰å°†å¤šä¸ªå­—ç¬¦ä¸²è¿æ¥èµ·æ¥ï¼Œå¹¶ä½¿ç”¨é€—å·ï¼ˆ,ï¼‰å°†å¤šä¸ªå‚æ•°è¾“å‡ºåˆ°åŒä¸€è¡Œã€‚ä¾‹å¦‚ï¼š\nprint(\u0026#34;Hello, World!\u0026#34;) print(\u0026#34;The answer is\u0026#34;, 42) åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ print() å‡½æ•°è¾“å‡ºäº†ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œç¬¬äºŒä¸ªå­—ç¬¦ä¸²åŒ…å«äº†ä¸€ä¸ªæ•°å­—ã€‚\n3ã€ä½¿ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²è¾“å‡ºæ•°æ®\nå¯ä»¥ä½¿ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²å°†å˜é‡çš„å€¼æ’å…¥åˆ°å­—ç¬¦ä¸²ä¸­ã€‚å¯ä»¥ä½¿ç”¨èŠ±æ‹¬å·ï¼ˆ{}ï¼‰è¡¨ç¤ºå˜é‡çš„ä½ç½®ï¼Œå¹¶ä½¿ç”¨ format() æ–¹æ³•å°†å˜é‡çš„å€¼æ’å…¥åˆ°èŠ±æ‹¬å·ä¸­ã€‚ä¾‹å¦‚ï¼š\nname = \u0026#34;Alice\u0026#34; age = 25 print(\u0026#34;My name is {} and I\u0026#39;m {} years old.\u0026#34;.format(name, age)) åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ format() æ–¹æ³•å°†å˜é‡ name å’Œ age çš„å€¼æ’å…¥åˆ°å­—ç¬¦ä¸²ä¸­ã€‚\n4ã€ä½¿ç”¨ f-å­—ç¬¦ä¸²è¾“å‡ºæ•°æ®\nåœ¨ Python 3.6 åŠä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ f-å­—ç¬¦ä¸²æ¥æ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚f-å­—ç¬¦ä¸²æ˜¯ä¸€ç§ç‰¹æ®Šçš„å­—ç¬¦ä¸²ï¼Œä»¥å­—æ¯ f æˆ– F å¼€å¤´ï¼Œå¹¶ä»¥èŠ±æ‹¬å·è¡¨ç¤ºå˜é‡çš„ä½ç½®ã€‚åœ¨èŠ±æ‹¬å·ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨å˜é‡åï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼è®¡ç®—å˜é‡çš„å€¼ã€‚ä¾‹å¦‚ï¼š\nname = \u0026#34;Bob\u0026#34; age = 32 print(f\u0026#34;My name is {name.upper()} and I\u0026#39;m {age * 2} years old.\u0026#34;) åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ f-å­—ç¬¦ä¸²å°†å˜é‡ name çš„å€¼è½¬æ¢ä¸ºå¤§å†™å­—æ¯ï¼Œå¹¶å°†å˜é‡ age çš„å€¼ä¹˜ä»¥ 2ã€‚","title":"Pythonå­¦ä¹ 7ï¼šè¾“å…¥å’Œè¾“å‡º"},{"content":"åœ¨ Python ä¸­ï¼Œæ¨¡å—ï¼ˆmoduleï¼‰æ˜¯æŒ‡ä¸€ä¸ªåŒ…å« Python ä»£ç çš„æ–‡ä»¶ï¼Œè€ŒåŒ…ï¼ˆpackageï¼‰åˆ™æ˜¯æŒ‡ä¸€ä¸ªåŒ…å«å¤šä¸ªæ¨¡å—çš„æ–‡ä»¶å¤¹ã€‚æ¨¡å—å’ŒåŒ…å¯ä»¥ç”¨æ¥ç»„ç»‡å’Œç®¡ç† Python ä»£ç ï¼Œä½¿å¾—ä»£ç æ›´åŠ æ˜“äºç»´æŠ¤å’Œæ‰©å±•ã€‚\nä»¥ä¸‹æ˜¯ä¸€äº›æœ‰å…³ Python æ¨¡å—å’ŒåŒ…çš„åŸºæœ¬çŸ¥è¯†ï¼š\n1ã€å¯¼å…¥æ¨¡å—\nä½¿ç”¨ import è¯­å¥å¯ä»¥å¯¼å…¥ä¸€ä¸ªæ¨¡å—ï¼ˆæˆ–åŒ…ï¼‰ä¸­çš„ä»£ç ã€‚ä¾‹å¦‚ï¼Œè¦å¯¼å…¥åä¸º \u0026ldquo;math\u0026rdquo; çš„æ¨¡å—ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­å¥ï¼š\nimport math è¿™ä¼šå°† math æ¨¡å—ä¸­çš„æ‰€æœ‰å‡½æ•°å’Œå˜é‡å¯¼å…¥åˆ°å½“å‰ Python è„šæœ¬ä¸­ï¼Œæ‚¨å°±å¯ä»¥åœ¨è„šæœ¬ä¸­ä½¿ç”¨ math æ¨¡å—ä¸­çš„å‡½æ•°å’Œå˜é‡äº†ã€‚\n2ã€å¯¼å…¥ç‰¹å®šå‡½æ•°æˆ–å˜é‡\næœ‰æ—¶å€™æ‚¨åªéœ€è¦ä½¿ç”¨æ¨¡å—ä¸­çš„æŸä¸ªå‡½æ•°æˆ–å˜é‡ï¼Œè€Œä¸éœ€è¦å¯¼å…¥æ•´ä¸ªæ¨¡å—ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ from\u0026hellip;import è¯­å¥ï¼Œä¾‹å¦‚ï¼š\nfrom math import sqrt è¿™ä¼šå°† math æ¨¡å—ä¸­çš„ sqrt å‡½æ•°å¯¼å…¥åˆ°å½“å‰ Python è„šæœ¬ä¸­ï¼Œæ‚¨å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ sqrt å‡½æ•°äº†ã€‚\n3ã€å¯¼å…¥å¤šä¸ªå‡½æ•°æˆ–å˜é‡\nå¦‚æœæ‚¨éœ€è¦å¯¼å…¥å¤šä¸ªå‡½æ•°æˆ–å˜é‡ï¼Œå¯ä»¥ä½¿ç”¨é€—å·åˆ†éš”å®ƒä»¬ï¼Œä¾‹å¦‚ï¼š\nfrom math import sqrt, floor è¿™ä¼šå°† math æ¨¡å—ä¸­çš„ sqrt å‡½æ•°å’Œ floor å‡½æ•°å¯¼å…¥åˆ°å½“å‰ Python è„šæœ¬ä¸­ï¼Œæ‚¨å°±å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸¤ä¸ªå‡½æ•°äº†ã€‚\n4ã€å¯¼å…¥æ‰€æœ‰å‡½æ•°å’Œå˜é‡\næœ‰æ—¶å€™ï¼Œæ‚¨å¯èƒ½éœ€è¦å¯¼å…¥æ¨¡å—ä¸­çš„æ‰€æœ‰å‡½æ•°å’Œå˜é‡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­å¥ï¼š\nfrom math import * è¿™ä¼šå°† math æ¨¡å—ä¸­çš„æ‰€æœ‰å‡½æ•°å’Œå˜é‡å¯¼å…¥åˆ°å½“å‰ Python è„šæœ¬ä¸­ã€‚ä½†æ˜¯ï¼Œè¿™ç§å¯¼å…¥æ–¹å¼å¯èƒ½ä¼šå¯¼è‡´å‘½åå†²çªå’Œä»£ç å¯è¯»æ€§é™ä½ï¼Œå› æ­¤æœ€å¥½åªåœ¨ä¸€äº›å°å‹ç¨‹åºä¸­ä½¿ç”¨ã€‚\n5ã€åˆ›å»ºåŒ…\nè¦åˆ›å»ºä¸€ä¸ªåŒ…ï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªåŒ…å« init.py æ–‡ä»¶çš„æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨è¯¥æ–‡ä»¶å¤¹ä¸­æ·»åŠ å…¶ä»– Python æ¨¡å—ã€‚init.py æ–‡ä»¶å¯ä»¥æ˜¯ä¸€ä¸ªç©ºæ–‡ä»¶ï¼Œæˆ–è€…åŒ…å«ä¸€äº›åˆå§‹åŒ–ä»£ç ã€‚\nä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³åˆ›å»ºä¸€ä¸ªåä¸º \u0026ldquo;my_package\u0026rdquo; çš„åŒ…ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ–¹å¼ç»„ç»‡ä»£ç ï¼š\nmy_package/ __init__.py module1.py module2.py è¿™ä¸ªåŒ…åŒ…å«äº† init.py æ–‡ä»¶å’Œä¸¤ä¸ªæ¨¡å—ï¼ˆmodule1.py å’Œ module2.pyï¼‰ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ import è¯­å¥æ¥å¯¼å…¥è¿™ä¸ªåŒ…ä¸­çš„æ¨¡å—ï¼Œä¾‹å¦‚ï¼š\nimport my_package.module1 è¿™ä¼šå°† my_package åŒ…ä¸­çš„ module1.py æ–‡ä»¶å¯¼å…¥åˆ°å½“å‰ Python è„šæœ¬ä¸­ï¼Œæ‚¨å°±å¯ä»¥ä½¿ç”¨å…¶ä¸­å®šä¹‰çš„å‡½æ•°å’Œå˜é‡äº†ã€‚\n6ã€å¯¼å…¥è‡ªå®šä¹‰æ¨¡å—\nå¦‚æœæ‚¨æƒ³å¯¼å…¥è‡ªå·±ç¼–å†™çš„æ¨¡å—ï¼Œå¯ä»¥å°†æ¨¡å—æ–‡ä»¶ä¿å­˜åœ¨æ‚¨çš„ Python è„šæœ¬æ‰€åœ¨çš„ç›®å½•ä¸­ï¼Œç„¶åä½¿ç”¨ import è¯­å¥å¯¼å…¥æ¨¡å—ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„æ¨¡å—æ–‡ä»¶åä¸º \u0026ldquo;mymodule.py\u0026rdquo;ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­å¥å¯¼å…¥æ¨¡å—ï¼š\nimport mymodule å¦‚æœæ‚¨çš„æ¨¡å—æ–‡ä»¶ä¸åœ¨ Python è„šæœ¬æ‰€åœ¨çš„ç›®å½•ä¸­ï¼Œæ‚¨éœ€è¦å°†æ¨¡å—æ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„æ·»åŠ åˆ° sys.path åˆ—è¡¨ä¸­ï¼Œä¾‹å¦‚ï¼š\nimport sys sys.path.append(\u0026#39;/path/to/mymodule/\u0026#39;) import mymodule 7ã€åŒ…çš„ç›¸å¯¹å¯¼å…¥\nåœ¨ä¸€ä¸ªåŒ…ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ç›¸å¯¹å¯¼å…¥æ¥å¯¼å…¥å…¶ä»–æ¨¡å—ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨åœ¨ my_package åŒ…ä¸­çš„ module1.py ä¸­æƒ³è¦å¯¼å…¥ my_package åŒ…ä¸­çš„ module2.pyï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­å¥ï¼š\nfrom . import module2 è¿™é‡Œçš„ \u0026ldquo;.\u0026rdquo; è¡¨ç¤ºå½“å‰åŒ…ï¼Œ\u0026quot;.\u0026quot; åé¢çš„ module2 è¡¨ç¤ºè¦å¯¼å…¥çš„æ¨¡å—ã€‚\n8ã€åŒ…çš„å‘½åç©ºé—´\nåœ¨ä¸€ä¸ªåŒ…ä¸­ï¼Œå¤šä¸ªæ¨¡å—å¯èƒ½ä¼šå®šä¹‰ç›¸åŒçš„å‡½æ•°æˆ–å˜é‡åï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´å‘½åå†²çªã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼ŒPython ä½¿ç”¨åŒ…çš„å‘½åç©ºé—´æ¥åŒºåˆ†ä¸åŒæ¨¡å—ä¸­çš„å‡½æ•°å’Œå˜é‡ã€‚å½“æ‚¨å¯¼å…¥ä¸€ä¸ªåŒ…æ—¶ï¼Œåªæœ‰åŒ…ä¸­çš„æ¨¡å—æ‰ä¼šè¢«å¯¼å…¥åˆ°å‘½åç©ºé—´ä¸­ã€‚è¿™æ„å‘³ç€æ‚¨éœ€è¦ä½¿ç”¨æ¨¡å—åç§°æ¥è®¿é—®å…¶ä¸­çš„å‡½æ•°å’Œå˜é‡ï¼Œä¾‹å¦‚ï¼š\nimport my_package.module1 my_package.module1.my_function() è¿™é‡Œçš„ my_function() æ˜¯ my_package åŒ…ä¸­çš„ module1.py æ¨¡å—ä¸­çš„ä¸€ä¸ªå‡½æ•°ã€‚\n9ã€åœ¨æ¨¡å—ä¸­å®šä¹‰å˜é‡\nåœ¨ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œæ‚¨å¯ä»¥å®šä¹‰å…¨å±€å˜é‡ï¼Œè¿™äº›å˜é‡å¯ä»¥åœ¨æ¨¡å—ä¸­çš„å…¶ä»–å‡½æ•°ä¸­ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼š\n# module1.py my_variable = 42 def my_function(): print(my_variable) åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œmy_variable æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå¯ä»¥åœ¨æ¨¡å—ä¸­çš„ä»»ä½•å‡½æ•°ä¸­ä½¿ç”¨ã€‚\n10ã€ä½¿ç”¨ name å˜é‡\nåœ¨ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ name å˜é‡æ¥åˆ¤æ–­è¯¥æ¨¡å—æ˜¯è¢«å¯¼å…¥è¿˜æ˜¯ç›´æ¥è¿è¡Œã€‚ä¾‹å¦‚ï¼š\nCopy\n# module1.py def my_function(): print(\u0026#34;Hello, world!\u0026#34;) if __name__ == \u0026#34;__main__\u0026#34;: my_function() åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¦‚æœæ‚¨ç›´æ¥è¿è¡Œ module1.pyï¼Œå°†ä¼šæ‰§è¡Œ my_function() å‡½æ•°ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨åœ¨å…¶ä»– Python è„šæœ¬ä¸­å¯¼å…¥äº† module1.pyï¼Œmy_function() å‡½æ•°ä¸ä¼šè¢«æ‰§è¡Œã€‚\n11ã€æ¨¡å—çš„æ–‡æ¡£å­—ç¬¦ä¸²\nåœ¨ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ–‡æ¡£å­—ç¬¦ä¸²æ¥æè¿°æ¨¡å—çš„åŠŸèƒ½å’Œä½¿ç”¨æ–¹æ³•ã€‚æ–‡æ¡£å­—ç¬¦ä¸²æ˜¯æ”¾ç½®åœ¨æ¨¡å—å¼€å¤´çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥é€šè¿‡æ¨¡å—çš„ doc å±æ€§è®¿é—®ã€‚ä¾‹å¦‚ï¼š\n# module1.py \u0026#34;\u0026#34;\u0026#34; è¿™æ˜¯ä¸€ä¸ªæ¼”ç¤ºæ¨¡å—çš„ç¤ºä¾‹ã€‚ è¯¥æ¨¡å—åŒ…å«äº†ä¸€ä¸ªåä¸º my_function() çš„å‡½æ•°ï¼Œå¯ä»¥è¾“å‡ºä¸€æ¡ç®€å•çš„ä¿¡æ¯ã€‚ \u0026#34;\u0026#34;\u0026#34; def my_function(): \u0026#34;\u0026#34;\u0026#34; è¯¥å‡½æ•°å¯ä»¥è¾“å‡ºä¸€æ¡ç®€å•çš„ä¿¡æ¯ã€‚ \u0026#34;\u0026#34;\u0026#34; print(\u0026#34;Hello, world!\u0026#34;) åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ¨¡å—çš„æ–‡æ¡£å­—ç¬¦ä¸²ç”¨ä¸‰é‡åŒå¼•å·æ‹¬èµ·æ¥ï¼Œå¹¶æè¿°äº†æ¨¡å—çš„åŠŸèƒ½å’Œä½¿ç”¨æ–¹æ³•ã€‚å‡½æ•° my_function() çš„æ–‡æ¡£å­—ç¬¦ä¸²ç”¨ä¸‰é‡åŒå¼•å·æ‹¬èµ·æ¥ï¼Œå¹¶æè¿°äº†è¯¥å‡½æ•°çš„åŠŸèƒ½å’Œä½¿ç”¨æ–¹æ³•ã€‚\n12ã€ä½¿ç”¨ init.py æ–‡ä»¶\nåœ¨ä¸€ä¸ªåŒ…ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ init.py æ–‡ä»¶æ¥æ‰§è¡Œåˆå§‹åŒ–ä»£ç ï¼Œä¹Ÿå¯ä»¥åœ¨å…¶ä¸­å®šä¹‰åŒ…çº§åˆ«çš„å˜é‡å’Œå‡½æ•°ã€‚ä¾‹å¦‚ï¼š\n# my_package/__init__.py print(\u0026#34;my_package å·²è¢«å¯¼å…¥\u0026#34;) my_variable = 42 def my_function(): print(\u0026#34;my_function å·²è¢«è°ƒç”¨\u0026#34;) åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå½“æ‚¨å¯¼å…¥ my_package åŒ…æ—¶ï¼Œå°†ä¼šæ‰§è¡Œ init.py æ–‡ä»¶ä¸­çš„ä»£ç ï¼Œè¾“å‡º \u0026ldquo;my_package å·²è¢«å¯¼å…¥\u0026rdquo;ã€‚æ‚¨è¿˜å¯ä»¥åœ¨ init.py æ–‡ä»¶ä¸­å®šä¹‰å…¨å±€å˜é‡å’Œå‡½æ•°ï¼Œè¿™äº›å˜é‡å’Œå‡½æ•°å¯ä»¥åœ¨åŒ…ä¸­çš„å…¶ä»–æ¨¡å—ä¸­ä½¿ç”¨ã€‚\n13ã€ä½¿ç”¨ all å˜é‡\nåœ¨ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œå¦‚æœæ‚¨æƒ³æ˜ç¡®å¯¼å‡ºå“ªäº›å‡½æ•°å’Œå˜é‡ï¼Œå¯ä»¥ä½¿ç”¨ all å˜é‡ã€‚ä¾‹å¦‚ï¼š\n# module1.py __all__ = [\u0026#34;my_function\u0026#34;] def my_function(): print(\u0026#34;my_function å·²è¢«è°ƒç”¨\u0026#34;) def my_private_function(): print(\u0026#34;my_private_function å·²è¢«è°ƒç”¨\u0026#34;) åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œall å˜é‡æŒ‡å®šäº†è¦å¯¼å‡ºçš„å‡½æ•°åç§°ï¼Œè¿™é‡Œåªå¯¼å‡ºäº† my_function()ã€‚å¦‚æœæ‚¨åœ¨å…¶ä»– Python è„šæœ¬ä¸­å¯¼å…¥äº† module1.pyï¼Œåªæœ‰ my_function() å‡½æ•°ä¼šè¢«å¯¼å…¥åˆ°å½“å‰å‘½åç©ºé—´ä¸­ã€‚\n14ã€ä½¿ç”¨ setup.py æ–‡ä»¶\nå¦‚æœæ‚¨æƒ³å°†è‡ªå·±ç¼–å†™çš„ Python æ¨¡å—æˆ–åŒ…å‘å¸ƒåˆ° PyPIï¼ˆPython Package Indexï¼‰ä¸Šï¼Œå¯ä»¥ä½¿ç”¨ setup.py æ–‡ä»¶æ¥æ„å»ºå’Œæ‰“åŒ…æ‚¨çš„ä»£ç ã€‚setup.py æ–‡ä»¶é€šå¸¸åŒ…å«ä¸€äº›å…ƒæ•°æ®ï¼ˆä¾‹å¦‚æ¨¡å—åç§°ã€ç‰ˆæœ¬å·ã€ä½œè€…ã€è®¸å¯è¯ç­‰ï¼‰å’Œæ„å»ºè„šæœ¬ï¼Œå¯ä»¥ä½¿ç”¨ setuptools æˆ– distutils æ¨¡å—æ‰§è¡Œæ„å»ºå’Œæ‰“åŒ…æ“ä½œã€‚\n15ã€å¸¸ç”¨çš„ Python æ¨¡å—å’ŒåŒ…\nPython æ ‡å‡†åº“ä¸­åŒ…å«äº†è®¸å¤šæœ‰ç”¨çš„æ¨¡å—å’ŒåŒ…ï¼Œå¯ä»¥å¸®åŠ©æ‚¨å®Œæˆå„ç§ä»»åŠ¡ï¼Œä¾‹å¦‚å¤„ç†æ–‡ä»¶ã€ç½‘ç»œç¼–ç¨‹ã€æ—¥æœŸå’Œæ—¶é—´å¤„ç†ã€æ•°å­¦è®¡ç®—ç­‰ã€‚ä¸€äº›å¸¸ç”¨çš„ Python æ¨¡å—å’ŒåŒ…åŒ…æ‹¬ï¼š\nosï¼šæä¾›äº†è®¸å¤šä¸æ“ä½œç³»ç»Ÿäº¤äº’çš„å‡½æ•°å’Œå˜é‡ã€‚ sysï¼šæä¾›äº†ä¸€äº›ä¸ Python è§£é‡Šå™¨äº¤äº’çš„å‡½æ•°å’Œå˜é‡ã€‚ datetimeï¼šæä¾›äº†æ—¥æœŸå’Œæ—¶é—´å¤„ç†åŠŸèƒ½ã€‚ mathï¼šæä¾›äº†æ•°å­¦è®¡ç®—å‡½æ•°ã€‚ randomï¼šæä¾›äº†ç”Ÿæˆéšæœºæ•°çš„å‡½æ•°ã€‚ reï¼šæä¾›äº†å¤„ç†æ­£åˆ™è¡¨è¾¾å¼çš„å‡½æ•°ã€‚ urllibã€requestsï¼šæä¾›äº†è¿›è¡Œç½‘ç»œç¼–ç¨‹çš„åŠŸèƒ½ã€‚ jsonã€pickleï¼šæä¾›äº†è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„åŠŸèƒ½ã€‚ 16ã€ä½¿ç”¨ virtualenv\nå¦‚æœæ‚¨éœ€è¦åœ¨åŒä¸€å°è®¡ç®—æœºä¸Šè¿è¡Œå¤šä¸ª Python é¡¹ç›®ï¼Œæ¯ä¸ªé¡¹ç›®å¯èƒ½éƒ½éœ€è¦ä¸åŒç‰ˆæœ¬çš„ Python å’Œå„ç§ä¾èµ–åº“ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ virtualenv æ¥åˆ›å»ºç‹¬ç«‹çš„ Python ç¯å¢ƒï¼Œæ¯ä¸ªç¯å¢ƒéƒ½å¯ä»¥å®‰è£…ä¸åŒç‰ˆæœ¬çš„ Python å’Œä¾èµ–åº“ï¼Œä»¥é¿å…ç‰ˆæœ¬å†²çªå’Œä¾èµ–å†²çªã€‚ä¾‹å¦‚ï¼š\n# åˆ›å»ºä¸€ä¸ªåä¸º myenv çš„è™šæ‹Ÿç¯å¢ƒ $ virtualenv myenv # æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ $ source myenv/bin/activate # å®‰è£…ä¾èµ–åº“ $ pip install package1 package2 # è¿è¡Œ Python è„šæœ¬ $ python myscript.py # é€€å‡ºè™šæ‹Ÿç¯å¢ƒ $ deactivate åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ virtualenv åˆ›å»ºäº†ä¸€ä¸ªåä¸º myenv çš„è™šæ‹Ÿç¯å¢ƒï¼Œå¹¶ä½¿ç”¨ pip å®‰è£…äº† package1 å’Œ package2 ä¸¤ä¸ªä¾èµ–åº“ã€‚åœ¨æ¿€æ´»è™šæ‹Ÿç¯å¢ƒåï¼Œè¿è¡Œ myscript.py è„šæœ¬æ—¶ï¼Œå°†ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒä¸­çš„ Python ç‰ˆæœ¬å’Œä¾èµ–åº“ã€‚\n17ã€ä½¿ç”¨ pipenv\npipenv æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå¯ä»¥ç®¡ç† Python é¡¹ç›®çš„ä¾èµ–å…³ç³»å’Œè™šæ‹Ÿç¯å¢ƒã€‚å®ƒä½¿ç”¨ Pipfile å’Œ Pipfile.lock æ–‡ä»¶æ¥è·Ÿè¸ªé¡¹ç›®çš„ä¾èµ–å…³ç³»ï¼Œå¹¶ä½¿ç”¨ virtualenv æ¥åˆ›å»ºå’Œç®¡ç†è™šæ‹Ÿç¯å¢ƒã€‚ä¾‹å¦‚ï¼š\n# å®‰è£… pipenv $ pip install pipenv # åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®å¹¶å®‰è£…ä¾èµ–åº“ $ mkdir myproject $ cd myproject $ pipenv install package1 package2 # è¿è¡Œ Python è„šæœ¬ $ pipenv run python myscript.py # é€€å‡ºè™šæ‹Ÿç¯å¢ƒ $ exit åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ pipenv åˆ›å»ºäº†ä¸€ä¸ªåä¸º myproject çš„æ–°é¡¹ç›®ï¼Œå¹¶ä½¿ç”¨ pipenv install å‘½ä»¤å®‰è£…äº† package1 å’Œ package2 ä¸¤ä¸ªä¾èµ–åº“ã€‚åœ¨è¿è¡Œ myscript.py è„šæœ¬æ—¶ï¼Œä½¿ç”¨ pipenv run å‘½ä»¤æ¥æ¿€æ´»è™šæ‹Ÿç¯å¢ƒå¹¶è¿è¡Œè„šæœ¬ã€‚\n18ã€ä½¿ç”¨ Anaconda\nAnaconda æ˜¯ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„ Python æ•°æ®ç§‘å­¦å¹³å°ï¼Œå®ƒåŒ…å«äº†è®¸å¤šå¸¸ç”¨çš„æ•°æ®ç§‘å­¦åº“å’Œå·¥å…·ï¼Œä¾‹å¦‚ NumPyã€SciPyã€Pandasã€Matplotlib ç­‰ã€‚Anaconda è¿˜æä¾›äº†ä¸€ä¸ªåä¸º conda çš„è™šæ‹Ÿç¯å¢ƒç®¡ç†å™¨ï¼Œå¯ä»¥è½»æ¾åœ°åˆ›å»ºå’Œç®¡ç†ç‹¬ç«‹çš„ Python ç¯å¢ƒã€‚ä¾‹å¦‚ï¼š\n# åˆ›å»ºä¸€ä¸ªåä¸º myenv çš„è™šæ‹Ÿç¯å¢ƒ $ conda create --name myenv # æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ $ conda activate myenv # å®‰è£…ä¾èµ–åº“ $ conda install package1 package2 # è¿è¡Œ Python è„šæœ¬ $ python myscript.py # é€€å‡ºè™šæ‹Ÿç¯å¢ƒ $ conda deactivate åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ conda create å‘½ä»¤åˆ›å»ºäº†ä¸€ä¸ªåä¸º myenv çš„è™šæ‹Ÿç¯å¢ƒï¼Œå¹¶ä½¿ç”¨ conda install å‘½ä»¤å®‰è£…äº† package1 å’Œ package2 ä¸¤ä¸ªä¾èµ–åº“ã€‚åœ¨æ¿€æ´»è™šæ‹Ÿç¯å¢ƒåï¼Œè¿è¡Œ myscript.py è„šæœ¬æ—¶ï¼Œå°†ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒä¸­çš„ Python ç‰ˆæœ¬å’Œä¾èµ–åº“ã€‚\n19ã€ä½¿ç”¨ pytest è¿›è¡Œå•å…ƒæµ‹è¯•\npytest æ˜¯ä¸€ä¸ªæµè¡Œçš„ Python æµ‹è¯•æ¡†æ¶ï¼Œå¯ä»¥å¸®åŠ©æ‚¨ç¼–å†™å¹¶è¿è¡Œå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ã€‚pytest è‡ªåŠ¨å‘ç°æµ‹è¯•æ–‡ä»¶å’Œæµ‹è¯•å‡½æ•°ï¼Œå¹¶æä¾›ä¸°å¯Œçš„æ–­è¨€å‡½æ•°å’Œæµ‹è¯•æŠ¥å‘Šã€‚ä¾‹å¦‚ï¼š\n# test_module.py def test_addition(): assert 1 + 1 == 2 def test_subtraction(): assert 5 - 3 == 2 åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå®šä¹‰äº†ä¸¤ä¸ªæµ‹è¯•å‡½æ•° test_addition() å’Œ test_subtraction()ï¼Œä½¿ç”¨ assert è¯­å¥è¿›è¡Œæ–­è¨€ã€‚ä½¿ç”¨ pytest è¿è¡Œæµ‹è¯•æ—¶ï¼Œpytest ä¼šè‡ªåŠ¨å‘ç°å¹¶è¿è¡Œ test_module.py æ–‡ä»¶ï¼Œè¾“å‡ºæµ‹è¯•ç»“æœå’Œæµ‹è¯•æŠ¥å‘Šã€‚\n20ã€ä½¿ç”¨ logging æ¨¡å—è¿›è¡Œæ—¥å¿—è®°å½•\nlogging æ˜¯ Python æ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œå¯ä»¥å¸®åŠ©æ‚¨è®°å½•å’Œç®¡ç†åº”ç”¨ç¨‹åºçš„æ—¥å¿—ã€‚logging æ¨¡å—æä¾›äº†å¤šä¸ªæ—¥å¿—çº§åˆ«ï¼ˆä¾‹å¦‚ DEBUGã€INFOã€WARNINGã€ERROR å’Œ CRITICALï¼‰å’Œå¤šä¸ªæ—¥å¿—å¤„ç†å™¨ï¼ˆä¾‹å¦‚æ§åˆ¶å°å¤„ç†å™¨ã€æ–‡ä»¶å¤„ç†å™¨ã€ç½‘ç»œå¤„ç†å™¨ç­‰ï¼‰ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œé…ç½®ã€‚ä¾‹å¦‚ï¼š\n# my_module.py import logging # åˆ›å»ºä¸€ä¸ªåä¸º my_logger çš„æ—¥å¿—è®°å½•å™¨ my_logger = logging.getLogger(\u0026#34;my_logger\u0026#34;) # åˆ›å»ºä¸€ä¸ªæ§åˆ¶å°å¤„ç†å™¨å’Œä¸€ä¸ªæ–‡ä»¶å¤„ç†å™¨ console_handler = logging.StreamHandler() file_handler = logging.FileHandler(\u0026#34;my_log.log\u0026#34;) # åˆ›å»ºä¸€ä¸ªæ—¥å¿—æ ¼å¼å™¨å’Œå°†å…¶æ·»åŠ åˆ°å¤„ç†å™¨ä¸­ log_formatter = logging.Formatter(\u0026#34;%(asctime)s [%(levelname)s] %(message)s\u0026#34;) console_handler.setFormatter(log_formatter) file_handler.setFormatter(log_formatter) # å°†å¤„ç†å™¨æ·»åŠ åˆ°æ—¥å¿—è®°å½•å™¨ä¸­ my_logger.addHandler(console_handler) my_logger.addHandler(file_handler) # è®¾ç½®æ—¥å¿—çº§åˆ« my_logger.setLevel(logging.DEBUG) def my_function(): my_logger.debug(\u0026#34;debug message\u0026#34;) my_logger.info(\u0026#34;info message\u0026#34;) my_logger.warning(\u0026#34;warning message\u0026#34;) my_logger.error(\u0026#34;error message\u0026#34;) my_logger.critical(\u0026#34;critical message\u0026#34;) åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ logging æ¨¡å—åˆ›å»ºäº†ä¸€ä¸ªåä¸º my_logger çš„æ—¥å¿—è®°å½•å™¨ï¼Œå¹¶åˆ›å»ºäº†ä¸€ä¸ªæ§åˆ¶å°å¤„ç†å™¨å’Œä¸€ä¸ªæ–‡ä»¶å¤„ç†å™¨ã€‚ä½¿ç”¨æ—¥å¿—æ ¼å¼å™¨å°†æ—¥å¿—æ¶ˆæ¯æ ¼å¼åŒ–åï¼Œå°†å¤„ç†å™¨æ·»åŠ åˆ°æ—¥å¿—è®°å½•å™¨ä¸­ï¼Œå¹¶è®¾ç½®æ—¥å¿—çº§åˆ«ä¸º DEBUGã€‚åœ¨ my_function() å‡½æ•°ä¸­ï¼Œä½¿ç”¨ my_logger è®°å½•äº†ä¸åŒçº§åˆ«çš„æ—¥å¿—æ¶ˆæ¯ã€‚æ—¥å¿—æ¶ˆæ¯å°†åŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°å’Œ my_log.log æ–‡ä»¶ä¸­ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/07/06/python-module-package/","summary":"åœ¨ Python ä¸­ï¼Œæ¨¡å—ï¼ˆmoduleï¼‰æ˜¯æŒ‡ä¸€ä¸ªåŒ…å« Python ä»£ç çš„æ–‡ä»¶ï¼Œè€ŒåŒ…ï¼ˆpackageï¼‰åˆ™æ˜¯æŒ‡ä¸€ä¸ªåŒ…å«å¤šä¸ªæ¨¡å—çš„æ–‡ä»¶å¤¹ã€‚æ¨¡å—å’ŒåŒ…å¯ä»¥ç”¨æ¥ç»„ç»‡å’Œç®¡ç† Python ä»£ç ï¼Œä½¿å¾—ä»£ç æ›´åŠ æ˜“äºç»´æŠ¤å’Œæ‰©å±•ã€‚\nä»¥ä¸‹æ˜¯ä¸€äº›æœ‰å…³ Python æ¨¡å—å’ŒåŒ…çš„åŸºæœ¬çŸ¥è¯†ï¼š\n1ã€å¯¼å…¥æ¨¡å—\nä½¿ç”¨ import è¯­å¥å¯ä»¥å¯¼å…¥ä¸€ä¸ªæ¨¡å—ï¼ˆæˆ–åŒ…ï¼‰ä¸­çš„ä»£ç ã€‚ä¾‹å¦‚ï¼Œè¦å¯¼å…¥åä¸º \u0026ldquo;math\u0026rdquo; çš„æ¨¡å—ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­å¥ï¼š\nimport math è¿™ä¼šå°† math æ¨¡å—ä¸­çš„æ‰€æœ‰å‡½æ•°å’Œå˜é‡å¯¼å…¥åˆ°å½“å‰ Python è„šæœ¬ä¸­ï¼Œæ‚¨å°±å¯ä»¥åœ¨è„šæœ¬ä¸­ä½¿ç”¨ math æ¨¡å—ä¸­çš„å‡½æ•°å’Œå˜é‡äº†ã€‚\n2ã€å¯¼å…¥ç‰¹å®šå‡½æ•°æˆ–å˜é‡\næœ‰æ—¶å€™æ‚¨åªéœ€è¦ä½¿ç”¨æ¨¡å—ä¸­çš„æŸä¸ªå‡½æ•°æˆ–å˜é‡ï¼Œè€Œä¸éœ€è¦å¯¼å…¥æ•´ä¸ªæ¨¡å—ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ from\u0026hellip;import è¯­å¥ï¼Œä¾‹å¦‚ï¼š\nfrom math import sqrt è¿™ä¼šå°† math æ¨¡å—ä¸­çš„ sqrt å‡½æ•°å¯¼å…¥åˆ°å½“å‰ Python è„šæœ¬ä¸­ï¼Œæ‚¨å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ sqrt å‡½æ•°äº†ã€‚\n3ã€å¯¼å…¥å¤šä¸ªå‡½æ•°æˆ–å˜é‡\nå¦‚æœæ‚¨éœ€è¦å¯¼å…¥å¤šä¸ªå‡½æ•°æˆ–å˜é‡ï¼Œå¯ä»¥ä½¿ç”¨é€—å·åˆ†éš”å®ƒä»¬ï¼Œä¾‹å¦‚ï¼š\nfrom math import sqrt, floor è¿™ä¼šå°† math æ¨¡å—ä¸­çš„ sqrt å‡½æ•°å’Œ floor å‡½æ•°å¯¼å…¥åˆ°å½“å‰ Python è„šæœ¬ä¸­ï¼Œæ‚¨å°±å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸¤ä¸ªå‡½æ•°äº†ã€‚\n4ã€å¯¼å…¥æ‰€æœ‰å‡½æ•°å’Œå˜é‡\næœ‰æ—¶å€™ï¼Œæ‚¨å¯èƒ½éœ€è¦å¯¼å…¥æ¨¡å—ä¸­çš„æ‰€æœ‰å‡½æ•°å’Œå˜é‡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­å¥ï¼š\nfrom math import * è¿™ä¼šå°† math æ¨¡å—ä¸­çš„æ‰€æœ‰å‡½æ•°å’Œå˜é‡å¯¼å…¥åˆ°å½“å‰ Python è„šæœ¬ä¸­ã€‚ä½†æ˜¯ï¼Œè¿™ç§å¯¼å…¥æ–¹å¼å¯èƒ½ä¼šå¯¼è‡´å‘½åå†²çªå’Œä»£ç å¯è¯»æ€§é™ä½ï¼Œå› æ­¤æœ€å¥½åªåœ¨ä¸€äº›å°å‹ç¨‹åºä¸­ä½¿ç”¨ã€‚\n5ã€åˆ›å»ºåŒ…\nè¦åˆ›å»ºä¸€ä¸ªåŒ…ï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªåŒ…å« init.py æ–‡ä»¶çš„æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨è¯¥æ–‡ä»¶å¤¹ä¸­æ·»åŠ å…¶ä»– Python æ¨¡å—ã€‚init.py æ–‡ä»¶å¯ä»¥æ˜¯ä¸€ä¸ªç©ºæ–‡ä»¶ï¼Œæˆ–è€…åŒ…å«ä¸€äº›åˆå§‹åŒ–ä»£ç ã€‚\nä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³åˆ›å»ºä¸€ä¸ªåä¸º \u0026ldquo;my_package\u0026rdquo; çš„åŒ…ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ–¹å¼ç»„ç»‡ä»£ç ï¼š\nmy_package/ __init__.py module1.py module2.py è¿™ä¸ªåŒ…åŒ…å«äº† init.py æ–‡ä»¶å’Œä¸¤ä¸ªæ¨¡å—ï¼ˆmodule1.py å’Œ module2.pyï¼‰ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ import è¯­å¥æ¥å¯¼å…¥è¿™ä¸ªåŒ…ä¸­çš„æ¨¡å—ï¼Œä¾‹å¦‚ï¼š\nimport my_package.module1 è¿™ä¼šå°† my_package åŒ…ä¸­çš„ module1.py æ–‡ä»¶å¯¼å…¥åˆ°å½“å‰ Python è„šæœ¬ä¸­ï¼Œæ‚¨å°±å¯ä»¥ä½¿ç”¨å…¶ä¸­å®šä¹‰çš„å‡½æ•°å’Œå˜é‡äº†ã€‚\n6ã€å¯¼å…¥è‡ªå®šä¹‰æ¨¡å—","title":"Pythonå­¦ä¹ 6ï¼šæ¨¡å—å’ŒåŒ…"},{"content":"æœ¬æ–‡ä¸»è¦ä»‹ç» Ambassador æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nJava Design Patterns æä¾›äº†å„ç§ Java è®¾è®¡æ¨¡å¼çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ã€‚è¯¥ç½‘ç«™æ—¨åœ¨å¸®åŠ© Java å¼€å‘äººå‘˜äº†è§£å’Œåº”ç”¨å„ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚\nJava Design Patterns ç½‘ç«™æä¾›äº†å¤šç§è®¾è®¡æ¨¡å¼åˆ†ç±»æ–¹å¼ï¼ŒåŒ…æ‹¬åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational Patternsï¼‰ã€ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternsï¼‰å’Œè¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰ï¼Œä»¥åŠå…¶ä»–ä¸€äº›å¸¸è§çš„æ¨¡å¼ã€‚\nå¯¹äºæ¯ä¸ªè®¾è®¡æ¨¡å¼ï¼Œè¯¥ç½‘ç«™æä¾›äº†è¯¦ç»†çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ï¼Œå¹¶ä¸”æä¾›äº†ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ã€‚å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©é€‚åˆè‡ªå·±çš„è®¾è®¡æ¨¡å¼ï¼Œå¹¶ä¸”å¯ä»¥å‚è€ƒç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜æ¥ç†è§£å’Œåº”ç”¨è¯¥æ¨¡å¼ã€‚\næ­¤å¤–ï¼ŒJava Design Patterns ç½‘ç«™è¿˜æä¾›äº†ä¸€äº›å…¶ä»–èµ„æºï¼Œå¦‚è®¾è®¡æ¨¡å¼çš„ UML å›¾ã€è®¾è®¡æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ã€è®¾è®¡æ¨¡å¼çš„æ¯”è¾ƒç­‰ã€‚è¿™äº›èµ„æºå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨è®¾è®¡æ¨¡å¼ã€‚\nä¸­æ–‡ç½‘ç«™ï¼šhttps://java-design-patterns.com/zh/\nGithub ä¸Šæºç ä»“åº“ï¼ˆéå®˜æ–¹ï¼‰ï¼šhttps://github.com/iluwatar/java-design-patterns\nç›®çš„ åœ¨å®¢æˆ·ç«¯ä¸Šæä¾›å¸®åŠ©ç¨‹åºæœåŠ¡å®ä¾‹ï¼Œå¹¶ä»å…±äº«èµ„æºä¸Šè½¬ç§»å¸¸ç”¨åŠŸèƒ½ã€‚\nAmbassador è®¾è®¡æ¨¡å¼çš„ä¸»è¦ç›®çš„æ˜¯å°†å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¸è¿œç¨‹æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ç»†èŠ‚éš”ç¦»å¼€æ¥ï¼Œä»è€Œä½¿å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå¯ä»¥ä¸“æ³¨äºè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸å¿…å…³æ³¨ç½‘ç»œé€šä¿¡ç»†èŠ‚å’Œé”™è¯¯å¤„ç†ã€‚\nåœ¨ä¼ ç»Ÿçš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¸­ï¼Œé€šå¸¸éœ€è¦å¤„ç†å¤§é‡çš„ç½‘ç»œé€šä¿¡ç»†èŠ‚å’Œé”™è¯¯å¤„ç†ï¼Œè¿™ä¼šä½¿ä»£ç å˜å¾—å¤æ‚ä¸”éš¾ä»¥ç»´æŠ¤ã€‚è€Œä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å¯ä»¥å°†è¿™äº›ç»†èŠ‚å’Œå¤„ç†é€»è¾‘é›†ä¸­åœ¨ä¸€ä¸ªå•ç‹¬çš„ç±»ä¸­ï¼Œä»è€Œä½¿å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºçš„ä»£ç æ›´åŠ ç®€æ´ã€æ˜“äºç»´æŠ¤å’Œæ‰©å±•ã€‚\næ­¤å¤–ï¼Œä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼è¿˜å¯ä»¥æé«˜å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¸è¿œç¨‹æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡å®‰å…¨æ€§å’Œå¯é æ€§ã€‚ä¾‹å¦‚ï¼ŒAmbassador ç±»å¯ä»¥è´Ÿè´£ç»Ÿä¸€å¤„ç†æ‰€æœ‰çš„ç½‘ç»œé€šä¿¡ï¼Œä»è€Œå¯ä»¥æ›´è½»æ¾åœ°å®ç°å®‰å…¨æ€§å’Œå¯é æ€§æ§åˆ¶ã€‚\nè§£é‡Š å‡è®¾æœ‰ä¸€ä¸ªæ—§ç‰ˆçš„è¿œç¨‹æœåŠ¡ï¼Œè¯¥æœåŠ¡æä¾›äº†è®¸å¤šå®¢æˆ·ç«¯è®¿é—®çš„åŠŸèƒ½ï¼Œä½†ç”±äºç”¨æˆ·çš„å¤§é‡è¯·æ±‚ï¼Œå¯¼è‡´è¿æ¥é—®é¢˜å˜å¾—æ™®éã€‚æ­¤å¤–ï¼Œæ–°çš„è¯·æ±‚é¢‘ç‡è§„åˆ™éœ€è¦åŒæ—¶å®ç°å»¶è¿Ÿæ£€æµ‹å’Œå®¢æˆ·ç«¯æ—¥å¿—åŠŸèƒ½ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼ã€‚\nå¾®è½¯æ–‡æ¡£ åšäº†å¦‚ä¸‹é˜è¿°\nå¯ä»¥å°†å¤§ä½¿æœåŠ¡è§†ä¸ºä¸å®¢æˆ·ç«¯ä½äºåŒä¸€ä½ç½®çš„è¿›ç¨‹å¤–ä»£ç†ã€‚ æ­¤æ¨¡å¼å¯¹äºä»¥è¯­è¨€ä¸å¯çŸ¥çš„æ–¹å¼å‡è½»å¸¸è§çš„å®¢æˆ·ç«¯è¿æ¥ä»»åŠ¡ï¼ˆä¾‹å¦‚ç›‘è§†ï¼Œæ—¥å¿—è®°å½•ï¼Œè·¯ç”±ï¼Œå®‰å…¨æ€§ï¼ˆå¦‚ TLSï¼‰å’Œå¼¹æ€§æ¨¡å¼ï¼‰çš„å·¥ä½œå¾ˆæœ‰ç”¨ã€‚ å®ƒé€šå¸¸ä¸æ—§ç‰ˆåº”ç”¨ç¨‹åºæˆ–å…¶ä»–éš¾ä»¥ä¿®æ”¹çš„åº”ç”¨ç¨‹åºä¸€èµ·ä½¿ç”¨ï¼Œä»¥æ‰©å±•å…¶ç½‘ç»œåŠŸèƒ½ã€‚ å®ƒè¿˜å¯ä»¥ä½¿ä¸“ä¸šå›¢é˜Ÿå®ç°è¿™äº›åŠŸèƒ½ã€‚\nåœ¨è¯¥æ¨¡å¼ä¸­ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ª Ambassador ç±»æ¥å……å½“å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå’Œè¿œç¨‹æœåŠ¡ä¹‹é—´çš„ä»£ç†ã€‚Ambassador ç±»è´Ÿè´£å¤„ç†æ‰€æœ‰çš„ç½‘ç»œé€šä¿¡ç»†èŠ‚å’Œé”™è¯¯å¤„ç†ï¼Œå¹¶å®ç°æ–°çš„è¯·æ±‚é¢‘ç‡è§„åˆ™ï¼ŒåŒ…æ‹¬å»¶è¿Ÿæ£€æµ‹å’Œå®¢æˆ·ç«¯æ—¥å¿—åŠŸèƒ½ã€‚\nå…·ä½“æ¥è¯´ï¼ŒAmbassador ç±»å¯ä»¥å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š\nå»¶è¿Ÿæ£€æµ‹ï¼šåœ¨è¯·æ±‚åˆ°è¾¾è¿œç¨‹æœåŠ¡ä¹‹å‰ï¼ŒAmbassador ç±»å¯ä»¥æ£€æµ‹è¯·æ±‚çš„æ—¶é—´æˆ³ï¼Œå¹¶è®¡ç®—å‡ºè¯·æ±‚çš„å»¶è¿Ÿæ—¶é—´ã€‚å¦‚æœè¯·æ±‚çš„å»¶è¿Ÿæ—¶é—´è¶…è¿‡äº†é¢„è®¾çš„é˜ˆå€¼ï¼ŒAmbassador ç±»å¯ä»¥å°†è¯·æ±‚æ‹’ç»ã€‚ å®¢æˆ·ç«¯æ—¥å¿—åŠŸèƒ½ï¼šAmbassador ç±»å¯ä»¥è®°å½•è¯·æ±‚çš„æ—¶é—´æˆ³ã€è¯·æ±‚çš„å†…å®¹å’Œå“åº”çš„å†…å®¹ï¼Œå¹¶å°†è¿™äº›ä¿¡æ¯ä¿å­˜åˆ°å®¢æˆ·ç«¯çš„æ—¥å¿—æ–‡ä»¶ä¸­ã€‚è¿™æ ·å¯ä»¥å¸®åŠ©å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºè¿›è¡Œè°ƒè¯•å’Œæ•…éšœæ’é™¤ã€‚ è¿æ¥é—®é¢˜å¤„ç†ï¼šAmbassador ç±»å¯ä»¥ç›‘æ§è¿œç¨‹æœåŠ¡çš„è¿æ¥çŠ¶æ€ï¼Œå¹¶åœ¨è¿æ¥å‡ºç°é—®é¢˜æ—¶è¿›è¡Œè‡ªåŠ¨é‡è¯•ã€‚åŒæ—¶ï¼ŒAmbassador ç±»è¿˜å¯ä»¥å®ç°ä¸€äº›ä¼˜åŒ–ç­–ç•¥ï¼Œä¾‹å¦‚ä½¿ç”¨è¿æ¥æ± ç­‰ï¼Œä»¥æé«˜è¿æ¥çš„å¯é æ€§å’Œæ€§èƒ½ã€‚ ç¨‹åºç¤ºä¾‹\næœ‰äº†ä¸Šé¢çš„ä»‹ç»æˆ‘ä»¬å°†åœ¨è¿™ä¸ªä¾‹å­ä¸­æ¨¡ä»¿åŠŸèƒ½ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ªç”¨è¿œç¨‹æœåŠ¡å®ç°çš„æ¥å£ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å¤§ä½¿æœåŠ¡ã€‚\ninterface RemoteServiceInterface { long doRemoteFunction(int value) throws Exception; } è¡¨ç¤ºä¸ºå•ä¾‹çš„è¿œç¨‹æœåŠ¡ã€‚\npublic class RemoteService implements RemoteServiceInterface { private static final Logger LOGGER = LoggerFactory.getLogger(RemoteService.class); private static RemoteService service = null; static synchronized RemoteService getRemoteService() { if (service == null) { service = new RemoteService(); } return service; } private RemoteService() {} @Override public long doRemoteFunction(int value) { long waitTime = (long) Math.floor(Math.random() * 1000); try { sleep(waitTime); } catch (InterruptedException e) { LOGGER.error(\u0026#34;Thread sleep interrupted\u0026#34;, e); } return waitTime \u0026gt;= 200 ? value * 10 : -1; } } æœåŠ¡å¤§ä½¿æ·»åŠ äº†åƒæ—¥å¿—å’Œå»¶è¿Ÿæ£€æµ‹çš„é¢å¤–åŠŸèƒ½\npublic class ServiceAmbassador implements RemoteServiceInterface { private static final Logger LOGGER = LoggerFactory.getLogger(ServiceAmbassador.class); private static final int RETRIES = 3; private static final int DELAY_MS = 3000; ServiceAmbassador() { } @Override public long doRemoteFunction(int value) { return safeCall(value); } private long checkLatency(int value) { Long startTime = System.currentTimeMillis(); long result = RemoteService.getRemoteService().doRemoteFunction(value); Long timeTaken = System.currentTimeMillis() - startTime; LOGGER.info(\u0026#34;Time taken (ms): \u0026#34; + timeTaken); return result; } private long safeCall(int value) { int retries = 0; long result = (long) FAILURE; for (int i = 0; i \u0026lt; RETRIES; i++) { if (retries \u0026gt;= RETRIES) { return FAILURE; } if ((result = checkLatency(value)) == FAILURE) { LOGGER.info(\u0026#34;Failed to reach remote: (\u0026#34; + (i + 1) + \u0026#34;)\u0026#34;); retries++; try { sleep(DELAY_MS); } catch (InterruptedException e) { LOGGER.error(\u0026#34;Thread sleep state interrupted\u0026#34;, e); } } else { break; } } return result; } } å®¢æˆ·ç«¯å…·æœ‰ç”¨äºä¸è¿œç¨‹æœåŠ¡è¿›è¡Œäº¤äº’çš„æœ¬åœ°æœåŠ¡å¤§ä½¿ï¼š\npublic class Client { private static final Logger LOGGER = LoggerFactory.getLogger(Client.class); private final ServiceAmbassador serviceAmbassador = new ServiceAmbassador(); long useService(int value) { long result = serviceAmbassador.doRemoteFunction(value); LOGGER.info(\u0026#34;Service result: \u0026#34; + result); return result; } } è¿™æ˜¯ä¸¤ä¸ªä½¿ç”¨è¯¥æœåŠ¡çš„å®¢æˆ·ç«¯ã€‚\npublic class App { public static void main(String[] args) { Client host1 = new Client(); Client host2 = new Client(); host1.useService(12); host2.useService(73); } } Here\u0026rsquo;s the output for running the example:\nTime taken (ms): 111 Service result: 120 Time taken (ms): 931 Failed to reach remote: (1) Time taken (ms): 665 Failed to reach remote: (2) Time taken (ms): 538 Failed to reach remote: (3) Service result: -1 ç±»å›¾ é€‚ç”¨åœºæ™¯ Ambassador è®¾è®¡æ¨¡å¼é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š\nå½“å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºéœ€è¦ä¸è¿œç¨‹æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œå¹¶ä¸”éœ€è¦å¤„ç†ä¸ç½‘ç»œé€šä¿¡ç›¸å…³çš„æ‰€æœ‰ç»†èŠ‚æ—¶ã€‚ å½“å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºéœ€è¦éš”ç¦»ä¸è¿œç¨‹æœåŠ¡å™¨çš„é€šä¿¡ç»†èŠ‚æ—¶ï¼Œä»¥ä¾¿æ›´å¥½åœ°ä¸“æ³¨äºè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ã€‚ å½“å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºéœ€è¦å¤„ç†ä¸è¿œç¨‹æœåŠ¡å™¨çš„é€šä¿¡é”™è¯¯æ—¶ã€‚ å½“å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºéœ€è¦å®ç°æ–°çš„è¯·æ±‚é¢‘ç‡è§„åˆ™ï¼Œä¾‹å¦‚å»¶è¿Ÿæ£€æµ‹å’Œå®¢æˆ·ç«¯æ—¥å¿—åŠŸèƒ½ç­‰ã€‚ å½“å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºéœ€è¦åœ¨ä¸æ›´æ”¹æ—§ç‰ˆè¿œç¨‹æœåŠ¡ä»£ç çš„æƒ…å†µä¸‹ï¼Œå¯¹è¿œç¨‹æœåŠ¡è¿›è¡Œå®šåˆ¶åŒ–æ‰©å±•æ—¶ã€‚ å…¸å‹ç”¨ä¾‹ Ambassador è®¾è®¡æ¨¡å¼å¯ä»¥ç”¨äºè®¸å¤šåœºæ™¯ï¼Œä»¥ä¸‹æ˜¯å…¶ä¸­çš„ä¸€äº›å…¸å‹ç”¨ä¾‹ï¼š\né™æµå’Œç†”æ–­ä¿æŠ¤ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒæœåŠ¡ä¹‹é—´çš„è°ƒç”¨æ˜¯é€šè¿‡ç½‘ç»œè¿›è¡Œçš„ï¼Œç½‘ç»œå»¶è¿Ÿã€æ•…éšœå’Œä¸å¯ç”¨æ€§æ˜¯å¸¸è§çš„é—®é¢˜ã€‚å½“ä¸€ä¸ªæœåŠ¡è¢«é¢‘ç¹è°ƒç”¨æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´å…¶è¿‡è½½æˆ–å´©æºƒï¼Œä»è€Œå½±å“æ•´ä¸ªç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯ç”¨æ€§ã€‚ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å¯ä»¥å®ç°å¯¹æœåŠ¡çš„è¯·æ±‚æµé‡å’Œæ‰§è¡Œé¢‘ç‡è¿›è¡Œé™åˆ¶ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å®ç°ç†”æ–­ä¿æŠ¤ï¼Œå½“ä¸€ä¸ªæœåŠ¡å‡ºç°æ•…éšœæˆ–ä¸å¯ç”¨æ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨æœåŠ¡ã€‚\né™æµ å½“ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼æ—¶ï¼Œå¯ä»¥åœ¨ Ambassador ç±»ä¸­å®ç°æ–°çš„è¯·æ±‚é¢‘ç‡è§„åˆ™ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œè¯´æ˜å¦‚ä½•ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼æ¥å®ç°è¯·æ±‚é¢‘ç‡è§„åˆ™ï¼š\nå‡è®¾æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºéœ€è¦å‘è¿œç¨‹æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œå¹¶ä¸”éœ€è¦å®ç°ä»¥ä¸‹è¯·æ±‚é¢‘ç‡è§„åˆ™ï¼šæ¯ä¸ªå®¢æˆ·ç«¯åœ¨ 10 ç§’é’Ÿå†…åªèƒ½å‘é€ 10 ä¸ªè¯·æ±‚ã€‚å¦‚æœå®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚è¶…è¿‡äº†è¿™ä¸ªé™åˆ¶ï¼ŒæœåŠ¡å™¨å°†è¿”å› 429 Too Many Requests é”™è¯¯ã€‚\nä¸ºäº†å®ç°è¿™ä¸ªè§„åˆ™ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ª Ambassador ç±»æ¥å……å½“å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå’Œè¿œç¨‹æœåŠ¡å™¨ä¹‹é—´çš„ä»£ç†ã€‚åœ¨ Ambassador ç±»ä¸­ï¼Œå¯ä»¥ä½¿ç”¨è®¡æ•°å™¨å’Œå®šæ—¶å™¨æ¥å®ç°è¯·æ±‚é¢‘ç‡æ§åˆ¶é€»è¾‘ã€‚\nå…·ä½“æ¥è¯´ï¼ŒAmbassador ç±»å¯ä»¥å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š\nå®šä¹‰è®¡æ•°å™¨å’Œå®šæ—¶å™¨ï¼šåœ¨ Ambassador ç±»çš„æ„é€ å‡½æ•°ä¸­ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªè®¡æ•°å™¨å’Œä¸€ä¸ªå®šæ—¶å™¨ã€‚è®¡æ•°å™¨ç”¨äºè®°å½•å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚æ¬¡æ•°ï¼Œå®šæ—¶å™¨ç”¨äºåœ¨æ¯ä¸ª 10 ç§’é’Ÿåé‡ç½®è®¡æ•°å™¨çš„å€¼ã€‚ å¤„ç†è¯·æ±‚ï¼šåœ¨ Ambassador ç±»çš„å¤„ç†è¯·æ±‚æ–¹æ³•ä¸­ï¼Œå¯ä»¥é¦–å…ˆæ£€æŸ¥è®¡æ•°å™¨çš„å€¼æ˜¯å¦è¶…è¿‡äº†é™åˆ¶ã€‚å¦‚æœè¶…è¿‡äº†é™åˆ¶ï¼Œåˆ™è¿”å› 429 Too Many Requests é”™è¯¯ï¼›å¦åˆ™ï¼Œå°†è¯·æ±‚å‘é€åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œå¹¶å°†è®¡æ•°å™¨çš„å€¼å¢åŠ  1ã€‚ å¤„ç†å®šæ—¶å™¨ï¼šåœ¨ Ambassador ç±»ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å®šæ—¶å™¨æ¥å®šæœŸé‡ç½®è®¡æ•°å™¨çš„å€¼ã€‚å½“å®šæ—¶å™¨è§¦å‘æ—¶ï¼Œå°†è®¡æ•°å™¨çš„å€¼è®¾ç½®ä¸º 0ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºäº Java 8 çš„ Ambassador è®¾è®¡æ¨¡å¼çš„ç¤ºä¾‹ä»£ç ï¼Œä½¿ç”¨äº† Java 8 ä¸­çš„ HttpClient ç±»æ¥å‘é€ HTTP è¯·æ±‚ï¼š\nimport java.time.Instant; import java.util.concurrent.Executors; import java.util.concurrent.ScheduledExecutorService; import java.util.concurrent.TimeUnit; import java.util.concurrent.atomic.LongAdder; public class Ambassador { private final LongAdder counter = new LongAdder(); private final ScheduledExecutorService scheduler = Executors.newSingleThreadScheduledExecutor(); private Instant lastResetTime = Instant.now(); public String handleRequest(String url) { // æ£€æŸ¥è®¡æ•°å™¨æ˜¯å¦è¶…è¿‡äº†é™åˆ¶ if (counter.incrementAndGet() \u0026gt; 10) { // è¿”å›â€œToo Many Requestsâ€é”™è¯¯ counter.decrementAndGet(); return \u0026#34;429 Too Many Requests\u0026#34;; } else { // å‘é€è¯·æ±‚åˆ°è¿œç¨‹æœåŠ¡å™¨ String response = sendRequest(url); // æ£€æŸ¥æ˜¯å¦éœ€è¦é‡ç½®è®¡æ•°å™¨ Instant currentTime = Instant.now(); if (currentTime.getEpochSecond() - lastResetTime.getEpochSecond() \u0026gt;= 10) { counter.reset(); lastResetTime = currentTime; } // è¿”å›å“åº”ç»“æœ return response; } } private String sendRequest(String url) { // å‘é€ HTTP GET è¯·æ±‚å¹¶è¿”å›å“åº”ç»“æœ HttpClient client = HttpClient.newHttpClient(); HttpRequest request = HttpRequest.newBuilder() .uri(URI.create(url)) .GET() .build(); try { HttpResponse\u0026lt;String\u0026gt; response = client.send(request, HttpResponse.BodyHandlers.ofString()); return response.body(); } catch (IOException | InterruptedException e) { // å¤„ç†è¯·æ±‚å¼‚å¸¸ return \u0026#34;500 Internal Server Error\u0026#34;; } } public Ambassador() { // å®šæ—¶é‡ç½®è®¡æ•°å™¨ scheduler.scheduleAtFixedRate(() -\u0026gt; { counter.reset(); lastResetTime = Instant.now(); }, 10, 10, TimeUnit.SECONDS); } public void shutdown() { // å…³é—­å®šæ—¶å™¨ scheduler.shutdown(); } } åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼ŒAmbassador ç±»ä½¿ç”¨äº† LongAdder ç±»å‹çš„è®¡æ•°å™¨å’Œ ScheduledExecutorService ç±»å‹çš„å®šæ—¶å™¨ï¼Œå¹¶å®ç°äº†å¤„ç†è¯·æ±‚çš„æ–¹æ³• handleRequestã€‚å½“å®¢æˆ·ç«¯è°ƒç”¨ handleRequest æ–¹æ³•æ—¶ï¼ŒAmbassador ç±»ä¼šæ£€æŸ¥è®¡æ•°å™¨çš„å€¼æ˜¯å¦è¶…è¿‡äº†é™åˆ¶ã€‚å¦‚æœè¶…è¿‡äº†é™åˆ¶ï¼Œåˆ™è¿”å› 429 Too Many Requests é”™è¯¯ï¼›å¦åˆ™ï¼Œå°†è¯·æ±‚å‘é€åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œå¹¶å°†è®¡æ•°å™¨çš„å€¼å¢åŠ  1ã€‚åŒæ—¶ï¼ŒAmbassador ç±»è¿˜ä¼šä½¿ç”¨ ScheduledExecutorService æ¥å®šæœŸé‡ç½®è®¡æ•°å™¨çš„å€¼ã€‚\nç†”æ–­ Ambassador è®¾è®¡æ¨¡å¼å¯ä»¥ä½¿ç”¨ç†”æ–­æ¨¡å¼æ¥ä¿æŠ¤æœåŠ¡å…å—æ•…éšœæˆ–ä¸å¯ç”¨æ€§çš„å½±å“ã€‚ç†”æ–­æ¨¡å¼æ˜¯ä¸€ç§é˜²æ­¢æ•…éšœæ‰©æ•£çš„æœºåˆ¶ï¼Œå½“æœåŠ¡å‡ºç°æ•…éšœæˆ–ä¸å¯ç”¨æ—¶ï¼Œç†”æ–­å™¨ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨æœåŠ¡ï¼Œå¹¶åœ¨ä¸€æ®µæ—¶é—´å†…åœæ­¢å‘é€è¯·æ±‚ã€‚å¦‚æœå¤‡ç”¨æœåŠ¡ä¹Ÿå‡ºç°æ•…éšœæˆ–ä¸å¯ç”¨ï¼Œç†”æ–­å™¨ä¼šé‡æ–°å¯åŠ¨å¹¶ç»§ç»­å‘é€è¯·æ±‚ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å®ç°ç†”æ–­çš„ç¤ºä¾‹ä»£ç ï¼š\nimport java.util.concurrent.*; import java.util.concurrent.atomic.AtomicInteger; import java.util.logging.Level; import java.util.logging.Logger; public class Ambassador { private final AtomicInteger failureCount = new AtomicInteger(0); private final AtomicBoolean circuitBreaker = new AtomicBoolean(false); private final Service primaryService; private final Service backupService; private final int failureThreshold; private final int timeout; private final ExecutorService executor; private final Logger logger; public Ambassador(Service primaryService, Service backupService, int failureThreshold, int timeout, int maxConcurrentRequests) { this.primaryService = primaryService; this.backupService = backupService; this.failureThreshold = failureThreshold; this.timeout = timeout; this.executor = Executors.newFixedThreadPool(maxConcurrentRequests); this.logger = Logger.getLogger(Ambassador.class.getName()); } public String handleRequest(String request) throws TimeoutException { // æ£€æŸ¥ç†”æ–­å™¨çŠ¶æ€ if (circuitBreaker.get()) { // è¿”å›å¤‡ç”¨æœåŠ¡çš„å“åº” return backupService.process(request); } else { try { // åˆ›å»º Callable å¯¹è±¡ï¼Œå¹¶è®¾ç½®è¶…æ—¶æ—¶é—´ Callable\u0026lt;String\u0026gt; task = () -\u0026gt; primaryService.process(request); Future\u0026lt;String\u0026gt; future = executor.submit(task); String response = future.get(timeout, TimeUnit.MILLISECONDS); // é‡ç½®æ•…éšœè®¡æ•°å™¨ failureCount.set(0); return response; } catch (InterruptedException | ExecutionException e) { // å¤„ç†è¯·æ±‚å¼‚å¸¸ // å¢åŠ æ•…éšœè®¡æ•°å™¨ failureCount.incrementAndGet(); // æ£€æŸ¥æ•…éšœè®¡æ•°å™¨æ˜¯å¦è¶…è¿‡é˜ˆå€¼ if (failureCount.get() \u0026gt;= failureThreshold) { // å¯åŠ¨ç†”æ–­å™¨ circuitBreaker.set(true); logger.log(Level.WARNING, \u0026#34;Circuit breaker is tripped, switching to backup service\u0026#34;); } // è¿”å›å¤‡ç”¨æœåŠ¡çš„å“åº” return backupService.process(request); } catch (TimeoutException e) { // å¤„ç†è¯·æ±‚è¶…æ—¶å¼‚å¸¸ throw new TimeoutException(\u0026#34;Request timed out\u0026#34;); } finally { // æ£€æŸ¥ç†”æ–­å™¨çŠ¶æ€ if (circuitBreaker.get()) { // åˆ›å»ºå®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶é‡ç½®ç†”æ–­å™¨çŠ¶æ€ ScheduledExecutorService scheduler = Executors.newSingleThreadScheduledExecutor(); scheduler.schedule(() -\u0026gt; { // é‡ç½®æ•…éšœè®¡æ•°å™¨å’Œç†”æ–­å™¨çŠ¶æ€ failureCount.set(0); circuitBreaker.set(false); logger.log(Level.INFO, \u0026#34;Circuit breaker is reset, switching back to primary service\u0026#34;); // å…³é—­å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨ scheduler.shutdown(); }, timeout, TimeUnit.MILLISECONDS); } } } } } éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚å’Œç³»ç»Ÿè´Ÿè½½æ¥è®¾ç½®æ•…éšœè®¡æ•°å™¨çš„é˜ˆå€¼å’Œç†”æ–­å™¨çš„åœæ­¢æ—¶é—´ã€‚å¦‚æœæ•…éšœè®¡æ•°å™¨çš„å€¼è¶…è¿‡äº†é˜ˆå€¼ï¼Œç†”æ–­å™¨ä¼šå¯åŠ¨ï¼Œå¹¶åœ¨ä¸€å®šæ—¶é—´å†…åœæ­¢å‘é€è¯·æ±‚ã€‚åœ¨ç†”æ–­å™¨åœæ­¢æœŸé—´ï¼ŒAmbassador ç±»ä¼šå°†æ‰€æœ‰è¯·æ±‚è½¬å‘åˆ°å¤‡ç”¨æœåŠ¡ã€‚å½“ç†”æ–­å™¨åœæ­¢æ—¶é—´åˆ°è¾¾åï¼ŒAmbassador ç±»ä¼šé‡æ–°å¯åŠ¨ç†”æ–­å™¨ï¼Œå¹¶å°†è¯·æ±‚è½¬å‘åˆ°ä¸»æœåŠ¡è¿›è¡Œå¤„ç†ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘å¹¶å‘è¯·æ±‚çš„æ•°é‡å’Œè¯·æ±‚çš„å“åº”æ—¶é—´ï¼Œä»¥ä¾¿æ›´å¥½åœ°ä¿è¯ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚\nå®‰å…¨è¿‡æ»¤å™¨ åœ¨ Web åº”ç”¨ç¨‹åºä¸­ï¼Œå®‰å…¨è¿‡æ»¤å™¨é€šå¸¸ç”¨äºæ£€æŸ¥è¾“å…¥æ•°æ®çš„åˆæ³•æ€§å’Œé˜²æ­¢æ”»å‡»ï¼Œå¦‚ SQL æ³¨å…¥ã€è·¨ç«™è„šæœ¬æ”»å‡»ç­‰ã€‚ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å¯ä»¥å°†å®‰å…¨è¿‡æ»¤å™¨éƒ¨ç½²åœ¨åº”ç”¨ç¨‹åºçš„å‰ç«¯ï¼Œæ£€æŸ¥æ‰€æœ‰çš„è¾“å…¥æ•°æ®ï¼Œé˜²æ­¢æ”»å‡»å’Œæ¶æ„è¡Œä¸ºã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼æ¥å®ç°å®‰å…¨è¿‡æ»¤å™¨ï¼š\nimport java.util.regex.Pattern; public class SecurityFilter implements Service { private final Service service; public SecurityFilter(Service service) { this.service = service; } @Override public String process(String request) { // æ£€æŸ¥è¾“å…¥æ•°æ®ï¼Œé˜²æ­¢æ”»å‡»å’Œæ¶æ„è¡Œä¸º if (!isValid(request)) { throw new IllegalArgumentException(\u0026#34;Invalid request\u0026#34;); } // è°ƒç”¨æœåŠ¡å¤„ç†è¯·æ±‚ return service.process(request); } private boolean isValid(String request) { // æ£€æŸ¥è¾“å…¥æ•°æ®æ˜¯å¦åŒ…å«æ¶æ„ä»£ç  Pattern pattern = Pattern.compile(\u0026#34;\u0026lt;script\u0026gt;(.*?)\u0026lt;/script\u0026gt;\u0026#34;, Pattern.CASE_INSENSITIVE); return !pattern.matcher(request).find(); } } åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª SecurityFilter ç±»ï¼Œå®ç°äº† Service æ¥å£ï¼Œå¹¶åœ¨æ„é€ å‡½æ•°ä¸­ä¼ å…¥äº†ä¸€ä¸ªæœåŠ¡å¯¹è±¡ã€‚åœ¨ process æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆæ£€æŸ¥è¾“å…¥æ•°æ®ï¼Œé˜²æ­¢æ”»å‡»å’Œæ¶æ„è¡Œä¸ºï¼Œç„¶åè°ƒç”¨æœåŠ¡å¤„ç†è¯·æ±‚ã€‚\nåœ¨ isValid æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ£€æŸ¥è¾“å…¥æ•°æ®æ˜¯å¦åŒ…å«æ¶æ„ä»£ç ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ£€æŸ¥è¾“å…¥æ•°æ®ä¸­æ˜¯å¦åŒ…å« \u0026lt;script\u0026gt; å’Œ \u0026lt;/script\u0026gt; æ ‡ç­¾ï¼Œå¦‚æœåŒ…å«åˆ™è®¤ä¸ºæ˜¯æ¶æ„ä»£ç ã€‚\nåœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚å’Œå®‰å…¨ç­–ç•¥ï¼Œè®¾è®¡æ›´åŠ å¤æ‚å’Œå®Œå–„çš„å®‰å…¨è¿‡æ»¤å™¨ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–çš„è®¾è®¡æ¨¡å¼å’ŒæŠ€æœ¯ï¼Œå¦‚æ‹¦æˆªå™¨ã€è¿‡æ»¤å™¨é“¾ã€é»‘ç™½åå•ã€åŠ å¯†ç®—æ³•ç­‰ï¼Œæ¥æé«˜åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§å’Œå¯é æ€§ã€‚\nä»¥ä¸‹æ˜¯æ›´è¿›ä¸€æ­¥ä¼˜åŒ–åçš„ SecurityFilter ç±»ç¤ºä¾‹ä»£ç ï¼Œå…¶ä¸­ä½¿ç”¨äº†è¿‡æ»¤å™¨é“¾å’Œé»‘ç™½åå•æ¥å®ç°æ›´åŠ çµæ´»å’Œå¯é…ç½®çš„å®‰å…¨è¿‡æ»¤å™¨ï¼ŒåŒæ—¶å¢åŠ äº†æ—¥å¿—è®°å½•å’Œå¼‚å¸¸å¤„ç†ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç›‘æ§å’Œè°ƒè¯•ç³»ç»Ÿï¼š\nimport java.util.ArrayList; import java.util.List; import java.util.regex.Pattern; import java.util.logging.Level; import java.util.logging.Logger; public class SecurityFilter implements Service { private final Service service; private final List\u0026lt;Filter\u0026gt; filters; private final List\u0026lt;String\u0026gt; whiteList; private final List\u0026lt;String\u0026gt; blackList; private final Logger logger = Logger.getLogger(SecurityFilter.class.getName()); public SecurityFilter(Service service) { this.service = service; this.filters = new ArrayList\u0026lt;\u0026gt;(); this.whiteList = new ArrayList\u0026lt;\u0026gt;(); this.blackList = new ArrayList\u0026lt;\u0026gt;(); } public void addFilter(Filter filter) { filters.add(filter); } public void addWhiteList(String pattern) { whiteList.add(pattern); } public void addBlackList(String pattern) { blackList.add(pattern); } @Override public String process(String request) { // æ£€æŸ¥ç™½åå• if (!isAllowed(request, whiteList)) { logger.log(Level.WARNING, \u0026#34;Request not allowed: \u0026#34; + request); throw new IllegalArgumentException(\u0026#34;Request not allowed\u0026#34;); } // æ£€æŸ¥é»‘åå• if (isBlocked(request, blackList)) { logger.log(Level.WARNING, \u0026#34;Request blocked: \u0026#34; + request); throw new IllegalArgumentException(\u0026#34;Request blocked\u0026#34;); } // æ‰§è¡Œè¿‡æ»¤å™¨é“¾ for (Filter filter : filters) { request = filter.doFilter(request); } // è°ƒç”¨æœåŠ¡å¤„ç†è¯·æ±‚ return service.process(request); } private boolean isAllowed(String request, List\u0026lt;String\u0026gt; patterns) { // æ£€æŸ¥è¯·æ±‚æ˜¯å¦åœ¨ç™½åå•ä¸­ return patterns.stream().anyMatch(pattern -\u0026gt; Pattern.matches(pattern, request)); } private boolean isBlocked(String request, List\u0026lt;String\u0026gt; patterns) { // æ£€æŸ¥è¯·æ±‚æ˜¯å¦åœ¨é»‘åå•ä¸­ return patterns.stream().anyMatch(pattern -\u0026gt; Pattern.matches(pattern, request)); } public interface Filter { String doFilter(String request); } } è´Ÿè½½å‡è¡¡ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œè´Ÿè½½å‡è¡¡é€šå¸¸ç”¨äºå°†è¯·æ±‚åˆ†å‘åˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œä»¥å®ç°é«˜å¯ç”¨æ€§å’Œå®¹é”™æ€§ã€‚ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å¯ä»¥å®ç°è´Ÿè½½å‡è¡¡ï¼Œå°†è¯·æ±‚åˆ†å‘åˆ°å¤šä¸ªæœåŠ¡å®ä¾‹ä¸Šï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œæ€§èƒ½ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼æ¥å®ç°è´Ÿè½½å‡è¡¡ï¼š\nimport java.util.List; import java.util.concurrent.ThreadLocalRandom; public class LoadBalancer implements Service { private final List\u0026lt;Service\u0026gt; services; private final LoadBalancingStrategy strategy; public LoadBalancer(List\u0026lt;Service\u0026gt; services, LoadBalancingStrategy strategy) { this.services = services; this.strategy = strategy; } @Override public String process(String request) { // æ ¹æ®è´Ÿè½½å‡è¡¡ç­–ç•¥é€‰æ‹©æœåŠ¡å®ä¾‹ Service service = strategy.select(services); // è°ƒç”¨é€‰æ‹©çš„æœåŠ¡å¤„ç†è¯·æ±‚ return service.process(request); } public interface LoadBalancingStrategy { Service select(List\u0026lt;Service\u0026gt; services); } public static class RandomStrategy implements LoadBalancingStrategy { @Override public Service select(List\u0026lt;Service\u0026gt; services) { // éšæœºé€‰æ‹©ä¸€ä¸ªæœåŠ¡å®ä¾‹ int index = ThreadLocalRandom.current().nextInt(services.size()); return services.get(index); } } public static class RoundRobinStrategy implements LoadBalancingStrategy { private int index = 0; @Override public Service select(List\u0026lt;Service\u0026gt; services) { // è½®è¯¢é€‰æ‹©æœåŠ¡å®ä¾‹ Service service = services.get(index); index = (index + 1) % services.size(); return service; } } } åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª LoadBalancer ç±»ï¼Œå®ç°äº† Service æ¥å£ï¼Œå¹¶åœ¨æ„é€ å‡½æ•°ä¸­ä¼ å…¥äº†ä¸€ä¸ªæœåŠ¡åˆ—è¡¨å’Œä¸€ä¸ªè´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚åœ¨ process æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æ ¹æ®è´Ÿè½½å‡è¡¡ç­–ç•¥é€‰æ‹©ä¸€ä¸ªæœåŠ¡å®ä¾‹ï¼Œç„¶åè°ƒç”¨é€‰æ‹©çš„æœåŠ¡å¤„ç†è¯·æ±‚ã€‚\nåœ¨ LoadBalancingStrategy æ¥å£ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª select æ–¹æ³•ï¼Œç”¨äºé€‰æ‹©æœåŠ¡å®ä¾‹ã€‚åœ¨ RandomStrategy ç±»ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ ThreadLocalRandom æ¥éšæœºé€‰æ‹©ä¸€ä¸ªæœåŠ¡å®ä¾‹ã€‚åœ¨ RoundRobinStrategy ç±»ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨è½®è¯¢ç®—æ³•æ¥é€‰æ‹©æœåŠ¡å®ä¾‹ã€‚\nåœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚å’Œæ€§èƒ½æŒ‡æ ‡ï¼Œé€‰æ‹©åˆé€‚çš„è´Ÿè½½å‡è¡¡ç­–ç•¥å’Œç®—æ³•ï¼Œå¦‚åŠ æƒè½®è¯¢ã€æœ€å°‘è¿æ¥æ•°ã€å“ˆå¸Œç®—æ³•ç­‰ï¼Œæ¥å®ç°æ›´åŠ é«˜æ•ˆå’Œçµæ´»çš„è´Ÿè½½å‡è¡¡ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–çš„è®¾è®¡æ¨¡å¼å’ŒæŠ€æœ¯ï¼Œå¦‚ç¼“å­˜ã€å¼‚æ­¥å¤„ç†ã€åˆ†å¸ƒå¼é”ç­‰ï¼Œæ¥è¿›ä¸€æ­¥æé«˜ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œæ€§èƒ½ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è®¾è®¡è´Ÿè½½å‡è¡¡å™¨æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®å®é™…æƒ…å†µå’Œè´Ÿè½½å‡è¡¡ç®—æ³•çš„ç‰¹ç‚¹ï¼Œåˆç†åœ°åˆ†é…æœåŠ¡å®ä¾‹å’Œè¯·æ±‚ï¼Œé¿å…å‡ºç°è´Ÿè½½ä¸å‡è¡¡æˆ–æ€§èƒ½ç“¶é¢ˆçš„é—®é¢˜ã€‚\nä»¥ä¸‹æ˜¯ç»è¿‡ä¼˜åŒ–åçš„è´Ÿè½½å‡è¡¡å™¨çš„ä»£ç ï¼š\nimport java.util.ArrayList; import java.util.List; import java.util.concurrent.ConcurrentHashMap; import java.util.concurrent.ThreadLocalRandom; import java.util.concurrent.atomic.AtomicInteger; import java.util.function.Function; public class LoadBalancer { private final List\u0026lt;Service\u0026gt; services; private final LoadBalancingStrategy strategy; private final ConcurrentHashMap\u0026lt;Service, Integer\u0026gt; weights = new ConcurrentHashMap\u0026lt;\u0026gt;(); public LoadBalancer(List\u0026lt;Service\u0026gt; services, LoadBalancingStrategy strategy) { this.services = new ArrayList\u0026lt;\u0026gt;(services); this.strategy = strategy; for (Service service : services) { weights.put(service, 1); } } public Service getService() { return strategy.select(services, weights); } public void setWeight(Service service, int weight) { weights.put(service, weight); } public static LoadBalancer create(List\u0026lt;Service\u0026gt; services, LoadBalancingStrategy strategy) { return new LoadBalancer(services, strategy); } public static LoadBalancer createWithRoundRobin(List\u0026lt;Service\u0026gt; services) { return new LoadBalancer(services, LoadBalancingStrategy.ROUND_ROBIN); } public static LoadBalancer createWithRandom(List\u0026lt;Service\u0026gt; services) { return new LoadBalancer(services, LoadBalancingStrategy.RANDOM); } public enum LoadBalancingStrategy { RANDOM(services -\u0026gt; services.get(ThreadLocalRandom.current().nextInt(services.size()))), ROUND_ROBIN(services -\u0026gt; { AtomicInteger index = new AtomicInteger(0); return services.get(index.getAndIncrement() % services.size()); }); private final Function\u0026lt;List\u0026lt;Service\u0026gt;, Service\u0026gt; selector; LoadBalancingStrategy(Function\u0026lt;List\u0026lt;Service\u0026gt;, Service\u0026gt; selector) { this.selector = selector; } public Service select(List\u0026lt;Service\u0026gt; services, ConcurrentHashMap\u0026lt;Service, Integer\u0026gt; weights) { if (services == null || services.isEmpty()) { throw new IllegalArgumentException(\u0026#34;Services cannot be empty\u0026#34;); } if (services.size() == 1) { return services.get(0); } List\u0026lt;Service\u0026gt; candidates = new ArrayList\u0026lt;\u0026gt;(services.size() * 100); for (Service service : services) { int weight = weights.getOrDefault(service, 1); for (int i = 0; i \u0026lt; weight; i++) { candidates.add(service); } } return selector.apply(candidates); } } } åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬è¿›è¡Œäº†ä»¥ä¸‹ä¼˜åŒ–ï¼š\nä½¿ç”¨äº† ConcurrentHashMap æ¥ä»£æ›¿ HashMapï¼Œç¡®ä¿åœ¨å¹¶å‘ç¯å¢ƒä¸‹çš„çº¿ç¨‹å®‰å…¨æ€§ã€‚ ä½¿ç”¨äº†æšä¸¾ç±»å‹æ¥ä»£æ›¿å­—ç¬¦ä¸²å¸¸é‡ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå®‰å…¨æ€§ã€‚ ä½¿ç”¨äº† Lambda è¡¨è¾¾å¼å’Œæ–¹æ³•å¼•ç”¨æ¥ç®€åŒ–è´Ÿè½½å‡è¡¡ç­–ç•¥çš„å®ç°ã€‚ ä½¿ç”¨äº†é™æ€å·¥å‚æ–¹æ³•æ¥åˆ›å»ºè´Ÿè½½å‡è¡¡å™¨å¯¹è±¡ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œçµæ´»æ€§ã€‚ é‡æ„äº† select æ–¹æ³•ï¼Œå°†å…¶å®ç°é€»è¾‘ä» LoadBalancer ç±»ä¸­æŠ½ç¦»å‡ºæ¥ï¼Œå¹¶ä¼˜åŒ–äº†æƒé‡çš„å¤„ç†é€»è¾‘ã€‚ ç¼“å­˜ ç¼“å­˜å¯ä»¥æé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œå“åº”é€Ÿåº¦ï¼Œå‡å°‘å¯¹æ•°æ®åº“ç­‰åç«¯èµ„æºçš„è®¿é—®ã€‚ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å¯ä»¥å°†ç¼“å­˜éƒ¨ç½²åœ¨åº”ç”¨ç¨‹åºçš„å‰ç«¯ï¼Œå°†è¯·æ±‚è½¬å‘ç»™ç¼“å­˜æœåŠ¡å™¨è¿›è¡Œå¤„ç†ï¼Œå‡å°‘å¯¹åç«¯èµ„æºçš„è®¿é—®ï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå“åº”é€Ÿåº¦ã€‚\nä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ Java å®ç°çš„ç®€å•ç¤ºä¾‹ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å°†è¯·æ±‚è½¬å‘ç»™ç¼“å­˜æœåŠ¡å™¨ï¼š\nå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„ç”µå­å•†åŠ¡åº”ç”¨ç¨‹åºï¼Œç”¨æˆ·å¯ä»¥æµè§ˆå•†å“ã€ä¸‹å•ã€æ”¯ä»˜ç­‰æ“ä½œã€‚ä¸ºäº†æé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå“åº”é€Ÿåº¦ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„å‰ç«¯éƒ¨ç½²ä¸€ä¸ªç¼“å­˜æœåŠ¡å™¨ï¼Œå¹¶ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å°†è¯·æ±‚è½¬å‘ç»™ç¼“å­˜æœåŠ¡å™¨è¿›è¡Œå¤„ç†ã€‚åœ¨è¿™ä¸ªåº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å‡è®¾æœ‰ä¸€ä¸ªåä¸º ProductService çš„æœåŠ¡ï¼Œç”¨äºè·å–å•†å“ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„å‰ç«¯éƒ¨ç½²ä¸€ä¸ªç¼“å­˜æœåŠ¡å™¨ï¼Œå¹¶ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å°†è¯·æ±‚è½¬å‘ç»™ç¼“å­˜æœåŠ¡å™¨ã€‚\né¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ª ProductService æ¥å£ï¼Œç”¨äºè·å–å•†å“ä¿¡æ¯ï¼š\npublic interface ProductService { Product getProductById(String id); } æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª ProductServiceImpl ç±»ï¼Œå®ç° ProductService æ¥å£ï¼Œå¹¶ç”¨äºä»åç«¯æ•°æ®åº“è·å–å•†å“ä¿¡æ¯ï¼š\npublic class ProductServiceImpl implements ProductService { @Override public Product getProductById(String id) { // ä»åç«¯æ•°æ®åº“è·å–å•†å“ä¿¡æ¯ return new Product(id, \u0026#34;Product \u0026#34; + id); } } ç„¶åï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª ProductCache ç±»ï¼Œç”¨äºç¼“å­˜å•†å“ä¿¡æ¯ï¼š\npublic class ProductCache { private final Map\u0026lt;String, Product\u0026gt; cache = new HashMap\u0026lt;\u0026gt;(); public Product getProductById(String id) { return cache.get(id); } public void putProduct(Product product) { cache.put(product.getId(), product); } } æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª ProductCacheService ç±»ï¼Œå®ç° ProductService æ¥å£ï¼Œå¹¶ç”¨äºä»ç¼“å­˜æœåŠ¡å™¨è·å–å•†å“ä¿¡æ¯ã€‚å¦‚æœç¼“å­˜æœåŠ¡å™¨ä¸­æ²¡æœ‰æ‰€éœ€çš„æ•°æ®ï¼Œé‚£ä¹ˆå°±å°†è¯·æ±‚è½¬å‘ç»™åç«¯æœåŠ¡è¿›è¡Œå¤„ç†ï¼Œå¹¶å°†å¤„ç†ç»“æœç¼“å­˜èµ·æ¥ï¼š\npublic class ProductCacheService implements ProductService { private final ProductService backendService; private final ProductCache cache; public ProductCacheService(ProductService backendService, ProductCache cache) { this.backendService = backendService; this.cache = cache; } @Override public Product getProductById(String id) { Product product = cache.getProductById(id); if (product == null) { // ç¼“å­˜æœåŠ¡å™¨ä¸­æ²¡æœ‰æ‰€éœ€çš„æ•°æ®ï¼Œå°†è¯·æ±‚è½¬å‘ç»™åç«¯æœåŠ¡è¿›è¡Œå¤„ç† product = backendService.getProductById(id); // å°†å¤„ç†ç»“æœç¼“å­˜èµ·æ¥ï¼Œä»¥ä¾¿åç»­çš„è¯·æ±‚å¯ä»¥ç›´æ¥ä»ç¼“å­˜æœåŠ¡å™¨è·å–æ•°æ® cache.putProduct(product); } return product; } } æœ€åï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª ProductServiceAmbassador ç±»ï¼Œç”¨äºæ¥æ”¶æ¥è‡ªåº”ç”¨ç¨‹åºçš„è¯·æ±‚ï¼Œå¹¶æ ¹æ®ä¸€å®šçš„è§„åˆ™å°†è¯·æ±‚è½¬å‘ç»™ç¼“å­˜æœåŠ¡å™¨æˆ–åç«¯æœåŠ¡ã€‚\npublic class ProductServiceAmbassador implements ProductService { private final ProductService cacheService; private final ProductService backendService; private final Map\u0026lt;String, Long\u0026gt; cachedIds = new ConcurrentHashMap\u0026lt;\u0026gt;(); private final long cacheExpireTime = 60 * 1000L; // ç¼“å­˜è¿‡æœŸæ—¶é—´ä¸º 60 ç§’ @Autowired public ProductServiceAmbassador(ProductService cacheService, ProductService backendService) { this.cacheService = cacheService; this.backendService = backendService; } @Override public Product getProductById(String id) { Long cachedTime = cachedIds.get(id); // å¦‚æœå•†å“ ID åœ¨ç¼“å­˜ä¸­å­˜åœ¨ï¼Œå¹¶ä¸”ç¼“å­˜æœªè¿‡æœŸï¼Œé‚£ä¹ˆå°±ç›´æ¥è¿”å›ç¼“å­˜ä¸­çš„å•†å“ä¿¡æ¯ if (cachedTime != null \u0026amp;\u0026amp; System.currentTimeMillis() - cachedTime \u0026lt; cacheExpireTime) { return cacheService.getProductById(id); } // å¦‚æœå•†å“ ID åœ¨ç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼Œæˆ–è€…ç¼“å­˜å·²è¿‡æœŸï¼Œé‚£ä¹ˆå°±å°†è¯·æ±‚è½¬å‘ç»™åç«¯æœåŠ¡è¿›è¡Œå¤„ç†ï¼Œå¹¶å°†å¤„ç†ç»“æœç¼“å­˜èµ·æ¥ Product product = backendService.getProductById(id); cacheService.putProduct(product); cachedIds.put(id, System.currentTimeMillis()); return product; } } æœåŠ¡å‘ç°å’Œè·¯ç”± åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒæœåŠ¡å‘ç°å’Œè·¯ç”±é€šå¸¸ç”¨äºå°†è¯·æ±‚è·¯ç”±åˆ°æ­£ç¡®çš„æœåŠ¡å®ä¾‹ä¸Šï¼Œä»¥å®ç°é«˜å¯ç”¨æ€§å’Œå®¹é”™æ€§ã€‚ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å¯ä»¥å®ç°æœåŠ¡å‘ç°å’Œè·¯ç”±ï¼Œå°†è¯·æ±‚è·¯ç”±åˆ°æ­£ç¡®çš„æœåŠ¡å®ä¾‹ä¸Šï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œæ€§èƒ½ã€‚\nä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å®ç°æœåŠ¡å‘ç°å’Œè·¯ç”±çš„ Java ç¤ºä¾‹ä»£ç ï¼š\npublic interface ProductService { Product getProductById(String id); } public class Product { private String id; private String name; public Product(String id, String name) { this.id = id; this.name = name; } public String getId() { return id; } public String getName() { return name; } public void setName(String name) { this.name = name; } } public interface ProductDiscoveryClient { List\u0026lt;String\u0026gt; getInstances(); } public class ProductDiscoveryClientImpl implements ProductDiscoveryClient { @Override public List\u0026lt;String\u0026gt; getInstances() { // å‡è£…ä»æœåŠ¡æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡å®ä¾‹åˆ—è¡¨ return Arrays.asList(\u0026#34;http://localhost:8080\u0026#34;, \u0026#34;http://localhost:8081\u0026#34;, \u0026#34;http://localhost:8082\u0026#34;); } } public interface ProductRoutingStrategy { String getRoute(String productId, List\u0026lt;String\u0026gt; instances); } public class ProductRoutingStrategyImpl implements ProductRoutingStrategy { @Override public String getRoute(String productId, List\u0026lt;String\u0026gt; instances) { // å‡è£…ä½¿ç”¨è´Ÿè½½å‡è¡¡ç®—æ³•é€‰æ‹©ä¸€ä¸ªæœåŠ¡å®ä¾‹ int index = new Random().nextInt(instances.size()); return instances.get(index) + \u0026#34;/product/\u0026#34; + productId; } } public class ProductServiceAmbassador implements ProductService { private final ProductDiscoveryClient discoveryClient; private final ProductRoutingStrategy routingStrategy; private final RestTemplate restTemplate; public ProductServiceAmbassador(ProductDiscoveryClient discoveryClient, ProductRoutingStrategy routingStrategy) { this.discoveryClient = discoveryClient; this.routingStrategy = routingStrategy; this.restTemplate = new RestTemplate(); } @Override public Product getProductById(String id) { List\u0026lt;String\u0026gt; instances = discoveryClient.getInstances(); String route = routingStrategy.getRoute(id, instances); ResponseEntity\u0026lt;Product\u0026gt; response = restTemplate.getForEntity(route, Product.class); return response.getBody(); } } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª ProductService æ¥å£å’Œä¸€ä¸ª Product ç±»ï¼Œç”¨äºè¡¨ç¤ºå•†å“æœåŠ¡å’Œå•†å“ä¿¡æ¯ã€‚ç„¶åï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª ProductDiscoveryClient æ¥å£å’Œä¸€ä¸ª ProductDiscoveryClientImpl ç±»ï¼Œç”¨äºè·å–æœåŠ¡å®ä¾‹åˆ—è¡¨ã€‚åœ¨ ProductDiscoveryClientImpl ç±»ä¸­ï¼Œæˆ‘ä»¬å‡è£…ä»æœåŠ¡æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡å®ä¾‹åˆ—è¡¨ï¼Œè¿™é‡Œæˆ‘ä»¬å°†æœåŠ¡å®ä¾‹åˆ—è¡¨ç¡¬ç¼–ç ä¸ºä¸‰ä¸ªæœ¬åœ°çš„ HTTP åœ°å€ã€‚\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª ProductRoutingStrategy æ¥å£å’Œä¸€ä¸ª ProductRoutingStrategyImpl ç±»ï¼Œç”¨äºé€‰æ‹©æœåŠ¡å®ä¾‹ã€‚åœ¨ ProductRoutingStrategyImpl ç±»ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†éšæœºè´Ÿè½½å‡è¡¡ç®—æ³•æ¥é€‰æ‹©ä¸€ä¸ªæœåŠ¡å®ä¾‹ï¼Œå¹¶å°†å•†å“ ID å’ŒæœåŠ¡å®ä¾‹çš„ URL æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œå½¢æˆæœ€ç»ˆçš„è·¯ç”±ä¿¡æ¯ã€‚\nåœ¨æœ€åï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª ProductServiceAmbassador ç±»ï¼Œç”¨äºå®ç°å•†å“æœåŠ¡çš„ä»£ç†ã€‚åœ¨ ProductServiceAmbassador ç±»ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰çš„æ–¹å¼æ¥æ³¨å…¥ ProductDiscoveryClient å’Œ ProductRoutingStrategy çš„å®ç°ç±»ã€‚åœ¨ getProductById æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆé€šè¿‡ ProductDiscoveryClient è·å–æœåŠ¡å®ä¾‹åˆ—è¡¨ï¼Œç„¶åä½¿ç”¨ ProductRoutingStrategy é€‰æ‹©ä¸€ä¸ªæœåŠ¡å®ä¾‹ï¼Œå¹¶å°†å•†å“ ID å’ŒæœåŠ¡å®ä¾‹çš„ URL æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œå½¢æˆæœ€ç»ˆçš„è·¯ç”±ä¿¡æ¯ã€‚æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨ RestTemplate å‘é€ HTTP GET è¯·æ±‚ï¼Œå¹¶å°†å“åº”çš„ JSON æ•°æ®è½¬æ¢ä¸º Product å¯¹è±¡è¿”å›ã€‚\nä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å¯ä»¥å®ç°æœåŠ¡å‘ç°å’Œè·¯ç”±ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œæ€§èƒ½ï¼Œä½¿å¾—æœåŠ¡æ¶ˆè´¹è€…æ— éœ€å…³å¿ƒæœåŠ¡å®ä¾‹çš„å…·ä½“ä½ç½®å’Œè´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œåªéœ€è¦é€šè¿‡ä»£ç†å¯¹è±¡æ¥è®¿é—®æœåŠ¡å³å¯ã€‚\næ—¥å¿—è®°å½•å’Œç›‘æ§ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ—¥å¿—è®°å½•å’Œç›‘æ§é€šå¸¸ç”¨äºè·Ÿè¸ªæœåŠ¡çš„è¿è¡ŒçŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡ï¼Œä»¥ä¾¿è¿›è¡Œæ•…éšœæ’é™¤å’Œæ€§èƒ½ä¼˜åŒ–ã€‚ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å¯ä»¥å°†æ—¥å¿—è®°å½•å’Œç›‘æ§éƒ¨ç½²åœ¨åº”ç”¨ç¨‹åºçš„å‰ç«¯ï¼Œç›‘æ§æœåŠ¡çš„è¿è¡ŒçŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡ï¼Œä»è€Œå®ç°æ•…éšœæ’é™¤å’Œæ€§èƒ½ä¼˜åŒ–ã€‚\nä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å®ç°æ—¥å¿—è®°å½•å’Œç›‘æ§çš„ Java ç¤ºä¾‹ä»£ç ï¼š\npublic interface ProductService { Product getProductById(String id); } public class Product { private String id; private String name; public Product(String id, String name) { this.id = id; this.name = name; } public String getId() { return id; } public String getName() { return name; } public void setName(String name) { this.name = name; } } public interface ProductLogger { void logRequest(String id); void logResponse(String id, Product product); } public class ProductLoggerImpl implements ProductLogger { private final Logger logger = LoggerFactory.getLogger(ProductLoggerImpl.class); @Override public void logRequest(String id) { logger.info(\u0026#34;Requesting product with ID: {}\u0026#34;, id); } @Override public void logResponse(String id, Product product) { logger.info(\u0026#34;Received product with ID: {}, Name: {}\u0026#34;, id, product.getName()); } } public interface ProductMonitor { void recordLatency(String id, long latency); void incrementCounter(String id); } public class ProductMonitorImpl implements ProductMonitor { private final StatsDClient statsd; public ProductMonitorImpl(String host, int port) { this.statsd = new NonBlockingStatsDClient(\u0026#34;product-service\u0026#34;, host, port); } @Override public void recordLatency(String id, long latency) { statsd.recordExecutionTime(\u0026#34;product.latency\u0026#34;, latency, \u0026#34;id:\u0026#34; + id); } @Override public void incrementCounter(String id) { statsd.increment(\u0026#34;product.counter\u0026#34;, \u0026#34;id:\u0026#34; + id); } } public class ProductServiceAmbassador implements ProductService { private final ProductService productService; private final ProductLogger logger; private final ProductMonitor monitor; public ProductServiceAmbassador(ProductService productService, ProductLogger logger, ProductMonitor monitor) { this.productService = productService; this.logger = logger; this.monitor = monitor; } @Override public Product getProductById(String id) { logger.logRequest(id); long startTime = System.currentTimeMillis(); Product product = productService.getProductById(id); long endTime = System.currentTimeMillis(); logger.logResponse(id, product); long latency = endTime - startTime; monitor.recordLatency(id, latency); monitor.incrementCounter(id); return product; } } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª ProductService æ¥å£å’Œä¸€ä¸ª Product ç±»ï¼Œç”¨äºè¡¨ç¤ºå•†å“æœåŠ¡å’Œå•†å“ä¿¡æ¯ã€‚ç„¶åï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª ProductLogger æ¥å£å’Œä¸€ä¸ª ProductLoggerImpl ç±»ï¼Œç”¨äºè®°å½•è¯·æ±‚å’Œå“åº”çš„æ—¥å¿—ä¿¡æ¯ã€‚åœ¨ ProductLoggerImpl ç±»ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† SLF4J æ—¥å¿—æ¡†æ¶æ¥è®°å½•æ—¥å¿—ä¿¡æ¯ã€‚\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª ProductMonitor æ¥å£å’Œä¸€ä¸ª ProductMonitorImpl ç±»ï¼Œç”¨äºè®°å½•è¿è¡ŒçŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡ã€‚åœ¨ ProductMonitorImpl ç±»ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† StatsD å®¢æˆ·ç«¯æ¥è®°å½•è¿è¡ŒçŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡ï¼Œä¾‹å¦‚è¯·æ±‚çš„å»¶è¿Ÿå’Œè°ƒç”¨æ¬¡æ•°ç­‰ã€‚åœ¨ ProductMonitorImpl çš„æ„é€ å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®š StatsD å®¢æˆ·ç«¯çš„ä¸»æœºå’Œç«¯å£ã€‚\næœ€åï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª ProductServiceAmbassador ç±»ï¼Œç”¨äºå®ç°å•†å“æœåŠ¡çš„ä»£ç†ã€‚åœ¨ ProductServiceAmbassador ç±»ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰çš„æ–¹å¼å°† ProductServiceã€ProductLogger å’Œ ProductMonitor çš„å®ç°ç±»æ³¨å…¥åˆ°æ„é€ å‡½æ•°ä¸­ã€‚åœ¨ getProductById æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆè°ƒç”¨ ProductLogger çš„ logRequest æ–¹æ³•æ¥è®°å½•è¯·æ±‚çš„æ—¥å¿—ä¿¡æ¯ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ System.currentTimeMillis() æ¥è®°å½•è¯·æ±‚çš„å¼€å§‹æ—¶é—´ï¼Œç„¶åè°ƒç”¨ ProductService çš„ getProductById æ–¹æ³•æ¥è·å–å•†å“ä¿¡æ¯ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ System.currentTimeMillis() æ¥è®°å½•è¯·æ±‚çš„ç»“æŸæ—¶é—´ï¼Œå¹¶è°ƒç”¨ ProductLogger çš„ logResponse æ–¹æ³•æ¥è®°å½•å“åº”çš„æ—¥å¿—ä¿¡æ¯ã€‚æœ€åï¼Œæˆ‘ä»¬è®¡ç®—è¯·æ±‚çš„å»¶è¿Ÿï¼Œå¹¶è°ƒç”¨ ProductMonitor çš„ recordLatency æ–¹æ³•æ¥è®°å½•è¯·æ±‚çš„å»¶è¿Ÿï¼Œè°ƒç”¨ ProductMonitor çš„ incrementCounter æ–¹æ³•æ¥è®°å½•è°ƒç”¨æ¬¡æ•°ã€‚\nä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å¯ä»¥å°†æ—¥å¿—è®°å½•å’Œç›‘æ§éƒ¨ç½²åœ¨åº”ç”¨ç¨‹åºçš„å‰ç«¯ï¼Œä»è€Œç›‘æ§æœåŠ¡çš„è¿è¡ŒçŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡ï¼Œå¹¶æä¾›å®æ—¶çš„æ•…éšœæ’é™¤å’Œæ€§èƒ½ä¼˜åŒ–ã€‚ç”±äºæ—¥å¿—è®°å½•å’Œç›‘æ§æ˜¯ä¸ä¸šåŠ¡é€»è¾‘è§£è€¦çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥éšæ—¶åœ¨è¿è¡Œæ—¶æ·»åŠ ã€åˆ é™¤æˆ–æ›´æ”¹æ—¥å¿—è®°å½•å’Œç›‘æ§çš„å®ç°ï¼Œè€Œä¸å½±å“åº”ç”¨ç¨‹åºçš„æ­£å¸¸è¿è¡Œã€‚\nå·²çŸ¥ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼é€šå¸¸ç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç”¨äºè§£å†³æœåŠ¡é—´çš„é€šä¿¡é—®é¢˜å’Œè´Ÿè½½å‡è¡¡é—®é¢˜ã€‚è®¸å¤šå¼€æºæ¡†æ¶å’Œå·¥å…·éƒ½ä½¿ç”¨äº† Ambassador æ¨¡å¼æ¥å®ç°æœåŠ¡ä»£ç†å’Œå¢å¼ºç­‰åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ä½¿ç”¨äº† Ambassador æ¨¡å¼çš„å¼€æºæ¡†æ¶å’Œå·¥å…·ï¼š\nIstioï¼šIstio æ˜¯ä¸€ä¸ªæµè¡Œçš„æœåŠ¡ç½‘æ ¼æ¡†æ¶ï¼Œå®ƒä½¿ç”¨äº† Ambassador æ¨¡å¼æ¥å®ç°æœåŠ¡ä»£ç†å’Œå¢å¼ºç­‰åŠŸèƒ½ï¼Œä¾‹å¦‚æµé‡ç®¡ç†ã€å®‰å…¨è®¤è¯ã€ç›‘æ§å’Œæ—¥å¿—ç­‰ã€‚ Envoyï¼šEnvoy æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ä»£ç†æœåŠ¡å™¨ï¼Œå®ƒä½¿ç”¨äº† Ambassador æ¨¡å¼æ¥å®ç°è´Ÿè½½å‡è¡¡ã€æµé‡è½¬å‘å’ŒæœåŠ¡ä»£ç†ç­‰åŠŸèƒ½ã€‚ Linkerdï¼šLinkerd æ˜¯å¦ä¸€ä¸ªæµè¡Œçš„æœåŠ¡ç½‘æ ¼æ¡†æ¶ï¼Œå®ƒä½¿ç”¨äº† Ambassador æ¨¡å¼æ¥å®ç°æœåŠ¡ä»£ç†å’Œå¢å¼ºç­‰åŠŸèƒ½ï¼Œä¾‹å¦‚è´Ÿè½½å‡è¡¡ã€æ•…éšœæ¢å¤å’Œæµé‡ç®¡ç†ç­‰ã€‚ Open Service Meshï¼šOpen Service Mesh æ˜¯ä¸€ä¸ªå¼€æºçš„æœåŠ¡ç½‘æ ¼æ¡†æ¶ï¼Œå®ƒä½¿ç”¨äº† Ambassador æ¨¡å¼æ¥å®ç°æœåŠ¡ä»£ç†å’Œå¢å¼ºç­‰åŠŸèƒ½ï¼Œä¾‹å¦‚æµé‡ç®¡ç†ã€å®‰å…¨è®¤è¯å’Œç›‘æ§ç­‰ã€‚ Consulï¼šConsul æ˜¯ä¸€ä¸ªæµè¡Œçš„æœåŠ¡å‘ç°å’Œé…ç½®å·¥å…·ï¼Œå®ƒä½¿ç”¨äº† Ambassador æ¨¡å¼æ¥å®ç°æœåŠ¡ä»£ç†å’Œå¢å¼ºç­‰åŠŸèƒ½ï¼Œä¾‹å¦‚è´Ÿè½½å‡è¡¡ã€å¥åº·æ£€æŸ¥å’Œæ•…éšœæ¢å¤ç­‰ã€‚ Kubernetesï¼šKubernetes æ˜¯ä¸€ä¸ªæµè¡Œçš„å®¹å™¨ç¼–æ’å¹³å°ï¼Œå®ƒä½¿ç”¨äº† Ambassador æ¨¡å¼æ¥å®ç°æœåŠ¡ä»£ç†å’Œå¢å¼ºç­‰åŠŸèƒ½ï¼Œä¾‹å¦‚æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡å’Œæµé‡ç®¡ç†ç­‰ã€‚ Nginxï¼šNginx æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ Web æœåŠ¡å™¨å’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œå®ƒä½¿ç”¨äº† Ambassador æ¨¡å¼æ¥å®ç°è´Ÿè½½å‡è¡¡ã€æµé‡è½¬å‘å’ŒæœåŠ¡ä»£ç†ç­‰åŠŸèƒ½ã€‚ Kongï¼šKong æ˜¯ä¸€ä¸ªå¼€æºçš„ API ç½‘å…³ï¼Œå®ƒä½¿ç”¨äº† Ambassador æ¨¡å¼æ¥å®ç°æµé‡ç®¡ç†ã€å®‰å…¨è®¤è¯å’Œç›‘æ§ç­‰åŠŸèƒ½ã€‚ Traefikï¼šTraefik æ˜¯ä¸€ä¸ªæµè¡Œçš„åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡å™¨ï¼Œå®ƒä½¿ç”¨äº† Ambassador æ¨¡å¼æ¥å®ç°æœåŠ¡ä»£ç†å’Œå¢å¼ºç­‰åŠŸèƒ½ï¼Œä¾‹å¦‚åŠ¨æ€é…ç½®ã€è‡ªåŠ¨å‘ç°å’Œæµé‡è½¬å‘ç­‰ã€‚ å½“ç„¶ï¼ŒJava ç”Ÿæ€ç³»ç»Ÿä¸­ä¹Ÿæœ‰è®¸å¤šå¼€æºæ¡†æ¶å’Œå·¥å…·ä½¿ç”¨äº† Ambassador æ¨¡å¼ã€‚ä»¥ä¸‹æ˜¯å…¶ä¸­çš„ä¸€äº›ï¼š\nSpring Cloud Netflixï¼šSpring Cloud Netflix æ˜¯ä¸€ä¸ªæµè¡Œçš„å¾®æœåŠ¡æ¡†æ¶ï¼Œå®ƒä½¿ç”¨äº† Netflix OSS ä¸­çš„ Ribbon å’Œ Zuul ç»„ä»¶æ¥å®ç°æœåŠ¡ä»£ç†å’Œå¢å¼ºç­‰åŠŸèƒ½ï¼Œä¾‹å¦‚è´Ÿè½½å‡è¡¡ã€æœåŠ¡å‘ç°å’Œè·¯ç”±ç­‰ã€‚ Spring Cloud Gatewayï¼šSpring Cloud Gateway æ˜¯ Spring Cloud ç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¸€ä¸ªæ–°å‹ API ç½‘å…³ï¼Œå®ƒä½¿ç”¨äº† Reactor Netty å’Œ Spring WebFlux ç­‰æŠ€æœ¯æ¥å®ç°æœåŠ¡ä»£ç†å’Œå¢å¼ºç­‰åŠŸèƒ½ï¼Œä¾‹å¦‚è´Ÿè½½å‡è¡¡ã€è·¯ç”±å’Œé™æµç­‰ã€‚ Netflix OSSï¼šNetflix OSS æ˜¯ Netflix å¼€æºçš„ä¸€ç»„åˆ†å¸ƒå¼ç³»ç»Ÿå·¥å…·ï¼Œå…¶ä¸­åŒ…æ‹¬äº†è®¸å¤šä½¿ç”¨äº† Ambassador æ¨¡å¼çš„ç»„ä»¶ï¼Œä¾‹å¦‚ Ribbonã€Hystrixã€Zuul å’Œ Eureka ç­‰ã€‚ Micronautï¼šMicronaut æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ Java æ¡†æ¶ï¼Œå®ƒä½¿ç”¨äº† Netty å’Œ Reactive Streams ç­‰æŠ€æœ¯æ¥å®ç°æœåŠ¡ä»£ç†å’Œå¢å¼ºç­‰åŠŸèƒ½ï¼Œä¾‹å¦‚è´Ÿè½½å‡è¡¡ã€æœåŠ¡å‘ç°å’Œè·¯ç”±ç­‰ã€‚ Vert.xï¼šVert.x æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„å¼‚æ­¥ç¼–ç¨‹æ¡†æ¶ï¼Œå®ƒä½¿ç”¨äº† Netty å’Œ Reactive Streams ç­‰æŠ€æœ¯æ¥å®ç°æœåŠ¡ä»£ç†å’Œå¢å¼ºç­‰åŠŸèƒ½ï¼Œä¾‹å¦‚è´Ÿè½½å‡è¡¡ã€è·¯ç”±å’Œé™æµç­‰ã€‚ Spring Cloud Gateway Spring Cloud Gateway æ˜¯ Spring Cloud ç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¸€ä¸ªæ–°å‹ API ç½‘å…³ï¼Œå®ƒä½¿ç”¨äº† Reactor Netty å’Œ Spring WebFlux ç­‰æŠ€æœ¯æ¥å®ç°æœåŠ¡ä»£ç†å’Œå¢å¼ºç­‰åŠŸèƒ½ã€‚å®ƒçš„è®¾è®¡ç†å¿µå°±æ˜¯åŸºäº Ambassador æ¨¡å¼æ¥æ„å»ºçš„ï¼Œå®ƒå°†æ¯ä¸ªåç«¯æœåŠ¡éƒ½çœ‹ä½œä¸€ä¸ªç‹¬ç«‹çš„å®ä½“ï¼Œé€šè¿‡ä¸€ä¸ªä¸­å¤®å…¥å£ç‚¹æ¥ç»Ÿä¸€ç®¡ç†å’Œæ§åˆ¶ã€‚\nä¸‹é¢é€šè¿‡ä»£ç æ¥è¯´æ˜ Spring Cloud Gateway å¦‚ä½•ä½¿ç”¨ Ambassador æ¨¡å¼ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªåç«¯æœåŠ¡ï¼Œä¸€ä¸ªæ˜¯ user-serviceï¼Œä¸€ä¸ªæ˜¯ order-serviceï¼Œæˆ‘ä»¬å¸Œæœ›é€šè¿‡ Spring Cloud Gateway æ¥å®ç°è´Ÿè½½å‡è¡¡å’Œè·¯ç”±çš„åŠŸèƒ½ã€‚\né¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ  Spring Cloud Gateway ä¾èµ–ï¼Œå¯ä»¥åœ¨ Maven ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-starter-gateway\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; ç„¶åï¼Œæˆ‘ä»¬éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½® Spring Cloud Gatewayï¼Œä¾‹å¦‚ application.yml æ–‡ä»¶ï¼š\nspring: cloud: gateway: routes: - id: user-service uri: lb://user-service predicates: - Path=/users/** - id: order-service uri: lb://order-service predicates: - Path=/orders/** è¿™æ®µé…ç½®ä»£ç çš„æ„æ€æ˜¯ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªè·¯ç”±è§„åˆ™ï¼Œä¸€ä¸ªæ˜¯å¯¹äº /users/** çš„è¯·æ±‚ï¼Œå°†ä¼šè¢«è·¯ç”±åˆ° user-service æœåŠ¡ä¸Šï¼Œå¦ä¸€ä¸ªæ˜¯å¯¹äº /orders/** çš„è¯·æ±‚ï¼Œå°†ä¼šè¢«è·¯ç”±åˆ° order-service æœåŠ¡ä¸Šã€‚å…¶ä¸­ï¼Œuri å‰ç¼€çš„ lb:// è¡¨ç¤ºä½¿ç”¨è´Ÿè½½å‡è¡¡çš„æ–¹å¼æ¥è·¯ç”±è¯·æ±‚ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† Spring Cloud LoadBalancer ç»„ä»¶æ¥å®ç°è´Ÿè½½å‡è¡¡çš„åŠŸèƒ½ã€‚\næœ€åï¼Œæˆ‘ä»¬éœ€è¦åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ  @EnableGateway æ³¨è§£ï¼Œæ¥å¯ç”¨ Spring Cloud Gatewayï¼š\n@SpringBootApplication @EnableDiscoveryClient @EnableGateway public class GatewayApplication { public static void main(String[] args) { SpringApplication.run(GatewayApplication.class, args); } } è¿™æ ·ï¼Œæˆ‘ä»¬å°±å®Œæˆäº† Spring Cloud Gateway çš„é…ç½®å’Œå¯ç”¨ã€‚é€šè¿‡ä»¥ä¸Šçš„é…ç½®å’Œä»£ç ï¼Œæˆ‘ä»¬å®ç°äº† Ambassador æ¨¡å¼çš„åŸºæœ¬åŠŸèƒ½ï¼Œå³é€šè¿‡ä¸€ä¸ªä¸­å¤®å…¥å£ç‚¹æ¥ç»Ÿä¸€ç®¡ç†å’Œæ§åˆ¶åç«¯æœåŠ¡ã€‚åŒæ—¶ï¼Œç”±äº Spring Cloud Gateway åŸºäº Reactor Netty å’Œ Spring WebFlux ç­‰æŠ€æœ¯å®ç°ï¼Œå®ƒä¹Ÿå…·æœ‰éå¸¸é«˜çš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§ã€‚\nSpring Cloud Gateway æºç ä¸­çš„å®ç°æ–¹å¼ï¼Œä¸»è¦æ˜¯åŸºäº Reactor Netty å’Œ Spring WebFlux æ¡†æ¶æ¥å®ç°çš„ã€‚å®ƒçš„æ ¸å¿ƒç»„ä»¶æ˜¯ GatewayFilter å’Œ RouteLocatorï¼Œå…¶ä¸­ GatewayFilter ç”¨äºå®ç°å„ç§è¿‡æ»¤å™¨ï¼Œä¾‹å¦‚è¯·æ±‚è½¬å‘ã€é‡å®šå‘ã€é™æµå’Œè®¤è¯ç­‰ï¼Œè€Œ RouteLocator ç”¨äºå®ç°åŠ¨æ€è·¯ç”±å’Œè´Ÿè½½å‡è¡¡ç­‰åŠŸèƒ½ã€‚\nå…·ä½“æ¥è¯´ï¼ŒSpring Cloud Gateway çš„å·¥ä½œåŸç†å¦‚ä¸‹ï¼š\nSpring Cloud Gateway æ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œç„¶åæ ¹æ®é…ç½®æ–‡ä»¶ä¸­çš„è·¯ç”±è§„åˆ™ï¼Œé€‰æ‹©ä¸€ä¸ªåˆé€‚çš„è·¯ç”±å™¨è¿›è¡Œå¤„ç†ã€‚ è·¯ç”±å™¨ä¼šæ ¹æ®è¯·æ±‚çš„ URL å’Œé…ç½®æ–‡ä»¶ä¸­çš„è·¯ç”±è§„åˆ™ï¼Œé€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªè¿‡æ»¤å™¨å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ã€‚è¿‡æ»¤å™¨å¯ä»¥é€‰æ‹©æ€§åœ°ä¿®æ”¹è¯·æ±‚å’Œå“åº”ï¼Œæˆ–è€…ä¸­æ–­è¯·æ±‚å¹¶è¿”å›å“åº”ã€‚ è¿‡æ»¤å™¨å°†å¤„ç†åçš„è¯·æ±‚å‘é€åˆ°åç«¯æœåŠ¡ï¼Œç„¶åå°†å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ åœ¨å¤„ç†è¯·æ±‚å’Œå“åº”çš„è¿‡ç¨‹ä¸­ï¼ŒSpring Cloud Gateway æ”¯æŒå¤šç§åè®®å’Œæ ¼å¼ï¼Œä¾‹å¦‚ HTTPã€WebSocketã€JSON å’Œ XML ç­‰ã€‚ åœ¨ Spring Cloud Gateway çš„æºç ä¸­ï¼Œå®ƒçš„æ ¸å¿ƒç»„ä»¶æ˜¯ GatewayFilter å’Œ RouteLocatorã€‚å…¶ä¸­ï¼ŒGatewayFilter æ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨æ¥å£ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªè¿‡æ»¤å™¨çš„åŸºæœ¬æ–¹æ³•é“¾ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡å®ç° GatewayFilter æ¥å£æ¥å®ç°è‡ªå®šä¹‰çš„è¿‡æ»¤å™¨ã€‚è€Œ RouteLocator åˆ™æ˜¯ä¸€ä¸ªè·¯ç”±è§„åˆ™æ¥å£ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªåŠ¨æ€è·¯ç”±è¡¨ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡å®ç° RouteLocator æ¥å£æ¥å®ç°è‡ªå®šä¹‰çš„è·¯ç”±è§„åˆ™ï¼Œä¾‹å¦‚åŸºäºæœåŠ¡å‘ç°çš„è·¯ç”±è§„åˆ™ã€‚\nSpring Cloud Gateway æ”¯æŒ WebSocket åè®®ã€‚WebSocket æ˜¯ä¸€ç§åœ¨å•ä¸ª TCP è¿æ¥ä¸Šè¿›è¡Œå…¨åŒå·¥é€šä¿¡çš„åè®®ï¼Œå®ƒå…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œå®æ—¶äº¤äº’å’Œé€šä¿¡ã€‚Spring Cloud Gateway é€šè¿‡æ”¯æŒ WebSocket åè®®ï¼Œå¯ä»¥å®ç°å®æ—¶é€šä¿¡ã€æ¨é€å’Œå¹¿æ’­ç­‰åŠŸèƒ½ã€‚\nè¦åœ¨ Spring Cloud Gateway ä¸­æ”¯æŒ WebSocket åè®®ï¼Œéœ€è¦è¿›è¡Œä»¥ä¸‹æ­¥éª¤ï¼š\nå¼•å…¥ Spring Cloud Gateway WebSocket ä¾èµ–ï¼Œå¯ä»¥åœ¨ Maven ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-starter-gateway-websocket\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; é…ç½® Spring Cloud Gatewayï¼Œéœ€è¦åœ¨ application.yml æˆ– application.properties æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š\nspring: cloud: gateway: websockets: enabled: true è¿™æ®µé…ç½®ä»£ç çš„æ„æ€æ˜¯ï¼Œå¯ç”¨ Spring Cloud Gateway çš„ WebSocket æ”¯æŒã€‚ é…ç½® WebSocket è·¯ç”±ï¼Œéœ€è¦åœ¨ application.yml æˆ– application.properties æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š\nspring: cloud: gateway: routes: - id: ws-route uri: ws://localhost:8080 predicates: - Path=/ws/** è¿™æ®µé…ç½®ä»£ç çš„æ„æ€æ˜¯ï¼Œå°† /ws/** çš„è¯·æ±‚è·¯ç”±åˆ° uri ä¸º ws://localhost:8080 çš„ WebSocket æœåŠ¡ä¸Šã€‚\nå®ç° WebSocket å¤„ç†å™¨ï¼Œéœ€è¦ç¼–å†™ä¸€ä¸ªå®ç° WebSocketHandler æ¥å£çš„å¤„ç†å™¨ï¼Œä¾‹å¦‚ï¼š\n@Component public class EchoWebSocketHandler implements WebSocketHandler { @Override public Mono\u0026lt;Void\u0026gt; handle(WebSocketSession session) { // å¤„ç† WebSocketSession return session.send(session.receive().map(msg -\u0026gt; session.textMessage(\u0026#34;Echo: \u0026#34; + msg.getPayloadAsText()))); } } è¿™æ®µä»£ç çš„æ„æ€æ˜¯ï¼Œå®ç°ä¸€ä¸ªå¤„ç†å™¨ï¼Œç”¨æ¥å¤„ç† WebSocketSessionã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œå¤„ç†å™¨ä¼šå°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯è¿›è¡Œå›æ˜¾ï¼Œå¹¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚\né…ç½® WebSocket å¤„ç†å™¨ï¼Œéœ€è¦åœ¨ application.yml æˆ– application.properties æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š\nspring: cloud: gateway: routes: - id: ws-route uri: ws://localhost:8080 predicates: - Path=/ws/** filters: - name: WebSocket args: handler: echoWebSocketHandler subprotocols: subprotocol1, subprotocol2 è¿™æ®µé…ç½®ä»£ç çš„æ„æ€æ˜¯ï¼Œå°† WebSocket å¤„ç†å™¨ echoWebSocketHandler ç»‘å®šåˆ° WebSocket è·¯ç”±ä¸Šï¼Œå¹¶æŒ‡å®šäº†å­åè®® subprotocol1 å’Œ subprotocol2ã€‚\nè¿™æ ·ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†åœ¨ Spring Cloud Gateway ä¸­æ”¯æŒ WebSocket åè®®çš„é…ç½®å’Œä»£ç å®ç°ã€‚é€šè¿‡ä»¥ä¸Šçš„é…ç½®å’Œä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Spring Cloud Gateway ä¸Šå®ç° WebSocket çš„åŠŸèƒ½ï¼Œä¾‹å¦‚å®æ—¶é€šä¿¡ã€æ¨é€å’Œå¹¿æ’­ç­‰ã€‚\nç›¸å…³æ¨¡å¼ Proxy å…¶ä»– Ambassador å’Œ AOP Ambassador è®¾è®¡æ¨¡å¼å’Œ AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰éƒ½æ˜¯ç”¨äºå®ç°æ¨ªåˆ‡å…³æ³¨ç‚¹çš„è®¾è®¡æ¨¡å¼ã€‚å®ƒä»¬éƒ½å¯ä»¥åœ¨ä¸ä¿®æ”¹ç°æœ‰ä»£ç çš„æƒ…å†µä¸‹ï¼Œå¾€ç¨‹åºä¸­æ·»åŠ ä¸€äº›é¢å¤–çš„è¡Œä¸ºï¼Œä¾‹å¦‚æ—¥å¿—è®°å½•ã€æ€§èƒ½ç›‘æ§ã€å®‰å…¨éªŒè¯ç­‰ã€‚\nAmbassador è®¾è®¡æ¨¡å¼æ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒé€šè¿‡ä»£ç†å¯¹è±¡æ¥éšè—åº•å±‚æœåŠ¡çš„å®ç°ç»†èŠ‚ï¼Œå¹¶æä¾›ä¸€äº›é¢å¤–çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€æ—¥å¿—è®°å½•å’Œç›‘æ§ç­‰ã€‚åœ¨ Ambassador è®¾è®¡æ¨¡å¼ä¸­ï¼Œä»£ç†å¯¹è±¡å’ŒåŸå§‹å¯¹è±¡éƒ½å®ç°äº†åŒä¸€ä¸ªæ¥å£ï¼Œä»£ç†å¯¹è±¡è´Ÿè´£å°†è°ƒç”¨è½¬å‘åˆ°åŸå§‹å¯¹è±¡ï¼Œå¹¶åœ¨è°ƒç”¨å‰åæ‰§è¡Œä¸€äº›é¢å¤–çš„é€»è¾‘ã€‚\nAOP ä¹Ÿæ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒé€šè¿‡å°†æ¨ªåˆ‡å…³æ³¨ç‚¹ä»ä¸šåŠ¡é€»è¾‘ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå®ç°äº†ä¸€ç§åŸºäºåˆ‡é¢çš„æ¨¡å—åŒ–è®¾è®¡ã€‚åœ¨ AOP ä¸­ï¼Œæ¨ªåˆ‡å…³æ³¨ç‚¹è¢«å°è£…æˆåˆ‡é¢ï¼Œå¹¶é€šè¿‡åˆ‡ç‚¹å’Œé€šçŸ¥æ¥å®šä¹‰åˆ‡é¢çš„è¡Œä¸ºã€‚åœ¨ç¨‹åºè¿è¡ŒæœŸé—´ï¼ŒAOP æ¡†æ¶ä¼šåŠ¨æ€åœ°å°†åˆ‡é¢ç»‡å…¥åˆ°ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨ä¸­ï¼Œä»è€Œå®ç°åˆ‡é¢çš„åŠŸèƒ½ã€‚\nè™½ç„¶ Ambassador è®¾è®¡æ¨¡å¼å’Œ AOP éƒ½å¯ä»¥å®ç°æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œä½†å®ƒä»¬çš„åº”ç”¨åœºæ™¯å’Œç›®çš„ç•¥æœ‰ä¸åŒã€‚Ambassador è®¾è®¡æ¨¡å¼é€šå¸¸ç”¨äºå®ç°ä¸åº•å±‚æœåŠ¡ç›¸å…³çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€æ—¥å¿—è®°å½•å’Œç›‘æ§ç­‰ã€‚è€Œ AOP åˆ™æ›´åŠ é€šç”¨ï¼Œå¯ä»¥ç”¨äºå®ç°ä»»ä½•ä¸ä¸šåŠ¡é€»è¾‘æ— å…³çš„åŠŸèƒ½ï¼Œä¾‹å¦‚äº‹åŠ¡ç®¡ç†ã€å®‰å…¨éªŒè¯ã€æ€§èƒ½ç›‘æ§ç­‰ã€‚æ­¤å¤–ï¼ŒAOP è¿˜å¯ä»¥é€šè¿‡åˆ‡é¢çš„ç»‡å…¥é¡ºåºæ¥å®ç°ä¸€äº›å¤æ‚çš„åŠŸèƒ½ï¼Œä¾‹å¦‚äº‹åŠ¡åµŒå¥—å’Œå¹¶å‘æ§åˆ¶ç­‰ã€‚\nåœ¨å®è·µä¸­ï¼ŒAmbassador è®¾è®¡æ¨¡å¼å’Œ AOP å¯ä»¥ç»“åˆä½¿ç”¨ï¼Œä»è€Œå®ç°æ›´åŠ çµæ´»å’Œå¯æ‰©å±•çš„åº”ç”¨ç¨‹åºè®¾è®¡ã€‚ä¾‹å¦‚ï¼Œåœ¨ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å®ç°æœåŠ¡è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ AOP æ¥è®°å½•è¯·æ±‚å’Œå“åº”çš„æ—¥å¿—ä¿¡æ¯ï¼Œæˆ–è€…å®ç°å®‰å…¨éªŒè¯å’Œæ€§èƒ½ç›‘æ§ç­‰åŠŸèƒ½ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒAmbassador è®¾è®¡æ¨¡å¼å’Œ AOP é€šå¸¸æ˜¯ç›¸äº’è¡¥å……çš„ï¼Œå¯ä»¥åœ¨ä¸åŒçš„å±‚æ¬¡ä¸Šå®ç°æ¨ªåˆ‡å…³æ³¨ç‚¹çš„åŠŸèƒ½ã€‚\nAmbassador å’Œä»£ç† Ambassador è®¾è®¡æ¨¡å¼å’Œä»£ç†æ¨¡å¼éƒ½æ˜¯ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒä»¬éƒ½ä½¿ç”¨ä»£ç†å¯¹è±¡æ¥éšè—çœŸå®å¯¹è±¡çš„å®ç°ç»†èŠ‚ï¼Œå¹¶æä¾›ä¸€äº›é¢å¤–çš„åŠŸèƒ½ã€‚ç„¶è€Œï¼Œå®ƒä»¬çš„ç›®çš„å’Œå®ç°æ–¹å¼ç•¥æœ‰ä¸åŒã€‚\nä»£ç†æ¨¡å¼æ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒé€šè¿‡ä»£ç†å¯¹è±¡æ¥æ§åˆ¶å¯¹çœŸå®å¯¹è±¡çš„è®¿é—®ã€‚åœ¨ä»£ç†æ¨¡å¼ä¸­ï¼Œä»£ç†å¯¹è±¡å’ŒçœŸå®å¯¹è±¡å®ç°ç›¸åŒçš„æ¥å£ï¼Œä»£ç†å¯¹è±¡è´Ÿè´£å°†æ–¹æ³•è°ƒç”¨ä¼ é€’ç»™çœŸå®å¯¹è±¡ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ ä¸€äº›é¢å¤–çš„é€»è¾‘ï¼Œä¾‹å¦‚æƒé™æ§åˆ¶ã€ç¼“å­˜ã€è¿œç¨‹è®¿é—®ç­‰ã€‚ä»£ç†æ¨¡å¼å¯ä»¥åœ¨ä¸ä¿®æ”¹ç°æœ‰ä»£ç çš„æƒ…å†µä¸‹ï¼Œä¸ºçœŸå®å¯¹è±¡æä¾›é¢å¤–çš„åŠŸèƒ½å’Œä¿æŠ¤ã€‚\nAmbassador è®¾è®¡æ¨¡å¼ä¹Ÿæ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒé€šè¿‡ä»£ç†å¯¹è±¡æ¥éšè—åº•å±‚æœåŠ¡çš„å®ç°ç»†èŠ‚ï¼Œå¹¶æä¾›ä¸€äº›é¢å¤–çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€æ—¥å¿—è®°å½•å’Œç›‘æ§ç­‰ã€‚åœ¨ Ambassador è®¾è®¡æ¨¡å¼ä¸­ï¼Œä»£ç†å¯¹è±¡å’Œåº•å±‚æœåŠ¡å®ç°ç›¸åŒçš„æ¥å£ï¼Œä»£ç†å¯¹è±¡è´Ÿè´£å°†è°ƒç”¨è½¬å‘åˆ°åº•å±‚æœåŠ¡ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ ä¸€äº›é¢å¤–çš„é€»è¾‘ã€‚Ambassador è®¾è®¡æ¨¡å¼é€šå¸¸ç”¨äºå®ç°ä¸åº•å±‚æœåŠ¡ç›¸å…³çš„åŠŸèƒ½ã€‚\nAmbassador è®¾è®¡æ¨¡å¼å’Œä»£ç†æ¨¡å¼åœ¨æŸäº›æ–¹é¢ç¡®å®éå¸¸ç›¸ä¼¼ï¼Œå®ƒä»¬éƒ½ä½¿ç”¨ä»£ç†å¯¹è±¡æ¥éšè—çœŸå®å¯¹è±¡çš„å®ç°ç»†èŠ‚ï¼Œå¹¶æä¾›ä¸€äº›é¢å¤–çš„åŠŸèƒ½ã€‚ç„¶è€Œï¼Œå®ƒä»¬çš„ç›®çš„å’Œåº”ç”¨åœºæ™¯ç•¥æœ‰ä¸åŒï¼Œè¿™ä¹Ÿæ˜¯å®ƒä»¬çš„åŒºåˆ«æ‰€åœ¨ã€‚\nä»£ç†æ¨¡å¼é€šå¸¸ç”¨äºæ§åˆ¶å¯¹çœŸå®å¯¹è±¡çš„è®¿é—®ï¼Œä¾‹å¦‚æƒé™æ§åˆ¶ã€ç¼“å­˜ã€è¿œç¨‹è®¿é—®ç­‰ã€‚å®ƒçš„é‡ç‚¹åœ¨äºå®ç°å¯¹çœŸå®å¯¹è±¡çš„ä¿æŠ¤å’Œæ§åˆ¶ã€‚ä»£ç†æ¨¡å¼çš„åº”ç”¨åœºæ™¯éå¸¸å¹¿æ³›ï¼Œå¯ä»¥ç”¨äºä»»ä½•éœ€è¦å¯¹çœŸå®å¯¹è±¡è¿›è¡Œè®¿é—®æ§åˆ¶å’Œä¿æŠ¤çš„åœºæ™¯ã€‚\nAmbassador è®¾è®¡æ¨¡å¼åˆ™æ›´åŠ ä¸“æ³¨äºåº•å±‚æœåŠ¡çš„ä»£ç†å’Œå¢å¼ºï¼Œä¾‹å¦‚æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€æ—¥å¿—è®°å½•å’Œç›‘æ§ç­‰ã€‚å®ƒé€šå¸¸ç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç”¨äºè§£å†³æœåŠ¡é—´çš„é€šä¿¡é—®é¢˜å’Œè´Ÿè½½å‡è¡¡é—®é¢˜ã€‚Ambassador è®¾è®¡æ¨¡å¼çš„é‡ç‚¹åœ¨äºä¸ºåº•å±‚æœåŠ¡æä¾›ä»£ç†å’Œå¢å¼ºåŠŸèƒ½ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç®¡ç†å’Œæ§åˆ¶åº•å±‚æœåŠ¡ã€‚\nè™½ç„¶ Ambassador è®¾è®¡æ¨¡å¼å’Œä»£ç†æ¨¡å¼åœ¨æŸäº›æ–¹é¢éå¸¸ç›¸ä¼¼ï¼Œä½†å®ƒä»¬åœ¨å®é™…åº”ç”¨ä¸­é€šå¸¸è¢«ç”¨äºä¸åŒçš„åœºæ™¯å’Œç›®çš„ã€‚åœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å…·ä½“çš„éœ€æ±‚å’Œåº”ç”¨åœºæ™¯æ¥é€‰æ‹©ä½¿ç”¨å“ªç§æ¨¡å¼ï¼Œæˆ–è€…å°†å®ƒä»¬ç»“åˆèµ·æ¥ä½¿ç”¨ï¼Œä»¥å®ç°æ›´åŠ çµæ´»å’Œå¯æ‰©å±•çš„åº”ç”¨ç¨‹åºè®¾è®¡ã€‚\nå‚è€ƒæ–‡ç«  Ambassador Pattern: è¯¥æ–‡ç« ä»‹ç»äº† Ambassador æ¨¡å¼çš„æ¦‚å¿µå’Œåº”ç”¨åœºæ™¯ï¼Œå¹¶æä¾›äº†ä¸€äº›å®é™…æ¡ˆä¾‹ä¾›å‚è€ƒã€‚ Design Patterns for Microservices: Ambassador, Anti-Corruption Layer, and Backends for Frontends : è¿™ç¯‡æ–‡ç« ä»‹ç»äº†åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ä½¿ç”¨çš„ä¸¤ç§è®¾è®¡æ¨¡å¼ï¼šAmbassador æ¨¡å¼å’Œ Anti-corruption Layer æ¨¡å¼ã€‚ã€‚ The Ambassador pattern and Istio: è¿™ç¯‡æ–‡ç« ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ Istio å’Œ Ambassador æ¨¡å¼æ¥å®ç°å¾®æœåŠ¡çš„è¾¹ç¼˜ä»£ç†å’ŒæœåŠ¡ç½‘æ ¼ã€‚ Kubernetes â€” Learn Ambassador Container Pattern ä»‹ç»äº†å¦‚ä½•åœ¨ Kubernetes ä¸­ä½¿ç”¨ Ambassador æ¨¡å¼æ¥è§£å†³å¾®æœåŠ¡é€šä¿¡çš„é—®é¢˜ã€‚ Ambassador vs API Gateway: è¯¥æ–‡ç« å¯¹æ¯”äº† Ambassador æ¨¡å¼å’Œä¼ ç»Ÿçš„ API ç½‘å…³çš„ä¼˜ç¼ºç‚¹ï¼Œåˆ†æäº†å®ƒä»¬åœ¨ä¸åŒåœºæ™¯ä¸‹çš„åº”ç”¨å’Œé€‚ç”¨æ€§ã€‚ ","permalink":"https://blog.chensoul.cc/posts/2023/07/06/java-design-patterns-ambassador/","summary":"æœ¬æ–‡ä¸»è¦ä»‹ç» Ambassador æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nJava Design Patterns æä¾›äº†å„ç§ Java è®¾è®¡æ¨¡å¼çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ã€‚è¯¥ç½‘ç«™æ—¨åœ¨å¸®åŠ© Java å¼€å‘äººå‘˜äº†è§£å’Œåº”ç”¨å„ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚\nJava Design Patterns ç½‘ç«™æä¾›äº†å¤šç§è®¾è®¡æ¨¡å¼åˆ†ç±»æ–¹å¼ï¼ŒåŒ…æ‹¬åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational Patternsï¼‰ã€ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternsï¼‰å’Œè¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰ï¼Œä»¥åŠå…¶ä»–ä¸€äº›å¸¸è§çš„æ¨¡å¼ã€‚\nå¯¹äºæ¯ä¸ªè®¾è®¡æ¨¡å¼ï¼Œè¯¥ç½‘ç«™æä¾›äº†è¯¦ç»†çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ï¼Œå¹¶ä¸”æä¾›äº†ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ã€‚å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©é€‚åˆè‡ªå·±çš„è®¾è®¡æ¨¡å¼ï¼Œå¹¶ä¸”å¯ä»¥å‚è€ƒç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜æ¥ç†è§£å’Œåº”ç”¨è¯¥æ¨¡å¼ã€‚\næ­¤å¤–ï¼ŒJava Design Patterns ç½‘ç«™è¿˜æä¾›äº†ä¸€äº›å…¶ä»–èµ„æºï¼Œå¦‚è®¾è®¡æ¨¡å¼çš„ UML å›¾ã€è®¾è®¡æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ã€è®¾è®¡æ¨¡å¼çš„æ¯”è¾ƒç­‰ã€‚è¿™äº›èµ„æºå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨è®¾è®¡æ¨¡å¼ã€‚\nä¸­æ–‡ç½‘ç«™ï¼šhttps://java-design-patterns.com/zh/\nGithub ä¸Šæºç ä»“åº“ï¼ˆéå®˜æ–¹ï¼‰ï¼šhttps://github.com/iluwatar/java-design-patterns\nç›®çš„ åœ¨å®¢æˆ·ç«¯ä¸Šæä¾›å¸®åŠ©ç¨‹åºæœåŠ¡å®ä¾‹ï¼Œå¹¶ä»å…±äº«èµ„æºä¸Šè½¬ç§»å¸¸ç”¨åŠŸèƒ½ã€‚\nAmbassador è®¾è®¡æ¨¡å¼çš„ä¸»è¦ç›®çš„æ˜¯å°†å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¸è¿œç¨‹æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ç»†èŠ‚éš”ç¦»å¼€æ¥ï¼Œä»è€Œä½¿å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå¯ä»¥ä¸“æ³¨äºè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸å¿…å…³æ³¨ç½‘ç»œé€šä¿¡ç»†èŠ‚å’Œé”™è¯¯å¤„ç†ã€‚\nåœ¨ä¼ ç»Ÿçš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¸­ï¼Œé€šå¸¸éœ€è¦å¤„ç†å¤§é‡çš„ç½‘ç»œé€šä¿¡ç»†èŠ‚å’Œé”™è¯¯å¤„ç†ï¼Œè¿™ä¼šä½¿ä»£ç å˜å¾—å¤æ‚ä¸”éš¾ä»¥ç»´æŠ¤ã€‚è€Œä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å¯ä»¥å°†è¿™äº›ç»†èŠ‚å’Œå¤„ç†é€»è¾‘é›†ä¸­åœ¨ä¸€ä¸ªå•ç‹¬çš„ç±»ä¸­ï¼Œä»è€Œä½¿å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºçš„ä»£ç æ›´åŠ ç®€æ´ã€æ˜“äºç»´æŠ¤å’Œæ‰©å±•ã€‚\næ­¤å¤–ï¼Œä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼è¿˜å¯ä»¥æé«˜å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¸è¿œç¨‹æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡å®‰å…¨æ€§å’Œå¯é æ€§ã€‚ä¾‹å¦‚ï¼ŒAmbassador ç±»å¯ä»¥è´Ÿè´£ç»Ÿä¸€å¤„ç†æ‰€æœ‰çš„ç½‘ç»œé€šä¿¡ï¼Œä»è€Œå¯ä»¥æ›´è½»æ¾åœ°å®ç°å®‰å…¨æ€§å’Œå¯é æ€§æ§åˆ¶ã€‚\nè§£é‡Š å‡è®¾æœ‰ä¸€ä¸ªæ—§ç‰ˆçš„è¿œç¨‹æœåŠ¡ï¼Œè¯¥æœåŠ¡æä¾›äº†è®¸å¤šå®¢æˆ·ç«¯è®¿é—®çš„åŠŸèƒ½ï¼Œä½†ç”±äºç”¨æˆ·çš„å¤§é‡è¯·æ±‚ï¼Œå¯¼è‡´è¿æ¥é—®é¢˜å˜å¾—æ™®éã€‚æ­¤å¤–ï¼Œæ–°çš„è¯·æ±‚é¢‘ç‡è§„åˆ™éœ€è¦åŒæ—¶å®ç°å»¶è¿Ÿæ£€æµ‹å’Œå®¢æˆ·ç«¯æ—¥å¿—åŠŸèƒ½ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼ã€‚\nå¾®è½¯æ–‡æ¡£ åšäº†å¦‚ä¸‹é˜è¿°\nå¯ä»¥å°†å¤§ä½¿æœåŠ¡è§†ä¸ºä¸å®¢æˆ·ç«¯ä½äºåŒä¸€ä½ç½®çš„è¿›ç¨‹å¤–ä»£ç†ã€‚ æ­¤æ¨¡å¼å¯¹äºä»¥è¯­è¨€ä¸å¯çŸ¥çš„æ–¹å¼å‡è½»å¸¸è§çš„å®¢æˆ·ç«¯è¿æ¥ä»»åŠ¡ï¼ˆä¾‹å¦‚ç›‘è§†ï¼Œæ—¥å¿—è®°å½•ï¼Œè·¯ç”±ï¼Œå®‰å…¨æ€§ï¼ˆå¦‚ TLSï¼‰å’Œå¼¹æ€§æ¨¡å¼ï¼‰çš„å·¥ä½œå¾ˆæœ‰ç”¨ã€‚ å®ƒé€šå¸¸ä¸æ—§ç‰ˆåº”ç”¨ç¨‹åºæˆ–å…¶ä»–éš¾ä»¥ä¿®æ”¹çš„åº”ç”¨ç¨‹åºä¸€èµ·ä½¿ç”¨ï¼Œä»¥æ‰©å±•å…¶ç½‘ç»œåŠŸèƒ½ã€‚ å®ƒè¿˜å¯ä»¥ä½¿ä¸“ä¸šå›¢é˜Ÿå®ç°è¿™äº›åŠŸèƒ½ã€‚\nåœ¨è¯¥æ¨¡å¼ä¸­ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ª Ambassador ç±»æ¥å……å½“å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå’Œè¿œç¨‹æœåŠ¡ä¹‹é—´çš„ä»£ç†ã€‚Ambassador ç±»è´Ÿè´£å¤„ç†æ‰€æœ‰çš„ç½‘ç»œé€šä¿¡ç»†èŠ‚å’Œé”™è¯¯å¤„ç†ï¼Œå¹¶å®ç°æ–°çš„è¯·æ±‚é¢‘ç‡è§„åˆ™ï¼ŒåŒ…æ‹¬å»¶è¿Ÿæ£€æµ‹å’Œå®¢æˆ·ç«¯æ—¥å¿—åŠŸèƒ½ã€‚\nå…·ä½“æ¥è¯´ï¼ŒAmbassador ç±»å¯ä»¥å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š\nå»¶è¿Ÿæ£€æµ‹ï¼šåœ¨è¯·æ±‚åˆ°è¾¾è¿œç¨‹æœåŠ¡ä¹‹å‰ï¼ŒAmbassador ç±»å¯ä»¥æ£€æµ‹è¯·æ±‚çš„æ—¶é—´æˆ³ï¼Œå¹¶è®¡ç®—å‡ºè¯·æ±‚çš„å»¶è¿Ÿæ—¶é—´ã€‚å¦‚æœè¯·æ±‚çš„å»¶è¿Ÿæ—¶é—´è¶…è¿‡äº†é¢„è®¾çš„é˜ˆå€¼ï¼ŒAmbassador ç±»å¯ä»¥å°†è¯·æ±‚æ‹’ç»ã€‚ å®¢æˆ·ç«¯æ—¥å¿—åŠŸèƒ½ï¼šAmbassador ç±»å¯ä»¥è®°å½•è¯·æ±‚çš„æ—¶é—´æˆ³ã€è¯·æ±‚çš„å†…å®¹å’Œå“åº”çš„å†…å®¹ï¼Œå¹¶å°†è¿™äº›ä¿¡æ¯ä¿å­˜åˆ°å®¢æˆ·ç«¯çš„æ—¥å¿—æ–‡ä»¶ä¸­ã€‚è¿™æ ·å¯ä»¥å¸®åŠ©å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºè¿›è¡Œè°ƒè¯•å’Œæ•…éšœæ’é™¤ã€‚ è¿æ¥é—®é¢˜å¤„ç†ï¼šAmbassador ç±»å¯ä»¥ç›‘æ§è¿œç¨‹æœåŠ¡çš„è¿æ¥çŠ¶æ€ï¼Œå¹¶åœ¨è¿æ¥å‡ºç°é—®é¢˜æ—¶è¿›è¡Œè‡ªåŠ¨é‡è¯•ã€‚åŒæ—¶ï¼ŒAmbassador ç±»è¿˜å¯ä»¥å®ç°ä¸€äº›ä¼˜åŒ–ç­–ç•¥ï¼Œä¾‹å¦‚ä½¿ç”¨è¿æ¥æ± ç­‰ï¼Œä»¥æé«˜è¿æ¥çš„å¯é æ€§å’Œæ€§èƒ½ã€‚ ç¨‹åºç¤ºä¾‹\næœ‰äº†ä¸Šé¢çš„ä»‹ç»æˆ‘ä»¬å°†åœ¨è¿™ä¸ªä¾‹å­ä¸­æ¨¡ä»¿åŠŸèƒ½ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ªç”¨è¿œç¨‹æœåŠ¡å®ç°çš„æ¥å£ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å¤§ä½¿æœåŠ¡ã€‚\ninterface RemoteServiceInterface { long doRemoteFunction(int value) throws Exception; } è¡¨ç¤ºä¸ºå•ä¾‹çš„è¿œç¨‹æœåŠ¡ã€‚\npublic class RemoteService implements RemoteServiceInterface { private static final Logger LOGGER = LoggerFactory.getLogger(RemoteService.class); private static RemoteService service = null; static synchronized RemoteService getRemoteService() { if (service == null) { service = new RemoteService(); } return service; } private RemoteService() {} @Override public long doRemoteFunction(int value) { long waitTime = (long) Math.","title":"Javaè®¾è®¡æ¨¡å¼ï¼šAmbassador"},{"content":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-06-19 åˆ° 2023-06-25 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¯»ä¹¦ã€å¥èº«ã€æŠ•èµ„ã€å¸®æœ‹å‹ã€é™ªå®¶äººã€‚\nè¿™å‘¨å› ä¸ºç«¯åˆèŠ‚ï¼Œåªä¸Šä¸‰å¤©ç­ï¼Œæ”¾ä¸‰å¤©å‡ã€‚ç¥æ„¿æ‰€æœ‰çˆ¶æ¯ç«¯åˆå®‰åº·ï¼\nè¯»ä¹¦ æœ¬å‘¨é˜…è¯»æ—¶é•¿ 15 åˆ†é’Ÿï¼Œä¸»è¦æ˜¯é˜…è¯»ã€ŠJava é«˜å¹¶å‘æ ¸å¿ƒç¼–ç¨‹ï¼šå¤šçº¿ç¨‹ã€é”ã€JVMã€JUCã€é«˜å¹¶å‘è®¾è®¡æ¨¡å¼ã€‹ã€‚\nå¥èº« æˆ‘è·‘è¿‡äº†ä¸€äº›åœ°æ–¹ï¼Œå¸Œæœ›éšç€æ—¶é—´æ¨ç§»ï¼Œåœ°å›¾ç‚¹äº®çš„åœ°æ–¹è¶Šæ¥è¶Šå¤šã€‚2 å¹´é‡Œæˆ‘è·‘è¿‡ 2 ä¸ªçœä»½ 2 ä¸ªåŸå¸‚ã€‚æ›´å¤šè·‘æ­¥æ•°æ®åœ¨æˆ‘çš„ è·‘æ­¥ ä¸»é¡µã€‚\næœ¬å‘¨å°šæœªè·‘æ­¥ã€‚æœ€è¿‘ä¸Šç­æ²¡æœ‰å¸¦é¥­ï¼Œæ¯å¤©ä¸­åˆåƒé¥­éƒ½è¶…æ ‡äº†ï¼Œæ¯å¤©ä¹Ÿæ²¡æœ‰æµ‹é‡ä½“é‡ï¼Œä¸¥é‡æ€€ç–‘ä½“é‡åˆæ¶¨äº†å‡ æ–¤ã€‚è¿™ä¸ªæœˆä¹Ÿå¿«ç»“æŸäº†ï¼Œä¸‹ä¸ªæœˆç»§ç»­å‡è‚¥ã€‚\nç†è´¢ è¿™å‘¨æ€»è®¡æ”¯å‡º 1027 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š\n6 æœˆ 25 æ—¥ï¼š30 å…ƒ\n6 æœˆ 24 æ—¥ï¼š133 å…ƒ\n6 æœˆ 23 æ—¥ï¼š462 å…ƒ\n6 æœˆ 22 æ—¥ï¼š69 å…ƒ\n6 æœˆ 21 æ—¥ï¼š147 å…ƒ\n6 æœˆ 20 æ—¥ï¼š159 å…ƒ\n6 æœˆ 19 æ—¥ï¼š27 å…ƒ\né™ªå®¶äºº å†œå† 5 æœˆ 4 æ—¥ï¼Œå…­èˆ…èµ°äº†ã€‚ç«¯åˆèŠ‚çš„ä¸‰å¤©å‡æœŸï¼Œä¸»è¦æ˜¯å›å»å¥”ä¸§ï¼Œé€å…­èˆ…æœ€åä¸€ç¨‹ã€‚\nç®—äº†ä¸‹æ—¥å­ï¼Œè€çˆ¸æ¥é˜³é€»å¿«ä¸€ä¸ªæœˆäº†ï¼Œè€å©†æ”¾ä¸‹æ‰‹ä¸Šçš„å·¥ä½œå›æ¥ç…§é¡¾è€çˆ¸ä¹Ÿæœ‰ä¸¤å‘¨æ—¶é—´äº†ã€‚çœ‹å¾—å‡ºæ¥ï¼Œè€å©†æœ‰æ•ˆç–²æƒ«äº†ã€‚è€çˆ¸ç°åœ¨å¯ä»¥èµ°ï¼Œä½†æ˜¯èµ°çš„ä¸å¤Ÿåˆ©ç´¢ã€‚å¸Œæœ›è€çˆ¸æ¢å¤å¾—å†å¿«äº›ï¼Œè®©è€å©†å›å»ä¸Šç­ã€‚å¦‚æœ‰å¯èƒ½ï¼Œä¸‹å‘¨æœ«æŠŠè€çˆ¸é€å›è€å®¶ï¼Œè®©è€çˆ¸è‡ªå·±åœ¨å®¶ç…§é¡¾è‡ªå·±ã€‚å†œæ‘çš„ç©ºæ°”å¥½äº›ï¼Œä¸ä¼šæ†‹å¾—æ…Œã€‚ä½†è¿˜æ˜¯æ‹…å¿ƒå¤©æ°”å¤ªçƒ­ï¼Œè€çˆ¸ç…§é¡¾ä¸å¥½è‡ªå·±ã€‚åœ¨ç…§é¡¾è€çˆ¸çš„äº‹æƒ…ï¼Œé™¤äº†èƒ½å¤Ÿä¾é è€å©†ï¼Œå…¶ä»–è°éƒ½é ä¸ä¸Šã€‚ä½†æ˜¯ï¼Œè€å©†ä¹Ÿæœ‰å·¥ä½œè¦å¤„ç†ï¼Œæˆ‘çš„å·¥ä½œåˆä¸èƒ½è¾æ‰ã€‚è¿™å¤§æŠµç®—æ˜¯å…«é›¶åçš„å‹åŠ›å§ï¼Œçˆ¶äº²åœ¨ä¹°æˆ¿ä¹°è½¦ç»“å©šä¸Šæ²¡æœ‰å¸®ä¸Šå¿™ï¼Œåè€Œè¿˜ä¼šå› ä¸ºè‡ªå·±ä¸å¥½å¥½ç…§é¡¾è‡ªå·±è€Œç»™å­å¥³å¢åŠ è´Ÿæ‹…ã€‚æ€»æ˜¯è·Ÿè€çˆ¸è¯´è¿™è¯¥åšé‚£ä¸è¯¥åšï¼Œè€çˆ¸å°±åƒä¸ªå­©å­ä¼¼çš„ï¼Œä¸€ç‚¹éƒ½ä¸å¬è¯ã€‚\nå‘¨å…­ï¼Œåœ¨é»„çŸ³å¼€ç‰™åŒ»é™¢çš„è¡¨å“¥çš„å¥³å„¿è€ƒä¸Šå¢¨å°”æœ¬çš„ç ”ç©¶ç”Ÿåœ¨è€å®¶åŠé…’ã€‚ä¹Ÿè®¸æ˜¯ä¸Šäº†å¹´çºªçš„ç¼˜æ•…ï¼Œä¹Ÿè®¸æ˜¯è€çˆ¸å–œæ¬¢å‡‘çƒ­é—¹ï¼Œè€çˆ¸æƒ³å»å–é…’ã€‚äºæ˜¯ï¼Œæˆå…¨äº†è€çˆ¸çš„å¿ƒæ„¿ã€‚è€çˆ¸å¹´çºªå¤§äº†ï¼Œå°½å¯èƒ½çš„æ»¡è¶³è€çˆ¸çš„ä¸€äº›æƒ³æ³•å’Œå¿ƒæ„¿ï¼Œå°½å¯èƒ½çš„å¸¦è€çˆ¸ä½“éªŒ\u0026quot;æ–°é²œ\u0026quot;çš„äº‹ç‰©ï¼Œæ¯”å¦‚ï¼Œçœ‹ç”µå½±ï¼Œæ—…æ¸¸ã€‚äºæ˜¯ï¼Œå‘¨å››å¸¦è€çˆ¸å»çœ‹äº†ç”µå½±ã€Šæ¶ˆå¤±çš„å¥¹ã€‹ã€‚è¿˜æœ‰ä»€ä¹ˆäº‹æƒ…å¯ä»¥åšå‘¢ï¼Ÿè¿™æ ·ä¸€æƒ³ï¼Œè€çˆ¸å¹´çºªè¶Šæ¥è¶Šå¤§äº†ï¼Œè…¿è„šè¶Šæ¥è¶Šä¸åˆ©ç´¢ï¼Œèƒ½å¤Ÿåšçš„äº‹æƒ…è¶Šæ¥è¶Šå°‘äº†ã€‚è¶å…‰é˜´è¿˜åœ¨ï¼Œå¤šé™ªé™ªçˆ¶æ¯ï¼Œå¸¸å›å®¶çœ‹çœ‹ã€‚\nå·¥ä½œ æœ€è¿‘åœ¨å­¦ä¹ çš„å†…å®¹æ¸…å•ï¼š\nEffective Javaï¼ˆç¬¬ 3 ç‰ˆï¼‰ Java Design Patterns (ä¸­æ–‡) Real Python æœ¬å‘¨å®Œæˆäº”ç¯‡åšå®¢ï¼š\n[è¯‘]å¾®æœåŠ¡è®¾è®¡æ¨¡å¼ Java è®¾è®¡æ¨¡å¼ï¼šAggregator Microservices Python å­¦ä¹  5ï¼šå‡½æ•° [è¯‘]Python æ¨¡å—å’ŒåŒ…-ç®€ä»‹ [è¯‘]ç”¨ Bottle å¼€å‘ æœ¬å‘¨åˆ†äº« å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€ChenSoul Shareã€Telegram é¢‘é“æˆ–è€…æˆ‘çš„ Memos ä¸­ã€‚æˆ‘å†™äº†ä¸€ä¸ª Python è„šæœ¬ä» Memos è¯»å–æœ€è¿‘ä¸€å‘¨å¸¦æœ‰ #memos æ ‡ç­¾çš„è®°å½•ï¼Œåˆ†äº«åˆ°è¿™é‡Œã€‚\nğŸ“Œ2023-06-24 365 èµ„è®¯ç®€æŠ¥ï¼Œæ¯å¤©ç²¾é€‰ 15 æ¡çƒ­ç‚¹æ–°é—»ç®€æŠ¥ 1 æ¡å¾®è¯­ï¼Œæ¯å¤©ä¸€åˆ†é’Ÿï¼ŒçŸ¥æ™“å¤©ä¸‹äº‹ï¼ 2023 å¹´ 6 æœˆ 24 æ—¥ æ˜ŸæœŸå…­ å†œå†äº”æœˆåˆä¸ƒ 1. å†…è’™å¤ã€ä¸Šæµ·ã€äº‘å—ç­‰åœ°é™†ç»­å…¬å¸ƒ 2023 é«˜è€ƒåˆ†æ•°çº¿ã€‚ 2. å…¨å›½å¤šåœ°ä»æœ‰è¶… 40â„ƒ é«˜æ¸©ï¼Œä¸­å›½æ°”è±¡å±€å¯åŠ¨å››çº§åº”æ€¥å“åº”ã€‚ 3. æ•°å­—äººæ°‘å¸æ— ç½‘æ— ç”µæ”¯ä»˜ï¼Œåœ¨å…¨å›½è½¨é“äº¤é€šåº”ç”¨åœºæ™¯é¦–æ¬¡è½åœ°ã€‚ 4. è¿ˆå…¥åŠ¨è½¦æ—¶ä»£ï¼7 æœˆ 1 æ—¥ï¼Œå¤å…´å·å°†åœ¨é’è—é“è·¯ä¸Šè¿è¥ã€‚ 5. æ·±åœ³å·²æ”¶åˆ° 1635 ä»¶ä¸ªäººç ´äº§ç”³è¯·ï¼ŒåŸå› åŒ…æ‹¬è¶…å‰æ¶ˆè´¹ã€ç»è¥ä¸å–„ç­‰ã€‚ 6. å¥³ç¯®äºšæ´²æ¯æœ€æ–°å®åŠ›æ¦œï¼Œä¸­å›½å¥³ç¯®åè¶…æ—¥æœ¬å‡è‡³ç¬¬ä¸€ä½ã€‚ 7. é“¶å·çƒ§çƒ¤åº—çˆ†ç‚¸äº‹æ•…é¢„ä¼°ä¿é™©èµ”ä»˜è¶… 1400 ä¸‡å…ƒï¼Œé¦–ç¬”èµ”ä»˜æ¬¾å·²åˆ°ä½ã€‚ 8. è¾½å®è¥å£ä¸€é’¢é“å‚çƒ«ä¼¤äº‹æ•…ï¼Œ4 æ­» 5 ä¼¤ï¼Œä¸“å®¶ç»„åˆæ­¥è®¤å®šç³»è®¾å¤‡æ•…éšœæ‰€è‡´ã€‚ 9. ç¬¬ 28 å±Šç™½ç‰å…°å¥–æ­æ™“ï¼šæ¼”å‘˜é›·ä½³éŸ³ã€å´è¶Šåˆ†è·æœ€ä½³ç”·ã€å¥³ä¸»è§’ã€‚ 10. å·´è²ç‰¹å†æ 46 äº¿ç¾å…ƒè‚¡ç¥¨ï¼Œæ‰¿è¯º 99ï¼…ä»¥ä¸Šçš„é—äº§å°†ç”¨äºæ…ˆå–„ã€‚ 11. æ—¥æœ¬å¹¿å²›å’Œå¹³çºªå¿µå…¬å›­å°†ä¸ç¾å›½çç æ¸¯å…¬å›­ç»“ä¸ºâ€œå§å¦¹å…¬å›­â€ã€‚ 12. æ²™ç‰¹å®£å¸ƒï¼šé€€å‡º 2030 å¹´ä¸–ç•Œæ¯ç”³åŠå·¥ä½œã€‚ 13. è«è¿ªåœ¨ç¾å›½æ”¾å‡ºè±ªè¨€ï¼šå°åº¦å¾ˆå¿«å°†æ˜¯ä¸–ç•Œç¬¬ä¸‰å¤§ç»æµä½“ã€‚ 14. ç¾å›½â€œé‡Œæ ¹â€å·èˆªæ¯å°†åœé è¶Šå—æ¸¯å£ï¼Œè¶Šæ–¹ç§°â€œæ­£å¸¸å‹å¥½äº¤æµâ€ã€‚ 15. è¥¿æ–¹å®˜å‘˜ç§°ä¹Œåæ”»æ—©æœŸ\u0026quot;ä½äºé¢„æœŸ\u0026quot;ï¼Œä¹Œå®˜å‘˜ï¼šä¸»è¦åæ”»è¿˜æ²¡å¼€å§‹ï¼Œç§‹å†¬å†çœ‹æˆæœã€‚ ã€å¾®è¯­ã€‘å¿ƒæœ‰ä¸‡ä¸‡å¿µï¼Œä¸€å¿µä¸€ä¸–ç•Œã€‚é™ï¼Œä¸æ˜¯è€³è¾¹æ— å£°ï¼Œè€Œæ˜¯å¿ƒä¸­æ— äº‰ã€‚ æ–°é—»æ¥æºï¼šhttps://www.163.com/dy/article/I7VSKUF90534QBVQ.html?spss=dy_author #æ¯æ—¥æ—©æŠ¥ #memos ğŸ“Œ2023-06-22 365 èµ„è®¯ç®€æŠ¥ï¼Œæ¯å¤©ç²¾é€‰ 15 æ¡çƒ­ç‚¹æ–°é—»ç®€æŠ¥ 1 æ¡å¾®è¯­ï¼Œæ¯å¤©ä¸€åˆ†é’Ÿï¼ŒçŸ¥æ™“å¤©ä¸‹äº‹ï¼ 2023 å¹´ 6 æœˆ 22 æ—¥ æ˜ŸæœŸå›› å†œå†äº”æœˆåˆäº” ç«¯åˆèŠ‚ 1. ä¸‰éƒ¨é—¨ï¼šæ–°èƒ½æºæ±½è½¦å…å¾è´­ç½®ç¨å»¶ç»­è‡³ 2025 å¹´åº•ï¼Œ2026-2027 å¹´å‡åŠå¾æ”¶ã€‚ 2. åŒ»ä¿å±€ï¼šæé€ŸåŒ»ä¿è½¬ç§»æ¥ç»­ï¼Œå°†åŠç†æ—¶é•¿ç”± 45 ä¸ªå·¥ä½œæ—¥å‹ç¼©ä¸º 15 ä¸ªå·¥ä½œæ—¥ã€‚ 3. æ•™è‚²éƒ¨ï¼šå»ºç«‹é«˜æ ¡æ¯•ä¸šç”Ÿæ¯•ä¸šå»å‘ç™»è®°åˆ¶åº¦ã€‚ 4. ä»Šå¹´ç«¯åˆé¢„è®¡æ—…æ¸¸äººæ¬¡è¾¾ 1 äº¿ï¼Œä»¥å‘¨è¾¹æ¸¸ã€è¿‘ç¨‹æ¸¸ä¸ºä¸»ï¼Œæ°‘å®¿ä»·æ ¼é«˜äºäº”ä¸€ã€‚ 5. é«˜æ¸©é»„è‰²é¢„è­¦ï¼šé¢„è®¡ä»Šå¤©ç™½å¤©ï¼Œäº¬æ´¥å†€ç­‰åœ°æœ€é«˜æ°”æ¸©å¯è¾¾ 40â„ƒ ä»¥ä¸Šã€‚ 6. ä¸­å›½å°çƒåä¼šï¼šå¤„ç½š 10 åæ‰“å‡çƒçš„çƒå‘˜ï¼Œå…¶ä¸­æ¢æ–‡åšã€æè¡Œè¢«ç»ˆèº«ç¦èµ›ã€‚ 7. å¦é—¨ç«‹æ³•ç¦æ–‘é©¬çº¿ä¸Šåˆ·æ‰‹æœºï¼Œè¿è€…æˆ–è¢«ç½šæ¬¾ 50 å…ƒï¼Œ8 æœˆ 1 æ—¥èµ·æ–½è¡Œã€‚ 8. æµ™æ±Ÿå¤šåœ°å¼€æ”¾å…±äº«æœºå…³ä¼äº‹ä¸šå•ä½æœåŠ¡èµ„æºï¼Œå«ä¼šè®®å®¤ã€å¥èº«æˆ¿ç­‰ã€‚ 9. å¹¿å·æ‹Ÿé™è¡Œ\u0026quot;ç”µé©´\u0026quot;ï¼šä¸åˆ° 6 äººå°±æ‹¥æœ‰ 1 è¾†ï¼Œè¿œè¶…é“è·¯æ‰¿è½½èƒ½åŠ›ã€‚ 10. ç¦å»ºå¤§ç”°ç§»é£æ˜“ä¿—è§æˆæ•ˆï¼šæ–‡æ˜æ–°é£æ‚„ç„¶å…´èµ·ï¼Œç»“å©šå‡ºç°é›¶å½©ç¤¼ã€‚ 11. ç†ŠçŒ«å…¬å›­å…¨é¢å¯åŠ¨å»ºè®¾ï¼ŒåŒ—äº¬å°†è¿æ¥è¿‘ 50 åªå¤§ç†ŠçŒ«ã€‚ 12. ç ”ç©¶ï¼šå–œé©¬æ‹‰é›…å†°å·æˆ–åœ¨æœ¬ä¸–çºªæœ«æ¶ˆè 80%ï¼Œå½±å“äºšæ´² 20 äº¿äººã€‚ 13. ä¸­å¡å†ç­¾é‡ç£…å¤©ç„¶æ°”åè®®ï¼š27 å¹´ä¾›æ°”é•¿åï¼Œä¸­çŸ³æ²¹å…¥è‚¡å¡å¡”å°”è¶…å¤§æ°”ç”°ã€‚ 14. è‹±å›½å€ºåŠ¡è¶… 2.5 ä¸‡äº¿è‹±é•‘ï¼Œ60 ä½™å¹´æ¥é¦–è¶…å›½å†…ç”Ÿäº§æ€»å€¼ã€‚ 15. æ¬§ç›Ÿå°±å¯¹ä¿„å®æ–½ç¬¬ 11 è½®åˆ¶è£è¾¾æˆä¸€è‡´ã€‚ ã€å¾®è¯­ã€‘ç«¯åˆä½³èŠ‚è‡³ï¼Œé£æ‘‡è‰¾è‰ï¼Œç²½å¶é£˜é¦™ï¼Œæ„¿ä½ å¤æ—¥æ¸…å¹³ï¼Œå–œä¹å®‰åº·ã€‚ æ–°é—»æ¥æºï¼šhttps://www.163.com/dy/article/I7QN8IJB0534QBVQ.html?spss=dy_author #æ¯æ—¥æ—©æŠ¥ #memos ğŸ“Œ2023-06-21 365 èµ„è®¯ç®€æŠ¥ï¼Œæ¯å¤©ç²¾é€‰ 15 æ¡çƒ­ç‚¹æ–°é—»ç®€æŠ¥ 1 æ¡å¾®è¯­ï¼Œæ¯å¤©ä¸€åˆ†é’Ÿï¼ŒçŸ¥æ™“å¤©ä¸‹äº‹ï¼ 2023 å¹´ 6 æœˆ 21 æ—¥ æ˜ŸæœŸä¸‰ å†œå†äº”æœˆåˆå›› ä»Šæ—¥å¤è‡³ 1. é™æ¯æ¥äº†ï¼šä¸€å¹´æœŸ LPR ä¸º 3.55%ï¼Œäº”å¹´æœŸä»¥ä¸Š LPR ä¸º 4.2%ï¼Œå‡ä¸‹é™ 10 ä¸ªåŸºç‚¹ã€‚ 2. æ•™è‚²éƒ¨å‘å¸ƒå…¨å›½é«˜æ ¡åå•ï¼Œæˆªè‡³ç›®å‰ï¼Œå…¨å›½é«˜ç­‰å­¦æ ¡å…±è®¡ 3072 æ‰€ã€‚ 3. å¤§é™†æ¢å¤å°åœ°åŒºç•ªè”æè¾“å…¥ï¼Œå°å†œï¼šæœŸç›¼è¿™å¤©åˆ°æ¥å·²ç­‰è¿‘ 3 å¹´ã€‚ 4. åŒ—äº¬å¸‚æœªæˆå¹´äººä¿æŠ¤å®£æ•™è”ç›Ÿæˆç«‹ï¼Œæ—¨åœ¨æ¨åŠ¨åŒ—äº¬å¸‚æœªæˆå¹´äººä¿æŠ¤å·¥ä½œé«˜è´¨é‡å‘å±•ã€‚ 5. å¹¿å·å¿«é€’æ–°è§„ï¼šå¿«é€’å…¥æŸœéœ€æ”¶ä»¶äººåŒæ„ï¼Œè™šå‡ç­¾æ”¶å¿«é€’æœ€é«˜å¯ç½šä¸‰ä¸‡ã€‚ 6. æ­å·æ‹Ÿç«‹æ³•ä¼ æ‰¿å‘å±•è€å­—å·ï¼Œé¼“åŠ±èŒä¸šå­¦æ ¡å¼€è®¾ä¼ ç»ŸæŠ€è‰ºè¯¾ç¨‹ã€‚ 7. æ²ˆé˜³ï¼šå…¨æ—¥åˆ¶ä¸­ä¸“ä»¥ä¸Šæ¯•ä¸šç”Ÿè´­æˆ¿å¯äº«å—å…¨é¢å¥‘ç¨è¡¥è´´ã€‚ 8. æµ™æ±Ÿï¼šä¸‰å¹´å°†åŸ¹è‚²åƒåçœçº§ä¹¡æ‘å·¥åŒ åå¸ˆï¼Œå…¶å­å¥³æ•™è‚²ã€è´­æˆ¿ç­‰å¯äº«ä¼˜æƒ ã€‚ 9. å†…è’™å¤å‰äº”æœˆå®‰å…¨ç”Ÿäº§äº‹æ•…æ­»äº¡ 160 äººï¼Œæ–°äº•ç…¤çŸ¿äº‹æ•…å¤±è”è€…å…¨éƒ¨é‡éš¾ã€‚ 10. é˜¿é‡Œé›†å›¢å®£å¸ƒæ¢å¸…ï¼šå¼ å‹‡ 9 æœˆå¸ä»»è‘£äº‹é•¿å’Œ CEOï¼Œè”¡å´‡ä¿¡å’Œå´æ³³é“­æ¥ä»»ã€‚ 11. å›½è¶³çƒ­èº«èµ› 2-0 å·´å‹’æ–¯å¦ï¼Œç»ˆç»“ 14 å¹´ä¸èƒœå¯¹æ‰‹å°´å°¬çºªå½•ã€‚ 12. çˆ±å°”å…°ä¸ºå‡æ’æ‹Ÿåœ¨ä»Šåä¸‰å¹´å†…å®°æ€çº¦ 20 ä¸‡å¤´ç‰›ï¼Œä»¥è¾¾åˆ°å…¶æ¸©å®¤æ°”ä½“å‡æ’ç›®æ ‡ã€‚ 13. ç»Ÿè®¡ï¼šè¿ç»­ 3 å¹´ï¼ŒéŸ©å›½ 60-69 å²å°±ä¸šäººå£æ•°é«˜äº 20-29 å²å¹´é¾„æ®µã€‚ 14. å¤–åª’ï¼šå°åº¦è‚¡å¸‚å¸‚å€¼åˆ›æ–°é«˜ï¼Œå·²è¶…è‹±æ³•ï¼Œä½å±…å…¨çƒç¬¬å››ã€‚ 15. å­ŸåŠ æ‹‰å›½æ­£å¼ç”³è¯·åŠ å…¥é‡‘ç –å›½å®¶ï¼Œå¤–äº¤éƒ¨ï¼šæ¬¢è¿æ›´å¤šä¼™ä¼´åŠ å…¥ã€‚ ã€å¾®è¯­ã€‘å¤è‡³è‰å§‹é¸£ï¼Œä¸‡ç‰©çš†ç¹ç››ï¼Œæ„¿æ‰€æœ‰æ˜¥å¤©é‡Œçš„é…é…¿ï¼Œéƒ½åœ¨è¿™ä¸ªå¤å¤©çƒ­çƒˆç»½æ”¾ï¼Œä¸€è·¯èŠ¬èŠ³ï¼Œä¸è´ŸéŸ¶åã€‚ æ–°é—»æ¥æºï¼šhttps://www.163.com/dy/article/I7O5BKR40534QBVQ.html?spss=dy_author #æ¯æ—¥æ—©æŠ¥ #memos ğŸ“Œ2023-06-20 365 èµ„è®¯ç®€æŠ¥ï¼Œæ¯å¤©ç²¾é€‰ 15 æ¡çƒ­ç‚¹æ–°é—»ç®€æŠ¥ 1 æ¡å¾®è¯­ï¼Œæ¯å¤©ä¸€åˆ†é’Ÿï¼ŒçŸ¥æ™“å¤©ä¸‹äº‹ï¼ 2023 å¹´ 6 æœˆ 19 æ—¥ æ˜ŸæœŸä¸€ å†œå†äº”æœˆåˆäºŒ 1. æ°”è±¡å°ï¼šé¢„è®¡ 19 æ—¥è‡³ 21 æ—¥å—æ–¹æœ‰å¤§èŒƒå›´è¾ƒå¼ºé™æ°´è¿‡ç¨‹ï¼Œä¸œåŒ—ç­‰åœ°é«˜æ¸©å¤©æ°”å‡å¼±ã€‚ 2. å›½å®¶é˜²æ€»ï¼šå°†é˜²æ±›å››çº§åº”æ€¥å“åº”èŒƒå›´æ‰©å±•è‡³æ¡‚è‹æµ™çš–èµ£é„‚æ¹˜é»”å…«çœä»½ã€‚ 3. å†œä¸šå†œæ‘éƒ¨ï¼šå…¨å›½å·²æ”¶è·å†¬å°éº¦é¢ç§¯è¶…è¿‡ 2.97 äº¿äº©ï¼Œæ”¶è·è¿›åº¦è¿‡ä¹æˆäº”ã€‚ 4. æµ·å…³æ€»ç½²ï¼šå»å¹´ï¼Œä¸­å›½è·¨å¢ƒç”µå•†è¿›å‡ºå£è§„æ¨¡é¦–æ¬¡çªç ´ 2 ä¸‡äº¿å…ƒäººæ°‘å¸ã€‚ 5. 618 æœ€æ–°è°ƒæŸ¥ï¼š75%çš„äººè´­ç‰©æ„æ„¿æ¯”å»å¹´å‡å°‘ï¼Œ60%çš„äººé¢„ç®—ä¸è¶…è¿‡ 500 å…ƒã€‚ 6. äº¬ä¸œ 618 æœ€æ–°æ•°æ®ï¼šå¹¿ä¸œäººè‰è”è´­ä¹°åŠ›å…¨å›½ç¬¬ä¸€ã€‚ 7. é‡åº†ï¼š8 æœˆ 1 æ—¥èµ·ï¼Œé¤é¥®ä¸šã€æ—…æ¸¸ä½å®¿ä¸šä¸å¾—ä¸»åŠ¨æä¾›ä¸€æ¬¡æ€§ç”¨å“ã€‚ 8. å¤©æ´¥ï¼šæ‹Ÿæé«˜é¦–å¥—æˆ¿å…¬ç§¯é‡‘è´·æ¬¾é¢åº¦ï¼Œæœ€é«˜ 100 ä¸‡å…ƒã€‚ 9. åä¸ºè½®å€¼è‘£äº‹é•¿èƒ¡åšå´‘ï¼šæœ€æ–°è¶…å¿«å……æŠ€æœ¯å¯ 15 åˆ†é’Ÿå……æ»¡ä¸€è¾†æ–°èƒ½æºè½¦ã€‚ 10. ç»æµå­¦å®¶æå®ï¼šæˆ‘å›½ä¸­ç­‰æ”¶å…¥ç¾¤ä½“æˆ–å·²è¾¾ 4.6 äº¿ï¼Œæ¯æœˆæŒ£ 3000 å…ƒå·¦å³å°±ç®—ã€‚ 11. ç¯å¡”ä¸“ä¸šç‰ˆæ•°æ®ï¼š2023 å¹´ç«¯åˆæ¡£æ–°ç‰‡é¢„å”®æ€»ç¥¨æˆ¿çªç ´ 3000 ä¸‡ã€‚ 12. æ³°å›½å°†åŠ å¿«ä¸­å›½æ¸¸å®¢å…¥å¢ƒç­¾è¯å®¡æ‰¹ï¼Œäº‰å– 7 å¤©å†…å®Œæˆã€‚ 13. å°åº¦åŒ—éƒ¨é­å—æç«¯çƒ­æµªä¾µè¢­ï¼š3 å¤©å†…å·²æœ‰ 98 äººæ­»äºé«˜æ¸©ã€‚ 14. é˜¿å¯Œæ±—å¡”åˆ©ç­æ”¿åºœå°†ç¾å›½æ’¤å†›æ—¥å®šä¸ºå…¨å›½å‡æ—¥ï¼Œæ¯å¹´åº†ç¥ã€‚ 15. ä¹Œæ–¹ç§°åŸºè¾…è®¡åˆ’æœ€å¤§é™åº¦æ¶ˆç­ä¿„ç½—æ–¯äººï¼Œå…‹å®«è­¦å‘Šï¼šä¿„ç½—æ–¯äººä¼šå°±æ­¤å®æ–½æƒ©ç½šã€‚ ã€å¾®è¯­ã€‘åŠªåŠ›çš„æ„ä¹‰åœ¨äºï¼šä»¥åæ—¥å­é‡Œï¼Œæ”¾çœ¼æœ›å»ï¼Œå…¨éƒ½æ˜¯è‡ªå·±å–œæ¬¢çš„äººå’Œäº‹ã€‚ æ–°é—»æ¥æºï¼šhttps://www.163.com/dy/article/I7IV8TLQ0534QBVQ.html?spss=dy_author #æ¯æ—¥æ—©æŠ¥ #memos ä»¥ä¸Šã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/06/28/weekly_review_25/","summary":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-06-19 åˆ° 2023-06-25 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¯»ä¹¦ã€å¥èº«ã€æŠ•èµ„ã€å¸®æœ‹å‹ã€é™ªå®¶äººã€‚\nè¿™å‘¨å› ä¸ºç«¯åˆèŠ‚ï¼Œåªä¸Šä¸‰å¤©ç­ï¼Œæ”¾ä¸‰å¤©å‡ã€‚ç¥æ„¿æ‰€æœ‰çˆ¶æ¯ç«¯åˆå®‰åº·ï¼\nè¯»ä¹¦ æœ¬å‘¨é˜…è¯»æ—¶é•¿ 15 åˆ†é’Ÿï¼Œä¸»è¦æ˜¯é˜…è¯»ã€ŠJava é«˜å¹¶å‘æ ¸å¿ƒç¼–ç¨‹ï¼šå¤šçº¿ç¨‹ã€é”ã€JVMã€JUCã€é«˜å¹¶å‘è®¾è®¡æ¨¡å¼ã€‹ã€‚\nå¥èº« æˆ‘è·‘è¿‡äº†ä¸€äº›åœ°æ–¹ï¼Œå¸Œæœ›éšç€æ—¶é—´æ¨ç§»ï¼Œåœ°å›¾ç‚¹äº®çš„åœ°æ–¹è¶Šæ¥è¶Šå¤šã€‚2 å¹´é‡Œæˆ‘è·‘è¿‡ 2 ä¸ªçœä»½ 2 ä¸ªåŸå¸‚ã€‚æ›´å¤šè·‘æ­¥æ•°æ®åœ¨æˆ‘çš„ è·‘æ­¥ ä¸»é¡µã€‚\næœ¬å‘¨å°šæœªè·‘æ­¥ã€‚æœ€è¿‘ä¸Šç­æ²¡æœ‰å¸¦é¥­ï¼Œæ¯å¤©ä¸­åˆåƒé¥­éƒ½è¶…æ ‡äº†ï¼Œæ¯å¤©ä¹Ÿæ²¡æœ‰æµ‹é‡ä½“é‡ï¼Œä¸¥é‡æ€€ç–‘ä½“é‡åˆæ¶¨äº†å‡ æ–¤ã€‚è¿™ä¸ªæœˆä¹Ÿå¿«ç»“æŸäº†ï¼Œä¸‹ä¸ªæœˆç»§ç»­å‡è‚¥ã€‚\nç†è´¢ è¿™å‘¨æ€»è®¡æ”¯å‡º 1027 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š\n6 æœˆ 25 æ—¥ï¼š30 å…ƒ\n6 æœˆ 24 æ—¥ï¼š133 å…ƒ\n6 æœˆ 23 æ—¥ï¼š462 å…ƒ\n6 æœˆ 22 æ—¥ï¼š69 å…ƒ\n6 æœˆ 21 æ—¥ï¼š147 å…ƒ\n6 æœˆ 20 æ—¥ï¼š159 å…ƒ\n6 æœˆ 19 æ—¥ï¼š27 å…ƒ\né™ªå®¶äºº å†œå† 5 æœˆ 4 æ—¥ï¼Œå…­èˆ…èµ°äº†ã€‚ç«¯åˆèŠ‚çš„ä¸‰å¤©å‡æœŸï¼Œä¸»è¦æ˜¯å›å»å¥”ä¸§ï¼Œé€å…­èˆ…æœ€åä¸€ç¨‹ã€‚\nç®—äº†ä¸‹æ—¥å­ï¼Œè€çˆ¸æ¥é˜³é€»å¿«ä¸€ä¸ªæœˆäº†ï¼Œè€å©†æ”¾ä¸‹æ‰‹ä¸Šçš„å·¥ä½œå›æ¥ç…§é¡¾è€çˆ¸ä¹Ÿæœ‰ä¸¤å‘¨æ—¶é—´äº†ã€‚çœ‹å¾—å‡ºæ¥ï¼Œè€å©†æœ‰æ•ˆç–²æƒ«äº†ã€‚è€çˆ¸ç°åœ¨å¯ä»¥èµ°ï¼Œä½†æ˜¯èµ°çš„ä¸å¤Ÿåˆ©ç´¢ã€‚å¸Œæœ›è€çˆ¸æ¢å¤å¾—å†å¿«äº›ï¼Œè®©è€å©†å›å»ä¸Šç­ã€‚å¦‚æœ‰å¯èƒ½ï¼Œä¸‹å‘¨æœ«æŠŠè€çˆ¸é€å›è€å®¶ï¼Œè®©è€çˆ¸è‡ªå·±åœ¨å®¶ç…§é¡¾è‡ªå·±ã€‚å†œæ‘çš„ç©ºæ°”å¥½äº›ï¼Œä¸ä¼šæ†‹å¾—æ…Œã€‚ä½†è¿˜æ˜¯æ‹…å¿ƒå¤©æ°”å¤ªçƒ­ï¼Œè€çˆ¸ç…§é¡¾ä¸å¥½è‡ªå·±ã€‚åœ¨ç…§é¡¾è€çˆ¸çš„äº‹æƒ…ï¼Œé™¤äº†èƒ½å¤Ÿä¾é è€å©†ï¼Œå…¶ä»–è°éƒ½é ä¸ä¸Šã€‚ä½†æ˜¯ï¼Œè€å©†ä¹Ÿæœ‰å·¥ä½œè¦å¤„ç†ï¼Œæˆ‘çš„å·¥ä½œåˆä¸èƒ½è¾æ‰ã€‚è¿™å¤§æŠµç®—æ˜¯å…«é›¶åçš„å‹åŠ›å§ï¼Œçˆ¶äº²åœ¨ä¹°æˆ¿ä¹°è½¦ç»“å©šä¸Šæ²¡æœ‰å¸®ä¸Šå¿™ï¼Œåè€Œè¿˜ä¼šå› ä¸ºè‡ªå·±ä¸å¥½å¥½ç…§é¡¾è‡ªå·±è€Œç»™å­å¥³å¢åŠ è´Ÿæ‹…ã€‚æ€»æ˜¯è·Ÿè€çˆ¸è¯´è¿™è¯¥åšé‚£ä¸è¯¥åšï¼Œè€çˆ¸å°±åƒä¸ªå­©å­ä¼¼çš„ï¼Œä¸€ç‚¹éƒ½ä¸å¬è¯ã€‚\nå‘¨å…­ï¼Œåœ¨é»„çŸ³å¼€ç‰™åŒ»é™¢çš„è¡¨å“¥çš„å¥³å„¿è€ƒä¸Šå¢¨å°”æœ¬çš„ç ”ç©¶ç”Ÿåœ¨è€å®¶åŠé…’ã€‚ä¹Ÿè®¸æ˜¯ä¸Šäº†å¹´çºªçš„ç¼˜æ•…ï¼Œä¹Ÿè®¸æ˜¯è€çˆ¸å–œæ¬¢å‡‘çƒ­é—¹ï¼Œè€çˆ¸æƒ³å»å–é…’ã€‚äºæ˜¯ï¼Œæˆå…¨äº†è€çˆ¸çš„å¿ƒæ„¿ã€‚è€çˆ¸å¹´çºªå¤§äº†ï¼Œå°½å¯èƒ½çš„æ»¡è¶³è€çˆ¸çš„ä¸€äº›æƒ³æ³•å’Œå¿ƒæ„¿ï¼Œå°½å¯èƒ½çš„å¸¦è€çˆ¸ä½“éªŒ\u0026quot;æ–°é²œ\u0026quot;çš„äº‹ç‰©ï¼Œæ¯”å¦‚ï¼Œçœ‹ç”µå½±ï¼Œæ—…æ¸¸ã€‚äºæ˜¯ï¼Œå‘¨å››å¸¦è€çˆ¸å»çœ‹äº†ç”µå½±ã€Šæ¶ˆå¤±çš„å¥¹ã€‹ã€‚è¿˜æœ‰ä»€ä¹ˆäº‹æƒ…å¯ä»¥åšå‘¢ï¼Ÿè¿™æ ·ä¸€æƒ³ï¼Œè€çˆ¸å¹´çºªè¶Šæ¥è¶Šå¤§äº†ï¼Œè…¿è„šè¶Šæ¥è¶Šä¸åˆ©ç´¢ï¼Œèƒ½å¤Ÿåšçš„äº‹æƒ…è¶Šæ¥è¶Šå°‘äº†ã€‚è¶å…‰é˜´è¿˜åœ¨ï¼Œå¤šé™ªé™ªçˆ¶æ¯ï¼Œå¸¸å›å®¶çœ‹çœ‹ã€‚\nå·¥ä½œ æœ€è¿‘åœ¨å­¦ä¹ çš„å†…å®¹æ¸…å•ï¼š\nEffective Javaï¼ˆç¬¬ 3 ç‰ˆï¼‰ Java Design Patterns (ä¸­æ–‡) Real Python æœ¬å‘¨å®Œæˆäº”ç¯‡åšå®¢ï¼š\n[è¯‘]å¾®æœåŠ¡è®¾è®¡æ¨¡å¼ Java è®¾è®¡æ¨¡å¼ï¼šAggregator Microservices Python å­¦ä¹  5ï¼šå‡½æ•° [è¯‘]Python æ¨¡å—å’ŒåŒ…-ç®€ä»‹ [è¯‘]ç”¨ Bottle å¼€å‘ æœ¬å‘¨åˆ†äº« å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€ChenSoul Shareã€Telegram é¢‘é“æˆ–è€…æˆ‘çš„ Memos ä¸­ã€‚æˆ‘å†™äº†ä¸€ä¸ª Python è„šæœ¬ä» Memos è¯»å–æœ€è¿‘ä¸€å‘¨å¸¦æœ‰ #memos æ ‡ç­¾çš„è®°å½•ï¼Œåˆ†äº«åˆ°è¿™é‡Œã€‚","title":"å‘¨æŠ¥-25ï½œç«¯åˆå®‰åº·"},{"content":"åŸºäºå¾®æœåŠ¡çš„åº”ç”¨ç¨‹åºçš„ä¸»è¦ç‰¹å¾åœ¨ å¾®æœåŠ¡ã€å•ä½“å’Œ NoOps ä¸­å®šä¹‰ã€‚å®ƒä»¬æ˜¯åŠŸèƒ½åˆ†è§£æˆ–é¢†åŸŸé©±åŠ¨è®¾è®¡ã€å®šä¹‰è‰¯å¥½çš„æ¥å£ã€æ˜ç¡®å‘å¸ƒçš„æ¥å£ã€å•ä¸€è´£ä»»åŸåˆ™å’Œæ½œåœ¨çš„å¤šè¯­è¨€ã€‚æ¯é¡¹æœåŠ¡éƒ½æ˜¯å®Œå…¨è‡ªä¸»å’Œå…¨æ ˆçš„ã€‚\nå› æ­¤ï¼Œæ›´æ”¹æœåŠ¡å®ç°ä¸ä¼šå½±å“å…¶ä»–æœåŠ¡ï¼Œå› ä¸ºå®ƒä»¬ä½¿ç”¨å®šä¹‰è‰¯å¥½çš„æ¥å£è¿›è¡Œé€šä¿¡ã€‚è¿™ç§åº”ç”¨ç¨‹åºæœ‰å‡ ä¸ªä¼˜ç‚¹ï¼Œä½†å®ƒä¸æ˜¯ å…è´¹çš„åˆé¤ï¼Œéœ€è¦åœ¨ NoOps æ–¹é¢ä»˜å‡ºå¤§é‡åŠªåŠ›ã€‚\nä½†æ˜¯å‡è®¾æ‚¨äº†è§£æ„å»ºæ­¤ç±»åº”ç”¨ç¨‹åºæ‰€éœ€çš„å·¥ä½œæˆ–è‡³å°‘å…¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”æ„¿æ„è·³æ§½ã€‚ä½ åšä»€ä¹ˆå·¥ä½œï¼Ÿæ‚¨æ„å»ºæ­¤ç±»åº”ç”¨ç¨‹åºçš„æ–¹æ³•æ˜¯ä»€ä¹ˆï¼Ÿ\næ˜¯å¦æœ‰ä»»ä½•å…³äºè¿™äº›å¾®æœåŠ¡å¦‚ä½•ç›¸äº’åä½œçš„è®¾è®¡æ¨¡å¼ï¼Ÿ\nåº”ç”¨ç¨‹åºå’Œå›¢é˜Ÿçš„åŠŸèƒ½åˆ†è§£æ˜¯æ„å»ºæˆåŠŸçš„å¾®æœåŠ¡æ¶æ„çš„å…³é”®ã€‚\nè¿™å…è®¸æ‚¨å®ç°æ¾è€¦åˆï¼ˆREST æ¥å£ï¼‰å’Œé«˜å†…èšï¼ˆå¤šä¸ªæœåŠ¡å¯ä»¥ç›¸äº’ç»„åˆä»¥å®šä¹‰æ›´é«˜çº§åˆ«çš„æœåŠ¡æˆ–åº”ç”¨ç¨‹åºï¼‰ã€‚\nåº”ç”¨ç¨‹åºçš„åŠ¨è¯ï¼ˆä¾‹å¦‚ Checkoutï¼‰æˆ–åè¯ï¼ˆProductï¼‰æ˜¯å®ç°ç°æœ‰åº”ç”¨ç¨‹åºåˆ†è§£çš„æœ‰æ•ˆæ–¹æ³•ä¹‹ä¸€ã€‚\nä¾‹å¦‚ï¼Œäº§å“ã€ç›®å½•å’Œç»“å¸å¯ä»¥æ˜¯ä¸‰ä¸ªç‹¬ç«‹çš„å¾®æœåŠ¡ï¼Œç„¶åç›¸äº’åä½œä»¥æä¾›å®Œæ•´çš„è´­ç‰©è½¦ä½“éªŒã€‚\nåŠŸèƒ½åˆ†è§£æä¾›äº†æ•æ·æ€§ã€çµæ´»æ€§ã€å¯æ‰©å±•æ€§å’Œå…¶ä»–èƒ½åŠ›ï¼Œä½†ä¸šåŠ¡ç›®æ ‡ä»ç„¶æ˜¯åˆ›å»ºåº”ç”¨ç¨‹åºã€‚å› æ­¤ï¼Œä¸€æ—¦è¯†åˆ«å‡ºä¸åŒçš„å¾®æœåŠ¡ï¼Œæ‚¨å¦‚ä½•ç»„åˆå®ƒä»¬ä»¥æä¾›åº”ç”¨ç¨‹åºçš„åŠŸèƒ½ï¼Ÿ\næœ¬åšå®¢å°†è®¨è®ºä¸€äº›å…³äºå¦‚ä½•å°†å¾®æœåŠ¡ç»„åˆåœ¨ä¸€èµ·çš„æ¨èæ¨¡å¼ã€‚\nèšåˆå¾®æœåŠ¡è®¾è®¡æ¨¡å¼ ç¬¬ä¸€ä¸ªï¼Œä¹Ÿå¯èƒ½æ˜¯æœ€å¸¸è§çš„ï¼Œæ˜¯èšåˆå™¨å¾®æœåŠ¡è®¾è®¡æ¨¡å¼ã€‚\nåœ¨å…¶æœ€ç®€å•çš„å½¢å¼ä¸­ï¼Œèšåˆå™¨å°†æ˜¯ä¸€ä¸ªç®€å•çš„ç½‘é¡µï¼Œå®ƒè°ƒç”¨å¤šä¸ªæœåŠ¡æ¥å®ç°åº”ç”¨ç¨‹åºæ‰€éœ€çš„åŠŸèƒ½ã€‚ç”±äºæ¯ä¸ªæœåŠ¡ï¼ˆæœåŠ¡ Aã€æœåŠ¡ B å’ŒæœåŠ¡ Cï¼‰éƒ½ä½¿ç”¨è½»é‡çº§ REST æœºåˆ¶å…¬å¼€ï¼Œå› æ­¤ç½‘é¡µå¯ä»¥æ£€ç´¢æ•°æ®å¹¶ç›¸åº”åœ°å¤„ç†/æ˜¾ç¤ºæ•°æ®ã€‚å¦‚æœéœ€è¦æŸç§å¤„ç†ï¼Œæ¯”å¦‚å°†ä¸šåŠ¡é€»è¾‘åº”ç”¨äºä»å„ä¸ªæœåŠ¡æ¥æ”¶çš„æ•°æ®ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½æœ‰ä¸€ä¸ª CDI bean å¯ä»¥è½¬æ¢æ•°æ®ï¼Œä»¥ä¾¿ç½‘é¡µå¯ä»¥æ˜¾ç¤ºå®ƒã€‚\nèšåˆå™¨çš„å¦ä¸€ä¸ªé€‰æ‹©æ˜¯ä¸éœ€è¦æ˜¾ç¤ºï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæ›´é«˜çº§åˆ«çš„å¤åˆå¾®æœåŠ¡ï¼Œå¯ä»¥è¢«å…¶ä»–æœåŠ¡ä½¿ç”¨ã€‚\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œèšåˆå™¨åªéœ€ä»æ¯ä¸ªå•ç‹¬çš„å¾®æœåŠ¡æ”¶é›†æ•°æ®ï¼Œå¯¹å…¶åº”ç”¨ä¸šåŠ¡é€»è¾‘ï¼Œç„¶åå°†å…¶è¿›ä¸€æ­¥å‘å¸ƒä¸º REST ç«¯ç‚¹ã€‚ç„¶åå¯ä»¥ç”±éœ€è¦å®ƒçš„å…¶ä»–æœåŠ¡ä½¿ç”¨ã€‚\nè¿™ç§è®¾è®¡æ¨¡å¼éµå¾ª DRY åŸåˆ™ã€‚\nå¦‚æœæœ‰å¤šä¸ªæœåŠ¡éœ€è¦è®¿é—®æœåŠ¡ Aã€B å’Œ Cï¼Œé‚£ä¹ˆå»ºè®®å°†è¯¥é€»è¾‘æŠ½è±¡ä¸ºä¸€ä¸ªå¤åˆå¾®æœåŠ¡ï¼Œå¹¶å°†è¯¥é€»è¾‘èšåˆåˆ°ä¸€ä¸ªæœåŠ¡ä¸­ã€‚åœ¨æ­¤çº§åˆ«è¿›è¡ŒæŠ½è±¡çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯å„ä¸ªæœåŠ¡ï¼Œå³æœåŠ¡ Aã€B å’Œ Cï¼Œå¹¶ä¸”å¯ä»¥ç‹¬ç«‹å‘å±•ï¼Œä¸šåŠ¡éœ€æ±‚ä»ç„¶ç”±ç»„åˆå¾®æœåŠ¡æä¾›ã€‚\nè¯·æ³¨æ„ï¼Œæ¯ä¸ªå•ç‹¬çš„å¾®æœåŠ¡éƒ½æœ‰è‡ªå·±çš„ï¼ˆå¯é€‰ï¼‰ç¼“å­˜å’Œæ•°æ®åº“ã€‚å¦‚æœèšåˆå™¨æ˜¯ä¸€ä¸ªå¤åˆå¾®æœåŠ¡ï¼Œé‚£ä¹ˆå®ƒä¹Ÿå¯èƒ½æœ‰è‡ªå·±çš„ç¼“å­˜å’Œæ•°æ®åº“å±‚ã€‚\nèšåˆå™¨ä¹Ÿå¯ä»¥åœ¨ X è½´å’Œ Z è½´ä¸Šç‹¬ç«‹ç¼©æ”¾ã€‚å› æ­¤ï¼Œå¦‚æœå®ƒæ˜¯ä¸€ä¸ªç½‘é¡µï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥å¯åŠ¨é¢å¤–çš„ Web æœåŠ¡å™¨ï¼Œæˆ–è€…å¦‚æœå®ƒæ˜¯ä¸€ä¸ªä½¿ç”¨ Java EE çš„å¤åˆå¾®æœåŠ¡ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥å¯åŠ¨é¢å¤–çš„ WildFly å®ä¾‹æ¥æ»¡è¶³ä¸æ–­å¢é•¿çš„éœ€æ±‚ã€‚\nä»£ç†å¾®æœåŠ¡è®¾è®¡æ¨¡å¼ ä»£ç†å¾®æœåŠ¡è®¾è®¡æ¨¡å¼æ˜¯èšåˆå™¨çš„ä¸€ç§å˜ä½“ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦è¿›è¡Œèšåˆï¼Œä½†å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€è¦è°ƒç”¨ä¸åŒçš„å¾®æœåŠ¡ã€‚\nå°±åƒ Aggregator ä¸€æ ·ï¼ŒProxy ä¹Ÿå¯ä»¥åœ¨ X è½´å’Œ Z è½´ä¸Šç‹¬ç«‹æ‰©å±•ã€‚æ‚¨å¯èƒ½å–œæ¬¢è¿™æ ·åšï¼Œå› ä¸ºæ¯ä¸ªå•ç‹¬çš„æœåŠ¡éƒ½ä¸éœ€è¦å‘æ¶ˆè´¹è€…å…¬å¼€ï¼Œè€Œæ˜¯åº”è¯¥é€šè¿‡ä¸€ä¸ªç•Œé¢ã€‚\nä»£ç†å¯èƒ½æ˜¯ä¸€ä¸ªå“‘ä»£ç†ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒåªæ˜¯å°†è¯·æ±‚å§”æ‰˜ç»™å…¶ä¸­ä¸€é¡¹æœåŠ¡ã€‚æˆ–è€…ï¼Œå®ƒå¯èƒ½æ˜¯ä¸€ä¸ªæ™ºèƒ½ä»£ç†ï¼Œåœ¨å°†å“åº”æä¾›ç»™å®¢æˆ·ç«¯ä¹‹å‰åº”ç”¨ä¸€äº›æ•°æ®è½¬æ¢ã€‚ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­å°±æ˜¯å¯ä»¥å°†ä¸åŒè®¾å¤‡çš„è¡¨ç¤ºå±‚å°è£…åœ¨æ™ºèƒ½ä»£ç†ä¸­ã€‚\né“¾å¼å¾®æœåŠ¡è®¾è®¡æ¨¡å¼ é“¾å¼å¾®æœåŠ¡è®¾è®¡æ¨¡å¼å¯¹è¯·æ±‚äº§ç”Ÿå•ä¸€çš„ç»¼åˆå“åº”ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ç”±æœåŠ¡ A æ¥æ”¶ï¼Œç„¶åæœåŠ¡ A ä¸æœåŠ¡ B é€šä¿¡ï¼Œè€ŒæœåŠ¡ B åˆå¯èƒ½ä¸æœåŠ¡ C é€šä¿¡ã€‚\næ‰€æœ‰æœåŠ¡éƒ½å¯èƒ½ä½¿ç”¨åŒæ­¥ HTTP è¯·æ±‚/å“åº”æ¶ˆæ¯ä¼ é€’ã€‚\nè¦è®°ä½çš„å…³é”®éƒ¨åˆ†æ˜¯å®¢æˆ·ç«¯è¢«é˜»å¡ï¼Œç›´åˆ°å®Œæˆè¯·æ±‚/å“åº”é“¾ï¼Œå³æœåŠ¡\u0026lt;-\u0026gt;æœåŠ¡ B å’ŒæœåŠ¡ B\u0026lt;-\u0026gt;æœåŠ¡ Cï¼Œå®Œæˆã€‚ä»æœåŠ¡ B åˆ°æœåŠ¡ C çš„è¯·æ±‚å¯èƒ½çœ‹èµ·æ¥ä¸ä»æœåŠ¡ A åˆ°æœåŠ¡ B çš„è¯·æ±‚å®Œå…¨ä¸åŒã€‚\nåŒæ ·ï¼ŒæœåŠ¡ B å¯¹æœåŠ¡ A çš„å“åº”å¯èƒ½çœ‹èµ·æ¥ä¸æœåŠ¡ C å¯¹æœåŠ¡ B çš„å“åº”å®Œå…¨ä¸åŒã€‚æ— è®ºå¦‚ä½•ï¼Œè¿™å°±æ˜¯ä¸åŒæœåŠ¡å¢åŠ å…¶ä¸šåŠ¡ä»·å€¼çš„å…¨éƒ¨è¦ç‚¹ã€‚\nè¿™é‡Œè¦ç†è§£çš„å¦ä¸€ä¸ªé‡è¦æ–¹é¢æ˜¯ä¸è¦è®©é“¾æ¡å¤ªé•¿ã€‚è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œå› ä¸ºé“¾çš„åŒæ­¥ç‰¹æ€§åœ¨å®¢æˆ·ç«¯çœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªæ¼«é•¿çš„ç­‰å¾…ï¼Œç‰¹åˆ«æ˜¯å¦‚æœå®ƒæ˜¯ä¸€ä¸ªç­‰å¾…æ˜¾ç¤ºå“åº”çš„ç½‘é¡µã€‚\nè¿™ä¸ªé˜»å¡è¯·æ±‚/å“åº”æœ‰å˜é€šæ–¹æ³•ï¼Œå¹¶åœ¨åç»­è®¾è®¡æ¨¡å¼ä¸­è®¨è®ºã€‚\nå…·æœ‰å•ä¸ªå¾®æœåŠ¡çš„é“¾ç§°ä¸ºå•ä¾‹é“¾ã€‚è¿™å¯èƒ½å…è®¸é“¾åœ¨ä»¥åæ‰©å±•ã€‚\nåˆ†æ”¯å¾®æœåŠ¡è®¾è®¡æ¨¡å¼ åˆ†æ”¯å¾®æœåŠ¡è®¾è®¡æ¨¡å¼æ‰©å±•äº†èšåˆå™¨è®¾è®¡æ¨¡å¼ï¼Œå¹¶å…è®¸åŒæ—¶å¤„ç†æ¥è‡ªä¸¤ä¸ªå¯èƒ½äº’æ–¥çš„å¾®æœåŠ¡é“¾çš„å“åº”ã€‚æ­¤æ¨¡å¼è¿˜å¯ç”¨äºæ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒç”¨ä¸åŒçš„é“¾æˆ–å•ä¸ªé“¾ã€‚\næœåŠ¡ Aï¼ˆç½‘é¡µæˆ–å¤åˆå¾®æœåŠ¡ï¼‰å¯ä»¥åŒæ—¶è°ƒç”¨ä¸¤ä¸ªä¸åŒçš„é“¾ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ç±»ä¼¼äºèšåˆå™¨è®¾è®¡æ¨¡å¼ã€‚æˆ–è€…ï¼ŒæœåŠ¡ A å¯ä»¥æ ¹æ®ä»å®¢æˆ·ç«¯æ”¶åˆ°çš„è¯·æ±‚ä»…è°ƒç”¨ä¸€ä¸ªé“¾ã€‚\nè¿™å¯ä»¥ä½¿ç”¨ JAX-RS æˆ– Camel ç«¯ç‚¹çš„è·¯ç”±è¿›è¡Œé…ç½®ï¼Œå¹¶ä¸”éœ€è¦åŠ¨æ€é…ç½®ã€‚\nå…±äº«æ•°æ®å¾®æœåŠ¡è®¾è®¡æ¨¡å¼ å¾®æœåŠ¡çš„è®¾è®¡åŸåˆ™ä¹‹ä¸€æ˜¯è‡ªæ²»ã€‚è¿™æ„å‘³ç€è¯¥æœåŠ¡æ˜¯å…¨æ ˆå¼çš„ï¼Œå¹¶ä¸”å¯ä»¥æ§åˆ¶æ‰€æœ‰ç»„ä»¶â€”â€”UIã€ä¸­é—´ä»¶ã€æŒä¹…æ€§ã€äº‹åŠ¡ã€‚è¿™å…è®¸æœåŠ¡æ˜¯å¤šè¯­è¨€çš„ï¼Œå¹¶ä½¿ç”¨æ­£ç¡®çš„å·¥å…·æ¥å®Œæˆæ­£ç¡®çš„å·¥ä½œã€‚\nä¾‹å¦‚ï¼Œå¦‚æœå¯ä»¥ä½¿ç”¨ NoSQL æ•°æ®å­˜å‚¨è€Œä¸æ˜¯å°†æ•°æ®å¡å…¥ SQL æ•°æ®åº“ä¸­æ›´åˆé€‚çš„è¯ã€‚\nç„¶è€Œï¼Œä¸€ä¸ªå…¸å‹çš„é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨ä»ç°æœ‰çš„å•ä½“åº”ç”¨ç¨‹åºé‡æ„æ—¶ï¼Œæ˜¯æ•°æ®åº“è§„èŒƒåŒ–ï¼Œè¿™æ ·æ¯ä¸ªå¾®æœåŠ¡éƒ½æœ‰æ­£ç¡®æ•°é‡çš„æ•°æ®â€”â€”ä»…æ­¤è€Œå·²ã€‚\nå³ä½¿åœ¨å•ä½“åº”ç”¨ç¨‹åºä¸­ä»…ä½¿ç”¨ SQL æ•°æ®åº“ï¼Œå¯¹æ•°æ®åº“è¿›è¡Œéè§„èŒƒåŒ–ä¹Ÿä¼šå¯¼è‡´æ•°æ®é‡å¤ï¼Œå¹¶å¯èƒ½å¯¼è‡´ä¸ä¸€è‡´ã€‚åœ¨è¿‡æ¸¡é˜¶æ®µï¼Œä¸€äº›åº”ç”¨ç¨‹åºå¯èƒ½ä¼šå—ç›Šäºå…±äº«æ•°æ®å¾®æœåŠ¡è®¾è®¡æ¨¡å¼ã€‚\nåœ¨è¿™ç§è®¾è®¡æ¨¡å¼ä¸­ï¼Œä¸€äº›å¾®æœåŠ¡ï¼ˆå¯èƒ½åœ¨ä¸€ä¸ªé“¾ä¸­ï¼‰å¯ä»¥å…±äº«ç¼“å­˜å’Œæ•°æ®åº“å­˜å‚¨ã€‚\nè¿™åªæœ‰åœ¨ä¸¤ç§æœåŠ¡ä¹‹é—´å­˜åœ¨å¼ºè€¦åˆæ—¶æ‰æœ‰æ„ä¹‰ã€‚æœ‰äº›äººå¯èƒ½è®¤ä¸ºè¿™æ˜¯ä¸€ç§åæ¨¡å¼ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ä¸šåŠ¡éœ€æ±‚å¯èƒ½éœ€è¦éµå¾ªè¿™ä¸€ç‚¹ã€‚å¯¹äºåŸºäºå¾®æœåŠ¡è®¾è®¡çš„å…¨æ–°åº”ç”¨ç¨‹åºï¼Œè¿™è‚¯å®šæ˜¯ä¸€ç§åæ¨¡å¼ã€‚\nè¿™ä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªè¿‡æ¸¡é˜¶æ®µï¼Œç›´åˆ°å¾®æœåŠ¡è¿‡æ¸¡åˆ°å®Œå…¨è‡ªä¸»ã€‚\nå¼‚æ­¥æ¶ˆæ¯å¾®æœåŠ¡è®¾è®¡æ¨¡å¼ è™½ç„¶ REST è®¾è®¡æ¨¡å¼éå¸¸æ™®éä¸”æ˜“äºç†è§£ï¼Œä½†å®ƒå…·æœ‰åŒæ­¥å’Œé˜»å¡çš„å±€é™æ€§ã€‚\nå¯ä»¥å®ç°å¼‚æ­¥ï¼Œä½†è¿™æ˜¯ä»¥ç‰¹å®šäºåº”ç”¨ç¨‹åºçš„æ–¹å¼å®Œæˆçš„ã€‚å› æ­¤ï¼Œä¸€äº›å¾®æœåŠ¡æ¶æ„å¯èƒ½ä¼šé€‰æ‹©ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—è€Œä¸æ˜¯ REST è¯·æ±‚/å“åº”ã€‚\nåœ¨è¿™ç§è®¾è®¡æ¨¡å¼ä¸­ï¼ŒæœåŠ¡ A å¯ä»¥åŒæ­¥è°ƒç”¨æœåŠ¡ Cï¼Œç„¶åæœåŠ¡ C ä½¿ç”¨å…±äº«æ¶ˆæ¯é˜Ÿåˆ—ä¸æœåŠ¡ B å’Œ D å¼‚æ­¥é€šä¿¡ã€‚\næœåŠ¡ A -\u0026gt; æœåŠ¡ C é€šä¿¡å¯èƒ½æ˜¯å¼‚æ­¥çš„ï¼Œå¯èƒ½ä½¿ç”¨ WebSocketsï¼Œä»¥å®ç°æ‰€éœ€çš„å¯ä¼¸ç¼©æ€§ã€‚\nå¯ä»¥ä½¿ç”¨ REST è¯·æ±‚/å“åº”å’Œå‘å¸ƒ/è®¢é˜…æ¶ˆæ¯ä¼ é€’çš„ç»„åˆæ¥å®Œæˆä¸šåŠ¡éœ€æ±‚ã€‚\nCoupling vs Autonomy in Microservices æ˜¯ä¸€æœ¬å…³äºä¸ºæ‚¨çš„å¾®æœåŠ¡é€‰æ‹©å“ªç§æ¶ˆæ¯ä¼ é€’æ¨¡å¼çš„å¥½è¯»ç‰©ã€‚\nå¸Œæœ›æ‚¨å‘ç°è¿™äº›è®¾è®¡æ¨¡å¼å¾ˆæœ‰ç”¨ã€‚\næ‚¨ä½¿ç”¨ä»€ä¹ˆå¾®æœåŠ¡è®¾è®¡æ¨¡å¼ï¼Ÿ\nå–„äºäº¤é™…ï¼Œåˆ†äº«ï¼\nåŸæ–‡é“¾æ¥ï¼šhttp://web.archive.org/web/20190705163602/http://blog.arungupta.me/microservice-design-patterns/\n","permalink":"https://blog.chensoul.cc/posts/2023/06/26/microservice-design-patterns/","summary":"åŸºäºå¾®æœåŠ¡çš„åº”ç”¨ç¨‹åºçš„ä¸»è¦ç‰¹å¾åœ¨ å¾®æœåŠ¡ã€å•ä½“å’Œ NoOps ä¸­å®šä¹‰ã€‚å®ƒä»¬æ˜¯åŠŸèƒ½åˆ†è§£æˆ–é¢†åŸŸé©±åŠ¨è®¾è®¡ã€å®šä¹‰è‰¯å¥½çš„æ¥å£ã€æ˜ç¡®å‘å¸ƒçš„æ¥å£ã€å•ä¸€è´£ä»»åŸåˆ™å’Œæ½œåœ¨çš„å¤šè¯­è¨€ã€‚æ¯é¡¹æœåŠ¡éƒ½æ˜¯å®Œå…¨è‡ªä¸»å’Œå…¨æ ˆçš„ã€‚\nå› æ­¤ï¼Œæ›´æ”¹æœåŠ¡å®ç°ä¸ä¼šå½±å“å…¶ä»–æœåŠ¡ï¼Œå› ä¸ºå®ƒä»¬ä½¿ç”¨å®šä¹‰è‰¯å¥½çš„æ¥å£è¿›è¡Œé€šä¿¡ã€‚è¿™ç§åº”ç”¨ç¨‹åºæœ‰å‡ ä¸ªä¼˜ç‚¹ï¼Œä½†å®ƒä¸æ˜¯ å…è´¹çš„åˆé¤ï¼Œéœ€è¦åœ¨ NoOps æ–¹é¢ä»˜å‡ºå¤§é‡åŠªåŠ›ã€‚\nä½†æ˜¯å‡è®¾æ‚¨äº†è§£æ„å»ºæ­¤ç±»åº”ç”¨ç¨‹åºæ‰€éœ€çš„å·¥ä½œæˆ–è‡³å°‘å…¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”æ„¿æ„è·³æ§½ã€‚ä½ åšä»€ä¹ˆå·¥ä½œï¼Ÿæ‚¨æ„å»ºæ­¤ç±»åº”ç”¨ç¨‹åºçš„æ–¹æ³•æ˜¯ä»€ä¹ˆï¼Ÿ\næ˜¯å¦æœ‰ä»»ä½•å…³äºè¿™äº›å¾®æœåŠ¡å¦‚ä½•ç›¸äº’åä½œçš„è®¾è®¡æ¨¡å¼ï¼Ÿ\nåº”ç”¨ç¨‹åºå’Œå›¢é˜Ÿçš„åŠŸèƒ½åˆ†è§£æ˜¯æ„å»ºæˆåŠŸçš„å¾®æœåŠ¡æ¶æ„çš„å…³é”®ã€‚\nè¿™å…è®¸æ‚¨å®ç°æ¾è€¦åˆï¼ˆREST æ¥å£ï¼‰å’Œé«˜å†…èšï¼ˆå¤šä¸ªæœåŠ¡å¯ä»¥ç›¸äº’ç»„åˆä»¥å®šä¹‰æ›´é«˜çº§åˆ«çš„æœåŠ¡æˆ–åº”ç”¨ç¨‹åºï¼‰ã€‚\nåº”ç”¨ç¨‹åºçš„åŠ¨è¯ï¼ˆä¾‹å¦‚ Checkoutï¼‰æˆ–åè¯ï¼ˆProductï¼‰æ˜¯å®ç°ç°æœ‰åº”ç”¨ç¨‹åºåˆ†è§£çš„æœ‰æ•ˆæ–¹æ³•ä¹‹ä¸€ã€‚\nä¾‹å¦‚ï¼Œäº§å“ã€ç›®å½•å’Œç»“å¸å¯ä»¥æ˜¯ä¸‰ä¸ªç‹¬ç«‹çš„å¾®æœåŠ¡ï¼Œç„¶åç›¸äº’åä½œä»¥æä¾›å®Œæ•´çš„è´­ç‰©è½¦ä½“éªŒã€‚\nåŠŸèƒ½åˆ†è§£æä¾›äº†æ•æ·æ€§ã€çµæ´»æ€§ã€å¯æ‰©å±•æ€§å’Œå…¶ä»–èƒ½åŠ›ï¼Œä½†ä¸šåŠ¡ç›®æ ‡ä»ç„¶æ˜¯åˆ›å»ºåº”ç”¨ç¨‹åºã€‚å› æ­¤ï¼Œä¸€æ—¦è¯†åˆ«å‡ºä¸åŒçš„å¾®æœåŠ¡ï¼Œæ‚¨å¦‚ä½•ç»„åˆå®ƒä»¬ä»¥æä¾›åº”ç”¨ç¨‹åºçš„åŠŸèƒ½ï¼Ÿ\næœ¬åšå®¢å°†è®¨è®ºä¸€äº›å…³äºå¦‚ä½•å°†å¾®æœåŠ¡ç»„åˆåœ¨ä¸€èµ·çš„æ¨èæ¨¡å¼ã€‚\nèšåˆå¾®æœåŠ¡è®¾è®¡æ¨¡å¼ ç¬¬ä¸€ä¸ªï¼Œä¹Ÿå¯èƒ½æ˜¯æœ€å¸¸è§çš„ï¼Œæ˜¯èšåˆå™¨å¾®æœåŠ¡è®¾è®¡æ¨¡å¼ã€‚\nåœ¨å…¶æœ€ç®€å•çš„å½¢å¼ä¸­ï¼Œèšåˆå™¨å°†æ˜¯ä¸€ä¸ªç®€å•çš„ç½‘é¡µï¼Œå®ƒè°ƒç”¨å¤šä¸ªæœåŠ¡æ¥å®ç°åº”ç”¨ç¨‹åºæ‰€éœ€çš„åŠŸèƒ½ã€‚ç”±äºæ¯ä¸ªæœåŠ¡ï¼ˆæœåŠ¡ Aã€æœåŠ¡ B å’ŒæœåŠ¡ Cï¼‰éƒ½ä½¿ç”¨è½»é‡çº§ REST æœºåˆ¶å…¬å¼€ï¼Œå› æ­¤ç½‘é¡µå¯ä»¥æ£€ç´¢æ•°æ®å¹¶ç›¸åº”åœ°å¤„ç†/æ˜¾ç¤ºæ•°æ®ã€‚å¦‚æœéœ€è¦æŸç§å¤„ç†ï¼Œæ¯”å¦‚å°†ä¸šåŠ¡é€»è¾‘åº”ç”¨äºä»å„ä¸ªæœåŠ¡æ¥æ”¶çš„æ•°æ®ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½æœ‰ä¸€ä¸ª CDI bean å¯ä»¥è½¬æ¢æ•°æ®ï¼Œä»¥ä¾¿ç½‘é¡µå¯ä»¥æ˜¾ç¤ºå®ƒã€‚\nèšåˆå™¨çš„å¦ä¸€ä¸ªé€‰æ‹©æ˜¯ä¸éœ€è¦æ˜¾ç¤ºï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæ›´é«˜çº§åˆ«çš„å¤åˆå¾®æœåŠ¡ï¼Œå¯ä»¥è¢«å…¶ä»–æœåŠ¡ä½¿ç”¨ã€‚\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œèšåˆå™¨åªéœ€ä»æ¯ä¸ªå•ç‹¬çš„å¾®æœåŠ¡æ”¶é›†æ•°æ®ï¼Œå¯¹å…¶åº”ç”¨ä¸šåŠ¡é€»è¾‘ï¼Œç„¶åå°†å…¶è¿›ä¸€æ­¥å‘å¸ƒä¸º REST ç«¯ç‚¹ã€‚ç„¶åå¯ä»¥ç”±éœ€è¦å®ƒçš„å…¶ä»–æœåŠ¡ä½¿ç”¨ã€‚\nè¿™ç§è®¾è®¡æ¨¡å¼éµå¾ª DRY åŸåˆ™ã€‚\nå¦‚æœæœ‰å¤šä¸ªæœåŠ¡éœ€è¦è®¿é—®æœåŠ¡ Aã€B å’Œ Cï¼Œé‚£ä¹ˆå»ºè®®å°†è¯¥é€»è¾‘æŠ½è±¡ä¸ºä¸€ä¸ªå¤åˆå¾®æœåŠ¡ï¼Œå¹¶å°†è¯¥é€»è¾‘èšåˆåˆ°ä¸€ä¸ªæœåŠ¡ä¸­ã€‚åœ¨æ­¤çº§åˆ«è¿›è¡ŒæŠ½è±¡çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯å„ä¸ªæœåŠ¡ï¼Œå³æœåŠ¡ Aã€B å’Œ Cï¼Œå¹¶ä¸”å¯ä»¥ç‹¬ç«‹å‘å±•ï¼Œä¸šåŠ¡éœ€æ±‚ä»ç„¶ç”±ç»„åˆå¾®æœåŠ¡æä¾›ã€‚\nè¯·æ³¨æ„ï¼Œæ¯ä¸ªå•ç‹¬çš„å¾®æœåŠ¡éƒ½æœ‰è‡ªå·±çš„ï¼ˆå¯é€‰ï¼‰ç¼“å­˜å’Œæ•°æ®åº“ã€‚å¦‚æœèšåˆå™¨æ˜¯ä¸€ä¸ªå¤åˆå¾®æœåŠ¡ï¼Œé‚£ä¹ˆå®ƒä¹Ÿå¯èƒ½æœ‰è‡ªå·±çš„ç¼“å­˜å’Œæ•°æ®åº“å±‚ã€‚\nèšåˆå™¨ä¹Ÿå¯ä»¥åœ¨ X è½´å’Œ Z è½´ä¸Šç‹¬ç«‹ç¼©æ”¾ã€‚å› æ­¤ï¼Œå¦‚æœå®ƒæ˜¯ä¸€ä¸ªç½‘é¡µï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥å¯åŠ¨é¢å¤–çš„ Web æœåŠ¡å™¨ï¼Œæˆ–è€…å¦‚æœå®ƒæ˜¯ä¸€ä¸ªä½¿ç”¨ Java EE çš„å¤åˆå¾®æœåŠ¡ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥å¯åŠ¨é¢å¤–çš„ WildFly å®ä¾‹æ¥æ»¡è¶³ä¸æ–­å¢é•¿çš„éœ€æ±‚ã€‚\nä»£ç†å¾®æœåŠ¡è®¾è®¡æ¨¡å¼ ä»£ç†å¾®æœåŠ¡è®¾è®¡æ¨¡å¼æ˜¯èšåˆå™¨çš„ä¸€ç§å˜ä½“ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦è¿›è¡Œèšåˆï¼Œä½†å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€è¦è°ƒç”¨ä¸åŒçš„å¾®æœåŠ¡ã€‚\nå°±åƒ Aggregator ä¸€æ ·ï¼ŒProxy ä¹Ÿå¯ä»¥åœ¨ X è½´å’Œ Z è½´ä¸Šç‹¬ç«‹æ‰©å±•ã€‚æ‚¨å¯èƒ½å–œæ¬¢è¿™æ ·åšï¼Œå› ä¸ºæ¯ä¸ªå•ç‹¬çš„æœåŠ¡éƒ½ä¸éœ€è¦å‘æ¶ˆè´¹è€…å…¬å¼€ï¼Œè€Œæ˜¯åº”è¯¥é€šè¿‡ä¸€ä¸ªç•Œé¢ã€‚\nä»£ç†å¯èƒ½æ˜¯ä¸€ä¸ªå“‘ä»£ç†ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒåªæ˜¯å°†è¯·æ±‚å§”æ‰˜ç»™å…¶ä¸­ä¸€é¡¹æœåŠ¡ã€‚æˆ–è€…ï¼Œå®ƒå¯èƒ½æ˜¯ä¸€ä¸ªæ™ºèƒ½ä»£ç†ï¼Œåœ¨å°†å“åº”æä¾›ç»™å®¢æˆ·ç«¯ä¹‹å‰åº”ç”¨ä¸€äº›æ•°æ®è½¬æ¢ã€‚ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­å°±æ˜¯å¯ä»¥å°†ä¸åŒè®¾å¤‡çš„è¡¨ç¤ºå±‚å°è£…åœ¨æ™ºèƒ½ä»£ç†ä¸­ã€‚\né“¾å¼å¾®æœåŠ¡è®¾è®¡æ¨¡å¼ é“¾å¼å¾®æœåŠ¡è®¾è®¡æ¨¡å¼å¯¹è¯·æ±‚äº§ç”Ÿå•ä¸€çš„ç»¼åˆå“åº”ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ç”±æœåŠ¡ A æ¥æ”¶ï¼Œç„¶åæœåŠ¡ A ä¸æœåŠ¡ B é€šä¿¡ï¼Œè€ŒæœåŠ¡ B åˆå¯èƒ½ä¸æœåŠ¡ C é€šä¿¡ã€‚\næ‰€æœ‰æœåŠ¡éƒ½å¯èƒ½ä½¿ç”¨åŒæ­¥ HTTP è¯·æ±‚/å“åº”æ¶ˆæ¯ä¼ é€’ã€‚\nè¦è®°ä½çš„å…³é”®éƒ¨åˆ†æ˜¯å®¢æˆ·ç«¯è¢«é˜»å¡ï¼Œç›´åˆ°å®Œæˆè¯·æ±‚/å“åº”é“¾ï¼Œå³æœåŠ¡\u0026lt;-\u0026gt;æœåŠ¡ B å’ŒæœåŠ¡ B\u0026lt;-\u0026gt;æœåŠ¡ Cï¼Œå®Œæˆã€‚ä»æœåŠ¡ B åˆ°æœåŠ¡ C çš„è¯·æ±‚å¯èƒ½çœ‹èµ·æ¥ä¸ä»æœåŠ¡ A åˆ°æœåŠ¡ B çš„è¯·æ±‚å®Œå…¨ä¸åŒã€‚\nåŒæ ·ï¼ŒæœåŠ¡ B å¯¹æœåŠ¡ A çš„å“åº”å¯èƒ½çœ‹èµ·æ¥ä¸æœåŠ¡ C å¯¹æœåŠ¡ B çš„å“åº”å®Œå…¨ä¸åŒã€‚æ— è®ºå¦‚ä½•ï¼Œè¿™å°±æ˜¯ä¸åŒæœåŠ¡å¢åŠ å…¶ä¸šåŠ¡ä»·å€¼çš„å…¨éƒ¨è¦ç‚¹ã€‚","title":"[è¯‘]å¾®æœåŠ¡è®¾è®¡æ¨¡å¼"},{"content":"æœ¬æ–‡ä¸»è¦ä»‹ç» Aggregator Microservices æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nJava Design Patterns æä¾›äº†å„ç§ Java è®¾è®¡æ¨¡å¼çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ã€‚è¯¥ç½‘ç«™æ—¨åœ¨å¸®åŠ© Java å¼€å‘äººå‘˜äº†è§£å’Œåº”ç”¨å„ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚\nJava Design Patterns ç½‘ç«™æä¾›äº†å¤šç§è®¾è®¡æ¨¡å¼åˆ†ç±»æ–¹å¼ï¼ŒåŒ…æ‹¬åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational Patternsï¼‰ã€ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternsï¼‰å’Œè¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰ï¼Œä»¥åŠå…¶ä»–ä¸€äº›å¸¸è§çš„æ¨¡å¼ã€‚\nå¯¹äºæ¯ä¸ªè®¾è®¡æ¨¡å¼ï¼Œè¯¥ç½‘ç«™æä¾›äº†è¯¦ç»†çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ï¼Œå¹¶ä¸”æä¾›äº†ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ã€‚å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©é€‚åˆè‡ªå·±çš„è®¾è®¡æ¨¡å¼ï¼Œå¹¶ä¸”å¯ä»¥å‚è€ƒç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜æ¥ç†è§£å’Œåº”ç”¨è¯¥æ¨¡å¼ã€‚\næ­¤å¤–ï¼ŒJava Design Patterns ç½‘ç«™è¿˜æä¾›äº†ä¸€äº›å…¶ä»–èµ„æºï¼Œå¦‚è®¾è®¡æ¨¡å¼çš„ UML å›¾ã€è®¾è®¡æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ã€è®¾è®¡æ¨¡å¼çš„æ¯”è¾ƒç­‰ã€‚è¿™äº›èµ„æºå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨è®¾è®¡æ¨¡å¼ã€‚\nä¸­æ–‡ç½‘ç«™ï¼šhttps://java-design-patterns.com/zh/\nGithub ä¸Šæºç ä»“åº“ï¼ˆéå®˜æ–¹ï¼‰ï¼šhttps://github.com/iluwatar/java-design-patterns\næ„å›¾ ç”¨æˆ·å¯¹èšåˆå™¨æœåŠ¡è¿›è¡Œä¸€æ¬¡è°ƒç”¨ï¼Œç„¶åèšåˆå™¨å°†è°ƒç”¨æ¯ä¸ªç›¸å…³çš„å¾®æœåŠ¡ã€‚\nAggregator Microservices æ˜¯ä¸€ç§å¾®æœåŠ¡æ¶æ„æ¨¡å¼ï¼Œç”¨äºè§£å†³å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ•°æ®èšåˆé—®é¢˜ã€‚è¯¥æ¨¡å¼é€šå¸¸ç”¨äºæœ‰å¤šä¸ªæ•°æ®æºçš„åœºæ™¯ï¼Œä¾‹å¦‚ç”µå­å•†åŠ¡ç½‘ç«™ä¸­çš„äº§å“åˆ—è¡¨é¡µé¢ï¼Œå…¶ä¸­éœ€è¦ä»å¤šä¸ªæœåŠ¡ä¸­è·å–äº§å“ä¿¡æ¯å¹¶ç»„åˆåœ¨ä¸€èµ·æ˜¾ç¤ºã€‚\nAggregator Microservices æ¨¡å¼åŒ…æ‹¬ä¸€ä¸ªèšåˆå™¨æœåŠ¡å’Œå¤šä¸ªåç«¯æœåŠ¡ã€‚èšåˆå™¨æœåŠ¡è´Ÿè´£ä»å¤šä¸ªåç«¯æœåŠ¡ä¸­æ”¶é›†æ•°æ®ï¼Œå¹¶å°†æ•°æ®ç»„åˆæˆä¸€ä¸ªèšåˆçš„å“åº”ã€‚åç«¯æœåŠ¡åˆ™è´Ÿè´£æä¾›ç‰¹å®šçš„æ•°æ®æºï¼Œä¾‹å¦‚äº§å“ä¿¡æ¯ã€åº“å­˜ä¿¡æ¯ã€ä»·æ ¼ä¿¡æ¯ç­‰ã€‚\nè§£é‡Š çœŸå®ä¸–ç•Œä¾‹å­\næˆ‘ä»¬çš„ç½‘ç»œå¸‚åœºéœ€è¦æœ‰å…³äº§å“åŠå…¶å½“å‰åº“å­˜çš„ä¿¡æ¯ã€‚ å®ƒè°ƒç”¨èšåˆæœåŠ¡ï¼ŒèšåˆæœåŠ¡ä¾æ¬¡è°ƒç”¨äº§å“ä¿¡æ¯å¾®æœåŠ¡å’Œäº§å“åº“å­˜å¾®æœåŠ¡ï¼Œè¿”å›ç»„åˆä¿¡æ¯ã€‚\né€šä¿—åœ°è¯´\nèšåˆå™¨å¾®æœåŠ¡ä»å„ç§å¾®æœåŠ¡ä¸­æ”¶é›†æ•°æ®ï¼Œå¹¶è¿”å›ä¸€ä¸ªèšåˆæ•°æ®ä»¥è¿›è¡Œå¤„ç†ã€‚\nStack Overflow ä¸Šè¯´\nèšåˆå™¨å¾®æœåŠ¡è°ƒç”¨å¤šä¸ªæœåŠ¡ä»¥å®ç°åº”ç”¨ç¨‹åºæ‰€éœ€çš„åŠŸèƒ½ã€‚\nç¨‹åºç¤ºä¾‹\nè®©æˆ‘ä»¬ä»æ•°æ®æ¨¡å‹å¼€å§‹ã€‚ è¿™æ˜¯æˆ‘ä»¬çš„äº§å“ã€‚\npublic class Product { private String title; private int productInventories; // getters and setters -\u0026gt; ... } æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä»‹ç»æˆ‘ä»¬çš„èšåˆå™¨å¾®æœåŠ¡ã€‚ å®ƒåŒ…å«ç”¨äºè°ƒç”¨ç›¸åº”å¾®æœåŠ¡çš„å®¢æˆ·ç«¯ProductInformationClientå’Œ ProductInventoryClientã€‚\n@RestController public class Aggregator { @Resource private ProductInformationClient informationClient; @Resource private ProductInventoryClient inventoryClient; @RequestMapping(path = \u0026#34;/product\u0026#34;, method = RequestMethod.GET) public Product getProduct() { var product = new Product(); var productTitle = informationClient.getProductTitle(); var productInventory = inventoryClient.getProductInventories(); //Fallback to error message product.setTitle(requireNonNullElse(productTitle, \u0026#34;Error: Fetching Product Title Failed\u0026#34;)); //Fallback to default error inventory product.setProductInventories(requireNonNullElse(productInventory, -1)); return product; } } è¿™æ˜¯äº§å“ä¿¡æ¯å¾®æœåŠ¡çš„ç²¾åå®ç°ã€‚ åº“å­˜å¾®æœåŠ¡ç±»ä¼¼ï¼Œå®ƒåªè¿”å›åº“å­˜è®¡æ•°ã€‚\n@RestController public class InformationController { @RequestMapping(value = \u0026#34;/information\u0026#34;, method = RequestMethod.GET) public String getProductTitle() { return \u0026#34;The Product Title.\u0026#34;; } } ç°åœ¨è°ƒç”¨æˆ‘ä»¬çš„èšåˆå™¨ REST API ä¼šè¿”å›äº§å“ä¿¡æ¯ã€‚\ncurl http://localhost:50004/product {\u0026#34;title\u0026#34;:\u0026#34;The Product Title.\u0026#34;,\u0026#34;productInventories\u0026#34;:5} ç‰¹ç‚¹ ä»¥ä¸‹æ˜¯è¯¥æ¨¡å¼çš„ä¸€äº›å…³é”®ç‰¹ç‚¹ï¼š\nå¤šä¸ªåç«¯æœåŠ¡ï¼šAggregator Microservices æ¨¡å¼é€šå¸¸æ¶‰åŠå¤šä¸ªåç«¯æœåŠ¡ï¼Œæ¯ä¸ªåç«¯æœåŠ¡è´Ÿè´£æä¾›ç‰¹å®šç±»å‹çš„æ•°æ®ã€‚ æ•°æ®èšåˆï¼šèšåˆå™¨æœåŠ¡è´Ÿè´£ä»å¤šä¸ªåç«¯æœåŠ¡ä¸­æ”¶é›†æ•°æ®ï¼Œå¹¶å°†æ•°æ®ç»„åˆæˆä¸€ä¸ªèšåˆçš„å“åº”ã€‚ é€æ˜çš„ç»„åˆï¼šèšåˆå™¨æœåŠ¡åº”è¯¥å°½å¯èƒ½é€æ˜åœ°ç»„åˆæ•°æ®ï¼Œä½¿å…¶å¯¹è°ƒç”¨æ–¹çœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªå•ä¸€çš„æ•°æ®æºã€‚ å¼‚æ­¥é€šä¿¡ï¼šç”±äºåç«¯æœåŠ¡å¯èƒ½ä½äºä¸åŒçš„ç½‘ç»œä½ç½®ï¼Œèšåˆå™¨æœåŠ¡é€šå¸¸ä½¿ç”¨å¼‚æ­¥é€šä¿¡æ¥æ”¶é›†æ•°æ®ã€‚ Aggregator Microservices æ¨¡å¼å¯ä»¥å¸¦æ¥è®¸å¤šå¥½å¤„ï¼Œä¾‹å¦‚ï¼š\nå¯ä¼¸ç¼©æ€§ï¼šç”±äºèšåˆå™¨æœåŠ¡å¯ä»¥å¹¶è¡Œåœ°ä»å¤šä¸ªåç«¯æœåŠ¡ä¸­æ”¶é›†æ•°æ®ï¼Œå› æ­¤è¯¥æ¨¡å¼å¯ä»¥é€šè¿‡å¢åŠ åç«¯æœåŠ¡æ¥å®ç°å¯ä¼¸ç¼©æ€§ã€‚ ä½è€¦åˆæ€§ï¼šåç«¯æœåŠ¡å’Œèšåˆå™¨æœåŠ¡ä¹‹é—´çš„ä½è€¦åˆæ€§ä½¿å¾—ç³»ç»Ÿæ›´åŠ çµæ´»ï¼Œå¯ä»¥æ›´è½»æ¾åœ°æ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤åç«¯æœåŠ¡ã€‚ å¯å®šåˆ¶æ€§ï¼šèšåˆå™¨æœåŠ¡å¯ä»¥æ ¹æ®éœ€è¦è‡ªå®šä¹‰æ•°æ®èšåˆçš„é€»è¾‘ï¼Œä»¥æ»¡è¶³ç‰¹å®šçš„ä¸šåŠ¡éœ€æ±‚ã€‚ ç±»å›¾ é€‚ç”¨æ€§ Aggregator Microservices æ¨¡å¼å¯ä»¥åº”ç”¨äºå„ç§ä¸åŒçš„åœºæ™¯ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„åº”ç”¨ï¼š\nç”µå­å•†åŠ¡å¹³å°ï¼šåœ¨ç”µå­å•†åŠ¡å¹³å°ä¸­ï¼Œé€šå¸¸éœ€è¦ä»å¤šä¸ªä¾›åº”å•†é‚£é‡Œè·å–äº§å“ä¿¡æ¯å’Œä»·æ ¼ï¼Œå¹¶å°†å…¶èšåˆåˆ°ä¸€ä¸ªç»Ÿä¸€çš„äº§å“åˆ—è¡¨ä¸­ã€‚Aggregator Microservices å¯ä»¥ç”¨æ¥å¤„ç†è¿™äº›æ•°æ®æºï¼Œå¹¶å°†æ•°æ®èšåˆåˆ°ä¸€ä¸ªå…±åŒçš„äº§å“åˆ—è¡¨ä¸­ã€‚ æ–°é—»èšåˆå¹³å°ï¼šåœ¨æ–°é—»èšåˆå¹³å°ä¸­ï¼Œéœ€è¦ä»ä¸åŒçš„æ–°é—»æ¥æºè·å–æ–°é—»å†…å®¹ï¼Œå¹¶å°†å…¶èšåˆåˆ°ä¸€ä¸ªç»Ÿä¸€çš„æ–°é—»åˆ—è¡¨ä¸­ã€‚Aggregator Microservices å¯ä»¥ç”¨æ¥å¤„ç†è¿™äº›æ–°é—»æ¥æºï¼Œå¹¶å°†æ–°é—»å†…å®¹èšåˆåˆ°ä¸€ä¸ªå…±åŒçš„æ–°é—»åˆ—è¡¨ä¸­ã€‚ é‡‘èæ•°æ®åˆ†æï¼šåœ¨é‡‘èæ•°æ®åˆ†æä¸­ï¼Œéœ€è¦ä»å¤šä¸ªæ•°æ®æºä¸­è·å–æ•°æ®ï¼Œä¾‹å¦‚è‚¡ç¥¨å¸‚åœºæ•°æ®ã€è´§å¸æ±‡ç‡æ•°æ®ã€ç»æµæŒ‡æ ‡æ•°æ®ç­‰ï¼Œå¹¶å°†æ•°æ®èšåˆåˆ°ä¸€ä¸ªç»Ÿä¸€çš„æ•°æ®åˆ†æå·¥å…·ä¸­ã€‚Aggregator Microservices å¯ä»¥ç”¨æ¥å¤„ç†è¿™äº›æ•°æ®æºï¼Œå¹¶å°†æ•°æ®èšåˆåˆ°ä¸€ä¸ªå…±åŒçš„æ•°æ®åˆ†æå·¥å…·ä¸­ã€‚ ç‰©è”ç½‘å¹³å°ï¼šåœ¨ç‰©è”ç½‘å¹³å°ä¸­ï¼Œéœ€è¦ä»å¤šä¸ªä¼ æ„Ÿå™¨è·å–æ•°æ®ï¼Œå¹¶å°†å…¶èšåˆåˆ°ä¸€ä¸ªç»Ÿä¸€çš„æ•°æ®ä¸­å¿ƒä¸­ã€‚Aggregator Microservices å¯ä»¥ç”¨æ¥å¤„ç†è¿™äº›ä¼ æ„Ÿå™¨æ•°æ®æºï¼Œå¹¶å°†æ•°æ®èšåˆåˆ°ä¸€ä¸ªå…±åŒçš„æ•°æ®ä¸­å¿ƒä¸­ã€‚ Aggregator Microservices å¯ä»¥ä½¿ç”¨å¤šç§å®ç°æ–¹å¼æ¥å®ç°æ•°æ®èšåˆï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„å®ç°æ–¹å¼ï¼š\nåŒæ­¥é˜»å¡æ–¹å¼ï¼šåœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œèšåˆå™¨æœåŠ¡æŒ‰ç…§é¡ºåºä»å¤šä¸ªåç«¯æœåŠ¡ä¸­æ”¶é›†æ•°æ®ï¼Œæ¯æ¬¡æ”¶é›†å®Œä¸€ä¸ªæœåŠ¡çš„æ•°æ®åå†æ”¶é›†ä¸‹ä¸€ä¸ªæœåŠ¡çš„æ•°æ®ï¼Œç›´åˆ°æ‰€æœ‰æ•°æ®éƒ½è¢«æ”¶é›†å®Œæ¯•ã€‚è¿™ç§æ–¹å¼çš„ç¼ºç‚¹æ˜¯æ•ˆç‡è¾ƒä½ï¼Œå› ä¸ºæ‰€æœ‰æ“ä½œéƒ½æ˜¯åŒæ­¥é˜»å¡çš„ã€‚ å¼‚æ­¥éé˜»å¡æ–¹å¼ï¼šåœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œèšåˆå™¨æœåŠ¡ä½¿ç”¨å¼‚æ­¥éé˜»å¡çš„æ–¹å¼ä»å¤šä¸ªåç«¯æœåŠ¡ä¸­æ”¶é›†æ•°æ®ï¼Œè¿™å¯ä»¥æé«˜æ•ˆç‡å’Œæ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œèšåˆå™¨æœåŠ¡å¯ä»¥ä½¿ç”¨ Java 8 çš„ CompletableFuture å’Œæµå¼ API æ¥å®ç°å¼‚æ­¥é€šä¿¡å¹¶è¡Œæ”¶é›†æ•°æ®ã€‚ æ•°æ®åº“æ–¹å¼ï¼šåœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œæ¯ä¸ªåç«¯æœåŠ¡è´Ÿè´£å°†æ•°æ®å†™å…¥æ•°æ®åº“ä¸­ï¼Œèšåˆå™¨æœåŠ¡å†ä»æ•°æ®åº“ä¸­è¯»å–æ•°æ®å¹¶è¿›è¡Œèšåˆã€‚è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯å¯ä»¥ä½¿ç”¨æ•°æ®åº“çš„é«˜æ•ˆæŸ¥è¯¢è¯­å¥æ¥èšåˆæ•°æ®ï¼Œä½†ç¼ºç‚¹æ˜¯éœ€è¦é¢å¤–çš„æ•°æ®åº“ç®¡ç†å¼€é”€ã€‚ æ¶ˆæ¯é˜Ÿåˆ—æ–¹å¼ï¼šåœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œæ¯ä¸ªåç«¯æœåŠ¡å°†æ•°æ®å‘é€åˆ°ä¸€ä¸ªå…±äº«çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œèšåˆå™¨æœåŠ¡å†ä»é˜Ÿåˆ—ä¸­è·å–æ•°æ®å¹¶è¿›è¡Œèšåˆã€‚è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯å¯ä»¥å®ç°å¼‚æ­¥é€šä¿¡ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„é«˜æ•ˆæ¶ˆæ¯ä¼ é€’æœºåˆ¶æ¥å®ç°æ•°æ®èšåˆï¼Œä½†ç¼ºç‚¹æ˜¯éœ€è¦é¢å¤–çš„æ¶ˆæ¯é˜Ÿåˆ—ç®¡ç†å¼€é”€ã€‚ è¾¹ç¼˜è®¡ç®—æ–¹å¼ï¼šåœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œèšåˆå™¨æœåŠ¡å¯ä»¥åœ¨è¾¹ç¼˜è®¾å¤‡ä¸­è¿è¡Œï¼Œç›´æ¥ä»å¤šä¸ªä¼ æ„Ÿå™¨æˆ–è®¾å¤‡ä¸­æ”¶é›†æ•°æ®å¹¶è¿›è¡Œèšåˆã€‚è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯å¯ä»¥å‡å°‘æ•°æ®ä¼ è¾“å’Œå­˜å‚¨çš„å¼€é”€ï¼Œä½†ç¼ºç‚¹æ˜¯éœ€è¦å¤„ç†è¾¹ç¼˜è®¾å¤‡çš„ç¡¬ä»¶å’Œè½¯ä»¶é™åˆ¶ã€‚ å½“ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ–¹å¼æ¥å®ç° Aggregator Microservices æ—¶ï¼Œå¯ä»¥åº”ç”¨äºä»¥ä¸‹ä¸€äº›å®é™…çš„åœºæ™¯ï¼š\næ—¥å¿—èšåˆï¼šåœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¯èƒ½ä¼šç”Ÿæˆå¤§é‡çš„æ—¥å¿—æ•°æ®ï¼Œå¦‚æœå°†æ‰€æœ‰çš„æ—¥å¿—æ•°æ®å‘é€åˆ°ä¸­å¿ƒæœåŠ¡å™¨ä¸Šè¿›è¡Œèšåˆï¼Œè¿™ä¼šå¯¼è‡´ä¸­å¿ƒæœåŠ¡å™¨çš„å‹åŠ›éå¸¸å¤§ã€‚ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ–¹å¼ï¼Œå¯ä»¥å°†æ—¥å¿—æ•°æ®å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå†ç”±èšåˆå™¨æœåŠ¡ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å–æ•°æ®æ¥è¿›è¡Œèšåˆï¼Œè¿™æ ·å¯ä»¥é™ä½ä¸­å¿ƒæœåŠ¡å™¨çš„å‹åŠ›ï¼Œæé«˜ç³»ç»Ÿçš„å¯ä¼¸ç¼©æ€§å’Œæ€§èƒ½ã€‚\nç”µå•†å¹³å°è®¢å•å¤„ç†ï¼šåœ¨ä¸€ä¸ªç”µå•†å¹³å°ä¸­ï¼Œè®¢å•æ•°æ®å¯èƒ½ä¼šåˆ†æ•£åœ¨å¤šä¸ªè®¢å•ç³»ç»Ÿä¸­ï¼Œä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ–¹å¼ï¼Œå¯ä»¥å°†è®¢å•æ•°æ®å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå†ç”±èšåˆå™¨æœåŠ¡ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å–æ•°æ®æ¥è¿›è¡Œèšåˆï¼Œè¿™æ ·å¯ä»¥å®ç°è®¢å•æ•°æ®çš„ç»Ÿä¸€å¤„ç†ï¼Œæé«˜ç³»ç»Ÿçš„å¯é æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚\nç‰©è”ç½‘æ•°æ®èšåˆï¼šåœ¨ä¸€ä¸ªç‰©è”ç½‘ç³»ç»Ÿä¸­ï¼Œå¯èƒ½éœ€è¦ä»å¤šä¸ªä¼ æ„Ÿå™¨ä¸­è·å–æ•°æ®ï¼Œå¹¶å°†æ•°æ®èšåˆåˆ°ä¸€ä¸ªå…±åŒçš„æ•°æ®ä¸­å¿ƒä¸­ã€‚ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ–¹å¼ï¼Œå¯ä»¥å°†ä¼ æ„Ÿå™¨æ•°æ®å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå†ç”±èšåˆå™¨æœåŠ¡ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å–æ•°æ®æ¥è¿›è¡Œèšåˆï¼Œè¿™æ ·å¯ä»¥æé«˜ç³»ç»Ÿçš„å¯ä¼¸ç¼©æ€§å’Œæ€§èƒ½ï¼Œå¹¶ä¸”ç¼“è§£è¾¹ç¼˜è®¾å¤‡çš„è´Ÿè½½å‹åŠ›ã€‚\nå®æ—¶æ•°æ®å¤„ç†ï¼šåœ¨ä¸€ä¸ªå®æ—¶æ•°æ®å¤„ç†ç³»ç»Ÿä¸­ï¼Œå¯èƒ½éœ€è¦ä»å¤šä¸ªæ•°æ®æºä¸­è·å–æ•°æ®ï¼Œå¹¶å°†æ•°æ®èšåˆåˆ°ä¸€ä¸ªå…±åŒçš„æ•°æ®å¤„ç†ä¸­å¿ƒä¸­ã€‚ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ–¹å¼ï¼Œå¯ä»¥å°†å®æ—¶æ•°æ®å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå†ç”±èšåˆå™¨æœåŠ¡ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å–æ•°æ®æ¥è¿›è¡Œèšåˆï¼Œè¿™æ ·å¯ä»¥å®ç°å®æ—¶æ•°æ®çš„å¿«é€Ÿå¤„ç†å’Œåˆ†æã€‚\nä¸€ä¸ªå¼‚æ­¥èšåˆæœåŠ¡ç¤ºä¾‹ï¼š\n// èšåˆå™¨æœåŠ¡ç±» public class AggregatorService { // åç«¯æœåŠ¡åˆ—è¡¨ private List\u0026lt;BackendService\u0026gt; backendServices; public AggregatorService(List\u0026lt;BackendService\u0026gt; backendServices) { this.backendServices = backendServices; } // èšåˆæ•°æ®çš„æ–¹æ³• public List\u0026lt;Product\u0026gt; getProducts() { List\u0026lt;Product\u0026gt; products = new ArrayList\u0026lt;\u0026gt;(); // å¹¶è¡Œæ”¶é›†æ•°æ® List\u0026lt;CompletableFuture\u0026lt;List\u0026lt;Product\u0026gt;\u0026gt;\u0026gt; futures = backendServices.stream() .map(backendService -\u0026gt; CompletableFuture.supplyAsync(() -\u0026gt; backendService.getProducts())) .collect(Collectors.toList()); // ç­‰å¾…æ‰€æœ‰å¼‚æ­¥æ“ä½œå®Œæˆå¹¶èšåˆæ•°æ® CompletableFuture.allOf(futures.toArray(new CompletableFuture[futures.size()])) .join(); futures.stream() .map(CompletableFuture::join) .forEach(products::addAll); return products; } } // åç«¯æœåŠ¡æ¥å£ public interface BackendService { List\u0026lt;Product\u0026gt; getProducts(); } // åç«¯æœåŠ¡å®ç°ç±»1 public class BackendServiceA implements BackendService { @Override public List\u0026lt;Product\u0026gt; getProducts() { // ä»æ•°æ®åº“è·å–äº§å“ä¿¡æ¯ List\u0026lt;Product\u0026gt; products = new ArrayList\u0026lt;\u0026gt;(); products.add(new Product(\u0026#34;Product A1\u0026#34;, 10.0)); products.add(new Product(\u0026#34;Product A2\u0026#34;, 20.0)); products.add(new Product(\u0026#34;Product A3\u0026#34;, 30.0)); return products; } } // åç«¯æœåŠ¡å®ç°ç±»2 public class BackendServiceB implements BackendService { @Override public List\u0026lt;Product\u0026gt; getProducts() { // ä»APIè·å–äº§å“ä¿¡æ¯ List\u0026lt;Product\u0026gt; products = new ArrayList\u0026lt;\u0026gt;(); products.add(new Product(\u0026#34;Product B1\u0026#34;, 15.0)); products.add(new Product(\u0026#34;Product B2\u0026#34;, 25.0)); return products; } } // äº§å“ç±» public class Product { private String name; private double price; public Product(String name, double price) { this.name = name; this.price = price; } // çœç•¥ getter å’Œ setter æ–¹æ³• } åœ¨ä¸Šè¿°ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªèšåˆå™¨æœåŠ¡ç±» AggregatorServiceï¼Œå®ƒåŒ…å«äº†å¤šä¸ªåç«¯æœåŠ¡æ¥å£ BackendService çš„å®ç°ç±» BackendServiceA å’Œ BackendServiceBã€‚èšåˆå™¨æœåŠ¡ç±»çš„ getProducts() æ–¹æ³•è´Ÿè´£ä»å¤šä¸ªåç«¯æœåŠ¡ä¸­æ”¶é›†äº§å“æ•°æ®ï¼Œå¹¶å°†æ•°æ®ç»„åˆæˆä¸€ä¸ªèšåˆçš„å“åº”ã€‚åœ¨æ”¶é›†æ•°æ®æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Java 8 çš„ CompletableFuture å’Œæµå¼ API æ¥å®ç°å¼‚æ­¥é€šä¿¡å¹¶è¡Œæ”¶é›†æ•°æ®ã€‚æœ€åï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç®€å•çš„äº§å“ç±» Productï¼Œç”¨äºå°è£…äº§å“ä¿¡æ¯ã€‚\nAggregator Microservices æ¨¡å¼å·²ç»å¾—åˆ°äº†å¹¿æ³›çš„åº”ç”¨å’Œæ”¯æŒï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„å¼€æºæ¡†æ¶å’Œå·¥å…·ï¼Œå®ƒä»¬æä¾›äº† Aggregator Microservices æ¨¡å¼çš„å®ç°ï¼š\nApache Camelï¼šæ˜¯ä¸€ä¸ªåŸºäº Java çš„å¼€æºæ¡†æ¶ï¼Œç”¨äºå¿«é€Ÿå®ç°å„ç§ä¼ä¸šé›†æˆæ¨¡å¼ï¼ˆEIPï¼‰ï¼ŒåŒ…æ‹¬èšåˆå™¨æ¨¡å¼ã€‚Apache Camel æä¾›äº†å¤šç§èšåˆå™¨ç»„ä»¶ï¼Œä¾‹å¦‚ Aggregatorã€Splitterã€Resequencer ç­‰ï¼Œå¯ä»¥çµæ´»åœ°èšåˆå’Œå¤„ç†æ•°æ®ã€‚\nSpring Integrationï¼šæ˜¯ Spring ç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¸€ä¸ªé›†æˆæ¡†æ¶ï¼Œä¹Ÿæ”¯æŒ Aggregator Microservices æ¨¡å¼ã€‚Spring Integration æä¾›äº†å¤šç§èšåˆå™¨ç»„ä»¶ï¼Œä¾‹å¦‚ Aggregatorã€Barrierã€ReleaseStrategy ç­‰ï¼Œå¯ä»¥ç”¨æ¥èšåˆå’Œå¤„ç†æ¶ˆæ¯ã€‚\nApache Kafkaï¼šæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æµå¤„ç†å¹³å°ï¼Œç”¨äºå¤„ç†é«˜ååé‡çš„å®æ—¶æ•°æ®æµï¼Œä¹Ÿæ”¯æŒ Aggregator Microservices æ¨¡å¼ã€‚Apache Kafka æä¾›äº†æ¶ˆæ¯é˜Ÿåˆ—å’Œæµå¤„ç†åŠŸèƒ½ï¼Œå¯ä»¥ç”¨æ¥èšåˆå’Œå¤„ç†æ•°æ®æµã€‚\nRabbitMQï¼šæ˜¯ä¸€ä¸ªå¼€æºçš„æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼Œæ”¯æŒå¤šç§æ¶ˆæ¯åè®®å’Œæ¶ˆæ¯æ¨¡å¼ï¼Œä¹Ÿæ”¯æŒ Aggregator Microservices æ¨¡å¼ã€‚RabbitMQ æä¾›äº†å¤šç§æ¶ˆæ¯åè®®å’Œæ¶ˆæ¯æ¨¡å¼ï¼Œå¯ä»¥ç”¨æ¥èšåˆå’Œå¤„ç†æ¶ˆæ¯ã€‚\nApache Sparkï¼šæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶ï¼Œç”¨äºå¤„ç†å¤§è§„æ¨¡æ•°æ®é›†ï¼Œä¹Ÿæ”¯æŒ Aggregator Microservices æ¨¡å¼ã€‚Apache Spark æä¾›äº†å¤šç§æ•°æ®å¤„ç†å’ŒèšåˆåŠŸèƒ½ï¼Œå¯ä»¥ç”¨æ¥èšåˆå’Œå¤„ç†å¤§è§„æ¨¡æ•°æ®é›†ã€‚\nå‚è€ƒæ–‡ç«  Microservice Design Patterns Microservices Patterns: With examples in Java Architectural Patterns: Uncover essential patterns in the most indispensable realm of enterprise architecture ","permalink":"https://blog.chensoul.cc/posts/2023/06/26/java-design-patterns-aggregator-microservices/","summary":"æœ¬æ–‡ä¸»è¦ä»‹ç» Aggregator Microservices æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nJava Design Patterns æä¾›äº†å„ç§ Java è®¾è®¡æ¨¡å¼çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ã€‚è¯¥ç½‘ç«™æ—¨åœ¨å¸®åŠ© Java å¼€å‘äººå‘˜äº†è§£å’Œåº”ç”¨å„ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚\nJava Design Patterns ç½‘ç«™æä¾›äº†å¤šç§è®¾è®¡æ¨¡å¼åˆ†ç±»æ–¹å¼ï¼ŒåŒ…æ‹¬åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational Patternsï¼‰ã€ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternsï¼‰å’Œè¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰ï¼Œä»¥åŠå…¶ä»–ä¸€äº›å¸¸è§çš„æ¨¡å¼ã€‚\nå¯¹äºæ¯ä¸ªè®¾è®¡æ¨¡å¼ï¼Œè¯¥ç½‘ç«™æä¾›äº†è¯¦ç»†çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ï¼Œå¹¶ä¸”æä¾›äº†ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ã€‚å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©é€‚åˆè‡ªå·±çš„è®¾è®¡æ¨¡å¼ï¼Œå¹¶ä¸”å¯ä»¥å‚è€ƒç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜æ¥ç†è§£å’Œåº”ç”¨è¯¥æ¨¡å¼ã€‚\næ­¤å¤–ï¼ŒJava Design Patterns ç½‘ç«™è¿˜æä¾›äº†ä¸€äº›å…¶ä»–èµ„æºï¼Œå¦‚è®¾è®¡æ¨¡å¼çš„ UML å›¾ã€è®¾è®¡æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ã€è®¾è®¡æ¨¡å¼çš„æ¯”è¾ƒç­‰ã€‚è¿™äº›èµ„æºå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨è®¾è®¡æ¨¡å¼ã€‚\nä¸­æ–‡ç½‘ç«™ï¼šhttps://java-design-patterns.com/zh/\nGithub ä¸Šæºç ä»“åº“ï¼ˆéå®˜æ–¹ï¼‰ï¼šhttps://github.com/iluwatar/java-design-patterns\næ„å›¾ ç”¨æˆ·å¯¹èšåˆå™¨æœåŠ¡è¿›è¡Œä¸€æ¬¡è°ƒç”¨ï¼Œç„¶åèšåˆå™¨å°†è°ƒç”¨æ¯ä¸ªç›¸å…³çš„å¾®æœåŠ¡ã€‚\nAggregator Microservices æ˜¯ä¸€ç§å¾®æœåŠ¡æ¶æ„æ¨¡å¼ï¼Œç”¨äºè§£å†³å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ•°æ®èšåˆé—®é¢˜ã€‚è¯¥æ¨¡å¼é€šå¸¸ç”¨äºæœ‰å¤šä¸ªæ•°æ®æºçš„åœºæ™¯ï¼Œä¾‹å¦‚ç”µå­å•†åŠ¡ç½‘ç«™ä¸­çš„äº§å“åˆ—è¡¨é¡µé¢ï¼Œå…¶ä¸­éœ€è¦ä»å¤šä¸ªæœåŠ¡ä¸­è·å–äº§å“ä¿¡æ¯å¹¶ç»„åˆåœ¨ä¸€èµ·æ˜¾ç¤ºã€‚\nAggregator Microservices æ¨¡å¼åŒ…æ‹¬ä¸€ä¸ªèšåˆå™¨æœåŠ¡å’Œå¤šä¸ªåç«¯æœåŠ¡ã€‚èšåˆå™¨æœåŠ¡è´Ÿè´£ä»å¤šä¸ªåç«¯æœåŠ¡ä¸­æ”¶é›†æ•°æ®ï¼Œå¹¶å°†æ•°æ®ç»„åˆæˆä¸€ä¸ªèšåˆçš„å“åº”ã€‚åç«¯æœåŠ¡åˆ™è´Ÿè´£æä¾›ç‰¹å®šçš„æ•°æ®æºï¼Œä¾‹å¦‚äº§å“ä¿¡æ¯ã€åº“å­˜ä¿¡æ¯ã€ä»·æ ¼ä¿¡æ¯ç­‰ã€‚\nè§£é‡Š çœŸå®ä¸–ç•Œä¾‹å­\næˆ‘ä»¬çš„ç½‘ç»œå¸‚åœºéœ€è¦æœ‰å…³äº§å“åŠå…¶å½“å‰åº“å­˜çš„ä¿¡æ¯ã€‚ å®ƒè°ƒç”¨èšåˆæœåŠ¡ï¼ŒèšåˆæœåŠ¡ä¾æ¬¡è°ƒç”¨äº§å“ä¿¡æ¯å¾®æœåŠ¡å’Œäº§å“åº“å­˜å¾®æœåŠ¡ï¼Œè¿”å›ç»„åˆä¿¡æ¯ã€‚\né€šä¿—åœ°è¯´\nèšåˆå™¨å¾®æœåŠ¡ä»å„ç§å¾®æœåŠ¡ä¸­æ”¶é›†æ•°æ®ï¼Œå¹¶è¿”å›ä¸€ä¸ªèšåˆæ•°æ®ä»¥è¿›è¡Œå¤„ç†ã€‚\nStack Overflow ä¸Šè¯´\nèšåˆå™¨å¾®æœåŠ¡è°ƒç”¨å¤šä¸ªæœåŠ¡ä»¥å®ç°åº”ç”¨ç¨‹åºæ‰€éœ€çš„åŠŸèƒ½ã€‚\nç¨‹åºç¤ºä¾‹\nè®©æˆ‘ä»¬ä»æ•°æ®æ¨¡å‹å¼€å§‹ã€‚ è¿™æ˜¯æˆ‘ä»¬çš„äº§å“ã€‚\npublic class Product { private String title; private int productInventories; // getters and setters -\u0026gt; ... } æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä»‹ç»æˆ‘ä»¬çš„èšåˆå™¨å¾®æœåŠ¡ã€‚ å®ƒåŒ…å«ç”¨äºè°ƒç”¨ç›¸åº”å¾®æœåŠ¡çš„å®¢æˆ·ç«¯ProductInformationClientå’Œ ProductInventoryClientã€‚\n@RestController public class Aggregator { @Resource private ProductInformationClient informationClient; @Resource private ProductInventoryClient inventoryClient; @RequestMapping(path = \u0026#34;/product\u0026#34;, method = RequestMethod.GET) public Product getProduct() { var product = new Product(); var productTitle = informationClient.","title":"Javaè®¾è®¡æ¨¡å¼ï¼šAggregator Microservices"},{"content":" æœ¬æ–‡æ¢è®¨äº† Python æ¨¡å—å’Œ Python åŒ…ï¼Œè¿™ä¸¤ç§æœºåˆ¶æœ‰åŠ©äºæ¨¡å—åŒ–ç¼–ç¨‹ã€‚\næ¨¡å—åŒ–ç¼–ç¨‹æ˜¯æŒ‡å°†å¤§å‹ã€ç¬¨é‡çš„ç¼–ç¨‹ä»»åŠ¡åˆ†è§£ä¸ºå•ç‹¬çš„ã€æ›´å°çš„ã€æ›´æ˜“äºç®¡ç†çš„å­ä»»åŠ¡æˆ–æ¨¡å—çš„è¿‡ç¨‹ã€‚ç„¶åå¯ä»¥åƒæ„å»ºå—ä¸€æ ·å°†å„ä¸ªæ¨¡å—æ‹¼å‡‘åœ¨ä¸€èµ·ä»¥åˆ›å»ºæ›´å¤§çš„åº”ç”¨ç¨‹åºã€‚\nåœ¨å¤§å‹åº”ç”¨ç¨‹åºä¸­æ¨¡å—åŒ–ä»£ç æœ‰å‡ ä¸ªä¼˜ç‚¹ï¼š\nç®€å•æ€§ï¼šæ¨¡å—é€šå¸¸ä¸ä¼šä¸“æ³¨äºæ‰‹å¤´çš„æ•´ä¸ªé—®é¢˜ï¼Œè€Œæ˜¯ä¸“æ³¨äºé—®é¢˜çš„ä¸€ä¸ªç›¸å¯¹è¾ƒå°çš„éƒ¨åˆ†ã€‚å¦‚æœæ‚¨æ­£åœ¨å¤„ç†å•ä¸ªæ¨¡å—ï¼Œé‚£ä¹ˆæ‚¨å°†æœ‰ä¸€ä¸ªè¾ƒå°çš„é—®é¢˜åŸŸæ¥è§£å†³é—®é¢˜ã€‚è¿™ä½¿å¾—å¼€å‘æ›´å®¹æ˜“å¹¶ä¸”æ›´ä¸å®¹æ˜“å‡ºé”™ã€‚\nå¯ç»´æŠ¤æ€§ï¼šæ¨¡å—é€šå¸¸è®¾è®¡ä¸ºåœ¨ä¸åŒé—®é¢˜åŸŸä¹‹é—´å¼ºåˆ¶æ‰§è¡Œé€»è¾‘è¾¹ç•Œã€‚å¦‚æœæ¨¡å—æ˜¯ä»¥æœ€å°åŒ–ç›¸äº’ä¾èµ–çš„æ–¹å¼ç¼–å†™çš„ï¼Œé‚£ä¹ˆå¯¹å•ä¸ªæ¨¡å—çš„ä¿®æ”¹å¯¹ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†äº§ç”Ÿå½±å“çš„å¯èƒ½æ€§å°±ä¼šé™ä½ã€‚ï¼ˆæ‚¨ç”šè‡³å¯ä»¥åœ¨ä¸äº†è§£è¯¥æ¨¡å—ä¹‹å¤–çš„åº”ç”¨ç¨‹åºçš„æƒ…å†µä¸‹å¯¹è¯¥æ¨¡å—è¿›è¡Œæ›´æ”¹ã€‚ï¼‰è¿™ä½¿å¾—ç”±è®¸å¤šç¨‹åºå‘˜ç»„æˆçš„å›¢é˜Ÿåœ¨å¤§å‹åº”ç”¨ç¨‹åºä¸ŠååŒå·¥ä½œå˜å¾—æ›´åŠ å¯è¡Œã€‚\nå¯é‡ç”¨æ€§ï¼šåœ¨å•ä¸ªæ¨¡å—ä¸­å®šä¹‰çš„åŠŸèƒ½å¯ä»¥å¾ˆå®¹æ˜“åœ°è¢«åº”ç”¨ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†é‡ç”¨ï¼ˆé€šè¿‡é€‚å½“å®šä¹‰çš„æ¥å£ï¼‰ã€‚è¿™æ¶ˆé™¤äº†é‡å¤ä»£ç çš„éœ€è¦ã€‚\nä½œç”¨åŸŸï¼šæ¨¡å—é€šå¸¸å®šä¹‰ä¸€ä¸ªå•ç‹¬çš„åç§°ç©ºé—´ï¼Œè¿™æœ‰åŠ©äºé¿å…ç¨‹åºä¸åŒåŒºåŸŸä¸­æ ‡è¯†ç¬¦ä¹‹é—´çš„å†²çªã€‚ ï¼ˆPython ä¹‹ç¦…çš„ä¿¡æ¡ä¹‹ä¸€æ˜¯å‘½åç©ºé—´æ˜¯ä¸€ä¸ªéå¸¸æ£’çš„æƒ³æ³•â€”â€”è®©æˆ‘ä»¬åšæ›´å¤šè¿™æ ·çš„äº‹æƒ…å§ï¼ï¼‰\nå‡½æ•°ã€æ¨¡å—å’ŒåŒ…éƒ½æ˜¯ Python ä¸­ä¿ƒè¿›ä»£ç æ¨¡å—åŒ–çš„æ„é€ ã€‚\nPython æ¨¡å—ï¼šæ¦‚è¿° åœ¨ Python ä¸­å®é™…ä¸Šæœ‰ä¸‰ç§ä¸åŒçš„æ–¹å¼æ¥å®šä¹‰æ¨¡å—ï¼š\næ¨¡å—å¯ä»¥ç”¨ Python æœ¬èº«ç¼–å†™ã€‚\næ¨¡å—å¯ä»¥ç”¨ C è¯­è¨€ç¼–å†™å¹¶åœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½ï¼Œä¾‹å¦‚ re ï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼‰æ¨¡å—ã€‚\nå†…ç½®æ¨¡å—æœ¬è´¨ä¸ŠåŒ…å«åœ¨è§£é‡Šå™¨ä¸­ï¼Œä¾‹å¦‚ itertools æ¨¡å—ã€‚\nåœ¨æ‰€æœ‰ä¸‰ç§æƒ…å†µä¸‹ï¼Œæ¨¡å—çš„å†…å®¹éƒ½ä»¥ç›¸åŒçš„æ–¹å¼è®¿é—®ï¼šä½¿ç”¨ import è¯­å¥ã€‚\nåœ¨è¿™é‡Œï¼Œé‡ç‚¹å°†ä¸»è¦æ”¾åœ¨ç”¨ Python ç¼–å†™çš„æ¨¡å—ä¸Šã€‚ç”¨ Python ç¼–å†™çš„æ¨¡å—çš„å¦™å¤„åœ¨äºå®ƒä»¬çš„æ„å»ºéå¸¸ç®€å•ã€‚\næ‚¨éœ€è¦åšçš„å°±æ˜¯åˆ›å»ºä¸€ä¸ªåŒ…å«åˆæ³• Python ä»£ç çš„æ–‡ä»¶ï¼Œç„¶åä¸ºè¯¥æ–‡ä»¶æŒ‡å®šä¸€ä¸ªå¸¦æœ‰ .py æ‰©å±•åçš„åç§°ã€‚å°±æ˜¯è¿™æ ·ï¼ä¸éœ€è¦ç‰¹æ®Šçš„è¯­æ³•æˆ–å·«æœ¯ã€‚\nä¾‹å¦‚ï¼Œå‡è®¾æ‚¨åˆ›å»ºäº†ä¸€ä¸ªåä¸º mod.py çš„æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š\nmod.py\ns = \u0026#34;If Comrade Napoleon says it, it must be right.\u0026#34; a = [100, 200, 300] def foo(arg): print(f\u0026#39;arg = {arg}\u0026#39;) class Foo: pass mod.py ä¸­å®šä¹‰äº†å‡ ä¸ªå¯¹è±¡ï¼š\ns ï¼ˆå­—ç¬¦ä¸²ï¼‰ a ï¼ˆåˆ—è¡¨ï¼‰ foo() ï¼ˆå‡½æ•°ï¼‰ Foo ï¼ˆç±»ï¼‰ å‡è®¾ mod.py ä½äºé€‚å½“çš„ä½ç½®ï¼ˆæ‚¨å¾ˆå¿«å°±ä¼šäº†è§£æ›´å¤šä¿¡æ¯ï¼‰ï¼Œå¯ä»¥é€šè¿‡å¯¼å…¥æ¨¡å—æ¥è®¿é—®è¿™äº›å¯¹è±¡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\u0026gt;\u0026gt;\u0026gt; import mod \u0026gt;\u0026gt;\u0026gt; print(mod.s) If Comrade Napoleon says it, it must be right. \u0026gt;\u0026gt;\u0026gt; mod.a [100, 200, 300] \u0026gt;\u0026gt;\u0026gt; mod.foo([\u0026#39;quux\u0026#39;, \u0026#39;corge\u0026#39;, \u0026#39;grault\u0026#39;]) arg = [\u0026#39;quux\u0026#39;, \u0026#39;corge\u0026#39;, \u0026#39;grault\u0026#39;] \u0026gt;\u0026gt;\u0026gt; x = mod.Foo() \u0026gt;\u0026gt;\u0026gt; x \u0026lt;mod.Foo object at 0x03C181F0\u0026gt; æ¨¡å—æœç´¢è·¯å¾„ ç»§ç»­ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ Python æ‰§è¡Œè¯­å¥æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼š\nimport mod å½“è§£é‡Šå™¨æ‰§è¡Œä¸Šè¿° import è¯­å¥æ—¶ï¼Œå®ƒä¼šåœ¨ç”±ä»¥ä¸‹æ¥æºç»„è£…çš„ç›®å½•åˆ—è¡¨ä¸­æœç´¢ mod.py ï¼š\nè¿è¡Œè¾“å…¥è„šæœ¬çš„ç›®å½•æˆ–å½“å‰ç›®å½•ï¼ˆå¦‚æœè§£é‡Šå™¨æ­£åœ¨äº¤äº’å¼è¿è¡Œï¼‰ PYTHONPATH ç¯å¢ƒå˜é‡ä¸­åŒ…å«çš„ç›®å½•åˆ—è¡¨ï¼ˆå¦‚æœå·²è®¾ç½®ï¼‰ã€‚ ï¼ˆ PYTHONPATH çš„æ ¼å¼å–å†³äºæ“ä½œç³»ç»Ÿï¼Œä½†åº”æ¨¡ä»¿ PATH ç¯å¢ƒå˜é‡ã€‚ï¼‰ å®‰è£… Python æ—¶é…ç½®çš„ä¾èµ–äºå®‰è£…çš„ç›®å½•åˆ—è¡¨ ç”Ÿæˆçš„æœç´¢è·¯å¾„å¯åœ¨ Python å˜é‡ sys.path ä¸­è®¿é—®ï¼Œè¯¥å˜é‡æ˜¯ä»åä¸º sys çš„æ¨¡å—è·å–çš„ï¼š\n\u0026gt;\u0026gt;\u0026gt; import sys \u0026gt;\u0026gt;\u0026gt; sys.path [\u0026#39;\u0026#39;, \u0026#39;C:\\\\Users\\\\john\\\\Documents\\\\Python\\\\doc\u0026#39;, \u0026#39;C:\\\\Python36\\\\Lib\\\\idlelib\u0026#39;, \u0026#39;C:\\\\Python36\\\\python36.zip\u0026#39;, \u0026#39;C:\\\\Python36\\\\DLLs\u0026#39;, \u0026#39;C:\\\\Python36\\\\lib\u0026#39;, \u0026#39;C:\\\\Python36\u0026#39;, \u0026#39;C:\\\\Python36\\\\lib\\\\site-packages\u0026#39;] æ³¨æ„ï¼š sys.path çš„å…·ä½“å†…å®¹å–å†³äºå®‰è£…ã€‚å‡ ä¹å¯ä»¥è‚¯å®šï¼Œä¸Šé¢çš„å†…å®¹åœ¨æ‚¨çš„è®¡ç®—æœºä¸Šçœ‹èµ·æ¥ä¼šç•¥æœ‰ä¸åŒã€‚\nå› æ­¤ï¼Œä¸ºç¡®ä¿æ‰¾åˆ°æ‚¨çš„æ¨¡å—ï¼Œæ‚¨éœ€è¦æ‰§è¡Œä»¥ä¸‹æ“ä½œä¹‹ä¸€ï¼š\nå°† mod.py æ”¾å…¥è¾“å…¥è„šæœ¬æ‰€åœ¨ç›®å½•æˆ–å½“å‰ç›®å½•ï¼Œå¦‚æœæ˜¯äº¤äº’å¼çš„ åœ¨å¯åŠ¨è§£é‡Šå™¨ä¹‹å‰ä¿®æ”¹ PYTHONPATH ç¯å¢ƒå˜é‡ä»¥åŒ…å« mod.py æ‰€åœ¨ç›®å½• æˆ–è€…ï¼šå°† mod.py æ”¾å…¥ PYTHONPATH å˜é‡ä¸­å·²åŒ…å«çš„ç›®å½•ä¹‹ä¸€ å°† mod.py æ”¾å…¥ä¾èµ–äºå®‰è£…çš„ç›®å½•ä¹‹ä¸€ï¼Œæ‚¨å¯èƒ½æœ‰ä¹Ÿå¯èƒ½æ²¡æœ‰å†™å…¥æƒé™ï¼Œå…·ä½“å–å†³äºæ“ä½œç³»ç»Ÿ å®é™…ä¸Šè¿˜æœ‰ä¸€ä¸ªé™„åŠ é€‰é¡¹ï¼šæ‚¨å¯ä»¥å°†æ¨¡å—æ–‡ä»¶æ”¾åœ¨æ‚¨é€‰æ‹©çš„ä»»ä½•ç›®å½•ä¸­ï¼Œç„¶ååœ¨è¿è¡Œæ—¶ä¿®æ”¹ sys.path ä»¥ä½¿å…¶åŒ…å«è¯¥ç›®å½•ã€‚ä¾‹å¦‚ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥å°† mod.py æ”¾å…¥ç›®å½• C:\\Users\\john ä¸­ï¼Œç„¶åå‘å‡ºä»¥ä¸‹è¯­å¥ï¼š\n\u0026gt;\u0026gt;\u0026gt; sys.path.append(r\u0026#39;C:\\Users\\john\u0026#39;) \u0026gt;\u0026gt;\u0026gt; sys.path [\u0026#39;\u0026#39;, \u0026#39;C:\\\\Users\\\\john\\\\Documents\\\\Python\\\\doc\u0026#39;, \u0026#39;C:\\\\Python36\\\\Lib\\\\idlelib\u0026#39;, \u0026#39;C:\\\\Python36\\\\python36.zip\u0026#39;, \u0026#39;C:\\\\Python36\\\\DLLs\u0026#39;, \u0026#39;C:\\\\Python36\\\\lib\u0026#39;, \u0026#39;C:\\\\Python36\u0026#39;, \u0026#39;C:\\\\Python36\\\\lib\\\\site-packages\u0026#39;, \u0026#39;C:\\\\Users\\\\john\u0026#39;] \u0026gt;\u0026gt;\u0026gt; import mod å¯¼å…¥æ¨¡å—åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ¨¡å—çš„ __file__ å±æ€§ç¡®å®šæ‰¾åˆ°å®ƒçš„ä½ç½®ï¼š\n\u0026gt;\u0026gt;\u0026gt; import mod \u0026gt;\u0026gt;\u0026gt; mod.__file__ \u0026#39;C:\\\\Users\\\\john\\\\mod.py\u0026#39; \u0026gt;\u0026gt;\u0026gt; import re \u0026gt;\u0026gt;\u0026gt; re.__file__ \u0026#39;C:\\\\Python36\\\\lib\\\\re.py\u0026#39; __file__ çš„ç›®å½•éƒ¨åˆ†åº”è¯¥æ˜¯ sys.path ä¸­çš„ç›®å½•ä¹‹ä¸€ã€‚\nimport å£°æ˜ æ¨¡å—å†…å®¹å¯é€šè¿‡ import è¯­å¥æä¾›ç»™è°ƒç”¨è€…ã€‚ import è¯­å¥æœ‰å¤šç§ä¸åŒçš„å½¢å¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚\nimport \u0026lt;module_name\u0026gt; æœ€ç®€å•çš„å½¢å¼æ˜¯ä¸Šé¢å·²ç»æ˜¾ç¤ºçš„å½¢å¼ï¼š\nimport \u0026lt;module_name\u0026gt; è¯·æ³¨æ„ï¼Œè¿™ä¸ä¼šä½¿è°ƒç”¨è€…ç›´æ¥è®¿é—®æ¨¡å—å†…å®¹ã€‚æ¯ä¸ªæ¨¡å—éƒ½æœ‰è‡ªå·±çš„ç§æœ‰ç¬¦å·è¡¨ï¼Œä½œä¸ºæ¨¡å—ä¸­å®šä¹‰çš„æ‰€æœ‰å¯¹è±¡çš„å…¨å±€ç¬¦å·è¡¨ã€‚å› æ­¤ï¼Œå¦‚å‰æ‰€è¿°ï¼Œæ¨¡å—åˆ›å»ºäº†ä¸€ä¸ªå•ç‹¬çš„åç§°ç©ºé—´ã€‚\nè¯­å¥ import \u0026lt;module_name\u0026gt; ä»…å°† \u0026lt;module_name\u0026gt; æ”¾å…¥è°ƒç”¨è€…çš„ç¬¦å·è¡¨ä¸­ã€‚æ¨¡å—ä¸­å®šä¹‰çš„å¯¹è±¡ä¿ç•™åœ¨æ¨¡å—çš„ç§æœ‰ç¬¦å·è¡¨ä¸­ã€‚\nå¯¹äºè°ƒç”¨è€…æ¥è¯´ï¼Œåªæœ‰é€šè¿‡ç‚¹ç¬¦å·ä»¥ \u0026lt;module_name\u0026gt; ä¸ºå‰ç¼€æ—¶æ‰èƒ½è®¿é—®æ¨¡å—ä¸­çš„å¯¹è±¡ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚\nåœ¨ä»¥ä¸‹ import è¯­å¥ä¹‹åï¼Œ mod è¢«æ”¾å…¥æœ¬åœ°ç¬¦å·è¡¨ä¸­ã€‚å› æ­¤ï¼Œ mod åœ¨è°ƒç”¨è€…çš„æœ¬åœ°ä¸Šä¸‹æ–‡ä¸­æœ‰æ„ä¹‰ï¼š\n\u0026gt;\u0026gt;\u0026gt; import mod \u0026gt;\u0026gt;\u0026gt; mod \u0026lt;module \u0026#39;mod\u0026#39; from \u0026#39;C:\\\\Users\\\\john\\\\Documents\\\\Python\\\\doc\\\\mod.py\u0026#39;\u0026gt; ä½†æ˜¯ s å’Œ foo ä¿ç•™åœ¨æ¨¡å—çš„ç§æœ‰ç¬¦å·è¡¨ä¸­ï¼Œå¹¶ä¸”åœ¨æœ¬åœ°ä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰æ„ä¹‰ï¼š\n\u0026gt;\u0026gt;\u0026gt; s NameError: name \u0026#39;s\u0026#39; is not defined \u0026gt;\u0026gt;\u0026gt; foo(\u0026#39;quux\u0026#39;) NameError: name \u0026#39;foo\u0026#39; is not defined è¦åœ¨æœ¬åœ°ä¸Šä¸‹æ–‡ä¸­è®¿é—®ï¼Œæ¨¡å—ä¸­å®šä¹‰çš„å¯¹è±¡åç§°å¿…é¡»ä»¥ mod ä¸ºå‰ç¼€ï¼š\n\u0026gt;\u0026gt;\u0026gt; mod.s \u0026#39;If Comrade Napoleon says it, it must be right.\u0026#39; \u0026gt;\u0026gt;\u0026gt; mod.foo(\u0026#39;quux\u0026#39;) arg = quux å¯ä»¥åœ¨å•ä¸ª import è¯­å¥ä¸­æŒ‡å®šå¤šä¸ªä»¥é€—å·åˆ†éš”çš„æ¨¡å—ï¼š\nimport \u0026lt;module_name\u0026gt;[, \u0026lt;module_name\u0026gt; ...] from \u0026lt;module_name\u0026gt; import \u0026lt;name(s)\u0026gt; import è¯­å¥çš„å¦ä¸€ç§å½¢å¼å…è®¸å°†æ¨¡å—ä¸­çš„å„ä¸ªå¯¹è±¡ç›´æ¥å¯¼å…¥åˆ°è°ƒç”¨è€…çš„ç¬¦å·è¡¨ä¸­ï¼š\nfrom \u0026lt;module_name\u0026gt; import \u0026lt;name(s)\u0026gt; æ‰§è¡Œä¸Šè¿°è¯­å¥åï¼Œå¯ä»¥åœ¨è°ƒç”¨è€…çš„ç¯å¢ƒä¸­å¼•ç”¨ \u0026lt;name(s)\u0026gt; ï¼Œè€Œæ— éœ€ä½¿ç”¨ \u0026lt;module_name\u0026gt; å‰ç¼€ï¼š\n\u0026gt;\u0026gt;\u0026gt; from mod import s, foo \u0026gt;\u0026gt;\u0026gt; s \u0026#39;If Comrade Napoleon says it, it must be right.\u0026#39; \u0026gt;\u0026gt;\u0026gt; foo(\u0026#39;quux\u0026#39;) arg = quux \u0026gt;\u0026gt;\u0026gt; from mod import Foo \u0026gt;\u0026gt;\u0026gt; x = Foo() \u0026gt;\u0026gt;\u0026gt; x \u0026lt;mod.Foo object at 0x02E3AD50\u0026gt; å› ä¸ºè¿™ç§å½¢å¼çš„ import å°†å¯¹è±¡åç§°ç›´æ¥æ”¾å…¥è°ƒç”¨è€…çš„ç¬¦å·è¡¨ä¸­ï¼Œå› æ­¤ä»»ä½•å·²å­˜åœ¨çš„åŒåå¯¹è±¡éƒ½å°†è¢«è¦†ç›–ï¼š\n\u0026gt;\u0026gt;\u0026gt; a = [\u0026#39;foo\u0026#39;, \u0026#39;bar\u0026#39;, \u0026#39;baz\u0026#39;] \u0026gt;\u0026gt;\u0026gt; a [\u0026#39;foo\u0026#39;, \u0026#39;bar\u0026#39;, \u0026#39;baz\u0026#39;] \u0026gt;\u0026gt;\u0026gt; from mod import a \u0026gt;\u0026gt;\u0026gt; a [100, 200, 300] ç”šè‡³å¯ä»¥ä¸åŠ åŒºåˆ«åœ°ä¸€æ¬¡æ€§ import æ¨¡å—ä¸­çš„æ‰€æœ‰å†…å®¹ï¼š\nfrom \u0026lt;module_name\u0026gt; import * è¿™ä¼šå°† \u0026lt;module_name\u0026gt; ä¸­çš„æ‰€æœ‰å¯¹è±¡çš„åç§°æ”¾å…¥æœ¬åœ°ç¬¦å·è¡¨ä¸­ï¼Œä½†ä»¥ä¸‹åˆ’çº¿ ( _ ) å­—ç¬¦å¼€å¤´çš„å¯¹è±¡é™¤å¤–ã€‚\nä¾‹å¦‚ï¼š\n\u0026gt;\u0026gt;\u0026gt; from mod import * \u0026gt;\u0026gt;\u0026gt; s \u0026#39;If Comrade Napoleon says it, it must be right.\u0026#39; \u0026gt;\u0026gt;\u0026gt; a [100, 200, 300] \u0026gt;\u0026gt;\u0026gt; foo \u0026lt;function foo at 0x03B449C0\u0026gt; \u0026gt;\u0026gt;\u0026gt; Foo \u0026lt;class \u0026#39;mod.Foo\u0026#39;\u0026gt; åœ¨å¤§è§„æ¨¡ç”Ÿäº§ä»£ç ä¸­ä¸ä¸€å®šæ¨èè¿™æ ·åšã€‚è¿™æœ‰ç‚¹å±é™©ï¼Œå› ä¸ºæ‚¨æ­£åœ¨å°†åç§°ä¸€èµ·è¾“å…¥åˆ°æœ¬åœ°ç¬¦å·è¡¨ä¸­ã€‚é™¤éæ‚¨éå¸¸äº†è§£å®ƒä»¬å¹¶ä¸”å¯ä»¥ç¡®ä¿¡ä¸ä¼šå‘ç”Ÿå†²çªï¼Œå¦åˆ™æ‚¨å¾ˆæœ‰å¯èƒ½ä¼šæ— æ„ä¸­è¦†ç›–ç°æœ‰åç§°ã€‚\nä½†æ˜¯ï¼Œå½“æ‚¨åªæ˜¯ä¸ºäº†æµ‹è¯•æˆ–å‘ç°ç›®çš„è€Œä½¿ç”¨äº¤äº’å¼è§£é‡Šå™¨æ—¶ï¼Œè¿™ç§è¯­æ³•éå¸¸æ–¹ä¾¿ï¼Œå› ä¸ºå®ƒå¯ä»¥è®©æ‚¨å¿«é€Ÿè®¿é—®æ¨¡å—å¿…é¡»æä¾›çš„æ‰€æœ‰å†…å®¹ï¼Œè€Œæ— éœ€è¿›è¡Œå¤§é‡è¾“å…¥ã€‚\nfrom \u0026lt;module_name\u0026gt; import \u0026lt;name\u0026gt; as \u0026lt;alt_name\u0026gt; ä¹Ÿå¯ä»¥ import å•ä¸ªå¯¹è±¡ï¼Œä½†ä½¿ç”¨å¤‡ç”¨åç§°å°†å®ƒä»¬è¾“å…¥åˆ°æœ¬åœ°ç¬¦å·è¡¨ä¸­ï¼š\nfrom \u0026lt;module_name\u0026gt; import \u0026lt;name\u0026gt; as \u0026lt;alt_name\u0026gt;[, \u0026lt;name\u0026gt; as \u0026lt;alt_name\u0026gt; â€¦] è¿™ä½¿å¾—å°†åç§°ç›´æ¥æ”¾å…¥æœ¬åœ°ç¬¦å·è¡¨æˆä¸ºå¯èƒ½ï¼Œä½†é¿å…ä¸ä»¥å‰å­˜åœ¨çš„åç§°å‘ç”Ÿå†²çªï¼š\n\u0026gt;\u0026gt;\u0026gt; s = \u0026#39;foo\u0026#39; \u0026gt;\u0026gt;\u0026gt; a = [\u0026#39;foo\u0026#39;, \u0026#39;bar\u0026#39;, \u0026#39;baz\u0026#39;] \u0026gt;\u0026gt;\u0026gt; from mod import s as string, a as alist \u0026gt;\u0026gt;\u0026gt; s \u0026#39;foo\u0026#39; \u0026gt;\u0026gt;\u0026gt; string \u0026#39;If Comrade Napoleon says it, it must be right.\u0026#39; \u0026gt;\u0026gt;\u0026gt; a [\u0026#39;foo\u0026#39;, \u0026#39;bar\u0026#39;, \u0026#39;baz\u0026#39;] \u0026gt;\u0026gt;\u0026gt; alist [100, 200, 300] import \u0026lt;module_name\u0026gt; as \u0026lt;alt_name\u0026gt; æ‚¨è¿˜å¯ä»¥ä½¿ç”¨å¤‡ç”¨åç§°å¯¼å…¥æ•´ä¸ªæ¨¡å—ï¼š\nimport \u0026lt;module_name\u0026gt; as \u0026lt;alt_name\u0026gt; \u0026gt;\u0026gt;\u0026gt; import mod as my_module \u0026gt;\u0026gt;\u0026gt; my_module.a [100, 200, 300] \u0026gt;\u0026gt;\u0026gt; my_module.foo(\u0026#39;qux\u0026#39;) arg = qux æ¨¡å—å†…å®¹å¯ä»¥ä»å‡½æ•°å®šä¹‰ä¸­å¯¼å…¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨è°ƒç”¨è¯¥å‡½æ•°ä¹‹å‰ï¼Œ import ä¸ä¼šå‘ç”Ÿï¼š\n\u0026gt;\u0026gt;\u0026gt; def bar(): ... from mod import foo ... foo(\u0026#39;corge\u0026#39;) ... \u0026gt;\u0026gt;\u0026gt; bar() arg = corge ç„¶è€Œï¼ŒPython 3 ä¸å…è®¸å‡½æ•°å†…ä¸åŠ åŒºåˆ«åœ°ä½¿ç”¨ import * è¯­æ³•ï¼š\n\u0026gt;\u0026gt;\u0026gt; def bar(): ... from mod import * ... SyntaxError: import * only allowed at module level æœ€åï¼Œå¸¦æœ‰ except ImportError å­å¥çš„ try è¯­å¥å¯ç”¨äºé˜²æ­¢ä¸æˆåŠŸçš„ import å°è¯•ï¼š\n\u0026gt;\u0026gt;\u0026gt; try: ... # Non-existent module ... import baz ... except ImportError: ... print(\u0026#39;Module not found\u0026#39;) ... Module not found \u0026gt;\u0026gt;\u0026gt; try: ... # Existing module, but non-existent object ... from mod import baz ... except ImportError: ... print(\u0026#39;Object not found in module\u0026#39;) ... Object not found in module dir() å‡½æ•° å†…ç½®å‡½æ•° dir() è¿”å›å‘½åç©ºé—´ä¸­å·²å®šä¹‰åç§°çš„åˆ—è¡¨ã€‚å¦‚æœæ²¡æœ‰å‚æ•°ï¼Œå®ƒä¼šåœ¨å½“å‰æœ¬åœ°ç¬¦å·è¡¨ä¸­ç”ŸæˆæŒ‰å­—æ¯é¡ºåºæ’åºçš„åç§°åˆ—è¡¨ï¼š\n\u0026gt;\u0026gt;\u0026gt; dir() [\u0026#39;__annotations__\u0026#39;, \u0026#39;__builtins__\u0026#39;, \u0026#39;__doc__\u0026#39;, \u0026#39;__loader__\u0026#39;, \u0026#39;__name__\u0026#39;, \u0026#39;__package__\u0026#39;, \u0026#39;__spec__\u0026#39;] \u0026gt;\u0026gt;\u0026gt; qux = [1, 2, 3, 4, 5] \u0026gt;\u0026gt;\u0026gt; dir() [\u0026#39;__annotations__\u0026#39;, \u0026#39;__builtins__\u0026#39;, \u0026#39;__doc__\u0026#39;, \u0026#39;__loader__\u0026#39;, \u0026#39;__name__\u0026#39;, \u0026#39;__package__\u0026#39;, \u0026#39;__spec__\u0026#39;, \u0026#39;qux\u0026#39;] \u0026gt;\u0026gt;\u0026gt; class Bar(): ... pass ... \u0026gt;\u0026gt;\u0026gt; x = Bar() \u0026gt;\u0026gt;\u0026gt; dir() [\u0026#39;Bar\u0026#39;, \u0026#39;__annotations__\u0026#39;, \u0026#39;__builtins__\u0026#39;, \u0026#39;__doc__\u0026#39;, \u0026#39;__loader__\u0026#39;, \u0026#39;__name__\u0026#39;, \u0026#39;__package__\u0026#39;, \u0026#39;__spec__\u0026#39;, \u0026#39;qux\u0026#39;, \u0026#39;x\u0026#39;] è¯·æ³¨æ„ä¸Šé¢å¯¹ dir() çš„ç¬¬ä¸€æ¬¡è°ƒç”¨å¦‚ä½•åˆ—å‡ºè§£é‡Šå™¨å¯åŠ¨æ—¶è‡ªåŠ¨å®šä¹‰ä¸”å·²åœ¨å‘½åç©ºé—´ä¸­çš„å‡ ä¸ªåç§°ã€‚å½“å®šä¹‰æ–°åç§°ï¼ˆ qux ã€ Bar ã€ x ï¼‰æ—¶ï¼Œå®ƒä»¬ä¼šå‡ºç°åœ¨ dir() çš„åç»­è°ƒç”¨ä¸­ã€‚\nè¿™å¯¹äºè¯†åˆ« import è¯­å¥åˆ°åº•æ·»åŠ åˆ°å‘½åç©ºé—´ä¸­çš„å†…å®¹éå¸¸æœ‰ç”¨ï¼š\n\u0026gt;\u0026gt;\u0026gt; dir() [\u0026#39;__annotations__\u0026#39;, \u0026#39;__builtins__\u0026#39;, \u0026#39;__doc__\u0026#39;, \u0026#39;__loader__\u0026#39;, \u0026#39;__name__\u0026#39;, \u0026#39;__package__\u0026#39;, \u0026#39;__spec__\u0026#39;] \u0026gt;\u0026gt;\u0026gt; import mod \u0026gt;\u0026gt;\u0026gt; dir() [\u0026#39;__annotations__\u0026#39;, \u0026#39;__builtins__\u0026#39;, \u0026#39;__doc__\u0026#39;, \u0026#39;__loader__\u0026#39;, \u0026#39;__name__\u0026#39;, \u0026#39;__package__\u0026#39;, \u0026#39;__spec__\u0026#39;, \u0026#39;mod\u0026#39;] \u0026gt;\u0026gt;\u0026gt; mod.s \u0026#39;If Comrade Napoleon says it, it must be right.\u0026#39; \u0026gt;\u0026gt;\u0026gt; mod.foo([1, 2, 3]) arg = [1, 2, 3] \u0026gt;\u0026gt;\u0026gt; from mod import a, Foo \u0026gt;\u0026gt;\u0026gt; dir() [\u0026#39;Foo\u0026#39;, \u0026#39;__annotations__\u0026#39;, \u0026#39;__builtins__\u0026#39;, \u0026#39;__doc__\u0026#39;, \u0026#39;__loader__\u0026#39;, \u0026#39;__name__\u0026#39;, \u0026#39;__package__\u0026#39;, \u0026#39;__spec__\u0026#39;, \u0026#39;a\u0026#39;, \u0026#39;mod\u0026#39;] \u0026gt;\u0026gt;\u0026gt; a [100, 200, 300] \u0026gt;\u0026gt;\u0026gt; x = Foo() \u0026gt;\u0026gt;\u0026gt; x \u0026lt;mod.Foo object at 0x002EAD50\u0026gt; \u0026gt;\u0026gt;\u0026gt; from mod import s as string \u0026gt;\u0026gt;\u0026gt; dir() [\u0026#39;Foo\u0026#39;, \u0026#39;__annotations__\u0026#39;, \u0026#39;__builtins__\u0026#39;, \u0026#39;__doc__\u0026#39;, \u0026#39;__loader__\u0026#39;, \u0026#39;__name__\u0026#39;, \u0026#39;__package__\u0026#39;, \u0026#39;__spec__\u0026#39;, \u0026#39;a\u0026#39;, \u0026#39;mod\u0026#39;, \u0026#39;string\u0026#39;, \u0026#39;x\u0026#39;] \u0026gt;\u0026gt;\u0026gt; string \u0026#39;If Comrade Napoleon says it, it must be right.\u0026#39; å½“ç»™å®šä¸€ä¸ªæ¨¡å—åç§°çš„å‚æ•°æ—¶ï¼Œ dir() åˆ—å‡ºæ¨¡å—ä¸­å®šä¹‰çš„åç§°ï¼š\n\u0026gt;\u0026gt;\u0026gt; import mod \u0026gt;\u0026gt;\u0026gt; dir(mod) [\u0026#39;Foo\u0026#39;, \u0026#39;__builtins__\u0026#39;, \u0026#39;__cached__\u0026#39;, \u0026#39;__doc__\u0026#39;, \u0026#39;__file__\u0026#39;, \u0026#39;__loader__\u0026#39;, \u0026#39;__name__\u0026#39;, \u0026#39;__package__\u0026#39;, \u0026#39;__spec__\u0026#39;, \u0026#39;a\u0026#39;, \u0026#39;foo\u0026#39;, \u0026#39;s\u0026#39;] \u0026gt;\u0026gt;\u0026gt; dir() [\u0026#39;__annotations__\u0026#39;, \u0026#39;__builtins__\u0026#39;, \u0026#39;__doc__\u0026#39;, \u0026#39;__loader__\u0026#39;, \u0026#39;__name__\u0026#39;, \u0026#39;__package__\u0026#39;, \u0026#39;__spec__\u0026#39;] \u0026gt;\u0026gt;\u0026gt; from mod import * \u0026gt;\u0026gt;\u0026gt; dir() [\u0026#39;Foo\u0026#39;, \u0026#39;__annotations__\u0026#39;, \u0026#39;__builtins__\u0026#39;, \u0026#39;__doc__\u0026#39;, \u0026#39;__loader__\u0026#39;, \u0026#39;__name__\u0026#39;, \u0026#39;__package__\u0026#39;, \u0026#39;__spec__\u0026#39;, \u0026#39;a\u0026#39;, \u0026#39;foo\u0026#39;, \u0026#39;s\u0026#39;] ä»è„šæœ¬æ‰§è¡Œæ¨¡å— ä»»ä½•åŒ…å«æ¨¡å—çš„ .py æ–‡ä»¶æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ª Python è„šæœ¬ï¼Œå¹¶ä¸”æ²¡æœ‰ä»»ä½•ç†ç”±ä¸èƒ½åƒè„šæœ¬ä¸€æ ·æ‰§è¡Œã€‚\nè¿™é‡Œåˆæ˜¯ä¸Šé¢å®šä¹‰çš„ mod.py ï¼š\nmod.py\ns = \u0026#34;If Comrade Napoleon says it, it must be right.\u0026#34; a = [100, 200, 300] def foo(arg): print(f\u0026#39;arg = {arg}\u0026#39;) class Foo: pass è¿™å¯ä»¥ä½œä¸ºè„šæœ¬è¿è¡Œï¼š\nC:\\Users\\john\\Documents\u0026gt;python mod.py C:\\Users\\john\\Documents\u0026gt; æ²¡æœ‰é”™è¯¯ï¼Œæ‰€ä»¥å®ƒæ˜¾ç„¶æœ‰æ•ˆã€‚å½“ç„¶ï¼Œè¿™å¹¶ä¸æ˜¯å¾ˆæœ‰è¶£ã€‚æ­£å¦‚å®ƒæ‰€å†™çš„ï¼Œå®ƒåªå®šä¹‰äº†å¯¹è±¡ã€‚å®ƒä¸ä¼šå¯¹å®ƒä»¬åšä»»ä½•äº‹æƒ…ï¼Œä¹Ÿä¸ä¼šç”Ÿæˆä»»ä½•è¾“å‡ºã€‚\nè®©æˆ‘ä»¬ä¿®æ”¹ä¸Šé¢çš„ Python æ¨¡å—ï¼Œä»¥ä¾¿å®ƒåœ¨ä½œä¸ºè„šæœ¬è¿è¡Œæ—¶ç”Ÿæˆä¸€äº›è¾“å‡ºï¼š\nmod.py\ns = \u0026#34;If Comrade Napoleon says it, it must be right.\u0026#34; a = [100, 200, 300] def foo(arg): print(f\u0026#39;arg = {arg}\u0026#39;) class Foo: pass print(s) print(a) foo(\u0026#39;quux\u0026#39;) x = Foo() print(x) ç°åœ¨åº”è¯¥æ›´æœ‰è¶£äº†ï¼š\nC:\\Users\\john\\Documents\u0026gt;python mod.py If Comrade Napoleon says it, it must be right. [100, 200, 300] arg = quux \u0026lt;__main__.Foo object at 0x02F101D0\u0026gt; ä¸å¹¸çš„æ˜¯ï¼Œç°åœ¨å®ƒåœ¨ä½œä¸ºæ¨¡å—å¯¼å…¥æ—¶ä¹Ÿä¼šç”Ÿæˆè¾“å‡ºï¼š\n\u0026gt;\u0026gt;\u0026gt; import mod If Comrade Napoleon says it, it must be right. [100, 200, 300] arg = quux \u0026lt;mod.Foo object at 0x0169AD50\u0026gt; è¿™å¯èƒ½ä¸æ˜¯æ‚¨æƒ³è¦çš„ã€‚æ¨¡å—åœ¨å¯¼å…¥æ—¶é€šå¸¸ä¸ä¼šç”Ÿæˆè¾“å‡ºã€‚\nå¦‚æœæ‚¨èƒ½å¤ŸåŒºåˆ†æ–‡ä»¶ä½•æ—¶ä½œä¸ºæ¨¡å—åŠ è½½ä»¥åŠä½•æ—¶ä½œä¸ºç‹¬ç«‹è„šæœ¬è¿è¡Œï¼Œå²‚ä¸æ˜¯å¾ˆå¥½ï¼Ÿ\nç¥ˆæ±‚ï¼Œä½ ä»¬å°±ä¼šæ”¶åˆ°ã€‚\nå½“ .py æ–‡ä»¶ä½œä¸ºæ¨¡å—å¯¼å…¥æ—¶ï¼ŒPython ä¼šå°†ç‰¹æ®Šçš„ dunder å˜é‡ __name__ è®¾ç½®ä¸ºæ¨¡å—çš„åç§°ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ–‡ä»¶ä½œä¸ºç‹¬ç«‹è„šæœ¬è¿è¡Œï¼Œåˆ™ __name__ ï¼ˆåˆ›é€ æ€§åœ°ï¼‰è®¾ç½®ä¸ºå­—ç¬¦ä¸² '__main__' ã€‚åˆ©ç”¨è¿™ä¸€äº‹å®ï¼Œæ‚¨å¯ä»¥è¾¨åˆ«è¿è¡Œæ—¶çš„æƒ…å†µå¹¶ç›¸åº”åœ°æ”¹å˜è¡Œä¸ºï¼š\nmod.py\ns = \u0026#34;If Comrade Napoleon says it, it must be right.\u0026#34; a = [100, 200, 300] def foo(arg): print(f\u0026#39;arg = {arg}\u0026#39;) class Foo: pass if (__name__ == \u0026#39;__main__\u0026#39;): print(\u0026#39;Executing as standalone script\u0026#39;) print(s) print(a) foo(\u0026#39;quux\u0026#39;) x = Foo() print(x) ç°åœ¨ï¼Œå¦‚æœæ‚¨ä½œä¸ºè„šæœ¬è¿è¡Œï¼Œæ‚¨å°†å¾—åˆ°è¾“å‡ºï¼š\nC:\\Users\\john\\Documents\u0026gt;python mod.py Executing as standalone script If Comrade Napoleon says it, it must be right. [100, 200, 300] arg = quux \u0026lt;__main__.Foo object at 0x03450690\u0026gt; ä½†å¦‚æœæ‚¨ä½œä¸ºæ¨¡å—å¯¼å…¥ï¼Œåˆ™ä¸ä¼šï¼š\n\u0026gt;\u0026gt;\u0026gt; import mod \u0026gt;\u0026gt;\u0026gt; mod.foo(\u0026#39;grault\u0026#39;) arg = grault æ¨¡å—é€šå¸¸è®¾è®¡ä¸ºèƒ½å¤Ÿä½œä¸ºç‹¬ç«‹è„šæœ¬è¿è¡Œï¼Œä»¥æµ‹è¯•æ¨¡å—ä¸­åŒ…å«çš„åŠŸèƒ½ã€‚è¿™ç§°ä¸ºå•å…ƒæµ‹è¯•ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«é˜¶ä¹˜å‡½æ•°çš„æ¨¡å— fact.py ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nfact.py\ndef fact(n): return 1 if n == 1 else n * fact(n-1) if (__name__ == \u0026#39;__main__\u0026#39;): import sys if len(sys.argv) \u0026gt; 1: print(fact(int(sys.argv[1]))) è¯¥æ–‡ä»¶å¯ä»¥è¢«è§†ä¸ºä¸€ä¸ªæ¨¡å—ï¼Œå¹¶å¯¼å…¥ fact() å‡½æ•°ï¼š\n\u0026gt;\u0026gt;\u0026gt; from fact import fact \u0026gt;\u0026gt;\u0026gt; fact(6) 720 ä½†å®ƒä¹Ÿå¯ä»¥é€šè¿‡åœ¨å‘½ä»¤è¡Œä¸Šä¼ é€’æ•´æ•°å‚æ•°æ¥ç‹¬ç«‹è¿è¡Œä»¥è¿›è¡Œæµ‹è¯•ï¼š\nC:\\Users\\john\\Documents\u0026gt;python fact.py 6 720 é‡æ–°åŠ è½½æ¨¡å— å‡ºäºæ•ˆç‡åŸå› ï¼Œæ¯ä¸ªè§£é‡Šå™¨ä¼šè¯ä»…åŠ è½½ä¸€ä¸ªæ¨¡å—ä¸€æ¬¡ã€‚è¿™å¯¹äºå‡½æ•°å’Œç±»å®šä¹‰æ¥è¯´å¾ˆå¥½ï¼Œå®ƒä»¬é€šå¸¸æ„æˆäº†æ¨¡å—çš„å¤§éƒ¨åˆ†å†…å®¹ã€‚ä½†æ¨¡å—ä¹Ÿå¯ä»¥åŒ…å«å¯æ‰§è¡Œè¯­å¥ï¼Œé€šå¸¸ç”¨äºåˆå§‹åŒ–ã€‚\nè¯·æ³¨æ„ï¼Œè¿™äº›è¯­å¥ä»…åœ¨ç¬¬ä¸€æ¬¡å¯¼å…¥æ¨¡å—æ—¶æ‰§è¡Œã€‚\nè€ƒè™‘ä»¥ä¸‹æ–‡ä»¶ mod.py ï¼š\nmod.py\na = [100, 200, 300] print(\u0026#39;a =\u0026#39;, a) \u0026gt;\u0026gt;\u0026gt; import mod a = [100, 200, 300] \u0026gt;\u0026gt;\u0026gt; import mod \u0026gt;\u0026gt;\u0026gt; import mod \u0026gt;\u0026gt;\u0026gt; mod.a [100, 200, 300] åç»­å¯¼å…¥æ—¶ä¸ä¼šæ‰§è¡Œ print() è¯­å¥ã€‚ ï¼ˆå°±æ­¤è€Œè¨€ï¼Œèµ‹å€¼è¯­å¥ä¹Ÿä¸æ˜¯ï¼Œä½†æ­£å¦‚ mod.a å€¼çš„æœ€ç»ˆæ˜¾ç¤ºæ‰€ç¤ºï¼Œè¿™å¹¶ä¸é‡è¦ã€‚ä¸€æ—¦è¿›è¡Œèµ‹å€¼ï¼Œå®ƒå°±ä¼šä¿ç•™ã€‚ï¼‰\nå¦‚æœæ‚¨å¯¹æ¨¡å—è¿›è¡Œæ›´æ”¹å¹¶éœ€è¦é‡æ–°åŠ è½½å®ƒï¼Œåˆ™éœ€è¦é‡æ–°å¯åŠ¨è§£é‡Šå™¨æˆ–ä½¿ç”¨æ¨¡å— importlib ä¸­åä¸º reload() çš„å‡½æ•°ï¼š\n\u0026gt;\u0026gt;\u0026gt; import mod a = [100, 200, 300] \u0026gt;\u0026gt;\u0026gt; import mod \u0026gt;\u0026gt;\u0026gt; import importlib \u0026gt;\u0026gt;\u0026gt; importlib.reload(mod) a = [100, 200, 300] \u0026lt;module \u0026#39;mod\u0026#39; from \u0026#39;C:\\\\Users\\\\john\\\\Documents\\\\Python\\\\doc\\\\mod.py\u0026#39;\u0026gt; Python åŒ… å‡è®¾æ‚¨å¼€å‘äº†ä¸€ä¸ªéå¸¸å¤§çš„åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­åŒ…å«è®¸å¤šæ¨¡å—ã€‚éšç€æ¨¡å—æ•°é‡çš„å¢åŠ ï¼Œå¦‚æœå°†å®ƒä»¬è½¬å‚¨åˆ°ä¸€ä¸ªä½ç½®ï¼Œåˆ™å¾ˆéš¾è·Ÿè¸ªæ‰€æœ‰æ¨¡å—ã€‚å¦‚æœå®ƒä»¬å…·æœ‰ç›¸ä¼¼çš„åç§°æˆ–åŠŸèƒ½ï¼Œåˆ™å°¤å…¶å¦‚æ­¤ã€‚\næ‚¨å¯èƒ½å¸Œæœ›æœ‰ä¸€ç§å¯¹å®ƒä»¬è¿›è¡Œåˆ†ç»„å’Œç»„ç»‡çš„æ–¹æ³•ã€‚\nåŒ…å…è®¸ä½¿ç”¨ç‚¹è¡¨ç¤ºæ³•å¯¹æ¨¡å—åç§°ç©ºé—´è¿›è¡Œåˆ†å±‚ç»“æ„ã€‚å°±åƒæ¨¡å—æœ‰åŠ©äºé¿å…å…¨å±€å˜é‡åç§°ä¹‹é—´çš„å†²çªä¸€æ ·ï¼ŒåŒ…ä¹Ÿæœ‰åŠ©äºé¿å…æ¨¡å—åç§°ä¹‹é—´çš„å†²çªã€‚\nåˆ›å»ºåŒ…éå¸¸ç®€å•ï¼Œå› ä¸ºå®ƒåˆ©ç”¨äº†æ“ä½œç³»ç»Ÿå›ºæœ‰çš„åˆ†å±‚æ–‡ä»¶ç»“æ„ã€‚è€ƒè™‘ä»¥ä¸‹å®‰æ’ï¼š\nè¿™é‡Œæœ‰ä¸€ä¸ªåä¸º pkg çš„ç›®å½•ï¼Œå…¶ä¸­åŒ…å«ä¸¤ä¸ªæ¨¡å—ï¼š mod1.py å’Œ mod2.py ã€‚æ¨¡å—çš„å†…å®¹æ˜¯ï¼š\nmod1.py\ndef foo(): print(\u0026#39;[mod1] foo()\u0026#39;) class Foo: pass mod2.py\ndef bar(): print(\u0026#39;[mod2] bar()\u0026#39;) class Bar: pass ç»™å®šæ­¤ç»“æ„ï¼Œå¦‚æœ pkg ç›®å½•ä½äºå¯ä»¥æ‰¾åˆ°å®ƒçš„ä½ç½®ï¼ˆ sys.path ä¸­åŒ…å«çš„ç›®å½•ä¹‹ä¸€ï¼‰ï¼Œåˆ™å¯ä»¥ç”¨ç‚¹ç¬¦å·å¼•ç”¨è¿™ä¸¤ä¸ªæ¨¡å—ï¼ˆ pkg.mod1 ã€ pkg.mod2 ) å¹¶ä½¿ç”¨æ‚¨å·²ç»ç†Ÿæ‚‰çš„è¯­æ³•å¯¼å…¥å®ƒä»¬ï¼š\nimport \u0026lt;module_name\u0026gt;[, \u0026lt;module_name\u0026gt; ...] \u0026gt;\u0026gt;\u0026gt; import pkg.mod1, pkg.mod2 \u0026gt;\u0026gt;\u0026gt; pkg.mod1.foo() [mod1] foo() \u0026gt;\u0026gt;\u0026gt; x = pkg.mod2.Bar() \u0026gt;\u0026gt;\u0026gt; x \u0026lt;pkg.mod2.Bar object at 0x033F7290\u0026gt; from \u0026lt;module_name\u0026gt; import \u0026lt;name(s)\u0026gt; \u0026gt;\u0026gt;\u0026gt; from pkg.mod1 import foo \u0026gt;\u0026gt;\u0026gt; foo() [mod1] foo() from \u0026lt;module_name\u0026gt; import \u0026lt;name\u0026gt; as \u0026lt;alt_name\u0026gt; \u0026gt;\u0026gt;\u0026gt; from pkg.mod2 import Bar as Qux \u0026gt;\u0026gt;\u0026gt; x = Qux() \u0026gt;\u0026gt;\u0026gt; x \u0026lt;pkg.mod2.Bar object at 0x036DFFD0\u0026gt; æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™äº›è¯­å¥å¯¼å…¥æ¨¡å—ï¼š\nfrom \u0026lt;package_name\u0026gt; import \u0026lt;modules_name\u0026gt;[, \u0026lt;module_name\u0026gt; ...] from \u0026lt;package_name\u0026gt; import \u0026lt;module_name\u0026gt; as \u0026lt;alt_name\u0026gt; \u0026gt;\u0026gt;\u0026gt; from pkg import mod1 \u0026gt;\u0026gt;\u0026gt; mod1.foo() [mod1] foo() \u0026gt;\u0026gt;\u0026gt; from pkg import mod2 as quux \u0026gt;\u0026gt;\u0026gt; quux.bar() [mod2] bar() ä»æŠ€æœ¯ä¸Šè®²ï¼Œæ‚¨ä¹Ÿå¯ä»¥å¯¼å…¥è¯¥åŒ…ï¼š\n\u0026gt;\u0026gt;\u0026gt; import pkg \u0026gt;\u0026gt;\u0026gt; pkg \u0026lt;module \u0026#39;pkg\u0026#39; (namespace)\u0026gt; ä½†è¿™æ”¶æ•ˆç”šå¾®ã€‚è™½ç„¶ä¸¥æ ¼æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªè¯­æ³•æ­£ç¡®çš„ Python è¯­å¥ï¼Œä½†å®ƒå¹¶æ²¡æœ‰åšä»»ä½•æœ‰ç”¨çš„äº‹æƒ…ã€‚ç‰¹åˆ«æ˜¯ï¼Œå®ƒä¸ä¼šå°† pkg ä¸­çš„ä»»ä½•æ¨¡å—æ”¾å…¥æœ¬åœ°å‘½åç©ºé—´ä¸­ï¼š\n\u0026gt;\u0026gt;\u0026gt; pkg.mod1 Traceback (most recent call last): File \u0026#34;\u0026lt;pyshell#34\u0026gt;\u0026#34;, line 1, in \u0026lt;module\u0026gt; pkg.mod1 AttributeError: module \u0026#39;pkg\u0026#39; has no attribute \u0026#39;mod1\u0026#39; \u0026gt;\u0026gt;\u0026gt; pkg.mod1.foo() Traceback (most recent call last): File \u0026#34;\u0026lt;pyshell#35\u0026gt;\u0026#34;, line 1, in \u0026lt;module\u0026gt; pkg.mod1.foo() AttributeError: module \u0026#39;pkg\u0026#39; has no attribute \u0026#39;mod1\u0026#39; \u0026gt;\u0026gt;\u0026gt; pkg.mod2.Bar() Traceback (most recent call last): File \u0026#34;\u0026lt;pyshell#36\u0026gt;\u0026#34;, line 1, in \u0026lt;module\u0026gt; pkg.mod2.Bar() AttributeError: module \u0026#39;pkg\u0026#39; has no attribute \u0026#39;mod2\u0026#39; è¦å®é™…å¯¼å…¥æ¨¡å—æˆ–å…¶å†…å®¹ï¼Œæ‚¨éœ€è¦ä½¿ç”¨ä¸Šé¢æ˜¾ç¤ºçš„è¡¨å•ä¹‹ä¸€ã€‚\nåŒ…åˆå§‹åŒ– å¦‚æœåŒ…ç›®å½•ä¸­å­˜åœ¨åä¸º __init__.py çš„æ–‡ä»¶ï¼Œåˆ™åœ¨å¯¼å…¥åŒ…æˆ–åŒ…ä¸­çš„æ¨¡å—æ—¶ä¼šè°ƒç”¨è¯¥æ–‡ä»¶ã€‚è¿™å¯ç”¨äºæ‰§è¡ŒåŒ…åˆå§‹åŒ–ä»£ç ï¼Œä¾‹å¦‚åŒ…çº§æ•°æ®çš„åˆå§‹åŒ–ã€‚\nä¾‹å¦‚ï¼Œè€ƒè™‘ä»¥ä¸‹ __init__.py æ–‡ä»¶ï¼š\ninit.py\nprint(f\u0026#39;Invoking __init__.py for {__name__}\u0026#39;) A = [\u0026#39;quux\u0026#39;, \u0026#39;corge\u0026#39;, \u0026#39;grault\u0026#39;] æˆ‘ä»¬å°†æ­¤æ–‡ä»¶æ·»åŠ åˆ°ä¸Šé¢ç¤ºä¾‹ä¸­çš„ pkg ç›®å½•ä¸­ï¼š\nç°åœ¨ï¼Œå½“å¯¼å…¥åŒ…æ—¶ï¼Œå…¨å±€åˆ—è¡¨ A è¢«åˆå§‹åŒ–ï¼š\n\u0026gt;\u0026gt;\u0026gt; import pkg Invoking __init__.py for pkg \u0026gt;\u0026gt;\u0026gt; pkg.A [\u0026#39;quux\u0026#39;, \u0026#39;corge\u0026#39;, \u0026#39;grault\u0026#39;] åŒ…ä¸­çš„æ¨¡å—å¯ä»¥é€šè¿‡ä¾æ¬¡å¯¼å…¥æ¥è®¿é—®å…¨å±€å˜é‡ï¼š\nmod1.py\ndef foo(): from pkg import A print(\u0026#39;[mod1] foo() / A = \u0026#39;, A) class Foo: pass \u0026gt;\u0026gt;\u0026gt; from pkg import mod1 Invoking __init__.py for pkg \u0026gt;\u0026gt;\u0026gt; mod1.foo() [mod1] foo() / A = [\u0026#39;quux\u0026#39;, \u0026#39;corge\u0026#39;, \u0026#39;grault\u0026#39;] __init__.py è¿˜å¯ä»¥ç”¨äºå®ç°ä»åŒ…ä¸­è‡ªåŠ¨å¯¼å…¥æ¨¡å—ã€‚ä¾‹å¦‚ï¼Œä¹‹å‰æ‚¨çœ‹åˆ°è¯­å¥ import pkg ä»…å°†åç§° pkg æ”¾å…¥è°ƒç”¨è€…çš„æœ¬åœ°ç¬¦å·è¡¨ä¸­ï¼Œå¹¶ä¸”ä¸å¯¼å…¥ä»»ä½•æ¨¡å—ã€‚ä½†å¦‚æœ pkg ç›®å½•ä¸­çš„ __init__.py åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š\ninit.py\nprint(f\u0026#39;Invoking __init__.py for {__name__}\u0026#39;) import pkg.mod1, pkg.mod2 ç„¶åå½“æ‚¨æ‰§è¡Œ import pkg æ—¶ï¼Œä¼šè‡ªåŠ¨å¯¼å…¥æ¨¡å— mod1 å’Œ mod2 ï¼š\n\u0026gt;\u0026gt;\u0026gt; import pkg Invoking __init__.py for pkg \u0026gt;\u0026gt;\u0026gt; pkg.mod1.foo() [mod1] foo() \u0026gt;\u0026gt;\u0026gt; pkg.mod2.bar() [mod2] bar() æ³¨æ„ï¼šè®¸å¤š Python æ–‡æ¡£éƒ½æŒ‡å‡ºï¼Œåˆ›å»ºåŒ…æ—¶ï¼ŒåŒ…ç›®å½•ä¸­å¿…é¡»å­˜åœ¨ __init__.py æ–‡ä»¶ã€‚è¿™æ›¾ç»æ˜¯çœŸçš„ã€‚è¿‡å»ï¼Œ __init__.py çš„å­˜åœ¨å¯¹äº Python æ¥è¯´å°±æ„å‘³ç€æ­£åœ¨å®šä¹‰ä¸€ä¸ªåŒ…ã€‚è¯¥æ–‡ä»¶å¯ä»¥åŒ…å«åˆå§‹åŒ–ä»£ç ï¼Œç”šè‡³å¯ä»¥ä¸ºç©ºï¼Œä½†å®ƒå¿…é¡»å­˜åœ¨ã€‚\nä» Python 3.3 å¼€å§‹ï¼Œå¼•å…¥äº†éšå¼å‘½åç©ºé—´åŒ…ã€‚è¿™äº›å…è®¸åˆ›å»ºæ²¡æœ‰ä»»ä½• __init__.py æ–‡ä»¶çš„åŒ…ã€‚å½“ç„¶ï¼Œå¦‚æœéœ€è¦åŒ…åˆå§‹åŒ–ï¼Œå®ƒä»ç„¶å¯ä»¥å­˜åœ¨ã€‚ä½†ä¸å†éœ€è¦äº†ã€‚æŸ¥çœ‹ä»€ä¹ˆæ˜¯ Python å‘½åç©ºé—´åŒ…ï¼Œå®ƒæœ‰ä»€ä¹ˆç”¨ï¼Ÿäº†è§£æ›´å¤šã€‚\nä»åŒ…ä¸­å¯¼å…¥ * ä¸ºäº†ä»¥ä¸‹è®¨è®ºçš„ç›®çš„ï¼Œå…ˆå‰å®šä¹‰çš„åŒ…è¢«æ‰©å±•ä»¥åŒ…å«ä¸€äº›é™„åŠ æ¨¡å—ï¼š\nç°åœ¨ pkg ç›®å½•ä¸­å®šä¹‰äº†å››ä¸ªæ¨¡å—ã€‚å®ƒä»¬çš„å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š\nmod1.py\ndef foo(): print(\u0026#39;[mod1] foo()\u0026#39;) class Foo: pass mod2.py\ndef bar(): print(\u0026#39;[mod2] bar()\u0026#39;) class Bar: pass mod3.py\ndef baz(): print(\u0026#39;[mod3] baz()\u0026#39;) class Baz: pass mod4.py\ndef qux(): print(\u0026#39;[mod4] qux()\u0026#39;) class Qux: pass é‚£æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ\n\u0026gt;\u0026gt;\u0026gt; dir() [\u0026#39;__annotations__\u0026#39;, \u0026#39;__builtins__\u0026#39;, \u0026#39;__doc__\u0026#39;, \u0026#39;__loader__\u0026#39;, \u0026#39;__name__\u0026#39;, \u0026#39;__package__\u0026#39;, \u0026#39;__spec__\u0026#39;] \u0026gt;\u0026gt;\u0026gt; from pkg import * \u0026gt;\u0026gt;\u0026gt; dir() [\u0026#39;__annotations__\u0026#39;, \u0026#39;__builtins__\u0026#39;, \u0026#39;__doc__\u0026#39;, \u0026#39;__loader__\u0026#39;, \u0026#39;__name__\u0026#39;, \u0026#39;__package__\u0026#39;, \u0026#39;__spec__\u0026#39;] å“¼ã€‚ä¸å¤šã€‚æ‚¨å¯èƒ½æœŸæœ›ï¼ˆå‡è®¾æ‚¨æœ‰ä»»ä½•æœŸæœ›ï¼‰Python ä¼šæ·±å…¥åˆ°åŒ…ç›®å½•ä¸­ï¼Œæ‰¾åˆ°å®ƒèƒ½æ‰¾åˆ°çš„æ‰€æœ‰æ¨¡å—ï¼Œå¹¶å°†å®ƒä»¬å…¨éƒ¨å¯¼å…¥ã€‚ä½†æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚\nç›¸åï¼ŒPython éµå¾ªæ­¤çº¦å®šï¼šå¦‚æœåŒ…ç›®å½•ä¸­çš„ __init__.py æ–‡ä»¶åŒ…å«åä¸º __all__ çš„åˆ—è¡¨ï¼Œåˆ™åœ¨é‡åˆ°è¯­å¥ from \u0026lt;package_name\u0026gt; import * æ—¶ï¼Œå®ƒè¢«è§†ä¸ºåº”å¯¼å…¥çš„æ¨¡å—åˆ—è¡¨ã€‚\nå¯¹äºæœ¬ç¤ºä¾‹ï¼Œå‡è®¾æ‚¨åœ¨ pkg ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª __init__.py ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\npkg/init.py\n__all__ = [ \u0026#39;mod1\u0026#39;, \u0026#39;mod2\u0026#39;, \u0026#39;mod3\u0026#39;, \u0026#39;mod4\u0026#39; ] ç°åœ¨ from pkg import * å¯¼å…¥æ‰€æœ‰å››ä¸ªæ¨¡å—ï¼š\n\u0026gt;\u0026gt;\u0026gt; dir() [\u0026#39;__annotations__\u0026#39;, \u0026#39;__builtins__\u0026#39;, \u0026#39;__doc__\u0026#39;, \u0026#39;__loader__\u0026#39;, \u0026#39;__name__\u0026#39;, \u0026#39;__package__\u0026#39;, \u0026#39;__spec__\u0026#39;] \u0026gt;\u0026gt;\u0026gt; from pkg import * \u0026gt;\u0026gt;\u0026gt; dir() [\u0026#39;__annotations__\u0026#39;, \u0026#39;__builtins__\u0026#39;, \u0026#39;__doc__\u0026#39;, \u0026#39;__loader__\u0026#39;, \u0026#39;__name__\u0026#39;, \u0026#39;__package__\u0026#39;, \u0026#39;__spec__\u0026#39;, \u0026#39;mod1\u0026#39;, \u0026#39;mod2\u0026#39;, \u0026#39;mod3\u0026#39;, \u0026#39;mod4\u0026#39;] \u0026gt;\u0026gt;\u0026gt; mod2.bar() [mod2] bar() \u0026gt;\u0026gt;\u0026gt; mod4.Qux \u0026lt;class \u0026#39;pkg.mod4.Qux\u0026#39;\u0026gt; ä½¿ç”¨ import * ä»ç„¶ä¸è¢«è®¤ä¸ºæ˜¯ä¸€ç§å¾ˆå¥½çš„å½¢å¼ï¼Œå¯¹äºåŒ…æ¥è¯´æ¯”å¯¹äºæ¨¡å—æ¥è¯´æ›´æ˜¯å¦‚æ­¤ã€‚ä½†æ­¤åŠŸèƒ½è‡³å°‘ä½¿åŒ…çš„åˆ›å»ºè€…å¯ä»¥å¯¹æŒ‡å®š import * æ—¶å‘ç”Ÿçš„æƒ…å†µè¿›è¡Œä¸€äº›æ§åˆ¶ã€‚ ï¼ˆäº‹å®ä¸Šï¼Œå®ƒæä¾›äº†å®Œå…¨ç¦æ­¢å®ƒçš„åŠŸèƒ½ï¼Œåªéœ€å®Œå…¨æ‹’ç»å®šä¹‰ __all__ å³å¯ã€‚æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼ŒåŒ…çš„é»˜è®¤è¡Œä¸ºæ˜¯ä¸å¯¼å…¥ä»»ä½•å†…å®¹ã€‚ï¼‰\né¡ºä¾¿è¯´ä¸€å¥ï¼Œ __all__ ä¹Ÿå¯ä»¥åœ¨æ¨¡å—ä¸­å®šä¹‰ï¼Œå¹¶å…·æœ‰ç›¸åŒçš„ç›®çš„ï¼šæ§åˆ¶ä½¿ç”¨ import * å¯¼å…¥çš„å†…å®¹ã€‚ä¾‹å¦‚ï¼Œä¿®æ”¹ mod1.py å¦‚ä¸‹ï¼š\npkg/mod1.py\n__all__ = [\u0026#39;foo\u0026#39;] def foo(): print(\u0026#39;[mod1] foo()\u0026#39;) class Foo: pass ç°åœ¨ï¼Œæ¥è‡ª pkg.mod1 çš„ import * è¯­å¥å°†ä»…å¯¼å…¥ __all__ ä¸­åŒ…å«çš„å†…å®¹ï¼š\n\u0026gt;\u0026gt;\u0026gt; dir() [\u0026#39;__annotations__\u0026#39;, \u0026#39;__builtins__\u0026#39;, \u0026#39;__doc__\u0026#39;, \u0026#39;__loader__\u0026#39;, \u0026#39;__name__\u0026#39;, \u0026#39;__package__\u0026#39;, \u0026#39;__spec__\u0026#39;] \u0026gt;\u0026gt;\u0026gt; from pkg.mod1 import * \u0026gt;\u0026gt;\u0026gt; dir() [\u0026#39;__annotations__\u0026#39;, \u0026#39;__builtins__\u0026#39;, \u0026#39;__doc__\u0026#39;, \u0026#39;__loader__\u0026#39;, \u0026#39;__name__\u0026#39;, \u0026#39;__package__\u0026#39;, \u0026#39;__spec__\u0026#39;, \u0026#39;foo\u0026#39;] \u0026gt;\u0026gt;\u0026gt; foo() [mod1] foo() \u0026gt;\u0026gt;\u0026gt; Foo Traceback (most recent call last): File \u0026#34;\u0026lt;pyshell#37\u0026gt;\u0026#34;, line 1, in \u0026lt;module\u0026gt; Foo NameError: name \u0026#39;Foo\u0026#39; is not defined foo() ï¼ˆå‡½æ•°ï¼‰ç°åœ¨å®šä¹‰åœ¨æœ¬åœ°å‘½åç©ºé—´ä¸­ï¼Œä½† Foo ï¼ˆç±»ï¼‰ä¸æ˜¯ï¼Œå› ä¸ºåè€…ä¸åœ¨ __all__ ä¸­ã€‚\næ€»ä¹‹ï¼ŒåŒ…å’Œæ¨¡å—éƒ½ä½¿ç”¨ __all__ æ¥æ§åˆ¶æŒ‡å®š import * æ—¶å¯¼å…¥çš„å†…å®¹ã€‚ä½†é»˜è®¤è¡Œä¸ºæœ‰æ‰€ä¸åŒï¼š\nå¯¹äºåŒ…æ¥è¯´ï¼Œå½“ __all__ æœªå®šä¹‰æ—¶ï¼Œ import * ä¸ä¼šå¯¼å…¥ä»»ä½•å†…å®¹ã€‚ å¯¹äºæ¨¡å—ï¼Œå½“æœªå®šä¹‰ __all__ æ—¶ï¼Œ import * ä¼šå¯¼å…¥æ‰€æœ‰å†…å®¹ï¼ˆé™¤äº†â€”â€”ä½ çŒœå¯¹äº†â€”â€”ä»¥ä¸‹åˆ’çº¿å¼€å¤´çš„åç§°ï¼‰ã€‚ å­åŒ… åŒ…å¯ä»¥åŒ…å«ä»»æ„æ·±åº¦çš„åµŒå¥—å­åŒ…ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯¹ç¤ºä¾‹åŒ…ç›®å½•å†åšä¸€ä¸ªä¿®æ”¹ï¼Œå¦‚ä¸‹ï¼š\nå››ä¸ªæ¨¡å—ï¼ˆ mod1.py ã€ mod2.py ã€ mod3.py å’Œ mod4.py ï¼‰çš„å®šä¹‰å¦‚å‰ã€‚ä½†ç°åœ¨ï¼Œå®ƒä»¬ä¸å†è¢«é›†ä¸­åˆ° pkg ç›®å½•ä¸­ï¼Œè€Œæ˜¯åˆ†æˆä¸¤ä¸ªå­åŒ…ç›®å½•ï¼š sub_pkg1 å’Œ sub_pkg2 ã€‚\nå¯¼å…¥ä»ç„¶ä¸ä¹‹å‰æ‰€ç¤ºçš„ä¸€æ ·ã€‚è¯­æ³•ç±»ä¼¼ï¼Œä½†ä½¿ç”¨é¢å¤–çš„ç‚¹ç¬¦å·å°†åŒ…åç§°ä¸å­åŒ…åç§°åˆ†å¼€ï¼š\n\u0026gt;\u0026gt;\u0026gt; import pkg.sub_pkg1.mod1 \u0026gt;\u0026gt;\u0026gt; pkg.sub_pkg1.mod1.foo() [mod1] foo() \u0026gt;\u0026gt;\u0026gt; from pkg.sub_pkg1 import mod2 \u0026gt;\u0026gt;\u0026gt; mod2.bar() [mod2] bar() \u0026gt;\u0026gt;\u0026gt; from pkg.sub_pkg2.mod3 import baz \u0026gt;\u0026gt;\u0026gt; baz() [mod3] baz() \u0026gt;\u0026gt;\u0026gt; from pkg.sub_pkg2.mod4 import qux as grault \u0026gt;\u0026gt;\u0026gt; grault() [mod4] qux() æ­¤å¤–ï¼Œä¸€ä¸ªå­åŒ…ä¸­çš„æ¨¡å—å¯ä»¥å¼•ç”¨åŒçº§å­åŒ…ä¸­çš„å¯¹è±¡ï¼ˆå¦‚æœåŒçº§å­åŒ…åŒ…å«æ‚¨éœ€è¦çš„æŸäº›åŠŸèƒ½ï¼‰ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨æƒ³ä»æ¨¡å— mod3 ä¸­å¯¼å…¥å¹¶æ‰§è¡Œå‡½æ•° foo() ï¼ˆåœ¨æ¨¡å— mod1 ä¸­å®šä¹‰ï¼‰ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ç»å¯¹å¯¼å…¥ï¼š\npkg/sub__pkg2/mod3.py\ndef baz(): print(\u0026#39;[mod3] baz()\u0026#39;) class Baz: pass from pkg.sub_pkg1.mod1 import foo foo() \u0026gt;\u0026gt;\u0026gt; from pkg.sub_pkg2 import mod3 [mod1] foo() \u0026gt;\u0026gt;\u0026gt; mod3.foo() [mod1] foo() æˆ–è€…æ‚¨å¯ä»¥ä½¿ç”¨ç›¸å¯¹å¯¼å…¥ï¼Œå…¶ä¸­ .. æŒ‡çš„æ˜¯ä¸Šä¸€çº§çš„åŒ…ã€‚ä»å­åŒ… sub_pkg2 ä¸­çš„ mod3.py ä¸­ï¼Œ\n.. è®¡ç®—çˆ¶åŒ… ( pkg )ï¼Œå¹¶ä¸”\n..sub_pkg1 è®¡ç®—ä¸ºçˆ¶åŒ…çš„å­åŒ… sub_pkg1 ã€‚\npkg/sub__pkg2/mod3.py\ndef baz(): print(\u0026#39;[mod3] baz()\u0026#39;) class Baz: pass from .. import sub_pkg1 print(sub_pkg1) from ..sub_pkg1.mod1 import foo foo() \u0026gt;\u0026gt;\u0026gt; from pkg.sub_pkg2 import mod3 \u0026lt;module \u0026#39;pkg.sub_pkg1\u0026#39; (namespace)\u0026gt; [mod1] foo() ç»“è®º åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨æ¶µç›–äº†ä»¥ä¸‹ä¸»é¢˜ï¼š\nå¦‚ä½•åˆ›å»º Python æ¨¡å—\nPython è§£é‡Šå™¨æœç´¢æ¨¡å—çš„ä½ç½®\nå¦‚ä½•ä½¿ç”¨ import è¯­å¥è·å–å¯¹æ¨¡å—ä¸­å®šä¹‰çš„å¯¹è±¡çš„è®¿é—®æƒé™\nå¦‚ä½•åˆ›å»ºå¯ä½œä¸ºç‹¬ç«‹è„šæœ¬æ‰§è¡Œçš„æ¨¡å—\nå¦‚ä½•å°†æ¨¡å—ç»„ç»‡æˆåŒ…å’Œå­åŒ…\nå¦‚ä½•æ§åˆ¶åŒ…åˆå§‹åŒ–\nè¿™æœ‰æœ›è®©æ‚¨æ›´å¥½åœ°äº†è§£å¦‚ä½•è®¿é—® Python ä¸­å¯ç”¨çš„è®¸å¤šç¬¬ä¸‰æ–¹å’Œå†…ç½®æ¨¡å—ä¸­å¯ç”¨çš„åŠŸèƒ½ã€‚\næ­¤å¤–ï¼Œå¦‚æœæ‚¨æ­£åœ¨å¼€å‘è‡ªå·±çš„åº”ç”¨ç¨‹åºï¼Œåˆ›å»ºè‡ªå·±çš„æ¨¡å—å’ŒåŒ…å°†å¸®åŠ©æ‚¨ç»„ç»‡å’Œæ¨¡å—åŒ–ä»£ç ï¼Œä»è€Œä½¿ç¼–ç ã€ç»´æŠ¤å’Œè°ƒè¯•æ›´åŠ å®¹æ˜“ã€‚\nå¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ Python.org ä¸Šçš„ä»¥ä¸‹æ–‡æ¡£ï¼š\nThe import system The Python tutorial: Modules å¿«ä¹çš„ Pythonï¼\nåŸæ–‡é“¾æ¥ï¼šhttps://realpython.com/python-modules-packages\n","permalink":"https://blog.chensoul.cc/posts/2023/06/25/python-modules-packages/","summary":"æœ¬æ–‡æ¢è®¨äº† Python æ¨¡å—å’Œ Python åŒ…ï¼Œè¿™ä¸¤ç§æœºåˆ¶æœ‰åŠ©äºæ¨¡å—åŒ–ç¼–ç¨‹ã€‚\næ¨¡å—åŒ–ç¼–ç¨‹æ˜¯æŒ‡å°†å¤§å‹ã€ç¬¨é‡çš„ç¼–ç¨‹ä»»åŠ¡åˆ†è§£ä¸ºå•ç‹¬çš„ã€æ›´å°çš„ã€æ›´æ˜“äºç®¡ç†çš„å­ä»»åŠ¡æˆ–æ¨¡å—çš„è¿‡ç¨‹ã€‚ç„¶åå¯ä»¥åƒæ„å»ºå—ä¸€æ ·å°†å„ä¸ªæ¨¡å—æ‹¼å‡‘åœ¨ä¸€èµ·ä»¥åˆ›å»ºæ›´å¤§çš„åº”ç”¨ç¨‹åºã€‚\nåœ¨å¤§å‹åº”ç”¨ç¨‹åºä¸­æ¨¡å—åŒ–ä»£ç æœ‰å‡ ä¸ªä¼˜ç‚¹ï¼š\nç®€å•æ€§ï¼šæ¨¡å—é€šå¸¸ä¸ä¼šä¸“æ³¨äºæ‰‹å¤´çš„æ•´ä¸ªé—®é¢˜ï¼Œè€Œæ˜¯ä¸“æ³¨äºé—®é¢˜çš„ä¸€ä¸ªç›¸å¯¹è¾ƒå°çš„éƒ¨åˆ†ã€‚å¦‚æœæ‚¨æ­£åœ¨å¤„ç†å•ä¸ªæ¨¡å—ï¼Œé‚£ä¹ˆæ‚¨å°†æœ‰ä¸€ä¸ªè¾ƒå°çš„é—®é¢˜åŸŸæ¥è§£å†³é—®é¢˜ã€‚è¿™ä½¿å¾—å¼€å‘æ›´å®¹æ˜“å¹¶ä¸”æ›´ä¸å®¹æ˜“å‡ºé”™ã€‚\nå¯ç»´æŠ¤æ€§ï¼šæ¨¡å—é€šå¸¸è®¾è®¡ä¸ºåœ¨ä¸åŒé—®é¢˜åŸŸä¹‹é—´å¼ºåˆ¶æ‰§è¡Œé€»è¾‘è¾¹ç•Œã€‚å¦‚æœæ¨¡å—æ˜¯ä»¥æœ€å°åŒ–ç›¸äº’ä¾èµ–çš„æ–¹å¼ç¼–å†™çš„ï¼Œé‚£ä¹ˆå¯¹å•ä¸ªæ¨¡å—çš„ä¿®æ”¹å¯¹ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†äº§ç”Ÿå½±å“çš„å¯èƒ½æ€§å°±ä¼šé™ä½ã€‚ï¼ˆæ‚¨ç”šè‡³å¯ä»¥åœ¨ä¸äº†è§£è¯¥æ¨¡å—ä¹‹å¤–çš„åº”ç”¨ç¨‹åºçš„æƒ…å†µä¸‹å¯¹è¯¥æ¨¡å—è¿›è¡Œæ›´æ”¹ã€‚ï¼‰è¿™ä½¿å¾—ç”±è®¸å¤šç¨‹åºå‘˜ç»„æˆçš„å›¢é˜Ÿåœ¨å¤§å‹åº”ç”¨ç¨‹åºä¸ŠååŒå·¥ä½œå˜å¾—æ›´åŠ å¯è¡Œã€‚\nå¯é‡ç”¨æ€§ï¼šåœ¨å•ä¸ªæ¨¡å—ä¸­å®šä¹‰çš„åŠŸèƒ½å¯ä»¥å¾ˆå®¹æ˜“åœ°è¢«åº”ç”¨ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†é‡ç”¨ï¼ˆé€šè¿‡é€‚å½“å®šä¹‰çš„æ¥å£ï¼‰ã€‚è¿™æ¶ˆé™¤äº†é‡å¤ä»£ç çš„éœ€è¦ã€‚\nä½œç”¨åŸŸï¼šæ¨¡å—é€šå¸¸å®šä¹‰ä¸€ä¸ªå•ç‹¬çš„åç§°ç©ºé—´ï¼Œè¿™æœ‰åŠ©äºé¿å…ç¨‹åºä¸åŒåŒºåŸŸä¸­æ ‡è¯†ç¬¦ä¹‹é—´çš„å†²çªã€‚ ï¼ˆPython ä¹‹ç¦…çš„ä¿¡æ¡ä¹‹ä¸€æ˜¯å‘½åç©ºé—´æ˜¯ä¸€ä¸ªéå¸¸æ£’çš„æƒ³æ³•â€”â€”è®©æˆ‘ä»¬åšæ›´å¤šè¿™æ ·çš„äº‹æƒ…å§ï¼ï¼‰\nå‡½æ•°ã€æ¨¡å—å’ŒåŒ…éƒ½æ˜¯ Python ä¸­ä¿ƒè¿›ä»£ç æ¨¡å—åŒ–çš„æ„é€ ã€‚\nPython æ¨¡å—ï¼šæ¦‚è¿° åœ¨ Python ä¸­å®é™…ä¸Šæœ‰ä¸‰ç§ä¸åŒçš„æ–¹å¼æ¥å®šä¹‰æ¨¡å—ï¼š\næ¨¡å—å¯ä»¥ç”¨ Python æœ¬èº«ç¼–å†™ã€‚\næ¨¡å—å¯ä»¥ç”¨ C è¯­è¨€ç¼–å†™å¹¶åœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½ï¼Œä¾‹å¦‚ re ï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼‰æ¨¡å—ã€‚\nå†…ç½®æ¨¡å—æœ¬è´¨ä¸ŠåŒ…å«åœ¨è§£é‡Šå™¨ä¸­ï¼Œä¾‹å¦‚ itertools æ¨¡å—ã€‚\nåœ¨æ‰€æœ‰ä¸‰ç§æƒ…å†µä¸‹ï¼Œæ¨¡å—çš„å†…å®¹éƒ½ä»¥ç›¸åŒçš„æ–¹å¼è®¿é—®ï¼šä½¿ç”¨ import è¯­å¥ã€‚\nåœ¨è¿™é‡Œï¼Œé‡ç‚¹å°†ä¸»è¦æ”¾åœ¨ç”¨ Python ç¼–å†™çš„æ¨¡å—ä¸Šã€‚ç”¨ Python ç¼–å†™çš„æ¨¡å—çš„å¦™å¤„åœ¨äºå®ƒä»¬çš„æ„å»ºéå¸¸ç®€å•ã€‚\næ‚¨éœ€è¦åšçš„å°±æ˜¯åˆ›å»ºä¸€ä¸ªåŒ…å«åˆæ³• Python ä»£ç çš„æ–‡ä»¶ï¼Œç„¶åä¸ºè¯¥æ–‡ä»¶æŒ‡å®šä¸€ä¸ªå¸¦æœ‰ .py æ‰©å±•åçš„åç§°ã€‚å°±æ˜¯è¿™æ ·ï¼ä¸éœ€è¦ç‰¹æ®Šçš„è¯­æ³•æˆ–å·«æœ¯ã€‚\nä¾‹å¦‚ï¼Œå‡è®¾æ‚¨åˆ›å»ºäº†ä¸€ä¸ªåä¸º mod.py çš„æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š\nmod.py\ns = \u0026#34;If Comrade Napoleon says it, it must be right.\u0026#34; a = [100, 200, 300] def foo(arg): print(f\u0026#39;arg = {arg}\u0026#39;) class Foo: pass mod.py ä¸­å®šä¹‰äº†å‡ ä¸ªå¯¹è±¡ï¼š\ns ï¼ˆå­—ç¬¦ä¸²ï¼‰ a ï¼ˆåˆ—è¡¨ï¼‰ foo() ï¼ˆå‡½æ•°ï¼‰ Foo ï¼ˆç±»ï¼‰ å‡è®¾ mod.py ä½äºé€‚å½“çš„ä½ç½®ï¼ˆæ‚¨å¾ˆå¿«å°±ä¼šäº†è§£æ›´å¤šä¿¡æ¯ï¼‰ï¼Œå¯ä»¥é€šè¿‡å¯¼å…¥æ¨¡å—æ¥è®¿é—®è¿™äº›å¯¹è±¡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\u0026gt;\u0026gt;\u0026gt; import mod \u0026gt;\u0026gt;\u0026gt; print(mod.s) If Comrade Napoleon says it, it must be right.","title":"[è¯‘]Pythonæ¨¡å—å’ŒåŒ…-ç®€ä»‹"},{"content":"å‡½æ•°çš„å®šä¹‰ åœ¨ Python ä¸­ï¼Œå‡½æ•°æ˜¯ä¸€æ®µå¯é‡å¤ä½¿ç”¨çš„ä»£ç å—ï¼Œå®ƒæ¥å—ä¸€äº›è¾“å…¥ï¼ˆä¹Ÿç§°ä¸ºå‚æ•°ï¼‰å¹¶äº§ç”Ÿä¸€äº›è¾“å‡ºã€‚å‡½æ•°å¯ä»¥é€šè¿‡ def å…³é”®å­—æ¥å®šä¹‰ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š\ndef function_name(parameters): \u0026#34;\u0026#34;\u0026#34;This is a function\u0026#34;\u0026#34;\u0026#34; # function body return value å…¶ä¸­ï¼Œfunction_name æ˜¯å‡½æ•°çš„åç§°ï¼Œparameters æ˜¯å‡½æ•°çš„å‚æ•°åˆ—è¡¨ï¼Œfunction body æ˜¯å‡½æ•°çš„ä¸»ä½“éƒ¨åˆ†ï¼ŒåŒ…æ‹¬éœ€è¦æ‰§è¡Œçš„ä»£ç å’Œå¯èƒ½çš„è¿”å›è¯­å¥ï¼Œreturn value æ˜¯å‡½æ•°çš„è¿”å›å€¼ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚\nä¸‹åˆ—ä»£ç åˆ›å»ºä¸€ä¸ªå¯ä»¥è¾“å‡ºé™å®šæ•°å€¼å†…çš„æ–æ³¢é‚£å¥‘æ•°åˆ—å‡½æ•°ï¼š\ndef fib(n): # write Fibonacci series up to n \u0026#34;\u0026#34;\u0026#34;Print a Fibonacci series up to n.\u0026#34;\u0026#34;\u0026#34; a, b = 0, 1 while a \u0026lt; n: print(a, end=\u0026#39; \u0026#39;) a, b = b, a+b print() fib(2000) # 0 1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 159 å®šä¹‰ å‡½æ•°ä½¿ç”¨å…³é”®å­— defï¼Œåè·Ÿå‡½æ•°åä¸æ‹¬å·å†…çš„å½¢å‚åˆ—è¡¨ã€‚å‡½æ•°è¯­å¥ä»ä¸‹ä¸€è¡Œå¼€å§‹ï¼Œå¹¶ä¸”å¿…é¡»ç¼©è¿›ã€‚\nå‡½æ•°å†…çš„ç¬¬ä¸€æ¡è¯­å¥æ˜¯å­—ç¬¦ä¸²æ—¶ï¼Œè¯¥å­—ç¬¦ä¸²å°±æ˜¯æ–‡æ¡£å­—ç¬¦ä¸²ï¼Œä¹Ÿç§°ä¸º docstringã€‚åˆ©ç”¨æ–‡æ¡£å­—ç¬¦ä¸²å¯ä»¥è‡ªåŠ¨ç”Ÿæˆåœ¨çº¿æ–‡æ¡£æˆ–æ‰“å°ç‰ˆæ–‡æ¡£ï¼Œè¿˜å¯ä»¥è®©å¼€å‘è€…åœ¨æµè§ˆä»£ç æ—¶ç›´æ¥æŸ¥é˜…æ–‡æ¡£ï¼›Python å¼€å‘è€…æœ€å¥½å…»æˆåœ¨ä»£ç ä¸­åŠ å…¥æ–‡æ¡£å­—ç¬¦ä¸²çš„å¥½ä¹ æƒ¯ã€‚\nå‡½æ•°åœ¨ æ‰§è¡Œ æ—¶ä½¿ç”¨å‡½æ•°å±€éƒ¨å˜é‡ç¬¦å·è¡¨ï¼Œæ‰€æœ‰å‡½æ•°å˜é‡èµ‹å€¼éƒ½å­˜åœ¨å±€éƒ¨ç¬¦å·è¡¨ä¸­ï¼›å¼•ç”¨å˜é‡æ—¶ï¼Œé¦–å…ˆï¼Œåœ¨å±€éƒ¨ç¬¦å·è¡¨é‡ŒæŸ¥æ‰¾å˜é‡ï¼Œç„¶åï¼Œæ˜¯å¤–å±‚å‡½æ•°å±€éƒ¨ç¬¦å·è¡¨ï¼Œå†æ˜¯å…¨å±€ç¬¦å·è¡¨ï¼Œæœ€åæ˜¯å†…ç½®åç§°ç¬¦å·è¡¨ã€‚å› æ­¤ï¼Œå°½ç®¡å¯ä»¥å¼•ç”¨å…¨å±€å˜é‡å’Œå¤–å±‚å‡½æ•°çš„å˜é‡ï¼Œä½†æœ€å¥½ä¸è¦åœ¨å‡½æ•°å†…ç›´æ¥èµ‹å€¼ï¼ˆé™¤éæ˜¯ global è¯­å¥å®šä¹‰çš„å…¨å±€å˜é‡ï¼Œæˆ– nonlocal è¯­å¥å®šä¹‰çš„å¤–å±‚å‡½æ•°å˜é‡ï¼‰ã€‚\nåœ¨è°ƒç”¨å‡½æ•°æ—¶ä¼šå°†å®é™…å‚æ•°ï¼ˆå®å‚ï¼‰å¼•å…¥åˆ°è¢«è°ƒç”¨å‡½æ•°çš„å±€éƒ¨ç¬¦å·è¡¨ä¸­ï¼›å› æ­¤ï¼Œå®å‚æ˜¯ä½¿ç”¨ æŒ‰å€¼è°ƒç”¨ æ¥ä¼ é€’çš„ï¼ˆå…¶ä¸­çš„ å€¼ å§‹ç»ˆæ˜¯å¯¹è±¡çš„ å¼•ç”¨ è€Œä¸æ˜¯å¯¹è±¡çš„å€¼ï¼‰ã€‚ 1 å½“ä¸€ä¸ªå‡½æ•°è°ƒç”¨å¦å¤–ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œä¼šä¸ºè¯¥è°ƒç”¨åˆ›å»ºä¸€ä¸ªæ–°çš„å±€éƒ¨ç¬¦å·è¡¨ã€‚\nå‡½æ•°å®šä¹‰åœ¨å½“å‰ç¬¦å·è¡¨ä¸­æŠŠå‡½æ•°åä¸å‡½æ•°å¯¹è±¡å…³è”åœ¨ä¸€èµ·ã€‚è§£é‡Šå™¨æŠŠå‡½æ•°åæŒ‡å‘çš„å¯¹è±¡ä½œä¸ºç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ã€‚è¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–åç§°æŒ‡å‘åŒä¸€ä¸ªå‡½æ•°å¯¹è±¡ï¼Œå¹¶è®¿é—®è®¿è¯¥å‡½æ•°ï¼š\nfib f = fib f(100) # 0 1 1 2 3 5 8 13 21 34 55 89 fib ä¸è¿”å›å€¼ï¼Œå› æ­¤ï¼Œå…¶ä»–è¯­è¨€ä¸æŠŠå®ƒå½“ä½œå‡½æ•°ï¼Œè€Œæ˜¯å½“ä½œè¿‡ç¨‹ã€‚äº‹å®ä¸Šï¼Œæ²¡æœ‰ return è¯­å¥çš„å‡½æ•°ä¹Ÿè¿”å›å€¼ï¼Œåªä¸è¿‡è¿™ä¸ªå€¼æ¯”è¾ƒæ˜¯ None ï¼ˆæ˜¯ä¸€ä¸ªå†…ç½®åç§°ï¼‰ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè§£é‡Šå™¨ä¸ä¼šè¾“å‡ºå•ç‹¬çš„è¿”å›å€¼ None ï¼Œå¦‚éœ€æŸ¥çœ‹è¯¥å€¼ï¼Œå¯ä»¥ä½¿ç”¨ print()ï¼š\nfib(0) print(fib(0)) å‡½æ•°å‚æ•° é»˜è®¤å€¼å‚æ•° åœ¨ Python ä¸­ï¼Œå‡½æ•°å‚æ•°å¯ä»¥å…·æœ‰é»˜è®¤å€¼ï¼Œè¿™æ„å‘³ç€å¦‚æœåœ¨å‡½æ•°è°ƒç”¨æœŸé—´æœªæä¾›è¯¥å‚æ•°çš„å€¼ï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼ã€‚å®šä¹‰å…·æœ‰é»˜è®¤å€¼çš„å‡½æ•°å‚æ•°çš„è¯­æ³•å¦‚ä¸‹ï¼š\ndef function_name(param1, param2=default_value): # function body return value å…¶ä¸­ï¼Œparam1 æ˜¯å¿…éœ€çš„å‚æ•°ï¼Œå®ƒæ²¡æœ‰é»˜è®¤å€¼ï¼›param2 æ˜¯å¯é€‰å‚æ•°ï¼Œå¦‚æœæœªæä¾›ï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼ default_valueã€‚å¦‚æœè°ƒç”¨å‡½æ•°æ—¶æä¾›äº† param2 çš„å€¼ï¼Œåˆ™ä½¿ç”¨æä¾›çš„å€¼è¦†ç›–é»˜è®¤å€¼ã€‚\nä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨é»˜è®¤å‚æ•°å€¼çš„ Python å‡½æ•°ç¤ºä¾‹ï¼š\ndef greet(name, greeting=\u0026#34;Hello\u0026#34;): print(f\u0026#34;{greeting}, {name}!\u0026#34;) greet(\u0026#34;Alice\u0026#34;) # output: Hello, Alice! greet(\u0026#34;Bob\u0026#34;, \u0026#34;Hi\u0026#34;) # output: Hi, Bob! éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“å‡½æ•°å‚æ•°å…·æœ‰é»˜è®¤å€¼æ—¶ï¼Œåº”è¯¥å°†å…·æœ‰é»˜è®¤å€¼çš„å‚æ•°æ”¾åœ¨å‚æ•°åˆ—è¡¨çš„æœ«å°¾ã€‚è¿™æ ·å¯ä»¥ä½¿å‡½æ•°æ›´åŠ æ˜“äºä½¿ç”¨ï¼Œå¹¶é¿å…åœ¨è°ƒç”¨å‡½æ•°æ—¶å‡ºç°æ··æ·†ã€‚\nä»¥ä¸‹æ˜¯ä¸€ä¸ªå…·æœ‰å¤šä¸ªé»˜è®¤å‚æ•°å€¼çš„ Python å‡½æ•°çš„ç¤ºä¾‹ï¼š\ndef create_user(name, age=18, gender=\u0026#34;male\u0026#34;, email=None): user = {\u0026#34;name\u0026#34;: name, \u0026#34;age\u0026#34;: age, \u0026#34;gender\u0026#34;: gender} if email: user[\u0026#34;email\u0026#34;] = email return user user1 = create_user(\u0026#34;Alice\u0026#34;) user2 = create_user(\u0026#34;Bob\u0026#34;, 20) user3 = create_user(\u0026#34;Charlie\u0026#34;, gender=\u0026#34;female\u0026#34;, email=\u0026#34;charlie@example.com\u0026#34;) print(user1) # output: {\u0026#39;name\u0026#39;: \u0026#39;Alice\u0026#39;, \u0026#39;age\u0026#39;: 18, \u0026#39;gender\u0026#39;: \u0026#39;male\u0026#39;} print(user2) # output: {\u0026#39;name\u0026#39;: \u0026#39;Bob\u0026#39;, \u0026#39;age\u0026#39;: 20, \u0026#39;gender\u0026#39;: \u0026#39;male\u0026#39;} print(user3) # output: {\u0026#39;name\u0026#39;: \u0026#39;Charlie\u0026#39;, \u0026#39;age\u0026#39;: 18, \u0026#39;gender\u0026#39;: \u0026#39;female\u0026#39;, \u0026#39;email\u0026#39;: \u0026#39;charlie@example.com\u0026#39;} å…³é”®å­—å‚æ•° kwarg=value å½¢å¼çš„å…³é”®å­—å‚æ•°ä¹Ÿå¯ä»¥ç”¨äºè°ƒç”¨å‡½æ•°ã€‚å‡½æ•°ç¤ºä¾‹å¦‚ä¸‹ï¼š\ndef parrot(voltage, state=\u0026#39;a stiff\u0026#39;, action=\u0026#39;voom\u0026#39;, type=\u0026#39;Norwegian Blue\u0026#39;): print(\u0026#34;-- This parrot wouldn\u0026#39;t\u0026#34;, action, end=\u0026#39; \u0026#39;) print(\u0026#34;if you put\u0026#34;, voltage, \u0026#34;volts through it.\u0026#34;) print(\u0026#34;-- Lovely plumage, the\u0026#34;, type) print(\u0026#34;-- It\u0026#39;s\u0026#34;, state, \u0026#34;!\u0026#34;) è¯¥å‡½æ•°æ¥å—ä¸€ä¸ªå¿…é€‰å‚æ•°ï¼ˆvoltageï¼‰å’Œä¸‰ä¸ªå¯é€‰å‚æ•°ï¼ˆstate, action å’Œ typeï¼‰ã€‚è¯¥å‡½æ•°å¯ç”¨ä¸‹åˆ—æ–¹å¼è°ƒç”¨ï¼š\nparrot(1000) # 1 positional argument parrot(voltage=1000) # 1 keyword argument parrot(voltage=1000000, action=\u0026#39;VOOOOOM\u0026#39;) # 2 keyword arguments parrot(action=\u0026#39;VOOOOOM\u0026#39;, voltage=1000000) # 2 keyword arguments parrot(\u0026#39;a million\u0026#39;, \u0026#39;bereft of life\u0026#39;, \u0026#39;jump\u0026#39;) # 3 positional arguments parrot(\u0026#39;a thousand\u0026#39;, state=\u0026#39;pushing up the daisies\u0026#39;) # 1 positional, 1 keyword ä»¥ä¸‹è°ƒç”¨å‡½æ•°çš„æ–¹å¼éƒ½æ— æ•ˆï¼š\nparrot() # required argument missing parrot(voltage=5.0, \u0026#39;dead\u0026#39;) # non-keyword argument after a keyword argument parrot(110, voltage=220) # duplicate value for the same argument parrot(actor=\u0026#39;John Cleese\u0026#39;) # unknown keyword argument å‡½æ•°è°ƒç”¨æ—¶ï¼Œå…³é”®å­—å‚æ•°å¿…é¡»è·Ÿåœ¨ä½ç½®å‚æ•°åé¢ã€‚æ‰€æœ‰ä¼ é€’çš„å…³é”®å­—å‚æ•°éƒ½å¿…é¡»åŒ¹é…ä¸€ä¸ªå‡½æ•°æ¥å—çš„å‚æ•°ï¼ˆæ¯”å¦‚ï¼Œactor ä¸æ˜¯å‡½æ•° parrot çš„æœ‰æ•ˆå‚æ•°ï¼‰ï¼Œå…³é”®å­—å‚æ•°çš„é¡ºåºå¹¶ä¸é‡è¦ã€‚è¿™ä¹ŸåŒ…æ‹¬å¿…é€‰å‚æ•°ï¼Œï¼ˆæ¯”å¦‚ï¼Œparrot(voltage=1000) ä¹Ÿæœ‰æ•ˆï¼‰ã€‚ä¸èƒ½å¯¹åŒä¸€ä¸ªå‚æ•°å¤šæ¬¡èµ‹å€¼ï¼Œä¸‹é¢å°±æ˜¯ä¸€ä¸ªå› æ­¤é™åˆ¶è€Œå¤±è´¥çš„ä¾‹å­ï¼š\ndef function(a): pass function(0, a=0) #Traceback (most recent call last): # File \u0026#34;\u0026lt;stdin\u0026gt;\u0026#34;, line 1, in \u0026lt;module\u0026gt; #TypeError: function() got multiple values for argument \u0026#39;a\u0026#39; æœ€åä¸€ä¸ªå½¢å‚ä¸º **name å½¢å¼æ—¶ï¼Œæ¥æ”¶ä¸€ä¸ªå­—å…¸ï¼Œè¯¥å­—å…¸åŒ…å«ä¸å‡½æ•°ä¸­å·²å®šä¹‰å½¢å‚å¯¹åº”ä¹‹å¤–çš„æ‰€æœ‰å…³é”®å­—å‚æ•°ã€‚**name å½¢å‚å¯ä»¥ä¸ *name å½¢å‚ï¼ˆä¸‹ä¸€å°èŠ‚ä»‹ç»ï¼‰ç»„åˆä½¿ç”¨ï¼ˆ*name å¿…é¡»åœ¨ **name å‰é¢ï¼‰ï¼Œ *name å½¢å‚æ¥æ”¶ä¸€ä¸ªå…ƒç»„ï¼Œè¯¥å…ƒç»„åŒ…å«å½¢å‚åˆ—è¡¨ä¹‹å¤–çš„ä½ç½®å‚æ•°ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å®šä¹‰ä¸‹é¢è¿™æ ·çš„å‡½æ•°ï¼š\ndef cheeseshop(kind, *arguments, **keywords): print(\u0026#34;-- Do you have any\u0026#34;, kind, \u0026#34;?\u0026#34;) print(\u0026#34;-- I\u0026#39;m sorry, we\u0026#39;re all out of\u0026#34;, kind) for arg in arguments: print(arg) print(\u0026#34;-\u0026#34; * 40) for kw in keywords: print(kw, \u0026#34;:\u0026#34;, keywords[kw]) è¯¥å‡½æ•°å¯ä»¥ç”¨å¦‚ä¸‹æ–¹å¼è°ƒç”¨ï¼š\ncheeseshop(\u0026#34;Limburger\u0026#34;, \u0026#34;It\u0026#39;s very runny, sir.\u0026#34;, \u0026#34;It\u0026#39;s really very, VERY runny, sir.\u0026#34;, shopkeeper=\u0026#34;Michael Palin\u0026#34;, client=\u0026#34;John Cleese\u0026#34;, sketch=\u0026#34;Cheese Shop Sketch\u0026#34;) è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š\n-- Do you have any Limburger ? -- I\u0026#39;m sorry, we\u0026#39;re all out of Limburger It\u0026#39;s very runny, sir. It\u0026#39;s really very, VERY runny, sir. ---------------------------------------- shopkeeper : Michael Palin client : John Cleese sketch : Cheese Shop Sketch æ³¨æ„ï¼Œå…³é”®å­—å‚æ•°åœ¨è¾“å‡ºç»“æœä¸­çš„é¡ºåºä¸è°ƒç”¨å‡½æ•°æ—¶çš„é¡ºåºä¸€è‡´ã€‚\nç‰¹æ®Šå‚æ•° é»˜è®¤æƒ…å†µä¸‹ï¼Œå‚æ•°å¯ä»¥æŒ‰ä½ç½®æˆ–æ˜¾å¼å…³é”®å­—ä¼ é€’ç»™ Python å‡½æ•°ã€‚ä¸ºäº†è®©ä»£ç æ˜“è¯»ã€é«˜æ•ˆï¼Œæœ€å¥½é™åˆ¶å‚æ•°çš„ä¼ é€’æ–¹å¼ï¼Œè¿™æ ·ï¼Œå¼€å‘è€…åªéœ€æŸ¥çœ‹å‡½æ•°å®šä¹‰ï¼Œå³å¯ç¡®å®šå‚æ•°é¡¹æ˜¯ä»…æŒ‰ä½ç½®ã€æŒ‰ä½ç½®æˆ–å…³é”®å­—ï¼Œè¿˜æ˜¯ä»…æŒ‰å…³é”®å­—ä¼ é€’ã€‚\nå‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š\ndef f(pos1, pos2, /, pos_or_kwd, *, kwd1, kwd2): ----------- ---------- ---------- | | | | Positional or keyword | | - Keyword only -- Positional only / å’Œ * æ˜¯å¯é€‰çš„ã€‚è¿™äº›ç¬¦å·è¡¨æ˜å½¢å‚å¦‚ä½•æŠŠå‚æ•°å€¼ä¼ é€’ç»™å‡½æ•°ï¼šä½ç½®ã€ä½ç½®æˆ–å…³é”®å­—ã€å…³é”®å­—ã€‚å…³é”®å­—å½¢å‚ä¹Ÿå«ä½œå‘½åå½¢å‚ã€‚\nä½ç½®æˆ–å…³é”®å­—å‚æ•°ã€‚å‡½æ•°å®šä¹‰ä¸­æœªä½¿ç”¨ / å’Œ * æ—¶ï¼Œå‚æ•°å¯ä»¥æŒ‰ä½ç½®æˆ–å…³é”®å­—ä¼ é€’ç»™å‡½æ•°ã€‚\nä»…ä½ç½®å‚æ•°ã€‚ç‰¹å®šå½¢å‚å¯ä»¥æ ‡è®°ä¸º ä»…é™ä½ç½®ã€‚ä»…é™ä½ç½® æ—¶ï¼Œå½¢å‚çš„é¡ºåºå¾ˆé‡è¦ï¼Œä¸”è¿™äº›å½¢å‚ä¸èƒ½ç”¨å…³é”®å­—ä¼ é€’ã€‚ä»…é™ä½ç½®å½¢å‚åº”æ”¾åœ¨ / ï¼ˆæ­£æ–œæ ï¼‰å‰ã€‚/ ç”¨äºåœ¨é€»è¾‘ä¸Šåˆ†å‰²ä»…é™ä½ç½®å½¢å‚ä¸å…¶å®ƒå½¢å‚ã€‚å¦‚æœå‡½æ•°å®šä¹‰ä¸­æ²¡æœ‰ /ï¼Œåˆ™è¡¨ç¤ºæ²¡æœ‰ä»…é™ä½ç½®å½¢å‚ã€‚/ åå¯ä»¥æ˜¯ ä½ç½®æˆ–å…³é”®å­— æˆ– ä»…é™å…³é”®å­— å½¢å‚ã€‚\nä»…é™å…³é”®å­—å‚æ•°ã€‚æŠŠå½¢å‚æ ‡è®°ä¸º ä»…é™å…³é”®å­—ï¼Œè¡¨æ˜å¿…é¡»ä»¥å…³é”®å­—å‚æ•°å½¢å¼ä¼ é€’è¯¥å½¢å‚ï¼Œåº”åœ¨å‚æ•°åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ª ä»…é™å…³é”®å­— å½¢å‚å‰æ·»åŠ  *ã€‚\nè¯·çœ‹ä¸‹é¢çš„å‡½æ•°å®šä¹‰ç¤ºä¾‹ï¼Œæ³¨æ„ / å’Œ * æ ‡è®°ï¼š\ndef standard_arg(arg): print(arg) def pos_only_arg(arg, /): print(arg) def kwd_only_arg(*, arg): print(arg) def combined_example(pos_only, /, standard, *, kwd_only): print(pos_only, standard, kwd_only) ç¬¬ä¸€ä¸ªå‡½æ•°å®šä¹‰ standard_arg æ˜¯æœ€å¸¸è§çš„å½¢å¼ï¼Œå¯¹è°ƒç”¨æ–¹å¼æ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œå¯ä»¥æŒ‰ä½ç½®ä¹Ÿå¯ä»¥æŒ‰å…³é”®å­—ä¼ é€’å‚æ•°ï¼š\nstandard_arg(2) # 2 standard_arg(arg=2) # 2 ç¬¬äºŒä¸ªå‡½æ•° pos_only_arg çš„å‡½æ•°å®šä¹‰ä¸­æœ‰ /ï¼Œä»…é™ä½¿ç”¨ä½ç½®å½¢å‚ï¼š\npos_only_arg(1) # 1 ç¬¬ä¸‰ä¸ªå‡½æ•° kwd_only_args çš„å‡½æ•°å®šä¹‰é€šè¿‡ * è¡¨æ˜ä»…é™å…³é”®å­—å‚æ•°ï¼š\nkwd_only_arg(arg=3) # 3 æœ€åä¸€ä¸ªå‡½æ•°åœ¨åŒä¸€ä¸ªå‡½æ•°å®šä¹‰ä¸­ï¼Œä½¿ç”¨äº†å…¨éƒ¨ä¸‰ç§è°ƒç”¨æƒ¯ä¾‹ï¼š\ncombined_example(1, 2, kwd_only=3) # 1 2 3 combined_example(1, standard=2, kwd_only=3) #1 2 3 ä¸‹é¢çš„å‡½æ•°å®šä¹‰ä¸­ï¼Œkwds æŠŠ name å½“ä½œé”®ï¼Œå› æ­¤ï¼Œå¯èƒ½ä¸ä½ç½®å‚æ•° name äº§ç”Ÿæ½œåœ¨å†²çªï¼š\ndef foo(name, **kwds): return \u0026#39;name\u0026#39; in kwds è°ƒç”¨è¯¥å‡½æ•°ä¸å¯èƒ½è¿”å› Trueï¼Œå› ä¸ºå…³é”®å­— 'name' æ€»ä¸ç¬¬ä¸€ä¸ªå½¢å‚ç»‘å®šã€‚ä¾‹å¦‚ï¼š\nfoo(1, **{\u0026#39;name\u0026#39;: 2}) #Traceback (most recent call last): # File \u0026#34;\u0026lt;stdin\u0026gt;\u0026#34;, line 1, in \u0026lt;module\u0026gt; #TypeError: foo() got multiple values for argument \u0026#39;name\u0026#39; åŠ ä¸Š / ï¼ˆä»…é™ä½ç½®å‚æ•°ï¼‰åï¼Œå°±å¯ä»¥äº†ã€‚æ­¤æ—¶ï¼Œå‡½æ•°å®šä¹‰æŠŠ name å½“ä½œä½ç½®å‚æ•°ï¼Œ'name' ä¹Ÿå¯ä»¥ä½œä¸ºå…³é”®å­—å‚æ•°çš„é”®ï¼š\ndef foo(name, /, **kwds): return \u0026#39;name\u0026#39; in kwds foo(1, **{\u0026#39;name\u0026#39;: 2}) # True æ¢å¥è¯è¯´ï¼Œä»…é™ä½ç½®å½¢å‚çš„åç§°å¯ä»¥åœ¨ **kwds ä¸­ä½¿ç”¨ï¼Œè€Œä¸äº§ç”Ÿæ­§ä¹‰ã€‚\nä»»æ„å®å‚åˆ—è¡¨ è°ƒç”¨å‡½æ•°æ—¶ï¼Œä½¿ç”¨ä»»æ„æ•°é‡çš„å®å‚æ˜¯æœ€å°‘è§çš„é€‰é¡¹ã€‚è¿™äº›å®å‚åŒ…å«åœ¨å…ƒç»„ä¸­ã€‚åœ¨å¯å˜æ•°é‡çš„å®å‚ä¹‹å‰ï¼Œå¯èƒ½æœ‰è‹¥å¹²ä¸ªæ™®é€šå‚æ•°ï¼š\ndef write_multiple_items(file, separator, *args): file.write(separator.join(args)) variadic å‚æ•°ç”¨äºé‡‡é›†ä¼ é€’ç»™å‡½æ•°çš„æ‰€æœ‰å‰©ä½™å‚æ•°ï¼Œå› æ­¤ï¼Œå®ƒä»¬é€šå¸¸åœ¨å½¢å‚åˆ—è¡¨çš„æœ«å°¾ã€‚*args å½¢å‚åçš„ä»»ä½•å½¢å¼å‚æ•°åªèƒ½æ˜¯ä»…é™å…³é”®å­—å‚æ•°ï¼Œå³åªèƒ½ç”¨ä½œå…³é”®å­—å‚æ•°ï¼Œä¸èƒ½ç”¨ä½œä½ç½®å‚æ•°ï¼š\ndef concat(*args, sep=\u0026#34;/\u0026#34;): return sep.join(args) concat(\u0026#34;earth\u0026#34;, \u0026#34;mars\u0026#34;, \u0026#34;venus\u0026#34;) concat(\u0026#34;earth\u0026#34;, \u0026#34;mars\u0026#34;, \u0026#34;venus\u0026#34;, sep=\u0026#34;.\u0026#34;) è§£åŒ…å®å‚åˆ—è¡¨ å‡½æ•°è°ƒç”¨è¦æ±‚ç‹¬ç«‹çš„ä½ç½®å‚æ•°ï¼Œä½†å®å‚åœ¨åˆ—è¡¨æˆ–å…ƒç»„é‡Œæ—¶ï¼Œè¦æ‰§è¡Œç›¸åçš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œå†…ç½®çš„ range() å‡½æ•°è¦æ±‚ç‹¬ç«‹çš„ start å’Œ stop å®å‚ã€‚å¦‚æœè¿™äº›å‚æ•°ä¸æ˜¯ç‹¬ç«‹çš„ï¼Œåˆ™è¦åœ¨è°ƒç”¨å‡½æ•°æ—¶ï¼Œç”¨ * æ“ä½œç¬¦æŠŠå®å‚ä»åˆ—è¡¨æˆ–å…ƒç»„è§£åŒ…å‡ºæ¥ï¼š\nlist(range(3, 6)) # normal call with separate arguments args = [3, 6] list(range(*args)) # call with arguments unpacked from a list åŒæ ·ï¼Œå­—å…¸å¯ä»¥ç”¨ ** æ“ä½œç¬¦ä¼ é€’å…³é”®å­—å‚æ•°ï¼š\ndef parrot(voltage, state=\u0026#39;a stiff\u0026#39;, action=\u0026#39;voom\u0026#39;): print(\u0026#34;-- This parrot wouldn\u0026#39;t\u0026#34;, action, end=\u0026#39; \u0026#39;) print(\u0026#34;if you put\u0026#34;, voltage, \u0026#34;volts through it.\u0026#34;, end=\u0026#39; \u0026#39;) print(\u0026#34;E\u0026#39;s\u0026#34;, state, \u0026#34;!\u0026#34;) d = {\u0026#34;voltage\u0026#34;: \u0026#34;four million\u0026#34;, \u0026#34;state\u0026#34;: \u0026#34;bleedin\u0026#39; demised\u0026#34;, \u0026#34;action\u0026#34;: \u0026#34;VOOM\u0026#34;} parrot(**d) Lambda å‡½æ•° Python ä¸­è¿˜æœ‰ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ç§°ä¸º lambda å‡½æ•°ï¼Œå®ƒæ˜¯ä¸€ç§åŒ¿åå‡½æ•°ï¼Œç”¨äºåˆ›å»ºç®€çŸ­çš„å‡½æ•°ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ª lambda å‡½æ•°ç¤ºä¾‹ï¼š\nadd_numbers = lambda x, y: x + y result = add_numbers(2, 3) print(result) åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ lambda å…³é”®å­—åˆ›å»ºäº†ä¸€ä¸ªåŒ¿åå‡½æ•° add_numbersï¼Œå®ƒæ¥å—ä¸¤ä¸ªå‚æ•° x å’Œ yï¼Œå¹¶è¿”å›å®ƒä»¬çš„å’Œã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ add_numbers(2, 3) è°ƒç”¨è¿™ä¸ªåŒ¿åå‡½æ•°ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨å˜é‡ result ä¸­ã€‚\nå‡½æ•°æ³¨è§£ Python å‡½æ•°æ³¨è§£æ˜¯ä¸€ç§åœ¨å‡½æ•°å®šä¹‰ä¸­æ·»åŠ å…ƒæ•°æ®çš„åŠŸèƒ½ã€‚è¿™äº›æ³¨è§£å¯ä»¥ç”¨äºæŒ‡å®šå‡½æ•°å‚æ•°å’Œè¿”å›å€¼çš„ç±»å‹ã€å‚æ•°çš„é»˜è®¤å€¼ã€å‡½æ•°çš„æ–‡æ¡£å­—ç¬¦ä¸²ç­‰ä¿¡æ¯ã€‚è™½ç„¶æ³¨è§£å¹¶ä¸ä¼šå½±å“ Python å‡½æ•°çš„è¡Œä¸ºï¼Œä½†å®ƒä»¬å¯ä»¥æä¾›æœ‰ç”¨çš„ä¿¡æ¯ï¼Œä½¿ä»£ç æ›´åŠ æ¸…æ™°æ˜“è¯»ã€‚\nPython å‡½æ•°æ³¨è§£ä½¿ç”¨çš„è¯­æ³•æ˜¯åœ¨å‡½æ•°å®šä¹‰çš„å‚æ•°åˆ—è¡¨åé¢æ·»åŠ å†’å·å’Œæ³¨è§£ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå‡½æ•°æ³¨è§£çš„ç¤ºä¾‹ï¼š\ndef add_numbers(x: int, y: int) -\u0026gt; int: return x + y åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ³¨è§£æŒ‡å®šäº†å‡½æ•° add_numbers() çš„ä¸¤ä¸ªå‚æ•° x å’Œ y çš„ç±»å‹ä¸º intï¼Œå¹¶æŒ‡å®šå‡½æ•°è¿”å›å€¼çš„ç±»å‹ä¹Ÿä¸º intã€‚åœ¨å‡½æ•°ä½“ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨åŠ æ³•è¿ç®—ç¬¦å°†è¿™ä¸¤ä¸ªå‚æ•°ç›¸åŠ ï¼Œå¹¶è¿”å›ç»“æœã€‚\nå‡½æ•°æ³¨è§£è¿˜å¯ä»¥åŒ…å«å‚æ•°çš„é»˜è®¤å€¼ã€å‚æ•°çš„å¯å˜æ€§å’Œå‡½æ•°çš„æ–‡æ¡£å­—ç¬¦ä¸²ç­‰ä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŒ…å«è¿™äº›ä¿¡æ¯çš„å‡½æ•°æ³¨è§£ç¤ºä¾‹ï¼š\ndef greet(name: str = \u0026#34;World\u0026#34;, *, times: int = 1) -\u0026gt; str: \u0026#34;\u0026#34;\u0026#34; Greet a person by name and optionally repeat the greeting multiple times. :param name: The name of the person to greet. Default is \u0026#34;World\u0026#34;. :param times: The number of times to repeat the greeting. Default is 1. :return: A string containing the greeting message. \u0026#34;\u0026#34;\u0026#34; message = \u0026#34;Hello, \u0026#34; + name + \u0026#34;!\\n\u0026#34; * times return message åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ³¨è§£æŒ‡å®šäº†å‡½æ•° greet() çš„å‚æ•° name å’Œ times çš„ç±»å‹ä¸º str å’Œ intï¼Œå¹¶æŒ‡å®šäº†å‚æ•° name çš„é»˜è®¤å€¼ä¸º \u0026quot;World\u0026quot;ï¼Œå‚æ•° times çš„é»˜è®¤å€¼ä¸º 1ã€‚æˆ‘ä»¬è¿˜ä½¿ç”¨äº†å‡½æ•°çš„æ–‡æ¡£å­—ç¬¦ä¸²æ¥æä¾›æ›´è¯¦ç»†çš„å‡½æ•°è¯´æ˜ã€‚\næ ‡æ³¨ ä»¥å­—å…¸çš„å½¢å¼å­˜æ”¾åœ¨å‡½æ•°çš„ __annotations__ å±æ€§ä¸­ï¼Œå¹¶ä¸”ä¸ä¼šå½±å“å‡½æ•°çš„ä»»ä½•å…¶ä»–éƒ¨åˆ†ã€‚ å½¢å‚æ ‡æ³¨çš„å®šä¹‰æ–¹å¼æ˜¯åœ¨å½¢å‚åååŠ å†’å·ï¼Œåé¢è·Ÿä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¯¥è¡¨è¾¾å¼ä¼šè¢«æ±‚å€¼ä¸ºæ ‡æ³¨çš„å€¼ã€‚ è¿”å›å€¼æ ‡æ³¨çš„å®šä¹‰æ–¹å¼æ˜¯åŠ ç»„åˆç¬¦å· -\u0026gt;ï¼Œåé¢è·Ÿä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¯¥æ ‡æ³¨ä½äºå½¢å‚åˆ—è¡¨å’Œè¡¨ç¤º def è¯­å¥ç»“æŸçš„å†’å·ä¹‹é—´ã€‚ ä¸‹é¢çš„ç¤ºä¾‹æœ‰ä¸€ä¸ªå¿…é¡»çš„å‚æ•°ï¼Œä¸€ä¸ªå¯é€‰çš„å…³é”®å­—å‚æ•°ä»¥åŠè¿”å›å€¼éƒ½å¸¦æœ‰ç›¸åº”çš„æ ‡æ³¨:\ndef f(ham: str, eggs: str = \u0026#39;eggs\u0026#39;) -\u0026gt; str: print(\u0026#34;Annotations:\u0026#34;, f.__annotations__) print(\u0026#34;Arguments:\u0026#34;, ham, eggs) return ham + \u0026#39; and \u0026#39; + eggs f(\u0026#39;spam\u0026#39;) ","permalink":"https://blog.chensoul.cc/posts/2023/06/25/python-function/","summary":"å‡½æ•°çš„å®šä¹‰ åœ¨ Python ä¸­ï¼Œå‡½æ•°æ˜¯ä¸€æ®µå¯é‡å¤ä½¿ç”¨çš„ä»£ç å—ï¼Œå®ƒæ¥å—ä¸€äº›è¾“å…¥ï¼ˆä¹Ÿç§°ä¸ºå‚æ•°ï¼‰å¹¶äº§ç”Ÿä¸€äº›è¾“å‡ºã€‚å‡½æ•°å¯ä»¥é€šè¿‡ def å…³é”®å­—æ¥å®šä¹‰ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š\ndef function_name(parameters): \u0026#34;\u0026#34;\u0026#34;This is a function\u0026#34;\u0026#34;\u0026#34; # function body return value å…¶ä¸­ï¼Œfunction_name æ˜¯å‡½æ•°çš„åç§°ï¼Œparameters æ˜¯å‡½æ•°çš„å‚æ•°åˆ—è¡¨ï¼Œfunction body æ˜¯å‡½æ•°çš„ä¸»ä½“éƒ¨åˆ†ï¼ŒåŒ…æ‹¬éœ€è¦æ‰§è¡Œçš„ä»£ç å’Œå¯èƒ½çš„è¿”å›è¯­å¥ï¼Œreturn value æ˜¯å‡½æ•°çš„è¿”å›å€¼ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚\nä¸‹åˆ—ä»£ç åˆ›å»ºä¸€ä¸ªå¯ä»¥è¾“å‡ºé™å®šæ•°å€¼å†…çš„æ–æ³¢é‚£å¥‘æ•°åˆ—å‡½æ•°ï¼š\ndef fib(n): # write Fibonacci series up to n \u0026#34;\u0026#34;\u0026#34;Print a Fibonacci series up to n.\u0026#34;\u0026#34;\u0026#34; a, b = 0, 1 while a \u0026lt; n: print(a, end=\u0026#39; \u0026#39;) a, b = b, a+b print() fib(2000) # 0 1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 159 å®šä¹‰ å‡½æ•°ä½¿ç”¨å…³é”®å­— defï¼Œåè·Ÿå‡½æ•°åä¸æ‹¬å·å†…çš„å½¢å‚åˆ—è¡¨ã€‚å‡½æ•°è¯­å¥ä»ä¸‹ä¸€è¡Œå¼€å§‹ï¼Œå¹¶ä¸”å¿…é¡»ç¼©è¿›ã€‚\nå‡½æ•°å†…çš„ç¬¬ä¸€æ¡è¯­å¥æ˜¯å­—ç¬¦ä¸²æ—¶ï¼Œè¯¥å­—ç¬¦ä¸²å°±æ˜¯æ–‡æ¡£å­—ç¬¦ä¸²ï¼Œä¹Ÿç§°ä¸º docstringã€‚åˆ©ç”¨æ–‡æ¡£å­—ç¬¦ä¸²å¯ä»¥è‡ªåŠ¨ç”Ÿæˆåœ¨çº¿æ–‡æ¡£æˆ–æ‰“å°ç‰ˆæ–‡æ¡£ï¼Œè¿˜å¯ä»¥è®©å¼€å‘è€…åœ¨æµè§ˆä»£ç æ—¶ç›´æ¥æŸ¥é˜…æ–‡æ¡£ï¼›Python å¼€å‘è€…æœ€å¥½å…»æˆåœ¨ä»£ç ä¸­åŠ å…¥æ–‡æ¡£å­—ç¬¦ä¸²çš„å¥½ä¹ æƒ¯ã€‚\nå‡½æ•°åœ¨ æ‰§è¡Œ æ—¶ä½¿ç”¨å‡½æ•°å±€éƒ¨å˜é‡ç¬¦å·è¡¨ï¼Œæ‰€æœ‰å‡½æ•°å˜é‡èµ‹å€¼éƒ½å­˜åœ¨å±€éƒ¨ç¬¦å·è¡¨ä¸­ï¼›å¼•ç”¨å˜é‡æ—¶ï¼Œé¦–å…ˆï¼Œåœ¨å±€éƒ¨ç¬¦å·è¡¨é‡ŒæŸ¥æ‰¾å˜é‡ï¼Œç„¶åï¼Œæ˜¯å¤–å±‚å‡½æ•°å±€éƒ¨ç¬¦å·è¡¨ï¼Œå†æ˜¯å…¨å±€ç¬¦å·è¡¨ï¼Œæœ€åæ˜¯å†…ç½®åç§°ç¬¦å·è¡¨ã€‚å› æ­¤ï¼Œå°½ç®¡å¯ä»¥å¼•ç”¨å…¨å±€å˜é‡å’Œå¤–å±‚å‡½æ•°çš„å˜é‡ï¼Œä½†æœ€å¥½ä¸è¦åœ¨å‡½æ•°å†…ç›´æ¥èµ‹å€¼ï¼ˆé™¤éæ˜¯ global è¯­å¥å®šä¹‰çš„å…¨å±€å˜é‡ï¼Œæˆ– nonlocal è¯­å¥å®šä¹‰çš„å¤–å±‚å‡½æ•°å˜é‡ï¼‰ã€‚\nåœ¨è°ƒç”¨å‡½æ•°æ—¶ä¼šå°†å®é™…å‚æ•°ï¼ˆå®å‚ï¼‰å¼•å…¥åˆ°è¢«è°ƒç”¨å‡½æ•°çš„å±€éƒ¨ç¬¦å·è¡¨ä¸­ï¼›å› æ­¤ï¼Œå®å‚æ˜¯ä½¿ç”¨ æŒ‰å€¼è°ƒç”¨ æ¥ä¼ é€’çš„ï¼ˆå…¶ä¸­çš„ å€¼ å§‹ç»ˆæ˜¯å¯¹è±¡çš„ å¼•ç”¨ è€Œä¸æ˜¯å¯¹è±¡çš„å€¼ï¼‰ã€‚ 1 å½“ä¸€ä¸ªå‡½æ•°è°ƒç”¨å¦å¤–ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œä¼šä¸ºè¯¥è°ƒç”¨åˆ›å»ºä¸€ä¸ªæ–°çš„å±€éƒ¨ç¬¦å·è¡¨ã€‚","title":"Pythonå­¦ä¹ 5ï¼šå‡½æ•°"},{"content":" æˆ‘å–œæ¬¢ bottleã€‚å®ƒæ˜¯ä¸€ä¸ªç®€å•ã€å¿«é€Ÿä¸”åŠŸèƒ½å¼ºå¤§çš„ Python å¾®æ¡†æ¶ï¼Œéå¸¸é€‚åˆå°å‹ Web åº”ç”¨ç¨‹åºå’Œå¿«é€ŸåŸå‹è®¾è®¡ã€‚å¯¹äºé‚£äº›åˆšåˆšå¼€å§‹ Web å¼€å‘çš„äººæ¥è¯´ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªå‡ºè‰²çš„å­¦ä¹ å·¥å…·ã€‚\nè®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚\næ³¨æ„ï¼šæœ¬æ•™ç¨‹å‡è®¾æ‚¨æ­£åœ¨è¿è¡ŒåŸºäº Unix çš„ç¯å¢ƒ - ä¾‹å¦‚ Mac OS Xã€Linux ç‰ˆæœ¬æˆ–é€šè¿‡è™šæ‹Ÿæœºæ”¯æŒçš„ Linux ç‰ˆæœ¬ã€‚\n06/13/2015 æ›´æ–°ï¼šæ›´æ–°äº†ä»£ç ç¤ºä¾‹å’Œè§£é‡Šã€‚\nå¯åŠ¨ é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå·¥ä½œç›®å½•ï¼š\n$ mkdir bottle \u0026amp;\u0026amp; cd bottle æ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦å®‰è£… pipã€virtualenv å’Œ gitã€‚\nvirtualenv æ˜¯ä¸€ä¸ª Python å·¥å…·ï¼Œå¯ä»¥è½»æ¾ç®¡ç†ç‰¹å®šé¡¹ç›®æ‰€éœ€çš„ Python åŒ…ï¼›å®ƒå¯ä»¥é˜²æ­¢ä¸€ä¸ªé¡¹ç›®ä¸­çš„åŒ…ä¸å…¶ä»–é¡¹ç›®ä¸­çš„åŒ…å‘ç”Ÿå†²çªã€‚åŒæ—¶ï¼Œpip æ˜¯ä¸€ä¸ªåŒ…ç®¡ç†å™¨ï¼Œç”¨äºç®¡ç† Python åŒ…çš„å®‰è£…ã€‚\nå¦‚éœ€åœ¨ Unix ç¯å¢ƒä¸­å®‰è£… pipï¼ˆåŠå…¶ä¾èµ–é¡¹ï¼‰çš„å¸®åŠ©ï¼Œè¯·æŒ‰ç…§ æ­¤ Gist ä¸­çš„è¯´æ˜è¿›è¡Œæ“ä½œã€‚å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Windows ç¯å¢ƒï¼Œè¯·è§‚çœ‹æ­¤è§†é¢‘ä»¥è·å–å¸®åŠ©ã€‚\nå®‰è£… pip åï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£… virtualenvï¼š\n$ pip install virtualenv==12.0.7 ç°åœ¨æˆ‘ä»¬å¯ä»¥è½»æ¾è®¾ç½®æœ¬åœ°ç¯å¢ƒï¼š\n$ virtualenv venv $ source venv/bin/activate å®‰è£… bottleï¼š\n$ pip install bottle==0.12.8 $ pip freeze \u0026gt; requirements.txt æœ€åï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ Git å°†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºç½®äºç‰ˆæœ¬æ§åˆ¶ä¹‹ä¸‹ã€‚æœ‰å…³ Git çš„æ›´å¤šä¿¡æ¯ï¼Œè¯· æŸ¥çœ‹æœ¬æ–‡ï¼Œå…¶ä¸­è¿˜åŒ…æ‹¬å®‰è£…è¯´æ˜ã€‚\nç¼–å†™ä½ çš„åº”ç”¨ç¨‹åº æˆ‘ä»¬å‡†å¤‡å¥½ç¼–å†™æˆ‘ä»¬çš„ç“¶å­åº”ç”¨ç¨‹åºäº†ã€‚æ‰“å¼€ Sublime Text 3 æˆ–æ‚¨é€‰æ‹©çš„æ–‡æœ¬ç¼–è¾‘å™¨ã€‚åˆ›å»ºæ‚¨çš„åº”ç”¨ç¨‹åºæ–‡ä»¶ app.pyï¼Œå®ƒå°†ä¿å­˜æˆ‘ä»¬ç¬¬ä¸€ä¸ªåº”ç”¨ç¨‹åºçš„å…¨éƒ¨å†…å®¹ï¼š\nimport os from bottle import route, run, template index_html = \u0026#39;\u0026#39;\u0026#39;My first web app! By \u0026lt;strong\u0026gt;{{ author }}\u0026lt;/strong\u0026gt;.\u0026#39;\u0026#39;\u0026#39; @route(\u0026#39;/\u0026#39;) def index(): return template(index_html, author=\u0026#39;Real Python\u0026#39;) @route(\u0026#39;/name/\u0026lt;name\u0026gt;\u0026#39;) def name(name): return template(index_html, author=name) if __name__ == \u0026#39;__main__\u0026#39;: port = int(os.environ.get(\u0026#39;PORT\u0026#39;, 8080)) run(host=\u0026#39;0.0.0.0\u0026#39;, port=port, debug=True) ä¿å­˜æ–‡ä»¶ã€‚\nç°åœ¨æ‚¨å¯ä»¥åœ¨æœ¬åœ°è¿è¡Œæ‚¨çš„åº”ç”¨ç¨‹åºï¼š\n$ python app.py æ‚¨åº”è¯¥èƒ½å¤Ÿè¿æ¥åˆ° http://localhost:8080/ å¹¶çœ‹åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºæ­£åœ¨è¿è¡Œï¼\nMy first web app! By RealPython. å› æ­¤ï¼Œ @route è£…é¥°å™¨å°†ä¸€ä¸ªå‡½æ•°ç»‘å®šåˆ°è·¯ç”±ã€‚åœ¨ç¬¬ä¸€ä¸ªè·¯ç”± / ä¸­ï¼Œ index() å‡½æ•°ç»‘å®šåˆ°è¯¥è·¯ç”±ï¼Œè¯¥è·¯ç”±æ¸²æŸ“ index_html æ¨¡æ¿å¹¶ä¼ å…¥å˜é‡ author ä½œä¸ºå…³é”®å­—å‚æ•°ã€‚ç„¶åå¯ä»¥åœ¨æ¨¡æ¿ä¸­è®¿é—®è¯¥å˜é‡ã€‚\nç°åœ¨å¯¼èˆªåˆ°ä¸‹ä¸€æ¡è·¯ç”±ï¼Œç¡®ä¿åœ¨è·¯ç”±æœ«å°¾æ·»åŠ æ‚¨çš„åå­— - å³ http://localhost:8080/name/Michaelã€‚æ‚¨åº”è¯¥çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹å†…å®¹ï¼š\nMy first web app! By Michael. è¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ\nåŒæ ·ï¼Œ @route è£…é¥°å™¨å°†ä¸€ä¸ªå‡½æ•°ç»‘å®šåˆ°è·¯ç”±ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨åŒ…å«é€šé…ç¬¦ \u0026lt;name\u0026gt; çš„åŠ¨æ€è·¯ç”±ã€‚\nç„¶åï¼Œè¯¥é€šé…ç¬¦ä½œä¸ºå‚æ•°ä¼ é€’ç»™è§†å›¾å‡½æ•° - def name(name) ã€‚\nç„¶åæˆ‘ä»¬å°†å…¶ä½œä¸ºå…³é”®å­—å‚æ•°ä¼ é€’ç»™æ¨¡æ¿ - author=name\nç„¶åæ¨¡æ¿æ¸²æŸ“ä½œè€…å˜é‡ - {{ author }} ã€‚\nShell è„šæœ¬ æƒ³å¿«é€Ÿå…¥é—¨å—ï¼Ÿä½¿ç”¨æ­¤ Shell è„šæœ¬åœ¨å‡ ç§’é’Ÿå†…ç”Ÿæˆå…¥é—¨åº”ç”¨ç¨‹åºã€‚\nmkdir bottle cd bottle pip install virtualenv==12.0.7 virtualenv venv source venv/bin/activate pip install bottle==0.12.8 pip freeze \u0026gt; requirements.txt git init git add . git commit -m \u0026#34;initial commit\u0026#34; cat \u0026gt;app.py \u0026lt;\u0026lt;EOF import os from bottle import route, run, template index_html = \u0026#39;\u0026#39;\u0026#39;My first web app! By \u0026lt;strong\u0026gt;{{ author }}\u0026lt;/strong\u0026gt;.\u0026#39;\u0026#39;\u0026#39; @route(\u0026#39;/\u0026#39;) def index(): return template(index_html, author=\u0026#39;Real Python\u0026#39;) @route(\u0026#39;/name/\u0026lt;name\u0026gt;\u0026#39;) def name(name): return template(index_html, author=name) if __name__ == \u0026#39;__main__\u0026#39;: port = int(os.environ.get(\u0026#39;PORT\u0026#39;, 8080)) run(host=\u0026#39;0.0.0.0\u0026#39;, port=port, debug=True) EOF chmod a+x app.py git init git add . git commit -m \u0026#34;Updated\u0026#34; ä»æ­¤è¦ç‚¹ä¸‹è½½æ­¤è„šæœ¬ï¼Œç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œå®ƒï¼š\n$ bash bottle.sh ä¸‹ä¸€æ­¥ ä»è¿™ä¸€ç‚¹æ¥çœ‹ï¼Œåˆ›å»ºæ–°é¡µé¢å°±åƒæ·»åŠ æ–°çš„ @route è£…é¥°å‡½æ•°ä¸€æ ·ç®€å•ã€‚\nåˆ›å»º HTML å¾ˆç®€å•ï¼šåœ¨ä¸Šé¢çš„åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬åªæ˜¯å°† HTML å†…è”åˆ°æ–‡ä»¶æœ¬èº«ä¸­ã€‚ä¿®æ”¹å®ƒä»¥ä»æ–‡ä»¶åŠ è½½æ¨¡æ¿å¾ˆå®¹æ˜“ã€‚ä¾‹å¦‚ï¼š\n@route(\u0026#39;/main\u0026#39;) def main(name): return template(\u0026#39;main_template\u0026#39;) è¿™å°†åŠ è½½æ¨¡æ¿æ–‡ä»¶ main_template.tpl ï¼Œè¯¥æ–‡ä»¶å¿…é¡»æ”¾ç½®åœ¨é¡¹ç›®ç»“æ„ä¸­çš„ views æ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶å°†å…¶å‘ˆç°ç»™æœ€ç»ˆç”¨æˆ·ã€‚\næœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… bottle æ–‡æ¡£ã€‚\nåŸºæœ¬è®¾ç½® é¦–å…ˆä»ç¬¬ 1 éƒ¨åˆ†ä¸‹è½½æ­¤ Gistï¼Œç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œå®ƒï¼š\n$ bash bottle.sh è¿™å°†åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„é¡¹ç›®ç»“æ„ï¼š\nâ”œâ”€â”€ app.py â”œâ”€â”€ requirements.txt â””â”€â”€ testenv æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼š\n$ cd bottle $ source testenv/bin/activate å®‰è£…è¦æ±‚ï¼š\n$ pip install -r requirements.txt å¯¼èˆªåˆ° https://www.plot.ly/apiï¼Œæ³¨å†Œä¸€ä¸ªæ–°å¸æˆ·ï¼Œç™»å½•ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„ API å¯†é’¥ï¼š\nå¤åˆ¶è¯¥å¯†é’¥ã€‚\nå®‰è£… plot.lyï¼š\n$ pip install plotly==1.2.6 æ¥ä¸‹æ¥æ›´æ–° app.py ä¸­çš„ä»£ç ï¼š\nimport os from bottle import run, template, get, post, request import plotly.plotly as py from plotly.graph_objs import * # add your username and api key py.sign_in(\u0026#34;realpython\u0026#34;, \u0026#34;lijlflx93\u0026#34;) @get(\u0026#39;/plot\u0026#39;) def form(): return \u0026#39;\u0026#39;\u0026#39;\u0026lt;h2\u0026gt;Graph via Plot.ly\u0026lt;/h2\u0026gt; \u0026lt;form method=\u0026#34;POST\u0026#34; action=\u0026#34;/plot\u0026#34;\u0026gt; Name: \u0026lt;input name=\u0026#34;name1\u0026#34; type=\u0026#34;text\u0026#34; /\u0026gt; Age: \u0026lt;input name=\u0026#34;age1\u0026#34; type=\u0026#34;text\u0026#34; /\u0026gt;\u0026lt;br/\u0026gt; Name: \u0026lt;input name=\u0026#34;name2\u0026#34; type=\u0026#34;text\u0026#34; /\u0026gt; Age: \u0026lt;input name=\u0026#34;age2\u0026#34; type=\u0026#34;text\u0026#34; /\u0026gt;\u0026lt;br/\u0026gt; Name: \u0026lt;input name=\u0026#34;name3\u0026#34; type=\u0026#34;text\u0026#34; /\u0026gt; Age: \u0026lt;input name=\u0026#34;age3\u0026#34; type=\u0026#34;text\u0026#34; /\u0026gt;\u0026lt;br/\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; /\u0026gt; \u0026lt;/form\u0026gt;\u0026#39;\u0026#39;\u0026#39; @post(\u0026#39;/plot\u0026#39;) def submit(): # grab data from form name1 = request.forms.get(\u0026#39;name1\u0026#39;) age1 = request.forms.get(\u0026#39;age1\u0026#39;) name2 = request.forms.get(\u0026#39;name2\u0026#39;) age2 = request.forms.get(\u0026#39;age2\u0026#39;) name3 = request.forms.get(\u0026#39;name3\u0026#39;) age3 = request.forms.get(\u0026#39;age3\u0026#39;) data = Data([ Bar( x=[name1, name2, name3], y=[age1, age2, age3] ) ]) # make api call response = py.plot(data, filename=\u0026#39;basic-bar\u0026#39;) if response: return template(\u0026#39;\u0026#39;\u0026#39; \u0026lt;h1\u0026gt;Congrats!\u0026lt;/h1\u0026gt; \u0026lt;div\u0026gt; View your graph here: \u0026lt;a href=\u0026#34;{{response}}\u0026#34;\u0026lt;/a\u0026gt;{{response}} \u0026lt;/div\u0026gt; \u0026#39;\u0026#39;\u0026#39;, response=response ) if __name__ == \u0026#39;__main__\u0026#39;: port = int(os.environ.get(\u0026#39;PORT\u0026#39;, 8080)) run(host=\u0026#39;0.0.0.0\u0026#39;, port=port, debug=True) è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ\nç¬¬ä¸€ä¸ªå‡½æ•° form() åˆ›å»ºä¸€ä¸ª HTML è¡¨å•ï¼Œç”¨äºæ•è·åˆ¶ä½œç®€å•æ¡å½¢å›¾æ‰€éœ€çš„æ•°æ®ã€‚ ä¸æ­¤åŒæ—¶ï¼Œç¬¬äºŒä¸ªå‡½æ•° submit() æŠ“å–è¡¨å•è¾“å…¥ï¼Œå°†å®ƒä»¬åˆ†é…ç»™å˜é‡ï¼Œç„¶åè°ƒç”¨ plot.ly APIï¼Œä¼ é€’æˆ‘ä»¬çš„å‡­æ®å’Œæ•°æ®ï¼Œä»¥ç”Ÿæˆæ–°å›¾è¡¨ã€‚ç¡®ä¿å°†æˆ‘çš„ç”¨æˆ·åå’Œ API å¯†é’¥æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„å‡­æ®ã€‚ä¸è¦ä½¿ç”¨æˆ‘çš„ã€‚ä¸èµ·ä½œç”¨ã€‚ æµ‹è¯• åœ¨æœ¬åœ°è¿è¡Œæ‚¨çš„åº”ç”¨ç¨‹åºï¼Œ python app.py ï¼Œå¹¶å°†æµè§ˆå™¨æŒ‡å‘ http://localhost:8080/plotã€‚\nè¾“å…¥ä¸‰ä¸ªäººçš„å§“ååŠå…¶å„è‡ªçš„å¹´é¾„ã€‚æŒ‰â€œæäº¤â€ï¼Œå¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä¸€æ¡ç¥è´ºæ¶ˆæ¯å’Œä¸€ä¸ª URLã€‚å•å‡» URL æŸ¥çœ‹æ‚¨çš„å›¾è¡¨ï¼š\nå¦‚æœæ‚¨æ”¶åˆ°æ­¤æ¶ˆæ¯çš„ 500 é”™è¯¯ - Aw, snap! Looks like you supplied the wrong API key. Want to try again? You can always view your key at https://plot.ly/api/key. When you display your key at https://plot.ly/api/key, make sure that you're logged in as realpython. - æ‚¨éœ€è¦æ›´æ–°æ‚¨çš„ API å¯†é’¥ã€‚\nå¦å¤–ï¼Œå¦‚æœè¿™æ˜¯ä¸€ä¸ªçœŸæ­£çš„ã€é¢å‘å®¢æˆ·ç«¯çš„åº”ç”¨ç¨‹åºï¼Œæ‚¨ä¼šå¸Œæœ›æ¯”è¿™æ›´ä¼˜é›…åœ°å¤„ç†é”™è¯¯ã€‚ä»…ä¾›å‚è€ƒã€‚\nç¾¤ç»„åˆ†æ æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸ªæ›´å¤æ‚çš„ç¤ºä¾‹ï¼Œä¸ºä»¥ä¸‹é˜Ÿåˆ—åˆ†æç»Ÿè®¡æ•°æ®åˆ›å»ºå›¾è¡¨ï¼š\nCohort 2011 2012 2013 2014 0 310 348 228 250 1 55 157 73 34 2 18 37 33 34 3 2 4 4 3 æˆ‘ä»¬å°†åŸºäºåŒä¸€ä¸ªåº”ç”¨ç¨‹åº - app.py è¿›è¡Œæ„å»ºï¼Œä½†åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼šæ‰“å¼€ app.pyï¼Œç„¶åâ€œå¦å­˜ä¸ºâ€cohort.pyã€‚\né¦–å…ˆå‡çº§åˆ°ç®€å•æ¨¡æ¿å¼•æ“ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å°†æ ·å¼å’Œ Javascript æ–‡ä»¶æ·»åŠ åˆ°æˆ‘ä»¬çš„æ¨¡æ¿ä¸­ã€‚æ·»åŠ ä¸€ä¸ªåä¸ºâ€œviewsâ€çš„æ–°æ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨è¯¥ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸º template.tpl çš„æ–°æ–‡ä»¶ã€‚å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°è¯¥æ–‡ä»¶ä¸­ï¼š\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;{{ title }}\u0026lt;/title\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34;\u0026gt; \u0026lt;link href=\u0026#34;http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css\u0026#34; rel=\u0026#34;stylesheet\u0026#34; media=\u0026#34;screen\u0026#34;\u0026gt; \u0026lt;style\u0026gt; body { padding: 60px 0px; } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;Graph via Plot.ly\u0026lt;/h1\u0026gt; \u0026lt;form role=\u0026#34;form\u0026#34; method=\u0026#34;post\u0026#34; action=\u0026#34;/plot\u0026#34;\u0026gt; \u0026lt;table\u0026gt; \u0026lt;td\u0026gt; \u0026lt;h3\u0026gt;2011\u0026lt;/h3\u0026gt; \u0026lt;div class=\u0026#34;form-group\u0026#34; \u0026#34;col-md-2\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;number\u0026#34; name=\u0026#34;Y01\u0026#34; class=\u0026#34;form-control\u0026#34; placeholder=\u0026#34;Cohort 0\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;number\u0026#34; name=\u0026#34;Y02\u0026#34; class=\u0026#34;form-control\u0026#34; placeholder=\u0026#34;Cohort 1\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;number\u0026#34; name=\u0026#34;Y03\u0026#34; class=\u0026#34;form-control\u0026#34; placeholder=\u0026#34;Cohort 2\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;number\u0026#34; name=\u0026#34;Y04\u0026#34; class=\u0026#34;form-control\u0026#34; placeholder=\u0026#34;Cohort 3\u0026#34;\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/td\u0026gt; \u0026lt;td\u0026gt; \u0026lt;h3\u0026gt;2012\u0026lt;/h3\u0026gt; \u0026lt;div class=\u0026#34;form-group\u0026#34; \u0026#34;col-md-2\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;number\u0026#34; name=\u0026#34;Y11\u0026#34; class=\u0026#34;form-control\u0026#34; placeholder=\u0026#34;Cohort 0\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;number\u0026#34; name=\u0026#34;Y12\u0026#34; class=\u0026#34;form-control\u0026#34; placeholder=\u0026#34;Cohort 1\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;number\u0026#34; name=\u0026#34;Y13\u0026#34; class=\u0026#34;form-control\u0026#34; placeholder=\u0026#34;Cohort 2\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;number\u0026#34; name=\u0026#34;Y44\u0026#34; class=\u0026#34;form-control\u0026#34; placeholder=\u0026#34;Cohort 3\u0026#34;\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/td\u0026gt; \u0026lt;td\u0026gt; \u0026lt;h3\u0026gt;2013\u0026lt;/h3\u0026gt; \u0026lt;div class=\u0026#34;form-group\u0026#34; \u0026#34;col-md-2\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;number\u0026#34; name=\u0026#34;Y21\u0026#34; class=\u0026#34;form-control\u0026#34; placeholder=\u0026#34;Cohort 0\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;number\u0026#34; name=\u0026#34;Y22\u0026#34; class=\u0026#34;form-control\u0026#34; placeholder=\u0026#34;Cohort 1\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;number\u0026#34; name=\u0026#34;Y23\u0026#34; class=\u0026#34;form-control\u0026#34; placeholder=\u0026#34;Cohort 2\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;number\u0026#34; name=\u0026#34;Y24\u0026#34; class=\u0026#34;form-control\u0026#34; placeholder=\u0026#34;Cohort 3\u0026#34;\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/td\u0026gt; \u0026lt;td\u0026gt; \u0026lt;h3\u0026gt;2014\u0026lt;/h3\u0026gt; \u0026lt;div class=\u0026#34;form-group\u0026#34; \u0026#34;col-md-2\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;number\u0026#34; name=\u0026#34;Y31\u0026#34; class=\u0026#34;form-control\u0026#34; placeholder=\u0026#34;Cohort 0\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;number\u0026#34; name=\u0026#34;Y32\u0026#34; class=\u0026#34;form-control\u0026#34; placeholder=\u0026#34;Cohort 1\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;number\u0026#34; name=\u0026#34;Y33\u0026#34; class=\u0026#34;form-control\u0026#34; placeholder=\u0026#34;Cohort 2\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;number\u0026#34; name=\u0026#34;Y34\u0026#34; class=\u0026#34;form-control\u0026#34; placeholder=\u0026#34;Cohort 3\u0026#34;\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;/table\u0026gt; \u0026lt;button type=\u0026#34;submit\u0026#34; class=\u0026#34;btn btn-default\u0026#34;\u0026gt;Submit\u0026lt;/button\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script src=\u0026#34;http://code.jquery.com/jquery-1.10.2.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; æ‚¨å¯èƒ½çŸ¥é“ï¼Œè¿™çœ‹èµ·æ¥å°±åƒä¸€ä¸ª HTML æ–‡ä»¶ã€‚ä¸åŒä¹‹å¤„åœ¨äºæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯­æ³• - {{ python_variable }} å°† Python å˜é‡ä¼ é€’åˆ°æ–‡ä»¶ã€‚\nåˆ›å»º data.json æ–‡ä»¶å¹¶æ·»åŠ æ‚¨çš„ Plot.ly ç”¨æˆ·åå’Œ API å¯†é’¥ã€‚æ‚¨å¯ä»¥åœ¨ æ­¤å¤„ æŸ¥çœ‹ç¤ºä¾‹æ–‡ä»¶ã€‚\nå°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ° cohort.py ä¸­ï¼Œä»¥ä¾¿åœ¨æˆ‘ä»¬è¿›è¡Œ API è°ƒç”¨æ—¶è®¿é—® data.json ä»¥ä½¿ç”¨å‡­æ®ï¼š\nimport os from bottle import run, template, get, post, request import plotly.plotly as py from plotly.graph_objs import * import json # grab username and key from config/data file with open(\u0026#39;data.json\u0026#39;) as config_file: config_data = json.load(config_file) username = config_data[\u0026#34;user\u0026#34;] key = config_data[\u0026#34;key\u0026#34;] py.sign_in(username, key) ç°åœ¨æˆ‘ä»¬ä¸å¿…å°†æˆ‘ä»¬çš„å¯†é’¥æš´éœ²ç»™æ•´ä¸ªå®‡å®™ã€‚åªè¦ç¡®ä¿ä½¿å…¶ä¸å—ç‰ˆæœ¬æ§åˆ¶å³å¯ã€‚\næ¥ä¸‹æ¥æ›´æ–°åŠŸèƒ½ï¼š\nimport os from bottle import run, template, get, post, request import plotly.plotly as py from plotly.graph_objs import * import json # grab username and key from config/data file with open(\u0026#39;data.json\u0026#39;) as config_file: config_data = json.load(config_file) username = config_data[\u0026#34;user\u0026#34;] key = config_data[\u0026#34;key\u0026#34;] py.sign_in(username, key) @get(\u0026#39;/plot\u0026#39;) def form(): return template(\u0026#39;template\u0026#39;, title=\u0026#39;Plot.ly Graph\u0026#39;) @post(\u0026#39;/plot\u0026#39;) def submit(): # grab data from form Y01 = request.forms.get(\u0026#39;Y01\u0026#39;) Y02 = request.forms.get(\u0026#39;Y02\u0026#39;) Y03 = request.forms.get(\u0026#39;Y03\u0026#39;) Y04 = request.forms.get(\u0026#39;Y04\u0026#39;) Y11 = request.forms.get(\u0026#39;Y11\u0026#39;) Y12 = request.forms.get(\u0026#39;Y12\u0026#39;) Y13 = request.forms.get(\u0026#39;Y13\u0026#39;) Y14 = request.forms.get(\u0026#39;Y14\u0026#39;) Y21 = request.forms.get(\u0026#39;Y21\u0026#39;) Y22 = request.forms.get(\u0026#39;Y22\u0026#39;) Y23 = request.forms.get(\u0026#39;Y23\u0026#39;) Y24 = request.forms.get(\u0026#39;Y24\u0026#39;) Y31 = request.forms.get(\u0026#39;Y31\u0026#39;) Y32 = request.forms.get(\u0026#39;Y32\u0026#39;) Y33 = request.forms.get(\u0026#39;Y33\u0026#39;) Y34 = request.forms.get(\u0026#39;Y34\u0026#39;) trace1 = Scatter( x=[1, 2, 3, 4], y=[Y01, Y02, Y03, Y04] ) trace2 = Scatter( x=[1, 2, 3, 4], y=[Y11, Y12, Y13, Y14] ) trace3 = Scatter( x=[1, 2, 3, 4], y=[Y21, Y22, Y23, Y24] ) trace4 = Scatter( x=[1, 2, 3, 4], y=[Y31, Y32, Y33, Y34] ) data = Data([trace1, trace2, trace3, trace4]) # api call plot_url = py.plot(data, filename=\u0026#39;basic-line\u0026#39;) return template(\u0026#39;template2\u0026#39;, title=\u0026#39;Plot.ly Graph\u0026#39;, plot_url=str(plot_url)) if __name__ == \u0026#39;__main__\u0026#39;: port = int(os.environ.get(\u0026#39;PORT\u0026#39;, 8080)) run(host=\u0026#39;0.0.0.0\u0026#39;, port=port, debug=True) è¯·æ³¨æ„ return å£°æ˜ã€‚æˆ‘ä»¬ä¼ å…¥æ¨¡æ¿çš„åç§°ä»¥åŠä»»ä½•å˜é‡ã€‚è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º template2.tpl çš„æ–°æ¨¡æ¿ï¼š\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;{{ title }}\u0026lt;/title\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34; /\u0026gt; \u0026lt;link href=\u0026#34;http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css\u0026#34; rel=\u0026#34;stylesheet\u0026#34; media=\u0026#34;screen\u0026#34; /\u0026gt; \u0026lt;style\u0026gt; body { padding: 60px 0px; } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;Graph via Plot.ly\u0026lt;/h1\u0026gt; \u0026lt;br /\u0026gt; \u0026lt;a href=\u0026#34;/plot\u0026#34;\u0026gt;\u0026lt;button class=\u0026#34;btn btn-default\u0026#34;\u0026gt;Back\u0026lt;/button\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;br /\u0026gt;\u0026lt;br /\u0026gt; \u0026lt;iframe id=\u0026#34;igraph\u0026#34; src=\u0026#34;{{plot_url}}\u0026#34; width=\u0026#34;900\u0026#34; height=\u0026#34;450\u0026#34; seamless=\u0026#34;seamless\u0026#34; scrolling=\u0026#34;no\u0026#34; \u0026gt;\u0026lt;/iframe\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script src=\u0026#34;http://code.jquery.com/jquery-1.10.2.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; å› æ­¤ï¼Œiframe å…è®¸æˆ‘ä»¬æ›´æ–°è¡¨å•ï¼Œç„¶åæ˜¾ç¤ºå®é™…å†…å®¹/å›¾è¡¨ä»¥åŠæ›´æ–°åçš„æ›´æ”¹ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬ä¸å¿…ç¦»å¼€ç«™ç‚¹å³å¯æŸ¥çœ‹å›¾è¡¨ã€‚\nè¿è¡Œã€‚å°†å€¼æ·»åŠ åˆ°è¡¨å•ä¸­ã€‚ç„¶åæäº¤ã€‚æ‚¨çš„å›¾è¡¨ç°åœ¨åº”å¦‚ä¸‹æ‰€ç¤ºï¼š\nç»“è®º æ‚¨å¯ä»¥ä»æ­¤å­˜å‚¨åº“ä¸­è·å–æ‰€æœ‰æ–‡ä»¶ã€‚\nä¸‹æ¬¡è§ï¼\nåŸæ–‡é“¾æ¥ï¼š\nhttps://realpython.com/developing-with-bottle-part-1/ https://realpython.com/developing-with-bottle-part-2-plot-ly-api ","permalink":"https://blog.chensoul.cc/posts/2023/06/25/developing-with-bottle/","summary":"æˆ‘å–œæ¬¢ bottleã€‚å®ƒæ˜¯ä¸€ä¸ªç®€å•ã€å¿«é€Ÿä¸”åŠŸèƒ½å¼ºå¤§çš„ Python å¾®æ¡†æ¶ï¼Œéå¸¸é€‚åˆå°å‹ Web åº”ç”¨ç¨‹åºå’Œå¿«é€ŸåŸå‹è®¾è®¡ã€‚å¯¹äºé‚£äº›åˆšåˆšå¼€å§‹ Web å¼€å‘çš„äººæ¥è¯´ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªå‡ºè‰²çš„å­¦ä¹ å·¥å…·ã€‚\nè®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚\næ³¨æ„ï¼šæœ¬æ•™ç¨‹å‡è®¾æ‚¨æ­£åœ¨è¿è¡ŒåŸºäº Unix çš„ç¯å¢ƒ - ä¾‹å¦‚ Mac OS Xã€Linux ç‰ˆæœ¬æˆ–é€šè¿‡è™šæ‹Ÿæœºæ”¯æŒçš„ Linux ç‰ˆæœ¬ã€‚\n06/13/2015 æ›´æ–°ï¼šæ›´æ–°äº†ä»£ç ç¤ºä¾‹å’Œè§£é‡Šã€‚\nå¯åŠ¨ é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå·¥ä½œç›®å½•ï¼š\n$ mkdir bottle \u0026amp;\u0026amp; cd bottle æ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦å®‰è£… pipã€virtualenv å’Œ gitã€‚\nvirtualenv æ˜¯ä¸€ä¸ª Python å·¥å…·ï¼Œå¯ä»¥è½»æ¾ç®¡ç†ç‰¹å®šé¡¹ç›®æ‰€éœ€çš„ Python åŒ…ï¼›å®ƒå¯ä»¥é˜²æ­¢ä¸€ä¸ªé¡¹ç›®ä¸­çš„åŒ…ä¸å…¶ä»–é¡¹ç›®ä¸­çš„åŒ…å‘ç”Ÿå†²çªã€‚åŒæ—¶ï¼Œpip æ˜¯ä¸€ä¸ªåŒ…ç®¡ç†å™¨ï¼Œç”¨äºç®¡ç† Python åŒ…çš„å®‰è£…ã€‚\nå¦‚éœ€åœ¨ Unix ç¯å¢ƒä¸­å®‰è£… pipï¼ˆåŠå…¶ä¾èµ–é¡¹ï¼‰çš„å¸®åŠ©ï¼Œè¯·æŒ‰ç…§ æ­¤ Gist ä¸­çš„è¯´æ˜è¿›è¡Œæ“ä½œã€‚å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Windows ç¯å¢ƒï¼Œè¯·è§‚çœ‹æ­¤è§†é¢‘ä»¥è·å–å¸®åŠ©ã€‚\nå®‰è£… pip åï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£… virtualenvï¼š\n$ pip install virtualenv==12.0.7 ç°åœ¨æˆ‘ä»¬å¯ä»¥è½»æ¾è®¾ç½®æœ¬åœ°ç¯å¢ƒï¼š\n$ virtualenv venv $ source venv/bin/activate å®‰è£… bottleï¼š\n$ pip install bottle==0.12.8 $ pip freeze \u0026gt; requirements.txt æœ€åï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ Git å°†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºç½®äºç‰ˆæœ¬æ§åˆ¶ä¹‹ä¸‹ã€‚æœ‰å…³ Git çš„æ›´å¤šä¿¡æ¯ï¼Œè¯· æŸ¥çœ‹æœ¬æ–‡ï¼Œå…¶ä¸­è¿˜åŒ…æ‹¬å®‰è£…è¯´æ˜ã€‚\nç¼–å†™ä½ çš„åº”ç”¨ç¨‹åº æˆ‘ä»¬å‡†å¤‡å¥½ç¼–å†™æˆ‘ä»¬çš„ç“¶å­åº”ç”¨ç¨‹åºäº†ã€‚æ‰“å¼€ Sublime Text 3 æˆ–æ‚¨é€‰æ‹©çš„æ–‡æœ¬ç¼–è¾‘å™¨ã€‚åˆ›å»ºæ‚¨çš„åº”ç”¨ç¨‹åºæ–‡ä»¶ app.pyï¼Œå®ƒå°†ä¿å­˜æˆ‘ä»¬ç¬¬ä¸€ä¸ªåº”ç”¨ç¨‹åºçš„å…¨éƒ¨å†…å®¹ï¼š\nimport os from bottle import route, run, template index_html = \u0026#39;\u0026#39;\u0026#39;My first web app!","title":"[è¯‘]ç”¨ Bottle å¼€å‘"},{"content":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-06-12 åˆ° 2023-06-18 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¯»ä¹¦ã€å¥èº«ã€æŠ•èµ„ã€å¸®æœ‹å‹ã€é™ªå®¶äººã€‚\nè¯»ä¹¦ æœ¬å‘¨å°šæœªè¯»ä¹¦ã€‚\nå¥èº« æˆ‘è·‘è¿‡äº†ä¸€äº›åœ°æ–¹ï¼Œå¸Œæœ›éšç€æ—¶é—´æ¨ç§»ï¼Œåœ°å›¾ç‚¹äº®çš„åœ°æ–¹è¶Šæ¥è¶Šå¤šã€‚2 å¹´é‡Œæˆ‘è·‘è¿‡ 2 ä¸ªçœä»½ 2 ä¸ªåŸå¸‚ã€‚æ›´å¤šè·‘æ­¥æ•°æ®åœ¨æˆ‘çš„ è·‘æ­¥ ä¸»é¡µã€‚\næœ¬å‘¨å°šæœªè·‘æ­¥ã€‚\nç†è´¢ è¿™å‘¨æ€»è®¡æ”¯å‡º 1264 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š\n6 æœˆ 18 æ—¥ï¼š338 å…ƒ\n6 æœˆ 17 æ—¥ï¼š508 å…ƒ\n6 æœˆ 16 æ—¥ï¼š262 å…ƒ\n6 æœˆ 15 æ—¥ï¼š27 å…ƒ\n6 æœˆ 14 æ—¥ï¼š41 å…ƒ\n6 æœˆ 13 æ—¥ï¼š40 å…ƒ\n6 æœˆ 12 æ—¥ï¼š48 å…ƒ\né™ªå®¶äºº æœ¬å‘¨å› ä¸ºè€çˆ¸å‡ºé™¢åéœ€è¦äººç…§æ–™ï¼Œæ‰€ä»¥æˆ‘æ¯å¤©æ—©æ™šå¾€è¿”äºå®¶ï¼ˆé˜³é€»ï¼‰å’Œå…¬å¸ï¼ˆå…‰è°·ï¼‰ä¹‹é—´ã€‚æ¯å¤©æ—©ä¸Šäº”ç‚¹å¤šå°±é†’äº†ï¼Œç„¶åç…®ç²¥ã€æ‹›å‘¼è€çˆ¸åƒé¥­å–è¯ï¼Œå…­ç‚¹åŠå‡ºé—¨å¼€è½¦èµ°ä¸‰ç¯å»ä¸Šç­ã€‚è¿™å‘¨è¯·å©¶å¨˜ç™½å¤©å¸®å¿™ç…§é¡¾è€çˆ¸ï¼Œä¸»è¦æ˜¯ä¸­åˆå’Œæ™šä¸Šè€çˆ¸è¦åƒé¥­å’Œå–è¯ã€‚æˆ‘æ—©ä¸Šå‡ºé—¨æ™šã€æ™šä¸Šä¸‹ç­å›æ¥å†ç…§é¡¾è€çˆ¸ã€‚è€çˆ¸èƒƒæºƒç–¡ï¼Œéœ€è¦ä¿®å…»ä¸€ä¸ªå¤šæœˆï¼Œå¦å¤–æœ€è¿‘ç—›é£å‘ä½œï¼Œèº«ä½“å¤šå¤„å…³èŠ‚ç–¼ç—›ã€‚å› ä¸ºåƒè¥¿è¯å’Œæ‰“é’ˆéƒ½ä¼šä¼¤èƒƒï¼Œæ‰€ä»¥åªèƒ½åƒä¸­è¯ã€‚ä¸­è¯è§æ•ˆæ…¢ï¼Œéœ€è¦æ—¶é—´ã€‚è€Œå©¶å¨˜èº«ä¸Šä¹Ÿæœ‰ç—…ï¼Œä¸èƒ½é•¿æœŸç…§é¡¾ï¼Œå¦‚æœè€çˆ¸è¿™å‘¨ç—›é£ä¸èƒ½æ¢å¤ï¼Œé‚£ä¸‹å‘¨åªèƒ½è€å©†æ”¾ä¸‹æ‰‹ä¸Šå·¥ä½œå›æ¥ç…§é¡¾è€çˆ¸ã€‚è€å©†å·¥ä½œä¹Ÿæ˜¯éå¸¸å¿™ç¢Œï¼Œä¹Ÿä¸èƒ½ç…§é¡¾å¤ªä¹…ï¼Œä¼°è®¡ä¹Ÿå°±ä¸€ä¸ªæ˜ŸæœŸã€‚å¦‚æœè¿‡äº†ä¸€ä¸ªæ˜ŸæœŸï¼Œè€çˆ¸è¿˜æ˜¯ä¸èƒ½æ¢å¤ã€ä¸èƒ½ç”Ÿæ´»è‡ªç†ï¼ŒçœŸä¸çŸ¥é“è¯¥æ€ä¹ˆåŠäº†ï¼å¾ˆä¹…ä¹‹å‰å°±æƒ³åˆ°è€çˆ¸å¯èƒ½ä¼šæˆä¸ºæˆ‘çš„è´Ÿæ‹…ï¼Œå½±å“æˆ‘çš„å·¥ä½œï¼Œæ²¡æœ‰æƒ³åˆ°ä¼šæ¥çš„è¿™ä¹ˆå¿«ã€‚æœ‰æ—¶å€™æƒ³æŠ±æ€¨ï¼Œä½†æŠ±æ€¨æœ‰ä»€ä¹ˆç”¨ï¼Ÿé¢å¯¹çœ¼å‰çš„è¿™ä¸€åˆ‡ï¼Œåªèƒ½è¿éš¾é¢å¯¹ã€‚é€ æˆçœ¼å‰è¿™æ ·çš„ç°çŠ¶ï¼Œæˆ‘è‡ªå·±æœ‰ä¸€éƒ¨åˆ†è´£ä»»ã€‚éƒ½åªæ€ªæˆ‘å¹³æ—¶æ²¡æœ‰å…³å¿ƒè€çˆ¸ï¼Œæ²¡æœ‰å®å˜±è€çˆ¸ä¸è¦å–é…’ï¼Œåœ¨è€çˆ¸èº«è¾¹é™ªä¼´çš„æ—¶é—´å¤ªå°‘äº†ã€‚\nå‘¨å…­å»ç»™å²³çˆ¶å²³æ¯é€ç«¯åˆèŠ‚ï¼Œå‘¨æ—¥å›å»çœ‹æœ›ç™Œç—‡è½¬ç§»åˆ°å…¨èº«çš„å…­èˆ…ã€‚å…­èˆ…æ˜¯ä¹³è…ºç™Œï¼Œåœ¨ç»å†äº†å»å¹´æ–°å† ç–«æƒ…ä¹‹åï¼Œç™Œç»†èƒè½¬ç§»åˆ°è‚ºéƒ¨ã€‚å¹´åæ²¡æœ‰å¼•èµ·è¶³å¤Ÿçš„é‡è§†ï¼Œç›´åˆ°ç—›çš„ä¸è¡Œçš„æ—¶å€™æ‰å»åŒ»é™¢åšæ‰‹æœ¯ï¼Œé”™è¿‡äº†æœ€ä½³æ²»ç–—æ—¶æœºã€‚ä¸Šä¸€æ¬¡è§åˆ°å…­èˆ…è¿˜æ˜¯å››æœˆä»½çš„æ—¶å€™ï¼Œæˆ‘å¼€è½¦å¸¦è€å©†ä¸€èµ·å›å»çœ‹æœ›è€çˆ¸ã€‚é‚£æ—¶å€™å…­èˆ…è¿˜åœ¨èœå›­é‡Œé¢æœé»„åœŸèƒŒæœå¤©ï¼Œå…­èˆ…ç»™äº†æˆ‘ä¸€äº›è´ç¬‹ã€åŒ…èœï¼Œè€å©†ç»™å…­èˆ… 3 ç™¾å—é’±ï¼Œå…­èˆ…ç¡¬æ˜¯ä¸è¦ï¼Œæ‹‰æ‰¯äº†åŠå¤©ã€‚èµ°ä¹‹å‰ï¼Œå…­èˆ…è¿˜å«ä½•èˆ…å¡äº† 20 å¤šä¸ªé¸¡è›‹ç»™æˆ‘ä»¬ã€‚è¿™æ¬¡ï¼Œå†è§å…­èˆ…ï¼Œå…­èˆ…èººåœ¨åºŠä¸Šå…¨èº«ç–¼ç—›ï¼Œåªèƒ½åƒäº›æµé£Ÿï¼Œæ„è¯†æ¨¡ç³Šï¼ŒçŸ¥é“è°æ¥çœ‹æœ›å¥¹ï¼Œå´ä¸èƒ½è¯´è¯ã€‚æ¯æ¬¡å¼€è½¦ä¸Šä¸‹ç­çš„æ—¶å€™ï¼Œæƒ³èµ·å…­èˆ…è¿™æ ·å­ï¼Œå¿ƒé‡Œå°±å¾ˆéš¾å—ï¼Œçœ¼æ³ªç›´æ‰“è½¬ã€‚é¢å¯¹ç”Ÿè€ç—…æ­»ï¼Œæˆå¹´äººçš„å´©æºƒåªåœ¨ä¸€ç¬é—´ã€‚æ˜¨æ—¥è¿˜åœ¨ä½ é¢å‰æ··è¹¦ä¹±è·³çš„äººï¼Œæ˜å¤©å¯èƒ½å°±ä¸åœ¨äº†ã€‚ä¸ºäº†ä¸ç•™é—æ†¾ï¼Œè¦å–„å¾…èº«è¾¹çš„æ¯ä¸€ä½äº²äººï¼Œå¸¸å›å®¶çœ‹çœ‹ã€‚æ„Ÿè°¢è€å©†æ€»æ˜¯æé†’æˆ‘è¦å›å®¶çœ‹æœ›è€çˆ¸ï¼Œæ­£æ˜¯å› ä¸ºè¿™ä¸ªï¼Œæ¯æ¬¡å›å®¶çœ‹æœ›è€çˆ¸çš„æ—¶å€™ï¼Œæˆ‘éƒ½ä¼šå»çœ‹ä¸‹å…­èˆ…ã€‚\nå¦‚æœæ²¡æœ‰ç–¼ç—›ï¼Œè€çˆ¸å’Œå…­èˆ…å°±ä¸ä¼šç—›è‹¦äº†ï¼Œèº«è¾¹çš„äººä¹Ÿå°±ä¸ä¼šå¿ƒç—›ã€‚\nå·¥ä½œ æœ€è¿‘åœ¨å­¦ä¹ çš„å†…å®¹æ¸…å•ï¼š\nEffective Javaï¼ˆç¬¬ 3 ç‰ˆï¼‰ Java Design Patterns (ä¸­æ–‡) Real Python æœ¬å‘¨å®Œæˆå››ç¯‡åšå®¢ï¼š\n[è¯‘]ä¸ºæé¾™è§£é‡Šç°ä»£ CSS\n[è¯‘]ä¸ºæé¾™è§£é‡Šç°ä»£ HTML\n[è¯‘]ä¸ºæé¾™è§£é‡Šç°ä»£ JavaScript\nã€ŠEffective Java 3ã€‹ç¬”è®° 15ï¼šå°½é‡å‡å°‘ç±»å’Œæˆå‘˜çš„å¯è®¿é—®æ€§\næœ¬å‘¨åˆ†äº« å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€ChenSoul Shareã€Telegram é¢‘é“æˆ–è€…æˆ‘çš„ Memos ä¸­ã€‚æˆ‘å†™äº†ä¸€ä¸ª Python è„šæœ¬ä» Memos è¯»å–æœ€è¿‘ä¸€å‘¨å¸¦æœ‰ #memos æ ‡ç­¾çš„è®°å½•ï¼Œåˆ†äº«åˆ°è¿™é‡Œã€‚\nğŸ“Œ2023-06-14 ç°ä»£ JavaScript æ•™ç¨‹ï¼Œä»¥æœ€æ–°çš„ JavaScript æ ‡å‡†ä¸ºåŸºå‡†ã€‚é€šè¿‡ç®€å•ä½†è¶³å¤Ÿè¯¦ç»†çš„å†…å®¹ï¼Œä¸ºä½ è®²è§£ä»åŸºç¡€åˆ°é«˜é˜¶çš„ JavaScript ç›¸å…³çŸ¥è¯†ã€‚ https://zh.javascript.info/ #memos #javascript ğŸ“Œ2023-06-14 æ¨èå‡ ä¸ªè¿œç¨‹åŠå…¬æ‹›è˜ç½‘ç«™ï¼Œå›½å¤–çš„ https://nomadlist.com/ https://remotive.com/ https://remoteok.com/ https://www.huntsbot.com/ https://www.freelancer.cn/jobs #memos ğŸ“Œ2023-06-14 æ‹’ç» 996ï¼Œè°ˆè°ˆè¿œç¨‹åŠå…¬ä¸€å¹´å¤šçš„æ„Ÿå— https://www.v2ex.com/t/947355 #memos ğŸ“Œ2023-06-14 æ–°æ‰‹å…¥é—¨ Python è¯¥å¦‚ä½•å­¦ï¼Œå­¦ä»€ä¹ˆï¼Œå­¦å¤šä¹…ï¼Ÿçœ‹å®Œè¿™äº›ä½ å°±æ˜ç™½äº†#memos #python https://blog.csdn.net/libaiup/article/details/131083707 ä»¥ä¸Šã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/06/21/weekly_review_24/","summary":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-06-12 åˆ° 2023-06-18 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¯»ä¹¦ã€å¥èº«ã€æŠ•èµ„ã€å¸®æœ‹å‹ã€é™ªå®¶äººã€‚\nè¯»ä¹¦ æœ¬å‘¨å°šæœªè¯»ä¹¦ã€‚\nå¥èº« æˆ‘è·‘è¿‡äº†ä¸€äº›åœ°æ–¹ï¼Œå¸Œæœ›éšç€æ—¶é—´æ¨ç§»ï¼Œåœ°å›¾ç‚¹äº®çš„åœ°æ–¹è¶Šæ¥è¶Šå¤šã€‚2 å¹´é‡Œæˆ‘è·‘è¿‡ 2 ä¸ªçœä»½ 2 ä¸ªåŸå¸‚ã€‚æ›´å¤šè·‘æ­¥æ•°æ®åœ¨æˆ‘çš„ è·‘æ­¥ ä¸»é¡µã€‚\næœ¬å‘¨å°šæœªè·‘æ­¥ã€‚\nç†è´¢ è¿™å‘¨æ€»è®¡æ”¯å‡º 1264 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š\n6 æœˆ 18 æ—¥ï¼š338 å…ƒ\n6 æœˆ 17 æ—¥ï¼š508 å…ƒ\n6 æœˆ 16 æ—¥ï¼š262 å…ƒ\n6 æœˆ 15 æ—¥ï¼š27 å…ƒ\n6 æœˆ 14 æ—¥ï¼š41 å…ƒ\n6 æœˆ 13 æ—¥ï¼š40 å…ƒ\n6 æœˆ 12 æ—¥ï¼š48 å…ƒ\né™ªå®¶äºº æœ¬å‘¨å› ä¸ºè€çˆ¸å‡ºé™¢åéœ€è¦äººç…§æ–™ï¼Œæ‰€ä»¥æˆ‘æ¯å¤©æ—©æ™šå¾€è¿”äºå®¶ï¼ˆé˜³é€»ï¼‰å’Œå…¬å¸ï¼ˆå…‰è°·ï¼‰ä¹‹é—´ã€‚æ¯å¤©æ—©ä¸Šäº”ç‚¹å¤šå°±é†’äº†ï¼Œç„¶åç…®ç²¥ã€æ‹›å‘¼è€çˆ¸åƒé¥­å–è¯ï¼Œå…­ç‚¹åŠå‡ºé—¨å¼€è½¦èµ°ä¸‰ç¯å»ä¸Šç­ã€‚è¿™å‘¨è¯·å©¶å¨˜ç™½å¤©å¸®å¿™ç…§é¡¾è€çˆ¸ï¼Œä¸»è¦æ˜¯ä¸­åˆå’Œæ™šä¸Šè€çˆ¸è¦åƒé¥­å’Œå–è¯ã€‚æˆ‘æ—©ä¸Šå‡ºé—¨æ™šã€æ™šä¸Šä¸‹ç­å›æ¥å†ç…§é¡¾è€çˆ¸ã€‚è€çˆ¸èƒƒæºƒç–¡ï¼Œéœ€è¦ä¿®å…»ä¸€ä¸ªå¤šæœˆï¼Œå¦å¤–æœ€è¿‘ç—›é£å‘ä½œï¼Œèº«ä½“å¤šå¤„å…³èŠ‚ç–¼ç—›ã€‚å› ä¸ºåƒè¥¿è¯å’Œæ‰“é’ˆéƒ½ä¼šä¼¤èƒƒï¼Œæ‰€ä»¥åªèƒ½åƒä¸­è¯ã€‚ä¸­è¯è§æ•ˆæ…¢ï¼Œéœ€è¦æ—¶é—´ã€‚è€Œå©¶å¨˜èº«ä¸Šä¹Ÿæœ‰ç—…ï¼Œä¸èƒ½é•¿æœŸç…§é¡¾ï¼Œå¦‚æœè€çˆ¸è¿™å‘¨ç—›é£ä¸èƒ½æ¢å¤ï¼Œé‚£ä¸‹å‘¨åªèƒ½è€å©†æ”¾ä¸‹æ‰‹ä¸Šå·¥ä½œå›æ¥ç…§é¡¾è€çˆ¸ã€‚è€å©†å·¥ä½œä¹Ÿæ˜¯éå¸¸å¿™ç¢Œï¼Œä¹Ÿä¸èƒ½ç…§é¡¾å¤ªä¹…ï¼Œä¼°è®¡ä¹Ÿå°±ä¸€ä¸ªæ˜ŸæœŸã€‚å¦‚æœè¿‡äº†ä¸€ä¸ªæ˜ŸæœŸï¼Œè€çˆ¸è¿˜æ˜¯ä¸èƒ½æ¢å¤ã€ä¸èƒ½ç”Ÿæ´»è‡ªç†ï¼ŒçœŸä¸çŸ¥é“è¯¥æ€ä¹ˆåŠäº†ï¼å¾ˆä¹…ä¹‹å‰å°±æƒ³åˆ°è€çˆ¸å¯èƒ½ä¼šæˆä¸ºæˆ‘çš„è´Ÿæ‹…ï¼Œå½±å“æˆ‘çš„å·¥ä½œï¼Œæ²¡æœ‰æƒ³åˆ°ä¼šæ¥çš„è¿™ä¹ˆå¿«ã€‚æœ‰æ—¶å€™æƒ³æŠ±æ€¨ï¼Œä½†æŠ±æ€¨æœ‰ä»€ä¹ˆç”¨ï¼Ÿé¢å¯¹çœ¼å‰çš„è¿™ä¸€åˆ‡ï¼Œåªèƒ½è¿éš¾é¢å¯¹ã€‚é€ æˆçœ¼å‰è¿™æ ·çš„ç°çŠ¶ï¼Œæˆ‘è‡ªå·±æœ‰ä¸€éƒ¨åˆ†è´£ä»»ã€‚éƒ½åªæ€ªæˆ‘å¹³æ—¶æ²¡æœ‰å…³å¿ƒè€çˆ¸ï¼Œæ²¡æœ‰å®å˜±è€çˆ¸ä¸è¦å–é…’ï¼Œåœ¨è€çˆ¸èº«è¾¹é™ªä¼´çš„æ—¶é—´å¤ªå°‘äº†ã€‚\nå‘¨å…­å»ç»™å²³çˆ¶å²³æ¯é€ç«¯åˆèŠ‚ï¼Œå‘¨æ—¥å›å»çœ‹æœ›ç™Œç—‡è½¬ç§»åˆ°å…¨èº«çš„å…­èˆ…ã€‚å…­èˆ…æ˜¯ä¹³è…ºç™Œï¼Œåœ¨ç»å†äº†å»å¹´æ–°å† ç–«æƒ…ä¹‹åï¼Œç™Œç»†èƒè½¬ç§»åˆ°è‚ºéƒ¨ã€‚å¹´åæ²¡æœ‰å¼•èµ·è¶³å¤Ÿçš„é‡è§†ï¼Œç›´åˆ°ç—›çš„ä¸è¡Œçš„æ—¶å€™æ‰å»åŒ»é™¢åšæ‰‹æœ¯ï¼Œé”™è¿‡äº†æœ€ä½³æ²»ç–—æ—¶æœºã€‚ä¸Šä¸€æ¬¡è§åˆ°å…­èˆ…è¿˜æ˜¯å››æœˆä»½çš„æ—¶å€™ï¼Œæˆ‘å¼€è½¦å¸¦è€å©†ä¸€èµ·å›å»çœ‹æœ›è€çˆ¸ã€‚é‚£æ—¶å€™å…­èˆ…è¿˜åœ¨èœå›­é‡Œé¢æœé»„åœŸèƒŒæœå¤©ï¼Œå…­èˆ…ç»™äº†æˆ‘ä¸€äº›è´ç¬‹ã€åŒ…èœï¼Œè€å©†ç»™å…­èˆ… 3 ç™¾å—é’±ï¼Œå…­èˆ…ç¡¬æ˜¯ä¸è¦ï¼Œæ‹‰æ‰¯äº†åŠå¤©ã€‚èµ°ä¹‹å‰ï¼Œå…­èˆ…è¿˜å«ä½•èˆ…å¡äº† 20 å¤šä¸ªé¸¡è›‹ç»™æˆ‘ä»¬ã€‚è¿™æ¬¡ï¼Œå†è§å…­èˆ…ï¼Œå…­èˆ…èººåœ¨åºŠä¸Šå…¨èº«ç–¼ç—›ï¼Œåªèƒ½åƒäº›æµé£Ÿï¼Œæ„è¯†æ¨¡ç³Šï¼ŒçŸ¥é“è°æ¥çœ‹æœ›å¥¹ï¼Œå´ä¸èƒ½è¯´è¯ã€‚æ¯æ¬¡å¼€è½¦ä¸Šä¸‹ç­çš„æ—¶å€™ï¼Œæƒ³èµ·å…­èˆ…è¿™æ ·å­ï¼Œå¿ƒé‡Œå°±å¾ˆéš¾å—ï¼Œçœ¼æ³ªç›´æ‰“è½¬ã€‚é¢å¯¹ç”Ÿè€ç—…æ­»ï¼Œæˆå¹´äººçš„å´©æºƒåªåœ¨ä¸€ç¬é—´ã€‚æ˜¨æ—¥è¿˜åœ¨ä½ é¢å‰æ··è¹¦ä¹±è·³çš„äººï¼Œæ˜å¤©å¯èƒ½å°±ä¸åœ¨äº†ã€‚ä¸ºäº†ä¸ç•™é—æ†¾ï¼Œè¦å–„å¾…èº«è¾¹çš„æ¯ä¸€ä½äº²äººï¼Œå¸¸å›å®¶çœ‹çœ‹ã€‚æ„Ÿè°¢è€å©†æ€»æ˜¯æé†’æˆ‘è¦å›å®¶çœ‹æœ›è€çˆ¸ï¼Œæ­£æ˜¯å› ä¸ºè¿™ä¸ªï¼Œæ¯æ¬¡å›å®¶çœ‹æœ›è€çˆ¸çš„æ—¶å€™ï¼Œæˆ‘éƒ½ä¼šå»çœ‹ä¸‹å…­èˆ…ã€‚\nå¦‚æœæ²¡æœ‰ç–¼ç—›ï¼Œè€çˆ¸å’Œå…­èˆ…å°±ä¸ä¼šç—›è‹¦äº†ï¼Œèº«è¾¹çš„äººä¹Ÿå°±ä¸ä¼šå¿ƒç—›ã€‚\nå·¥ä½œ æœ€è¿‘åœ¨å­¦ä¹ çš„å†…å®¹æ¸…å•ï¼š\nEffective Javaï¼ˆç¬¬ 3 ç‰ˆï¼‰ Java Design Patterns (ä¸­æ–‡) Real Python æœ¬å‘¨å®Œæˆå››ç¯‡åšå®¢ï¼š\n[è¯‘]ä¸ºæé¾™è§£é‡Šç°ä»£ CSS\n[è¯‘]ä¸ºæé¾™è§£é‡Šç°ä»£ HTML\n[è¯‘]ä¸ºæé¾™è§£é‡Šç°ä»£ JavaScript\nã€ŠEffective Java 3ã€‹ç¬”è®° 15ï¼šå°½é‡å‡å°‘ç±»å’Œæˆå‘˜çš„å¯è®¿é—®æ€§\næœ¬å‘¨åˆ†äº« å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€ChenSoul Shareã€Telegram é¢‘é“æˆ–è€…æˆ‘çš„ Memos ä¸­ã€‚æˆ‘å†™äº†ä¸€ä¸ª Python è„šæœ¬ä» Memos è¯»å–æœ€è¿‘ä¸€å‘¨å¸¦æœ‰ #memos æ ‡ç­¾çš„è®°å½•ï¼Œåˆ†äº«åˆ°è¿™é‡Œã€‚","title":"å‘¨æŠ¥-24ï½œå¦‚æœæ²¡æœ‰ç–¼ç—›"},{"content":" å¥‡æ€ªçš„æ˜¯ï¼ŒCSS è¢«è®¤ä¸ºæ˜¯ä½œä¸º Web å¼€å‘äººå‘˜æœ€å®¹æ˜“å­¦ä¹ å’Œæœ€éš¾å­¦ä¹ çš„è¯­è¨€ä¹‹ä¸€ã€‚å¼€å§‹ä½¿ç”¨å®ƒå½“ç„¶å¾ˆå®¹æ˜“ - æ‚¨å¯ä»¥å®šä¹‰æ ·å¼å±æ€§å’Œå€¼ä»¥åº”ç”¨äºç‰¹å®šå…ƒç´ ï¼Œç„¶å\u0026hellip;\u0026hellip;è¿™å‡ ä¹å°±æ˜¯æ‚¨å¼€å§‹æ‰€éœ€çš„ä¸€åˆ‡ï¼ä½†æ˜¯ï¼Œå¯¹äºå¤§å‹é¡¹ç›®ï¼Œä»¥æœ‰æ„ä¹‰çš„æ–¹å¼ç»„ç»‡ CSS ä¼šå˜å¾—çº ç»“å’Œå¤æ‚ã€‚æ›´æ”¹ä»»ä½•ä¸€è¡Œ CSS ä»¥è®¾ç½®ä¸€ä¸ªé¡µé¢ä¸Šå…ƒç´ çš„æ ·å¼é€šå¸¸ä¼šå¯¼è‡´å…¶ä»–é¡µé¢ä¸Šçš„å…ƒç´ å‘ç”Ÿæ„å¤–æ›´æ”¹ã€‚\nä¸ºäº†å¤„ç† CSS å›ºæœ‰çš„å¤æ‚æ€§ï¼Œå·²ç»å»ºç«‹äº†å„ç§ä¸åŒçš„æœ€ä½³å®è·µã€‚é—®é¢˜åœ¨äºï¼Œå¯¹äºå“ªäº›æœ€ä½³å®è·µå®é™…ä¸Šæ˜¯æœ€å¥½çš„ï¼Œæ²¡æœ‰ä»»ä½•å¼ºçƒˆçš„å…±è¯†ï¼Œå…¶ä¸­è®¸å¤šä¼¼ä¹å®Œå…¨ç›¸äº’çŸ›ç›¾ã€‚å¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡å°è¯•å­¦ä¹  CSSï¼Œè‡³å°‘å¯ä»¥è¯´è¿™å¯èƒ½ä¼šè®©äººè¿·å¤±æ–¹å‘ã€‚\næœ¬æ–‡çš„ç›®çš„æ˜¯æä¾›ä¸€ä¸ªå†å²èƒŒæ™¯ï¼Œè¯´æ˜ CSS æ–¹æ³•å’Œå·¥å…·å¦‚ä½•åœ¨ 2018 å¹´å‘å±•åˆ°ä»Šå¤©çš„æ ·å­ã€‚é€šè¿‡äº†è§£è¿™æ®µå†å²ï¼Œå°†æ›´å®¹æ˜“ç†è§£æ¯ç§æ–¹æ³•ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒä»¬æ¥ä¸ºæ‚¨å¸¦æ¥å¥½å¤„ã€‚è®©æˆ‘ä»¬å¼€å§‹å§ï¼\næ›´æ–°ï¼šæˆ‘åˆ¶ä½œäº†æœ¬æ–‡çš„æ–°è§†é¢‘è¯¾ç¨‹ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬æ›´æ·±å…¥åœ°ä»‹ç»äº†ææ–™ï¼Œè¯·åœ¨æ­¤å¤„æŸ¥çœ‹ï¼š https://firstclass.actualize.co/p/modern-css-explained-for-dinosaurs\nä½¿ç”¨ CSS è¿›è¡ŒåŸºæœ¬æ ·å¼è®¾ç½® è®©æˆ‘ä»¬ä»ä¸€ä¸ªåŸºæœ¬ç½‘ç«™å¼€å§‹ï¼Œä»…ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ index.html æ–‡ä»¶é“¾æ¥åˆ°ä¸€ä¸ªå•ç‹¬çš„ index.css æ–‡ä»¶ï¼š\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Modern CSS\u0026lt;/title\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;index.css\u0026#34; /\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;header\u0026gt;This is the header.\u0026lt;/header\u0026gt; \u0026lt;main\u0026gt; \u0026lt;h1\u0026gt;This is the main content.\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;...\u0026lt;/p\u0026gt; \u0026lt;/main\u0026gt; \u0026lt;nav\u0026gt; \u0026lt;h4\u0026gt;This is the navigation section.\u0026lt;/h4\u0026gt; \u0026lt;p\u0026gt;...\u0026lt;/p\u0026gt; \u0026lt;/nav\u0026gt; \u0026lt;aside\u0026gt; \u0026lt;h4\u0026gt;This is an aside section.\u0026lt;/h4\u0026gt; \u0026lt;p\u0026gt;...\u0026lt;/p\u0026gt; \u0026lt;/aside\u0026gt; \u0026lt;footer\u0026gt;This is the footer.\u0026lt;/footer\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ç°åœ¨æˆ‘ä»¬åœ¨ HTML ä¸­æ²¡æœ‰ä½¿ç”¨ä»»ä½•ç±»æˆ– IDï¼Œåªæ˜¯ è¯­ä¹‰æ ‡ç­¾ã€‚æ²¡æœ‰ä»»ä½• CSSï¼Œç½‘ç«™çœ‹èµ·æ¥åƒè¿™æ ·ï¼ˆä½¿ç”¨å ä½ç¬¦æ–‡æœ¬ï¼‰ï¼š\nåŠŸèƒ½é½å…¨ï¼Œä½†ä¸æ˜¯å¾ˆæ¼‚äº®ã€‚æˆ‘ä»¬å¯ä»¥æ·»åŠ  CSS æ¥æ”¹è¿› index.css ä¸­çš„åŸºæœ¬æ’ç‰ˆï¼š\n/* BASIC TYPOGRAPHY */ /* from https://github.com/oxalorg/sakura */ html { font-size: 62.5%; font-family: serif; } body { font-size: 1.8rem; line-height: 1.618; max-width: 38em; margin: auto; color: #4a4a4a; background-color: #f9f9f9; padding: 13px; } @media (max-width: 684px) { body { font-size: 1.53rem; } } @media (max-width: 382px) { body { font-size: 1.35rem; } } h1, h2, h3, h4, h5, h6 { line-height: 1.1; font-family: Verdana, Geneva, sans-serif; font-weight: 700; overflow-wrap: break-word; word-wrap: break-word; -ms-word-break: break-all; word-break: break-word; -ms-hyphens: auto; -moz-hyphens: auto; -webkit-hyphens: auto; hyphens: auto; } h1 { font-size: 2.35em; } h2 { font-size: 2em; } h3 { font-size: 1.75em; } h4 { font-size: 1.5em; } h5 { font-size: 1.25em; } h6 { font-size: 1em; } åœ¨è¿™é‡Œï¼Œå¤§å¤šæ•° CSS éƒ½æ˜¯æ ·å¼æ’ç‰ˆï¼ˆå…·æœ‰å¤§å°ï¼Œè¡Œé«˜ç­‰çš„å­—ä½“ï¼‰ï¼Œå¹¶å¸¦æœ‰ä¸€äº›é¢œè‰²æ ·å¼å’Œå±…ä¸­å¸ƒå±€ã€‚ä½ å¿…é¡»ç ”ç©¶è®¾è®¡æ‰èƒ½çŸ¥é“è¦ä¸ºæ¯ä¸ªå±æ€§é€‰æ‹©çš„å¥½å€¼ï¼ˆè¿™äº›æ ·å¼æ¥è‡ª sakura.cssï¼‰ï¼Œä½†è¿™é‡Œåº”ç”¨çš„ CSS æœ¬èº«å¹¶ä¸å¤ªå¤æ‚ã€‚ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š\nå¦‚æ­¤ä¸åŒï¼è¿™å°±æ˜¯ CSS çš„æ‰¿è¯º - ä¸€ç§å‘æ–‡æ¡£æ·»åŠ æ ·å¼çš„ç®€å•æ–¹æ³•ï¼Œæ— éœ€ç¼–ç¨‹æˆ–å¤æ‚çš„é€»è¾‘ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ CSS ä¸ä»…ä»…æ˜¯æ’ç‰ˆå’Œé¢œè‰²æ—¶ï¼Œäº‹æƒ…å¼€å§‹å˜å¾—æ›´åŠ æ¯›èŒ¸èŒ¸ï¼ˆæˆ‘ä»¬å°†åœ¨ä¸‹é¢è§£å†³ï¼‰ã€‚\nä½¿ç”¨ CSS è¿›è¡Œå¸ƒå±€ åœ¨ 1990 å¹´ä»£ï¼Œåœ¨ CSS è¢«å¹¿æ³›é‡‡ç”¨ä¹‹å‰ï¼Œåœ¨é¡µé¢ä¸Šå¸ƒå±€å†…å®¹çš„é€‰é¡¹å¹¶ä¸å¤šã€‚HTML æœ€åˆè¢«è®¾è®¡ä¸ºä¸€ç§åˆ›å»ºæ™®é€šæ–‡æ¡£çš„è¯­è¨€ï¼Œè€Œä¸æ˜¯å¸¦æœ‰ä¾§è¾¹æ ï¼Œåˆ—ç­‰çš„åŠ¨æ€ç½‘ç«™ã€‚åœ¨æ—©æœŸï¼Œå¸ƒå±€é€šå¸¸ä½¿ç”¨ HTML è¡¨æ ¼å®Œæˆâ€”â€”æ•´ä¸ªç½‘é¡µå°†ä½äºä¸€ä¸ªè¡¨æ ¼ä¸­ï¼Œå¯ç”¨äºåœ¨è¡Œå’Œåˆ—ä¸­ç»„ç»‡å†…å®¹ã€‚è¿™ç§æ–¹æ³•å¥æ•ˆäº†ï¼Œä½†ç¼ºç‚¹æ˜¯å†…å®¹å’Œå‘ˆç°çš„ç´§å¯†è€¦åˆâ€”â€”å¦‚æœä½ æƒ³æ”¹å˜ç½‘ç«™çš„å¸ƒå±€ï¼Œå°±éœ€è¦é‡å†™å¤§é‡çš„ HTMLã€‚\nä¸€æ—¦ CSS è¿›å…¥åœºæ™¯ï¼Œå°±å¼ºçƒˆæ¨åŠ¨å°†å†…å®¹ï¼ˆç”¨ HTML ç¼–å†™ï¼‰ä¸æ¼”ç¤ºï¼ˆç”¨ CSS ç¼–å†™ï¼‰åˆ†å¼€ã€‚å› æ­¤ï¼Œäººä»¬æ‰¾åˆ°äº†å°†æ‰€æœ‰å¸ƒå±€ä»£ç ä» HTMLï¼ˆä¸å†æœ‰è¡¨æ ¼ï¼‰ç§»åŠ¨åˆ° CSS ä¸­çš„æ–¹æ³•ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ HTML ä¸€æ ·ï¼ŒCSS ä¹Ÿä¸æ˜¯çœŸæ­£è®¾è®¡ä¸ºåœ¨é¡µé¢ä¸Šå¸ƒå±€å†…å®¹ï¼Œå› æ­¤æ—©æœŸå°è¯•è¿™ç§å…³æ³¨ç‚¹åˆ†ç¦»å¾ˆéš¾ä¼˜é›…åœ°å®ç°ã€‚\nè®©æˆ‘ä»¬é€šè¿‡ä¸Šé¢çš„ä¾‹å­æ¥çœ‹çœ‹è¿™åœ¨å®è·µä¸­æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚åœ¨æˆ‘ä»¬å®šä¹‰ä»»ä½• CSS å¸ƒå±€ä¹‹å‰ï¼Œæˆ‘ä»¬å°†é¦–å…ˆé‡ç½®ä»»ä½•è¾¹è·å’Œå¡«å……ï¼ˆè¿™ä¼šå½±å“å¸ƒå±€è®¡ç®—ï¼‰ï¼Œå¹¶ä¸ºéƒ¨åˆ†æä¾›ä¸åŒçš„é¢œè‰²ï¼ˆä¸æ˜¯ä¸ºäº†è®©å®ƒæ¼‚äº®ï¼Œè€Œæ˜¯ä¸ºäº†è®©æ¯ä¸ªéƒ¨åˆ†åœ¨æµ‹è¯•ä¸åŒçš„å¸ƒå±€æ—¶åœ¨è§†è§‰ä¸Šè„±é¢–è€Œå‡ºï¼‰ã€‚\n/* RESET LAYOUT AND ADD COLORS */ body { margin: 0; padding: 0; max-width: inherit; background: #fff; color: #4a4a4a; } header, footer { font-size: large; text-align: center; padding: 0.3em 0; background-color: #4a4a4a; color: #f9f9f9; } nav { background: #eee; } main { background: #f9f9f9; } aside { background: #eee; } ç°åœ¨ç½‘ç«™æš‚æ—¶çœ‹èµ·æ¥åƒï¼š\nå•å‡»æ­¤å¤„æŸ¥çœ‹å®æ—¶ç¤ºä¾‹ ç°åœ¨ï¼Œæˆ‘ä»¬å·²å‡†å¤‡å¥½ä½¿ç”¨ CSS åœ¨é¡µé¢ä¸Šå¸ƒå±€å†…å®¹ã€‚æˆ‘ä»¬å°†æŒ‰æ—¶é—´é¡ºåºä»‹ç»ä¸‰ç§ä¸åŒçš„æ–¹æ³•ï¼Œä»ç»å…¸çš„åŸºäº float çš„å¸ƒå±€å¼€å§‹ã€‚\nåŸºäº float çš„å¸ƒå±€ CSS float å±æ€§æœ€åˆæ˜¯ä¸ºäº†åœ¨å·¦ä¾§æˆ–å³ä¾§çš„æ–‡æœ¬åˆ—å†…æµ®åŠ¨å›¾åƒï¼ˆæ‚¨ç»å¸¸åœ¨æŠ¥çº¸ä¸Šçœ‹åˆ°çš„ï¼‰ã€‚2000 å¹´ä»£åˆæœŸçš„ Web å¼€å‘äººå‘˜åˆ©ç”¨äº†è¿™æ ·ä¸€ä¸ªäº‹å®ï¼Œå³æ‚¨ä¸ä»…å¯ä»¥æµ®åŠ¨å›¾åƒï¼Œè¿˜å¯ä»¥æµ®åŠ¨ä»»ä½•å…ƒç´ ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥é€šè¿‡æµ®åŠ¨æ•´ä¸ªå†…å®¹ div æ¥åˆ›å»ºè¡Œå’Œåˆ—çš„é”™è§‰ã€‚ä½†åŒæ ·ï¼Œæµ®åŠ¨ä¸æ˜¯ä¸ºæ­¤ç›®çš„è€Œè®¾è®¡çš„ï¼Œå› æ­¤å¾ˆéš¾ä»¥ä¸€è‡´çš„æ–¹å¼åˆ›é€ è¿™ç§é”™è§‰ã€‚\n2006 å¹´ï¼ŒA List Apart å‘è¡¨äº†ä¸€ç¯‡å—æ¬¢è¿çš„æ–‡ç« ã€Šå¯»æ‰¾åœ£æ¯ã€‹ï¼Œå…¶ä¸­æ¦‚è¿°äº†ä¸€ç§è¯¦ç»†è€Œå½»åº•çš„æ–¹æ³•æ¥åˆ›å»ºæ‰€è°“çš„åœ£æ¯å¸ƒå±€ - ä¸€ä¸ªé¡µçœ‰ï¼Œä¸‰åˆ—å’Œä¸€ä¸ªé¡µè„šã€‚è®¤ä¸ºå¬èµ·æ¥ç›¸å½“ç®€å•çš„å¸ƒå±€è¢«ç§°ä¸ºåœ£æ¯æ˜¯ç›¸å½“ç–¯ç‹‚çš„ï¼Œä½†è¿™ç¡®å®æ˜¯å½“æ—¶ä½¿ç”¨çº¯ CSS åˆ›å»ºä¸€è‡´çš„å¸ƒå±€æ˜¯å¤šä¹ˆå›°éš¾ã€‚\nä¸‹é¢æ˜¯åŸºäºè¯¥æ–‡ç« ä¸­æè¿°çš„æŠ€æœ¯çš„ç¤ºä¾‹çš„åŸºäº float çš„å¸ƒå±€ï¼š\n/* FLOAT-BASED LAYOUT */ body { padding-left: 200px; padding-right: 190px; min-width: 240px; } header, footer { margin-left: -200px; margin-right: -190px; } main, nav, aside { position: relative; float: left; } main { padding: 0 20px; width: 100%; } nav { width: 180px; padding: 0 10px; right: 240px; margin-left: -100%; } aside { width: 130px; padding: 0 10px; margin-right: -100%; } footer { clear: both; } * html nav { left: 150px; } çœ‹çœ‹ C SSï¼Œä½ å¯ä»¥çœ‹åˆ°æœ‰å¾ˆå¤šæŠ€å·§éœ€è¦è®©å®ƒå·¥ä½œï¼ˆè´Ÿè¾¹è·ï¼Œ clear: both å±æ€§ï¼Œç¡¬ç¼–ç å®½åº¦è®¡ç®—ç­‰ï¼‰â€”â€”è¿™ç¯‡ æ–‡ç«  å¾ˆå¥½åœ°è¯¦ç»†è§£é‡Šäº†æ¯ä¸ªåŸå› ã€‚ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š\nå•å‡»æ­¤å¤„æŸ¥çœ‹å®æ—¶ç¤ºä¾‹ è¿™å¾ˆå¥½ï¼Œä½†æ‚¨å¯ä»¥ä»é¢œè‰²ä¸­çœ‹åˆ°ä¸‰åˆ—çš„é«˜åº¦ä¸ç›¸ç­‰ï¼Œå¹¶ä¸”é¡µé¢æ²¡æœ‰å¡«æ»¡å±å¹•çš„é«˜åº¦ã€‚è¿™äº›é—®é¢˜æ˜¯åŸºäºæµ®åŠ¨çš„æ–¹æ³•æ‰€å›ºæœ‰çš„ã€‚æµ®åŠ¨æ‰€èƒ½åšçš„å°±æ˜¯å°†å†…å®¹æ”¾åœ¨ä¸€ä¸ªéƒ¨åˆ†çš„å·¦ä¾§æˆ–å³ä¾§â€”â€”CSS æ— æ³•æ¨æ–­å…¶ä»–éƒ¨åˆ†ä¸­å†…å®¹çš„é«˜åº¦ã€‚è¿™ä¸ªé—®é¢˜ç›´åˆ°å¤šå¹´åæ‰æœ‰äº†ç›´æ¥çš„è§£å†³æ–¹æ¡ˆï¼Œé‡‡ç”¨äº†åŸºäºå¼¹æ€§æ¡†çš„å¸ƒå±€ã€‚\nåŸºäºå¼¹æ€§æ¡†çš„å¸ƒå±€ flexbox CSS å±æ€§äº 2009 å¹´é¦–æ¬¡æå‡ºï¼Œä½†ç›´åˆ° 2015 å¹´å·¦å³æ‰è¢«å¹¿æ³›é‡‡ç”¨ã€‚Flexbox æ—¨åœ¨å®šä¹‰ç©ºé—´åœ¨å•ä¸ªåˆ—æˆ–è¡Œä¸­çš„åˆ†å¸ƒæ–¹å¼ï¼Œä¸ä½¿ç”¨æµ®åŠ¨ç›¸æ¯”ï¼Œè¿™ä½¿å…¶æˆä¸ºå®šä¹‰å¸ƒå±€çš„æ›´å¥½å€™é€‰é¡¹ã€‚è¿™æ„å‘³ç€åœ¨ä½¿ç”¨åŸºäºæµ®åŠ¨çš„å¸ƒå±€å¤§çº¦åå¹´ä¹‹åï¼ŒWeb å¼€å‘äººå‘˜ç»ˆäºèƒ½å¤Ÿä½¿ç”¨ CSS è¿›è¡Œå¸ƒå±€ï¼Œè€Œæ— éœ€ä½¿ç”¨æµ®åŠ¨æ‰€éœ€çš„æŠ€å·§ã€‚\nä¸‹é¢æ˜¯åŸºäºå¼¹æ€§æ¡†çš„ç¤ºä¾‹å¸ƒå±€ï¼ŒåŸºäºç«™ç‚¹ä¸Šæè¿°çš„æŠ€æœ¯ ç”±å¼¹æ€§æ¡†è§£å†³ ï¼ˆä¸€ä¸ªå±•ç¤ºä¸åŒå¼¹æ€§æ¡†ç¤ºä¾‹çš„æµè¡Œèµ„æºï¼‰ã€‚è¯·æ³¨æ„ï¼Œä¸ºäº†ä½¿ flexbox å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦åœ¨ HTML ä¸­çš„ä¸‰åˆ—å‘¨å›´å¢åŠ ä¸€ä¸ªåŒ…è£…å™¨ divï¼š\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Modern CSS\u0026lt;/title\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;index.css\u0026#34; /\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;header\u0026gt;This is the header.\u0026lt;/header\u0026gt; \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;main\u0026gt; \u0026lt;h1\u0026gt;This is the main content.\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;...\u0026lt;/p\u0026gt; \u0026lt;/main\u0026gt; \u0026lt;nav\u0026gt; \u0026lt;h4\u0026gt;This is the navigation section.\u0026lt;/h4\u0026gt; \u0026lt;p\u0026gt;...\u0026lt;/p\u0026gt; \u0026lt;/nav\u0026gt; \u0026lt;aside\u0026gt; \u0026lt;h4\u0026gt;This is an aside section.\u0026lt;/h4\u0026gt; \u0026lt;p\u0026gt;...\u0026lt;/p\u0026gt; \u0026lt;/aside\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;footer\u0026gt;This is the footer.\u0026lt;/footer\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; è¿™æ˜¯ CSS ä¸­çš„å¼¹æ€§æ¡†ä»£ç ï¼š\n/* FLEXBOX-BASED LAYOUT */ body { min-height: 100vh; display: flex; flex-direction: column; } .container { display: flex; flex: 1; } main { flex: 1; padding: 0 20px; } nav { flex: 0 0 180px; padding: 0 10px; order: -1; } aside { flex: 0 0 130px; padding: 0 10px; } ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸åŸºäºæµ®åŠ¨çš„å¸ƒå±€æ–¹æ³•ç›¸æ¯”ï¼Œæ›´ç´§å‡‘ï¼flexbox çš„å±æ€§å’Œå€¼ä¹ä¸€çœ‹æœ‰ç‚¹ä»¤äººå›°æƒ‘ï¼Œä½†å®ƒæ¶ˆé™¤äº†å¯¹è®¸å¤šæŠ€å·§çš„éœ€æ±‚ï¼Œä¾‹å¦‚åŸºäºæµ®åŠ¨çš„å¸ƒå±€æ‰€å¿…éœ€çš„è´Ÿè¾¹è·â€”â€”è¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„èƒœåˆ©ã€‚ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š\nå•å‡»æ­¤å¤„æŸ¥çœ‹å®æ—¶ç¤ºä¾‹ å¥½å¤šäº†ï¼è¿™äº›åˆ—çš„é«˜åº¦éƒ½ç›¸ç­‰ï¼Œå¹¶å æ®é¡µé¢çš„æ•´ä¸ªé«˜åº¦ã€‚ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œè¿™ä¼¼ä¹æ˜¯å®Œç¾çš„ï¼Œä½†è¿™ç§æ–¹æ³•æœ‰å‡ ä¸ªå°ç¼ºç‚¹ã€‚ä¸€ä¸ªæ˜¯æµè§ˆå™¨æ”¯æŒ - ç›®å‰æ¯ä¸ªç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒ f lexboxï¼Œä½†ä¸€äº›è¾ƒæ—§çš„æµè§ˆå™¨æ°¸è¿œä¸ä¼šã€‚å¹¸è¿çš„æ˜¯ï¼Œæµè§ˆå™¨ä¾›åº”å•†æ­£åœ¨åŠ å¤§åŠ›åº¦ç»ˆæ­¢å¯¹è¿™äº›æ—§æµè§ˆå™¨çš„æ”¯æŒï¼Œä¸ºç½‘é¡µè®¾è®¡å¸ˆæä¾›æ›´ä¸€è‡´çš„å¼€å‘ä½“éªŒã€‚å¦ä¸€ä¸ªç¼ºç‚¹æ˜¯æˆ‘ä»¬éœ€è¦å°† \u0026lt;div class=\u0026quot;container\u0026quot;\u0026gt; æ·»åŠ åˆ°æ ‡è®°ä¸­â€”â€”é¿å…å®ƒä¼šå¾ˆå¥½ã€‚åœ¨ç†æƒ³çš„ä¸–ç•Œä¸­ï¼Œä»»ä½• CSS å¸ƒå±€éƒ½æ ¹æœ¬ä¸éœ€è¦æ›´æ”¹ HTML æ ‡è®°ã€‚\næœ€å¤§çš„ç¼ºç‚¹æ˜¯ CSS æœ¬èº«çš„ä»£ç  - flexbox æ¶ˆé™¤äº†è®¸å¤šæµ®åŠ¨é»‘å®¢ï¼Œä½†ä»£ç å¹¶ä¸åƒå®šä¹‰å¸ƒå±€é‚£æ ·å¯Œæœ‰è¡¨ç°åŠ›ã€‚å¾ˆéš¾é˜…è¯» flexbox CSS å¹¶ç›´è§‚åœ°ç†è§£æ‰€æœ‰å…ƒç´ åœ¨é¡µé¢ä¸Šçš„å¸ƒå±€æ–¹å¼ã€‚è¿™ä¼šå¯¼è‡´åœ¨ç¼–å†™åŸºäº flexbox çš„å¸ƒå±€æ—¶è¿›è¡Œå¤§é‡çŒœæµ‹å’Œæ£€æŸ¥ã€‚\nå†æ¬¡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œflexbox æ—¨åœ¨å°†å…ƒç´ é—´éš”åœ¨å•ä¸ªåˆ—æˆ–è¡Œå†… - å®ƒä¸æ˜¯ä¸ºæ•´ä¸ªé¡µé¢å¸ƒå±€è®¾è®¡çš„ï¼å°½ç®¡å®ƒåšäº†ä¸€ä¸ªæœ‰ç”¨çš„å·¥ä½œï¼ˆæ¯”åŸºäºæµ®åŠ¨çš„å¸ƒå±€å¥½å¾—å¤šï¼‰ï¼Œä½†ä¸“é—¨å¼€å‘äº†ä¸åŒçš„è§„èŒƒæ¥å¤„ç†å…·æœ‰å¤šè¡Œå’Œå¤šåˆ—çš„å¸ƒå±€ã€‚æ­¤è§„èŒƒç§°ä¸º CSS ç½‘æ ¼ã€‚\nåŸºäºç½‘æ ¼çš„å¸ƒå±€ CSS ç½‘æ ¼äº 2011 å¹´é¦–æ¬¡æå‡ºï¼ˆåœ¨ flexbox ææ¡ˆä¹‹åä¸ä¹…ï¼‰ï¼Œä½†èŠ±äº†å¾ˆé•¿æ—¶é—´æ‰åœ¨æµè§ˆå™¨ä¸­å¾—åˆ°å¹¿æ³›é‡‡ç”¨ã€‚æˆªè‡³ 2018 å¹´åˆï¼Œå¤§å¤šæ•°ç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒ CSS ç½‘æ ¼ï¼ˆç”šè‡³æ¯”ä¸€ä¸¤å¹´å‰æœ‰äº†å·¨å¤§çš„æ”¹è¿›ï¼‰ã€‚\nä¸‹é¢æ˜¯åŸºäºæ­¤ CSS æŠ€å·§æ–‡ç«  ä¸­çš„ç¬¬ä¸€ç§æ–¹æ³•çš„ç¤ºä¾‹çš„åŸºäºç½‘æ ¼çš„å¸ƒå±€ã€‚è¯·æ³¨æ„ï¼Œå¯¹äºæ­¤ç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥æ‘†è„±å¿…é¡»ä¸ºåŸºäº flexbox çš„å¸ƒå±€æ·»åŠ çš„ \u0026lt;div class=\u0026quot;container\u0026quot;\u0026gt; â€” æˆ‘ä»¬å¯ä»¥ç®€å•åœ°ä½¿ç”¨åŸå§‹ HTMLï¼Œè€Œæ— éœ€ä¿®æ”¹ã€‚ä»¥ä¸‹æ˜¯ CSS çš„å¤–è§‚ï¼š\n/* GRID-BASED LAYOUT */ body { display: grid; min-height: 100vh; grid-template-columns: 200px 1fr 150px; grid-template-rows: min-content 1fr min-content; } header { grid-row: 1; grid-column: 1 / 4; } nav { grid-row: 2; grid-column: 1 / 2; padding: 0 10px; } main { grid-row: 2; grid-column: 2 / 3; padding: 0 20px; } aside { grid-row: 2; grid-column: 3 / 4; padding: 0 10px; } footer { grid-row: 3; grid-column: 1 / 4; } ç»“æœåœ¨è§†è§‰ä¸Šä¸åŸºäºå¼¹æ€§æ¡†çš„å¸ƒå±€ç›¸åŒã€‚ä½†æ˜¯ï¼Œè¿™é‡Œçš„ CSS åœ¨æ¸…æ¥šåœ°è¡¨è¾¾æ‰€éœ€å¸ƒå±€çš„æ„ä¹‰ä¸Šå¾—åˆ°äº†å¾ˆå¤§çš„æ”¹è¿›ã€‚åˆ—å’Œè¡Œçš„å¤§å°å’Œå½¢çŠ¶åœ¨æ­£æ–‡é€‰æ‹©å™¨ä¸­å®šä¹‰ï¼Œç½‘æ ¼ä¸­çš„æ¯ä¸ªé¡¹ç›®éƒ½ç”±å…¶ä½ç½®ç›´æ¥å®šä¹‰ã€‚\nå¯èƒ½ä»¤äººå›°æƒ‘çš„ä¸€ä»¶äº‹æ˜¯ grid-column å±æ€§ï¼Œå®ƒå®šä¹‰äº†åˆ—çš„èµ·ç‚¹/ç»ˆç‚¹ã€‚è¿™å¯èƒ½ä¼šä»¤äººå›°æƒ‘ï¼Œå› ä¸ºåœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæœ‰ 3 åˆ—ï¼Œä½†æ•°å­—èŒƒå›´ä» 1 åˆ° 4ã€‚å½“ä½ çœ‹ä¸‹é¢çš„å›¾ç‰‡æ—¶ï¼Œå®ƒä¼šå˜å¾—æ›´åŠ æ¸…æ™°ï¼š\nå•å‡»æ­¤å¤„æŸ¥çœ‹å®æ—¶ç¤ºä¾‹ ç¬¬ä¸€åˆ—ä» 1 å¼€å§‹ï¼Œåˆ° 2 ç»“æŸï¼Œç¬¬äºŒåˆ—ä» 2 å¼€å§‹ï¼Œåˆ° 3 ç»“æŸï¼Œç¬¬ä¸‰åˆ—ä» 3 å¼€å§‹ï¼Œåˆ° 4 ç»“æŸã€‚æ ‡é¢˜çš„ grid-column ä¸º 1 / 4 ä»¥è·¨è¶Šæ•´ä¸ªé¡µé¢ï¼Œå¯¼èˆªå…·æœ‰ grid-column of 1 / 2 ä»¥è·¨è¶Šç¬¬ä¸€åˆ—ï¼Œä¾æ­¤ç±»æ¨ã€‚\nä¸€æ—¦ä½ ä¹ æƒ¯äº†ç½‘æ ¼è¯­æ³•ï¼Œå®ƒæ˜¾ç„¶æˆä¸ºåœ¨ CSS ä¸­è¡¨è¾¾å¸ƒå±€çš„ç†æƒ³æ–¹å¼ã€‚åŸºäºç½‘æ ¼çš„å¸ƒå±€å”¯ä¸€çœŸæ­£çš„ç¼ºç‚¹æ˜¯æµè§ˆå™¨æ”¯æŒï¼Œåœ¨è¿‡å»ä¸€å¹´ä¸­å†æ¬¡æœ‰äº†å¾ˆå¤§çš„æ”¹è¿›ã€‚CSS ç½‘æ ¼ä½œä¸º CSS ä¸­ç¬¬ä¸€ä¸ªçœŸæ­£ä¸ºå¸ƒå±€è€Œè®¾è®¡çš„å·¥å…·çš„é‡è¦æ€§æ€ä¹ˆå¼ºè°ƒéƒ½ä¸ä¸ºè¿‡ã€‚ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œç½‘é¡µè®¾è®¡å¸ˆåœ¨åˆ¶ä½œåˆ›æ„å¸ƒå±€æ—¶æ€»æ˜¯å¿…é¡»éå¸¸ä¿å®ˆï¼Œå› ä¸ºåˆ°ç›®å‰ä¸ºæ­¢çš„å·¥å…·ä¸€ç›´å¾ˆè„†å¼±ï¼Œä½¿ç”¨å„ç§é»‘å®¢å’Œè§£å†³æ–¹æ³•ã€‚ç°åœ¨ CSS ç½‘æ ¼å·²ç»å­˜åœ¨ï¼Œæœ‰å¯èƒ½å‡ºç°ä»¥å‰ä»æœªæœ‰è¿‡çš„åˆ›æ„å¸ƒå±€è®¾è®¡çš„æ–°æµªæ½® - æ¿€åŠ¨äººå¿ƒçš„æ—¶ä»£ï¼\nå°† CSS é¢„å¤„ç†å™¨ç”¨äºæ–°è¯­æ³• åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»ä»‹ç»äº†ä½¿ç”¨ CSS è¿›è¡ŒåŸºæœ¬æ ·å¼å’Œå¸ƒå±€ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¸ºå¸®åŠ©æ”¹å–„å°† CSS ä½œä¸ºè¯­è¨€æœ¬èº«ä½¿ç”¨çš„ä½“éªŒè€Œåˆ›å»ºçš„å·¥å…·ï¼Œä» CSS é¢„å¤„ç†å™¨å¼€å§‹ã€‚\nCSS é¢„å¤„ç†å™¨å…è®¸æ‚¨ä½¿ç”¨ä¸åŒçš„è¯­è¨€ç¼–å†™æ ·å¼ï¼Œè¯¥è¯­è¨€è¢«è½¬æ¢ä¸ºæµè§ˆå™¨å¯ä»¥ç†è§£çš„ CSSã€‚è¿™åœ¨æµè§ˆå™¨å®ç°æ–°åŠŸèƒ½éå¸¸ç¼“æ…¢çš„æ—¶ä»£è‡³å…³é‡è¦ã€‚ç¬¬ä¸€ä¸ªä¸»è¦çš„ CSS é¢„å¤„ç†å™¨æ˜¯ Sassï¼Œäº 2006 å¹´å‘å¸ƒã€‚å®ƒå…·æœ‰æ–°çš„ç®€æ´è¯­æ³•ï¼ˆç¼©è¿›è€Œä¸æ˜¯æ‹¬å·ï¼Œæ²¡æœ‰åˆ†å·ç­‰ï¼‰ï¼Œå¹¶æ·»åŠ äº† CSS ä¸­ç¼ºå°‘çš„é«˜çº§åŠŸèƒ½ï¼Œä¾‹å¦‚å˜é‡ï¼Œå¸®åŠ©ç¨‹åºå‡½æ•°å’Œè®¡ç®—ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬å‰é¢ç¤ºä¾‹çš„é¢œè‰²éƒ¨åˆ†ä½¿ç”¨å¸¦æœ‰å˜é‡çš„ Sass çš„æ ·å­ï¼š\n$dark-color: #4a4a4a $light-color: #f9f9f9 $side-color: #eee body color: $dark-color header, footer background-color: $dark-color color: $light-color main background: $light-color nav, aside background: $side-color è¯·æ³¨æ„å¦‚ä½•ä½¿ç”¨ $ ç¬¦å·å®šä¹‰å¯é‡ç”¨å˜é‡ï¼Œå¹¶åˆ é™¤æ‹¬å·å’Œåˆ†å·ï¼Œä»è€Œä½¿è¯­æ³•çœ‹èµ·æ¥æ›´ç®€æ´ã€‚Sass ä¸­æ›´ç®€æ´çš„è¯­æ³•å¾ˆå¥½ï¼Œä½†æ˜¯åƒå˜é‡è¿™æ ·çš„åŠŸèƒ½åœ¨å½“æ—¶æ˜¯é©å‘½æ€§çš„ï¼Œå› ä¸ºå®ƒä»¬ä¸ºç¼–å†™å¹²å‡€å’Œå¯ç»´æŠ¤çš„ CSS å¼€è¾Ÿäº†æ–°çš„å¯èƒ½æ€§ã€‚\nè¦ä½¿ç”¨ Sassï¼Œæ‚¨éœ€è¦ å®‰è£… Rubyï¼Œè¿™æ˜¯ä¸€ç§ç”¨äºå°† Sass ä»£ç ç¼–è¯‘ä¸ºå¸¸è§„ CSS çš„ç¼–ç¨‹è¯­è¨€ã€‚ç„¶åï¼Œæ‚¨éœ€è¦å®‰è£… Sass gemï¼Œç„¶ååœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œå‘½ä»¤ä»¥å°† .sass æ–‡ä»¶è½¬æ¢ä¸º .css æ–‡ä»¶ã€‚ä¸‹é¢æ˜¯å‘½ä»¤çš„å¤–è§‚ç¤ºä¾‹ï¼š\nsass --watch index.sass index.css æ­¤å‘½ä»¤ä¼šå°†ç¼–å†™åœ¨åä¸º index.sass çš„æ–‡ä»¶ä¸­çš„ Sass ä»£ç è½¬æ¢ä¸ºåä¸º index.css çš„æ–‡ä»¶ä¸­çš„å¸¸è§„ CSSï¼ˆ --watch å‚æ•°å‘Šè¯‰å®ƒåœ¨ä¿å­˜æ—¶è¾“å…¥æ›´æ”¹æ—¶éšæ—¶è¿è¡Œï¼Œè¿™å¾ˆæ–¹ä¾¿ï¼‰ã€‚\nè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºæ„å»ºæ­¥éª¤ï¼Œè¿™åœ¨ 2006 å¹´æ˜¯ä¸€ä¸ªç›¸å½“å¤§çš„è¿›å…¥éšœç¢ã€‚å¦‚æœæ‚¨ä¹ æƒ¯äº†åƒ Ruby è¿™æ ·çš„ç¼–ç¨‹è¯­è¨€ï¼Œé‚£ä¹ˆè¿™ä¸ªè¿‡ç¨‹éå¸¸ç®€å•ã€‚ä½†æ˜¯å½“æ—¶è®¸å¤šå‰ç«¯å¼€å‘äººå‘˜åªä½¿ç”¨ HTM L å’Œ CSSï¼Œä¸éœ€è¦ä»»ä½•è¿™æ ·çš„å·¥å…·ã€‚å› æ­¤ï¼Œè®©æŸäººå­¦ä¹ æ•´ä¸ªç”Ÿæ€ç³»ç»Ÿä»¥è·å¾— CSS é¢„å¤„ç†å™¨æä¾›çš„åŠŸèƒ½æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„è¦æ±‚ã€‚\n2009 å¹´ï¼ŒLess CSS é¢„å¤„ç†å™¨å‘å¸ƒã€‚å®ƒä¹Ÿæ˜¯ç”¨ Ruby ç¼–å†™çš„ï¼Œå¹¶æä¾›äº†ä¸ Sass ç±»ä¼¼çš„åŠŸèƒ½ã€‚å…³é”®çš„åŒºåˆ«åœ¨äºè¯­æ³•ï¼Œå®ƒè¢«è®¾è®¡ä¸ºå°½å¯èƒ½æ¥è¿‘ CSSã€‚è¿™æ„å‘³ç€ä»»ä½• CSS ä»£ç éƒ½æ˜¯æœ‰æ•ˆçš„ Less ä»£ç ã€‚ä¸‹é¢æ˜¯ä½¿ç”¨ Less è¯­æ³•ç¼–å†™çš„ç›¸åŒç¤ºä¾‹ï¼š\n@dark-color: #4a4a4a; @light-color: #f9f9f9; @side-color: #eee; body { color: @dark-color; } header, footer { background-color: @dark-color; color: @light-color; } main { background: @light-color; } nav, aside { background: @side-color; } å®ƒå‡ ä¹ç›¸åŒï¼ˆå˜é‡çš„å‰ç¼€ä¸º @ è€Œä¸æ˜¯ $ ï¼‰ï¼Œä½†ä¸åƒ Sass ç¤ºä¾‹é‚£æ ·æ¼‚äº®ï¼Œå…·æœ‰ä¸ CSS ç›¸åŒçš„å¤§æ‹¬å·å’Œåˆ†å·ã€‚ç„¶è€Œï¼Œå®ƒæ›´æ¥è¿‘ CSS çš„äº‹å®ä½¿å¼€å‘äººå‘˜æ›´å®¹æ˜“é‡‡ç”¨å®ƒã€‚2012 å¹´ï¼ŒLess è¢«é‡å†™ä¸ºä½¿ç”¨ JavaScriptï¼ˆç‰¹åˆ«æ˜¯ Node.jsï¼‰è€Œä¸æ˜¯ Ruby è¿›è¡Œç¼–è¯‘ã€‚è¿™ä½¿å¾— Less æ¯”å®ƒçš„ Ruby åŒè¡Œæ›´å¿«ï¼Œå¹¶ä¸”å¯¹å·²ç»åœ¨å·¥ä½œæµç¨‹ä¸­ä½¿ç”¨ Node.js çš„å¼€å‘äººå‘˜æ›´å…·å¸å¼•åŠ›ã€‚\nè¦å°†æ­¤ä»£ç è½¬æ¢ä¸ºå¸¸è§„ CSSï¼Œæ‚¨é¦–å…ˆéœ€è¦ å®‰è£… Node.jsï¼Œç„¶å å®‰è£… Lessï¼Œç„¶åè¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\nlessc index.less index.css æ­¤å‘½ä»¤ä¼šå°†åœ¨åä¸º index.less çš„æ–‡ä»¶ä¸­ç¼–å†™çš„è¾ƒå°‘ä»£ç è½¬æ¢ä¸ºåä¸º index.css çš„æ–‡ä»¶ä¸­çš„å¸¸è§„ CSSã€‚è¯·æ³¨æ„ï¼Œ lessc å‘½ä»¤æ²¡æœ‰ç›‘è§†æ–‡ä»¶æ›´æ”¹çš„æ–¹æ³•ï¼ˆä¸ sass å‘½ä»¤ä¸åŒï¼‰ï¼Œè¿™æ„å‘³ç€æ‚¨éœ€è¦å®‰è£…ä¸åŒçš„å·¥å…·æ¥è‡ªåŠ¨ç›‘è§†å’Œç¼–è¯‘ .less ä¸ªæ–‡ä»¶ï¼Œè¿™å¢åŠ äº†è¿‡ç¨‹çš„å¤æ‚æ€§ã€‚åŒæ ·ï¼Œå¯¹äºä¹ æƒ¯ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·çš„ç¨‹åºå‘˜æ¥è¯´ï¼Œè¿™å¹¶ä¸å›°éš¾ï¼Œä½†å¯¹äºåªæƒ³ä½¿ç”¨ CSS é¢„å¤„ç†å™¨çš„å…¶ä»–äººæ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªé‡è¦çš„è¿›å…¥éšœç¢ã€‚\néšç€ Less è·å¾—æ€æƒ³ä»½é¢ï¼ŒSass å¼€å‘äººå‘˜åœ¨ 2010 å¹´é€šè¿‡æ·»åŠ ä¸€ä¸ªåä¸º SCSS çš„æ–°è¯­æ³•ï¼ˆè¿™æ˜¯ä¸€ä¸ªç±»ä¼¼äº Less çš„ CSS è¶…é›†ï¼‰è¿›è¡Œäº†è°ƒæ•´ã€‚ä»–ä»¬è¿˜å‘å¸ƒäº† LibSassï¼Œè¿™æ˜¯ Ruby Sass å¼•æ“çš„ C/C++ ç«¯å£ï¼Œè¿™ä½¿å¾—å®ƒæ›´å¿«ï¼Œèƒ½å¤Ÿåœ¨å„ç§è¯­è¨€ä¸­ä½¿ç”¨ã€‚\nå¦ä¸€ä¸ªæ›¿ä»£çš„ CSS é¢„å¤„ç†å™¨æ˜¯ Stylusï¼Œå®ƒäº 2010 å¹´é—®ä¸–ï¼Œç”¨ Node.js ç¼–å†™ï¼Œä¸ Sass or Less ç›¸æ¯”ï¼Œå®ƒä¸“æ³¨äºæ›´ç®€æ´çš„è¯­æ³•ã€‚é€šå¸¸å…³äº CSS é¢„å¤„ç†å™¨çš„è®¨è®ºé›†ä¸­åœ¨è¿™ä¸‰ç§æœ€æµè¡Œçš„ï¼ˆSassï¼ŒLess å’Œ Stylusï¼‰ä¸Šã€‚æœ€åï¼Œå®ƒä»¬åœ¨æä¾›çš„åŠŸèƒ½æ–¹é¢éƒ½éå¸¸ç›¸ä¼¼ï¼Œå› æ­¤é€‰æ‹©å®ƒä»¬ä¸­çš„ä»»ä½•ä¸€ä¸ªéƒ½ä¸ä¼šå‡ºé”™ã€‚\nç„¶è€Œï¼Œæœ‰äº›äººè®¤ä¸º CSS é¢„å¤„ç†å™¨å˜å¾—è¶Šæ¥è¶Šä¸å¿…è¦ï¼Œå› ä¸ºæµè§ˆå™¨ç»ˆäºå¼€å§‹å®ç°å®ƒä»¬çš„ä¸€äº›åŠŸèƒ½ï¼ˆå¦‚å˜é‡å’Œè®¡ç®—ï¼‰ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ç§ç§°ä¸º CSS åå¤„ç†çš„ä¸åŒæ–¹æ³•ï¼Œå®ƒæœ‰å¯èƒ½ä½¿ CSS é¢„å¤„ç†å™¨è¿‡æ—¶ï¼ˆæ˜¾ç„¶å¹¶éæ²¡æœ‰äº‰è®®ï¼‰ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°†è®¨è®ºã€‚\nå°† CSS åå¤„ç†å™¨ç”¨äºå˜é©æ€§åŠŸèƒ½ CSS åå¤„ç†å™¨ä½¿ç”¨ JavaScript æ¥åˆ†ææ‚¨çš„ CSS å¹¶å°†å…¶è½¬æ¢ä¸ºæœ‰æ•ˆçš„ CSSã€‚ä»è¿™ä¸ªæ„ä¹‰ä¸Šè¯´ï¼Œå®ƒä¸ CSS é¢„å¤„ç†å™¨éå¸¸ç›¸ä¼¼ - æ‚¨å¯ä»¥å°†å…¶è§†ä¸ºè§£å†³ç›¸åŒé—®é¢˜çš„ä¸åŒæ–¹æ³•ã€‚å…³é”®çš„åŒºåˆ«åœ¨äºï¼Œè™½ç„¶ CSS é¢„å¤„ç†å™¨ä½¿ç”¨ç‰¹æ®Šè¯­æ³•æ¥æ ‡è¯†éœ€è¦è½¬æ¢çš„å†…å®¹ï¼Œä½† CSS åå¤„ç†å™¨å¯ä»¥è§£æå¸¸è§„ CSS å¹¶è½¬æ¢å®ƒï¼Œè€Œæ— éœ€ä»»ä½•ç‰¹æ®Šè¯­æ³•ã€‚æœ€å¥½ç”¨ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜è¿™ä¸€ç‚¹ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æˆ‘ä»¬æœ€åˆåœ¨ä¸Šé¢å®šä¹‰çš„ç”¨äºè®¾ç½®æ ‡é¢˜æ ‡ç­¾æ ·å¼çš„ CSS çš„ä¸€éƒ¨åˆ†ï¼š\nh1, h2, h3, h4, h5, h6 { -ms-hyphens: auto; -moz-hyphens: auto; -webkit-hyphens: auto; hyphens: auto; } ç²—ä½“ä¸­çš„é¡¹ç›®ç§°ä¸ºä¾›åº”å•†å‰ç¼€ã€‚æµè§ˆå™¨åœ¨å®éªŒæ€§åœ°æ·»åŠ æ–°çš„ CSS åŠŸèƒ½æ—¶ä¼šä½¿ç”¨ä¾›åº”å•†å‰ç¼€ï¼Œä»è€Œä¸ºå¼€å‘äººå‘˜æä¾›äº†ä¸€ç§åœ¨æœ€ç»ˆå®ç°æ—¶ä½¿ç”¨è¿™äº›æ–° CSS å±æ€§çš„æ–¹æ³•ã€‚è¿™é‡Œçš„å‰ç¼€ -ms ä»£è¡¨ Microsoft Internet Explorerï¼Œ -moz å‰ç¼€ä»£è¡¨ Mozilla Firefoxï¼Œ -webkit å‰ç¼€ä»£è¡¨ä½¿ç”¨ webkit æ¸²æŸ“å¼•æ“çš„æµè§ˆå™¨ï¼ˆå¦‚ Google Chromeã€Safari å’Œè¾ƒæ–°ç‰ˆæœ¬çš„ Operaï¼‰ã€‚\nè®°ä½è¾“å…¥æ‰€æœ‰è¿™äº›ä¸åŒçš„ä¾›åº”å•†å‰ç¼€æ¥ä½¿ç”¨è¿™äº› CSS å±æ€§æ˜¯éå¸¸çƒ¦äººçš„ã€‚æ‹¥æœ‰ä¸€ä¸ªå¯ä»¥æ ¹æ®éœ€è¦è‡ªåŠ¨æ”¾å…¥ä¾›åº”å•†å‰ç¼€çš„å·¥å…·ä¼šå¾ˆå¥½ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ CSS é¢„å¤„ç†å™¨æ¥å®ç°è¿™ä¸€ç‚¹ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ SCSS æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š\n@mixin hyphens($value) { -ms-hyphens: $value; -moz-hyphens: $value; -webkit-hyphens: $value; hyphens: $value; } h1, h2, h3, h4, h5, h6 { @include hyphens(auto); } åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ Sass çš„ mixin åŠŸèƒ½ï¼Œå®ƒå…è®¸æ‚¨å®šä¹‰ä¸€æ¬¡ CSS å—å¹¶åœ¨å…¶ä»–ä»»ä½•åœ°æ–¹é‡ç”¨å®ƒã€‚å½“æ­¤æ–‡ä»¶ç¼–è¯‘ä¸ºå¸¸è§„ CSS æ—¶ï¼Œä»»ä½• @include è¯­å¥éƒ½å°†æ›¿æ¢ä¸ºåŒ¹é… @mixin çš„ CSSã€‚æ€»çš„æ¥è¯´ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªç³Ÿç³•çš„è§£å†³æ–¹æ¡ˆï¼Œä½†æ‚¨è´Ÿè´£åœ¨ç¬¬ä¸€æ¬¡ä¸ºä»»ä½•éœ€è¦ä¾›åº”å•†å‰ç¼€çš„ CSS å±æ€§å®šä¹‰æ¯ä¸ª mixinã€‚è¿™äº› mixin å®šä¹‰å°†éœ€è¦ç»´æŠ¤ï¼Œå› ä¸ºæ‚¨å¯èƒ½å¸Œæœ›åœ¨æµè§ˆå™¨æ›´æ–°å…¶ CSS å…¼å®¹æ€§æ—¶åˆ é™¤ä¸å†éœ€è¦çš„ç‰¹å®šä¾›åº”å•†å‰ç¼€ã€‚\nä¸å…¶ä½¿ç”¨ mixinsï¼Œä¸å¦‚ç®€å•åœ°ç¼–å†™æ™®é€šçš„ CSS å¹¶è®©å·¥å…·è‡ªåŠ¨è¯†åˆ«éœ€è¦å‰ç¼€çš„å±æ€§å¹¶ç›¸åº”åœ°æ·»åŠ å®ƒä»¬ã€‚CSS åå¤„ç†å™¨èƒ½å¤Ÿåšåˆ°è¿™ä¸€ç‚¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨å°† PostCSS ä¸ è‡ªåŠ¨å‰ç¼€æ’ä»¶ ä¸€èµ·ä½¿ç”¨ï¼Œåˆ™å¯ä»¥ç¼–å†™å®Œå…¨æ­£å¸¸çš„ CSSï¼Œè€Œæ— éœ€ä»»ä½•ä¾›åº”å•†å‰ç¼€ï¼Œå¹¶è®©åå¤„ç†å™¨å®Œæˆå…¶ä½™çš„å·¥ä½œï¼š\nh1, h2, h3, h4, h5, h6 { hyphens: auto; } å½“æ‚¨åœ¨æ­¤ä»£ç ä¸Šè¿è¡Œ CSS åå¤„ç†å™¨æ—¶ï¼Œç»“æœæ˜¯ hyphens: auto; è¡Œè¢«æ›¿æ¢ä¸ºæ‰€æœ‰é€‚å½“çš„ä¾›åº”å•†å‰ç¼€ï¼ˆå¦‚è‡ªåŠ¨å‰ç¼€æ’ä»¶ä¸­å®šä¹‰çš„é‚£æ ·ï¼Œæ‚¨ä¸éœ€è¦ç›´æ¥ç®¡ç†ï¼‰ã€‚è¿™æ„å‘³ç€æ‚¨å¯ä»¥ç¼–å†™å¸¸è§„ CSSï¼Œè€Œä¸å¿…æ‹…å¿ƒä»»ä½•å…¼å®¹æ€§æˆ–ç‰¹æ®Šè¯­æ³•ï¼Œè¿™å¾ˆå¥½ï¼\né™¤äº† PostCSS çš„è‡ªåŠ¨å‰ç¼€ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›æ’ä»¶å¯ä»¥è®©ä½ åšéå¸¸é…·çš„äº‹æƒ…ã€‚cssnext æ’ä»¶å…è®¸æ‚¨ä½¿ç”¨å®éªŒæ€§çš„ CSS åŠŸèƒ½ã€‚CSS æ¨¡å— æ’ä»¶ä¼šè‡ªåŠ¨æ›´æ”¹ç±»ä»¥é¿å…åç§°å†²çªã€‚stylelint æ’ä»¶å¯è¯†åˆ« CSS ä¸­çš„é”™è¯¯å’Œä¸ä¸€è‡´çš„çº¦å®šã€‚è¿™äº›å·¥å…·åœ¨è¿‡å»ä¸€ä¸¤å¹´æ‰çœŸæ­£å¼€å§‹èµ·é£ï¼Œå±•ç¤ºäº†ä»¥å‰ä»æœªæœ‰è¿‡çš„å¼€å‘äººå‘˜å·¥ä½œæµç¨‹ï¼\nç„¶è€Œï¼Œè¿™ä¸€è¿›å±•æ˜¯è¦ä»˜å‡ºä»£ä»·çš„ã€‚ä¸ä½¿ç”¨ CSS é¢„å¤„ç†å™¨ç›¸æ¯”ï¼Œå®‰è£…å’Œä½¿ç”¨ CSS åå¤„ç†å™¨ï¼ˆå¦‚ PostCSSï¼‰æ›´ä¸ºå¤æ‚ã€‚æ‚¨ä¸ä»…å¿…é¡»ä½¿ç”¨å‘½ä»¤è¡Œå®‰è£…å’Œè¿è¡Œå·¥å…·ï¼Œè¿˜éœ€è¦å®‰è£…å’Œé…ç½®å•ä¸ªæ’ä»¶å¹¶å®šä¹‰ä¸€ç»„æ›´å¤æ‚çš„è§„åˆ™ï¼ˆä¾‹å¦‚æ‚¨è¦é’ˆå¯¹çš„æµè§ˆå™¨ç­‰ï¼‰ã€‚è®¸å¤šå¼€å‘äººå‘˜ä¸æ˜¯ç›´æ¥ä»å‘½ä»¤è¡Œè¿è¡Œ PostCSSï¼Œè€Œæ˜¯å°†å…¶é›†æˆåˆ°å¯é…ç½®çš„æ„å»ºç³»ç»Ÿä¸­ï¼Œå¦‚ Gruntï¼ŒGulp æˆ– webpackï¼Œè¿™æœ‰åŠ©äºç®¡ç†æ‚¨å¯èƒ½åœ¨å‰ç«¯å·¥ä½œæµç¨‹ä¸­ä½¿ç”¨çš„æ‰€æœ‰ä¸åŒæ„å»ºå·¥å…·ã€‚\næ³¨æ„ï¼šå¦‚æœæ‚¨ä»¥å‰ä»æœªä½¿ç”¨è¿‡ç°ä»£å‰ç«¯æ„å»ºç³»ç»Ÿï¼Œé‚£ä¹ˆå­¦ä¹ ä½¿ç°ä»£å‰ç«¯æ„å»ºç³»ç»Ÿå·¥ä½œçš„æ‰€æœ‰å¿…è¦éƒ¨åˆ†å¯èƒ½ä¼šéå¸¸ä¸çŸ¥æ‰€æªã€‚å¦‚æœä½ æƒ³ä»å¤´å¼€å§‹ï¼Œè¯·æŸ¥çœ‹æˆ‘çš„æ–‡ç«  Modern JavaScript Explain For Dinosaursï¼Œå…¶ä¸­ä»‹ç»äº†å‰ç«¯å¼€å‘äººå‘˜åˆ©ç”¨è¿™äº›ç°ä»£åŠŸèƒ½æ‰€éœ€çš„æ‰€æœ‰ JavaScript å·¥å…·ã€‚\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå›´ç»• CSS åå¤„ç†å™¨å­˜åœ¨ä¸€äº›äº‰è®ºã€‚æœ‰äº›äººè®¤ä¸ºè¿™ä¸ªæœ¯è¯­ä»¤äººå›°æƒ‘ï¼ˆä¸€ç§è§‚ç‚¹è®¤ä¸ºå®ƒä»¬éƒ½åº”è¯¥è¢«ç§°ä¸º CSS é¢„å¤„ç†å™¨ï¼Œå¦ä¸€ç§è§‚ç‚¹æ˜¯å®ƒä»¬åº”è¯¥ç®€å•åœ°ç§°ä¸º CSS å¤„ç†å™¨ç­‰ï¼‰ã€‚æœ‰äº›äººè®¤ä¸º CSS åå¤„ç†å™¨å®Œå…¨æ¶ˆé™¤äº†å¯¹ CSS é¢„å¤„ç†å™¨çš„éœ€æ±‚ï¼Œæœ‰äº›äººè®¤ä¸ºå®ƒä»¬åº”è¯¥ä¸€èµ·ä½¿ç”¨ã€‚æ— è®ºå¦‚ä½•ï¼Œå¾ˆæ˜æ˜¾ï¼Œå¦‚æœä½ æœ‰å…´è¶£æ¨åŠ¨ CSS çš„å¯èƒ½æ€§ï¼Œé‚£ä¹ˆå­¦ä¹ å¦‚ä½•ä½¿ç”¨ CSS åå¤„ç†å™¨æ˜¯å€¼å¾—çš„ã€‚\nä½¿ç”¨ CSS æ–¹æ³•å®ç°å¯ç»´æŠ¤æ€§ åƒ CSS é¢„å¤„ç†å™¨å’Œ CSS åå¤„ç†å™¨è¿™æ ·çš„å·¥å…·åœ¨æ”¹å–„ CSS å¼€å‘ä½“éªŒæ–¹é¢å¤§æœ‰å¸®åŠ©ã€‚ä½†æ˜¯ä»…é è¿™äº›å·¥å…·ä¸è¶³ä»¥è§£å†³ç»´æŠ¤å¤§å‹ CSS ä»£ç åº“çš„é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œäººä»¬å¼€å§‹è®°å½•å…³äºå¦‚ä½•ç¼–å†™ CSS çš„ä¸åŒæŒ‡å—ï¼Œé€šå¸¸ç§°ä¸º CSS æ–¹æ³•ã€‚\nåœ¨æˆ‘ä»¬æ·±å…¥ç ”ç©¶ä»»ä½•ç‰¹å®šçš„ CSS æ–¹æ³•ä¹‹å‰ï¼Œé‡è¦çš„æ˜¯è¦äº†è§£æ˜¯ä»€ä¹ˆè®© CSS éšç€æ—¶é—´çš„æ¨ç§»éš¾ä»¥ç»´æŠ¤ã€‚å…³é”®é—®é¢˜æ˜¯ CSS çš„å…¨å±€æ€§è´¨ â€” æ‚¨å®šä¹‰çš„æ¯ä¸ªæ ·å¼éƒ½å…¨å±€åº”ç”¨äºé¡µé¢çš„æ¯ä¸ªéƒ¨åˆ†ã€‚ä½ çš„å·¥ä½œæ˜¯æå‡ºä¸€ä¸ªè¯¦ç»†çš„å‘½åçº¦å®šæ¥ç»´æŠ¤å”¯ä¸€çš„ç±»åï¼Œæˆ–è€…ä¸ ç‰¹å¼‚æ€§è§„åˆ™ äº‰è®ºï¼Œä»¥ç¡®å®šåº”ç”¨å“ªç§æ ·å¼æ¥åº”ç”¨ä»»ä½•ç»™å®šçš„å…ƒç´ ã€‚CSS æ–¹æ³•æä¾›äº†ä¸€ç§æœ‰ç»„ç»‡çš„æ–¹å¼æ¥ç¼–å†™ CSSï¼Œä»¥é¿å…è¿™äº›å¸¦æœ‰å¤§å‹ä»£ç åº“çš„ç—›ç‚¹ã€‚è®©æˆ‘ä»¬æŒ‰æ—¶é—´é¡ºåºå¤§è‡´çœ‹ä¸€ä¸‹ä¸€äº›æµè¡Œçš„æ–¹æ³•ã€‚\nOOCSS OOCSSï¼ˆé¢å‘å¯¹è±¡çš„ CSSï¼‰äº 2009 å¹´é¦–æ¬¡æå‡ºï¼Œæ˜¯ä¸€ç§å›´ç»•ä¸¤ä¸ªä¸»è¦åŸåˆ™ç»„ç»‡çš„æ–¹æ³•è®ºã€‚ç¬¬ä¸€ä¸ªåŸåˆ™æ˜¯åˆ†ç¦»ç»“æ„å’Œçš®è‚¤ã€‚è¿™æ„å‘³ç€å®šä¹‰ç»“æ„ï¼ˆå¦‚å¸ƒå±€ï¼‰çš„ CSS ä¸åº”ä¸å®šä¹‰çš®è‚¤çš„ CSS ï¼ˆå¦‚é¢œè‰²ã€å­—ä½“ç­‰ï¼‰æ··åˆåœ¨ä¸€èµ·ã€‚è¿™æ ·å¯ä»¥æ›´è½»æ¾åœ°â€œé‡æ–°æ¢è‚¤â€åº”ç”¨ç¨‹åºã€‚ç¬¬äºŒä¸ªåŸåˆ™æ˜¯å•ç‹¬çš„å®¹å™¨å’Œå†…å®¹ã€‚è¿™æ„å‘³ç€å°†å…ƒç´ è§†ä¸ºå¯é‡ç”¨çš„å¯¹è±¡ï¼Œå…¶å…³é”®æ€æƒ³æ˜¯æ— è®ºå¯¹è±¡åœ¨é¡µé¢ä¸Šçš„ä½ç½®å¦‚ä½•ï¼Œå®ƒéƒ½åº”è¯¥çœ‹èµ·æ¥ç›¸åŒã€‚\nOOCSS æä¾›äº†ç»è¿‡æ·±æ€ç†Ÿè™‘çš„æŒ‡å¯¼æ–¹é’ˆï¼Œä½†å¯¹æ–¹æ³•çš„ç»†èŠ‚ä¸æ˜¯å¾ˆè§„èŒƒã€‚åæ¥çš„æ–¹æ³•ï¼Œå¦‚ SMACSS é‡‡ç”¨äº†æ ¸å¿ƒæ¦‚å¿µï¼Œå¹¶æ·»åŠ äº†æ›´å¤šç»†èŠ‚ï¼Œä½¿å…¶æ›´å®¹æ˜“ä¸Šæ‰‹ã€‚\nSMACSS SMACSSï¼ˆCSS çš„å¯æ‰©å±•å’Œæ¨¡å—åŒ–æ¶æ„ï¼‰äº 2011 å¹´æ¨å‡ºï¼Œä½œä¸ºä¸€ç§åŸºäºåœ¨ 5 ä¸ªä¸åŒç±»åˆ«ä¸­ç¼–å†™ CSS çš„æ–¹æ³•â€”â€”åŸºæœ¬è§„åˆ™ã€å¸ƒå±€è§„åˆ™ã€æ¨¡å—ã€çŠ¶æ€è§„åˆ™å’Œä¸»é¢˜è§„åˆ™ã€‚SMACSS æ–¹æ³•è¿˜æ¨èäº†ä¸€äº›å‘½åçº¦å®šã€‚å¯¹äºå¸ƒå±€è§„åˆ™ï¼Œåº”åœ¨ç±»åå‰é¢åŠ ä¸Š l- æˆ– layout- ã€‚å¯¹äºçŠ¶æ€è§„åˆ™ï¼Œåº”åœ¨æè¿°çŠ¶æ€çš„ç±»åï¼ˆå¦‚ is-hidden æˆ– is-collapsed ï¼‰å‰é¢æ·»åŠ å‰ç¼€ã€‚\nä¸ OOCSS ç›¸æ¯”ï¼ŒSMACSS çš„æ–¹æ³•æœ‰æ›´å¤šçš„ç»†èŠ‚ï¼Œä½†åœ¨å†³å®šå“ªäº› CSS è§„åˆ™åº”è¯¥å½’å…¥å“ªä¸ªç±»åˆ«æ—¶ï¼Œå®ƒä»ç„¶éœ€è¦ä»”ç»†è€ƒè™‘ã€‚åæ¥åƒ BEM è¿™æ ·çš„æ–¹æ³•å–æ¶ˆäº†ä¸€äº›å†³ç­–ï¼Œä½¿å…¶æ›´å®¹æ˜“é‡‡ç”¨ã€‚\nBEM BEMï¼ˆå—ï¼Œå…ƒç´ ï¼Œä¿®é¥°ç¬¦ï¼‰äº 2010 å¹´æ¨å‡ºï¼Œä½œä¸ºä¸€ç§å›´ç»•å°†ç”¨æˆ·ç•Œé¢åˆ’åˆ†ä¸ºç‹¬ç«‹å—çš„æƒ³æ³•ç»„ç»‡çš„æ–¹æ³•ã€‚å—æ˜¯å¯é‡ç”¨çš„ç»„ä»¶ï¼ˆä¾‹å¦‚æœç´¢è¡¨å•ï¼Œå®šä¹‰ä¸º \u0026lt;form class=\u0026quot;search-form\u0026quot;\u0026gt;\u0026lt;/form\u0026gt; ï¼‰ã€‚å…ƒç´ æ˜¯å—çš„è¾ƒå°éƒ¨åˆ†ï¼Œä¸èƒ½å•ç‹¬é‡ç”¨ï¼ˆä¾‹å¦‚æœç´¢è¡¨å•ä¸­çš„æŒ‰é’®ï¼Œå®šä¹‰ä¸º \u0026lt;button class=\u0026quot;search-form__button\u0026quot;\u0026gt;Search\u0026lt;/button\u0026gt; ï¼‰ã€‚ä¿®é¥°ç¬¦æ˜¯å®šä¹‰å—æˆ–å…ƒç´ çš„å¤–è§‚ã€çŠ¶æ€æˆ–è¡Œä¸ºçš„å®ä½“ï¼ˆä¾‹å¦‚ï¼Œå®šä¹‰ä¸º \u0026lt;button class=\u0026quot;search-form__button search-form__button--disabled\u0026quot;\u0026gt;Search\u0026lt;/button\u0026gt; çš„ç¦ç”¨æœç´¢è¡¨å•æŒ‰é’®ï¼‰ã€‚\nBEM æ–¹æ³•æ˜“äºç†è§£ï¼Œå…·æœ‰ç‰¹å®šçš„å‘½åçº¦å®šï¼Œå…è®¸æ–°æ‰‹åº”ç”¨å®ƒï¼Œè€Œæ— éœ€åšå‡ºå¤æ‚çš„å†³ç­–ã€‚æŸäº›äººçš„ç¼ºç‚¹æ˜¯ç±»åå¯èƒ½éå¸¸å†—é•¿ï¼Œå¹¶ä¸”ä¸éµå¾ª ç¼–å†™è¯­ä¹‰ç±»å çš„ä¼ ç»Ÿè§„åˆ™ã€‚åæ¥çš„æ–¹æ³•ï¼Œå¦‚ Atomic CSSï¼Œå°†æŠŠè¿™ç§éä¼ ç»Ÿçš„æ–¹æ³•å¸¦åˆ°ä¸€ä¸ªå…¨æ–°çš„å±‚æ¬¡ï¼\nAtomic CSS Atomic CSSï¼ˆä¹Ÿç§°ä¸ºå‡½æ•°å¼ CSSï¼‰äº 2014 å¹´æ¨å‡ºï¼Œä½œä¸ºä¸€ç§å›´ç»•åˆ›å»ºå°å‹å•ä¸€ç”¨é€”ç±»ï¼ˆåç§°åŸºäºè§†è§‰åŠŸèƒ½ï¼‰çš„æƒ³æ³•è¿›è¡Œç»„ç»‡çš„æ–¹æ³•ã€‚è¿™ç§æ–¹æ³•ä¸ OOCSSï¼ŒSMACS S å’Œ BEM å®Œå…¨ç›¸å - Atomic CSS ä¸æ˜¯å°†é¡µé¢ä¸Šçš„å…ƒç´ è§†ä¸ºå¯é‡ç”¨çš„å¯¹è±¡ï¼Œè€Œæ˜¯å®Œå…¨å¿½ç•¥è¿™äº›å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨å¯é‡ç”¨çš„å•ä¸€ç”¨é€”å®ç”¨ç¨‹åºç±»æ¥è®¾ç½®æ¯ä¸ªå…ƒç´ çš„æ ·å¼ã€‚å› æ­¤ï¼Œæ‚¨å°†æ‹¥æœ‰ç±»ä¼¼ \u0026lt;button class=\u0026quot;f6 br3 ph3 pv2 white bg-purple hover-bg-light-purple\u0026quot;\u0026gt;Search\u0026lt;/button\u0026gt; çš„ä¸œè¥¿ï¼Œè€Œä¸æ˜¯ \u0026lt;button class=\u0026quot;search-form__button\u0026quot;\u0026gt;Search\u0026lt;/button\u0026gt; ä¹‹ç±»çš„ä¸œè¥¿ã€‚\nå¦‚æœä½ å¯¹è¿™ä¸ªä¾‹å­çš„ç¬¬ä¸€ååº”æ˜¯æƒŠæåœ°é€€ç¼©ï¼Œä½ å¹¶ä¸å­¤å•â€”â€”è®¸å¤šäººè®¤ä¸ºè¿™ç§æ–¹æ³•å®Œå…¨è¿åäº†æ—¢å®šçš„ CSS æœ€ä½³å®è·µã€‚ä½†æ˜¯ï¼Œå›´ç»•è´¨ç–‘è¿™äº›æœ€ä½³å®è·µåœ¨ä¸åŒåœºæ™¯ä¸­çš„æœ‰æ•ˆæ€§çš„æƒ³æ³•ï¼Œå·²ç»æœ‰å¾ˆå¤šå¾ˆå¥½çš„è®¨è®ºã€‚æœ¬æ–‡å¾ˆå¥½åœ°å¼ºè°ƒäº†ä¼ ç»Ÿçš„å…³æ³¨ç‚¹åˆ†ç¦»æœ€ç»ˆå¦‚ä½•åˆ›å»ºä¾èµ–äº HTML çš„ CSSï¼ˆå³ä½¿ä½¿ç”¨ BEM ç­‰æ–¹æ³•ï¼‰ï¼Œè€ŒåŸå­æˆ–å‡½æ•°å¼æ–¹æ³•æ˜¯åˆ›å»ºä¾èµ–äº CSS çš„ HTMLã€‚ä¸¤è€…éƒ½æ²¡æœ‰é”™ï¼Œä½†ä»”ç»†æ£€æŸ¥åï¼Œæ‚¨ä¼šå‘ç° CSS å’Œ HTML ä¹‹é—´çš„çœŸæ­£å…³æ³¨ç‚¹åˆ†ç¦»æ°¸è¿œæ— æ³•å®Œå…¨å®ç°ï¼\nå…¶ä»– CSS æ–¹æ³•è®ºï¼Œå¦‚ JS ä¸­çš„ CSS ï¼Œå®é™…ä¸Šæ¥å—äº† CSS å’Œ HTML å°†å§‹ç»ˆç›¸äº’ä¾èµ–çš„æ¦‚å¿µï¼Œå¯¼è‡´äº†è¿„ä»Šä¸ºæ­¢æœ€å…·äº‰è®®çš„æ–¹æ³•ä¹‹ä¸€ã€‚\nJS ä¸­çš„ CSS JS ä¸­çš„ CSS äº 2014 å¹´å¼•å…¥ï¼Œä½œä¸ºä¸€ç§å›´ç»•å®šä¹‰ CSS æ ·å¼è€Œä¸æ˜¯åœ¨å•ç‹¬çš„æ ·å¼è¡¨ä¸­è€Œæ˜¯ç›´æ¥åœ¨æ¯ä¸ªç»„ä»¶æœ¬èº«ä¸­å®šä¹‰çš„æ–¹æ³•ã€‚å®ƒæ˜¯ä½œä¸º React JavaScript æ¡†æ¶ çš„ä¸€ç§æ–¹æ³•å¼•å…¥çš„ï¼ˆå®ƒå·²ç»é‡‡ç”¨äº†æœ‰äº‰è®®çš„æ–¹æ³•ï¼Œå³ç›´æ¥åœ¨ JavaScript ä¸­å®šä¹‰ç»„ä»¶çš„ HTMLï¼Œè€Œä¸æ˜¯å•ç‹¬çš„ HTML æ–‡ä»¶ï¼‰ã€‚æœ€åˆè¯¥æ–¹æ³•ä½¿ç”¨å†…è”æ ·å¼ï¼Œä½†åæ¥çš„å®ç°ä½¿ç”¨ JavaScript ç”Ÿæˆ CSSï¼ˆå…·æœ‰åŸºäºç»„ä»¶çš„å”¯ä¸€ç±»åï¼‰å¹¶å°†å…¶æ’å…¥åˆ°å¸¦æœ‰æ ·å¼æ ‡ç­¾çš„æ–‡æ¡£ä¸­ã€‚\nJS æ–¹æ³•ä¸­çš„ CSS å†æ¬¡å®Œå…¨è¿èƒŒäº†æ—¢å®šçš„ CSS å…³æ³¨ç‚¹åˆ†ç¦»æœ€ä½³å®è·µã€‚è¿™æ˜¯å› ä¸ºéšç€æ—¶é—´çš„æ¨ç§»ï¼Œæˆ‘ä»¬ä½¿ç”¨ç½‘ç»œçš„æ–¹å¼å‘ç”Ÿäº†å·¨å¤§å˜åŒ–ã€‚æœ€åˆï¼Œ Web ä¸»è¦ç”±é™æ€ç½‘ç«™ç»„æˆ - åœ¨è¿™é‡Œï¼ŒHTML å†…å®¹ä¸ CSS è¡¨ç¤ºçš„åˆ†ç¦»å¾ˆæœ‰æ„ä¹‰ã€‚å¦‚ä»Šï¼ŒWeb ç”¨äºåˆ›å»ºåŠ¨æ€ Web åº”ç”¨ç¨‹åº - åœ¨è¿™é‡Œï¼Œé€šè¿‡å¯é‡ç”¨çš„ç»„ä»¶å°†äº‹ç‰©åˆ†ç¦»å‡ºæ¥æ˜¯æœ‰æ„ä¹‰çš„ã€‚\nJS ä¸­çš„ CSS çš„ç›®æ ‡æ˜¯èƒ½å¤Ÿå®šä¹‰å…·æœ‰ç¡¬è¾¹ç•Œçš„ç»„ä»¶ï¼Œè¿™äº›è¾¹ç•Œç”±å®ƒä»¬è‡ªå·±å°è£…çš„ HTML/CSS/JS ç»„æˆï¼Œè¿™æ ·ä¸€ä¸ªç»„ä»¶ä¸­çš„ CSS å°±æ²¡æœ‰æœºä¼šå½±å“ä»»ä½•å…¶ä»–ç»„ä»¶ã€‚React æ˜¯æœ€æ—©è¢«å¹¿æ³›é‡‡ç”¨çš„æ¡†æ¶ä¹‹ä¸€ï¼Œå®ƒæ¨åŠ¨äº†è¿™äº›å…·æœ‰ç¡¬è¾¹ç•Œçš„ç»„ä»¶ï¼Œå½±å“äº†å…¶ä»–ä¸»è¦æ¡†æ¶ï¼Œå¦‚ Angularã€Ember å’Œ Vue.js æ•ˆä»¿ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒJS æ–¹æ³•ä¸­çš„ CSS æ˜¯ç›¸å¯¹è¾ƒæ–°çš„ï¼Œåœ¨è¿™ä¸ªé¢†åŸŸæœ‰å¾ˆå¤šå®éªŒæ­£åœ¨è¿›è¡Œï¼Œå› ä¸ºå¼€å‘äººå‘˜è¯•å›¾åœ¨ Web åº”ç”¨ç¨‹åºç»„ä»¶æ—¶ä»£ä¸º CSS å»ºç«‹æ–°çš„æœ€ä½³å®è·µã€‚\nå¾ˆå®¹æ˜“è¢«è®¸å¤šä¸åŒçš„ CSS æ–¹æ³•æ‰€æ·¹æ²¡ï¼Œä½†é‡è¦çš„æ˜¯è¦è®°ä½ï¼Œæ²¡æœ‰ä¸€ç§æ­£ç¡®çš„æ–¹æ³• - ä½ åº”è¯¥å°†å®ƒä»¬è§†ä¸ºä¸åŒçš„å¯èƒ½å·¥å…·ï¼Œå½“ä½ æœ‰ä¸€ä¸ªè¶³å¤Ÿå¤æ‚çš„ CSS ä»£ç åº“æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ã€‚æœ‰ä¸åŒçš„ç»è¿‡æ·±æ€ç†Ÿè™‘çš„é€‰é¡¹å¯ä¾›é€‰æ‹©ï¼Œä»é•¿è¿œæ¥çœ‹ï¼Œè¿™ä¸ªé¢†åŸŸå‘ç”Ÿçš„æ‰€æœ‰å®éªŒéƒ½ä¼šä½¿æ¯ä¸ªå¼€å‘äººå‘˜å—ç›Šï¼\nç»“è®º ç®€è€Œè¨€ä¹‹ï¼Œè¿™å°±æ˜¯ç°ä»£ CSSã€‚æˆ‘ä»¬ä»‹ç»äº†ä½¿ç”¨ CSS è¿›è¡Œå…·æœ‰æ’ç‰ˆå±æ€§çš„åŸºæœ¬æ ·å¼ï¼Œä½¿ç”¨ CSS è¿›è¡Œå¸ƒå±€ï¼ˆä½¿ç”¨åŸºäºæµ®ç‚¹ã€å¼¹æ€§æ¡†å’Œç½‘æ ¼çš„æ–¹æ³•ï¼‰ï¼Œä½¿ç”¨ CSS é¢„å¤„ç†å™¨å¤„ç†æ–°è¯­æ³•ï¼ˆå¦‚å˜é‡å’Œ mixinsï¼‰ï¼Œä½¿ç”¨ CSS åå¤„ç†å™¨å®ç°å˜é©æ€§åŠŸèƒ½ï¼ˆå¦‚æ·»åŠ ä¾›åº”å•†å‰ç¼€ï¼‰ï¼Œä»¥åŠä½¿ç”¨ CSS æ–¹æ³•å®ç°å¯ç»´æŠ¤æ€§ä»¥å…‹æœ CSS æ ·å¼çš„å…¨å±€æ€§è´¨ã€‚æˆ‘ä»¬æ²¡æœ‰æœºä¼šæ·±å…¥ç ”ç©¶ CSS æä¾›çš„è®¸å¤šå…¶ä»–åŠŸèƒ½ï¼Œä¾‹å¦‚é«˜çº§é€‰æ‹©å™¨ï¼Œè¿‡æ¸¡ï¼ŒåŠ¨ç”»ï¼Œå½¢çŠ¶ï¼ŒåŠ¨æ€å˜é‡ - åˆ—è¡¨ä¸èƒœæšä¸¾ã€‚CSS æœ‰å¾ˆå¤šå†…å®¹éœ€è¦æ¶µç›– - ä»»ä½•è¯´å®ƒå¾ˆå®¹æ˜“çš„äººå¯èƒ½éƒ½ä¸çŸ¥é“å®ƒçš„ä¸€åŠï¼\nç°ä»£ CSS çš„ä½¿ç”¨è‚¯å®šä¼šä»¤äººæ²®ä¸§ï¼Œå› ä¸ºå®ƒç»§ç»­å¿«é€Ÿå˜åŒ–å’Œå‘å±•ã€‚ä½†é‡è¦çš„æ˜¯è¦è®°ä½ Web å¦‚ä½•éšç€æ—¶é—´çš„æ¨ç§»è€Œå‘å±•çš„å†å²èƒŒæ™¯ï¼Œå¾ˆé«˜å…´çŸ¥é“æœ‰å¾ˆå¤šèªæ˜çš„äººæ„¿æ„æ„å»ºå…·ä½“çš„å·¥å…·å’Œæ–¹æ³•æ¥å¸®åŠ© CSS æœ€ä½³å®è·µä¸ Web ä¸€èµ·å‘å±•ã€‚ä½œä¸ºä¸€åå¼€å‘äººå‘˜ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¿€åŠ¨äººå¿ƒçš„æ—¶åˆ»ï¼Œæˆ‘å¸Œæœ›è¿™äº›ä¿¡æ¯å¯ä»¥ä½œä¸ºè·¯çº¿å›¾ï¼Œåœ¨æ‚¨çš„æ—…ç¨‹ä¸­ä¸ºæ‚¨æä¾›å¸®åŠ©ï¼\nå†æ¬¡ç‰¹åˆ«æ„Ÿè°¢ @ryanqnorth çš„ æé¾™æ¼«ç”»ï¼Œè‡ª 2003 å¹´ä»¥æ¥ï¼ˆå½“æé¾™ç»Ÿæ²»ç½‘ç»œæ—¶ï¼‰ï¼Œå®ƒæä¾›äº†ä¸€äº›æœ€å¥½çš„è’è¯å¹½é»˜ã€‚\nåŸæ–‡é“¾æ¥ï¼šhttps://peterxjang.com/blog/modern-css-explained-for-dinosaurs.html\n","permalink":"https://blog.chensoul.cc/posts/2023/06/21/modern-css-explained-for-dinosaurs/","summary":"å¥‡æ€ªçš„æ˜¯ï¼ŒCSS è¢«è®¤ä¸ºæ˜¯ä½œä¸º Web å¼€å‘äººå‘˜æœ€å®¹æ˜“å­¦ä¹ å’Œæœ€éš¾å­¦ä¹ çš„è¯­è¨€ä¹‹ä¸€ã€‚å¼€å§‹ä½¿ç”¨å®ƒå½“ç„¶å¾ˆå®¹æ˜“ - æ‚¨å¯ä»¥å®šä¹‰æ ·å¼å±æ€§å’Œå€¼ä»¥åº”ç”¨äºç‰¹å®šå…ƒç´ ï¼Œç„¶å\u0026hellip;\u0026hellip;è¿™å‡ ä¹å°±æ˜¯æ‚¨å¼€å§‹æ‰€éœ€çš„ä¸€åˆ‡ï¼ä½†æ˜¯ï¼Œå¯¹äºå¤§å‹é¡¹ç›®ï¼Œä»¥æœ‰æ„ä¹‰çš„æ–¹å¼ç»„ç»‡ CSS ä¼šå˜å¾—çº ç»“å’Œå¤æ‚ã€‚æ›´æ”¹ä»»ä½•ä¸€è¡Œ CSS ä»¥è®¾ç½®ä¸€ä¸ªé¡µé¢ä¸Šå…ƒç´ çš„æ ·å¼é€šå¸¸ä¼šå¯¼è‡´å…¶ä»–é¡µé¢ä¸Šçš„å…ƒç´ å‘ç”Ÿæ„å¤–æ›´æ”¹ã€‚\nä¸ºäº†å¤„ç† CSS å›ºæœ‰çš„å¤æ‚æ€§ï¼Œå·²ç»å»ºç«‹äº†å„ç§ä¸åŒçš„æœ€ä½³å®è·µã€‚é—®é¢˜åœ¨äºï¼Œå¯¹äºå“ªäº›æœ€ä½³å®è·µå®é™…ä¸Šæ˜¯æœ€å¥½çš„ï¼Œæ²¡æœ‰ä»»ä½•å¼ºçƒˆçš„å…±è¯†ï¼Œå…¶ä¸­è®¸å¤šä¼¼ä¹å®Œå…¨ç›¸äº’çŸ›ç›¾ã€‚å¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡å°è¯•å­¦ä¹  CSSï¼Œè‡³å°‘å¯ä»¥è¯´è¿™å¯èƒ½ä¼šè®©äººè¿·å¤±æ–¹å‘ã€‚\næœ¬æ–‡çš„ç›®çš„æ˜¯æä¾›ä¸€ä¸ªå†å²èƒŒæ™¯ï¼Œè¯´æ˜ CSS æ–¹æ³•å’Œå·¥å…·å¦‚ä½•åœ¨ 2018 å¹´å‘å±•åˆ°ä»Šå¤©çš„æ ·å­ã€‚é€šè¿‡äº†è§£è¿™æ®µå†å²ï¼Œå°†æ›´å®¹æ˜“ç†è§£æ¯ç§æ–¹æ³•ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒä»¬æ¥ä¸ºæ‚¨å¸¦æ¥å¥½å¤„ã€‚è®©æˆ‘ä»¬å¼€å§‹å§ï¼\næ›´æ–°ï¼šæˆ‘åˆ¶ä½œäº†æœ¬æ–‡çš„æ–°è§†é¢‘è¯¾ç¨‹ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬æ›´æ·±å…¥åœ°ä»‹ç»äº†ææ–™ï¼Œè¯·åœ¨æ­¤å¤„æŸ¥çœ‹ï¼š https://firstclass.actualize.co/p/modern-css-explained-for-dinosaurs\nä½¿ç”¨ CSS è¿›è¡ŒåŸºæœ¬æ ·å¼è®¾ç½® è®©æˆ‘ä»¬ä»ä¸€ä¸ªåŸºæœ¬ç½‘ç«™å¼€å§‹ï¼Œä»…ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ index.html æ–‡ä»¶é“¾æ¥åˆ°ä¸€ä¸ªå•ç‹¬çš„ index.css æ–‡ä»¶ï¼š\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Modern CSS\u0026lt;/title\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;index.css\u0026#34; /\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;header\u0026gt;This is the header.\u0026lt;/header\u0026gt; \u0026lt;main\u0026gt; \u0026lt;h1\u0026gt;This is the main content.\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;...\u0026lt;/p\u0026gt; \u0026lt;/main\u0026gt; \u0026lt;nav\u0026gt; \u0026lt;h4\u0026gt;This is the navigation section.\u0026lt;/h4\u0026gt; \u0026lt;p\u0026gt;...\u0026lt;/p\u0026gt; \u0026lt;/nav\u0026gt; \u0026lt;aside\u0026gt; \u0026lt;h4\u0026gt;This is an aside section.\u0026lt;/h4\u0026gt; \u0026lt;p\u0026gt;...\u0026lt;/p\u0026gt; \u0026lt;/aside\u0026gt; \u0026lt;footer\u0026gt;This is the footer.\u0026lt;/footer\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ç°åœ¨æˆ‘ä»¬åœ¨ HTML ä¸­æ²¡æœ‰ä½¿ç”¨ä»»ä½•ç±»æˆ– IDï¼Œåªæ˜¯ è¯­ä¹‰æ ‡ç­¾ã€‚æ²¡æœ‰ä»»ä½• CSSï¼Œç½‘ç«™çœ‹èµ·æ¥åƒè¿™æ ·ï¼ˆä½¿ç”¨å ä½ç¬¦æ–‡æœ¬ï¼‰ï¼š\nåŠŸèƒ½é½å…¨ï¼Œä½†ä¸æ˜¯å¾ˆæ¼‚äº®ã€‚æˆ‘ä»¬å¯ä»¥æ·»åŠ  CSS æ¥æ”¹è¿› index.css ä¸­çš„åŸºæœ¬æ’ç‰ˆï¼š\n/* BASIC TYPOGRAPHY */ /* from https://github.com/oxalorg/sakura */ html { font-size: 62.","title":"[è¯‘]ä¸ºæé¾™è§£é‡Šç°ä»£CSS"},{"content":" åœ¨ä¸‰ç§ä¸»è¦çš„å‰ç«¯æŠ€æœ¯ï¼ˆ HTMLï¼ŒCSS å’Œ JavaScript ï¼‰ä¸­ï¼ŒHTML ä»ç„¶æ˜¯æœ€ä¸€è‡´çš„ã€‚å¦‚æœæ‚¨å”¯ä¸€å…³å¿ƒçš„æ˜¯åˆ›å»ºå†…å®¹ï¼Œé‚£ä¹ˆ 1990 å¹´ä»£çš„ HTML æ–‡æ¡£çœ‹èµ·æ¥ä¸ 2018 å¹´åˆ›å»ºçš„æ–‡æ¡£éå¸¸ç›¸ä¼¼ï¼š\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;My test page\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;Hello there!\u0026lt;/h1\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ä½ æœ‰å¸¦æœ‰æ ‡ç­¾å’Œå†…å®¹çš„å…ƒç´ ï¼Œå¸¦æœ‰å±æ€§çš„æ ‡ç­¾â€”â€”é™¤äº†ç¬¬ä¸€è¡Œçš„ç®€åŒ–æ–‡æ¡£ç±»å‹å¤–ï¼Œæ²¡æœ‰å¤ªå¤§å˜åŒ–ï¼ç„¶è€Œï¼Œå¤šå¹´æ¥ï¼ŒWeb å¼€å‘å·²ç»å‘ç”Ÿäº†å·¨å¤§çš„è½¬å˜ï¼Œä»åˆ›å»ºé™æ€ç½‘ç«™ï¼ˆä¸“æ³¨äºå†…å®¹ï¼‰åˆ°åˆ›å»ºåŠ¨æ€ Web åº”ç”¨ç¨‹åºï¼ˆä¸“æ³¨äºäº¤äº’ï¼‰â€”â€”è¿™æ˜¯ Web æœ€åˆè®¾è®¡çš„ç›®çš„ã€‚åˆ›å»ºä»ç„¶è¯­ä¹‰å’Œå¯è®¿é—®çš„è‡ªå®šä¹‰ç”¨æˆ·ç•Œé¢ï¼Œä½¿ç”¨å±æ€§å’Œå·¥å…·æé«˜æ€§èƒ½ï¼Œç»„ç»‡ä»£ç ä»¥è¿›è¡Œé‡ç”¨å’Œå¯ç»´æŠ¤æ€§ - ç°åœ¨æœ‰ä¸€ç»„å…¨æ–°çš„é—®é¢˜åœ¨èµ·ä½œç”¨ã€‚\næœ¬æ–‡çš„ç›®çš„æ˜¯æä¾›ä¸€ä¸ªå†å²èƒŒæ™¯ï¼Œè¯´æ˜ HTML å¦‚ä½•åœ¨ 2018 å¹´æ¼”å˜æˆä»Šå¤©çš„è¯­è¨€ã€‚æˆ‘ä»¬å°†ä»ç»“æ„è‰¯å¥½ä¸”æ˜“äºè®¿é—®çš„ HTML çš„åŸºç¡€çŸ¥è¯†å¼€å§‹ï¼Œå°±åƒå¤ä»£çš„æé¾™ä¸€æ ·ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¸åŒçš„æŠ€æœ¯æ¥æé«˜æ€§èƒ½ã€å“åº”èƒ½åŠ›å’Œå¯ç»´æŠ¤æ€§ã€‚CSS å’Œ JavaScript å°†ä¸å¯é¿å…åœ°è¿›å…¥è¿™ä¸ªå¯¹è¯ï¼›å‡ºäºæœ¬æ–‡çš„ç›®çš„ï¼Œå°†ä»å®ƒä»¬å¦‚ä½•å½±å“ HTML æœ¬èº«ç¼–å†™çš„è§’åº¦æ¥ä»‹ç»å®ƒä»¬ã€‚é€šè¿‡äº†è§£è¿™æ®µå†å²ï¼Œæ‚¨å°†èƒ½å¤Ÿå……åˆ†åˆ©ç”¨è¯¥è¯­è¨€ç»å¸¸è¢«å¿½è§†çš„æ–°æ—§åŠŸèƒ½ã€‚è®©æˆ‘ä»¬å¼€å§‹å§ï¼\nä½¿ç”¨è¯­ä¹‰å…ƒç´ ç¼–å†™å†…å®¹ è®©æˆ‘ä»¬å‘å‰é¢çš„ HTML ç¤ºä¾‹æ·»åŠ æ›´å¤šå†…å®¹ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåŸºæœ¬ç½‘ç«™ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªå¸¦æœ‰é“¾æ¥å’Œæœç´¢è¾“å…¥çš„å¯¼èˆªéƒ¨åˆ†ï¼Œä¸€ä¸ªç”¨äºæ˜¾ç¤ºä¸€èˆ¬ç½‘ç«™ä¿¡æ¯çš„å¤§å‹å±•ç¤ºéƒ¨åˆ†ï¼ˆé€šå¸¸ç§°ä¸ºè‹±é›„éƒ¨åˆ†æˆ– å·¨å‹å±å¹• ï¼‰ï¼Œæ–‡ç« çš„ä¸‰åˆ—éƒ¨åˆ†å’Œä¸€ä¸ªç‰ˆæƒä¿¡æ¯çš„é¡µè„šéƒ¨åˆ†ã€‚\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;My test page\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div class=\u0026#34;navbar\u0026#34;\u0026gt; \u0026lt;ul\u0026gt; \u0026lt;li\u0026gt; \u0026lt;a href=\u0026#34;#\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;li\u0026gt; \u0026lt;a href=\u0026#34;#\u0026#34;\u0026gt;Info\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;li\u0026gt; \u0026lt;a href=\u0026#34;#\u0026#34;\u0026gt;About\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;form\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; placeholder=\u0026#34;Search\u0026#34; /\u0026gt; \u0026lt;button type=\u0026#34;submit\u0026#34;\u0026gt;Search\u0026lt;/button\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;main\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;hero\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;Hello there!\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;General info about the page goes here\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;a href=\u0026#34;#\u0026#34;\u0026gt;Learn more\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;grid\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;column\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;First Heading\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;Article content goes here\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;a href=\u0026#34;#\u0026#34;\u0026gt;View details\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;column\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;Second Heading\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;Article content goes here\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;a href=\u0026#34;#\u0026#34;\u0026gt;View details\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;column\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;Third Heading\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;Article content goes here\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;a href=\u0026#34;#\u0026#34;\u0026gt;View details\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;footer\u0026#34;\u0026gt; \u0026lt;p\u0026gt;Copyright info goes here\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨å¸¦æœ‰ \u0026lt;div\u0026gt; ã€ \u0026lt;h1\u0026gt; ã€ \u0026lt;h2\u0026gt; ã€ \u0026lt;p\u0026gt; ç­‰æ ‡ç­¾çš„åŸºæœ¬å…ƒç´ æ¥æ ‡è®°å†…å®¹ã€‚è¿™é‡Œçš„ HTML æ˜¯æœ‰æ•ˆçš„ï¼Œä½†å®ƒä¸æ˜¯å®Œå…¨è¯­ä¹‰çš„â€”â€”ä¹Ÿå°±æ˜¯è¯´ï¼Œæ ‡ç­¾ä¸èƒ½å°½å¯èƒ½åœ°ä¼ è¾¾å†…å®¹çš„å«ä¹‰ã€‚\nå½“ HTML5 åœ¨ 2008 å¹´æ¨å‡ºæ—¶ï¼Œå®ƒæä¾›äº†æ–°çš„å…ƒç´ æ¥æ”¹è¿›æ–‡æ¡£è¯­ä¹‰ã€‚ä»¥ä¸‹æ˜¯ä½¿ HTML æ›´å…·è¯­ä¹‰æ€§çš„å°è¯•ï¼š\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34; /\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1, shrink-to-fit=no\u0026#34; /\u0026gt; \u0026lt;meta name=\u0026#34;description\u0026#34; content=\u0026#34;\u0026#34; /\u0026gt; \u0026lt;meta name=\u0026#34;author\u0026#34; content=\u0026#34;\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;My test page\u0026lt;/title\u0026gt; \u0026lt;!--[if lt IE 9]\u0026gt; \u0026lt;script src=\u0026#34;(https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;![endif]--\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;nav role=\u0026#34;navigation\u0026#34;\u0026gt; \u0026lt;ul\u0026gt; \u0026lt;li\u0026gt; \u0026lt;a href=\u0026#34;#\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;li\u0026gt; \u0026lt;a href=\u0026#34;#\u0026#34;\u0026gt;Info\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;li\u0026gt; \u0026lt;a href=\u0026#34;#\u0026#34;\u0026gt;About\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;form\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; placeholder=\u0026#34;Search\u0026#34; /\u0026gt; \u0026lt;button type=\u0026#34;submit\u0026#34;\u0026gt;Search\u0026lt;/button\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/nav\u0026gt; \u0026lt;main role=\u0026#34;main\u0026#34;\u0026gt; \u0026lt;section class=\u0026#34;hero\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;Hello there!\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;General info about the page goes here\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;a href=\u0026#34;#\u0026#34;\u0026gt;Learn more\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/section\u0026gt; \u0026lt;section class=\u0026#34;grid\u0026#34;\u0026gt; \u0026lt;article class=\u0026#34;column\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;First Heading\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;Article content goes here\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;a href=\u0026#34;#\u0026#34;\u0026gt;View details\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/article\u0026gt; \u0026lt;article class=\u0026#34;column\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;Second Heading\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;Article content goes here\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;a href=\u0026#34;#\u0026#34;\u0026gt;View details\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/article\u0026gt; \u0026lt;article class=\u0026#34;column\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;Third Heading\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;Article content goes here\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;a href=\u0026#34;#\u0026#34;\u0026gt;View details\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/article\u0026gt; \u0026lt;/section\u0026gt; \u0026lt;/main\u0026gt; \u0026lt;footer role=\u0026#34;contentinfo\u0026#34;\u0026gt; \u0026lt;p\u0026gt;Copyright info goes here\u0026lt;/p\u0026gt; \u0026lt;/footer\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; è®©æˆ‘ä»¬æ¥çœ‹çœ‹å…¶ä¸­çš„ä¸€äº›å˜åŒ–ï¼š\n\u0026lt;html lang=\u0026quot;en\u0026quot;\u0026gt; æŒ‡å®šæ–‡æ¡£çš„è¯­è¨€ï¼Œè¿™æœ‰åŠ©äºæœç´¢å¼•æ“å’Œæµè§ˆå™¨è¯†åˆ«é€‚å½“çš„å†…å®¹ã€‚ é¢å¤–çš„ \u0026lt;meta\u0026gt; æ ‡è®°æä¾›æœ‰å…³æœç´¢å¼•æ“å’Œå…¶ä»–æœåŠ¡åœ¨é¡µé¢ä¸Šä¸ç›´æ¥å¯è§çš„ç½‘ç«™çš„ä¿¡æ¯ã€‚å®ƒä»¬è¿˜æä¾›æœ‰å…³å¦‚ä½•è°ƒæ•´ä¸åŒè®¾å¤‡ä¸Šçš„å†…å®¹å¤§å°çš„ä¿¡æ¯ã€‚ \u0026lt;nav\u0026gt; ã€ \u0026lt;main\u0026gt; ã€ \u0026lt;section\u0026gt; ã€ \u0026lt;article\u0026gt; å’Œ \u0026lt;footer\u0026gt; æ ‡è®°ä¸º HTML æ–‡æ¡£æä¾›äº†æ›´æ˜“äºè®¿é—®çš„ç»“æ„ï¼ˆä¸é€šç”¨çš„ \u0026lt;div\u0026gt; æ ‡è®°ç›¸æ¯”ï¼‰ã€‚è¿™äº›æ ‡ç­¾æ˜¯åœ¨ HTML5 ä¸­å¼•å…¥çš„ã€‚ \u0026lt;!-- [if lt IE 9]\u0026gt;...--\u0026gt; æ³¨é‡Šæ·»åŠ äº†ä¸€ä¸ª JavaScript æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä»…é€‚ç”¨äºæ—§ç‰ˆæœ¬çš„ Internet Explorerï¼Œå› ä¸ºå®ƒä»¬ä¸æ”¯æŒä¸Šè¿° HTML5 æ ‡ç­¾ã€‚è¯·æ³¨æ„ï¼Œå¦‚ä»Šè®¸å¤šæœ€è¿‘çš„ç½‘ç«™éƒ½æ²¡æœ‰åŒ…å«è¯¥è¯„è®ºï¼Œå› ä¸ºæ”¯æŒè¿™äº›æµè§ˆå™¨çš„ç½‘ç«™è¶Šæ¥è¶Šå°‘ã€‚ role å±æ€§è¿˜æä¾›è¾…åŠ©åŠŸèƒ½ä¿¡æ¯ã€‚è¯·æ³¨æ„ï¼Œä½¿ç”¨ \u0026lt;nav\u0026gt; æ ‡è®°é€šå¸¸è¶³ä»¥ç¡®ä¿å¯è®¿é—®æ€§ï¼Œå¦‚æœæ— æ³•è¯†åˆ« \u0026lt;nav\u0026gt; æ ‡è®°ï¼Œåˆ™ä½¿ç”¨é¢å¤–çš„ role=\u0026quot;navigation\u0026quot; ã€‚ ç¼–å†™è¯­ä¹‰ HTML ä¼¼ä¹å¹¶ä¸é‡è¦ï¼Œå°¤å…¶æ˜¯å½“å®ƒä¸å½±å“ç½‘ç«™çš„è§†è§‰å¤–è§‚æ—¶ã€‚ä½†æ˜¯ï¼Œæ‚¨çš„ç½‘ç«™ä¸ä»…è¢«äººç±»æŸ¥çœ‹ - ç½‘ç»œæµè§ˆå™¨ï¼Œæœç´¢å¼•æ“ï¼Œå±å¹•é˜…è¯»å™¨éƒ½ä¾èµ–äºè¯­ä¹‰ HTML æ‰èƒ½æ­£å¸¸è¿è¡Œã€‚\nä½¿ç”¨ WAI-ARIA å±æ€§æ”¹è¿›å¯è®¿é—®æ€§ è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸Šé¢ç¤ºä¾‹ä¸­å¯¼èˆªæ ä¸­çš„æœç´¢è¾“å…¥ï¼š\n\u0026lt;form\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; placeholder=\u0026#34;Search\u0026#34; /\u0026gt; \u0026lt;button type=\u0026#34;submit\u0026#34;\u0026gt;Search\u0026lt;/button\u0026gt; \u0026lt;/form\u0026gt; æ­¤è¾“å…¥å…ƒç´ ä½¿ç”¨ placeholder å±æ€§è€Œä¸æ˜¯æ ‡ç­¾å…ƒç´ è®©ç”¨æˆ·çŸ¥é“å…¶ç”¨é€”ã€‚è¿™é€‚ç”¨äºäººç±»ï¼Œä½†å®ƒä¸æ˜¯æ­£ç¡®çš„è¯­ä¹‰ HTMLï¼Œå±å¹•é˜…è¯»å™¨å’Œå…¶ä»–æŠ€æœ¯å¯èƒ½ä¼šé”™è¿‡ã€‚ä½¿å…¶å¯è®¿é—®çš„æ–¹æ³•æ˜¯ä½¿ç”¨ aria-label å±æ€§ï¼š\n\u0026lt;form\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; placeholder=\u0026#34;Search\u0026#34; aria-label=\u0026#34;Search\u0026#34; /\u0026gt; \u0026lt;button type=\u0026#34;submit\u0026#34;\u0026gt;Search\u0026lt;/button\u0026gt; \u0026lt;/form\u0026gt; WAI-ARIA ä»£è¡¨â€œWeb å¯è®¿é—®æ€§å€¡è®® â€” å¯è®¿é—®çš„å¯Œäº’è”ç½‘åº”ç”¨ç¨‹åºâ€ï¼ˆé€šå¸¸ç®€ç§°ä¸º ARIAï¼‰ï¼Œæ˜¯ä¸€ç»„å±æ€§ï¼Œå½“è¯­ä¹‰æ ‡è®°ä¸å¤Ÿæ—¶ï¼Œä½¿ HTML æ›´æ˜“äºè®¿é—®ã€‚ä¸Šä¸€èŠ‚ä¸­çœ‹åˆ°çš„ role å±æ€§æ˜¯ ARIA å±æ€§ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¿™äº›å±æ€§ä¼¼ä¹æ˜¯å¾ˆå°çš„å˜åŒ–ï¼Œä½†æ˜¯å½“æˆ‘ä»¬ä½¿ç”¨ HTML æ¥å¤„ç†åŸºæœ¬æ–‡æ¡£ä¹‹å¤–çš„äº‹æƒ…æ—¶ï¼Œå®ƒå˜å¾—æ›´åŠ é‡è¦ã€‚\nè®©æˆ‘ä»¬çœ‹ä¸€ä¸ªæ›´å¤æ‚çš„ä¾‹å­â€”â€”å‡è®¾æˆ‘ä»¬æƒ³åœ¨ HTML ä¸­æ·»åŠ ä¸€äº›é€‰é¡¹å¡å¼å†…å®¹ï¼Œä»¥æä¾›æœ‰å…³å¦‚ä½•åœ¨ Windowsï¼ŒMac å’Œ Linux ä¸Šå®‰è£…æŸäº›ç¨‹åºçš„è¯´æ˜ã€‚ç”±äºæ²¡æœ‰åœ¨ HTML ä¸­æ„å»ºé€‰é¡¹å¡çš„æœ¬æœºæ–¹æ³•ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»ä½¿ç”¨æ— åºåˆ—è¡¨ã€é“¾æ¥å’Œ div ä¹‹ç±»çš„ä¸œè¥¿æ¥æ„å»ºæˆ‘ä»¬è‡ªå·±çš„é€‰é¡¹å¡æ ‡è®°ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ role ã€ aria-controls ã€ aria-selected å’Œ aria-labelledby ç­‰å¯è®¿é—®æ€§å±æ€§æ¥æ ‡è®° HTMLï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\u0026lt;ul role=\u0026#34;tablist\u0026#34;\u0026gt; \u0026lt;li\u0026gt; \u0026lt;a id=\u0026#34;windows-tab\u0026#34; href=\u0026#34;#windows\u0026#34; role=\u0026#34;tab\u0026#34; aria-controls=\u0026#34;windows\u0026#34; aria-selected=\u0026#34;true\u0026#34; \u0026gt;Windows\u0026lt;/a \u0026gt; \u0026lt;/li\u0026gt; \u0026lt;li\u0026gt; \u0026lt;a id=\u0026#34;mac-tab\u0026#34; href=\u0026#34;#mac\u0026#34; role=\u0026#34;tab\u0026#34; aria-controls=\u0026#34;mac\u0026#34; aria-selected=\u0026#34;false\u0026#34; \u0026gt;Mac\u0026lt;/a \u0026gt; \u0026lt;/li\u0026gt; \u0026lt;li\u0026gt; \u0026lt;a id=\u0026#34;linux-tab\u0026#34; href=\u0026#34;#linux\u0026#34; role=\u0026#34;tab\u0026#34; aria-controls=\u0026#34;linux\u0026#34; aria-selected=\u0026#34;false\u0026#34; \u0026gt;Linux\u0026lt;/a \u0026gt; \u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;div\u0026gt; \u0026lt;div id=\u0026#34;windows\u0026#34; role=\u0026#34;tabpanel\u0026#34; aria-labelledby=\u0026#34;windows-tab\u0026#34;\u0026gt; \u0026lt;img src=\u0026#34;http://1000logos.net/wp-content/uploads/2017/04/Microsoft-Logo.png\u0026#34; alt=\u0026#34;microsoft logo\u0026#34; /\u0026gt; ... \u0026lt;/div\u0026gt; \u0026lt;div id=\u0026#34;mac\u0026#34; role=\u0026#34;tabpanel\u0026#34; aria-labelledby=\u0026#34;mac-tab\u0026#34;\u0026gt; \u0026lt;img src=\u0026#34;https://i.ytimg.com/vi/ipOzBWuYZvg/maxresdefault.jpg\u0026#34; alt=\u0026#34;apple logo\u0026#34; /\u0026gt; ... \u0026lt;/div\u0026gt; \u0026lt;div id=\u0026#34;linux\u0026#34; role=\u0026#34;tabpanel\u0026#34; aria-labelledby=\u0026#34;linux-tab\u0026#34;\u0026gt; \u0026lt;img src=\u0026#34;https://noware.tech/wp-content/uploads/sites/140/2018/04/linux-1024x565.jpg\u0026#34; alt=\u0026#34;linux logo\u0026#34; /\u0026gt; ... \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; å¦‚æœæ²¡æœ‰è¿™äº›è¾…åŠ©åŠŸèƒ½å±æ€§ï¼Œé€‰é¡¹å¡å¼å†…å®¹å°†ä¸é€‰é¡¹å¡æ§ä»¶æ²¡æœ‰å¯è¯†åˆ«çš„å…³ç³»ã€‚å…·æœ‰è¿™äº›å±æ€§æœ‰åŠ©äºå±å¹•é˜…è¯»å™¨è¯†åˆ«å†…å®¹ï¼Œå¯ç”¨å…·æœ‰æ­£ç¡®åˆ¶è¡¨ç¬¦çš„é”®ç›˜å¿«æ·é”®ç­‰ã€‚ä½¿ç”¨é€‚å½“çš„ ARIA å±æ€§æœ¬èº«å°±æ˜¯ä¸€é¡¹å®Œæ•´çš„ç ”ç©¶â€”â€”è¦æ›´æ·±å…¥åœ°äº†è§£ï¼Œè¯·æŸ¥çœ‹ å®˜æ–¹æŒ‡å—ã€‚\næ‰€æœ‰è¿™äº›ä¼¼ä¹éƒ½æ˜¯ä¸ºäº†æé«˜ç½‘ç«™çš„å¯è®¿é—®æ€§è€Œåšå¾ˆå¤šå·¥ä½œã€‚é‡è¦çš„æ˜¯è¦æ‰¿è®¤å¯è®¿é—®æ€§æ˜¯ç½‘ç»œçš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†ï¼Œç½‘ç»œè¢«è®¾è®¡ä¸ºä¸€ä¸ªä¸æ¯ä¸ªäººè‡ªç”±å…±äº«ä¿¡æ¯çš„å¹³å°ï¼Œè€Œä¸ä»…ä»…æ˜¯å°‘æ•°äººã€‚ä½¿ç½‘ç«™å¯è®¿é—®å¯ä»¥æ”¹å–„æ¯ä¸ªè®¿é—®è€…çš„ä½“éªŒ - ä¾‹å¦‚ï¼Œå¯è®¿é—®çš„é”®ç›˜å¿«æ·é”®å¯ä»¥å¸®åŠ©é‚£äº›æ°¸è¿œæ— æ³•ä½¿ç”¨é¼ æ ‡çš„äººï¼Œé‚£äº›æš‚æ—¶æ— æ³•ä½¿ç”¨é¼ æ ‡çš„äººï¼Œä»¥åŠé‚£äº›ä¸å–œæ¬¢ä¸ä½¿ç”¨é¼ æ ‡çš„äººï¼ˆä¹Ÿå°±æ˜¯å¤§å¤šæ•°ç¨‹åºå‘˜ï¼‰ã€‚åœ¨å¤„ç†å…¶ä»–åŠŸèƒ½æ—¶ï¼Œå¯è®¿é—®æ€§å¾ˆå®¹æ˜“è¢«å¿½è§†ï¼Œä½†ä¸åº”å¿½è§†ã€‚\nå¦‚æœæ‚¨æœ‰å…´è¶£æ”¹å–„ç½‘ç«™çš„å¯è®¿é—®æ€§ï¼Œé‚£ä¹ˆæœ‰ A11Y é¡¹ç›® ä¸­çš„æ¸…å•ï¼Œè¿™æ˜¯ ä¸€ä¸ª å¾ˆå¥½çš„èµ·ç‚¹ã€‚ç„¶è€Œï¼Œä½¿ç½‘ç«™å¯è®¿é—®ä¸ä»…ä»…æ˜¯æ£€æŸ¥é¡¹ç›®â€”â€”å®ƒæ€»æ˜¯å¯ä»¥æ”¹è¿›çš„ï¼Œå°±åƒç”¨æˆ·ä½“éªŒçš„ä»»ä½•æ–¹é¢ä¸€æ ·ã€‚ä½¿æ‚¨çš„ç½‘ç«™å¯è®¿é—®çš„æœ€ä½³æ–¹æ³•æ˜¯å®é™…ä½¿ç”¨æ‚¨çš„ç½‘ç«™ï¼Œå°±åƒå—ä¼—ä¸­çš„ä¸åŒäººä¸€æ · - ä½¿ç”¨å±å¹•é˜…è¯»å™¨è¿›è¡Œæµ‹è¯•ï¼Œå°è¯•ä»…ä½¿ç”¨é”®ç›˜è€Œä¸æ˜¯é¼ æ ‡ï¼Œä½¿ç”¨ è‰²ç›²è¿‡æ»¤å™¨ æŸ¥çœ‹æ‚¨çš„ç½‘ç«™ç­‰ã€‚\nç”¨ CSS å’Œ JavaScript è®©å®ƒå˜å¾—æ¼‚äº® å¦‚æœæˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢çœ‹ä¸€ä¸‹ç½‘ç«™ï¼Œå®ƒçœ‹èµ·æ¥å°±åƒä½ æœŸæœ›çš„é‚£æ ·å…‰ç§ƒç§ƒçš„ï¼š\nä¸ºäº†ç¾åŒ–å®ƒï¼Œæˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ª CSS æ–‡ä»¶æ¥åº”ç”¨æ ·å¼ã€‚ç°åœ¨ï¼Œå¦‚æœä½ ä¸æ˜¯ç‰¹åˆ«æ“…é•¿ CSSï¼Œå¯èƒ½éœ€è¦å¾ˆå¤šå¤©æ‰èƒ½ä½¿è¿™ä¸ªç½‘ç«™çœ‹èµ·æ¥å¾ˆæ¼‚äº®ã€‚ä¸å…¶ç¼–å†™è‡ªå·±çš„ CSSï¼Œä¸å¦‚å§‹ç»ˆä½¿ç”¨ CSS æ¡†æ¶ï¼Œè¯¥æ¡†æ¶æœ¬è´¨ä¸Šæ˜¯å…¶ä»–äººä»¥å¯é‡ç”¨çš„æ–¹å¼ç¼–å†™çš„ CSSã€‚\nä¸€ä¸ªæµè¡Œçš„ CSS æ¡†æ¶æ˜¯ Bootstrapï¼Œå®ƒäº 2011 å¹´é—®ä¸–ï¼Œå¹¶è¿…é€Ÿè¢« æ•°ç™¾ä¸‡ä¸ªç½‘ç«™ é‡‡ç”¨å’Œä½¿ç”¨ã€‚è®©æˆ‘ä»¬çœ‹çœ‹ä½¿ç”¨ Bootstrap çš„ä¸€äº›ä»£ç ä¼šæ˜¯ä»€ä¹ˆæ ·å­ï¼š\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34; /\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1, shrink-to-fit=no\u0026#34; /\u0026gt; \u0026lt;meta name=\u0026#34;description\u0026#34; content=\u0026#34;\u0026#34; /\u0026gt; \u0026lt;meta name=\u0026#34;author\u0026#34; content=\u0026#34;\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;My test page\u0026lt;/title\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css\u0026#34; integrity=\u0026#34;sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; /\u0026gt; \u0026lt;!--[if lt IE 9]\u0026gt; \u0026lt;script src=\u0026#34;https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;![endif]--\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;nav class=\u0026#34;navbar navbar-expand-lg navbar-light bg-light\u0026#34; role=\u0026#34;navigation\u0026#34; \u0026gt; \u0026lt;ul class=\u0026#34;navbar-nav mr-auto\u0026#34;\u0026gt; \u0026lt;li class=\u0026#34;nav-item active\u0026#34;\u0026gt; \u0026lt;a class=\u0026#34;nav-link\u0026#34; href=\u0026#34;#\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;nav-item\u0026#34;\u0026gt; \u0026lt;a class=\u0026#34;nav-link\u0026#34; href=\u0026#34;#\u0026#34;\u0026gt;Info\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;nav-item\u0026#34;\u0026gt; \u0026lt;a class=\u0026#34;nav-link\u0026#34; href=\u0026#34;#\u0026#34;\u0026gt;About\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;form class=\u0026#34;form-inline my-2 my-lg-0\u0026#34;\u0026gt; \u0026lt;input class=\u0026#34;form-control mr-sm-2\u0026#34; type=\u0026#34;text\u0026#34; placeholder=\u0026#34;Search\u0026#34; aria-label=\u0026#34;Search\u0026#34; /\u0026gt; \u0026lt;button class=\u0026#34;btn btn-outline-success my-2 my-sm-0\u0026#34; type=\u0026#34;submit\u0026#34;\u0026gt; Search \u0026lt;/button\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/nav\u0026gt; \u0026lt;main role=\u0026#34;main\u0026#34;\u0026gt; \u0026lt;!-- ... --\u0026gt; \u0026lt;/main\u0026gt; \u0026lt;footer class=\u0026#34;navbar navbar-dark bg-secondary\u0026#34; role=\u0026#34;contentinfo\u0026#34;\u0026gt; \u0026lt;p\u0026gt;Copyright info goes here\u0026lt;/p\u0026gt; \u0026lt;/footer\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; æ‚¨å¯ä»¥åœ¨ æ­¤å¤„ æŸ¥çœ‹å®Œæ•´çš„ä»£ç ç¤ºä¾‹ã€‚\nè®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹è¿™äº›æ›´æ”¹ï¼š\n\u0026lt;head\u0026gt; æ ‡ç­¾ä¸­çš„ \u0026lt;link\u0026gt; å°† Bootstrap CSS æ·»åŠ åˆ°æˆ‘ä»¬çš„ç½‘ç«™ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬é“¾æ¥åˆ°åœ¨çº¿æ‰˜ç®¡çš„æ–‡ä»¶ï¼Œè¿™å¯èƒ½ä¼šå¸¦æ¥ä¸€äº›å®‰å…¨é£é™© - integrity å’Œ crossorigin å±æ€§æœ‰åŠ©äºç¡®ä¿é“¾æ¥åˆ°çš„æ–‡ä»¶æ­£ç¡®æ— è¯¯ã€‚\næ·»åŠ çš„ç±»éƒ½æ˜¯ç‰¹å®šäº Bootstrap çš„ â€” æ·»åŠ çš„ Bootstrap CSS å…·æœ‰é’ˆå¯¹å…·æœ‰ç‰¹å®š HTML ç»“æ„çš„ç‰¹å®šç±»åçš„æ ·å¼ã€‚\nåœ¨ä¸‰ç¯‡æ–‡ç« å‘¨å›´æ·»åŠ äº†ä¸€ä¸ªé¢å¤–çš„ \u0026lt;div class=\u0026quot;row\u0026quot;\u0026gt; ï¼Œä»¥åˆ©ç”¨ Bootstrap çš„ç½‘æ ¼å¸ƒå±€ç³»ç»Ÿï¼ˆå®ƒä½¿ç”¨è¿™ç§ç‰¹å®šçš„ HTML ç»“æ„ï¼‰ã€‚\nä»¥ä¸‹æ˜¯è¯¥ç½‘ç«™ç°åœ¨çš„æ ·å­ï¼š\nä¸é”™ï¼è¯·æ³¨æ„ï¼Œä¸ºäº†ä½¿ç”¨åƒ Bootstrap è¿™æ ·çš„ CSS æ¡†æ¶ï¼Œæ‚¨å®é™…ä¸Šæ ¹æœ¬ä¸éœ€è¦ç¼–å†™ä»»ä½• CSS å³å¯å¼€å§‹ä½¿ç”¨ â€” æ‚¨åªéœ€è¦åœ¨ HTML ä¸­æ·»åŠ é€‚å½“çš„ç±»å³å¯åˆ©ç”¨æ¡†æ¶é™„å¸¦çš„ CSSã€‚\nè¿™é‡Œè¦æ³¨æ„çš„ä¸€ä»¶äº‹æ˜¯ï¼Œè™½ç„¶é€‰é¡¹å¡çš„æ ·å¼æ­£ç¡®ï¼ˆä»»ä½•æ—¶å€™åªæœ‰ä¸€ä¸ªé€‰é¡¹å¡å¯è§ï¼‰ï¼Œä½†å®ƒä»¬è¿˜æ²¡æœ‰æ­£å¸¸å·¥ä½œâ€”â€”å•å‡»é€‰é¡¹å¡ä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œã€‚è¿™æ˜¯å› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ç§ç±»å‹çš„è‡ªå®šä¹‰äº¤äº’ä¸æ˜¯ç”± CSS å¤„ç†çš„ï¼Œè€Œæ˜¯ç”± JavaScript å¤„ç†çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ \u0026lt;head\u0026gt; æ ‡ç­¾ä¸­æ·»åŠ  Bootstrap æ¡†æ¶é™„å¸¦çš„ JavaScript æ–‡ä»¶æ¥è®© Bootstrap é€‰é¡¹å¡å·¥ä½œï¼š\n\u0026lt;script src=\u0026#34;https://code.jquery.com/jquery-3.3.1.slim.min.js\u0026#34; integrity=\u0026#34;sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; \u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js\u0026#34; integrity=\u0026#34;sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; \u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js\u0026#34; integrity=\u0026#34;sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; \u0026gt;\u0026lt;/script\u0026gt; æœ€åä¸€ä¸ªè„šæœ¬æ˜¯ Bootstrap çš„ JavaScriptã€‚å‰ä¸¤ä¸ªæ˜¯ Bootstrap ä½¿ç”¨çš„ä¾èµ–é¡¹ï¼ˆjQuery å’Œ Popperï¼‰ï¼Œåœ¨åŠ è½½ Bootstrap è„šæœ¬ä¹‹å‰å¿…é¡»å…ˆåŠ è½½å®ƒä»¬ã€‚å¦‚æœæ‚¨æŸ¥çœ‹ æ­¤å®æ—¶ç¤ºä¾‹ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°é€‰é¡¹å¡ç°åœ¨å¯ä»¥å·¥ä½œäº†ï¼\nBootstrap è¢«å¹¿æ³›ä½¿ç”¨ï¼Œå› ä¸ºå®ƒå¸®åŠ©è§£å†³äº†å½“æ—¶ CSS çš„ä¸»è¦ç—›ç‚¹ï¼Œä¾‹å¦‚æµè§ˆå™¨ä¸ä¸€è‡´å’Œç¼ºä¹é€‚å½“çš„ç½‘æ ¼ç³»ç»Ÿã€‚ä½¿ç”¨åƒ Bootstrap è¿™æ ·çš„ CSS æ¡†æ¶æœ‰ä¸€äº›ç¼ºç‚¹â€”â€”ç‰¹åˆ«æ˜¯ï¼Œä¸ä»å¤´å¼€å§‹ç¼–å†™ CSS ç›¸æ¯”ï¼Œå®ƒä»¬å¯èƒ½éš¾ä»¥å®šåˆ¶ï¼Œè¿™å¯èƒ½ä¼šä½¿æ‚¨çš„ç½‘ç«™ä¸å…¶ä»–ç½‘ç«™ç›¸æ¯”æ˜¾å¾—é€šç”¨ã€‚\næ­¤å¤–ï¼Œéšç€æ™ºèƒ½æ‰‹æœºå’Œç§»åŠ¨æµé‡çš„å¢åŠ ï¼Œå‡å°‘ CSS å’Œ JS æ–‡ä»¶å¤§å°å˜å¾—è¶Šæ¥è¶Šé‡è¦ - ä»»ä½•è¶…è¿‡å‡ åƒå­—èŠ‚çš„ä¸œè¥¿éƒ½ä¼šæ˜¾ç€å½±å“è¾ƒæ…¢çš„äº’è”ç½‘è¿æ¥çš„æ€§èƒ½ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ä½¿ç”¨ Bootstrap çš„æ–¹å¼ï¼Œæˆ‘ä»¬è¦æ±‚ç”¨æˆ·ä¸‹è½½æ•´ä¸ª Bootstrap æ¡†æ¶ä¸ç«™ç‚¹ä¸€èµ·ï¼Œå³ä½¿æˆ‘ä»¬åªä½¿ç”¨å‡ ç§æ ·å¼å’ŒåŠŸèƒ½ã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»å‡ ç§æœ‰åŠ©äºè§£å†³è¿™äº›æ€§èƒ½é—®é¢˜çš„æŠ€æœ¯ã€‚\næ³¨æ„ï¼šå¯¹ CSS å’Œ JavaScript çš„æ‰å®æŒæ¡ä¸ä½¿ç”¨ HTML åˆ¶ä½œå¤æ‚çš„ç½‘ç«™æœ‰ç€å†…åœ¨çš„è”ç³»;ä½†æ˜¯ï¼Œæ·±å…¥ç ”ç©¶è¿™äº›è¯­è¨€è¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äº CSS å’Œ JavaScript çš„åŸºç¡€çŸ¥è¯†ï¼ŒMDN Web Docs æ€»æ˜¯ä¸€ä¸ªä¸é”™çš„èµ·ç‚¹ã€‚å¦‚æœä½ æƒ³æ›´å¥½åœ°äº†è§£ CSS çš„æ‰€æœ‰æ–°åŠŸèƒ½ï¼ˆflexboxï¼Œgridï¼ŒSASS ç­‰ï¼‰å¦‚ä½•ä¸æ‰€æ¶‰åŠçš„æ‰€æœ‰å·¥å…·å’ŒæŠ€æœ¯ç»“åˆåœ¨ä¸€èµ·ï¼Œè¯·æŸ¥çœ‹æˆ‘çš„æ–‡ç«  Modern CSS Explain For Dinosaursã€‚\nä½¿ç”¨ HTML å±æ€§æé«˜æ€§èƒ½ åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªç½‘ç«™ï¼Œå…·æœ‰ç›¸å½“å¥½çš„ç»„ç»‡ï¼Œè¯­ä¹‰ HTMLã€‚å¦‚æœè¿™å°±æ˜¯æˆ‘ä»¬æ­£åœ¨è€ƒè™‘çš„å…¨éƒ¨å†…å®¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ç½‘ç«™å°±ä¼šå®Œæˆï¼ç„¶è€Œï¼Œåœ¨æ€§èƒ½ï¼ˆç½‘ç«™ä¸ºç”¨æˆ·åŠ è½½çš„é€Ÿåº¦ï¼‰å’Œå¯ç»´æŠ¤æ€§ï¼ˆå¼€å‘äººå‘˜æ›´æ”¹ä»£ç çš„éš¾æ˜“ç¨‹åº¦ï¼‰æ–¹é¢ï¼Œç½‘ç«™æœ‰è®¸å¤šæ–¹é¢å¯ä»¥æ”¹è¿›ã€‚\nè„šæœ¬çš„ defer å±æ€§ å¯¹äºæˆ‘ä»¬çš„ç½‘ç«™ï¼Œä¸€ä¸ªä¸»è¦çš„ä¼˜åŒ–æ˜¯è§£å†³æ ‡é¢˜ä¸­åŠ è½½çš„ JavaScript æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶è¶³å¤Ÿå¤§ï¼Œå®é™…ä¸Šä¼šå‡æ…¢ç½‘ç«™çš„é€Ÿåº¦ã€‚ä¸ºäº†å‘ˆç°é¡µé¢ï¼ŒWeb æµè§ˆå™¨è¯»å–ç»™å®šçš„ HTML å¹¶å°†å…¶è½¬æ¢ä¸ºå®ƒç†è§£çš„æ ¼å¼ - æ–‡æ¡£å¯¹è±¡æ¨¡å‹æˆ– DOMã€‚å¦‚æ‚¨æ‰€æ–™ï¼ŒWeb æµè§ˆå™¨ä» HTML æ–‡æ¡£çš„é¡¶éƒ¨å¼€å§‹ï¼Œç„¶åå‘ä¸‹å·¥ä½œã€‚è¿™æ„å‘³ç€å¦‚æœå®ƒçœ‹åˆ° \u0026lt;script\u0026gt; æ ‡è®°ï¼Œå®ƒå°†ä¸‹è½½å¹¶æ‰§è¡Œè„šæœ¬ï¼Œç„¶åå†è½¬åˆ°ä¸‹ä¸€è¡Œã€‚æ‚¨å¯ä»¥åœ¨æ­¤å¤„æŸ¥çœ‹æ­¤è¿‡ç¨‹çš„æ’å›¾ï¼š\næ¥è‡ª hacks.mozilla.org ä¸€ä¸ªå¸¸è§çš„ä¼˜åŒ–æŠ€å·§æ˜¯å°†æ‰€æœ‰ JavaScript \u0026lt;script\u0026gt; æ ‡ç­¾ç§»å‡º \u0026lt;head\u0026gt; æ ‡ç­¾å¹¶ç§»åˆ° \u0026lt;body\u0026gt; æ ‡ç­¾çš„æœ«å°¾ã€‚ä½ å¯ä»¥åœ¨ Bootstrap è‡ªå·±çš„å…¥é—¨æ¨¡æ¿ä¸­çœ‹åˆ°è¿™ä¸€ç‚¹ï¼š\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;!-- Required meta tags --\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34; /\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1, shrink-to-fit=no\u0026#34; /\u0026gt; \u0026lt;!-- Bootstrap CSS --\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css\u0026#34; integrity=\u0026#34;sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Hello, world!\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;Hello, world!\u0026lt;/h1\u0026gt; \u0026lt;!-- Optional JavaScript --\u0026gt; \u0026lt;!-- jQuery first, then Popper.js, then Bootstrap JS --\u0026gt; \u0026lt;script src=\u0026#34;https://code.jquery.com/jquery-3.3.1.slim.min.js\u0026#34; integrity=\u0026#34;sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; \u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js\u0026#34; integrity=\u0026#34;sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; \u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js\u0026#34; integrity=\u0026#34;sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; \u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œè¿™æ˜¯ä¸€ç§ä¼˜åŒ–ï¼Œå› ä¸ºè¿™ä¸æ˜¯ HTML çš„è®¾è®¡æ–¹å¼ - CSS å’Œ JavaScript æ–‡ä»¶åº”è¯¥åœ¨æ ‡ç­¾ä¸­å®šä¹‰ï¼Œå¦‚å‰æ‰€è¿°ã€‚ä½†æ˜¯ï¼Œå°†æ‰€æœ‰å†…å®¹ä¿ç•™åœ¨ \u0026lt;head\u0026gt; æ ‡è®°ä¸­ä¼šäº§ç”Ÿé™ä½é¡µé¢å‘ˆç°æ€§èƒ½çš„æ„å¤–å‰¯ä½œç”¨ã€‚å°†æ‰€æœ‰ \u0026lt;script\u0026gt; ä¸ªæ ‡è®°ç§»åŠ¨åˆ° \u0026lt;body\u0026gt; ä¸ªæ ‡è®°çš„åº•éƒ¨æ˜¯æé«˜æ€§èƒ½çš„ä¸€ç§æ–¹æ³•ã€‚\nåœ¨ 2018 å¹´ï¼Œè®¸å¤šç½‘ç«™ä»ç„¶ä½¿ç”¨è¿™ç§å°†æ‰€æœ‰ \u0026lt;script\u0026gt; æ ‡ç­¾ç§»åŠ¨åˆ° \u0026lt;body\u0026gt; æ ‡ç­¾åº•éƒ¨çš„æŠ€å·§ã€‚ç„¶è€Œï¼Œæµè§ˆå™¨å·²ç»æ”¯æŒäº†ä¸€ç§ä¸é‚£ä¹ˆé»‘å®¢çš„æ–¹æ³•è¿‘ 10 å¹´â€”â€” defer å±æ€§ã€‚é€šè¿‡å°†æ­¤å±æ€§æ·»åŠ åˆ° \u0026lt;script\u0026gt; æ ‡è®°ä¸­ï¼Œæµè§ˆå™¨å°†ä¸‹è½½å¤–éƒ¨æ–‡ä»¶è€Œä¸ä¼šé˜»æ­¢æ„å»º DOM çš„å…¶ä½™éƒ¨åˆ†ï¼Œå¹¶å°†åœ¨ DOM æ„å»ºå®Œæˆåæ‰§è¡Œè„šæœ¬ã€‚æ‚¨å¯ä»¥åœ¨æ­¤å¤„æŸ¥çœ‹æ­¤è¿‡ç¨‹çš„æ’å›¾ï¼š\nåœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œåœ¨ \u0026lt;head\u0026gt; ä¸­ä¿ç•™ \u0026lt;script\u0026gt; ä¸ªæ ‡ç­¾å’Œ defer å±æ€§å°†å¯¼è‡´æ›´å¿«çš„é¡µé¢åŠ è½½é€Ÿåº¦ï¼Œå› ä¸ºæ–‡ä»¶å¯ä»¥ä¸æ­£åœ¨æ„å»ºçš„ DOM å¹¶è¡Œä¸‹è½½ã€‚è¿™å°±æ˜¯ Bootstrap çš„åˆå­¦è€…æ¨¡æ¿ä½¿ç”¨ defer å±æ€§çš„æ ·å­ï¼š\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;!-- Required meta tags --\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34; /\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1, shrink-to-fit=no\u0026#34; /\u0026gt; \u0026lt;!-- Bootstrap CSS --\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css\u0026#34; integrity=\u0026#34;sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; /\u0026gt; \u0026lt;!-- Optional JavaScript --\u0026gt; \u0026lt;!-- jQuery first, then Popper.js, then Bootstrap JS --\u0026gt; \u0026lt;script defer src=\u0026#34;https://code.jquery.com/jquery-3.3.1.slim.min.js\u0026#34; integrity=\u0026#34;sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; \u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script defer src=\u0026#34;https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js\u0026#34; integrity=\u0026#34;sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; \u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script defer src=\u0026#34;https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js\u0026#34; integrity=\u0026#34;sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; \u0026gt;\u0026lt;/script\u0026gt; \u0026lt;title\u0026gt;Hello, world!\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;Hello, world!\u0026lt;/h1\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; è¿™æ ·åšçš„å¥½å¤„æ˜¯ç½‘ç«™ä¼šæ¸²æŸ“å¾—æ›´å¿«ï¼Œå¹¶ä¸”å®ƒä¼šæŒ‰é¢„æœŸä½¿ç”¨ \u0026lt;head\u0026gt; æ ‡è®°ä¸­çš„è„šæœ¬ç»„ç»‡ HTMLã€‚ä¸ºäº†æ›´ç²¾ç»†åœ°æ§åˆ¶å“ªäº›æ–‡ä»¶ä»¥ä»€ä¹ˆé¡ºåºä¸‹è½½å’Œæ‰§è¡Œï¼Œè¿˜æœ‰ async å±æ€§ä»¥åŠ \u0026lt;link\u0026gt; ä¸ªæ ‡ç­¾çš„ rel=\u0026quot;preload\u0026quot; å±æ€§ï¼ˆæ‚¨å¯ä»¥åœ¨ æ­¤å¤„ é˜…è¯»æ›´å¤šç›¸å…³ä¿¡æ¯ï¼‰ã€‚\nå›¾åƒçš„ srcset å±æ€§ å¯¹äºæˆ‘ä»¬çš„ç½‘ç«™ï¼Œå¦ä¸€ä¸ªä¸»è¦çš„æ€§èƒ½ä¼˜åŒ–æ˜¯å›¾åƒã€‚ç°åœ¨ï¼Œè¿™äº›å›¾åƒæ­£åœ¨è¢«â€œçƒ­é“¾æ¥â€ï¼Œè¿™æ„å‘³ç€å®ƒä»¬è¢«ç›´æ¥é“¾æ¥åˆ°å…¶ä»–äººçš„ç½‘ç«™ä¸Šã€‚è¿™ä¸ä»…ä»ç»´æŠ¤çš„è§’åº¦æ¥çœ‹æ˜¯æœ‰é—®é¢˜çš„ï¼ˆå¦‚æœå…¶ä»–äººæ”¹å˜ä»–ä»¬çš„å½¢è±¡ï¼Œå°±ä¼šç ´åæˆ‘ä»¬çš„ç½‘ç«™ï¼‰ï¼Œä»æ€§èƒ½çš„è§’åº¦æ¥çœ‹ï¼Œå®ƒä¹Ÿå¯èƒ½æ˜¯æœ‰é—®é¢˜çš„ã€‚\næˆ‘ä»¬å¯ä»¥ä¸‹è½½æ–‡ä»¶å¹¶åœ¨æœ¬åœ°é“¾æ¥åˆ°å®ƒä»¬ï¼Œè€Œä¸æ˜¯ç›´æ¥é“¾æ¥æ–‡ä»¶ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†å›¾åƒæ–‡ä»¶å¤§å°è°ƒæ•´ä¸ºé€‚å½“çš„åˆ†è¾¨ç‡æ¥ä¼˜åŒ–å›¾åƒæ–‡ä»¶å¤§å°ã€‚è€Œä¸æ˜¯ç›´æ¥é“¾æ¥åˆ°å¦ä¸€ä¸ªç½‘ç«™ä¸Šçš„å•ä¸ªå›¾åƒçš„å›¾åƒæ ‡ç­¾ï¼š\n\u0026lt;img class=\u0026#34;img-fluid\u0026#34; src=\u0026#34;http://1000logos.net/wp-content/uploads/2017/04/Microsoft-Logo.png\u0026#34; alt=\u0026#34;microsoft logo\u0026#34; /\u0026gt; æˆ‘ä»¬å¯ä»¥åœ¨æœ¬åœ°åˆ›å»ºå›¾åƒçš„å¤šä¸ªç‰ˆæœ¬ï¼Œå¹¶å“åº”å¼åœ°é“¾æ¥åˆ°å®ƒä»¬ï¼š\n\u0026lt;img class=\u0026#34;img-fluid\u0026#34; src=\u0026#34;microsoft-logo-small.png\u0026#34; srcset=\u0026#34;microsoft-logo-medium.png 1000w, microsoft-logo-large.png 2000w\u0026#34; alt=\u0026#34;microsoft logo\u0026#34; /\u0026gt; åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨å¾½æ ‡çš„å°å‹ã€ä¸­å‹å’Œå¤§å‹ç‰ˆæœ¬ã€‚ srcset å±æ€§å‘Šè¯‰æµè§ˆå™¨æ ¹æ®æµè§ˆå™¨å®½åº¦åŠ è½½é€‚å½“çš„ç‰ˆæœ¬ã€‚ srcset å±æ€§æ˜¯åœ¨ 2013 å¹´å·¦å³å¼•å…¥çš„ï¼Œä½†æµè§ˆå™¨èŠ±äº†å‡ å¹´æ—¶é—´æ‰å®Œå…¨æ”¯æŒå®ƒã€‚æˆªè‡³ 2018 å¹´ï¼Œå®ƒå…·æœ‰ ç›¸å½“ä¸é”™çš„æµè§ˆå™¨æ”¯æŒ ï¼Œå› æ­¤ç»å¯¹å€¼å¾—å°†å…¶ä½œä¸ºå·¥ä½œæµç¨‹çš„ä¸€éƒ¨åˆ†ã€‚\nå¯¹äºè®¸å¤šç½‘ç«™æ¥è¯´ï¼Œä¼˜åŒ–å›¾åƒå¤§å°é€šå¸¸æ˜¯æœ€å¤§çš„æ€§èƒ½æå‡â€”â€”å›¾åƒä¸‹è½½å¤§å°é€šå¸¸æ¯”ä»»ä½• JavaScript å’Œ CSS æ–‡ä»¶å¤§å‡ ä¸ªæ•°é‡çº§ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ \u0026lt;picture\u0026gt; å…ƒç´ å¯¹å›¾åƒè¿›è¡Œæ›´ç²¾ç»†çš„æ§åˆ¶;ä½†æ˜¯ï¼Œå¯¹äºå¤§å¤šæ•°ç”¨ä¾‹æ¥è¯´ï¼Œä½¿ç”¨ç®€å•çš„ srcset å±æ€§ é€šå¸¸ç»°ç»°æœ‰ä½™ã€‚\nå…¶ä»– HTML å±æ€§ ä½œä¸ºä¸€ç§è¯­è¨€ï¼ŒHTML å…·æœ‰ è®¸å¤šå±æ€§ ï¼Œå¹¶ç»§ç»­æ·»åŠ å¯ç”¨äºæé«˜æ€§èƒ½çš„æ–°å±æ€§ï¼ˆå¦‚ importance å’Œ lazyload ï¼‰ã€‚è™½ç„¶è¿™å¯èƒ½ä»¤äººç”Ÿç•ï¼Œä½†ä¸“æ³¨äºä¸‹è½½å¤§å°ï¼ˆå›¾åƒå’Œè„šæœ¬ï¼‰æ–¹é¢çš„æœ€å¤§èµ„æºï¼Œæ— è®ºå®ƒä»¬å¯èƒ½é€‚ç”¨äºæ‚¨çš„ç‰¹å®šç½‘ç«™ï¼Œé€šå¸¸æ˜¯æœ€å¥½çš„èµ·ç‚¹ã€‚\nè¯·æ³¨æ„ï¼Œå°±åƒå¯è®¿é—®æ€§ä¸€æ ·ï¼Œæ²¡æœ‰ä¸€å¥—å…¨é¢çš„æ€§èƒ½è§„åˆ™å§‹ç»ˆé€‚ç”¨äºæ¯ä¸ªç½‘ç«™â€”â€”æ‚¨åº”è¯¥å¯¹æ‚¨çš„ç½‘ç«™è¿›è¡ŒåŸºå‡†æµ‹è¯•ä»¥ç¡®å®šæœ€æœ‰æ•ˆçš„æ–¹æ³•ï¼ˆChrome å’Œ Firefox ç­‰æµè§ˆå™¨æä¾›æ­¤ç±»å·¥å…·ï¼‰ã€‚åŒæ ·ï¼Œæœ€å¥½çš„æ–¹æ³•æ˜¯ç®€å•åœ°åœ¨æ…¢é€Ÿç½‘ç»œæ¡ä»¶ä¸‹ä½¿ç”¨æ‚¨çš„ç½‘ç«™ï¼ˆæµè§ˆå™¨çš„å¼€å‘å·¥å…·å¯ä»¥æ¨¡æ‹Ÿï¼‰â€”â€”å¦‚æœæ‚¨åœ¨æ…¢é€Ÿç½‘ç»œæ¡ä»¶ä¸‹ä½¿ç”¨è‡ªå·±çš„ç½‘ç«™å³ä½¿åªæ˜¯ä¸€å‘¨ï¼Œæ‚¨å¾ˆå¯èƒ½ä¼šæ‰¾åˆ°å¤§é‡æ€§èƒ½ä¿®å¤æ¥æ”¹å–„å…¶ä½“éªŒã€‚\nä½¿ç”¨å·¥å…·æé«˜æ€§èƒ½ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨ä½¿ç”¨ HTML è¯­è¨€æä¾›çš„å·¥å…·æ¥ä¼˜åŒ–æ€§èƒ½ã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨å¤–éƒ¨å·¥å…·è·å¾—æ›´å¤šæ€§èƒ½ä¼˜åŠ¿ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹å‡ ç§å¸¸ç”¨çš„æ–¹æ³•ã€‚\nä»£ç ç¼©å° ä¸€ä¸ªé‡è¦çš„æ€§èƒ½ä¼˜åŒ–æ˜¯ JavaScript å’Œ CSS ä»£ç çš„ç¼©å°ï¼ˆæœ‰æ—¶ç§°ä¸ºä¸‘åŒ–ï¼‰ã€‚è¿™æ¶‰åŠä½¿ç”¨ç¨‹åºæ¥åˆ†æå’Œåˆ é™¤ä»£ç ä¸­ä¸å¿…è¦æˆ–å†—ä½™çš„æ•°æ®ï¼Œä»ç®€å•çš„äº‹æƒ…ï¼ˆå¦‚åˆ é™¤ä¸éœ€è¦çš„ç©ºæ ¼ï¼‰åˆ°å¤æ‚çš„äº‹æƒ…ï¼Œå¦‚å°½å¯èƒ½å°†é•¿å˜é‡é‡å‘½åä¸ºå•ä¸ªå­—ç¬¦ã€‚ä¸‹é¢æ˜¯ Douglas Crockford åœ¨ 2003 å¹´å‘å¸ƒ çš„ç¬¬ä¸€ä¸ª JavaScript ç¼©å‡å™¨çš„ç¤ºä¾‹ã€‚ç¤ºä¾‹æœªç¼©å°çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\n// is.js // (c) 2001 Douglas Crockford // 2001 June 3 // is // The -is- object is used to identify the browser. Every browser edition // identifies itself, but there is no standard way of doing it, and some of // the identification is deceptive. This is because the authors of web // browsers are liars. For example, Microsoft\u0026#39;s IE browsers claim to be // Mozilla 4. Netscape 6 claims to be version 5. var is = { ie: navigator.appName == \u0026#34;Microsoft Internet Explorer\u0026#34;, java: navigator.javaEnabled(), ns: navigator.appName == \u0026#34;Netscape\u0026#34;, ua: navigator.userAgent.toLowerCase(), version: parseFloat(navigator.appVersion.substr(21)) || parseFloat(navigator.appVersion), win: navigator.platform == \u0026#34;Win32\u0026#34;, }; is.mac = is.ua.indexOf(\u0026#34;mac\u0026#34;) \u0026gt;= 0; if (is.ua.indexOf(\u0026#34;opera\u0026#34;) \u0026gt;= 0) { is.ie = is.ns = false; is.opera = true; } if (is.ua.indexOf(\u0026#34;gecko\u0026#34;) \u0026gt;= 0) { is.ie = is.ns = false; is.gecko = true; } ç¼©å°åçš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\nvar is = { ie: navigator.appName == \u0026#34;Microsoft Internet Explorer\u0026#34;, java: navigator.javaEnabled(), ns: navigator.appName == \u0026#34;Netscape\u0026#34;, ua: navigator.userAgent.toLowerCase(), version: parseFloat(navigator.appVersion.substr(21)) || parseFloat(navigator.appVersion), win: navigator.platform == \u0026#34;Win32\u0026#34;, }; is.mac = is.ua.indexOf(\u0026#34;mac\u0026#34;) \u0026gt;= 0; if (is.ua.indexOf(\u0026#34;opera\u0026#34;) \u0026gt;= 0) { is.ie = is.ns = false; is.opera = true; } if (is.ua.indexOf(\u0026#34;gecko\u0026#34;) \u0026gt;= 0) { is.ie = is.ns = false; is.gecko = true; } è¿™äº›æ›´æ”¹ç¡®å®åŠ èµ·æ¥ â€” ä»æˆ‘ä»¬ä¹‹å‰çš„ç¤ºä¾‹æ¥çœ‹ï¼Œæœªç¼©å°çš„ bootstrap.js çš„å¤§å°ä¸º 124 KBï¼Œè€Œç¼©å°çš„ bootstrap.min.js çš„å¤§å°ä¸º 51 KBã€‚è¿™è¿˜ä¸åˆ°åŸæ¥å°ºå¯¸çš„ä¸€åŠâ€”â€”ä½¿ç”¨Grabtharâ€™s hammerï¼ŒçœŸæ˜¯çœé’±ï¼ä½†è¯´çœŸçš„ï¼Œå®ƒåœ¨ç½‘ç«™ä¸‹è½½å’Œæ˜¾ç¤ºçš„é€Ÿåº¦æ–¹é¢æœ‰å¾ˆå¤§çš„ä¸åŒï¼Œå°¤å…¶æ˜¯åœ¨äº’è”ç½‘è¿æ¥é€Ÿåº¦è¾ƒæ…¢çš„æƒ…å†µä¸‹ã€‚\næˆ‘ä»¬åœ¨å‰é¢çš„ä¾‹å­ä¸­ä½¿ç”¨çš„ Bootstrap CSS å’Œ JavaScript å·²ç»ç¼©å°äº†ï¼Œä½†å¦‚æœä½ æƒ³ç¼©å°è‡ªå·±çš„ä»£ç ï¼Œä½ å¯ä»¥ä½¿ç”¨ JavaScript Minifier æˆ– Minify ç­‰åœ¨çº¿å·¥å…·ï¼Œæœ‰å¾ˆå¤šå¯ä¾›é€‰æ‹©ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·ï¼Œè¯¥å·¥å…·å¯ä»¥èŠ‚çœå°†ä»£ç å¤åˆ¶åˆ°ç½‘ç«™çš„è¿‡ç¨‹ã€‚\næ–‡ä»¶ä¸²è” å¦ä¸€ä¸ªç›¸å…³çš„æ€§èƒ½ä¼˜åŒ–æ˜¯ä¸²è”ï¼Œå®ƒå°†å¤šä¸ª JavaScript æ–‡ä»¶ï¼ˆæˆ– CSS æ–‡ä»¶ï¼‰è½¬æ¢ä¸ºå•ä¸ªæ–‡ä»¶ã€‚æµè§ˆå™¨ä¸‹è½½å•ä¸ªæ–‡ä»¶çš„é€Ÿåº¦æ¯”ä¸‹è½½å¤šä¸ªå°æ–‡ä»¶æ›´å¿«ï¼Œè¿™æ˜¯åŸºäºæµè§ˆå™¨è‡ª 1999 å¹´ä»¥æ¥ä½¿ç”¨çš„ HTTP/1.1 åè®®ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ–°ç‰ˆæœ¬çš„åè®® HTTP/2 äº 2015 å¹´å‘å¸ƒï¼Œå¯èƒ½ä¼šæ”¹å˜æ­¤ä¼˜åŒ–ã€‚HTTP / 2 å…è®¸å¤šä¸ªåŒæ—¶è¿æ¥ï¼Œå› æ­¤ç†è®ºä¸Šæœ€å¥½æœ‰å¤šä¸ªå°æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå¤§çº§è”æ–‡ä»¶ã€‚ç„¶è€Œï¼Œåœ¨å®è·µä¸­ï¼Œå®ƒ ä¼¼ä¹å¹¶ä¸é‚£ä¹ˆç®€å•ï¼Œå› ä¸ºä¸²è”ä»ç„¶æœ‰é‡è¦çš„å¥½å¤„ã€‚æˆªè‡³ 2018 å¹´ï¼Œè¿æ¥ JavaScript å’Œ CSS æ–‡ä»¶ä»ç„¶æ˜¯å¸¸è§çš„åšæ³•ã€‚\nè¦è¿æ¥æ‚¨çš„æ–‡ä»¶ï¼Œç†è®ºä¸Šæ‚¨å¯ä»¥æ‰‹åŠ¨å®Œæˆ - å°†æ¯ä¸ª JavaScript æ–‡ä»¶çš„å†…å®¹å¤åˆ¶åˆ°å•ä¸ªæ–‡ä»¶ä¸­ï¼Œå¯¹ CSS æ–‡ä»¶é‡å¤æ­¤æ“ä½œï¼Œç­‰ç­‰ã€‚ç„¶åä¿®æ”¹ HTML ä»¥é“¾æ¥åˆ°å•ä¸ªä¸²è”çš„ JavaScript æ–‡ä»¶å’Œå•ä¸ªä¸²è”çš„ CSS æ–‡ä»¶ã€‚æ¯æ¬¡éƒ¨ç½²åº”ç”¨ç¨‹åºæ—¶éƒ½å¿…é¡»æ‰§è¡Œæ­¤æ“ä½œï¼Œç»´æŠ¤èµ·æ¥ä¼šéå¸¸ç—›è‹¦ - æœ€å¥½ä½¿ç”¨ä¸€äº›è‡ªåŠ¨åŒ–è¿‡ç¨‹ï¼ˆæ›´å¤šå†…å®¹è§ä¸‹æ–‡ï¼‰ã€‚\nå…³é”® CSS è¿‘å¹´æ¥æµè¡Œçš„å¦ä¸€ä¸ªä¼˜åŒ–æ˜¯å†…è”é¡µé¢çš„å…³é”® CSSã€‚è¿™æ¶‰åŠä½¿ç”¨å·¥å…·æ¥è¯†åˆ«ç”¨æˆ·åœ¨è®¿é—®ç½‘é¡µæ—¶é¦–å…ˆçœ‹åˆ°çš„æ‰€æœ‰ HTML å…ƒç´ ï¼š\næ¥è‡ª https://www.smashingmagazine.com/2015/08/understanding-critical-css/ ä¸€æ—¦è¯†åˆ«å‡ºè¿™äº› HTML å…ƒç´ ï¼Œè¯¥å·¥å…·å°†æ‰¾åˆ°å½±å“è¿™äº›å…ƒç´ çš„æ‰€æœ‰ CSSï¼Œå¹¶å°†å®ƒä»¬ç›´æ¥æ·»åŠ åˆ° HTML æ–‡ä»¶ä¸­ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæµè§ˆå™¨èƒ½å¤Ÿæ˜¾ç¤ºä¸€ä¸ªå®Œå…¨æ ·å¼çš„ç½‘ç«™ï¼Œè€Œæ— éœ€ç­‰å¾…å‰©ä½™çš„ CSS ä¸‹è½½ï¼\næœ‰ä¸åŒçš„å·¥å…·å¯ä»¥å¸®åŠ©æ‚¨è¯†åˆ« å…³é”® CSSï¼Œä» Addy Osmani çš„åŸºäºèŠ‚ç‚¹çš„å…³é”®åº“åˆ° Jonas Ohlsson Aden çš„åŸºäº Web çš„å…³é”®è·¯å¾„ CSS ç”Ÿæˆå™¨ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬ä¹‹å‰ Bootstrap ç¤ºä¾‹ä¸­çš„ HTML \u0026lt;head\u0026gt; å…ƒç´ åœ¨é€šè¿‡å…³é”®å·¥å…·åˆ†æåçš„å¤–è§‚ç¤ºä¾‹ï¼š\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34; /\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1, shrink-to-fit=no\u0026#34; /\u0026gt; \u0026lt;meta name=\u0026#34;description\u0026#34; content=\u0026#34;\u0026#34; /\u0026gt; \u0026lt;meta name=\u0026#34;author\u0026#34; content=\u0026#34;\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;My test page\u0026lt;/title\u0026gt; \u0026lt;style\u0026gt; :root { --blue: #007bff; --indigo: #6610f2; --purple: #6f42c1; --pink: #e83e8c; --red: #dc3545; --orange: #fd7e14; --yellow: #ffc107; --green: #28a745; --teal: #20c997; --cyan: #17a2b8; --white: #fff; --gray: #6c757d; --gray-dark: #343a40; --primary: #007bff; --secondary: #6c757d; --success: #28a745; --info: #17a2b8; --warning: #ffc107; --danger: #dc3545; --light: #f8f9fa; --dark: #343a40; --breakpoint-xs: 0; --breakpoint-sm: 576px; --breakpoint-md: 768px; --breakpoint-lg: 992px; --breakpoint-xl: 1200px; --font-family-sans-serif: -apple-system, BlinkMacSystemFont, \u0026#34;Segoe UI\u0026#34;, Roboto, \u0026#34;Helvetica Neue\u0026#34;, Arial, sans-serif, \u0026#34;Apple Color Emoji\u0026#34;, \u0026#34;Segoe UI Emoji\u0026#34;, \u0026#34;Segoe UI Symbol\u0026#34;, \u0026#34;Noto Color Emoji\u0026#34;; --font-family-monospace: SFMono-Regular, Menlo, Monaco, Consolas, \u0026#34;Liberation Mono\u0026#34;, \u0026#34;Courier New\u0026#34;, monospace; } \\*, ::after, ::before { box-sizing: border-box; } html { font-family: sans-serif; line-height: 1.15; -webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%; -ms-overflow-style: scrollbar; } @-ms-viewport { width: device-width; } article, footer, main, nav, section { display: block; } body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, \u0026#34;Segoe UI\u0026#34;, Roboto, \u0026#34;Helvetica Neue\u0026#34;, Arial, sans-serif, \u0026#34;Apple Color Emoji\u0026#34;, \u0026#34;Segoe UI Emoji\u0026#34;, \u0026#34;Segoe UI Symbol\u0026#34;, \u0026#34;Noto Color Emoji\u0026#34;; font-size: 1rem; font-weight: 400; line-height: 1.5; color: #212529; text-align: left; background-color: #fff; } h1, h2 { margin-top: 0; margin-bottom: 0.5rem; } p { margin-top: 0; margin-bottom: 1rem; } ul { margin-top: 0; margin-bottom: 1rem; } a { color: #007bff; text-decoration: none; background-color: transparent; -webkit-text-decoration-skip: objects; } img { vertical-align: middle; border-style: none; } button { border-radius: 0; } button, input { margin: 0; font-family: inherit; font-size: inherit; line-height: inherit; } button, input { overflow: visible; } button { text-transform: none; } [type=\u0026#34;submit\u0026#34;], button { -webkit-appearance: button; } [type=\u0026#34;submit\u0026#34;]::-moz-focus-inner, button::-moz-focus-inner { padding: 0; border-style: none; } ::-webkit-file-upload-button { font: inherit; -webkit-appearance: button; } h1, h2 { margin-bottom: 0.5rem; font-family: inherit; font-weight: 500; line-height: 1.2; color: inherit; } h1 { font-size: 2.5rem; } h2 { font-size: 2rem; } .lead { font-size: 1.25rem; font-weight: 300; } .display-4 { font-size: 3.5rem; font-weight: 300; line-height: 1.2; } .img-fluid { max-width: 100%; height: auto; } .container { width: 100%; padding-right: 15px; padding-left: 15px; margin-right: auto; margin-left: auto; } [@media](http://twitter.com/media \u0026#34;Twitter profile for @media\u0026#34;) (min-width:576px) { .container { max-width: 540px; } } [@media](http://twitter.com/media \u0026#34;Twitter profile for @media\u0026#34;) (min-width:768px) { .container { max-width: 720px; } } [@media](http://twitter.com/media \u0026#34;Twitter profile for @media\u0026#34;) (min-width:992px) { .container { max-width: 960px; } } [@media](http://twitter.com/media \u0026#34;Twitter profile for @media\u0026#34;) (min-width:1200px) { .container { max-width: 1140px; } } .row { display: -ms-flexbox; display: flex; -ms-flex-wrap: wrap; flex-wrap: wrap; margin-right: -15px; margin-left: -15px; } .col-4 { position: relative; width: 100%; min-height: 1px; padding-right: 15px; padding-left: 15px; } .col-4 { -ms-flex: 0 0 33.333333%; flex: 0 0 33.333333%; max-width: 33.333333%; } .form-control { display: block; width: 100%; height: calc(2.25rem + 2px); padding: 0.375rem 0.75rem; font-size: 1rem; line-height: 1.5; color: #495057; background-color: #fff; background-clip: padding-box; border: 1px solid #ced4da; border-radius: 0.25rem; } .form-control::-ms-expand { background-color: transparent; border: 0; } .form-control::-webkit-input-placeholder { color: #6c757d; opacity: 1; } .form-control::-moz-placeholder { color: #6c757d; opacity: 1; } .form-control:-ms-input-placeholder { color: #6c757d; opacity: 1; } .form-control::-ms-input-placeholder { color: #6c757d; opacity: 1; } .form-inline { display: -ms-flexbox; display: flex; -ms-flex-flow: row wrap; flex-flow: row wrap; -ms-flex-align: center; align-items: center; } [@media](http://twitter.com/media \u0026#34;Twitter profile for @media\u0026#34;) (min-width:576px) { .form-inline .form-control { display: inline-block; width: auto; vertical-align: middle; } } .btn { display: inline-block; font-weight: 400; text-align: center; white-space: nowrap; vertical-align: middle; border: 1px solid transparent; padding: 0.375rem 0.75rem; font-size: 1rem; line-height: 1.5; border-radius: 0.25rem; } .btn-primary { color: #fff; background-color: #007bff; border-color: #007bff; } .btn-outline-success { color: #28a745; background-color: transparent; background-image: none; border-color: #28a745; } .btn-lg { padding: 0.5rem 1rem; font-size: 1.25rem; line-height: 1.5; border-radius: 0.3rem; } .fade:not(.show) { opacity: 0; } .nav { display: -ms-flexbox; display: flex; -ms-flex-wrap: wrap; flex-wrap: wrap; padding-left: 0; margin-bottom: 0; list-style: none; } .nav-link { display: block; padding: 0.5rem 1rem; } .nav-tabs { border-bottom: 1px solid #dee2e6; } .nav-tabs .nav-item { margin-bottom: -1px; } .nav-tabs .nav-link { border: 1px solid transparent; border-top-left-radius: 0.25rem; border-top-right-radius: 0.25rem; } .nav-tabs .nav-link.active { color: #495057; background-color: #fff; border-color: #dee2e6 #dee2e6 #fff; } .tab-content \u0026gt; .tab-pane { display: none; } .tab-content \u0026gt; .active { display: block; } .navbar { position: relative; display: -ms-flexbox; display: flex; -ms-flex-wrap: wrap; flex-wrap: wrap; -ms-flex-align: center; align-items: center; -ms-flex-pack: justify; justify-content: space-between; padding: 0.5rem 1rem; } .navbar-nav { display: -ms-flexbox; display: flex; -ms-flex-direction: column; flex-direction: column; padding-left: 0; margin-bottom: 0; list-style: none; } .navbar-nav .nav-link { padding-right: 0; padding-left: 0; } [@media](http://twitter.com/media \u0026#34;Twitter profile for @media\u0026#34;) (min-width:992px) { .navbar-expand-lg { -ms-flex-flow: row nowrap; flex-flow: row nowrap; -ms-flex-pack: start; justify-content: flex-start; } .navbar-expand-lg .navbar-nav { -ms-flex-direction: row; flex-direction: row; } .navbar-expand-lg .navbar-nav .nav-link { padding-right: 0.5rem; padding-left: 0.5rem; } } .navbar-light .navbar-nav .nav-link { color: rgba(0, 0, 0, 0.5); } .navbar-light .navbar-nav .active \u0026gt; .nav-link { color: rgba(0, 0, 0, 0.9); } .jumbotron { padding: 2rem 1rem; margin-bottom: 2rem; background-color: #e9ecef; border-radius: 0.3rem; } [@media](http://twitter.com/media \u0026#34;Twitter profile for @media\u0026#34;) (min-width:576px) { .jumbotron { padding: 4rem 2rem; } } .bg-secondary { background-color: #6c757d !important; } .bg-light { background-color: #f8f9fa !important; } .my-2 { margin-top: 0.5rem !important; } .my-2 { margin-bottom: 0.5rem !important; } .mr-auto { margin-right: auto !important; } [@media](http://twitter.com/media \u0026#34;Twitter profile for @media\u0026#34;) (min-width:576px) { .my-sm-0 { margin-top: 0 !important; } .my-sm-0 { margin-bottom: 0 !important; } .mr-sm-2 { margin-right: 0.5rem !important; } } [@media](http://twitter.com/media \u0026#34;Twitter profile for @media\u0026#34;) (min-width:992px) { .my-lg-0 { margin-top: 0 !important; } .my-lg-0 { margin-bottom: 0 !important; } } \u0026lt;/style\u0026gt; \u0026lt;link rel=\u0026#34;preload\u0026#34; href=\u0026#34;[https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css](https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css)\u0026#34; integrity=\u0026#34;sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; as=\u0026#34;style\u0026#34; onload=\u0026#34;this.onload=null;this.rel=\u0026#39;stylesheet\u0026#39;\u0026#34; /\u0026gt; \u0026lt;noscript \u0026gt;\u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;[https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css](https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css)\u0026#34; integrity=\u0026#34;sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; /\u0026gt;\u0026lt;/noscript\u0026gt; \u0026lt;script\u0026gt; !(function (n) { \u0026#34;use strict\u0026#34;; n.loadCSS || (n.loadCSS = function () {}); var o = (loadCSS.relpreload = {}); if ( ((o.support = (function () { var e; try { e = n.document.createElement(\u0026#34;link\u0026#34;).relList.supports(\u0026#34;preload\u0026#34;); } catch (t) { e = !1; } return function () { return e; }; })()), (o.bindMediaToggle = function (t) { var e = t.media || \u0026#34;all\u0026#34;; function a() { t.media = e; } t.addEventListener ? t.addEventListener(\u0026#34;load\u0026#34;, a) : t.attachEvent \u0026amp;\u0026amp; t.attachEvent(\u0026#34;onload\u0026#34;, a), setTimeout(function () { (t.rel = \u0026#34;stylesheet\u0026#34;), (t.media = \u0026#34;only x\u0026#34;); }), setTimeout(a, 3e3); }), (o.poly = function () { if (!o.support()) for ( var t = n.document.getElementsByTagName(\u0026#34;link\u0026#34;), e = 0; e \u0026lt; t.length; e++ ) { var a = t[e]; \u0026#34;preload\u0026#34; !== a.rel || \u0026#34;style\u0026#34; !== a.getAttribute(\u0026#34;as\u0026#34;) || a.getAttribute(\u0026#34;data-loadcss\u0026#34;) || (a.setAttribute(\u0026#34;data-loadcss\u0026#34;, !0), o.bindMediaToggle(a)); } }), !o.support()) ) { o.poly(); var t = n.setInterval(o.poly, 500); n.addEventListener ? n.addEventListener(\u0026#34;load\u0026#34;, function () { o.poly(), n.clearInterval(t); }) : n.attachEvent \u0026amp;\u0026amp; n.attachEvent(\u0026#34;onload\u0026#34;, function () { o.poly(), n.clearInterval(t); }); } \u0026#34;undefined\u0026#34; != typeof exports ? (exports.loadCSS = loadCSS) : (n.loadCSS = loadCSS); })(\u0026#34;undefined\u0026#34; != typeof global ? global : this); \u0026lt;/script\u0026gt; \u0026lt;script defer src=\u0026#34;[https://code.jquery.com/jquery-3.3.1.slim.min.js](https://code.jquery.com/jquery-3.3.1.slim.min.js)\u0026#34; integrity=\u0026#34;sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; \u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script defer src=\u0026#34;[https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js](https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js)\u0026#34; integrity=\u0026#34;sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; \u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script defer src=\u0026#34;[https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js](https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js)\u0026#34; integrity=\u0026#34;sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; \u0026gt;\u0026lt;/script\u0026gt; \u0026lt;!--[if lt IE 9]\u0026gt; \u0026lt;script src=\u0026#34;[https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js](https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js)\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;![endif]--\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;!-- ... --\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; å¦‚æ‚¨æ‰€è§ï¼Œè¯¥å·¥å…·æ·»åŠ äº†ä¸€ä¸ªå¸¦æœ‰å¤§é‡ CSS çš„å†…è” \u0026lt;style\u0026gt; å…ƒç´ ã€‚è¯·æ³¨æ„ï¼Œè¿™ä¸æ˜¯ Bootstrap çš„å…¨éƒ¨ CSSï¼Œåªæ˜¯è¯¥å·¥å…·åˆ†æçš„ CSS å¯¹äºæ­¤é¡µé¢çš„åˆå§‹è§†å›¾æ˜¯å¿…éœ€çš„ã€‚ä»… Bootstrap çš„ç¼©å° CSS å°±æœ‰ 51 KB;è¿™ä¸ªæ–°çš„ HTML æ–‡ä»¶åŒ…æ‹¬æ‰€æœ‰ HTML ä»¥åŠæ–°å†…è”çš„ CSS å’Œ JavaScriptï¼Œæ˜¯ 12 KBã€‚è¿™ç§å‡å°çš„å¤§å°æ¯”çœ‹èµ·æ¥æ›´é‡è¦ - å°†åˆå§‹ HTML/CSS/JS ç½®äº 14 KB ä»¥ä¸‹å¯ä»¥ä½¿æ‚¨çš„ç½‘ç«™åœ¨æŸäº›æœ€æ…¢çš„è¿æ¥ä¸Šä»¥æ¯«ç§’ä¸ºå•ä½å‘ˆç°ã€‚è¿™æ˜¯å› ä¸ºæµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ¯æ¬¡å¾€è¿”ä¸€æ¬¡å¯ä»¥å‘é€å¤§çº¦ 14 KB - é€šè¿‡å°†æ‰€æœ‰å†…å®¹æ”¾å…¥ä¸€æ¬¡å¾€è¿”ä¸­ï¼Œæ‚¨å¯ä»¥é¿å…é¢å¤–å¾€è¿”çš„å¼€é”€ï¼ˆæ­¤å¤„æä¾›æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼‰ã€‚\nè¯¥å·¥å…·è¿˜åœ¨ CSS link å…ƒç´ ä¸Šæ·»åŠ äº† rel=\u0026quot;preload\u0026quot; å±æ€§ï¼Œä½¿ CSS æ–‡ä»¶èƒ½å¤Ÿå¼‚æ­¥åŠ è½½ã€‚è¿™é€šå¸¸æ˜¯æ‚¨ä¸æƒ³åšçš„äº‹æƒ… - å°½ç®¡å®ƒä¼šåŠ å¿«ç½‘ç«™é€Ÿåº¦ï¼Œä½†ç”¨æˆ·ä¼šé¦–å…ˆçœ‹åˆ°æ— æ ·å¼çš„çº¯ HTMLï¼Œç„¶ååœ¨åŠ è½½ CSS æ–‡ä»¶æ—¶çœ‹åˆ°æ ·å¼æ­£ç¡®çš„ç½‘ç«™ã€‚ä½†æ˜¯ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œç”±äºæˆ‘ä»¬æ­£åœ¨å†…è”å…³é”®çš„ CSSï¼Œè¿™ä¸æ˜¯é—®é¢˜ï¼Œå› æ­¤å¼‚æ­¥åŠ è½½å‰©ä½™çš„ CSS å¯ä»¥å®Œç¾åœ°å·¥ä½œï¼\nå®ç°æ„å»ºæ­¥éª¤ æ­¤æ—¶ï¼Œæ‚¨å¯ä»¥æ‰§è¡Œè¯¸å¦‚æ¯æ¬¡éƒ¨ç½²ç½‘ç«™æ—¶æ‰‹åŠ¨ç¼©å°å’Œè¿æ¥æ–‡ä»¶ä¹‹ç±»çš„æ“ä½œï¼Œä½†è¿™å°†æ˜¯ä¸€ä¸ªå·¨å¤§çš„ç—›è‹¦ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæ‚¨å°†ä½¿ç”¨å•ä¸ªå‘½ä»¤è‡ªåŠ¨æ‰§è¡Œè¿™ç»„ä»»åŠ¡ï¼Œè¿™ç§°ä¸ºç”Ÿæˆæ­¥éª¤ã€‚ç¼©å°å’Œä¸²è”åªæ˜¯ä¸¤ä¸ªå¯èƒ½çš„ä»»åŠ¡ - ä»»ä½•å¯ä»¥è‡ªåŠ¨åŒ–çš„é‡å¤æ€§ä»»åŠ¡ã€‚ä¸‹é¢æ˜¯ç”Ÿæˆæ­¥éª¤ä¸­çš„ä¸€äº›å…¸å‹ä»»åŠ¡ï¼š\nç¼©å° HTMLã€CSS å’Œ JavaScript\nè¿æ¥ JavaScript æ–‡ä»¶å’Œ CSS æ–‡ä»¶\nä¼˜åŒ–å›¾åƒï¼ˆé€šè¿‡è°ƒæ•´å¤§å°ã€åˆ é™¤æœªä½¿ç”¨çš„å…ƒæ•°æ®ç­‰ï¼‰\næ·»åŠ  CSS ä¾›åº”å•†å‰ç¼€ä»¥å®ç°æµè§ˆå™¨å…¼å®¹æ€§\nè½¬è¯‘ä»£ç ï¼ˆä» SASS åˆ° CSSï¼Œæˆ–ä» CoffeeScript åˆ° JSï¼Œç­‰ç­‰ï¼‰\nè¿è¡Œä»£ç æµ‹è¯•\nè¦å®ç°æ„å»ºæ­¥éª¤ï¼Œæ‚¨éœ€è¦é€‰æ‹©ä¸€ä¸ªå·¥å…·ï¼Œå¹¶ä¸”æœ‰å¾ˆå¤šå·¥å…·å¯ä¾›é€‰æ‹©ã€‚ä¸€ä¸ªæµè¡Œçš„é€‰æ‹©æ˜¯ Gruntï¼Œå®ƒäº 2012 å¹´å‘å¸ƒã€‚ç´§éšå…¶åçš„æ˜¯ Gulpï¼Œä»¥åŠ Broccoli.jsï¼ŒBrunch å’Œ webpackã€‚æˆªè‡³ 2018 å¹´ï¼Œwebpack ä¼¼ä¹æ˜¯æœ€å—æ¬¢è¿çš„é€‰æ‹©ï¼Œä½†æœ€ç»ˆè¿™äº›å·¥å…·ä¸­çš„ä»»ä½•ä¸€ä¸ªéƒ½å°†ç”¨äºå¾ˆå¥½åœ°å®ç°æ„å»ºæ­¥éª¤çš„ç›®çš„ã€‚\næ³¨æ„ï¼šä»å¤´å¼€å§‹å­¦ä¹ ä½¿ç”¨å·¥å…·è¿›è¡Œæ„å»ºæ­¥éª¤å¯èƒ½éå¸¸ä»¤äººç”Ÿç•ã€‚å¤§å¤šæ•°å·¥å…·éƒ½è¦æ±‚æ‚¨ä½¿ç”¨å‘½ä»¤è¡Œ â€” å¦‚æœæ‚¨ä»¥å‰ä»æœªä½¿ç”¨è¿‡ï¼Œæ‚¨å¯ä»¥é˜…è¯»æœ¬æ•™ç¨‹ä»¥è·å¾—å…¥é—¨çš„è‰¯å¥½æ¦‚è¿°ã€‚2018 å¹´è®¸å¤šæµè¡Œçš„ Web å¼€å‘äººå‘˜æ„å»ºå·¥å…·éƒ½æ˜¯åŸºäº node.js çš„â€”â€”å¦‚æœä½ ä¸ç†Ÿæ‚‰ node.js ç”Ÿæ€ç³»ç»ŸåŠå…¶åœ¨å‰ç«¯å¼€å‘ä¸­çš„ä½¿ç”¨ï¼Œä½ å¯ä»¥é˜…è¯»æˆ‘çš„æ–‡ç«  Modern JavaScript Explain For Dinosaursï¼Œäº†è§£è¿™æ–¹é¢çš„æ¦‚è¿°ã€‚\næ¨¡æ¿å’Œç»„ä»¶æé«˜å¯ç»´æŠ¤æ€§ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªä¸é”™çš„ç½‘é¡µï¼Œæ—¢æœ‰ç›¸å½“çš„å¸å¼•åŠ›ï¼Œåˆæœ‰æ€§èƒ½ã€‚ç°åœ¨å®ƒçœ‹èµ·æ¥åƒè¿™æ ·ï¼š\nåœ¨å¯¼èˆªæ ä¸­ï¼Œæœ‰ä¸€ä¸ªæŒ‡å‘â€œå…³äºâ€é¡µé¢çš„é“¾æ¥ï¼Œä½†å®ƒç›®å‰æ²¡æœ‰è½¬åˆ°ä»»ä½•åœ°æ–¹ã€‚å¦‚æœæˆ‘ä»¬æƒ³åˆ¶ä½œè¿™ä¸ªå…³äºé¡µé¢æ€ä¹ˆåŠï¼Ÿæœ€ç›´æ¥çš„ç­”æ¡ˆæ˜¯å¤åˆ¶åä¸º about.html çš„ index.html ï¼Œå¹¶ç›¸åº”åœ°æ›´æ–°å†…å®¹ã€‚å…·ä½“æ¥è¯´ï¼Œ \u0026lt;main\u0026gt; å…ƒç´ ä¸­çš„å†…å®¹å°†æ›´æ”¹ï¼ŒHTML çš„å…¶ä½™éƒ¨åˆ†å°†ä¿æŒä¸å˜ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ about.html é¡µé¢çš„æ ·å­ï¼š\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34; /\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1, shrink-to-fit=no\u0026#34; /\u0026gt; \u0026lt;meta name=\u0026#34;description\u0026#34; content=\u0026#34;\u0026#34; /\u0026gt; \u0026lt;meta name=\u0026#34;author\u0026#34; content=\u0026#34;\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;My test page\u0026lt;/title\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;[https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css](https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css)\u0026#34; integrity=\u0026#34;sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; /\u0026gt; \u0026lt;script defer src=\u0026#34;[https://code.jquery.com/jquery-3.3.1.slim.min.js](https://code.jquery.com/jquery-3.3.1.slim.min.js)\u0026#34; integrity=\u0026#34;sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; \u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script defer src=\u0026#34;[https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js](https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js)\u0026#34; integrity=\u0026#34;sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; \u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script defer src=\u0026#34;[https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js](https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js)\u0026#34; integrity=\u0026#34;sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy\u0026#34; crossorigin=\u0026#34;anonymous\u0026#34; \u0026gt;\u0026lt;/script\u0026gt; \u0026lt;!--[if lt IE 9]\u0026gt; \u0026lt;script src=\u0026#34;[https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js](https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js)\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;![endif]--\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;nav class=\u0026#34;navbar navbar-expand-lg navbar-light bg-light\u0026#34; role=\u0026#34;navigation\u0026#34; \u0026gt; \u0026lt;ul class=\u0026#34;navbar-nav mr-auto\u0026#34;\u0026gt; \u0026lt;li class=\u0026#34;nav-item active\u0026#34;\u0026gt; \u0026lt;a class=\u0026#34;nav-link\u0026#34; href=\u0026#34;#\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;nav-item\u0026#34;\u0026gt; \u0026lt;a class=\u0026#34;nav-link\u0026#34; href=\u0026#34;#\u0026#34;\u0026gt;Info\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;nav-item\u0026#34;\u0026gt; \u0026lt;a class=\u0026#34;nav-link\u0026#34; href=\u0026#34;#\u0026#34;\u0026gt;About\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;form class=\u0026#34;form-inline my-2 my-lg-0\u0026#34;\u0026gt; \u0026lt;input class=\u0026#34;form-control mr-sm-2\u0026#34; type=\u0026#34;text\u0026#34; placeholder=\u0026#34;Search\u0026#34; aria-label=\u0026#34;Search\u0026#34; /\u0026gt; \u0026lt;button class=\u0026#34;btn btn-outline-success my-2 my-sm-0\u0026#34; type=\u0026#34;submit\u0026#34;\u0026gt; Search \u0026lt;/button\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/nav\u0026gt; \u0026lt;main role=\u0026#34;main\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;About\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;Info about this site\u0026lt;/p\u0026gt; \u0026lt;/main\u0026gt; \u0026lt;footer class=\u0026#34;navbar navbar-dark bg-secondary\u0026#34; role=\u0026#34;contentinfo\u0026#34;\u0026gt; \u0026lt;p\u0026gt;Copyright info goes here\u0026lt;/p\u0026gt; \u0026lt;/footer\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; è¯·æ³¨æ„ï¼Œé™¤äº†çªå‡ºæ˜¾ç¤ºçš„å†…å®¹å¤–ï¼Œ about.html ä¸­çš„æ‰€æœ‰å†…å®¹éƒ½ä¸ index.html ç›¸åŒã€‚è™½ç„¶è¿™æœ‰æ•ˆï¼Œä½†ä»ç»´æŠ¤çš„è§’åº¦æ¥çœ‹ï¼Œå®ƒå˜å¾—æœ‰é—®é¢˜ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨è¿™ç§æŠ€æœ¯åˆ¶ä½œ 7 ä¸ªä¸åŒçš„é¡µé¢ï¼Œé‚£å°†æ˜¯å¤§é‡é‡å¤çš„ä»£ç ã€‚å¦‚æœæˆ‘ä»¬ä»¥åæƒ³å¯¹å¯¼èˆªæ è¿›è¡Œæ›´æ”¹ï¼Œåˆ™å¿…é¡»å°†æ›´æ”¹å¤åˆ¶åˆ°æ‰€æœ‰ 7 ä¸ªæ–‡ä»¶ä¸­ã€‚è¿™è¿åäº†ä¼—æ‰€å‘¨çŸ¥çš„è½¯ä»¶åŸåˆ™ï¼Œç§°ä¸º DRYï¼ˆä¸è¦é‡å¤è‡ªå·±ï¼‰ã€‚\nåœ¨æœåŠ¡å™¨ä¸Šæ„å»ºæ¨¡æ¿ æ­¤é—®é¢˜çš„ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨æ¨¡æ¿å¼•æ“ã€‚è¿™æ¶‰åŠåœ¨ HTML ä¸­ç¼–å†™éæ ‡å‡† HTMLï¼Œç„¶åå°†å…¶è¾“å…¥åˆ°ä¸€ä¸ªå•ç‹¬çš„ç¨‹åºä¸­ï¼Œè¯¥ç¨‹åºå°†ç”¨æ ‡å‡† HTML æ›¿æ¢éæ ‡å‡† HTMLã€‚æœ€å¥½ç”¨ä¸€ä¸ªä¾‹å­æ¥è§£é‡Šè¿™ä¸€ç‚¹ã€‚\nå‡è®¾ä½ æ­£åœ¨ä½¿ç”¨ PHPï¼Œè¿™æ˜¯æœ€æ—©è®¾è®¡ç”¨äº HTML çš„è¯­è¨€ä¹‹ä¸€ï¼ˆä»Šå¤©ä»ç„¶è¢«è®¸å¤šå¤§å…¬å¸ä½¿ç”¨ï¼‰ã€‚æ‚¨å°†åˆ›å»ºä¸€ä¸ª head.php æ–‡ä»¶ï¼ˆåŒ…å« \u0026lt;head\u0026gt; å…ƒç´ ä¸­çš„å†…å®¹ï¼‰ã€ header.php æ–‡ä»¶ï¼ˆåŒ…å«å¯¼èˆªæ å…ƒç´ ï¼‰å’Œ footer.php ï¼ˆåŒ…å«é¡µè„šå…ƒç´ ï¼‰ã€‚\næ‹¥æœ‰è¿™äº›æ–‡ä»¶åï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ª index.php æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;?php include(\u0026#34;head.php\u0026#34;);?\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;?php include(\u0026#34;header.php\u0026#34;);?\u0026gt; \u0026lt;main role=\u0026#34;main\u0026#34;\u0026gt; \u0026lt;section class=\u0026#34;jumbotron\u0026#34;\u0026gt;...\u0026lt;/section\u0026gt; \u0026lt;section class=\u0026#34;container\u0026#34;\u0026gt;...\u0026lt;/section\u0026gt; \u0026lt;/main\u0026gt; \u0026lt;?php include(\u0026#34;footer.php\u0026#34;);?\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; about.php æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;?php include(\u0026#34;head.php\u0026#34;);?\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;?php include(\u0026#34;header.php\u0026#34;);?\u0026gt; \u0026lt;main role=\u0026#34;main\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;About\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;Info about this site\u0026lt;/p\u0026gt; \u0026lt;/main\u0026gt; \u0026lt;?php include(\u0026#34;footer.php\u0026#34;);?\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; æ‰€ä»¥åœ¨è¿™é‡Œä½ å¯ä»¥çœ‹åˆ°å”¯ä¸€æ”¹å˜çš„éƒ¨åˆ†æ˜¯ä¸­é—´çš„å†…å®¹ã€‚å¦‚æœéœ€è¦æ›´æ–°é¡µçœ‰ã€é¡µè„šæˆ–å¤–éƒ¨ä¾èµ–é¡¹ï¼Œåˆ™åªéœ€æ›´æ”¹ä¸€æ¬¡ã€‚\nä¸Šé¢çš„ä»£ç æ˜¾ç„¶ä¸æ˜¯æœ‰æ•ˆçš„ HTML â€” æ‚¨éœ€è¦æŸç§æ„å»ºæ­¥éª¤æ¥å°† include è¯­å¥æ›¿æ¢ä¸ºå•ç‹¬æ–‡ä»¶ä¸­çš„ HTMLã€‚æˆ‘ä»¬å®é™…ä¸Šå¯ä»¥å°†å…¶åˆå¹¶åˆ°æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„æ„å»ºæ­¥éª¤ä¸­ï¼ˆç”¨äºä»£ç ç¼©å°ã€æ–‡ä»¶è¿æ¥ã€å…³é”® CSS ç­‰ï¼‰ã€‚ä½†æ˜¯ï¼Œä»æ¨¡æ¿ç”Ÿæˆ HTML çš„è¿™ä¸€æ­¥ä¼ ç»Ÿä¸Šæ˜¯åœ¨æœåŠ¡å™¨ä¸ŠåŠ¨æ€å®Œæˆçš„ã€‚\næ¥è‡ª wikipedia.org æœåŠ¡å™¨æ˜¯æ¥æ”¶ Web è¯·æ±‚å¹¶å°† HTML/CSS/JS ä½œä¸º Web å“åº”å‘é€å›çš„è®¡ç®—æœºï¼ˆä¸å®¢æˆ·ç«¯ç›¸åï¼Œå…·æœ‰å¯åŠ¨ Web è¯·æ±‚çš„ Web æµè§ˆå™¨çš„è®¡ç®—æœºï¼‰ã€‚æœåŠ¡å™¨é€šå¸¸è´Ÿè´£åŸºäºæ•°æ®åº“ä¸­çš„æ•°æ®åˆ›å»ºåŠ¨æ€ HTMLã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨åœ¨ www.google.com ä¸Šæœç´¢â€œçº¢è‰²é¦™è•‰â€ï¼Œåˆ™ä¸ä¼šæœ‰ä¸€äº›å…³äºçº¢è‰²é¦™è•‰çš„å”¯ä¸€ HTML æ–‡ä»¶ä»æœåŠ¡å™¨å‘é€ç»™æ‚¨ã€‚ç›¸åï¼ŒæœåŠ¡å™¨è¿è¡Œä»£ç ä»¥æ ¹æ®æ‚¨çš„æœç´¢è¯åŠ¨æ€åˆ›å»º HTML å“åº”ã€‚æ‰€ä»¥åœ¨è¿™é‡Œä½ å¯ä»¥ç”¨ä¸€å—çŸ³å¤´æ€æ­»ä¸¤åªé¸Ÿâ€”â€”å› ä¸ºä½ å·²ç»æœ‰ä¸€ä¸ªæ­¥éª¤åœ¨æœåŠ¡å™¨ä¸Šç”ŸæˆåŠ¨æ€ HTMLï¼Œä½ å¯ä»¥ä½¿ç”¨æ¨¡æ¿æ¥å®šä¹‰ç”Ÿæˆçš„ HTML æ¥ä¿æŒä½ çš„ä»£ç å¹²ç‡¥ã€‚\nåœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨æ¨¡æ¿æ„å»º HTML æ˜¯ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œåœ¨ç›¸å½“é•¿çš„ä¸€æ®µæ—¶é—´å†…ä¸€ç›´æ˜¯äº‹å®ä¸Šçš„æ ‡å‡†ã€‚é™¤äº† PHPï¼Œè¿˜æœ‰ Ruby on Rails æ¡†æ¶çš„ ERBï¼ŒPython çš„ Django æ¡†æ¶çš„ Django æ¨¡æ¿è¯­è¨€ï¼ŒNode\u0026rsquo;s Express æ¡†æ¶çš„EJSç­‰ã€‚è¿™ç§æ–¹æ³•å¯èƒ½éå¸¸ä»¤äººç”Ÿç•â€”â€”ä¸ºäº†åˆ©ç”¨æ¨¡æ¿å¼•æ“ç¼–å†™å¯ç»´æŠ¤çš„ä»£ç ï¼Œæ‚¨åŸºæœ¬ä¸Šé¦–å…ˆå¿…é¡»å­¦ä¹ æ•´ä¸ªç¼–ç¨‹è¯­è¨€å’Œ Web æ¡†æ¶ï¼å¦‚æœæ‚¨å·²ç»è®¡åˆ’ä½¿ç”¨æœåŠ¡å™¨å’Œæ•°æ®åº“ï¼Œé‚£ä¹ˆè¿™æ˜¯å¾ˆè‡ªç„¶çš„é€‰æ‹©ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨åªæ˜¯å¯¹åœ¨å‰ç«¯ç¼–å†™ HTML æ„Ÿå…´è¶£ï¼Œé‚£ä¹ˆè€å®è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„è¿›å…¥éšœç¢ã€‚\næ³¨æ„ï¼šå¦‚æœæ‚¨çš„ç½‘ç«™ä¸éœ€è¦æ•°æ®åº“ï¼Œåˆ™å¯ä»¥æ”¹ç”¨é™æ€ç½‘ç«™ç”Ÿæˆå™¨ï¼Œè¯¥ç”Ÿæˆå™¨ä½¿ç”¨æ¨¡æ¿æ¥æ„å»ºé™æ€ HTML æ–‡ä»¶ï¼ˆJekyllï¼ŒHugo å’Œ Gatsby æ˜¯ä¸€äº›æµè¡Œçš„é€‰æ‹©ï¼‰ã€‚ä¸æœåŠ¡å™¨ç«¯ Web æ¡†æ¶ç›¸æ¯”ï¼Œé™æ€ç«™ç‚¹ç”Ÿæˆå™¨å¯èƒ½æ›´æ˜“äºä½¿ç”¨;ä½†æ˜¯ï¼Œæ‚¨ä»ç„¶éœ€è¦å­¦ä¹ å•ç‹¬çš„ç¼–ç¨‹è¯­è¨€æˆ–ç¯å¢ƒï¼Œå› æ­¤ä¸ç¼–å†™çº¯ HTML ç›¸æ¯”ï¼Œè¿›å…¥ä»ç„¶å­˜åœ¨éšœç¢ã€‚\nåœ¨å®¢æˆ·ç«¯ä¸Šä½¿ç”¨ Web ç»„ä»¶ Web ç»„ä»¶äº 2011 å¹´é¦–æ¬¡å¼•å…¥ï¼Œä½œä¸ºè§£å†³ HTML å¯ç»´æŠ¤æ€§é—®é¢˜çš„å®Œå…¨ä¸åŒçš„æ–¹æ³•ã€‚Web ç»„ä»¶æ˜¯åœ¨å®¢æˆ·ç«¯è€Œä¸æ˜¯æœåŠ¡å™¨ä¸Šæ„å»ºçš„ï¼Œè¿™æ¶ˆé™¤äº†å¿…é¡»å­¦ä¹ æœåŠ¡å™¨ç«¯ç¼–ç¨‹è¯­è¨€å’Œ Web æ¡†æ¶æ¥ç¼–å†™å¯ç»´æŠ¤çš„ HTML çš„éšœç¢ã€‚\nWeb ç»„ä»¶çš„æ€»ä½“ç›®æ ‡æ˜¯èƒ½å¤Ÿåˆ›å»ºå¯é‡ç”¨çš„å°éƒ¨ä»¶ã€‚å›é¡¾å‰é¢çš„ç¤ºä¾‹ï¼Œæ‚¨å¯ä»¥åˆ›å»ºå¯¼èˆªæ ç»„ä»¶ã€é¡µçœ‰ç»„ä»¶å’Œé¡µè„šç»„ä»¶ã€‚æ›´è¿›ä¸€æ­¥ï¼Œæ‚¨å¯ä»¥ä¸ºé¡µé¢ä¸­çš„å†…å®¹åˆ›å»ºä¸€ä¸ªå·¨å‹ç»„ä»¶å’Œä¸€ä¸ªæ–‡ç« ç»„ä»¶ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ index.html ä¸­çš„ç»„ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; ... \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;navbar-component\u0026gt;\u0026lt;/navbar-component\u0026gt; \u0026lt;main role=\u0026#34;main\u0026#34;\u0026gt; \u0026lt;jumbotron-component\u0026gt;\u0026lt;/jumbotron-component\u0026gt; \u0026lt;section class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;articles-component\u0026gt;\u0026lt;/articles-component\u0026gt; \u0026lt;/section\u0026gt; \u0026lt;/main\u0026gt; \u0026lt;footer-component\u0026gt;\u0026lt;/footer-component\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ä¸ºäº†ä½¿å…¶æ­£å¸¸å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºè‡ªå®šä¹‰å…ƒç´ ï¼Œå…¶ä¸­æˆ‘ä»¬åŸºæœ¬ä¸Šæ˜¯ä¸º HTML è¯­è¨€å®šä¹‰æ–°å…ƒç´ ï¼ˆä»…é€‚ç”¨äºæ­¤ç‰¹å®šç½‘ç«™ï¼‰ã€‚è¦åˆ›å»ºè‡ªå®šä¹‰å…ƒç´ ï¼Œæ‚¨å¿…é¡»ä½¿ç”¨ JavaScriptã€‚ä¸‹é¢æ˜¯åˆ›å»ºå¯¼èˆªæ è‡ªå®šä¹‰å…ƒç´ æ‰€éœ€çš„ JavaScript ç¤ºä¾‹ï¼š\nwindow.customElements.define( \u0026#34;navbar-component\u0026#34;, class extends HTMLElement { connectedCallback() { this.innerHTML = ` \u0026lt;nav class=\u0026#34;navbar navbar-expand-lg navbar-light bg-light\u0026#34; role=\u0026#34;navigation\u0026#34;\u0026gt; \u0026lt;ul class=\u0026#34;navbar-nav mr-auto\u0026#34;\u0026gt; \u0026lt;li class=\u0026#34;nav-item active\u0026#34;\u0026gt; \u0026lt;a class=\u0026#34;nav-link\u0026#34; href=\u0026#34;#\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;nav-item\u0026#34;\u0026gt; \u0026lt;a class=\u0026#34;nav-link\u0026#34; href=\u0026#34;#\u0026#34;\u0026gt;Info\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;li class=\u0026#34;nav-item\u0026#34;\u0026gt; \u0026lt;a class=\u0026#34;nav-link\u0026#34; href=\u0026#34;#\u0026#34;\u0026gt;About\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;form class=\u0026#34;form-inline my-2 my-lg-0\u0026#34;\u0026gt; \u0026lt;input class=\u0026#34;form-control mr-sm-2\u0026#34; type=\u0026#34;text\u0026#34; placeholder=\u0026#34;Search\u0026#34; aria-label=\u0026#34;Search\u0026#34;\u0026gt; \u0026lt;button class=\u0026#34;btn btn-outline-success my-2 my-sm-0\u0026#34; type=\u0026#34;submit\u0026#34;\u0026gt;Search\u0026lt;/button\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/nav\u0026gt; `; } } ); JavaScript çœ‹èµ·æ¥æœ‰ç‚¹å¤æ‚ï¼ˆå®ƒä½¿ç”¨æ–°çš„ ES2015 è¯­è¨€åŠŸèƒ½ï¼‰ï¼Œä½†å®ƒåœ¨è¿™ä¸ªä¾‹å­ä¸­æ‰€åšçš„åªæ˜¯ä¸ºå¯¼èˆªæ å®šä¹‰ HTMLï¼ˆä¸Šé¢ä»¥ç²—ä½“æ˜¾ç¤ºï¼‰å¹¶å°†åç§° navbar-component æ³¨å†Œä¸ºè‡ªå®šä¹‰å…ƒç´ ã€‚è¯·æ³¨æ„ï¼ŒHTML æ˜¯ä½¿ç”¨æ¨¡æ¿æ–‡å­—åœ¨ JavaScript æ–‡ä»¶ä¸­å®šä¹‰çš„ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå·¨å¤§çš„å­—ç¬¦ä¸²â€”â€”å¦‚æœä½ æ›´å–œæ¬¢å°†å…¶ç§»å›å¸¸è§„ HTML æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†éœ€è¦ä¸€ä¸ªä¸åŒçš„æœºåˆ¶ï¼Œæˆ‘ä»¬å°†åœ¨ç¨åè®¨è®ºã€‚å¦‚æœæ‚¨å°†æ­¤ JavaScript æ·»åŠ åˆ°é¡µé¢ï¼Œæ‚¨ç°åœ¨å¯ä»¥åœ¨æ™®é€š HTML å…ƒç´ ä¹‹å¤–åˆ›å»º \u0026lt;navbar-component\u0026gt; ä¸ªå…ƒç´ ã€‚\nåˆ°ç›®å‰ä¸ºæ­¢ï¼Œåœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ­¤æ–¹æ³•ä¸æœåŠ¡å™¨ç«¯æ¨¡æ¿æ–¹æ³•ç›¸æ¯”æ²¡æœ‰å¤ªå¤§ä¼˜åŠ¿ã€‚ä½†æ˜¯ï¼Œå½“æ‚¨å¼€å§‹å‘æ¯ä¸ªç»„ä»¶æ·»åŠ  JavaScript åŠŸèƒ½å’Œ CSS æ ·å¼æ—¶ï¼Œå¥½å¤„å˜å¾—æ›´åŠ æ˜æ˜¾ã€‚Web ç»„ä»¶æä¾›äº†éš”ç¦»åŠŸèƒ½å’Œæ ·å¼çš„åŠŸèƒ½ï¼Œä»¥ä¿ç•™åœ¨æ¯ä¸ªç»„ä»¶ä¸­ï¼Œä½¿å®ƒä»¬å¯é‡ç”¨ â€” ä¸ä»…ç”¨äºæ­¤ç«™ç‚¹ï¼Œè€Œä¸”ç†è®ºä¸Šå¯ä»¥åœ¨å¤šä¸ªé¡¹ç›®ä¸­é‡ç”¨ã€‚è¿™ä¸ªæ¦‚å¿µå¯ä»¥åœ¨ç°æœ‰çš„ HTML å…ƒç´ ï¼ˆå¦‚ \u0026lt;video\u0026gt; å…ƒç´ ï¼‰ä¸­çœ‹åˆ°ã€‚å¦‚æœä½ åƒè¿™æ ·å†™ HTMLï¼š\n\u0026lt;video width=\u0026#34;320\u0026#34; height=\u0026#34;240\u0026#34; controls loop muted\u0026gt; \u0026lt;source src=\u0026#34;movie.mp4\u0026#34; type=\u0026#34;video/mp4\u0026#34; /\u0026gt; \u0026lt;source src=\u0026#34;movie.ogg\u0026#34; type=\u0026#34;video/ogg\u0026#34; /\u0026gt; \u0026lt;p\u0026gt; Your browser doesn\u0026#39;t support HTML5 video. Here is a \u0026lt;a href=\u0026#34;movie.mp4\u0026#34;\u0026gt;link to the video\u0026lt;/a\u0026gt; instead. \u0026lt;/p\u0026gt; \u0026lt;/video\u0026gt; ä½ ä¼šå¾—åˆ°ä¸€ä¸ªçœ‹èµ·æ¥åƒè¿™æ ·çš„è§†é¢‘æ’­æ”¾å™¨ï¼š\n*ï¼ˆè¿™æ˜¯è§†é¢‘çš„å›¾ç‰‡ï¼Œä¸æ˜¯å®é™…çš„è§†é¢‘ï¼‰* å…ƒç´ å¸¦æœ‰è‡ªå·±çš„ JavaScript äº¤äº’å¼æ§ä»¶å’Œ CSS æ ·å¼ï¼Œå®ƒä»¬ä¸é¡µé¢çš„å…¶ä½™éƒ¨åˆ†éš”ç¦»ã€‚è¿™æ„å‘³ç€å½“æ‚¨ä½¿ç”¨ å…ƒç´ æ—¶ï¼Œæ‚¨ä¸å¿…æ‹…å¿ƒå®ƒä¼šå½±å“æ‚¨ç½‘ç«™çš„æ ·å¼æˆ–åŠŸèƒ½ï¼Œä¹Ÿä¸å¿…æ‹…å¿ƒæ¥è‡ªç½‘ç«™çš„ä»»ä½• CSS æˆ– JavaScript ä¼šç ´åè§†é¢‘ç»„ä»¶ã€‚\nWeb ç»„ä»¶çš„ç›®æ ‡æ˜¯ä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿåˆ›å»ºè‡ªå·±çš„è‡ªå®šä¹‰ç»„ä»¶ï¼Œç±»ä¼¼äº \u0026lt;video\u0026gt; å…ƒç´ ï¼Œå¹¶å…·æœ‰æ‰€æœ‰éš”ç¦»å’Œå¯é‡ç”¨æ€§ä¼˜åŠ¿ã€‚ä»¥ä¸‹æ˜¯ Web ç»„ä»¶è§„èŒƒçš„æ‰€æœ‰éƒ¨åˆ†å¦‚ä½•ååŒå·¥ä½œï¼š\næ‚¨å¯ä»¥åœ¨ JavaScript ä¸­åˆ›å»ºè‡ªå®šä¹‰å…ƒç´ ï¼Œå¦‚å‰æ‰€è¿°ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥åœ¨ JavaScript ä¸­å®šä¹‰è‡ªå®šä¹‰åŠŸèƒ½ï¼Œå¹¶å°†å±æ€§ä» HTML ä¼ é€’åˆ°è‡ªå®šä¹‰å…ƒç´ ä¸­ã€‚\næ‚¨å¯ä»¥ä½¿ç”¨å½±å­ DOM ä½¿ç”¨ CSS è®¾ç½®è‡ªå®šä¹‰å…ƒç´ çš„æ ·å¼ï¼Œè¯¥æ ·å¼ä»…é€‚ç”¨äºå…ƒç´ è€Œä¸æ˜¯æ•´ä¸ªæ–‡æ¡£ï¼ˆè§£å†³ CSS æœ€å›°éš¾çš„æ–¹é¢ä¹‹ä¸€ï¼‰ã€‚\nå¦‚æœä½ ä¸æƒ³ç›´æ¥ç”¨ JavaScript ç¼–å†™æ‰€æœ‰çš„ HTMLï¼Œä½ å¯ä»¥ä½¿ç”¨ HTML æ¨¡æ¿ï¼Œåœ¨ \u0026lt;template\u0026gt; æ ‡è®°ä¸­å°†ç»„ä»¶çš„ HTML å†™å…¥æ™®é€š HTML æ–‡ä»¶ä¸­ï¼Œåœ¨è¢« JavaScript è°ƒç”¨ä¹‹å‰ä¸ä¼šå‘ˆç°ã€‚\nè¦ç»„ç»‡ä»£ç ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ HTML å¯¼å…¥ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­å°†å®šä¹‰ç»„ä»¶æ‰€éœ€çš„æ‰€æœ‰ HTMLã€CSS å’Œ JavaScript æ”¾å…¥åä¸º navbar-component.html çš„æ–‡ä»¶ä¸­ï¼Œç„¶åå°†å…¶å¯¼å…¥ä¸» HTML æ–‡ä»¶ä¸­ï¼Œå°±åƒå¯¼å…¥å¤–éƒ¨ CSS æ–‡ä»¶ä¸€æ ·ï¼š\u0026lt;link rel=\u0026quot;import\u0026quot; href=\u0026quot;navbar-component.html\u0026quot;\u0026gt;.\nå½“ Web ç»„ä»¶åœ¨ 2011 å¹´é¦–æ¬¡å‘å¸ƒæ—¶ï¼Œè®¸å¤šå¼€å‘äººå‘˜å¯¹è¿™äº›å¯èƒ½æ€§æ„Ÿåˆ°å…´å¥‹ã€‚è™½ç„¶æœåŠ¡å™¨ç«¯æ¨¡æ¿åŒ–æ–¹æ³•æœ‰åŠ©äºè§£å†³ HTML çš„ä¸€äº›å¯ç»´æŠ¤æ€§é—®é¢˜ï¼Œä½† Web ç»„ä»¶æä¾›äº†å®Œå…¨ä¸åŒçš„ä¸œè¥¿ - æ‰©å±• HTML çš„æ‰¿è¯ºå°†å…·æœ‰å®Œæ•´çš„å¯é‡ç”¨å°éƒ¨ä»¶ã€‚è¿™æ˜¯ä½¿ Web å¹³å°æˆä¸ºå¯ä»¥å¼€å‘å¤æ‚åº”ç”¨ç¨‹åºçš„åœ°æ–¹æ‰€ç¼ºå°‘çš„éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯æœ€åˆè®¾è®¡çš„ç®€å•é™æ€å†…å®¹ç«™ç‚¹ã€‚\né‚£ä¹ˆå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿåœ¨æ¥ä¸‹æ¥çš„å‡ å¹´é‡Œï¼Œå¾ˆæ˜æ˜¾ï¼Œæµè§ˆå™¨å¹¶æ²¡æœ‰å°± Web ç»„ä»¶ä½œä¸ºæ ‡å‡†è¾¾æˆä¸€è‡´ã€‚æˆªè‡³ 2018 å¹´ï¼Œå‡ ä¹æ²¡æœ‰æµè§ˆå™¨å®Œå…¨æ”¯æŒä¸Šè¿° Web ç»„ä»¶çš„å››ä¸ªä¸»è¦åŠŸèƒ½ï¼Œè¿™æ˜¯ç”±äºå®ç°æ€§èƒ½çš„æ½œåœ¨é—®é¢˜ï¼Œæ ‡å‡†å†²çªå’Œä¸åŒçš„å…¬å¸åˆ©ç›Šã€‚è¿™è®©å¼€å‘äººå‘˜å¤„äºä¸€ä¸ªæœ‰è¶£çš„ä½ç½® - å‡ ä¹æ¯ä¸ªäººéƒ½åŒæ„ç»„ä»¶æ ·å¼æ–¹æ³•æ˜¯å°† Web ä»é™æ€ç«™ç‚¹è½¬ç§»åˆ°å¤æ‚åº”ç”¨ç¨‹åºçš„å¿…è¦éƒ¨åˆ†ï¼Œä½†ç­‰å¾…æµè§ˆå™¨æ”¯æŒä¼¼ä¹æ˜¯å¾’åŠ³çš„ã€‚æ€ä¹ˆåŠï¼Ÿ\nåœ¨å®¢æˆ·ç«¯ä¸Šä½¿ç”¨ JavaScript æ¡†æ¶ å½“ HTML Web ç»„ä»¶è§„èŒƒä¸ä¼šå¾ˆå¿«å®ç°æ—¶ï¼ŒJavaScript å·²ç»æ˜¯ä¸€ç§è¶³å¤Ÿå¼ºå¤§çš„è¯­è¨€æ¥å¼¥è¡¥è¿™ä¸€ç¼ºé™·ã€‚å¼€å‘äººå‘˜ä¸€ç›´åœ¨ä½¿ç”¨ jQuery åº“ï¼ˆ2006 å¹´å‘å¸ƒï¼‰åˆ¶ä½œå¤æ‚çš„åº”ç”¨ç¨‹åºï¼Œå°½ç®¡å¾ˆéš¾ä¸ºå¤§è§„æ¨¡åº”ç”¨ç¨‹åºç»„ç»‡ä»£ç ã€‚Backbone.jsï¼ˆ2010 å¹´å‘å¸ƒï¼‰æ˜¯æœ€æ—©çš„æµè¡Œåº“ä¹‹ä¸€ï¼Œæ—¨åœ¨ä¸ºå¤§å‹å•é¡µåº”ç”¨ç¨‹åºæä¾›ç»„ç»‡ä»£ç çš„æ¡†æ¶ï¼Œå…¶æ¬¡æ˜¯ AngularJSï¼ŒEmber.js ç­‰ã€‚\næ‰€æœ‰è¿™äº›æ¡†æ¶éƒ½ä¸ç°æœ‰çš„ JavaScript åŠŸèƒ½ä¸€èµ·å·¥ä½œ - å®ƒä»¬ä¸å¿…ä¾èµ–äºç­‰å¾…æµè§ˆå™¨æ¥å®ç° Web ç»„ä»¶è§„èŒƒã€‚ä½†æ˜¯æ²¡æœ‰ä¸€ä¸ªæ¡†æ¶ä½¿ç”¨çœŸæ­£çš„å­¤ç«‹å’Œå¯é‡ç”¨çš„ç»„ä»¶ï¼›å¦‚æœæ²¡æœ‰ Web ç»„ä»¶è§„èŒƒçš„ 4 ä¸ªéƒ¨åˆ†ï¼ˆè‡ªå®šä¹‰å…ƒç´ ã€å½±å­ DOMã€HTML æ¨¡æ¿å’Œ HTML å¯¼å…¥ï¼‰ï¼Œè¿™ä¼¼ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚\n2013 å¹´ï¼Œä¸€ä¸ªåä¸º React çš„æ¡†æ¶å‘å¸ƒï¼Œå®ƒå¯¹è¿™ç§æƒ…å†µæœ‰ä¸€ä¸ªæœ‰è¶£çš„çœ‹æ³•ã€‚ä»–ä»¬èƒ½å¤Ÿä½¿ç”¨ä»¥ä¸‹æ–¹æ³•åœ¨æ²¡æœ‰ Web ç»„ä»¶è§„èŒƒçš„æƒ…å†µä¸‹åˆ¶ä½œä¸€ä¸ªçœŸæ­£çš„åŸºäºç»„ä»¶çš„æ¡†æ¶ï¼š\nReact æ²¡æœ‰ä½¿ç”¨ Web ç»„ä»¶çš„è‡ªå®šä¹‰å…ƒç´ è§„èŒƒï¼Œè€Œæ˜¯é‡‡ç”¨äº†åœ¨ JavaScript ä¸­å®šä¹‰æ‰€æœ‰ HTML çš„æ–¹æ³•ã€‚ä»æœ¬è´¨ä¸Šè®²ï¼Œæ‚¨å°†å®šä¹‰ JavaScript å‡½æ•°ä»¥ä½¿ç”¨ç§°ä¸º JSX çš„ç‰¹æ®Šè¯­æ³•è¾“å‡ºæ‰€éœ€çš„ HTMLï¼ˆå®ƒçœ‹èµ·æ¥åƒ HTMLï¼Œä½†ä½¿ç”¨æ„å»ºæ­¥éª¤è½¬æ¢ä¸º JavaScript å‡½æ•°ï¼‰ã€‚ React æ²¡æœ‰ä½¿ç”¨ Web ç»„ä»¶çš„ HTML æ¨¡æ¿è§„èŒƒï¼Œè€Œæ˜¯æ²¡æœ‰æä¾›åœ¨ JavaScript ä¹‹å¤–ç¼–å†™ HTML çš„æ–¹æ³•ã€‚ React æ²¡æœ‰ä½¿ç”¨ Web ç»„ä»¶çš„ HTML å¯¼å…¥è§„èŒƒï¼Œè€Œæ˜¯é‡‡ç”¨äº†å°† JavaScript å¯¼å…¥ JavaScript çš„æ–¹æ³•ã€‚è¿™åœ¨å½“æ—¶å®é™…ä¸Šå¹¶ä¸ç›´æ¥å¯è¡Œï¼Œä½†åƒBrowserify å’Œ webpackè¿™æ ·çš„å·¥å…·å…è®¸å¼€å‘äººå‘˜åœ¨ ä»–ä»¬çš„ JavaScript ä¸­ç¼–å†™ require æˆ– import è¯­å¥ï¼Œè¿™äº›è¯­å¥å°†åœ¨æ„å»ºæ—¶è½¬æ¢ä¸ºå•ä¸ª JavaScript åŒ…ã€‚ ä»æœ¬è´¨ä¸Šè®²ï¼Œè¿™é‡Œçš„è§è§£æ˜¯ï¼Œæ‚¨å¯ä»¥é€šè¿‡åœ¨ JavaScript ä¸­æ‰§è¡Œæ‰€æœ‰æ“ä½œæ¥ä½¿ç»„ä»¶å·¥ä½œã€‚è¯·æ³¨æ„ï¼Œè¿™é‡Œç¼ºå°‘ Web ç»„ä»¶è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œå³å½±å­ DOMâ€”â€”React åœ¨é¦–æ¬¡å‘å¸ƒæ—¶æ²¡æœ‰éš”ç¦»æ ·å¼çš„è§£å†³æ–¹æ¡ˆã€‚å°½ç®¡å¦‚æ­¤ï¼Œå®ƒè¶³ä»¥ä¸ºä»Šå¤©ä½¿ç”¨ç»„ä»¶æ„å»ºåº”ç”¨ç¨‹åºæä¾›ä¸€ä¸ªæ¡†æ¶ã€‚\nè¿™å°±æ˜¯ JavaScript ä½¿ç”¨ React åˆ¶ä½œå¯¼èˆªæ ç»„ä»¶çš„æ ·å­ï¼š\nimport React, { Component } from \u0026#34;react\u0026#34;; class Navbar extends Component { render() { return ( \u0026lt;nav className=\u0026#34;navbar navbar-expand-lg navbar-light bg-light\u0026#34; role=\u0026#34;navigation\u0026#34; \u0026gt; \u0026lt;ul className=\u0026#34;navbar-nav mr-auto\u0026#34;\u0026gt; \u0026lt;li className=\u0026#34;nav-item active\u0026#34;\u0026gt; \u0026lt;a className=\u0026#34;nav-link\u0026#34; href=\u0026#34;#\u0026#34;\u0026gt; Home \u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;li className=\u0026#34;nav-item\u0026#34;\u0026gt; \u0026lt;a className=\u0026#34;nav-link\u0026#34; href=\u0026#34;#\u0026#34;\u0026gt; Info \u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;li className=\u0026#34;nav-item\u0026#34;\u0026gt; \u0026lt;a className=\u0026#34;nav-link\u0026#34; href=\u0026#34;#\u0026#34;\u0026gt; About \u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;form className=\u0026#34;form-inline my-2 my-lg-0\u0026#34;\u0026gt; \u0026lt;input className=\u0026#34;form-control mr-sm-2\u0026#34; type=\u0026#34;text\u0026#34; placeholder=\u0026#34;Search\u0026#34; aria-label=\u0026#34;Search\u0026#34; /\u0026gt; \u0026lt;button className=\u0026#34;btn btn-outline-success my-2 my-sm-0\u0026#34; type=\u0026#34;submit\u0026#34; \u0026gt; Search \u0026lt;/button\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/nav\u0026gt; ); } } export default Navbar; è¿™ä¸å‰é¢æ˜¾ç¤ºçš„è‡ªå®šä¹‰å…ƒç´ ç¤ºä¾‹æ²¡æœ‰å¤ªå¤§åŒºåˆ«ï¼ˆå°½ç®¡ JSX è¯­æ³•åœ¨å¤§å¤šæ•°å¼€å‘äººå‘˜ç¬¬ä¸€æ¬¡çœ‹åˆ°å®ƒæ—¶éƒ½æ„Ÿåˆ°ä¸å®‰ï¼‰ã€‚React ä¸­çš„æƒ³æ³•æ˜¯å°†å…¶åˆ†è§£ä¸ºè¿›ä¸€æ­¥çš„å­ç»„ä»¶ï¼Œè¿™æ ·æ¯ä¸ªç»„ä»¶åªåšä¸€ä»¶äº‹ã€‚\nå½“ React é¦–æ¬¡å‘å¸ƒæ—¶ï¼Œå®ƒé­åˆ°äº†å¾ˆå¤šæ‰¹è¯„ï¼Œç‰¹åˆ«æ˜¯å› ä¸ºå®ƒä¼¼ä¹ç¼ºä¹å…³æ³¨ç‚¹åˆ†ç¦»ï¼ˆå¼€å‘äººå‘˜è¢«æ•™å¯¼å°† HTMLã€CSS å’Œ JS å®Œå…¨åˆ†å¼€ä»¥å®ç°å¯ç»´æŠ¤æ€§ï¼‰ã€‚ç„¶è€Œï¼ŒReact æå‡ºäº†è¿™æ ·ä¸€ä¸ªè§‚ç‚¹ï¼Œå³å¯¹äºå¤æ‚çš„ Web åº”ç”¨ç¨‹åºï¼Œå…³æ³¨ç‚¹çš„åˆ†ç¦»ä¸æ˜¯å…³äºæŠ€æœ¯ï¼ˆHTMLï¼ŒCSS å’Œ JSï¼‰ä¹‹é—´çš„è¾¹ç•Œï¼Œè€Œæ˜¯å…³äºåŠŸèƒ½å•å…ƒï¼ˆæ¢å¥è¯è¯´ï¼Œç»„ä»¶ï¼‰ä¹‹é—´çš„è¾¹ç•Œã€‚\né™¤äº†ä½œä¸ºä¸€ä¸ªåŸºäºç»„ä»¶çš„æ¡†æ¶ä¹‹å¤–ï¼ŒReact è¿˜å¸¦æ¥äº†å…³äºå¦‚ä½•ä½¿ç”¨å£°æ˜æ€§æ–¹æ³•ç®¡ç†åº”ç”¨ç¨‹åºä¸­æ•°æ®çš„å¼ºçƒˆæ„è§ã€‚è¿™æ„å‘³ç€ä½¿ç”¨ Reactï¼Œæ‚¨æ— éœ€ç¼–å†™ä»£ç å³å¯ç›´æ¥æ›´æ–°æ¥å£ã€‚ç›¸åï¼Œä½ å®šä¹‰æ¥å£åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­ï¼ˆä½¿ç”¨ JSXï¼‰ï¼Œç¼–å†™ä»£ç æ¥æ›´æ–°æ•°æ®ï¼Œç„¶åè®© React å¼„æ¸…æ¥šå¦‚ä½•ä½¿ç”¨å…¶è™šæ‹Ÿ DOM å®ç°æœ‰æ•ˆåœ°æ›´æ–°å’Œæ¸²æŸ“æ¥å£ï¼ˆä¸è¦ä¸å½±å­ DOM æ··æ·†ï¼‰ã€‚è¿™æ˜¯ Web æ¡†æ¶è®¾è®¡çš„ä¸€ä¸ªé‡å¤§è½¬å˜ï¼Œå½±å“åŠ›å¤§åˆ°æ¯ä¸ªä¸»è¦æ¡†æ¶éƒ½å…¬å¼€å€Ÿç”¨äº† React ä½¿ç”¨ è™šæ‹Ÿ DOM å®ç°çš„å£°æ˜å¼æ–¹æ³• â€” Emberã€Angularã€Vue.jsï¼Œç­‰ç­‰ã€‚æˆªè‡³ 2018 å¹´ï¼ŒWeb å¼€å‘ç¤¾åŒºå·²åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæ¥å—è¿™ç§èŒƒå¼ä½œä¸ºæ„å»ºç°ä»£ Web åº”ç”¨ç¨‹åºçš„æ–¹å¼ã€‚\nè¯·æ³¨æ„ï¼Œä»¥æ¸…æ™°ä¸”å¯ç»´æŠ¤çš„æ–¹å¼ç¼–å†™ HTML çš„æ„¿æœ›ä½¿æˆ‘ä»¬è¿›å…¥äº†ä¸€ä¸ªéœ€è¦å¤§é‡ç¼–ç¨‹çŸ¥è¯†çš„åœ°æ–¹;å‡ ä¹ä¸å¯èƒ½ç‰¹åˆ«é¿å… JavaScriptã€‚ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œè¿™æ‰“ç ´äº† HTML çš„æ‰¿è¯ºï¼ŒHTML è¢«è®¾è®¡æˆä¸€ç§ä¸éœ€è¦ç†è§£ç¼–ç¨‹å°±å¯ä»¥æœ‰æ•ˆä½¿ç”¨çš„è¯­è¨€ã€‚æœªæ¥å¯èƒ½ä¼šæœ‰å¼€å‘äººå‘˜å¯ä»¥åœ¨çº¯ HTML ä¸­å…±äº«é¢„å…ˆæ„å»ºçš„ Web ç»„ä»¶ï¼Œä½†æœªæ¥å¯èƒ½éœ€è¦ç›¸å½“é•¿çš„æ—¶é—´æ‰èƒ½åˆ°æ¥ã€‚\næœ¬èŠ‚ä»…ç®€è¦æ¦‚è¿°äº† React å’Œå…¶ä»–ç±»ä¼¼æ¡†æ¶é‡‡ç”¨çš„å‰ç«¯æ–¹æ³•ã€‚å¦‚æœä½ æƒ³è¦æ›´å®Œæ•´çš„è§£é‡Šå’Œæ•™ç¨‹ï¼Œå…³äºå¦‚ä½•ä½¿ç”¨å„ç§ JavaScript æ¡†æ¶å’Œæ–¹æ³•æ„å»ºä¸€ä¸ªå·¥ä½œçš„åº”ç”¨ç¨‹åºï¼Œè¯·æŸ¥çœ‹æˆ‘çš„ç³»åˆ—æ¯”è¾ƒå‰ç«¯æ–¹æ³•ï¼šçœ‹çœ‹ jQueryï¼ŒVue.jsï¼ŒReact å’Œ Elmã€‚\nç»“è®º ç®€è€Œè¨€ä¹‹ï¼Œè¿™å°±æ˜¯ç°ä»£ HTMLã€‚æˆ‘ä»¬ä»‹ç»äº†ä½¿ç”¨é€‚å½“çš„æ ‡ç­¾å’Œ aria å±æ€§ç¼–å†™è¯­ä¹‰å’Œå¯è®¿é—®çš„å†…å®¹ï¼Œä½¿ç”¨ CSS å’Œ JavaScript æ·»åŠ æ ·å¼å’ŒåŠ¨æ€åŠŸèƒ½ï¼Œä½¿ç”¨ HTML å±æ€§å’Œå·¥å…·æé«˜æ€§èƒ½ï¼Œæœ€åä½¿ç”¨æ¨¡æ¿å’Œç»„ä»¶æ¥æé«˜å¯ç»´æŠ¤æ€§ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¦å……åˆ†åˆ©ç”¨ç°ä»£ HTMLï¼Œå‡ ä¹ä¸å¯èƒ½é¿å…ä½¿ç”¨æ„å»ºè¿‡ç¨‹ä»¥åŠæŸç§å½¢å¼çš„ç‹¬ç«‹ç¼–ç¨‹è¯­è¨€ï¼Œå¯¹äºå¤§å¤šæ•°æ–¹æ³•æ¥è¯´ï¼Œè¿™é€šå¸¸æ˜¯ JavaScriptã€‚\nä»é«˜å±‚æ¬¡æ¥çœ‹å®ƒæœ‰æ—¶ä¼šä»¤äººæ²®ä¸§â€”â€”è¿‡å»æ˜¯ä¸€ä¸ªç®€å•æ˜“ç”¨çš„å·¥ä½œï¼ˆç”¨ HTML åˆ¶ä½œç½‘ç«™ï¼‰ç°åœ¨å˜å¾—å¤æ‚ä¸”ä¼¼ä¹éš¾ä»¥æ¥è¿‘ï¼ˆä½¿ç”¨ JavaScript å‰ç«¯æ¡†æ¶åˆ¶ä½œ Web åº”ç”¨ç¨‹åºï¼Œä½¿ç”¨å…·æœ‰æ•°åƒä¸ªæ½œåœ¨è„†å¼±ä¾èµ–é¡¹çš„æ„å»ºè¿‡ç¨‹ï¼‰ã€‚ç„¶è€Œï¼Œé‡è¦çš„æ˜¯è¦æ³¨æ„ï¼ŒWeb å¼€å‘ä½œä¸ºä¸€ä¸ªè¡Œä¸šåªå­˜åœ¨äº†å¤§çº¦ 30 å¹´ - ä¸å…¶ä»–è¡Œä¸šï¼ˆä¾‹å¦‚å·²ç»å­˜åœ¨äº†è®¸å¤šä¸–çºªçš„å»ºç­‘ï¼‰ç›¸æ¯”ï¼Œè¿™åªæ˜¯å†å²çš„ä¸€å°éƒ¨åˆ†ã€‚å°±å¥½åƒ Web å¼€å‘äººå‘˜åˆšåˆšå­¦ä¼šäº†å¦‚ä½•ç”¨ç²˜åœŸå»ºé€ æˆ¿å±‹ï¼Œç°åœ¨è¢«è¦æ±‚ä½¿ç”¨ç›¸åŒçš„å·¥å…·æ¥å»ºé€ æ‘©å¤©å¤§æ¥¼ã€‚æˆ‘ä»¬çš„å·¥å…·å’Œæµç¨‹ä¸æ–­å‘å±•æ˜¯å¾ˆè‡ªç„¶çš„;æˆ‘ä»¬åªéœ€è¦ç¡®ä¿å®ƒä»¥ä¸€ç§åŒ…å®¹ç½‘ç»œä½œä¸ºæ°‘ä¸»å¹³å°çš„æœ€åˆæ„¿æ™¯çš„æ–¹å¼å‘å±•ã€‚\nç°ä»£ HTML çš„ä½¿ç”¨è‚¯å®šä¼šä»¤äººæ²®ä¸§ï¼Œå› ä¸ºå®ƒç»§ç»­å¿«é€Ÿå˜åŒ–å’Œå‘å±•ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ç°åœ¨èƒ½å¤Ÿåšçš„æ¯”ä»¥å¾€ä»»ä½•æ—¶å€™éƒ½å¤šï¼Œè€Œä¸”æˆ‘ä»¬åŸºæœ¬ä¸Šéƒ½å¤„äºä¸€ä¸ªæ–°è¡Œä¸šçš„åº•å±‚ï¼Œæœ‰å¯èƒ½å°†å…¶å¡‘é€ æˆæˆ‘ä»¬å¸Œæœ›å®ƒæˆä¸ºçš„å¹³å°ã€‚ä½œä¸ºä¸€åå¼€å‘äººå‘˜ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¿€åŠ¨äººå¿ƒçš„æ—¶åˆ»ï¼Œæˆ‘å¸Œæœ›è¿™äº›ä¿¡æ¯å¯ä»¥ä½œä¸ºè·¯çº¿å›¾ï¼Œåœ¨æ‚¨çš„æ—…ç¨‹ä¸­ä¸ºæ‚¨æä¾›å¸®åŠ©ï¼\nç‰¹åˆ«æ„Ÿè°¢ @ryanqnorth çš„ æé¾™æ¼«ç”»ï¼Œè‡ª 2003 å¹´ä»¥æ¥ï¼ˆæé¾™ç»Ÿæ²»ç½‘ç»œï¼‰ä»¥æ¥ï¼Œå®ƒæä¾›äº†ä¸€äº›æœ€å¥½çš„è’è¯å¹½é»˜ã€‚\nå¯¹è¿™ç§å­¦ä¹ æ–¹å¼æ„Ÿå…´è¶£ï¼Ÿè¯·åŠ¡å¿…æŸ¥çœ‹ Actualize ç¼–ç è®­ç»ƒè¥ï¼ˆæˆ‘æ˜¯æ•™å­¦ä¸»ä»»å’Œé¦–å¸­è®²å¸ˆï¼‰ã€‚æˆ‘ä»¬åœ¨èŠåŠ å“¥æä¾› é¢å¯¹é¢çš„è¯¾ç¨‹ ä»¥åŠ å®æ—¶åœ¨çº¿è¯¾ç¨‹ï¼Œä»¥å¸®åŠ©äººä»¬è¿‡æ¸¡åˆ°ç°ä»£ç½‘ç»œå¼€å‘äººå‘˜çš„æ–°èŒä¸šï¼\nåŸæ–‡é“¾æ¥ï¼šhttps://peterxjang.com/blog/modern-html-explained-for-dinosaurs.html\n","permalink":"https://blog.chensoul.cc/posts/2023/06/20/modern-html-explained-for-dinosaurs/","summary":"åœ¨ä¸‰ç§ä¸»è¦çš„å‰ç«¯æŠ€æœ¯ï¼ˆ HTMLï¼ŒCSS å’Œ JavaScript ï¼‰ä¸­ï¼ŒHTML ä»ç„¶æ˜¯æœ€ä¸€è‡´çš„ã€‚å¦‚æœæ‚¨å”¯ä¸€å…³å¿ƒçš„æ˜¯åˆ›å»ºå†…å®¹ï¼Œé‚£ä¹ˆ 1990 å¹´ä»£çš„ HTML æ–‡æ¡£çœ‹èµ·æ¥ä¸ 2018 å¹´åˆ›å»ºçš„æ–‡æ¡£éå¸¸ç›¸ä¼¼ï¼š\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;My test page\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;Hello there!\u0026lt;/h1\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ä½ æœ‰å¸¦æœ‰æ ‡ç­¾å’Œå†…å®¹çš„å…ƒç´ ï¼Œå¸¦æœ‰å±æ€§çš„æ ‡ç­¾â€”â€”é™¤äº†ç¬¬ä¸€è¡Œçš„ç®€åŒ–æ–‡æ¡£ç±»å‹å¤–ï¼Œæ²¡æœ‰å¤ªå¤§å˜åŒ–ï¼ç„¶è€Œï¼Œå¤šå¹´æ¥ï¼ŒWeb å¼€å‘å·²ç»å‘ç”Ÿäº†å·¨å¤§çš„è½¬å˜ï¼Œä»åˆ›å»ºé™æ€ç½‘ç«™ï¼ˆä¸“æ³¨äºå†…å®¹ï¼‰åˆ°åˆ›å»ºåŠ¨æ€ Web åº”ç”¨ç¨‹åºï¼ˆä¸“æ³¨äºäº¤äº’ï¼‰â€”â€”è¿™æ˜¯ Web æœ€åˆè®¾è®¡çš„ç›®çš„ã€‚åˆ›å»ºä»ç„¶è¯­ä¹‰å’Œå¯è®¿é—®çš„è‡ªå®šä¹‰ç”¨æˆ·ç•Œé¢ï¼Œä½¿ç”¨å±æ€§å’Œå·¥å…·æé«˜æ€§èƒ½ï¼Œç»„ç»‡ä»£ç ä»¥è¿›è¡Œé‡ç”¨å’Œå¯ç»´æŠ¤æ€§ - ç°åœ¨æœ‰ä¸€ç»„å…¨æ–°çš„é—®é¢˜åœ¨èµ·ä½œç”¨ã€‚\næœ¬æ–‡çš„ç›®çš„æ˜¯æä¾›ä¸€ä¸ªå†å²èƒŒæ™¯ï¼Œè¯´æ˜ HTML å¦‚ä½•åœ¨ 2018 å¹´æ¼”å˜æˆä»Šå¤©çš„è¯­è¨€ã€‚æˆ‘ä»¬å°†ä»ç»“æ„è‰¯å¥½ä¸”æ˜“äºè®¿é—®çš„ HTML çš„åŸºç¡€çŸ¥è¯†å¼€å§‹ï¼Œå°±åƒå¤ä»£çš„æé¾™ä¸€æ ·ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¸åŒçš„æŠ€æœ¯æ¥æé«˜æ€§èƒ½ã€å“åº”èƒ½åŠ›å’Œå¯ç»´æŠ¤æ€§ã€‚CSS å’Œ JavaScript å°†ä¸å¯é¿å…åœ°è¿›å…¥è¿™ä¸ªå¯¹è¯ï¼›å‡ºäºæœ¬æ–‡çš„ç›®çš„ï¼Œå°†ä»å®ƒä»¬å¦‚ä½•å½±å“ HTML æœ¬èº«ç¼–å†™çš„è§’åº¦æ¥ä»‹ç»å®ƒä»¬ã€‚é€šè¿‡äº†è§£è¿™æ®µå†å²ï¼Œæ‚¨å°†èƒ½å¤Ÿå……åˆ†åˆ©ç”¨è¯¥è¯­è¨€ç»å¸¸è¢«å¿½è§†çš„æ–°æ—§åŠŸèƒ½ã€‚è®©æˆ‘ä»¬å¼€å§‹å§ï¼\nä½¿ç”¨è¯­ä¹‰å…ƒç´ ç¼–å†™å†…å®¹ è®©æˆ‘ä»¬å‘å‰é¢çš„ HTML ç¤ºä¾‹æ·»åŠ æ›´å¤šå†…å®¹ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåŸºæœ¬ç½‘ç«™ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªå¸¦æœ‰é“¾æ¥å’Œæœç´¢è¾“å…¥çš„å¯¼èˆªéƒ¨åˆ†ï¼Œä¸€ä¸ªç”¨äºæ˜¾ç¤ºä¸€èˆ¬ç½‘ç«™ä¿¡æ¯çš„å¤§å‹å±•ç¤ºéƒ¨åˆ†ï¼ˆé€šå¸¸ç§°ä¸ºè‹±é›„éƒ¨åˆ†æˆ– å·¨å‹å±å¹• ï¼‰ï¼Œæ–‡ç« çš„ä¸‰åˆ—éƒ¨åˆ†å’Œä¸€ä¸ªç‰ˆæƒä¿¡æ¯çš„é¡µè„šéƒ¨åˆ†ã€‚\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;My test page\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div class=\u0026#34;navbar\u0026#34;\u0026gt; \u0026lt;ul\u0026gt; \u0026lt;li\u0026gt; \u0026lt;a href=\u0026#34;#\u0026#34;\u0026gt;Home\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;li\u0026gt; \u0026lt;a href=\u0026#34;#\u0026#34;\u0026gt;Info\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;li\u0026gt; \u0026lt;a href=\u0026#34;#\u0026#34;\u0026gt;About\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;form\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; placeholder=\u0026#34;Search\u0026#34; /\u0026gt; \u0026lt;button type=\u0026#34;submit\u0026#34;\u0026gt;Search\u0026lt;/button\u0026gt; \u0026lt;/form\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;main\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;hero\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;Hello there!\u0026lt;/h1\u0026gt; \u0026lt;p\u0026gt;General info about the page goes here\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;a href=\u0026#34;#\u0026#34;\u0026gt;Learn more\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;grid\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;column\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;First Heading\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;Article content goes here\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;a href=\u0026#34;#\u0026#34;\u0026gt;View details\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;column\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;Second Heading\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;Article content goes here\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;a href=\u0026#34;#\u0026#34;\u0026gt;View details\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;column\u0026#34;\u0026gt; \u0026lt;h2\u0026gt;Third Heading\u0026lt;/h2\u0026gt; \u0026lt;p\u0026gt;Article content goes here\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;a href=\u0026#34;#\u0026#34;\u0026gt;View details\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;footer\u0026#34;\u0026gt; \u0026lt;p\u0026gt;Copyright info goes here\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨å¸¦æœ‰ \u0026lt;div\u0026gt; ã€ \u0026lt;h1\u0026gt; ã€ \u0026lt;h2\u0026gt; ã€ \u0026lt;p\u0026gt; ç­‰æ ‡ç­¾çš„åŸºæœ¬å…ƒç´ æ¥æ ‡è®°å†…å®¹ã€‚è¿™é‡Œçš„ HTML æ˜¯æœ‰æ•ˆçš„ï¼Œä½†å®ƒä¸æ˜¯å®Œå…¨è¯­ä¹‰çš„â€”â€”ä¹Ÿå°±æ˜¯è¯´ï¼Œæ ‡ç­¾ä¸èƒ½å°½å¯èƒ½åœ°ä¼ è¾¾å†…å®¹çš„å«ä¹‰ã€‚","title":"[è¯‘]ä¸ºæé¾™è§£é‡Šç°ä»£HTML"},{"content":" å›¾ç‰‡æ¥è‡ªRyan Northçš„Dinosaur Comicsã€‚ å¦‚æœä½ ä»ä¸€å¼€å§‹å°±æ²¡æœ‰å»è¿‡é‚£é‡Œï¼Œé‚£ä¹ˆå­¦ä¹ ç°ä»£ JavaScript æ˜¯å¾ˆå›°éš¾çš„ã€‚ç”Ÿæ€ç³»ç»Ÿçš„å‘å±•å’Œå˜åŒ–å¦‚æ­¤ä¹‹å¿«ï¼Œä»¥è‡³äºå¾ˆéš¾ç†è§£ä¸åŒå·¥å…·è¯•å›¾è§£å†³çš„é—®é¢˜ã€‚æˆ‘ä» 1998 å¹´å¼€å§‹ç¼–ç¨‹ï¼Œä½†ç›´åˆ° 2014 å¹´æ‰å¼€å§‹è®¤çœŸå­¦ä¹  JavaScriptã€‚å½“æ—¶æˆ‘è®°å¾—é‡åˆ° Browserify å¹¶ç›¯ç€å®ƒçš„æ ‡è¯­ï¼š\nBrowserify é€šè¿‡æ†ç»‘æ‰€æœ‰ä¾èµ–é¡¹ï¼Œè®©ä½ åœ¨æµè§ˆå™¨ä¸­å¯¼å…¥ï¼ˆ\u0026lsquo;æ¨¡å—\u0026rsquo;ï¼‰ã€‚\næˆ‘å‡ ä¹å¬ä¸æ‡‚è¿™å¥è¯ä¸­çš„ä»»ä½•å•è¯ï¼Œå¹¶ä¸”åŠªåŠ›ç†è§£è¿™å¯¹æˆ‘ä½œä¸ºå¼€å‘äººå‘˜æœ‰ä»€ä¹ˆå¸®åŠ©ã€‚\næœ¬æ–‡çš„ç›®çš„æ˜¯æä¾›ä¸€ä¸ªå†å²èƒŒæ™¯ï¼Œè¯´æ˜ JavaScript å·¥å…·å¦‚ä½•åœ¨ 2017 å¹´å‘å±•åˆ°ä»Šå¤©çš„æ ·å­ã€‚æˆ‘ä»¬å°†ä»å¤´å¼€å§‹ï¼Œåƒæé¾™ä¸€æ ·æ„å»ºä¸€ä¸ªç¤ºä¾‹ç½‘ç«™ - æ²¡æœ‰å·¥å…·ï¼Œåªæœ‰æ™®é€šçš„ HTML å’Œ JavaScriptã€‚ç„¶åï¼Œæˆ‘ä»¬å°†é€æ­¥ä»‹ç»ä¸åŒçš„å·¥å…·ï¼Œä»¥æŸ¥çœ‹å®ƒä»¬ä¸€æ¬¡è§£å†³ä¸€ä¸ªé—®é¢˜ã€‚æœ‰äº†è¿™ä¸ªå†å²èƒŒæ™¯ï¼Œä½ å°†èƒ½å¤Ÿæ›´å¥½åœ°å­¦ä¹ å’Œé€‚åº”æœªæ¥ä¸æ–­å˜åŒ–çš„ JavaScript ç¯å¢ƒã€‚è®©æˆ‘ä»¬å¼€å§‹å§ï¼\næ›´æ–°ï¼šæˆ‘åˆ¶ä½œäº†æœ¬æ–‡çš„è§†é¢‘è¯¾ç¨‹ç‰ˆæœ¬ï¼Œä¸ºäº†æ›´æ¸…æ™°ï¼Œæˆ‘é€æ­¥æµè§ˆäº†æ¯ä¸ªéƒ¨åˆ†ï¼Œè¯·åœ¨æ­¤å¤„æŸ¥çœ‹ï¼š https://firstclass.actualize.co/p/modern-javascript-explained-for-dinosaurs\nä»¥\u0026quot;è€æ´¾\u0026quot;çš„æ–¹å¼ä½¿ç”¨ JavaScript \u0026lt;!-- index.html --\u0026gt; \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;JavaScript Example\u0026lt;/title\u0026gt; ** \u0026lt;script src=\u0026#34;index.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; ** \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;Hello from HTML!\u0026lt;/h1\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ç¬¬ \u0026lt;script src=\u0026quot;index.js\u0026quot;\u0026gt;\u0026lt;/script\u0026gt; è¡Œå¼•ç”¨åŒä¸€ç›®å½•ä¸­åä¸º index.js çš„å•ç‹¬ JavaScript æ–‡ä»¶ï¼š\n// index.js console.log(\u0026#34;Hello from JavaScript!\u0026#34;); è¿™å°±æ˜¯åˆ¶ä½œç½‘ç«™æ‰€éœ€çš„å…¨éƒ¨å†…å®¹ï¼ç°åœ¨ï¼Œå‡è®¾æ‚¨æƒ³æ·»åŠ ä¸€ä¸ªå…¶ä»–äººç¼–å†™çš„åº“ï¼Œä¾‹å¦‚ moment.jsï¼ˆä¸€ä¸ªå¯ä»¥å¸®åŠ©ä»¥äººç±»å¯è¯»çš„æ–¹å¼æ ¼å¼åŒ–æ—¥æœŸçš„åº“ï¼‰ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨ JavaScript ä¸­ä½¿ç”¨ moment å‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nmoment().startOf(\u0026#34;day\u0026#34;).fromNow(); // 20 hours ago ä½†è¿™åªæ˜¯å‡è®¾æ‚¨åœ¨ç½‘ç«™ä¸ŠåŒ…å« moment.jsï¼åœ¨ moment.js ä¸»é¡µ ä¸Šæ‚¨ä¼šçœ‹åˆ°ä»¥ä¸‹è¯´æ˜ï¼š\nå—¯ï¼Œå³ä¾§çš„\u0026quot;å®‰è£…\u0026quot;éƒ¨åˆ†æœ‰å¾ˆå¤šå†…å®¹ã€‚ä½†æ˜¯ç°åœ¨è®©æˆ‘ä»¬å¿½ç•¥å®ƒ - æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨åŒä¸€ç›®å½•ä¸­ä¸‹è½½ moment.min.js æ–‡ä»¶å¹¶å°†å…¶åŒ…å«åœ¨æˆ‘ä»¬çš„ index.html æ–‡ä»¶ä¸­æ¥ä¸ºæˆ‘ä»¬çš„ç½‘ç«™æ·»åŠ  moment.jsã€‚\n\u0026lt;!-- index.html --\u0026gt; \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Example\u0026lt;/title\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;index.css\u0026#34; /\u0026gt; \u0026lt;script src=\u0026#34;moment.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;index.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;Hello from HTML!\u0026lt;/h1\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; è¯·æ³¨æ„ï¼Œ moment.min.js åœ¨ index.js ä¹‹å‰åŠ è½½ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥åœ¨ index.js ä¸­ä½¿ç”¨ moment å‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n// index.js console.log(\u0026#34;Hello from JavaScript!\u0026#34;); console.log(moment().startOf(\u0026#34;day\u0026#34;).fromNow()); è¿™å°±æ˜¯æˆ‘ä»¬è¿‡å»ä½¿ç”¨ JavaScript åº“åˆ¶ä½œç½‘ç«™çš„æ–¹å¼ï¼å¥½æ¶ˆæ¯æ˜¯å®ƒå¾ˆå®¹æ˜“ç†è§£ã€‚ä¸å¥½çš„æ˜¯ï¼Œæ¯æ¬¡æ›´æ–°æ—¶æŸ¥æ‰¾å’Œä¸‹è½½æ–°ç‰ˆæœ¬çš„åº“éƒ½å¾ˆçƒ¦äººã€‚\nä½¿ç”¨ JavaScript åŒ…ç®¡ç†å™¨ ï¼ˆnpmï¼‰ ä» 2010 å¹´å·¦å³å¼€å§‹ï¼Œå‡ºç°äº†å‡ ä¸ªç›¸äº’ç«äº‰çš„ JavaScript åŒ…ç®¡ç†å™¨ï¼Œä»¥å¸®åŠ©è‡ªåŠ¨åŒ–ä»ä¸­å¤®å­˜å‚¨åº“ä¸‹è½½å’Œå‡çº§åº“çš„è¿‡ç¨‹ã€‚Bower å¯ä»¥è¯´æ˜¯ 2013 å¹´æœ€å—æ¬¢è¿çš„ï¼Œä½†æœ€ç»ˆåœ¨ 2015 å¹´å·¦å³è¢« npm è¶…è¶Šã€‚ï¼ˆå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä» 2016 å¹´æœ«å¼€å§‹ï¼Œyarn ä½œä¸º npm æ¥å£çš„æ›¿ä»£å“è·å¾—äº†å¾ˆå¤§çš„å…³æ³¨ï¼Œä½†å®ƒä»ç„¶åœ¨å¼•æ“ç›–ä¸‹ä½¿ç”¨ npm åŒ…ã€‚\nè¯·æ³¨æ„ï¼Œnpm æœ€åˆæ˜¯ä¸“é—¨ä¸º node.js åˆ¶ä½œçš„åŒ…ç®¡ç†å™¨ï¼Œè¿™æ˜¯ä¸€ä¸ªæ—¨åœ¨åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œçš„ JavaScript è¿è¡Œæ—¶ï¼Œè€Œä¸æ˜¯å‰ç«¯ã€‚å› æ­¤ï¼Œå¯¹äºæ‰“ç®—åœ¨æµè§ˆå™¨ä¸­è¿è¡Œçš„åº“çš„å‰ç«¯ JavaScript åŒ…ç®¡ç†å™¨æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å¥‡æ€ªçš„é€‰æ‹©ã€‚\næ³¨æ„ï¼šä½¿ç”¨åŒ…ç®¡ç†å™¨é€šå¸¸æ¶‰åŠä½¿ç”¨å‘½ä»¤è¡Œï¼Œè¿‡å»å‰ç«¯å¼€å‘ä»ä¸éœ€è¦å‘½ä»¤è¡Œã€‚å¦‚æœæ‚¨ä»æœªä½¿ç”¨è¿‡ï¼Œå¯ä»¥é˜…è¯»æœ¬æ•™ç¨‹ä»¥è·å–å…¥é—¨çš„è‰¯å¥½æ¦‚è¿°ã€‚æ— è®ºå¥½åï¼ŒçŸ¥é“å¦‚ä½•ä½¿ç”¨å‘½ä»¤è¡Œæ˜¯ç°ä»£ JavaScript çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼ˆå®ƒä¹Ÿä¸ºå…¶ä»–å¼€å‘é¢†åŸŸæ‰“å¼€äº†å¤§é—¨ï¼‰ã€‚\nè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ npm è‡ªåŠ¨å®‰è£… moment.js åŒ…ï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨ä¸‹è½½å®ƒã€‚å¦‚æœæ‚¨å®‰è£…äº† node.jsï¼Œåˆ™æ‚¨å·²ç»å®‰è£…äº† npmï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥å°†å‘½ä»¤è¡Œå¯¼èˆªåˆ°åŒ…å« index.html æ–‡ä»¶çš„æ–‡ä»¶å¤¹å¹¶è¾“å…¥ï¼š\n$ npm init è¿™å°†æç¤ºæ‚¨å‡ ä¸ªé—®é¢˜ï¼ˆé»˜è®¤å€¼å¾ˆå¥½ï¼Œæ‚¨å¯ä»¥ä¸ºæ¯ä¸ªé—®é¢˜ç‚¹å‡»â€œEnterâ€ï¼‰å¹¶ç”Ÿæˆä¸€ä¸ªåä¸º package.json çš„æ–°æ–‡ä»¶ã€‚è¿™æ˜¯ npm ç”¨æ¥ä¿å­˜æ‰€æœ‰é¡¹ç›®ä¿¡æ¯çš„é…ç½®æ–‡ä»¶ã€‚ä½¿ç”¨é»˜è®¤å€¼æ—¶ï¼Œ package.json çš„å†…å®¹åº”å¦‚ä¸‹æ‰€ç¤ºï¼š\n{ \u0026#34;name\u0026#34;: \u0026#34;your-project-name\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;1.0.0\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;main\u0026#34;: \u0026#34;index.js\u0026#34;, \u0026#34;scripts\u0026#34;: { \u0026#34;test\u0026#34;: \u0026#34;echo \\\u0026#34;Error: no test specified\\\u0026#34; \u0026amp;\u0026amp; exit 1\u0026#34; }, \u0026#34;author\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;license\u0026#34;: \u0026#34;ISC\u0026#34; } è¦å®‰è£… moment.js JavaScript åŒ…ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥é€šè¿‡åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥æŒ‰ç…§å…¶ä¸»é¡µä¸Šçš„ npm è¯´æ˜è¿›è¡Œæ“ä½œï¼š\n$ npm install moment --save æ­¤å‘½ä»¤æ‰§è¡Œä¸¤ä»¶äº‹ â€” é¦–å…ˆï¼Œå®ƒä» moment.js åŒ… ä¸‹è½½æ‰€æœ‰ä»£ç åä¸º node_modules çš„æ–‡ä»¶å¤¹ä¸­ã€‚å…¶æ¬¡ï¼Œå®ƒä¼šè‡ªåŠ¨ä¿®æ”¹ package.json æ–‡ä»¶ä»¥è·Ÿè¸ª moment.js ä½œä¸ºé¡¹ç›®ä¾èµ–é¡¹ã€‚\n{ \u0026#34;name\u0026#34;: \u0026#34;modern-javascript-example\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;1.0.0\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;main\u0026#34;: \u0026#34;index.js\u0026#34;, \u0026#34;scripts\u0026#34;: { \u0026#34;test\u0026#34;: \u0026#34;echo \\\u0026#34;Error: no test specified\\\u0026#34; \u0026amp;\u0026amp; exit 1\u0026#34; }, \u0026#34;author\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;license\u0026#34;: \u0026#34;ISC\u0026#34;, \u0026#34;dependencies\u0026#34;: { \u0026#34;moment\u0026#34;: \u0026#34;^2.22.2\u0026#34; } } è¿™åœ¨ä»¥åä¸ä»–äººå…±äº«é¡¹ç›®æ—¶å¾ˆæœ‰ç”¨ - è€Œä¸æ˜¯å…±äº« node_modules æ–‡ä»¶å¤¹ï¼ˆå¯èƒ½ä¼šå˜å¾—éå¸¸å¤§ï¼‰ï¼Œæ‚¨åªéœ€è¦å…±äº« package.json æ–‡ä»¶ï¼Œå…¶ä»–å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨å‘½ä»¤ npm install è‡ªåŠ¨å®‰è£…æ‰€éœ€çš„åŒ…ã€‚\næ‰€ä»¥ç°åœ¨æˆ‘ä»¬ä¸å†éœ€è¦ä»ç½‘ç«™ä¸Šæ‰‹åŠ¨ä¸‹è½½ momentjsï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ npm è‡ªåŠ¨ä¸‹è½½å’Œæ›´æ–°å®ƒã€‚æŸ¥çœ‹ node_modules æ–‡ä»¶å¤¹å†…éƒ¨ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° moment.min.js ç›®å½•ä¸­çš„ node_modules/moment/min æ–‡ä»¶ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥é“¾æ¥åˆ° index.html æ–‡ä»¶ä¸­çš„ npm ä¸‹è½½ç‰ˆæœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\u0026lt;!-- index.html --\u0026gt; \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;JavaScript Example\u0026lt;/title\u0026gt; \u0026lt;script src=\u0026#34;node_modules/moment/min/moment.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script src=\u0026#34;index.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;Hello from HTML!\u0026lt;/h1\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; æ‰€ä»¥å¥½æ¶ˆæ¯æ˜¯æˆ‘ä»¬ç°åœ¨å¯ä»¥ä½¿ç”¨ npm é€šè¿‡å‘½ä»¤è¡Œä¸‹è½½å’Œæ›´æ–°æˆ‘ä»¬çš„åŒ…ã€‚ä¸å¥½çš„æ˜¯ï¼Œç°åœ¨æˆ‘ä»¬æ­£åœ¨æŒ–æ˜ node_modules æ–‡ä»¶å¤¹ä»¥æŸ¥æ‰¾æ¯ä¸ªåŒ…çš„ä½ç½®ï¼Œå¹¶æ‰‹åŠ¨å°†å…¶åŒ…å«åœ¨æˆ‘ä»¬çš„ HTML ä¸­ã€‚è¿™å¾ˆä¸æ–¹ä¾¿ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬å°†çœ‹çœ‹å¦‚ä½•è‡ªåŠ¨åŒ–è¯¥è¿‡ç¨‹ã€‚\nä½¿ç”¨ JavaScript æ¨¡å—æ†ç»‘å™¨ï¼ˆwebpack)ã€€å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€éƒ½æä¾›äº†ä¸€ç§å°†ä»£ç ä»ä¸€ä¸ªæ–‡ä»¶å¯¼å…¥å¦ä¸€ä¸ªæ–‡ä»¶çš„æ–¹æ³•ã€‚JavaScript æœ€åˆå¹¶ä¸æ˜¯ä½¿ç”¨æ­¤åŠŸèƒ½è®¾è®¡çš„ï¼Œå› ä¸º JavaScript è¢«è®¾è®¡ä¸ºä»…åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼Œæ— æ³•è®¿é—®å®¢æˆ·ç«¯è®¡ç®—æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå‡ºäºå®‰å…¨åŸå› ï¼‰ã€‚å› æ­¤ï¼Œåœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´å†…ï¼Œåœ¨å¤šä¸ªæ–‡ä»¶ä¸­ç»„ç»‡ JavaScript ä»£ç éœ€è¦æ‚¨ä½¿ç”¨å…¨å±€å…±äº«çš„å˜é‡åŠ è½½æ¯ä¸ªæ–‡ä»¶ã€‚\nè¿™å®é™…ä¸Šæ˜¯æˆ‘ä»¬åœ¨ä¸Šé¢æ‰€åšçš„ moment.js ç¤ºä¾‹ â€” æ•´ä¸ª moment.min.js æ–‡ä»¶åŠ è½½åˆ° HTML ä¸­ï¼ŒHTML å®šä¹‰äº†ä¸€ä¸ªå…¨å±€å˜é‡ moment ï¼Œç„¶åå¯ç”¨äºåœ¨ moment.min.js ä¹‹ååŠ è½½çš„ä»»ä½•æ–‡ä»¶ï¼ˆæ— è®ºå®ƒæ˜¯å¦éœ€è¦è®¿é—®å®ƒï¼‰ã€‚\n2009 å¹´ï¼Œä¸€ä¸ªåä¸º CommonJS çš„é¡¹ç›®å¯åŠ¨ï¼Œç›®æ ‡æ˜¯åœ¨æµè§ˆå™¨ä¹‹å¤–ä¸º JavaScript æŒ‡å®šä¸€ä¸ªç”Ÿæ€ç³»ç»Ÿã€‚CommonJS çš„å¾ˆå¤§ä¸€éƒ¨åˆ†æ˜¯å®ƒçš„æ¨¡å—è§„èŒƒï¼Œå®ƒæœ€ç»ˆå…è®¸ JavaScript åƒå¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ä¸€æ ·è·¨æ–‡ä»¶å¯¼å…¥å’Œå¯¼å‡ºä»£ç ï¼Œè€Œæ— éœ€è¯‰è¯¸å…¨å±€å˜é‡ã€‚æœ€è‘—åçš„ CommonJS æ¨¡å—å®ç°æ˜¯ node.jsã€‚\nå¦‚å‰æ‰€è¿°ï¼Œnode.js æ˜¯ä¸€ä¸ªè®¾è®¡ç”¨äºåœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œçš„ JavaScript è¿è¡Œæ—¶ã€‚ä¸‹é¢æ˜¯å‰é¢çš„ç¤ºä¾‹ä½¿ç”¨ node.js æ¨¡å—çš„æ ·å­ã€‚ä¸å…¶ä½¿ç”¨ HTML è„šæœ¬æ ‡è®°åŠ è½½æ‰€æœ‰ moment.min.js ï¼Œä¸å¦‚ç›´æ¥å°†å…¶åŠ è½½åˆ° JavaScript æ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n// index.js var moment = require(\u0026#34;moment\u0026#34;); console.log(\u0026#34;Hello from JavaScript!\u0026#34;); console.log(moment().startOf(\u0026#34;day\u0026#34;).fromNow()); åŒæ ·ï¼Œè¿™å°±æ˜¯æ¨¡å—åŠ è½½åœ¨ node.js ä¸­çš„å·¥ä½œæ–¹å¼ï¼Œç”±äº node.js æ˜¯ä¸€ç§å¯ä»¥è®¿é—®è®¡ç®—æœºæ–‡ä»¶ç³»ç»Ÿçš„æœåŠ¡å™¨ç«¯è¯­è¨€ï¼Œå› æ­¤æ•ˆæœå¾ˆå¥½ã€‚Node.js ä¹ŸçŸ¥é“æ¯ä¸ª npm æ¨¡å—è·¯å¾„çš„ä½ç½®ï¼Œæ‰€ä»¥ä½ ä¸å¿…å†™ require('./node_modules/moment/min/moment.min.js) ï¼Œä½ å¯ä»¥ç®€å•åœ°å†™ require('moment') â€” éå¸¸ç”œèœœã€‚\nè¿™å¯¹äº node.js æ¥è¯´éƒ½å¾ˆæ£’ï¼Œä½†æ˜¯å¦‚æœæ‚¨å°è¯•åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ä¸Šè¿°ä»£ç ï¼Œåˆ™ä¼šæ”¶åˆ°ä¸€æ¡é”™è¯¯æ¶ˆæ¯ï¼ŒæŒ‡å‡ºæœªå®šä¹‰æµè§ˆå™¨æ— æ³•è®¿é—®æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™æ„å‘³ç€ä»¥è¿™ç§æ–¹å¼åŠ è½½æ¨¡å—éå¸¸æ£˜æ‰‹ - åŠ è½½æ–‡ä»¶å¿…é¡»åŠ¨æ€å®Œæˆï¼ŒåŒæ­¥ï¼ˆè¿™ä¼šå‡æ…¢æ‰§è¡Œé€Ÿåº¦ï¼‰æˆ–å¼‚æ­¥ï¼ˆå¯èƒ½å­˜åœ¨è®¡æ—¶é—®é¢˜ï¼‰ã€‚\nè¿™å°±æ˜¯æ¨¡å—æ†ç»‘å™¨çš„ç”¨æ­¦ä¹‹åœ°ã€‚JavaScript æ¨¡å—æ†ç»‘å™¨æ˜¯ä¸€ç§å·¥å…·ï¼Œå®ƒé€šè¿‡æ„å»ºæ­¥éª¤ï¼ˆå¯ä»¥è®¿é—®æ–‡ä»¶ç³»ç»Ÿï¼‰æ¥è§£å†³é—®é¢˜ï¼Œä»¥åˆ›å»ºä¸æµè§ˆå™¨å…¼å®¹çš„æœ€ç»ˆè¾“å‡ºï¼ˆä¸éœ€è¦è®¿é—®æ–‡ä»¶ç³»ç»Ÿï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ¨¡å—æ†ç»‘å™¨æ¥æŸ¥æ‰¾æ‰€æœ‰ require è¯­å¥ï¼ˆè¿™æ˜¯æ— æ•ˆçš„æµè§ˆå™¨ JavaScript è¯­æ³•ï¼‰ï¼Œå¹¶å°†å®ƒä»¬æ›¿æ¢ä¸ºæ¯ä¸ªæ‰€éœ€æ–‡ä»¶çš„å®é™…å†…å®¹ã€‚æœ€ç»ˆç»“æœæ˜¯ä¸€ä¸ªæ†ç»‘çš„ JavaScript æ–‡ä»¶ï¼ˆæ²¡æœ‰ require è¯­å¥ï¼‰ï¼\næœ€æµè¡Œçš„æ¨¡å—æ†ç»‘å™¨æ˜¯ Browserifyï¼Œå®ƒäº 2011 å¹´å‘å¸ƒï¼Œç‡å…ˆåœ¨å‰ç«¯ä½¿ç”¨ node.js æ ·å¼çš„éœ€æ±‚è¯­å¥ï¼ˆè¿™æœ¬è´¨ä¸Šæ˜¯ä½¿ npm æˆä¸ºé¦–é€‰å‰ç«¯åŒ…ç®¡ç†å™¨çš„åŸå› ï¼‰ã€‚å¤§çº¦åœ¨ 2015 å¹´ï¼Œwebpack æœ€ç»ˆæˆä¸ºä½¿ç”¨æ›´å¹¿æ³›çš„æ¨¡å—æ†ç»‘å™¨ï¼ˆå—åˆ° React å‰ç«¯æ¡†æ¶çš„æ™®åŠçš„æ¨åŠ¨ï¼Œå®ƒå……åˆ†åˆ©ç”¨äº† webpack çš„å„ç§åŠŸèƒ½ï¼‰ã€‚\nè®©æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ webpack è®©ä¸Šé¢çš„ require('moment') ç¤ºä¾‹åœ¨æµè§ˆå™¨ä¸­å·¥ä½œã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å°† webpack å®‰è£…åˆ°é¡¹ç›®ä¸­ã€‚Webpack æœ¬èº«æ˜¯ä¸€ä¸ª npm åŒ…ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä»å‘½ä»¤è¡Œå®‰è£…å®ƒï¼š\n$ npm install webpack webpack-cli --save-dev è¯·æ³¨æ„ï¼Œæˆ‘ä»¬æ­£åœ¨å®‰è£…ä¸¤ä¸ªè½¯ä»¶åŒ… â€” webpack å’Œ webpack-cliï¼ˆå®ƒä½¿æ‚¨èƒ½å¤Ÿä»å‘½ä»¤è¡Œä½¿ç”¨ webpackï¼‰ã€‚å¦è¯·æ³¨æ„ --save-dev å‚æ•° â€” è¿™ä¼šå°†å…¶ä¿å­˜ä¸ºå¼€å‘ä¾èµ–é¡¹ï¼Œè¿™æ„å‘³ç€å®ƒæ˜¯å¼€å‘ç¯å¢ƒä¸­éœ€è¦çš„åŒ…ï¼Œè€Œä¸æ˜¯ç”Ÿäº§æœåŠ¡å™¨ä¸Šéœ€è¦çš„åŒ…ã€‚æ‚¨å¯ä»¥åœ¨è‡ªåŠ¨æ›´æ–°çš„ package.json æ–‡ä»¶ä¸­çœ‹åˆ°è¿™åæ˜ åœ¨ï¼š\n{ \u0026#34;name\u0026#34;: \u0026#34;modern-javascript-example\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;1.0.0\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;main\u0026#34;: \u0026#34;index.js\u0026#34;, \u0026#34;scripts\u0026#34;: { \u0026#34;test\u0026#34;: \u0026#34;echo \\\u0026#34;Error: no test specified\\\u0026#34; \u0026amp;\u0026amp; exit 1\u0026#34; }, \u0026#34;author\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;license\u0026#34;: \u0026#34;ISC\u0026#34;, \u0026#34;dependencies\u0026#34;: { \u0026#34;moment\u0026#34;: \u0026#34;^2.19.1\u0026#34; }, \u0026#34;devDependencies\u0026#34;: { \u0026#34;webpack\u0026#34;: \u0026#34;^4.17.1\u0026#34;, \u0026#34;webpack-cli\u0026#34;: \u0026#34;^3.1.0\u0026#34; } } ç°åœ¨æˆ‘ä»¬å·²ç»å°† webpack å’Œ webpack-cli ä½œä¸ºåŒ…å®‰è£…åœ¨ node_modules æ–‡ä»¶å¤¹ä¸­ã€‚æ‚¨å¯ä»¥ä»å‘½ä»¤è¡Œä½¿ç”¨ webpack-cliï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n$ ./node_modules/.bin/webpack index.js --mode=development æ­¤å‘½ä»¤å°†è¿è¡Œå®‰è£…åœ¨ node_modules æ–‡ä»¶å¤¹ä¸­çš„ webpack å·¥å…·ï¼Œä» index.js æ–‡ä»¶å¼€å§‹ï¼Œæ‰¾åˆ°ä»»æ„ require è¯­å¥ï¼Œå¹¶å°†å®ƒä»¬æ›¿æ¢ä¸ºé€‚å½“çš„ä»£ç ä»¥åˆ›å»ºå•ä¸ªè¾“å‡ºæ–‡ä»¶ï¼ˆé»˜è®¤ä¸º dist/main.js ï¼‰ã€‚ --mode=development å‚æ•°æ˜¯ä¸ºäº†è®©å¼€å‘äººå‘˜ä¿æŒ JavaScript çš„å¯è¯»æ€§ï¼Œè€Œä¸æ˜¯å‚æ•° --mode=production çš„ç¼©å°è¾“å‡ºã€‚\nç°åœ¨æˆ‘ä»¬æœ‰äº† webpack çš„ dist/main.js è¾“å‡ºï¼Œæˆ‘ä»¬å°†åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨å®ƒè€Œä¸æ˜¯ index.js ï¼Œå› ä¸ºå®ƒåŒ…å«æ— æ•ˆçš„ require è¯­å¥ã€‚è¿™å°†åæ˜ åœ¨ index.html æ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\u0026lt;!-- index.html --\u0026gt; \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;JavaScript Example\u0026lt;/title\u0026gt; \u0026lt;script src=\u0026#34;dist/main.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;Hello from HTML!\u0026lt;/h1\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; å¦‚æœæ‚¨åˆ·æ–°æµè§ˆå™¨ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä¸€åˆ‡éƒ½åƒä»¥å‰ä¸€æ ·å·¥ä½œï¼\nè¯·æ³¨æ„ï¼Œæ¯æ¬¡æ›´æ”¹ index.js æ—¶ï¼Œæˆ‘ä»¬éƒ½éœ€è¦è¿è¡Œ webpack å‘½ä»¤ã€‚è¿™å¾ˆä¹å‘³ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ webpack æ›´é«˜çº§çš„åŠŸèƒ½ï¼ˆä¾‹å¦‚ç”Ÿæˆæºæ˜ å°„ä»¥å¸®åŠ©ä»è½¬è¯‘çš„ä»£ç è°ƒè¯•åŸå§‹ä»£ç ï¼‰æ—¶ï¼Œè¿™å°†å˜å¾—æ›´åŠ ä¹å‘³ã€‚Webpack å¯ä»¥ä»åä¸º webpack.config.js çš„é¡¹ç›®æ ¹ç›®å½•ä¸­çš„é…ç½®æ–‡ä»¶ä¸­è¯»å–é€‰é¡¹ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå®ƒçœ‹èµ·æ¥åƒï¼š\n// webpack.config.js module.exports = { mode: \u0026#34;development\u0026#34;, entry: \u0026#34;./index.js\u0026#34;, output: { filename: \u0026#34;main.js\u0026#34;, publicPath: \u0026#34;dist\u0026#34;, }, }; ç°åœ¨æ¯æ¬¡æˆ‘ä»¬æ›´æ”¹ index.js æ—¶ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œ webpackï¼š\n$ ./node_modules/.bin/webpack æˆ‘ä»¬ä¸å†éœ€è¦æŒ‡å®š index.js å’Œ --mode=development é€‰é¡¹ï¼Œå› ä¸º webpack æ­£åœ¨ä» webpack.config.js æ–‡ä»¶ä¸­åŠ è½½è¿™äº›é€‰é¡¹ã€‚è¿™æ›´å¥½ï¼Œä½†ä¸ºæ¯ä¸ªä»£ç æ›´æ”¹è¾“å…¥æ­¤å‘½ä»¤ä»ç„¶å¾ˆä¹å‘³ - æˆ‘ä»¬å°†ä½¿æ­¤è¿‡ç¨‹æ›´é¡ºç•…ã€‚\næ€»çš„æ¥è¯´ï¼Œè¿™å¯èƒ½çœ‹èµ·æ¥ä¸å¤šï¼Œä½†è¿™ä¸ªå·¥ä½œæµç¨‹æœ‰ä¸€äº›å·¨å¤§çš„ä¼˜åŠ¿ã€‚æˆ‘ä»¬ä¸å†é€šè¿‡å…¨å±€å˜é‡åŠ è½½å¤–éƒ¨è„šæœ¬ã€‚ä»»ä½•æ–°çš„ JavaScript åº“éƒ½å°†åœ¨ JavaScript ä¸­ä½¿ç”¨ require è¯­å¥æ·»åŠ ï¼Œè€Œä¸æ˜¯åœ¨ HTML ä¸­æ·»åŠ æ–°çš„ \u0026lt;script\u0026gt; æ ‡ç­¾ã€‚æ‹¥æœ‰å•ä¸ª JavaScript æ†ç»‘åŒ…æ–‡ä»¶é€šå¸¸å¯¹æ€§èƒ½æ›´å¥½ã€‚ç°åœ¨æˆ‘ä»¬æ·»åŠ äº†æ„å»ºæ­¥éª¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ä»–ä¸€äº›å¼ºå¤§çš„åŠŸèƒ½æ·»åŠ åˆ°æˆ‘ä»¬çš„å¼€å‘å·¥ä½œæµç¨‹ä¸­ï¼\nä¸ºæ–°çš„è¯­è¨€åŠŸèƒ½è½¬è¯‘ä»£ç  ï¼ˆbabelï¼‰ è½¬è¯‘ä»£ç æ„å‘³ç€å°†ä¸€ç§è¯­è¨€çš„ä»£ç è½¬æ¢ä¸ºå¦ä¸€ç§ç±»ä¼¼è¯­è¨€çš„ä»£ç ã€‚è¿™æ˜¯å‰ç«¯å¼€å‘çš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†â€”â€”ç”±äºæµè§ˆå™¨æ·»åŠ æ–°åŠŸèƒ½çš„é€Ÿåº¦å¾ˆæ…¢ï¼Œå› æ­¤ä½¿ç”¨å®éªŒæ€§åŠŸèƒ½åˆ›å»ºäº†æ–°è¯­è¨€ï¼Œè¿™äº›åŠŸèƒ½å¯ä»¥è½¬æ¢ä¸ºæµè§ˆå™¨å…¼å®¹è¯­è¨€ã€‚\nå¯¹äº CSSï¼Œæœ‰ Sassï¼ŒLess å’Œ Stylusï¼Œä»…ä¸¾å‡ ä¾‹ã€‚å¯¹äº JavaScriptï¼Œä¸€æ®µæ—¶é—´å†…æœ€æµè¡Œçš„è½¬è¯‘å™¨æ˜¯ CoffeeScriptï¼ˆ2010 å¹´å·¦å³å‘å¸ƒï¼‰ï¼Œè€Œç°åœ¨å¤§å¤šæ•°äººä½¿ç”¨ babel æˆ– TypeScriptã€‚CoffeeScript æ˜¯ä¸€ç§ä¸“æ³¨äºé€šè¿‡æ˜¾è‘—æ”¹å˜è¯­è¨€æ¥æ”¹è¿› JavaScript çš„è¯­è¨€â€”â€”å¯é€‰çš„æ‹¬å·ã€é‡è¦çš„ç©ºæ ¼ç­‰ã€‚Babel ä¸æ˜¯ä¸€é—¨æ–°è¯­è¨€ï¼Œè€Œæ˜¯ä¸€ç§è½¬è¯‘å™¨ï¼Œå®ƒå°†å°šæœªé€‚ç”¨äºæ‰€æœ‰æµè§ˆå™¨ï¼ˆES2015 åŠæ›´é«˜ç‰ˆæœ¬ï¼‰çš„ä¸‹ä¸€ä»£ JavaScript è½¬è¯‘ä¸ºæ›´å…¼å®¹çš„æ—§ JavaScript ï¼ˆES5ï¼‰ã€‚Typescript æ˜¯ä¸€ç§ä¸ä¸‹ä¸€ä»£ JavaScript åŸºæœ¬ç›¸åŒçš„è¯­è¨€ï¼Œä½†ä¹Ÿæ·»åŠ äº†å¯é€‰çš„é™æ€ç±»å‹ã€‚è®¸å¤šäººé€‰æ‹©ä½¿ç”¨ babelï¼Œå› ä¸ºå®ƒæœ€æ¥è¿‘åŸç‰ˆ JavaScriptã€‚\nè®©æˆ‘ä»¬çœ‹ä¸€ä¸ªå¦‚ä½•åœ¨æˆ‘ä»¬ç°æœ‰çš„ webpack æ„å»ºæ­¥éª¤ä¸­ä½¿ç”¨ babel çš„ç¤ºä¾‹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä»å‘½ä»¤è¡Œå°† babelï¼ˆè¿™æ˜¯ä¸€ä¸ª npm åŒ…ï¼‰å®‰è£…åˆ°é¡¹ç›®ä¸­ï¼š\n$ npm install @babel/core @babel/preset-env babel-loader --save-dev è¯·æ³¨æ„ï¼Œæˆ‘ä»¬æ­£åœ¨å®‰è£… 3 ä¸ªå•ç‹¬çš„åŒ…ä½œä¸ºå¼€å‘ä¾èµ–é¡¹ â€” @babel/core æ˜¯ babel çš„ä¸»è¦éƒ¨åˆ†ï¼Œ @babel/preset-env æ˜¯å®šä¹‰è¦è½¬è¯‘çš„æ–° JavaScript åŠŸèƒ½çš„é¢„è®¾ï¼Œ babel-loader æ˜¯ä½¿ babel èƒ½å¤Ÿä½¿ç”¨ webpack çš„åŒ…ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–è¾‘ webpack.config.js æ–‡ä»¶å°† webpack é…ç½®ä¸ºä½¿ç”¨ babel-loader ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n// webpack.config.js module.exports = { mode: \u0026#34;development\u0026#34;, entry: \u0026#34;./index.js\u0026#34;, output: { filename: \u0026#34;main.js\u0026#34;, publicPath: \u0026#34;dist\u0026#34;, }, module: { rules: [ { test: /\\.js$/, exclude: /node_modules/, use: { loader: \u0026#34;babel-loader\u0026#34;, options: { presets: [\u0026#34;@babel/preset-env\u0026#34;], }, }, }, ], }, }; è¿™ç§è¯­æ³•å¯èƒ½ä¼šä»¤äººå›°æƒ‘ï¼ˆå¹¸è¿çš„æ˜¯ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬ç»å¸¸ç¼–è¾‘çš„ä¸œè¥¿ï¼‰ã€‚åŸºæœ¬ä¸Šï¼Œæˆ‘ä»¬å‘Šè¯‰ webpack æŸ¥æ‰¾ä»»ä½• .js æ–‡ä»¶ï¼ˆä¸åŒ…æ‹¬ node_modules æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ï¼‰ï¼Œå¹¶ä½¿ç”¨ babel-loader å’Œ @babel/preset-env é¢„è®¾åº”ç”¨ babel è½¬è¯‘ã€‚æ‚¨å¯ä»¥åœ¨æ­¤å¤„é˜…è¯»æœ‰å…³ webpack é…ç½®è¯­æ³•çš„æ›´å¤šä¿¡æ¯ã€‚\nç°åœ¨ä¸€åˆ‡éƒ½è®¾ç½®å¥½äº†ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹ç”¨æˆ‘ä»¬çš„ JavaScript ç¼–å†™ ES2015 åŠŸèƒ½äº†ï¼ä¸‹é¢æ˜¯ index.js æ–‡ä»¶ä¸­çš„ ES2015 æ¨¡æ¿å­—ç¬¦ä¸²ç¤ºä¾‹ï¼š\n// index.js var moment = require(\u0026#34;moment\u0026#34;); console.log(\u0026#34;Hello from JavaScript!\u0026#34;); console.log(moment().startOf(\u0026#34;day\u0026#34;).fromNow()); var name = \u0026#34;Bob\u0026#34;, time = \u0026#34;today\u0026#34;; console.log(`Hello ${name}, how are you ${time}?`); æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ ES2015 import è¯­å¥ ä»£æ›¿ require æ¥åŠ è½½æ¨¡å—ï¼Œè¿™å°±æ˜¯æ‚¨ä»Šå¤©åœ¨å¾ˆå¤šä»£ç åº“ä¸­çœ‹åˆ°çš„å†…å®¹ï¼š\n// index.js import moment from \u0026#34;moment\u0026#34;; console.log(\u0026#34;Hello from JavaScript!\u0026#34;); console.log(moment().startOf(\u0026#34;day\u0026#34;).fromNow()); var name = \u0026#34;Bob\u0026#34;, time = \u0026#34;today\u0026#34;; console.log(`Hello ${name}, how are you ${time}?`); åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ import è¯­æ³•ä¸ require è¯­æ³•æ²¡æœ‰å¤ªå¤§åŒºåˆ«ï¼Œä½† import å¯¹äºæ›´é«˜çº§çš„æƒ…å†µå…·æœ‰é¢å¤–çš„çµæ´»æ€§ã€‚ç”±äºæˆ‘ä»¬æ›´æ”¹äº† index.js ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å‘½ä»¤è¡Œä¸­å†æ¬¡è¿è¡Œ webpackï¼š\n$ ./node_modules/.bin/webpack ç°åœ¨æ‚¨å¯ä»¥åœ¨æµè§ˆå™¨ä¸­åˆ·æ–° index.html ã€‚åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œå¤§å¤šæ•°ç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒæ‰€æœ‰ ES2015 åŠŸèƒ½ï¼Œå› æ­¤å¾ˆéš¾åˆ¤æ–­ babel æ˜¯å¦å®Œæˆäº†å®ƒçš„å·¥ä½œã€‚æ‚¨å¯ä»¥åœ¨ IE9 ç­‰è¾ƒæ—§çš„æµè§ˆå™¨ä¸­å¯¹å…¶è¿›è¡Œæµ‹è¯•ï¼Œä¹Ÿå¯ä»¥åœ¨ main.js ä¸­æœç´¢ä»¥æŸ¥æ‰¾è½¬è¯‘çš„ä»£ç è¡Œï¼š\n// main.js // ... console.log(\u0026#34;Hello \u0026#34; + name + \u0026#34;, how are you \u0026#34; + time + \u0026#34;?\u0026#34;); // ... åœ¨è¿™é‡Œä½ å¯ä»¥çœ‹åˆ° babel å°† ES2015 æ¨¡æ¿å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¸¸è§„çš„ JavaScript å­—ç¬¦ä¸²è¿æ¥ï¼Œä»¥ä¿æŒæµè§ˆå™¨å…¼å®¹æ€§ã€‚è™½ç„¶è¿™ä¸ªç‰¹æ®Šçš„ä¾‹å­å¯èƒ½ä¸å¤ªä»¤äººå…´å¥‹ï¼Œä½†è½¬è¯‘ä»£ç çš„èƒ½åŠ›æ˜¯éå¸¸å¼ºå¤§çš„ã€‚JavaScript ä¸­æœ‰ä¸€äº›ä»¤äººå…´å¥‹çš„è¯­è¨€åŠŸèƒ½ï¼Œå¦‚ async/awaitï¼Œä½ å¯ä»¥ç«‹å³å¼€å§‹ä½¿ç”¨å®ƒä»¬æ¥ç¼–å†™æ›´å¥½çš„ä»£ç ã€‚è™½ç„¶éŸ³è¯‘æœ‰æ—¶å¯èƒ½çœ‹èµ·æ¥ä¹å‘³å’Œç—›è‹¦ï¼Œä½†å®ƒåœ¨è¿‡å»å‡ å¹´ä¸­å¯¼è‡´äº†è¯­è¨€çš„å·¨å¤§æ”¹è¿›ï¼Œå› ä¸ºäººä»¬ä»Šå¤©æ­£åœ¨æµ‹è¯•æ˜å¤©çš„åŠŸèƒ½ã€‚\næˆ‘ä»¬å‡ ä¹å®Œæˆäº†ï¼Œä½†æˆ‘ä»¬çš„å·¥ä½œæµç¨‹ä¸­ä»æœ‰ä¸€äº›æœªæ‰“ç£¨çš„è¾¹ç¼˜ã€‚å¦‚æœæˆ‘ä»¬æ‹…å¿ƒæ€§èƒ½ï¼Œæˆ‘ä»¬åº”è¯¥ç¼©å°æ†ç»‘æ–‡ä»¶ï¼Œè¿™åº”è¯¥å¾ˆå®¹æ˜“ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»åˆå¹¶äº†ä¸€ä¸ªæ„å»ºæ­¥éª¤ã€‚æ¯æ¬¡æ›´æ”¹ JavaScript æ—¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦é‡æ–°è¿è¡Œ webpack å‘½ä»¤ï¼Œè¿™ä¼šå¾ˆå¿«å˜æ—§ã€‚å› æ­¤ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¦çœ‹çš„æ˜¯è§£å†³è¿™äº›é—®é¢˜çš„ä¸€äº›ä¾¿æ·å·¥å…·ã€‚\nä½¿ç”¨ä»»åŠ¡è¿è¡Œç¨‹åºï¼ˆnpm è„šæœ¬ï¼‰ ç°åœ¨æˆ‘ä»¬å·²ç»æŠ•èµ„ä½¿ç”¨æ„å»ºæ­¥éª¤æ¥å¤„ç† JavaScript æ¨¡å—ï¼Œä½¿ç”¨ä»»åŠ¡è¿è¡Œå™¨æ˜¯æœ‰æ„ä¹‰çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªè‡ªåŠ¨æ‰§è¡Œæ„å»ºè¿‡ç¨‹ä¸åŒéƒ¨åˆ†çš„å·¥å…·ã€‚å¯¹äºå‰ç«¯å¼€å‘ï¼Œä»»åŠ¡åŒ…æ‹¬ç¼©å°ä»£ç ã€ä¼˜åŒ–å›¾åƒã€è¿è¡Œæµ‹è¯•ç­‰ã€‚\n2013 å¹´ï¼ŒGrunt æ˜¯æœ€å—æ¬¢è¿çš„å‰ç«¯ä»»åŠ¡è¿è¡Œè€…ï¼ŒGulp ç´§éšå…¶åã€‚ä¸¤è€…éƒ½ä¾èµ–äºåŒ…è£…å…¶ä»–å‘½ä»¤è¡Œå·¥å…·çš„æ’ä»¶ã€‚å¦‚ä»Šï¼Œæœ€æµè¡Œçš„é€‰æ‹©ä¼¼ä¹æ˜¯ä½¿ç”¨ npm åŒ…ç®¡ç†å™¨æœ¬èº«å†…ç½®çš„è„šæœ¬åŠŸèƒ½ï¼Œå®ƒä¸ä½¿ç”¨æ’ä»¶ï¼Œè€Œæ˜¯ç›´æ¥ä¸å…¶ä»–å‘½ä»¤è¡Œå·¥å…·ä¸€èµ·ä½¿ç”¨ã€‚\nè®©æˆ‘ä»¬ç¼–å†™ä¸€äº› npm è„šæœ¬ï¼Œä»¥ä¾¿æ›´è½»æ¾åœ°ä½¿ç”¨ webpackã€‚è¿™æ¶‰åŠç®€å•åœ°æ›´æ”¹ package.json æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n{ \u0026#34;name\u0026#34;: \u0026#34;modern-javascript-example\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;1.0.0\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;main\u0026#34;: \u0026#34;index.js\u0026#34;, \u0026#34;scripts\u0026#34;: { \u0026#34;test\u0026#34;: \u0026#34;echo \\\u0026#34;Error: no test specified\\\u0026#34; \u0026amp;\u0026amp; exit 1\u0026#34;, \u0026#34;build\u0026#34;: \u0026#34;webpack --progress --mode=production\u0026#34;, \u0026#34;watch\u0026#34;: \u0026#34;webpack --progress --watch\u0026#34; }, \u0026#34;author\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;license\u0026#34;: \u0026#34;ISC\u0026#34;, \u0026#34;dependencies\u0026#34;: { \u0026#34;moment\u0026#34;: \u0026#34;^2.22.2\u0026#34; }, \u0026#34;devDependencies\u0026#34;: { \u0026#34;@babel/core\u0026#34;: \u0026#34;^7.0.0\u0026#34;, \u0026#34;@babel/preset-env\u0026#34;: \u0026#34;^7.0.0\u0026#34;, \u0026#34;babel-loader\u0026#34;: \u0026#34;^8.0.2\u0026#34;, \u0026#34;webpack\u0026#34;: \u0026#34;^4.17.1\u0026#34;, \u0026#34;webpack-cli\u0026#34;: \u0026#34;^3.1.0\u0026#34; } } åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸¤ä¸ªæ–°è„šæœ¬ï¼Œ build å’Œ watch ã€‚è¦è¿è¡Œæ„å»ºè„šæœ¬ï¼Œæ‚¨å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ï¼š\n$ npm run build è¿™å°†è¿è¡Œ webpackï¼ˆä½¿ç”¨æˆ‘ä»¬ä¹‹å‰æ‰€åšçš„ webpack.config.js ä¸­çš„é…ç½®ï¼‰ï¼Œå…¶ä¸­ --progress é€‰é¡¹æ˜¾ç¤ºè¿›åº¦ç™¾åˆ†æ¯”ï¼Œ --mode=production é€‰é¡¹æœ€å°åŒ–ç”Ÿäº§ä»£ç ã€‚è¦è¿è¡Œ watch è„šæœ¬ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š\n$ npm run watch å®ƒä½¿ç”¨ --watch é€‰é¡¹ä»£æ›¿ï¼Œä»¥ä¾¿åœ¨æ¯æ¬¡ä»»ä½• JavaScript æ–‡ä»¶æ›´æ”¹æ—¶è‡ªåŠ¨é‡æ–°è¿è¡Œ webpackï¼Œè¿™å¯¹äºå¼€å‘éå¸¸æœ‰ç”¨ã€‚\nè¯·æ³¨æ„ï¼Œ package.json ä¸­çš„è„šæœ¬å¯ä»¥åœ¨ä¸å¿…æŒ‡å®šå®Œæ•´è·¯å¾„ ./node_modules/.bin/webpack çš„æƒ…å†µä¸‹è¿è¡Œ webpackï¼Œå› ä¸º node.js çŸ¥é“æ¯ä¸ª npm æ¨¡å—è·¯å¾„çš„ä½ç½®ã€‚è¿™å¾ˆç”œï¼æˆ‘ä»¬å¯ä»¥é€šè¿‡å®‰è£… webpack-dev-server æ¥è®©äº‹æƒ…å˜å¾—æ›´åŠ ç”œèœœï¼Œè¿™æ˜¯ä¸€ä¸ªå•ç‹¬çš„å·¥å…·ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªç®€å•çš„ Web æœåŠ¡å™¨å’Œå®æ—¶é‡æ–°åŠ è½½ã€‚è¦å°†å…¶å®‰è£…ä¸ºå¼€å‘ä¾èµ–é¡¹ï¼Œè¯·è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š\n$ npm install webpack-dev-server --save-dev ç„¶åå°†ä¸€ä¸ª npm è„šæœ¬æ·»åŠ åˆ° package.json ï¼š\n{ \u0026#34;name\u0026#34;: \u0026#34;modern-javascript-example\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;1.0.0\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;main\u0026#34;: \u0026#34;index.js\u0026#34;, \u0026#34;scripts\u0026#34;: { \u0026#34;test\u0026#34;: \u0026#34;echo \\\u0026#34;Error: no test specified\\\u0026#34; \u0026amp;\u0026amp; exit 1\u0026#34;, \u0026#34;build\u0026#34;: \u0026#34;webpack --progress -p\u0026#34;, \u0026#34;watch\u0026#34;: \u0026#34;webpack --progress --watch\u0026#34;, \u0026#34;serve\u0026#34;: \u0026#34;webpack-dev-server --open\u0026#34; }, \u0026#34;author\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;license\u0026#34;: \u0026#34;ISC\u0026#34;, \u0026#34;dependencies\u0026#34;: { \u0026#34;moment\u0026#34;: \u0026#34;^2.19.1\u0026#34; }, \u0026#34;devDependencies\u0026#34;: { \u0026#34;@babel/core\u0026#34;: \u0026#34;^7.0.0\u0026#34;, \u0026#34;@babel/preset-env\u0026#34;: \u0026#34;^7.0.0\u0026#34;, \u0026#34;babel-loader\u0026#34;: \u0026#34;^8.0.2\u0026#34;, \u0026#34;webpack\u0026#34;: \u0026#34;^3.7.1\u0026#34;, \u0026#34;webpack-dev-server\u0026#34;: \u0026#34;^3.1.6\u0026#34; } } ç°åœ¨ï¼Œæ‚¨å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼š\n$ npm run serve è¿™å°†åœ¨æ‚¨çš„æµè§ˆå™¨ä¸­è‡ªåŠ¨æ‰“å¼€åœ°å€ä¸º localhost:8080 çš„ index.html ç½‘ç«™ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼‰ã€‚æ¯å½“ä½ åœ¨ index.js ä¸­æ›´æ”¹ JavaScript æ—¶ï¼Œwebpack-dev-server éƒ½ä¼šé‡å»ºå®ƒè‡ªå·±çš„æ†ç»‘ JavaScript å¹¶è‡ªåŠ¨åˆ·æ–°æµè§ˆå™¨ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æ—¶é—´èŠ‚çœï¼Œå› ä¸ºå®ƒå…è®¸æ‚¨å°†æ³¨æ„åŠ›é›†ä¸­åœ¨ä»£ç ä¸Šï¼Œè€Œä¸å¿…åœ¨ä»£ç å’Œæµè§ˆå™¨ä¹‹é—´ä¸æ–­åˆ‡æ¢ä¸Šä¸‹æ–‡ä»¥æŸ¥çœ‹æ–°çš„æ›´æ”¹ã€‚\nè¿™åªæ˜¯è¡¨é¢ï¼Œwebpack å’Œ webpack-dev-server è¿˜æœ‰æ›´å¤šé€‰é¡¹ï¼ˆä½ å¯ä»¥åœ¨è¿™é‡Œé˜…è¯»ï¼‰ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥åˆ¶ä½œ npm è„šæœ¬æ¥è¿è¡Œå…¶ä»–ä»»åŠ¡ï¼Œä¾‹å¦‚å°† Sass è½¬æ¢ä¸º CSSã€å‹ç¼©å›¾åƒã€è¿è¡Œæµ‹è¯• â€” ä»»ä½•å…·æœ‰å‘½ä»¤è¡Œå·¥å…·çš„ä¸œè¥¿éƒ½æ˜¯å…¬å¹³çš„æ¸¸æˆã€‚npm è„šæœ¬æœ¬èº«ä¹Ÿæœ‰ä¸€äº›å¾ˆæ£’çš„é«˜çº§é€‰é¡¹å’ŒæŠ€å·§â€”â€”Kate Hudson çš„è¿™ä¸ªæ¼”è®²æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„èµ·ç‚¹ï¼š\nhttps://youtu.be/0RYETb9YVrk\nç»“è®º ç®€è€Œè¨€ä¹‹ï¼Œè¿™å°±æ˜¯ç°ä»£ JavaScriptã€‚æˆ‘ä»¬ä»çº¯ HTML å’Œ JS è½¬å‘ä½¿ç”¨åŒ…ç®¡ç†å™¨è‡ªåŠ¨ä¸‹è½½ç¬¬ä¸‰æ–¹åŒ…ï¼Œä½¿ç”¨æ¨¡å—æ†ç»‘å™¨åˆ›å»ºå•ä¸ªè„šæœ¬æ–‡ä»¶ï¼Œä½¿ç”¨è½¬è¯‘å™¨ä½¿ç”¨æœªæ¥çš„ JavaScript åŠŸèƒ½ï¼Œä»¥åŠä»»åŠ¡è¿è¡Œå™¨æ¥è‡ªåŠ¨åŒ–æ„å»ºè¿‡ç¨‹çš„ä¸åŒéƒ¨åˆ†ã€‚è¿™é‡Œè‚¯å®šæœ‰å¾ˆå¤šç§»åŠ¨çš„éƒ¨åˆ†ï¼Œç‰¹åˆ«æ˜¯å¯¹äºåˆå­¦è€…ã€‚å¯¹äºåˆšæ¥è§¦ç¼–ç¨‹çš„äººæ¥è¯´ï¼ŒWeb å¼€å‘æ›¾ç»æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åˆ‡å…¥ç‚¹ï¼Œæ­£æ˜¯å› ä¸ºå®ƒå¾ˆå®¹æ˜“å¯åŠ¨å’Œè¿è¡Œ;å¦‚ä»Šï¼Œè¿™å¯èƒ½éå¸¸ä»¤äººç”Ÿç•ï¼Œç‰¹åˆ«æ˜¯å› ä¸ºå„ç§å·¥å…·å¾€å¾€ä¼šè¿…é€Ÿå˜åŒ–ã€‚\nä¸è¿‡ï¼Œå®ƒå¹¶ä¸åƒçœ‹èµ·æ¥é‚£ä¹ˆç³Ÿç³•ã€‚äº‹æƒ…æ­£åœ¨å®‰å®šä¸‹æ¥ï¼Œç‰¹åˆ«æ˜¯éšç€èŠ‚ç‚¹ç”Ÿæ€ç³»ç»Ÿä½œä¸ºä¸å‰ç«¯åˆä½œçš„å¯è¡Œæ–¹å¼çš„é‡‡ç”¨ã€‚ä½¿ç”¨ npm ä½œä¸ºåŒ…ç®¡ç†å™¨ï¼Œå°†èŠ‚ç‚¹ require æˆ– import è¯­å¥ç”¨äºæ¨¡å—ï¼Œä½¿ç”¨ npm è„šæœ¬æ¥è¿è¡Œä»»åŠ¡ï¼Œè¿™å¾ˆå¥½ä¸”ä¸€è‡´ã€‚ä¸ä¸€ä¸¤å¹´å‰ç›¸æ¯”ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤§å¤§ç®€åŒ–çš„å·¥ä½œæµç¨‹ï¼\nå¯¹äºåˆå­¦è€…å’Œæœ‰ç»éªŒçš„å¼€å‘äººå‘˜æ¥è¯´ï¼Œæ›´å¥½çš„æ˜¯ï¼Œå¦‚ä»Šçš„æ¡†æ¶é€šå¸¸å¸¦æœ‰ä½¿è¯¥è¿‡ç¨‹æ›´å®¹æ˜“ä¸Šæ‰‹çš„å·¥å…·ã€‚Ember æœ‰ ember-cli ï¼Œè¿™å¯¹ Angular çš„ angular-cli ã€React çš„ create-react-appã€Vue çš„ vue-cli ç­‰äº§ç”Ÿäº†å·¨å¤§çš„å½±å“ã€‚æ‰€æœ‰è¿™äº›å·¥å…·éƒ½å°†è®¾ç½®ä¸€ä¸ªåŒ…å«æ‚¨éœ€è¦çš„æ‰€æœ‰é¡¹ç›®â€”â€”æ‚¨éœ€è¦åšçš„å°±æ˜¯å¼€å§‹ç¼–å†™ä»£ç ã€‚ç„¶è€Œï¼Œè¿™äº›å·¥å…·å¹¶ä¸ç¥å¥‡ï¼Œå®ƒä»¬åªæ˜¯ä»¥ä¸€ç§ä¸€è‡´å’Œå·¥ä½œçš„æ–¹å¼è®¾ç½®äº†æ‰€æœ‰å†…å®¹â€”â€”ä½ å¯èƒ½ç»å¸¸éœ€è¦å¯¹ webpackã€babel ç­‰è¿›è¡Œä¸€äº›é¢å¤–çš„é…ç½®ã€‚å› æ­¤ï¼Œäº†è§£æˆ‘ä»¬åœ¨æœ¬æ–‡ä¸­ä»‹ç»çš„æ¯ä¸ªéƒ¨åˆ†çš„ä½œç”¨ä»ç„¶éå¸¸å…³é”®ã€‚\nç°ä»£ JavaScript åœ¨ä½¿ç”¨æ—¶è‚¯å®šä¼šä»¤äººæ²®ä¸§ï¼Œå› ä¸ºå®ƒç»§ç»­å¿«é€Ÿå˜åŒ–å’Œå‘å±•ã€‚ä½†æ˜¯ï¼Œå°½ç®¡æœ‰æ—¶çœ‹èµ·æ¥åƒæ˜¯é‡æ–°å‘æ˜è½®å­ï¼Œä½† JavaScript çš„å¿«é€Ÿå‘å±•æœ‰åŠ©äºæ¨åŠ¨è¯¸å¦‚çƒ­é‡è½½ï¼Œå®æ—¶ linting å’Œæ—¶é—´æ—…è¡Œè°ƒè¯•ç­‰åˆ›æ–°ã€‚ä½œä¸ºä¸€åå¼€å‘äººå‘˜ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¿€åŠ¨äººå¿ƒçš„æ—¶åˆ»ï¼Œæˆ‘å¸Œæœ›è¿™äº›ä¿¡æ¯å¯ä»¥ä½œä¸ºè·¯çº¿å›¾ï¼Œåœ¨æ‚¨çš„æ—…ç¨‹ä¸­ä¸ºæ‚¨æä¾›å¸®åŠ©ï¼\nç‰¹åˆ«æ„Ÿè°¢@ryanqnorthçš„æé¾™æ¼«ç”»ï¼Œè‡ª 2003 å¹´ä»¥æ¥ï¼ˆæé¾™ç»Ÿæ²»ç½‘ç»œï¼‰ä»¥æ¥ï¼Œå®ƒæä¾›äº†ä¸€äº›æœ€å¥½çš„è’è¯å¹½é»˜ã€‚\nåŸæ–‡é“¾æ¥ï¼šhttps://peterxjang.com/blog/modern-javascript-explained-for-dinosaurs.html\nè¯‘è€…å¤‡æ³¨ï¼š\nGithub ä¸Šæœ‰ä¸€ä¸ªå…³äºè¿™ç¯‡æ–‡ç« æºä»£ç çš„ä»“åº“ï¼šhttps://github.com/scherler/Modern-JavaScript-Explained-For-Dinosaurs\n","permalink":"https://blog.chensoul.cc/posts/2023/06/19/modern-javascript-explained-for-dinosaurs/","summary":"å›¾ç‰‡æ¥è‡ªRyan Northçš„Dinosaur Comicsã€‚ å¦‚æœä½ ä»ä¸€å¼€å§‹å°±æ²¡æœ‰å»è¿‡é‚£é‡Œï¼Œé‚£ä¹ˆå­¦ä¹ ç°ä»£ JavaScript æ˜¯å¾ˆå›°éš¾çš„ã€‚ç”Ÿæ€ç³»ç»Ÿçš„å‘å±•å’Œå˜åŒ–å¦‚æ­¤ä¹‹å¿«ï¼Œä»¥è‡³äºå¾ˆéš¾ç†è§£ä¸åŒå·¥å…·è¯•å›¾è§£å†³çš„é—®é¢˜ã€‚æˆ‘ä» 1998 å¹´å¼€å§‹ç¼–ç¨‹ï¼Œä½†ç›´åˆ° 2014 å¹´æ‰å¼€å§‹è®¤çœŸå­¦ä¹  JavaScriptã€‚å½“æ—¶æˆ‘è®°å¾—é‡åˆ° Browserify å¹¶ç›¯ç€å®ƒçš„æ ‡è¯­ï¼š\nBrowserify é€šè¿‡æ†ç»‘æ‰€æœ‰ä¾èµ–é¡¹ï¼Œè®©ä½ åœ¨æµè§ˆå™¨ä¸­å¯¼å…¥ï¼ˆ\u0026lsquo;æ¨¡å—\u0026rsquo;ï¼‰ã€‚\næˆ‘å‡ ä¹å¬ä¸æ‡‚è¿™å¥è¯ä¸­çš„ä»»ä½•å•è¯ï¼Œå¹¶ä¸”åŠªåŠ›ç†è§£è¿™å¯¹æˆ‘ä½œä¸ºå¼€å‘äººå‘˜æœ‰ä»€ä¹ˆå¸®åŠ©ã€‚\næœ¬æ–‡çš„ç›®çš„æ˜¯æä¾›ä¸€ä¸ªå†å²èƒŒæ™¯ï¼Œè¯´æ˜ JavaScript å·¥å…·å¦‚ä½•åœ¨ 2017 å¹´å‘å±•åˆ°ä»Šå¤©çš„æ ·å­ã€‚æˆ‘ä»¬å°†ä»å¤´å¼€å§‹ï¼Œåƒæé¾™ä¸€æ ·æ„å»ºä¸€ä¸ªç¤ºä¾‹ç½‘ç«™ - æ²¡æœ‰å·¥å…·ï¼Œåªæœ‰æ™®é€šçš„ HTML å’Œ JavaScriptã€‚ç„¶åï¼Œæˆ‘ä»¬å°†é€æ­¥ä»‹ç»ä¸åŒçš„å·¥å…·ï¼Œä»¥æŸ¥çœ‹å®ƒä»¬ä¸€æ¬¡è§£å†³ä¸€ä¸ªé—®é¢˜ã€‚æœ‰äº†è¿™ä¸ªå†å²èƒŒæ™¯ï¼Œä½ å°†èƒ½å¤Ÿæ›´å¥½åœ°å­¦ä¹ å’Œé€‚åº”æœªæ¥ä¸æ–­å˜åŒ–çš„ JavaScript ç¯å¢ƒã€‚è®©æˆ‘ä»¬å¼€å§‹å§ï¼\næ›´æ–°ï¼šæˆ‘åˆ¶ä½œäº†æœ¬æ–‡çš„è§†é¢‘è¯¾ç¨‹ç‰ˆæœ¬ï¼Œä¸ºäº†æ›´æ¸…æ™°ï¼Œæˆ‘é€æ­¥æµè§ˆäº†æ¯ä¸ªéƒ¨åˆ†ï¼Œè¯·åœ¨æ­¤å¤„æŸ¥çœ‹ï¼š https://firstclass.actualize.co/p/modern-javascript-explained-for-dinosaurs\nä»¥\u0026quot;è€æ´¾\u0026quot;çš„æ–¹å¼ä½¿ç”¨ JavaScript \u0026lt;!-- index.html --\u0026gt; \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;JavaScript Example\u0026lt;/title\u0026gt; ** \u0026lt;script src=\u0026#34;index.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; ** \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;Hello from HTML!\u0026lt;/h1\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ç¬¬ \u0026lt;script src=\u0026quot;index.js\u0026quot;\u0026gt;\u0026lt;/script\u0026gt; è¡Œå¼•ç”¨åŒä¸€ç›®å½•ä¸­åä¸º index.js çš„å•ç‹¬ JavaScript æ–‡ä»¶ï¼š\n// index.js console.log(\u0026#34;Hello from JavaScript!\u0026#34;); è¿™å°±æ˜¯åˆ¶ä½œç½‘ç«™æ‰€éœ€çš„å…¨éƒ¨å†…å®¹ï¼ç°åœ¨ï¼Œå‡è®¾æ‚¨æƒ³æ·»åŠ ä¸€ä¸ªå…¶ä»–äººç¼–å†™çš„åº“ï¼Œä¾‹å¦‚ moment.jsï¼ˆä¸€ä¸ªå¯ä»¥å¸®åŠ©ä»¥äººç±»å¯è¯»çš„æ–¹å¼æ ¼å¼åŒ–æ—¥æœŸçš„åº“ï¼‰ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨ JavaScript ä¸­ä½¿ç”¨ moment å‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nmoment().startOf(\u0026#34;day\u0026#34;).fromNow(); // 20 hours ago ä½†è¿™åªæ˜¯å‡è®¾æ‚¨åœ¨ç½‘ç«™ä¸ŠåŒ…å« moment.jsï¼åœ¨ moment.js ä¸»é¡µ ä¸Šæ‚¨ä¼šçœ‹åˆ°ä»¥ä¸‹è¯´æ˜ï¼š\nå—¯ï¼Œå³ä¾§çš„\u0026quot;å®‰è£…\u0026quot;éƒ¨åˆ†æœ‰å¾ˆå¤šå†…å®¹ã€‚ä½†æ˜¯ç°åœ¨è®©æˆ‘ä»¬å¿½ç•¥å®ƒ - æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨åŒä¸€ç›®å½•ä¸­ä¸‹è½½ moment.min.js æ–‡ä»¶å¹¶å°†å…¶åŒ…å«åœ¨æˆ‘ä»¬çš„ index.html æ–‡ä»¶ä¸­æ¥ä¸ºæˆ‘ä»¬çš„ç½‘ç«™æ·»åŠ  moment.jsã€‚\n\u0026lt;!-- index.html --\u0026gt; \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Example\u0026lt;/title\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;index.","title":"[è¯‘]ä¸ºæé¾™è§£é‡Šç°ä»£JavaScript"},{"content":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬å››ç« ã€Šç±»å’Œæ¥å£ã€‹çš„å­¦ä¹ ç¬”è®°ï¼šå°½é‡å‡å°‘ç±»å’Œæˆå‘˜çš„å¯è®¿é—®æ€§ã€‚\nç±»å’Œæ¥å£æ˜¯ Java ç¼–ç¨‹è¯­è¨€çš„æ ¸å¿ƒã€‚å®ƒä»¬æ˜¯æŠ½è±¡çš„åŸºæœ¬å•ä½ã€‚è¯¥è¯­è¨€æä¾›äº†è®¸å¤šå¼ºå¤§çš„å…ƒç´ ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥è®¾è®¡ç±»å’Œæ¥å£ã€‚\nä»‹ç» ã€ŠEffective Java, Third Editionã€‹è¿™æœ¬ä¹¦ä¸­çš„ç¬¬å››ç« ä¸»è¦è®²è¿°äº†å¦‚ä½•å°½é‡å‡å°‘ç±»å’Œæˆå‘˜çš„å¯è®¿é—®æ€§ï¼Œä»¥æé«˜ä»£ç çš„å°è£…æ€§ã€å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚\nå°½é‡å‡å°‘ç±»å’Œæˆå‘˜çš„å¯è®¿é—®æ€§æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„ä¸€ä¸ªåŸºæœ¬åŸåˆ™ï¼Œä¹Ÿè¢«ç§°ä¸º \u0026ldquo;æœ€å°åŒ–å¯è®¿é—®æ€§åŸåˆ™\u0026rdquo;ã€‚è¿™ä¸ªåŸåˆ™çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œå°†ç±»å’Œæˆå‘˜çš„è®¿é—®çº§åˆ«é™åˆ¶åœ¨æœ€å°èŒƒå›´å†…ï¼Œä»è€Œæé«˜ä»£ç çš„å®‰å…¨æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯å¤ç”¨æ€§ã€‚\nåœ¨ Java ä¸­ï¼Œç±»å’Œæˆå‘˜çš„è®¿é—®çº§åˆ«æœ‰å››ç§ï¼špublicã€protectedã€default å’Œ privateã€‚å…¶ä¸­ï¼Œpublic çº§åˆ«æ˜¯æœ€é«˜çš„ï¼Œå¯ä»¥è¢«ä»»ä½•ç±»è®¿é—®ï¼›private çº§åˆ«æ˜¯æœ€ä½çš„ï¼Œåªèƒ½è¢«åŒä¸€ä¸ªç±»å†…éƒ¨çš„æˆå‘˜è®¿é—®ã€‚åœ¨åº”ç”¨æœ€å°åŒ–å¯è®¿é—®æ€§åŸåˆ™æ—¶ï¼Œåº”è¯¥å°½å¯èƒ½åœ°å°†ç±»å’Œæˆå‘˜çš„è®¿é—®çº§åˆ«è®¾ç½®ä¸ºæœ€ä½çš„çº§åˆ«ï¼Œå³ private æˆ– default çº§åˆ«ã€‚\nå°½é‡å‡å°‘ç±»å’Œæˆå‘˜çš„å¯è®¿é—®æ€§æ˜¯ä¸€ç§è‰¯å¥½çš„ç¼–ç¨‹å®è·µï¼Œå¯ä»¥æé«˜ä»£ç çš„å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å»ºè®®ï¼š\nå°†ç±»å’Œæˆå‘˜çš„å¯è§æ€§è®¾ç½®ä¸ºæœ€å°åŒ–çš„çº§åˆ«ï¼Œå³åªæœ‰å¿…è¦çš„ä»£ç å¯ä»¥è®¿é—®å®ƒä»¬ã€‚è¿™å°†å‡å°‘ä¸å¿…è¦çš„ä¾èµ–å…³ç³»ï¼Œå¹¶ä½¿ä»£ç æ›´åŠ æ¨¡å—åŒ–å’Œå¯é‡ç”¨ã€‚\nä½¿ç”¨è®¿é—®ä¿®é¥°ç¬¦ä»¥é™åˆ¶ç±»å’Œæˆå‘˜çš„å¯è§æ€§ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªæˆå‘˜åªèƒ½åœ¨ç±»å†…éƒ¨ä½¿ç”¨ï¼Œå¯ä»¥è€ƒè™‘å°†å…¶è½¬æ¢ä¸ºç§æœ‰é™æ€åµŒå¥—ç±»ã€‚å¦‚æœä¸€ä¸ªæˆå‘˜éœ€è¦åœ¨ç±»çš„å­ç±»ä¸­ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ protected ä¿®é¥°ç¬¦ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•å°†åŒ…çº§ç§æœ‰é¡¶çº§ç±»è½¬æ¢ä¸ºç§æœ‰é™æ€åµŒå¥—ç±»ï¼š\n// åŒ…çº§ç§æœ‰é¡¶çº§ç±» class MyTopLevelClass { // ... } public class MyClass { private static class MyPrivateNestedClass { // ä½¿ç”¨ MyTopLevelClass çš„ä»£ç  } // ä½¿ç”¨ MyPrivateNestedClass çš„ä»£ç  } åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒMyTopLevelClass è¢«è½¬æ¢ä¸ºäº† MyPrivateNestedClassï¼Œå®ƒè¢«å£°æ˜ä¸º MyClass çš„ç§æœ‰é™æ€åµŒå¥—ç±»ã€‚è¿™æ ·ï¼ŒMyTopLevelClass å°±åªèƒ½è¢« MyPrivateNestedClass ä½¿ç”¨ï¼Œè€Œ MyPrivateNestedClass åªèƒ½è¢« MyClass ä½¿ç”¨ï¼Œè¾¾åˆ°äº†å®‰å…¨å’Œæ¸…æ™°çš„ç›®æ ‡ã€‚\né¿å…ä½¿ç”¨å…¬å…±æˆå‘˜æˆ–å…¬å…±æ–¹æ³•ã€‚å…¬å…±æˆå‘˜å’Œæ–¹æ³•å¯ä»¥è¢«ä»»ä½•ä»£ç è®¿é—®ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´å®‰å…¨é—®é¢˜å’Œä¸å¿…è¦çš„ä»£ç è€¦åˆã€‚ç›¸åï¼Œåº”è¯¥ä½¿ç”¨å°è£…çš„æ–¹å¼æ¥éšè—ç±»çš„å®ç°ç»†èŠ‚ï¼Œå¹¶åœ¨éœ€è¦æ—¶æä¾›å…¬å…±æ¥å£ã€‚\nåœ¨éœ€è¦ä½¿ç”¨å…¬å…±æ¥å£æ—¶ï¼Œä½¿ç”¨æ¥å£æˆ–æŠ½è±¡ç±»æ¥å®šä¹‰å…¬å…±å¥‘çº¦ã€‚è¿™æ ·å¯ä»¥ä½¿ä»£ç æ›´åŠ çµæ´»ï¼Œå¹¶ä½¿å®ç°ç»†èŠ‚èƒ½å¤Ÿç‹¬ç«‹äºå…¬å…±å¥‘çº¦è¿›è¡Œä¿®æ”¹ã€‚\nä½¿ç”¨ final å…³é”®å­—æ¥é™åˆ¶ç±»å’Œæˆå‘˜çš„å¯å˜æ€§ã€‚è¿™å¯ä»¥æé«˜ä»£ç çš„å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œå¹¶é¿å…åœ¨ä¸å¿…è¦çš„æƒ…å†µä¸‹ä¿®æ”¹ä»£ç ã€‚\næ‰©å±• è®¾è®¡å…¬å…±æ¥å£éœ€è¦è€ƒè™‘æ¥å£çš„ç®€æ´æ€§ã€æ˜“ç”¨æ€§å’Œä¸€è‡´æ€§ï¼ŒåŒæ—¶é¿å…æš´éœ²è¿‡å¤šçš„åº•å±‚å®ç°ç»†èŠ‚ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•è®¾è®¡ä¸€ä¸ªå…¬å…±æ¥å£ã€‚\n/** * This interface provides a simple way to perform arithmetic operations. * @author chensoul * @since 1.0.0 */ public interface Arithmetic { /** * Adds two integers and returns the result. * * @param a the first integer * @param b the second integer * @return the sum of a and b */ int add(int a, int b); /** * Subtracts two integers and returns the result. * * @param a the first integer * @param b the second integer * @return the difference of a and b */ int subtract(int a, int b); /** * Multiplies two integers and returns the result. * * @param a the first integer * @param b the second integer * @return the product of a and b */ int multiply(int a, int b); /** * Divides two integers and returns the result. * * @param a the numerator * @param b the denominator * @return the quotient of a and b * @throws ArithmeticException if b is zero */ int divide(int a, int b) throws ArithmeticException; } åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ªåä¸º Arithmetic çš„æ¥å£ï¼Œå®ƒæä¾›äº†å››ä¸ªåŸºæœ¬çš„ç®—æœ¯æ“ä½œï¼šåŠ æ³•ã€å‡æ³•ã€ä¹˜æ³•å’Œé™¤æ³•ã€‚æ¯ä¸ªæ–¹æ³•éƒ½æœ‰æ¸…æ™°çš„æ–‡æ¡£æ³¨é‡Šï¼Œæè¿°äº†æ–¹æ³•çš„ç”¨é€”ã€å‚æ•°å’Œè¿”å›å€¼ã€‚æ­¤å¤–ï¼Œé™¤æ³•æ–¹æ³•è¿˜å£°æ˜äº†ä¸€ä¸ªå¼‚å¸¸ï¼Œä»¥é˜²æ­¢é™¤ä»¥é›¶çš„æƒ…å†µã€‚\nä»¥ä¸‹æ˜¯ä¸€äº›å…³äºå¦‚ä½•è®¾è®¡å…¬å…± API çš„æœ€ä½³å®è·µï¼š\næœ€å°åŒ–å…¬å…± APIï¼šå°½å¯èƒ½åœ°å‡å°‘å…¬å…± API çš„è§„æ¨¡å’Œå¤æ‚åº¦ï¼Œåªæš´éœ²å¿…è¦çš„æ¥å£å’Œè¡Œä¸ºã€‚è¿™æ ·å¯ä»¥ä¿æŒ API çš„ç®€å•æ€§å’Œç¨³å®šæ€§ï¼Œé¿å…æ„å¤–çš„ä¾èµ–å’Œè€¦åˆã€‚ ä¿æŠ¤ä¸å¯å˜æ€§ï¼šå¯¹äºå…¬å…±é™æ€ final å­—æ®µå¼•ç”¨çš„å¯¹è±¡ï¼Œåº”è¯¥ç¡®ä¿å®ƒä»¬æ˜¯ä¸å¯å˜çš„ï¼Œä»¥é¿å…æ„å¤–ä¿®æ”¹å…¬å…±çŠ¶æ€ã€‚ ä½¿ç”¨æ¥å£å’ŒæŠ½è±¡ç±»ï¼šä½¿ç”¨æ¥å£å’ŒæŠ½è±¡ç±»æ¥å®šä¹‰å…¬å…± APIï¼Œä»è€Œä½¿å¾—å®ç°ç±»å¯ä»¥çµæ´»åœ°é€‰æ‹©è‡ªå·±çš„å®ç°æ–¹å¼ã€‚åŒæ—¶ï¼Œæ¥å£å’ŒæŠ½è±¡ç±»å¯ä»¥éšè—å®ç°ç»†èŠ‚ï¼Œä¿æŒ API çš„ç®€å•æ€§å’Œç¨³å®šæ€§ã€‚ ä½¿ç”¨æšä¸¾ç±»å‹ï¼šæšä¸¾ç±»å‹å¯ä»¥åœ¨å®šä¹‰ä¸€ç»„å¸¸é‡æ—¶æä¾›ç±»å‹å®‰å…¨æ€§ï¼Œå¹¶ä¸”å¯ä»¥é¿å…æ„å¤–çš„å®ä¾‹åŒ–å’Œä¿®æ”¹ã€‚ æ–‡æ¡£åŒ– APIï¼šæä¾›è¯¦ç»†çš„æ–‡æ¡£å’Œç¤ºä¾‹ä»£ç ï¼Œä»¥ä¾¿å¼€å‘äººå‘˜èƒ½å¤Ÿæ­£ç¡®åœ°ä½¿ç”¨å…¬å…± APIã€‚ å½“è®¾è®¡ä¸€ä¸ªå…¬å…± API æ—¶ï¼Œæ–‡æ¡£åŒ–æ˜¯éå¸¸é‡è¦çš„ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å…³äºå¦‚ä½•æ–‡æ¡£åŒ– API çš„æœ€ä½³å®è·µï¼š\næä¾› API æ–‡æ¡£ï¼šä¸º API æä¾›è¯¦ç»†çš„æ–‡æ¡£ï¼ŒåŒ…æ‹¬ API çš„ä½¿ç”¨æ–¹æ³•ã€æ¥å£ã€å‚æ•°ã€è¿”å›å€¼ã€å¼‚å¸¸å’Œç¤ºä¾‹ä»£ç ç­‰ã€‚API æ–‡æ¡£åº”è¯¥æ¸…æ™°ã€ç®€å•ã€æ˜“äºç†è§£ï¼Œå¹¶ä¸”åº”è¯¥æä¾›è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡å’Œè§£é‡Šã€‚ ä¸º API æä¾›ç¤ºä¾‹ä»£ç ï¼šä¸º API æä¾›è¯¦ç»†çš„ç¤ºä¾‹ä»£ç ï¼Œä»¥ä¾¿å¼€å‘äººå‘˜èƒ½å¤Ÿå¿«é€Ÿåœ°ç†è§£å’Œä½¿ç”¨ APIã€‚ç¤ºä¾‹ä»£ç åº”è¯¥æ¸…æ™°ã€ç®€å•ã€æ˜“äºç†è§£ï¼Œå¹¶ä¸”åº”è¯¥æä¾›è¶³å¤Ÿçš„æ³¨é‡Šå’Œè§£é‡Šã€‚ ä½¿ç”¨æ ‡å‡†æ³¨é‡Šï¼šä½¿ç”¨æ ‡å‡†æ³¨é‡Šæ ¼å¼ï¼Œä¾‹å¦‚ Javadoc æˆ–è€… Doxygenï¼Œä»¥ä¾¿ç”Ÿæˆ API æ–‡æ¡£ã€‚æ ‡å‡†æ³¨é‡Šæ ¼å¼å¯ä»¥æé«˜æ–‡æ¡£çš„ä¸€è‡´æ€§å’Œå¯è¯»æ€§ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·æ¥ç”Ÿæˆ API æ–‡æ¡£ã€‚ ä¸º API æä¾›ç‰ˆæœ¬å·ï¼šä¸º API æä¾›ç‰ˆæœ¬å·ï¼Œä»¥ä¾¿å¼€å‘äººå‘˜å¯ä»¥è·Ÿè¸ª API çš„æ¼”å˜å’Œå˜åŒ–ã€‚ç‰ˆæœ¬å·åº”è¯¥æ¸…æ™°ã€ç®€å•ã€æ˜“äºç†è§£ï¼Œå¹¶ä¸”åº”è¯¥éµå¾ªä¸€å®šçš„å‘½åè§„åˆ™ã€‚ æä¾› API æ›´æ–°æ—¥å¿—ï¼šä¸º API æä¾›æ›´æ–°æ—¥å¿—ï¼Œä»¥ä¾¿å¼€å‘äººå‘˜å¯ä»¥äº†è§£ API çš„å˜åŒ–å’Œæ¼”å˜ã€‚æ›´æ–°æ—¥å¿—åº”è¯¥æ¸…æ™°ã€ç®€å•ã€æ˜“äºç†è§£ï¼Œå¹¶ä¸”åº”è¯¥æä¾›è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡å’Œè§£é‡Šã€‚ é¿å…ä½¿ç”¨è¿‡æ—¶çš„ APIï¼šé¿å…ä½¿ç”¨è¿‡æ—¶çš„ APIï¼Œä»¥é¿å…å‡ºç°ä¸å¿…è¦çš„é—®é¢˜å’Œé”™è¯¯ã€‚å¦‚æœå¿…é¡»ä½¿ç”¨è¿‡æ—¶çš„ APIï¼Œåº”è¯¥æä¾›è­¦å‘Šå’Œæ›¿ä»£æ–¹æ¡ˆï¼Œä»¥ä¾¿å¼€å‘äººå‘˜èƒ½å¤Ÿäº†è§£é£é™©å’Œæ›¿ä»£æ–¹æ¡ˆã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ Javadoc æ³¨é‡Šæ ¼å¼ä¸º Java ç±»å’Œæ–¹æ³•æ–‡æ¡£åŒ–çš„ç¤ºä¾‹ä»£ç ï¼š\n/** * The BasicArithmetic class provides a basic implementation of the Arithmetic interface. * This implementation is not recommended for use in production code, and will be removed in a future release. * * @deprecated This class is for demonstration purposes only. * Use {@link AdvancedArithmetic} for more advanced arithmetic operations. * For basic arithmetic operations, use the {@link java.lang.Math} class instead. * @see Arithmetic * @see AdvancedArithmetic * @see java.lang.Math * @since 1.0.0 */ @Deprecated public class BasicArithmetic implements Arithmetic { /** * {@inheritDoc} * * @param a the first integer to be added * @param b the second integer to be added * @return the sum of a and b */ @Override public int add(int a, int b) { return a + b; } /** * {@inheritDoc} * * @param a the integer to be subtracted from * @param b the integer to subtract * @return the difference of a and b */ @Override public int subtract(int a, int b) { return a - b; } /** * {@inheritDoc} * * @param a the first integer to be multiplied * @param b the second integer to be multiplied * @return the product of a and b */ @Override public int multiply(int a, int b) { return a * b; } /** * {@inheritDoc} * * @param a the numerator to be divided * @param b the denominator to divide by * @return the quotient of a and b * @throws ArithmeticException if b is zero */ @Override public int divide(int a, int b) throws ArithmeticException { if (b == 0) { throw new ArithmeticException(\u0026#34;Cannot divide by zero.\u0026#34;); } return a / b; } } åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†@authoã€@sinceã€@seeã€@link ã€@deprecated å’Œ @inheritDoc æ ‡è®°ã€‚\n@author æ ‡è®°æŒ‡å®šäº†ç±»çš„ä½œè€…ï¼Œå¯ä»¥æ˜¯å•ä¸ªäººæˆ–ç»„ç»‡ã€‚\n@since æ ‡è®°æŒ‡å®šäº†ç±»æœ€åˆè¢«å¼•å…¥çš„ç‰ˆæœ¬ã€‚\n@see æ ‡è®°æä¾›äº†ä¸€ä¸ªé“¾æ¥åˆ°å…¶ä»–ç›¸å…³çš„ç±»æˆ–æ¥å£ã€‚\n@link æ ‡è®°æä¾›äº†ä¸€ä¸ªé“¾æ¥åˆ°å…¶ä»–ç›¸å…³çš„ç±»ã€æ–¹æ³•ã€å­—æ®µæˆ–åŒ…ã€‚\n@deprecated æ ‡è®°æŒ‡ç¤ºè¯¥ç±»æˆ–æ–¹æ³•å·²è¿‡æ—¶ï¼Œä¸æ¨èä½¿ç”¨ï¼Œå¹¶ä¼šåœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­è¢«åˆ é™¤ã€‚\n@inheritDoc ç»§æ‰¿çˆ¶ç±»çš„ Javadoc æ³¨é‡Šã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ@inheritDoc æ ‡è®°ä¸èƒ½ç»§æ‰¿ä»»ä½•å…¶ä»–çš„æ³¨é‡Šä¿¡æ¯ï¼Œå¦‚å‚æ•°ã€è¿”å›å€¼æˆ–å¼‚å¸¸ã€‚å¦‚æœå­ç±»æ–¹æ³•æœ‰è‡ªå·±çš„å‚æ•°ã€è¿”å›å€¼æˆ–å¼‚å¸¸ï¼Œåˆ™éœ€è¦åœ¨å­ç±»æ–¹æ³•ä¸­æ·»åŠ å¯¹åº”çš„ Javadoc æ³¨é‡Šã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/06/15/minimize-the-accessibility-of-classes-and-members/","summary":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬å››ç« ã€Šç±»å’Œæ¥å£ã€‹çš„å­¦ä¹ ç¬”è®°ï¼šå°½é‡å‡å°‘ç±»å’Œæˆå‘˜çš„å¯è®¿é—®æ€§ã€‚\nç±»å’Œæ¥å£æ˜¯ Java ç¼–ç¨‹è¯­è¨€çš„æ ¸å¿ƒã€‚å®ƒä»¬æ˜¯æŠ½è±¡çš„åŸºæœ¬å•ä½ã€‚è¯¥è¯­è¨€æä¾›äº†è®¸å¤šå¼ºå¤§çš„å…ƒç´ ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥è®¾è®¡ç±»å’Œæ¥å£ã€‚\nä»‹ç» ã€ŠEffective Java, Third Editionã€‹è¿™æœ¬ä¹¦ä¸­çš„ç¬¬å››ç« ä¸»è¦è®²è¿°äº†å¦‚ä½•å°½é‡å‡å°‘ç±»å’Œæˆå‘˜çš„å¯è®¿é—®æ€§ï¼Œä»¥æé«˜ä»£ç çš„å°è£…æ€§ã€å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚\nå°½é‡å‡å°‘ç±»å’Œæˆå‘˜çš„å¯è®¿é—®æ€§æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„ä¸€ä¸ªåŸºæœ¬åŸåˆ™ï¼Œä¹Ÿè¢«ç§°ä¸º \u0026ldquo;æœ€å°åŒ–å¯è®¿é—®æ€§åŸåˆ™\u0026rdquo;ã€‚è¿™ä¸ªåŸåˆ™çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œå°†ç±»å’Œæˆå‘˜çš„è®¿é—®çº§åˆ«é™åˆ¶åœ¨æœ€å°èŒƒå›´å†…ï¼Œä»è€Œæé«˜ä»£ç çš„å®‰å…¨æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯å¤ç”¨æ€§ã€‚\nåœ¨ Java ä¸­ï¼Œç±»å’Œæˆå‘˜çš„è®¿é—®çº§åˆ«æœ‰å››ç§ï¼špublicã€protectedã€default å’Œ privateã€‚å…¶ä¸­ï¼Œpublic çº§åˆ«æ˜¯æœ€é«˜çš„ï¼Œå¯ä»¥è¢«ä»»ä½•ç±»è®¿é—®ï¼›private çº§åˆ«æ˜¯æœ€ä½çš„ï¼Œåªèƒ½è¢«åŒä¸€ä¸ªç±»å†…éƒ¨çš„æˆå‘˜è®¿é—®ã€‚åœ¨åº”ç”¨æœ€å°åŒ–å¯è®¿é—®æ€§åŸåˆ™æ—¶ï¼Œåº”è¯¥å°½å¯èƒ½åœ°å°†ç±»å’Œæˆå‘˜çš„è®¿é—®çº§åˆ«è®¾ç½®ä¸ºæœ€ä½çš„çº§åˆ«ï¼Œå³ private æˆ– default çº§åˆ«ã€‚\nå°½é‡å‡å°‘ç±»å’Œæˆå‘˜çš„å¯è®¿é—®æ€§æ˜¯ä¸€ç§è‰¯å¥½çš„ç¼–ç¨‹å®è·µï¼Œå¯ä»¥æé«˜ä»£ç çš„å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å»ºè®®ï¼š\nå°†ç±»å’Œæˆå‘˜çš„å¯è§æ€§è®¾ç½®ä¸ºæœ€å°åŒ–çš„çº§åˆ«ï¼Œå³åªæœ‰å¿…è¦çš„ä»£ç å¯ä»¥è®¿é—®å®ƒä»¬ã€‚è¿™å°†å‡å°‘ä¸å¿…è¦çš„ä¾èµ–å…³ç³»ï¼Œå¹¶ä½¿ä»£ç æ›´åŠ æ¨¡å—åŒ–å’Œå¯é‡ç”¨ã€‚\nä½¿ç”¨è®¿é—®ä¿®é¥°ç¬¦ä»¥é™åˆ¶ç±»å’Œæˆå‘˜çš„å¯è§æ€§ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªæˆå‘˜åªèƒ½åœ¨ç±»å†…éƒ¨ä½¿ç”¨ï¼Œå¯ä»¥è€ƒè™‘å°†å…¶è½¬æ¢ä¸ºç§æœ‰é™æ€åµŒå¥—ç±»ã€‚å¦‚æœä¸€ä¸ªæˆå‘˜éœ€è¦åœ¨ç±»çš„å­ç±»ä¸­ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ protected ä¿®é¥°ç¬¦ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•å°†åŒ…çº§ç§æœ‰é¡¶çº§ç±»è½¬æ¢ä¸ºç§æœ‰é™æ€åµŒå¥—ç±»ï¼š\n// åŒ…çº§ç§æœ‰é¡¶çº§ç±» class MyTopLevelClass { // ... } public class MyClass { private static class MyPrivateNestedClass { // ä½¿ç”¨ MyTopLevelClass çš„ä»£ç  } // ä½¿ç”¨ MyPrivateNestedClass çš„ä»£ç  } åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒMyTopLevelClass è¢«è½¬æ¢ä¸ºäº† MyPrivateNestedClassï¼Œå®ƒè¢«å£°æ˜ä¸º MyClass çš„ç§æœ‰é™æ€åµŒå¥—ç±»ã€‚è¿™æ ·ï¼ŒMyTopLevelClass å°±åªèƒ½è¢« MyPrivateNestedClass ä½¿ç”¨ï¼Œè€Œ MyPrivateNestedClass åªèƒ½è¢« MyClass ä½¿ç”¨ï¼Œè¾¾åˆ°äº†å®‰å…¨å’Œæ¸…æ™°çš„ç›®æ ‡ã€‚\né¿å…ä½¿ç”¨å…¬å…±æˆå‘˜æˆ–å…¬å…±æ–¹æ³•ã€‚å…¬å…±æˆå‘˜å’Œæ–¹æ³•å¯ä»¥è¢«ä»»ä½•ä»£ç è®¿é—®ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´å®‰å…¨é—®é¢˜å’Œä¸å¿…è¦çš„ä»£ç è€¦åˆã€‚ç›¸åï¼Œåº”è¯¥ä½¿ç”¨å°è£…çš„æ–¹å¼æ¥éšè—ç±»çš„å®ç°ç»†èŠ‚ï¼Œå¹¶åœ¨éœ€è¦æ—¶æä¾›å…¬å…±æ¥å£ã€‚\nåœ¨éœ€è¦ä½¿ç”¨å…¬å…±æ¥å£æ—¶ï¼Œä½¿ç”¨æ¥å£æˆ–æŠ½è±¡ç±»æ¥å®šä¹‰å…¬å…±å¥‘çº¦ã€‚è¿™æ ·å¯ä»¥ä½¿ä»£ç æ›´åŠ çµæ´»ï¼Œå¹¶ä½¿å®ç°ç»†èŠ‚èƒ½å¤Ÿç‹¬ç«‹äºå…¬å…±å¥‘çº¦è¿›è¡Œä¿®æ”¹ã€‚\nä½¿ç”¨ final å…³é”®å­—æ¥é™åˆ¶ç±»å’Œæˆå‘˜çš„å¯å˜æ€§ã€‚è¿™å¯ä»¥æé«˜ä»£ç çš„å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œå¹¶é¿å…åœ¨ä¸å¿…è¦çš„æƒ…å†µä¸‹ä¿®æ”¹ä»£ç ã€‚\næ‰©å±• è®¾è®¡å…¬å…±æ¥å£éœ€è¦è€ƒè™‘æ¥å£çš„ç®€æ´æ€§ã€æ˜“ç”¨æ€§å’Œä¸€è‡´æ€§ï¼ŒåŒæ—¶é¿å…æš´éœ²è¿‡å¤šçš„åº•å±‚å®ç°ç»†èŠ‚ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•è®¾è®¡ä¸€ä¸ªå…¬å…±æ¥å£ã€‚\n/** * This interface provides a simple way to perform arithmetic operations. * @author chensoul * @since 1.0.0 */ public interface Arithmetic { /** * Adds two integers and returns the result.","title":"ã€ŠEffective Java 3ã€‹ç¬”è®°15ï¼šå°½é‡å‡å°‘ç±»å’Œæˆå‘˜çš„å¯è®¿é—®æ€§"},{"content":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬å››ç« ã€Šç±»å’Œæ¥å£ã€‹çš„å­¦ä¹ ç¬”è®°ï¼šåœ¨å…¬å…±ç±»ä¸­ï¼Œä½¿ç”¨è®¿é—®å™¨æ–¹æ³•ï¼Œè€Œä¸æ˜¯å…¬å…±å­—æ®µã€‚\nä»‹ç» ä¸å…¶ç›´æ¥å°†ç±»çš„å†…éƒ¨å­—æ®µå…¬å¼€ä¸ºå…¬å…±å­—æ®µï¼Œæ¨èä½¿ç”¨è®¿é—®å™¨æ–¹æ³•ï¼ˆä¹Ÿç§°ä¸º getter å’Œ setterï¼‰æ¥è®¿é—®å’Œä¿®æ”¹å¯¹è±¡çš„çŠ¶æ€ã€‚è¿™æ ·å¯ä»¥ä½¿ç±»å¯¹å…¶å†…éƒ¨è¡¨ç¤ºä¿æŒæ§åˆ¶ï¼Œå¹¶ä¸ºç±»çš„å®¢æˆ·ç«¯æä¾›ä¸€ç§æŠ½è±¡ç¨‹åº¦ã€‚\né€šè¿‡ä½¿ç”¨è®¿é—®å™¨æ–¹æ³•ï¼Œæ‚¨å¯ä»¥å®ç°ä»¥ä¸‹ç›®æ ‡ï¼š\nå°è£…å†…éƒ¨è¡¨ç¤ºï¼ˆEncapsulate Internal Representationï¼‰ï¼š Getter æ–¹æ³•ï¼šGetter æ–¹æ³•ç”¨äºè·å–ç§æœ‰å­—æ®µçš„å€¼ã€‚é€šè¿‡ä½¿ç”¨ getter æ–¹æ³•ï¼Œå¯ä»¥å°†å­—æ®µçš„è®¿é—®é™åˆ¶åœ¨ç±»çš„å†…éƒ¨ï¼Œä»è€Œéšè—äº†å­—æ®µçš„å…·ä½“å®ç°ç»†èŠ‚ã€‚å®¢æˆ·ç«¯åªèƒ½é€šè¿‡è°ƒç”¨ getter æ–¹æ³•æ¥è·å–å­—æ®µçš„å€¼ï¼Œè€Œæ— æ³•ç›´æ¥è®¿é—®å­—æ®µæœ¬èº«ã€‚ Setter æ–¹æ³•ï¼šSetter æ–¹æ³•ç”¨äºè®¾ç½®ç§æœ‰å­—æ®µçš„å€¼ã€‚ä½¿ç”¨ setter æ–¹æ³•ï¼Œå¯ä»¥å¯¹å­—æ®µè¿›è¡ŒéªŒè¯ã€çº¦æŸå’Œé€»è¾‘å¤„ç†ã€‚è¿™æ ·ï¼Œç±»å¯ä»¥å¯¹å­—æ®µçš„ä¿®æ”¹è¿›è¡Œæ§åˆ¶ï¼Œå¹¶ç¡®ä¿åªæœ‰ç»è¿‡éªŒè¯çš„å€¼æ‰èƒ½è¢«è®¾ç½®ã€‚ æ§åˆ¶è®¿é—®å’Œä¿®æ”¹ï¼ˆControl Access and Modificationï¼‰ï¼š Getter æ–¹æ³•ï¼šé€šè¿‡ getter æ–¹æ³•ï¼Œå¯ä»¥å¯¹å­—æ®µçš„è®¿é—®è¿›è¡Œæ§åˆ¶ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨ getter æ–¹æ³•ä¸­æ·»åŠ æƒé™æ£€æŸ¥ï¼Œåªå…è®¸ç‰¹å®šçš„ç”¨æˆ·æˆ–è§’è‰²è·å–å­—æ®µçš„å€¼ã€‚è¿˜å¯ä»¥åœ¨ getter æ–¹æ³•ä¸­è¿›è¡Œè®¡ç®—æˆ–è½¬æ¢ï¼Œä»¥ä¾¿è¿”å›ä¸åŒäºå­—æ®µæœ¬èº«çš„å€¼ã€‚ Setter æ–¹æ³•ï¼šSetter æ–¹æ³•å…è®¸å¯¹å­—æ®µçš„ä¿®æ”¹è¿›è¡Œæ§åˆ¶ã€‚åœ¨ setter æ–¹æ³•ä¸­ï¼Œå¯ä»¥è¿›è¡Œè¾“å…¥éªŒè¯ã€èŒƒå›´æ£€æŸ¥å’Œå…¶ä»–é€»è¾‘å¤„ç†ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿åªæœ‰ç¬¦åˆè§„å®šçš„å€¼æ‰èƒ½è¢«è®¾ç½®åˆ°å­—æ®µä¸­ï¼Œä»è€Œä¿æŒç±»çš„çŠ¶æ€çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚ ä¿ƒè¿›æ¼”åŒ–å’Œå…¼å®¹æ€§ï¼šå¦‚æœä½¿ç”¨å…¬å…±å­—æ®µï¼Œå¹¶ä¸”ä»¥åéœ€è¦æ›´æ”¹è¡¨ç¤ºæ–¹å¼æˆ–æ·»åŠ é™„åŠ é€»è¾‘ï¼Œåˆ™å¾ˆéš¾ä¿æŒå‘åå…¼å®¹æ€§ã€‚ç„¶è€Œï¼Œé€šè¿‡ä½¿ç”¨è®¿é—®å™¨æ–¹æ³•ï¼Œå¯ä»¥ä¿®æ”¹å†…éƒ¨è¡¨ç¤ºæˆ–æ·»åŠ æ–°è¡Œä¸ºï¼Œè€Œä¸ä¼šå½±å“ç±»çš„å®¢æˆ·ç«¯ã€‚ åä¾‹ Java åº“ä¸­çš„å‡ ä¸ªç±»è¿åäº†å…¬å…±ç±»ä¸åº”è¯¥ç›´æ¥å…¬å¼€å­—æ®µçš„å»ºè®®ã€‚çªå‡ºçš„ä¾‹å­åŒ…æ‹¬ java.awt åŒ…ä¸­çš„ Point å’Œ Dimensionã€‚\nåœ¨ Java çš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œä¸€äº›ç±»è®¾è®¡å¹¶æ²¡æœ‰éµå¾ªç°ä»£çš„é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™å’Œæœ€ä½³å®è·µã€‚è¿™äº›ç±»ä¸­çš„å­—æ®µè¢«ç›´æ¥å£°æ˜ä¸ºå…¬å…±ï¼ˆpublicï¼‰ï¼Œè€Œæ²¡æœ‰æä¾›ç›¸åº”çš„è®¿é—®å™¨æ–¹æ³•ã€‚\nä¾‹å¦‚ï¼Œjava.awt åŒ…ä¸­çš„ Point ç±»å’Œ Dimension ç±»æä¾›äº†å…¬å…±çš„ xã€y å’Œ widthã€height å­—æ®µæ¥è¡¨ç¤ºç‚¹çš„åæ ‡å’ŒçŸ©å½¢çš„å®½åº¦å’Œé«˜åº¦ã€‚è¿™æ„å‘³ç€å®¢æˆ·ç«¯ä»£ç å¯ä»¥ç›´æ¥è®¿é—®å’Œä¿®æ”¹è¿™äº›å­—æ®µï¼Œç»•è¿‡äº†å°è£…å’Œæ§åˆ¶çš„æœºåˆ¶ã€‚\nè¿™ç§è®¾è®¡æ–¹å¼å­˜åœ¨ä¸€äº›é—®é¢˜ï¼š\nç¼ºä¹å°è£…ï¼šç›´æ¥å…¬å¼€å­—æ®µç ´åäº†å°è£…çš„åŸåˆ™ï¼Œä½¿å¾—ç±»çš„å†…éƒ¨è¡¨ç¤ºæš´éœ²ç»™å¤–éƒ¨ï¼Œå¯¼è‡´äº†ä¸å¯é¢„æµ‹çš„è¡Œä¸ºå’Œæ½œåœ¨çš„é”™è¯¯ã€‚ é™åˆ¶æ‰©å±•æ€§ï¼šå¦‚æœéœ€è¦åœ¨è¿™äº›ç±»ä¸­æ·»åŠ éªŒè¯é€»è¾‘ã€è®¡ç®—å±æ€§æˆ–å®ç°å…¶ä»–è¡Œä¸ºï¼Œä¼šé¢ä¸´å›°éš¾ï¼Œå› ä¸ºä¸èƒ½åœ¨å­—æ®µè¢«ç›´æ¥è®¿é—®çš„æƒ…å†µä¸‹è¿›è¡Œæ§åˆ¶å’Œä¿®æ”¹ã€‚ é™¤äº† java.awt åŒ…ä¸­çš„ Point å’Œ Dimension ç±»ä¹‹å¤–ï¼Œè¿˜æœ‰å…¶ä»–ä¸€äº› Java åº“ä¸­çš„ç±»è¿åäº†\u0026quot;å…¬å…±ç±»ä¸åº”è¯¥ç›´æ¥å…¬å¼€å­—æ®µ\u0026quot;çš„å»ºè®®ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ä¾‹å­ï¼š\njava.util åŒ…ä¸­çš„ Date ç±»ï¼šåœ¨æ—©æœŸç‰ˆæœ¬çš„ Java ä¸­ï¼ŒDate ç±»çš„å­—æ®µï¼ˆå¦‚å¹´ã€æœˆã€æ—¥ã€å°æ—¶ç­‰ï¼‰æ˜¯å…¬å…±çš„ï¼Œå¯ä»¥ç›´æ¥è®¿é—®å’Œä¿®æ”¹ã€‚è¿™ç§è®¾è®¡å¯¼è‡´äº† Date ç±»çš„å¯å˜æ€§å’Œçº¿ç¨‹å®‰å…¨æ€§é—®é¢˜ã€‚éšåï¼ŒJava å¼•å…¥äº†æ–°çš„æ—¥æœŸå’Œæ—¶é—´ APIï¼ˆjava.time åŒ…ï¼‰ï¼Œå…¶ä¸­å°è£…äº†æ›´å¥½çš„è®¾è®¡åŸåˆ™ï¼Œéµå¾ªäº†ä½¿ç”¨è®¿é—®å™¨æ–¹æ³•çš„å»ºè®®ã€‚ java.util åŒ…ä¸­çš„ Vector ç±»ï¼šVector ç±»æ˜¯ä¸€ä¸ªåŠ¨æ€æ•°ç»„ï¼Œå®ƒåœ¨æ—©æœŸç‰ˆæœ¬ä¸­ä½¿ç”¨äº†å…¬å…±å­—æ®µæ¥è¡¨ç¤ºå…ƒç´ æ•°é‡ï¼ˆelementCountï¼‰å’Œå®¹é‡ï¼ˆcapacityï¼‰ã€‚è¿™ç§è®¾è®¡è¿åäº†å°è£…æ€§å’Œæ§åˆ¶è®¿é—®çš„åŸåˆ™ã€‚éšç€ Java é›†åˆæ¡†æ¶çš„å‘å±•ï¼Œæ¨èä½¿ç”¨ ArrayList ç­‰æ›´ç°ä»£çš„é›†åˆç±»ï¼Œå®ƒä»¬ä½¿ç”¨ç§æœ‰å­—æ®µå¹¶æä¾›äº†ç›¸åº”çš„è®¿é—®å™¨æ–¹æ³•ã€‚ æ‰©å±• å¦‚ä½•ç¡®ä¿å­—æ®µçš„å¯è§æ€§é™å®šä¸ºåŒ…çº§ç§æœ‰ï¼Ÿ åœ¨ä¸€äº›ç‰¹å®šçš„æƒ…å†µä¸‹ï¼Œå¯¹äºåŒ…çº§ç§æœ‰æˆ–ç§æœ‰åµŒå¥—ç±»ï¼Œæœ‰æ—¶å€™éœ€è¦å…¬å¼€å­—æ®µï¼Œæ— è®ºè¿™ä¸ªç±»æ˜¯å¯å˜çš„è¿˜æ˜¯ä¸å¯å˜çš„ã€‚ä»¥ä¸‹æ˜¯è¿™ç§æƒ…å†µçš„ä¸€äº›ä¾‹å­ï¼š\nä¸å¯å˜ç±»çš„å¸¸é‡å­—æ®µï¼šå¯¹äºä¸å¯å˜ç±»ï¼ˆImmutable Classï¼‰ï¼Œå…¶ä¸­çš„å­—æ®µä¸€æ—¦è¢«åˆå§‹åŒ–å°±ä¸ä¼šå†æ”¹å˜ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†å­—æ®µå£°æ˜ä¸ºå…¬å…±ï¼ˆpublicï¼‰ä¸”ä¸å¯å˜çš„å¸¸é‡æ˜¯å¯ä»¥æ¥å—çš„ã€‚è¿™æ ·å¯ä»¥æä¾›æ–¹ä¾¿çš„è®¿é—®å’Œä½¿ç”¨æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œjava.lang åŒ…ä¸­çš„ String ç±»å°±æœ‰ä¸€ä¸ªå…¬å…±çš„å¸¸é‡å­—æ®µï¼špublic static final String EMPTY = \u0026quot;\u0026quot;;ã€‚ å…¬å…±å¸¸é‡å­—æ®µï¼šæœ‰äº›ç±»å¯èƒ½åŒ…å«ä¸€äº›å…¬å…±çš„å¸¸é‡å­—æ®µï¼Œè¿™äº›å­—æ®µåœ¨æ•´ä¸ªåŒ…æˆ–æ¨¡å—ä¸­éƒ½æ˜¯å¯è§çš„ã€‚è¿™æ ·çš„å­—æ®µé€šå¸¸æ˜¯ä¸å¯å˜çš„ï¼Œå¹¶ä¸”åœ¨è®¾è®¡ä¸­è¢«è§†ä¸ºå…¬å…±çš„ API çš„ä¸€éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œjava.awt åŒ…ä¸­çš„ Color ç±»å…·æœ‰ä¸€äº›é¢„å®šä¹‰çš„å…¬å…±å¸¸é‡å­—æ®µï¼Œå¦‚ REDã€GREENã€BLUE ç­‰ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›æƒ…å†µæ˜¯ä¾‹å¤–è€Œä¸æ˜¯å¸¸è§„è§„åˆ™ã€‚åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå°½é‡é¿å…ç›´æ¥å…¬å¼€å­—æ®µï¼Œå¹¶ä½¿ç”¨è®¿é—®å™¨æ–¹æ³•ï¼ˆgetter å’Œ setterï¼‰æ¥è®¿é—®å’Œä¿®æ”¹ç±»çš„çŠ¶æ€ã€‚è¿™æ ·å¯ä»¥æä¾›æ›´å¥½çš„å°è£…æ€§å’Œæ§åˆ¶è®¿é—®çš„èƒ½åŠ›ï¼ŒåŒæ—¶ä¿æŠ¤ç±»çš„å†…éƒ¨è¡¨ç¤ºå’Œä¸å˜æ€§ã€‚\nåœ¨ç¼–å†™å’Œè®¾è®¡ä»£ç æ—¶ï¼Œåº”è¯¥æ ¹æ®å…·ä½“æƒ…å†µæ¥åˆ¤æ–­æ˜¯å¦éœ€è¦å…¬å¼€å­—æ®µã€‚å¦‚æœç¡®å®šæœ‰å¿…è¦å…¬å¼€å­—æ®µï¼Œç¡®ä¿å­—æ®µçš„å¯è§æ€§é™å®šä¸ºåŒ…çº§ç§æœ‰ï¼ˆpackage-privateï¼‰ï¼Œä»¥é™åˆ¶å¯¹å­—æ®µçš„è®¿é—®èŒƒå›´ï¼Œå¹¶éµå¾ªæœ€å°æš´éœ²åŸåˆ™ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/06/15/minimize-the-accessibility-of-classes-and-members/","summary":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬å››ç« ã€Šç±»å’Œæ¥å£ã€‹çš„å­¦ä¹ ç¬”è®°ï¼šåœ¨å…¬å…±ç±»ä¸­ï¼Œä½¿ç”¨è®¿é—®å™¨æ–¹æ³•ï¼Œè€Œä¸æ˜¯å…¬å…±å­—æ®µã€‚\nä»‹ç» ä¸å…¶ç›´æ¥å°†ç±»çš„å†…éƒ¨å­—æ®µå…¬å¼€ä¸ºå…¬å…±å­—æ®µï¼Œæ¨èä½¿ç”¨è®¿é—®å™¨æ–¹æ³•ï¼ˆä¹Ÿç§°ä¸º getter å’Œ setterï¼‰æ¥è®¿é—®å’Œä¿®æ”¹å¯¹è±¡çš„çŠ¶æ€ã€‚è¿™æ ·å¯ä»¥ä½¿ç±»å¯¹å…¶å†…éƒ¨è¡¨ç¤ºä¿æŒæ§åˆ¶ï¼Œå¹¶ä¸ºç±»çš„å®¢æˆ·ç«¯æä¾›ä¸€ç§æŠ½è±¡ç¨‹åº¦ã€‚\né€šè¿‡ä½¿ç”¨è®¿é—®å™¨æ–¹æ³•ï¼Œæ‚¨å¯ä»¥å®ç°ä»¥ä¸‹ç›®æ ‡ï¼š\nå°è£…å†…éƒ¨è¡¨ç¤ºï¼ˆEncapsulate Internal Representationï¼‰ï¼š Getter æ–¹æ³•ï¼šGetter æ–¹æ³•ç”¨äºè·å–ç§æœ‰å­—æ®µçš„å€¼ã€‚é€šè¿‡ä½¿ç”¨ getter æ–¹æ³•ï¼Œå¯ä»¥å°†å­—æ®µçš„è®¿é—®é™åˆ¶åœ¨ç±»çš„å†…éƒ¨ï¼Œä»è€Œéšè—äº†å­—æ®µçš„å…·ä½“å®ç°ç»†èŠ‚ã€‚å®¢æˆ·ç«¯åªèƒ½é€šè¿‡è°ƒç”¨ getter æ–¹æ³•æ¥è·å–å­—æ®µçš„å€¼ï¼Œè€Œæ— æ³•ç›´æ¥è®¿é—®å­—æ®µæœ¬èº«ã€‚ Setter æ–¹æ³•ï¼šSetter æ–¹æ³•ç”¨äºè®¾ç½®ç§æœ‰å­—æ®µçš„å€¼ã€‚ä½¿ç”¨ setter æ–¹æ³•ï¼Œå¯ä»¥å¯¹å­—æ®µè¿›è¡ŒéªŒè¯ã€çº¦æŸå’Œé€»è¾‘å¤„ç†ã€‚è¿™æ ·ï¼Œç±»å¯ä»¥å¯¹å­—æ®µçš„ä¿®æ”¹è¿›è¡Œæ§åˆ¶ï¼Œå¹¶ç¡®ä¿åªæœ‰ç»è¿‡éªŒè¯çš„å€¼æ‰èƒ½è¢«è®¾ç½®ã€‚ æ§åˆ¶è®¿é—®å’Œä¿®æ”¹ï¼ˆControl Access and Modificationï¼‰ï¼š Getter æ–¹æ³•ï¼šé€šè¿‡ getter æ–¹æ³•ï¼Œå¯ä»¥å¯¹å­—æ®µçš„è®¿é—®è¿›è¡Œæ§åˆ¶ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨ getter æ–¹æ³•ä¸­æ·»åŠ æƒé™æ£€æŸ¥ï¼Œåªå…è®¸ç‰¹å®šçš„ç”¨æˆ·æˆ–è§’è‰²è·å–å­—æ®µçš„å€¼ã€‚è¿˜å¯ä»¥åœ¨ getter æ–¹æ³•ä¸­è¿›è¡Œè®¡ç®—æˆ–è½¬æ¢ï¼Œä»¥ä¾¿è¿”å›ä¸åŒäºå­—æ®µæœ¬èº«çš„å€¼ã€‚ Setter æ–¹æ³•ï¼šSetter æ–¹æ³•å…è®¸å¯¹å­—æ®µçš„ä¿®æ”¹è¿›è¡Œæ§åˆ¶ã€‚åœ¨ setter æ–¹æ³•ä¸­ï¼Œå¯ä»¥è¿›è¡Œè¾“å…¥éªŒè¯ã€èŒƒå›´æ£€æŸ¥å’Œå…¶ä»–é€»è¾‘å¤„ç†ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿åªæœ‰ç¬¦åˆè§„å®šçš„å€¼æ‰èƒ½è¢«è®¾ç½®åˆ°å­—æ®µä¸­ï¼Œä»è€Œä¿æŒç±»çš„çŠ¶æ€çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚ ä¿ƒè¿›æ¼”åŒ–å’Œå…¼å®¹æ€§ï¼šå¦‚æœä½¿ç”¨å…¬å…±å­—æ®µï¼Œå¹¶ä¸”ä»¥åéœ€è¦æ›´æ”¹è¡¨ç¤ºæ–¹å¼æˆ–æ·»åŠ é™„åŠ é€»è¾‘ï¼Œåˆ™å¾ˆéš¾ä¿æŒå‘åå…¼å®¹æ€§ã€‚ç„¶è€Œï¼Œé€šè¿‡ä½¿ç”¨è®¿é—®å™¨æ–¹æ³•ï¼Œå¯ä»¥ä¿®æ”¹å†…éƒ¨è¡¨ç¤ºæˆ–æ·»åŠ æ–°è¡Œä¸ºï¼Œè€Œä¸ä¼šå½±å“ç±»çš„å®¢æˆ·ç«¯ã€‚ åä¾‹ Java åº“ä¸­çš„å‡ ä¸ªç±»è¿åäº†å…¬å…±ç±»ä¸åº”è¯¥ç›´æ¥å…¬å¼€å­—æ®µçš„å»ºè®®ã€‚çªå‡ºçš„ä¾‹å­åŒ…æ‹¬ java.awt åŒ…ä¸­çš„ Point å’Œ Dimensionã€‚\nåœ¨ Java çš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œä¸€äº›ç±»è®¾è®¡å¹¶æ²¡æœ‰éµå¾ªç°ä»£çš„é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™å’Œæœ€ä½³å®è·µã€‚è¿™äº›ç±»ä¸­çš„å­—æ®µè¢«ç›´æ¥å£°æ˜ä¸ºå…¬å…±ï¼ˆpublicï¼‰ï¼Œè€Œæ²¡æœ‰æä¾›ç›¸åº”çš„è®¿é—®å™¨æ–¹æ³•ã€‚\nä¾‹å¦‚ï¼Œjava.awt åŒ…ä¸­çš„ Point ç±»å’Œ Dimension ç±»æä¾›äº†å…¬å…±çš„ xã€y å’Œ widthã€height å­—æ®µæ¥è¡¨ç¤ºç‚¹çš„åæ ‡å’ŒçŸ©å½¢çš„å®½åº¦å’Œé«˜åº¦ã€‚è¿™æ„å‘³ç€å®¢æˆ·ç«¯ä»£ç å¯ä»¥ç›´æ¥è®¿é—®å’Œä¿®æ”¹è¿™äº›å­—æ®µï¼Œç»•è¿‡äº†å°è£…å’Œæ§åˆ¶çš„æœºåˆ¶ã€‚\nè¿™ç§è®¾è®¡æ–¹å¼å­˜åœ¨ä¸€äº›é—®é¢˜ï¼š\nç¼ºä¹å°è£…ï¼šç›´æ¥å…¬å¼€å­—æ®µç ´åäº†å°è£…çš„åŸåˆ™ï¼Œä½¿å¾—ç±»çš„å†…éƒ¨è¡¨ç¤ºæš´éœ²ç»™å¤–éƒ¨ï¼Œå¯¼è‡´äº†ä¸å¯é¢„æµ‹çš„è¡Œä¸ºå’Œæ½œåœ¨çš„é”™è¯¯ã€‚ é™åˆ¶æ‰©å±•æ€§ï¼šå¦‚æœéœ€è¦åœ¨è¿™äº›ç±»ä¸­æ·»åŠ éªŒè¯é€»è¾‘ã€è®¡ç®—å±æ€§æˆ–å®ç°å…¶ä»–è¡Œä¸ºï¼Œä¼šé¢ä¸´å›°éš¾ï¼Œå› ä¸ºä¸èƒ½åœ¨å­—æ®µè¢«ç›´æ¥è®¿é—®çš„æƒ…å†µä¸‹è¿›è¡Œæ§åˆ¶å’Œä¿®æ”¹ã€‚ é™¤äº† java.awt åŒ…ä¸­çš„ Point å’Œ Dimension ç±»ä¹‹å¤–ï¼Œè¿˜æœ‰å…¶ä»–ä¸€äº› Java åº“ä¸­çš„ç±»è¿åäº†\u0026quot;å…¬å…±ç±»ä¸åº”è¯¥ç›´æ¥å…¬å¼€å­—æ®µ\u0026quot;çš„å»ºè®®ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ä¾‹å­ï¼š\njava.util åŒ…ä¸­çš„ Date ç±»ï¼šåœ¨æ—©æœŸç‰ˆæœ¬çš„ Java ä¸­ï¼ŒDate ç±»çš„å­—æ®µï¼ˆå¦‚å¹´ã€æœˆã€æ—¥ã€å°æ—¶ç­‰ï¼‰æ˜¯å…¬å…±çš„ï¼Œå¯ä»¥ç›´æ¥è®¿é—®å’Œä¿®æ”¹ã€‚è¿™ç§è®¾è®¡å¯¼è‡´äº† Date ç±»çš„å¯å˜æ€§å’Œçº¿ç¨‹å®‰å…¨æ€§é—®é¢˜ã€‚éšåï¼ŒJava å¼•å…¥äº†æ–°çš„æ—¥æœŸå’Œæ—¶é—´ APIï¼ˆjava.time åŒ…ï¼‰ï¼Œå…¶ä¸­å°è£…äº†æ›´å¥½çš„è®¾è®¡åŸåˆ™ï¼Œéµå¾ªäº†ä½¿ç”¨è®¿é—®å™¨æ–¹æ³•çš„å»ºè®®ã€‚ java.util åŒ…ä¸­çš„ Vector ç±»ï¼šVector ç±»æ˜¯ä¸€ä¸ªåŠ¨æ€æ•°ç»„ï¼Œå®ƒåœ¨æ—©æœŸç‰ˆæœ¬ä¸­ä½¿ç”¨äº†å…¬å…±å­—æ®µæ¥è¡¨ç¤ºå…ƒç´ æ•°é‡ï¼ˆelementCountï¼‰å’Œå®¹é‡ï¼ˆcapacityï¼‰ã€‚è¿™ç§è®¾è®¡è¿åäº†å°è£…æ€§å’Œæ§åˆ¶è®¿é—®çš„åŸåˆ™ã€‚éšç€ Java é›†åˆæ¡†æ¶çš„å‘å±•ï¼Œæ¨èä½¿ç”¨ ArrayList ç­‰æ›´ç°ä»£çš„é›†åˆç±»ï¼Œå®ƒä»¬ä½¿ç”¨ç§æœ‰å­—æ®µå¹¶æä¾›äº†ç›¸åº”çš„è®¿é—®å™¨æ–¹æ³•ã€‚ æ‰©å±• å¦‚ä½•ç¡®ä¿å­—æ®µçš„å¯è§æ€§é™å®šä¸ºåŒ…çº§ç§æœ‰ï¼Ÿ åœ¨ä¸€äº›ç‰¹å®šçš„æƒ…å†µä¸‹ï¼Œå¯¹äºåŒ…çº§ç§æœ‰æˆ–ç§æœ‰åµŒå¥—ç±»ï¼Œæœ‰æ—¶å€™éœ€è¦å…¬å¼€å­—æ®µï¼Œæ— è®ºè¿™ä¸ªç±»æ˜¯å¯å˜çš„è¿˜æ˜¯ä¸å¯å˜çš„ã€‚ä»¥ä¸‹æ˜¯è¿™ç§æƒ…å†µçš„ä¸€äº›ä¾‹å­ï¼š","title":"ã€ŠEffective Java 3ã€‹ç¬”è®°16ï¼šåœ¨å…¬å…±ç±»ä¸­ï¼Œä½¿ç”¨è®¿é—®å™¨æ–¹æ³•ï¼Œè€Œä¸æ˜¯å…¬å…±å­—æ®µ"},{"content":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-06-05 åˆ° 2023-06-11 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¯»ä¹¦ã€å¥èº«ã€æŠ•èµ„ã€å¸®æœ‹å‹ã€é™ªå®¶äººã€‚\nä»¥åå‘¨æŠ¥çš„ä¸»é¢˜ï¼Œä¼šåŒ…æ‹¬è¿™å‡ ä¸ªéƒ¨åˆ†ï¼šè¯»ä¹¦ã€å¥èº«ã€æŠ•èµ„ã€å¸®æœ‹å‹ã€é™ªå®¶äººï¼Œå†åŠ ä¸Šå·¥ä½œå’Œæœ¬å‘¨åˆ†äº«ä¸¤å—å†…å®¹ã€‚\nè¯»ä¹¦ æœ¬å‘¨é˜…è¯»ç»Ÿè®¡ï¼Œæ€»è®¡é˜…è¯» 31 åˆ†é’Ÿï¼š\næœ¬å‘¨é˜…è¯»æ‘˜æŠ„ï¼š\näººæ˜¯å‘¨å›´ 6 ä¸ªäººçš„å¹³å‡å€¼ï¼Œå¦‚æœä½ èº«è¾¹æ²¡æœ‰ç‰¹åˆ«å‡ºè‰²çš„å¹´è½»äººä¸ä½ ä¸ºä¼ï¼Œä½ å°±æ‰¾å…ˆè´¤ä»¬çš„ä¹¦ç±ï¼Œä»–ä»¬æŠŠä¸€ç”Ÿçš„æ‰€æœ‰æ€è€ƒã€æ™ºæ…§ã€ç»å†å’Œæƒ…æ„Ÿï¼Œéƒ½å€¾æ³¨åœ¨é‚£äº›ä¹¦é‡Œå¤´äº†ã€‚ å¦‚æœæœ‰ä¸€å¤©è·Ÿä½ å…±é¸£çš„ï¼Œå…¨éƒ½æ˜¯å¤å¾€ä»Šæ¥ã€å¤ä»Šä¸­å¤–é‚£äº›æœ€æ™ºæ…§ã€æœ€æ·±åˆ»ã€æœ€æ•é”ã€æœ€ä¸°å¯Œã€æœ€åšå­¦çš„å¤§è„‘ï¼Œä½ å¤§æ¦‚ç‡ä¸ä¼šå¤ªå·®ï¼Œä½ çš„ç²¾ç¥ä¸–ç•Œä¹Ÿå¤§æ¦‚ç‡ä¼šéå¸¸ä¸°å¯Œã€‚ â€œwe are all in the gutter ï¼Œbut some of us are looking at starsã€‚â€ è¿™å¥è¯æ¥è‡ªä¸€ä¸ªçˆ±å°”å…°çš„è¯—äººï¼Œå«åšå¥¥æ–¯å¡Â·ç‹å°”å¾·ï¼šâ€œæˆ‘ä»¬éƒ½èº«å¤„åœ¨é˜´æ²Ÿé‡Œï¼Œä½†æ€»æœ‰äººä»°æœ›æ˜Ÿç©ºã€‚â€ â€œ Three passions, simple but overwhelmingly strong, have governed my life: the longing for love, the search for knowledge, and unbearable pity for the suffering of mankind. â€ è¿™æ˜¯æ¥è‡ªäºç½—ç´ çš„ä¸€ä¸ªæ¼”è®²ï¼Œå«åšã€Šæˆ‘ä¸ºä»€ä¹ˆè€Œæ´»ç€ã€‹ï¼Œæ„æ€æ˜¯ï¼šå¯¹çŸ¥è¯†çš„æ¸´æœ›ï¼Œå¯¹çˆ±æƒ…çš„è¿½æ±‚ï¼Œå¯¹äººç±»è‹¦éš¾éš¾ä»¥éåˆ¶çš„åŒæƒ…å¿ƒï¼Œè¿™ä¸‰ç§ç®€å•è€Œå¼ºçƒˆçš„æ¿€æƒ…ï¼Œè‹¦è‹¦æ”¯é…æˆ‘çš„ä¸€ç”Ÿ å¥èº« æˆ‘è·‘è¿‡äº†ä¸€äº›åœ°æ–¹ï¼Œå¸Œæœ›éšç€æ—¶é—´æ¨ç§»ï¼Œåœ°å›¾ç‚¹äº®çš„åœ°æ–¹è¶Šæ¥è¶Šå¤šã€‚2 å¹´é‡Œæˆ‘è·‘è¿‡ 2 ä¸ªçœä»½ 2 ä¸ªåŸå¸‚ã€‚æ›´å¤šè·‘æ­¥æ•°æ®åœ¨æˆ‘çš„ è·‘æ­¥ ä¸»é¡µã€‚\nè¿™å‘¨å› ä¸ºçˆ¶äº²ä½é™¢éœ€è¦ç…§é¡¾ä»–ï¼Œæ‰€ä»¥è·‘æ­¥æš‚åœã€‚\nç†è´¢ è¿™å‘¨æ€»è®¡æ”¯å‡º 5006 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š\n6 æœˆ 11 æ—¥ï¼š4057 å…ƒï¼Œçˆ¶äº²å‡ºé™¢æ”¯ä»˜ 3475 å…ƒ\n6 æœˆ 10 æ—¥ï¼š108 å…ƒ\n6 æœˆ 9 æ—¥ï¼š86 å…ƒ\n6 æœˆ 8 æ—¥ï¼š367 å…ƒ\n6 æœˆ 7 æ—¥ï¼š179 å…ƒ\n6 æœˆ 6 æ—¥ï¼š117 å…ƒ\n6 æœˆ 5 æ—¥ï¼š92 å…ƒ\né™ªå®¶äºº æœ¬å‘¨çš„å·¥ä½œå’Œç”Ÿæ´»éƒ½å› ä¸ºè€çˆ¸ä½é™¢è€Œæ‰“ä¹±äº†åŸæ¥çš„èŠ‚å¥ã€‚èµ·å› æ˜¯è€çˆ¸å› ä¸ºç—›é£å…³èŠ‚ç–¼ç—›è€Œæœç”¨äº†åŒæ°¯èŠ¬é…¸é’ ç¼“é‡Šç‰‡å¯¼è‡´èƒƒæºƒç–¡å’Œå‡ºè¡€ï¼Œå¦å¤–æœ€è¿‘ä¸¤ä¸ªæœˆå¤§ä¾¿å‘ˆé»‘è‰²ã€è¡€æ¶²æµå¤±è¿‡å¤šï¼Œå¯¼è‡´ä¸¥é‡è´«è¡€ã€‚å‘¨å…­å…ˆæ˜¯å»æ­¦æ±‰ä¸­å¿ƒåŒ»é™¢åšèƒƒé•œæ£€æŸ¥ï¼ŒåŒ»ç”Ÿçœ‹åˆ°è€çˆ¸çš„è„¸è‰²è‹ç™½ï¼Œå»ºè®®åšä¸ªè¡€æ¶²æ£€æµ‹ã€‚æ£€æŸ¥ç»“æœå‡ºæ¥ä¹‹åï¼Œå¿ƒæœ‰ä½™æ‚¸ï¼Œå¦‚æœå†æ™šç‚¹å¸¦è€çˆ¸æ¥åŒ»é™¢åšæ£€æŸ¥ï¼Œä¸çŸ¥é“è€çˆ¸ä¼šå› è´«è¡€è€Œå‡ºç°æ€æ ·çš„äº‹æƒ…ã€‚æ ¹æ®æ£€æŸ¥ç»“æœï¼ŒåŒ»ç”Ÿå»ºè®®ç«‹å³ä½é™¢ã€‚åœ¨ç»è¿‡è€ƒè™‘ä¹‹åï¼Œå†³å®šå›é˜³é€»ä½é™¢ã€‚ä½é™¢æœŸé—´ï¼Œéœ€è¦äº²å±é™ªæŠ¤ï¼Œäºæ˜¯å‘¨ä¸€åˆ°å‘¨ä¸‰è¯·äº†ä¸‰å¤©å‡ï¼Œå‘¨å››å’Œå‘¨äº”æ¢è€å©†è¿‡æ¥ç…§é¡¾ã€‚\nä½é™¢æœŸé—´ï¼Œè€çˆ¸å¿ƒé‡Œçƒ¦ï¼Œå› ä¸ºç—›é£å‘ä½œï¼Œè…¿è„šèµ°è·¯æ²¡åŠ›æ°”ï¼Œå¤§å°ä¾¿ä¸æ–¹ä¾¿ã€‚ä½œä¸ºå„¿å­çš„æˆ‘ä¹Ÿåœ¨åæ€ï¼Œè€çˆ¸æˆè¿™æ ·ï¼Œéƒ½æ€ªæˆ‘å¹³æ—¶æ²¡æœ‰å…³å¿ƒä»–çš„å¥åº·å’Œç”Ÿæ´»ã€‚è€çˆ¸ä»Šå¤©è®©æˆ‘åƒçš„è‹¦éƒ½æ˜¯å› ä¸ºè¿‡å»åœ¨è€çˆ¸èº«ä¸Šçš„ä»˜å‡ºä¸å¤Ÿã€‚\nå·¥ä½œ æœ€è¿‘åœ¨å­¦ä¹ çš„å†…å®¹æ¸…å•ï¼š\nEffective Javaï¼ˆç¬¬ 3 ç‰ˆï¼‰ Java Design Patterns (ä¸­æ–‡) Real Python æœ¬å‘¨å®Œæˆä¸‰ç¯‡åšå®¢ï¼š\nJava è®¾è®¡æ¨¡å¼ï¼šAdapter Python å­¦ä¹  2ï¼šæ•°æ®ç±»å‹ Python å­¦ä¹  3ï¼šè¿ç®—ç¬¦å’Œè¡¨è¾¾å¼ æœ¬å‘¨åˆ†äº« å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€ChenSoul Shareã€Telegram é¢‘é“æˆ–è€…æˆ‘çš„ Memos ä¸­ã€‚æˆ‘å†™äº†ä¸€ä¸ª Python è„šæœ¬ä» Memos è¯»å–æœ€è¿‘ä¸€å‘¨å¸¦æœ‰ #memos æ ‡ç­¾çš„è®°å½•ï¼Œåˆ†äº«åˆ°è¿™é‡Œã€‚\nğŸ“Œ2023-06-10 å¦‚ä½•ç”¨ ChatGPT åŠ©åŠ›å¼€å‘: å·²ç»æœ‰ 15 ä¸‡äººçœ‹è¿‡çš„ç»éªŒåˆ†äº«#memos http://luolei.org/chatgpt-in-development/\nğŸ“Œ2023-06-09 Rust è¯­è¨€å®æˆ˜ï¼Œè§†é¢‘å’Œæ•™ç¨‹ https://www.youtube.com/watch?v=BpPEoZW5IiY https://zh.practice.rs/why-exercise.html #memos #rust\nğŸ“Œ2023-06-09 åŸºäº Spring Cloud ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å®ç°åˆ†å¸ƒå¼ WebSocket. / åŸºäº RabbitMQ å¹¿æ’­å®ç°åˆ†å¸ƒå¼ WebSocket. https://lawrenceli.me/blog/websocket-cluster #memos #java #skill\nğŸ“Œ2023-06-09 REST å’Œ gRPC æ˜¯ API çš„ä¸¤ç§æœ€æµè¡Œçš„å®ç°æ–¹æ³•ï¼Œæœ¬æ–‡è¯¦ç»†æ¯”è¾ƒå®ƒä»¬çš„å·®å¼‚ã€‚ https://kreya.app/blog/rest-vs-grpc/ #memos\nğŸ“Œ2023-06-08 ç—›è‹¦æ˜¯å¯¹çš„ï¼Œç„¦è™‘ä¹Ÿæ˜¯å¯¹çš„ï¼Œç—›è‹¦çš„æœ¬è´¨æ¥æºäºä½ å¯¹ç°çŠ¶çš„ä¸æ»¡ï¼Œç„¶åç„¦è™‘çš„æœ¬è´¨æ¥æºäºä½ æˆé•¿é€Ÿåº¦å¤ªæ…¢ã€‚#memos\nä»¥ä¸Šã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/06/14/weekly_review_23/","summary":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-06-05 åˆ° 2023-06-11 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¯»ä¹¦ã€å¥èº«ã€æŠ•èµ„ã€å¸®æœ‹å‹ã€é™ªå®¶äººã€‚\nä»¥åå‘¨æŠ¥çš„ä¸»é¢˜ï¼Œä¼šåŒ…æ‹¬è¿™å‡ ä¸ªéƒ¨åˆ†ï¼šè¯»ä¹¦ã€å¥èº«ã€æŠ•èµ„ã€å¸®æœ‹å‹ã€é™ªå®¶äººï¼Œå†åŠ ä¸Šå·¥ä½œå’Œæœ¬å‘¨åˆ†äº«ä¸¤å—å†…å®¹ã€‚\nè¯»ä¹¦ æœ¬å‘¨é˜…è¯»ç»Ÿè®¡ï¼Œæ€»è®¡é˜…è¯» 31 åˆ†é’Ÿï¼š\næœ¬å‘¨é˜…è¯»æ‘˜æŠ„ï¼š\näººæ˜¯å‘¨å›´ 6 ä¸ªäººçš„å¹³å‡å€¼ï¼Œå¦‚æœä½ èº«è¾¹æ²¡æœ‰ç‰¹åˆ«å‡ºè‰²çš„å¹´è½»äººä¸ä½ ä¸ºä¼ï¼Œä½ å°±æ‰¾å…ˆè´¤ä»¬çš„ä¹¦ç±ï¼Œä»–ä»¬æŠŠä¸€ç”Ÿçš„æ‰€æœ‰æ€è€ƒã€æ™ºæ…§ã€ç»å†å’Œæƒ…æ„Ÿï¼Œéƒ½å€¾æ³¨åœ¨é‚£äº›ä¹¦é‡Œå¤´äº†ã€‚ å¦‚æœæœ‰ä¸€å¤©è·Ÿä½ å…±é¸£çš„ï¼Œå…¨éƒ½æ˜¯å¤å¾€ä»Šæ¥ã€å¤ä»Šä¸­å¤–é‚£äº›æœ€æ™ºæ…§ã€æœ€æ·±åˆ»ã€æœ€æ•é”ã€æœ€ä¸°å¯Œã€æœ€åšå­¦çš„å¤§è„‘ï¼Œä½ å¤§æ¦‚ç‡ä¸ä¼šå¤ªå·®ï¼Œä½ çš„ç²¾ç¥ä¸–ç•Œä¹Ÿå¤§æ¦‚ç‡ä¼šéå¸¸ä¸°å¯Œã€‚ â€œwe are all in the gutter ï¼Œbut some of us are looking at starsã€‚â€ è¿™å¥è¯æ¥è‡ªä¸€ä¸ªçˆ±å°”å…°çš„è¯—äººï¼Œå«åšå¥¥æ–¯å¡Â·ç‹å°”å¾·ï¼šâ€œæˆ‘ä»¬éƒ½èº«å¤„åœ¨é˜´æ²Ÿé‡Œï¼Œä½†æ€»æœ‰äººä»°æœ›æ˜Ÿç©ºã€‚â€ â€œ Three passions, simple but overwhelmingly strong, have governed my life: the longing for love, the search for knowledge, and unbearable pity for the suffering of mankind. â€ è¿™æ˜¯æ¥è‡ªäºç½—ç´ çš„ä¸€ä¸ªæ¼”è®²ï¼Œå«åšã€Šæˆ‘ä¸ºä»€ä¹ˆè€Œæ´»ç€ã€‹ï¼Œæ„æ€æ˜¯ï¼šå¯¹çŸ¥è¯†çš„æ¸´æœ›ï¼Œå¯¹çˆ±æƒ…çš„è¿½æ±‚ï¼Œå¯¹äººç±»è‹¦éš¾éš¾ä»¥éåˆ¶çš„åŒæƒ…å¿ƒï¼Œè¿™ä¸‰ç§ç®€å•è€Œå¼ºçƒˆçš„æ¿€æƒ…ï¼Œè‹¦è‹¦æ”¯é…æˆ‘çš„ä¸€ç”Ÿ å¥èº« æˆ‘è·‘è¿‡äº†ä¸€äº›åœ°æ–¹ï¼Œå¸Œæœ›éšç€æ—¶é—´æ¨ç§»ï¼Œåœ°å›¾ç‚¹äº®çš„åœ°æ–¹è¶Šæ¥è¶Šå¤šã€‚2 å¹´é‡Œæˆ‘è·‘è¿‡ 2 ä¸ªçœä»½ 2 ä¸ªåŸå¸‚ã€‚æ›´å¤šè·‘æ­¥æ•°æ®åœ¨æˆ‘çš„ è·‘æ­¥ ä¸»é¡µã€‚\nè¿™å‘¨å› ä¸ºçˆ¶äº²ä½é™¢éœ€è¦ç…§é¡¾ä»–ï¼Œæ‰€ä»¥è·‘æ­¥æš‚åœã€‚\nç†è´¢ è¿™å‘¨æ€»è®¡æ”¯å‡º 5006 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š\n6 æœˆ 11 æ—¥ï¼š4057 å…ƒï¼Œçˆ¶äº²å‡ºé™¢æ”¯ä»˜ 3475 å…ƒ\n6 æœˆ 10 æ—¥ï¼š108 å…ƒ\n6 æœˆ 9 æ—¥ï¼š86 å…ƒ\n6 æœˆ 8 æ—¥ï¼š367 å…ƒ\n6 æœˆ 7 æ—¥ï¼š179 å…ƒ","title":"å‘¨æŠ¥-23ï½œè¯»ä¹¦ã€å¥èº«ã€å®šæŠ•ã€å¸®æœ‹å‹ã€é™ªå®¶äºº"},{"content":"åœ¨ Python ä¸­ï¼Œæµç¨‹æ§åˆ¶è¯­å¥åŒ…æ‹¬æ¡ä»¶è¯­å¥ï¼ˆif-elif-elseï¼‰ã€å¾ªç¯è¯­å¥ï¼ˆfor å’Œ whileï¼‰ã€è·³è½¬è¯­å¥ï¼ˆbreakã€continue å’Œ returnï¼‰å’Œå¼‚å¸¸å¤„ç†è¯­å¥ã€‚\næ¡ä»¶è¯­å¥ æ¡ä»¶è¯­å¥ç”¨äºåœ¨ä¸åŒçš„æ¡ä»¶ä¸‹æ‰§è¡Œä¸åŒçš„ä»£ç å—ã€‚Python ä¸­çš„æ¡ä»¶è¯­å¥æ˜¯ if-elif-else ç»“æ„ã€‚\n# æ¡ä»¶è¯­å¥ç¤ºä¾‹ x = 10 if x \u0026lt; 0: print(\u0026#34;x is negative\u0026#34;) elif x == 0: print(\u0026#34;x is zero\u0026#34;) else: print(\u0026#34;x is positive\u0026#34;) å¾ªç¯è¯­å¥ å¾ªç¯è¯­å¥ç”¨äºé‡å¤æ‰§è¡Œä¸€æ®µä»£ç ï¼Œç›´åˆ°æ»¡è¶³æŸä¸ªæ¡ä»¶æˆ–è¾¾åˆ°æŸä¸ªæ¡ä»¶æ¬¡æ•°ä¸ºæ­¢ã€‚Python ä¸­çš„å¾ªç¯è¯­å¥åŒ…æ‹¬ for å’Œ while ä¸¤ç§ç»“æ„ã€‚\n# for å¾ªç¯ç¤ºä¾‹ my_list = [1, 2, 3, 4, 5] for item in my_list: print(item) # while å¾ªç¯ç¤ºä¾‹ x = 10 while x \u0026gt; 0: print(x) x -= 1 éå†é›†åˆæ—¶ä¿®æ”¹é›†åˆçš„å†…å®¹ï¼Œä¼šå¾ˆå®¹æ˜“ç”Ÿæˆé”™è¯¯çš„ç»“æœã€‚å› æ­¤ä¸èƒ½ç›´æ¥è¿›è¡Œå¾ªç¯ï¼Œè€Œæ˜¯åº”éå†è¯¥é›†åˆçš„å‰¯æœ¬æˆ–åˆ›å»ºæ–°çš„é›†åˆï¼š\n# Create a sample collection users = {\u0026#39;Hans\u0026#39;: \u0026#39;active\u0026#39;, \u0026#39;Ã‰lÃ©onore\u0026#39;: \u0026#39;inactive\u0026#39;, \u0026#39;æ™¯å¤ªéƒ\u0026#39;: \u0026#39;active\u0026#39;} # Strategy: Iterate over a copy for user, status in users.copy().items(): if status == \u0026#39;inactive\u0026#39;: del users[user] # Strategy: Create a new collection active_users = {} for user, status in users.items(): if status == \u0026#39;active\u0026#39;: active_users[user] = status è·³è½¬è¯­å¥ è·³è½¬è¯­å¥ç”¨äºåœ¨å¾ªç¯æˆ–å‡½æ•°ä¸­è·³è¿‡ä¸€äº›ä»£ç æˆ–ç»ˆæ­¢å¾ªç¯ã€‚Python ä¸­çš„è·³è½¬è¯­å¥åŒ…æ‹¬ breakã€continue å’Œ returnã€‚\n# break ç¤ºä¾‹ my_list = [1, 2, 3, 4, 5] for item in my_list: if item == 3: break print(item) # continue ç¤ºä¾‹ my_list = [1, 2, 3, 4, 5] for item in my_list: if item == 3: continue print(item) # return ç¤ºä¾‹ def my_function(x): if x \u0026lt; 0: return None return x * 2 åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ break å…³é”®å­—æ¥ç»ˆæ­¢ä¸€ä¸ª for å¾ªç¯ï¼Œä½¿ç”¨ continue å…³é”®å­—æ¥è·³è¿‡ä¸€ä¸ªå¾ªç¯è¿­ä»£ï¼Œä½¿ç”¨ return å…³é”®å­—æ¥ä»å‡½æ•°ä¸­è¿”å›ä¸€ä¸ªå€¼ã€‚\npass è¯­å¥ pass è¯­å¥ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚è¯­æ³•ä¸Šéœ€è¦ä¸€ä¸ªè¯­å¥ï¼Œä½†ç¨‹åºä¸å®é™…æ‰§è¡Œä»»ä½•åŠ¨ä½œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¯¥è¯­å¥ã€‚ä¾‹å¦‚ï¼š\n# pass è¯­å¥ while True: pass # Busy-wait for keyboard interrupt (Ctrl+C) def function(): # to be implemented pass class MyEmptyClass: pass match è¯­å¥ match è¯­å¥æ¥å—ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå¹¶å°†å…¶å€¼ä¸ä¸€ä¸ªæˆ–å¤šä¸ª case å—ä¸­ç»™å®šçš„æ¨¡å¼è¿›è¡Œæ¯”è¾ƒã€‚è¿™åœ¨è¡¨é¢ä¸Šç±»ä¼¼äº Cã€Java æˆ– JavaScriptï¼ˆä»¥åŠè®¸å¤šå…¶ä»–è¯­è¨€ï¼‰ä¸­çš„ switch è¯­å¥ï¼Œä½†å®ƒæ›´ç±»ä¼¼äº Rust æˆ– Haskell ç­‰è¯­è¨€ä¸­çš„æ¨¡å¼åŒ¹é…ã€‚åªæœ‰ç¬¬ä¸€ä¸ªåŒ¹é…çš„æ¨¡å¼ä¼šè¢«æ‰§è¡Œï¼Œå¹¶ä¸”å®ƒè¿˜å¯ä»¥ä»å€¼ä¸­æå–ç»„ä»¶ï¼ˆåºåˆ—å…ƒç´ æˆ–å¯¹è±¡å±æ€§ï¼‰åˆ°å˜é‡ä¸­ã€‚\næœ€ç®€å•çš„å½¢å¼æ˜¯å°†ä¸€ä¸ªç›®æ ‡å€¼ä¸ä¸€ä¸ªæˆ–å¤šä¸ªå­—é¢å€¼è¿›è¡Œæ¯”è¾ƒï¼š\ndef http_error(status): match status: case 400: return \u0026#34;Bad request\u0026#34; case 404: return \u0026#34;Not found\u0026#34; case 418: return \u0026#34;I\u0026#39;m a teapot\u0026#34; case _: return \u0026#34;Something\u0026#39;s wrong with the internet\u0026#34; æ³¨æ„æœ€åä¸€ä¸ªä»£ç å—ï¼šâ€œå˜é‡åâ€ _ è¢«ä½œä¸º é€šé…ç¬¦ å¹¶å¿…å®šä¼šåŒ¹é…æˆåŠŸã€‚ å¦‚æœæ²¡æœ‰ case è¯­å¥åŒ¹é…æˆåŠŸï¼Œåˆ™ä¸ä¼šæ‰§è¡Œä»»ä½•åˆ†æ”¯ã€‚\nä½¿ç”¨ | ï¼ˆâ€œ or â€ï¼‰åœ¨ä¸€ä¸ªæ¨¡å¼ä¸­å¯ä»¥ç»„åˆå¤šä¸ªå­—é¢å€¼ï¼š\ncase 401 | 403 | 404: return \u0026#34;Not allowed\u0026#34; æ¨¡å¼çš„å½¢å¼ç±»ä¼¼è§£åŒ…èµ‹å€¼ï¼Œå¹¶å¯è¢«ç”¨äºç»‘å®šå˜é‡ï¼š\n# point is an (x, y) tuple match point: case (0, 0): print(\u0026#34;Origin\u0026#34;) case (0, y): print(f\u0026#34;Y={y}\u0026#34;) case (x, 0): print(f\u0026#34;X={x}\u0026#34;) case (x, y): print(f\u0026#34;X={x}, Y={y}\u0026#34;) case _: raise ValueError(\u0026#34;Not a point\u0026#34;) è¯·ä»”ç»†ç ”ç©¶æ­¤ä»£ç ï¼ ç¬¬ä¸€ä¸ªæ¨¡å¼æœ‰ä¸¤ä¸ªå­—é¢å€¼ï¼Œå¯ä»¥çœ‹ä½œæ˜¯ä¸Šé¢æ‰€ç¤ºå­—é¢å€¼æ¨¡å¼çš„æ‰©å±•ã€‚ä½†æ¥ä¸‹æ¥çš„ä¸¤ä¸ªæ¨¡å¼ç»“åˆäº†ä¸€ä¸ªå­—é¢å€¼å’Œä¸€ä¸ªå˜é‡ï¼Œè€Œå˜é‡ ç»‘å®š äº†ä¸€ä¸ªæ¥è‡ªç›®æ ‡çš„å€¼ï¼ˆpointï¼‰ã€‚ç¬¬å››ä¸ªæ¨¡å¼æ•è·äº†ä¸¤ä¸ªå€¼ï¼Œè¿™ä½¿å¾—å®ƒåœ¨æ¦‚å¿µä¸Šç±»ä¼¼äºè§£åŒ…èµ‹å€¼ (x, y) = pointã€‚\nå¦‚æœä½¿ç”¨ç±»å®ç°æ•°æ®ç»“æ„ï¼Œå¯åœ¨ç±»åååŠ ä¸€ä¸ªç±»ä¼¼äºæ„é€ å™¨çš„å‚æ•°åˆ—è¡¨ï¼Œè¿™æ ·åšå¯ä»¥æŠŠå±æ€§æ”¾åˆ°å˜é‡é‡Œï¼š\nclass Point: x: int y: int def where_is(point): match point: case Point(x=0, y=0): print(\u0026#34;Origin\u0026#34;) case Point(x=0, y=y): print(f\u0026#34;Y={y}\u0026#34;) case Point(x=x, y=0): print(f\u0026#34;X={x}\u0026#34;) case Point(): print(\u0026#34;Somewhere else\u0026#34;) case _: print(\u0026#34;Not a point\u0026#34;) å¯åœ¨ dataclass ç­‰æ”¯æŒå±æ€§æ’åºçš„å†…ç½®ç±»ä¸­ä½¿ç”¨ä½ç½®å‚æ•°ã€‚è¿˜å¯åœ¨ç±»ä¸­è®¾ç½® __match_args__ ç‰¹æ®Šå±æ€§ä¸ºæ¨¡å¼çš„å±æ€§å®šä¹‰æŒ‡å®šä½ç½®ã€‚å¦‚æœå®ƒè¢«è®¾ä¸º (\u0026ldquo;x\u0026rdquo;, \u0026ldquo;y\u0026rdquo;)ï¼Œåˆ™ä»¥ä¸‹æ¨¡å¼å‡ä¸ºç­‰ä»·çš„ï¼Œå¹¶ä¸”éƒ½æŠŠ y å±æ€§ç»‘å®šåˆ° var å˜é‡ï¼š\nPoint(1, var) Point(1, y=var) Point(x=1, y=var) Point(y=var, x=1) è¯»å–æ¨¡å¼çš„æ¨èæ–¹å¼æ˜¯å°†å®ƒä»¬çœ‹åšæ˜¯ä½ ä¼šåœ¨èµ‹å€¼æ“ä½œå·¦ä¾§æ”¾ç½®çš„å†…å®¹çš„æ‰©å±•å½¢å¼ï¼Œä»¥ä¾¿ç†è§£å„ä¸ªå˜é‡å°†ä¼šè¢«è®¾ç½®çš„å€¼ã€‚ åªæœ‰å•ç‹¬çš„åç§°ï¼ˆä¾‹å¦‚ä¸Šé¢çš„ varï¼‰ä¼šè¢« match è¯­å¥æ‰€èµ‹å€¼ã€‚ å¸¦ç‚¹å·çš„åç§° (ä¾‹å¦‚ foo.bar)ã€å±æ€§åç§°ï¼ˆä¾‹å¦‚ä¸Šé¢çš„ x= å’Œ y=ï¼‰æˆ–ç±»åç§°ï¼ˆé€šè¿‡å…¶åçš„ \u0026ldquo;(\u0026hellip;)\u0026rdquo; æ¥è¯†åˆ«ï¼Œä¾‹å¦‚ä¸Šé¢çš„ Pointï¼‰éƒ½ç»ä¸ä¼šè¢«èµ‹å€¼ã€‚\næ¨¡å¼å¯ä»¥ä»»æ„åœ°åµŒå¥—ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæœ‰ä¸€ä¸ªç”±ç‚¹ç»„æˆçš„çŸ­åˆ—è¡¨ï¼Œåˆ™å¯ä½¿ç”¨å¦‚ä¸‹æ–¹å¼è¿›è¡ŒåŒ¹é…ï¼š\nmatch points: case []: print(\u0026#34;No points\u0026#34;) case [Point(0, 0)]: print(\u0026#34;The origin\u0026#34;) case [Point(x, y)]: print(f\u0026#34;Single point {x}, {y}\u0026#34;) case [Point(0, y1), Point(0, y2)]: print(f\u0026#34;Two on the Y axis at {y1}, {y2}\u0026#34;) case _: print(\u0026#34;Something else\u0026#34;) ä¸ºæ¨¡å¼æ·»åŠ æˆä¸ºå®ˆæŠ¤é¡¹çš„ if å­å¥ã€‚å¦‚æœå®ˆæŠ¤é¡¹çš„å€¼ä¸ºå‡ï¼Œåˆ™ match ç»§ç»­åŒ¹é…ä¸‹ä¸€ä¸ª case è¯­å¥å—ã€‚æ³¨æ„ï¼Œå€¼çš„æ•è·å‘ç”Ÿåœ¨å®ˆæŠ¤é¡¹è¢«æ±‚å€¼ä¹‹å‰ï¼š\nmatch point: case Point(x, y) if x == y: print(f\u0026#34;Y=X at {x}\u0026#34;) case Point(x, y): print(f\u0026#34;Not on the diagonal\u0026#34;) match è¯­å¥çš„å…¶ä»–ç‰¹æ€§ï¼š\nä¸è§£åŒ…èµ‹å€¼ç±»ä¼¼ï¼Œå…ƒç»„å’Œåˆ—è¡¨æ¨¡å¼å…·æœ‰å®Œå…¨ç›¸åŒçš„å«ä¹‰ï¼Œå¹¶ä¸”å®é™…ä¸Šèƒ½åŒ¹é…ä»»æ„åºåˆ—ã€‚ ä½†å®ƒä»¬ä¸èƒ½åŒ¹é…è¿­ä»£å™¨æˆ–å­—ç¬¦ä¸²ã€‚\nåºåˆ—æ¨¡å¼æ”¯æŒæ‰©å±•è§£åŒ…æ“ä½œï¼š[x, y, *rest] å’Œ (x, y, *rest) çš„ä½œç”¨ç±»ä¼¼äºè§£åŒ…èµ‹å€¼ã€‚ åœ¨ * ä¹‹åçš„åç§°ä¹Ÿå¯ä»¥ä¸º _ï¼Œå› æ­¤ï¼Œ(x, y, *_) å¯ä»¥åŒ¹é…åŒ…å«è‡³å°‘ä¸¤ä¸ªæ¡ç›®çš„åºåˆ—ï¼Œè€Œä¸å¿…ç»‘å®šå…¶ä½™çš„æ¡ç›®ã€‚\næ˜ å°„æ¨¡å¼ï¼š{\u0026quot;bandwidth\u0026quot;: b, \u0026quot;latency\u0026quot;: l} ä»å­—å…¸ä¸­æ•è· \u0026quot;bandwidth\u0026quot; å’Œ \u0026quot;latency\u0026quot; çš„å€¼ã€‚ä¸åºåˆ—æ¨¡å¼ä¸åŒï¼Œé¢å¤–çš„é”®ä¼šè¢«å¿½ç•¥ã€‚**rest ç­‰è§£åŒ…æ“ä½œä¹Ÿæ”¯æŒã€‚ä½† **_ æ˜¯å†—ä½™çš„ï¼Œä¸å…è®¸ä½¿ç”¨ã€‚\nä½¿ç”¨ as å…³é”®å­—å¯ä»¥æ•è·å­æ¨¡å¼ï¼š\ncase (Point(x1, y1), Point(x2, y2) as p2): ... å°†æŠŠè¾“å…¥çš„ç¬¬äºŒä¸ªå…ƒç´ æ•è·ä¸º p2 (åªè¦è¾“å…¥æ˜¯åŒ…å«ä¸¤ä¸ªç‚¹çš„åºåˆ—)\nå¤§å¤šæ•°å­—é¢å€¼æ˜¯æŒ‰ç›¸ç­‰æ€§æ¯”è¾ƒçš„ï¼Œä½†æ˜¯å•ä¾‹å¯¹è±¡ True, False å’Œ None åˆ™æ˜¯æŒ‰æ ‡è¯†å·æ¯”è¾ƒçš„ã€‚\næ¨¡å¼å¯ä»¥ä½¿ç”¨å‘½åå¸¸é‡ã€‚ è¿™äº›å‘½åå¸¸é‡å¿…é¡»ä¸ºå¸¦ç‚¹å·çš„åç§°ä»¥é˜²æ­¢å®ƒä»¬è¢«è§£è¯»ä¸ºæ•è·å˜é‡:\nfrom enum import Enum class Color(Enum): RED = \u0026#39;red\u0026#39; GREEN = \u0026#39;green\u0026#39; BLUE = \u0026#39;blue\u0026#39; color = Color(input(\u0026#34;Enter your choice of \u0026#39;red\u0026#39;, \u0026#39;blue\u0026#39; or \u0026#39;green\u0026#39;: \u0026#34;)) match color: case Color.RED: print(\u0026#34;I see red!\u0026#34;) case Color.GREEN: print(\u0026#34;Grass is green\u0026#34;) case Color.BLUE: print(\u0026#34;I\u0026#39;m feeling the blues :(\u0026#34;) å¼‚å¸¸å¤„ç†è¯­å¥ å¼‚å¸¸å¤„ç†è¯­å¥ï¼šç”¨äºå¤„ç†ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°çš„å¼‚å¸¸æƒ…å†µï¼ŒPython ä¸­çš„å¼‚å¸¸å¤„ç†è¯­å¥åŒ…æ‹¬ tryã€exceptã€finally å’Œ raise è¯­å¥ã€‚\ntry: x = int(input(\u0026#34;Please enter a number: \u0026#34;)) y = 10 / x print(y) except ValueError: print(\u0026#34;Invalid input\u0026#34;) except ZeroDivisionError: print(\u0026#34;Cannot divide by zero\u0026#34;) else: print(\u0026#34;No exception occurred\u0026#34;) finally: print(\u0026#34;Execution completed\u0026#34;) # raise è¯­å¥ x = -1 if x \u0026lt; 0: raise ValueError(\u0026#34;x must be non-negative\u0026#34;) ","permalink":"https://blog.chensoul.cc/posts/2023/06/14/python-flow-control/","summary":"åœ¨ Python ä¸­ï¼Œæµç¨‹æ§åˆ¶è¯­å¥åŒ…æ‹¬æ¡ä»¶è¯­å¥ï¼ˆif-elif-elseï¼‰ã€å¾ªç¯è¯­å¥ï¼ˆfor å’Œ whileï¼‰ã€è·³è½¬è¯­å¥ï¼ˆbreakã€continue å’Œ returnï¼‰å’Œå¼‚å¸¸å¤„ç†è¯­å¥ã€‚\næ¡ä»¶è¯­å¥ æ¡ä»¶è¯­å¥ç”¨äºåœ¨ä¸åŒçš„æ¡ä»¶ä¸‹æ‰§è¡Œä¸åŒçš„ä»£ç å—ã€‚Python ä¸­çš„æ¡ä»¶è¯­å¥æ˜¯ if-elif-else ç»“æ„ã€‚\n# æ¡ä»¶è¯­å¥ç¤ºä¾‹ x = 10 if x \u0026lt; 0: print(\u0026#34;x is negative\u0026#34;) elif x == 0: print(\u0026#34;x is zero\u0026#34;) else: print(\u0026#34;x is positive\u0026#34;) å¾ªç¯è¯­å¥ å¾ªç¯è¯­å¥ç”¨äºé‡å¤æ‰§è¡Œä¸€æ®µä»£ç ï¼Œç›´åˆ°æ»¡è¶³æŸä¸ªæ¡ä»¶æˆ–è¾¾åˆ°æŸä¸ªæ¡ä»¶æ¬¡æ•°ä¸ºæ­¢ã€‚Python ä¸­çš„å¾ªç¯è¯­å¥åŒ…æ‹¬ for å’Œ while ä¸¤ç§ç»“æ„ã€‚\n# for å¾ªç¯ç¤ºä¾‹ my_list = [1, 2, 3, 4, 5] for item in my_list: print(item) # while å¾ªç¯ç¤ºä¾‹ x = 10 while x \u0026gt; 0: print(x) x -= 1 éå†é›†åˆæ—¶ä¿®æ”¹é›†åˆçš„å†…å®¹ï¼Œä¼šå¾ˆå®¹æ˜“ç”Ÿæˆé”™è¯¯çš„ç»“æœã€‚å› æ­¤ä¸èƒ½ç›´æ¥è¿›è¡Œå¾ªç¯ï¼Œè€Œæ˜¯åº”éå†è¯¥é›†åˆçš„å‰¯æœ¬æˆ–åˆ›å»ºæ–°çš„é›†åˆï¼š\n# Create a sample collection users = {\u0026#39;Hans\u0026#39;: \u0026#39;active\u0026#39;, \u0026#39;Ã‰lÃ©onore\u0026#39;: \u0026#39;inactive\u0026#39;, \u0026#39;æ™¯å¤ªéƒ\u0026#39;: \u0026#39;active\u0026#39;} # Strategy: Iterate over a copy for user, status in users.copy().items(): if status == \u0026#39;inactive\u0026#39;: del users[user] # Strategy: Create a new collection active_users = {} for user, status in users.","title":"Pythonå­¦ä¹ 4ï¼šæµç¨‹æ§åˆ¶"},{"content":"åœ¨ Python ä¸­ï¼Œè¿ç®—ç¬¦æ˜¯ç”¨äºæ‰§è¡Œå„ç§æ“ä½œçš„ç¬¦å·æˆ–å…³é”®å­—ï¼›è¡¨è¾¾å¼æ˜¯ç”±æ“ä½œç¬¦ã€å˜é‡ã€å¸¸é‡å’Œå‡½æ•°è°ƒç”¨ç­‰ç»„æˆçš„ï¼Œå®ƒä»¬å¯ä»¥è¢«è®¡ç®—æ±‚å€¼å¹¶è¿”å›ä¸€ä¸ªç»“æœã€‚\nä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„è¿ç®—ç¬¦å’Œè¡¨è¾¾å¼ï¼š\nç®—æœ¯è¿ç®—ç¬¦ Python ä¸­çš„ç®—æœ¯è¿ç®—ç¬¦ç”¨äºæ‰§è¡ŒåŸºæœ¬çš„ç®—æœ¯è¿ç®—ï¼ŒåŒ…æ‹¬åŠ ã€å‡ã€ä¹˜ã€é™¤ã€å–æ¨¡å’Œå¹‚è¿ç®—ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„ç®—æœ¯è¿ç®—ç¬¦ï¼š\n+ï¼šåŠ æ³•è¿ç®— -ï¼šå‡æ³•è¿ç®— *ï¼šä¹˜æ³•è¿ç®— /ï¼šé™¤æ³•è¿ç®— %ï¼šå–æ¨¡è¿ç®—ï¼Œè¿”å›ä¸¤ä¸ªæ•°ç›¸é™¤çš„ä½™æ•° **ï¼šå¹‚è¿ç®—ï¼Œè¿”å›ä¸€ä¸ªæ•°çš„æŒ‡å®šæ¬¡å¹‚ ä¾‹å¦‚ï¼š\nx + y # åŠ æ³• x - y # å‡æ³• x * y # ä¹˜æ³• x / y # é™¤æ³• x % y # å–æ¨¡ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ç®—æœ¯è¿ç®—ç¬¦æ‰§è¡ŒåŸºæœ¬çš„ç®—æœ¯è¿ç®—ï¼Œä¾‹å¦‚å°†å˜é‡xå’Œyç›¸åŠ ã€ç›¸å‡ã€ç›¸ä¹˜ã€ç›¸é™¤å’Œå–æ¨¡ã€‚\næ¯”è¾ƒè¿ç®—ç¬¦ Python ä¸­çš„æ¯”è¾ƒè¿ç®—ç¬¦ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå€¼çš„å¤§å°å…³ç³»ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„æ¯”è¾ƒè¿ç®—ç¬¦ï¼š\n==ï¼šç­‰äºè¿ç®—ç¬¦ï¼Œå¦‚æœä¸¤ä¸ªå€¼ç›¸ç­‰ï¼Œåˆ™è¿”å›Trueï¼Œå¦åˆ™è¿”å›False !=ï¼šä¸ç­‰äºè¿ç®—ç¬¦ï¼Œå¦‚æœä¸¤ä¸ªå€¼ä¸ç›¸ç­‰ï¼Œåˆ™è¿”å›Trueï¼Œå¦åˆ™è¿”å›False \u0026gt;ï¼šå¤§äºè¿ç®—ç¬¦ï¼Œå¦‚æœå·¦è¾¹çš„å€¼å¤§äºå³è¾¹çš„å€¼ï¼Œåˆ™è¿”å›Trueï¼Œå¦åˆ™è¿”å›False \u0026lt;ï¼šå°äºè¿ç®—ç¬¦ï¼Œå¦‚æœå·¦è¾¹çš„å€¼å°äºå³è¾¹çš„å€¼ï¼Œåˆ™è¿”å›Trueï¼Œå¦åˆ™è¿”å›False \u0026gt;=ï¼šå¤§äºç­‰äºè¿ç®—ç¬¦ï¼Œå¦‚æœå·¦è¾¹çš„å€¼å¤§äºç­‰äºå³è¾¹çš„å€¼ï¼Œåˆ™è¿”å›Trueï¼Œå¦åˆ™è¿”å›False \u0026lt;=ï¼šå°äºç­‰äºè¿ç®—ç¬¦ï¼Œå¦‚æœå·¦è¾¹çš„å€¼å°äºç­‰äºå³è¾¹çš„å€¼ï¼Œåˆ™è¿”å›Trueï¼Œå¦åˆ™è¿”å›False ä¾‹å¦‚ï¼š\nx == y # ç­‰äº x != y # ä¸ç­‰äº x \u0026gt; y # å¤§äº x \u0026lt; y # å°äº x \u0026gt;= y # å¤§äºç­‰äº x \u0026lt;= y # å°äºç­‰äº åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ¯”è¾ƒè¿ç®—ç¬¦æ¯”è¾ƒå˜é‡xå’Œyçš„å¤§å°å…³ç³»ï¼Œä¾‹å¦‚åˆ¤æ–­xæ˜¯å¦ç­‰äºyã€æ˜¯å¦å¤§äºyç­‰ã€‚\né€»è¾‘è¿ç®—ç¬¦ Python ä¸­çš„é€»è¾‘è¿ç®—ç¬¦ç”¨äºæ‰§è¡Œé€»è¾‘æ“ä½œï¼ŒåŒ…æ‹¬ä¸ã€æˆ–å’Œéè¿ç®—ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„é€»è¾‘è¿ç®—ç¬¦ï¼š\nandï¼šé€»è¾‘ä¸è¿ç®—ç¬¦ï¼Œå¦‚æœä¸¤ä¸ªæ“ä½œæ•°éƒ½ä¸ºTrueï¼Œåˆ™è¿”å›Trueï¼Œå¦åˆ™è¿”å›False orï¼šé€»è¾‘æˆ–è¿ç®—ç¬¦ï¼Œå¦‚æœä¸¤ä¸ªæ“ä½œæ•°ä¸­è‡³å°‘æœ‰ä¸€ä¸ªä¸ºTrueï¼Œåˆ™è¿”å›Trueï¼Œå¦åˆ™è¿”å›False notï¼šé€»è¾‘éè¿ç®—ç¬¦ï¼Œå¦‚æœæ“ä½œæ•°ä¸ºTrueï¼Œåˆ™è¿”å›Falseï¼Œå¦åˆ™è¿”å›True ä¾‹å¦‚ï¼š\nx and y # ä¸ x or y # æˆ– not x # é åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨é€»è¾‘è¿ç®—ç¬¦æ‰§è¡Œé€»è¾‘è¿ç®—ï¼Œä¾‹å¦‚åˆ¤æ–­å˜é‡xå’Œyæ˜¯å¦éƒ½ä¸ºTrueã€åˆ¤æ–­å˜é‡xå’Œyæ˜¯å¦è‡³å°‘ä¸€ä¸ªä¸ºTrueç­‰ã€‚\nèµ‹å€¼è¿ç®—ç¬¦ Python ä¸­çš„èµ‹å€¼è¿ç®—ç¬¦ç”¨äºå°†ä¸€ä¸ªå€¼èµ‹ç»™ä¸€ä¸ªå˜é‡ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„èµ‹å€¼è¿ç®—ç¬¦ï¼š\n=ï¼šç®€å•èµ‹å€¼è¿ç®—ç¬¦ï¼Œå°†å³è¾¹çš„å€¼èµ‹ç»™å·¦è¾¹çš„å˜é‡ +=ï¼šåŠ ç­‰äºè¿ç®—ç¬¦ï¼Œå°†å³è¾¹çš„å€¼åŠ åˆ°å·¦è¾¹çš„å˜é‡ä¸Šï¼Œå¹¶å°†ç»“æœèµ‹ç»™å·¦è¾¹çš„å˜é‡ -=ï¼šå‡ç­‰äºè¿ç®—ç¬¦ï¼Œå°†å³è¾¹çš„å€¼ä»å·¦è¾¹çš„å˜é‡ä¸Šå‡å»ï¼Œå¹¶å°†ç»“æœèµ‹ç»™å·¦è¾¹çš„å˜é‡ *=ï¼šä¹˜ç­‰äºè¿ç®—ç¬¦ï¼Œå°†å·¦è¾¹çš„å˜é‡ä¹˜ä»¥å³è¾¹çš„å€¼ï¼Œå¹¶å°†ç»“æœèµ‹ç»™å·¦è¾¹çš„å˜é‡ /=ï¼šé™¤ç­‰äºè¿ç®—ç¬¦ï¼Œå°†å·¦è¾¹çš„å˜é‡é™¤ä»¥å³è¾¹çš„å€¼ï¼Œå¹¶å°†ç»“æœèµ‹ç»™å·¦è¾¹çš„å˜é‡ %=ï¼šå–æ¨¡ç­‰äºè¿ç®—ç¬¦ï¼Œå°†å·¦è¾¹çš„å˜é‡å–æ¨¡å³è¾¹çš„å€¼ï¼Œå¹¶å°†ç»“æœèµ‹ç»™å·¦è¾¹çš„å˜é‡ **=ï¼šå¹‚ç­‰äºè¿ç®—ç¬¦ï¼Œå°†å·¦è¾¹çš„å˜é‡çš„å€¼çš„æŒ‡å®šæ¬¡å¹‚èµ‹ç»™å·¦è¾¹çš„å˜é‡ ä¾‹å¦‚ï¼š\nx = 10 # ç­‰äºå· x += 5 # åŠ ç­‰äº x -= 5 # å‡ç­‰äº x *= 2 # ä¹˜ç­‰äº x /= 3 # é™¤ç­‰äº x %= 2 # å–æ¨¡ç­‰äº åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨èµ‹å€¼è¿ç®—ç¬¦å°†ä¸€ä¸ªå€¼èµ‹ç»™å˜é‡xï¼Œä»¥åŠä½¿ç”¨åŠ ç­‰äºã€å‡ç­‰äºã€ä¹˜ç­‰äºã€é™¤ç­‰äºå’Œå–æ¨¡ç­‰äºè¿ç®—ç¬¦å¯¹å˜é‡xè¿›è¡Œæ›´æ–°ã€‚\nä½è¿ç®—ç¬¦ Python ä¸­çš„ä½è¿ç®—ç¬¦ç”¨äºå¯¹æ•´æ•°è¿›è¡Œä½è¿ç®—ï¼ŒåŒ…æ‹¬æŒ‰ä½ä¸ã€æŒ‰ä½æˆ–ã€æŒ‰ä½å¼‚æˆ–ã€æŒ‰ä½å–åå’Œå·¦å³ç§»ä½è¿ç®—ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„ä½è¿ç®—ç¬¦ï¼š\n\u0026amp;ï¼šæŒ‰ä½ä¸è¿ç®—ç¬¦ï¼Œå¯¹ä¸¤ä¸ªæ“ä½œæ•°çš„æ¯ä¸ªä½æ‰§è¡Œé€»è¾‘ä¸æ“ä½œï¼Œè¿”å›ä¸€ä¸ªæ–°çš„æ•´æ•° |ï¼šæŒ‰ä½æˆ–è¿ç®—ç¬¦ï¼Œå¯¹ä¸¤ä¸ªæ“ä½œæ•°çš„æ¯ä¸ªä½æ‰§è¡Œé€»è¾‘æˆ–æ“ä½œï¼Œè¿”å›ä¸€ä¸ªæ–°çš„æ•´æ•° ^ï¼šæŒ‰ä½å¼‚æˆ–è¿ç®—ç¬¦ï¼Œå¯¹ä¸¤ä¸ªæ“ä½œæ•°çš„æ¯ä¸ªä½æ‰§è¡Œé€»è¾‘å¼‚æˆ–æ“ä½œï¼Œè¿”å›ä¸€ä¸ªæ–°çš„æ•´æ•° ~ï¼šæŒ‰ä½å–åè¿ç®—ç¬¦ï¼Œå¯¹æ“ä½œæ•°çš„æ¯ä¸ªä½æ‰§è¡Œé€»è¾‘å–åæ“ä½œï¼Œè¿”å›ä¸€ä¸ªæ–°çš„æ•´æ•° \u0026lt;\u0026lt;ï¼šå·¦ç§»ä½è¿ç®—ç¬¦ï¼Œå°†ä¸€ä¸ªæ•´æ•°çš„æ‰€æœ‰ä½å‘å·¦ç§»åŠ¨æŒ‡å®šçš„ä½æ•°ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„æ•´æ•° \u0026gt;\u0026gt;ï¼šå³ç§»ä½è¿ç®—ç¬¦ï¼Œå°†ä¸€ä¸ªæ•´æ•°çš„æ‰€æœ‰ä½å‘å³ç§»åŠ¨æŒ‡å®šçš„ä½æ•°ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„æ•´æ•° ä¾‹å¦‚ï¼š\nx \u0026amp; y # æŒ‰ä½ä¸ x | y # æŒ‰ä½æˆ– x ^ y # æŒ‰ä½å¼‚æˆ– ~x # æŒ‰ä½å–å x \u0026lt;\u0026lt; 2 # å·¦ç§»2ä½ x \u0026gt;\u0026gt; 2 # å³ç§»2ä½ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä½è¿ç®—ç¬¦å¯¹äºŒè¿›åˆ¶æ•°è¿›è¡Œä½æ“ä½œï¼Œä¾‹å¦‚å°†å˜é‡xå’Œyè¿›è¡ŒæŒ‰ä½ä¸ã€æŒ‰ä½æˆ–ã€æŒ‰ä½å¼‚æˆ–ï¼Œä»¥åŠå¯¹å˜é‡xè¿›è¡ŒæŒ‰ä½å–åã€å·¦ç§»å’Œå³ç§»ã€‚\nä¸‰å…ƒè¿ç®—ç¬¦ Python ä¸­çš„ä¸‰å…ƒè¿ç®—ç¬¦å¯ä»¥ç”¨äºåœ¨ä¸€è¡Œä»£ç ä¸­å®ç°ç®€å•çš„æ¡ä»¶è¯­å¥ã€‚å®ƒçš„è¯­æ³•å¦‚ä¸‹ï¼š\nvalue_if_true if condition else value_if_false å…¶ä¸­conditionæ˜¯ä¸€ä¸ªå¸ƒå°”è¡¨è¾¾å¼ï¼Œå¦‚æœå®ƒçš„å€¼ä¸ºTrueï¼Œåˆ™è¿”å›value_if_trueï¼Œå¦åˆ™è¿”å›value_if_falseã€‚ä¾‹å¦‚ï¼š\nx = 5 y = 10 max_value = x if x \u0026gt; y else y print(max_value) # è¾“å‡ºï¼š10 åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸‰å…ƒè¿ç®—ç¬¦æ¥æ¯”è¾ƒxå’Œyçš„å€¼ï¼Œå¹¶å°†è¾ƒå¤§çš„å€¼èµ‹ç»™å˜é‡max_valueã€‚\næˆå‘˜è¿ç®—ç¬¦ Python ä¸­çš„æˆå‘˜è¿ç®—ç¬¦ç”¨äºæ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦æ˜¯å¦ä¸€ä¸ªå€¼çš„æˆå‘˜ï¼ŒåŒ…æ‹¬inå’Œnot inè¿ç®—ç¬¦ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼š\nmy_list = [1, 2, 3, 4, 5] if 3 in my_list: print(\u0026#34;3 is in my_list\u0026#34;) åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨inè¿ç®—ç¬¦æ¥æ£€æŸ¥3æ˜¯å¦æ˜¯my_listä¸­çš„æˆå‘˜ã€‚å¦‚æœæ˜¯ï¼Œåˆ™æ‰“å°å‡º3 is in my_listã€‚\nèº«ä»½è¿ç®—ç¬¦ Python ä¸­çš„èº«ä»½è¿ç®—ç¬¦ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å†…å­˜åœ°å€ï¼ŒåŒ…æ‹¬iså’Œis notè¿ç®—ç¬¦ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼š\nx = [1, 2, 3] y = [1, 2, 3] if x is y: print(\u0026#34;x and y have the same identity\u0026#34;) else: print(\u0026#34;x and y have different identities\u0026#34;) åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨isè¿ç®—ç¬¦æ¥æ¯”è¾ƒxå’Œyçš„å†…å­˜åœ°å€ã€‚ç”±äºxå’Œyæ˜¯ä¸¤ä¸ªä¸åŒçš„åˆ—è¡¨å¯¹è±¡ï¼Œæ‰€ä»¥å®ƒä»¬çš„å†…å­˜åœ°å€ä¸åŒï¼Œç¨‹åºä¼šæ‰“å°å‡ºx and y have different identitiesã€‚\nåˆ‡ç‰‡è¿ç®—ç¬¦ Python ä¸­çš„åˆ‡ç‰‡è¿ç®—ç¬¦ç”¨äºä»åºåˆ—ä¸­è·å–ä¸€ä¸ªå­åºåˆ—ï¼ŒåŒ…æ‹¬ä»å¼€å§‹ä½ç½®åˆ°ç»“æŸä½ç½®çš„åˆ‡ç‰‡å’Œæ­¥é•¿åˆ‡ç‰‡ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼š\nmy_list = [1, 2, 3, 4, 5] print(my_list[1:4]) # è¾“å‡ºï¼š[2, 3, 4] print(my_list[::2]) # è¾“å‡ºï¼š[1, 3, 5] åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨åˆ‡ç‰‡è¿ç®—ç¬¦ä»åˆ—è¡¨my_listä¸­è·å–ä¸€ä¸ªå­åºåˆ—ã€‚ç¬¬ä¸€ä¸ªåˆ‡ç‰‡my_list[1:4]è¿”å›ä»ä¸‹æ ‡1åˆ°ä¸‹æ ‡3çš„å…ƒç´ ï¼Œç¬¬äºŒä¸ªåˆ‡ç‰‡my_list[::2]è¿”å›æ¯éš”ä¸€ä¸ªå…ƒç´ çš„å­åºåˆ—ã€‚\næ ¼å¼åŒ–è¿ç®—ç¬¦ Python ä¸­çš„æ ¼å¼åŒ–è¿ç®—ç¬¦ç”¨äºå°†ä¸€ä¸ªå€¼æ’å…¥åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ã€‚å®ƒçš„è¯­æ³•å¦‚ä¸‹ï¼š\n\u0026#34;format string\u0026#34; % values å…¶ä¸­\u0026quot;format string\u0026quot;æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒåŒ…å«æ ¼å¼åŒ–ä»£ç ï¼Œvaluesæ˜¯ä¸€ä¸ªå…ƒç»„ï¼ŒåŒ…å«è¦æ’å…¥çš„å€¼ã€‚ä¾‹å¦‚ï¼š\nname = \u0026#34;Alice\u0026#34; age = 25 print(\u0026#34;My name is %s, and I am %d years old.\u0026#34; % (name, age)) åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ ¼å¼åŒ–è¿ç®—ç¬¦å°†å˜é‡nameå’Œageæ’å…¥åˆ°å­—ç¬¦ä¸²ä¸­ï¼Œç”Ÿæˆä¸€æ¡åŒ…å«å˜é‡å€¼çš„æ¶ˆæ¯ã€‚\næ‹¼æ¥è¿ç®—ç¬¦ Python ä¸­çš„æ‹¼æ¥è¿ç®—ç¬¦ç”¨äºå°†ä¸¤ä¸ªå­—ç¬¦ä¸²æˆ–åºåˆ—è¿æ¥èµ·æ¥ï¼ŒåŒ…æ‹¬+è¿ç®—ç¬¦å’Œ*è¿ç®—ç¬¦ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼š\nstr1 = \u0026#34;Hello\u0026#34; str2 = \u0026#34;world\u0026#34; print(str1 + \u0026#34; \u0026#34; + str2) # è¾“å‡ºï¼šHello world my_list = [1, 2, 3] print(my_list * 3) # è¾“å‡ºï¼š[1, 2, 3, 1, 2, 3, 1, 2, 3] åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ‹¼æ¥è¿ç®—ç¬¦å°†ä¸¤ä¸ªå­—ç¬¦ä¸²è¿æ¥èµ·æ¥ï¼Œä»¥åŠå°†ä¸€ä¸ªåˆ—è¡¨å¤åˆ¶å¤šæ¬¡ç”Ÿæˆä¸€ä¸ªæ–°çš„åˆ—è¡¨ã€‚\nè§£åŒ…è¿ç®—ç¬¦ Python ä¸­çš„è§£åŒ…è¿ç®—ç¬¦åŒ…æ‹¬ä¸¤ç§ï¼š*å’Œ**ã€‚\n*è§£åŒ…è¿ç®—ç¬¦ *è§£åŒ…è¿ç®—ç¬¦ç”¨äºå°†å¯è¿­ä»£å¯¹è±¡ï¼ˆå¦‚åˆ—è¡¨ã€å…ƒç»„ã€é›†åˆç­‰ï¼‰è§£åŒ…æˆå•ç‹¬çš„å…ƒç´ ã€‚ä¾‹å¦‚ï¼š\nmy_list = [1, 2, 3, 4, 5] print(*my_list) # è¾“å‡º: 1 2 3 4 5 åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨*è§£åŒ…è¿ç®—ç¬¦å°†my_liståˆ—è¡¨è§£åŒ…æˆä¸€ä¸ªä¸ªå•ç‹¬çš„å…ƒç´ ï¼Œç„¶åé€šè¿‡printå‡½æ•°è¾“å‡ºã€‚\n**è§£åŒ…è¿ç®—ç¬¦ **è§£åŒ…è¿ç®—ç¬¦ç”¨äºå°†å­—å…¸è§£åŒ…æˆå…³é”®å­—å‚æ•°ã€‚ä¾‹å¦‚ï¼š\nmy_dict = {\u0026#34;x\u0026#34;: 1, \u0026#34;y\u0026#34;: 2, \u0026#34;z\u0026#34;: 3} print(**my_dict) # è¾“å‡º: x=1 y=2 z=3 åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨**è§£åŒ…è¿ç®—ç¬¦å°†my_dictå­—å…¸è§£åŒ…æˆå…³é”®å­—å‚æ•°ï¼Œå¹¶é€šè¿‡printå‡½æ•°è¾“å‡ºã€‚\né™¤äº†ä¸Šé¢çš„ç”¨æ³•ï¼Œ*å’Œ**è§£åŒ…è¿ç®—ç¬¦è¿˜å¯ä»¥ç”¨äºå‡½æ•°å®šä¹‰å’Œè°ƒç”¨ä¸­ã€‚ä¾‹å¦‚ï¼š\ndef my_func(a, b, c): print(a, b, c) my_list = [1, 2, 3] my_func(*my_list) # è¾“å‡º: 1 2 3 my_dict = {\u0026#34;a\u0026#34;: 1, \u0026#34;b\u0026#34;: 2, \u0026#34;c\u0026#34;: 3} my_func(**my_dict) # è¾“å‡º: 1 2 3 åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°my_funcï¼Œç„¶åä½¿ç”¨*å’Œ**è§£åŒ…è¿ç®—ç¬¦å°†åˆ—è¡¨å’Œå­—å…¸ä¸­çš„å€¼ä½œä¸ºå‡½æ•°çš„å‚æ•°ä¼ é€’è¿›å»ã€‚\n@è¿ç®—ç¬¦ @è¿ç®—ç¬¦ç”¨äºæ‰§è¡ŒçŸ©é˜µä¹˜æ³•ã€‚ä¾‹å¦‚ï¼š\nimport numpy as np a = np.array([[1, 2], [3, 4]]) b = np.array([[5, 6], [7, 8]]) c = a @ b # çŸ©é˜µä¹˜æ³• print(c) # è¾“å‡º: [[19 22] [43 50]] åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨@è¿ç®—ç¬¦å¯¹ä¸¤ä¸ªçŸ©é˜µè¿›è¡Œä¹˜æ³•è¿ç®—ï¼Œå¹¶å°†ç»“æœä¿å­˜åœ¨å˜é‡cä¸­ã€‚\nlambda è¡¨è¾¾å¼ Python ä¸­çš„ lambda è¡¨è¾¾å¼å¯ä»¥ç”¨äºåˆ›å»ºåŒ¿åå‡½æ•°ã€‚å®ƒçš„è¯­æ³•å¦‚ä¸‹ï¼š\nlambda arguments : expression å…¶ä¸­argumentsæ˜¯å‡½æ•°çš„å‚æ•°åˆ—è¡¨ï¼Œexpressionæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¡¨ç¤ºå‡½æ•°çš„è¿”å›å€¼ã€‚ä¾‹å¦‚ï¼š\nf = lambda x, y: x + y print(f(2, 3)) # è¾“å‡ºï¼š5 åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ lambda è¡¨è¾¾å¼åˆ›å»ºäº†ä¸€ä¸ªå‡½æ•°fï¼Œå®ƒæ¥å—ä¸¤ä¸ªå‚æ•°xå’Œyï¼Œå¹¶è¿”å›å®ƒä»¬çš„å’Œã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/06/11/python-operator-and-expression/","summary":"åœ¨ Python ä¸­ï¼Œè¿ç®—ç¬¦æ˜¯ç”¨äºæ‰§è¡Œå„ç§æ“ä½œçš„ç¬¦å·æˆ–å…³é”®å­—ï¼›è¡¨è¾¾å¼æ˜¯ç”±æ“ä½œç¬¦ã€å˜é‡ã€å¸¸é‡å’Œå‡½æ•°è°ƒç”¨ç­‰ç»„æˆçš„ï¼Œå®ƒä»¬å¯ä»¥è¢«è®¡ç®—æ±‚å€¼å¹¶è¿”å›ä¸€ä¸ªç»“æœã€‚\nä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„è¿ç®—ç¬¦å’Œè¡¨è¾¾å¼ï¼š\nç®—æœ¯è¿ç®—ç¬¦ Python ä¸­çš„ç®—æœ¯è¿ç®—ç¬¦ç”¨äºæ‰§è¡ŒåŸºæœ¬çš„ç®—æœ¯è¿ç®—ï¼ŒåŒ…æ‹¬åŠ ã€å‡ã€ä¹˜ã€é™¤ã€å–æ¨¡å’Œå¹‚è¿ç®—ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„ç®—æœ¯è¿ç®—ç¬¦ï¼š\n+ï¼šåŠ æ³•è¿ç®— -ï¼šå‡æ³•è¿ç®— *ï¼šä¹˜æ³•è¿ç®— /ï¼šé™¤æ³•è¿ç®— %ï¼šå–æ¨¡è¿ç®—ï¼Œè¿”å›ä¸¤ä¸ªæ•°ç›¸é™¤çš„ä½™æ•° **ï¼šå¹‚è¿ç®—ï¼Œè¿”å›ä¸€ä¸ªæ•°çš„æŒ‡å®šæ¬¡å¹‚ ä¾‹å¦‚ï¼š\nx + y # åŠ æ³• x - y # å‡æ³• x * y # ä¹˜æ³• x / y # é™¤æ³• x % y # å–æ¨¡ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ç®—æœ¯è¿ç®—ç¬¦æ‰§è¡ŒåŸºæœ¬çš„ç®—æœ¯è¿ç®—ï¼Œä¾‹å¦‚å°†å˜é‡xå’Œyç›¸åŠ ã€ç›¸å‡ã€ç›¸ä¹˜ã€ç›¸é™¤å’Œå–æ¨¡ã€‚\næ¯”è¾ƒè¿ç®—ç¬¦ Python ä¸­çš„æ¯”è¾ƒè¿ç®—ç¬¦ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå€¼çš„å¤§å°å…³ç³»ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„æ¯”è¾ƒè¿ç®—ç¬¦ï¼š\n==ï¼šç­‰äºè¿ç®—ç¬¦ï¼Œå¦‚æœä¸¤ä¸ªå€¼ç›¸ç­‰ï¼Œåˆ™è¿”å›Trueï¼Œå¦åˆ™è¿”å›False !=ï¼šä¸ç­‰äºè¿ç®—ç¬¦ï¼Œå¦‚æœä¸¤ä¸ªå€¼ä¸ç›¸ç­‰ï¼Œåˆ™è¿”å›Trueï¼Œå¦åˆ™è¿”å›False \u0026gt;ï¼šå¤§äºè¿ç®—ç¬¦ï¼Œå¦‚æœå·¦è¾¹çš„å€¼å¤§äºå³è¾¹çš„å€¼ï¼Œåˆ™è¿”å›Trueï¼Œå¦åˆ™è¿”å›False \u0026lt;ï¼šå°äºè¿ç®—ç¬¦ï¼Œå¦‚æœå·¦è¾¹çš„å€¼å°äºå³è¾¹çš„å€¼ï¼Œåˆ™è¿”å›Trueï¼Œå¦åˆ™è¿”å›False \u0026gt;=ï¼šå¤§äºç­‰äºè¿ç®—ç¬¦ï¼Œå¦‚æœå·¦è¾¹çš„å€¼å¤§äºç­‰äºå³è¾¹çš„å€¼ï¼Œåˆ™è¿”å›Trueï¼Œå¦åˆ™è¿”å›False \u0026lt;=ï¼šå°äºç­‰äºè¿ç®—ç¬¦ï¼Œå¦‚æœå·¦è¾¹çš„å€¼å°äºç­‰äºå³è¾¹çš„å€¼ï¼Œåˆ™è¿”å›Trueï¼Œå¦åˆ™è¿”å›False ä¾‹å¦‚ï¼š\nx == y # ç­‰äº x != y # ä¸ç­‰äº x \u0026gt; y # å¤§äº x \u0026lt; y # å°äº x \u0026gt;= y # å¤§äºç­‰äº x \u0026lt;= y # å°äºç­‰äº åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ¯”è¾ƒè¿ç®—ç¬¦æ¯”è¾ƒå˜é‡xå’Œyçš„å¤§å°å…³ç³»ï¼Œä¾‹å¦‚åˆ¤æ–­xæ˜¯å¦ç­‰äºyã€æ˜¯å¦å¤§äºyç­‰ã€‚\né€»è¾‘è¿ç®—ç¬¦ Python ä¸­çš„é€»è¾‘è¿ç®—ç¬¦ç”¨äºæ‰§è¡Œé€»è¾‘æ“ä½œï¼ŒåŒ…æ‹¬ä¸ã€æˆ–å’Œéè¿ç®—ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„é€»è¾‘è¿ç®—ç¬¦ï¼š\nandï¼šé€»è¾‘ä¸è¿ç®—ç¬¦ï¼Œå¦‚æœä¸¤ä¸ªæ“ä½œæ•°éƒ½ä¸ºTrueï¼Œåˆ™è¿”å›Trueï¼Œå¦åˆ™è¿”å›False orï¼šé€»è¾‘æˆ–è¿ç®—ç¬¦ï¼Œå¦‚æœä¸¤ä¸ªæ“ä½œæ•°ä¸­è‡³å°‘æœ‰ä¸€ä¸ªä¸ºTrueï¼Œåˆ™è¿”å›Trueï¼Œå¦åˆ™è¿”å›False notï¼šé€»è¾‘éè¿ç®—ç¬¦ï¼Œå¦‚æœæ“ä½œæ•°ä¸ºTrueï¼Œåˆ™è¿”å›Falseï¼Œå¦åˆ™è¿”å›True ä¾‹å¦‚ï¼š\nx and y # ä¸ x or y # æˆ– not x # é åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨é€»è¾‘è¿ç®—ç¬¦æ‰§è¡Œé€»è¾‘è¿ç®—ï¼Œä¾‹å¦‚åˆ¤æ–­å˜é‡xå’Œyæ˜¯å¦éƒ½ä¸ºTrueã€åˆ¤æ–­å˜é‡xå’Œyæ˜¯å¦è‡³å°‘ä¸€ä¸ªä¸ºTrueç­‰ã€‚","title":"Pythonå­¦ä¹ 3ï¼šè¿ç®—ç¬¦å’Œè¡¨è¾¾å¼"},{"content":"Python ä¸­çš„æ•°æ®ç±»å‹åŒ…æ‹¬ï¼š\næ•°å­—ç±»å‹ï¼šåŒ…æ‹¬æ•´å‹ã€æµ®ç‚¹å‹ã€å¤æ•°å‹å’Œå¸ƒå°”ç±»å‹ï¼šåªæœ‰ä¸¤ä¸ªå–å€¼ï¼ŒTrue å’Œ Falseï¼Œç”¨äºè¡¨ç¤ºé€»è¾‘å€¼ã€‚ å­—ç¬¦ä¸²ç±»å‹ï¼šç”±ä¸€ç³»åˆ—å­—ç¬¦ç»„æˆï¼Œå¯ä»¥æ˜¯å•å¼•å·ã€åŒå¼•å·æˆ–ä¸‰å¼•å·æ‹¬èµ·æ¥çš„æ–‡æœ¬ã€‚ åˆ—è¡¨ç±»å‹ï¼šç”±ä¸€ç³»åˆ—æœ‰åºçš„å…ƒç´ ç»„æˆï¼Œå¯ä»¥åŒ…å«ä»»ä½•ç±»å‹çš„æ•°æ®ã€‚ å…ƒç»„ç±»å‹ï¼šä¸åˆ—è¡¨ç±»ä¼¼ï¼Œä½†æ˜¯å…ƒç´ ä¸èƒ½è¢«ä¿®æ”¹ã€‚ é›†åˆç±»å‹ï¼šç”±ä¸€ç»„å”¯ä¸€çš„å…ƒç´ ç»„æˆï¼Œæ”¯æŒé›†åˆçš„åŸºæœ¬æ“ä½œï¼Œå¦‚å¹¶é›†ã€äº¤é›†å’Œå·®é›†ç­‰ã€‚ å­—å…¸ç±»å‹ï¼šç”±ä¸€ç»„é”®å€¼å¯¹ç»„æˆï¼Œå…¶ä¸­é”®æ˜¯å”¯ä¸€çš„ï¼Œç”¨äºæŸ¥æ‰¾å’Œå­˜å‚¨å€¼ã€‚ None ç±»å‹ï¼šè¡¨ç¤ºç©ºå€¼æˆ–ç¼ºå¤±å€¼ã€‚ æ•°å­— åœ¨ Python ä¸­ï¼Œæ•°å­—ç±»å‹åŒ…æ‹¬æ•´æ•°ï¼ˆintï¼‰ã€æµ®ç‚¹æ•°ï¼ˆfloatï¼‰ã€å¤æ•°ï¼ˆcomplexï¼‰å’Œå¸ƒå°”å€¼ï¼ˆboolï¼‰ã€‚\næ•´æ•°ï¼ˆintï¼‰æ˜¯ä¸å¸¦å°æ•°çš„æ•°å­—ï¼Œå¯ä»¥ä½¿ç”¨åè¿›åˆ¶ã€äºŒè¿›åˆ¶ã€å…«è¿›åˆ¶æˆ–åå…­è¿›åˆ¶è¡¨ç¤ºã€‚åœ¨ Python 3 ä¸­ï¼Œæ•´æ•°çš„é•¿åº¦ä¸å†å—é™äºæœºå™¨çš„ä½æ•°ï¼Œå¯ä»¥è¡¨ç¤ºä»»æ„å¤§çš„æ•´æ•°ã€‚ ä¾‹å¦‚ï¼š\na = 123 # åè¿›åˆ¶æ•´æ•° b = 0b1010 # äºŒè¿›åˆ¶æ•´æ•°ï¼Œç­‰äºåè¿›åˆ¶çš„ 10 c = 0o12 # å…«è¿›åˆ¶æ•´æ•°ï¼Œç­‰äºåè¿›åˆ¶çš„ 10 d = 0x0A # åå…­è¿›åˆ¶æ•´æ•°ï¼Œç­‰äºåè¿›åˆ¶çš„ 10 æµ®ç‚¹æ•°ï¼ˆfloatï¼‰æ˜¯å¸¦å°æ•°çš„æ•°å­—ï¼Œå¯ä»¥ä½¿ç”¨ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºã€‚åœ¨ Python ä¸­ï¼Œæµ®ç‚¹æ•°é‡‡ç”¨ IEEE 754 æ ‡å‡†è¡¨ç¤ºï¼Œå…·æœ‰åŒç²¾åº¦ï¼ˆ64 ä½ï¼‰å’Œå•ç²¾åº¦ï¼ˆ32 ä½ï¼‰ä¸¤ç§å½¢å¼ã€‚ä¾‹å¦‚ï¼š\na = 3.14e-2 # ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºçš„æµ®ç‚¹æ•°ï¼Œç­‰äº 0.0314 b = 1.23 # æ™®é€šçš„æµ®ç‚¹æ•° å¤æ•°ï¼ˆcomplexï¼‰æ˜¯å…·æœ‰å®éƒ¨å’Œè™šéƒ¨çš„æ•°å­—ï¼Œå¯ä»¥ä½¿ç”¨ a+bj æˆ– complex(a, b) çš„å½¢å¼è¡¨ç¤ºï¼Œå…¶ä¸­ j è¡¨ç¤ºè™šæ•°å•ä½ã€‚ä¾‹å¦‚ï¼š\na = 1+2j # å¤æ•° b = complex(3, 4) # å¤æ•°ï¼Œç­‰äº 3+4j å¸ƒå°”å€¼ï¼ˆboolï¼‰åªæœ‰ä¸¤ä¸ªå–å€¼ï¼ŒTrue å’Œ Falseï¼Œç”¨äºè¡¨ç¤ºçœŸå’Œå‡ã€‚åœ¨ Python ä¸­ï¼Œå¸ƒå°”å€¼å¯ä»¥å’Œæ•°å€¼è¿›è¡Œè¿ç®—ï¼ŒTrue è½¬æ¢ä¸º 1ï¼ŒFalse è½¬æ¢ä¸º 0ã€‚ä¾‹å¦‚ï¼š\na = True b = False c = 1 + True # c çš„å€¼ä¸º 2 d = 3 * False # d çš„å€¼ä¸º 0 æ•°å­—çš„æ“ä½œå’Œè¿ç®—ï¼š\næ•´æ•°é™¤æ³•ã€å–æ¨¡ã€å¹‚è¿ç®— åœ¨ Python ä¸­ï¼Œä½¿ç”¨ / è¿ç®—ç¬¦è¿›è¡Œé™¤æ³•è¿ç®—å¾—åˆ°çš„ç»“æœæ˜¯æµ®ç‚¹æ•°ï¼Œå¦‚æœæƒ³è¦å¾—åˆ°æ•´æ•°ç»“æœï¼Œå¯ä»¥ä½¿ç”¨ // è¿ç®—ç¬¦è¿›è¡Œæ•´æ•°é™¤æ³•è¿ç®—ã€‚ä¾‹å¦‚ï¼š\na = 7 / 2 # a çš„å€¼ä¸º 3.5 b = 7 // 2 # b çš„å€¼ä¸º 3 åŒæ—¶ï¼Œä½¿ç”¨ % è¿ç®—ç¬¦å¯ä»¥è¿›è¡Œå–æ¨¡è¿ç®—ï¼Œå³è®¡ç®—é™¤æ³•çš„ä½™æ•°ã€‚ä¾‹å¦‚ï¼š\nc = 7 % 2 # c çš„å€¼ä¸º 1 **æ˜¯ä¸€ç§è¿ç®—ç¬¦ï¼Œç§°ä¸ºâ€œåŒæ˜Ÿå·è¿ç®—ç¬¦â€æˆ–â€œå¹‚è¿ç®—ç¬¦â€ã€‚å®ƒå¯ä»¥ç”¨äºè®¡ç®—ä¸€ä¸ªæ•°çš„å¹‚ã€‚\nd = 2 ** 3 # è®¡ç®—2çš„3æ¬¡æ–¹ï¼Œç»“æœä¸º8 æ•°å­—ç±»å‹çš„è½¬æ¢ åœ¨ Python ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ int()ã€float() å’Œ complex() å‡½æ•°å°†å…¶ä»–ç±»å‹çš„æ•°æ®è½¬æ¢ä¸ºæ•´æ•°ã€æµ®ç‚¹æ•°å’Œå¤æ•°ç±»å‹ã€‚ä¾‹å¦‚ï¼š\na = int(\u0026#34;123\u0026#34;) # å°†å­—ç¬¦ä¸² \u0026#34;123\u0026#34; è½¬æ¢ä¸ºæ•´æ•°ç±»å‹ b = float(\u0026#34;3.14\u0026#34;) # å°†å­—ç¬¦ä¸² \u0026#34;3.14\u0026#34; è½¬æ¢ä¸ºæµ®ç‚¹æ•°ç±»å‹ c = complex(\u0026#34;1+2j\u0026#34;) # å°†å­—ç¬¦ä¸² \u0026#34;1+2j\u0026#34; è½¬æ¢ä¸ºå¤æ•°ç±»å‹ print(a, b, c) # 123 3.14 (1+2j) åŒæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ str()ã€repr() å’Œ format() å‡½æ•°å°†æ•°å­—è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹ã€‚ä¾‹å¦‚ï¼š\na = str(123) # å°†æ•´æ•° 123 è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹ b = repr(3.1415926) # å°†æµ®ç‚¹æ•° 3.1415926 è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œä½¿ç”¨ repr() å‡½æ•°å¯ä»¥ä¿ç•™å°æ•°ç‚¹åçš„ç²¾åº¦ c = \u0026#34;{:.2f}\u0026#34;.format(3.1415926) # å°†æµ®ç‚¹æ•° 3.1415926 è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œä¿ç•™å°æ•°ç‚¹åä¸¤ä½ print(a, b, c) # 123 3.1415926 3.14 éšæœºæ•°ç”Ÿæˆ åœ¨ Python ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ random æ¨¡å—ä¸­çš„å‡½æ•°ç”Ÿæˆéšæœºæ•°ã€‚å¸¸ç”¨çš„å‡½æ•°åŒ…æ‹¬ï¼š\nrandom.random()ï¼šç”Ÿæˆä¸€ä¸ª 0 åˆ° 1 ä¹‹é—´çš„éšæœºæµ®ç‚¹æ•°ã€‚ random.randint(a, b)ï¼šç”Ÿæˆä¸€ä¸ªåœ¨ a å’Œ b ä¹‹é—´ï¼ˆåŒ…æ‹¬ a å’Œ bï¼‰çš„éšæœºæ•´æ•°ã€‚ random.choice(seq)ï¼šä»åºåˆ— seq ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªå…ƒç´ å¹¶è¿”å›ã€‚ random.shuffle(seq)ï¼šå°†åºåˆ— seq ä¸­çš„å…ƒç´ éšæœºæ’åºã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ random æ¨¡å—ä¸­çš„ randint() å‡½æ•°ç”Ÿæˆä¸€ä¸ªéšæœºæ•´æ•°ï¼š\nimport random a = random.randint(1, 10) # ç”Ÿæˆä¸€ä¸ªåœ¨ 1 å’Œ 10 ä¹‹é—´çš„éšæœºæ•´æ•° print(a) å­—ç¬¦ä¸² åœ¨ Python ä¸­ï¼Œå­—ç¬¦ä¸²æ˜¯ä¸€ç§ä¸å¯å˜åºåˆ—ç±»å‹ ï¼Œç”¨äºè¡¨ç¤ºæ–‡æœ¬æ•°æ®ã€‚å­—ç¬¦ä¸²æ˜¯ç”±ä¸€ç³»åˆ— Unicode å­—ç¬¦ç»„æˆçš„ï¼Œå¯ä»¥åŒ…å«ä»»ä½•å­—ç¬¦ï¼ŒåŒ…æ‹¬å­—æ¯ã€æ•°å­—ã€æ ‡ç‚¹ç¬¦å·ã€ç©ºæ ¼ç­‰ã€‚\nå®šä¹‰å­—ç¬¦ä¸²å¯ä»¥ä½¿ç”¨ å•å¼•å·ã€åŒå¼•å·æˆ–ä¸‰å¼•å·ã€‚ä¾‹å¦‚ï¼š\nstr1 = \u0026#39;Hello, world!\u0026#39; str2 = \u0026#34;Hello, Python!\u0026#34; str3 = \u0026#34;\u0026#34;\u0026#34;This is a long string that spans multiple lines.\u0026#34;\u0026#34;\u0026#34; å­—ç¬¦ä¸²æ”¯æŒä¸€äº›å¸¸ç”¨çš„æ“ä½œï¼Œä¾‹å¦‚ï¼š\næ‹¼æ¥å­—ç¬¦ä¸²ï¼šä½¿ç”¨åŠ å·ï¼ˆ+ï¼‰è¿ç®—ç¬¦\nstr4 = str1 + \u0026#39; \u0026#39; + str2 # str4 = \u0026#39;Hello, world! Hello, Python!\u0026#39; è®¿é—®å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ï¼šä½¿ç”¨ ä¸‹æ ‡ï¼ˆç´¢å¼•ï¼‰è¿ç®—ç¬¦æˆ–åˆ‡ç‰‡è¿ç®—ç¬¦\nch = str1[0] # ch = \u0026#39;H\u0026#39; substr = str2[7:13] # substr = \u0026#39;Python\u0026#39; è·å–å­—ç¬¦ä¸²çš„é•¿åº¦ï¼šä½¿ç”¨ len() å‡½æ•°\nlength = len(str3) # length = 45 æŸ¥æ‰¾å­å­—ç¬¦ä¸²ï¼šä½¿ç”¨ find() æˆ– index() å‡½æ•°\npos1 = str1.find(\u0026#39;world\u0026#39;) # pos1 = 7 pos2 = str2.index(\u0026#39;Python\u0026#39;) # pos2 = 7 æ›¿æ¢å­å­—ç¬¦ä¸²ï¼šä½¿ç”¨ replace() å‡½æ•°\nnew_str = str1.replace(\u0026#39;world\u0026#39;, \u0026#39;Python\u0026#39;) # new_str = \u0026#39;Hello, Python!\u0026#39; åˆ†å‰²å­—ç¬¦ä¸²ï¼šä½¿ç”¨ split() å‡½æ•°\nwords = str3.split() # words = [\u0026#39;This\u0026#39;, \u0026#39;is\u0026#39;, \u0026#39;a\u0026#39;, \u0026#39;long\u0026#39;, \u0026#39;string\u0026#39;, \u0026#39;that\u0026#39;, \u0026#39;spans\u0026#39;, \u0026#39;multiple\u0026#39;, \u0026#39;lines.\u0026#39;] è¿æ¥å­—ç¬¦ä¸²åˆ—è¡¨ï¼šä½¿ç”¨ join() å‡½æ•°\nnew_str = \u0026#39;-\u0026#39;.join(words) # new_str = \u0026#39;This-is-a-long-string-that-spans-multiple-lines.\u0026#39; åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦åŒ…å«æŸä¸ªå­å­—ç¬¦ä¸²ï¼šä½¿ç”¨ in æˆ– not in è¿ç®—ç¬¦\nflag1 = \u0026#39;world\u0026#39; in str1 # flag1 = True flag2 = \u0026#39;Python\u0026#39; not in str2 # flag2 = False åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä»¥æŸä¸ªå­å­—ç¬¦ä¸²å¼€å¤´æˆ–ç»“å°¾ï¼šä½¿ç”¨ startswith() å’Œ endswith() æ–¹æ³•\nflag3 = str1.startswith(\u0026#39;Hello\u0026#39;) # flag3 = True flag4 = str2.endswith(\u0026#39;!\u0026#39;) # flag4 = True å¤§å°å†™è½¬æ¢ï¼šä½¿ç”¨ upper() å’Œ lower() æ–¹æ³•\nupper_str = str1.upper() # upper_str = \u0026#39;HELLO, WORLD!\u0026#39; lower_str = str2.lower() # lower_str = \u0026#39;hello, python!\u0026#39; å»é™¤å­—ç¬¦ä¸²ä¸¤ç«¯çš„ç©ºç™½å­—ç¬¦ï¼šä½¿ç”¨ strip()ã€lstrip() å’Œ rstrip() æ–¹æ³•\nstr5 = \u0026#39; Hello, Python! \u0026#39; new_str1 = str5.strip() # new_str1 = \u0026#39;Hello, Python!\u0026#39; new_str2 = str5.lstrip() # new_str2 = \u0026#39;Hello, Python! \u0026#39; new_str3 = str5.rstrip() # new_str3 = \u0026#39; Hello, Python!\u0026#39; å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—ç±»å‹ï¼šä½¿ç”¨ int()ã€float() æˆ– complex() å‡½æ•°\nnum1 = int(\u0026#39;123\u0026#39;) # num1 = 123 num2 = float(\u0026#39;3.14\u0026#39;) # num2 = 3.14 num3 = complex(\u0026#39;1+2j\u0026#39;) # num3 = (1+2j) åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦å…¨éƒ¨ç”±æ•°å­—ç»„æˆï¼šä½¿ç”¨ isnumeric() æ–¹æ³•\nstr6 = \u0026#39;123456\u0026#39; flag5 = str6.isnumeric() # flag5 = True åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦å…¨éƒ¨ç”±å­—æ¯ç»„æˆï¼šä½¿ç”¨ isalpha() æ–¹æ³•\nstr7 = \u0026#39;HelloWorld\u0026#39; flag6 = str7.isalpha() # flag6 = True åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦å…¨éƒ¨ç”±å­—æ¯å’Œæ•°å­—ç»„æˆï¼šä½¿ç”¨ isalnum() æ–¹æ³•\nstr8 = \u0026#39;Hello123\u0026#39; flag7 = str8.isalnum() # flag7 = True è®¡ç®—å­—ç¬¦ä¸²ä¸­æŸä¸ªå­—ç¬¦å‡ºç°çš„æ¬¡æ•°ï¼šä½¿ç”¨ count() æ–¹æ³•\nstr9 = \u0026#39;Hello, Python!\u0026#39; count = str9.count(\u0026#39;o\u0026#39;) # count = 2 å°†å­—ç¬¦ä¸²æŒ‰æŒ‡å®šçš„å®½åº¦è¿›è¡Œå¯¹é½ï¼šä½¿ç”¨ ljust()ã€rjust() å’Œ center() æ–¹\nstr10 = \u0026#39;Hello\u0026#39; new_str4 = str10.ljust(10) # new_str4 = \u0026#39;Hello \u0026#39; new_str5 = str10.rjust(10) # new_str5 = \u0026#39; Hello\u0026#39; new_str6 = str10.center(10) # new_str6 = \u0026#39; Hello \u0026#39; å°†å­—ç¬¦ä¸²ä¸­çš„æŸä¸ªå­å­—ç¬¦ä¸²æ›¿æ¢ä¸ºå¦ä¸€ä¸ªå­—ç¬¦ä¸²ï¼šä½¿ç”¨ translate() æ–¹æ³•\nstr11 = \u0026#39;Hello, Python!\u0026#39; table = str.maketrans(\u0026#39;lo\u0026#39;, \u0026#39;12\u0026#39;) new_str7 = str11.translate(table) # new_str7 = \u0026#39;He22, Pyth2n!\u0026#39; è¿™æ®µä»£ç ä½¿ç”¨äº†å­—ç¬¦ä¸²çš„ translate() æ–¹æ³•ï¼Œç”¨äºå°†å­—ç¬¦ä¸²ä¸­çš„æŸä¸ªå­å­—ç¬¦ä¸²æ›¿æ¢ä¸ºå¦ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒçš„ä½œç”¨æ˜¯å°†å­—ç¬¦ä¸² str11 ä¸­çš„æ‰€æœ‰å­—ç¬¦ \u0026rsquo;l\u0026rsquo; æ›¿æ¢ä¸º \u0026lsquo;1\u0026rsquo;ï¼Œå°†æ‰€æœ‰å­—ç¬¦ \u0026lsquo;o\u0026rsquo; æ›¿æ¢ä¸º \u0026lsquo;2\u0026rsquo;ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸² new_str7ã€‚\nè¿™é‡Œç”¨åˆ°äº† str.maketrans() æ–¹æ³•ï¼Œå®ƒç”¨äºç”Ÿæˆä¸€ä¸ªè½¬æ¢è¡¨ï¼Œå°†å­—ç¬¦ä¸²ä¸­çš„æŸäº›å­—ç¬¦è½¬æ¢ä¸ºå…¶ä»–å­—ç¬¦ã€‚è¿™ä¸ªæ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸¤ä¸ªå‚æ•°éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯éœ€è¦è¢«æ›¿æ¢çš„å­—ç¬¦ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ›¿æ¢ä¸ºçš„å­—ç¬¦ã€‚ç”Ÿæˆçš„è½¬æ¢è¡¨å¯ä»¥ç”¨äºå­—ç¬¦ä¸²çš„ translate() æ–¹æ³•ã€‚\nå…·ä½“æ¥è¯´ï¼Œè¿™é‡Œçš„ä»£ç ä½¿ç”¨ str.maketrans(\u0026rsquo;lo\u0026rsquo;, \u0026lsquo;12\u0026rsquo;) ç”Ÿæˆäº†ä¸€ä¸ªè½¬æ¢è¡¨ï¼Œå°†å­—ç¬¦ \u0026rsquo;l\u0026rsquo; è½¬æ¢ä¸º \u0026lsquo;1\u0026rsquo;ï¼Œå°†å­—ç¬¦ \u0026lsquo;o\u0026rsquo; è½¬æ¢ä¸º \u0026lsquo;2\u0026rsquo;ã€‚ç„¶åä½¿ç”¨ translate() æ–¹æ³•å°†å­—ç¬¦ä¸² str11 ä¸­çš„å­—ç¬¦æŒ‰ç…§è½¬æ¢è¡¨è¿›è¡Œæ›¿æ¢ï¼Œç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸² new_str7ï¼Œå®ƒçš„å€¼ä¸º \u0026lsquo;He22, Pyth2n!\u0026rsquo;ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§å­—ç¬¦ä¸²çš„æ›¿æ¢æ–¹å¼åªæ˜¯æŒ‰ç…§å­—ç¬¦è¿›è¡Œæ›¿æ¢ï¼Œä¸æ˜¯æŒ‰ç…§å­å­—ç¬¦ä¸²è¿›è¡Œæ›¿æ¢ã€‚å¦‚æœéœ€è¦æŒ‰ç…§å­å­—ç¬¦ä¸²è¿›è¡Œæ›¿æ¢ï¼Œå¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²çš„ replace() æ–¹æ³•ã€‚\nå°†å­—ç¬¦ä¸²ä»å·¦ä¾§æˆ–å³ä¾§å¡«å……æŒ‡å®šçš„å­—ç¬¦ï¼šä½¿ç”¨ lstrip() å’Œ rstrip() æ–¹æ³•\nstr12 = \u0026#39;Hello\u0026#39; new_str8 = str12.lstrip(\u0026#39;H\u0026#39;) # new_str8 = \u0026#39;ello\u0026#39; new_str9 = str12.rstrip(\u0026#39;o\u0026#39;) # new_str9 = \u0026#39;Hell\u0026#39; Python ä¸­å­—ç¬¦ä¸²çš„çŸ¥è¯†ç‚¹è¿˜æœ‰å¾ˆå¤šï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š\næ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼šPython 3.6 ä»¥åçš„ç‰ˆæœ¬æ”¯æŒ f-stringï¼Œå¯ä»¥åœ¨å­—ç¬¦ä¸²ä¸­ç›´æ¥ä½¿ç”¨è¡¨è¾¾å¼å’Œå˜é‡ï¼Œéå¸¸æ–¹ä¾¿ã€‚ä¾‹å¦‚ï¼š\nname = \u0026#39;John\u0026#39; age = 25 greeting = f\u0026#39;My name is {name}, and I am {age} years old.\u0026#39; # greeting = \u0026#39;My name is John, and I am 25 years old.\u0026#39; å­—ç¬¦ä¸²çš„æ ¼å¼åŒ–è¾“å‡ºï¼šPython ä¸­çš„ format() æ–¹æ³•å¯ä»¥å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ ¼å¼åŒ–è¾“å‡ºï¼Œæ”¯æŒå„ç§æ ¼å¼æ§åˆ¶ç¬¦å’Œå ä½ç¬¦ã€‚ä¾‹å¦‚ï¼š\npi = 3.141592653589793 print(\u0026#39;pi = {:.2f}\u0026#39;.format(pi)) # è¾“å‡º \u0026#39;pi = 3.14\u0026#39; æ­£åˆ™è¡¨è¾¾å¼ï¼šPython ä¸­å†…ç½®äº† re æ¨¡å—ï¼Œå¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œå­—ç¬¦ä¸²åŒ¹é…å’Œæ›¿æ¢æ“ä½œï¼Œéå¸¸å¼ºå¤§ã€‚ä¾‹å¦‚ï¼š\nimport re str13 = \u0026#39;Hello, world!\u0026#39; pattern = r\u0026#39;w\\w+\u0026#39; match = re.search(pattern, str13) if match: print(match.group()) # è¾“å‡º \u0026#39;world\u0026#39; å­—ç¬¦ä¸²çš„ç¼–ç å’Œè§£ç ï¼šPython ä¸­çš„å­—ç¬¦ä¸²æ˜¯ Unicode å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä½¿ç”¨ encode() æ–¹æ³•å°†å­—ç¬¦ä¸²ç¼–ç æˆå­—èŠ‚ä¸²ï¼Œä½¿ç”¨ decode() æ–¹æ³•å°†å­—èŠ‚ä¸²è§£ç æˆå­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼š\nstr14 = \u0026#39;ä½ å¥½ï¼Œä¸–ç•Œï¼\u0026#39; utf8_bytes = str14.encode(\u0026#39;utf-8\u0026#39;) gb2312_bytes = str14.encode(\u0026#39;gb2312\u0026#39;) utf8_str = utf8_bytes.decode(\u0026#39;utf-8\u0026#39;) gb2312_str = gb2312_bytes.decode(\u0026#39;gb2312\u0026#39;) å­—ç¬¦ä¸²çš„æ¯”è¾ƒå’Œæ’åºï¼šPython ä¸­çš„å­—ç¬¦ä¸²å¯ä»¥è¿›è¡Œæ¯”è¾ƒå’Œæ’åºæ“ä½œï¼Œä½¿ç”¨çš„æ˜¯æŒ‰ç…§ Unicode ç ç‚¹è¿›è¡Œæ¯”è¾ƒå’Œæ’åºçš„è§„åˆ™ã€‚ä¾‹å¦‚ï¼š\nstr_list = [\u0026#39;world\u0026#39;, \u0026#39;hello\u0026#39;, \u0026#39;Python\u0026#39;, \u0026#39;java\u0026#39;] str_list.sort() print(str_list) # è¾“å‡º [\u0026#39;Python\u0026#39;, \u0026#39;hello\u0026#39;, \u0026#39;java\u0026#39;, \u0026#39;world\u0026#39;] # å¯¹åˆ—è¡¨è¿›è¡Œé™åºæ’åº str_list.sort(reverse=True) print(str_list) # è¾“å‡º [\u0026#39;world\u0026#39;, \u0026#39;java\u0026#39;, \u0026#39;hello\u0026#39;, \u0026#39;Python\u0026#39;] è¿™æ®µä»£ç ç”¨äºå¯¹ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨è¿›è¡Œæ’åºï¼Œå®ƒä½¿ç”¨äº†åˆ—è¡¨çš„ sort() æ–¹æ³•ï¼Œå°†åˆ—è¡¨ä¸­çš„å…ƒç´ æŒ‰ç…§ä¸€å®šçš„è§„åˆ™è¿›è¡Œæ’åºã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒçš„ä½œç”¨æ˜¯å°†å­—ç¬¦ä¸²åˆ—è¡¨ str_list æŒ‰ç…§å­—å…¸åºè¿›è¡Œå‡åºæ’åºï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„æ’åºåçš„åˆ—è¡¨ã€‚\nåœ¨ Python ä¸­ï¼Œå­—ç¬¦ä¸²æ˜¯å¯ä»¥è¿›è¡Œæ¯”è¾ƒæ“ä½œçš„ï¼Œæ¯”è¾ƒçš„è§„åˆ™æ˜¯æŒ‰ç…§ Unicode ç ç‚¹è¿›è¡Œæ¯”è¾ƒã€‚å› æ­¤ï¼Œå¯¹äºå­—ç¬¦ä¸²åˆ—è¡¨çš„æ’åºï¼Œå®é™…ä¸Šå°±æ˜¯æŒ‰ç…§å­—ç¬¦ä¸²çš„å­—å…¸åºè¿›è¡Œæ’åºã€‚å…·ä½“æ¥è¯´ï¼Œå¯¹äºä¸¤ä¸ªå­—ç¬¦ä¸² s1 å’Œ s2ï¼ŒæŒ‰ç…§å­—å…¸åºè¿›è¡Œæ¯”è¾ƒçš„è§„åˆ™æ˜¯ï¼š\nå¦‚æœ s1 åœ¨ s2 çš„å‰é¢ï¼Œåˆ™ s1 \u0026lt; s2ï¼› å¦‚æœ s1 åœ¨ s2 çš„åé¢ï¼Œåˆ™ s1 \u0026gt; s2ï¼› å¦‚æœ s1 å’Œ s2 ç›¸ç­‰ï¼Œåˆ™ s1 == s2ã€‚ å› æ­¤ï¼Œå¯¹äºè¿™æ®µä»£ç ä¸­çš„å­—ç¬¦ä¸²åˆ—è¡¨ str_listï¼Œå®ƒçš„æ’åºç»“æœä¸º [\u0026lsquo;Python\u0026rsquo;, \u0026lsquo;hello\u0026rsquo;, \u0026lsquo;java\u0026rsquo;, \u0026lsquo;world\u0026rsquo;]ï¼Œå…¶ä¸­ \u0026lsquo;Python\u0026rsquo; åœ¨å­—å…¸åºä¸­æ’åœ¨æœ€å‰é¢ï¼Œ\u0026lsquo;world\u0026rsquo; åœ¨å­—å…¸åºä¸­æ’åœ¨æœ€åé¢ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆ—è¡¨çš„ sort() æ–¹æ³•ä¼šç›´æ¥ä¿®æ”¹åŸæœ‰çš„åˆ—è¡¨ï¼Œå¦‚æœä¸æƒ³ä¿®æ”¹åŸæœ‰åˆ—è¡¨ï¼Œå¯ä»¥ä½¿ç”¨ sorted() å‡½æ•°ã€‚ä¾‹å¦‚ï¼š\nstr_list = [\u0026#39;world\u0026#39;, \u0026#39;hello\u0026#39;, \u0026#39;Python\u0026#39;, \u0026#39;java\u0026#39;] new_str_list = sorted(str_list) print(new_str_list) # è¾“å‡º [\u0026#39;Python\u0026#39;, \u0026#39;hello\u0026#39;, \u0026#39;java\u0026#39;, \u0026#39;world\u0026#39;] # å¯¹åˆ—è¡¨ç”Ÿæˆå™¨è¿›è¡Œé™åºæ’åº new_str_list = sorted(str_list, reverse=True) print(new_str_list) # è¾“å‡º [\u0026#39;world\u0026#39;, \u0026#39;java\u0026#39;, \u0026#39;hello\u0026#39;, \u0026#39;Python\u0026#39;] è¿™æ ·åšå¯ä»¥ç”Ÿæˆä¸€ä¸ªæ–°çš„æ’åºåçš„åˆ—è¡¨ï¼Œä¸ä¼šä¿®æ”¹åŸæœ‰çš„åˆ—è¡¨ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºå­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼Œå› æ­¤å¯¹å­—ç¬¦ä¸²è¿›è¡Œä¿®æ”¹ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ã€‚\nåˆ—è¡¨ åœ¨ Python ä¸­ï¼Œåˆ—è¡¨ï¼ˆlistï¼‰æ˜¯ä¸€ç§å¯å˜åºåˆ—ç±»å‹ï¼Œç”¨äºå­˜å‚¨ä¸€ç»„æœ‰åºçš„å…ƒç´ ã€‚åˆ—è¡¨ä¸­çš„å…ƒç´ å¯ä»¥æ˜¯ä»»æ„ç±»å‹çš„æ•°æ®ï¼ŒåŒ…æ‹¬æ•°å­—ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ã€åˆ—è¡¨ã€å…ƒç»„ã€å­—å…¸ç­‰ã€‚åˆ—è¡¨ä½¿ç”¨æ–¹æ‹¬å· [] è¡¨ç¤ºï¼Œå…ƒç´ ä¹‹é—´ä½¿ç”¨é€—å·åˆ†éš”ã€‚ä¾‹å¦‚ï¼š\nmy_list = [1, 2, \u0026#34;hello\u0026#34;, True, [3, 4, 5], {\u0026#34;name\u0026#34;: \u0026#34;Alice\u0026#34;, \u0026#34;age\u0026#34;: 20}] åˆ—è¡¨ä¸­çš„å…ƒç´ å¯ä»¥é€šè¿‡ç´¢å¼•ï¼ˆä¸‹æ ‡ï¼‰è¿›è¡Œè®¿é—®å’Œä¿®æ”¹ã€‚åˆ—è¡¨çš„ç´¢å¼•ä» 0 å¼€å§‹ï¼Œå¯ä»¥ä½¿ç”¨æ­£æ•´æ•°å’Œè´Ÿæ•´æ•°æ¥è¡¨ç¤ºã€‚æ­£æ•´æ•°è¡¨ç¤ºä»å·¦å¾€å³æ•°çš„ç´¢å¼•ï¼Œè´Ÿæ•´æ•°è¡¨ç¤ºä»å³å¾€å·¦æ•°çš„ç´¢å¼•ï¼Œä¾‹å¦‚ï¼š\nmy_list = [1, 2, 3, 4, 5] print(my_list[0]) # è¾“å‡º 1ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ä¸º 0 print(my_list[-1]) # è¾“å‡º 5ï¼Œæœ€åä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ä¸º -1 å¯ä»¥ä½¿ç”¨åˆ‡ç‰‡è¿ç®—ç¬¦ : æ¥è·å–åˆ—è¡¨çš„å­åˆ—è¡¨ã€‚åˆ‡ç‰‡è¿ç®—ç¬¦è¡¨ç¤ºä»èµ·å§‹ç´¢å¼•åˆ°ç»ˆæ­¢ç´¢å¼•ä¹‹é—´çš„æ‰€æœ‰å…ƒç´ ï¼Œä¸åŒ…æ‹¬ç»ˆæ­¢ç´¢å¼•å¯¹åº”çš„å…ƒç´ ã€‚ä¾‹å¦‚ï¼š\nmy_list = [1, 2, 3, 4, 5] print(my_list[1:3]) # è¾“å‡º [2, 3] print(my_list[:3]) # è¾“å‡º [1, 2, 3] print(my_list[3:]) # è¾“å‡º [4, 5] åˆ—è¡¨æ˜¯ä¸€ç§å¯å˜ç±»å‹ï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•å’Œåˆ‡ç‰‡æ“ä½œæ¥ä¿®æ”¹åˆ—è¡¨ä¸­çš„å…ƒç´ ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨åˆ—è¡¨çš„æ–¹æ³•æ¥æ·»åŠ ã€åˆ é™¤å’Œä¿®æ”¹å…ƒç´ ã€‚å¸¸ç”¨çš„åˆ—è¡¨æ–¹æ³•åŒ…æ‹¬ï¼š\nappend(x)ï¼šåœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ å…ƒç´  xã€‚ insert(i, x)ï¼šåœ¨åˆ—è¡¨çš„ç¬¬ i ä¸ªä½ç½®æ’å…¥å…ƒç´  xã€‚ extend(iterable)ï¼šåœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ å¯è¿­ä»£å¯¹è±¡ iterable ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚ remove(x)ï¼šåˆ é™¤åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªå€¼ä¸º x çš„å…ƒç´ ã€‚ pop([i])ï¼šåˆ é™¤åˆ—è¡¨ä¸­ç´¢å¼•ä¸º i çš„å…ƒç´ ï¼Œå¹¶è¿”å›è¯¥å…ƒç´ çš„å€¼ã€‚å¦‚æœçœç•¥ iï¼Œåˆ™é»˜è®¤åˆ é™¤æœ€åä¸€ä¸ªå…ƒç´ ã€‚ clear()ï¼šåˆ é™¤åˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚ index(x)ï¼šè¿”å›åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªå€¼ä¸º x çš„å…ƒç´ çš„ç´¢å¼•ã€‚å¦‚æœåˆ—è¡¨ä¸­ä¸å­˜åœ¨å€¼ä¸º x çš„å…ƒç´ ï¼Œåˆ™æŠ›å‡º ValueError å¼‚å¸¸ã€‚ count(x)ï¼šè¿”å›åˆ—è¡¨ä¸­å€¼ä¸º x çš„å…ƒç´ çš„ä¸ªæ•°ã€‚ sort()ï¼šå¯¹åˆ—è¡¨ä¸­çš„å…ƒç´ è¿›è¡Œæ’åºã€‚é»˜è®¤æŒ‰ç…§å‡åºæ’åˆ—ï¼Œå¯ä»¥ä½¿ç”¨ reverse=True å‚æ•°è¿›è¡Œé™åºæ’åˆ—ã€‚ reverse()ï¼šå°†åˆ—è¡¨ä¸­çš„å…ƒç´ åè½¬ã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ append() æ–¹æ³•å‘åˆ—è¡¨ä¸­æ·»åŠ å…ƒç´ ï¼š\nmy_list = [1, 2, 3] my_list.append(4) print(my_list) # è¾“å‡º [1, 2, 3, 4] éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆ—è¡¨æ˜¯ä¸€ç§å¯å˜ç±»å‹ï¼Œä¿®æ”¹ä¸€ä¸ªåˆ—è¡¨ä¼šå½±å“åˆ°æ‰€æœ‰å¼•ç”¨è¯¥åˆ—è¡¨çš„å˜é‡ã€‚å¦‚æœéœ€è¦å¤åˆ¶ä¸€ä¸ªåˆ—è¡¨å¹¶ç‹¬ç«‹ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ copy() æ–¹æ³•æˆ–åˆ‡ç‰‡è¿ç®—ç¬¦è¿›è¡Œå¤åˆ¶ã€‚ä¾‹å¦‚ï¼š\nmy_list = [1, 2, 3] new_list = my_list.copy() # å¤åˆ¶ä¸€ä¸ªæ–°çš„åˆ—è¡¨ new_list.append(4) print(my_list) # è¾“å‡º [1, 2, 3] print(new_list) # è¾“å‡º [1, 2, 3, 4] é™¤äº†ä¸Šé¢æåˆ°çš„åŸºæœ¬æ“ä½œå’Œå¸¸ç”¨æ–¹æ³•ï¼ŒPython åˆ—è¡¨è¿˜æœ‰ä¸€äº›å…¶ä»–çš„ç‰¹æ€§å’Œç”¨æ³•ï¼Œå¦‚ä¸‹ï¼š\nåˆ—è¡¨æ¨å¯¼å¼ åˆ—è¡¨æ¨å¯¼å¼ï¼ˆlist comprehensionï¼‰æ˜¯ä¸€ç§å¿«é€Ÿåˆ›å»ºåˆ—è¡¨çš„æ–¹å¼ã€‚åˆ—è¡¨æ¨å¯¼å¼ç”±ä¸€å¯¹æ–¹æ‹¬å·å’Œä¸€ä¸ªè¡¨è¾¾å¼æ„æˆï¼Œè¡¨è¾¾å¼å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå¾ªç¯å’Œæ¡ä»¶è¯­å¥ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„åˆ—è¡¨æ¨å¯¼å¼ç”Ÿæˆäº†ä¸€ä¸ªåŒ…å« 1 åˆ° 10 çš„å¹³æ–¹å€¼çš„åˆ—è¡¨ï¼š\nsquares = [x ** 2 for x in range(1, 11)] print(squares) # è¾“å‡º [1, 4, 9, 16, 25, 36, 49, 64, 81, 100] zip() å‡½æ•° zip() å‡½æ•°ç”¨äºå°†å¤šä¸ªåˆ—è¡¨ä¸­å¯¹åº”ä½ç½®çš„å…ƒç´ åˆå¹¶æˆå…ƒç»„ã€‚zip() å‡½æ•°è¿”å›ä¸€ä¸ª zip å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ tuple() å‡½æ•°å°†å…¶è½¬æ¢ä¸ºå…ƒç»„åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼š\nnames = [\u0026#34;Alice\u0026#34;, \u0026#34;Bob\u0026#34;, \u0026#34;Charlie\u0026#34;] ages = [20, 25, 30] zipped = zip(names, ages) print(list(zipped)) # è¾“å‡º [(\u0026#39;Alice\u0026#39;, 20), (\u0026#39;Bob\u0026#39;, 25), (\u0026#39;Charlie\u0026#39;, 30)] åˆ—è¡¨çš„å¤åˆ¶å’Œæµ…æ‹·è´ å½“ä½¿ç”¨èµ‹å€¼è¯­å¥å°†ä¸€ä¸ªåˆ—è¡¨èµ‹å€¼ç»™å¦ä¸€ä¸ªå˜é‡æ—¶ï¼Œå®é™…ä¸Šæ˜¯å°†è¯¥åˆ—è¡¨çš„å¼•ç”¨èµ‹å€¼ç»™äº†æ–°å˜é‡ï¼Œä¸¤ä¸ªå˜é‡æŒ‡å‘åŒä¸€ä¸ªåˆ—è¡¨å¯¹è±¡ã€‚å¦‚æœä¿®æ”¹å…¶ä¸­ä¸€ä¸ªå˜é‡å¯¹åº”çš„åˆ—è¡¨ï¼Œå¦ä¸€ä¸ªå˜é‡ä¹Ÿä¼šå—åˆ°å½±å“ã€‚ä¾‹å¦‚ï¼š\na = [1, 2, 3] b = a b.append(4) print(a) # è¾“å‡º [1, 2, 3, 4] print(b) # è¾“å‡º [1, 2, 3, 4] ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ copy() æ–¹æ³•æˆ–åˆ‡ç‰‡è¿ç®—ç¬¦è¿›è¡Œå¤åˆ¶ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§å¤åˆ¶æ–¹å¼åªæ˜¯è¿›è¡Œäº†æµ…æ‹·è´ï¼Œå³åªå¤åˆ¶äº†åˆ—è¡¨ä¸­çš„å…ƒç´ çš„å¼•ç”¨ï¼Œè€Œä¸æ˜¯å…ƒç´ æœ¬èº«ã€‚å¦‚æœåˆ—è¡¨ä¸­çš„å…ƒç´ æ˜¯å¯å˜å¯¹è±¡ï¼ˆå¦‚åˆ—è¡¨ã€å­—å…¸ç­‰ï¼‰ï¼Œä¿®æ”¹å…¶ä¸­ä¸€ä¸ªå…ƒç´ çš„å€¼ä¼šå½±å“åˆ°æ‰€æœ‰å¼•ç”¨è¯¥å…ƒç´ çš„å˜é‡ã€‚ä¾‹å¦‚ï¼š\na = [[1, 2], [3, 4]] b = a.copy() b[0].append(3) print(a) # è¾“å‡º [[1, 2, 3], [3, 4]] print(b) # è¾“å‡º [[1, 2, 3], [3, 4]] å¯ä»¥çœ‹åˆ°ï¼Œä¿®æ”¹ b ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¹Ÿå½±å“åˆ°äº† a ä¸­çš„å…ƒç´ ã€‚å¦‚æœéœ€è¦å®Œå…¨ç‹¬ç«‹çš„å¤åˆ¶ä¸€ä¸ªåˆ—è¡¨ï¼Œéœ€è¦ä½¿ç”¨æ·±æ‹·è´ï¼ˆdeep copyï¼‰æ–¹å¼ï¼Œå¯ä»¥ä½¿ç”¨ copy æ¨¡å—ä¸­çš„ deepcopy() å‡½æ•°ã€‚ä¾‹å¦‚ï¼š\nimport copy a = [[1, 2], [3, 4]] b = copy.deepcopy(a) b[0].append(3) print(a) # è¾“å‡º [[1, 2], [3, 4]] print(b) # è¾“å‡º [[1, 2, 3], [3, 4]] åˆ—è¡¨è§£åŒ… åˆ—è¡¨è§£åŒ…ï¼ˆlist unpackingï¼‰æ˜¯ä¸€ç§å¿«é€Ÿå°†åˆ—è¡¨ä¸­çš„å…ƒç´ åˆ†åˆ«èµ‹å€¼ç»™å¤šä¸ªå˜é‡çš„æ–¹å¼ã€‚åˆ—è¡¨è§£åŒ…ä½¿ç”¨ä¸€å¯¹æ–¹æ‹¬å·å’Œå¤šä¸ªå˜é‡åæ„æˆï¼Œå˜é‡åä¹‹é—´ä½¿ç”¨é€—å·åˆ†éš”ã€‚ä¾‹å¦‚ï¼š\nmy_list = [1, 2, 3] a, b, c = my_list print(a, b, c) # è¾“å‡º 1 2 3 åˆ—è¡¨çš„åˆ¤æ–­å’Œæ¯”è¾ƒ å¯ä»¥ä½¿ç”¨ in å’Œ not in è¿ç®—ç¬¦åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨åˆ—è¡¨ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ == å’Œ != è¿ç®—ç¬¦æ¯”è¾ƒä¸¤ä¸ªåˆ—è¡¨æ˜¯å¦ç›¸ç­‰ã€‚ä¾‹å¦‚ï¼š\nmy_list = [1, 2, 3] print(2 in my_list) # è¾“å‡º True print(4 not in my_list) # è¾“å‡º True other_list = [1, 2, 3] print(my_list == other_list) # è¾“å‡º True print(my_list is other_list) # è¾“å‡º Falseï¼Œä¸¤ä¸ªåˆ—è¡¨ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆ—è¡¨çš„æ¯”è¾ƒæ˜¯æŒ‰ç…§å…ƒç´ çš„é¡ºåºå’Œå€¼è¿›è¡Œçš„ï¼Œå¦‚æœä¸¤ä¸ªåˆ—è¡¨åŒ…å«ç›¸åŒçš„å…ƒç´ ä½†é¡ºåºä¸åŒï¼Œåˆ™å®ƒä»¬ä¸ç›¸ç­‰ã€‚ä¾‹å¦‚ï¼š\na = [1, 2, 3] b = [3, 2, 1] print(a == b) # è¾“å‡º False åˆ—è¡¨çš„è¿­ä»£å’Œç”Ÿæˆå™¨ å¯ä»¥ä½¿ç”¨ for å¾ªç¯å¯¹åˆ—è¡¨è¿›è¡Œè¿­ä»£ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åˆ—è¡¨æ¨å¯¼å¼æˆ–ç”Ÿæˆå™¨è¡¨è¾¾å¼ç”Ÿæˆä¸€ä¸ªç”Ÿæˆå™¨ï¼ˆgeneratorï¼‰ã€‚ç”Ÿæˆå™¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¿­ä»£å™¨ï¼Œå¯ä»¥é€ä¸ªäº§ç”Ÿåˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½æ•´ä¸ªåˆ—è¡¨åˆ°å†…å­˜ä¸­ã€‚ä¾‹å¦‚ï¼š\nmy_list = [1, 2, 3, 4, 5] # åˆ—è¡¨è¿­ä»£ for x in my_list: print(x) # ç”Ÿæˆå™¨è¡¨è¾¾å¼ gen = (x ** 2 for x in my_list) for x in gen: print(x) åˆ—è¡¨çš„é«˜çº§æ’åº é™¤äº† sort() æ–¹æ³•ä¹‹å¤–ï¼ŒPython è¿˜æä¾›äº†ä¸€äº›é«˜çº§çš„æ’åºæ–¹æ³•ï¼Œå¦‚ sorted() å‡½æ•°å’Œ sort() æ–¹æ³•çš„ key å‚æ•°å’Œ cmp å‚æ•°ã€‚sorted() å‡½æ•°å¯ä»¥å¯¹ä»»æ„å¯è¿­ä»£å¯¹è±¡è¿›è¡Œæ’åºï¼Œè¿”å›ä¸€ä¸ªæ–°çš„æœ‰åºåˆ—è¡¨ã€‚key å‚æ•°æŒ‡å®šä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œæ’åºï¼Œcmp å‚æ•°å¯ä»¥æŒ‡å®šä¸€ä¸ªæ¯”è¾ƒå‡½æ•°ï¼Œç”¨äºæ¯”è¾ƒä¸¤ä¸ªå…ƒç´ ã€‚ä¾‹å¦‚ï¼š\nmy_list = [\u0026#34;apple\u0026#34;, \u0026#34;banana\u0026#34;, \u0026#34;orange\u0026#34;, \u0026#34;grape\u0026#34;] # æŒ‰ç…§å­—ç¬¦ä¸²é•¿åº¦æ’åº sorted_list = sorted(my_list, key=len) print(sorted_list) # è¾“å‡º [\u0026#39;apple\u0026#39;, \u0026#39;grape\u0026#39;, \u0026#39;banana\u0026#39;, \u0026#39;orange\u0026#39;] # æŒ‰ç…§å­—æ¯é¡ºåºæ’åº my_list.sort(key=str.lower) print(my_list) # è¾“å‡º [\u0026#39;apple\u0026#39;, \u0026#39;banana\u0026#39;, \u0026#39;grape\u0026#39;, \u0026#39;orange\u0026#39;] å…ƒç»„ åœ¨ Python ä¸­ï¼Œå…ƒç»„ï¼ˆtupleï¼‰æ˜¯ä¸€ç§ä¸å¯å˜çš„åºåˆ—ç±»å‹ï¼Œç”¨äºå­˜å‚¨ä¸€ç»„æœ‰åºçš„å¯¹è±¡ã€‚å…ƒç»„ä¸åˆ—è¡¨ç±»ä¼¼ï¼Œä½†å…ƒç»„ä¸€æ—¦åˆ›å»ºå°±ä¸èƒ½è¢«ä¿®æ”¹ï¼Œä¹Ÿæ²¡æœ‰æ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹ç­‰æ“ä½œçš„æ–¹æ³•ï¼Œå› æ­¤å…ƒç»„æ›´åŠ è½»é‡çº§ï¼Œè€Œä¸”æ›´åŠ å®‰å…¨ã€‚å…ƒç»„ä½¿ç”¨ä¸€å¯¹åœ†æ‹¬å·å’Œé€—å·åˆ†éš”çš„å¯¹è±¡åˆ—è¡¨æ„æˆï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nmy_tuple = (1, 2, 3) å¯ä»¥ä½¿ç”¨ç´¢å¼•å’Œåˆ‡ç‰‡è¿ç®—ç¬¦å¯¹å…ƒç»„è¿›è¡Œè®¿é—®å’Œåˆ‡ç‰‡ã€‚å…ƒç»„æ”¯æŒæ‰€æœ‰çš„åºåˆ—æ“ä½œï¼Œå¦‚ len()ã€inã€+ã€* ç­‰ã€‚å…ƒç»„ä¹Ÿå¯ä»¥åŒ…å«ä»»æ„ç±»å‹çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬å…¶ä»–å…ƒç»„ã€‚ä¾‹å¦‚ï¼š\nt1 = (\u0026#34;apple\u0026#34;, 1, True) t2 = (t1, \u0026#34;banana\u0026#34;, 2.5) print(t2) # è¾“å‡º ((\u0026#39;apple\u0026#39;, 1, True), \u0026#39;banana\u0026#39;, 2.5) print(t2[0][1]) # è¾“å‡º 1 å…ƒç»„çš„ä¸å¯å˜æ€§å¯ä»¥ä¿è¯å…ƒç»„ä¸­çš„å¯¹è±¡ä¸ä¼šè¢«ä¿®æ”¹ï¼Œä»è€Œå¢å¼ºç¨‹åºçš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ã€‚å…ƒç»„é€šå¸¸ç”¨äºè¡¨ç¤ºä¸€äº›ä¸å¯å˜çš„æ•°æ®ï¼Œå¦‚åæ ‡ã€æ—¥æœŸã€æ—¶é—´ç­‰ã€‚å…ƒç»„ä¹Ÿå¯ä»¥ç”¨äºå‡½æ•°çš„è¿”å›å€¼ï¼Œå°†å¤šä¸ªå€¼æ‰“åŒ…æˆä¸€ä¸ªå…ƒç»„è¿”å›ã€‚ä¾‹å¦‚ï¼š\ndef get_rectangle_area_and_perimeter(length, width): area = length * width perimeter = 2 * (length + width) return area, perimeter area, perimeter = get_rectangle_area_and_perimeter(10, 5) print(area, perimeter) # è¾“å‡º 50 30 éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå…ƒç»„ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œéœ€è¦åœ¨å…ƒç´ åé¢åŠ ä¸Šé€—å·ï¼Œå¦åˆ™ä¼šè¢«è§£é‡Šä¸ºå…¶ä»–ç±»å‹ã€‚ä¾‹å¦‚ï¼š\nmy_tuple = (1,) # åŒ…å«ä¸€ä¸ªå…ƒç´ çš„å…ƒç»„ not_a_tuple = (1) # ä¸€ä¸ªæ•´æ•°ï¼Œè€Œä¸æ˜¯å…ƒç»„ ä¸‹é¢æ˜¯ Python å…ƒç»„çš„ä¸€äº›å…¶ä»–ç‰¹æ€§å’Œç”¨æ³•ï¼š\nå…ƒç»„è§£åŒ… å’Œåˆ—è¡¨è§£åŒ…ç±»ä¼¼ï¼Œå¯ä»¥ä½¿ç”¨å…ƒç»„è§£åŒ…ï¼ˆtuple unpackingï¼‰å°†å…ƒç»„ä¸­çš„å…ƒç´ ä¾æ¬¡èµ‹å€¼ç»™å¤šä¸ªå˜é‡ï¼Œå˜é‡åä¹‹é—´ä½¿ç”¨é€—å·åˆ†éš”ã€‚ä¾‹å¦‚ï¼š\nmy_tuple = (1, 2, 3) a, b, c = my_tuple print(a, b, c) # è¾“å‡º 1 2 3 å…ƒç»„çš„æ¯”è¾ƒå’Œæ’åº å’Œåˆ—è¡¨ä¸€æ ·ï¼Œå…ƒç»„ä¹Ÿæ”¯æŒæ¯”è¾ƒè¿ç®—ç¬¦ï¼ˆ==ã€!=ã€\u0026lt;ã€\u0026lt;=ã€\u0026gt;ã€\u0026gt;=ï¼‰å’Œæ’åºæ–¹æ³•ï¼ˆsorted()ã€sort()ï¼‰ã€‚å…ƒç»„çš„æ¯”è¾ƒæ˜¯æŒ‰ç…§å…ƒç´ çš„é¡ºåºå’Œå€¼è¿›è¡Œçš„ï¼Œå¦‚æœä¸¤ä¸ªå…ƒç»„åŒ…å«ç›¸åŒçš„å…ƒç´ ä½†é¡ºåºä¸åŒï¼Œåˆ™å®ƒä»¬ä¸ç›¸ç­‰ã€‚ä¾‹å¦‚ï¼š\na = (1, 2, 3) b = (3, 2, 1) print(a == b) # è¾“å‡º False å…ƒç»„ä½œä¸ºä¸å¯å˜å­—å…¸çš„é”® ç”±äºå…ƒç»„æ˜¯ä¸å¯å˜çš„ï¼Œå¯ä»¥ç”¨ä½œå­—å…¸çš„é”®ã€‚å¦‚æœè¦ä½¿ç”¨åˆ—è¡¨ä½œä¸ºå­—å…¸çš„é”®ï¼Œåˆ™éœ€è¦å…ˆå°†åˆ—è¡¨è½¬æ¢ä¸ºå…ƒç»„ã€‚ä¾‹å¦‚ï¼š\nmy_dict = {(\u0026#34;apple\u0026#34;, \u0026#34;banana\u0026#34;): 1, (\u0026#34;orange\u0026#34;, \u0026#34;grape\u0026#34;): 2} print(my_dict[(\u0026#34;apple\u0026#34;, \u0026#34;banana\u0026#34;)]) # è¾“å‡º 1 * è¿ç®—ç¬¦ å¯ä»¥ä½¿ç”¨ * è¿ç®—ç¬¦å°†å¤šä¸ªå…ƒç»„åˆå¹¶æˆä¸€ä¸ªå…ƒç»„ã€‚ä¾‹å¦‚ï¼š\nt1 = (1, 2, 3) t2 = (4, 5, 6) t3 = (*t1, *t2) print(t3) # è¾“å‡º (1, 2, 3, 4, 5, 6) å…ƒç»„çš„ç”Ÿæˆå™¨ å’Œåˆ—è¡¨ä¸€æ ·ï¼Œå…ƒç»„ä¹Ÿå¯ä»¥ä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼ç”Ÿæˆä¸€ä¸ªç”Ÿæˆå™¨ï¼ˆgeneratorï¼‰ã€‚ç”Ÿæˆå™¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¿­ä»£å™¨ï¼Œå¯ä»¥é€ä¸ªäº§ç”Ÿå…ƒç»„ä¸­çš„å…ƒç´ ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½æ•´ä¸ªå…ƒç»„åˆ°å†…å­˜ä¸­ã€‚ä¾‹å¦‚ï¼š\nmy_tuple = (1, 2, 3, 4, 5) # ç”Ÿæˆå™¨è¡¨è¾¾å¼ gen = (x ** 2 for x in my_tuple) for x in gen: print(x) é›†åˆ Python ä¸­çš„é›†åˆç±»å‹æ˜¯ setï¼ˆé›†åˆï¼‰å’Œ frozensetï¼ˆä¸å¯å˜é›†åˆï¼‰ã€‚\nset æ˜¯ä¸€ç§æ— åºã€å¯å˜çš„é›†åˆç±»å‹ï¼Œå…¶ä¸­ä¸å…è®¸æœ‰é‡å¤å…ƒç´ ã€‚å¯ä»¥ä½¿ç”¨å¤§æ‹¬å·{}æˆ–set()å‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªé›†åˆã€‚ä¾‹å¦‚ï¼š\nmy_set = {1, 2, 3} print(my_set) # è¾“å‡º {1, 2, 3} my_set = set([1, 2, 3, 2]) print(my_set) # è¾“å‡º {1, 2, 3} å¯ä»¥ä½¿ç”¨ add()æ–¹æ³•å‘é›†åˆä¸­æ·»åŠ å…ƒç´ ï¼Œä½¿ç”¨remove()æ–¹æ³•åˆ é™¤å…ƒç´ ã€‚å¯ä»¥ä½¿ç”¨inå…³é”®å­—æ¥æ£€æŸ¥å…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­ã€‚ä¾‹å¦‚ï¼š\nmy_set = {1, 2, 3} my_set.add(4) print(my_set) # è¾“å‡º {1, 2, 3, 4} my_set.remove(2) print(my_set) # è¾“å‡º {1, 3, 4} print(2 in my_set) # è¾“å‡º False é›†åˆæ”¯æŒå„ç§é›†åˆè¿ç®—ï¼Œå¦‚å¹¶é›†ã€äº¤é›†ã€å·®é›†ç­‰ã€‚ä¾‹å¦‚ï¼š\nset1 = {1, 2, 3} set2 = {3, 4, 5} # å¹¶é›† print(set1 | set2) # è¾“å‡º {1, 2, 3, 4, 5} # äº¤é›† print(set1 \u0026amp; set2) # è¾“å‡º {3} # å·®é›† print(set1 - set2) # è¾“å‡º {1, 2} # å¯¹ç§°å·®é›† print(set1 ^ set2) # è¾“å‡º {1, 2, 4, 5} frozenset æ˜¯ä¸€ç§ä¸å¯å˜çš„é›†åˆç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨frozenset()å‡½æ•°æ¥åˆ›å»ºã€‚frozenset å’Œ set å…·æœ‰ç›¸ä¼¼çš„æ“ä½œï¼Œä½†æ˜¯ä¸æ”¯æŒæ·»åŠ ã€åˆ é™¤å…ƒç´ ç­‰æ“ä½œã€‚ä¾‹å¦‚ï¼š\nmy_fset = frozenset([1, 2, 3]) print(my_fset) # è¾“å‡º frozenset({1, 2, 3}) ä¸‹é¢æ˜¯ Python ä¸­é›†åˆç±»å‹çš„ä¸€äº›å…¶ä»–ç‰¹æ€§å’Œç”¨æ³•ï¼š\nåˆ—è¡¨ã€å…ƒç»„è½¬æ¢ä¸ºé›†åˆ å¯ä»¥ä½¿ç”¨set()å‡½æ•°å°†åˆ—è¡¨æˆ–å…ƒç»„è½¬æ¢ä¸ºé›†åˆã€‚é›†åˆä¼šè‡ªåŠ¨å»é™¤é‡å¤å…ƒç´ ã€‚ä¾‹å¦‚ï¼š\nmy_list = [1, 2, 2, 3, 3, 3] my_set = set(my_list) print(my_set) # è¾“å‡º {1, 2, 3} my_tuple = (4, 5, 5, 6, 6, 6) my_set = set(my_tuple) print(my_set) # è¾“å‡º {4, 5, 6} é›†åˆçš„é•¿åº¦ å¯ä»¥ä½¿ç”¨len()å‡½æ•°è·å–é›†åˆçš„é•¿åº¦ï¼ˆå³é›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°ï¼‰ã€‚ä¾‹å¦‚ï¼š\nmy_set = {1, 2, 3} print(len(my_set)) # è¾“å‡º 3 é›†åˆçš„è¿­ä»£ å¯ä»¥ä½¿ç”¨forå¾ªç¯è¿­ä»£é›†åˆä¸­çš„å…ƒç´ ã€‚ç”±äºé›†åˆæ˜¯æ— åºçš„ï¼Œæ¯æ¬¡è¿­ä»£çš„é¡ºåºå¯èƒ½ä¸åŒã€‚ä¾‹å¦‚ï¼š\nmy_set = {1, 2, 3} for x in my_set: print(x) é›†åˆè§£æ å’Œåˆ—è¡¨è§£æç±»ä¼¼ï¼Œå¯ä»¥ä½¿ç”¨é›†åˆè§£æï¼ˆset comprehensionï¼‰å¿«é€Ÿç”Ÿæˆä¸€ä¸ªé›†åˆã€‚ä¾‹å¦‚ï¼š\nmy_set = {x for x in range(1, 6)} print(my_set) # è¾“å‡º {1, 2, 3, 4, 5} frozenset ä½œä¸ºå­—å…¸é”® ç”±äºfrozensetæ˜¯ä¸å¯å˜çš„ï¼Œå¯ä»¥ä½œä¸ºå­—å…¸çš„é”®ã€‚ä¾‹å¦‚ï¼š\nmy_dict = {frozenset({1, 2}): \u0026#34;A\u0026#34;, frozenset({3, 4}): \u0026#34;B\u0026#34;} print(my_dict[frozenset({1, 2})]) # è¾“å‡º \u0026#34;A\u0026#34; é›†åˆçš„ç±»å‹ å¯ä»¥ä½¿ç”¨type()å‡½æ•°æŸ¥çœ‹é›†åˆçš„ç±»å‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨isinstance()å‡½æ•°åˆ¤æ–­é›†åˆæ˜¯å¦å±äºæŸç§ç±»å‹ã€‚ä¾‹å¦‚ï¼š\nmy_set = {1, 2, 3} print(type(my_set)) # è¾“å‡º \u0026lt;class \u0026#39;set\u0026#39;\u0026gt; print(isinstance(my_set, set)) # è¾“å‡º True é›†åˆçš„å¤åˆ¶ é›†åˆå¯ä»¥ä½¿ç”¨copy()æ–¹æ³•è¿›è¡Œå¤åˆ¶ã€‚å¤åˆ¶åçš„é›†åˆå’ŒåŸé›†åˆå…·æœ‰ä¸åŒçš„å†…å­˜åœ°å€ï¼Œäº’ä¸å½±å“ã€‚ä¾‹å¦‚ï¼š\nmy_set = {1, 2, 3} new_set = my_set.copy() print(new_set) # è¾“å‡º {1, 2, 3} new_set.add(4) print(new_set) # è¾“å‡º {1, 2, 3, 4} print(my_set) # è¾“å‡º {1, 2, 3} é›†åˆçš„æ›´æ–° å¯ä»¥ä½¿ç”¨update()æ–¹æ³•å°†ä¸€ä¸ªé›†åˆçš„å…ƒç´ æ·»åŠ åˆ°å¦ä¸€ä¸ªé›†åˆä¸­ã€‚ä¾‹å¦‚ï¼š\nset1 = {1, 2, 3} set2 = {3, 4, 5} set1.update(set2) print(set1) # è¾“å‡º {1, 2, 3, 4, 5} é›†åˆçš„åˆ é™¤ å¯ä»¥ä½¿ç”¨discard()æ–¹æ³•æˆ–remove()æ–¹æ³•æ¥åˆ é™¤é›†åˆä¸­çš„å…ƒç´ ã€‚å¦‚æœè¦åˆ é™¤çš„å…ƒç´ ä¸å­˜åœ¨ï¼Œdiscard()æ–¹æ³•ä¸ä¼šæŠ¥é”™ï¼Œè€Œremove()æ–¹æ³•ä¼šæŠ›å‡º KeyError å¼‚å¸¸ã€‚ä¾‹å¦‚ï¼š\nmy_set = {1, 2, 3} my_set.discard(2) print(my_set) # è¾“å‡º {1, 3} my_set.remove(3) print(my_set) # è¾“å‡º {1} my_set.discard(3) # ä¸ä¼šæŠ¥é”™ my_set.remove(3) # æŠ›å‡ºKeyErrorå¼‚å¸¸ é›†åˆçš„æ¸…ç©º å¯ä»¥ä½¿ç”¨clear()æ–¹æ³•æ¸…ç©ºé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚ä¾‹å¦‚ï¼š\nmy_set = {1, 2, 3} my_set.clear() print(my_set) # è¾“å‡º set() å­—å…¸ åœ¨ Python ä¸­ï¼Œå­—å…¸æ˜¯ä¸€ç§å¯å˜çš„æ•°æ®ç±»å‹ï¼Œç”¨äºå­˜å‚¨é”®-å€¼å¯¹ã€‚å­—å…¸ç”¨å¤§æ‹¬å·{}è¡¨ç¤ºï¼Œæ¯ä¸ªé”®å€¼å¯¹ä¹‹é—´ç”¨é€—å·åˆ†éš”ã€‚å­—å…¸ä¸­çš„é”®å¿…é¡»æ˜¯ä¸å¯å˜çš„ï¼Œå¦‚æ•´æ•°ã€å­—ç¬¦ä¸²æˆ–å…ƒç»„ï¼Œè€Œå€¼å¯ä»¥æ˜¯ä»»æ„çš„ Python å¯¹è±¡ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„å­—å…¸ç¤ºä¾‹ï¼š\nmy_dict = {\u0026#39;name\u0026#39;: \u0026#39;John\u0026#39;, \u0026#39;age\u0026#39;: 30, \u0026#39;city\u0026#39;: \u0026#39;New York\u0026#39;} åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œé”®\u0026rsquo;name\u0026rsquo;ã€\u0026lsquo;age\u0026rsquo;å’Œ\u0026rsquo;city\u0026rsquo;åˆ†åˆ«ä¸å€¼\u0026rsquo;John\u0026rsquo;ã€30 å’Œ\u0026rsquo;New York\u0026rsquo;ç›¸å…³è”ã€‚å¯ä»¥ä½¿ç”¨é”®æ¥è®¿é—®å­—å…¸ä¸­çš„å€¼ï¼Œä¾‹å¦‚ï¼š\nprint(my_dict[\u0026#39;name\u0026#39;]) # è¾“å‡ºï¼šJohn print(my_dict[\u0026#39;age\u0026#39;]) # è¾“å‡ºï¼š30 æ‚¨è¿˜å¯ä»¥ä½¿ç”¨dict()å‡½æ•°ä»å…¶ä»–åºåˆ—æˆ–æ˜ å°„åˆ›å»ºå­—å…¸ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nmy_dict2 = dict([(\u0026#39;name\u0026#39;, \u0026#39;Mary\u0026#39;), (\u0026#39;age\u0026#39;, 25), (\u0026#39;city\u0026#39;, \u0026#39;Los Angeles\u0026#39;)]) print(my_dict2) # è¾“å‡ºï¼š{\u0026#39;name\u0026#39;: \u0026#39;Mary\u0026#39;, \u0026#39;age\u0026#39;: 25, \u0026#39;city\u0026#39;: \u0026#39;Los Angeles\u0026#39;} å­—å…¸æ”¯æŒè®¸å¤šæœ‰ç”¨çš„æ–¹æ³•ï¼Œå¦‚keys()ã€values()å’Œitems()ï¼Œè¿™äº›æ–¹æ³•è¿”å›å­—å…¸çš„é”®ã€å€¼å’Œé”®-å€¼å¯¹çš„è§†å›¾ã€‚å­—å…¸çš„è§†å›¾å¯ç”¨äºæŒ‰ç…§ç‰¹å®šçš„é¡ºåºè®¿é—®å­—å…¸ä¸­çš„å…ƒç´ ï¼Œæˆ–å¯¹å­—å…¸è¿›è¡Œè¿­ä»£æ“ä½œã€‚ä¾‹å¦‚ï¼š\n# è·å–å­—å…¸çš„é”®åˆ—è¡¨ print(list(my_dict.keys())) # è¾“å‡ºï¼š[\u0026#39;name\u0026#39;, \u0026#39;age\u0026#39;, \u0026#39;city\u0026#39;] # è·å–å­—å…¸çš„å€¼åˆ—è¡¨ print(list(my_dict.values())) # è¾“å‡ºï¼š[\u0026#39;John\u0026#39;, 30, \u0026#39;New York\u0026#39;] # è·å–å­—å…¸çš„é”®-å€¼å¯¹åˆ—è¡¨ print(list(my_dict.items())) # è¾“å‡ºï¼š[(\u0026#39;name\u0026#39;, \u0026#39;John\u0026#39;), (\u0026#39;age\u0026#39;, 30), (\u0026#39;city\u0026#39;, \u0026#39;New York\u0026#39;)] # ä½¿ç”¨forå¾ªç¯è¿­ä»£å­—å…¸çš„é”®å’Œå€¼ for key, value in my_dict.items(): print(key, value) ä»¥ä¸‹æ˜¯ä¸€äº›è¿›é˜¶çš„å­—å…¸æ“ä½œï¼š\nå‘å­—å…¸ä¸­æ·»åŠ æˆ–æ›´æ–°é”®å€¼å¯¹ å¯ä»¥ä½¿ç”¨[key]ç´¢å¼•æˆ–update()æ–¹æ³•å‘å­—å…¸ä¸­æ·»åŠ æˆ–æ›´æ–°é”®å€¼å¯¹ã€‚ä¾‹å¦‚ï¼š\n# æ·»åŠ æ–°çš„é”®å€¼å¯¹ my_dict[\u0026#39;gender\u0026#39;] = \u0026#39;male\u0026#39; print(my_dict) # è¾“å‡ºï¼š{\u0026#39;name\u0026#39;: \u0026#39;John\u0026#39;, \u0026#39;age\u0026#39;: 30, \u0026#39;city\u0026#39;: \u0026#39;New York\u0026#39;, \u0026#39;gender\u0026#39;: \u0026#39;male\u0026#39;} # æ›´æ–°ç°æœ‰çš„é”®å€¼å¯¹ my_dict[\u0026#39;age\u0026#39;] = 40 print(my_dict) # è¾“å‡ºï¼š{\u0026#39;name\u0026#39;: \u0026#39;John\u0026#39;, \u0026#39;age\u0026#39;: 40, \u0026#39;city\u0026#39;: \u0026#39;New York\u0026#39;, \u0026#39;gender\u0026#39;: \u0026#39;male\u0026#39;} å¯ä»¥ä½¿ç”¨update()æ–¹æ³•å°†ä¸€ä¸ªå­—å…¸åˆå¹¶åˆ°å¦ä¸€ä¸ªå­—å…¸ä¸­ã€‚å¦‚æœé”®ç›¸åŒï¼Œåˆ™åä¸€ä¸ªå­—å…¸çš„å€¼å°†è¦†ç›–å‰ä¸€ä¸ªå­—å…¸çš„å€¼ã€‚ä¾‹å¦‚ï¼š\nmy_dict = {\u0026#39;name\u0026#39;: \u0026#39;John\u0026#39;, \u0026#39;age\u0026#39;: 30, \u0026#39;city\u0026#39;: \u0026#39;New York\u0026#39;} my_dict2 = {\u0026#39;gender\u0026#39;: \u0026#39;male\u0026#39;, \u0026#39;country\u0026#39;: \u0026#39;USA\u0026#39;} my_dict.update(my_dict2) print(my_dict) # è¾“å‡ºï¼š{\u0026#39;name\u0026#39;: \u0026#39;John\u0026#39;, \u0026#39;age\u0026#39;: 30, \u0026#39;city\u0026#39;: \u0026#39;New York\u0026#39;, \u0026#39;gender\u0026#39;: \u0026#39;male\u0026#39;, \u0026#39;country\u0026#39;: \u0026#39;USA\u0026#39;} åˆ é™¤å­—å…¸ä¸­çš„é”®å€¼å¯¹ å¯ä»¥ä½¿ç”¨delè¯­å¥æˆ–pop()æ–¹æ³•ä»å­—å…¸ä¸­åˆ é™¤é”®å€¼å¯¹ã€‚ä¾‹å¦‚ï¼š\n# ä½¿ç”¨delåˆ é™¤é”®å€¼å¯¹ del my_dict[\u0026#39;gender\u0026#39;] print(my_dict) # è¾“å‡ºï¼š{\u0026#39;name\u0026#39;: \u0026#39;John\u0026#39;, \u0026#39;age\u0026#39;: 40, \u0026#39;city\u0026#39;: \u0026#39;New York\u0026#39;} # ä½¿ç”¨popåˆ é™¤é”®å€¼å¯¹ my_dict.pop(\u0026#39;age\u0026#39;) print(my_dict) # è¾“å‡ºï¼š{\u0026#39;name\u0026#39;: \u0026#39;John\u0026#39;, \u0026#39;city\u0026#39;: \u0026#39;New York\u0026#39;} ä½¿ç”¨items()æ–¹æ³•éå†å­—å…¸çš„é”®å€¼å¯¹ å¯ä»¥ä½¿ç”¨items()æ–¹æ³•éå†å­—å…¸çš„é”®å€¼å¯¹ã€‚ä¾‹å¦‚ï¼š\nmy_dict = {\u0026#39;name\u0026#39;: \u0026#39;John\u0026#39;, \u0026#39;age\u0026#39;: 30, \u0026#39;city\u0026#39;: \u0026#39;New York\u0026#39;} for key, value in my_dict.items(): print(f\u0026#34;{key}: {value}\u0026#34;) åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œitems()æ–¹æ³•è¿”å›ä¸€ä¸ªç”±é”®å€¼å¯¹ç»„æˆçš„å…ƒç»„ï¼Œç„¶åä½¿ç”¨forå¾ªç¯éå†è¿™ä¸ªå…ƒç»„å¹¶æ‰“å°å‡ºæ¯ä¸ªé”®å€¼å¯¹ã€‚\nä½¿ç”¨å­—å…¸æ¨å¯¼å¼åˆ›å»ºå­—å…¸ å¯ä»¥ä½¿ç”¨å­—å…¸æ¨å¯¼å¼ä»å…¶ä»–åºåˆ—æˆ–å­—å…¸åˆ›å»ºæ–°çš„å­—å…¸ã€‚ä¾‹å¦‚ï¼š\n# ä»åˆ—è¡¨åˆ›å»ºå­—å…¸ my_list = [(\u0026#39;name\u0026#39;, \u0026#39;John\u0026#39;), (\u0026#39;age\u0026#39;, 30), (\u0026#39;city\u0026#39;, \u0026#39;New York\u0026#39;)] my_dict = {key: value for key, value in my_list} print(my_dict) # è¾“å‡ºï¼š{\u0026#39;name\u0026#39;: \u0026#39;John\u0026#39;, \u0026#39;age\u0026#39;: 30, \u0026#39;city\u0026#39;: \u0026#39;New York\u0026#39;} # ä»å¦ä¸€ä¸ªå­—å…¸åˆ›å»ºå­—å…¸ my_dict2 = {\u0026#39;gender\u0026#39;: \u0026#39;male\u0026#39;, \u0026#39;country\u0026#39;: \u0026#39;USA\u0026#39;} my_dict3 = {**my_dict, **my_dict2} print(my_dict3) # è¾“å‡ºï¼š{\u0026#39;name\u0026#39;: \u0026#39;John\u0026#39;, \u0026#39;age\u0026#39;: 30, \u0026#39;city\u0026#39;: \u0026#39;New York\u0026#39;, \u0026#39;gender\u0026#39;: \u0026#39;male\u0026#39;, \u0026#39;country\u0026#39;: \u0026#39;USA\u0026#39;} ä½¿ç”¨defaultdictåˆ›å»ºé»˜è®¤å€¼å­—å…¸ defaultdictæ˜¯ä¸€ä¸ªå­—å…¸å­ç±»ï¼Œå®ƒå…è®¸æ‚¨æŒ‡å®šä¸€ä¸ªé»˜è®¤å€¼ï¼Œä»¥ä¾¿åœ¨è®¿é—®ä¸å­˜åœ¨çš„é”®æ—¶è¿”å›è¯¥å€¼ã€‚ä¾‹å¦‚ï¼š\nfrom collections import defaultdict my_dict = defaultdict(int) # é»˜è®¤å€¼ä¸º0 my_dict[\u0026#39;age\u0026#39;] += 1 print(my_dict) # è¾“å‡ºï¼š{\u0026#39;age\u0026#39;: 1} my_dict2 = defaultdict(list) # é»˜è®¤å€¼ä¸º[] my_dict2[\u0026#39;names\u0026#39;].append(\u0026#39;John\u0026#39;) print(my_dict2) # è¾“å‡ºï¼š{\u0026#39;names\u0026#39;: [\u0026#39;John\u0026#39;]} ä½¿ç”¨sorted()å‡½æ•°æŒ‰ç…§é”®æˆ–å€¼æ’åºå­—å…¸ å¯ä»¥ä½¿ç”¨sorted()å‡½æ•°æŒ‰ç…§å­—å…¸çš„é”®æˆ–å€¼å¯¹å­—å…¸è¿›è¡Œæ’åºã€‚ä¾‹å¦‚ï¼š\n# æŒ‰ç…§é”®æ’åºå­—å…¸ my_dict = {\u0026#39;name\u0026#39;: \u0026#39;John\u0026#39;, \u0026#39;age\u0026#39;: 30, \u0026#39;city\u0026#39;: \u0026#39;New York\u0026#39;} sorted_dict = dict(sorted(my_dict.items(), key=lambda x: x[0])) print(sorted_dict) # è¾“å‡ºï¼š{\u0026#39;age\u0026#39;: 30, \u0026#39;city\u0026#39;: \u0026#39;New York\u0026#39;, \u0026#39;name\u0026#39;: \u0026#39;John\u0026#39;} # æŒ‰ç…§å€¼æ’åºå­—å…¸ my_dict = {\u0026#39;name\u0026#39;: \u0026#39;John\u0026#39;, \u0026#39;age\u0026#39;: 30, \u0026#39;city\u0026#39;: \u0026#39;New York\u0026#39;} sorted_dict = dict(sorted(my_dict.items(), key=lambda x: x[1])) print(sorted_dict) # è¾“å‡ºï¼š{\u0026#39;age\u0026#39;: 30, \u0026#39;name\u0026#39;: \u0026#39;John\u0026#39;, \u0026#39;city\u0026#39;: \u0026#39;New York\u0026#39;} ä½¿ç”¨zip()å‡½æ•°å°†ä¸¤ä¸ªåºåˆ—åˆå¹¶ä¸ºå­—å…¸ å¯ä»¥ä½¿ç”¨zip()å‡½æ•°å°†ä¸¤ä¸ªåºåˆ—åˆå¹¶ä¸ºä¸€ä¸ªå­—å…¸ã€‚ä¾‹å¦‚ï¼š\nkeys = [\u0026#39;name\u0026#39;, \u0026#39;age\u0026#39;, \u0026#39;city\u0026#39;] values = [\u0026#39;John\u0026#39;, 30, \u0026#39;New York\u0026#39;] my_dict = dict(zip(keys, values)) print(my_dict) # è¾“å‡ºï¼š{\u0026#39;name\u0026#39;: \u0026#39;John\u0026#39;, \u0026#39;age\u0026#39;: 30, \u0026#39;city\u0026#39;: \u0026#39;New York\u0026#39;} ä½¿ç”¨jsonæ¨¡å—å°†å­—å…¸è½¬æ¢ä¸º JSON æ ¼å¼ å¯ä»¥ä½¿ç”¨jsonæ¨¡å—å°† Python å­—å…¸è½¬æ¢ä¸º JSON æ ¼å¼çš„å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼š\nimport json my_dict = {\u0026#39;name\u0026#39;: \u0026#39;John\u0026#39;, \u0026#39;age\u0026#39;: 30, \u0026#39;city\u0026#39;: \u0026#39;New York\u0026#39;} json_str = json.dumps(my_dict) print(json_str) # è¾“å‡ºï¼š{\u0026#34;name\u0026#34;: \u0026#34;John\u0026#34;, \u0026#34;age\u0026#34;: 30, \u0026#34;city\u0026#34;: \u0026#34;New York\u0026#34;} ä½¿ç”¨pprintæ¨¡å—æ‰“å°å‡ºæ¼‚äº®çš„å­—å…¸è¾“å‡º å¯ä»¥ä½¿ç”¨pprintæ¨¡å—æ‰“å°å‡ºæ¼‚äº®çš„ã€æ˜“äºé˜…è¯»çš„å­—å…¸è¾“å‡ºã€‚ä¾‹å¦‚ï¼š\nfrom pprint import pprint my_dict = {\u0026#39;name\u0026#39;: \u0026#39;John\u0026#39;, \u0026#39;age\u0026#39;: 30, \u0026#39;city\u0026#39;: \u0026#39;New York\u0026#39;} pprint(my_dict) ä½¿ç”¨copy()æ–¹æ³•æˆ–dict()æ„é€ å‡½æ•°åˆ›å»ºå­—å…¸å‰¯æœ¬ å¯ä»¥ä½¿ç”¨copy()æ–¹æ³•æˆ–dict()æ„é€ å‡½æ•°åˆ›å»ºå­—å…¸çš„å‰¯æœ¬ã€‚ä¾‹å¦‚ï¼š\nmy_dict = {\u0026#39;name\u0026#39;: \u0026#39;John\u0026#39;, \u0026#39;age\u0026#39;: 30, \u0026#39;city\u0026#39;: \u0026#39;New York\u0026#39;} my_dict_copy = my_dict.copy() # ä½¿ç”¨copy()æ–¹æ³•åˆ›å»ºå‰¯æœ¬ my_dict_copy[\u0026#39;age\u0026#39;] = 40 print(my_dict) # è¾“å‡ºï¼š{\u0026#39;name\u0026#39;: \u0026#39;John\u0026#39;, \u0026#39;age\u0026#39;: 30, \u0026#39;city\u0026#39;: \u0026#39;New York\u0026#39;} print(my_dict_copy) # è¾“å‡ºï¼š{\u0026#39;name\u0026#39;: \u0026#39;John\u0026#39;, \u0026#39;age\u0026#39;: 40, \u0026#39;city\u0026#39;: \u0026#39;New York\u0026#39;} my_dict2 = dict(my_dict) # ä½¿ç”¨dict()æ„é€ å‡½æ•°åˆ›å»ºå‰¯æœ¬ my_dict2[\u0026#39;name\u0026#39;] = \u0026#39;Mary\u0026#39; print(my_dict) # è¾“å‡ºï¼š{\u0026#39;name\u0026#39;: \u0026#39;John\u0026#39;, \u0026#39;age\u0026#39;: 30, \u0026#39;city\u0026#39;: \u0026#39;New York\u0026#39;} print(my_dict2) # è¾“å‡ºï¼š{\u0026#39;name\u0026#39;: \u0026#39;Mary\u0026#39;, \u0026#39;age\u0026#39;: 30, \u0026#39;city\u0026#39;: \u0026#39;New York\u0026#39;} ä½¿ç”¨setdefault()æ–¹æ³•è·å–å­—å…¸çš„å€¼ å¯ä»¥ä½¿ç”¨setdefault()æ–¹æ³•è·å–å­—å…¸çš„å€¼ã€‚å¦‚æœé”®å­˜åœ¨ï¼Œåˆ™è¿”å›é”®çš„å€¼ã€‚å¦‚æœé”®ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›é»˜è®¤å€¼å¹¶å°†å…¶æ·»åŠ åˆ°å­—å…¸ä¸­ã€‚ä¾‹å¦‚ï¼š\nmy_dict = {\u0026#39;name\u0026#39;: \u0026#39;John\u0026#39;, \u0026#39;age\u0026#39;: 30, \u0026#39;city\u0026#39;: \u0026#39;New York\u0026#39;} name = my_dict.setdefault(\u0026#39;name\u0026#39;, \u0026#39;Unknown\u0026#39;) gender = my_dict.setdefault(\u0026#39;gender\u0026#39;, \u0026#39;male\u0026#39;) print(name) # è¾“å‡ºï¼šJohn print(gender) # è¾“å‡ºï¼šmale print(my_dict) # è¾“å‡ºï¼š{\u0026#39;name\u0026#39;: \u0026#39;John\u0026#39;, \u0026#39;age\u0026#39;: 30, \u0026#39;city\u0026#39;: \u0026#39;New York\u0026#39;, \u0026#39;gender\u0026#39;: \u0026#39;male\u0026#39;} å­—å…¸è§£åŒ… å­—å…¸è§£åŒ…æ˜¯ä¸€ç§å°†å­—å…¸è½¬æ¢ä¸ºå…³é”®å­—å‚æ•°çš„æŠ€æœ¯ã€‚å­—å…¸è§£åŒ…ä½¿ç”¨ä¸€ä¸ªæˆ–ä¸¤ä¸ªæ˜Ÿå·è¿ç®—ç¬¦ï¼ˆ*æˆ–**ï¼‰æ¥å®ç°ã€‚\nå…·ä½“æ¥è¯´ï¼Œå½“ä½¿ç”¨å•ä¸ªæ˜Ÿå·è¿ç®—ç¬¦*å°†ä¸€ä¸ªå­—å…¸è§£åŒ…æ—¶ï¼Œå®ƒä¼šå°†å­—å…¸çš„é”®è§£åŒ…ä¸ºä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œå¯ä»¥åœ¨å‡½æ•°è°ƒç”¨ä¸­ä½œä¸ºä½ç½®å‚æ•°ä¼ é€’ã€‚ä¾‹å¦‚ï¼š\ndef print_info(name, age, city): print(f\u0026#34;Name: {name}\u0026#34;) print(f\u0026#34;Age: {age}\u0026#34;) print(f\u0026#34;City: {city}\u0026#34;) my_dict = {\u0026#39;name\u0026#39;: \u0026#39;John\u0026#39;, \u0026#39;age\u0026#39;: 30, \u0026#39;city\u0026#39;: \u0026#39;New York\u0026#39;} print_info(*my_dict) # è¾“å‡ºï¼šTypeError: print_info() takes 3 positional arguments but 6 were given åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”±äºprint_info()å‡½æ•°éœ€è¦ 3 ä¸ªå…³é”®å­—å‚æ•°nameã€ageå’Œcityï¼Œè€Œå­—å…¸my_dictä¸­æœ‰ 3 ä¸ªé”®nameã€ageå’Œcityï¼Œå› æ­¤å®ƒä»¬è¢«è§£åŒ…ä¸ºä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡('name', 'age', 'city')ï¼Œç„¶åä½œä¸ºä½ç½®å‚æ•°ä¼ é€’ç»™print_info()å‡½æ•°ã€‚ä½†æ˜¯ï¼Œç”±äºprint_info()å‡½æ•°éœ€è¦çš„æ˜¯å…³é”®å­—å‚æ•°è€Œä¸æ˜¯ä½ç½®å‚æ•°ï¼Œå› æ­¤å‡ºç°äº†TypeErrorå¼‚å¸¸ã€‚\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨åŒæ˜Ÿå·è¿ç®—ç¬¦**å°†å­—å…¸è§£åŒ…ä¸ºå…³é”®å­—å‚æ•°ã€‚ä¾‹å¦‚ï¼š\ndef print_info(name, age, city): print(f\u0026#34;Name: {name}\u0026#34;) print(f\u0026#34;Age: {age}\u0026#34;) print(f\u0026#34;City: {city}\u0026#34;) my_dict = {\u0026#39;name\u0026#39;: \u0026#39;John\u0026#39;, \u0026#39;age\u0026#39;: 30, \u0026#39;city\u0026#39;: \u0026#39;New York\u0026#39;} print_info(**my_dict) # è¾“å‡ºï¼šName: John Age: 30 City: New York åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒåŒæ˜Ÿå·è¿ç®—ç¬¦**å°†å­—å…¸my_dictè§£åŒ…ä¸ºå…³é”®å­—å‚æ•°name='John'ã€age=30å’Œcity='New York'ï¼Œç„¶åå°†å®ƒä»¬ä½œä¸ºå…³é”®å­—å‚æ•°ä¼ é€’ç»™print_info()å‡½æ•°ï¼Œè¿™æ ·å°±èƒ½å¤ŸæˆåŠŸåœ°æ‰“å°å‡ºå­—å…¸ä¸­çš„å€¼äº†ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰åœ¨å‡½æ•°å®šä¹‰ä¸­æ˜ç¡®æŒ‡å®šäº†è¿™äº›å…³é”®å­—å‚æ•°æ—¶ï¼Œæ‰èƒ½ä½¿ç”¨å­—å…¸è§£åŒ…ã€‚å¦åˆ™ï¼Œå°†ä¼šå¼•å‘TypeErrorå¼‚å¸¸ã€‚\nNone åœ¨ Python ä¸­ï¼ŒNoneæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡ï¼Œè¡¨ç¤ºä¸€ä¸ªç©ºå€¼æˆ–ç¼ºå¤±å€¼ã€‚Noneæ˜¯ Python ä¸­å”¯ä¸€çš„ç©ºå€¼å¯¹è±¡ï¼Œç”¨äºè¡¨ç¤ºæ²¡æœ‰å€¼çš„æƒ…å†µã€‚å®ƒæ˜¯ä¸€ä¸ªå•ä¾‹å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒPython ä¸­çš„æ‰€æœ‰Noneå¼•ç”¨éƒ½æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚\nNoneç±»å‹å¯ä»¥ç”¨äºå¤šç§æƒ…å†µï¼Œä¾‹å¦‚ï¼š\nè¡¨ç¤ºå‡½æ•°æ²¡æœ‰è¿”å›å€¼ è¡¨ç¤ºå˜é‡å°šæœªè¢«èµ‹å€¼ è¡¨ç¤ºä¸€ä¸ªå­—å…¸ä¸­æ²¡æœ‰æŒ‡å®šçš„é”® è¡¨ç¤ºä¸€ä¸ªç±»çš„å±æ€§å°šæœªè¢«èµ‹å€¼ ä»¥ä¸‹æ˜¯ä¸€äº›ä½¿ç”¨Noneçš„ä¾‹å­ï¼š\ndef print_hello(): print(\u0026#34;Hello, world!\u0026#34;) # å‡½æ•°æ²¡æœ‰è¿”å›å€¼ï¼Œæ‰€ä»¥å¯ä»¥ä¸å†™returnè¯­å¥ x = None if x is None: print(\u0026#34;x is not defined\u0026#34;) my_dict = {\u0026#39;name\u0026#39;: \u0026#39;John\u0026#39;, \u0026#39;age\u0026#39;: 30} city = my_dict.get(\u0026#39;city\u0026#39;) if city is None: print(\u0026#34;No city found in my_dict\u0026#34;) class Person: def __init__(self, name=None, age=None): self.name = name self.age = age p = Person(\u0026#34;John\u0026#34;) if p.age is None: print(\u0026#34;Age not specified\u0026#34;) åœ¨è¿™äº›ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°Noneè¢«ç”¨äºè¡¨ç¤ºå‡½æ•°æ²¡æœ‰è¿”å›å€¼ã€å˜é‡å°šæœªè¢«èµ‹å€¼ã€ä¸€ä¸ªå­—å…¸ä¸­æ²¡æœ‰æŒ‡å®šçš„é”®ä»¥åŠä¸€ä¸ªç±»çš„å±æ€§å°šæœªè¢«èµ‹å€¼ç­‰æƒ…å†µã€‚\nPython ä¸­Noneç±»å‹çš„ä¸€äº›è¡¥å……è¯´æ˜ï¼š\nNoneType ç±»å‹ åœ¨ Python ä¸­ï¼ŒNoneæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡ï¼Œå…¶ç±»å‹ä¸ºNoneTypeã€‚å¯ä»¥ä½¿ç”¨type()å‡½æ•°æ¥æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼š\nx = None print(type(x)) # è¾“å‡ºï¼š\u0026lt;class \u0026#39;NoneType\u0026#39;\u0026gt; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œtype()å‡½æ•°è¿”å›å˜é‡xçš„ç±»å‹ï¼Œå³NoneTypeã€‚\né¿å…ä¸å…¶ä»–ç±»å‹æ··æ·† åœ¨ Python ä¸­ï¼ŒNoneç±»å‹åªèƒ½ä¸è‡ªèº«è¿›è¡Œæ¯”è¾ƒï¼Œä¸èƒ½ä¸å…¶ä»–ç±»å‹è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœä¸å°å¿ƒå°†Noneä¸å…¶ä»–ç±»å‹æ··æ·†ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›å¥‡æ€ªçš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼š\nx = None if x == \u0026#39;\u0026#39;: print(\u0026#34;x is an empty string\u0026#34;) åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”±äº==æ“ä½œç¬¦å°†Noneä¸ç©ºå­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒï¼Œæ‰€ä»¥ç¨‹åºä¸ä¼šæ‰“å°ä»»ä½•å†…å®¹ã€‚å¦‚æœæƒ³æ£€æŸ¥ä¸€ä¸ªå˜é‡æ˜¯å¦ä¸ºå­—ç¬¦ä¸²ï¼Œåº”è¯¥ä½¿ç”¨isinstance()å‡½æ•°ã€‚ä¾‹å¦‚ï¼š\nx = None if isinstance(x, str): print(\u0026#34;x is a string\u0026#34;) åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œisinstance()å‡½æ•°æ£€æŸ¥å˜é‡xæ˜¯å¦ä¸ºå­—ç¬¦ä¸²ç±»å‹ã€‚\nä½¿ç”¨is not Noneæ£€æŸ¥å˜é‡æ˜¯å¦å­˜åœ¨ åœ¨ Python ä¸­ï¼Œå¦‚æœæƒ³æ£€æŸ¥ä¸€ä¸ªå˜é‡æ˜¯å¦å­˜åœ¨ï¼Œåº”è¯¥ä½¿ç”¨is not Noneè¡¨è¾¾å¼ã€‚ä¾‹å¦‚ï¼š\nx = None if x is not None: print(\u0026#34;x is defined\u0026#34;) åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œis not Noneè¡¨è¾¾å¼æ£€æŸ¥å˜é‡xæ˜¯å¦å­˜åœ¨ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™æ‰“å°å‡ºx is definedã€‚è¿™ç§å†™æ³•æ¯”ä½¿ç”¨if x:æ›´æ˜ç¡®ï¼Œå¯ä»¥é¿å…ä¸€äº›æ½œåœ¨çš„é—®é¢˜ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/06/10/python-data-type/","summary":"Python ä¸­çš„æ•°æ®ç±»å‹åŒ…æ‹¬ï¼š\næ•°å­—ç±»å‹ï¼šåŒ…æ‹¬æ•´å‹ã€æµ®ç‚¹å‹ã€å¤æ•°å‹å’Œå¸ƒå°”ç±»å‹ï¼šåªæœ‰ä¸¤ä¸ªå–å€¼ï¼ŒTrue å’Œ Falseï¼Œç”¨äºè¡¨ç¤ºé€»è¾‘å€¼ã€‚ å­—ç¬¦ä¸²ç±»å‹ï¼šç”±ä¸€ç³»åˆ—å­—ç¬¦ç»„æˆï¼Œå¯ä»¥æ˜¯å•å¼•å·ã€åŒå¼•å·æˆ–ä¸‰å¼•å·æ‹¬èµ·æ¥çš„æ–‡æœ¬ã€‚ åˆ—è¡¨ç±»å‹ï¼šç”±ä¸€ç³»åˆ—æœ‰åºçš„å…ƒç´ ç»„æˆï¼Œå¯ä»¥åŒ…å«ä»»ä½•ç±»å‹çš„æ•°æ®ã€‚ å…ƒç»„ç±»å‹ï¼šä¸åˆ—è¡¨ç±»ä¼¼ï¼Œä½†æ˜¯å…ƒç´ ä¸èƒ½è¢«ä¿®æ”¹ã€‚ é›†åˆç±»å‹ï¼šç”±ä¸€ç»„å”¯ä¸€çš„å…ƒç´ ç»„æˆï¼Œæ”¯æŒé›†åˆçš„åŸºæœ¬æ“ä½œï¼Œå¦‚å¹¶é›†ã€äº¤é›†å’Œå·®é›†ç­‰ã€‚ å­—å…¸ç±»å‹ï¼šç”±ä¸€ç»„é”®å€¼å¯¹ç»„æˆï¼Œå…¶ä¸­é”®æ˜¯å”¯ä¸€çš„ï¼Œç”¨äºæŸ¥æ‰¾å’Œå­˜å‚¨å€¼ã€‚ None ç±»å‹ï¼šè¡¨ç¤ºç©ºå€¼æˆ–ç¼ºå¤±å€¼ã€‚ æ•°å­— åœ¨ Python ä¸­ï¼Œæ•°å­—ç±»å‹åŒ…æ‹¬æ•´æ•°ï¼ˆintï¼‰ã€æµ®ç‚¹æ•°ï¼ˆfloatï¼‰ã€å¤æ•°ï¼ˆcomplexï¼‰å’Œå¸ƒå°”å€¼ï¼ˆboolï¼‰ã€‚\næ•´æ•°ï¼ˆintï¼‰æ˜¯ä¸å¸¦å°æ•°çš„æ•°å­—ï¼Œå¯ä»¥ä½¿ç”¨åè¿›åˆ¶ã€äºŒè¿›åˆ¶ã€å…«è¿›åˆ¶æˆ–åå…­è¿›åˆ¶è¡¨ç¤ºã€‚åœ¨ Python 3 ä¸­ï¼Œæ•´æ•°çš„é•¿åº¦ä¸å†å—é™äºæœºå™¨çš„ä½æ•°ï¼Œå¯ä»¥è¡¨ç¤ºä»»æ„å¤§çš„æ•´æ•°ã€‚ ä¾‹å¦‚ï¼š\na = 123 # åè¿›åˆ¶æ•´æ•° b = 0b1010 # äºŒè¿›åˆ¶æ•´æ•°ï¼Œç­‰äºåè¿›åˆ¶çš„ 10 c = 0o12 # å…«è¿›åˆ¶æ•´æ•°ï¼Œç­‰äºåè¿›åˆ¶çš„ 10 d = 0x0A # åå…­è¿›åˆ¶æ•´æ•°ï¼Œç­‰äºåè¿›åˆ¶çš„ 10 æµ®ç‚¹æ•°ï¼ˆfloatï¼‰æ˜¯å¸¦å°æ•°çš„æ•°å­—ï¼Œå¯ä»¥ä½¿ç”¨ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºã€‚åœ¨ Python ä¸­ï¼Œæµ®ç‚¹æ•°é‡‡ç”¨ IEEE 754 æ ‡å‡†è¡¨ç¤ºï¼Œå…·æœ‰åŒç²¾åº¦ï¼ˆ64 ä½ï¼‰å’Œå•ç²¾åº¦ï¼ˆ32 ä½ï¼‰ä¸¤ç§å½¢å¼ã€‚ä¾‹å¦‚ï¼š\na = 3.14e-2 # ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºçš„æµ®ç‚¹æ•°ï¼Œç­‰äº 0.0314 b = 1.23 # æ™®é€šçš„æµ®ç‚¹æ•° å¤æ•°ï¼ˆcomplexï¼‰æ˜¯å…·æœ‰å®éƒ¨å’Œè™šéƒ¨çš„æ•°å­—ï¼Œå¯ä»¥ä½¿ç”¨ a+bj æˆ– complex(a, b) çš„å½¢å¼è¡¨ç¤ºï¼Œå…¶ä¸­ j è¡¨ç¤ºè™šæ•°å•ä½ã€‚ä¾‹å¦‚ï¼š\na = 1+2j # å¤æ•° b = complex(3, 4) # å¤æ•°ï¼Œç­‰äº 3+4j å¸ƒå°”å€¼ï¼ˆboolï¼‰åªæœ‰ä¸¤ä¸ªå–å€¼ï¼ŒTrue å’Œ Falseï¼Œç”¨äºè¡¨ç¤ºçœŸå’Œå‡ã€‚åœ¨ Python ä¸­ï¼Œå¸ƒå°”å€¼å¯ä»¥å’Œæ•°å€¼è¿›è¡Œè¿ç®—ï¼ŒTrue è½¬æ¢ä¸º 1ï¼ŒFalse è½¬æ¢ä¸º 0ã€‚ä¾‹å¦‚ï¼š\na = True b = False c = 1 + True # c çš„å€¼ä¸º 2 d = 3 * False # d çš„å€¼ä¸º 0 æ•°å­—çš„æ“ä½œå’Œè¿ç®—ï¼š","title":"Pythonå­¦ä¹ 2ï¼šæ•°æ®ç±»å‹"},{"content":"æœ¬æ–‡ä¸»è¦ä»‹ç» Adapter æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nJava Design Patterns æä¾›äº†å„ç§ Java è®¾è®¡æ¨¡å¼çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ã€‚è¯¥ç½‘ç«™æ—¨åœ¨å¸®åŠ© Java å¼€å‘äººå‘˜äº†è§£å’Œåº”ç”¨å„ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚\nJava Design Patterns ç½‘ç«™æä¾›äº†å¤šç§è®¾è®¡æ¨¡å¼åˆ†ç±»æ–¹å¼ï¼ŒåŒ…æ‹¬åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational Patternsï¼‰ã€ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternsï¼‰å’Œè¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰ï¼Œä»¥åŠå…¶ä»–ä¸€äº›å¸¸è§çš„æ¨¡å¼ã€‚\nå¯¹äºæ¯ä¸ªè®¾è®¡æ¨¡å¼ï¼Œè¯¥ç½‘ç«™æä¾›äº†è¯¦ç»†çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ï¼Œå¹¶ä¸”æä¾›äº†ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ã€‚å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©é€‚åˆè‡ªå·±çš„è®¾è®¡æ¨¡å¼ï¼Œå¹¶ä¸”å¯ä»¥å‚è€ƒç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜æ¥ç†è§£å’Œåº”ç”¨è¯¥æ¨¡å¼ã€‚\næ­¤å¤–ï¼ŒJava Design Patterns ç½‘ç«™è¿˜æä¾›äº†ä¸€äº›å…¶ä»–èµ„æºï¼Œå¦‚è®¾è®¡æ¨¡å¼çš„ UML å›¾ã€è®¾è®¡æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ã€è®¾è®¡æ¨¡å¼çš„æ¯”è¾ƒç­‰ã€‚è¿™äº›èµ„æºå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨è®¾è®¡æ¨¡å¼ã€‚\nä¸­æ–‡ç½‘ç«™ï¼šhttps://java-design-patterns.com/zh/\nGithub ä¸Šæºç ä»“åº“ï¼ˆéå®˜æ–¹ï¼‰ï¼šhttps://github.com/iluwatar/java-design-patterns\nç›®çš„ å°†ä¸€ä¸ªæ¥å£è½¬æ¢æˆå¦ä¸€ä¸ªå®¢æˆ·æ‰€æœŸæœ›çš„æ¥å£ã€‚é€‚é…å™¨è®©é‚£äº›æœ¬æ¥å› ä¸ºæ¥å£ä¸å…¼å®¹çš„ç±»å¯ä»¥åˆä½œæ— é—´ã€‚\né€‚é…å™¨æ¨¡å¼(Adapter Pattern)æ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·ç«¯æ‰€æœŸæœ›çš„å¦ä¸€ç§æ¥å£ã€‚é€‚é…å™¨æ¨¡å¼é€šå¸¸ç”¨äºè¿æ¥ä¸¤ä¸ªä¸å…¼å®¹çš„æ¥å£æˆ–ç±»ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥ååŒå·¥ä½œã€‚\nè§£é‡Š ç°å®ä¸–ç•Œä¾‹å­\nè€ƒè™‘æœ‰è¿™ä¹ˆä¸€ç§æƒ…å†µï¼Œåœ¨ä½ çš„å­˜å‚¨å¡ä¸­æœ‰ä¸€äº›ç…§ç‰‡ï¼Œä½ æƒ³å°†å…¶ä¼ åˆ°ä½ çš„ç”µè„‘ä¸­ã€‚ä¸ºäº†ä¼ é€æ•°æ®ï¼Œä½ éœ€è¦æŸç§èƒ½å¤Ÿå…¼å®¹ä½ ç”µè„‘æ¥å£çš„é€‚é…å™¨ä»¥ä¾¿ä½ çš„å‚¨å­˜å¡èƒ½è¿ä¸Šä½ çš„ç”µè„‘ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯»å¡å™¨å°±æ˜¯ä¸€ä¸ªé€‚é…å™¨ã€‚ å¦ä¸€ä¸ªä¾‹å­å°±æ˜¯æ³¨æ˜çš„ç”µæºé€‚é…å™¨ï¼›ä¸‰è„šæ’å¤´ä¸èƒ½æ’åœ¨ä¸¤è„šæ’åº§ä¸Šï¼Œéœ€è¦ä¸€ä¸ªç”µæºé€‚é…å™¨æ¥ä½¿å…¶èƒ½å¤Ÿæ’åœ¨ä¸¤è„šæ’åº§ä¸Šã€‚ è¿˜æœ‰ä¸€ä¸ªä¾‹å­å°±æ˜¯ç¿»è¯‘å®˜ï¼Œä»–ç¿»è¯‘ä¸€ä¸ªäººå¯¹å¦ä¸€ä¸ªäººè¯´çš„è¯ã€‚\nç”¨ç›´ç™½çš„è¯æ¥è¯´\né€‚é…å™¨æ¨¡å¼è®©ä½ å¯ä»¥æŠŠä¸å…¼å®¹çš„å¯¹è±¡åŒ…åœ¨é€‚é…å™¨ä¸­ï¼Œä»¥è®©å…¶å…¼å®¹å…¶ä»–ç±»ã€‚\nç»´åŸºç™¾ç§‘ä¸­è¯´\nåœ¨è½¯ä»¶å·¥ç¨‹ä¸­ï¼Œé€‚é…å™¨æ¨¡å¼æ˜¯ä¸€ç§å¯ä»¥è®©ç°æœ‰ç±»çš„æ¥å£æŠŠå…¶ä½œä¸ºå…¶ä»–æ¥å£æ¥ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼ã€‚å®ƒç»å¸¸ç”¨æ¥ä½¿ç°æœ‰çš„ç±»å’Œå…¶ä»–ç±»èƒ½å¤Ÿå·¥ä½œå¹¶ä¸”ä¸ç”¨ä¿®æ”¹å…¶ä»–ç±»çš„æºä»£ç ã€‚\né€‚é…å™¨æ¨¡å¼ç”±ä¸‰ä¸ªä¸»è¦è§’è‰²ç»„æˆï¼š\nç›®æ ‡æ¥å£(Target Interface)ï¼šå®¢æˆ·ç«¯æ‰€æœŸæœ›çš„æ¥å£ã€‚é€‚é…å™¨æ¨¡å¼ä¼šåˆ›å»ºä¸€ä¸ªå®ç°ç›®æ ‡æ¥å£çš„æ–°ç±»ï¼Œä»¥ä¾¿å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è¯¥æ¥å£è°ƒç”¨å®ƒã€‚\né€‚é…å™¨(Adapter)ï¼šè¯¥ç±»å®ç°äº†ç›®æ ‡æ¥å£ï¼Œå¹¶å°†å®¢æˆ·ç«¯çš„è¯·æ±‚è½¬æ¢ä¸ºå¯¹é€‚é…è€…çš„è°ƒç”¨ã€‚é€‚é…å™¨é€šå¸¸ä¼šèšåˆä¸€ä¸ªé€‚é…è€…å¯¹è±¡ï¼Œä»¥ä¾¿å°†è¯·æ±‚å§”æ‰˜ç»™å®ƒã€‚\né€‚é…è€…(Adapteree)ï¼šé€‚é…å™¨æ¨¡å¼çš„å®é™…å·¥ä½œå†…å®¹ã€‚é€‚é…è€…æ˜¯å®¢æˆ·ç«¯æ‰€æœŸæœ›çš„æ¥å£ä¹‹å¤–çš„ç±»ï¼Œå®ƒå®ç°äº†å®¢æˆ·ç«¯éœ€è¦çš„åŠŸèƒ½ï¼Œä½†å…¶æ¥å£ä¸å®¢æˆ·ç«¯æ‰€æœŸæœ›çš„æ¥å£ä¸å…¼å®¹ã€‚\nç¼–ç¨‹æ ·ä¾‹(å¯¹è±¡é€‚é…å™¨)\nå‡å¦‚æœ‰ä¸€ä¸ªèˆ¹é•¿ä»–åªä¼šåˆ’èˆ¹ï¼Œä½†ä¸ä¼šèˆªè¡Œã€‚\né¦–å…ˆæˆ‘ä»¬æœ‰æ¥å£RowingBoatå’ŒFishingBoat\npublic interface RowingBoat { void row(); } @Slf4j public class FishingBoat { public void sail() { LOGGER.info(\u0026#34;The fishing boat is sailing\u0026#34;); } } èˆ¹é•¿å¸Œæœ›æœ‰ä¸€ä¸ªRowingBoatæ¥å£çš„å®ç°ï¼Œè¿™æ ·å°±å¯ä»¥ç§»åŠ¨\npublic class Captain { private final RowingBoat rowingBoat; // default constructor and setter for rowingBoat public Captain(RowingBoat rowingBoat) { this.rowingBoat = rowingBoat; } public void row() { rowingBoat.row(); } } ç°åœ¨æµ·ç›—æ¥äº†ï¼Œæˆ‘ä»¬çš„èˆ¹é•¿éœ€è¦é€ƒè·‘ä½†æ˜¯åªæœ‰ä¸€ä¸ªæ¸”èˆ¹å¯ç”¨ã€‚æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå¯ä»¥è®©èˆ¹é•¿ä½¿ç”¨å…¶åˆ’èˆ¹æŠ€èƒ½æ¥æ“ä½œæ¸”èˆ¹çš„é€‚é…å™¨ã€‚\n@Slf4j public class FishingBoatAdapter implements RowingBoat { private final FishingBoat boat; public FishingBoatAdapter() { boat = new FishingBoat(); } @Override public void row() { boat.sail(); } } ç°åœ¨ èˆ¹é•¿ å¯ä»¥ä½¿ç”¨FishingBoatæ¥å£æ¥é€ƒç¦»æµ·ç›—äº†ã€‚\nvar captain = new Captain(new FishingBoatAdapter()); captain.row(); ç±»å›¾ ä¼˜ç¼ºç‚¹ é€‚é…å™¨æ¨¡å¼çš„ä¸»è¦ä¼˜ç‚¹æ˜¯ï¼Œå®ƒå¯ä»¥å°†ä¸å…¼å®¹çš„ç±»å’Œæ¥å£è¿æ¥èµ·æ¥ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥ååŒå·¥ä½œã€‚é€‚é…å™¨æ¨¡å¼è¿˜å¯ä»¥å‡å°‘ä»£ç é‡å¤ï¼Œå› ä¸ºå®ƒå¯ä»¥å°†ç°æœ‰çš„ç±»é‡ç”¨åœ¨æ–°çš„ä¸Šä¸‹æ–‡ä¸­ã€‚æ­¤å¤–ï¼Œé€‚é…å™¨æ¨¡å¼å¯ä»¥å¸®åŠ©åº”å¯¹ä¸ç¨³å®šçš„æ¥å£ï¼Œå› ä¸ºå®ƒå¯ä»¥å°†æ¥å£å˜åŒ–éš”ç¦»åˆ°é€‚é…å™¨ä¸­ã€‚\né€‚é…å™¨æ¨¡å¼çš„ä¸»è¦ç¼ºç‚¹æ˜¯ï¼Œå®ƒå¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿè°ƒç”¨é“¾çš„å¢åŠ ï¼Œå› ä¸ºå®ƒéœ€è¦æ·»åŠ é¢å¤–çš„å¯¹è±¡æ¥è¿›è¡Œè½¬æ¢ã€‚æ­¤å¤–ï¼Œé€‚é…å™¨æ¨¡å¼å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ï¼Œå› ä¸ºå®ƒéœ€è¦æ‰§è¡Œé¢å¤–çš„å¤„ç†æ¥è¿›è¡Œè½¬æ¢ã€‚\nåº”ç”¨ é€‚é…å™¨æ¨¡å¼é€šå¸¸ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š\nå°†ç°æœ‰çš„ç±»æˆ–æ¥å£ä¸æ–°çš„ä»£ç é›†æˆï¼šé€‚é…å™¨å¯ä»¥å°†ç°æœ‰çš„ç±»æˆ–æ¥å£ä¸æ–°çš„ä»£ç é›†æˆï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥ååŒå·¥ä½œã€‚ ä¸ç¬¬ä¸‰æ–¹åº“æˆ–ç»„ä»¶é›†æˆï¼šé€‚é…å™¨å¯ä»¥å°†ç¬¬ä¸‰æ–¹åº“æˆ–ç»„ä»¶çš„æ¥å£ä¸åº”ç”¨ç¨‹åºçš„æ¥å£è¿›è¡Œè½¬æ¢ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥ååŒå·¥ä½œã€‚ åº”å¯¹ä¸ç¨³å®šçš„æ¥å£ï¼šé€‚é…å™¨å¯ä»¥å°†ä¸ç¨³å®šçš„æ¥å£å°è£…åœ¨ä¸€ä¸ªé€‚é…å™¨ä¸­ï¼Œä»¥ä¾¿å°†æ¥æ¥å£å˜åŒ–æ—¶åªéœ€è¦æ›´æ”¹é€‚é…å™¨å³å¯ã€‚ å®ç°å¤šä¸ªæ¥å£ï¼šé€‚é…å™¨å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼Œä»¥ä¾¿ä¸€ä¸ªå¯¹è±¡å¯ä»¥åŒæ—¶è¢«å¤šä¸ªç±»ä½¿ç”¨ã€‚ åœ¨æµ‹è¯•ä¸­ä½¿ç”¨ï¼šé€‚é…å™¨å¯ä»¥åœ¨æµ‹è¯•ä¸­æ¨¡æ‹Ÿæ¥å£çš„è¡Œä¸ºï¼Œä»¥ä¾¿æµ‹è¯•ç¨‹åºçš„å„ç§ç”¨ä¾‹ã€‚ å…¼å®¹ä¸åŒç‰ˆæœ¬ï¼šå¦‚æœåº”ç”¨ç¨‹åºéœ€è¦ä¸å¤šä¸ªç‰ˆæœ¬çš„åŒä¸€æ¥å£è¿›è¡Œäº¤äº’ï¼Œå¯ä»¥ä½¿ç”¨é€‚é…å™¨æ¨¡å¼æ¥å¤„ç†ä¸åŒç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚ã€‚ é‡ç”¨ç°æœ‰ä»£ç ï¼šå¦‚æœéœ€è¦é‡ç”¨ç°æœ‰çš„ä»£ç ï¼Œä½†å…¶æ¥å£ä¸æ‰€éœ€æ¥å£ä¸å…¼å®¹ï¼Œåˆ™å¯ä»¥ä½¿ç”¨é€‚é…å™¨æ¨¡å¼æ¥é‡ç”¨ä»£ç ã€‚ æ•°æ®åº“é©±åŠ¨ç¨‹åºï¼šæ•°æ®åº“é©±åŠ¨ç¨‹åºé€šå¸¸ä½¿ç”¨é€‚é…å™¨æ¨¡å¼ï¼Œä»¥ä¾¿å°†æ•°æ®åº“çš„ä¸åŒæ¥å£è½¬æ¢ä¸º Java JDBC æ¥å£ã€‚ æ—¥å¿—è®°å½•ï¼šæ—¥å¿—è®°å½•åº“é€šå¸¸ä½¿ç”¨é€‚é…å™¨æ¨¡å¼ï¼Œä»¥ä¾¿å°†ä¸åŒçš„æ—¥å¿—è®°å½•æ¥å£è½¬æ¢ä¸ºé€šç”¨çš„æ¥å£ã€‚ æ‰©å±•ç°æœ‰åŠŸèƒ½ï¼šå¦‚æœéœ€è¦æ‰©å±•ç°æœ‰åŠŸèƒ½ï¼Œä½†å…¶æ¥å£ä¸æ‰€éœ€æ¥å£ä¸å…¼å®¹ï¼Œåˆ™å¯ä»¥ä½¿ç”¨é€‚é…å™¨æ¨¡å¼æ¥æ‰©å±•ç°æœ‰åŠŸèƒ½ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨é€‚é…å™¨æ¨¡å¼çš„æ—¥å¿—è®°å½•åº“çš„ç¤ºä¾‹ï¼š\nç›®æ ‡æ¥å£ï¼šå®šä¹‰é€šç”¨çš„æ—¥å¿—è®°å½•å™¨æ¥å£ã€‚ public interface Logger { void log(String message); } é€‚é…å™¨ï¼šå®šä¹‰ä¸€ä¸ªé€‚é…å™¨ç±»ï¼Œå®ç°ç›®æ ‡æ¥å£ï¼Œå¹¶èšåˆä¸åŒæ—¥å¿—æ¡†æ¶çš„å¯¹è±¡ã€‚ public class LogAdapter implements Logger { private Log4j log; public LogAdapter(Log4j log) { this.log = log; } @Override public void log(String message) { log.trace(message); } } é€‚é…è€…ï¼šå®šä¹‰ä¸€ä¸ª Log4j æ—¥å¿—æ¡†æ¶çš„ç±»ã€‚ public class Log4j { public void trace(String message) { // ä½¿ç”¨Log4jè¿›è¡Œæ—¥å¿—è®°å½• } } ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é€‚é…å™¨æ¥å°†ä¸åŒçš„æ—¥å¿—æ¡†æ¶è½¬æ¢ä¸ºé€šç”¨çš„ Logger æ¥å£ï¼š\nLog4j log4j = new Log4j(); Logger logger = new LogAdapter(log4j); logger.log(\u0026#34;This is a log message\u0026#34;); åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œé€‚é…å™¨æ¨¡å¼å…è®¸æˆ‘ä»¬å°† Log4j æ¡†æ¶çš„æ¥å£è½¬æ¢ä¸ºé€šç”¨çš„ Logger æ¥å£ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Logger æ¥å£è®°å½•æ—¥å¿—è€Œä¸å¿…å…³å¿ƒå…·ä½“ä½¿ç”¨çš„æ—¥å¿—æ¡†æ¶ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦åˆ‡æ¢åˆ°å…¶ä»–æ—¥å¿—æ¡†æ¶ï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„é€‚é…å™¨å³å¯ã€‚\né™¤äº†é€‚é…å™¨æ¨¡å¼çš„åº”ç”¨åœºæ™¯å’Œå¸¸è§å¼€æºæ¡†æ¶ä¸­çš„ä½¿ç”¨ç¤ºä¾‹å¤–ï¼Œé€‚é…å™¨è¿˜æœ‰å…¶ä»–ä¸€äº›ç›¸å…³çš„æ¦‚å¿µå’ŒæŠ€æœ¯ï¼š\nå¯¹è±¡é€‚é…å™¨å’Œç±»é€‚é…å™¨ï¼šé€‚é…å™¨æ¨¡å¼å¯ä»¥åˆ†ä¸ºå¯¹è±¡é€‚é…å™¨å’Œç±»é€‚é…å™¨ä¸¤ç§ã€‚å¯¹è±¡é€‚é…å™¨ä½¿ç”¨ç»„åˆçš„æ–¹å¼æ¥å®ç°é€‚é…å™¨æ¨¡å¼ï¼Œè€Œç±»é€‚é…å™¨ä½¿ç”¨ç»§æ‰¿çš„æ–¹å¼æ¥å®ç°é€‚é…å™¨æ¨¡å¼ã€‚ åŒå‘é€‚é…å™¨ï¼šåœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œéœ€è¦å°†ä¸¤ä¸ªä¸å…¼å®¹çš„æ¥å£äº’ç›¸é€‚é…ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨åŒå‘é€‚é…å™¨æ¨¡å¼æ¥å®ç°åŒå‘çš„é€‚é…ã€‚ æ¥å£é€‚é…å™¨ï¼šå½“ä¸€ä¸ªæ¥å£ä¸­æœ‰å¤ªå¤šçš„æ–¹æ³•ï¼Œè€Œå®ç°è¯¥æ¥å£çš„ç±»åªéœ€è¦å…¶ä¸­çš„ä¸€éƒ¨åˆ†æ–¹æ³•æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ¥å£é€‚é…å™¨æ¨¡å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æ¥å£é€‚é…å™¨æ¨¡å¼å°†ä¸€ä¸ªæ¥å£æ‹†åˆ†æˆå¤šä¸ªæ¥å£ï¼Œå¹¶æä¾›ä¸€ä¸ªé»˜è®¤çš„ç©ºå®ç°ï¼Œä½¿å¾—å®ç°è¯¥æ¥å£çš„ç±»å¯ä»¥åªå®ç°è‡ªå·±éœ€è¦çš„æ–¹æ³•ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªåŒå‘é€‚é…å™¨çš„ç¤ºä¾‹ï¼š\nå‡è®¾æœ‰ä¸¤ä¸ªæ¥å£ï¼Œåˆ†åˆ«æ˜¯ Shape å’Œ IRectangleï¼Œå…¶ä¸­ Shape è¡¨ç¤ºä¸€ä¸ªå½¢çŠ¶ï¼ŒIRectangle è¡¨ç¤ºä¸€ä¸ªçŸ©å½¢ã€‚Shape æ¥å£æœ‰ä¸¤ä¸ªæ–¹æ³• draw() å’Œ resize()ï¼Œè€Œ IRectangle æ¥å£æœ‰ä¸‰ä¸ªæ–¹æ³• setOrigin(), setWidth() å’Œ setHeight()ã€‚\nç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™ä¸¤ä¸ªæ¥å£äº’ç›¸é€‚é…ã€‚æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªåŒå‘é€‚é…å™¨ ShapeToRectangleAdapterï¼Œå®ƒå®ç°äº†è¿™ä¸¤ä¸ªæ¥å£ï¼Œå¹¶ä¸”å¯ä»¥å°†ä¸€ä¸ª Shape å¯¹è±¡é€‚é…åˆ°ä¸€ä¸ª IRectangle å¯¹è±¡ä¸­ï¼Œä¹Ÿå¯ä»¥å°†ä¸€ä¸ª IRectangle å¯¹è±¡é€‚é…åˆ°ä¸€ä¸ª Shape å¯¹è±¡ä¸­ã€‚å…·ä½“å®ç°å¦‚ä¸‹ï¼š\npublic interface Shape { void draw(); void resize(int width, int height); void move(int x, int y); } public interface IRectangle { void setOrigin(int x, int y); void setWidth(int width); void setHeight(int height); void paint(); void stretch(); } public class ShapeToRectangleAdapter implements Shape, IRectangle { private Shape shape; private IRectangle rectangle; public ShapeToRectangleAdapter(Shape shape) { this.shape = shape; } public ShapeToRectangleAdapter(IRectangle rectangle) { this.rectangle = rectangle; } // å°† Shape é€‚é…åˆ° IRectangle ä¸­ public void setOrigin(int x, int y) { shape.move(x, y); } public void setWidth(int width) { shape.resize(width, shape.getHeight()); } public void setHeight(int height) { shape.resize(shape.getWidth(), height); } // å°† IRectangle é€‚é…åˆ° Shape ä¸­ public void draw() { rectangle.paint(); } public void resize(int width, int height) { rectangle.setWidth(width); rectangle.setHeight(height); } public void move(int x, int y) { rectangle.setOrigin(x, y); } public int getWidth() { return rectangle.getWidth(); } public int getHeight() { return rectangle.getHeight(); } public void paint() { shape.draw(); } public void stretch() { shape.resize(shape.getWidth() * 2, shape.getHeight() * 2); } } åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼ŒShapeToRectangleAdapter é€‚é…å™¨å®ç°äº† Shape å’Œ IRectangle æ¥å£ï¼Œå¹¶ä¸”åœ¨æ„é€ å‡½æ•°ä¸­æ¥æ”¶ä¸€ä¸ª Shape å¯¹è±¡æˆ– IRectangle å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œä»¥ä¾¿å°†å…¶é€‚é…åˆ°å¦ä¸€ä¸ªæ¥å£ä¸­ã€‚\nå½“éœ€è¦å°†ä¸€ä¸ª Shape å¯¹è±¡é€‚é…åˆ°ä¸€ä¸ª IRectangle å¯¹è±¡ä¸­æ—¶ï¼Œé€‚é…å™¨å®ç°äº† setOrigin()ã€setWidth() å’Œ setHeight() æ–¹æ³•ï¼Œå°† Shape å¯¹è±¡çš„ä½ç½®å’Œå¤§å°é€‚é…åˆ° IRectangle å¯¹è±¡ä¸­ã€‚\nå½“éœ€è¦å°†ä¸€ä¸ª IRectangle å¯¹è±¡é€‚é…åˆ°ä¸€ä¸ª Shape å¯¹è±¡ä¸­æ—¶ï¼Œé€‚é…å™¨å®ç°äº† draw() å’Œ resize() æ–¹æ³•ï¼Œå°† IRectangle å¯¹è±¡çš„ç»˜åˆ¶å’Œå¤§å°è°ƒæ•´é€‚é…åˆ° Shape å¯¹è±¡ä¸­ã€‚\nè¿™æ ·ï¼Œé€šè¿‡åŒå‘é€‚é…å™¨ï¼Œæˆ‘ä»¬å¯ä»¥å°† Shape å’Œ IRectangle æ¥å£äº’ç›¸é€‚é…ï¼Œä½¿å¾—å®ƒä»¬å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™äº’ç›¸è°ƒç”¨ã€‚\nå¯¹æ¯” é€‚é…å™¨æ¨¡å¼å’Œè£…é¥°å™¨æ¨¡å¼éƒ½æ˜¯å¸¸è§çš„ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒä»¬çš„ä½œç”¨éƒ½æ˜¯ä¸ºäº†å¢å¼ºç±»çš„åŠŸèƒ½ã€‚è™½ç„¶è¿™ä¸¤ç§æ¨¡å¼å…·æœ‰æŸäº›ç›¸ä¼¼ä¹‹å¤„ï¼Œä½†å®ƒä»¬ä¹‹é—´ä¹Ÿå­˜åœ¨ä¸€äº›é‡è¦çš„åŒºåˆ«ã€‚ä¸‹é¢æ˜¯é€‚é…å™¨æ¨¡å¼å’Œè£…é¥°å™¨æ¨¡å¼ä¹‹é—´çš„åŒºåˆ«ï¼š\nç›®çš„ä¸åŒï¼šé€‚é…å™¨æ¨¡å¼çš„ç›®çš„æ˜¯å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢ä¸ºå¦ä¸€ä¸ªç±»çš„æ¥å£ï¼Œä»¥ä¾¿è¿™ä¸¤ä¸ªç±»å¯ä»¥ååŒå·¥ä½œã€‚è€Œè£…é¥°å™¨æ¨¡å¼çš„ç›®çš„æ˜¯ä¸ºä¸€ä¸ªå¯¹è±¡æ·»åŠ æ–°çš„åŠŸèƒ½ï¼ŒåŒæ—¶ä¸æ”¹å˜å…¶åŸæœ‰çš„æ¥å£å’Œå®ç°ã€‚ é€‚é…æ–¹å¼ä¸åŒï¼šé€‚é…å™¨æ¨¡å¼é€šå¸¸ä½¿ç”¨å¯¹è±¡é€‚é…å™¨æˆ–ç±»é€‚é…å™¨æ¥å®ç°ã€‚å¯¹è±¡é€‚é…å™¨ä½¿ç”¨ç»„åˆå…³ç³»å°†é€‚é…å™¨åŒ…è£…åœ¨å¦ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œè€Œç±»é€‚é…å™¨ä½¿ç”¨å¤šé‡ç»§æ‰¿æ¥å®ç°é€‚é…å™¨ã€‚è€Œè£…é¥°å™¨æ¨¡å¼å§‹ç»ˆä½¿ç”¨å¯¹è±¡ç»„åˆæ¥å®ç°ã€‚ ä½¿ç”¨åœºæ™¯ä¸åŒï¼šé€‚é…å™¨æ¨¡å¼é€šå¸¸ç”¨äºé›†æˆç¬¬ä¸‰æ–¹ç±»æˆ–æ¥å£ï¼Œæˆ–æ˜¯å°†ä¸å…¼å®¹çš„æ¥å£è½¬æ¢ä¸ºå…¼å®¹çš„æ¥å£ã€‚è€Œè£…é¥°å™¨æ¨¡å¼é€šå¸¸ç”¨äºåœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°ä¸ºä¸€ä¸ªå¯¹è±¡æ·»åŠ æ–°çš„åŠŸèƒ½ã€‚ å¯¹è±¡çš„å…³ç³»ä¸åŒï¼šé€‚é…å™¨æ¨¡å¼ä¸­ï¼Œé€‚é…å™¨ä¸è¢«é€‚é…è€…ä¹‹é—´æ˜¯ä¸€ç§é™æ€å…³ç³»ï¼Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»åœ¨ç¼–è¯‘æ—¶å°±å·²ç»ç¡®å®šã€‚è€Œè£…é¥°å™¨æ¨¡å¼ä¸­ï¼Œè£…é¥°å™¨ä¸è¢«è£…é¥°è€…ä¹‹é—´æ˜¯ä¸€ç§åŠ¨æ€å…³ç³»ï¼Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»åœ¨è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šã€‚ é€‚é…å™¨æ¨¡å¼çš„åº”ç”¨åœºæ™¯ï¼š\nåœ¨é›†æˆç¬¬ä¸‰æ–¹ç±»æˆ–æ¥å£æ—¶ï¼Œå¯ä»¥ä½¿ç”¨é€‚é…å™¨æ¨¡å¼å°†å…¶æ¥å£è½¬æ¢ä¸ºåº”ç”¨ç¨‹åºæ‰€éœ€çš„æ¥å£ã€‚ å½“éœ€è¦ä½¿ç”¨æŸä¸ªç±»çš„æ–¹æ³•ï¼Œä½†è¯¥ç±»çš„æ¥å£ä¸åº”ç”¨ç¨‹åºçš„æ¥å£ä¸å…¼å®¹æ—¶ï¼Œå¯ä»¥ä½¿ç”¨é€‚é…å™¨æ¨¡å¼å°†è¯¥ç±»çš„æ¥å£è½¬æ¢ä¸ºåº”ç”¨ç¨‹åºæ‰€éœ€çš„æ¥å£ã€‚ å½“éœ€è¦å°†ä¸€ç§æ•°æ®æ ¼å¼è½¬æ¢ä¸ºå¦ä¸€ç§æ•°æ®æ ¼å¼æ—¶ï¼Œå¯ä»¥ä½¿ç”¨é€‚é…å™¨æ¨¡å¼å°†æ•°æ®æ ¼å¼è½¬æ¢ä¸ºåº”ç”¨ç¨‹åºæ‰€éœ€çš„æ ¼å¼ã€‚ ä¾‹å¦‚ï¼Œå°†ä¸€ä¸ªç”µå™¨æ’å¤´æ’å…¥åˆ°å¢™ä¸Šçš„æ’åº§ä¸­ï¼Œè¿™ä¸¤ä¸ªæ¥å£æ˜¯ä¸å…¼å®¹çš„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ’å¤´é€‚é…å™¨ï¼Œå°†ç”µå™¨æ’å¤´çš„æ¥å£è½¬æ¢ä¸ºå¢™ä¸Šæ’åº§çš„æ¥å£ï¼Œä»¥ä¾¿ç”µå™¨å¯ä»¥ä¸å¢™ä¸Šçš„æ’åº§ååŒå·¥ä½œã€‚\nè£…é¥°å™¨æ¨¡å¼çš„åº”ç”¨åœºæ™¯ï¼š\nå½“éœ€è¦ä¸ºä¸€ä¸ªå¯¹è±¡åŠ¨æ€åœ°æ·»åŠ æ–°çš„åŠŸèƒ½æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼ã€‚ å½“éœ€è¦ä¸ºä¸€ä¸ªå¯¹è±¡æ·»åŠ çš„å¤šä¸ªåŠŸèƒ½å…·æœ‰ä¸åŒçš„ç»„åˆæ–¹å¼æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼ã€‚ ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªåœ¨çº¿å•†åº—ä¸­ï¼Œç”¨æˆ·å¯ä»¥è´­ä¹°å•†å“å¹¶è¿›è¡Œæ”¯ä»˜ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼æ¥ä¸ºè®¢å•å¯¹è±¡æ·»åŠ æ–°çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æ·»åŠ ä¼˜æƒ åˆ¸ã€æ·»åŠ ç¤¼å“åŒ…è£…ã€æ·»åŠ å¿«é€’ä¿é™©ç­‰ã€‚è¿™äº›åŠŸèƒ½å¯ä»¥æ ¹æ®ç”¨æˆ·çš„éœ€æ±‚è¿›è¡Œç»„åˆï¼Œå¹¶ä¸”å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°æ·»åŠ æˆ–åˆ é™¤ã€‚\næ€»ä¹‹ï¼Œé€‚é…å™¨æ¨¡å¼å’Œè£…é¥°å™¨æ¨¡å¼éƒ½æ˜¯ä¸ºäº†å¢å¼ºç±»çš„åŠŸèƒ½ï¼Œä½†å®ƒä»¬çš„ç›®çš„å’Œå®ç°æ–¹å¼ä¸åŒã€‚é€‚é…å™¨æ¨¡å¼æ˜¯ä¸ºäº†è§£å†³æ¥å£ä¸å…¼å®¹çš„é—®é¢˜ï¼Œè€Œè£…é¥°å™¨æ¨¡å¼æ˜¯ä¸ºäº†åŠ¨æ€åœ°ä¸ºä¸€ä¸ªå¯¹è±¡æ·»åŠ æ–°çš„åŠŸèƒ½ã€‚\nä¸¾ä¾‹ ä»¥ä¸‹æ˜¯å¸¸è§å¼€æºæ¡†æ¶ä¸­ä½¿ç”¨é€‚é…å™¨æ¨¡å¼çš„ä¸€äº›ç¤ºä¾‹ï¼š\nSpring æ¡†æ¶ï¼šSpring æ¡†æ¶ä¸­çš„ HandlerAdapter æ¥å£å°±æ˜¯ä¸€ä¸ªé€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚ä¸åŒçš„ HandlerAdapter å®ç°ç±»å¯ä»¥å°†ä¸åŒç±»å‹çš„æ§åˆ¶å™¨ï¼ˆå¦‚ Servletã€Strutsã€JSFï¼‰é€‚é…åˆ° Spring MVC æ¡†æ¶ä¸­ã€‚ Hibernate æ¡†æ¶ï¼šHibernate æ¡†æ¶ä¸­çš„ ConnectionProvider æ¥å£ä¹Ÿæ˜¯ä¸€ä¸ªé€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚ä¸åŒçš„ ConnectionProvider å®ç°ç±»å¯ä»¥å°†ä¸åŒç±»å‹çš„æ•°æ®æºï¼ˆå¦‚ JDBCã€JTAï¼‰é€‚é…åˆ° Hibernate æ¡†æ¶ä¸­ã€‚ Log4j æ¡†æ¶ï¼šLog4j æ¡†æ¶ä¸­çš„ Appender æ¥å£ä¹Ÿæ˜¯ä¸€ä¸ªé€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚ä¸åŒçš„ Appender å®ç°ç±»å¯ä»¥å°†ä¸åŒç±»å‹çš„æ—¥å¿—è¾“å‡ºé€‚é…åˆ° Log4j æ¡†æ¶ä¸­ã€‚ JUnit æ¡†æ¶ï¼šJUnit æ¡†æ¶ä¸­çš„ Test æ¥å£ä¹Ÿæ˜¯ä¸€ä¸ªé€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚ä¸åŒçš„ Test å®ç°ç±»å¯ä»¥å°†ä¸åŒç±»å‹çš„æµ‹è¯•ç”¨ä¾‹é€‚é…åˆ° JUnit æ¡†æ¶ä¸­ã€‚ Java Swing æ¡†æ¶ï¼šJava Swing æ¡†æ¶ä¸­çš„ JList ç»„ä»¶ä¹Ÿæ˜¯ä¸€ä¸ªé€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚JList ç»„ä»¶å¯ä»¥ä½¿ç”¨é€‚é…å™¨å°†ä¸åŒç±»å‹çš„æ•°æ®æºï¼ˆå¦‚æ•°ç»„ã€é›†åˆï¼‰é€‚é…åˆ° JList ç»„ä»¶ä¸­ã€‚ Apache Commons æ¡†æ¶ï¼šApache Commons æ¡†æ¶ä¸­çš„ FileFilter æ¥å£ä¹Ÿæ˜¯ä¸€ä¸ªé€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚ä¸åŒçš„ FileFilter å®ç°ç±»å¯ä»¥å°†ä¸åŒç±»å‹çš„æ–‡ä»¶è¿‡æ»¤å™¨é€‚é…åˆ° Apache Commons æ¡†æ¶ä¸­ã€‚ Apache Shiro æ¡†æ¶ï¼šApache Shiro æ¡†æ¶ä¸­çš„ Realm æ¥å£ä¹Ÿæ˜¯ä¸€ä¸ªé€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚ä¸åŒçš„ Realm å®ç°ç±»å¯ä»¥å°†ä¸åŒç±»å‹çš„èº«ä»½éªŒè¯å’Œæˆæƒæœºåˆ¶é€‚é…åˆ° Apache Shiro æ¡†æ¶ä¸­ã€‚ Apache Struts æ¡†æ¶ï¼šApache Struts æ¡†æ¶ä¸­çš„ Action æ¥å£ä¹Ÿæ˜¯ä¸€ä¸ªé€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚ä¸åŒçš„ Action å®ç°ç±»å¯ä»¥å°†ä¸åŒç±»å‹çš„è¯·æ±‚å¤„ç†é€‚é…åˆ° Apache Struts æ¡†æ¶ä¸­ã€‚ Android æ¡†æ¶ï¼šAndroid æ¡†æ¶ä¸­çš„ ArrayAdapter ç±»ä¹Ÿæ˜¯ä¸€ä¸ªé€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚ArrayAdapter ç±»å¯ä»¥ä½¿ç”¨é€‚é…å™¨å°†ä¸åŒç±»å‹çš„æ•°æ®æºï¼ˆå¦‚æ•°ç»„ã€é›†åˆï¼‰é€‚é…åˆ° Android UI ç»„ä»¶ä¸­ã€‚ Spring Boot æ¡†æ¶ï¼šSpring Boot æ¡†æ¶ä¸­çš„ CommandLineRunner æ¥å£ä¹Ÿæ˜¯ä¸€ä¸ªé€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚ä¸åŒçš„ CommandLineRunner å®ç°ç±»å¯ä»¥å°†ä¸åŒç±»å‹çš„å‘½ä»¤è¡Œå‚æ•°é€‚é…åˆ° Spring Boot æ¡†æ¶ä¸­ã€‚ Apache Camel æ¡†æ¶ï¼šApache Camel æ¡†æ¶ä¸­çš„ Component æ¥å£ä¹Ÿæ˜¯ä¸€ä¸ªé€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚ä¸åŒçš„ Component å®ç°ç±»å¯ä»¥å°†ä¸åŒç±»å‹çš„æ¶ˆæ¯ä¼ è¾“åè®®ï¼ˆå¦‚ HTTPã€FTP ç­‰ï¼‰é€‚é…åˆ° Apache Camel æ¡†æ¶ä¸­ã€‚ Jersey æ¡†æ¶ï¼šJersey æ¡†æ¶ä¸­çš„ MessageBodyReader å’Œ MessageBodyWriter æ¥å£ä¹Ÿæ˜¯é€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚è¿™ä¸¤ä¸ªæ¥å£å¯ä»¥å°†ä¸åŒç±»å‹çš„è¯·æ±‚æˆ–å“åº”æ¶ˆæ¯é€‚é…åˆ° Jersey æ¡†æ¶ä¸­ã€‚ Retrofit æ¡†æ¶ï¼šRetrofit æ¡†æ¶ä¸­çš„ Converter æ¥å£ä¹Ÿæ˜¯ä¸€ä¸ªé€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚ä¸åŒçš„ Converter å®ç°ç±»å¯ä»¥å°†ä¸åŒç±»å‹çš„å“åº”æ¶ˆæ¯è½¬æ¢ä¸º Java å¯¹è±¡ï¼Œå¹¶é€‚é…åˆ° Retrofit æ¡†æ¶ä¸­ã€‚ Logback æ¡†æ¶ï¼šLogback æ¡†æ¶ä¸­çš„ Appender æ¥å£ä¹Ÿæ˜¯é€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚ä¸åŒçš„ Appender å®ç°ç±»å¯ä»¥å°†ä¸åŒç±»å‹çš„æ—¥å¿—è¾“å‡ºé€‚é…åˆ° Logback æ¡†æ¶ä¸­ã€‚ Apache Kafka æ¡†æ¶ï¼šApache Kafka æ¡†æ¶ä¸­çš„ Consumer å’Œ Producer æ¥å£ä¹Ÿæ˜¯é€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚ä¸åŒçš„ Consumer å’Œ Producer å®ç°ç±»å¯ä»¥å°†ä¸åŒç±»å‹çš„æ¶ˆæ¯ä¼ è¾“åè®®é€‚é…åˆ° Apache Kafka æ¡†æ¶ä¸­ã€‚ ä»¥ä¸‹æ˜¯ jdk ä¸­ä½¿ç”¨é€‚é…å™¨æ¨¡å¼çš„ä¾‹å­ï¼š\njava.util.Arrays#asList() è¯¥æ–¹æ³•å°†æ•°ç»„è½¬æ¢ä¸º List é›†åˆã€‚ç”±äºæ•°ç»„å’Œ List é›†åˆçš„æ¥å£ä¸å…¼å®¹ï¼Œæ‰€ä»¥è¯¥æ–¹æ³•ä½¿ç”¨äº†é€‚é…å™¨æ¨¡å¼å°†æ•°ç»„è½¬æ¢ä¸º List é›†åˆã€‚ java.util.Collections#list() è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ª Enumeration å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå¹¶å°†è¯¥ Enumeration å¯¹è±¡è½¬æ¢ä¸ºä¸€ä¸ª Listã€‚ java.util.Collections#enumeration() è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ª Collection å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå¹¶å°†è¯¥ Collection å¯¹è±¡è½¬æ¢ä¸ºä¸€ä¸ª Enumeration å¯¹è±¡ã€‚ javax.xml.bind.annotation.adapters.XMLAdapter è¯¥ç±»æ˜¯ç”¨äº XML åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„é€‚é…å™¨ã€‚å®ƒå¯ä»¥å°† Java å¯¹è±¡è½¬æ¢ä¸º XML å…ƒç´ ï¼Œå¹¶åœ¨ååºåˆ—åŒ–æ—¶å°† XML å…ƒç´ è½¬æ¢å› Java å¯¹è±¡ã€‚ java.io.InputStreamReader å’Œ java.io.OutputStreamWriter ç±»ï¼šè¿™ä¸¤ä¸ªç±»æ˜¯ç”¨äºè¯»å†™å­—ç¬¦æµçš„åŒ…è£…å™¨ç±»ã€‚å®ƒä»¬ä½¿ç”¨é€‚é…å™¨æ¨¡å¼å°†å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦æµï¼Œä»¥ä¾¿è¯»å†™å­—ç¬¦æ•°æ®ã€‚ javax.servlet.ServletRequestWrapper å’Œ javax.servlet.ServletResponseWrapper ç±»ï¼šè¿™ä¸¤ä¸ªç±»æ˜¯ç”¨äº HTTP è¯·æ±‚å’Œå“åº”çš„åŒ…è£…å™¨ç±»ã€‚å®ƒä»¬ä½¿ç”¨é€‚é…å™¨æ¨¡å¼å°† HTTP è¯·æ±‚å’Œå“åº”è½¬æ¢ä¸º Servlet API ä¸­å®šä¹‰çš„æ¥å£ï¼Œä»¥ä¾¿åœ¨ Servlet ä¸­ä½¿ç”¨ã€‚ ","permalink":"https://blog.chensoul.cc/posts/2023/06/10/java-design-patterns-adapter/","summary":"æœ¬æ–‡ä¸»è¦ä»‹ç» Adapter æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nJava Design Patterns æä¾›äº†å„ç§ Java è®¾è®¡æ¨¡å¼çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ã€‚è¯¥ç½‘ç«™æ—¨åœ¨å¸®åŠ© Java å¼€å‘äººå‘˜äº†è§£å’Œåº”ç”¨å„ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚\nJava Design Patterns ç½‘ç«™æä¾›äº†å¤šç§è®¾è®¡æ¨¡å¼åˆ†ç±»æ–¹å¼ï¼ŒåŒ…æ‹¬åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational Patternsï¼‰ã€ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternsï¼‰å’Œè¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰ï¼Œä»¥åŠå…¶ä»–ä¸€äº›å¸¸è§çš„æ¨¡å¼ã€‚\nå¯¹äºæ¯ä¸ªè®¾è®¡æ¨¡å¼ï¼Œè¯¥ç½‘ç«™æä¾›äº†è¯¦ç»†çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ï¼Œå¹¶ä¸”æä¾›äº†ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ã€‚å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©é€‚åˆè‡ªå·±çš„è®¾è®¡æ¨¡å¼ï¼Œå¹¶ä¸”å¯ä»¥å‚è€ƒç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜æ¥ç†è§£å’Œåº”ç”¨è¯¥æ¨¡å¼ã€‚\næ­¤å¤–ï¼ŒJava Design Patterns ç½‘ç«™è¿˜æä¾›äº†ä¸€äº›å…¶ä»–èµ„æºï¼Œå¦‚è®¾è®¡æ¨¡å¼çš„ UML å›¾ã€è®¾è®¡æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ã€è®¾è®¡æ¨¡å¼çš„æ¯”è¾ƒç­‰ã€‚è¿™äº›èµ„æºå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨è®¾è®¡æ¨¡å¼ã€‚\nä¸­æ–‡ç½‘ç«™ï¼šhttps://java-design-patterns.com/zh/\nGithub ä¸Šæºç ä»“åº“ï¼ˆéå®˜æ–¹ï¼‰ï¼šhttps://github.com/iluwatar/java-design-patterns\nç›®çš„ å°†ä¸€ä¸ªæ¥å£è½¬æ¢æˆå¦ä¸€ä¸ªå®¢æˆ·æ‰€æœŸæœ›çš„æ¥å£ã€‚é€‚é…å™¨è®©é‚£äº›æœ¬æ¥å› ä¸ºæ¥å£ä¸å…¼å®¹çš„ç±»å¯ä»¥åˆä½œæ— é—´ã€‚\né€‚é…å™¨æ¨¡å¼(Adapter Pattern)æ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·ç«¯æ‰€æœŸæœ›çš„å¦ä¸€ç§æ¥å£ã€‚é€‚é…å™¨æ¨¡å¼é€šå¸¸ç”¨äºè¿æ¥ä¸¤ä¸ªä¸å…¼å®¹çš„æ¥å£æˆ–ç±»ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥ååŒå·¥ä½œã€‚\nè§£é‡Š ç°å®ä¸–ç•Œä¾‹å­\nè€ƒè™‘æœ‰è¿™ä¹ˆä¸€ç§æƒ…å†µï¼Œåœ¨ä½ çš„å­˜å‚¨å¡ä¸­æœ‰ä¸€äº›ç…§ç‰‡ï¼Œä½ æƒ³å°†å…¶ä¼ åˆ°ä½ çš„ç”µè„‘ä¸­ã€‚ä¸ºäº†ä¼ é€æ•°æ®ï¼Œä½ éœ€è¦æŸç§èƒ½å¤Ÿå…¼å®¹ä½ ç”µè„‘æ¥å£çš„é€‚é…å™¨ä»¥ä¾¿ä½ çš„å‚¨å­˜å¡èƒ½è¿ä¸Šä½ çš„ç”µè„‘ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯»å¡å™¨å°±æ˜¯ä¸€ä¸ªé€‚é…å™¨ã€‚ å¦ä¸€ä¸ªä¾‹å­å°±æ˜¯æ³¨æ˜çš„ç”µæºé€‚é…å™¨ï¼›ä¸‰è„šæ’å¤´ä¸èƒ½æ’åœ¨ä¸¤è„šæ’åº§ä¸Šï¼Œéœ€è¦ä¸€ä¸ªç”µæºé€‚é…å™¨æ¥ä½¿å…¶èƒ½å¤Ÿæ’åœ¨ä¸¤è„šæ’åº§ä¸Šã€‚ è¿˜æœ‰ä¸€ä¸ªä¾‹å­å°±æ˜¯ç¿»è¯‘å®˜ï¼Œä»–ç¿»è¯‘ä¸€ä¸ªäººå¯¹å¦ä¸€ä¸ªäººè¯´çš„è¯ã€‚\nç”¨ç›´ç™½çš„è¯æ¥è¯´\né€‚é…å™¨æ¨¡å¼è®©ä½ å¯ä»¥æŠŠä¸å…¼å®¹çš„å¯¹è±¡åŒ…åœ¨é€‚é…å™¨ä¸­ï¼Œä»¥è®©å…¶å…¼å®¹å…¶ä»–ç±»ã€‚\nç»´åŸºç™¾ç§‘ä¸­è¯´\nåœ¨è½¯ä»¶å·¥ç¨‹ä¸­ï¼Œé€‚é…å™¨æ¨¡å¼æ˜¯ä¸€ç§å¯ä»¥è®©ç°æœ‰ç±»çš„æ¥å£æŠŠå…¶ä½œä¸ºå…¶ä»–æ¥å£æ¥ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼ã€‚å®ƒç»å¸¸ç”¨æ¥ä½¿ç°æœ‰çš„ç±»å’Œå…¶ä»–ç±»èƒ½å¤Ÿå·¥ä½œå¹¶ä¸”ä¸ç”¨ä¿®æ”¹å…¶ä»–ç±»çš„æºä»£ç ã€‚\né€‚é…å™¨æ¨¡å¼ç”±ä¸‰ä¸ªä¸»è¦è§’è‰²ç»„æˆï¼š\nç›®æ ‡æ¥å£(Target Interface)ï¼šå®¢æˆ·ç«¯æ‰€æœŸæœ›çš„æ¥å£ã€‚é€‚é…å™¨æ¨¡å¼ä¼šåˆ›å»ºä¸€ä¸ªå®ç°ç›®æ ‡æ¥å£çš„æ–°ç±»ï¼Œä»¥ä¾¿å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è¯¥æ¥å£è°ƒç”¨å®ƒã€‚\né€‚é…å™¨(Adapter)ï¼šè¯¥ç±»å®ç°äº†ç›®æ ‡æ¥å£ï¼Œå¹¶å°†å®¢æˆ·ç«¯çš„è¯·æ±‚è½¬æ¢ä¸ºå¯¹é€‚é…è€…çš„è°ƒç”¨ã€‚é€‚é…å™¨é€šå¸¸ä¼šèšåˆä¸€ä¸ªé€‚é…è€…å¯¹è±¡ï¼Œä»¥ä¾¿å°†è¯·æ±‚å§”æ‰˜ç»™å®ƒã€‚\né€‚é…è€…(Adapteree)ï¼šé€‚é…å™¨æ¨¡å¼çš„å®é™…å·¥ä½œå†…å®¹ã€‚é€‚é…è€…æ˜¯å®¢æˆ·ç«¯æ‰€æœŸæœ›çš„æ¥å£ä¹‹å¤–çš„ç±»ï¼Œå®ƒå®ç°äº†å®¢æˆ·ç«¯éœ€è¦çš„åŠŸèƒ½ï¼Œä½†å…¶æ¥å£ä¸å®¢æˆ·ç«¯æ‰€æœŸæœ›çš„æ¥å£ä¸å…¼å®¹ã€‚\nç¼–ç¨‹æ ·ä¾‹(å¯¹è±¡é€‚é…å™¨)\nå‡å¦‚æœ‰ä¸€ä¸ªèˆ¹é•¿ä»–åªä¼šåˆ’èˆ¹ï¼Œä½†ä¸ä¼šèˆªè¡Œã€‚\né¦–å…ˆæˆ‘ä»¬æœ‰æ¥å£RowingBoatå’ŒFishingBoat\npublic interface RowingBoat { void row(); } @Slf4j public class FishingBoat { public void sail() { LOGGER.info(\u0026#34;The fishing boat is sailing\u0026#34;); } } èˆ¹é•¿å¸Œæœ›æœ‰ä¸€ä¸ªRowingBoatæ¥å£çš„å®ç°ï¼Œè¿™æ ·å°±å¯ä»¥ç§»åŠ¨\npublic class Captain { private final RowingBoat rowingBoat; // default constructor and setter for rowingBoat public Captain(RowingBoat rowingBoat) { this.rowingBoat = rowingBoat; } public void row() { rowingBoat.","title":"Javaè®¾è®¡æ¨¡å¼ï¼šAdapter"},{"content":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-05-29 åˆ° 2023-06-04 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¯»ä¹¦ã€å¥èº«ã€å®šæŠ•ã€å¸®æœ‹å‹ã€é™ªå®¶äººï¼Œæœ¬å‘¨å‘¨æŠ¥å¢åŠ ä¸€å—å†…å®¹ï¼šè¯»ä¹¦ï¼Œè®°å½•æ¯å‘¨è¯»ä¹¦çš„æ—¶é—´ã€‚\nå¾®ä¿¡è¯»ä¹¦ç¬”è®°åŠ©æ‰‹ æœ€è¿‘æ³¨é”€äº†å¾®ä¿¡é˜…è¯»è´¦å·ï¼Œæ¸…ç©ºäº†å†å²æ•°æ®ã€‚æœ¬ç€å®ç¼ºæ¯‹æ»¥çš„åŸåˆ™ï¼Œä¹¦æ¶é‡æ–°æ·»åŠ äº†å‡ æœ¬ä¹¦ã€‚è®¡åˆ’æ˜¯é‡æ–°ä½¿ç”¨å¾®ä¿¡é˜…è¯»å…»æˆè¯»ä¹¦çš„ä¹ æƒ¯ã€‚\nåœ¨ chrome æµè§ˆå™¨æ·»åŠ äº†ä¸€ä¸ªæ’ä»¶ å¾®ä¿¡è¯»ä¹¦ç¬”è®°åŠ©æ‰‹ ï¼Œå¯ä»¥å°†è¯»ä¹¦ç¬”è®°ä¸€é”®å¯¼å‡ºä¸º markdown æ ¼å¼ã€‚\nå¯¼å‡ºçš„å†…å®¹æ ‡æ³¨æ˜¯ä¸€ä¸ªæ ‡æ³¨ä¸€ä¸ªæ®µè½ï¼Œæ®µè½ä¹‹é—´æœ‰ä¸€ä¸ªæ¢è¡Œã€‚æ®µè½åé¢å¯ä»¥æ·»åŠ è‡ªå·±çš„æ€è€ƒï¼ˆæ¯”å¦‚ï¼Œç”¨çº¢è‰²æ ‡æ³¨é¢œè‰²ï¼‰ã€‚\nè¯»ä¹¦ æœ¬å‘¨é˜…è¯»ç»Ÿè®¡ï¼ˆå›¾ç‰‡æ¥è‡ªå¾®ä¿¡é˜…è¯» app åˆ†äº«ï¼‰ï¼š\nç†è´¢ è¿™å‘¨æ€»è®¡æ”¯å‡º 2528 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š\n6 æœˆ 4 æ—¥ï¼š138 å…ƒ 6 æœˆ 3 æ—¥ï¼š1650 å…ƒï¼ŒåŒ»é™¢çœ‹ç—… 1600 6 æœˆ 2 æ—¥ï¼š61 å…ƒ 6 æœˆ 1 æ—¥ï¼š0 å…ƒ 5 æœˆ 31 æ—¥ï¼š108 å…ƒ 5 æœˆ 30 æ—¥ï¼š625 å…ƒï¼Œå…¬å¸åœè½¦åœºè´¹ç”¨ 600 5 æœˆ 29 æ—¥ï¼š41 å…ƒ å¥èº« æˆ‘è·‘è¿‡äº†ä¸€äº›åœ°æ–¹ï¼Œå¸Œæœ›éšç€æ—¶é—´æ¨ç§»ï¼Œåœ°å›¾ç‚¹äº®çš„åœ°æ–¹è¶Šæ¥è¶Šå¤šã€‚2 å¹´é‡Œæˆ‘è·‘è¿‡ 2 ä¸ªçœä»½ 2 ä¸ªåŸå¸‚ã€‚æ›´å¤šè·‘æ­¥æ•°æ®åœ¨æˆ‘çš„ è·‘æ­¥ ä¸»é¡µã€‚\næœ¬å‘¨è·‘æ­¥ 42.66 å…¬é‡Œï¼Œæœ€é•¿è·‘æ­¥è·ç¦»ä¸º 9.2 å…¬é‡Œã€‚\næ˜ç»†æ•°æ®å¦‚ä¸‹ï¼š\nåœ¨æœ‹å‹åœˆå‘äº†ä¸€ä¸ª 5 æœˆè·‘æ­¥ 500 å…¬é‡ŒåŠ¨æ€ï¼Œä¸€ä¸ªé«˜ä¸­åŒå­¦å»ºè®®æˆ‘ä¸è¦è¿‡åº¦è·‘æ­¥ï¼Œæœ€å¥½æ˜¯è·‘æ­¥ä¸€å¤©ä¼‘æ¯ä¸€å¤©ï¼Œä»¥å…ä¼¤äº†è†ç›–ã€‚å—ä»–å½±å“ï¼Œå—ä»–å½±å“ï¼Œ6 æœˆ 1 æ—¥æ²¡æœ‰è·‘æ­¥ï¼Œ6 æœˆ 3 æ—¥å’Œ 4 æ—¥ï¼Œå¸¦è€çˆ¸å»åŒ»é™¢åšæ£€æŸ¥ï¼Œæ‰€ä»¥æ²¡æœ‰è·‘æ­¥ã€‚ç…§æ­¤çœ‹æ¥ï¼Œ6 æœˆè¿ç»­è·‘æ­¥ 30 å¤©ã€ç´¯è®¡ 200 å…¬é‡Œçš„ç›®æ ‡é“å®šæ˜¯å®Œæˆä¸äº†ï¼Œæ‰€ä»¥åŠæ—¶è°ƒæ•´ç›®æ ‡å’Œè®¡åˆ’ï¼Œè¿˜æ˜¯ä»¥é•¿æœŸä¸»ä¹‰çš„æ€è·¯ä¿æŒè·‘æ­¥çš„ä¹ æƒ¯ï¼Œä¸æ±‚æ•°é‡ã€‚\nå·¥ä½œ æœ€è¿‘åœ¨å­¦ä¹ çš„å†…å®¹æ¸…å•ï¼š\nEffective Javaï¼ˆç¬¬ 3 ç‰ˆï¼‰ Java Design Patterns (ä¸­æ–‡) Real Python æœ¬å‘¨å®Œæˆå››ç¯‡åšå®¢ï¼š\nJava è®¾è®¡æ¨¡å¼ï¼šVisitor\nJava è®¾è®¡æ¨¡å¼ï¼šAcyclic Visitor\n[è¯‘]ä½¿ç”¨ Python çš„ pip ç®¡ç†é¡¹ç›®çš„ä¾èµ–å…³ç³»\n[è¯‘]ä»€ä¹ˆæ˜¯ Python Wheelsï¼Œä½ ä¸ºä»€ä¹ˆè¦å…³å¿ƒå®ƒï¼Ÿ\næœ¬å‘¨åˆ†äº« å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€ChenSoul Shareã€Telegram é¢‘é“æˆ–è€…æˆ‘çš„ memos ä¸­ã€‚æˆ‘å†™äº†ä¸€ä¸ª python è„šæœ¬ä» memos è¯»å–æœ€è¿‘ä¸€å‘¨çš„ memos è®°å½•ã€‚\nğŸ“Œ2023-05-31 çœ‹åˆ°ä¸€ä¸ªå¾ˆé€‚åˆæ–°æ‰‹å…¥é—¨ã€Œæ•°æ®ç»“æ„ä¸ç®—æ³•ã€çš„å¼€æºä¹¦ã€ŠHello ç®—æ³•ã€‹ï¼Œé€šè¿‡åŠ¨ç”»å›¾è§£ç»“æ„åŒ–åœ°è®²è§£æ•°æ®ç»“æ„å’Œç®—æ³•çŸ¥è¯†ï¼Œå†…å®¹æ¸…æ™°æ˜“æ‡‚ã€å­¦ä¹ æ›²çº¿æŒºå¹³æ»‘ï¼Œä»£ç ä¸Šæ”¯æŒ Java,C++, Python, Go, JS, TS, CSharp, Swift ä¸€é”®è¿è¡Œçœ‹æ•ˆæœï¼Œæ¯”å¸‚é¢ä¸Šå–çš„æ™®é€šä¹¦å¥½ä¸å°‘ã€‚ ğŸ¤– https://hello-algo.com #memos #skill ğŸ“Œ2023-05-31 ä»Šæ—¥é‡ç£…å¼€æºåº“æ¨è - Plane https://github.com/makeplane/plane Jira çš„å¼€æºç‰ˆå¹³æ›¿ï¼Œæœ‰å¾ˆå¤šäººéƒ½è®¨åŒ Jiraï¼Œè§‰å¾—å®ƒå¤æ‚éš¾ç”¨ã€‚ Plane å®Œå…¨å¼€æºï¼Œè€Œä¸”ç•Œé¢è¦ç®€æ´èˆ’æœæ˜“ç”¨å¾ˆå¤šã€‚ éƒ¨ç½²æ–¹ä¾¿å¿«æ·, æ”¯æŒ Docker éƒ¨ç½²ã€‚ è¿˜å¾ˆè´´å¿ƒçš„æ”¯æŒä» Github ä»¥åŠ Jira ç›´æ¥å¯¼å…¥ã€‚ æƒ³å°è¯•æ–°çš„é¡¹ç›®ç®¡ç†å·¥å…·çš„æœ‹å‹å¯ä»¥å°è¯•ä¸€ä¸‹ã€‚#memos #tool ğŸ“Œ2023-05-31 ã€ŒNext.js åº”ç”¨å¼€å‘å®è·µã€ https://nextjs-in-action-cn.taonan.lu/ #memos #web ä»¥ä¸Šã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/06/09/weekly_review_22/","summary":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-05-29 åˆ° 2023-06-04 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¯»ä¹¦ã€å¥èº«ã€å®šæŠ•ã€å¸®æœ‹å‹ã€é™ªå®¶äººï¼Œæœ¬å‘¨å‘¨æŠ¥å¢åŠ ä¸€å—å†…å®¹ï¼šè¯»ä¹¦ï¼Œè®°å½•æ¯å‘¨è¯»ä¹¦çš„æ—¶é—´ã€‚\nå¾®ä¿¡è¯»ä¹¦ç¬”è®°åŠ©æ‰‹ æœ€è¿‘æ³¨é”€äº†å¾®ä¿¡é˜…è¯»è´¦å·ï¼Œæ¸…ç©ºäº†å†å²æ•°æ®ã€‚æœ¬ç€å®ç¼ºæ¯‹æ»¥çš„åŸåˆ™ï¼Œä¹¦æ¶é‡æ–°æ·»åŠ äº†å‡ æœ¬ä¹¦ã€‚è®¡åˆ’æ˜¯é‡æ–°ä½¿ç”¨å¾®ä¿¡é˜…è¯»å…»æˆè¯»ä¹¦çš„ä¹ æƒ¯ã€‚\nåœ¨ chrome æµè§ˆå™¨æ·»åŠ äº†ä¸€ä¸ªæ’ä»¶ å¾®ä¿¡è¯»ä¹¦ç¬”è®°åŠ©æ‰‹ ï¼Œå¯ä»¥å°†è¯»ä¹¦ç¬”è®°ä¸€é”®å¯¼å‡ºä¸º markdown æ ¼å¼ã€‚\nå¯¼å‡ºçš„å†…å®¹æ ‡æ³¨æ˜¯ä¸€ä¸ªæ ‡æ³¨ä¸€ä¸ªæ®µè½ï¼Œæ®µè½ä¹‹é—´æœ‰ä¸€ä¸ªæ¢è¡Œã€‚æ®µè½åé¢å¯ä»¥æ·»åŠ è‡ªå·±çš„æ€è€ƒï¼ˆæ¯”å¦‚ï¼Œç”¨çº¢è‰²æ ‡æ³¨é¢œè‰²ï¼‰ã€‚\nè¯»ä¹¦ æœ¬å‘¨é˜…è¯»ç»Ÿè®¡ï¼ˆå›¾ç‰‡æ¥è‡ªå¾®ä¿¡é˜…è¯» app åˆ†äº«ï¼‰ï¼š\nç†è´¢ è¿™å‘¨æ€»è®¡æ”¯å‡º 2528 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š\n6 æœˆ 4 æ—¥ï¼š138 å…ƒ 6 æœˆ 3 æ—¥ï¼š1650 å…ƒï¼ŒåŒ»é™¢çœ‹ç—… 1600 6 æœˆ 2 æ—¥ï¼š61 å…ƒ 6 æœˆ 1 æ—¥ï¼š0 å…ƒ 5 æœˆ 31 æ—¥ï¼š108 å…ƒ 5 æœˆ 30 æ—¥ï¼š625 å…ƒï¼Œå…¬å¸åœè½¦åœºè´¹ç”¨ 600 5 æœˆ 29 æ—¥ï¼š41 å…ƒ å¥èº« æˆ‘è·‘è¿‡äº†ä¸€äº›åœ°æ–¹ï¼Œå¸Œæœ›éšç€æ—¶é—´æ¨ç§»ï¼Œåœ°å›¾ç‚¹äº®çš„åœ°æ–¹è¶Šæ¥è¶Šå¤šã€‚2 å¹´é‡Œæˆ‘è·‘è¿‡ 2 ä¸ªçœä»½ 2 ä¸ªåŸå¸‚ã€‚æ›´å¤šè·‘æ­¥æ•°æ®åœ¨æˆ‘çš„ è·‘æ­¥ ä¸»é¡µã€‚\næœ¬å‘¨è·‘æ­¥ 42.66 å…¬é‡Œï¼Œæœ€é•¿è·‘æ­¥è·ç¦»ä¸º 9.2 å…¬é‡Œã€‚\næ˜ç»†æ•°æ®å¦‚ä¸‹ï¼š\nåœ¨æœ‹å‹åœˆå‘äº†ä¸€ä¸ª 5 æœˆè·‘æ­¥ 500 å…¬é‡ŒåŠ¨æ€ï¼Œä¸€ä¸ªé«˜ä¸­åŒå­¦å»ºè®®æˆ‘ä¸è¦è¿‡åº¦è·‘æ­¥ï¼Œæœ€å¥½æ˜¯è·‘æ­¥ä¸€å¤©ä¼‘æ¯ä¸€å¤©ï¼Œä»¥å…ä¼¤äº†è†ç›–ã€‚å—ä»–å½±å“ï¼Œå—ä»–å½±å“ï¼Œ6 æœˆ 1 æ—¥æ²¡æœ‰è·‘æ­¥ï¼Œ6 æœˆ 3 æ—¥å’Œ 4 æ—¥ï¼Œå¸¦è€çˆ¸å»åŒ»é™¢åšæ£€æŸ¥ï¼Œæ‰€ä»¥æ²¡æœ‰è·‘æ­¥ã€‚ç…§æ­¤çœ‹æ¥ï¼Œ6 æœˆè¿ç»­è·‘æ­¥ 30 å¤©ã€ç´¯è®¡ 200 å…¬é‡Œçš„ç›®æ ‡é“å®šæ˜¯å®Œæˆä¸äº†ï¼Œæ‰€ä»¥åŠæ—¶è°ƒæ•´ç›®æ ‡å’Œè®¡åˆ’ï¼Œè¿˜æ˜¯ä»¥é•¿æœŸä¸»ä¹‰çš„æ€è·¯ä¿æŒè·‘æ­¥çš„ä¹ æƒ¯ï¼Œä¸æ±‚æ•°é‡ã€‚\nå·¥ä½œ æœ€è¿‘åœ¨å­¦ä¹ çš„å†…å®¹æ¸…å•ï¼š\nEffective Javaï¼ˆç¬¬ 3 ç‰ˆï¼‰ Java Design Patterns (ä¸­æ–‡) Real Python æœ¬å‘¨å®Œæˆå››ç¯‡åšå®¢ï¼š","title":"å‘¨æŠ¥-22ï½œå¾®ä¿¡è¯»ä¹¦ç¬”è®°åŠ©æ‰‹"},{"content":"æœ¬æ–‡ä¸»è¦ä»‹ç» Visitor æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nJava Design Patterns æä¾›äº†å„ç§ Java è®¾è®¡æ¨¡å¼çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ã€‚è¯¥ç½‘ç«™æ—¨åœ¨å¸®åŠ© Java å¼€å‘äººå‘˜äº†è§£å’Œåº”ç”¨å„ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚\nJava Design Patterns ç½‘ç«™æä¾›äº†å¤šç§è®¾è®¡æ¨¡å¼åˆ†ç±»æ–¹å¼ï¼ŒåŒ…æ‹¬åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational Patternsï¼‰ã€ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternsï¼‰å’Œè¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰ï¼Œä»¥åŠå…¶ä»–ä¸€äº›å¸¸è§çš„æ¨¡å¼ã€‚\nå¯¹äºæ¯ä¸ªè®¾è®¡æ¨¡å¼ï¼Œè¯¥ç½‘ç«™æä¾›äº†è¯¦ç»†çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ï¼Œå¹¶ä¸”æä¾›äº†ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ã€‚å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©é€‚åˆè‡ªå·±çš„è®¾è®¡æ¨¡å¼ï¼Œå¹¶ä¸”å¯ä»¥å‚è€ƒç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜æ¥ç†è§£å’Œåº”ç”¨è¯¥æ¨¡å¼ã€‚\næ­¤å¤–ï¼ŒJava Design Patterns ç½‘ç«™è¿˜æä¾›äº†ä¸€äº›å…¶ä»–èµ„æºï¼Œå¦‚è®¾è®¡æ¨¡å¼çš„ UML å›¾ã€è®¾è®¡æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ã€è®¾è®¡æ¨¡å¼çš„æ¯”è¾ƒç­‰ã€‚è¿™äº›èµ„æºå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨è®¾è®¡æ¨¡å¼ã€‚\nä¸­æ–‡ç½‘ç«™ï¼šhttps://java-design-patterns.com/zh/\nGithub ä¸Šæºç ä»“åº“ï¼ˆéå®˜æ–¹ï¼‰ï¼šhttps://github.com/iluwatar/java-design-patterns\nç›®çš„ è¡¨ç¤ºè¦åœ¨å¯¹è±¡ç»“æ„çš„å…ƒç´ ä¸Šæ‰§è¡Œçš„æ“ä½œã€‚è®¿é—®è€…å¯è®©ä½ å®šä¹‰æ–°æ“ä½œï¼Œè€Œæ— éœ€æ›´æ”¹å…¶æ‰€æ“ä½œå…ƒç´ çš„ç±»ã€‚\nè®¿é—®è€…æ¨¡å¼çš„ä¸»è¦ç›®çš„æ˜¯åœ¨ä¸æ”¹å˜å¯¹è±¡ç»“æ„çš„å‰æä¸‹ï¼Œå¯¹å¯¹è±¡ç»“æ„ä¸­çš„å…ƒç´ è¿›è¡Œæ–°çš„æ“ä½œã€‚å®ƒé€šè¿‡å°†æ“ä½œä»å¯¹è±¡ç»“æ„ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œä½¿å¾—å¯ä»¥ç‹¬ç«‹åœ°æ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤å¯¹å…ƒç´ çš„æ“ä½œï¼Œè€Œä¸éœ€è¦ä¿®æ”¹å…ƒç´ ç±»æˆ–å¯¹è±¡ç»“æ„ã€‚\nè®¿é—®è€…æ¨¡å¼çš„å¦ä¸€ä¸ªç›®çš„æ˜¯å°†å¯¹è±¡ç»“æ„ä¸æ“ä½œè§£è€¦ã€‚åœ¨è®¿é—®è€…æ¨¡å¼ä¸­ï¼Œå…ƒç´ å’Œæ“ä½œåˆ†åˆ«ç”±ä¸åŒçš„ç±»æ¥å®ç°ï¼Œå¹¶ä¸”å…ƒç´ åªæš´éœ²å‡ºæ¥å—è®¿é—®è€…å¯¹è±¡çš„æ¥å£ï¼Œè€Œä¸æ˜¯æš´éœ²å‡ºå…·ä½“çš„å®ç°ç»†èŠ‚ã€‚è¿™æ ·å¯ä»¥é¿å…åœ¨å…ƒç´ ç±»ä¸­æ·»åŠ è¿‡å¤šçš„è¡Œä¸ºï¼Œä»è€Œæé«˜ä»£ç çš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚\næœ€åï¼Œè®¿é—®è€…æ¨¡å¼è¿˜å¯ä»¥ç”¨äºå®ç°å¯¹å¤æ‚å¯¹è±¡ç»“æ„çš„éå†ã€‚é€šè¿‡è®¿é—®è€…å¯¹è±¡çš„é€’å½’è°ƒç”¨ï¼Œå¯ä»¥éå†æ•´ä¸ªå¯¹è±¡ç»“æ„ï¼Œå¹¶å¯¹æ¯ä¸ªå…ƒç´ æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚è¿™ç§éå†æ–¹å¼å¯ä»¥æ–¹ä¾¿åœ°å®ç°å¯¹å¤æ‚å¯¹è±¡ç»“æ„çš„åˆ†æå’Œå¤„ç†ã€‚\nè§£é‡Š çœŸå®ä¸–ç•Œä¾‹å­\nè€ƒè™‘æœ‰ä¸€ä¸ªå¸¦æœ‰å†›é˜Ÿå•ä½çš„æ ‘å½¢ç»“æ„ã€‚æŒ‡æŒ¥å®˜ä¸‹æœ‰ä¸¤åä¸­å£«ï¼Œæ¯åä¸­å£«ä¸‹æœ‰ä¸‰åå£«å…µã€‚åŸºäºè¿™ä¸ªå±‚çº§ç»“æ„å®ç°è®¿é—®è€…æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åˆ›å»ºä¸æŒ‡æŒ¥å®˜ï¼Œä¸­å£«ï¼Œå£«å…µæˆ–æ‰€æœ‰äººå‘˜äº’åŠ¨çš„æ–°å¯¹è±¡\né€šä¿—çš„è¯´\nè®¿é—®è€…æ¨¡å¼å®šä¹‰å¯ä»¥åœ¨æ•°æ®ç»“æ„çš„èŠ‚ç‚¹ä¸Šæ‰§è¡Œçš„æ“ä½œã€‚\nç»´åŸºç™¾ç§‘è¯´\nåœ¨é¢å‘å¯¹è±¡çš„ç¨‹åºè®¾è®¡å’Œè½¯ä»¶å·¥ç¨‹ä¸­ï¼Œè®¿é—®è€…è®¾è®¡æ¨¡å¼æ˜¯ä¸€ç§å°†ç®—æ³•ä¸æ“ä½œå¯¹è±¡çš„ç»“æ„åˆ†ç¦»çš„æ–¹æ³•ã€‚è¿™ç§åˆ†ç¦»çš„å®é™…ç»“æœæ˜¯èƒ½å¤Ÿåœ¨ä¸ä¿®æ”¹ç»“æ„çš„æƒ…å†µä¸‹å‘ç°æœ‰å¯¹è±¡ç»“æ„æ·»åŠ æ–°æ“ä½œã€‚\nè®¿é—®è€…æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸åœ¨ä¸æ”¹å˜å¯¹è±¡ç»“æ„çš„æƒ…å†µä¸‹å®šä¹‰æ–°çš„æ“ä½œã€‚è¯¥æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†æ“ä½œä»å¯¹è±¡ç»“æ„ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå¹¶åœ¨ç‹¬ç«‹çš„è®¿é—®è€…å¯¹è±¡ä¸­è¿›è¡Œå®ç°ã€‚\nè®¿é—®è€…æ¨¡å¼ç”±ä»¥ä¸‹å‡ ä¸ªå…³é”®å…ƒç´ ç»„æˆï¼š\næŠ½è±¡è®¿é—®è€…ï¼ˆVisitorï¼‰ï¼šå®šä¹‰å¯ä»¥è®¿é—®ä¸åŒç±»å‹å…ƒç´ çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„å‚æ•°ç±»å‹ä¸ºå…·ä½“å…ƒç´ ç±»å‹ã€‚ å…·ä½“è®¿é—®è€…ï¼ˆConcreteVisitorï¼‰ï¼šå®ç°æŠ½è±¡è®¿é—®è€…ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œä»¥å®ç°å¯¹å…ƒç´ çš„ä¸åŒæ“ä½œã€‚ æŠ½è±¡å…ƒç´ ï¼ˆElementï¼‰ï¼šå®šä¹‰æ¥å—è®¿é—®è€…å¯¹è±¡çš„æ–¹æ³•ã€‚ å…·ä½“å…ƒç´ ï¼ˆConcreteElementï¼‰ï¼šå®ç°æŠ½è±¡å…ƒç´ ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œä»¥ä¾¿å¯ä»¥æ¥å—è®¿é—®è€…å¯¹è±¡çš„è®¿é—®ã€‚ å¯¹è±¡ç»“æ„ï¼ˆObject Structureï¼‰ï¼šåŒ…å«ä¸€ç»„å…·ä½“å…ƒç´ ï¼Œå¯ä»¥è¢«è®¿é—®è€…å¯¹è±¡éå†ã€‚ ç¨‹åºç¤ºä¾‹\nä½¿ç”¨ä¸Šé¢çš„å†›é˜Ÿå•å…ƒçš„ä¾‹å­ï¼Œæˆ‘ä»¬é¦–å…ˆç”±å•ä½å’Œå•ä½è®¿é—®å™¨ç±»å‹ã€‚\npublic abstract class Unit { private final Unit[] children; public Unit(Unit... children) { this.children = children; } public void accept(UnitVisitor visitor) { Arrays.stream(children).forEach(child -\u0026gt; child.accept(visitor)); } } public interface UnitVisitor { void visitSoldier(Soldier soldier); void visitSergeant(Sergeant sergeant); void visitCommander(Commander commander); } ç„¶åæˆ‘ä»¬æœ‰å…·ä½“çš„å•å…ƒã€‚\npublic class Commander extends Unit { public Commander(Unit... children) { super(children); } @Override public void accept(UnitVisitor visitor) { visitor.visitCommander(this); super.accept(visitor); } @Override public String toString() { return \u0026#34;commander\u0026#34;; } } public class Sergeant extends Unit { public Sergeant(Unit... children) { super(children); } @Override public void accept(UnitVisitor visitor) { visitor.visitSergeant(this); super.accept(visitor); } @Override public String toString() { return \u0026#34;sergeant\u0026#34;; } } public class Soldier extends Unit { public Soldier(Unit... children) { super(children); } @Override public void accept(UnitVisitor visitor) { visitor.visitSoldier(this); super.accept(visitor); } @Override public String toString() { return \u0026#34;soldier\u0026#34;; } } ç„¶åæœ‰ä¸€äº›å…·ä½“çš„è®¿é—®è€…ã€‚\npublic class CommanderVisitor implements UnitVisitor { private static final Logger LOGGER = LoggerFactory.getLogger(CommanderVisitor.class); @Override public void visitSoldier(Soldier soldier) { // Do nothing } @Override public void visitSergeant(Sergeant sergeant) { // Do nothing } @Override public void visitCommander(Commander commander) { LOGGER.info(\u0026#34;Good to see you {}\u0026#34;, commander); } } public class SergeantVisitor implements UnitVisitor { private static final Logger LOGGER = LoggerFactory.getLogger(SergeantVisitor.class); @Override public void visitSoldier(Soldier soldier) { // Do nothing } @Override public void visitSergeant(Sergeant sergeant) { LOGGER.info(\u0026#34;Hello {}\u0026#34;, sergeant); } @Override public void visitCommander(Commander commander) { // Do nothing } } public class SoldierVisitor implements UnitVisitor { private static final Logger LOGGER = LoggerFactory.getLogger(SoldierVisitor.class); @Override public void visitSoldier(Soldier soldier) { LOGGER.info(\u0026#34;Greetings {}\u0026#34;, soldier); } @Override public void visitSergeant(Sergeant sergeant) { // Do nothing } @Override public void visitCommander(Commander commander) { // Do nothing } } æœ€åï¼Œæ¥çœ‹çœ‹å®è·µä¸­è®¿é—®è€…æ¨¡å¼çš„åŠ›é‡ã€‚\ncommander.accept(new SoldierVisitor()); commander.accept(new SergeantVisitor()); commander.accept(new CommanderVisitor()); ç¨‹åºè¾“å‡º:\nGreetings soldier Greetings soldier Greetings soldier Greetings soldier Greetings soldier Greetings soldier Hello sergeant Hello sergeant Good to see you commander ç±»å›¾ ä¼˜ç¼ºç‚¹ è®¿é—®è€…æ¨¡å¼çš„ä¼˜ç‚¹ï¼š\næ‰©å±•æ€§å¥½ï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥é€šè¿‡å¢åŠ æ–°çš„è®¿é—®è€…ç±»æ¥æ‰©å±•å¯¹å¯¹è±¡ç»“æ„çš„æ“ä½œï¼Œè€Œæ— éœ€ä¿®æ”¹å¯¹è±¡ç»“æ„æˆ–å…ƒç´ ç±»ã€‚ åˆ†ç¦»å…³æ³¨ç‚¹ï¼šè®¿é—®è€…æ¨¡å¼å°†å¯¹è±¡ç»“æ„å’Œå¯¹å¯¹è±¡ç»“æ„çš„æ“ä½œåˆ†ç¦»å¼€æ¥ï¼Œä½¿å¾—å¯¹è±¡ç»“æ„å’Œè®¿é—®è€…ç±»å¯ä»¥ç‹¬ç«‹å‘å±•ã€‚è¿™æ ·å¯ä»¥æé«˜ä»£ç çš„å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ çµæ´»æ€§é«˜ï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥æ”¯æŒä¸åŒçš„è®¿é—®è€…å¯¹è±¡å¯¹åŒä¸€å¯¹è±¡ç»“æ„è¿›è¡Œä¸åŒçš„éå†å’Œæ“ä½œï¼Œä»è€Œå¯ä»¥å®ç°å¤šç§ä¸åŒçš„å¤„ç†æ–¹å¼ã€‚ ç¬¦åˆå¼€é—­åŸåˆ™ï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥é€šè¿‡å¢åŠ æ–°çš„å…ƒç´ ç±»å’Œè®¿é—®è€…ç±»æ¥æ‰©å±•ç³»ç»Ÿçš„åŠŸèƒ½ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹ç°æœ‰çš„ä»£ç ã€‚ è®¿é—®è€…æ¨¡å¼çš„ç¼ºç‚¹ï¼š\nå®ç°å¤æ‚ï¼šè®¿é—®è€…æ¨¡å¼çš„å®ç°æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦å®šä¹‰å¤šä¸ªæ¥å£å’Œç±»ï¼Œå¹¶ä¸”éœ€è¦å¯¹å¯¹è±¡ç»“æ„è¿›è¡Œé‡æ„ã€‚ è¿åå°è£…åŸåˆ™ï¼šè®¿é—®è€…æ¨¡å¼éœ€è¦å°†è®¿é—®è€…å¯¹è±¡æš´éœ²ç»™å…ƒç´ ç±»ï¼Œä»è€Œç ´åäº†å…ƒç´ ç±»çš„å°è£…æ€§ã€‚ å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼šè®¿é—®è€…æ¨¡å¼éœ€è¦å¯¹æ•´ä¸ªå¯¹è±¡ç»“æ„è¿›è¡Œéå†ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚ ä¸æ˜“ç†è§£ï¼šè®¿é—®è€…æ¨¡å¼çš„å®ç°æ¯”è¾ƒæŠ½è±¡ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§é™ä½ã€‚ æ€»ä¹‹ï¼Œè®¿é—®è€…æ¨¡å¼å¯ä»¥æé«˜ç³»ç»Ÿçš„æ‰©å±•æ€§å’Œçµæ´»æ€§ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„å®ç°çš„å¤æ‚æ€§å’Œæ€§èƒ½é—®é¢˜ï¼Œå¹¶ä¸”éœ€è¦æƒè¡¡å°è£…æ€§å’Œå¯è¯»æ€§ä¹‹é—´çš„å…³ç³»ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œåº”è¯¥æ ¹æ®å…·ä½“çš„éœ€æ±‚å’Œåœºæ™¯æ¥é€‰æ‹©æ˜¯å¦ä½¿ç”¨è®¿é—®è€…æ¨¡å¼ã€‚\nå¯¹æ¯” è®¿é—®è€…æ¨¡å¼å’Œ Acyclic Visitor è®¾è®¡æ¨¡å¼éƒ½æ˜¯ç”¨äºå¤„ç†å¯¹è±¡ç»“æ„ä¸­çš„å…ƒç´ ï¼Œä½†å®ƒä»¬çš„å®ç°æ–¹å¼å’Œåº”ç”¨åœºæ™¯æœ‰æ‰€ä¸åŒã€‚\nè®¿é—®è€…æ¨¡å¼é€šè¿‡åœ¨å…ƒç´ ç±»ä¸­å®šä¹‰ä¸€ä¸ª accept æ–¹æ³•ï¼Œæ¥å—ä¸€ä¸ªè®¿é—®è€…å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œä»è€Œå°†å…ƒç´ çš„å¤„ç†å§”æ‰˜ç»™è®¿é—®è€…å¯¹è±¡æ¥å®Œæˆã€‚è®¿é—®è€…å¯¹è±¡é€šå¸¸å®šä¹‰äº†å¤šä¸ª visit æ–¹æ³•ï¼Œåˆ†åˆ«å¯¹åº”ä¸åŒç±»å‹çš„å…ƒç´ ï¼Œä»è€Œå¯ä»¥æ ¹æ®å…ƒç´ çš„ç±»å‹æ¥æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚\nAcyclic Visitor è®¾è®¡æ¨¡å¼æ˜¯è®¿é—®è€…æ¨¡å¼çš„ä¸€ç§å˜ç§ï¼Œå®ƒé€šè¿‡åœ¨è®¿é—®è€…ç±»ä¸­å®šä¹‰æŠ½è±¡è®¿é—®è€…ç±»å’Œå…·ä½“è®¿é—®è€…ç±»æ¥å®ç°ã€‚æŠ½è±¡è®¿é—®è€…ç±»å®šä¹‰äº† visit æ–¹æ³•ï¼Œä½†ä¸åŒ…å«ä»»ä½•å…·ä½“çš„ visit æ–¹æ³•å®ç°ï¼Œè€Œå…·ä½“è®¿é—®è€…ç±»åˆ™å®ç°äº†å…·ä½“çš„ visit æ–¹æ³•ã€‚è¿™æ ·å¯ä»¥é¿å…è®¿é—®è€…å¯¹è±¡å¯¹å…ƒç´ ç±»çš„ä¾èµ–ï¼Œä»è€Œå®ç°æ¾è€¦åˆã€‚\nAcyclic Visitor è®¾è®¡æ¨¡å¼é€šå¸¸ç”¨äºå¤„ç†å¤šç»§æ‰¿çš„å¯¹è±¡ç»“æ„ï¼Œå› ä¸ºå¤šç»§æ‰¿å¯èƒ½ä¼šå¯¼è‡´è®¿é—®è€…å¯¹è±¡å¯¹å…ƒç´ ç±»çš„ä¾èµ–ã€‚åœ¨å¤šç»§æ‰¿çš„æƒ…å†µä¸‹ï¼Œå…ƒç´ ç±»å¯èƒ½åŒæ—¶ç»§æ‰¿äº†å¤šä¸ªæ¥å£æˆ–çˆ¶ç±»ï¼Œè¿™æ ·è®¿é—®è€…å¯¹è±¡å°±éœ€è¦å¯¹æ¯ä¸ªæ¥å£æˆ–çˆ¶ç±»éƒ½å®šä¹‰ä¸€ä¸ª visit æ–¹æ³•ï¼Œä»è€Œå¯¼è‡´è®¿é—®è€…å¯¹è±¡å¯¹å…ƒç´ ç±»çš„ä¾èµ–æ€§å¢åŠ ã€‚\næ€»ä¹‹ï¼Œè®¿é—®è€…æ¨¡å¼å’Œ Acyclic Visitor è®¾è®¡æ¨¡å¼éƒ½æ˜¯ç”¨äºå¤„ç†å¯¹è±¡ç»“æ„ä¸­çš„å…ƒç´ ï¼Œä½†å®ƒä»¬çš„å®ç°æ–¹å¼å’Œåº”ç”¨åœºæ™¯æœ‰æ‰€ä¸åŒã€‚è®¿é—®è€…æ¨¡å¼é€‚ç”¨äºå¤„ç†å•ç»§æ‰¿çš„å¯¹è±¡ç»“æ„ï¼Œè€Œ Acyclic Visitor è®¾è®¡æ¨¡å¼é€‚ç”¨äºå¤„ç†å¤šç»§æ‰¿çš„å¯¹è±¡ç»“æ„ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œåº”è¯¥æ ¹æ®å…·ä½“çš„éœ€æ±‚å’Œåœºæ™¯æ¥é€‰æ‹©ä½¿ç”¨å“ªç§æ¨¡å¼ã€‚\né€‚ç”¨åœºæ™¯ è®¿é—®è€…æ¨¡å¼é€‚ç”¨äºä»¥ä¸‹æƒ…å†µï¼š\nå¯¹è±¡ç»“æ„å¤æ‚ï¼ŒåŒ…å«å¤šç§ç±»å‹çš„å…ƒç´ ï¼Œå¹¶ä¸”éœ€è¦å¯¹è¿™äº›å…ƒç´ è¿›è¡Œä¸åŒçš„æ“ä½œã€‚ éœ€è¦åœ¨ä¸æ”¹å˜å¯¹è±¡ç»“æ„çš„å‰æä¸‹ï¼Œå¢åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤å¯¹å…ƒç´ çš„æ“ä½œã€‚ å¯¹è±¡ç»“æ„ä¸­çš„å…ƒç´ ç±»ç»å¸¸å‘ç”Ÿå˜åŒ–ï¼Œè€Œè®¿é—®è€…ç±»çš„å˜åŒ–è¾ƒå°‘ã€‚ éœ€è¦å¯¹å¯¹è±¡ç»“æ„è¿›è¡Œå¤šç§ä¸åŒçš„éå†æ–¹å¼ï¼Œå¹¶ä¸”æ¯ç§éå†æ–¹å¼éœ€è¦æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚ å¯¹è±¡ç»“æ„ä¸­çš„å…ƒç´ ç±»ä¸å¸Œæœ›æš´éœ²å‡ºå¤ªå¤šçš„è¡Œä¸ºï¼Œè€Œæ˜¯å¸Œæœ›å°†è¡Œä¸ºå°è£…åœ¨è®¿é—®è€…ç±»ä¸­ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè®¿é—®è€…æ¨¡å¼çš„å®ç°æ¯”è¾ƒå¤æ‚ï¼Œå› æ­¤åªæœ‰åœ¨ç¡®å®éœ€è¦å¯¹å¯¹è±¡ç»“æ„è¿›è¡Œå¤æ‚æ“ä½œæ—¶æ‰åº”è¯¥è€ƒè™‘ä½¿ç”¨è¯¥æ¨¡å¼ã€‚å¦‚æœä»…éœ€è¦å¯¹å¯¹è±¡ç»“æ„è¿›è¡Œç®€å•çš„éå†æˆ–æ“ä½œï¼Œåˆ™å¯ä»¥è€ƒè™‘ä½¿ç”¨å…¶ä»–æ¨¡å¼ï¼Œå¦‚è¿­ä»£å™¨æ¨¡å¼æˆ–ç»„åˆæ¨¡å¼ã€‚\nä»¥ä¸‹æ˜¯ä¸€äº›è®¿é—®è€…æ¨¡å¼åœ¨å®é™…å¼€å‘ä¸­çš„åº”ç”¨åœºæ™¯ï¼š\nç¼–è¯‘å™¨å’Œè§£é‡Šå™¨ï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥ç”¨äºå®ç°ç¼–è¯‘å™¨å’Œè§£é‡Šå™¨ã€‚ç¼–è¯‘å™¨å’Œè§£é‡Šå™¨éƒ½éœ€è¦å¯¹æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰è¿›è¡Œéå†ï¼Œå¹¶æ ¹æ®ä¸åŒçš„èŠ‚ç‚¹ç±»å‹æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚è®¿é—®è€…æ¨¡å¼å¯ä»¥å°†è¿™äº›æ“ä½œå°è£…åœ¨ä¸åŒçš„è®¿é—®è€…ç±»ä¸­ï¼Œä»è€Œå®ç°å¯¹ AST çš„éå†å’Œå¤„ç†ã€‚ æ•°æ®åº“æŸ¥è¯¢ï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥ç”¨äºå®ç°æ•°æ®åº“æŸ¥è¯¢ã€‚æ•°æ®åº“æŸ¥è¯¢éœ€è¦å¯¹æŸ¥è¯¢è¯­å¥è¿›è¡Œè§£æï¼Œå¹¶å°†æŸ¥è¯¢è½¬æ¢ä¸ºå¯¹æ•°æ®åº“ä¸­çš„è¡¨è¿›è¡Œæ“ä½œçš„è¯­å¥ã€‚è®¿é—®è€…æ¨¡å¼å¯ä»¥å°†æŸ¥è¯¢è§£æå’Œè½¬æ¢æ“ä½œå°è£…åœ¨ä¸åŒçš„è®¿é—®è€…ç±»ä¸­ï¼Œä»è€Œå®ç°å¯¹æŸ¥è¯¢è¯­å¥çš„å¤„ç†ã€‚ GUI æ¡†æ¶ï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥ç”¨äºå®ç° GUI æ¡†æ¶ã€‚GUI æ¡†æ¶éœ€è¦å¯¹å„ç§ GUI ç»„ä»¶è¿›è¡Œéå†ï¼Œå¹¶æ ¹æ®ä¸åŒçš„ç»„ä»¶ç±»å‹æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚è®¿é—®è€…æ¨¡å¼å¯ä»¥å°†è¿™äº›æ“ä½œå°è£…åœ¨ä¸åŒçš„è®¿é—®è€…ç±»ä¸­ï¼Œä»è€Œå®ç°å¯¹ GUI ç»„ä»¶çš„éå†å’Œå¤„ç†ã€‚ è®¢å•å¤„ç†ç³»ç»Ÿï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥ç”¨äºå®ç°è®¢å•å¤„ç†ç³»ç»Ÿã€‚è®¢å•å¤„ç†ç³»ç»Ÿéœ€è¦å¯¹è®¢å•ä¸­çš„å„ç§é¡¹è¿›è¡Œéå†ï¼Œå¹¶æ ¹æ®ä¸åŒçš„é¡¹ç±»å‹æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚è®¿é—®è€…æ¨¡å¼å¯ä»¥å°†è¿™äº›æ“ä½œå°è£…åœ¨ä¸åŒçš„è®¿é—®è€…ç±»ä¸­ï¼Œä»è€Œå®ç°å¯¹è®¢å•çš„éå†å’Œå¤„ç†ã€‚ æœºå™¨å­¦ä¹ ï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥ç”¨äºå®ç°æœºå™¨å­¦ä¹ ç®—æ³•ã€‚æœºå™¨å­¦ä¹ ç®—æ³•éœ€è¦å¯¹æ•°æ®é›†è¿›è¡Œéå†ï¼Œå¹¶æ ¹æ®ä¸åŒçš„æ•°æ®ç±»å‹æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚è®¿é—®è€…æ¨¡å¼å¯ä»¥å°†è¿™äº›æ“ä½œå°è£…åœ¨ä¸åŒçš„è®¿é—®è€…ç±»ä¸­ï¼Œä»è€Œå®ç°å¯¹æ•°æ®é›†çš„éå†å’Œå¤„ç†ã€‚ è™šæ‹Ÿæœºï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥ç”¨äºå®ç°è™šæ‹Ÿæœºã€‚è™šæ‹Ÿæœºéœ€è¦å¯¹å­—èŠ‚ç æˆ–ä¸­é—´ä»£ç è¿›è¡Œéå†ï¼Œå¹¶æ ¹æ®ä¸åŒçš„æŒ‡ä»¤ç±»å‹æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚è®¿é—®è€…æ¨¡å¼å¯ä»¥å°†è¿™äº›æ“ä½œå°è£…åœ¨ä¸åŒçš„è®¿é—®è€…ç±»ä¸­ï¼Œä»è€Œå®ç°å¯¹å­—èŠ‚ç æˆ–ä¸­é—´ä»£ç çš„éå†å’Œå¤„ç†ã€‚ å¤šåª’ä½“ç¼–è§£ç å™¨ï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥ç”¨äºå®ç°å¤šåª’ä½“ç¼–è§£ç å™¨ã€‚å¤šåª’ä½“ç¼–è§£ç å™¨éœ€è¦å¯¹éŸ³è§†é¢‘æ•°æ®è¿›è¡Œéå†ï¼Œå¹¶æ ¹æ®ä¸åŒçš„æ•°æ®ç±»å‹æ‰§è¡Œä¸åŒçš„ç¼–è§£ç æ“ä½œã€‚è®¿é—®è€…æ¨¡å¼å¯ä»¥å°†è¿™äº›æ“ä½œå°è£…åœ¨ä¸åŒçš„è®¿é—®è€…ç±»ä¸­ï¼Œä»è€Œå®ç°å¯¹éŸ³è§†é¢‘æ•°æ®çš„éå†å’Œå¤„ç†ã€‚ å›¾åƒå¤„ç†è½¯ä»¶ï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥ç”¨äºå®ç°å›¾åƒå¤„ç†è½¯ä»¶ã€‚å›¾åƒå¤„ç†è½¯ä»¶éœ€è¦å¯¹å›¾åƒè¿›è¡Œéå†ï¼Œå¹¶æ ¹æ®ä¸åŒçš„åƒç´ ç±»å‹æ‰§è¡Œä¸åŒçš„å¤„ç†æ“ä½œã€‚è®¿é—®è€…æ¨¡å¼å¯ä»¥å°†è¿™äº›æ“ä½œå°è£…åœ¨ä¸åŒçš„è®¿é—®è€…ç±»ä¸­ï¼Œä»è€Œå®ç°å¯¹å›¾åƒçš„éå†å’Œå¤„ç†ã€‚ ç½‘ç»œåè®®è§£æå™¨ï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥ç”¨äºå®ç°ç½‘ç»œåè®®è§£æå™¨ã€‚ç½‘ç»œåè®®è§£æå™¨éœ€è¦å¯¹ç½‘ç»œæ•°æ®åŒ…è¿›è¡Œéå†ï¼Œå¹¶æ ¹æ®ä¸åŒçš„åè®®ç±»å‹æ‰§è¡Œä¸åŒçš„è§£ææ“ä½œã€‚è®¿é—®è€…æ¨¡å¼å¯ä»¥å°†è¿™äº›æ“ä½œå°è£…åœ¨ä¸åŒçš„è®¿é—®è€…ç±»ä¸­ï¼Œä»è€Œå®ç°å¯¹ç½‘ç»œæ•°æ®åŒ…çš„éå†å’Œå¤„ç†ã€‚ CAD è½¯ä»¶ï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥ç”¨äºå®ç° CAD è½¯ä»¶ã€‚CAD è½¯ä»¶éœ€è¦å¯¹ç»˜å›¾å…ƒç´ è¿›è¡Œéå†ï¼Œå¹¶æ ¹æ®ä¸åŒçš„å…ƒç´ ç±»å‹æ‰§è¡Œä¸åŒçš„æ“ä½œï¼Œæ¯”å¦‚ç»˜åˆ¶çº¿æ¡ã€å¡«å……é¢œè‰²ç­‰ã€‚è®¿é—®è€…æ¨¡å¼å¯ä»¥å°†è¿™äº›æ“ä½œå°è£…åœ¨ä¸åŒçš„è®¿é—®è€…ç±»ä¸­ï¼Œä»è€Œå®ç°å¯¹ç»˜å›¾å…ƒç´ çš„éå†å’Œå¤„ç†ã€‚ ä»£ç ç”Ÿæˆå™¨ï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥ç”¨äºå®ç°ä»£ç ç”Ÿæˆå™¨ã€‚ä»£ç ç”Ÿæˆå™¨éœ€è¦å¯¹æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰è¿›è¡Œéå†ï¼Œå¹¶æ ¹æ®ä¸åŒçš„èŠ‚ç‚¹ç±»å‹ç”Ÿæˆä¸åŒçš„ä»£ç ã€‚è®¿é—®è€…æ¨¡å¼å¯ä»¥å°†ä»£ç ç”Ÿæˆæ“ä½œå°è£…åœ¨ä¸åŒçš„è®¿é—®è€…ç±»ä¸­ï¼Œä»è€Œå®ç°å¯¹ AST çš„éå†å’Œä»£ç ç”Ÿæˆã€‚ ç¯å¢ƒç›‘æµ‹ç³»ç»Ÿï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥ç”¨äºå®ç°ç¯å¢ƒç›‘æµ‹ç³»ç»Ÿã€‚ç¯å¢ƒç›‘æµ‹ç³»ç»Ÿéœ€è¦å¯¹å¤šä¸ªä¼ æ„Ÿå™¨é‡‡é›†çš„æ•°æ®è¿›è¡Œéå†ï¼Œå¹¶æ ¹æ®ä¸åŒçš„ä¼ æ„Ÿå™¨ç±»å‹æ‰§è¡Œä¸åŒçš„å¤„ç†æ“ä½œï¼Œæ¯”å¦‚æ¸©åº¦æ ¡å‡†ã€æ•°æ®å­˜å‚¨ç­‰ã€‚è®¿é—®è€…æ¨¡å¼å¯ä»¥å°†è¿™äº›æ“ä½œå°è£…åœ¨ä¸åŒçš„è®¿é—®è€…ç±»ä¸­ï¼Œä»è€Œå®ç°å¯¹ä¼ æ„Ÿå™¨æ•°æ®çš„éå†å’Œå¤„ç†ã€‚ æ•°å­—ä¿¡å·å¤„ç†ç³»ç»Ÿï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥ç”¨äºå®ç°æ•°å­—ä¿¡å·å¤„ç†ç³»ç»Ÿã€‚æ•°å­—ä¿¡å·å¤„ç†ç³»ç»Ÿéœ€è¦å¯¹æ•°å­—ä¿¡å·è¿›è¡Œéå†ï¼Œå¹¶æ ¹æ®ä¸åŒçš„ä¿¡å·ç±»å‹æ‰§è¡Œä¸åŒçš„å¤„ç†æ“ä½œï¼Œæ¯”å¦‚æ»¤æ³¢ã€é™å™ªç­‰ã€‚è®¿é—®è€…æ¨¡å¼å¯ä»¥å°†è¿™äº›æ“ä½œå°è£…åœ¨ä¸åŒçš„è®¿é—®è€…ç±»ä¸­ï¼Œä»è€Œå®ç°å¯¹æ•°å­—ä¿¡å·çš„éå†å’Œå¤„ç†ã€‚ è®¿é—®è€…æ¨¡å¼åœ¨ JDK ä¸­æœ‰å¤šä¸ªåº”ç”¨ï¼Œä»¥ä¸‹æ˜¯å…¶ä¸­ä¸€äº›ä¾‹å­ï¼š\nJava ä¸­çš„ java.nio.file.FileVisitor æ¥å£å’Œ java.nio.file.Files#walkFileTree æ–¹æ³•ï¼Œå…¶ä¸­çš„ FileVisitor æ¥å£å®šä¹‰äº†å¤šä¸ª visit æ–¹æ³•ï¼Œç”¨äºè®¿é—®æ–‡ä»¶æ ‘ä¸­çš„å„ä¸ªèŠ‚ç‚¹å¯¹è±¡ã€‚Files#walkFileTree æ–¹æ³•å¯ä»¥é€šè¿‡è®¿é—®è€…æ¨¡å¼æ¥å®ç°éå†æ–‡ä»¶æ ‘å¹¶å¯¹æ¯ä¸ªæ–‡ä»¶è¿›è¡Œå¤„ç†ã€‚ javax.lang.model.element.AnnotationValueVisitor æ¥å£ï¼Œç”¨äºè®¿é—®æ³¨è§£å€¼çš„å„ç§ç±»å‹ï¼Œä¾‹å¦‚åŸºæœ¬ç±»å‹ã€å­—ç¬¦ä¸²ã€æšä¸¾ç±»å‹ã€æ•°ç»„ç±»å‹å’ŒåµŒå¥—æ³¨è§£ç±»å‹ç­‰ã€‚è¯¥æ¥å£ä¸­å®šä¹‰äº†å¤šä¸ª visit æ–¹æ³•ï¼Œç”¨äºå¤„ç†ä¸åŒç±»å‹çš„æ³¨è§£å€¼ã€‚ javax.lang.model.element.ElementVisitor æ¥å£ï¼Œç”¨äºè®¿é—®ç¨‹åºå…ƒç´ çš„å„ç§ç±»å‹ï¼Œä¾‹å¦‚åŒ…ã€ç±»ã€æ–¹æ³•ã€å­—æ®µã€æ³¨è§£å’Œæ³¨è§£å€¼ç­‰ã€‚è¯¥æ¥å£ä¸­å®šä¹‰äº†å¤šä¸ª visit æ–¹æ³•ï¼Œç”¨äºå¤„ç†ä¸åŒç±»å‹çš„ç¨‹åºå…ƒç´ ã€‚ javax.lang.model.type.TypeVisitor æ¥å£ï¼Œç”¨äºè®¿é—®ç±»å‹çš„å„ç§ç±»å‹ï¼Œä¾‹å¦‚åŸºæœ¬ç±»å‹ã€å¯¹è±¡ç±»å‹ã€æ•°ç»„ç±»å‹å’Œæ³›å‹ç±»å‹ç­‰ã€‚è¯¥æ¥å£ä¸­å®šä¹‰äº†å¤šä¸ª visit æ–¹æ³•ï¼Œç”¨äºå¤„ç†ä¸åŒç±»å‹çš„ç±»å‹ã€‚ æ€»ä¹‹ï¼Œè®¿é—®è€…æ¨¡å¼å¯ä»¥é€‚ç”¨äºå„ç§ä¸åŒçš„é¢†åŸŸå’Œåœºæ™¯ï¼Œåªè¦éœ€è¦å¯¹å¯¹è±¡ç»“æ„è¿›è¡Œéå†å’Œå¤„ç†ï¼Œéƒ½å¯ä»¥è€ƒè™‘ä½¿ç”¨è¯¥æ¨¡å¼ã€‚\nä¸¾ä¾‹ è®¡ç®—å›¾å½¢é¢ç§¯å’Œå‘¨é•¿ å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå›¾å½¢ç±» Shapeï¼Œå®ƒæœ‰ä¸¤ä¸ªå­ç±» Circle å’Œ Rectangleï¼Œæˆ‘ä»¬éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œé¢ç§¯å’Œå‘¨é•¿çš„è®¡ç®—ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è®¿é—®è€…æ¨¡å¼æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚\næˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸ªæŠ½è±¡è®¿é—®è€…ç±» ShapeVisitorï¼Œå®ƒåŒ…å«äº†ä¸¤ä¸ªæŠ½è±¡æ–¹æ³• visitCircle å’Œ visitRectangleï¼Œåˆ†åˆ«ç”¨äºè®¿é—® Circle å’Œ Rectangle å¯¹è±¡ã€‚\n// æŠ½è±¡è®¿é—®è€…ç±» interface ShapeVisitor { void visitCircle(Circle circle); void visitRectangle(Rectangle rectangle); } ç„¶åæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæŠ½è±¡çš„å›¾å½¢ç±» Shapeï¼Œå®ƒåŒ…å«ä¸€ä¸ª accept æ–¹æ³•ï¼Œç”¨äºæ¥å—ä¸€ä¸ªè®¿é—®è€…å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚\n// æŠ½è±¡å›¾å½¢ç±» abstract class Shape { abstract void accept(ShapeVisitor visitor); } æ¥ç€æˆ‘ä»¬å®šä¹‰ä¸¤ä¸ªå…·ä½“çš„å›¾å½¢ç±» Circle å’Œ Rectangleï¼Œå®ƒä»¬å®ç°äº† accept æ–¹æ³•ï¼Œå¹¶åœ¨å…¶ä¸­è°ƒç”¨è®¿é—®è€…å¯¹è±¡çš„ visitCircle å’Œ visitRectangle æ–¹æ³•ã€‚\n// å…·ä½“å›¾å½¢ç±» Circle class Circle extends Shape { private double radius; Circle(double radius) { this.radius = radius; } double getRadius() { return radius; } @Override void accept(ShapeVisitor visitor) { visitor.visitCircle(this); } } // å…·ä½“å›¾å½¢ç±» Rectangle class Rectangle extends Shape { private double width; private double height; Rectangle(double width, double height) { this.width = width; this.height = height; } double getWidth() { return width; } double getHeight() { return height; } @Override void accept(ShapeVisitor visitor) { visitor.visitRectangle(this); } } æœ€åæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå…·ä½“çš„è®¿é—®è€…ç±» ShapeCalculatorï¼Œå®ƒå®ç°äº† ShapeVisitor æ¥å£ï¼Œå¹¶åœ¨å…¶ä¸­å®ç°äº† visitCircle å’Œ visitRectangle æ–¹æ³•ï¼Œç”¨äºè®¡ç®—å›¾å½¢çš„é¢ç§¯å’Œå‘¨é•¿ã€‚\n// å…·ä½“è®¿é—®è€…ç±» ShapeCalculator class ShapeCalculator implements ShapeVisitor { private double area; private double perimeter; @Override public void visitCircle(Circle circle) { double radius = circle.getRadius(); area = Math.PI * radius * radius; perimeter = 2 * Math.PI * radius; } @Override public void visitRectangle(Rectangle rectangle) { double width = rectangle.getWidth(); double height = rectangle.getHeight(); area = width * height; perimeter = 2 * (width + height); } double getArea() { return area; } double getPerimeter() { return perimeter; } } ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è®¿é—®è€…æ¨¡å¼æ¥è®¡ç®—å›¾å½¢çš„é¢ç§¯å’Œå‘¨é•¿äº†ã€‚æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ª ShapeCalculator å¯¹è±¡ï¼Œç„¶ååˆ†åˆ«åˆ›å»ºä¸€ä¸ª Circle å¯¹è±¡å’Œä¸€ä¸ª Rectangle å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å®ƒä»¬çš„ accept æ–¹æ³•ï¼Œå°† ShapeCalculator ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚\npublic class Main { public static void main(String[] args) { ShapeCalculator calculator = new ShapeCalculator(); Circle circle = new Circle(5.0); circle.accept(calculator); System.out.println(\u0026#34;Circle area: \u0026#34; + calculator.getArea()); System.out.println(\u0026#34;Circle perimeter: \u0026#34; + calculator.getPerimeter()); Rectangle rectangle = new Rectangle(3.0, 4.0); rectangle.accept(calculator); System.out.println(\u0026#34;Rectangle area: \u0026#34; + calculator.getArea()); System.out.println(\u0026#34;Rectangle perimeter: \u0026#34; + calculator.getPerimeter()); } } è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š\nCircle area: 78.53981633974483 Circle perimeter: 31.41592653589793 Rectangle area: 12.0 Rectangle perimeter: 14.0 è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨è®¿é—®è€…æ¨¡å¼æ¥è®¡ç®—å›¾å½¢çš„é¢ç§¯å’Œå‘¨é•¿ï¼Œæˆ‘ä»¬å°†è®¡ç®—çš„é€»è¾‘å°è£…åœ¨äº† ShapeCalculator ç±»ä¸­ï¼Œå¹¶é€šè¿‡è®¿é—®è€…æ¨¡å¼å°†å®ƒä»¬åº”ç”¨äºä¸åŒçš„å›¾å½¢å¯¹è±¡ã€‚è¿™æ ·å¯ä»¥å®ç°ä»£ç çš„é‡ç”¨å’Œå¯ç»´æŠ¤æ€§ã€‚\nå®ç°ä»£ç ç”Ÿæˆå™¨ è®¿é—®è€…æ¨¡å¼å¯ä»¥ç”¨äºå®ç°ä»£ç ç”Ÿæˆå™¨ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š\nå‡è®¾æˆ‘ä»¬éœ€è¦æ ¹æ®ä¸€ä¸ªè¯­æ³•æ ‘ç”Ÿæˆç›¸åº”çš„ä»£ç ï¼Œè¯­æ³•æ ‘ä¸­åŒ…å«äº†ä¸åŒç±»å‹çš„èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªè¯­æ³•ç»“æ„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è®¿é—®è€…æ¨¡å¼æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œå°†è¯­æ³•æ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½ä½œä¸ºä¸€ä¸ªå…ƒç´ ï¼Œè®¿é—®è€…å¯¹è±¡åˆ™è´Ÿè´£ç”Ÿæˆç›¸åº”çš„ä»£ç ã€‚\næˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸ªæŠ½è±¡è®¿é—®è€…ç±» CodeGeneratorï¼Œå®ƒåŒ…å«äº†å¤šä¸ªæŠ½è±¡æ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•å¯¹åº”ä¸€ä¸ªèŠ‚ç‚¹ç±»å‹ï¼Œç”¨äºç”Ÿæˆç›¸åº”çš„ä»£ç ã€‚\n// æŠ½è±¡è®¿é—®è€…ç±» interface CodeGenerator { void generate(ProgramNode node); void generate(StatementNode node); void generate(ExpressionNode node); // ... } ç„¶åæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæŠ½è±¡çš„èŠ‚ç‚¹ç±» Nodeï¼Œå®ƒåŒ…å«ä¸€ä¸ª accept æ–¹æ³•ï¼Œç”¨äºæ¥å—ä¸€ä¸ªè®¿é—®è€…å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚\n// æŠ½è±¡èŠ‚ç‚¹ç±» abstract class Node { abstract void accept(CodeGenerator generator); } æ¥ç€æˆ‘ä»¬å®šä¹‰å¤šä¸ªå…·ä½“çš„èŠ‚ç‚¹ç±» ProgramNodeã€StatementNode å’Œ ExpressionNodeï¼Œå®ƒä»¬å®ç°äº† accept æ–¹æ³•ï¼Œå¹¶åœ¨å…¶ä¸­è°ƒç”¨è®¿é—®è€…å¯¹è±¡çš„ç›¸åº”æ–¹æ³•ã€‚\n// å…·ä½“èŠ‚ç‚¹ç±» ProgramNode class ProgramNode extends Node { private List\u0026lt;Node\u0026gt; children = new ArrayList\u0026lt;\u0026gt;(); void add(Node node) { children.add(node); } @Override void accept(CodeGenerator generator) { generator.generate(this); for (Node child : children) { child.accept(generator); } } } // å…·ä½“èŠ‚ç‚¹ç±» StatementNode class StatementNode extends Node { private String statement; StatementNode(String statement) { this.statement = statement; } @Override void accept(CodeGenerator generator) { generator.generate(this); } String getStatement() { return statement; } } // å…·ä½“èŠ‚ç‚¹ç±» ExpressionNode class ExpressionNode extends Node { private String expression; ExpressionNode(String expression) { this.expression = expression; } @Override void accept(CodeGenerator generator) { generator.generate(this); } String getExpression() { return expression; } } æœ€åæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå…·ä½“çš„è®¿é—®è€…ç±» JavaCodeGeneratorï¼Œå®ƒå®ç°äº† CodeGenerator æ¥å£ï¼Œå¹¶åœ¨å…¶ä¸­å®ç°äº†å„ä¸ªèŠ‚ç‚¹ç±»å‹çš„ç”Ÿæˆæ–¹æ³•ï¼Œç”¨äºç”Ÿæˆ Java ä»£ç ã€‚\n// å…·ä½“è®¿é—®è€…ç±» JavaCodeGenerator class JavaCodeGenerator implements CodeGenerator { private StringBuilder codeBuilder = new StringBuilder(); @Override public void generate(ProgramNode node) { codeBuilder.append(\u0026#34;public class Main {\\n\u0026#34;); } @Override public void generate(StatementNode node) { codeBuilder.append(\u0026#34; \u0026#34;).append(node.getStatement()).append(\u0026#34;;\\n\u0026#34;); } @Override public void generate(ExpressionNode node) { codeBuilder.append(\u0026#34; \u0026#34;).append(node.getExpression()).append(\u0026#34;;\\n\u0026#34;); } String getCode() { codeBuilder.append(\u0026#34;}\\n\u0026#34;); return codeBuilder.toString(); } } ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è®¿é—®è€…æ¨¡å¼æ¥ç”Ÿæˆ Java ä»£ç äº†ã€‚æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ª ProgramNode å¯¹è±¡ï¼Œå¹¶å‘å…¶ä¸­æ·»åŠ å¤šä¸ª StatementNode å’Œ ExpressionNode å¯¹è±¡ï¼Œç„¶ååˆ›å»ºä¸€ä¸ª JavaCodeGenerator å¯¹è±¡ï¼Œè°ƒç”¨ ProgramNode çš„ accept æ–¹æ³•ï¼Œå¹¶å°† JavaCodeGenerator ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚\npublic class Main { public static void main(String[] args) { ProgramNode programNode = new ProgramNode(); programNode.add(new StatementNode(\u0026#34;int a = 1\u0026#34;)); programNode.add(new ExpressionNode(\u0026#34;a++\u0026#34;)); programNode.add(new StatementNode(\u0026#34;System.out.println(a)\u0026#34;)); JavaCodeGenerator codeGenerator = new JavaCodeGenerator(); programNode.accept(codeGenerator); System.out.println(codeGenerator.getCode()); } } è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š\npublic class Main { int a = 1; a++; System.out.println(a); } è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨è®¿é—®è€…æ¨¡å¼æ¥ç”Ÿæˆ Java ä»£ç ï¼Œæˆ‘ä»¬å°†ç”Ÿæˆä»£ç çš„é€»è¾‘å°è£…åœ¨äº† JavaCodeGenerator ç±»ä¸­ï¼Œå¹¶é€šè¿‡è®¿é—®è€…æ¨¡å¼å°†å®ƒä»¬åº”ç”¨äºè¯­æ³•æ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ã€‚è¿™æ ·å¯ä»¥å®ç°ä»£ç çš„å¿«é€Ÿç”Ÿæˆå’Œå¯ç»´æŠ¤æ€§ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/06/02/java-design-patterns-visitor/","summary":"æœ¬æ–‡ä¸»è¦ä»‹ç» Visitor æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nJava Design Patterns æä¾›äº†å„ç§ Java è®¾è®¡æ¨¡å¼çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ã€‚è¯¥ç½‘ç«™æ—¨åœ¨å¸®åŠ© Java å¼€å‘äººå‘˜äº†è§£å’Œåº”ç”¨å„ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚\nJava Design Patterns ç½‘ç«™æä¾›äº†å¤šç§è®¾è®¡æ¨¡å¼åˆ†ç±»æ–¹å¼ï¼ŒåŒ…æ‹¬åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational Patternsï¼‰ã€ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternsï¼‰å’Œè¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰ï¼Œä»¥åŠå…¶ä»–ä¸€äº›å¸¸è§çš„æ¨¡å¼ã€‚\nå¯¹äºæ¯ä¸ªè®¾è®¡æ¨¡å¼ï¼Œè¯¥ç½‘ç«™æä¾›äº†è¯¦ç»†çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ï¼Œå¹¶ä¸”æä¾›äº†ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ã€‚å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©é€‚åˆè‡ªå·±çš„è®¾è®¡æ¨¡å¼ï¼Œå¹¶ä¸”å¯ä»¥å‚è€ƒç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜æ¥ç†è§£å’Œåº”ç”¨è¯¥æ¨¡å¼ã€‚\næ­¤å¤–ï¼ŒJava Design Patterns ç½‘ç«™è¿˜æä¾›äº†ä¸€äº›å…¶ä»–èµ„æºï¼Œå¦‚è®¾è®¡æ¨¡å¼çš„ UML å›¾ã€è®¾è®¡æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ã€è®¾è®¡æ¨¡å¼çš„æ¯”è¾ƒç­‰ã€‚è¿™äº›èµ„æºå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨è®¾è®¡æ¨¡å¼ã€‚\nä¸­æ–‡ç½‘ç«™ï¼šhttps://java-design-patterns.com/zh/\nGithub ä¸Šæºç ä»“åº“ï¼ˆéå®˜æ–¹ï¼‰ï¼šhttps://github.com/iluwatar/java-design-patterns\nç›®çš„ è¡¨ç¤ºè¦åœ¨å¯¹è±¡ç»“æ„çš„å…ƒç´ ä¸Šæ‰§è¡Œçš„æ“ä½œã€‚è®¿é—®è€…å¯è®©ä½ å®šä¹‰æ–°æ“ä½œï¼Œè€Œæ— éœ€æ›´æ”¹å…¶æ‰€æ“ä½œå…ƒç´ çš„ç±»ã€‚\nè®¿é—®è€…æ¨¡å¼çš„ä¸»è¦ç›®çš„æ˜¯åœ¨ä¸æ”¹å˜å¯¹è±¡ç»“æ„çš„å‰æä¸‹ï¼Œå¯¹å¯¹è±¡ç»“æ„ä¸­çš„å…ƒç´ è¿›è¡Œæ–°çš„æ“ä½œã€‚å®ƒé€šè¿‡å°†æ“ä½œä»å¯¹è±¡ç»“æ„ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œä½¿å¾—å¯ä»¥ç‹¬ç«‹åœ°æ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤å¯¹å…ƒç´ çš„æ“ä½œï¼Œè€Œä¸éœ€è¦ä¿®æ”¹å…ƒç´ ç±»æˆ–å¯¹è±¡ç»“æ„ã€‚\nè®¿é—®è€…æ¨¡å¼çš„å¦ä¸€ä¸ªç›®çš„æ˜¯å°†å¯¹è±¡ç»“æ„ä¸æ“ä½œè§£è€¦ã€‚åœ¨è®¿é—®è€…æ¨¡å¼ä¸­ï¼Œå…ƒç´ å’Œæ“ä½œåˆ†åˆ«ç”±ä¸åŒçš„ç±»æ¥å®ç°ï¼Œå¹¶ä¸”å…ƒç´ åªæš´éœ²å‡ºæ¥å—è®¿é—®è€…å¯¹è±¡çš„æ¥å£ï¼Œè€Œä¸æ˜¯æš´éœ²å‡ºå…·ä½“çš„å®ç°ç»†èŠ‚ã€‚è¿™æ ·å¯ä»¥é¿å…åœ¨å…ƒç´ ç±»ä¸­æ·»åŠ è¿‡å¤šçš„è¡Œä¸ºï¼Œä»è€Œæé«˜ä»£ç çš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚\næœ€åï¼Œè®¿é—®è€…æ¨¡å¼è¿˜å¯ä»¥ç”¨äºå®ç°å¯¹å¤æ‚å¯¹è±¡ç»“æ„çš„éå†ã€‚é€šè¿‡è®¿é—®è€…å¯¹è±¡çš„é€’å½’è°ƒç”¨ï¼Œå¯ä»¥éå†æ•´ä¸ªå¯¹è±¡ç»“æ„ï¼Œå¹¶å¯¹æ¯ä¸ªå…ƒç´ æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚è¿™ç§éå†æ–¹å¼å¯ä»¥æ–¹ä¾¿åœ°å®ç°å¯¹å¤æ‚å¯¹è±¡ç»“æ„çš„åˆ†æå’Œå¤„ç†ã€‚\nè§£é‡Š çœŸå®ä¸–ç•Œä¾‹å­\nè€ƒè™‘æœ‰ä¸€ä¸ªå¸¦æœ‰å†›é˜Ÿå•ä½çš„æ ‘å½¢ç»“æ„ã€‚æŒ‡æŒ¥å®˜ä¸‹æœ‰ä¸¤åä¸­å£«ï¼Œæ¯åä¸­å£«ä¸‹æœ‰ä¸‰åå£«å…µã€‚åŸºäºè¿™ä¸ªå±‚çº§ç»“æ„å®ç°è®¿é—®è€…æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åˆ›å»ºä¸æŒ‡æŒ¥å®˜ï¼Œä¸­å£«ï¼Œå£«å…µæˆ–æ‰€æœ‰äººå‘˜äº’åŠ¨çš„æ–°å¯¹è±¡\né€šä¿—çš„è¯´\nè®¿é—®è€…æ¨¡å¼å®šä¹‰å¯ä»¥åœ¨æ•°æ®ç»“æ„çš„èŠ‚ç‚¹ä¸Šæ‰§è¡Œçš„æ“ä½œã€‚\nç»´åŸºç™¾ç§‘è¯´\nåœ¨é¢å‘å¯¹è±¡çš„ç¨‹åºè®¾è®¡å’Œè½¯ä»¶å·¥ç¨‹ä¸­ï¼Œè®¿é—®è€…è®¾è®¡æ¨¡å¼æ˜¯ä¸€ç§å°†ç®—æ³•ä¸æ“ä½œå¯¹è±¡çš„ç»“æ„åˆ†ç¦»çš„æ–¹æ³•ã€‚è¿™ç§åˆ†ç¦»çš„å®é™…ç»“æœæ˜¯èƒ½å¤Ÿåœ¨ä¸ä¿®æ”¹ç»“æ„çš„æƒ…å†µä¸‹å‘ç°æœ‰å¯¹è±¡ç»“æ„æ·»åŠ æ–°æ“ä½œã€‚\nè®¿é—®è€…æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸åœ¨ä¸æ”¹å˜å¯¹è±¡ç»“æ„çš„æƒ…å†µä¸‹å®šä¹‰æ–°çš„æ“ä½œã€‚è¯¥æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†æ“ä½œä»å¯¹è±¡ç»“æ„ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå¹¶åœ¨ç‹¬ç«‹çš„è®¿é—®è€…å¯¹è±¡ä¸­è¿›è¡Œå®ç°ã€‚\nè®¿é—®è€…æ¨¡å¼ç”±ä»¥ä¸‹å‡ ä¸ªå…³é”®å…ƒç´ ç»„æˆï¼š\næŠ½è±¡è®¿é—®è€…ï¼ˆVisitorï¼‰ï¼šå®šä¹‰å¯ä»¥è®¿é—®ä¸åŒç±»å‹å…ƒç´ çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„å‚æ•°ç±»å‹ä¸ºå…·ä½“å…ƒç´ ç±»å‹ã€‚ å…·ä½“è®¿é—®è€…ï¼ˆConcreteVisitorï¼‰ï¼šå®ç°æŠ½è±¡è®¿é—®è€…ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œä»¥å®ç°å¯¹å…ƒç´ çš„ä¸åŒæ“ä½œã€‚ æŠ½è±¡å…ƒç´ ï¼ˆElementï¼‰ï¼šå®šä¹‰æ¥å—è®¿é—®è€…å¯¹è±¡çš„æ–¹æ³•ã€‚ å…·ä½“å…ƒç´ ï¼ˆConcreteElementï¼‰ï¼šå®ç°æŠ½è±¡å…ƒç´ ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œä»¥ä¾¿å¯ä»¥æ¥å—è®¿é—®è€…å¯¹è±¡çš„è®¿é—®ã€‚ å¯¹è±¡ç»“æ„ï¼ˆObject Structureï¼‰ï¼šåŒ…å«ä¸€ç»„å…·ä½“å…ƒç´ ï¼Œå¯ä»¥è¢«è®¿é—®è€…å¯¹è±¡éå†ã€‚ ç¨‹åºç¤ºä¾‹\nä½¿ç”¨ä¸Šé¢çš„å†›é˜Ÿå•å…ƒçš„ä¾‹å­ï¼Œæˆ‘ä»¬é¦–å…ˆç”±å•ä½å’Œå•ä½è®¿é—®å™¨ç±»å‹ã€‚\npublic abstract class Unit { private final Unit[] children; public Unit(Unit... children) { this.children = children; } public void accept(UnitVisitor visitor) { Arrays.stream(children).forEach(child -\u0026gt; child.accept(visitor)); } } public interface UnitVisitor { void visitSoldier(Soldier soldier); void visitSergeant(Sergeant sergeant); void visitCommander(Commander commander); } ç„¶åæˆ‘ä»¬æœ‰å…·ä½“çš„å•å…ƒã€‚\npublic class Commander extends Unit { public Commander(Unit.","title":"Javaè®¾è®¡æ¨¡å¼ï¼šVisitor"},{"content":"æœ¬æ–‡ä¸»è¦ä»‹ç» Acyclic Visitor æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nJava Design Patterns æä¾›äº†å„ç§ Java è®¾è®¡æ¨¡å¼çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ã€‚è¯¥ç½‘ç«™æ—¨åœ¨å¸®åŠ© Java å¼€å‘äººå‘˜äº†è§£å’Œåº”ç”¨å„ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚\nJava Design Patterns ç½‘ç«™æä¾›äº†å¤šç§è®¾è®¡æ¨¡å¼åˆ†ç±»æ–¹å¼ï¼ŒåŒ…æ‹¬åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational Patternsï¼‰ã€ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternsï¼‰å’Œè¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰ï¼Œä»¥åŠå…¶ä»–ä¸€äº›å¸¸è§çš„æ¨¡å¼ã€‚\nå¯¹äºæ¯ä¸ªè®¾è®¡æ¨¡å¼ï¼Œè¯¥ç½‘ç«™æä¾›äº†è¯¦ç»†çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ï¼Œå¹¶ä¸”æä¾›äº†ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ã€‚å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©é€‚åˆè‡ªå·±çš„è®¾è®¡æ¨¡å¼ï¼Œå¹¶ä¸”å¯ä»¥å‚è€ƒç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜æ¥ç†è§£å’Œåº”ç”¨è¯¥æ¨¡å¼ã€‚\næ­¤å¤–ï¼ŒJava Design Patterns ç½‘ç«™è¿˜æä¾›äº†ä¸€äº›å…¶ä»–èµ„æºï¼Œå¦‚è®¾è®¡æ¨¡å¼çš„ UML å›¾ã€è®¾è®¡æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ã€è®¾è®¡æ¨¡å¼çš„æ¯”è¾ƒç­‰ã€‚è¿™äº›èµ„æºå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨è®¾è®¡æ¨¡å¼ã€‚\nä¸­æ–‡ç½‘ç«™ï¼šhttps://java-design-patterns.com/zh/\nGithub ä¸Šæºç ä»“åº“ï¼ˆéå®˜æ–¹ï¼‰ï¼šhttps://github.com/iluwatar/java-design-patterns\nç›®çš„ å…è®¸å°†æ–°åŠŸèƒ½æ·»åŠ åˆ°ç°æœ‰çš„ç±»å±‚æ¬¡ç»“æ„ä¸­ï¼Œè€Œä¸ä¼šå½±å“è¿™äº›å±‚æ¬¡ç»“æ„ï¼Œä¹Ÿä¸ä¼šæœ‰å››äººå¸®è®¿å®¢æ¨¡å¼ä¸­é‚£æ ·å¾ªç¯ä¾èµ–çš„é—®é¢˜ã€‚\nåœ¨ Acyclic Visitor æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å¼•å…¥ä¸€ä¸ªå¯é€‰æ“ä½œæ¥å£æ¥å®ç°è¿™ä¸€ç‚¹ã€‚å½“æ•°æ®ç»“æ„ç±»éœ€è¦è®¿é—®è®¿é—®è€…ç±»çš„æŸäº›æ“ä½œæ—¶ï¼Œå®ƒå¯ä»¥é€šè¿‡è°ƒç”¨ visit æ–¹æ³•æ¥è®¿é—®å¯é€‰æ“ä½œæ¥å£ä¸­å®šä¹‰çš„æ“ä½œï¼Œè€Œä¸éœ€è¦ç›´æ¥ä¾èµ–äºè®¿é—®è€…ç±»ä¸­çš„æˆå‘˜å˜é‡ã€‚\nè§£é‡Š çœŸå®ä¸–ç•Œä¾‹å­\næˆ‘ä»¬æœ‰ä¸€ä¸ªè°ƒåˆ¶è§£è°ƒå™¨ç±»çš„å±‚æ¬¡ç»“æ„ã€‚ éœ€è¦ä½¿ç”¨åŸºäºè¿‡æ»¤æ¡ä»¶çš„å¤–éƒ¨ç®—æ³•ï¼ˆæ˜¯ Unix æˆ– DOS å…¼å®¹çš„è°ƒåˆ¶è§£è°ƒå™¨ï¼‰æ¥è®¿é—®æ­¤å±‚æ¬¡ç»“æ„ä¸­çš„è°ƒåˆ¶è§£è°ƒå™¨ã€‚\nç¨‹åºç¤ºä¾‹\nè¿™æ˜¯è°ƒåˆ¶è§£è°ƒå™¨çš„å±‚æ¬¡ç»“æ„ã€‚\npublic interface Modem { void accept(ModemVisitor modemVisitor); } public class Hayes implements Modem { @Override public void accept(ModemVisitor modemVisitor) { if (modemVisitor instanceof HayesVisitor) { ((HayesVisitor) modemVisitor).visit(this); } else { System.out.println(\u0026#34;Only HayesVisitor is allowed to visit Hayes modem\u0026#34;); } } } public class Zoom implements Modem { @Override public void accept(ModemVisitor modemVisitor) { if (modemVisitor instanceof ZoomVisitor) { ((ZoomVisitor) modemVisitor).visit(this); } } } ä¸‹é¢æˆ‘ä»¬ä»‹ç»è°ƒåˆ¶è§£è°ƒå™¨è®¿é—®è€…ç±»ç»“æ„ã€‚\npublic interface ModemVisitor { } public interface HayesVisitor extends ModemVisitor { void visit(Hayes hayes); } public interface ZoomVisitor extends ModemVisitor { void visit(Zoom zoom); } public interface AllModemVisitor extends ZoomVisitor, HayesVisitor { } public class ConfigureForDosVisitor implements AllModemVisitor { @Override public void visit(Hayes hayes) { System.out.println(hayes + \u0026#34; used with Dos configurator.\u0026#34;); } @Override public void visit(Zoom zoom) { System.out.println(zoom + \u0026#34; used with Dos configurator.\u0026#34;); } } public class ConfigureForUnixVisitor implements ZoomVisitor { @Override public void visit(Zoom zoom) { System.out.println(zoom + \u0026#34; used with Unix configurator.\u0026#34;); } } æœ€åï¼Œè¿™é‡Œæ˜¯è®¿é—®è€…çš„å®è·µã€‚\npublic class Client { public static void main(String[] args) { Modem[] modems = { new Hayes(), new Zoom(), new Hayes() }; ModemVisitor dosVisitor = new ConfigureForDosVisitor(); ModemVisitor unixVisitor = new ConfigureForUnixVisitor(); for (Modem modem : modems) { modem.accept(dosVisitor); modem.accept(unixVisitor); } } } ç±»å›¾ ä»¥ä¸‹æ˜¯å¯¹ Acyclic Visitor æ¨¡å¼çš„è§£é‡Šï¼š\nElementï¼ˆå…ƒç´ ï¼‰ï¼šåœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼ŒModem æ¥å£è¡¨ç¤ºä¸€ä¸ªå…ƒç´ ï¼Œå®šä¹‰äº†ä¸€ä¸ª accept æ–¹æ³•ï¼Œç”¨äºæ¥å—è®¿é—®è€…çš„è®¿é—®ã€‚ ConcreteElementï¼ˆå…·ä½“å…ƒç´ ï¼‰ï¼šåœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼ŒHayes ç±»å’Œ Zoom ç±»è¡¨ç¤ºå…·ä½“çš„å…ƒç´ ï¼Œå®ç°äº† Modem æ¥å£ä¸­å®šä¹‰çš„ accept æ–¹æ³•ã€‚ Visitorï¼ˆè®¿é—®è€…ï¼‰ï¼šåœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼ŒModemVisitor æ¥å£è¡¨ç¤ºä¸€ä¸ªè®¿é—®è€…ï¼Œå®šä¹‰äº†ä¸€ä¸ªç©ºçš„æ¥å£ï¼Œç”¨äºæ‰©å±•å…·ä½“çš„è®¿é—®è€…æ¥å£ã€‚ ConcreteVisitorï¼ˆå…·ä½“è®¿é—®è€…ï¼‰ï¼šåœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼ŒConfigureForDosVisitor å’Œ ConfigureForUnixVisitor ç±»è¡¨ç¤ºå…·ä½“çš„è®¿é—®è€…ï¼Œå®ç°äº† HayesVisitor å’Œ ZoomVisitor æ¥å£ä¸­å®šä¹‰çš„ visit æ–¹æ³•ï¼Œç”¨äºè®¿é—®å…·ä½“çš„å…ƒç´ ã€‚ OptionalOperationsï¼ˆå¯é€‰æ“ä½œï¼‰ï¼šåœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼ŒAllModemVisitor æ¥å£è¡¨ç¤ºä¸€ä¸ªå¯é€‰æ“ä½œæ¥å£ï¼Œå®ƒç»§æ‰¿äº†æ‰€æœ‰å…·ä½“è®¿é—®è€…æ¥å£ï¼Œç”¨äºæ‰©å±•è®¿é—®è€…ç±»çš„æ“ä½œã€‚åœ¨ ConfigureForDosVisitor ç±»ä¸­ï¼Œå®ƒå®ç°äº† AllModemVisitor æ¥å£ï¼ŒåŒæ—¶å®ç°äº† visit æ–¹æ³•ï¼Œç”¨äºè®¿é—®æ‰€æœ‰å…·ä½“çš„å…ƒç´ ã€‚åœ¨ ConfigureForUnixVisitor ç±»ä¸­ï¼Œå®ƒå®ç°äº† ZoomVisitor æ¥å£ï¼ŒåŒæ—¶å®ç°äº† visit æ–¹æ³•ï¼Œç”¨äºè®¿é—® Zoom å…ƒç´ ã€‚ åœ¨ Acyclic Visitor æ¨¡å¼ä¸­ï¼Œå…ƒç´ å’Œè®¿é—®è€…ä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå®ƒä»¬ä¹‹é—´æ²¡æœ‰ä»»ä½•ä¾èµ–å…³ç³»ã€‚åœ¨è®¿é—®å…ƒç´ æ—¶ï¼Œè®¿é—®è€…é€šè¿‡ accept æ–¹æ³•è®¿é—®å…ƒç´ ï¼Œå¹¶æ ¹æ®å…ƒç´ çš„ç±»å‹è‡ªåŠ¨è°ƒç”¨å¯¹åº”çš„ visit æ–¹æ³•ã€‚ç”±äºè®¿é—®è€…å¹¶æ²¡æœ‰ç›´æ¥ä¾èµ–äºå…ƒç´ ï¼Œè€Œæ˜¯é€šè¿‡è®¿é—®è€…æ¥å£å’Œå¯é€‰æ“ä½œæ¥å£æ¥è®¿é—®å…ƒç´ ï¼Œå› æ­¤å¯ä»¥é¿å…å¾ªç¯ä¾èµ–çš„é—®é¢˜ã€‚åŒæ—¶ï¼Œç”±äºå¯é€‰æ“ä½œæ˜¯ä¸€ä¸ªæ¥å£ï¼Œè®¿é—®è€…å¯ä»¥æ ¹æ®éœ€è¦å®ç°å…¶ä¸­çš„éƒ¨åˆ†æ“ä½œï¼Œä»è€ŒåŠ¨æ€åœ°æ·»åŠ æ–°çš„æ“ä½œï¼Œè€Œä¸ä¼šå½±å“ç°æœ‰çš„ç±»å±‚æ¬¡ç»“æ„ã€‚è¿™æ ·ï¼ŒAcyclic Visitor æ¨¡å¼å¯ä»¥ä½¿ä»£ç æ›´åŠ çµæ´»å’Œå¯æ‰©å±•ï¼ŒåŒæ—¶ä¹Ÿæé«˜äº†ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚\né€‚ç”¨æ€§ ä»¥ä¸‹æƒ…å†µå¯ä»¥ä½¿ç”¨æ­¤æ¨¡å¼ï¼š\néœ€è¦åœ¨ç°æœ‰å±‚æ¬¡ç»“æ„ä¸­æ·»åŠ æ–°åŠŸèƒ½è€Œæ— éœ€æ›´æ”¹æˆ–å½±å“è¯¥å±‚æ¬¡ç»“æ„æ—¶ã€‚ å½“æŸäº›åŠŸèƒ½åœ¨å±‚æ¬¡ç»“æ„ä¸Šè¿è¡Œï¼Œä½†ä¸å±äºå±‚æ¬¡ç»“æ„æœ¬èº«æ—¶ã€‚ ä¾‹å¦‚ ConfigureForDOS / ConfigureForUnix / ConfigureForX é—®é¢˜ã€‚ å½“æ‚¨éœ€è¦æ ¹æ®å¯¹è±¡çš„ç±»å‹å¯¹å¯¹è±¡æ‰§è¡Œéå¸¸ä¸åŒçš„æ“ä½œæ—¶ã€‚ å½“è®¿é—®çš„ç±»å±‚æ¬¡ç»“æ„å°†ç»å¸¸ä½¿ç”¨å…ƒç´ ç±»çš„æ–°æ´¾ç”Ÿè¿›è¡Œæ‰©å±•æ—¶ã€‚åœ¨ Acyclic Visitor æ¨¡å¼ä¸­ï¼Œæ–°çš„å…ƒç´ ç±»å¯ä»¥é€šè¿‡ç»§æ‰¿ç°æœ‰çš„ Element ç±»æ¥å®ç°ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹è®¿é—®è€…ç±»çš„ä»£ç ã€‚è¿™æ ·ï¼Œå¯ä»¥é¿å…å› æ·»åŠ æ–°å…ƒç´ è€Œå¯¼è‡´çš„è®¿é—®è€…ç±»çš„ä¿®æ”¹å’Œé‡æ–°ç¼–è¯‘ã€‚ å½“é‡æ–°ç¼–è¯‘ï¼Œé‡æ–°é“¾æ¥ï¼Œé‡æ–°æµ‹è¯•æˆ–é‡æ–°åˆ†å‘æ´¾ç”Ÿå…ƒç´ éå¸¸æ˜‚è´µæ—¶ã€‚ å¯¹æ¯” Acyclic Visitor æ¨¡å¼æ˜¯ Visitor æ¨¡å¼çš„ä¸€ä¸ªå˜ä½“ï¼Œå®ƒè§£å†³äº† Visitor æ¨¡å¼å¯èƒ½å¯¼è‡´çš„å¾ªç¯ä¾èµ–é—®é¢˜ã€‚ä¸‹é¢æ˜¯ Acyclic Visitor æ¨¡å¼å’Œ Visitor æ¨¡å¼çš„ä¸€äº›å¯¹æ¯”ï¼š\nç›®çš„ä¸åŒ Visitor æ¨¡å¼çš„ä¸»è¦ç›®çš„æ˜¯å°†æ•°æ®ç»“æ„å’Œæ“ä½œåˆ†ç¦»å¼€æ¥ï¼Œå¹¶å°†æ“ä½œå°è£…åœ¨è®¿é—®è€…ç±»ä¸­ã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨ä¸ä¿®æ”¹æ•°æ®ç»“æ„ä»£ç çš„æƒ…å†µä¸‹æ·»åŠ æ–°çš„æ“ä½œã€‚è€Œ Acyclic Visitor æ¨¡å¼åˆ™æ›´æ³¨é‡è§£å†³ Visitor æ¨¡å¼ä¸­å¯èƒ½å‡ºç°çš„å¾ªç¯ä¾èµ–é—®é¢˜ã€‚\nå®ç°æ–¹å¼ä¸åŒ åœ¨ Visitor æ¨¡å¼ä¸­ï¼Œè®¿é—®è€…ç±»é€šå¸¸ä¼šç»´æŠ¤ä¸€ä¸ªæ•°æ®ç»“æ„ç±»çš„å¼•ç”¨ï¼Œä»¥ä¾¿åœ¨ visit æ–¹æ³•ä¸­è®¿é—®æ•°æ®ç»“æ„ç±»çš„æˆå‘˜ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´å¾ªç¯ä¾èµ–é—®é¢˜ã€‚è€Œåœ¨ Acyclic Visitor æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ªé¢å¤–çš„æ¥å£ï¼Œå³å¯é€‰æ“ä½œæ¥å£ï¼Œå®ƒåŒ…å«æ•°æ®ç»“æ„ç±»å¯èƒ½éœ€è¦è°ƒç”¨çš„æ–¹æ³•ã€‚è¿™æ ·ï¼Œæ•°æ®ç»“æ„ç±»å°±å¯ä»¥é€šè¿‡è°ƒç”¨ visit æ–¹æ³•æ¥è®¿é—®è®¿é—®è€…ç±»ä¸­çš„éƒ¨åˆ†æ“ä½œï¼Œè€Œä¸å¿…ç›´æ¥ä¾èµ–äºè®¿é—®è€…ç±»ä¸­çš„æˆå‘˜ï¼Œä»è€Œé¿å…äº†å¾ªç¯ä¾èµ–é—®é¢˜ã€‚\nå¯æ‰©å±•æ€§ä¸åŒ ç”±äº Visitor æ¨¡å¼ä¸­æ•°æ®ç»“æ„ç±»å’Œè®¿é—®è€…ç±»ä¹‹é—´å­˜åœ¨å¼ºè€¦åˆå…³ç³»ï¼Œå› æ­¤æ·»åŠ æ–°çš„æ•°æ®ç»“æ„ç±»æˆ–è®¿é—®è€…ç±»å¯èƒ½ä¼šå¯¼è‡´ä»£ç ä¿®æ”¹ã€‚è€Œ Acyclic Visitor æ¨¡å¼é€šè¿‡å¼•å…¥å¯é€‰æ“ä½œæ¥å£ï¼Œä½¿å¾—æ•°æ®ç»“æ„ç±»å’Œè®¿é—®è€…ç±»ä¹‹é—´çš„è€¦åˆå…³ç³»æ›´åŠ çµæ´»ï¼Œä»è€Œæé«˜äº†ä»£ç çš„å¯æ‰©å±•æ€§ã€‚\nå®ç°å¤æ‚åº¦ä¸åŒ Acyclic Visitor æ¨¡å¼ç›¸æ¯” Visitor æ¨¡å¼ï¼Œå¢åŠ äº†ä¸€ä¸ªå¯é€‰æ“ä½œæ¥å£ï¼Œå› æ­¤å®ç°ä¸Šå¯èƒ½ä¼šæ›´åŠ å¤æ‚ã€‚ä½†æ˜¯ï¼Œè¿™ä¹Ÿä½¿å¾— Acyclic Visitor æ¨¡å¼æ›´åŠ çµæ´»å’Œå¯æ‰©å±•ã€‚\nä¼˜ç¼ºç‚¹ ä¸‹é¢æ˜¯ Acyclic Visitor æ¨¡å¼çš„ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼š\nä¼˜ç‚¹ï¼š\nè§£å†³äº† Visitor æ¨¡å¼å¯èƒ½å‡ºç°çš„å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½¿å¾—ä»£ç æ›´åŠ å¥å£®å’Œå¯ç»´æŠ¤ã€‚ å¯é€‰æ“ä½œæ¥å£ä½¿å¾—è®¿é—®è€…ç±»çš„æ‰©å±•æ›´åŠ çµæ´»ï¼Œå¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©å®ç°ä¸åŒçš„æ“ä½œã€‚ å°†æ•°æ®ç»“æ„å’Œæ“ä½œåˆ†ç¦»å¼€æ¥ï¼Œæé«˜äº†ä»£ç çš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ åœ¨éœ€è¦æ·»åŠ æ–°çš„æ•°æ®ç»“æ„ç±»æˆ–è®¿é—®è€…ç±»æ—¶ï¼Œå¯ä»¥é¿å…å¯¹ç°æœ‰ä»£ç è¿›è¡Œä¿®æ”¹ï¼Œç¬¦åˆå¼€é—­åŸåˆ™ã€‚ ç¼ºç‚¹ï¼š\nç›¸å¯¹äº Visitor æ¨¡å¼ï¼ŒAcyclic Visitor æ¨¡å¼çš„å®ç°ä¼šæ›´åŠ å¤æ‚ï¼Œå› ä¸ºéœ€è¦å¼•å…¥ä¸€ä¸ªå¯é€‰æ“ä½œæ¥å£ã€‚ ç”±äº Acyclic Visitor æ¨¡å¼åœ¨å®ç°ä¸Šæ›´åŠ å¤æ‚ï¼Œå¯èƒ½ä¼šé™ä½ä»£ç çš„å¯è¯»æ€§å’Œå¯ç†è§£æ€§ã€‚ å¦‚æœæ•°æ®ç»“æ„ç±»éœ€è¦è®¿é—®è®¿é—®è€…ç±»çš„æˆå‘˜ï¼ŒAcyclic Visitor æ¨¡å¼å¹¶ä¸èƒ½å¾ˆå¥½åœ°è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦è€ƒè™‘å…¶ä»–è®¾è®¡æ¨¡å¼çš„ä½¿ç”¨ã€‚ ä½¿ç”¨åœºæ™¯ Acyclic Visitor æ¨¡å¼é€šå¸¸ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š\nç±»å±‚æ¬¡ç»“æ„ä¸­å­˜åœ¨å¤šç§ç±»å‹çš„å¯¹è±¡ï¼Œå¹¶ä¸”éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œä¸åŒçš„æ“ä½œï¼Œä½†ä¸æƒ³åœ¨ç±»å±‚æ¬¡ç»“æ„ä¸­æ·»åŠ æ–°çš„æ–¹æ³•æˆ–ä¿®æ”¹ç°æœ‰æ–¹æ³•ã€‚ ä¸åŒçš„æ“ä½œéœ€è¦è®¿é—®å¯¹è±¡çš„ä¸åŒéƒ¨åˆ†ï¼Œè€Œä¸æ˜¯æ•´ä¸ªå¯¹è±¡æœ¬èº«ã€‚ ç±»å±‚æ¬¡ç»“æ„ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œä½†ä¸å¸Œæœ›å¼•å…¥å¾ªç¯ä¾èµ–é—®é¢˜ã€‚ éœ€è¦åœ¨ç±»å±‚æ¬¡ç»“æ„ä¸­æ·»åŠ æ–°çš„æ“ä½œï¼Œè€Œä¸å½±å“ç°æœ‰çš„ç±»ã€‚ éœ€è¦æ”¯æŒå¤šä¸ªè®¿é—®è€…ï¼Œä¸”è®¿é—®è€…ä¹‹é—´å¯èƒ½å­˜åœ¨ä¾èµ–å…³ç³»ã€‚ éœ€è¦é¿å…åœ¨è®¿é—®è€…ä¸­ä½¿ç”¨ instanceof è¿ç®—ç¬¦æ¥æ£€æŸ¥å…ƒç´ çš„ç±»å‹ã€‚ å…·ä½“çš„ä½¿ç”¨åœºæ™¯å¦‚ä¸‹ï¼š\nè§£æå™¨ï¼ˆParserï¼‰ï¼šåœ¨è§£æå™¨ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°ä¸åŒç±»å‹çš„èŠ‚ç‚¹çš„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°è¯­æ³•æ ‘çš„éå†ï¼Œä»¥å®ç°è¯­æ³•åˆ†æã€ç±»å‹æ£€æŸ¥ç­‰åŠŸèƒ½ã€‚ ç¼–è¯‘å™¨ï¼ˆCompilerï¼‰ï¼šåœ¨ç¼–è¯‘å™¨ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°ä¸åŒé˜¶æ®µçš„åˆ†æã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°è¯æ³•åˆ†æå™¨ã€è¯­æ³•åˆ†æå™¨ã€ç±»å‹æ£€æŸ¥å™¨ã€ä»£ç ç”Ÿæˆå™¨ç­‰ã€‚ å›¾å½¢ç”¨æˆ·ç•Œé¢ï¼ˆGUIï¼‰ï¼šåœ¨å›¾å½¢ç”¨æˆ·ç•Œé¢ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°ä¸åŒç±»å‹çš„æ§ä»¶çš„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°çª—å£ã€æŒ‰é’®ã€èœå•ç­‰æ§ä»¶çš„äº‹ä»¶å¤„ç†é€»è¾‘ã€‚ æ•°æ®åº“è®¿é—®ï¼ˆDatabase Accessï¼‰ï¼šåœ¨æ•°æ®åº“è®¿é—®ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°ä¸åŒç±»å‹çš„å¯¹è±¡çš„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°å¯¹å…³ç³»å‹æ•°æ®åº“ä¸­çš„è¡¨ã€è§†å›¾ã€å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ç­‰å¯¹è±¡çš„è®¿é—®ã€‚ æ¸¸æˆå¼€å‘ï¼ˆGame Developmentï¼‰ï¼šåœ¨æ¸¸æˆå¼€å‘ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°ä¸åŒç±»å‹çš„æ¸¸æˆå¯¹è±¡çš„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°å¯¹è§’è‰²ã€é“å…·ã€æ€ªç‰©ç­‰æ¸¸æˆå¯¹è±¡çš„è®¿é—®ã€‚ æ‰“å°æœºé©±åŠ¨ç¨‹åºï¼ˆPrinter Driverï¼‰ï¼šåœ¨æ‰“å°æœºé©±åŠ¨ç¨‹åºä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°ä¸åŒç±»å‹çš„æ‰“å°ä½œä¸šçš„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°å¯¹æ–‡æœ¬ã€å›¾ç‰‡ã€è¡¨æ ¼ç­‰æ‰“å°ä½œä¸šçš„è®¿é—®ã€‚ éŸ³é¢‘å¤„ç†ï¼ˆAudio Processingï¼‰ï¼šåœ¨éŸ³é¢‘å¤„ç†ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°ä¸åŒç±»å‹çš„éŸ³é¢‘æ–‡ä»¶çš„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°å¯¹ MP3ã€WAVã€FLAC ç­‰éŸ³é¢‘æ–‡ä»¶çš„è®¿é—®ã€‚ ç½‘ç»œåè®®ï¼ˆNetwork Protocolï¼‰ï¼šåœ¨ç½‘ç»œåè®®ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°ä¸åŒç±»å‹çš„åè®®æ•°æ®åŒ…çš„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°å¯¹ TCPã€UDPã€HTTPã€SMTP ç­‰åè®®æ•°æ®åŒ…çš„è®¿é—®ã€‚ æœºå™¨äººæ§åˆ¶ï¼ˆRobot Controlï¼‰ï¼šåœ¨æœºå™¨äººæ§åˆ¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°ä¸åŒç±»å‹çš„æœºå™¨äººåŠ¨ä½œçš„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°å¯¹ç§»åŠ¨ã€è½¬å‘ã€æŠ“å–ã€æ”¾ç½®ç­‰æœºå™¨äººåŠ¨ä½œçš„è®¿é—®ã€‚ ç³»ç»Ÿç›‘æ§ï¼ˆSystem Monitoringï¼‰ï¼šåœ¨ç³»ç»Ÿç›‘æ§ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°ä¸åŒç±»å‹çš„ç›‘æµ‹æ•°æ®çš„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°å¯¹ CPU å ç”¨ç‡ã€å†…å­˜ä½¿ç”¨é‡ã€ç½‘ç»œæµé‡ç­‰ç›‘æµ‹æ•°æ®çš„è®¿é—®ã€‚ æœºå™¨å­¦ä¹ ï¼ˆMachine Learningï¼‰ï¼šåœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°ä¸åŒç±»å‹çš„è®­ç»ƒæ•°æ®çš„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°å¯¹å›¾åƒã€å£°éŸ³ã€æ–‡æœ¬ç­‰è®­ç»ƒæ•°æ®çš„è®¿é—®ã€‚ é‡‘èäº¤æ˜“ï¼ˆFinancial Tradingï¼‰ï¼šåœ¨é‡‘èäº¤æ˜“ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°ä¸åŒç±»å‹çš„äº¤æ˜“æ•°æ®çš„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°å¯¹è‚¡ç¥¨ã€æœŸè´§ã€å¤–æ±‡ç­‰äº¤æ˜“æ•°æ®çš„è®¿é—®ã€‚ ç”µå­å•†åŠ¡ï¼ˆE-commerceï¼‰ï¼šåœ¨ç”µå­å•†åŠ¡ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°ä¸åŒç±»å‹çš„å•†å“æ•°æ®çš„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°å¯¹äº§å“ã€è®¢å•ã€å®¢æˆ·ç­‰å•†å“æ•°æ®çš„è®¿é—®ã€‚ ç¡¬ä»¶æ§åˆ¶ï¼ˆHardware Controlï¼‰ï¼šåœ¨ç¡¬ä»¶æ§åˆ¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°ä¸åŒç±»å‹çš„ç¡¬ä»¶è®¾å¤‡çš„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°å¯¹ä¼ æ„Ÿå™¨ã€ç”µæœºã€æ‰§è¡Œå™¨ç­‰ç¡¬ä»¶è®¾å¤‡çš„è®¿é—®ã€‚ ä¸€ä¸ªæ›´å…·ä½“çš„ä¾‹å­æ˜¯ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°å›¾åƒå¤„ç†åŠŸèƒ½ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå›¾åƒå¤„ç†ç¨‹åºï¼Œå®ƒå¯ä»¥å¤„ç†å¤šç§ç±»å‹çš„å›¾åƒï¼Œå¦‚ JPEGã€PNGã€BMP ç­‰ã€‚æˆ‘ä»¬éœ€è¦ä¸ºè¯¥ç¨‹åºæ·»åŠ ä¸€ä¸ªæ–°çš„åŠŸèƒ½ï¼Œå³å°†å›¾åƒè½¬æ¢ä¸ºé»‘ç™½å›¾åƒã€‚\nä¸ºå®ç°è¿™ä¸€åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥è®¾è®¡å›¾åƒå¤„ç†ç±»å±‚æ¬¡ç»“æ„ã€‚ç±»å±‚æ¬¡ç»“æ„åŒ…æ‹¬å¤šç§ç±»å‹çš„å›¾åƒï¼Œå¦‚ JPEGImageã€PNGImageã€BMPImage ç­‰ã€‚å¯¹äºæ¯ç§ç±»å‹çš„å›¾åƒï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç›¸åº”çš„å›¾åƒå¤„ç†å™¨ç±»ï¼Œå¦‚ JPEGImageHandlerã€PNGImageHandlerã€BMPImageHandler ç­‰ã€‚æ¯ä¸ªå›¾åƒå¤„ç†å™¨ç±»éƒ½å®ç°ä¸€ä¸ª Visitor æ¥å£çš„å­æ¥å£ï¼Œå¦‚ JPEGImageVisitorã€PNGImageVisitorã€BMPImageVisitorï¼Œè¯¥å­æ¥å£å®šä¹‰äº†ä¸€äº› visit æ–¹æ³•ï¼Œç”¨äºå¤„ç†å›¾åƒä¸­çš„åƒç´ æ•°æ®ã€‚\nå®šä¹‰ Visitor æ¥å£åŠå…¶å­æ¥å£ï¼š\npublic interface Visitor { } public interface JPEGImageVisitor extends Visitor { void visit(JPEGImage image); } public interface PNGImageVisitor extends Visitor { void visit(PNGImage image); } public interface BMPImageVisitor extends Visitor { void visit(BMPImage image); } å®šä¹‰å›¾åƒç±»åŠå…¶å­ç±»ï¼š\npublic interface Image { void accept(Visitor visitor); } public class JPEGImage implements Image { private byte[] data; public JPEGImage(byte[] data) { this.data = data; } public byte[] getData() { return data; } @Override public void accept(Visitor visitor) { if (visitor instanceof JPEGImageVisitor) { ((JPEGImageVisitor) visitor).visit(this); } } } public class PNGImage implements Image { private byte[] data; public PNGImage(byte[] data) { this.data = data; } public byte[] getData() { return data; } @Override public void accept(Visitor visitor) { if (visitor instanceof PNGImageVisitor) { ((PNGImageVisitor) visitor).visit(this); } } } public class BMPImage implements Image { private byte[] data; public BMPImage(byte[] data) { this.data = data; } public byte[] getData() { return data; } @Override public void accept(Visitor visitor) { if (visitor instanceof BMPImageVisitor) { ((BMPImageVisitor) visitor).visit(this); } } } å®šä¹‰é»‘ç™½å›¾åƒå¤„ç†å™¨ç±»ï¼š\npublic class BlackWhiteImageProcessor implements JPEGImageVisitor, PNGImageVisitor,BMPImageVisitor { @Override public void visit(JPEGImage image) { // å°† JPEG å›¾åƒè½¬æ¢ä¸ºé»‘ç™½å›¾åƒ // å¤„ç†åƒç´ æ•°æ® byte[] data = image.getData(); // ... } @Override public void visit(PNGImage image) { // å°† PNG å›¾åƒè½¬æ¢ä¸ºé»‘ç™½å›¾åƒ // å¤„ç†åƒç´ æ•°æ® byte[] data = image.getData(); // ... } @Override public void visit(BMPImage image) { // å°† BMP å›¾åƒè½¬æ¢ä¸ºé»‘ç™½å›¾åƒ // å¤„ç†åƒç´ æ•°æ® byte[] data = image.getData(); // ... } } æœ€åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°å›¾åƒå¤„ç†åŠŸèƒ½ï¼š\npublic class Client { public static void main(String[] args) { List\u0026lt;Image\u0026gt; images = new ArrayList\u0026lt;\u0026gt;(); images.add(new JPEGImage(jpegData)); images.add(new PNGImage(pngData)); images.add(new BMPImage(bmpData)); BlackWhiteImageProcessor processor = new BlackWhiteImageProcessor(); for (Image image : images) { image.accept(processor); } } } åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒAcyclic Visitor æ¨¡å¼ä½¿æˆ‘ä»¬èƒ½å¤Ÿå®ç°å¯¹å¤šç§ç±»å‹çš„å›¾åƒè¿›è¡Œä¸åŒçš„å¤„ç†ï¼ŒåŒæ—¶ä¿æŒä»£ç çš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°æ·»åŠ æ–°çš„å›¾åƒå¤„ç†å™¨ç±»ï¼Œå¦‚ SepiaImageProcessorã€BlurImageProcessor ã€RotateImageProcessor ç­‰ï¼Œè€Œæ— éœ€ä¿®æ”¹å›¾åƒç±»å±‚æ¬¡ç»“æ„çš„ä»£ç ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é¿å…åœ¨å›¾åƒç±»å±‚æ¬¡ç»“æ„ä¸­æ·»åŠ å¤„ç†æ–¹æ³•ï¼Œè€Œæ˜¯å°†å¤„ç†é€»è¾‘å°è£…åœ¨è®¿é—®è€…ç±»ä¸­ï¼Œä»è€Œæé«˜ä»£ç çš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚\nä¸‹é¢æˆ‘ç»™å‡ºä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ä»£ç æ¥æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°å¯¹ CPU å ç”¨ç‡ã€å†…å­˜ä½¿ç”¨é‡ã€ç½‘ç»œæµé‡ç­‰ç›‘æµ‹æ•°æ®çš„è®¿é—®ã€‚\né¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª Visitor æ¥å£åŠå…¶å­æ¥å£ï¼š\npublic interface Visitor { } public interface CPUUsageVisitor extends Visitor { void visit(CPUUsage cpuUsage); } public interface MemoryUsageVisitor extends Visitor { void visit(MemoryUsage memoryUsage); } public interface NetworkTrafficVisitor extends Visitor { void visit(NetworkTraffic networkTraffic); } ç„¶åï¼Œæˆ‘ä»¬å®šä¹‰ä¸‰ä¸ªç›‘æµ‹æ•°æ®ç±»ï¼šCPUUsageã€MemoryUsage å’Œ NetworkTrafficã€‚è¿™äº›ç±»å®ç°äº† Visitor æ¥å£ï¼Œå¹¶ä¸”å®šä¹‰äº†ä¸€ä¸ª accept æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ª Visitor å¯¹è±¡ï¼Œå¹¶è°ƒç”¨ Visitor å¯¹è±¡çš„ visit æ–¹æ³•ï¼š\npublic interface Usages { void accept(Visitor visitor); } public class CPUUsage implements Usages { private double usage; public CPUUsage(double usage) { this.usage = usage; } public double getUsage() { return usage; } public void accept(Visitor visitor) { if (visitor instanceof CPUUsageVisitor) { ((CPUUsageVisitor) visitor).visit(this); } } } public class MemoryUsage implements Visitor { private long used; private long total; public MemoryUsage(long used, long total) { this.used = used; this.total = total; } public long getUsed() { return used; } public long getTotal() { return total; } public void accept(Visitor visitor) { if (visitor instanceof MemoryUsageVisitor) { ((MemoryUsageVisitor) visitor).visit(this); } } } public class NetworkTraffic implements Visitor { private long sent; private long received; public NetworkTraffic(long sent, long received) { this.sent = sent; this.received = received; } public long getSent() { return sent; } public long getReceived() { return received; } public void accept(Visitor visitor) { if (visitor instanceof NetworkTrafficVisitor) { ((NetworkTrafficVisitor) visitor).visit(this); } } } æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰ä¸‰ä¸ª Visitor å®ç°ç±»ï¼šCPUUsageLoggerVistorã€MemoryUsageLoggerVistor å’Œ NetworkTrafficLoggerVistorã€‚è¿™äº›ç±»å®ç°äº† CPUUsageVisitorã€MemoryUsageVisitor å’Œ NetworkTrafficVisitor æ¥å£ï¼Œå¹¶å®ç°äº† visit æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç”¨äºè®°å½•ç›‘æµ‹æ•°æ®ï¼š\npublic class CPUUsageLoggerVistor implements CPUUsageVisitor { public void visit(CPUUsage cpuUsage) { double usage = cpuUsage.getUsage(); System.out.println(\u0026#34;CPU Usage: \u0026#34; + usage); } } public class MemoryUsageLoggerVistor implements MemoryUsageVisitor { public void visit(MemoryUsage memoryUsage) { long used = memoryUsage.getUsed(); long total = memoryUsage.getTotal(); double usage = (double) used / total * 100; System.out.println(\u0026#34;Memory Usage: \u0026#34; + usage + \u0026#34;%\u0026#34;); } } public class NetworkTrafficLoggerVistor implements NetworkTrafficVisitor { public void visit(NetworkTraffic networkTraffic) { long sent = networkTraffic.getSent(); long received = networkTraffic.getReceived(); System.out.println(\u0026#34;Network Traffic: Sent=\u0026#34; + sent + \u0026#34; bytes, Received=\u0026#34; + received + \u0026#34; bytes\u0026#34;); } } æœ€åï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç›‘æµ‹æ•°æ®æºç±»ï¼šSystemMonitorã€‚è¯¥ç±»ç»´æŠ¤ä¸‰ä¸ªç›‘æµ‹æ•°æ®ï¼šCPUUsageã€MemoryUsage å’Œ NetworkTrafficï¼Œå¹¶æä¾›ç›¸åº”çš„æ–¹æ³•ç”¨äºæ›´æ–°ç›‘æµ‹æ•°æ®ã€‚è¯¥ç±»è¿˜æä¾›ä¸€ä¸ª accept æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ª Visitor å¯¹è±¡ï¼Œå¹¶å°†è¯¥ Visitor å¯¹è±¡ä¼ é€’ç»™å„ä¸ªç›‘æµ‹æ•°æ®å¯¹è±¡ï¼š\npublic class SystemMonitor { private CPUUsage cpuUsage; private MemoryUsage memoryUsage; private NetworkTraffic networkTraffic; public void updateCPUUsage(double usage) { cpuUsage = new CPUUsage(usage); } public void updateMemoryUsage(long used, long total) { memoryUsage = new MemoryUsage(used, total); } public void updateNetworkTraffic(long sent,long received) { networkTraffic = new NetworkTraffic(sent, received); } public void accept(Visitor visitor) { if (cpuUsage != null) { cpuUsage.accept(visitor); } if (memoryUsage != null) { memoryUsage.accept(visitor); } if (networkTraffic != null) { networkTraffic.accept(visitor); } } } ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸Šè¿°ç±»æ¥å®ç°å¯¹ CPU å ç”¨ç‡ã€å†…å­˜ä½¿ç”¨é‡ã€ç½‘ç»œæµé‡ç­‰ç›‘æµ‹æ•°æ®çš„è®¿é—®ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª SystemMonitor å¯¹è±¡ï¼Œå¹¶æ›´æ–°ç›‘æµ‹æ•°æ®ï¼š\nSystemMonitor monitor = new SystemMonitor(); monitor.updateCPUUsage(0.75); monitor.updateMemoryUsage(1024, 2048); monitor.updateNetworkTraffic(1024, 2048); ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸‰ä¸ª Visitor å¯¹è±¡ï¼šCPUUsageLoggerVistorã€MemoryUsageLoggerVistor å’Œ NetworkTrafficLoggerVistorï¼Œç”¨äºè®°å½•ç›‘æµ‹æ•°æ®ï¼š\nCPUUsageLoggerVistor cpuUsageLogger = new CPUUsageLoggerVistor(); MemoryUsageLoggerVistor memoryUsageLogger = new MemoryUsageLoggerVistor(); NetworkTrafficLoggerVistor networkTrafficLogger = new NetworkTrafficLoggerVistor(); æœ€åï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº› Visitor å¯¹è±¡ä¼ é€’ç»™ SystemMonitor å¯¹è±¡ï¼Œå¹¶è°ƒç”¨ accept æ–¹æ³•æ¥è®¿é—®ç›‘æµ‹æ•°æ®ï¼š\nmonitor.accept(cpuUsageLogger); monitor.accept(memoryUsageLogger); monitor.accept(networkTrafficLogger); è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ Acyclic Visitor æ¨¡å¼æ¥å®ç°å¯¹ CPU å ç”¨ç‡ã€å†…å­˜ä½¿ç”¨é‡ã€ç½‘ç»œæµé‡ç­‰ç›‘æµ‹æ•°æ®çš„è®¿é—®ã€‚\nå‚è€ƒæ–‡ç«  Acyclic Visitor by Robert C. Martin\nAcyclic Visitor in WikiWikiWeb\n","permalink":"https://blog.chensoul.cc/posts/2023/06/01/java-design-patterns-acyclic-visitor/","summary":"æœ¬æ–‡ä¸»è¦ä»‹ç» Acyclic Visitor æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nJava Design Patterns æä¾›äº†å„ç§ Java è®¾è®¡æ¨¡å¼çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ã€‚è¯¥ç½‘ç«™æ—¨åœ¨å¸®åŠ© Java å¼€å‘äººå‘˜äº†è§£å’Œåº”ç”¨å„ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚\nJava Design Patterns ç½‘ç«™æä¾›äº†å¤šç§è®¾è®¡æ¨¡å¼åˆ†ç±»æ–¹å¼ï¼ŒåŒ…æ‹¬åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational Patternsï¼‰ã€ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternsï¼‰å’Œè¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰ï¼Œä»¥åŠå…¶ä»–ä¸€äº›å¸¸è§çš„æ¨¡å¼ã€‚\nå¯¹äºæ¯ä¸ªè®¾è®¡æ¨¡å¼ï¼Œè¯¥ç½‘ç«™æä¾›äº†è¯¦ç»†çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ï¼Œå¹¶ä¸”æä¾›äº†ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ã€‚å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©é€‚åˆè‡ªå·±çš„è®¾è®¡æ¨¡å¼ï¼Œå¹¶ä¸”å¯ä»¥å‚è€ƒç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜æ¥ç†è§£å’Œåº”ç”¨è¯¥æ¨¡å¼ã€‚\næ­¤å¤–ï¼ŒJava Design Patterns ç½‘ç«™è¿˜æä¾›äº†ä¸€äº›å…¶ä»–èµ„æºï¼Œå¦‚è®¾è®¡æ¨¡å¼çš„ UML å›¾ã€è®¾è®¡æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ã€è®¾è®¡æ¨¡å¼çš„æ¯”è¾ƒç­‰ã€‚è¿™äº›èµ„æºå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨è®¾è®¡æ¨¡å¼ã€‚\nä¸­æ–‡ç½‘ç«™ï¼šhttps://java-design-patterns.com/zh/\nGithub ä¸Šæºç ä»“åº“ï¼ˆéå®˜æ–¹ï¼‰ï¼šhttps://github.com/iluwatar/java-design-patterns\nç›®çš„ å…è®¸å°†æ–°åŠŸèƒ½æ·»åŠ åˆ°ç°æœ‰çš„ç±»å±‚æ¬¡ç»“æ„ä¸­ï¼Œè€Œä¸ä¼šå½±å“è¿™äº›å±‚æ¬¡ç»“æ„ï¼Œä¹Ÿä¸ä¼šæœ‰å››äººå¸®è®¿å®¢æ¨¡å¼ä¸­é‚£æ ·å¾ªç¯ä¾èµ–çš„é—®é¢˜ã€‚\nåœ¨ Acyclic Visitor æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å¼•å…¥ä¸€ä¸ªå¯é€‰æ“ä½œæ¥å£æ¥å®ç°è¿™ä¸€ç‚¹ã€‚å½“æ•°æ®ç»“æ„ç±»éœ€è¦è®¿é—®è®¿é—®è€…ç±»çš„æŸäº›æ“ä½œæ—¶ï¼Œå®ƒå¯ä»¥é€šè¿‡è°ƒç”¨ visit æ–¹æ³•æ¥è®¿é—®å¯é€‰æ“ä½œæ¥å£ä¸­å®šä¹‰çš„æ“ä½œï¼Œè€Œä¸éœ€è¦ç›´æ¥ä¾èµ–äºè®¿é—®è€…ç±»ä¸­çš„æˆå‘˜å˜é‡ã€‚\nè§£é‡Š çœŸå®ä¸–ç•Œä¾‹å­\næˆ‘ä»¬æœ‰ä¸€ä¸ªè°ƒåˆ¶è§£è°ƒå™¨ç±»çš„å±‚æ¬¡ç»“æ„ã€‚ éœ€è¦ä½¿ç”¨åŸºäºè¿‡æ»¤æ¡ä»¶çš„å¤–éƒ¨ç®—æ³•ï¼ˆæ˜¯ Unix æˆ– DOS å…¼å®¹çš„è°ƒåˆ¶è§£è°ƒå™¨ï¼‰æ¥è®¿é—®æ­¤å±‚æ¬¡ç»“æ„ä¸­çš„è°ƒåˆ¶è§£è°ƒå™¨ã€‚\nç¨‹åºç¤ºä¾‹\nè¿™æ˜¯è°ƒåˆ¶è§£è°ƒå™¨çš„å±‚æ¬¡ç»“æ„ã€‚\npublic interface Modem { void accept(ModemVisitor modemVisitor); } public class Hayes implements Modem { @Override public void accept(ModemVisitor modemVisitor) { if (modemVisitor instanceof HayesVisitor) { ((HayesVisitor) modemVisitor).visit(this); } else { System.out.println(\u0026#34;Only HayesVisitor is allowed to visit Hayes modem\u0026#34;); } } } public class Zoom implements Modem { @Override public void accept(ModemVisitor modemVisitor) { if (modemVisitor instanceof ZoomVisitor) { ((ZoomVisitor) modemVisitor).","title":"Javaè®¾è®¡æ¨¡å¼ï¼šAcyclic Visitor"},{"content":" Python .whl æ–‡ä»¶æˆ– wheels æ˜¯ Python ä¸­å¾ˆå°‘è¢«è®¨è®ºçš„éƒ¨åˆ†ï¼Œä½†å®ƒä»¬å¯¹ Python åŒ…çš„å®‰è£…è¿‡ç¨‹å¤§æœ‰è£¨ç›Šã€‚å¦‚æœæ‚¨ä½¿ç”¨ pip å®‰è£…äº† Python åŒ…ï¼Œé‚£ä¹ˆ Wheels å¾ˆå¯èƒ½ä½¿å®‰è£…æ›´å¿«ã€æ›´é«˜æ•ˆã€‚\nWheels æ˜¯ Python ç”Ÿæ€ç³»ç»Ÿçš„ä¸€ä¸ªç»„ä»¶ï¼Œæœ‰åŠ©äºä½¿åŒ…å®‰è£…æ­£å¸¸å·¥ä½œã€‚å®ƒä»¬å…è®¸æ›´å¿«çš„å®‰è£…å’Œæ›´ç¨³å®šçš„åŒ…åˆ†å‘è¿‡ç¨‹ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†æ·±å…¥äº†è§£ Wheels æ˜¯ä»€ä¹ˆï¼Œå®ƒä»¬æœ‰ä»€ä¹ˆå¥½å¤„ï¼Œä»¥åŠå®ƒä»¬å¦‚ä½•è·å¾—ç‰µå¼•åŠ›å¹¶ä½¿ Python ä½¿ç”¨èµ·æ¥æ›´åŠ æ„‰å¿«ã€‚\nåœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†å­¦ä¹ ï¼š\nä»€ä¹ˆæ˜¯ Wheels ä»¥åŠå®ƒä»¬ä¸æºä»£ç åˆ†å‘çš„æ¯”è¾ƒ å¦‚ä½•ä½¿ç”¨ Wheels æ¥æ§åˆ¶åŒ…å®‰è£…è¿‡ç¨‹ å¦‚ä½•ä¸ºæ‚¨è‡ªå·±çš„ Python åŒ…åˆ›å»ºå’Œåˆ†å‘ Wheels æ‚¨å°†ä»ç”¨æˆ·å’Œå¼€å‘äººå‘˜çš„è§’åº¦çœ‹åˆ°ä½¿ç”¨æµè¡Œçš„å¼€æº Python åŒ…çš„ç¤ºä¾‹ã€‚\nå…è´¹èµ å“ï¼šå•å‡»æ­¤å¤„è·å– Python å¤‡å¿˜å•å¹¶å­¦ä¹  Python 3 çš„åŸºç¡€çŸ¥è¯†ï¼Œä¾‹å¦‚ä½¿ç”¨æ•°æ®ç±»å‹ã€å­—å…¸ã€åˆ—è¡¨å’Œ Python å‡½æ•°ã€‚\nå®‰è£… æ¥ä¸‹æ¥ï¼Œæ¿€æ´»è™šæ‹Ÿç¯å¢ƒå¹¶ç¡®ä¿å®‰è£…äº†æœ€æ–°ç‰ˆæœ¬çš„ pip ã€ wheel å’Œ setuptools ï¼š\n$ python -m venv env \u0026amp;\u0026amp; source ./env/bin/activate $ python -m pip install -U pip wheel setuptools Successfully installed pip 20.1 setuptools-46.1.3 wheel-0.34.2 è¿™å°±æ˜¯æ‚¨å°è¯•å®‰è£…å’Œæ„å»º Wheels æ‰€éœ€çš„å…¨éƒ¨å†…å®¹ï¼\nPython æ‰“åŒ…å˜å¾—æ›´å¥½ï¼šPython Wheels ç®€ä»‹ åœ¨å­¦ä¹ å¦‚ä½•å°†é¡¹ç›®æ‰“åŒ…åˆ° wheel ä¹‹å‰ï¼Œä»ç”¨æˆ·çš„è§’åº¦äº†è§£ä½¿ç”¨ wheel çš„æ ·å­ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚è¿™å¬èµ·æ¥å¯èƒ½æœ‰ç‚¹è½åï¼Œä½†äº†è§£ Wheels å¦‚ä½•å·¥ä½œçš„ä¸€ä¸ªå¥½æ–¹æ³•æ˜¯ä»å®‰è£…ä¸€ä¸ªä¸æ˜¯ Wheels çš„ä¸œè¥¿å¼€å§‹ã€‚\næ‚¨å¯ä»¥åƒå¾€å¸¸ä¸€æ ·ï¼Œé€šè¿‡å°† Python åŒ…å®‰è£…åˆ°æ‚¨çš„ç¯å¢ƒä¸­æ¥å¼€å§‹è¿™ä¸ªå®éªŒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®‰è£… uWSGI ç‰ˆæœ¬ 2.0.xï¼š\n$ python -m pip install \u0026#39;uwsgi==2.0.*\u0026#39; Collecting uwsgi==2.0.* Downloading uwsgi-2.0.18.tar.gz (801 kB) |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 801 kB 1.1 MB/s Building wheels for collected packages: uwsgi Building wheel for uwsgi (setup.py) ... done Created wheel for uwsgi ... uWSGI-2.0.18-cp38-cp38-macosx_10_15_x86_64.whl Stored in directory: /private/var/folders/jc/8_hqsz0x1tdbp05 ... Successfully built uwsgi Installing collected packages: uwsgi Successfully installed uwsgi-2.0.18 ä¸ºäº†å®Œå…¨å®‰è£… uWSGIï¼Œ pip é€šè¿‡å‡ ä¸ªä¸åŒçš„æ­¥éª¤è¿›è¡Œï¼š\nåœ¨ç¬¬ 3 è¡Œï¼Œå®ƒä¸‹è½½äº†ä¸€ä¸ªåä¸º uwsgi-2.0.18.tar.gz çš„ TAR æ–‡ä»¶ (tarball)ï¼Œè¯¥æ–‡ä»¶å·²ä½¿ç”¨ gzip å‹ç¼©ã€‚\nåœ¨ç¬¬ 6 è¡Œï¼Œå®ƒè·å– tarball å¹¶é€šè¿‡è°ƒç”¨ setup.py æ„å»ºä¸€ä¸ª .whl æ–‡ä»¶ã€‚\nåœ¨ç¬¬ 7 è¡Œï¼Œå®ƒå°† wheel æ ‡è®°ä¸º uWSGI-2.0.18-cp38-cp38-macosx_10_15_x86_64.whl ã€‚\nåœ¨ç¬¬ 10 è¡Œï¼Œå®ƒåœ¨æ„å»º wheel åå®‰è£…å®é™…çš„åŒ…ã€‚\npip æ£€ç´¢åˆ°çš„ tar.gz tarball æ˜¯æºä»£ç åˆ†å‘ç‰ˆæˆ– sdist ï¼Œè€Œä¸æ˜¯ wheelã€‚åœ¨æŸäº›æ–¹é¢ï¼Œ sdist ä¸ wheel ç›¸åã€‚\næ³¨æ„ï¼šå¦‚æœæ‚¨çœ‹åˆ° uWSGI å®‰è£…é”™è¯¯ï¼Œæ‚¨å¯èƒ½éœ€è¦å®‰è£… Python å¼€å‘å¤´æ–‡ä»¶ã€‚\næºä»£ç åˆ†å‘åŒ…å«æºä»£ç ã€‚è¿™ä¸ä»…åŒ…æ‹¬ Python ä»£ç ï¼Œè¿˜åŒ…æ‹¬ä¸åŒ…æ†ç»‘åœ¨ä¸€èµ·çš„ä»»ä½•æ‰©å±•æ¨¡å—ï¼ˆé€šå¸¸æ˜¯ C æˆ– C++ï¼‰çš„æºä»£ç ã€‚å¯¹äºæºä»£ç åˆ†å‘ï¼Œæ‰©å±•æ¨¡å—æ˜¯åœ¨ç”¨æˆ·ç«¯è€Œä¸æ˜¯å¼€å‘äººå‘˜ç«¯ç¼–è¯‘çš„ã€‚\næºåˆ†å‘ç‰ˆè¿˜åŒ…å«ä¸€ç»„å…ƒæ•°æ®ï¼Œä½äºåä¸º \u0026lt;package-name\u0026gt;.egg-info çš„ç›®å½•ä¸­ã€‚æ­¤å…ƒæ•°æ®æœ‰åŠ©äºæ„å»ºå’Œå®‰è£…åŒ…ï¼Œä½†ç”¨æˆ·å®é™…ä¸Šä¸éœ€è¦å¯¹å…¶æ‰§è¡Œä»»ä½•æ“ä½œã€‚\nä»å¼€å‘äººå‘˜çš„è§’åº¦æ¥çœ‹ï¼Œæºä»£ç åˆ†å‘æ˜¯åœ¨æ‚¨è¿è¡Œä»¥ä¸‹å‘½ä»¤æ—¶åˆ›å»ºçš„ï¼š\n$ python setup.py sdist ç°åœ¨å°è¯•å®‰è£…ä¸åŒçš„åŒ… chardetï¼š\n$ python -m pip install \u0026#39;chardet==3.*\u0026#39; Collecting chardet Downloading chardet-3.0.4-py2.py3-none-any.whl (133 kB) |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 133 kB 1.5 MB/s Installing collected packages: chardet Successfully installed chardet-3.0.4 æ‚¨å¯ä»¥çœ‹åˆ°ä¸ uWSGI å®‰è£…æ˜æ˜¾ä¸åŒçš„è¾“å‡ºã€‚\nå®‰è£… chardet ä¼šç›´æ¥ä» PyPI ä¸‹è½½ä¸€ä¸ª .whl æ–‡ä»¶ã€‚ Wheels åç§° chardet-3.0.4-py2.py3-none-any.whl éµå¾ªæ‚¨ç¨åå°†çœ‹åˆ°çš„ç‰¹å®šå‘½åçº¦å®šã€‚ä»ç”¨æˆ·çš„è§’åº¦æ¥çœ‹ï¼Œæ›´é‡è¦çš„æ˜¯å½“ pip åœ¨ PyPI ä¸Šæ‰¾åˆ°å…¼å®¹çš„ wheel æ—¶ï¼Œæ²¡æœ‰æ„å»ºé˜¶æ®µã€‚\nä»å¼€å‘äººå‘˜çš„è§’åº¦æ¥çœ‹ï¼Œwheel æ˜¯è¿è¡Œä»¥ä¸‹å‘½ä»¤çš„ç»“æœï¼š\n$ python setup.py bdist_wheel ä¸ºä»€ä¹ˆ uWSGI ç»™ä½ ä¸€ä¸ªæºä»£ç åˆ†å‘è€Œ chardet æä¾›ä¸€ä¸ª wheelï¼Ÿæ‚¨å¯ä»¥é€šè¿‡æŸ¥çœ‹ PyPI ä¸Šæ¯ä¸ªé¡¹ç›®çš„é¡µé¢å¹¶å¯¼èˆªåˆ°ä¸‹è½½æ–‡ä»¶åŒºåŸŸæ¥äº†è§£å…¶åŸå› ã€‚æœ¬èŠ‚å°†å‘æ‚¨å±•ç¤º pip åœ¨ PyPI ç´¢å¼•æœåŠ¡å™¨ä¸Šå®é™…çœ‹åˆ°çš„å†…å®¹ï¼š\nå‡ºäºä¸é¡¹ç›®å¤æ‚æ€§ç›¸å…³çš„åŸå› ï¼ŒuWSGI ä»…æä¾›äº†ä¸€ä¸ªæºä»£ç åˆ†å‘ï¼ˆ uwsgi-2.0.18.tar.gz ï¼‰ã€‚\nchardet æä¾›äº† wheel å’Œæºä»£ç åˆ†å‘ï¼Œä½†å¦‚æœå®ƒä¸æ‚¨çš„ç³»ç»Ÿå…¼å®¹ï¼Œ pip ä¼šæ›´å–œæ¬¢ wheelã€‚ç¨åæ‚¨å°†çœ‹åˆ°å¦‚ä½•ç¡®å®šå…¼å®¹æ€§ã€‚\nç”¨äº wheel å®‰è£…çš„å…¼å®¹æ€§æ£€æŸ¥çš„å¦ä¸€ä¸ªç¤ºä¾‹æ˜¯ psycopg2 ï¼Œå®ƒä¸º Windows æä¾›äº†å¹¿æ³›çš„ wheelsï¼Œä½†ä¸ä¸º Linux æˆ– macOS å®¢æˆ·ç«¯æä¾›ä»»ä½• wheelsã€‚è¿™æ„å‘³ç€ pip install psycopg2 å¯ä»¥æ ¹æ®æ‚¨çš„ç‰¹å®šè®¾ç½®è·å– Wheels æˆ–æºä»£ç åˆ†å‘ã€‚\nä¸ºäº†é¿å…è¿™äº›ç±»å‹çš„å…¼å®¹æ€§é—®é¢˜ï¼Œä¸€äº›åŒ…æä¾›äº†å¤šä¸ª wheelsï¼Œæ¯ä¸ª wheels éƒ½é’ˆå¯¹ç‰¹å®šçš„ Python å®ç°å’Œåº•å±‚æ“ä½œç³»ç»Ÿã€‚\nåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ‚¨å·²ç»çœ‹åˆ°äº† wheel å’Œ sdist ä¹‹é—´çš„ä¸€äº›æ˜æ˜¾åŒºåˆ«ï¼Œä½†æ›´é‡è¦çš„æ˜¯è¿™äº›å·®å¼‚å¯¹å®‰è£…è¿‡ç¨‹çš„å½±å“ã€‚\nWheels è®©äº‹æƒ…å˜å¾—å¿«é€Ÿ åœ¨ä¸Šé¢ï¼Œæ‚¨çœ‹åˆ°äº†è·å–é¢„åˆ¶ wheels çš„å®‰è£…ä¸ä¸‹è½½ sdist çš„å®‰è£…çš„æ¯”è¾ƒã€‚ Wheels ä½¿ Python åŒ…çš„ç«¯åˆ°ç«¯å®‰è£…æ›´å¿«ï¼ŒåŸå› æœ‰äºŒï¼š\nåœ¨å…¶ä»–æ¡ä»¶ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œwheels çš„å°ºå¯¸é€šå¸¸æ¯”æºåˆ†å‘å°ï¼Œè¿™æ„å‘³ç€å®ƒä»¬å¯ä»¥åœ¨ç½‘ç»œä¸­æ›´å¿«åœ°ç§»åŠ¨ã€‚ ç›´æ¥ä» wheels å®‰è£…é¿å…äº†ä»æºåˆ†å‘æ„å»ºåŒ…çš„ä¸­é—´æ­¥éª¤ã€‚ å‡ ä¹å¯ä»¥ä¿è¯ chardet å®‰è£…åªç”¨äº† uWSGI æ‰€éœ€æ—¶é—´çš„ä¸€å°éƒ¨åˆ†ã€‚ç„¶è€Œï¼Œè¿™å¯ä»¥è¯´æ˜¯ä¸€ä¸ªä¸å…¬å¹³çš„è‹¹æœä¸æ©˜å­çš„æ¯”è¾ƒï¼Œå› ä¸º chardet æ˜¯ä¸€ä¸ªå°å¾—å¤šä¸”ä¸é‚£ä¹ˆå¤æ‚çš„åŒ…ã€‚\nä½¿ç”¨ä¸åŒçš„å‘½ä»¤ï¼Œæ‚¨å¯ä»¥åˆ›å»ºæ›´ç›´æ¥çš„æ¯”è¾ƒï¼Œä»¥è¯æ˜ wheels çš„å·®å¼‚æœ‰å¤šå¤§ã€‚\næ‚¨å¯ä»¥é€šè¿‡ä¼ é€’ --no-binary é€‰é¡¹è®© pip å¿½ç•¥å®ƒå¯¹ wheels çš„å€¾æ–œï¼š\n$ time python -m pip install \\ --no-cache-dir \\ --force-reinstall \\ --no-binary=:all: \\ cryptography æ­¤å‘½ä»¤è®¡æ—¶ cryptography åŒ…çš„å®‰è£…ï¼Œå‘Šè¯‰ pip ä½¿ç”¨æºä»£ç åˆ†å‘ï¼Œå³ä½¿æœ‰åˆé€‚çš„ Wheels å¯ç”¨ã€‚åŒ…å« :all: ä¼šä½¿è§„åˆ™é€‚ç”¨äº cryptography åŠå…¶æ‰€æœ‰ä¾èµ–é¡¹ã€‚\nåœ¨æˆ‘çš„æœºå™¨ä¸Šï¼Œè¿™ä»å¼€å§‹åˆ°ç»“æŸå¤§çº¦éœ€è¦ 32 ç§’ã€‚ä¸ä»…å®‰è£…éœ€è¦å¾ˆé•¿æ—¶é—´ï¼Œè€Œä¸”æ„å»º cryptography è¿˜éœ€è¦æ‚¨æ‹¥æœ‰ OpenSSL å¼€å‘æ ‡å¤´å¹¶å¯ä¾› Python ä½¿ç”¨ã€‚\næ³¨æ„ï¼šå¯¹äº --no-binary ï¼Œæ‚¨å¾ˆå¯èƒ½ä¼šçœ‹åˆ°æœ‰å…³ç¼ºå°‘ cryptography å®‰è£…æ‰€éœ€çš„å¤´æ–‡ä»¶çš„é”™è¯¯ï¼Œè¿™æ˜¯ä½¿ç”¨æºä»£ç åˆ†å‘ä»¤äººæ²®ä¸§çš„éƒ¨åˆ†åŸå› ã€‚å¦‚æœæ˜¯è¿™æ ·ï¼Œ cryptography æ–‡æ¡£çš„å®‰è£…éƒ¨åˆ†ä¼šå°±ç‰¹å®šæ“ä½œç³»ç»Ÿéœ€è¦å“ªäº›åº“å’Œå¤´æ–‡ä»¶æä¾›å»ºè®®ã€‚\nç°åœ¨æ‚¨å¯ä»¥é‡æ–°å®‰è£… cryptography ï¼Œä½†è¿™æ¬¡è¦ç¡®ä¿ pip ä½¿ç”¨ PyPI çš„ Wheels ã€‚å› ä¸º pip æ›´å–œæ¬¢ Wheels ï¼Œè¿™ç±»ä¼¼äºä¸å¸¦ä»»ä½•å‚æ•°è°ƒç”¨ pip install ã€‚ä½†åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥é€šè¿‡è¦æ±‚å¸¦æœ‰ --only-binary çš„ Wheels æ¥æ˜ç¡®æ„å›¾ï¼š\n$ time python -m pip install \\ --no-cache-dir \\ --force-reinstall \\ --only-binary=cryptography \\ cryptography æ­¤é€‰é¡¹åªéœ€è¦å››ç§’å¤šä¸€ç‚¹ï¼Œæˆ–è€…æ˜¯ä»…ä½¿ç”¨ cryptography åŠå…¶ä¾èµ–é¡¹çš„æºä»£ç åˆ†å‘æ—¶æ‰€ç”¨æ—¶é—´çš„å…«åˆ†ä¹‹ä¸€ã€‚\nä»€ä¹ˆæ˜¯ Python Wheelï¼Ÿ Python .whl æ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª ZIP ( .zip ) å­˜æ¡£ï¼Œå¸¦æœ‰ç‰¹åˆ¶çš„æ–‡ä»¶åï¼Œå‘Šè¯‰å®‰è£…è€… Wheels å°†æ”¯æŒå“ªäº› Python ç‰ˆæœ¬å’Œå¹³å°ã€‚\nWheels æ˜¯ä¸€ç§å†…ç½®åˆ†å‘ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œbuilt æ„å‘³ç€ wheel ä»¥å¯ç«‹å³å®‰è£…çš„æ ¼å¼å‡ºç°ï¼Œå¹¶å…è®¸æ‚¨è·³è¿‡æºä»£ç åˆ†å‘æ‰€éœ€çš„æ„å»ºé˜¶æ®µã€‚\næ³¨æ„ï¼šå€¼å¾—ä¸€æçš„æ˜¯ï¼Œå°½ç®¡ä½¿ç”¨äº†æœ¯è¯­æ„å»ºï¼Œä½† Wheels ä¸åŒ…å« .pyc æ–‡ä»¶æˆ–ç¼–è¯‘çš„ Python å­—èŠ‚ç ã€‚\nwheel æ–‡ä»¶åè¢«åˆ†æˆç”±è¿å­—ç¬¦åˆ†éš”çš„éƒ¨åˆ†ï¼š\n{dist}-{version}(-{build})?-{python}-{abi}-{platform}.whl {brackets} ä¸­çš„æ¯ä¸ªéƒ¨åˆ†éƒ½æ˜¯ä¸€ä¸ªæ ‡ç­¾ï¼Œæˆ–è€…æ˜¯ wheel åç§°çš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†ï¼Œå®ƒå¸¦æœ‰ä¸€äº›å…³äº wheel åŒ…å«çš„å†…å®¹ä»¥åŠ wheel å°†åœ¨ä½•å¤„å·¥ä½œæˆ–ä¸å·¥ä½œçš„å«ä¹‰ã€‚\nè¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ cryptography Wheels çš„è¯´æ˜æ€§ç¤ºä¾‹ï¼š\ncryptography-2.9.2-cp35-abi3-macosx_10_9_x86_64.whl cryptography åˆ†é…å¤šä¸ª Wheels ã€‚æ¯ä¸ª Wheels éƒ½æ˜¯ä¸€ä¸ªå¹³å° Wheels ï¼Œè¿™æ„å‘³ç€å®ƒä»…æ”¯æŒ Python ç‰ˆæœ¬ã€Python ABIã€æ“ä½œç³»ç»Ÿå’Œæœºå™¨æ¶æ„çš„ç‰¹å®šç»„åˆã€‚æ‚¨å¯ä»¥å°†å‘½åçº¦å®šåˆ†è§£ä¸ºå¤šä¸ªéƒ¨åˆ†ï¼š\ncryptography æ˜¯åŒ…åã€‚ 2.9.2 æ˜¯ cryptography çš„åŒ…ç‰ˆæœ¬ã€‚ç‰ˆæœ¬æ˜¯ç¬¦åˆ PEP 440 çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ 2.9.2 ã€ 3.4 æˆ– 3.9.0.a3 ã€‚ cp35 æ˜¯ Python æ ‡ç­¾ï¼Œè¡¨ç¤º Wheels éœ€è¦çš„ Python å®ç°å’Œç‰ˆæœ¬ã€‚ cp ä»£è¡¨ CPythonï¼ŒPython çš„å‚è€ƒå®ç°ï¼Œè€Œ 35 ä»£è¡¨ Python 3.5ã€‚ä¾‹å¦‚ï¼Œè¿™ä¸ª Wheels ä¸ Jython ä¸å…¼å®¹ã€‚ abi3 æ˜¯ ABI æ ‡ç­¾ã€‚ ABI ä»£è¡¨åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£ã€‚ä½ çœŸçš„ä¸éœ€è¦æ‹…å¿ƒå®ƒéœ€è¦ä»€ä¹ˆï¼Œä½†æ˜¯ abi3 æ˜¯ä¸€ä¸ªå•ç‹¬çš„ç‰ˆæœ¬ï¼Œç”¨äº Python C API çš„äºŒè¿›åˆ¶å…¼å®¹æ€§ã€‚ macosx_10_9_x86_64 æ˜¯å¹³å°æ ‡ç­¾ï¼Œæ­£å¥½æ¯”è¾ƒå•°å—¦ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒå¯ä»¥è¿›ä¸€æ­¥ç»†åˆ†ä¸ºå­éƒ¨åˆ†ï¼š macosx æ˜¯ macOS æ“ä½œç³»ç»Ÿã€‚ 10_9 æ˜¯ç”¨äºç¼–è¯‘ Python çš„ macOS å¼€å‘äººå‘˜å·¥å…· SDK ç‰ˆæœ¬ï¼Œè€Œ Python åˆæ„å»ºäº†è¿™ä¸ª Wheels ã€‚ x86_64 æ˜¯å¯¹ x86-64 æŒ‡ä»¤é›†æ¶æ„çš„å¼•ç”¨ã€‚ æœ€åä¸€ä¸ªç»„ä»¶åœ¨æŠ€æœ¯ä¸Šä¸æ˜¯æ ‡ç­¾ï¼Œè€Œæ˜¯æ ‡å‡†çš„ .whl æ–‡ä»¶æ‰©å±•åã€‚ç»„åˆèµ·æ¥ï¼Œä¸Šè¿°ç»„ä»¶è¡¨æ˜æ­¤ cryptography Wheels è®¾è®¡çš„ç›®æ ‡æœºå™¨ã€‚\nç°åœ¨è®©æˆ‘ä»¬è½¬å‘å¦ä¸€ä¸ªä¾‹å­ã€‚ä»¥ä¸‹æ˜¯æ‚¨åœ¨ä¸Šè¿° chardet æ¡ˆä¾‹ä¸­çœ‹åˆ°çš„å†…å®¹ï¼š\nchardet-3.0.4-py2.py3-none-any.whl æ‚¨å¯ä»¥å°†å…¶åˆ†è§£ä¸ºæ ‡ç­¾ï¼š\nchardet æ˜¯åŒ…åã€‚ 3.0.4 æ˜¯ chardet çš„åŒ…ç‰ˆæœ¬ã€‚ py2.py3 æ˜¯ Python æ ‡ç­¾ï¼Œè¿™æ„å‘³ç€ Wheels æ”¯æŒ Python 2 å’Œ 3 ä»¥åŠä»»ä½• Python å®ç°ã€‚ none æ˜¯ ABI æ ‡ç­¾ï¼Œæ„å‘³ç€ ABI ä¸æ˜¯ä¸€ä¸ªå› ç´ ã€‚ any æ˜¯å¹³å°ã€‚è¿™ä¸ª Wheels å‡ ä¹å¯ä»¥åœ¨ä»»ä½•å¹³å°ä¸Šè¿è¡Œã€‚ Wheels åç§°çš„ py2.py3-none-any.whl æ®µå¾ˆå¸¸è§ã€‚è¿™æ˜¯ä¸€ä¸ªä¸‡èƒ½ Wheels ï¼Œå¯ä»¥åœ¨å…·æœ‰ä»»ä½• ABI çš„ä»»ä½•å¹³å°ä¸Šä¸ Python 2 æˆ– 3 ä¸€èµ·å®‰è£…ã€‚å¦‚æœ Wheels ä»¥ none-any.whl ç»“å°¾ï¼Œé‚£ä¹ˆå®ƒå¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªä¸å…³å¿ƒç‰¹å®š Python ABI æˆ– CPU æ¶æ„çš„çº¯ Python åŒ…ã€‚\nå¦ä¸€ä¸ªä¾‹å­æ˜¯ jinja2 æ¨¡æ¿å¼•æ“ã€‚å¦‚æœæ‚¨å¯¼èˆªåˆ° Jinja 3.x alpha ç‰ˆæœ¬çš„ä¸‹è½½é¡µé¢ï¼Œæ‚¨å°†çœ‹åˆ°ä»¥ä¸‹ Wheels ï¼š\nJinja2-3.0.0a1-py3-none-any.whl æ³¨æ„è¿™é‡Œç¼ºå°‘ py2 ã€‚è¿™æ˜¯ä¸€ä¸ªçº¯ Python é¡¹ç›®ï¼Œå¯ä»¥åœ¨ä»»ä½• Python 3.x ç‰ˆæœ¬ä¸Šè¿è¡Œï¼Œä½†å®ƒä¸æ˜¯ä¸‡èƒ½ Wheels ï¼Œå› ä¸ºå®ƒä¸æ”¯æŒ Python 2ã€‚ç›¸åï¼Œå®ƒè¢«ç§°ä¸ºçº¯ Python Wheels ã€‚\næ³¨æ„ï¼šåœ¨ 2020 å¹´ï¼Œè®¸å¤šé¡¹ç›®ä¹Ÿæ”¾å¼ƒäº†å¯¹ Python 2 çš„æ”¯æŒï¼ŒPython 2 äº 2020 å¹´ 1 æœˆ 1 æ—¥è¾¾åˆ°ç”Ÿå‘½å‘¨æœŸç»“æŸ (EOL)ã€‚Jinja ç‰ˆæœ¬ 3.x äº 2020 å¹´ 2 æœˆæ”¾å¼ƒäº†å¯¹ Python 2 çš„æ”¯æŒã€‚\nä»¥ä¸‹æ˜¯ä¸ºä¸€äº›æµè¡Œçš„å¼€æºåŒ…åˆ†å‘çš„ .whl åç§°çš„æ›´å¤šç¤ºä¾‹ï¼š\nWheel What It Is è¿™æ˜¯ä»€ä¹ˆ PyYAML-5.3.1-cp38-cp38-win_amd64.whl PyYAML for CPython 3.8 on Windows with AMD64 (x86-64) architecture numpy-1.18.4-cp38-cp38-win32.whl NumPy for CPython 3.8 on Windows 32-bit scipy-1.4.1-cp36-cp36m-macosx_10_6_intel.whl SciPy for CPython 3.6 on macOS 10.6 SDK with fat binary (multiple instruction sets) ç°åœ¨æ‚¨å·²ç»å½»åº•äº†è§£ä»€ä¹ˆæ˜¯ Wheels ï¼Œæ˜¯æ—¶å€™è°ˆè°ˆå®ƒä»¬æœ‰ä»€ä¹ˆå¥½å¤„äº†ã€‚\nWheels çš„ä¼˜åŠ¿ è¿™æ˜¯æ¥è‡ª Python Packaging Authority (PyPA) çš„ wheels è¯æ˜ï¼š\nå¹¶éæ‰€æœ‰å¼€å‘äººå‘˜éƒ½æœ‰æ­£ç¡®çš„å·¥å…·æˆ–ç»éªŒæ¥æ„å»ºè¿™äº›ç”¨è¿™äº›ç¼–è¯‘è¯­è¨€ç¼–å†™çš„ç»„ä»¶ï¼Œå› æ­¤ Python åˆ›é€ äº† wheelï¼Œè¿™æ˜¯ä¸€ç§æ—¨åœ¨è¿é€å¸¦æœ‰ç¼–è¯‘å·¥ä»¶çš„åº“çš„åŒ…æ ¼å¼ã€‚äº‹å®ä¸Šï¼ŒPython çš„åŒ…å®‰è£…ç¨‹åº pip æ€»æ˜¯æ›´å–œæ¬¢ wheelï¼Œå› ä¸ºå®‰è£…æ€»æ˜¯æ›´å¿«ï¼Œæ‰€ä»¥å³ä½¿æ˜¯çº¯ Python åŒ…ä¹Ÿèƒ½æ›´å¥½åœ°ä½¿ç”¨ wheelã€‚ ï¼ˆ æ¥æºï¼‰\næ›´å®Œæ•´çš„æè¿°æ˜¯ï¼Œwheels åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ä½¿ Python åŒ…çš„ç”¨æˆ·å’Œç»´æŠ¤è€…éƒ½å—ç›Šï¼š\nå¯¹äºçº¯ Python åŒ…å’Œæ‰©å±•æ¨¡å—ï¼ŒWheels çš„å®‰è£…é€Ÿåº¦æ¯”æºä»£ç åˆ†å‘å¿«ã€‚ Wheels æ¯”æºåˆ†å¸ƒå°ã€‚ä¾‹å¦‚ï¼Œ six Wheels å¤§çº¦æ˜¯ç›¸åº”æºåˆ†å¸ƒå¤§å°çš„ä¸‰åˆ†ä¹‹ä¸€ã€‚å½“æ‚¨è€ƒè™‘åˆ°å•ä¸ªåŒ…çš„ pip install å®é™…ä¸Šå¯èƒ½ä¼šå¼€å§‹ä¸‹è½½ä¾èµ–é¡¹é“¾æ—¶ï¼Œè¿™ç§å·®å¼‚å˜å¾—æ›´åŠ é‡è¦ã€‚ Wheels å°† setup.py æ‰§è¡Œæ’é™¤åœ¨å¤–ã€‚ä»æºåˆ†å‘ç‰ˆå®‰è£…ä¼šè¿è¡Œè¯¥é¡¹ç›®çš„ setup.py ä¸­åŒ…å«çš„ä»»ä½•å†…å®¹ã€‚æ­£å¦‚ PEP 427 æ‰€æŒ‡å‡ºçš„ï¼Œè¿™ç›¸å½“äºä»»æ„ä»£ç æ‰§è¡Œã€‚ Wheels å®Œå…¨é¿å…äº†è¿™ç§æƒ…å†µã€‚ ç¼–è¯‘å™¨ä¸éœ€è¦å®‰è£…åŒ…å«å·²ç¼–è¯‘æ‰©å±•æ¨¡å—çš„ Wheels ã€‚æ‰©å±•æ¨¡å—åŒ…å«åœ¨é’ˆå¯¹ç‰¹å®šå¹³å°å’Œ Python ç‰ˆæœ¬çš„ wheel ä¸­ã€‚ pip è‡ªåŠ¨åœ¨ wheel ä¸­ç”Ÿæˆä¸æ­£ç¡®çš„ Python è§£é‡Šå™¨åŒ¹é…çš„ .pyc æ–‡ä»¶ã€‚ Wheels é€šè¿‡å‡å°‘å®‰è£…è½¯ä»¶åŒ…æ—¶æ¶‰åŠçš„è®¸å¤šå˜é‡æ¥æä¾›ä¸€è‡´æ€§ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨ PyPI ä¸Šé¡¹ç›®çš„ä¸‹è½½æ–‡ä»¶é€‰é¡¹å¡æ¥æŸ¥çœ‹å¯ç”¨çš„ä¸åŒå‘è¡Œç‰ˆã€‚ä¾‹å¦‚ï¼Œpandas åˆ†å‘äº†å„ç§å„æ ·çš„ Wheels ã€‚\nå‘Šè¯‰ pip è¦ä¸‹è½½ä»€ä¹ˆ å¯ä»¥å¯¹ pip è¿›è¡Œç»†ç²’åº¦æ§åˆ¶å¹¶å‘Šè¯‰å®ƒé¦–é€‰æˆ–é¿å…å“ªç§æ ¼å¼ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ --only-binary å’Œ --no-binary é€‰é¡¹æ¥æ‰§è¡Œæ­¤æ“ä½œã€‚æ‚¨åœ¨å‰é¢æœ‰å…³å®‰è£… cryptography åŒ…çš„éƒ¨åˆ†ä¸­çœ‹åˆ°äº†å®ƒä»¬çš„ä½¿ç”¨ï¼Œä½†å€¼å¾—ä»”ç»†ç ”ç©¶ä¸€ä¸‹å®ƒä»¬çš„ä½œç”¨ï¼š\n$ pushd \u0026#34;$(mktemp -d)\u0026#34; $ python -m pip download --only-binary :all: --dest . --no-cache six Collecting six Downloading six-1.14.0-py2.py3-none-any.whl (10 kB) Saved ./six-1.14.0-py2.py3-none-any.whl Successfully downloaded six åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ‚¨æ›´æ”¹ä¸ºä¸€ä¸ªä¸´æ—¶ç›®å½•ä»¥å­˜å‚¨å¸¦æœ‰ pushd \u0026quot;$(mktemp -d)\u0026quot; çš„ä¸‹è½½ã€‚æ‚¨ä½¿ç”¨ pip download è€Œä¸æ˜¯ pip install ä»¥ä¾¿æ‚¨å¯ä»¥æ£€æŸ¥ç”Ÿæˆçš„ Wheels ï¼Œä½†æ‚¨å¯ä»¥å°† download æ›¿æ¢ä¸º install åŒæ—¶ä¿æŒç›¸åŒçš„é€‰é¡¹é›†ã€‚\næ‚¨ä¸‹è½½å¸¦æœ‰å‡ ä¸ªæ ‡å¿—çš„ six æ¨¡å—ï¼š\n--only-binary :all: å‘Šè¯‰ pip é™åˆ¶è‡ªå·±ä½¿ç”¨ Wheels å¹¶å¿½ç•¥æºä»£ç åˆ†å‘ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªé€‰é¡¹ï¼Œ pip åªä¼šæ›´å–œæ¬¢ Wheels ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ä¼šé€€å›åˆ°æºä»£ç åˆ†å‘ã€‚ --dest . å‘Šè¯‰ pip å°† six ä¸‹è½½åˆ°å½“å‰ç›®å½•ã€‚ --no-cache å‘Šè¯‰ pip ä¸è¦æŸ¥çœ‹å…¶æœ¬åœ°ä¸‹è½½ç¼“å­˜ã€‚ä½ ä½¿ç”¨è¿™ä¸ªé€‰é¡¹åªæ˜¯ä¸ºäº†è¯´æ˜ä» PyPI çš„å®æ—¶ä¸‹è½½ï¼Œå› ä¸ºä½ å¯èƒ½åœ¨æŸå¤„æœ‰ä¸€ä¸ª six ç¼“å­˜ã€‚ æˆ‘ä¹‹å‰æåˆ°è¿‡ï¼Œwheel æ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª .zip å­˜æ¡£ã€‚ä½ å¯ä»¥ä»å­—é¢ä¸Šç†è§£è¿™ä¸ªé™ˆè¿°ï¼Œå¹¶è¿™æ ·å¯¹å¾… Wheels ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³æŸ¥çœ‹ä¸€ä¸ª Wheels çš„å†…å®¹ï¼Œä½ å¯ä»¥ä½¿ç”¨ unzip ï¼š\n$ unzip -l six*.whl Archive: six-1.14.0-py2.py3-none-any.whl Length Date Time Name --------- ---------- ----- ---- 34074 01-15-2020 18:10 six.py 1066 01-15-2020 18:10 six-1.14.0.dist-info/LICENSE 1795 01-15-2020 18:10 six-1.14.0.dist-info/METADATA 110 01-15-2020 18:10 six-1.14.0.dist-info/WHEEL 4 01-15-2020 18:10 six-1.14.0.dist-info/top_level.txt 435 01-15-2020 18:10 six-1.14.0.dist-info/RECORD --------- ------- 37484 6 files six æ˜¯ä¸€ä¸ªç‰¹ä¾‹ï¼šå®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªå•ç‹¬çš„ Python æ¨¡å—ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„åŒ…ã€‚ Wheel æ–‡ä»¶ä¹Ÿå¯ä»¥å¤æ‚å¾—å¤šï¼Œç¨åæ‚¨å°†çœ‹åˆ°ã€‚\nä¸ --only-binary ç›¸åï¼Œä½ å¯ä»¥ä½¿ç”¨ --no-binary æ¥åšç›¸åçš„äº‹æƒ…ï¼š\n$ python -m pip download --no-binary :all: --dest . --no-cache six Collecting six Downloading six-1.14.0.tar.gz (33 kB) Saved ./six-1.14.0.tar.gz Successfully downloaded six $ popd æ­¤ç¤ºä¾‹ä¸­çš„å”¯ä¸€æ›´æ”¹æ˜¯åˆ‡æ¢åˆ° --no-binary :all: ã€‚è¿™å‘Šè¯‰ pip å¿½ç•¥ Wheels ï¼Œå³ä½¿å®ƒä»¬å¯ç”¨ï¼Œè€Œæ˜¯ä¸‹è½½æºåˆ†å‘ã€‚\n--no-binary ä»€ä¹ˆæ—¶å€™æœ‰ç”¨ï¼Ÿä»¥ä¸‹æ˜¯å‡ ä¸ªæ¡ˆä¾‹ï¼š\nå¯¹åº”çš„ Wheels åäº†ã€‚è¿™æ˜¯å¯¹ Wheels çš„è®½åˆºã€‚å®ƒä»¬æ—¨åœ¨å‡å°‘æ•…éšœçš„å‘ç”Ÿï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œ Wheels å¯èƒ½ä¼šé…ç½®é”™è¯¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ºè‡ªå·±ä¸‹è½½å’Œæ„å»ºæºä»£ç åˆ†å‘å¯èƒ½æ˜¯ä¸€ä¸ªå¯è¡Œçš„é€‰æ‹©ã€‚ æ‚¨æƒ³è¦å¯¹é¡¹ç›®åº”ç”¨ä¸€ä¸ªå°çš„æ›´æ”¹æˆ–è¡¥ä¸æ–‡ä»¶ï¼Œç„¶åå®‰è£…å®ƒã€‚è¿™æ˜¯ä»ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ URL å…‹éš†é¡¹ç›®çš„æ›¿ä»£æ–¹æ³•ã€‚ æ‚¨è¿˜å¯ä»¥å°†ä¸Šè¿°æ ‡å¿—ä¸ pip install ä¸€èµ·ä½¿ç”¨ã€‚æ­¤å¤–ï¼Œä¸ :all: ä¸åŒï¼Œ --only-binary è§„åˆ™ä¸ä»…é€‚ç”¨äºæ‚¨æ­£åœ¨å®‰è£…çš„åŒ…ï¼Œè¿˜é€‚ç”¨äºå®ƒçš„æ‰€æœ‰ä¾èµ–é¡¹ï¼Œæ‚¨å¯ä»¥ä¼ é€’ç‰¹å®šåŒ…çš„åˆ—è¡¨ --only-binary å’Œ --no-binary æ¥åº”ç”¨è¯¥è§„åˆ™è§„åˆ™åˆ°ã€‚\nä¸‹é¢æ˜¯å‡ ä¸ªå®‰è£… URL åº“ yarl çš„ä¾‹å­ã€‚å®ƒåŒ…å« Cython ä»£ç å¹¶ä¾èµ–äº multidict ï¼Œå…¶ä¸­åŒ…å«çº¯ C ä»£ç ã€‚æœ‰å‡ ä¸ªé€‰é¡¹å¯ä»¥ä¸¥æ ¼ä½¿ç”¨æˆ–ä¸¥æ ¼å¿½ç•¥ yarl åŠå…¶ä¾èµ–é¡¹çš„ Wheels ï¼š\n$ # Install `yarl` and use only wheels for yarl and all dependencies $ python -m pip install --only-binary :all: yarl $ # Install `yarl` and use wheels only for the `multidict` dependency $ python -m pip install --only-binary multidict yarl $ # Install `yarl` and don\u0026#39;t use wheels for yarl or any dependencies $ python -m pip install --no-binary :all: yarl $ # Install `yarl` and don\u0026#39;t use wheels for the `multidict` dependency $ python -m pip install --no-binary multidict yarl åœ¨æœ¬èŠ‚ä¸­ï¼Œæ‚¨å¤§è‡´äº†è§£äº†å¦‚ä½•å¾®è°ƒ pip install å°†ä½¿ç”¨çš„åˆ†å‘ç±»å‹ã€‚è™½ç„¶å¸¸è§„çš„ pip install åº”è¯¥æ²¡æœ‰ä»»ä½•é€‰é¡¹ï¼Œä½†äº†è§£è¿™äº›ç”¨äºç‰¹æ®Šæƒ…å†µçš„é€‰é¡¹ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚\nWheel manylinux æ ‡ç­¾ Linux æœ‰è®¸å¤šå˜ä½“å’Œé£æ ¼ï¼Œä¾‹å¦‚ Debianã€CentOSã€Fedora å’Œ Pacmanã€‚å…¶ä¸­æ¯ä¸€ä¸ªéƒ½å¯èƒ½åœ¨å…±äº«åº“ï¼ˆä¾‹å¦‚ libncurses ï¼‰å’Œæ ¸å¿ƒ C åº“ï¼ˆä¾‹å¦‚ glibc ï¼‰ä¸­ä½¿ç”¨ç»†å¾®çš„å˜åŒ–ã€‚\nå¦‚æœæ‚¨æ­£åœ¨ç¼–å†™ C/C++ æ‰©å±•ï¼Œé‚£ä¹ˆè¿™å¯èƒ½ä¼šäº§ç”Ÿé—®é¢˜ã€‚ç”¨ C ç¼–å†™å¹¶åœ¨ Ubuntu Linux ä¸Šç¼–è¯‘çš„æºæ–‡ä»¶ä¸èƒ½ä¿è¯åœ¨ CentOS æœºå™¨æˆ– Arch Linux å‘è¡Œç‰ˆä¸Šå¯æ‰§è¡Œã€‚\næ‚¨æ˜¯å¦éœ€è¦ä¸ºæ¯ä¸ª Linux å˜ä½“æ„å»ºä¸€ä¸ªå•ç‹¬çš„ Wheels ï¼Ÿ\nå¹¸è¿çš„æ˜¯ï¼Œç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œè¿™è¦å½’åŠŸäºä¸€ç»„ä¸“é—¨è®¾è®¡çš„æ ‡ç­¾ï¼Œç§°ä¸º manylinux å¹³å°æ ‡ç­¾ç³»åˆ—ã€‚ç›®å‰æœ‰ä»¥ä¸‹ä¸‰ç§å˜ä½“ï¼š\nmanylinux1 æ˜¯ PEP 513 ä¸­æŒ‡å®šçš„åŸå§‹æ ¼å¼ã€‚ manylinux2010 æ˜¯ PEP 571 ä¸­æŒ‡å®šçš„æ›´æ–°ï¼Œå®ƒå‡çº§åˆ° CentOS 6 ä½œä¸º Docker é•œåƒæ‰€åŸºäºçš„åº•å±‚æ“ä½œç³»ç»Ÿã€‚ç†ç”±æ˜¯ CentOS 5.11ï¼Œå³ manylinux1 ä¸­å…è®¸çš„åº“åˆ—è¡¨çš„æ¥æºï¼Œäº 2017 å¹´ 3 æœˆè¾¾åˆ° EOL å¹¶åœæ­¢æ¥æ”¶å®‰å…¨è¡¥ä¸å’Œé”™è¯¯ä¿®å¤ã€‚ manylinux2014 æ˜¯ PEP 599 ä¸­æŒ‡å®šçš„å‡çº§åˆ° CentOS 7 çš„æ›´æ–°ï¼Œå› ä¸º CentOS 6 è®¡åˆ’äº 2020 å¹´ 11 æœˆè¾¾åˆ° EOLã€‚ æ‚¨å¯ä»¥åœ¨ pandas é¡¹ç›®ä¸­æ‰¾åˆ° manylinux åˆ†å¸ƒçš„ç¤ºä¾‹ã€‚ä»¥ä¸‹æ˜¯ PyPI çš„å¯ç”¨ pandas ä¸‹è½½åˆ—è¡¨ä¸­çš„ä¸¤ä¸ªï¼ˆæœ€å¤šçš„ï¼‰ï¼š\npandas-1.0.3-cp37-cp37m-manylinux1_x86_64.whl pandas-1.0.3-cp37-cp37m-manylinux1_i686.whl åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œpandas ä¸ºæ”¯æŒ x86-64 å’Œ i686 æ¶æ„çš„ CPython 3.7 æ„å»ºäº† manylinux1 wheelsã€‚\nmanylinux çš„æ ¸å¿ƒæ˜¯åŸºäºç‰¹å®šç‰ˆæœ¬çš„ CentOS æ“ä½œç³»ç»Ÿæ„å»ºçš„ Docker é•œåƒã€‚å®ƒæ†ç»‘äº†ä¸€ä¸ªç¼–è¯‘å™¨å¥—ä»¶ã€å¤šä¸ªç‰ˆæœ¬çš„ Python å’Œ pip ï¼Œä»¥åŠä¸€ç»„å…è®¸çš„å…±äº«åº“ã€‚\næ³¨æ„ï¼šæœ¯è¯­ allowed è¡¨ç¤ºé»˜è®¤æƒ…å†µä¸‹å‡å®šå­˜åœ¨äºå‡ ä¹æ‰€æœ‰ Linux ç³»ç»Ÿä¸Šçš„ä½çº§åº“ã€‚è¿™ä¸ªæƒ³æ³•æ˜¯ï¼Œä¾èµ–é¡¹åº”è¯¥å­˜åœ¨äºåŸºæœ¬æ“ä½œç³»ç»Ÿä¸Šï¼Œè€Œä¸éœ€è¦é¢å¤–å®‰è£…ã€‚\næˆªè‡³ 2020 å¹´å¹´ä¸­ï¼Œ manylinux1 ä»ç„¶æ˜¯ä¸»è¦çš„ manylinux æ ‡ç­¾ã€‚åŸå› ä¹‹ä¸€å¯èƒ½åªæ˜¯ä¹ æƒ¯ã€‚å¦ä¸€ä¸ªå¯èƒ½æ˜¯å®¢æˆ·ç«¯ï¼ˆç”¨æˆ·ï¼‰ç«¯å¯¹ manylinux2010 åŠæ›´é«˜ç‰ˆæœ¬çš„æ”¯æŒä»…é™äºæ›´æ–°ç‰ˆæœ¬çš„ pip ï¼š\nTag Requirement manylinux1 pip 8.1.0 æˆ–æ›´é«˜ç‰ˆæœ¬ manylinux2010 pip 19.0 æˆ–æ›´é«˜ç‰ˆæœ¬ manylinux2014 pip 19.3 æˆ–æ›´é«˜ç‰ˆæœ¬ æ¢å¥è¯è¯´ï¼Œå¦‚æœæ‚¨æ˜¯æ„å»º manylinux2010 wheels çš„åŒ…å¼€å‘äººå‘˜ï¼Œé‚£ä¹ˆä½¿ç”¨æ‚¨çš„åŒ…çš„äººå°†éœ€è¦ pip 19.0ï¼ˆ2019 å¹´ 1 æœˆå‘å¸ƒï¼‰æˆ–æ›´é«˜ç‰ˆæœ¬æ‰èƒ½è®© pip ä» PyPI æ‰¾åˆ°å¹¶å®‰è£… manylinux2010 wheels .\nå¹¸è¿çš„æ˜¯ï¼Œè™šæ‹Ÿç¯å¢ƒå˜å¾—è¶Šæ¥è¶Šæ™®éï¼Œè¿™æ„å‘³ç€å¼€å‘äººå‘˜å¯ä»¥åœ¨ä¸æ¥è§¦ç³»ç»Ÿ pip çš„æƒ…å†µä¸‹æ›´æ–°è™šæ‹Ÿç¯å¢ƒçš„ pip ã€‚ç„¶è€Œï¼Œæƒ…å†µå¹¶éæ€»æ˜¯å¦‚æ­¤ï¼Œä¸€äº› Linux å‘è¡Œç‰ˆä»ç„¶é™„å¸¦ pip çš„è¿‡æ—¶ç‰ˆæœ¬ã€‚\nè¿™å°±æ˜¯è¯´ï¼Œå¦‚æœæ‚¨è¦åœ¨ Linux ä¸»æœºä¸Šå®‰è£… Python åŒ…ï¼Œé‚£ä¹ˆå¦‚æœåŒ…ç»´æŠ¤è€…ä¸é—ä½™åŠ›åœ°åˆ›å»º manylinux Wheels ï¼Œæ‚¨å°±è®¤ä¸ºè‡ªå·±å¾ˆå¹¸è¿ã€‚è¿™å‡ ä¹å¯ä»¥ä¿è¯æ— è®ºæ‚¨çš„ç‰¹å®š Linux å˜ä½“æˆ–ç‰ˆæœ¬å¦‚ä½•ï¼Œéƒ½å¯ä»¥è½»æ¾å®‰è£…è½¯ä»¶åŒ…ã€‚\nè­¦å‘Šï¼šè¯·æ³¨æ„ PyPI wheels ä¸èƒ½åœ¨ Alpine Linuxï¼ˆæˆ– BusyBoxï¼‰ä¸Šè¿è¡Œã€‚è¿™æ˜¯å› ä¸º Alpine ä½¿ç”¨ musl ä»£æ›¿æ ‡å‡†çš„ glibc ã€‚ musl libc åº“è‡ªç§°æ˜¯â€œä¸€ä¸ªæ–°çš„ libc ï¼ŒåŠ›æ±‚å¿«é€Ÿã€ç®€å•ã€è½»é‡çº§ã€å…è´¹å’Œæ­£ç¡®â€ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¯´åˆ° Wheels ï¼Œ glibc ä¸æ˜¯ã€‚\nå¹³å° Wheels çš„å®‰å…¨æ³¨æ„äº‹é¡¹ ä»ç”¨æˆ·å®‰å…¨çš„è§’åº¦æ¥çœ‹ï¼Œwheels çš„ä¸€ä¸ªå€¼å¾—è€ƒè™‘çš„ç‰¹æ€§æ˜¯ wheels å¯èƒ½ä¼šå—åˆ°ç‰ˆæœ¬è…çƒ‚çš„å½±å“ï¼Œå› ä¸ºå®ƒä»¬æ†ç»‘äº†äºŒè¿›åˆ¶ä¾èµ–é¡¹ï¼Œè€Œä¸æ˜¯å…è®¸ç³»ç»ŸåŒ…ç®¡ç†å™¨æ›´æ–°è¯¥ä¾èµ–é¡¹ã€‚\nä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ª wheel åˆå¹¶äº† libfortran å…±äº«åº“ï¼Œé‚£ä¹ˆå³ä½¿æ‚¨ä½¿ç”¨åŒ…ç®¡ç†å™¨ï¼ˆå¦‚ @ 3#ã€ yum æˆ– brew ã€‚\nå¦‚æœæ‚¨åœ¨å®‰å…¨é˜²èŒƒæªæ–½å¾—åˆ°åŠ å¼ºçš„ç¯å¢ƒä¸­è¿›è¡Œå¼€å‘ï¼Œåˆ™éœ€è¦æ³¨æ„æŸäº›å¹³å° Wheels çš„è¿™ä¸€ç‰¹æ€§ã€‚\nå¬é›†æ‰€æœ‰å¼€å‘äººå‘˜ï¼šæ„å»ºæ‚¨çš„ Wheels æœ¬æ•™ç¨‹çš„æ ‡é¢˜æ˜¯â€œä½ ä¸ºä»€ä¹ˆè¦å…³å¿ƒï¼Ÿâ€ä½œä¸ºä¸€åå¼€å‘äººå‘˜ï¼Œå¦‚æœæ‚¨æ‰“ç®—å‘ç¤¾åŒºåˆ†å‘ Python åŒ…ï¼Œé‚£ä¹ˆæ‚¨åº”è¯¥éå¸¸å…³å¿ƒä¸ºæ‚¨çš„é¡¹ç›®åˆ†å‘ Wheels ï¼Œå› ä¸ºå®ƒä»¬ä½¿æœ€ç»ˆç”¨æˆ·çš„å®‰è£…è¿‡ç¨‹æ›´ç®€æ´ã€æ›´ç®€å•ã€‚\næ‚¨å¯ä»¥ä½¿ç”¨å…¼å®¹çš„ Wheels æ”¯æŒçš„ç›®æ ‡å¹³å°è¶Šå¤šï¼Œæ‚¨çœ‹åˆ°çš„æ ‡é¢˜ä¸ºâ€œå®‰è£…åœ¨ XYZ å¹³å°ä¸ŠæŸåâ€ä¹‹ç±»çš„ GitHub é—®é¢˜å°±è¶Šå°‘ã€‚ä¸ºæ‚¨çš„ Python åŒ…åˆ†å‘ wheel å®¢è§‚ä¸Šé™ä½äº†åŒ…çš„ç”¨æˆ·åœ¨å®‰è£…è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜çš„å¯èƒ½æ€§ã€‚\nè¦åœ¨æœ¬åœ°æ„å»º Wheels ï¼Œæ‚¨éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯å®‰è£… wheel ã€‚ç¡®ä¿ setuptools ä¹Ÿæ˜¯æœ€æ–°çš„ä¹Ÿæ²¡ä»€ä¹ˆåå¤„ï¼š\n$ python -m pip install -U wheel setuptools æ¥ä¸‹æ¥çš„å‡ èŠ‚å°†å¼•å¯¼æ‚¨å®Œæˆä¸ºå„ç§ä¸åŒåœºæ™¯æ„å»º Wheels çš„è¿‡ç¨‹ã€‚\nä¸åŒç±»å‹çš„ Wheels æ­£å¦‚æœ¬æ•™ç¨‹ä¸­æåˆ°çš„ï¼Œ Wheels æœ‰å‡ ç§ä¸åŒçš„å˜ä½“ï¼Œ Wheels çš„ç±»å‹åæ˜ åœ¨å®ƒçš„æ–‡ä»¶åä¸­ï¼š\nä¸‡å‘ Wheels åŒ…å« py2.py3-none-any.whl ã€‚å®ƒåœ¨ä»»ä½•æ“ä½œç³»ç»Ÿå’Œå¹³å°ä¸Šéƒ½æ”¯æŒ Python 2 å’Œ Python 3ã€‚ Python Wheels ç½‘ç«™ä¸Šåˆ—å‡ºçš„å¤§å¤šæ•° Wheels éƒ½æ˜¯é€šç”¨ Wheels ã€‚ çº¯ Python Wheels åŒ…å« py3-none-any.whl æˆ– py2.none-any.whl ã€‚å®ƒæ”¯æŒ Python 3 æˆ– Python 2ï¼Œä½†ä¸æ”¯æŒä¸¤è€…ã€‚å®ƒåœ¨å…¶ä»–æ–¹é¢ä¸ä¸‡å‘ Wheels ç›¸åŒï¼Œä½†å®ƒä¼šæ ‡æœ‰ py2 æˆ– py3 è€Œä¸æ˜¯ py2.py3 æ ‡ç­¾ã€‚ å¹³å° Wheels æ”¯æŒç‰¹å®šçš„ Python ç‰ˆæœ¬å’Œå¹³å°ã€‚å®ƒåŒ…å«æŒ‡ç¤ºç‰¹å®š Python ç‰ˆæœ¬ã€ABIã€æ“ä½œç³»ç»Ÿæˆ–ä½“ç³»ç»“æ„çš„æ®µã€‚ wheel ç±»å‹ä¹‹é—´çš„å·®å¼‚å–å†³äºå®ƒä»¬æ”¯æŒçš„ Python ç‰ˆæœ¬ä»¥åŠå®ƒä»¬æ˜¯å¦é’ˆå¯¹ç‰¹å®šå¹³å°ã€‚ä»¥ä¸‹æ˜¯ Wheels å˜ä½“ä¹‹é—´å·®å¼‚çš„ç®€è¦æ€»ç»“ï¼š\nWheel Type æ”¯æŒ Python 2 å’Œ 3 æ”¯æŒæ¯ä¸ª ABIã€æ“ä½œç³»ç»Ÿå’Œå¹³å° Universal âœ“ âœ“ Pure-Python âœ“ Platform æ­£å¦‚æ‚¨æ¥ä¸‹æ¥å°†çœ‹åˆ°çš„ï¼Œæ‚¨å¯ä»¥é€šè¿‡ç›¸å¯¹è¾ƒå°‘çš„è®¾ç½®æ„å»ºé€šç”¨ Wheels å’Œçº¯ Python Wheels ï¼Œä½†å¹³å° Wheels å¯èƒ½éœ€è¦ä¸€äº›é¢å¤–çš„æ­¥éª¤ã€‚\næ„å»ºä¸€ä¸ªçº¯ Python Wheels æ‚¨å¯ä»¥ä½¿ç”¨ setuptools ä¸ºä»»ä½•é¡¹ç›®æ„å»ºçº¯ Python Wheels æˆ–é€šç”¨ Wheels ï¼Œåªéœ€ä¸€ä¸ªå‘½ä»¤ï¼š\n$ python setup.py sdist bdist_wheel è¿™å°†åˆ›å»ºä¸€ä¸ªæºä»£ç åˆ†å‘ ( sdist ) å’Œä¸€ä¸ª Wheels ( bdist_wheel )ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸¤è€…éƒ½ä¼šæ”¾åœ¨å½“å‰ç›®å½•ä¸‹çš„ dist/ ä¸­ã€‚è¦äº²çœ¼çœ‹çœ‹ï¼Œæ‚¨å¯ä»¥ä¸º HTTPie æ„å»ºä¸€ä¸ª Wheels ï¼Œä¸€ä¸ªç”¨ Python ç¼–å†™çš„å‘½ä»¤è¡Œ HTTP å®¢æˆ·ç«¯ï¼Œä»¥åŠä¸€ä¸ª sdist ã€‚\nä¸‹é¢æ˜¯ä¸º HTTPie åŒ…æ„å»ºä¸¤ç§ç±»å‹çš„å‘è¡Œç‰ˆçš„ç»“æœï¼š\n$ git clone -q git@github.com:jakubroztocil/httpie.git $ cd httpie $ python setup.py -q sdist bdist_wheel $ ls -1 dist/ httpie-2.2.0.dev0-py3-none-any.whl httpie-2.2.0.dev0.tar.gz ä»…æ­¤è€Œå·²ã€‚æ‚¨å…‹éš†è¯¥é¡¹ç›®ï¼Œç§»è‡³å…¶æ ¹ç›®å½•ï¼Œç„¶åè°ƒç”¨ python setup.py sdist bdist_wheel ã€‚æ‚¨å¯ä»¥çœ‹åˆ° dist/ åŒ…å«ä¸€ä¸ª Wheels å’Œä¸€ä¸ªæºä»£ç åˆ†å‘ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œç”Ÿæˆçš„åˆ†å¸ƒæ”¾åœ¨ dist/ ä¸­ï¼Œä½†æ‚¨å¯ä»¥ä½¿ç”¨ -d / --dist-dir é€‰é¡¹æ›´æ”¹å®ƒã€‚æ‚¨å¯ä»¥å°†å®ƒä»¬æ”¾åœ¨ä¸€ä¸ªä¸´æ—¶ç›®å½•ä¸­ï¼Œè€Œä¸æ˜¯ç”¨äºæ„å»ºéš”ç¦»ï¼š\n$ tempdir=\u0026#34;$(mktemp -d)\u0026#34; # Create a temporary directory $ file \u0026#34;$tempdir\u0026#34; /var/folders/jc/8_kd8uusys7ak09_lpmn30rw0000gk/T/tmp.GIXy7XKV: directory $ python setup.py sdist -d \u0026#34;$tempdir\u0026#34; $ python setup.py bdist_wheel --dist-dir \u0026#34;$tempdir\u0026#34; $ ls -1 \u0026#34;$tempdir\u0026#34; httpie-2.2.0.dev0-py3-none-any.whl httpie-2.2.0.dev0.tar.gz æ‚¨å¯ä»¥å°† sdist å’Œ bdist_wheel æ­¥éª¤åˆäºŒä¸ºä¸€ï¼Œå› ä¸º setup.py å¯ä»¥é‡‡ç”¨å¤šä¸ªå­å‘½ä»¤ï¼š\n$ python setup.py sdist -d \u0026#34;$tempdir\u0026#34; bdist_wheel -d \u0026#34;$tempdir\u0026#34; å¦‚æ­¤å¤„æ‰€ç¤ºï¼Œæ‚¨éœ€è¦å°† -d ç­‰é€‰é¡¹ä¼ é€’ç»™æ¯ä¸ªå­å‘½ä»¤ã€‚\næŒ‡å®šé€šç”¨ Wheel é€šç”¨ Wheels æ˜¯ç”¨äºåŒæ—¶æ”¯æŒ Python 2 å’Œ 3 çš„çº¯ Python é¡¹ç›®çš„ Wheels ã€‚æœ‰å¤šç§æ–¹æ³•å¯ä»¥å‘Šè¯‰ setuptools å’Œ distutils Wheels åº”è¯¥æ˜¯é€šç”¨çš„ã€‚\né€‰é¡¹ 1 æ˜¯åœ¨é¡¹ç›®çš„ setup.cfg æ–‡ä»¶ä¸­æŒ‡å®šé€‰é¡¹ï¼š\n[bdist_wheel] universal = 1 é€‰é¡¹ 2 æ˜¯åœ¨å‘½ä»¤è¡Œä¼ é€’æ°å½“å‘½åçš„ --universal æ ‡å¿—ï¼š\n$ python setup.py bdist_wheel --universal é€‰é¡¹ 3 æ˜¯ä½¿ç”¨å…¶ options å‚æ•°å‘Šè¯‰ setup() æœ¬èº«æœ‰å…³è¯¥æ ‡å¿—çš„ä¿¡æ¯ï¼š\n# setup.py from setuptools import setup setup( # .... options={\u0026#34;bdist_wheel\u0026#34;: {\u0026#34;universal\u0026#34;: True}} # .... ) è™½ç„¶è¿™ä¸‰ä¸ªé€‰é¡¹ä¸­çš„ä»»ä½•ä¸€ä¸ªéƒ½åº”è¯¥æœ‰æ•ˆï¼Œä½†å‰ä¸¤ä¸ªé€‰é¡¹æœ€å¸¸ç”¨ã€‚æ‚¨å¯ä»¥åœ¨ chardet è®¾ç½®é…ç½®ä¸­çœ‹åˆ°è¿™æ ·çš„ç¤ºä¾‹ã€‚ä¹‹åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ bdist_wheel å‘½ä»¤ï¼Œå¦‚å‰æ‰€ç¤ºï¼š\n$ python setup.py sdist bdist_wheel æ— è®ºæ‚¨é€‰æ‹©å“ªä¸ªé€‰é¡¹ï¼Œç”Ÿæˆçš„ Wheels éƒ½æ˜¯ç­‰æ•ˆçš„ã€‚é€‰æ‹©åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºå¼€å‘äººå‘˜çš„åå¥½ä»¥åŠæœ€é€‚åˆæ‚¨çš„å·¥ä½œæµç¨‹ã€‚\næ„å»ºå¹³å° Wheels ï¼ˆmacOS å’Œ Windowsï¼‰ äºŒè¿›åˆ¶å‘è¡Œç‰ˆæ˜¯åŒ…å«å·²ç¼–è¯‘æ‰©å±•çš„æ„å»ºå‘è¡Œç‰ˆçš„å­é›†ã€‚æ‰©å±•æ˜¯é Python ä¾èµ–é¡¹æˆ– Python åŒ…çš„ç»„ä»¶ã€‚\né€šå¸¸ï¼Œè¿™æ„å‘³ç€æ‚¨çš„åŒ…åŒ…å«æ‰©å±•æ¨¡å—æˆ–ä¾èµ–äºç”¨é™æ€ç±»å‹è¯­è¨€ï¼ˆä¾‹å¦‚ Cã€C++ã€Fortranï¼Œç”šè‡³ Rust æˆ– Goï¼‰ç¼–å†™çš„åº“ã€‚å¹³å° Wheels çš„å­˜åœ¨ä¸»è¦æ˜¯å› ä¸ºå®ƒä»¬åŒ…å«æˆ–ä¾èµ–äºæ‰©å±•æ¨¡å—ã€‚\nç»¼ä¸Šæ‰€è¿°ï¼Œæ˜¯æ—¶å€™æ„å»ºå¹³å° Wheels äº†ï¼\næ ¹æ®æ‚¨ç°æœ‰çš„å¼€å‘ç¯å¢ƒï¼Œæ‚¨å¯èƒ½éœ€è¦å®Œæˆä¸€ä¸ªæˆ–ä¸¤ä¸ªé¢å¤–çš„å…ˆå†³æ¡ä»¶æ­¥éª¤æ¥æ„å»ºå¹³å° Wheels ã€‚ä¸‹é¢çš„æ­¥éª¤å°†å¸®åŠ©æ‚¨è®¾ç½®æ„å»º C å’Œ C++ æ‰©å±•æ¨¡å—ï¼Œè¿™æ˜¯è¿„ä»Šä¸ºæ­¢æœ€å¸¸è§çš„ç±»å‹ã€‚\nåœ¨ macOS ä¸Šï¼Œæ‚¨éœ€è¦é€šè¿‡ xcode è·å¾—çš„å‘½ä»¤è¡Œå¼€å‘äººå‘˜å·¥å…·ï¼š\n$ xcode-select --install åœ¨ Windows ä¸Šï¼Œæ‚¨éœ€è¦å®‰è£… Microsoft Visual C++ï¼š\nåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ Visual Studio ä¸‹è½½é¡µé¢ã€‚ é€‰æ‹© Visual Studio å·¥å…· â†’ Visual Studio æ„å»ºå·¥å…· â†’ ä¸‹è½½ã€‚ è¿è¡Œç”Ÿæˆçš„ .exe å®‰è£…ç¨‹åºã€‚ åœ¨å®‰è£…ç¨‹åºä¸­ï¼Œé€‰æ‹© C++ Build Tools â†’ Installã€‚ é‡æ–°å¯åŠ¨æœºå™¨ã€‚ åœ¨ Linux ä¸Šï¼Œæ‚¨éœ€è¦ä¸€ä¸ªç¼–è¯‘å™¨ï¼Œä¾‹å¦‚ gcc æˆ– g++ / c++ ã€‚\næœ‰äº†è¿™äº›ï¼Œæ‚¨å°±å¯ä»¥ä¸º UltraJSON ( ujson ) æ„å»ºä¸€ä¸ªå¹³å° Wheels ï¼ŒUltraJSON æ˜¯ä¸€ä¸ªç”¨çº¯ C è¯­è¨€ç¼–å†™å¹¶å¸¦æœ‰ Python 3 ç»‘å®šçš„ JSON ç¼–ç å™¨å’Œè§£ç å™¨ã€‚ä½¿ç”¨ ujson æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç©å…·ç¤ºä¾‹ï¼Œå› ä¸ºå®ƒæ¶µç›–äº†å‡ ä¸ªåŸºç¡€ï¼š\nå®ƒåŒ…å«ä¸€ä¸ªæ‰©å±•æ¨¡å—ï¼Œ ujson ã€‚ å®ƒä¾èµ–äº Python å¼€å‘æ ‡å¤´è¿›è¡Œç¼–è¯‘ ( #include \u0026lt;Python.h\u0026gt; )ï¼Œä½†å¹¶ä¸è¿‡åˆ†å¤æ‚ã€‚ ujson æ—¨åœ¨åšä¸€ä»¶äº‹å¹¶ä¸”åšå¥½ï¼Œå°±æ˜¯è¯»å†™ JSONï¼ æ‚¨å¯ä»¥ä» GitHub å…‹éš†è¯¥é¡¹ç›®ï¼Œå¯¼èˆªåˆ°å…¶ç›®å½•å¹¶æ„å»ºå®ƒï¼š\n$ git clone -q --branch 2.0.3 git@github.com:ultrajson/ultrajson.git $ cd ultrajson $ python setup.py bdist_wheel æ‚¨åº”è¯¥ä¼šçœ‹åˆ°å¤§é‡è¾“å‡ºã€‚è¿™æ˜¯ macOS ä¸Šçš„ç²¾ç®€ç‰ˆï¼Œå…¶ä¸­ä½¿ç”¨äº† Clang ç¼–è¯‘å™¨é©±åŠ¨ç¨‹åºï¼š\nclang -Wno-unused-result -Wsign-compare -Wunreachable-code -DNDEBUG -g ... ... creating \u0026#39;dist/ujson-2.0.3-cp38-cp38-macosx_10_15_x86_64.whl\u0026#39; adding \u0026#39;ujson.cpython-38-darwin.so\u0026#39; ä»¥ clang å¼€å¤´çš„è¡Œæ˜¾ç¤ºäº†å¯¹ç¼–è¯‘å™¨çš„å®é™…è°ƒç”¨ï¼Œå…¶ä¸­åŒ…å«å¤§é‡ç¼–è¯‘æ ‡å¿—ã€‚æ‚¨å¯èƒ½è¿˜ä¼šçœ‹åˆ°è¯¸å¦‚ MSVC (Windows) æˆ– gcc (Linux) ä¹‹ç±»çš„å·¥å…·ï¼Œå…·ä½“å–å†³äºæ“ä½œç³»ç»Ÿã€‚\nå¦‚æœåœ¨æ‰§è¡Œä¸Šè¿°ä»£ç åé‡åˆ° fatal error ï¼Œè¯·ä¸è¦æ‹…å¿ƒã€‚æ‚¨å¯ä»¥å±•å¼€ä¸‹é¢çš„æ¡†ä»¥äº†è§£å¦‚ä½•å¤„ç†æ­¤é—®é¢˜ã€‚\nsetup.py bdist_wheel å¯¹ ujson çš„è°ƒç”¨éœ€è¦ Python å¼€å‘å¤´æ–‡ä»¶ï¼Œå› ä¸º ujson.c å¼•å…¥äº† \u0026lt;Python.h\u0026gt; ã€‚å¦‚æœæ‚¨æ²¡æœ‰å°†å®ƒä»¬æ”¾åœ¨å¯æœç´¢çš„ä½ç½®ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½ä¼šçœ‹åˆ°å¦‚ä¸‹é”™è¯¯ï¼š\nfatal error: \u0026#39;Python.h\u0026#39; file not found #include \u0026lt;Python.h\u0026gt; è¦ç¼–è¯‘æ‰©å±•æ¨¡å—ï¼Œæ‚¨éœ€è¦å°†å¼€å‘æ ‡å¤´ä¿å­˜åœ¨ç¼–è¯‘å™¨å¯ä»¥æ‰¾åˆ°çš„åœ°æ–¹ã€‚\nå¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯æœ€æ–°ç‰ˆæœ¬çš„ Python 3 å’Œè™šæ‹Ÿç¯å¢ƒå·¥å…·ï¼ˆå¦‚ venv ï¼‰ï¼Œåˆ™ Python å¼€å‘æ ‡å¤´å¯èƒ½ä¼šé»˜è®¤åŒ…å«åœ¨ç¼–è¯‘å’Œé“¾æ¥ä¸­ã€‚\nå¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½ä¼šçœ‹åˆ°ä¸€ä¸ªé”™è¯¯ï¼Œè¡¨æ˜æ‰¾ä¸åˆ°å¤´æ–‡ä»¶ï¼š\nfatal error: \u0026#39;Python.h\u0026#39; file not found #include \u0026lt;Python.h\u0026gt; åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥é€šè¿‡è®¾ç½® CFLAGS æ¥å‘Šè¯‰ setup.py è¿˜å¯ä»¥åœ¨å“ªé‡ŒæŸ¥æ‰¾å¤´æ–‡ä»¶ã€‚è¦æŸ¥æ‰¾å¤´æ–‡ä»¶æœ¬èº«ï¼Œå¯ä»¥ä½¿ç”¨ python3-config ï¼š\n$ python3-config --include -I/Users/\u0026lt;username\u0026gt;/.pyenv/versions/3.8.2/include/python3.8 è¿™å‘Šè¯‰æ‚¨ Python å¼€å‘æ ‡å¤´ä½äºæ˜¾ç¤ºçš„ç›®å½•ä¸­ï¼Œæ‚¨ç°åœ¨å¯ä»¥å°†å…¶ä¸ python setup.py bdist_wheel ä¸€èµ·ä½¿ç”¨ï¼š\n$ CFLAGS=\u0026#34;$(python3-config --include)\u0026#34; python setup.py bdist_wheel æ›´ä¸€èˆ¬åœ°è¯´ï¼Œæ‚¨å¯ä»¥ä¼ é€’æ‚¨éœ€è¦çš„ä»»ä½•è·¯å¾„ï¼š\n$ CFLAGS=\u0026#39;-I/path/to/include\u0026#39; python setup.py bdist_wheel åœ¨ Linux ä¸Šï¼Œæ‚¨å¯èƒ½è¿˜éœ€è¦å•ç‹¬å®‰è£…å¤´æ–‡ä»¶ï¼š\n$ apt-get install -y python3-dev # Debian, Ubuntu $ yum install -y python3-devel # CentOS, Fedora, RHEL å¦‚æœä½ æ£€æŸ¥ UltraJSON çš„ setup.py ï¼Œä½ ä¼šçœ‹åˆ°å®ƒè‡ªå®šä¹‰äº†ä¸€äº›ç¼–è¯‘å™¨æ ‡å¿—ï¼Œä¾‹å¦‚ -D_GNU_SOURCE ã€‚é€šè¿‡ setup.py æ§åˆ¶ç¼–è¯‘è¿‡ç¨‹çš„å¤æ‚æ€§è¶…å‡ºäº†æœ¬æ•™ç¨‹çš„èŒƒå›´ï¼Œä½†æ‚¨åº”è¯¥çŸ¥é“å¯ä»¥å¯¹ç¼–è¯‘å’Œé“¾æ¥çš„å‘ç”Ÿæ–¹å¼è¿›è¡Œç»†ç²’åº¦æ§åˆ¶ã€‚\nå¦‚æœæ‚¨æŸ¥çœ‹ dist ï¼Œé‚£ä¹ˆæ‚¨åº”è¯¥ä¼šçœ‹åˆ°åˆ›å»ºçš„ Wheels ï¼š\n$ ls dist/ ujson-2.0.3-cp38-cp38-macosx_10_15_x86_64.whl è¯·æ³¨æ„ï¼Œåç§°å¯èƒ½å› æ‚¨çš„å¹³å°è€Œå¼‚ã€‚ä¾‹å¦‚ï¼Œæ‚¨ä¼šåœ¨ 64 ä½ Windows ä¸Šçœ‹åˆ° win_amd64.whl ã€‚\næ‚¨å¯ä»¥æŸ¥çœ‹ wheel æ–‡ä»¶å¹¶çœ‹åˆ°å®ƒåŒ…å«å·²ç¼–è¯‘çš„æ‰©å±•åï¼š\n$ unzip -l dist/ujson-*.whl ... Length Date Time Name --------- ---------- ----- ---- 105812 05-10-2020 19:47 ujson.cpython-38-darwin.so ... æ­¤ç¤ºä¾‹æ˜¾ç¤º macOS çš„è¾“å‡ºï¼Œ ujson.cpython-38-darwin.so ï¼Œè¿™æ˜¯ä¸€ä¸ªå…±äº«å¯¹è±¡ ( .so ) æ–‡ä»¶ï¼Œä¹Ÿç§°ä¸ºåŠ¨æ€åº“ã€‚\næ„å»º manylinux Wheels ä½œä¸ºè½¯ä»¶åŒ…å¼€å‘äººå‘˜ï¼Œæ‚¨å¾ˆå°‘ä¼šå¸Œæœ›ä¸ºå•ä¸ª Linux å˜ä½“æ„å»º Wheels ã€‚ Linux wheels éœ€è¦ä¸€å¥—ä¸“é—¨çš„çº¦å®šå’Œå·¥å…·ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥è·¨ä¸åŒçš„ Linux ç¯å¢ƒå·¥ä½œã€‚\nä¸ macOS å’Œ Windows çš„ wheel ä¸åŒï¼Œæ„å»ºåœ¨ä¸€ä¸ª Linux å˜ä½“ä¸Šçš„ wheel ä¸èƒ½ä¿è¯åœ¨å¦ä¸€ä¸ª Linux å˜ä½“ä¸Šå·¥ä½œï¼Œå³ä½¿æ˜¯å…·æœ‰ç›¸åŒæœºå™¨æ¶æ„çš„ Linux å˜ä½“ã€‚\näº‹å®ä¸Šï¼Œå¦‚æœæ‚¨åœ¨å¼€ç®±å³ç”¨çš„ Linux å®¹å™¨ä¸Šæ„å»ºä¸€ä¸ª Wheels ï¼Œé‚£ä¹ˆå¦‚æœæ‚¨å°è¯•ä¸Šä¼ å®ƒï¼ŒPyPI ç”šè‡³ä¸ä¼šæ¥å—è¯¥ Wheels ï¼\nå¦‚æœæ‚¨å¸Œæœ›æ‚¨çš„åŒ…åœ¨ä¸€ç³»åˆ— Linux å®¢æˆ·ç«¯ä¸Šå¯ç”¨ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦ä¸€ä¸ª manylinux Wheels ã€‚ manylinux wheel æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„å¹³å° wheelï¼Œè¢«å¤§å¤šæ•° Linux å˜ä½“æ¥å—ã€‚å®ƒå¿…é¡»åœ¨ç‰¹å®šç¯å¢ƒä¸­æ„å»ºï¼Œå¹¶ä¸”éœ€è¦ä¸€ä¸ªåä¸º auditwheel çš„å·¥å…·æ¥é‡å‘½å wheel æ–‡ä»¶ä»¥è¡¨æ˜å®ƒæ˜¯ä¸€ä¸ª manylinux wheelã€‚\næ³¨æ„ï¼šå³ä½¿æ‚¨æ˜¯ä»å¼€å‘äººå‘˜è€Œä¸æ˜¯ç”¨æˆ·çš„è§’åº¦æ¥å­¦ä¹ æœ¬æ•™ç¨‹ï¼Œè¯·ç¡®ä¿æ‚¨åœ¨ç»§ç»­æœ¬èŠ‚ä¹‹å‰å·²é˜…è¯»æœ‰å…³ manylinux wheel æ ‡ç­¾çš„éƒ¨åˆ†ã€‚\næ„å»ºä¸€ä¸ª manylinux Wheels å¯ä»¥è®©ä½ ç„å‡†æ›´å¹¿æ³›çš„ç”¨æˆ·å¹³å°ã€‚ PEP 513 æŒ‡å®šäº†ä¸€ä¸ªç‰¹å®šçš„ï¼ˆå’Œå¤è€çš„ï¼‰CentOS ç‰ˆæœ¬ï¼Œå…¶ä¸­åŒ…å«ä¸€ç³»åˆ—å¯ç”¨çš„ Python ç‰ˆæœ¬ã€‚ CentOS å’Œ Ubuntu æˆ–ä»»ä½•å…¶ä»–å‘è¡Œç‰ˆä¹‹é—´çš„é€‰æ‹©æ²¡æœ‰ä»»ä½•ç‰¹æ®ŠåŒºåˆ«ã€‚\né‡ç‚¹æ˜¯æ„å»ºç¯å¢ƒç”±ä¸€ä¸ªæ™®é€šçš„ Linux æ“ä½œç³»ç»Ÿå’Œä¸€ç»„æœ‰é™çš„å¤–éƒ¨å…±äº«åº“ç»„æˆï¼Œè¿™äº›å…±äº«åº“å¯¹äºä¸åŒçš„ Linux å˜ä½“æ˜¯é€šç”¨çš„ã€‚\nå€¼å¾—åº†å¹¸çš„æ˜¯ï¼Œæ‚¨ä¸å¿…è‡ªå·±æ‰§è¡Œæ­¤æ“ä½œã€‚ PyPA æä¾›äº†ä¸€ç»„ Docker é•œåƒï¼Œåªéœ€å•å‡»å‡ ä¸‹é¼ æ ‡å³å¯ä¸ºæ‚¨æä¾›æ­¤ç¯å¢ƒï¼š\né€‰é¡¹ 1 æ˜¯ä»æ‚¨çš„å¼€å‘æœºå™¨è¿è¡Œ docker å¹¶ä½¿ç”¨ Docker å·æŒ‚è½½æ‚¨çš„é¡¹ç›®ï¼Œä»¥ä¾¿å®ƒå¯ä»¥åœ¨å®¹å™¨æ–‡ä»¶ç³»ç»Ÿä¸­è®¿é—®ã€‚ é€‰é¡¹ 2 æ˜¯ä½¿ç”¨ CI/CD è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚ CircleCIã€GitHub Actionsã€Azure DevOps æˆ– Travis-CIï¼Œè¿™å°†æ‹‰å–æ‚¨çš„é¡¹ç›®å¹¶åœ¨æ¨é€æˆ–æ ‡è®°ç­‰æ“ä½œä¸Šè¿è¡Œæ„å»ºã€‚ ä¸ºä¸åŒçš„ manylinux é£æ ¼æä¾›äº† Docker é•œåƒï¼š\nmanylinux Tag Architecture Docker Image manylinux1 x86-64 quay.io/pypa/manylinux1_x86_64 manylinux1 i686 quay.io/pypa/manylinux1_i686 manylinux2010 x86-64 quay.io/pypa/manylinux2010_x86_64 manylinux2010 i686 quay.io/pypa/manylinux2010_i686 manylinux2014 x86-64 quay.io/pypa/manylinux2014_x86_64 manylinux2014 i686 quay.io/pypa/manylinux2014_i686 manylinux2014 aarch64 quay.io/pypa/manylinux2014_aarch64 manylinux2014 ppc64le quay.io/pypa/manylinux2014_ppc64le manylinux2014 s390x quay.io/pypa/manylinux2014_s390x é¦–å…ˆï¼ŒPyPA è¿˜æä¾›äº†ä¸€ä¸ªç¤ºä¾‹å­˜å‚¨åº“ python-manylinux-demoï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºä¸ Travis-CI ä¸€èµ·æ„å»º manylinux wheels çš„æ¼”ç¤ºé¡¹ç›®ã€‚\nè™½ç„¶æ„å»º wheels ä½œä¸ºè¿œç¨‹æ‰˜ç®¡ CI è§£å†³æ–¹æ¡ˆçš„ä¸€éƒ¨åˆ†å¾ˆå¸¸è§ï¼Œä½†æ‚¨ä¹Ÿå¯ä»¥åœ¨æœ¬åœ°æ„å»º manylinux wheelsã€‚ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦å®‰è£… Dockerã€‚ Docker Desktop é€‚ç”¨äº macOSã€Windows å’Œ Linuxã€‚\né¦–å…ˆï¼Œå…‹éš†æ¼”ç¤ºé¡¹ç›®ï¼š\n$ git clone -q git@github.com:pypa/python-manylinux-demo.git $ cd python-manylinux-demo æ¥ä¸‹æ¥ï¼Œåˆ†åˆ«ä¸º manylinux1 Docker é•œåƒå’Œå¹³å°å®šä¹‰å‡ ä¸ª shell å˜é‡ï¼š\n$ DOCKER_IMAGE=\u0026#39;quay.io/pypa/manylinux1_x86_64\u0026#39; $ PLAT=\u0026#39;manylinux1_x86_64\u0026#39; DOCKER_IMAGE å˜é‡æ˜¯ç”± PyPA ç»´æŠ¤çš„ç”¨äºæ„å»º manylinux Wheels çš„å›¾åƒï¼Œæ‰˜ç®¡åœ¨ Quay.ioã€‚å¹³å° ( PLAT ) æ˜¯æä¾›ç»™ auditwheel çš„å¿…è¦ä¿¡æ¯ï¼Œè®©å®ƒçŸ¥é“è¦åº”ç”¨å“ªä¸ªå¹³å°æ ‡ç­¾ã€‚\nç°åœ¨æ‚¨å¯ä»¥æ‹‰å– Docker é•œåƒå¹¶åœ¨å®¹å™¨ä¸­è¿è¡Œ wheel-builder è„šæœ¬ï¼š\n$ docker pull \u0026#34;$DOCKER_IMAGE\u0026#34; $ docker container run -t --rm \\ -e PLAT=$PLAT \\ -v \u0026#34;$(pwd)\u0026#34;:/io \\ \u0026#34;$DOCKER_IMAGE\u0026#34; /io/travis/build-wheels.sh è¿™å‘Šè¯‰ Docker åœ¨ manylinux1_x86_64 Docker å®¹å™¨å†…è¿è¡Œ build-wheels.sh shell è„šæœ¬ï¼Œå°† PLAT ä½œä¸ºå®¹å™¨ä¸­å¯ç”¨çš„ç¯å¢ƒå˜é‡ä¼ é€’ã€‚ç”±äºæ‚¨ä½¿ç”¨ -v ï¼ˆæˆ– --volume ï¼‰ç»‘å®šæŒ‚è½½å·ï¼Œå› æ­¤å®¹å™¨ä¸­ç”Ÿæˆçš„ Wheels ç°åœ¨å¯ä»¥åœ¨ä¸»æœºä¸Šçš„ wheelhouse ç›®å½•ä¸­è®¿é—®ï¼š\n$ ls -1 wheelhouse python_manylinux_demo-1.0-cp27-cp27m-manylinux1_x86_64.whl python_manylinux_demo-1.0-cp27-cp27mu-manylinux1_x86_64.whl python_manylinux_demo-1.0-cp35-cp35m-manylinux1_x86_64.whl python_manylinux_demo-1.0-cp36-cp36m-manylinux1_x86_64.whl python_manylinux_demo-1.0-cp37-cp37m-manylinux1_x86_64.whl python_manylinux_demo-1.0-cp38-cp38-manylinux1_x86_64.whl åœ¨å‡ ä¸ªç®€çŸ­çš„å‘½ä»¤ä¸­ï¼Œæ‚¨æ‹¥æœ‰ä¸€ç»„é€‚ç”¨äº CPython 2.7 åˆ° 3.8 çš„ manylinux1 Wheels ã€‚ä¸€ç§å¸¸è§çš„åšæ³•æ˜¯è¿­ä»£ä¸åŒçš„æ¶æ„ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å¯¹ quay.io/pypa/manylinux1_i686 Docker æ˜ åƒé‡å¤æ­¤è¿‡ç¨‹ã€‚è¿™å°†æ„å»ºé’ˆå¯¹ 32 ä½ (i686) æ¶æ„çš„ manylinux1 Wheels ã€‚\nå¦‚æœæ‚¨æƒ³æ›´æ·±å…¥åœ°ç ”ç©¶é€  Wheels ï¼Œé‚£ä¹ˆä¸‹ä¸€æ­¥å°±æ˜¯å‘æœ€å¥½çš„äººå­¦ä¹ ã€‚ä» Python Wheels é¡µé¢å¼€å§‹ï¼Œé€‰æ‹©ä¸€ä¸ªé¡¹ç›®ï¼Œå¯¼èˆªåˆ°å®ƒçš„æºä»£ç ï¼ˆåœ¨ GitHubã€GitLab æˆ– Bitbucket ç­‰åœ°æ–¹ï¼‰ï¼Œç„¶åäº²çœ¼çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•æ„å»º Wheels çš„ã€‚\nPython Wheels é¡µé¢ä¸Šçš„è®¸å¤šé¡¹ç›®éƒ½æ˜¯çº¯ Python é¡¹ç›®å¹¶åˆ†å‘é€šç”¨ Wheels ã€‚å¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾æ›´å¤æ‚çš„æ¡ˆä¾‹ï¼Œè¯·ç•™æ„ä½¿ç”¨æ‰©å±•æ¨¡å—çš„åŒ…ã€‚è¿™é‡Œæœ‰ä¸¤ä¸ªä¾‹å­å¯ä»¥æ¿€å‘ä½ çš„èƒƒå£ï¼š\nlxml ä½¿ç”¨ä» manylinux1 Docker å®¹å™¨ä¸­è°ƒç”¨çš„å•ç‹¬æ„å»ºè„šæœ¬ã€‚ ultrajson åšåŒæ ·çš„äº‹æƒ…å¹¶ä½¿ç”¨ GitHub Actions è°ƒç”¨æ„å»ºè„šæœ¬ã€‚ å¦‚æœæ‚¨æœ‰å…´è¶£æ„å»º manylinux Wheels ï¼Œè¿™ä¸¤ä¸ªéƒ½æ˜¯è‘—åçš„é¡¹ç›®ï¼Œå®ƒä»¬æä¾›äº†å¾ˆå¥½çš„ç¤ºä¾‹ä¾›æ‚¨å­¦ä¹ ã€‚\næ†ç»‘å…±äº«åº“ å¦ä¸€ä¸ªæŒ‘æˆ˜æ˜¯ä¸ºä¾èµ–äºå¤–éƒ¨å…±äº«åº“çš„åŒ…æ„å»º Wheels ã€‚ manylinux å›¾åƒåŒ…å«ä¸€ç»„é¢„ç­›é€‰çš„åº“ï¼Œä¾‹å¦‚ libpthread.so.0 å’Œ libc.so.6 ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨ä¾èµ–è¯¥åˆ—è¡¨ä¹‹å¤–çš„ä¸œè¥¿æ€ä¹ˆåŠï¼Œä¾‹å¦‚ ATLAS æˆ– GFortranï¼Ÿ\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ‰å‡ ç§è§£å†³æ–¹æ¡ˆå¯ä»¥è§£å†³é—®é¢˜ï¼š\nauditwheel ä¼šå°†å¤–éƒ¨åº“æ†ç»‘åˆ°ä¸€ä¸ªå·²ç»æ„å»ºå¥½çš„ Wheels ä¸­ã€‚ delocate åœ¨ macOS ä¸ŠåšåŒæ ·çš„äº‹æƒ…ã€‚ æ–¹ä¾¿çš„æ˜¯ï¼Œ auditwheel å‡ºç°åœ¨ manylinux Docker é•œåƒä¸Šã€‚ä½¿ç”¨ auditwheel å’Œ delocate åªéœ€ä¸€ä¸ªå‘½ä»¤ã€‚åªéœ€å‘Šè¯‰ä»–ä»¬æœ‰å…³ wheel æ–‡ä»¶çš„ä¿¡æ¯ï¼Œä»–ä»¬å°±ä¼šå®Œæˆå‰©ä¸‹çš„å·¥ä½œï¼š\n$ auditwheel repair \u0026lt;path-to-wheel.whl\u0026gt; # For manylinux $ delocate-wheel \u0026lt;path-to-wheel.whl\u0026gt; # For macOS è¿™å°†é€šè¿‡é¡¹ç›®çš„ setup.py æ£€æµ‹æ‰€éœ€çš„å¤–éƒ¨åº“ï¼Œå¹¶å°†å®ƒä»¬æ†ç»‘åˆ° wheel ä¸­ï¼Œå°±å¥½åƒå®ƒä»¬æ˜¯é¡¹ç›®çš„ä¸€éƒ¨åˆ†ä¸€æ ·ã€‚\nåˆ©ç”¨ auditwheel å’Œ delocate çš„é¡¹ç›®ç¤ºä¾‹æ˜¯ pycld3 ï¼Œå®ƒä¸º Compact Language Detector v3 (CLD3) æä¾› Python ç»‘å®šã€‚\npycld3 åŒ…ä¾èµ–äº libprotobuf ï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªé€šå¸¸å®‰è£…çš„åº“ã€‚å¦‚æœä½ æŸ¥çœ‹ pycld3 macOS Wheels å†…éƒ¨ï¼Œä½ ä¼šçœ‹åˆ° libprotobuf.22.dylib åŒ…å«åœ¨é‚£é‡Œã€‚è¿™æ˜¯ä¸€ä¸ªæ†ç»‘åˆ° Wheels ä¸­çš„åŠ¨æ€é“¾æ¥å…±äº«åº“ï¼š\n$ unzip -l pycld3-0.20-cp38-cp38-macosx_10_15_x86_64.whl ... 51 04-10-2020 11:46 cld3/__init__.py 939984 04-10-2020 07:50 cld3/_cld3.cpython-38-darwin.so 2375836 04-10-2020 07:50 cld3/.dylibs/libprotobuf.22.dylib --------- ------- 3339279 8 files Wheels é¢„åŒ…è£…æœ‰ libprotobuf ã€‚ .dylib ç±»ä¼¼äº Unix .so æ–‡ä»¶æˆ– Windows .dll æ–‡ä»¶ï¼Œä½†æˆ‘æ‰¿è®¤æˆ‘ä¸çŸ¥é“é™¤æ­¤ä¹‹å¤–çš„å…·ä½“åŒºåˆ«ã€‚\nauditwheel å’Œ delocate çŸ¥é“åŒ…å« libprotobuf å› ä¸º setup.py é€šè¿‡ libraries å‚æ•°å‘Šè¯‰ä»–ä»¬ï¼š\nsetup( # ... libraries=[\u0026#34;protobuf\u0026#34;], # ... ) è¿™æ„å‘³ç€ auditwheel å’Œ delocate ä¸ºç”¨æˆ·çœå»äº†å®‰è£… protobuf çš„éº»çƒ¦ï¼Œåªè¦ä»–ä»¬ä»å…·æœ‰åŒ¹é… Wheels çš„å¹³å°å’Œ Python ç»„åˆè¿›è¡Œå®‰è£…å³å¯ã€‚\nå¦‚æœæ‚¨è¦åˆ†å‘çš„åŒ…å…·æœ‰è¿™æ ·çš„å¤–éƒ¨ä¾èµ–é¡¹ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨ auditwheel æˆ– delocate æ¥å¸®æ‚¨çš„ç”¨æˆ·ä¸€ä¸ªå¿™ï¼Œè®©ä»–ä»¬çœå»è‡ªå·±å®‰è£…ä¾èµ–é¡¹çš„é¢å¤–æ­¥éª¤ã€‚\nåœ¨æŒç»­é›†æˆä¸­æ„å»º Wheels åœ¨æœ¬åœ°æœºå™¨ä¸Šæ„å»º Wheels çš„æ›¿ä»£æ–¹æ³•æ˜¯åœ¨é¡¹ç›®çš„ CI ç®¡é“ä¸­è‡ªåŠ¨æ„å»ºå®ƒä»¬ã€‚\næœ‰æ— æ•°ä¸ä¸»è¦ä»£ç æ‰˜ç®¡æœåŠ¡é›†æˆçš„ CI è§£å†³æ–¹æ¡ˆã€‚å…¶ä¸­åŒ…æ‹¬ Appveyorã€Azure DevOpsã€BitBucket Pipelinesã€Circle CIã€GitLabã€GitHub Actionsã€Jenkins å’Œ Travis CIï¼Œä»…ä¸¾å‡ ä¾‹ã€‚\næœ¬æ•™ç¨‹çš„ç›®çš„ä¸æ˜¯è¦åˆ¤æ–­å“ªç§ CI æœåŠ¡æœ€é€‚åˆæ„å»º Wheels ï¼Œä»¥åŠè€ƒè™‘åˆ° CI æ”¯æŒçš„å‘å±•é€Ÿåº¦ï¼Œä»»ä½•æ”¯æŒå“ªäº›å®¹å™¨çš„ CI æœåŠ¡åˆ—è¡¨å¾ˆå¿«å°±ä¼šè¿‡æ—¶ã€‚\nä½†æ˜¯ï¼Œæœ¬èŠ‚å¯ä»¥å¸®åŠ©æ‚¨å…¥é—¨ã€‚\nå¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªçº¯ Python åŒ…ï¼Œ bdist_wheel ä¸€æ­¥æ˜¯ä¸€ä¸ªå¹¸ç¦çš„å•è¡Œï¼šå®ƒåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šä¸ä½ åœ¨å“ªä¸ªå®¹å™¨æ“ä½œç³»ç»Ÿå’Œå¹³å°ä¸Šæ„å»º Wheels æ— å…³ã€‚å‡ ä¹æ‰€æœ‰ä¸»è¦çš„ CI æœåŠ¡éƒ½åº”è¯¥ä½¿æ‚¨èƒ½å¤Ÿé€šè¿‡åœ¨é¡¹ç›®å†…çš„ç‰¹æ®Š YAML æ–‡ä»¶ä¸­å®šä¹‰æ­¥éª¤æ¥ä»¥ç®€æ´çš„æ–¹å¼æ‰§è¡Œæ­¤æ“ä½œã€‚\nä¾‹å¦‚ï¼Œè¿™æ˜¯æ‚¨å¯ä»¥ç”¨äº GitHub Actions çš„è¯­æ³•ï¼š\nname: Python wheels on: release: types: - created jobs: wheels: runs-on: ubuntu-latest steps: - uses: actions/checkout@v2 - name: Set up Python 3.x uses: actions/setup-python@v2 with: python-version: \u0026#34;3.x\u0026#34; - name: Install dependencies run: python -m pip install --upgrade setuptools wheel - name: Build wheels run: python setup.py bdist_wheel - uses: actions/upload-artifact@v2 with: name: dist path: dist åœ¨æ­¤é…ç½®æ–‡ä»¶ä¸­ï¼Œæ‚¨ä½¿ç”¨ä»¥ä¸‹æ­¥éª¤æ„å»ºä¸€ä¸ª Wheels ï¼š\nåœ¨ç¬¬ 8 è¡Œï¼Œæ‚¨æŒ‡å®šè¯¥ä½œä¸šåº”åœ¨ Ubuntu æœºå™¨ä¸Šè¿è¡Œã€‚ åœ¨ç¬¬ 10 è¡Œä¸­ï¼Œæ‚¨ä½¿ç”¨ checkout æ“ä½œæ¥è®¾ç½®æ‚¨çš„é¡¹ç›®å­˜å‚¨åº“ã€‚ åœ¨ç¬¬ 14 è¡Œï¼Œæ‚¨å‘Šè¯‰ CI è¿è¡Œå™¨ä½¿ç”¨æœ€æ–°ç¨³å®šç‰ˆæœ¬çš„ Python 3ã€‚ åœ¨ç¬¬ 21 è¡Œä¸­ï¼Œæ‚¨è¯·æ±‚å°†ç”Ÿæˆçš„ Wheels ä½œä¸ºå·¥ä»¶æä¾›ï¼Œæ‚¨å¯ä»¥åœ¨ä½œä¸šå®Œæˆåä» UI ä¸‹è½½è¯¥å·¥ä»¶ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæ‚¨æœ‰ä¸€ä¸ªå¤æ‚çš„é¡¹ç›®ï¼ˆå¯èƒ½æ˜¯ä¸€ä¸ªå¸¦æœ‰ C æ‰©å±•æˆ– Cython ä»£ç çš„é¡¹ç›®ï¼‰å¹¶ä¸”æ‚¨æ­£åœ¨åŠªåŠ›æ„å»ºä¸€ä¸ª CI/CD ç®¡é“ä»¥è‡ªåŠ¨æ„å»º Wheels ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šæ¶‰åŠé¢å¤–çš„æ­¥éª¤ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æ‚¨å¯ä»¥é€šè¿‡ç¤ºä¾‹å­¦ä¹ çš„é¡¹ç›®ï¼š\nyarl msgpack markupsafe cryptography è®¸å¤šé¡¹ç›®æ¨å‡ºäº†è‡ªå·±çš„ CI é…ç½®ã€‚ç„¶è€Œï¼Œä¸€äº›è§£å†³æ–¹æ¡ˆå·²ç»å‡ºç°ï¼Œç”¨äºå‡å°‘é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„ä»£ç é‡æ¥æ„å»º Wheels ã€‚æ‚¨å¯ä»¥ç›´æ¥åœ¨ CI æœåŠ¡å™¨ä¸Šä½¿ç”¨ cibuildwheel å·¥å…·æ¥å‡å°‘æ„å»ºå¤šä¸ªå¹³å° Wheels æ‰€éœ€çš„ä»£ç è¡Œå’Œé…ç½®ã€‚è¿˜æœ‰ multibuildï¼Œå®ƒæä¾›äº†ä¸€ç»„ shell è„šæœ¬ï¼Œç”¨äºååŠ©åœ¨ Travis CI å’Œ AppVeyor ä¸Šæ„å»º Wheels ã€‚\nç¡®ä¿ä½ çš„ Wheels æ—‹è½¬æ­£ç¡® æ„å»ºç»“æ„æ­£ç¡®çš„ Wheels å¯èƒ½æ˜¯ä¸€é¡¹ç²¾ç»†çš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„ Python åŒ…ä½¿ç”¨ src å¸ƒå±€è€Œæ‚¨å¿˜è®°åœ¨ setup.py ä¸­æ­£ç¡®æŒ‡å®šå®ƒï¼Œé‚£ä¹ˆç”Ÿæˆçš„ Wheels å¯èƒ½åŒ…å«é”™è¯¯ä½ç½®çš„ç›®å½•ã€‚\næ‚¨å¯ä»¥åœ¨ bdist_wheel ä¹‹åä½¿ç”¨çš„ä¸€é¡¹æ£€æŸ¥æ˜¯ check-wheel-contents å·¥å…·ã€‚å®ƒæŸ¥æ‰¾å¸¸è§é—®é¢˜ï¼Œä¾‹å¦‚åŒ…ç›®å½•ç»“æ„å¼‚å¸¸æˆ–å­˜åœ¨é‡å¤æ–‡ä»¶ï¼š\n$ check-wheel-contents dist/*.whl dist/ujson-2.0.3-cp38-cp38-macosx_10_15_x86_64.whl: OK åœ¨æœ¬ä¾‹ä¸­ï¼Œ check-wheel-contents è¡¨ç¤ºå¸¦ ujson Wheels çš„æ‰€æœ‰å†…å®¹éƒ½å·²æ£€å‡ºã€‚å¦‚æœä¸æ˜¯ï¼Œ stdout å°†æ˜¾ç¤ºå¯èƒ½é—®é¢˜çš„æ‘˜è¦ï¼Œå°±åƒ flake8 ä¹‹ç±»çš„ linterã€‚\nå¦ä¸€ç§ç¡®è®¤æ‚¨æ„å»ºçš„ Wheels æ˜¯å¦æ­£ç¡®çš„æ–¹æ³•æ˜¯ä½¿ç”¨ TestPyPIã€‚é¦–å…ˆï¼Œæ‚¨å¯ä»¥åœ¨é‚£é‡Œä¸Šä¼ åŒ…ï¼š\n$ python -m twine upload \\ --repository-url https://test.pypi.org/legacy/ \\ dist/* ç„¶åï¼Œæ‚¨å¯ä»¥ä¸‹è½½ç›¸åŒçš„åŒ…è¿›è¡Œæµ‹è¯•ï¼Œå°±å¥½åƒå®ƒæ˜¯çœŸå®çš„ä¸€æ ·ï¼š\n$ python -m pip install \\ --index-url https://test.pypi.org/simple/ \\ \u0026lt;pkg-name\u0026gt; è¿™å…è®¸æ‚¨é€šè¿‡ä¸Šä¼ ç„¶åä¸‹è½½æ‚¨è‡ªå·±çš„é¡¹ç›®æ¥æµ‹è¯•æ‚¨çš„ Wheels ã€‚\nå°† Python Wheels ä¸Šä¼ åˆ° PyPI ç°åœ¨æ˜¯æ—¶å€™ä¸Šä¼ ä½ çš„ Python åŒ…äº†ã€‚ç”±äº sdist å’Œ wheel é»˜è®¤æƒ…å†µä¸‹éƒ½æ”¾åœ¨ dist/ ç›®å½•ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ twine å·¥å…·ä¸Šä¼ å®ƒä»¬ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºå°†åŒ…å‘å¸ƒåˆ° PyPI çš„å®ç”¨ç¨‹åºï¼š\n$ python -m pip install -U twine $ python -m twine upload dist/* ç”±äºé»˜è®¤æƒ…å†µä¸‹ sdist å’Œ bdist_wheel éƒ½è¾“å‡ºåˆ° dist/ ï¼Œæ‚¨å¯ä»¥å®‰å…¨åœ°å‘Šè¯‰ twine ä½¿ç”¨ shell é€šé…ç¬¦( dist/* ) ä¸Šä¼  dist/ ä¸‹çš„æ‰€æœ‰å†…å®¹ã€‚\nç»“è®º äº†è§£ Wheels åœ¨ Python ç”Ÿæ€ç³»ç»Ÿä¸­æ‰®æ¼”çš„å…³é”®è§’è‰²å¯ä»¥è®©æ‚¨ä½œä¸º Python åŒ…çš„ç”¨æˆ·å’Œå¼€å‘äººå‘˜çš„ç”Ÿæ´»æ›´è½»æ¾ã€‚\næ­¤å¤–ï¼Œåœ¨ Wheels æ–¹é¢æé«˜ä½ çš„ Python ç´ å…»å°†å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å®‰è£…åŒ…æ—¶å‘ç”Ÿäº†ä»€ä¹ˆï¼Œä»¥åŠåœ¨è¶Šæ¥è¶Šç½•è§çš„æƒ…å†µä¸‹ï¼Œè¯¥æ“ä½œä½•æ—¶å‡ºé”™ã€‚\nåœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å­¦ä¹ äº†ï¼š\nä»€ä¹ˆæ˜¯ Wheels ä»¥åŠå®ƒä»¬ä¸æºä»£ç åˆ†å¸ƒçš„æ¯”è¾ƒ å¦‚ä½•ä½¿ç”¨ Wheels æ¥æ§åˆ¶åŒ…å®‰è£…è¿‡ç¨‹ é€šç”¨ Wheels ã€çº¯ Python Wheels å’Œå¹³å° Wheels ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ« å¦‚ä½•ä¸ºæ‚¨è‡ªå·±çš„ Python åŒ…åˆ›å»ºå’Œåˆ†å‘ Wheels æ‚¨ç°åœ¨å·²ç»ä»ç”¨æˆ·å’Œå¼€å‘äººå‘˜çš„è§’åº¦å¯¹ Wheels æœ‰äº†æ·±å…¥çš„äº†è§£ã€‚æ‚¨å®Œå…¨æœ‰èƒ½åŠ›æ„å»ºè‡ªå·±çš„ Wheels ï¼Œå¹¶ä½¿é¡¹ç›®çš„å®‰è£…è¿‡ç¨‹å¿«é€Ÿã€æ–¹ä¾¿å’Œç¨³å®šã€‚\nè¯·å‚é˜…ä¸‹é¢çš„éƒ¨åˆ†ä»¥è·å–ä¸€äº›é¢å¤–çš„é˜…è¯»ææ–™ï¼Œä»¥æ›´æ·±å…¥åœ°äº†è§£å¿«é€Ÿæ‰©å±•çš„ wheel ç”Ÿæ€ç³»ç»Ÿã€‚\nèµ„æº Python Wheelsé¡µé¢ä¸“é—¨è·Ÿè¸ª PyPI ä¸Šä¸‹è½½æ¬¡æ•°æœ€å¤šçš„ 360 ä¸ªåŒ…ä¸­å¯¹ wheels çš„æ”¯æŒã€‚åœ¨ç¼–å†™æœ¬æ•™ç¨‹æ—¶ï¼Œé‡‡ç”¨ç‡éå¸¸å¯è§‚ï¼Œä¸º 360 åˆ†ä¹‹ 331ï¼Œå³ 91% å·¦å³ã€‚\nå·²ç»æœ‰è®¸å¤š Python å¢å¼ºææ¡ˆ (PEP) å¸®åŠ©äº† wheel æ ¼å¼çš„è§„èŒƒå’Œå‘å±•ï¼š\nPEP 425 - Compatibility Tags for Built Distributions PEP 427 - The Wheel Binary Package Format 1.0 PEP 491 - The Wheel Binary Package Format 1.9 PEP 513 - A Platform Tag for Portable Linux Built Distributions PEP 571 - The manylinux2010 Platform Tag PEP 599 - The manylinux2014 Platform Tag ä»¥ä¸‹æ˜¯æœ¬æ•™ç¨‹ä¸­æåˆ°çš„å„ç§ wheel æ‰“åŒ…å·¥å…·çš„å€™é€‰æ¸…å•ï¼š\npypa/wheel pypa/auditwheel pypa/manylinux pypa/python-manylinux-demo jwodder/check-wheel-contents matthew-brett/delocate matthew-brett/multibuild joerick/cibuildwheel Python æ–‡æ¡£æœ‰å‡ ç¯‡æ–‡ç« æ¶µç›–äº† Wheels å’Œæºä»£ç åˆ†å‘ï¼š\nGenerating Distribution Archives Creating a Source Distribution æœ€åï¼Œè¿™é‡Œæœ‰ä¸€äº›æ¥è‡ª PyPA çš„æ›´æœ‰ç”¨çš„é“¾æ¥ï¼š\nPackaging your Project An Overview of Packaging for Python åŸæ–‡åœ°å€ï¼šhttps://realpython.com/python-wheels/\n","permalink":"https://blog.chensoul.cc/posts/2023/06/01/python-wheels/","summary":"Python .whl æ–‡ä»¶æˆ– wheels æ˜¯ Python ä¸­å¾ˆå°‘è¢«è®¨è®ºçš„éƒ¨åˆ†ï¼Œä½†å®ƒä»¬å¯¹ Python åŒ…çš„å®‰è£…è¿‡ç¨‹å¤§æœ‰è£¨ç›Šã€‚å¦‚æœæ‚¨ä½¿ç”¨ pip å®‰è£…äº† Python åŒ…ï¼Œé‚£ä¹ˆ Wheels å¾ˆå¯èƒ½ä½¿å®‰è£…æ›´å¿«ã€æ›´é«˜æ•ˆã€‚\nWheels æ˜¯ Python ç”Ÿæ€ç³»ç»Ÿçš„ä¸€ä¸ªç»„ä»¶ï¼Œæœ‰åŠ©äºä½¿åŒ…å®‰è£…æ­£å¸¸å·¥ä½œã€‚å®ƒä»¬å…è®¸æ›´å¿«çš„å®‰è£…å’Œæ›´ç¨³å®šçš„åŒ…åˆ†å‘è¿‡ç¨‹ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†æ·±å…¥äº†è§£ Wheels æ˜¯ä»€ä¹ˆï¼Œå®ƒä»¬æœ‰ä»€ä¹ˆå¥½å¤„ï¼Œä»¥åŠå®ƒä»¬å¦‚ä½•è·å¾—ç‰µå¼•åŠ›å¹¶ä½¿ Python ä½¿ç”¨èµ·æ¥æ›´åŠ æ„‰å¿«ã€‚\nåœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†å­¦ä¹ ï¼š\nä»€ä¹ˆæ˜¯ Wheels ä»¥åŠå®ƒä»¬ä¸æºä»£ç åˆ†å‘çš„æ¯”è¾ƒ å¦‚ä½•ä½¿ç”¨ Wheels æ¥æ§åˆ¶åŒ…å®‰è£…è¿‡ç¨‹ å¦‚ä½•ä¸ºæ‚¨è‡ªå·±çš„ Python åŒ…åˆ›å»ºå’Œåˆ†å‘ Wheels æ‚¨å°†ä»ç”¨æˆ·å’Œå¼€å‘äººå‘˜çš„è§’åº¦çœ‹åˆ°ä½¿ç”¨æµè¡Œçš„å¼€æº Python åŒ…çš„ç¤ºä¾‹ã€‚\nå…è´¹èµ å“ï¼šå•å‡»æ­¤å¤„è·å– Python å¤‡å¿˜å•å¹¶å­¦ä¹  Python 3 çš„åŸºç¡€çŸ¥è¯†ï¼Œä¾‹å¦‚ä½¿ç”¨æ•°æ®ç±»å‹ã€å­—å…¸ã€åˆ—è¡¨å’Œ Python å‡½æ•°ã€‚\nå®‰è£… æ¥ä¸‹æ¥ï¼Œæ¿€æ´»è™šæ‹Ÿç¯å¢ƒå¹¶ç¡®ä¿å®‰è£…äº†æœ€æ–°ç‰ˆæœ¬çš„ pip ã€ wheel å’Œ setuptools ï¼š\n$ python -m venv env \u0026amp;\u0026amp; source ./env/bin/activate $ python -m pip install -U pip wheel setuptools Successfully installed pip 20.1 setuptools-46.1.3 wheel-0.34.2 è¿™å°±æ˜¯æ‚¨å°è¯•å®‰è£…å’Œæ„å»º Wheels æ‰€éœ€çš„å…¨éƒ¨å†…å®¹ï¼\nPython æ‰“åŒ…å˜å¾—æ›´å¥½ï¼šPython Wheels ç®€ä»‹ åœ¨å­¦ä¹ å¦‚ä½•å°†é¡¹ç›®æ‰“åŒ…åˆ° wheel ä¹‹å‰ï¼Œä»ç”¨æˆ·çš„è§’åº¦äº†è§£ä½¿ç”¨ wheel çš„æ ·å­ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚è¿™å¬èµ·æ¥å¯èƒ½æœ‰ç‚¹è½åï¼Œä½†äº†è§£ Wheels å¦‚ä½•å·¥ä½œçš„ä¸€ä¸ªå¥½æ–¹æ³•æ˜¯ä»å®‰è£…ä¸€ä¸ªä¸æ˜¯ Wheels çš„ä¸œè¥¿å¼€å§‹ã€‚\næ‚¨å¯ä»¥åƒå¾€å¸¸ä¸€æ ·ï¼Œé€šè¿‡å°† Python åŒ…å®‰è£…åˆ°æ‚¨çš„ç¯å¢ƒä¸­æ¥å¼€å§‹è¿™ä¸ªå®éªŒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®‰è£… uWSGI ç‰ˆæœ¬ 2.0.xï¼š\n$ python -m pip install \u0026#39;uwsgi==2.","title":"[è¯‘]ä»€ä¹ˆæ˜¯ Python Wheelsï¼Œä½ ä¸ºä»€ä¹ˆè¦å…³å¿ƒå®ƒï¼Ÿ"},{"content":" Python çš„æ ‡å‡†åŒ…ç®¡ç†å™¨æ˜¯ pip ã€‚å®ƒå…è®¸æ‚¨å®‰è£…å’Œç®¡ç†ä¸å±äº Python æ ‡å‡†åº“çš„åŒ…ã€‚å¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾ pip çš„ä»‹ç»ï¼Œé‚£ä¹ˆæ‚¨æ¥å¯¹åœ°æ–¹äº†ï¼\nåœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•ï¼š\nåœ¨æ‚¨çš„å·¥ä½œç¯å¢ƒä¸­è®¾ç½® pip ä¿®å¤ä¸ä½¿ç”¨ pip ç›¸å…³çš„å¸¸è§é”™è¯¯ ä½¿ç”¨ pip å®‰è£…å’Œå¸è½½åŒ… ä½¿ç”¨éœ€æ±‚æ–‡ä»¶ç®¡ç†é¡¹ç›®çš„ä¾èµ–å…³ç³» pip å¯ä»¥åšå¾ˆå¤šäº‹æƒ…ï¼Œä½†æ˜¯ Python ç¤¾åŒºéå¸¸æ´»è·ƒï¼Œå·²ç»åˆ›å»ºäº†ä¸€äº› pip çš„å·§å¦™æ›¿ä»£å“ã€‚æ‚¨å°†åœ¨æœ¬æ•™ç¨‹çš„åé¢éƒ¨åˆ†äº†è§£è¿™äº›å†…å®¹ã€‚\nä» pip å¼€å§‹ é‚£ä¹ˆï¼Œpip å…·ä½“æ˜¯åšä»€ä¹ˆçš„å‘¢ï¼Ÿ pip æ˜¯ Python çš„åŒ…ç®¡ç†å™¨ã€‚è¿™æ„å‘³ç€å®ƒæ˜¯ä¸€ä¸ªå…è®¸æ‚¨å®‰è£…å’Œç®¡ç†æœªä½œä¸ºæ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†åˆ†å‘çš„åº“å’Œä¾èµ–é¡¹çš„å·¥å…·ã€‚ pip è¿™ä¸ªåå­—æ˜¯ç”± Ian Bicking åœ¨ 2008 å¹´å¼•å…¥çš„ï¼š\næˆ‘å·²ç»å°† pyinstall é‡å‘½åä¸ºæ–°åç§°ï¼špipã€‚pip æ˜¯ pip install package é¦–å­—æ¯ç¼©å†™ã€‚ ï¼ˆ æ¥æºï¼‰\nåŒ…ç®¡ç†éå¸¸é‡è¦ï¼ŒPython çš„å®‰è£…ç¨‹åºä» 3.4 ç‰ˆå’Œ 2.7.9 ç‰ˆå¼€å§‹åˆ†åˆ«ä¸º Python 3 å’Œ Python 2 åŒ…å«äº† pip ã€‚è®¸å¤š Python é¡¹ç›®éƒ½ä½¿ç”¨ pip ï¼Œè¿™ä½¿å®ƒæˆä¸ºæ¯ä¸ª Pythonista çš„å¿…å¤‡å·¥å…·ã€‚\nå¦‚æœæ‚¨æ¥è‡ªå¦ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œæ‚¨å¯èƒ½ä¼šç†Ÿæ‚‰åŒ…ç®¡ç†å™¨çš„æ¦‚å¿µã€‚ JavaScript ä½¿ç”¨ npm è¿›è¡ŒåŒ…ç®¡ç†ï¼ŒRuby ä½¿ç”¨ gemï¼Œ.NET å¹³å°ä½¿ç”¨ NuGetã€‚åœ¨ Python ä¸­ï¼Œ pip å·²æˆä¸ºæ ‡å‡†åŒ…ç®¡ç†å™¨ã€‚\nåœ¨æ‚¨çš„ç³»ç»Ÿä¸ŠæŸ¥æ‰¾ pip Python 3 å®‰è£…ç¨‹åºä¸ºæ‚¨æä¾›äº†åœ¨ç³»ç»Ÿä¸Šå®‰è£… Python æ—¶å®‰è£… pip çš„é€‰é¡¹ã€‚äº‹å®ä¸Šï¼Œ pip ä¸ Python ä¸€èµ·å®‰è£…çš„é€‰é¡¹é»˜è®¤æ˜¯å‹¾é€‰çš„ï¼Œæ‰€ä»¥ pip åº”è¯¥åœ¨å®‰è£…å®Œ Python ä¹‹åå°±å¯ä»¥ä½¿ç”¨äº†ã€‚\næ³¨æ„ï¼šåœ¨æŸäº› Linux (Unix) ç³»ç»Ÿï¼ˆå¦‚ Ubuntuï¼‰ä¸Šï¼Œ pip ä½äºä¸€ä¸ªåä¸º python3-pip çš„å•ç‹¬åŒ…ä¸­ï¼Œæ‚¨éœ€è¦ä½¿ç”¨ sudo apt install python3-pip å®‰è£…å®ƒã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¸ä¼šéšè§£é‡Šå™¨ä¸€èµ·å®‰è£…ã€‚\næ‚¨å¯ä»¥é€šè¿‡åœ¨æ‚¨çš„ç³»ç»Ÿä¸ŠæŸ¥æ‰¾ pip3 å¯æ‰§è¡Œæ–‡ä»¶æ¥éªŒè¯ pip æ˜¯å¦å¯ç”¨ã€‚åœ¨ä¸‹é¢é€‰æ‹©æ‚¨çš„æ“ä½œç³»ç»Ÿå¹¶ç›¸åº”åœ°ä½¿ç”¨æ‚¨çš„å¹³å°ç‰¹å®šå‘½ä»¤ï¼š\nWindowsï¼š\nC:\\\u0026gt; where pip3 Linux + macOSï¼š\n$ which pip3 Linux ç³»ç»Ÿå’Œ macOS ä¸Šçš„ which å‘½ä»¤æ˜¾ç¤º pip3 äºŒè¿›åˆ¶æ–‡ä»¶æ‰€åœ¨çš„ä½ç½®ã€‚\nåœ¨ Windows å’Œ Unix ç³»ç»Ÿä¸Šï¼Œ pip3 å¯èƒ½ä½äºå¤šä¸ªä½ç½®ã€‚å½“æ‚¨å®‰è£…äº†å¤šä¸ª Python ç‰ˆæœ¬æ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚å¦‚æœæ‚¨åœ¨ç³»ç»Ÿçš„ä»»ä½•ä½ç½®éƒ½æ‰¾ä¸åˆ° pip ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥è€ƒè™‘é‡æ–°å®‰è£… pipã€‚\né™¤äº†ç›´æ¥è¿è¡Œæ‚¨çš„ç³»ç»Ÿ pip ï¼Œæ‚¨è¿˜å¯ä»¥å°†å…¶ä½œä¸º Python æ¨¡å—è¿è¡Œã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæ‚¨å°†äº†è§£å¦‚ä½•æ“ä½œã€‚\nä½œä¸ºæ¨¡å—è¿è¡Œ pip å½“æ‚¨ç›´æ¥è¿è¡Œç³»ç»Ÿ pip æ—¶ï¼Œå‘½ä»¤æœ¬èº«ä¸ä¼šæ˜¾ç¤º pip å±äºå“ªä¸ª Python ç‰ˆæœ¬ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥åœ¨ä¸æ³¨æ„çš„æƒ…å†µä¸‹ä½¿ç”¨ pip å°†åŒ…å®‰è£…åˆ°æ—§ Python ç‰ˆæœ¬çš„ç«™ç‚¹åŒ…ä¸­ã€‚ä¸ºé˜²æ­¢è¿™ç§æƒ…å†µå‘ç”Ÿï¼Œæ‚¨å¯ä»¥å°† pip ä½œä¸º Python æ¨¡å—è¿è¡Œï¼š\n$ python3 -m pip è¯·æ³¨æ„ï¼Œæ‚¨ä½¿ç”¨ python3 -m æ¥è¿è¡Œ pip ã€‚ -m å¼€å…³å‘Šè¯‰ Python å°†æ¨¡å—ä½œä¸º python3 è§£é‡Šå™¨çš„å¯æ‰§è¡Œæ–‡ä»¶è¿è¡Œã€‚è¿™æ ·ï¼Œæ‚¨å¯ä»¥ç¡®ä¿ç³»ç»Ÿé»˜è®¤çš„ Python 3 ç‰ˆæœ¬è¿è¡Œ pip å‘½ä»¤ã€‚å¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šå…³äºè¿™ç§è¿è¡Œ pip çš„æ–¹å¼ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥é˜…è¯» Brett Cannon å…³äºä½¿ç”¨ python3 -m pip çš„ä¼˜åŠ¿çš„æœ‰è§åœ°çš„æ–‡ç« ã€‚\næœ‰æ—¶æ‚¨å¯èƒ½å¸Œæœ›æ›´åŠ æ˜ç¡®å¹¶å°†åŒ…é™åˆ¶åˆ°ç‰¹å®šé¡¹ç›®ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨åº”è¯¥åœ¨è™šæ‹Ÿç¯å¢ƒä¸­è¿è¡Œ pip ã€‚\nåœ¨ Python è™šæ‹Ÿç¯å¢ƒä¸­ä½¿ç”¨ pip ä¸ºé¿å…å°†åŒ…ç›´æ¥å®‰è£…åˆ°ç³»ç»Ÿ Python å®‰è£…ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒã€‚è™šæ‹Ÿç¯å¢ƒä¸ºæ‚¨çš„é¡¹ç›®æä¾›ç‹¬ç«‹çš„ Python è§£é‡Šå™¨ã€‚æ‚¨åœ¨æ­¤ç¯å¢ƒä¸­ä½¿ç”¨çš„ä»»ä½•åŒ…éƒ½å°†ç‹¬ç«‹äºæ‚¨çš„ç³»ç»Ÿè§£é‡Šå™¨ã€‚\nè¿™æ„å‘³ç€æ‚¨å¯ä»¥å°†é¡¹ç›®çš„ä¾èµ–é¡¹ä¸å…¶ä»–é¡¹ç›®å’Œæ•´ä¸ªç³»ç»Ÿåˆ†å¼€ã€‚\nåœ¨è™šæ‹Ÿç¯å¢ƒä¸­ä½¿ç”¨ pip å…·æœ‰ä¸‰ä¸ªä¸»è¦ä¼˜ç‚¹ã€‚ä½ å¯ä»¥ï¼š\nç¡®ä¿æ‚¨ä¸ºæ‰‹å¤´çš„é¡¹ç›®ä½¿ç”¨æ­£ç¡®çš„ Python ç‰ˆæœ¬ ç¡®ä¿åœ¨è¿è¡Œ pip æˆ– pip3 æ—¶å¼•ç”¨çš„æ˜¯æ­£ç¡®çš„ pip å®ä¾‹ åœ¨ä¸å½±å“å…¶ä»–é¡¹ç›®çš„æƒ…å†µä¸‹ä¸ºæ‚¨çš„é¡¹ç›®ä½¿ç”¨ç‰¹å®šçš„åŒ…ç‰ˆæœ¬ Python 3 å…·æœ‰ç”¨äºåˆ›å»ºè™šæ‹Ÿç¯å¢ƒçš„å†…ç½® venv æ¨¡å—ã€‚æ­¤æ¨¡å—å¯å¸®åŠ©æ‚¨ä½¿ç”¨ç‹¬ç«‹çš„ Python å®‰è£…åˆ›å»ºè™šæ‹Ÿç¯å¢ƒã€‚ä¸€æ—¦ä½ æ¿€æ´»äº†è™šæ‹Ÿç¯å¢ƒï¼Œä½ å°±å¯ä»¥å°†åŒ…å®‰è£…åˆ°è¿™ä¸ªç¯å¢ƒä¸­ã€‚\næ‚¨å®‰è£…åˆ°ä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒä¸­çš„è½¯ä»¶åŒ…ä¸ç³»ç»Ÿä¸Šçš„æ‰€æœ‰å…¶ä»–ç¯å¢ƒéš”ç¦»å¼€æ¥ã€‚\næ‚¨å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå¹¶éªŒè¯æ‚¨æ˜¯å¦åœ¨æ–°åˆ›å»ºçš„ç¯å¢ƒä¸­ä½¿ç”¨ pip æ¨¡å—ï¼š\nWindowsï¼š\nC:\\\u0026gt; python -m venv venv C:\\\u0026gt; venv\\Scripts\\activate.bat (venv) C:\\\u0026gt; pip3 --version pip 21.2.3 from ...\\lib\\site-packages\\pip (python 3.10) (venv) C:\\\u0026gt; pip --version pip 21.2.3 from ...\\lib\\site-packages\\pip (python 3.10) Linux + macOSï¼š\n$ python3 -m venv venv $ source venv/bin/activate (venv) $ pip3 --version pip 21.2.3 from .../python3.10/site-packages/pip (python 3.10) (venv) $ pip --version pip 21.2.3 from .../python3.10/site-packages/pip (python 3.10) åœ¨è¿™é‡Œï¼Œæ‚¨ä½¿ç”¨ Python çš„å†…ç½® venv æ¨¡å—åˆ›å»ºäº†ä¸€ä¸ªåä¸º venv çš„è™šæ‹Ÿç¯å¢ƒã€‚ç„¶åä½¿ç”¨ source å‘½ä»¤æ¿€æ´»å®ƒã€‚ venv åç§°å‘¨å›´çš„æ‹¬å· ( () ) è¡¨ç¤ºæ‚¨å·²æˆåŠŸæ¿€æ´»è™šæ‹Ÿç¯å¢ƒã€‚\næœ€åï¼Œæ‚¨æ£€æŸ¥æ¿€æ´»çš„è™šæ‹Ÿç¯å¢ƒä¸­ pip3 å’Œ pip å¯æ‰§è¡Œæ–‡ä»¶çš„ç‰ˆæœ¬ã€‚ä¸¤è€…éƒ½æŒ‡å‘ç›¸åŒçš„ pip æ¨¡å—ï¼Œå› æ­¤ä¸€æ—¦æ‚¨çš„è™šæ‹Ÿç¯å¢ƒè¢«æ¿€æ´»ï¼Œæ‚¨å°±å¯ä»¥ä½¿ç”¨ pip æˆ– pip3 ã€‚\nå‡ºç°é”™è¯¯æ—¶é‡æ–°å®‰è£… pip å½“æ‚¨è¿è¡Œ pip å‘½ä»¤æ—¶ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹æ‚¨å¯èƒ½ä¼šé‡åˆ°é”™è¯¯ã€‚æ‚¨çš„ç‰¹å®šé”™è¯¯æ¶ˆæ¯å°†å–å†³äºæ‚¨çš„æ“ä½œç³»ç»Ÿï¼š\nOperating System Error Message Windows 'pip' is not recognized as an internal or external command, operable program or batch file. Linux bash: pip: command not found macOS zsh: command not found: pip æ³¨æ„ï¼šåœ¨ pip å‘½ä»¤ä¸èµ·ä½œç”¨æ—¶å¼€å§‹ä»»ä½•æ•…éšœæ’é™¤ä¹‹å‰ï¼Œæ‚¨å¯ä»¥å°è¯•ä½¿ç”¨æœ€åå¸¦æœ‰ 3 çš„ pip3 å‘½ä»¤ã€‚\nå‡ºç°å¦‚ä¸Šæ‰€ç¤ºçš„é”™è¯¯å¯èƒ½ä¼šä»¤äººæ²®ä¸§ï¼Œå› ä¸º pip å¯¹äºå®‰è£…å’Œç®¡ç†å¤–éƒ¨åŒ…è‡³å…³é‡è¦ã€‚ pip çš„ä¸€äº›å¸¸è§é—®é¢˜ä¸æ­¤å·¥å…·åœ¨æ‚¨çš„ç³»ç»Ÿä¸Šçš„å®‰è£…æ–¹å¼æœ‰å…³ã€‚\nå°½ç®¡å„ç§ç³»ç»Ÿçš„é”™è¯¯æ¶ˆæ¯ä¸åŒï¼Œä½†å®ƒä»¬éƒ½æŒ‡å‘åŒä¸€ä¸ªé—®é¢˜ï¼šæ‚¨çš„ç³»ç»Ÿæ— æ³•åœ¨æ‚¨çš„ PATH å˜é‡ä¸­åˆ—å‡ºçš„ä½ç½®æ‰¾åˆ° pip ã€‚åœ¨ Windows ä¸Šï¼Œ PATH æ˜¯ç³»ç»Ÿå˜é‡çš„ä¸€éƒ¨åˆ†ã€‚åœ¨ macOS å’Œ Linux ä¸Šï¼Œ PATH æ˜¯ç¯å¢ƒå˜é‡çš„ä¸€éƒ¨åˆ†ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ PATH å˜é‡çš„å†…å®¹ï¼š\nWindowsï¼š\nC:\\\u0026gt; echo %PATH% Linux + macOSï¼š\n$ echo $PATH æ­¤å‘½ä»¤çš„è¾“å‡ºå°†æ˜¾ç¤ºç£ç›˜ä¸Šæ“ä½œç³»ç»ŸæŸ¥æ‰¾å¯æ‰§è¡Œç¨‹åºçš„ä½ç½®ï¼ˆç›®å½•ï¼‰åˆ—è¡¨ã€‚æ ¹æ®æ‚¨çš„ç³»ç»Ÿï¼Œä½ç½®å¯ä»¥ç”¨å†’å· ( : ) æˆ–åˆ†å· ( ; ) åˆ†éš”ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨å®‰è£… Python æˆ–åˆ›å»ºè™šæ‹Ÿç¯å¢ƒåï¼ŒåŒ…å« pip å¯æ‰§è¡Œæ–‡ä»¶çš„ç›®å½•åº”è¯¥å‡ºç°åœ¨ PATH ä¸­ã€‚ä½†æ˜¯ï¼Œç¼ºå°‘ pip æ˜¯ä¸€ä¸ªå¸¸è§é—®é¢˜ã€‚ä¸¤ç§æ”¯æŒçš„æ–¹æ³•å¯ä»¥å¸®åŠ©æ‚¨å†æ¬¡å®‰è£… pip å¹¶å°†å…¶æ·»åŠ åˆ°æ‚¨çš„ PATH ï¼š\nensurepip æ¨¡å— get-pip.py è„šæœ¬ ensurepip æ¨¡å—ä» Python 3.4 å¼€å§‹å°±æ˜¯æ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†ã€‚æ·»åŠ å®ƒæ˜¯ä¸ºäº†æä¾›ä¸€ç§ç›´æ¥çš„æ–¹å¼è®©æ‚¨é‡æ–°å®‰è£… pip ï¼Œä¾‹å¦‚ï¼Œå¦‚æœæ‚¨åœ¨å®‰è£… Python æ—¶è·³è¿‡å®ƒæˆ–åœ¨æŸä¸ªæ—¶å€™å¸è½½äº† pip ã€‚åœ¨ä¸‹é¢é€‰æ‹©æ‚¨çš„æ“ä½œç³»ç»Ÿå¹¶ç›¸åº”åœ°è¿è¡Œ ensurepip ï¼š\nWindowsï¼š\nC:\\\u0026gt; python -m ensurepip --upgrade Linux + macOSï¼š\n$ python3 -m ensurepip --upgrade å¦‚æœå°šæœªå®‰è£… pip ï¼Œåˆ™æ­¤å‘½ä»¤ä¼šå°†å…¶å®‰è£…åœ¨æ‚¨å½“å‰çš„ Python ç¯å¢ƒä¸­ã€‚å¦‚æœæ‚¨å¤„äºæ´»åŠ¨çš„è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œåˆ™è¯¥å‘½ä»¤ä¼šå°† pip å®‰è£…åˆ°è¯¥ç¯å¢ƒä¸­ã€‚å¦åˆ™ï¼Œå®ƒä¼šåœ¨æ‚¨çš„ç³»ç»Ÿä¸Šå…¨å±€å®‰è£… pip ã€‚ --upgrade é€‰é¡¹ç¡®ä¿ pip ç‰ˆæœ¬ä¸ ensurepip ä¸­å£°æ˜çš„ç‰ˆæœ¬ç›¸åŒã€‚\næ³¨æ„ï¼š ensurepip æ¨¡å—ä¸è®¿é—®äº’è”ç½‘ã€‚ ensurepip å¯ä»¥å®‰è£…çš„æœ€æ–°ç‰ˆæœ¬çš„ pip æ˜¯æ†ç»‘åœ¨æ‚¨ç¯å¢ƒçš„ Python å®‰è£…ä¸­çš„ç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ Python 3.10.0 è¿è¡Œ ensurepip å°†å®‰è£… pip 21.2.3ã€‚å¦‚æœä½ æƒ³è¦æ›´æ–°çš„ pip ç‰ˆæœ¬ï¼Œé‚£ä¹ˆä½ éœ€è¦å…ˆè¿è¡Œ ensurepip ã€‚ä¹‹åï¼Œæ‚¨å¯ä»¥æ‰‹åŠ¨å°† pip æ›´æ–°åˆ°å…¶æœ€æ–°ç‰ˆæœ¬ã€‚\nä¿®å¤ pip å®‰è£…çš„å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ get-pip.py è„šæœ¬ã€‚ get-pip.py æ–‡ä»¶åŒ…å«ä½œä¸ºç¼–ç  ZIP æ–‡ä»¶çš„ pip çš„å®Œæ•´å‰¯æœ¬ã€‚æ‚¨å¯ä»¥ç›´æ¥ä» PyPA å¼•å¯¼é¡µé¢ä¸‹è½½ get-pip.py ã€‚ä¸€æ—¦ä½ çš„æœºå™¨ä¸Šæœ‰äº†è„šæœ¬ï¼Œä½ å°±å¯ä»¥åƒè¿™æ ·è¿è¡Œ Python è„šæœ¬ï¼š\nWindowsï¼š\nC:\\\u0026gt; python get-pip.py Linux + macOSï¼š\n$ python3 get-pip.py æ­¤è„šæœ¬å°†åœ¨æ‚¨å½“å‰çš„ Python ç¯å¢ƒä¸­å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ pip ã€ setuptools å’Œ wheel ã€‚å¦‚æœåªæƒ³å®‰è£… pip ï¼Œåˆ™å¯ä»¥å°† --no-setuptools å’Œ --no-wheel é€‰é¡¹æ·»åŠ åˆ°å‘½ä»¤ä¸­ã€‚\nå¦‚æœä¸Šè¿°æ–¹æ³•éƒ½ä¸èµ·ä½œç”¨ï¼Œé‚£ä¹ˆå¯èƒ½å€¼å¾—å°è¯•ä¸ºæ‚¨å½“å‰çš„å¹³å°ä¸‹è½½æœ€æ–°çš„ Python ç‰ˆæœ¬ã€‚æ‚¨å¯ä»¥æŒ‰ç…§ Python 3 å®‰è£…å’Œè®¾ç½®æŒ‡å—æ¥ç¡®ä¿ pip å·²æ­£ç¡®å®‰è£…å¹¶ä¸”å¯ä»¥æ­£å¸¸å·¥ä½œã€‚\nä½¿ç”¨ pip å®‰è£…åŒ… Python è¢«è®¤ä¸ºæ˜¯ä¸€ç§åŒ…å«ç”µæ± çš„è¯­è¨€ã€‚è¿™æ„å‘³ç€ Python æ ‡å‡†åº“åŒ…å«ä¸€ç»„å¹¿æ³›çš„åŒ…å’Œæ¨¡å—æ¥å¸®åŠ©å¼€å‘äººå‘˜å®Œæˆä»–ä»¬çš„ç¼–ç é¡¹ç›®ã€‚\nåŒæ—¶ï¼ŒPython æœ‰ä¸€ä¸ªæ´»è·ƒçš„ç¤¾åŒºï¼Œå®ƒè´¡çŒ®äº†æ›´å¹¿æ³›çš„åŒ…é›†ï¼Œå¯ä»¥å¸®åŠ©æ‚¨æ»¡è¶³æ‚¨çš„å¼€å‘éœ€æ±‚ã€‚è¿™äº›åŒ…å‘å¸ƒåˆ° Python åŒ…ç´¢å¼•ï¼Œä¹Ÿç§°ä¸º PyPIï¼ˆå‘éŸ³ä¸º Pie Pea Eyeï¼‰ã€‚\næ³¨æ„ï¼šå½“ä½ å®‰è£…ç¬¬ä¸‰æ–¹åŒ…æ—¶ï¼Œä½ å¿…é¡»å°å¿ƒã€‚æŸ¥çœ‹å¦‚ä½•è¯„ä¼° Python åŒ…çš„è´¨é‡ä»¥è·å¾—ç¡®ä¿æ‚¨çš„åŒ…å€¼å¾—ä¿¡èµ–çš„å®Œæ•´æŒ‡å—ã€‚\nPyPI æ‹¥æœ‰å¹¿æ³›çš„åŒ…é›†åˆï¼ŒåŒ…æ‹¬å¼€å‘æ¡†æ¶ã€å·¥å…·å’Œåº“ã€‚å…¶ä¸­è®¸å¤šåŒ…éƒ½ä¸º Python æ ‡å‡†åº“çš„åŠŸèƒ½æä¾›äº†å‹å¥½çš„æ¥å£ã€‚\nä½¿ç”¨ Python åŒ…ç´¢å¼• (PyPI) PyPI æ‰˜ç®¡çš„ä¼—å¤šåŒ…ä¹‹ä¸€ç§°ä¸º requests ã€‚ requests åº“é€šè¿‡æŠ½è±¡åŒ– HTTP è¯·æ±‚çš„å¤æ‚æ€§æ¥å¸®åŠ©æ‚¨ä¸ Web æœåŠ¡äº¤äº’ã€‚æ‚¨å¯ä»¥åœ¨å…¶å®˜æ–¹æ–‡æ¡£ç«™ç‚¹ä¸Šäº†è§£æœ‰å…³ requests çš„æ‰€æœ‰ä¿¡æ¯ã€‚\nå½“ä½ æƒ³åœ¨ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨ requests åŒ…æ—¶ï¼Œä½ å¿…é¡»å…ˆå°†å®ƒå®‰è£…åˆ°ä½ çš„ç¯å¢ƒä¸­ã€‚å¦‚æœä½ ä¸æƒ³æŠŠå®ƒå®‰è£…åœ¨ä½ çš„ç³»ç»Ÿ Python site-packages ä¸­ï¼Œé‚£ä¹ˆä½ å¯ä»¥å…ˆåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒï¼Œå¦‚ä¸Šæ‰€ç¤ºã€‚\nåˆ›å»ºè™šæ‹Ÿç¯å¢ƒå¹¶æ¿€æ´»å®ƒåï¼Œå‘½ä»¤è¡Œæç¤ºç¬¦ä¼šåœ¨æ‹¬å·å†…æ˜¾ç¤ºè™šæ‹Ÿç¯å¢ƒçš„åç§°ã€‚æ‚¨ä»ç°åœ¨å¼€å§‹æ‰§è¡Œçš„ä»»ä½• pip å‘½ä»¤éƒ½å°†åœ¨æ‚¨çš„è™šæ‹Ÿç¯å¢ƒä¸­æ‰§è¡Œã€‚\nè¦å®‰è£…åŒ…ï¼Œ pip æä¾›äº†ä¸€ä¸ª install å‘½ä»¤ã€‚æ‚¨å¯ä»¥è¿è¡Œå®ƒæ¥å®‰è£… requests åŒ…ï¼š\nWindowsï¼š\n(venv) C:\\\u0026gt; python -m pip install requests Linux + macOSï¼š\n(venv) $ python3 -m pip install requests åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ‚¨è¿è¡Œ pip å’Œ install å‘½ä»¤ï¼Œåè·Ÿè¦å®‰è£…çš„åŒ…çš„åç§°ã€‚ pip å‘½ä»¤åœ¨ PyPI ä¸­æŸ¥æ‰¾åŒ…ï¼Œè§£æå…¶ä¾èµ–å…³ç³»ï¼Œå¹¶åœ¨å½“å‰ Python ç¯å¢ƒä¸­å®‰è£…æ‰€æœ‰å†…å®¹ï¼Œä»¥ç¡®ä¿ requests èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚\npip install \u0026lt;package\u0026gt; å‘½ä»¤æ€»æ˜¯å¯»æ‰¾æœ€æ–°ç‰ˆæœ¬çš„åŒ…å¹¶å®‰è£…å®ƒã€‚å®ƒè¿˜æœç´¢åŒ…å…ƒæ•°æ®ä¸­åˆ—å‡ºçš„ä¾èµ–é¡¹å¹¶å®‰è£…å®ƒä»¬ä»¥ç¡®ä¿åŒ…å…·æœ‰æ‰€éœ€çš„æ‰€æœ‰è¦æ±‚ã€‚\nä¹Ÿå¯ä»¥åœ¨ä¸€ä¸ªå‘½ä»¤ä¸­å®‰è£…å¤šä¸ªåŒ…ï¼š\nWindowsï¼š\n(venv) C:\\\u0026gt; python -m pip install rptree codetiming Linux + macOSï¼š\n(venv) $ python3 -m pip install rptree codetiming é€šè¿‡åœ¨ pip install å‘½ä»¤ä¸­é“¾æ¥åŒ… rptree å’Œ codetiming ï¼Œæ‚¨å¯ä»¥åŒæ—¶å®‰è£…è¿™ä¸¤ä¸ªåŒ…ã€‚æ‚¨å¯ä»¥å‘ pip install å‘½ä»¤æ·»åŠ ä»»æ„æ•°é‡çš„åŒ…ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ requirements.txt æ–‡ä»¶å¯ä»¥æ´¾ä¸Šç”¨åœºã€‚åœ¨æœ¬æ•™ç¨‹çš„åé¢ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ requirements.txt æ–‡ä»¶ä¸€æ¬¡å®‰è£…å¤šä¸ªåŒ…ã€‚\næ³¨æ„ï¼šé™¤éåŒ…çš„ç‰¹å®šç‰ˆæœ¬å·ä¸æœ¬æ•™ç¨‹ç›¸å…³ï¼Œå¦åˆ™æ‚¨ä¼šæ³¨æ„åˆ°ç‰ˆæœ¬å­—ç¬¦ä¸²é‡‡ç”¨é€šç”¨å½¢å¼ x.y.z ã€‚è¿™æ˜¯ä¸€ç§å ä½ç¬¦æ ¼å¼ï¼Œå¯ä»¥ä»£è¡¨ 3.1.4 ã€ 2.9 æˆ–ä»»ä½•å…¶ä»–ç‰ˆæœ¬å·ã€‚å½“æ‚¨ç»§ç»­æ“ä½œæ—¶ï¼Œç»ˆç«¯ä¸­çš„è¾“å‡ºå°†æ˜¾ç¤ºæ‚¨çš„å®é™…åŒ…ç‰ˆæœ¬å·ã€‚\næ‚¨å¯ä»¥ä½¿ç”¨ list å‘½ä»¤æ˜¾ç¤ºç¯å¢ƒä¸­å®‰è£…çš„åŒ…åŠå…¶ç‰ˆæœ¬å·ï¼š\nWindowsï¼š\n(venv) C:\\\u0026gt; python -m pip list Package Version ------------------ --------- certifi x.y.z charset-normalizer x.y.z codetiming x.y.z idna x.y.z pip x.y.z requests x.y.z rptree x.y.z setuptools x.y.z urllib3 x.y.z Linux + macOSï¼š\n(venv) $ python3 -m pip list Package Version ------------------ --------- certifi x.y.z charset-normalizer x.y.z idna x.y.z pip x.y.z requests x.y.z setuptools x.y.z urllib3 x.y.z pip list å‘½ä»¤å‘ˆç°ä¸€ä¸ªè¡¨æ ¼ï¼Œæ˜¾ç¤ºå½“å‰ç¯å¢ƒä¸­æ‰€æœ‰å·²å®‰è£…çš„åŒ…ã€‚ä¸Šé¢çš„è¾“å‡ºæ˜¾ç¤ºäº†ä½¿ç”¨ x.y.z å ä½ç¬¦æ ¼å¼çš„åŒ…çš„ç‰ˆæœ¬ã€‚å½“æ‚¨åœ¨æ‚¨çš„ç¯å¢ƒä¸­è¿è¡Œ pip list å‘½ä»¤æ—¶ï¼Œ pip ä¼šæ˜¾ç¤ºæ‚¨ä¸ºæ¯ä¸ªåŒ…å®‰è£…çš„ç‰¹å®šç‰ˆæœ¬å·ã€‚\nç°åœ¨æ‚¨å·²ç»å®‰è£…äº† requests åŠå…¶ä¾èµ–é¡¹ï¼Œæ‚¨å¯ä»¥åƒå¯¼å…¥ Python ä»£ç ä¸­çš„ä»»ä½•å…¶ä»–å¸¸è§„åŒ…ä¸€æ ·å¯¼å…¥å®ƒã€‚å¯åŠ¨äº¤äº’å¼ Python è§£é‡Šå™¨å¹¶å¯¼å…¥ requests åŒ…ï¼š\n\u0026gt;\u0026gt;\u0026gt; import requests \u0026gt;\u0026gt;\u0026gt; requests.__version__ \u0026#34;x.y.z\u0026#34; å¯åŠ¨äº¤äº’å¼ Python è§£é‡Šå™¨åï¼Œæ‚¨å¯¼å…¥äº† requests æ¨¡å—ã€‚é€šè¿‡è°ƒç”¨ requests.__version__ ï¼Œæ‚¨éªŒè¯äº†æ‚¨åœ¨è™šæ‹Ÿç¯å¢ƒä¸­ä½¿ç”¨äº† requests æ¨¡å—ã€‚\nä½¿ç”¨è‡ªå®šä¹‰åŒ…ç´¢å¼• é»˜è®¤æƒ…å†µä¸‹ï¼Œ pip ä½¿ç”¨ PyPI æ¥æŸ¥æ‰¾åŒ…ã€‚ä½† pip è¿˜ä¸ºæ‚¨æä¾›äº†å®šä¹‰è‡ªå®šä¹‰åŒ…ç´¢å¼•çš„é€‰é¡¹ã€‚\nå½“ PyPI åŸŸåœ¨æ‚¨çš„ç½‘ç»œä¸Šè¢«é˜»æ­¢æˆ–è€…å¦‚æœæ‚¨æƒ³è¦ä½¿ç”¨éå…¬å¼€å¯ç”¨çš„åŒ…æ—¶ï¼Œå°† pip ä¸è‡ªå®šä¹‰ç´¢å¼•ä¸€èµ·ä½¿ç”¨ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚\næœ‰æ—¶ç³»ç»Ÿç®¡ç†å‘˜è¿˜åˆ›å»ºè‡ªå·±çš„å†…éƒ¨åŒ…ç´¢å¼•ï¼Œä»¥æ›´å¥½åœ°æ§åˆ¶å“ªäº›åŒ…ç‰ˆæœ¬å¯ä¾›å…¬å¸ç½‘ç»œä¸Šçš„ pip ç”¨æˆ·ä½¿ç”¨ã€‚\nè‡ªå®šä¹‰åŒ…ç´¢å¼•å¿…é¡»ç¬¦åˆ PEP 503 â€“ ç®€å•å­˜å‚¨åº“ API æ‰èƒ½ä¸ pip ä¸€èµ·ä½¿ç”¨ã€‚æ‚¨å¯ä»¥é€šè¿‡è®¿é—® PyPI ç®€å•ç´¢å¼•äº†è§£è¿™æ ·ä¸€ä¸ª APIï¼ˆåº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼‰çš„å¤–è§‚â€”â€”ä½†è¯·æ³¨æ„ï¼Œè¿™æ˜¯ä¸€ä¸ªåŒ…å«å¤§é‡éš¾ä»¥è§£æå†…å®¹çš„å¤§é¡µé¢ã€‚ä»»ä½•éµå¾ªç›¸åŒ API çš„è‡ªå®šä¹‰ç´¢å¼•éƒ½å¯ä»¥ä½¿ç”¨ --index-url é€‰é¡¹ä½œä¸ºç›®æ ‡ã€‚é™¤äº†è¾“å…¥ --index-url ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨ -i é€Ÿè®°ã€‚\nä¾‹å¦‚ï¼Œè¦ä» TestPyPI åŒ…ç´¢å¼•å®‰è£… rptree å·¥å…·ï¼Œæ‚¨å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\nWindowsï¼š\n(venv) C:\\\u0026gt; python -m pip install -i https://test.pypi.org/simple/ rptree Linux + macOSï¼š\n(venv) $ python3 -m pip install -i https://test.pypi.org/simple/ rptree ä½¿ç”¨ -i é€‰é¡¹ï¼Œæ‚¨å‘Šè¯‰ pip æŸ¥çœ‹ä¸åŒçš„åŒ…ç´¢å¼•è€Œä¸æ˜¯é»˜è®¤çš„ PyPIã€‚åœ¨è¿™é‡Œï¼Œæ‚¨ä» TestPyPI è€Œä¸æ˜¯ PyPI å®‰è£… rptree ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ TestPyPI å¾®è°ƒ Python åŒ…çš„å‘å¸ƒè¿‡ç¨‹ï¼Œè€Œä¸ä¼šå¼„ä¹± PyPI ä¸Šçš„ç”Ÿäº§åŒ…ç´¢å¼•ã€‚\nå¦‚æœéœ€è¦æ°¸ä¹…ä½¿ç”¨æ›¿ä»£ç´¢å¼•ï¼Œåˆ™å¯ä»¥åœ¨ pip é…ç½®æ–‡ä»¶ä¸­è®¾ç½® index-url é€‰é¡¹ã€‚è¯¥æ–‡ä»¶åä¸º pip.conf ï¼Œæ‚¨å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ‰¾åˆ°å®ƒçš„ä½ç½®ï¼š\nWindowsï¼š\n(venv) C:\\\u0026gt; python -m pip config list -vv Linux + macOSï¼š\n(venv) $ python3 -m pip config list -vv ä½¿ç”¨ pip config list å‘½ä»¤ï¼Œæ‚¨å¯ä»¥åˆ—å‡ºæ´»åŠ¨é…ç½®ã€‚å½“æ‚¨è®¾ç½®äº†è‡ªå®šä¹‰é…ç½®æ—¶ï¼Œæ­¤å‘½ä»¤ä»…è¾“å‡ºä¸€äº›å†…å®¹ã€‚å¦åˆ™ï¼Œè¾“å‡ºä¸ºç©ºã€‚è¿™å°±æ˜¯åŠ æ³• --verbose æˆ– -vv é€‰é¡¹ä¼šæœ‰æ‰€å¸®åŠ©çš„æ—¶å€™ã€‚æ·»åŠ  -vv æ—¶ï¼Œ pip ä¼šå‘æ‚¨æ˜¾ç¤ºå®ƒåœ¨ä½•å¤„æŸ¥æ‰¾ä¸åŒçš„é…ç½®çº§åˆ«ã€‚\nå¦‚æœè¦æ·»åŠ  pip.conf æ–‡ä»¶ï¼Œåˆ™å¯ä»¥é€‰æ‹© pip config list -vv åˆ—å‡ºçš„ä½ç½®ä¹‹ä¸€ã€‚å¸¦æœ‰è‡ªå®šä¹‰åŒ…ç´¢å¼•çš„ pip.conf æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š\n# pip.conf [global] index-url = https://test.pypi.org/simple/ å½“ä½ æœ‰ä¸€ä¸ªè¿™æ ·çš„ pip.conf æ–‡ä»¶æ—¶ï¼Œ pip å°†ä½¿ç”¨å®šä¹‰çš„ index-url æ¥æŸ¥æ‰¾åŒ…ã€‚ä½¿ç”¨æ­¤é…ç½®ï¼Œæ‚¨æ— éœ€åœ¨ pip install å‘½ä»¤ä¸­ä½¿ç”¨ --index-url é€‰é¡¹æ¥æŒ‡å®šæ‚¨åªéœ€è¦å¯ä»¥åœ¨ TestPyPI çš„ç®€å• API ä¸­æ‰¾åˆ°çš„åŒ…ã€‚\nä» GitHub å­˜å‚¨åº“å®‰è£…åŒ… æ‚¨ä¸é™äºæ‰˜ç®¡åœ¨ PyPI æˆ–å…¶ä»–åŒ…ç´¢å¼•ä¸Šçš„åŒ…ã€‚ pip è¿˜æä¾›äº†ä» GitHub å­˜å‚¨åº“å®‰è£…åŒ…çš„é€‰é¡¹ã€‚ä½†å³ä½¿åŒ…æ‰˜ç®¡åœ¨ PyPI ä¸Šï¼Œå¦‚ Real Python ç›®å½•æ ‘ç”Ÿæˆå™¨ï¼Œæ‚¨ä¹Ÿå¯ä»¥é€‰æ‹©ä»å…¶ Git å­˜å‚¨åº“å®‰è£…å®ƒï¼š\nWindowsï¼š\n(venv) C:\\\u0026gt; python -m pip install git+https://github.com/realpython/rptree Linux + macOSï¼š\n(venv) $ python3 -m pip install git+https://github.com/realpython/rptree ä½¿ç”¨ git+https æ–¹æ¡ˆï¼Œæ‚¨å¯ä»¥æŒ‡å‘åŒ…å«å¯å®‰è£…åŒ…çš„ Git å­˜å‚¨åº“ã€‚æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œäº¤äº’å¼ Python è§£é‡Šå™¨å¹¶å¯¼å…¥ rptree æ¥éªŒè¯æ‚¨æ˜¯å¦æ­£ç¡®å®‰è£…äº†åŒ…ï¼š\n\u0026gt;\u0026gt;\u0026gt; import rptree \u0026gt;\u0026gt;\u0026gt; rptree.__version__ \u0026#34;x.y.z\u0026#34; å¯åŠ¨äº¤äº’å¼ Python è§£é‡Šå™¨åï¼Œå¯¼å…¥ rptree æ¨¡å—ã€‚é€šè¿‡è°ƒç”¨ rptree.__version__ ï¼Œæ‚¨å¯ä»¥éªŒè¯æ‚¨æ­£åœ¨ä½¿ç”¨åŸºäºè™šæ‹Ÿç¯å¢ƒçš„ rptree æ¨¡å—ã€‚\næ³¨æ„ï¼šå¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Git ä»¥å¤–çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ (VCS)ï¼Œ pip å¯ä»¥æ»¡è¶³æ‚¨çš„è¦æ±‚ã€‚è¦äº†è§£å¦‚ä½•å°† pip ä¸ Mercurialã€Subversion æˆ– Bazaar ä¸€èµ·ä½¿ç”¨ï¼Œè¯·æŸ¥çœ‹ pip æ–‡æ¡£çš„ VCS æ”¯æŒç« èŠ‚ã€‚\nå¦‚æœåŒ…æœªæ‰˜ç®¡åœ¨ PyPI ä¸Šä½†å…·æœ‰è¿œç¨‹ Git å­˜å‚¨åº“ï¼Œåˆ™ä» Git å­˜å‚¨åº“å®‰è£…åŒ…ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚æ‚¨æŒ‡å‘ pip çš„è¿œç¨‹å­˜å‚¨åº“ç”šè‡³å¯ä»¥æ‰˜ç®¡åœ¨æ‚¨å…¬å¸å†…éƒ¨ç½‘ä¸Šçš„å†…éƒ¨ Git æœåŠ¡å™¨ä¸Šã€‚å½“æ‚¨ä½äºé˜²ç«å¢™åé¢æˆ–å¯¹æ‚¨çš„ Python é¡¹ç›®æœ‰å…¶ä»–é™åˆ¶æ—¶ï¼Œè¿™ä¼šå¾ˆæœ‰ç”¨ã€‚\nä»¥å¯ç¼–è¾‘æ¨¡å¼å®‰è£…åŒ…ä»¥ç®€åŒ–å¼€å‘ åœ¨æ‚¨è‡ªå·±çš„åŒ…ä¸Šå·¥ä½œæ—¶ï¼Œä»¥å¯ç¼–è¾‘æ¨¡å¼å®‰è£…å®ƒæ˜¯æœ‰æ„ä¹‰çš„ã€‚é€šè¿‡è¿™æ ·åšï¼Œæ‚¨å¯ä»¥åƒåœ¨ä»»ä½•å…¶ä»–åŒ…ä¸­ä¸€æ ·ä½¿ç”¨å‘½ä»¤è¡Œæ¥å¤„ç†æºä»£ç ã€‚å…¸å‹çš„å·¥ä½œæµç¨‹æ˜¯é¦–å…ˆå…‹éš†å­˜å‚¨åº“ï¼Œç„¶åä½¿ç”¨ pip å°†å…¶ä½œä¸ºå¯ç¼–è¾‘åŒ…å®‰è£…åœ¨æ‚¨çš„ç¯å¢ƒä¸­ï¼š\nWindowsï¼š\nC:\\\u0026gt; git clone https://github.com/realpython/rptree C:\\\u0026gt; cd rptree C:\\rptree\u0026gt; python3 -m venv venv C:\\rptree\u0026gt; venv\\Scripts\\activate.bat (venv) C:\\rptree\u0026gt; python -m pip install -e . Linux + macOSï¼š\n$ git clone https://github.com/realpython/rptree $ cd rptree $ python3 -m venv venv $ source venv/bin/activate (venv) $ python3 -m pip install -e . ä½¿ç”¨ä¸Šé¢çš„å‘½ä»¤ï¼Œæ‚¨å°† rptree åŒ…å®‰è£…ä¸ºå¯ç¼–è¾‘æ¨¡å—ã€‚ä»¥ä¸‹æ˜¯æ‚¨åˆšåˆšæ‰§è¡Œçš„æ“ä½œçš„é€æ­¥ç»†åˆ†ï¼š\nç¬¬ 1 è¡Œå…‹éš†äº† rptree åŒ…çš„ Git å­˜å‚¨åº“ã€‚\nç¬¬ 2 è¡Œå°†å·¥ä½œç›®å½•æ›´æ”¹ä¸º rptree/ ã€‚\nç¬¬ 3 è¡Œå’Œç¬¬ 4 è¡Œåˆ›å»ºå¹¶æ¿€æ´»äº†ä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒã€‚\nç¬¬ 5 è¡Œå°†å½“å‰ç›®å½•çš„å†…å®¹å®‰è£…ä¸ºä¸€ä¸ªå¯ç¼–è¾‘çš„åŒ…ã€‚\n-e é€‰é¡¹æ˜¯ --editable é€‰é¡¹çš„ç®€å†™ã€‚å½“æ‚¨å°† -e é€‰é¡¹ä¸ pip install ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œæ‚¨å‘Šè¯‰ pip æ‚¨æƒ³è¦ä»¥å¯ç¼–è¾‘æ¨¡å¼å®‰è£…åŒ…ã€‚æ‚¨ä¸ä½¿ç”¨åŒ…åç§°ï¼Œè€Œæ˜¯ä½¿ç”¨ç‚¹ ( . ) å°† pip æŒ‡å‘å½“å‰ç›®å½•ã€‚\nå¦‚æœæ‚¨æ²¡æœ‰ä½¿ç”¨ -e æ ‡å¿—ï¼Œ pip ä¼šæ­£å¸¸å°†åŒ…å®‰è£…åˆ°æ‚¨ç¯å¢ƒçš„ site-packages/ æ–‡ä»¶å¤¹ä¸­ã€‚å½“æ‚¨ä»¥å¯ç¼–è¾‘æ¨¡å¼å®‰è£…åŒ…æ—¶ï¼Œæ‚¨å°†åœ¨ç«™ç‚¹åŒ…ä¸­åˆ›å»ºä¸€ä¸ªæŒ‡å‘æœ¬åœ°é¡¹ç›®è·¯å¾„çš„é“¾æ¥ï¼š\n~/rptree/venv/lib/python3.10/site-packages/rptree.egg-link ä½¿ç”¨å¸¦æœ‰ -e æ ‡å¿—çš„ pip install å‘½ä»¤åªæ˜¯ pip install æä¾›çš„ä¼—å¤šé€‰é¡¹ä¹‹ä¸€ã€‚æ‚¨å¯ä»¥æŸ¥çœ‹ pip æ–‡æ¡£ä¸­çš„ pip install ç¤ºä¾‹ã€‚åœ¨é‚£é‡Œï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•å®‰è£…åŒ…çš„ç‰¹å®šç‰ˆæœ¬æˆ–å°† pip æŒ‡å‘é PyPI çš„ä¸åŒç´¢å¼•ã€‚\nåœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæ‚¨å°†äº†è§£éœ€æ±‚æ–‡ä»¶å¦‚ä½•å¸®åŠ©æ‚¨å®Œæˆ pip å·¥ä½œæµã€‚\nä½¿ç”¨éœ€æ±‚æ–‡ä»¶ pip install å‘½ä»¤å§‹ç»ˆå®‰è£…åŒ…çš„æœ€æ–°å‘å¸ƒç‰ˆæœ¬ï¼Œä½†æœ‰æ—¶æ‚¨çš„ä»£ç éœ€è¦ç‰¹å®šçš„åŒ…ç‰ˆæœ¬æ‰èƒ½æ­£å¸¸å·¥ä½œã€‚\næ‚¨æƒ³è¦åˆ›å»ºç”¨äºå¼€å‘å’Œæµ‹è¯•åº”ç”¨ç¨‹åºçš„ä¾èµ–é¡¹å’Œç‰ˆæœ¬çš„è§„èŒƒï¼Œä»¥ä¾¿åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨è¯¥åº”ç”¨ç¨‹åºæ—¶ä¸ä¼šå‡ºç°æ„å¤–ã€‚\nå›ºå®šéœ€æ±‚ å½“æ‚¨ä¸å…¶ä»–å¼€å‘äººå‘˜å…±äº«æ‚¨çš„ Python é¡¹ç›®æ—¶ï¼Œæ‚¨å¯èƒ½å¸Œæœ›ä»–ä»¬ä½¿ç”¨æ‚¨æ­£åœ¨ä½¿ç”¨çš„ç›¸åŒç‰ˆæœ¬çš„å¤–éƒ¨åŒ…ã€‚\nä¹Ÿè®¸æŸä¸ªç‰¹å®šç‰ˆæœ¬çš„è½¯ä»¶åŒ…åŒ…å«æ‚¨æ‰€ä¾èµ–çš„æ–°åŠŸèƒ½ï¼Œæˆ–è€…æ‚¨æ­£åœ¨ä½¿ç”¨çš„è½¯ä»¶åŒ…ç‰ˆæœ¬ä¸ä»¥å‰çš„ç‰ˆæœ¬ä¸å…¼å®¹ã€‚\nè¿™äº›å¤–éƒ¨ä¾èµ–é¡¹ä¹Ÿç§°ä¸ºéœ€æ±‚ã€‚æ‚¨ç»å¸¸ä¼šå‘ç° Python é¡¹ç›®å°†å…¶éœ€æ±‚å›ºå®šåœ¨åä¸º requirements.txt æˆ–ç±»ä¼¼æ–‡ä»¶çš„æ–‡ä»¶ä¸­ã€‚éœ€æ±‚æ–‡ä»¶æ ¼å¼å…è®¸æ‚¨ç²¾ç¡®æŒ‡å®šåº”å®‰è£…å“ªäº›åŒ…å’Œç‰ˆæœ¬ã€‚\nè¿è¡Œ pip help æ˜¾ç¤ºæœ‰ä¸€ä¸ª freeze å‘½ä»¤ä»¥éœ€æ±‚æ ¼å¼è¾“å‡ºå·²å®‰è£…çš„åŒ…ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ­¤å‘½ä»¤ï¼Œå°†è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶ä»¥ç”Ÿæˆéœ€æ±‚æ–‡ä»¶ï¼š\nWindowsï¼š\n(venv) C:\\\u0026gt; python -m pip freeze \u0026gt; requirements.txt Linux + macOSï¼š\n(venv) $ python3 -m pip freeze \u0026gt; requirements.txt æ­¤å‘½ä»¤åœ¨æ‚¨çš„å·¥ä½œç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª requirements.txt æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š\ncertifi==x.y.z charset-normalizer==x.y.z idna==x.y.z requests==x.y.z urllib3==x.y.z è¯·è®°ä½ï¼Œä¸Šé¢æ˜¾ç¤ºçš„ x.y.z æ˜¯åŒ…ç‰ˆæœ¬çš„å ä½ç¬¦æ ¼å¼ã€‚æ‚¨çš„ requirements.txt æ–‡ä»¶å°†åŒ…å«çœŸå®çš„ç‰ˆæœ¬å·ã€‚\nfreeze å‘½ä»¤å°†å½“å‰å®‰è£…çš„åŒ…çš„åç§°å’Œç‰ˆæœ¬è½¬å‚¨åˆ°æ ‡å‡†è¾“å‡ºã€‚æ‚¨å¯ä»¥å°†è¾“å‡ºé‡å®šå‘åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œç¨åæ‚¨å¯ä»¥ä½¿ç”¨è¯¥æ–‡ä»¶å°†æ‚¨çš„ç¡®åˆ‡è¦æ±‚å®‰è£…åˆ°å¦ä¸€ä¸ªç³»ç»Ÿä¸­ã€‚æ‚¨å¯ä»¥éšæ„å‘½åéœ€æ±‚æ–‡ä»¶ã€‚\nä½†æ˜¯ï¼Œå¹¿æ³›é‡‡ç”¨çš„çº¦å®šæ˜¯å°†å…¶å‘½åä¸º requirements.txt ã€‚\nå½“ä½ æƒ³åœ¨å¦ä¸€ä¸ªç³»ç»Ÿä¸­å¤åˆ¶ç¯å¢ƒæ—¶ï¼Œä½ å¯ä»¥è¿è¡Œ pip install ï¼Œä½¿ç”¨ -r å¼€å…³æ¥æŒ‡å®šéœ€æ±‚æ–‡ä»¶ï¼š\nWindowsï¼š\n(venv) C:\\\u0026gt; python -m pip install -r requirements.txt Linux + macOSï¼š\n(venv) $ python3 -m pip install -r requirements.txt åœ¨ä¸Šé¢çš„å‘½ä»¤ä¸­ï¼Œæ‚¨å‘Šè¯‰ pip å°† requirements.txt ä¸­åˆ—å‡ºçš„åŒ…å®‰è£…åˆ°æ‚¨å½“å‰çš„ç¯å¢ƒä¸­ã€‚åŒ…ç‰ˆæœ¬å°†åŒ¹é… requirements.txt æ–‡ä»¶åŒ…å«çš„ç‰ˆæœ¬çº¦æŸã€‚æ‚¨å¯ä»¥è¿è¡Œ pip list æ¥æ˜¾ç¤ºæ‚¨åˆšåˆšå®‰è£…çš„åŒ…åŠå…¶ç‰ˆæœ¬å·ï¼š\nWindowsï¼š\n(venv) C:\\\u0026gt; python -m pip list Package Version ------------------ --------- certifi x.y.z charset-normalizer x.y.z idna x.y.z pip x.y.z requests x.y.z setuptools x.y.z urllib3 x.y.z Linux + macOSï¼š\n(venv) $ python3 -m pip list Package Version ------------------ --------- certifi x.y.z charset-normalizer x.y.z idna x.y.z pip x.y.z requests x.y.z setuptools x.y.z urllib3 x.y.z ç°åœ¨æ‚¨å¯ä»¥åˆ†äº«æ‚¨çš„é¡¹ç›®äº†ï¼æ‚¨å¯ä»¥å°† requirements.txt æäº¤åˆ°åƒ Git è¿™æ ·çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­ï¼Œå¹¶ä½¿ç”¨å®ƒåœ¨å…¶ä»–æœºå™¨ä¸Šå¤åˆ¶ç›¸åŒçš„ç¯å¢ƒã€‚ä½†æ˜¯ç­‰ç­‰ï¼Œå¦‚æœä¸ºè¿™äº›è½¯ä»¶åŒ…å‘å¸ƒæ–°çš„æ›´æ–°ä¼šæ€æ ·ï¼Ÿ\nå¾®è°ƒéœ€æ±‚ å¯¹åŒ…çš„ç‰ˆæœ¬å’Œä¾èµ–é¡¹è¿›è¡Œç¡¬ç¼–ç çš„é—®é¢˜åœ¨äºï¼ŒåŒ…ä¼šç»å¸¸æ›´æ–°é”™è¯¯å’Œå®‰å…¨ä¿®å¤ç¨‹åºã€‚æ‚¨å¯èƒ½å¸Œæœ›åœ¨æ›´æ–°å‘å¸ƒåç«‹å³åˆ©ç”¨è¿™äº›æ›´æ–°ã€‚\néœ€æ±‚æ–‡ä»¶æ ¼å¼å…è®¸æ‚¨ä½¿ç”¨æ¯”è¾ƒè¿ç®—ç¬¦æŒ‡å®šä¾èµ–é¡¹ç‰ˆæœ¬ï¼Œè¿™ä¸ºæ‚¨æä¾›äº†ä¸€äº›çµæ´»æ€§ï¼Œä»¥ç¡®ä¿æ›´æ–°åŒ…ï¼ŒåŒæ—¶ä»ç„¶å®šä¹‰åŒ…çš„åŸºæœ¬ç‰ˆæœ¬ã€‚\nåœ¨æ‚¨å–œæ¬¢çš„ç¼–è¾‘å™¨ä¸­æ‰“å¼€ requirements.txt ï¼Œå¹¶å°†ç›¸ç­‰è¿ç®—ç¬¦ ( == ) è½¬æ¢ä¸ºå¤§äºæˆ–ç­‰äºè¿ç®—ç¬¦ ( \u0026gt;= )ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š\n# requirements.txt certifi\u0026gt;=x.y.z charset-normalizer\u0026gt;=x.y.z idna\u0026gt;=x.y.z requests\u0026gt;=x.y.z urllib3\u0026gt;=x.y.z æ‚¨å¯ä»¥å°†æ¯”è¾ƒè¿ç®—ç¬¦æ›´æ”¹ä¸º \u0026gt;= ä»¥å‘ŠçŸ¥ pip å®‰è£…å·²å‘å¸ƒçš„ç²¾ç¡®æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚å½“æ‚¨ä½¿ç”¨ requirements.txt æ–‡ä»¶è®¾ç½®æ–°ç¯å¢ƒæ—¶ï¼Œ pip ä¼šæŸ¥æ‰¾æ»¡è¶³è¦æ±‚çš„æœ€æ–°ç‰ˆæœ¬å¹¶è¿›è¡Œå®‰è£…ã€‚\næ¥ä¸‹æ¥ï¼Œæ‚¨å¯ä»¥é€šè¿‡è¿è¡Œå¸¦æœ‰ --upgrade å¼€å…³æˆ– -U ç®€å†™çš„ install å‘½ä»¤æ¥å‡çº§éœ€æ±‚æ–‡ä»¶ä¸­çš„åŒ…ï¼š\nWindowsï¼š\n(venv) C:\\\u0026gt; python -m pip install -U -r requirements.txt Linux + macOSï¼š\n(venv) $ python3 -m pip install -U -r requirements.txt å¦‚æœåˆ—å‡ºçš„è½¯ä»¶åŒ…æœ‰æ–°ç‰ˆæœ¬å¯ç”¨ï¼Œåˆ™è¯¥è½¯ä»¶åŒ…å°†è¢«å‡çº§ã€‚\nåœ¨ç†æƒ³çš„ä¸–ç•Œä¸­ï¼Œæ–°ç‰ˆæœ¬çš„åŒ…å°†å‘åå…¼å®¹å¹¶ä¸”æ°¸è¿œä¸ä¼šå¼•å…¥æ–°çš„é”™è¯¯ã€‚ä¸å¹¸çš„æ˜¯ï¼Œæ–°ç‰ˆæœ¬å¯èƒ½ä¼šå¼•å…¥ä¼šç ´åæ‚¨çš„åº”ç”¨ç¨‹åºçš„æ›´æ”¹ã€‚ä¸ºäº†å¾®è°ƒæ‚¨çš„éœ€æ±‚ï¼Œéœ€æ±‚æ–‡ä»¶è¯­æ³•æ”¯æŒé¢å¤–çš„ç‰ˆæœ¬è¯´æ˜ç¬¦ã€‚\næƒ³è±¡ä¸€ä¸‹ï¼Œ requests çš„æ–°ç‰ˆæœ¬ 3.0 å·²å‘å¸ƒï¼Œä½†å¼•å…¥äº†ç ´ååº”ç”¨ç¨‹åºçš„ä¸å…¼å®¹æ›´æ”¹ã€‚æ‚¨å¯ä»¥ä¿®æ”¹éœ€æ±‚æ–‡ä»¶ä»¥é˜²æ­¢å®‰è£… 3.0 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼š\n# requirements.txt certifi==x.y.z charset-normalizer==x.y.z idna==x.y.z requests\u0026gt;=x.y.z, \u0026lt;3.0 urllib3==x.y.z æ›´æ”¹ requests åŒ…çš„ç‰ˆæœ¬è¯´æ˜ç¬¦å¯ç¡®ä¿ä¸ä¼šå®‰è£…ä»»ä½•å¤§äºæˆ–ç­‰äº 3.0 çš„ç‰ˆæœ¬ã€‚ pip æ–‡æ¡£æä¾›äº†æœ‰å…³éœ€æ±‚æ–‡ä»¶æ ¼å¼çš„å¤§é‡ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥æŸ¥é˜…å®ƒä»¥äº†è§£æ›´å¤šä¿¡æ¯ã€‚\nåˆ†ç¦»ç”Ÿäº§å’Œå¼€å‘ä¾èµ– å¹¶éæ‚¨åœ¨åº”ç”¨ç¨‹åºå¼€å‘æœŸé—´å®‰è£…çš„æ‰€æœ‰åŒ…éƒ½æ˜¯ç”Ÿäº§ä¾èµ–é¡¹ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½æƒ³è¦æµ‹è¯•æ‚¨çš„åº”ç”¨ç¨‹åºï¼Œå› æ­¤æ‚¨éœ€è¦ä¸€ä¸ªæµ‹è¯•æ¡†æ¶ã€‚ä¸€ä¸ªæµè¡Œçš„æµ‹è¯•æ¡†æ¶æ˜¯ pytest ã€‚ä½ æƒ³åœ¨å¼€å‘ç¯å¢ƒä¸­å®‰è£…å®ƒï¼Œä½†ä¸æƒ³åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å®‰è£…å®ƒï¼Œå› ä¸ºå®ƒä¸æ˜¯ç”Ÿäº§ä¾èµ–é¡¹ã€‚\næ‚¨åˆ›å»ºç¬¬äºŒä¸ªéœ€æ±‚æ–‡ä»¶ requirements_dev.txt ï¼Œä»¥åˆ—å‡ºç”¨äºè®¾ç½®å¼€å‘ç¯å¢ƒçš„å…¶ä»–å·¥å…·ï¼š\n# requirements_dev.txt pytest\u0026gt;=x.y.z æ‹¥æœ‰ä¸¤ä¸ªéœ€æ±‚æ–‡ä»¶å°†è¦æ±‚æ‚¨ä½¿ç”¨ pip æ¥å®‰è£…å®ƒä»¬ï¼Œ requirements.txt å’Œ requirements_dev.txt ã€‚å¹¸è¿çš„æ˜¯ï¼Œ pip å…è®¸æ‚¨åœ¨éœ€æ±‚æ–‡ä»¶ä¸­æŒ‡å®šå…¶ä»–å‚æ•°ï¼Œå› æ­¤æ‚¨å¯ä»¥ä¿®æ”¹ requirements_dev.txt ä»¥åŒæ—¶å®‰è£…æ¥è‡ªç”Ÿäº§ç¯å¢ƒçš„ requirements.txt æ–‡ä»¶ä¸­çš„éœ€æ±‚ï¼š\n# requirements_dev.txt -r requirements.txt pytest\u0026gt;=x.y.z è¯·æ³¨æ„ï¼Œæ‚¨ä½¿ç”¨ç›¸åŒçš„ -r å¼€å…³æ¥å®‰è£…ç”Ÿäº§ requirements.txt æ–‡ä»¶ã€‚ç°åœ¨ï¼Œåœ¨æ‚¨çš„å¼€å‘ç¯å¢ƒä¸­ï¼Œæ‚¨åªéœ€è¿è¡Œè¿™æ¡å‘½ä»¤å³å¯å®‰è£…æ‰€æœ‰è¦æ±‚ï¼š\nWindowsï¼š\n(venv) C:\\\u0026gt; python -m pip install -r requirements_dev.txt Linux + macOSï¼š\n(venv) $ python3 -m pip install -r requirements_dev.txt å› ä¸º requirements_dev.txt åŒ…å« -r requirements.txt è¡Œï¼Œæ‰€ä»¥æ‚¨ä¸ä»…è¦å®‰è£… pytest ï¼Œè¿˜è¦å®‰è£… requirements.txt çš„å›ºå®šè¦æ±‚ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä»…å®‰è£…ç”Ÿäº§è¦æ±‚å°±è¶³å¤Ÿäº†ï¼š\nWindowsï¼š\n(venv) C:\\\u0026gt; python -m pip install -r requirements.txt Linux + macOSï¼š\n(venv) $ python3 -m pip install -r requirements.txt ä½¿ç”¨æ­¤å‘½ä»¤ï¼Œæ‚¨å¯ä»¥å®‰è£… requirements.txt ä¸­åˆ—å‡ºçš„è¦æ±‚ã€‚ä¸æ‚¨çš„å¼€å‘ç¯å¢ƒç›¸æ¯”ï¼Œæ‚¨çš„ç”Ÿäº§ç¯å¢ƒä¸ä¼šå®‰è£… pytest ã€‚\nä¸ºç”Ÿäº§ç¯å¢ƒå†·å†»éœ€æ±‚ æ‚¨åˆ›å»ºäº†ç”Ÿäº§å’Œå¼€å‘éœ€æ±‚æ–‡ä»¶å¹¶å°†å®ƒä»¬æ·»åŠ åˆ°æºä»£ç ç®¡ç†ä¸­ã€‚è¿™äº›æ–‡ä»¶ä½¿ç”¨çµæ´»çš„ç‰ˆæœ¬è¯´æ˜ç¬¦æ¥ç¡®ä¿æ‚¨åˆ©ç”¨ä¾èµ–é¡¹å‘å¸ƒçš„é”™è¯¯ä¿®å¤ã€‚\næ‚¨è¿˜æµ‹è¯•äº†æ‚¨çš„åº”ç”¨ç¨‹åºï¼Œç°åœ¨å¯ä»¥å°†å…¶éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­äº†ã€‚\næ‚¨çŸ¥é“æ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡äº†å¹¶ä¸”åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨æ‚¨åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨çš„ä¾èµ–é¡¹ï¼Œå› æ­¤æ‚¨å¯èƒ½å¸Œæœ›ç¡®ä¿å°†ç›¸åŒç‰ˆæœ¬çš„ä¾èµ–é¡¹éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ã€‚\nå½“å‰çš„ç‰ˆæœ¬è¯´æ˜ç¬¦ä¸èƒ½ä¿è¯å°†ç›¸åŒçš„ç‰ˆæœ¬éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå› æ­¤æ‚¨å¸Œæœ›åœ¨å‘å¸ƒé¡¹ç›®ä¹‹å‰å†»ç»“ç”Ÿäº§éœ€æ±‚ã€‚\næ ¹æ®å½“å‰éœ€æ±‚å®Œæˆå¼€å‘åï¼Œåˆ›å»ºå½“å‰é¡¹ç›®æ–°ç‰ˆæœ¬çš„å·¥ä½œæµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š\nStep Command Explanation 1 pytest è¿è¡Œæ‚¨çš„æµ‹è¯•å¹¶éªŒè¯æ‚¨çš„ä»£ç æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚ 2 pip install -U -r requirements.txt å°†æ‚¨çš„è¦æ±‚å‡çº§åˆ°ä¸ requirements.txt æ–‡ä»¶ä¸­çš„çº¦æŸç›¸åŒ¹é…çš„ç‰ˆæœ¬ã€‚ 3 pytest è¿è¡Œæ‚¨çš„æµ‹è¯•å¹¶è€ƒè™‘é™çº§ä»»ä½•å‘æ‚¨çš„ä»£ç å¼•å…¥é”™è¯¯çš„ä¾èµ–é¡¹ã€‚ 4 pip freeze \u0026gt; requirements_lock.txt é¡¹ç›®æ­£å¸¸è¿è¡Œåï¼Œå°†ä¾èµ–é¡¹å†»ç»“åˆ° requirements_lock.txt æ–‡ä»¶ä¸­ã€‚ ä½¿ç”¨è¿™æ ·çš„å·¥ä½œæµç¨‹ï¼Œ requirements_lock.txt æ–‡ä»¶å°†åŒ…å«å‡†ç¡®çš„ç‰ˆæœ¬è¯´æ˜ç¬¦ï¼Œå¯ç”¨äºå¤åˆ¶æ‚¨çš„ç¯å¢ƒã€‚æ‚¨å·²ç¡®ä¿å½“æ‚¨çš„ç”¨æˆ·å°† requirements_lock.txt ä¸­åˆ—å‡ºçš„è½¯ä»¶åŒ…å®‰è£…åˆ°ä»–ä»¬è‡ªå·±çš„ç¯å¢ƒä¸­æ—¶ï¼Œä»–ä»¬å°†ä½¿ç”¨æ‚¨å¸Œæœ›ä»–ä»¬ä½¿ç”¨çš„ç‰ˆæœ¬ã€‚\nå†»ç»“æ‚¨çš„éœ€æ±‚æ˜¯ç¡®ä¿æ‚¨çš„ Python é¡¹ç›®åœ¨æ‚¨çš„ç”¨æˆ·ç¯å¢ƒä¸­ä»¥ä¸åœ¨æ‚¨çš„ç¯å¢ƒä¸­ç›¸åŒçš„æ–¹å¼å·¥ä½œçš„é‡è¦æ­¥éª¤ã€‚\nä½¿ç”¨ pip å¸è½½è½¯ä»¶åŒ… æœ‰æ—¶ï¼Œæ‚¨å¿…é¡»å¸è½½ä¸€ä¸ªåŒ…ã€‚è¦ä¹ˆä½ æ‰¾åˆ°äº†ä¸€ä¸ªæ›´å¥½çš„åº“æ¥æ›¿æ¢å®ƒï¼Œè¦ä¹ˆå®ƒæ˜¯ä½ ä¸éœ€è¦çš„ä¸œè¥¿ã€‚å¸è½½è½¯ä»¶åŒ…å¯èƒ½æœ‰ç‚¹æ£˜æ‰‹ã€‚\nè¯·æ³¨æ„ï¼Œå½“æ‚¨å®‰è£… requests æ—¶ï¼Œæ‚¨ä¹Ÿè·å¾—äº† pip æ¥å®‰è£…å…¶ä»–ä¾èµ–é¡¹ã€‚å®‰è£…çš„åŒ…è¶Šå¤šï¼Œå¤šä¸ªåŒ…ä¾èµ–ç›¸åŒä¾èµ–é¡¹çš„å¯èƒ½æ€§å°±è¶Šå¤§ã€‚è¿™å°±æ˜¯ pip ä¸­çš„ show å‘½ä»¤æ´¾ä¸Šç”¨åœºçš„åœ°æ–¹ã€‚\nåœ¨å¸è½½åŒ…ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä¸ºè¯¥åŒ…è¿è¡Œ show å‘½ä»¤ï¼š\nWindowsï¼š\n(venv) C:\\\u0026gt; python -m pip show requests Name: requests Version: 2.26.0 Summary: Python HTTP for Humans. Home-page: https://requests.readthedocs.io Author: Kenneth Reitz Author-email: me@kennethreitz.org License: Apache 2.0 Location: .../python3.9/site-packages Requires: certifi, idna, charset-normalizer, urllib3 Required-by: Linux + macOSï¼š\n(venv) $ python3 -m pip show requests Name: requests Version: 2.26.0 Summary: Python HTTP for Humans. Home-page: https://requests.readthedocs.io Author: Kenneth Reitz Author-email: me@kennethreitz.org License: Apache 2.0 Location: .../python3.9/site-packages Requires: certifi, idna, charset-normalizer, urllib3 Required-by: æ³¨æ„æœ€åä¸¤ä¸ªå­—æ®µï¼Œ Requires å’Œ Required-by ã€‚ show å‘½ä»¤å‘Šè¯‰æ‚¨ requests éœ€è¦ certifi ã€ idna ã€ charset-normalizer å’Œ urllib3 ã€‚æ‚¨å¯èƒ½ä¹Ÿæƒ³å¸è½½å®ƒä»¬ã€‚è¯·æ³¨æ„ï¼Œ requests ä¸æ˜¯ä»»ä½•å…¶ä»–åŒ…æ‰€å¿…éœ€çš„ã€‚æ‰€ä»¥å¸è½½å®ƒæ˜¯å®‰å…¨çš„ã€‚\næ‚¨åº”è¯¥é’ˆå¯¹æ‰€æœ‰ requests ä¾èµ–é¡¹è¿è¡Œ show å‘½ä»¤ï¼Œä»¥ç¡®ä¿æ²¡æœ‰å…¶ä»–åº“ä¹Ÿä¾èµ–äºå®ƒä»¬ã€‚ä¸€æ—¦äº†è§£äº†è¦å¸è½½çš„åŒ…çš„ä¾èµ–é¡ºåºï¼Œå°±å¯ä»¥ä½¿ç”¨ uninstall å‘½ä»¤åˆ é™¤å®ƒä»¬ï¼š\nWindowsï¼š\n(venv) C:\\\u0026gt; python -m pip uninstall certifi Linux + macOSï¼š\n(venv) $ python3 -m pip uninstall certifi uninstall å‘½ä»¤æ˜¾ç¤ºå°†è¦åˆ é™¤çš„æ–‡ä»¶å¹¶è¦æ±‚ç¡®è®¤ã€‚å¦‚æœæ‚¨ç¡®å®šè¦åˆ é™¤è¯¥åŒ…ï¼Œå› ä¸ºæ‚¨å·²ç»æ£€æŸ¥äº†å®ƒçš„ä¾èµ–å…³ç³»å¹¶ä¸”çŸ¥é“æ²¡æœ‰å…¶ä»–ä¸œè¥¿åœ¨ä½¿ç”¨å®ƒï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥ä¼ é€’ä¸€ä¸ª -y å¼€å…³æ¥æŠ‘åˆ¶æ–‡ä»¶åˆ—è¡¨å’Œç¡®è®¤å¯¹è¯æ¡†ï¼š\nWindowsï¼š\n(venv) C:\\\u0026gt; python -m pip uninstall certifi -y Linux + macOSï¼š\n(venv) $ python3 -m pip uninstall certifi -y è¿™é‡Œå¸è½½ urllib3 ã€‚ä½¿ç”¨ -y å¼€å…³ï¼Œæ‚¨å¯ä»¥å–æ¶ˆè¯¢é—®æ‚¨æ˜¯å¦è¦å¸è½½æ­¤åŒ…çš„ç¡®è®¤å¯¹è¯æ¡†ã€‚\nåœ¨ä¸€æ¬¡è°ƒç”¨ä¸­ï¼Œæ‚¨å¯ä»¥æŒ‡å®šè¦å¸è½½çš„æ‰€æœ‰åŒ…ï¼š\nWindowsï¼š\n(venv) C:\\\u0026gt; python -m pip uninstall -y charset-normalizer idna requests Linux + macOSï¼š\n(venv) $ python3 -m pip uninstall -y charset-normalizer idna requests æ‚¨å¯ä»¥å°†å¤šä¸ªåŒ…ä¼ é€’ç»™ pip uninstall å‘½ä»¤ã€‚å¦‚æœæ‚¨æ²¡æœ‰æ·»åŠ ä»»ä½•é¢å¤–çš„å¼€å…³ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦ç¡®è®¤å¸è½½æ¯ä¸ªåŒ…ã€‚é€šè¿‡ -y å¼€å…³ï¼Œæ‚¨å¯ä»¥åœ¨æ²¡æœ‰ä»»ä½•ç¡®è®¤å¯¹è¯æ¡†çš„æƒ…å†µä¸‹å°†å®ƒä»¬å…¨éƒ¨å¸è½½ã€‚\næ‚¨è¿˜å¯ä»¥é€šè¿‡æä¾› -r \u0026lt;requirements file\u0026gt; é€‰é¡¹æ¥å¸è½½éœ€æ±‚æ–‡ä»¶ä¸­åˆ—å‡ºçš„æ‰€æœ‰åŒ…ã€‚æ­¤å‘½ä»¤å°†æç¤ºå¯¹æ¯ä¸ªåŒ…çš„ç¡®è®¤è¯·æ±‚ï¼Œä½†æ‚¨å¯ä»¥ä½¿ç”¨ -y å¼€å…³æŠ‘åˆ¶å®ƒï¼š\nWindowsï¼š\n(venv) C:\\\u0026gt; python -m pip uninstall -r requirements.txt -y Linux + macOSï¼š\n(venv) $ python3 -m pip uninstall -r requirements.txt -y è¯·è®°ä½å§‹ç»ˆæ£€æŸ¥è¦å¸è½½çš„è½¯ä»¶åŒ…çš„ä¾èµ–é¡¹ã€‚æ‚¨å¯èƒ½æƒ³å¸è½½æ‰€æœ‰ä¾èµ–é¡¹ï¼Œä½†å¸è½½å…¶ä»–äººä½¿ç”¨çš„åŒ…ä¼šç ´åæ‚¨çš„å·¥ä½œç¯å¢ƒã€‚å› æ­¤ï¼Œæ‚¨çš„é¡¹ç›®å¯èƒ½æ— æ³•å†æ­£å¸¸å·¥ä½œã€‚\nå¦‚æœæ‚¨åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å·¥ä½œï¼Œé‚£ä¹ˆåˆ›å»ºä¸€ä¸ªæ–°çš„è™šæ‹Ÿç¯å¢ƒå¯èƒ½ä¼šæ›´çœåŠ›ã€‚ç„¶åä½ å¯ä»¥å®‰è£…ä½ éœ€è¦çš„åŒ…è€Œä¸æ˜¯å°è¯•å¸è½½ä½ ä¸éœ€è¦çš„åŒ…ã€‚ä½†æ˜¯ï¼Œå½“æ‚¨éœ€è¦ä»ç³»ç»Ÿ Python å®‰è£…ä¸­å¸è½½åŒ…æ—¶ï¼Œ pip uninstall ä¼šéå¸¸æœ‰ç”¨ã€‚å¦‚æœæ‚¨ä¸å°å¿ƒåœ¨ç³»ç»ŸèŒƒå›´å†…å®‰è£…äº†è½¯ä»¶åŒ…ï¼Œä½¿ç”¨ pip uninstall æ˜¯æ•´ç†ç³»ç»Ÿçš„å¥½æ–¹æ³•ã€‚\næ¢ç´¢ pip çš„æ›¿ä»£å“ Python ç¤¾åŒºæä¾›äº†å‡ºè‰²çš„å·¥å…·å’Œåº“ï¼Œä¾›æ‚¨åœ¨ pip ä¹‹å¤–ä½¿ç”¨ã€‚è¿™äº›åŒ…æ‹¬å°è¯•ç®€åŒ–å’Œæ”¹è¿›åŒ…ç®¡ç†çš„ pip çš„æ›¿ä»£æ–¹æ¡ˆã€‚\nä»¥ä¸‹æ˜¯ä¸€äº›å¯ç”¨äº Python çš„å…¶ä»–åŒ…ç®¡ç†å·¥å…·ï¼š\nTool Description Conda Conda æ˜¯è®¸å¤šè¯­è¨€ï¼ˆåŒ…æ‹¬ Pythonï¼‰çš„åŒ…ã€ä¾èµ–é¡¹å’Œç¯å¢ƒç®¡ç†å™¨ã€‚å®ƒæ¥è‡ª Anacondaï¼ŒAnaconda æœ€åˆæ˜¯ Python çš„æ•°æ®ç§‘å­¦åŒ…ã€‚å› æ­¤ï¼Œå®ƒè¢«å¹¿æ³›ç”¨äºæ•°æ®ç§‘å­¦å’Œæœºå™¨å­¦ä¹ åº”ç”¨ç¨‹åºã€‚ Conda è¿è¡Œè‡ªå·±çš„ç´¢å¼•æ¥æ‰˜ç®¡å…¼å®¹åŒ…ã€‚ Poetry å¦‚æœæ‚¨æ¥è‡ª JavaScript å’Œ npmï¼ŒPoetry å¯¹æ‚¨æ¥è¯´ä¼šéå¸¸ç†Ÿæ‚‰ã€‚ Poetry è¶…è¶Šäº†åŒ…ç®¡ç†ï¼Œå¸®åŠ©æ‚¨ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºå’Œåº“æ„å»ºåˆ†å‘å¹¶å°†å®ƒä»¬éƒ¨ç½²åˆ° PyPIã€‚ Pipenv Pipenv æ˜¯å¦ä¸€ä¸ªåŒ…ç®¡ç†å·¥å…·ï¼Œå®ƒå°†è™šæ‹Ÿç¯å¢ƒå’ŒåŒ…ç®¡ç†åˆå¹¶åˆ°ä¸€ä¸ªå·¥å…·ä¸­ã€‚ Pipenvï¼šæ–° Python æ‰“åŒ…å·¥å…·æŒ‡å—æ˜¯å¼€å§‹å­¦ä¹  Pipenv åŠå…¶åŒ…ç®¡ç†æ–¹æ³•çš„å¥½åœ°æ–¹ã€‚ åªæœ‰ pip æ†ç»‘åœ¨æ ‡å‡† Python å®‰è£…ä¸­ã€‚å¦‚æœæ‚¨æƒ³ä½¿ç”¨ä¸Šé¢åˆ—å‡ºçš„ä»»ä½•æ›¿ä»£æ–¹æ¡ˆï¼Œåˆ™å¿…é¡»æŒ‰ç…§å…¶æ–‡æ¡£ä¸­çš„å®‰è£…æŒ‡å—è¿›è¡Œæ“ä½œã€‚æœ‰è¿™ä¹ˆå¤šé€‰é¡¹ï¼Œæ‚¨ä¸€å®šä¼šæ‰¾åˆ°é€‚åˆæ‚¨çš„ç¼–ç¨‹ä¹‹æ—…çš„å·¥å…·ï¼\nç»“è®º è®¸å¤š Python é¡¹ç›®ä½¿ç”¨ pip åŒ…ç®¡ç†å™¨æ¥ç®¡ç†å®ƒä»¬çš„ä¾èµ–é¡¹ã€‚å®ƒåŒ…å«åœ¨ Python å®‰è£…ç¨‹åºä¸­ï¼Œæ˜¯ Python ä¸­ä¾èµ–ç®¡ç†çš„é‡è¦å·¥å…·ã€‚\nåœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å­¦ä¹ äº†å¦‚ä½•ï¼š\nåœ¨æ‚¨çš„å·¥ä½œç¯å¢ƒä¸­è®¾ç½®å¹¶è¿è¡Œ pip ä¿®å¤ä¸ä½¿ç”¨ pip ç›¸å…³çš„å¸¸è§é”™è¯¯ ä½¿ç”¨ pip å®‰è£…å’Œå¸è½½åŒ… å®šä¹‰é¡¹ç›®å’Œåº”ç”¨ç¨‹åºçš„è¦æ±‚ åœ¨éœ€æ±‚æ–‡ä»¶ä¸­å›ºå®šä¾èµ–é¡¹ æ­¤å¤–ï¼Œæ‚¨è¿˜äº†è§£äº†ä½¿ä¾èµ–é¡¹ä¿æŒæœ€æ–°çš„é‡è¦æ€§ä»¥åŠå¯ä»¥å¸®åŠ©æ‚¨ç®¡ç†è¿™äº›ä¾èµ–é¡¹çš„ pip çš„æ›¿ä»£æ–¹æ³•ã€‚\né€šè¿‡ä»”ç»†æŸ¥çœ‹ pip ï¼Œæ‚¨å·²ç»æ¢ç´¢äº† Python å¼€å‘å·¥ä½œæµä¸­çš„ä¸€ä¸ªåŸºæœ¬å·¥å…·ã€‚ä½¿ç”¨ pip ï¼Œæ‚¨å¯ä»¥å®‰è£…å’Œç®¡ç†æ‚¨åœ¨ PyPI ä¸Šæ‰¾åˆ°çš„ä»»ä½•å…¶ä»–åŒ…ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ¥è‡ªå…¶ä»–å¼€å‘äººå‘˜çš„å¤–éƒ¨åŒ…ä½œä¸ºéœ€æ±‚ï¼Œå¹¶ä¸“æ³¨äºä½¿æ‚¨çš„é¡¹ç›®ç‹¬ä¸€æ— äºŒçš„ä»£ç ã€‚\nåŸæ–‡é“¾æ¥ï¼šhttps://realpython.com/what-is-pip\n","permalink":"https://blog.chensoul.cc/posts/2023/06/01/what-is-pip/","summary":"Python çš„æ ‡å‡†åŒ…ç®¡ç†å™¨æ˜¯ pip ã€‚å®ƒå…è®¸æ‚¨å®‰è£…å’Œç®¡ç†ä¸å±äº Python æ ‡å‡†åº“çš„åŒ…ã€‚å¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾ pip çš„ä»‹ç»ï¼Œé‚£ä¹ˆæ‚¨æ¥å¯¹åœ°æ–¹äº†ï¼\nåœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•ï¼š\nåœ¨æ‚¨çš„å·¥ä½œç¯å¢ƒä¸­è®¾ç½® pip ä¿®å¤ä¸ä½¿ç”¨ pip ç›¸å…³çš„å¸¸è§é”™è¯¯ ä½¿ç”¨ pip å®‰è£…å’Œå¸è½½åŒ… ä½¿ç”¨éœ€æ±‚æ–‡ä»¶ç®¡ç†é¡¹ç›®çš„ä¾èµ–å…³ç³» pip å¯ä»¥åšå¾ˆå¤šäº‹æƒ…ï¼Œä½†æ˜¯ Python ç¤¾åŒºéå¸¸æ´»è·ƒï¼Œå·²ç»åˆ›å»ºäº†ä¸€äº› pip çš„å·§å¦™æ›¿ä»£å“ã€‚æ‚¨å°†åœ¨æœ¬æ•™ç¨‹çš„åé¢éƒ¨åˆ†äº†è§£è¿™äº›å†…å®¹ã€‚\nä» pip å¼€å§‹ é‚£ä¹ˆï¼Œpip å…·ä½“æ˜¯åšä»€ä¹ˆçš„å‘¢ï¼Ÿ pip æ˜¯ Python çš„åŒ…ç®¡ç†å™¨ã€‚è¿™æ„å‘³ç€å®ƒæ˜¯ä¸€ä¸ªå…è®¸æ‚¨å®‰è£…å’Œç®¡ç†æœªä½œä¸ºæ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†åˆ†å‘çš„åº“å’Œä¾èµ–é¡¹çš„å·¥å…·ã€‚ pip è¿™ä¸ªåå­—æ˜¯ç”± Ian Bicking åœ¨ 2008 å¹´å¼•å…¥çš„ï¼š\næˆ‘å·²ç»å°† pyinstall é‡å‘½åä¸ºæ–°åç§°ï¼špipã€‚pip æ˜¯ pip install package é¦–å­—æ¯ç¼©å†™ã€‚ ï¼ˆ æ¥æºï¼‰\nåŒ…ç®¡ç†éå¸¸é‡è¦ï¼ŒPython çš„å®‰è£…ç¨‹åºä» 3.4 ç‰ˆå’Œ 2.7.9 ç‰ˆå¼€å§‹åˆ†åˆ«ä¸º Python 3 å’Œ Python 2 åŒ…å«äº† pip ã€‚è®¸å¤š Python é¡¹ç›®éƒ½ä½¿ç”¨ pip ï¼Œè¿™ä½¿å®ƒæˆä¸ºæ¯ä¸ª Pythonista çš„å¿…å¤‡å·¥å…·ã€‚\nå¦‚æœæ‚¨æ¥è‡ªå¦ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œæ‚¨å¯èƒ½ä¼šç†Ÿæ‚‰åŒ…ç®¡ç†å™¨çš„æ¦‚å¿µã€‚ JavaScript ä½¿ç”¨ npm è¿›è¡ŒåŒ…ç®¡ç†ï¼ŒRuby ä½¿ç”¨ gemï¼Œ.NET å¹³å°ä½¿ç”¨ NuGetã€‚åœ¨ Python ä¸­ï¼Œ pip å·²æˆä¸ºæ ‡å‡†åŒ…ç®¡ç†å™¨ã€‚\nåœ¨æ‚¨çš„ç³»ç»Ÿä¸ŠæŸ¥æ‰¾ pip Python 3 å®‰è£…ç¨‹åºä¸ºæ‚¨æä¾›äº†åœ¨ç³»ç»Ÿä¸Šå®‰è£… Python æ—¶å®‰è£… pip çš„é€‰é¡¹ã€‚äº‹å®ä¸Šï¼Œ pip ä¸ Python ä¸€èµ·å®‰è£…çš„é€‰é¡¹é»˜è®¤æ˜¯å‹¾é€‰çš„ï¼Œæ‰€ä»¥ pip åº”è¯¥åœ¨å®‰è£…å®Œ Python ä¹‹åå°±å¯ä»¥ä½¿ç”¨äº†ã€‚","title":"[è¯‘]ä½¿ç”¨ Python çš„ pip ç®¡ç†é¡¹ç›®çš„ä¾èµ–å…³ç³»"},{"content":"å‰è¨€ å…¬å¸ä»·å€¼è§‚ æœ¬ç¯‡æ˜¯å¯¹ 2023-05-22 åˆ° 2023-05-28 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nå‘¨ä¸€ï¼Œä¼‘äº§å‡çš„äº§å“ç»ç†å›æ¥ä¸Šç­ï¼Œå¾—çŸ¥å¥¹è¢«ä¼˜åŒ–ä¹‹åï¼Œå†…å¿ƒæœ‰äº›ä¸èˆå’Œä¼¤æ„Ÿã€‚ä¸­åˆï¼Œç»„é•¿è¯·å¤§å®¶ä¸€èµ·åƒäº†é¥­ã€‚æ™šä¸Šï¼Œäº§å“ç»ç†äº¤å‰²å®ŒåŠå…¬ç”¨æˆ·ä¹‹åï¼Œå°±æ²¡æ¥ä¸Šç­äº†ã€‚è‡ªæ­¤ï¼Œè¿‡å®Œå¹´åï¼Œå…¬å¸è‡³å°‘æœ‰ä¸‰ä½å¥³åŒäº‹ä¿®å®Œäº§å‡ä¹‹åå°±ç¦»èŒäº†ï¼Œæœ‰çš„æ˜¯ä¸»åŠ¨ï¼Œæ›´å¤šçš„åº”è¯¥æ˜¯è¢«åŠ¨ã€‚è™½ç„¶æœ‰ N+1 èµ”å¿ï¼Œä½†æ˜¯ï¼Œè¿™ä¸ªç¤¾ä¼šå¯¹å¥³æ€§è¿˜æ˜¯ä¸å¤Ÿå…¬å¹³ã€‚\nè¿˜æœ‰ 3 ä¸ªæœˆå°±è¦åˆ°ç«¯åˆèŠ‚ï¼Œè€å©†ä¹°äº†ç²½å¶åŒ…ç²½å­ï¼Œæˆ‘ä¹ŸåŠ¨æ‰‹åŒ…äº†ä¸€éƒ¨åˆ†ã€‚è™½ç„¶åŒ…çš„ä¸å¥½çœ‹ï¼Œä½†å¿ƒé‡Œè¿˜æ˜¯å¾ˆæ»¡è¶³çš„ã€‚è‡ªå·±åŒ…çš„ç²½å­é€èŠ‚ï¼Œæ˜¾ç„¶æ›´æœ‰æ„ä¹‰ã€‚ç»“å©šä¹‹åçš„ç¬¬ä¸€ä¸ªç«¯åˆèŠ‚ï¼Œå‘¨æœ«å¼€è½¦å»ç»™é•¿è¾ˆé€äº†ç«¯åˆèŠ‚ã€‚çœ‹ç€é•¿è¾ˆä»¬çš„å¤´å‘æ—¥æ¸æ–‘ç™½ï¼Œä¸ç¦æ„Ÿå¹å²æœˆæ— æƒ…ã€‚è¶ç€å¹´è½»çš„æ—¶å€™ï¼Œè¦å¯¹èº«è¾¹çš„äº²äººå¥½ä¸€äº›ã€‚ä¸è¦ç­‰åˆ°æ¥ä¸åŠäº†æ‰çŸ¥é“åæ‚”ã€‚\nè¿™å‘¨åœ¨ docker é‡Œéƒ¨ç½²äº† Plausible ï¼Œä½¿ç”¨è¿‡ç¨‹ä¸­å‘ç° Plausible æ¶æ„è¿‡äºå¤æ‚ï¼Œä½¿ç”¨äº† postgres å’Œ clickhouse æ•°æ®åº“ï¼Œdocker-compose å¯åŠ¨äº† 4 ä¸ªå®¹å™¨ï¼Œæ‰€ä»¥æœ€åè¿˜æ˜¯æ”¾å¼ƒäº†ä½¿ç”¨ Plausibleã€‚umami çš„ postgres æ•°æ®åº“åªåŒ…æ‹¬å‡ å¼ è¡¨ï¼Œæ“ä½œèµ·æ¥æ¯”è¾ƒå®¹æ˜“ï¼Œæ¯”å¦‚ï¼šæ—¶ä¸æ—¶åœ°ï¼Œæˆ‘ä¼šæŠŠæ¥è‡ª localhost çš„è®¿é—®è®°å½•åˆ é™¤æ‰ï¼Œè¿™æ ·ç»Ÿè®¡æ•°æ®æ›´åŠ çœŸå®å‡†ç¡®ã€‚\nPython ä¹‹ç¦… è¿™æ˜¯æœ€è¿‘çš„ä¸€ä¸ª PyTricksï¼šåœ¨ python REPL é‡Œé¢è¾“å…¥ import this ä¼šè¾“å‡º The Zen of Python, by Tim Petersï¼š\nè‹±æ–‡ï¼š\nThe Zen of Python, by Tim Peters\nBeautiful is better than ugly.\nExplicit is better than implicit.\nSimple is better than complex.\nComplex is better than complicated.\nFlat is better than nested.\nSparse is better than dense.\nReadability counts.\nSpecial cases aren\u0026rsquo;t special enough to break the rules.\nAlthough practicality beats purity.\nErrors should never pass silently.\nUnless explicitly silenced.\nIn the face of ambiguity, refuse the temptation to guess.\nThere should be one\u0026ndash; and preferably only one \u0026ndash;obvious way to do it.\nAlthough that way may not be obvious at first unless you\u0026rsquo;re Dutch.\nNow is better than never.\nAlthough never is often better than right now.\nIf the implementation is hard to explain, it\u0026rsquo;s a bad idea.\nIf the implementation is easy to explain, it may be a good idea.\nNamespaces are one honking great idea \u0026ndash; let\u0026rsquo;s do more of those!\nä¸­æ–‡ï¼š\nPython ä¹‹ç¦…ï¼Œä½œè€…ä¸º Tim Peters\nç¾ä¸½èƒœäºä¸‘é™‹ã€‚\næ˜ç¡®èƒœäºå«è“„ã€‚\nç®€å•èƒœäºå¤æ‚ã€‚\nå¤æ‚èƒœäºç¹çã€‚\næ‰å¹³èƒœäºåµŒå¥—ã€‚\nå®½æ¾èƒœäºç´§å‡‘ã€‚\nå¯è¯»æ€§å¾ˆé‡è¦ã€‚\nç‰¹ä¾‹å¹¶ä¸è¶³ä»¥æ‰“ç ´è§„åˆ™ã€‚\nè™½ç„¶å®ç”¨æ€§ä¼˜å…ˆäºçº¯ç²¹æ€§ã€‚\né”™è¯¯ç»ä¸èƒ½æ‚„æ‚„åœ°é€šè¿‡ã€‚\né™¤éæ˜ç¡®åœ°æ²‰é»˜ã€‚\né¢å¯¹æ¨¡æ£±ä¸¤å¯ï¼Œæ‹’ç»çŒœæµ‹ã€‚\nåº”è¯¥æœ‰ä¸€ç§\u0026ndash; æœ€å¥½åªæœ‰ä¸€ç§ \u0026ndash;æ˜¾è€Œæ˜“è§çš„æ–¹æ³•æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚\nè™½ç„¶è¿™ç§æ–¹æ³•å¯èƒ½ä¸€å¼€å§‹å¹¶ä¸æ˜æ˜¾ï¼Œé™¤éä½ æ˜¯è·å…°äººã€‚\nç°åœ¨æ¯”æ°¸è¿œå¥½ã€‚\nè™½ç„¶æ°¸è¿œä¸å¦‚ ç°åœ¨å°±åš å¥½ã€‚\nå¦‚æœå®ç°å¾ˆéš¾è§£é‡Šï¼Œé‚£è¿™æ˜¯ä¸ªåä¸»æ„ã€‚\nå¦‚æœå®ç°å®¹æ˜“è§£é‡Šï¼Œé‚£å¯èƒ½æ˜¯ä¸ªå¥½ä¸»æ„ã€‚\nåç§°ç©ºé—´æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„æƒ³æ³• \u0026ndash; è®©æˆ‘ä»¬åšæ›´å¤šçš„è¿™æ ·çš„äº‹æƒ…ï¼\nPython ä¹‹ç¦…æ˜¯ä¸€ç»„ç¼–å†™ Python è¯­è¨€ç¨‹åºçš„æŒ‡å¯¼åŸåˆ™ï¼Œç”±è‘—å Python å¼€å‘è€… Tim Peters æ’°å†™è€Œæˆï¼Œè¿™äº›æ ¼è¨€åæ˜ äº† Python ç¤¾åŒºçš„å“²å­¦ã€‚\nç¬¬ä¸€åŸåˆ™â€œç¾ä¸½èƒœäºä¸‘é™‹â€å¼ºè°ƒç¼–å†™ç¾å­¦ä¸Šä»¤äººæ„‰æ‚¦ä¸”æ˜“äºé˜…è¯»çš„ä»£ç çš„é‡è¦æ€§ï¼ŒåŒ…æ‹¬ä½¿ç”¨é€‚å½“çš„ç¼©è¿›ã€å‘½åè§„èŒƒå’Œæ ¼å¼åŒ–ã€‚\nç¬¬äºŒåŸåˆ™â€œæ˜ç¡®èƒœäºå«è“„â€å¼ºè°ƒåœ¨ä»£ç ä¸­è¦æ¸…æ™°æ˜ç¡®ï¼Œé¿å…æ·å¾„å¹¶å°½å¯èƒ½å…·ä½“åœ°å®šä¹‰ä»£ç ã€‚\nç¬¬ä¸‰åŸåˆ™â€œç®€å•èƒœäºå¤æ‚â€å¼ºè°ƒç¼–å†™æ˜“äºç†è§£å’Œç»´æŠ¤çš„ä»£ç çš„é‡è¦æ€§ï¼ŒåŒ…æ‹¬é¿å…ä¸å¿…è¦çš„å¤æ‚æ€§å¹¶å°½å¯èƒ½ä½¿ç”¨ç®€å•çš„è§£å†³æ–¹æ¡ˆã€‚\nç¬¬å››åŸåˆ™â€œå¤æ‚èƒœäºç¹çâ€å¼ºè°ƒåœ¨å¿…è¦æ—¶ä½¿ç”¨å¤æ‚çš„è§£å†³æ–¹æ¡ˆï¼Œä½†é¿å…è¿‡åº¦å¤æ‚ã€‚\nç¬¬äº”åŸåˆ™â€œæ‰å¹³èƒœäºåµŒå¥—â€å¼ºè°ƒä¿æŒä»£ç ç®€å•ï¼Œé¿å…æ·±åº¦åµŒå¥—ç»“æ„ã€‚\nç¬¬å…­åŸåˆ™â€œå®½æ¾èƒœäºç´§å‡‘â€å¼ºè°ƒä½¿ç”¨ç©ºæ ¼å’Œæ ¼å¼åŒ–ä½¿ä»£ç æ›´æ˜“è¯»ã€‚\nç¬¬ä¸ƒåŸåˆ™â€œå¯è¯»æ€§å¾ˆé‡è¦â€å¼ºè°ƒç¼–å†™æ˜“äºé˜…è¯»å’Œç†è§£çš„ä»£ç çš„é‡è¦æ€§ã€‚\nç¬¬å…«åŸåˆ™â€œç‰¹ä¾‹å¹¶ä¸è¶³ä»¥æ‰“ç ´è§„åˆ™â€å¼ºè°ƒå³ä½¿åœ¨å¯èƒ½ä¼šåç¦»è§„åˆ™çš„æƒ…å†µä¸‹ï¼Œä¹Ÿè¦éµå¾ªæœ€ä½³å®è·µå’Œå·²æœ‰çº¦å®šã€‚\nç¬¬ä¹åŸåˆ™â€œè™½ç„¶å®ç”¨æ€§ä¼˜å…ˆäºçº¯ç²¹æ€§â€å¼ºè°ƒå¹³è¡¡å®ç”¨è€ƒè™‘ä¸å¯¹ä¼˜é›…å’Œçº¯ç²¹ä»£ç çš„æ¸´æœ›ã€‚\nç¬¬ååŸåˆ™â€œé”™è¯¯ç»ä¸èƒ½æ‚„æ‚„åœ°é€šè¿‡â€å¼ºè°ƒæ•æ‰å’Œå¤„ç†ä»£ç ä¸­çš„é”™è¯¯ï¼Œè€Œä¸æ˜¯å¿½ç•¥å®ƒä»¬ã€‚\nç¬¬åä¸€åŸåˆ™â€œé™¤éæ˜ç¡®åœ°æ²‰é»˜â€å¼ºè°ƒåœ¨é€‚å½“æƒ…å†µä¸‹å…è®¸æœ‰æ„åœ°æ¶ˆé™¤é”™è¯¯ä¿¡æ¯ã€‚\nç¬¬åäºŒåŸåˆ™â€œé¢å¯¹æ¨¡æ£±ä¸¤å¯ï¼Œæ‹’ç»çŒœæµ‹â€å¼ºè°ƒè¦åœ¨ä»£ç ä¸­æ¸…æ™°æ˜ç¡®ï¼Œå³ä½¿åœ¨å­˜åœ¨æ­§ä¹‰æˆ–ä¸ç¡®å®šæ€§çš„æƒ…å†µä¸‹ä¹Ÿè¦å¦‚æ­¤ã€‚\nç¬¬åä¸‰åŸåˆ™â€œåº”è¯¥æœ‰ä¸€ç§\u0026ndash; æœ€å¥½åªæœ‰ä¸€ç§ \u0026ndash;æ˜¾è€Œæ˜“è§çš„æ–¹æ³•æ¥åšåˆ°è¿™ä¸€ç‚¹â€å¼ºè°ƒéµå¾ªå·²æœ‰çš„çº¦å®šå’Œè§„èŒƒï¼Œé¿å…ä¸å¿…è¦çš„å¤æ‚æˆ–æ›²æŠ˜çš„è§£å†³æ–¹æ¡ˆã€‚\nç¬¬åå››åŸåˆ™â€œè™½ç„¶è¿™ç§æ–¹æ³•å¯èƒ½ä¸€å¼€å§‹å¹¶ä¸æ˜æ˜¾ï¼Œé™¤éä½ æ˜¯è·å…°äººâ€æ˜¯å¯¹ Python çš„åˆ›å»ºè€… Guido van Rossum æ˜¯è·å…°äººè¿™ä¸€äº‹å®çš„ç©å‘³æ€§è‡´æ•¬ã€‚\nç¬¬åäº”åŸåˆ™â€œç°åœ¨æ¯”æ°¸è¿œå¥½â€å¼ºè°ƒé‡‡å–è¡ŒåŠ¨å¹¶æ¨è¿›ä½ çš„ä»£ç ï¼Œè€Œä¸æ˜¯æ‹–å»¶æˆ–æ‹–æ²“ã€‚\nç¬¬åå…­åŸåˆ™â€œè™½ç„¶æ°¸è¿œä¸å¦‚ ç°åœ¨å°±åš å¥½â€å¼ºè°ƒè¦èŠ±æ—¶é—´ä»”ç»†è€ƒè™‘ä½ çš„ä»£ç ï¼Œé¿å…åŒ†å¿™è§£å†³å¯èƒ½ä¸æ˜¯æœ€ä¼˜è§£çš„é—®é¢˜ã€‚\nç¬¬åä¸ƒåŸåˆ™â€œå¦‚æœå®ç°å¾ˆéš¾è§£é‡Šï¼Œé‚£è¿™æ˜¯ä¸ªåä¸»æ„â€å¼ºè°ƒç¼–å†™æ˜“äºç†è§£å’Œè§£é‡Šç»™ä»–äººçš„ä»£ç çš„é‡è¦æ€§ã€‚\nç¬¬åå…«åŸåˆ™â€œå¦‚æœå®ç°å®¹æ˜“è§£é‡Šï¼Œé‚£å¯èƒ½æ˜¯ä¸ªå¥½ä¸»æ„â€å¼ºè°ƒç¼–å†™ç®€å•æ˜äº†ã€æ˜“äºè§£é‡Šçš„ä»£ç çš„é‡è¦æ€§ã€‚\nç¬¬åä¹åŸåˆ™â€œåç§°ç©ºé—´æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„æƒ³æ³• \u0026ndash; è®©æˆ‘ä»¬åšæ›´å¤šçš„è¿™æ ·çš„äº‹æƒ…ï¼â€å¼ºè°ƒä½¿ç”¨åç§°ç©ºé—´ä»¥æ¸…æ™°æ˜“æ‡‚çš„æ–¹å¼ç»„ç»‡å’Œç»“æ„åŒ–ä½ çš„ä»£ç ã€‚åç§°ç©ºé—´æœ‰åŠ©äºé¿å…å‘½åå†²çªï¼Œå¹¶ä½¿æŸ¥æ‰¾å’Œé‡ç”¨ä»£ç æ›´å®¹æ˜“ã€‚\nç†è´¢ è¿™å‘¨æ€»è®¡æ”¯å‡º 1939 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š\n5 æœˆ 28 æ—¥ï¼š1064 å…ƒï¼ŒåŠ æ²¹å……å€¼ 1000 å…ƒ 5 æœˆ 27 æ—¥ï¼š642 å…ƒï¼Œç«¯åˆèŠ‚é€èŠ‚ä¹°é…’ 540 å…ƒ 5 æœˆ 26 æ—¥ï¼š173 å…ƒ 5 æœˆ 25 æ—¥ï¼š17 å…ƒ 5 æœˆ 24 æ—¥ï¼š7 å…ƒ 5 æœˆ 23 æ—¥ï¼š20 å…ƒ 5 æœˆ 22 æ—¥ï¼š16 å…ƒ å¥èº« æˆ‘è·‘è¿‡äº†ä¸€äº›åœ°æ–¹ï¼Œå¸Œæœ›éšç€æ—¶é—´æ¨ç§»ï¼Œåœ°å›¾ç‚¹äº®çš„åœ°æ–¹è¶Šæ¥è¶Šå¤šã€‚2 å¹´é‡Œæˆ‘è·‘è¿‡ 2 ä¸ªçœä»½ 2 ä¸ªåŸå¸‚ã€‚æ›´å¤šè·‘æ­¥æ•°æ®åœ¨è·‘æ­¥ä¸»é¡µã€‚\næœ¬å‘¨è·‘æ­¥ 39 å…¬é‡Œï¼Œæœ€é•¿è·‘æ­¥è·ç¦»ä¸º 6 å…¬é‡Œã€‚\næ˜ç»†æ•°æ®å¦‚ä¸‹ï¼š\n5 æœˆä»½å³å°†ç»“æŸï¼Œç›®å‰è¿™ä¸ªæœˆè·‘äº† 24 å¤©ï¼Œç´¯è®¡ 178 å…¬é‡Œï¼Œæ¯” 4 æœˆçš„ 125 å…¬é‡Œå¤šäº† 53 å…¬é‡Œã€‚å†è·‘ä¸ª 12 å…¬é‡Œï¼Œè¿™ä¸ªæœˆè·‘æ­¥é‡Œç¨‹å°±å¯ä»¥è¾¾åˆ° 190 å…¬é‡Œäº†ï¼Œç»™è‡ªå·±åŠ æ²¹ï¼æœ€é•¿è¿ç»­è·‘æ­¥æ—¶é—´ä¸º 7 å¤©ï¼Œæ¯æ¬¡éƒ½æ˜¯åˆ°äº†å‘¨æœ«å°±ä¸­æ–­äº†ï¼Œæœ‰ç‚¹é—æ†¾ã€‚å›è¿‡å¤´æ¥æƒ³æƒ³ï¼Œè·‘æ­¥æ˜¯ä¸€ä¸ªé•¿æœŸçš„äº‹æƒ…ï¼Œæ¯”èµ·è·‘çš„è¿œï¼Œæ›´é‡è¦çš„æ˜¯è·‘çš„ä¹…ã€‚äº‰å–æ¯å¤©éƒ½è·‘ï¼Œä¸ç®¡è·‘å‡ å…¬é‡Œï¼Œåªè¦åšæŒä¸‹å»å°±æ˜¯æˆåŠŸã€‚\nå·¥ä½œ æœ€è¿‘åœ¨å­¦ä¹ çš„å†…å®¹æ¸…å•ï¼š\nEffective Javaï¼ˆç¬¬ 3 ç‰ˆï¼‰ Java Design Patterns (ä¸­æ–‡) Real Python æœ¬å‘¨å®Œæˆå››ç¯‡åšå®¢ï¼š\nã€ŠEffective Java 3ã€‹ç¬”è®° 12ï¼šå½“è¦†ç›– equals æ–¹æ³•æ—¶ï¼Œæ€»è¦è¦†ç›– hashCode æ–¹æ³• ã€ŠEffective Java 3ã€‹ç¬”è®° 13ï¼šæ˜æ™ºåœ°è¦†ç›– clone æ–¹æ³• ã€ŠEffective Java 3ã€‹ç¬”è®° 14ï¼šè€ƒè™‘å®ç° Comparable æ¥å£ Java è®¾è®¡æ¨¡å¼ï¼šActive Object è‡³æ­¤ï¼Œã€ŠEffective Java 3ã€‹ç¬¬ä¸‰ç« å­¦ä¹ å®Œäº†ã€‚ç¬¬ä¸‰ç« ä»‹ç»äº† Java ä¸­å¯¹è±¡çš„åˆ›å»ºå’Œé”€æ¯ï¼Œå…¶ä¸­ç¬¬ä¸‰ç« è®²è¿°äº†æ‰€æœ‰å¯¹è±¡é€šç”¨çš„æ–¹æ³•ï¼Œä¸»è¦å†…å®¹å¦‚ä¸‹ï¼š\nequals æ–¹æ³•ï¼šç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼Œéœ€è¦éµå¾ªä¸€äº›é€šç”¨çº¦å®šï¼ŒåŒ…æ‹¬è‡ªåæ€§ã€å¯¹ç§°æ€§ã€ä¼ é€’æ€§ã€ä¸€è‡´æ€§å’Œéç©ºæ€§ç­‰ã€‚ hashCode æ–¹æ³•ï¼šç”¨äºè¿”å›å¯¹è±¡çš„å“ˆå¸Œç ï¼Œéœ€è¦ä¸ equals æ–¹æ³•ä¸€èµ·å®ç°ï¼Œä¿è¯ç›¸ç­‰çš„å¯¹è±¡å…·æœ‰ç›¸ç­‰çš„å“ˆå¸Œç ã€‚ toString æ–¹æ³•ï¼šç”¨äºè¿”å›å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ï¼Œæ–¹ä¾¿è°ƒè¯•å’Œæ—¥å¿—è®°å½•ç­‰ã€‚ clone æ–¹æ³•ï¼šç”¨äºå¤åˆ¶å¯¹è±¡ï¼Œéœ€è¦å®ç° Cloneable æ¥å£ï¼Œå¹¶è¦†ç›– Object ç±»ä¸­çš„ clone æ–¹æ³•ã€‚ finalize æ–¹æ³•ï¼šç”¨äºåœ¨å¯¹è±¡è¢«åƒåœ¾å›æ”¶å‰æ‰§è¡Œä¸€äº›æ¸…ç†æ“ä½œï¼Œä½†æ˜¯è¯¥æ–¹æ³•çš„ä½¿ç”¨éå¸¸å±é™©ï¼Œåº”è¯¥å°½é‡é¿å…ä½¿ç”¨ã€‚ æœ¬ç« é‡ç‚¹ä»‹ç»äº†æ‰€æœ‰å¯¹è±¡é€šç”¨çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•åœ¨ Java ä¸­éå¸¸é‡è¦ï¼Œéœ€è¦ç¨‹åºå‘˜æŒæ¡ã€‚equals å’Œ hashCode æ–¹æ³•æ˜¯ä¸€å¯¹é‡è¦çš„æ–¹æ³•ï¼Œéœ€è¦åŒæ—¶å®ç°ï¼Œä¿è¯å¯¹è±¡çš„ç›¸ç­‰å’Œå“ˆå¸Œç çš„æ­£ç¡®æ€§ã€‚toString æ–¹æ³•å¯ä»¥æ–¹ä¾¿åœ°è¾“å‡ºå¯¹è±¡çš„ä¿¡æ¯ï¼Œæ–¹ä¾¿è°ƒè¯•å’Œæ—¥å¿—è®°å½•ç­‰ã€‚clone æ–¹æ³•å¯ä»¥ç”¨äºå¤åˆ¶å¯¹è±¡ï¼Œä½†éœ€è¦æ³¨æ„å®ç° Cloneable æ¥å£ï¼Œå¹¶è¦†ç›– Object ç±»ä¸­çš„ clone æ–¹æ³•ã€‚æœ€åï¼Œfinalize æ–¹æ³•è™½ç„¶å¯ä»¥ç”¨äºå¯¹è±¡æ¸…ç†ï¼Œä½†æ˜¯ä½¿ç”¨éå¸¸å±é™©ï¼Œåº”è¯¥å°½é‡é¿å…ä½¿ç”¨ã€‚\næœ¬å‘¨åˆ†äº« å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€ChenSoul Shareã€Telegram é¢‘é“æˆ–è€…æˆ‘çš„ memos ä¸­ã€‚æˆ‘å†™äº†ä¸€ä¸ª python è„šæœ¬ä» memos è¯»å–æœ€è¿‘ä¸€å‘¨çš„ memos è®°å½•ã€‚\nğŸ“Œ2023-05-27 365 èµ„è®¯ç®€æŠ¥ï¼Œæ¯å¤©ç²¾é€‰ 15 æ¡çƒ­ç‚¹æ–°é—»ç®€æŠ¥ 1 æ¡å¾®è¯­ï¼Œæ¯å¤©ä¸€åˆ†é’Ÿï¼ŒçŸ¥æ™“å¤©ä¸‹äº‹ï¼ 2023 å¹´ 5 æœˆ 26 æ—¥ æ˜ŸæœŸäº” å†œå†å››æœˆåˆå…« 1ã€å·¥ä¿¡éƒ¨ç­‰åå››éƒ¨é—¨ï¼šéƒ¨ç½²æ¨è¿›æ–°ä¸€è½®ç”µä¿¡åŸºç¡€è®¾æ–½å…±å»ºå…±äº«å·¥ä½œã€‚ 2ã€ä¸¤é«˜ä¸¤éƒ¨ï¼šå¯¹åœ¨æ ¡å›­ç­‰åœºæ‰€å¯¹æœªæˆå¹´äººå®æ–½çŒ¥äºµç­‰çŠ¯ç½ªçš„ï¼ŒåŠ é‡å¤„ç½šã€‚ 3ã€å›½å®¶ç–¾æ§å±€ï¼š4 æœˆå…¨å›½æŠ¥å‘Šæ³•å®šä¼ æŸ“ç—…è¶… 210 ä¸‡ä¾‹ã€‚ 4ã€é›†ä½“å©šç¤¼èµ°çº¢ï¼Œæ°‘æ”¿éƒ¨æ¨è¡Œå©šä¿—æ”¹é©ï¼Œé«˜ä»·å½©ç¤¼å¾—åˆ°æœ‰æ•ˆéåˆ¶ã€‚ 5ã€å¹¿ä¸œå‡ºå°åŠæ³•ï¼šå¤±ä¿¡è”åˆæƒ©æˆ’å¯¹è±¡ä¸å¾—æŠ¥åå‚åŠ äº‹ä¸šå•ä½æ‹›è˜ã€‚ 6ã€åŒ—äº¬ï¼šæ–°å† è¿ç»­ 4 å‘¨åˆ—ä¼ æŸ“ç—…æ¦œé¦–ï¼Œä¸Šå‘¨æŠ¥å‘Šå‘ç—…æ•°æ˜¯ 4 æœˆåº•çš„è¿‘ 4 å€ã€‚ 7ã€å¤©æ´¥ï¼šåœ¨æ´¥æ— æˆ¿å®¶åº­é¦–æ¬¡å…¬ç§¯é‡‘è´·æ¬¾è¿˜æ¸…åï¼Œä»å¯æŒ‰é¦–å¥—æˆ¿è´·æ¬¾ã€‚ 8ã€ä¸Šæµ·éƒ¨åˆ†ç¤¾åŒºå¼€æ‰“ mRNA æ–°å† ç–«è‹—ï¼Œå¯é€šè¿‡â€œå¥åº·äº‘â€é¢„çº¦ã€‚ 9ã€17 çº§è¶…å¼ºå°é£\u0026quot;ç›å¨ƒ\u0026quot;å·²æˆä»Šå¹´ä»¥æ¥å…¨çƒé£ç‹ï¼Œä¸‹å‘¨å°†å½±å“æˆ‘å›½å—æ–¹ã€‚ 10ã€é•¿åŸæ±½è½¦å…¬å¼€ä¸¾æŠ¥æ¯”äºšè¿ªï¼šä¸¤æ¬¾è½¦å‹æ±¡æŸ“ç‰©æ’æ”¾ä¸è¾¾æ ‡ï¼Œæ¯”äºšè¿ªå›åº”ï¼šæ£€æµ‹æŠ¥å‘Šæ— æ•ˆï¼Œåå¯¹ä»»ä½•å½¢å¼ä¸æ­£å½“ç«äº‰ã€‚ 11ã€å¾®ä¿¡ç”µè„‘ç‰ˆæ–°å¢é”å®šåŠŸèƒ½ï¼Œåªèƒ½é€šè¿‡æ‰‹æœºç«¯è§£é”ã€‚ 12ã€éŸ©è‡ªç ”è¿è½½ç«ç®­â€œä¸–ç•Œâ€å·è½½æ˜Ÿå‘å°„æˆåŠŸã€‚ 13ã€é€ å‡æ•°é‡è¶… 2 äº¿ä»¶ï¼æœ€é•¿å¯è¿½æº¯ 40 å¹´å‰ï¼æœ¬ç”°åˆèµ„é›¶éƒ¨ä»¶å‚å•†æ‰¿è®¤é€ å‡ã€‚ 14ã€æ™®äº¬ï¼šä¿„ç½—æ–¯æ­£å‡å°‘ä¸å‹å¥½å›½å®¶è´§å¸åœ¨è´¸æ˜“ç»“ç®—ä¸­çš„ä»½é¢ã€‚ 15ã€ç¾æƒ…æŠ¥æŠ«éœ²ï¼šå…‹å®«é­æ— äººæœºè¢­å‡»å¹•åé»‘æ‰‹ä¸ºä¹Œå…‹å…°ã€‚ ã€å¾®è¯­ã€‘çœŸæ­£çš„è´«ç©·ï¼Œä¸æ˜¯é‡‘é’±ä¸Šçš„åŒ®ä¹ï¼Œè€Œæ˜¯è®¤çŸ¥ä¸Šçš„è´«ç˜ ã€‚ æ–°é—»æ¥æºï¼šhttps://www.163.com/dy/article/I5L6PQL30534QBVQ.html?spss=dy_author #æ¯æ—¥æ—©æŠ¥ #memos ğŸ“Œ2023-05-26 365 èµ„è®¯ç®€æŠ¥ï¼Œæ¯å¤©ç²¾é€‰ 15 æ¡çƒ­ç‚¹æ–°é—»ç®€æŠ¥ 1 æ¡å¾®è¯­ï¼Œæ¯å¤©ä¸€åˆ†é’Ÿï¼ŒçŸ¥æ™“å¤©ä¸‹äº‹ï¼ 2023 å¹´ 5 æœˆ 25 æ—¥ æ˜ŸæœŸå›› å†œå†å››æœˆåˆä¸ƒ 1ã€æ•™è‚²éƒ¨ï¼š2023 å¹´ä¸ºä¸­è¥¿éƒ¨ä¹¡é•‡å®šå‘å…è´¹åŸ¹å…»æœ¬ç§‘åŒ»å­¦ç”Ÿ 6150 äººã€‚ 2ã€ä¸­å›½äº’è”ç½‘åä¼šï¼šè­¦æƒ• AI æ¢è„¸æ–°éª—å±€ï¼Œè¿œç¨‹è½¬è´¦åŠ¡å¿…å¤šé‡éªŒè¯ã€‚ 3ã€äº¤é€šè¿è¾“éƒ¨åœ¨å—æ²™ç¾¤å²›ç«è‰¾ç¤ã€ç‰›è½­ç¤å’Œå—è–°ç¤é™„è¿‘æµ·åŸŸå¸ƒè®¾ 3 åº§ç¯æµ®æ ‡ã€‚ 4ã€æ•°æ®æ˜¾ç¤ºï¼šä»Šå¹´ä»¥æ¥å…¨å›½å·²æœ‰è¶… 40 åŸè°ƒæ•´é¦–å¥—æˆ¿è´·åˆ©ç‡ä¸‹é™è‡³ 4%ä»¥ä¸‹ã€‚ 5ã€è´¢æ”¿éƒ¨ï¼š4 æœˆä»½å…¨å›½å…±é”€å”®å½©ç¥¨ 503.26 äº¿å…ƒï¼ŒåŒæ¯”å¢é•¿ 62.0%ã€‚ 6ã€å‰æ—çœå°å‘å…¬åŠ¡æ¥å¾…æ–°åŠæ³•ï¼šä¸å¾—å®‰æ’ç¾¤ä¼—è¿é€ï¼Œå…¬åŠ¡æ¥å¾…å·¥ä½œé¤æ¯äººä¸è¶… 120 å…ƒã€‚ 7ã€é¦™æ¸¯ï¼šè°ƒæ•´ç­¾è¯åŠè¿›å…¥è®¸å¯ç”³è¯·æµç¨‹ï¼Œå¤–ä½£åŠå­¦ç”Ÿç­‰é¡»ç”³æŠ¥åˆ‘äº‹è®°å½•ã€‚ 8ã€å¹¿ä¸œæµ·ç ï¼šä¸¾æŠ¥ç”µåŠ¨è½¦è¿›å‡ºç§Ÿå±‹å……ç”µç­‰ï¼Œæœ€é«˜å¥–åŠ± 1 ä¸‡å…ƒã€‚ 9ã€éŸ©å›½ä¸‰å¤§è¿è¥å•†å¤¸å¤§ 5G ç½‘é€Ÿè¢«ç½š 336 äº¿éŸ©å…ƒï¼šå·ç§° 20G å®é™… 800Mã€‚ 10ã€51 å²é©¬æ–¯å…‹å…¬å¼€å›åº”ï¼šå·²ç¡®å®šç‰¹æ–¯æ‹‰æ¥ç­äººï¼Œè‹¥æˆ‘å‡ºç°æ„å¤–ï¼Œå¯ä»¥ç¡®ä¿å…¬å¸ç»§ç»­è¿è¥ä¸‹å»ã€‚ 11ã€å¾®è½¯å‘å¸ƒé‡ç£…æ›´æ–°ï¼šWindows ç³»ç»Ÿå…¨é¢æ¥å…¥ AI åŠ©æ‰‹ï¼ŒChatGPT å†…ç½®å¿…åº”æœç´¢æœ€æ–°ç­”æ¡ˆã€‚ 12ã€å²¸ç”°æ–‡é›„ç§°æ—¥æœ¬æ­£è€ƒè™‘è®¾ç«‹åŒ—çº¦è”ç»œå¤„ä½†ä¸ä¼šåŠ å…¥åŒ—çº¦ï¼Œä¸­æ–¹å›åº”ï¼šä¸æ¬¢è¿å†›äº‹é›†å›¢ã€‚ 13ã€ä¿„ç½—æ–¯ï¼šä¿„ä¸­ä¹‹é—´ 70ï¼…çš„è·¨å¢ƒç»“ç®—å·²ç”¨æœ¬å¸å®Œæˆã€‚ 14ã€è‹±å›½é¦–ç›¸è‹çº³å…‹æ‹’ç»åœç«å‘¼åï¼Œç§°ä¹Œå…‹å…°åº”è¯¥ç»§ç»­æˆ˜æ–—ã€‚ 15ã€ä¿„åª’ï¼šä¹Œå…‹å…°æœ€é«˜å°†é¢†åœ¨ä¿„å†›æ”»å‡»ä¸­å—é‡ä¼¤ï¼Œå¯èƒ½å°†æ— æ³•ç»§ç»­æŒ‡æŒ¥ã€‚ ã€å¾®è¯­ã€‘æ”¾å¼ƒä¸éš¾ï¼Œä½†åšæŒä¸€å®šå¾ˆé…·ã€‚æ’‘ä½ï¼Œæ‰æœ‰åæ¥çš„ä¸€åˆ‡ã€‚ æ–°é—»æ¥æºï¼šhttps://www.163.com/dy/article/I5IJEHQK0534QBVQ.html?spss=dy_author #æ¯æ—¥æ—©æŠ¥ #memos ğŸ“Œ2023-05-25 365 èµ„è®¯ç®€æŠ¥ï¼Œæ¯å¤©ç²¾é€‰ 15 æ¡çƒ­ç‚¹æ–°é—»ç®€æŠ¥ 1 æ¡å¾®è¯­ï¼Œæ¯å¤©ä¸€åˆ†é’Ÿï¼ŒçŸ¥æ™“å¤©ä¸‹äº‹ï¼ 2023 å¹´ 5 æœˆ 25 æ—¥ æ˜ŸæœŸå›› å†œå†å››æœˆåˆä¸ƒ 1ã€æ•™è‚²éƒ¨ï¼š2023 å¹´ä¸ºä¸­è¥¿éƒ¨ä¹¡é•‡å®šå‘å…è´¹åŸ¹å…»æœ¬ç§‘åŒ»å­¦ç”Ÿ 6150 äººã€‚ 2ã€ä¸­å›½äº’è”ç½‘åä¼šï¼šè­¦æƒ• AI æ¢è„¸æ–°éª—å±€ï¼Œè¿œç¨‹è½¬è´¦åŠ¡å¿…å¤šé‡éªŒè¯ã€‚ 3ã€äº¤é€šè¿è¾“éƒ¨åœ¨å—æ²™ç¾¤å²›ç«è‰¾ç¤ã€ç‰›è½­ç¤å’Œå—è–°ç¤é™„è¿‘æµ·åŸŸå¸ƒè®¾ 3 åº§ç¯æµ®æ ‡ã€‚ 4ã€æ•°æ®æ˜¾ç¤ºï¼šä»Šå¹´ä»¥æ¥å…¨å›½å·²æœ‰è¶… 40 åŸè°ƒæ•´é¦–å¥—æˆ¿è´·åˆ©ç‡ä¸‹é™è‡³ 4%ä»¥ä¸‹ã€‚ 5ã€è´¢æ”¿éƒ¨ï¼š4 æœˆä»½å…¨å›½å…±é”€å”®å½©ç¥¨ 503.26 äº¿å…ƒï¼ŒåŒæ¯”å¢é•¿ 62.0%ã€‚ 6ã€å‰æ—çœå°å‘å…¬åŠ¡æ¥å¾…æ–°åŠæ³•ï¼šä¸å¾—å®‰æ’ç¾¤ä¼—è¿é€ï¼Œå…¬åŠ¡æ¥å¾…å·¥ä½œé¤æ¯äººä¸è¶… 120 å…ƒã€‚ 7ã€é¦™æ¸¯ï¼šè°ƒæ•´ç­¾è¯åŠè¿›å…¥è®¸å¯ç”³è¯·æµç¨‹ï¼Œå¤–ä½£åŠå­¦ç”Ÿç­‰é¡»ç”³æŠ¥åˆ‘äº‹è®°å½•ã€‚ 8ã€å¹¿ä¸œæµ·ç ï¼šä¸¾æŠ¥ç”µåŠ¨è½¦è¿›å‡ºç§Ÿå±‹å……ç”µç­‰ï¼Œæœ€é«˜å¥–åŠ± 1 ä¸‡å…ƒã€‚ 9ã€éŸ©å›½ä¸‰å¤§è¿è¥å•†å¤¸å¤§ 5G ç½‘é€Ÿè¢«ç½š 336 äº¿éŸ©å…ƒï¼šå·ç§° 20G å®é™… 800Mã€‚ 10ã€51 å²é©¬æ–¯å…‹å…¬å¼€å›åº”ï¼šå·²ç¡®å®šç‰¹æ–¯æ‹‰æ¥ç­äººï¼Œè‹¥æˆ‘å‡ºç°æ„å¤–ï¼Œå¯ä»¥ç¡®ä¿å…¬å¸ç»§ç»­è¿è¥ä¸‹å»ã€‚ 11ã€å¾®è½¯å‘å¸ƒé‡ç£…æ›´æ–°ï¼šWindows ç³»ç»Ÿå…¨é¢æ¥å…¥ AI åŠ©æ‰‹ï¼ŒChatGPT å†…ç½®å¿…åº”æœç´¢æœ€æ–°ç­”æ¡ˆã€‚ 12ã€å²¸ç”°æ–‡é›„ç§°æ—¥æœ¬æ­£è€ƒè™‘è®¾ç«‹åŒ—çº¦è”ç»œå¤„ä½†ä¸ä¼šåŠ å…¥åŒ—çº¦ï¼Œä¸­æ–¹å›åº”ï¼šä¸æ¬¢è¿å†›äº‹é›†å›¢ã€‚ 13ã€ä¿„ç½—æ–¯ï¼šä¿„ä¸­ä¹‹é—´ 70ï¼…çš„è·¨å¢ƒç»“ç®—å·²ç”¨æœ¬å¸å®Œæˆã€‚ 14ã€è‹±å›½é¦–ç›¸è‹çº³å…‹æ‹’ç»åœç«å‘¼åï¼Œç§°ä¹Œå…‹å…°åº”è¯¥ç»§ç»­æˆ˜æ–—ã€‚ 15ã€ä¿„åª’ï¼šä¹Œå…‹å…°æœ€é«˜å°†é¢†åœ¨ä¿„å†›æ”»å‡»ä¸­å—é‡ä¼¤ï¼Œå¯èƒ½å°†æ— æ³•ç»§ç»­æŒ‡æŒ¥ã€‚ ã€å¾®è¯­ã€‘æ”¾å¼ƒä¸éš¾ï¼Œä½†åšæŒä¸€å®šå¾ˆé…·ã€‚æ’‘ä½ï¼Œæ‰æœ‰åæ¥çš„ä¸€åˆ‡ã€‚ æ–°é—»æ¥æºï¼šhttps://www.163.com/dy/article/I5IJEHQK0534QBVQ.html?spss=dy_author #æ¯æ—¥æ—©æŠ¥ #memos ğŸ“Œ2023-05-25 å‰åç«¯å‡åŸºäº vercel çš„æ¯æ—¥æ—©æŠ¥é¡¹ç›® https://icodeq.com/2022/5fe2010403bb/ #memos ğŸ“Œ2023-05-24 GitHub - resumejob/awesome-resume: Resumeï¼ŒResume Templatesï¼Œç¨‹åºå‘˜ç®€å†ä¾‹å¥ï¼Œç®€å†æ¨¡ç‰ˆ#memos https://github.com/resumejob/awesome-resume ä»¥ä¸Šã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/05/31/weekly_review_21/","summary":"å‰è¨€ å…¬å¸ä»·å€¼è§‚ æœ¬ç¯‡æ˜¯å¯¹ 2023-05-22 åˆ° 2023-05-28 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nå‘¨ä¸€ï¼Œä¼‘äº§å‡çš„äº§å“ç»ç†å›æ¥ä¸Šç­ï¼Œå¾—çŸ¥å¥¹è¢«ä¼˜åŒ–ä¹‹åï¼Œå†…å¿ƒæœ‰äº›ä¸èˆå’Œä¼¤æ„Ÿã€‚ä¸­åˆï¼Œç»„é•¿è¯·å¤§å®¶ä¸€èµ·åƒäº†é¥­ã€‚æ™šä¸Šï¼Œäº§å“ç»ç†äº¤å‰²å®ŒåŠå…¬ç”¨æˆ·ä¹‹åï¼Œå°±æ²¡æ¥ä¸Šç­äº†ã€‚è‡ªæ­¤ï¼Œè¿‡å®Œå¹´åï¼Œå…¬å¸è‡³å°‘æœ‰ä¸‰ä½å¥³åŒäº‹ä¿®å®Œäº§å‡ä¹‹åå°±ç¦»èŒäº†ï¼Œæœ‰çš„æ˜¯ä¸»åŠ¨ï¼Œæ›´å¤šçš„åº”è¯¥æ˜¯è¢«åŠ¨ã€‚è™½ç„¶æœ‰ N+1 èµ”å¿ï¼Œä½†æ˜¯ï¼Œè¿™ä¸ªç¤¾ä¼šå¯¹å¥³æ€§è¿˜æ˜¯ä¸å¤Ÿå…¬å¹³ã€‚\nè¿˜æœ‰ 3 ä¸ªæœˆå°±è¦åˆ°ç«¯åˆèŠ‚ï¼Œè€å©†ä¹°äº†ç²½å¶åŒ…ç²½å­ï¼Œæˆ‘ä¹ŸåŠ¨æ‰‹åŒ…äº†ä¸€éƒ¨åˆ†ã€‚è™½ç„¶åŒ…çš„ä¸å¥½çœ‹ï¼Œä½†å¿ƒé‡Œè¿˜æ˜¯å¾ˆæ»¡è¶³çš„ã€‚è‡ªå·±åŒ…çš„ç²½å­é€èŠ‚ï¼Œæ˜¾ç„¶æ›´æœ‰æ„ä¹‰ã€‚ç»“å©šä¹‹åçš„ç¬¬ä¸€ä¸ªç«¯åˆèŠ‚ï¼Œå‘¨æœ«å¼€è½¦å»ç»™é•¿è¾ˆé€äº†ç«¯åˆèŠ‚ã€‚çœ‹ç€é•¿è¾ˆä»¬çš„å¤´å‘æ—¥æ¸æ–‘ç™½ï¼Œä¸ç¦æ„Ÿå¹å²æœˆæ— æƒ…ã€‚è¶ç€å¹´è½»çš„æ—¶å€™ï¼Œè¦å¯¹èº«è¾¹çš„äº²äººå¥½ä¸€äº›ã€‚ä¸è¦ç­‰åˆ°æ¥ä¸åŠäº†æ‰çŸ¥é“åæ‚”ã€‚\nè¿™å‘¨åœ¨ docker é‡Œéƒ¨ç½²äº† Plausible ï¼Œä½¿ç”¨è¿‡ç¨‹ä¸­å‘ç° Plausible æ¶æ„è¿‡äºå¤æ‚ï¼Œä½¿ç”¨äº† postgres å’Œ clickhouse æ•°æ®åº“ï¼Œdocker-compose å¯åŠ¨äº† 4 ä¸ªå®¹å™¨ï¼Œæ‰€ä»¥æœ€åè¿˜æ˜¯æ”¾å¼ƒäº†ä½¿ç”¨ Plausibleã€‚umami çš„ postgres æ•°æ®åº“åªåŒ…æ‹¬å‡ å¼ è¡¨ï¼Œæ“ä½œèµ·æ¥æ¯”è¾ƒå®¹æ˜“ï¼Œæ¯”å¦‚ï¼šæ—¶ä¸æ—¶åœ°ï¼Œæˆ‘ä¼šæŠŠæ¥è‡ª localhost çš„è®¿é—®è®°å½•åˆ é™¤æ‰ï¼Œè¿™æ ·ç»Ÿè®¡æ•°æ®æ›´åŠ çœŸå®å‡†ç¡®ã€‚\nPython ä¹‹ç¦… è¿™æ˜¯æœ€è¿‘çš„ä¸€ä¸ª PyTricksï¼šåœ¨ python REPL é‡Œé¢è¾“å…¥ import this ä¼šè¾“å‡º The Zen of Python, by Tim Petersï¼š\nè‹±æ–‡ï¼š\nThe Zen of Python, by Tim Peters\nBeautiful is better than ugly.\nExplicit is better than implicit.\nSimple is better than complex.\nComplex is better than complicated.\nFlat is better than nested.\nSparse is better than dense.\nReadability counts.\nSpecial cases aren\u0026rsquo;t special enough to break the rules.","title":"å‘¨æŠ¥-21ï½œPythonä¹‹ç¦…ã€äº§å“ç»ç†è¢«ä¼˜åŒ–ã€ç«¯åˆèŠ‚é€èŠ‚"},{"content":"æœ¬æ–‡ä¸»è¦ä»‹ç» Active Object æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nJava Design Patterns æä¾›äº†å„ç§ Java è®¾è®¡æ¨¡å¼çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ã€‚è¯¥ç½‘ç«™æ—¨åœ¨å¸®åŠ© Java å¼€å‘äººå‘˜äº†è§£å’Œåº”ç”¨å„ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚\nJava Design Patterns ç½‘ç«™æä¾›äº†å¤šç§è®¾è®¡æ¨¡å¼åˆ†ç±»æ–¹å¼ï¼ŒåŒ…æ‹¬åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational Patternsï¼‰ã€ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternsï¼‰å’Œè¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰ï¼Œä»¥åŠå…¶ä»–ä¸€äº›å¸¸è§çš„æ¨¡å¼ã€‚\nå¯¹äºæ¯ä¸ªè®¾è®¡æ¨¡å¼ï¼Œè¯¥ç½‘ç«™æä¾›äº†è¯¦ç»†çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ï¼Œå¹¶ä¸”æä¾›äº†ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ã€‚å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©é€‚åˆè‡ªå·±çš„è®¾è®¡æ¨¡å¼ï¼Œå¹¶ä¸”å¯ä»¥å‚è€ƒç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜æ¥ç†è§£å’Œåº”ç”¨è¯¥æ¨¡å¼ã€‚\næ­¤å¤–ï¼ŒJava Design Patterns ç½‘ç«™è¿˜æä¾›äº†ä¸€äº›å…¶ä»–èµ„æºï¼Œå¦‚è®¾è®¡æ¨¡å¼çš„ UML å›¾ã€è®¾è®¡æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ã€è®¾è®¡æ¨¡å¼çš„æ¯”è¾ƒç­‰ã€‚è¿™äº›èµ„æºå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨è®¾è®¡æ¨¡å¼ã€‚\nä¸­æ–‡ç½‘ç«™ï¼šhttps://java-design-patterns.com/zh/\nGithub ä¸Šæºç ä»“åº“ï¼ˆéå®˜æ–¹ï¼‰ï¼šhttps://github.com/iluwatar/java-design-patterns\nç›®çš„ æ´»åŠ¨å¯¹è±¡ï¼ˆActive Objectï¼‰æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯å°†å¹¶å‘å’Œå¼‚æ­¥å¤„ç†çš„é—®é¢˜ä»å®¢æˆ·ç«¯ä»£ç ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½ã€å¯é æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚æ´»åŠ¨å¯¹è±¡æ¨¡å¼æ˜¯ä¸€ç§èƒ½å¤Ÿå¸®åŠ©å¼€å‘äººå‘˜å¤„ç†å¤šçº¿ç¨‹ã€å¼‚æ­¥å’Œå¹¶å‘é—®é¢˜çš„è®¾è®¡æ¨¡å¼ã€‚\nåœ¨ä¼ ç»Ÿçš„å¹¶å‘ç¼–ç¨‹æ¨¡å‹ä¸­ï¼Œå®¢æˆ·ç«¯ä»£ç éœ€è¦ç›´æ¥ç®¡ç†çº¿ç¨‹å’Œé”ç­‰ç»†èŠ‚ï¼Œè¿™æ ·ä¼šå¯¼è‡´ä»£ç å¤æ‚åº¦å’Œç»´æŠ¤æˆæœ¬çš„å¢åŠ ï¼ŒåŒæ—¶ä¹Ÿå®¹æ˜“å‡ºç°å„ç§é—®é¢˜ï¼Œå¦‚æ­»é”ã€ç«æ€æ¡ä»¶ç­‰ã€‚æ´»åŠ¨å¯¹è±¡æ¨¡å¼é€šè¿‡å¼•å…¥æ´»åŠ¨å¯¹è±¡æ¥è§£å†³è¿™äº›é—®é¢˜ï¼Œæ´»åŠ¨å¯¹è±¡å°†å®¢æˆ·ç«¯ä»£ç å‘é€çš„æ¶ˆæ¯æ·»åŠ åˆ°å†…éƒ¨çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå¹¶ä½¿ç”¨å•ç‹¬çš„çº¿ç¨‹å¼‚æ­¥å¤„ç†è¿™äº›æ¶ˆæ¯ã€‚è¿™ç§æ¨¡å¼å¯ä»¥æé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§ï¼ŒåŒæ—¶ä½¿å¾—å®¢æˆ·ç«¯ä»£ç æ›´åŠ ç®€å•å’Œæ˜“äºç»´æŠ¤ã€‚\næ´»åŠ¨å¯¹è±¡æ¨¡å¼çš„ç›®çš„åŒ…æ‹¬ï¼š\nå°†å¹¶å‘å’Œå¼‚æ­¥å¤„ç†çš„é—®é¢˜ä»å®¢æˆ·ç«¯ä»£ç ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œä»è€Œä½¿å¾—å®¢æˆ·ç«¯ä»£ç æ›´åŠ ç®€å•å’Œæ˜“äºç»´æŠ¤ã€‚å®¢æˆ·ç«¯ä»£ç åªéœ€è¦å‘é€æ¶ˆæ¯å³å¯ï¼Œä¸éœ€è¦å…³å¿ƒå¼‚æ­¥å¤„ç†çš„ç»†èŠ‚ï¼Œæ´»åŠ¨å¯¹è±¡å°†å¹¶å‘å’Œå¼‚æ­¥å¤„ç†çš„é—®é¢˜å°è£…èµ·æ¥ï¼Œæä¾›ç®€å•çš„æ¥å£ä¾›å®¢æˆ·ç«¯ä½¿ç”¨ã€‚ æé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§ã€‚æ´»åŠ¨å¯¹è±¡ä½¿ç”¨å•ç‹¬çš„çº¿ç¨‹æ± å¼‚æ­¥å¤„ç†æ¶ˆæ¯ï¼Œå¯ä»¥æ›´å¥½åœ°åˆ©ç”¨ç³»ç»Ÿèµ„æºï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§ã€‚ æé«˜ç³»ç»Ÿçš„å¯é æ€§å’Œå¥å£®æ€§ã€‚æ´»åŠ¨å¯¹è±¡å°†æ¶ˆæ¯æ·»åŠ åˆ°å†…éƒ¨çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œé¿å…äº†ç«æ€æ¡ä»¶å’Œæ­»é”ç­‰é—®é¢˜ï¼Œä»è€Œæé«˜äº†ç³»ç»Ÿçš„å¯é æ€§å’Œå¥å£®æ€§ã€‚ å°†å¤šçº¿ç¨‹å’Œå¼‚æ­¥å¤„ç†çš„ç»†èŠ‚å°è£…èµ·æ¥ï¼Œä½¿å¾—å®¢æˆ·ç«¯ä»£ç æ›´åŠ æŠ½è±¡å’Œé€šç”¨ã€‚å®¢æˆ·ç«¯ä»£ç å¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ¥å£æ¥è®¿é—®ä¸åŒçš„æœåŠ¡ï¼Œä»è€Œæé«˜ä»£ç çš„å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ è§£é‡Š æ´»åŠ¨å¯¹è±¡æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†å¹¶å‘å’Œå¼‚æ­¥å¤„ç†çš„é—®é¢˜ä»å®¢æˆ·ç«¯ä»£ç ä¸­åˆ†ç¦»å‡ºæ¥ã€‚å…·ä½“æ¥è¯´ï¼Œæ´»åŠ¨å¯¹è±¡æ¨¡å¼åŒ…å«ä»¥ä¸‹å‡ ä¸ªå…³é”®ç»„ä»¶ï¼š\næ´»åŠ¨å¯¹è±¡ï¼ˆActive Objectï¼‰ï¼šæ´»åŠ¨å¯¹è±¡æ˜¯ä¸€ä¸ªå°è£…äº†æŸç§æœåŠ¡çš„å¯¹è±¡ï¼Œå®ƒå°†å®¢æˆ·ç«¯ä»£ç å‘é€çš„æ¶ˆæ¯æ·»åŠ åˆ°å†…éƒ¨çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå¹¶ä½¿ç”¨å•ç‹¬çš„çº¿ç¨‹å¼‚æ­¥å¤„ç†è¿™äº›æ¶ˆæ¯ã€‚æ´»åŠ¨å¯¹è±¡é€šå¸¸åŒ…å«ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—å’Œä¸€ä¸ªçº¿ç¨‹æ± ï¼Œç”¨äºå¼‚æ­¥å¤„ç†æ¶ˆæ¯ã€‚ æ–¹æ³•è°ƒç”¨è¯·æ±‚ï¼ˆMethod Invocation Requestï¼‰ï¼šå®¢æˆ·ç«¯ä»£ç å‘æ´»åŠ¨å¯¹è±¡å‘é€æ–¹æ³•è°ƒç”¨è¯·æ±‚ï¼ŒåŒ…æ‹¬æ–¹æ³•åå’Œå‚æ•°åˆ—è¡¨ç­‰ä¿¡æ¯ã€‚æ´»åŠ¨å¯¹è±¡å°†æ–¹æ³•è°ƒç”¨è¯·æ±‚å°è£…ä¸ºä¸€ä¸ªæ¶ˆæ¯å¯¹è±¡ï¼Œå¹¶æ·»åŠ åˆ°å†…éƒ¨çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚ æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessage Queueï¼‰ï¼šæ¶ˆæ¯é˜Ÿåˆ—æ˜¯æ´»åŠ¨å¯¹è±¡å†…éƒ¨ç”¨äºå­˜å‚¨æ–¹æ³•è°ƒç”¨è¯·æ±‚çš„é˜Ÿåˆ—ã€‚æ´»åŠ¨å¯¹è±¡å°†å®¢æˆ·ç«¯ä»£ç å‘é€çš„æ¶ˆæ¯æ·»åŠ åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå¹¶ä½¿ç”¨å•ç‹¬çš„çº¿ç¨‹å¼‚æ­¥å¤„ç†è¿™äº›æ¶ˆæ¯ã€‚ çº¿ç¨‹æ± ï¼ˆThread Poolï¼‰ï¼šçº¿ç¨‹æ± æ˜¯æ´»åŠ¨å¯¹è±¡ç”¨äºå¼‚æ­¥å¤„ç†æ¶ˆæ¯çš„çº¿ç¨‹æ± ã€‚æ´»åŠ¨å¯¹è±¡ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯ï¼Œå¹¶ä½¿ç”¨çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¼‚æ­¥å¤„ç†è¿™äº›æ¶ˆæ¯ã€‚ ç¨‹åºç¤ºä¾‹\npublic abstract class ActiveCreature{ private final Logger logger = LoggerFactory.getLogger(ActiveCreature.class.getName()); private BlockingQueue\u0026lt;Runnable\u0026gt; requests; private String name; private Thread thread; public ActiveCreature(String name) { this.name = name; this.requests = new LinkedBlockingQueue\u0026lt;Runnable\u0026gt;(); thread = new Thread(new Runnable() { @Override public void run() { while (true) { try { requests.take().run(); } catch (InterruptedException e) { logger.error(e.getMessage()); } } } } ); thread.start(); } public void eat() throws InterruptedException { requests.put(new Runnable() { @Override public void run() { logger.info(\u0026#34;{} is eating!\u0026#34;,name()); logger.info(\u0026#34;{} has finished eating!\u0026#34;,name()); } } ); } public void roam() throws InterruptedException { requests.put(new Runnable() { @Override public void run() { logger.info(\u0026#34;{} has started to roam and the wastelands.\u0026#34;,name()); } } ); } public String name() { return this.name; } } åœ¨è¯¥ç¤ºä¾‹ä»£ç ä¸­ï¼ŒActiveCreature ç±»å°è£…äº†ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œç”¨äºå¼‚æ­¥å¤„ç†å®¢æˆ·ç«¯ä»£ç å‘é€çš„æ¶ˆæ¯ã€‚å…·ä½“æ¥è¯´ï¼Œè¯¥ç¤ºä¾‹ä»£ç åŒ…å«ä»¥ä¸‹å‡ ä¸ªå…³é”®ç»„ä»¶ï¼š\nBlockingQueue\u0026lt;Runnable\u0026gt; ç±»å‹çš„ requests å±æ€§ï¼šè¯¥å±æ€§è¡¨ç¤ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œç”¨äºå­˜å‚¨å®¢æˆ·ç«¯ä»£ç å‘é€çš„æ¶ˆæ¯ã€‚å®¢æˆ·ç«¯ä»£ç å¯ä»¥é€šè¿‡ eat() å’Œ roam() æ–¹æ³•å‘æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ·»åŠ æ¶ˆæ¯ã€‚ Thread ç±»å‹çš„ thread å±æ€§ï¼šè¯¥å±æ€§è¡¨ç¤ºæ´»åŠ¨å¯¹è±¡çš„çº¿ç¨‹ï¼Œç”¨äºå¼‚æ­¥å¤„ç†æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚ String ç±»å‹çš„ name å±æ€§ï¼šè¯¥å±æ€§è¡¨ç¤ºæ´»åŠ¨å¯¹è±¡çš„åç§°ã€‚ ActiveCreature(String name) æ„é€ æ–¹æ³•ï¼šè¯¥æ–¹æ³•ç”¨äºåˆ›å»ºä¸€ä¸ªæ´»åŠ¨å¯¹è±¡ï¼Œåˆå§‹åŒ–æ¶ˆæ¯é˜Ÿåˆ—å’Œçº¿ç¨‹ç­‰å±æ€§ã€‚åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œå¹¶ä½¿ç”¨ requests.take().run() ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯å¹¶å¼‚æ­¥å¤„ç†ã€‚ eat() å’Œ roam() æ–¹æ³•ï¼šè¿™ä¸¤ä¸ªæ–¹æ³•ç”¨äºå‘æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ·»åŠ æ¶ˆæ¯ï¼Œè¡¨ç¤ºæ´»åŠ¨å¯¹è±¡æ­£åœ¨åƒå’Œæ¼«æ¸¸ã€‚åœ¨è¿™ä¸¤ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å°†ä¸€ä¸ª Runnable å¯¹è±¡æ·»åŠ åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå¹¶åœ¨å…¶ run() æ–¹æ³•ä¸­æ‰§è¡Œç›¸åº”çš„æ“ä½œï¼Œå¦‚è¾“å‡ºæ—¥å¿—ç­‰ã€‚ name() æ–¹æ³•ï¼šè¯¥æ–¹æ³•ç”¨äºè·å–æ´»åŠ¨å¯¹è±¡çš„åç§°ã€‚ åœ¨æ€»ä½“ä¸Šï¼Œè¯¥ç¤ºä¾‹ä»£ç å®ç°äº†æ´»åŠ¨å¯¹è±¡æ¨¡å¼çš„åŸºæœ¬åŠŸèƒ½ï¼Œå°†å¹¶å‘å’Œå¼‚æ­¥å¤„ç†çš„é—®é¢˜ä»å®¢æˆ·ç«¯ä»£ç ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå¹¶æä¾›äº†ç®€å•çš„æ¥å£ä¾›å®¢æˆ·ç«¯è°ƒç”¨ã€‚å®¢æˆ·ç«¯ä»£ç åªéœ€è¦è°ƒç”¨ eat() å’Œ roam() æ–¹æ³•å³å¯ï¼Œä¸éœ€è¦å…³å¿ƒå¼‚æ­¥å¤„ç†çš„ç»†èŠ‚ï¼Œæ´»åŠ¨å¯¹è±¡å°†å¹¶å‘å’Œå¼‚æ­¥å¤„ç†çš„é—®é¢˜å°è£…èµ·æ¥ï¼Œæä¾›ç®€å•çš„æ¥å£ä¾›å®¢æˆ·ç«¯ä½¿ç”¨ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¯¥ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†é˜»å¡é˜Ÿåˆ— BlockingQueue\u0026lt;Runnable\u0026gt; æ¥å®ç°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—æä¾›äº†çº¿ç¨‹å®‰å…¨çš„æ·»åŠ å’Œç§»é™¤æ“ä½œï¼Œä¿è¯äº†æ¶ˆæ¯çš„æœ‰åºæ€§å’Œæ­£ç¡®æ€§ã€‚åŒæ—¶ï¼Œåœ¨æ´»åŠ¨å¯¹è±¡çš„çº¿ç¨‹ä¸­ä½¿ç”¨äº† requests.take().run() æ“ä½œæ¥ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯å¹¶å¼‚æ­¥å¤„ç†ï¼Œè¿™ç§æ–¹å¼å¯ä»¥ä¿è¯æ¶ˆæ¯çš„æœ‰åºæ€§å’Œæ­£ç¡®æ€§ï¼Œå¹¶é¿å…äº†ç«æ€æ¡ä»¶å’Œæ­»é”ç­‰é—®é¢˜ã€‚\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä»»ä½•å°†æ‰©å±• ActiveCreature çš„ç±»éƒ½å°†å…·æœ‰è‡ªå·±çš„æ§åˆ¶çº¿ç¨‹æ¥æ‰§è¡Œå’Œè°ƒç”¨æ–¹æ³•ã€‚\nä¾‹å¦‚ï¼Œå…½äººç±»ï¼š\npublic class Orc extends ActiveCreature { public Orc(String name) { super(name); } } ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºå¤šä¸ªç”Ÿç‰©ï¼Œä¾‹å¦‚å…½äººï¼Œå‘Šè¯‰ä»–ä»¬åƒä¸œè¥¿å’Œæ•£æ­¥ï¼Œç„¶åä»–ä»¬å°†åœ¨è‡ªå·±çš„æ§åˆ¶çº¿ç¨‹ä¸Šæ‰§è¡Œå®ƒï¼š\npublic static void main(String[] args) { var app = new App(); app.run(); } @Override public void run() { ActiveCreature creature; try { for (int i = 0;i \u0026lt; creatures;i++) { creature = new Orc(Orc.class.getSimpleName().toString() + i); creature.eat(); creature.roam(); } Thread.sleep(1000); } catch (InterruptedException e) { logger.error(e.getMessage()); } Runtime.getRuntime().exit(1); } ç±»å›¾ ä¸¾ä¾‹ ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„æ´»åŠ¨å¯¹è±¡ç¤ºä¾‹ä»£ç ï¼š\nimport java.util.concurrent.ExecutorService; import java.util.concurrent.Executors; import java.util.concurrent.Future; public class ActiveObject { private final ExecutorService executor = Executors.newSingleThreadExecutor(); public Future\u0026lt;String\u0026gt; process(String message) { // åˆ›å»ºä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œå¹¶å°†å…¶æäº¤åˆ°çº¿ç¨‹æ± ä¸­ return executor.submit(() -\u0026gt; { // æ¨¡æ‹Ÿå¤æ‚çš„å¤„ç†é€»è¾‘ Thread.sleep(1000); // è¿”å›å¤„ç†ç»“æœ return \u0026#34;Processed message: \u0026#34; + message; }); } public void shutdown() { // å…³é—­çº¿ç¨‹æ±  executor.shutdown(); } } åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼ŒActiveObject ç±»å°è£…äº†ä¸€ä¸ªå¼‚æ­¥å¤„ç†æœåŠ¡ï¼Œå®¢æˆ·ç«¯ä»£ç å¯ä»¥ä½¿ç”¨è¯¥æœåŠ¡å¼‚æ­¥å¤„ç†æ¶ˆæ¯ã€‚ActiveObject ç±»ä¸­çš„ process() æ–¹æ³•æ¥æ”¶ä¸€ä¸ªæ¶ˆæ¯ï¼Œå¹¶å°†å…¶å°è£…ä¸ºä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œç„¶åæäº¤åˆ°çº¿ç¨‹æ± ä¸­å¼‚æ­¥å¤„ç†ã€‚process() æ–¹æ³•è¿”å›ä¸€ä¸ª Future å¯¹è±¡ï¼Œå¯ä»¥ç”¨äºè·å–å¼‚æ­¥å¤„ç†çš„ç»“æœã€‚åœ¨è¯¥ç¤ºä¾‹ä»£ç ä¸­ï¼Œå¼‚æ­¥ä»»åŠ¡åªæ˜¯ç®€å•åœ°æ¨¡æ‹Ÿäº†å¤„ç†é€»è¾‘ï¼Œå®é™…ä¸Šå¯ä»¥æ ¹æ®éœ€è¦ç¼–å†™æ›´åŠ å¤æ‚çš„å¼‚æ­¥å¤„ç†é€»è¾‘ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ ActiveObject ç±»çš„ç¤ºä¾‹ä»£ç ï¼š\nimport java.util.concurrent.ExecutionException; import java.util.concurrent.Future; public class Client { public static void main(String[] args) throws InterruptedException, ExecutionException { ActiveObject activeObject = new ActiveObject(); // å‘é€æ¶ˆæ¯åˆ°æ´»åŠ¨å¯¹è±¡ Future\u0026lt;String\u0026gt; future = activeObject.process(\u0026#34;Hello, world!\u0026#34;); // ç­‰å¾…å¼‚æ­¥å¤„ç†å®Œæˆï¼Œå¹¶è·å–å¤„ç†ç»“æœ String result = future.get(); System.out.println(result); // å…³é—­æ´»åŠ¨å¯¹è±¡ activeObject.shutdown(); } } åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œå®¢æˆ·ç«¯ä»£ç ä½¿ç”¨ ActiveObject ç±»å¼‚æ­¥å¤„ç†äº†ä¸€æ¡æ¶ˆæ¯ï¼Œå¹¶ç­‰å¾…å¼‚æ­¥å¤„ç†å®Œæˆåè·å–å¤„ç†ç»“æœã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä½¿ç”¨ ActiveObject ç±»æ—¶ï¼Œå®¢æˆ·ç«¯ä»£ç åªéœ€è¦å‘é€æ¶ˆæ¯å³å¯ï¼Œä¸éœ€è¦å…³å¿ƒå¼‚æ­¥å¤„ç†çš„ç»†èŠ‚ï¼Œä»è€Œä½¿å¾—å®¢æˆ·ç«¯ä»£ç æ›´åŠ ç®€å•å’Œæ˜“äºç»´æŠ¤ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªå¤æ‚çš„æ´»åŠ¨å¯¹è±¡ç¤ºä¾‹ä»£ç ï¼Œè¯¥ä»£ç æ¨¡æ‹Ÿäº†ä¸€ä¸ªé“¶è¡Œè´¦æˆ·ç³»ç»Ÿï¼Œæ”¯æŒå­˜æ¬¾ã€å–æ¬¾å’ŒæŸ¥è¯¢ä½™é¢ç­‰æ“ä½œã€‚\nimport java.util.concurrent.CompletableFuture; import java.util.concurrent.ExecutorService; import java.util.concurrent.Executors; public class BankAccount { private final ExecutorService executor = Executors.newSingleThreadExecutor(); private double balance; public BankAccount(double initialBalance) { this.balance = initialBalance; } public CompletableFuture\u0026lt;Double\u0026gt; deposit(double amount) { CompletableFuture\u0026lt;Double\u0026gt; future = new CompletableFuture\u0026lt;\u0026gt;(); executor.submit(() -\u0026gt; { balance += amount; future.complete(balance); }); return future; } public CompletableFuture\u0026lt;Double\u0026gt; withdraw(double amount) { CompletableFuture\u0026lt;Double\u0026gt; future = new CompletableFuture\u0026lt;\u0026gt;(); executor.submit(() -\u0026gt; { if (balance \u0026gt;= amount) { balance -= amount; future.complete(balance); } else { future.completeExceptionally(new InsufficientFundsException(\u0026#34;Insufficient funds\u0026#34;)); } }); return future; } public CompletableFuture\u0026lt;Double\u0026gt; getBalance() { CompletableFuture\u0026lt;Double\u0026gt; future = new CompletableFuture\u0026lt;\u0026gt;(); executor.submit(() -\u0026gt; { future.complete(balance); }); return future; } public void shutdown() { executor.shutdown(); } } class InsufficientFundsException extends RuntimeException { public InsufficientFundsException(String message) { super(message); } } ç¼ºç‚¹ è™½ç„¶æ´»åŠ¨å¯¹è±¡æ¨¡å¼å…·æœ‰è®¸å¤šä¼˜ç‚¹ï¼Œä½†ä¹Ÿå­˜åœ¨ä¸€äº›ç¼ºç‚¹ï¼Œå¦‚ä¸‹æ‰€è¿°ï¼š\nå¤æ‚æ€§ï¼šæ´»åŠ¨å¯¹è±¡æ¨¡å¼éœ€è¦ä½¿ç”¨å¼‚æ­¥å¤„ç†å’Œäº‹ä»¶é©±åŠ¨æœºåˆ¶ï¼Œè¿™å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚åœ¨è®¾è®¡ã€å®ç°å’Œæµ‹è¯•æ—¶ï¼Œéœ€è¦è€ƒè™‘è®¸å¤šå› ç´ ï¼Œå¦‚å¹¶å‘æ§åˆ¶ã€é”å®šã€æ­»é”ã€çº¿ç¨‹æ± å¤§å°ã€ä»»åŠ¡é˜Ÿåˆ—å¤§å°ç­‰ã€‚ æ€§èƒ½ä¸‹é™ï¼šåœ¨å¤„ç†å¤§é‡è¯·æ±‚æ—¶ï¼Œæ´»åŠ¨å¯¹è±¡æ¨¡å¼å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚è¿™æ˜¯å› ä¸ºæ´»åŠ¨å¯¹è±¡æ¨¡å¼éœ€è¦åˆ›å»ºè®¸å¤šçº¿ç¨‹å’Œä»»åŠ¡ï¼Œè¿™ä¼šå¢åŠ ç³»ç»Ÿçš„è´Ÿè½½å’Œå¼€é”€ã€‚æ­¤å¤–ï¼Œå¦‚æœä»»åŠ¡é˜Ÿåˆ—æˆ–çº¿ç¨‹æ± è¿‡å¤§ï¼Œä¼šå¯¼è‡´å†…å­˜å’Œ CPU èµ„æºçš„æµªè´¹ã€‚ è°ƒè¯•éš¾åº¦ï¼šç”±äºæ´»åŠ¨å¯¹è±¡æ¨¡å¼ä½¿ç”¨å¼‚æ­¥å¤„ç†å’Œäº‹ä»¶é©±åŠ¨æœºåˆ¶ï¼Œå› æ­¤åœ¨è°ƒè¯•æ—¶å¯èƒ½ä¼šå‡ºç°éš¾ä»¥é¢„æµ‹çš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œå¤šä¸ªçº¿ç¨‹å¯èƒ½ä¼šåŒæ—¶è®¿é—®å…±äº«èµ„æºï¼Œå¯¼è‡´æ­»é”æˆ–ç«æ€æ¡ä»¶ï¼Œä»è€Œå¯¼è‡´åº”ç”¨ç¨‹åºå´©æºƒæˆ–å‡ºç°å…¶ä»–é—®é¢˜ã€‚ çŠ¶æ€ç®¡ç†ï¼šç”±äºæ´»åŠ¨å¯¹è±¡æ¨¡å¼ä½¿ç”¨å¼‚æ­¥å¤„ç†å’Œäº‹ä»¶é©±åŠ¨æœºåˆ¶ï¼Œå› æ­¤åœ¨å¤„ç†è¯·æ±‚æ—¶éœ€è¦ç®¡ç†å¯¹è±¡çš„çŠ¶æ€ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´çŠ¶æ€åŒæ­¥å’ŒçŠ¶æ€ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œä»è€Œå½±å“ç³»ç»Ÿçš„æ­£ç¡®æ€§å’Œå¯é æ€§ã€‚ ç¼ºä¹æ ‡å‡†åŒ–ï¼šæ´»åŠ¨å¯¹è±¡æ¨¡å¼æ²¡æœ‰æ ‡å‡†åŒ–çš„å®ç°æ–¹å¼ï¼Œå› æ­¤åœ¨ä¸åŒçš„åº”ç”¨ç¨‹åºå’Œæ¡†æ¶ä¸­å¯èƒ½ä¼šæœ‰ä¸åŒçš„å®ç°æ–¹å¼å’Œé™åˆ¶ã€‚è¿™ä½¿å¾—æ´»åŠ¨å¯¹è±¡æ¨¡å¼åœ¨ä¸åŒçš„ç¯å¢ƒä¸­éš¾ä»¥ç§»æ¤å’Œé‡ç”¨ã€‚ æ€»çš„æ¥è¯´ï¼Œæ´»åŠ¨å¯¹è±¡æ¨¡å¼æ˜¯ä¸€ç§å¼ºå¤§çš„è®¾è®¡æ¨¡å¼ï¼Œå¯ä»¥ç”¨äºå®ç°å¼‚æ­¥å¤„ç†ã€äº‹ä»¶é©±åŠ¨ã€é«˜æ€§èƒ½ã€å¯ä¼¸ç¼©å’Œå¯é çš„åº”ç”¨ç¨‹åºã€‚ä½†æ˜¯ï¼Œå®ƒä¹Ÿå­˜åœ¨ä¸€äº›ç¼ºç‚¹ï¼Œéœ€è¦ä»”ç»†è€ƒè™‘å’Œæƒè¡¡ã€‚åœ¨ä½¿ç”¨æ´»åŠ¨å¯¹è±¡æ¨¡å¼æ—¶ï¼Œéœ€è¦å…³æ³¨ç³»ç»Ÿçš„å¤æ‚æ€§ã€æ€§èƒ½ã€è°ƒè¯•éš¾åº¦ã€çŠ¶æ€ç®¡ç†å’Œæ ‡å‡†åŒ–ç­‰é—®é¢˜ã€‚\nåº”ç”¨ åœ¨å¼€æºæ¡†æ¶ä¸­çš„åº”ç”¨ æ´»åŠ¨å¯¹è±¡è®¾è®¡æ¨¡å¼åœ¨è®¸å¤šå¼€æºæ¡†æ¶ä¸­éƒ½å¾—åˆ°äº†å¹¿æ³›åº”ç”¨ï¼Œä»¥ä¸‹æ˜¯å‡ ä¸ªå¸¸è§çš„ä¾‹å­ï¼š\nAkka æ¡†æ¶ï¼šAkka æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ Actor æ¨¡å‹æ¡†æ¶ï¼Œé€šè¿‡å°†å¹¶å‘å’Œå¼‚æ­¥å¤„ç†çš„é—®é¢˜ä»å®¢æˆ·ç«¯ä»£ç ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œæé«˜äº†ç³»ç»Ÿçš„æ€§èƒ½ã€å¯é æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚åœ¨ Akka ä¸­ï¼Œæ¯ä¸ª Actor éƒ½æ˜¯ä¸€ä¸ªæ´»åŠ¨å¯¹è±¡ï¼Œé€šè¿‡æ¶ˆæ¯ä¼ é€’çš„æ–¹å¼è¿›è¡Œé€šä¿¡å’Œåä½œã€‚Akka æä¾›äº†ä¸°å¯Œçš„ API å’Œå·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿åœ°åˆ›å»ºå’Œç®¡ç† Actorï¼Œå®ç°é«˜æ€§èƒ½å’Œå¯æ‰©å±•çš„ç³»ç»Ÿã€‚ Vert.x æ¡†æ¶ï¼šVert.x æ˜¯ä¸€ä¸ªåŸºäºäº‹ä»¶é©±åŠ¨çš„å¼‚æ­¥æ¡†æ¶ï¼Œæä¾›äº†å¤šç§è¯­è¨€çš„ API å’Œå·¥å…·ï¼Œæ”¯æŒæ„å»ºé«˜æ€§èƒ½å’Œå¯æ‰©å±•çš„åº”ç”¨ç¨‹åºã€‚åœ¨ Vert.x ä¸­ï¼Œæ¯ä¸ªç»„ä»¶éƒ½æ˜¯ä¸€ä¸ªæ´»åŠ¨å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡ Vert.x çš„äº‹ä»¶æ€»çº¿è¿›è¡Œé€šä¿¡å’Œåä½œã€‚Vert.x æä¾›äº†ä¸°å¯Œçš„å¼‚æ­¥ API å’Œå·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å¤„ç†å¹¶å‘å’Œå¼‚æ­¥é—®é¢˜ã€‚ RxJava æ¡†æ¶ï¼šRxJava æ˜¯ä¸€ä¸ªåŸºäºå“åº”å¼ç¼–ç¨‹çš„å¼‚æ­¥æ¡†æ¶ï¼Œæä¾›äº†ä¸°å¯Œçš„æ“ä½œç¬¦å’Œå·¥å…·ï¼Œæ”¯æŒæ„å»ºé«˜æ€§èƒ½å’Œå¯ç»´æŠ¤çš„åº”ç”¨ç¨‹åºã€‚åœ¨ RxJava ä¸­ï¼Œæ¯ä¸ª Observable éƒ½æ˜¯ä¸€ä¸ªæ´»åŠ¨å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡å¼‚æ­¥æµçš„æ–¹å¼è¿›è¡Œé€šä¿¡å’Œåä½œã€‚RxJava æä¾›äº†ä¸°å¯Œçš„æ“ä½œç¬¦å’Œå·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å¤„ç†å¹¶å‘å’Œå¼‚æ­¥é—®é¢˜ï¼Œå¹¶æ”¯æŒå“åº”å¼ç¼–ç¨‹çš„å¤šç§ç‰¹æ€§ï¼Œå¦‚å“åº”å¼æµã€èƒŒå‹æ§åˆ¶ç­‰ã€‚ Netty æ¡†æ¶ï¼šNetty æ˜¯ä¸€ä¸ªåŸºäºäº‹ä»¶é©±åŠ¨çš„å¼‚æ­¥ç½‘ç»œé€šä¿¡æ¡†æ¶ï¼Œæä¾›äº†ä¸°å¯Œçš„ API å’Œå·¥å…·ï¼Œæ”¯æŒæ„å»ºé«˜æ€§èƒ½å’Œå¯æ‰©å±•çš„ç½‘ç»œåº”ç”¨ç¨‹åºã€‚åœ¨ Netty ä¸­ï¼Œæ¯ä¸ª Channel éƒ½æ˜¯ä¸€ä¸ªæ´»åŠ¨å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡äº‹ä»¶çš„æ–¹å¼è¿›è¡Œé€šä¿¡å’Œåä½œã€‚Netty æä¾›äº†ä¸°å¯Œçš„å¼‚æ­¥ API å’Œå·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å¤„ç†ç½‘ç»œé€šä¿¡å’Œå¼‚æ­¥é—®é¢˜ï¼Œå¹¶æ”¯æŒå¤šç§åè®®å’Œç¼–è§£ç å™¨ã€‚ Spring æ¡†æ¶ï¼šSpring æ˜¯ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„ä¼ä¸šçº§ Java æ¡†æ¶ï¼Œæä¾›äº†ä¸°å¯Œçš„ API å’Œå·¥å…·ï¼Œæ”¯æŒæ„å»ºé«˜æ€§èƒ½å’Œå¯ç»´æŠ¤çš„åº”ç”¨ç¨‹åºã€‚åœ¨ Spring ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¼‚æ­¥å¤„ç†ã€å“åº”å¼ç¼–ç¨‹å’Œäº‹ä»¶é©±åŠ¨ç­‰æ–¹å¼å®ç°æ´»åŠ¨å¯¹è±¡æ¨¡å¼ã€‚Spring æä¾›äº†ä¸°å¯Œçš„å¼‚æ­¥ API å’Œå·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å¤„ç†å¼‚æ­¥å’Œå¹¶å‘é—®é¢˜ã€‚ JMS æ¡†æ¶ï¼šJMS æ˜¯ Java æ¶ˆæ¯æœåŠ¡çš„æ ‡å‡†ï¼Œæä¾›äº†å¼‚æ­¥æ¶ˆæ¯ä¼ é€’çš„æ–¹å¼ï¼Œæ”¯æŒæ„å»ºå¯é ã€é«˜æ€§èƒ½å’Œå¯æ‰©å±•çš„æ¶ˆæ¯ç³»ç»Ÿã€‚åœ¨ JMS ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ´»åŠ¨å¯¹è±¡æ¨¡å¼å®ç°å¼‚æ­¥æ¶ˆæ¯çš„å¤„ç†å’Œåˆ†å‘ã€‚JMS æä¾›äº†ä¸°å¯Œçš„ API å’Œå·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å¤„ç†å¼‚æ­¥æ¶ˆæ¯çš„ç”Ÿäº§å’Œæ¶ˆè´¹ã€‚ Apache Camel æ¡†æ¶ï¼šApache Camel æ˜¯ä¸€ä¸ªåŸºäºä¼ä¸šçº§é›†æˆæ¨¡å¼çš„å¼€æºæ¡†æ¶ï¼Œæä¾›äº†ä¸°å¯Œçš„ç»„ä»¶å’Œå·¥å…·ï¼Œæ”¯æŒæ„å»ºå¯æ‰©å±•ã€é«˜æ€§èƒ½å’Œå¯é çš„åº”ç”¨ç¨‹åºã€‚åœ¨ Camel ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ´»åŠ¨å¯¹è±¡æ¨¡å¼å®ç°å¼‚æ­¥æ¶ˆæ¯çš„å¤„ç†å’Œè·¯ç”±ã€‚Camel æä¾›äº†ä¸°å¯Œçš„ç»„ä»¶å’Œå·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å¤„ç†å¼‚æ­¥æ¶ˆæ¯çš„è·¯ç”±å’Œè½¬æ¢ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ Spring å¼‚æ­¥å¤„ç†å’Œäº‹ä»¶é©±åŠ¨æœºåˆ¶å®ç°æ´»åŠ¨å¯¹è±¡æ¨¡å¼çš„ç¤ºä¾‹ä»£ç ï¼Œè¯¥ç¤ºä¾‹ä»£ç ä½¿ç”¨äº† Spring Boot æ¡†æ¶å’Œ Spring Reactor åº“ï¼š\nimport org.springframework.beans.factory.annotation.Autowired; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.stereotype.Component; import reactor.core.publisher.Flux; import reactor.core.publisher.Mono; import reactor.core.scheduler.Schedulers; @Configuration public class AppConfig { @Bean public MessageHandler messageHandler() { return new MessageHandler(); } } @Component public class MessageHandler { @Autowired private MessageRepository messageRepository; public Mono\u0026lt;Void\u0026gt; handleMessage(String message) { return Mono.fromCallable(() -\u0026gt; { // å¤„ç†æ¶ˆæ¯ System.out.println(\u0026#34;Received message: \u0026#34; + message); messageRepository.save(new Message(message)); return null; }).subscribeOn(Schedulers.boundedElastic()); } public Flux\u0026lt;Message\u0026gt; getAllMessages() { return Flux.defer(() -\u0026gt; Flux.fromIterable(messageRepository.findAll())) .subscribeOn(Schedulers.boundedElastic()); } } @Entity public class Message { @Id @GeneratedValue(strategy = GenerationType.IDENTITY) private Long id; private String content; public Message() {} public Message(String content) { this.content = content; } public Long getId() { return id; } } åœ¨ä¸Šè¿°ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª MessageHandler ç±»ä½œä¸ºæ´»åŠ¨å¯¹è±¡ï¼Œç”¨äºå¼‚æ­¥å¤„ç†æ¶ˆæ¯çš„æ¥æ”¶å’Œå­˜å‚¨ã€‚è¯¥ç±»ä½¿ç”¨äº† Spring å¼‚æ­¥å¤„ç†å’Œäº‹ä»¶é©±åŠ¨æœºåˆ¶æ¥å®ç°æ´»åŠ¨å¯¹è±¡æ¨¡å¼ï¼Œå®¢æˆ·ç«¯ä»£ç åªéœ€è¦è°ƒç”¨ç›¸åº”çš„æ–¹æ³•å³å¯ï¼Œä¸éœ€è¦å…³å¿ƒå¼‚æ­¥å¤„ç†çš„ç»†èŠ‚ã€‚\nå…·ä½“æ¥è¯´ï¼Œè¯¥ç¤ºä¾‹ä»£ç åŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š\nAppConfig é…ç½®ç±»ï¼šè¯¥ç±»ç”¨äºé…ç½® Spring Beanï¼Œå®šä¹‰äº†ä¸€ä¸ª messageHandler() æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ª MessageHandler å¯¹è±¡ã€‚\nMessageHandler æ´»åŠ¨å¯¹è±¡ç±»ï¼šè¯¥ç±»åŒ…å«äº†ä¸¤ä¸ªæ–¹æ³•ï¼šhandleMessage() å’Œ getAllMessages()ã€‚handleMessage() æ–¹æ³•ç”¨äºå¤„ç†æ¶ˆæ¯ï¼Œå°†æ¶ˆæ¯å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼›getAllMessages() æ–¹æ³•ç”¨äºè·å–æ‰€æœ‰çš„æ¶ˆæ¯ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½ä½¿ç”¨äº† Spring çš„å¼‚æ­¥å¤„ç†æœºåˆ¶å’Œäº‹ä»¶é©±åŠ¨æœºåˆ¶ï¼Œä½¿ç”¨äº† Reactor åº“ä¸­çš„ Mono å’Œ Flux ç±»ã€‚\nMessage JPA å®ä½“ç±»ï¼šè¯¥ç±»ç”¨äºè¡¨ç¤ºæ¶ˆæ¯å¯¹è±¡ï¼Œä½¿ç”¨äº† JPA æ³¨è§£ã€‚\nåœ¨ handleMessage() æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Mono.fromCallable() æ–¹æ³•æ¥å¼‚æ­¥å¤„ç†æ¶ˆæ¯çš„æ¥æ”¶å’Œå­˜å‚¨ï¼Œå°†å¤„ç†æ“ä½œæäº¤åˆ°çº¿ç¨‹æ± ä¸­æ‰§è¡Œï¼Œç„¶åè¿”å› Mono\u0026lt;Void\u0026gt; å¯¹è±¡ï¼Œä»¥ä¾¿å®¢æˆ·ç«¯ä»£ç å¯ä»¥ç­‰å¾…å¤„ç†æ“ä½œå®Œæˆã€‚æˆ‘ä»¬è¿˜ä½¿ç”¨äº† subscribeOn() æ–¹æ³•æ¥æŒ‡å®šå¼‚æ­¥å¤„ç†çš„çº¿ç¨‹æ± ï¼Œä»¥æé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§ã€‚\nåœ¨ getAllMessages() æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Flux.defer() æ–¹æ³•æ¥å¼‚æ­¥è·å–æ‰€æœ‰çš„æ¶ˆæ¯ï¼Œå°†è·å–æ“ä½œæäº¤åˆ°çº¿ç¨‹æ± ä¸­æ‰§è¡Œï¼Œç„¶åè¿”å› Flux\u0026lt;Message\u0026gt; å¯¹è±¡ï¼Œä»¥ä¾¿å®¢æˆ·ç«¯ä»£ç å¯ä»¥å¼‚æ­¥è·å–æ¶ˆæ¯ã€‚æˆ‘ä»¬åŒæ ·ä½¿ç”¨äº† subscribeOn() æ–¹æ³•æ¥æŒ‡å®šå¼‚æ­¥å¤„ç†çš„çº¿ç¨‹æ± ã€‚\né€šè¿‡ä½¿ç”¨ Spring å¼‚æ­¥å¤„ç†å’Œäº‹ä»¶é©±åŠ¨æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°é«˜æ€§èƒ½ã€å¯é å’Œå¯æ‰©å±•çš„æ´»åŠ¨å¯¹è±¡æ¨¡å¼ï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨æ´»åŠ¨å¯¹è±¡æ¨¡å¼å®ç°å¼‚æ­¥æ¶ˆæ¯å¤„ç†å’Œåˆ†å‘çš„ JMS ç¤ºä¾‹ä»£ç ï¼Œè¯¥ç¤ºä¾‹ä»£ç ä½¿ç”¨äº† ActiveMQ ä½œä¸º JMS æ¶ˆæ¯ä¸­é—´ä»¶ï¼š\nimport javax.jms.*; import org.apache.activemq.ActiveMQConnectionFactory; import java.util.concurrent.CompletableFuture; import java.util.concurrent.ExecutorService; import java.util.concurrent.Executors; public class JMSMessageHandler implements MessageListener { private final ExecutorService executor = Executors.newSingleThreadExecutor(); private Connection connection; private Session session; private Destination destination; public JMSMessageHandler(String brokerUrl, String destinationName) throws JMSException { ConnectionFactory connectionFactory = new ActiveMQConnectionFactory(brokerUrl); connection = connectionFactory.createConnection(); connection.start(); session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE); destination = session.createQueue(destinationName); MessageConsumer consumer = session.createConsumer(destination); consumer.setMessageListener(this); } public CompletableFuture\u0026lt;Void\u0026gt; send(String message) { CompletableFuture\u0026lt;Void\u0026gt; future = new CompletableFuture\u0026lt;\u0026gt;(); executor.submit(() -\u0026gt; { try { TextMessage textMessage = session.createTextMessage(message); MessageProducer producer = session.createProducer(destination); producer.send(textMessage); future.complete(null); } catch (JMSException e) { future.completeExceptionally(e); } }); return future; } public void onMessage(Messagemessage) { CompletableFuture.runAsync(() -\u0026gt; { try { if (message instanceof TextMessage) { TextMessage textMessage = (TextMessage) message; String text = textMessage.getText(); // å¤„ç†æ¶ˆæ¯ System.out.println(\u0026#34;Received message: \u0026#34; + text); } } catch (JMSException e) { e.printStackTrace(); } }); } public void close() throws JMSException { connection.close(); executor.shutdown(); } } åœ¨ä¸Šè¿°ç¤ºä¾‹ä»£ç ä¸­ï¼ŒJMSMessageHandler ç±»è¡¨ç¤ºä¸€ä¸ª JMS æ¶ˆæ¯å¤„ç†å™¨ï¼Œå¯ä»¥å¼‚æ­¥å¤„ç†æ¥è‡ª JMS é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œå¹¶å°†å¤„ç†ç»“æœå‘é€å› JMS é˜Ÿåˆ—ã€‚è¯¥ç±»ä½¿ç”¨äº†æ´»åŠ¨å¯¹è±¡æ¨¡å¼æ¥å®ç°å¼‚æ­¥æ¶ˆæ¯çš„å¤„ç†å’Œåˆ†å‘ï¼Œå®¢æˆ·ç«¯ä»£ç åªéœ€è¦å‘é€æ¶ˆæ¯å³å¯ï¼Œä¸éœ€è¦å…³å¿ƒå¼‚æ­¥å¤„ç†çš„ç»†èŠ‚ã€‚\nå…·ä½“æ¥è¯´ï¼Œè¯¥ç±»åŒ…å«ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•ï¼š\nJMSMessageHandler(String brokerUrl, String destinationName) æ„é€ æ–¹æ³•ï¼šè¯¥æ–¹æ³•ç”¨äºåˆ›å»ºä¸€ä¸ª JMS æ¶ˆæ¯å¤„ç†å™¨å¯¹è±¡ï¼Œè¿æ¥åˆ°æŒ‡å®šçš„ JMS æ¶ˆæ¯ä¸­é—´ä»¶å¹¶è®¢é˜…æŒ‡å®šçš„é˜Ÿåˆ—ã€‚\nsend(String message) æ–¹æ³•ï¼šè¯¥æ–¹æ³•ç”¨äºå‘é€æ¶ˆæ¯åˆ° JMS é˜Ÿåˆ—ä¸­ï¼Œå®¢æˆ·ç«¯ä»£ç å¯ä»¥è°ƒç”¨è¯¥æ–¹æ³•å°†æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ã€‚\nonMessage(Message message) æ–¹æ³•ï¼šè¯¥æ–¹æ³•æ˜¯ MessageListener æ¥å£çš„å›è°ƒæ–¹æ³•ï¼Œç”¨äºå¼‚æ­¥å¤„ç†é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œå¹¶å°†å¤„ç†ç»“æœå‘é€å› JMS é˜Ÿåˆ—ã€‚\nclose() æ–¹æ³•ï¼šè¯¥æ–¹æ³•ç”¨äºå…³é—­ JMS è¿æ¥å’Œçº¿ç¨‹æ± ï¼Œé‡Šæ”¾èµ„æºã€‚\nåœ¨ send() æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† CompletableFuture å¯¹è±¡æ¥å¼‚æ­¥å¤„ç†æ¶ˆæ¯çš„å‘é€ï¼Œå°†å‘é€æ“ä½œæäº¤åˆ°çº¿ç¨‹æ± ä¸­æ‰§è¡Œï¼Œç„¶åè¿”å› CompletableFuture å¯¹è±¡ï¼Œä»¥ä¾¿å®¢æˆ·ç«¯ä»£ç å¯ä»¥ç­‰å¾…å‘é€æ“ä½œå®Œæˆã€‚\nåœ¨ onMessage() æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† CompletableFuture.runAsync() æ–¹æ³•æ¥å¼‚æ­¥å¤„ç†æ¶ˆæ¯çš„å¤„ç†ï¼Œå°†å¤„ç†æ“ä½œæäº¤åˆ°çº¿ç¨‹æ± ä¸­æ‰§è¡Œï¼Œç„¶åè¿”å› CompletableFuture å¯¹è±¡ï¼Œä»¥ä¾¿å®¢æˆ·ç«¯ä»£ç å¯ä»¥ç­‰å¾…å¤„ç†æ“ä½œå®Œæˆã€‚\né€šè¿‡ä½¿ç”¨æ´»åŠ¨å¯¹è±¡æ¨¡å¼å’Œå¼‚æ­¥å¤„ç†æŠ€æœ¯ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°é«˜æ€§èƒ½ã€å¯é å’Œå¯æ‰©å±•çš„ JMS æ¶ˆæ¯å¤„ç†å™¨ï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§ã€‚\nåœ¨é¡¹ç›®ä¸­çš„ä½¿ç”¨ åœ¨å…¬å¸çš„é¡¹ç›®ä¸­ï¼Œç”¨åˆ°è¿‡æ´»åŠ¨å¯¹è±¡è¿™ä¸ªè®¾è®¡æ¨¡å¼ï¼Œåªæ˜¯ä¹‹å‰å¹¶ä¸æ¸…æ¥šè¿™ä¸ªæ¨¡å¼ã€‚ä½¿ç”¨åœºæ™¯æ˜¯ï¼Œå‘é€é£ä¹¦é€šçŸ¥å’Œæ‹¨æ‰“è¯­éŸ³ç”µè¯æ—¶ï¼Œå°†è¯·æ±‚æ·»åŠ åˆ°ä¸€ä¸ªå†…éƒ¨é˜»å¡é˜Ÿåˆ—ï¼Œç„¶åå•ç‹¬å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹å»æ¶ˆè´¹è¿™ä¸ªé˜Ÿåˆ—ã€‚\nä»¥ä¸‹æ˜¯æ‹¨æ‰“è¯­éŸ³ç”µè¯çš„ä»£ç ï¼š\n/** * Tencent Cloud Vms SendTtsVoice * https://cloud.tencent.com/document/product/1128/51558 */ @Slf4j @AllArgsConstructor public class VmsServiceImpl implements VmsService { public static final String PREFIX_PHONE = \u0026#34;86\u0026#34;; private static final BlockingQueue\u0026lt;VoiceSenderRequest\u0026gt; queue = new LinkedBlockingQueue\u0026lt;\u0026gt;(); private TtsVoiceSender ttsVoiceSender; private final AsyncVmsThread asyncVmsThread = new AsyncVmsThread(); @PostConstruct public void init() { asyncVmsThread.start(); } @PreDestroy public void destroy() { asyncVmsThread.shutdown(); } public void sendAsync(Collection\u0026lt;NoticeTarget\u0026gt; noticeUsers, Integer templateId, String[] params) { if (templateId == null || CollectionUtils.isEmpty(noticeUsers)) { return; } for (NoticeTarget noticeUser : noticeUsers) { if (!noticeUser.getType().equals(NoticeTargetTypeEnum.PHONE)) { continue; } try { queue.put(new VoiceSenderRequest().setNoticeUser(noticeUser).setTemplateId(templateId).setParams(params)); } catch (InterruptedException e) { throw new BusinessException(\u0026#34;çº¿ç¨‹è¢«ä¸­æ–­\u0026#34;); } } } public Boolean send(String phone, Integer templateId, String[] params) { if (templateId == null || StringUtils.isBlank(phone)) { throw new BusinessException(\u0026#34;å‚æ•°ä¸èƒ½ä¸ºç©º\u0026#34;); } TtsVoiceSenderResult ttsVoiceSenderResult = null; try { ttsVoiceSenderResult = ttsVoiceSender.send(PREFIX_PHONE, phone, templateId, params, 2, \u0026#34;\u0026#34;); } catch (Exception e) { throw new RuntimeException(e); } if (ttsVoiceSenderResult.result != 0) { throw new BusinessException(ttsVoiceSenderResult.errMsg); } return ttsVoiceSenderResult.result == 0; } public class AsyncVmsThread extends Thread { AtomicBoolean isRunning = new AtomicBoolean(true); public AsyncVmsThread() { super(\u0026#34;vmsSender\u0026#34;); } @Override public void run() { while (isRunning.get()) { ThreadUtil.sleep(2000L); VoiceSenderRequest voiceSenderRequest = null; try { voiceSenderRequest = queue.take(); send(voiceSenderRequest.getNoticeUser().getId(), voiceSenderRequest.getTemplateId(), voiceSenderRequest.getParams()); } catch (Exception e) { log.warn(\u0026#34;{}\u0026#34;, String.format(\u0026#34;å‘é€è¯­éŸ³ç”µè¯ç»™[%s]å‡ºç°å¼‚å¸¸: %s\u0026#34;, voiceSenderRequest.getNoticeUser(), e.getMessage()), e); } } } public void shutdown() { isRunning.set(false); } } @Data @Accessors(chain = true) public class VoiceSenderRequest { private NoticeTarget noticeUser; private Integer templateId; private String[] params; } } ä¼˜åŒ–ä¹‹åçš„ä»£ç ï¼š\n@Slf4j public abstract class ActiveObject { private BlockingQueue\u0026lt;Runnable\u0026gt; requests; private String name; private Thread thread; private volatile boolean isAcceptingRequests = true; private volatile boolean isProcessingRequests = true; public ActiveObject(String name) { this(name, 16, null); } public ActiveObject(String name, int queueSize, Long sleepMillis) { this.name = name; this.requests = new LinkedBlockingQueue\u0026lt;\u0026gt;(queueSize); thread = new Thread(() -\u0026gt; { while (isProcessingRequests) { try { processRequest(requests.take()); if (sleepMillis != null) { Thread.sleep(sleepMillis); } } catch (InterruptedException e) { log.warn(\u0026#34;Active Object thread interrupted, reason: {}\u0026#34;, e.getMessage()); } } }, name); thread.start(); } private void processRequest(Runnable task) { try { task.run(); } catch (Exception e) { log.error(\u0026#34;Error processing request: {}\u0026#34;, e.getMessage()); // å‘é€å‘Šè­¦ä¿¡æ¯ } } public void shutdown() { isAcceptingRequests = false; while (!requests.isEmpty()) { try { Thread.sleep(100); } catch (InterruptedException e) { // Ignore exception } } isProcessingRequests = false; thread.interrupt(); } public void run(Runnable runnable) { if (isAcceptingRequests) { requests.offer(runnable); } else { throw new IllegalStateException(\u0026#34;Active object is no longer accepting requests\u0026#34;); } } public String name() { return this.name; } } è¯¥ç±»å…·æœ‰æ„é€ å‡½æ•°ï¼Œç”¨äºåˆ›å»ºå…·æœ‰ç»™å®šåç§°å’ŒæŒ‡å®šå¤§å°é˜»å¡è¯·æ±‚é˜Ÿåˆ—çš„ Active Objectã€‚Active Object åœ¨åå°çš„å•ç‹¬çº¿ç¨‹ä¸Šè¿è¡Œï¼Œè¯¥çº¿ç¨‹åœ¨å¾ªç¯ä¸­æ‰§è¡Œï¼Œç›´åˆ°è¢«ä¸­æ–­ã€‚å®ƒä½¿ç”¨runæ–¹æ³•æ‰§è¡Œæ·»åŠ åˆ°è¯·æ±‚é˜Ÿåˆ—ä¸­çš„è¯·æ±‚ã€‚runæ–¹æ³•æ¥å—ä¸€ä¸ªRunnableå¯¹è±¡ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°è¯·æ±‚é˜Ÿåˆ—ä¸­ã€‚å¦‚æœ Active Object ä¸å†æ¥å—è¯·æ±‚ï¼Œåˆ™æŠ›å‡ºIllegalStateExceptionã€‚\nshutdownæ–¹æ³•ç”¨äºåœæ­¢ Active Objectã€‚å®ƒé¦–å…ˆå°†isAcceptingRequestsæ ‡å¿—è®¾ç½®ä¸º falseï¼Œè¿™å°†é˜²æ­¢å°†ä»»ä½•è¿›ä¸€æ­¥çš„è¯·æ±‚æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ã€‚ç„¶åç­‰å¾…é˜Ÿåˆ—å˜ä¸ºç©ºï¼Œç„¶åå°†isProcessingRequestsæ ‡å¿—è®¾ç½®ä¸º falseï¼Œå¹¶ä¸­æ–­ Active Object çš„çº¿ç¨‹ã€‚\nè¿™ä¸ªç±»æœ¬èº«å·²ç»æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ Active Object æ¨¡å¼çš„å®ç°äº†ï¼Œä½†æ˜¯å¦‚æœéœ€è¦æ›´é«˜çš„æ€§èƒ½æˆ–æ›´å¥½çš„æ‰©å±•æ€§ï¼Œè¿˜å¯ä»¥è¿›è¡Œä¸€äº›ä¼˜åŒ–ï¼š\nä½¿ç”¨çº¿ç¨‹æ± ï¼šå½“å‰çš„å®ç°ä¸­ï¼Œæ¯ä¸ª Active Object éƒ½æœ‰ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹æ¥å¤„ç†è¯·æ±‚ã€‚å¦‚æœéœ€è¦å¤„ç†å¤§é‡çš„ Active Objectï¼Œè¿™å°†ä¼šäº§ç”Ÿå¾ˆå¤šçº¿ç¨‹ï¼Œä»è€Œå½±å“ç³»ç»Ÿçš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚å¯ä»¥ä½¿ç”¨çº¿ç¨‹æ± æ¥ç®¡ç†çº¿ç¨‹ï¼Œä»è€Œæ›´å¥½åœ°æ§åˆ¶çº¿ç¨‹çš„æ•°é‡å’Œèµ„æºçš„ä½¿ç”¨ã€‚\nå¦‚æœåœ¨ä½¿ç”¨ ActiveObject æ—¶è¦æ‰§è¡Œè€—æ—¶çš„ä»»åŠ¡ï¼Œå¯ä»¥å°†ä»»åŠ¡æ”¾åˆ°ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹æ± ä¸­æ‰§è¡Œï¼Œä»¥é¿å…é˜»å¡ ActiveObject å®ä¾‹çš„è¯·æ±‚å¤„ç†çº¿ç¨‹ã€‚\n@Slf4j public abstract class ActiveObject { private BlockingQueue\u0026lt;Runnable\u0026gt; requests; private String name; private ExecutorService executorService; private Thread thread; private volatile boolean isAcceptingRequests = true; private volatile boolean isProcessingRequests = true; public ActiveObject(String name) { this(name, 16, null); } public ActiveObject(String name, int queueSize, Long sleepMillis) { this.name = name; this.requests = new LinkedBlockingQueue\u0026lt;\u0026gt;(queueSize); this.executorService = Executors.newFixedThreadPool(5); thread = new Thread(() -\u0026gt; { while (isProcessingRequests) { try { processRequest(requests.take(), executorService); if (sleepMillis != null) { Thread.sleep(sleepMillis); } } catch (InterruptedException e) { log.warn(\u0026#34;Active Object thread interrupted, reason: {}\u0026#34;, e.getMessage()); } } }, name); thread.start(); } private void processRequest(Runnable task, ExecutorService executorService) { try { executorService.submit(task).get(); } catch (Exception e) { log.error(\u0026#34;Error processing request: {}\u0026#34;, e.getMessage()); // å‘é€å‘Šè­¦ä¿¡æ¯ } } public void shutdown() { isAcceptingRequests = false; while (!requests.isEmpty()) { try { Thread.sleep(100); } catch (InterruptedException e) { // Ignore exception } } isProcessingRequests = false; executorService.shutdown(); thread.interrupt(); } public void run(Runnable runnable) { if (isAcceptingRequests) { requests.offer(runnable); } else { throw new IllegalStateException(\u0026#34;Active object is no longer accepting requests\u0026#34;); } } public String name() { return this.name; } } åœ¨ä¿®æ”¹åçš„ä»£ç ä¸­ï¼Œæ·»åŠ äº†ä¸€ä¸ªç§æœ‰å˜é‡ executorServiceï¼Œç”¨äºå­˜å‚¨ä¸€ä¸ªçº¿ç¨‹æ± å¯¹è±¡ï¼Œå…¶ä¸­çº¿ç¨‹æ± çš„å¤§å°ä¸º 5ã€‚åœ¨æ„é€ æ–¹æ³•ä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ FixedThreadPoolExecutor å®ä¾‹ï¼Œå¹¶å°†å…¶ä½œä¸º executorService çš„å€¼ã€‚è¯¥çº¿ç¨‹æ± ä¼šåœ¨ ActiveObject å®ä¾‹ä¸­å¤„ç†è€—æ—¶ä»»åŠ¡ï¼Œé¿å…é˜»å¡è¯·æ±‚é˜Ÿåˆ—çš„å¤„ç†ã€‚\nåœ¨ processRequest æ–¹æ³•ä¸­ï¼Œä½¿ç”¨ executorService.submit(task).get()æ¥æäº¤å¹¶æ‰§è¡Œä»»åŠ¡ã€‚åœ¨æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œä½¿ç”¨äº† get()æ–¹æ³•æ¥åŒæ­¥è·å–ä»»åŠ¡çš„æ‰§è¡Œç»“æœï¼Œä»¥ç¡®ä¿ä»»åŠ¡æ‰§è¡Œå®Œæˆåå†å¤„ç†ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚\nåœ¨ shutdown æ–¹æ³•ä¸­ï¼Œæ·»åŠ äº† executorService.shutdown()æ¥å…³é—­çº¿ç¨‹æ± ã€‚è¯¥æ–¹æ³•ä¼šç­‰å¾…æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæˆåå…³é—­çº¿ç¨‹æ± ï¼Œå¹¶é˜²æ­¢æ–°ä»»åŠ¡è¢«æäº¤ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿æ‰€æœ‰ä»»åŠ¡éƒ½è¢«å¤„ç†å®Œæ¯•åæ‰å…³é—­ ActiveObject å®ä¾‹ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä½¿ç”¨çº¿ç¨‹æ± æ—¶ï¼Œè¦æ ¹æ®å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚å’Œç³»ç»Ÿèµ„æºæƒ…å†µé€‰æ‹©åˆé€‚çš„çº¿ç¨‹æ± å¤§å°å’Œç±»å‹ï¼Œé¿å…çº¿ç¨‹æ± è¿‡å¤§æˆ–è¿‡å°ï¼Œä»è€Œå½±å“ç³»ç»Ÿæ€§èƒ½æˆ–å¯¼è‡´çº¿ç¨‹æ± æ‹¥å µã€‚\nä¼˜åŒ–è¯·æ±‚çš„å¤„ç†ï¼šå½“å‰å®ç°ä¸­ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½ä¼šåœ¨æ‰§è¡Œå®Œæ¯•åç­‰å¾… 100 æ¯«ç§’ã€‚å¦‚æœè¯·æ±‚å¤„ç†è¾ƒå¿«ï¼Œè¿™å°†æµªè´¹å¾ˆå¤šæ—¶é—´ã€‚å¯ä»¥æ ¹æ®å®é™…æƒ…å†µä¼˜åŒ–è¯·æ±‚çš„å¤„ç†æ–¹å¼ï¼Œä¾‹å¦‚è®¾ç½®ä¸€ä¸ªæœ€å°æ‰§è¡Œæ—¶é—´ï¼Œæˆ–è€…ä½¿ç”¨æ›´é«˜æ•ˆçš„æ•°æ®ç»“æ„æ¥ç®¡ç†è¯·æ±‚é˜Ÿåˆ—ã€‚\nåœ¨å½“å‰çš„å®ç°ä¸­ï¼Œä½¿ç”¨äº†ä¸€ä¸ªé˜»å¡é˜Ÿåˆ— LinkedBlockingQueue æ¥ç®¡ç†è¯·æ±‚é˜Ÿåˆ—ã€‚è¿™ç§æ•°æ®ç»“æ„çš„ä¼˜ç‚¹æ˜¯å¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä½†æ˜¯åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹å¯èƒ½ä¼šæˆä¸ºç“¶é¢ˆï¼Œå› ä¸ºå®ƒæ˜¯åŸºäºé“¾è¡¨å®ç°çš„ï¼Œæ¯æ¬¡æ·»åŠ æˆ–åˆ é™¤å…ƒç´ æ—¶éƒ½éœ€è¦è¿›è¡ŒåŒæ­¥æ“ä½œï¼Œå¯èƒ½ä¼šå½±å“æ€§èƒ½ã€‚\nå¦‚æœéœ€è¦æ›´é«˜æ•ˆçš„è¯·æ±‚é˜Ÿåˆ—ç®¡ç†æ–¹å¼ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æ— é”çš„å¹¶å‘é˜Ÿåˆ—ï¼Œä¾‹å¦‚ Disruptor æˆ– ConcurrentLinkedQueueã€‚è¿™äº›æ•°æ®ç»“æ„å¯ä»¥åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹æä¾›æ›´å¥½çš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§ï¼Œä½†æ˜¯éœ€è¦æ›´åŠ å¤æ‚çš„å®ç°å’Œä½¿ç”¨æ–¹æ³•ï¼Œéœ€è¦æ ¹æ®å…·ä½“çš„åœºæ™¯è¿›è¡Œæƒè¡¡å’Œé€‰æ‹©ã€‚å¦‚æœä½¿ç”¨ Disruptorï¼Œéœ€è¦è¿›è¡Œæ›´åŠ ç»†è‡´çš„é…ç½®å’Œè°ƒä¼˜ï¼Œä»¥ä¾¿å‘æŒ¥æœ€å¤§çš„æ€§èƒ½ä¼˜åŠ¿ã€‚å¦‚æœä½¿ç”¨ ConcurrentLinkedQueueï¼Œéœ€è¦è€ƒè™‘å¹¶å‘é—®é¢˜ï¼Œä¾‹å¦‚ä½¿ç”¨ CAS æ“ä½œæ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚\nå¦‚æœä½¿ç”¨ ConcurrentLinkedQueue æ¥ç®¡ç†è¯·æ±‚é˜Ÿåˆ—ï¼Œéœ€è¦è€ƒè™‘å¹¶å‘é—®é¢˜ï¼Œå› ä¸ºè¯¥æ•°æ®ç»“æ„æ˜¯éé˜»å¡çš„ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶å¯¹å…¶è¿›è¡Œæ“ä½œï¼Œå¯èƒ½ä¼šå¯¼è‡´å¹¶å‘é—®é¢˜ï¼Œä¾‹å¦‚ç«æ€æ¡ä»¶å’Œå†…å­˜ä¸€è‡´æ€§é—®é¢˜ã€‚\nä¸ºäº†ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥ä½¿ç”¨ CASï¼ˆCompare and Swapï¼‰æ“ä½œæ¥å®ç°åŸå­æ€§çš„å…ƒç´ æ’å…¥å’Œåˆ é™¤ã€‚CAS æ“ä½œå¯ä»¥ä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤ŸæˆåŠŸä¿®æ”¹å…±äº«å˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹éœ€è¦é‡è¯•æˆ–è€…ç­‰å¾…ã€‚\nä¾‹å¦‚ï¼Œåœ¨ ActiveObject ç±»ä¸­ï¼Œå¯ä»¥å°†è¯·æ±‚é˜Ÿåˆ—å£°æ˜ä¸º ConcurrentLinkedQueue ç±»å‹ï¼Œå¹¶ä½¿ç”¨ CAS æ“ä½œæ¥å®ç°å…ƒç´ çš„æ’å…¥å’Œåˆ é™¤ï¼š\npublic abstract class ActiveObject { private ConcurrentLinkedQueue\u0026lt;Runnable\u0026gt; requests; // ... public ActiveObject(String name, int queueSize) { this.name = name; this.requests = new ConcurrentLinkedQueue\u0026lt;\u0026gt;(); thread = new Thread(() -\u0026gt; { while (isProcessingRequests) { Runnable task = requests.poll(); if (task != null) { task.run(); } try { Thread.sleep(100); } catch (InterruptedException e) { log.warn(\u0026#34;Active Object thread interrupted, reason: {}\u0026#34;, e.getMessage()); } } }, name); thread.start; } } åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä½¿ç”¨äº† ConcurrentLinkedQueue æ¥æ›¿æ¢äº†åŸæœ‰çš„é˜»å¡é˜Ÿåˆ— LinkedBlockingQueueï¼Œå¹¶ä½¿ç”¨äº† poll æ–¹æ³•æ¥è·å–é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œè€Œä¸æ˜¯ take æ–¹æ³•ï¼Œè¿™æ ·å¯ä»¥é¿å…çº¿ç¨‹é˜»å¡ã€‚ç„¶åä½¿ç”¨ CAS æ“ä½œæ¥å®ç°å…ƒç´ çš„æ·»åŠ ï¼Œä½¿ç”¨äº† offer æ–¹æ³•ï¼Œå¹¶æ£€æŸ¥è¿”å›å€¼æ˜¯å¦ä¸º trueï¼Œå¦‚æœä¸º false åˆ™è¡¨ç¤º CAS æ“ä½œå¤±è´¥ï¼Œéœ€è¦é‡è¯•æˆ–è€…ç­‰å¾…ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒConcurrentLinkedQueue å¹¶ä¸èƒ½ä¿è¯å…ƒç´ çš„é¡ºåºï¼Œå› æ­¤åœ¨å¤„ç†è¯·æ±‚æ—¶éœ€è¦æ³¨æ„é¡ºåºé—®é¢˜ï¼Œä¸èƒ½ä¿è¯å…ˆè¿›å…ˆå‡ºçš„é¡ºåºã€‚å¦‚æœéœ€è¦ä¿è¯é¡ºåºï¼Œå¯ä»¥ä½¿ç”¨å…¶ä»–çš„æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚ BlockingQueueã€‚\nä¸Šé¢çš„ä»£ç å·²ç»å¾ˆä¸é”™äº†ï¼Œä½†è¿˜æœ‰ä¸€äº›å¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹ï¼š\nä½¿ç”¨å·¥å‚æ–¹æ³•æ¥åˆ›å»º ActiveObject å®ä¾‹ å¯ä»¥å°† ActiveObject ç±»ä¸­çš„æ„é€ æ–¹æ³•æ”¹ä¸ºç§æœ‰çš„ï¼Œç„¶åæä¾›ä¸€ä¸ªå·¥å‚æ–¹æ³•æ¥åˆ›å»º ActiveObject å®ä¾‹ã€‚è¿™æ ·å¯ä»¥å°† ActiveObject çš„åˆ›å»ºé€»è¾‘ä¸å®¢æˆ·ç«¯ä»£ç åˆ†ç¦»ï¼Œä½¿å¾—å®¢æˆ·ç«¯ä»£ç æ›´åŠ ç®€æ´å’Œæ˜“äºç»´æŠ¤ã€‚\nå°†æ—¥å¿—è®°å½•å™¨ä½œä¸ºé™æ€å˜é‡ å¯ä»¥å°†æ—¥å¿—è®°å½•å™¨ä½œä¸ºé™æ€å˜é‡ï¼Œä»¥ä¾¿åœ¨æ•´ä¸ªç±»ä¸­å…±äº«ã€‚è¿™æ ·å¯ä»¥é¿å…åœ¨æ¯ä¸ªæ–¹æ³•ä¸­éƒ½åˆ›å»ºä¸€ä¸ªæ—¥å¿—è®°å½•å™¨ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œæ€§èƒ½ã€‚\nä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼ å¯ä»¥ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼æ¥ç¡®ä¿ ActiveObject å®ä¾‹çš„å”¯ä¸€æ€§ã€‚è¿™æ ·å¯ä»¥é¿å…åœ¨å¤šä¸ªåœ°æ–¹åˆ›å»ºå¤šä¸ª ActiveObject å®ä¾‹ï¼Œä»è€Œå¯¼è‡´ç³»ç»Ÿèµ„æºæµªè´¹æˆ–æ•°æ®ä¸ä¸€è‡´ã€‚\nä¿®æ”¹åçš„ä»£ç å¦‚ä¸‹ï¼š\npublic abstract class ActiveObject { private static final Logger log = LoggerFactory.getLogger(ActiveObject.class); private static final Map\u0026lt;String, ActiveObject\u0026gt; INSTANCES = new ConcurrentHashMap\u0026lt;\u0026gt;(); private BlockingQueue\u0026lt;Runnable\u0026gt; requests; private String name; private ExecutorService executorService; private Thread thread; private volatile boolean isAcceptingRequests = true; private volatile boolean isProcessingRequests = true; private ActiveObject(String name, int queueSize, Long sleepMillis) { this.name = name; this.requests = new LinkedBlockingQueue\u0026lt;\u0026gt;(queueSize); this.executorService = Executors.newFixedThreadPool(5); thread = new Thread(() -\u0026gt; { while (isProcessingRequests) { try { processRequest(requests.take(), executorService); if (sleepMillis != null) { Thread.sleep(sleepMillis); } } catch (InterruptedException e) { log.warn(\u0026#34;Active Object thread interrupted, reason: {}\u0026#34;, e.getMessage()); } } }, name); thread.start(); } private void processRequest(Runnable task, ExecutorService executorService) { try { executorService.submit(task).get(); } catch (Exception e) { log.error(\u0026#34;Error processing request: {}\u0026#34;, e.getMessage()); // å‘é€å‘Šè­¦ä¿¡æ¯ } } public static synchronized ActiveObject getInstance(String name) { return getInstance(name, 16, null); } publicvoid submit(Runnable task) { if (isAcceptingRequests) { try { requests.put(task); } catch (InterruptedException e) { log.error(\u0026#34;Error submitting request: {}\u0026#34;, e.getMessage()); // å‘é€å‘Šè­¦ä¿¡æ¯ } } else { log.warn(\u0026#34;Active Object is not accepting requests\u0026#34;); // å‘é€å‘Šè­¦ä¿¡æ¯ } } public static synchronized ActiveObject getInstance(String name, int queueSize, Long sleepMillis) { ActiveObject instance = INSTANCES.get(name); if (instance == null) { instance = new ActiveObject(name, queueSize, sleepMillis); INSTANCES.put(name, instance); } return instance; } public void shutdown() { isAcceptingRequests = false; while (!requests.isEmpty()) { try { Thread.sleep(100); } catch (InterruptedException e) { // Ignore exception } } isProcessingRequests = false; executorService.shutdown(); thread.interrupt(); } } ä¸Šé¢çš„ä»£ç å·²ç»å¾ˆä¸é”™äº†ï¼Œä½†è¿˜æœ‰ä¸€äº›å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–çš„åœ°æ–¹ï¼š\nä½¿ç”¨çº¿ç¨‹æ± æ¥ç®¡ç†çº¿ç¨‹ï¼Œè€Œä¸æ˜¯æ¯æ¬¡åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ã€‚è¿™æ ·å¯ä»¥å‡å°‘çº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯çš„å¼€é”€ï¼Œæé«˜ä»£ç çš„æ€§èƒ½ã€‚ ä½¿ç”¨ Lambda è¡¨è¾¾å¼ç®€åŒ–ä»£ç ï¼Œä½¿ä»£ç æ›´åŠ ç®€æ´å’Œæ˜“äºç†è§£ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å°†çº¿ç¨‹ä¸­çš„ while å¾ªç¯æ”¹ä¸º Lambda è¡¨è¾¾å¼ï¼Œç®€åŒ–ä»£ç ã€‚\nä½¿ç”¨ CompletableFuture æ¥å®ç°å¼‚æ­¥å¤„ç†ï¼Œå°†è¯·æ±‚çš„å¤„ç†è¿‡ç¨‹å’Œç»“æœçš„è¿”å›åˆ†ç¦»å¼€æ¥ã€‚è¿™æ ·å¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥æé«˜ä»£ç çš„æ€§èƒ½ã€‚\nä½¿ç”¨ ThreadFactory æ¥å‘½åçº¿ç¨‹ï¼Œä»¥ä¾¿æ›´å¥½åœ°è·Ÿè¸ªçº¿ç¨‹çš„æ‰§è¡Œæƒ…å†µä»¥åŠæ’æŸ¥é—®é¢˜ã€‚\nä½¿ç”¨ CompletableFuture çš„ exceptionally æ–¹æ³•å¤„ç†å¼‚å¸¸ï¼Œä»¥é¿å…åœ¨å¤„ç†è¯·æ±‚æ—¶å‡ºç°å¼‚å¸¸è€Œå¯¼è‡´æ•´ä¸ªçº¿ç¨‹åœæ­¢ã€‚\npublic class ActiveObject { private static final Logger log = LoggerFactory.getLogger(ActiveObject.class); private static final Map\u0026lt;String, ActiveObject\u0026gt; INSTANCES = new ConcurrentHashMap\u0026lt;\u0026gt;(); private static final int THREAD_POOL_SIZE = 5; private BlockingQueue\u0026lt;Runnable\u0026gt; requests; private String name; private ExecutorService executorService; private CompletableFuture\u0026lt;Void\u0026gt; processingFuture; private volatile boolean isAcceptingRequests = true; private ActiveObject(String name, int queueSize, Long sleepMillis) { this.name = name; this.requests = new LinkedBlockingQueue\u0026lt;\u0026gt;(queueSize); this.executorService = Executors.newFixedThreadPool(THREAD_POOL_SIZE, new ThreadFactory() { private AtomicInteger count = new AtomicInteger(0); public Thread newThread(Runnable r) { return new Thread(r, \u0026#34;ActiveObject-\u0026#34; + name + \u0026#34;-\u0026#34; + count.getAndIncrement()); } }); processingFuture = CompletableFuture.runAsync(() -\u0026gt; { while (isAcceptingRequests) { try { executorService.execute(requests.take()); if (sleepMillis != null) { Thread.sleep(sleepMillis); } } catch (InterruptedException e) { Thread.currentThread().interrupt(); log.warn(\u0026#34;Active Object thread interrupted, reason: {}\u0026#34;, e.getMessage()); } catch (Exception e) { log.error(\u0026#34;Error processing request: {}\u0026#34;, e.getMessage()); // å‘é€å‘Šè­¦ä¿¡æ¯ } } }).exceptionally(e -\u0026gt; { log.error(\u0026#34;Exception occurred in ActiveObject thread: {}\u0026#34;, e.getMessage()); return null; }); } public void submit(Runnable task) { requests.offer(task); } public void stop() { isAcceptingRequests = false; processingFuture.cancel(true); executorService.shutdown(); } public static synchronized ActiveObject getInstance(String name) { return getInstance(name, 16, null); } public static synchronized ActiveObject getInstance(String name, int queueSize, Long sleepMillis) { ActiveObject instance = INSTANCES.get(name); if (instance == null) { instance = new ActiveObject(name, queueSize, sleepMillis); INSTANCES.put(name, instance); } return instance; } public String getName() { return name; } } æ€»ç»“ æ´»åŠ¨å¯¹è±¡æ¨¡å¼æ˜¯ä¸€ç§æ”¯æŒå¼‚æ­¥å¤„ç†å’Œäº‹ä»¶é©±åŠ¨çš„è®¾è®¡æ¨¡å¼ï¼Œé€‚ç”¨äºä¸€äº›éœ€è¦é«˜æ€§èƒ½ã€å¯ä¼¸ç¼©å’Œå¯é çš„åº”ç”¨åœºæ™¯ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªé€‚ç”¨äºæ´»åŠ¨å¯¹è±¡æ¨¡å¼çš„ä½¿ç”¨åœºæ™¯ï¼š\nå¤§è§„æ¨¡å¹¶å‘å¤„ç†ï¼šåœ¨å¤§è§„æ¨¡å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ä¼ ç»Ÿçš„åŒæ­¥å¤„ç†æ–¹å¼ä¼šå¯¼è‡´ç³»ç»Ÿæ€§èƒ½ä¸‹é™å’Œå“åº”æ—¶é—´å»¶é•¿ã€‚ä½¿ç”¨æ´»åŠ¨å¯¹è±¡æ¨¡å¼å¯ä»¥å°†å¹¶å‘è¯·æ±‚è½¬æ¢æˆå¼‚æ­¥äº‹ä»¶ï¼Œé€šè¿‡äº‹ä»¶é©±åŠ¨æœºåˆ¶å®ç°é«˜æ€§èƒ½å’Œå¯ä¼¸ç¼©ã€‚ é«˜ååé‡æ•°æ®å¤„ç†ï¼šåœ¨éœ€è¦å¤„ç†å¤§é‡æ•°æ®çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ´»åŠ¨å¯¹è±¡æ¨¡å¼å¯ä»¥åˆ©ç”¨å¤šæ ¸ CPU å’Œå¼‚æ­¥å¤„ç†æŠ€æœ¯ï¼Œæé«˜ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›å’Œååé‡ã€‚ å¼‚æ­¥æ¶ˆæ¯ä¼ é€’ï¼šåœ¨éœ€è¦å¼‚æ­¥å¤„ç†æ¶ˆæ¯çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ´»åŠ¨å¯¹è±¡æ¨¡å¼å¯ä»¥å®ç°å¼‚æ­¥æ¶ˆæ¯çš„å¤„ç†å’Œåˆ†å‘ï¼Œæé«˜ç³»ç»Ÿçš„å¯é æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ åˆ†å¸ƒå¼ç³»ç»Ÿï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä½¿ç”¨æ´»åŠ¨å¯¹è±¡æ¨¡å¼å¯ä»¥å®ç°å¼‚æ­¥æ¶ˆæ¯ä¼ é€’å’Œäº‹ä»¶é©±åŠ¨ï¼Œæé«˜ç³»ç»Ÿçš„å¯é æ€§å’Œå¯ä¼¸ç¼©æ€§ã€‚åŒæ—¶ï¼Œæ´»åŠ¨å¯¹è±¡æ¨¡å¼è¿˜å¯ä»¥é€šè¿‡åˆ†å¸ƒå¼é”å’Œåˆ†å¸ƒå¼è®¡ç®—ç­‰æŠ€æœ¯å®ç°åˆ†å¸ƒå¼å¹¶å‘æ§åˆ¶å’Œè®¡ç®—ï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå¯é æ€§ã€‚ UI å’Œåå°é€»è¾‘åˆ†ç¦»ï¼šåœ¨éœ€è¦å°† UI å’Œåå°é€»è¾‘åˆ†ç¦»çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ´»åŠ¨å¯¹è±¡æ¨¡å¼å¯ä»¥å®ç° UI å’Œåå°é€»è¾‘çš„è§£è€¦å’Œå¼‚æ­¥å¤„ç†ï¼Œæé«˜ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚ å¼‚æ­¥ IO æ“ä½œï¼šåœ¨éœ€è¦è¿›è¡Œå¼‚æ­¥ IO æ“ä½œçš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ´»åŠ¨å¯¹è±¡æ¨¡å¼å¯ä»¥å®ç°éé˜»å¡ IO å’Œå¼‚æ­¥äº‹ä»¶å¤„ç†ï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå“åº”æ—¶é—´ã€‚ æ€»çš„æ¥è¯´ï¼Œæ´»åŠ¨å¯¹è±¡æ¨¡å¼é€‚ç”¨äºä¸€äº›éœ€è¦å¼‚æ­¥å¤„ç†ã€äº‹ä»¶é©±åŠ¨ã€é«˜æ€§èƒ½ã€å¯ä¼¸ç¼©å’Œå¯é çš„åº”ç”¨åœºæ™¯ã€‚é€šè¿‡ä½¿ç”¨æ´»åŠ¨å¯¹è±¡æ¨¡å¼ï¼Œå¯ä»¥æé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§ï¼ŒåŒæ—¶é™ä½ç³»ç»Ÿçš„å¤æ‚åº¦å’Œæˆæœ¬ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/05/26/java-design-patterns-active-object/","summary":"æœ¬æ–‡ä¸»è¦ä»‹ç» Active Object æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nJava Design Patterns æä¾›äº†å„ç§ Java è®¾è®¡æ¨¡å¼çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ã€‚è¯¥ç½‘ç«™æ—¨åœ¨å¸®åŠ© Java å¼€å‘äººå‘˜äº†è§£å’Œåº”ç”¨å„ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚\nJava Design Patterns ç½‘ç«™æä¾›äº†å¤šç§è®¾è®¡æ¨¡å¼åˆ†ç±»æ–¹å¼ï¼ŒåŒ…æ‹¬åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational Patternsï¼‰ã€ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternsï¼‰å’Œè¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰ï¼Œä»¥åŠå…¶ä»–ä¸€äº›å¸¸è§çš„æ¨¡å¼ã€‚\nå¯¹äºæ¯ä¸ªè®¾è®¡æ¨¡å¼ï¼Œè¯¥ç½‘ç«™æä¾›äº†è¯¦ç»†çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ï¼Œå¹¶ä¸”æä¾›äº†ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ã€‚å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©é€‚åˆè‡ªå·±çš„è®¾è®¡æ¨¡å¼ï¼Œå¹¶ä¸”å¯ä»¥å‚è€ƒç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜æ¥ç†è§£å’Œåº”ç”¨è¯¥æ¨¡å¼ã€‚\næ­¤å¤–ï¼ŒJava Design Patterns ç½‘ç«™è¿˜æä¾›äº†ä¸€äº›å…¶ä»–èµ„æºï¼Œå¦‚è®¾è®¡æ¨¡å¼çš„ UML å›¾ã€è®¾è®¡æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ã€è®¾è®¡æ¨¡å¼çš„æ¯”è¾ƒç­‰ã€‚è¿™äº›èµ„æºå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨è®¾è®¡æ¨¡å¼ã€‚\nä¸­æ–‡ç½‘ç«™ï¼šhttps://java-design-patterns.com/zh/\nGithub ä¸Šæºç ä»“åº“ï¼ˆéå®˜æ–¹ï¼‰ï¼šhttps://github.com/iluwatar/java-design-patterns\nç›®çš„ æ´»åŠ¨å¯¹è±¡ï¼ˆActive Objectï¼‰æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯å°†å¹¶å‘å’Œå¼‚æ­¥å¤„ç†çš„é—®é¢˜ä»å®¢æˆ·ç«¯ä»£ç ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½ã€å¯é æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚æ´»åŠ¨å¯¹è±¡æ¨¡å¼æ˜¯ä¸€ç§èƒ½å¤Ÿå¸®åŠ©å¼€å‘äººå‘˜å¤„ç†å¤šçº¿ç¨‹ã€å¼‚æ­¥å’Œå¹¶å‘é—®é¢˜çš„è®¾è®¡æ¨¡å¼ã€‚\nåœ¨ä¼ ç»Ÿçš„å¹¶å‘ç¼–ç¨‹æ¨¡å‹ä¸­ï¼Œå®¢æˆ·ç«¯ä»£ç éœ€è¦ç›´æ¥ç®¡ç†çº¿ç¨‹å’Œé”ç­‰ç»†èŠ‚ï¼Œè¿™æ ·ä¼šå¯¼è‡´ä»£ç å¤æ‚åº¦å’Œç»´æŠ¤æˆæœ¬çš„å¢åŠ ï¼ŒåŒæ—¶ä¹Ÿå®¹æ˜“å‡ºç°å„ç§é—®é¢˜ï¼Œå¦‚æ­»é”ã€ç«æ€æ¡ä»¶ç­‰ã€‚æ´»åŠ¨å¯¹è±¡æ¨¡å¼é€šè¿‡å¼•å…¥æ´»åŠ¨å¯¹è±¡æ¥è§£å†³è¿™äº›é—®é¢˜ï¼Œæ´»åŠ¨å¯¹è±¡å°†å®¢æˆ·ç«¯ä»£ç å‘é€çš„æ¶ˆæ¯æ·»åŠ åˆ°å†…éƒ¨çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå¹¶ä½¿ç”¨å•ç‹¬çš„çº¿ç¨‹å¼‚æ­¥å¤„ç†è¿™äº›æ¶ˆæ¯ã€‚è¿™ç§æ¨¡å¼å¯ä»¥æé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§ï¼ŒåŒæ—¶ä½¿å¾—å®¢æˆ·ç«¯ä»£ç æ›´åŠ ç®€å•å’Œæ˜“äºç»´æŠ¤ã€‚\næ´»åŠ¨å¯¹è±¡æ¨¡å¼çš„ç›®çš„åŒ…æ‹¬ï¼š\nå°†å¹¶å‘å’Œå¼‚æ­¥å¤„ç†çš„é—®é¢˜ä»å®¢æˆ·ç«¯ä»£ç ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œä»è€Œä½¿å¾—å®¢æˆ·ç«¯ä»£ç æ›´åŠ ç®€å•å’Œæ˜“äºç»´æŠ¤ã€‚å®¢æˆ·ç«¯ä»£ç åªéœ€è¦å‘é€æ¶ˆæ¯å³å¯ï¼Œä¸éœ€è¦å…³å¿ƒå¼‚æ­¥å¤„ç†çš„ç»†èŠ‚ï¼Œæ´»åŠ¨å¯¹è±¡å°†å¹¶å‘å’Œå¼‚æ­¥å¤„ç†çš„é—®é¢˜å°è£…èµ·æ¥ï¼Œæä¾›ç®€å•çš„æ¥å£ä¾›å®¢æˆ·ç«¯ä½¿ç”¨ã€‚ æé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§ã€‚æ´»åŠ¨å¯¹è±¡ä½¿ç”¨å•ç‹¬çš„çº¿ç¨‹æ± å¼‚æ­¥å¤„ç†æ¶ˆæ¯ï¼Œå¯ä»¥æ›´å¥½åœ°åˆ©ç”¨ç³»ç»Ÿèµ„æºï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§ã€‚ æé«˜ç³»ç»Ÿçš„å¯é æ€§å’Œå¥å£®æ€§ã€‚æ´»åŠ¨å¯¹è±¡å°†æ¶ˆæ¯æ·»åŠ åˆ°å†…éƒ¨çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œé¿å…äº†ç«æ€æ¡ä»¶å’Œæ­»é”ç­‰é—®é¢˜ï¼Œä»è€Œæé«˜äº†ç³»ç»Ÿçš„å¯é æ€§å’Œå¥å£®æ€§ã€‚ å°†å¤šçº¿ç¨‹å’Œå¼‚æ­¥å¤„ç†çš„ç»†èŠ‚å°è£…èµ·æ¥ï¼Œä½¿å¾—å®¢æˆ·ç«¯ä»£ç æ›´åŠ æŠ½è±¡å’Œé€šç”¨ã€‚å®¢æˆ·ç«¯ä»£ç å¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ¥å£æ¥è®¿é—®ä¸åŒçš„æœåŠ¡ï¼Œä»è€Œæé«˜ä»£ç çš„å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ è§£é‡Š æ´»åŠ¨å¯¹è±¡æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†å¹¶å‘å’Œå¼‚æ­¥å¤„ç†çš„é—®é¢˜ä»å®¢æˆ·ç«¯ä»£ç ä¸­åˆ†ç¦»å‡ºæ¥ã€‚å…·ä½“æ¥è¯´ï¼Œæ´»åŠ¨å¯¹è±¡æ¨¡å¼åŒ…å«ä»¥ä¸‹å‡ ä¸ªå…³é”®ç»„ä»¶ï¼š\næ´»åŠ¨å¯¹è±¡ï¼ˆActive Objectï¼‰ï¼šæ´»åŠ¨å¯¹è±¡æ˜¯ä¸€ä¸ªå°è£…äº†æŸç§æœåŠ¡çš„å¯¹è±¡ï¼Œå®ƒå°†å®¢æˆ·ç«¯ä»£ç å‘é€çš„æ¶ˆæ¯æ·»åŠ åˆ°å†…éƒ¨çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå¹¶ä½¿ç”¨å•ç‹¬çš„çº¿ç¨‹å¼‚æ­¥å¤„ç†è¿™äº›æ¶ˆæ¯ã€‚æ´»åŠ¨å¯¹è±¡é€šå¸¸åŒ…å«ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—å’Œä¸€ä¸ªçº¿ç¨‹æ± ï¼Œç”¨äºå¼‚æ­¥å¤„ç†æ¶ˆæ¯ã€‚ æ–¹æ³•è°ƒç”¨è¯·æ±‚ï¼ˆMethod Invocation Requestï¼‰ï¼šå®¢æˆ·ç«¯ä»£ç å‘æ´»åŠ¨å¯¹è±¡å‘é€æ–¹æ³•è°ƒç”¨è¯·æ±‚ï¼ŒåŒ…æ‹¬æ–¹æ³•åå’Œå‚æ•°åˆ—è¡¨ç­‰ä¿¡æ¯ã€‚æ´»åŠ¨å¯¹è±¡å°†æ–¹æ³•è°ƒç”¨è¯·æ±‚å°è£…ä¸ºä¸€ä¸ªæ¶ˆæ¯å¯¹è±¡ï¼Œå¹¶æ·»åŠ åˆ°å†…éƒ¨çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚ æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessage Queueï¼‰ï¼šæ¶ˆæ¯é˜Ÿåˆ—æ˜¯æ´»åŠ¨å¯¹è±¡å†…éƒ¨ç”¨äºå­˜å‚¨æ–¹æ³•è°ƒç”¨è¯·æ±‚çš„é˜Ÿåˆ—ã€‚æ´»åŠ¨å¯¹è±¡å°†å®¢æˆ·ç«¯ä»£ç å‘é€çš„æ¶ˆæ¯æ·»åŠ åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå¹¶ä½¿ç”¨å•ç‹¬çš„çº¿ç¨‹å¼‚æ­¥å¤„ç†è¿™äº›æ¶ˆæ¯ã€‚ çº¿ç¨‹æ± ï¼ˆThread Poolï¼‰ï¼šçº¿ç¨‹æ± æ˜¯æ´»åŠ¨å¯¹è±¡ç”¨äºå¼‚æ­¥å¤„ç†æ¶ˆæ¯çš„çº¿ç¨‹æ± ã€‚æ´»åŠ¨å¯¹è±¡ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯ï¼Œå¹¶ä½¿ç”¨çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¼‚æ­¥å¤„ç†è¿™äº›æ¶ˆæ¯ã€‚ ç¨‹åºç¤ºä¾‹\npublic abstract class ActiveCreature{ private final Logger logger = LoggerFactory.getLogger(ActiveCreature.class.getName()); private BlockingQueue\u0026lt;Runnable\u0026gt; requests; private String name; private Thread thread; public ActiveCreature(String name) { this.name = name; this.requests = new LinkedBlockingQueue\u0026lt;Runnable\u0026gt;(); thread = new Thread(new Runnable() { @Override public void run() { while (true) { try { requests.","title":"Javaè®¾è®¡æ¨¡å¼ï¼šActive Object"},{"content":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬ä¸‰ç« ã€Šå¯¹è±¡çš„é€šç”¨æ–¹æ³•ã€‹çš„å­¦ä¹ ç¬”è®°ï¼šè€ƒè™‘å®ç° Comparable æ¥å£ã€‚\nä»‹ç» ä¸æœ¬ç« è®¨è®ºçš„å…¶ä»–æ–¹æ³•ä¸åŒï¼ŒcompareTo æ–¹æ³•ä¸æ˜¯åœ¨ Object ä¸­å£°æ˜çš„ã€‚ç›¸åï¼Œå®ƒæ˜¯ Comparable æ¥å£ä¸­çš„å”¯ä¸€æ–¹æ³•ã€‚å®ƒåœ¨æ€§è´¨ä¸Šç±»ä¼¼äº Object çš„ equals æ–¹æ³•ï¼Œé™¤äº†ç®€å•çš„ç›¸ç­‰æ¯”è¾ƒä¹‹å¤–ï¼Œå®ƒè¿˜å…è®¸é¡ºåºæ¯”è¾ƒï¼Œè€Œä¸”å®ƒæ˜¯é€šç”¨çš„ã€‚ä¸€ä¸ªç±»å®ç° Comparableï¼Œè¡¨æ˜å®ä¾‹å…·æœ‰è‡ªç„¶é¡ºåºã€‚å¯¹å®ç° Comparable çš„å¯¹è±¡æ•°ç»„è¿›è¡Œæ’åºéå¸¸ç®€å•ï¼š\nArrays.sort(a); ç±»ä¼¼åœ°ï¼Œæœç´¢ã€è®¡ç®—æå€¼å’Œç»´æŠ¤ Comparable å¯¹è±¡çš„è‡ªåŠ¨æ’åºé›†åˆä¹Ÿå¾ˆå®¹æ˜“ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ç¨‹åºä¾èµ–äº String å®ç° Comparable è¿™ä¸€äº‹å®ï¼Œå°†å‘½ä»¤è¡Œå‚æ•°åˆ—è¡¨æŒ‰å­—æ¯é¡ºåºæ‰“å°å‡ºæ¥ï¼Œå¹¶æ¶ˆé™¤é‡å¤ï¼š\npublic class WordList { public static void main(String[] args) { Set\u0026lt;String\u0026gt; s = new TreeSet\u0026lt;\u0026gt;(); Collections.addAll(s, args); System.out.println(s); } } é€šè¿‡è®©ç±»å®ç° Comparableï¼Œå°±å¯ä¸ä¾èµ–äºæ­¤æ¥å£çš„æ‰€æœ‰é€šç”¨ç®—æ³•å’Œé›†åˆå®ç°è¿›è¡Œäº’æ“ä½œã€‚ä½ åªéœ€ä»˜å‡ºä¸€ç‚¹ç‚¹åŠªåŠ›å°±èƒ½è·å¾—å¼ºå¤§çš„åŠŸèƒ½ã€‚å®é™…ä¸Šï¼ŒJava åº“ä¸­çš„æ‰€æœ‰å€¼ç±»ä»¥åŠæ‰€æœ‰æšä¸¾ç±»å‹éƒ½å®ç°äº† Comparableã€‚å¦‚æœç¼–å†™çš„å€¼ç±»å…·æœ‰æ˜æ˜¾çš„è‡ªç„¶é¡ºåºï¼Œå¦‚å­—æ¯é¡ºåºã€æ•°å­—é¡ºåºæˆ–æ—¶é—´é¡ºåºï¼Œåˆ™åº”å®ç° Comparable æ¥å£ï¼š\npublic interface Comparable\u0026lt;T\u0026gt; { int compareTo(T t); } compareTo æ–¹æ³•çš„ä¸€èˆ¬çº¦å®šç±»ä¼¼äº equals æ–¹æ³•ï¼š\nå°†ä¸€ä¸ªå¯¹è±¡ä¸æŒ‡å®šçš„å¯¹è±¡è¿›è¡Œé¡ºåºæ¯”è¾ƒã€‚å½“è¯¥å¯¹è±¡å°äºã€ç­‰äºæˆ–å¤§äºæŒ‡å®šå¯¹è±¡æ—¶ï¼Œå¯¹åº”è¿”å›ä¸€ä¸ªè´Ÿæ•´æ•°ã€é›¶æˆ–æ­£æ•´æ•°ã€‚å¦‚æœæŒ‡å®šå¯¹è±¡çš„ç±»å‹é˜»æ­¢å®ƒä¸è¯¥å¯¹è±¡è¿›è¡Œæ¯”è¾ƒï¼Œåˆ™æŠ›å‡º ClassCastExceptionã€‚\nåœ¨ä¸‹é¢çš„æè¿°ä¸­ï¼Œsgn(expression) è¡¨ç¤ºæ•°å­¦ä¸­çš„ç¬¦å·å‡½æ•°ï¼Œå®ƒè¢«å®šä¹‰ä¸ºï¼šæ ¹æ®ä¼ å…¥è¡¨è¾¾å¼çš„å€¼æ˜¯è´Ÿæ•°ã€é›¶æˆ–æ­£æ•°ï¼Œå¯¹åº”è¿”å› -1ã€0 æˆ– 1ã€‚\nå®ç°è€…å¿…é¡»ç¡®ä¿æ‰€æœ‰ x å’Œ y æ»¡è¶³ sgn(x.compareTo(y)) == -sgn(y.compareTo(x))ï¼ˆè¿™æ„å‘³ç€ x.compareTo(y) å½“ä¸”ä»…å½“ y.compareTo(x) æŠ›å‡ºå¼‚å¸¸æ—¶æ‰æŠ›å‡ºå¼‚å¸¸ï¼‰ã€‚ å®ç°è€…è¿˜å¿…é¡»ç¡®ä¿å…³ç³»æ˜¯å¯ä¼ é€’çš„ï¼š(x.compareTo(y) \u0026gt; 0 \u0026amp;\u0026amp; y.compareTo(z) \u0026gt; 0) æ„å‘³ç€ x.compareTo(z) \u0026gt; 0ã€‚ æœ€åï¼Œå®ç°è€…å¿…é¡»ç¡®ä¿ x.compareTo(y) == 0 æ—¶ï¼Œæ‰€æœ‰çš„ z æ»¡è¶³ sgn(x.compareTo(z)) == sgn(y.compareTo(z))ã€‚ å¼ºçƒˆå»ºè®® (x.compareTo(y)== 0) == (x.equals(y)) æˆç«‹ï¼Œä½†ä¸æ˜¯å¿…éœ€çš„ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä»»ä½•å®ç° Comparable æ¥å£å¹¶è¿åæ­¤æ¡ä»¶çš„ç±»éƒ½åº”è¯¥æ¸…æ¥šåœ°æ³¨æ˜è¿™ä¸€äº‹å®ã€‚æ¨èä½¿ç”¨çš„è¡¨è¿°æ˜¯ã€Œæ³¨æ„ï¼šè¯¥ç±»çš„è‡ªç„¶é¡ºåºä¸ equals ä¸ä¸€è‡´ã€‚ã€ ä¸è¦è¢«è¿™äº›çº¦å®šçš„æ•°å­¦æ€§è´¨æ‰€å½±å“ã€‚å°±åƒ equals çº¦å®šä¸€æ ·ï¼Œè¿™ä¸ªçº¦å®šå¹¶ä¸åƒçœ‹èµ·æ¥é‚£ä¹ˆå¤æ‚ã€‚ä¸ equals æ–¹æ³•ä¸åŒï¼Œequals æ–¹æ³•å¯¹æ‰€æœ‰å¯¹è±¡éƒ½æ–½åŠ äº†å…¨å±€ç­‰ä»·å…³ç³»ï¼ŒcompareTo ä¸éœ€è¦è·¨è¶Šä¸åŒç±»å‹çš„å¯¹è±¡å·¥ä½œï¼šå½“é‡åˆ°ä¸åŒç±»å‹çš„å¯¹è±¡æ—¶ï¼ŒcompareTo å…è®¸æŠ›å‡º ClassCastExceptionã€‚é€šå¸¸ï¼Œå®ƒå°±æ˜¯è¿™ä¹ˆåšçš„ã€‚è¯¥çº¦å®šç¡®å®å…è®¸ç±»å‹é—´æ¯”è¾ƒï¼Œè¿™ç§æ¯”è¾ƒé€šå¸¸åœ¨è¢«æ¯”è¾ƒå¯¹è±¡å®ç°çš„æ¥å£ä¸­å®šä¹‰ã€‚\nå°±åƒè¿å hashCode çº¦å®šçš„ç±»å¯ä»¥ç ´åä¾èµ– hash çš„å…¶ä»–ç±»ä¸€æ ·ï¼Œè¿å compareTo çº¦å®šçš„ç±»ä¹Ÿå¯ä»¥ç ´åä¾èµ– Comparable çš„å…¶ä»–ç±»ã€‚ä¾èµ– Comparable çš„ç±»åŒ…æ‹¬æ’åºé›†åˆ TreeSet å’Œ TreeMapï¼Œä»¥åŠå®ç”¨å·¥å…·ç±» Collections å’Œ Arraysï¼Œå®ƒä»¬éƒ½åŒ…å«æœç´¢å’Œæ’åºç®—æ³•ã€‚\nè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ compareTo çº¦å®šçš„ç»†èŠ‚ã€‚ç¬¬ä¸€ä¸ªè§„å®šæŒ‡å‡ºï¼Œå¦‚æœä½ é¢ å€’ä¸¤ä¸ªå¯¹è±¡å¼•ç”¨ä¹‹é—´çš„æ¯”è¾ƒçš„æ–¹å‘ï¼Œå°±åº”å½“å‘ç”Ÿè¿™æ ·çš„æƒ…å†µï¼šå¦‚æœç¬¬ä¸€ä¸ªå¯¹è±¡å°äºç¬¬äºŒä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªå¯¹è±¡å¿…é¡»å¤§äºç¬¬ä¸€ä¸ªï¼›å¦‚æœç¬¬ä¸€ä¸ªå¯¹è±¡ç­‰äºç¬¬äºŒä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªå¯¹è±¡ä¸€å®šç­‰äºç¬¬ä¸€ä¸ªå¯¹è±¡ï¼›å¦‚æœç¬¬ä¸€ä¸ªå¯¹è±¡å¤§äºç¬¬äºŒä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªå¯¹è±¡ä¸€å®šå°äºç¬¬ä¸€ä¸ªå¯¹è±¡ã€‚ç¬¬äºŒä¸ªè§„å®šæŒ‡å‡ºï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡å¤§äºç¬¬äºŒä¸ªï¼Œç¬¬äºŒä¸ªå¤§äºç¬¬ä¸‰ä¸ªï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªå¯¹è±¡ä¸€å®šå¤§äºç¬¬ä¸‰ä¸ªå¯¹è±¡ã€‚æœ€åä¸€ä¸ªè§„å®šæŒ‡å‡ºï¼Œæ‰€æœ‰ compareTo ç»“æœä¸ºç›¸ç­‰çš„å¯¹è±¡åˆ†åˆ«ä¸ä»»ä½•å…¶ä»–å¯¹è±¡ç›¸æ¯”ï¼Œå¿…é¡»äº§ç”Ÿç›¸åŒçš„ç»“æœã€‚\nè¿™ä¸‰ç§è§„å®šçš„ä¸€ä¸ªç»“æœæ˜¯ï¼Œç”± compareTo æ–¹æ³•è¿›è¡Œçš„ç›¸ç­‰æ€§æ£€éªŒå¿…é¡»éµå®ˆç”± equals çº¦å®šè¿›è¡Œçš„ç›¸åŒçš„é™åˆ¶ï¼šåèº«æ€§ã€å¯¹ç§°æ€§å’Œä¼ é€’æ€§ã€‚å› æ­¤ï¼ŒåŒæ ·çš„è­¦å‘Šä¹Ÿé€‚ç”¨äºæ­¤ï¼šé™¤éä½ æ„¿æ„æ”¾å¼ƒé¢å‘å¯¹è±¡çš„æŠ½è±¡ä¼˜ç‚¹ï¼Œå¦åˆ™æ— æ³•åœ¨ä¿ç•™ compareTo çº¦å®šçš„åŒæ—¶ä½¿ç”¨æ–°å€¼ç»„ä»¶æ‰©å±•å¯å®ä¾‹åŒ–ç±»ã€‚åŒæ ·çš„è§£å†³æ–¹æ¡ˆä¹Ÿé€‚ç”¨ã€‚å¦‚æœè¦å‘å®ç° Comparable çš„ç±»ä¸­æ·»åŠ å€¼ç»„ä»¶ï¼Œä¸è¦ç»§æ‰¿å®ƒï¼›ç¼–å†™ä¸€ä¸ªä¸ç›¸å…³çš„ç±»ï¼Œå…¶ä¸­åŒ…å«ç¬¬ä¸€ä¸ªç±»çš„å®ä¾‹ã€‚ç„¶åæä¾›è¿”å›æ‰€åŒ…å«å®ä¾‹çš„ã€Œè§†å›¾ã€æ–¹æ³•ã€‚è¿™ä½¿ä½ å¯ä»¥è‡ªç”±åœ°åœ¨åŒ…å«ç±»ä¸Šå®ç°ä½ å–œæ¬¢çš„ä»»ä½• compareTo æ–¹æ³•ï¼ŒåŒæ—¶å…è®¸å®ƒçš„å®¢æˆ·ç«¯åœ¨éœ€è¦æ—¶å°†åŒ…å«ç±»çš„å®ä¾‹è§†ä¸ºåŒ…å«ç±»çš„å®ä¾‹ã€‚\ncompareTo çº¦å®šçš„æœ€åä¸€æ®µæ˜¯ä¸€ä¸ªå¼ºçƒˆçš„å»ºè®®ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„è¦æ±‚ï¼Œå®ƒåªæ˜¯ç®€å•åœ°è¯´æ˜äº† compareTo æ–¹æ³•æ‰€æ–½åŠ çš„åŒç­‰æ€§æ£€éªŒé€šå¸¸åº”è¯¥ä¸ equals æ–¹æ³•è¿”å›ç›¸åŒçš„ç»“æœã€‚å¦‚æœéµå®ˆäº†è¿™ä¸€è§„å®šï¼Œåˆ™ compareTo æ–¹æ³•æ‰€æ–½åŠ çš„æ’åºä¸ equals æ–¹æ³•ä¸€è‡´ã€‚å¦‚æœè¿åè¿™æ¡å»ºè®®ï¼Œé‚£ä¹ˆå®ƒçš„é¡ºåºå°±ä¸ equals ä¸ä¸€è‡´ã€‚å¦‚æœä¸€ä¸ªç±»çš„ compareTo æ–¹æ³•å¼ºåŠ äº†ä¸€ä¸ªä¸ equals ä¸ä¸€è‡´çš„é¡ºåºï¼Œé‚£ä¹ˆè¿™ä¸ªç±»ä»ç„¶å¯ä»¥å·¥ä½œï¼Œä½†æ˜¯åŒ…å«è¯¥ç±»å…ƒç´ çš„æœ‰åºé›†åˆå¯èƒ½æ— æ³•éµå®ˆé›†åˆæ¥å£ï¼ˆCollectionã€Set æˆ– Mapï¼‰çš„ä¸€èˆ¬çº¦å®šã€‚è¿™æ˜¯å› ä¸ºè¿™äº›æ¥å£çš„ä¸€èˆ¬çº¦å®šæ˜¯æ ¹æ® equals æ–¹æ³•å®šä¹‰çš„ï¼Œä½†æ˜¯æœ‰åºé›†åˆä½¿ç”¨ compareTo ä»£æ›¿äº† equals å®æ–½åŒç­‰æ€§æ£€éªŒã€‚å¦‚æœå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œè¿™ä¸æ˜¯ä¸€åœºç¾éš¾ï¼Œä½†è¿™æ˜¯éœ€è¦æ³¨æ„çš„ã€‚\nä¾‹å¦‚ï¼Œè€ƒè™‘ BigDecimal ç±»ï¼Œå®ƒçš„ compareTo æ–¹æ³•ä¸ equals ä¸ä¸€è‡´ã€‚å¦‚æœä½ åˆ›å»ºä¸€ä¸ªç©ºçš„ HashSet å®ä¾‹ï¼Œç„¶åæ·»åŠ  new BigDecimal(\u0026quot;1.0\u0026quot;) å’Œ new BigDecimal(\u0026quot;1.00\u0026quot;)ï¼Œé‚£ä¹ˆè¯¥ HashSet å°†åŒ…å«ä¸¤ä¸ªå…ƒç´ ï¼Œå› ä¸ºæ·»åŠ åˆ°è¯¥é›†åˆçš„ä¸¤ä¸ª BigDecimal å®ä¾‹åœ¨ä½¿ç”¨ equals æ–¹æ³•è¿›è¡Œæ¯”è¾ƒæ—¶ç»“æœæ˜¯ä¸ç›¸ç­‰çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ ä½¿ç”¨ TreeSet è€Œä¸æ˜¯ HashSet æ‰§è¡Œç›¸åŒçš„è¿‡ç¨‹ï¼Œé‚£ä¹ˆè¯¥é›†åˆå°†åªåŒ…å«ä¸€ä¸ªå…ƒç´ ï¼Œå› ä¸ºä½¿ç”¨ compareTo æ–¹æ³•æ¯”è¾ƒä¸¤ä¸ª BigDecimal å®ä¾‹æ—¶ç»“æœæ˜¯ç›¸ç­‰çš„ã€‚ï¼ˆæœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… BigDecimal æ–‡æ¡£ã€‚ï¼‰\nç¼–å†™ compareTo æ–¹æ³•ç±»ä¼¼äºç¼–å†™ equals æ–¹æ³•ï¼Œä½†æ˜¯æœ‰ä¸€äº›å…³é”®çš„åŒºåˆ«ã€‚å› ä¸º Comparable æ¥å£æ˜¯å‚æ•°åŒ–çš„ï¼ŒcompareTo æ–¹æ³•æ˜¯é™æ€ç±»å‹çš„ï¼Œæ‰€ä»¥ä¸éœ€è¦è¿›è¡Œç±»å‹æ£€æŸ¥æˆ–å¼ºåˆ¶è½¬æ¢å®ƒçš„å‚æ•°ã€‚å¦‚æœå‚æ•°ç±»å‹é”™è¯¯ï¼Œåˆ™è¯¥è°ƒç”¨å°†ä¸èƒ½ç¼–è¯‘ã€‚å¦‚æœå‚æ•°ä¸º nullï¼Œåˆ™è°ƒç”¨åº”è¯¥æŠ›å‡º NullPointerExceptionï¼Œå¹¶ä¸”åœ¨æ–¹æ³•å°è¯•è®¿é—®å…¶æˆå‘˜æ—¶æŠ›å‡ºè¯¥å¼‚å¸¸ã€‚\nåœ¨ compareTo æ–¹æ³•ä¸­ï¼Œå­—æ®µæ˜¯æŒ‰é¡ºåºè€Œä¸æ˜¯æŒ‰åŒç­‰æ€§æ¥æ¯”è¾ƒçš„ã€‚è¦æ¯”è¾ƒå¯¹è±¡å¼•ç”¨å­—æ®µï¼Œè¦é€’å½’è°ƒç”¨ compareTo æ–¹æ³•ã€‚å¦‚æœä¸€ä¸ªå­—æ®µæ²¡æœ‰å®ç° Comparableï¼Œæˆ–è€…éœ€è¦ä¸€ä¸ªéæ ‡å‡†çš„æ’åºï¼Œé‚£ä¹ˆåº”ä½¿ç”¨ Comparatorã€‚å¯ä»¥ç¼–å†™è‡ªå®šä¹‰çš„æ¯”è¾ƒå™¨ï¼Œæˆ–ä½¿ç”¨ç°æœ‰çš„æ¯”è¾ƒå™¨ï¼Œå¦‚ CaseInsensitiveString çš„ compareTo æ–¹æ³•ï¼š\n// Single-field Comparable with object reference field public final class CaseInsensitiveString implements Comparable\u0026lt;CaseInsensitiveString\u0026gt; { public int compareTo(CaseInsensitiveString cis) { return String.CASE_INSENSITIVE_ORDER.compare(s, cis.s); } ... // Remainder omitted } æ³¨æ„ CaseInsensitiveString å®ç°äº† Comparable\u0026lt;CaseInsensitiveString\u0026gt;ã€‚è¿™æ„å‘³ç€ CaseInsensitiveString å¼•ç”¨åªèƒ½ä¸å¦ä¸€ä¸ª CaseInsensitiveString å¼•ç”¨è¿›è¡Œæ¯”è¾ƒã€‚è¿™æ˜¯åœ¨å£°æ˜å®ç° Comparable çš„ç±»æ—¶è¦éµå¾ªçš„å¸¸è§„æ¨¡å¼ã€‚\næœ¬ä¹¦çš„æ—§ç‰ˆæœ¬å»ºè®® compareTo æ–¹æ³•ä½¿ç”¨å…³ç³»è¿ç®—ç¬¦ \u0026lt; å’Œ \u0026gt; æ¥æ¯”è¾ƒæ•´æ•°åŸºæœ¬ç±»å‹å­—æ®µï¼Œä½¿ç”¨é™æ€æ–¹æ³• Double.compare å’Œ Float.compare æ¥æ¯”è¾ƒæµ®ç‚¹åŸºæœ¬ç±»å‹å­—æ®µã€‚åœ¨ Java 7 ä¸­ï¼Œé™æ€æ¯”è¾ƒæ–¹æ³•è¢«æ·»åŠ åˆ°æ‰€æœ‰ Java çš„åŒ…è£…ç±»ä¸­ã€‚åœ¨ compareTo æ–¹æ³•ä¸­ä½¿ç”¨å…³ç³»è¿ç®—ç¬¦ \u0026lt; å’Œ \u0026gt; å†—é•¿ä¸”å®¹æ˜“å‡ºé”™ï¼Œå› æ­¤ä¸å†æ¨èä½¿ç”¨ã€‚\nå¦‚æœä¸€ä¸ªç±»æœ‰å¤šä¸ªé‡è¦å­—æ®µï¼Œé‚£ä¹ˆæ¯”è¾ƒå®ƒä»¬çš„é¡ºåºéå¸¸å…³é”®ã€‚ä»æœ€é‡è¦çš„å­—æ®µå¼€å§‹ï¼Œä¸€æ­¥æ­¥å¾€ä¸‹ã€‚å¦‚æœæ¯”è¾ƒçš„ç»“æœä¸æ˜¯ 0ï¼ˆç”¨ 0 è¡¨ç¤ºç›¸ç­‰ï¼‰ï¼Œé‚£ä¹ˆå°±å®Œæˆäº†ï¼›ç›´æ¥è¿”å›ç»“æœã€‚å¦‚æœæœ€é‡è¦çš„å­—æ®µæ˜¯ç›¸ç­‰çš„ï¼Œå°±æ¯”è¾ƒä¸‹ä¸€ä¸ªæœ€é‡è¦çš„å­—æ®µï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªä¸ç›¸ç­‰çš„å­—æ®µæˆ–æ¯”è¾ƒåˆ°æœ€ä¸é‡è¦çš„å­—æ®µä¸ºæ­¢ã€‚ä¸‹é¢æ˜¯ PhoneNumber ç±»çš„ compareTo æ–¹æ³•ï¼Œæ¼”ç¤ºäº†è¿™ç§æŠ€æœ¯ï¼š\n// Multiple-field Comparable with primitive fields public int compareTo(PhoneNumber pn) { int result = Short.compare(areaCode, pn.areaCode); if (result == 0) { result = Short.compare(prefix, pn.prefix); if (result == 0) result = Short.compare(lineNum, pn.lineNum); } return result; } åœ¨ Java 8 ä¸­ï¼ŒComparator æ¥å£é…å¤‡äº†ä¸€ç»„æ¯”è¾ƒå™¨æ„é€ æ–¹æ³•ï¼Œå¯ä»¥æµç•…åœ°æ„é€ æ¯”è¾ƒå™¨ã€‚ç„¶åå¯ä»¥ä½¿ç”¨è¿™äº›æ¯”è¾ƒå™¨æ¥å®ç° Comparator æ¥å£æ‰€è¦æ±‚çš„ compareTo æ–¹æ³•ã€‚è®¸å¤šç¨‹åºå‘˜æ›´å–œæ¬¢è¿™ç§æ–¹æ³•çš„ç®€æ˜ï¼Œå°½ç®¡å®ƒå­˜åœ¨ä¸€äº›æ€§èƒ½æˆæœ¬ï¼šåœ¨æˆ‘çš„æœºå™¨ä¸Šï¼ŒPhoneNumber å®ä¾‹çš„æ•°ç»„æ’åºè¦æ…¢ 10% å·¦å³ã€‚åœ¨ä½¿ç”¨è¿™ç§æ–¹æ³•æ—¶ï¼Œè¯·è€ƒè™‘ä½¿ç”¨ Java çš„é™æ€å¯¼å…¥åŠŸèƒ½ï¼Œè¿™æ ·ä½ å°±å¯ä»¥é€šè¿‡é™æ€æ¯”è¾ƒå™¨æ„é€ æ–¹æ³•çš„ç®€å•åç§°æ¥å¼•ç”¨å®ƒä»¬ï¼Œä»¥è·å¾—æ¸…æ™°å’Œç®€æ´ã€‚ä¸‹é¢æ˜¯ PhoneNumber ç±»çš„ compareTo æ–¹æ³•æ”¹è¿›åçš„æ ·å­ï¼š\n// Comparable with comparator construction methods private static final Comparator\u0026lt;PhoneNumber\u0026gt; COMPARATOR = comparingInt((PhoneNumber pn) -\u0026gt; pn.areaCode) .thenComparingInt(pn -\u0026gt; pn.prefix) .thenComparingInt(pn -\u0026gt; pn.lineNum); public int compareTo(PhoneNumber pn) { return COMPARATOR.compare(this, pn); } è¿™ä¸ªå®ç°åœ¨ç±»åˆå§‹åŒ–æ—¶ä½¿ç”¨ä¸¤ä¸ªæ¯”è¾ƒå™¨æ„é€ æ–¹æ³•æ„å»ºä¸€ä¸ªæ¯”è¾ƒå™¨ã€‚ç¬¬ä¸€ä¸ªæ˜¯ comparingIntã€‚å®ƒæ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œæ¥å—ä¸€ä¸ª key æå–å™¨å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†å¯¹è±¡å¼•ç”¨æ˜ å°„åˆ° int ç±»å‹çš„ key ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ¯”è¾ƒå™¨ï¼Œæ¯”è¾ƒå™¨æ ¹æ®è¯¥ key å¯¹å®ä¾‹è¿›è¡Œæ’åºã€‚åœ¨ä¸Šè¿°çš„ç¤ºä¾‹ä¸­ï¼ŒcomparingInt ä½¿ç”¨ lambda è¡¨è¾¾å¼ä» PhoneNumber ä¸­æå– areaCodeï¼Œå¹¶è¿”å› Comparator\u0026lt;PhoneNumber\u0026gt;ï¼ŒæŒ‰åŒºå·æ¥æ’åºç”µè¯å·ç ã€‚æ³¨æ„ï¼Œlambda è¡¨è¾¾å¼æ˜¾å¼åœ°æŒ‡å®šå…¶è¾“å…¥å‚æ•°çš„ç±»å‹ä¸º PhoneNumberã€‚äº‹å®è¯æ˜ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒJava çš„ç±»å‹æ¨æ–­å¹¶æ²¡æœ‰å¼ºå¤§åˆ°è¶³ä»¥è‡ªå·±åˆ¤æ–­ç±»å‹ï¼Œå› æ­¤æˆ‘ä»¬ä¸å¾—ä¸å¸®åŠ©å®ƒæ¥ç¼–è¯‘ç¨‹åºã€‚\nå¦‚æœä¸¤ä¸ªç”µè¯å·ç æœ‰ç›¸åŒçš„åŒºå·ï¼Œæˆ‘ä»¬éœ€è¦è¿›ä¸€æ­¥æ”¹è¿›æ¯”è¾ƒï¼Œè¿™æ­£æ˜¯ç¬¬äºŒä¸ª comparator æ„é€ æ–¹æ³• thenComparingInt æ‰€åšçš„ã€‚å®ƒæ˜¯ Comparator ä¸Šçš„ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼Œå®ƒæ¥å—ä¸€ä¸ª int ç±»å‹çš„ key æå–å‡½æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ¯”è¾ƒå™¨ï¼Œè¯¥æ¯”è¾ƒå™¨é¦–å…ˆåº”ç”¨åŸå§‹æ¯”è¾ƒå™¨ï¼Œç„¶åä½¿ç”¨æå–çš„ key æ¥æ–­å¼€è¿æ¥ã€‚ä½ å¯ä»¥ä»»æ„å †å å¯¹ thenComparingInt çš„è°ƒç”¨ï¼Œä»è€Œå½¢æˆå­—å…¸é¡ºåºã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†ä¸¤ä¸ªå¯¹ thenComparingInt çš„è°ƒç”¨å åŠ èµ·æ¥ï¼Œå¾—åˆ°ä¸€ä¸ªæ’åºï¼Œå®ƒçš„ç¬¬äºŒä¸ª key æ˜¯ prefixï¼Œè€Œç¬¬ä¸‰ä¸ª key æ˜¯ lineNumã€‚æ³¨æ„ï¼Œæˆ‘ä»¬ä¸å¿…æŒ‡å®šä¼ é€’ç»™ä¸¤ä¸ªè°ƒç”¨ thenComparingInt çš„ key æå–å™¨å‡½æ•°çš„å‚æ•°ç±»å‹ï¼šJava çš„ç±»å‹æ¨æ–­è¶³å¤Ÿæ™ºèƒ½ï¼Œå¯ä»¥è‡ªè¡Œè§£å†³è¿™ä¸ªé—®é¢˜ã€‚\nComparator ç±»å…·æœ‰å®Œæ•´çš„æ„é€ æ–¹æ³•ã€‚å¯¹äº long å’Œ double çš„åŸºæœ¬ç±»å‹ï¼Œæœ‰ç±»ä¼¼ comparingInt å’Œ thenComparingInt çš„æ–¹æ³•ã€‚int ç‰ˆæœ¬è¿˜å¯ä»¥ç”¨äºèŒƒå›´æ›´å°çš„æ•´æ•°ç±»å‹ï¼Œå¦‚ PhoneNumber ç¤ºä¾‹ä¸­çš„ shortã€‚double ç‰ˆæœ¬ä¹Ÿå¯ä»¥ç”¨äº floatã€‚Comparator ç±»æä¾›çš„æ„é€ æ–¹æ³•è¦†ç›–äº†æ‰€æœ‰ Java æ•°å€¼åŸºæœ¬ç±»å‹ã€‚\nä¹Ÿæœ‰å¯¹è±¡å¼•ç”¨ç±»å‹çš„æ¯”è¾ƒå™¨æ„é€ æ–¹æ³•ã€‚é™æ€æ–¹æ³•åä¸º compareï¼Œå®ƒæœ‰ä¸¤ä¸ªé‡è½½ã€‚ä¸€ä¸ªæ˜¯ä½¿ç”¨ key æå–å™¨å¹¶ä½¿ç”¨ key çš„è‡ªç„¶é¡ºåºã€‚ç¬¬äºŒç§æ–¹æ³•åŒæ—¶ä½¿ç”¨ key æå–å™¨å’Œæ¯”è¾ƒå™¨å¯¹æå–çš„ key è¿›è¡Œæ¯”è¾ƒã€‚å®ä¾‹æ–¹æ³•æœ‰ä¸‰ç§é‡è½½ï¼Œç§°ä¸º thenComparingã€‚ä¸€ä¸ªé‡è½½åªéœ€è¦ä¸€ä¸ªæ¯”è¾ƒå™¨å¹¶ä½¿ç”¨å®ƒæ¥æä¾›ä¸€ä¸ªäºŒçº§é¡ºåºã€‚ç¬¬äºŒä¸ªé‡è½½åªæ¥å—ä¸€ä¸ª key æå–å™¨ï¼Œå¹¶å°† key çš„è‡ªç„¶é¡ºåºç”¨ä½œäºŒçº§é¡ºåºã€‚æœ€åçš„é‡è½½éœ€è¦ä¸€ä¸ª key æå–å™¨å’Œä¸€ä¸ªæ¯”è¾ƒå™¨æ¥å¯¹æå–çš„ key è¿›è¡Œæ¯”è¾ƒã€‚\næœ‰æ—¶å€™ï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ° compareTo æˆ– compare æ–¹æ³•ï¼Œå®ƒä»¬ä¾èµ–äºä»¥ä¸‹äº‹å®ï¼šå¦‚æœç¬¬ä¸€ä¸ªå€¼å°äºç¬¬äºŒä¸ªå€¼ï¼Œåˆ™ä¸¤ä¸ªå€¼ä¹‹é—´çš„å·®ä¸ºè´Ÿï¼›å¦‚æœä¸¤ä¸ªå€¼ç›¸ç­‰ï¼Œåˆ™ä¸ºé›¶ï¼›å¦‚æœç¬¬ä¸€ä¸ªå€¼å¤§äºé›¶ï¼Œåˆ™ä¸ºæ­£ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š\n// BROKEN difference-based comparator - violates transitivity! static Comparator\u0026lt;Object\u0026gt; hashCodeOrder = new Comparator\u0026lt;\u0026gt;() { public int compare(Object o1, Object o2) { return o1.hashCode() - o2.hashCode(); } }; ä¸è¦ä½¿ç”¨è¿™ç§æŠ€æœ¯ã€‚å®ƒå……æ»¡äº†æ¥è‡ªæ•´æ•°æº¢å‡ºå’Œ IEEE 754 æµ®ç‚¹è¿ç®—æ„ä»¶çš„å±é™© [JLS 15.20.1, 15.21.1]ã€‚æ­¤å¤–ï¼Œç”Ÿæˆçš„æ–¹æ³•ä¸å¤ªå¯èƒ½æ¯”ä½¿ç”¨æœ¬é¡¹ç›®ä¸­æè¿°çš„æŠ€æœ¯ç¼–å†™çš„æ–¹æ³•å¿«å¾—å¤šã€‚åº”ä½¿ç”¨é™æ€æ¯”è¾ƒæ–¹æ³•ï¼š\n// Comparator based on static compare method static Comparator\u0026lt;Object\u0026gt; hashCodeOrder = new Comparator\u0026lt;\u0026gt;() { public int compare(Object o1, Object o2) { return Integer.compare(o1.hashCode(), o2.hashCode()); } }; æˆ–æ¯”è¾ƒå™¨æ„é€ æ–¹æ³•ï¼š\n// Comparator based on Comparator construction method static Comparator\u0026lt;Object\u0026gt; hashCodeOrder = Comparator .comparingInt(o -\u0026gt; o.hashCode()); æ€»ä¹‹ï¼Œæ— è®ºä½•æ—¶å®ç°å…·æœ‰æ’åºæ€§è´¨çš„å€¼ç±»ï¼Œéƒ½åº”è¯¥è®©ç±»å®ç° Comparable æ¥å£ï¼Œè¿™æ ·å°±å¯ä»¥è½»æ¾åœ°å¯¹å®ä¾‹è¿›è¡Œæ’åºã€æœç´¢ï¼Œå¹¶ä¸ä¾èµ–äºæ­¤æ¥å£çš„é›†åˆå®ç°è¿›è¡Œäº’æ“ä½œã€‚åœ¨ compareTo æ–¹æ³•çš„å®ç°ä¸­æ¯”è¾ƒå­—æ®µå€¼æ—¶ï¼Œé¿å…ä½¿ç”¨ \u0026lt; å’Œ \u0026gt; æ“ä½œç¬¦ï¼Œåº”ä½¿ç”¨åŒ…è£…ç±»ä¸­çš„é™æ€æ¯”è¾ƒæ–¹æ³•æˆ– Comparator æ¥å£ä¸­çš„ comparator æ„é€ æ–¹æ³•ã€‚\næ€»ç»“ å»ºè®®åœ¨å®ç°æ¯”è¾ƒåŠŸèƒ½æ—¶ï¼Œåº”è¯¥è€ƒè™‘å®ç° Comparable æ¥å£ã€‚Comparable æ¥å£æ˜¯ä¸€ä¸ªæ³›å‹æ¥å£ï¼Œå…¶ä¸­åªåŒ…å«ä¸€ä¸ªæ–¹æ³• compareTo(T o)ï¼Œç”¨äºæ¯”è¾ƒå½“å‰å¯¹è±¡å’Œå¦ä¸€ä¸ªå¯¹è±¡çš„å¤§å°å…³ç³»ã€‚å®ç° Comparable æ¥å£å¯ä»¥ä½¿å¾—ä¸€ä¸ªç±»å…·æœ‰å¯æ¯”æ€§ï¼Œä»è€Œå¯ä»¥è¿›è¡Œæ’åºç­‰æ“ä½œã€‚\nä»¥ä¸‹æ˜¯åœ¨å®ç° Comparable æ¥å£æ—¶éœ€è¦æ³¨æ„çš„ä¸€äº›é—®é¢˜ï¼š\né¦–å…ˆï¼Œéœ€è¦ç¡®ä¿ç±»å®ç°äº† Comparable æ¥å£ï¼Œå¹¶å®ç°äº† compareTo æ–¹æ³•ã€‚åœ¨å®ç° compareTo æ–¹æ³•æ—¶ï¼Œéœ€è¦è€ƒè™‘åˆ°å¯¹è±¡çš„æ¯”è¾ƒé¡ºåºï¼Œå¹¶è¿”å›ä¸€ä¸ªæ•´æ•°å€¼è¡¨ç¤ºä¸¤ä¸ªå¯¹è±¡ä¹‹é—´çš„å¤§å°å…³ç³»ã€‚ åœ¨å®ç° compareTo æ–¹æ³•æ—¶ï¼Œéœ€è¦ç¡®ä¿æ¯”è¾ƒç»“æœçš„ä¸€è‡´æ€§ã€å¯¹ç§°æ€§å’Œä¼ é€’æ€§ã€‚å…·ä½“æ¥è¯´ï¼Œå¦‚æœ a.compareTo(b) è¿”å›æ­£æ•´æ•°ï¼Œé‚£ä¹ˆ b.compareTo(a) åº”è¯¥è¿”å›è´Ÿæ•´æ•°ï¼›å¦‚æœ a.compareTo(b) å’Œ b.compareTo(c) çš„è¿”å›å€¼éƒ½æ˜¯æ­£æ•´æ•°ï¼Œé‚£ä¹ˆ a.compareTo(c) çš„è¿”å›å€¼ä¹Ÿåº”è¯¥æ˜¯æ­£æ•´æ•°ã€‚ å¦‚æœä¸€ä¸ªç±»æœ‰å¤šä¸ªå¯ä»¥æ¯”è¾ƒçš„å±æ€§ï¼Œé‚£ä¹ˆåœ¨å®ç° compareTo æ–¹æ³•æ—¶éœ€è¦æŒ‰ç…§æ¯”è¾ƒçš„ä¼˜å…ˆçº§è¿›è¡Œæ¯”è¾ƒã€‚é€šå¸¸ï¼Œå¯ä»¥å…ˆæ¯”è¾ƒç¬¬ä¸€ä¸ªå±æ€§ï¼Œå¦‚æœç›¸ç­‰å†æ¯”è¾ƒç¬¬äºŒä¸ªå±æ€§ï¼Œä»¥æ­¤ç±»æ¨ã€‚ å¦‚æœä¸€ä¸ªç±»å®ç°äº† Comparable æ¥å£ï¼Œé‚£ä¹ˆé€šå¸¸ä¹Ÿåº”è¯¥åŒæ—¶å®ç° equals å’Œ hashCode æ–¹æ³•ã€‚åœ¨å®ç° equals æ–¹æ³•æ—¶ï¼Œéœ€è¦è€ƒè™‘åˆ°æ¯”è¾ƒçš„å¯¹è±¡æ˜¯å¦ä¸º nullã€å¯¹è±¡ç±»å‹æ˜¯å¦ç›¸åŒç­‰å› ç´ ã€‚åœ¨å®ç° hashCode æ–¹æ³•æ—¶ï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨ç±»ä¸­å¯æ¯”è¾ƒå±æ€§çš„å“ˆå¸Œå€¼ï¼Œä»¥ç¡®ä¿å“ˆå¸Œè¡¨ç­‰æ•°æ®ç»“æ„èƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†è¯¥ç±»çš„å¯¹è±¡ã€‚ å¦‚æœä¸€ä¸ªç±»éœ€è¦æ”¯æŒå¤šç§æ¯”è¾ƒæ–¹å¼ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘ä½¿ç”¨ç­–ç•¥æ¨¡å¼æˆ–è€…æ¯”è¾ƒå™¨ï¼ˆComparatorï¼‰æ¥å£æ¥å®ç°ã€‚ä½¿ç”¨æ¯”è¾ƒå™¨æ¥å£å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°æŒ‡å®šæ¯”è¾ƒæ–¹å¼ï¼Œä»è€Œæ›´åŠ çµæ´»ã€‚ å®ç° Comparable æ¥å£çš„ç¤ºä¾‹ä»£ç ï¼š\npublic class Person implements Comparable\u0026lt;Person\u0026gt; { private String name; private int age; public Person(String name,int age) { this.name = name; this.age = age; } // å®ç° compareTo æ–¹æ³•ï¼ŒæŒ‰ç…§å¹´é¾„å‡åºæ’åº @Override public int compareTo(Person o) { return Integer.compare(this.age, o.age); } // å®ç° equals æ–¹æ³•å’Œ hashCode æ–¹æ³• @Override public boolean equals(Object obj) { if (obj == this) { return true; } if (!(obj instanceof Person)) { return false; } Person other = (Person) obj; return Objects.equals(this.name, other.name) \u0026amp;\u0026amp; this.age == other.age; } @Override public int hashCode() { return Objects.hash(this.name, this.age); } } åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼ŒPerson ç±»å®ç°äº† Comparable æ¥å£ï¼Œå¹¶å®ç°äº† compareTo æ–¹æ³•ã€‚åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æŒ‰ç…§å¯¹è±¡çš„å¹´é¾„å‡åºæ’åºã€‚ä¸ºäº†ç¡®ä¿ equals æ–¹æ³•å’Œ hashCode æ–¹æ³•çš„æ­£ç¡®æ€§ï¼Œæˆ‘ä»¬ä¹Ÿå®ç°äº†è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œä»¥ç¡®ä¿ Person å¯¹è±¡åœ¨ä½¿ç”¨å“ˆå¸Œè¡¨ç­‰æ•°æ®ç»“æ„æ—¶èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/05/26/consider-implementing-comparable/","summary":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬ä¸‰ç« ã€Šå¯¹è±¡çš„é€šç”¨æ–¹æ³•ã€‹çš„å­¦ä¹ ç¬”è®°ï¼šè€ƒè™‘å®ç° Comparable æ¥å£ã€‚\nä»‹ç» ä¸æœ¬ç« è®¨è®ºçš„å…¶ä»–æ–¹æ³•ä¸åŒï¼ŒcompareTo æ–¹æ³•ä¸æ˜¯åœ¨ Object ä¸­å£°æ˜çš„ã€‚ç›¸åï¼Œå®ƒæ˜¯ Comparable æ¥å£ä¸­çš„å”¯ä¸€æ–¹æ³•ã€‚å®ƒåœ¨æ€§è´¨ä¸Šç±»ä¼¼äº Object çš„ equals æ–¹æ³•ï¼Œé™¤äº†ç®€å•çš„ç›¸ç­‰æ¯”è¾ƒä¹‹å¤–ï¼Œå®ƒè¿˜å…è®¸é¡ºåºæ¯”è¾ƒï¼Œè€Œä¸”å®ƒæ˜¯é€šç”¨çš„ã€‚ä¸€ä¸ªç±»å®ç° Comparableï¼Œè¡¨æ˜å®ä¾‹å…·æœ‰è‡ªç„¶é¡ºåºã€‚å¯¹å®ç° Comparable çš„å¯¹è±¡æ•°ç»„è¿›è¡Œæ’åºéå¸¸ç®€å•ï¼š\nArrays.sort(a); ç±»ä¼¼åœ°ï¼Œæœç´¢ã€è®¡ç®—æå€¼å’Œç»´æŠ¤ Comparable å¯¹è±¡çš„è‡ªåŠ¨æ’åºé›†åˆä¹Ÿå¾ˆå®¹æ˜“ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ç¨‹åºä¾èµ–äº String å®ç° Comparable è¿™ä¸€äº‹å®ï¼Œå°†å‘½ä»¤è¡Œå‚æ•°åˆ—è¡¨æŒ‰å­—æ¯é¡ºåºæ‰“å°å‡ºæ¥ï¼Œå¹¶æ¶ˆé™¤é‡å¤ï¼š\npublic class WordList { public static void main(String[] args) { Set\u0026lt;String\u0026gt; s = new TreeSet\u0026lt;\u0026gt;(); Collections.addAll(s, args); System.out.println(s); } } é€šè¿‡è®©ç±»å®ç° Comparableï¼Œå°±å¯ä¸ä¾èµ–äºæ­¤æ¥å£çš„æ‰€æœ‰é€šç”¨ç®—æ³•å’Œé›†åˆå®ç°è¿›è¡Œäº’æ“ä½œã€‚ä½ åªéœ€ä»˜å‡ºä¸€ç‚¹ç‚¹åŠªåŠ›å°±èƒ½è·å¾—å¼ºå¤§çš„åŠŸèƒ½ã€‚å®é™…ä¸Šï¼ŒJava åº“ä¸­çš„æ‰€æœ‰å€¼ç±»ä»¥åŠæ‰€æœ‰æšä¸¾ç±»å‹éƒ½å®ç°äº† Comparableã€‚å¦‚æœç¼–å†™çš„å€¼ç±»å…·æœ‰æ˜æ˜¾çš„è‡ªç„¶é¡ºåºï¼Œå¦‚å­—æ¯é¡ºåºã€æ•°å­—é¡ºåºæˆ–æ—¶é—´é¡ºåºï¼Œåˆ™åº”å®ç° Comparable æ¥å£ï¼š\npublic interface Comparable\u0026lt;T\u0026gt; { int compareTo(T t); } compareTo æ–¹æ³•çš„ä¸€èˆ¬çº¦å®šç±»ä¼¼äº equals æ–¹æ³•ï¼š\nå°†ä¸€ä¸ªå¯¹è±¡ä¸æŒ‡å®šçš„å¯¹è±¡è¿›è¡Œé¡ºåºæ¯”è¾ƒã€‚å½“è¯¥å¯¹è±¡å°äºã€ç­‰äºæˆ–å¤§äºæŒ‡å®šå¯¹è±¡æ—¶ï¼Œå¯¹åº”è¿”å›ä¸€ä¸ªè´Ÿæ•´æ•°ã€é›¶æˆ–æ­£æ•´æ•°ã€‚å¦‚æœæŒ‡å®šå¯¹è±¡çš„ç±»å‹é˜»æ­¢å®ƒä¸è¯¥å¯¹è±¡è¿›è¡Œæ¯”è¾ƒï¼Œåˆ™æŠ›å‡º ClassCastExceptionã€‚\nåœ¨ä¸‹é¢çš„æè¿°ä¸­ï¼Œsgn(expression) è¡¨ç¤ºæ•°å­¦ä¸­çš„ç¬¦å·å‡½æ•°ï¼Œå®ƒè¢«å®šä¹‰ä¸ºï¼šæ ¹æ®ä¼ å…¥è¡¨è¾¾å¼çš„å€¼æ˜¯è´Ÿæ•°ã€é›¶æˆ–æ­£æ•°ï¼Œå¯¹åº”è¿”å› -1ã€0 æˆ– 1ã€‚\nå®ç°è€…å¿…é¡»ç¡®ä¿æ‰€æœ‰ x å’Œ y æ»¡è¶³ sgn(x.compareTo(y)) == -sgn(y.compareTo(x))ï¼ˆè¿™æ„å‘³ç€ x.compareTo(y) å½“ä¸”ä»…å½“ y.compareTo(x) æŠ›å‡ºå¼‚å¸¸æ—¶æ‰æŠ›å‡ºå¼‚å¸¸ï¼‰ã€‚ å®ç°è€…è¿˜å¿…é¡»ç¡®ä¿å…³ç³»æ˜¯å¯ä¼ é€’çš„ï¼š(x.compareTo(y) \u0026gt; 0 \u0026amp;\u0026amp; y.compareTo(z) \u0026gt; 0) æ„å‘³ç€ x.compareTo(z) \u0026gt; 0ã€‚ æœ€åï¼Œå®ç°è€…å¿…é¡»ç¡®ä¿ x.compareTo(y) == 0 æ—¶ï¼Œæ‰€æœ‰çš„ z æ»¡è¶³ sgn(x.","title":"ã€ŠEffective Java 3ã€‹ç¬”è®°14ï¼šè€ƒè™‘å®ç° Comparable æ¥å£"},{"content":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬ä¸‰ç« ã€Šå¯¹è±¡çš„é€šç”¨æ–¹æ³•ã€‹çš„å­¦ä¹ ç¬”è®°ï¼šæ˜æ™ºåœ°è¦†ç›– clone æ–¹æ³•ã€‚\nä»‹ç» Cloneable æ¥å£çš„ç›®çš„æ˜¯ä½œä¸º mixin æ¥å£ï¼Œç”¨äºè®©ç±»æ¥å®£ç§°å®ƒä»¬å…è®¸å…‹éš†ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå®ƒæ²¡æœ‰è¾¾åˆ°è¿™ä¸ªç›®çš„ã€‚å®ƒçš„ä¸»è¦ç¼ºç‚¹æ˜¯ç¼ºå°‘ clone æ–¹æ³•ï¼Œå¹¶ä¸” Object ç±»çš„ clone æ–¹æ³•æ˜¯å—ä¿æŠ¤çš„ã€‚å¦‚æœä¸æ±‚åŠ©äºåå°„ï¼Œå°±ä¸èƒ½ä»…ä»…å› ä¸ºå¯¹è±¡å®ç°äº† Cloneable æ¥å£å°±èƒ½è°ƒç”¨ clone æ–¹æ³•ã€‚å³ä½¿åå°„è°ƒç”¨ä¹Ÿå¯èƒ½å¤±è´¥ï¼Œå› ä¸ºä¸èƒ½ä¿è¯å¯¹è±¡å…·æœ‰å¯è®¿é—®çš„ clone æ–¹æ³•ã€‚å°½ç®¡å­˜åœ¨å¤šç§ç¼ºé™·ï¼Œä½†è¯¥æœºåˆ¶çš„ä½¿ç”¨èŒƒå›´ç›¸å½“å¹¿æ³›ï¼Œå› æ­¤ç†è§£å®ƒæ˜¯å€¼å¾—çš„ã€‚æœ¬æ¡ç›®å°†å‘Šè¯‰ä½ å¦‚ä½•å®ç°è¡Œä¸ºè‰¯å¥½çš„ clone æ–¹æ³•ï¼Œè®¨è®ºä»€ä¹ˆæ—¶å€™åº”è¯¥è¿™æ ·åšï¼Œå¹¶æä¾›æ›¿ä»£æ–¹æ¡ˆã€‚\næ—¢ç„¶ Cloneable æ¥å£ä¸åŒ…å«ä»»ä½•æ–¹æ³•ï¼Œç”¨å®ƒæ¥åšä»€ä¹ˆå‘¢ï¼Ÿå®ƒå†³å®šäº† Object ç±»å—ä¿æŠ¤çš„ clone å®ç°çš„è¡Œä¸ºï¼šå¦‚æœä¸€ä¸ªç±»å®ç°äº† Cloneable æ¥å£ï¼ŒObject ç±»çš„ clone æ–¹æ³•åˆ™è¿”å›è¯¥ç±»å®ä¾‹çš„é€å­—æ®µæ‹·è´ï¼›å¦åˆ™å®ƒä¼šæŠ›å‡º CloneNotSupportedExceptionã€‚è¿™æ˜¯æ¥å£éå¸¸ä¸å…¸å‹çš„ä¸€ç§ä½¿ç”¨æ–¹å¼ï¼Œä¸åº”è¯¥æ•ˆä»¿ã€‚é€šå¸¸ï¼Œç±»å®ç°æ¥å£å¯ä»¥è¡¨æ˜ç±»èƒ½å¤Ÿä¸ºå…¶å®¢æˆ·ç«¯åšäº›ä»€ä¹ˆã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå®ƒä¿®æ”¹äº†è¶…ç±»ä¸Šå—ä¿æŠ¤çš„æ–¹æ³•çš„è¡Œä¸ºã€‚\nè™½ç„¶è§„èŒƒæ²¡æœ‰è¯´æ˜ï¼Œä½†æ˜¯åœ¨å®è·µä¸­ï¼Œå®ç° Cloneable æ¥å£çš„ç±»åº”è¯¥æä¾›ä¸€ä¸ªåŠŸèƒ½æ­£å¸¸çš„å…¬å…± clone æ–¹æ³•ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œç±»åŠå…¶æ‰€æœ‰è¶…ç±»å¿…é¡»éµå®ˆå¤æ‚çš„ã€ä¸å¯å¼ºåˆ¶æ‰§è¡Œçš„ã€æ–‡æ¡£å¾ˆå°‘çš„åè®®ã€‚äº§ç”Ÿçš„æœºåˆ¶æ˜¯è„†å¼±çš„ã€å±é™©çš„å’Œéè¯­è¨€çš„ï¼šå³å®ƒåˆ›å»ºå¯¹è±¡è€Œä¸è°ƒç”¨æ„é€ å‡½æ•°ã€‚\nclone æ–¹æ³•çš„ä¸€èˆ¬çº¦å®šå¾ˆè–„å¼±ã€‚ä¸‹é¢çš„å†…å®¹æ˜¯ä» Object è§„èŒƒå¤åˆ¶è¿‡æ¥çš„ï¼š\nåˆ›å»ºå¹¶è¿”å›æ­¤å¯¹è±¡çš„å‰¯æœ¬ã€‚\u0026ldquo;å‰¯æœ¬\u0026rdquo; çš„ç¡®åˆ‡å«ä¹‰å¯èƒ½å–å†³äºå¯¹è±¡çš„ç±»ã€‚é€šå¸¸çš„æ„å›¾æ˜¯ï¼Œå¯¹äºä»»ä½•å¯¹è±¡ xï¼Œè¡¨è¾¾å¼\nx.clone() != x å°†ä¸º trueï¼Œå¹¶ä¸”è¡¨è¾¾å¼\nx.clone().getClass() == x.getClass() å°†ä¸º trueï¼Œä½†è¿™å¹¶ä¸æ˜¯ç»å¯¹è¦æ±‚ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¯¹äºä»»ä½•å¯¹è±¡ x å’Œ yï¼Œå¦‚æœå®ƒä»¬çš„ equals æ–¹æ³•è¿”å› trueï¼Œåˆ™è¡¨è¾¾å¼\nx.clone().equals(x) ä¹Ÿåº”è¿”å› trueã€‚\nclone æ–¹æ³•åˆ›å»ºå¹¶è¿”å›å¯¹è±¡çš„å‰¯æœ¬ã€‚ã€Œå‰¯æœ¬ã€çš„ç¡®åˆ‡å«ä¹‰å¯èƒ½å–å†³äºå¯¹è±¡çš„ç±»åˆ«ã€‚é€šå¸¸ï¼Œå¯¹äºä»»ä½•å¯¹è±¡ xï¼Œè¡¨è¾¾å¼ x.clone() != xã€x.clone().getClass() == x.getClass() ä»¥åŠ x.clone().equals(x) çš„å€¼éƒ½å°†ä¸º trueï¼Œä½†éƒ½ä¸æ˜¯ç»å¯¹çš„ã€‚\næŒ‰ç…§æƒ¯ä¾‹ï¼Œæ­¤æ–¹æ³•è¿”å›çš„å¯¹è±¡åº”é€šè¿‡è°ƒç”¨ super.clone() æ¥è·å–ã€‚å¦‚æœä¸€ä¸ªç±»åŠå…¶æ‰€æœ‰çˆ¶ç±»ï¼ˆé™¤äº† Objectï¼‰éƒ½éµå¾ªè¿™ä¸ªæƒ¯ä¾‹ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰ä»¥ä¸‹æƒ…å†µï¼š\nx.clone().getClass() == x.getClass(). æŒ‰ç…§çº¦å®šï¼Œclone æ–¹æ³•è¿”å›çš„å¯¹è±¡åº”è¯¥é€šè¿‡è°ƒç”¨ super.clone() æ¥è·å¾—ã€‚å¦‚æœä¸€ä¸ªç±»å’Œå®ƒçš„æ‰€æœ‰è¶…ç±»ï¼ˆObject ç±»é™¤å¤–ï¼‰éƒ½éµå®ˆè¿™ä¸ªçº¦å®šï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¡¨è¾¾å¼ x.clone().getClass() == x.getClass() åˆ™ä¸º trueã€‚\næŒ‰ç…§çº¦å®šï¼Œè¿”å›çš„å¯¹è±¡åº”è¯¥ç‹¬ç«‹äºè¢«å…‹éš†çš„å¯¹è±¡ã€‚ä¸ºäº†å®ç°è¿™ç§ç‹¬ç«‹æ€§ï¼Œå¯èƒ½éœ€è¦åœ¨ super.clone() è¿”å›å‰ï¼Œä¿®æ”¹å¯¹è±¡çš„ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µã€‚\nè¿™ç§æœºåˆ¶æœ‰ç‚¹ç±»ä¼¼äºæ„é€ æ–¹æ³•é“¾ï¼Œåªæ˜¯æ²¡æœ‰å¼ºåˆ¶æ‰§è¡Œï¼š\nï¼ˆ1ï¼‰å¦‚æœä¸€ä¸ªç±»çš„ clone æ–¹æ³•è¿”å›çš„å®ä¾‹ä¸æ˜¯é€šè¿‡è°ƒç”¨ super.clone() è€Œæ˜¯é€šè¿‡è°ƒç”¨æ„é€ å‡½æ•°è·å¾—çš„ï¼Œç¼–è¯‘å™¨ä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯å¦‚æœè¿™ä¸ªç±»çš„ä¸€ä¸ªå­ç±»è°ƒç”¨ super.clone()ï¼Œç”±æ­¤äº§ç”Ÿçš„å¯¹è±¡ç±»å‹å°†æ˜¯é”™è¯¯çš„ï¼Œå½±å“å­ç±» clone æ–¹æ³•æ­£å¸¸å·¥ä½œã€‚ ï¼ˆ2ï¼‰å¦‚æœè¦†ç›– clone æ–¹æ³•çš„ç±»æ˜¯ final ä¿®é¥°çš„ï¼Œé‚£ä¹ˆå¯ä»¥å®‰å…¨åœ°å¿½ç•¥è¿™ä¸ªçº¦å®šï¼Œå› ä¸ºæ²¡æœ‰å­ç±»éœ€è¦æ‹…å¿ƒã€‚ ï¼ˆ3ï¼‰å¦‚æœä¸€ä¸ª final ä¿®é¥°çš„ç±»ä¸è°ƒç”¨ super.clone() çš„ clone æ–¹æ³•ã€‚ç±»æ²¡æœ‰ç†ç”±å®ç° Cloneable æ¥å£ï¼Œå› ä¸ºå®ƒä¸ä¾èµ–äº Object ç±»çš„ clone å®ç°çš„è¡Œä¸ºã€‚ class Base { @Override protected Object clone() throws CloneNotSupportedException { return new Base(); // â‘  } } class BasePro extends Base implements Cloneable { @Override protected Object clone() throws CloneNotSupportedException { return super.clone(); } public static void main(String[] args) throws Exception { BasePro basePro = new BasePro(); System.out.println(basePro.clone().getClass()); // è¾“å‡º class com.example.demo.Base System.out.println(basePro.getClass()); // è¾“å‡º class com.example.demo.BasePro } } å¯é‡‡ç”¨ä¸¤ç§æ–¹å¼ä¿®å¤\nâ‘  å¤„æ”¹ç”¨ super.clone() ç§»é™¤ Base ç±»æ•´ä¸ª clone() å®ç° å‡è®¾æ‚¨æƒ³åœ¨ä¸€ä¸ªç±»ä¸­å®ç° Cloneable æ¥å£ï¼Œè€Œå…¶è¶…ç±»æä¾›äº†ä¸€ä¸ªè‰¯å¥½çš„ clone æ–¹æ³•ã€‚é¦–å…ˆè°ƒç”¨ super.clone() æ–¹æ³•ã€‚æ‚¨å¾—åˆ°çš„å¯¹è±¡å°†æ˜¯åŸå§‹å¯¹è±¡çš„ä¸€ä¸ªå®Œå…¨åŠŸèƒ½çš„å‰¯æœ¬ã€‚åœ¨æ‚¨çš„ç±»ä¸­å£°æ˜çš„ä»»ä½•å­—æ®µéƒ½å°†å…·æœ‰ä¸åŸå§‹å¯¹è±¡ç›¸åŒçš„å€¼ã€‚å¦‚æœæ¯ä¸ªå­—æ®µéƒ½åŒ…å«ä¸€ä¸ªåŸºæœ¬ç±»å‹çš„å€¼æˆ–ä¸€ä¸ªä¸å¯å˜å¯¹è±¡çš„å¼•ç”¨ï¼Œåˆ™è¿”å›çš„å¯¹è±¡å¯èƒ½æ­£æ˜¯æ‚¨æ‰€éœ€è¦çš„ï¼Œæ­¤æ—¶ä¸éœ€è¦è¿›ä¸€æ­¥å¤„ç†ã€‚ä¾‹å¦‚ï¼Œå¯¹äº PhoneNumber ç±»ï¼Œå°±æ˜¯è¿™ç§æƒ…å†µï¼Œä½†è¯·æ³¨æ„ï¼Œä¸å¯å˜ç±»ä¸åº”æä¾› clone æ–¹æ³•ï¼Œå› ä¸ºè¿™åªä¼šé¼“åŠ±æµªè´¹æ€§çš„å¤åˆ¶ã€‚åœ¨è¿™ä¸ªå‰æä¸‹ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ª PhoneNumber çš„ clone æ–¹æ³•çš„å®ç°ç¤ºä¾‹ï¼š\n// Clone method for class with no references to mutable state @Override public PhoneNumber clone() { try { return (PhoneNumber) super.clone(); } catch (CloneNotSupportedException e) { throw new AssertionError(); // Can\u0026#39;t happen } } ä¸ºäº†è®©è¿™ä¸ªæ–¹æ³•å·¥ä½œï¼Œå¿…é¡»ä¿®æ”¹ PhoneNumber ç±»çš„å£°æ˜ï¼Œä½¿ä¹‹å®ç° Cloneable æ¥å£ã€‚è™½ç„¶ Object çš„ clone æ–¹æ³•è¿”å› Object ç±»å‹ï¼Œä½†æ˜¯è¿™ä¸ª clone æ–¹æ³•è¿”å› PhoneNumber ç±»å‹ã€‚è¿™æ ·åšæ˜¯åˆæ³•çš„ï¼Œä¹Ÿæ˜¯å¯å–çš„ï¼Œå› ä¸º Java çš„è¿”å›å€¼ç±»å‹æ”¯æŒåå˜ã€‚æ¢å¥è¯è¯´ï¼Œè¦†ç›–æ–¹æ³•çš„è¿”å›ç±»å‹å¯ä»¥æ˜¯è¢«è¦†ç›–æ–¹æ³•çš„è¿”å›ç±»å‹çš„å­ç±»ã€‚è¿™æ ·å°±ä¸éœ€è¦åœ¨å®¢æˆ·ç«¯ä¸­è¿›è¡Œå¼ºåˆ¶è½¬æ¢ã€‚æˆ‘ä»¬å¿…é¡»æŠŠæºè‡ª Object ç±»çš„ super.clone() æ–¹æ³•åœ¨è¿”å›å‰å°†ç»“æœè½¬æ¢ä¸º PhoneNumber ç±»å‹ï¼Œè¿™ç±»å¼ºåˆ¶è½¬æ¢è‚¯å®šä¼šæˆåŠŸã€‚\nå°† super.clone() åŒ…å«åœ¨ try-catch å—ä¸­ã€‚è¿™æ˜¯å› ä¸º Object ç±»å£°æ˜çš„ clone æ–¹æ³•ä¼šæŠ›å‡º CloneNotSupportedExceptionï¼Œè¿™æ˜¯ä¸€ç§ checked exceptionã€‚å› ä¸º PhoneNumber ç±»å®ç°äº† Cloneable æ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬çŸ¥é“å¯¹ super.clone() çš„è°ƒç”¨å°†ä¼šæˆåŠŸã€‚è¿™ä¸ªæ ·æ¿æ–‡ä»¶çš„éœ€æ±‚è¡¨æ˜ CloneNotSupportedException åº”è¯¥æ˜¯ unchecked exceptionã€‚\nå¦‚æœå¯¹è±¡çš„å­—æ®µåŒ…å«å¯å˜å¯¹è±¡çš„å¼•ç”¨ï¼Œå‰é¢æ‰€ç¤º clone æ–¹æ³•çš„è¿™ç§ç®€æ˜“å®ç°å¯èƒ½å¼•å‘ç¾éš¾ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ Stack ç±»ï¼š\npublic class Stack { private Object[] elements; private int size = 0; private static final int DEFAULT_INITIAL_CAPACITY = 16; public Stack() { this.elements = new Object[DEFAULT_INITIAL_CAPACITY]; } public void push(Object e) { ensureCapacity(); elements[size++] = e; } public Object pop() { if (size == 0) throw new EmptyStackException(); Object result = elements[--size]; elements[size] = null; // Eliminate obsolete reference return result; } // Ensure space for at least one more element. private void ensureCapacity() { if (elements.length == size) elements = Arrays.copyOf(elements, 2 * size + 1); } } å‡è®¾ä½ æƒ³è®©è¿™ä¸ªç±»å¯å…‹éš†ã€‚å¦‚æœ clone æ–¹æ³•åªè¿”å› super.clone()ï¼Œå¾—åˆ°çš„ Stack å®ä¾‹åœ¨å…¶ size å­—æ®µä¸­ä¼šæœ‰æ­£ç¡®çš„å€¼ï¼Œä½†å…¶ elements å­—æ®µå°†å¼•ç”¨ä¸åŸå§‹ Stack å®ä¾‹ç›¸åŒçš„æ•°ç»„ã€‚ä¿®æ”¹åˆå§‹å€¼å°†ç ´åå…‹éš†çš„ä¸å˜æ€§ï¼Œåä¹‹äº¦ç„¶ã€‚ä½ å°†å¾ˆå¿«å‘ç°ä½ çš„ç¨‹åºäº§ç”Ÿäº†æ— æ„ä¹‰çš„ç»“æœæˆ–æŠ›å‡º NullPointerExceptionã€‚\nè°ƒç”¨ Stack ç±»ä¸­å”¯ä¸€æ„é€ å‡½æ•°çš„æƒ…å†µæ°¸è¿œä¸ä¼šå‘ç”Ÿã€‚å®é™…ä¸Šï¼Œclone æ–¹æ³•å°†å……å½“æ„é€ å‡½æ•°ï¼›ä½ å¿…é¡»ç¡®ä¿å®ƒä¸ä¼šå¯¹åŸå§‹å¯¹è±¡é€ æˆä¼¤å®³ï¼Œå¹¶ä¸” clone æ–¹æ³•æ­£ç¡®åœ°å®ç°äº†ä¸å˜æ€§ã€‚ä¸ºäº†ä½¿ Stack ç±»ä¸Šçš„ clone æ–¹æ³•æ­£å¸¸å·¥ä½œï¼Œå®ƒå¿…é¡»å¤åˆ¶ Stack ç±»å®ä¾‹çš„å†…éƒ¨ã€‚æœ€ç®€å•çš„åšæ³•æ˜¯åœ¨ elements å­—æ®µå¯¹åº”çš„æ•°ç»„é€’å½’è°ƒç”¨ clone æ–¹æ³•ï¼š\n// Clone method for class with references to mutable state @Override public Stack clone() { try { Stack result = (Stack) super.clone(); result.elements = elements.clone(); return result; } catch (CloneNotSupportedException e) { throw new AssertionError(); } } æ³¨æ„ï¼Œæˆ‘ä»¬ä¸éœ€è¦å°† elements.clone çš„ç»“æœå¼ºåˆ¶è½¬æ¢åˆ° Object[]ã€‚åœ¨æ•°ç»„ä¸Šè°ƒç”¨ clone æ–¹æ³•å°†è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œè¯¥æ•°ç»„çš„è¿è¡Œæ—¶å’Œç¼–è¯‘æ—¶ç±»å‹ä¸è¢«å…‹éš†çš„æ•°ç»„ç›¸åŒã€‚è¿™æ˜¯å¤åˆ¶æ•°ç»„çš„é¦–é€‰ä¹ æƒ¯ç”¨æ³•ã€‚å®é™…ä¸Šï¼Œå¤åˆ¶æ•°ç»„æ˜¯ clone æœºåˆ¶å”¯ä¸€ä»¤äººä¿¡æœçš„ä½¿ç”¨åœºæ™¯ã€‚\nè¿˜è¦æ³¨æ„ï¼Œå¦‚æœ elements å­—æ®µæ˜¯ final ä¿®é¥°çš„ï¼Œä¸Šè¿°è§£å†³æ–¹æ¡ˆå°±æ— æ³•å·¥ä½œï¼Œå› ä¸º clone æ–¹æ³•å°†è¢«ç¦æ­¢ä¸ºå­—æ®µåˆ†é…æ–°å€¼ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºç¡€é—®é¢˜ï¼šä¸åºåˆ—åŒ–ä¸€æ ·ï¼Œå¯å…‹éš†ä½“ç³»ç»“æ„ä¸ä½¿ç”¨ final ä¿®é¥°å¯å˜å¯¹è±¡å¼•ç”¨çš„å¸¸ç”¨æ–¹å¼ä¸å…¼å®¹ï¼Œé™¤éåœ¨å¯¹è±¡ä¸å…¶å…‹éš†å¯¹è±¡ä¹‹é—´å¯ä»¥å®‰å…¨åœ°å…±äº«å¯å˜å¯¹è±¡ã€‚ä¸ºäº†ä½¿ç±»å¯å…‹éš†ï¼Œå¯èƒ½éœ€è¦ä»æŸäº›å­—æ®µä¸­åˆ é™¤ final ä¿®é¥°ç¬¦ã€‚\nä»…ä»…é€’å½’è°ƒç”¨ clone æ–¹æ³•å¹¶ä¸æ€»æ˜¯è¶³å¤Ÿçš„ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ æ­£åœ¨ä¸º HashTable ç¼–å†™ä¸€ä¸ª clone æ–¹æ³•ï¼ŒHashTable çš„å†…éƒ¨ç”±ä¸€ç»„ bucket ç»„æˆï¼Œæ¯ä¸ª bucket å¼•ç”¨é”®-å€¼å¯¹é“¾è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªæ¡ç›®ã€‚ä¸ºäº†æé«˜æ€§èƒ½ï¼Œç±»å®ç°äº†è‡ªå·±çš„è½»é‡çº§å•é“¾è¡¨ï¼Œè€Œä¸æ˜¯åœ¨å†…éƒ¨ä½¿ç”¨ java.util.LinkedListï¼š\npublic class HashTable implements Cloneable { private Entry[] buckets = ...; private static class Entry { final Object key; Object value; Entry next; Entry(Object key, Object value, Entry next) { this.key = key; this.value = value; this.next = next; } } ... // Remainder omitted } å‡è®¾ä½ åªæ˜¯åƒå¯¹ Stack æ‰€åšçš„é‚£æ ·ï¼Œé€’å½’å…‹éš† bucket æ•°ç»„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n// Broken clone method - results in shared mutable state! @Override public HashTable clone() { try { HashTable result = (HashTable) super.clone(); result.buckets = buckets.clone(); return result; } catch (CloneNotSupportedException e) { throw new AssertionError(); } } å°½ç®¡ clone æ–¹æ³•æœ‰è‡ªå·±çš„ bucket æ•°ç»„ï¼Œä½†è¯¥æ•°ç»„å¼•ç”¨çš„é“¾æ¥åˆ—è¡¨ä¸åŸå§‹é“¾è¡¨ç›¸åŒï¼Œè¿™å¾ˆå®¹æ˜“å¯¼è‡´å…‹éš†å’ŒåŸå§‹çš„ä¸ç¡®å®šæ€§è¡Œä¸ºã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½ å¿…é¡»å¤åˆ¶åŒ…å«æ¯ä¸ª bucket çš„é“¾è¡¨ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªå¸¸è§çš„æ–¹æ³•ï¼š\n// Recursive clone method for class with complex mutable state public class HashTable implements Cloneable { private Entry[] buckets = ...; private static class Entry { final Object key; Object value; Entry next; Entry(Object key, Object value, Entry next) { this.key = key; this.value = value; this.next = next; } // Recursively copy the linked list headed by this Entry Entry deepCopy() { return new Entry(key, value,next == null ? null : next.deepCopy()); } } @Override public HashTable clone() { try { HashTable result = (HashTable) super.clone(); result.buckets = new Entry[buckets.length]; for (int i = 0; i \u0026lt; buckets.length; i++) if (buckets[i] != null) result.buckets[i] = buckets[i].deepCopy(); return result; } catch (CloneNotSupportedException e) { throw new AssertionError(); } } ... // Remainder omitted } ç§æœ‰å†…éƒ¨ç±» HashTable.Entry å·²ç»è¢«å¢å¼ºï¼Œå®ƒæä¾›äº†è¿›è¡Œã€Œæ·±æ‹·è´ã€çš„æ–¹æ³•ã€‚HashTable ä¸Šçš„ clone æ–¹æ³•åˆ†é…ä¸€ä¸ªå¤§å°åˆé€‚çš„æ–° buckets æ•°ç»„ï¼Œå¹¶éå†åŸå§‹ buckets æ•°ç»„ï¼Œå¯¹æ¯ä¸ªéç©º buckets å…ƒç´ è¿›è¡Œæ·±æ‹·è´ã€‚Entry ç±»çš„ deepCopy() æ–¹æ³•ä¼šè¢«é€’å½’è°ƒç”¨ç›´è‡³å¤åˆ¶å®Œæ•´ä¸ªé“¾è¡¨ï¼ˆè¯¥é“¾è¡¨ä»¥ Entry ç±»çš„å®ä¾‹ä½œä¸ºå¤´èŠ‚ç‚¹ï¼‰ã€‚è¿™ç§æ–¹æ³•è™½ç„¶å¾ˆçµæ´»ï¼Œè€Œä¸”åœ¨ buckets ä¸å¤ªé•¿çš„æƒ…å†µä¸‹å¯ä»¥å¾ˆå¥½åœ°å·¥ä½œï¼Œä½†æ˜¯å…‹éš†é“¾è¡¨å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½æ–¹æ³•ï¼Œå› ä¸ºå®ƒä¸ºé“¾è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ æ¶ˆè€—ä¸€ä¸ªå †æ ˆå¸§ã€‚å¦‚æœåˆ—è¡¨å¾ˆé•¿ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´å †æ ˆæº¢å‡ºã€‚ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œä½ å¯ä»¥ç”¨è¿­ä»£æ›¿æ¢ deepCopy() æ–¹æ³•çš„é€’å½’è°ƒç”¨ï¼š\n// Iteratively copy the linked list headed by this Entry Entry deepCopy() { Entry result = new Entry(key, value, next); for (Entry p = result; p.next != null; p = p.next) p.next = new Entry(p.next.key, p.next.value, p.next.next); return result; } å…‹éš†å¤æ‚å¯å˜å¯¹è±¡çš„æœ€åä¸€ç§æ–¹æ³•æ˜¯è°ƒç”¨ super.clone()ï¼Œå°†ç»“æœå¯¹è±¡ä¸­çš„æ‰€æœ‰å­—æ®µè®¾ç½®ä¸ºåˆå§‹çŠ¶æ€ï¼Œç„¶åè°ƒç”¨æ›´é«˜çº§åˆ«çš„æ–¹æ³•é‡æ–°ç”ŸæˆåŸå§‹å¯¹è±¡çš„çŠ¶æ€ã€‚åœ¨æˆ‘ä»¬çš„ HashTable ç¤ºä¾‹ä¸­ï¼Œbuckets å­—æ®µå°†åˆå§‹åŒ–ä¸ºä¸€ä¸ªæ–°çš„ bucket æ•°ç»„ï¼Œå¹¶ä¸”å¯¹äºå…‹éš†çš„ hash è¡¨ä¸­çš„æ¯ä¸ªé”®å€¼æ˜ å°„å°†è°ƒç”¨ put(key, value) æ–¹æ³•ï¼ˆæœªæ˜¾ç¤ºï¼‰ã€‚è¿™ç§æ–¹æ³•é€šå¸¸äº§ç”Ÿä¸€ä¸ªç®€å•ã€ç›¸å½“ä¼˜é›…çš„ clone æ–¹æ³•ï¼Œå®ƒçš„è¿è¡Œé€Ÿåº¦ä¸å¦‚ç›´æ¥æ“ä½œå…‹éš†çš„å†…éƒ¨çš„æ–¹æ³•å¿«ã€‚è™½ç„¶è¿™ç§æ–¹æ³•å¾ˆç®€æ´ï¼Œä½†å®ƒä¸æ•´ä¸ªå¯å…‹éš†ä½“ç³»ç»“æ„æ˜¯å¯¹ç«‹çš„ï¼Œå› ä¸ºå®ƒç›²ç›®åœ°è¦†ç›–äº†æ„æˆä½“ç³»ç»“æ„åŸºç¡€çš„é€å­—æ®µå¯¹è±¡å‰¯æœ¬ã€‚\nä¸æ„é€ å‡½æ•°ä¸€æ ·ï¼Œclone æ–¹æ³•ç»ä¸èƒ½åœ¨æ­£åœ¨æ„å»ºçš„å…‹éš†ä¸Šè°ƒç”¨å¯è¦†ç›–æ–¹æ³•ã€‚å¦‚æœ clone è°ƒç”¨ä¸€ä¸ªåœ¨å­ç±»ä¸­è¢«é‡å†™çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°†åœ¨å­ç±»æœ‰æœºä¼šä¿®å¤å…¶åœ¨å…‹éš†ä¸­çš„çŠ¶æ€ä¹‹å‰æ‰§è¡Œï¼Œå¾ˆå¯èƒ½å¯¼è‡´å…‹éš†å’ŒåŸå§‹çš„ç ´åã€‚å› æ­¤ï¼Œå‰ä¸€æ®µä¸­è®¨è®ºçš„ put(key, value) æ–¹æ³•åº”è¯¥æ˜¯ final ä¿®é¥°æˆ– private ä¿®é¥°çš„æ–¹æ³•ã€‚ï¼ˆå¦‚æœå®ƒæ˜¯ç§æœ‰çš„ï¼Œé‚£ä¹ˆå®ƒå¯èƒ½æ˜¯æ²¡æœ‰ final ä¿®é¥°çš„å…¬å…±ã€ŒåŠ©æ‰‹æ–¹æ³•ã€ã€‚)\nå¯¹è±¡çš„ clone æ–¹æ³•è¢«å£°æ˜ä¸ºæŠ›å‡º CloneNotSupportedExceptionï¼Œä½†æ˜¯é‡å†™æ–¹æ³•ä¸éœ€è¦ã€‚å…¬å…±å…‹éš†æ–¹æ³•åº”è¯¥çœç•¥ throw å­å¥ï¼Œ ä½œä¸ºä¸æŠ›å‡ºå—æ§å¼‚å¸¸çš„æ–¹æ³•æ›´å®¹æ˜“ä½¿ç”¨ã€‚\nç”¨ç»§æ‰¿æ–¹å¼è®¾è®¡ä¸€ä¸ªç±»æ—¶ï¼Œä½ æœ‰ä¸¤ç§é€‰æ‹©ï¼Œä½†æ˜¯æ— è®ºä½ é€‰æ‹©å“ªä¸€ç§ï¼Œéƒ½ä¸åº”è¯¥å®ç° Cloneable æ¥å£ã€‚ä½ å¯ä»¥é€‰æ‹©é€šè¿‡å®ç°ä¸€ä¸ªåŠŸèƒ½æ­£å¸¸çš„å—ä¿æŠ¤å…‹éš†æ–¹æ³•æ¥æ¨¡æ‹Ÿ Object çš„è¡Œä¸ºï¼Œè¯¥æ–¹æ³•å£°æ˜ä¸ºæŠ›å‡º CloneNotSupportedExceptionã€‚è¿™ç»™å­ç±»å®ç° Cloneable æˆ–ä¸å®ç° Cloneable çš„è‡ªç”±ï¼Œå°±åƒå®ƒä»¬ç›´æ¥æ‰©å±•å¯¹è±¡ä¸€æ ·ã€‚æˆ–è€…ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸å®ç°ä¸€ä¸ªæœ‰æ•ˆçš„å…‹éš†æ–¹æ³•ï¼Œå¹¶é€šè¿‡æä¾›ä»¥ä¸‹é€€åŒ–çš„å…‹éš†å®ç°æ¥é˜²æ­¢å­ç±»å®ç°å®ƒï¼š\n// clone method for extendable class not supporting Cloneable @Override protected final Object clone() throws CloneNotSupportedException { throw new CloneNotSupportedException(); } è¿˜æœ‰ä¸€ä¸ªç»†èŠ‚éœ€è¦æ³¨æ„ã€‚å¦‚æœä½ ç¼–å†™äº†ä¸€ä¸ªå®ç°äº† Cloneable æ¥å£çš„çº¿ç¨‹å®‰å…¨ç±»ï¼Œè¯·è®°ä½å®ƒçš„ clone æ–¹æ³•å¿…é¡»æ­£ç¡®åŒæ­¥ï¼Œå°±åƒå…¶ä»–ä»»ä½•æ–¹æ³•ä¸€æ ·ã€‚Object ç±»çš„ clone æ–¹æ³•ä¸æ˜¯åŒæ­¥çš„ï¼Œå› æ­¤å³ä½¿å®ƒçš„å®ç°åœ¨å…¶ä»–æ–¹é¢æ˜¯ä»¤äººæ»¡æ„çš„ï¼Œä½ ä¹Ÿå¯èƒ½éœ€è¦ç¼–å†™ä¸€ä¸ªè¿”å› super.clone() çš„åŒæ­¥ clone æ–¹æ³•ã€‚\nå›é¡¾ä¸€ä¸‹ï¼Œæ‰€æœ‰å®ç° Cloneable æ¥å£çš„ç±»éƒ½åº”è¯¥ä½¿ç”¨ä¸€ä¸ªè¿”å›ç±»å‹ä¸ºç±»æœ¬èº«çš„å…¬å…±æ–¹æ³•è¦†ç›– cloneã€‚è¿™ä¸ªæ–¹æ³•åº”è¯¥é¦–å…ˆè°ƒç”¨ super.clone()ï¼Œç„¶åã€Œä¿®å¤ã€ä»»ä½•éœ€è¦ã€Œä¿®å¤ã€çš„å­—æ®µã€‚é€šå¸¸ï¼Œè¿™æ„å‘³ç€å¤åˆ¶ä»»ä½•åŒ…å«å¯¹è±¡å†…éƒ¨ã€Œæ·±å±‚ç»“æ„ã€çš„å¯å˜å¯¹è±¡ï¼Œå¹¶å°†å…‹éš†å¯¹è±¡å¯¹è¿™äº›å¯¹è±¡çš„å¼•ç”¨æ›¿æ¢ä¸ºå¯¹å…¶å‰¯æœ¬çš„å¼•ç”¨ã€‚è™½ç„¶è¿™äº›å†…éƒ¨å‰¯æœ¬é€šå¸¸å¯ä»¥é€šè¿‡é€’å½’è°ƒç”¨ clone æ¥å®ç°ï¼Œä½†è¿™å¹¶ä¸æ€»æ˜¯æœ€å¥½çš„æ–¹æ³•ã€‚å¦‚æœç±»åªåŒ…å«åŸºæœ¬æ•°æ®ç±»å‹çš„å­—æ®µæˆ–å¯¹ä¸å¯å˜å¯¹è±¡çš„å¼•ç”¨ï¼Œé‚£ä¹ˆå¾ˆå¯èƒ½ä¸éœ€è¦ä¿®å¤ä»»ä½•å­—æ®µã€‚è¿™æ¡è§„åˆ™ä¹Ÿæœ‰ä¾‹å¤–ã€‚ä¾‹å¦‚ï¼Œè¡¨ç¤ºåºåˆ—å·æˆ–å…¶ä»–å”¯ä¸€ ID çš„å­—æ®µéœ€è¦ä¿®å¤ï¼Œå³ä½¿å®ƒæ˜¯åŸºæœ¬æ•°æ®ç±»å‹æˆ–ä¸å¯å˜çš„ã€‚\næè¿™ä¹ˆå¤æ‚çœŸçš„æœ‰å¿…è¦å—ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚å¦‚æœä½ æ‰©å±•äº†ä¸€ä¸ªå·²ç»å®ç°äº† Cloneable æ¥å£çš„ç±»ï¼Œé‚£ä¹ˆé™¤äº†å®ç°è¡Œä¸ºè‰¯å¥½çš„ clone æ–¹æ³•ä¹‹å¤–ï¼Œä½ åˆ«æ— é€‰æ‹©ã€‚å¦åˆ™ï¼Œæœ€å¥½æä¾›å¯¹è±¡å¤åˆ¶çš„æ›¿ä»£æ–¹æ³•ã€‚ä¸€ä¸ªæ›´å¥½çš„å¯¹è±¡å¤åˆ¶æ–¹æ³•æ˜¯æä¾›ä¸€ä¸ªå¤åˆ¶æ„é€ å‡½æ•°æˆ–å¤åˆ¶å·¥å‚ã€‚å¤åˆ¶æ„é€ å‡½æ•°æ˜¯ä¸€ä¸ªç®€å•çš„æ„é€ å‡½æ•°ï¼Œå®ƒæ¥å—å•ä¸ªå‚æ•°ï¼Œå…¶ç±»å‹æ˜¯åŒ…å«æ„é€ å‡½æ•°çš„ç±»ï¼Œä¾‹å¦‚ï¼š\n// Copy constructor public Yum(Yum yum) { ... }; å¤åˆ¶å·¥å‚ä¸å¤åˆ¶æ„é€ å‡½æ•°çš„é™æ€å·¥å‚ç±»ä¼¼ï¼š\n// Copy factory public static Yum newInstance(Yum yum) { ... }; å¤åˆ¶æ„é€ å‡½æ•°æ–¹æ³•åŠå…¶é™æ€å·¥å‚å˜ä½“ä¸å…‹éš†/å…‹éš†ç›¸æ¯”æœ‰è®¸å¤šä¼˜ç‚¹ï¼šå®ƒä»¬ä¸ä¾èµ–äºæ˜“å‘ç”Ÿé£é™©çš„è¯­è¨€å¤–å¯¹è±¡åˆ›å»ºæœºåˆ¶ï¼›ä»–ä»¬ä¸è¦æ±‚æ— æ³•å¼ºåˆ¶æ‰§è¡Œçš„çº¦å®šï¼›å®ƒä»¬ä¸æœ€ç»ˆå­—æ®µçš„æ­£ç¡®ä½¿ç”¨ä¸å†²çªï¼›å®ƒä»¬ä¸ä¼šæŠ›å‡ºä¸å¿…è¦çš„æ£€æŸ¥å¼‚å¸¸ï¼›è€Œä¸”ä¸éœ€è¦å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚\næ­¤å¤–ï¼Œå¤åˆ¶æ„é€ å‡½æ•°æˆ–å·¥å‚å¯ä»¥æ¥å—ç±»å‹ä¸ºç±»å®ç°çš„æ¥å£çš„å‚æ•°ã€‚ä¾‹å¦‚ï¼ŒæŒ‰ç…§çº¦å®šï¼Œæ‰€æœ‰é€šç”¨é›†åˆå®ç°éƒ½æä¾›ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå…¶å‚æ•°ä¸º collection æˆ– Map ç±»å‹ã€‚åŸºäºæ¥å£çš„å¤åˆ¶æ„é€ å‡½æ•°å’Œå·¥å‚ï¼ˆæ›´ç¡®åˆ‡åœ°ç§°ä¸ºè½¬æ¢æ„é€ å‡½æ•°å’Œè½¬æ¢å·¥å‚ï¼‰å…è®¸å®¢æˆ·ç«¯é€‰æ‹©å‰¯æœ¬çš„å®ç°ç±»å‹ï¼Œè€Œä¸æ˜¯å¼ºè¿«å®¢æˆ·ç«¯æ¥å—åŸå§‹çš„å®ç°ç±»å‹ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ª HashSet sï¼Œå¹¶ä¸”å¸Œæœ›å°†å®ƒå¤åˆ¶ä¸º TreeSetã€‚å…‹éš†æ–¹æ³•ä¸èƒ½æä¾›è¿™ç§åŠŸèƒ½ï¼Œä½†æ˜¯ä½¿ç”¨è½¬æ¢æ„é€ å‡½æ•°å¾ˆå®¹æ˜“ï¼šnew TreeSet\u0026lt;\u0026gt;(s)ã€‚\nè€ƒè™‘åˆ°ä¸ Cloneable ç›¸å…³çš„æ‰€æœ‰é—®é¢˜ï¼Œæ–°çš„æ¥å£ä¸åº”è¯¥æ‰©å±•å®ƒï¼Œæ–°çš„å¯æ‰©å±•ç±»ä¸åº”è¯¥å®ç°å®ƒã€‚è™½ç„¶ final ç±»å®ç° Cloneable æ¥å£çš„å±å®³è¦å°ä¸€äº›ï¼Œä½†è¿™åº”è¯¥è¢«è§†ä¸ºä¸€ç§æ€§èƒ½ä¼˜åŒ–ï¼Œä»…åœ¨æå°‘æ•°æƒ…å†µä¸‹æ˜¯åˆç†çš„ã€‚é€šå¸¸ï¼Œå¤åˆ¶åŠŸèƒ½æœ€å¥½ç”±æ„é€ å‡½æ•°æˆ–å·¥å‚æä¾›ã€‚è¿™ä¸ªè§„åˆ™çš„ä¸€ä¸ªæ˜æ˜¾çš„ä¾‹å¤–æ˜¯æ•°ç»„ï¼Œæœ€å¥½ä½¿ç”¨ clone æ–¹æ³•æ¥å¤åˆ¶æ•°ç»„ã€‚\næ€»ç»“ å»ºè®®æ…é‡è¦†ç›– clone() æ–¹æ³•ã€‚clone() æ–¹æ³•æ˜¯ä¸€ä¸ªç”¨äºå¯¹è±¡å¤åˆ¶çš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¹¶å°†åŸå§‹å¯¹è±¡çš„çŠ¶æ€å¤åˆ¶åˆ°æ–°çš„å¯¹è±¡ä¸­ã€‚ä½†æ˜¯ï¼Œåœ¨å®ç° clone() æ–¹æ³•æ—¶ï¼Œéœ€è¦æ³¨æ„ä¸€äº›é—®é¢˜ï¼Œå¦åˆ™ä½¿ç”¨ clone() æ–¹æ³•å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›æ½œåœ¨çš„é—®é¢˜ã€‚\nä»¥ä¸‹æ˜¯åœ¨å®ç° clone() æ–¹æ³•æ—¶éœ€è¦æ³¨æ„çš„ä¸€äº›é—®é¢˜ï¼š\né¦–å…ˆï¼Œéœ€è¦ç¡®ä¿ç±»å®ç°äº† Cloneable æ¥å£ã€‚è¿™ä¸ªæ¥å£æ˜¯ä¸€ä¸ªæ ‡è®°æ¥å£ï¼Œæ²¡æœ‰ä»»ä½•æ–¹æ³•ï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ªç±»æ²¡æœ‰å®ç° Cloneable æ¥å£ï¼Œè°ƒç”¨å…¶ clone() æ–¹æ³•ä¼šæŠ›å‡º CloneNotSupportedException å¼‚å¸¸ã€‚ åœ¨å®ç° clone() æ–¹æ³•æ—¶ï¼Œéœ€è¦è°ƒç”¨ super.clone() æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¹¶å°†åŸå§‹å¯¹è±¡çš„çŠ¶æ€å¤åˆ¶åˆ°æ–°çš„å¯¹è±¡ä¸­ã€‚ å¦‚æœç±»çš„æˆå‘˜å˜é‡åŒ…å«å¯å˜å¯¹è±¡ï¼Œé‚£ä¹ˆéœ€è¦å¯¹è¿™äº›æˆå‘˜å˜é‡è¿›è¡Œæ·±åº¦å¤åˆ¶ï¼Œä»¥ç¡®ä¿æ–°å¯¹è±¡ä¸åŸå§‹å¯¹è±¡å…·æœ‰ä¸åŒçš„çŠ¶æ€ã€‚ clone() æ–¹æ³•è¿”å›çš„å¯¹è±¡ç±»å‹æ˜¯ Objectï¼Œéœ€è¦è¿›è¡Œç±»å‹è½¬æ¢ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›ç±»å‹å®‰å…¨é—®é¢˜ã€‚å› æ­¤ï¼Œå»ºè®®åœ¨è¦†ç›– clone() æ–¹æ³•æ—¶ï¼Œå°†è¿”å›ç±»å‹å£°æ˜ä¸ºç±»æœ¬èº«çš„ç±»å‹ï¼Œå¹¶åœ¨æ–¹æ³•ä¸­è¿›è¡Œç±»å‹è½¬æ¢ã€‚ åœ¨å®ç° clone() æ–¹æ³•æ—¶ï¼Œéœ€è¦æ³¨æ„å¯¹å¼‚å¸¸çš„å¤„ç†ã€‚å¦‚æœä¸€ä¸ªç±»æ²¡æœ‰å®ç° Cloneable æ¥å£ï¼Œè°ƒç”¨å…¶ clone() æ–¹æ³•ä¼šæŠ›å‡º CloneNotSupportedException å¼‚å¸¸ã€‚åœ¨å®ç° clone() æ–¹æ³•æ—¶ï¼Œéœ€è¦è€ƒè™‘è¿™ä¸ªå¼‚å¸¸ï¼Œå¹¶åœ¨æ–¹æ³•ä¸­è¿›è¡Œé€‚å½“çš„å¤„ç†ã€‚ æ€»ä¹‹ï¼Œåœ¨è¦†ç›– clone() æ–¹æ³•æ—¶ï¼Œéœ€è¦è€ƒè™‘åˆ°ä¸Šè¿°é—®é¢˜ï¼Œå¹¶æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œå¤„ç†ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦é‡‡ç”¨å…¶ä»–çš„å¤åˆ¶æ–¹å¼ï¼Œä¾‹å¦‚åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚å› æ­¤ï¼Œåœ¨è¦†ç›– clone() æ–¹æ³•ä¹‹å‰ï¼Œéœ€è¦ä»”ç»†è€ƒè™‘æ˜¯å¦çœŸæ­£éœ€è¦ä½¿ç”¨è¯¥æ–¹æ³•ï¼Œå¹¶æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©æœ€åˆé€‚çš„å¤åˆ¶æ–¹å¼ã€‚\næ‰©å±• 1ã€æ·±åº¦æ‹·è´å’Œæµ…åº¦æ‹·è´ æ·±åº¦æ‹·è´å’Œæµ…åº¦æ‹·è´æ˜¯æŒ‡åœ¨è¿›è¡Œå¯¹è±¡å¤åˆ¶æ—¶ï¼Œå¯¹äºå¯¹è±¡ä¸­åŒ…å«çš„æˆå‘˜å˜é‡ï¼Œå¦‚ä½•è¿›è¡Œå¤åˆ¶çš„é—®é¢˜ã€‚\næµ…åº¦æ‹·è´æ˜¯æŒ‡åªå¤åˆ¶å¯¹è±¡ä¸­çš„åŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨ç±»å‹çš„åœ°å€ï¼Œè€Œä¸æ˜¯å¼•ç”¨ç±»å‹æ‰€æŒ‡å‘çš„å¯¹è±¡æœ¬èº«ã€‚è¿™å°±æ„å‘³ç€ï¼Œåœ¨è¿›è¡Œæµ…åº¦æ‹·è´æ—¶ï¼ŒåŸå§‹å¯¹è±¡å’Œå¤åˆ¶å¯¹è±¡ä¸­çš„å¼•ç”¨ç±»å‹æˆå‘˜å˜é‡å°†æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›æ½œåœ¨çš„é—®é¢˜ï¼Œä¾‹å¦‚ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€çš„æ”¹å˜ä¼šå½±å“åˆ°å¦ä¸€ä¸ªå¯¹è±¡ã€‚\næ·±åº¦æ‹·è´æ˜¯æŒ‡å°†å¯¹è±¡ä¸­çš„åŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨ç±»å‹æ‰€æŒ‡å‘çš„å¯¹è±¡éƒ½è¿›è¡Œå¤åˆ¶ã€‚è¿™å°±æ„å‘³ç€ï¼Œåœ¨è¿›è¡Œæ·±åº¦æ‹·è´æ—¶ï¼ŒåŸå§‹å¯¹è±¡å’Œå¤åˆ¶å¯¹è±¡ä¸­çš„å¼•ç”¨ç±»å‹æˆå‘˜å˜é‡å°†æŒ‡å‘ä¸åŒçš„å¯¹è±¡ï¼Œè¿™å¯ä»¥é¿å…ä¸Šè¿°é—®é¢˜ã€‚\nä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸ªåŒ…å«ä¸€ä¸ªå¼•ç”¨ç±»å‹æˆå‘˜å˜é‡çš„ç±» Personï¼Œå…¶ä¸­å¼•ç”¨ç±»å‹æˆå‘˜å˜é‡æ˜¯ä¸€ä¸ª Address å¯¹è±¡ã€‚å¦‚æœè¿›è¡Œæµ…åº¦æ‹·è´ï¼Œé‚£ä¹ˆå¤åˆ¶å¯¹è±¡ä¸­çš„ addressæˆå‘˜å˜é‡å°†æŒ‡å‘åŸå§‹å¯¹è±¡ä¸­çš„ address æˆå‘˜å˜é‡æŒ‡å‘çš„åŒä¸€ä¸ª Address å¯¹è±¡ã€‚è¿™å°±æ„å‘³ç€ï¼Œå¦‚æœä¿®æ”¹å¤åˆ¶å¯¹è±¡ä¸­çš„ address æˆå‘˜å˜é‡ï¼ŒåŸå§‹å¯¹è±¡ä¸­çš„ address æˆå‘˜å˜é‡ä¹Ÿä¼šå‘ç”Ÿæ”¹å˜ã€‚\nå¦‚æœè¿›è¡Œæ·±åº¦æ‹·è´ï¼Œé‚£ä¹ˆå¤åˆ¶å¯¹è±¡ä¸­çš„ address æˆå‘˜å˜é‡å°†æŒ‡å‘ä¸€ä¸ªæ–°çš„ Address å¯¹è±¡ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡å¯¹å¦ä¸€ä¸ªå¯¹è±¡é€ æˆçš„å½±å“ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿›è¡Œæ·±åº¦æ‹·è´å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œå› ä¸ºéœ€è¦é€’å½’åœ°å¤åˆ¶å¯¹è±¡ä¸­çš„æ‰€æœ‰æˆå‘˜å˜é‡å’Œå¼•ç”¨ç±»å‹æ‰€æŒ‡å‘çš„å¯¹è±¡ã€‚å› æ­¤ï¼Œåœ¨è¿›è¡Œå¯¹è±¡å¤åˆ¶æ—¶ï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©é€‚å½“çš„å¤åˆ¶æ–¹å¼ï¼Œä»¥æƒè¡¡æ€§èƒ½å’Œæ­£ç¡®æ€§ã€‚\nåœ¨ Java ä¸­ï¼Œé€šè¿‡å®ç° Cloneable æ¥å£å’Œè¦†ç›– clone() æ–¹æ³•ï¼Œå¯ä»¥å®ç°å¯¹è±¡çš„æµ…åº¦æ‹·è´ã€‚å¦‚æœéœ€è¦è¿›è¡Œæ·±åº¦æ‹·è´ï¼Œå¯ä»¥é€šè¿‡åºåˆ—åŒ–å’Œååºåˆ—åŒ–å®ç°ï¼Œæˆ–è€…ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“è¿›è¡Œå¯¹è±¡å¤åˆ¶ã€‚\n2ã€è¯·é—®åœ¨ Java ä¸­å¦‚ä½•å®ç°æ·±åº¦æ‹·è´ï¼Ÿ åœ¨ Java ä¸­ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼å®ç°æ·±åº¦æ‹·è´ï¼š\né€šè¿‡å®ç° Serializable æ¥å£å®ç°æ·±åº¦æ‹·è´ï¼šåœ¨éœ€è¦è¿›è¡Œæ·±åº¦æ‹·è´çš„ç±»ä¸­å®ç° Serializable æ¥å£ï¼Œå¹¶é€šè¿‡åºåˆ—åŒ–å’Œååºåˆ—åŒ–å®ç°æ·±åº¦æ‹·è´ã€‚å…·ä½“æ¥è¯´ï¼Œå¯ä»¥å°†å¯¹è±¡åºåˆ—åŒ–ä¸ºå­—èŠ‚æ•°ç»„ï¼Œç„¶åå†å°†å­—èŠ‚æ•°ç»„ååºåˆ—åŒ–ä¸ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹è±¡ä¸­çš„æ‰€æœ‰æˆå‘˜å˜é‡éƒ½å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œå¦åˆ™å°†ä¼šæŠ›å‡º NotSerializableException å¼‚å¸¸ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªé€šè¿‡å®ç° Serializable æ¥å£å®ç°æ·±åº¦æ‹·è´çš„ç¤ºä¾‹ä»£ç ï¼š\nimport java.io.*; public class Person implements Serializable { private String name; private Address address; // æ„é€ æ–¹æ³•å’Œ getter/setter æ–¹æ³•çœç•¥ public Person deepCopy() throws IOException, ClassNotFoundException { // å°†å¯¹è±¡åºåˆ—åŒ–ä¸ºå­—èŠ‚æ•°ç»„ ByteArrayOutputStream bos = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(bos); oos.writeObject(this); oos.flush(); // å°†å­—èŠ‚æ•°ç»„ååºåˆ—åŒ–ä¸ºä¸€ä¸ªæ–°çš„å¯¹è±¡ ByteArrayInputStream bis = new ByteArrayInputStream(bos.toByteArray()); ObjectInputStream ois = new ObjectInputStream(bis); return (Person) ois.readObject(); } } åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œé€šè¿‡å®ç° Serializable æ¥å£ï¼Œå¹¶åœ¨ deepCopy() æ–¹æ³•ä¸­å°†å¯¹è±¡åºåˆ—åŒ–ä¸ºå­—èŠ‚æ•°ç»„ï¼Œç„¶åå†å°†å­—èŠ‚æ•°ç»„ååºåˆ—åŒ–ä¸ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œä»è€Œå®ç°äº†æ·±åº¦æ‹·è´ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹è±¡ä¸­çš„æ‰€æœ‰æˆå‘˜å˜é‡éƒ½å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œå¦åˆ™å°†ä¼šæŠ›å‡º NotSerializableException å¼‚å¸¸ã€‚\né€šè¿‡å®ç°è‡ªå®šä¹‰æ·±åº¦æ‹·è´æ–¹æ³•å®ç°æ·±åº¦æ‹·è´ï¼šåœ¨éœ€è¦è¿›è¡Œæ·±åº¦æ‹·è´çš„ç±»ä¸­å®ç°è‡ªå®šä¹‰çš„æ·±åº¦æ‹·è´æ–¹æ³•ï¼Œé€’å½’åœ°å¤åˆ¶å¯¹è±¡ä¸­çš„æ‰€æœ‰æˆå‘˜å˜é‡å’Œå¼•ç”¨ç±»å‹æ‰€æŒ‡å‘çš„å¯¹è±¡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå¯¹è±¡ä¸­çš„æˆå‘˜å˜é‡åŒ…å«å¾ªç¯å¼•ç”¨ï¼Œé‚£ä¹ˆéœ€è¦å¯¹å¾ªç¯å¼•ç”¨è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œä»¥é¿å…æ— é™é€’å½’ã€‚\nä½¿ç”¨ç¬¬ä¸‰æ–¹åº“å®ç°æ·±åº¦æ‹·è´ï¼šJava ä¸­æœ‰è®¸å¤šç¬¬ä¸‰æ–¹åº“å¯ä»¥ç”¨äºå®ç°æ·±åº¦æ‹·è´ï¼Œä¾‹å¦‚ Apache Commons çš„ SerializationUtilsã€Google çš„ Gsonã€Jackson ç­‰ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ Jackson åº“å®ç°æ·±åº¦æ‹·è´çš„ç¤ºä¾‹ä»£ç ï¼š\nimport com.fasterxml.jackson.databind.ObjectMapper; public class Person { private String name; private Address address; // æ„é€ æ–¹æ³•å’Œ getter/setter æ–¹æ³•çœç•¥ public Person deepCopy() throws IOException { ObjectMapper objectMapper = new ObjectMapper(); String json = objectMapper.writeValueAsString(this); return objectMapper.readValue(json, Person.class); } } åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œé€šè¿‡ä½¿ç”¨ Jackson åº“å°†å¯¹è±¡è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²ï¼Œç„¶åå†å°† JSON å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ–°çš„å¯¹è±¡ï¼Œä»è€Œå®ç°äº†æ·±åº¦æ‹·è´ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå¯¹è±¡ä¸­çš„æˆå‘˜å˜é‡åŒ…å«å¾ªç¯å¼•ç”¨ï¼Œé‚£ä¹ˆéœ€è¦å¯¹å¾ªç¯å¼•ç”¨è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œä»¥é¿å…æ— é™é€’å½’ã€‚\nä½¿ç”¨æµå¼ APIï¼šJava 8 å¼•å…¥äº†æµå¼ APIï¼Œå¯ä»¥ä½¿ç”¨æµå¼ API æ¥å®ç°å¯¹è±¡çš„æ·±åº¦æ‹·è´ã€‚å…·ä½“æ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨ map() æ–¹æ³•å°†å¯¹è±¡æµä¸­çš„æ¯ä¸ªå…ƒç´ å¤åˆ¶ä¸ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œç„¶åä½¿ç”¨ collect() æ–¹æ³•å°†æ–°å¯¹è±¡æ”¶é›†åˆ°ä¸€ä¸ªé›†åˆä¸­ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå¯¹è±¡ä¸­çš„æˆå‘˜å˜é‡åŒ…å«å¾ªç¯å¼•ç”¨ï¼Œé‚£ä¹ˆéœ€è¦å¯¹å¾ªç¯å¼•ç”¨è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œä»¥é¿å…æ— é™é€’å½’ã€‚\nå½“ä½¿ç”¨æµå¼ API å®ç°æ·±åº¦æ‹·è´æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ map() æ–¹æ³•å°†å¯¹è±¡æµä¸­çš„æ¯ä¸ªå…ƒç´ å¤åˆ¶ä¸ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œç„¶åä½¿ç”¨ collect() æ–¹æ³•å°†æ–°å¯¹è±¡æ”¶é›†åˆ°ä¸€ä¸ªé›†åˆä¸­ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå¯¹è±¡ä¸­çš„æˆå‘˜å˜é‡åŒ…å«å¾ªç¯å¼•ç”¨ï¼Œé‚£ä¹ˆéœ€è¦å¯¹å¾ªç¯å¼•ç”¨è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œä»¥é¿å…æ— é™é€’å½’ã€‚\nä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨æµå¼ API å®ç°æ·±åº¦æ‹·è´çš„ç¤ºä¾‹ä»£ç ï¼š\nimport java.util.List; import java.util.stream.Collectors; public class Person { private String name; private Address address; // æ„é€ æ–¹æ³•å’Œ getter/setter æ–¹æ³•çœç•¥ public Person deepCopy() { List\u0026lt;Address\u0026gt; addresses = this.addresses.stream() .map(Address::deepCopy) // ä½¿ç”¨ map() æ–¹æ³•å°†æ¯ä¸ª Address å¯¹è±¡å¤åˆ¶ä¸ºä¸€ä¸ªæ–°çš„å¯¹è±¡ .collect(Collectors.toList()); // ä½¿ç”¨ collect() æ–¹æ³•å°†æ–°å¯¹è±¡æ”¶é›†åˆ°ä¸€ä¸ªé›†åˆä¸­ return new Person(this.name, addresses); } } public class Address { private String street; private String city; // æ„é€ æ–¹æ³•å’Œ getter/setter æ–¹æ³•çœç•¥ public Address deepCopy() { return new Address(this.street, this.city); // ç›´æ¥å¤åˆ¶ Address å¯¹è±¡å³å¯ï¼Œå› ä¸º Address ç±»ä¸­æ²¡æœ‰å¼•ç”¨ç±»å‹çš„æˆå‘˜å˜é‡ } } åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œé€šè¿‡ä½¿ç”¨æµå¼ API å°† addresses é›†åˆä¸­çš„æ¯ä¸ª Address å¯¹è±¡å¤åˆ¶ä¸ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¹¶å°†æ–°å¯¹è±¡æ”¶é›†åˆ°ä¸€ä¸ªé›†åˆä¸­ï¼Œä»è€Œå®ç°äº† Person å¯¹è±¡çš„æ·±åº¦æ‹·è´ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å®ç° Address çš„ deepCopy() æ–¹æ³•æ—¶ï¼Œå› ä¸º Address ç±»ä¸­æ²¡æœ‰å¼•ç”¨ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œå› æ­¤å¯ä»¥ç›´æ¥å¤åˆ¶ä¸€ä¸ªæ–°çš„ Address å¯¹è±¡å³å¯ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå¯¹è±¡ä¸­çš„æˆå‘˜å˜é‡åŒ…å«å¾ªç¯å¼•ç”¨ï¼Œé‚£ä¹ˆéœ€è¦è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œä»¥é¿å…æ— é™é€’å½’ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œå¦‚æœ Person ç±»ä¸­åŒ…å«ä¸€ä¸ª List\u0026lt;Person\u0026gt; ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œé‚£ä¹ˆåœ¨è¿›è¡Œæ·±åº¦æ‹·è´æ—¶å°±éœ€è¦å¯¹ List\u0026lt;Person\u0026gt; è¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/05/26/override-clone-judiciously/","summary":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬ä¸‰ç« ã€Šå¯¹è±¡çš„é€šç”¨æ–¹æ³•ã€‹çš„å­¦ä¹ ç¬”è®°ï¼šæ˜æ™ºåœ°è¦†ç›– clone æ–¹æ³•ã€‚\nä»‹ç» Cloneable æ¥å£çš„ç›®çš„æ˜¯ä½œä¸º mixin æ¥å£ï¼Œç”¨äºè®©ç±»æ¥å®£ç§°å®ƒä»¬å…è®¸å…‹éš†ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå®ƒæ²¡æœ‰è¾¾åˆ°è¿™ä¸ªç›®çš„ã€‚å®ƒçš„ä¸»è¦ç¼ºç‚¹æ˜¯ç¼ºå°‘ clone æ–¹æ³•ï¼Œå¹¶ä¸” Object ç±»çš„ clone æ–¹æ³•æ˜¯å—ä¿æŠ¤çš„ã€‚å¦‚æœä¸æ±‚åŠ©äºåå°„ï¼Œå°±ä¸èƒ½ä»…ä»…å› ä¸ºå¯¹è±¡å®ç°äº† Cloneable æ¥å£å°±èƒ½è°ƒç”¨ clone æ–¹æ³•ã€‚å³ä½¿åå°„è°ƒç”¨ä¹Ÿå¯èƒ½å¤±è´¥ï¼Œå› ä¸ºä¸èƒ½ä¿è¯å¯¹è±¡å…·æœ‰å¯è®¿é—®çš„ clone æ–¹æ³•ã€‚å°½ç®¡å­˜åœ¨å¤šç§ç¼ºé™·ï¼Œä½†è¯¥æœºåˆ¶çš„ä½¿ç”¨èŒƒå›´ç›¸å½“å¹¿æ³›ï¼Œå› æ­¤ç†è§£å®ƒæ˜¯å€¼å¾—çš„ã€‚æœ¬æ¡ç›®å°†å‘Šè¯‰ä½ å¦‚ä½•å®ç°è¡Œä¸ºè‰¯å¥½çš„ clone æ–¹æ³•ï¼Œè®¨è®ºä»€ä¹ˆæ—¶å€™åº”è¯¥è¿™æ ·åšï¼Œå¹¶æä¾›æ›¿ä»£æ–¹æ¡ˆã€‚\næ—¢ç„¶ Cloneable æ¥å£ä¸åŒ…å«ä»»ä½•æ–¹æ³•ï¼Œç”¨å®ƒæ¥åšä»€ä¹ˆå‘¢ï¼Ÿå®ƒå†³å®šäº† Object ç±»å—ä¿æŠ¤çš„ clone å®ç°çš„è¡Œä¸ºï¼šå¦‚æœä¸€ä¸ªç±»å®ç°äº† Cloneable æ¥å£ï¼ŒObject ç±»çš„ clone æ–¹æ³•åˆ™è¿”å›è¯¥ç±»å®ä¾‹çš„é€å­—æ®µæ‹·è´ï¼›å¦åˆ™å®ƒä¼šæŠ›å‡º CloneNotSupportedExceptionã€‚è¿™æ˜¯æ¥å£éå¸¸ä¸å…¸å‹çš„ä¸€ç§ä½¿ç”¨æ–¹å¼ï¼Œä¸åº”è¯¥æ•ˆä»¿ã€‚é€šå¸¸ï¼Œç±»å®ç°æ¥å£å¯ä»¥è¡¨æ˜ç±»èƒ½å¤Ÿä¸ºå…¶å®¢æˆ·ç«¯åšäº›ä»€ä¹ˆã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå®ƒä¿®æ”¹äº†è¶…ç±»ä¸Šå—ä¿æŠ¤çš„æ–¹æ³•çš„è¡Œä¸ºã€‚\nè™½ç„¶è§„èŒƒæ²¡æœ‰è¯´æ˜ï¼Œä½†æ˜¯åœ¨å®è·µä¸­ï¼Œå®ç° Cloneable æ¥å£çš„ç±»åº”è¯¥æä¾›ä¸€ä¸ªåŠŸèƒ½æ­£å¸¸çš„å…¬å…± clone æ–¹æ³•ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œç±»åŠå…¶æ‰€æœ‰è¶…ç±»å¿…é¡»éµå®ˆå¤æ‚çš„ã€ä¸å¯å¼ºåˆ¶æ‰§è¡Œçš„ã€æ–‡æ¡£å¾ˆå°‘çš„åè®®ã€‚äº§ç”Ÿçš„æœºåˆ¶æ˜¯è„†å¼±çš„ã€å±é™©çš„å’Œéè¯­è¨€çš„ï¼šå³å®ƒåˆ›å»ºå¯¹è±¡è€Œä¸è°ƒç”¨æ„é€ å‡½æ•°ã€‚\nclone æ–¹æ³•çš„ä¸€èˆ¬çº¦å®šå¾ˆè–„å¼±ã€‚ä¸‹é¢çš„å†…å®¹æ˜¯ä» Object è§„èŒƒå¤åˆ¶è¿‡æ¥çš„ï¼š\nåˆ›å»ºå¹¶è¿”å›æ­¤å¯¹è±¡çš„å‰¯æœ¬ã€‚\u0026ldquo;å‰¯æœ¬\u0026rdquo; çš„ç¡®åˆ‡å«ä¹‰å¯èƒ½å–å†³äºå¯¹è±¡çš„ç±»ã€‚é€šå¸¸çš„æ„å›¾æ˜¯ï¼Œå¯¹äºä»»ä½•å¯¹è±¡ xï¼Œè¡¨è¾¾å¼\nx.clone() != x å°†ä¸º trueï¼Œå¹¶ä¸”è¡¨è¾¾å¼\nx.clone().getClass() == x.getClass() å°†ä¸º trueï¼Œä½†è¿™å¹¶ä¸æ˜¯ç»å¯¹è¦æ±‚ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¯¹äºä»»ä½•å¯¹è±¡ x å’Œ yï¼Œå¦‚æœå®ƒä»¬çš„ equals æ–¹æ³•è¿”å› trueï¼Œåˆ™è¡¨è¾¾å¼\nx.clone().equals(x) ä¹Ÿåº”è¿”å› trueã€‚\nclone æ–¹æ³•åˆ›å»ºå¹¶è¿”å›å¯¹è±¡çš„å‰¯æœ¬ã€‚ã€Œå‰¯æœ¬ã€çš„ç¡®åˆ‡å«ä¹‰å¯èƒ½å–å†³äºå¯¹è±¡çš„ç±»åˆ«ã€‚é€šå¸¸ï¼Œå¯¹äºä»»ä½•å¯¹è±¡ xï¼Œè¡¨è¾¾å¼ x.clone() != xã€x.clone().getClass() == x.getClass() ä»¥åŠ x.clone().equals(x) çš„å€¼éƒ½å°†ä¸º trueï¼Œä½†éƒ½ä¸æ˜¯ç»å¯¹çš„ã€‚\næŒ‰ç…§æƒ¯ä¾‹ï¼Œæ­¤æ–¹æ³•è¿”å›çš„å¯¹è±¡åº”é€šè¿‡è°ƒç”¨ super.clone() æ¥è·å–ã€‚å¦‚æœä¸€ä¸ªç±»åŠå…¶æ‰€æœ‰çˆ¶ç±»ï¼ˆé™¤äº† Objectï¼‰éƒ½éµå¾ªè¿™ä¸ªæƒ¯ä¾‹ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰ä»¥ä¸‹æƒ…å†µï¼š\nx.clone().getClass() == x.getClass(). æŒ‰ç…§çº¦å®šï¼Œclone æ–¹æ³•è¿”å›çš„å¯¹è±¡åº”è¯¥é€šè¿‡è°ƒç”¨ super.clone() æ¥è·å¾—ã€‚å¦‚æœä¸€ä¸ªç±»å’Œå®ƒçš„æ‰€æœ‰è¶…ç±»ï¼ˆObject ç±»é™¤å¤–ï¼‰éƒ½éµå®ˆè¿™ä¸ªçº¦å®šï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¡¨è¾¾å¼ x.clone().getClass() == x.getClass() åˆ™ä¸º trueã€‚\næŒ‰ç…§çº¦å®šï¼Œè¿”å›çš„å¯¹è±¡åº”è¯¥ç‹¬ç«‹äºè¢«å…‹éš†çš„å¯¹è±¡ã€‚ä¸ºäº†å®ç°è¿™ç§ç‹¬ç«‹æ€§ï¼Œå¯èƒ½éœ€è¦åœ¨ super.clone() è¿”å›å‰ï¼Œä¿®æ”¹å¯¹è±¡çš„ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µã€‚","title":"ã€ŠEffective Java 3ã€‹ç¬”è®°13ï¼šæ˜æ™ºåœ°è¦†ç›– clone æ–¹æ³•"},{"content":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬ä¸‰ç« ã€Šå¯¹è±¡çš„é€šç”¨æ–¹æ³•ã€‹çš„å­¦ä¹ ç¬”è®°ï¼šå§‹ç»ˆè¦†ç›– toString æ–¹æ³•ã€‚\nä»‹ç» è™½ç„¶ Object æä¾› toString æ–¹æ³•çš„å®ç°ï¼Œä½†å®ƒè¿”å›çš„å­—ç¬¦ä¸²é€šå¸¸ä¸æ˜¯ç±»çš„ç”¨æˆ·å¸Œæœ›çœ‹åˆ°çš„ã€‚å®ƒç”±åè·Ÿã€Œatã€ç¬¦å·ï¼ˆ@ï¼‰çš„ç±»åå’Œ hash ä»£ç çš„æ— ç¬¦å·åå…­è¿›åˆ¶è¡¨ç¤ºï¼ˆä¾‹å¦‚ PhoneNumber@163b91ï¼‰ç»„æˆã€‚toString çš„é€šç”¨çº¦å®šæ˜¯è¿™ä¹ˆæè¿°çš„ï¼Œè¿”å›çš„å­—ç¬¦ä¸²åº”è¯¥æ˜¯ã€Œç®€æ´ä½†ä¿¡æ¯ä¸°å¯Œçš„è¡¨ç¤ºï¼Œæ˜“äºé˜…è¯»ã€ã€‚è™½ç„¶æœ‰äººè®¤ä¸º PhoneNumber@163b91 ç®€æ´æ˜“æ‡‚ï¼Œä½†ä¸ 707-867-5309 ç›¸æ¯”ï¼Œå®ƒçš„ä¿¡æ¯é‡å¹¶ä¸å¤§ã€‚toString çº¦å®šæ¥ç€æè¿°ï¼Œã€Œå»ºè®®æ‰€æœ‰å­ç±»è¦†ç›–æ­¤æ–¹æ³•ã€‚ã€å¥½å»ºè®®ï¼Œç¡®å®ï¼\nè™½ç„¶å®ƒä¸å¦‚éµå®ˆ equals å’Œ hashCode çº¦å®šé‚£ä¹ˆé‡è¦ï¼Œä½†æ˜¯ æä¾›ä¸€ä¸ªå¥½çš„ toString å®ç°ï¼ˆèƒ½ï¼‰ä½¿ç±»æ›´æ˜“äºä½¿ç”¨ï¼Œä½¿ç”¨è¯¥ç±»çš„ç³»ç»Ÿï¼ˆä¹Ÿï¼‰æ›´æ˜“äºè°ƒè¯•ã€‚ å½“å¯¹è±¡è¢«ä¼ é€’ç»™ printlnã€printfã€å­—ç¬¦ä¸²è¿æ¥æ“ä½œç¬¦æˆ–æ–­è¨€æˆ–ç”±è°ƒè¯•å™¨æ‰“å°æ—¶ï¼Œå°†è‡ªåŠ¨è°ƒç”¨ toString æ–¹æ³•ã€‚å³ä½¿ä½ ä»æ¥æ²¡æœ‰è°ƒç”¨ toString å¯¹è±¡ï¼Œå…¶ä»–äººä¹Ÿå¯èƒ½ï¼ˆä½¿ç”¨ï¼‰ã€‚ä¾‹å¦‚ï¼Œæœ‰å¯¹è±¡å¼•ç”¨çš„ç»„ä»¶å¯ä»¥åœ¨æ—¥å¿—é”™è¯¯æ¶ˆæ¯ä¸­åŒ…å«å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚å¦‚æœä½ æœªèƒ½è¦†ç›– toStringï¼Œåˆ™è¯¥æ¶ˆæ¯å¯èƒ½å®Œå…¨æ— ç”¨ã€‚\nå¦‚æœä½ å·²ç»ä¸º PhoneNumber æä¾›äº†ä¸€ä¸ªå¥½çš„ toString æ–¹æ³•ï¼Œé‚£ä¹ˆç”Ÿæˆä¸€ä¸ªæœ‰ç”¨çš„è¯Šæ–­æ¶ˆæ¯å°±åƒè¿™æ ·ç®€å•ï¼š\nSystem.out.println(\u0026#34;Failed to connect to \u0026#34; + phoneNumber); æ— è®ºä½ æ˜¯å¦è¦†ç›– toStringï¼Œç¨‹åºå‘˜éƒ½ä¼šä»¥è¿™ç§æ–¹å¼ç”Ÿæˆè¯Šæ–­æ¶ˆæ¯ï¼Œä½†æ˜¯é™¤éä½ ï¼ˆè¦†ç›– toStringï¼‰ï¼Œå¦åˆ™è¿™äº›æ¶ˆæ¯ä¸ä¼šæœ‰ç”¨ã€‚æä¾›å¥½çš„ toString æ–¹æ³•çš„å¥½å¤„ä¸ä»…ä»…æ˜¯å°†ç±»çš„å®ä¾‹æ‰©å±•åˆ°åŒ…å«å¯¹è¿™äº›å®ä¾‹çš„å¼•ç”¨çš„å¯¹è±¡ï¼Œç‰¹åˆ«æ˜¯é›†åˆã€‚åœ¨æ‰“å° map æ—¶ï¼Œä½ æ›´æ„¿æ„çœ‹åˆ°å“ªä¸ªï¼Œ{Jenny=PhoneNumber@163b91} è¿˜æ˜¯ {Jenny=707-867-5309}ï¼Ÿ\nå½“å®é™…ä½¿ç”¨æ—¶ï¼ŒtoString æ–¹æ³•åº”è¯¥è¿”å›å¯¹è±¡ä¸­åŒ…å«çš„æ‰€æœ‰æœ‰è¶£ä¿¡æ¯ï¼Œ å¦‚ç”µè¯å·ç ç¤ºä¾‹æ‰€ç¤ºã€‚å¦‚æœå¯¹è±¡å¾ˆå¤§ï¼Œæˆ–è€…åŒ…å«ä¸åˆ©äºå­—ç¬¦ä¸²è¡¨ç¤ºçš„çŠ¶æ€ï¼Œé‚£ä¹ˆè¿™ç§æ–¹æ³•æ˜¯ä¸åˆ‡å®é™…çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒtoString åº”è¯¥è¿”å›ä¸€ä¸ªæ‘˜è¦ï¼Œä¾‹å¦‚æ›¼å“ˆé¡¿ä½å®…ç”µè¯ç›®å½•ï¼ˆ1487536 å·æ¸…å•ï¼‰æˆ– Thread[main,5,main]ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œå­—ç¬¦ä¸²åº”è¯¥æ˜¯ä¸è¨€è‡ªæ˜çš„ã€‚ï¼ˆçº¿ç¨‹ç¤ºä¾‹æœªèƒ½é€šè¿‡æ­¤æµ‹è¯•ã€‚ï¼‰å¦‚æœæ²¡æœ‰åœ¨å­—ç¬¦ä¸²è¡¨ç¤ºä¸­åŒ…å«æ‰€æœ‰å¯¹è±¡çš„æœ‰è¶£ä¿¡æ¯ï¼Œé‚£ä¹ˆä¸€ä¸ªç‰¹åˆ«æ¼äººçš„æƒ©ç½šå°±æ˜¯æµ‹è¯•å¤±è´¥æŠ¥å‘Šï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nAssertion failure: expected {abc, 123}, but was {abc, 123}. åœ¨å®ç° toString æ–¹æ³•æ—¶ï¼Œä½ å¿…é¡»åšçš„ä¸€ä¸ªé‡è¦å†³å®šæ˜¯æ˜¯å¦åœ¨æ–‡æ¡£ä¸­æŒ‡å®šè¿”å›å€¼çš„æ ¼å¼ã€‚å»ºè®®ä½ é’ˆå¯¹å€¼ç±»ï¼ˆå¦‚ç”µè¯å·ç æˆ–çŸ©é˜µï¼‰è¿™æ ·åšã€‚æŒ‡å®šæ ¼å¼çš„ä¼˜ç‚¹æ˜¯ï¼Œå®ƒå¯ä»¥ä½œä¸ºå¯¹è±¡çš„æ ‡å‡†çš„ã€æ˜ç¡®çš„ã€äººç±»å¯è¯»çš„è¡¨ç¤ºã€‚è¿™ç§è¡¨ç¤ºå¯ä»¥ç”¨äºè¾“å…¥å’Œè¾“å‡ºï¼Œä¹Ÿå¯ä»¥ç”¨äºæŒä¹…çš„äººç±»å¯è¯»æ•°æ®å¯¹è±¡ï¼Œæ¯”å¦‚ CSV æ–‡ä»¶ã€‚å¦‚æœæŒ‡å®šäº†æ ¼å¼ï¼Œæä¾›ä¸€ä¸ªåŒ¹é…çš„é™æ€å·¥å‚æˆ–æ„é€ å‡½æ•°é€šå¸¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œè¿™æ ·ç¨‹åºå‘˜å°±å¯ä»¥è½»æ¾åœ°åœ¨å¯¹è±¡åŠå…¶å­—ç¬¦ä¸²è¡¨ç¤ºä¹‹é—´æ¥å›è½¬æ¢ã€‚Java åº“ä¸­çš„è®¸å¤šå€¼ç±»éƒ½é‡‡ç”¨è¿™ç§æ–¹æ³•ï¼ŒåŒ…æ‹¬ BigIntegerã€BigDecimal å’Œå¤§å¤šæ•°åŒ…è£…ç±»ã€‚\næŒ‡å®š toString è¿”å›å€¼çš„æ ¼å¼çš„ç¼ºç‚¹æ˜¯ï¼Œä¸€æ—¦æŒ‡å®šäº†å®ƒï¼Œå°±ä¼šç»ˆç”Ÿä½¿ç”¨å®ƒï¼Œå‡è®¾ä½ çš„ç±»è¢«å¹¿æ³›ä½¿ç”¨ã€‚ç¨‹åºå‘˜å°†ç¼–å†™ä»£ç æ¥è§£æè¡¨ç¤ºã€ç”Ÿæˆè¡¨ç¤ºå¹¶å°†å…¶åµŒå…¥æŒä¹…æ•°æ®ä¸­ã€‚å¦‚æœä½ åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­æ›´æ”¹äº†è¡¨ç¤ºå½¢å¼ï¼Œä½ å°†ç ´åå®ƒä»¬çš„ä»£ç å’Œæ•°æ®ï¼Œå®ƒä»¬å°†å‘å‡ºå¤§é‡çš„æ¶ˆæ¯ã€‚é€šè¿‡é€‰æ‹©ä¸æŒ‡å®šæ ¼å¼ï¼Œä½ å¯ä»¥ä¿ç•™åœ¨åç»­ç‰ˆæœ¬ä¸­æ·»åŠ ä¿¡æ¯æˆ–æ”¹è¿›æ ¼å¼çš„çµæ´»æ€§ã€‚\næ— è®ºä½ æ˜¯å¦å†³å®šæŒ‡å®šæ ¼å¼ï¼Œä½ éƒ½åº”è¯¥æ¸…æ¥šåœ°è®°å½•ä½ çš„æ„å›¾ã€‚ å¦‚æœæŒ‡å®šäº†æ ¼å¼ï¼Œåˆ™åº”è¯¥ç²¾ç¡®åœ°æŒ‡å®šæ ¼å¼ã€‚ä¾‹å¦‚ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ª toString æ–¹æ³•ç”¨äº PhoneNumber ç±»ï¼š\n/** * Returns the string representation of this phone number. * The string consists of twelve characters whose format is * \u0026#34;XXX-YYY-ZZZZ\u0026#34;, where XXX is the area code, YYY is the * prefix, and ZZZZ is the line number. Each of the capital * letters represents a single decimal digit. ** If any of the three parts of this phone number is too small * to fill up its field, the field is padded with leading zeros. * For example, if the value of the line number is 123, the last * four characters of the string representation will be \u0026#34;0123\u0026#34;. */ @Override public String toString() { return String.format(\u0026#34;%03d-%03d-%04d\u0026#34;, areaCode, prefix, lineNum); } å¦‚æœä½ å†³å®šä¸æŒ‡å®šä¸€ç§æ ¼å¼ï¼Œæ–‡æ¡£æ³¨é‡Šåº”è¯¥å¦‚ä¸‹æ‰€ç¤ºï¼š\n/** * Returns a brief description of this potion. The exact details * of the representation are unspecified and subject to change, * but the following may be regarded as typical: ** \u0026#34;[Potion #9: type=love, smell=turpentine, look=india ink]\u0026#34; */ @Override public String toString() { ... } åœ¨é˜…è¯»äº†è¿™ç¯‡æ–‡æ¡£æ³¨é‡Šä¹‹åï¼Œå½“æ ¼å¼è¢«æ›´æ”¹æ—¶ï¼Œç”Ÿæˆä¾èµ–äºæ ¼å¼ç»†èŠ‚çš„ä»£ç æˆ–æŒä¹…æ•°æ®çš„ç¨‹åºå‘˜å°†åªèƒ½æ€ªä»–ä»¬è‡ªå·±ã€‚\næ— è®ºä½ æ˜¯å¦æŒ‡å®šäº†æ ¼å¼ï¼Œéƒ½è¦ æä¾›å¯¹ toString è¿”å›å€¼ä¸­åŒ…å«çš„ä¿¡æ¯çš„ç¨‹åºæ€§è®¿é—®ã€‚ ä¾‹å¦‚ï¼ŒPhoneNumber ç±»åº”è¯¥åŒ…å«åŒºåŸŸä»£ç ã€å‰ç¼€å’Œè¡Œå·çš„è®¿é—®å™¨ã€‚å¦‚æœåšä¸åˆ°è¿™ä¸€ç‚¹ï¼Œå°±ä¼šè¿«ä½¿éœ€è¦è¿™äº›ä¿¡æ¯çš„ç¨‹åºå‘˜è§£æå­—ç¬¦ä¸²ã€‚é™¤äº†é™ä½æ€§èƒ½å’Œä½¿ç¨‹åºå‘˜ä¸å¿…è¦çš„å·¥ä½œä¹‹å¤–ï¼Œè¿™ä¸ªè¿‡ç¨‹å¾ˆå®¹æ˜“å‡ºé”™ï¼Œå¹¶ä¸”ä¼šå¯¼è‡´è„†å¼±çš„ç³»ç»Ÿåœ¨ä½ æ›´æ”¹æ ¼å¼æ—¶å´©æºƒã€‚ç”±äºæ²¡æœ‰æä¾›è®¿é—®å™¨ï¼Œä½ å¯ä»¥å°†å­—ç¬¦ä¸²æ ¼å¼è½¬æ¢ä¸ºäº‹å®ä¸Šçš„ APIï¼Œå³ä½¿ä½ å·²ç»æŒ‡å®šäº†å®ƒå¯èƒ½ä¼šå‘ç”Ÿæ›´æ”¹ã€‚\nåœ¨é™æ€å®ç”¨ç¨‹åºç±»ä¸­ç¼–å†™ toString æ–¹æ³•æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œåœ¨å¤§å¤šæ•° enum ç±»å‹ä¸­ä¹Ÿä¸åº”è¯¥ç¼–å†™ toString æ–¹æ³•ï¼Œå› ä¸º Java ä¸ºä½ æä¾›äº†ä¸€ä¸ªéå¸¸å¥½çš„æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œä½ åº”è¯¥åœ¨ä»»ä½•æŠ½è±¡ç±»ä¸­ç¼–å†™ toString æ–¹æ³•ï¼Œè¯¥ç±»çš„å­ç±»å…±äº«å…¬å…±çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ã€‚ä¾‹å¦‚ï¼Œå¤§å¤šæ•°é›†åˆå®ç°ä¸Šçš„ toString æ–¹æ³•éƒ½ç»§æ‰¿è‡ªæŠ½è±¡é›†åˆç±»ã€‚\nè°·æ­Œçš„å¼€æ”¾æºç è‡ªåŠ¨å€¼å·¥å…·å°†ä¸ºä½ ç”Ÿæˆ toString æ–¹æ³•ï¼Œå¤§å¤šæ•° IDE ä¹Ÿæ˜¯å¦‚æ­¤ã€‚è¿™äº›æ–¹æ³•å¯ä»¥å¾ˆå¥½åœ°å‘Šè¯‰ä½ æ¯ä¸ªå­—æ®µçš„å†…å®¹ï¼Œä½†å¹¶ä¸ä¸“é—¨é’ˆå¯¹ç±»çš„å«ä¹‰ã€‚å› æ­¤ï¼Œä¾‹å¦‚ï¼Œå¯¹äº PhoneNumber ç±»ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„ toString æ–¹æ³•æ˜¯ä¸åˆé€‚çš„ï¼ˆå› ä¸ºç”µè¯å·ç å…·æœ‰æ ‡å‡†çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ï¼‰ï¼Œä½†æ˜¯å¯¹äº Potion ç±»æ¥è¯´å®ƒæ˜¯å®Œå…¨å¯ä»¥æ¥å—çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªè‡ªåŠ¨ç”Ÿæˆçš„ toString æ–¹æ³•è¦æ¯”ä»å¯¹è±¡ç»§æ‰¿çš„æ–¹æ³•å¥½å¾—å¤šï¼Œå¯¹è±¡ç»§æ‰¿çš„æ–¹æ³•ä¸ä¼šå‘Šè¯‰ä½ å¯¹è±¡çš„å€¼ã€‚\nå›é¡¾ä¸€ä¸‹ï¼Œåœ¨ä½ ç¼–å†™çš„æ¯ä¸ªå®ä¾‹åŒ–ç±»ä¸­è¦†ç›–å¯¹è±¡çš„ toString å®ç°ï¼Œé™¤éè¶…ç±»å·²ç»è¿™æ ·åšäº†ã€‚å®ƒä½¿ç±»æ›´æ˜“äºä½¿ç”¨ï¼Œå¹¶æœ‰åŠ©äºè°ƒè¯•ã€‚toString æ–¹æ³•åº”è¯¥ä»¥ç¾è§‚çš„æ ¼å¼è¿”å›å¯¹è±¡çš„ç®€æ˜ã€æœ‰ç”¨çš„æè¿°ã€‚\næ€»ç»“ å»ºè®®å§‹ç»ˆè¦†ç›– toString() æ–¹æ³•ã€‚è¿™æ˜¯å› ä¸º toString() æ–¹æ³•æ˜¯ Java ä¸­æœ€å¸¸ç”¨çš„æ–¹æ³•ä¹‹ä¸€ï¼Œå®ƒå¯ä»¥å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ–¹ä¾¿è¾“å‡ºå’Œæ—¥å¿—è®°å½•ç­‰æ“ä½œã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä¸€ä¸ªç±»æ²¡æœ‰è¦†ç›– toString() æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒå°†ç»§æ‰¿è‡ª Object ç±»çš„å®ç°ï¼Œè¯¥å®ç°è¿”å›ä¸€ä¸ªåŒ…å«å¯¹è±¡ç±»åå’Œæ•£åˆ—ç çš„å­—ç¬¦ä¸²ã€‚è¿™ä¸ªé»˜è®¤çš„å®ç°å¯èƒ½å¯¹äºè°ƒè¯•å’Œå¼€å‘è¿‡ç¨‹ä¸­çš„ä¸€äº›æ“ä½œæ˜¯æœ‰ç”¨çš„ï¼Œä½†é€šå¸¸ä¸ä¼šæä¾›æœ‰å…³å¯¹è±¡çš„æœ‰ç”¨ä¿¡æ¯ã€‚\nå› æ­¤ï¼Œå»ºè®®åœ¨æ¯ä¸ªç±»ä¸­éƒ½è¦†ç›– toString() æ–¹æ³•ï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶æä¾›æœ‰ç”¨çš„ä¿¡æ¯ã€‚åœ¨å®ç° toString() æ–¹æ³•æ—¶ï¼Œå¯ä»¥è¿”å›ä¸€ä¸ªåŒ…å«æœ‰å…³å¯¹è±¡çŠ¶æ€çš„å­—ç¬¦ä¸²ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨è°ƒè¯•å’Œå…¶ä»–æ“ä½œä¸­ä½¿ç”¨è¯¥å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªç±»è¡¨ç¤ºä¸€ä¸ªäººï¼Œé‚£ä¹ˆå®ƒçš„ toString() æ–¹æ³•å¯ä»¥è¿”å›è¯¥äººçš„å§“åå’Œå¹´é¾„ï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶æ›´å¥½åœ°ç†è§£è¯¥å¯¹è±¡ã€‚\nå¦å¤–ï¼Œåœ¨é‡å†™ toString() æ–¹æ³•æ—¶ï¼Œä¹Ÿåº”è¯¥éµå¾ªä¸€äº›çº¦å®šï¼Œä»¥ç¡®ä¿è¯¥æ–¹æ³•çš„å®ç°æ­£ç¡®ã€é«˜æ•ˆå’Œæ˜“äºä½¿ç”¨ã€‚å…¶ä¸­ä¸€äº›çº¦å®šåŒ…æ‹¬ï¼š\nè¿”å›çš„å­—ç¬¦ä¸²åº”è¯¥ä»¥å¯¹è±¡çš„ç±»åä½œä¸ºå¼€å¤´ï¼Œåé¢è·Ÿç€å¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼šPerson{name='John', age=30}ã€‚ è¿”å›çš„å­—ç¬¦ä¸²åº”è¯¥æ˜¯å¯è¯»çš„ï¼Œå¹¶ä¸”åº”è¯¥åŒ…å«æœ‰å…³å¯¹è±¡çŠ¶æ€çš„æ‰€æœ‰ä¿¡æ¯ï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶æ›´å¥½åœ°ç†è§£è¯¥å¯¹è±¡ã€‚ è¿”å›çš„å­—ç¬¦ä¸²åº”è¯¥æ˜¯ä¸å¯å˜çš„ï¼Œå³ä¸èƒ½åœ¨è¿”å›å­—ç¬¦ä¸²åæ›´æ”¹å¯¹è±¡çŠ¶æ€ä»¥æ›´æ”¹è¿”å›å€¼ã€‚ è¿”å›çš„å­—ç¬¦ä¸²åº”è¯¥æ˜¯ç¬¦åˆè¯­è¨€ä¹ æƒ¯çš„ï¼Œå¹¶ä¸”åº”è¯¥é€‚åˆäºå›½é™…åŒ–å’Œæœ¬åœ°åŒ–ã€‚ æ€»ä¹‹ï¼Œè¦†ç›– toString() æ–¹æ³•å¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œå› ä¸ºå®ƒæä¾›äº†æœ‰å…³å¯¹è±¡çŠ¶æ€çš„æœ‰ç”¨ä¿¡æ¯ï¼ŒåŒæ—¶ä¹Ÿç¬¦åˆ Java è¯­è¨€çš„ä¹ æƒ¯å’Œè§„èŒƒã€‚\nJava ä¸­æœ‰å¾ˆå¤šå¯ä»¥è‡ªåŠ¨ç”Ÿæˆ toString() æ–¹æ³•çš„å¼€æºæ¡†æ¶ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„æ¡†æ¶ï¼š\nApache Commons Lang - ToStringBuilder: Apache Commons Lang æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„å¼€æº Java å·¥å…·åº“ï¼Œå…¶ä¸­çš„ ToStringBuilder ç±»å¯ä»¥å¸®åŠ©å¼€å‘è€…è‡ªåŠ¨ç”Ÿæˆ toString() æ–¹æ³•ã€‚ä½¿ç”¨è¯¥ç±»éœ€è¦åœ¨éœ€è¦è‡ªåŠ¨ç”Ÿæˆ toString() æ–¹æ³•çš„ç±»ä¸­æ·»åŠ å¯¹åº”çš„æˆå‘˜å˜é‡ï¼Œå¹¶è°ƒç”¨ ToStringBuilder çš„ reflectionToString() æ–¹æ³•ã€‚ Guava - MoreObjects.toStringHelper(): Guava æ˜¯ Google å¼€æºçš„ä¸€ä¸ª Java å·¥å…·åº“ï¼Œå…¶ä¸­çš„ MoreObjects ç±»å¯ä»¥å¸®åŠ©å¼€å‘è€…è‡ªåŠ¨ç”Ÿæˆ toString() æ–¹æ³•ã€‚ä½¿ç”¨è¯¥ç±»éœ€è¦åœ¨éœ€è¦è‡ªåŠ¨ç”Ÿæˆ toString() æ–¹æ³•çš„ç±»ä¸­æ·»åŠ å¯¹åº”çš„æˆå‘˜å˜é‡ï¼Œå¹¶è°ƒç”¨ MoreObjects çš„ toStringHelper() æ–¹æ³•ã€‚ Lombok - @ToString: Lombok æ˜¯ä¸€ä¸ª Java åº“ï¼Œå®ƒå¯ä»¥é€šè¿‡æ³¨è§£æ¥ç®€åŒ– Java ä»£ç ã€‚å…¶ä¸­çš„ @ToString æ³¨è§£å¯ä»¥å¸®åŠ©å¼€å‘è€…è‡ªåŠ¨ç”Ÿæˆ toString() æ–¹æ³•ã€‚ä½¿ç”¨è¯¥æ³¨è§£åªéœ€è¦åœ¨éœ€è¦è‡ªåŠ¨ç”Ÿæˆ toString() æ–¹æ³•çš„ç±»ä¸Šæ·»åŠ  @ToString æ³¨è§£å³å¯ï¼ŒLombok ä¼šè‡ªåŠ¨ä¸ºè¯¥ç±»ç”Ÿæˆå¯¹åº”çš„ toString() æ–¹æ³• 4. Eclipse Collections - ToString: Eclipse Collections æ˜¯ä¸€ä¸ªåŸºäº Java çš„é›†åˆæ¡†æ¶ï¼Œå…¶ä¸­çš„ ToString ç±»å¯ä»¥å¸®åŠ©å¼€å‘è€…è‡ªåŠ¨ç”Ÿæˆ toString() æ–¹æ³•ã€‚ä½¿ç”¨è¯¥ç±»éœ€è¦åœ¨éœ€è¦è‡ªåŠ¨ç”Ÿæˆ toString() æ–¹æ³•çš„ç±»ä¸­æ·»åŠ å¯¹åº”çš„æˆå‘˜å˜é‡ï¼Œå¹¶è°ƒç”¨ ToString çš„ includeFields() æ–¹æ³•ã€‚ Apache Commons BeanUtils - ReflectionToStringBuilder: Apache Commons BeanUtils æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„ Java Bean æ“ä½œå·¥å…·åº“ï¼Œå…¶ä¸­çš„ ReflectionToStringBuilder ç±»å¯ä»¥å¸®åŠ©å¼€å‘è€…è‡ªåŠ¨ç”Ÿæˆ toString() æ–¹æ³•ã€‚ä½¿ç”¨è¯¥ç±»éœ€è¦åœ¨éœ€è¦è‡ªåŠ¨ç”Ÿæˆ toString() æ–¹æ³•çš„ç±»ä¸­æ·»åŠ å¯¹åº”çš„æˆå‘˜å˜é‡ï¼Œå¹¶è°ƒç”¨ ReflectionToStringBuilder çš„ toString() æ–¹æ³•ã€‚ ","permalink":"https://blog.chensoul.cc/posts/2023/05/26/always-override-tostring/","summary":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬ä¸‰ç« ã€Šå¯¹è±¡çš„é€šç”¨æ–¹æ³•ã€‹çš„å­¦ä¹ ç¬”è®°ï¼šå§‹ç»ˆè¦†ç›– toString æ–¹æ³•ã€‚\nä»‹ç» è™½ç„¶ Object æä¾› toString æ–¹æ³•çš„å®ç°ï¼Œä½†å®ƒè¿”å›çš„å­—ç¬¦ä¸²é€šå¸¸ä¸æ˜¯ç±»çš„ç”¨æˆ·å¸Œæœ›çœ‹åˆ°çš„ã€‚å®ƒç”±åè·Ÿã€Œatã€ç¬¦å·ï¼ˆ@ï¼‰çš„ç±»åå’Œ hash ä»£ç çš„æ— ç¬¦å·åå…­è¿›åˆ¶è¡¨ç¤ºï¼ˆä¾‹å¦‚ PhoneNumber@163b91ï¼‰ç»„æˆã€‚toString çš„é€šç”¨çº¦å®šæ˜¯è¿™ä¹ˆæè¿°çš„ï¼Œè¿”å›çš„å­—ç¬¦ä¸²åº”è¯¥æ˜¯ã€Œç®€æ´ä½†ä¿¡æ¯ä¸°å¯Œçš„è¡¨ç¤ºï¼Œæ˜“äºé˜…è¯»ã€ã€‚è™½ç„¶æœ‰äººè®¤ä¸º PhoneNumber@163b91 ç®€æ´æ˜“æ‡‚ï¼Œä½†ä¸ 707-867-5309 ç›¸æ¯”ï¼Œå®ƒçš„ä¿¡æ¯é‡å¹¶ä¸å¤§ã€‚toString çº¦å®šæ¥ç€æè¿°ï¼Œã€Œå»ºè®®æ‰€æœ‰å­ç±»è¦†ç›–æ­¤æ–¹æ³•ã€‚ã€å¥½å»ºè®®ï¼Œç¡®å®ï¼\nè™½ç„¶å®ƒä¸å¦‚éµå®ˆ equals å’Œ hashCode çº¦å®šé‚£ä¹ˆé‡è¦ï¼Œä½†æ˜¯ æä¾›ä¸€ä¸ªå¥½çš„ toString å®ç°ï¼ˆèƒ½ï¼‰ä½¿ç±»æ›´æ˜“äºä½¿ç”¨ï¼Œä½¿ç”¨è¯¥ç±»çš„ç³»ç»Ÿï¼ˆä¹Ÿï¼‰æ›´æ˜“äºè°ƒè¯•ã€‚ å½“å¯¹è±¡è¢«ä¼ é€’ç»™ printlnã€printfã€å­—ç¬¦ä¸²è¿æ¥æ“ä½œç¬¦æˆ–æ–­è¨€æˆ–ç”±è°ƒè¯•å™¨æ‰“å°æ—¶ï¼Œå°†è‡ªåŠ¨è°ƒç”¨ toString æ–¹æ³•ã€‚å³ä½¿ä½ ä»æ¥æ²¡æœ‰è°ƒç”¨ toString å¯¹è±¡ï¼Œå…¶ä»–äººä¹Ÿå¯èƒ½ï¼ˆä½¿ç”¨ï¼‰ã€‚ä¾‹å¦‚ï¼Œæœ‰å¯¹è±¡å¼•ç”¨çš„ç»„ä»¶å¯ä»¥åœ¨æ—¥å¿—é”™è¯¯æ¶ˆæ¯ä¸­åŒ…å«å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚å¦‚æœä½ æœªèƒ½è¦†ç›– toStringï¼Œåˆ™è¯¥æ¶ˆæ¯å¯èƒ½å®Œå…¨æ— ç”¨ã€‚\nå¦‚æœä½ å·²ç»ä¸º PhoneNumber æä¾›äº†ä¸€ä¸ªå¥½çš„ toString æ–¹æ³•ï¼Œé‚£ä¹ˆç”Ÿæˆä¸€ä¸ªæœ‰ç”¨çš„è¯Šæ–­æ¶ˆæ¯å°±åƒè¿™æ ·ç®€å•ï¼š\nSystem.out.println(\u0026#34;Failed to connect to \u0026#34; + phoneNumber); æ— è®ºä½ æ˜¯å¦è¦†ç›– toStringï¼Œç¨‹åºå‘˜éƒ½ä¼šä»¥è¿™ç§æ–¹å¼ç”Ÿæˆè¯Šæ–­æ¶ˆæ¯ï¼Œä½†æ˜¯é™¤éä½ ï¼ˆè¦†ç›– toStringï¼‰ï¼Œå¦åˆ™è¿™äº›æ¶ˆæ¯ä¸ä¼šæœ‰ç”¨ã€‚æä¾›å¥½çš„ toString æ–¹æ³•çš„å¥½å¤„ä¸ä»…ä»…æ˜¯å°†ç±»çš„å®ä¾‹æ‰©å±•åˆ°åŒ…å«å¯¹è¿™äº›å®ä¾‹çš„å¼•ç”¨çš„å¯¹è±¡ï¼Œç‰¹åˆ«æ˜¯é›†åˆã€‚åœ¨æ‰“å° map æ—¶ï¼Œä½ æ›´æ„¿æ„çœ‹åˆ°å“ªä¸ªï¼Œ{Jenny=PhoneNumber@163b91} è¿˜æ˜¯ {Jenny=707-867-5309}ï¼Ÿ\nå½“å®é™…ä½¿ç”¨æ—¶ï¼ŒtoString æ–¹æ³•åº”è¯¥è¿”å›å¯¹è±¡ä¸­åŒ…å«çš„æ‰€æœ‰æœ‰è¶£ä¿¡æ¯ï¼Œ å¦‚ç”µè¯å·ç ç¤ºä¾‹æ‰€ç¤ºã€‚å¦‚æœå¯¹è±¡å¾ˆå¤§ï¼Œæˆ–è€…åŒ…å«ä¸åˆ©äºå­—ç¬¦ä¸²è¡¨ç¤ºçš„çŠ¶æ€ï¼Œé‚£ä¹ˆè¿™ç§æ–¹æ³•æ˜¯ä¸åˆ‡å®é™…çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒtoString åº”è¯¥è¿”å›ä¸€ä¸ªæ‘˜è¦ï¼Œä¾‹å¦‚æ›¼å“ˆé¡¿ä½å®…ç”µè¯ç›®å½•ï¼ˆ1487536 å·æ¸…å•ï¼‰æˆ– Thread[main,5,main]ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œå­—ç¬¦ä¸²åº”è¯¥æ˜¯ä¸è¨€è‡ªæ˜çš„ã€‚ï¼ˆçº¿ç¨‹ç¤ºä¾‹æœªèƒ½é€šè¿‡æ­¤æµ‹è¯•ã€‚ï¼‰å¦‚æœæ²¡æœ‰åœ¨å­—ç¬¦ä¸²è¡¨ç¤ºä¸­åŒ…å«æ‰€æœ‰å¯¹è±¡çš„æœ‰è¶£ä¿¡æ¯ï¼Œé‚£ä¹ˆä¸€ä¸ªç‰¹åˆ«æ¼äººçš„æƒ©ç½šå°±æ˜¯æµ‹è¯•å¤±è´¥æŠ¥å‘Šï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nAssertion failure: expected {abc, 123}, but was {abc, 123}. åœ¨å®ç° toString æ–¹æ³•æ—¶ï¼Œä½ å¿…é¡»åšçš„ä¸€ä¸ªé‡è¦å†³å®šæ˜¯æ˜¯å¦åœ¨æ–‡æ¡£ä¸­æŒ‡å®šè¿”å›å€¼çš„æ ¼å¼ã€‚å»ºè®®ä½ é’ˆå¯¹å€¼ç±»ï¼ˆå¦‚ç”µè¯å·ç æˆ–çŸ©é˜µï¼‰è¿™æ ·åšã€‚æŒ‡å®šæ ¼å¼çš„ä¼˜ç‚¹æ˜¯ï¼Œå®ƒå¯ä»¥ä½œä¸ºå¯¹è±¡çš„æ ‡å‡†çš„ã€æ˜ç¡®çš„ã€äººç±»å¯è¯»çš„è¡¨ç¤ºã€‚è¿™ç§è¡¨ç¤ºå¯ä»¥ç”¨äºè¾“å…¥å’Œè¾“å‡ºï¼Œä¹Ÿå¯ä»¥ç”¨äºæŒä¹…çš„äººç±»å¯è¯»æ•°æ®å¯¹è±¡ï¼Œæ¯”å¦‚ CSV æ–‡ä»¶ã€‚å¦‚æœæŒ‡å®šäº†æ ¼å¼ï¼Œæä¾›ä¸€ä¸ªåŒ¹é…çš„é™æ€å·¥å‚æˆ–æ„é€ å‡½æ•°é€šå¸¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œè¿™æ ·ç¨‹åºå‘˜å°±å¯ä»¥è½»æ¾åœ°åœ¨å¯¹è±¡åŠå…¶å­—ç¬¦ä¸²è¡¨ç¤ºä¹‹é—´æ¥å›è½¬æ¢ã€‚Java åº“ä¸­çš„è®¸å¤šå€¼ç±»éƒ½é‡‡ç”¨è¿™ç§æ–¹æ³•ï¼ŒåŒ…æ‹¬ BigIntegerã€BigDecimal å’Œå¤§å¤šæ•°åŒ…è£…ç±»ã€‚\næŒ‡å®š toString è¿”å›å€¼çš„æ ¼å¼çš„ç¼ºç‚¹æ˜¯ï¼Œä¸€æ—¦æŒ‡å®šäº†å®ƒï¼Œå°±ä¼šç»ˆç”Ÿä½¿ç”¨å®ƒï¼Œå‡è®¾ä½ çš„ç±»è¢«å¹¿æ³›ä½¿ç”¨ã€‚ç¨‹åºå‘˜å°†ç¼–å†™ä»£ç æ¥è§£æè¡¨ç¤ºã€ç”Ÿæˆè¡¨ç¤ºå¹¶å°†å…¶åµŒå…¥æŒä¹…æ•°æ®ä¸­ã€‚å¦‚æœä½ åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­æ›´æ”¹äº†è¡¨ç¤ºå½¢å¼ï¼Œä½ å°†ç ´åå®ƒä»¬çš„ä»£ç å’Œæ•°æ®ï¼Œå®ƒä»¬å°†å‘å‡ºå¤§é‡çš„æ¶ˆæ¯ã€‚é€šè¿‡é€‰æ‹©ä¸æŒ‡å®šæ ¼å¼ï¼Œä½ å¯ä»¥ä¿ç•™åœ¨åç»­ç‰ˆæœ¬ä¸­æ·»åŠ ä¿¡æ¯æˆ–æ”¹è¿›æ ¼å¼çš„çµæ´»æ€§ã€‚\næ— è®ºä½ æ˜¯å¦å†³å®šæŒ‡å®šæ ¼å¼ï¼Œä½ éƒ½åº”è¯¥æ¸…æ¥šåœ°è®°å½•ä½ çš„æ„å›¾ã€‚ å¦‚æœæŒ‡å®šäº†æ ¼å¼ï¼Œåˆ™åº”è¯¥ç²¾ç¡®åœ°æŒ‡å®šæ ¼å¼ã€‚ä¾‹å¦‚ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ª toString æ–¹æ³•ç”¨äº PhoneNumber ç±»ï¼š\n/** * Returns the string representation of this phone number. * The string consists of twelve characters whose format is * \u0026#34;XXX-YYY-ZZZZ\u0026#34;, where XXX is the area code, YYY is the * prefix, and ZZZZ is the line number.","title":"ã€ŠEffective Java 3ã€‹ç¬”è®°12ï¼šå½“è¦†ç›– equals æ–¹æ³•æ—¶ï¼Œæ€»è¦è¦†ç›– hashCode æ–¹æ³•"},{"content":"å‰è¨€ ä¹å†œæ¹–ç•”ç”Ÿæ€å›­ æœ¬ç¯‡æ˜¯å¯¹ 2023-05-15 åˆ° 2023-05-21 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nä¸çŸ¥ä¸è§‰ï¼Œè¿™å·²ç»æ˜¯ç¬¬ 20 ç¯‡å‘¨æŠ¥äº†ã€‚è¿™å‘¨ä¾æ—§æ˜¯å¥èº«ã€ç†è´¢ã€å­¦ä¹ å’Œå†™åšå®¢ã€‚\nè‡ªåŠ¨ç”Ÿæˆæ¯æ—¥æ—©æŠ¥ æœ€è¿‘åœ¨æœ‹å‹åœˆçœ‹åˆ°è¿™æ ·ä¸€ä¸ªæ—©æŠ¥ï¼Œå°±åœ¨æƒ³èƒ½å¦é€šè¿‡ä»£ç è‡ªåŠ¨æŠ“å–æ–°é—»å¹¶ç”Ÿæˆè¿™æ ·ä¸€ä¸ªæ—©æŠ¥å›¾ç‰‡ï¼Ÿ\näºæ˜¯ï¼Œåœ¨ç½‘ä¸Šæ‰¾åˆ°ä¸€ç¯‡æ–‡ç« ï¼šå‰åç«¯å‡åŸºäº vercel çš„æ¯æ—¥æ—©æŠ¥é¡¹ç›®\nå‚è€ƒæºä»£ç ï¼Œåšäº†ä¸€äº›ä¿®æ”¹ï¼Œä»£ç è§ï¼šfetch_news.pyã€‚ä¿®æ”¹åçš„é€»è¾‘æ˜¯å°†æŠ“å–çš„æ–°é—»å‘é€åˆ° memosï¼Œä¾‹å¦‚ï¼šhttps://memos.chensoul.cc/m/349 ã€‚å¯ä»¥åœ¨ github action è®¾ç½®æ¯å¤©æ—©ä¸Š 7 ç‚¹è‡ªåŠ¨å‘é€åˆ° memosï¼Œç„¶åå†é€šè¿‡ n8n åŒæ­¥åˆ° ã€ChenSoul Shareã€Telegram é¢‘é“ã€‚\nåœ¨ memos ä¸­å¯¼å‡ºçš„å›¾ç‰‡å¦‚ä¸‹ï¼š\nå¦‚æœèƒ½å¤Ÿé€šè¿‡ python è‡ªåŠ¨ç”Ÿæˆå›¾ç‰‡ï¼Œé‚£å°±æ›´å¥½äº†ã€‚è®°å½•ä¸€ä¸‹ï¼Œå¾…ä»¥åå®ç°ã€‚\nå›¢å»º å…¬å¸å›¢å»ºé€‰æ‹©åœ¨å‘¨å…­ï¼Œè€Œä¸”è¿˜æ˜¯ 520 è¿™ä¸€å¤©ï¼ŒçœŸæ˜¯ä¼šæŒ‘æ—¥å­ã€‚å¾ˆå¤šäººè¯·å‡ï¼Œæœ€ååªæœ‰ 13 äººå‚åŠ å›¢å»ºï¼Œå…¶ä¸­æœ‰ 8 äººæ˜¯æˆ‘ä»¬å¼€å‘ç»„çš„ ğŸ¤£ã€‚æŒ‘ä¸¤å¼ ç…§ç‰‡å‘åˆ°è¿™é‡Œï½\nç†è´¢ è¿™å‘¨æ€»è®¡æ”¯å‡º 1861 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š\n5 æœˆ 15 æ—¥ï¼š1027 å…ƒï¼Œæ­¦åŠŸå±±æ—…æ¸¸ï¼ŒåŠ æ²¹ 327 5 æœˆ 16 æ—¥ï¼š42 å…ƒ 5 æœˆ 17 æ—¥ï¼š12 å…ƒ 5 æœˆ 18 æ—¥ï¼š16 å…ƒ 5 æœˆ 19 æ—¥ï¼š25 å…ƒ 5 æœˆ 20 æ—¥ï¼š562 å…ƒï¼Œçœ‹æœ›å…­èˆ… 5 æœˆ 21 æ—¥ï¼š177 å…ƒ å¥èº« æœ¬å‘¨è·‘æ­¥ 36 å…¬é‡Œï¼Œæœ€é•¿è·‘æ­¥è·ç¦»ä¸º 10 å…¬é‡Œã€‚æ˜ç»†æ•°æ®å¦‚ä¸‹ï¼š\næˆ‘è·‘è¿‡äº†ä¸€äº›åœ°æ–¹ï¼Œå¸Œæœ›éšç€æ—¶é—´æ¨ç§»ï¼Œåœ°å›¾ç‚¹äº®çš„åœ°æ–¹è¶Šæ¥è¶Šå¤šã€‚2 å¹´é‡Œæˆ‘è·‘è¿‡ 2 ä¸ªçœä»½ 2 ä¸ªåŸå¸‚ã€‚æ›´å¤šè·‘æ­¥æ•°æ®åœ¨è·‘æ­¥ä¸»é¡µã€‚\nå·¥ä½œ åšå®¢ æœ¬å‘¨å®Œæˆäº”ç¯‡åšå®¢ï¼š\nJava è®¾è®¡æ¨¡å¼ï¼šAbstract Document\nJava è®¾è®¡æ¨¡å¼ï¼šAbstract Factory\nã€ŠEffective Java 3ã€‹ç¬”è®° 11ï¼šå½“è¦†ç›– equals æ–¹æ³•æ—¶ï¼Œæ€»è¦è¦†ç›– hashCode æ–¹æ³•\n[è¯‘]Build Robust Continuous Integration With Docker and Friends\nPython å­¦ä¹  1ï¼šæ³¨é‡Šã€å˜é‡å’Œå¸¸é‡\næœ¬å‘¨åˆ†äº« å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€ChenSoul Shareã€Telegram é¢‘é“æˆ–è€…æˆ‘çš„ memos ä¸­ã€‚æˆ‘å†™äº†ä¸€ä¸ª python è„šæœ¬ä» memos è¯»å–æœ€è¿‘ä¸€å‘¨çš„ memos è®°å½•ã€‚\n2023-05-19 é™ˆçš“ï¼ˆå·¦è€³æœµè€—å­ï¼‰å‰å¹´åšè¿‡ä¸€æ¬¡ç›´æ’­è®¿è°ˆï¼Œè°ˆåˆ°äº†æŠ€æœ¯ã€è¡Œä¸šã€åˆ›ä¸šçš„å„ä¸ªæ–¹é¢ã€‚æœ¬æ–‡æ˜¯è®¿è°ˆå†…å®¹çš„æ–‡å­—æ•´ç†ï¼Œä»¥æ­¤çºªå¿µä»–ã€‚ https://mp.weixin.qq.com/s/bOnW8gDJ-dXp4KbAjhDw9A #memos #skill #tool 2023-05-17 ç”¨ Material for MkDocs æ¥ç”Ÿæˆä¸“ä¸šçš„æŠ€æœ¯æ–‡æ¡£ https://vra.github.io/2023/05/17/mkdocs-material-tutorial/ #memos #tool 2023-05-17 åŸºäº Popsy åˆ›å»ºè‡ªå·±çš„ä¸ªäººä¸»é¡µ https://popsy.co/ #memos #tool 2023-05-17 Hellonext æ˜¯ä¸€ç§åé¦ˆç®¡ç†å¹³å°ï¼Œå®ƒå¯ä»¥å¸®åŠ©ç»„ç»‡ã€ä¼ä¸šå’Œå¼€å‘å›¢é˜Ÿæ›´å¥½åœ°ç®¡ç†ç”¨æˆ·åé¦ˆå’Œéœ€æ±‚ã€‚å®ƒæä¾›äº†ä¸€ä¸ªç”¨æˆ·å‹å¥½çš„ç•Œé¢ï¼Œä½¿ç”¨æˆ·å¯ä»¥è½»æ¾åœ°æäº¤åé¦ˆå’Œå»ºè®®ï¼Œè€Œç®¡ç†äººå‘˜å¯ä»¥ä½¿ç”¨è¯¥å¹³å°æ¥è·Ÿè¸ªå’Œç»„ç»‡è¿™äº›åé¦ˆï¼Œå¹¶ç¡®å®šå“ªäº›åé¦ˆåº”è¯¥ä¼˜å…ˆè€ƒè™‘å®ç°ã€‚Hellonext è¿˜æä¾›äº†æ•°æ®åˆ†æå’ŒæŠ¥å‘ŠåŠŸèƒ½ï¼Œå¸®åŠ©ç®¡ç†äººå‘˜äº†è§£ç”¨æˆ·åé¦ˆçš„è¶‹åŠ¿å’Œä¼˜å…ˆçº§ï¼Œä»¥ä¾¿æ›´å¥½åœ°æ»¡è¶³ç”¨æˆ·éœ€æ±‚ã€‚ https://hellonext.co/ #memos #tool 2023-05-17 Dify æ˜¯ä¸€ä¸ªç®€å•ä¸”èƒ½åŠ›ä¸°å¯Œçš„è‡ªç„¶è¯­è¨€ç¼–ç¨‹å·¥å…·ã€‚ä½ å¯ä»¥ç”¨å®ƒæ­å»ºå•†ç”¨çº§åº”ç”¨ï¼Œä¸ªäººåŠ©ç†ã€‚å¦‚æœä½ æƒ³è‡ªå·±å¼€å‘åº”ç”¨ï¼ŒDify ä¹Ÿèƒ½ä¸ºä½ çœä¸‹æ¥å…¥ OpenAI çš„åç«¯å·¥ä½œï¼Œä½†ä½¿ç”¨æˆ‘ä»¬é€æ­¥æä¾›é«˜çš„å¯è§†åŒ–è¿è¥èƒ½åŠ›ï¼Œä½ å¯ä»¥æŒç»­çš„æ”¹è¿›å’Œè®­ç»ƒä½ çš„ GPT æ¨¡å‹ã€‚ https://docs.dify.ai/v/zh-hans/getting-started/intro-to-dify #tool #memos 2023-05-17 ç”¨ 200 è¡Œ python ä»£ç å®ç° dns æœåŠ¡å™¨çš„æ•™ç¨‹ https://implement-dns.wizardzines.com/ #memos #tool 2023-05-17 postman æ¨å‡ºäº† postbotï¼Œä½¿ç”¨äººå·¥æ™ºèƒ½å¸®åŠ©æ‚¨è°ƒè¯•å’Œç†è§£ APIã€æ›´å¿«åœ°ç¼–å†™æµ‹è¯• https://blog.postman.com/introducing-postbot-postmans-new-ai-assistant/ #tool #memos 2023-05-17 https://imgg.gg/ æ˜¯ä¸€ä¸ªå¯ä»¥å°†ä»»æ„ sms å†…å®¹è½¬æ¢æˆä¸ºå›¾ç‰‡çš„å·¥å…·ï¼Œä¸ç”¨æ‹…å¿ƒåœ¨ APP ä¸Šæˆªå›¾ä¼šæ³„æ¼éšç§ã€‚ç”Ÿæˆçš„å›¾ç‰‡çš„æ ·å¼å¾ˆåƒ https://poet.so/ ï¼Œä¸è¿‡ Poet.so åªèƒ½ç”Ÿæˆæ¨ç‰¹ã€linkedinã€shopify çš„åˆ†äº«å›¾ã€‚ #tool #memos 2023-05-17 éƒ½çŸ¥é“ ffmpeg æ˜¯åª’ä½“æ–‡ä»¶å¤„ç†çš„ç‘å£«å†›åˆ€ï¼Œä½†å‘½ä»¤è¡Œçš„æ“ä½œå¯¹å¤§éƒ¨åˆ†äººæ¥è¯´ç¡®å®ä¼šé¢ä¸´è¿·èŒ«å’Œç¹çã€‚FFmpeg.guide å°±æ˜¯ä¸€ä¸ªå›¾å½¢åŒ–ç”Ÿæˆ ffmpeg å‘½ä»¤çš„å·¥å…·ã€‚ ç½‘ç«™åœ°å€ï¼šhttps://ffmpeg.guide/ #tool #memos ä»¥ä¸Šã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/05/25/weekly_review_20/","summary":"å‰è¨€ ä¹å†œæ¹–ç•”ç”Ÿæ€å›­ æœ¬ç¯‡æ˜¯å¯¹ 2023-05-15 åˆ° 2023-05-21 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nä¸çŸ¥ä¸è§‰ï¼Œè¿™å·²ç»æ˜¯ç¬¬ 20 ç¯‡å‘¨æŠ¥äº†ã€‚è¿™å‘¨ä¾æ—§æ˜¯å¥èº«ã€ç†è´¢ã€å­¦ä¹ å’Œå†™åšå®¢ã€‚\nè‡ªåŠ¨ç”Ÿæˆæ¯æ—¥æ—©æŠ¥ æœ€è¿‘åœ¨æœ‹å‹åœˆçœ‹åˆ°è¿™æ ·ä¸€ä¸ªæ—©æŠ¥ï¼Œå°±åœ¨æƒ³èƒ½å¦é€šè¿‡ä»£ç è‡ªåŠ¨æŠ“å–æ–°é—»å¹¶ç”Ÿæˆè¿™æ ·ä¸€ä¸ªæ—©æŠ¥å›¾ç‰‡ï¼Ÿ\näºæ˜¯ï¼Œåœ¨ç½‘ä¸Šæ‰¾åˆ°ä¸€ç¯‡æ–‡ç« ï¼šå‰åç«¯å‡åŸºäº vercel çš„æ¯æ—¥æ—©æŠ¥é¡¹ç›®\nå‚è€ƒæºä»£ç ï¼Œåšäº†ä¸€äº›ä¿®æ”¹ï¼Œä»£ç è§ï¼šfetch_news.pyã€‚ä¿®æ”¹åçš„é€»è¾‘æ˜¯å°†æŠ“å–çš„æ–°é—»å‘é€åˆ° memosï¼Œä¾‹å¦‚ï¼šhttps://memos.chensoul.cc/m/349 ã€‚å¯ä»¥åœ¨ github action è®¾ç½®æ¯å¤©æ—©ä¸Š 7 ç‚¹è‡ªåŠ¨å‘é€åˆ° memosï¼Œç„¶åå†é€šè¿‡ n8n åŒæ­¥åˆ° ã€ChenSoul Shareã€Telegram é¢‘é“ã€‚\nåœ¨ memos ä¸­å¯¼å‡ºçš„å›¾ç‰‡å¦‚ä¸‹ï¼š\nå¦‚æœèƒ½å¤Ÿé€šè¿‡ python è‡ªåŠ¨ç”Ÿæˆå›¾ç‰‡ï¼Œé‚£å°±æ›´å¥½äº†ã€‚è®°å½•ä¸€ä¸‹ï¼Œå¾…ä»¥åå®ç°ã€‚\nå›¢å»º å…¬å¸å›¢å»ºé€‰æ‹©åœ¨å‘¨å…­ï¼Œè€Œä¸”è¿˜æ˜¯ 520 è¿™ä¸€å¤©ï¼ŒçœŸæ˜¯ä¼šæŒ‘æ—¥å­ã€‚å¾ˆå¤šäººè¯·å‡ï¼Œæœ€ååªæœ‰ 13 äººå‚åŠ å›¢å»ºï¼Œå…¶ä¸­æœ‰ 8 äººæ˜¯æˆ‘ä»¬å¼€å‘ç»„çš„ ğŸ¤£ã€‚æŒ‘ä¸¤å¼ ç…§ç‰‡å‘åˆ°è¿™é‡Œï½\nç†è´¢ è¿™å‘¨æ€»è®¡æ”¯å‡º 1861 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š\n5 æœˆ 15 æ—¥ï¼š1027 å…ƒï¼Œæ­¦åŠŸå±±æ—…æ¸¸ï¼ŒåŠ æ²¹ 327 5 æœˆ 16 æ—¥ï¼š42 å…ƒ 5 æœˆ 17 æ—¥ï¼š12 å…ƒ 5 æœˆ 18 æ—¥ï¼š16 å…ƒ 5 æœˆ 19 æ—¥ï¼š25 å…ƒ 5 æœˆ 20 æ—¥ï¼š562 å…ƒï¼Œçœ‹æœ›å…­èˆ… 5 æœˆ 21 æ—¥ï¼š177 å…ƒ å¥èº« æœ¬å‘¨è·‘æ­¥ 36 å…¬é‡Œï¼Œæœ€é•¿è·‘æ­¥è·ç¦»ä¸º 10 å…¬é‡Œã€‚æ˜ç»†æ•°æ®å¦‚ä¸‹ï¼š\næˆ‘è·‘è¿‡äº†ä¸€äº›åœ°æ–¹ï¼Œå¸Œæœ›éšç€æ—¶é—´æ¨ç§»ï¼Œåœ°å›¾ç‚¹äº®çš„åœ°æ–¹è¶Šæ¥è¶Šå¤šã€‚2 å¹´é‡Œæˆ‘è·‘è¿‡ 2 ä¸ªçœä»½ 2 ä¸ªåŸå¸‚ã€‚æ›´å¤šè·‘æ­¥æ•°æ®åœ¨è·‘æ­¥ä¸»é¡µã€‚\nå·¥ä½œ åšå®¢ æœ¬å‘¨å®Œæˆäº”ç¯‡åšå®¢ï¼š","title":"å‘¨æŠ¥-20ï½œè‡ªåŠ¨ç”Ÿæˆæ¯æ—¥æ—©æŠ¥ã€å‘¨æœ«å›¢å»º"},{"content":"Python æ³¨é‡Šã€å˜é‡å’Œå¸¸é‡æ˜¯ç¼–å†™ Python ä»£ç æ—¶éå¸¸é‡è¦çš„æ¦‚å¿µï¼Œä¸‹é¢åˆ†åˆ«ä»‹ç»å®ƒä»¬çš„åŸºæœ¬ç”¨æ³•å’Œè¯­æ³•ã€‚\nHello World åˆ›å»ºä¸€ä¸ª 00_helloworld.py æ–‡ä»¶ï¼Œæ‰“å° hello worldï¼š\nprint(\u0026#34;Helloï¼ŒWorld!\u0026#34;) æ‰§è¡Œè¯¥æ–‡ä»¶ï¼Œä¼šè¾“å‡ºç»“æœï¼š\n$ python 00_helloworld.py Helloï¼ŒWorld! ä¸€èˆ¬åœ¨ python æ–‡ä»¶çš„å¼€å¤´ç¬¬ä¸€è¡Œï¼Œæˆ‘ä»¬éƒ½ä¼šçœ‹åˆ°ä¸‹é¢çš„ä»£ç è¡Œï¼š\n# python2 #!/usr/bin/env python # æˆ–è€… #!/usr/bin/python # python3 #!/usr/bin/env python3 # æˆ–è€… #!/usr/bin/python3 è¿™è¡Œä»£ç ç”¨æ¥æŒ‡å®šæœ¬è„šæœ¬ç”¨ä»€ä¹ˆè§£é‡Šå™¨æ¥æ‰§è¡Œã€‚\n#!/usr/bin/python æ˜¯å‘Šè¯‰æ“ä½œç³»ç»Ÿæ‰§è¡Œè¿™ä¸ªè„šæœ¬çš„æ—¶å€™ï¼Œè°ƒç”¨ /usr/bin ä¸‹çš„ python è§£é‡Šå™¨ã€‚\n#!/usr/bin/env python è¿™ç§ç”¨æ³•æ˜¯ä¸ºäº†é˜²æ­¢æ“ä½œç³»ç»Ÿç”¨æˆ·æ²¡æœ‰å°† python è£…åœ¨é»˜è®¤çš„ /usr/bin è·¯å¾„é‡Œã€‚å½“ç³»ç»Ÿçœ‹åˆ°è¿™ä¸€è¡Œçš„æ—¶å€™ï¼Œé¦–å…ˆä¼šåˆ° env è®¾ç½®é‡ŒæŸ¥æ‰¾ python çš„å®‰è£…è·¯å¾„ï¼Œå†è°ƒç”¨å¯¹åº”è·¯å¾„ä¸‹çš„è§£é‡Šå™¨ç¨‹åºå®Œæˆæ“ä½œã€‚ä¸ºäº†å¢å¼ºä»£ç çš„å¯ç§»æ¤æ€§ï¼Œæ¨èè¿™ç§å†™æ³•ã€‚\nåœ¨ 00_helloworld.py æ·»åŠ è¿™è¡Œä»£ç ï¼š\n#!/usr/bin/env python print(\u0026#34;Helloï¼ŒWorld!\u0026#34;) ç„¶åï¼Œä¿®æ”¹è¯¥æ–‡ä»¶ä¸ºå¯æ‰§è¡Œå±æ€§ï¼š\nchmod +x 00_helloworld.py å°±å¯ä»¥è¿™æ ·æ‰§è¡Œï¼š\n. 00_helloworld.py ç¼–ç æ ¼å¼ Python3 é»˜è®¤çš„ç¼–ç æ ¼å¼æ˜¯ UTF-8ï¼ˆUnicode Transformation Format - 8 bitï¼‰ã€‚è¿™æ˜¯ä¸€ç§é€šç”¨çš„å­—ç¬¦ç¼–ç ï¼Œæ”¯æŒå‡ ä¹æ‰€æœ‰çš„å­—ç¬¦é›†ï¼ŒåŒ…æ‹¬ ASCIIã€Latinã€ä¸­æ–‡ã€æ—¥æ–‡ã€éŸ©æ–‡ç­‰ã€‚\nåœ¨ Python 3.x ä¸­ï¼Œæ‰€æœ‰çš„å­—ç¬¦ä¸²éƒ½æ˜¯ä»¥ Unicode ç¼–ç å­˜å‚¨çš„ã€‚å½“ä½ åœ¨ Python ä¸­åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»»ä½• Unicode å­—ç¬¦ï¼Œè€Œä¸å¿…æ‹…å¿ƒç¼–ç é—®é¢˜ã€‚\nå½“ä½ æ‰“å¼€ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶æ—¶ï¼ŒPython ä¼šè‡ªåŠ¨å°è¯•ä½¿ç”¨ UTF-8 ç¼–ç æ¥è§£ææ–‡ä»¶å†…å®¹ã€‚å¦‚æœæ–‡ä»¶ä½¿ç”¨å…¶ä»–ç¼–ç æ ¼å¼ï¼Œä½ éœ€è¦ä½¿ç”¨ç›¸åº”çš„ç¼–ç æ ¼å¼æ¥æ‰“å¼€æ–‡ä»¶ï¼Œæˆ–è€…åœ¨è¯»å–æ–‡ä»¶å†…å®¹åå°†å…¶è§£ç ä¸º Unicodeã€‚\nåœ¨ Python ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ç¼–ç å£°æ˜ï¼ˆcoding declarationï¼‰æ¥æŒ‡å®šæ–‡ä»¶çš„ç¼–ç æ ¼å¼ã€‚ç¼–ç å£°æ˜æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ³¨é‡Šï¼Œå‡ºç°åœ¨ Python æ–‡ä»¶çš„ç¬¬ä¸€è¡Œæˆ–ç¬¬äºŒè¡Œï¼ˆå¦‚æœæ–‡ä»¶çš„ç¬¬ä¸€è¡Œæ˜¯ shebangï¼Œåˆ™ç¼–ç å£°æ˜å¿…é¡»å‡ºç°åœ¨ç¬¬äºŒè¡Œï¼‰ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š\n# -*- coding: encoding -*- # æˆ–è€… # coding=utf-8 å…¶ä¸­ï¼Œencoding æ˜¯æ–‡ä»¶çš„ç¼–ç æ ¼å¼ï¼Œå¯ä»¥æ˜¯ UTF-8ã€ISO-8859-1 æˆ–å…¶ä»–ç¼–ç æ ¼å¼çš„åç§°ã€‚ç¼–ç å£°æ˜å‘Šè¯‰ Python è§£é‡Šå™¨åº”è¯¥ä½¿ç”¨æŒ‡å®šçš„ç¼–ç æ ¼å¼æ¥è§£æè¯¥æ–‡ä»¶ä¸­çš„æ–‡æœ¬å†…å®¹ã€‚å¦‚æœæ²¡æœ‰ç¼–ç å£°æ˜ï¼ŒPython3 é»˜è®¤ä½¿ç”¨ UTF-8 ç¼–ç æ¥è§£ææ–‡ä»¶å†…å®¹ã€‚\nPython 2.x çš„é»˜è®¤ç¼–ç æ ¼å¼æ˜¯ ASCIIï¼Œè¿™æ˜¯ä¸€ç§ 7-bit çš„å­—ç¬¦ç¼–ç ï¼Œåªèƒ½è¡¨ç¤ºæœ€åŸºæœ¬çš„ ASCII å­—ç¬¦é›†ï¼Œæ— æ³•æ”¯æŒå¤šè¯­è¨€å’Œ Unicode å­—ç¬¦ã€‚\nåœ¨ Python 2.x ä¸­ï¼Œå¦‚æœä½ éœ€è¦ä½¿ç”¨ Unicode å­—ç¬¦ï¼Œä½ éœ€è¦åœ¨å­—ç¬¦ä¸²å‰é¢æ·»åŠ ä¸€ä¸ª u å­—ç¬¦ï¼Œä»¥è¡¨ç¤ºè¯¥å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ª Unicode å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼š\n# -*- coding: utf-8 -*- s = u\u0026#39;ä½ å¥½ï¼Œä¸–ç•Œï¼\u0026#39; print s åœ¨ Python 2.x ä¸­ï¼Œå¦‚æœä½ éœ€è¦æ‰“å¼€ä¸€ä¸ªé ASCII ç¼–ç çš„æ–‡æœ¬æ–‡ä»¶ï¼Œä½ éœ€è¦åœ¨æ‰“å¼€æ–‡ä»¶æ—¶æŒ‡å®šæ–‡ä»¶çš„ç¼–ç æ ¼å¼ã€‚ä¾‹å¦‚ï¼š\nf = open(\u0026#39;filename.txt\u0026#39;, \u0026#39;r\u0026#39;) s = f.read().decode(\u0026#39;gbk\u0026#39;) # è¯»å–å¹¶è§£ç æ–‡ä»¶å†…å®¹ f.close() åœ¨ Python 2.x ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ç¼–ç å£°æ˜æ¥æŒ‡å®šæ–‡ä»¶çš„ç¼–ç æ ¼å¼ï¼š\n# -*- coding: encoding -*- å…¶ä¸­ï¼Œencoding æ˜¯æ–‡ä»¶çš„ç¼–ç æ ¼å¼ï¼Œå¯ä»¥æ˜¯ UTF-8ã€GBKã€ISO-8859-1 æˆ–å…¶ä»–ç¼–ç æ ¼å¼çš„åç§°ã€‚ç¼–ç å£°æ˜å‘Šè¯‰ Python è§£é‡Šå™¨åº”è¯¥ä½¿ç”¨æŒ‡å®šçš„ç¼–ç æ ¼å¼æ¥è§£æè¯¥æ–‡ä»¶ä¸­çš„æ–‡æœ¬å†…å®¹ã€‚å¦‚æœæ²¡æœ‰ç¼–ç å£°æ˜ï¼ŒPython 2.x é»˜è®¤ä½¿ç”¨ ASCII ç¼–ç æ¥è§£ææ–‡ä»¶å†…å®¹ã€‚\nåœ¨ç»ˆç«¯è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹ç¼–ç æ ¼å¼ï¼š\n$ python Python 3.11.3 (main, Apr 7 2023, 20:13:31) [Clang 14.0.0 (clang-1400.0.29.202)] on darwin Type \u0026#34;help\u0026#34;, \u0026#34;copyright\u0026#34;, \u0026#34;credits\u0026#34; or \u0026#34;license\u0026#34; for more information. \u0026gt;\u0026gt;\u0026gt; import sys \u0026gt;\u0026gt;\u0026gt; sys.getdefaultencoding() \u0026#39;utf-8\u0026#39; æ³¨é‡Š åœ¨ Python ä¸­ï¼Œæ³¨é‡Šç”¨äºåœ¨ä»£ç ä¸­æ·»åŠ æ³¨é‡Šã€è§£é‡Šæˆ–è¯´æ˜ã€‚æ³¨é‡Šé€šå¸¸ç”¨äºæé«˜ä»£ç çš„å¯è¯»æ€§ï¼Œå¸®åŠ©å…¶ä»–äººç†è§£ä½ çš„ä»£ç ã€‚\nPython æ”¯æŒä¸¤ç§ç±»å‹çš„æ³¨é‡Šï¼šå•è¡Œæ³¨é‡Šå’Œå¤šè¡Œæ³¨é‡Šã€‚\nå•è¡Œæ³¨é‡Š åœ¨ Python ä¸­ï¼Œå•è¡Œæ³¨é‡Šä»¥äº•å·(#)å¼€å¤´ï¼Œç”¨äºåœ¨ä»£ç è¡Œçš„æœ«å°¾æˆ–è€…ç‹¬ç«‹ä¸€è¡Œä¸­æ·»åŠ æ³¨é‡Šã€‚ä»»ä½•ç´§éšäº•å·åçš„æ–‡æœ¬éƒ½å°†è¢«è§£é‡Šå™¨å¿½ç•¥ã€‚\nä¾‹å¦‚ï¼š\n# è¿™æ˜¯ä¸€ä¸ªå•è¡Œæ³¨é‡Š print(\u0026#34;Hello, World!\u0026#34;) # è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå•è¡Œæ³¨é‡Š text = \u0026#34;# This is not a comment because it\u0026#39;s inside quotes.\u0026#34; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç¬¬ä¸€è¡Œæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å•è¡Œæ³¨é‡Šï¼Œç¬¬äºŒè¡Œåˆ™æ˜¯åœ¨ä»£ç è¡Œçš„æœ«å°¾æ·»åŠ çš„å•è¡Œæ³¨é‡Šã€‚è¿™äº›æ³¨é‡Šä¸ä¼šå½±å“ç¨‹åºçš„æ‰§è¡Œï¼Œä½†æ˜¯å¯ä»¥å¸®åŠ©å…¶ä»–äººç†è§£ä½ çš„ä»£ç ã€‚\nå¤šè¡Œæ³¨é‡Š Python ä¸­ä½¿ç”¨ä»¥ä¸‰ä¸ªå•å¼•å·æˆ–è€…ä¸‰ä¸ªåŒå¼•å·æ‹¬èµ·æ¥çš„æ³¨é‡Šè¢«è§†ä¸ºå¤šè¡Œæ³¨é‡Šã€‚å¤šè¡Œæ³¨é‡Šé€šå¸¸ç”¨äºæ³¨é‡Šå‡½æ•°ã€ç±»ã€æ¨¡å—ç­‰ã€‚ä¾‹å¦‚ï¼š\n\u0026#39;\u0026#39;\u0026#39; è¿™æ˜¯ä¸€ä¸ªå¤šè¡Œæ³¨é‡Šï¼Œ å®ƒå¯ä»¥ç”¨äºæè¿°å‡½æ•°ã€ç±»æˆ–æ¨¡å—çš„åŠŸèƒ½å’Œä½¿ç”¨æ–¹æ³•ã€‚ \u0026#39;\u0026#39;\u0026#39; def add_numbers(a, b): \u0026#34;\u0026#34;\u0026#34; è¿™æ˜¯ä¸€ä¸ªç”¨äºè®¡ç®—ä¸¤ä¸ªæ•°å­—ä¹‹å’Œçš„å‡½æ•°ã€‚ å‚æ•°ï¼š a -- ç¬¬ä¸€ä¸ªæ•°å­— b -- ç¬¬äºŒä¸ªæ•°å­— è¿”å›å€¼ï¼š ä¸¤ä¸ªæ•°å­—çš„å’Œ \u0026#34;\u0026#34;\u0026#34; return a + b æ³¨æ„ï¼š\nPython çš„å¤šè¡Œæ³¨é‡Šå®é™…ä¸Šæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å­—é¢å€¼ï¼Œå› æ­¤å¦‚æœä¸è¢«èµ‹å€¼ç»™ä»»ä½•å˜é‡ï¼Œå®ƒä»¬å°†ä¸ä¼šå¯¹ç¨‹åºäº§ç”Ÿä»»ä½•å½±å“ã€‚\nå˜é‡ åœ¨ Python ä¸­ï¼Œå˜é‡æ˜¯ç”¨æ¥å­˜å‚¨æ•°æ®çš„æ ‡è¯†ç¬¦ã€‚å®ƒä»¬æ˜¯ç¨‹åºä¸­çš„ä¸€ç§åŸºæœ¬å…ƒç´ ï¼Œç”¨äºæ“ä½œæ•°æ®å¹¶åœ¨ç¨‹åºä¸­å¼•ç”¨å®ƒä»¬ã€‚\nPython ä¸­çš„å˜é‡å¯ä»¥å­˜å‚¨å„ç§æ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬æ•°å­—ã€å­—ç¬¦ä¸²ã€åˆ—è¡¨ã€å…ƒç»„ã€å­—å…¸ç­‰ã€‚å˜é‡çš„å€¼å¯ä»¥éšæ—¶æ›´æ”¹ï¼Œå› æ­¤å®ƒä»¬æ˜¯åŠ¨æ€çš„ã€‚\nå˜é‡çš„å‘½åè§„åˆ™å¦‚ä¸‹ï¼š\nå˜é‡åå¿…é¡»ä»¥å­—æ¯æˆ–ä¸‹åˆ’çº¿å¼€å¤´ã€‚ å˜é‡åå¯ä»¥åŒ…å«å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ã€‚ å˜é‡ååŒºåˆ†å¤§å°å†™ã€‚ å˜é‡åä¸èƒ½ä¸ Python çš„å…³é”®å­—ç›¸åŒã€‚ ä»¥ä¸‹æ˜¯ Python 3.x ç‰ˆæœ¬ä¸­çš„æ‰€æœ‰å…³é”®å­—ï¼š\nFalse class finally is return None continue for lambda try True def from nonlocal while and del global not with as elif if or yield assert else import pass break except in raise åœ¨ Python 2.x ä¸­ï¼Œè¿˜æœ‰ä¸¤ä¸ªé¢å¤–çš„å…³é”®å­— exec å’Œ printï¼Œä½†å®ƒä»¬åœ¨ Python 3.x ä¸­å·²ç»è¢«ç§»é™¤ã€‚\nå¦‚æœä½ ä¸ç¡®å®šæŸä¸ªæ ‡è¯†ç¬¦æ˜¯å¦æ˜¯å…³é”®å­—ï¼Œä½ å¯ä»¥ä½¿ç”¨ Python çš„ keyword æ¨¡å—æ¥æ£€æŸ¥ï¼š\nimport keyword print(keyword.kwlist) å˜é‡å®šä¹‰å’Œä½¿ç”¨ åœ¨ Python ä¸­ï¼Œå¯ä»¥ä½¿ç”¨èµ‹å€¼è¯­å¥æ¥åˆ›å»ºå˜é‡ã€‚èµ‹å€¼è¯­å¥ä½¿ç”¨ç­‰å·(=)å°†å˜é‡åå’Œè¦å­˜å‚¨åœ¨å˜é‡ä¸­çš„å€¼åˆ†å¼€ã€‚\nPython æ˜¯åŠ¨æ€ç±»å‹çš„è¯­è¨€ï¼Œæ— é¡»å£°æ˜å˜é‡ç±»å‹ï¼Œç›´æ¥å¯¹å˜é‡èµ‹å€¼å³å¯ä½¿ç”¨ã€‚\nç¤ºä¾‹ï¼š\n# åˆ›å»ºä¸€ä¸ªæ•´å‹å˜é‡ x x = 5 # åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å˜é‡ name name = \u0026#34;John\u0026#34; # åˆ›å»ºä¸€ä¸ªåˆ—è¡¨å˜é‡ my_list my_list = [1, 2, 3] # å¼•ç”¨å˜é‡ x çš„å€¼ print(x) # è¾“å‡º 5 # å¼•ç”¨å˜é‡ name çš„å€¼ print(\u0026#34;My name is\u0026#34;, name) # è¾“å‡º My name is John # å¼•ç”¨å˜é‡ my_list çš„å€¼ print(my_list) # è¾“å‡º [1, 2, 3] åœ¨ Python ä¸­ï¼Œå˜é‡æ˜¯åŠ¨æ€ç±»å‹çš„ã€‚è¿™æ„å‘³ç€å˜é‡çš„ç±»å‹å¯ä»¥éšæ—¶æ›´æ”¹ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå˜é‡å¯ä»¥åœ¨ä¸€ä¸ªæ—¶åˆ»å­˜å‚¨ä¸€ä¸ªæ•´æ•°ï¼Œè€Œåœ¨ä¸‹ä¸€ä¸ªæ—¶åˆ»å­˜å‚¨ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚\n# åŠ¨æ€ç±»å‹ç¤ºä¾‹ x = 5 # x æ˜¯ä¸€ä¸ªæ•´æ•° print(x) # è¾“å‡º 5 x = \u0026#34;Hello, world!\u0026#34; # x æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸² print(x) # è¾“å‡º Hello, world! åœ¨ Python ä¸­ï¼Œå˜é‡æ˜¯å¯¹è±¡çš„å¼•ç”¨ã€‚å½“ä¸€ä¸ªå˜é‡è¢«èµ‹å€¼ä¸ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå®ƒå®é™…ä¸Šæ˜¯å°†è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨å­˜å‚¨åˆ°å˜é‡ä¸­ã€‚Python çš„å†…å­˜ç®¡ç†å™¨ä¼šè‡ªåŠ¨è·Ÿè¸ªå’Œå›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡ã€‚\nä¸€è¡Œå®šä¹‰å¤šä¸ªå˜é‡ åœ¨ Python ä¸­å¯ä»¥ä¸€è¡Œå®šä¹‰å¤šä¸ªå˜é‡ã€‚å¯ä»¥ä½¿ç”¨é€—å·å°†å¤šä¸ªå˜é‡ååˆ†å¼€ï¼Œå¹¶ä½¿ç”¨ç­‰å·å°†å®ƒä»¬ä¸ç›¸åº”çš„å€¼åˆ†å¼€ã€‚\n# åœ¨ Python ä¸­å¯ä»¥ä¸€è¡Œå®šä¹‰å¤šä¸ªå˜é‡ã€‚å¯ä»¥ä½¿ç”¨é€—å·å°†å¤šä¸ªå˜é‡ååˆ†å¼€ï¼Œå¹¶ä½¿ç”¨ç­‰å·å°†å®ƒä»¬ä¸ç›¸åº”çš„å€¼åˆ†å¼€ã€‚ x, y, z = 5, \u0026#34;John\u0026#34;, [1, 2, 3] # è¾“å‡ºå˜é‡å€¼ print(x) # è¾“å‡º 5 print(y) # è¾“å‡º John print(z) # è¾“å‡º [1, 2, 3] # ä¸€è¡Œå®šä¹‰å¤šä¸ªå˜é‡ï¼Œä½¿ç”¨ç›¸åŒçš„å€¼ a = b = c = 0 # è¾“å‡ºå˜é‡å€¼ print(a) # è¾“å‡º 0 print(b) # è¾“å‡º 0 print(c) # è¾“å‡º 0 å˜é‡çš„ä½œç”¨åŸŸ åœ¨ Python ä¸­ï¼Œå˜é‡çš„ä½œç”¨åŸŸæ˜¯æŒ‡å˜é‡åœ¨ç¨‹åºä¸­å¯è§å’Œå¯è®¿é—®çš„èŒƒå›´ã€‚Python ä¸­æœ‰å››ç§ä½œç”¨åŸŸï¼š\nå±€éƒ¨ä½œç”¨åŸŸï¼šå˜é‡åœ¨å‡½æ•°å†…éƒ¨å®šä¹‰ï¼Œåªèƒ½åœ¨å‡½æ•°å†…éƒ¨è®¿é—®ã€‚ åµŒå¥—ä½œç”¨åŸŸï¼šå˜é‡åœ¨åµŒå¥—å‡½æ•°å†…éƒ¨å®šä¹‰ï¼Œå¯ä»¥åœ¨åµŒå¥—å‡½æ•°å†…éƒ¨å’Œå¤–éƒ¨å‡½æ•°å†…éƒ¨è®¿é—®ã€‚ å…¨å±€ä½œç”¨åŸŸï¼šå˜é‡åœ¨æ¨¡å—å†…éƒ¨å®šä¹‰ï¼Œå¯ä»¥åœ¨æ¨¡å—å†…çš„ä»»ä½•å‡½æ•°æˆ–ç±»ä¸­è®¿é—®ã€‚ å†…ç½®ä½œç”¨åŸŸï¼šå˜é‡æ˜¯ Python å†…ç½®çš„å‡½æ•°å’Œå¯¹è±¡ï¼Œå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è®¿é—®ã€‚ å¦‚æœåœ¨å‡½æ•°å†…éƒ¨è®¿é—®å…¨å±€å˜é‡ï¼Œä½ éœ€è¦ä½¿ç”¨ global å…³é”®å­—æ¥æŒ‡ç¤ºå˜é‡çš„ä½œç”¨åŸŸã€‚ä¾‹å¦‚ï¼š\nx = 10 # å…¨å±€å˜é‡ def my_func(): global x # ä½¿ç”¨ global å…³é”®å­—æŒ‡ç¤ºå˜é‡çš„ä½œç”¨åŸŸ x = 20 # å°†å…¨å±€å˜é‡ x çš„å€¼ä¿®æ”¹ä¸º 20 my_func() print(x) # è¾“å‡º 20 å˜é‡è§£åŒ… åœ¨ Python ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å˜é‡è§£åŒ…ï¼ˆunpackingï¼‰è¯­æ³•å°†ä¸€ä¸ªåºåˆ—æˆ–å…ƒç»„ä¸­çš„å€¼åˆ†é…ç»™å¤šä¸ªå˜é‡ã€‚å˜é‡è§£åŒ…è¯­æ³•ä½¿ç”¨ç­‰å·(=)å°†å˜é‡åä¸åºåˆ—æˆ–å…ƒç»„ä¸­çš„å€¼åˆ†å¼€ï¼Œå¹¶ä½¿ç”¨é€—å·å°†å˜é‡ååˆ†å¼€ã€‚\nå¯¹å…ƒç»„è§£åŒ…\n# å®šä¹‰ä¸€ä¸ªå…ƒç»„ my_tuple = (1, 2, 3) # æ³¨æ„ï¼šå·¦ä¾§å˜é‡çš„ä¸ªæ•°å¿…é¡»å’Œå¾…å±•å¼€çš„åˆ—è¡¨é•¿åº¦ç›¸ç­‰ï¼Œå¦åˆ™ä¼šæŠ¥é”™ # å˜é‡è§£åŒ…ï¼Œå°†å…ƒç»„ä¸­çš„å€¼åˆ†é…ç»™å¤šä¸ªå˜é‡ x, y, z = my_tuple # è¾“å‡ºå˜é‡å€¼ print(x) # è¾“å‡º 1 print(y) # è¾“å‡º 2 print(z) # è¾“å‡º 3 å¯ä»¥å°†å˜é‡è§£åŒ…è¯­æ³•ä¸å…¶ä»– Python çš„è¯­è¨€ç‰¹æ€§ç»“åˆä½¿ç”¨ï¼Œä¾‹å¦‚å‡½æ•°è¿”å›å€¼å’Œåˆ—è¡¨æ¨å¯¼å¼ã€‚\n# å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›ä¸¤ä¸ªå€¼ def get_name_and_age(): return \u0026#34;John\u0026#34;, 30 # å˜é‡è§£åŒ…ï¼Œå°†å‡½æ•°è¿”å›çš„å€¼åˆ†é…ç»™å¤šä¸ªå˜é‡ name, age = get_name_and_age() # è¾“å‡ºå˜é‡å€¼ print(name) # è¾“å‡º John print(age) # è¾“å‡º 30 # ä½¿ç”¨åˆ—è¡¨æ¨å¯¼å¼åˆ›å»ºä¸€ä¸ªåˆ—è¡¨ï¼Œç„¶åè¿›è¡Œå˜é‡è§£åŒ… my_list = [1, 2, 3] a, b, c = [x * 2 for x in my_list] # è¾“å‡ºå˜é‡å€¼ print(a) # è¾“å‡º 2 print(b) # è¾“å‡º 4 print(c) # è¾“å‡º 6 å˜é‡è§£åŒ…è¯­æ³•å¯ä»¥ç”¨äºåµŒå¥—çš„åºåˆ—æˆ–å…ƒç»„ï¼š\n# å®šä¹‰ä¸€ä¸ªåµŒå¥—å…ƒç»„ my_tuple = (1, 2, (3, 4)) # å˜é‡è§£åŒ…ï¼Œå°†å…ƒç»„ä¸­çš„å€¼åˆ†é…ç»™å¤šä¸ªå˜é‡ x, y, (z, w) = my_tuple # è¾“å‡ºå˜é‡å€¼ print(x) # è¾“å‡º 1 print(y) # è¾“å‡º 2 print(z) # è¾“å‡º 3 print(w) # è¾“å‡º 4 # å®šä¹‰ä¸€ä¸ªåµŒå¥—åˆ—è¡¨ my_list = [1, 2, [3, 4]] # å˜é‡è§£åŒ…ï¼Œå°†åˆ—è¡¨ä¸­çš„å€¼åˆ†é…ç»™å¤šä¸ªå˜é‡ x, y, [z, w] = my_list # è¾“å‡ºå˜é‡å€¼ print(x) # è¾“å‡º 1 print(y) # è¾“å‡º 2 print(z) # è¾“å‡º 3 print(w) # è¾“å‡º 4 ä½¿ç”¨å˜é‡è§£åŒ…è¯­æ³•è¿›è¡ŒåŠ¨æ€è§£åŒ…ã€‚åŠ¨æ€è§£åŒ…æ˜¯æŒ‡åœ¨è¿è¡Œæ—¶ç¡®å®šè¦è§£åŒ…çš„åºåˆ—æˆ–å…ƒç»„ï¼Œå¹¶å°†å…¶åˆ†é…ç»™å¤šä¸ªå˜é‡ã€‚\nè¿™é€šå¸¸æ¶‰åŠåˆ°ä½¿ç”¨å‡½æ•°æˆ–æ–¹æ³•è¿”å›çš„åºåˆ—æˆ–å…ƒç»„ï¼Œä»¥åŠä¸ç¡®å®šåºåˆ—æˆ–å…ƒç»„çš„é•¿åº¦çš„æƒ…å†µã€‚\nä½¿ç”¨ä¸€ä¸ªæ˜Ÿå·(*)ä½œä¸ºå˜é‡åç§°çš„å‰ç¼€å¯ä»¥æŒ‡å®šä¸€ä¸ªå˜é‡æ¥æ¥æ”¶é™¤äº†å·²åˆ†é…å˜é‡ä¹‹å¤–çš„æ‰€æœ‰å€¼ã€‚è¿™ä¸ªå˜é‡å°†æ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚\n# å®šä¹‰ä¸€ä¸ªå…ƒç»„ my_tuple = (1, 2, 3, 4, 5) # ä½¿ç”¨åŠ¨æ€è§£åŒ…ï¼Œå°†å…ƒç»„å‰ä¸¤ä¸ªå€¼åˆ†é…ç»™å˜é‡ x å’Œ yï¼Œåä¸¤ä¸ªå€¼åˆ†é…ç»™å˜é‡ a å’Œ bï¼Œå…¶ä»–å€¼åˆ†é…ç»™å˜é‡ rest x, y, *rest, a, b = my_tuple # è¾“å‡ºå˜é‡å€¼ print(x) # è¾“å‡º 1 print(y) # è¾“å‡º 2 print(rest) # è¾“å‡º [3, 4] print(a) # è¾“å‡º 5 print(b) # è¾“å‡º 6 å•ä¸‹åˆ’çº¿å˜é‡å åœ¨ Python ä¸­ï¼Œä»¥å•ä¸ªä¸‹åˆ’çº¿(_)å¼€å¤´çš„å˜é‡åé€šå¸¸è¡¨ç¤ºä¸€ä¸ªç§æœ‰å˜é‡æˆ–å ä½ç¬¦å˜é‡ã€‚\nç§æœ‰å˜é‡ï¼šåœ¨ Python ä¸­ï¼Œæ²¡æœ‰çœŸæ­£çš„ç§æœ‰å˜é‡ï¼Œä½†æ˜¯ä»¥å•ä¸ªä¸‹åˆ’çº¿å¼€å¤´çš„å˜é‡åé€šå¸¸è¢«è§†ä¸ºç§æœ‰å˜é‡ã€‚è¿™æ„å‘³ç€è¿™äº›å˜é‡ä¸åº”è¯¥åœ¨æ¨¡å—æˆ–ç±»çš„å¤–éƒ¨ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–æˆ–ä¸å†å­˜åœ¨ã€‚ä½†æ˜¯ï¼Œå®ƒä»¬ä»ç„¶å¯ä»¥åœ¨æ¨¡å—æˆ–ç±»çš„å†…éƒ¨ä½¿ç”¨ã€‚\nå ä½ç¬¦å˜é‡ï¼šæœ‰æ—¶å€™ï¼Œåœ¨ç¼–å†™ä»£ç æ—¶ï¼Œéœ€è¦ä½¿ç”¨ä¸€ä¸ªå˜é‡æ¥å æ®ä¸€ä¸ªä½ç½®ï¼Œä½†æ˜¯ä¸éœ€è¦å¼•ç”¨å˜é‡çš„å€¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ä»¥å•ä¸ªä¸‹åˆ’çº¿å¼€å¤´çš„å˜é‡åæ¥è¡¨ç¤ºä¸€ä¸ªå ä½ç¬¦å˜é‡ã€‚\n# å¿½ç•¥å±•å¼€æ—¶çš„ç¬¬äºŒä¸ªå˜é‡ x, _ = [1, 2] print(x, _) # è¾“å‡º 1 2 # ä½¿ç”¨å ä½ç¬¦å˜é‡ for _ in range(10): print(_) å¯å˜å’Œä¸å¯å˜å¯¹è±¡ åœ¨ Python ä¸­ï¼Œæœ‰äº›å¯¹è±¡æ˜¯å¯å˜çš„ï¼Œæœ‰äº›å¯¹è±¡æ˜¯ä¸å¯å˜çš„ã€‚å¯å˜å¯¹è±¡æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œè€Œä¸å¯å˜å¯¹è±¡æ˜¯ä¸èƒ½ä¿®æ”¹çš„ã€‚ä¾‹å¦‚ï¼Œæ•°å­—ã€å­—ç¬¦ä¸²å’Œå…ƒç»„æ˜¯ä¸å¯å˜çš„ï¼Œè€Œåˆ—è¡¨å’Œå­—å…¸æ˜¯å¯å˜çš„ã€‚\n# å¯å˜å¯¹è±¡ç¤ºä¾‹ my_list = [1, 2, 3] my_list.append(4) print(my_list) # è¾“å‡º [1, 2, 3, 4] # ä¸å¯å˜å¯¹è±¡ç¤ºä¾‹ my_string = \u0026#34;Hello\u0026#34; my_string += \u0026#34;, world!\u0026#34; print(my_string) # è¾“å‡º Hello, world! å¸¸é‡ åœ¨ Python ä¸­ï¼Œå¸¸é‡æ˜¯æŒ‡åœ¨ç¨‹åºä¸­å®šä¹‰çš„ä¸å¯å˜çš„å€¼ã€‚å¸¸é‡é€šå¸¸ç”¨å¤§å†™å­—æ¯è¡¨ç¤ºï¼Œä»¥ä¾¿ä¸å˜é‡åŒºåˆ†å¼€æ¥ã€‚Python ä¸­æ²¡æœ‰å†…ç½®çš„å¸¸é‡ç±»å‹ï¼Œä½†æ˜¯ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼å®šä¹‰å¸¸é‡ï¼š\nä½¿ç”¨æ™®é€šå˜é‡è¡¨ç¤ºå¸¸é‡ã€‚ä¾‹å¦‚ï¼š PI = 3.14159265358979323846 åœ¨ç¨‹åºä¸­ä½¿ç”¨ PI æ¥è¡¨ç¤ºåœ†å‘¨ç‡ï¼Œè¿™ä¸ªå€¼ä¸ä¼šè¢«ä¿®æ”¹ã€‚\nä½¿ç”¨æšä¸¾ç±»ï¼ˆEnumï¼‰è¡¨ç¤ºå¸¸é‡ã€‚æšä¸¾ç±»æ˜¯ Python ä¸­çš„ä¸€ç§ç‰¹æ®Šç±»å‹ï¼Œç”¨äºå®šä¹‰ä¸€ç»„æœ‰é™çš„å¸¸é‡ã€‚ä¾‹å¦‚ï¼š from enum import Enum class Color(Enum): RED = 1 GREEN = 2 BLUE = 3 åœ¨ç¨‹åºä¸­ä½¿ç”¨ Color.REDã€Color.GREEN å’Œ Color.BLUE æ¥è¡¨ç¤ºä¸‰ç§é¢œè‰²ï¼Œè¿™äº›å€¼ä¸ä¼šè¢«ä¿®æ”¹ã€‚\nå¸¸é‡æ˜¯ç¼–å†™å¯è¯»æ€§å¥½ã€æ˜“äºç†è§£å’Œç»´æŠ¤çš„ä»£ç çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚åœ¨ç¼–å†™ä»£ç æ—¶ï¼Œåº”è¯¥å°†å¸¸é‡å®šä¹‰ä¸ºä¸å¯å˜çš„å€¼ï¼Œå¹¶å°½å¯èƒ½ä½¿ç”¨å¸¸é‡æ¥è¡¨ç¤ºä¸å˜çš„æ•°æ®ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/05/23/python-comment-and-variable/","summary":"Python æ³¨é‡Šã€å˜é‡å’Œå¸¸é‡æ˜¯ç¼–å†™ Python ä»£ç æ—¶éå¸¸é‡è¦çš„æ¦‚å¿µï¼Œä¸‹é¢åˆ†åˆ«ä»‹ç»å®ƒä»¬çš„åŸºæœ¬ç”¨æ³•å’Œè¯­æ³•ã€‚\nHello World åˆ›å»ºä¸€ä¸ª 00_helloworld.py æ–‡ä»¶ï¼Œæ‰“å° hello worldï¼š\nprint(\u0026#34;Helloï¼ŒWorld!\u0026#34;) æ‰§è¡Œè¯¥æ–‡ä»¶ï¼Œä¼šè¾“å‡ºç»“æœï¼š\n$ python 00_helloworld.py Helloï¼ŒWorld! ä¸€èˆ¬åœ¨ python æ–‡ä»¶çš„å¼€å¤´ç¬¬ä¸€è¡Œï¼Œæˆ‘ä»¬éƒ½ä¼šçœ‹åˆ°ä¸‹é¢çš„ä»£ç è¡Œï¼š\n# python2 #!/usr/bin/env python # æˆ–è€… #!/usr/bin/python # python3 #!/usr/bin/env python3 # æˆ–è€… #!/usr/bin/python3 è¿™è¡Œä»£ç ç”¨æ¥æŒ‡å®šæœ¬è„šæœ¬ç”¨ä»€ä¹ˆè§£é‡Šå™¨æ¥æ‰§è¡Œã€‚\n#!/usr/bin/python æ˜¯å‘Šè¯‰æ“ä½œç³»ç»Ÿæ‰§è¡Œè¿™ä¸ªè„šæœ¬çš„æ—¶å€™ï¼Œè°ƒç”¨ /usr/bin ä¸‹çš„ python è§£é‡Šå™¨ã€‚\n#!/usr/bin/env python è¿™ç§ç”¨æ³•æ˜¯ä¸ºäº†é˜²æ­¢æ“ä½œç³»ç»Ÿç”¨æˆ·æ²¡æœ‰å°† python è£…åœ¨é»˜è®¤çš„ /usr/bin è·¯å¾„é‡Œã€‚å½“ç³»ç»Ÿçœ‹åˆ°è¿™ä¸€è¡Œçš„æ—¶å€™ï¼Œé¦–å…ˆä¼šåˆ° env è®¾ç½®é‡ŒæŸ¥æ‰¾ python çš„å®‰è£…è·¯å¾„ï¼Œå†è°ƒç”¨å¯¹åº”è·¯å¾„ä¸‹çš„è§£é‡Šå™¨ç¨‹åºå®Œæˆæ“ä½œã€‚ä¸ºäº†å¢å¼ºä»£ç çš„å¯ç§»æ¤æ€§ï¼Œæ¨èè¿™ç§å†™æ³•ã€‚\nåœ¨ 00_helloworld.py æ·»åŠ è¿™è¡Œä»£ç ï¼š\n#!/usr/bin/env python print(\u0026#34;Helloï¼ŒWorld!\u0026#34;) ç„¶åï¼Œä¿®æ”¹è¯¥æ–‡ä»¶ä¸ºå¯æ‰§è¡Œå±æ€§ï¼š\nchmod +x 00_helloworld.py å°±å¯ä»¥è¿™æ ·æ‰§è¡Œï¼š\n. 00_helloworld.py ç¼–ç æ ¼å¼ Python3 é»˜è®¤çš„ç¼–ç æ ¼å¼æ˜¯ UTF-8ï¼ˆUnicode Transformation Format - 8 bitï¼‰ã€‚è¿™æ˜¯ä¸€ç§é€šç”¨çš„å­—ç¬¦ç¼–ç ï¼Œæ”¯æŒå‡ ä¹æ‰€æœ‰çš„å­—ç¬¦é›†ï¼ŒåŒ…æ‹¬ ASCIIã€Latinã€ä¸­æ–‡ã€æ—¥æ–‡ã€éŸ©æ–‡ç­‰ã€‚\nåœ¨ Python 3.x ä¸­ï¼Œæ‰€æœ‰çš„å­—ç¬¦ä¸²éƒ½æ˜¯ä»¥ Unicode ç¼–ç å­˜å‚¨çš„ã€‚å½“ä½ åœ¨ Python ä¸­åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»»ä½• Unicode å­—ç¬¦ï¼Œè€Œä¸å¿…æ‹…å¿ƒç¼–ç é—®é¢˜ã€‚\nå½“ä½ æ‰“å¼€ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶æ—¶ï¼ŒPython ä¼šè‡ªåŠ¨å°è¯•ä½¿ç”¨ UTF-8 ç¼–ç æ¥è§£ææ–‡ä»¶å†…å®¹ã€‚å¦‚æœæ–‡ä»¶ä½¿ç”¨å…¶ä»–ç¼–ç æ ¼å¼ï¼Œä½ éœ€è¦ä½¿ç”¨ç›¸åº”çš„ç¼–ç æ ¼å¼æ¥æ‰“å¼€æ–‡ä»¶ï¼Œæˆ–è€…åœ¨è¯»å–æ–‡ä»¶å†…å®¹åå°†å…¶è§£ç ä¸º Unicodeã€‚\nåœ¨ Python ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ç¼–ç å£°æ˜ï¼ˆcoding declarationï¼‰æ¥æŒ‡å®šæ–‡ä»¶çš„ç¼–ç æ ¼å¼ã€‚ç¼–ç å£°æ˜æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ³¨é‡Šï¼Œå‡ºç°åœ¨ Python æ–‡ä»¶çš„ç¬¬ä¸€è¡Œæˆ–ç¬¬äºŒè¡Œï¼ˆå¦‚æœæ–‡ä»¶çš„ç¬¬ä¸€è¡Œæ˜¯ shebangï¼Œåˆ™ç¼–ç å£°æ˜å¿…é¡»å‡ºç°åœ¨ç¬¬äºŒè¡Œï¼‰ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š\n# -*- coding: encoding -*- # æˆ–è€… # coding=utf-8 å…¶ä¸­ï¼Œencoding æ˜¯æ–‡ä»¶çš„ç¼–ç æ ¼å¼ï¼Œå¯ä»¥æ˜¯ UTF-8ã€ISO-8859-1 æˆ–å…¶ä»–ç¼–ç æ ¼å¼çš„åç§°ã€‚ç¼–ç å£°æ˜å‘Šè¯‰ Python è§£é‡Šå™¨åº”è¯¥ä½¿ç”¨æŒ‡å®šçš„ç¼–ç æ ¼å¼æ¥è§£æè¯¥æ–‡ä»¶ä¸­çš„æ–‡æœ¬å†…å®¹ã€‚å¦‚æœæ²¡æœ‰ç¼–ç å£°æ˜ï¼ŒPython3 é»˜è®¤ä½¿ç”¨ UTF-8 ç¼–ç æ¥è§£ææ–‡ä»¶å†…å®¹ã€‚","title":"Pythonå­¦ä¹ 1ï¼šæ³¨é‡Šã€å˜é‡å’Œå¸¸é‡"},{"content":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬ä¸‰ç« ã€Šå¯¹è±¡çš„é€šç”¨æ–¹æ³•ã€‹çš„å­¦ä¹ ç¬”è®°ï¼šå½“è¦†ç›– equals æ–¹æ³•æ—¶ï¼Œæ€»è¦è¦†ç›– hashCode æ–¹æ³•ã€‚\nä»‹ç» åœ¨è¦†ç›–äº† equals æ–¹æ³•çš„ç±»ä¸­ï¼Œå¿…é¡»è¦†ç›– hashCode æ–¹æ³•ã€‚ å¦‚æœä½ æ²¡æœ‰è¿™æ ·åšï¼Œè¯¥ç±»å°†è¿å hashCode æ–¹æ³•çš„ä¸€èˆ¬çº¦å®šï¼Œè¿™å°†é˜»æ­¢è¯¥ç±»åœ¨ HashMap å’Œ HashSet ç­‰é›†åˆä¸­æ­£å¸¸è¿è¡Œã€‚ä»¥ä¸‹æ˜¯æ ¹æ® Object è§„èŒƒä¿®æ”¹çš„çº¦å®šï¼š\nåº”ç”¨ç¨‹åºæ‰§è¡ŒæœŸé—´å¯¹å¯¹è±¡é‡å¤è°ƒç”¨ hashCode æ–¹æ³•æ—¶ï¼Œå®ƒå¿…é¡»ä¸€è‡´åœ°è¿”å›ç›¸åŒçš„å€¼ï¼Œå‰ææ˜¯ä¸å¯¹ equals æ–¹æ³•ä¸­ç”¨äºæ¯”è¾ƒçš„ä¿¡æ¯è¿›è¡Œä¿®æ”¹ã€‚è¿™ä¸ªå€¼ä¸éœ€è¦åœ¨åº”ç”¨ç¨‹åºçš„ä¸åŒæ‰§è¡Œä¹‹é—´ä¿æŒä¸€è‡´ã€‚ å¦‚æœæ ¹æ® equals(Object) æ–¹æ³•åˆ¤æ–­å‡ºä¸¤ä¸ªå¯¹è±¡æ˜¯ç›¸ç­‰çš„ï¼Œé‚£ä¹ˆåœ¨ä¸¤ä¸ªå¯¹è±¡ä¸Šè°ƒç”¨ hashCode æ–¹æ³•å¿…é¡»äº§ç”Ÿç›¸åŒçš„æ•´æ•°ç»“æœã€‚ å¦‚æœæ ¹æ® equals(Object) æ–¹æ³•åˆ¤æ–­å‡ºä¸¤ä¸ªå¯¹è±¡ä¸ç›¸ç­‰ï¼Œåˆ™ä¸éœ€è¦åœ¨æ¯ä¸ªå¯¹è±¡ä¸Šè°ƒç”¨ hashCode æ–¹æ³•æ—¶å¿…é¡»äº§ç”Ÿä¸åŒçš„ç»“æœã€‚ä½†æ˜¯ï¼Œç¨‹åºå‘˜åº”è¯¥çŸ¥é“ï¼Œä¸ºä¸ç›¸ç­‰çš„å¯¹è±¡ç”Ÿæˆä¸åŒçš„ç»“æœå¯èƒ½ä¼šæé«˜æ•£åˆ—è¡¨çš„æ€§èƒ½ã€‚\nå½“ä½ æ— æ³•è¦†ç›– hashCode æ–¹æ³•æ—¶ï¼Œå°†è¿åç¬¬äºŒä¸ªå…³é”®æ¡æ¬¾ï¼šç›¸ç­‰çš„å¯¹è±¡å¿…é¡»å…·æœ‰ç›¸ç­‰çš„æ•£åˆ—ç ã€‚ æ ¹æ®ç±»çš„ equals æ–¹æ³•ï¼Œä¸¤ä¸ªä¸åŒçš„å®ä¾‹åœ¨é€»è¾‘ä¸Šå¯èƒ½æ˜¯ç›¸ç­‰çš„ï¼Œä½†æ˜¯å¯¹äºå¯¹è±¡çš„ hashCode æ–¹æ³•æ¥è¯´ï¼Œå®ƒä»¬åªæ˜¯ä¸¤ä¸ªæ²¡æœ‰å…±åŒä¹‹å¤„çš„å¯¹è±¡ã€‚å› æ­¤ï¼ŒObject çš„ hashCode æ–¹æ³•è¿”å›ä¸¤ä¸ªçœ‹ä¼¼éšæœºçš„æ•°å­—ï¼Œè€Œä¸æ˜¯çº¦å®šè¦æ±‚çš„ä¸¤ä¸ªç›¸ç­‰çš„æ•°å­—ã€‚ä¾‹å¦‚ï¼š\nMap\u0026lt;PhoneNumber, String\u0026gt; m = new HashMap\u0026lt;\u0026gt;(); m.put(new PhoneNumber(707, 867, 5309), \u0026#34;Jenny\u0026#34;); æ­¤æ—¶ï¼Œä½ å¯èƒ½æœŸæœ› m.get(new PhoneNumber(707, 867,5309)) è¿”å›ã€ŒJennyã€ï¼Œä½†æ˜¯å®ƒè¿”å› nullã€‚æ³¨æ„ï¼Œè¿™é‡Œæ¶‰åŠåˆ°ä¸¤ä¸ª PhoneNumber å®ä¾‹ï¼šä¸€ä¸ªç”¨äºæ’å…¥åˆ° HashMap ä¸­ï¼Œå¦ä¸€ä¸ªç›¸ç­‰çš„å®ä¾‹ï¼ˆè¢«è¯•å›¾ï¼‰ç”¨äºæ£€ç´¢ã€‚ç”±äº PhoneNumber ç±»æœªèƒ½è¦†ç›– hashCode æ–¹æ³•ï¼Œå¯¼è‡´ä¸¤ä¸ªç›¸ç­‰çš„å®ä¾‹å…·æœ‰ä¸ç›¸ç­‰çš„æ•£åˆ—ç ï¼Œè¿™è¿åäº† hashCode æ–¹æ³•çº¦å®šã€‚å› æ­¤ï¼Œget æ–¹æ³•æŸ¥æ‰¾ç”µè¯å·ç çš„æ•£åˆ—æ¡¶å¯èƒ½ä¼šä¸ put æ–¹æ³•å­˜å‚¨ç”µè¯å·ç çš„æ•£åˆ—æ¡¶ä¸åŒã€‚å³ä½¿è¿™ä¸¤ä¸ªå®ä¾‹ç¢°å·§åˆ†é…åœ¨åŒä¸€ä¸ªæ•£åˆ—æ¡¶ä¸Šï¼Œget æ–¹æ³•å‡ ä¹è‚¯å®šä¼šè¿”å› nullï¼Œå› ä¸º HashMap æœ‰ä¸€ä¸ªä¼˜åŒ–ï¼Œå®ƒç¼“å­˜æ¯ä¸ªæ¡ç›®ç›¸å…³è”çš„æ•£åˆ—ç ï¼Œå¦‚æœæ•£åˆ—ç ä¸åŒ¹é…ï¼Œå°±ä¸ä¼šæ£€æŸ¥å¯¹è±¡æ˜¯å¦ç›¸ç­‰ã€‚\nè§£å†³è¿™ä¸ªé—®é¢˜å°±åƒä¸º PhoneNumber ç¼–å†™ä¸€ä¸ªæ­£ç¡®çš„ hashCode æ–¹æ³•ä¸€æ ·ç®€å•ã€‚é‚£ä¹ˆ hashCode æ–¹æ³•åº”è¯¥æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿå†™ä¸€ä¸ªåé¢ä¾‹å­å¾ˆå®¹æ˜“ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹æ–¹æ³•æ˜¯åˆæ³•çš„ï¼Œä½†æ˜¯ä¸åº”è¯¥è¢«ä½¿ç”¨ï¼š\n// The worst possible legal hashCode implementation - never use! @Override public int hashCode() { return 42; } å®ƒæ˜¯åˆæ³•çš„ï¼Œå› ä¸ºå®ƒç¡®ä¿äº†ç›¸ç­‰çš„å¯¹è±¡å…·æœ‰ç›¸åŒçš„æ•£åˆ—ç ã€‚åŒæ—¶å®ƒä¹Ÿå¾ˆç³Ÿç³•ï¼Œå› ä¸ºå®ƒä½¿æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ç›¸åŒçš„æ•£åˆ—ç ã€‚å› æ­¤ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½åˆ†é…åˆ°åŒä¸€ä¸ªæ¡¶ä¸­ï¼Œæ•£åˆ—è¡¨é€€åŒ–ä¸ºé“¾è¡¨ã€‚è¿™æ ·ï¼ŒåŸæœ¬åº”è¯¥åœ¨çº¿æ€§é˜¶ O(n) è¿è¡Œçš„ç¨‹åºå°†åœ¨å¹³æ–¹é˜¶ O(n^2) è¿è¡Œã€‚å¯¹äºå¤§å‹æ•£åˆ—è¡¨ï¼Œè¿™æ˜¯å·¥ä½œå’Œä¸å·¥ä½œçš„åŒºåˆ«ã€‚\nä¸€ä¸ªå¥½çš„æ•£åˆ—ç®—æ³•å€¾å‘äºä¸ºä¸ç›¸ç­‰çš„å®ä¾‹ç”Ÿæˆä¸ç›¸ç­‰çš„æ•£åˆ—ç ã€‚è¿™æ­£æ˜¯ hashCode æ–¹æ³•çº¦å®šç¬¬ä¸‰éƒ¨åˆ†çš„å«ä¹‰ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæ•£åˆ—ç®—æ³•åº”è¯¥åœ¨æ‰€æœ‰ int å€¼ä¸Šå‡åŒ€åˆç†åˆ†å¸ƒæ‰€æœ‰ä¸ç›¸ç­‰å®ä¾‹é›†åˆã€‚å®ç°è¿™ä¸ªç†æƒ³æ˜¯å¾ˆå›°éš¾çš„ã€‚å¹¸è¿çš„æ˜¯ï¼Œå®ç°ä¸€ä¸ªç±»ä¼¼çš„å¹¶ä¸å¤ªéš¾ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªç®€å•çš„æ–¹å¼ï¼š\n1ã€å£°æ˜ä¸€ä¸ªåä¸º result çš„ int å˜é‡ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºå¯¹è±¡ä¸­ç¬¬ä¸€ä¸ªé‡è¦å­—æ®µçš„æ•£åˆ—ç  cï¼Œå¦‚æ­¥éª¤ 2.a ä¸­è®¡ç®—çš„é‚£æ ·ã€‚ï¼ˆå›æƒ³ä¸€ä¸‹ Item-10 ä¸­çš„é‡è¦å­—æ®µä¼šå¯¹æ¯”è¾ƒäº§ç”Ÿå½±å“ï¼‰\n2ã€å¯¹è±¡ä¸­å‰©ä½™çš„é‡è¦å­—æ®µ fï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š\nä¸ºå­—æ®µè®¡ç®—ä¸€ä¸ªæ•´æ•°æ•£åˆ—ç  cï¼š\nå¦‚æœå­—æ®µæ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œè®¡ç®— Type.hashCode(f)ï¼Œå…¶ä¸­ type æ˜¯ä¸ f ç±»å‹å¯¹åº”çš„åŒ…è£…ç±»ã€‚ å¦‚æœå­—æ®µæ˜¯å¯¹è±¡å¼•ç”¨ï¼Œå¹¶ä¸”è¯¥ç±»çš„ equals æ–¹æ³•é€šè¿‡é€’å½’è°ƒç”¨ equals æ–¹æ³•æ¥æ¯”è¾ƒå­—æ®µï¼Œåˆ™é€’å½’è°ƒç”¨å­—æ®µä¸Šçš„ hashCode æ–¹æ³•ã€‚å¦‚æœéœ€è¦æ›´å¤æ‚çš„æ¯”è¾ƒï¼Œåˆ™ä¸ºè¯¥å­—æ®µè®¡ç®—ä¸€ä¸ªã€Œcanonical representationã€ï¼Œå¹¶åœ¨ canonical representation ä¸Šè°ƒç”¨ hashCode æ–¹æ³•ã€‚å¦‚æœå­—æ®µçš„å€¼ä¸ºç©ºï¼Œåˆ™ä½¿ç”¨ 0ï¼ˆæˆ–å…¶ä»–å¸¸æ•°ï¼Œä½† 0 æ˜¯æƒ¯ç”¨çš„ï¼‰ã€‚ å¦‚æœå­—æ®µæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œåˆ™å°†å…¶æ¯ä¸ªé‡è¦å…ƒç´ éƒ½è§†ä¸ºä¸€ä¸ªå•ç‹¬çš„å­—æ®µã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡é€’å½’åœ°åº”ç”¨è¿™äº›è§„åˆ™è®¡ç®—æ¯ä¸ªé‡è¦å…ƒç´ çš„æ•£åˆ—ç ï¼Œå¹¶å°†æ¯ä¸ªæ­¥éª¤ 2.b çš„å€¼ç»„åˆèµ·æ¥ã€‚å¦‚æœæ•°ç»„ä¸­æ²¡æœ‰é‡è¦å…ƒç´ ï¼Œåˆ™ä½¿ç”¨å¸¸é‡ï¼Œæœ€å¥½ä¸æ˜¯ 0ã€‚å¦‚æœæ‰€æœ‰å…ƒç´ éƒ½å¾ˆé‡è¦ï¼Œé‚£ä¹ˆä½¿ç”¨ Arrays.hashCodeã€‚ å°†æ­¥éª¤ 2.a ä¸­è®¡ç®—çš„æ•£åˆ—ç  c åˆå¹¶åˆ° result å˜é‡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nresult = 31 * result + c; 3ã€è¿”å› result å˜é‡ã€‚\nå½“ä½ å®Œæˆäº† hashCode æ–¹æ³•çš„ç¼–å†™ä¹‹åï¼Œé—®é—®è‡ªå·±ç°åœ¨ç›¸åŒçš„å®ä¾‹æ˜¯å¦å…·æœ‰ç›¸åŒçš„æ•£åˆ—ç ã€‚ç¼–å†™å•å…ƒæµ‹è¯•æ¥éªŒè¯ä½ çš„ç›´è§‰ï¼ˆé™¤éä½ ä½¿ç”¨ AutoValue ç”Ÿæˆä½ çš„ equals æ–¹æ³•å’Œ hashCode æ–¹æ³•ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä½ å¯ä»¥å®‰å…¨åœ°çœç•¥è¿™äº›æµ‹è¯•ï¼‰ã€‚å¦‚æœç›¸åŒçš„å®ä¾‹æœ‰ä¸ç›¸ç­‰çš„æ•£åˆ—ç ï¼Œæ‰¾å‡ºåŸå› å¹¶ä¿®å¤é—®é¢˜ã€‚\nå¯ä»¥ä»æ•£åˆ—ç è®¡ç®—ä¸­æ’é™¤æ´¾ç”Ÿå­—æ®µã€‚æ¢å¥è¯è¯´ï¼Œä½ å¯ä»¥å¿½ç•¥ä»»ä½•å¯ä»¥ä»åŒ…å«çš„å­—æ®µè®¡ç®—å…¶å€¼çš„å­—æ®µã€‚ä½ å¿…é¡»æ’é™¤ä¸ç”¨ equals æ¯”è¾ƒçš„ä»»ä½•å­—æ®µï¼Œå¦åˆ™ä½ å¯èƒ½ä¼šè¿å hashCode æ–¹æ³•çº¦å®šçš„ç¬¬äºŒä¸ªæ¡æ¬¾ã€‚\nåœ¨æ­¥éª¤ 2.b ä¸­ä½¿ç”¨çš„ä¹˜æ³•å°†ä½¿ç»“æœå–å†³äºå­—æ®µçš„é¡ºåºï¼Œå¦‚æœç±»æœ‰å¤šä¸ªç›¸ä¼¼çš„å­—æ®µï¼Œåˆ™ä¼šäº§ç”Ÿä¸€ä¸ªæ›´å¥½çš„æ•£åˆ—ç®—æ³•ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå­—ç¬¦ä¸²æ•£åˆ—ç®—æ³•ä¸­çœç•¥äº†ä¹˜æ³•ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„å­—æ¯é¡ºåºéƒ½æœ‰ç›¸åŒçš„æ•£åˆ—ç ã€‚é€‰æ‹© 31 æ˜¯å› ä¸ºå®ƒæ˜¯å¥‡ç´ æ•°ã€‚å¦‚æœæ˜¯å¶æ•°ï¼Œä¹˜æ³•è¿ç®—å°±ä¼šæº¢å‡ºï¼Œä¿¡æ¯å°±ä¼šä¸¢å¤±ï¼Œå› ä¸ºä¹˜æ³•è¿ç®—ç­‰åŒäºç§»ä½ã€‚ä½¿ç”¨ç´ æ•°çš„å¥½å¤„ä¸å¤ªæ˜æ˜¾ï¼Œä½†å®ƒæ˜¯ä¼ ç»Ÿç”¨æ³•ã€‚31 æœ‰ä¸€ä¸ªå¾ˆå¥½çš„ç‰¹æ€§ï¼Œå¯ä»¥ç”¨ç§»ä½å’Œå‡æ³•æ¥ä»£æ›¿ä¹˜æ³•ï¼Œä»è€Œåœ¨æŸäº›ä½“ç³»ç»“æ„ä¸Šè·å¾—æ›´å¥½çš„æ€§èƒ½ï¼š31 * i == (i \u0026lt;\u0026lt;5) â€“ iã€‚ç°ä»£è™šæ‹Ÿæœºè‡ªåŠ¨è¿›è¡Œè¿™ç§ä¼˜åŒ–ã€‚\nè®©æˆ‘ä»¬å°†å‰é¢çš„æ–¹æ³•åº”ç”¨åˆ° PhoneNumber ç±»ï¼š\n// Typical hashCode method @Override public int hashCode() { int result = Short.hashCode(areaCode); result = 31 * result + Short.hashCode(prefix); result = 31 * result + Short.hashCode(lineNum); return result; } å› ä¸ºè¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªç®€å•çš„ç¡®å®šçš„è®¡ç®—ç»“æœï¼Œå®ƒçš„å”¯ä¸€è¾“å…¥æ˜¯ PhoneNumber å®ä¾‹ä¸­çš„ä¸‰ä¸ªé‡è¦å­—æ®µï¼Œæ‰€ä»¥å¾ˆæ˜æ˜¾ï¼Œç›¸ç­‰çš„ PhoneNumber å®ä¾‹å…·æœ‰ç›¸ç­‰çš„æ•£åˆ—ç ã€‚å®é™…ä¸Šï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ PhoneNumber çš„ä¸€ä¸ªéå¸¸å¥½çš„ hashCode æ–¹æ³•å®ç°ï¼Œä¸ Java åº“ä¸­çš„ hashCode æ–¹æ³•å®ç°ç›¸å½“ã€‚å®ƒå¾ˆç®€å•ï¼Œé€Ÿåº¦ä¹Ÿç›¸å½“å¿«ï¼Œå¹¶ä¸”åˆç†åœ°å°†ä¸ç›¸ç­‰çš„ç”µè¯å·ç åˆ†æ•£åˆ°ä¸åŒçš„æ•£åˆ—æ¡¶ä¸­ã€‚\nè™½ç„¶æœ¬æ¡ç›®ä¸­çš„æ–¹æ³•äº§ç”Ÿäº†ç›¸å½“ä¸é”™çš„æ•£åˆ—ç®—æ³•ï¼Œä½†å®ƒä»¬å¹¶ä¸æ˜¯æœ€å…ˆè¿›çš„ã€‚å®ƒä»¬çš„è´¨é‡å¯ä¸ Java åº“çš„å€¼ç±»å‹ä¸­çš„æ•£åˆ—ç®—æ³•ç›¸åª²ç¾ï¼Œå¯¹äºå¤§å¤šæ•°ç”¨é€”æ¥è¯´éƒ½æ˜¯è¶³å¤Ÿçš„ã€‚å¦‚æœä½ ç¡®å®éœ€è¦ä¸å¤ªå¯èƒ½äº§ç”Ÿå†²çªçš„æ•£åˆ—ç®—æ³•ï¼Œè¯·å‚é˜… Guava çš„ com.google.common.hash.Hashing [Guava]ã€‚\nObjects ç±»æœ‰ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œå®ƒæ¥å—ä»»æ„æ•°é‡çš„å¯¹è±¡å¹¶è¿”å›å®ƒä»¬çš„æ•£åˆ—ç ã€‚è¿™ä¸ªåä¸º hash çš„æ–¹æ³•å…è®¸ä½ ç¼–å†™åªæœ‰ä¸€è¡Œä»£ç çš„ hashCode æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•çš„è´¨é‡å¯ä»¥ä¸æœ¬æ¡ç›®ä¸­æä¾›çš„ç¼–å†™æ–¹æ³•åª²ç¾ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå®ƒä»¬è¿è¡Œå¾—æ›´æ…¢ï¼Œå› ä¸ºå®ƒä»¬éœ€è¦åˆ›å»ºæ•°ç»„æ¥ä¼ é€’å¯å˜æ•°é‡çš„å‚æ•°ï¼Œå¦‚æœä»»ä½•å‚æ•°æ˜¯åŸå§‹ç±»å‹çš„ï¼Œåˆ™éœ€è¦è¿›è¡Œè£…ç®±å’Œæ‹†ç®±ã€‚æ¨èåªåœ¨æ€§èƒ½ä¸é‡è¦çš„æƒ…å†µä¸‹ä½¿ç”¨è¿™ç§æ•£åˆ—ç®—æ³•ã€‚ä¸‹é¢æ˜¯ä½¿ç”¨è¿™ç§æŠ€æœ¯ç¼–å†™çš„ PhoneNumber çš„æ•£åˆ—ç®—æ³•ï¼š\n// One-line hashCode method - mediocre performance @Override public int hashCode() { return Objects.hash(lineNum, prefix, areaCode); } å¦‚æœä¸€ä¸ªç±»æ˜¯ä¸å¯å˜çš„ï¼Œå¹¶ä¸”è®¡ç®—æ•£åˆ—ç çš„æˆæœ¬éå¸¸é«˜ï¼Œé‚£ä¹ˆä½ å¯ä»¥è€ƒè™‘åœ¨å¯¹è±¡ä¸­ç¼“å­˜æ•£åˆ—ç ï¼Œè€Œä¸æ˜¯åœ¨æ¯æ¬¡è¯·æ±‚æ—¶é‡æ–°è®¡ç®—å®ƒã€‚å¦‚æœä½ è®¤ä¸ºè¿™ç§ç±»å‹çš„å¤§å¤šæ•°å¯¹è±¡éƒ½å°†ç”¨ä½œæ•£åˆ—é”®ï¼Œé‚£ä¹ˆä½ åº”è¯¥åœ¨åˆ›å»ºå®ä¾‹æ—¶è®¡ç®—æ•£åˆ—ç ã€‚å¦åˆ™ï¼Œä½ å¯ä»¥é€‰æ‹©åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨ hashCode æ–¹æ³•æ—¶å»¶è¿Ÿåˆå§‹åŒ–æ•£åˆ—ç ã€‚åœ¨ä¸€ä¸ªå»¶è¿Ÿåˆå§‹åŒ–çš„å­—æ®µçš„æƒ…å†µä¸‹ï¼Œéœ€è¦æ³¨æ„ä»¥ç¡®ä¿è¯¥ç±»ä»ç„¶æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚æˆ‘ä»¬çš„ PhoneNumber ç±»ä¸å€¼å¾—è¿›è¡Œè¿™ç§å¤„ç†ï¼Œä½†åªæ˜¯ä¸ºäº†å‘ä½ å±•ç¤ºå®ƒæ˜¯å¦‚ä½•å®ç°çš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚æ³¨æ„ï¼Œæ•£åˆ—å­—æ®µçš„åˆå§‹å€¼ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º 0ï¼‰ä¸åº”è¯¥æ˜¯é€šå¸¸åˆ›å»ºçš„å®ä¾‹çš„æ•£åˆ—ç ï¼š\n// hashCode method with lazily initialized cached hash code private int hashCode; // Automatically initialized to 0 @Override public int hashCode() { int result = hashCode; if (result == 0) { result = Short.hashCode(areaCode); result = 31 * result + Short.hashCode(prefix); result = 31 * result + Short.hashCode(lineNum); hashCode = result; } return result; } ä¸è¦è¯•å›¾ä»æ•£åˆ—ç è®¡ç®—ä¸­æ’é™¤é‡è¦å­—æ®µï¼Œä»¥æé«˜æ€§èƒ½ã€‚ è™½ç„¶å¾—åˆ°çš„æ•£åˆ—ç®—æ³•å¯èƒ½è¿è¡Œå¾—æ›´å¿«ï¼Œä½†å…¶ç³Ÿç³•çš„è´¨é‡å¯èƒ½ä¼šå°†æ•£åˆ—è¡¨çš„æ€§èƒ½é™ä½åˆ°æ— æ³•ä½¿ç”¨çš„ç¨‹åº¦ã€‚ç‰¹åˆ«æ˜¯ï¼Œæ•£åˆ—ç®—æ³•å¯èƒ½ä¼šé‡åˆ°å¤§é‡å®ä¾‹ï¼Œè¿™äº›å®ä¾‹åœ¨ä½ é€‰æ‹©å¿½ç•¥çš„ä¸åŒåŒºåŸŸã€‚å¦‚æœå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œæ•£åˆ—ç®—æ³•å°†æŠŠæ‰€æœ‰è¿™äº›å®ä¾‹æ˜ å°„å¾ˆå°‘ä¸€éƒ¨åˆ†æ•£åˆ—ç ï¼Œä½¿å¾—åŸæœ¬åº”è¯¥åœ¨çº¿æ€§é˜¶ O(n) è¿è¡Œçš„ç¨‹åºå°†åœ¨å¹³æ–¹é˜¶ O(n^2) è¿è¡Œã€‚\nè¿™ä¸ä»…ä»…æ˜¯ä¸€ä¸ªç†è®ºé—®é¢˜ã€‚åœ¨ Java 2 ä¹‹å‰ï¼Œå­—ç¬¦ä¸²æ•£åˆ—ç®—æ³•åœ¨å­—ç¬¦ä¸²ä¸­ï¼Œä»¥ç¬¬ä¸€ä¸ªå­—ç¬¦å¼€å§‹ï¼Œæœ€å¤šä½¿ç”¨ 16 ä¸ªå­—ç¬¦ã€‚å¯¹äºå¤§é‡ä¸”åˆ†å±‚æ¬¡çš„é›†åˆï¼ˆå¦‚ urlï¼‰ï¼Œè¯¥å‡½æ•°å®Œå…¨å±•ç¤ºäº†å‰é¢æè¿°çš„ç—…æ€è¡Œä¸ºã€‚\nä¸è¦ä¸º hashCode è¿”å›çš„å€¼æä¾›è¯¦ç»†çš„è§„èŒƒï¼Œè¿™æ ·å®¢æˆ·ç«¯å°±ä¸èƒ½ç†æ‰€åº”å½“çš„ä¾èµ–å®ƒã€‚è¿™ï¼ˆä¹Ÿï¼‰ç»™äº†ä½ æ›´æ”¹å®ƒçš„ä½™åœ°ã€‚ Java åº“ä¸­çš„è®¸å¤šç±»ï¼Œä¾‹å¦‚ String å’Œ Integerï¼Œéƒ½å°† hashCode æ–¹æ³•è¿”å›çš„ç¡®åˆ‡å€¼æŒ‡å®šä¸ºå®ä¾‹å€¼çš„å‡½æ•°ã€‚è¿™ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œè€Œæ˜¯ä¸€ä¸ªæˆ‘ä»¬ä¸å¾—ä¸é¢å¯¹çš„é”™è¯¯ï¼šå®ƒé˜»ç¢äº†åœ¨æœªæ¥ç‰ˆæœ¬ä¸­æé«˜æ•£åˆ—ç®—æ³•çš„èƒ½åŠ›ã€‚å¦‚æœä½ ä¿ç•™äº†æœªæŒ‡å®šçš„ç»†èŠ‚ï¼Œå¹¶ä¸”åœ¨æ•£åˆ—ç®—æ³•ä¸­å‘ç°äº†ç¼ºé™·ï¼Œæˆ–è€…å‘ç°äº†æ›´å¥½çš„æ•£åˆ—ç®—æ³•ï¼Œé‚£ä¹ˆä½ å¯ä»¥åœ¨åç»­ç‰ˆæœ¬ä¸­æ›´æ”¹å®ƒã€‚\næ€»ä¹‹ï¼Œæ¯æ¬¡è¦†ç›– equals æ–¹æ³•æ—¶éƒ½å¿…é¡»è¦†ç›– hashCode æ–¹æ³•ï¼Œå¦åˆ™ç¨‹åºå°†æ— æ³•æ­£ç¡®è¿è¡Œã€‚ä½ çš„ hashCode æ–¹æ³•å¿…é¡»éµå®ˆ Object ä¸­æŒ‡å®šçš„é€šç”¨çº¦å®šï¼Œå¹¶ä¸”å¿…é¡»åˆç†åœ°å°†ä¸ç›¸ç­‰çš„æ•£åˆ—ç åˆ†é…ç»™ä¸ç›¸ç­‰çš„å®ä¾‹ã€‚è¿™å¾ˆå®¹æ˜“å®ç°ï¼Œå¦‚æœæœ‰ç‚¹æ¯ç‡¥ï¼Œå¯ä½¿ç”¨ç¬¬ 51 é¡µçš„æ–¹æ³•ã€‚AutoValue æ¡†æ¶æä¾›äº†ä¸€ç§èƒ½å¾ˆå¥½çš„æ›¿ä»£æ‰‹åŠ¨ç¼–å†™ equals æ–¹æ³•å’Œ hashCode æ–¹æ³•çš„åŠŸèƒ½ï¼ŒIDE ä¹Ÿæä¾›äº†è¿™ç§åŠŸèƒ½ã€‚\næ€»ç»“ åœ¨ã€ŠEffective Java 3ã€‹ç¬¬ä¸‰ç« ã€Šå¯¹è±¡çš„é€šç”¨æ–¹æ³•ã€‹ä¸­ï¼Œç¡®å®æåˆ°äº†ä¸€ä¸ªé‡è¦çš„åŸåˆ™ï¼Œå³åœ¨è¦†ç›– equals æ–¹æ³•æ—¶ï¼Œæ€»è¦è¦†ç›– hashCode æ–¹æ³•ã€‚\nè¿™æ˜¯å› ä¸ºï¼Œå¦‚æœä¸¤ä¸ªå¯¹è±¡åœ¨ equals æ–¹æ³•ä¸­è¢«è®¤ä¸ºæ˜¯ç›¸ç­‰çš„ï¼Œé‚£ä¹ˆå®ƒä»¬çš„ hashCode æ–¹æ³•ä¹Ÿå¿…é¡»è¿”å›ç›¸åŒçš„å€¼ã€‚è¿™æ˜¯å› ä¸ºåœ¨ Java ä¸­ï¼Œå¦‚æœä¸¤ä¸ªå¯¹è±¡çš„ hashCode ä¸åŒï¼Œåˆ™å®ƒä»¬å°†è¢«è®¤ä¸ºæ˜¯ä¸åŒçš„å¯¹è±¡ï¼Œå³ä½¿å®ƒä»¬åœ¨ equals æ–¹æ³•ä¸­è¢«è®¤ä¸ºæ˜¯ç›¸ç­‰çš„ã€‚\nå› æ­¤ï¼Œå¦‚æœä¸è¦†ç›– hashCode æ–¹æ³•ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå¯¼è‡´åœ¨ä½¿ç”¨å“ˆå¸Œè¡¨ã€å“ˆå¸Œé›†åˆæˆ–å“ˆå¸Œæ˜ å°„ç­‰æ•°æ®ç»“æ„æ—¶å‡ºç°é—®é¢˜ã€‚è¿™äº›æ•°æ®ç»“æ„é€šå¸¸ä½¿ç”¨ hashCode æ–¹æ³•æ¥ç¡®å®šå¯¹è±¡åœ¨æ•°æ®ç»“æ„ä¸­çš„ä½ç½®ï¼Œå¦‚æœ hashCode æ–¹æ³•æ²¡æœ‰æ­£ç¡®å®ç°ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå¯¼è‡´å¯¹è±¡æ— æ³•æ­£ç¡®æ·»åŠ ã€åˆ é™¤æˆ–æŸ¥æ‰¾ã€‚\nå› æ­¤ï¼Œå½“è¦†ç›– equals æ–¹æ³•æ—¶ï¼Œæ€»è¦è¦†ç›– hashCode æ–¹æ³•ï¼Œå¹¶ç¡®ä¿ hashCode æ–¹æ³•çš„å®ç°ä¸ equals æ–¹æ³•çš„å®ç°ä¸€è‡´ã€‚åœ¨å®ç° hashCode æ–¹æ³•æ—¶ï¼Œé€šå¸¸éœ€è¦è€ƒè™‘å¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼Œå¹¶æ ¹æ®å±æ€§çš„å€¼è®¡ç®—ä¸€ä¸ªå“ˆå¸Œç ï¼Œä»¥ä¿è¯ä¸åŒçš„å¯¹è±¡å…·æœ‰ä¸åŒçš„å“ˆå¸Œç ï¼Œç›¸åŒçš„å¯¹è±¡å…·æœ‰ç›¸åŒçš„å“ˆå¸Œç ã€‚\nåœ¨ Java ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Objects ç±»çš„ hash æ–¹æ³•æ¥è®¡ç®—å¯¹è±¡çš„å“ˆå¸Œç ï¼Œä¾‹å¦‚ï¼š\n@Override public int hashCode() { return Objects.hash(property1, property2, ...); } å…¶ä¸­ï¼Œproperty1ã€property2 ç­‰ä¸ºå¯¹è±¡çš„å±æ€§ï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´ã€‚\næ€»ä¹‹ï¼Œåœ¨è¦†ç›– equals æ–¹æ³•æ—¶ï¼Œæ€»è¦è¦†ç›– hashCode æ–¹æ³•ï¼Œå¹¶ç¡®ä¿ hashCode æ–¹æ³•çš„å®ç°ä¸ equals æ–¹æ³•çš„å®ç°ä¸€è‡´ã€‚è¿™æ˜¯ Java ç¼–ç¨‹ä¸­ä¸€ä¸ªé‡è¦çš„åŸåˆ™ï¼Œåº”è¯¥åœ¨å®é™…ç¼–ç¨‹ä¸­åŠ ä»¥æ³¨æ„ã€‚\nä»¥ä¸‹æ˜¯ä¸€äº›åœ¨ Java ä¸­å®ç° hashCode æ—¶éœ€è¦é¿å…çš„å¸¸è§é”™è¯¯ï¼š\nä¸è€ƒè™‘æ‰€æœ‰ç›¸å…³å­—æ®µï¼šåœ¨å®ç° hashCode æ—¶ï¼Œéœ€è¦è€ƒè™‘æ‰€æœ‰ç›¸å…³å­—æ®µï¼Œè¿™äº›å­—æ®µå¯¹äºå¯¹è±¡çš„æ ‡è¯†è‡³å…³é‡è¦ã€‚å¦‚æœçœç•¥äº†ä¸€ä¸ªå­—æ®µï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå¯¼è‡´ç›¸ç­‰çš„å¯¹è±¡å…·æœ‰ä¸åŒçš„å“ˆå¸Œç ï¼Œè¿™å¯èƒ½ä¼šåœ¨ä½¿ç”¨å“ˆå¸Œè¡¨æˆ–å“ˆå¸Œé›†åˆç­‰æ•°æ®ç»“æ„æ—¶å‡ºç°é—®é¢˜ã€‚ ä½¿ç”¨å¯å˜å­—æ®µï¼šå¦‚æœå¯¹è±¡å…·æœ‰å¯å˜å­—æ®µï¼Œåˆ™ä¸åº”å°†å®ƒä»¬åŒ…å«åœ¨ hashCode è®¡ç®—ä¸­ã€‚è¿™æ˜¯å› ä¸ºå¯¹è±¡çš„å“ˆå¸Œç åº”è¯¥åœ¨å…¶ç”Ÿå‘½å‘¨æœŸå†…ä¿æŒä¸å˜ï¼ŒåŒ…å«å¯å˜å­—æ®µå¯èƒ½ä¼šå¯¼è‡´å“ˆå¸Œç å‘ç”Ÿå˜åŒ–ï¼Œå³ä½¿å¯¹è±¡çš„æ ‡è¯†ä¿æŒä¸å˜ã€‚ åˆ†å¸ƒä¸å‡åŒ€ï¼šè‰¯å¥½çš„ hashCode å®ç°åº”è¯¥ç”Ÿæˆåœ¨å“ˆå¸Œè¡¨ä¸­å‡åŒ€åˆ†å¸ƒçš„å“ˆå¸Œç ã€‚å¦‚æœå“ˆå¸Œç ä¸å‡åŒ€åˆ†å¸ƒï¼Œå¯èƒ½ä¼šå¯¼è‡´å“ˆå¸Œè¡¨æ€§èƒ½ä¸‹é™æˆ–å†²çªã€‚ ä¸ä½¿ç”¨è´¨æ•°ï¼šåœ¨è®¡ç®— hashCode æ—¶ï¼Œå¸¸å¸¸ä½¿ç”¨è´¨æ•°æ¥é¿å…å†²çªã€‚å¦‚æœä¸ä½¿ç”¨è´¨æ•°ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ›´å¤šçš„å†²çªå’Œè¾ƒå·®çš„æ€§èƒ½ã€‚ ä½¿ç”¨é»˜è®¤å®ç°ï¼šå¦‚æœä¸é‡å†™ hashCodeï¼Œå°†ä½¿ç”¨ Object ç±»æä¾›çš„é»˜è®¤å®ç°ï¼Œè¯¥å®ç°åªè¿”å›å¯¹è±¡çš„å†…å­˜åœ°å€ã€‚è¿™å¯èƒ½å¯¹æŸäº›æƒ…å†µè¶³å¤Ÿï¼Œä½†ä¸èƒ½ä¿è¯ç”Ÿæˆå”¯ä¸€çš„å“ˆå¸Œç ï¼Œå¯èƒ½ä¼šåœ¨ä½¿ç”¨å“ˆå¸Œè¡¨æˆ–å“ˆå¸Œé›†åˆç­‰æ•°æ®ç»“æ„æ—¶å‡ºç°é—®é¢˜ã€‚ ä¸ equals ä¸ä¸€è‡´ï¼šhashCode å®ç°åº”è¯¥ä¸ equals å®ç°ä¿æŒä¸€è‡´ï¼Œè¿™æ„å‘³ç€å¦‚æœæ ¹æ® equals å®ç°ï¼Œä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼Œåˆ™å®ƒä»¬åº”è¯¥å…·æœ‰ç›¸åŒçš„ hashCodeã€‚å¦‚æœæœªç¡®ä¿ä¸€è‡´æ€§ï¼Œå¯èƒ½ä¼šåœ¨ä½¿ç”¨å“ˆå¸Œè¡¨æˆ–å“ˆå¸Œé›†åˆç­‰æ•°æ®ç»“æ„æ—¶å‡ºç°é—®é¢˜ã€‚ ä¸ç¼“å­˜å“ˆå¸Œç ï¼šè®¡ç®—å¯¹è±¡çš„å“ˆå¸Œç å¯èƒ½æ˜¯ä¸€ä¸ªæ˜‚è´µçš„æ“ä½œï¼Œå› æ­¤é€šå¸¸éœ€è¦åœ¨è®¡ç®—å‡ºå“ˆå¸Œç åç¼“å­˜å®ƒã€‚å¦‚æœä¸ç¼“å­˜å“ˆå¸Œç ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨å“ˆå¸Œè¡¨æˆ–å“ˆå¸Œé›†åˆç­‰æ•°æ®ç»“æ„æ—¶ã€‚ è¦ç¡®ä¿ hashCode åˆ†å¸ƒå‡åŒ€ï¼Œå¯ä»¥é‡‡ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š\nä½¿ç”¨æ‰€æœ‰ç›¸å…³å­—æ®µï¼šåœ¨è®¡ç®— hashCode æ—¶ï¼Œéœ€è¦ä½¿ç”¨æ‰€æœ‰ç›¸å…³å­—æ®µï¼Œä»¥ç¡®ä¿æ‰€æœ‰å­—æ®µéƒ½å¯¹ç”Ÿæˆçš„å“ˆå¸Œç æœ‰è´¡çŒ®ã€‚å¦‚æœçœç•¥å­—æ®µï¼Œåˆ™å¯èƒ½ä¼šå¯¼è‡´ç›¸ç­‰çš„å¯¹è±¡å…·æœ‰ä¸åŒçš„å“ˆå¸Œç ï¼Œä»è€Œå½±å“å“ˆå¸Œè¡¨æˆ–å“ˆå¸Œé›†åˆç­‰æ•°æ®ç»“æ„çš„æ€§èƒ½ã€‚ é€‰æ‹©é€‚å½“çš„å“ˆå¸Œå‡½æ•°ï¼šé€‰æ‹©é€‚å½“çš„å“ˆå¸Œå‡½æ•°å¯ä»¥ç¡®ä¿ç”Ÿæˆçš„å“ˆå¸Œç åˆ†å¸ƒå‡åŒ€ã€‚ä¾‹å¦‚ï¼ŒJava ä¸­çš„ Objects ç±»æä¾›äº†ä¸€äº›å“ˆå¸Œå‡½æ•°ï¼Œä¾‹å¦‚ hashã€hashCombine ç­‰ï¼Œå¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©é€‚å½“çš„å“ˆå¸Œå‡½æ•°ã€‚ ä½¿ç”¨è´¨æ•°ï¼šä½¿ç”¨è´¨æ•°å¯ä»¥é¿å…å“ˆå¸Œå†²çªã€‚åœ¨è®¡ç®— hashCode æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è´¨æ•°æ¥è®¡ç®—ä¸åŒå­—æ®µçš„å“ˆå¸Œç ï¼Œç„¶åå°†å®ƒä»¬ç»„åˆèµ·æ¥ä»¥ç”Ÿæˆæœ€ç»ˆçš„å“ˆå¸Œç ã€‚ å‹ç¼©å“ˆå¸Œç ï¼šåœ¨ç”Ÿæˆå“ˆå¸Œç åï¼Œå¯ä»¥å°†å…¶å‹ç¼©åˆ°å“ˆå¸Œè¡¨çš„åˆæ³•èŒƒå›´å†…ï¼Œä»¥ç¡®ä¿å“ˆå¸Œç åˆ†å¸ƒå‡åŒ€ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå“ˆå¸Œè¡¨å¤§å°ä¸º 2 çš„ n æ¬¡æ–¹ï¼Œå¯ä»¥é€šè¿‡å°†å“ˆå¸Œç ä¸ 2 çš„ n æ¬¡æ–¹-1 è¿›è¡ŒæŒ‰ä½ä¸è¿ç®—æ¥å‹ç¼©å“ˆå¸Œç ï¼Œä»¥ç¡®ä¿å“ˆå¸Œç åœ¨ 0 åˆ° 2 çš„ n æ¬¡æ–¹-1 ä¹‹é—´å‡åŒ€åˆ†å¸ƒã€‚ ä½¿ç”¨å“ˆå¸Œç éšæœºåŒ–ï¼šåœ¨ç”Ÿæˆå“ˆå¸Œç åï¼Œå¯ä»¥å¯¹å…¶è¿›è¡ŒéšæœºåŒ–ï¼Œä»¥é¿å…æ•Œæ‰‹æ”»å‡»å’Œå“ˆå¸Œå†²çªã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªéšæœºæ•°ï¼Œå°†å…¶ä¸å“ˆå¸Œç æ··åˆï¼Œä»¥ç”Ÿæˆæœ€ç»ˆçš„å“ˆå¸Œç ã€‚ å“ˆå¸Œå†²çªæ˜¯æŒ‡ä¸åŒçš„é”®ï¼ˆkeyï¼‰åœ¨å“ˆå¸Œè¡¨ä¸­æ˜ å°„åˆ°ç›¸åŒçš„ä½ç½®ï¼ˆç´¢å¼•ï¼‰çš„æƒ…å†µã€‚ä¸ºäº†å¤„ç†å“ˆå¸Œå†²çªï¼Œå¯ä»¥é‡‡ç”¨ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š\nå¼€æ”¾åœ°å€æ³•ï¼šå¼€æ”¾åœ°å€æ³•æ˜¯ä¸€ç§å¸¸ç”¨çš„å¤„ç†å“ˆå¸Œå†²çªçš„æ–¹æ³•ï¼Œå®ƒçš„æ€æƒ³æ˜¯åœ¨å“ˆå¸Œè¡¨ä¸­å¯»æ‰¾ä¸€ä¸ªç©ºæ§½ï¼Œå°†å†²çªçš„é”®æ”¾å…¥è¯¥æ§½ä¸­ã€‚å¸¸ç”¨çš„å¼€æ”¾åœ°å€æ³•åŒ…æ‹¬çº¿æ€§æ¢æµ‹ã€äºŒæ¬¡æ¢æµ‹å’ŒåŒé‡æ•£åˆ—ç­‰ã€‚ é“¾åœ°å€æ³•ï¼šé“¾åœ°å€æ³•æ˜¯å¦ä¸€ç§å¸¸ç”¨çš„å¤„ç†å“ˆå¸Œå†²çªçš„æ–¹æ³•ï¼Œå®ƒçš„æ€æƒ³æ˜¯å°†å“ˆå¸Œè¡¨ä¸­åŒä¸€ä¸ªä½ç½®çš„æ‰€æœ‰é”®æ”¾åœ¨ä¸€ä¸ªé“¾è¡¨ä¸­ã€‚å½“å‘ç”Ÿå“ˆå¸Œå†²çªæ—¶ï¼Œåªéœ€è¦å°†å†²çªçš„é”®æ·»åŠ åˆ°é“¾è¡¨çš„æœ«å°¾å³å¯ã€‚é“¾åœ°å€æ³•é€‚ç”¨äºå­˜å‚¨å¤§é‡æ•°æ®çš„å“ˆå¸Œè¡¨ã€‚ å†å“ˆå¸Œæ³•ï¼šå†å“ˆå¸Œæ³•æ˜¯ä¸€ç§å¤„ç†å“ˆå¸Œå†²çªçš„æ–¹æ³•ï¼Œå®ƒçš„æ€æƒ³æ˜¯ä½¿ç”¨å¦ä¸€ä¸ªå“ˆå¸Œå‡½æ•°æ¥è®¡ç®—å†²çªé”®çš„å“ˆå¸Œå€¼ã€‚å½“å‘ç”Ÿå“ˆå¸Œå†²çªæ—¶ï¼Œä½¿ç”¨å¦ä¸€ä¸ªå“ˆå¸Œå‡½æ•°é‡æ–°è®¡ç®—å“ˆå¸Œå€¼ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªç©ºæ§½æ’å…¥é”®ä¸ºæ­¢ã€‚ å»ºç«‹å…¬å…±æº¢å‡ºåŒºï¼šå»ºç«‹å…¬å…±æº¢å‡ºåŒºæ˜¯ä¸€ç§å¤„ç†å“ˆå¸Œå†²çªçš„æ–¹æ³•ï¼Œå®ƒçš„æ€æƒ³æ˜¯åœ¨å“ˆå¸Œè¡¨ä¸­ä¿ç•™ä¸€äº›ä½ç½®ï¼Œç”¨äºå­˜å‚¨å“ˆå¸Œå†²çªçš„é”®ã€‚å½“å‘ç”Ÿå“ˆå¸Œå†²çªæ—¶ï¼Œå°†å†²çªçš„é”®æ”¾å…¥å…¬å…±æº¢å‡ºåŒºä¸­ï¼Œè€Œä¸æ˜¯åœ¨å“ˆå¸Œè¡¨çš„å…¶ä»–ä½ç½®ä¸­ã€‚ æ— è®ºé‡‡ç”¨å“ªç§æ–¹æ³•ï¼Œå¤„ç†å“ˆå¸Œå†²çªæ—¶éœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\næ•ˆç‡ï¼šå¤„ç†å“ˆå¸Œå†²çªçš„æ–¹æ³•åº”è¯¥å…·æœ‰é«˜æ•ˆæ€§ï¼Œèƒ½å¤Ÿåœ¨ä¸å½±å“æ€§èƒ½çš„æƒ…å†µä¸‹è§£å†³å“ˆå¸Œå†²çªã€‚ å†²çªè§£å†³åº¦ï¼šå¤„ç†å“ˆå¸Œå†²çªçš„æ–¹æ³•åº”è¯¥å…·æœ‰è‰¯å¥½çš„å†²çªè§£å†³åº¦ï¼Œèƒ½å¤Ÿå°½å¯èƒ½åœ°å‡å°‘å“ˆå¸Œå†²çªçš„å‘ç”Ÿã€‚ å®ç°å¤æ‚åº¦ï¼šå¤„ç†å“ˆå¸Œå†²çªçš„æ–¹æ³•åº”è¯¥æ˜“äºå®ç°å’Œç»´æŠ¤ã€‚ ","permalink":"https://blog.chensoul.cc/posts/2023/05/23/always-override-hashcode-when-you-override-equals/","summary":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬ä¸‰ç« ã€Šå¯¹è±¡çš„é€šç”¨æ–¹æ³•ã€‹çš„å­¦ä¹ ç¬”è®°ï¼šå½“è¦†ç›– equals æ–¹æ³•æ—¶ï¼Œæ€»è¦è¦†ç›– hashCode æ–¹æ³•ã€‚\nä»‹ç» åœ¨è¦†ç›–äº† equals æ–¹æ³•çš„ç±»ä¸­ï¼Œå¿…é¡»è¦†ç›– hashCode æ–¹æ³•ã€‚ å¦‚æœä½ æ²¡æœ‰è¿™æ ·åšï¼Œè¯¥ç±»å°†è¿å hashCode æ–¹æ³•çš„ä¸€èˆ¬çº¦å®šï¼Œè¿™å°†é˜»æ­¢è¯¥ç±»åœ¨ HashMap å’Œ HashSet ç­‰é›†åˆä¸­æ­£å¸¸è¿è¡Œã€‚ä»¥ä¸‹æ˜¯æ ¹æ® Object è§„èŒƒä¿®æ”¹çš„çº¦å®šï¼š\nåº”ç”¨ç¨‹åºæ‰§è¡ŒæœŸé—´å¯¹å¯¹è±¡é‡å¤è°ƒç”¨ hashCode æ–¹æ³•æ—¶ï¼Œå®ƒå¿…é¡»ä¸€è‡´åœ°è¿”å›ç›¸åŒçš„å€¼ï¼Œå‰ææ˜¯ä¸å¯¹ equals æ–¹æ³•ä¸­ç”¨äºæ¯”è¾ƒçš„ä¿¡æ¯è¿›è¡Œä¿®æ”¹ã€‚è¿™ä¸ªå€¼ä¸éœ€è¦åœ¨åº”ç”¨ç¨‹åºçš„ä¸åŒæ‰§è¡Œä¹‹é—´ä¿æŒä¸€è‡´ã€‚ å¦‚æœæ ¹æ® equals(Object) æ–¹æ³•åˆ¤æ–­å‡ºä¸¤ä¸ªå¯¹è±¡æ˜¯ç›¸ç­‰çš„ï¼Œé‚£ä¹ˆåœ¨ä¸¤ä¸ªå¯¹è±¡ä¸Šè°ƒç”¨ hashCode æ–¹æ³•å¿…é¡»äº§ç”Ÿç›¸åŒçš„æ•´æ•°ç»“æœã€‚ å¦‚æœæ ¹æ® equals(Object) æ–¹æ³•åˆ¤æ–­å‡ºä¸¤ä¸ªå¯¹è±¡ä¸ç›¸ç­‰ï¼Œåˆ™ä¸éœ€è¦åœ¨æ¯ä¸ªå¯¹è±¡ä¸Šè°ƒç”¨ hashCode æ–¹æ³•æ—¶å¿…é¡»äº§ç”Ÿä¸åŒçš„ç»“æœã€‚ä½†æ˜¯ï¼Œç¨‹åºå‘˜åº”è¯¥çŸ¥é“ï¼Œä¸ºä¸ç›¸ç­‰çš„å¯¹è±¡ç”Ÿæˆä¸åŒçš„ç»“æœå¯èƒ½ä¼šæé«˜æ•£åˆ—è¡¨çš„æ€§èƒ½ã€‚\nå½“ä½ æ— æ³•è¦†ç›– hashCode æ–¹æ³•æ—¶ï¼Œå°†è¿åç¬¬äºŒä¸ªå…³é”®æ¡æ¬¾ï¼šç›¸ç­‰çš„å¯¹è±¡å¿…é¡»å…·æœ‰ç›¸ç­‰çš„æ•£åˆ—ç ã€‚ æ ¹æ®ç±»çš„ equals æ–¹æ³•ï¼Œä¸¤ä¸ªä¸åŒçš„å®ä¾‹åœ¨é€»è¾‘ä¸Šå¯èƒ½æ˜¯ç›¸ç­‰çš„ï¼Œä½†æ˜¯å¯¹äºå¯¹è±¡çš„ hashCode æ–¹æ³•æ¥è¯´ï¼Œå®ƒä»¬åªæ˜¯ä¸¤ä¸ªæ²¡æœ‰å…±åŒä¹‹å¤„çš„å¯¹è±¡ã€‚å› æ­¤ï¼ŒObject çš„ hashCode æ–¹æ³•è¿”å›ä¸¤ä¸ªçœ‹ä¼¼éšæœºçš„æ•°å­—ï¼Œè€Œä¸æ˜¯çº¦å®šè¦æ±‚çš„ä¸¤ä¸ªç›¸ç­‰çš„æ•°å­—ã€‚ä¾‹å¦‚ï¼š\nMap\u0026lt;PhoneNumber, String\u0026gt; m = new HashMap\u0026lt;\u0026gt;(); m.put(new PhoneNumber(707, 867, 5309), \u0026#34;Jenny\u0026#34;); æ­¤æ—¶ï¼Œä½ å¯èƒ½æœŸæœ› m.get(new PhoneNumber(707, 867,5309)) è¿”å›ã€ŒJennyã€ï¼Œä½†æ˜¯å®ƒè¿”å› nullã€‚æ³¨æ„ï¼Œè¿™é‡Œæ¶‰åŠåˆ°ä¸¤ä¸ª PhoneNumber å®ä¾‹ï¼šä¸€ä¸ªç”¨äºæ’å…¥åˆ° HashMap ä¸­ï¼Œå¦ä¸€ä¸ªç›¸ç­‰çš„å®ä¾‹ï¼ˆè¢«è¯•å›¾ï¼‰ç”¨äºæ£€ç´¢ã€‚ç”±äº PhoneNumber ç±»æœªèƒ½è¦†ç›– hashCode æ–¹æ³•ï¼Œå¯¼è‡´ä¸¤ä¸ªç›¸ç­‰çš„å®ä¾‹å…·æœ‰ä¸ç›¸ç­‰çš„æ•£åˆ—ç ï¼Œè¿™è¿åäº† hashCode æ–¹æ³•çº¦å®šã€‚å› æ­¤ï¼Œget æ–¹æ³•æŸ¥æ‰¾ç”µè¯å·ç çš„æ•£åˆ—æ¡¶å¯èƒ½ä¼šä¸ put æ–¹æ³•å­˜å‚¨ç”µè¯å·ç çš„æ•£åˆ—æ¡¶ä¸åŒã€‚å³ä½¿è¿™ä¸¤ä¸ªå®ä¾‹ç¢°å·§åˆ†é…åœ¨åŒä¸€ä¸ªæ•£åˆ—æ¡¶ä¸Šï¼Œget æ–¹æ³•å‡ ä¹è‚¯å®šä¼šè¿”å› nullï¼Œå› ä¸º HashMap æœ‰ä¸€ä¸ªä¼˜åŒ–ï¼Œå®ƒç¼“å­˜æ¯ä¸ªæ¡ç›®ç›¸å…³è”çš„æ•£åˆ—ç ï¼Œå¦‚æœæ•£åˆ—ç ä¸åŒ¹é…ï¼Œå°±ä¸ä¼šæ£€æŸ¥å¯¹è±¡æ˜¯å¦ç›¸ç­‰ã€‚\nè§£å†³è¿™ä¸ªé—®é¢˜å°±åƒä¸º PhoneNumber ç¼–å†™ä¸€ä¸ªæ­£ç¡®çš„ hashCode æ–¹æ³•ä¸€æ ·ç®€å•ã€‚é‚£ä¹ˆ hashCode æ–¹æ³•åº”è¯¥æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿå†™ä¸€ä¸ªåé¢ä¾‹å­å¾ˆå®¹æ˜“ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹æ–¹æ³•æ˜¯åˆæ³•çš„ï¼Œä½†æ˜¯ä¸åº”è¯¥è¢«ä½¿ç”¨ï¼š\n// The worst possible legal hashCode implementation - never use! @Override public int hashCode() { return 42; } å®ƒæ˜¯åˆæ³•çš„ï¼Œå› ä¸ºå®ƒç¡®ä¿äº†ç›¸ç­‰çš„å¯¹è±¡å…·æœ‰ç›¸åŒçš„æ•£åˆ—ç ã€‚åŒæ—¶å®ƒä¹Ÿå¾ˆç³Ÿç³•ï¼Œå› ä¸ºå®ƒä½¿æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ç›¸åŒçš„æ•£åˆ—ç ã€‚å› æ­¤ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½åˆ†é…åˆ°åŒä¸€ä¸ªæ¡¶ä¸­ï¼Œæ•£åˆ—è¡¨é€€åŒ–ä¸ºé“¾è¡¨ã€‚è¿™æ ·ï¼ŒåŸæœ¬åº”è¯¥åœ¨çº¿æ€§é˜¶ O(n) è¿è¡Œçš„ç¨‹åºå°†åœ¨å¹³æ–¹é˜¶ O(n^2) è¿è¡Œã€‚å¯¹äºå¤§å‹æ•£åˆ—è¡¨ï¼Œè¿™æ˜¯å·¥ä½œå’Œä¸å·¥ä½œçš„åŒºåˆ«ã€‚","title":"ã€ŠEffective Java 3ã€‹ç¬”è®°11ï¼šå½“è¦†ç›– equals æ–¹æ³•æ—¶ï¼Œæ€»è¦è¦†ç›– hashCode æ–¹æ³•"},{"content":" æŒç»­é›†æˆ (CI) å·²æˆä¸ºè½¯ä»¶å¼€å‘çš„å…³é”®ï¼Œå®ƒå…è®¸å›¢é˜Ÿé¢‘ç¹åˆå¹¶ä»£ç æ›´æ”¹å¹¶åŠæ—©å‘ç°é”™è¯¯ã€‚\nDocker å®¹å™¨é€šè¿‡æä¾›ä¸€è‡´çš„ç¯å¢ƒå¸®åŠ©ä¿ƒè¿›æŒç»­é›†æˆè¿‡ç¨‹ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æµ‹è¯•å’Œå‘é€æ¯æ¬¡æäº¤çš„ä»£ç ã€‚\nåœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Docker ä¸º Flask Web åº”ç”¨ç¨‹åºåˆ›å»ºå¼ºå¤§çš„æŒç»­é›†æˆç®¡é“ã€‚\næ‚¨å°†å®Œæˆåœ¨æœ¬åœ°å¼€å‘å’Œæµ‹è¯•åº”ç”¨ç¨‹åºã€å°†å…¶å®¹å™¨åŒ–ã€ä½¿ç”¨ Docker Compose ç¼–æ’å®¹å™¨ä»¥åŠä½¿ç”¨ GitHub Actions å®šä¹‰ CI ç®¡é“çš„æ­¥éª¤ã€‚\nåœ¨æœ¬æ•™ç¨‹ç»“æŸæ—¶ï¼Œæ‚¨å°†èƒ½å¤Ÿä¸ºæ‚¨çš„ Web åº”ç”¨ç¨‹åºåˆ›å»ºä¸€ä¸ªå®Œå…¨è‡ªåŠ¨åŒ–çš„ CI ç®¡é“ã€‚\nåœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†ï¼š\nåœ¨ Docker å®¹å™¨ä¸­æœ¬åœ°è¿è¡Œ Redis æœåŠ¡å™¨ ç”¨ Docker ç¼–æ’ Flask ç¼–å†™çš„ Python Web åº”ç”¨ç¨‹åº æ„å»º Docker é•œåƒå¹¶å°†å®ƒä»¬æ¨é€åˆ° Docker Hub ä»“åº“ ä½¿ç”¨ Docker Compose ç¼–æ’å¤šå®¹å™¨åº”ç”¨ç¨‹åº åœ¨ä»»ä½•åœ°æ–¹å¤åˆ¶ç±»ä¼¼ç”Ÿäº§çš„åŸºç¡€è®¾æ–½ ä½¿ç”¨ GitHub Actions å®šä¹‰æŒç»­é›†æˆå·¥ä½œæµ ç†æƒ³æƒ…å†µä¸‹ï¼Œæ‚¨åº”è¯¥å…·æœ‰ä½¿ç”¨ Python è¿›è¡Œ Web å¼€å‘ã€æµ‹è¯•è‡ªåŠ¨åŒ–ã€å°† Redis ä¸ Python ç»“åˆä½¿ç”¨ä»¥åŠä½¿ç”¨ Git å’Œ GitHub è¿›è¡Œæºä»£ç ç‰ˆæœ¬æ§åˆ¶çš„ç»éªŒã€‚ä»¥å‰æ¥è§¦è¿‡ Docker ä¼šæ›´å¥½ï¼Œä½†ä¸æ˜¯å¿…éœ€çš„ã€‚æ‚¨è¿˜åº”è¯¥æ‹¥æœ‰ä¸€ä¸ª Git å®¢æˆ·ç«¯å’Œä¸€ä¸ª GitHub å¸æˆ·ï¼Œä»¥ä¾¿è·Ÿéšå¹¶å¤åˆ¶æœ¬æ•™ç¨‹çš„æ­¥éª¤ã€‚\næ³¨æ„ï¼šæœ¬æ•™ç¨‹å¤§è‡´åŸºäºåä¸º Docker in Action - Fitter, Happier, More Productive çš„æ—§æ•™ç¨‹ï¼Œè¯¥æ•™ç¨‹ç”± Michael Herman ç¼–å†™ï¼Œä»–äº 2015 å¹´ 2 æœˆ 8 æ—¥åœ¨ PyTennessee å±•ç¤ºäº†ä»–çš„ CI å·¥ä½œæµç¨‹ã€‚å¦‚æœä½ æœ‰å…´è¶£ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å±•ç¤ºçš„ç›¸åº”å¹»ç¯ç‰‡åœ¨ä¼šè®®ä¸Šã€‚\nä¸å¹¸çš„æ˜¯ï¼ŒåŸå§‹æ•™ç¨‹ä¸­æè¿°çš„è®¸å¤šå·¥å…·ä¸å†å—æ”¯æŒæˆ–å…è´¹æä¾›ã€‚åœ¨æ­¤æ›´æ–°çš„æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†ä½¿ç”¨æœ€æ–°çš„å·¥å…·å’ŒæŠ€æœ¯ï¼Œä¾‹å¦‚ GitHub Actionsã€‚\nå¦‚æœæ‚¨æƒ³è·³è¿‡åœ¨è®¡ç®—æœºä¸Šè®¾ç½® Docker å’Œæ„å»ºç¤ºä¾‹ Web åº”ç”¨ç¨‹åºçš„åˆå§‹æ­¥éª¤ï¼Œé‚£ä¹ˆç›´æ¥è·³åˆ°å®šä¹‰æŒç»­é›†æˆç®¡é“ã€‚æ— è®ºå“ªç§æ–¹å¼ï¼Œæ‚¨éƒ½éœ€è¦ä¸‹è½½æ”¯æŒææ–™ï¼Œå®ƒä»¬ä¸å®Œæˆçš„ Flask Web åº”ç”¨ç¨‹åºå’Œç›¸å…³èµ„æºä¸€èµ·æä¾›ï¼Œå®ƒä»¬å°†å¸®åŠ©æ‚¨å­¦ä¹ æœ¬æ•™ç¨‹ï¼š\nå…è´¹ä¸‹è½½ï¼šå•å‡»æ­¤å¤„ä¸‹è½½æ‚¨çš„ Flask åº”ç”¨ç¨‹åºå’Œç›¸å…³èµ„æºï¼Œä»¥ä¾¿æ‚¨å¯ä»¥ä½¿ç”¨ Docker å®šä¹‰æŒç»­é›†æˆç®¡é“ã€‚\né¡¹ç›®æ¶æ„æ¦‚è§ˆ åœ¨æœ¬æ•™ç¨‹ç»“æŸæ—¶ï¼Œæ‚¨å°†æ‹¥æœ‰ä¸€ä¸ª Flask Web åº”ç”¨ç¨‹åºï¼Œç”¨äºè·Ÿè¸ªæŒä¹…å­˜å‚¨åœ¨ Redis æ•°æ®å­˜å‚¨ä¸­çš„é¡µé¢è§†å›¾ã€‚\nå®ƒå°†æ˜¯ä¸€ä¸ªç”± Docker Compose ç¼–æ’çš„å¤šå®¹å™¨åº”ç”¨ç¨‹åºï¼Œæ‚¨å°†èƒ½å¤Ÿåœ¨æœ¬åœ°å’Œäº‘ç«¯æ„å»ºå’Œæµ‹è¯•ï¼Œä¸ºæŒç»­é›†æˆé“ºå¹³é“è·¯ï¼š\nè¯¥åº”ç”¨ç¨‹åºç”±ä¸¤ä¸ª Docker å®¹å™¨ç»„æˆã€‚ç¬¬ä¸€ä¸ªå®¹å™¨å°†åœ¨ Gunicorn ä¹‹ä¸Šè¿è¡Œä¸€ä¸ª Flask åº”ç”¨ç¨‹åºï¼Œå“åº” HTTP è¯·æ±‚å¹¶æ›´æ–°é¡µé¢æµè§ˆé‡ã€‚\nç¬¬äºŒä¸ªå®¹å™¨å°†è¿è¡Œä¸€ä¸ª Redis å®ä¾‹ï¼Œç”¨äºå°†é¡µé¢è§†å›¾æ•°æ®æŒä¹…å­˜å‚¨åœ¨ä¸»æœºä¸Šçš„æœ¬åœ°å·ä¸­ã€‚\nDocker æ˜¯è¿è¡Œæ­¤åº”ç”¨ç¨‹åºæ‰€éœ€çš„å…¨éƒ¨ï¼Œæ‚¨ç°åœ¨å°†å¯¹å…¶è¿›è¡Œè®¾ç½®ã€‚\nåœ¨æ‚¨çš„è®¡ç®—æœºä¸Šè®¾ç½® Docker Docker æ˜¯ä¸€ä¸ªæ€»ç§°ï¼Œæ ¹æ®ä¸Šä¸‹æ–‡ï¼Œå®ƒå¯¹ä¸åŒçš„äººæœ‰ä¸åŒçš„å«ä¹‰ã€‚ä¾‹å¦‚ï¼Œå½“æœ‰äººæåˆ° docker æ—¶ï¼Œä»–ä»¬å¯èƒ½æŒ‡ä»¥ä¸‹ä¹‹ä¸€ï¼š\nDocker, Inc.ï¼šå¹³å°å’Œç›¸å…³å·¥å…·èƒŒåçš„å…¬å¸ Dockerï¼šå¼€æºå®¹å™¨å¹³å° Docker CLIï¼š docker å®¢æˆ·ç«¯å‘½ä»¤è¡Œç¨‹åº dockerd : ç®¡ç†å®¹å™¨çš„ Docker å®ˆæŠ¤è¿›ç¨‹ è¿˜æœ‰ä¸€äº›ä¸ Docker å¹³å°ç›¸å…³çš„å·¥å…·å’Œé¡¹ç›®ï¼Œä¾‹å¦‚ï¼š\nDocker Compose Docker Desktop Docker Engine Docker Hub Docker Swarm Mode Docker é›†ç¾¤æ¨¡å¼ åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†ä½¿ç”¨ä¸Šé¢åˆ—è¡¨ä¸­é™¤æœ€åä¸€ä¸ªä¹‹å¤–çš„æ‰€æœ‰å†…å®¹ã€‚é¡ºä¾¿è¯´ä¸€å¥ï¼Œä¸è¦å°†é—ç•™çš„ Docker Classic Swarm ä¸ 1.12 ç‰ˆä»¥æ¥å†…ç½®äº Docker å¼•æ“ä¸­çš„ Docker Swarm Mode æ··æ·†ï¼Œåè€…æ˜¯ä¸€ä¸ªå¤–éƒ¨å·¥å…·ã€‚\næ³¨æ„ï¼šæ‚¨å¯èƒ½å¬è¯´è¿‡ Docker Machine å’Œ Docker Toolboxã€‚è¿™äº›æ˜¯ä¸å†ç»´æŠ¤çš„æ—§å·¥å…·ã€‚\nDocker è§£å†³çš„ä¸»è¦é—®é¢˜æ˜¯èƒ½å¤Ÿåœ¨å‡ ä¹æ²¡æœ‰æˆ–æ²¡æœ‰é…ç½®çš„æƒ…å†µä¸‹åœ¨ä¸€è‡´ä¸”å¯é‡ç°çš„ç¯å¢ƒä¸­çš„ä»»ä½•åœ°æ–¹è¿è¡Œåº”ç”¨ç¨‹åºã€‚å®ƒå¯ä»¥å°†æ‚¨çš„åº”ç”¨ç¨‹åºä»£ç ã€äºŒè¿›åˆ¶æ–‡ä»¶å’Œä¾èµ–é¡¹ï¼ˆä¾‹å¦‚è¯­è¨€è¿è¡Œæ—¶å’Œåº“ï¼‰æ‰“åŒ…åˆ°ä¸€ä¸ªå·¥ä»¶ä¸­ã€‚æ‚¨å°†åœ¨å¼€å‘æœŸé—´å’ŒæŒç»­é›†æˆæœåŠ¡å™¨ä¸Šä½¿ç”¨ Docker åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šæ¨¡æ‹Ÿå‡è®¾çš„ç”Ÿäº§ç¯å¢ƒã€‚\nå®‰è£… Docker æœ‰ä¸¤ç§é€‰æ‹©ï¼š\nDocker Engine Docker Desktop å¦‚æœæ‚¨ç†Ÿæ‚‰ç»ˆç«¯å¹¶å–œæ¬¢é¢å¤–çš„æ§åˆ¶çº§åˆ«ï¼Œé‚£ä¹ˆå¼€æº Docker å¼•æ“å°±æ˜¯æ‚¨çš„æœ€ä½³é€‰æ‹©ï¼Œå®ƒæä¾›æ ¸å¿ƒè¿è¡Œæ—¶å’Œç”¨äºç®¡ç†å®¹å™¨çš„å‘½ä»¤è¡Œç•Œé¢ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæ‚¨æ›´å–œæ¬¢å…·æœ‰ç›´è§‚å›¾å½¢ç”¨æˆ·ç•Œé¢çš„ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆï¼Œé‚£ä¹ˆæ‚¨åº”è¯¥è€ƒè™‘ä½¿ç”¨ Docker Desktopã€‚\næ³¨æ„ï¼šå¼€ç®±å³ç”¨çš„æ¡Œé¢åº”ç”¨ç¨‹åºé™„å¸¦ Docker Composeï¼Œç¨ååœ¨ç¼–æ’å®¹å™¨ä»¥è¿›è¡ŒæŒç»­é›†æˆæ—¶å°†éœ€è¦å®ƒã€‚\nå½“æ‚¨æµè§ˆ Docker å®˜æ–¹æ–‡æ¡£æ—¶ï¼Œæ‚¨å¯èƒ½ä¼šè§‰å¾— Docker Desktop å æ®äº†èšå…‰ç¯ä¸‹ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸æ£’çš„å·¥å…·ï¼Œä½†æ‚¨å¿…é¡»è®°ä½ï¼ŒDocker Desktop ä»ç„¶å…è´¹ä¾›ä¸ªäººä½¿ç”¨ã€‚è‡ª 2021 å¹´ 8 æœˆèµ·ï¼Œæ‚¨éœ€è¦ä»˜è´¹è®¢é˜…æ‰èƒ½åœ¨å•†ä¸šé¡¹ç›®ä¸­ä½¿ç”¨å®ƒã€‚\nè™½ç„¶åœ¨æŠ€æœ¯ä¸Šå¯ä»¥å¹¶æ’å®‰è£…è¿™ä¸¤ç§å·¥å…·ï¼Œä½†æ‚¨é€šå¸¸åº”è¯¥é¿å…åŒæ—¶ä½¿ç”¨å®ƒä»¬ï¼Œä»¥å°½é‡å‡å°‘è™šæ‹Ÿç½‘ç»œæˆ–ç«¯å£ç»‘å®šä¹‹é—´ä»»ä½•æ½œåœ¨å¹²æ‰°çš„é£é™©ã€‚æ‚¨å¯ä»¥é€šè¿‡åœæ­¢å…¶ä¸­ä¹‹ä¸€å¹¶åœ¨ Docker Engine å’Œ Docker Desktop ä¹‹é—´åˆ‡æ¢ä¸Šä¸‹æ–‡æ¥å®ç°ã€‚\næ³¨æ„ï¼šDocker Desktop è¿‡å»åªèƒ½åœ¨ Windows å’Œ macOS ä¸Šä½¿ç”¨ï¼Œä½†ç°åœ¨æƒ…å†µå‘ç”Ÿäº†å˜åŒ–ï¼Œæ‚¨ç°åœ¨ä¹Ÿå¯ä»¥åœ¨æŸäº› Linux å‘è¡Œç‰ˆä¸Šå®‰è£…å®ƒï¼ŒåŒ…æ‹¬ Ubuntuã€Debian å’Œ Fedoraã€‚ä½†æ˜¯ï¼ŒLinux ç‰ˆæœ¬çš„ Docker Desktop è¿è¡Œåœ¨è™šæ‹Ÿæœºä¹‹ä¸Šï¼Œä»¥æ¨¡ä»¿åœ¨å…¶ä»–æ“ä½œç³»ç»Ÿä¸Šä½¿ç”¨å®ƒçš„ç”¨æˆ·ä½“éªŒã€‚\nè¦éªŒè¯æ‚¨æ˜¯å¦å·²åœ¨ç³»ç»Ÿä¸ŠæˆåŠŸå®‰è£… Dockerï¼ˆä½œä¸º Docker Engine æˆ– Docker Desktop åŒ…è£…å™¨åº”ç”¨ç¨‹åºï¼‰ï¼Œè¯·æ‰“å¼€ç»ˆç«¯å¹¶é”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼š\n$ docker --version Docker version 23.0.4, build f480fb1 æ‚¨åº”è¯¥ä¼šçœ‹åˆ°æ‚¨çš„ Docker ç‰ˆæœ¬ä»¥åŠå†…éƒ¨ç‰ˆæœ¬å·ã€‚å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Linuxï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½å¸Œæœ›æŒ‰ç…§å®‰è£…åçš„æ­¥éª¤ä½¿ç”¨ docker å‘½ä»¤ï¼Œè€Œæ— éœ€åœ¨å…¶å‰é¢åŠ ä¸Š sudo ä»¥è·å¾—ç®¡ç†æƒé™ã€‚\nåœ¨å¼€å§‹ä½¿ç”¨ Docker æ¥å¸®åŠ©è¿›è¡ŒæŒç»­é›†æˆä¹‹å‰ï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„ Web åº”ç”¨ç¨‹åºã€‚\nåœ¨ Flask ä¸­å¼€å‘é¡µé¢è§†å›¾è·Ÿè¸ªå™¨ åœ¨æ¥ä¸‹æ¥çš„å‡ èŠ‚ä¸­ï¼Œæ‚¨å°†ä½¿ç”¨ Flask æ¡†æ¶å®ç°ä¸€ä¸ªåŸºæœ¬çš„ Web åº”ç”¨ç¨‹åºã€‚æ‚¨çš„åº”ç”¨ç¨‹åºå°†è·Ÿè¸ªé¡µé¢æµè§ˆæ€»æ•°ï¼Œå¹¶åœ¨æ¯æ¬¡è¯·æ±‚æ—¶å‘ç”¨æˆ·æ˜¾ç¤ºè¯¥æ•°å­—ï¼š\nåº”ç”¨ç¨‹åºçš„å½“å‰çŠ¶æ€å°†ä¿å­˜åœ¨ Redis æ•°æ®å­˜å‚¨ä¸­ï¼Œè¯¥å­˜å‚¨é€šå¸¸ç”¨äºç¼“å­˜å’Œå…¶ä»–ç±»å‹çš„æ•°æ®æŒä¹…åŒ–ã€‚è¿™æ ·ï¼Œåœæ­¢æ‚¨çš„ç½‘ç»œæœåŠ¡å™¨ä¸ä¼šé‡ç½®è§‚çœ‹æ¬¡æ•°ã€‚æ‚¨å¯ä»¥å°† Redis è§†ä¸ºä¸€ç§æ•°æ®åº“ã€‚\nå¦‚æœæ‚¨å¯¹ä»å¤´å¼€å§‹æ„å»ºæ­¤åº”ç”¨ç¨‹åºä¸æ„Ÿå…´è¶£ï¼Œè¯·éšæ—¶é€šè¿‡å•å‡»ä¸‹é¢çš„é“¾æ¥ä¸‹è½½å…¶å®Œæ•´æºä»£ç ï¼Œç„¶åè·³åˆ°å¯¹æ‚¨çš„ Flask Web åº”ç”¨ç¨‹åºè¿›è¡Œ docker åŒ–ï¼š\nå³ä½¿æ‚¨æ‰“ç®—è‡ªå·±ç¼–å†™ä»£ç ï¼Œä¸‹è½½å®Œæˆçš„é¡¹ç›®å¹¶å°†å…¶ç”¨ä½œå‚è€ƒä¸æ‚¨çš„å®ç°è¿›è¡Œæ¯”è¾ƒä»ç„¶æ˜¯ä¸ªå¥½ä¸»æ„ï¼Œä»¥é˜²æ‚¨é‡åˆ°å›°éš¾ã€‚\nå…è´¹ä¸‹è½½ï¼šå•å‡»æ­¤å¤„ä¸‹è½½æ‚¨çš„ Flask åº”ç”¨ç¨‹åºå’Œç›¸å…³èµ„æºï¼Œä»¥ä¾¿æ‚¨å¯ä»¥ä½¿ç”¨ Docker å®šä¹‰æŒç»­é›†æˆç®¡é“ã€‚\nåœ¨å¼€å§‹å¼€å‘åº”ç”¨ç¨‹åºä¹‹å‰ï¼Œæ‚¨éœ€è¦è®¾ç½®å·¥ä½œç¯å¢ƒã€‚\nå‡†å¤‡ç¯å¢ƒ ä¸æ¯ä¸ª Python é¡¹ç›®ä¸€æ ·ï¼Œæ‚¨åœ¨å¼€å§‹æ—¶åº”è¯¥éµå¾ªå¤§è‡´ç›¸åŒçš„æ­¥éª¤ï¼ŒåŒ…æ‹¬åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•ï¼Œç„¶åä¸ºæ‚¨çš„é¡¹ç›®åˆ›å»ºå¹¶æ¿€æ´»ä¸€ä¸ªéš”ç¦»çš„è™šæ‹Ÿç¯å¢ƒã€‚æ‚¨å¯ä»¥ç›´æ¥ä»æ‚¨æœ€å–œæ¬¢çš„ä»£ç ç¼–è¾‘å™¨ï¼ˆå¦‚ Visual Studio Codeï¼‰æˆ–åŠŸèƒ½é½å…¨çš„ IDEï¼ˆå¦‚ PyCharmï¼‰æ‰§è¡Œæ­¤æ“ä½œï¼Œæˆ–è€…æ‚¨å¯ä»¥åœ¨ç»ˆç«¯ä¸­é”®å…¥ä¸€äº›å‘½ä»¤ï¼š\nWindowsï¼š\nPS\u0026gt; mkdir page-tracker PS\u0026gt; cd page-tracker PS\u0026gt; python -m venv venv --prompt page-tracker PS\u0026gt; venv\\Scripts\\activate (page-tracker) PS\u0026gt; python -m pip install --upgrade pip Linux + MacOSï¼š\n$ mkdir page-tracker/ $ cd page-tracker/ $ python3 -m venv venv/ --prompt page-tracker $ source venv/bin/activate (page-tracker) $ python -m pip install --upgrade pip é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªåä¸º page-tracker/ çš„æ–°ç›®å½•ï¼Œç„¶ååœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ªåä¸º venv/ çš„ Python è™šæ‹Ÿç¯å¢ƒã€‚ä¸ºè™šæ‹Ÿç¯å¢ƒæä¾›æè¿°æ€§æç¤ºï¼Œä½¿å…¶æ˜“äºè¯†åˆ«ã€‚æœ€åï¼Œæ¿€æ´»æ–°å»ºçš„è™šæ‹Ÿç¯å¢ƒåï¼Œå°† pip å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œä»¥å…ä»¥åå®‰è£…Python åŒ…æ—¶å‡ºç°é—®é¢˜ã€‚\næ³¨æ„ï¼šåœ¨ Windows ä¸Šï¼Œæ‚¨å¯èƒ½éœ€è¦å…ˆä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ Windows Terminal å¹¶åœ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒä¹‹å‰æ”¾å®½è„šæœ¬æ‰§è¡Œç­–ç•¥ã€‚\nåœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†ä½¿ç”¨ç°ä»£æ–¹å¼é€šè¿‡ pyproject.toml é…ç½®æ–‡ä»¶å’Œ setuptools æŒ‡å®šé¡¹ç›®çš„ä¾èµ–é¡¹å’Œå…ƒæ•°æ®ä½œä¸ºæ„å»ºåç«¯ã€‚æ­¤å¤–ï¼Œæ‚¨å°†éµå¾ª src å¸ƒå±€ï¼Œå°†åº”ç”¨ç¨‹åºçš„æºä»£ç æ”¾åœ¨å•ç‹¬çš„ src/ å­ç›®å½•ä¸­ï¼Œä»¥æ›´å¥½åœ°ç»„ç»‡é¡¹ç›®ä¸­çš„æ–‡ä»¶ã€‚è¿™å°†ä½¿æ‚¨å¯ä»¥ç›´æ¥æ‰“åŒ…ä»£ç ï¼Œè€Œæ— éœ€ç¨åæ·»åŠ çš„è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚\nç»§ç»­ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ„å»ºæ‚¨çš„ Python é¡¹ç›®å ä½ç¬¦ï¼š\nWindowsï¼š\n(page-tracker) PS\u0026gt; mkdir src\\page_tracker (page-tracker) PS\u0026gt; ni src\\page_tracker\\__init__.py (page-tracker) PS\u0026gt; ni src\\page_tracker\\app.py (page-tracker) PS\u0026gt; ni constraints.txt (page-tracker) PS\u0026gt; ni pyproject.toml Linux + MacOSï¼š\n(page-tracker) $ mkdir -p src/page_tracker (page-tracker) $ touch src/page_tracker/__init__.py (page-tracker) $ touch src/page_tracker/app.py (page-tracker) $ touch constraints.txt (page-tracker) $ touch pyproject.toml å®Œæˆåï¼Œæ‚¨åº”è¯¥å…·æœ‰ä»¥ä¸‹ç›®å½•ç»“æ„ï¼š\npage-tracker/ â”‚ â”œâ”€â”€ src/ â”‚ â””â”€â”€ page_tracker/ â”‚ â”œâ”€â”€ __init__.py â”‚ â””â”€â”€ app.py â”‚ â”œâ”€â”€ venv/ â”‚ â”œâ”€â”€ constraints.txt â””â”€â”€ pyproject.toml å¦‚æ‚¨æ‰€è§ï¼Œæ‚¨å°†åªæœ‰ä¸€ä¸ª Python æ¨¡å—ï¼Œ app ï¼Œå®šä¹‰åœ¨ä¸€ä¸ªåä¸º page_tracker çš„åŒ…ä¸­ï¼Œä½äº src/ ç›®å½•ä¸­ã€‚ constraints.txt æ–‡ä»¶å°†æŒ‡å®šé¡¹ç›®ä¾èµ–é¡¹çš„å›ºå®šç‰ˆæœ¬ï¼Œä»¥å®ç°å¯é‡å¤å®‰è£…ã€‚\nè¯¥é¡¹ç›®å°†ä¾èµ–äºä¸¤ä¸ªå¤–éƒ¨åº“ï¼Œ Flask å’Œ Redis ï¼Œæ‚¨å¯ä»¥åœ¨ pyproject.toml æ–‡ä»¶ä¸­å£°æ˜å®ƒä»¬ï¼š\n# pyproject.toml [build-system] requires = [\u0026#34;setuptools\u0026gt;=67.0.0\u0026#34;, \u0026#34;wheel\u0026#34;] build-backend = \u0026#34;setuptools.build_meta\u0026#34; [project] name = \u0026#34;page-tracker\u0026#34; version = \u0026#34;1.0.0\u0026#34; dependencies = [ \u0026#34;Flask\u0026#34;, \u0026#34;redis\u0026#34;, ] è¯·æ³¨æ„ï¼Œæ‚¨é€šå¸¸ä¸ä¼šåœ¨æ­¤å¤„æŒ‡å®šä¾èµ–é¡¹ç‰ˆæœ¬ã€‚ç›¸åï¼Œæ‚¨å¯ä»¥å°†å®ƒä»¬ä¸éœ€æ±‚æˆ–çº¦æŸæ–‡ä»¶ä¸­çš„ä»»ä½•ä¼ é€’ä¾èµ–é¡¹ä¸€èµ·å†»ç»“ã€‚ç¬¬ä¸€ä¸ªå‘Šè¯‰ pip è¦å®‰è£…ä»€ä¹ˆåŒ…ï¼Œåè€…å¼ºåˆ¶æ‰§è¡Œä¼ é€’ä¾èµ–é¡¹çš„ç‰¹å®šåŒ…ç‰ˆæœ¬ï¼Œç±»ä¼¼äº Pipenv æˆ– Poetry é”å®šæ–‡ä»¶ã€‚\nè¦ç”Ÿæˆçº¦æŸæ–‡ä»¶ï¼Œæ‚¨å¿…é¡»é¦–å…ˆå°†æ‚¨çš„ page-tracker é¡¹ç›®å®‰è£…åˆ°æ´»åŠ¨çš„è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œè¿™å°†ä» Python åŒ…ç´¢å¼• (PyPI) ä¸­è·å–æ‰€éœ€çš„å¤–éƒ¨åº“ã€‚ç¡®ä¿æ‚¨å·²ç»åˆ›å»ºäº†æ‰€éœ€çš„æ–‡ä»¶å¤¹ç»“æ„ï¼Œç„¶åå‘å‡ºä»¥ä¸‹å‘½ä»¤ï¼š\n(page-tracker) $ python -m pip install --editable . (page-tracker) $ python -m pip freeze --exclude-editable \u0026gt; constraints.txt å³ä½¿æ‚¨è¿˜æ²¡æœ‰è¾“å…¥ä¸€è¡Œä»£ç ï¼ŒPython ä¹Ÿä¼šè¯†åˆ«å¹¶å®‰è£…æ‚¨çš„åŒ…å ä½ç¬¦ã€‚å› ä¸ºæ‚¨çš„åŒ…éµå¾ª src å¸ƒå±€ï¼Œæ‰€ä»¥åœ¨å¼€å‘æœŸé—´ä»¥å¯ç¼–è¾‘æ¨¡å¼å®‰è£…å®ƒå¾ˆæ–¹ä¾¿ã€‚è¿™å°†å…è®¸æ‚¨æ›´æ”¹æºä»£ç å¹¶ç«‹å³å°†å®ƒä»¬åæ˜ åœ¨è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œè€Œæ— éœ€é‡æ–°å®‰è£…ã€‚ä½†æ˜¯ï¼Œæ‚¨æƒ³ä»çº¦æŸæ–‡ä»¶ä¸­æ’é™¤å¯ç¼–è¾‘åŒ…ã€‚\næ³¨æ„ï¼šå¦‚æœæ‚¨æ‰“ç®—å…±äº«æ‚¨çš„é¡¹ç›®ï¼Œç”Ÿæˆçš„çº¦æŸæ–‡ä»¶éå¸¸æœ‰ä»·å€¼ã€‚è¿™æ„å‘³ç€å…¶ä»–äººå¯ä»¥åœ¨ä»–ä»¬çš„ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥é‡ç°ä¸æ‚¨ç›¸åŒçš„ç¯å¢ƒï¼š\n(page-tracker) $ python -m pip install -c constraints.txt . å› ä¸ºæ‚¨é€šè¿‡ -c é€‰é¡¹æä¾›äº†ä¸€ä¸ªçº¦æŸæ–‡ä»¶ï¼Œ pip å®‰è£…äº†å›ºå®šçš„ä¾èµ–é¡¹è€Œä¸æ˜¯æœ€æ–°çš„å¯ç”¨ä¾èµ–é¡¹ã€‚è¿™æ„å‘³ç€æ‚¨æœ‰å¯é‡å¤çš„å®‰è£…ã€‚ç¨åæ‚¨å°†ä½¿ç”¨ç±»ä¼¼çš„å‘½ä»¤æ¥æ„å»º Docker é•œåƒã€‚\nå¥½çš„ã€‚æ‚¨å‡ ä¹å·²ç»å‡†å¤‡å¥½å¼€å§‹ç¼–å†™æ‚¨çš„ Flask Web åº”ç”¨ç¨‹åºäº†ã€‚åœ¨æ‰§è¡Œæ­¤æ“ä½œä¹‹å‰ï¼Œæ‚¨å°†åˆ‡æ¢ä¸€ä¸‹æ–¹å¼å¹¶å‡†å¤‡ä¸€ä¸ªæœ¬åœ° Redis æœåŠ¡å™¨ä»¥é€šè¿‡ç½‘ç»œè¿æ¥ã€‚\né€šè¿‡ Docker è¿è¡Œ Redis æœåŠ¡å™¨ Redis è¿™ä¸ªåå­—æ˜¯å•è¯è¿œç¨‹å­—å…¸æœåŠ¡å™¨çš„åˆæˆè¯ï¼Œå®ƒéå¸¸å‡†ç¡®åœ°è¡¨è¾¾äº†å®ƒä½œä¸ºè¿œç¨‹å†…å­˜æ•°æ®ç»“æ„å­˜å‚¨çš„ç›®çš„ã€‚ä½œä¸ºä¸€ä¸ªé”®å€¼å­˜å‚¨ï¼ŒRedis å°±åƒä¸€ä¸ªè¿œç¨‹ Python å­—å…¸ï¼Œæ‚¨å¯ä»¥ä»ä»»ä½•åœ°æ–¹è¿æ¥åˆ°å®ƒã€‚å®ƒä¹Ÿè¢«è®¤ä¸ºæ˜¯åœ¨è®¸å¤šä¸åŒç¯å¢ƒä¸­ä½¿ç”¨çš„æœ€æµè¡Œçš„ NoSQL æ•°æ®åº“ä¹‹ä¸€ã€‚é€šå¸¸ï¼Œå®ƒç”¨äºå…³ç³»æ•°æ®åº“ä¹‹ä¸Šçš„ç¼“å­˜ã€‚\næ³¨æ„ï¼šè™½ç„¶ Redis å°†å…¶æ‰€æœ‰æ•°æ®ä¿å­˜åœ¨æ˜“å¤±æ€§å†…å­˜ä¸­ï¼Œè¿™ä½¿å…¶é€Ÿåº¦æå¿«ï¼Œä½†è¯¥æœåŠ¡å™¨å…·æœ‰å¤šç§æŒä¹…æ€§é€‰é¡¹ã€‚åœ¨æ–­ç”µæˆ–é‡å¯çš„æƒ…å†µä¸‹ï¼Œå®ƒä»¬å¯ä»¥ç¡®ä¿ä¸åŒçº§åˆ«çš„æ•°æ®æŒä¹…æ€§ã€‚ç„¶è€Œï¼Œæ­£ç¡®é…ç½® Redis é€šå¸¸å¾ˆå›°éš¾ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆè®¸å¤šå›¢é˜Ÿå†³å®šä½¿ç”¨å¤–åŒ…ç»™äº‘æä¾›å•†çš„æ‰˜ç®¡æœåŠ¡çš„åŸå› ã€‚\nåœ¨æ‚¨çš„è®¡ç®—æœºä¸Šå®‰è£… Redis éå¸¸ç®€å•ï¼Œä½†å‡è®¾æ‚¨ä¹‹å‰å·²ç»å®‰è£…å’Œé…ç½®äº† Dockerï¼Œé€šè¿‡ Docker è¿è¡Œå®ƒä¼šæ›´åŠ ç®€å•å’Œä¼˜é›…ã€‚å½“æ‚¨åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œè¯¸å¦‚ Redis ä¹‹ç±»çš„æœåŠ¡æ—¶ï¼Œå®ƒä¼šä¸ç³»ç»Ÿçš„å…¶ä½™éƒ¨åˆ†ä¿æŒéš”ç¦»ï¼Œè€Œä¸ä¼šé€ æˆæ··ä¹±æˆ–å ç”¨æœ‰é™çš„ç½‘ç»œç«¯å£å·ç­‰ç³»ç»Ÿèµ„æºã€‚\nè¦åœ¨ä¸å°† Redis å®‰è£…åœ¨ä¸»æœºä¸Šçš„æƒ…å†µä¸‹è¿è¡Œ Redisï¼Œæ‚¨å¯ä»¥é€šè¿‡è°ƒç”¨ä»¥ä¸‹å‘½ä»¤ä»å®˜æ–¹ Redis é•œåƒè¿è¡Œæ–°çš„ Docker å®¹å™¨ï¼š\n$ docker run -d --name redis-server redis Unable to find image \u0026#39;redis:latest\u0026#39; locally latest: Pulling from library/redis 26c5c85e47da: Pull complete 39f79586dcf2: Pull complete 79c71d0520e5: Pull complete 60e988668ca1: Pull complete 873c3fc9fdc6: Pull complete 50ce7f9bf183: Pull complete Digest: sha256:f50031a49f41e493087fb95f96fdb3523bb25dcf6a3f0b07c588ad3cdb... Status: Downloaded newer image for redis:latest 09b9842463c78a2e9135add810aba6c4573fb9e2155652a15310009632c40ea8 è¿™å°†åŸºäºæœ€æ–°ç‰ˆæœ¬çš„ redis é•œåƒåˆ›å»ºä¸€ä¸ªæ–°çš„ Docker å®¹å™¨ï¼Œè‡ªå®šä¹‰åç§°ä¸º redis-server ï¼Œç¨åæ‚¨å°†å¼•ç”¨å®ƒã€‚å®¹å™¨ä»¥åˆ†ç¦»æ¨¡å¼ ( -d ) åœ¨åå°è¿è¡Œã€‚å½“æ‚¨ç¬¬ä¸€æ¬¡è¿è¡Œæ­¤å‘½ä»¤æ—¶ï¼ŒDocker ä¼šä» Docker Hub ä¸­æ‹‰å–ç›¸åº”çš„ Docker é•œåƒï¼Œè¿™æ˜¯ Docker é•œåƒçš„å®˜æ–¹å­˜å‚¨åº“ï¼Œç±»ä¼¼äº PyPIã€‚\nåªè¦ä¸€åˆ‡æŒ‰è®¡åˆ’è¿›è¡Œï¼Œæ‚¨çš„ Redis æœåŠ¡å™¨å°±åº”è¯¥å¯åŠ¨å¹¶è¿è¡Œã€‚å› ä¸ºæ‚¨ä»¥åˆ†ç¦»æ¨¡å¼ ( -d ) å¯åŠ¨äº†å®¹å™¨ï¼Œæ‰€ä»¥å®ƒå°†åœ¨åå°ä¿æŒæ´»åŠ¨çŠ¶æ€ã€‚è¦éªŒè¯è¿™ä¸€ç‚¹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ docker container ls å‘½ä»¤æˆ–ç­‰æ•ˆçš„ docker ps åˆ«ååˆ—å‡ºæ‚¨çš„ Docker å®¹å™¨ï¼š\n$ docker ps CONTAINER ID IMAGE ... STATUS PORTS NAMES 09b9842463c7 redis ... Up About a minute 6379/tcp redis-server åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ä¸€ä¸ª ID å‰ç¼€ä¸æ‚¨åœ¨è¿è¡Œ docker run å‘½ä»¤æ—¶è·å¾—çš„ ID å‰ç¼€åŒ¹é…çš„å®¹å™¨ä»å¤§çº¦ä¸€åˆ†é’Ÿå‰å¼€å§‹å¯åŠ¨ã€‚è¯¥å®¹å™¨åŸºäº redis é•œåƒï¼Œå·²å‘½åä¸º redis-server ï¼Œå¹¶ä½¿ç”¨ TCP ç«¯å£å· 6379 ï¼Œè¿™æ˜¯ Redis çš„é»˜è®¤ç«¯å£ã€‚\næ¥ä¸‹æ¥ï¼Œæ‚¨å°†å°è¯•ä»¥å„ç§æ–¹å¼è¿æ¥åˆ°è¯¥ Redis æœåŠ¡å™¨ã€‚\næµ‹è¯•ä¸ Redis çš„è¿æ¥ åœ¨ Docker Hub ä¸Šå®˜æ–¹ Redis é•œåƒçš„æ¦‚è¿°é¡µé¢ä¸Šï¼Œæ‚¨å°†æ‰¾åˆ°æœ‰å…³å¦‚ä½•è¿æ¥åˆ°åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œçš„ Redis æœåŠ¡å™¨çš„è¯´æ˜ã€‚å…·ä½“è€Œè¨€ï¼Œæ­¤é¡µé¢è®¨è®ºäº†å¦‚ä½•ä½¿ç”¨ Docker é•œåƒé™„å¸¦çš„ä¸“ç”¨äº¤äº’å¼å‘½ä»¤è¡Œç•Œé¢ Redis CLI ã€‚\næ‚¨å¯ä»¥ä»åŒä¸€ä¸ª redis é•œåƒå¯åŠ¨å¦ä¸€ä¸ª Docker å®¹å™¨ï¼Œä½†è¿™ä¸€æ¬¡ï¼Œå°†å®¹å™¨çš„å…¥å£ç‚¹è®¾ç½®ä¸º redis-cli å‘½ä»¤è€Œä¸æ˜¯é»˜è®¤çš„ Redis æœåŠ¡å™¨äºŒè¿›åˆ¶æ–‡ä»¶ã€‚å½“æ‚¨è®¾ç½®å¤šä¸ªå®¹å™¨ä¸€èµ·å·¥ä½œæ—¶ï¼Œæ‚¨åº”è¯¥ä½¿ç”¨ Docker ç½‘ç»œï¼Œè¿™éœ€è¦ä¸€äº›é¢å¤–çš„é…ç½®æ­¥éª¤ã€‚\né¦–å…ˆï¼Œæ–°å»ºä¸€ä¸ªä»¥ä½ çš„é¡¹ç›®å‘½åçš„è‡ªå®šä¹‰æ¡¥æ¥ç½‘ç»œï¼Œä¾‹å¦‚ï¼š\n$ docker network create page-tracker-network c942131265bf097da294edbd2ac375cd5410d6f0d87e250041827c68a3197684 é€šè¿‡å®šä¹‰è¿™æ ·çš„è™šæ‹Ÿç½‘ç»œï¼Œæ‚¨å¯ä»¥è¿æ¥ä»»æ„æ•°é‡çš„ Docker å®¹å™¨ï¼Œå¹¶è®©å®ƒä»¬é€šè¿‡æè¿°æ€§åç§°ç›¸äº’å‘ç°ã€‚æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆ—å‡ºæ‚¨åˆ›å»ºçš„ç½‘ç»œï¼š\n$ docker network ls NETWORK ID NAME DRIVER SCOPE 1bf8d998500e bridge bridge local d5cffd6ea76f host host local a85d88fc3abe none null local c942131265bf page-tracker-network bridge local æ¥ä¸‹æ¥ï¼Œå°†ç°æœ‰çš„ redis-server å®¹å™¨è¿æ¥åˆ°è¿™ä¸ªæ–°çš„è™šæ‹Ÿç½‘ç»œï¼Œå¹¶åœ¨å¯åŠ¨ç›¸åº”å®¹å™¨æ—¶ä¸º Redis CLI æŒ‡å®šç›¸åŒçš„ç½‘ç»œï¼š\n$ docker network connect page-tracker-network redis-server $ docker run --rm -it \\ --name redis-client \\ --network page-tracker-network \\ redis redis-cli -h redis-server --rm æ ‡å¿—å‘Šè¯‰ Docker åœ¨æ‚¨ç»ˆæ­¢å®ƒåç«‹å³åˆ é™¤åˆ›å»ºçš„å®¹å™¨ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªæ‚¨ä¸éœ€è¦å†æ¬¡å¯åŠ¨çš„ä¸´æ—¶æˆ–ä¸´æ—¶å®¹å™¨ã€‚ -i å’Œ -t æ ‡å¿—ï¼Œç¼©å†™ä¸º -it ï¼Œä»¥äº¤äº’æ–¹å¼è¿è¡Œå®¹å™¨ï¼Œè®©æ‚¨é€šè¿‡è¿æ¥åˆ°ç»ˆç«¯çš„æ ‡å‡†æµæ¥é”®å…¥å‘½ä»¤ã€‚ä½¿ç”¨ --name é€‰é¡¹ï¼Œæ‚¨å¯ä»¥ä¸ºæ–°å®¹å™¨æŒ‡å®šä¸€ä¸ªæè¿°æ€§åç§°ã€‚\n--network é€‰é¡¹å°†ä½ çš„æ–° redis-client å®¹å™¨è¿æ¥åˆ°ä¹‹å‰åˆ›å»ºçš„è™šæ‹Ÿç½‘ç»œï¼Œå…è®¸å®ƒä¸ redis-server å®¹å™¨é€šä¿¡ã€‚è¿™æ ·ï¼Œä¸¤ä¸ªå®¹å™¨éƒ½å°†æ”¶åˆ°ä¸ --name é€‰é¡¹ç»™å®šçš„åç§°ç›¸å¯¹åº”çš„ä¸»æœºåã€‚è¯·æ³¨æ„ï¼Œé€šè¿‡ä½¿ç”¨ -h å‚æ•°ï¼Œæ‚¨å‘Šè¯‰ Redis CLI è¿æ¥åˆ°ç”±å…¶å®¹å™¨åç§°æ ‡è¯†çš„ Redis æœåŠ¡å™¨ã€‚\næ³¨æ„ï¼šæœ‰ä¸€ç§æ›´å¿«çš„æ–¹æ³•å¯ä»¥é€šè¿‡è™šæ‹Ÿç½‘ç»œè¿æ¥ä¸¤ä¸ªå®¹å™¨ï¼Œè€Œæ— éœ€æ˜¾å¼åˆ›å»ºå®¹å™¨ã€‚æ‚¨å¯ä»¥åœ¨è¿è¡Œæ–°å®¹å™¨æ—¶æŒ‡å®š --link é€‰é¡¹ï¼š\n$ docker run --rm -it \\ --name redis-client \\ --link redis-server:redis-client \\ redis redis-cli -h redis-server ä½†æ˜¯ï¼Œæ­¤é€‰é¡¹å·²è¢«å¼ƒç”¨ï¼Œå¹¶ä¸”å¯èƒ½ä¼šåœ¨æŸä¸ªæ—¶å€™ä» Docker ä¸­åˆ é™¤ã€‚\nå½“æ‚¨çš„æ–° Docker å®¹å™¨å¯åŠ¨æ—¶ï¼Œæ‚¨å°†è¿›å…¥ä¸€ä¸ªäº¤äº’å¼ Redis CLIï¼Œå®ƒç±»ä¼¼äºå¸¦æœ‰ä»¥ä¸‹æç¤ºçš„ Python REPLï¼š\nredis-server:6379\u0026gt; SET pi 3.14 OK redis-server:6379\u0026gt; GET pi \u0026#34;3.14\u0026#34; redis-server:6379\u0026gt; DEL pi (integer) 1 redis-server:6379\u0026gt; KEYS * (empty array) åœ¨é‚£é‡Œï¼Œæ‚¨å¯ä»¥æµ‹è¯•ä¸€äº› Redis å‘½ä»¤ï¼Œä¾‹å¦‚ï¼Œè®¾ç½®é”®å€¼å¯¹ã€è·å–ç›¸åº”é”®çš„å€¼ã€åˆ é™¤è¯¥é”®å€¼å¯¹æˆ–æ£€ç´¢å½“å‰å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸­çš„æ‰€æœ‰é”®çš„åˆ—è¡¨ã€‚è¦é€€å‡ºäº¤äº’å¼ Redis CLIï¼Œè¯·æŒ‰é”®ç›˜ä¸Šçš„ Ctrl+Cã€‚\nå¦‚æœæ‚¨å®‰è£…äº† Docker Desktopï¼Œé‚£ä¹ˆåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®ƒä¸ä¼šå°†æµé‡ä»æ‚¨çš„ä¸»æœºè·¯ç”±åˆ°å®¹å™¨ã€‚ä½ çš„æœ¬åœ°ç½‘ç»œå’Œé»˜è®¤çš„ Docker ç½‘ç»œä¹‹é—´æ²¡æœ‰è¿æ¥ï¼š\nDocker Desktop for Mac æ— æ³•å°†æµé‡è·¯ç”±åˆ°å®¹å™¨ã€‚\né€‚ç”¨äº Windows çš„ Docker Desktop æ— æ³•å°†æµé‡è·¯ç”±åˆ° Linux å®¹å™¨ã€‚ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥å¯¹ Windows å®¹å™¨æ‰§è¡Œ ping æ“ä½œã€‚\nLinux ä¸Šçš„ Docker Desktop ä¹Ÿæ˜¯å¦‚æ­¤ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ Docker å¼•æ“æˆ–åœ¨ Windows ä¸»æœºä¸Šè¿è¡Œ Windows å®¹å™¨ï¼Œé‚£ä¹ˆæ‚¨å°†èƒ½å¤Ÿé€šè¿‡å®ƒä»¬çš„ IP åœ°å€è®¿é—®è¿™äº›å®¹å™¨ã€‚\nå› æ­¤ï¼Œæœ‰æ—¶æ‚¨å¯ä»¥ç›´æ¥ä»ä¸»æœºä¸ Redis æœåŠ¡å™¨é€šä¿¡ã€‚é¦–å…ˆï¼Œæ‰¾å‡ºå¯¹åº”çš„ Docker å®¹å™¨çš„ IP åœ°å€ï¼š\n$ docker inspect redis-server \\ -f \u0026#39;{{range .NetworkSettings.Networks}}{{.IPAddress}}{{println}}{{end}}\u0026#39; 172.17.0.2 172.18.0.2 å¦‚æœæ‚¨çœ‹åˆ°å¤šä¸ª IP åœ°å€ï¼Œåˆ™è¡¨ç¤ºæ‚¨çš„å®¹å™¨è¿æ¥åˆ°å¤šä¸ªç½‘ç»œã€‚å½“æ‚¨å¯åŠ¨å®¹å™¨æ—¶ï¼Œå®¹å™¨ä¼šè‡ªåŠ¨è¿æ¥åˆ°é»˜è®¤çš„ Docker ç½‘ç»œã€‚\nè®°ä¸‹å…¶ä¸­ä¸€ä¸ªåœ°å€ï¼Œæ‚¨å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚ç°åœ¨ï¼Œæ‚¨å¯ä»¥å°†æ­¤ IP åœ°å€ç”¨ä½œ -h å‚æ•°çš„å€¼ï¼Œè€Œä¸æ˜¯ redis-cli ä¸­çš„é“¾æ¥å®¹å™¨åç§°ã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨æ­¤ IP åœ°å€é€šè¿‡ netcat æˆ– Telnet å®¢æˆ·ç«¯è¿æ¥åˆ° Redisï¼Œä¾‹å¦‚ PuTTY æˆ– telnet å‘½ä»¤ï¼š\n$ telnet 172.17.0.2 6379 Trying 172.17.0.2... Connected to 172.17.0.2. Escape character is \u0026#39;^]\u0026#39;. SET pi 3.14 +OK GET pi $4 3.14 DEL pi :1 KEYS * *0 ^] telnet\u0026gt; Connection closed. è¯·è®°ä½æä¾›é»˜è®¤ä¸º 6379 çš„ç«¯å£å·ï¼ŒRedis ä¼šåœ¨è¯¥ç«¯å£ä¸Šä¾¦å¬ä¼ å…¥è¿æ¥ã€‚æ‚¨å¯ä»¥åœ¨æ­¤å¤„ä»¥æ˜æ–‡å½¢å¼é”®å…¥ Redis å‘½ä»¤ï¼Œå› ä¸ºæœåŠ¡å™¨ä½¿ç”¨æœªåŠ å¯†çš„åè®®ï¼Œé™¤éæ‚¨åœ¨é…ç½®ä¸­æ˜ç¡®å¯ç”¨ TLS æ”¯æŒã€‚\næœ€åï¼Œæ‚¨å¯ä»¥åˆ©ç”¨ç«¯å£æ˜ å°„ä½¿ Redis åœ¨ Docker å®¹å™¨ä¹‹å¤–å¯ç”¨ã€‚åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ‚¨å°†å¸Œæœ›ç›´æ¥è¿æ¥åˆ° Redisï¼Œè€Œä¸æ˜¯é€šè¿‡æ¥è‡ªå¦ä¸€ä¸ªå®¹å™¨çš„è™šæ‹Ÿç½‘ç»œï¼Œå› æ­¤æ‚¨ä¸å¿…å°†å®ƒè¿æ¥åˆ°ä»»ä½•ç½‘ç»œã€‚\nè¦ä½¿ç”¨ç«¯å£æ˜ å°„ï¼Œè¯·åœæ­¢å¹¶åˆ é™¤ç°æœ‰çš„ redis-server ï¼Œç„¶åä½¿ç”¨å®šä¹‰å¦‚ä¸‹çš„ -p é€‰é¡¹è¿è¡Œä¸€ä¸ªæ–°å®¹å™¨ï¼š\n$ docker stop redis-server $ docker rm redis-server $ docker run -d --name redis-server -p 6379:6379 redis å†’å·å·¦è¾¹çš„æ•°å­—ï¼ˆ : ï¼‰ä»£è¡¨ä¸»æœºæˆ–ä½ ç”µè„‘ä¸Šçš„ç«¯å£å·ï¼Œè€Œå³è¾¹çš„æ•°å­—ä»£è¡¨å³å°†è¿è¡Œçš„ Docker å®¹å™¨å†…çš„æ˜ å°„ç«¯å£ã€‚\nåœ¨ä¸¤ä¾§ä½¿ç”¨ç›¸åŒçš„ç«¯å£å·å¯ä»¥æœ‰æ•ˆåœ°è½¬å‘å®ƒï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥è¿æ¥åˆ° Redisï¼Œå°±åƒå®ƒåœ¨æ‚¨çš„è®¡ç®—æœºä¸Šæœ¬åœ°è¿è¡Œä¸€æ ·ï¼š\n$ telnet localhost 6379 Trying 127.0.0.1... Connected to localhost. Escape character is \u0026#39;^]\u0026#39;. INCR page_views :1 INCR page_views :2 INCR page_views :3 ^] telnet\u0026gt; Connection closed. è¿æ¥åˆ°ç°åœ¨åœ¨æœ¬åœ°ä¸»æœºå’Œé»˜è®¤ç«¯å£ä¸Šå¯è§çš„ Redis åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ INCR å‘½ä»¤å¢åŠ é¡µé¢æµè§ˆé‡ã€‚å¦‚æœåº•å±‚é”®å°šä¸å­˜åœ¨ï¼Œåˆ™ Redis å°†ä½¿ç”¨å€¼ 1 å¯¹å…¶è¿›è¡Œåˆå§‹åŒ–ã€‚\næ³¨æ„ï¼šå¦‚æœæ‚¨åœ¨æœ¬åœ°å®‰è£…äº† Redisï¼Œæˆ–è€…æŸäº›ç³»ç»Ÿè¿›ç¨‹ä¹Ÿåœ¨æ‚¨çš„ä¸»æœºä¸Šä½¿ç”¨ç«¯å£ 6379 ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦ä½¿ç”¨æœªå ç”¨çš„ç«¯å£ä»¥ä¸åŒæ–¹å¼æ˜ å°„æ‚¨çš„ç«¯å£å·ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š\n$ docker run -d --name redis-server -p 9736:6379 redis è¿™å°†å…è®¸æ‚¨è¿æ¥åˆ°ç«¯å£ 9736 ä¸Šçš„æœ¬åœ°ä¸»æœºï¼ˆå¦‚æœè¯¥ç«¯å£å°šæœªè¢«å…¶ä»–æœåŠ¡å ç”¨ï¼‰ã€‚åªè¦å¯ç”¨ï¼Œä½¿ç”¨å“ªä¸ªç«¯å£å¹¶ä¸é‡è¦ã€‚\nç°åœ¨æ‚¨å·²ç»çŸ¥é“å¦‚ä½•ä»å‘½ä»¤è¡Œè¿æ¥åˆ° Redisï¼Œæ‚¨å¯ä»¥ç»§ç»­çœ‹çœ‹å¦‚ä½•é€šè¿‡ Python ç¨‹åºæ‰§è¡Œç›¸åŒçš„æ“ä½œã€‚\nä» Python è¿æ¥åˆ° Redis æ­¤æ—¶ï¼Œæ‚¨æœ‰ä¸€ä¸ªåœ¨ Docker å®¹å™¨ä¸­è¿è¡Œçš„ Redis æœåŠ¡å™¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Redis çš„é»˜è®¤ç«¯å£å·åœ¨æœ¬åœ°ä¸»æœºä¸Šè®¿é—®å®ƒã€‚\nå¦‚æœæ‚¨æƒ³äº†è§£æœ‰å…³æ‚¨çš„å®¹å™¨æˆ–ä»»ä½•å…¶ä»– Docker èµ„æºçš„æ›´å¤šä¿¡æ¯ï¼Œé‚£ä¹ˆæ‚¨å§‹ç»ˆå¯ä»¥é€šè¿‡æ£€æŸ¥æ‰‹å¤´çš„å¯¹è±¡æ¥æ£€ç´¢æœ‰ä»·å€¼çš„ä¿¡æ¯ï¼š\n$ docker inspect redis-server [ { \u0026#34;Id\u0026#34;: \u0026#34;09b9842463c78a2e9135add810aba6...2a15310009632c40ea8\u0026#34;, â‹® \u0026#34;NetworkSettings\u0026#34;: { â‹® \u0026#34;Ports\u0026#34;: { \u0026#34;6379/tcp\u0026#34;: null }, â‹® \u0026#34;IPAddress\u0026#34;: \u0026#34;172.17.0.2\u0026#34;, â‹® } } ] åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨è¦è¯¢é—®æœ‰å…³ redis-server å®¹å™¨çš„ä¿¡æ¯ï¼Œå…¶ä¸­åŒ…æ‹¬å¤§é‡è¯¦ç»†ä¿¡æ¯ï¼Œä¾‹å¦‚å®¹å™¨çš„ç½‘ç»œé…ç½®ã€‚ docker inspect å‘½ä»¤é»˜è®¤è¿”å› JSON æ ¼å¼çš„æ•°æ®ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Go æ¨¡æ¿è¿›ä¸€æ­¥è¿‡æ»¤ã€‚\næ¥ä¸‹æ¥ï¼Œæ‰“å¼€ç»ˆç«¯ï¼Œæ¿€æ´»é¡¹ç›®çš„è™šæ‹Ÿç¯å¢ƒï¼Œå¹¶å¯åŠ¨ä¸€ä¸ªæ–°çš„ Python REPLï¼š\nWindowsï¼š\nPS\u0026gt; venv\\Scripts\\activate (page-tracker) PS\u0026gt; python Linux + MacOSï¼š\n$ source venv/bin/activate (page-tracker) $ python å‡è®¾æ‚¨ä¹‹å‰åœ¨æ­¤è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…äº† redis åŒ…ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿå¯¼å…¥ Python çš„ Redis å®¢æˆ·ç«¯å¹¶è°ƒç”¨å…¶ä¸­ä¸€ç§æ–¹æ³•ï¼š\n\u0026gt;\u0026gt;\u0026gt; from redis import Redis \u0026gt;\u0026gt;\u0026gt; redis = Redis() \u0026gt;\u0026gt;\u0026gt; redis.incr(\u0026#34;page_views\u0026#34;) 4 \u0026gt;\u0026gt;\u0026gt; redis.incr(\u0026#34;page_views\u0026#34;) 5 å½“æ‚¨åœ¨ä¸æŒ‡å®šä»»ä½•å‚æ•°çš„æƒ…å†µä¸‹åˆ›å»ºæ–°çš„ Redis å®ä¾‹æ—¶ï¼Œå®ƒå°†å°è¯•è¿æ¥åˆ°åœ¨æœ¬åœ°ä¸»æœºå’Œé»˜è®¤ç«¯å£ 6379 ä¸Šè¿è¡Œçš„ Redis æœåŠ¡å™¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè°ƒç”¨ .incr() ç¡®è®¤æ‚¨å·²æˆåŠŸä¸ä½äº Docker å®¹å™¨ä¸­çš„ Redis å»ºç«‹è¿æ¥ï¼Œå› ä¸ºå®ƒè®°ä½äº† page_views é”®çš„æœ€åä¸€ä¸ªå€¼ã€‚\nå¦‚æœæ‚¨éœ€è¦è¿æ¥åˆ°ä½äºè¿œç¨‹è®¡ç®—æœºä¸Šçš„ Redisï¼Œè¯·æä¾›è‡ªå®šä¹‰ä¸»æœºå’Œç«¯å£å·ä½œä¸ºå‚æ•°ï¼š\n\u0026gt;\u0026gt;\u0026gt; from redis import Redis \u0026gt;\u0026gt;\u0026gt; redis = Redis(host=\u0026#34;127.0.0.1\u0026#34;, port=6379) \u0026gt;\u0026gt;\u0026gt; redis.incr(\u0026#34;page_views\u0026#34;) 6 è¯·æ³¨æ„ï¼Œæ‚¨åº”è¯¥å°†ç«¯å£å·ä½œä¸ºæ•´æ•°ä¼ é€’ï¼Œä½†å¦‚æœæ‚¨ä¼ é€’ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåº“ä¹Ÿä¸ä¼šæŠ±æ€¨ã€‚\nè¿æ¥åˆ° Redis çš„å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ç‰¹æ®Šæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œå®ƒä»£è¡¨ä¸€ä¸ª URLï¼š\n\u0026gt;\u0026gt;\u0026gt; from redis import Redis \u0026gt;\u0026gt;\u0026gt; redis = Redis.from_url(\u0026#34;redis://localhost:6379/\u0026#34;) \u0026gt;\u0026gt;\u0026gt; redis.incr(\u0026#34;page_views\u0026#34;) 7 å¦‚æœæ‚¨æƒ³å°† Redis é…ç½®å­˜å‚¨åœ¨æ–‡ä»¶æˆ–ç¯å¢ƒå˜é‡ä¸­ï¼Œè¿™ä¼šç‰¹åˆ«æ–¹ä¾¿ã€‚\nå¥½æäº†ï¼æ‚¨å¯ä»¥è·å–è¿™äº›ä»£ç ç‰‡æ®µä¹‹ä¸€å¹¶å°†å…¶ä¸æ‚¨çš„ Flask Web åº”ç”¨ç¨‹åºé›†æˆã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæ‚¨å°†çœ‹åˆ°å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ã€‚\nåœ¨æœ¬åœ°å®ç°å¹¶è¿è¡Œ Flask åº”ç”¨ç¨‹åº è¿”å›ä»£ç ç¼–è¾‘å™¨ï¼Œæ‰“å¼€ page-tracker é¡¹ç›®ä¸­çš„ app æ¨¡å—ï¼Œå¹¶ç¼–å†™ä»¥ä¸‹å‡ è¡Œ Python ä»£ç ï¼š\n# src/page_tracker/app.py from flask import Flask from redis import Redis app = Flask(__name__) redis = Redis() @app.get(\u0026#34;/\u0026#34;) def index(): page_views = redis.incr(\u0026#34;page_views\u0026#34;) return f\u0026#34;This page has been seen {page_views} times.\u0026#34; æ‚¨é¦–å…ˆä»é¡¹ç›®å„è‡ªåˆ—ä¸ºä¾èµ–é¡¹çš„ç¬¬ä¸‰æ–¹åº“ä¸­å¯¼å…¥ Flask å’Œ Redis ã€‚æ¥ä¸‹æ¥ï¼Œæ‚¨ä½¿ç”¨é»˜è®¤å‚æ•°å®ä¾‹åŒ– Flask åº”ç”¨ç¨‹åºå’Œ Redis å®¢æˆ·ç«¯ï¼Œè¿™æ„å‘³ç€å®¢æˆ·ç«¯å°†å°è¯•è¿æ¥åˆ°æœ¬åœ° Redis æœåŠ¡å™¨ã€‚\næœ€åï¼Œæ‚¨å®šä¹‰ä¸€ä¸ªæ§åˆ¶å™¨å‡½æ•°æ¥å¤„ç†åˆ°è¾¾ Web æœåŠ¡å™¨æ ¹åœ°å€ ( / ) çš„ HTTP GET è¯·æ±‚ã€‚\næ‚¨çš„ç«¯ç‚¹ä¼šå¢åŠ  Redis ä¸­çš„é¡µé¢æµè§ˆé‡ï¼Œå¹¶åœ¨å®¢æˆ·ç«¯çš„ Web æµè§ˆå™¨ä¸­æ˜¾ç¤ºåˆé€‚çš„æ¶ˆæ¯ã€‚å°±æ˜¯è¿™æ ·ï¼æ‚¨æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„ Web åº”ç”¨ç¨‹åºï¼Œå®ƒå¯ä»¥ä½¿ç”¨ä¸åˆ°åè¡Œçš„ä»£ç å¤„ç† HTTP æµé‡å¹¶å°†çŠ¶æ€æŒä¹…ä¿å­˜åœ¨è¿œç¨‹æ•°æ®å­˜å‚¨ä¸­ã€‚\nè¦éªŒè¯æ‚¨çš„ Flask åº”ç”¨ç¨‹åºæ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œï¼Œè¯·åœ¨ç»ˆç«¯ä¸­å‘å‡ºä»¥ä¸‹å‘½ä»¤ï¼š\n(page-tracker) $ flask --app page_tracker.app run * Serving Flask app \u0026#39;page_tracker.app\u0026#39; * Debug mode: off WARNING: This is a development server. Do not use it in a production â®‘ deployment. Use a production WSGI server instead. * Running on http://127.0.0.1:5000 Press CTRL+C to quit ä½ å¯ä»¥åœ¨ä½ çš„æ–‡ä»¶ç³»ç»Ÿçš„ä»»ä½•åœ°æ–¹è¿è¡Œè¿™ä¸ªå‘½ä»¤ï¼Œåªè¦ä½ å·²ç»æ¿€æ´»äº†æ­£ç¡®çš„è™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…äº†ä½ çš„ page-tracker åŒ…ã€‚è¿™åº”è¯¥åœ¨ç¦ç”¨è°ƒè¯•æ¨¡å¼çš„æƒ…å†µä¸‹åœ¨æœ¬åœ°ä¸»æœºå’Œç«¯å£ 5000 ä¸Šè¿è¡Œ Flask å¼€å‘æœåŠ¡å™¨ã€‚\nå¦‚æœä½ æƒ³ä»åŒä¸€ç½‘ç»œä¸Šçš„å¦ä¸€å°è®¡ç®—æœºè®¿é—®ä½ çš„æœåŠ¡å™¨ï¼Œé‚£ä¹ˆä½ å¿…é¡»ä½¿ç”¨ç‰¹æ®Šåœ°å€ 0.0.0.0 è€Œä¸æ˜¯é»˜è®¤çš„ localhost å°†å®ƒç»‘å®šåˆ°æ‰€æœ‰ç½‘ç»œæ¥å£ï¼Œå®ƒä»£è¡¨ç¯å›æ¥å£ï¼š\n(page-tracker) $ flask --app page_tracker.app run --host=0.0.0.0 \\ --port=8080 \\ --debug * Serving Flask app \u0026#39;page_tracker.app\u0026#39; * Debug mode: on WARNING: This is a development server. Do not use it in a production â®‘ deployment. Use a production WSGI server instead. * Running on all addresses (0.0.0.0) * Running on http://127.0.0.1:8080 * Running on http://192.168.0.115:8080 Press CTRL+C to quit * Restarting with stat * Debugger is active! * Debugger PIN: 123-167-546 å¦‚æœéœ€è¦ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨é€‚å½“çš„å‘½ä»¤è¡Œé€‰é¡¹æˆ–æ ‡å¿—æ›´æ”¹ç«¯å£å·å¹¶å¯ç”¨è°ƒè¯•æ¨¡å¼ã€‚\nå¯åŠ¨æœåŠ¡å™¨åï¼Œæ‚¨å¯ä»¥ç‚¹å‡»ç»ˆç«¯ä¸­æ˜¾ç¤ºçš„é“¾æ¥ï¼Œå¹¶åœ¨æ‚¨çš„ç½‘ç»œæµè§ˆå™¨ä¸­æŸ¥çœ‹åŒ…å«æµè§ˆé‡çš„é¡µé¢ã€‚æ¯æ¬¡åˆ·æ–°æ­¤é¡µé¢æ—¶ï¼Œè®¡æ•°å™¨åº”åŠ ä¸€ï¼š\nåšå¾—å¾ˆå¥½ï¼æ‚¨å·²ç»æˆåŠŸåˆ›å»ºäº†ä¸€ä¸ªåŸºæœ¬çš„ Flask åº”ç”¨ç¨‹åºï¼Œå®ƒä½¿ç”¨ Redis è·Ÿè¸ªé¡µé¢æµè§ˆé‡ã€‚æ¥ä¸‹æ¥ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•æµ‹è¯•å’Œä¿æŠ¤æ‚¨çš„ Web åº”ç”¨ç¨‹åºã€‚\næµ‹è¯•å’Œä¿æŠ¤æ‚¨çš„ Web åº”ç”¨ç¨‹åº åœ¨å°†ä»»ä½•é¡¹ç›®æ‰“åŒ…å¹¶éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¹‹å‰ï¼Œæ‚¨åº”è¯¥å½»åº•æµ‹è¯•ã€æ£€æŸ¥å’Œä¿æŠ¤åº•å±‚æºä»£ç ã€‚åœ¨æœ¬æ•™ç¨‹çš„è¿™ä¸€éƒ¨åˆ†ï¼Œæ‚¨å°†ç»ƒä¹ å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•å’Œç«¯åˆ°ç«¯æµ‹è¯•ã€‚æ‚¨è¿˜å°†æ‰§è¡Œé™æ€ä»£ç åˆ†æå’Œå®‰å…¨æ‰«æï¼Œä»¥åœ¨ä¿®å¤æˆæœ¬ä»ç„¶ä½å»‰çš„æƒ…å†µä¸‹è¯†åˆ«æ½œåœ¨çš„é—®é¢˜å’Œæ¼æ´ã€‚\nç”¨å•å…ƒæµ‹è¯•è¦†ç›–æºä»£ç  å•å…ƒæµ‹è¯•æ¶‰åŠæµ‹è¯•ç¨‹åºçš„å„ä¸ªå•å…ƒæˆ–ç»„ä»¶ï¼Œä»¥ç¡®ä¿å®ƒä»¬æŒ‰é¢„æœŸå·¥ä½œã€‚å¦‚ä»Šï¼Œå®ƒå·²æˆä¸ºè½¯ä»¶å¼€å‘çš„å¿…è¦ç»„æˆéƒ¨åˆ†ã€‚è®¸å¤šå·¥ç¨‹å¸ˆç”šè‡³æ›´è¿›ä¸€æ­¥ï¼Œä¸¥æ ¼éµå¾ªæµ‹è¯•é©±åŠ¨å¼€å‘æ–¹æ³•ï¼Œé¦–å…ˆç¼–å†™å•å…ƒæµ‹è¯•æ¥é©±åŠ¨ä»£ç è®¾è®¡ã€‚\nåœ¨ç¼–å†™å•å…ƒæµ‹è¯•æ—¶ï¼ŒPython ç¤¾åŒºä¸­çš„äººä»¬é€‰æ‹© pytest è€Œä¸æ˜¯æ ‡å‡†åº“çš„ unittest æ¨¡å—æ˜¯å¾ˆå¸¸è§çš„ã€‚ç”±äº pytest ç›¸å¯¹ç®€å•ï¼Œè¿™ä¸ªæµ‹è¯•æ¡†æ¶ä¸Šæ‰‹å¾ˆå¿«ã€‚ç»§ç»­å¹¶å°† pytest æ·»åŠ ä¸ºé¡¹ç›®çš„å¯é€‰ä¾èµ–é¡¹ï¼š\n# pyproject.toml [build-system] requires = [\u0026#34;setuptools\u0026gt;=67.0.0\u0026#34;, \u0026#34;wheel\u0026#34;] build-backend = \u0026#34;setuptools.build_meta\u0026#34; [project] name = \u0026#34;page-tracker\u0026#34; version = \u0026#34;1.0.0\u0026#34; dependencies = [ \u0026#34;Flask\u0026#34;, \u0026#34;redis\u0026#34;, ] [project.optional-dependencies] dev = [ \u0026#34;pytest\u0026#34;, ] æ‚¨å¯ä»¥å°†ä»¥æŸç§æ–¹å¼ç›¸å…³çš„å¯é€‰ä¾èµ–é¡¹åˆ†ç»„åœ¨ä¸€ä¸ªé€šç”¨åç§°ä¸‹ã€‚ä¾‹å¦‚ï¼Œåœ¨è¿™é‡Œï¼Œæ‚¨åˆ›å»ºäº†ä¸€ä¸ªåä¸º dev çš„ç»„æ¥æ”¶é›†æ‚¨å°†åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨çš„å·¥å…·å’Œåº“ã€‚é€šè¿‡å°† pytest ä¸ä¸»è¦ä¾èµ–é¡¹åˆ†å¼€ï¼Œæ‚¨å°†èƒ½å¤Ÿä»…åœ¨éœ€è¦æ—¶æŒ‰éœ€å®‰è£…å®ƒã€‚æ¯•ç«Ÿï¼Œå°†æ‚¨çš„æµ‹è¯•æˆ–ç›¸å…³çš„æµ‹è¯•æ¡†æ¶ä¸æ„å»ºçš„åˆ†å‘åŒ…æ†ç»‘åœ¨ä¸€èµ·æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚\nä¸è¦å¿˜è®°é‡æ–°å®‰è£…å¸¦æœ‰å¯é€‰ä¾èµ–é¡¹çš„ Python åŒ…ï¼Œä»¥ä½¿ pytest è¿›å…¥é¡¹ç›®çš„è™šæ‹Ÿç¯å¢ƒï¼š\n(page-tracker) $ python -m pip install --editable \u0026#34;.[dev]\u0026#34; æ‚¨å¯ä»¥ä½¿ç”¨æ–¹æ‹¬å·åˆ—å‡ºåœ¨æ‚¨çš„ pyproject.toml æ–‡ä»¶ä¸­å®šä¹‰çš„å¯é€‰ä¾èµ–ç»„çš„åç§°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨è¦æ±‚å®‰è£…ç”¨äºå¼€å‘ç›®çš„çš„ä¾èµ–é¡¹ï¼ŒåŒ…æ‹¬æµ‹è¯•æ¡†æ¶ã€‚è¯·æ³¨æ„ï¼Œå»ºè®®åœ¨æ–¹æ‹¬å·å‘¨å›´ä½¿ç”¨å¼•å· ( \u0026quot;\u0026quot; ) ä»¥é˜²æ­¢ shell ä¸­æ½œåœ¨çš„æ–‡ä»¶åæ‰©å±•ã€‚\nå› ä¸ºæ‚¨åœ¨é¡¹ç›®ä¸­éµå¾ªäº† src å¸ƒå±€ï¼Œæ‰€ä»¥æ‚¨ä¸å¿…å°†æµ‹è¯•æ¨¡å—ä¿å­˜åœ¨ä¸è¢«æµ‹ä»£ç ç›¸åŒçš„æ–‡ä»¶å¤¹æˆ–ç›¸åŒçš„å‘½åç©ºé—´åŒ…ä¸­ã€‚æ‚¨å¯ä»¥ä¸ºæµ‹è¯•åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„ç›®å½•åˆ†æ”¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\npage-tracker/ â”‚ â”œâ”€â”€ src/ â”‚ â””â”€â”€ page_tracker/ â”‚ â”œâ”€â”€ __init__.py â”‚ â””â”€â”€ app.py â”‚ â”œâ”€â”€ test/ â”‚ â””â”€â”€ unit/ â”‚ â””â”€â”€ test_app.py â”‚ â”œâ”€â”€ venv/ â”‚ â”œâ”€â”€ constraints.txt â””â”€â”€ pyproject.toml æ‚¨å·²å°†æµ‹è¯•æ¨¡å—æ”¾åœ¨ test/unit/ æ–‡ä»¶å¤¹ä¸­ä»¥ä¿æŒäº•äº•æœ‰æ¡ã€‚ pytest æ¡†æ¶å°†åœ¨æ‚¨ä¸ºæµ‹è¯•æ·»åŠ å‰ç¼€ test æ—¶å‘ç°æ‚¨çš„æµ‹è¯•ã€‚è™½ç„¶æ‚¨å¯ä»¥æ›´æ”¹å®ƒï¼Œä½†é€šå¸¸åœ¨ä½¿ç”¨ç›¸åº”çš„æµ‹è¯•æ¨¡å—é•œåƒæ¯ä¸ª Python æ¨¡å—æ—¶ä¿æŒé»˜è®¤çº¦å®šã€‚ä¾‹å¦‚ï¼Œæ‚¨å°†åœ¨ test/unit/ æ–‡ä»¶å¤¹ä¸­ç”¨ test_app è¦†ç›– app æ¨¡å—ã€‚\næ‚¨å°†ä»æµ‹è¯• Web åº”ç”¨ç¨‹åºçš„æˆåŠŸè·¯å¾„å¼€å§‹ï¼Œè¿™é€šå¸¸æ„å‘³ç€å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚æ¯ä¸ª Flask åº”ç”¨ç¨‹åºéƒ½å¸¦æœ‰ä¸€ä¸ªæ–¹ä¾¿çš„æµ‹è¯•å®¢æˆ·ç«¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥å‘å‡ºæ¨¡æ‹Ÿçš„ HTTP è¯·æ±‚ã€‚å› ä¸ºæµ‹è¯•å®¢æˆ·ç«¯ä¸éœ€è¦è¿è¡Œå®æ—¶æœåŠ¡å™¨ï¼Œæ‰€ä»¥ä½ çš„å•å…ƒæµ‹è¯•æ‰§è¡Œå¾—æ›´å¿«å¹¶ä¸”ä¼šå˜å¾—æ›´åŠ å­¤ç«‹ã€‚\næ‚¨å¯ä»¥è·å¾—æµ‹è¯•å®¢æˆ·ç«¯å¹¶å°†å…¶æ–¹ä¾¿åœ°åŒ…è£…åœ¨æµ‹è¯•è£…ç½®ä¸­ï¼Œä»¥ä½¿å…¶å¯ç”¨äºæ‚¨çš„æµ‹è¯•åŠŸèƒ½ï¼š\n# test/unit/test_app.py import pytest from page_tracker.app import app @pytest.fixture def http_client(): return app.test_client() é¦–å…ˆï¼Œæ‚¨å¯¼å…¥ pytest åŒ…ä»¥é’ˆå¯¹æ‚¨çš„è‡ªå®šä¹‰å‡½æ•°åˆ©ç”¨å…¶ @fixture è£…é¥°å™¨ã€‚ä»”ç»†é€‰æ‹©æ‚¨çš„å‡½æ•°åç§°ï¼Œå› ä¸ºå®ƒä¹Ÿä¼šæˆä¸ºæ‚¨å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™å„ä¸ªæµ‹è¯•å‡½æ•°çš„å¤¹å…·çš„åç§°ã€‚æ‚¨è¿˜å¯ä»¥ä» page_tracker åŒ…ä¸­å¯¼å…¥ Flask åº”ç”¨ç¨‹åºä»¥è·å–ç›¸åº”çš„æµ‹è¯•å®¢æˆ·ç«¯å®ä¾‹ã€‚\nå½“æ‚¨æ‰“ç®—ç¼–å†™å•å…ƒæµ‹è¯•æ—¶ï¼Œæ‚¨å¿…é¡»å§‹ç»ˆé€šè¿‡æ¶ˆé™¤ä»£ç å•å…ƒå¯èƒ½å…·æœ‰çš„ä»»ä½•ä¾èµ–å…³ç³»æ¥éš”ç¦»å®ƒã€‚è¿™æ„å‘³ç€æ‚¨åº”è¯¥æ¨¡æ‹Ÿæˆ–å­˜æ ¹æ‚¨çš„ä»£ç æ‰€ä¾èµ–çš„ä»»ä½•å¤–éƒ¨æœåŠ¡ã€æ•°æ®åº“æˆ–åº“ã€‚åœ¨æ‚¨çš„æƒ…å†µä¸‹ï¼ŒRedis æœåŠ¡å™¨å°±æ˜¯è¿™æ ·çš„ä¾èµ–é¡¹ã€‚\nä¸å¹¸çš„æ˜¯ï¼Œæ‚¨çš„ä»£ç ç›®å‰ä½¿ç”¨ç¡¬ç¼–ç çš„ Redis å®¢æˆ·ç«¯ï¼Œè¿™ä¼šé˜»æ­¢æ¨¡æ‹Ÿã€‚è¿™æ˜¯ä»ä¸€å¼€å§‹å°±éµå¾ªæµ‹è¯•é©±åŠ¨å¼€å‘çš„ä¸€ä¸ªå¾ˆå¥½çš„è®ºæ®ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€æ‚¨å¿…é¡»è¿”å›å¹¶é‡æ–°å¼€å§‹ã€‚ç›¸åï¼Œæ‚¨å°†é€šè¿‡å®æ–½ä¾èµ–æ³¨å…¥è®¾è®¡æ¨¡å¼æ¥é‡æ„æ‚¨çš„ä»£ç ï¼š\n# src/page_tracker/app.py +from functools import cache from flask import Flask from redis import Redis app = Flask(__name__) -redis = Redis() @app.get(\u0026#34;/\u0026#34;) def index(): - page_views = redis.incr(\u0026#34;page_views\u0026#34;) + page_views = redis().incr(\u0026#34;page_views\u0026#34;) return f\u0026#34;This page has been seen {page_views} times.\u0026#34; +@cache +def redis(): + return Redis() æœ¬è´¨ä¸Šï¼Œæ‚¨å°† Redis å®¢æˆ·ç«¯åˆ›å»ºä»£ç ä»å…¨å±€èŒƒå›´ç§»åŠ¨åˆ°ä¸€ä¸ªæ–°çš„ redis() å‡½æ•°ï¼Œæ‚¨çš„æ§åˆ¶å™¨å‡½æ•°ä¼šåœ¨è¿è¡Œæ—¶é’ˆå¯¹æ¯ä¸ªä¼ å…¥è¯·æ±‚è°ƒç”¨è¯¥å‡½æ•°ã€‚è¿™å°†å…è®¸æ‚¨çš„æµ‹è¯•ç”¨ä¾‹åœ¨æ­£ç¡®çš„æ—¶é—´ç”¨æ¨¡æ‹Ÿå¯¹åº”ç‰©æ›¿æ¢è¿”å›çš„ Redis å®ä¾‹ã€‚ä½†æ˜¯ï¼Œä¸ºäº†ç¡®ä¿å†…å­˜ä¸­åªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯å®ä¾‹ï¼Œæœ‰æ•ˆåœ°ä½¿å…¶æˆä¸ºä¸€ä¸ªå•ä¾‹ï¼Œæ‚¨è¿˜ç¼“å­˜äº†æ–°å‡½æ•°çš„ç»“æœã€‚\nç°åœ¨å›åˆ°æ‚¨çš„æµ‹è¯•æ¨¡å—å¹¶å®æ–½ä»¥ä¸‹å•å…ƒæµ‹è¯•ï¼š\n# test/unit/test_app.py import unittest.mock import pytest from page_tracker.app import app @pytest.fixture def http_client(): return app.test_client() @unittest.mock.patch(\u0026#34;page_tracker.app.redis\u0026#34;) def test_should_call_redis_incr(mock_redis, http_client): # Given mock_redis.return_value.incr.return_value = 5 # When response = http_client.get(\u0026#34;/\u0026#34;) # Then assert response.status_code == 200 assert response.text == \u0026#34;This page has been seen 5 times.\u0026#34; mock_redis.return_value.incr.assert_called_once_with(\u0026#34;page_views\u0026#34;) æ‚¨ä½¿ç”¨ Python çš„ @patch è£…é¥°å™¨åŒ…è£…æ‚¨çš„æµ‹è¯•å‡½æ•°ï¼Œä»¥å°†æ¨¡æ‹Ÿçš„ Redis å®¢æˆ·ç«¯ä½œä¸ºå‚æ•°æ³¨å…¥å…¶ä¸­ã€‚æ‚¨è¿˜å‘Šè¯‰ pytest å°†æ‚¨çš„ HTTP æµ‹è¯•å®¢æˆ·ç«¯è£…ç½®ä½œä¸ºå¦ä¸€ä¸ªå‚æ•°æ³¨å…¥ã€‚æµ‹è¯•å‡½æ•°æœ‰ä¸€ä¸ªæè¿°æ€§åç§°ï¼Œä»¥åŠ¨è¯ should å¼€å¤´å¹¶éµå¾ª Given-When-Then æ¨¡å¼ã€‚è¿™ä¸¤ä¸ªå¸¸ç”¨äºè¡Œä¸ºé©±åŠ¨å¼€å‘çš„çº¦å®šï¼Œä½¿æ‚¨çš„æµ‹è¯•è¢«è§£è¯»ä¸ºè¡Œä¸ºè§„èŒƒã€‚\nåœ¨æ‚¨çš„æµ‹è¯•ç”¨ä¾‹ä¸­ï¼Œæ‚¨é¦–å…ˆå°†æ¨¡æ‹Ÿ Redis å®¢æˆ·ç«¯è®¾ç½®ä¸ºåœ¨å…¶ .incr() æ–¹æ³•è¢«è°ƒç”¨æ—¶å§‹ç»ˆè¿”å› 5 ã€‚ç„¶åï¼Œæ‚¨å‘æ ¹ç«¯ç‚¹ ( / ) å‘å‡ºä¼ªé€ çš„ HTTP è¯·æ±‚å¹¶æ£€æŸ¥æœåŠ¡å™¨çš„å“åº”çŠ¶æ€å’Œæ­£æ–‡ã€‚å› ä¸ºæ¨¡æ‹Ÿå¯ä»¥å¸®åŠ©æ‚¨æµ‹è¯•å•å…ƒçš„è¡Œä¸ºï¼Œæ‰€ä»¥æ‚¨åªéœ€éªŒè¯æœåŠ¡å™¨æ˜¯å¦ä½¿ç”¨é¢„æœŸå‚æ•°è°ƒç”¨äº†æ­£ç¡®çš„æ–¹æ³•ï¼Œå¹¶ç›¸ä¿¡ Redis å®¢æˆ·ç«¯åº“å¯ä»¥æ­£å¸¸å·¥ä½œã€‚\nè¦æ‰§è¡Œå•å…ƒæµ‹è¯•ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»£ç ç¼–è¾‘å™¨ä¸­é›†æˆçš„æµ‹è¯•è¿è¡Œå™¨ï¼Œä¹Ÿå¯ä»¥åœ¨ç»ˆç«¯ä¸­é”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼š\n(page-tracker) $ python -m pytest -v test/unit/ æ‚¨ä»è™šæ‹Ÿç¯å¢ƒä¸­å°† pytest ä½œä¸º Python æ¨¡å—è¿è¡Œï¼ŒæŒ‡ç¤ºå®ƒæ‰«æ test/unit/ ç›®å½•ä»¥ä¾¿åœ¨é‚£é‡ŒæŸ¥æ‰¾æµ‹è¯•æ¨¡å—ã€‚ -v å¼€å…³å¢åŠ äº†æµ‹è¯•æŠ¥å‘Šçš„è¯¦ç»†ç¨‹åº¦ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥çœ‹åˆ°æœ‰å…³å„ä¸ªæµ‹è¯•ç”¨ä¾‹çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚\nåœ¨æ‰€æœ‰å•å…ƒæµ‹è¯•éƒ½é€šè¿‡åç›¯ç€ç»¿è‰²æŠ¥å‘Šä¼šæ„Ÿåˆ°æ»¡è¶³ã€‚å®ƒä½¿æ‚¨å¯¹ä»£ç æœ‰ä¸€å®šç¨‹åº¦çš„ä¿¡å¿ƒï¼Œä½†ä¸è¶³ä»¥åšå‡ºä»»ä½•å½¢å¼çš„ä¿è¯ã€‚è®¸å¤šæ¨¡å› è¯´æ˜äº†å³ä½¿åœ¨å•å…ƒæµ‹è¯•é€šè¿‡åè¿è¡Œé›†æˆæµ‹è¯•çš„é‡è¦æ€§ã€‚\nä¾‹å¦‚ï¼Œå…¶ä¸­ä¸€ä¸ªç»å…¸æ¨¡å› æ˜¾ç¤ºæœ‰ä¸¤ä¸ªæŠ½å±‰ï¼Œä½†ä¸€æ¬¡åªèƒ½æ‰“å¼€ä¸€ä¸ªã€‚è™½ç„¶æ¯ä¸ªå•ç‹¬çš„æŠ½å±‰æˆ–å•å…ƒéƒ½ç»è¿‡æµ‹è¯•å¹¶ç‹¬ç«‹å·¥ä½œï¼Œä½†å½“æ‚¨å°è¯•å°†å®ƒä»¬é›†æˆåˆ°ä¸€ä»¶å®¶å…·ä¸­æ—¶ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ã€‚æ¥ä¸‹æ¥ï¼Œæ‚¨å°†å‘æ‚¨çš„é¡¹ç›®æ·»åŠ ä¸€ä¸ªåŸºæœ¬çš„é›†æˆæµ‹è¯•ã€‚\né€šè¿‡é›†æˆæµ‹è¯•æ£€æŸ¥ç»„ä»¶äº¤äº’ é›†æˆæµ‹è¯•åº”è¯¥æ˜¯è¿è¡Œå•å…ƒæµ‹è¯•åçš„ä¸‹ä¸€ä¸ªé˜¶æ®µã€‚é›†æˆæµ‹è¯•çš„ç›®æ ‡æ˜¯æ£€æŸ¥æ‚¨çš„ç»„ä»¶ä½œä¸ºæ›´å¤§ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†å¦‚ä½•ç›¸äº’äº¤äº’ã€‚\nä¾‹å¦‚ï¼Œæ‚¨çš„é¡µé¢è·Ÿè¸ªå™¨ Web åº”ç”¨ç¨‹åºå¯èƒ½å…·æœ‰é›†æˆæµ‹è¯•ï¼Œç”¨äºæ£€æŸ¥ä¸çœŸæ­£çš„ Redis æœåŠ¡å™¨è€Œä¸æ˜¯æ¨¡æ‹ŸæœåŠ¡å™¨çš„é€šä¿¡ã€‚\næ‚¨å¯ä»¥é‡å¤ä½¿ç”¨ pytest æ¥å®æ–½å’Œè¿è¡Œé›†æˆæµ‹è¯•ã€‚ä½†æ˜¯ï¼Œæ‚¨å°†å®‰è£…ä¸€ä¸ªé¢å¤–çš„ pytest-timeout æ’ä»¶ï¼Œä»¥å…è®¸æ‚¨å¼ºåˆ¶è¿è¡Œæ—¶é—´è¿‡é•¿çš„æµ‹è¯•ç”¨ä¾‹å¤±è´¥ï¼š\n# pyproject.toml [build-system] requires = [\u0026#34;setuptools\u0026gt;=67.0.0\u0026#34;, \u0026#34;wheel\u0026#34;] build-backend = \u0026#34;setuptools.build_meta\u0026#34; [project] name = \u0026#34;page-tracker\u0026#34; version = \u0026#34;1.0.0\u0026#34; dependencies = [ \u0026#34;Flask\u0026#34;, \u0026#34;redis\u0026#34;, ] [project.optional-dependencies] dev = [ \u0026#34;pytest\u0026#34;, \u0026#34;pytest-timeout\u0026#34;, ] ç†æƒ³æƒ…å†µä¸‹ï¼Œæ‚¨ä¸å¿…æ‹…å¿ƒå•å…ƒæµ‹è¯•è¶…æ—¶ï¼Œå› ä¸ºå®ƒä»¬åº”è¯¥é’ˆå¯¹é€Ÿåº¦è¿›è¡Œä¼˜åŒ–ã€‚å¦ä¸€æ–¹é¢ï¼Œé›†æˆæµ‹è¯•å°†éœ€è¦æ›´é•¿çš„æ—¶é—´æ¥è¿è¡Œï¼Œå¹¶ä¸”å¯èƒ½ä¼šåœ¨åœæ»çš„ç½‘ç»œè¿æ¥ä¸Šæ— é™æŒ‚èµ·ï¼Œä»è€Œé˜»æ­¢æ‚¨çš„æµ‹è¯•å¥—ä»¶å®Œæˆã€‚å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æœ‰åŠæ³•ä¸­æ­¢å®ƒä»¬å¾ˆé‡è¦ã€‚\nè¯·è®°ä½å†æ¬¡é‡æ–°å®‰è£…å¸¦æœ‰å¯é€‰ä¾èµ–é¡¹çš„åŒ…ï¼Œä»¥ä½¿ pytest-timeout æ’ä»¶å¯ç”¨ï¼š\n(page-tracker) $ python -m pip install --editable \u0026#34;.[dev]\u0026#34; åœ¨ç»§ç»­ä¹‹å‰ï¼Œä¸ºæ‚¨çš„é›†æˆæµ‹è¯•æ·»åŠ å¦ä¸€ä¸ªå­æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨æ‚¨çš„ test/ æ–‡ä»¶å¤¹ä¸­å®šä¹‰ä¸€ä¸ª conftest.py æ–‡ä»¶ï¼š\npage-tracker/ â”‚ â”œâ”€â”€ src/ â”‚ â””â”€â”€ page_tracker/ â”‚ â”œâ”€â”€ __init__.py â”‚ â””â”€â”€ app.py â”‚ â”œâ”€â”€ test/ â”‚ â”œâ”€â”€ integration/ â”‚ â”‚ â””â”€â”€ test_app_redis.py â”‚ â”‚ â”‚ â”œâ”€â”€ unit/ â”‚ â”‚ â””â”€â”€ test_app.py â”‚ â”‚ â”‚ â””â”€â”€ conftest.py â”‚ â”œâ”€â”€ venv/ â”‚ â”œâ”€â”€ constraints.txt â””â”€â”€ pyproject.toml æ‚¨å°†åœ¨ conftest.py ä¸­æ”¾ç½®å…¬å…±è£…ç½®ï¼Œä¸åŒç±»å‹çš„æµ‹è¯•å°†å…±äº«è¿™äº›è£…ç½®ã€‚\nè™½ç„¶æ‚¨çš„ Web åº”ç”¨ç¨‹åºåªæœ‰ä¸€ä¸ªç»„ä»¶ï¼Œä½†æ‚¨å¯ä»¥å°† Redis è§†ä¸º Flask éœ€è¦ä½¿ç”¨çš„å¦ä¸€ä¸ªç»„ä»¶ã€‚å› æ­¤ï¼Œé›†æˆæµ‹è¯•å¯èƒ½çœ‹èµ·æ¥ä¸æ‚¨çš„å•å…ƒæµ‹è¯•ç±»ä¼¼ï¼Œåªæ˜¯ä¸å†æ¨¡æ‹Ÿ Redis å®¢æˆ·ç«¯ï¼š\n# test/integration/test_app_redis.py import pytest @pytest.mark.timeout(1.5) def test_should_update_redis(redis_client, http_client): # Given redis_client.set(\u0026#34;page_views\u0026#34;, 4) # When response = http_client.get(\u0026#34;/\u0026#34;) # Then assert response.status_code == 200 assert response.text == \u0026#34;This page has been seen 5 times.\u0026#34; assert redis_client.get(\u0026#34;page_views\u0026#34;) == b\u0026#34;5\u0026#34; ä»æ¦‚å¿µä¸Šè®²ï¼Œæ‚¨çš„æ–°æµ‹è¯•ç”¨ä¾‹åŒ…å«ä¸ä»¥å‰ç›¸åŒçš„æ­¥éª¤ï¼Œä½†å®ƒä¸çœŸæ­£çš„ Redis æœåŠ¡å™¨äº¤äº’ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ ç»™æµ‹è¯•æœ€å¤š 1.5 ç§’æ¥å®Œæˆä½¿ç”¨ @pytest.mark.timeout è£…é¥°å™¨ã€‚æµ‹è¯•å‡½æ•°å°†ä¸¤ä¸ªå¤¹å…·ä½œä¸ºå‚æ•°ï¼š\nè¿æ¥åˆ°æœ¬åœ°æ•°æ®å­˜å‚¨çš„ Redis å®¢æˆ·ç«¯ Flask çš„æµ‹è¯•å®¢æˆ·ç«¯è¿æ¥åˆ°æ‚¨çš„ Web åº”ç”¨ç¨‹åº ä¸ºäº†ä½¿ç¬¬äºŒä¸ªåœ¨æ‚¨çš„é›†æˆæµ‹è¯•ä¸­ä¹Ÿå¯ç”¨ï¼Œæ‚¨å¿…é¡»å°† http_client() å¤¹å…·ä» test_app æ¨¡å—ç§»åŠ¨åˆ° conftest.py æ–‡ä»¶ï¼š\n# test/conftest.py import pytest import redis from page_tracker.app import app @pytest.fixture def http_client(): return app.test_client() @pytest.fixture(scope=\u0026#34;module\u0026#34;) def redis_client(): return redis.Redis() ç”±äºæ­¤æ–‡ä»¶ä½äºæ–‡ä»¶å¤¹å±‚æ¬¡ç»“æ„çš„ä¸Šä¸€å±‚ï¼Œ pytest å°†é€‰å–å…¶ä¸­å®šä¹‰çš„æ‰€æœ‰ç¯å…·ï¼Œå¹¶ä½¿å®ƒä»¬åœ¨æ•´ä¸ªåµŒå¥—æ–‡ä»¶å¤¹ä¸­å¯è§ã€‚é™¤äº†æ‚¨ä»å¦ä¸€ä¸ª Python æ¨¡å—ç§»åŠ¨çš„ç†Ÿæ‚‰çš„ http_client() å¤¹å…·ä¹‹å¤–ï¼Œæ‚¨è¿˜å®šä¹‰äº†ä¸€ä¸ªè¿”å›é»˜è®¤ Redis å®¢æˆ·ç«¯çš„æ–°å¤¹å…·ã€‚è¯·æ³¨æ„ï¼Œæ‚¨ä¸ºå®ƒæŒ‡å®šäº† module èŒƒå›´ï¼Œä»¥ä¾¿ä¸ºæµ‹è¯•æ¨¡å—ä¸­çš„æ‰€æœ‰å‡½æ•°é‡ç”¨ç›¸åŒçš„ Redis å®¢æˆ·ç«¯å®ä¾‹ã€‚\nè¦æ‰§è¡Œé›†æˆæµ‹è¯•ï¼Œæ‚¨å¿…é¡»ä»”ç»†æ£€æŸ¥ Redis æœåŠ¡å™¨æ˜¯å¦åœ¨æœ¬åœ°é»˜è®¤ç«¯å£ 6379 ä¸Šè¿è¡Œï¼Œç„¶ååƒä»¥å‰ä¸€æ ·å¯åŠ¨ pytest ï¼Œä½†å°†å…¶æŒ‡å‘åŒ…å«é›†æˆæµ‹è¯•çš„æ–‡ä»¶å¤¹ï¼š\n(page-tracker) $ python -m pytest -v test/integration/ å› ä¸ºæ‚¨çš„é›†æˆæµ‹è¯•è¿æ¥åˆ°å®é™…çš„ Redis æœåŠ¡å™¨ï¼Œæ‰€ä»¥å®ƒä¼šè¦†ç›–æ‚¨ä¹‹å‰å¯èƒ½å­˜å‚¨åœ¨ page_views é”®ä¸‹çš„å€¼ã€‚ä½†æ˜¯ï¼Œå¦‚æœåœ¨æ‰§è¡Œé›†æˆæµ‹è¯•æ—¶ Redis æœåŠ¡å™¨æœªè¿è¡Œï¼Œæˆ–è€…å¦‚æœ Redis åœ¨å…¶ä»–åœ°æ–¹è¿è¡Œï¼Œé‚£ä¹ˆæ‚¨çš„æµ‹è¯•å°†å¤±è´¥ã€‚è¿™ç§å¤±è´¥å¯èƒ½æ˜¯å‡ºäºé”™è¯¯çš„åŸå› ï¼Œä½¿ç»“æœæˆä¸ºå‡é˜´æ€§é”™è¯¯ï¼Œå› ä¸ºæ‚¨çš„ä»£ç å®é™…ä¸Šå¯èƒ½æŒ‰é¢„æœŸå·¥ä½œã€‚\nè¦è§‚å¯Ÿæ­¤é—®é¢˜ï¼Œè¯·ç«‹å³åœæ­¢ Redis å¹¶é‡æ–°è¿è¡Œé›†æˆæµ‹è¯•ï¼š\n(page-tracker) $ docker stop redis-server redis-server (page-tracker) $ python -m pytest -v test/integration/ â‹® ========================= short test summary info ========================== FAILED test/integration/test_app_redis.py::test_should_update_redis - â®‘redis.exceptions.ConnectionError: Error 111 connecting to localhost:6379. â®‘Connection refused ============================ 1 failed in 0.19s ============================= è¿™æ­ç¤ºäº†æ‚¨çš„ä»£ç ä¸­çš„ä¸€ä¸ªé—®é¢˜ï¼Œè¯¥é—®é¢˜ç›®å‰æ— æ³•å¦¥å–„å¤„ç† Redis è¿æ¥é”™è¯¯ã€‚æœ¬ç€æµ‹è¯•é©±åŠ¨å¼€å‘çš„ç²¾ç¥ï¼Œæ‚¨å¯ä»¥é¦–å…ˆç¼–å†™ä¸€ä¸ªé‡ç°è¯¥é—®é¢˜çš„æµ‹è¯•ç”¨ä¾‹ï¼Œç„¶åä¿®å¤å®ƒã€‚åˆ‡æ¢ä¸€ä¸‹ï¼Œä½¿ç”¨æ¨¡æ‹Ÿçš„ Redis å®¢æˆ·ç«¯åœ¨ test_app æ¨¡å—ä¸­æ·»åŠ ä»¥ä¸‹å•å…ƒæµ‹è¯•ï¼š\n# test/unit/test_app.py import unittest.mock from redis import ConnectionError # ... @unittest.mock.patch(\u0026#34;page_tracker.app.redis\u0026#34;) def test_should_handle_redis_connection_error(mock_redis, http_client): # Given mock_redis.return_value.incr.side_effect = ConnectionError # When response = http_client.get(\u0026#34;/\u0026#34;) # Then assert response.status_code == 500 assert response.text == \u0026#34;Sorry, something went wrong \\N{pensive face}\u0026#34; æ‚¨è®¾ç½®æ¨¡æ‹Ÿçš„ .incr() æ–¹æ³•çš„å‰¯ä½œç”¨ï¼Œä»¥ä¾¿è°ƒç”¨è¯¥æ–¹æ³•å°†å¼•å‘ redis.ConnectionError å¼‚å¸¸ï¼Œè¿™æ˜¯æ‚¨åœ¨é›†æˆæµ‹è¯•å¤±è´¥æ—¶è§‚å¯Ÿåˆ°çš„ã€‚æ‚¨çš„æ–°å•å…ƒæµ‹è¯•æ˜¯è´Ÿé¢æµ‹è¯•çš„ä¸€ä¸ªç¤ºä¾‹ï¼Œå®ƒæœŸæœ› Flask ä»¥ HTTP çŠ¶æ€ä»£ç  500 å’Œæè¿°æ€§æ¶ˆæ¯è¿›è¡Œå“åº”ã€‚ä»¥ä¸‹æ˜¯æ»¡è¶³è¯¥å•å…ƒæµ‹è¯•çš„æ–¹æ³•ï¼š\n# src/page_tracker/app.py from functools import cache from flask import Flask from redis import Redis, RedisError app = Flask(__name__) @app.get(\u0026#34;/\u0026#34;) def index(): try: page_views = redis().incr(\u0026#34;page_views\u0026#34;) except RedisError: app.logger.exception(\u0026#34;Redis error\u0026#34;) return \u0026#34;Sorry, something went wrong \\N{pensive face}\u0026#34;, 500 else: return f\u0026#34;This page has been seen {page_views} times.\u0026#34; @cache def redis(): return Redis() æ‚¨æ‹¦æˆªé¡¶çº§å¼‚å¸¸ç±» redis.RedisError ï¼Œå®ƒæ˜¯ Redis å®¢æˆ·ç«¯å¼•å‘çš„æ‰€æœ‰å¼‚å¸¸ç±»å‹çš„ç¥–å…ˆã€‚å¦‚æœå‡ºç°ä»»ä½•é—®é¢˜ï¼Œæ‚¨å°†è¿”å›é¢„æœŸçš„ HTTP çŠ¶æ€ä»£ç å’Œä¸€æ¡æ¶ˆæ¯ã€‚ä¸ºæ–¹ä¾¿èµ·è§ï¼Œæ‚¨è¿˜ä½¿ç”¨ Flask å†…ç½®çš„è®°å½•å™¨è®°å½•å¼‚å¸¸ã€‚\næ³¨æ„ï¼šè™½ç„¶çˆ¶ç±»æ˜¯å­ç±»ç›´æ¥æ‰©å±•çš„ç›´æ¥åŸºç±»ï¼Œä½†ç¥–å…ˆç±»å¯ä»¥ä½äºç»§æ‰¿å±‚æ¬¡ç»“æ„ä¸­æ›´ä¸Šå±‚çš„ä»»ä½•ä½ç½®ã€‚\nå¥½æäº†ï¼ç”±äºæµ‹è¯•ï¼Œæ‚¨ä¿®æ”¹äº†å•å…ƒæµ‹è¯•ï¼Œå®æ–½äº†é›†æˆæµ‹è¯•ï¼Œå¹¶åœ¨å‘ç°ä»£ç ä¸­çš„ç¼ºé™·åä¿®å¤äº†å®ƒã€‚\nå°½ç®¡å¦‚æ­¤ï¼Œå½“æ‚¨å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°è¿œç¨‹ç¯å¢ƒæ—¶ï¼Œæ‚¨å¦‚ä½•çŸ¥é“æ‰€æœ‰éƒ¨åˆ†éƒ½ç»„åˆåœ¨ä¸€èµ·å¹¶ä¸”ä¸€åˆ‡éƒ½æŒ‰é¢„æœŸå·¥ä½œï¼Ÿ\nåœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæ‚¨å°†é€šè¿‡å¯¹å®é™… Flask æœåŠ¡å™¨è€Œä¸æ˜¯æµ‹è¯•å®¢æˆ·ç«¯æ‰§è¡Œç«¯åˆ°ç«¯æµ‹è¯•æ¥æ¨¡æ‹ŸçœŸå®åœºæ™¯ã€‚\næµ‹è¯•çœŸå®åœºæ™¯ç«¯åˆ°ç«¯ ç«¯åˆ°ç«¯æµ‹è¯•ï¼Œä¹Ÿç§°ä¸ºå¹¿æ³›å †æ ˆæµ‹è¯•ï¼ŒåŒ…å«å¤šç§æµ‹è¯•ï¼Œå¯ä»¥å¸®åŠ©æ‚¨éªŒè¯æ•´ä¸ªç³»ç»Ÿã€‚ä»–ä»¬é€šè¿‡æ¨¡æ‹Ÿå®é™…ç”¨æˆ·é€šè¿‡åº”ç”¨ç¨‹åºçš„æµç¨‹æ¥æµ‹è¯•å®Œæ•´çš„è½¯ä»¶å †æ ˆã€‚å› æ­¤ï¼Œç«¯åˆ°ç«¯æµ‹è¯•éœ€è¦ä¸€ä¸ªå°½å¯èƒ½æ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒçš„éƒ¨ç½²ç¯å¢ƒã€‚é€šå¸¸è¿˜éœ€è¦ä¸“é—¨çš„æµ‹è¯•å·¥ç¨‹å¸ˆå›¢é˜Ÿã€‚\næ³¨æ„ï¼šç”±äºç«¯åˆ°ç«¯æµ‹è¯•çš„ç»´æŠ¤æˆæœ¬å¾ˆé«˜ï¼Œè€Œä¸”å¾€å¾€éœ€è¦èŠ±è´¹å¤§é‡æ—¶é—´æ¥è®¾ç½®å’Œè¿è¡Œï¼Œå› æ­¤å®ƒä»¬ä½äº Google æµ‹è¯•é‡‘å­—å¡”çš„é¡¶ç«¯ã€‚æ¢å¥è¯è¯´ï¼Œæ‚¨çš„ç›®æ ‡åº”è¯¥æ˜¯è¿›è¡Œæ›´å¤šçš„é›†æˆæµ‹è¯•ï¼Œç”šè‡³åœ¨æ‚¨çš„é¡¹ç›®ä¸­è¿›è¡Œæ›´å¤šçš„å•å…ƒæµ‹è¯•ã€‚\nç”±äºæ‚¨æœ€ç»ˆå¸Œæœ›ä¸ºæ‚¨çš„ Docker åº”ç”¨ç¨‹åºæ„å»ºä¸€ä¸ªæˆç†Ÿçš„æŒç»­é›†æˆç®¡é“ï¼Œå› æ­¤è¿›è¡Œä¸€äº›ç«¯åˆ°ç«¯æµ‹è¯•å°†å˜å¾—è‡³å…³é‡è¦ã€‚é¦–å…ˆä¸ºæ‚¨çš„ E2E æµ‹è¯•æ·»åŠ å¦ä¸€ä¸ªå­æ–‡ä»¶å¤¹ï¼š\npage-tracker/ â”‚ â”œâ”€â”€ src/ â”‚ â””â”€â”€ page_tracker/ â”‚ â”œâ”€â”€ __init__.py â”‚ â””â”€â”€ app.py â”‚ â”œâ”€â”€ test/ â”‚ â”œâ”€â”€ e2e/ â”‚ â”‚ â””â”€â”€ test_app_redis_http.py â”‚ â”‚ â”‚ â”œâ”€â”€ integration/ â”‚ â”‚ â””â”€â”€ test_app_redis.py â”‚ â”‚ â”‚ â”œâ”€â”€ unit/ â”‚ â”‚ â””â”€â”€ test_app.py â”‚ â”‚ â”‚ â””â”€â”€ conftest.py â”‚ â”œâ”€â”€ venv/ â”‚ â”œâ”€â”€ constraints.txt â””â”€â”€ pyproject.toml æ‚¨å°†è¦å®æ–½çš„æµ‹è¯•åœºæ™¯å°†ç±»ä¼¼äºæ‚¨çš„é›†æˆæµ‹è¯•ã€‚ä¸è¿‡ï¼Œä¸»è¦åŒºåˆ«åœ¨äºæ‚¨å°†é€šè¿‡ç½‘ç»œå°†å®é™…çš„ HTTP è¯·æ±‚å‘é€åˆ°å®æ—¶ Web æœåŠ¡å™¨ï¼Œè€Œä¸æ˜¯ä¾èµ– Flask çš„æµ‹è¯•å®¢æˆ·ç«¯ã€‚\nä¸ºæ­¤ï¼Œæ‚¨å°†ä½¿ç”¨ç¬¬ä¸‰æ–¹ requests åº“ï¼Œæ‚¨å¿…é¡»é¦–å…ˆåœ¨ pyproject.toml æ–‡ä»¶ä¸­å°†å…¶æŒ‡å®šä¸ºå¦ä¸€ä¸ªå¯é€‰ä¾èµ–é¡¹ï¼š\n# pyproject.toml [build-system] requires = [\u0026#34;setuptools\u0026gt;=67.0.0\u0026#34;, \u0026#34;wheel\u0026#34;] build-backend = \u0026#34;setuptools.build_meta\u0026#34; [project] name = \u0026#34;page-tracker\u0026#34; version = \u0026#34;1.0.0\u0026#34; dependencies = [ \u0026#34;Flask\u0026#34;, \u0026#34;redis\u0026#34;, ] [project.optional-dependencies] dev = [ \u0026#34;pytest\u0026#34;, \u0026#34;pytest-timeout\u0026#34;, \u0026#34;requests\u0026#34;, ] æ‚¨ä¸ä¼šä½¿ç”¨ requests åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡ŒæœåŠ¡å™¨ï¼Œå› æ­¤æ— éœ€å°†å…¶ä½œä¸ºå¸¸è§„ä¾èµ–é¡¹ã€‚åŒæ ·ï¼Œä½¿ç”¨å¯ç¼–è¾‘æ¨¡å¼é‡æ–°å®‰è£…å¸¦æœ‰å¯é€‰ä¾èµ–é¡¹çš„ Python åŒ…ï¼š\n(page-tracker) $ python -m pip install --editable \u0026#34;.[dev]\u0026#34; æ‚¨ç°åœ¨å¯ä»¥åœ¨ç«¯åˆ°ç«¯æµ‹è¯•ä¸­ä½¿ç”¨å·²å®‰è£…çš„ requests åº“ï¼š\n# test/e2e/test_app_redis_http.py import pytest import requests @pytest.mark.timeout(1.5) def test_should_update_redis(redis_client, flask_url): # Given redis_client.set(\u0026#34;page_views\u0026#34;, 4) # When response = requests.get(flask_url) # Then assert response.status_code == 200 assert response.text == \u0026#34;This page has been seen 5 times.\u0026#34; assert redis_client.get(\u0026#34;page_views\u0026#34;) == b\u0026#34;5\u0026#34; é™¤äº†è´Ÿè´£å‘é€ HTTP GET è¯·æ±‚çš„ç¬¬ 12 è¡Œä¹‹å¤–ï¼Œæ­¤ä»£ç ä¸æ‚¨çš„é›†æˆæµ‹è¯•å‡ ä¹ç›¸åŒã€‚ä¹‹å‰ï¼Œæ‚¨å°†è¯¥è¯·æ±‚å‘é€åˆ°æµ‹è¯•å®¢æˆ·ç«¯çš„æ ¹åœ°å€ï¼Œç”¨æ–œæ å­—ç¬¦ ( / ) è¡¨ç¤ºã€‚ç°åœ¨ï¼Œæ‚¨ä¸çŸ¥é“å¯èƒ½åœ¨è¿œç¨‹ä¸»æœºä¸Šè¿è¡Œçš„ Flask æœåŠ¡å™¨çš„ç¡®åˆ‡åŸŸæˆ– IP åœ°å€ã€‚å› æ­¤ï¼Œæ‚¨çš„å‡½æ•°æ¥æ”¶ä¸€ä¸ª Flask URL ä½œä¸ºå‚æ•°ï¼Œ pytest å°†å…¶ä½œä¸ºå›ºå®šè£…ç½®æ³¨å…¥ã€‚\næ‚¨å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæä¾›ç‰¹å®šçš„ç½‘ç»œæœåŠ¡å™¨åœ°å€ã€‚åŒæ ·ï¼Œæ‚¨çš„ Redis æœåŠ¡å™¨å¯èƒ½åœ¨ä¸åŒçš„ä¸»æœºä¸Šè¿è¡Œï¼Œå› æ­¤æ‚¨ä¹Ÿéœ€è¦æä¾›å…¶åœ°å€ä½œä¸ºå‘½ä»¤è¡Œå‚æ•°ã€‚å¯æ˜¯ç­‰ç­‰ï¼æ‚¨çš„ Flask åº”ç”¨ç¨‹åºå½“å‰æœŸæœ› Redis å§‹ç»ˆåœ¨æœ¬åœ°ä¸»æœºä¸Šè¿è¡Œã€‚ç»§ç»­å¹¶æ›´æ–°æ‚¨çš„ä»£ç ä»¥ä½¿å…¶å¯é…ç½®ï¼š\n# src/page_tracker/app.py import os from functools import cache from flask import Flask from redis import Redis, RedisError app = Flask(__name__) @app.get(\u0026#34;/\u0026#34;) def index(): try: page_views = redis().incr(\u0026#34;page_views\u0026#34;) except RedisError: app.logger.exception(\u0026#34;Redis error\u0026#34;) return \u0026#34;Sorry, something went wrong \\N{pensive face}\u0026#34;, 500 else: return f\u0026#34;This page has been seen {page_views} times.\u0026#34; @cache def redis(): return Redis.from_url(os.getenv(\u0026#34;REDIS_URL\u0026#34;, \u0026#34;redis://localhost:6379\u0026#34;)) é€šå¸¸ä½¿ç”¨ç¯å¢ƒå˜é‡æ¥è®¾ç½®æ•æ„Ÿæ•°æ®ï¼Œä¾‹å¦‚æ•°æ®åº“ URLï¼Œå› ä¸ºå®ƒæä¾›äº†é¢å¤–çº§åˆ«çš„å®‰å…¨æ€§å’Œçµæ´»æ€§ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨çš„ç¨‹åºéœ€è¦ä¸€ä¸ªè‡ªå®šä¹‰çš„ REDIS_URL å˜é‡ã€‚å¦‚æœåœ¨ç»™å®šç¯å¢ƒä¸­æœªæŒ‡å®šè¯¥å˜é‡ï¼Œåˆ™æ‚¨å°†å›é€€åˆ°é»˜è®¤ä¸»æœºå’Œç«¯å£ã€‚\nè¦ä½¿ç”¨è‡ªå®šä¹‰å‘½ä»¤è¡Œå‚æ•°æ‰©å±• pytest ï¼Œæ‚¨å¿…é¡»ç¼–è¾‘ conftest.py å¹¶æŒ‰ä»¥ä¸‹æ–¹å¼è¿æ¥åˆ°æ¡†æ¶çš„å‚æ•°è§£æå™¨ï¼š\n# test/conftest.py import pytest import redis from page_tracker.app import app def pytest_addoption(parser): parser.addoption(\u0026#34;--flask-url\u0026#34;) parser.addoption(\u0026#34;--redis-url\u0026#34;) @pytest.fixture(scope=\u0026#34;session\u0026#34;) def flask_url(request): return request.config.getoption(\u0026#34;--flask-url\u0026#34;) @pytest.fixture(scope=\u0026#34;session\u0026#34;) def redis_url(request): return request.config.getoption(\u0026#34;--redis-url\u0026#34;) @pytest.fixture def http_client(): return app.test_client() @pytest.fixture(scope=\u0026#34;module\u0026#34;) def redis_client(redis_url): if redis_url: return redis.Redis.from_url(redis_url) return redis.Redis() æ‚¨ä½¿ç”¨ç±»ä¼¼äº Python çš„ argparse æ¨¡å—çš„è¯­æ³•å®šä¹‰ä¸¤ä¸ªå¯é€‰å‚æ•°ï¼Œ --flask-url å’Œ --redis-url ã€‚ç„¶åï¼Œæ‚¨å°†è¿™äº›å‚æ•°åŒ…è£…åœ¨ä¼šè¯èŒƒå›´çš„å›ºå®šè£…ç½®ä¸­ï¼Œæ‚¨å°†èƒ½å¤Ÿå°†å…¶æ³¨å…¥åˆ°æ‚¨çš„æµ‹è¯•å‡½æ•°å’Œå…¶ä»–å›ºå®šè£…ç½®ä¸­ã€‚å…·ä½“æ¥è¯´ï¼Œæ‚¨ç°æœ‰çš„ redis_client() fixture ç°åœ¨å¯ä»¥åˆ©ç”¨å¯é€‰çš„ Redis URLã€‚\næ³¨æ„ï¼šå› ä¸ºæ‚¨çš„ç«¯åˆ°ç«¯æµ‹è¯•å’Œé›†æˆæµ‹è¯•ä¾èµ–äºç›¸åŒçš„ redis_client() fixtureï¼Œæ‰€ä»¥æ‚¨å¯ä»¥é€šè¿‡åœ¨ä¸¤ç§ç±»å‹çš„æµ‹è¯•ä¸­æŒ‡å®š --redis-url é€‰é¡¹æ¥è¿æ¥åˆ°è¿œç¨‹ Redis æœåŠ¡å™¨ã€‚\nè¿™æ˜¯é€šè¿‡æŒ‡å®š Flask Web æœåŠ¡å™¨å’Œç›¸åº”çš„ Redis æœåŠ¡å™¨çš„ URL æ¥ä½¿ç”¨ pytest è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•çš„æ–¹æ³•ï¼š\n(page-tracker) $ python -m pytest -v test/e2e/ \\ --flask-url http://127.0.0.1:5000 \\ --redis-url redis://127.0.0.1:6379 åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥é€šè¿‡æœ¬åœ°ä¸»æœº ( 127.0.0.1 ) è®¿é—® Flask å’Œ Redisï¼Œä½†æ‚¨çš„åº”ç”¨ç¨‹åºå¯èƒ½ä¼šéƒ¨ç½²åˆ°ç”±å¤šå°è¿œç¨‹è®¡ç®—æœºç»„æˆçš„åœ°ç†åˆ†å¸ƒå¼ç¯å¢ƒä¸­ã€‚å½“ä½ åœ¨æœ¬åœ°æ‰§è¡Œæ­¤å‘½ä»¤æ—¶ï¼Œç¡®ä¿ Redis æ­£åœ¨è¿è¡Œå¹¶é¦–å…ˆå•ç‹¬å¯åŠ¨ä½ çš„ Flask æœåŠ¡å™¨ï¼š\n(page-tracker) $ docker start redis-server (page-tracker) $ flask --app page_tracker.app run ä¸ºäº†æé«˜ä»£ç è´¨é‡ï¼Œå¦‚æœæ‚¨æœ‰èƒ½åŠ›ï¼Œå¯ä»¥ä¸æ–­å‘æ‚¨çš„åº”ç”¨ç¨‹åºæ·»åŠ æ›´å¤šç±»å‹çš„æµ‹è¯•ã€‚ä¸è¿‡ï¼Œè¿™é€šå¸¸éœ€è¦ä¸€ä¸ªå…¨èŒè½¯ä»¶è´¨é‡ä¿è¯å·¥ç¨‹å¸ˆå›¢é˜Ÿã€‚å¦ä¸€æ–¹é¢ï¼Œæ‰§è¡Œä»£ç å®¡æŸ¥æˆ–å…¶ä»–ç±»å‹çš„é™æ€ä»£ç åˆ†ææ˜¯ç›¸å½“å®¹æ˜“å®ç°çš„ï¼Œå¯ä»¥å‘ç°è®¸å¤šä»¤äººæƒŠè®¶çš„é—®é¢˜ã€‚æ‚¨ç°åœ¨å°†æŸ¥çœ‹æ­¤è¿‡ç¨‹ã€‚\næ‰§è¡Œé™æ€ä»£ç åˆ†æå’Œå®‰å…¨æ‰«æ ç°åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºå·²æŒ‰é¢„æœŸè¿è¡Œï¼Œæ˜¯æ—¶å€™åœ¨ä¸æ‰§è¡Œåº•å±‚ä»£ç çš„æƒ…å†µä¸‹æ‰§è¡Œé™æ€ä»£ç åˆ†æäº†ã€‚è¿™æ˜¯è½¯ä»¶å¼€å‘è¡Œä¸šçš„ä¸€ç§å¸¸è§åšæ³•ï¼Œå¯å¸®åŠ©å¼€å‘äººå‘˜è¯†åˆ«å…¶ä»£ç ä¸­çš„æ½œåœ¨è½¯ä»¶ç¼ºé™·å’Œå®‰å…¨é£é™©ã€‚\nè™½ç„¶é™æ€åˆ†æçš„æŸäº›æ­¥éª¤å¯ä»¥è‡ªåŠ¨å®Œæˆï¼Œä½†å…¶ä»–æ­¥éª¤é€šå¸¸éœ€è¦æ‰‹åŠ¨å®Œæˆï¼Œä¾‹å¦‚åŒè¡Œè¯„å®¡ã€‚\næ‚¨å°†ä½¿ç”¨ä»¥ä¸‹è‡ªåŠ¨åŒ–å·¥å…·ï¼Œå› æ­¤è¯·å°†å®ƒä»¬ä½œä¸ºå¯é€‰ä¾èµ–é¡¹æ·»åŠ åˆ°æ‚¨çš„ pyproject.toml æ–‡ä»¶ä¸­ï¼š\n# pyproject.toml [build-system] requires = [\u0026#34;setuptools\u0026gt;=67.0.0\u0026#34;, \u0026#34;wheel\u0026#34;] build-backend = \u0026#34;setuptools.build_meta\u0026#34; [project] name = \u0026#34;page-tracker\u0026#34; version = \u0026#34;1.0.0\u0026#34; dependencies = [ \u0026#34;Flask\u0026#34;, \u0026#34;redis\u0026#34;, ] [project.optional-dependencies] dev = [ \u0026#34;bandit\u0026#34;, \u0026#34;black\u0026#34;, \u0026#34;flake8\u0026#34;, \u0026#34;isort\u0026#34;, \u0026#34;pylint\u0026#34;, \u0026#34;pytest\u0026#34;, \u0026#34;pytest-timeout\u0026#34;, \u0026#34;requests\u0026#34;, ] ä¹‹åä¸è¦å¿˜è®°é‡æ–°å®‰è£…å¹¶å›ºå®šæ‚¨çš„ä¾èµ–é¡¹ï¼š\n(page-tracker) $ python -m pip install --editable \u0026#34;.[dev]\u0026#34; (page-tracker) $ python -m pip freeze --exclude-editable \u0026gt; constraints.txt è¿™ä¼šå°†ä¸€äº›å‘½ä»¤è¡Œå®ç”¨å·¥å…·å¸¦å…¥æ‚¨çš„è™šæ‹Ÿç¯å¢ƒã€‚é¦–å…ˆï¼Œæ‚¨åº”è¯¥é€šè¿‡ä¸€è‡´åœ°æ ¼å¼åŒ–ä»£ç ã€å¯¹ import è¯­å¥è¿›è¡Œæ’åºå¹¶æ£€æŸ¥ PEP 8 åˆè§„æ€§æ¥æ¸…ç†ä»£ç ï¼š\n(page-tracker) $ python -m black src/ --check would reformat /home/realpython/page-tracker/src/page_tracker/app.py Oh no! ğŸ’¥ ğŸ’” ğŸ’¥ 1 file would be reformatted, 1 file would be left unchanged. (page-tracker) $ python -m isort src/ --check ERROR: /home/.../app.py Imports are incorrectly sorted and/or formatted. (page-tracker) $ python -m flake8 src/ src/page_tracker/app.py:23:1: E302 expected 2 blank lines, found 1 æ‚¨ä½¿ç”¨ black æ ‡è®°ä»£ç ä¸­çš„ä»»ä½•æ ¼å¼ä¸ä¸€è‡´ï¼Œä½¿ç”¨ isort ç¡®ä¿æ‚¨çš„ import è¯­å¥æ ¹æ®å®˜æ–¹å»ºè®®ä¿æŒç»„ç»‡ï¼Œä½¿ç”¨ flake8 æ£€æŸ¥ä»»ä½•å…¶ä»– PEP 8 æ ·å¼è¿è§„ã€‚\nå¦‚æœæ‚¨åœ¨è¿è¡Œè¿™äº›å·¥å…·åæ²¡æœ‰çœ‹åˆ°ä»»ä½•è¾“å‡ºï¼Œåˆ™æ„å‘³ç€æ²¡æœ‰ä»€ä¹ˆå¯ä»¥ä¿®å¤çš„ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœå‡ºç°è­¦å‘Šæˆ–é”™è¯¯ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥æ‰‹åŠ¨æ›´æ­£ä»»ä½•æŠ¥å‘Šçš„é—®é¢˜ï¼Œæˆ–è€…è®©è¿™äº›å·¥å…·åœ¨æ‚¨åˆ é™¤ --check æ ‡å¿—æ—¶è‡ªåŠ¨æ‰§è¡Œï¼š\n(page-tracker) $ python -m black src/ reformatted /home/realpython/page-tracker/src/page_tracker/app.py All done! âœ¨ ğŸ° âœ¨ 1 file reformatted, 1 file left unchanged. (page-tracker) $ python -m isort src/ Fixing /home/realpython/page-tracker/src/page_tracker/app.py (page-tracker) $ python -m flake8 src/ å¦‚æœæ²¡æœ‰ --check æ ‡å¿—ï¼Œ black å’Œ isort éƒ½ä¼šç»§ç»­å¹¶åœ¨ä¸è¯¢é—®çš„æƒ…å†µä¸‹é‡æ–°æ ¼å¼åŒ–å—å½±å“çš„æ–‡ä»¶ã€‚è¿è¡Œè¿™ä¸¤ä¸ªå‘½ä»¤è¿˜è§£å†³äº† PEP 8 åˆè§„æ€§é—®é¢˜ï¼Œå› ä¸º flake8 ä¸å†è¿”å›ä»»ä½•æ ·å¼è¿è§„ã€‚\næ³¨æ„ï¼šéµå¾ªæ•´ä¸ªå›¢é˜Ÿçš„é€šç”¨ä»£ç é£æ ¼çº¦å®šæœ‰åŠ©äºä¿æŒä»£ç æ•´æ´ã€‚è¿™æ ·ï¼Œå½“ä¸€ä¸ªäººæ›´æ–°æºæ–‡ä»¶æ—¶ï¼Œå›¢é˜Ÿæˆå‘˜å°±ä¸å¿…å¯¹ä¸ç›¸å…³ä»£ç éƒ¨åˆ†ï¼ˆä¾‹å¦‚ç©ºæ ¼ï¼‰çš„æ›´æ”¹è¿›è¡Œåˆ†ç±»ã€‚\nä¸€æ—¦ä¸€åˆ‡éƒ½å¹²å‡€äº†ï¼Œæ‚¨å°±å¯ä»¥å¯¹ä»£ç è¿›è¡Œ lint ä»¥æŸ¥æ‰¾æ½œåœ¨çš„ä»£ç å¼‚å‘³æˆ–æ”¹è¿›å®ƒçš„æ–¹æ³•ï¼š\n(page-tracker) $ python -m pylint src/ å½“æ‚¨é’ˆå¯¹ Web åº”ç”¨ç¨‹åºçš„æºä»£ç è¿è¡Œ pylint æ—¶ï¼Œå®ƒå¯èƒ½ä¼šå¼€å§‹æŠ±æ€¨æˆ–å¤šæˆ–å°‘æœ‰ç”¨çš„ä¸œè¥¿ã€‚å®ƒé€šå¸¸å‘å‡ºå±äºå‡ ä¸ªç±»åˆ«çš„æ¶ˆæ¯ï¼ŒåŒ…æ‹¬ï¼š\nE: Errors W: Warnings C: è¿åå…¬çº¦ R: é‡æ„å»ºè®® æ¯æ¡è¯„è®ºéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œä¾‹å¦‚ C0116 ï¼Œå¦‚æœæ‚¨è§‰å¾—å®ƒæ²¡æœ‰å¸®åŠ©ï¼Œæ‚¨å¯ä»¥å°†å…¶éšè—ã€‚æ‚¨å¯ä»¥åœ¨å…¨å±€é…ç½®æ–‡ä»¶ä¸­åŒ…å«æŠ‘åˆ¶çš„æ ‡è¯†ç¬¦ä»¥è·å¾—æ°¸ä¹…æ•ˆæœï¼Œæˆ–è€…ä½¿ç”¨å‘½ä»¤è¡Œå¼€å…³å¿½ç•¥ç»™å®šè¿è¡Œä¸­çš„æŸäº›é”™è¯¯ã€‚\næ‚¨è¿˜å¯ä»¥åœ¨ç»™å®šè¡Œä¸Šæ·»åŠ ç‰¹æ®Šæ ¼å¼çš„ Python æ³¨é‡Šä»¥è¯´æ˜ç‰¹æ®Šæƒ…å†µï¼š\n# src/page_tracker/app.py import os from functools import cache from flask import Flask from redis import Redis, RedisError app = Flask(__name__) @app.get(\u0026#34;/\u0026#34;) def index(): try: page_views = redis().incr(\u0026#34;page_views\u0026#34;) except RedisError: app.logger.exception(\u0026#34;Redis error\u0026#34;) # pylint: disable=E1101 return \u0026#34;Sorry, something went wrong \\N{pensive face}\u0026#34;, 500 else: return f\u0026#34;This page has been seen {page_views} times.\u0026#34; @cache def redis(): return Redis.from_url(os.getenv(\u0026#34;REDIS_URL\u0026#34;, \u0026#34;redis://localhost:6379\u0026#34;)) åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å‘Šè¯‰ pylint å¿½ç•¥é”™è¯¯ E1101 çš„ç‰¹å®šå®ä¾‹ï¼Œè€Œä¸æ˜¯å®Œå…¨æŠ‘åˆ¶å®ƒã€‚è¿™æ˜¯ä¸€ä¸ªè¯¯æŠ¥ï¼Œå› ä¸º .logger æ˜¯ Flask åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„åŠ¨æ€å±æ€§ï¼Œåœ¨é™æ€åˆ†æè¿‡ç¨‹ä¸­ä¸å¯ç”¨ã€‚\næ³¨æ„ï¼šå¦‚æœæ‚¨æ‰“ç®—ä½¿ç”¨ pylint ä½œä¸ºè‡ªåŠ¨åŒ–æŒç»­é›†æˆç®¡é“çš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½éœ€è¦æŒ‡å®šå®ƒä½•æ—¶åº”è¯¥é€€å‡ºå¹¶æ˜¾ç¤ºé”™è¯¯ä»£ç ï¼Œè¿™é€šå¸¸ä¼šåœæ­¢ç®¡é“çš„åç»­æ­¥éª¤ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å°†å…¶é…ç½®ä¸ºå§‹ç»ˆè¿”å›ä¸­æ€§é€€å‡ºä»£ç é›¶ï¼š\n(page-tracker) $ python -m pylint src/ --exit-zero è¿™æ°¸è¿œä¸ä¼šåœæ­¢ç®¡é“è¿è¡Œï¼Œå³ä½¿ pylint åœ¨ä»£ç ä¸­å‘ç°ä¸€äº›é—®é¢˜ã€‚æˆ–è€…ï¼Œä½¿ç”¨ --fail-under ï¼Œæ‚¨å¯ä»¥æŒ‡å®šä»»æ„åˆ†æ•°é˜ˆå€¼ï¼Œ pylint å°†åœ¨è¯¥é˜ˆå€¼æ—¶é€€å‡ºå¹¶æ˜¾ç¤ºé”™è¯¯ä»£ç ã€‚\næ‚¨ä¼šæ³¨æ„åˆ° pylint ä¸ºæ‚¨çš„ä»£ç æ‰“åˆ†å¹¶å¯¹å…¶è¿›è¡Œè·Ÿè¸ªã€‚å½“æ‚¨ä»¥æŸç§æ–¹å¼è§£å†³é—®é¢˜å¹¶å†æ¬¡è¿è¡Œè¯¥å·¥å…·æ—¶ï¼Œå®ƒä¼šæŠ¥å‘Šä¸€ä¸ªæ–°åˆ†æ•°å¹¶å‘Šè¯‰æ‚¨å®ƒæ”¹å–„æˆ–æ¶åŒ–äº†å¤šå°‘ã€‚ä½¿ç”¨æ‚¨çš„æœ€ä½³åˆ¤æ–­æ¥å†³å®š pylint æŠ¥å‘Šçš„é—®é¢˜æ˜¯å¦å€¼å¾—ä¿®å¤ã€‚\næœ€åï¼Œæ— æ„ä¸­é€šè¿‡æºä»£ç æ³„éœ²æ•æ„Ÿæ•°æ®æˆ–æš´éœ²å…¶ä»–å®‰å…¨æ¼æ´çš„æƒ…å†µéå¸¸æ™®éã€‚å®ƒç”šè‡³å‘ç”Ÿåœ¨æœ€å¥½çš„è½¯ä»¶å·¥ç¨‹å¸ˆèº«ä¸Šã€‚æœ€è¿‘ï¼ŒGitHub åœ¨ä¸€ä¸ªå…¬å…±å­˜å‚¨åº“ä¸­æš´éœ²äº†å®ƒçš„ç§é’¥ï¼Œè¿™å¯èƒ½è®©æ”»å‡»è€…å†’å……è¿™ä¸ªå·¨å¤´ã€‚ä¸ºäº†é™ä½æ­¤ç±»äº‹ä»¶çš„é£é™©ï¼Œæ‚¨åº”è¯¥åœ¨å°†æºä»£ç éƒ¨ç½²åˆ°ä»»ä½•åœ°æ–¹ä¹‹å‰å¯¹å…¶è¿›è¡Œå®‰å…¨æˆ–æ¼æ´æ‰«æã€‚\nè¦æ‰«ææ‚¨çš„ä»£ç ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ bandit ï¼Œå®ƒæ˜¯æ‚¨ä¹‹å‰ä½œä¸ºå¯é€‰ä¾èµ–é¡¹å®‰è£…çš„ï¼š\n(page-tracker) $ python -m bandit -r src/ å½“æ‚¨æŒ‡å®šæ–‡ä»¶å¤¹è·¯å¾„è€Œä¸æ˜¯æ–‡ä»¶è·¯å¾„æ—¶ï¼Œè¿˜å¿…é¡»åŒ…å« -r æ ‡å¿—ä»¥é€’å½’æ‰«æå®ƒã€‚æ­¤æ—¶ï¼Œ bandit åº”è¯¥ä¸ä¼šåœ¨æ‚¨çš„ä»£ç ä¸­å‘ç°ä»»ä½•é—®é¢˜ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨åœ¨ Flask åº”ç”¨ç¨‹åºåº•éƒ¨æ·»åŠ ä»¥ä¸‹ä¸¤è¡Œåå†æ¬¡è¿è¡Œå®ƒï¼Œé‚£ä¹ˆè¯¥å·¥å…·å°†æŠ¥å‘Šä¸åŒä¸¥é‡çº§åˆ«çš„é—®é¢˜ï¼š\n# src/page_tracker/app.py # ... if __name__ == \u0026#34;__main__\u0026#34;: app.run(host=\u0026#34;0.0.0.0\u0026#34;, port=5000, debug=True) è¿™ç§ name-main æƒ¯ç”¨è¯­æ˜¯è®¸å¤š Flask åº”ç”¨ç¨‹åºä¸­å¸¸è§çš„æ¨¡å¼ï¼Œå› ä¸ºå®ƒä½¿å¼€å‘æ›´æ–¹ä¾¿ï¼Œè®©æ‚¨ç›´æ¥è¿è¡Œ Python æ¨¡å—ã€‚å¦ä¸€æ–¹é¢ï¼Œå®ƒæš´éœ²äº† Flask çš„è°ƒè¯•å™¨ï¼Œå…è®¸æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¹¶é€šè¿‡åœ°å€ 0.0.0.0 ç»‘å®šåˆ°æ‰€æœ‰ç½‘ç»œæ¥å£ï¼Œä¸ºå…¬å…±æµé‡æ‰“å¼€æ‚¨çš„æœåŠ¡ã€‚\nå› æ­¤ï¼Œä¸ºäº†ç¡®ä¿æ‚¨çš„ Flask åº”ç”¨ç¨‹åºæ˜¯å®‰å…¨çš„ï¼Œæ‚¨åº”è¯¥å§‹ç»ˆåœ¨å°†ä»£ç éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¹‹å‰è¿è¡Œ bandit æˆ–ç±»ä¼¼å·¥å…·ã€‚\nå¥½çš„ã€‚æ‚¨çš„ Web åº”ç”¨ç¨‹åºåŒ…å«å•å…ƒã€é›†æˆå’Œç«¯åˆ°ç«¯æµ‹è¯•ã€‚è¿™æ„å‘³ç€è®¸å¤šè‡ªåŠ¨åŒ–å·¥å…·å·²ç»é™æ€åˆ†æå’Œä¿®æ”¹äº†å®ƒçš„æºä»£ç ã€‚\næ¥ä¸‹æ¥ï¼Œæ‚¨å°†ç»§ç»­é€šè¿‡å°†åº”ç”¨ç¨‹åºåŒ…è£…åœ¨ Docker å®¹å™¨ä¸­æ¥å®ç°æŒç»­é›†æˆï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥å°†æ•´ä¸ªé¡¹ç›®éƒ¨ç½²åˆ°è¿œç¨‹ç¯å¢ƒæˆ–å¿ å®åœ°å°†å…¶å¤åˆ¶åˆ°æœ¬åœ°è®¡ç®—æœºä¸Šã€‚\nå°†æ‚¨çš„ Flask Web åº”ç”¨ç¨‹åº Docker åŒ– åœ¨æœ¬èŠ‚ä¸­ï¼Œæ‚¨å°†ä»¥ Docker å®¹å™¨çš„å½¢å¼è¿è¡Œæ‚¨çš„é¡µé¢è·Ÿè¸ªå™¨ Web åº”ç”¨ç¨‹åºï¼Œè¯¥å®¹å™¨å¯ä»¥ä¸åœ¨å¦ä¸€ä¸ªå®¹å™¨ä¸­è¿è¡Œçš„ Redis é€šä¿¡ã€‚è¿™æ ·çš„è®¾ç½®å¯¹äºå¼€å‘å’Œæµ‹è¯•ä»¥åŠå°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°è¿œç¨‹ç¯å¢ƒå¾ˆæœ‰ç”¨ã€‚\nå³ä½¿æ‚¨çš„è®¡ç®—æœºä¸Šæ²¡æœ‰å®‰è£… Python æˆ– Redisï¼Œæ‚¨ä»ç„¶å¯ä»¥é€šè¿‡ Docker è¿è¡Œæ‚¨çš„é¡¹ç›®ã€‚\nç†è§£ Docker æœ¯è¯­ å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œ Docker åŒ–æ¶‰åŠåˆ›å»º Dockerfileï¼Œå®ƒæ˜¯å¯¹ç¯å¢ƒæ‰€éœ€çŠ¶æ€çš„å£°æ˜æ€§æè¿°ã€‚å®ƒä¸ºè¿è¡Œæ—¶ç¯å¢ƒã€é…ç½®ä»¥åŠè¿è¡Œåº”ç”¨ç¨‹åºæ‰€éœ€çš„æ‰€æœ‰ä¾èµ–é¡¹å’Œåº“æä¾›æ¨¡æ¿ã€‚\nè¦ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºæ³¨å…¥æ´»åŠ›ï¼Œæ‚¨å¿…é¡»æ ¹æ®è¯¥æè¿°æ„å»ºä¸€ä¸ª Docker é•œåƒã€‚æ‚¨å¯ä»¥å°† Docker é•œåƒè§†ä¸ºæ“ä½œç³»ç»Ÿåœ¨ç»™å®šæ—¶é—´çš„å¿«ç…§ã€‚å½“æ‚¨ä¸ä¸–ç•Œæˆ–å…¬å¸å†…éƒ¨å…±äº«æ‚¨çš„ Docker é•œåƒæ—¶ï¼Œå…¶ä»–äººå¯ä»¥é‡ç°ä¸æ‚¨å®Œå…¨ç›¸åŒçš„ç¯å¢ƒå¹¶è¿è¡Œç›¸åŒçš„åº”ç”¨ç¨‹åºã€‚\nè¿™å›é¿äº†ç»å…¸ï¼Œä½†å®ƒé€‚ç”¨äºæˆ‘çš„æœºå™¨é—®é¢˜ã€‚\nDocker é•œåƒæ˜¯ Docker å®¹å™¨çš„è“å›¾ã€‚æ¯ä¸ª Docker å®¹å™¨éƒ½æ˜¯ Docker é•œåƒçš„ä¸€ä¸ªå®ä¾‹ã€‚ä¸€ä¸ªå®¹å™¨æœ‰ç‹¬ç«‹çš„çŠ¶æ€å’Œèµ„æºï¼ŒåŒ…æ‹¬å®ƒè‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿã€ç¯å¢ƒå˜é‡å’Œç½‘ç»œæ¥å£ã€‚å•ä¸ª Docker å®¹å™¨é€šå¸¸è¿è¡Œå•ä¸ªè¿›ç¨‹ï¼Œä½¿å…¶æˆä¸ºæ‰˜ç®¡ç‰¹å®šå¾®æœåŠ¡çš„ç†æƒ³é€‰æ‹©ã€‚\né€šè¿‡æ·»åŠ æ›´å¤šå®¹å™¨ï¼Œæ‚¨å¯ä»¥ä¸´æ—¶æ‰©å±•ä¸€ä¸ªæˆ–å¤šä¸ªå¾®æœåŠ¡ä»¥å¤„ç†æµé‡é«˜å³°ï¼Œä¾‹å¦‚ï¼Œè¿™åœ¨å‡æœŸæœŸé—´å¯èƒ½å¾ˆå¸¸è§ã€‚ä½†æ˜¯ï¼Œæ‚¨çš„å¾®æœåŠ¡å¿…é¡»æ¶æ„è‰¯å¥½å¹¶ä¿æŒæ— çŠ¶æ€æ‰èƒ½ä½¿å…¶æœ‰æ•ˆã€‚\næ³¨æ„ï¼šDocker å®¹å™¨ç±»ä¼¼äº Vagrant æˆ– VirtualBox ç­‰è™šæ‹Ÿæœºï¼Œä½†æ›´è½»å·§ä¸”å¯åŠ¨é€Ÿåº¦æ›´å¿«ã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥åŒæ—¶åœ¨ä¸»æœºä¸Šè¿è¡Œæ¯”è™šæ‹Ÿæœºæ›´å¤šçš„å®¹å™¨ã€‚\nè¿™æ ·åšçš„åŸå› æ˜¯å®¹å™¨çš„å¼€é”€è¾ƒå°ï¼Œå› ä¸ºå®ƒä»¬å…±äº«æ“ä½œç³»ç»Ÿçš„å†…æ ¸ï¼Œè€Œè™šæ‹Ÿæœºè¿è¡Œåœ¨æ¨¡æ‹Ÿå®Œæ•´ç¡¬ä»¶å †æ ˆçš„ç®¡ç†ç¨‹åºä¸Šã€‚å¦ä¸€æ–¹é¢ï¼Œå®¹å™¨ä¸é‚£ä¹ˆå®‰å…¨ï¼Œå®ƒä»¬ä¹Ÿä¸æä¾›ä¸è™šæ‹Ÿæœºç›¸åŒçº§åˆ«çš„éš”ç¦»ã€‚\nå…¸å‹çš„åº”ç”¨ç¨‹åºåŒ…æ‹¬åœ¨éš”ç¦»çš„ Docker å®¹å™¨ä¸­è¿è¡Œçš„å¤šä¸ªæœåŠ¡ï¼Œè¿™äº›å®¹å™¨å¯ä»¥ç›¸äº’é€šä¿¡ã€‚æ‚¨çš„é¡µé¢è·Ÿè¸ªå™¨åº”ç”¨ç¨‹åºæœ‰ä»¥ä¸‹ä¸¤ä¸ªï¼š\nWeb service Redis service æ‚¨å·²ç»çŸ¥é“å¦‚ä½•é€šè¿‡ Docker è¿è¡Œ Redisã€‚ç°åœ¨ï¼Œæ˜¯æ—¶å€™å°†æ‚¨çš„ Flask Web åº”ç”¨ç¨‹åºæ²™ç›’åŒ–åˆ° Docker å®¹å™¨ä¸­ï¼Œä»¥ç®€åŒ–è¿™ä¸¤ç§æœåŠ¡çš„å¼€å‘å’Œéƒ¨ç½²è¿‡ç¨‹ã€‚\näº†è§£ Dockerfile çš„å‰–æ é¦–å…ˆï¼Œæ‚¨å°†å®šä¹‰ä¸€ä¸ªé€‚ç”¨äºå¼€å‘é˜¶æ®µçš„ç›¸å¯¹è¾ƒçŸ­çš„ Dockerfileã€‚åœ¨é¡¹ç›®æ ¹æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º Dockerfile çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸æ–‡ä»¶å±‚æ¬¡ç»“æ„ä¸­çš„ src/ å­æ–‡ä»¶å¤¹å’Œ pyproject.toml é…ç½®æ–‡ä»¶å¤„äºåŒä¸€çº§åˆ«ï¼š\npage-tracker/ â”‚ â”œâ”€â”€ src/ â”‚ â””â”€â”€ page_tracker/ â”‚ â”œâ”€â”€ __init__.py â”‚ â””â”€â”€ app.py â”‚ â”œâ”€â”€ test/ â”‚ â”œâ”€â”€ venv/ â”‚ â”œâ”€â”€ constraints.txt â”œâ”€â”€ Dockerfile â””â”€â”€ pyproject.toml æ‚¨å¯ä»¥éšæ„å‘½åæ­¤æ–‡ä»¶ï¼Œä½†åšæŒé»˜è®¤å‘½åçº¦å®šå°†ä½¿æ‚¨ä¸å¿…åœ¨æ¯æ¬¡æ„å»ºé•œåƒæ—¶éƒ½æŒ‡å®šæ–‡ä»¶åã€‚ Docker æœŸæœ›çš„é»˜è®¤æ–‡ä»¶åæ˜¯ Dockerfile ï¼Œæ²¡æœ‰æ–‡ä»¶æ‰©å±•åã€‚è¯·æ³¨æ„ï¼Œå®ƒä»¥å¤§å†™å­—æ¯ D å¼€å¤´ã€‚\nDockerfile æ˜¯ä¸€ä¸ªçº¯æ–‡æœ¬æ–‡æ¡£ï¼Œå…¶ä¸­åˆ—å‡ºäº†ç»„è£…é•œåƒæ‰€éœ€çš„æ­¥éª¤ã€‚å®ƒéµå¾ªç‰¹å®šæ ¼å¼ï¼Œå®šä¹‰äº†ä¸€å¥—å›ºå®šçš„è¯´æ˜ä¾›æ‚¨ä½¿ç”¨ã€‚\næ³¨æ„ï¼šæ‚¨å¿…é¡»å°† Dockerfile ä¸­çš„æ¯æ¡æŒ‡ä»¤æ”¾åœ¨å•ç‹¬çš„ä¸€è¡Œä¸­ï¼Œä½†çœ‹åˆ°éå¸¸é•¿çš„è¡Œè¢«è¡Œè¿ç»­å­—ç¬¦ ( \\ ) å¤šæ¬¡æ‰“æ–­çš„æƒ…å†µå¹¶ä¸å°‘è§ã€‚äº‹å®ä¸Šï¼Œé€šå¸¸éœ€è¦åœ¨ä¸€è¡Œä¸­å¡å…¥å¤šä¸ªæ“ä½œï¼Œä»¥åˆ©ç”¨æ‚¨ç°åœ¨å°†è¦äº†è§£çš„ç¼“å­˜æœºåˆ¶ã€‚\nå½“æ‚¨ä» Dockerfile æ„å»ºé•œåƒæ—¶ï¼Œæ‚¨ä¾èµ–äºä¸€ç³»åˆ—å±‚ã€‚æ¯æ¡æŒ‡ä»¤éƒ½ä¼šåœ¨å‰ä¸€å±‚ä¹‹ä¸Šåˆ›å»ºä¸€ä¸ªåªè¯»å±‚ï¼Œå°è£…å¯¹é•œåƒåº•å±‚æ–‡ä»¶ç³»ç»Ÿçš„ä¸€äº›ä¿®æ”¹ã€‚å›¾å±‚å…·æœ‰å…¨å±€å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œè¿™å…è®¸ Docker å°†å›¾å±‚å­˜å‚¨åœ¨ç¼“å­˜ä¸­ã€‚è¿™æœ‰ä¸¤ä¸ªä¸»è¦ä¼˜ç‚¹ï¼š\né€Ÿåº¦ï¼šDocker å¯ä»¥è·³è¿‡è‡ªä¸Šæ¬¡æ„å»ºä»¥æ¥æœªæ›´æ”¹çš„å±‚ï¼Œè€Œæ˜¯ä»ç¼“å­˜ä¸­åŠ è½½å®ƒä»¬ï¼Œä»è€Œæ˜¾ç€åŠ å¿«é•œåƒæ„å»ºé€Ÿåº¦ã€‚ å¤§å°ï¼šå¤šä¸ªé•œåƒå¯ä»¥å…±äº«å…¬å…±å›¾å±‚ï¼Œä»è€Œå‡å°å®ƒä»¬å„è‡ªçš„å¤§å°ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå±‚æ•°è¶Šå°‘ï¼Œé•œåƒå°ºå¯¸è¶Šå°ã€‚ ç°åœ¨æ‚¨å·²ç»äº†è§£äº† Dockerfile çš„è¿™ç§åˆ†å±‚ç»“æ„ï¼Œæ‚¨å¯ä»¥å¼€å§‹å‘å…¶ä¸­æ·»åŠ æŒ‡ä»¤ï¼ŒåŒæ—¶äº†è§£åˆ›å»ºé«˜æ•ˆ Docker é•œåƒçš„æœ€ä½³å®è·µã€‚\né€‰æ‹©åŸºç¡€ Docker é•œåƒ æ¯ä¸ª Dockerfile ä¸­çš„ç¬¬ä¸€æ¡æŒ‡ä»¤ FROM å¿…é¡»å§‹ç»ˆå®šä¹‰ç”¨äºæ„å»ºæ–°é•œåƒçš„åŸºç¡€é•œåƒã€‚è¿™æ„å‘³ç€æ‚¨ä¸å¿…ä»å¤´å¼€å§‹ï¼Œè€Œæ˜¯å¯ä»¥é€‰æ‹©ä¸€ä¸ªå·²ç»æ„å»ºçš„åˆé€‚é•œåƒã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Python è§£é‡Šå™¨é™„å¸¦çš„é•œåƒï¼š\n# Dockerfile FROM python:3.11.2-slim-bullseye åœ¨è¿™é‡Œï¼Œæ‚¨ä½¿ç”¨åä¸º python çš„å®˜æ–¹ Python é•œåƒï¼Œå®ƒæ‰˜ç®¡åœ¨ Docker Hub ä¸Šã€‚å®˜æ–¹é•œåƒç”±ç›¸åº”è¯­è¨€æˆ–æŠ€æœ¯çš„å®˜æ–¹ç»´æŠ¤è€…æ„å»ºå’Œç»´æŠ¤ã€‚å®ƒä»¬ä¸å±äº Docker Hub ä¸Šçš„ä»»ä½•ç‰¹å®šç”¨æˆ·æˆ–å›¢é˜Ÿï¼Œä½†åœ¨å…¨å±€å‘½åç©ºé—´ä¸­å¯ç”¨ï¼Œéšå¼ç§°ä¸º library/ ï¼Œè€Œä¸æ˜¯æ›´ä¸“ä¸šçš„å˜ä½“ï¼Œå¦‚ circleci/python ã€‚\næ‚¨è¿˜å¯ä»¥åœ¨å†’å· ( : ) åæŒ‡å®šä¸€ä¸ªå¯é€‰çš„æ ‡ç­¾æˆ–æ ‡ç­¾åç§°ï¼Œä»¥ç¼©å°åŸºæœ¬é•œåƒçš„ç‰¹å®šç‰ˆæœ¬ã€‚æ‚¨å¯ä»¥é€šè¿‡å•å‡»ç›¸åº” Docker Hub é¡µé¢ä¸Šçš„â€œæ ‡ç­¾â€é€‰é¡¹å¡æ¥æµè§ˆç»™å®š Docker é•œåƒçš„æ‰€æœ‰å¯ç”¨æ ‡ç­¾ã€‚\næ³¨æ„ï¼šæ ‡ç­¾ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œä½†å°†å®ƒä»¬åŒ…å«åœ¨ FROM æŒ‡ä»¤ä¸­è¢«è®¤ä¸ºæ˜¯æœ€ä½³å®è·µã€‚æ‚¨åº”è¯¥å°½å¯èƒ½å…·ä½“ï¼Œä»¥é¿å…ä¸å¿…è¦çš„æ„å¤–ã€‚å¦‚æœæ‚¨çœç•¥è¯¥æ ‡è®°ï¼Œé‚£ä¹ˆ Docker å°†æ‹‰å–ä¸€ä¸ªæ ‡è®°ä¸º latest çš„é•œåƒï¼Œå…¶ä¸­å¯èƒ½åŒ…å«ä¸åˆé€‚çš„æ“ä½œç³»ç»Ÿæˆ–å½±å“æ‚¨çš„åº”ç”¨ç¨‹åºçš„è¿è¡Œæ—¶æ„å¤–æ›´æ”¹ã€‚\næ ‡ç­¾ 3.11.2-slim-bullseye è¡¨ç¤ºæ‚¨çš„åŸºç¡€é•œåƒå°†æ˜¯ Debian Bullseye çš„ç²¾ç®€å˜ä½“ï¼Œä»…åŒ…å«åŸºæœ¬è¦ç´ ï¼Œè®©æ‚¨ç¨åå¯ä»¥æ ¹æ®éœ€è¦å®‰è£…ä»»ä½•å…¶ä»–è½¯ä»¶åŒ…ã€‚è¿™å‡å°äº†é•œåƒçš„å¤§å°å¹¶åŠ å¿«äº†ä¸‹è½½æ—¶é—´ã€‚æ­¤é•œåƒçš„å¸¸è§„å˜ä½“å’Œè¶…è–„å˜ä½“ä¹‹é—´çš„å¤§å°å·®å¼‚é«˜è¾¾å…«ç™¾å…†å­—èŠ‚ï¼\nè¯¥æ ‡è®°è¿˜è¡¨æ˜æ‚¨çš„åŸºç¡€é•œåƒå°†éšå·²å®‰è£…çš„ Python 3.11.2 ä¸€èµ·æä¾›ï¼Œå› æ­¤æ‚¨å¯ä»¥ç«‹å³å¼€å§‹ä½¿ç”¨å®ƒã€‚\nåœ¨æ‹‰å–åŸºç¡€é•œåƒåï¼Œæ‚¨å¯èƒ½æƒ³è¦ç«‹å³æ‰§è¡Œçš„ä¸‹ä¸€ä¸ªä»»åŠ¡æ˜¯ä½¿ç”¨æœ€æ–°çš„å®‰å…¨æ›´æ–°å’Œé”™è¯¯ä¿®å¤å¯¹å…¶è¿›è¡Œä¿®è¡¥ï¼Œè¿™äº›æ›´æ–°å’Œé”™è¯¯ä¿®å¤å¯èƒ½æ˜¯è‡ªé•œåƒåœ¨ Docker Hub ä¸Šå‘å¸ƒä»¥æ¥å‘å¸ƒçš„ï¼š\n# Dockerfile FROM python:3.11.2-slim-bullseye RUN apt-get update \u0026amp;\u0026amp; \\ apt-get upgrade --yes åœ¨ Debian ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ apt-get å‘½ä»¤è·å–æœ€æ–°çš„è½¯ä»¶åŒ…åˆ—è¡¨å¹¶å‡çº§ä»»ä½•æœ‰å¯ç”¨æ›´æ–°çš„è½¯ä»¶åŒ…ã€‚è¯·æ³¨æ„ï¼Œè¿™ä¸¤ä¸ªå‘½ä»¤éƒ½ä½œä¸ºä¸€ä¸ª RUN æŒ‡ä»¤çš„ä¸€éƒ¨åˆ†æ‰§è¡Œï¼Œä»¥æœ€å¤§é™åº¦åœ°å‡å°‘æ–‡ä»¶ç³»ç»Ÿä¸­çš„å±‚æ•°ï¼Œä»è€Œé¿å…å ç”¨è¿‡å¤šçš„ç£ç›˜ç©ºé—´ã€‚\næ³¨æ„ï¼šDockerfile ä¸­æŒ‡ä»¤çš„é¡ºåºå¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒä¼šå½±å“æ„å»ºé•œåƒæ‰€éœ€çš„æ—¶é—´ã€‚\nç‰¹åˆ«æ˜¯ï¼Œæ‚¨åº”è¯¥å°†å…¶å±‚ç»å¸¸æ›´æ”¹çš„æŒ‡ä»¤æ”¾åœ¨ Dockerfile çš„åº•éƒ¨ï¼Œå› ä¸ºå®ƒä»¬æœ€æœ‰å¯èƒ½ä½¿ç¼“å­˜ä¸­çš„æ‰€æœ‰åç»­å±‚æ— æ•ˆã€‚\nå¥½çš„ã€‚æ‚¨å·²ç»é€‰æ‹©äº†åŸºæœ¬é•œåƒå¹¶å®‰è£…äº†æœ€æ–°çš„å®‰å…¨æ›´æ–°ã€‚æ‚¨å‡ ä¹å·²ç»å‡†å¤‡å¥½è®¾ç½®æ‚¨çš„ Flask åº”ç”¨ç¨‹åºï¼Œä½†è¿˜æœ‰å‡ ä¸ªæ­¥éª¤ã€‚\néš”ç¦»ä½ çš„ Docker é•œåƒ ä½¿ç”¨ Dockerfiles æ—¶çš„å¦ä¸€ä¸ªå¥½ä¹ æƒ¯æ˜¯ï¼Œä¸€æ—¦ä¸å†éœ€è¦å®ƒä»¬ï¼Œå°±åˆ›å»ºå¹¶åˆ‡æ¢åˆ°æ²¡æœ‰ç®¡ç†æƒé™çš„æ™®é€šç”¨æˆ·ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒDocker ä»¥è¶…çº§ç”¨æˆ·èº«ä»½è¿è¡Œæ‚¨çš„å‘½ä»¤ï¼Œæ¶æ„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒæ¥ä¸å—é™åˆ¶åœ°è®¿é—®æ‚¨çš„ä¸»æœºç³»ç»Ÿã€‚æ˜¯çš„ï¼ŒDocker æä¾›äº†å¯¹å®¹å™¨å’Œä¸»æœºçš„æ ¹çº§è®¿é—®æƒé™ï¼\nä»¥ä¸‹æ˜¯é¿å…è¿™ç§æ½œåœ¨å®‰å…¨é£é™©çš„æ–¹æ³•ï¼š\n# Dockerfile FROM python:3.11.2-slim-bullseye RUN apt-get update \u0026amp;\u0026amp; \\ apt-get upgrade --yes RUN useradd --create-home realpython USER realpython WORKDIR /home/realpython æ‚¨åˆ›å»ºä¸€ä¸ªåä¸º realpython çš„æ–°ç”¨æˆ·ï¼Œå¹¶å‘Šè¯‰ Docker ä»ç°åœ¨èµ·åœ¨ Dockerfile ä¸­ä½¿ç”¨è¯¥ç”¨æˆ·ã€‚æ‚¨è¿˜å°†å½“å‰å·¥ä½œç›®å½•è®¾ç½®ä¸ºæ­¤ç”¨æˆ·çš„ä¸»ç›®å½•ï¼Œè¿™æ ·æ‚¨å°±ä¸å¿…åœ¨åé¢çš„å‘½ä»¤ä¸­æ˜ç¡®æŒ‡å®šå®Œæ•´çš„æ–‡ä»¶è·¯å¾„ã€‚\nå³ä½¿æ‚¨çš„ Docker å®¹å™¨å°†è¿è¡Œå•ä¸ª Flask åº”ç”¨ç¨‹åºï¼Œä¹Ÿè¯·è€ƒè™‘åœ¨å®¹å™¨æœ¬èº«å†…éƒ¨è®¾ç½®ä¸€ä¸ªä¸“ç”¨çš„è™šæ‹Ÿç¯å¢ƒã€‚è™½ç„¶æ‚¨æ— éœ€æ‹…å¿ƒå°†å¤šä¸ª Python é¡¹ç›®å½¼æ­¤éš”ç¦»ï¼Œå¹¶ä¸” Docker ä¸ºæ‚¨çš„ä¸»æœºæä¾›äº†ä¸€ä¸ªåˆç†çš„éš”ç¦»å±‚ï¼Œä½†æ‚¨ä»ç„¶å­˜åœ¨å¹²æ‰°å®¹å™¨è‡ªèº«ç³»ç»Ÿå·¥å…·çš„é£é™©ã€‚\nä¸å¹¸çš„æ˜¯ï¼Œè®¸å¤š Linux å‘è¡Œç‰ˆéƒ½ä¾èµ–äºå…¨å±€ Python å®‰è£…æ‰èƒ½é¡ºåˆ©è¿è¡Œã€‚å¦‚æœæ‚¨å¼€å§‹å°†åŒ…ç›´æ¥å®‰è£…åˆ°å…¨å±€ Python ç¯å¢ƒä¸­ï¼Œé‚£ä¹ˆæ‚¨å°±ä¸ºæ½œåœ¨çš„ç‰ˆæœ¬å†²çªæ‰“å¼€äº†å¤§é—¨ã€‚è¿™ç”šè‡³å¯èƒ½å¯¼è‡´ç ´åæ‚¨çš„ç³»ç»Ÿã€‚\næ³¨æ„ï¼šå¦‚æœæ‚¨ä»ç„¶ä¸ç›¸ä¿¡åœ¨ Docker å®¹å™¨å†…åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œé‚£ä¹ˆè¿™æ¡è­¦å‘Šæ¶ˆæ¯å¯èƒ½ä¼šæ”¹å˜æ‚¨çš„æƒ³æ³•ï¼š\nWARNING: Running pip as the \u0026#39;root\u0026#39; user can result in broken permissions and conflicting behaviour with the system package manager. It is â®‘recommended to use a virtual environment instead: â®‘https://pip.pypa.io/warnings/venv åœ¨ Debian æˆ– Ubuntu ç­‰è¡ç”Ÿå‘è¡Œç‰ˆä¸Šå°è¯•ä½¿ç”¨ç³»ç»Ÿçš„å…¨å±€ pip å‘½ä»¤å®‰è£… Python åŒ…åï¼Œæ‚¨å¯èƒ½ä¼šçœ‹åˆ°è¿™ä¸€ç‚¹ã€‚\nåœ¨ Docker é•œåƒä¸­åˆ›å»ºå’Œæ¿€æ´»è™šæ‹Ÿç¯å¢ƒçš„æœ€å¯é æ–¹æ³•æ˜¯ç›´æ¥ä¿®æ”¹å…¶ PATH ç¯å¢ƒå˜é‡ï¼š\n# Dockerfile FROM python:3.11.2-slim-bullseye RUN apt-get update \u0026amp;\u0026amp; \\ apt-get upgrade --yes RUN useradd --create-home realpython USER realpython WORKDIR /home/realpython ENV VIRTUALENV=/home/realpython/venv RUN python3 -m venv $VIRTUALENV ENV PATH=\u0026#34;$VIRTUALENV/bin:$PATH\u0026#34; é¦–å…ˆï¼Œå®šä¹‰ä¸€ä¸ªè¾…åŠ©å˜é‡ VIRTUALENV ï¼Œå…¶ä¸­åŒ…å«é¡¹ç›®è™šæ‹Ÿç¯å¢ƒçš„è·¯å¾„ï¼Œç„¶åä½¿ç”¨ Python çš„ venv æ¨¡å—åœ¨é‚£é‡Œåˆ›å»ºè¯¥ç¯å¢ƒã€‚ä½†æ˜¯ï¼Œä¸æ˜¯ä½¿ç”¨ shell è„šæœ¬æ¿€æ´»æ–°ç¯å¢ƒï¼Œè€Œæ˜¯é€šè¿‡è¦†ç›– python å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„æ¥æ›´æ–° PATH å˜é‡ã€‚\nä¸ºä»€ä¹ˆï¼Ÿè¿™æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºä»¥é€šå¸¸çš„æ–¹å¼æ¿€æ´»æ‚¨çš„ç¯å¢ƒåªæ˜¯æš‚æ—¶çš„ï¼Œä¸ä¼šå½±å“ä»æ‚¨çš„é•œåƒæ´¾ç”Ÿçš„ Docker å®¹å™¨ã€‚æ­¤å¤–ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ Dockerfile çš„ RUN æŒ‡ä»¤æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼Œé‚£ä¹ˆå®ƒåªä¼šæŒç»­åˆ° Dockerfile ä¸­çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œå› ä¸ºæ¯æ¡æŒ‡ä»¤éƒ½ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„ shell ä¼šè¯ã€‚\nä¸€æ—¦ä½ æœ‰äº†é¡¹ç›®çš„è™šæ‹Ÿç¯å¢ƒï¼Œä½ å°±å¯ä»¥å®‰è£…å¿…è¦çš„ä¾èµ–é¡¹ã€‚\nç¼“å­˜ä½ çš„é¡¹ç›®ä¾èµ– ä¸åœ¨ä¸»æœºæœ¬åœ°å·¥ä½œç›¸æ¯”ï¼Œåœ¨ Dockerfile ä¸­å®‰è£…ä¾èµ–é¡¹çœ‹èµ·æ¥ç•¥æœ‰ä¸åŒã€‚é€šå¸¸ï¼Œæ‚¨ä¼šå®‰è£…ä¾èµ–é¡¹ï¼Œç„¶åç«‹å³å®‰è£… Python åŒ…ã€‚\nç›¸æ¯”ä¹‹ä¸‹ï¼Œå½“æ‚¨æ„å»º Docker é•œåƒæ—¶ï¼Œå€¼å¾—å°†è¯¥è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ä»¥åˆ©ç”¨å±‚ç¼“å­˜ï¼Œä»è€Œå‡å°‘æ„å»ºé•œåƒæ‰€éœ€çš„æ€»æ—¶é—´ã€‚\né¦–å…ˆï¼Œ COPY å°†å¸¦æœ‰é¡¹ç›®å…ƒæ•°æ®çš„ä¸¤ä¸ªæ–‡ä»¶ä»æ‚¨çš„ä¸»æœºå¯¼å…¥åˆ° Docker é•œåƒä¸­ï¼š\n# Dockerfile FROM python:3.11.2-slim-bullseye RUN apt-get update \u0026amp;\u0026amp; \\ apt-get upgrade --yes RUN useradd --create-home realpython USER realpython WORKDIR /home/realpython ENV VIRTUALENV=/home/realpython/venv RUN python3 -m venv $VIRTUALENV ENV PATH=\u0026#34;$VIRTUALENV/bin:$PATH\u0026#34; COPY --chown=realpython pyproject.toml constraints.txt ./ æ‚¨åªéœ€å°†åŒ…å«æœ‰å…³é¡¹ç›®ä¾èµ–é¡¹ä¿¡æ¯çš„ pyproject.toml å’Œ constraints.txt æ–‡ä»¶å¤åˆ¶åˆ° Docker é•œåƒä¸­ realpython ç”¨æˆ·çš„ä¸»ç›®å½•ä¸­ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ–‡ä»¶å½’è¶…çº§ç”¨æˆ·æ‰€æœ‰ï¼Œå› æ­¤æ‚¨å¯èƒ½å¸Œæœ›ä½¿ç”¨ --chown å°†å…¶æ‰€æœ‰è€…æ›´æ”¹ä¸ºæ‚¨ä¹‹å‰åˆ›å»ºçš„æ™®é€šç”¨æˆ·ã€‚ --chown é€‰é¡¹ç±»ä¼¼äº chown å‘½ä»¤ï¼Œå®ƒä»£è¡¨æ›´æ”¹æ‰€æœ‰è€…ã€‚\næ‚¨å¯ä»¥åœ¨ç½‘ä¸Šæ‰¾åˆ°çš„è®¸å¤š Dockerfile ç¤ºä¾‹ä¼šä¸€æ¬¡æ€§å¤åˆ¶æ‰€æœ‰å†…å®¹ï¼Œä½†é‚£å¾ˆæµªè´¹ï¼\nå¯èƒ½æœ‰å¤§é‡é¢å¤–æ–‡ä»¶ï¼Œä¾‹å¦‚åŒ…å«é¡¹ç›®æ•´ä¸ªå†å²çš„æœ¬åœ° Git å­˜å‚¨åº“ã€ä»£ç ç¼–è¾‘å™¨è®¾ç½®æˆ–é¡¹ç›®æ ¹æ–‡ä»¶å¤¹ä¸­çš„å…¶ä»–ä¸´æ—¶æ–‡ä»¶ã€‚\nå®ƒä»¬ä¸ä»…ä¼šä½¿ç”Ÿæˆçš„é•œåƒè†¨èƒ€ï¼Œè€Œä¸”è¿˜ä¼šå¢åŠ è¿‡æ—©ä½¿ Docker å±‚ç¼“å­˜å¤±æ•ˆçš„å¯èƒ½æ€§ã€‚\næ³¨æ„ï¼šæ‚¨åº”è¯¥åªå¤åˆ¶æ‚¨ç›®å‰éœ€è¦çš„å•ä¸ªæ–‡ä»¶åˆ°æ‚¨çš„ Dockerfile ä¸­ã€‚å¦åˆ™ï¼Œå³ä½¿æ˜¯ä¸ç›¸å…³æ–‡ä»¶ä¸­çš„æœ€ç»†å¾®å˜åŒ–ä¹Ÿä¼šå¯¼è‡´å‰©ä½™å›¾å±‚é‡å»ºã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥å®šä¹‰ä¸€ä¸ª .dockerignore æ–‡ä»¶ï¼Œå…¶å·¥ä½œæ–¹å¼ä¸ .gitignore å‰¯æœ¬ç±»ä¼¼ï¼Œä½†æ˜ç¡®è¯´æ˜è¦å¤åˆ¶çš„å†…å®¹æ›´å®‰å…¨ã€‚\nå¦ä¸€ä¸ªå®¹æ˜“é—æ¼çš„éš¾é¢˜æ˜¯å½“æ‚¨åœ¨å°è¯•å®‰è£…é¡¹ç›®ä¾èµ–é¡¹ä¹‹å‰å¿˜è®°å‡çº§ pip æœ¬èº«ã€‚åœ¨æå°‘æ•°æƒ…å†µä¸‹ï¼Œ pip çš„æ—§ç‰ˆæœ¬å®é™…ä¸Šå¯ä»¥é˜»æ­¢å®‰è£…å…¶ä»–è½¯ä»¶åŒ…çš„æœ€æ–°ç‰ˆæœ¬ï¼åœ¨æ‚¨çš„æƒ…å†µä¸‹ï¼Œè¿˜å€¼å¾—å‡çº§ setuptools ï¼Œæ‚¨å°†å…¶ç”¨ä½œæ„å»ºåç«¯ï¼Œä»¥è·å–æœ€æ–°çš„å®‰å…¨è¡¥ä¸ã€‚\næ‚¨å¯ä»¥å°†ä»¥ä¸‹ä¸¤ä¸ªå‘½ä»¤ç»„åˆåœ¨ä¸€æ¡ RUN æŒ‡ä»¤ä¸­ä»¥å®‰è£…æ‚¨çš„ä¾èµ–é¡¹ï¼š\n# Dockerfile FROM python:3.11.2-slim-bullseye RUN apt-get update \u0026amp;\u0026amp; \\ apt-get upgrade --yes RUN useradd --create-home realpython USER realpython WORKDIR /home/realpython ENV VIRTUALENV=/home/realpython/venv RUN python3 -m venv $VIRTUALENV ENV PATH=\u0026#34;$VIRTUALENV/bin:$PATH\u0026#34; COPY --chown=realpython pyproject.toml constraints.txt ./ RUN python -m pip install --upgrade pip setuptools \u0026amp;\u0026amp; \\ python -m pip install --no-cache-dir -c constraints.txt \u0026#34;.[dev]\u0026#34; æ‚¨å°† pip å’Œ setuptools å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚ç„¶åï¼Œå®‰è£…é¡¹ç›®æ‰€éœ€çš„ç¬¬ä¸‰æ–¹åº“ï¼ŒåŒ…æ‹¬ç”¨äºå¼€å‘çš„å¯é€‰ä¾èµ–é¡¹ã€‚æ‚¨é™åˆ¶å®ƒä»¬çš„ç‰ˆæœ¬ä»¥ç¡®ä¿ä¸€è‡´çš„ç¯å¢ƒï¼Œå¹¶å‘Šè¯‰ pip ä½¿ç”¨ --no-cache-dir ç¦ç”¨ç¼“å­˜ã€‚æ‚¨åœ¨è™šæ‹Ÿç¯å¢ƒä¹‹å¤–ä¸éœ€è¦è¿™äº›åŒ…ï¼Œå› æ­¤æ— éœ€ç¼“å­˜å®ƒä»¬ã€‚è¿™æ ·ï¼Œæ‚¨å°±å¯ä»¥ä½¿ Docker é•œåƒæ›´å°ã€‚\næ³¨æ„ï¼šå› ä¸ºæ‚¨å®‰è£…äº†ä¾èµ–é¡¹è€Œæ²¡æœ‰åœ¨ Docker é•œåƒä¸­å®‰è£… page-tracker åŒ…ï¼Œæ‰€ä»¥å®ƒä»¬å°†ä¿ç•™åœ¨ç¼“å­˜å±‚ä¸­ã€‚å› æ­¤ï¼Œå¯¹æºä»£ç çš„ä»»ä½•æ›´æ”¹éƒ½ä¸éœ€è¦é‡æ–°å®‰è£…è¿™äº›ä¾èµ–é¡¹ã€‚\næ‚¨çš„ Dockerfile æ­£åœ¨å¢é•¿å¹¶å˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œä½†è¯·ä¸è¦æ‹…å¿ƒã€‚åªéœ€è¦å®Œæˆå‡ ä¸ªæ­¥éª¤ï¼Œå°±å¿«å®Œæˆäº†ã€‚\nä½œä¸ºæ„å»ºè¿‡ç¨‹çš„ä¸€éƒ¨åˆ†è¿è¡Œæµ‹è¯• æœ€åï¼Œæ˜¯æ—¶å€™å°†æ‚¨çš„æºä»£ç å¤åˆ¶åˆ° Docker é•œåƒä¸­ï¼Œå¹¶ä¸ linters å’Œå…¶ä»–é™æ€åˆ†æå·¥å…·ä¸€èµ·è¿è¡Œæ‚¨çš„æµ‹è¯•äº†ï¼š\n# Dockerfile FROM python:3.11.2-slim-bullseye RUN apt-get update \u0026amp;\u0026amp; \\ apt-get upgrade --yes RUN useradd --create-home realpython USER realpython WORKDIR /home/realpython ENV VIRTUALENV=/home/realpython/venv RUN python3 -m venv $VIRTUALENV ENV PATH=\u0026#34;$VIRTUALENV/bin:$PATH\u0026#34; COPY --chown=realpython pyproject.toml constraints.txt ./ RUN python -m pip install --upgrade pip setuptools \u0026amp;\u0026amp; \\ python -m pip install --no-cache-dir -c constraints.txt \u0026#34;.[dev]\u0026#34; COPY --chown=realpython src/ src/ COPY --chown=realpython test/ test/ RUN python -m pip install . -c constraints.txt \u0026amp;\u0026amp; \\ python -m pytest test/unit/ \u0026amp;\u0026amp; \\ python -m flake8 src/ \u0026amp;\u0026amp; \\ python -m isort src/ --check \u0026amp;\u0026amp; \\ python -m black src/ --check --quiet \u0026amp;\u0026amp; \\ python -m pylint src/ --disable=C0114,C0116,R1705 \u0026amp;\u0026amp; \\ python -m bandit -r src/ --quiet ä»ä¸»æœºå¤åˆ¶ src/ å’Œ test/ æ–‡ä»¶å¤¹åï¼Œå°† page-tracker åŒ…å®‰è£…åˆ°è™šæ‹Ÿç¯å¢ƒä¸­ã€‚é€šè¿‡å°†è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·èå…¥æ„å»ºè¿‡ç¨‹ï¼Œæ‚¨å¯ä»¥ç¡®ä¿å¦‚æœå…¶ä¸­ä»»ä½•ä¸€ä¸ªå·¥å…·è¿”å›éé›¶é€€å‡ºçŠ¶æ€ä»£ç ï¼Œåˆ™æ„å»ºæ‚¨çš„ Docker é•œåƒå°†å¤±è´¥ã€‚è¿™æ­£æ˜¯æ‚¨åœ¨å®æ–½æŒç»­é›†æˆç®¡é“æ—¶æƒ³è¦çš„ã€‚\nè¯·æ³¨æ„ï¼Œæ‚¨å¿…é¡»ç¦ç”¨ä¸¥é‡æ€§ä½çš„ pylint é—®é¢˜ C0114 ã€ C0116 å’Œ R1705 ï¼Œå®ƒä»¬ç°åœ¨å¹¶ä¸é‡è¦ã€‚å¦åˆ™ï¼Œå®ƒä»¬ä¼šé˜»æ­¢æ‚¨çš„ Docker é•œåƒæˆåŠŸæ„å»ºã€‚\nå°†å„ä¸ªå‘½ä»¤ç»„åˆåœ¨ä¸€ä¸ª RUN æŒ‡ä»¤ä¸­çš„åŸå› æ˜¯ä¸ºäº†å‡å°‘è¦ç¼“å­˜çš„å±‚æ•°ã€‚è¯·è®°ä½ï¼Œæ‚¨æ‹¥æœ‰çš„å±‚è¶Šå¤šï¼Œç”Ÿæˆçš„ Docker é•œåƒå°±è¶Šå¤§ã€‚\næ³¨æ„ï¼šæ­¤æ—¶ï¼Œæ‚¨æ— æ³•æ‰§è¡Œéœ€è¦ Redis çš„é›†æˆæˆ–ç«¯åˆ°ç«¯æµ‹è¯•ï¼Œå› ä¸ºæ‚¨çš„ Docker é•œåƒåªæ¶‰åŠ Flask åº”ç”¨ç¨‹åºã€‚åœ¨å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°æŸä¸ªç¯å¢ƒåï¼Œæ‚¨å°†èƒ½å¤Ÿæ‰§è¡Œå®ƒä»¬ã€‚\nå½“æ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡å¹¶ä¸”æ²¡æœ‰ä»»ä½•é™æ€åˆ†æå·¥å…·æŠ¥å‘Šä»»ä½•é—®é¢˜æ—¶ï¼Œæ‚¨çš„ Docker é•œåƒå°±å·®ä¸å¤šå®Œæˆäº†ã€‚ä½†æ˜¯ï¼Œå½“æ‚¨ä»é•œåƒåˆ›å»ºæ–°å®¹å™¨æ—¶ï¼Œæ‚¨ä»ç„¶éœ€è¦å‘Šè¯‰ Docker è¦è¿è¡Œä»€ä¹ˆå‘½ä»¤ã€‚\næŒ‡å®šè¦åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œçš„å‘½ä»¤ æœ€åä¸€æ­¥æ˜¯æŒ‡å®šè¦åœ¨ä» Docker é•œåƒæ´¾ç”Ÿçš„æ¯ä¸ªæ–° Docker å®¹å™¨ä¸­æ‰§è¡Œçš„å‘½ä»¤ã€‚åœ¨æ­¤é˜¶æ®µï¼Œæ‚¨å¯ä»¥åœ¨ Flask çš„å†…ç½®å¼€å‘æœåŠ¡å™¨ä¸Šå¯åŠ¨æ‚¨çš„ Web åº”ç”¨ç¨‹åºï¼š\n# Dockerfile FROM python:3.11.2-slim-bullseye RUN apt-get update \u0026amp;\u0026amp; \\ apt-get upgrade --yes RUN useradd --create-home realpython USER realpython WORKDIR /home/realpython ENV VIRTUALENV=/home/realpython/venv RUN python3 -m venv $VIRTUALENV ENV PATH=\u0026#34;$VIRTUALENV/bin:$PATH\u0026#34; COPY --chown=realpython pyproject.toml constraints.txt ./ RUN python -m pip install --upgrade pip setuptools \u0026amp;\u0026amp; \\ python -m pip install --no-cache-dir -c constraints.txt \u0026#34;.[dev]\u0026#34; COPY --chown=realpython src/ src/ COPY --chown=realpython test/ test/ RUN python -m pip install . -c constraints.txt \u0026amp;\u0026amp; \\ python -m pytest test/unit/ \u0026amp;\u0026amp; \\ python -m flake8 src/ \u0026amp;\u0026amp; \\ python -m isort src/ --check \u0026amp;\u0026amp; \\ python -m black src/ --check --quiet \u0026amp;\u0026amp; \\ python -m pylint src/ --disable=C0114,C0116,R1705 \u0026amp;\u0026amp; \\ python -m bandit -r src/ --quiet CMD [\u0026#34;flask\u0026#34;, \u0026#34;--app\u0026#34;, \u0026#34;page_tracker.app\u0026#34;, \u0026#34;run\u0026#34;, \\ \u0026#34;--host\u0026#34;, \u0026#34;0.0.0.0\u0026#34;, \u0026#34;--port\u0026#34;, \u0026#34;5000\u0026#34;] åœ¨è¿™é‡Œï¼Œæ‚¨ä½¿ç”¨ CMD æŒ‡ä»¤çš„ä¸‰ç§å½¢å¼ä¹‹ä¸€ï¼Œå®ƒç±»ä¼¼äº Python çš„ subprocess.run() å‡½æ•°çš„è¯­æ³•ã€‚è¯·æ³¨æ„ï¼Œæ‚¨å¿…é¡»å°†ä¸»æœºç»‘å®šåˆ° 0.0.0.0 åœ°å€ï¼Œä»¥ä¾¿ä» Docker å®¹å™¨å¤–éƒ¨è®¿é—®æ‚¨çš„åº”ç”¨ç¨‹åºã€‚\næ‚¨ç°åœ¨å¯ä»¥åŸºäºç°æœ‰çš„ Dockerfile æ„å»º Docker é•œåƒï¼Œå¹¶å¼€å§‹è¿è¡Œä»ä¸­æ´¾ç”Ÿçš„ Docker å®¹å™¨ã€‚ä»¥ä¸‹å‘½ä»¤ä¼šå°†æ‚¨çš„ Dockerfile è½¬æ¢ä¸ºåä¸º page-tracker çš„ Docker é•œåƒï¼š\n$ docker build -t page-tracker . å®ƒå°†åœ¨å½“å‰å·¥ä½œç›®å½•ä¸­æŸ¥æ‰¾ Dockerfileï¼Œç”¨ç‚¹ ( . ) è¡¨ç¤ºï¼Œå¹¶ä½¿ç”¨é»˜è®¤æ ‡ç­¾ latest æ ‡è®°ç”Ÿæˆçš„é•œåƒã€‚å› æ­¤ï¼Œå®Œæ•´çš„é•œåƒåç§°å°†æ˜¯ page-tracker:latest ã€‚\nä¸å¹¸çš„æ˜¯ï¼Œæ‚¨çš„é•œåƒç›®å‰åŒ…å«å¾ˆå¤šæ‚ç‰©ï¼Œä¾‹å¦‚æ‚¨åœ¨ç”Ÿäº§ä¸­æ°¸è¿œä¸éœ€è¦çš„æºä»£ç ã€æµ‹è¯•å’Œ linterã€‚\nå®ƒä»¬ä¼šå¢åŠ é•œåƒçš„å¤§å°ï¼Œä½¿ä¸‹è½½å’Œéƒ¨ç½²é€Ÿåº¦å˜æ…¢ï¼Œå¦‚æœæ‚¨æ²¡æœ‰æ­£ç¡®ç»´æŠ¤å®ƒä»¬ï¼Œå®ƒä»¬è¿˜ä¼šå¯¼è‡´å®‰å…¨æ¼æ´ã€‚æ­¤å¤–ï¼Œè¿™äº›é¢å¤–çš„ç»„ä»¶å¯èƒ½ä¼šåœ¨æ’é™¤é”™è¯¯æ—¶å¼•èµ·é—®é¢˜ã€‚\nå¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ç§æ›´å¥½çš„æ–¹æ³•æ¥ç»„ç»‡æ‚¨çš„ Dockerfileï¼Œå…è®¸æ‚¨åˆ†å¤šä¸ªé˜¶æ®µæ„å»ºä¸€ä¸ªé•œåƒï¼Œæ‚¨ç°åœ¨å°†æ¢ç´¢å®ƒã€‚\nä¸ºå¤šé˜¶æ®µæ„å»ºé‡æ–°ç»„ç»‡ Dockerfile åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ‚¨åˆ›å»ºçš„ Dockerfile ç›¸å½“ç®€å•ï¼Œåº”è¯¥é€‚åˆå¼€å‘ã€‚ä¿ç•™å®ƒï¼Œå› ä¸ºç¨åæ‚¨å°†éœ€è¦å®ƒæ¥ä½¿ç”¨ Docker Compose è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•ã€‚æ‚¨ç°åœ¨å¯ä»¥å¤åˆ¶æ­¤æ–‡ä»¶å¹¶ä¸ºå…¶æŒ‡å®šä¸€ä¸ªä¸åŒçš„åç§°ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å°† .dev åç¼€é™„åŠ åˆ°ä¸¤ä¸ªå‰¯æœ¬ä¹‹ä¸€ï¼š\npage-tracker/ â”‚ â”œâ”€â”€ src/ â”‚ â””â”€â”€ page_tracker/ â”‚ â”œâ”€â”€ __init__.py â”‚ â””â”€â”€ app.py â”‚ â”œâ”€â”€ test/ â”‚ â”œâ”€â”€ venv/ â”‚ â”œâ”€â”€ constraints.txt â”œâ”€â”€ Dockerfile â”œâ”€â”€ Dockerfile.dev â””â”€â”€ pyproject.toml ç°åœ¨ï¼Œç¼–è¾‘åä¸º Dockerfile çš„æ–‡ä»¶å¹¶åœ¨å°†æ„å»ºè¿‡ç¨‹åˆ†è§£ä¸ºå¤šä¸ªé˜¶æ®µæ—¶ä¿æŒæ‰“å¼€çŠ¶æ€ã€‚\næ³¨æ„ï¼šè¦åœ¨æ„å»ºé•œåƒæ—¶æŒ‡å®šè‡ªå®šä¹‰æ–‡ä»¶åè€Œä¸æ˜¯é»˜è®¤çš„ Dockerfile ï¼Œè¯·ä½¿ç”¨ -f æˆ– --file é€‰é¡¹ï¼š\n$ docker build -f Dockerfile.dev -t page-tracker . è¿™ä¸ªæ–‡ä»¶åå¯ä»¥æ˜¯ä»»ä½•ä½ æƒ³è¦çš„ã€‚åªéœ€ç¡®ä¿åœ¨ docker build å‘½ä»¤ä¸­æ­£ç¡®å¼•ç”¨å®ƒå³å¯ã€‚\nå¤šé˜¶æ®µæ„å»ºèƒŒåçš„æƒ³æ³•æ˜¯å°† Dockerfile åˆ’åˆ†ä¸ºå¤šä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µéƒ½å¯ä»¥åŸºäºå®Œå…¨ä¸åŒçš„é•œåƒã€‚å½“æ‚¨çš„åº”ç”¨ç¨‹åºçš„å¼€å‘ç¯å¢ƒå’Œè¿è¡Œæ—¶ç¯å¢ƒä¸åŒæ—¶ï¼Œè¿™å°¤å…¶æœ‰ç”¨ã€‚\nä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨ä»…ç”¨äºæ„å»ºå’Œæµ‹è¯•åº”ç”¨ç¨‹åºçš„ä¸´æ—¶é•œåƒä¸­å®‰è£…å¿…è¦çš„æ„å»ºå·¥å…·ï¼Œç„¶åå°†ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶å¤åˆ¶åˆ°æœ€ç»ˆé•œåƒä¸­ã€‚\nå¤šé˜¶æ®µæ„å»ºå¯ä»¥ä½¿æ‚¨çš„é•œåƒæ›´å°ã€æ›´é«˜æ•ˆã€‚è¿™æ˜¯ä½¿ç”¨å½“å‰ Dockerfile æ„å»ºçš„åŒä¸€é•œåƒä¸æ‚¨å°†è¦ç¼–å†™çš„é•œåƒçš„æ¯”è¾ƒï¼š\n$ docker images REPOSITORY TAG IMAGE ID CREATED SIZE page-tracker prod 9cb2e3233522 5 minutes ago 204MB page-tracker dev f9918cb213dc 5 minutes ago 244MB (...) åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¤§å°å·®å¼‚å¹¶ä¸æ˜¾ç€ï¼Œä½†å½“æ‚¨æœ‰å¤šä¸ªé•œåƒè¦ç®¡ç†å’Œç§»åŠ¨æ—¶ï¼Œå®ƒä¼šè¿…é€Ÿå¢åŠ ã€‚\nDockerfile ä¸­çš„æ¯ä¸ªé˜¶æ®µéƒ½ä»¥å…¶è‡ªå·±çš„ FROM æŒ‡ä»¤å¼€å§‹ï¼Œå› æ­¤æ‚¨å°†æœ‰ä¸¤ä¸ªã€‚ç¬¬ä¸€ä¸ªé˜¶æ®µçœ‹èµ·æ¥ä¸æ‚¨å½“å‰çš„ Dockerfile å‡ ä¹å®Œå…¨ç›¸åŒï¼Œé™¤äº†æ‚¨å°†ä¸ºè¿™ä¸ªé˜¶æ®µå‘½å builder ï¼Œæ‚¨å¯ä»¥ç¨åå‚è€ƒï¼š\n# Dockerfile -FROM python:3.11.2-slim-bullseye +FROM python:3.11.2-slim-bullseye AS builder RUN apt-get update \u0026amp;\u0026amp; \\ apt-get upgrade --yes RUN useradd --create-home realpython USER realpython WORKDIR /home/realpython ENV VIRTUALENV=/home/realpython/venv RUN python3 -m venv $VIRTUALENV ENV PATH=\u0026#34;$VIRTUALENV/bin:$PATH\u0026#34; COPY --chown=realpython pyproject.toml constraints.txt ./ RUN python -m pip install --upgrade pip setuptools \u0026amp;\u0026amp; \\ python -m pip install --no-cache-dir -c constraints.txt \u0026#34;.[dev]\u0026#34; COPY --chown=realpython src/ src/ COPY --chown=realpython test/ test/ RUN python -m pip install . -c constraints.txt \u0026amp;\u0026amp; \\ python -m pytest test/unit/ \u0026amp;\u0026amp; \\ python -m flake8 src/ \u0026amp;\u0026amp; \\ python -m isort src/ --check \u0026amp;\u0026amp; \\ python -m black src/ --check --quiet \u0026amp;\u0026amp; \\ python -m pylint src/ --disable=C0114,C0116,R1705 \u0026amp;\u0026amp; \\ - python -m bandit -r src/ --quiet + python -m bandit -r src/ --quiet \u0026amp;\u0026amp; \\ + python -m pip wheel --wheel-dir dist/ . -c constraints.txt -CMD [\u0026#34;flask\u0026#34;, \u0026#34;--app\u0026#34;, \u0026#34;page_tracker.app\u0026#34;, \u0026#34;run\u0026#34;, \\ - \u0026#34;--host\u0026#34;, \u0026#34;0.0.0.0\u0026#34;, \u0026#34;--port\u0026#34;, \u0026#34;5000\u0026#34;] å› ä¸ºæ‚¨è¦å°†æ‰“åŒ…çš„é¡µé¢è·Ÿè¸ªå™¨åº”ç”¨ç¨‹åºä»ä¸€ä¸ªé•œåƒä¼ è¾“åˆ°å¦ä¸€ä¸ªé•œåƒï¼Œæ‰€ä»¥æ‚¨å¿…é¡»æ·»åŠ ä½¿ç”¨ Python wheel æ ¼å¼æ„å»ºåˆ†å‘åŒ…çš„é¢å¤–æ­¥éª¤ã€‚ pip wheel å‘½ä»¤å°†åœ¨ dist/ å­æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º page_tracker-1.0.0-py3-none-any.whl çš„æ–‡ä»¶ã€‚æ‚¨è¿˜å¯ä»¥ä»æ­¤é˜¶æ®µåˆ é™¤ CMD æŒ‡ä»¤ï¼Œå› ä¸ºå®ƒå°†æˆä¸ºä¸‹ä¸€é˜¶æ®µçš„ä¸€éƒ¨åˆ†ã€‚\nç¬¬äºŒä¸ªä¹Ÿæ˜¯æœ€åä¸€ä¸ªé˜¶æ®µï¼Œéšå¼å‘½åä¸º stage-1 ï¼Œçœ‹èµ·æ¥æœ‰ç‚¹é‡å¤ï¼Œå› ä¸ºå®ƒåŸºäºç›¸åŒçš„é•œåƒï¼š\n# Dockerfile FROM python:3.11.2-slim-bullseye AS builder # ... FROM python:3.11.2-slim-bullseye RUN apt-get update \u0026amp;\u0026amp; \\ apt-get upgrade --yes RUN useradd --create-home realpython USER realpython WORKDIR /home/realpython ENV VIRTUALENV=/home/realpython/venv RUN python3 -m venv $VIRTUALENV ENV PATH=\u0026#34;$VIRTUALENV/bin:$PATH\u0026#34; COPY --from=builder /home/realpython/dist/page_tracker*.whl /home/realpython RUN python -m pip install --upgrade pip setuptools \u0026amp;\u0026amp; \\ python -m pip install --no-cache-dir page_tracker*.whl CMD [\u0026#34;flask\u0026#34;, \u0026#34;--app\u0026#34;, \u0026#34;page_tracker.app\u0026#34;, \u0026#34;run\u0026#34;, \\ \u0026#34;--host\u0026#34;, \u0026#34;0.0.0.0\u0026#34;, \u0026#34;--port\u0026#34;, \u0026#34;5000\u0026#34;] æ‚¨é¦–å…ˆæŒ‰ç…§ç†Ÿæ‚‰çš„æ­¥éª¤å‡çº§ç³»ç»ŸåŒ…ã€åˆ›å»ºç”¨æˆ·å’Œåˆ›å»ºè™šæ‹Ÿç¯å¢ƒã€‚ç„¶åï¼Œçªå‡ºæ˜¾ç¤ºçš„è¡Œè´Ÿè´£ä» builder é˜¶æ®µå¤åˆ¶ wheel æ–‡ä»¶ã€‚ä½ åƒä»¥å‰ä¸€æ ·ç”¨ pip å®‰è£…å®ƒã€‚æœ€åï¼Œæ‚¨æ·»åŠ  CMD æŒ‡ä»¤ä»¥ä½¿ç”¨ Flask å¯åŠ¨æ‚¨çš„ Web åº”ç”¨ç¨‹åºã€‚\nå½“æ‚¨ä½¿ç”¨è¿™æ ·çš„å¤šé˜¶æ®µ Dockerfile æ„å»ºé•œåƒæ—¶ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°ç¬¬ä¸€é˜¶æ®µéœ€è¦æ›´é•¿çš„æ—¶é—´æ‰èƒ½å®Œæˆï¼Œå› ä¸ºå®ƒå¿…é¡»å®‰è£…æ‰€æœ‰ä¾èµ–é¡¹ã€è¿è¡Œæµ‹è¯•å¹¶åˆ›å»º wheel æ–‡ä»¶ã€‚\nä½†æ˜¯ï¼Œæ„å»ºç¬¬äºŒé˜¶æ®µä¼šå¿«å¾ˆå¤šï¼Œå› ä¸ºå®ƒåªéœ€è¦å¤åˆ¶å¹¶å®‰è£…å®Œæˆçš„ wheel æ–‡ä»¶ã€‚å¦å¤–è¯·æ³¨æ„ï¼Œ builder é˜¶æ®µæ˜¯ä¸´æ—¶çš„ï¼Œå› æ­¤ä¹‹åä¸ä¼šåœ¨æ‚¨çš„ Docker é•œåƒä¸­ç•™ä¸‹ä»»ä½•ç—•è¿¹ã€‚\nå¥½çš„ã€‚ä½ ç»ˆäºå‡†å¤‡å¥½æ„å»ºä½ çš„å¤šé˜¶æ®µ Docker é•œåƒäº†ï¼\næ„å»ºå’Œç‰ˆæœ¬æ§åˆ¶ä½ çš„ Docker é•œåƒ åœ¨æ„å»ºé•œåƒä¹‹å‰ï¼Œå¼ºçƒˆå»ºè®®æ‚¨ä¸º Docker é•œåƒé€‰æ‹©ä¸€ä¸ªç‰ˆæœ¬æ§åˆ¶æ–¹æ¡ˆï¼Œå¹¶å§‹ç»ˆä½¿ç”¨å”¯ä¸€æ ‡ç­¾å¯¹å…¶è¿›è¡Œæ ‡è®°ã€‚è¿™æ ·ï¼Œæ‚¨å°±ä¼šçŸ¥é“åœ¨ä»»ä½•ç»™å®šç¯å¢ƒä¸­éƒ¨ç½²äº†ä»€ä¹ˆï¼Œå¹¶èƒ½å¤Ÿåœ¨éœ€è¦æ—¶å›æ»šåˆ°ä¹‹å‰çš„ç¨³å®šç‰ˆæœ¬ã€‚\nå¯¹ Docker é•œåƒè¿›è¡Œç‰ˆæœ¬æ§åˆ¶æœ‰å‡ ç§ä¸åŒçš„ç­–ç•¥ã€‚ä¾‹å¦‚ï¼Œä¸€äº›æµè¡Œçš„åŒ…æ‹¬ï¼š\nè¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶ä½¿ç”¨ä»¥ç‚¹åˆ†éš”çš„ä¸‰ä¸ªæ•°å­—æ¥æŒ‡ç¤ºä¸»è¦ç‰ˆæœ¬ã€æ¬¡è¦ç‰ˆæœ¬å’Œè¡¥ä¸ç‰ˆæœ¬ã€‚ Git æäº¤å“ˆå¸Œä½¿ç”¨ç»‘å®šåˆ°é•œåƒä¸­æºä»£ç çš„ Git æäº¤çš„ SHA-1 å“ˆå¸Œã€‚ æ—¶é—´æˆ³ä½¿ç”¨æ—¶é—´ä¿¡æ¯ï¼ˆä¾‹å¦‚ Unix æ—¶é—´ï¼‰æ¥æŒ‡ç¤ºé•œåƒçš„æ„å»ºæ—¶é—´ã€‚ æ²¡æœ‰ä»€ä¹ˆèƒ½é˜»æ­¢æ‚¨ç»“åˆå…¶ä¸­çš„ä¸€äº›ç­–ç•¥æ¥åˆ›å»ºä¸€ä¸ªæœ‰æ•ˆçš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿå°†å¸®åŠ©æ‚¨è·Ÿè¸ªé•œåƒä¸­çš„æ›´æ”¹ã€‚\nåœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†åšæŒä½¿ç”¨ Git æäº¤å“ˆå¸Œæ–¹æ³•ï¼Œå› ä¸ºå®ƒå¯ä»¥ç¡®ä¿æ‚¨çš„ Docker é•œåƒçš„æ ‡ç­¾æ˜¯å”¯ä¸€ä¸”ä¸å¯å˜çš„ã€‚èŠ±ç‚¹æ—¶é—´åœ¨æ‚¨çš„ page-tracker/ æ–‡ä»¶å¤¹ä¸­åˆå§‹åŒ–ä¸€ä¸ªæœ¬åœ° Git å­˜å‚¨åº“ï¼Œå¹¶ä½¿ç”¨ä¸æ‚¨çš„å·¥ä½œç¯å¢ƒç›¸å…³çš„æ–‡ä»¶æ¨¡å¼å®šä¹‰ä¸€ä¸ª .gitignore ã€‚æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨ pwd å‘½ä»¤æ‰“å°æ‚¨çš„å·¥ä½œç›®å½•æ¥ä»”ç»†æ£€æŸ¥æ‚¨æ˜¯å¦åœ¨æ­£ç¡®çš„æ–‡ä»¶å¤¹ä¸­ï¼š\n$ pwd /home/realpython/page-tracker $ git init Initialized empty Git repository in /home/realpython/page-tracker/.git/ $ curl -sL https://www.gitignore.io/api/python,pycharm+all \u0026gt; .gitignore åœ¨è¿™é‡Œï¼Œæ‚¨ä½¿ç”¨ curl ä» gitignore.io ä¸‹è½½å†…å®¹ï¼Œè¯·æ±‚ Git ä»è·Ÿè¸ªä¸­æ’é™¤ Python å’Œ PyCharm ç›¸å…³çš„æ–‡ä»¶æ¨¡å¼ã€‚ -L æ ‡å¿—æ˜¯è·Ÿéšé‡å®šå‘æ‰€å¿…éœ€çš„ï¼Œå› ä¸ºè¯¥ç½‘ç«™æœ€è¿‘ç§»åŠ¨åˆ°å…·æœ‰æ›´é•¿åŸŸçš„ä¸åŒåœ°å€ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä» GitHub çš„ gitignore å­˜å‚¨åº“ä¸­è·å–å…¶ä¸­ä¸€ä¸ªæ¨¡æ¿ï¼ŒæŸäº›ä»£ç ç¼–è¾‘å™¨ä¼šä½¿ç”¨è¯¥æ¨¡æ¿ã€‚\nåˆå§‹åŒ–æœ¬åœ° Git å­˜å‚¨åº“åï¼Œæ‚¨å¯ä»¥è¿›è¡Œç¬¬ä¸€æ¬¡æäº¤å¹¶è·å–ç›¸åº”çš„å“ˆå¸Œå€¼ï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨ git rev-parse å‘½ä»¤ï¼š\n$ git add . $ git commit -m \u0026#34;Initial commit\u0026#34; [master (root-commit) dde1dc9] Initial commit 11 files changed, 535 insertions(+) create mode 100644 .gitignore create mode 100644 Dockerfile create mode 100644 Dockerfile.dev create mode 100644 constraints.txt create mode 100644 pyproject.toml create mode 100644 src/page_tracker/__init__.py create mode 100644 src/page_tracker/app.py create mode 100644 test/conftest.py create mode 100644 test/e2e/test_app_redis_http.py create mode 100644 test/integration/test_app_redis.py create mode 100644 test/unit/test_app.py $ git rev-parse HEAD dde1dc9303a2a9f414d470d501572bdac29e4075 å¦‚æœä½ ä¸å–œæ¬¢é•¿è¾“å‡ºï¼Œé‚£ä¹ˆä½ å¯ä»¥åœ¨å‘½ä»¤ä¸­æ·»åŠ  --short æ ‡å¿—ï¼Œè¿™å°†ä¸ºä½ æä¾›ç›¸åŒæäº¤å“ˆå¸Œçš„ç¼©å†™ç‰ˆæœ¬ï¼š\n$ git rev-parse --short HEAD dde1dc9 é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå°†è¿”å›å¯ä»¥å”¯ä¸€æ ‡è¯†è¯¥ç‰¹å®šæäº¤è€Œä¸ä¼šäº§ç”Ÿæ­§ä¹‰çš„æœ€çŸ­å‰ç¼€ã€‚\nç°åœ¨æ‚¨å·²ç»æœ‰äº† Git æäº¤å“ˆå¸Œï¼Œæ‚¨å¯ä»¥å°†å®ƒç”¨ä½œ Docker é•œåƒçš„æ ‡ç­¾ã€‚è¦æ„å»ºé•œåƒï¼Œè¯·åœ¨æŒ‡å®š -t æˆ– --tag é€‰é¡¹çš„åŒæ—¶è¿è¡Œ docker build å‘½ä»¤ï¼Œä»¥ä¾¿ä¸ºæ–°é•œåƒæ·»åŠ æ ‡ç­¾ã€‚å°¾éšç‚¹è¡¨ç¤ºæ‚¨å½“å‰çš„å·¥ä½œç›®å½•æ˜¯æŸ¥æ‰¾ Dockerfile çš„ä½ç½®ï¼š\n$ docker build -t page-tracker:$(git rev-parse --short HEAD) . å†’å·ä¹‹å‰çš„ç¬¬ä¸€éƒ¨åˆ† page-tracker æ˜¯æ‚¨çš„ Docker é•œåƒçš„åŠ©è®°åç§°ã€‚è¯·æ³¨æ„ï¼Œåœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œæ‚¨å¯èƒ½ä¼šé™„åŠ æŸç§åç¼€æ¥ä¼ è¾¾æ­¤æœåŠ¡çš„è§’è‰²ã€‚ä¾‹å¦‚ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ª Flask ç½‘ç»œåº”ç”¨ç¨‹åºï¼Œæ‚¨å¯ä»¥å°†é•œåƒå‘½åä¸º page-tracker-web æˆ–ç±»ä¼¼çš„åç§°ã€‚å†’å·åé¢çš„æ˜¯å®é™…æ ‡è®°ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œå®ƒæ˜¯å½“å‰æäº¤çš„ Git æäº¤å“ˆå¸Œã€‚\nå¦‚æœæ‚¨ä¹‹å‰æ„å»º Docker é•œåƒæ—¶æ²¡æœ‰ç»™å®ƒæ˜ç¡®çš„æ ‡ç­¾ï¼Œæˆ–è€…å¦‚æœæ‚¨ä»¥å…¶ä»–æ–¹å¼æ ‡è®°å®ƒï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°ç°åœ¨æ„å»ºå®ƒåªéœ€è¦å‡ åˆ†ä¹‹ä¸€ç§’ï¼\né‚£æ˜¯å› ä¸º Docker ç¼“å­˜äº†æ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿå±‚ï¼Œåªè¦é¡¹ç›®ä¸­çš„é‡è¦æ–‡ä»¶æ²¡æœ‰æ›´æ”¹ï¼Œå°±ä¸éœ€è¦é‡å»ºè¿™äº›å±‚ã€‚\nå¦ä¸€ç‚¹å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¡¨é¢ä¹‹ä¸‹ï¼ŒDocker ä»…å­˜å‚¨æ‚¨çš„é•œåƒçš„ä¸€ä¸ªå‰¯æœ¬ã€‚å®ƒæœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œä¾‹å¦‚ 9cb2e3233522 ï¼Œå¤šä¸ªæ ‡ç­¾å¯ä»¥å¼•ç”¨ï¼š\n$ docker images REPOSITORY TAG IMAGE ID CREATED SIZE page-tracker dde1dc9 9cb2e3233522 1 hour ago 204MB page-tracker prod 9cb2e3233522 1 hour ago 204MB page-tracker dev f9918cb213dc 1 hour ago 244MB (...) è¿™å°±æ˜¯æ ‡è®° Docker é•œåƒçš„åŠ›é‡ã€‚å®ƒå…è®¸æ‚¨ä½¿ç”¨ä¸åŒçš„æ ‡ç­¾å¼•ç”¨åŒä¸€é•œåƒï¼Œä¾‹å¦‚ page-tracker:prod æˆ– page-tracker:dde1dc9 ï¼ŒåŒæ—¶ä¿ç•™å”¯ä¸€æ ‡è¯†ã€‚æ¯ä¸ªæ ‡ç­¾éƒ½åŒ…å«å­˜å‚¨åº“åç§°ï¼ˆæ‚¨å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­äº†è§£ï¼‰å’Œä¸€ä¸ªç‰¹å®šçš„æ ‡ç­¾åç§°ã€‚\næ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨æ‚¨ä» Dockerfile æ„å»ºçš„é—ªäº®çš„æ–° Docker é•œåƒæ¥å¯åŠ¨ä¸€ä¸ªæˆç†Ÿçš„ Docker å®¹å™¨ã€‚å…·ä½“æ¥è¯´ï¼Œæ‚¨å¯ä»¥åœ¨ç¬”è®°æœ¬ç”µè„‘æˆ–æ”¯æŒ Docker çš„è¿œç¨‹åŸºäºäº‘çš„æœåŠ¡å™¨ä¸Šæœ¬åœ°è¿è¡Œå®¹å™¨ã€‚\nè¿™å¯èƒ½æ˜¯æ‚¨è¿›è¡Œç«¯åˆ°ç«¯æµ‹è¯•çš„å”¯ä¸€æ–¹æ³•ã€‚\nä½†æ˜¯å¦‚ä½•å°†å®¹å™¨æ”¾åˆ°è¿œç¨‹ç¯å¢ƒä¸­å‘¢ï¼Ÿä½ ä¼šåœ¨ä¸‹ä¸€èŠ‚ä¸­æ‰¾åˆ°ç­”æ¡ˆã€‚\nå°†é•œåƒæ¨é€åˆ° Docker Registry å½“æ‚¨ä¸ä»–äººåä½œå¤„ç†ä¸€æ®µä»£ç æ—¶ï¼Œæ‚¨é€šå¸¸ä¼šä½¿ç”¨ Git ç­‰ç‰ˆæœ¬æ§åˆ¶æ¥è·Ÿè¸ªæ‰€æœ‰ç›¸å…³äººå‘˜æ‰€åšçš„æ‰€æœ‰æ›´æ”¹ã€‚è™½ç„¶ Git æœ¬èº«æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œå…è®¸æ‚¨é›†æˆä»»ä½•ä¸¤ä¸ªäººä¹‹é—´çš„è´¡çŒ®ï¼Œä½†å®ƒç¼ºä¹é›†ä¸­æ‰˜ç®¡æœåŠ¡æ¥ä¿ƒè¿›å¤šæ–¹ä¹‹é—´çš„åŒæ—¶åä½œã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¤§å¤šæ•°äººé€‰æ‹© GitHub æˆ–ç«äº‰å¯¹æ‰‹çš„åŸå› ã€‚\nGitHub æ˜¯æ‚¨é€šå¸¸ä¸Šä¼ æºä»£ç çš„åœ°æ–¹ï¼Œè€Œ Docker Registry æ˜¯å­˜å‚¨æ„å»ºçš„ Docker é•œåƒçš„å¸¸ç”¨ä½ç½®ã€‚ä»äº‹å•†ä¸šäº§å“çš„å…¬å¸å°†å¸Œæœ›åœ¨ç§æœ‰äº‘æˆ–æœ¬åœ°å»ºç«‹è‡ªå·±çš„ Docker Registryï¼Œä»¥è·å¾—é¢å¤–çº§åˆ«çš„æ§åˆ¶å’Œå®‰å…¨æ€§ã€‚è®¸å¤šæµè¡Œçš„äº‘æä¾›å•†ä»¥æ‰˜ç®¡æœåŠ¡çš„å½¢å¼æä¾›é«˜åº¦å®‰å…¨çš„ Docker æ³¨å†Œè¡¨ã€‚\næ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ç§æœ‰æ³¨å†Œè¡¨ï¼Œä¾‹å¦‚ï¼Œé€šè¿‡ Docker è¿è¡Œå¼€æºåˆ†å‘å®¹å™¨ã€‚\næˆ–è€…ï¼Œå¦‚æœè¿™å¤ªéº»çƒ¦ï¼Œé‚£ä¹ˆæ‚¨ä¼šå¾ˆé«˜å…´å¾—çŸ¥ Docker Hub æä¾›äº†ä¸€ä¸ªå®‰å…¨çš„æ‰˜ç®¡æ³¨å†Œè¡¨ï¼Œæ‚¨å¯ä»¥å¼€å§‹å…è´¹ä½¿ç”¨å®ƒã€‚è™½ç„¶å…è´¹å±‚ä¸ºæ‚¨æä¾›äº†æ— é™æ•°é‡çš„å…¬å…±å­˜å‚¨åº“ï¼Œä½†æ‚¨å°†åªæœ‰ä¸€ä¸ªç§æœ‰å­˜å‚¨åº“ï¼Œå¹¶ä¸”å¯¹å¤–ç•Œä¸å¯è§ã€‚è€ƒè™‘åˆ°æ‚¨ä¸å¿…æ”¯ä»˜ä¸€åˆ†é’±ï¼Œè¿™å¯¹äºä¸ªäººæˆ–ä¸šä½™çˆ±å¥½é¡¹ç›®æ¥è¯´æ˜¯ä¸€ç¬”ä¸é”™çš„äº¤æ˜“ã€‚\næ³¨æ„ï¼šæ‚¨çš„ Docker Hub å¸æˆ·ä¸Šçš„å­˜å‚¨åº“æ˜¯ç”¨æˆ·å¯ä»¥ä¸Šä¼ æˆ–ä¸‹è½½çš„ Docker é•œåƒçš„é›†åˆã€‚æ¯ä¸ªå­˜å‚¨åº“å¯ä»¥åŒ…å«åŒä¸€é•œåƒçš„å¤šä¸ªæ ‡è®°ç‰ˆæœ¬ã€‚\nåœ¨è¿™æ–¹é¢ï¼ŒDocker Hub å­˜å‚¨åº“ç±»ä¼¼äº GitHub å­˜å‚¨åº“ï¼Œä½†ä¸“é—¨ç”¨äº Docker é•œåƒè€Œä¸æ˜¯ä»£ç ã€‚ç§æœ‰å­˜å‚¨åº“å…è®¸æ‚¨ä»…å…è®¸æˆæƒç”¨æˆ·è®¿é—®ï¼Œè€Œå…¬å…±å­˜å‚¨åº“å¯ä¾›æ‰€æœ‰äººä½¿ç”¨ã€‚\nä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Docker Registryï¼Ÿ\nå¥½å§ï¼Œæ‚¨ä¸å¿…è¿™æ ·åšï¼Œä½†å®ƒæœ‰åŠ©äºåœ¨æ•´ä¸ªç»„ç»‡å†…å…±äº« Docker é•œåƒæˆ–è®¾ç½®æŒç»­é›†æˆç®¡é“ã€‚ä¾‹å¦‚ï¼Œå°†æäº¤æ¨é€åˆ° GitHub æˆ–å…¶ä»–æºä»£ç ä¿®è®¢ç³»ç»Ÿå¯ä»¥é€šè¿‡è‡ªåŠ¨æ„å»ºåŠŸèƒ½å¯åŠ¨æ„å»ºè¿‡ç¨‹ã€‚åè¿‡æ¥ï¼Œæ³¨å†Œä¸­å¿ƒä¼šå®£å¸ƒæ–°çš„ Docker é•œåƒå·²æˆåŠŸæ„å»ºæˆ–ä½¿ç”¨ webhook å¼€å§‹éƒ¨ç½²åˆ°è¿œç¨‹ç¯å¢ƒä»¥è¿›è¡Œè¿›ä¸€æ­¥æµ‹è¯•ã€‚\nå¦‚æœè¿˜æ²¡æœ‰ï¼Œè¯·ç«‹å³åœ¨ Docker Hub ä¸Šæ³¨å†Œä¸€ä¸ªå¸æˆ·ã€‚è¯·æ³¨æ„ï¼Œé™¤äº†ç”µå­é‚®ä»¶åœ°å€å’Œå¯†ç å¤–ï¼Œæ‚¨è¿˜éœ€è¦æä¾›å”¯ä¸€çš„ç”¨æˆ·åï¼Œå°±åƒåœ¨ GitHub ä¸Šä¸€æ ·ï¼š\né€‰æ‹©ä¸€ä¸ªå¥½è®°çš„ç”¨æˆ·åè‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒå°†æˆä¸ºæ‚¨åœ¨ Docker Hub ä¸Šçš„ç‹¬ç‰¹å¥æŸ„ã€‚ä¸ºäº†é¿å…ä¸åŒç”¨æˆ·æ‹¥æœ‰çš„é•œåƒä¹‹é—´çš„åç§°å†²çªï¼ŒDocker Hub é€šè¿‡ç”¨æˆ·åå’Œå­˜å‚¨åº“åç§°çš„ç»„åˆæ¥è¯†åˆ«æ¯ä¸ªå­˜å‚¨åº“ã€‚\nä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„ç”¨æˆ·åæ˜¯ realpython ï¼Œé‚£ä¹ˆæ‚¨çš„ä¸€ä¸ªå­˜å‚¨åº“å¯ä»¥ç”±å­—ç¬¦ä¸² realpython/page-tracker æ ‡è¯†ï¼Œå®ƒç±»ä¼¼äº GitHub ä¸Šå­˜å‚¨åº“çš„åç§°ã€‚\nåœ¨ Web æµè§ˆå™¨ä¸­æ³¨å†Œå¹¶ç™»å½•åˆ°æ‚¨çš„æ–° Docker Hub å¸æˆ·åï¼Œæ‚¨åº”è¯¥åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯ä¸ºæ‚¨çš„é•œåƒåˆ›å»ºä¸€ä¸ªå­˜å‚¨åº“ã€‚å•å‡»â€œåˆ›å»ºå­˜å‚¨åº“â€ç£è´´æˆ–è½¬åˆ°é¡¶éƒ¨å¯¼èˆªæ ä¸­çš„â€œå­˜å‚¨åº“â€é€‰é¡¹å¡ï¼Œç„¶åå•å‡»â€œåˆ›å»ºå­˜å‚¨åº“â€æŒ‰é’®ã€‚ç„¶åï¼Œå°†æ‚¨çš„å­˜å‚¨åº“å‘½åä¸º page-tracker ï¼Œå¦‚æœéœ€è¦ï¼Œè¯·ä¸ºå…¶æä¾›æœ‰æ„ä¹‰çš„æè¿°ï¼Œç„¶åé€‰æ‹© Private é€‰é¡¹ä»¥ä½¿å…¶ä»…å¯¹æ‚¨å¯è§ï¼š\nä¹‹åï¼Œæ‚¨å°†çœ‹åˆ°å¸¦æœ‰ç»ˆç«¯å‘½ä»¤çš„è¯´æ˜ï¼Œè¿™äº›å‘½ä»¤å°†å…è®¸æ‚¨å°† Docker é•œåƒæ¨é€åˆ°æ‚¨çš„å­˜å‚¨åº“ã€‚ä½†é¦–å…ˆï¼Œæ‚¨å¿…é¡»ä»å‘½ä»¤è¡Œç™»å½• Docker Hubï¼Œæä¾›æ‚¨çš„ç”¨æˆ·åå’Œå¯†ç ï¼š\n$ docker login -u realpython Password: å³ä½¿æ‚¨æ‰“ç®—ä»…ä½¿ç”¨å…¬å…±å­˜å‚¨åº“ï¼Œä¹Ÿéœ€è¦ä½¿ç”¨ docker login è¿›è¡Œèº«ä»½éªŒè¯ã€‚\næ³¨æ„ï¼šå¦‚æœæ‚¨åœ¨ Docker Hub å¸æˆ·çš„å®‰å…¨è®¾ç½®ä¸­å¯ç”¨äº†åŒå› ç´ èº«ä»½éªŒè¯ï¼Œé‚£ä¹ˆæ‚¨å°†éœ€è¦ç”Ÿæˆä¸€ä¸ªå…·æœ‰é€‚å½“æƒé™çš„è®¿é—®ä»¤ç‰Œï¼Œä»¥ä¾¿åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ docker ç™»å½•ã€‚å½“å®ƒè¦æ±‚æ‚¨è¾“å…¥å¯†ç æ—¶ï¼Œåªéœ€æä¾›æ‚¨çš„ä»¤ç‰Œå³å¯ã€‚\nå¦åˆ™ï¼Œå¦‚æœæ‚¨æ²¡æœ‰é…ç½®åŒå› ç´ èº«ä»½éªŒè¯ï¼Œé‚£ä¹ˆæ‚¨å°†èƒ½å¤Ÿä½¿ç”¨æ‚¨çš„ Docker Hub å¯†ç ç™»å½•ã€‚å°½ç®¡å¦‚æ­¤ï¼Œå¦‚æ–‡æ¡£æ‰€è¿°ï¼Œä»ç„¶å€¼å¾—ç”Ÿæˆä¸€ä¸ªä»¤ç‰Œä»¥è·å¾—æ›´å¥½çš„å®‰å…¨æ€§ã€‚\nå½“ä½ ä½¿ç”¨ Git å°†ä»£ç æ¨é€åˆ°è¿œç¨‹å­˜å‚¨åº“æ—¶ï¼Œä½ å¿…é¡»é¦–å…ˆä»æŸä¸ªåœ°æ–¹å…‹éš†å®ƒæˆ–æ‰‹åŠ¨è®¾ç½®é»˜è®¤æºï¼Œå®ƒé…ç½®æœ¬åœ°å­˜å‚¨åº“çš„å…ƒæ•°æ®ã€‚\nç›¸æ¯”ä¹‹ä¸‹ï¼Œä½¿ç”¨ Docker Hub æˆ–ä»»ä½•å…¶ä»– Docker æ³¨å†Œè¡¨ï¼Œå°†æœ¬åœ°é•œåƒæ˜ å°„åˆ°è¿œç¨‹é•œåƒçš„è¿‡ç¨‹æœ‰ç‚¹ä¸åŒâ€”â€”æ‚¨ä½¿ç”¨æ ‡è®°ã€‚å…·ä½“æ¥è¯´ï¼Œæ‚¨ä½¿ç”¨ Docker Hub çš„ç”¨æˆ·åå’Œå­˜å‚¨åº“åç§°ä½œä¸ºå‰ç¼€æ¥æ ‡è®°æ„å»ºçš„é•œåƒã€‚\né¦–å…ˆï¼Œæ‚¨å¿…é¡»æä¾›è¦å‘å¸ƒçš„æœ¬åœ° Docker é•œåƒçš„æºæ ‡ç­¾ï¼Œä¾‹å¦‚ page-tracker:dde1dc9 ã€‚è¦æ‰¾åˆ°æ‚¨åˆšåˆšæ„å»ºçš„ page-tracker é•œåƒçš„ç¡®åˆ‡æ ‡ç­¾ï¼Œè¯·æ£€æŸ¥æ‚¨å½“å‰çš„ Git æäº¤å“ˆå¸Œæˆ–åˆ—å‡ºæ‚¨ç°æœ‰çš„ docker images ã€‚\nä¸€æ—¦çŸ¥é“å¦‚ä½•æ ‡è®°é•œåƒï¼Œå°±å¯ä»¥ä½¿ç”¨ç›¸åŒçš„æäº¤å“ˆå¸Œæ¥æ„å»ºç›®æ ‡æ ‡ç­¾ï¼Œè¯¥æ ‡ç­¾å°†åœ¨ Docker æ³¨å†Œè¡¨ä¸­æ ‡è¯†æ‚¨çš„å­˜å‚¨åº“ã€‚è¯·è®°ä½åœ¨åˆ›å»ºæ–°æ ‡ç­¾ä¹‹å‰å°† realpython æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„ Docker Hub ç”¨æˆ·åï¼š\n$ docker tag page-tracker:dde1dc9 realpython/page-tracker:dde1dc9 è¿™ä¼šå°†æ–°æ ‡ç­¾ realpython/page-tracker:dde1dc9 æ·»åŠ åˆ°æ ‡è®°ä¸º page-tracker:dde1dc9 çš„æœ¬åœ°é•œåƒã€‚ç›®æ ‡æ ‡ç­¾çš„å®Œæ•´å½¢å¼å¦‚ä¸‹æ‰€ç¤ºï¼š\nregistry/username/repository:tag å½“ä½ æƒ³æ¨é€åˆ°é»˜è®¤çš„ Docker Hub æ—¶ï¼Œå¯ä»¥çœç•¥æ³¨å†Œè¡¨éƒ¨åˆ†ã€‚å¦åˆ™ï¼Œå®ƒå¯ä»¥æ˜¯åŸŸåœ°å€ï¼Œä¾‹å¦‚ docker.io ï¼Œæˆ–å¸¦æœ‰ç§æœ‰æ³¨å†Œè¡¨å®ä¾‹çš„å¯é€‰ç«¯å£å·çš„ IP åœ°å€ã€‚ç”¨æˆ·åå’Œå­˜å‚¨åº“å¿…é¡»ä¸æ‚¨åœ¨ Docker Hub æˆ–æ‚¨ä½¿ç”¨çš„ä»»ä½•æ³¨å†Œè¡¨ä¸Šåˆ›å»ºçš„ç”¨æˆ·åå’Œå­˜å‚¨åº“ç›¸å¯¹åº”ã€‚å¦‚æœæ‚¨ä¸æä¾›æ ‡ç­¾ï¼Œé‚£ä¹ˆ Docker å°†éšå¼åº”ç”¨æ ‡ç­¾ latest ï¼Œè¿™å¯èƒ½æ˜¯æœªå®šä¹‰çš„ã€‚\næ‚¨å¯ä»¥ä½¿ç”¨å¤šä¸ªæ ‡ç­¾æ¥æ ‡è®°åŒä¸€é•œåƒï¼š\n$ docker tag page-tracker:dde1dc9 realpython/page-tracker:latest æ­£ç¡®æ ‡è®°é•œåƒåï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ docker push å°†å®ƒä»¬å‘é€åˆ°æ‰€éœ€çš„æ³¨å†Œè¡¨ï¼š\n$ docker push realpython/page-tracker:dde1dc9 $ docker push realpython/page-tracker:latest ä¸è¦æ‹…å¿ƒå‘é€ç›¸åŒçš„é•œåƒä¸¤æ¬¡ã€‚ Docker è¶³å¤Ÿèªæ˜ï¼Œå¯ä»¥çŸ¥é“æ‚¨ä¹‹å‰ä½•æ—¶æ¨é€è¿‡é•œåƒï¼Œå¦‚æœå®ƒåœ¨æ³¨å†Œè¡¨ä¸­æ£€æµ‹åˆ°è¯¥é•œåƒï¼Œåˆ™åªä¼šä¼ è¾“å¿…è¦çš„å…ƒæ•°æ®ã€‚\nå½“æ‚¨åœ¨ Docker Hub ä¸Šåˆ·æ–°æ‚¨çš„é…ç½®æ–‡ä»¶æ—¶ï¼Œå®ƒåº”è¯¥åæ˜ æ‚¨åˆšåˆšæ¨é€åˆ°å­˜å‚¨åº“ä¸­çš„ä¸¤ä¸ªæ ‡ç­¾ï¼š\nç°åœ¨ï¼Œå½“æ‚¨å°†åä½œè€…æ·»åŠ åˆ°æ‚¨çš„ç§æœ‰å­˜å‚¨åº“æ—¶ï¼Œä»–ä»¬å°†èƒ½å¤Ÿæ¨é€æˆ–æ‹‰å–é•œåƒã€‚è¯·è®°ä½ï¼Œè¿™éœ€è¦åœ¨ Docker Hub ä¸Šå‡çº§è®¢é˜…è®¡åˆ’ã€‚\nå¦ä¸€ç§æ–¹æ³•æ˜¯ç”Ÿæˆä¸€ä¸ªå¯¹æ‰€æœ‰å­˜å‚¨åº“å…·æœ‰åªè¯»æƒé™çš„è®¿é—®ä»¤ç‰Œï¼Œæˆ–è€…åˆ›å»ºä¸€ä¸ªå…¬å…±å­˜å‚¨åº“ã€‚\nå¥½çš„ã€‚ç»ˆäºåˆ°äº†é€šè¿‡åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œæ‚¨çš„ dockerized Flask web åº”ç”¨ç¨‹åºçš„æœºä¼šäº†ã€‚\nè¿è¡Œä¸€ä¸ª Docker å®¹å™¨ å¦‚æœä½ ä»ä¸€ä¸ªå¹²å‡€çš„ Docker ç¯å¢ƒå¼€å§‹ï¼Œä¹Ÿè®¸åœ¨å¦ä¸€å°è®¡ç®—æœºä¸Šï¼Œé‚£ä¹ˆä½ å¯ä»¥é€šè¿‡ä» Docker Hub æ‹‰å–å®ƒæ¥ä¸‹è½½ä½ çš„é•œåƒï¼Œåªè¦ä½ æœ‰è¯»å–è¯¥å­˜å‚¨åº“çš„æƒé™ï¼š\n$ docker pull realpython/page-tracker Using default tag: latest latest: Pulling from realpython/page-tracker f1f26f570256: Pull complete 2d2b01660885: Pull complete e4e8e4c0b0e1: Pull complete 1ba60f086308: Pull complete 3c2fccf90be1: Pull complete 15e9066b1610: Pull complete e8271c9a01cc: Pull complete 4f4fb700ef54: Pull complete bb211d339643: Pull complete 8690f9a37c37: Pull complete 7404f1e120d1: Pull complete Digest: sha256:cc6fe40a1ac73e6378d0660bf386a1599880a30e422dc061680769bc4d501164 Status: Downloaded newer image for realpython/page-tracker:latest docker.io/realpython/page-tracker:latest ç”±äºæ‚¨æ²¡æœ‰ä¸ºé•œåƒæŒ‡å®šä»»ä½•æ ‡ç­¾ï¼Œå› æ­¤ Docker ä¼šæ‹‰å–æ ‡è®°ä¸º latest çš„æ ‡ç­¾ã€‚è¯·æ³¨æ„ï¼Œè¾“å‡ºè¿˜åŒ…æ‹¬é•œåƒå„ä¸ªå±‚çš„æ ‡è¯†ç¬¦ï¼Œå¯¹åº”äºç”¨äºæ„å»ºè¯¥é•œåƒçš„åŸå§‹ Dockerfile ä¸­çš„ 11 æ¡æŒ‡ä»¤ã€‚\nä¸è¿‡ï¼Œæ‚¨ä¸å¿…æ‰‹åŠ¨æ‹‰å–é•œåƒï¼Œå› ä¸º Docker ä¼šåœ¨æ‚¨ç¬¬ä¸€æ¬¡å°è¯•è¿è¡Œå®ƒä»¬æ—¶ä¸ºæ‚¨å®Œæˆã€‚å¦‚æœæŒ‡å®šçš„é•œåƒå·²ç»åœ¨ç¼“å­˜ä¸­ï¼Œé‚£ä¹ˆä¸€ä¸ªæ–°çš„å®¹å™¨å°†ç«‹å³å¯åŠ¨ï¼Œè€Œä¸ä¼šç­‰åˆ°ä¸‹è½½å®Œæˆã€‚\nä¸‹é¢æ˜¯åŸºäºæ–°é•œåƒè¿è¡Œæ–° Docker å®¹å™¨çš„å‘½ä»¤ï¼š\n$ docker run -p 80:5000 --name web-service realpython/page-tracker * Serving Flask app \u0026#39;page_tracker.app\u0026#39; * Debug mode: off WARNING: This is a development server. Do not use it in a production â®‘ deployment. Use a production WSGI server instead. * Running on all addresses (0.0.0.0) * Running on http://127.0.0.1:5000 * Running on http://172.17.0.3:5000 Press CTRL+C to quit å½“æ‚¨åœ¨æœ¬åœ°å¼€å‘é¡¹ç›®æ—¶ï¼Œä½¿ç”¨ç«¯å£è½¬å‘é€šè¿‡ä¸»æœºçš„ localhost è®¿é—® Web æœåŠ¡å™¨é€šå¸¸å¾ˆæ–¹ä¾¿ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ -p é€‰é¡¹å¯è®©æ‚¨å¯¼èˆªåˆ°åœ°å€ http://localhost:80 æˆ–åªæ˜¯ http://localhost ï¼Œè€Œæ— éœ€çŸ¥é“æ­£åœ¨è¿è¡Œçš„ Docker å®¹å™¨çš„ç¡®åˆ‡ IP åœ°å€ã€‚ç«¯å£ 80 æ˜¯ HTTP åè®®çš„é»˜è®¤ç«¯å£ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥åœ¨ Web æµè§ˆå™¨ä¸­é”®å…¥åœ°å€æ—¶çœç•¥å®ƒã€‚\næ­¤å¤–ï¼Œæ­¤ç«¯å£æ˜ å°„å°†ç¡®ä¿åœ¨ http://localhost:5000 å¤„æ²¡æœ‰ç½‘ç»œç«¯å£å†²çªï¼Œä»¥é˜²æ‚¨æ²¡æœ‰åœæ­¢æœ¬åœ° Flask å®ä¾‹ã€‚è¯·è®°ä½ï¼Œæ‚¨ä¹‹å‰å¯åŠ¨äº†ä¸€ä¸ªæ¥æ‰§è¡Œç«¯åˆ°ç«¯æµ‹è¯•ã€‚å¦‚æœè¿›ç¨‹ä»åœ¨åå°æŸå¤„è¿è¡Œï¼Œå®ƒå°†å ç”¨ Flask çš„é»˜è®¤ç«¯å£ 5000 ã€‚\næ³¨æ„ï¼šä¸ºæ‚¨çš„ Docker å®¹å™¨æä¾›ä¸€ä¸ªæè¿°æ€§åç§°ä¹Ÿå¾ˆæœ‰ç”¨ï¼Œä¾‹å¦‚ web-service ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥é€šè¿‡åç§°é‡æ–°å¯åŠ¨æˆ–åˆ é™¤å®ƒï¼Œè€Œæ— éœ€æŸ¥æ‰¾ç›¸åº”çš„å®¹å™¨æ ‡è¯†ç¬¦ã€‚å¦‚æœä½ ä¸è¿™æ ·åšï¼Œé‚£ä¹ˆ Docker ä¼šç»™ä½ çš„å®¹å™¨ä¸€ä¸ªæ„šè ¢çš„åå­—ï¼Œæ¯”å¦‚éšæœºé€‰æ‹©çš„ admiring_jang æˆ– frosty_almeida ã€‚\nå¦‚æœæ‚¨ä¸æƒ³æ‰‹åŠ¨æ“ä½œï¼Œè¯·è€ƒè™‘æ·»åŠ  --rm æ ‡å¿—ä»¥åœ¨å®¹å™¨åœæ­¢æ—¶è‡ªåŠ¨åˆ é™¤å®ƒã€‚\næ­£å¦‚æ‚¨åœ¨ä¸Šé¢çš„è¾“å‡ºä¸­çœ‹åˆ°çš„ï¼ŒFlask æœåŠ¡å™¨æ­£åœ¨å…¶å®¹å™¨å†…çš„æ‰€æœ‰ç½‘ç»œæ¥å£ ( 0.0.0.0 ) ä¸Šè¿è¡Œï¼Œæ­£å¦‚æ‚¨åœ¨ Dockerfile çš„ CMD å±‚ä¸­æŒ‡ç¤ºçš„é‚£æ ·ã€‚\nç»§ç»­å¹¶åœ¨æ‚¨çš„ Web æµè§ˆå™¨ä¸­è®¿é—®åœ°å€ http://localhost æˆ–ä½¿ç”¨ curl ä¹‹ç±»çš„å‘½ä»¤è¡Œå·¥å…·æ¥è®¿é—® dockerized é¡µé¢è·Ÿè¸ªå™¨ï¼š\n$ curl http://localhost Sorry, something went wrong ğŸ˜” ç”±äº Redis è¿æ¥å¤±è´¥ï¼Œæ‚¨å°†çœ‹åˆ°é¢„æœŸçš„é”™è¯¯æ¶ˆæ¯ï¼Œä½†è‡³å°‘æ‚¨å¯ä»¥è®¿é—®åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œçš„ Flask åº”ç”¨ç¨‹åºã€‚è¦ä¿®å¤é”™è¯¯ï¼Œæ‚¨éœ€è¦é€šè¿‡ä¼ é€’ç»™ web-service å®¹å™¨çš„ç¯å¢ƒå˜é‡æŒ‡å®šæ­£ç¡®çš„ Redis URLã€‚\nç°åœ¨é€šè¿‡æŒ‰é”®ç›˜ä¸Šçš„ Ctrl+C æˆ– Cmd+C åœæ­¢è¯¥å®¹å™¨ã€‚ç„¶åï¼Œæ‰¾åˆ°å®¹å™¨çš„æ ‡è¯†ç¬¦å¹¶åˆ é™¤å…³è”çš„å®¹å™¨ï¼š\n$ docker ps -a CONTAINER ID IMAGE COMMAND CREATED dd446a1b72a7 realpython/page-tracker \u0026#34;flask --app page_trâ€¦\u0026#34; 1 minute ago $ docker rm dd446a1b72a7 -a æ ‡å¿—ç¡®ä¿æ˜¾ç¤ºæ‰€æœ‰å®¹å™¨ï¼ŒåŒ…æ‹¬å·²åœæ­¢çš„å®¹å™¨ã€‚å¦åˆ™ï¼Œä½ ä¸ä¼šçœ‹åˆ°ä½ çš„ã€‚\né€šè¿‡ Docker å°† Flask Web åº”ç”¨ç¨‹åºè¿æ¥åˆ° Redis çš„æ­£ç¡®æ–¹æ³•æ˜¯åˆ›å»ºä¸“ç”¨è™šæ‹Ÿç½‘ç»œã€‚é¦–å…ˆï¼Œåˆ—å‡ºå¯ç”¨ç½‘ç»œä»¥æ£€æŸ¥æ‚¨æ˜¯å¦å·²ç»åˆ›å»ºäº† page-tracker-network ï¼š\n$ docker network ls NETWORK ID NAME DRIVER SCOPE 46e9ff2ec568 bridge bridge local 4795b850cb58 host host local f8f99d305c5e none null local 84b134794660 page-tracker-network bridge local å¦‚æœå®ƒä¸å­˜åœ¨ï¼Œé‚£ä¹ˆæ‚¨ç°åœ¨å¯ä»¥é€šè¿‡å‘å‡ºä»¥ä¸‹å‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªï¼š\n$ docker network create page-tracker-network ä»¥ç±»ä¼¼çš„æ–¹å¼ï¼Œæ‚¨å¯ä»¥ä¸º Redis æœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªå·ï¼Œä»¥å°†å…¶æ•°æ®æŒä¹…å­˜å‚¨åœ¨æ‚¨çš„ä¸»æœºä¸Šã€‚è¿™æ ·ï¼Œæ‚¨å¯ä»¥é‡æ–°å¯åŠ¨ç”šè‡³åˆ é™¤å¹¶ä»å¤´å¼€å§‹åˆ›å»ºä¸€ä¸ªæ–°å®¹å™¨ï¼ŒRedis å°†å¯ä»¥è®¿é—®å…¶ä¹‹å‰çš„çŠ¶æ€ã€‚è¿™æ˜¯ä½¿ç”¨ Docker åˆ›å»ºå‘½åå·çš„æ–¹æ³•ï¼š\n$ docker volume create redis-volume æ¥ä¸‹æ¥ï¼Œåœæ­¢å¹¶ç§»é™¤ä»»ä½•å¯èƒ½æŒ‚èµ·çš„ Redis å®¹å™¨ï¼Œç„¶åå¯åŠ¨ä¸€ä¸ªæ–°å®¹å™¨ã€‚è¿™ä¸€æ¬¡ï¼Œæ‚¨å°†å®¹å™¨è¿æ¥åˆ° page-tracker-network å¹¶å°†å…¶ /data æ–‡ä»¶å¤¹ç»‘å®šåˆ°æ‚¨åˆšåˆšåˆ›å»ºçš„åä¸º redis-volume çš„å·ï¼š\n$ docker run -d \\ -v redis-volume:/data \\ --network page-tracker-network \\ --name redis-service \\ redis:7.0.10-bullseye å½“æ‚¨åœ¨ GitHub ä¸ŠæŸ¥çœ‹ Redis çš„å®˜æ–¹ Docker é•œåƒæ—¶ï¼Œæ‚¨ä¼šçœ‹åˆ°ä¸€ä¸ªåœ¨ /data æ–‡ä»¶å¤¹ä¸­å®šä¹‰æŒ‚è½½ç‚¹çš„å±‚ã€‚ Redis ä¼šä¸æ—¶åœ°å°†å…¶çŠ¶æ€è½¬å‚¨åˆ°è¯¥æ–‡ä»¶å¤¹ä¸­ã€‚é€šè¿‡å°†ç›®å½•ä»æ‚¨çš„ä¸»æœºæŒ‚è½½åˆ°æ­¤æŒ‚è½½ç‚¹ï¼Œå³ä½¿å®¹å™¨é‡æ–°å¯åŠ¨ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä¿æŒçŠ¶æ€ã€‚\né€šè¿‡ç»™ä½ çš„å®¹å™¨ä¸€ä¸ªæè¿°æ€§çš„åç§°ï¼Œ redis-service ï¼Œä½ å°†èƒ½å¤Ÿä»åŒä¸€ç½‘ç»œä¸Šçš„å¦ä¸€ä¸ªå®¹å™¨è¿æ¥åˆ°å®ƒã€‚å°±æ˜¯è¿™æ ·ï¼š\n$ docker run -d \\ -p 80:5000 \\ -e REDIS_URL=redis://redis-service:6379 \\ --network page-tracker-network \\ --name web-service \\ realpython/page-tracker æ‚¨å¯åŠ¨ä¸€ä¸ªä» page-tracker é•œåƒæ´¾ç”Ÿçš„æ–°å®¹å™¨ï¼Œå…¶ä¸­åŒ…å«ç›¸å½“å¤šçš„å‚æ•°ã€‚ä»¥ä¸‹æ˜¯ä¸Šè¿° docker run å‘½ä»¤ä¸­å„ä¸ªæ ‡å¿—å’Œé€‰é¡¹çš„å¿«é€Ÿç»†åˆ†ï¼š\n-d ï¼šåœ¨åå°è¿è¡Œå®¹å™¨ï¼Œä¸ç»ˆç«¯åˆ†ç¦»ã€‚è¿™æ„å‘³ç€æ‚¨å°†çœ‹ä¸åˆ° Flask æœåŠ¡å™¨çš„ä»»ä½•è¾“å‡ºï¼Œå¹¶ä¸”æ‚¨å°†æ— æ³•å†ä½¿ç”¨ Ctrl+C æˆ– Cmd+C åœæ­¢å®¹å™¨ã€‚ -p 80:5000 ï¼šå°†å®¹å™¨çš„ç«¯å£ 5000 æš´éœ²åœ¨ä¸»æœºçš„ç«¯å£ 80 ä¸Šï¼Œè¿™æ ·ä½ å°±å¯ä»¥é€šè¿‡æœ¬åœ°ä¸»æœºè®¿é—®ä½ çš„ web åº”ç”¨ç¨‹åºã€‚ -e REDIS_URL=... : å°†å®¹å™¨çš„ç¯å¢ƒå˜é‡è®¾ç½®ä¸ºåœ¨åŒä¸€ç½‘ç»œä¸Šçš„å¦ä¸€ä¸ªå®¹å™¨ä¸­è¿è¡Œçš„ Redis æœåŠ¡å™¨çš„åœ°å€ã€‚ --network page-tracker-network : æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„è™šæ‹Ÿç½‘ç»œã€‚è¿™å°†å…è®¸åŒä¸€ç½‘ç»œä¸Šçš„å…¶ä»–å®¹å™¨é€šè¿‡æŠ½è±¡åç§°è€Œä¸æ˜¯ IP åœ°å€ä¸è¯¥å®¹å™¨é€šä¿¡ã€‚ --name web-service : ä¸ºå®¹å™¨åˆ†é…ä¸€ä¸ªæœ‰æ„ä¹‰çš„åç§°ï¼Œè¿™æ ·æ›´å®¹æ˜“ä» Docker å‘½ä»¤ä¸­å¼•ç”¨å®¹å™¨ã€‚ ç°åœ¨ï¼Œå½“æ‚¨åœ¨ Web æµè§ˆå™¨æˆ–ç»ˆç«¯ä¸­è®¿é—® Flask Web åº”ç”¨ç¨‹åºæ—¶ï¼Œæ‚¨åº”è¯¥è§‚å¯Ÿåˆ°æ­£ç¡®çš„è¡Œä¸ºï¼š\n$ curl http://localhost This page has been seen 1 times. $ curl http://localhost This page has been seen 2 times. $ curl http://localhost This page has been seen 3 times. æ¯æ¬¡å‘é€è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨éƒ½ä¼šä»¥ä¸åŒæ•°é‡çš„é¡µé¢æµè§ˆé‡è¿›è¡Œå“åº”ã€‚è¯·æ³¨æ„ï¼Œæ‚¨æ­£åœ¨é€šè¿‡æœ¬åœ°ä¸»æœºè®¿é—®æœåŠ¡å™¨ã€‚å¦‚æœæ‚¨åœ¨ web-service ä¹‹å‰å¯åŠ¨äº† redis-service ï¼Œé‚£ä¹ˆå®¹å™¨çš„ IP åœ°å€å¯èƒ½å·²æ›´æ”¹ã€‚\nå“‡ï¼å…‰æ˜¯å¯åŠ¨å’Œè¿è¡Œä¸¤é¡¹æœåŠ¡å°±éœ€è¦åšå¤§é‡å·¥ä½œã€‚å¦‚æ‚¨æ‰€è§ï¼Œæ‰‹åŠ¨ç®¡ç† Docker é•œåƒã€å®¹å™¨ã€å·ã€ç½‘ç»œã€ç«¯å£å’Œç¯å¢ƒå˜é‡ä¼šè®©äººæ„Ÿåˆ°ä¸çŸ¥æ‰€æªã€‚è€Œè¿™åªæ˜¯è¡¨é¢ç°è±¡ï¼\næƒ³è±¡ä¸€ä¸‹ï¼Œç®¡ç†ä¸€ä¸ªåŒ…å«æ•°åç§æœåŠ¡çš„å¤æ‚åº”ç”¨ç¨‹åºéœ€è¦ä»˜å‡ºå¤šå°‘åŠªåŠ›ï¼Œå…¶ä¸­åŒ…æ‹¬ç”Ÿäº§å°±ç»ªç›‘æ§ã€è´Ÿè½½å¹³è¡¡ã€è‡ªåŠ¨ç¼©æ”¾ç­‰ã€‚\nå¹¸è¿çš„æ˜¯ï¼Œæœ‰æ›´å¥½çš„æ–¹æ³•å¯ä»¥è¾¾åˆ°åŒæ ·çš„æ•ˆæœã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæ‚¨å°†ç ”ç©¶ Docker ä¹‹ä¸Šçš„ä¸€ä¸ªæ–¹ä¾¿çš„æŠ½è±¡å±‚ï¼Œè®©æ‚¨åœ¨å®šä¹‰æŒç»­é›†æˆç®¡é“ä¹‹å‰ä½¿ç”¨å•ä¸ªå‘½ä»¤ç¼–æ’è¿™ä¸¤ç§æœåŠ¡ã€‚\nä½¿ç”¨ Docker Compose ç¼–æ’å®¹å™¨ å¤§å¤šæ•°ç°å®ä¸–ç•Œçš„åº”ç”¨ç¨‹åºç”±å¤šä¸ªç»„ä»¶ç»„æˆï¼Œè¿™äº›ç»„ä»¶è‡ªç„¶ä¼šè½¬åŒ–ä¸º Docker å®¹å™¨ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªæ¶‰åŠæ›´å¤šçš„ Web åº”ç”¨ç¨‹åºå¯èƒ½å…·æœ‰ä»¥ä¸‹å†…å®¹ï¼š\nBack end: Django, FastAPI, Flask Front end: Angular, React, Vue Cache: Couchbase, Memcached, Redis Queue: ActiveMQ, Kafka, RabbitMQ Database: MySQL, PostgreSQL, SQLite æ›´å¤§çš„åº”ç”¨ç¨‹åºå¯èƒ½ä¼šé€‰æ‹©å°†å…¶åç«¯æˆ–å‰ç«¯ç»„ä»¶ç»†åˆ†ä¸ºæ›´å¤šçš„å¾®æœåŠ¡ï¼Œè´Ÿè´£èº«ä»½éªŒè¯ã€ç”¨æˆ·ç®¡ç†ã€è®¢å•å¤„ç†ã€æ”¯ä»˜æˆ–æ¶ˆæ¯ä¼ é€’ç­‰ã€‚\nä¸ºäº†å¸®åŠ©ç®¡ç†å¹¶åœ¨æŸç§ç¨‹åº¦ä¸Šç¼–æ’æ­¤ç±»åº”ç”¨ç¨‹åºçš„å¤šä¸ª Docker å®¹å™¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Docker Composeã€‚å®ƒæ˜¯ä¸€ç§åœ¨ Docker ä¹‹ä¸Šè¿è¡Œçš„å·¥å…·ï¼Œå¯ç®€åŒ–è¿è¡Œå¤šå®¹å™¨ Docker åº”ç”¨ç¨‹åºã€‚ Docker Compose å…è®¸æ‚¨æ ¹æ®ç›¸äº’ä¾èµ–çš„æœåŠ¡åŠå…¶é…ç½®å’Œè¦æ±‚æ¥å®šä¹‰æ‚¨çš„åº”ç”¨ç¨‹åºã€‚ç„¶åå®ƒå°†åè°ƒå®ƒä»¬å¹¶å°†å®ƒä»¬ä½œä¸ºä¸€ä¸ªè¿è´¯çš„åº”ç”¨ç¨‹åºè¿è¡Œã€‚\næ³¨æ„ï¼šå®¹å™¨ç¼–æ’è‡ªåŠ¨åŒ–åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºçš„éƒ¨ç½²ã€æ‰©å±•å’Œé…ç½®ç®¡ç†ã€‚è™½ç„¶ Docker Compose å¯ä»¥å¸®åŠ©è¿›è¡ŒåŸºæœ¬å½¢å¼çš„ç¼–æ’ï¼Œä½†æ‚¨æœ€å¥½åœ¨æ›´å¤æ‚çš„å¤§å‹ç³»ç»Ÿä¸­ä½¿ç”¨ Kubernetes ç­‰å·¥å…·ã€‚\næ‚¨å°†ä½¿ç”¨ Docker Compose ä»¥å£°æ˜æ–¹å¼æè¿°æ‚¨çš„å¤šå®¹å™¨é¡µé¢è·Ÿè¸ªå™¨åº”ç”¨ç¨‹åºï¼Œä»¥åŠå®ƒçš„æœåŠ¡ã€ç½‘ç»œå’Œå·ï¼Œä½¿ç”¨å•ä¸ªé…ç½®æ–‡ä»¶ã€‚é€šè¿‡è¿™æ ·åšï¼Œæ‚¨å°†èƒ½å¤Ÿè·Ÿè¸ªæ›´æ”¹å¹¶å°†æ‚¨çš„åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°ä»»ä½•ç¯å¢ƒã€‚\nä¸è¿‡ï¼Œåœ¨æ·±å…¥ç ”ç©¶ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„è®¡ç®—æœºä¸Šå®‰è£…äº† Docker Composeã€‚\nåœ¨æ‚¨çš„è®¡ç®—æœºä¸Šè®¾ç½® Docker Compose å¦‚æœæ‚¨æŒ‰ç…§æœ‰å…³è®¾ç½® Docker Desktop çš„è¯´æ˜è¿›è¡Œæ“ä½œï¼Œé‚£ä¹ˆæ‚¨åº”è¯¥å·²ç»å®‰è£…äº† Docker Composeã€‚åœ¨æ‚¨çš„ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥ç¡®è®¤è¿™ä¸€ç‚¹ï¼š\n$ docker compose version Docker Compose version v2.17.2 ä½¿ç”¨æ†ç»‘äº† Docker Compose å’Œä¸€äº›å…¶ä»–ç»„ä»¶çš„ Docker Desktopï¼Œç›®å‰æ˜¯åœ¨ macOS å’Œ Windows ä¸Šè·å– Docker Compose çš„æ¨èæ–¹å¼ã€‚å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Linuxï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥å°è¯•é€šè¿‡æ‰‹åŠ¨å®‰è£… Compose æ’ä»¶æˆ–ä»æ‚¨çš„å‘è¡Œç‰ˆçš„è½¯ä»¶åŒ…å­˜å‚¨åº“å®‰è£…æ›¿ä»£è·¯å¾„ã€‚ä¸å¹¸çš„æ˜¯ï¼Œæ­¤æ–¹æ³•å¯èƒ½ä¸é€‚ç”¨äºæœ€æ–°å’Œæ¨èçš„ Docker Compose ç‰ˆæœ¬ã€‚\næ³¨æ„ï¼šåœ¨è¿‡å»ï¼ŒDocker Compose æ˜¯ä¸€ä¸ªç‹¬ç«‹äº Docker å•ç‹¬ç»´æŠ¤çš„é¡¹ç›®ã€‚å®ƒæœ€åˆæ˜¯ä½œä¸º Python è„šæœ¬å®ç°çš„ï¼Œæœ€ç»ˆè¢«é‡å†™ä¸º Goã€‚\nè¦ä½¿ç”¨ Docker Composeï¼Œæ‚¨å¿…é¡»åœ¨å‘½ä»¤è¡Œä¸­è°ƒç”¨ docker-compose ï¼ˆå¸¦è¿å­—ç¬¦ï¼‰å¯æ‰§è¡Œæ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œå®ƒç°åœ¨å·²é›†æˆåˆ° Docker å¹³å°ä¸­ï¼Œå› æ­¤æ‚¨å¯ä»¥å°† Docker Compose ä½œä¸º docker compose æ’ä»¶è°ƒç”¨ã€‚è¿™ä¸¤ä¸ªå‘½ä»¤çš„å·¥ä½œåŸç†åº”è¯¥ç›¸åŒï¼Œå› ä¸ºè¯¥æ’ä»¶æ˜¯ä¸€ç§ç›´æ¥æ›¿ä»£å“ã€‚\nä¸€æ—¦æ‚¨ç¡®è®¤ Docker Compose åœ¨æ‚¨çš„ç»ˆç«¯ä¸­å¯ç”¨ï¼Œæ‚¨å°±å¯ä»¥å¼€å§‹äº†ï¼\nå®šä¹‰å¤šå®¹å™¨ Docker åº”ç”¨ç¨‹åº ç”±äºæ‚¨å°†å®šä¹‰ä¸€ä¸ªå¤šå®¹å™¨ Docker åº”ç”¨ç¨‹åºï¼Œè¯¥åº”ç”¨ç¨‹åºå¯èƒ½ä¼šåœ¨æœªæ¥å¢é•¿ä»¥åŒ…å«æ›´å¤šæœåŠ¡ï¼Œå› æ­¤æœ‰å¿…è¦é‡æ–°å®‰æ’é¡¹ç›®ä¸­çš„æ–‡ä»¶å¤¹ç»“æ„ã€‚åœ¨é¡¹ç›®æ ¹æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º web/ çš„æ–°å­æ–‡ä»¶å¤¹ï¼Œæ‚¨å°†åœ¨å…¶ä¸­å­˜å‚¨ä¸ Flask Web æœåŠ¡ç›¸å…³çš„æ‰€æœ‰æ–‡ä»¶ã€‚\næ‚¨çš„è™šæ‹Ÿç¯å¢ƒä¹Ÿå±äºè¿™ä¸ªæ–°çš„å­æ–‡ä»¶å¤¹ï¼Œå› ä¸ºå…¶ä»–æœåŠ¡å¯èƒ½æ˜¯ç”¨å®Œå…¨å¤–å›½çš„ç¼–ç¨‹è¯­è¨€ï¼ˆå¦‚ C++ æˆ– Javaï¼‰å®ç°çš„ã€‚ä¸å¹¸çš„æ˜¯ï¼Œç§»åŠ¨ venv/ æ–‡ä»¶å¤¹å¯èƒ½ä¼šç ´åç›¸åº”æ¿€æ´»è„šæœ¬ä¸­ç¡¬ç¼–ç çš„ç»å¯¹è·¯å¾„ã€‚å› æ­¤ï¼Œç§»é™¤æ—§çš„è™šæ‹Ÿç¯å¢ƒå¹¶åœ¨ web/ å­æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„è™šæ‹Ÿç¯å¢ƒä»¥ç¡®ä¿å®‰å…¨ï¼š\nWindowsï¼š\n(page-tracker) PS\u0026gt; deactivate PS\u0026gt; cd page-tracker\\ PS\u0026gt; rmdir venv\\ /s PS\u0026gt; python -m venv web\\venv\\ --prompt page-tracker PS\u0026gt; web\\venv\\Scripts\\activate (page-tracker) PS\u0026gt; python -m pip install --upgrade pip Linux + MacOSï¼š\n(page-tracker) $ deactivate $ cd page-tracker/ $ rm -rf venv/ $ python3 -m venv web/venv/ --prompt page-tracker $ source web/venv/bin/activate (page-tracker) $ python -m pip install --upgrade pip ç„¶åï¼Œå°† Flask åº”ç”¨ç¨‹åºç§»åŠ¨åˆ°æ–°çš„ web/ å­æ–‡ä»¶å¤¹ï¼Œåªç•™ä¸‹ .git/ æ–‡ä»¶å¤¹ã€ .gitignore å’Œä»»ä½•å…¶ä»–ä¸ç¼–è¾‘å™¨ç›¸å…³çš„é…ç½®æ–‡ä»¶ã€‚æ‚¨å¯ä»¥å°†å®ƒä»¬ä¿å­˜åœ¨é¡¹ç›®æ ¹æ–‡ä»¶å¤¹ä¸­ï¼Œå› ä¸ºå®ƒä»¬å¯¹é¡¹ç›®ä¸­æ‰€æœ‰å¯èƒ½çš„æœåŠ¡éƒ½æ˜¯é€šç”¨çš„ã€‚ä¹‹åï¼Œæ‚¨çš„é¡¹ç›®ç»“æ„åº”å¦‚ä¸‹æ‰€ç¤ºï¼š\npage-tracker/ â”‚ â”œâ”€â”€ web/ â”‚ â”‚ â”‚ â”œâ”€â”€ src/ â”‚ â”‚ â””â”€â”€ page_tracker/ â”‚ â”‚ â”œâ”€â”€ __init__.py â”‚ â”‚ â””â”€â”€ app.py â”‚ â”‚ â”‚ â”œâ”€â”€ test/ â”‚ â”‚ â”œâ”€â”€ e2e/ â”‚ â”‚ â”‚ â””â”€â”€ test_app_redis_http.py â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ integration/ â”‚ â”‚ â”‚ â””â”€â”€ test_app_redis.py â”‚ â”‚ â”‚ â”‚ â”‚ â”œâ”€â”€ unit/ â”‚ â”‚ â”‚ â””â”€â”€ test_app.py â”‚ â”‚ â”‚ â”‚ â”‚ â””â”€â”€ conftest.py â”‚ â”‚ â”‚ â”œâ”€â”€ venv/ â”‚ â”‚ â”‚ â”œâ”€â”€ constraints.txt â”‚ â”œâ”€â”€ Dockerfile â”‚ â”œâ”€â”€ Dockerfile.dev â”‚ â””â”€â”€ pyproject.toml â”‚ â”œâ”€â”€ .git/ â”‚ â”œâ”€â”€ .gitignore â””â”€â”€ docker-compose.yml ä¸Šé¢æ–‡ä»¶æ ‘çš„ä¸€ä¸ªæ–°æ·»åŠ æ˜¯ä½äºé¡¶å±‚çš„ docker-compose.yml æ–‡ä»¶ï¼Œæ‚¨ç°åœ¨å°†ç¼–å†™è¯¥æ–‡ä»¶ã€‚\nDocker Compose ä½¿ç”¨ YAML æ ¼å¼ä»¥å£°æ˜æ–¹å¼æè¿°åº”ç”¨ç¨‹åºçš„æœåŠ¡ï¼Œè¿™äº›æœåŠ¡å°†æˆä¸º Docker å®¹å™¨ã€å®ƒä»¬çš„ç½‘ç»œã€å·ã€ç«¯å£æ˜ å°„ã€ç¯å¢ƒå˜é‡ç­‰ã€‚\nä»¥å‰ï¼Œæ‚¨å¿…é¡»æ‰‹åŠ¨å®šä¹‰åº”ç”¨ç¨‹åºæ¶æ„çš„æ¯ä¸€éƒ¨åˆ†ï¼Œä½†ä½¿ç”¨ Docker Composeï¼Œæ‚¨å¯ä»¥åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å®šä¹‰æ‰€æœ‰å†…å®¹ã€‚è¯¥å·¥å…·ç”šè‡³å¯ä»¥ä¸ºæ‚¨æ‹‰å–æˆ–æ„å»ºé•œåƒï¼\næ³¨æ„ï¼šå¦‚æœæ‚¨ä»¥å‰ä»æœªä½¿ç”¨è¿‡ YAMLï¼Œä½†ç†Ÿæ‚‰ JSONï¼Œé‚£ä¹ˆå®ƒçš„è¯­æ³•åº”è¯¥å¾ˆç†Ÿæ‚‰ï¼Œå› ä¸º YAML æ˜¯ JSON çš„è¶…é›†ã€‚æŸ¥çœ‹ YAMLï¼šPython ä¸­ä¸¢å¤±çš„ç”µæ± äº†è§£æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚\nDocker Compose æ–‡ä»¶æ˜¯æ‚¨å®šä¹‰æœåŠ¡ã€ç½‘ç»œå’Œå·çš„åœ°æ–¹ã€‚è¿™æ˜¯å®Œæ•´çš„ docker-compose.yml æ–‡ä»¶ï¼Œå®ƒåæ˜ äº†æ‚¨åœ¨å‰é¢éƒ¨åˆ†ä¸­ä¸ºé¡µé¢è·Ÿè¸ªå™¨åº”ç”¨ç¨‹åºæ‰‹åŠ¨å®šä¹‰çš„æ‰€æœ‰å†…å®¹ï¼š\n# docker-compose.yml services: redis-service: image: \u0026#34;redis:7.0.10-bullseye\u0026#34; networks: - backend-network volumes: - \u0026#34;redis-volume:/data\u0026#34; web-service: build: ./web ports: - \u0026#34;80:5000\u0026#34; environment: REDIS_URL: \u0026#34;redis://redis-service:6379\u0026#34; networks: - backend-network depends_on: - redis-service networks: backend-network: volumes: redis-volume: ä½ ç°åœ¨è¦é€è¡Œå‰–æå®ƒï¼š\nç¬¬ 3 è¡Œæ ‡å¿—ç€ä¸¤ä¸ªæœåŠ¡ redis-service å’Œ web-service å£°æ˜çš„å¼€å§‹ï¼Œå®ƒä»¬åŒ…å«ä¸€ä¸ªå¤šå®¹å™¨ Docker åº”ç”¨ç¨‹åºã€‚è¯·æ³¨æ„ï¼Œæ‚¨å¯ä»¥æ‰©å±•æ¯ä¸ªæœåŠ¡ï¼Œå› æ­¤ Docker å®¹å™¨çš„å®é™…æ•°é‡å¯èƒ½å¤§äºæ­¤å¤„å£°æ˜çš„æœåŠ¡æ•°é‡ã€‚ ç¬¬ 4 è¡Œåˆ°ç¬¬ 9 è¡Œå®šä¹‰äº† redis-service çš„é…ç½®ï¼ŒåŒ…æ‹¬è¦è¿è¡Œçš„ Docker é•œåƒã€è¦è¿æ¥çš„ç½‘ç»œä»¥åŠè¦æŒ‚è½½çš„å·ã€‚ ç¬¬ 10 åˆ° 19 è¡Œé€šè¿‡æŒ‡å®šåŒ…å«è¦æ„å»ºçš„ Dockerfile çš„æ–‡ä»¶å¤¹ã€è¦å…¬å¼€çš„ç«¯å£ã€è¦è®¾ç½®çš„ç¯å¢ƒå˜é‡ä»¥åŠè¦è¿æ¥çš„ç½‘ç»œæ¥é…ç½® web-service ã€‚ depends_on è¯­å¥è¦æ±‚ redis-service åœ¨ web-service å¼€å§‹ä¹‹å‰å¯ç”¨ã€‚ ç¬¬ 21 å’Œ 22 è¡Œä¸ºæ‚¨çš„ä¸¤ä¸ªæœåŠ¡å®šä¹‰äº†ä¸€ä¸ªè™šæ‹Ÿç½‘ç»œã€‚æ­¤å£°æ˜å¹¶éç»å¯¹å¿…è¦ï¼Œå› ä¸º Docker Compose ä¼šè‡ªåŠ¨åˆ›å»ºå®¹å™¨å¹¶å°†å…¶è¿æ¥åˆ°æ–°ç½‘ç»œã€‚ä½†æ˜¯ï¼Œå¦‚æœéœ€è¦ï¼Œæ˜¾å¼ç½‘ç»œå£°æ˜å¯ä»¥è®©æ‚¨æ›´å¥½åœ°æ§åˆ¶å…¶è®¾ç½®å’Œåœ°å€èŒƒå›´ã€‚ ç¬¬ 24 å’Œ 25 è¡Œä¸ºæ‚¨çš„ Redis æœåŠ¡å™¨å®šä¹‰äº†ä¸€ä¸ªæŒä¹…å·ã€‚ ä¸Šé¢é…ç½®æ–‡ä»¶ä¸­çš„ä¸€äº›å€¼è¢«å¼•ç”¨ï¼Œè€Œå¦ä¸€äº›åˆ™æ²¡æœ‰ã€‚è¿™æ˜¯é’ˆå¯¹æ—§ YAML æ ¼å¼è§„èŒƒä¸­å·²çŸ¥æ€ªç™–çš„é¢„é˜²æªæ–½ï¼Œè¯¥è§„èŒƒå°†æŸäº›å­—ç¬¦è§†ä¸ºç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚æœå®ƒä»¬å‡ºç°åœ¨æœªåŠ å¼•å·çš„å­—ç¬¦ä¸²ä¸­ã€‚ä¾‹å¦‚ï¼Œå†’å· ( : ) å¯ä»¥ä½¿ä¸€äº› YAML è§£æå™¨å°†æ–‡å­—è§£é‡Šä¸ºå…­åè¿›åˆ¶æ•°å­—è€Œä¸æ˜¯å­—ç¬¦ä¸²ã€‚\næ³¨æ„ï¼šæ­¤æ–‡ä»¶ç¬¦åˆæœ€æ–°å’Œæ¨èçš„ Compose è§„èŒƒï¼Œè¯¥è§„èŒƒä¸å†éœ€è¦é¡¶çº§ version å­—æ®µï¼Œè€Œæ—©æœŸçš„æ¨¡å¼ç‰ˆæœ¬éœ€è¦ã€‚é˜…è¯»å®˜æ–¹æ–‡æ¡£ä¸­çš„ Compose æ–‡ä»¶ç‰ˆæœ¬æ§åˆ¶ä»¥äº†è§£æ›´å¤šä¿¡æ¯ã€‚\nåœæ­¢ä»»ä½•å¯èƒ½ä»åœ¨è¿è¡Œçš„ä¸æ‚¨çš„é¡¹ç›®ç›¸å…³çš„ Docker å®¹å™¨ï¼Œå¹¶ç«‹å³åˆ é™¤å®ƒä»¬çš„å…³è”èµ„æºï¼š\n$ docker stop -t 0 web-service redis-service $ docker container rm web-service redis-service $ docker network rm page-tracker-network $ docker volume rm redis-volume è¿™å°†åˆ é™¤æ‚¨ä¹‹å‰åˆ›å»ºçš„ä¸¤ä¸ªå®¹å™¨ã€ä¸€ä¸ªç½‘ç»œå’Œä¸€ä¸ªå·ã€‚è¯·æ³¨æ„ï¼Œæ‚¨å¯ä»¥å°† docker container rm å‘½ä»¤ç¼©å†™ä¸ºæ›´çŸ­çš„ docker rm åˆ«åã€‚\nè¦ä¼˜é›…åœ°åˆ é™¤å®¹å™¨ï¼Œæ‚¨åº”è¯¥é¦–å…ˆåœæ­¢å®ƒã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ docker stop å‘½ä»¤å°†åœ¨ç»ˆæ­¢å®¹å™¨ä¹‹å‰ç­‰å¾…åç§’é’Ÿï¼Œä½¿å…¶æœ‰è¶³å¤Ÿçš„æ—¶é—´åœ¨é€€å‡ºä¹‹å‰æ‰§è¡Œä»»ä½•å¿…è¦çš„æ¸…ç†æ“ä½œã€‚å› ä¸ºæ‚¨çš„ Flask åº”ç”¨ç¨‹åºåœ¨åœæ­¢è¿è¡Œåä¸éœ€è¦åšä»»ä½•äº‹æƒ…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ -t é€‰é¡¹å°†æ­¤è¶…æ—¶è®¾ç½®ä¸ºé›¶ç§’ï¼Œè¿™å°†ç«‹å³ç»ˆæ­¢åˆ—å‡ºçš„å®¹å™¨ã€‚\nè¦åˆ é™¤æ‰€æœ‰å…³è”çš„ Docker é•œåƒæ ‡ç­¾ï¼Œæ‚¨å¿…é¡»é¦–å…ˆæ‰¾åˆ°å®ƒä»¬çš„å…¬å…±æ ‡è¯†ç¬¦ï¼š\n$ docker images REPOSITORY TAG IMAGE ID CREATED SIZE page-tracker dde1dc9 9cb2e3233522 1 hour ago 204MB page-tracker latest 9cb2e3233522 1 hour ago 204MB realpython/page-tracker dde1dc9 9cb2e3233522 1 hour ago 204MB realpython/page-tracker latest 9cb2e3233522 1 hour ago 204MB (...) åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ page-tracker é•œåƒçš„æ‰€æœ‰æ ‡ç­¾å…±æœ‰çš„çŸ­ ID ç­‰äº 9cb2e3233522 ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥å–æ¶ˆæ ‡è®°å’Œåˆ é™¤åº•å±‚ Docker é•œåƒï¼š\n$ docker rmi -f 9cb2e3233522 Untagged: page-tracker:dde1dc9 Untagged: page-tracker:latest Untagged: realpython/page-tracker:dde1dc9 Untagged: realpython/page-tracker:latest Deleted: sha256:9cb2e3233522e020c366880867980232d747c4c99a1f60a61b9bece40... docker rmi å‘½ä»¤æ˜¯ docker image rm å’Œ docker image remove çš„åˆ«åã€‚\næ³¨æ„ï¼šå¦‚æœä½ æƒ³ä»å¤´å¼€å§‹ä½¿ç”¨å…¨æ–°çš„ Docker ç¯å¢ƒï¼Œå¹¶ä¸”ä¸ä»‹æ„ä¸¢å¤±æ•°æ®ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¿®å‰ªæ‰€æœ‰ç³»ç»Ÿèµ„æºï¼š\n$ docker system prune --all --volumes è­¦å‘Šï¼è¿™å°†åˆ é™¤æ‚¨åˆ°ç›®å‰ä¸ºæ­¢ä½¿ç”¨ Docker åˆ›å»ºçš„æ‰€æœ‰å†…å®¹ï¼ŒåŒ…æ‹¬å¯èƒ½åœ¨æœ¬æ•™ç¨‹ä¹‹å¤–åˆ›å»ºçš„èµ„æºï¼Œå› æ­¤è¯·è°¨æ…æ“ä½œã€‚\nç¡®è®¤åˆ é™¤ Docker èµ„æºåï¼Œæ‚¨å¯ä»¥é€šè¿‡ä¸€æ¡æŒ‡ä»¤ç«‹å³æ¢å¤æ‚¨çš„é¡µé¢è·Ÿè¸ªå™¨åº”ç”¨ç¨‹åºã€‚åœ¨ä¸ docker-comopse.yml æ–‡ä»¶ç›¸åŒçš„æ–‡ä»¶å¤¹ä¸­å‘å‡ºä»¥ä¸‹å‘½ä»¤ä»¥é¿å…æŒ‡å®šå…¶è·¯å¾„ï¼š\n$ docker compose up -d (...) [+] Running 4/4 â ¿ Network page-tracker_backend-network Created 0.1s â ¿ Volume \u0026#34;page-tracker_redis-volume\u0026#34; Created 0.0s â ¿ Container page-tracker-redis-service-1 Started 1.0s â ¿ Container page-tracker-web-service-1 Started 1.3s ç¬¬ä¸€æ¬¡è¿è¡Œæ­¤å‘½ä»¤æ—¶ï¼Œå¯èƒ½éœ€è¦æ›´é•¿çš„æ—¶é—´ï¼Œå› ä¸º Docker Compose å¿…é¡»ä» Docker Hub ä¸‹è½½ Redis é•œåƒå¹¶å†æ¬¡ä» Dockerfile æ„å»ºå¦ä¸€ä¸ªé•œåƒã€‚ä½†åœ¨é‚£ä¹‹åï¼Œå®ƒåº”è¯¥æ„Ÿè§‰å‡ ä¹æ˜¯ç¬é—´çš„ã€‚\næ‚¨å¯ä»¥åœ¨ä¸Šé¢çš„è¾“å‡ºä¸­çœ‹åˆ° Docker Compose åˆ›å»ºäº†è¯·æ±‚çš„ç½‘ç»œã€å·å’Œä¸¤ä¸ªå®¹å™¨ã€‚è¯·æ³¨æ„ï¼Œå®ƒå§‹ç»ˆåœ¨æ­¤ç±»èµ„æºåç§°å‰åŠ ä¸Šæ‚¨çš„ Docker Compose é¡¹ç›®åç§°å‰ç¼€ï¼Œè¯¥åç§°é»˜è®¤ä¸ºåŒ…å«æ‚¨çš„ docker-compose.yml æ–‡ä»¶çš„æ–‡ä»¶å¤¹åç§°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé¡¹ç›®åç§°æ˜¯ page-tracker ã€‚æ­¤åŠŸèƒ½æœ‰åŠ©äºé˜²æ­¢ä¸åŒ Docker Compose é¡¹ç›®çš„èµ„æºåç§°å‘ç”Ÿå†²çªã€‚\næ­¤å¤–ï¼Œå¦‚æœæ‚¨æƒ³å¯åŠ¨åŒä¸€æœåŠ¡çš„å¤šä¸ªå‰¯æœ¬ï¼ŒDocker Compose ä¼šå°†è¿ç»­çš„æ•°å­—é™„åŠ åˆ°æ‚¨çš„å®¹å™¨åç§°ä¸­ã€‚\nDocker Compose æ’ä»¶æä¾›äº†å‡ ä¸ªæœ‰ç”¨çš„å‘½ä»¤æ¥ç®¡ç†æ‚¨çš„å¤šå®¹å™¨åº”ç”¨ç¨‹åºã€‚è¿™é‡Œåªæ˜¯å…¶ä¸­çš„å‡ ä¸ªï¼š\n$ docker compose ps NAME COMMAND SERVICE ... page-tracker-redis-service-1 \u0026#34;docker-entrypoint.sâ€¦\u0026#34; redis-service ... page-tracker-web-service-1 \u0026#34;flask --app page_trâ€¦\u0026#34; web-service ... $ docker compose logs --follow (...) page-tracker-web-service-1 | * Running on all addresses (0.0.0.0) page-tracker-web-service-1 | * Running on http://127.0.0.1:5000 page-tracker-web-service-1 | * Running on http://172.20.0.3:5000 page-tracker-web-service-1 | Press CTRL+C to quit $ docker compose stop [+] Running 2/2 â ¿ Container page-tracker-web-service-1 Stopped 10.3s â ¿ Container page-tracker-redis-service-1 Stopped 0.4s $ docker compose restart [+] Running 2/2 â ¿ Container page-tracker-redis-service-1 Started 0.4s â ¿ Container page-tracker-web-service-1 Started 0.5s $ docker compose down --volumes [+] Running 4/4 â ¿ Container page-tracker-web-service-1 Removed 6.0s â ¿ Container page-tracker-redis-service-1 Removed 0.4s â ¿ Volume page-tracker_redis-volume Removed 0.0s â ¿ Network page-tracker_backend-network Removed 0.1s ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åˆ—å‡º Docker Compose é¡¹ç›®ä¸­çš„å®¹å™¨è€Œä¸æ˜¾ç¤ºä»»ä½•å…¶ä»–å®¹å™¨ã€‚ä½¿ç”¨ç›¸å…³å‘½ä»¤ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å®ƒä»¬çš„å®æ—¶è¾“å‡ºã€åœæ­¢ã€å¯åŠ¨å’Œé‡æ–°å¯åŠ¨å®ƒä»¬ã€‚\nå®Œæˆé¡¹ç›®åï¼Œæ‚¨å¯ä»¥å°†å…¶æ‹†é™¤ï¼ŒDocker Compose å°†åˆ é™¤å…³è”çš„å®¹å™¨å’Œç½‘ç»œã€‚ä½†æ˜¯ï¼Œå®ƒä¸ä¼šè§¦åŠæŒä¹…æ•°æ®å­˜å‚¨ï¼Œé™¤éæ‚¨ä½¿ç”¨ --volumes æ ‡å¿—æ˜ç¡®è¯·æ±‚ã€‚\næ‚¨å¯èƒ½å·²ç»åœ¨æ—¥å¿—ä¸­æ³¨æ„åˆ°ä¸€ä»¶äº‹ï¼ŒFlask å·²ç»æŠ±æ€¨äº†å¾ˆé•¿æ—¶é—´ï¼Œé‚£å°±æ˜¯ä½¿ç”¨å…¶ä¸å®‰å…¨ã€ä½æ•ˆä¸”ä¸ç¨³å®šçš„å¼€å‘ Web æœåŠ¡å™¨æ¥è¿è¡Œæ‚¨çš„åº”ç”¨ç¨‹åºã€‚æ‚¨ç°åœ¨å°†ä½¿ç”¨ Docker Compose æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\nå°† Flask çš„å¼€å‘ Web æœåŠ¡å™¨æ›¿æ¢ä¸º Gunicorn Docker å…è®¸æ‚¨åœ¨è¿è¡Œæ–°å®¹å™¨æ—¶è¦†ç›– Dockerfile ä¸­åˆ—å‡ºçš„é»˜è®¤å‘½ä»¤æˆ–å…¥å£ç‚¹ã€‚ä¾‹å¦‚ï¼Œ redis é•œåƒä¸­çš„é»˜è®¤å‘½ä»¤å¯åŠ¨ Redis æœåŠ¡å™¨ã€‚ä½†æ˜¯ï¼Œæ‚¨ä¹‹å‰ä½¿ç”¨ç›¸åŒçš„é•œåƒåœ¨å¦ä¸€ä¸ªå®¹å™¨ä¸­å¯åŠ¨ redis-cli ã€‚åŒæ ·ï¼Œæ‚¨å¯ä»¥åœ¨ docker-compose.yml æ–‡ä»¶ä¸­ä¸ºæ‚¨çš„ Docker é•œåƒæŒ‡å®šè‡ªå®šä¹‰å‘½ä»¤ã€‚æ‚¨å°†ä½¿ç”¨æ­¤åŠŸèƒ½é€šè¿‡ç”Ÿäº§çº§ Web æœåŠ¡å™¨è¿è¡Œ Flaskã€‚\næ³¨æ„ï¼šæœ‰æ—¶ï¼Œæ‚¨æƒ³è¦è°ƒæŸ¥ç°æœ‰å®¹å™¨ã€‚è¦åœ¨æ­£åœ¨è¿è¡Œçš„å®¹å™¨ä¸­è¿è¡Œå‘½ä»¤è€Œä¸æ˜¯å¯åŠ¨æ–°å®¹å™¨ï¼Œå¯ä»¥ä½¿ç”¨ docker exec å‘½ä»¤ï¼š\n$ docker exec -it -u root page-tracker-web-service-1 /bin/bash root@6e23f154a5b9:/home/realpython# é€šè¿‡è¿è¡Œ Bash å¯æ‰§è¡Œæ–‡ä»¶ /bin/bash å¹¶ä½¿ç”¨ -u é€‰é¡¹æŒ‡å®šç”¨æˆ·ï¼Œæ‚¨å¯ä»¥æœ‰æ•ˆåœ°è®¿é—®å®¹å™¨ï¼Œå°±åƒé€šè¿‡ SSH ç™»å½•è¿œç¨‹æœåŠ¡å™¨ä¸€æ ·ã€‚ -it æ ‡å¿—æ˜¯è¿è¡Œäº¤äº’å¼ç»ˆç«¯ä¼šè¯æ‰€å¿…éœ€çš„ã€‚å¦åˆ™ï¼Œè¯¥å‘½ä»¤å°†ç«‹å³é€€å‡ºã€‚\næœ‰å‡ ä¸ªé€‰é¡¹å¯ä»¥æ›¿æ¢ Flask çš„å†…ç½®å¼€å‘ Web æœåŠ¡å™¨ï¼Œå®˜æ–¹æ–‡æ¡£åœ¨éƒ¨ç½²åˆ°ç”Ÿäº§æ—¶æ¨èä½¿ç”¨è¿™äº›é€‰é¡¹ã€‚æœ€å—æ¬¢è¿çš„é€‰æ‹©ä¹‹ä¸€æ˜¯ Gunicorn (Green Unicorn)ï¼Œå®ƒæ˜¯ Web æœåŠ¡å™¨ç½‘å…³æ¥å£ (WSGI) åè®®çš„çº¯ Python å®ç°ã€‚è¦å¼€å§‹ä½¿ç”¨å®ƒï¼Œæ‚¨å¿…é¡»å°† gunicorn åŒ…æ·»åŠ ä¸ºé¡¹ç›®ä¸­çš„å¦ä¸€ä¸ªä¾èµ–é¡¹ï¼š\n# web/pyproject.toml [build-system] requires = [\u0026#34;setuptools\u0026gt;=67.0.0\u0026#34;, \u0026#34;wheel\u0026#34;] build-backend = \u0026#34;setuptools.build_meta\u0026#34; [project] name = \u0026#34;page-tracker\u0026#34; version = \u0026#34;1.0.0\u0026#34; dependencies = [ \u0026#34;Flask\u0026#34;, \u0026#34;gunicorn\u0026#34;, \u0026#34;redis\u0026#34;, ] [project.optional-dependencies] dev = [ \u0026#34;bandit\u0026#34;, \u0026#34;black\u0026#34;, \u0026#34;flake8\u0026#34;, \u0026#34;isort\u0026#34;, \u0026#34;pylint\u0026#34;, \u0026#34;pytest\u0026#34;, \u0026#34;pytest-timeout\u0026#34;, \u0026#34;requests\u0026#34;, ] è¯·æ³¨æ„ï¼Œæ‚¨å°† gunicorn æ·»åŠ åˆ°å¸¸è§„ä¾èµ–é¡¹åˆ—è¡¨ä¸­ï¼Œå› ä¸ºå®ƒå°†æˆä¸ºæ‚¨åº”ç”¨ç¨‹åºä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ã€‚æ‚¨å¸Œæœ›åœ¨æ„å»ºæœ€ç»ˆ Docker é•œåƒåå®ƒå¯ç”¨ã€‚\nåƒå¾€å¸¸ä¸€æ ·ï¼Œåœ¨æœ¬åœ°é‡æ–°å®‰è£…æ‚¨çš„ page-tracker åŒ…å¹¶å°†å…¶ä¾èµ–é¡¹å›ºå®šåœ¨çº¦æŸæ–‡ä»¶ä¸­ã€‚è¯·è®°ä½ï¼Œæ‚¨å¯èƒ½éœ€è¦å…ˆæ¿€æ´»æ‚¨çš„è™šæ‹Ÿç¯å¢ƒï¼Œå› ä¸ºæ‚¨ä¹‹å‰åœ¨ web/ å­æ–‡ä»¶å¤¹ä¸­é‡æ–°åˆ›å»ºäº†å®ƒï¼š\n(page-tracker) $ python -m pip install --editable \u0026#34;web/[dev]\u0026#34; (page-tracker) $ python -m pip freeze --exclude-editable \u0026gt; web/constraints.txt è¯·æ³¨æ„ï¼Œå½“æ‚¨ä»é¡¹ç›®çš„æ ¹æ–‡ä»¶å¤¹ä¸­æ‰§è¡Œè¿™äº›å‘½ä»¤æ—¶ï¼Œå®ƒä»¬çœ‹èµ·æ¥ä¼šç•¥æœ‰ä¸åŒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¿…é¡»å°†æŒ‡ç¤ºå½“å‰å·¥ä½œç›®å½•çš„ç‚¹ ( . ) æ›¿æ¢ä¸ºæ‚¨çš„ web/ å­æ–‡ä»¶å¤¹çš„è·¯å¾„ã€‚\nç°åœ¨æ‚¨å·²ç»å®‰è£…äº† Gunicornï¼Œæ‚¨å¯ä»¥å¼€å§‹ä½¿ç”¨å®ƒäº†ã€‚é€šè¿‡åœ¨ web-service é”®ä¸‹æ·»åŠ æ–°çš„ command å±æ€§æ¥ä¿®æ”¹ docker-compose.yml ï¼š\n# docker-compose.yml services: redis-service: image: \u0026#34;redis:7.0.10-bullseye\u0026#34; networks: - backend-network volumes: - \u0026#34;redis-volume:/data\u0026#34; web-service: build: ./web ports: - \u0026#34;80:8000\u0026#34; environment: REDIS_URL: \u0026#34;redis://redis-service:6379\u0026#34; networks: - backend-network depends_on: - redis-service command: \u0026#34;gunicorn page_tracker.app:app --bind 0.0.0.0:8000\u0026#34; networks: backend-network: volumes: redis-volume: æ­¤å‘½ä»¤å°†ä¼˜å…ˆäº Dockerfile çš„é»˜è®¤å‘½ä»¤ï¼Œåè€…ä¾èµ–äº Flask çš„å¼€å‘æœåŠ¡å™¨ã€‚ä»ç°åœ¨å¼€å§‹ï¼ŒDocker Compose å°†æ”¹ä¸ºä½¿ç”¨ Gunicorn è¿è¡Œæ‚¨çš„ Web åº”ç”¨ç¨‹åºã€‚ä¸ºäº†æ˜¾ç¤ºå·®å¼‚ï¼Œæ‚¨å°†åœ¨ç«¯å£ 8000 è€Œä¸æ˜¯ 5000 ä¸Šè¿è¡ŒæœåŠ¡å™¨ï¼Œå› æ­¤æ‚¨è¿˜æ›´æ”¹äº†ç«¯å£æ˜ å°„ã€‚\né€šè¿‡åœ¨ä¸»æœºä¸Šå…¬å¼€ç«¯å£ 80 ï¼Œæ‚¨ä»ç„¶å¯ä»¥åœ¨ä¸æŒ‡å®šç«¯å£å·çš„æƒ…å†µä¸‹è®¿é—® http://localhost ä¸Šçš„åº”ç”¨ç¨‹åºã€‚\nä¸è¦å¿˜è®°æäº¤æ›´æ”¹ä»¥å°†æ‚¨çš„å·¥ä½œä¿å­˜åœ¨æœ¬åœ° Git å­˜å‚¨åº“ä¸­ï¼š\n$ git add . $ git commit -m \u0026#34;Refactor folders and add Docker Compose\u0026#34; è¿›è¡Œå°è€Œé¢‘ç¹çš„æäº¤æ€»æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥éšç€æ—¶é—´çš„æ¨ç§»è·Ÿè¸ªå¢é‡æ›´æ”¹å¹¶æ›´å¥½åœ°äº†è§£æ‚¨çš„å·¥ä½œå†å²ã€‚å¦‚æœæ‚¨ä¸ç¡®å®šå¦‚ä½•æè¿°æ‚¨çš„æäº¤ï¼Œè¯·å°è¯•è§£é‡Šä¸ºä»€ä¹ˆæ‚¨è¿›è¡Œäº†ç‰¹å®šæ›´æ”¹ï¼Œå› ä¸º Git å·²ç»è·Ÿè¸ªæ›´æ”¹çš„å†…å®¹ã€‚\nå¥½çš„ã€‚å¦‚æœæ‚¨ç°åœ¨å°è¯•é‡æ–°å¯åŠ¨ Docker Compose åº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆå®ƒå°†å¤±è´¥ï¼Œå› ä¸º Docker åœ¨å®¹å™¨å¯åŠ¨æœŸé—´æ‰¾ä¸åˆ°è¯·æ±‚çš„ gunicorn å¯æ‰§è¡Œæ–‡ä»¶ã€‚æ‚¨å·²ç»æ·»åŠ äº†æ‚¨ä¹‹å‰æ„å»ºçš„ Docker é•œåƒä¸­ç¼ºå°‘çš„é¢å¤–ä¾èµ–é¡¹ã€‚å› æ­¤ï¼Œä½ å¿…é¡»å‘Šè¯‰ Docker Compose é‡å»ºä½ çš„é•œåƒã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»»ä¸€å‘½ä»¤æ‰§è¡Œæ­¤æ“ä½œï¼š\ndocker compose build docker compose up \u0026ndash;build åœ¨ç¬¬ä¸€ç§æƒ…å†µä¸‹ï¼Œæ‚¨ä¼šæ˜ç¡®å‘Šè¯‰ Docker é¢„å…ˆæ„å»ºé•œåƒã€‚æ¯å½“æ‚¨æ›´æ”¹é¡¹ç›®ä¾èµ–é¡¹æˆ– Dockerfile æ—¶ï¼Œæ‚¨éƒ½å¿…é¡»å†æ¬¡è¿è¡Œ docker compose build ä»¥åº”ç”¨è¿™äº›æ›´æ”¹ã€‚\nåœ¨ç¬¬äºŒç§æƒ…å†µä¸‹ï¼Œ docker compose up --build å°†æŒ‡ç¤º Docker åœ¨æ¯æ¬¡å¯åŠ¨å®¹å™¨æ—¶å³æ—¶æ„å»ºé•œåƒã€‚å¦‚æœæ‚¨è¯•å›¾å¿«é€Ÿè¿­ä»£å¯¹æºä»£ç æˆ– Dockerfile çš„æ›´æ”¹ï¼Œè¿™å°†ç‰¹åˆ«æœ‰ç”¨ã€‚\næ— è®ºå“ªç§æ–¹å¼ï¼Œè¿™ä¸¤ä¸ªå‘½ä»¤éƒ½åº”è¯¥åœ¨å¯åŠ¨ç›¸åº”å®¹å™¨ä¹‹å‰åœ¨ä»»ä½•å—å½±å“çš„ Docker é•œåƒä¸­æˆåŠŸæ„å»ºä¿®æ”¹åçš„å±‚ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥æ”¾å¿ƒï¼Œå½“æ‚¨çš„ Docker Compose åº”ç”¨ç¨‹åºå†æ¬¡å¯åŠ¨æ—¶ï¼Œæ‰€æœ‰ä¾èµ–é¡¹éƒ½å°†å¯ç”¨ã€‚\nç»§ç»­å¹¶ç«‹å³è¿è¡Œè¿™äº›å‘½ä»¤ä¹‹ä¸€ã€‚\nå› ä¸ºæ‚¨äº†è§£å¦‚ä½•ä½¿ç”¨ Docker Compose æ¥ç®¡ç†åº”ç”¨ç¨‹åºçš„æœåŠ¡ï¼Œæ‰€ä»¥æ‚¨ç°åœ¨å¯ä»¥äº†è§£å¦‚ä½•åœ¨æ¥è¿‘ç”Ÿäº§çš„ç¯å¢ƒä¸­è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•ã€‚\né’ˆå¯¹æœåŠ¡è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯• åœ¨ç¬¬ä¸€æ¬¡å°è¯•ä¸­ï¼Œæ‚¨å°†ä»ä¸»æœºæœ¬åœ°æ‰§è¡Œç«¯åˆ°ç«¯æµ‹è¯•ã€‚è¯·æ³¨æ„ï¼Œå¿…é¡»å¯ä»¥ä»æ‚¨çš„æœ¬åœ°ç½‘ç»œè®¿é—®æ‰€æœ‰å¿…è¦çš„æœåŠ¡æ‰èƒ½ä½¿å…¶æ­£å¸¸å·¥ä½œã€‚\nè™½ç„¶è¿™å¹¶ä¸ç†æƒ³ï¼Œå› ä¸ºæ‚¨ä¸æƒ³å‘å…¬ä¼—å…¬å¼€ä»»ä½•æ•æ„ŸæœåŠ¡ï¼ˆå¦‚æ•°æ®åº“ï¼‰ï¼Œä½†ç¨åæ‚¨å°†äº†è§£æ›´å¥½çš„æ–¹æ³•ã€‚åŒæ—¶ï¼Œæ‚¨å¯ä»¥æ›´æ–°æ‚¨çš„ docker-compose.yml é…ç½®ä»¥è½¬å‘ Redis ç«¯å£ï¼š\n# docker-compose.yml services: redis-service: image: \u0026#34;redis:7.0.10-bullseye\u0026#34; ports: - \u0026#34;6379:6379\u0026#34; networks: - backend-network volumes: - \u0026#34;redis-volume:/data\u0026#34; web-service: build: ./web ports: - \u0026#34;80:8000\u0026#34; environment: REDIS_URL: \u0026#34;redis://redis-service:6379\u0026#34; networks: - backend-network depends_on: - redis-service command: \u0026#34;gunicorn page_tracker.app:app --bind 0.0.0.0:8000\u0026#34; networks: backend-network: volumes: redis-volume: å¦‚æœæ‚¨æœ‰ä¸€ä¸ªç”¨äº redis-service çš„ç°æœ‰ Docker å®¹å™¨ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦å…ˆåˆ é™¤è¯¥å®¹å™¨ï¼Œå³ä½¿å®ƒå½“å‰å·²åœæ­¢ï¼Œä»¥åæ˜ æ–°çš„ç«¯å£è½¬å‘è§„åˆ™ã€‚å¹¸è¿çš„æ˜¯ï¼ŒDocker Compose ä¼šè‡ªåŠ¨æ£€æµ‹ docker-compose.yml æ–‡ä»¶ä¸­çš„æ›´æ”¹ï¼Œå¹¶åœ¨æ‚¨å‘å‡º docker compose up å‘½ä»¤æ—¶æ ¹æ®éœ€è¦é‡æ–°åˆ›å»ºå®¹å™¨ï¼š\n$ docker compose up -d [+] Running 2/2 â ¿ Container page-tracker-redis-service-1 Started 1.0s â ¿ Container page-tracker-web-service-1 Started 1.2s $ docker compose ps NAME ... PORTS page-tracker-redis-service-1 ... 0.0.0.0:6379-\u0026gt;6379/tcp page-tracker-web-service-1 ... 0.0.0.0:80-\u0026gt;8000/tcp åˆ—å‡ºæ–°å®¹å™¨åï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ° Redis å®¹å™¨ä¸Šçš„ç«¯å£ 6379 è¢«è½¬å‘åˆ°ä¸»æœºã€‚æœ‰äº†è¿™ä¸ªï¼Œæ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨å®‰è£…åœ¨å¼€å‘æœºå™¨ä¸Šçš„è™šæ‹Ÿç¯å¢ƒä¸­çš„ pytest è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•ï¼š\n(page-tracker) $ python -m pytest web/test/e2e/ \\ --flask-url http://localhost \\ --redis-url redis://localhost:6379 ç”±äºç«¯å£æ˜ å°„ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ localhost è¿æ¥åˆ°å®¹å™¨ï¼Œè€Œæ— éœ€çŸ¥é“å®ƒä»¬å„è‡ªçš„ IP åœ°å€ã€‚\næ³¨æ„ï¼šå¦‚æœæ‚¨çš„æµ‹è¯•æˆåŠŸï¼Œé‚£ä¹ˆå®ƒå°†è¦†ç›– Redis ä¸­çš„é¡µé¢æµè§ˆé‡ã€‚æ ¹æ®ç»éªŒï¼Œæ‚¨æ°¸è¿œä¸åº”è¯¥åœ¨å¸¦æœ‰å®¢æˆ·æ•°æ®çš„å®æ—¶ç¯å¢ƒä¸­è¿è¡Œæµ‹è¯•ï¼Œä»¥é¿å…ç ´åå®ƒã€‚é€šå¸¸å»ºè®®ä½¿ç”¨å¸¦æœ‰è™šå‡æˆ–åŒ¿åæ•°æ®çš„æš‚å­˜æˆ–è®¤è¯ç¯å¢ƒæ¥å®‰å…¨åœ°æ‰§è¡Œå…¨é¢çš„ç«¯åˆ°ç«¯æµ‹è¯•ã€‚\nè¦æ¨¡æ‹Ÿæ•…éšœï¼Œæ‚¨å¯ä»¥åœ¨æµ‹è¯•æ‰§è¡ŒæœŸé—´æš‚æ—¶æš‚åœå®¹å™¨ï¼š\n$ docker compose pause [+] Running 2/0 â ¿ Container page-tracker-web-service-1 Paused 0.0s â ¿ Container page-tracker-redis-service-1 Paused 0.0s è¿™å°†ä½¿ Redis å’Œæ‚¨çš„ Flask åº”ç”¨ç¨‹åºæ— æ³•å†è®¿é—®ã€‚ä¸åœæ­¢å®¹å™¨ä¸åŒï¼Œæš‚åœå®ƒä¸ä¼šç»ˆæ­¢åº•å±‚è¿›ç¨‹ï¼Œå› æ­¤æš‚åœä¼šä¿æŒå®¹å™¨çš„çŠ¶æ€å¹¶å¯¼è‡´æ›´å¿«çš„æ¢å¤ã€‚\nä¹‹åä¸è¦å¿˜è®°å–æ¶ˆæš‚åœå®¹å™¨ä»¥é¿å…ä»¥åå‡ºç°é”™è¯¯ï¼š\n$ docker compose unpause [+] Running 2/0 â ¿ Container page-tracker-web-service-1 Unpaused 0.0s â ¿ Container page-tracker-redis-service-1 Unpaused 0.0s æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä»åŒä¸€ç½‘ç»œä¸Šçš„å¦ä¸€ä¸ªå®¹å™¨è¿è¡Œå®ƒï¼Œè€Œä¸æ˜¯åœ¨æœ¬åœ°é’ˆå¯¹å…¬å¼€æœåŠ¡è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•ã€‚æ‚¨å¯ä»¥æ‰‹åŠ¨åˆ¶ä½œè¿™æ ·çš„å®¹å™¨ã€‚\nç„¶è€Œï¼Œæœ€è¿‘ç‰ˆæœ¬çš„ Docker Compose æä¾›äº†ä¸€ä¸ªæ›´ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒå…è®¸æ‚¨æœ‰æ¡ä»¶åœ°è¿è¡ŒæœåŠ¡çš„å­é›†ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥å°†æ‰€éœ€çš„æœåŠ¡åˆ†é…ç»™å¯æŒ‰éœ€æ¿€æ´»çš„è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ã€‚\né¦–å…ˆï¼Œæ‰“å¼€ä½ çš„ docker-compose.yml æ–‡ä»¶å¹¶ä» Redis ä¸­åˆ é™¤ç«¯å£è½¬å‘ï¼Œå› ä¸ºä½ ä¸æƒ³å†å°†å®ƒæš´éœ²ç»™å¤–ç•Œã€‚ç„¶åï¼ŒåŸºäºæ‚¨çš„æ—§ Dockerfile.dev æ·»åŠ ä¸€ä¸ªæ–°æœåŠ¡ï¼Œå®ƒæ†ç»‘äº†æµ‹è¯•æ¡†æ¶ã€æµ‹è¯•è£…ç½®å’Œæ‚¨çš„æµ‹è¯•ä»£ç ã€‚æ‚¨å°†ä½¿ç”¨ç›¸åº”çš„ Docker é•œåƒæ¥æ‰§è¡Œç«¯åˆ°ç«¯æµ‹è¯•ï¼š\n# docker-compose.yml services: redis-service: image: \u0026#34;redis:7.0.10-bullseye\u0026#34; networks: - backend-network volumes: - \u0026#34;redis-volume:/data\u0026#34; web-service: build: ./web ports: - \u0026#34;80:8000\u0026#34; environment: REDIS_URL: \u0026#34;redis://redis-service:6379\u0026#34; networks: - backend-network depends_on: - redis-service command: \u0026#34;gunicorn page_tracker.app:app --bind 0.0.0.0:8000\u0026#34; test-service: profiles: - testing build: context: ./web dockerfile: Dockerfile.dev environment: REDIS_URL: \u0026#34;redis://redis-service:6379\u0026#34; FLASK_URL: \u0026#34;http://web-service:8000\u0026#34; networks: - backend-network depends_on: - redis-service - web-service command: \u0026gt; sh -c \u0026#39;python -m pytest test/e2e/ -vv --redis-url $$REDIS_URL --flask-url $$FLASK_URL\u0026#39; networks: backend-network: volumes: redis-volume: docker-compose.yml æ–‡ä»¶çš„å¤§éƒ¨åˆ†å†…å®¹ä¿æŒä¸å˜ï¼Œå› æ­¤æ‚¨å¯ä»¥å°†æ³¨æ„åŠ›é›†ä¸­åœ¨çªå‡ºæ˜¾ç¤ºçš„è¡Œä¸Šï¼š\nç¬¬ 22 è¡Œå®šä¹‰äº†æ‚¨çš„æ–°æœåŠ¡å°†å±äºçš„é…ç½®æ–‡ä»¶åˆ—è¡¨ã€‚åªæœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œç§°ä¸º testing ï¼Œæ‚¨å°†å¯ç”¨å®ƒæ¥è¿è¡Œæµ‹è¯•ã€‚\nç¬¬ 24 åˆ° 26 è¡ŒæŒ‡å®šåŒ…å«è¦æ„å»ºçš„ Dockerfile çš„ç›®å½•çš„è·¯å¾„ã€‚ç”±äºè¯¥æ–‡ä»¶æœ‰ä¸€ä¸ªéæ ‡å‡†åç§°ï¼Œæ‚¨éœ€è¦æ˜ç¡®æä¾›å®ƒã€‚\nç¬¬ 27 åˆ° 29 è¡Œå®šä¹‰äº†ä¸¤ä¸ªç¯å¢ƒå˜é‡ï¼Œæ‚¨çš„æµ‹è¯•å°†ä½¿ç”¨å®ƒä»¬è¿æ¥åˆ°åœ¨ Gunicorn æœåŠ¡å™¨åé¢è¿è¡Œçš„ Redis å’Œ Flaskã€‚è¯·æ³¨æ„ï¼Œæ‚¨ä½¿ç”¨ Docker Compose æœåŠ¡åç§°ä½œä¸ºä¸»æœºåã€‚\nç¬¬ 30 å’Œ 31 è¡Œå°†æœåŠ¡è¿æ¥åˆ°ä¸å…¶ä»–ä¸¤ä¸ªæœåŠ¡ç›¸åŒçš„ç½‘ç»œã€‚\nç¬¬ 32 åˆ° 34 è¡Œç¡®ä¿ Redis å’Œ Flask åœ¨ç«¯åˆ°ç«¯æµ‹è¯•ä¹‹å‰å¯åŠ¨ã€‚\nç¬¬ 35 åˆ° 38 è¡Œå®šä¹‰äº†åœ¨æœåŠ¡å¯åŠ¨æ—¶è¿è¡Œçš„å‘½ä»¤ã€‚è¯·æ³¨æ„ï¼Œæ‚¨ä½¿ç”¨ YAML çš„å¤šè¡Œæ–‡å­—æŠ˜å  ( \u0026gt; ) ä»¥æ›´å…·å¯è¯»æ€§çš„æ–¹å¼æ ¼å¼åŒ–é•¿ shell å‘½ä»¤ã€‚\nå› ä¸º Docker Compose å¯ä»¥è®¿é—®æ‚¨ä¸»æœºçš„ shellï¼Œæ‰€ä»¥å®ƒä¼šå°è¯•æ’å…¥å¯¹ç¯å¢ƒå˜é‡çš„ä»»ä½•å¼•ç”¨ï¼Œä¾‹å¦‚ $REDIS_URL æˆ– $FLASK_URL ï¼Œä¸€æ—¦æ–‡ä»¶è¢«è§£æï¼Œå°±ä¼šå‡ºç°åœ¨æ‚¨çš„ docker-compose.yml ä¸­ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™äº›å˜é‡å¾ˆå¯èƒ½å°šæœªå®šä¹‰ã€‚æ‚¨é€šè¿‡æœåŠ¡çš„ environment éƒ¨åˆ†æŒ‡å®šå®ƒä»¬ï¼Œè¿™æ„å‘³ç€æ‚¨çš„å®¹å™¨ç¨åå°†è·å–è¿™äº›å˜é‡ã€‚\nè¦ç¦ç”¨ Docker Compose è¿‡æ—©æ›¿æ¢ç¯å¢ƒå˜é‡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªç¾å…ƒç¬¦å· ( $$ ) è½¬ä¹‰ç¾å…ƒç¬¦å·ã€‚è¿™åè¿‡æ¥ä¼šåœ¨å°†åœ¨ç”Ÿæˆçš„å®¹å™¨ä¸­æ‰§è¡Œçš„å‘½ä»¤ä¸­ç”Ÿæˆæ–‡å­—å­—ç¬¦ä¸² $REDIS_URL å’Œ $FLASK_URL ã€‚è¦åœ¨å®¹å™¨å¯åŠ¨æ—¶æ’å…¥è¿™äº›å˜é‡ï¼Œæ‚¨å¿…é¡»å°†æ•´ä¸ªå‘½ä»¤ç”¨å•å¼•å· ( ' ) æ‹¬èµ·æ¥ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™ shell ( sh )ã€‚\nå½“æ‚¨ä½¿ç”¨ Docker Compose å¯åŠ¨å¤šå®¹å™¨åº”ç”¨ç¨‹åºæ—¶ï¼Œåªæœ‰ä¸å±äºä»»ä½•é…ç½®æ–‡ä»¶çš„æ ¸å¿ƒæœåŠ¡ä¼šå¯åŠ¨ã€‚å¦‚æœæ‚¨è¿˜å¸Œæœ›å¯åŠ¨åˆ†é…ç»™ä¸€ä¸ªæˆ–å¤šä¸ªé…ç½®æ–‡ä»¶çš„æœåŠ¡ï¼Œåˆ™å¿…é¡»ä½¿ç”¨ --profile é€‰é¡¹åˆ—å‡ºè¿™äº›é…ç½®æ–‡ä»¶ï¼š\n$ docker compose --profile testing up -d [+] Running 3/3 â ¿ Container page-tracker-redis-service-1 Running 0.0s â ¿ Container page-tracker-web-service-1 Running 0.0s â ¿ Container page-tracker-test-service-1 Started 0.6s $ docker compose ps -a NAME ... SERVICE STATUS ... page-tracker-redis-service-1 ... redis-service running ... page-tracker-test-service-1 ... test-service exited (0) ... page-tracker-web-service-1 ... web-service running ... è¯·æ³¨æ„ï¼Œè¿™æ˜¯ docker compose å‘½ä»¤çš„ä¸€ä¸ªé€‰é¡¹ï¼Œè€Œä¸æ˜¯å®ƒçš„ up å­å‘½ä»¤ï¼Œå› æ­¤è¯·æ³¨æ„å‚æ•°é¡ºåºã€‚è¾“å‡ºæ˜¾ç¤ºå¯åŠ¨äº†ä¸€ä¸ªé¢å¤–çš„æœåŠ¡ï¼Œä½†æ˜¯å½“æ‚¨è°ƒæŸ¥å®ƒæ—¶ï¼Œæ‚¨ä¼šæ³¨æ„åˆ° test-service ä»¥æˆåŠŸçŠ¶æ€é›¶å¿«é€Ÿé€€å‡ºã€‚\nè¦æ˜¾ç¤ºæœ‰å…³æ­¤æœåŠ¡çš„æ›´å¤šä¿¡æ¯ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å…¶æ—¥å¿—ï¼š\n$ docker compose logs test-service ============================= test session starts ========================== platform linux -- Python 3.11.2, pytest-7.2.2, pluggy-1.0.0 -- /home/realp.. cachedir: .pytest_cache rootdir: /home/realpython plugins: timeout-2.1.0 collecting ... collected 1 item test/e2e/test_app_redis_http.py::test_should_update_redis ... PASSED [100%] ============================== 1 passed in 0.10s =========================== è¿™å°†å‘æ‚¨æ˜¾ç¤ºæœ‰å…³è¯¥æœåŠ¡çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ pytest æŠ¥å‘Šå½¢å¼çš„æµ‹è¯•ç»“æœï¼Œä»¥åŠå¯èƒ½å‘ç”Ÿçš„ä»»ä½•é”™è¯¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæµ‹è¯•æˆåŠŸé€šè¿‡ã€‚è¯·æ³¨æ„ï¼Œä¸ºç®€æ´èµ·è§ï¼Œå¯¹ä¸Šé¢çš„è¾“å‡ºè¿›è¡Œäº†ç¼–è¾‘ã€‚\nåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ‚¨å·²ç»ä½¿ç”¨ Git å¯¹æºä»£ç è¿›è¡Œäº†ç‰ˆæœ¬æ§åˆ¶ã€‚æ‚¨è‡ªåŠ¨åŒ–äº†å„ç§çº§åˆ«çš„æµ‹è¯•å¹¶ä½¿ç”¨ Docker æ„å»ºäº†æ‚¨çš„åº”ç”¨ç¨‹åºã€‚æœ€åï¼Œæ‚¨ä½¿ç”¨ Docker Compose ç¼–æ’äº†å¤šä¸ªå®¹å™¨ã€‚\næ­¤æ—¶ï¼Œæ‚¨å·²å‡†å¤‡å¥½ç»§ç»­ä¸‹ä¸€æ­¥ï¼Œå³ä½¿ç”¨ Docker æ„å»ºæŒç»­é›†æˆç®¡é“ã€‚\nå®šä¹‰ä¸€ä¸ªåŸºäº Docker çš„æŒç»­é›†æˆç®¡é“ æŒç»­é›†æˆ (CI) çš„ç›®æ ‡æ˜¯é€šè¿‡å°½å¯èƒ½é¢‘ç¹åœ°é›†æˆå›¢é˜Ÿä¸­å¤šä¸ªå¼€å‘äººå‘˜çš„ä»£ç æ›´æ”¹æ¥å®ç°æ›´å¿«ã€æ›´å¯é¢„æµ‹çš„è½¯ä»¶å‘å¸ƒã€‚\nåœ¨è¿‡å»ï¼Œé›†æˆæ˜¯ä¸€é¡¹é‡å¤§ä»»åŠ¡ï¼Œé€šå¸¸éœ€è¦æ•°å‘¨ç”šè‡³æ•°æœˆæ‰èƒ½å®Œæˆï¼Œæœ‰æ—¶è¿˜éœ€è¦ä¸“é—¨çš„é›†æˆå·¥ç¨‹å¸ˆå›¢é˜Ÿã€‚\nè¿™ç§æ–¹æ³•çš„é—®é¢˜æ˜¯å›¢é˜Ÿä¸­çš„æ¯ä¸ªäººéƒ½åœ¨è‡ªå·±çš„é¡¹ç›®å‰¯æœ¬ä¸Šå·¥ä½œã€‚é›†æˆé˜¶æ®µå»¶è¿Ÿçš„æ—¶é—´è¶Šé•¿ï¼Œé¡¹ç›®çš„ä¸åŒç‰ˆæœ¬å°±è¶Šæœ‰å¯èƒ½å‡ºç°åˆ†æ­§ï¼Œä»è€Œéš¾ä»¥å°†å®ƒä»¬ç»“åˆèµ·æ¥ã€‚\nåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œé›†æˆå¯èƒ½æ¯”é¡¹ç›®çš„å®é™…å¼€å‘èŠ±è´¹æ›´å¤šçš„æ—¶é—´ï¼\nè¿ç»­è¿™ä¸ªè¯æ„å‘³ç€é›†æˆåº”è¯¥ç»å¸¸è¿›è¡Œï¼Œä»¥æœ€å°åŒ–æ›´æ”¹çš„èŒƒå›´å¹¶é™ä½å°†ç¼ºé™·å¼•å…¥ä»£ç åº“çš„é£é™©ã€‚å›¢é˜Ÿæ¯å¤©è‡³å°‘æ•´åˆä¸€æ¬¡å¼€å‘äººå‘˜çš„å·¥ä½œï¼Œæœ€å¥½æ˜¯ä¸€å¤©å¤šæ¬¡ï¼Œè¿™å·²æˆä¸ºæ ‡å‡†åšæ³•ã€‚\nä¸ºäº†ä½¿è¿™æˆä¸ºå¯èƒ½ï¼ŒæŒç»­é›†æˆéœ€è¦æ„å»ºå’Œæµ‹è¯•è‡ªåŠ¨åŒ–ä»¥åŠå…·æœ‰ç›¸å¯¹è¾ƒå°åŠŸèƒ½çš„çŸ­æœŸä»£ç åˆ†æ”¯æ¥å®ç°ã€‚åŠŸèƒ½åˆ‡æ¢å¯ä»¥å¸®åŠ©å®ç°éœ€è¦æ›´é•¿æ—¶é—´å¼€å‘çš„æ›´å¤§åŠŸèƒ½ã€‚æ­¤å¤–ï¼Œåœ¨å°è¯•é›†æˆæ›´æ”¹å¤±è´¥åä¿®å¤å¤±è´¥çš„æ„å»ºåº”è¯¥æ˜¯å›¢é˜Ÿçš„ä¼˜å…ˆäº‹é¡¹ï¼Œä»¥ä¿æŒæµç¨‹çœŸæ­£è¿ç»­ã€‚\nè¦åœ¨æ‚¨çš„é¡¹ç›®ä¸­å¼•å…¥æŒç»­é›†æˆï¼Œæ‚¨éœ€è¦ä»¥ä¸‹å…ƒç´ ï¼š\nç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ åˆ†æ”¯ç­–ç•¥ è‡ªåŠ¨æ„å»º è‡ªåŠ¨åŒ–æµ‹è¯• æŒç»­é›†æˆæœåŠ¡å™¨ é¢‘ç¹é›†æˆ åƒ Git è¿™æ ·çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿå…è®¸å¤šäººåŒæ—¶å¤„ç†åŒä¸€æ®µä»£ç ã€‚æ ¹æ®æ‚¨çš„å›¢é˜Ÿç»“æ„ã€ç»éªŒå’Œå…¶ä»–å› ç´ ï¼Œæ‚¨å¯ä»¥é€‰æ‹©ä¸åŒçš„æºä»£ç æ§åˆ¶åˆ†æ”¯æ¨¡å‹ï¼Œä¹Ÿç§°ä¸ºå·¥ä½œæµã€‚ä¸€äº›æœ€å—æ¬¢è¿çš„åŒ…æ‹¬ï¼š\nTrunk-Based Development GitHub Flow Forking Workflow Release Branching Git Flow å„æœ‰åˆ©å¼Šï¼Œé€‚ç”¨äºä¸åŒçš„åœºæ™¯ã€‚ä¾‹å¦‚ï¼Œåˆ†å‰ç­–ç•¥åœ¨å¼€æºé¡¹ç›®ä¸­è¿ä½œè‰¯å¥½ï¼Œå› ä¸ºå®ƒå…è®¸ä»»ä½•äººåœ¨æ²¡æœ‰ç‰¹åˆ«è®¸å¯çš„æƒ…å†µä¸‹åšå‡ºè´¡çŒ®ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†ä½¿ç”¨ç§°ä¸º GitHub Flow çš„æµè¡ŒåŠŸèƒ½åˆ†æ”¯å·¥ä½œæµç¨‹ã€‚å®ƒåªæœ‰ä¸€ä¸ªé•¿æœŸå­˜åœ¨çš„ä¸»çº¿æˆ–ä¸»å¹²ï¼Œä¼ ç»Ÿä¸Šç§°ä¸º master åˆ†æ”¯ï¼Œæ‚¨å¯ä»¥ä»ä¸­åˆ†æ”¯å‡ºå‡ ä¸ªçŸ­æœŸå­˜åœ¨çš„åŠŸèƒ½åˆ†æ”¯ã€‚\næ³¨æ„ï¼šå°½ç®¡ä½¿ç”¨æœ¯è¯­ master æ¥æŒ‡ä»£ä¸»åˆ†æ”¯çš„ä¼ ç»Ÿç”±æ¥å·²ä¹…ï¼Œä½† GitHub æœ€è¿‘å®£å¸ƒå°†å…¶é»˜è®¤åˆ†æ”¯åç§°æ›´æ”¹ä¸º main ä»¥æ›´å¥½åœ°åæ˜ å…¶ç›®çš„å¹¶é¿å…å†’çŠ¯æ€§è¯­è¨€ã€‚\nåŒæ—¶ï¼Œå½“æ‚¨åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„å­˜å‚¨åº“æ—¶ï¼ŒGit ä¼šç»§ç»­ä½¿ç”¨ master ï¼Œè¿™åœ¨æ‚¨å°è¯•åŒæ­¥æœ¬åœ°å’Œè¿œç¨‹å­˜å‚¨åº“æ—¶å¶å°”ä¼šå‡ºç°é—®é¢˜ã€‚å› æ­¤ï¼Œæ‚¨å°†åšæŒåœ¨æœ¬æ•™ç¨‹ä¸­ä½¿ç”¨ master æ¥ä¿æŒç®€å•ï¼Œä½†å¦‚æœæ‚¨æƒ³æ›´æ”¹é»˜è®¤åˆ†æ”¯åç§°ï¼Œè¯·éšæ—¶é‡‡å–é¢å¤–çš„æ­¥éª¤ã€‚æ‚¨å¯ä»¥åœ¨ GitHub å­˜å‚¨åº“è®¾ç½®ä¸­è°ƒæ•´é»˜è®¤åˆ†æ”¯åç§°ã€‚\nè™½ç„¶æ‚¨ä¼šå‘ç°å‡ ç§ä¸åŒçš„æ–¹æ³•æ¥å®ç°ä¸ GitHub Flow çš„æŒç»­é›†æˆï¼Œä½†è¿™äº›æ˜¯æ‚¨å°†é’ˆå¯¹ Docker åº”ç”¨ç¨‹åºéµå¾ªçš„æ­¥éª¤ï¼š\nå°†æœ€æ–°ç‰ˆæœ¬çš„ä¸»çº¿è·å–åˆ°æ‚¨çš„è®¡ç®—æœºã€‚ ä»ä¸»çº¿åˆ›å»ºä¸€ä¸ªåŠŸèƒ½åˆ†æ”¯ã€‚ æ‰“å¼€æ‹‰å–è¯·æ±‚ä»¥ä»å…¶ä»–äººé‚£é‡Œè·å¾—æ—©æœŸåé¦ˆã€‚ ç»§ç»­åœ¨ä½ çš„åŠŸèƒ½åˆ†æ”¯ä¸Šå·¥ä½œã€‚ ç»å¸¸è·å–ä¸»çº¿ï¼Œå°†å…¶åˆå¹¶åˆ°æ‚¨çš„åŠŸèƒ½åˆ†æ”¯å¹¶åœ¨æœ¬åœ°è§£å†³ä»»ä½•æ½œåœ¨çš„å†²çªã€‚ åœ¨æœ¬åœ°åˆ†æ”¯ä¸Šæ„å»ºã€lint å’Œæµ‹è¯•ä»£ç ã€‚ åªè¦æœ¬åœ°æ„å»ºå’Œæµ‹è¯•æˆåŠŸï¼Œå°±æ¨é€æ‚¨çš„æ›´æ”¹ã€‚ æ¯æ¬¡æ¨é€æ—¶ï¼Œæ£€æŸ¥é’ˆå¯¹æ‚¨çš„åŠŸèƒ½åˆ†æ”¯åœ¨ CI æœåŠ¡å™¨ä¸Šè¿è¡Œçš„è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚ åœ¨å†æ¬¡æ¨é€ä»£ç ä¹‹å‰ï¼Œåœ¨æœ¬åœ°é‡ç°å¹¶ä¿®å¤ä»»ä½•å·²è¯†åˆ«çš„é—®é¢˜ã€‚ å®Œæˆå¹¶é€šè¿‡æ‰€æœ‰æµ‹è¯•åï¼Œè¯·æ±‚ä¸€åæˆ–å¤šååŒäº‹å®¡æŸ¥æ‚¨çš„æ›´æ”¹ã€‚ åº”ç”¨ä»–ä»¬çš„åé¦ˆï¼Œç›´åˆ°å®¡é˜…è€…æ‰¹å‡†æ‚¨çš„æ›´æ–°å¹¶ä¸”æ‰€æœ‰æµ‹è¯•åœ¨æ¨é€æ‚¨çš„æœ€æ–°æ›´æ”¹åé€šè¿‡ CI æœåŠ¡å™¨ã€‚ é€šè¿‡å°†åŠŸèƒ½åˆ†æ”¯åˆå¹¶åˆ°ä¸»çº¿æ¥å…³é—­æ‹‰å–è¯·æ±‚ã€‚ å¯¹ç…§ä¸»çº¿æ£€æŸ¥ CI æœåŠ¡å™¨ä¸Šè¿è¡Œçš„è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå¹¶é›†æˆåŠŸèƒ½åˆ†æ”¯çš„æ›´æ”¹ã€‚ è°ƒæŸ¥å¹¶ä¿®å¤å¯èƒ½å‘ç°çš„ä»»ä½•é—®é¢˜ï¼Œä¾‹å¦‚ï¼Œç”±äºåœ¨æ‚¨ä¸Šæ¬¡æ¨é€å’Œåˆå¹¶ä¹‹é—´å…¶ä»–äººå‘ä¸»çº¿å¼•å…¥äº†æ–°æ›´æ–°ã€‚ æ­¤åˆ—è¡¨éå¸¸å…¨é¢ï¼Œä½†æ²¡æœ‰é€‚åˆæ‰€æœ‰äººçš„å•ä¸€æŒç»­é›†æˆæµç¨‹ã€‚æ‚¨ç”šè‡³å¯ä»¥æ¯”è¿™æ›´å½»åº•ï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨ Terraform æˆ– GitHub Codespaces æä¾›ä¸“ç”¨çš„æš‚å­˜ç¯å¢ƒï¼Œå¹¶å°†æ‚¨çš„åŠŸèƒ½åˆ†æ”¯éƒ¨ç½²åˆ°äº‘ä¸­ï¼Œä»¥ä¾¿åœ¨å…³é—­æ‹‰å–è¯·æ±‚ä¹‹å‰è¿›è¡Œé¢å¤–çš„æ‰‹åŠ¨æµ‹è¯•ã€‚ä½†æ˜¯ï¼Œä¸ºæ¯ä¸ªæ‹‰å–è¯·æ±‚å¯åŠ¨ä¸€ä¸ªæ–°ç¯å¢ƒå¯èƒ½ä¸ç¬¦åˆæˆæœ¬æ•ˆç›Šã€‚\næ³¨æ„ï¼šè½¯ä»¶å·¥ç¨‹å›¢é˜Ÿé€šå¸¸å°†æŒç»­é›†æˆä¸æŒç»­äº¤ä»˜ç»“åˆèµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªç§°ä¸º CI/CD çš„æµç¨‹ã€‚æŒç»­äº¤ä»˜æ˜¯æŒç»­é›†æˆçš„æ‰©å±•ï¼Œå®ƒå¢åŠ äº†é¢å¤–çš„æ­¥éª¤æ¥å°†ç»è¿‡éªŒè¯å’Œé›†æˆçš„æ„å»ºéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚\nè™½ç„¶æŒç»­äº¤ä»˜æä¾›äº†å°†æ„å»ºè‡ªåŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒçš„æŠ€æœ¯æ‰‹æ®µï¼Œä½†å®ƒä»ç„¶éœ€è¦ä¸šåŠ¡å†³ç­–å’Œæ‰‹åŠ¨è§¦å‘ã€‚\nä¸è¦æ··æ·†æŒç»­äº¤ä»˜å’ŒæŒç»­éƒ¨ç½²ï¼Œåè€…æ˜¯ä¸€ä¸ªå®Œå…¨è‡ªåŠ¨åŒ–çš„è¿‡ç¨‹ï¼Œæ— éœ€äººå·¥å¹²é¢„å³å¯å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚åœ¨æŒç»­éƒ¨ç½²ä¸­ï¼Œä¸€æ—¦ä½ æ¨é€ä»£ç ï¼Œå®ƒå°±ä¼šè¢«æµ‹è¯•å¹¶é›†æˆåˆ°ä¸»çº¿ä¸­ï¼Œç„¶åæœ€ç»ˆè¿›å…¥ç”Ÿäº§ç¯å¢ƒã€‚\nä½†æ˜¯ï¼Œè¦æˆåŠŸåšåˆ°è¿™ä¸€ç‚¹ï¼Œæ‚¨éœ€è¦å¹¿æ³›çš„æµ‹è¯•èŒƒå›´å’Œå¯¹è‡ªåŠ¨åŒ–è¿‡ç¨‹çš„ä¿¡ä»»ã€‚\nå€¼å¾—å¼ºè°ƒçš„é‡è¦ä¸€ç‚¹æ˜¯æ¶‰åŠçš„æµ‹è¯•é‡ã€‚æ‚¨åº”è¯¥åœ¨æœ¬åœ°å’ŒæŒç»­é›†æˆæœåŠ¡å™¨ä¸Šæµ‹è¯•æ‚¨çš„åŠŸèƒ½åˆ†æ”¯ï¼Œç„¶åé’ˆå¯¹é›†æˆä¸»çº¿å†æ¬¡è¿è¡Œæµ‹è¯•ã€‚\nè¿™æ˜¯ä¸ºäº†ç¡®ä¿æ‚¨çš„åŠŸèƒ½æ­£å¸¸å·¥ä½œå¹¶ä¸”ä¸ä¼šç ´åä¸»çº¿ã€‚\næ‚¨æœ‰è®¸å¤šé€‰é¡¹å¯ä»¥ä¸ºæ‚¨çš„ Docker åº”ç”¨ç¨‹åºè®¾ç½®æŒç»­é›†æˆæœåŠ¡å™¨ï¼ŒåŒ…æ‹¬åœ¨çº¿å’Œè‡ªæ‰˜ç®¡ã€‚æµè¡Œçš„é€‰æ‹©åŒ…æ‹¬ CircleCIã€Jenkins å’Œ Travisã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†ä½¿ç”¨ GitHub Actionsï¼Œè¿™æ˜¯ GitHub æä¾›çš„å…è´¹ CI è§£å†³æ–¹æ¡ˆã€‚\nå°†ä»£ç æ¨é€åˆ° GitHub å­˜å‚¨åº“ è¦åˆ©ç”¨ GitHub Actionsï¼Œæ‚¨å¿…é¡»é¦–å…ˆåœ¨ GitHub ä¸Šåˆ›å»ºä¸€ä¸ªå­˜å‚¨åº“ã€‚å¦‚æœæ‚¨è¿˜æ²¡æœ‰å¸æˆ·ï¼Œè¯·æ³¨å†Œï¼Œç„¶åç™»å½•å¹¶åˆ›å»ºä¸€ä¸ªåä¸º page-tracker çš„æ–°å­˜å‚¨åº“ã€‚\nå…¬å…±å­˜å‚¨åº“å¯ä»¥æ— é™åˆ¶åœ°ä½¿ç”¨ GitHub Actionsï¼Œè€Œç§æœ‰å­˜å‚¨åº“æ¯æœˆå¯åœ¨å…è´¹å±‚è·å¾— 2000 åˆ†é’Ÿå’Œ 500 å…†å­—èŠ‚çš„å­˜å‚¨ç©ºé—´ã€‚\nä½†æ˜¯ï¼Œåœ¨ Windows ä¸Šè¿è¡Œçš„ä½œä¸šå°†æ¶ˆè€—æ¯”åœ¨ Linux ä¸Šå¤šä¸€å€çš„åˆ†é’Ÿæ•°ï¼Œè€Œåœ¨ macOS ä¸Šè¿è¡Œçš„ä½œä¸šå°†æ¶ˆè€—åå€çš„åˆ†é’Ÿæ•°ï¼æ‚¨å¯ä»¥åœ¨å®˜æ–¹æ–‡æ¡£ä¸­æ‰¾åˆ°æœ‰å…³ GitHub Actions è®¡è´¹çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚\nç¨åï¼Œæ‚¨å°†å¯ç”¨åˆ†æ”¯ä¿æŠ¤è§„åˆ™ï¼Œè¯¥è§„åˆ™ç›®å‰ä»…é€‚ç”¨äºå…è´¹å±‚çš„å…¬å…±å­˜å‚¨åº“ï¼Œå› æ­¤æœ€å¥½ç°åœ¨å°±åˆ›å»ºä¸€ä¸ªå…¬å…±å­˜å‚¨åº“ã€‚\nä¿ç•™å»ºè®®çš„é»˜è®¤å€¼è€Œä¸ä½¿ç”¨ GitHub çš„å ä½ç¬¦æ–‡ä»¶åˆå§‹åŒ–æ–°å­˜å‚¨åº“ï¼Œå› ä¸ºæ‚¨å°†æ¨é€ç°æœ‰é¡¹ç›®ã€‚æ¥ä¸‹æ¥ï¼Œè½¬åˆ°ç»ˆç«¯å¹¶å°†å·¥ä½œç›®å½•æ›´æ”¹ä¸ºæ‚¨çš„ page-tracker é¡¹ç›®æ‰€åœ¨çš„ä½ç½®ã€‚å®ƒåº”è¯¥å·²ç»åˆå§‹åŒ–äº†ä¸€ä¸ªæœ¬åœ° Git å­˜å‚¨åº“ï¼Œç¨åæ‚¨å°†è¿æ¥åˆ° GitHubã€‚ä½†é¦–å…ˆï¼Œå°†æ‰€æœ‰æœªå†³æ›´æ”¹æäº¤åˆ°æœ¬åœ°å­˜å‚¨åº“ï¼š\n$ git status On branch master Changes not staged for commit: (use \u0026#34;git add \u0026lt;file\u0026gt;...\u0026#34; to update what will be committed) (use \u0026#34;git restore \u0026lt;file\u0026gt;...\u0026#34; to discard changes in working directory) modified: docker-compose.yml no changes added to commit (use \u0026#34;git add\u0026#34; and/or \u0026#34;git commit -a\u0026#34;) $ git commit -am \u0026#34;Add a test-service to Docker Compose\u0026#34; åœ¨æäº¤ä»»ä½•æ›´æ”¹ä¹‹å‰æ£€æŸ¥å­˜å‚¨åº“çš„çŠ¶æ€å§‹ç»ˆæ˜¯ä¸ªå¥½ä¸»æ„ã€‚æ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ä¸ªå‘½ä»¤å°†æœ¬åœ°å­˜å‚¨åº“è¿æ¥åˆ° GitHubï¼š\n$ git remote add origin git@github.com:realpython/page-tracker.git $ git push -u origin master ç¡®ä¿å°† realpython æ›¿æ¢ä¸ºæ‚¨çš„ GitHub ç”¨æˆ·åã€‚ç¬¬ä¸€ä¸ªå‘½ä»¤ä¼šå°†æ‚¨åˆšåˆšåˆ›å»ºçš„ GitHub ä¸Šçš„è¿œç¨‹å­˜å‚¨åº“æ·»åŠ åˆ°æ‚¨åœ¨ origin åˆ«åä¸‹çš„æœ¬åœ°å‰¯æœ¬ã€‚ç¬¬äºŒä¸ªå‘½ä»¤ä¼šå°†æœ¬åœ°å­˜å‚¨åº“çš„å†…å®¹æ¨é€åˆ° GitHubã€‚\nä¹‹åæ‚¨å¯ä»¥ä½¿ç”¨æ‚¨çš„ GitHub å­˜å‚¨åº“åˆ·æ–°ç½‘é¡µä»¥ç¡®è®¤æ‚¨çš„æ–‡ä»¶å·²æˆåŠŸå‘é€ã€‚å½“æ‚¨è¿™æ ·åšæ—¶ï¼Œæ‚¨å°†å‡†å¤‡å¥½ä½¿ç”¨ GitHub Actions ä¸ºæ‚¨çš„ Docker åº”ç”¨ç¨‹åºæ„å»ºæŒç»­é›†æˆå·¥ä½œæµç¨‹ï¼\nå­¦ä¹  GitHub Actions é¦–å…ˆï¼Œç†Ÿæ‚‰ä¸€äº›æ–°æœ¯è¯­ä¼šæœ‰æ‰€å¸®åŠ©ã€‚ GitHub Actions å…è®¸æ‚¨æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªç”±ç‰¹å®šäº‹ä»¶è§¦å‘çš„å·¥ä½œæµç¨‹ï¼Œä¾‹å¦‚å°†ä»£ç æ¨é€åˆ°åˆ†æ”¯æˆ–æ‰“å¼€æ–°çš„æ‹‰å–è¯·æ±‚ã€‚æ¯ä¸ªå·¥ä½œæµéƒ½å¯ä»¥å®šä¹‰è®¸å¤šç”±æ­¥éª¤ç»„æˆçš„ä½œä¸šï¼Œè¿™äº›ä½œä¸šå°†åœ¨è¿è¡Œå™¨ä¸Šæ‰§è¡Œã€‚æœ‰ä¸¤ç§ç±»å‹çš„è·‘æ­¥è€…ï¼š\nGitHub æ‰˜ç®¡çš„è¿è¡Œå™¨ï¼šUbuntu Linuxã€Windowsã€macOS è‡ªæ‰˜ç®¡è¿è¡Œå™¨ï¼šæ‚¨æ‹¥æœ‰å’Œç»´æŠ¤çš„æœ¬åœ°æœåŠ¡å™¨ åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†åªä½¿ç”¨ GitHub æä¾›çš„æœ€æ–° Ubuntu Linux è¿è¡Œå™¨ã€‚è¯·æ³¨æ„ï¼Œå¯ä»¥åœ¨å¤šä¸ªè¿è¡Œå™¨ä¸Šæ‰§è¡Œç›¸åŒçš„ä½œä¸šï¼Œä¾‹å¦‚æ£€æŸ¥è·¨å¹³å°å…¼å®¹æ€§ã€‚\né™¤éæ‚¨å¦æœ‰è¯´æ˜ï¼Œå¦åˆ™ä¸€ä¸ªå·¥ä½œæµç¨‹ä¸­çš„ä½œä¸šå°†åœ¨ä¸åŒçš„è¿è¡Œå™¨ä¸Šå¹¶è¡Œè¿è¡Œï¼Œè¿™å¯¹äºåŠ å¿«æ„å»ºé€Ÿåº¦å¾ˆæœ‰ç”¨ã€‚åŒæ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ä¸€é¡¹å·¥ä½œä¾èµ–äºå…¶ä»–å·¥ä½œã€‚\nä½¿ç”¨ GitHub Actions å‡å°‘æ„å»ºæ—¶é—´çš„å¦ä¸€ç§æ–¹æ³•æ˜¯å¯ç”¨å·¥ä½œæµä¾èµ–ç¼“å­˜ã€‚\nä½œä¸šçš„æ¯ä¸ªæ­¥éª¤éƒ½ç”±ä¸€ä¸ªåŠ¨ä½œå®ç°ï¼Œè¯¥åŠ¨ä½œå¯ä»¥æ˜¯ï¼š\nè‡ªå®šä¹‰ shell å‘½ä»¤æˆ–è„šæœ¬ åœ¨å¦ä¸€ä¸ª GitHub å­˜å‚¨åº“ä¸­å®šä¹‰çš„ GitHub æ“ä½œ æœ‰è®¸å¤šé¢„å®šä¹‰çš„ GitHub æ“ä½œï¼Œæ‚¨å¯ä»¥åœ¨ GitHub Marketplace ä¸Šæµè§ˆå’ŒæŸ¥æ‰¾ã€‚ç¤¾åŒºæä¾›å¹¶ç»´æŠ¤å®ƒä»¬ã€‚ä¾‹å¦‚ï¼Œæœ‰ä¸€ä¸ªç”¨äºåœ¨ GitHub ä¸Šæ„å»ºå’Œæ¨é€ Docker ç»„ç»‡æ‹¥æœ‰çš„ Docker é•œåƒã€‚ç”±äºæœ‰è®¸å¤šç›¸äº’ç«äº‰çš„æ’ä»¶ï¼Œæœ‰æ—¶æœ‰ä¸æ­¢ä¸€ç§æ–¹æ³•å¯ä»¥ä½¿ç”¨ GitHub Actions è¾¾åˆ°é¢„æœŸçš„ç»“æœã€‚\nä¸å¦‚ä»Šä¸ DevOps ç›¸å…³çš„è®¸å¤šå·¥å…·ä¸€æ ·ï¼ŒGitHub ä½¿ç”¨ YAML æ ¼å¼æ¥é…ç½®å·¥ä½œæµã€‚å®ƒä¼šåœ¨æ‚¨çš„å­˜å‚¨åº“çš„æ ¹æ–‡ä»¶å¤¹ä¸­å¯»æ‰¾ä¸€ä¸ªç‰¹æ®Šçš„ .github/workflows/ æ–‡ä»¶å¤¹ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æ”¾ç½®å¤šä¸ª YAML æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶å¯¹åº”ä¸€ä¸ªä¸åŒçš„å·¥ä½œæµç¨‹ã€‚æ­¤å¤–ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­åŒ…å«å…¶ä»–æ–‡ä»¶ï¼Œä¾‹å¦‚è¦åœ¨è¿è¡Œå™¨ä¸Šæ‰§è¡Œçš„é…ç½®æ–‡ä»¶æˆ–è‡ªå®šä¹‰è„šæœ¬ã€‚\næ‚¨åªä¼šä¸ºæŒç»­é›†æˆå®šä¹‰ä¸€ä¸ªå·¥ä½œæµç¨‹ï¼Œå› æ­¤è¯·ç»§ç»­åˆ›å»ºå¿…è¦çš„æ–‡ä»¶å¤¹ç»“æ„ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªåä¸º ci.yml çš„æ–‡ä»¶ï¼š\npage-tracker/ â”‚ â”œâ”€â”€ web/ â”‚ â”œâ”€â”€ .git/ â”‚ â”œâ”€â”€ .github/ â”‚ â””â”€â”€ workflows/ â”‚ â””â”€â”€ ci.yml â”‚ â”œâ”€â”€ .gitignore â””â”€â”€ docker-compose.yml å°½ç®¡æ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½•æ‚¨å–œæ¬¢çš„ä»£ç ç¼–è¾‘å™¨ä¸º GitHub Actions ç¼–å†™å·¥ä½œæµæ–‡ä»¶ï¼Œä½†åœ¨è¿™ç§æƒ…å†µä¸‹è¯·è€ƒè™‘ä½¿ç”¨ GitHub çš„åŸºäº Web çš„ç¼–è¾‘å™¨ã€‚å®ƒä¸ä»…æä¾›é€šç”¨çš„ YAML è¯­æ³•çªå‡ºæ˜¾ç¤ºï¼Œè¿˜æä¾›æ¶æ„éªŒè¯å’Œå¯¹å¯ç”¨ GitHub Actions å±æ€§çš„æ™ºèƒ½å»ºè®®ã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥å…ˆå°†ä»£ç æ¨é€åˆ° GitHubï¼Œç„¶åä½¿ç”¨å†…ç½®ç¼–è¾‘å™¨ç›´æ¥åœ¨é‚£é‡Œç¼–è¾‘æ‚¨çš„ ci.yml æ–‡ä»¶ã€‚\nè¦æ‰“å¼€ GitHub å†…ç½®çš„ç¼–è¾‘å™¨ï¼Œè¯·å°† Web æµè§ˆå™¨å¯¼èˆªåˆ° ci.yml æ–‡ä»¶ï¼Œç„¶åæŒ‰ E æˆ–å•å‡»é“…ç¬”å›¾æ ‡ã€‚æ‚¨ç°åœ¨å¯ä»¥å¼€å§‹ç¼–å†™ GitHub Actions å·¥ä½œæµæ–‡ä»¶ã€‚\nä½¿ç”¨ GitHub Actions åˆ›å»ºå·¥ä½œæµ åœ¨ç¼–è¾‘ ci.yml æ–‡ä»¶æ—¶ï¼Œä¸ºæ–°å·¥ä½œæµæŒ‡å®šä¸€ä¸ªæè¿°æ€§åç§°å¹¶å®šä¹‰åº”è§¦å‘å®ƒçš„äº‹ä»¶ï¼š\n# .github/workflows/ci.yml name: Continuous Integration on: pull_request: branches: - master push: branches: - master å°†è§¦å‘æ­¤å·¥ä½œæµçš„ä¸¤ä¸ªäº‹ä»¶æ˜¯ï¼š\næ‰“å¼€æˆ–æ›´æ”¹é’ˆå¯¹ master åˆ†æ”¯çš„æ‹‰å–è¯·æ±‚ æ¨é€ä»£ç æˆ–å°†åˆ†æ”¯åˆå¹¶åˆ° master åˆ†æ”¯ é™¤äº†åˆ†æ”¯åç§°ä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥ä¸ºæ¯ä¸ªäº‹ä»¶æ·»åŠ æ›´å¤šå±æ€§ä»¥ç¼©å°è§¦å‘æ¡ä»¶ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æä¾›å……å½“æ­£è¿‡æ»¤å™¨çš„æ–‡ä»¶è·¯å¾„æ¨¡å¼ï¼Œè¯¥æ¨¡å¼ä»…åœ¨æŸäº›æ–‡ä»¶å‘ç”Ÿæ›´æ”¹æ—¶æ‰è¿è¡Œå·¥ä½œæµã€‚\næ¯•ç«Ÿï¼Œæ‚¨å¯èƒ½ä¸æƒ³åœ¨ç¼–è¾‘ README æ–‡ä»¶æˆ–æ›´æ–°æ–‡æ¡£åè¿è¡Œæ•´ä¸ªæŒç»­é›†æˆå·¥ä½œæµç¨‹ã€‚ä¸ç®¡æ€æ ·ï¼Œä½ ç°åœ¨ä¼šè®©äº‹æƒ…ä¿æŒç®€å•ã€‚\næ‚¨çš„æŒç»­é›†æˆå·¥ä½œæµç¨‹çš„å·¥ä½œæ˜¯æ„å»º Docker é•œåƒï¼Œä½¿ç”¨ Docker Compose è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•ï¼Œå¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œå°†æ„å»ºçš„é•œåƒæ¨é€åˆ° Docker Hubã€‚\næ„Ÿè°¢æ‚¨å…¨é¢çš„ Dockerfileï¼Œå°†å•å…ƒæµ‹è¯•ã€å„ç§é™æ€ä»£ç åˆ†æå·¥å…·å’Œå®‰å…¨æ‰«æé›†æˆåˆ°ä¸€ä¸ªå‘½ä»¤ä¸­ã€‚å› æ­¤ï¼Œæ‚¨æ— éœ€ä¸º CI å·¥ä½œæµç¨‹ç¼–å†™å¤§é‡ YAMLã€‚\nGitHub Action å·¥ä½œæµä¸­çš„å‡ ä¹æ¯é¡¹å·¥ä½œéƒ½æ˜¯ä»ä» GitHub å­˜å‚¨åº“ä¸­æ£€å‡ºä»£ç å¼€å§‹çš„ï¼š\n# .github/workflows/ci.yml name: Continuous Integration on: pull_request: branches: - master push: branches: - master jobs: build: name: Build Docker image and run end-to-end tests runs-on: ubuntu-latest steps: - name: Checkout code from GitHub uses: actions/checkout@v3 æ‚¨æŒ‡å®šä¸€ä¸ªæ ‡è¯†ä¸º build çš„ä½œä¸šï¼Œå®ƒå°†åœ¨ GitHub æä¾›çš„æœ€æ–° Ubuntu è¿è¡Œå™¨ä¸Šè¿è¡Œã€‚å®ƒçš„ç¬¬ä¸€æ­¥æ˜¯ä½¿ç”¨ actions/checkout GitHub æ“ä½œæ£€æŸ¥è§¦å‘å·¥ä½œæµçš„å•ä¸ªæäº¤ã€‚å› ä¸º GitHub Actions å®é™…ä¸Šæ˜¯ä¼ªè£…çš„ GitHub å­˜å‚¨åº“ï¼Œæ‰€ä»¥æ‚¨å¯ä»¥åœ¨ at ç¬¦å· ( @ ) åæä¾› Git æ ‡è®°æˆ–æäº¤å“ˆå¸Œä»¥é€‰æ‹©ç‰¹å®šç‰ˆæœ¬çš„æ“ä½œã€‚\nä½œä¸ºæŒç»­é›†æˆç®¡é“çš„ä¸‹ä¸€æ­¥ï¼Œæ‚¨å¸Œæœ›åœ¨é€šè¿‡ Docker Compose æ‰§è¡Œç«¯åˆ°ç«¯æµ‹è¯•ä¹‹å‰ä¸ºæ‚¨çš„ Web å’Œæµ‹è¯•æœåŠ¡æ„å»º Docker é•œåƒã€‚è¿™æ¬¡æ‚¨å°†åœ¨è¿è¡Œå™¨ä¸Šè¿è¡Œä¸€ä¸ª shell å‘½ä»¤ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç°æœ‰çš„æ“ä½œï¼š\n# .github/workflows/ci.yml name: Continuous Integration on: pull_request: branches: - master push: branches: - master jobs: build: name: Build Docker image and run end-to-end tests runs-on: ubuntu-latest steps: - name: Checkout code from GitHub uses: actions/checkout@v3 - name: Run end-to-end tests run: \u0026gt; docker compose --profile testing up --build --exit-code-from test-service è¿™ä¸¤ä¸ªæ­¥éª¤å°†å§‹ç»ˆè¿è¡Œä»¥å“åº”æ–‡ä»¶é¡¶éƒ¨åˆ—å‡ºçš„äº‹ä»¶ï¼Œå³æ‰“å¼€æ‹‰å–è¯·æ±‚æˆ–å°†åŠŸèƒ½åˆ†æ”¯åˆå¹¶åˆ°ä¸»çº¿ä¸­ã€‚\næ­¤å¤–ï¼Œåœ¨æˆåŠŸå°†åˆ†æ”¯åˆå¹¶åˆ°ä¸»çº¿åï¼Œå½“æ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡æ—¶ï¼Œæ‚¨éœ€è¦å°†æ–°çš„ Docker é•œåƒæ¨é€åˆ° Docker Hubã€‚å› æ­¤ï¼Œåªæœ‰å½“ push äº‹ä»¶è§¦å‘æ‚¨çš„å·¥ä½œæµç¨‹æ—¶ï¼Œæ‚¨æ‰ä¼šæœ‰æ¡ä»¶åœ°è¿è¡Œåç»­æ­¥éª¤ã€‚\nä½†æ˜¯ï¼Œå¦‚ä½•ä½¿ç”¨ GitHub Actions å®‰å…¨è®¿é—® Docker Hub è€Œä¸ä¼šæ³„éœ²æ‚¨çš„ç§˜å¯†ï¼Ÿä½ ç°åœ¨å°±ä¼šçŸ¥é“äº†ã€‚\né€šè¿‡ GitHub Actions Secrets è®¿é—® Docker Hub æ—©äº›æ—¶å€™ï¼Œå½“æ‚¨å°†å…¶ä¸­ä¸€ä¸ª Docker é•œåƒä»ç»ˆç«¯æ¨é€åˆ° Docker Registry æ—¶ï¼Œæ‚¨å¿…é¡»é€šè¿‡è°ƒç”¨ docker login å¹¶æä¾›æ‚¨çš„ç”¨æˆ·åå’Œå¯†ç æ¥ç™»å½• Docker Hubã€‚æ­¤å¤–ï¼Œå¦‚æœå¯ç”¨åŒå› ç´ èº«ä»½éªŒè¯ï¼Œåˆ™å¿…é¡»ç”Ÿæˆå…·æœ‰è¶³å¤Ÿæƒé™çš„ä¸ªäººè®¿é—®ä»¤ç‰Œå¹¶æä¾›å®ƒè€Œä¸æ˜¯å¯†ç ã€‚\nä»è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹æ¨é€é•œåƒçš„æ­¥éª¤ç›¸ä¼¼ï¼Œå› æ­¤æ‚¨å¿…é¡»å…ˆè¿›è¡Œèº«ä»½éªŒè¯ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ shell å‘½ä»¤æˆ–é¢„å®šä¹‰çš„ GitHub æ“ä½œæ¥æ‰§è¡Œæ­¤æ“ä½œï¼Œä¾‹å¦‚ docker/login-action ï¼š\n# .github/workflows/ci.yml name: Continuous Integration on: pull_request: branches: - master push: branches: - master jobs: build: name: Build Docker image and run end-to-end tests runs-on: ubuntu-latest steps: - name: Checkout code from GitHub uses: actions/checkout@v3 - name: Run end-to-end tests run: \u0026gt; docker compose --profile testing up --build --exit-code-from test-service - name: Login to Docker Hub uses: docker/login-action@v2 if: ${{ github.event_name == \u0026#39;push\u0026#39; }} with: username: ${{ secrets.DOCKERHUB_USERNAME }} password: ${{ secrets.DOCKERHUB_TOKEN }} æ‚¨æœ‰æ¡ä»¶åœ°è¿è¡Œæ­¤æ­¥éª¤ï¼Œæ–¹æ³•æ˜¯ä½¿ç”¨åŒ…å«åœ¨ç¾å…ƒç¬¦å·å’ŒåŒå¤§æ‹¬å·ä¸­çš„ JavaScript è¡¨è¾¾å¼ä» github ä¸Šä¸‹æ–‡è·å–äº‹ä»¶ç±»å‹ã€‚ç„¶åï¼Œæ‚¨é€šè¿‡å¦ä¸€ä¸ªé¢„å®šä¹‰çš„ secrets ä¸Šä¸‹æ–‡å’Œæ‚¨ç°åœ¨å°†è¦å®šä¹‰çš„ä¸¤ä¸ªè‡ªå®šä¹‰å¸¸é‡æä¾›æ‚¨çš„ç§˜å¯† Docker Hub å‡­æ®ã€‚\né€šè¿‡å•å‡»é¡¶éƒ¨å·¥å…·æ ä¸­å¸¦æœ‰é½¿è½®å›¾æ ‡çš„é€‰é¡¹å¡æ‰“å¼€ GitHub å­˜å‚¨åº“çš„è®¾ç½®ï¼Œæ‰¾åˆ°å¹¶å±•å¼€å®‰å…¨éƒ¨åˆ†ä¸‹çš„ç§˜å¯†å’Œå˜é‡ï¼Œç„¶åå•å‡»æ“ä½œã€‚è¿™å°†å¸¦æ‚¨è¿›å…¥ä¸€ä¸ªé¢æ¿ï¼Œæ‚¨å¯ä»¥åœ¨è¯¥é¢æ¿ä¸­ä¸º GitHub Actions è¿è¡Œå™¨å®šä¹‰ç¯å¢ƒå˜é‡å’ŒåŠ å¯†æœºå¯†ã€‚ç°åœ¨ï¼ŒæŒ‡å®šæ‚¨çš„ DOCKERHUB_USERNAME å’Œ DOCKERHUB_TOKEN æœºå¯†ï¼š\nè¯·æ³¨æ„ï¼Œè¿™äº›ç§˜å¯†æ˜¯åŠ å¯†çš„ï¼ŒGitHub ä¸ä¼šå†æ¬¡å‘æ‚¨æ˜¾ç¤ºå®ƒä»¬ï¼Œå› æ­¤è¯·ç¡®ä¿å°†å®ƒä»¬ä¿å­˜åœ¨å®‰å…¨çš„åœ°æ–¹ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨è¶³å¤ŸåŠªåŠ›ï¼Œé‚£ä¹ˆæ‚¨å°†èƒ½å¤Ÿæ¢å¤å®ƒä»¬â€”â€”ä¾‹å¦‚ï¼Œé€šè¿‡æ‚¨å·¥ä½œæµç¨‹ä¸­çš„ shell å‘½ä»¤ã€‚\nå½“æ‚¨å°†åŠŸèƒ½åˆ†æ”¯åˆå¹¶åˆ°ä¸»çº¿æ—¶ï¼Œæ­¤æ“ä½œä¹Ÿä¼šæœ‰æ¡ä»¶åœ°è¿è¡Œã€‚åœ¨ with éƒ¨åˆ†ï¼Œæ‚¨æŒ‡å®š Dockerfile çš„è·¯å¾„ï¼Œè¯·æ±‚æ¨é€é•œåƒçš„æ“ä½œï¼Œå¹¶åˆ—å‡ºé•œåƒçš„æ ‡ç­¾ã€‚è¯·æ³¨æ„ï¼Œæ‚¨å†æ¬¡ä½¿ç”¨ github ä¸Šä¸‹æ–‡æ¥è·å–å½“å‰æäº¤çš„å“ˆå¸Œå€¼ï¼Œå°½ç®¡æ˜¯é•¿æ ¼å¼ã€‚\næ³¨æ„ï¼šGitHub Packages æ˜¯é›†æˆåˆ° GitHub ä¸­çš„å¦ä¸€é¡¹æœåŠ¡ã€‚å®ƒå¯ä»¥ä½œä¸º Docker Hub çš„æ›¿ä»£å“ã€‚å®ƒæ”¯æŒå„ç§åŒ…ç±»å‹ï¼ŒåŒ…æ‹¬ Docker é•œåƒï¼Œè®©æ‚¨å¯ä»¥å°†æºä»£ç å’ŒäºŒè¿›åˆ¶åŒ…å­˜å‚¨åœ¨ä¸€ä¸ªåœ°æ–¹ã€‚ docker/build-push-action å¯ä»¥åˆ©ç”¨æ‚¨çš„ GitHub ä»¤ç‰Œæ¨é€åˆ° GitHub Packagesã€‚\næ­¤æ—¶ï¼Œæ‚¨çš„æŒç»­é›†æˆå·¥ä½œæµå·²é…ç½®å®Œæ¯•å¹¶å‡†å¤‡å°±ç»ªã€‚å¦‚æœæ‚¨è¿˜æ²¡æœ‰ä½¿ç”¨ GitHub å†…ç½®çš„ä»£ç ç¼–è¾‘å™¨ï¼Œé‚£ä¹ˆè¯·è®°ä½æäº¤å¹¶æ¨é€æ‚¨çš„æœ¬åœ°å­˜å‚¨åº“ä»¥ä½¿æ›´æ”¹ç”Ÿæ•ˆï¼š\n$ git status On branch master Untracked files: (use \u0026#34;git add \u0026lt;file\u0026gt;...\u0026#34; to include in what will be committed) .github/ nothing added to commit but untracked files present (use \u0026#34;git add\u0026#34; to track) $ git add .github/ $ git commit -m \u0026#34;Add a continuous integration workflow\u0026#34; $ git push åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæ‚¨å°†å¯ç”¨ä¸€äº›åˆ†æ”¯ä¿æŠ¤è§„åˆ™ä»¥é˜²æ­¢ä»»ä½•äººå°†ä»–ä»¬çš„ä»£ç ç›´æ¥æ¨é€åˆ° master åˆ†æ”¯ã€‚å› æ­¤ï¼Œå·¥ä½œæµä¸­çš„ push äº‹ä»¶å°†ä»…é€‚ç”¨äºé€šè¿‡æ‹‰å–è¯·æ±‚å°†åŠŸèƒ½åˆ†æ”¯åˆå¹¶åˆ°ä¸»çº¿ä¸­ã€‚\nå¯ç”¨åˆ†æ”¯ä¿æŠ¤è§„åˆ™ å†æ¬¡è½¬åˆ°å­˜å‚¨åº“çš„è®¾ç½®ï¼Œå•å‡»ä»£ç å’Œè‡ªåŠ¨åŒ–éƒ¨åˆ†ä¸‹çš„åˆ†æ”¯ï¼Œç„¶åå•å‡»æ ‡è®°ä¸ºæ·»åŠ åˆ†æ”¯ä¿æŠ¤è§„åˆ™çš„æŒ‰é’®ã€‚ç„¶åï¼Œåœ¨ Branch name pattern å­—æ®µä¸­è¾“å…¥æ‚¨çš„ä¸»çº¿åç§°ã€‚å¦‚æœæ‚¨éµå¾ªæœ¬æ•™ç¨‹ä¸­ä½¿ç”¨çš„å‘½åçº¦å®šï¼Œåˆ™åº”åœ¨è¾“å…¥å­—æ®µä¸­é”®å…¥ master ï¼š\næ¥ä¸‹æ¥ï¼Œå¯ç”¨å…¶æ­£ä¸‹æ–¹çš„ä¸€ä¸ªé€‰é¡¹ï¼Œè¯¥é€‰é¡¹æ˜¾ç¤º Require a pull request before mergingã€‚è¿™å°†è‡ªåŠ¨éœ€è¦è‡³å°‘ä¸€ä½å®¡é˜…è€…çš„æ‰¹å‡†ã€‚å¦‚æœæ‚¨åœ¨ GitHub ä¸Šæ²¡æœ‰å…¶ä»–å¸æˆ·ï¼Œæ‚¨å¯ä»¥æš‚æ—¶å–æ¶ˆé€‰ä¸­æ­¤é€‰é¡¹ã€‚å¦åˆ™ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–äººæ‰¹å‡†ï¼Œæ‚¨å°†æ— æ³•åˆå¹¶æ‚¨çš„æ‹‰å–è¯·æ±‚ï¼š å‘ä¸‹æ»šåŠ¨ä¸€ç‚¹åï¼Œæ‚¨ä¼šçœ‹åˆ°ä¸€ä¸ªé€‰é¡¹ï¼Œä¸Šé¢å†™ç€ Require status checks to pass before mergingã€‚é€‰æ‹©å®ƒä»¥æ˜¾ç¤ºæ›´å¤šé€‰é¡¹ã€‚å½“ä½ è¿™æ ·åšæ—¶ï¼Œæ£€æŸ¥å¦ä¸€ä¸ªé€‰é¡¹ Require branches to be update before mergingï¼Œè¿™å°†é˜²æ­¢åœ¨ä½ çš„ master åˆ†æ”¯æœ‰æ–°æäº¤æ—¶å…³é—­æ‹‰å–è¯·æ±‚ã€‚æœ€åï¼Œåœ¨ä¸‹é¢çš„æœç´¢æ¡†ä¸­è¾“å…¥æ‚¨çš„å·¥ä½œåç§° build ï¼š\nç°åœ¨ï¼Œæ¯ä¸ªæ‹‰å–è¯·æ±‚éƒ½éœ€è¦åœ¨å…è®¸åˆå¹¶ä¹‹å‰é€šè¿‡ç«¯åˆ°ç«¯æµ‹è¯•ã€‚\nè¦åœ¨ä¸å…è®¸ç®¡ç†å‘˜å’Œå…¶ä»–å…·æœ‰æå‡æƒé™çš„ç”¨æˆ·ç»•è¿‡è¿™äº›è§„åˆ™çš„æƒ…å†µä¸‹å¼ºåˆ¶æ‰§è¡Œè¿™äº›è§„åˆ™ï¼Œæ‚¨å¯ä»¥åœ¨åº•éƒ¨é€‰æ‹©ä¸€ä¸ªæ ‡è®°ä¸ºä¸å…è®¸ç»•è¿‡ä¸Šè¿°è®¾ç½®çš„é€‰é¡¹ï¼š\nå¥½çš„ã€‚ä¸€åˆ‡å°±ç»ªï¼å¦‚ä½•ä½¿ç”¨æ‚¨çš„ Docker åº”ç”¨ç¨‹åºæ¥æµ‹è¯•æ‚¨çš„æŒç»­é›†æˆå·¥ä½œæµç¨‹ï¼Ÿ\né›†æˆæ¥è‡ªåŠŸèƒ½åˆ†æ”¯çš„æ›´æ”¹ éµå¾ªæœ¬æ•™ç¨‹å‰é¢æ¦‚è¿°çš„åŸºäº Docker çš„æŒç»­é›†æˆç®¡é“ã€‚é¦–å…ˆåˆ›å»ºä¸€ä¸ªå•ç‹¬çš„åŠŸèƒ½åˆ†æ”¯ï¼Œä»¥ç ´åæµ‹è¯•çš„æ–¹å¼ä¿®æ”¹ä»£ç ï¼Œæäº¤æ›´æ”¹å¹¶å°†å®ƒä»¬æ¨é€åˆ° GitHubï¼š\nWindowsï¼š\nPS\u0026gt; git checkout -b feature/replace-emoji-face Switched to a new branch \u0026#39;feature/replace-emoji-face\u0026#39; PS\u0026gt; cd web\\src\\page_tracker PS\u0026gt; (Get-Content app.py).replace(\u0026#39;pensive\u0026#39;, \u0026#39;thinking\u0026#39;) | Set-Content app.py PS\u0026gt; git commit -am \u0026#34;Replace the emoji in an error message\u0026#34; [feature/replace-emoji-face 9225d18] Replace the emoji in an error message 1 file changed, 1 insertion(+), 1 deletion(-) PS\u0026gt; git push --set-upstream origin feature/replace-emoji-face â‹® remote: Create a pull request for \u0026#39;feature/replace-emoji-face\u0026#39; on GitHub... remote: https://github.com/realpython/page-tracker/pull/new/feature... Linx + MacOSï¼š\n$ git checkout -b feature/replace-emoji-face Switched to a new branch \u0026#39;feature/replace-emoji-face\u0026#39; $ sed -i \u0026#39;s/pensive/thinking/g\u0026#39; web/src/page_tracker/app.py $ git commit -am \u0026#34;Replace the emoji in an error message\u0026#34; [feature/replace-emoji-face 9225d18] Replace the emoji in an error message 1 file changed, 1 insertion(+), 1 deletion(-) $ git push --set-upstream origin feature/replace-emoji-face â‹® remote: Create a pull request for \u0026#39;feature/replace-emoji-face\u0026#39; on GitHub... remote: https://github.com/realpython/page-tracker/pull/new/feature... â‹® æ‚¨åˆ›å»ºå¹¶åˆ‡æ¢åˆ°ä¸€ä¸ªåä¸º feature/replace-emoji-face çš„æ–°æœ¬åœ°åˆ†æ”¯ï¼Œç„¶åå°†é”™è¯¯æ¶ˆæ¯ä¸­çš„è¡¨æƒ…ç¬¦å·ä»æ²‰æ€è„¸æ›´æ”¹ä¸ºæ€è€ƒè„¸ï¼Œè€Œä¸æ›´æ–°ç›¸åº”çš„å•å…ƒæµ‹è¯•ã€‚å°†åˆ†æ”¯æäº¤å¹¶æ¨é€åˆ° GitHub åï¼Œæ‚¨å¯ä»¥é€šè¿‡çªå‡ºæ˜¾ç¤ºè¡Œä¸­çš„é“¾æ¥ä»æ‚¨çš„åŠŸèƒ½åˆ†æ”¯æ‰“å¼€ä¸€ä¸ªæ–°çš„æ‹‰å–è¯·æ±‚åˆ° master ã€‚åªè¦æ‚¨è¿™æ ·åšï¼Œæ‚¨çš„æŒç»­é›†æˆå·¥ä½œæµç¨‹å°±ä¼šå¯åŠ¨ã€‚\nå½“ GitHub Actions è¿è¡Œå™¨å®Œæˆå…¶å·¥ä½œæ—¶ï¼Œç”±äºæ£€æŸ¥å¤±è´¥ï¼Œæ‚¨å°†æ— æ³•åˆå¹¶æ‚¨çš„åˆ†æ”¯ï¼š\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨åªæœ‰ä¸€ä¸ªæ£€æŸ¥å¯¹åº”äºå·¥ä½œæµä¸­çš„ build ä½œä¸šï¼Œæ‚¨åœ¨ä¸Šä¸€èŠ‚ä¸­å°†å…¶é…ç½®ä¸ºåˆ†æ”¯ä¿æŠ¤è§„åˆ™ä¹‹ä¸€ã€‚æ‚¨å¯ä»¥å•å‡»å³ä¾§çš„ Details é“¾æ¥æ¥è°ƒæŸ¥å¤±è´¥æ£€æŸ¥çš„æ—¥å¿—ï¼Œå¹¶ä¸”æ‚¨å¯ä»¥é€‰æ‹©ä»¥è°ƒè¯•æ¨¡å¼é‡æ–°è¿è¡Œç›¸åº”çš„ä½œä¸šä»¥æ”¶é›†æ›´å¤šæ•°æ®ã€‚\næ­¤å¤–ï¼Œä¸Šé¢çš„å±å¹•æˆªå›¾æè¿°äº†æ‚¨çš„åŠŸèƒ½åˆ†æ”¯å’Œç›®æ ‡ä¸»çº¿ä¹‹é—´çš„å‡è®¾å†²çªã€‚è¿™è¡¨æ˜å…¶ä»–äººä¿®æ”¹äº†ä¸æ‚¨ç›¸åŒçš„æ–‡ä»¶ï¼Œå¹¶ä¸”ä»–ä»¬åœ¨æ‚¨ä¿®æ”¹è¡¨æƒ…ç¬¦å·æ—¶æˆåŠŸåœ°å°†ä»–ä»¬çš„æ›´æ”¹ä¸ master åˆ†æ”¯é›†æˆã€‚\næ²¡æœ‰è‡ªåŠ¨è§£å†³æ­¤ç±»å†²çªçš„æ–¹æ³•ï¼Œå› ä¸ºå®ƒæ¶‰åŠç†è§£ä»£ç çš„é€»è¾‘å¹¶åšå‡ºå…³äºä¿ç•™å“ªäº›æ›´æ”¹ä»¥åŠä¸¢å¼ƒå“ªäº›æ›´æ”¹çš„ä¸»è§‚å†³å®šã€‚\nè§£å†³æ­¤å†²çªçš„å”¯ä¸€æ–¹æ³•æ˜¯å°†æ›´æ–°åçš„ä¸»çº¿åˆå¹¶åˆ°æ‚¨æœ¬åœ°çš„åŠŸèƒ½åˆ†æ”¯ä¸­ï¼Œå¹¶æ‰‹åŠ¨æ•´åˆå†²çªçš„æ›´æ”¹ã€‚\nå³ä½¿æ²¡æœ‰ä»»ä½•å†²çªï¼Œå¦‚æœä¸»çº¿åœ¨æ‚¨çš„åŠŸèƒ½åˆ†æ”¯ä¹‹å‰æœ‰å‡ ä¸ªæäº¤ï¼Œé‚£ä¹ˆæ— è®ºæµ‹è¯•ç»“æœå¦‚ä½•ï¼Œæ‚¨ä»ç„¶å¿…é¡»å°† master ä¸­çš„æœ€æ–°æ›´æ”¹åˆå¹¶åˆ°æ‚¨çš„åˆ†æ”¯ä¸­ã€‚è¿™æ˜¯å› ä¸ºæ‚¨ä¹‹å‰åˆ¶å®šçš„å¦ä¸€ä¸ªåˆ†æ”¯ä¿æŠ¤è§„åˆ™ï¼š\nåˆå¹¶æ‹‰å–è¯·æ±‚æŒ‰é’®å°†ä¿æŒç°è‰²å’Œç¦ç”¨çŠ¶æ€ï¼Œç›´åˆ°æ‚¨é‡‡å–æªæ–½è§£å†³æ‰€æœ‰è¿™äº›é—®é¢˜ã€‚\nåœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œæ‚¨ç°åœ¨åº”è¯¥è·å–æœ€æ–°çš„ master å¹¶å°†å…¶åˆå¹¶åˆ°æ‚¨çš„åŠŸèƒ½åˆ†æ”¯ï¼Œå¿…è¦æ—¶è§£å†³ä»»ä½•å†²çªã€‚ç„¶åï¼Œæ‚¨å°†æ›´æ–°ä»£ç ä»¥ä½¿æ‰€æœ‰æµ‹è¯•å†æ¬¡é€šè¿‡ã€‚è¿”å›ä»£ç ç¼–è¾‘å™¨å¹¶ä½¿ç”¨é¢„æœŸçš„è¡¨æƒ…ç¬¦å·ä¿®å¤å¤±è´¥çš„å•å…ƒæµ‹è¯•ï¼š\n# web/test/unit/test_app.py # ... @unittest.mock.patch(\u0026#34;page_tracker.app.redis\u0026#34;) def test_should_handle_redis_connection_error(mock_redis, http_client): # Given mock_redis.return_value.incr.side_effect = ConnectionError # When response = http_client.get(\u0026#34;/\u0026#34;) # Then assert response.status_code == 500 - assert response.text == \u0026#34;Sorry, something went wrong \\N{pensive face}\u0026#34; + assert response.text == \u0026#34;Sorry, something went wrong \\N{thinking face}\u0026#34; åœ¨æœ¬åœ°è¿è¡Œæµ‹è¯•å¹¶å¯¹ä»£ç çš„æ­£ç¡®æ€§è·å¾—ä¿¡å¿ƒåï¼Œåœ¨åŒä¸€åˆ†æ”¯ä¸Šå†æ¬¡æäº¤å¹¶å°†å…¶æ¨é€åˆ° GitHubã€‚åœ¨è¿™æ ·åšä¹‹å‰ï¼Œå€¼å¾—ä»”ç»†æ£€æŸ¥å½“å‰åˆ†æ”¯ï¼š\n$ git branch * feature/replace-emoji-face master $ git add web/test/unit/test_app.py $ git commit -m \u0026#34;Fix the failing unit test\u0026#34; $ git push æ‹‰å–è¯·æ±‚åº”è¯¥æ¥å—æ‚¨çš„æ›´æ”¹å¹¶å¼€å§‹å¦ä¸€ä¸ª CI æ„å»ºã€‚ä¸€æ—¦æ»¡è¶³æ‰€æœ‰ä¿æŠ¤è§„åˆ™ï¼Œæ‚¨æœ€ç»ˆå¯ä»¥é€šè¿‡å•å‡»ç»¿è‰²æŒ‰é’®å°†æ‚¨çš„åŠŸèƒ½åˆ†æ”¯åˆå¹¶åˆ°å—ä¿æŠ¤çš„ä¸»çº¿ä¸­ï¼š\nè¯·æ³¨æ„ï¼Œåˆå¹¶å°†è§¦å‘é’ˆå¯¹ master åˆ†æ”¯çš„å¦ä¸€ä¸ª CI æ„å»ºï¼Œä»¥æµ‹è¯•æ‚¨çš„æ›´æ”¹æ˜¯å¦ä¸ä»£ç åº“çš„å…¶ä½™éƒ¨åˆ†å¾ˆå¥½åœ°é›†æˆã€‚äº‹æƒ…æ€»æ˜¯æœ‰å¯èƒ½å‡ºé”™ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœ CI æ„å»ºæˆåŠŸï¼Œåˆ™å·¥ä½œæµå°†æ ‡è®°å¹¶å°†é•œåƒæ¨é€åˆ°æ‚¨çš„ Docker Hub å­˜å‚¨åº“ï¼š\næ¯æ¬¡ CI å·¥ä½œæµæˆåŠŸæ—¶ï¼Œæ¨é€çš„ Docker é•œåƒéƒ½ä¼šè¢«æ ‡è®°ä¸ºå½“å‰ Git æäº¤å“ˆå¸Œå’Œæ ‡ç­¾ latest ã€‚\næ­å–œï¼å…³äºä½¿ç”¨ Docker å’Œæœ‹å‹æ„å»ºæŒç»­é›†æˆç®¡é“çš„æ•´ä¸ªæ•™ç¨‹åˆ°æ­¤ç»“æŸã€‚ç»™è‡ªå·±å½“ä¹‹æ— æ„§çš„è¡¨æ‰¬ï¼Œå› ä¸ºè¿™ç»éæ˜“äº‹ï¼\nåç»­æ­¥éª¤ æ‚¨æ€»æ˜¯å¯ä»¥åšå¾ˆå¤šäº‹æƒ…æ¥æ”¹è¿›å’Œå¾®è°ƒç°æœ‰çš„æŒç»­é›†æˆæµç¨‹ã€‚å°½ç®¡è¿™æ˜¯å…³äºæ„å»ºå¼ºå¤§çš„ CI ç®¡é“çš„è¯¦å°½ä¸”å®ç”¨çš„æ•™ç¨‹ï¼Œä½†æ‚¨åªæ˜¯è§¦åŠäº†çš®æ¯›ï¼\nä»¥ä¸‹æ˜¯ä¸€äº›ä¾›æ‚¨è€ƒè™‘çš„æƒ³æ³•ï¼š\nè‡ªåŠ¨éƒ¨ç½²åˆ°äº‘ä»¥å®ç°æŒç»­äº¤ä»˜ã€‚\né€šè¿‡å…¨æµç¨‹è‡ªåŠ¨åŒ–è½¬å‘æŒç»­éƒ¨ç½²ã€‚\nå¼•å…¥è´Ÿè½½å‡è¡¡å™¨å’ŒæœåŠ¡å‰¯æœ¬ä»¥è·å¾—æ›´å¥½çš„å¯æ‰©å±•æ€§ã€‚\nä½¿ç”¨èº«ä»½éªŒè¯ä»¤ç‰Œä¿æŠ¤æ•æ„Ÿæ•°æ®å­˜å‚¨ã€‚\né…ç½®æœåŠ¡çš„æŒä¹…æ—¥å¿—è®°å½•å’Œç›‘æ§ã€‚\nå®æ–½è“ç»¿éƒ¨ç½²ä»¥å®ç°é›¶åœæœºã€‚\næ·»åŠ åŠŸèƒ½åˆ‡æ¢ä»¥è¯•éªŒé‡‘ä¸é›€å‘å¸ƒå’Œ A/B æµ‹è¯•ã€‚\né€šè¿‡æœ¬æ•™ç¨‹ï¼Œæ‚¨å·²ç»ä¸ºå…¥é—¨æ‰“ä¸‹äº†è‰¯å¥½çš„åŸºç¡€ã€‚æ‚¨å½“ç„¶å¯ä»¥ä»è¿™é‡Œå¼€å§‹æ„å»ºä¸€ä¸ªå……åˆ†è‡ªåŠ¨åŒ–å’Œç”Ÿäº§å°±ç»ªçš„æŒç»­é›†æˆç³»ç»Ÿï¼Œåˆ©ç”¨ Docker å’Œæœ‹å‹çš„åŠ›é‡ã€‚\næ€»ç»“ æ‚¨ç°åœ¨å¯¹å¦‚ä½•åœ¨å®¹å™¨åŒ–ç¯å¢ƒä¸­æ„å»ºã€éƒ¨ç½²å’Œç®¡ç†å¤šå®¹å™¨ Web åº”ç”¨ç¨‹åºæœ‰äº†æ·±å…¥çš„äº†è§£ã€‚æ‚¨ä»‹ç»äº†æŒ‚æ¥åˆ° Redis æœåŠ¡å™¨çš„ Flask Web åº”ç”¨ç¨‹åºçš„å¼€å‘ã€æµ‹è¯•ã€ä¿æŠ¤ã€ç å¤´åŒ–å’Œç¼–æ’ã€‚\næ‚¨è¿˜äº†è§£äº†å¦‚ä½•ä½¿ç”¨ Dockerã€GitHub Actions å’Œå„ç§å…¶ä»–å·¥å…·å®šä¹‰æŒç»­é›†æˆç®¡é“ã€‚\nåœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å·²ç»ï¼š\nåœ¨ Docker å®¹å™¨ä¸­æœ¬åœ°è¿è¡Œ Redis æœåŠ¡å™¨ Docker ç¼–æ’ ä¸€ä¸ªç”¨ Flask ç¼–å†™çš„ Python Web åº”ç”¨ç¨‹åº æ„å»º Docker é•œåƒå¹¶å°†å®ƒä»¬æ¨é€åˆ° Docker Hub æ³¨å†Œè¡¨ ä½¿ç”¨ Docker Compose ç¼–æ’å¤šå®¹å™¨åº”ç”¨ç¨‹åº åœ¨ä»»ä½•åœ°æ–¹å¤åˆ¶ç±»ä¼¼ç”Ÿäº§çš„åŸºç¡€è®¾æ–½ ä½¿ç”¨ GitHub Actions å®šä¹‰æŒç»­é›†æˆå·¥ä½œæµç¨‹ æ‚¨å‡†å¤‡å¥½æ„å»ºè‡ªå·±çš„æŒç»­é›†æˆç®¡é“äº†å—ï¼Ÿåœ¨è¯„è®ºä¸­è®©å¤§å®¶çŸ¥é“ï¼\nå…è´¹ä¸‹è½½ï¼šå•å‡»æ­¤å¤„ä¸‹è½½æ‚¨çš„ Flask åº”ç”¨ç¨‹åºå’Œç›¸å…³èµ„æºï¼Œä»¥ä¾¿æ‚¨å¯ä»¥ä½¿ç”¨ Docker å®šä¹‰æŒç»­é›†æˆç®¡é“ã€‚\nåŸæ–‡é“¾æ¥ï¼šBuild Robust Continuous Integration With Docker and Friends ","permalink":"https://blog.chensoul.cc/posts/2023/05/22/docker-continuous-integration/","summary":"æŒç»­é›†æˆ (CI) å·²æˆä¸ºè½¯ä»¶å¼€å‘çš„å…³é”®ï¼Œå®ƒå…è®¸å›¢é˜Ÿé¢‘ç¹åˆå¹¶ä»£ç æ›´æ”¹å¹¶åŠæ—©å‘ç°é”™è¯¯ã€‚\nDocker å®¹å™¨é€šè¿‡æä¾›ä¸€è‡´çš„ç¯å¢ƒå¸®åŠ©ä¿ƒè¿›æŒç»­é›†æˆè¿‡ç¨‹ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æµ‹è¯•å’Œå‘é€æ¯æ¬¡æäº¤çš„ä»£ç ã€‚\nåœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Docker ä¸º Flask Web åº”ç”¨ç¨‹åºåˆ›å»ºå¼ºå¤§çš„æŒç»­é›†æˆç®¡é“ã€‚\næ‚¨å°†å®Œæˆåœ¨æœ¬åœ°å¼€å‘å’Œæµ‹è¯•åº”ç”¨ç¨‹åºã€å°†å…¶å®¹å™¨åŒ–ã€ä½¿ç”¨ Docker Compose ç¼–æ’å®¹å™¨ä»¥åŠä½¿ç”¨ GitHub Actions å®šä¹‰ CI ç®¡é“çš„æ­¥éª¤ã€‚\nåœ¨æœ¬æ•™ç¨‹ç»“æŸæ—¶ï¼Œæ‚¨å°†èƒ½å¤Ÿä¸ºæ‚¨çš„ Web åº”ç”¨ç¨‹åºåˆ›å»ºä¸€ä¸ªå®Œå…¨è‡ªåŠ¨åŒ–çš„ CI ç®¡é“ã€‚\nåœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†ï¼š\nåœ¨ Docker å®¹å™¨ä¸­æœ¬åœ°è¿è¡Œ Redis æœåŠ¡å™¨ ç”¨ Docker ç¼–æ’ Flask ç¼–å†™çš„ Python Web åº”ç”¨ç¨‹åº æ„å»º Docker é•œåƒå¹¶å°†å®ƒä»¬æ¨é€åˆ° Docker Hub ä»“åº“ ä½¿ç”¨ Docker Compose ç¼–æ’å¤šå®¹å™¨åº”ç”¨ç¨‹åº åœ¨ä»»ä½•åœ°æ–¹å¤åˆ¶ç±»ä¼¼ç”Ÿäº§çš„åŸºç¡€è®¾æ–½ ä½¿ç”¨ GitHub Actions å®šä¹‰æŒç»­é›†æˆå·¥ä½œæµ ç†æƒ³æƒ…å†µä¸‹ï¼Œæ‚¨åº”è¯¥å…·æœ‰ä½¿ç”¨ Python è¿›è¡Œ Web å¼€å‘ã€æµ‹è¯•è‡ªåŠ¨åŒ–ã€å°† Redis ä¸ Python ç»“åˆä½¿ç”¨ä»¥åŠä½¿ç”¨ Git å’Œ GitHub è¿›è¡Œæºä»£ç ç‰ˆæœ¬æ§åˆ¶çš„ç»éªŒã€‚ä»¥å‰æ¥è§¦è¿‡ Docker ä¼šæ›´å¥½ï¼Œä½†ä¸æ˜¯å¿…éœ€çš„ã€‚æ‚¨è¿˜åº”è¯¥æ‹¥æœ‰ä¸€ä¸ª Git å®¢æˆ·ç«¯å’Œä¸€ä¸ª GitHub å¸æˆ·ï¼Œä»¥ä¾¿è·Ÿéšå¹¶å¤åˆ¶æœ¬æ•™ç¨‹çš„æ­¥éª¤ã€‚\næ³¨æ„ï¼šæœ¬æ•™ç¨‹å¤§è‡´åŸºäºåä¸º Docker in Action - Fitter, Happier, More Productive çš„æ—§æ•™ç¨‹ï¼Œè¯¥æ•™ç¨‹ç”± Michael Herman ç¼–å†™ï¼Œä»–äº 2015 å¹´ 2 æœˆ 8 æ—¥åœ¨ PyTennessee å±•ç¤ºäº†ä»–çš„ CI å·¥ä½œæµç¨‹ã€‚å¦‚æœä½ æœ‰å…´è¶£ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å±•ç¤ºçš„ç›¸åº”å¹»ç¯ç‰‡åœ¨ä¼šè®®ä¸Šã€‚\nä¸å¹¸çš„æ˜¯ï¼ŒåŸå§‹æ•™ç¨‹ä¸­æè¿°çš„è®¸å¤šå·¥å…·ä¸å†å—æ”¯æŒæˆ–å…è´¹æä¾›ã€‚åœ¨æ­¤æ›´æ–°çš„æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†ä½¿ç”¨æœ€æ–°çš„å·¥å…·å’ŒæŠ€æœ¯ï¼Œä¾‹å¦‚ GitHub Actionsã€‚","title":"[è¯‘]Build Robust Continuous Integration With Docker and Friends"},{"content":"æœ¬æ–‡ä¸»è¦ä»‹ç» Abstract Document æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nJava Design Patterns æä¾›äº†å„ç§ Java è®¾è®¡æ¨¡å¼çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ã€‚è¯¥ç½‘ç«™æ—¨åœ¨å¸®åŠ© Java å¼€å‘äººå‘˜äº†è§£å’Œåº”ç”¨å„ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚\nJava Design Patterns ç½‘ç«™æä¾›äº†å¤šç§è®¾è®¡æ¨¡å¼åˆ†ç±»æ–¹å¼ï¼ŒåŒ…æ‹¬åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational Patternsï¼‰ã€ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternsï¼‰å’Œè¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰ï¼Œä»¥åŠå…¶ä»–ä¸€äº›å¸¸è§çš„æ¨¡å¼ã€‚\nå¯¹äºæ¯ä¸ªè®¾è®¡æ¨¡å¼ï¼Œè¯¥ç½‘ç«™æä¾›äº†è¯¦ç»†çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ï¼Œå¹¶ä¸”æä¾›äº†ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ã€‚å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©é€‚åˆè‡ªå·±çš„è®¾è®¡æ¨¡å¼ï¼Œå¹¶ä¸”å¯ä»¥å‚è€ƒç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜æ¥ç†è§£å’Œåº”ç”¨è¯¥æ¨¡å¼ã€‚\næ­¤å¤–ï¼ŒJava Design Patterns ç½‘ç«™è¿˜æä¾›äº†ä¸€äº›å…¶ä»–èµ„æºï¼Œå¦‚è®¾è®¡æ¨¡å¼çš„ UML å›¾ã€è®¾è®¡æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ã€è®¾è®¡æ¨¡å¼çš„æ¯”è¾ƒç­‰ã€‚è¿™äº›èµ„æºå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨è®¾è®¡æ¨¡å¼ã€‚\nä¸­æ–‡ç½‘ç«™ï¼šhttps://java-design-patterns.com/zh/\nGithub ä¸Šæºç ä»“åº“ï¼ˆéå®˜æ–¹ï¼‰ï¼šhttps://github.com/iluwatar/java-design-patterns\nç›®çš„ ä½¿ç”¨åŠ¨æ€å±æ€§ï¼Œå¹¶åœ¨ä¿æŒç±»å‹å®‰å…¨çš„åŒæ—¶å®ç°éç±»å‹åŒ–è¯­è¨€çš„çµæ´»æ€§ã€‚\næŠ½è±¡æ–‡æ¡£æ¨¡å¼ä¸­çš„å±æ€§å¯¹è±¡å¯ä»¥åŠ¨æ€æ·»åŠ å’Œåˆ é™¤å±æ€§ï¼Œå¹¶ä¸”å±æ€§ç±»å‹æ˜¯åœ¨è¿è¡Œæ—¶ç¡®å®šçš„ï¼Œè¿™ä½¿å¾—æŠ½è±¡æ–‡æ¡£æ¨¡å¼å…·æœ‰ä¸€å®šçš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚\nåœ¨æŠ½è±¡æ–‡æ¡£æ¨¡å¼ä¸­ï¼Œå±æ€§å¯¹è±¡é€šå¸¸ä½¿ç”¨ Map æˆ–è€… List ç­‰æ•°æ®ç»“æ„æ¥å®ç°ã€‚åŠ¨æ€å±æ€§çš„æ·»åŠ å’Œåˆ é™¤å¯ä»¥é€šè¿‡ Map çš„ put å’Œ remove æ–¹æ³•å®ç°ï¼Œè€Œå±æ€§çš„ç±»å‹å¯ä»¥é€šè¿‡æ³›å‹æ¥ç¡®å®šã€‚\nè§£é‡Š æŠ½è±¡æ–‡æ¡£æ¨¡å¼ä½¿æ‚¨èƒ½å¤Ÿå¤„ç†å…¶ä»–éé™æ€å±æ€§ã€‚ æ­¤æ¨¡å¼ä½¿ç”¨ç‰¹å¾çš„æ¦‚å¿µæ¥å®ç°ç±»å‹å®‰å…¨ï¼Œå¹¶å°†ä¸åŒç±»çš„å±æ€§åˆ†ç¦»ä¸ºä¸€ç»„æ¥å£ã€‚\nçœŸå®ä¸–ç•Œä¾‹å­\nè€ƒè™‘ç”±å¤šä¸ªéƒ¨åˆ†ç»„æˆçš„æ±½è½¦ã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸çŸ¥é“ç‰¹å®šæ±½è½¦æ˜¯å¦çœŸçš„æ‹¥æœ‰æ‰€æœ‰é›¶ä»¶ï¼Œæˆ–è€…ä»…ä»…æ˜¯é›¶ä»¶ä¸­çš„ä¸€éƒ¨åˆ†ã€‚ æˆ‘ä»¬çš„æ±½è½¦æ˜¯åŠ¨æ€è€Œä¸”éå¸¸çµæ´»çš„ã€‚\né€šä¿—çš„è¯´\næŠ½è±¡æ–‡æ¡£æ¨¡å¼å…è®¸åœ¨å¯¹è±¡ä¸çŸ¥é“çš„æƒ…å†µä¸‹å°†å±æ€§é™„åŠ åˆ°å¯¹è±¡ã€‚\nç»´åŸºç™¾ç§‘è¯´\né¢å‘å¯¹è±¡çš„ç»“æ„è®¾è®¡æ¨¡å¼ï¼Œç”¨äºç»„ç»‡æ¾æ•£ç±»å‹çš„é”®å€¼å­˜å‚¨ä¸­çš„å¯¹è±¡å¹¶ä½¿ç”¨ç±»å‹åŒ–çš„è§†å›¾å…¬å¼€æ•°æ®ã€‚ è¯¥æ¨¡å¼çš„ç›®çš„æ˜¯åœ¨å¼ºç±»å‹è¯­è¨€ä¸­å®ç°ç»„ä»¶ä¹‹é—´çš„é«˜åº¦çµæ´»æ€§ï¼Œåœ¨è¿™ç§è¯­è¨€ä¸­ï¼Œå¯ä»¥åœ¨ä¸ä¸¢å¤±ç±»å‹å®‰å…¨æ”¯æŒçš„æƒ…å†µä¸‹ï¼Œå°†æ–°å±æ€§åŠ¨æ€åœ°æ·»åŠ åˆ°å¯¹è±¡æ ‘ä¸­ã€‚ è¯¥æ¨¡å¼åˆ©ç”¨ç‰¹å¾å°†ç±»çš„ä¸åŒå±æ€§åˆ†æˆä¸åŒçš„æ¥å£ã€‚\nç¨‹åºç¤ºä¾‹\nè®©æˆ‘ä»¬é¦–å…ˆå®šä¹‰åŸºç±»Documentå’ŒAbstractDocumentã€‚ å®ƒä»¬åŸºæœ¬ä¸Šä½¿å¯¹è±¡æ‹¥æœ‰å±æ€§æ˜ å°„å’Œä»»æ„æ•°é‡çš„å­å¯¹è±¡ã€‚\nä»¥ä¸‹ä»£ç åœ¨ java 8 ä¸­ç¼–è¯‘æ­£å¸¸ã€‚\nDocument æ¥å£ï¼š\npublic interface Document { Void put(String key, Object value); Object get(String key); \u0026lt;T\u0026gt; Stream\u0026lt;T\u0026gt; children(String key, Function\u0026lt;Map\u0026lt;String, Object\u0026gt;, T\u0026gt; constructor); } ä»¥ä¸‹æ¥å£ä¸ä½¿ç”¨ Java 8 çš„ Stream APIï¼š\npublic interface Document { Object get(String key); void put(String key, Object value); List\u0026lt;Document\u0026gt; children(String key); } AbstractDocument æŠ½è±¡ç±»ï¼š\npublic abstract class AbstractDocument implements Document { private final Map\u0026lt;String, Object\u0026gt; properties; protected AbstractDocument(Map\u0026lt;String, Object\u0026gt; properties) { Objects.requireNonNull(properties, \u0026#34;properties map is required\u0026#34;); this.properties = properties; } @Override public Void put(String key, Object value) { properties.put(key, value); return null; } @Override public Object get(String key) { return properties.get(key); } @Override public \u0026lt;T\u0026gt; Stream\u0026lt;T\u0026gt; children(String key, Function\u0026lt;Map\u0026lt;String, Object\u0026gt;, T\u0026gt; constructor) { // java 9 //\treturn Stream.ofNullable(get(key)) //\t.filter(Objects::nonNull) //\t.map(el -\u0026gt; (List\u0026lt;Map\u0026lt;String, Object\u0026gt;\u0026gt;) el) //\t.findAny() //\t.stream() //\t.flatMap(Collection::stream) //\t.map(constructor); // java 8 return Optional.ofNullable(get(key)) .filter(el -\u0026gt; el instanceof List\u0026lt;?\u0026gt;) .map(el -\u0026gt; (List\u0026lt;Map\u0026lt;String, Object\u0026gt;\u0026gt;) el) .map(List::stream) .orElseGet(Stream::empty) .map(constructor); } @Override public String toString() { return properties.toString(); } } æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæšä¸¾â€œå±æ€§â€å’Œä¸€ç»„ç±»å‹ï¼Œä»·æ ¼ï¼Œæ¨¡å‹å’Œé›¶ä»¶çš„æ¥å£ã€‚ è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿä¸º Car ç±»åˆ›å»ºé™æ€å¤–è§‚çš„ç•Œé¢ã€‚\npublic enum Property { PARTS, TYPE, PRICE, MODEL } public interface HasType extends Document { default Optional\u0026lt;String\u0026gt; getType() { return Optional.ofNullable((String) get(Property.TYPE.toString())); } } public interface HasPrice extends Document { default Optional\u0026lt;Number\u0026gt; getPrice() { return Optional.ofNullable((Number) get(Property.PRICE.toString())); } } public interface HasModel extends Document { default Optional\u0026lt;String\u0026gt; getModel() { return Optional.ofNullable((String) get(Property.MODEL.toString())); } } public interface HasParts extends Document { default Stream\u0026lt;Part\u0026gt; getParts() { return children(Property.PARTS.toString(), Part::new); } } public class Part extends AbstractDocument implements HasType, HasModel, HasPrice { public Part(Map\u0026lt;String, Object\u0026gt; properties) { super(properties); } } ç°åœ¨æˆ‘ä»¬å‡†å¤‡ä»‹ç» Carã€‚\npublic class Car extends AbstractDocument implements HasModel, HasPrice, HasParts { public Car(Map\u0026lt;String, Object\u0026gt; properties) { super(properties); } } æœ€åæ˜¯å®Œæ•´ç¤ºä¾‹ä¸­çš„Caræ„é€ å’Œä½¿ç”¨æ–¹å¼ã€‚\n@Slf4j public class App { /** * Program entry point. * * @param args command line args */ public static void main(String[] args) { log.info(\u0026#34;Constructing parts and car\u0026#34;); Map\u0026lt;String, Object\u0026gt; wheelProperties = ImmutableMap.of( Property.TYPE.toString(), \u0026#34;wheel\u0026#34;, Property.MODEL.toString(), \u0026#34;15C\u0026#34;, Property.PRICE.toString(), 100L); Map\u0026lt;String, Object\u0026gt; doorProperties = ImmutableMap.of( Property.TYPE.toString(), \u0026#34;door\u0026#34;, Property.MODEL.toString(), \u0026#34;Lambo\u0026#34;, Property.PRICE.toString(), 300L); Map\u0026lt;String, Object\u0026gt; carProperties = ImmutableMap.of( Property.MODEL.toString(), \u0026#34;300SL\u0026#34;, Property.PRICE.toString(), 10000L, Property.PARTS.toString(), ImmutableList.of(wheelProperties, doorProperties)); Car car = new Car(carProperties); log.info(\u0026#34;Here is our car:\u0026#34;); log.info(\u0026#34;-\u0026gt; model: {}\u0026#34;, car.getModel().orElse(null)); log.info(\u0026#34;-\u0026gt; price: {}\u0026#34;, car.getPrice().orElse(null)); log.info(\u0026#34;-\u0026gt; parts: \u0026#34;); car.getParts().forEach(p -\u0026gt; log.info(\u0026#34;\\t{}/{}/{}\u0026#34;, p.getType().orElse(null), p.getModel().orElse(null), p.getPrice().orElse(null)) ); } } å†æ¥ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼š\npublic class Person extends AbstractDocument{ public Person() { super(Map.of( \u0026#34;name\u0026#34;, \u0026#34;John Doe\u0026#34;, \u0026#34;age\u0026#34;, 30, \u0026#34;hobbies\u0026#34;, List.of(\u0026#34;Sports\u0026#34;, \u0026#34;Music\u0026#34;)); } } @Slf4j public class PersonApp { public static void main(String[] args) { Person person = new Person(); log.info(\u0026#34;name: {}\u0026#34;, person.get(\u0026#34;name\u0026#34;)); log.info(\u0026#34;age: {}\u0026#34;, person.get(\u0026#34;age\u0026#34;)); log.info(\u0026#34;hobbies: {}\u0026#34;, person.get(\u0026#34;hobbies\u0026#34;)); } } ç±»å›¾ é€‚ç”¨æ€§ ä½¿ç”¨æŠ½è±¡æ–‡æ¡£æ¨¡å¼ï¼Œå½“\néœ€è¦å³æ—¶æ·»åŠ æ–°å±æ€§ ä½ æƒ³è¦ä¸€ç§çµæ´»çš„æ–¹å¼æ¥ä»¥æ ‘çŠ¶ç»“æ„ç»„ç»‡åŸŸ ä½ æƒ³è¦æ›´å®½æ¾çš„è€¦åˆç³»ç»Ÿ ä¸‹é¢æ˜¯æŠ½è±¡æ–‡æ¡£æ¨¡å¼çš„ä¸€äº›å®é™…åº”ç”¨ï¼š\n1ã€XML å’Œ JSON è§£æ æŠ½è±¡æ–‡æ¡£æ¨¡å¼å¯ä»¥ç”¨äºè§£æ XML å’Œ JSON æ•°æ®ã€‚ç”±äº XML å’Œ JSON æ•°æ®é€šå¸¸åŒ…å«åŠ¨æ€å±æ€§ï¼Œå› æ­¤æŠ½è±¡æ–‡æ¡£æ¨¡å¼å¯ä»¥æä¾›ä¸€ç§çµæ´»çš„æ–¹å¼æ¥å¤„ç†è¿™äº›æ•°æ®ã€‚é€šè¿‡å°† XML æˆ– JSON æ•°æ®æ˜ å°„åˆ°æ–‡æ¡£å’Œå±æ€§å¯¹è±¡ï¼Œå¯ä»¥è½»æ¾åœ°è®¿é—®å’Œä¿®æ”¹è¿™äº›æ•°æ®ã€‚\nXML è§£æ å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„ XML æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\n\u0026lt;bookstore\u0026gt; \u0026lt;book category=\u0026#34;cooking\u0026#34;\u0026gt; \u0026lt;title lang=\u0026#34;en\u0026#34;\u0026gt;Everyday Italian\u0026lt;/title\u0026gt; \u0026lt;author\u0026gt;Giada De Laurentiis\u0026lt;/author\u0026gt; \u0026lt;year\u0026gt;2005\u0026lt;/year\u0026gt; \u0026lt;price\u0026gt;30.00\u0026lt;/price\u0026gt; \u0026lt;/book\u0026gt; \u0026lt;book category=\u0026#34;children\u0026#34;\u0026gt; \u0026lt;title lang=\u0026#34;en\u0026#34;\u0026gt;Harry Potter\u0026lt;/title\u0026gt; \u0026lt;author\u0026gt;J.K. Rowling\u0026lt;/author\u0026gt; \u0026lt;year\u0026gt;2003\u0026lt;/year\u0026gt; \u0026lt;price\u0026gt;29.99\u0026lt;/price\u0026gt; \u0026lt;/book\u0026gt; \u0026lt;/bookstore\u0026gt; æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æŠ½è±¡æ–‡æ¡£æ¨¡å¼æ¥è§£æè¿™ä¸ª XML æ–‡ä»¶ï¼Œé¦–å…ˆå®šä¹‰ä¸€ä¸ªDocumentæ¥å£ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\npublic interface Document { Object get(String key); void put(String key, Object value); List\u0026lt;Document\u0026gt; children(String key); } ç„¶åå®šä¹‰ä¸€ä¸ªå…·ä½“çš„ XML æ–‡æ¡£ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\npublic class XmlDocument implements Document { private final Element element; public XmlDocument(Element element) { this.element = element} @Override public Object get(String key) { return element.getAttribute(key); } @Override public void put(String key, Object value) { element.setAttribute(key, value.toString()); } @Override public List\u0026lt;Document\u0026gt; children(String key) { NodeList nodes = element.getElementsByTagName(key); List\u0026lt;Document\u0026gt; children = new ArrayList\u0026lt;\u0026gt;(); for (int i = 0; i \u0026lt; nodes.getLength(); i++) { children.add(new XmlDocument((Element) nodes.item(i))); } return children; } } åœ¨è¿™ä¸ªå…·ä½“çš„ XML æ–‡æ¡£ç±»ä¸­ï¼Œæˆ‘ä»¬å®ç°äº†Documentæ¥å£çš„ä¸‰ä¸ªæ–¹æ³•ï¼Œå…¶ä¸­childrenæ–¹æ³•ä½¿ç”¨äº† DOM API æ¥è·å–å­å…ƒç´ åˆ—è¡¨ï¼Œå¹¶å°†æ¯ä¸ªå­å…ƒç´ åŒ…è£…æˆä¸€ä¸ªæ–°çš„XmlDocumentå¯¹è±¡ã€‚\nç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªå…·ä½“çš„ XML æ–‡æ¡£ç±»æ¥è§£æ XML æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nDocumentBuilderFactory dbFactory = DocumentBuilderFactory.newInstance(); DocumentBuilder dBuilder = dbFactory.newDocumentBuilder(); Document doc = new XmlDocument(dBuilder.parse(new File(\u0026#34;books.xml\u0026#34;)).getDocumentElement()); // è·å–æ ¹å…ƒç´ çš„å±æ€§å€¼ String bookstoreCategory = (String) doc.get(\u0026#34;category\u0026#34;); // è·å–æ‰€æœ‰ä¹¦çš„ä¿¡æ¯ List\u0026lt;Document\u0026gt; books = doc.children(\u0026#34;book\u0026#34;); for (Document book : books) { String category = (String)doc.get(\u0026#34;category\u0026#34;); String title = (String) book.children(\u0026#34;title\u0026#34;).get(0).get(\u0026#34;\u0026#34;); String author = (String) book.children(\u0026#34;author\u0026#34;).get(0).get(\u0026#34;\u0026#34;); int year = (int) book.children(\u0026#34;year\u0026#34;).get(0).get(\u0026#34;\u0026#34;); double price = (double) book.children(\u0026#34;price\u0026#34;).get(0).get(\u0026#34;\u0026#34;); System.out.println(\u0026#34;Category: \u0026#34; + category + \u0026#34;, Title: \u0026#34; + title + \u0026#34;, Author: \u0026#34; + author + \u0026#34;, Year: \u0026#34; + year + \u0026#34;, Price: \u0026#34; + price); } JSON è§£æ å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„ JSON æ–‡ä»¶ï¼Œä»¥ä¸‹æ˜¯example.jsonæ–‡ä»¶çš„å†…å®¹ï¼šï¼š\n{ \u0026#34;name\u0026#34;: \u0026#34;John Smith\u0026#34;, \u0026#34;age\u0026#34;: 35, \u0026#34;address\u0026#34;: { \u0026#34;street\u0026#34;: \u0026#34;123 Main St\u0026#34;, \u0026#34;city\u0026#34;: \u0026#34;Anytown\u0026#34;, \u0026#34;state\u0026#34;: \u0026#34;CA\u0026#34;, \u0026#34;zip\u0026#34;: \u0026#34;12345\u0026#34; }, \u0026#34;phone\u0026#34;: [ { \u0026#34;type\u0026#34;: \u0026#34;home\u0026#34;, \u0026#34;number\u0026#34;: \u0026#34;555-1234\u0026#34; }, { \u0026#34;type\u0026#34;: \u0026#34;work\u0026#34;, \u0026#34;number\u0026#34;: \u0026#34;555-5678\u0026#34; } ] } æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æŠ½è±¡æ–‡æ¡£æ¨¡å¼æ¥è§£æè¿™ä¸ª JSON æ–‡ä»¶ï¼Œé¦–å…ˆå®šä¹‰ä¸€ä¸ªDocumentæ¥å£ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\npublic interface Document { Object get(String key); void put(String key, Object value); List\u0026lt;Document\u0026gt; children(String key); } ç„¶åå®šä¹‰ä¸€ä¸ªå…·ä½“çš„ JSON æ–‡æ¡£ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nimport com.google.gson.*; import java.util.ArrayList; import java.util.List; public class JsonDocument implements Document { private final JsonObject object; public JsonDocument(JsonObject object) { this.object = object; } @Override public Object get(String key) { JsonElement element = object.get(key); if (element == null) { return null; } if (element.isJsonPrimitive()) { JsonPrimitive primitive = element.getAsJsonPrimitive(); if (primitive.isNumber()) { return primitive.getAsNumber(); } else if (primitive.isBoolean()) { return primitive.getAsBoolean(); } else { return primitive.getAsString(); } } else if (element.isJsonObject()) { return new JsonDocument(element.getAsJsonObject()); } else if (element.isJsonArray()) { JsonArray array = element.getAsJsonArray(); List\u0026lt;Document\u0026gt; children = new ArrayList\u0026lt;\u0026gt;(); for (JsonElement child : array) { children.add(new JsonDocument(child.getAsJsonObject())); } return children; } else { return null; } } @Override public void put(String key, Object value) { if (value instanceof String) { object.addProperty(key, (String) value); } else if (value instanceof Number) { object.addProperty(key, (Number) value); } else if (value instanceof Boolean) { object.addProperty(key, (Boolean) value); } else if (value instanceof Document) { JsonDocument jsonDocument = (JsonDocument) value; object.add(key, jsonDocument.object); } else if (value instanceof List) { List\u0026lt;Document\u0026gt; children = (List\u0026lt;Document\u0026gt;) value; JsonArray array = new JsonArray(); for (Document child : children) { JsonDocument jsonChild = (JsonDocument) child; array.add(jsonChild.object); } object.add(key, array); } } @Override public List\u0026lt;Document\u0026gt; children(String key) { JsonElement element = object.get(key); List\u0026lt;Document\u0026gt; children = new ArrayList\u0026lt;\u0026gt;(); if (element != null \u0026amp;\u0026amp; element.isJsonArray()) { JsonArray array = element.getAsJsonArray(); for (JsonElement child : array) { children.add(new JsonDocument(child.getAsJsonObject())); } } return children; } } ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªå…·ä½“çš„ JSON æ–‡æ¡£ç±»æ¥è§£æ JSON æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\npublic class JsonParsingExample { public static void main(String[] args) { try { // è¯»å–JSONæ–‡ä»¶å¹¶è§£æ Gson gson = new Gson(); JsonElement jsonElement = gson.fromJson(new FileReader(\u0026#34;example.json\u0026#34;), JsonElement.class); JsonDocument doc = new JsonDocument(jsonElement.getAsJsonObject()); // è·å–æ ¹å…ƒç´ çš„å±æ€§å€¼ String name = (String) doc.get(\u0026#34;name\u0026#34;); int age = (int) doc.get(\u0026#34;age\u0026#34;); // è·å–åœ°å€ JsonDocument address = (JsonDocument) doc.get(\u0026#34;address\u0026#34;); String street = (String) address.get(\u0026#34;street\u0026#34;); String city = (String) address.get(\u0026#34;city\u0026#34;); String state = (String) address.get(\u0026#34;state\u0026#34;); String zip = (String) address.get(\u0026#34;zip\u0026#34;); // è·å–ç”µè¯å·ç  List\u0026lt;Document\u0026gt; phoneList = doc.children(\u0026#34;phone\u0026#34;); for (Document phone : phoneList) { String type = (String) phone.get(\u0026#34;type\u0026#34;); String number = (String) phone.get(\u0026#34;number\u0026#34;); System.out.println(type + \u0026#34;: \u0026#34; + number); } } catch (Exception e) { e.printStackTrace(); } } } 2ã€åŠ¨æ€é…ç½® æŠ½è±¡æ–‡æ¡£æ¨¡å¼å¯ä»¥ç”¨äºåŠ¨æ€é…ç½®ã€‚é€šè¿‡å°†é…ç½®æ•°æ®æ˜ å°„åˆ°æ–‡æ¡£å’Œå±æ€§å¯¹è±¡ï¼Œå¯ä»¥è½»æ¾åœ°è®¿é—®å’Œä¿®æ”¹é…ç½®æ•°æ®ã€‚æ­¤å¤–ï¼Œç”±äºæŠ½è±¡æ–‡æ¡£æ¨¡å¼æ”¯æŒåŠ¨æ€å±æ€§ï¼Œå› æ­¤å¯ä»¥åœ¨è¿è¡Œæ—¶æ·»åŠ æˆ–åˆ é™¤å±æ€§ï¼Œä»è€Œä½¿é…ç½®æ›´åŠ çµæ´»ã€‚\nå‡è®¾æœ‰ä¸€ä¸ªå­¦ç”Ÿä¿¡æ¯ç®¡ç†ç³»ç»Ÿï¼Œéœ€è¦å­˜å‚¨å’Œæ£€ç´¢å­¦ç”Ÿä¿¡æ¯ã€‚å­¦ç”Ÿä¿¡æ¯åŒ…æ‹¬å­¦ç”Ÿå§“åã€å­¦ç”Ÿå¹´é¾„ã€å­¦ç”Ÿæ€§åˆ«ã€å­¦ç”Ÿå®¶åº­åœ°å€ç­‰å±æ€§ã€‚ç”±äºå­¦ç”Ÿå±æ€§å¯èƒ½ä¼šéšæ—¶å˜åŒ–ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ä¸€ç§çµæ´»çš„æ–¹å¼æ¥å¤„ç†è¿™äº›å±æ€§ï¼Œå¹¶ä¸”éœ€è¦è½»æ¾åœ°è®¿é—®å’Œä¿®æ”¹è¿™äº›å±æ€§ã€‚\nä¸ºäº†å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨æŠ½è±¡æ–‡æ¡£æ¨¡å¼ã€‚å®šä¹‰ä¸€ä¸ªå­¦ç”Ÿæ–‡æ¡£ç±»ï¼ˆStudentDocumentï¼‰ï¼Œè¯¥ç±»åŒ…å«å­¦ç”Ÿå±æ€§çš„è®¿é—®å™¨å’Œä¿®æ”¹å™¨æ–¹æ³•ï¼Œå¹¶ä¸”æ”¯æŒåŠ¨æ€å±æ€§ã€‚ç„¶åï¼Œå®šä¹‰ä¸€ä¸ªå­¦ç”Ÿå±æ€§ç±»ï¼ˆPropertyï¼‰ï¼Œè¯¥ç±»åŒ…å«å±æ€§åç§°ã€å±æ€§ç±»å‹å’Œå±æ€§å€¼ç­‰å±æ€§ï¼Œå¹¶ä¸”æ”¯æŒåŠ¨æ€å±æ€§ã€‚æœ€åï¼Œä½¿ç”¨ä¸€ä¸ªæ„å»ºå™¨ï¼ˆBuilderï¼‰ç±»æ¥åˆ›å»ºå…·ä½“çš„å­¦ç”Ÿæ–‡æ¡£å¯¹è±¡ï¼Œå¹¶å°†å­¦ç”Ÿå±æ€§æ·»åŠ åˆ°æ–‡æ¡£ä¸­ã€‚\nç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š\nimport java.util.ArrayList; import java.util.List; public class Property { private String name; private Object value; public Property(String name, Object value) { this.name = name; this.value = value; } public String getName() { return name; } public Object getValue() { return value; } public void setValue(Object value) { this.value = value; } } public abstract class Document { private List\u0026lt;Property\u0026gt; properties = new ArrayList\u0026lt;\u0026gt;(); public Object getProperty(String name) { for (Property property : properties) { if (property.getName().equals(name)) { return property.getValue(); } } return null; } public void setProperty(String name, Object value) { for (Property property : properties) { if (property.getName().equals(name)) { property.setValue(value); return; } } properties.add(new Property(name, value)); } } public class StudentDocument extends Document { public String getName() { return (String) getProperty(\u0026#34;name\u0026#34;); } public void setName(String name) { setProperty(\u0026#34;name\u0026#34;, name); } public int getAge() { return (int) getProperty(\u0026#34;age\u0026#34;); } public void setAge(int age) { setProperty(\u0026#34;age\u0026#34;, age); } public String getGender() { return (String) getProperty(\u0026#34;gender\u0026#34;); } public void setGender(String gender) { setProperty(\u0026#34;gender\u0026#34;, gender); } public String getAddress() { return (String) getProperty(\u0026#34;address\u0026#34;); } public void setAddress(Stringaddress) { setProperty(\u0026#34;address\u0026#34;, address); } } public class StudentBuilder { private StudentDocument student = new StudentDocument(); public void setName(String name) { student.setName(name); } public void setAge(int age) { student.setAge(age); } public void setGender(String gender) { student.setGender(gender); } public void setAddress(String address) { student.setAddress(address); } public StudentDocument build() { return student; } } ä½¿ç”¨æŠ½è±¡æ–‡æ¡£æ¨¡å¼ï¼Œå¯ä»¥è½»æ¾åœ°è®¿é—®å’Œä¿®æ”¹å­¦ç”Ÿå±æ€§ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nStudentBuilder builder = new StudentBuilder(); builder.setName(\u0026#34;Tom\u0026#34;); builder.setAge(18); builder.setGender(\u0026#34;Male\u0026#34;); builder.setAddress(\u0026#34;Beijing\u0026#34;); StudentDocument student = builder.build(); System.out.println(student.getName()); // è¾“å‡ºï¼šTom student.setAddress(\u0026#34;Shanghai\u0026#34;); System.out.println(student.getAddress()); // è¾“å‡ºï¼šShanghai student.setProperty(\u0026#34;phoneNumber\u0026#34;, \u0026#34;1234567890\u0026#34;); System.out.println(student.getProperty(\u0026#34;phoneNumber\u0026#34;)); // è¾“å‡ºï¼š1234567890 3ã€ä¸šåŠ¡è§„åˆ™å¼•æ“ æŠ½è±¡æ–‡æ¡£æ¨¡å¼å¯ä»¥ç”¨äºå®ç°ä¸šåŠ¡è§„åˆ™å¼•æ“ã€‚é€šè¿‡å°†è§„åˆ™æ•°æ®æ˜ å°„åˆ°æ–‡æ¡£å’Œå±æ€§å¯¹è±¡ï¼Œå¯ä»¥è½»æ¾åœ°è®¿é—®å’Œä¿®æ”¹è§„åˆ™æ•°æ®ã€‚æ­¤å¤–ï¼Œç”±äºæŠ½è±¡æ–‡æ¡£æ¨¡å¼æ”¯æŒåŠ¨æ€å±æ€§ï¼Œå› æ­¤å¯ä»¥åœ¨è¿è¡Œæ—¶æ·»åŠ æˆ–åˆ é™¤è§„åˆ™ï¼Œä»è€Œä½¿è§„åˆ™å¼•æ“æ›´åŠ çµæ´»ã€‚\nå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„ä¸šåŠ¡è§„åˆ™ï¼Œç”¨äºç¡®å®šç”¨æˆ·æ˜¯å¦æœ‰èµ„æ ¼è·å¾—æŸé¡¹å¥–åŠ±ã€‚è¿™ä¸ªè§„åˆ™å¯èƒ½æ¶‰åŠåˆ°å¤šä¸ªæ¡ä»¶ï¼Œä¾‹å¦‚ç”¨æˆ·çš„å¹´é¾„ã€æ‰€åœ¨åœ°åŒºä»¥åŠè´­ç‰©é‡‘é¢ç­‰ã€‚\næˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªè§„åˆ™è¡¨ç¤ºä¸ºä¸€ä¸ªæ–‡æ¡£ï¼Œä¾‹å¦‚ä¸€ä¸ª JSON æ–‡æ¡£ï¼Œå…¶ä¸­æ¯ä¸ªå±æ€§å¯¹åº”ä¸€ä¸ªè§„åˆ™æ¡ä»¶ã€‚ä¾‹å¦‚ï¼š\n{ \u0026#34;age\u0026#34;: { \u0026#34;operator\u0026#34;: \u0026#34;\u0026gt;=\u0026#34;, \u0026#34;value\u0026#34;: 18 }, \u0026#34;region\u0026#34;: { \u0026#34;operator\u0026#34;: \u0026#34;in\u0026#34;, \u0026#34;value\u0026#34;: [\u0026#34;east\u0026#34;, \u0026#34;south\u0026#34;] }, \u0026#34;amount\u0026#34;: { \u0026#34;operator\u0026#34;: \u0026#34;\u0026gt;=\u0026#34;, \u0026#34;value\u0026#34;: 1000 } } ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æŠ½è±¡æ–‡æ¡£æ¨¡å¼æ¥è§£æè¿™ä¸ªæ–‡æ¡£ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªè§„åˆ™å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸ºRuleçš„ç±»ï¼Œå®ƒåŒ…å«ä¸‰ä¸ªå±æ€§ï¼š\npublic class Rule { private final String key; private final String operator; private final Object value; private final Object secondValue; public Rule(String key, String operator, Object value) { this(key, operator, value, null); } public Rule(String key, String operator, Object value, Object secondValue) { this.key = key; this.operator = operator; this.value = value; this.secondValue = secondValue; } public boolean evaluate(Document document) { Object documentValue = document.get(key); if (documentValue == null) { return false; } switch (operator) { case \u0026#34;\u0026gt;=\u0026#34;: return compare(documentValue, value) \u0026gt;= 0; case \u0026#34;\u0026lt;=\u0026#34;: return compare(documentValue, value) \u0026lt;= 0; case \u0026#34;\u0026gt;\u0026#34;: return compare(documentValue, value) \u0026gt; 0; case \u0026#34;\u0026lt;\u0026#34;: return compare(documentValue, value) \u0026lt; 0; case \u0026#34;==\u0026#34;: return compare(documentValue,value) == 0; case \u0026#34;!=\u0026#34;: return compare(documentValue, value) != 0; case \u0026#34;in\u0026#34;: if (value instanceof List) { List\u0026lt;?\u0026gt; listValue = (List\u0026lt;?\u0026gt;) value; for (Object item : listValue) { if (compare(documentValue, item) == 0) { return true; } } } return false; case \u0026#34;not in\u0026#34;: boolean found=false; if (value instanceof List) { List\u0026lt;?\u0026gt; listValue = (List\u0026lt;?\u0026gt;) value; for (Object item : listValue) { if (compare(documentValue, item) == 0) { found=true; break; } } } return !found; case \u0026#34;between\u0026#34;: if (secondValue == null) { return false; } int cmp1 = compare(documentValue, value); int cmp2 = compare(documentValue, secondValue); return cmp1 \u0026gt;= 0 \u0026amp;\u0026amp; cmp2 \u0026lt;= 0; case \u0026#34;not between\u0026#34;: if (secondValue == null) { return false; } int cmp1 = compare(documentValue, value); int cmp2 = compare(documentValue, secondValue); return cmp1 \u0026lt; 0 || cmp2 \u0026gt; 0; case \u0026#34;regex\u0026#34;: if (documentValue instanceof String \u0026amp;\u0026amp; value instanceof String) { String strValue = (String) value; String strDocumentValue = (String) documentValue; return strDocumentValue.matches(strValue); } return false; case \u0026#34;startswith\u0026#34;: if(documentValue instanceof String \u0026amp;\u0026amp; value instanceof String) { String strValue = (String) value; String strDocumentValue = (String) documentValue; return strDocumentValue.startsWith(strValue); } return false; case \u0026#34;endswith\u0026#34;: if (documentValue instanceof String \u0026amp;\u0026amp; value instanceof String) { String strValue = (String) value; String strDocumentValue = (String) documentValue; return strDocumentValue.endsWith(strValue); } return false; case \u0026#34;like\u0026#34;: if (documentValue instanceof String \u0026amp;\u0026amp; value instanceof String) { String strValue = (String) value; String strDocumentValue = (String) documentValue; return strDocumentValue.contains(strValue); } return false; case \u0026#34;not like\u0026#34;: if (documentValue instanceof String \u0026amp;\u0026amp; value instanceof String) { String strValue = (String) value; String strDocumentValue = (String) documentValue; return !strDocumentValue.contains(strValue); } return false; default: return false; } } private int compare(Object a, Object b) { if (a instanceof Number \u0026amp;\u0026amp; b instanceof Number) { return Double.compare(((Number) a).doubleValue(), ((Number) b).doubleValue()); } else if (a instanceof String \u0026amp;\u0026amp; b instanceof String) { return ((String) a).compareTo((String) b); } else { return a.toString().compareTo(b.toString()); } } } Ruleç±»æœ‰ä¸€ä¸ªevaluateæ–¹æ³•ï¼Œå®ƒæ¥å—ä¸€ä¸ªDocumentå¯¹è±¡ï¼Œå¹¶æ ¹æ®è§„åˆ™æ¡ä»¶å¯¹æ–‡æ¡£è¿›è¡Œè¯„ä¼°ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸Šé¢çš„è§„åˆ™æ–‡æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸‰ä¸ªRuleå¯¹è±¡ï¼š\nRule ageRule = new Rule(\u0026#34;age\u0026#34;, \u0026#34;between\u0026#34;, 18, 30); Rule regionRule = new Rule(\u0026#34;region\u0026#34;, \u0026#34;in\u0026#34;, Arrays.asList(\u0026#34;east\u0026#34;, \u0026#34;south\u0026#34;)); Rule amountRule = new Rule(\u0026#34;amount\u0026#34;, \u0026#34;\u0026gt;=\u0026#34;, 1000); ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›è§„åˆ™åº”ç”¨äºç”¨æˆ·æ•°æ®ï¼Œä¾‹å¦‚ä¸€ä¸ªå­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„ç”¨æˆ·è®°å½•ã€‚æˆ‘ä»¬å¯ä»¥å°†ç”¨æˆ·æ•°æ®è¡¨ç¤ºä¸ºä¸€ä¸ªæ–‡æ¡£ï¼Œä¾‹å¦‚ä¸€ä¸ª XML æ–‡æ¡£ï¼š\n\u0026lt;user\u0026gt; \u0026lt;name\u0026gt;John Doe\u0026lt;/name\u0026gt; \u0026lt;age\u0026gt;25\u0026lt;/age\u0026gt; \u0026lt;region\u0026gt;east\u0026lt;/region\u0026gt; \u0026lt;amount\u0026gt;1200\u0026lt;/amount\u0026gt; \u0026lt;/user\u0026gt; æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æŠ½è±¡æ–‡æ¡£æ¨¡å¼è§£æè¯¥æ–‡æ¡£å¹¶å°†å…¶è½¬æ¢ä¸ºDocumentå¯¹è±¡ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Ruleå¯¹è±¡å’ŒDocumentå¯¹è±¡æ¥è¯„ä¼°ç”¨æˆ·æ˜¯å¦æœ‰èµ„æ ¼è·å¾—å¥–åŠ±ã€‚ä¾‹å¦‚ï¼š\nDocument userDocument = ... // è§£æç”¨æˆ·æ•°æ®ä¸ºä¸€ä¸ªDocumentå¯¹è±¡ boolean isEligible = ageRule.evaluate(userDocument) \u0026amp;\u0026amp; regionRule.evaluate(userDocument) \u0026amp;\u0026amp; amountRule.evaluate(userDocument); 4ã€æ•°æ®åº“æ˜ å°„ æŠ½è±¡æ–‡æ¡£æ¨¡å¼å¯ä»¥ç”¨äºå°†æ•°æ®åº“æ•°æ®æ˜ å°„åˆ°æ–‡æ¡£å’Œå±æ€§å¯¹è±¡ä¸Šã€‚é€šè¿‡å°†æ•°æ®åº“è¡¨æ˜ å°„åˆ°æ–‡æ¡£å¯¹è±¡ï¼Œå°†è¡¨çš„åˆ—æ˜ å°„åˆ°å±æ€§å¯¹è±¡ï¼Œå¯ä»¥è½»æ¾åœ°è®¿é—®å’Œä¿®æ”¹æ•°æ®åº“æ•°æ®ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/05/22/java-design-patterns-abstract-document/","summary":"æœ¬æ–‡ä¸»è¦ä»‹ç» Abstract Document æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nJava Design Patterns æä¾›äº†å„ç§ Java è®¾è®¡æ¨¡å¼çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ã€‚è¯¥ç½‘ç«™æ—¨åœ¨å¸®åŠ© Java å¼€å‘äººå‘˜äº†è§£å’Œåº”ç”¨å„ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚\nJava Design Patterns ç½‘ç«™æä¾›äº†å¤šç§è®¾è®¡æ¨¡å¼åˆ†ç±»æ–¹å¼ï¼ŒåŒ…æ‹¬åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational Patternsï¼‰ã€ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternsï¼‰å’Œè¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰ï¼Œä»¥åŠå…¶ä»–ä¸€äº›å¸¸è§çš„æ¨¡å¼ã€‚\nå¯¹äºæ¯ä¸ªè®¾è®¡æ¨¡å¼ï¼Œè¯¥ç½‘ç«™æä¾›äº†è¯¦ç»†çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ï¼Œå¹¶ä¸”æä¾›äº†ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ã€‚å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©é€‚åˆè‡ªå·±çš„è®¾è®¡æ¨¡å¼ï¼Œå¹¶ä¸”å¯ä»¥å‚è€ƒç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜æ¥ç†è§£å’Œåº”ç”¨è¯¥æ¨¡å¼ã€‚\næ­¤å¤–ï¼ŒJava Design Patterns ç½‘ç«™è¿˜æä¾›äº†ä¸€äº›å…¶ä»–èµ„æºï¼Œå¦‚è®¾è®¡æ¨¡å¼çš„ UML å›¾ã€è®¾è®¡æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ã€è®¾è®¡æ¨¡å¼çš„æ¯”è¾ƒç­‰ã€‚è¿™äº›èµ„æºå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨è®¾è®¡æ¨¡å¼ã€‚\nä¸­æ–‡ç½‘ç«™ï¼šhttps://java-design-patterns.com/zh/\nGithub ä¸Šæºç ä»“åº“ï¼ˆéå®˜æ–¹ï¼‰ï¼šhttps://github.com/iluwatar/java-design-patterns\nç›®çš„ ä½¿ç”¨åŠ¨æ€å±æ€§ï¼Œå¹¶åœ¨ä¿æŒç±»å‹å®‰å…¨çš„åŒæ—¶å®ç°éç±»å‹åŒ–è¯­è¨€çš„çµæ´»æ€§ã€‚\næŠ½è±¡æ–‡æ¡£æ¨¡å¼ä¸­çš„å±æ€§å¯¹è±¡å¯ä»¥åŠ¨æ€æ·»åŠ å’Œåˆ é™¤å±æ€§ï¼Œå¹¶ä¸”å±æ€§ç±»å‹æ˜¯åœ¨è¿è¡Œæ—¶ç¡®å®šçš„ï¼Œè¿™ä½¿å¾—æŠ½è±¡æ–‡æ¡£æ¨¡å¼å…·æœ‰ä¸€å®šçš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚\nåœ¨æŠ½è±¡æ–‡æ¡£æ¨¡å¼ä¸­ï¼Œå±æ€§å¯¹è±¡é€šå¸¸ä½¿ç”¨ Map æˆ–è€… List ç­‰æ•°æ®ç»“æ„æ¥å®ç°ã€‚åŠ¨æ€å±æ€§çš„æ·»åŠ å’Œåˆ é™¤å¯ä»¥é€šè¿‡ Map çš„ put å’Œ remove æ–¹æ³•å®ç°ï¼Œè€Œå±æ€§çš„ç±»å‹å¯ä»¥é€šè¿‡æ³›å‹æ¥ç¡®å®šã€‚\nè§£é‡Š æŠ½è±¡æ–‡æ¡£æ¨¡å¼ä½¿æ‚¨èƒ½å¤Ÿå¤„ç†å…¶ä»–éé™æ€å±æ€§ã€‚ æ­¤æ¨¡å¼ä½¿ç”¨ç‰¹å¾çš„æ¦‚å¿µæ¥å®ç°ç±»å‹å®‰å…¨ï¼Œå¹¶å°†ä¸åŒç±»çš„å±æ€§åˆ†ç¦»ä¸ºä¸€ç»„æ¥å£ã€‚\nçœŸå®ä¸–ç•Œä¾‹å­\nè€ƒè™‘ç”±å¤šä¸ªéƒ¨åˆ†ç»„æˆçš„æ±½è½¦ã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸çŸ¥é“ç‰¹å®šæ±½è½¦æ˜¯å¦çœŸçš„æ‹¥æœ‰æ‰€æœ‰é›¶ä»¶ï¼Œæˆ–è€…ä»…ä»…æ˜¯é›¶ä»¶ä¸­çš„ä¸€éƒ¨åˆ†ã€‚ æˆ‘ä»¬çš„æ±½è½¦æ˜¯åŠ¨æ€è€Œä¸”éå¸¸çµæ´»çš„ã€‚\né€šä¿—çš„è¯´\næŠ½è±¡æ–‡æ¡£æ¨¡å¼å…è®¸åœ¨å¯¹è±¡ä¸çŸ¥é“çš„æƒ…å†µä¸‹å°†å±æ€§é™„åŠ åˆ°å¯¹è±¡ã€‚\nç»´åŸºç™¾ç§‘è¯´\né¢å‘å¯¹è±¡çš„ç»“æ„è®¾è®¡æ¨¡å¼ï¼Œç”¨äºç»„ç»‡æ¾æ•£ç±»å‹çš„é”®å€¼å­˜å‚¨ä¸­çš„å¯¹è±¡å¹¶ä½¿ç”¨ç±»å‹åŒ–çš„è§†å›¾å…¬å¼€æ•°æ®ã€‚ è¯¥æ¨¡å¼çš„ç›®çš„æ˜¯åœ¨å¼ºç±»å‹è¯­è¨€ä¸­å®ç°ç»„ä»¶ä¹‹é—´çš„é«˜åº¦çµæ´»æ€§ï¼Œåœ¨è¿™ç§è¯­è¨€ä¸­ï¼Œå¯ä»¥åœ¨ä¸ä¸¢å¤±ç±»å‹å®‰å…¨æ”¯æŒçš„æƒ…å†µä¸‹ï¼Œå°†æ–°å±æ€§åŠ¨æ€åœ°æ·»åŠ åˆ°å¯¹è±¡æ ‘ä¸­ã€‚ è¯¥æ¨¡å¼åˆ©ç”¨ç‰¹å¾å°†ç±»çš„ä¸åŒå±æ€§åˆ†æˆä¸åŒçš„æ¥å£ã€‚\nç¨‹åºç¤ºä¾‹\nè®©æˆ‘ä»¬é¦–å…ˆå®šä¹‰åŸºç±»Documentå’ŒAbstractDocumentã€‚ å®ƒä»¬åŸºæœ¬ä¸Šä½¿å¯¹è±¡æ‹¥æœ‰å±æ€§æ˜ å°„å’Œä»»æ„æ•°é‡çš„å­å¯¹è±¡ã€‚\nä»¥ä¸‹ä»£ç åœ¨ java 8 ä¸­ç¼–è¯‘æ­£å¸¸ã€‚\nDocument æ¥å£ï¼š\npublic interface Document { Void put(String key, Object value); Object get(String key); \u0026lt;T\u0026gt; Stream\u0026lt;T\u0026gt; children(String key, Function\u0026lt;Map\u0026lt;String, Object\u0026gt;, T\u0026gt; constructor); } ä»¥ä¸‹æ¥å£ä¸ä½¿ç”¨ Java 8 çš„ Stream APIï¼š\npublic interface Document { Object get(String key); void put(String key, Object value); List\u0026lt;Document\u0026gt; children(String key); } AbstractDocument æŠ½è±¡ç±»ï¼š","title":"Javaè®¾è®¡æ¨¡å¼ï¼šAbstract Document"},{"content":"æœ¬æ–‡ä¸»è¦ä»‹ç» Abstract Factory æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nJava Design Patterns æä¾›äº†å„ç§ Java è®¾è®¡æ¨¡å¼çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ã€‚è¯¥ç½‘ç«™æ—¨åœ¨å¸®åŠ© Java å¼€å‘äººå‘˜äº†è§£å’Œåº”ç”¨å„ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚\nJava Design Patterns ç½‘ç«™æä¾›äº†å¤šç§è®¾è®¡æ¨¡å¼åˆ†ç±»æ–¹å¼ï¼ŒåŒ…æ‹¬åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational Patternsï¼‰ã€ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternsï¼‰å’Œè¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰ï¼Œä»¥åŠå…¶ä»–ä¸€äº›å¸¸è§çš„æ¨¡å¼ã€‚\nå¯¹äºæ¯ä¸ªè®¾è®¡æ¨¡å¼ï¼Œè¯¥ç½‘ç«™æä¾›äº†è¯¦ç»†çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ï¼Œå¹¶ä¸”æä¾›äº†ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ã€‚å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©é€‚åˆè‡ªå·±çš„è®¾è®¡æ¨¡å¼ï¼Œå¹¶ä¸”å¯ä»¥å‚è€ƒç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜æ¥ç†è§£å’Œåº”ç”¨è¯¥æ¨¡å¼ã€‚\næ­¤å¤–ï¼ŒJava Design Patterns ç½‘ç«™è¿˜æä¾›äº†ä¸€äº›å…¶ä»–èµ„æºï¼Œå¦‚è®¾è®¡æ¨¡å¼çš„ UML å›¾ã€è®¾è®¡æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ã€è®¾è®¡æ¨¡å¼çš„æ¯”è¾ƒç­‰ã€‚è¿™äº›èµ„æºå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨è®¾è®¡æ¨¡å¼ã€‚\nä¸­æ–‡ç½‘ç«™ï¼šhttps://java-design-patterns.com/zh/\nGithub ä¸Šæºç ä»“åº“ï¼ˆéå®˜æ–¹ï¼‰ï¼šhttps://github.com/iluwatar/java-design-patterns\nç›®çš„ æŠ½è±¡å·¥å‚ï¼ˆAbstract Factoryï¼‰æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§æ–¹å¼æ¥åˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–ä¾èµ–å¯¹è±¡çš„å®¶æ—ï¼Œè€Œæ— éœ€æŒ‡å®šå®ƒä»¬å…·ä½“çš„ç±»ã€‚\næŠ½è±¡å·¥å‚æ¨¡å¼ä½¿ç”¨ä¸€ä¸ªæŠ½è±¡å·¥å‚æ¥å£æ¥å®šä¹‰ä¸€ç»„ç›¸å…³çš„å·¥å‚æ–¹æ³•ï¼Œæ¯ä¸ªå·¥å‚æ–¹æ³•éƒ½èƒ½å¤Ÿåˆ›å»ºä¸€ç»„ç›¸å…³çš„äº§å“ã€‚å…·ä½“çš„å·¥å‚å®ç°äº†è¿™ä¸ªæ¥å£ï¼Œå¹¶èƒ½å¤Ÿåˆ›å»ºå…·ä½“çš„äº§å“ã€‚å®¢æˆ·ç«¯ä»£ç åªéœ€è¦ä½¿ç”¨æŠ½è±¡å·¥å‚æ¥å£æ¥åˆ›å»ºäº§å“ï¼Œè€Œä¸éœ€è¦å…³å¿ƒå…·ä½“çš„äº§å“å®ç°ã€‚\nè§£é‡Š çœŸå®ä¸–ç•Œä¾‹å­\nè¦åˆ›å»ºä¸€ä¸ªç‹å›½ï¼Œæˆ‘ä»¬éœ€è¦å…·æœ‰å…±åŒä¸»é¢˜çš„å¯¹è±¡ã€‚ç²¾çµç‹å›½éœ€è¦ç²¾çµå›½ç‹ã€ç²¾çµåŸå ¡å’Œç²¾çµå†›é˜Ÿï¼Œè€Œå…½äººç‹å›½éœ€è¦å…½äººå›½ç‹ã€å…½äººåŸå ¡å’Œå…½äººå†›é˜Ÿã€‚ç‹å›½ä¸­çš„å¯¹è±¡ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»ã€‚\né€šä¿—çš„è¯´\nå·¥å‚çš„å·¥å‚ï¼› ä¸€ä¸ªå°†å•ä¸ªä½†ç›¸å…³/ä»å±çš„å·¥å‚åˆ†ç»„åœ¨ä¸€èµ·è€Œæ²¡æœ‰æŒ‡å®šå…¶å…·ä½“ç±»åˆ«çš„å·¥å‚ã€‚\nç»´åŸºç™¾ç§‘ä¸Šè¯´\næŠ½è±¡å·¥å‚æ¨¡å¼æä¾›äº†ä¸€ç§å°è£…ä¸€ç»„å…·æœ‰å…±åŒä¸»é¢˜çš„å•ä¸ªå·¥å‚è€Œæ— éœ€æŒ‡å®šå…¶å…·ä½“ç±»çš„æ–¹æ³•\nç¨‹åºç¤ºä¾‹\nç¿»è¯‘ä¸Šé¢çš„ç‹å›½ç¤ºä¾‹ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬ä¸ºç‹å›½ä¸­çš„å¯¹è±¡æä¾›äº†ä¸€äº›æ¥å£å’Œå®ç°ã€‚\npublic interface Castle { String getDescription(); } public interface King { String getDescription(); } public interface Army { String getDescription(); } // Elven implementations -\u0026gt; public class ElfCastle implements Castle { static final String DESCRIPTION = \u0026#34;This is the Elven castle!\u0026#34;; @Override public String getDescription() { return DESCRIPTION; } } public class ElfKing implements King { static final String DESCRIPTION = \u0026#34;This is the Elven king!\u0026#34;; @Override public String getDescription() { return DESCRIPTION; } } public class ElfArmy implements Army { static final String DESCRIPTION = \u0026#34;This is the Elven Army!\u0026#34;; @Override public String getDescription() { return DESCRIPTION; } } // Orcish implementations similarly -\u0026gt; ... ç„¶åæˆ‘ä»¬æœ‰äº†ç‹å›½å·¥å‚çš„æŠ½è±¡å’Œå®ç°\npublic interface KingdomFactory { Castle createCastle(); King createKing(); Army createArmy(); } public class ElfKingdomFactory implements KingdomFactory { public Castle createCastle() { return new ElfCastle(); } public King createKing() { return new ElfKing(); } public Army createArmy() { return new ElfArmy(); } } public class OrcKingdomFactory implements KingdomFactory { public Castle createCastle() { return new OrcCastle(); } public King createKing() { return new OrcKing(); } public Army createArmy() { return new OrcArmy(); } } ç°åœ¨æˆ‘ä»¬æœ‰äº†æŠ½è±¡å·¥å‚ï¼Œä½¿æˆ‘ä»¬å¯ä»¥åˆ¶ä½œç›¸å…³å¯¹è±¡çš„ç³»åˆ—ï¼Œå³ç²¾çµç‹å›½å·¥å‚åˆ›å»ºäº†ç²¾çµåŸå ¡ï¼Œå›½ç‹å’Œå†›é˜Ÿç­‰ã€‚\nKingdomFactory factory = new ElfKingdomFactory(); Castle castle = factory.createCastle(); King king = factory.createKing(); Army army = factory.createArmy(); castle.getDescription(); king.getDescription(); army.getDescription(); ç¨‹åºè¾“å‡º:\nThis is the Elven castle! This is the Elven king! This is the Elven Army! ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºä¸åŒçš„ç‹å›½å·¥å‚è®¾è®¡å·¥å‚ã€‚ åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº† FactoryMakerï¼Œè´Ÿè´£è¿”å› ElfKingdomFactory æˆ– OrcKingdomFactory çš„å®ä¾‹ã€‚ å®¢æˆ·å¯ä»¥ä½¿ç”¨ FactoryMaker æ¥åˆ›å»ºæ‰€éœ€çš„å…·ä½“å·¥å‚ï¼Œè¯¥å·¥å‚éšåå°†ç”Ÿäº§ä¸åŒçš„å…·ä½“å¯¹è±¡ï¼ˆå†›é˜Ÿï¼Œå›½ç‹ï¼ŒåŸå ¡ï¼‰ã€‚ åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬è¿˜ä½¿ç”¨äº†ä¸€ä¸ªæšä¸¾æ¥å‚æ•°åŒ–å®¢æˆ·è¦æ±‚çš„ç‹å›½å·¥å‚ç±»å‹ã€‚\npublic static class FactoryMaker { public enum KingdomType { ELF, ORC } public static KingdomFactory makeFactory(KingdomType type) { return switch (type) { case ELF -\u0026gt; new ElfKingdomFactory(); case ORC -\u0026gt; new OrcKingdomFactory(); default -\u0026gt; throw new IllegalArgumentException(\u0026#34;KingdomType not supported.\u0026#34;); }; } } @Slf4j public class App{ private final Kingdom kingdom = new Kingdom(); public Kingdom getKingdom() { return kingdom; } public static void main(String[] args) { App app = new App(); LOGGER.info(\u0026#34;elf kingdom\u0026#34;); createKingdom(KingdomType.ELF); LOGGER.info(kingdom.getArmy().getDescription()); LOGGER.info(kingdom.getCastle().getDescription()); LOGGER.info(kingdom.getKing().getDescription()); LOGGER.info(\u0026#34;orc kingdom\u0026#34;); createKingdom(KingdomType.ORC); LOGGER.info(kingdom.getArmy().getDescription()); LOGGER.info(kingdom.getCastle().getDescription()); LOGGER.info(kingdom.getKing().getDescription()); } } ç±»å›¾ ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹åŒ…æ‹¬ï¼š\næŠ½è±¡å·¥å‚æ¨¡å¼èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬åˆ›å»ºå…·æœ‰é«˜å†…èšæ€§çš„å¯¹è±¡å®¶æ—ï¼Œè¿™äº›å¯¹è±¡å®¶æ—ä¹‹é—´ç›¸äº’åä½œï¼Œä»è€Œæ„æˆä¸€ä¸ªå®Œæ•´çš„ç³»ç»Ÿã€‚ æŠ½è±¡å·¥å‚æ¨¡å¼èƒ½å¤Ÿä¿è¯å®¢æˆ·ç«¯ä»£ç ä¸å…·ä½“äº§å“å®ç°ä¹‹é—´çš„è§£è€¦ï¼Œä»è€Œè®©ç³»ç»Ÿæ›´åŠ çµæ´»å’Œå¯æ‰©å±•ã€‚ æŠ½è±¡å·¥å‚æ¨¡å¼èƒ½å¤Ÿéšè—äº§å“çš„å…·ä½“å®ç°ç»†èŠ‚ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ã€‚ è€Œç¼ºç‚¹åˆ™åŒ…æ‹¬ï¼š\næŠ½è±¡å·¥å‚æ¨¡å¼æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦å®šä¹‰è®¸å¤šæ¥å£å’ŒæŠ½è±¡ç±»ï¼Œè¿™ä¼šå¢åŠ ç³»ç»Ÿçš„å¤æ‚æ€§å’Œå¼€å‘æˆæœ¬ã€‚ å¦‚æœéœ€è¦æ·»åŠ æ–°çš„äº§å“æ—ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¿®æ”¹æŠ½è±¡å·¥å‚æ¥å£ä»¥åŠæ‰€æœ‰çš„å…·ä½“å·¥å‚å®ç°ï¼Œè¿™ä¼šå¸¦æ¥ä¸€å®šçš„é£é™©å’Œä¸ä¾¿ã€‚ æŠ½è±¡å·¥å‚æ¨¡å¼å¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿçš„æ‰©å±•æ€§å—é™ï¼Œå› ä¸ºä¸€æ—¦å®šä¹‰äº†æŠ½è±¡å·¥å‚æ¥å£ï¼Œå°±ä¸èƒ½å¤Ÿè½»æ˜“åœ°ä¿®æ”¹å®ƒã€‚ åœ¨ã€ŠEffective Javaã€‹ä¸­ï¼Œä½œè€…è¿˜æåˆ°äº†ä¸€ä¸ªå…³äºæŠ½è±¡å·¥å‚æ¨¡å¼çš„å»ºè®®ï¼šåœ¨è®¾è®¡æŠ½è±¡å·¥å‚æ¥å£æ—¶ï¼Œè¦è€ƒè™‘åˆ°æœªæ¥å¯èƒ½çš„å˜åŒ–ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬é¢„è®¡å°†æ¥å¯èƒ½ä¼šæ·»åŠ æ–°çš„äº§å“æ—ï¼Œé‚£ä¹ˆå°±åº”è¯¥å°½é‡è®¾è®¡ä¸€ä¸ªçµæ´»çš„æŠ½è±¡å·¥å‚æ¥å£ï¼Œä»¥ä¾¿åœ¨ä¸ä¿®æ”¹ç°æœ‰ä»£ç çš„æƒ…å†µä¸‹æ·»åŠ æ–°çš„äº§å“æ—ã€‚\nä¸¾ä¾‹ï¼šAbstract Factory Design Pattern in Java\nComputer.javaï¼š\npublic abstract class Computer { public abstract String getRAM(); public abstract String getHDD(); public abstract String getCPU(); @Override public String toString(){ return \u0026#34;RAM= \u0026#34;+this.getRAM()+\u0026#34;, HDD=\u0026#34;+this.getHDD()+\u0026#34;, CPU=\u0026#34;+this.getCPU(); } } PC.javaï¼š\npublic class PC extends Computer { private String ram; private String hdd; private String cpu; public PC(String ram, String hdd, String cpu){ this.ram=ram; this.hdd=hdd; this.cpu=cpu; } @Override public String getRAM() { return this.ram; } @Override public String getHDD() { return this.hdd; } @Override public String getCPU() { return this.cpu; } } Server.javaï¼š\npublic class Server extends Computer { private String ram; private String hdd; private String cpu; public Server(String ram, String hdd, String cpu){ this.ram=ram; this.hdd=hdd; this.cpu=cpu; } @Override public String getRAM() { return this.ram; } @Override public String getHDD() { return this.hdd; } @Override public String getCPU() { return this.cpu; } } æŠ½è±¡å·¥å‚æ–¹æ³•ï¼š\npublic interface ComputerAbstractFactory { public Computer createComputer(); } public class PCFactory implements ComputerAbstractFactory { private String ram; private String hdd; private String cpu; public PCFactory(String ram, String hdd, String cpu){ this.ram=ram; this.hdd=hdd; this.cpu=cpu; } @Override public Computer createComputer() { return new PC(ram,hdd,cpu); } } public class ServerFactory implements ComputerAbstractFactory { private String ram; private String hdd; private String cpu; public ServerFactory(String ram, String hdd, String cpu){ this.ram=ram; this.hdd=hdd; this.cpu=cpu; } @Override public Computer createComputer() { return new Server(ram,hdd,cpu); } } å·¥å‚ç±»ï¼š\npublic class ComputerFactory { public static Computer getComputer(ComputerAbstractFactory factory){ return factory.createComputer(); } } æµ‹è¯•ï¼š\npublic class TestDesignPatterns { public static void main(String[] args) { testAbstractFactory(); } private static void testAbstractFactory() { Computer pc = ComputerFactory.getComputer(new PCFactory(\u0026#34;2 GB\u0026#34;,\u0026#34;500 GB\u0026#34;,\u0026#34;2.4 GHz\u0026#34;)); Computer server = ComputerFactory.getComputer(new ServerFactory(\u0026#34;16 GB\u0026#34;,\u0026#34;1 TB\u0026#34;,\u0026#34;2.9 GHz\u0026#34;)); System.out.println(\u0026#34;AbstractFactory PC Config::\u0026#34;+pc); System.out.println(\u0026#34;AbstractFactory Server Config::\u0026#34;+server); } } è¾“å‡ºç»“æœï¼š\nAbstractFactory PC Config::RAM= 2 GB, HDD=500 GB, CPU=2.4 GHz AbstractFactory Server Config::RAM= 16 GB, HDD=1 TB, CPU=2.9 GHz é€‚ç”¨æ€§ åœ¨ä»¥ä¸‹æƒ…å†µä¸‹ä½¿ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼\nè¯¥ç³»ç»Ÿåº”ç‹¬ç«‹äºå…¶äº§å“çš„åˆ›å»ºï¼Œç»„æˆå’Œè¡¨ç¤ºæ–¹å¼ ç³»ç»Ÿåº”é…ç½®æœ‰å¤šä¸ªäº§å“ç³»åˆ—ä¹‹ä¸€ ç›¸å…³äº§å“å¯¹è±¡ç³»åˆ—æ—¨åœ¨ä¸€èµ·ä½¿ç”¨ï¼Œä½ éœ€è¦å¼ºåˆ¶æ‰§è¡Œæ­¤çº¦æŸ ä½ æƒ³æä¾›äº§å“çš„ç±»åº“ï¼Œå¹¶ä¸”åªæƒ³æš´éœ²å®ƒä»¬çš„æ¥å£ï¼Œè€Œä¸æ˜¯å®ƒä»¬çš„å®ç°ã€‚ ä»æ¦‚å¿µä¸Šè®²ï¼Œä¾èµ–é¡¹çš„ç”Ÿå­˜æœŸæ¯”ä½¿ç”¨è€…çš„ç”Ÿå­˜æœŸçŸ­ã€‚ ä½ éœ€è¦ä¸€ä¸ªè¿è¡Œæ—¶å€¼æ¥æ„å»ºç‰¹å®šçš„ä¾èµ–å…³ç³» ä½ æƒ³å†³å®šåœ¨è¿è¡Œæ—¶ä»ç³»åˆ—ä¸­è°ƒç”¨å“ªç§äº§å“ã€‚ ä½ éœ€è¦æä¾›ä¸€ä¸ªæˆ–æ›´å¤šä»…åœ¨è¿è¡Œæ—¶æ‰çŸ¥é“çš„å‚æ•°ï¼Œç„¶åæ‰èƒ½è§£å†³ä¾èµ–å…³ç³»ã€‚ å½“ä½ éœ€è¦äº§å“ä¹‹é—´çš„ä¸€è‡´æ€§æ—¶ åœ¨å‘ç¨‹åºæ·»åŠ æ–°äº§å“æˆ–äº§å“ç³»åˆ—æ—¶ï¼Œæ‚¨ä¸æƒ³æ›´æ”¹ç°æœ‰ä»£ç ã€‚ ç›¸å…³æ¨¡å¼ Factory Method Factory Kit ä½¿ç”¨ jdk ä¸­ä»¥ä¸‹ç±»ä½¿ç”¨äº†æŠ½è±¡å·¥å‚æ¨¡å¼ï¼š\njavax.xml.parsers.DocumentBuilderFactoryopen javax.xml.transform.TransformerFactoryopen javax.xml.xpath.XPathFactoryopen ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„å¼€æºæ¡†æ¶å’Œåº“ï¼š\nSpring Frameworkï¼šSpring Framework æ˜¯ä¸€ä¸ªæµè¡Œçš„ Java åº”ç”¨ç¨‹åºæ¡†æ¶ï¼Œå®ƒä½¿ç”¨äº†æŠ½è±¡å·¥å‚æ¨¡å¼æ¥åˆ›å»ºä¸åŒç±»å‹çš„å¯¹è±¡ï¼Œä¾‹å¦‚æ•°æ®æºã€äº‹åŠ¡ç®¡ç†å™¨å’Œæ¶ˆæ¯é˜Ÿåˆ—ç­‰ã€‚ Hibernate ORMï¼šHibernate ORM æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†å¯¹è±¡å…³ç³»æ˜ å°„ï¼ˆORMï¼‰çš„æ¡†æ¶ï¼Œå®ƒä½¿ç”¨äº†æŠ½è±¡å·¥å‚æ¨¡å¼æ¥åˆ›å»ºæ•°æ®åº“è¿æ¥ã€äº‹åŠ¡ç®¡ç†å™¨å’ŒæŸ¥è¯¢è¯­å¥ç­‰å¯¹è±¡ã€‚ Apache Commonsï¼šApache Commons æ˜¯ä¸€ä¸ªå¼€æºçš„ Java å·¥å…·åº“ï¼Œå®ƒåŒ…å«äº†è®¸å¤šå¸¸ç”¨çš„å·¥å…·ç±»å’Œå‡½æ•°ã€‚å…¶ä¸­ï¼Œä¸€äº›æ¨¡å—ï¼ˆä¾‹å¦‚ Commons Codec å’Œ Commons Poolï¼‰ä½¿ç”¨äº†æŠ½è±¡å·¥å‚æ¨¡å¼æ¥åˆ›å»ºä¸åŒç±»å‹çš„å¯¹è±¡ã€‚ Apache Strutsï¼šApache Struts æ˜¯ä¸€ä¸ªåŸºäº MVCï¼ˆæ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ï¼‰æ¨¡å¼çš„ Web åº”ç”¨ç¨‹åºæ¡†æ¶ï¼Œå®ƒä½¿ç”¨äº†æŠ½è±¡å·¥å‚æ¨¡å¼æ¥åˆ›å»ºä¸åŒç±»å‹çš„ Action ç±»å’Œç»“æœç±»å‹ã€‚ Apache CXFï¼šApache CXF æ˜¯ä¸€ä¸ªç”¨äºæ„å»º Web æœåŠ¡çš„æ¡†æ¶ï¼Œå®ƒä½¿ç”¨äº†æŠ½è±¡å·¥å‚æ¨¡å¼æ¥åˆ›å»ºä¸åŒç±»å‹çš„ Web æœåŠ¡ç«¯ç‚¹å’Œå®¢æˆ·ç«¯ã€‚ Apache Axisï¼šApache Axis æ˜¯ä¸€ä¸ªç”¨äºæ„å»º Web æœåŠ¡çš„æ¡†æ¶ï¼Œå®ƒä½¿ç”¨äº†æŠ½è±¡å·¥å‚æ¨¡å¼æ¥åˆ›å»ºä¸åŒç±»å‹çš„ Web æœåŠ¡ç«¯ç‚¹å’Œå®¢æˆ·ç«¯ã€‚ Apache Log4jï¼šApache Log4j æ˜¯ä¸€ä¸ªæµè¡Œçš„ Java æ—¥å¿—æ¡†æ¶ï¼Œå®ƒä½¿ç”¨äº†æŠ½è±¡å·¥å‚æ¨¡å¼æ¥åˆ›å»ºä¸åŒç±»å‹çš„æ—¥å¿—è®°å½•å™¨å’Œ Appenderï¼ˆæ—¥å¿—è¾“å‡ºå™¨ï¼‰ã€‚ Apache Commons Configurationï¼šApache Commons Configuration æ˜¯ä¸€ä¸ªç”¨äºè¯»å–å’Œå†™å…¥é…ç½®æ–‡ä»¶çš„åº“ï¼Œå®ƒä½¿ç”¨äº†æŠ½è±¡å·¥å‚æ¨¡å¼æ¥åˆ›å»ºä¸åŒç±»å‹çš„é…ç½®å¯¹è±¡ï¼Œä¾‹å¦‚ XMLConfiguration å’Œ PropertiesConfiguration ç­‰ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œè®¸å¤šå…¶ä»–çš„å¼€æºæ¡†æ¶å’Œåº“ä¹Ÿä½¿ç”¨äº†æŠ½è±¡å·¥å‚æ¨¡å¼ï¼Œä¾‹å¦‚ Hibernateã€MyBatisã€JDBCã€JPAã€JUnit ç­‰ã€‚è¿™äº›æ¡†æ¶å’Œåº“ä½¿ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼çš„åŸå› æ˜¯å®ƒèƒ½å¤Ÿå¸®åŠ©åˆ›å»ºå…·æœ‰é«˜å†…èšæ€§çš„å¯¹è±¡å®¶æ—ï¼Œå¹¶ä¸”èƒ½å¤Ÿä¿è¯å®¢æˆ·ç«¯ä»£ç ä¸å…·ä½“äº§å“å®ç°ä¹‹é—´çš„è§£è€¦ã€‚åŒæ—¶ï¼ŒæŠ½è±¡å·¥å‚æ¨¡å¼ä¹Ÿèƒ½å¤Ÿéšè—äº§å“çš„å…·ä½“å®ç°ç»†èŠ‚ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ã€‚è¿™äº›ä¼˜ç‚¹è®©æŠ½è±¡å·¥å‚æ¨¡å¼æˆä¸ºäº†è¿™äº›æ¡†æ¶å’Œåº“ä¸­å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/05/22/java-design-patterns-abstract-factory/","summary":"æœ¬æ–‡ä¸»è¦ä»‹ç» Abstract Factory æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚\nJava Design Patterns æä¾›äº†å„ç§ Java è®¾è®¡æ¨¡å¼çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ã€‚è¯¥ç½‘ç«™æ—¨åœ¨å¸®åŠ© Java å¼€å‘äººå‘˜äº†è§£å’Œåº”ç”¨å„ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚\nJava Design Patterns ç½‘ç«™æä¾›äº†å¤šç§è®¾è®¡æ¨¡å¼åˆ†ç±»æ–¹å¼ï¼ŒåŒ…æ‹¬åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational Patternsï¼‰ã€ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternsï¼‰å’Œè¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰ï¼Œä»¥åŠå…¶ä»–ä¸€äº›å¸¸è§çš„æ¨¡å¼ã€‚\nå¯¹äºæ¯ä¸ªè®¾è®¡æ¨¡å¼ï¼Œè¯¥ç½‘ç«™æä¾›äº†è¯¦ç»†çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ï¼Œå¹¶ä¸”æä¾›äº†ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ã€‚å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©é€‚åˆè‡ªå·±çš„è®¾è®¡æ¨¡å¼ï¼Œå¹¶ä¸”å¯ä»¥å‚è€ƒç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜æ¥ç†è§£å’Œåº”ç”¨è¯¥æ¨¡å¼ã€‚\næ­¤å¤–ï¼ŒJava Design Patterns ç½‘ç«™è¿˜æä¾›äº†ä¸€äº›å…¶ä»–èµ„æºï¼Œå¦‚è®¾è®¡æ¨¡å¼çš„ UML å›¾ã€è®¾è®¡æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ã€è®¾è®¡æ¨¡å¼çš„æ¯”è¾ƒç­‰ã€‚è¿™äº›èµ„æºå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨è®¾è®¡æ¨¡å¼ã€‚\nä¸­æ–‡ç½‘ç«™ï¼šhttps://java-design-patterns.com/zh/\nGithub ä¸Šæºç ä»“åº“ï¼ˆéå®˜æ–¹ï¼‰ï¼šhttps://github.com/iluwatar/java-design-patterns\nç›®çš„ æŠ½è±¡å·¥å‚ï¼ˆAbstract Factoryï¼‰æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§æ–¹å¼æ¥åˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–ä¾èµ–å¯¹è±¡çš„å®¶æ—ï¼Œè€Œæ— éœ€æŒ‡å®šå®ƒä»¬å…·ä½“çš„ç±»ã€‚\næŠ½è±¡å·¥å‚æ¨¡å¼ä½¿ç”¨ä¸€ä¸ªæŠ½è±¡å·¥å‚æ¥å£æ¥å®šä¹‰ä¸€ç»„ç›¸å…³çš„å·¥å‚æ–¹æ³•ï¼Œæ¯ä¸ªå·¥å‚æ–¹æ³•éƒ½èƒ½å¤Ÿåˆ›å»ºä¸€ç»„ç›¸å…³çš„äº§å“ã€‚å…·ä½“çš„å·¥å‚å®ç°äº†è¿™ä¸ªæ¥å£ï¼Œå¹¶èƒ½å¤Ÿåˆ›å»ºå…·ä½“çš„äº§å“ã€‚å®¢æˆ·ç«¯ä»£ç åªéœ€è¦ä½¿ç”¨æŠ½è±¡å·¥å‚æ¥å£æ¥åˆ›å»ºäº§å“ï¼Œè€Œä¸éœ€è¦å…³å¿ƒå…·ä½“çš„äº§å“å®ç°ã€‚\nè§£é‡Š çœŸå®ä¸–ç•Œä¾‹å­\nè¦åˆ›å»ºä¸€ä¸ªç‹å›½ï¼Œæˆ‘ä»¬éœ€è¦å…·æœ‰å…±åŒä¸»é¢˜çš„å¯¹è±¡ã€‚ç²¾çµç‹å›½éœ€è¦ç²¾çµå›½ç‹ã€ç²¾çµåŸå ¡å’Œç²¾çµå†›é˜Ÿï¼Œè€Œå…½äººç‹å›½éœ€è¦å…½äººå›½ç‹ã€å…½äººåŸå ¡å’Œå…½äººå†›é˜Ÿã€‚ç‹å›½ä¸­çš„å¯¹è±¡ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»ã€‚\né€šä¿—çš„è¯´\nå·¥å‚çš„å·¥å‚ï¼› ä¸€ä¸ªå°†å•ä¸ªä½†ç›¸å…³/ä»å±çš„å·¥å‚åˆ†ç»„åœ¨ä¸€èµ·è€Œæ²¡æœ‰æŒ‡å®šå…¶å…·ä½“ç±»åˆ«çš„å·¥å‚ã€‚\nç»´åŸºç™¾ç§‘ä¸Šè¯´\næŠ½è±¡å·¥å‚æ¨¡å¼æä¾›äº†ä¸€ç§å°è£…ä¸€ç»„å…·æœ‰å…±åŒä¸»é¢˜çš„å•ä¸ªå·¥å‚è€Œæ— éœ€æŒ‡å®šå…¶å…·ä½“ç±»çš„æ–¹æ³•\nç¨‹åºç¤ºä¾‹\nç¿»è¯‘ä¸Šé¢çš„ç‹å›½ç¤ºä¾‹ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬ä¸ºç‹å›½ä¸­çš„å¯¹è±¡æä¾›äº†ä¸€äº›æ¥å£å’Œå®ç°ã€‚\npublic interface Castle { String getDescription(); } public interface King { String getDescription(); } public interface Army { String getDescription(); } // Elven implementations -\u0026gt; public class ElfCastle implements Castle { static final String DESCRIPTION = \u0026#34;This is the Elven castle!\u0026#34;; @Override public String getDescription() { return DESCRIPTION; } } public class ElfKing implements King { static final String DESCRIPTION = \u0026#34;This is the Elven king!","title":"Javaè®¾è®¡æ¨¡å¼ï¼šAbstract Factory"},{"content":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-05-08 åˆ° 2023-05-14 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\næœ¬å‘¨ç»§ç»­å­¦ä¹  pythonï¼Œå‘ç°ä¸€ä¸ªè´¨é‡éå¸¸é«˜çš„ python å­¦ä¹ ç½‘ç«™ Real Pythonï¼Œè¯¥ç½‘ç«™æœ‰å­¦ä¹  python çš„ä¸€äº›æ•™ç¨‹ï¼Œæ˜¯æ”¶è´¹çš„ï¼Œéƒ¨åˆ†ç« èŠ‚æ˜¯å¯ä»¥å…è´¹è§‚çœ‹çš„ã€‚\nå¦å¤–ï¼Œå‘¨äº”æ™šä¸Šè€å©†ä¸´æ—¶èµ·æ„æƒ³å»æ­¦åŠŸå±±çœ‹æ—¥å‡ºï¼Œäºæ˜¯ç«‹å³è§„åˆ’è¡Œç¨‹å¹¶è´­ä¹°ç«è½¦ç¥¨ã€‚å› ä¸ºä¸€å¹´åŠä¹‹å‰ï¼Œæˆ‘å»è¿‡ä¸€æ¬¡ï¼Œæ‰€ä»¥è§„åˆ’èµ·æ¥è¿˜æ˜¯å¾ˆè½»æ¾çš„ã€‚ä¸Šä¸€æ¬¡å»æ˜¯å›½åº†èŠ‚ç¢°åˆ°ä¸‹é›¨ï¼Œæ²¡æœ‰çœ‹åˆ°æ—¥å‡ºã€‚å¹¸è¿çš„æ˜¯ï¼Œè¿™æ¬¡æ˜¯æ™´å¤©ï¼Œä¸ä»…çœ‹åˆ°äº†æ—¥è½è¿˜çœ‹åˆ°äº†æ—¥å‡ºã€‚è¿™ä¸€æ¬¡æ²¡æœ‰é€‰æ‹©ä½å¸ç¯·ï¼Œè€Œæ˜¯ä½åœ¨äº†äº‘ä¸­é›¾å®¢æ ˆï¼Œæ²¡æƒ³åˆ°è¿™ä¸ªå®¢æ ˆç¦»é‡‘é¡¶éœ€è¦ 40 åˆ†é’Ÿå·¦å³çš„è·¯ç¨‹ï¼Œè€Œä¸”æœ‰æ®µè·¯ç¨‹æ˜¯å‘å‘æ´¼æ´¼ã€‚\nå»æ­¦åŠŸå±±ä¹‹å‰ï¼Œå…ˆå»äº†é•¿æ²™ï¼Œå†æ¬¡æ¸¸äº†æ©˜å­æ´²å¤´ï¼Œå¹¶ç¬¬ä¸€æ¬¡åœ¨é•¿æ²™è·‘æ­¥æ‰“å¡ã€‚æœ¬æƒ³åœ¨èä¹¡ä¹Ÿè·‘æ­¥æ‰“å¡ï¼Œå¥ˆä½•æ²¡æœ‰å¾—é€ã€‚\nè¿™æ¬¡å»äº†é•¿æ²™å’Œæ­¦åŠŸå±±ï¼Œä¸‹æ¬¡åŸºæœ¬ä¸Šæ˜¯å†ä¹Ÿä¸ä¼šå»çˆ¬æ­¦åŠŸå±±äº†ã€‚é•¿æ²™è¿˜ä¼šå»ï¼Œå› ä¸ºä»æ­¦åŠŸå±±å›æ¥è·¯ä¸Šï¼Œå°±å’Œè€å©†è§„åˆ’ç€ä»€ä¹ˆæ—¶å€™å»å¼ å®¶ç•Œã€‚\næ­¦åŠŸå±±çœ‹æ—¥å‡º ç†è´¢ è¿™å‘¨æ€»è®¡æ”¯å‡º 1784 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š\n5 æœˆ 8 æ—¥ï¼š12 å…ƒ 5 æœˆ 9 æ—¥ï¼š18 å…ƒ 5 æœˆ 10 æ—¥ï¼š200 å…ƒ 5 æœˆ 11 æ—¥ï¼š12 å…ƒ 5 æœˆ 12 æ—¥ï¼š445 å…ƒ 5 æœˆ 13 æ—¥ï¼š662 å…ƒ 5 æœˆ 14 æ—¥ï¼š435 å…ƒ å› ä¸ºå‘¨æœ«å‡ºå»æ—…æ¸¸ï¼Œæ‰€ä»¥æœ¬å‘¨æ”¯å‡ºæœ‰æ‰€å¢å¤šã€‚\nå¥èº« æœ¬å‘¨è·‘æ­¥ 56 å…¬é‡Œï¼Œæœ€é•¿è·‘æ­¥è·ç¦»ä¸º 13 å…¬é‡Œã€‚\næ˜ç»†æ•°æ®å¦‚ä¸‹ï¼š\nå‘¨æœ«å‡ºå»æ—…æ¸¸ï¼Œè·¯è¿‡é•¿æ²™ï¼Œåœ¨é•¿æ²™è·‘äº†ä¸¤å¤©ï¼Œç´¯è®¡è·‘äº† 6 å…¬é‡Œã€‚è¿™æ ·ï¼Œæˆ‘çš„è·‘æ­¥æ•°æ® ä» 2 å¹´é‡Œæˆ‘è·‘è¿‡ 1 ä¸ªçœä»½ 1 ä¸ªåŸå¸‚ å˜æˆäº† 2 å¹´é‡Œæˆ‘è·‘è¿‡ 2 ä¸ªçœä»½ 2 ä¸ªåŸå¸‚ã€‚\nå·¥ä½œ Java åšå®¢ æœ¬å‘¨å®Œæˆä¸¤ç¯‡åšå®¢\nã€ŠEffective Java 3ã€‹ç¬”è®° 10ï¼šè¦†ç›– equals æ–¹æ³•æ—¶åº”éµå®ˆçš„çº¦å®š JSR 166 è§„èŒƒ Python Python åˆå­¦å»ºè®® 1ã€æ–°æ‰‹å¦‚ä½•å­¦ä¹  pythonï¼Ÿ\næ¨èå‡ ç¯‡æ–‡ç« ï¼š\ncPython - ç»™å¤§å­¦ç”Ÿçš„å…¥é—¨æ•™ç¨‹\nå¦‚ä½•å­¦ Pythonï¼Ÿ\n2ã€å­¦ä¹  python ç¼–ç¨‹çš„ 11 ä¸ªå»ºè®®\nåŸæ–‡ï¼š11 Beginner Tips for Learning Python Programmingï¼Œæ€»ç»“å‡ºä»¥ä¸‹ 11 æ¡æ–°æ‰‹ç¼–ç¨‹å»ºè®®ï¼š\næç¤º #1ï¼šæ¯å¤©ç¼–å†™ä»£ç \næç¤º#2ï¼šå†™å‡ºæ¥\næç¤º#3ï¼šäº’åŠ¨\næç¤º#4ï¼šä¼‘æ¯\næç¤º#5ï¼šæˆä¸ºæ¼æ´èµé‡‘çŒäºº\næç¤º#6ï¼šä¸æ­£åœ¨å­¦ä¹ çš„å…¶ä»–äººåœ¨ä¸€èµ·\næŠ€å·§#7ï¼šæ•™å¯¼\næŠ€å·§#8ï¼šç»“å¯¹ç¼–ç¨‹\næç¤º#9ï¼šæå‡ºâ€œå¥½çš„â€é—®é¢˜\næŠ€å·§#10ï¼šæ„å»ºä¸€äº›ä¸œè¥¿\næŠ€å·§#11ï¼šä¸ºå¼€æºåšè´¡çŒ®\n3ã€Pyhton æ’­å®¢ï¼š Ep 01. æ–°äººåˆ°åº•éœ€è¦ä»€ä¹ˆ\næ’­å®¢ä¸­æåˆ°çš„å†…å®¹ï¼š\nTech lead starlette Pythonâ€™s super() considered super! huey apscheduler Python 3: ten years later - PyCon 2018 David Beazley - Python Concurrency From the Ground Up: LIVE! - PyCon 2015 pyflame æé—®çš„æ™ºæ…§ XY é—®é¢˜ Python Logger pdb PyCharm Jupyter notebook Let me google that, let me google that for you å­¦ä¹ æ“ä½œç³»ç»Ÿçš„çŸ¥è¯†ï¼Œçœ‹å“ªæœ¬ä¹¦å¥½ï¼Ÿ PHP é»‘ç³»åˆ—ä¹‹äºŒï¼šPHP ä¸ºä»€ä¹ˆå‡½æ•°å‘½åæ˜¯å¦‚æ­¤ä¸ä¸€è‡´ï¼Ÿ Scheme The Little Schemer SICP CS 61A: Structure and Interpretation of Computer Programs Python Tips æœ¬å‘¨è®¢é˜…äº† Real Python çš„ Python Tricksï¼Œæ”¶åˆ°ä¸¤å°é‚®ä»¶ï¼Œåˆ†äº«å¦‚ä¸‹ï¼š\n1ã€å¦‚ä½•ä¸€è¡Œä»£ç åˆå¹¶ä¸¤ä¸ªå­—å…¸\n# How to merge two dictionaries # in Python 3.5+ \u0026gt;\u0026gt;\u0026gt; x = {\u0026#39;a\u0026#39;: 1, \u0026#39;b\u0026#39;: 2} \u0026gt;\u0026gt;\u0026gt; y = {\u0026#39;b\u0026#39;: 3, \u0026#39;c\u0026#39;: 4} \u0026gt;\u0026gt;\u0026gt; z = {**x, **y} \u0026gt;\u0026gt;\u0026gt; z {\u0026#39;c\u0026#39;: 4, \u0026#39;a\u0026#39;: 1, \u0026#39;b\u0026#39;: 3} # In Python 2.x you could # use this: \u0026gt;\u0026gt;\u0026gt; z = dict(x, **y) \u0026gt;\u0026gt;\u0026gt; z {\u0026#39;a\u0026#39;: 1, \u0026#39;c\u0026#39;: 4, \u0026#39;b\u0026#39;: 3} # In these examples, Python merges dictionary keys # in the order listed in the expression, overwriting # duplicates from left to right. # # See: https://www.youtube.com/watch?v=Duexw08KaC8 è¯´æ˜ï¼š\nè¿™æ®µä»£ç ç”¨äºå°†ä¸¤ä¸ªå­—å…¸ x å’Œ y åˆå¹¶æˆä¸€ä¸ªæ–°å­—å…¸ zï¼Œå…¶ä¸­ ** æ˜¯ Python ä¸­çš„è§£åŒ…è¿ç®—ç¬¦ï¼Œå¯ä»¥å°†ä¸€ä¸ªå­—å…¸æ‹†åˆ†æˆå¤šä¸ªé”®å€¼å¯¹ï¼Œç„¶åå°†è¿™äº›é”®å€¼å¯¹ä½œä¸ºå‚æ•°ä¼ é€’ç»™ä¸€ä¸ªå‡½æ•°æˆ–ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„å­—å…¸ã€‚\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ{**x, **y} è¡¨ç¤ºå°†å­—å…¸ x å’Œ y æ‹†åˆ†æˆå¤šä¸ªé”®å€¼å¯¹ï¼Œç„¶åå°†è¿™äº›é”®å€¼å¯¹åˆå¹¶æˆä¸€ä¸ªæ–°å­—å…¸ã€‚ç”±äºå­—å…¸ y ä¸­çš„é”® b ä¸å­—å…¸ x ä¸­çš„é”® b ç›¸åŒï¼Œå› æ­¤åœ¨åˆå¹¶åçš„å­—å…¸ä¸­ï¼Œé”® b å¯¹åº”çš„å€¼å°†è¢«æ›´æ–°ä¸ºå­—å…¸ y ä¸­çš„å€¼ï¼ˆå³ 3ï¼‰ã€‚\né™¤äº†ä¸Šé¢çš„æ–¹æ³•ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ update() æ–¹æ³•\nx = {\u0026#39;a\u0026#39;: 1, \u0026#39;b\u0026#39;: 2} y = {\u0026#39;b\u0026#39;: 3, \u0026#39;c\u0026#39;: 4} z = x.copy() z.update(y) åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œé¦–å…ˆå°†å­—å…¸ x å¤åˆ¶ä¸€ä»½åˆ° z ä¸­ï¼Œç„¶åä½¿ç”¨ update() æ–¹æ³•å°†å­—å…¸ y åˆå¹¶åˆ° z ä¸­ã€‚å¦‚æœå­—å…¸ y ä¸­çš„é”®åœ¨å­—å…¸ x ä¸­å·²ç»å­˜åœ¨ï¼Œåˆ™ä¼šä½¿ç”¨å­—å…¸ y ä¸­çš„å€¼æ¥æ›´æ–°å­—å…¸ z ä¸­çš„å€¼ã€‚æœ€ç»ˆå¾—åˆ°ä¸€ä¸ªæ–°å­—å…¸ zï¼Œå®ƒåŒ…å«äº†å­—å…¸ x å’Œ y ä¸­çš„æ‰€æœ‰é”®å€¼å¯¹ã€‚\n2ã€åœ¨ Python ä¸­ä¸€æ¬¡æµ‹è¯•å¤šä¸ªæ ‡å¿—çš„ä¸åŒæ–¹æ³•\n# Different ways to test multiple # flags at once in Python x, y, z = 0, 1, 0 if x == 1 or y == 1 or z == 1: print(\u0026#39;passed\u0026#39;) if 1 in (x, y, z): print(\u0026#39;passed\u0026#39;) # These only test for truthiness: if x or y or z: print(\u0026#39;passed\u0026#39;) if any((x, y, z)): print(\u0026#39;passed\u0026#39;) é™¤äº†å‰é¢æåˆ°çš„å››ç§æ–¹æ³•å¤–ï¼Œè¿˜æœ‰å…¶ä»–å‡ ç§æ–¹å¼æ¥æµ‹è¯•å¤šä¸ªå˜é‡æ˜¯å¦è‡³å°‘æœ‰ä¸€ä¸ªç­‰äºæŸä¸ªå€¼ï¼š\nä½¿ç”¨åˆ—è¡¨è§£æå¼ x, y, z = 0, 1, 0 if any([i == 1 for i in (x, y, z)]): print(\u0026#39;passed\u0026#39;) åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä½¿ç”¨åˆ—è¡¨è§£æå¼ç”Ÿæˆä¸€ä¸ªæ–°åˆ—è¡¨ï¼Œå…¶ä¸­åŒ…å«å˜é‡ xã€yã€z ä¸­æ¯ä¸ªå˜é‡æ˜¯å¦ç­‰äº 1 çš„å¸ƒå°”å€¼ã€‚ç„¶åï¼Œä½¿ç”¨ any() å‡½æ•°æ¥æµ‹è¯•æ–°åˆ—è¡¨ä¸­æ˜¯å¦å­˜åœ¨è‡³å°‘ä¸€ä¸ªä¸ºçœŸçš„å…ƒç´ ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™æ¡ä»¶ä¸ºçœŸï¼Œæ‰§è¡Œ print() è¯­å¥ã€‚\nä½¿ç”¨ sum() å‡½æ•° x, y, z = 0, 1, 0 if sum((i == 1 for i in (x, y, z))): print(\u0026#39;passed\u0026#39;) åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼ç”Ÿæˆä¸€ä¸ªæ–°çš„è¿­ä»£å™¨å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«å˜é‡ xã€yã€z ä¸­æ¯ä¸ªå˜é‡æ˜¯å¦ç­‰äº 1 çš„å¸ƒå°”å€¼ã€‚ç„¶åï¼Œå°†è¿­ä»£å™¨å¯¹è±¡ä¼ é€’ç»™ sum() å‡½æ•°ï¼Œå®ƒä¼šå°†æ‰€æœ‰ä¸ºçœŸçš„å…ƒç´ åŠ èµ·æ¥å¹¶è¿”å›ä¸€ä¸ªæ•´æ•°ã€‚å¦‚æœè¿”å›çš„æ•´æ•°å¤§äº 0ï¼Œåˆ™æ¡ä»¶ä¸ºçœŸï¼Œæ‰§è¡Œ print() è¯­å¥ã€‚\nä½¿ç”¨ map() å‡½æ•°å’Œ any() å‡½æ•° x, y, z = 0, 1, 0 if any(map(lambda i: i == 1, (x, y, z))): print(\u0026#39;passed\u0026#39;) åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä½¿ç”¨ map() å‡½æ•°å°†ä¸€ä¸ªåŒ¿åå‡½æ•° lambda i: i == 1 åº”ç”¨äºå˜é‡ xã€yã€z ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå®ƒä¼šå°†æ¯ä¸ªå…ƒç´ ä¸ 1 è¿›è¡Œæ¯”è¾ƒå¹¶è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚ç„¶åï¼Œä½¿ç”¨ any() å‡½æ•°æ¥æµ‹è¯•è¿”å›çš„å¸ƒå°”å€¼åºåˆ—ä¸­æ˜¯å¦å­˜åœ¨è‡³å°‘ä¸€ä¸ªä¸ºçœŸçš„å…ƒç´ ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™æ¡ä»¶ä¸ºçœŸï¼Œæ‰§è¡Œ print() è¯­å¥ã€‚\nä½¿ç”¨ reduce() æ–¹æ³• from functools import reduce x, y, z = 0, 1, 0 if reduce(lambda a, b: a or b, (i == 1 for i in (x, y, z))): print(\u0026#39;passed\u0026#39;) åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼ç”Ÿæˆä¸€ä¸ªæ–°çš„è¿­ä»£å™¨å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«å˜é‡ xã€yã€z ä¸­æ¯ä¸ªå˜é‡æ˜¯å¦ç­‰äº 1 çš„å¸ƒå°”å€¼ã€‚ç„¶åï¼Œä½¿ç”¨ reduce() å‡½æ•°å°†ä¸€ä¸ªåŒ¿åå‡½æ•° lambda a, b: a or b åº”ç”¨äºè¿­ä»£å™¨å¯¹è±¡ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œå®ƒä¼šå°†æ‰€æœ‰å…ƒç´ æŒ‰ç…§å¸ƒå°”é€»è¾‘ or è¿›è¡Œèšåˆï¼Œå¹¶è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚å¦‚æœè¿”å›çš„å¸ƒå°”å€¼ä¸ºçœŸï¼Œåˆ™æ¡ä»¶ä¸ºçœŸï¼Œæ‰§è¡Œ print() è¯­å¥ã€‚\næœ¬å‘¨åˆ†äº« å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€ChenSoul Shareã€Telegram é¢‘é“æˆ–è€…æˆ‘çš„ memos ä¸­ã€‚æˆ‘å†™äº†ä¸€ä¸ª python è„šæœ¬ä» memos è¯»å–æœ€è¿‘ä¸€å‘¨çš„ memos è®°å½•ã€‚\n2023-05-10 ä¸€äº›éå¸¸æœ‰è¶£çš„ python çˆ¬è™«ä¾‹å­,å¯¹æ–°æ‰‹æ¯”è¾ƒå‹å¥½,ä¸»è¦çˆ¬å–æ·˜å®ã€å¤©çŒ«ã€å¾®ä¿¡ã€å¾®ä¿¡è¯»ä¹¦ã€è±†ç“£ã€QQ ç­‰ç½‘ç«™ã€‚æŸ¥çœ‹é“¾æ¥ #memos #python #tool 2023-05-08 è¿™ä¸ªç½‘ç«™æ•´ç†äº†å¼€å‘è€…çš„å­¦ä¹ æˆé•¿è·¯çº¿å›¾ï¼Œæœ‰æ¯”è¾ƒè¯¦ç»†çš„æŠ€èƒ½æ ‘ï¼Œæ¨èå­¦ä¹ å†…å®¹ç­‰ç­‰ï¼Œåå‘å¼€å‘è€…ã€‚ æŸ¥çœ‹é“¾æ¥ #memos #tool ä»¥ä¸Šã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/05/18/weekly_review_19/","summary":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-05-08 åˆ° 2023-05-14 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\næœ¬å‘¨ç»§ç»­å­¦ä¹  pythonï¼Œå‘ç°ä¸€ä¸ªè´¨é‡éå¸¸é«˜çš„ python å­¦ä¹ ç½‘ç«™ Real Pythonï¼Œè¯¥ç½‘ç«™æœ‰å­¦ä¹  python çš„ä¸€äº›æ•™ç¨‹ï¼Œæ˜¯æ”¶è´¹çš„ï¼Œéƒ¨åˆ†ç« èŠ‚æ˜¯å¯ä»¥å…è´¹è§‚çœ‹çš„ã€‚\nå¦å¤–ï¼Œå‘¨äº”æ™šä¸Šè€å©†ä¸´æ—¶èµ·æ„æƒ³å»æ­¦åŠŸå±±çœ‹æ—¥å‡ºï¼Œäºæ˜¯ç«‹å³è§„åˆ’è¡Œç¨‹å¹¶è´­ä¹°ç«è½¦ç¥¨ã€‚å› ä¸ºä¸€å¹´åŠä¹‹å‰ï¼Œæˆ‘å»è¿‡ä¸€æ¬¡ï¼Œæ‰€ä»¥è§„åˆ’èµ·æ¥è¿˜æ˜¯å¾ˆè½»æ¾çš„ã€‚ä¸Šä¸€æ¬¡å»æ˜¯å›½åº†èŠ‚ç¢°åˆ°ä¸‹é›¨ï¼Œæ²¡æœ‰çœ‹åˆ°æ—¥å‡ºã€‚å¹¸è¿çš„æ˜¯ï¼Œè¿™æ¬¡æ˜¯æ™´å¤©ï¼Œä¸ä»…çœ‹åˆ°äº†æ—¥è½è¿˜çœ‹åˆ°äº†æ—¥å‡ºã€‚è¿™ä¸€æ¬¡æ²¡æœ‰é€‰æ‹©ä½å¸ç¯·ï¼Œè€Œæ˜¯ä½åœ¨äº†äº‘ä¸­é›¾å®¢æ ˆï¼Œæ²¡æƒ³åˆ°è¿™ä¸ªå®¢æ ˆç¦»é‡‘é¡¶éœ€è¦ 40 åˆ†é’Ÿå·¦å³çš„è·¯ç¨‹ï¼Œè€Œä¸”æœ‰æ®µè·¯ç¨‹æ˜¯å‘å‘æ´¼æ´¼ã€‚\nå»æ­¦åŠŸå±±ä¹‹å‰ï¼Œå…ˆå»äº†é•¿æ²™ï¼Œå†æ¬¡æ¸¸äº†æ©˜å­æ´²å¤´ï¼Œå¹¶ç¬¬ä¸€æ¬¡åœ¨é•¿æ²™è·‘æ­¥æ‰“å¡ã€‚æœ¬æƒ³åœ¨èä¹¡ä¹Ÿè·‘æ­¥æ‰“å¡ï¼Œå¥ˆä½•æ²¡æœ‰å¾—é€ã€‚\nè¿™æ¬¡å»äº†é•¿æ²™å’Œæ­¦åŠŸå±±ï¼Œä¸‹æ¬¡åŸºæœ¬ä¸Šæ˜¯å†ä¹Ÿä¸ä¼šå»çˆ¬æ­¦åŠŸå±±äº†ã€‚é•¿æ²™è¿˜ä¼šå»ï¼Œå› ä¸ºä»æ­¦åŠŸå±±å›æ¥è·¯ä¸Šï¼Œå°±å’Œè€å©†è§„åˆ’ç€ä»€ä¹ˆæ—¶å€™å»å¼ å®¶ç•Œã€‚\næ­¦åŠŸå±±çœ‹æ—¥å‡º ç†è´¢ è¿™å‘¨æ€»è®¡æ”¯å‡º 1784 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š\n5 æœˆ 8 æ—¥ï¼š12 å…ƒ 5 æœˆ 9 æ—¥ï¼š18 å…ƒ 5 æœˆ 10 æ—¥ï¼š200 å…ƒ 5 æœˆ 11 æ—¥ï¼š12 å…ƒ 5 æœˆ 12 æ—¥ï¼š445 å…ƒ 5 æœˆ 13 æ—¥ï¼š662 å…ƒ 5 æœˆ 14 æ—¥ï¼š435 å…ƒ å› ä¸ºå‘¨æœ«å‡ºå»æ—…æ¸¸ï¼Œæ‰€ä»¥æœ¬å‘¨æ”¯å‡ºæœ‰æ‰€å¢å¤šã€‚\nå¥èº« æœ¬å‘¨è·‘æ­¥ 56 å…¬é‡Œï¼Œæœ€é•¿è·‘æ­¥è·ç¦»ä¸º 13 å…¬é‡Œã€‚\næ˜ç»†æ•°æ®å¦‚ä¸‹ï¼š\nå‘¨æœ«å‡ºå»æ—…æ¸¸ï¼Œè·¯è¿‡é•¿æ²™ï¼Œåœ¨é•¿æ²™è·‘äº†ä¸¤å¤©ï¼Œç´¯è®¡è·‘äº† 6 å…¬é‡Œã€‚è¿™æ ·ï¼Œæˆ‘çš„è·‘æ­¥æ•°æ® ä» 2 å¹´é‡Œæˆ‘è·‘è¿‡ 1 ä¸ªçœä»½ 1 ä¸ªåŸå¸‚ å˜æˆäº† 2 å¹´é‡Œæˆ‘è·‘è¿‡ 2 ä¸ªçœä»½ 2 ä¸ªåŸå¸‚ã€‚\nå·¥ä½œ Java åšå®¢ æœ¬å‘¨å®Œæˆä¸¤ç¯‡åšå®¢\nã€ŠEffective Java 3ã€‹ç¬”è®° 10ï¼šè¦†ç›– equals æ–¹æ³•æ—¶åº”éµå®ˆçš„çº¦å®š JSR 166 è§„èŒƒ Python Python åˆå­¦å»ºè®® 1ã€æ–°æ‰‹å¦‚ä½•å­¦ä¹  pythonï¼Ÿ","title":"å‘¨æŠ¥-19ï½œæ­¦åŠŸå±±çœ‹æ—¥å‡ºã€Pythonåˆå­¦å»ºè®®"},{"content":"JSR ä»‹ç» JSRï¼Œå…¨ç§° Java Specification Requestsï¼Œ å³ Java è§„èŒƒææ¡ˆï¼Œ ä¸»è¦æ˜¯ç”¨äºå‘ JCP(Java Community Process) æå‡ºæ–°å¢æ ‡å‡†åŒ–æŠ€æœ¯è§„èŒƒçš„æ­£å¼è¯·æ±‚ã€‚æ¯æ¬¡ JAVA ç‰ˆæœ¬æ›´æ–°éƒ½ä¼šæœ‰å¯¹åº”çš„ JSR æ›´æ–°ï¼Œæ¯”å¦‚åœ¨ Java 8 ç‰ˆæœ¬ä¸­ï¼Œå…¶æ–°ç‰¹æ€§ Lambda è¡¨è¾¾å¼å¯¹åº”çš„æ˜¯ JSR 335ï¼Œæ–°çš„æ—¥æœŸå’Œæ—¶é—´ API å¯¹åº”çš„æ˜¯ JSR 310ã€‚\nJSR 166 æ˜¯ Doug Lea æå‡ºçš„ä¸€ä¸ªå…³äº Java å¹¶å‘ç¼–ç¨‹çš„è§„èŒƒææ¡ˆã€‚JDK1.5 ä¹‹å‰ï¼Œæˆ‘ä»¬æ§åˆ¶ç¨‹åºå¹¶å‘è®¿é—®åŒæ­¥ä»£ç åªèƒ½ä½¿ç”¨ synchronizedï¼Œé‚£ä¸ªæ—¶å€™ synchronized çš„æ€§èƒ½è¿˜æ²¡ä¼˜åŒ–å¥½ï¼Œæ€§èƒ½å¹¶ä¸å¥½ï¼Œæ§åˆ¶çº¿ç¨‹ä¹Ÿåªèƒ½ä½¿ç”¨ Object çš„ wait å’Œ notify æ–¹æ³•ã€‚è¿™ä¸ªæ—¶å€™ Doug Lea ç»™ JCP æäº¤äº† JSR-166 çš„ææ¡ˆï¼Œåœ¨æäº¤ JSR-166 ä¹‹å‰ï¼ŒDoug Lea å·²ç»ä½¿ç”¨äº†ç±»ä¼¼ J.U.C åŒ…åŠŸèƒ½çš„ä»£ç å·²ç»ä¸‰å¹´å¤šäº†ï¼Œè¿™äº›ä»£ç å°±æ˜¯ J.U.C çš„åŸå‹ã€‚\nJ.U.Cï¼Œå³ java.util.concurrent çš„ç¼©å†™ï¼Œè¯¥åŒ…å‚è€ƒè‡ª EDU.oswego.cs.dl.util.concurrentï¼Œæ˜¯ JSR 166 æ ‡å‡†è§„èŒƒçš„ä¸€ä¸ªå®ç°ã€‚\nDoug Lea ä¸»é¡µï¼šDoug Lea\u0026rsquo;s Home Page JSR-166ï¼šConcurrency JSR-166 Interest Site JSR 166 Sliderï¼šJSR-166: Concurrency Utilities java.util.concurrent JavaDoc: JDK 1.5 ã€ JDK 7 ã€ JDK 8 ã€ JDK 9 JSR-166 åŒ…æ‹¬å¤šä¸ªè§„èŒƒï¼Œæ¯ä¸ªè§„èŒƒéƒ½å¼•å…¥äº†ä¸€äº›æ–°çš„æ¥å£å’Œç±»ï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†æè¿°ï¼š\nJSR-166ï¼ˆJava SE 5ï¼‰ï¼šå®šä¹‰äº† Java å¹¶å‘åŒ…çš„æ ¸å¿ƒæ¥å£å’Œç±»ï¼ŒåŒ…æ‹¬ Executors æ¡†æ¶ã€Queuesã€Timingã€Synchronizersã€Concurrent Collectionsã€Memory Consistency Propertiesã€Atomicã€Locks ç­‰ã€‚è¿™äº›æ¥å£å’Œç±»æä¾›äº†ä¸€ç§æ–¹ä¾¿ã€é«˜æ•ˆã€å¯æ‰©å±•çš„æ–¹å¼æ¥å¤„ç†å¼‚æ­¥ä»»åŠ¡å’Œå¹¶å‘ç¼–ç¨‹ã€‚ JSR-166xï¼ˆJava SE 7ï¼‰ï¼šå®šä¹‰äº† Java å¹¶å‘åŒ…ä¸­çš„ä¸€äº›æ–°ç‰¹æ€§ï¼ŒåŒ…æ‹¬ Phaserã€TransferQueueã€Exchangerã€LinkedTransferQueue ç­‰æ¥å£å’Œç±»ã€‚å…¶ä¸­ Phaser æ”¯æŒåˆ†é˜¶æ®µæ‰§è¡Œä»»åŠ¡ï¼ŒTransferQueue å’Œ LinkedTransferQueue å®ç°äº†é«˜æ•ˆçš„ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼ŒExchanger æ”¯æŒä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´äº¤æ¢æ•°æ®ã€‚ JSR-166yï¼ˆJava SE 8ï¼‰ï¼šå®šä¹‰äº† Java å¹¶å‘åŒ…ä¸­çš„ä¸€äº›æ–°ç‰¹æ€§ï¼ŒåŒ…æ‹¬ StampedLockã€CompletableFutureã€LongAdder ç­‰æ¥å£å’Œç±»ã€‚å…¶ä¸­ StampedLock æ˜¯ä¸€ç§ä¹è§‚é”ï¼Œæ”¯æŒè¯»å†™åˆ†ç¦»ï¼ŒCompletableFuture æ”¯æŒå¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå’Œç»“æœå¤„ç†ï¼ŒLongAdder æ˜¯ä¸€ç§é«˜æ•ˆçš„è®¡æ•°å™¨ã€‚ JSR-166zï¼ˆJava SE 9ï¼‰ï¼šå®šä¹‰äº† Java å¹¶å‘åŒ…ä¸­çš„ä¸€äº›æ–°ç‰¹æ€§ï¼ŒåŒ…æ‹¬ VarHandleã€Fences ç­‰æ¥å£å’Œç±»ã€‚å…¶ä¸­ VarHandle æä¾›äº†ä¸€ç§æ›´åŠ çµæ´»çš„åŸå­æ“ä½œæ–¹å¼ï¼ŒFences æä¾›äº†ä¸€äº›æ–¹æ³•ç”¨äºæ§åˆ¶å†…å­˜å±éšœã€‚ JUC java.util.concurrent åŒ…ä¸‹çš„ç±»ä»¥åŠå¼•å…¥ç‰ˆæœ¬ï¼ˆæ²¡æœ‰æ ‡æ³¨ç‰ˆæœ¬å·çš„ä¸º 1.5 ï¼‰ï¼š\njava.util.concurrent java.util.concurrent.locks AbstractOwnableSynchronizer 1.6 AbstractQueuedLongSynchronizer 1.6 AbstractQueuedSynchronizer Condition Lock LockSupport ReadWriteLock ReentrantLock ReentrantReadWriteLock StampedLock 1.8 java.util.concurrent.atomic AtomicBoolean AtomicInteger AtomicIntegerArray AtomicIntegerFieldUpdater AtomicLong AtomicLongArray AtomicLongFieldUpdater AtomicMarkableReference AtomicReference AtomicReferenceArray AtomicReferenceFieldUpdater AtomicStampedReference DoubleAccumulator 1.8 DoubleAdder 1.8 LongAccumulator 1.8 LongAdder 1.8 AbstractExecutorService ArrayBlockingQueue BlockingDeque 1.6 BlockingQueue BrokenBarrierException Callable CancellationException CompletableFuture 1.8 CompletionException 1.8 CompletionService CompletionStage 1.8 ConcurrentHashMap ConcurrentLinkedDeque 1.7 ConcurrentLinkedQueue ConcurrentMap ConcurrentNavigableMap 1.6 ConcurrentSkipListMap 1.6 ConcurrentSkipListSet 1.6 CopyOnWriteArrayList CopyOnWriteArraySet CountDownLatch CountedCompleter 1.8 CyclicBarrier Delayed DelayQueue Exchanger ExecutionException Executor ExecutorCompletionService Executors ExecutorService Flow 1.9 ForkJoinPool 1.7 ForkJoinTask 1.7 ForkJoinWorkerThread 1.7 Future FutureTask LinkedBlockingDeque 1.6 LinkedBlockingQueue LinkedTransferQueue 1.7 Phaser 1.7 PriorityBlockingQueue RecursiveAction 1.7 RecursiveTask 1.7 RejectedExecutionException RejectedExecutionHandler RunnableFuture RunnableScheduledFuture ScheduledExecutorService ScheduledFuture ScheduledThreadPoolExecutor Semaphore SubmissionPublisher 1.9 SynchronousQueue ThreadFactory ThreadLocalRandom 1.7 ThreadPoolExecutor TimeoutException TimeUnit TransferQueue 1.7 å¤§è‡´å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š\nåŸå­æ›´æ–° é”å’Œæ¡ä»¶ çº¿ç¨‹æ±  å¹¶å‘å®¹å™¨ åŒæ­¥å™¨ åœ¨å­¦ä¹  JUC ä¹‹å‰æˆ‘ä»¬éœ€è¦äº†è§£ CASï¼ŒAQS å’Œ Unsafeã€‚\nCASï¼š AQSï¼š Unsafeï¼š CAS CASï¼ˆCompare and Swapï¼‰æ˜¯ä¸€ç§åŸºäºåŸå­æ€§æ“ä½œçš„å¹¶å‘ç¼–ç¨‹æŠ€æœ¯ï¼Œå¸¸ç”¨äºå®ç°çº¿ç¨‹å®‰å…¨çš„æ•°æ®ç»“æ„å’Œç®—æ³•ã€‚CAS æ“ä½œç”±ä¸‰ä¸ªå‚æ•°ç»„æˆï¼šå†…å­˜ä½ç½® Vã€æœŸæœ›å€¼ Aã€æ–°å€¼ Bã€‚å½“ä¸”ä»…å½“ V çš„å€¼ç­‰äº A æ—¶ï¼ŒCAS æ“ä½œæ‰ä¼šå°† V çš„å€¼è®¾ç½®ä¸º Bï¼Œå¦åˆ™ä¸åšä»»ä½•æ“ä½œã€‚å®ƒçš„å®ç°åŸç†å¯ä»¥ç®€å•æ¦‚æ‹¬ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š\nè¯»å–å†…å­˜ä½ç½® V çš„å€¼ï¼ŒåŒæ—¶è®°å½•ä¸‹è¯¥å€¼çš„ç‰ˆæœ¬å·æˆ–æ ‡è®°ä½ã€‚ æ£€æŸ¥å†…å­˜ä½ç½® V çš„å€¼æ˜¯å¦ç­‰äºæœŸæœ›å€¼ Aã€‚å¦‚æœç›¸ç­‰ï¼Œåˆ™æ‰§è¡Œç¬¬ 3 æ­¥ï¼›å¦åˆ™ï¼Œæ“ä½œå¤±è´¥ã€‚ å°†æ–°å€¼ B å†™å…¥å†…å­˜ä½ç½® Vï¼Œå¹¶æ›´æ–°å…¶ç‰ˆæœ¬å·æˆ–æ ‡è®°ä½ã€‚ è¿”å›æ“ä½œç»“æœã€‚ CAS æ“ä½œæ˜¯ä¸€ç§ä¹è§‚é”æœºåˆ¶ï¼Œå®ƒä¸éœ€è¦é”å®šæ•´ä¸ªå…±äº«èµ„æºï¼Œè€Œæ˜¯åªé’ˆå¯¹éœ€è¦ä¿®æ”¹çš„å€¼è¿›è¡ŒåŸå­æ€§æ“ä½œï¼Œä»è€Œé¿å…äº†é”çš„ç«äº‰å’Œå¼€é”€ã€‚åœ¨æ‰§è¡Œ CAS æ“ä½œæ—¶ï¼Œçº¿ç¨‹ä¼šå¯¹å†…å­˜ä½ç½®è¿›è¡Œè¯»å–å’Œå†™å…¥ï¼Œä½†åŒæ—¶ä¹Ÿä¼šæ£€æŸ¥å†…å­˜ä½ç½®çš„ç‰ˆæœ¬å·æˆ–æ ‡è®°ä½ï¼Œä»¥ä¿è¯æ“ä½œçš„åŸå­æ€§å’Œä¸€è‡´æ€§ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œ CAS æ“ä½œï¼Œå¯èƒ½ä¼šå‡ºç° ABA é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œçº¿ç¨‹ A è¯»å–å†…å­˜ä½ç½® V çš„å€¼ä¸º Aï¼Œç„¶åçº¿ç¨‹ B å°† V çš„å€¼ä¿®æ”¹ä¸º Bï¼Œæœ€åçº¿ç¨‹ B åˆå°† V çš„å€¼ä¿®æ”¹ä¸º Aã€‚æ­¤æ—¶ï¼Œçº¿ç¨‹ A æ‰§è¡Œ CAS æ“ä½œæ—¶ï¼Œä¼šå‘ç°å†…å­˜ä½ç½® V çš„å€¼è¿˜æ˜¯ Aï¼Œè™½ç„¶è¿™ä¸ª A çš„ç‰ˆæœ¬å·æˆ–æ ‡è®°ä½ä¸ä¹‹å‰ä¸åŒï¼Œä½†çº¿ç¨‹ A å¹¶ä¸çŸ¥é“ V çš„å€¼æ›¾ç»è¢«ä¿®æ”¹è¿‡ï¼Œå› æ­¤ä¼šå°†æ–°å€¼å†™å…¥å†…å­˜ä½ç½® Vï¼Œä»è€Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚ä¸ºäº†è§£å†³ ABA é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨å¸¦æœ‰ç‰ˆæœ¬å·æˆ–æ ‡è®°ä½çš„ CAS æ“ä½œï¼Œæˆ–è€…ä½¿ç”¨å…¶ä»–çš„å¹¶å‘ç¼–ç¨‹æŠ€æœ¯ï¼Œä¾‹å¦‚é”æˆ–è¯»å†™é”ã€‚\nJava ä¸­çš„AtomicXXXç±»å®ç°äº† CAS æ“ä½œï¼Œä¾‹å¦‚ AtomicIntegerã€AtomicLong ç­‰ã€‚è¿™äº›ç±»æä¾›äº†ä¸€ç»„åŸå­æ€§æ“ä½œæ–¹æ³•ï¼Œä¾‹å¦‚ get()ã€set()ã€addAndGet()ã€compareAndSet()ç­‰ï¼Œå®ƒä»¬å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹å®‰å…¨åœ°ä½¿ç”¨ã€‚\nCAS æ“ä½œè™½ç„¶å…å»äº†é”çš„å¼€é”€ï¼Œä½†ä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ã€‚é¦–å…ˆï¼ŒCAS æ“ä½œéœ€è¦è¿›è¡Œå¤šæ¬¡å°è¯•ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚å¦‚æœå¹¶å‘ç¨‹åº¦è¾ƒé«˜ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œ CAS æ“ä½œï¼Œå¯èƒ½ä¼šå¯¼è‡´å¤§é‡çš„ CAS æ“ä½œå¤±è´¥ï¼Œä»è€Œé™ä½æ€§èƒ½ã€‚å…¶æ¬¡ï¼ŒCAS æ“ä½œåªèƒ½ä¿è¯å•ä¸ªå˜é‡çš„åŸå­æ€§æ“ä½œï¼Œæ— æ³•ä¿è¯å¤šä¸ªå˜é‡ä¹‹é—´çš„æ“ä½œçš„åŸå­æ€§ï¼Œå› æ­¤éœ€è¦é¢å¤–çš„æªæ–½æ¥ä¿è¯å¤šä¸ªå˜é‡ä¹‹é—´çš„ä¸€è‡´æ€§ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ AtomicInteger å®ç°ç®€å•è®¡æ•°å™¨çš„ä¾‹å­ï¼š\nimport java.util.concurrent.atomic.AtomicInteger; public class Counter { private AtomicInteger value = new AtomicInteger(0); public void increment() { int oldValue, newValue; do { oldValue = value.get(); newValue = oldValue + 1; } while (!value.compareAndSet(oldValue, newValue)); } public int getValue() { return value.get(); } } åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œincrement() æ–¹æ³•ä½¿ç”¨ do-while å¾ªç¯å’ŒcompareAndSet()æ–¹æ³•æ‰§è¡Œ CAS æ“ä½œæ¥å¢åŠ è®¡æ•°å™¨çš„å€¼ã€‚è¯¥æ–¹æ³•é‡å¤ä½¿ç”¨get()æ–¹æ³•è¯»å–è®¡æ•°å™¨çš„å½“å‰å€¼ï¼Œè®¡ç®—æ–°å€¼ï¼Œç„¶åå°è¯•ä½¿ç”¨compareAndSet()æ–¹æ³•æ›´æ–°è®¡æ•°å™¨ã€‚å¾ªç¯å°†ç»§ç»­ï¼Œç›´åˆ° CAS æ“ä½œæˆåŠŸå¹¶ä¸”è®¡æ•°å™¨æˆåŠŸæ›´æ–°ã€‚\ngetValue() æ–¹æ³•ä½¿ç”¨get()æ–¹æ³•ç®€å•åœ°è¿”å›è®¡æ•°å™¨çš„å½“å‰å€¼ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä½¿ç”¨ CAS æ“ä½œæ—¶ï¼Œéœ€è¦å°å¿ƒå¤„ç†æ½œåœ¨çš„ ABA é—®é¢˜ï¼Œå…¶ä¸­å…±äº«å˜é‡çš„å€¼å¯èƒ½åœ¨åˆå§‹è¯»å–å’Œæ›´æ–°å°è¯•ä¹‹é—´å¤šæ¬¡æ›´æ”¹ã€‚ä¸€ç§å¤„ç†æ–¹æ³•æ˜¯åœ¨å…±äº«å˜é‡ä¸­ä½¿ç”¨ç‰ˆæœ¬å·æˆ–æ—¶é—´æˆ³ï¼Œä»¥ç¡®ä¿æ›´æ–°ä»…åœ¨å€¼æœªæ›´æ”¹çš„æƒ…å†µä¸‹æˆåŠŸã€‚\nABA é—®é¢˜æ˜¯åœ¨ä½¿ç”¨ CASï¼ˆCompare-and-Swapï¼‰æ“ä½œè¿›è¡Œå¹¶å‘ç¼–ç¨‹æ—¶ç»å¸¸é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜ã€‚å®ƒå‘ç”Ÿåœ¨ä¸€ä¸ªçº¿ç¨‹ä»å…±äº«å†…å­˜ä½ç½®è¯»å–ä¸€ä¸ªå€¼ï¼Œç„¶åå¦ä¸€ä¸ªçº¿ç¨‹å°†è¯¥å€¼æ›´æ”¹ä¸ºå¦ä¸€ä¸ªå€¼ï¼Œæœ€ååˆå°†å…¶æ›´æ”¹å›åŸå§‹å€¼ï¼Œä»è€Œä½¿ç¬¬ä¸€ä¸ªçº¿ç¨‹çš„æ“ä½œæ„å¤–æˆåŠŸã€‚\nä¸ºäº†å¤„ç† ABA é—®é¢˜ï¼Œå¸¸ç”¨çš„æ–¹æ³•æ˜¯åœ¨å…±äº«å†…å­˜ä½ç½®ä¸­æ·»åŠ ä¸€ä¸ªç‰ˆæœ¬å·æˆ–æ—¶é—´æˆ³ã€‚ç‰ˆæœ¬å·æˆ–æ—¶é—´æˆ³å¯ä»¥åœ¨æ¯æ¬¡ä¿®æ”¹å†…å­˜ä½ç½®æ—¶è¿›è¡Œé€’å¢æˆ–æ›´æ–°ã€‚è¿™å¯ä»¥ç¡®ä¿ CAS æ“ä½œä¸ä»…æ£€æŸ¥å€¼ï¼Œè¿˜æ£€æŸ¥å†…å­˜ä½ç½®çš„ç‰ˆæœ¬å·æˆ–æ—¶é—´æˆ³ã€‚\nä»¥ä¸‹æ˜¯ä½¿ç”¨ç‰ˆæœ¬å·å¤„ç† ABA é—®é¢˜çš„ç¤ºä¾‹ï¼š\nimport java.util.concurrent.atomic.AtomicStampedReference; public class ConcurrentStack\u0026lt;T\u0026gt; { private AtomicStampedReference\u0026lt;Node\u0026lt;T\u0026gt;\u0026gt; top = new AtomicStampedReference\u0026lt;\u0026gt;(null, 0); public void push(T value) { Node\u0026lt;T\u0026gt; newHead = new Node\u0026lt;\u0026gt;(value); int[] stampHolder = new int[1]; Node\u0026lt;T\u0026gt; oldHead; do { oldHead = top.get(stampHolder); newHead.next = oldHead; stampHolder[0]++; } while (!top.compareAndSet(oldHead, newHead, stampHolder[0] - 1, stampHolder[0])); } public T pop() { Node\u0026lt;T\u0026gt; oldHead; int[] stampHolder = new int[1]; do { oldHead = top.get(stampHolder); if (oldHead == null) { return null; } } while (!top.compareAndSet(oldHead, oldHead.next, stampHolder[0], stampHolder[0] + 1)); return oldHead.value; } private static class Node\u0026lt;T\u0026gt; { private final T value; private Node\u0026lt;T\u0026gt; next; private Node(T value) { this.value = value; } } } åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒConcurrentStack ç±»ä½¿ç”¨ AtomicStampedReference å­˜å‚¨æ ˆé¡¶èŠ‚ç‚¹ã€‚AtomicStampedReference ç±»å­˜å‚¨å€¼çš„å¼•ç”¨å’Œç‰ˆæœ¬å·ï¼Œç‰ˆæœ¬å·åœ¨å¼•ç”¨æ›´æ”¹æ—¶è¿›è¡Œæ›´æ–°ã€‚\npush() æ–¹æ³•ä½¿ç”¨æ–°å€¼åˆ›å»ºä¸€ä¸ªæ–°çš„ Nodeï¼Œç„¶åå°è¯•ä½¿ç”¨ CAS æ“ä½œå°†å…¶æ¨å…¥æ ˆä¸­ã€‚å¾ªç¯å°†ç»§ç»­ï¼Œç›´åˆ° CAS æ“ä½œæˆåŠŸï¼ŒèŠ‚ç‚¹æˆåŠŸæ¨å…¥æ ˆä¸­ã€‚\npop() æ–¹æ³•å°è¯•ä½¿ç”¨ CAS æ“ä½œä»æ ˆä¸­å¼¹å‡ºé¡¶éƒ¨èŠ‚ç‚¹ã€‚å¾ªç¯å°†ç»§ç»­ï¼Œç›´åˆ°é¡¶éƒ¨èŠ‚ç‚¹æˆåŠŸå¼¹å‡ºæˆ–æ ˆä¸ºç©ºä¸ºæ­¢ã€‚\né€šè¿‡ä½¿ç”¨å…·æœ‰ç‰ˆæœ¬å·çš„ AtomicStampedReferenceï¼ŒConcurrentStack ç±»å¯ä»¥å¤„ç†åœ¨å¹¶å‘æ“ä½œä¸­å¯èƒ½å‘ç”Ÿçš„ ABA é—®é¢˜ã€‚\nAQS AQSï¼ˆAbstractQueuedSynchronizerï¼‰æ˜¯ Java ä¸­ç”¨äºå®ç°åŒæ­¥å™¨ï¼ˆå¦‚é”ï¼Œä¿¡å·é‡ç­‰ï¼‰çš„æ¡†æ¶ï¼Œå®ƒæä¾›äº†ä¸€äº›åŸºæœ¬çš„åŒæ­¥æ“ä½œï¼Œä¾‹å¦‚è·å–é”ã€é‡Šæ”¾é”ã€ç­‰å¾…æ¡ä»¶ã€å”¤é†’çº¿ç¨‹ç­‰ã€‚\nAQS çš„å®ç°åŸç†åŸºäºä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œç”¨äºç»´æŠ¤ç­‰å¾…çº¿ç¨‹çš„é˜Ÿåˆ—ã€‚å½“ä¸€ä¸ªçº¿ç¨‹éœ€è¦è·å–åŒæ­¥å™¨æ—¶ï¼Œå®ƒä¼šé¦–å…ˆå°è¯•ä½¿ç”¨ CAS æ“ä½œæ¥è·å–åŒæ­¥å™¨ï¼Œå¦‚æœè·å–æˆåŠŸï¼Œåˆ™ç»§ç»­æ‰§è¡Œï¼›å¦‚æœè·å–å¤±è´¥ï¼Œåˆ™å°†çº¿ç¨‹åŠ å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œå¹¶å°†å…¶æŒ‚èµ·ã€‚å½“åŒæ­¥å™¨é‡Šæ”¾æ—¶ï¼Œå®ƒä¼šå”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ï¼Œå¹¶å°†å®ƒä»¬ä»ç­‰å¾…é˜Ÿåˆ—ä¸­ç§»é™¤ï¼Œä½¿å®ƒä»¬å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚\nAQS çš„ç­‰å¾…é˜Ÿåˆ—æ˜¯é€šè¿‡ä¸€ä¸ªåŒå‘é“¾è¡¨æ¥å®ç°çš„ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ï¼ŒèŠ‚ç‚¹ä¸­åŒ…å«äº†çº¿ç¨‹çš„çŠ¶æ€ä»¥åŠç­‰å¾…æ¡ä»¶ç­‰ä¿¡æ¯ã€‚ç­‰å¾…é˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹æ˜¯æŒ‰ç…§ç­‰å¾…æ—¶é—´çš„å…ˆåé¡ºåºæ’åˆ—çš„ï¼Œå…ˆç­‰å¾…çš„çº¿ç¨‹æ’åœ¨å‰é¢ï¼Œåç­‰å¾…çš„çº¿ç¨‹æ’åœ¨åé¢ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è¢«å”¤é†’æ—¶ï¼Œå®ƒä¼šé‡æ–°å°è¯•è·å–åŒæ­¥å™¨ï¼Œå¦‚æœè·å–æˆåŠŸï¼Œåˆ™ç»§ç»­æ‰§è¡Œï¼›å¦‚æœè·å–å¤±è´¥ï¼Œåˆ™å®ƒä¼šå†æ¬¡åŠ å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œå¹¶å°†è‡ªå·±æŒ‚èµ·ã€‚\nAQS çš„å…·ä½“å®ç°æ˜¯é€šè¿‡é‡å†™å…¶å†…éƒ¨çš„ä¸€äº›æ–¹æ³•æ¥å®ç°çš„ã€‚ä¾‹å¦‚ï¼ŒtryAcquire() æ–¹æ³•ç”¨äºå®ç°è·å–åŒæ­¥å™¨çš„é€»è¾‘ï¼Œå®ƒä¼šé¦–å…ˆå°è¯•ä½¿ç”¨ CAS æ“ä½œæ¥è·å–åŒæ­¥å™¨ï¼Œå¦‚æœè·å–æˆåŠŸï¼Œåˆ™è¿”å› trueï¼›å¦åˆ™è¿”å› falseã€‚tryRelease() æ–¹æ³•ç”¨äºå®ç°é‡Šæ”¾åŒæ­¥å™¨çš„é€»è¾‘ï¼Œå®ƒä¼šé‡Šæ”¾åŒæ­¥å™¨ï¼Œå¹¶å”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ã€‚tryAcquireShared() å’Œ tryReleaseShared() æ–¹æ³•åˆ™ç”¨äºå®ç°å…±äº«å¼åŒæ­¥å™¨çš„é€»è¾‘ï¼Œå®ƒä»¬ç±»ä¼¼äº tryAcquire() å’Œ tryRelease() æ–¹æ³•ï¼Œä½†æ˜¯å¯ä»¥æ”¯æŒå¤šä¸ªçº¿ç¨‹åŒæ—¶è·å–æˆ–é‡Šæ”¾åŒæ­¥å™¨ã€‚\nUnsafe Unsafe ç±»æ˜¯ Java ä¸­ä¸€ä¸ªéå¸¸ç‰¹æ®Šä¸”å¼ºå¤§çš„ç±»ï¼Œå®ƒæä¾›äº†ä¸€äº›ä¸å®‰å…¨çš„æ“ä½œï¼Œä¾‹å¦‚ç›´æ¥æ“ä½œå†…å­˜ã€çº¿ç¨‹æŒ‚èµ·å’Œæ¢å¤ç­‰ã€‚Unsafe ç±»æ˜¯ Java ä¸­å°‘æ•°å‡ ä¸ªä¸è¢«å…¬å¼€æ”¯æŒçš„ç±»ä¹‹ä¸€ï¼Œå®ƒä¸»è¦è¢«ç”¨äº Java æ ¸å¿ƒåº“å’Œå…¶ä»–ä¸€äº›é«˜çº§æ¡†æ¶ä¸­ï¼Œå¦‚ Nettyã€Hadoop å’Œ Kafka ç­‰ã€‚\nç”±äº Unsafe ç±»æä¾›äº†ä¸€äº›ä¸å®‰å…¨çš„æ“ä½œï¼Œå› æ­¤å®ƒçš„ä½¿ç”¨éœ€è¦éå¸¸å°å¿ƒã€‚å¦‚æœä¸æ­£ç¡®åœ°ä½¿ç”¨ Unsafe ç±»ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç¨‹åºå´©æºƒæˆ–å®‰å…¨æ¼æ´ã€‚å› æ­¤ï¼ŒJava å®˜æ–¹å¹¶ä¸å»ºè®®å¼€å‘äººå‘˜ä½¿ç”¨ Unsafe ç±»ï¼Œè€Œæ˜¯å»ºè®®å¼€å‘äººå‘˜ä½¿ç”¨æ›´åŠ å®‰å…¨å’Œæ ‡å‡†çš„ Java APIã€‚\nUnsafe ç±»ä¸­ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•åŒ…æ‹¬ï¼š\nallocateMemory(long size)ï¼šåˆ†é…ä¸€æ®µæŒ‡å®šå¤§å°çš„å†…å­˜ç©ºé—´ã€‚ freeMemory(long address)ï¼šé‡Šæ”¾æŒ‡å®šåœ°å€çš„å†…å­˜ç©ºé—´ã€‚ putXXX(Object target, long offset, XXX value)ï¼šå°†æŒ‡å®šç±»å‹çš„å€¼å†™å…¥ç›®æ ‡å¯¹è±¡çš„æŒ‡å®šåç§»é‡å¤„ã€‚ getXXX(Object target, long offset)ï¼šä»ç›®æ ‡å¯¹è±¡çš„æŒ‡å®šåç§»é‡å¤„è¯»å–æŒ‡å®šç±»å‹çš„å€¼ã€‚ park(boolean isAbsolute, long time)ï¼šæŒ‚èµ·å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°è¢«å…¶ä»–çº¿ç¨‹å”¤é†’æˆ–æŒ‡å®šçš„æ—¶é—´åˆ°æœŸã€‚ unpark(Thread thread)ï¼šæ¢å¤æŒ‡å®šçº¿ç¨‹çš„è¿è¡Œã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒUnsafe ç±»ä¸­çš„å¤§éƒ¨åˆ†æ–¹æ³•éƒ½æ˜¯ native æ–¹æ³•ï¼Œå®ç°æ–¹å¼ä¾èµ–äºåº•å±‚æ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶å¹³å°ã€‚è¿™æ„å‘³ç€ Unsafe ç±»ä¸­çš„æ–¹æ³•åœ¨ä¸åŒçš„å¹³å°ä¸Šå¯èƒ½ä¼šæœ‰ä¸åŒçš„è¡Œä¸ºï¼Œå› æ­¤éœ€è¦é’ˆå¯¹ä¸åŒçš„å¹³å°è¿›è¡Œæµ‹è¯•å’ŒéªŒè¯ã€‚\nJava 9 ä¸­å®˜æ–¹æå‡ºäº†ç§»é™¤ Sun.misc.Unsafe ç±»ï¼Œå¹¶åœ¨è¯¥ç‰ˆæœ¬ä¸­å°†è¯¥ç±»æ ‡è®°ä¸ºä¸æ¨èä½¿ç”¨ã€‚ç„¶è€Œï¼Œç”±äº Unsafe ç±»åœ¨ Java è¯­è¨€ç”Ÿæ€ä¸­çš„åº”ç”¨éå¸¸å¹¿æ³›ï¼Œè®¸å¤šæ¡†æ¶å’Œåº“éƒ½ä¾èµ–äº Unsafe ç±»æ¥å®ç°é«˜æ€§èƒ½å’Œä½å±‚æ¬¡çš„æ“ä½œã€‚å› æ­¤ï¼Œåœ¨ Java 9 ä¸­ï¼Œå®˜æ–¹å¼•å…¥äº† jdk.internal.misc.Unsafe ç±»æ¥æ›¿ä»£ Sun.misc.Unsafe ç±»çš„åŠŸèƒ½ï¼Œä»¥ä¿æŒå¯¹ Java ç”Ÿæ€ä¸­ä½¿ç”¨ Unsafe ç±»çš„æ”¯æŒã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/05/18/jsr-166/","summary":"JSR ä»‹ç» JSRï¼Œå…¨ç§° Java Specification Requestsï¼Œ å³ Java è§„èŒƒææ¡ˆï¼Œ ä¸»è¦æ˜¯ç”¨äºå‘ JCP(Java Community Process) æå‡ºæ–°å¢æ ‡å‡†åŒ–æŠ€æœ¯è§„èŒƒçš„æ­£å¼è¯·æ±‚ã€‚æ¯æ¬¡ JAVA ç‰ˆæœ¬æ›´æ–°éƒ½ä¼šæœ‰å¯¹åº”çš„ JSR æ›´æ–°ï¼Œæ¯”å¦‚åœ¨ Java 8 ç‰ˆæœ¬ä¸­ï¼Œå…¶æ–°ç‰¹æ€§ Lambda è¡¨è¾¾å¼å¯¹åº”çš„æ˜¯ JSR 335ï¼Œæ–°çš„æ—¥æœŸå’Œæ—¶é—´ API å¯¹åº”çš„æ˜¯ JSR 310ã€‚\nJSR 166 æ˜¯ Doug Lea æå‡ºçš„ä¸€ä¸ªå…³äº Java å¹¶å‘ç¼–ç¨‹çš„è§„èŒƒææ¡ˆã€‚JDK1.5 ä¹‹å‰ï¼Œæˆ‘ä»¬æ§åˆ¶ç¨‹åºå¹¶å‘è®¿é—®åŒæ­¥ä»£ç åªèƒ½ä½¿ç”¨ synchronizedï¼Œé‚£ä¸ªæ—¶å€™ synchronized çš„æ€§èƒ½è¿˜æ²¡ä¼˜åŒ–å¥½ï¼Œæ€§èƒ½å¹¶ä¸å¥½ï¼Œæ§åˆ¶çº¿ç¨‹ä¹Ÿåªèƒ½ä½¿ç”¨ Object çš„ wait å’Œ notify æ–¹æ³•ã€‚è¿™ä¸ªæ—¶å€™ Doug Lea ç»™ JCP æäº¤äº† JSR-166 çš„ææ¡ˆï¼Œåœ¨æäº¤ JSR-166 ä¹‹å‰ï¼ŒDoug Lea å·²ç»ä½¿ç”¨äº†ç±»ä¼¼ J.U.C åŒ…åŠŸèƒ½çš„ä»£ç å·²ç»ä¸‰å¹´å¤šäº†ï¼Œè¿™äº›ä»£ç å°±æ˜¯ J.U.C çš„åŸå‹ã€‚\nJ.U.Cï¼Œå³ java.util.concurrent çš„ç¼©å†™ï¼Œè¯¥åŒ…å‚è€ƒè‡ª EDU.oswego.cs.dl.util.concurrentï¼Œæ˜¯ JSR 166 æ ‡å‡†è§„èŒƒçš„ä¸€ä¸ªå®ç°ã€‚\nDoug Lea ä¸»é¡µï¼šDoug Lea\u0026rsquo;s Home Page JSR-166ï¼šConcurrency JSR-166 Interest Site JSR 166 Sliderï¼šJSR-166: Concurrency Utilities java.util.concurrent JavaDoc: JDK 1.5 ã€ JDK 7 ã€ JDK 8 ã€ JDK 9 JSR-166 åŒ…æ‹¬å¤šä¸ªè§„èŒƒï¼Œæ¯ä¸ªè§„èŒƒéƒ½å¼•å…¥äº†ä¸€äº›æ–°çš„æ¥å£å’Œç±»ï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†æè¿°ï¼š\nJSR-166ï¼ˆJava SE 5ï¼‰ï¼šå®šä¹‰äº† Java å¹¶å‘åŒ…çš„æ ¸å¿ƒæ¥å£å’Œç±»ï¼ŒåŒ…æ‹¬ Executors æ¡†æ¶ã€Queuesã€Timingã€Synchronizersã€Concurrent Collectionsã€Memory Consistency Propertiesã€Atomicã€Locks ç­‰ã€‚è¿™äº›æ¥å£å’Œç±»æä¾›äº†ä¸€ç§æ–¹ä¾¿ã€é«˜æ•ˆã€å¯æ‰©å±•çš„æ–¹å¼æ¥å¤„ç†å¼‚æ­¥ä»»åŠ¡å’Œå¹¶å‘ç¼–ç¨‹ã€‚ JSR-166xï¼ˆJava SE 7ï¼‰ï¼šå®šä¹‰äº† Java å¹¶å‘åŒ…ä¸­çš„ä¸€äº›æ–°ç‰¹æ€§ï¼ŒåŒ…æ‹¬ Phaserã€TransferQueueã€Exchangerã€LinkedTransferQueue ç­‰æ¥å£å’Œç±»ã€‚å…¶ä¸­ Phaser æ”¯æŒåˆ†é˜¶æ®µæ‰§è¡Œä»»åŠ¡ï¼ŒTransferQueue å’Œ LinkedTransferQueue å®ç°äº†é«˜æ•ˆçš„ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼ŒExchanger æ”¯æŒä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´äº¤æ¢æ•°æ®ã€‚ JSR-166yï¼ˆJava SE 8ï¼‰ï¼šå®šä¹‰äº† Java å¹¶å‘åŒ…ä¸­çš„ä¸€äº›æ–°ç‰¹æ€§ï¼ŒåŒ…æ‹¬ StampedLockã€CompletableFutureã€LongAdder ç­‰æ¥å£å’Œç±»ã€‚å…¶ä¸­ StampedLock æ˜¯ä¸€ç§ä¹è§‚é”ï¼Œæ”¯æŒè¯»å†™åˆ†ç¦»ï¼ŒCompletableFuture æ”¯æŒå¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå’Œç»“æœå¤„ç†ï¼ŒLongAdder æ˜¯ä¸€ç§é«˜æ•ˆçš„è®¡æ•°å™¨ã€‚ JSR-166zï¼ˆJava SE 9ï¼‰ï¼šå®šä¹‰äº† Java å¹¶å‘åŒ…ä¸­çš„ä¸€äº›æ–°ç‰¹æ€§ï¼ŒåŒ…æ‹¬ VarHandleã€Fences ç­‰æ¥å£å’Œç±»ã€‚å…¶ä¸­ VarHandle æä¾›äº†ä¸€ç§æ›´åŠ çµæ´»çš„åŸå­æ“ä½œæ–¹å¼ï¼ŒFences æä¾›äº†ä¸€äº›æ–¹æ³•ç”¨äºæ§åˆ¶å†…å­˜å±éšœã€‚ JUC java.","title":"JSR 166è§„èŒƒ"},{"content":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬ä¸‰ç« ã€Šå¯¹è±¡çš„é€šç”¨æ–¹æ³•ã€‹çš„å­¦ä¹ ç¬”è®°ï¼šè¦†ç›– equals æ–¹æ³•æ—¶åº”éµå®ˆçš„çº¦å®šã€‚\nä»‹ç» è¦†ç›– equals æ–¹æ³•ä¼¼ä¹å¾ˆç®€å•ï¼Œä½†æ˜¯æœ‰å¾ˆå¤šè¦†ç›–çš„æ–¹å¼ä¼šå¯¼è‡´å‡ºé”™ï¼Œè€Œä¸”åæœå¯èƒ½éå¸¸ä¸¥é‡ã€‚é¿å…é—®é¢˜çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä¸è¦†ç›– equals æ–¹æ³•ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç±»çš„æ¯ä¸ªå®ä¾‹éƒ½åªç­‰äºå®ƒè‡ªå·±ã€‚å¦‚æœç¬¦åˆä¸‹åˆ—ä»»ä½•æ¡ä»¶ï¼Œå°±æ˜¯æ­£ç¡®çš„åšæ³•ï¼š\nç±»çš„æ¯ä¸ªå®ä¾‹æœ¬è´¨ä¸Šéƒ½æ˜¯å”¯ä¸€çš„ã€‚ å¯¹äºåƒ Thread è¿™æ ·è¡¨ç¤ºæ´»åŠ¨å®ä½“ç±»è€Œä¸æ˜¯å€¼ç±»æ¥è¯´ä¹Ÿæ˜¯å¦‚æ­¤ã€‚Object æä¾›çš„ equals å®ç°å¯¹äºè¿™äº›ç±»å…·æœ‰å®Œå…¨æ­£ç¡®çš„è¡Œä¸ºã€‚\nè¯¥ç±»ä¸éœ€è¦æä¾›ã€Œé€»è¾‘ç›¸ç­‰ã€æµ‹è¯•ã€‚ ä¾‹å¦‚ï¼Œjava.util.regex.Pattern å¯ä»¥è¦†ç›– equals æ¥æ£€æŸ¥ä¸¤ä¸ª Pattern å®ä¾‹æ˜¯å¦è¡¨ç¤ºå®Œå…¨ç›¸åŒçš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œä½†è®¾è®¡äººå‘˜è®¤ä¸ºå®¢æˆ·ç«¯ä¸éœ€è¦æˆ–ä¸éœ€è¦è¿™ä¸ªåŠŸèƒ½ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä» Object ç»§æ‰¿çš„ equals å®ç°æ˜¯ç†æƒ³çš„ã€‚\nè¶…ç±»å·²ç»è¦†ç›–äº† equalsï¼Œè¶…ç±»è¡Œä¸ºé€‚åˆäºè¿™ä¸ªç±»ã€‚ ä¾‹å¦‚ï¼Œå¤§å¤šæ•° Set çš„å®ç°ä» AbstractSet ç»§æ‰¿å…¶å¯¹ç­‰å®ç°ï¼ŒList ä» AbstractList ç»§æ‰¿å®ç°ï¼ŒMap ä» AbstractMap ç»§æ‰¿å®ç°ã€‚\nç±»æ˜¯ç§æœ‰çš„æˆ–åŒ…ç§æœ‰çš„ï¼Œå¹¶ä¸”ä½ ç¡®ä¿¡å®ƒçš„ equals æ–¹æ³•æ°¸è¿œä¸ä¼šè¢«è°ƒç”¨ã€‚ å¦‚æœä½ éå¸¸åŒæ¶é£é™©ï¼Œä½ å¯ä»¥è¦†ç›– equals æ–¹æ³•ï¼Œä»¥ç¡®ä¿å®ƒä¸ä¼šæ„å¤–è°ƒç”¨ï¼š\n@Override public boolean equals(Object o) { throw new AssertionError(); // Method is never called } ä»€ä¹ˆæ—¶å€™è¦†ç›– equals æ–¹æ³•æ˜¯åˆé€‚çš„ï¼Ÿå½“ä¸€ä¸ªç±»æœ‰ä¸€ä¸ªé€»è¾‘ç›¸ç­‰çš„æ¦‚å¿µï¼Œè€Œè¿™ä¸ªæ¦‚å¿µä¸åŒäºä»…åˆ¤æ–­å¯¹è±¡çš„åŒä¸€æ€§ï¼ˆç›¸åŒå¯¹è±¡çš„å¼•ç”¨ï¼‰ï¼Œå¹¶ä¸”è¶…ç±»è¿˜æ²¡æœ‰è¦†ç›– equalsã€‚å¯¹äºå€¼ç±»é€šå¸¸æ˜¯è¿™æ ·ã€‚å€¼ç±»åªæ˜¯è¡¨ç¤ºå€¼çš„ç±»ï¼Œä¾‹å¦‚ Integer æˆ– Stringã€‚ä½¿ç”¨ equals æ–¹æ³•æ¯”è¾ƒå¼•ç”¨å’Œå€¼å¯¹è±¡çš„ç¨‹åºå‘˜å¸Œæœ›å‘ç°å®ƒä»¬åœ¨é€»è¾‘ä¸Šæ˜¯å¦ç­‰ä»·ï¼Œè€Œä¸æ˜¯å®ƒä»¬æ˜¯å¦å¼•ç”¨ç›¸åŒçš„å¯¹è±¡ã€‚è¦†ç›– equals æ–¹æ³•ä¸ä»…æ˜¯ä¸ºäº†æ»¡è¶³ç¨‹åºå‘˜çš„æœŸæœ›ï¼Œå®ƒè¿˜ä½¿å®ä¾‹èƒ½å¤Ÿä½œä¸º Map çš„é”®æˆ– Set å…ƒç´ æ—¶ï¼Œå…·æœ‰å¯é¢„æµ‹çš„ã€ç†æƒ³çš„è¡Œä¸ºã€‚\næœ‰ä¸€ä¸ªè¡¨ç¤ºçŠ¶æ€çš„å†…éƒ¨ç±»ã€‚æ²¡æœ‰è¦†ç›– equals æ–¹æ³•æ—¶ï¼Œequals çš„ç»“æœä¸ s1==s2 ç›¸åŒï¼Œä¸º falseï¼Œå³ä¸¤è€…å¹¶ä¸æ˜¯ç›¸åŒå¯¹è±¡çš„å¼•ç”¨ã€‚\npublic static void main(String[] args) { class Status { public String status; } Status s1 = new Status(); Status s2 = new Status(); System.out.println(s1==s2); // false System.out.println(s1.equals(s2)); // false } è¦†ç›– equals æ–¹æ³•åï¼Œä»¥ä¸šåŠ¡é€»è¾‘æ¥åˆ¤æ–­æ˜¯å¦ç›¸åŒï¼Œå…·å¤‡ç›¸åŒ status å­—æ®µå³ä¸ºç›¸åŒã€‚åœ¨ä½¿ç”¨å»é‡åŠŸèƒ½æ—¶ï¼Œä¹Ÿä»¥æ­¤ä½œä¸ºåˆ¤æ–­ä¾æ®ã€‚\npublic static void main(String[] args) { class Status { public String status; @Override public boolean equals(Object o) { return Objects.equals(status, ((Status) o).status); } } Status s1 = new Status(); Status s2 = new Status(); System.out.println(s1==s2); // false System.out.println(s1.equals(s2)); // true } ä¸éœ€è¦è¦†ç›– equals æ–¹æ³•çš„ä¸€ç§å€¼ç±»æ˜¯ä½¿ç”¨å®ä¾‹æ§ä»¶æ¥ç¡®ä¿æ¯ä¸ªå€¼æœ€å¤šåªå­˜åœ¨ä¸€ä¸ªå¯¹è±¡çš„ç±»ã€‚æšä¸¾ç±»å‹å±äºè¿™ä¸€ç±»ã€‚å¯¹äºè¿™äº›ç±»ï¼Œé€»è¾‘ç›¸ç­‰ä¸å¯¹è±¡æ ‡è¯†ç›¸åŒï¼Œå› æ­¤å¯¹è±¡çš„ equals æ–¹æ³•å‡½æ•°ä¸é€»è¾‘ equals æ–¹æ³•ç›¸åŒã€‚\nå½“ä½ è¦†ç›– equals æ–¹æ³•æ—¶ï¼Œä½ å¿…é¡»éµå®ˆå®ƒçš„é€šç”¨çº¦å®šã€‚ä»¥ä¸‹æ˜¯å…·ä½“å†…å®¹ï¼Œæ¥è‡ª Object è§„èŒƒï¼šequals æ–¹æ³•å®ç°äº†ç­‰ä»·å…³ç³»ã€‚å®ƒåº”æœ‰è¿™äº›å±æ€§ï¼š\nåå°„æ€§ï¼šå¯¹äºä»»ä½•éç©ºçš„å‚è€ƒå€¼ xï¼Œx.equals(x) å¿…é¡»è¿”å› trueã€‚ å¯¹ç§°æ€§ï¼šå¯¹äºä»»ä½•éç©ºå‚è€ƒå€¼ x å’Œ yï¼Œx.equals(y) å¿…é¡»åœ¨ä¸”ä»…å½“ y.equals(x) è¿”å› true æ—¶è¿”å› trueã€‚ ä¼ é€’æ€§ï¼šå¯¹äºä»»ä½•éç©ºçš„å¼•ç”¨å€¼ x, y, zï¼Œå¦‚æœ x.equals(y) è¿”å› trueï¼Œy.equals(z) è¿”å› trueï¼Œé‚£ä¹ˆ x.equals(z) å¿…é¡»è¿”å› trueã€‚ ä¸€è‡´æ€§ï¼šå¯¹äºä»»ä½•éç©ºçš„å¼•ç”¨å€¼ x å’Œ y, x.equals(y) çš„å¤šæ¬¡è°ƒç”¨å¿…é¡»ä¸€è‡´åœ°è¿”å› true æˆ–ä¸€è‡´åœ°è¿”å› falseï¼Œå‰ææ˜¯ä¸ä¿®æ”¹ equals ä¸­ä½¿ç”¨çš„ä¿¡æ¯ã€‚ å¯¹äºä»»ä½•éç©ºå¼•ç”¨å€¼ xï¼Œx.equals(null) å¿…é¡»è¿”å› falseã€‚ é™¤éä½ æœ‰æ•°å­¦æ–¹é¢çš„å€¾å‘ï¼Œå¦åˆ™è¿™äº›èµ·æ¥æœ‰ç‚¹å¯æ€•ï¼Œä½†ä¸è¦å¿½ç•¥å®ƒï¼å¦‚æœä½ è¿åäº†å®ƒï¼Œä½ çš„ç¨‹åºå¾ˆå¯èƒ½ä¼šå‡ºç°è¡Œä¸ºå¼‚å¸¸æˆ–å´©æºƒï¼Œå¹¶ä¸”å¾ˆéš¾ç¡®å®šå¤±è´¥çš„æ ¹æºã€‚ç”¨ John Donne çš„è¯æ¥è¯´ï¼Œæ²¡æœ‰ä¸€ä¸ªç±»æ˜¯å­¤ç«‹çš„ã€‚ä¸€ä¸ªç±»çš„å®ä¾‹ç»å¸¸è¢«ä¼ é€’ç»™å¦ä¸€ä¸ªç±»ã€‚è®¸å¤šç±»ï¼ˆåŒ…æ‹¬æ‰€æœ‰é›†åˆç±»ï¼‰ä¾èµ–äºä¼ é€’ç»™å®ƒä»¬çš„å¯¹è±¡éµå®ˆ equals çº¦å®šã€‚\næ—¢ç„¶ä½ å·²ç»æ„è¯†åˆ°äº†è¿å equals çº¦å®šçš„å±é™©ï¼Œè®©æˆ‘ä»¬è¯¦ç»†è®¨è®ºä¸€ä¸‹ã€‚å¥½æ¶ˆæ¯æ˜¯ï¼Œå°½ç®¡è¡¨é¢ä¸Šçœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œä½†å…¶å®å¹¶ä¸å¤æ‚ã€‚ä¸€æ—¦ä½ æ˜ç™½äº†ï¼Œå°±ä¸éš¾åšæŒä¸‹å»äº†ã€‚\nä»€ä¹ˆæ˜¯ç­‰ä»·å…³ç³»ï¼Ÿç®€å•åœ°è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ“ä½œç¬¦ï¼Œå®ƒå°†ä¸€ç»„å…ƒç´ åˆ’åˆ†ä¸ºå­é›†ï¼Œå­é›†çš„å…ƒç´ è¢«è®¤ä¸ºæ˜¯å½¼æ­¤ç›¸ç­‰çš„ã€‚è¿™äº›å­é›†è¢«ç§°ä¸ºç­‰ä»·ç±»ã€‚ä¸ºäº†ä½¿ equals æ–¹æ³•æœ‰ç”¨ï¼Œä»ç”¨æˆ·çš„è§’åº¦æ¥çœ‹ï¼Œæ¯ä¸ªç­‰ä»·ç±»ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½å¿…é¡»æ˜¯å¯äº’æ¢çš„ã€‚ç°åœ¨è®©æˆ‘ä»¬ä¾æ¬¡æ£€æŸ¥ä»¥ä¸‹äº”ä¸ªéœ€æ±‚ï¼š\nåå°„æ€§ ï¼Œç¬¬ä¸€ä¸ªè¦æ±‚ä»…ä»…æ˜¯è¯´ä¸€ä¸ªå¯¹è±¡å¿…é¡»ç­‰äºå®ƒè‡ªå·±ã€‚å¾ˆéš¾æƒ³è±¡ä¼šæ— æ„ä¸­è¿åäº†è¿™æ¡è§„åˆ™ã€‚å¦‚æœä½ è¿åäº†å®ƒï¼Œç„¶åå°†ç±»çš„ä¸€ä¸ªå®ä¾‹æ·»åŠ åˆ°é›†åˆä¸­ï¼Œcontains æ–¹æ³•å¾ˆå¯èƒ½ä¼šè¯´è¯¥é›†åˆä¸åŒ…å«ä½ åˆšæ‰æ·»åŠ çš„å®ä¾‹ã€‚\nå¯¹ç§°æ€§ ï¼Œç¬¬äºŒä¸ªè¦æ±‚æ˜¯ä»»ä½•ä¸¤ä¸ªå¯¹è±¡å¿…é¡»åœ¨æ˜¯å¦ç›¸ç­‰çš„é—®é¢˜ä¸Šè¾¾æˆä¸€è‡´ã€‚ä¸ç¬¬ä¸€ä¸ªè¦æ±‚ä¸åŒï¼Œæ— æ„ä¸­è¿åäº†è¿™ä¸ªè¦æ±‚çš„æƒ…å†µä¸éš¾æƒ³è±¡ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸‹é¢çš„ç±»ï¼Œå®ƒå®ç°äº†ä¸åŒºåˆ†å¤§å°å†™çš„å­—ç¬¦ä¸²ã€‚å­—ç¬¦ä¸²çš„æƒ…å†µæ˜¯ä¿ç•™çš„ toStringï¼Œä½†å¿½ç•¥åœ¨ equals çš„æ¯”è¾ƒï¼š\n// Broken - violates symmetry! public final class CaseInsensitiveString { private final String s; public CaseInsensitiveString(String s) { this.s = Objects.requireNonNull(s); } // Broken - violates symmetry! @Override public boolean equals(Object o) { if (o instanceof CaseInsensitiveString) return s.equalsIgnoreCase(((CaseInsensitiveString) o).s); if (o instanceof String) // One-way interoperability! return s.equalsIgnoreCase((String) o); return false; } ... // Remainder omitted } è¿™ä¸ªç±»ä¸­çš„ equals æ–¹æ³•å¤©çœŸåœ°å°è¯•ä¸æ™®é€šå­—ç¬¦ä¸²è¿›è¡Œäº’æ“ä½œã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªä¸åŒºåˆ†å¤§å°å†™çš„å­—ç¬¦ä¸²å’Œä¸€ä¸ªæ™®é€šå­—ç¬¦ä¸²ï¼š\nCaseInsensitiveString cis = new CaseInsensitiveString(\u0026#34;Polish\u0026#34;); String s = \u0026#34;polish\u0026#34;; æ­£å¦‚é¢„æœŸçš„é‚£æ ·ï¼Œcis.equals(s) è¿”å› trueã€‚é—®é¢˜æ˜¯ï¼Œè™½ç„¶ CaseInsensitiveString ä¸­çš„ equals æ–¹æ³•çŸ¥é“æ™®é€šå­—ç¬¦ä¸²ï¼Œä½†æ˜¯ String ä¸­çš„ equals æ–¹æ³•å¯¹ä¸åŒºåˆ†å¤§å°å†™çš„å­—ç¬¦ä¸²ä¸çŸ¥æƒ…ã€‚å› æ­¤ï¼Œs.equals(cis) è¿”å› falseï¼Œè¿™æ˜æ˜¾è¿åäº†å¯¹ç§°æ€§ã€‚å‡è®¾ä½ å°†ä¸åŒºåˆ†å¤§å°å†™çš„å­—ç¬¦ä¸²æ”¾å…¥é›†åˆä¸­ï¼š\nList\u0026lt;CaseInsensitiveString\u0026gt; list = new ArrayList\u0026lt;\u0026gt;(); list.add(cis); æ­¤æ—¶ list.contains(s) è¿”å›ä»€ä¹ˆï¼Ÿè°çŸ¥é“å‘¢ï¼Ÿåœ¨å½“å‰çš„ OpenJDK å®ç°ä¸­ï¼Œå®ƒç¢°å·§è¿”å› falseï¼Œä½†è¿™åªæ˜¯ä¸€ä¸ªå®ç°æ¡ˆä¾‹ã€‚åœ¨å¦ä¸€ä¸ªå®ç°ä¸­ï¼Œå®ƒå¯ä»¥å¾ˆå®¹æ˜“åœ°è¿”å› true æˆ–æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸ã€‚ä¸€æ—¦ä½ è¿åäº† equals çº¦å®šï¼Œå°±ä¸çŸ¥é“å½“å…¶ä»–å¯¹è±¡é¢å¯¹ä½ çš„å¯¹è±¡æ—¶ï¼Œä¼šå¦‚ä½•è¡¨ç°ã€‚\ncontains æ–¹æ³•åœ¨ ArrayList ä¸­çš„å®ç°æºç å¦‚ä¸‹\n// ArrayList çš„å¤§å° private int size; // ä¿å­˜ ArrayList å…ƒç´ çš„å®¹å™¨ï¼Œä¸€ä¸ª Object æ•°ç»„ transient Object[] elementData; // non-private to simplify nested class access public boolean contains(Object o) { return indexOf(o) \u0026gt;= 0; } public int indexOf(Object o) { return indexOfRange(o, 0, size); } int indexOfRange(Object o, int start, int end) { Object[] es = elementData; if (o == null) { for (int i = start; i \u0026lt; end; i++) { if (es[i] == null) { return i; } } } else { for (int i = start; i \u0026lt; end; i++) { if (o.equals(es[i])) { return i; } } } return -1; } â€‹ ä¸ºäº†æ¶ˆé™¤è¿™ä¸ªé—®é¢˜ï¼Œåªéœ€ä» equals æ–¹æ³•ä¸­åˆ é™¤ä¸ String äº’æ“ä½œçš„é”™è¯¯å°è¯•ã€‚ä¸€æ—¦ä½ è¿™æ ·åšäº†ï¼Œä½ å¯ä»¥é‡æ„æ–¹æ³•ä¸ºä¸€ä¸ªå•ä¸€çš„è¿”å›è¯­å¥ï¼š\n@Override public boolean equals(Object o) { return o instanceof CaseInsensitiveString \u0026amp;\u0026amp; ((CaseInsensitiveString) o).s.equalsIgnoreCase(s); } ä¼ é€’æ€§ ï¼Œequals çº¦å®šçš„ç¬¬ä¸‰ä¸ªè¦æ±‚æ˜¯ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡ç­‰äºç¬¬äºŒä¸ªå¯¹è±¡ï¼Œè€Œç¬¬äºŒä¸ªå¯¹è±¡ç­‰äºç¬¬ä¸‰ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªå¯¹è±¡å¿…é¡»ç­‰äºç¬¬ä¸‰ä¸ªå¯¹è±¡ã€‚åŒæ ·ï¼Œæ— æ„ä¸­è¿åäº†è¿™ä¸ªè¦æ±‚çš„æƒ…å†µä¸éš¾æƒ³è±¡ã€‚è€ƒè™‘å‘è¶…ç±»æ·»åŠ æ–°çš„å€¼ç»„ä»¶æ—¶ï¼Œå­ç±»çš„æƒ…å†µã€‚æ¢å¥è¯è¯´ï¼Œå­ç±»æ·»åŠ äº†ä¸€æ¡å½±å“ equals æ¯”è¾ƒçš„ä¿¡æ¯ã€‚è®©æˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„ä¸å¯å˜äºŒç»´æ•´æ•°ç‚¹ç±»å¼€å§‹ï¼š\npublic class Point { private final int x; private final int y; public Point(int x, int y) { this.x = x; this.y = y; } @Override public boolean equals(Object o) { if (!(o instanceof Point)) return false; Point p = (Point)o; return p.x == x \u0026amp;\u0026amp; p.y == y; } ... // Remainder omitted } å‡è®¾ä½ æƒ³ç»§æ‰¿è¿™ä¸ªç±»ï¼Œå¯¹ä¸€ä¸ªç‚¹æ·»åŠ é¢œè‰²çš„æ¦‚å¿µï¼š\npublic class ColorPoint extends Point { private final Color color; public ColorPoint(int x, int y, Color color) { super(x, y); this.color = color; } ... // Remainder omitted } equals æ–¹æ³•åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿå¦‚æœä½ å®Œå…¨å¿½ç•¥å®ƒï¼Œåˆ™å®ç°å°†ä» Point ç±»ç»§æ‰¿è€Œæ¥ï¼Œåœ¨ equals æ¯”è¾ƒä¸­é¢œè‰²ä¿¡æ¯å°†è¢«å¿½ç•¥ã€‚è™½ç„¶è¿™å¹¶ä¸è¿å equals çº¦å®šï¼Œä½†æ˜¾ç„¶æ˜¯ä¸å¯æ¥å—çš„ã€‚å‡è®¾ä½ å†™äº†ä¸€ä¸ª equals æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åªæœ‰å½“å®ƒçš„å‚æ•°æ˜¯å¦ä¸€ä¸ªé¢œè‰²ç‚¹ï¼Œä¸”ä½ç½®å’Œé¢œè‰²ç›¸åŒæ—¶æ‰è¿”å› trueï¼š\n// Broken - violates symmetry! @Override public boolean equals(Object o) { if (!(o instanceof ColorPoint)) return false; return super.equals(o) \u0026amp;\u0026amp; ((ColorPoint) o).color == color; } è¿™ç§æ–¹æ³•çš„é—®é¢˜æ˜¯ï¼Œå½“ä½ æ¯”è¾ƒä¸€ä¸ªç‚¹å’Œä¸€ä¸ªé¢œè‰²ç‚¹æ—¶ï¼Œä½ å¯èƒ½ä¼šå¾—åˆ°ä¸åŒçš„ç»“æœï¼Œåä¹‹äº¦ç„¶ã€‚å‰è€…æ¯”è¾ƒå¿½ç•¥é¢œè‰²ï¼Œè€Œåè€…æ¯”è¾ƒæ€»æ˜¯è¿”å› falseï¼Œå› ä¸ºå‚æ•°çš„ç±»å‹æ˜¯ä¸æ­£ç¡®çš„ã€‚ä¸ºäº†ä½¿é—®é¢˜æ›´å…·ä½“ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç‚¹å’Œä¸€ä¸ªé¢œè‰²ç‚¹ï¼š\nPoint p = new Point(1, 2); ColorPoint cp = new ColorPoint(1, 2, Color.RED); ç„¶åï¼Œp.equals(cp) è¿”å› trueï¼Œè€Œ cp.equals(p) è¿”å› falseã€‚å½“ä½ åšã€Œæ··åˆæ¯”è¾ƒã€çš„æ—¶å€™ï¼Œä½ å¯ä»¥é€šè¿‡è®© ColorPoint.equals å¿½ç•¥é¢œè‰²æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š\n// Broken - violates transitivity! @Override public boolean equals(Object o) { if (!(o instanceof Point)) return false; // If o is a normal Point, do a color-blind comparison if (!(o instanceof ColorPoint)) return o.equals(this); // o is a ColorPoint; do a full comparison return super.equals(o) \u0026amp;\u0026amp; ((ColorPoint) o).color == color; } è¿™ç§æ–¹æ³•ç¡®å®æä¾›äº†å¯¹ç§°æ€§ï¼Œä½†ç‰ºç‰²äº†ä¼ é€’æ€§ï¼š\nColorPoint p1 = new ColorPoint(1, 2, Color.RED); Point p2 = new Point(1, 2); ColorPoint p3 = new ColorPoint(1, 2, Color.BLUE); ç°åœ¨ï¼Œp1.equals(p2) å’Œ p2.equals(p3) è¿”å› trueï¼Œè€Œ p1.equals(p3) è¿”å› falseï¼Œè¿™æ˜æ˜¾è¿åäº†ä¼ é€’æ€§ã€‚å‰ä¸¤ä¸ªæ¯”è¾ƒæ˜¯ã€Œè‰²ç›²ã€ï¼Œè€Œç¬¬ä¸‰ä¸ªæ¯”è¾ƒè€ƒè™‘äº†é¢œè‰²ã€‚\nåŒæ ·ï¼Œè¿™ç§æ–¹æ³•ä¼šå¯¼è‡´æ— é™çš„é€’å½’ï¼šå‡è®¾æœ‰ä¸¤ä¸ªç‚¹çš„å­ç±»ï¼Œæ¯”å¦‚ ColorPoint å’Œ SmellPointï¼Œæ¯ä¸ªéƒ½ä½¿ç”¨è¿™ç§ equals æ–¹æ³•ã€‚ç„¶åè°ƒç”¨ myColorPoint.equals(mySmellPoint) ä¼šæŠ›å‡º StackOverflowErrorã€‚\né‚£ä¹ˆè§£å†³æ–¹æ¡ˆæ˜¯ä»€ä¹ˆï¼Ÿè¿™æ˜¯é¢å‘å¯¹è±¡è¯­è¨€ä¸­ç­‰ä»·å…³ç³»çš„ä¸€ä¸ªåŸºæœ¬é—®é¢˜ã€‚é™¤éä½ æ„¿æ„æ”¾å¼ƒé¢å‘å¯¹è±¡çš„æŠ½è±¡ä¼˜ç‚¹ï¼Œå¦åˆ™æ— æ³•ç»§æ‰¿ä¸€ä¸ªå¯å®ä¾‹åŒ–çš„ç±»å¹¶æ·»åŠ ä¸€ä¸ªå€¼ç»„ä»¶ï¼ŒåŒæ—¶ä¿ç•™ equals çº¦å®šã€‚\nä½ å¯èƒ½ä¼šå¬åˆ°å®ƒè¯´ä½ å¯ä»¥ç»§æ‰¿ä¸€ä¸ªå®ä¾‹åŒ–çš„ç±»å¹¶æ·»åŠ ä¸€ä¸ªå€¼ç»„ä»¶ï¼ŒåŒæ—¶é€šè¿‡åœ¨ equals æ–¹æ³•ä¸­ä½¿ç”¨ getClass æµ‹è¯•æ¥ä»£æ›¿ instanceof æµ‹è¯•æ¥ä¿æŒ equals çº¦å®šï¼š\n// Broken - violates Liskov substitution principle (page 43) @Override public boolean equals(Object o) { if (o == null || o.getClass() != getClass()) return false; Point p = (Point) o; return p.x == x \u0026amp;\u0026amp; p.y == y; } åªæœ‰å½“å¯¹è±¡å…·æœ‰ç›¸åŒçš„å®ç°ç±»æ—¶ï¼Œæ‰ä¼šäº§ç”Ÿç›¸ç­‰çš„æ•ˆæœã€‚è¿™å¯èƒ½çœ‹èµ·æ¥ä¸æ˜¯å¾ˆç³Ÿç³•ï¼Œä½†å…¶åæœæ˜¯ä¸å¯æ¥å—çš„ï¼šPoint çš„å­ç±»çš„å®ä¾‹ä»ç„¶æ˜¯ä¸€ä¸ª Pointï¼Œå¹¶ä¸”å®ƒä»ç„¶éœ€è¦ä½œä¸ºä¸€ä¸ªå‡½æ•°æ¥å·¥ä½œï¼Œä½†æ˜¯å¦‚æœé‡‡ç”¨è¿™ç§æ–¹æ³•ï¼Œå®ƒå°±ä¸ä¼šè¿™æ ·åšï¼å‡è®¾æˆ‘ä»¬è¦å†™ä¸€ä¸ªæ–¹æ³•æ¥åˆ¤æ–­ä¸€ä¸ªç‚¹æ˜¯å¦åœ¨å•ä½åœ†ä¸Šã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š\n// Initialize unitCircle to contain all Points on the unit circle private static final Set\u0026lt;Point\u0026gt; unitCircle = Set.of( new Point( 1, 0), new Point( 0, 1), new Point(-1, 0), new Point( 0, -1) ); public static boolean onUnitCircle(Point p) { return unitCircle.contains(p); } è™½ç„¶è¿™å¯èƒ½ä¸æ˜¯å®ç°åŠŸèƒ½çš„æœ€å¿«æ–¹æ³•ï¼Œä½†å®ƒå·¥ä½œå¾—å¾ˆå¥½ã€‚å‡è®¾ä½ ä»¥ä¸€ç§ä¸æ·»åŠ å€¼ç»„ä»¶çš„ç®€å•æ–¹å¼ç»§æ‰¿ Pointï¼Œä¾‹å¦‚ï¼Œè®©å®ƒçš„æ„é€ å‡½æ•°è·Ÿè¸ªåˆ›å»ºäº†å¤šå°‘å®ä¾‹ï¼š\npublic class CounterPoint extends Point { private static final AtomicInteger counter = new AtomicInteger(); public CounterPoint(int x, int y) { super(x, y); counter.incrementAndGet(); } public static int numberCreated() { return counter.get(); } } Liskov æ›¿æ¢åŸåˆ™æŒ‡å‡ºï¼Œç±»å‹çš„ä»»ä½•é‡è¦å±æ€§éƒ½åº”è¯¥é€‚ç”¨äºæ‰€æœ‰å­ç±»å‹ï¼Œå› æ­¤ä¸ºç±»å‹ç¼–å†™çš„ä»»ä½•æ–¹æ³•éƒ½åº”è¯¥åœ¨å…¶å­ç±»å‹ä¸ŠåŒæ ·æœ‰æ•ˆã€‚è¿™æ˜¯æˆ‘ä»¬å…ˆå‰åšçš„æ­£å¼å£°æ˜ï¼Œå³ç‚¹çš„å­ç±»ï¼ˆå¦‚ CounterPointï¼‰ä»ç„¶æ˜¯ä¸€ä¸ª Pointï¼Œå¹¶ä¸”å¿…é¡»ä½œä¸ºä¸€ä¸ª Pointã€‚ä½†å‡è®¾æˆ‘ä»¬ä¼ é€’äº†ä¸€ä¸ª CounterPoint ç»™ onUnitCircle æ–¹æ³•ã€‚å¦‚æœ Point ç±»ä½¿ç”¨åŸºäº getclass çš„ equals æ–¹æ³•ï¼Œé‚£ä¹ˆä¸ç®¡ CounterPoint å®ä¾‹çš„ x å’Œ y åæ ‡å¦‚ä½•ï¼ŒonUnitCircle æ–¹æ³•éƒ½ä¼šè¿”å› falseã€‚è¿™æ˜¯å› ä¸ºå¤§å¤šæ•°é›†åˆï¼ŒåŒ…æ‹¬ onUnitCircle æ–¹æ³•ä½¿ç”¨çš„ HashSetï¼Œéƒ½ä½¿ç”¨ equals æ–¹æ³•æ¥æµ‹è¯•åŒ…å«æ€§ï¼Œæ²¡æœ‰ä¸€ä¸ª CounterPoint å®ä¾‹ç­‰äºä»»ä½•ä¸€ä¸ªç‚¹ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ åœ¨ Point ä¸Šä½¿ç”¨äº†æ­£ç¡®çš„åŸºäºå®ä¾‹çš„ equals æ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨æä¾›å¯¹ä½å®ä¾‹æ—¶ï¼Œç›¸åŒçš„ onUnitCircle æ–¹æ³•å°±å¯ä»¥å¾ˆå¥½åœ°å·¥ä½œã€‚\né‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLiskov Substitution Principleï¼ŒLSPï¼‰é¢å‘å¯¹è±¡è®¾è®¡çš„åŸºæœ¬åŸåˆ™ä¹‹ä¸€ã€‚é‡Œæ°æ›¿æ¢åŸåˆ™æŒ‡å‡ºï¼šä»»ä½•çˆ¶ç±»å¯ä»¥å‡ºç°çš„åœ°æ–¹ï¼Œå­ç±»ä¸€å®šå¯ä»¥å‡ºç°ã€‚LSP æ˜¯ç»§æ‰¿å¤ç”¨çš„åŸºçŸ³ï¼Œåªæœ‰å½“è¡ç”Ÿç±»å¯ä»¥æ›¿æ¢æ‰çˆ¶ç±»ï¼Œè½¯ä»¶å•ä½çš„åŠŸèƒ½ä¸å—åˆ°å½±å“æ—¶ï¼Œçˆ¶ç±»æ‰èƒ½çœŸæ­£è¢«å¤ç”¨ï¼Œè€Œè¡ç”Ÿç±»ä¹Ÿèƒ½å¤Ÿåœ¨çˆ¶ç±»çš„åŸºç¡€ä¸Šå¢åŠ æ–°çš„è¡Œä¸ºã€‚\nè™½ç„¶æ²¡æœ‰ä»¤äººæ»¡æ„çš„æ–¹æ³•æ¥ç»§æ‰¿ä¸€ä¸ªå¯å®ä¾‹åŒ–çš„ç±»å¹¶æ·»åŠ ä¸€ä¸ªå€¼ç»„ä»¶ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼šéµå¾ªçš„å»ºè®®ï¼Œã€ŒFavor composition over inheritance.ã€ã€‚ç»™ ColorPoint ä¸€ä¸ªç§æœ‰çš„ Point å­—æ®µå’Œä¸€ä¸ª public è§†å›¾æ–¹æ³•ï¼Œè€Œä¸æ˜¯è®© ColorPoint ç»§æ‰¿ Pointï¼Œè¯¥æ–¹æ³•è¿”å›ä¸è¿™ä¸ªé¢œè‰²ç‚¹ç›¸åŒä½ç½®çš„ç‚¹ï¼š\n// Adds a value component without violating the equals contract public class ColorPoint { private final Point point; private final Color color; public ColorPoint(int x, int y, Color color) { point = new Point(x, y); this.color = Objects.requireNonNull(color); } /** * Returns the point-view of this color point. */ public Point asPoint() { return point; } @Override public boolean equals(Object o) { if (!(o instanceof ColorPoint)) return false; ColorPoint cp = (ColorPoint) o; return cp.point.equals(point) \u0026amp;\u0026amp; cp.color.equals(color); } ... // Remainder omitted } Java åº“ä¸­æœ‰ä¸€äº›ç±»ç¡®å®ç»§æ‰¿äº†ä¸€ä¸ªå¯å®ä¾‹åŒ–çš„ç±»å¹¶æ·»åŠ äº†ä¸€ä¸ªå€¼ç»„ä»¶ã€‚ä¾‹å¦‚ï¼Œjava.sql.Timestamp ç»§æ‰¿ java.util.Date å¹¶æ·»åŠ äº†çº³ç§’å­—æ®µã€‚å¦‚æœåœ¨åŒä¸€ä¸ªé›†åˆä¸­ä½¿ç”¨æ—¶é—´æˆ³å’Œæ—¥æœŸå¯¹è±¡ï¼Œæˆ–è€…ä»¥å…¶ä»–æ–¹å¼æ··åˆä½¿ç”¨æ—¶é—´æˆ³å’Œæ—¥æœŸå¯¹è±¡ï¼Œé‚£ä¹ˆæ—¶é—´æˆ³çš„ equals å®ç°ç¡®å®è¿åäº†å¯¹ç§°æ€§ï¼Œå¹¶ä¸”å¯èƒ½å¯¼è‡´ä¸ç¨³å®šçš„è¡Œä¸ºã€‚Timestamp ç±»æœ‰ä¸€ä¸ªå…è´£å£°æ˜ï¼Œè­¦å‘Šç¨‹åºå‘˜ä¸è¦æ··åˆä½¿ç”¨æ—¥æœŸå’Œæ—¶é—´æˆ³ã€‚è™½ç„¶åªè¦å°†å®ƒä»¬åˆ†å¼€ï¼Œå°±ä¸ä¼šé‡åˆ°éº»çƒ¦ï¼Œä½†æ˜¯æ²¡æœ‰ä»€ä¹ˆå¯ä»¥é˜»æ­¢ä½ å°†å®ƒä»¬æ··åˆåœ¨ä¸€èµ·ï¼Œå› æ­¤äº§ç”Ÿçš„é”™è¯¯å¯èƒ½å¾ˆéš¾è°ƒè¯•ã€‚æ—¶é—´æˆ³ç±»çš„è¿™ç§è¡Œä¸ºæ˜¯é”™è¯¯çš„ï¼Œä¸åº”è¯¥æ•ˆä»¿ã€‚\næ³¨æ„ï¼Œä½ å¯ä»¥å‘æŠ½è±¡ç±»çš„å­ç±»æ·»åŠ ä¸€ä¸ªå€¼ç»„ä»¶ï¼Œè€Œä¸è¿å equals çº¦å®šã€‚è¿™å¯¹äºéµå¾ªä¸­çš„å»ºè®®è€Œå¾—åˆ°çš„ç±»å±‚æ¬¡ç»“æ„å¾ˆé‡è¦ï¼Œã€ŒPrefer class hierarchies to tagged classes.ã€ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æœ‰ä¸€ä¸ªæ²¡æœ‰å€¼ç»„ä»¶çš„æŠ½è±¡ç±»å½¢çŠ¶ã€ä¸€ä¸ªæ·»åŠ åŠå¾„å­—æ®µçš„å­ç±»åœ†å’Œä¸€ä¸ªæ·»åŠ é•¿åº¦å’Œå®½åº¦å­—æ®µçš„å­ç±»çŸ©å½¢ã€‚åªè¦ä¸å¯èƒ½ç›´æ¥åˆ›å»ºè¶…ç±»å®ä¾‹ï¼Œå‰é¢æ˜¾ç¤ºçš„é‚£ç§é—®é¢˜å°±ä¸ä¼šå‘ç”Ÿã€‚\néæ— æ•ˆæ€§ ï¼Œæœ€åçš„è¦æ±‚æ²¡æœ‰ä¸€ä¸ªæ­£å¼çš„åç§°ï¼Œæ‰€ä»¥æˆ‘å†’æ˜§åœ°ç§°ä¹‹ä¸ºã€Œéæ— æ•ˆæ€§ã€ã€‚å®ƒè¯´æ‰€æœ‰å¯¹è±¡éƒ½ä¸ç­‰äº nullã€‚è™½ç„¶å¾ˆéš¾æƒ³è±¡åœ¨å“åº”è°ƒç”¨ o.equals(null) æ—¶æ„å¤–åœ°è¿”å› trueï¼Œä½†ä¸éš¾æƒ³è±¡æ„å¤–åœ°æŠ›å‡º NullPointerExceptionã€‚ä¸€èˆ¬çº¦å®šä¸­ç¦æ­¢è¿™æ ·åšã€‚è®¸å¤šç±»éƒ½æœ‰ç›¸ç­‰çš„æ–¹æ³•ï¼Œé€šè¿‡æ˜¾å¼çš„ null æµ‹è¯•æ¥é˜²æ­¢å®ƒï¼š\n@Override public boolean equals(Object o) { if (o == null) return false; ... } è¿™ä¸ªæµ‹è¯•æ˜¯ä¸å¿…è¦çš„ã€‚è¦æµ‹è¯•å…¶å‚æ•°æ˜¯å¦ç›¸ç­‰ï¼Œequals æ–¹æ³•å¿…é¡»é¦–å…ˆå°†å…¶å‚æ•°è½¬æ¢ä¸ºé€‚å½“çš„ç±»å‹ï¼Œä»¥ä¾¿èƒ½å¤Ÿè°ƒç”¨å…¶è®¿é—®å™¨æˆ–è®¿é—®å…¶å­—æ®µã€‚åœ¨æ‰§è¡Œè½¬æ¢ä¹‹å‰ï¼Œæ–¹æ³•å¿…é¡»ä½¿ç”¨ instanceof è¿ç®—ç¬¦æ¥æ£€æŸ¥å…¶å‚æ•°çš„ç±»å‹æ˜¯å¦æ­£ç¡®ï¼š\nå¦‚æœç¼ºå°‘è¿™ä¸ªç±»å‹æ£€æŸ¥ï¼Œå¹¶ä¸” equals æ–¹æ³•ä¼ é€’äº†ä¸€ä¸ªé”™è¯¯ç±»å‹çš„å‚æ•°ï¼Œequals æ–¹æ³•å°†æŠ›å‡º ClassCastExceptionï¼Œè¿™è¿åäº† equals çº¦å®šã€‚ä½†æ˜¯ï¼Œå¦‚æœ instanceof æ“ä½œç¬¦çš„ç¬¬ä¸€ä¸ªæ“ä½œæ•°ä¸ºç©ºï¼Œåˆ™æŒ‡å®šè¯¥æ“ä½œç¬¦è¿”å› falseï¼Œè€Œä¸ç®¡ç¬¬äºŒä¸ªæ“ä½œæ•°ä¸­å‡ºç°çš„æ˜¯ä»€ä¹ˆç±»å‹ã€‚å› æ­¤ï¼Œå¦‚æœä¼ å…¥ nullï¼Œç±»å‹æ£€æŸ¥å°†è¿”å› falseï¼Œå› æ­¤ä¸éœ€è¦æ˜¾å¼çš„ null æ£€æŸ¥ã€‚\nç»¼ä¸Šæ‰€è¿°ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªé«˜è´¨é‡æ„å»º equals æ–¹æ³•çš„ç§˜è¯€ï¼š\n1ã€ä½¿ç”¨ == è¿ç®—ç¬¦æ£€æŸ¥å‚æ•°æ˜¯å¦æ˜¯å¯¹è¯¥å¯¹è±¡çš„å¼•ç”¨ã€‚ å¦‚æœæ˜¯ï¼Œè¿”å› trueã€‚è¿™åªæ˜¯ä¸€ç§æ€§èƒ½ä¼˜åŒ–ï¼Œä½†å¦‚æœæ¯”è¾ƒçš„ä»£ä»·å¯èƒ½å¾ˆé«˜ï¼Œé‚£ä¹ˆè¿™ç§ä¼˜åŒ–æ˜¯å€¼å¾—çš„ã€‚\n2ã€ä½¿ç”¨ instanceof è¿ç®—ç¬¦æ£€æŸ¥å‚æ•°æ˜¯å¦å…·æœ‰æ­£ç¡®çš„ç±»å‹ã€‚ å¦‚æœä¸æ˜¯ï¼Œè¿”å› falseã€‚é€šå¸¸ï¼Œæ­£ç¡®çš„ç±»å‹æ˜¯æ–¹æ³•å‘ç”Ÿçš„ç±»ã€‚æœ‰æ—¶å€™ï¼Œå®ƒæ˜¯ç”±è¿™ä¸ªç±»å®ç°çš„æŸä¸ªæ¥å£ã€‚å¦‚æœç±»å®ç°äº†ä¸€ä¸ªæ¥å£ï¼Œè¯¥æ¥å£å¯¹ equals çº¦å®šè¿›è¡Œäº†æ”¹è¿›ï¼Œä»¥å…è®¸è·¨å®ç°è¯¥æ¥å£çš„ç±»è¿›è¡Œæ¯”è¾ƒï¼Œåˆ™ä½¿ç”¨è¯¥æ¥å£ã€‚é›†åˆæ¥å£ï¼Œå¦‚ Setã€Listã€Map å’Œ Map.Entry å…·æœ‰æ­¤å±æ€§ã€‚\n3ã€å°†å‚æ•°è½¬æ¢ä¸ºæ­£ç¡®çš„ç±»å‹ã€‚ å› ä¸ºåœ¨è¿™ä¸ªå¼ºåˆ¶ç±»å‹è½¬æ¢ä¹‹å‰æœ‰ä¸€ä¸ªå®ä¾‹æµ‹è¯•ï¼Œæ‰€ä»¥å®ƒè‚¯å®šä¼šæˆåŠŸã€‚\n4ã€å¯¹äºç±»ä¸­çš„æ¯ä¸ªã€Œé‡è¦ã€å­—æ®µï¼Œæ£€æŸ¥å‚æ•°çš„å­—æ®µæ˜¯å¦ä¸è¯¥å¯¹è±¡çš„ç›¸åº”å­—æ®µåŒ¹é…ã€‚ å¦‚æœæ‰€æœ‰è¿™äº›æµ‹è¯•éƒ½æˆåŠŸï¼Œè¿”å› trueï¼›å¦åˆ™è¿”å› falseã€‚å¦‚æœç¬¬ 2 æ­¥ä¸­çš„ç±»å‹æ˜¯æ¥å£ï¼Œåˆ™å¿…é¡»é€šè¿‡æ¥å£æ–¹æ³•è®¿é—®å‚æ•°çš„å­—æ®µï¼›å¦‚æœæ˜¯ç±»ï¼Œä½ å¯ä»¥æ ¹æ®å­—æ®µçš„å¯è®¿é—®æ€§ç›´æ¥è®¿é—®å®ƒä»¬ã€‚\nå¯¹äºç±»å‹ä¸æ˜¯ float æˆ– double çš„åŸºæœ¬ç±»å‹å­—æ®µï¼Œä½¿ç”¨ == è¿ç®—ç¬¦è¿›è¡Œæ¯”è¾ƒï¼›å¯¹äºå¯¹è±¡å¼•ç”¨å­—æ®µï¼Œé€’å½’è°ƒç”¨ equals æ–¹æ³•ï¼›å¯¹äº float å­—æ®µï¼Œä½¿ç”¨ static Float.compare(float,float) æ–¹æ³•ï¼›å¯¹äº double å­—æ®µï¼Œä½¿ç”¨ Double.compare(double, double)ã€‚float å’Œ double å­—æ®µçš„ç‰¹æ®Šå¤„ç†æ˜¯ç”±äº Float.NaNã€-0.0f å’Œç±»ä¼¼çš„åŒé‡å€¼çš„å­˜åœ¨è€Œå¿…é¡»çš„ï¼›è¯·å‚é˜… Float.equalsæ–‡æ¡£ã€‚è™½ç„¶ä½ å¯ä»¥å°† float å’Œ double å­—æ®µä¸é™æ€æ–¹æ³• Float.equals å’Œ Double.equals è¿›è¡Œæ¯”è¾ƒï¼Œè¿™å°†éœ€è¦åœ¨æ¯ä¸ªæ¯”è¾ƒä¸Šè¿›è¡Œè‡ªåŠ¨è£…ç®±ï¼Œè¿™å°†æœ‰è¾ƒå·®çš„æ€§èƒ½ã€‚å¯¹äºæ•°ç»„å­—æ®µï¼Œå°†è¿™äº›æŒ‡å¯¼åŸåˆ™åº”ç”¨äºæ¯ä¸ªå…ƒç´ ã€‚å¦‚æœæ•°ç»„å­—æ®µä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½å¾ˆé‡è¦ï¼Œé‚£ä¹ˆä½¿ç”¨Arrays.equals` æ–¹æ³•ä¹‹ä¸€ã€‚\nä¸€äº›å¯¹è±¡å¼•ç”¨å­—æ®µå¯èƒ½åˆæ³•åœ°åŒ…å« nullã€‚ä¸ºäº†é¿å…å¯èƒ½å‡ºç° NullPointerExceptionï¼Œè¯·ä½¿ç”¨é™æ€æ–¹æ³• Objects.equals(Object, Object) æ£€æŸ¥è¿™äº›å­—æ®µæ˜¯å¦ç›¸ç­‰ã€‚\nå¯¹äºæŸäº›ç±»ï¼Œä¾‹å¦‚ä¸Šé¢çš„ CaseInsensitiveStringï¼Œå­—æ®µæ¯”è¾ƒæ¯”ç®€å•çš„ equal æµ‹è¯•æ›´å¤æ‚ã€‚å¦‚æœæ˜¯è¿™æ ·ï¼Œä½ å¯èƒ½å¸Œæœ›å­˜å‚¨å­—æ®µçš„è§„èŒƒå½¢å¼ï¼Œä»¥ä¾¿ equals æ–¹æ³•å¯ä»¥å¯¹è§„èŒƒå½¢å¼è¿›è¡Œå»‰ä»·çš„ç²¾ç¡®æ¯”è¾ƒï¼Œè€Œä¸æ˜¯æ›´æ˜‚è´µçš„éæ ‡å‡†æ¯”è¾ƒã€‚è¿™ç§æŠ€æœ¯æœ€é€‚åˆäºä¸å¯å˜ç±»ï¼›å¦‚æœå¯¹è±¡å¯ä»¥æ›´æ”¹ï¼Œåˆ™å¿…é¡»ä½¿è§„èŒƒå½¢å¼ä¿æŒæœ€æ–°ã€‚\nequals æ–¹æ³•çš„æ€§èƒ½å¯èƒ½ä¼šå—åˆ°å­—æ®µæ¯”è¾ƒé¡ºåºçš„å½±å“ã€‚ä¸ºäº†è·å¾—æœ€ä½³æ€§èƒ½ï¼Œä½ åº”è¯¥é¦–å…ˆæ¯”è¾ƒé‚£äº›æ›´å¯èƒ½ä¸åŒã€æ¯”è¾ƒæˆæœ¬æ›´ä½çš„å­—æ®µï¼Œæˆ–è€…ç†æƒ³æƒ…å†µä¸‹ä¸¤è€…éƒ½æ¯”è¾ƒã€‚ä¸èƒ½æ¯”è¾ƒä¸å±äºå¯¹è±¡é€»è¾‘çŠ¶æ€çš„å­—æ®µï¼Œä¾‹å¦‚ç”¨äºåŒæ­¥æ“ä½œçš„é”å­—æ®µã€‚ä½ ä¸éœ€è¦æ¯”è¾ƒæ´¾ç”Ÿå­—æ®µï¼ˆå¯ä»¥ä»ã€Œé‡è¦å­—æ®µã€è®¡ç®—ï¼‰ï¼Œä½†æ˜¯è¿™æ ·åšå¯èƒ½ä¼šæé«˜ equals æ–¹æ³•çš„æ€§èƒ½ã€‚å¦‚æœæ´¾ç”Ÿå­—æ®µç›¸å½“äºæ•´ä¸ªå¯¹è±¡çš„æ‘˜è¦æè¿°ï¼Œé‚£ä¹ˆå¦‚æœæ¯”è¾ƒå¤±è´¥ï¼Œæ¯”è¾ƒè¯¥å­—æ®µå°†èŠ‚çœæ¯”è¾ƒå®é™…æ•°æ®çš„å¼€é”€ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ªå¤šè¾¹å½¢ç±»ï¼Œä½ ç¼“å­˜è¿™ä¸ªåŒºåŸŸã€‚å¦‚æœä¸¤ä¸ªå¤šè¾¹å½¢çš„é¢ç§¯ä¸ç›¸ç­‰ï¼Œä½ ä¸éœ€è¦æ¯”è¾ƒå®ƒä»¬çš„è¾¹å’Œé¡¶ç‚¹ã€‚\nå†™å®Œ equals æ–¹æ³•åï¼Œé—®è‡ªå·±ä¸‰ä¸ªé—®é¢˜ï¼šå®ƒå…·å¤‡å¯¹ç§°æ€§å—ï¼Ÿå…·å¤‡ä¼ é€’æ€§å—ï¼Ÿå…·å¤‡ä¸€è‡´æ€§å—ï¼Ÿ ä¸è¦åªé—®è‡ªå·±ï¼Œè¦ç¼–å†™å•å…ƒæµ‹è¯•æ¥æ£€æŸ¥ï¼Œé™¤éä½¿ç”¨ AutoValueï¼ˆç¬¬ 49 é¡µï¼‰æ¥ç”Ÿæˆ equals æ–¹æ³•ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥å®‰å…¨åœ°çœç•¥æµ‹è¯•ã€‚å¦‚æœå±æ€§ä¸èƒ½ä¿æŒï¼Œè¯·æ‰¾å‡ºåŸå› ï¼Œå¹¶ç›¸åº”åœ°ä¿®æ”¹ equals æ–¹æ³•ã€‚å½“ç„¶ï¼Œequals æ–¹æ³•è¿˜å¿…é¡»æ»¡è¶³å…¶ä»–ä¸¤ä¸ªå±æ€§ï¼ˆåå°„æ€§å’Œéæ— æ•ˆæ€§ï¼‰ï¼Œä½†è¿™ä¸¤ä¸ªé€šå¸¸ä¼šè‡ªå·±å¤„ç†ã€‚\nåœ¨è¿™ä¸ªç®€å•çš„ PhoneNumber ç±»ä¸­ï¼Œæ ¹æ®å‰é¢çš„æ–¹æ³•æ„é€ äº†ä¸€ä¸ª equals æ–¹æ³•ï¼š\n// Class with a typical equals method public final class PhoneNumber { private final short areaCode, prefix, lineNum; public PhoneNumber(int areaCode, int prefix, int lineNum) { this.areaCode = rangeCheck(areaCode, 999, \u0026#34;area code\u0026#34;); this.prefix = rangeCheck(prefix, 999, \u0026#34;prefix\u0026#34;); this.lineNum = rangeCheck(lineNum, 9999, \u0026#34;line num\u0026#34;); } private static short rangeCheck(int val, int max, String arg) { if (val \u0026lt; 0 || val \u0026gt; max) throw new IllegalArgumentException(arg + \u0026#34;: \u0026#34; + val); return (short) val; } @Override public boolean equals(Object o) { if (o == this) return true; if (!(o instanceof PhoneNumber)) return false; PhoneNumber pn = (PhoneNumber)o; return pn.lineNum == lineNum \u0026amp;\u0026amp; pn.prefix == prefix \u0026amp;\u0026amp; pn.areaCode == areaCode; } ... // Remainder omitted } ä»¥ä¸‹æ˜¯ä¸€äº›æœ€åçš„è­¦å‘Šï¼š\nå½“ä½ è¦†ç›– equals æ—¶ï¼Œä¹Ÿè¦†ç›– hashCodeã€‚\nä¸è¦è‡ªä½œèªæ˜ã€‚ å¦‚æœä½ åªæ˜¯ä¸ºäº†åˆ¤æ–­ç›¸ç­‰æ€§è€Œæµ‹è¯•å­—æ®µï¼Œé‚£ä¹ˆéµå¾ª equals çº¦å®šå¹¶ä¸å›°éš¾ã€‚å¦‚æœä½ åœ¨å¯»æ±‚å¯¹ç­‰æ–¹é¢è¿‡äºæ¿€è¿›ï¼Œå¾ˆå®¹æ˜“é™·å…¥éº»çƒ¦ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè€ƒè™‘åˆ°ä»»ä½•å½¢å¼çš„æ··å éƒ½ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚ä¾‹å¦‚ï¼ŒFile ç±»ä¸åº”è¯¥å°è¯•å°†å¼•ç”¨åŒä¸€æ–‡ä»¶çš„ç¬¦å·é“¾æ¥ç­‰åŒèµ·æ¥ã€‚å€¼å¾—åº†å¹¸çš„æ˜¯ï¼Œå®ƒä¸æ˜¯ã€‚\nä¸è¦ç”¨å¦ä¸€ç§ç±»å‹æ›¿æ¢ equals å£°æ˜ä¸­çš„å¯¹è±¡ã€‚ å¯¹äºç¨‹åºå‘˜æ¥è¯´ï¼Œç¼–å†™ä¸€ä¸ªç±»ä¼¼äºè¿™æ ·çš„ equals æ–¹æ³•ï¼Œç„¶åèŠ±ä¸Šå‡ ä¸ªå°æ—¶æ€è€ƒä¸ºä»€ä¹ˆå®ƒä¸èƒ½æ­£å¸¸å·¥ä½œæ˜¯å¾ˆå¸¸è§çš„ï¼š\n// Broken - parameter type must be Object! public boolean equals(MyClass o) { ... } è¿™é‡Œçš„é—®é¢˜æ˜¯ï¼Œè¿™ä¸ªæ–¹æ³•æ²¡æœ‰è¦†ç›–å…¶å‚æ•°ç±»å‹ä¸º Object çš„ Object.equalsï¼Œè€Œæ˜¯é‡è½½äº†å®ƒã€‚å³ä½¿æ˜¯æ™®é€šçš„æ–¹æ³•ï¼Œæä¾›è¿™æ ·ä¸€ä¸ªã€Œå¼ºç±»å‹çš„ã€equals æ–¹æ³•æ˜¯ä¸å¯æ¥å—çš„ï¼Œå› ä¸ºå®ƒä¼šå¯¼è‡´å­ç±»ä¸­çš„é‡å†™æ³¨é‡Šäº§ç”Ÿè¯¯æŠ¥å¹¶æä¾›é”™è¯¯çš„å®‰å…¨æ€§ã€‚\nå¦‚æœ¬æ¡ç›®æ‰€ç¤ºï¼Œä¸€è‡´ä½¿ç”¨ Override æ³¨é‡Šå°†é˜²æ­¢ä½ çŠ¯æ­¤é”™è¯¯ã€‚è¿™ä¸ª equals æ–¹æ³•ä¸ä¼šç¼–è¯‘ï¼Œé”™è¯¯æ¶ˆæ¯ä¼šå‘Šè¯‰ä½ ä»€ä¹ˆæ˜¯é”™è¯¯çš„ï¼š\n// Still broken, but wonâ€™t compile @Override public boolean equals(MyClass o) { ... } ç¼–å†™å’Œæµ‹è¯• equals ï¼ˆå’Œ hashCodeï¼‰æ–¹æ³•å¾ˆä¹å‘³ï¼Œç”Ÿæˆçš„ä»£ç ä¹Ÿå¾ˆå•è°ƒã€‚æ‰‹åŠ¨ç¼–å†™å’Œæµ‹è¯•è¿™äº›æ–¹æ³•çš„ä¸€ä¸ªå¾ˆå¥½çš„æ›¿ä»£æ–¹æ³•æ˜¯ä½¿ç”¨è°·æ­Œçš„å¼€æº AutoValue æ¡†æ¶ï¼Œå®ƒä¼šè‡ªåŠ¨ä¸ºä½ ç”Ÿæˆè¿™äº›æ–¹æ³•ï¼Œç”±ç±»ä¸Šçš„ä¸€ä¸ªæ³¨é‡Šè§¦å‘ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒAutoValue ç”Ÿæˆçš„æ–¹æ³•ä¸ä½ è‡ªå·±ç¼–å†™çš„æ–¹æ³•åŸºæœ¬ç›¸åŒã€‚\nIDE ä¹Ÿæœ‰ç”Ÿæˆ equals å’Œ hashCode æ–¹æ³•çš„åŠŸèƒ½ï¼Œä½†æ˜¯ç”Ÿæˆçš„æºä»£ç æ¯”ä½¿ç”¨ AutoValue çš„ä»£ç æ›´å†—é•¿ï¼Œå¯è¯»æ€§æ›´å·®ï¼Œä¸ä¼šè‡ªåŠ¨è·Ÿè¸ªç±»ä¸­çš„å˜åŒ–ï¼Œå› æ­¤éœ€è¦è¿›è¡Œæµ‹è¯•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè®© IDE ç”Ÿæˆ equalsï¼ˆå’Œ hashCodeï¼‰æ–¹æ³•é€šå¸¸æ¯”æ‰‹åŠ¨å®ç°æ›´å¯å–ï¼Œå› ä¸º IDE ä¸ä¼šå‡ºç°ç²—å¿ƒçš„é”™è¯¯ï¼Œè€Œäººä¼šã€‚\næ€»ä¹‹ï¼Œé™¤éå¿…é¡»ï¼Œå¦åˆ™ä¸è¦è¦†ç›– equals æ–¹æ³•ï¼šåœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œä» Object ç»§æ‰¿è€Œæ¥çš„å®ç°æ­£æ˜¯ä½ æƒ³è¦çš„ã€‚å¦‚æœä½ ç¡®å®è¦†ç›–äº† equalsï¼Œé‚£ä¹ˆä¸€å®šè¦æ¯”è¾ƒç±»çš„æ‰€æœ‰é‡è¦å­—æ®µï¼Œå¹¶ä»¥ä¿ç•™ equals çº¦å®šçš„æ‰€æœ‰ 5 é¡¹è§„å®šçš„æ–¹å¼è¿›è¡Œæ¯”è¾ƒã€‚\næ€»ç»“ ã€ŠEffective Javaã€‹ç¬¬ä¸‰ç‰ˆçš„ç¬¬ 10 æ¡å†…å®¹è®²è§£äº†åœ¨é‡å†™ Java ä¸­çš„equalsæ–¹æ³•æ—¶ï¼Œéµå¾ªé€šç”¨åå®šçš„é‡è¦æ€§ã€‚equalsæ–¹æ³•ç”¨äºç¡®å®šä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ã€‚\né€šç”¨åå®šå®šä¹‰äº†equalsæ–¹æ³•å¿…é¡»å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š\nåå°„æ€§ï¼šå¯¹äºä»»ä½•éç©ºçš„xï¼Œx.equals(x)å¿…é¡»è¿”å›trueã€‚ å¯¹ç§°æ€§ï¼šå¯¹äºä»»ä½•éç©ºå¼•ç”¨xå’Œyï¼Œå¦‚æœx.equals(y)è¿”å›trueï¼Œåˆ™y.equals(x)å¿…é¡»è¿”å›trueã€‚ ä¼ é€’æ€§ï¼šå¯¹äºä»»ä½•éç©ºå¼•ç”¨xã€yå’Œzï¼Œå¦‚æœx.equals(y)è¿”å›trueå¹¶ä¸”y.equals(z)è¿”å›trueï¼Œåˆ™x.equals(z)å¿…é¡»è¿”å›trueã€‚ ä¸€è‡´æ€§ï¼šå¯¹äºä»»ä½•éç©ºå¼•ç”¨xå’Œyï¼Œå¤šæ¬¡è°ƒç”¨x.equals(y)å¿…é¡»å§‹ç»ˆè¿”å›trueæˆ–å§‹ç»ˆè¿”å›falseï¼Œå‰ææ˜¯åœ¨ equals æ¯”è¾ƒä¸­ä½¿ç”¨çš„ä¿¡æ¯æœªè¢«ä¿®æ”¹ã€‚ å¯ç©ºæ€§ï¼šå¯¹äºä»»ä½•éç©ºå¼•ç”¨xï¼Œx.equals(null)å¿…é¡»è¿”å›falseã€‚ åœ¨é‡å†™equalsæ–¹æ³•æ—¶ï¼Œé‡è¦çš„æ˜¯è¦ç¡®ä¿æ»¡è¶³è¿™äº›ç‰¹æ€§ã€‚æ­¤å¤–ï¼Œå»ºè®®éµå¾ªä¸€äº›æœ€ä½³å®è·µï¼Œä¾‹å¦‚ï¼š\næ¯”è¾ƒå‰æ£€æŸ¥å¼•ç”¨æ˜¯å¦ç›¸åŒï¼šå¦‚æœä¸¤ä¸ªå¯¹è±¡å¼•ç”¨ç›¸åŒï¼Œå³å®ƒä»¬æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒä»¬ä¸€å®šç›¸ç­‰ã€‚åœ¨æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡ä¹‹å‰ï¼Œé¦–å…ˆä½¿ç”¨==è¿ç®—ç¬¦æ£€æŸ¥å®ƒä»¬çš„å¼•ç”¨æ˜¯å¦ç›¸åŒï¼Œä»¥æé«˜æ•ˆç‡ã€‚\næ¯”è¾ƒå¯¹è±¡ç±»å‹ï¼šåœ¨æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡ä¹‹å‰ï¼Œé¦–å…ˆä½¿ç”¨instanceofè¿ç®—ç¬¦æ£€æŸ¥å®ƒä»¬æ˜¯å¦å±äºåŒä¸€ä¸ªç±»ã€‚å¦‚æœä¸æ˜¯ï¼Œé‚£ä¹ˆå®ƒä»¬ä¸å¯èƒ½ç›¸ç­‰ã€‚è¿™æ ·å¯ä»¥é¿å…åœ¨ç»§æ‰¿å±‚æ¬¡ç»“æ„ä¸­å‡ºç°é—®é¢˜ã€‚\næ¯”è¾ƒæ¯ä¸ªé‡è¦å­—æ®µï¼šåœ¨æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ—¶ï¼Œéœ€è¦æ¯”è¾ƒå®ƒä»¬çš„æ¯ä¸ªé‡è¦å­—æ®µã€‚å¯¹äºåŸºæœ¬ç±»å‹å­—æ®µï¼Œä½¿ç”¨==è¿ç®—ç¬¦è¿›è¡Œæ¯”è¾ƒï¼›å¯¹äºå¯¹è±¡å¼•ç”¨å­—æ®µï¼Œé€’å½’è°ƒç”¨Objects.equals()æ–¹æ³•æ¯”è¾ƒï¼›å¯¹äºfloatå’Œdoubleç±»å‹çš„å­—æ®µï¼Œä½¿ç”¨Float.compareå’ŒDouble.compareæ–¹æ³•è¿›è¡Œæ¯”è¾ƒï¼›å¯¹äºæ•°ç»„å­—æ®µï¼Œä½¿ç”¨Arrays.equalsæ–¹æ³•è¿›è¡Œæ¯”è¾ƒã€‚\nè¦†ç›–hashCodeæ–¹æ³•ï¼šæ ¹æ®é€šç”¨åå®šï¼Œå¦‚æœä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼Œå®ƒä»¬çš„hashCodeå€¼ä¹Ÿå¿…é¡»ç›¸ç­‰ã€‚å› æ­¤ï¼Œåœ¨é‡å†™equalsæ–¹æ³•æ—¶ï¼Œé€šå¸¸ä¹Ÿéœ€è¦é‡å†™hashCodeæ–¹æ³•ï¼Œä»¥ç¡®ä¿å¯¹è±¡çš„ç›¸ç­‰æ€§è¢«æ­£ç¡®åœ°åˆ¤æ–­ï¼Œå¹¶ä¸”é¿å…æ•£åˆ—è¡¨ä¸­å‡ºç°å“ˆå¸Œå†²çªã€‚\nè€ƒè™‘ä½¿ç”¨@Overrideæ³¨é‡ŠæŒ‡ç¤ºæ‚¨æ­£åœ¨è¦†ç›–equalsæ–¹æ³•ã€‚\nä¸å°†equalsæ–¹æ³•å®šä¹‰ä¸ºåªæ¥å—ç‰¹å®šç±»å‹çš„å‚æ•°ï¼šequalsæ–¹æ³•çš„å‚æ•°ç±»å‹åº”è¯¥æ˜¯Objectç±»å‹ï¼Œè€Œä¸æ˜¯å…·ä½“çš„ç±»æˆ–æ¥å£ç±»å‹ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿equalsæ–¹æ³•å¯ä»¥æ¯”è¾ƒä»»ä½•ç±»å‹çš„å¯¹è±¡ï¼Œè€Œä¸ä»…ä»…æ˜¯ç‰¹å®šç±»å‹çš„å¯¹è±¡ã€‚\nä¸ä½¿ç”¨getClassæ–¹æ³•æ¯”è¾ƒå¯¹è±¡ç±»å‹ï¼šåœ¨æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„ç±»å‹æ—¶ï¼Œä¸åº”è¯¥ä½¿ç”¨getClassæ–¹æ³•ï¼Œè€Œåº”è¯¥ä½¿ç”¨instanceofè¿ç®—ç¬¦ã€‚è¿™æ˜¯å› ä¸ºgetClassæ–¹æ³•å¯èƒ½ä¼šè¢«å­ç±»é‡å†™ï¼Œå¹¶è¿”å›ä¸åŒçš„ç»“æœï¼Œä»è€Œå¯¼è‡´æ¯”è¾ƒç»“æœå‡ºç°é—®é¢˜ã€‚\nä¸å°†equalsæ–¹æ³•ä¸==è¿ç®—ç¬¦æ··æ·†ï¼šequalsæ–¹æ³•ç”¨äºæ¯”è¾ƒå¯¹è±¡çš„å†…å®¹ï¼Œè€Œ==è¿ç®—ç¬¦ç”¨äºæ¯”è¾ƒå¯¹è±¡çš„å¼•ç”¨ã€‚åœ¨æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ—¶ï¼Œåº”è¯¥ä½¿ç”¨equalsæ–¹æ³•è€Œä¸æ˜¯==è¿ç®—ç¬¦ã€‚\nä¸å°†equalsæ–¹æ³•ä¸compareToæ–¹æ³•æ··æ·†ï¼šequalsæ–¹æ³•ç”¨äºæ¯”è¾ƒå¯¹è±¡çš„å†…å®¹ï¼Œè€ŒcompareToæ–¹æ³•ç”¨äºæ¯”è¾ƒå¯¹è±¡çš„é¡ºåºã€‚åœ¨æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ—¶ï¼Œåº”è¯¥ä½¿ç”¨é€‚å½“çš„æ–¹æ³•ï¼Œé¿å…æ··æ·†å®ƒä»¬çš„ä½œç”¨ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/05/17/obey-the-general-contract-when-overriding-equals/","summary":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬ä¸‰ç« ã€Šå¯¹è±¡çš„é€šç”¨æ–¹æ³•ã€‹çš„å­¦ä¹ ç¬”è®°ï¼šè¦†ç›– equals æ–¹æ³•æ—¶åº”éµå®ˆçš„çº¦å®šã€‚\nä»‹ç» è¦†ç›– equals æ–¹æ³•ä¼¼ä¹å¾ˆç®€å•ï¼Œä½†æ˜¯æœ‰å¾ˆå¤šè¦†ç›–çš„æ–¹å¼ä¼šå¯¼è‡´å‡ºé”™ï¼Œè€Œä¸”åæœå¯èƒ½éå¸¸ä¸¥é‡ã€‚é¿å…é—®é¢˜çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä¸è¦†ç›– equals æ–¹æ³•ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç±»çš„æ¯ä¸ªå®ä¾‹éƒ½åªç­‰äºå®ƒè‡ªå·±ã€‚å¦‚æœç¬¦åˆä¸‹åˆ—ä»»ä½•æ¡ä»¶ï¼Œå°±æ˜¯æ­£ç¡®çš„åšæ³•ï¼š\nç±»çš„æ¯ä¸ªå®ä¾‹æœ¬è´¨ä¸Šéƒ½æ˜¯å”¯ä¸€çš„ã€‚ å¯¹äºåƒ Thread è¿™æ ·è¡¨ç¤ºæ´»åŠ¨å®ä½“ç±»è€Œä¸æ˜¯å€¼ç±»æ¥è¯´ä¹Ÿæ˜¯å¦‚æ­¤ã€‚Object æä¾›çš„ equals å®ç°å¯¹äºè¿™äº›ç±»å…·æœ‰å®Œå…¨æ­£ç¡®çš„è¡Œä¸ºã€‚\nè¯¥ç±»ä¸éœ€è¦æä¾›ã€Œé€»è¾‘ç›¸ç­‰ã€æµ‹è¯•ã€‚ ä¾‹å¦‚ï¼Œjava.util.regex.Pattern å¯ä»¥è¦†ç›– equals æ¥æ£€æŸ¥ä¸¤ä¸ª Pattern å®ä¾‹æ˜¯å¦è¡¨ç¤ºå®Œå…¨ç›¸åŒçš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œä½†è®¾è®¡äººå‘˜è®¤ä¸ºå®¢æˆ·ç«¯ä¸éœ€è¦æˆ–ä¸éœ€è¦è¿™ä¸ªåŠŸèƒ½ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä» Object ç»§æ‰¿çš„ equals å®ç°æ˜¯ç†æƒ³çš„ã€‚\nè¶…ç±»å·²ç»è¦†ç›–äº† equalsï¼Œè¶…ç±»è¡Œä¸ºé€‚åˆäºè¿™ä¸ªç±»ã€‚ ä¾‹å¦‚ï¼Œå¤§å¤šæ•° Set çš„å®ç°ä» AbstractSet ç»§æ‰¿å…¶å¯¹ç­‰å®ç°ï¼ŒList ä» AbstractList ç»§æ‰¿å®ç°ï¼ŒMap ä» AbstractMap ç»§æ‰¿å®ç°ã€‚\nç±»æ˜¯ç§æœ‰çš„æˆ–åŒ…ç§æœ‰çš„ï¼Œå¹¶ä¸”ä½ ç¡®ä¿¡å®ƒçš„ equals æ–¹æ³•æ°¸è¿œä¸ä¼šè¢«è°ƒç”¨ã€‚ å¦‚æœä½ éå¸¸åŒæ¶é£é™©ï¼Œä½ å¯ä»¥è¦†ç›– equals æ–¹æ³•ï¼Œä»¥ç¡®ä¿å®ƒä¸ä¼šæ„å¤–è°ƒç”¨ï¼š\n@Override public boolean equals(Object o) { throw new AssertionError(); // Method is never called } ä»€ä¹ˆæ—¶å€™è¦†ç›– equals æ–¹æ³•æ˜¯åˆé€‚çš„ï¼Ÿå½“ä¸€ä¸ªç±»æœ‰ä¸€ä¸ªé€»è¾‘ç›¸ç­‰çš„æ¦‚å¿µï¼Œè€Œè¿™ä¸ªæ¦‚å¿µä¸åŒäºä»…åˆ¤æ–­å¯¹è±¡çš„åŒä¸€æ€§ï¼ˆç›¸åŒå¯¹è±¡çš„å¼•ç”¨ï¼‰ï¼Œå¹¶ä¸”è¶…ç±»è¿˜æ²¡æœ‰è¦†ç›– equalsã€‚å¯¹äºå€¼ç±»é€šå¸¸æ˜¯è¿™æ ·ã€‚å€¼ç±»åªæ˜¯è¡¨ç¤ºå€¼çš„ç±»ï¼Œä¾‹å¦‚ Integer æˆ– Stringã€‚ä½¿ç”¨ equals æ–¹æ³•æ¯”è¾ƒå¼•ç”¨å’Œå€¼å¯¹è±¡çš„ç¨‹åºå‘˜å¸Œæœ›å‘ç°å®ƒä»¬åœ¨é€»è¾‘ä¸Šæ˜¯å¦ç­‰ä»·ï¼Œè€Œä¸æ˜¯å®ƒä»¬æ˜¯å¦å¼•ç”¨ç›¸åŒçš„å¯¹è±¡ã€‚è¦†ç›– equals æ–¹æ³•ä¸ä»…æ˜¯ä¸ºäº†æ»¡è¶³ç¨‹åºå‘˜çš„æœŸæœ›ï¼Œå®ƒè¿˜ä½¿å®ä¾‹èƒ½å¤Ÿä½œä¸º Map çš„é”®æˆ– Set å…ƒç´ æ—¶ï¼Œå…·æœ‰å¯é¢„æµ‹çš„ã€ç†æƒ³çš„è¡Œä¸ºã€‚\næœ‰ä¸€ä¸ªè¡¨ç¤ºçŠ¶æ€çš„å†…éƒ¨ç±»ã€‚æ²¡æœ‰è¦†ç›– equals æ–¹æ³•æ—¶ï¼Œequals çš„ç»“æœä¸ s1==s2 ç›¸åŒï¼Œä¸º falseï¼Œå³ä¸¤è€…å¹¶ä¸æ˜¯ç›¸åŒå¯¹è±¡çš„å¼•ç”¨ã€‚\npublic static void main(String[] args) { class Status { public String status; } Status s1 = new Status(); Status s2 = new Status(); System.","title":"ã€ŠEffective Java 3ã€‹ç¬”è®°10ï¼šè¦†ç›–equalsæ–¹æ³•æ—¶åº”éµå®ˆçš„çº¦å®š"},{"content":"ä»‹ç» Git Flow æ˜¯ç”± Vincent Driessen åœ¨ 2010 å¹´æå‡ºçš„ä¸€ç§ Git å·¥ä½œæµã€‚åœ¨è¿™ä¹‹å‰ï¼ŒGit æ²¡æœ‰ä¸€ä¸ªæ˜ç¡®çš„æ ‡å‡†å·¥ä½œæµï¼Œå¯¼è‡´å›¢é˜Ÿåœ¨ä½¿ç”¨ Git æ—¶å¾€å¾€ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ï¼Œå¦‚åˆ†æ”¯ç®¡ç†ã€ç‰ˆæœ¬æ§åˆ¶ç­‰ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼ŒVincent Driessen æå‡ºäº† Git Flow åˆ†æ”¯æ¨¡å‹ï¼Œæˆä¸ºäº† Git åœ¨å®é™…åº”ç”¨ä¸­çš„ä¸€ç§æ ‡å‡†å·¥ä½œæµã€‚\néšç€æ—¶é—´çš„æ¨ç§»ï¼ŒGit Flow ä¹Ÿåœ¨ä¸æ–­å‘å±•å’Œå®Œå–„ã€‚åœ¨ 2011 å¹´ï¼ŒAtlassian å‘å¸ƒäº† SourceTreeï¼Œè¿™æ˜¯ä¸€æ¬¾å›¾å½¢åŒ–çš„ Git å®¢æˆ·ç«¯ï¼Œæ”¯æŒ Git Flow åˆ†æ”¯æ¨¡å‹ã€‚åœ¨ 2013 å¹´ï¼ŒGit Flow çš„ä¸€äº›å¼€å‘è€…å‘å¸ƒäº† Git Flow AVH Editionï¼Œè¿™æ˜¯ Git Flow çš„ä¸€ä¸ªå¢å¼ºç‰ˆæœ¬ï¼Œæä¾›äº†æ›´å¤šçš„åŠŸèƒ½å’Œé€‰é¡¹ã€‚æ­¤å¤–ï¼ŒGit Flow è¿˜å¾—åˆ°äº†å…¶ä»–å¼€æºå·¥å…·å’Œå¹³å°çš„æ”¯æŒï¼Œå¦‚ GitHubã€GitLab ç­‰ã€‚\nGit Flow åˆ†æ”¯æ¨¡å‹ Git Flow åˆ†æ”¯æ¨¡å‹å®šä¹‰äº†ä¸€ç§æ ‡å‡†çš„ Git åˆ†æ”¯æ¨¡å‹ï¼Œå®ƒå°†ä»£ç åˆ†ä¸ºä¸¤ä¸ªé•¿æœŸåˆ†æ”¯ï¼ˆmaster å’Œ developï¼‰å’Œä¸‰ä¸ªçŸ­æœŸåˆ†æ”¯ï¼ˆfeatureã€release å’Œ hotfixï¼‰ï¼Œä½¿å¾—å›¢é˜Ÿå¯ä»¥æ›´å¥½åœ°ç®¡ç†ä»£ç çš„ç‰ˆæœ¬å’Œå‘å¸ƒã€‚\nä»¥ä¸‹æ˜¯ Git Flow åˆ†æ”¯æ¨¡å‹çš„è¯¦ç»†ä»‹ç»ï¼š\nmaster åˆ†æ”¯ master åˆ†æ”¯æ˜¯ä»£ç åº“çš„ä¸»åˆ†æ”¯ï¼Œå®ƒåŒ…å«äº†æ‰€æœ‰å·²å‘å¸ƒçš„ä»£ç å’Œç‰ˆæœ¬ã€‚æ‰€æœ‰ä»£ç éƒ½åº”è¯¥åœ¨è¯¥åˆ†æ”¯ä¸Šè¿›è¡Œæµ‹è¯•å’ŒéªŒè¯ï¼Œä»¥ç¡®ä¿ä»£ç çš„è´¨é‡å’Œç¨³å®šæ€§ã€‚masteråˆ†æ”¯åªèƒ½é€šè¿‡åˆå¹¶releaseæˆ–hotfixåˆ†æ”¯æ¥æ›´æ–°ã€‚ develop åˆ†æ”¯ develop åˆ†æ”¯æ˜¯ä»£ç åº“çš„å¼€å‘åˆ†æ”¯ï¼Œå®ƒåŒ…å«äº†æ‰€æœ‰å¼€å‘ä¸­çš„ä»£ç å’ŒåŠŸèƒ½ã€‚æ‰€æœ‰æ–°çš„ä»£ç éƒ½åº”è¯¥åœ¨è¯¥åˆ†æ”¯ä¸Šè¿›è¡Œå¼€å‘å’Œæµ‹è¯•ï¼Œä»¥ç¡®ä¿ä»£ç çš„å¯é æ€§å’Œç¨³å®šæ€§ã€‚developåˆ†æ”¯åªèƒ½é€šè¿‡åˆå¹¶featureåˆ†æ”¯æ¥æ›´æ–°ã€‚ feature åˆ†æ”¯ feature åˆ†æ”¯æ˜¯ä¸ºå¼€å‘æ–°çš„åŠŸèƒ½æˆ–ä¿®å¤ bug è€Œåˆ›å»ºçš„ä¸´æ—¶åˆ†æ”¯ã€‚æ¯ä¸ªfeatureåˆ†æ”¯éƒ½æ˜¯ä»developåˆ†æ”¯åˆ†ç¦»å‡ºæ¥çš„ï¼Œå¼€å‘å®Œæˆåä¼šåˆå¹¶å›developåˆ†æ”¯ã€‚feature åˆ†æ”¯çš„å‘½ååº”è¯¥æ¸…æ™°æ˜ç¡®ï¼Œä»¥åæ˜ è¯¥åˆ†æ”¯æ‰€æ¶‰åŠçš„åŠŸèƒ½æˆ–é—®é¢˜ã€‚ release åˆ†æ”¯ release åˆ†æ”¯æ˜¯ä¸ºå‘å¸ƒæ–°ç‰ˆæœ¬è€Œåˆ›å»ºçš„ä¸´æ—¶åˆ†æ”¯ã€‚æ¯ä¸ªreleaseåˆ†æ”¯éƒ½æ˜¯ä»developåˆ†æ”¯åˆ†ç¦»å‡ºæ¥çš„ï¼Œå‘å¸ƒå®Œæˆåä¼šåˆå¹¶å›developåˆ†æ”¯å’Œmasteråˆ†æ”¯ã€‚åœ¨ release åˆ†æ”¯ä¸Šå¯ä»¥è¿›è¡Œä¸€äº›å°çš„ä¿®å¤å’Œè°ƒæ•´ï¼Œä»¥ç¡®ä¿å‘å¸ƒçš„ä»£ç çš„è´¨é‡å’Œç¨³å®šæ€§ã€‚ hotfix åˆ†æ”¯ hotfix åˆ†æ”¯æ˜¯ä¸ºå¿«é€Ÿä¿®å¤ç”Ÿäº§ç¯å¢ƒä¸­çš„é—®é¢˜è€Œåˆ›å»ºçš„ä¸´æ—¶åˆ†æ”¯ã€‚æ¯ä¸ª hotfix åˆ†æ”¯éƒ½æ˜¯ä» master åˆ†æ”¯åˆ†ç¦»å‡ºæ¥çš„ï¼Œä¿®å¤å®Œæˆåä¼šåˆå¹¶å› develop åˆ†æ”¯å’Œ master åˆ†æ”¯ã€‚hotfixåˆ†æ”¯çš„ä¼˜å…ˆçº§æ¯”å…¶ä»–åˆ†æ”¯æ›´é«˜ï¼Œå› ä¸ºå®ƒä»¬éœ€è¦å°½å¿«ä¿®å¤ç”Ÿäº§ç¯å¢ƒä¸­çš„é—®é¢˜ã€‚ æ ¹æ®ä¸Šé¢çš„ç†è®ºï¼Œæˆ‘ä»¬æ¥å®é™…æ“ä½œä¸€éã€‚é¦–å…ˆï¼Œæ˜¯ develop åˆ†æ”¯åˆ›å»ºä¸€ä¸ª feature åˆ†æ”¯ã€‚\n$ git checkout -b feature-test develop Switched to a new branch \u0026#34;feature-test\u0026#34; å°† feature åˆ†æ”¯çš„ä¿®æ”¹åˆå¹¶åˆ° develop åˆ†æ”¯ï¼Œç„¶ååˆ é™¤ feature åˆ†æ”¯ï¼š\n$ git checkout develop Switched to branch \u0026#39;develop\u0026#39; $ git merge --no-ff feature-test Updating ea1b82a..05e9557 (Summary of changes) $ git branch -d feature-test Deleted branch feature-test (was 05e9557). $ git push origin develop åˆå¹¶åˆ†æ”¯æ—¶ï¼Œæ·»åŠ --no-ff å‚æ•°å’Œä¸æ·»åŠ çš„åŒºåˆ«ï¼š\nä» develop åˆ†æ”¯åˆ›å»ºä¸€ä¸ª release åˆ†æ”¯ï¼Œå¹¶å°†ç‰ˆæœ¬å·æ”¹ä¸º 1.2 ï¼š\n$ git checkout -b release-1.2 develop Switched to a new branch \u0026#34;release-1.2\u0026#34; $ ./bump-version.sh 1.2 Files modified successfully, version bumped to 1.2. $ git commit -a -m \u0026#34;Bumped version number to 1.2\u0026#34; [release-1.2 74d9424] Bumped version number to 1.2 1 files changed, 1 insertions(+), 1 deletions(-) release åˆ†æ”¯å®Œæˆå¼€å‘ä¹‹åï¼Œå°† release åˆ†æ”¯åˆå¹¶åˆ° master åˆ†æ”¯ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ ‡ç­¾ï¼š\n$ git checkout master Switched to branch \u0026#39;master\u0026#39; $ git merge --no-ff release-1.2 Merge made by recursive. (Summary of changes) $ git tag -a 1.2 å°† release åˆ†æ”¯åˆå¹¶åˆ° develop åˆ†æ”¯ï¼š\n$ git checkout develop Switched to branch \u0026#39;develop\u0026#39; $ git merge --no-ff release-1.2 Merge made by recursive. (Summary of changes) æœ€ååˆ é™¤ release åˆ†æ”¯ï¼š\n$ git branch -d release-1.2 Deleted branch release-1.2 (was ff452fe). å¯¹äº hoftfix åˆ†æ”¯ï¼Œæ“ä½œæ­¥éª¤å’Œ release åˆ†æ”¯ç±»ä¼¼ï¼Œæ•…ä¸åœ¨èµ˜è¿°ã€‚\ngit-flow å·¥å…· git-flow å·¥å…·å¯ä»¥ç®€åŒ–ä¸Šé¢çš„æ“ä½œæ­¥éª¤ï¼Œå…³äº git-flow çš„ä»‹ç»å¯ä»¥å‚è€ƒæ–‡ç« ï¼šUsing git-flow to automate your git branching workflowã€‚\nmacos ä¸Šå®‰è£… git-flowï¼š\nbrew install git-flow git-flow é¦–å…ˆéœ€è¦åˆå§‹åŒ–ï¼Œå¦‚æœä¸å­˜åœ¨ develop åˆ†æ”¯ï¼Œåˆ™ä¼šæ–°å»ºä¸€ä¸ª develop åˆ†æ”¯ï¼š\ngit flow init No branches exist yet. Base branches must be created now. Branch name for production releases: [master] Branch name for \u0026#34;next release\u0026#34; development: [develop] How to name your supporting branch prefixes? Feature branches? [feature-] Release branches? [release-] Hotfix branches? [hotfix/] Support branches? [support/] Version tag prefix? [] feature åˆ†æ”¯ å¼€å‘ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œåˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯ foo\n$ git flow feature start foo ç­‰ä»·äº\n#åˆ‡æ¢åˆ°developåˆ†æ”¯,ç¡®ä¿æ–°çš„ feature åˆ†æ”¯æ˜¯åŸºäºæœ€æ–°çš„ develop åˆ†æ”¯åˆ›å»ºçš„ã€‚ $ git checkout -b feature-foo develop å–æ¶ˆæ­£åœ¨è¿›è¡Œä¸­çš„åŠŸèƒ½åˆ†æ”¯ï¼Œå¹¶ä¸”ä¼šå°†åˆ†æ”¯åˆ é™¤\n$ git flow feature delete foo ç­‰ä»·äº\n$ git branch -D feature-foo foo åŠŸèƒ½è‡ªæµ‹é€šè¿‡åï¼Œåˆå¹¶åˆ° develop\n$ git flow feature finish foo ç­‰ä»·äº\n//åˆ‡æ¢åˆ° develop åˆ†æ”¯ $ git checkout develop //å°† feature-foo åˆ†æ”¯ä¸­çš„æ›´æ”¹åˆå¹¶åˆ° develop åˆ†æ”¯ã€‚ --no-ff å‚æ•°å°†ä¿ç•™ foo åˆ†æ”¯çš„commitè®°å½•ã€‚ $ git merge --no-ff feature-foo //åˆ é™¤å·²å®Œæˆçš„åˆ†æ”¯ $ git branch -d feature-foo release åˆ†æ”¯ å½“æ‰€æœ‰æ–°çš„åŠŸèƒ½å’Œå¿…è¦çš„ä¿®å¤å·²ç»è¢«å½»åº•çš„æµ‹è¯•è¿‡äº†ï¼Œé‚£å°±å¼€å§‹ç”Ÿæˆä¸€ä¸ªæ–°çš„ release , åœ¨æ­¤ä¹‹åä¸èƒ½æ·»åŠ æ–°åŠŸèƒ½ï¼Œåªæœ‰é”™è¯¯ä¿®å¤ã€æ–‡æ¡£ç”Ÿæˆå’Œå…¶ä»–é¢å‘å‘å¸ƒçš„ä»»åŠ¡åº”è¯¥åœ¨è¯¥åˆ†æ”¯ä¸­è¿›è¡Œã€‚\n# 1.0.0 æ˜¯ç‰ˆæœ¬å· $ git flow release start 1.0.0 ç­‰ä»·äº\n# ä» develop åˆ†æ”¯ åˆ›å»ºreleaseåˆ†æ”¯ $ git checkout -b release-1.0.0 develop å–æ¶ˆæ­£åœ¨è¿›è¡Œä¸­çš„å‘å¸ƒåˆ†æ”¯ï¼Œå¹¶ä¸”ä¼šå°†åˆ†æ”¯åˆ é™¤ã€‚\n$ git flow release delete 1.0.0 ç­‰ä»·äº\ngit branch -D release-1.0.0 æ·»åŠ å®Œå‘å¸ƒæ–‡æ¡£ä¹‹åï¼Œå®Œæˆ release\n$ git flow release finish 1.0.0 ç­‰ä»·äº\n#åˆ‡æ¢åˆ° develop åˆ†æ”¯ã€‚ $ git checkout develop #å°† release-1.0.0 åˆ†æ”¯åˆå¹¶åˆ° develop åˆ†æ”¯ï¼Œ--no-ff é€‰é¡¹ä»¥ä¿ç•™ feature åˆ†æ”¯çš„ commit è®°å½• $ git merge --no-ff release-1.0.0 #åˆ›å»ºä¸€ä¸ªåä¸º 1.0.0 çš„æ ‡ç­¾ $ git tag -a 1.0.0 -m \u0026#34;Release 1.0.0\u0026#34; #åˆ‡æ¢åˆ° master åˆ†æ”¯ã€‚ $ git checkout master #å°† release-1.0.0 åˆ†æ”¯åˆå¹¶åˆ° master åˆ†æ”¯ï¼Œ--no-ff é€‰é¡¹ä»¥ä¿ç•™ feature åˆ†æ”¯çš„ commit è®°å½• $ git merge --no-ff release-1.0.0 #åˆ é™¤ release-1.0.0 åˆ†æ”¯ã€‚ $ git branch -d release-1.0.0 Hotfixes åˆ†æ”¯ çº¿ä¸Šå‘ç”Ÿé—®é¢˜çš„æ—¶å€™ï¼Œå…ˆå›æ»šåˆ°ä¹‹å‰çš„ç¨³å®šç‰ˆæœ¬ï¼Œç¨³å®šå±€åŠ¿ ç„¶ååˆ›å»ºçƒ­ä¿®å¤åˆ†æ”¯å¼€å§‹æ”¹ BUG\n$ git flow hotfix start 1.0.1 ç­‰ä»·äº\n#ä»masteråˆ†æ”¯ åˆ›å»ºä¸€ä¸ªhotfix/1.0.1åˆ†æ”¯ $ git checkout -b hotfix/1.0.1 foo master ç´§æ€¥ä¿®å¤å®Œæ¯•\n$ git flow hotfix finish 1.0.1 ç­‰ä»·äº\n#åˆ‡æ¢ master åˆ†æ”¯ $ git checkout master #åˆå¹¶çƒ­ä¿®å¤åˆ†æ”¯åˆ°master,--no-ff é€‰é¡¹ä»¥ä¿ç•™ feature åˆ†æ”¯çš„ commit è®°å½• $ git merge --no-ff hotfix/ohno #åˆ›å»ºä¸€ä¸ªåä¸º 1.0.1 çš„æ ‡ç­¾ $ git tag 1.0.1 #åˆ‡æ¢åˆ° develop åˆ†æ”¯ $ git checkout develop #åˆå¹¶çƒ­ä¿®å¤åˆ†æ”¯åˆ° develop ,--no-ff é€‰é¡¹ä»¥ä¿ç•™ feature åˆ†æ”¯çš„ commit è®°å½• $ git merge --no-ff hotfix/1.0.1 #åˆ é™¤çƒ­ä¿®å¤åˆ†æ”¯ $ git branch -d hotfix/1.0.1 git-flow (AVH Edition) Git-flow (AVH Edition)æ˜¯ Git Flow çš„ä¸€ä¸ªå¢å¼ºç‰ˆæœ¬ï¼Œç”±ä¸€äº› Git Flow çš„å¼€å‘è€…å¼€å‘å’Œç»´æŠ¤ã€‚Git-flow (AVH Edition)åœ¨ä¿ç•™ Git Flow åŸºæœ¬æ€æƒ³çš„å‰æä¸‹ï¼Œå¢åŠ äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œé€‰é¡¹ï¼Œä½¿å¾— Git Flow æ›´åŠ çµæ´»å’Œé€‚ç”¨äºä¸åŒçš„å›¢é˜Ÿå’Œé¡¹ç›®ã€‚\nGit-flow (AVH Edition)çš„ä¸»è¦å¢å¼ºåŠŸèƒ½åŒ…æ‹¬ï¼š\næ”¯æŒ git-flow init å‘½ä»¤ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªæ–°çš„ Git ä»“åº“ä¸­å¿«é€Ÿåˆå§‹åŒ– Git Flowã€‚ æ”¯æŒ git flow feature pull å‘½ä»¤ï¼Œå¯ä»¥æ‹‰å–å…¶ä»–å›¢é˜Ÿæˆå‘˜çš„ feature åˆ†æ”¯ã€‚ æ”¯æŒ git flow feature publish å‘½ä»¤ï¼Œå¯ä»¥å°† feature åˆ†æ”¯å‘å¸ƒåˆ°è¿œç¨‹ä»“åº“ã€‚ æ”¯æŒ git flow hotfix finish å‘½ä»¤ï¼Œå¯ä»¥åœ¨ä¿®å¤ç”Ÿäº§ç¯å¢ƒé—®é¢˜æ—¶è‡ªåŠ¨åˆå¹¶åˆ° develop åˆ†æ”¯å’Œ master åˆ†æ”¯å¹¶å‘å¸ƒæ–°ç‰ˆæœ¬ã€‚ æ”¯æŒ git flow support åˆ†æ”¯ï¼Œå¯ä»¥ä¸ºæ—§ç‰ˆæœ¬æä¾›é•¿æœŸæ”¯æŒã€‚ å…è®¸ä½¿ç”¨ Hooks and Filters æ¥æ‰©å±•å’Œè‡ªå®šä¹‰ Git Flow çš„è¡Œä¸ºã€‚ é™¤äº†ä»¥ä¸ŠåŠŸèƒ½ä¹‹å¤–ï¼ŒGit-flow (AVH Edition)è¿˜æä¾›äº†æ›´å¤šçš„é€‰é¡¹å’Œé…ç½®ï¼Œä½¿å¾—å›¢é˜Ÿå¯ä»¥æ ¹æ®ä¸åŒçš„éœ€æ±‚å’Œæƒ…å†µæ¥è‡ªå®šä¹‰ Git Flow çš„åˆ†æ”¯æ¨¡å‹å’Œå·¥ä½œæµç¨‹ã€‚\nåˆå§‹åŒ– ä½¿ç”¨ä¸‹é¢å‘½ä»¤åˆå§‹åŒ– git fowï¼Œ-d æ˜¯å¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºä½¿ç”¨é»˜è®¤å‚æ•°ï¼š\ngit flow init [-d] åˆ›å»º feature/release/hotfix/support åˆ†æ”¯ æŸ¥çœ‹ã€å¼€å§‹ã€å®Œæˆã€åˆ é™¤ feature åˆ†æ”¯ï¼š\ngit flow feature # \u0026lt;base\u0026gt; å‚æ•°å¿…é¡»æ˜¯åˆ†æ”¯åç§°ï¼Œç¼ºå¤±æ—¶ï¼Œé»˜è®¤ä¸º develop åˆ†æ”¯ git flow feature start \u0026lt;name\u0026gt; [\u0026lt;base\u0026gt;] git flow feature finish \u0026lt;name\u0026gt; git flow feature delete \u0026lt;name\u0026gt; å‘å¸ƒæˆ–è€…è·Ÿè¸ª feature åˆ†æ”¯ï¼š\n#å¦‚æœå½“å‰åœ¨ feature/name åˆ†æ”¯ï¼Œåˆ™å¯ä»¥çœç•¥ \u0026lt;name\u0026gt; å‚æ•° git flow feature publish \u0026lt;name\u0026gt; git flow feature track \u0026lt;name\u0026gt; å½“ feature åˆ†æ”¯å‘å¸ƒä¹‹åï¼Œå…¶ä»–äººå¯ä»¥æ‹‰å–è¯¥åˆ†æ”¯ï¼š\ngit pull git checkout feature/\u0026lt;name\u0026gt; ç±»ä¼¼åœ°ï¼ŒæŸ¥çœ‹ã€å¼€å§‹ã€å®Œæˆã€åˆ é™¤ release åˆ†æ”¯ï¼š\ngit flow release git flow release start \u0026lt;name\u0026gt; [\u0026lt;base\u0026gt;] git flow release finish \u0026lt;name\u0026gt; git flow release delete \u0026lt;name\u0026gt; ç±»ä¼¼åœ°ï¼ŒæŸ¥çœ‹ã€å¼€å§‹ã€å®Œæˆã€åˆ é™¤ hotfix åˆ†æ”¯ï¼š\ngit flow hotfix git flow hotfix start \u0026lt;name\u0026gt; [\u0026lt;base\u0026gt;] git flow hotfix finish \u0026lt;name\u0026gt; git flow hotfix delete \u0026lt;name\u0026gt; æŸ¥çœ‹ã€å¼€å§‹ support åˆ†æ”¯ï¼š\ngit flow support git flow support start \u0026lt;name\u0026gt; \u0026lt;base\u0026gt; Hooks å’Œ Filters Git-flow (AVH Edition)å…è®¸ä½¿ç”¨ Hooks and Filters æ¥æ‰©å±•å’Œè‡ªå®šä¹‰ Git Flow çš„è¡Œä¸ºã€‚Hooks å’Œ Filters æ˜¯ Git Flow ä¸­çš„ä¸¤ä¸ªå…³é”®æ¦‚å¿µï¼Œå®ƒä»¬å¯ä»¥åœ¨ Git Flow çš„ä¸åŒé˜¶æ®µæ‰§è¡Œè‡ªå®šä¹‰è„šæœ¬æˆ–å‘½ä»¤ï¼Œä»è€Œå®ç° Git Flow çš„é«˜åº¦å®šåˆ¶åŒ–ã€‚\nHooks æ˜¯ä¸€äº›è„šæœ¬æˆ–å‘½ä»¤ï¼Œå®ƒä»¬ä¼šåœ¨ Git Flow çš„ä¸åŒé˜¶æ®µè¢«è°ƒç”¨ã€‚Git Flow (AVH Edition)æ”¯æŒä»¥ä¸‹ Hooksï¼š\ngit-flow-init: è¯¥ Hook ä¼šåœ¨ git-flow init å‘½ä»¤æ‰§è¡Œæ—¶è¢«è°ƒç”¨ã€‚ git-flow-feature-start: è¯¥ Hook ä¼šåœ¨åˆ›å»ºæ–°çš„ feature åˆ†æ”¯æ—¶è¢«è°ƒç”¨ã€‚ git-flow-feature-finish: è¯¥ Hook ä¼šåœ¨å®Œæˆ feature åˆ†æ”¯æ—¶è¢«è°ƒç”¨ã€‚ git-flow-release-start: è¯¥ Hook ä¼šåœ¨åˆ›å»ºæ–°çš„ release åˆ†æ”¯æ—¶è¢«è°ƒç”¨ã€‚ git-flow-release-finish: è¯¥ Hook ä¼šåœ¨å®Œæˆ release åˆ†æ”¯æ—¶è¢«è°ƒç”¨ã€‚ git-flow-hotfix-start: è¯¥ Hook ä¼šåœ¨åˆ›å»ºæ–°çš„ hotfix åˆ†æ”¯æ—¶è¢«è°ƒç”¨ã€‚ git-flow-hotfix-finish: è¯¥ Hook ä¼šåœ¨å®Œæˆ hotfix åˆ†æ”¯æ—¶è¢«è°ƒç”¨ã€‚ Filters æ˜¯ä¸€äº›å‘½ä»¤æˆ–å‚æ•°ï¼Œå®ƒä»¬ä¼šåœ¨ Git Flow çš„ä¸åŒé˜¶æ®µè¢«è¿‡æ»¤æˆ–ä¿®æ”¹ã€‚Git Flow (AVH Edition)æ”¯æŒä»¥ä¸‹ Filtersï¼š\ngit-flow-feature-start-message: å¯ä»¥ç”¨äºä¿®æ”¹ feature åˆ†æ”¯åˆ›å»ºæ—¶çš„æäº¤ä¿¡æ¯ã€‚ git-flow-feature-finish-message: å¯ä»¥ç”¨äºä¿®æ”¹ feature åˆ†æ”¯å®Œæˆæ—¶çš„æäº¤ä¿¡æ¯ã€‚ git-flow-release-start-message: å¯ä»¥ç”¨äºä¿®æ”¹ release åˆ†æ”¯åˆ›å»ºæ—¶çš„æäº¤ä¿¡æ¯ã€‚ git-flow-release-finish-message: å¯ä»¥ç”¨äºä¿®æ”¹ release åˆ†æ”¯å®Œæˆæ—¶çš„æäº¤ä¿¡æ¯ã€‚ git-flow-hotfix-start-message: å¯ä»¥ç”¨äºä¿®æ”¹ hotfix åˆ†æ”¯åˆ›å»ºæ—¶çš„æäº¤ä¿¡æ¯ã€‚ git-flow-hotfix-finish-message: å¯ä»¥ç”¨äºä¿®æ”¹ hotfix åˆ†æ”¯å®Œæˆæ—¶çš„æäº¤ä¿¡æ¯ã€‚ ä¸‹é¢æ˜¯ä¸€äº›ä½¿ç”¨ Hooks å’Œ Filters çš„ä¾‹å­ï¼š\nä½¿ç”¨ git-flow-init Hook å¦‚æœéœ€è¦åœ¨æ‰§è¡Œ git-flow init å‘½ä»¤æ—¶æ‰§è¡Œä¸€äº›è‡ªå®šä¹‰è„šæœ¬ï¼Œå¯ä»¥ä½¿ç”¨ git-flow-init Hookã€‚å‡è®¾æˆ‘ä»¬æƒ³åœ¨ git-flow init å‘½ä»¤æ‰§è¡Œæ—¶è¾“å‡ºä¸€äº›ä¿¡æ¯ï¼Œå¯ä»¥åœ¨.git/hooks/git-flow-initæ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\n#!/bin/bash echo \u0026#34;Executing git-flow-init Hook\u0026#34; ä½¿ç”¨ git-flow-feature-start Hook å¦‚æœéœ€è¦åœ¨åˆ›å»ºæ–°çš„ feature åˆ†æ”¯æ—¶æ‰§è¡Œä¸€äº›è‡ªå®šä¹‰è„šæœ¬ï¼Œå¯ä»¥ä½¿ç”¨ git-flow-feature-start Hookã€‚å‡è®¾æˆ‘ä»¬æƒ³åœ¨åˆ›å»ºæ–°çš„ feature åˆ†æ”¯æ—¶è‡ªåŠ¨ä¸ºè¯¥åˆ†æ”¯è®¾ç½®ä¸€äº›é»˜è®¤å€¼ï¼Œå¯ä»¥åœ¨.git/hooks/git-flow-feature-startæ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\n#!/bin/bash # Set default values for feature branch git config branch.$GIT_BRANCH_NAME.some_config_value \u0026#34;default_value\u0026#34; ä½¿ç”¨ git-flow-feature-finish-message Filter å¦‚æœéœ€è¦ä¿®æ”¹ feature åˆ†æ”¯å®Œæˆæ—¶çš„æäº¤ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ git-flow-feature-finish-message Filterã€‚å‡è®¾æˆ‘ä»¬æƒ³åœ¨ feature åˆ†æ”¯å®Œæˆæ—¶å¼ºåˆ¶è¦æ±‚å¡«å†™æäº¤ä¿¡æ¯ï¼Œå¯ä»¥åœ¨.git/configæ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\n[gitflow \u0026#34;feature\u0026#34;] finishmessage = Please provide a meaningful commit message for the feature branch ä½¿ç”¨ git-flow-hotfix-start Hook å¦‚æœéœ€è¦åœ¨åˆ›å»ºæ–°çš„ hotfix åˆ†æ”¯æ—¶æ‰§è¡Œä¸€äº›è‡ªå®šä¹‰è„šæœ¬ï¼Œå¯ä»¥ä½¿ç”¨ git-flow-hotfix-start Hookã€‚å‡è®¾æˆ‘ä»¬æƒ³åœ¨åˆ›å»ºæ–°çš„ hotfix åˆ†æ”¯æ—¶è‡ªåŠ¨ä¸ºè¯¥åˆ†æ”¯è®¾ç½®ä¸€äº›é»˜è®¤å€¼ï¼Œå¯ä»¥åœ¨.git/hooks/git-flow-hotfix-startæ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\n#!/bin/bash # Set default values for hotfix branch git config branch.$GIT_BRANCH_NAME.some_config_value \u0026#34;default_value\u0026#34; ä½¿ç”¨ git-flow-hotfix-finish Hook åœ¨.git/hooks/git-flow-hotfix-finishæ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š\n#!/bin/bash # Update version number in package.json VERSION=$(cat package.json | jq -r \u0026#39;.version\u0026#39;) NEW_VERSION=$(echo $VERSION | awk -F. \u0026#39;{$NF++;print}\u0026#39; | sed \u0026#39;s/ /./g\u0026#39;) sed -i \u0026#39;\u0026#39; \u0026#34;s/\\\u0026#34;version\\\u0026#34;: \\\u0026#34;$VERSION\\\u0026#34;/\\\u0026#34;version\\\u0026#34;: \\\u0026#34;$NEW_VERSION\\\u0026#34;/g\u0026#34; package.json è¯¥è„šæœ¬ç”¨äºä¿®æ”¹å‰ç«¯é¡¹ç›®ä¸­çš„ç‰ˆæœ¬å·ã€‚\nGitHub Flow æ¨¡å‹ GitHub Flow æ˜¯ä¸€ç§åŸºäº GitHub çš„åˆ†æ”¯æ¨¡å‹å’Œä»£ç å¼€å‘å·¥ä½œæµç¨‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªç®€å•è€Œçµæ´»çš„æ¨¡å‹ï¼Œåœ¨æ•æ·å¼€å‘å’ŒæŒç»­äº¤ä»˜æ–¹é¢å…·æœ‰å¾ˆé«˜çš„æ•ˆç‡ã€‚ç›¸æ¯”äº Git Flowï¼ŒGitHub Flow æ›´åŠ é€‚åˆå›¢é˜Ÿå’Œå¼€å‘è€…è¿›è¡Œå¿«é€Ÿè¿­ä»£å’Œå¿«é€Ÿä¸Šçº¿ã€‚\nGitHub Flow çš„åˆ†æ”¯æ¨¡å‹éå¸¸ç®€å•ï¼šåªæœ‰ä¸€ä¸ªä¸»åˆ†æ”¯ï¼ˆé€šå¸¸æ˜¯ master åˆ†æ”¯ï¼‰å’Œå¤šä¸ªç‰¹æ€§åˆ†æ”¯ã€‚ä¸»åˆ†æ”¯å§‹ç»ˆå¤„äºç¨³å®šçŠ¶æ€å¹¶ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚æ¯ä¸ªç‰¹æ€§åˆ†æ”¯ç”¨äºå¼€å‘æ–°åŠŸèƒ½æˆ–ä¿®å¤ bugï¼Œå¹¶åœ¨å¼€å‘äººå‘˜å®Œæˆç›¸åº”çš„å¼€å‘å’Œæµ‹è¯•å·¥ä½œååˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¸­ã€‚\nGitHub Flow éµå¾ªä»¥ä¸‹ 6 æ¡åŸåˆ™ï¼š\nmaster åˆ†æ”¯æ°¸è¿œæ˜¯éšæ—¶å¯éƒ¨ç½²å‘å¸ƒçš„ éœ€æ±‚æ–°å¢åŸºäº master åˆ†æ”¯ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªè¯­ä¹‰åŒ–åˆ†æ”¯ å®šæœŸæ¨é€æœ¬åœ°åˆ†æ”¯åˆ°è¿œç«¯ åˆå¹¶åˆ° master éœ€è¦æ PR PR ä¸€æ—¦ç»è¿‡ code review æ— è¯¯åå³å¯åˆå¹¶åˆ° master master ä¸€æ—¦æ¥æ”¶åˆ°åˆå¹¶è¯·æ±‚ï¼Œå³å¯ç«‹å³éƒ¨ç½²å‘å¸ƒ GitHub Flow çš„ä»£ç å¼€å‘å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š\nåˆ›å»ºç‰¹æ€§åˆ†æ”¯ï¼šä»ä¸»åˆ†æ”¯ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ç‰¹æ€§åˆ†æ”¯ï¼Œç”¨äºå¼€å‘æ–°åŠŸèƒ½æˆ–ä¿®å¤ bugã€‚ å¼€å‘å’Œæµ‹è¯•ï¼šåœ¨ç‰¹æ€§åˆ†æ”¯ä¸Šè¿›è¡Œå¼€å‘å’Œæµ‹è¯•ï¼Œç¡®ä¿ä»£ç ç¬¦åˆè´¨é‡æ ‡å‡†ï¼Œå¹¶é€šè¿‡è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚ å‘èµ·åˆå¹¶è¯·æ±‚ï¼šå°†ç‰¹æ€§åˆ†æ”¯åˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¸­ï¼Œå‘èµ·ä¸€ä¸ªåˆå¹¶è¯·æ±‚ï¼ˆpull requestï¼‰ï¼Œå¹¶é‚€è¯·å…¶ä»–å¼€å‘è€…è¿›è¡Œä»£ç å®¡æŸ¥å’Œè®¨è®ºã€‚ ä»£ç å®¡æŸ¥ï¼šå…¶ä»–å¼€å‘è€…å¯¹ä»£ç è¿›è¡Œå®¡æŸ¥å’Œè®¨è®ºï¼Œæå‡ºæ„è§å’Œå»ºè®®ï¼Œå¹¶ç¡®ä¿ä»£ç ç¬¦åˆè´¨é‡æ ‡å‡†å’Œæœ€ä½³å®è·µã€‚ åˆå¹¶ä»£ç ï¼šåœ¨ç»è¿‡å®¡æŸ¥å’Œè®¨è®ºåï¼Œå°†ç‰¹æ€§åˆ†æ”¯åˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¸­ï¼Œå¹¶å°†ä»£ç éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚ éƒ¨ç½²ä»£ç ï¼šåœ¨åˆå¹¶åˆ°ä¸»åˆ†æ”¯åï¼Œä½¿ç”¨è‡ªåŠ¨åŒ–éƒ¨ç½²å·¥å…·å°†ä»£ç éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚ Gitlab flow æ¨¡å‹ GitLab Flow æ˜¯ä¸€ä¸ªåŸºäº GitLab çš„åˆ†æ”¯æ¨¡å‹å’Œå¼€å‘å·¥ä½œæµç¨‹ï¼Œæ—¨åœ¨æ”¯æŒæ•æ·å¼€å‘å’ŒæŒç»­äº¤ä»˜ã€‚\nGitLab åœ¨ 2014 å¹´æå‡º 11 æ¡æœ€ä½³å®è·µï¼Œæ›´å¤šè¯·ç‚¹å‡»è¿™é‡Œï¼Œå…¶ç›¸å¯¹ GitHub å¢åŠ äº†ç¯å¢ƒåˆ†æ”¯ï¼Œä¸”ä»£ç å¿…é¡»ç”±ä¸Šæ¸¸ï¼ˆmasterï¼‰å‘ä¸‹æ¸¸ï¼ˆstagingï¼‰å‘å±•ï¼Œå¹¶ä¸”é’ˆå¯¹æŒç»­å‘å¸ƒå’Œç‰ˆæœ¬å‘å¸ƒéƒ½æå‡ºäº†ç›¸åº”çš„å‡†åˆ™ï¼Œä¸‹é¢æ˜¯å…¶å¤§è‡´æµç¨‹å›¾ï¼š\nGitLab Flow çš„ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š\nç®€å•çš„åˆ†æ”¯æ¨¡å‹ï¼šGitLab Flow ä½¿ç”¨ä¸€ä¸ªç®€å•çš„åˆ†æ”¯æ¨¡å‹ï¼ŒåŒ…æ‹¬ä¸€ä¸ªä¸»åˆ†æ”¯ï¼ˆé€šå¸¸å‘½åä¸ºâ€œmasterâ€æˆ–â€œproductionâ€ï¼‰å’Œä¸€ä¸ªå¼€å‘åˆ†æ”¯ï¼ˆé€šå¸¸å‘½åä¸ºâ€œdevelopâ€æˆ–â€œstagingâ€ï¼‰ã€‚ç‰¹æ€§åˆ†æ”¯ä»å¼€å‘åˆ†æ”¯åˆ›å»ºï¼Œå¹¶åœ¨ç‰¹æ€§æˆ–é”™è¯¯ä¿®å¤å®Œæˆå¹¶é€šè¿‡æµ‹è¯•ååˆå¹¶å›å¼€å‘åˆ†æ”¯ä¸­ã€‚ æŒç»­é›†æˆå’Œäº¤ä»˜ï¼šGitLab Flow å¼ºè°ƒæŒç»­é›†æˆå’Œäº¤ä»˜ï¼ˆCI/CDï¼‰ï¼Œè¿™æ„å‘³ç€æ¯æ¬¡å¯¹ä»£ç çš„æ›´æ”¹éƒ½ä¼šè‡ªåŠ¨æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒæˆ–ç”Ÿäº§ç¯å¢ƒï¼ˆå¦‚æœæµ‹è¯•é€šè¿‡ï¼‰ã€‚ ä»£ç å®¡æŸ¥ï¼šGitLab Flow é¼“åŠ±è¿›è¡Œä»£ç å®¡æŸ¥ï¼Œè¿™æ„å‘³ç€æ¯æ¬¡å¯¹ä»£ç çš„æ›´æ”¹éƒ½ä¼šç”±è‡³å°‘ä¸€ä¸ªå…¶ä»–å¼€å‘äººå‘˜è¿›è¡Œå®¡æŸ¥ï¼Œä»¥ç¡®ä¿å…¶ç¬¦åˆè´¨é‡æ ‡å‡†å¹¶ä¸ä¼šå¼•å…¥ä»»ä½•å®‰å…¨æ¼æ´ã€‚ åˆå¹¶è¯·æ±‚ï¼šGitLab Flow ä½¿ç”¨åˆå¹¶è¯·æ±‚æ¥ç®¡ç†å°†ä»£ç æ›´æ”¹åˆå¹¶åˆ°ä¸»åˆ†æ”¯çš„è¿‡ç¨‹ã€‚åˆå¹¶è¯·æ±‚å…è®¸å¼€å‘äººå‘˜åœ¨å°†æ›´æ”¹åˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¹‹å‰å¯¹å…¶è¿›è¡Œå®¡æŸ¥å’Œè®¨è®ºã€‚ ç¯å¢ƒç®¡ç†ï¼šGitLab Flow æä¾›é«˜çº§çš„ç¯å¢ƒç®¡ç†åŠŸèƒ½ï¼Œå…è®¸å›¢é˜Ÿåˆ›å»ºå’Œç®¡ç†ä¸åŒçš„å¼€å‘ã€æµ‹è¯•ã€æš‚å­˜å’Œç”Ÿäº§ç¯å¢ƒã€‚ GitLab Flow æä¾›äº†é«˜çº§çš„ç¯å¢ƒç®¡ç†åŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©å›¢é˜Ÿæ›´å¥½åœ°ç®¡ç†ä¸åŒçš„å¼€å‘ã€æµ‹è¯•ã€æš‚å­˜å’Œç”Ÿäº§ç¯å¢ƒã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨ GitLab Flow è¿›è¡Œç¯å¢ƒç®¡ç†çš„ä¸€äº›æ–¹æ³•ï¼š\nåˆ›å»ºä¸åŒçš„ç¯å¢ƒåˆ†æ”¯ï¼šåœ¨ GitLab Flow ä¸­ï¼Œå¯ä»¥ä¸ºä¸åŒçš„ç¯å¢ƒåˆ›å»ºåˆ†æ”¯ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸ºâ€œdevelopâ€çš„å¼€å‘åˆ†æ”¯ï¼Œä¸€ä¸ªåä¸ºâ€œstagingâ€çš„æš‚å­˜åˆ†æ”¯ï¼Œå’Œä¸€ä¸ªåä¸ºâ€œproductionâ€çš„ç”Ÿäº§åˆ†æ”¯ã€‚è¿™äº›åˆ†æ”¯å¯ä»¥å¸®åŠ©å›¢é˜Ÿæ›´å¥½åœ°ç®¡ç†ä¸åŒç¯å¢ƒçš„ä»£ç ï¼Œç¡®ä¿æ¯ä¸ªç¯å¢ƒéƒ½æœ‰è‡ªå·±çš„ä»£ç ç‰ˆæœ¬ã€‚ é…ç½®ç¯å¢ƒå˜é‡ï¼šåœ¨ GitLab ä¸­ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªç¯å¢ƒè®¾ç½®ä¸åŒçš„ç¯å¢ƒå˜é‡ã€‚è¿™äº›ç¯å¢ƒå˜é‡å¯ä»¥ç”¨äºé…ç½®ä¸åŒç¯å¢ƒä¸­çš„åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ï¼Œä¾‹å¦‚æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ã€API å¯†é’¥ç­‰ã€‚é€šè¿‡è®¾ç½®æ­£ç¡®çš„ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥ç¡®ä¿åº”ç”¨ç¨‹åºåœ¨ä¸åŒç¯å¢ƒä¸­æ­£ç¡®è¿è¡Œã€‚ è‡ªåŠ¨åŒ–éƒ¨ç½²å’Œæµ‹è¯•ï¼šGitLab Flow æ”¯æŒè‡ªåŠ¨åŒ–éƒ¨ç½²å’Œæµ‹è¯•ï¼Œå¯ä»¥å¸®åŠ©å›¢é˜Ÿæ›´å¿«åœ°éƒ¨ç½²ä»£ç åˆ°ä¸åŒç¯å¢ƒä¸­ã€‚å¯ä»¥ä½¿ç”¨ GitLab çš„ CI/CD ç®¡é“æ¥è‡ªåŠ¨åŒ–æµ‹è¯•å’Œéƒ¨ç½²è¿‡ç¨‹ï¼Œå¹¶å°†ä»£ç æ¨é€åˆ°æ­£ç¡®çš„ç¯å¢ƒåˆ†æ”¯ä¸­ã€‚ ç¯å¢ƒç›‘æ§å’ŒæŠ¥å‘Šï¼šGitLab Flow è¿˜æ”¯æŒç¯å¢ƒç›‘æ§å’ŒæŠ¥å‘ŠåŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©å›¢é˜Ÿæ›´å¥½åœ°äº†è§£ä¸åŒç¯å¢ƒçš„è¿è¡ŒçŠ¶å†µå’Œæ€§èƒ½ã€‚å¯ä»¥ä½¿ç”¨ GitLab çš„ç›‘æ§å’ŒæŠ¥å‘Šå·¥å…·æ¥ç›‘è§†ä¸åŒç¯å¢ƒçš„æ€§èƒ½æŒ‡æ ‡ã€é”™è¯¯ç‡ç­‰ï¼Œå¹¶åŠæ—¶å‘ç°å’Œè§£å†³é—®é¢˜ã€‚ GitLab Flow çš„åˆ†æ”¯æ¨¡å‹å¦‚ä¸‹ï¼š\nä¸»åˆ†æ”¯ï¼šä¸»åˆ†æ”¯å§‹ç»ˆå¤„äºç¨³å®šçŠ¶æ€ï¼Œå¹¶ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚åœ¨ GitLab Flow ä¸­ï¼Œä¸»åˆ†æ”¯é€šå¸¸æ˜¯ master åˆ†æ”¯æˆ– production åˆ†æ”¯ã€‚ ç‰¹æ€§åˆ†æ”¯ï¼šç‰¹æ€§åˆ†æ”¯ç”¨äºå¼€å‘æ–°åŠŸèƒ½æˆ–ä¿®å¤ bugï¼Œå¹¶ä»ä¸»åˆ†æ”¯ä¸­åˆ›å»ºã€‚åœ¨ GitLab Flow ä¸­ï¼Œç‰¹æ€§åˆ†æ”¯é€šå¸¸ä»¥ feature/æˆ– fix/ä¸ºå‰ç¼€ã€‚ é›†æˆåˆ†æ”¯ï¼šé›†æˆåˆ†æ”¯ç”¨äºå°†ç‰¹æ€§åˆ†æ”¯é›†æˆåˆ°ä¸»åˆ†æ”¯ä¸­ï¼Œå¹¶è¿›è¡Œæµ‹è¯•å’Œéƒ¨ç½²ã€‚åœ¨ GitLab Flow ä¸­ï¼Œé›†æˆåˆ†æ”¯é€šå¸¸æ˜¯ develop åˆ†æ”¯æˆ– staging åˆ†æ”¯ã€‚ å‘å¸ƒåˆ†æ”¯ï¼šå‘å¸ƒåˆ†æ”¯ç”¨äºå°†ç‰¹æ€§åˆ†æ”¯å’Œé›†æˆåˆ†æ”¯çš„ä»£ç å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒä¸­ã€‚åœ¨ GitLab Flow ä¸­ï¼Œå‘å¸ƒåˆ†æ”¯é€šå¸¸æ˜¯ release/ä¸ºå‰ç¼€çš„åˆ†æ”¯ã€‚ GitLab Flow çš„å¼€å‘å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š\nåˆ›å»ºç‰¹æ€§åˆ†æ”¯ï¼šä»ä¸»åˆ†æ”¯ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ç‰¹æ€§åˆ†æ”¯ï¼Œç”¨äºå¼€å‘æ–°åŠŸèƒ½æˆ–ä¿®å¤ bugã€‚ å¼€å‘å’Œæµ‹è¯•ï¼šåœ¨ç‰¹æ€§åˆ†æ”¯ä¸Šè¿›è¡Œå¼€å‘å’Œæµ‹è¯•ï¼Œç¡®ä¿ä»£ç ç¬¦åˆè´¨é‡æ ‡å‡†ï¼Œå¹¶é€šè¿‡è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚ åˆå¹¶åˆ°é›†æˆåˆ†æ”¯ï¼šå°†ç‰¹æ€§åˆ†æ”¯åˆå¹¶åˆ°é›†æˆåˆ†æ”¯ä¸­ï¼Œå¹¶è¿›è¡Œé›†æˆæµ‹è¯•å’Œè‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚ å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒï¼šå°†é›†æˆåˆ†æ”¯çš„ä»£ç å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¹¶è¿›è¡Œæœ€ç»ˆæµ‹è¯•å’Œéƒ¨ç½²ã€‚ åˆå¹¶åˆ°ä¸»åˆ†æ”¯ï¼šåœ¨å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒåï¼Œå°†é›†æˆåˆ†æ”¯åˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¸­ï¼Œå¹¶å°†ä»£ç éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚ GitLab Flow å¼ºè°ƒ CI/CD é›†æˆå’Œæµ‹è¯•è‡ªåŠ¨åŒ–ï¼Œä»¥ç¡®ä¿ä»£ç è´¨é‡å’Œå¿«é€Ÿè¿­ä»£ã€‚å®ƒè¿˜æ”¯æŒè‡ªåŠ¨åŒ–éƒ¨ç½²å’Œç¯å¢ƒç®¡ç†ï¼Œä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´è½»æ¾åœ°ç®¡ç†ä¸åŒç¯å¢ƒå’Œéƒ¨ç½²ä»£ç ã€‚GitLab Flow æ˜¯ä¸€ä¸ªçµæ´»å’Œå¼ºå¤§çš„å¼€å‘å·¥ä½œæµç¨‹ï¼Œé€‚ç”¨äºå„ç§ç±»å‹çš„é¡¹ç›®å’Œå›¢é˜Ÿã€‚\nGitLab Flowã€Git Flow å’Œ GitHub Flow GitLab Flowã€Git Flow å’Œ GitHub Flow éƒ½æ˜¯ä¸‰ç§å¸¸è§çš„åŸºäº Git çš„å·¥ä½œæµç¨‹ã€‚ä¸‹é¢æ˜¯ GitLab Flow ä¸å…¶ä»–å·¥ä½œæµç¨‹çš„ä¸»è¦åŒºåˆ«ï¼š\nGitLab Flow ä¸ Git Flow çš„æ¯”è¾ƒï¼š GitLab Flow æ¯” Git Flow æ›´ç®€å•å’Œæ›´çµæ´»ã€‚Git Flow æœ‰ä¸€ä¸ªæ›´å¤æ‚çš„åˆ†æ”¯æ¨¡å‹ï¼ŒåŒ…å«å¤šä¸ªé•¿æœŸå­˜åœ¨çš„åˆ†æ”¯ï¼Œè€Œ GitLab Flow åªä½¿ç”¨å‡ ä¸ªä¸»è¦åˆ†æ”¯å’Œç‰¹æ€§åˆ†æ”¯ã€‚\nGitLab Flow å¼ºè°ƒæŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²ï¼ˆCI/CDï¼‰ï¼Œé¼“åŠ±é¢‘ç¹åˆå¹¶åˆ°ä¸»è¦åˆ†æ”¯ã€‚Git Flow æ›´æ³¨é‡ç‰ˆæœ¬æ§åˆ¶å’Œå‘å¸ƒç®¡ç†ã€‚\nGitLab Flow ä¸ GitLab å†…ç½®çš„ CI/CD ç®¡é“æ›´ç´§å¯†åœ°é›†æˆåœ¨ä¸€èµ·ï¼Œæ›´å®¹æ˜“è‡ªåŠ¨åŒ–å¼€å‘å·¥ä½œæµç¨‹ã€‚\nGitLab Flow ä¸ GitHub Flow çš„æ¯”è¾ƒï¼š GitLab Flow å’Œ GitHub Flow æœ‰è®¸å¤šç›¸ä¼¼ä¹‹å¤„ï¼Œä¾‹å¦‚å®ƒä»¬éƒ½ä»¥ GitHub æˆ– GitLab ä½œä¸ºä¸­å¤®ä»“åº“ï¼Œä½¿ç”¨ç‰¹æ€§åˆ†æ”¯è¿›è¡Œå¼€å‘ã€‚ GitLab Flow å¼ºè°ƒ CI/CD é›†æˆå’Œæµ‹è¯•è‡ªåŠ¨åŒ–ï¼Œè€Œ GitHub Flow æ›´æ³¨é‡ä»£ç å®¡æŸ¥å’Œåä½œã€‚ GitLab Flow è¿˜æä¾›æ›´é«˜çº§çš„ç¯å¢ƒç®¡ç†ã€éƒ¨ç½²å’Œç›‘æ§åŠŸèƒ½ï¼Œæ›´é€‚åˆäºå¤§å‹ã€å¤æ‚çš„é¡¹ç›®ã€‚ æ€»ä½“è€Œè¨€ï¼ŒGitLab Flow æ¯” Git Flow æ›´ç®€å•å’Œæ›´çµæ´»ï¼Œå¼ºè°ƒ CI/CD é›†æˆå’Œè‡ªåŠ¨åŒ–ã€‚ä¸ GitHub Flow ç›¸æ¯”ï¼ŒGitLab Flow æä¾›æ›´é«˜çº§çš„ç¯å¢ƒç®¡ç†å’Œéƒ¨ç½²åŠŸèƒ½ï¼Œæ›´é€‚åˆäºå¤§å‹ã€å¤æ‚çš„é¡¹ç›®ã€‚é€‰æ‹©å“ªç§å·¥ä½œæµç¨‹æœ€ç»ˆå–å†³äºé¡¹ç›®å’Œå¼€å‘å›¢é˜Ÿçš„å…·ä½“éœ€æ±‚å’Œè¦æ±‚ã€‚\nå…¶ä»– flow TrunkBased OneFlow AoneFlow æ€»ç»“ ç›®å‰å…¬å¸ä»£ç éƒ¨ç½²åœ¨è‡ªå»ºçš„ gitlab ä¸Šé¢ï¼Œå¯¹äºå…¬å¸çš„é¡¹ç›®ï¼Œä¸ªäººå€¾å‘äºä½¿ç”¨ git-flow åˆ†æ”¯æ¨¡å‹ï¼Œå¹¶ä¸”ä½¿ç”¨ git-flow (AVH Edition) æ¥ç®€åŒ–æ“ä½œã€‚\nç›®å‰ï¼Œæˆ‘å‚ä¸çš„å¤§å¤šæ•°é¡¹ç›®éƒ½æ˜¯ java é¡¹ç›®å¹¶ä¸”ä½¿ç”¨ maven è¿›è¡Œæ„å»ºã€‚\nåœ¨ Maven é¡¹ç›®ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Maven ç‰ˆæœ¬æ§åˆ¶å™¨æ¥åŒºåˆ† release ç‰ˆæœ¬å’Œ snapshot ç‰ˆæœ¬ã€‚\nRelease ç‰ˆæœ¬\nå¯¹äº Git Flow ä¸­çš„ release åˆ†æ”¯ï¼Œé€šå¸¸ç”¨äºä¸ºç”Ÿäº§ç¯å¢ƒå‡†å¤‡ä»£ç ã€‚\nåœ¨ Maven é¡¹ç›®ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Maven Release æ’ä»¶æ¥è‡ªåŠ¨åŒ–åˆ›å»ºå’Œå‘å¸ƒ release ç‰ˆæœ¬ã€‚\nmvn release:prepare mvn release:perform ä½¿ç”¨è¿™äº›å‘½ä»¤ï¼ŒMaven Release æ’ä»¶ä¼šè‡ªåŠ¨æ›´æ–°é¡¹ç›®ç‰ˆæœ¬å·ã€åˆ›å»º tagã€æ„å»º release ç‰ˆæœ¬ï¼Œå¹¶å‘å¸ƒåˆ° Maven ä»“åº“ä¸­ã€‚å‘å¸ƒçš„ç‰ˆæœ¬å·ä¸åŒ…å« -SNAPSHOT åç¼€ã€‚\næˆ–è€…ï¼Œä½¿ç”¨ mvn versionsï¼š\nmvn versions:set -DnewVersion=1.0.0-SNAPSHOT mvn versions:commit Snapshot ç‰ˆæœ¬\nå¯¹äº Git Flow ä¸­çš„ feature å’Œ develop åˆ†æ”¯ï¼Œé€šå¸¸ç”¨äºå¼€å‘å’Œæµ‹è¯•æ–°åŠŸèƒ½æˆ– bug ä¿®å¤ï¼Œè¿™äº›åˆ†æ”¯ä½¿ç”¨ snapshot ç‰ˆæœ¬ã€‚åœ¨ Maven ä¸­ï¼Œsnapshot ç‰ˆæœ¬çš„ç‰ˆæœ¬å·åŒ…å« -SNAPSHOT åç¼€ï¼Œè¡¨ç¤ºå½“å‰ç‰ˆæœ¬æ˜¯æ­£åœ¨å¼€å‘çš„ç‰ˆæœ¬ã€‚\nå¯¹äºè¿™äº›é¡¹ç›®ï¼Œgit-flow æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š\n1ã€åˆå§‹åŒ–\ngit flow init -d 2ã€å¼€å§‹ feature åˆ†æ”¯\ngit flow feature start test è®¾ç½® maven é¡¹ç›®ä¸­ç‰ˆæœ¬ä¸º snapshot ç‰ˆæœ¬ã€‚\nmvn versions:set -DnewVersion=1.0.0-SNAPSHOT mvn versions:commit å¯¹äº maven å¤šæ¨¡å—é¡¹ç›®ï¼Œå¦‚æœä½¿ç”¨ revision æ¥ç»Ÿä¸€å®šä¹‰ç‰ˆæœ¬å·ï¼Œåˆ™ä½¿ç”¨ä¸‹é¢å‘½ä»¤ï¼š\nmvn versions:set-property -Dproperty=revision -DnewVersion=1.0.0-SNAPSHOT mvn versions:commit 3ã€æœ¬åœ°åœ¨ feature åˆ†æ”¯ä¸Šå®Œæˆä¸€äº›å¼€å‘ä¹‹åï¼Œå®Œæˆ feature åˆ†æ”¯\ngit flow feature finish test 4ã€å¼€å§‹ release åˆ†æ”¯\ngit flow release start 1.0.0 5ã€æœ¬åœ°åœ¨ release åˆ†æ”¯ä¸Šå®Œæˆä¸€äº›å¼€å‘ä¹‹åï¼Œå®Œæˆ feature åˆ†æ”¯\nè®¾ç½® maven é¡¹ç›®ä¸­ç‰ˆæœ¬ä¸º release ç‰ˆæœ¬ã€‚\nmvn versions:set -DnewVersion=1.0.0 mvn versions:commit å¯¹äº maven å¤šæ¨¡å—é¡¹ç›®ï¼Œå¦‚æœä½¿ç”¨ revision æ¥ç»Ÿä¸€å®šä¹‰ç‰ˆæœ¬å·ï¼Œåˆ™ä½¿ç”¨ä¸‹é¢å‘½ä»¤ï¼š\nmvn versions:set-property -Dproperty=revision -DnewVersion=1.0.0 mvn versions:commit å¦å¤–ï¼Œå¯¹äºå¤šæ¨¡å—é¡¹ç›®ï¼Œéœ€è¦åœ¨æ¯ä¸ªæ¨¡å—æ‰§è¡Œä¸‹é¢å‘½ä»¤å°† jar æ¨é€åˆ° maven ä¸­å¤®ä»“åº“ï¼š\nmvn deploy -DskipTests ç„¶åå®Œæˆåˆ†æ”¯ï¼š\ngit flow release finish 1.0.0 6ã€æ¨é€ä¸»åˆ†æ”¯å’Œå¼€å‘åˆ†æ”¯\ngit push origin develop git checkout main git push origin main ä»¥ä¸Šã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/05/11/git-flow-model-and-usage/","summary":"ä»‹ç» Git Flow æ˜¯ç”± Vincent Driessen åœ¨ 2010 å¹´æå‡ºçš„ä¸€ç§ Git å·¥ä½œæµã€‚åœ¨è¿™ä¹‹å‰ï¼ŒGit æ²¡æœ‰ä¸€ä¸ªæ˜ç¡®çš„æ ‡å‡†å·¥ä½œæµï¼Œå¯¼è‡´å›¢é˜Ÿåœ¨ä½¿ç”¨ Git æ—¶å¾€å¾€ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ï¼Œå¦‚åˆ†æ”¯ç®¡ç†ã€ç‰ˆæœ¬æ§åˆ¶ç­‰ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼ŒVincent Driessen æå‡ºäº† Git Flow åˆ†æ”¯æ¨¡å‹ï¼Œæˆä¸ºäº† Git åœ¨å®é™…åº”ç”¨ä¸­çš„ä¸€ç§æ ‡å‡†å·¥ä½œæµã€‚\néšç€æ—¶é—´çš„æ¨ç§»ï¼ŒGit Flow ä¹Ÿåœ¨ä¸æ–­å‘å±•å’Œå®Œå–„ã€‚åœ¨ 2011 å¹´ï¼ŒAtlassian å‘å¸ƒäº† SourceTreeï¼Œè¿™æ˜¯ä¸€æ¬¾å›¾å½¢åŒ–çš„ Git å®¢æˆ·ç«¯ï¼Œæ”¯æŒ Git Flow åˆ†æ”¯æ¨¡å‹ã€‚åœ¨ 2013 å¹´ï¼ŒGit Flow çš„ä¸€äº›å¼€å‘è€…å‘å¸ƒäº† Git Flow AVH Editionï¼Œè¿™æ˜¯ Git Flow çš„ä¸€ä¸ªå¢å¼ºç‰ˆæœ¬ï¼Œæä¾›äº†æ›´å¤šçš„åŠŸèƒ½å’Œé€‰é¡¹ã€‚æ­¤å¤–ï¼ŒGit Flow è¿˜å¾—åˆ°äº†å…¶ä»–å¼€æºå·¥å…·å’Œå¹³å°çš„æ”¯æŒï¼Œå¦‚ GitHubã€GitLab ç­‰ã€‚\nGit Flow åˆ†æ”¯æ¨¡å‹ Git Flow åˆ†æ”¯æ¨¡å‹å®šä¹‰äº†ä¸€ç§æ ‡å‡†çš„ Git åˆ†æ”¯æ¨¡å‹ï¼Œå®ƒå°†ä»£ç åˆ†ä¸ºä¸¤ä¸ªé•¿æœŸåˆ†æ”¯ï¼ˆmaster å’Œ developï¼‰å’Œä¸‰ä¸ªçŸ­æœŸåˆ†æ”¯ï¼ˆfeatureã€release å’Œ hotfixï¼‰ï¼Œä½¿å¾—å›¢é˜Ÿå¯ä»¥æ›´å¥½åœ°ç®¡ç†ä»£ç çš„ç‰ˆæœ¬å’Œå‘å¸ƒã€‚\nä»¥ä¸‹æ˜¯ Git Flow åˆ†æ”¯æ¨¡å‹çš„è¯¦ç»†ä»‹ç»ï¼š\nmaster åˆ†æ”¯ master åˆ†æ”¯æ˜¯ä»£ç åº“çš„ä¸»åˆ†æ”¯ï¼Œå®ƒåŒ…å«äº†æ‰€æœ‰å·²å‘å¸ƒçš„ä»£ç å’Œç‰ˆæœ¬ã€‚æ‰€æœ‰ä»£ç éƒ½åº”è¯¥åœ¨è¯¥åˆ†æ”¯ä¸Šè¿›è¡Œæµ‹è¯•å’ŒéªŒè¯ï¼Œä»¥ç¡®ä¿ä»£ç çš„è´¨é‡å’Œç¨³å®šæ€§ã€‚masteråˆ†æ”¯åªèƒ½é€šè¿‡åˆå¹¶releaseæˆ–hotfixåˆ†æ”¯æ¥æ›´æ–°ã€‚ develop åˆ†æ”¯ develop åˆ†æ”¯æ˜¯ä»£ç åº“çš„å¼€å‘åˆ†æ”¯ï¼Œå®ƒåŒ…å«äº†æ‰€æœ‰å¼€å‘ä¸­çš„ä»£ç å’ŒåŠŸèƒ½ã€‚æ‰€æœ‰æ–°çš„ä»£ç éƒ½åº”è¯¥åœ¨è¯¥åˆ†æ”¯ä¸Šè¿›è¡Œå¼€å‘å’Œæµ‹è¯•ï¼Œä»¥ç¡®ä¿ä»£ç çš„å¯é æ€§å’Œç¨³å®šæ€§ã€‚developåˆ†æ”¯åªèƒ½é€šè¿‡åˆå¹¶featureåˆ†æ”¯æ¥æ›´æ–°ã€‚ feature åˆ†æ”¯ feature åˆ†æ”¯æ˜¯ä¸ºå¼€å‘æ–°çš„åŠŸèƒ½æˆ–ä¿®å¤ bug è€Œåˆ›å»ºçš„ä¸´æ—¶åˆ†æ”¯ã€‚æ¯ä¸ªfeatureåˆ†æ”¯éƒ½æ˜¯ä»developåˆ†æ”¯åˆ†ç¦»å‡ºæ¥çš„ï¼Œå¼€å‘å®Œæˆåä¼šåˆå¹¶å›developåˆ†æ”¯ã€‚feature åˆ†æ”¯çš„å‘½ååº”è¯¥æ¸…æ™°æ˜ç¡®ï¼Œä»¥åæ˜ è¯¥åˆ†æ”¯æ‰€æ¶‰åŠçš„åŠŸèƒ½æˆ–é—®é¢˜ã€‚ release åˆ†æ”¯ release åˆ†æ”¯æ˜¯ä¸ºå‘å¸ƒæ–°ç‰ˆæœ¬è€Œåˆ›å»ºçš„ä¸´æ—¶åˆ†æ”¯ã€‚æ¯ä¸ªreleaseåˆ†æ”¯éƒ½æ˜¯ä»developåˆ†æ”¯åˆ†ç¦»å‡ºæ¥çš„ï¼Œå‘å¸ƒå®Œæˆåä¼šåˆå¹¶å›developåˆ†æ”¯å’Œmasteråˆ†æ”¯ã€‚åœ¨ release åˆ†æ”¯ä¸Šå¯ä»¥è¿›è¡Œä¸€äº›å°çš„ä¿®å¤å’Œè°ƒæ•´ï¼Œä»¥ç¡®ä¿å‘å¸ƒçš„ä»£ç çš„è´¨é‡å’Œç¨³å®šæ€§ã€‚ hotfix åˆ†æ”¯ hotfix åˆ†æ”¯æ˜¯ä¸ºå¿«é€Ÿä¿®å¤ç”Ÿäº§ç¯å¢ƒä¸­çš„é—®é¢˜è€Œåˆ›å»ºçš„ä¸´æ—¶åˆ†æ”¯ã€‚æ¯ä¸ª hotfix åˆ†æ”¯éƒ½æ˜¯ä» master åˆ†æ”¯åˆ†ç¦»å‡ºæ¥çš„ï¼Œä¿®å¤å®Œæˆåä¼šåˆå¹¶å› develop åˆ†æ”¯å’Œ master åˆ†æ”¯ã€‚hotfixåˆ†æ”¯çš„ä¼˜å…ˆçº§æ¯”å…¶ä»–åˆ†æ”¯æ›´é«˜ï¼Œå› ä¸ºå®ƒä»¬éœ€è¦å°½å¿«ä¿®å¤ç”Ÿäº§ç¯å¢ƒä¸­çš„é—®é¢˜ã€‚ æ ¹æ®ä¸Šé¢çš„ç†è®ºï¼Œæˆ‘ä»¬æ¥å®é™…æ“ä½œä¸€éã€‚é¦–å…ˆï¼Œæ˜¯ develop åˆ†æ”¯åˆ›å»ºä¸€ä¸ª feature åˆ†æ”¯ã€‚","title":"Git Flowåˆ†æ”¯æ¨¡å‹å’Œä½¿ç”¨"},{"content":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-05-01 åˆ° 2023-05-07 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nç»§ä¸Šå‘¨å®ç°å¯¼å‡ºè‹¹æœæ¥å£æ•°æ®ä¹‹åï¼Œè¿™å‘¨åˆå®ç°äº†è‡ªåŠ¨å¯¼å‡ºè±†ç“£æ•°æ®ã€‚æ­¤å¤–ï¼Œè¿˜èŒç”Ÿäº†å¯¼å‡ºæ¯å¤©é˜…è¯»çš„æ•°æ®çš„æƒ³æ³•ã€‚å¥ˆä½•ç°åœ¨é˜…è¯» app éƒ½éœ€è¦æ”¶è´¹ï¼Œåªèƒ½æš‚ä¸”æç½®è¿™ä¸ªæƒ³æ³•ã€‚\næœ€è¿‘åœ¨å­¦ä¹  Pythonï¼Œäºæ˜¯å°†å­¦ä¹ ä¸­åšçš„ç¬”è®°å‘å¸ƒåˆ°äº†åšå®¢ï¼Œè¿™å‘¨å‘å¸ƒäº†ä¸¤ç¯‡æ–‡ç« ï¼Œå¸Œæœ›é€šè¿‡è¾“å‡ºæ¥å€’é€¼è¾“å…¥ï¼Œä»¥æ­¤æ¥å¿«é€ŸæŒæ¡ python ç¼–ç¨‹å¹¶èƒ½å¼€å‘ä¸€äº›é¡¹ç›®ã€‚å¦å¤–ï¼Œè®¡åˆ’åœ¨å­¦å®Œä¹‹åï¼Œç»§ç»­å­¦ä¹  Rust å’Œ Goï¼Œç”šè‡³å¼€å§‹å­¦ä¹ å‰ç«¯å¼€å‘ã€‚\næœ€è¿‘åˆä¸€æ¬¡æ›´æ¢äº†åšå®¢ä¸»é¢˜ï¼Œä¸»è¦å‡ºå‘ç‚¹æ˜¯æƒ³æ‰¾ä¸€ä¸ªç®€æ´çš„ä¸»é¢˜ï¼Œå‡å°‘ä¸å¿…è¦çš„ä¿¡æ¯å¹²æ‰°ï¼Œä¹Ÿä¸æƒ³èŠ±æ—¶é—´åœ¨ä¿®æ”¹ä¸»é¢˜ä¸Šé¢ã€‚å‡å°‘äº†èœå•é“¾æ¥ã€‚\nå¯¼å‡ºè±†ç“£æ•°æ® æœ€è¿‘é˜…è¯»äº†ä¸€ç¯‡æ–‡ç«  å¾ˆè®¤çœŸçš„åœ¨è€ƒè™‘ä¸å†ä½¿ç”¨è±†ç“£è¿™ä»¶äº‹ ï¼Œäºæ˜¯ä½¿ç”¨ lizheming/doumark-action å¯¼å‡ºè±†ç“£æ•°æ®ã€‚\nåœ¨æˆ‘çš„ github ä¸»é¡µ https://github.com/chensoul/chensoul åˆ›å»ºä¸€ä¸ª workflow douban.yml ï¼Œæ¯éš”ä¸€ä¸ªå°æ—¶åŒæ­¥ä¸€æ¬¡è±†ç“£æ•°æ®ï¼ˆè¯»ä¹¦ã€ç”µå½±ã€éŸ³ä¹ï¼‰åˆ° csv æ–‡ä»¶ã€‚æ‹¿åˆ°è¿™äº›æ–‡ä»¶ä¹‹åï¼Œå°±å¯ä»¥é€šè¿‡ html + css æ¸²æŸ“å‡ºæ¥ï¼Œç±»ä¼¼è¿™ä¸ªé¡µé¢ ä¹¦å½±éŸ³ã€‚ç­‰è±†ç“£æ•°æ®å¢å¤šä¹‹åï¼Œå†è€ƒè™‘å®ç°è¿™ä¸ªã€‚\né™¤æ­¤ä¹‹å¤–ï¼Œä¹‹å‰è¿˜å®ç°äº†é€šè¿‡ n8n å®æ—¶åŒæ­¥è±†ç“£æ•°æ®åˆ° memos å’Œ telegramï¼š\né€šè¿‡ python è„šæœ¬ è·å–æœ€è¿‘ 10 æ¡è®°å½•ï¼Œæ˜¾ç¤ºåˆ° æˆ‘çš„ github ä¸»é¡µã€‚\nç†è´¢ è¿™å‘¨æ€»è®¡æ”¯å‡º 816 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š\n5 æœˆ 1 æ—¥ï¼š55 å…ƒ 5 æœˆ 2 æ—¥ï¼š79 å…ƒ 5 æœˆ 3 æ—¥ï¼š370 å…ƒï¼Œå…¶ä¸­ 270 å…ƒåŠ æ²¹ 5 æœˆ 4 æ—¥ï¼š136 å…ƒï¼Œå…¶ä¸­ææ¬¾ 50 å…ƒ 5 æœˆ 5 æ—¥ï¼š12 å…ƒ 5 æœˆ 6 æ—¥ï¼š100 å…ƒï¼Œæ‰‹æœºè¯è´¹å……å€¼ 5 æœˆ 7 æ—¥ï¼š64 å…ƒ æœ€è¿‘ä¸€ç›´æƒ³ç»Ÿè®¡ä¸€ä¸‹å·¥ä½œå’Œç”Ÿæ´»ä¸­çš„å›ºå®šæ”¯å‡ºè´¹ç”¨ï¼Œäºæ˜¯ä»Šå¤©èŠ±äº†ç‚¹æ—¶é—´åšäº†ç»Ÿè®¡ã€‚æ²¡æƒ³åˆ°æ¯å¹´å·¥ä½œå’Œç”Ÿæ´»ä¸­å›ºå®šæ”¯å‡ºè´¹ç”¨ç«Ÿç„¶è¾¾åˆ°äº† 1529+6180=7709 å…ƒã€‚å…¶ä¸­å¤§å—å¤´æ˜¯æ‰‹æœºè¯è´¹å’Œåœè½¦ä½è´¹ç”¨ï¼Œæ‰‹æœºè¯è´¹æ˜¯å› ä¸ºåŠç†ä¸€ä¸ªç”µä¿¡å¥—é¤é€å®½å¸¦å’Œä¸€éƒ¨æ‰‹æœºï¼›åœè½¦ä½è´¹ç”¨æ˜¯å› ä¸ºä»Šå¹´ä¹°äº†è½¦ã€‚\nå¹´è´¹ï¼Œæ€»è®¡ï¼š1529 å…ƒ\nTyporaï¼š89 å…ƒ ç™¾åº¦ç¡¬ç›˜ï¼š178 å…ƒï¼Œ2024-01-28 åˆ°æœŸ å¿«è¿ VPNï¼š374 å…ƒï¼Œ2024-01-16 åˆ°æœŸ æ¬ç“¦å·¥ VPSï¼š640 å…ƒï¼Œ2024-01-14 åˆ°æœŸ 1Passwordï¼š248 å…ƒï¼Œ2023-08-17 åˆ°æœŸ æœˆè´¹ï¼Œæ€»è®¡ï¼š515*12=6180 å…ƒ\næ‰‹æœºè¯è´¹ï¼š189 å…ƒ\nåœè½¦ä½ï¼š320 å…ƒ\niCloudï¼š6 å…ƒ\nå¥èº« æœ¬å‘¨ è·‘æ­¥ è®°å½•å¦‚ä¸‹ï¼Œæ€»è®¡è·‘æ­¥ 34.37 å…¬é‡Œï¼Œå…¶ä¸­å‘¨å…­ç¬¬ä¸€æ¬¡è·‘äº† 12 å…¬é‡Œï¼Œæ¯”ä¹‹å‰æœ‰æ‰€è¿›æ­¥ã€‚é—æ†¾çš„æ˜¯ï¼Œæœ‰ä¸¤å¤©æ²¡æœ‰è·‘æ­¥ï¼Œå¯¼è‡´è¿ç»­è·‘æ­¥å¤©æ•°æœ‰ä¸­æ–­ã€‚\nä» 3 æœˆä»½å¼€å§‹è·‘æ­¥åˆ° 5 æœˆï¼Œç›®å‰æ€»å…±è·‘æ­¥è·ç¦»è¾¾åˆ°äº† 230 å…¬é‡Œã€‚\nå·¥ä½œ Effective Java 3 ç¬”è®° æœ¬å‘¨å†™äº†ä¸¤ç¯‡ã€ŠEffective Java 3ã€‹çš„å­¦ä¹ ç¬”è®°ï¼Œåˆ†åˆ«æ˜¯ï¼š\nã€ŠEffective Java 3ã€‹ç¬”è®° 8ï¼šé¿å…ä½¿ç”¨ç»ˆç»“å™¨å’Œæ¸…é™¤å™¨ ã€ŠEffective Java 3ã€‹ç¬”è®° 9ï¼šä½¿ç”¨ try-with-resources ä¼˜äº try-finally è‡³æ­¤ï¼Œã€ŠEffective Java 3ã€‹ç¬¬äºŒç« å­¦ä¹ å®Œäº†ï¼Œç°åœ¨æ€»ç»“å¦‚ä¸‹ï¼š\n1ã€é™æ€å·¥å‚æ–¹æ³•ä»£æ›¿æ„é€ å‡½æ•°\né™æ€å·¥å‚æ–¹æ³•æ˜¯ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ï¼Œå®ƒä»¬ä¸æ„é€ å™¨ä¸åŒï¼Œå…·æœ‰æ˜ç¡®çš„åç§°ï¼Œå¹¶ä¸”å¯ä»¥è¿”å›ä»»æ„ç±»å‹çš„å¯¹è±¡ã€‚é™æ€å·¥å‚æ–¹æ³•çš„ä¼˜ç‚¹åŒ…æ‹¬ï¼š\nåç§°å¯ä»¥æè¿°å¯¹è±¡çš„å«ä¹‰ï¼Œä½¿å¾—ä»£ç æ›´åŠ æ¸…æ™°æ˜“è¯»ï¼›\né™æ€å·¥å‚æ–¹æ³•å¯ä»¥æ§åˆ¶åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ï¼Œæé«˜çµæ´»æ€§ï¼›\né™æ€å·¥å‚æ–¹æ³•å¯ä»¥ç¼“å­˜å·²åˆ›å»ºçš„å¯¹è±¡ï¼Œé¿å…åˆ›å»ºé‡å¤å¯¹è±¡ï¼Œæé«˜æ€§èƒ½ï¼›\né™æ€å·¥å‚æ–¹æ³•å¯ä»¥è¿”å›ä»»æ„ç±»å‹çš„å¯¹è±¡ï¼Œè€Œä¸ä»…ä»…æ˜¯è¯¥ç±»æˆ–è€…å…¶å­ç±»çš„å®ä¾‹ã€‚\n2ã€ä½¿ç”¨æ„é€ å™¨ä»£æ›¿æ„é€ æ–¹æ³•\nå½“ä¸€ä¸ªç±»éœ€è¦å¤šä¸ªå‚æ•°æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ„å»ºå™¨ï¼Œå°†å‚æ•°é€ä¸ªè®¾ç½®ï¼Œæœ€åè°ƒç”¨ build æ–¹æ³•æ„å»ºå¯¹è±¡ã€‚æ„å»ºå™¨çš„ä¼˜ç‚¹åŒ…æ‹¬ï¼š\nå¯ä»¥é¿å…é•¿å‚æ•°åˆ—è¡¨ï¼Œä½¿å¾—ä»£ç æ›´åŠ æ¸…æ™°æ˜“è¯»ï¼›\næ„å»ºå™¨å¯ä»¥å¼ºåˆ¶è¦æ±‚å¿…éœ€çš„å‚æ•°ï¼Œæé«˜ä»£ç çš„å®‰å…¨æ€§ï¼›\næ„å»ºå™¨å¯ä»¥è¿”å›ä¸å¯å˜å¯¹è±¡ï¼Œæé«˜ä»£ç çš„çº¿ç¨‹å®‰å…¨æ€§ã€‚\n3ã€ä½¿ç”¨ç§æœ‰æ„é€ å‡½æ•°æˆ–æšä¸¾ç±»å‹åˆ›å»ºå•ä¾‹\né€šè¿‡ç§æœ‰æ„é€ å™¨æˆ–è€…æšä¸¾ç±»å‹æ¥å®ç° Singletonï¼Œå®ƒä»¬çš„ä¼˜ç‚¹åŒ…æ‹¬ï¼š\nå¯ä»¥ç¡®ä¿åªæœ‰ä¸€ä¸ªå®ä¾‹å­˜åœ¨ï¼Œæé«˜ä»£ç çš„å®‰å…¨æ€§ï¼›\nå¯ä»¥ç¼©å°ç±»çš„å¯è®¿é—®æ€§ï¼Œæé«˜ä»£ç çš„å°è£…æ€§ï¼›\nå¯ä»¥è®©ä»£ç æ›´åŠ è‡ªç„¶ï¼Œé¿å…ä½¿ç”¨é™æ€æ–¹æ³•å’Œé™æ€å˜é‡çš„é™åˆ¶ã€‚\n4ã€ç”¨ç§æœ‰æ„é€ å‡½æ•°ä½¿ç±»ä¸å¯å®ä¾‹åŒ–\nä½¿ç”¨ç§æœ‰æ„é€ å‡½æ•°å¼ºåˆ¶å®ç°ä¸å¯å®ä¾‹åŒ–çš„ä¸»è¦åŸå› æ˜¯é˜²æ­¢ç±»è¢«æ„å¤–åœ°å®ä¾‹åŒ–ï¼Œä»¥ä½¿ä»£ç æ›´åŠ å¥å£®å’Œå¯é ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ç±»ä¸­çš„é™æ€æ–¹æ³•å’Œé™æ€å­—æ®µï¼Œè€Œä¸éœ€è¦åˆ›å»ºè¯¥ç±»çš„å®ä¾‹ã€‚\n5ã€ä¾èµ–æ³¨å…¥ä¼˜äºç¡¬ç¼–ç èµ„æº\nä½¿ç”¨ä¾èµ–æ³¨å…¥æ¯”ç¡¬ç¼–ç èµ„æºçš„ä¼˜ç‚¹ï¼š\nå¯æµ‹è¯•æ€§ï¼šä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼Œå¾ˆå®¹æ˜“åˆ›å»ºå’Œæ³¨å…¥æ¨¡æ‹Ÿå¯¹è±¡è¿›è¡Œæµ‹è¯•ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ­£åœ¨æµ‹è¯•çš„ç»„ä»¶éš”ç¦»å¼€æ¥ï¼Œå¹¶ä¸“æ³¨äºæµ‹è¯•å…¶è¡Œä¸ºï¼Œè€Œä¸å¿…æ‹…å¿ƒå…¶ä¾èµ–é¡¹çš„è¡Œä¸ºã€‚ çµæ´»æ€§ï¼šä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°ç”¨ä¸åŒå®ç°æ›¿æ¢ä¾èµ–é¡¹ã€‚è¿™åœ¨éœ€è¦æ›´æ”¹ç»„ä»¶çš„è¡Œä¸ºè€Œä¸æ›´æ”¹å…¶ä»£ç æ—¶éå¸¸æœ‰ç”¨ã€‚ è§£è€¦ï¼šä¾èµ–æ³¨å…¥æœ‰åŠ©äºå°†ç»„ä»¶ä¸å…¶ä¾èµ–é¡¹è§£è€¦ï¼Œä½¿ä»£ç æ›´åŠ æ¨¡å—åŒ–å¹¶æ˜“äºç»´æŠ¤ã€‚ å…³æ³¨ç‚¹åˆ†ç¦»ï¼šä¾èµ–æ³¨å…¥å°†ä¾èµ–é¡¹çš„åˆ›å»ºå’Œç®¡ç†ä¸ç»„ä»¶æœ¬èº«åˆ†ç¦»ï¼Œå…è®¸æ›´æ¸…æ™°åœ°åˆ†ç¦»å…³æ³¨ç‚¹ã€‚ 6ã€é¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡\n7ã€æ’é™¤è¿‡æ—¶çš„å¯¹è±¡å¼•ç”¨\nåœ¨ä»£ç ä¸­åŠæ—¶æ¸…ç†ä¸å†ä½¿ç”¨çš„å¯¹è±¡å¼•ç”¨ï¼Œä»¥é¿å…å†…å­˜æ³„æ¼å’Œæ€§èƒ½é—®é¢˜ã€‚å½“ä¸€ä¸ªå¯¹è±¡ä¸å†éœ€è¦æ—¶ï¼Œåº”è¯¥å°½å¿«å°†å…¶å¼•ç”¨è®¾ç½®ä¸º nullï¼Œè¿™æ · JVM å¯ä»¥åŠæ—¶å›æ”¶å®ƒæ‰€å ç”¨çš„å†…å­˜ã€‚\n8ã€é¿å…ä½¿ç”¨ç»ˆç»“å™¨å’Œæ¸…é™¤å™¨\nç»ˆç»“æ–¹æ³•å’Œæ¸…é™¤æ–¹æ³•æ˜¯ä¸€ç§é‡Šæ”¾èµ„æºçš„æ–¹å¼ï¼Œä½†æ˜¯å®ƒä»¬å¹¶ä¸å¯é ï¼Œä¸åº”è¯¥ä¾èµ–äºå®ƒä»¬æ¥é‡Šæ”¾èµ„æºã€‚åº”è¯¥ä½¿ç”¨ try-with-resources ç»“æ„æˆ–è€…æ˜¾å¼çš„è°ƒç”¨ close æ–¹æ³•æ¥é‡Šæ”¾èµ„æºã€‚\n9ã€ä½¿ç”¨ try-with-resources ä¼˜äº try-finally\ntry-with-resources è¯­å¥æ˜¯ Java 7 ä¸­å¼•å…¥çš„ä¸€ç§æ–°è¯­æ³•ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†ç®€åŒ–èµ„æºç®¡ç†çš„ä»£ç ï¼Œå¹¶ç¡®ä¿èµ„æºè¢«æ­£ç¡®åœ°å…³é—­ï¼Œé¿å…äº†èµ„æºæ³„æ¼å’Œå¼‚å¸¸å¤„ç†çš„é—®é¢˜ã€‚\nPython Python å®‰è£…ã€æ„å»ºã€å‘å¸ƒã€ä¸‹è½½å’Œè¿è¡Œ Python åŒ…å’Œç¯å¢ƒç®¡ç† æœ¬å‘¨åˆ†äº« å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€ChenSoul Shareã€Telegram é¢‘é“æˆ–è€…æˆ‘çš„ memos ä¸­ã€‚æˆ‘å†™äº†ä¸€ä¸ª python è„šæœ¬ä» memos è¯»å–æœ€è¿‘ä¸€å‘¨çš„ memos è®°å½•ã€‚\n2023-05-06 git flow æ¨¡å‹çš„æå‡ºï¼šæŸ¥çœ‹é“¾æ¥ gitflow-avh æ˜¯ä¸€ä¸ªå¢å¼ºå·¥å…·ï¼šæŸ¥çœ‹é“¾æ¥ #git #tool #memos 2023-05-06 åˆæœ‰å“ªå®¶é˜…è¯»ç®¡ç†ç½‘ç«™å¯å–ä»£è±†ç“£è¯»ä¹¦ æŸ¥çœ‹é“¾æ¥ #douban #memos 2023-05-05 åˆ†äº«ä¸€äº›é˜…äººç»éªŒï¼š 1. å˜´å·´å¤ªå¿«çš„äººï¼Œå¾€å¾€æ²¡ä»€ä¹ˆåŸåºœã€‚å˜´å·´å¤ªç”œçš„äººï¼Œä¸å¯ä»¥æ·±äº¤ã€‚ 2. è¯å°‘çš„äººå¾€å¾€æ˜¯ä¸¤ä¸ªæç«¯ï¼Œè¦ä¹ˆçœŸçš„ç®€å•ï¼Œè¦ä¹ˆæ·±ä¸å¯æµ‹ã€‚ 3. æ€§æ ¼å†™åœ¨è„¸ä¸Šçš„äººï¼Œäººå“ä¸ä¼šå¤ªå·®ã€‚èƒ½å¤Ÿæ§åˆ¶æƒ…ç»ªçš„äººï¼Œå¾€å¾€ä¸æ˜¯ä¸€èˆ¬äººã€‚ 4. å¼€å£å°±è¯´â€œæˆ‘æœ‰ä¸€ä¸ªæœ‹å‹æ€æ ·æ€æ ·â€çš„äººï¼Œå¾€å¾€å•çº¯æ²¡å•¥çœŸæœ¬äº‹ã€‚ 5. ä¸å–œæ¬¢éº»çƒ¦åˆ«äººçš„äººï¼Œé€šå¸¸ä¹Ÿä¸å–œæ¬¢è¢«åˆ«äººéº»çƒ¦ã€‚ä¸€ä¸ªä¸æ‡‚æ‹’ç»çš„äººï¼Œä¹Ÿæ˜¯ä¸€ä¸ªä¸æ‡‚åº”é…¬çš„äººã€‚ 6. å¦‚æœä¸€ä¸ªäººå¯ä»¥åšåˆ°æ½‡æ´’è€Œä¸åˆç¾¤ï¼Œè¿™äººå¤šåŠæ˜¯ä¸ªè€æ±Ÿæ¹–ã€‚å¦‚æœä¸€ä¸ªäººå› ä¸åˆç¾¤ç‰¹åˆ«ä¸è‡ªåœ¨ï¼Œè¿™äººå¤šåŠæ˜¯ç¤¾ä¼šå°ç™½ã€‚ 7. çœ‹åœ°ä½é«˜çš„å¤§ä½¬æ¨èä»€ä¹ˆäººã€ç”¨ä»€ä¹ˆäººï¼Œé‚£è¿™ä¸ªå¤§ä½¬å°±æ˜¯ä»€ä¹ˆæ ·çš„äººã€‚ 8. è¶Šæ˜¯åšäº‹å°å¿ƒç¿¼ç¿¼çš„äººï¼Œè¶Šå®¹æ˜“å¾—ç½ªäººã€‚åè€Œéœ¸æ°”ç‚¹çš„äººï¼Œå¾€å¾€éƒ½ä¼šæœ‰ä¸‰åˆ†è–„é¢ã€‚ 9. å–„äºå·´ç»“è®¨å¥½åˆ«äººçš„äººï¼Œæœ€å¥½ä¸è¦ä¸ä¹‹æ·±äº¤ï¼Œå¦åˆ™å¿…å—å…¶ç´¯ã€‚ 10. çœ‹èµ·æ¥ä¸€æœ¬æ­£ç»ã€ä¸è‹Ÿè¨€ç¬‘ã€æ–¯æ–¯æ–‡æ–‡çš„äººï¼Œå¾€å¾€éƒ½æ¯”è¾ƒé—·éªšã€‚ 11. èƒ½åœ¨ä¸€å®šä½ç½®ä¸Šçš„äººï¼Œæ— è®ºä½ å¤šä¹ˆè®¨åŒä»–ï¼Œä¸€å®šæœ‰ä»–æŸäº›è¿‡äººä¹‹å¤„ã€‚ 12. èƒ½å¤Ÿåœ¨ä¸€æ®µæ„Ÿæƒ…å¤±è´¥åï¼Œå¾ˆå¿«èµ°å‡ºæ¥çš„äººï¼Œè¦ä¹ˆæ²¡æœ‰çœŸå¿ƒä»˜å‡ºï¼Œè¦ä¹ˆç†æ€§å¾—å¯æ€•ã€‚ 13. æƒ³çŸ¥é“ä¸€ä¸ªäººå“è¡Œå¦‚ä½•ï¼Œå¯ä»¥è§‚å¯Ÿä¸€ä¸‹ä»–åŸ¹å…»å‡ºæ¥çš„å­©å­ã€‚ 14. é«˜åº¦è‡ªå¾‹çš„äººï¼Œå¾€å¾€å¯¹åˆ«äººçš„è¦æ±‚ä¹Ÿå¾ˆé«˜ã€‚ 15. å¹´å°‘å¾—å¿—ï¼Œå¤ªå®¹æ˜“è·å¾—æˆåŠŸçš„äººï¼Œå¾€å¾€å®¹æ˜“æ ½è·Ÿå¤´ã€‚å¦‚æœèƒ½æ‰›è¿‡å»å¹¶å¸å–æ•™è®­ï¼Œå°†æ¥çš„æˆå°±ä¼šæ›´å¤§ï¼Œå¦åˆ™å®¹æ˜“æ‰å…¥æ·±æ¸Šã€‚ 16. é¢å¯¹æ­ç»´æˆ–ç¾è¾±éƒ½ä¸åŠ¨å£°è‰²çš„äººï¼Œè‚¯å®šæ˜¯åŸåºœææ·±çš„ç‹ è§’è‰²ã€‚è¿™ç§äººåƒä¸‡åˆ«ä¹±å¾—ç½ªï¼Œå¦åˆ™å—åˆ°çš„åå‡»ä¼šå¾ˆçªç„¶å¾ˆçŒ›çƒˆï¼Œä¸‹åœºä¼šå¾ˆæƒ¨ã€‚ #æ‘˜å½• #memos 2023-05-05 WoodpeckerCI æ˜¯ä¸€ä¸ªç”±ç¤¾åŒºç»´æŠ¤çš„ DroneCI åˆ†æ”¯ï¼Œä½¿ç”¨ Apache License 2.0 è®¸å¯è¯å‘å¸ƒã€‚ç¤¾åŒºç‰ˆè¿›ä¸€æ­¥æ‰©å±•äº† pipeline çš„åŠŸèƒ½ç‰¹æ€§ã€æ”¯æŒå¯¹æ–‡ä»¶è·¯å¾„è®¾ç½® pipeline æ‰§è¡Œæ¡ä»¶ï¼Œå¹¶ä¸”å¯ä»¥ä¸ Gitea å®ç°ç´§å¯†é›†æˆã€‚ä¸åŒçš„æ˜¯ï¼ŒDroneCI çš„é…ç½®æ–‡ä»¶æ˜¯ .drone.ymlï¼ŒWoodpeckerCI é‡å‘½åä¸ºäº† .woodpecker.ymlã€‚å¥½åœ¨ WoodpeckerCI ä¹Ÿå…¼å®¹ DroneCI çš„é…ç½®æ–‡ä»¶ï¼Œè¿ç§»èµ·æ¥å¹¶ä¸ä¼šå¤ªéº»çƒ¦ã€‚ æŸ¥çœ‹é“¾æ¥ #memos #tool 2023-05-04 git-flow[å®æˆ˜ç³»åˆ—] æŸ¥çœ‹é“¾æ¥ #memos #git #tool 2023-05-04 åœ¨ Node.js ç”Ÿæ€ç³»ç»Ÿä¸­æŸ¥æ‰¾ç§¯æç»´æŠ¤å’Œæµè¡Œçš„åº“ æŸ¥çœ‹é“¾æ¥ #web #nodejs #memos 2023-05-04 å¯ä»¥ç”¨æ¥å–ä»£ UUID, æ•ˆç‡æ›´é«˜, æ”¯æŒè‡ªå®šä¹‰å­—ç¬¦é›† æŸ¥çœ‹é“¾æ¥ #memos #tool 2023-05-04 unDraw: ä¸€ä¸ªå¯ä»¥å…è´¹ä½¿ç”¨çš„æ’å›¾åº“, ä¼˜åŠ¿: å¯å…è´¹å•†ç”¨/æ”¯æŒç›´æ¥æ”¹è‰² æŸ¥çœ‹é“¾æ¥ #memos #tool 2023-05-04 ä¸´æ—¶æ–‡ä»¶ä¸Šä¼ æœåŠ¡ æ–‡ä»¶ä¼ è¾“å·¥å…·ï¼Œä¸Šä¼ çš„æ–‡ä»¶åªä¿ç•™ 48 å°æ—¶ï¼Œè¿‡æœŸè‡ªåŠ¨åˆ é™¤ æŸ¥çœ‹é“¾æ¥ Pixeldrain å…è´¹æ–‡ä»¶åˆ†äº«ï¼Œå…è´¹æ¯ä¸ªæ–‡ä»¶æœ€å¤§ 20 GB per fileï¼Œæ— å¹¿å‘Šã€‚ æŸ¥çœ‹é“¾æ¥ TEMPORARY FILE HOSTING All uploaded files are automatically deleted after 60 minutes. æŸ¥çœ‹é“¾æ¥ Super simple file sharing! Upload as many files as you like up to 2 GB and get a link to share.ï¼ˆä¸€æ¬¡ä¸‹è½½åï¼Œé“¾æ¥å³è¿‡æœŸï¼‰ æŸ¥çœ‹é“¾æ¥ Upload And Share (MP4, WEBM) Temporary Videos æŸ¥çœ‹é“¾æ¥ #memos #tool 2023-05-04 é€‚åˆç¼–ç¨‹æ—¶å¬çš„éŸ³ä¹ æŸ¥çœ‹é“¾æ¥ æŸ¥çœ‹é“¾æ¥ #memos #music ä»¥ä¸Šã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/05/10/weekly_review_18/","summary":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-05-01 åˆ° 2023-05-07 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nç»§ä¸Šå‘¨å®ç°å¯¼å‡ºè‹¹æœæ¥å£æ•°æ®ä¹‹åï¼Œè¿™å‘¨åˆå®ç°äº†è‡ªåŠ¨å¯¼å‡ºè±†ç“£æ•°æ®ã€‚æ­¤å¤–ï¼Œè¿˜èŒç”Ÿäº†å¯¼å‡ºæ¯å¤©é˜…è¯»çš„æ•°æ®çš„æƒ³æ³•ã€‚å¥ˆä½•ç°åœ¨é˜…è¯» app éƒ½éœ€è¦æ”¶è´¹ï¼Œåªèƒ½æš‚ä¸”æç½®è¿™ä¸ªæƒ³æ³•ã€‚\næœ€è¿‘åœ¨å­¦ä¹  Pythonï¼Œäºæ˜¯å°†å­¦ä¹ ä¸­åšçš„ç¬”è®°å‘å¸ƒåˆ°äº†åšå®¢ï¼Œè¿™å‘¨å‘å¸ƒäº†ä¸¤ç¯‡æ–‡ç« ï¼Œå¸Œæœ›é€šè¿‡è¾“å‡ºæ¥å€’é€¼è¾“å…¥ï¼Œä»¥æ­¤æ¥å¿«é€ŸæŒæ¡ python ç¼–ç¨‹å¹¶èƒ½å¼€å‘ä¸€äº›é¡¹ç›®ã€‚å¦å¤–ï¼Œè®¡åˆ’åœ¨å­¦å®Œä¹‹åï¼Œç»§ç»­å­¦ä¹  Rust å’Œ Goï¼Œç”šè‡³å¼€å§‹å­¦ä¹ å‰ç«¯å¼€å‘ã€‚\næœ€è¿‘åˆä¸€æ¬¡æ›´æ¢äº†åšå®¢ä¸»é¢˜ï¼Œä¸»è¦å‡ºå‘ç‚¹æ˜¯æƒ³æ‰¾ä¸€ä¸ªç®€æ´çš„ä¸»é¢˜ï¼Œå‡å°‘ä¸å¿…è¦çš„ä¿¡æ¯å¹²æ‰°ï¼Œä¹Ÿä¸æƒ³èŠ±æ—¶é—´åœ¨ä¿®æ”¹ä¸»é¢˜ä¸Šé¢ã€‚å‡å°‘äº†èœå•é“¾æ¥ã€‚\nå¯¼å‡ºè±†ç“£æ•°æ® æœ€è¿‘é˜…è¯»äº†ä¸€ç¯‡æ–‡ç«  å¾ˆè®¤çœŸçš„åœ¨è€ƒè™‘ä¸å†ä½¿ç”¨è±†ç“£è¿™ä»¶äº‹ ï¼Œäºæ˜¯ä½¿ç”¨ lizheming/doumark-action å¯¼å‡ºè±†ç“£æ•°æ®ã€‚\nåœ¨æˆ‘çš„ github ä¸»é¡µ https://github.com/chensoul/chensoul åˆ›å»ºä¸€ä¸ª workflow douban.yml ï¼Œæ¯éš”ä¸€ä¸ªå°æ—¶åŒæ­¥ä¸€æ¬¡è±†ç“£æ•°æ®ï¼ˆè¯»ä¹¦ã€ç”µå½±ã€éŸ³ä¹ï¼‰åˆ° csv æ–‡ä»¶ã€‚æ‹¿åˆ°è¿™äº›æ–‡ä»¶ä¹‹åï¼Œå°±å¯ä»¥é€šè¿‡ html + css æ¸²æŸ“å‡ºæ¥ï¼Œç±»ä¼¼è¿™ä¸ªé¡µé¢ ä¹¦å½±éŸ³ã€‚ç­‰è±†ç“£æ•°æ®å¢å¤šä¹‹åï¼Œå†è€ƒè™‘å®ç°è¿™ä¸ªã€‚\né™¤æ­¤ä¹‹å¤–ï¼Œä¹‹å‰è¿˜å®ç°äº†é€šè¿‡ n8n å®æ—¶åŒæ­¥è±†ç“£æ•°æ®åˆ° memos å’Œ telegramï¼š\né€šè¿‡ python è„šæœ¬ è·å–æœ€è¿‘ 10 æ¡è®°å½•ï¼Œæ˜¾ç¤ºåˆ° æˆ‘çš„ github ä¸»é¡µã€‚\nç†è´¢ è¿™å‘¨æ€»è®¡æ”¯å‡º 816 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š\n5 æœˆ 1 æ—¥ï¼š55 å…ƒ 5 æœˆ 2 æ—¥ï¼š79 å…ƒ 5 æœˆ 3 æ—¥ï¼š370 å…ƒï¼Œå…¶ä¸­ 270 å…ƒåŠ æ²¹ 5 æœˆ 4 æ—¥ï¼š136 å…ƒï¼Œå…¶ä¸­ææ¬¾ 50 å…ƒ 5 æœˆ 5 æ—¥ï¼š12 å…ƒ 5 æœˆ 6 æ—¥ï¼š100 å…ƒï¼Œæ‰‹æœºè¯è´¹å……å€¼ 5 æœˆ 7 æ—¥ï¼š64 å…ƒ æœ€è¿‘ä¸€ç›´æƒ³ç»Ÿè®¡ä¸€ä¸‹å·¥ä½œå’Œç”Ÿæ´»ä¸­çš„å›ºå®šæ”¯å‡ºè´¹ç”¨ï¼Œäºæ˜¯ä»Šå¤©èŠ±äº†ç‚¹æ—¶é—´åšäº†ç»Ÿè®¡ã€‚æ²¡æƒ³åˆ°æ¯å¹´å·¥ä½œå’Œç”Ÿæ´»ä¸­å›ºå®šæ”¯å‡ºè´¹ç”¨ç«Ÿç„¶è¾¾åˆ°äº† 1529+6180=7709 å…ƒã€‚å…¶ä¸­å¤§å—å¤´æ˜¯æ‰‹æœºè¯è´¹å’Œåœè½¦ä½è´¹ç”¨ï¼Œæ‰‹æœºè¯è´¹æ˜¯å› ä¸ºåŠç†ä¸€ä¸ªç”µä¿¡å¥—é¤é€å®½å¸¦å’Œä¸€éƒ¨æ‰‹æœºï¼›åœè½¦ä½è´¹ç”¨æ˜¯å› ä¸ºä»Šå¹´ä¹°äº†è½¦ã€‚","title":"å‘¨æŠ¥-18ï½œå¯¼å‡ºè±†ç“£æ•°æ®ã€Effective Java 3ç¬¬äºŒç« æ€»ç»“"},{"content":"å‘å±•å†å² Python åŒ…ç®¡ç†å·¥å…·æ˜¯ Python ç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå®ƒä»¬ä¸º Python å¼€å‘è€…æä¾›äº†æ–¹ä¾¿ã€å¿«æ·çš„åŒ…ç®¡ç†æ–¹å¼ã€‚ä»¥ä¸‹æ˜¯ Python åŒ…ç®¡ç†å·¥å…·çš„å‘å±•å†å²æ¦‚è¿°ï¼š\n1991 å¹´ï¼šPython è¯­è¨€é¦–æ¬¡å‘å¸ƒï¼ŒPython åŒ…ç®¡ç†å·¥å…·è¿˜æœªå‡ºç°ã€‚ 1998 å¹´ï¼šPython Distutils å·¥å…·å‘å¸ƒï¼Œå®ƒæ˜¯ Python çš„ç¬¬ä¸€ä¸ªåŒ…ç®¡ç†å·¥å…·ï¼Œå¯ä»¥ç”¨äºæ‰“åŒ…ã€å®‰è£…å’Œåˆ†å‘ Python åŒ…ã€‚ 2004 å¹´ï¼šeasy_install å·¥å…·å‘å¸ƒï¼Œå®ƒæ˜¯ä¸€ç§ç”¨äºå®‰è£…ã€å‡çº§å’Œå¸è½½ Python åŒ…çš„å·¥å…·ï¼Œå¯ä»¥è‡ªåŠ¨è§£æä¾èµ–å…³ç³»å¹¶å®‰è£…æ‰€éœ€çš„å…¶ä»–åŒ…ã€‚ 2007 å¹´ï¼špip å·¥å…·å‘å¸ƒï¼Œå®ƒæ˜¯ easy_install çš„ä¸€ä¸ªæ›¿ä»£å“ï¼Œæä¾›äº†æ›´å¥½çš„ä¾èµ–é¡¹è§£æã€å‡çº§å’Œå¸è½½åŠŸèƒ½ï¼Œä»¥åŠæ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚ 2012 å¹´ï¼šPython è½¯ä»¶åŸºé‡‘ä¼šå®£å¸ƒï¼Œpip å°†æˆä¸º Python åŒ…ç®¡ç†ç”Ÿæ€ç³»ç»Ÿä¸­çš„æ ‡å‡†å·¥å…·ï¼Œå–ä»£ easy_installã€‚ 2013 å¹´ï¼šWheel æ ¼å¼å‘å¸ƒï¼Œå®ƒæ˜¯ä¸€ç§ç”¨äºæ‰“åŒ…å’Œåˆ†å‘ Python åŒ…çš„æ ¼å¼ï¼Œå¯ä»¥åŒ…å« C æ‰©å±•æ¨¡å—ï¼Œå¹¶ä¸”æ”¯æŒå¤šå¹³å°å®‰è£…ã€‚ 2018 å¹´ï¼šPEP 517 å’Œ 518 å‘å¸ƒï¼Œå®ƒä»¬æä¾›äº†ä¸€ç§æ–°çš„ Python åŒ…æ„å»ºå’Œåˆ†å‘æ ‡å‡†ï¼Œå¯ä»¥ä½¿åŒ…æ„å»ºå’Œåˆ†å‘å˜å¾—æ›´åŠ ç®€å•å’Œå¯é ã€‚ 2018 å¹´ï¼šflit å·¥å…·å‘å¸ƒï¼Œå®ƒæ˜¯ä¸€ç§ç®€å•çš„ Python åŒ…æ„å»ºå’Œåˆ†å‘å·¥å…·ï¼Œå¯ä»¥é€šè¿‡ pyproject.toml æ–‡ä»¶æ¥é…ç½®åŒ…çš„å…ƒæ•°æ®å’Œä¾èµ–é¡¹ã€‚ 2019 å¹´ï¼špoetry å·¥å…·å‘å¸ƒï¼Œå®ƒæ˜¯ä¸€ç§ä¸“æ³¨äºä¾èµ–ç®¡ç†å’Œé¡¹ç›®æ„å»ºçš„ Python åŒ…ç®¡ç†å·¥å…·ï¼Œå¯ä»¥è‡ªåŠ¨è§£æä¾èµ–å…³ç³»ã€æ„å»ºé¡¹ç›®ã€ç”Ÿæˆ lock æ–‡ä»¶ç­‰ã€‚ 2020 å¹´ï¼šPEP 621 å‘å¸ƒï¼Œå®ƒæ˜¯ä¸€ç§æ–°çš„ Python åŒ…å…ƒæ•°æ®æ ‡å‡†ï¼Œå¯ä»¥ç”¨äºå®šä¹‰ Python åŒ…çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¦‚åç§°ã€ç‰ˆæœ¬ã€ä½œè€…ã€è®¸å¯è¯ç­‰ã€‚ 2020 å¹´ï¼šPEP 636 å‘å¸ƒï¼Œå®ƒæ˜¯ä¸€ç§æ–°çš„ CPython æ‰©å±•æ¨¡å—å…ƒæ•°æ®æ ‡å‡†ï¼Œå¯ä»¥ç”¨äºå®šä¹‰ CPython æ‰©å±•æ¨¡å—çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¦‚åç§°ã€ç‰ˆæœ¬ã€ä½œè€…ã€è®¸å¯è¯ç­‰ã€‚ 2021 å¹´ï¼šflit 3 å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ PEP 621 å’Œ PEP 636 çš„æ”¯æŒï¼Œå¯ä»¥ä½¿ç”¨ pyproject.toml æ–‡ä»¶æ¥å®šä¹‰ Python åŒ…å’Œ CPython æ‰©å±•æ¨¡å—çš„å…ƒæ•°æ®ä¿¡æ¯ã€‚ PyPA æ˜¯ Python Packaging Authority çš„ç¼©å†™ï¼Œå³ Python åŒ…ç®¡ç†æƒå¨ç»„ç»‡ã€‚PyPA çš„ç›®æ ‡æ˜¯ä¸º Python ç¤¾åŒºæä¾›ä¸€ä¸ªæ ‡å‡†çš„ã€æ˜“äºä½¿ç”¨çš„åŒ…ç®¡ç†å·¥å…·å’Œç›¸å…³å·¥å…·çš„ç”Ÿæ€ç³»ç»Ÿï¼Œå¹¶æä¾›ç›¸å…³çš„æ–‡æ¡£å’Œè§„èŒƒã€‚\nPyPA ç»„ç»‡æˆç«‹äº 2013 å¹´ï¼Œç”±ä¸€äº› Python åŒ…ç®¡ç†å·¥å…·çš„æ ¸å¿ƒå¼€å‘è€…ç»„æˆã€‚ç›®å‰ï¼ŒPyPA ç»„ç»‡ç»´æŠ¤äº†ä¸€äº› Python åŒ…ç®¡ç†å·¥å…·å’Œç›¸å…³å·¥å…·çš„é¡¹ç›®ï¼ŒåŒ…æ‹¬ï¼š\npip: Python åŒ…ç®¡ç†å·¥å…·ï¼Œç”¨äºå®‰è£…å’Œç®¡ç† Python åŒ…ã€‚ setuptools: Python åŒ…æ„å»ºå’Œåˆ†å‘å·¥å…·ï¼Œç”¨äºæ‰“åŒ…å’Œåˆ†å‘ Python åŒ…ã€‚ wheel: Python åŒ…äºŒè¿›åˆ¶åˆ†å‘æ ¼å¼ï¼Œç”¨äºåŠ å¿« Python åŒ…çš„å®‰è£…é€Ÿåº¦ã€‚ twine: Python åŒ…ä¸Šä¼ å·¥å…·ï¼Œç”¨äºå°† Python åŒ…ä¸Šä¼ åˆ° PyPI æˆ–å…¶ä»–åŒ…ä»“åº“ã€‚ virtualenv: Python è™šæ‹Ÿç¯å¢ƒå·¥å…·ï¼Œç”¨äºåˆ›å»ºå’Œç®¡ç† Python è™šæ‹Ÿç¯å¢ƒã€‚ æ­¤å¤–ï¼ŒPyPA è¿˜åˆ¶å®šäº†ä¸€äº›åŒ…ç®¡ç†çš„æ ‡å‡†å’Œè§„èŒƒï¼Œå¦‚ï¼š\nPEP 517 å’Œ PEP 518: å®šä¹‰äº† Python åŒ…çš„æ„å»ºè§„èŒƒå’Œæ„å»ºå·¥å…·çš„æ¥å£è§„èŒƒã€‚ PEP 440: å®šä¹‰äº† Python åŒ…ç‰ˆæœ¬å·çš„è¯­ä¹‰åŒ–è§„èŒƒã€‚ PEP 503: å®šä¹‰äº† Python åŒ…ä»“åº“çš„ URL å‘½åè§„èŒƒã€‚ PEP 621: å®šä¹‰äº† Python åŒ…å…ƒæ•°æ®çš„æ ‡å‡†æ ¼å¼ã€‚ PyPA çš„å·¥ä½œå¯¹ Python ç¤¾åŒºçš„åŒ…ç®¡ç†ç”Ÿæ€ç³»ç»Ÿäº§ç”Ÿäº†é‡è¦çš„å½±å“ï¼Œä½¿å¾— Python åŒ…çš„æ„å»ºã€åˆ†å‘ã€å®‰è£…å’Œç®¡ç†æ›´åŠ ç»Ÿä¸€å’Œè§„èŒƒã€‚åœ¨ä½¿ç”¨ Python åŒ…æ—¶ï¼Œå¯ä»¥å‚è€ƒ PyPA çš„ç›¸å…³å·¥å…·å’Œè§„èŒƒï¼Œä»¥ä¾¿æ›´å¥½åœ°ç®¡ç†å’Œä½¿ç”¨ Python åŒ…ã€‚\nDistutils å‘å±•å†å² Distutils æ˜¯ Python ç”Ÿæ€ç³»ç»Ÿä¸­çš„ç¬¬ä¸€ä¸ªåŒ…ç®¡ç†å·¥å…·ï¼Œå®ƒä¸º Python å¼€å‘è€…æä¾›äº†ä¸€ç§æ–¹ä¾¿ã€å¿«æ·çš„åŒ…ç®¡ç†æ–¹å¼ã€‚ä»¥ä¸‹æ˜¯ Distutils çš„å‘å±•å†å²æ¦‚è¿°ï¼š\n1998 å¹´ï¼šPython 1.5.2 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒæˆä¸ºç¬¬ä¸€ä¸ªå…·å¤‡æ¨¡å—æ‰“åŒ…åŠŸèƒ½çš„ Python ç‰ˆæœ¬ï¼Œä½†æ‰“åŒ…åŠŸèƒ½è¿˜æ¯”è¾ƒç®€å•ã€‚ 1999 å¹´ï¼šDistutils å·¥å…·å‘å¸ƒï¼Œå®ƒæ˜¯ Python 1.6 ç‰ˆæœ¬ä¸­çš„ä¸€ä¸ªæ ‡å‡†åº“ï¼Œå¯ä»¥ç”¨äºæ‰“åŒ…ã€å®‰è£…å’Œåˆ†å‘ Python åŒ…ã€‚ 2000 å¹´ï¼šDistutils 0.9.1 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Windows å¹³å°çš„æ”¯æŒï¼Œä»¥åŠå¯¹ Python 2.0 ç‰ˆæœ¬çš„æ”¯æŒã€‚ 2002 å¹´ï¼šDistutils 1.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 2.2 ç‰ˆæœ¬çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒ C æ‰©å±•æ¨¡å—ã€æ”¯æŒè‡ªå®šä¹‰å‘½ä»¤ã€æ”¯æŒæ‰“åŒ…å¤šä¸ªæ¨¡å—ç­‰ã€‚ 2007 å¹´ï¼šsetuptools å·¥å…·å‘å¸ƒï¼Œå®ƒæ˜¯ Distutils çš„ä¸€ä¸ªæ‰©å±•ï¼Œæä¾›äº†æ›´å¥½çš„ä¾èµ–é¡¹è§£æã€å‡çº§å’Œå¸è½½åŠŸèƒ½ï¼Œä»¥åŠæ›´å¥½çš„æ’ä»¶æœºåˆ¶å’Œæ‰©å±•æ€§ã€‚ 2013 å¹´ï¼šDistutils é¡¹ç›®åœæ­¢ç»´æŠ¤ï¼Œå®ƒçš„ä»£ç è¢«åˆå¹¶åˆ° Python æ ‡å‡†åº“ä¸­ï¼Œæˆä¸º Python æ‰“åŒ…å’Œåˆ†å‘çš„æ ‡å‡†å·¥å…·ã€‚ æ€»çš„æ¥è¯´ï¼ŒDistutils æ˜¯ Python ç”Ÿæ€ç³»ç»Ÿä¸­ç¬¬ä¸€ä¸ªåŒ…ç®¡ç†å·¥å…·ï¼Œå®ƒä¸º Python åŒ…çš„æ„å»ºã€æ‰“åŒ…ã€å®‰è£…å’Œåˆ†å‘æä¾›äº†å¾ˆå¤šæ–¹ä¾¿å’Œæ”¯æŒã€‚åœ¨å…¶å‘å±•å†å²ä¸­ï¼ŒDistutils ä¸æ–­æ›´æ–°è¿­ä»£ï¼Œå¢åŠ äº†è®¸å¤šæ–°ç‰¹æ€§å’ŒåŠŸèƒ½ï¼Œä»¥é€‚åº” Python ç”Ÿæ€ç³»ç»Ÿçš„å˜åŒ–å’Œéœ€æ±‚ã€‚å°½ç®¡ç°åœ¨ Distutils ä¸å†ä¸»åŠ¨ç»´æŠ¤ï¼Œä½†å®ƒçš„ä»£ç è¢«é›†æˆåˆ° Python æ ‡å‡†åº“ä¸­ï¼Œä»ç„¶ä¸º Python åŒ…ç®¡ç†æä¾›åŸºç¡€æ”¯æŒã€‚\neasy_install å‘å±•å†å² easy_install æ˜¯ Python åŒ…ç®¡ç†å·¥å…·ä¹‹ä¸€ï¼Œå®ƒçš„å‘å±•å†å²å¯ä»¥è¿½æº¯åˆ° 2004 å¹´ï¼Œä»¥ä¸‹æ˜¯ easy_install çš„å‘å±•å†å²æ¦‚è¿°ï¼š\n2004 å¹´ï¼šeasy_install é¦–æ¬¡å‘å¸ƒï¼Œå®ƒæ˜¯ä¸€ç§ç”¨äºå®‰è£…ã€å‡çº§å’Œå¸è½½ Python åŒ…çš„å·¥å…·ï¼Œå¯ä»¥è‡ªåŠ¨è§£æä¾èµ–å…³ç³»å¹¶å®‰è£…æ‰€éœ€çš„å…¶ä»–åŒ…ã€‚ 2005 å¹´ï¼šeasy_install è¢«çº³å…¥åˆ° setuptools ä¸­ï¼Œæˆä¸º setuptools çš„ä¸€éƒ¨åˆ†ã€‚æ­¤æ—¶ï¼Œeasy_install å·²ç»æˆä¸º Python åŒ…ç®¡ç†ç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¸€ä¸ªæ ¸å¿ƒå·¥å…·ã€‚ 2007 å¹´ï¼šeasy_install 0.6b1 å‘å¸ƒï¼Œå®ƒå¼•å…¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œå¦‚å¯¹æºç åˆ†å‘çš„æ”¯æŒã€å¯¹ egg æ ¼å¼çš„æ”¯æŒç­‰ã€‚ 2008 å¹´ï¼špip å·¥å…·å‘å¸ƒï¼Œå®ƒæ˜¯ easy_install çš„ä¸€ä¸ªæ›¿ä»£å“ï¼Œæä¾›äº†æ›´å¥½çš„ä¾èµ–é¡¹è§£æã€å‡çº§å’Œå¸è½½åŠŸèƒ½ï¼Œä»¥åŠæ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚ 2012 å¹´ï¼šPython è½¯ä»¶åŸºé‡‘ä¼šå®£å¸ƒï¼Œpip å°†æˆä¸º Python åŒ…ç®¡ç†ç”Ÿæ€ç³»ç»Ÿä¸­çš„æ ‡å‡†å·¥å…·ï¼Œå–ä»£ easy_installã€‚ æ€»çš„æ¥è¯´ï¼Œeasy_install æ˜¯ Python åŒ…ç®¡ç†ç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦å·¥å…·ï¼Œå®ƒä¸º Python å¼€å‘è€…æä¾›äº†ä¸€ç§ç®€å•ã€æ–¹ä¾¿çš„åŒ…ç®¡ç†æ–¹å¼ã€‚å°½ç®¡ easy_install çš„åŠŸèƒ½å’Œæ€§èƒ½åœ¨æŸäº›æ–¹é¢å·²ç»è¢« pip å’Œå…¶ä»–å·¥å…·å–ä»£ï¼Œä½†å®ƒä»ç„¶æ˜¯ Python åŒ…ç®¡ç†å†å²ä¸Šçš„ä¸€ä¸ªé‡è¦é‡Œç¨‹ç¢‘ï¼Œå¯¹ Python åŒ…ç®¡ç†å·¥å…·çš„å‘å±•äº§ç”Ÿäº†ç§¯æçš„å½±å“ã€‚\nSetuptools å‘å±•å†å² setuptools æ˜¯ç”± Phillip J. Eby å¼€å‘çš„ï¼Œå®ƒæ˜¯ Python çš„ä¸€ä¸ªåŒ…ç®¡ç†å·¥å…·ï¼Œç”¨äºæ„å»ºã€åˆ†å‘å’Œå®‰è£… Python åŒ…ã€‚\nPhillip J. Eby æ˜¯ä¸€ä½çŸ¥åçš„ Python ç¤¾åŒºæˆå‘˜å’Œå¼€æºè½¯ä»¶è´¡çŒ®è€…ï¼Œä»–ä¹Ÿæ˜¯ Python Packaging Authority çš„æˆå‘˜ä¹‹ä¸€ã€‚åœ¨ 2004 å¹´ï¼Œä»–å¼€å§‹å¼€å‘ setuptoolsï¼Œè¿™ä¸ªé¡¹ç›®çš„ç›®æ ‡æ˜¯ä¸º Python å¼€å‘è€…æä¾›ä¸€ä¸ªæ›´å¥½ã€æ›´æ–¹ä¾¿çš„åŒ…ç®¡ç†å·¥å…·ï¼Œä»¥æ›¿ä»£åŸæœ‰çš„ distutils å·¥å…·ã€‚\nsetuptools å’Œ distutils çš„ä¸»è¦åŒºåˆ«åœ¨äº setuptools æä¾›äº†ä¸€äº›é¢å¤–çš„åŠŸèƒ½ï¼Œå¦‚è‡ªåŠ¨å‘ç°ä¾èµ–å…³ç³»ã€æ”¯æŒå‘½ä»¤æ‰©å±•ã€æ”¯æŒ egg åŒ…ç­‰ã€‚è¿™äº›åŠŸèƒ½ä½¿å¾— Python åŒ…çš„æ„å»ºã€åˆ†å‘å’Œå®‰è£…å˜å¾—æ›´åŠ çµæ´»å’Œé«˜æ•ˆã€‚\nsetuptools ä»ä¸€å¼€å§‹å°±å—åˆ°äº† Python ç¤¾åŒºçš„æ¬¢è¿å’Œæ”¯æŒï¼Œå®ƒçš„ä»£ç æ‰˜ç®¡åœ¨ GitHub ä¸Šï¼Œå¹¶é€æ¸å‘å±•æˆä¸º Python ç”Ÿæ€ç³»ç»Ÿä¸­ä½¿ç”¨æœ€å¹¿æ³›çš„åŒ…ç®¡ç†å·¥å…·ä¹‹ä¸€ã€‚setuptools ä¹Ÿæ˜¯è®¸å¤šå…¶ä»– Python å·¥å…·å’Œæ¡†æ¶çš„åŸºç¡€ï¼Œå¦‚ Flaskã€Djangoã€numpy ç­‰ã€‚\nä»¥ä¸‹æ˜¯ Setuptools çš„å‘å±•å†å²æ¦‚è¿°ï¼š\n1994 å¹´ï¼šPython 1.0 ç‰ˆæœ¬ä¸­æ²¡æœ‰ setup.pyï¼Œå®‰è£… Python åŒ…éœ€è¦æ‰‹åŠ¨å¤åˆ¶æ–‡ä»¶ã€‚éšç€ Python çš„å‘å±•ï¼Œç”¨æˆ·éœ€è¦æ›´æ–¹ä¾¿çš„æ–¹æ³•æ¥å®‰è£…å’Œç®¡ç†åŒ…ï¼Œå› æ­¤å¼€å§‹å‡ºç°äº†ä¸€äº›ç®€å•çš„è‡ªåŠ¨åŒ–å®‰è£…å·¥å…·ã€‚ 2000 å¹´ï¼šDistutils æ˜¯ Python1.6 å®˜æ–¹çš„åŒ…ç®¡ç†å·¥å…·ï¼Œå®ƒæä¾›äº†ä¸€ç»„ç”¨äºæ‰“åŒ…ã€æ„å»ºå’Œåˆ†å‘ Python åŒ…çš„å·¥å…·å’Œå‘½ä»¤ã€‚å…¶ä¸­ï¼Œsetup.py æ˜¯ Distutils çš„æ ¸å¿ƒç»„ä»¶ï¼Œç”¨äºå®šä¹‰å’Œé…ç½®åŒ…çš„å…ƒæ•°æ®ã€ä¾èµ–é¡¹å’Œå…¥å£ç‚¹ç­‰ä¿¡æ¯ã€‚ 2004 å¹´ï¼šSetuptools é¦–æ¬¡å‘å¸ƒï¼Œå®ƒæ˜¯ Distutils çš„ä¸€ä¸ªæ‰©å±•ï¼Œæä¾›äº†ä¸€äº›é¢å¤–çš„åŠŸèƒ½å’Œæ‰©å±•ï¼Œå¦‚å¯¹ egg æ ¼å¼çš„æ”¯æŒã€å¯¹ä¾èµ–é¡¹çš„ç®¡ç†ã€å¯¹å‘½ä»¤æ‰©å±•çš„æ”¯æŒç­‰ã€‚ 2008 å¹´ï¼šSetuptools 0.6 å‘å¸ƒï¼Œå®ƒå¼•å…¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œå¦‚å¯¹ Python 2.6 å’Œ 3.0 çš„æ”¯æŒã€å¯¹ namespace packages çš„æ”¯æŒç­‰ã€‚ 2010 å¹´ï¼šDistribute å‘å¸ƒï¼Œå®ƒæ˜¯ Setuptools çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œæ—¨åœ¨æä¾›æ›´å¥½çš„å…¼å®¹æ€§å’Œæ˜“ç”¨æ€§ã€‚Distribute ç§»é™¤äº†ä¸€äº›è¿‡æ—¶çš„åŠŸèƒ½å’Œé€‰é¡¹ï¼Œå¹¶æ·»åŠ äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ‰©å±•ã€‚ 2013 å¹´ï¼šSetuptools 0.7 å‘å¸ƒï¼Œå®ƒå€Ÿé‰´äº† Distribute çš„ä¸€äº›è®¾è®¡å’ŒåŠŸèƒ½ï¼Œå¹¶ç§»é™¤äº†ä¸€äº›è¿‡æ—¶çš„åŠŸèƒ½å’Œé€‰é¡¹ã€‚Setuptools 0.7 çš„è¯­æ³•ä¸ Distribute çš„è¯­æ³•ç›¸åŒã€‚ 2018 å¹´ï¼šSetuptools 40.0 å‘å¸ƒï¼Œå®ƒå¼•å…¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œå¹¶ç§»é™¤äº†ä¸€äº›è¿‡æ—¶çš„åŠŸèƒ½å’Œé€‰é¡¹ã€‚Setuptools 40.0 çš„è¯­æ³•ä¸ Setuptools 0.7 ç›¸åŒã€‚ 2020 å¹´ï¼šSetuptools 49.0 å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.9 çš„æ”¯æŒï¼Œå¹¶å¼•å…¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œå¦‚å¯¹ GitLab çš„æ”¯æŒã€å¯¹ç¯å¢ƒå˜é‡çš„æ”¯æŒç­‰ã€‚ setup.cfg å‘å±•å†å² setup.cfg æ–‡ä»¶æ˜¯ Python é¡¹ç›®çš„å…ƒæ•°æ®å’Œæ„å»ºé€‰é¡¹çš„é…ç½®æ–‡ä»¶ï¼Œå®ƒå¯ä»¥æ›¿ä»£ setup.py è„šæœ¬æ¥å®šä¹‰ Python é¡¹ç›®çš„å…ƒæ•°æ®å’Œæ„å»ºé€‰é¡¹ã€‚ä»¥ä¸‹æ˜¯ setup.cfg çš„ä¸»è¦å‘å±•å†å²ï¼š\nPython 2.5ï¼šsetuptools æ‰©å±•æ¨¡å—å‘å¸ƒï¼Œå¼•å…¥äº† setup.cfg æ–‡ä»¶æ¥å®šä¹‰é¡¹ç›®çš„å…ƒæ•°æ®å’Œæ„å»ºé€‰é¡¹ã€‚ Python 3.1ï¼šdistutils2 é¡¹ç›®å‘å¸ƒï¼Œæ—¨åœ¨æ”¹è¿› distutils æ¨¡å—çš„è®¾è®¡å’Œå®ç°ï¼Œå¼•å…¥äº† setup.cfg æ–‡ä»¶ä½œä¸ºå®šä¹‰é¡¹ç›®å…ƒæ•°æ®å’Œæ„å»ºé€‰é¡¹çš„é¦–é€‰æ–¹å¼ã€‚ Python 3.4ï¼šsetuptools æ‰©å±•æ¨¡å—è¢«æ·»åŠ åˆ° Python æ ‡å‡†åº“ä¸­ï¼Œæˆä¸º distutils çš„ä¸€éƒ¨åˆ†ï¼Œsetup.cfg æ–‡ä»¶æˆä¸ºæ ‡å‡†çš„é…ç½®æ–‡ä»¶æ ¼å¼ã€‚ éšç€ Python çš„å‘å±•ï¼Œsetup.cfg æ–‡ä»¶é€æ¸æˆä¸º Python é¡¹ç›®çš„æ ‡å‡†é…ç½®æ–‡ä»¶æ ¼å¼ã€‚å®ƒæä¾›äº†æ¯” setup.py è„šæœ¬æ›´ç®€æ´ã€æ›´æ˜“äºé˜…è¯»å’Œç»´æŠ¤çš„é…ç½®æ–¹å¼ï¼ŒåŒæ—¶ä¹Ÿæ›´å®¹æ˜“ä¸å…¶ä»–å·¥å…·é›†æˆã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œsetup.cfg æ–‡ä»¶å¹¶ä¸æ˜¯å¿…éœ€çš„ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šè¯¥æ–‡ä»¶ï¼Œåˆ™ setuptools å°†é»˜è®¤ä½¿ç”¨ setup.py è„šæœ¬æ¥å®šä¹‰é¡¹ç›®çš„å…ƒæ•°æ®å’Œæ„å»ºé€‰é¡¹\npyproject.toml å‘å±•å†å² pyproject.toml æ˜¯ä¸€ä¸ª TOML æ ¼å¼çš„æ–‡ä»¶ï¼Œç”¨äºå®šä¹‰ Python é¡¹ç›®çš„å…ƒæ•°æ®å’Œæ„å»ºé€‰é¡¹ã€‚å®ƒæ˜¯ Python ä¸­çš„ä¸€ä¸ªæ–°çš„æ ‡å‡†æ–‡ä»¶ï¼Œç”¨äºæ›¿ä»£ setup.py è„šæœ¬å’Œ setup.cfg æ–‡ä»¶æ¥å®šä¹‰å’Œæ„å»º Python é¡¹ç›®ã€‚ä»¥ä¸‹æ˜¯ pyproject.toml çš„ä¸»è¦å‘å±•å†å²ï¼š\nPEP 517ï¼šè¯¥ PEP æå‡ºäº†ä¸€ä¸ªæ–°çš„æ„å»ºç³»ç»Ÿæ¥å£ï¼Œç”¨äºæ›¿ä»£ setup.py å’Œ setup.cfgï¼Œå¹¶å¼•å…¥äº† pyproject.toml æ–‡ä»¶ä½œä¸ºå®šä¹‰ Python é¡¹ç›®çš„å…ƒæ•°æ®å’Œæ„å»ºé€‰é¡¹çš„æ ‡å‡†æ–‡ä»¶æ ¼å¼ã€‚ PEP 518ï¼šè¯¥ PEP æå‡ºäº†ä¸€ç§æ–°çš„æ–¹å¼æ¥å®šä¹‰é¡¹ç›®çš„ä¾èµ–å…³ç³»ï¼Œå¹¶å¼•å…¥äº† pyproject.toml æ–‡ä»¶ä½œä¸ºæ ‡å‡†çš„é¡¹ç›®å…ƒæ•°æ®æ–‡ä»¶æ ¼å¼ã€‚ éšç€ PEP 517 å’Œ PEP 518 çš„å‘å¸ƒï¼Œpyproject.toml æ–‡ä»¶é€æ¸æˆä¸º Python é¡¹ç›®çš„æ ‡å‡†å…ƒæ•°æ®æ–‡ä»¶æ ¼å¼ã€‚å®ƒæä¾›äº†æ¯” setup.py è„šæœ¬å’Œ setup.cfg æ–‡ä»¶æ›´çµæ´»ã€æ›´æ˜“äºé…ç½®å’Œæ‰©å±•çš„æ–¹å¼ï¼ŒåŒæ—¶ä¹Ÿæ›´å®¹æ˜“ä¸æ„å»ºå·¥å…·å’Œä¾èµ–ç®¡ç†å™¨é›†æˆã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œpyproject.toml æ–‡ä»¶åªåœ¨ä½¿ç”¨ PEP 517 å’Œ PEP 518 è§„èŒƒçš„æ„å»ºå·¥å…·ä¸­æ‰ä¼šè¢«è¯†åˆ«å’Œä½¿ç”¨ã€‚\næ€»ä¹‹ï¼Œpyproject.toml æ–‡ä»¶æ˜¯ Python é¡¹ç›®çš„æ ‡å‡†å…ƒæ•°æ®å’Œæ„å»ºé€‰é¡¹çš„é…ç½®æ–‡ä»¶ï¼Œå®ƒæä¾›äº†æ¯” setup.py è„šæœ¬å’Œ setup.cfg æ–‡ä»¶æ›´çµæ´»ã€æ›´æ˜“äºé…ç½®å’Œæ‰©å±•çš„æ–¹å¼ï¼Œæˆä¸ºäº† Python é¡¹ç›®çš„æ ‡å‡†å…ƒæ•°æ®æ–‡ä»¶æ ¼å¼ã€‚\nPip å‘å±•å†å² åœ¨ Python ä¸­ï¼Œpip å’Œ setuptools æ˜¯ä¸¤ä¸ªå¸¸ç”¨çš„åŒ…ç®¡ç†å·¥å…·ï¼Œå®ƒä»¬åœ¨å®‰è£…å’Œç®¡ç† Python åŒ…æ–¹é¢å‘æŒ¥ç€é‡è¦ä½œç”¨ã€‚\npip æ˜¯ç”± Ian Bicking å’Œå…¶ä»– Python ç¤¾åŒºæˆå‘˜å¼€å‘çš„ï¼Œå®ƒæ˜¯ Python çš„åŒ…ç®¡ç†å™¨ä¹‹ä¸€ï¼Œç”¨äºåœ¨ Python ç¨‹åºä¸­å®‰è£…å’Œç®¡ç†è½¯ä»¶åŒ…ã€‚\nIan Bicking æ˜¯ä¸€ä½ Python ç¨‹åºå‘˜å’Œå¼€æºè½¯ä»¶è´¡çŒ®è€…ï¼Œä»–è¿˜æ˜¯ Pylons å’Œ Paste ç­‰æ¡†æ¶çš„åˆ›å§‹äººä¹‹ä¸€ã€‚åœ¨ 2008 å¹´ï¼Œä»–å¼€å§‹å¼€å‘ pipï¼Œè¿™ä¸ªé¡¹ç›®çš„ç›®æ ‡æ˜¯ä¸º Python ç¤¾åŒºæä¾›ä¸€ä¸ªæ›´å¥½ã€æ›´æ˜“ç”¨çš„åŒ…ç®¡ç†å™¨ï¼Œä»¥æ›¿ä»£åŸæœ‰çš„ easy_install å·¥å…·ã€‚\npip ä»ä¸€å¼€å§‹å°±å—åˆ°äº† Python ç¤¾åŒºçš„æ¬¢è¿å’Œæ”¯æŒï¼Œå®ƒçš„ä»£ç æ‰˜ç®¡åœ¨ GitHub ä¸Šï¼Œå¹¶é€æ¸å‘å±•æˆä¸º Python ç”Ÿæ€ç³»ç»Ÿä¸­ä½¿ç”¨æœ€å¹¿æ³›çš„åŒ…ç®¡ç†å™¨ä¹‹ä¸€ã€‚pip æ”¯æŒä» PyPIï¼ˆPython Package Indexï¼‰ç­‰æºä¸­ä¸‹è½½å’Œå®‰è£… Python åŒ…ï¼Œå¹¶è‡ªåŠ¨å¤„ç†åŒ…ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œä½¿å¾— Python åŒ…çš„ç®¡ç†å˜å¾—æ›´åŠ ç®€å•å’Œé«˜æ•ˆã€‚\nç›®å‰ï¼Œpip å·²ç»æˆä¸ºäº† Python å®˜æ–¹æ¨èçš„åŒ…ç®¡ç†å™¨ï¼Œå¹¶ä¸”å·²ç»é›†æˆåˆ° Python 2.7.9 å’Œ Python 3.4 ä»¥åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€é¢å¤–å®‰è£…ã€‚\npip ä¸ setuptools æœ‰å¯†åˆ‡çš„å…³ç³»ï¼Œå› ä¸ºå®ƒä½¿ç”¨ setuptools æ¥æ„å»ºå’Œå®‰è£… Python åŒ…ã€‚\nsetuptools æ˜¯ä¸€ä¸ª Python åŒ…çš„æ„å»ºå’Œåˆ†å‘å·¥å…·ï¼Œå®ƒæä¾›äº†ä¸€ç»„ API æ¥å®šä¹‰ã€æ„å»ºå’Œæ‰“åŒ… Python åŒ…ã€‚setuptools å¯ä»¥è‡ªåŠ¨ç”Ÿæˆ setup.py æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æè¿°äº† Python åŒ…çš„å…ƒæ•°æ®å’Œä¾èµ–å…³ç³»ï¼Œä»¥ä¾¿ pip å’Œå…¶ä»–å·¥å…·å¯ä»¥ä½¿ç”¨å®ƒæ¥å®‰è£…å’Œç®¡ç†åŒ…ã€‚\nåœ¨å®‰è£…å’Œç®¡ç† Python åŒ…æ—¶ï¼Œpip ä¼šä½¿ç”¨ setuptools æ¥è§£å†³ä¾èµ–å…³ç³»ã€æ„å»ºå’Œå®‰è£…åŒ…ã€‚pip ä¼šåœ¨ä¸‹è½½åŒ…ä¹‹å‰æ£€æŸ¥åŒ…çš„ä¾èµ–å…³ç³»ï¼Œå¹¶ä½¿ç”¨ setuptools æ¥å®‰è£…è¿™äº›ä¾èµ–é¡¹ã€‚å¦‚æœåŒ…éœ€è¦è¿›è¡Œæ„å»ºï¼Œpip ä¹Ÿä¼šä½¿ç”¨ setuptools æ¥æ„å»ºå®ƒä»¬\nä»¥ä¸‹æ˜¯ pip çš„å‘å±•å†å²æ¦‚è¿°ï¼š\n2008 å¹´ï¼špip é¦–æ¬¡å‘å¸ƒï¼Œå®ƒæ˜¯ easy_install çš„ä¸€ä¸ªæ›¿ä»£å“ï¼Œæä¾›äº†æ›´å¥½çš„ä¾èµ–é¡¹è§£æã€å‡çº§å’Œå¸è½½åŠŸèƒ½ï¼Œä»¥åŠæ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚ 2011 å¹´ï¼špip æ­£å¼æˆä¸º Python åŒ…ç®¡ç†çš„æ ‡å‡†å·¥å…·ä¹‹ä¸€ï¼Œå¹¶è¢«çº³å…¥åˆ° Python 2.7 å’Œ Python 3.2 ä¸­ã€‚ 2013 å¹´ï¼špip 1.4 å‘å¸ƒï¼Œå®ƒå¼•å…¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œå¦‚å¯¹ wheel æ ¼å¼çš„æ”¯æŒã€å¯¹å®‰è£…æºçš„ä¼˜åŒ–ç­‰ã€‚ 2016 å¹´ï¼špip 8.0 å‘å¸ƒï¼Œå®ƒå¼•å…¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œå¦‚å¯¹ hash æ ¡éªŒçš„æ”¯æŒã€å¯¹æºç´¢å¼•çš„ä¼˜åŒ–ç­‰ã€‚ 2018 å¹´ï¼špip 18.0 å‘å¸ƒï¼Œå®ƒå¼•å…¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œå¦‚å¯¹ Python 3.7 çš„æ”¯æŒã€å¯¹æºç´¢å¼•çš„æ”¹è¿›ç­‰ã€‚ 2020 å¹´ï¼špip 20.0 å‘å¸ƒï¼Œå®ƒå¼•å…¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œå¦‚å¯¹ Python 3.8 çš„æ”¯æŒã€å¯¹æºç´¢å¼•çš„ä¼˜åŒ–ç­‰ã€‚ Wheel å‘å±•å†å² Wheel æ˜¯ Python åŒ…åˆ†å‘çš„ä¸€ç§æ ¼å¼ï¼Œå®ƒçš„å‘å±•å†å²å¯ä»¥è¿½æº¯åˆ° 2012 å¹´ï¼Œä»¥ä¸‹æ˜¯ Wheel çš„å‘å±•å†å²æ¦‚è¿°ï¼š\n2012 å¹´ï¼šWheel é¦–æ¬¡æå‡ºï¼Œå®ƒçš„ç›®æ ‡æ˜¯æä¾›ä¸€ç§æ›´å¿«ã€æ›´å¯é ã€æ›´ç®€å•çš„ Python åŒ…åˆ†å‘æ ¼å¼ï¼Œä»¥å–ä»£æ—§çš„ egg æ ¼å¼ã€‚\n2013 å¹´ï¼šWheel 1.0 å‘å¸ƒï¼Œå®ƒå¼•å…¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œå¦‚å¯¹ namespace packages çš„æ”¯æŒã€å¯¹å¤šå¹³å°æ”¯æŒçš„æ”¹è¿›ç­‰ã€‚\n2014 å¹´ï¼šWheel 0.24 å‘å¸ƒï¼Œå®ƒå¼•å…¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œå¦‚å¯¹ Python 3.4 çš„æ”¯æŒã€å¯¹æºç åˆ†å‘çš„æ”¹è¿›ç­‰ã€‚\n2016 å¹´ï¼šWheel 0.29 å‘å¸ƒï¼Œå®ƒå¼•å…¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œå¦‚å¯¹ Python 3.6 çš„æ”¯æŒã€å¯¹æºç åˆ†å‘çš„æ”¹è¿›ç­‰ã€‚\n2018 å¹´ï¼šWheel 0.31 å‘å¸ƒï¼Œå®ƒå¼•å…¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œå¦‚å¯¹ Python 3.7 çš„æ”¯æŒã€å¯¹æºç åˆ†å‘çš„æ”¹è¿›ç­‰ã€‚\n2020 å¹´ï¼šWheel 0.35 å‘å¸ƒï¼Œå®ƒå¼•å…¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œå¦‚å¯¹ Python 3.9 çš„æ”¯æŒã€å¯¹æºç åˆ†å‘çš„æ”¹è¿›ç­‰ã€‚\nEgg æ˜¯ Python åŒ…åˆ†å‘æ ¼å¼ä¹‹ä¸€ï¼Œå®ƒçš„å…¨ç§°æ˜¯ Easy Install Packageï¼Œæ˜¯ç”± setuptools æä¾›çš„ä¸€ç§æ‰“åŒ…å’Œå®‰è£… Python åŒ…çš„æ ¼å¼ã€‚Egg æ ¼å¼æ—©æœŸæ˜¯ä½œä¸º Python åŒ…ç®¡ç†å·¥å…· easy_install çš„é»˜è®¤æ ¼å¼è€Œå‡ºç°çš„ï¼Œä½†ç°åœ¨å·²é€æ¸è¢« Wheel æ ¼å¼å–ä»£ã€‚\nEgg æ ¼å¼çš„æ–‡ä»¶æ‰©å±•åä¸º .eggï¼Œå®ƒæ˜¯ä¸€ä¸ªå‹ç¼©æ–‡ä»¶ï¼Œå¯ä»¥åŒ…å« Python æ¨¡å—ã€èµ„æºæ–‡ä»¶ã€æ–‡æ¡£ç­‰ã€‚ä¸å…¶ä»– Python åŒ…åˆ†å‘æ ¼å¼ç›¸æ¯”ï¼ŒEgg æ ¼å¼å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\nEgg æ ¼å¼çš„æ–‡ä»¶å¯ä»¥è¢« easy_install ç›´æ¥å®‰è£…ï¼Œæ— éœ€è§£åŒ…ã€‚ Egg æ ¼å¼æ”¯æŒ Python 2.x å’Œ Python 3.x çš„è·¨ç‰ˆæœ¬å®‰è£…ã€‚ Egg æ ¼å¼æ”¯æŒå¤šç‰ˆæœ¬å®‰è£…ï¼Œå¯ä»¥åœ¨åŒä¸€å°æœºå™¨ä¸ŠåŒæ—¶å®‰è£…å¤šä¸ªç‰ˆæœ¬çš„åŒä¸€ Python åŒ…ã€‚ è™½ç„¶ Egg æ ¼å¼æ›¾ç»æ˜¯ Python åŒ…åˆ†å‘ç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä½†æ˜¯éšç€ setuptools çš„å‘å±•å’Œ Wheel æ ¼å¼çš„å‡ºç°ï¼ŒEgg æ ¼å¼å·²ç»é€æ¸è¢«å–ä»£ã€‚ç°åœ¨å¤§éƒ¨åˆ† Python åŒ…éƒ½å·²ç»ä½¿ç”¨ Wheel æ ¼å¼è¿›è¡Œåˆ†å‘ï¼Œå› ä¸ºå®ƒæ¯” Egg æ ¼å¼æ›´å¿«ã€æ›´å¯é ã€æ›´çµæ´»ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ”¯æŒæ›´å¤šçš„ Python ç‰ˆæœ¬å’Œå¹³å°ã€‚\nWheel æ˜¯ Python åŒ…åˆ†å‘æ ¼å¼ä¹‹ä¸€ï¼Œå®ƒçš„å…¨ç§°æ˜¯ Python Wheel Packageï¼Œæ˜¯ç”± Python ç¤¾åŒºæä¾›çš„ä¸€ç§æ‰“åŒ…å’Œå®‰è£… Python åŒ…çš„æ ¼å¼ã€‚ä¸å…¶ä»– Python åŒ…åˆ†å‘æ ¼å¼ç›¸æ¯”ï¼ŒWheel æ ¼å¼å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\nWheel æ ¼å¼çš„æ–‡ä»¶æ‰©å±•åä¸º .whlï¼Œå®ƒæ˜¯ä¸€ä¸ªå‹ç¼©æ–‡ä»¶ï¼Œå¯ä»¥åŒ…å« Python æ¨¡å—ã€èµ„æºæ–‡ä»¶ã€æ–‡æ¡£ç­‰ã€‚ Wheel æ ¼å¼æ”¯æŒ Python 2.x å’Œ Python 3.x çš„è·¨ç‰ˆæœ¬å®‰è£…ã€‚ Wheel æ ¼å¼å¯ä»¥åŒ…å« C æ‰©å±•æ¨¡å—ï¼Œå› æ­¤å¯ä»¥åœ¨å®‰è£…æ—¶ç›´æ¥ç¼–è¯‘å’Œå®‰è£… C æ‰©å±•æ¨¡å—ï¼Œè€Œä¸éœ€è¦ä½¿ç”¨å…¶ä»–å·¥å…·ã€‚ Wheel æ ¼å¼æ”¯æŒå¤šå¹³å°å®‰è£…ï¼Œå³å¯ä»¥åœ¨ Windowsã€Linuxã€macOS ç­‰ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šå®‰è£…åŒä¸€ä¸ª Wheel åŒ…ã€‚ Wheel æ ¼å¼çš„å®‰è£…é€Ÿåº¦æ¯” Egg æ ¼å¼å¿«ï¼Œå› ä¸ºå®ƒä½¿ç”¨äº†æ›´ç®€å•ã€æ›´å¿«é€Ÿçš„ç®—æ³•ã€‚ Wheel æ ¼å¼å¯ä»¥é€šè¿‡ pip å·¥å…·ç›´æ¥å®‰è£…ï¼Œæ— éœ€ä½¿ç”¨å…¶ä»– Python åŒ…ç®¡ç†å·¥å…·ã€‚ Twine å‘å±•å†å² Twine æ˜¯ Python ç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¸€ä¸ªåŒ…ç®¡ç†å·¥å…·ï¼Œå®ƒä¸»è¦ç”¨äºå°†æ‰“åŒ…å¥½çš„ Python åŒ…ä¸Šä¼ åˆ° PyPIï¼ˆPython Package Indexï¼‰ç­‰åŒ…ä»“åº“ä¸­ã€‚ä»¥ä¸‹æ˜¯ Twine çš„å‘å±•å†å²æ¦‚è¿°ï¼š\n2015 å¹´ï¼šTwine å·¥å…·å‘å¸ƒï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨äºä¸Šä¼  Python åŒ…åˆ° PyPI çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæ”¯æŒ GPG ç­¾åå’Œ HTTPS ä¼ è¾“ã€‚ 2016 å¹´ï¼šTwine 1.4 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Wheel åŒ…æ ¼å¼çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒå¤šä¸ª PyPI ä»“åº“ã€æ”¯æŒæ£€æŸ¥åŒ…é‡å¤ä¸Šä¼ ç­‰ã€‚ 2017 å¹´ï¼šTwine 1.8 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ PEP 517 å’Œ PEP 518 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒæºç å®‰è£…ã€æ”¯æŒä¸Šä¼ å¤šä¸ªåŒ…æ–‡ä»¶ç­‰ã€‚ 2018 å¹´ï¼šTwine 1.12 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.7 å’Œ PyPI çš„æ–°ç‰¹æ€§çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ç¯å¢ƒå˜é‡é…ç½® PyPI ä»“åº“ã€æ”¯æŒä½¿ç”¨ .pypirc æ–‡ä»¶é…ç½®è®¤è¯ä¿¡æ¯ç­‰ã€‚ 2020 å¹´ï¼šTwine 3.2 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒç§»é™¤äº† Python 2 çš„æ”¯æŒï¼Œå¢åŠ äº†å¯¹ Python 3.9 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ twine check å‘½ä»¤æ£€æŸ¥åŒ…æ˜¯å¦ç¬¦åˆ PyPI æ ‡å‡†ã€æ”¯æŒä½¿ç”¨ twine register å‘½ä»¤åœ¨ PyPI ä¸­æ³¨å†Œé¡¹ç›®ç­‰ã€‚ virtualenv å‘å±•å†å² Virtualenv æ˜¯ Python ç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦å·¥å…·ï¼Œå®ƒæä¾›äº†ä¸€ç§åœ¨å•ä¸ªç³»ç»Ÿä¸­è¿è¡Œå¤šä¸ªç‹¬ç«‹ Python ç¯å¢ƒçš„æ–¹å¼ã€‚\nVirtualenv æ˜¯ç”± Ian Bicking å¼€å‘çš„ï¼Œå®ƒæ˜¯ä¸€ä¸ª Python è™šæ‹Ÿç¯å¢ƒç®¡ç†å·¥å…·ã€‚Ian Bicking æ˜¯ä¸€ä½ Python ç¨‹åºå‘˜å’Œå¼€æºè½¯ä»¶è´¡çŒ®è€…ï¼Œä»–è¿˜æ˜¯ Pylons å’Œ Paste ç­‰æ¡†æ¶çš„åˆ›å§‹äººä¹‹ä¸€ã€‚\nVirtualenv çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬äº 2007 å¹´å‘å¸ƒï¼Œå®ƒçš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è§£å†³ Python åŒ…ä¾èµ–æ€§çš„é—®é¢˜ã€‚åœ¨ Python ä¸­ï¼Œä¸åŒçš„é¡¹ç›®å¯èƒ½éœ€è¦ä¸åŒçš„ Python ç‰ˆæœ¬å’Œä¾èµ–åŒ…ï¼Œè€Œè¿™äº›ä¾èµ–åŒ…å¯èƒ½ä¼šç›¸äº’å†²çªã€‚Virtualenv å¯ä»¥åˆ›å»ºä¸€ä¸ªéš”ç¦»çš„ Python ç¯å¢ƒï¼Œä½¿å¾—æ¯ä¸ªé¡¹ç›®éƒ½å¯ä»¥ç‹¬ç«‹åœ°å®‰è£…å’Œä½¿ç”¨å…¶æ‰€éœ€çš„ Python ç‰ˆæœ¬å’Œä¾èµ–åŒ…ï¼Œä»è€Œé¿å…äº†å†²çªé—®é¢˜ã€‚\nåœ¨ Virtualenv å‘å¸ƒä¹‹åï¼Œå®ƒå¾ˆå¿«æˆä¸ºäº† Python å¼€å‘ç¤¾åŒºä¸­çš„ä¸€ä¸ªé‡è¦å·¥å…·ï¼Œå—åˆ°äº†å¹¿æ³›çš„å…³æ³¨å’Œä½¿ç”¨ã€‚Virtualenv åæ¥ä¹Ÿè¢«é›†æˆåˆ°äº† Python å®˜æ–¹çš„æ–‡æ¡£ä¸­ï¼Œå¹¶ä¸”æœ‰è®¸å¤šå…¶ä»–çš„è™šæ‹Ÿç¯å¢ƒç®¡ç†å·¥å…·ï¼Œå¦‚ Pyenv å’Œ Condaï¼Œä¹Ÿæ˜¯åŸºäº Virtualenv çš„æ€æƒ³å’Œå®ç°æ–¹å¼å¼€å‘çš„ã€‚\nä»¥ä¸‹æ˜¯ Virtualenv çš„å‘å±•å†å²æ¦‚è¿°ï¼š\n2007 å¹´ï¼šVirtualenv å·¥å…·å‘å¸ƒï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨äºåˆ›å»ºç‹¬ç«‹ Python ç¯å¢ƒçš„å·¥å…·ï¼Œå¯ä»¥é¿å…ä¸åŒé¡¹ç›®ä¹‹é—´çš„ä¾èµ–å†²çªã€‚ 2009 å¹´ï¼šVirtualenvwrapper å·¥å…·å‘å¸ƒï¼Œå®ƒæ˜¯ Virtualenv çš„ä¸€ä¸ªæ‰©å±•ï¼Œæä¾›äº†æ›´å¥½çš„è™šæ‹Ÿç¯å¢ƒç®¡ç†æ–¹å¼ï¼Œå¦‚åˆ›å»ºã€åˆ‡æ¢ã€åˆ é™¤è™šæ‹Ÿç¯å¢ƒç­‰ã€‚ 2010 å¹´ï¼šVirtualenv 1.5 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ requirements.txt æ–‡ä»¶å®‰è£…ä¾èµ–ã€æ”¯æŒä½¿ç”¨ pip å®‰è£…åŒ…ç­‰ã€‚ 2011 å¹´ï¼šVirtualenv 1.6 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.2 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ -p é€‰é¡¹æŒ‡å®š Python è§£é‡Šå™¨ã€æ”¯æŒä½¿ç”¨ \u0026ndash;system-site-packages é€‰é¡¹å…±äº«ç³»ç»Ÿ Python åŒ…ç­‰ã€‚ 2013 å¹´ï¼šVirtualenv 1.10 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.3 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ \u0026ndash;always-copy é€‰é¡¹å¤åˆ¶ä¾èµ–åŒ…ã€æ”¯æŒä½¿ç”¨ \u0026ndash;clear é€‰é¡¹æ¸…ç©ºè™šæ‹Ÿç¯å¢ƒç­‰ã€‚ 2017 å¹´ï¼šVirtualenv 16.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.6 å’Œ pip 10 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ \u0026ndash;upgrade é€‰é¡¹æ›´æ–°åŒ…ã€æ”¯æŒä½¿ç”¨ \u0026ndash;prompt é€‰é¡¹è®¾ç½®è™šæ‹Ÿç¯å¢ƒæç¤ºç¬¦ç­‰ã€‚ 2018 å¹´ï¼šVirtualenv 16.1 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.7 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ \u0026ndash;creator é€‰é¡¹æŒ‡å®šåˆ›å»ºè™šæ‹Ÿç¯å¢ƒçš„æ–¹å¼ã€æ”¯æŒä½¿ç”¨ \u0026ndash;verbose é€‰é¡¹æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ç­‰ã€‚ 2019 å¹´ï¼šVirtualenv 16.7.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.8 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ \u0026ndash;system-site-packages é€‰é¡¹å…±äº«ç³»ç»Ÿ Python åŒ…ã€æ”¯æŒä½¿ç”¨ \u0026ndash;copies é€‰é¡¹å¤åˆ¶ä¾èµ–åŒ…ç­‰ã€‚ 2020 å¹´ï¼šVirtualenv 20.0.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.9 å’Œ pip 20 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ \u0026ndash;prompt-cmd é€‰é¡¹è®¾ç½®è™šæ‹Ÿç¯å¢ƒæç¤ºç¬¦ã€æ”¯æŒä½¿ç”¨ \u0026ndash;no-pip é€‰é¡¹åˆ›å»ºä¸åŒ…å« pip çš„è™šæ‹Ÿç¯å¢ƒç­‰ã€‚ 2021 å¹´ï¼šVirtualenv 20.8.1 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.10 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ \u0026ndash;download é€‰é¡¹ä»æŒ‡å®š URL ä¸‹è½½ Python è§£é‡Šå™¨ã€æ”¯æŒä½¿ç”¨ \u0026ndash;clear é€‰é¡¹æ¸…ç©ºè™šæ‹Ÿç¯å¢ƒç­‰ã€‚ æ€»çš„æ¥è¯´ï¼ŒVirtualenv æ˜¯ Python ç”Ÿæ€ç³»ç»Ÿä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„å·¥å…·ï¼Œå®ƒæä¾›äº†ä¸€ç§æ–¹ä¾¿ã€å¿«æ·çš„è™šæ‹Ÿç¯å¢ƒç®¡ç†æ–¹å¼ï¼Œä¸º Python å¼€å‘è€…æä¾›äº†å¾ˆå¤šä¾¿åˆ©ã€‚åœ¨å…¶å‘å±•å†å²ä¸­ï¼ŒVirtualenv ä¸æ–­æ›´æ–°è¿­ä»£ï¼Œå¢åŠ äº†è®¸å¤šæ–°ç‰¹æ€§å’ŒåŠŸèƒ½ï¼Œä»¥é€‚åº” Python ç”Ÿæ€ç³»ç»Ÿçš„å˜åŒ–å’Œéœ€æ±‚ã€‚è™½ç„¶ç°åœ¨ Virtualenv å·²ç»ä¸å†ä¸»åŠ¨ç»´æŠ¤ï¼Œä½†å®ƒçš„ä»£ç è¢«é›†æˆåˆ°å…¶ä»–å·¥å…·ä¸­ï¼Œå¦‚ venv å’Œ pipenvï¼Œä»ç„¶ä¸º Python å¼€å‘è€…æä¾›åŸºç¡€æ”¯æŒã€‚\nvenv å‘å±•å†å² venv æ˜¯ç”± Python å®˜æ–¹å¼€å‘å›¢é˜Ÿå¼€å‘çš„ï¼Œå®ƒæ˜¯ Python 3.3 ç‰ˆæœ¬å¼•å…¥çš„æ ‡å‡†åº“æ¨¡å—ï¼Œç”¨äºåˆ›å»º Python è™šæ‹Ÿç¯å¢ƒã€‚\nPython çš„å®˜æ–¹æ–‡æ¡£ä¸­å¯¹ venv çš„ä»‹ç»å¦‚ä¸‹ï¼š\n\u0026ldquo;venv æ¨¡å—æä¾›äº† Python 3 ä¸­çš„è™šæ‹Ÿç¯å¢ƒæ”¯æŒã€‚è™šæ‹Ÿç¯å¢ƒæ˜¯ Python ç¯å¢ƒçš„éš”ç¦»å‰¯æœ¬ï¼ŒåŒ…æ‹¬ Python è§£é‡Šå™¨å’Œä¸€ä¸ªç‹¬ç«‹çš„åº“å‰¯æœ¬ã€‚è™šæ‹Ÿç¯å¢ƒé€šå¸¸ç”¨äºä¸ºä¸åŒçš„é¡¹ç›®åˆ›å»ºç‹¬ç«‹çš„ç¯å¢ƒï¼Œä»¥é¿å…é¡¹ç›®ä¹‹é—´çš„ä¾èµ–å†²çªã€‚\u0026rdquo;\nä¸ Virtualenv å’Œå…¶ä»–è™šæ‹Ÿç¯å¢ƒç®¡ç†å·¥å…·ä¸åŒï¼Œvenv æ˜¯ Python å®˜æ–¹æä¾›çš„æ ‡å‡†åº“æ¨¡å—ï¼Œå› æ­¤å®ƒçš„åŠŸèƒ½å’Œç”¨æ³•éƒ½ä¸ Python è§£é‡Šå™¨å¯†åˆ‡ç›¸å…³ï¼Œå¹¶ä¸”åœ¨ Python å®‰è£…æ—¶å·²ç»é¢„è£…äº† venv æ¨¡å—ï¼Œå› æ­¤ä¸éœ€è¦é¢å¤–å®‰è£…ã€‚\nåœ¨ä½¿ç”¨ venv åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨ç³»ç»Ÿä¸­å·²ç»å®‰è£…çš„ Python è§£é‡Šå™¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ venv æ¨¡å—è‡ªåŠ¨å®‰è£…ä¸€ä¸ªæ–°çš„ Python è§£é‡Šå™¨ã€‚åˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒå’Œå®ƒæ‰€ä¾èµ–çš„ Python åŒ…éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¼šä¸ç³»ç»Ÿä¸­çš„ Python ç¯å¢ƒå’Œå…¶ä»–è™šæ‹Ÿç¯å¢ƒäº§ç”Ÿå†²çªã€‚\nä»¥ä¸‹æ˜¯ venv çš„å‘å±•å†å²æ¦‚è¿°ï¼š\n2012 å¹´ï¼šPython 3.3 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¼•å…¥äº† venv æ ‡å‡†åº“ï¼Œç”¨äºåˆ›å»ºç‹¬ç«‹çš„ Python ç¯å¢ƒï¼Œå–ä»£äº† Python 2 ä¸­çš„ virtualenv å·¥å…·ã€‚\n2013 å¹´ï¼švenv 1.1 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.4 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ \u0026ndash;system-site-packages é€‰é¡¹å…±äº«ç³»ç»Ÿ Python åŒ…ã€æ”¯æŒä½¿ç”¨ \u0026ndash;copies é€‰é¡¹å¤åˆ¶ä¾èµ–åŒ…ç­‰ã€‚\n2014 å¹´ï¼švenv 1.2 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.5 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ \u0026ndash;clear é€‰é¡¹æ¸…ç©ºè™šæ‹Ÿç¯å¢ƒã€æ”¯æŒä½¿ç”¨ \u0026ndash;upgrade é€‰é¡¹æ›´æ–°åŒ…ç­‰ã€‚\n2015 å¹´ï¼švenv 1.3 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.6 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ \u0026ndash;prompt é€‰é¡¹è®¾ç½®è™šæ‹Ÿç¯å¢ƒæç¤ºç¬¦ã€æ”¯æŒä½¿ç”¨ \u0026ndash;without-pip é€‰é¡¹åˆ›å»ºä¸åŒ…å« pip çš„è™šæ‹Ÿç¯å¢ƒç­‰ã€‚\n2017 å¹´ï¼švenv 3.6.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.6 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ activate.csh å’Œ activate.fish è„šæœ¬ã€æ”¯æŒä½¿ç”¨ bin/python3 å‘½ä»¤å¯åŠ¨ Python è§£é‡Šå™¨ç­‰ã€‚\n2018 å¹´ï¼švenv 3.7.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.7 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ venv æ¨¡å—åˆ›å»ºè™šæ‹Ÿç¯å¢ƒã€æ”¯æŒä½¿ç”¨ ensurepip æ¨¡å—å®‰è£… pip ç­‰ã€‚\n2019 å¹´ï¼švenv 3.8.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.8 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ \u0026ndash;symlinks é€‰é¡¹åˆ›å»ºç¬¦å·é“¾æ¥è€Œéå¤åˆ¶æ–‡ä»¶ã€æ”¯æŒä½¿ç”¨ \u0026ndash;upgrade-deps é€‰é¡¹æ›´æ–°ä¾èµ–åŒ…ç­‰ã€‚\n2020 å¹´ï¼švenv 3.9.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.9 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ \u0026ndash;list é€‰é¡¹åˆ—å‡ºè™šæ‹Ÿç¯å¢ƒä¸­å·²å®‰è£…çš„åŒ…ã€æ”¯æŒä½¿ç”¨ \u0026ndash;upgrade é€‰é¡¹æ›´æ–° pip ç­‰ã€‚\n2021 å¹´ï¼švenv 3.10.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.10 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ \u0026ndash;symlink-to é€‰é¡¹æŒ‡å®šç¬¦å·é“¾æ¥ç›®å½•ã€æ”¯æŒä½¿ç”¨ \u0026ndash;prompt-cmd é€‰é¡¹è®¾ç½®è™šæ‹Ÿç¯å¢ƒæç¤ºç¬¦ç­‰ã€‚\nPyenv å‘å±•å†å² Pyenv æ˜¯ä¸€ä¸ª Python ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Œå¯ä»¥ç”¨äºåœ¨åŒä¸€ç³»ç»Ÿä¸­ç®¡ç†å¤šä¸ª Python ç‰ˆæœ¬ã€‚ä»¥ä¸‹æ˜¯ Pyenv çš„å‘å±•å†å²æ¦‚è¿°ï¼š\n2011 å¹´ï¼šPyenv 0.1.0 ç‰ˆæœ¬å‘å¸ƒï¼Œæœ€åˆç”± Yasuhiro Matsumoto å¼€å‘ã€‚è¿™ä¸ªç‰ˆæœ¬åªæ”¯æŒåœ¨ Bash shell ä¸­ä½¿ç”¨ã€‚ 2012 å¹´ï¼šPyenv 0.2.0 ç‰ˆæœ¬å‘å¸ƒï¼Œæ”¯æŒåœ¨å…¶ä»– shell ä¸­ä½¿ç”¨ï¼Œå¦‚ Zsh å’Œ Fishã€‚ 2013 å¹´ï¼šPyenv 0.4.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå¢åŠ äº†å¯¹ Python 3 çš„æ”¯æŒã€‚ 2014 å¹´ï¼šPyenv 0.4.1 ç‰ˆæœ¬å‘å¸ƒï¼Œå¢åŠ äº†å¯¹ Jython å’Œ Stackless Python çš„æ”¯æŒã€‚ 2015 å¹´ï¼šPyenv 1.0.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python çš„è§£é‡Šå™¨å’Œæ ‡å‡†åº“çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚å¢åŠ äº† pyenv virtualenv å‘½ä»¤æ¥ç®¡ç†è™šæ‹Ÿç¯å¢ƒã€å¢åŠ äº† pyenv whence å‘½ä»¤æ¥æŸ¥æ‰¾å¯æ‰§è¡Œæ–‡ä»¶çš„ä½ç½®ç­‰ã€‚ 2018 å¹´ï¼šPyenv 1.2.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå¢åŠ äº†å¯¹ PyPy3 çš„æ”¯æŒï¼Œå¹¶ä¿®å¤äº†ä¸€äº› bugã€‚ 2020 å¹´ï¼šPyenv 1.2.21 ç‰ˆæœ¬å‘å¸ƒï¼Œå¢åŠ äº†å¯¹ Python 3.9.0 çš„æ”¯æŒï¼Œå¹¶ä¿®å¤äº†ä¸€äº› bugã€‚ Pyenv çš„å‘å±•å†å²æ˜¾ç¤ºå‡ºå®ƒçš„é•¿æœŸç¨³å®šæ€§å’Œä¸æ–­æ”¹è¿›çš„è¶‹åŠ¿ï¼Œä»¥é€‚åº”ä¸æ–­å˜åŒ–çš„ Python ç”Ÿæ€ç³»ç»Ÿå’Œå¼€å‘è€…éœ€æ±‚ã€‚Pyenv çš„ä¸»è¦ç‰¹ç‚¹æ˜¯å¯ä»¥åœ¨åŒä¸€ç³»ç»Ÿä¸­ç®¡ç†å¤šä¸ª Python ç‰ˆæœ¬ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°åˆ‡æ¢ç‰ˆæœ¬ï¼Œä¹Ÿæ”¯æŒä½¿ç”¨è™šæ‹Ÿç¯å¢ƒæ¥éš”ç¦»ä¸åŒé¡¹ç›®çš„ä¾èµ–ã€‚Pyenv åœ¨ Python å¼€å‘è€…ç¤¾åŒºä¸­å¹¿å—æ¬¢è¿ï¼Œæ˜¯ä¸€ä¸ªä¸å¯æˆ–ç¼ºçš„å·¥å…·ä¹‹ä¸€ã€‚\nPipenv å‘å±•å†å² Pipenv æ˜¯åœ¨ 2017 å¹´ç”± Kenneth Reitz å¼€å‘çš„ Python é¡¹ç›®ä¾èµ–ç®¡ç†å·¥å…·ã€‚ä»¥ä¸‹æ˜¯ Pipenv çš„å‘å±•å†å²æ¦‚è¿°ï¼š\n2017 å¹´ï¼šPipenv 1.0.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒæ˜¯ç¬¬ä¸€ä¸ªç¨³å®šç‰ˆæœ¬ã€‚Pipenv ç»“åˆäº† pip å’Œ virtualenv çš„åŠŸèƒ½ï¼Œæä¾›äº†ä¸€ä¸ªæ›´ç®€å•çš„æ–¹å¼æ¥ç®¡ç† Python é¡¹ç›®ä¾èµ–ã€‚å®ƒè‡ªåŠ¨ä¸ºæ¯ä¸ªé¡¹ç›®åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œå¹¶ä½¿ç”¨ Pipfile å’Œ Pipfile.lock æ–‡ä»¶æ¥ç®¡ç†é¡¹ç›®ä¾èµ–ã€‚ 2018 å¹´ï¼šPipenv 2018.5.18 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†è®¸å¤šæ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ \u0026ndash;skip-lock é€‰é¡¹è·³è¿‡ç”Ÿæˆ Pipfile.lock æ–‡ä»¶ã€æ”¯æŒä½¿ç”¨ \u0026ndash;deploy é€‰é¡¹å®‰è£… Pipfile.lock æ–‡ä»¶ä¸­çš„ä¾èµ–ã€æ”¯æŒä½¿ç”¨ \u0026ndash;update é€‰é¡¹æ›´æ–°ä¾èµ–ç­‰ã€‚ 2019 å¹´ï¼šPipenv 2019.6.3 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.8 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ \u0026ndash;use-feature é€‰é¡¹å®‰è£…ä¾èµ–ã€æ”¯æŒä½¿ç”¨ \u0026ndash;outdated é€‰é¡¹æ˜¾ç¤ºè¿‡æœŸçš„ä¾èµ–ç­‰ã€‚ 2020 å¹´ï¼šPipenv 2020.6.2 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†æ”¯æŒä½¿ç”¨ \u0026ndash;python é€‰é¡¹æŒ‡å®š Python è§£é‡Šå™¨ç‰ˆæœ¬ã€æ”¯æŒä½¿ç”¨ \u0026ndash;pre é€‰é¡¹å®‰è£…é¢„è§ˆç‰ˆä¾èµ–ã€æ”¯æŒä½¿ç”¨ \u0026ndash;keep-outdated é€‰é¡¹ä¿ç•™è¿‡æœŸçš„ä¾èµ–ç­‰ã€‚ 2021 å¹´ï¼šPipenv 2021.5.29 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.10 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ \u0026ndash;platform é€‰é¡¹æŒ‡å®šå®‰è£…ä¾èµ–çš„å¹³å°ã€æ”¯æŒä½¿ç”¨ \u0026ndash;bundle é€‰é¡¹ç”Ÿæˆä¾èµ–åŒ…å‹ç¼©æ–‡ä»¶ç­‰ã€‚ Poetry å‘å±•å†å² Poetry æ˜¯ä¸€ä¸ªè¾ƒæ–°çš„ Python é¡¹ç›®ä¾èµ–ç®¡ç†å·¥å…·ï¼Œåœ¨ 2018 å¹´ç”± SÃ©bastien Eustace å¼€å‘ã€‚ä»¥ä¸‹æ˜¯ Poetry çš„å‘å±•å†å²æ¦‚è¿°ï¼š\n2018 å¹´ï¼šPoetry 0.1.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒæ˜¯ç¬¬ä¸€ä¸ªå…¬å¼€å‘å¸ƒçš„ç‰ˆæœ¬ã€‚Poetry é€šè¿‡ pyproject.toml æ–‡ä»¶æ¥ç®¡ç†é¡¹ç›®ä¾èµ–ï¼Œå¹¶ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒæ¥éš”ç¦»é¡¹ç›®ä¾èµ–ã€‚ 2019 å¹´ï¼šPoetry 0.12.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.8 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ \u0026ndash;lock é€‰é¡¹ç”Ÿæˆé”æ–‡ä»¶ã€æ”¯æŒä½¿ç”¨ \u0026ndash;develop é€‰é¡¹å®‰è£…å¼€å‘ä¾èµ–ç­‰ã€‚ 2020 å¹´ï¼šPoetry 1.0.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.9 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ \u0026ndash;experimental é€‰é¡¹å¯ç”¨å®éªŒæ€§åŠŸèƒ½ã€æ”¯æŒä½¿ç”¨ \u0026ndash;remove-untracked é€‰é¡¹åˆ é™¤æœªè·Ÿè¸ªçš„ä¾èµ–ç­‰ã€‚ 2021 å¹´ï¼šPoetry 1.2.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.10 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ \u0026ndash;workspace é€‰é¡¹ç®¡ç†å¤šä¸ªç›¸å…³é¡¹ç›®ã€æ”¯æŒä½¿ç”¨ \u0026ndash;source é€‰é¡¹æŒ‡å®šä¾èµ–æºç­‰ã€‚ Poetry çš„å‘å±•å†å²æ˜¾ç¤ºå‡ºå®ƒçš„å¿«é€Ÿå‘å±•å’Œä¸æ–­æ”¹è¿›çš„è¶‹åŠ¿ï¼Œä»¥é€‚åº”ä¸æ–­å˜åŒ–çš„ Python ç”Ÿæ€ç³»ç»Ÿå’Œå¼€å‘è€…éœ€æ±‚ã€‚Poetry ç›¸è¾ƒäº pipenv å’Œ virtualenv ç­‰å·¥å…·ï¼Œå®ƒæœ‰ç€æ›´åŠ ç®€æ´çš„é…ç½®æ–‡ä»¶å’Œæ›´åŠ æ˜“äºä½¿ç”¨çš„å‘½ä»¤è¡Œæ¥å£ï¼Œå› æ­¤åœ¨ Python å¼€å‘è€…ä¸­è¶Šæ¥è¶Šå—æ¬¢è¿ã€‚\nPdm å‘å±•å†å² PDM æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ–°çš„ Python é¡¹ç›®ä¾èµ–ç®¡ç†å·¥å…·ï¼Œç”±æè¾‰å¼€å‘ï¼Œå®ƒäº 2020 å¹´é¦–æ¬¡å‘å¸ƒã€‚ä»¥ä¸‹æ˜¯ PDM çš„å‘å±•å†å²æ¦‚è¿°ï¼š\n2020 å¹´ï¼šPDM 0.1.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒæ˜¯ç¬¬ä¸€ä¸ªå…¬å¼€å‘å¸ƒçš„ç‰ˆæœ¬ã€‚PDM ä½¿ç”¨ pyproject.toml æ–‡ä»¶æ¥ç®¡ç†é¡¹ç›®ä¾èµ–ï¼Œå¹¶ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒæ¥éš”ç¦»é¡¹ç›®ä¾èµ–ã€‚ä¸å…¶ä»–ä¾èµ–ç®¡ç†å·¥å…·ä¸åŒï¼ŒPDM å¯ä»¥ä½¿ç”¨å¤šä¸ªä¾èµ–æºï¼Œä»¥ä¾¿ä»ä¸åŒçš„æºå®‰è£…ä¾èµ–ã€‚ 2021 å¹´ï¼šPDM 1.0.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.10 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ \u0026ndash;edit é€‰é¡¹ç¼–è¾‘ä¾èµ–æ–‡ä»¶ã€æ”¯æŒä½¿ç”¨ \u0026ndash;update-prereleases é€‰é¡¹æ›´æ–°é¢„è§ˆç‰ˆä¾èµ–ç­‰ã€‚ 2022 å¹´ï¼šPDM 2.0.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.11 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ \u0026ndash;lockfile é€‰é¡¹æŒ‡å®šé”å®šæ–‡ä»¶ã€æ”¯æŒä½¿ç”¨ \u0026ndash;find-links é€‰é¡¹æŒ‡å®šä¾èµ–çš„æœ¬åœ°è·¯å¾„æˆ– URL ç­‰ã€‚ PDM çš„å‘å±•å†å²æ˜¾ç¤ºå‡ºå®ƒçš„å¿«é€Ÿå‘å±•å’Œä¸æ–­æ”¹è¿›çš„è¶‹åŠ¿ï¼Œä»¥é€‚åº”ä¸æ–­å˜åŒ–çš„ Python ç”Ÿæ€ç³»ç»Ÿå’Œå¼€å‘è€…éœ€æ±‚ã€‚PDM å…·æœ‰ç±»ä¼¼ Poetry çš„ç®€æ´é…ç½®æ–‡ä»¶å’Œæ˜“äºä½¿ç”¨çš„å‘½ä»¤è¡Œæ¥å£ï¼Œä½† PDM çš„å¤šæºæ”¯æŒå’Œä¾èµ–å¿«ç…§åŠŸèƒ½åˆ™æ˜¯å®ƒçš„ç‹¬ç‰¹ç‰¹ç‚¹ï¼Œè¿™äº›åŠŸèƒ½ä½¿å¾— PDM åœ¨ä¸€äº›ç‰¹å®šåœºæ™¯ä¸‹æ›´åŠ é€‚ç”¨ã€‚\nPyflow å‘å±•å†å² Pyflow æ˜¯å¦ä¸€ä¸ª Python é¡¹ç›®ä¾èµ–ç®¡ç†å·¥å…·ï¼Œäº 2016 å¹´é¦–æ¬¡å‘å¸ƒã€‚ä»¥ä¸‹æ˜¯ Pyflow çš„å‘å±•å†å²æ¦‚è¿°ï¼š\n2016 å¹´ï¼šPyflow 0.1.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒæ˜¯ç¬¬ä¸€ä¸ªå…¬å¼€å‘å¸ƒçš„ç‰ˆæœ¬ã€‚Pyflow ä½¿ç”¨ requirements.txt æ–‡ä»¶æ¥ç®¡ç†é¡¹ç›®ä¾èµ–ï¼Œå¹¶ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒæ¥éš”ç¦»é¡¹ç›®ä¾èµ–ã€‚ä¸å…¶ä»–ä¾èµ–ç®¡ç†å·¥å…·ä¸åŒï¼ŒPyflow æ”¯æŒè‡ªåŠ¨åŒ–çš„ä¾èµ–è§£å†³æ–¹æ¡ˆï¼Œä»¥ä¾¿æ›´è½»æ¾åœ°å®‰è£…å’Œæ›´æ–°ä¾èµ–ã€‚ 2017 å¹´ï¼šPyflow 0.3.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†è®¸å¤šæ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ \u0026ndash;editable é€‰é¡¹å®‰è£…å¯ç¼–è¾‘ä¾èµ–ã€æ”¯æŒä½¿ç”¨ \u0026ndash;pre é€‰é¡¹å®‰è£…é¢„è§ˆç‰ˆä¾èµ–ç­‰ã€‚ 2018 å¹´ï¼šPyflow 2.0.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ Pipfile.lock æ–‡ä»¶ç®¡ç†ä¾èµ–ã€æ”¯æŒåœ¨ Pipfile ä¸­ä½¿ç”¨å¤šä¸ªä¾èµ–æºç­‰ã€‚ å°½ç®¡ Pyflow çš„å¼€å‘å·²ç»åœæ­¢ï¼Œä½†æ˜¯å®ƒçš„ä¸€äº›æ€æƒ³å’Œç‰¹æ€§è¢«å…¶ä»–ä¾èµ–ç®¡ç†å·¥å…·æ‰€é‡‡çº³ï¼Œä¾‹å¦‚ Pipenv å’Œ Poetryã€‚Pyflow åœ¨å…¶æ—¶ä»£å†…æ›¾ç»æ˜¯ä¸€ä¸ªæœ‰å½±å“åŠ›çš„ä¾èµ–ç®¡ç†å·¥å…·ï¼Œå®ƒçš„è‡ªåŠ¨åŒ–ä¾èµ–è§£å†³æ–¹æ¡ˆã€è™šæ‹Ÿç¯å¢ƒåŠŸèƒ½å’Œå¤šä¸ªä¾èµ–æºç­‰ç‰¹æ€§ä¸ºåæ¥çš„ä¾èµ–ç®¡ç†å·¥å…·æä¾›äº†å¯ç¤ºã€‚\nConda å‘å±•å†å² Conda æ˜¯ä¸€ä¸ªå¼€æºçš„åŒ…ç®¡ç†ç³»ç»Ÿå’Œç¯å¢ƒç®¡ç†ç³»ç»Ÿï¼Œç”¨äºç®¡ç† Python åŒ…å’Œå…¶ä»–ç§‘å­¦è®¡ç®—ç›¸å…³çš„è½¯ä»¶åŒ…ã€‚ä»¥ä¸‹æ˜¯ Conda çš„å‘å±•å†å²ï¼š\n2012 å¹´ï¼ŒContinuum Analytics å…¬å¸å‘å¸ƒäº†ç¬¬ä¸€ä¸ªç‰ˆæœ¬çš„ Condaï¼Œç”¨äºç®¡ç† Python ç¯å¢ƒå’Œè½¯ä»¶åŒ…ã€‚\n2015 å¹´ï¼ŒConda å‘å¸ƒäº† 4.0 ç‰ˆæœ¬ï¼Œå¼•å…¥äº†è™šæ‹Ÿç¯å¢ƒå’Œäº¤å‰å¹³å°æ”¯æŒï¼Œæ”¯æŒ Pythonã€R å’Œå…¶ä»–è¯­è¨€çš„åŒ…ç®¡ç†ã€‚\n2016 å¹´ï¼ŒConda å‘å¸ƒäº† 4.2 ç‰ˆæœ¬ï¼Œå¼•å…¥äº† Conda Forgeï¼Œä¸€ä¸ªç¤¾åŒºé©±åŠ¨çš„è½¯ä»¶åŒ…ä»“åº“ï¼Œæä¾›äº†æ›´ä¸°å¯Œçš„è½¯ä»¶åŒ…å’Œæ›´å¿«çš„æ›´æ–°å‘¨æœŸã€‚\n2018 å¹´ï¼ŒConda å‘å¸ƒäº† 4.5 ç‰ˆæœ¬ï¼Œå¼•å…¥äº†å‘½ä»¤è¡Œç•Œé¢çš„æ”¹è¿›å’Œæ–°åŠŸèƒ½ï¼Œå¦‚ç¯å¢ƒå¿«é€Ÿå¤åˆ¶å’ŒåŒ…ä¾èµ–å…³ç³»çš„å¯è§†åŒ–ã€‚\n2019 å¹´ï¼ŒConda å‘å¸ƒäº† 4.6 ç‰ˆæœ¬ï¼Œå¼•å…¥äº†ç¯å¢ƒé”å®šå’Œè‡ªåŠ¨ç¯å¢ƒæ¿€æ´»åŠŸèƒ½ï¼Œæé«˜äº†ç¯å¢ƒç®¡ç†çš„æ•ˆç‡å’Œå¯é æ€§ã€‚\n2020 å¹´ï¼ŒAnaconda Inc. æ”¶è´­äº† Quansight å…¬å¸ï¼Œå¹¶å°†å…¶æ——ä¸‹çš„ Mamba åŒ…ç®¡ç†å™¨ä¸ Conda è¿›è¡Œæ•´åˆï¼Œæé«˜äº†åŒ…ç®¡ç†çš„é€Ÿåº¦å’Œç¨³å®šæ€§ã€‚\n2021 å¹´ï¼ŒConda å‘å¸ƒäº† 4.10 ç‰ˆæœ¬ï¼Œå¼•å…¥äº† Conda å¸‚åœºï¼Œä¸€ä¸ªç”¨æˆ·ç•Œé¢å‹å¥½çš„è½¯ä»¶åŒ…æœç´¢å’Œå®‰è£…å·¥å…·ï¼Œæä¾›äº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒå’Œç¤¾åŒºæ”¯æŒã€‚\næ€»ç»“ é¡¹ç›®ä¾èµ–ç®¡ç†å·¥å…·ï¼ˆè™šæ‹Ÿç¯å¢ƒï¼‰ï¼š\nå®˜æ–¹çš„ï¼š venv ä¸‰æ–¹çš„ï¼š virtualenv pyenv pipenv pyflow poetry pdm Conda åŒ…ç®¡ç†å·¥å…·ï¼š\nsetuptoolsï¼šåŒ…æ„å»º twineï¼šåŒ…ä¸Šä¼ å’Œå‘å¸ƒ pipï¼šåŒ…å®‰è£…å·¥å…· pypa/buildï¼šåŒ…æ„å»ºï¼Œç”¨äºæ›¿ä»£ setuptools ä¸‹é¢æ˜¯ pdmã€poetryã€pipenvã€venvã€virtualenvã€conda çš„ç®€è¦å¯¹æ¯”ï¼š\n1ã€pdmï¼š\nä¼˜ç‚¹ï¼š\næ”¯æŒ Pipfile.lock ç®¡ç†ä¾èµ–é¡¹ï¼Œå¯ä»¥ä¿è¯ä¾èµ–é¡¹çš„ç‰ˆæœ¬å’Œç¯å¢ƒçš„ä¸€è‡´æ€§ã€‚ è‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†è™šæ‹Ÿç¯å¢ƒï¼Œå¯ä»¥é¿å…ç¯å¢ƒå†²çªå’Œç‰ˆæœ¬é—®é¢˜ã€‚ è‡ªåŠ¨å®‰è£…ç¼ºå¤±çš„ç³»ç»Ÿä¾èµ–é¡¹ï¼Œå¯ä»¥é¿å…å‡ºç°ç¼ºå°‘ç³»ç»Ÿåº“å¯¼è‡´çš„é—®é¢˜ã€‚ è‡ªåŠ¨å®¡æŸ¥å®‰å…¨æ¼æ´ï¼Œå¯ä»¥é¿å…ä½¿ç”¨æœ‰å®‰å…¨æ¼æ´çš„ä¾èµ–é¡¹ã€‚ ç¼ºç‚¹ï¼š\nè¿˜æ¯”è¾ƒæ–°ï¼Œç”Ÿæ€ä¸å¤Ÿå®Œå–„ã€‚ æ²¡æœ‰åƒ poetry å’Œ pipenv é‚£æ ·æ”¯æŒå‘å¸ƒåŒ…åˆ° PyPIã€‚ 2ã€poetryï¼š\nä¼˜ç‚¹ï¼š\næ”¯æŒ pyproject.toml ç®¡ç†ä¾èµ–é¡¹ï¼Œå¯ä»¥ä¿è¯ä¾èµ–é¡¹çš„ç‰ˆæœ¬å’Œç¯å¢ƒçš„ä¸€è‡´æ€§ã€‚ è‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†è™šæ‹Ÿç¯å¢ƒï¼Œå¯ä»¥é¿å…ç¯å¢ƒå†²çªå’Œç‰ˆæœ¬é—®é¢˜ã€‚ è‡ªåŠ¨å®‰è£…ç¼ºå¤±çš„ç³»ç»Ÿä¾èµ–é¡¹ï¼Œå¯ä»¥é¿å…å‡ºç°ç¼ºå°‘ç³»ç»Ÿåº“å¯¼è‡´çš„é—®é¢˜ã€‚ è‡ªåŠ¨å®¡æŸ¥å®‰å…¨æ¼æ´ï¼Œå¯ä»¥é¿å…ä½¿ç”¨æœ‰å®‰å…¨æ¼æ´çš„ä¾èµ–é¡¹ã€‚ æ”¯æŒå‘å¸ƒåŒ…åˆ° PyPIã€‚ ç¼ºç‚¹ï¼š\næœ‰äº›äººè§‰å¾—é…ç½®æ¯”è¾ƒå¤æ‚ï¼Œå­¦ä¹ æ›²çº¿æ¯”è¾ƒé™¡å³­ã€‚ 3ã€pipenvï¼š\nä¼˜ç‚¹ï¼š\næ”¯æŒ Pipfile å’Œ Pipfile.lock ç®¡ç†ä¾èµ–é¡¹ï¼Œå¯ä»¥ä¿è¯ä¾èµ–é¡¹çš„ç‰ˆæœ¬å’Œç¯å¢ƒçš„ä¸€è‡´æ€§ã€‚ è‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†è™šæ‹Ÿç¯å¢ƒï¼Œå¯ä»¥é¿å…ç¯å¢ƒå†²çªå’Œç‰ˆæœ¬é—®é¢˜ã€‚ è‡ªåŠ¨å®‰è£…ç¼ºå¤±çš„ç³»ç»Ÿä¾èµ–é¡¹ï¼Œå¯ä»¥é¿å…å‡ºç°ç¼ºå°‘ç³»ç»Ÿåº“å¯¼è‡´çš„é—®é¢˜ã€‚ è‡ªåŠ¨å®¡æŸ¥å®‰å…¨æ¼æ´ï¼Œå¯ä»¥é¿å…ä½¿ç”¨æœ‰å®‰å…¨æ¼æ´çš„ä¾èµ–é¡¹ã€‚ æ”¯æŒå‘å¸ƒåŒ…åˆ° PyPIã€‚ ç¼ºç‚¹ï¼š\næœ‰äº›äººè§‰å¾—é€Ÿåº¦æ¯”è¾ƒæ…¢ã€‚ æœ‰äº›äººè§‰å¾—é…ç½®æ¯”è¾ƒå¤æ‚ï¼Œå­¦ä¹ æ›²çº¿æ¯”è¾ƒé™¡å³­ã€‚ 4ã€venvï¼š\nä¼˜ç‚¹ï¼š\nè‡ªå¸¦ Pythonï¼Œæ— éœ€å®‰è£…é¢å¤–çš„ä¾èµ–ã€‚ ç®€å•æ˜“ç”¨ï¼Œå‘½ä»¤è¡Œæ“ä½œæ–¹ä¾¿ã€‚ Python 3.3+ åè‡ªå¸¦ï¼Œä¸éœ€è¦å®‰è£…é¢å¤–çš„åº“ã€‚ ç¼ºç‚¹ï¼š\nåªæ”¯æŒ Python 3.3+ã€‚ éœ€è¦æ‰‹åŠ¨å®‰è£…ä¾èµ–é¡¹ã€‚ 5ã€virtualenvï¼š\nä¼˜ç‚¹ï¼š\næ”¯æŒ Python 2 å’Œ Python 3ã€‚ å¯ä»¥åœ¨åŒä¸€å°æœºå™¨ä¸Šåˆ›å»ºå¤šä¸ªè™šæ‹Ÿç¯å¢ƒï¼Œå¯ä»¥é¿å…ç¯å¢ƒå†²çªå’Œç‰ˆæœ¬é—®é¢˜ã€‚ å¯ä»¥åœ¨ä¸åŒçš„ Python ç‰ˆæœ¬ä¹‹é—´åˆ‡æ¢ã€‚ ç¼ºç‚¹ï¼š\néœ€è¦æ‰‹åŠ¨å®‰è£…ä¾èµ–é¡¹ã€‚ 6ã€condaï¼š\nä¼˜ç‚¹ï¼š\næ”¯æŒå¤šä¸ªæ“ä½œç³»ç»Ÿå’Œå¤šä¸ª Python ç‰ˆæœ¬ã€‚ å¯ä»¥ç®¡ç† Python ç¯å¢ƒå’Œé Python ç¯å¢ƒã€‚ å¯ä»¥ç®¡ç†ä¾èµ–é¡¹å’Œå®‰è£…åŒ…ã€‚ å¯ä»¥åˆ›å»ºå’Œç®¡ç†è™šæ‹Ÿç¯å¢ƒã€‚ æ”¯æŒå‘å¸ƒåŒ…åˆ° Anaconda Cloudã€‚ ç¼ºç‚¹ï¼š\nå®‰è£…åŒ…å¯èƒ½æ¯”è¾ƒå¤§ã€‚ æœ‰äº›äººè§‰å¾—é…ç½®æ¯”è¾ƒå¤æ‚ï¼Œå­¦ä¹ æ›²çº¿æ¯”è¾ƒé™¡å³­ã€‚ æ€»çš„æ¥è¯´ï¼Œè¿™äº›å·¥å…·éƒ½æœ‰å„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚å’Œä½¿ç”¨ä¹ æƒ¯é€‰æ‹©æœ€é€‚åˆè‡ªå·±çš„å·¥å…·ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/05/09/python-package-and-env-management/","summary":"å‘å±•å†å² Python åŒ…ç®¡ç†å·¥å…·æ˜¯ Python ç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå®ƒä»¬ä¸º Python å¼€å‘è€…æä¾›äº†æ–¹ä¾¿ã€å¿«æ·çš„åŒ…ç®¡ç†æ–¹å¼ã€‚ä»¥ä¸‹æ˜¯ Python åŒ…ç®¡ç†å·¥å…·çš„å‘å±•å†å²æ¦‚è¿°ï¼š\n1991 å¹´ï¼šPython è¯­è¨€é¦–æ¬¡å‘å¸ƒï¼ŒPython åŒ…ç®¡ç†å·¥å…·è¿˜æœªå‡ºç°ã€‚ 1998 å¹´ï¼šPython Distutils å·¥å…·å‘å¸ƒï¼Œå®ƒæ˜¯ Python çš„ç¬¬ä¸€ä¸ªåŒ…ç®¡ç†å·¥å…·ï¼Œå¯ä»¥ç”¨äºæ‰“åŒ…ã€å®‰è£…å’Œåˆ†å‘ Python åŒ…ã€‚ 2004 å¹´ï¼šeasy_install å·¥å…·å‘å¸ƒï¼Œå®ƒæ˜¯ä¸€ç§ç”¨äºå®‰è£…ã€å‡çº§å’Œå¸è½½ Python åŒ…çš„å·¥å…·ï¼Œå¯ä»¥è‡ªåŠ¨è§£æä¾èµ–å…³ç³»å¹¶å®‰è£…æ‰€éœ€çš„å…¶ä»–åŒ…ã€‚ 2007 å¹´ï¼špip å·¥å…·å‘å¸ƒï¼Œå®ƒæ˜¯ easy_install çš„ä¸€ä¸ªæ›¿ä»£å“ï¼Œæä¾›äº†æ›´å¥½çš„ä¾èµ–é¡¹è§£æã€å‡çº§å’Œå¸è½½åŠŸèƒ½ï¼Œä»¥åŠæ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚ 2012 å¹´ï¼šPython è½¯ä»¶åŸºé‡‘ä¼šå®£å¸ƒï¼Œpip å°†æˆä¸º Python åŒ…ç®¡ç†ç”Ÿæ€ç³»ç»Ÿä¸­çš„æ ‡å‡†å·¥å…·ï¼Œå–ä»£ easy_installã€‚ 2013 å¹´ï¼šWheel æ ¼å¼å‘å¸ƒï¼Œå®ƒæ˜¯ä¸€ç§ç”¨äºæ‰“åŒ…å’Œåˆ†å‘ Python åŒ…çš„æ ¼å¼ï¼Œå¯ä»¥åŒ…å« C æ‰©å±•æ¨¡å—ï¼Œå¹¶ä¸”æ”¯æŒå¤šå¹³å°å®‰è£…ã€‚ 2018 å¹´ï¼šPEP 517 å’Œ 518 å‘å¸ƒï¼Œå®ƒä»¬æä¾›äº†ä¸€ç§æ–°çš„ Python åŒ…æ„å»ºå’Œåˆ†å‘æ ‡å‡†ï¼Œå¯ä»¥ä½¿åŒ…æ„å»ºå’Œåˆ†å‘å˜å¾—æ›´åŠ ç®€å•å’Œå¯é ã€‚ 2018 å¹´ï¼šflit å·¥å…·å‘å¸ƒï¼Œå®ƒæ˜¯ä¸€ç§ç®€å•çš„ Python åŒ…æ„å»ºå’Œåˆ†å‘å·¥å…·ï¼Œå¯ä»¥é€šè¿‡ pyproject.toml æ–‡ä»¶æ¥é…ç½®åŒ…çš„å…ƒæ•°æ®å’Œä¾èµ–é¡¹ã€‚ 2019 å¹´ï¼špoetry å·¥å…·å‘å¸ƒï¼Œå®ƒæ˜¯ä¸€ç§ä¸“æ³¨äºä¾èµ–ç®¡ç†å’Œé¡¹ç›®æ„å»ºçš„ Python åŒ…ç®¡ç†å·¥å…·ï¼Œå¯ä»¥è‡ªåŠ¨è§£æä¾èµ–å…³ç³»ã€æ„å»ºé¡¹ç›®ã€ç”Ÿæˆ lock æ–‡ä»¶ç­‰ã€‚ 2020 å¹´ï¼šPEP 621 å‘å¸ƒï¼Œå®ƒæ˜¯ä¸€ç§æ–°çš„ Python åŒ…å…ƒæ•°æ®æ ‡å‡†ï¼Œå¯ä»¥ç”¨äºå®šä¹‰ Python åŒ…çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¦‚åç§°ã€ç‰ˆæœ¬ã€ä½œè€…ã€è®¸å¯è¯ç­‰ã€‚ 2020 å¹´ï¼šPEP 636 å‘å¸ƒï¼Œå®ƒæ˜¯ä¸€ç§æ–°çš„ CPython æ‰©å±•æ¨¡å—å…ƒæ•°æ®æ ‡å‡†ï¼Œå¯ä»¥ç”¨äºå®šä¹‰ CPython æ‰©å±•æ¨¡å—çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¦‚åç§°ã€ç‰ˆæœ¬ã€ä½œè€…ã€è®¸å¯è¯ç­‰ã€‚ 2021 å¹´ï¼šflit 3 å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ PEP 621 å’Œ PEP 636 çš„æ”¯æŒï¼Œå¯ä»¥ä½¿ç”¨ pyproject.toml æ–‡ä»¶æ¥å®šä¹‰ Python åŒ…å’Œ CPython æ‰©å±•æ¨¡å—çš„å…ƒæ•°æ®ä¿¡æ¯ã€‚ PyPA æ˜¯ Python Packaging Authority çš„ç¼©å†™ï¼Œå³ Python åŒ…ç®¡ç†æƒå¨ç»„ç»‡ã€‚PyPA çš„ç›®æ ‡æ˜¯ä¸º Python ç¤¾åŒºæä¾›ä¸€ä¸ªæ ‡å‡†çš„ã€æ˜“äºä½¿ç”¨çš„åŒ…ç®¡ç†å·¥å…·å’Œç›¸å…³å·¥å…·çš„ç”Ÿæ€ç³»ç»Ÿï¼Œå¹¶æä¾›ç›¸å…³çš„æ–‡æ¡£å’Œè§„èŒƒã€‚","title":"PythonåŒ…å’Œç¯å¢ƒç®¡ç†"},{"content":"æœ€è¿‘å¼€å§‹å­¦ä¹  pythonï¼Œè¿™ç¯‡æ–‡ç« è®°å½•å¦‚ä½•å®‰è£… pythonã€æ­å»º python å¼€å‘ç¯å¢ƒï¼Œä»¥åŠå¦‚ä½•æ„å»ºã€å‘å¸ƒ python åŒ…ã€‚æˆ‘ä½¿ç”¨çš„æ˜¯ macos ç³»ç»Ÿï¼Œæ‰€ä»¥æœ¬ç¯‡æ–‡ç« ä¸­çš„ä¸€äº›å‘½ä»¤æ˜¯åŸºäº macos ï¼Œç‰¹æ­¤è¯´æ˜ã€‚\n1ã€å®‰è£… MacOS ä¸Šé€šè¿‡ brew å®‰è£… Python3ï¼š\nbrew install python3 æŸ¥çœ‹ python3 å®‰è£…è·¯å¾„ï¼š\n$ which python3 /opt/homebrew/bin/python3 $ type python3 python3 is /opt/homebrew/bin/python3 æŸ¥çœ‹ç‰ˆæœ¬ï¼š\npython --version è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ zshï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹ ~/.zshrcï¼Œæ·»åŠ ä¸‹é¢ä»£ç ï¼š\nexport PYTHON_HOME=/opt/homebrew/opt/python@3.11 export PATH=$PYTHON_HOME/bin:$PATH alias python=python3 alias pip=pip3 ä½¿é…ç½®ç”Ÿæ•ˆï¼š\nsource ~/.zshrc 2ã€åˆ›å»ºé¡¹ç›® åˆ›å»ºä¸€ä¸ªç›®å½• chensoul_helloï¼š\nmkdir chensoul_hello cd chensoul_hello åˆ›å»ºä¸€ä¸ª main.py ï¼Œæ‰“å° helloworldï¼š\nprint(\u0026#34;hello world\u0026#34;) è¯•è¯•è¿è¡Œ main.pyï¼š\npython main.py 3ã€åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ ä½¿ç”¨ python venv æ¨¡å—åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ .venvï¼š\npython -m venv .venv ä½¿ç”¨ . å¼€å¤´çš„ç›®å½•æˆ–è€…æ–‡ä»¶ä¸ºéšè—æ–‡ä»¶ã€‚å¦‚æœä½¿ç”¨ git ç®¡ç†é¡¹ç›®ï¼Œåˆ™éœ€è¦å°† .venv æ·»åŠ åˆ° .gitignoreã€‚\næ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼š\nsource .venv/bin/activate 4ã€ä½¿ç”¨ setuptools ç®¡ç†é¡¹ç›® setuptools æ˜¯ Python çš„ä¸€ä¸ªåŒ…ç®¡ç†å·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´æ–¹ä¾¿åœ°æ‰“åŒ…å’Œå‘å¸ƒ Python ä»£ç ã€‚setuptools æä¾›äº†ä¸€äº›å‘½ä»¤è¡Œå·¥å…·ï¼Œä¾‹å¦‚ easy_install å’Œ setup.pyã€‚\nsetup.py æ–‡ä»¶æ˜¯ setuptools ç”¨äºæ„å»ºã€æ‰“åŒ…å’Œå‘å¸ƒ Python åŒ…çš„æ ¸å¿ƒæ–‡ä»¶ä¹‹ä¸€ã€‚é€šè¿‡ setup.py æ–‡ä»¶ï¼Œå¼€å‘äººå‘˜å¯ä»¥æŒ‡å®šåŒ…çš„å…ƒæ•°æ®ã€ä¾èµ–å…³ç³»ã€å®‰è£…è„šæœ¬ç­‰ä¿¡æ¯ï¼Œä»è€Œå®ç°åŒ…çš„å®‰è£…ã€å‡çº§å’Œå¸è½½ç­‰æ“ä½œã€‚\nå…·ä½“æ¥è¯´ï¼Œsetup.py æ–‡ä»¶é€šå¸¸åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š\nåŒ…çš„å…ƒæ•°æ®ï¼Œä¾‹å¦‚åŒ…çš„åç§°ã€ç‰ˆæœ¬å·ã€ä½œè€…ã€è®¸å¯è¯ç­‰ä¿¡æ¯ã€‚ åŒ…çš„ä¾èµ–å…³ç³»ï¼Œä¾‹å¦‚éœ€è¦ä¾èµ–å“ªäº›å…¶ä»– Python åŒ…ã€‚ åŒ…çš„å®‰è£…è„šæœ¬ï¼Œä¾‹å¦‚éœ€è¦å®‰è£…å“ªäº›æ–‡ä»¶ã€è„šæœ¬ç­‰ã€‚ å…¶ä»–è‡ªå®šä¹‰çš„æ„å»ºå’Œå‘å¸ƒé€‰é¡¹ï¼Œä¾‹å¦‚æ–‡æ¡£ç”Ÿæˆã€å‘½ä»¤è¡Œå·¥å…·çš„ç”Ÿæˆç­‰ã€‚ é€šè¿‡è¿è¡Œ python setup.py å‘½ä»¤ï¼Œå¯ä»¥æ‰§è¡Œä¸€ç³»åˆ—æ“ä½œï¼Œä¾‹å¦‚å°†åŒ…æ„å»ºä¸ºæºä»£ç æˆ–äºŒè¿›åˆ¶åˆ†å‘åŒ…ã€å°†å…¶ä¸Šä¼ åˆ° PyPI æˆ–å…¶ä»–åŒ…ä»“åº“ã€å®‰è£…åŒ…åˆ°æœ¬åœ°ç³»ç»Ÿç­‰ã€‚åŒæ—¶ï¼Œsetuptools è¿˜æä¾›äº†ä¸€äº›åŠŸèƒ½ï¼Œä¾‹å¦‚è‡ªåŠ¨åŒ–ä¾èµ–å…³ç³»ç®¡ç†ã€ç‰ˆæœ¬æ§åˆ¶ã€å‘½ä»¤è¡Œå·¥å…·çš„ç”Ÿæˆå’Œæ–‡æ¡£çš„ç”Ÿæˆç­‰ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´åŠ é«˜æ•ˆåœ°è¿›è¡Œ Python å¼€å‘ã€‚\n1ã€å®‰è£… setuptools\npip install setuptools 2ã€åˆ›å»º setup.py æ–‡ä»¶\nåœ¨ä½¿ç”¨ setuptools æ—¶ï¼Œé€šå¸¸éœ€è¦åˆ›å»ºä¸€ä¸ª setup.py æ–‡ä»¶ï¼Œç”¨æ¥æè¿°åŒ…çš„ä¿¡æ¯ã€ä¾èµ–å…³ç³»å’Œå®‰è£…æ–¹å¼ç­‰ã€‚setup.py æ–‡ä»¶é€šå¸¸åŒ…å«ä¸€ä¸ª setup() å‡½æ•°ï¼Œç”¨æ¥å®šä¹‰åŒ…çš„å…ƒæ•°æ®å’Œä¾èµ–å…³ç³»ç­‰ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š\nfrom setuptools import setup, find_packages setup( name=\u0026#39;chensoul_hello\u0026#39;, version=\u0026#39;1.0.0\u0026#39;, author=\u0026#39;chensoul\u0026#39;, author_email=\u0026#39;chensoul@chensoul.cc\u0026#39;, description=\u0026#39;A simple Python package\u0026#39;, packages=find_packages(), install_requires=[ \u0026#39;numpy\u0026gt;=1.16.0\u0026#39;, \u0026#39;pandas\u0026gt;=0.23.4\u0026#39;, ], entry_points={ \u0026#39;console_scripts\u0026#39;: [ \u0026#39;hello_command=chensoul_hello.cli:main\u0026#39;, ], }, ) è¿™ä¸ª setup.py æ–‡ä»¶å®šä¹‰äº†ä¸€ä¸ªåä¸º chensoul_hello çš„ Python åŒ…ï¼ŒæŒ‡å®šäº†åŒ…çš„å…ƒæ•°æ®ã€ä¾èµ–å…³ç³»ç­‰ä¿¡æ¯ã€‚\nnameï¼šåŒ…çš„åç§°ã€‚ versionï¼šåŒ…çš„ç‰ˆæœ¬å·ã€‚ authorï¼šåŒ…çš„ä½œè€…ã€‚ author_emailï¼šä½œè€…çš„ç”µå­é‚®ä»¶åœ°å€ã€‚ descriptionï¼šåŒ…çš„ç®€è¦æè¿°ã€‚ packagesï¼šåŒ…å«éœ€è¦æ‰“åŒ…çš„ Python åŒ…çš„åˆ—è¡¨ï¼Œä½¿ç”¨ find_packages() å‡½æ•°å¯ä»¥è‡ªåŠ¨æŸ¥æ‰¾æ‰€æœ‰åŒ…ã€‚ install_requiresï¼šåŒ…ä¾èµ–çš„å…¶ä»– Python åŒ…ã€‚ console_scriptsï¼š æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œç”¨äºå®šä¹‰åŒ…ä¸­çš„å‘½ä»¤è¡Œå·¥å…·ã€‚å®ƒæ˜¯ä¸€ä¸ªå­—å…¸ï¼Œé”®æ˜¯å‘½ä»¤çš„åç§°ï¼Œå€¼æ˜¯å‘½ä»¤å¯¹åº”çš„å…¥å£ç‚¹ï¼ˆentry pointï¼‰ã€‚å…¥å£ç‚¹æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé€šå¸¸æ˜¯æ¨¡å—åå’Œå‡½æ•°åçš„ç»„åˆï¼Œä¾‹å¦‚ \u0026ldquo;chensoul_hello.cli:main\u0026rdquo;ï¼Œè¡¨ç¤ºè°ƒç”¨ chensoul_hello åŒ…ä¸­çš„ cli æ¨¡å—çš„ main å‡½æ•°ã€‚å½“ä½¿ç”¨ setuptools å®‰è£…åŒ…æ—¶ï¼Œconsole_scripts ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶å°†å…¥å£ç‚¹æŒ‡å‘è¯¥æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶é€šå¸¸è¢«æ”¾åœ¨ Python çš„ bin ç›®å½•ä¸‹ï¼Œä¾‹å¦‚ /usr/local/binã€‚ å¯¹äºä¸Šé¢çš„ä¾‹å­ï¼Œå¦‚æœæƒ³è¦åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ hello_command å‘½ä»¤ï¼Œéœ€è¦åˆ›å»ºåä¸º \u0026ldquo;chensoul_hello\u0026rdquo; çš„ Python åŒ…ï¼š\nåˆ›å»ºä¸€ä¸ªåä¸º \u0026ldquo;chensoul_hello\u0026rdquo; çš„æ–‡ä»¶å¤¹ï¼Œå¹¶è¿›å…¥è¯¥æ–‡ä»¶å¤¹ã€‚\nåœ¨ \u0026ldquo;chensoul_hello\u0026rdquo; æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º __init__.py çš„ç©ºæ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶ç”¨äºæŒ‡ç¤º Python è§£é‡Šå™¨è¯¥æ–‡ä»¶å¤¹æ˜¯ä¸€ä¸ª Python åŒ…ã€‚\nmkdir chensoul_hello cd chensoul_hello touch __init__.py åœ¨ \u0026ldquo;chensoul_hello\u0026rdquo; æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º cli.py çš„æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶ç”¨äºå®šä¹‰å‘½ä»¤è¡Œè„šæœ¬çš„å…¥å£å‡½æ•°ã€‚åœ¨ cli.py æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š\ndef main(): print(\u0026#34;Hello, world!\u0026#34;) 5ã€ä½¿ç”¨ setuptools æ„å»ºåŒ… åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æ„å»ºæºç åˆ†å‘åŒ…ï¼š\npython setup.py sdist æˆ–è€…ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æ„å»ºäºŒè¿›åˆ¶ wheel åŒ…ï¼š\npython setup.py bdist_wheel åœ¨æ‰§è¡Œä¸Šé¢ä¸¤ä¸ªå‘½ä»¤ä¹‹å‰ï¼Œéœ€è¦ç¡®ä¿å·²ç»å®‰è£…äº† setuptools å’Œ wheelã€‚å¦‚æœæ²¡æœ‰å®‰è£…ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š\npip install setuptools wheel ä¹Ÿå¯ä»¥ä¸€èµ·æ‰§è¡Œï¼š\npython setup.py sdist bdist_wheel æ‰§è¡Œå®Œæˆåï¼Œä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆ dist ç›®å½•ï¼Œå¹¶åœ¨å…¶ä¸­ç”Ÿæˆä¸¤ä¸ªåŒ…æ–‡ä»¶ï¼šä¸€ä¸ªæºä»£ç åŒ…å’Œä¸€ä¸ªäºŒè¿›åˆ¶åŒ…ã€‚è¿™ä¸¤ä¸ªåŒ…æ–‡ä»¶å¯ä»¥é€šè¿‡ pip å®‰è£…ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å°†å®ƒä»¬æ‹·è´åˆ°å…¶ä»–æœºå™¨ä¸Šä½¿ç”¨ã€‚\n6ã€ä½¿ç”¨ twine å‘å¸ƒåŒ… twine æ˜¯ä¸€ä¸ª Python åŒ…ï¼Œç”¨äºå°† Python åŒ…ä¸Šä¼ åˆ° PyPI æˆ–å…¶ä»–ç±»ä¼¼çš„åŒ…ä»“åº“ã€‚å®ƒå¯ä»¥å¸®åŠ©ä½ å°†æ‰“åŒ…å¥½çš„ Python åŒ…ä¸Šä¼ åˆ° PyPI æœåŠ¡å™¨æˆ–å…¶ä»–ç±»ä¼¼çš„æœåŠ¡å™¨ã€‚\nå®‰è£… twine åœ¨ç»ˆç«¯æˆ–å‘½ä»¤è¡Œä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£… twineï¼š\npip install twine æ‰“åŒ… Python åŒ… å¦‚æœä½ å·²ç»ä½¿ç”¨ setuptools æ„å»ºäº†æºç åˆ†å‘åŒ…æˆ–äºŒè¿›åˆ¶ wheel åŒ…ï¼Œå¯ä»¥ä½¿ç”¨ wheel å·¥å…·æ¥å°†å…¶è½¬æ¢ä¸º wheel åŒ…æˆ–ä¸Šä¼ åˆ° PyPI æˆ–å…¶ä»–æ”¯æŒçš„åŒ…ä»“åº“ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†æºç åˆ†å‘åŒ…è½¬æ¢ä¸º wheel åŒ…ï¼š\npip wheel dist/chensoul_hello-1.0.0.tar.gz æ³¨å†Œè´¦å· åœ¨ä¸Šä¼ åŒ…ä¹‹å‰ï¼Œä½ éœ€è¦æ³¨å†Œä¸€ä¸ª PyPI è´¦å·ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰æ³¨å†Œï¼Œè¯·è®¿é—® PyPI ç½‘ç«™ï¼ˆhttps://pypi.org/account/register/ï¼‰è¿›è¡Œæ³¨å†Œã€‚\nåœ¨ä½¿ç”¨ twine å·¥å…·ä¸Šä¼ åŒ…æ—¶ï¼Œéœ€è¦å…ˆåœ¨ PyPI ç½‘ç«™ä¸Šæ³¨å†Œè´¦å·å¹¶è·å–ä¸Šä¼ å‡­è¯ï¼ˆä¾‹å¦‚ API å¯†é’¥æˆ–ç”¨æˆ·åå¯†ç ï¼‰ï¼Œç„¶åå°†å‡­è¯ä¿å­˜åœ¨æœ¬åœ°çš„ $HOME/.pypirc æ–‡ä»¶ä¸­ã€‚\n[pypi] username = __token__ password = pypi-XXXXXX ä¸Šä¼  Python åŒ… twine å·¥å…·æ”¯æŒä¸Šä¼ åˆ°ä»¥ä¸‹åŒ…ä»“åº“ï¼š\nPyPIï¼ˆPython Package Indexï¼‰ï¼šPyPI æ˜¯ Python ç¤¾åŒºçš„å®˜æ–¹åŒ…ä»“åº“ï¼Œæä¾›äº†å¤§é‡çš„ Python åŒ…ä¾›ç”¨æˆ·ä¸‹è½½å’Œä½¿ç”¨ã€‚PyPI ä½¿ç”¨ https://pypi.org/ ä½œä¸ºå®˜æ–¹ç½‘ç«™ï¼Œå¯ä»¥ä½¿ç”¨ twine å·¥å…·å°†åŒ…ä¸Šä¼ åˆ° PyPIã€‚\nTest PyPIï¼šTest PyPI æ˜¯ PyPI çš„ä¸€ä¸ªæµ‹è¯•ç¯å¢ƒï¼Œç”¨äºæµ‹è¯•å’ŒéªŒè¯åŒ…çš„ä¸Šä¼ å’Œåˆ†å‘è¿‡ç¨‹ã€‚Test PyPI ä½¿ç”¨ https://test.pypi.org/ ä½œä¸ºå®˜æ–¹ç½‘ç«™ï¼Œå¯ä»¥ä½¿ç”¨ twine å·¥å…·å°†åŒ…ä¸Šä¼ åˆ° Test PyPIã€‚\nä»»ä½•æ”¯æŒ twine æ ¼å¼çš„åŒ…ä»“åº“ï¼štwine å·¥å…·æ”¯æŒå°†åŒ…ä¸Šä¼ åˆ°ä»»ä½•æ”¯æŒ twine æ ¼å¼çš„åŒ…ä»“åº“ï¼Œåªéœ€è¦æŒ‡å®šåŒ…ä»“åº“çš„ URL å’Œå‡­è¯å³å¯ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ twine å·¥å…·å°†åŒ…ä¸Šä¼ åˆ°è‡ªå·±çš„ç§æœ‰åŒ…ä»“åº“æˆ–ç¬¬ä¸‰æ–¹åŒ…ä»“åº“ã€‚\nä¾‹å¦‚ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†ä¸€ä¸ª wheel åŒ…ä¸Šä¼ åˆ° PyPIï¼š\n$ twine upload dist/chensoul_hello-1.0.0-py3-none-any.whl Enter your username: __token__ Enter your password: æˆ–è€…ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†ä¸€ä¸ªæºç åˆ†å‘åŒ…ä¸Šä¼ åˆ° PyPIï¼š\ntwine upload dist/chensoul_hello-1.0.0.tar.gz åŒæ—¶ä¸Šä¼  wheel åŒ…å’Œæºç ï¼š\ntwine upload dist/* è¿™ä¸ªå‘½ä»¤å°†ä¼šä¸Šä¼  dist ç›®å½•ä¸‹çš„æ‰€æœ‰åŒ…åˆ° Test PyPIã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šä¼ åˆ°ä¸åŒçš„åŒ…ä»“åº“å¯èƒ½éœ€è¦ä¸åŒçš„å‘½ä»¤å’Œå‚æ•°ï¼Œå…·ä½“å¯ä»¥å‚è€ƒåŒ…ä»“åº“çš„æ–‡æ¡£æˆ–å¸®åŠ©ä¿¡æ¯ã€‚\ntwine upload --repository-url https://test.pypi.org/legacy/ dist/* å¦‚æœä¸Šä¼ æ—¶æç¤ºé”™è¯¯ï¼š\nUploading distributions to https://upload.pypi.org/legacy/ Uploading chensoul_hello-1.0.0-py3-none-any.whl 100% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 4.5/4.5 kB â€¢ 00:00 â€¢ ? WARNING Error during upload. Retry with the --verbose option for more details. ERROR HTTPError: 403 Forbidden from https://upload.pypi.org/legacy/ The user \u0026#39;chensoul\u0026#39; isn\u0026#39;t allowed to upload to project \u0026#39;my-package\u0026#39;. See https://pypi.org/help/#project-name for more information. åŸå› æ˜¯é¡¹ç›®åç§° my-package ä¸åˆæ³•æˆ–è€…å·²å­˜åœ¨ï¼Œéœ€è¦ä¿®æ”¹åŒ…åç§°ã€‚\nå¦‚æœé¡¹ç›®å·²ç»å­˜åœ¨ï¼Œåˆ™å¯ä»¥æ·»åŠ å‚æ•°è¦†ç›–å·²ç»å­˜åœ¨çš„é¡¹ç›®ï¼š\ntwine upload dist/* --skip-existing 7ã€ä½¿ç”¨ pip å®‰è£…åŒ… å¦‚æœä½ æƒ³å®‰è£…ã€å‡çº§æˆ–åˆ é™¤ Python åŒ…ï¼Œå¯ä»¥ä½¿ç”¨ pip å·¥å…·æ¥è¿›è¡Œæ“ä½œã€‚\nä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…æœ¬åœ°çš„åŒ…ï¼š\npip install dist/chensoul_hello-1.0.0.tar.gz æˆ–è€…å®‰è£…æœ¬åœ°çš„ wheel åŒ…ï¼š\npip install dist/chensoul_hello-1.0.0-py3-none-any.whl ä¹Ÿå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥ä»ä»“åº“ä¸­å®‰è£…ä¸€ä¸ªåŒ…åŠå…¶ä¾èµ–é¡¹ï¼š\npip install chensoul_hello æŸ¥çœ‹æœ¬åœ°ä¸‹è½½çš„å®‰è£…åŒ…ï¼š\n$ pip list|grep chensoul-hello chensoul-hello 1.0.0 åœ¨ä½¿ç”¨ setuptools æ„å»º Python åŒ…æ—¶ï¼ŒåŒ…ååº”è¯¥ç¬¦åˆ Python åŒ…å‘½åè§„èŒƒã€‚å…·ä½“æ¥è¯´ï¼ŒåŒ…ååº”è¯¥åªåŒ…å«å°å†™å­—æ¯ã€æ•°å­—å’ŒçŸ­æ¨ªçº¿ -ï¼Œä¸èƒ½åŒ…å«å…¶ä»–å­—ç¬¦ï¼ŒåŒ…ååº”è¯¥ä»¥å­—æ¯å¼€å¤´ï¼Œå¹¶ä¸”ä¸èƒ½è¶…è¿‡ 32 ä¸ªå­—ç¬¦ã€‚\nå¦å¤–ï¼Œå¦‚æœä½ åœ¨åŒ…åä¸­ä½¿ç”¨äº†çŸ­æ¨ªçº¿ -ï¼Œåœ¨å¼•ç”¨åŒ…æ—¶éœ€è¦å°†å…¶æ›¿æ¢æˆä¸‹åˆ’çº¿ _ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„åŒ…åä¸º chensoul-helloï¼Œåœ¨å¼•ç”¨åŒ…æ—¶åº”è¯¥ä½¿ç”¨ import chensoul_helloã€‚\næ€»ä¹‹ï¼Œåœ¨ä½¿ç”¨ setuptools æ„å»º Python åŒ…æ—¶ï¼ŒåŒ…ååº”è¯¥ç¬¦åˆ Python åŒ…å‘½åè§„èŒƒï¼Œå¹¶ä¸”å¦‚æœåŒ…åä¸­åŒ…å«çŸ­æ¨ªçº¿ -ï¼Œåœ¨å¼•ç”¨åŒ…æ—¶åº”è¯¥ä½¿ç”¨ä¸‹åˆ’çº¿ _ã€‚\nå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯¼å‡ºå½“å‰ç¯å¢ƒä¸­çš„æ‰€æœ‰ä¾èµ–é¡¹åˆ—è¡¨åˆ° requirements.txt æ–‡ä»¶ä¸­ï¼š\npip freeze \u0026gt; requirements.txt å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ ¹æ® requirements.txt æ–‡ä»¶ä¸­çš„ä¾èµ–é¡¹åˆ—è¡¨å®‰è£…åŒ…ï¼š\npip install -r requirements.txt 8ã€è¿è¡Œå‘½ä»¤ $ hello_command Hello, world! 9ã€ä½¿ç”¨ pypa/build æ„å»ºåŒ… æ‰§è¡Œä¸‹é¢å‘½ä»¤æ—¶ï¼š\npython setup.py bdist_wheel å‡ºç°ä¸€ä¸ªè­¦å‘Šï¼š\n******************************************************************************** Please avoid running ``setup.py`` directly. Instead, use pypa/build, pypa/installer, pypa/build or other standards-based tools. See https://blog.ganssle.io/articles/2021/10/setup-py-deprecated.html for details. ******************************************************************************** pypa/build å’Œ pypa/installer æ˜¯ Python Packaging Authorityï¼ˆPyPAï¼‰ç»´æŠ¤çš„ä¸¤ä¸ªå·¥å…·ï¼Œåˆ†åˆ«ç”¨äºæ„å»ºå’Œå®‰è£… Python åŒ…ã€‚pypa/build å°±æ˜¯ build æ¨¡å—ï¼Œè€Œ pypa/installer å°±æ˜¯ pipã€‚\nä¸‹é¢æ˜¯å®ƒä»¬çš„ä½¿ç”¨æ–¹æ³•ï¼š\nå®‰è£… pypa/build å·¥å…·ï¼š\npip install build è¿è¡Œä»¥ä¸‹å‘½ä»¤æ„å»ºåŒ…ï¼š\npython -m build python -m build æ˜¯ä¸€ä¸ªç”¨äºæ„å»º Python åŒ…çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå®ƒæ˜¯ Python 3.10 ä¸­æ–°å¢çš„æ ‡å‡†åº“æ¨¡å— build çš„å…¥å£ç‚¹ã€‚ä½¿ç”¨ python -m build å¯ä»¥æ–¹ä¾¿åœ°æ„å»ºæºä»£ç å‘è¡ŒåŒ…å’ŒäºŒè¿›åˆ¶å‘è¡ŒåŒ…ï¼Œæ”¯æŒå¤šç§æ ¼å¼ï¼ŒåŒ…æ‹¬ sdistã€wheelã€zipã€tar ç­‰ã€‚\nåœ¨ä½¿ç”¨ python -m build æ„å»º Python åŒ…ä¹‹å‰ï¼Œéœ€è¦ç¡®ä¿ä½ çš„é¡¹ç›®ç¬¦åˆ Python åŒ…çš„æ ‡å‡†ã€‚å…·ä½“æ¥è¯´ï¼Œä½ éœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª setup.cfg æ–‡ä»¶å’Œä¸€ä¸ª setup.py æ–‡ä»¶ï¼Œå…¶ä¸­ setup.cfg æ–‡ä»¶åŒ…å«é¡¹ç›®å…ƒæ•°æ®å’Œæ„å»ºé€‰é¡¹ï¼Œsetup.py æ–‡ä»¶åŒ…å«æ„å»ºå’Œæ‰“åŒ…çš„å…·ä½“å®ç°ã€‚\nå¦‚æœéœ€è¦å‘å¸ƒåŒ…åˆ° PyPI æˆ–å…¶ä»–åŒ…ä»“åº“ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š\ntwine upload dist/* 10ã€é™„å½• pypa/build å’Œ setuptools å¯¹æ¯” python -m build å’Œ python setup.py sdist bdist_wheel éƒ½æ˜¯ç”¨äºæ„å»º Python åŒ…çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œä½†å®ƒä»¬æœ‰ä¸€äº›åŒºåˆ«ã€‚\npython -m build æ˜¯ Python 3.10 ä¸­æ–°å¢çš„æ ‡å‡†åº“æ¨¡å— build çš„å…¥å£ç‚¹ï¼Œæ”¯æŒå¤šç§æ„å»ºæ ¼å¼ï¼ŒåŒ…æ‹¬ sdistã€wheelã€zipã€tar ç­‰ã€‚å®ƒå¯ä»¥è‡ªåŠ¨æ„å»ºæºä»£ç å‘è¡ŒåŒ…å’ŒäºŒè¿›åˆ¶å‘è¡ŒåŒ…ï¼Œå¹¶æ”¯æŒå¤šç§å¹³å°å’Œ Python ç‰ˆæœ¬ã€‚python -m build çš„ä½¿ç”¨æ–¹å¼æ¯”è¾ƒç®€å•ï¼Œéœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª setup.py æ–‡ä»¶æˆ–è€… pyproject.toml æ–‡ä»¶ï¼Œç„¶ååœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œ python -m build å‘½ä»¤å³å¯ã€‚ python setup.py sdist bdist_wheel æ˜¯ä¼ ç»Ÿçš„ Python åŒ…æ„å»ºæ–¹å¼ï¼Œéœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª setup.py æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ„å»ºå’Œæ‰“åŒ…çš„å…·ä½“å®ç°ã€‚å®ƒæ”¯æŒçš„æ„å»ºæ ¼å¼æ¯”è¾ƒæœ‰é™ï¼ŒåªåŒ…æ‹¬ sdist å’Œ bdist_wheel ä¸¤ç§æ ¼å¼ã€‚python setup.py sdist bdist_wheel çš„ä½¿ç”¨æ–¹å¼ç›¸å¯¹è¾ƒä¸ºç¹çï¼Œéœ€è¦æ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼Œå¹¶æŒ‡å®šç›¸åº”çš„å‚æ•°å’Œé€‰é¡¹ã€‚ æ€»ä¹‹ï¼Œpython -m build æ˜¯ Python 3.10 ä¸­æ–°å¢çš„æ ‡å‡†åº“æ¨¡å— build çš„å…¥å£ç‚¹ï¼Œæ”¯æŒå¤šç§æ„å»ºæ ¼å¼ï¼Œä½¿ç”¨èµ·æ¥æ¯”è¾ƒç®€å•ã€‚è€Œ python setup.py sdist bdist_wheel æ˜¯ä¼ ç»Ÿçš„ Python åŒ…æ„å»ºæ–¹å¼ï¼Œä½¿ç”¨èµ·æ¥ç›¸å¯¹è¾ƒä¸ºç¹çï¼Œä½†ä»ç„¶æ˜¯ä¸€ç§å¸¸è§çš„æ„å»ºæ–¹å¼ã€‚éœ€è¦æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µé€‰æ‹©é€‚åˆçš„æ„å»ºå·¥å…·ã€‚\nç›¸å¯¹äºä½¿ç”¨ python setup.py sdist bdist_wheel å‘½ä»¤ï¼Œä½¿ç”¨ python -m build å‘½ä»¤æœ‰ä»¥ä¸‹å‡ ä¸ªä¼˜ç‚¹ï¼š\næ›´ç®€å•çš„å‘½ä»¤ï¼špython -m build å‘½ä»¤æ¯” python setup.py sdist bdist_wheel å‘½ä»¤æ›´åŠ ç®€å•æ˜“ç”¨ï¼Œå› ä¸ºå®ƒä¸éœ€è¦ä½ ç¼–å†™ setup.py æ–‡ä»¶ã€‚ä½ å¯ä»¥ä½¿ç”¨ pyproject.toml æ–‡ä»¶æ¥ä»£æ›¿ï¼Œè¿™æ ·ä¼šæ›´ç®€å•å’Œç°ä»£åŒ–ã€‚ æ›´å¥½çš„é…ç½®ï¼šbuild æ¨¡å—ä½¿ç”¨ pyproject.toml æ–‡ä»¶æ¥é…ç½®åŒ…çš„æ„å»ºï¼Œè¿™æ˜¯ä¸€ç§æ›´ç°ä»£å’Œæ ‡å‡†åŒ–çš„é…ç½®æ–¹å¼ã€‚è¯¥æ–‡ä»¶å¯ä»¥æŒ‡å®šæ„å»ºä¾èµ–é¡¹ã€åŒ…å«åœ¨è½¯ä»¶åŒ…ä¸­çš„å…¶ä»–æ–‡ä»¶ä»¥åŠå…¶ä»–å…ƒæ•°æ®ã€‚ æ›´å¤šçš„è¾“å‡ºæ ¼å¼ï¼špython -m build æ”¯æŒæ¯” python setup.py sdist bdist_wheel æ›´å¤šçš„è¾“å‡ºæ ¼å¼ï¼ŒåŒ…æ‹¬ wheelã€sdistã€zipã€tar ç­‰ç­‰ã€‚ æ›´å¥½çš„æ€§èƒ½ï¼šç›¸å¯¹äº python setup.py sdist bdist_wheel å‘½ä»¤ï¼Œpython -m build å‘½ä»¤é€šå¸¸æ›´å¿«ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå…·æœ‰è®¸å¤šä¾èµ–é¡¹çš„å¤§å‹é¡¹ç›®è€Œè¨€ã€‚è¿™æ˜¯å› ä¸º build å¯ä»¥å¹¶è¡Œå¤„ç†æŸäº›ä»»åŠ¡ï¼Œä¾‹å¦‚æ„å»ºäºŒè¿›åˆ¶è½¯ä»¶åŒ…ã€‚ æ›´å¥½çš„å…¼å®¹æ€§ï¼špython -m build è®¾è®¡ä¸ºä¸å¤šä¸ª Python ç‰ˆæœ¬å’Œå¹³å°å…¼å®¹ï¼Œè€Œ python setup.py sdist bdist_wheel å‘½ä»¤é€šå¸¸ç‰¹å®šäºç‰¹å®šç‰ˆæœ¬æˆ–å¹³å°ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œç›¸å¯¹äº python setup.py sdist bdist_wheel å‘½ä»¤ï¼Œpython -m build æä¾›äº†ä¸€ç§æ›´ç®€å•ã€æ›´ç°ä»£ã€æ›´çµæ´»çš„æ„å»º Python åŒ…çš„æ–¹å¼ï¼Œå…·æœ‰æ›´å¥½çš„æ€§èƒ½å’Œå…¼å®¹æ€§ã€‚ä¸è¿‡ï¼Œpython setup.py sdist bdist_wheel å‘½ä»¤ä»ç„¶æ˜¯æ„å»ºè½¯ä»¶åŒ…çš„å¸¸ç”¨å’Œå¾—åˆ°å¹¿æ³›æ”¯æŒçš„æ–¹æ³•ï¼Œç‰¹åˆ«æ˜¯å¯¹äºè¾ƒè€çš„é¡¹ç›®æˆ–å…·æœ‰æ›´å¤æ‚è¦æ±‚çš„é¡¹ç›®è€Œè¨€ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/05/09/python-install-build-publish-run/","summary":"æœ€è¿‘å¼€å§‹å­¦ä¹  pythonï¼Œè¿™ç¯‡æ–‡ç« è®°å½•å¦‚ä½•å®‰è£… pythonã€æ­å»º python å¼€å‘ç¯å¢ƒï¼Œä»¥åŠå¦‚ä½•æ„å»ºã€å‘å¸ƒ python åŒ…ã€‚æˆ‘ä½¿ç”¨çš„æ˜¯ macos ç³»ç»Ÿï¼Œæ‰€ä»¥æœ¬ç¯‡æ–‡ç« ä¸­çš„ä¸€äº›å‘½ä»¤æ˜¯åŸºäº macos ï¼Œç‰¹æ­¤è¯´æ˜ã€‚\n1ã€å®‰è£… MacOS ä¸Šé€šè¿‡ brew å®‰è£… Python3ï¼š\nbrew install python3 æŸ¥çœ‹ python3 å®‰è£…è·¯å¾„ï¼š\n$ which python3 /opt/homebrew/bin/python3 $ type python3 python3 is /opt/homebrew/bin/python3 æŸ¥çœ‹ç‰ˆæœ¬ï¼š\npython --version è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ zshï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹ ~/.zshrcï¼Œæ·»åŠ ä¸‹é¢ä»£ç ï¼š\nexport PYTHON_HOME=/opt/homebrew/opt/python@3.11 export PATH=$PYTHON_HOME/bin:$PATH alias python=python3 alias pip=pip3 ä½¿é…ç½®ç”Ÿæ•ˆï¼š\nsource ~/.zshrc 2ã€åˆ›å»ºé¡¹ç›® åˆ›å»ºä¸€ä¸ªç›®å½• chensoul_helloï¼š\nmkdir chensoul_hello cd chensoul_hello åˆ›å»ºä¸€ä¸ª main.py ï¼Œæ‰“å° helloworldï¼š\nprint(\u0026#34;hello world\u0026#34;) è¯•è¯•è¿è¡Œ main.pyï¼š\npython main.py 3ã€åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ ä½¿ç”¨ python venv æ¨¡å—åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ .venvï¼š\npython -m venv .venv ä½¿ç”¨ . å¼€å¤´çš„ç›®å½•æˆ–è€…æ–‡ä»¶ä¸ºéšè—æ–‡ä»¶ã€‚å¦‚æœä½¿ç”¨ git ç®¡ç†é¡¹ç›®ï¼Œåˆ™éœ€è¦å°† .venv æ·»åŠ åˆ° .gitignoreã€‚\næ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼š\nsource .venv/bin/activate 4ã€ä½¿ç”¨ setuptools ç®¡ç†é¡¹ç›® setuptools æ˜¯ Python çš„ä¸€ä¸ªåŒ…ç®¡ç†å·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´æ–¹ä¾¿åœ°æ‰“åŒ…å’Œå‘å¸ƒ Python ä»£ç ã€‚setuptools æä¾›äº†ä¸€äº›å‘½ä»¤è¡Œå·¥å…·ï¼Œä¾‹å¦‚ easy_install å’Œ setup.","title":"Pythonå®‰è£…ã€æ„å»ºã€å‘å¸ƒã€ä¸‹è½½å’Œè¿è¡Œ"},{"content":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼šä½¿ç”¨ try-with-resources ä¼˜äº try-finallyã€‚\nä»‹ç» Java åº“åŒ…å«è®¸å¤šå¿…é¡»é€šè¿‡è°ƒç”¨ close æ–¹æ³•æ‰‹åŠ¨å…³é—­çš„èµ„æºã€‚å¸¸è§çš„æœ‰ InputStreamã€OutputStream å’Œ java.sql.Connectionã€‚å…³é—­èµ„æºå¸¸å¸¸ä¼šè¢«å®¢æˆ·ç«¯å¿½ç•¥ï¼Œè¿™ä¼šå¯¼è‡´å¯æ€•çš„æ€§èƒ½åæœã€‚è™½ç„¶è¿™äº›èµ„æºä¸­çš„è®¸å¤šéƒ½ä½¿ç”¨ç»ˆç»“å™¨ä½œä¸ºå®‰å…¨ç½‘ï¼Œä½†ç»ˆç»“å™¨å¹¶ä¸èƒ½å¾ˆå¥½åœ°å·¥ä½œã€‚\nä»å†å²ä¸Šçœ‹ï¼Œtry-finally è¯­å¥æ˜¯ç¡®ä¿æ­£ç¡®å…³é—­èµ„æºçš„æœ€ä½³æ–¹æ³•ï¼Œå³ä½¿åœ¨å‡ºç°å¼‚å¸¸æˆ–è¿”å›æ—¶ä¹Ÿæ˜¯å¦‚æ­¤ï¼š\n// try-finally - No longer the best way to close resources! static String firstLineOfFile(String path) throws IOException { BufferedReader br = new BufferedReader(new FileReader(path)); try { return br.readLine(); } finally { br.close(); } } è¿™å¯èƒ½çœ‹èµ·æ¥ä¸åï¼Œä½†æ·»åŠ ç¬¬äºŒä¸ªèµ„æºæ—¶ï¼Œæƒ…å†µä¼šå˜å¾—æ›´ç³Ÿï¼š\n// try-finally is ugly when used with more than one resource! static void copy(String src, String dst) throws IOException { InputStream in = new FileInputStream(src); try { OutputStream out = new FileOutputStream(dst); try { byte[] buf = new byte[BUFFER_SIZE]; int n; while ((n = in.read(buf)) \u0026gt;= 0) out.write(buf, 0, n); } finally { out.close(); } } finally { in.close(); } } ä½¿ç”¨ try-finally è¯­å¥å…³é—­èµ„æºçš„æ­£ç¡®ä»£ç ï¼ˆå¦‚å‰ä¸¤ä¸ªä»£ç ç¤ºä¾‹æ‰€ç¤ºï¼‰ä¹Ÿæœ‰ä¸€ä¸ªç»†å¾®çš„ç¼ºé™·ã€‚try å—å’Œ finally å—ä¸­çš„ä»£ç éƒ½èƒ½å¤ŸæŠ›å‡ºå¼‚å¸¸ã€‚ä¾‹å¦‚ï¼Œåœ¨ firstLineOfFile æ–¹æ³•ä¸­ï¼Œç”±äºåº•å±‚ç‰©ç†è®¾å¤‡å‘ç”Ÿæ•…éšœï¼Œå¯¹ readLine çš„è°ƒç”¨å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œå…³é—­çš„è°ƒç”¨ä¹Ÿå¯èƒ½å‡ºäºåŒæ ·çš„åŸå› è€Œå¤±è´¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¬¬äºŒä¸ªå¼‚å¸¸å°†å®Œå…¨è¦†ç›–ç¬¬ä¸€ä¸ªå¼‚å¸¸ã€‚å¼‚å¸¸å †æ ˆè·Ÿè¸ªä¸­æ²¡æœ‰ç¬¬ä¸€ä¸ªå¼‚å¸¸çš„è®°å½•ï¼Œè¿™å¯èƒ½ä¼šä½¿å®é™…ç³»ç»Ÿä¸­çš„è°ƒè¯•å˜å¾—éå¸¸å¤æ‚ï¼ˆè€Œè¿™å¯èƒ½æ˜¯å¸Œæœ›å‡ºç°çš„ç¬¬ä¸€ä¸ªå¼‚å¸¸ï¼Œä»¥ä¾¿è¯Šæ–­é—®é¢˜ï¼‰ã€‚è™½ç„¶å¯ä»¥é€šè¿‡ç¼–å†™ä»£ç æ¥æŠ‘åˆ¶ç¬¬äºŒä¸ªå¼‚å¸¸è€Œæ”¯æŒç¬¬ä¸€ä¸ªå¼‚å¸¸ï¼Œä½†å®é™…ä¸Šæ²¡æœ‰äººè¿™æ ·åšï¼Œå› ä¸ºå®ƒå¤ªè¿‡å†—é•¿ã€‚\nå½“ Java 7 å¼•å…¥ try-with-resources è¯­å¥æ—¶ï¼Œæ‰€æœ‰è¿™äº›é—®é¢˜éƒ½ä¸€æ¬¡æ€§è§£å†³äº†ã€‚è¦ä½¿ç”¨è¿™ä¸ªç»“æ„ï¼Œèµ„æºå¿…é¡»å®ç° AutoCloseable æ¥å£ï¼Œå®ƒç”±ä¸€ä¸ªå•ç‹¬çš„ void-return close æ–¹æ³•ç»„æˆã€‚Java åº“å’Œç¬¬ä¸‰æ–¹åº“ä¸­çš„è®¸å¤šç±»å’Œæ¥å£ç°åœ¨éƒ½å®ç°æˆ–æ‰©å±•äº† AutoCloseableã€‚å¦‚æœä½ ç¼–å†™çš„ç±»å­˜åœ¨å¿…é¡»å…³é—­çš„èµ„æºï¼Œé‚£ä¹ˆä¹Ÿåº”è¯¥å®ç° AutoCloseableã€‚\nä¸‹é¢æ˜¯ä½¿ç”¨ try-with-resources çš„ç¬¬ä¸€ä¸ªç¤ºä¾‹ï¼š\n// try-with-resources - the the best way to close resources! static String firstLineOfFile(String path) throws IOException { try (BufferedReader br = new BufferedReader(new FileReader(path))) { return br.readLine(); } } ä¸‹é¢æ˜¯ä½¿ç”¨ try-with-resources çš„ç¬¬äºŒä¸ªç¤ºä¾‹ï¼š\n// try-with-resources on multiple resources - short and sweet static void copy(String src, String dst) throws IOException { try (InputStream in = new FileInputStream(src);OutputStream out = new FileOutputStream(dst)) { byte[] buf = new byte[BUFFER_SIZE]; int n; while ((n = in.read(buf)) \u0026gt;= 0) out.write(buf, 0, n); } } å’Œä½¿ç”¨ try-finally çš„åŸç‰ˆä»£ç ç›¸æ¯”ï¼Œtry-with-resources ä¸ºå¼€å‘è€…æä¾›äº†æ›´å¥½çš„è¯Šæ–­æ–¹å¼ã€‚è€ƒè™‘ firstLineOfFile æ–¹æ³•ã€‚å¦‚æœå¼‚å¸¸æ˜¯ç”± readLine è°ƒç”¨å’Œä¸å¯è§çš„ close æŠ›å‡ºçš„ï¼Œåˆ™åä¸€ä¸ªå¼‚å¸¸å°†è¢«æŠ‘åˆ¶ï¼Œä»¥æ”¯æŒå‰ä¸€ä¸ªå¼‚å¸¸ã€‚å®é™…ä¸Šï¼Œè¿˜å¯èƒ½ä¼šæŠ‘åˆ¶å¤šä¸ªå¼‚å¸¸ï¼Œä»¥ä¿ç•™å®é™…å¸Œæœ›çœ‹åˆ°çš„å¼‚å¸¸ã€‚è¿™äº›è¢«æŠ‘åˆ¶çš„å¼‚å¸¸ä¸ä¼šä»…ä»…è¢«æŠ›å¼ƒï¼›å®ƒä»¬ä¼šè¢«æ‰“å°åœ¨å †æ ˆè·Ÿè¸ªä¸­ï¼Œå¹¶æ ‡è®°å®ƒä»¬è¢«æŠ‘åˆ¶ã€‚å¯ä»¥é€šè¿‡ç¼–ç¨‹æ–¹å¼ä½¿ç”¨ getSuppressed æ–¹æ³•è®¿é—®åˆ°å®ƒä»¬ï¼Œè¯¥æ–¹æ³•æ˜¯åœ¨ Java 7 ä¸­æ·»åŠ åˆ° Throwable ä¸­çš„ã€‚\nå¯ä»¥åœ¨å¸¦æœ‰èµ„æºçš„ try-with-resources è¯­å¥ä¸­æ”¾ç½® catch å­å¥ï¼Œå°±åƒåœ¨å¸¸è§„çš„ try-finally è¯­å¥ä¸Šä¸€æ ·ã€‚è¿™å…è®¸å¤„ç†å¼‚å¸¸æ—¶ä¸å¿…ç”¨å¦ä¸€å±‚åµŒå¥—æ¥å½±å“ä»£ç ã€‚ä½œä¸ºä¸€ä¸ªç‰¹æŒ‡çš„ç¤ºä¾‹ï¼Œä¸‹é¢æ˜¯æˆ‘ä»¬çš„ firstLineOfFile æ–¹æ³•çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒä¸æŠ›å‡ºå¼‚å¸¸ï¼Œä½†å¦‚æœæ— æ³•æ‰“å¼€æ–‡ä»¶æˆ–ä»ä¸­è¯»å–æ–‡ä»¶ï¼Œåˆ™è¿”å›ä¸€ä¸ªé»˜è®¤å€¼ï¼š\n// try-with-resources with a catch clause static String firstLineOfFile(String path, String defaultVal) { try (BufferedReader br = new BufferedReader(new FileReader(path))) { return br.readLine(); } catch (IOException e) { return defaultVal; } } æ‰©å±• try-with-resources è¯­å¥æ˜¯ Java 7 ä¸­å¼•å…¥çš„ä¸€ç§æ–°è¯­æ³•ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†ç®€åŒ–èµ„æºç®¡ç†çš„ä»£ç ï¼Œå¹¶ç¡®ä¿èµ„æºè¢«æ­£ç¡®åœ°å…³é—­ï¼Œé¿å…äº†èµ„æºæ³„æ¼å’Œå¼‚å¸¸å¤„ç†çš„é—®é¢˜ã€‚\nåœ¨ Java ä¸­ï¼Œå½“ä½¿ç”¨ä¸€äº›éœ€è¦æ‰‹åŠ¨é‡Šæ”¾èµ„æºçš„ç±»æ—¶ï¼Œä¾‹å¦‚ I/O æµã€æ•°æ®åº“è¿æ¥ç­‰ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä»£ç ä¸­æ˜¾å¼åœ°è°ƒç”¨ close() æ–¹æ³•æ¥é‡Šæ”¾èµ„æºã€‚è¿™ç§æ–¹å¼å¯èƒ½ä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚ï¼š\nå¿˜è®°å…³é—­èµ„æºï¼šå¦‚æœå¼€å‘äººå‘˜å¿˜è®°å…³é—­èµ„æºï¼Œå¯èƒ½ä¼šå¯¼è‡´èµ„æºæ³„æ¼ï¼Œå ç”¨ç³»ç»Ÿèµ„æºï¼Œé™ä½ç³»ç»Ÿæ€§èƒ½ã€‚ å¼‚å¸¸å¤„ç†é—®é¢˜ï¼šå¦‚æœåœ¨å…³é—­èµ„æºä¹‹å‰å‘ç”Ÿå¼‚å¸¸ï¼Œå¯èƒ½ä¼šå¯¼è‡´èµ„æºæœªèƒ½æ­£ç¡®å…³é—­ï¼Œè¿›ä¸€æ­¥å¯¼è‡´èµ„æºæ³„æ¼å’Œå…¶ä»–é—®é¢˜ã€‚ ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼ŒJava 7 å¼•å…¥äº† try-with-resources è¯­å¥ã€‚å®ƒæä¾›äº†ä¸€ç§æ›´ç®€æ´ã€æ›´å®‰å…¨ã€æ›´æ˜“è¯»çš„æ–¹å¼æ¥ç®¡ç†èµ„æºçš„å…³é—­ï¼Œé¿å…äº†å¼€å‘äººå‘˜æ‰‹åŠ¨é‡Šæ”¾èµ„æºçš„é—®é¢˜ï¼Œå¹¶ä¸”å¯ä»¥ç¡®ä¿èµ„æºè¢«æ­£ç¡®åœ°å…³é—­ã€‚\nä½¿ç”¨ try-with-resources è¯­å¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†èµ„æºçš„åˆ›å»ºå’Œåˆå§‹åŒ–æ”¾åœ¨ try è¯­å¥çš„æ‹¬å·å†…ï¼Œå®ƒä»¬åœ¨ try å—æ‰§è¡Œç»“æŸåï¼Œä¼šè‡ªåŠ¨å…³é—­èµ„æºã€‚å¦‚æœåœ¨å…³é—­èµ„æºæ—¶å‘ç”Ÿå¼‚å¸¸ï¼Œtry-with-resources è¯­å¥ä¼šè‡ªåŠ¨å¤„ç†å¼‚å¸¸ï¼Œç¡®ä¿æ‰€æœ‰èµ„æºéƒ½è¢«æ­£ç¡®åœ°å…³é—­ã€‚\ntry-with-resources è¯­å¥ä½¿ç”¨ä»¥ä¸‹è¯­æ³•ï¼š\ntry (Resource1 r1 = new Resource1(); Resource2 r2 = new Resource2()) { // use r1 and r2 } catch (Exception e) { // handle the exception } åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒResource1 å’Œ Resource2 æ˜¯éœ€è¦åœ¨ä½¿ç”¨åå…³é—­çš„èµ„æºï¼Œå®ƒä»¬å°†åœ¨ try å—ç»“æŸåè‡ªåŠ¨å…³é—­ã€‚å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œcatch å—å°†å¤„ç†å®ƒã€‚\nResource1 å’Œ Resource2 å¿…é¡»å®ç° AutoCloseable æ¥å£ï¼Œè¯¥æ¥å£å®šä¹‰äº† close() æ–¹æ³•ï¼Œç”¨äºå…³é—­èµ„æºã€‚å½“ try å—ç»“æŸæ—¶ï¼Œclose() æ–¹æ³•å°†è‡ªåŠ¨è¢«è°ƒç”¨ï¼Œä»¥ä¾¿å…³é—­èµ„æºã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œtry-with-resources è¯­å¥å¯ä»¥åŒæ—¶ç®¡ç†å¤šä¸ªèµ„æºï¼Œèµ„æºçš„åˆ›å»ºå’Œåˆå§‹åŒ–åº”è¯¥åœ¨ try è¯­å¥çš„æ‹¬å·å†…å®Œæˆã€‚\ntry-with-resources è¯­å¥æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š\nç®€æ´æ€§ï¼štry-with-resources è¯­å¥å¯ä»¥è®©ä»£ç æ›´ç®€æ´ï¼Œä¸éœ€è¦æ˜¾å¼åœ°è°ƒç”¨ close() æ–¹æ³•ã€‚ å®‰å…¨æ€§ï¼štry-with-resources è¯­å¥å¯ä»¥ç¡®ä¿èµ„æºè¢«æ­£ç¡®åœ°å…³é—­ï¼Œé¿å…äº†èµ„æºæ³„æ¼å’Œå¼‚å¸¸å¤„ç†çš„é—®é¢˜ã€‚ å¯è¯»æ€§ï¼štry-with-resources è¯­å¥å¯ä»¥è®©ä»£ç æ›´æ˜“è¯»ï¼Œæ›´å®¹æ˜“ç†è§£èµ„æºçš„ä½¿ç”¨å’Œç®¡ç†ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œtry-with-resources è¯­å¥åªèƒ½ç”¨äºç®¡ç†å®ç°äº† AutoCloseable æ¥å£çš„èµ„æºï¼Œå¹¶ä¸”åªæœ‰åœ¨ Java 7 åŠä»¥ä¸Šç‰ˆæœ¬æ‰æ”¯æŒè¯¥è¯­æ³•ã€‚\né™¤äº† I/O æµå’Œæ•°æ®åº“è¿æ¥ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›ç±»éœ€è¦æ‰‹åŠ¨é‡Šæ”¾èµ„æºï¼Œä¾‹å¦‚ï¼š\nå›¾å½¢ç•Œé¢ç»„ä»¶ï¼šåœ¨ä½¿ç”¨å›¾å½¢ç•Œé¢ç»„ä»¶æ—¶ï¼Œä¾‹å¦‚çª—å£ã€å¯¹è¯æ¡†ã€é¢æ¿ç­‰ï¼Œéœ€è¦æ‰‹åŠ¨é‡Šæ”¾èµ„æºï¼Œä¾‹å¦‚å…³é—­çª—å£ã€é‡Šæ”¾å›¾å½¢èµ„æºç­‰ã€‚ çº¿ç¨‹ï¼šåœ¨ä½¿ç”¨çº¿ç¨‹æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨åœæ­¢çº¿ç¨‹ï¼Œé‡Šæ”¾çº¿ç¨‹å ç”¨çš„ç³»ç»Ÿèµ„æºã€‚ Socket å’Œ ServerSocketï¼šåœ¨ä½¿ç”¨ Socket å’Œ ServerSocket æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨å…³é—­å®ƒä»¬ï¼Œä»¥ä¾¿é‡Šæ”¾ç½‘ç»œèµ„æºã€‚ æ–‡ä»¶å¥æŸ„ï¼šåœ¨ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿæ—¶ï¼Œéœ€è¦æ‰‹åŠ¨å…³é—­æ–‡ä»¶å¥æŸ„ï¼Œä»¥ä¾¿é‡Šæ”¾ç³»ç»Ÿèµ„æºã€‚ JDBC Statement å’Œ ResultSetï¼šåœ¨ä½¿ç”¨ JDBC æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨å…³é—­ Statement å’Œ ResultSet å¯¹è±¡ï¼Œä»¥ä¾¿é‡Šæ”¾æ•°æ®åº“èµ„æºã€‚ JNI èµ„æºï¼šåœ¨ä½¿ç”¨ JNI è°ƒç”¨æœ¬åœ°æ–¹æ³•æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨é‡Šæ”¾ JNI èµ„æºï¼Œä¾‹å¦‚ C/C++ ä¸­çš„å†…å­˜å’Œæ–‡ä»¶å¥æŸ„ç­‰ã€‚ ","permalink":"https://blog.chensoul.cc/posts/2023/05/08/prefer-try-with-resources-to-try-finally/","summary":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼šä½¿ç”¨ try-with-resources ä¼˜äº try-finallyã€‚\nä»‹ç» Java åº“åŒ…å«è®¸å¤šå¿…é¡»é€šè¿‡è°ƒç”¨ close æ–¹æ³•æ‰‹åŠ¨å…³é—­çš„èµ„æºã€‚å¸¸è§çš„æœ‰ InputStreamã€OutputStream å’Œ java.sql.Connectionã€‚å…³é—­èµ„æºå¸¸å¸¸ä¼šè¢«å®¢æˆ·ç«¯å¿½ç•¥ï¼Œè¿™ä¼šå¯¼è‡´å¯æ€•çš„æ€§èƒ½åæœã€‚è™½ç„¶è¿™äº›èµ„æºä¸­çš„è®¸å¤šéƒ½ä½¿ç”¨ç»ˆç»“å™¨ä½œä¸ºå®‰å…¨ç½‘ï¼Œä½†ç»ˆç»“å™¨å¹¶ä¸èƒ½å¾ˆå¥½åœ°å·¥ä½œã€‚\nä»å†å²ä¸Šçœ‹ï¼Œtry-finally è¯­å¥æ˜¯ç¡®ä¿æ­£ç¡®å…³é—­èµ„æºçš„æœ€ä½³æ–¹æ³•ï¼Œå³ä½¿åœ¨å‡ºç°å¼‚å¸¸æˆ–è¿”å›æ—¶ä¹Ÿæ˜¯å¦‚æ­¤ï¼š\n// try-finally - No longer the best way to close resources! static String firstLineOfFile(String path) throws IOException { BufferedReader br = new BufferedReader(new FileReader(path)); try { return br.readLine(); } finally { br.close(); } } è¿™å¯èƒ½çœ‹èµ·æ¥ä¸åï¼Œä½†æ·»åŠ ç¬¬äºŒä¸ªèµ„æºæ—¶ï¼Œæƒ…å†µä¼šå˜å¾—æ›´ç³Ÿï¼š\n// try-finally is ugly when used with more than one resource! static void copy(String src, String dst) throws IOException { InputStream in = new FileInputStream(src); try { OutputStream out = new FileOutputStream(dst); try { byte[] buf = new byte[BUFFER_SIZE]; int n; while ((n = in.read(buf)) \u0026gt;= 0) out.write(buf, 0, n); } finally { out.","title":"ã€ŠEffective Java 3ã€‹ç¬”è®°9ï¼šä½¿ç”¨ try-with-resources ä¼˜äº try-finally"},{"content":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼šé¿å…ä½¿ç”¨ç»ˆç»“å™¨å’Œæ¸…é™¤å™¨ã€‚\nä»‹ç» ç»ˆç»“å™¨æ˜¯ä¸å¯é¢„æµ‹çš„ã€å¸¸å¸¸æ˜¯å±é™©çš„ï¼Œé€šå¸¸ä¹Ÿæ˜¯ä¸å¿…è¦çš„ã€‚ å®ƒä»¬çš„ä½¿ç”¨å¯èƒ½å¯¼è‡´ä¸ç¨³å®šçš„è¡Œä¸ºã€ä½æ•ˆç‡å’Œå¯ç§»æ¤æ€§é—®é¢˜ã€‚ç»ˆç»“å™¨æœ‰ä¸€äº›æœ‰æ•ˆçš„ç”¨é€”ï¼Œæˆ‘ä»¬ç¨åä¼šä»‹ç»ï¼Œä½†é€šå¸¸æƒ…å†µä¸‹åº”è¯¥é¿å…ä½¿ç”¨å®ƒä»¬ã€‚ä» Java 9 å¼€å§‹ï¼Œç»ˆç»“å™¨å·²ç»è¢«å¼ƒç”¨ï¼Œä½†å®ƒä»¬ä»ç„¶è¢« Java åº“ä½¿ç”¨ã€‚Java 9 ä¸­ç»ˆç»“å™¨çš„æ›¿ä»£å“æ˜¯æ¸…é™¤å™¨ã€‚ æ¸…é™¤å™¨çš„å±é™©æ¯”ç»ˆç»“å™¨å°ï¼Œä½†ä»ç„¶ä¸å¯é¢„æµ‹ã€ç¼“æ…¢ï¼Œè€Œä¸”é€šå¸¸æ˜¯ä¸å¿…è¦çš„ã€‚\nç»ˆç»“å™¨æ˜¯é€šè¿‡åœ¨å¯¹è±¡ä¸Šå®ç° finalize() æ–¹æ³•æ¥å®ç°çš„ï¼Œè€Œæ¸…é™¤å™¨æ˜¯é€šè¿‡ä½¿ç”¨ Cleaner ç±»æ¥å®ç°çš„ã€‚å®ƒä»¬çš„å·¥ä½œæ–¹å¼æœ‰æ‰€ä¸åŒï¼š\nç»ˆç»“å™¨æ˜¯ç”±åƒåœ¾å›æ”¶å™¨è‡ªåŠ¨æ‰§è¡Œçš„ï¼Œæ— æ³•é¢„æµ‹ä½•æ—¶æ‰§è¡Œï¼Œä¹Ÿæ— æ³•ä¿è¯ä¸€å®šä¼šæ‰§è¡Œã€‚å½“åƒåœ¾å›æ”¶å™¨å†³å®šå°†å¯¹è±¡å›æ”¶æ—¶ï¼Œå®ƒä¼šè°ƒç”¨å¯¹è±¡çš„ finalize() æ–¹æ³•ï¼Œä»¥ä¾¿å¯¹è±¡åœ¨è¢«é”€æ¯ä¹‹å‰æ‰§è¡Œä¸€äº›æ¸…ç†æ“ä½œã€‚\næ¸…é™¤å™¨æ˜¯ç”± Java 9 è™šæ‹Ÿæœºé€šè¿‡å¼•ç”¨é˜Ÿåˆ—å’Œ Cleaner å¯¹è±¡æ‰§è¡Œçš„ï¼Œå¯ä»¥åœ¨å¯¹è±¡è¢«å›æ”¶ä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œã€‚åœ¨å¯¹è±¡è¢«åƒåœ¾å›æ”¶ä¹‹å‰ï¼ŒJava è™šæ‹Ÿæœºä¼šå°†è¯¥å¯¹è±¡çš„å¼•ç”¨æ·»åŠ åˆ°ä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œç„¶ååœ¨æŸäº›æ—¶åˆ»ï¼ŒJava è™šæ‹Ÿæœºä¼šåˆ›å»ºä¸€ä¸ª Cleaner å¯¹è±¡ï¼Œå¹¶å°†è¯¥å¼•ç”¨é˜Ÿåˆ—ä¸ Cleaner å¯¹è±¡å…³è”èµ·æ¥ã€‚å½“è¯¥å¯¹è±¡è¢«åƒåœ¾å›æ”¶æ—¶ï¼Œå®ƒçš„å¼•ç”¨å°†è¢«æ·»åŠ åˆ°ä¸ Cleaner å¯¹è±¡å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼ŒCleaner å¯¹è±¡ä¼šåœ¨æŸäº›æ—¶åˆ»è‡ªåŠ¨æ‰§è¡Œï¼Œä»¥ä¾¿å¯¹è±¡åœ¨è¢«é”€æ¯ä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œä¸€äº›æ¸…ç†æ“ä½œã€‚\nåœ¨ Java 9 ä¸­ï¼Œå¼•å…¥äº† java.lang.ref.Cleaner ç±»ï¼Œä½œä¸ºç»ˆç»“å™¨çš„æ›¿ä»£å“ï¼Œç”¨äºæ‰§è¡Œå¯¹è±¡æ¸…ç†æ“ä½œã€‚ç›¸æ¯”ç»ˆç»“å™¨ï¼ŒCleaner å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š\næ˜¾å¼ç®¡ç†ï¼šCleaner ä½¿ç”¨æ˜ç¡®çš„ä»£ç è·¯å¾„æ¥ç®¡ç†æ¸…ç†æ“ä½œï¼Œè€Œä¸æ˜¯ä½¿ç”¨éšå¼çš„ç»ˆç»“å™¨æœºåˆ¶ã€‚ å¯æ§æ€§ï¼šCleaner å…è®¸å¼€å‘äººå‘˜æ§åˆ¶ä½•æ—¶æ‰§è¡Œæ¸…ç†æ“ä½œï¼Œè€Œä¸æ˜¯å®Œå…¨ä¾èµ–äºåƒåœ¾å›æ”¶å™¨çš„è¡Œä¸ºã€‚ å®‰å…¨æ€§ï¼šCleaner æ‰§è¡Œæ¸…ç†æ“ä½œæ—¶ï¼Œä¼šç¡®ä¿ç±»åŠ è½½å™¨å·²å‡†å¤‡å¥½ï¼Œå› æ­¤å¯ä»¥å®‰å…¨åœ°æ‰§è¡Œæœ¬åœ°æ¸…ç†æ“ä½œã€‚ Cleaner é€šè¿‡æ³¨å†Œä¸€ä¸ªä»»åŠ¡æ¥æ‰§è¡Œæ¸…ç†æ“ä½œã€‚è¯¥ä»»åŠ¡å¯ä»¥æ˜¯ Runnable æˆ–è€…ç»§æ‰¿è‡ª PhantomReference ç±»çš„å­ç±»å¯¹è±¡ã€‚å½“å¯¹è±¡è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶æ—¶ï¼ŒCleaner å°†è‡ªåŠ¨æ‰§è¡Œæ³¨å†Œçš„ä»»åŠ¡ã€‚\nç»ˆç»“å™¨å’Œæ¸…é™¤å™¨çš„ä½¿ç”¨åœºæ™¯éå¸¸æœ‰é™ï¼Œå› ä¸ºå®ƒä»¬çš„æ‰§è¡Œæ—¶é—´ä¸å¯é¢„æµ‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚æ€§èƒ½é—®é¢˜ã€ä¸ç¨³å®šçš„è¡Œä¸ºã€ä½æ•ˆç‡å’Œå¯ç§»æ¤æ€§é—®é¢˜ã€‚\nç»ˆç»“å™¨å’Œæ¸…é™¤å™¨çš„ä¸»è¦é—®é¢˜æ˜¯ï¼š\nå®ƒä»¬æ— æ³•å¯é åœ°åŠæ—¶æ‰§è¡Œï¼Œç”šè‡³å¯èƒ½æ ¹æœ¬ä¸ä¼šæ‰§è¡Œã€‚å½“å¯¹è±¡å˜å¾—ä¸å¯è®¿é—®ï¼Œç»ˆç»“å™¨æˆ–æ¸…é™¤å™¨å¯¹å®ƒè¿›è¡Œæ“ä½œçš„æ—¶é—´æ˜¯ä¸ç¡®å®šçš„ã€‚è¿™æ„å‘³ç€æ°¸è¿œä¸åº”è¯¥åœ¨ç»ˆç»“å™¨æˆ–æ¸…é™¤å™¨ä¸­æ‰§è¡Œä»»ä½•å¯¹æ—¶é—´è¦æ±‚å¾ˆä¸¥æ ¼çš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œä¾èµ–ç»ˆç»“å™¨æˆ–æ¸…é™¤å™¨å…³é—­æ–‡ä»¶å°±æ˜¯ä¸€ä¸ªä¸¥é‡é”™è¯¯ï¼Œå› ä¸ºæ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ˜¯æœ‰é™çš„èµ„æºã€‚å¦‚æœç”±äºç³»ç»Ÿåœ¨è¿è¡Œç»ˆç»“å™¨æˆ–æ¸…é™¤å™¨çš„å»¶è¿Ÿå¯¼è‡´è®¸å¤šæ–‡ä»¶å¤„äºæ‰“å¼€çŠ¶æ€ï¼Œç¨‹åºå¯èƒ½ä¼šè¿è¡Œå¤±è´¥ï¼Œå› ä¸ºå®ƒä¸èƒ½å†æ‰“å¼€å…¶ä»–æ–‡ä»¶ã€‚\nç»ˆç»“å™¨çš„å¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œåœ¨ç»ˆç»“æœŸé—´æŠ›å‡ºçš„æœªæ•è·å¼‚å¸¸è¢«å¿½ç•¥ï¼Œè¯¥å¯¹è±¡çš„ç»ˆç»“ç»ˆæ­¢ã€‚æœªæ•è·çš„å¼‚å¸¸å¯èƒ½ä¼šä½¿å…¶ä»–å¯¹è±¡å¤„äºæŸåçŠ¶æ€ã€‚å¦‚æœå¦ä¸€ä¸ªçº¿ç¨‹è¯•å›¾ä½¿ç”¨è¿™æ ·ä¸€ä¸ªæŸåçš„å¯¹è±¡ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä»»æ„çš„ä¸ç¡®å®šæ€§è¡Œä¸ºã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œæœªæ•è·çš„å¼‚å¸¸å°†ç»ˆæ­¢çº¿ç¨‹å¹¶æ‰“å°å †æ ˆè·Ÿè¸ªï¼Œä½†å¦‚æœåœ¨ç»ˆç»“å™¨ä¸­å‡ºç°ï¼Œåˆ™ä¸ä¼šæ‰“å°è­¦å‘Šã€‚æ¸…é™¤å™¨æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºä½¿ç”¨æ¸…é™¤å™¨çš„åº“å¯ä»¥æ§åˆ¶å®ƒçš„çº¿ç¨‹ã€‚\nå®ƒä»¬å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚ç»ˆç»“å™¨ç”±åƒåœ¾å›æ”¶å™¨æ‰§è¡Œï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­çš„å»¶è¿Ÿã€‚å¦ä¸€æ–¹é¢ï¼Œæ¸…é™¤å™¨ä½¿ç”¨å•ç‹¬çš„çº¿ç¨‹æ‰§è¡Œï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´é¢å¤–çš„å¼€é”€å’ŒåŒæ­¥é—®é¢˜ã€‚\nã€ŠEffective Javaã€‹ç¬¬ä¸‰ç‰ˆå»ºè®®ä½¿ç”¨æ˜¾å¼ç»ˆæ­¢æ–¹æ³•ï¼Œä¾‹å¦‚ close()ï¼Œé‡Šæ”¾ç³»ç»Ÿèµ„æºã€‚å½“åº”ç”¨ç¨‹åºå®Œæˆå¯¹èµ„æºçš„ä½¿ç”¨æ—¶ï¼Œå¯ä»¥æ˜¾å¼è°ƒç”¨è¿™äº›æ–¹æ³•ï¼Œè€Œä¸ä¾èµ–äºåƒåœ¾å›æ”¶å™¨æ¥æ‰§è¡Œå®ƒä»¬ã€‚\nå¦‚æœå¿…é¡»ä½¿ç”¨ç»ˆç»“å™¨æˆ–æ¸…é™¤å™¨ï¼Œ ã€ŠEffective Javaã€‹ç¬¬ä¸‰ç‰ˆå»ºè®®ä½¿ç”¨é˜²å¾¡æ€§ç¼–ç¨‹å®ç°å®ƒä»¬ï¼Œå³ä½¿ç”¨ try-finally å—ç¡®ä¿æ‰§è¡Œå…³é”®çš„æ¸…ç†æ“ä½œï¼Œå¹¶é¿å…å¼•ç”¨å…¶ä»–å¯èƒ½å·²è¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡æˆ–èµ„æºã€‚\næ‰©å±• System.gc() System.gc() æ–¹æ³•æ˜¯ Java ä¸­çš„ä¸€ç§åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå®ƒå¯ä»¥åœ¨è¯·æ±‚åƒåœ¾å›æ”¶å™¨è¿è¡Œæ—¶å¼ºåˆ¶è¿›è¡Œä¸€æ¬¡åƒåœ¾å›æ”¶ã€‚\nSystem.gc() æ–¹æ³•ä¸æ˜¯å¼ºåˆ¶åƒåœ¾å›æ”¶çš„æ–¹æ³•ï¼Œå› ä¸º Java è™šæ‹Ÿæœºå¯ä»¥å¿½ç•¥å®ƒã€‚Java ç¼–ç¨‹è¯­è¨€è§„èŒƒè¦æ±‚ System.gc() æ–¹æ³•åªæ˜¯ä¸€ä¸ªå»ºè®®ï¼Œä¸èƒ½ä¿è¯å®ƒä¸€å®šä¼šå¯¼è‡´åƒåœ¾å›æ”¶å™¨è¿è¡Œã€‚å› æ­¤ï¼Œå®ƒä¸åº”è¯¥è¢«é¢‘ç¹åœ°è°ƒç”¨ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚\nSystem.gc() æ–¹æ³•çš„ä½¿ç”¨åœºæ™¯éå¸¸æœ‰é™ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œåº”è¯¥è®©åƒåœ¾å›æ”¶å™¨è‡ªè¡Œç®¡ç†å†…å­˜ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ System.gc() æ–¹æ³•æ¥å¼ºåˆ¶è¿›è¡Œåƒåœ¾å›æ”¶ã€‚å¦‚æœéœ€è¦ç¡®ä¿æŸäº›å¯¹è±¡åœ¨åƒåœ¾å›æ”¶ä¹‹å‰è¢«é‡Šæ”¾ï¼Œå¯ä»¥ä½¿ç”¨å¼±å¼•ç”¨æˆ–è½¯å¼•ç”¨æ¥ç®¡ç†è¿™äº›å¯¹è±¡ï¼Œæˆ–ä½¿ç”¨æ˜¾å¼ç»ˆæ­¢æ–¹æ³•æ¥é‡Šæ”¾ç³»ç»Ÿèµ„æºã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒSystem.gc() æ–¹æ³•å¯èƒ½ä¼šè€—è´¹è¾ƒé•¿æ—¶é—´ï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šå¼ºåˆ¶å›æ”¶æ‰€æœ‰æœªä½¿ç”¨çš„å¯¹è±¡ã€‚å› æ­¤ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œåº”è¯¥è°¨æ…ä½¿ç”¨ System.gc() æ–¹æ³•ï¼Œå¹¶ä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨å®ƒã€‚\nSystem.runFinalization() System.runFinalization() æ–¹æ³•æ˜¯åœ¨ Java 1.2 ç‰ˆæœ¬ä¸­å¼•å…¥çš„ã€‚åœ¨ Java 1.2 ä¸­ï¼Œå¼•å…¥äº†åƒåœ¾å›æ”¶å™¨çš„æ”¹è¿›ï¼ŒåŒ…æ‹¬ä½¿ç”¨å¼•ç”¨ç±»å‹ã€ç»ˆç»“å™¨å’Œåƒåœ¾å›æ”¶å™¨æ€§èƒ½çš„æå‡ã€‚System.runFinalization() æ–¹æ³•ä½œä¸ºç»ˆç»“å™¨æœºåˆ¶çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºç¡®ä¿æ‰€æœ‰å¯¹è±¡çš„finalize() æ–¹æ³•è¢«æ‰§è¡Œã€‚åœ¨åƒåœ¾å›æ”¶å™¨å°†å¯¹è±¡ä»å†…å­˜ä¸­é‡Šæ”¾ä¹‹å‰ï¼Œå¦‚æœè¯¥å¯¹è±¡å…·æœ‰ç»ˆç»“å™¨ï¼Œåˆ™åƒåœ¾å›æ”¶å™¨ä¼šè°ƒç”¨å¯¹è±¡çš„ finalize() æ–¹æ³•ï¼Œä»¥ä¾¿åœ¨å¯¹è±¡è¢«é”€æ¯ä¹‹å‰æ‰§è¡Œä¸€äº›æ¸…ç†æ“ä½œã€‚System.runFinalization() æ–¹æ³•å¯ä»¥ç¡®ä¿æ‰€æœ‰å¯¹è±¡çš„ finalize() æ–¹æ³•è¢«æ‰§è¡Œã€‚\nSystem.runFinalization() æ–¹æ³•ä¸æ˜¯å¼ºåˆ¶ç»ˆç»“å™¨æ‰§è¡Œçš„æ–¹æ³•ï¼Œå› ä¸º Java è™šæ‹Ÿæœºå¯ä»¥å¿½ç•¥å®ƒã€‚Java ç¼–ç¨‹è¯­è¨€è§„èŒƒè¦æ±‚ System.runFinalization() æ–¹æ³•åªæ˜¯ä¸€ä¸ªå»ºè®®ï¼Œä¸èƒ½ä¿è¯å®ƒä¸€å®šä¼šå¯¼è‡´ç»ˆç»“å™¨æ‰§è¡Œã€‚å› æ­¤ï¼Œå®ƒä¸åº”è¯¥è¢«é¢‘ç¹åœ°è°ƒç”¨ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚\nSystem.runFinalization() æ–¹æ³•çš„ä½¿ç”¨åœºæ™¯éå¸¸æœ‰é™ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œåº”è¯¥é¿å…ä½¿ç”¨ç»ˆç»“å™¨æ¥æ‰§è¡Œæ¸…ç†æ“ä½œï¼Œå› ä¸ºç»ˆç»“å™¨çš„æ‰§è¡Œæ—¶é—´ä¸å¯é¢„æµ‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚æ€§èƒ½é—®é¢˜ã€ä¸ç¨³å®šçš„è¡Œä¸ºã€ä½æ•ˆç‡å’Œå¯ç§»æ¤æ€§é—®é¢˜ã€‚ç›¸åï¼Œåº”è¯¥ä½¿ç”¨æ˜¾å¼ç»ˆæ­¢æ–¹æ³•æ¥é‡Šæ”¾ç³»ç»Ÿèµ„æºã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒSystem.runFinalization() æ–¹æ³•å¯èƒ½ä¼šè€—è´¹è¾ƒé•¿æ—¶é—´ï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šæ‰§è¡Œæ‰€æœ‰å¯¹è±¡çš„ç»ˆç»“å™¨ã€‚å› æ­¤ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œåº”è¯¥è°¨æ…ä½¿ç”¨ System.runFinalization() æ–¹æ³•ï¼Œå¹¶ä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨å®ƒ\næ¸…é™¤å™¨å’Œç»ˆç»“å™¨ä½¿ç”¨åœºæ™¯ ä½¿ç”¨æ¸…é™¤å™¨å’Œç»ˆç»“å™¨çš„ä¾‹å­å¹¶ä¸å¸¸è§ï¼Œå› ä¸ºå®ƒä»¬çš„ä½¿ç”¨åœºæ™¯éå¸¸æœ‰é™ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½éœ€è¦ä½¿ç”¨æ¸…é™¤å™¨å’Œç»ˆç»“å™¨çš„åœºæ™¯ï¼š\nåœ¨ Java 8 åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œjava.sql.Connection ç±»ä¸­çš„ finalize() æ–¹æ³•è¢«ç”¨äºå…³é—­æ•°æ®åº“è¿æ¥ã€‚åœ¨ Java 9 ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•è¢«å¼ƒç”¨ï¼Œå› ä¸ºç»ˆç»“å™¨çš„ä½¿ç”¨ä¸å¯é å’Œå±é™©ã€‚ç›¸åï¼ŒConnection æ¥å£ä¸­æ·»åŠ äº†ä¸€ä¸ª close() æ–¹æ³•ï¼Œåº”è¯¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ¥é‡Šæ”¾æ•°æ®åº“è¿æ¥ã€‚ åœ¨ Java 9 ä¸­ï¼Œjava.lang.ref.Cleaner ç±»è¢«å¼•å…¥ä½œä¸ºç»ˆç»“å™¨çš„æ›¿ä»£å“ï¼Œå¯ä»¥ç”¨äºæ‰§è¡Œå¯¹è±¡æ¸…ç†æ“ä½œã€‚ä¾‹å¦‚ï¼Œå¦‚æœéœ€è¦åœ¨å¯¹è±¡è¢«åƒåœ¾å›æ”¶ä¹‹å‰æ‰§è¡Œä¸€äº›æ¸…ç†æ“ä½œï¼ˆä¾‹å¦‚é‡Šæ”¾æœ¬åœ°å†…å­˜æˆ–å…³é—­æ–‡ä»¶å¥æŸ„ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ Cleaner ç±»æ¥å®ç°ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ Cleaner ç±»çš„ç®€å•ç¤ºä¾‹ï¼š public class Resource implements AutoCloseable { private final Cleaner cleaner = Cleaner.create(); private final File file; public Resource(File file) { this.file = file; cleaner.register(this, new CleanupTask(file)); } @Override public void close() throws Exception { // release any resources held by this object } private static class CleanupTask implements Runnable { private final File file; public CleanupTask(File file) { this.file = file; } @Override public void run() { // clean up the resource associated with the given file } } } åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒResource ç±»æŒæœ‰ä¸€ä¸ª File å¯¹è±¡ï¼Œå¹¶åœ¨åˆ›å»ºå¯¹è±¡æ—¶ä½¿ç”¨ Cleaner ç±»æ³¨å†Œäº†ä¸€ä¸ª CleanupTask å¯¹è±¡ã€‚å½“ Resource å¯¹è±¡è¢«åƒåœ¾å›æ”¶æ—¶ï¼ŒCleaner å¯¹è±¡å°†è‡ªåŠ¨è°ƒç”¨ CleanupTask å¯¹è±¡çš„ run() æ–¹æ³•ï¼Œä»¥ä¾¿æ‰§è¡Œ File å¯¹è±¡çš„æ¸…ç†æ“ä½œï¼ˆä¾‹å¦‚å…³é—­æ–‡ä»¶å¥æŸ„ï¼‰ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä»…æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå®é™…ä½¿ç”¨ä¸­éœ€è¦è°¨æ…ä½¿ç”¨å’Œè€ƒè™‘æ¸…é™¤å™¨å’Œç»ˆç»“å™¨çš„å±€é™æ€§ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥é¿å…ä½¿ç”¨å®ƒä»¬ï¼Œä½¿ç”¨æ˜¾å¼ç»ˆæ­¢æ–¹æ³•æ¥é‡Šæ”¾ç³»ç»Ÿèµ„æºã€‚\nä»¥ä¸‹æ˜¯ä¸€äº›ä½¿ç”¨æ˜¾å¼ç»ˆæ­¢æ–¹æ³•çš„ä¾‹å­ï¼š\nJava I/O ç±»ã€‚Java I/O ç±»é€šå¸¸éœ€è¦ä½¿ç”¨æ˜¾å¼ç»ˆæ­¢æ–¹æ³•æ¥é‡Šæ”¾ç³»ç»Ÿèµ„æºï¼Œä¾‹å¦‚å…³é—­æ–‡ä»¶å¥æŸ„æˆ–ç½‘ç»œè¿æ¥ã€‚ä¾‹å¦‚ï¼Œjava.io.FileInputStream ç±»ä¸­çš„ close() æ–¹æ³•ç”¨äºå…³é—­æ‰“å¼€çš„æ–‡ä»¶ã€‚ try (FileInputStream fis = new FileInputStream(\u0026#34;example.txt\u0026#34;)) { // read from the file } catch (IOException e) { // handle the exception } åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½¿ç”¨ try-with-resources è¯­å¥æ¥åˆ›å»º FileInputStream å¯¹è±¡ï¼Œè¿™å°†è‡ªåŠ¨è°ƒç”¨ close() æ–¹æ³•ï¼Œä»¥ä¾¿é‡Šæ”¾æ–‡ä»¶å¥æŸ„ã€‚\næ•°æ®åº“è¿æ¥ã€‚æ•°æ®åº“è¿æ¥é€šå¸¸éœ€è¦ä½¿ç”¨æ˜¾å¼ç»ˆæ­¢æ–¹æ³•æ¥é‡Šæ”¾è¿æ¥ã€‚ä¾‹å¦‚ï¼Œjava.sql.Connection æ¥å£ä¸­çš„ close() æ–¹æ³•ç”¨äºå…³é—­æ•°æ®åº“è¿æ¥ã€‚ try (Connection conn = DriverManager.getConnection(url, user, password)) { // use the database connection } catch (SQLException e) { // handle the exception } åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½¿ç”¨ try-with-resources è¯­å¥æ¥åˆ›å»º Connection å¯¹è±¡ï¼Œè¿™å°†è‡ªåŠ¨è°ƒç”¨ close() æ–¹æ³•ï¼Œä»¥ä¾¿é‡Šæ”¾æ•°æ®åº“è¿æ¥ã€‚\nçº¿ç¨‹æ± ã€‚çº¿ç¨‹æ± é€šå¸¸éœ€è¦ä½¿ç”¨æ˜¾å¼ç»ˆæ­¢æ–¹æ³•æ¥å…³é—­çº¿ç¨‹æ± ï¼Œä»¥ä¾¿é‡Šæ”¾çº¿ç¨‹èµ„æºã€‚ä¾‹å¦‚ï¼Œjava.util.concurrent.ExecutorService æ¥å£ä¸­çš„ shutdown() æ–¹æ³•ç”¨äºå…³é—­çº¿ç¨‹æ± ã€‚ ExecutorService executor = Executors.newFixedThreadPool(10); try { // submit tasks to the executor } finally { executor.shutdown(); } åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½¿ç”¨ finally å—æ¥ç¡®ä¿åœ¨æ‰§è¡Œå®Œä»»åŠ¡åå…³é—­çº¿ç¨‹æ± ï¼Œä»¥ä¾¿é‡Šæ”¾çº¿ç¨‹èµ„æºã€‚\nå¦‚ä½•é¿å…èµ„æºæ³„æ¼ï¼Ÿ èµ„æºæ³„æ¼æ˜¯æŒ‡åœ¨ä½¿ç”¨èµ„æºï¼ˆå¦‚æ–‡ä»¶å¥æŸ„ã€ç½‘ç»œè¿æ¥ã€æ•°æ®åº“è¿æ¥ã€çº¿ç¨‹ç­‰ï¼‰æ—¶ï¼Œæ²¡æœ‰æ­£ç¡®åœ°é‡Šæ”¾æˆ–å…³é—­å®ƒä»¬ï¼Œå¯¼è‡´èµ„æºé•¿æ—¶é—´å ç”¨ï¼Œæœ€ç»ˆå¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒæˆ–ç³»ç»Ÿæ€§èƒ½ä¸‹é™ã€‚\nä»¥ä¸‹æ˜¯ä¸€äº›é¿å…èµ„æºæ³„æ¼çš„æ–¹æ³•ï¼š\nä½¿ç”¨ try-with-resources è¯­å¥ã€‚try-with-resources è¯­å¥æ˜¯ä¸€ç§è‡ªåŠ¨å…³é—­èµ„æºçš„æœºåˆ¶ï¼Œå¯ä»¥ç¡®ä¿åœ¨ä½¿ç”¨å®Œèµ„æºåè‡ªåŠ¨å…³é—­å®ƒä»¬ã€‚ä¾‹å¦‚ï¼š try (FileInputStream fis = new FileInputStream(\u0026#34;example.txt\u0026#34;)) { // read from the file } catch (IOException e) { // handle the exception } åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒFileInputStream å¯¹è±¡å°†åœ¨ try å—ç»“æŸåè‡ªåŠ¨å…³é—­ã€‚\næ˜¾å¼å…³é—­èµ„æºã€‚å¦‚æœä¸èƒ½ä½¿ç”¨ try-with-resources è¯­å¥ï¼Œåº”è¯¥ä½¿ç”¨æ˜¾å¼å…³é—­èµ„æºçš„æ–¹æ³•æ¥é‡Šæ”¾èµ„æºã€‚ä¾‹å¦‚ï¼Œåœ¨ä½¿ç”¨å®Œæ•°æ®åº“è¿æ¥åï¼Œåº”è¯¥è°ƒç”¨ Connection æ¥å£ä¸­çš„ close() æ–¹æ³•æ¥é‡Šæ”¾è¿æ¥ã€‚\nä½¿ç”¨é˜²å¾¡æ€§ç¼–ç¨‹ã€‚åœ¨ä½¿ç”¨èµ„æºæ—¶ï¼Œåº”è¯¥ä½¿ç”¨é˜²å¾¡æ€§ç¼–ç¨‹ï¼Œç¡®ä¿åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½èƒ½æ­£ç¡®åœ°é‡Šæ”¾èµ„æºã€‚ä¾‹å¦‚ï¼Œåœ¨ä½¿ç”¨æ–‡ä»¶å¥æŸ„æ—¶ï¼Œåº”è¯¥ç¡®ä¿åœ¨è¯»å–æˆ–å†™å…¥æ–‡ä»¶æ—¶ï¼Œä½¿ç”¨ try-finally å—æ¥ç¡®ä¿åœ¨å‘ç”Ÿå¼‚å¸¸æ—¶å…³é—­æ–‡ä»¶å¥æŸ„ã€‚\nFileInputStream fis = null; try { fis = new FileInputStream(\u0026#34;example.txt\u0026#34;); // read from the file } catch (IOException e) { // handle the exception } finally { if (fis != null) { try { fis.close(); } catch (IOException e) { // handle the exception } } } åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½¿ç”¨ try-finally å—æ¥ç¡®ä¿åœ¨å‘ç”Ÿå¼‚å¸¸æ—¶å…³é—­æ–‡ä»¶å¥æŸ„ã€‚\nä½¿ç”¨èµ„æºç®¡ç†æ¡†æ¶ã€‚ä¸€äº›èµ„æºç®¡ç†æ¡†æ¶ï¼Œä¾‹å¦‚ Apache Commons IO å’Œ Google Guavaï¼Œæä¾›äº†ä¸€äº›å®ç”¨å·¥å…·ç±»å’Œæ–¹æ³•ï¼Œå¯ä»¥å¸®åŠ©é¿å…èµ„æºæ³„æ¼ã€‚ æ€»ç»“ ç»ˆç»“å™¨å’Œæ¸…é™¤å™¨éƒ½æ˜¯ Java ä¸­ç”¨äºå¯¹è±¡æ¸…ç†çš„æœºåˆ¶ï¼Œå®ƒä»¬å„æœ‰ä¼˜ç¼ºç‚¹ã€‚\nç»ˆç»“å™¨çš„ä¼˜ç‚¹ï¼š\næ— éœ€æ˜¾å¼è°ƒç”¨ï¼šç»ˆç»“å™¨æ˜¯ä¸€ç§è‡ªåŠ¨çš„æœºåˆ¶ï¼Œæ— éœ€æ˜¾å¼è°ƒç”¨ï¼Œå¯ä»¥åœ¨å¯¹è±¡è¢«åƒåœ¾å›æ”¶æ—¶è‡ªåŠ¨æ‰§è¡Œã€‚ çµæ´»æ€§ï¼šç»ˆç»“å™¨å…è®¸å¼€å‘äººå‘˜ç¼–å†™ä»»æ„çš„æ¸…ç†ä»£ç ï¼Œæ— éœ€è€ƒè™‘æ¸…ç†æ“ä½œçš„æ‰§è¡Œæ—¶é—´æˆ–é¡ºåºã€‚ ç»ˆç»“å™¨çš„ç¼ºç‚¹ï¼š\nä¸å¯æ§æ€§ï¼šç»ˆç»“å™¨çš„æ‰§è¡Œæ—¶é—´å’Œé¡ºåºæ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚æ€§èƒ½é—®é¢˜ã€ä¸ç¨³å®šçš„è¡Œä¸ºã€ä½æ•ˆç‡å’Œå¯ç§»æ¤æ€§é—®é¢˜ã€‚ å®‰å…¨æ€§é—®é¢˜ï¼šç»ˆç»“å™¨å¯èƒ½ä¼šå¼•èµ·ä¸€äº›å®‰å…¨æ€§é—®é¢˜ï¼Œä¾‹å¦‚åœ¨ finalize() æ–¹æ³•ä¸­é‡æ–°å¯åŠ¨çº¿ç¨‹æˆ–æ‰“å¼€æ–‡ä»¶ç­‰ã€‚ æ¸…é™¤å™¨çš„ä¼˜ç‚¹ï¼š\næ˜ç¡®çš„ä»£ç è·¯å¾„ï¼šæ¸…é™¤å™¨ä½¿ç”¨æ˜ç¡®çš„ä»£ç è·¯å¾„æ¥æ‰§è¡Œæ¸…ç†æ“ä½œï¼Œç›¸æ¯”ç»ˆç»“å™¨ï¼Œå®ƒæ›´åŠ å¯æ§å’Œå®‰å…¨ã€‚ å¯æ§æ€§ï¼šæ¸…é™¤å™¨å…è®¸å¼€å‘äººå‘˜æ§åˆ¶ä½•æ—¶æ‰§è¡Œæ¸…ç†æ“ä½œï¼Œè€Œä¸æ˜¯å®Œå…¨ä¾èµ–äºåƒåœ¾å›æ”¶å™¨çš„è¡Œä¸ºã€‚ å®‰å…¨æ€§ï¼šæ¸…é™¤å™¨æ‰§è¡Œæ¸…ç†æ“ä½œæ—¶ï¼Œä¼šç¡®ä¿ç±»åŠ è½½å™¨å·²å‡†å¤‡å¥½ï¼Œå› æ­¤å¯ä»¥å®‰å…¨åœ°æ‰§è¡Œæœ¬åœ°æ¸…ç†æ“ä½œã€‚ æ¸…é™¤å™¨çš„ç¼ºç‚¹ï¼š\næ˜¾å¼è°ƒç”¨ï¼šæ¸…é™¤å™¨éœ€è¦æ˜¾å¼è°ƒç”¨ï¼Œå¼€å‘äººå‘˜éœ€è¦ä¸ºæ¯ä¸ªéœ€è¦æ¸…ç†çš„å¯¹è±¡æ³¨å†Œä¸€ä¸ªæ¸…ç†å™¨ï¼Œè¿™å¯èƒ½ä¼šå¢åŠ ä»£ç çš„å¤æ‚æ€§ã€‚ é™åˆ¶æ€§ï¼šæ¸…é™¤å™¨åªèƒ½ç”¨äºæ‰§è¡Œä¸€äº›æ¸…ç†æ“ä½œï¼Œä¸èƒ½ç”¨äºæ‰§è¡Œå…¶ä»–ç±»å‹çš„æ“ä½œã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œç»ˆç»“å™¨å’Œæ¸…é™¤å™¨å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œåº”è¯¥æ ¹æ®å®é™…éœ€æ±‚å’Œåœºæ™¯é€‰æ‹©é€‚å½“çš„æœºåˆ¶æ¥ç®¡ç†å¯¹è±¡æ¸…ç†ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œåº”è¯¥ä¼˜å…ˆä½¿ç”¨æ˜¾å¼ç»ˆæ­¢æ–¹æ³•æ¥é‡Šæ”¾ç³»ç»Ÿèµ„æºï¼Œåªæœ‰åœ¨å¿…è¦æ—¶æ‰è€ƒè™‘ä½¿ç”¨ç»ˆç»“å™¨æˆ–æ¸…é™¤å™¨ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/05/08/avoid-finalizers-and-cleaners/","summary":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼šé¿å…ä½¿ç”¨ç»ˆç»“å™¨å’Œæ¸…é™¤å™¨ã€‚\nä»‹ç» ç»ˆç»“å™¨æ˜¯ä¸å¯é¢„æµ‹çš„ã€å¸¸å¸¸æ˜¯å±é™©çš„ï¼Œé€šå¸¸ä¹Ÿæ˜¯ä¸å¿…è¦çš„ã€‚ å®ƒä»¬çš„ä½¿ç”¨å¯èƒ½å¯¼è‡´ä¸ç¨³å®šçš„è¡Œä¸ºã€ä½æ•ˆç‡å’Œå¯ç§»æ¤æ€§é—®é¢˜ã€‚ç»ˆç»“å™¨æœ‰ä¸€äº›æœ‰æ•ˆçš„ç”¨é€”ï¼Œæˆ‘ä»¬ç¨åä¼šä»‹ç»ï¼Œä½†é€šå¸¸æƒ…å†µä¸‹åº”è¯¥é¿å…ä½¿ç”¨å®ƒä»¬ã€‚ä» Java 9 å¼€å§‹ï¼Œç»ˆç»“å™¨å·²ç»è¢«å¼ƒç”¨ï¼Œä½†å®ƒä»¬ä»ç„¶è¢« Java åº“ä½¿ç”¨ã€‚Java 9 ä¸­ç»ˆç»“å™¨çš„æ›¿ä»£å“æ˜¯æ¸…é™¤å™¨ã€‚ æ¸…é™¤å™¨çš„å±é™©æ¯”ç»ˆç»“å™¨å°ï¼Œä½†ä»ç„¶ä¸å¯é¢„æµ‹ã€ç¼“æ…¢ï¼Œè€Œä¸”é€šå¸¸æ˜¯ä¸å¿…è¦çš„ã€‚\nç»ˆç»“å™¨æ˜¯é€šè¿‡åœ¨å¯¹è±¡ä¸Šå®ç° finalize() æ–¹æ³•æ¥å®ç°çš„ï¼Œè€Œæ¸…é™¤å™¨æ˜¯é€šè¿‡ä½¿ç”¨ Cleaner ç±»æ¥å®ç°çš„ã€‚å®ƒä»¬çš„å·¥ä½œæ–¹å¼æœ‰æ‰€ä¸åŒï¼š\nç»ˆç»“å™¨æ˜¯ç”±åƒåœ¾å›æ”¶å™¨è‡ªåŠ¨æ‰§è¡Œçš„ï¼Œæ— æ³•é¢„æµ‹ä½•æ—¶æ‰§è¡Œï¼Œä¹Ÿæ— æ³•ä¿è¯ä¸€å®šä¼šæ‰§è¡Œã€‚å½“åƒåœ¾å›æ”¶å™¨å†³å®šå°†å¯¹è±¡å›æ”¶æ—¶ï¼Œå®ƒä¼šè°ƒç”¨å¯¹è±¡çš„ finalize() æ–¹æ³•ï¼Œä»¥ä¾¿å¯¹è±¡åœ¨è¢«é”€æ¯ä¹‹å‰æ‰§è¡Œä¸€äº›æ¸…ç†æ“ä½œã€‚\næ¸…é™¤å™¨æ˜¯ç”± Java 9 è™šæ‹Ÿæœºé€šè¿‡å¼•ç”¨é˜Ÿåˆ—å’Œ Cleaner å¯¹è±¡æ‰§è¡Œçš„ï¼Œå¯ä»¥åœ¨å¯¹è±¡è¢«å›æ”¶ä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œã€‚åœ¨å¯¹è±¡è¢«åƒåœ¾å›æ”¶ä¹‹å‰ï¼ŒJava è™šæ‹Ÿæœºä¼šå°†è¯¥å¯¹è±¡çš„å¼•ç”¨æ·»åŠ åˆ°ä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œç„¶ååœ¨æŸäº›æ—¶åˆ»ï¼ŒJava è™šæ‹Ÿæœºä¼šåˆ›å»ºä¸€ä¸ª Cleaner å¯¹è±¡ï¼Œå¹¶å°†è¯¥å¼•ç”¨é˜Ÿåˆ—ä¸ Cleaner å¯¹è±¡å…³è”èµ·æ¥ã€‚å½“è¯¥å¯¹è±¡è¢«åƒåœ¾å›æ”¶æ—¶ï¼Œå®ƒçš„å¼•ç”¨å°†è¢«æ·»åŠ åˆ°ä¸ Cleaner å¯¹è±¡å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼ŒCleaner å¯¹è±¡ä¼šåœ¨æŸäº›æ—¶åˆ»è‡ªåŠ¨æ‰§è¡Œï¼Œä»¥ä¾¿å¯¹è±¡åœ¨è¢«é”€æ¯ä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œä¸€äº›æ¸…ç†æ“ä½œã€‚\nåœ¨ Java 9 ä¸­ï¼Œå¼•å…¥äº† java.lang.ref.Cleaner ç±»ï¼Œä½œä¸ºç»ˆç»“å™¨çš„æ›¿ä»£å“ï¼Œç”¨äºæ‰§è¡Œå¯¹è±¡æ¸…ç†æ“ä½œã€‚ç›¸æ¯”ç»ˆç»“å™¨ï¼ŒCleaner å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š\næ˜¾å¼ç®¡ç†ï¼šCleaner ä½¿ç”¨æ˜ç¡®çš„ä»£ç è·¯å¾„æ¥ç®¡ç†æ¸…ç†æ“ä½œï¼Œè€Œä¸æ˜¯ä½¿ç”¨éšå¼çš„ç»ˆç»“å™¨æœºåˆ¶ã€‚ å¯æ§æ€§ï¼šCleaner å…è®¸å¼€å‘äººå‘˜æ§åˆ¶ä½•æ—¶æ‰§è¡Œæ¸…ç†æ“ä½œï¼Œè€Œä¸æ˜¯å®Œå…¨ä¾èµ–äºåƒåœ¾å›æ”¶å™¨çš„è¡Œä¸ºã€‚ å®‰å…¨æ€§ï¼šCleaner æ‰§è¡Œæ¸…ç†æ“ä½œæ—¶ï¼Œä¼šç¡®ä¿ç±»åŠ è½½å™¨å·²å‡†å¤‡å¥½ï¼Œå› æ­¤å¯ä»¥å®‰å…¨åœ°æ‰§è¡Œæœ¬åœ°æ¸…ç†æ“ä½œã€‚ Cleaner é€šè¿‡æ³¨å†Œä¸€ä¸ªä»»åŠ¡æ¥æ‰§è¡Œæ¸…ç†æ“ä½œã€‚è¯¥ä»»åŠ¡å¯ä»¥æ˜¯ Runnable æˆ–è€…ç»§æ‰¿è‡ª PhantomReference ç±»çš„å­ç±»å¯¹è±¡ã€‚å½“å¯¹è±¡è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶æ—¶ï¼ŒCleaner å°†è‡ªåŠ¨æ‰§è¡Œæ³¨å†Œçš„ä»»åŠ¡ã€‚\nç»ˆç»“å™¨å’Œæ¸…é™¤å™¨çš„ä½¿ç”¨åœºæ™¯éå¸¸æœ‰é™ï¼Œå› ä¸ºå®ƒä»¬çš„æ‰§è¡Œæ—¶é—´ä¸å¯é¢„æµ‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚æ€§èƒ½é—®é¢˜ã€ä¸ç¨³å®šçš„è¡Œä¸ºã€ä½æ•ˆç‡å’Œå¯ç§»æ¤æ€§é—®é¢˜ã€‚\nç»ˆç»“å™¨å’Œæ¸…é™¤å™¨çš„ä¸»è¦é—®é¢˜æ˜¯ï¼š\nå®ƒä»¬æ— æ³•å¯é åœ°åŠæ—¶æ‰§è¡Œï¼Œç”šè‡³å¯èƒ½æ ¹æœ¬ä¸ä¼šæ‰§è¡Œã€‚å½“å¯¹è±¡å˜å¾—ä¸å¯è®¿é—®ï¼Œç»ˆç»“å™¨æˆ–æ¸…é™¤å™¨å¯¹å®ƒè¿›è¡Œæ“ä½œçš„æ—¶é—´æ˜¯ä¸ç¡®å®šçš„ã€‚è¿™æ„å‘³ç€æ°¸è¿œä¸åº”è¯¥åœ¨ç»ˆç»“å™¨æˆ–æ¸…é™¤å™¨ä¸­æ‰§è¡Œä»»ä½•å¯¹æ—¶é—´è¦æ±‚å¾ˆä¸¥æ ¼çš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œä¾èµ–ç»ˆç»“å™¨æˆ–æ¸…é™¤å™¨å…³é—­æ–‡ä»¶å°±æ˜¯ä¸€ä¸ªä¸¥é‡é”™è¯¯ï¼Œå› ä¸ºæ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ˜¯æœ‰é™çš„èµ„æºã€‚å¦‚æœç”±äºç³»ç»Ÿåœ¨è¿è¡Œç»ˆç»“å™¨æˆ–æ¸…é™¤å™¨çš„å»¶è¿Ÿå¯¼è‡´è®¸å¤šæ–‡ä»¶å¤„äºæ‰“å¼€çŠ¶æ€ï¼Œç¨‹åºå¯èƒ½ä¼šè¿è¡Œå¤±è´¥ï¼Œå› ä¸ºå®ƒä¸èƒ½å†æ‰“å¼€å…¶ä»–æ–‡ä»¶ã€‚\nç»ˆç»“å™¨çš„å¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œåœ¨ç»ˆç»“æœŸé—´æŠ›å‡ºçš„æœªæ•è·å¼‚å¸¸è¢«å¿½ç•¥ï¼Œè¯¥å¯¹è±¡çš„ç»ˆç»“ç»ˆæ­¢ã€‚æœªæ•è·çš„å¼‚å¸¸å¯èƒ½ä¼šä½¿å…¶ä»–å¯¹è±¡å¤„äºæŸåçŠ¶æ€ã€‚å¦‚æœå¦ä¸€ä¸ªçº¿ç¨‹è¯•å›¾ä½¿ç”¨è¿™æ ·ä¸€ä¸ªæŸåçš„å¯¹è±¡ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä»»æ„çš„ä¸ç¡®å®šæ€§è¡Œä¸ºã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œæœªæ•è·çš„å¼‚å¸¸å°†ç»ˆæ­¢çº¿ç¨‹å¹¶æ‰“å°å †æ ˆè·Ÿè¸ªï¼Œä½†å¦‚æœåœ¨ç»ˆç»“å™¨ä¸­å‡ºç°ï¼Œåˆ™ä¸ä¼šæ‰“å°è­¦å‘Šã€‚æ¸…é™¤å™¨æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºä½¿ç”¨æ¸…é™¤å™¨çš„åº“å¯ä»¥æ§åˆ¶å®ƒçš„çº¿ç¨‹ã€‚\nå®ƒä»¬å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚ç»ˆç»“å™¨ç”±åƒåœ¾å›æ”¶å™¨æ‰§è¡Œï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­çš„å»¶è¿Ÿã€‚å¦ä¸€æ–¹é¢ï¼Œæ¸…é™¤å™¨ä½¿ç”¨å•ç‹¬çš„çº¿ç¨‹æ‰§è¡Œï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´é¢å¤–çš„å¼€é”€å’ŒåŒæ­¥é—®é¢˜ã€‚\nã€ŠEffective Javaã€‹ç¬¬ä¸‰ç‰ˆå»ºè®®ä½¿ç”¨æ˜¾å¼ç»ˆæ­¢æ–¹æ³•ï¼Œä¾‹å¦‚ close()ï¼Œé‡Šæ”¾ç³»ç»Ÿèµ„æºã€‚å½“åº”ç”¨ç¨‹åºå®Œæˆå¯¹èµ„æºçš„ä½¿ç”¨æ—¶ï¼Œå¯ä»¥æ˜¾å¼è°ƒç”¨è¿™äº›æ–¹æ³•ï¼Œè€Œä¸ä¾èµ–äºåƒåœ¾å›æ”¶å™¨æ¥æ‰§è¡Œå®ƒä»¬ã€‚\nå¦‚æœå¿…é¡»ä½¿ç”¨ç»ˆç»“å™¨æˆ–æ¸…é™¤å™¨ï¼Œ ã€ŠEffective Javaã€‹ç¬¬ä¸‰ç‰ˆå»ºè®®ä½¿ç”¨é˜²å¾¡æ€§ç¼–ç¨‹å®ç°å®ƒä»¬ï¼Œå³ä½¿ç”¨ try-finally å—ç¡®ä¿æ‰§è¡Œå…³é”®çš„æ¸…ç†æ“ä½œï¼Œå¹¶é¿å…å¼•ç”¨å…¶ä»–å¯èƒ½å·²è¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡æˆ–èµ„æºã€‚\næ‰©å±• System.gc() System.gc() æ–¹æ³•æ˜¯ Java ä¸­çš„ä¸€ç§åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå®ƒå¯ä»¥åœ¨è¯·æ±‚åƒåœ¾å›æ”¶å™¨è¿è¡Œæ—¶å¼ºåˆ¶è¿›è¡Œä¸€æ¬¡åƒåœ¾å›æ”¶ã€‚\nSystem.gc() æ–¹æ³•ä¸æ˜¯å¼ºåˆ¶åƒåœ¾å›æ”¶çš„æ–¹æ³•ï¼Œå› ä¸º Java è™šæ‹Ÿæœºå¯ä»¥å¿½ç•¥å®ƒã€‚Java ç¼–ç¨‹è¯­è¨€è§„èŒƒè¦æ±‚ System.gc() æ–¹æ³•åªæ˜¯ä¸€ä¸ªå»ºè®®ï¼Œä¸èƒ½ä¿è¯å®ƒä¸€å®šä¼šå¯¼è‡´åƒåœ¾å›æ”¶å™¨è¿è¡Œã€‚å› æ­¤ï¼Œå®ƒä¸åº”è¯¥è¢«é¢‘ç¹åœ°è°ƒç”¨ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚\nSystem.gc() æ–¹æ³•çš„ä½¿ç”¨åœºæ™¯éå¸¸æœ‰é™ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œåº”è¯¥è®©åƒåœ¾å›æ”¶å™¨è‡ªè¡Œç®¡ç†å†…å­˜ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ System.gc() æ–¹æ³•æ¥å¼ºåˆ¶è¿›è¡Œåƒåœ¾å›æ”¶ã€‚å¦‚æœéœ€è¦ç¡®ä¿æŸäº›å¯¹è±¡åœ¨åƒåœ¾å›æ”¶ä¹‹å‰è¢«é‡Šæ”¾ï¼Œå¯ä»¥ä½¿ç”¨å¼±å¼•ç”¨æˆ–è½¯å¼•ç”¨æ¥ç®¡ç†è¿™äº›å¯¹è±¡ï¼Œæˆ–ä½¿ç”¨æ˜¾å¼ç»ˆæ­¢æ–¹æ³•æ¥é‡Šæ”¾ç³»ç»Ÿèµ„æºã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒSystem.gc() æ–¹æ³•å¯èƒ½ä¼šè€—è´¹è¾ƒé•¿æ—¶é—´ï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šå¼ºåˆ¶å›æ”¶æ‰€æœ‰æœªä½¿ç”¨çš„å¯¹è±¡ã€‚å› æ­¤ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œåº”è¯¥è°¨æ…ä½¿ç”¨ System.gc() æ–¹æ³•ï¼Œå¹¶ä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨å®ƒã€‚\nSystem.runFinalization() System.runFinalization() æ–¹æ³•æ˜¯åœ¨ Java 1.2 ç‰ˆæœ¬ä¸­å¼•å…¥çš„ã€‚åœ¨ Java 1.2 ä¸­ï¼Œå¼•å…¥äº†åƒåœ¾å›æ”¶å™¨çš„æ”¹è¿›ï¼ŒåŒ…æ‹¬ä½¿ç”¨å¼•ç”¨ç±»å‹ã€ç»ˆç»“å™¨å’Œåƒåœ¾å›æ”¶å™¨æ€§èƒ½çš„æå‡ã€‚System.","title":"ã€ŠEffective Java 3ã€‹ç¬”è®°8ï¼šé¿å…ä½¿ç”¨ç»ˆç»“å™¨å’Œæ¸…é™¤å™¨"},{"content":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-04-24 åˆ° 2023-04-30 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\næœ¬å‘¨äºŒæ—©ä¸Šè·‘æ­¥å³å°è…¿æŠ½ç­‹ï¼Œè·‘æ­¥æš‚åœäº†ä¸¤å¤©ï¼Œæ‰€ä»¥æœ‰ä¸¤å¤©èµ°è·¯æ²¡æœ‰åˆ°ä¸€ä¸‡æ­¥ã€‚åœ¨å°è…¿æ¢å¤ä¹‹åï¼Œç»§ç»­è·‘æ­¥ï¼ŒæŸ¥çœ‹ strava ä¸Šçš„ç»Ÿè®¡ï¼Œè¿™å‘¨æ€»å…±è·‘äº† 27 å…¬é‡Œï¼Œæ¯”ä¸Šå‘¨ 41 å…¬é‡Œå°‘äº† 14 å…¬é‡Œã€‚\nè¿™å‘¨ç©ºé—²æ—¶é—´å°±åœ¨æƒ³ï¼Œèƒ½ä¸èƒ½æ¯å¤©è‡ªåŠ¨æ”¶é›†ä¸ªäººçš„ä¸€äº›æ•°æ®ï¼Œæ¯”å¦‚ï¼Œç›®å‰æˆ‘èƒ½æƒ³åˆ°çš„æ•°æ®åŒ…æ‹¬è·‘æ­¥ã€èµ°è·¯ã€ä½“é‡ã€ç¼–ç ã€æ—©èµ·ç­‰ç­‰ã€‚\nç›®å‰æ˜¯ä½¿ç”¨ strava app è®°å½•è·‘æ­¥æ•°æ®ï¼Œé€šè¿‡ running_page å¯ä»¥å®æ—¶æ”¶é›†æˆ‘çš„æ¯å¤© è·‘æ­¥æ•°æ®ã€‚\nèµ°è·¯ã€ä½“é‡æ•°æ®å¯ä»¥ä»è‹¹æœå¥åº·æ•°æ®è·å–ï¼š\nç¼–ç æ•°æ®å¯ä»¥ä» wakatime è·å–ï¼š\næ—©èµ·çš„æ•°æ®ï¼Œæˆ‘ç›®å‰æ˜¯é€šè¿‡ ios workflow è‡ªåŠ¨åŒ–æ¥å®ç°çš„ã€‚å½“æ—©èµ·é—¹é’Ÿå“èµ·æ—¶ï¼Œå¾€ memos å†™å…¥ä¸€æ¡è®°å½•ã€‚\nå¦‚æœå¯ä»¥è·å–åˆ°è‹¹æœå±å¹•ä½¿ç”¨æ—¶é—´æ•°æ®ï¼Œåˆ™å¯ä»¥ä»è‹¹æœæ‰‹æœºè·å–æ¯æ—¥ç¬¬ä¸€æ¬¡æ‹¿èµ·æ‰‹æœºçš„æ—¶é—´ä½œä¸ºæ—©èµ·æ—¶é—´ï¼ˆå¾…ç ”ç©¶ï¼‰ã€‚\nå¯¼å‡ºè‹¹æœå¥åº·æ•°æ® å¦‚ä½•å¯¼å‡ºè‹¹æœå¥åº·æ•°æ®ï¼Ÿå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç«  æƒ³è¦åˆ†ææˆ–å¤‡ä»½ iPhone ã€Œå¥åº·ã€åº”ç”¨æ•°æ®ï¼Ÿæ•™ä½  3 ç§æ–¹æ³•å°†å…¶å¯¼å‡º ã€‚è¿™ç¯‡æ–‡ç« æåˆ°çš„ Health Export å·¥å…·å’Œ python è„šæœ¬æˆ‘éƒ½è¯•è¿‡ï¼ŒQS Access åœ¨æ‰‹æœºä¸Šæ²¡æœ‰æ‰¾åˆ°ã€‚\n1. Health Export åœ¨çº¿è§£æ Health Export æ˜¯å›½å¤–ä¸€åç‹¬ç«‹å¼€å‘è€…å†™çš„åœ¨çº¿è§£æå·¥å…·ï¼Œå®ƒä¸“é—¨ç”¨äºå°†å¥åº·åº”ç”¨å¯¼å‡ºçš„ XML æ–‡ä»¶è½¬æ¢ä¸º CSV æ–‡ä»¶ã€‚\nHealth Export æä¾›äº†ä¸€ä¸ª web ç½‘ç«™ å¯ä»¥è§£æä¼ è‹¹æœæ‰‹æœºå¯¼å‡ºçš„å¥åº·æ•°æ®ã€‚\nå¦‚ä½•ä» IPhone æ‰‹æœºå¯¼å‡ºè‹¹æœå¥åº·æ•°æ®å‘¢ï¼Ÿæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤å¯¼å‡ºè¿™äº›æ•°æ®ï¼š\næ‰“å¼€â€œå¥åº·â€åº”ç”¨ç¨‹åºã€‚ ç‚¹å‡»å±å¹•å³ä¸Šè§’çš„â€œä¸ªäººèµ„æ–™â€å›¾æ ‡ã€‚ æ»šåŠ¨åˆ°é¡µé¢åº•éƒ¨ï¼Œæ‰¾åˆ°â€œå¯¼å‡ºå¥åº·æ•°æ®â€é€‰é¡¹ï¼Œå¹¶ç‚¹å‡»å®ƒã€‚ åœ¨å¼¹å‡ºçª—å£ä¸­é€‰æ‹©è¦å¯¼å‡ºçš„æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚æ­¥æ•°ã€å¿ƒç‡ç­‰ã€‚ ç‚¹å‡»â€œä¸‹ä¸€æ­¥â€æŒ‰é’®ã€‚ åœ¨ä¸‹ä¸€ä¸ªé¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥é€‰æ‹©è¦å¯¼å‡ºçš„æ—¶é—´èŒƒå›´ã€‚æ‚¨å¯ä»¥é€‰æ‹©â€œå…¨éƒ¨æ•°æ®â€æˆ–æŒ‡å®šæ—¥æœŸèŒƒå›´ã€‚ ç‚¹å‡»â€œè¯·æ±‚å¯¼å‡ºâ€æŒ‰é’®ã€‚ æ‚¨å°†è¢«è¦æ±‚è¾“å…¥ä¸€ä¸ªå¯†ç ä»¥ä¿æŠ¤æ‚¨çš„æ•°æ®ã€‚è¾“å…¥å¯†ç åï¼Œç‚¹å‡»â€œä¸‹ä¸€æ­¥â€æŒ‰é’®ã€‚ åœ¨å¼¹å‡ºçª—å£ä¸­ï¼Œæ‚¨å¯ä»¥é€‰æ‹©å°†æ•°æ®å‘é€åˆ°æ‚¨çš„ç”µå­é‚®ä»¶åœ°å€æˆ–å…¶ä»–åº”ç”¨ç¨‹åºã€‚ ç‚¹å‡»â€œå¯¼å‡ºâ€æŒ‰é’®ã€‚ å®Œæˆè¿™äº›æ­¥éª¤åï¼Œæ‚¨çš„å¥åº·æ•°æ®å°†è¢«å¯¼å‡ºä¸ºä¸€ä¸ªå¯ä¸‹è½½çš„ zip æ–‡ä»¶ã€‚æ‚¨å¯ä»¥å°†å…¶ä¿å­˜åˆ°æ‚¨çš„è®¾å¤‡ä¸Šæˆ–å‘é€åˆ°å…¶ä»–åº”ç”¨ç¨‹åºæˆ–äº‘å­˜å‚¨æœåŠ¡ã€‚\nå°†å¯¼å‡ºçš„æ–‡ä»¶ export.xml ä¸Šä¼ åˆ° web ç½‘ç«™ ï¼Œç¨ç­‰ç‰‡åˆ»å¯ä»¥å¯¼å‡ºç»“æœã€‚å¯¼å‡ºçš„å¥åº·æ•°æ®æ˜¯ä¸€ä¸ªæŒ‡æ ‡ä¸€ä¸ª csv æ–‡ä»¶ï¼Œå¦‚æœæƒ³åˆå¹¶æ•°æ®ï¼Œéœ€è¦åšè¿›ä¸€æ­¥å¤„ç†ã€‚\nå¦å¤–ï¼ŒHealth Export ä¹Ÿæä¾›äº† IOS APPï¼ŒåŠŸèƒ½å¥½ç”¨ï¼Œæ”¯æŒé€‰æ‹©æŒ‡å®šæŒ‡æ ‡æ•°æ®æŒ‰æ—¥æœŸèšåˆå¯¼å‡ºä¸ºä¸€ä¸ª csvï¼Œè¿˜æœ‰å®šæ—¶å¯¼å‡ºçš„åŠŸèƒ½ï¼Œé—æ†¾çš„æ˜¯éœ€è¦æ”¶è´¹ã€‚\n2ã€ä½¿ç”¨ python è„šæœ¬ è¿™é‡Œä½¿ç”¨äº† @Radcliffe æä¾›çš„å¼€æºä»£ç ã€‚ç›®å‰ï¼ŒGithub å¯ä»¥åœ¨å›½å†…è‡ªç”±è®¿é—®ï¼Œæ‰€ä»¥ç›´æ¥é€šè¿‡æ­¤é“¾æ¥ä¸‹è½½åç§°ä¸º applehealthdata.py çš„è„šæœ¬æ–‡ä»¶ã€‚\nç„¶åï¼Œå°†ä¹‹å‰ä¸‹è½½å¥½çš„ å¯¼å‡º.xml ä¸è¯¥è„šæœ¬æ–‡ä»¶æ”¾ç½®åœ¨åŒä¸€ç›®å½•ä¸‹æ–¹ã€‚ä¸ºäº†é˜²æ­¢æŠ¥é”™ï¼Œè¿™é‡Œéœ€è¦å°† å¯¼å‡º.xml æ›´åä¸º export.xmlã€‚\næ¥ä¸‹æ¥ï¼Œåœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹æ‰“å¼€ç»ˆç«¯ï¼ˆmacOS \u0026amp; Linuxï¼‰æˆ–è€…å‘½ä»¤è¡Œå·¥å…·ï¼ˆWindowsï¼‰ï¼Œä½¿ç”¨ Python 2 æ‰§è¡Œè¯¥è„šæœ¬ï¼š\npython applehealthdata.py export.xml ç¨ç­‰ç‰‡åˆ»ï¼ŒXML æ–‡ä»¶å°±ä¼šè¢«è§£æä¸ºæ•°ä¸ª CSV æ–‡ä»¶äº†ã€‚\nè¿™é‡Œï¼Œæˆ‘å¯¹ applehealthdata.py è¿™ä¸ªæ–‡ä»¶åšäº†ä¸€ç‚¹ä¿®æ”¹ï¼Œåªå¯¼å‡ºæŒ‡å®šçš„æŒ‡æ ‡çš„æŒ‡å®šåˆ—çš„æ•°æ®ï¼Œä¿®æ”¹åçš„è„šæœ¬åœ¨ applehealthdata.pyã€‚ç›®å‰ï¼Œæˆ‘åªå…³æ³¨ä»¥ä¸‹ 6 ä¸ªæŒ‡æ ‡ï¼š\nRECORDS=[ \u0026#39;BodyFatPercentage\u0026#39;, \u0026#39;BodyMass\u0026#39;, \u0026#39;BodyMassIndex\u0026#39;, \u0026#39;DistanceWalkingRunning\u0026#39;, \u0026#39;LeanBodyMass\u0026#39;, \u0026#39;StepCount\u0026#39; ] è¿™ 6 ä¸ªæŒ‡æ ‡ä¸­æ–‡å«ä¹‰åˆ†åˆ«æ˜¯ï¼š\nBodyFatPercentageï¼šè„‚è‚ªç‡ BodyMassï¼šä½“é‡ BodyMassIndexï¼šBMI æŒ‡æ•° LeanBodyMassï¼šå‡€ä½“é‡ DistanceWalkingRunningï¼šèµ°è·¯è·‘æ­¥è·ç¦» StepCountï¼šèµ°è·¯æ­¥æ•° å¯¼å‡ºçš„åˆ—åªéœ€è¦ typeã€startDateã€value è¿™ 3 ä¸ªï¼š\nRECORD_FIELDS = OrderedDict(( # (\u0026#39;sourceName\u0026#39;, \u0026#39;s\u0026#39;), # (\u0026#39;sourceVersion\u0026#39;, \u0026#39;s\u0026#39;), # (\u0026#39;device\u0026#39;, \u0026#39;s\u0026#39;), (\u0026#39;type\u0026#39;, \u0026#39;s\u0026#39;), # (\u0026#39;unit\u0026#39;, \u0026#39;s\u0026#39;), # (\u0026#39;creationDate\u0026#39;, \u0026#39;d\u0026#39;), (\u0026#39;startDate\u0026#39;, \u0026#39;d\u0026#39;), # (\u0026#39;endDate\u0026#39;, \u0026#39;d\u0026#39;), (\u0026#39;value\u0026#39;, \u0026#39;n\u0026#39;), )) è¿™æ ·å¯¼å‡ºäº†è¿™ 6 ä¸ª csv æ–‡ä»¶ï¼š\nBodyMass.csv DistanceWalkingRunning.csv StepCount.csv BodyFatPercentage.csv BodyMassIndex.csv LeanBodyMass.csv æ¥ä¸‹æ¥ï¼ŒæŠŠè¿™ 6 ä¸ªæ–‡ä»¶å¯¼å…¥æ•°æ®åº“ï¼Œå¹¶è¿›è¡Œåˆå¹¶å¤„ç†ã€‚æ•°æ®åº“æˆ‘é€‰æ‹©çš„æ˜¯ postgresï¼Œä»¥ä¸Š 6 ä¸ªæ–‡ä»¶å¯¹äº 6 ä¸ªå»ºè¡¨è¯­å¥ï¼š\nCREATE SEQUENCE IF NOT EXISTS health_id_seq; CREATE TABLE \u0026#34;public\u0026#34;.\u0026#34;BodyFatPercentage\u0026#34; ( \u0026#34;id\u0026#34; int4 NOT NULL DEFAULT nextval(\u0026#39;health_id_seq\u0026#39;::regclass), \u0026#34;type\u0026#34; varchar, \u0026#34;start_date\u0026#34; timestamp, \u0026#34;value\u0026#34; float8, PRIMARY KEY (\u0026#34;id\u0026#34;) ); CREATE TABLE \u0026#34;public\u0026#34;.\u0026#34;BodyMass\u0026#34; ( \u0026#34;id\u0026#34; int4 NOT NULL DEFAULT nextval(\u0026#39;health_id_seq\u0026#39;::regclass), \u0026#34;type\u0026#34; varchar, \u0026#34;start_date\u0026#34; timestamp, \u0026#34;value\u0026#34; float8, PRIMARY KEY (\u0026#34;id\u0026#34;) ); CREATE TABLE \u0026#34;public\u0026#34;.\u0026#34;BodyMassIndex\u0026#34; ( \u0026#34;id\u0026#34; int4 NOT NULL DEFAULT nextval(\u0026#39;health_id_seq\u0026#39;::regclass), \u0026#34;type\u0026#34; varchar, \u0026#34;start_date\u0026#34; timestamp, \u0026#34;value\u0026#34; float8, PRIMARY KEY (\u0026#34;id\u0026#34;) ); CREATE TABLE \u0026#34;public\u0026#34;.\u0026#34;DistanceWalkingRunning\u0026#34; ( \u0026#34;id\u0026#34; int4 NOT NULL DEFAULT nextval(\u0026#39;health_id_seq\u0026#39;::regclass), \u0026#34;type\u0026#34; varchar, \u0026#34;start_date\u0026#34; timestamp, \u0026#34;value\u0026#34; float8, PRIMARY KEY (\u0026#34;id\u0026#34;) ); CREATE TABLE \u0026#34;public\u0026#34;.\u0026#34;LeanBodyMass\u0026#34; ( \u0026#34;id\u0026#34; int4 NOT NULL DEFAULT nextval(\u0026#39;health_id_seq\u0026#39;::regclass), \u0026#34;type\u0026#34; varchar, \u0026#34;start_date\u0026#34; timestamp, \u0026#34;value\u0026#34; float8, PRIMARY KEY (\u0026#34;id\u0026#34;) ); CREATE TABLE \u0026#34;public\u0026#34;.\u0026#34;StepCount\u0026#34; ( \u0026#34;id\u0026#34; int4 NOT NULL DEFAULT nextval(\u0026#39;health_id_seq\u0026#39;::regclass), \u0026#34;type\u0026#34; varchar, \u0026#34;start_date\u0026#34; timestamp, \u0026#34;value\u0026#34; float8, PRIMARY KEY (\u0026#34;id\u0026#34;) ); æˆ‘æƒ³æŠŠè¿™ 6 ä¸ªæ–‡ä»¶æŒ‰ç…§æ—¥æœŸåˆå¹¶åˆ°ä¸€ä¸ªè¡¨ä¸­ï¼Œäºæ˜¯åˆ›å»º health è¡¨ï¼š\nCREATE TABLE \u0026#34;public\u0026#34;.\u0026#34;health\u0026#34; ( \u0026#34;day\u0026#34; text NOT NULL, \u0026#34;fat_pct\u0026#34; float8, \u0026#34;bmi\u0026#34; float8, \u0026#34;lean_weight\u0026#34; float8, \u0026#34;step_count\u0026#34; float8, \u0026#34;step_distance\u0026#34; numeric, \u0026#34;weight\u0026#34; float8, PRIMARY KEY (\u0026#34;day\u0026#34;) ); æ¥ä¸‹æ¥ï¼Œé€šè¿‡ sql åˆå¹¶æ•°æ®æ’å…¥åˆ° health è¡¨ï¼š\ninsert into health select f.day,t.fat_pct,t.bmi,t.lean_weight,f.step_count,g.step_distance,t.weight from ( select to_char(start_date, \u0026#39;YYYY-MM-DD\u0026#39;) as day,sum(\u0026#34;value\u0026#34;) step_count from \u0026#34;StepCount\u0026#34; group by to_char(start_date, \u0026#39;YYYY-MM-DD\u0026#39;) ) f left outer join ( select to_char(start_date, \u0026#39;YYYY-MM-DD\u0026#39;) as day,round(cast(sum(\u0026#34;value\u0026#34;) as numeric) ,2) as step_distance from \u0026#34;DistanceWalkingRunning\u0026#34; group by to_char(start_date, \u0026#39;YYYY-MM-DD\u0026#39;) ) g on f.day=g.day left outer join ( select a.day,a.weight,e.\u0026#34;value\u0026#34; \u0026#34;lean_weight\u0026#34;,cast(c.\u0026#34;value\u0026#34;*100 as numeric) as \u0026#34;fat_pct\u0026#34;,d.\u0026#34;value\u0026#34; \u0026#34;bmi\u0026#34; from ( select to_char(start_date, \u0026#39;YYYY-MM-DD\u0026#39;) as day,min(start_date) as min_start_date,min(value) as weight from \u0026#34;BodyMass\u0026#34; group by day ) a left outer join \u0026#34;BodyFatPercentage\u0026#34; c on a.min_start_date=c.start_date left outer join \u0026#34;BodyMassIndex\u0026#34; d on a.min_start_date=d.start_date left outer join \u0026#34;LeanBodyMass\u0026#34; e on a.min_start_date=e.start_date order by a.day ) t on t.day=f.day order by f.day asc æœ€åçš„æ•°æ®å¦‚ä¸‹ï¼š\nå®Œæ•´çš„ csv æ–‡ä»¶ä¿å­˜åœ¨ health.csv ã€‚æœ‰äº›è®°å½•ä¸­ä½“é‡ç›¸å…³çš„æ•°æ®ä¸ºç©ºï¼Œè¿™æ˜¯å› ä¸ºä½“é‡ç›¸å…³æ•°æ®æ˜¯é€šè¿‡å…¶ä»–å’Œç”µå­ç§¤å…³è”çš„ app å†™è¿›å»çš„ã€‚è¦æƒ³æ¯å¤©éƒ½æœ‰ä½“é‡ç›¸å…³çš„æ•°æ®ï¼Œåˆ™éœ€è¦æ¯å¤©ä½¿ç”¨ç”µå­ç§°æµ‹é‡ä½“é‡ã€‚\nå¾—åˆ°è¿™ä»½æ•°æ®ä¹‹åï¼Œå°±å¯ä»¥è¿›è¡Œç»Ÿè®¡äº†ï¼Œæ¯”å¦‚ç»Ÿè®¡ä½“é‡çš„å˜åŒ–ã€æ¯å¤©èµ°è·¯çš„æ­¥æ•°ç­‰ç­‰ã€‚\nç†è´¢ è¿™å‘¨æ€»è®¡æ”¯å‡º 732 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š\n4 æœˆ 25 æ—¥ï¼š117 å…ƒï¼Œ100 å…ƒåŠ æ²¹ 4 æœˆ 26 æ—¥ï¼š59 å…ƒï¼Œä¹°è¯ 4 æœˆ 28 æ—¥ï¼š419 å…ƒï¼ŒåŠ æ²¹ 360 å…ƒ 4 æœˆ 29 æ—¥ï¼š21 å…ƒ 4 æœˆ 30 æ—¥ï¼š116 å…ƒ 4 æœˆç´¯è®¡æ”¯å‡ºå…± 3048 å…ƒï¼Œæ¯” 3 æœˆæ”¯å‡º 3520 å…ƒå°‘äº† 472 å…ƒã€‚ä¸»è¦æ”¯å‡ºæ¥è‡ªè¿™å‡ ä¸ªï¼š\näº¤é€šï¼š1177 å…ƒï¼Œå…¶ä¸­ 300 å…ƒæ˜¯ç¼´çº³ ETC æŠ¼é‡‘ é¤é¥®ï¼š827 å…ƒ è´­ç‰©ï¼š751 å…ƒ å¨±ä¹ï¼š216 å…ƒï¼Œçœ‹ç”µå½± å¥èº« å››æœˆè·‘æ­¥è®°å½•å¦‚ä¸‹ï¼Œæ€»è®¡è·‘äº† 16 å°æ—¶ã€125 å…¬é‡Œã€‚æ›´è¯¦ç»†æ•°æ®ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„ è·‘æ­¥ä¸»é¡µã€‚\nå·¥ä½œ Effective Java 3 ç¬”è®° è¯·å‚è€ƒ ã€ŠEffective Java 3ã€‹ç¬”è®° 4ï¼šç”¨ç§æœ‰æ„é€ å‡½æ•°ä½¿ç±»ä¸å¯å®ä¾‹åŒ– å’Œ ã€ŠEffective Java 3ã€‹ç¬”è®° 7ï¼šæ’é™¤è¿‡æ—¶çš„å¯¹è±¡å¼•ç”¨ã€‚\nFlexyPool FlexyPool æ˜¯ä¸€ä¸ªç”¨äºç›‘æ§æ•°æ®åº“è¿æ¥æ± çš„å¼€æºå·¥å…·ã€‚å®ƒæ”¯æŒç›‘æ§å’ŒæŠ¥å‘Šè¿æ¥æ± çš„ä½¿ç”¨æƒ…å†µã€æ€§èƒ½å’Œç“¶é¢ˆï¼Œä»¥åŠè‡ªåŠ¨è°ƒæ•´è¿æ¥æ± çš„å¤§å°å’Œè¡Œä¸ºã€‚FlexyPool æ”¯æŒå¤šç§æµè¡Œçš„ Java æ•°æ®åº“è¿æ¥æ± ï¼Œä¾‹å¦‚ HikariCPã€Tomcat JDBC Poolã€C3P0ã€BoneCP ç­‰ç­‰ã€‚\nFlexyPool ä¸»è¦æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š\nç›‘æ§è¿æ¥æ± çš„ä½¿ç”¨æƒ…å†µï¼ŒåŒ…æ‹¬è¿æ¥æ•°ã€è¯·æ±‚æ•°ã€ç­‰å¾…æ—¶é—´ã€æ‰§è¡Œæ—¶é—´ç­‰ç­‰ã€‚ æŠ¥å‘Šè¿æ¥æ± çš„æ€§èƒ½å’Œç“¶é¢ˆï¼Œä¾‹å¦‚æœ€æ…¢çš„æŸ¥è¯¢ã€æœ€é¢‘ç¹çš„é”™è¯¯ã€æœ€çŸ­çš„è¿æ¥æ—¶é—´ç­‰ç­‰ã€‚ è‡ªåŠ¨è°ƒæ•´è¿æ¥æ± çš„å¤§å°å’Œè¡Œä¸ºï¼Œä»¥æé«˜æ€§èƒ½å’Œå‡å°‘èµ„æºæ¶ˆè€—ã€‚ é›†æˆåˆ°å¸¸è§çš„ç›‘æ§å·¥å…·ä¸­ï¼Œä¾‹å¦‚ Prometheusã€Grafanaã€InfluxDB ç­‰ç­‰ã€‚ FlexyPool çš„ä½¿ç”¨ç›¸å¯¹ç®€å•ï¼Œåªéœ€è¦å°†å…¶æ·»åŠ åˆ°åº”ç”¨ç¨‹åºçš„ä¾èµ–ä¸­ï¼Œç„¶åé…ç½®è¿æ¥æ± å’Œ FlexyPool çš„å‚æ•°å³å¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨ HikariCP è¿æ¥æ± ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤é…ç½® FlexyPoolï¼š\n1ã€æ·»åŠ  FlexyPool çš„ä¾èµ–åˆ°åº”ç”¨ç¨‹åºçš„ pom.xml æ–‡ä»¶ä¸­ï¼š\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.vladmihalcea.flexypool\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;flexy-pool-core\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.0.2\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; 2ã€åœ¨åº”ç”¨ç¨‹åºçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½®è¿æ¥æ± å’Œ FlexyPool çš„å‚æ•°ï¼š\n# HikariCP æ•°æ®åº“è¿æ¥æ± é…ç½® hikari.dataSourceClassName=com.mysql.jdbc.jdbc2.optional.MysqlDataSource hikari.dataSource.url=jdbc:mysql://localhost:3306/mydb hikari.dataSource.user=root hikari.dataSource.password=secret hikari.minimumIdle=10 hikari.maximumPoolSize=20 hikari.idleTimeout=30000 hikari.poolName=hikariPool # FlexyPool é…ç½® flexyPool.metricsFactory=histogram flexyPool.metric.log.enabled=true flexyPool.metric.log.level=info flexyPool.metric.log.interval=10 flexyPool.metric.prometheus.enabled=true flexyPool.metric.prometheus.port=9090 åœ¨è¿™ä¸ªé…ç½®ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆé…ç½®äº† HikariCP è¿æ¥æ± çš„å‚æ•°ï¼Œç„¶åé…ç½®äº† FlexyPool çš„å‚æ•°ã€‚è¿™äº›å‚æ•°åŒ…æ‹¬åº¦é‡å·¥å‚ã€æ—¥å¿—å’Œåº¦é‡è®°å½•çš„çº§åˆ«ã€åº¦é‡è®°å½•çš„é—´éš”ã€æ˜¯å¦å¯ç”¨ Prometheus é›†æˆç­‰ç­‰ã€‚\n3ã€åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œå°† FlexyPool çš„ä»£ç†å¯¹è±¡æ·»åŠ åˆ°è¿æ¥æ± ä¸­ï¼š\nDataSource dataSource = ...; // è·å–è¿æ¥æ± å¯¹è±¡ FlexyPoolDataSource flexyPoolDataSource = new FlexyPoolDataSource\u0026lt;\u0026gt;(dataSource); åœ¨è¿™ä¸ªä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆè·å– HikariCP è¿æ¥æ± å¯¹è±¡ï¼Œç„¶åå°†å…¶åŒ…è£…æˆ FlexyPool çš„ä»£ç†å¯¹è±¡ã€‚è¿™æ ·ï¼Œæ‰€æœ‰çš„æ•°æ®åº“æ“ä½œéƒ½å°†é€šè¿‡ FlexyPool è¿›è¡Œä»£ç†å’Œç›‘æ§ã€‚\nBaeldung ç½‘ç«™ä¸Šæœ‰ä¸€ç¯‡ä»‹ç» Spring Boot ä¸­å¦‚ä½•ä½¿ç”¨ FlexyPool è¿æ¥æ± ç›‘æ§å·¥å…·çš„æ•™ç¨‹ï¼Œåä¸º A Guide to FlexyPool in Spring Bootã€‚\nè¿™ç¯‡æ–‡ç« é¦–å…ˆä»‹ç»äº† FlexyPool å·¥å…·çš„ä½œç”¨ï¼Œä»¥åŠå¦‚ä½•å°†å…¶é›†æˆåˆ° Spring Boot åº”ç”¨ç¨‹åºä¸­ã€‚FlexyPool å¯ä»¥ç›‘æ§å’ŒæŠ¥å‘Šè¿æ¥æ± çš„ä½¿ç”¨æƒ…å†µã€æ€§èƒ½å’Œç“¶é¢ˆï¼Œä»¥åŠè‡ªåŠ¨è°ƒæ•´è¿æ¥æ± çš„å¤§å°å’Œè¡Œä¸ºï¼Œä»¥æé«˜æ€§èƒ½å’Œå‡å°‘èµ„æºæ¶ˆè€—ã€‚\nç„¶åï¼Œæ–‡ç« ä»‹ç»äº†å¦‚ä½•åœ¨ Spring Boot åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ FlexyPoolã€‚å…·ä½“æ­¥éª¤åŒ…æ‹¬ï¼š\næ·»åŠ  FlexyPool çš„ä¾èµ–åˆ°åº”ç”¨ç¨‹åºçš„ pom.xml æ–‡ä»¶ä¸­ã€‚ é…ç½®è¿æ¥æ± å’Œ FlexyPool çš„å‚æ•°ï¼Œä¾‹å¦‚ HikariCP è¿æ¥æ± çš„å‚æ•°ã€FlexyPool çš„åº¦é‡å·¥å‚ã€æ—¥å¿—å’Œåº¦é‡è®°å½•çš„çº§åˆ«ã€åº¦é‡è®°å½•çš„é—´éš”ã€æ˜¯å¦å¯ç”¨ Prometheus é›†æˆç­‰ç­‰ã€‚ åˆ›å»º FlexyPoolDataSource å¯¹è±¡ï¼Œä½œä¸ºè¿æ¥æ± çš„ä»£ç†å¯¹è±¡ã€‚è¯¥å¯¹è±¡å°†è‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†è¿æ¥æ± ï¼Œå¹¶ä½¿ç”¨ FlexyPool å·¥å…·è¿›è¡Œç›‘æ§å’Œè°ƒæ•´ã€‚ åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨è¿æ¥æ± ï¼Œä¾‹å¦‚è·å–è¿æ¥ã€æ‰§è¡Œ SQL è¯­å¥ã€å…³é—­è¿æ¥ç­‰ç­‰ã€‚ æœ€åï¼Œæ–‡ç« æ€»ç»“äº†ä¸€äº›è¿æ¥æ± ç›‘æ§å’Œä¼˜åŒ–çš„æœ€ä½³å®è·µï¼Œä¾‹å¦‚ï¼š\nä½¿ç”¨ FlexyPool å·¥å…·ç›‘æ§è¿æ¥æ± çš„ä½¿ç”¨æƒ…å†µå’Œæ€§èƒ½ç“¶é¢ˆï¼Œä»¥åŠè°ƒæ•´è¿æ¥æ± çš„å¤§å°å’Œè¡Œä¸ºï¼Œä»¥æé«˜æ€§èƒ½å’Œå‡å°‘èµ„æºæ¶ˆè€—ã€‚ é…ç½®è¿æ¥æ± å’Œ FlexyPool çš„å‚æ•°ï¼Œä»¥é€‚åº”åº”ç”¨ç¨‹åºçš„è´Ÿè½½å’Œæ€§èƒ½è¦æ±‚ã€‚ é¿å…è¿æ¥æ± æ³„æ¼å’Œæ­»é”ç­‰é—®é¢˜ï¼Œä¾‹å¦‚åŠæ—¶å…³é—­è¿æ¥ã€è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ç­‰ç­‰ã€‚ æœ¬å‘¨åˆ†äº« å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€ChenSoul Shareã€Telegram é¢‘é“æˆ–è€…æˆ‘çš„ memos ä¸­ã€‚æˆ‘å†™äº†ä¸€ä¸ª python è„šæœ¬ä» memos è¯»å–æœ€è¿‘ä¸€å‘¨çš„ memos è®°å½•ã€‚\n2023-04-28 09:01:43 4 ä¸ªæ–‡ç”Ÿå›¾ AI å·¥å…· æŸ¥çœ‹é“¾æ¥ #memos 2023-04-27 13:29:50 è¿™æ˜¯ Jony Ive çš„ LoveFrom å›¢é˜Ÿå‡ºå“çš„ä¸€æœ¬å…³äºä¹”å¸ƒæ–¯çš„ä¹¦ï¼Œä¹¦ä¸­å‡ ä¹å…¨éƒ¨å¼•ç”¨ä¹”å¸ƒæ–¯è‡ªå·±çš„è¯ï¼Œæ²¡æœ‰è§£è¯»ï¼Œæ›´åŠ ã€ŒåŸæ±åŸå‘³ã€ï¼ŒåŒæ—¶ä¹Ÿæ”¶å½•äº†ä¸€äº›çè´µçš„ç…§ç‰‡ã€‚ æŸ¥çœ‹é“¾æ¥ æŸ¥çœ‹é“¾æ¥ #memos 2023-04-27 09:52:58 Alpine, Tailwind, Deno, SQLite æˆ‘çš„æœ¬åœ°æœåŠ¡å››ä»¶å¥— æŸ¥çœ‹é“¾æ¥ Update: ç”¨ Remix æ›¿ä»£äº† Alpine å’Œ Denoï¼Œç¡®å®æ–¹ä¾¿ã€‚ #web #memos 2023-04-27 08:32:37 FlexyPool æ˜¯ä¸€ä¸ªç”¨äºç›‘æ§æ•°æ®åº“è¿æ¥æ± çš„å¼€æºå·¥å…·ã€‚å®ƒæ”¯æŒç›‘æ§å’ŒæŠ¥å‘Šè¿æ¥æ± çš„ä½¿ç”¨æƒ…å†µã€æ€§èƒ½å’Œç“¶é¢ˆï¼Œä»¥åŠè‡ªåŠ¨è°ƒæ•´è¿æ¥æ± çš„å¤§å°å’Œè¡Œä¸ºã€‚FlexyPool æ”¯æŒå¤šç§æµè¡Œçš„ Java æ•°æ®åº“è¿æ¥æ± ï¼Œä¾‹å¦‚ HikariCPã€Tomcat JDBC Poolã€C3P0ã€BoneCP ç­‰ç­‰ã€‚ FlexyPool ä¸»è¦æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š ç›‘æ§è¿æ¥æ± çš„ä½¿ç”¨æƒ…å†µï¼ŒåŒ…æ‹¬è¿æ¥æ•°ã€è¯·æ±‚æ•°ã€ç­‰å¾…æ—¶é—´ã€æ‰§è¡Œæ—¶é—´ç­‰ç­‰ã€‚ æŠ¥å‘Šè¿æ¥æ± çš„æ€§èƒ½å’Œç“¶é¢ˆï¼Œä¾‹å¦‚æœ€æ…¢çš„æŸ¥è¯¢ã€æœ€é¢‘ç¹çš„é”™è¯¯ã€æœ€çŸ­çš„è¿æ¥æ—¶é—´ç­‰ç­‰ã€‚ è‡ªåŠ¨è°ƒæ•´è¿æ¥æ± çš„å¤§å°å’Œè¡Œä¸ºï¼Œä»¥æé«˜æ€§èƒ½å’Œå‡å°‘èµ„æºæ¶ˆè€—ã€‚ é›†æˆåˆ°å¸¸è§çš„ç›‘æ§å·¥å…·ä¸­ï¼Œä¾‹å¦‚ Prometheusã€Grafanaã€InfluxDB ç­‰ç­‰ã€‚ æŸ¥çœ‹é“¾æ¥ #java #memos 2023-04-27 07:24:03 äººä¸€ç”Ÿä¸­æœ€é‡è¦çš„ä¸¤å¤©å°±æ˜¯å‡ºç”Ÿé‚£å¤©å’Œå‘ç°äººç”Ÿç›®æ ‡çš„é‚£å¤©ã€‚ \u0026mdash;\u0026mdash;é©¬å…‹åæ¸© #æ‘˜å½• 2023-04-25 20:07:58 å— æŸ¥çœ‹é“¾æ¥ å¯å‘ï¼Œåœ¨ iPhone ä¸Šï¼Œåˆ›å»ºäº†ä¸€ä¸ªè‡ªåŠ¨åŒ–æ·å¾„ã€‚å½“æ—©èµ·é—¹é“ƒå“èµ·æ—¶ï¼Œå¾€ memos å‘é€ä¸€æ¡æ—©èµ·è®°å½•ï¼Œå†…å®¹å¦‚ä¸‹ï¼š æ—©èµ·æ—¶é—´ï¼š2023 å¹´ 4 æœˆ 25 æ—¥ 20:02 ä»Šæ—¥è¯­å½•ï¼š æœ‰äº›äº‹æƒ…æœ¬èº«æˆ‘ä»¬æ— æ³•æ§åˆ¶ï¼Œåªå¥½æ§åˆ¶è‡ªå·±ã€‚ èµ·åºŠå•¦ï¼Œå–æ¯å’–å•¡ï¼Œå»è·‘æ­¥ï¼Œæ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹ã€‚ #memos 2023-04-25 08:57:03 ã€æ€æ ·ç§æ—¶é—´çš„ç§å­ï¼Ÿã€‘ æ—¶é—´ä¸å¤Ÿç”¨ï¼Œå¦‚ä½•ç§æ—¶é—´çš„ç§å­ï¼Ÿ 1.èµ°ç”µæ¢¯æ—¶è€å¿ƒç­‰å€™è‡ªåŠ¨å…³é—¨ï¼Œè®©æ›´å¤šçš„äººè¿›æ¥ï¼ŒèŠ‚çº¦äº†ä»–ä»¬çš„æ—¶é—´ã€‚ï¼ˆè¿™è¿˜æ˜¯ä¸€é¢—ç©ºé—´ã€æˆ¿å­çš„ç§å­ï¼‰ 2.å¸®çˆ¶æ¯å®Œæˆå¥¹çš„å¿ƒæ„¿æˆ–è€…äº‹åŠ¡æ€§å·¥ä½œã€‚ 3.æ•™ä¼šå®¶é‡Œçš„å°å­©å­å¦‚ä½•èŠ‚çº¦çˆ¶æ¯çš„æ—¶é—´ï¼Œè¿™ä¸ªå°±éå¸¸é«˜çº§äº†ã€‚ 4.è·¯ä¸Šéšæ‰‹æ¡èµ°åƒåœ¾ã€ä¸ä¹±æ‰”åƒåœ¾ï¼Œè®©æ¸…æ´å·¥äººæœ‰æ›´å¤šçš„æ—¶é—´ã€‚ 5.å¸®åŠ©è€å¸ˆæˆ–è€…æœ‰æ›´å¤šèƒ½é‡çš„å¹³å°åšäº‹æƒ…ã€‚ 6.ç»å¸¸æ€§çš„åšä¹‰å·¥ã€‚ 7.æ‰“ç”µè¯é•¿è¯çŸ­è¯´ï¼Œç®€æ´æ˜äº†èŠ‚çº¦å¯¹æ–¹çš„æ—¶é—´ã€‚ 8.å¾®ä¿¡å°½å¯èƒ½ç”¨æ‰“å­—ï¼Œè®©å¯¹æ–¹å¿«é€Ÿç®€å•åœ°çŸ¥é“äº‹æƒ…ã€‚ 9.å¼€ä¼šæå‰åˆ°ï¼Œè‡³å°‘å‡†æ—¶åˆ°ï¼Œåƒä¸‡ä¸èƒ½è¿Ÿåˆ°ï¼Œä¼šè®®è¿Ÿåˆ°ï¼Œé‚£ç§ä¸‹çš„éƒ½æ˜¯å·¨å¤§çš„ç§å­ã€‚ 10.å¼€è½¦è®©äººï¼Œè…¾å‡ºæ—¶é—´ç»™åˆ«äººã€‚ 11.å¼€å¿ƒæ”¶æ‹¾å®¶åŠ¡ï¼Œè®©å®¶äººæ›´åŠ å®¹æ˜“æ‰¾åˆ°ä¸œè¥¿ã€‚ 12.ä¸»åŠ¨æ”¶æ‹¾å…¬å…±åŠå…¬åŒºåŸŸï¼Œè®©åŒäº‹å¿«é€Ÿæœ‰æ•ˆå·¥ä½œã€‚ 13.ä¸é—²èŠå…«å¦æµªè´¹åˆ«äººæ—¶é—´ï¼ˆè¿™é¢—é—²èŠå…«å¦çš„åç§å­ï¼Œè¿˜ä¼šè®©ä½ åœ¨å·¥ä½œä¸­æ²¡æœ‰äººå¬ä»ä½ çš„å¥½æ„è§ï¼Œç¼ºä¹é¢†å¯¼åŠ›ï¼‰ 14.å‚åŠ ä»»ä½•ä¼šè®®æå‰å‡†å¤‡ï¼Œç§¯æå›åº”ã€‚ 15.ä¸åˆ«äººåˆ†äº«æ—¶é—´çš„ç®¡ç†å·¥å…·ï¼Œåˆ†äº«è·å¾—å¯Œè£•æ—¶é—´çš„å¥½ç§å­ï¼Œè¿™å¯ä¹Ÿæ˜¯æ³•å¸ƒæ–½çš„å¥½ç§å­ã€‚ 16.æé†’ã€å¸®åŠ©æˆ–è€…å…³æ³¨æ‹–å»¶ç—‡çš„æœ‹å‹ã€‚ 17.ä¸çˆ½çº¦çˆ¶æ¯å®‰æ’çš„èšé¤åƒé¥­ï¼Œä¸å›å®¶åƒé¥­æå‰è¯´ã€‚ï¼ˆæ©ç”°çš„å¤§ç§å­ï¼‰ 18.é¼“åŠ±åˆ«äººçš„æ¢¦æƒ³ï¼ŒçœŸè¯šç”±å¿ƒåœ°èµç¾åˆ«äººã€‚ #é‡‘åˆšæ™ºæ…§ 2023-04-24 19:21:02 æœ‰ä¸€ä¸ªæƒ³æ³•ï¼Œå¯ä»¥å†™ä¸€æ®µè„šæœ¬ä» telegram æˆ–è€… memos è¯»å–ä¸Šå‘¨çš„åˆ†äº«è®°å½•ï¼Œç„¶åï¼Œè½¬æ¢ä¸º markdown æ ¼å¼å‘å¸ƒåœ¨å‘¨æŠ¥ä¸­ã€‚è¿™æ ·ï¼Œå‘¨æŠ¥å°±å¯ä»¥å˜æˆåŠè‡ªåŠ¨åŒ–äº†ã€‚ äºæ˜¯ï¼Œå†™äº†ä¸€ä¸ª python è„šæœ¬å®ç°äº†ä» memos è¯»å–è®°å½•ã€‚ğŸ˜ #skill 2023-04-24 17:26:52 æ™šå”æå•†éšçš„ã€Šé”¦ç‘Ÿã€‹ é”¦ç‘Ÿæ— ç«¯äº”åå¼¦ï¼Œä¸€å¼¦ä¸€æŸ±æ€åå¹´ã€‚ åº„ç”Ÿæ™“æ¢¦è¿·è´è¶ï¼Œæœ›å¸æ˜¥å¿ƒæ‰˜æœé¹ƒã€‚ æ²§æµ·æœˆæ˜ç æœ‰æ³ªï¼Œè“ç”°æ—¥æš–ç‰ç”ŸçƒŸã€‚ æ­¤æƒ…å¯å¾…æˆè¿½å¿†ï¼Œåªæ˜¯å½“æ—¶å·²æƒ˜ç„¶ã€‚ #è¯—è¯ 2023-04-24 14:07:04 ä½¿ç”¨ä¸€è¡Œä»£ç ä¸ºç½‘ç«™çš„è¾“å…¥æ¡†å¢åŠ ä¸Š AI èƒ½åŠ›ã€‚ æŸ¥çœ‹é“¾æ¥ #skill 2023-04-24 14:04:23 å¹³å¸¸æ˜¯ç³Šé‡Œç³Šæ¶‚çš„ï¼Œç°åœ¨å˜å¾—å‡ºäººæ„å¤–çš„å°å¿ƒè°¨æ…ï¼Œè¿™æ­£æ˜¯ç”±äºæŠ¥å¤çš„æ¬²æœ›ï¼Œè€Œè¿™ç§æ¬²æœ›å¤šä¹ˆèƒ½å¤Ÿé”»ç‚¼äººï¼ â€”â€” å¤§ä»²é©¬ #æ‘˜å½• 2023-04-24 14:03:59 ä½¿äººç–²ä¹çš„ä¸æ˜¯è¿œæ–¹çš„æ·±è°·ï¼Œè€Œæ˜¯é‹å­é‡Œçš„ä¸€ç²’æ²™å­ã€‚ â€”â€” ä¼å°”æ³° #æ‘˜å½• 2023-04-24 11:00:30 ğŸ“ ã€ŠEffective Java 3ã€‹ç¬”è®°ï¼šé¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ #blog æŸ¥çœ‹é“¾æ¥ 2023-04-24 08:20:31 ä½¿ç”¨ Python å®ç° RSS è½¬ Newsletter. æŸ¥çœ‹é“¾æ¥ #python ä»¥ä¸Šã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/05/06/weekly_review_17/","summary":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-04-24 åˆ° 2023-04-30 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\næœ¬å‘¨äºŒæ—©ä¸Šè·‘æ­¥å³å°è…¿æŠ½ç­‹ï¼Œè·‘æ­¥æš‚åœäº†ä¸¤å¤©ï¼Œæ‰€ä»¥æœ‰ä¸¤å¤©èµ°è·¯æ²¡æœ‰åˆ°ä¸€ä¸‡æ­¥ã€‚åœ¨å°è…¿æ¢å¤ä¹‹åï¼Œç»§ç»­è·‘æ­¥ï¼ŒæŸ¥çœ‹ strava ä¸Šçš„ç»Ÿè®¡ï¼Œè¿™å‘¨æ€»å…±è·‘äº† 27 å…¬é‡Œï¼Œæ¯”ä¸Šå‘¨ 41 å…¬é‡Œå°‘äº† 14 å…¬é‡Œã€‚\nè¿™å‘¨ç©ºé—²æ—¶é—´å°±åœ¨æƒ³ï¼Œèƒ½ä¸èƒ½æ¯å¤©è‡ªåŠ¨æ”¶é›†ä¸ªäººçš„ä¸€äº›æ•°æ®ï¼Œæ¯”å¦‚ï¼Œç›®å‰æˆ‘èƒ½æƒ³åˆ°çš„æ•°æ®åŒ…æ‹¬è·‘æ­¥ã€èµ°è·¯ã€ä½“é‡ã€ç¼–ç ã€æ—©èµ·ç­‰ç­‰ã€‚\nç›®å‰æ˜¯ä½¿ç”¨ strava app è®°å½•è·‘æ­¥æ•°æ®ï¼Œé€šè¿‡ running_page å¯ä»¥å®æ—¶æ”¶é›†æˆ‘çš„æ¯å¤© è·‘æ­¥æ•°æ®ã€‚\nèµ°è·¯ã€ä½“é‡æ•°æ®å¯ä»¥ä»è‹¹æœå¥åº·æ•°æ®è·å–ï¼š\nç¼–ç æ•°æ®å¯ä»¥ä» wakatime è·å–ï¼š\næ—©èµ·çš„æ•°æ®ï¼Œæˆ‘ç›®å‰æ˜¯é€šè¿‡ ios workflow è‡ªåŠ¨åŒ–æ¥å®ç°çš„ã€‚å½“æ—©èµ·é—¹é’Ÿå“èµ·æ—¶ï¼Œå¾€ memos å†™å…¥ä¸€æ¡è®°å½•ã€‚\nå¦‚æœå¯ä»¥è·å–åˆ°è‹¹æœå±å¹•ä½¿ç”¨æ—¶é—´æ•°æ®ï¼Œåˆ™å¯ä»¥ä»è‹¹æœæ‰‹æœºè·å–æ¯æ—¥ç¬¬ä¸€æ¬¡æ‹¿èµ·æ‰‹æœºçš„æ—¶é—´ä½œä¸ºæ—©èµ·æ—¶é—´ï¼ˆå¾…ç ”ç©¶ï¼‰ã€‚\nå¯¼å‡ºè‹¹æœå¥åº·æ•°æ® å¦‚ä½•å¯¼å‡ºè‹¹æœå¥åº·æ•°æ®ï¼Ÿå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç«  æƒ³è¦åˆ†ææˆ–å¤‡ä»½ iPhone ã€Œå¥åº·ã€åº”ç”¨æ•°æ®ï¼Ÿæ•™ä½  3 ç§æ–¹æ³•å°†å…¶å¯¼å‡º ã€‚è¿™ç¯‡æ–‡ç« æåˆ°çš„ Health Export å·¥å…·å’Œ python è„šæœ¬æˆ‘éƒ½è¯•è¿‡ï¼ŒQS Access åœ¨æ‰‹æœºä¸Šæ²¡æœ‰æ‰¾åˆ°ã€‚\n1. Health Export åœ¨çº¿è§£æ Health Export æ˜¯å›½å¤–ä¸€åç‹¬ç«‹å¼€å‘è€…å†™çš„åœ¨çº¿è§£æå·¥å…·ï¼Œå®ƒä¸“é—¨ç”¨äºå°†å¥åº·åº”ç”¨å¯¼å‡ºçš„ XML æ–‡ä»¶è½¬æ¢ä¸º CSV æ–‡ä»¶ã€‚\nHealth Export æä¾›äº†ä¸€ä¸ª web ç½‘ç«™ å¯ä»¥è§£æä¼ è‹¹æœæ‰‹æœºå¯¼å‡ºçš„å¥åº·æ•°æ®ã€‚\nå¦‚ä½•ä» IPhone æ‰‹æœºå¯¼å‡ºè‹¹æœå¥åº·æ•°æ®å‘¢ï¼Ÿæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤å¯¼å‡ºè¿™äº›æ•°æ®ï¼š\næ‰“å¼€â€œå¥åº·â€åº”ç”¨ç¨‹åºã€‚ ç‚¹å‡»å±å¹•å³ä¸Šè§’çš„â€œä¸ªäººèµ„æ–™â€å›¾æ ‡ã€‚ æ»šåŠ¨åˆ°é¡µé¢åº•éƒ¨ï¼Œæ‰¾åˆ°â€œå¯¼å‡ºå¥åº·æ•°æ®â€é€‰é¡¹ï¼Œå¹¶ç‚¹å‡»å®ƒã€‚ åœ¨å¼¹å‡ºçª—å£ä¸­é€‰æ‹©è¦å¯¼å‡ºçš„æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚æ­¥æ•°ã€å¿ƒç‡ç­‰ã€‚ ç‚¹å‡»â€œä¸‹ä¸€æ­¥â€æŒ‰é’®ã€‚ åœ¨ä¸‹ä¸€ä¸ªé¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥é€‰æ‹©è¦å¯¼å‡ºçš„æ—¶é—´èŒƒå›´ã€‚æ‚¨å¯ä»¥é€‰æ‹©â€œå…¨éƒ¨æ•°æ®â€æˆ–æŒ‡å®šæ—¥æœŸèŒƒå›´ã€‚ ç‚¹å‡»â€œè¯·æ±‚å¯¼å‡ºâ€æŒ‰é’®ã€‚ æ‚¨å°†è¢«è¦æ±‚è¾“å…¥ä¸€ä¸ªå¯†ç ä»¥ä¿æŠ¤æ‚¨çš„æ•°æ®ã€‚è¾“å…¥å¯†ç åï¼Œç‚¹å‡»â€œä¸‹ä¸€æ­¥â€æŒ‰é’®ã€‚ åœ¨å¼¹å‡ºçª—å£ä¸­ï¼Œæ‚¨å¯ä»¥é€‰æ‹©å°†æ•°æ®å‘é€åˆ°æ‚¨çš„ç”µå­é‚®ä»¶åœ°å€æˆ–å…¶ä»–åº”ç”¨ç¨‹åºã€‚ ç‚¹å‡»â€œå¯¼å‡ºâ€æŒ‰é’®ã€‚ å®Œæˆè¿™äº›æ­¥éª¤åï¼Œæ‚¨çš„å¥åº·æ•°æ®å°†è¢«å¯¼å‡ºä¸ºä¸€ä¸ªå¯ä¸‹è½½çš„ zip æ–‡ä»¶ã€‚æ‚¨å¯ä»¥å°†å…¶ä¿å­˜åˆ°æ‚¨çš„è®¾å¤‡ä¸Šæˆ–å‘é€åˆ°å…¶ä»–åº”ç”¨ç¨‹åºæˆ–äº‘å­˜å‚¨æœåŠ¡ã€‚\nå°†å¯¼å‡ºçš„æ–‡ä»¶ export.xml ä¸Šä¼ åˆ° web ç½‘ç«™ ï¼Œç¨ç­‰ç‰‡åˆ»å¯ä»¥å¯¼å‡ºç»“æœã€‚å¯¼å‡ºçš„å¥åº·æ•°æ®æ˜¯ä¸€ä¸ªæŒ‡æ ‡ä¸€ä¸ª csv æ–‡ä»¶ï¼Œå¦‚æœæƒ³åˆå¹¶æ•°æ®ï¼Œéœ€è¦åšè¿›ä¸€æ­¥å¤„ç†ã€‚\nå¦å¤–ï¼ŒHealth Export ä¹Ÿæä¾›äº† IOS APPï¼ŒåŠŸèƒ½å¥½ç”¨ï¼Œæ”¯æŒé€‰æ‹©æŒ‡å®šæŒ‡æ ‡æ•°æ®æŒ‰æ—¥æœŸèšåˆå¯¼å‡ºä¸ºä¸€ä¸ª csvï¼Œè¿˜æœ‰å®šæ—¶å¯¼å‡ºçš„åŠŸèƒ½ï¼Œé—æ†¾çš„æ˜¯éœ€è¦æ”¶è´¹ã€‚\n2ã€ä½¿ç”¨ python è„šæœ¬ è¿™é‡Œä½¿ç”¨äº† @Radcliffe æä¾›çš„å¼€æºä»£ç ã€‚ç›®å‰ï¼ŒGithub å¯ä»¥åœ¨å›½å†…è‡ªç”±è®¿é—®ï¼Œæ‰€ä»¥ç›´æ¥é€šè¿‡æ­¤é“¾æ¥ä¸‹è½½åç§°ä¸º applehealthdata.","title":"å‘¨æŠ¥-17ï½œå¯¼å‡ºè‹¹æœå¥åº·æ•°æ®ã€è‡ªåŠ¨åŒ–æ”¶é›†ä¸ªäººæ•°æ®ã€FlexyPoolåŠ¨æ€è¿æ¥æ± "},{"content":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼šæ’é™¤è¿‡æ—¶çš„å¯¹è±¡å¼•ç”¨ã€‚\nä»‹ç» \u0026ldquo;Eliminate obsolete object references\u0026rdquo; æ˜¯ä¸€æ¡ Java ç¼–ç¨‹æœ€ä½³å®è·µçš„åŸåˆ™ï¼ŒæŒ‡çš„æ˜¯åœ¨ä»£ç ä¸­åŠæ—¶æ¸…ç†ä¸å†ä½¿ç”¨çš„å¯¹è±¡å¼•ç”¨ï¼Œä»¥é¿å…å†…å­˜æ³„æ¼å’Œæ€§èƒ½é—®é¢˜ã€‚å½“ä¸€ä¸ªå¯¹è±¡ä¸å†éœ€è¦æ—¶ï¼Œåº”è¯¥å°½å¿«å°†å…¶å¼•ç”¨è®¾ç½®ä¸º nullï¼Œè¿™æ · JVM å¯ä»¥åŠæ—¶å›æ”¶å®ƒæ‰€å ç”¨çš„å†…å­˜ã€‚\nè€ƒè™‘ä»¥ä¸‹ç®€å•çš„å †æ ˆå®ç°ï¼š\nimport java.util.Arrays; import java.util.EmptyStackException; // Can you spot the \u0026#34;memory leak\u0026#34;? public class Stack { private Object[] elements; private int size = 0; private static final int DEFAULT_INITIAL_CAPACITY = 16; public Stack() { elements = new Object[DEFAULT_INITIAL_CAPACITY]; } public void push(Object e) { ensureCapacity(); elements[size++] = e; } public Object pop() { if (size == 0) throw new EmptyStackException(); return elements[--size]; } /** * Ensure space for at least one more element, roughly * doubling the capacity each time the array needs to grow. */ private void ensureCapacity() { if (elements.length == size) elements = Arrays.copyOf(elements, 2 * size + 1); } } è¿™ä¸ªç¨‹åºæ²¡æœ‰æ˜æ˜¾çš„é”™è¯¯ã€‚ä½ å¯ä»¥å¯¹å®ƒè¿›è¡Œè¯¦å°½çš„æµ‹è¯•ï¼Œå®ƒä¼šä»¥ä¼˜å¼‚çš„æˆç»©é€šè¿‡æ‰€æœ‰çš„æµ‹è¯•ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªæ½œåœ¨çš„é—®é¢˜ã€‚ç®€å•åœ°è¯´ï¼Œè¯¥ç¨‹åºæœ‰ä¸€ä¸ªã€Œå†…å­˜æ³„æ¼ã€é—®é¢˜ï¼Œç”±äºåƒåœ¾æ”¶é›†å™¨æ´»åŠ¨çš„å¢åŠ æˆ–å†…å­˜å ç”¨çš„å¢åŠ ï¼Œå®ƒå¯ä»¥æ‚„æ— å£°æ¯åœ°è¡¨ç°ä¸ºæ€§èƒ½çš„é™ä½ã€‚åœ¨æç«¯æƒ…å†µä¸‹ï¼Œè¿™ç§å†…å­˜æ³„æ¼å¯èƒ½å¯¼è‡´ç£ç›˜åˆ†é¡µï¼Œç”šè‡³å‡ºç° OutOfMemoryError ç¨‹åºæ•…éšœï¼Œä½†è¿™ç§æ•…éšœç›¸å¯¹å°‘è§ã€‚\né‚£ä¹ˆå†…å­˜æ³„æ¼åœ¨å“ªé‡Œå‘¢ï¼Ÿå¦‚æœå †æ ˆå¢é•¿ï¼Œç„¶åæ”¶ç¼©ï¼Œé‚£ä¹ˆä»å †æ ˆä¸­å¼¹å‡ºçš„å¯¹è±¡å°†ä¸ä¼šè¢«åƒåœ¾æ”¶é›†ï¼Œå³ä½¿ä½¿ç”¨å †æ ˆçš„ç¨‹åºä¸å†å¼•ç”¨å®ƒä»¬ã€‚è¿™æ˜¯å› ä¸ºæ ˆä¿ç•™äº†è¿™äº›å¯¹è±¡çš„æ—§å¼•ç”¨ã€‚ä¸€ä¸ªè¿‡æ—¶çš„å¼•ç”¨ï¼Œæ˜¯æŒ‡æ°¸è¿œä¸ä¼šè¢«å–æ¶ˆçš„å¼•ç”¨ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå…ƒç´ æ•°ç»„çš„ã€Œæ´»åŠ¨éƒ¨åˆ†ã€ä¹‹å¤–çš„ä»»ä½•å¼•ç”¨éƒ½å·²è¿‡æ—¶ã€‚æ´»åŠ¨éƒ¨åˆ†ç”±ç´¢å¼•å°äºå¤§å°çš„å…ƒç´ ç»„æˆã€‚\nåƒåœ¾æ”¶é›†è¯­è¨€ä¸­çš„å†…å­˜æ³„æ¼ï¼ˆæ›´ç¡®åˆ‡åœ°è¯´æ˜¯æ— æ„çš„å¯¹è±¡ä¿ç•™ï¼‰æ˜¯æš—è—çš„é£é™©ã€‚å¦‚æœæ— æ„ä¸­ä¿ç•™äº†å¯¹è±¡å¼•ç”¨ï¼Œé‚£ä¹ˆå¯¹è±¡ä¸ä»…è¢«æ’é™¤åœ¨åƒåœ¾æ”¶é›†ä¹‹å¤–ï¼Œè¯¥å¯¹è±¡å¼•ç”¨çš„ä»»ä½•å¯¹è±¡ä¹Ÿè¢«æ’é™¤åœ¨å¤–ï¼Œä¾æ­¤ç±»æ¨ã€‚å³ä½¿åªæ˜¯æ— æ„ä¸­ä¿ç•™äº†ä¸€äº›å¯¹è±¡å¼•ç”¨ï¼Œè®¸å¤šè®¸å¤šçš„å¯¹è±¡ä¹Ÿå¯èƒ½è¢«é˜»æ­¢è¢«åƒåœ¾æ”¶é›†ï¼Œä»è€Œå¯¹æ€§èƒ½äº§ç”Ÿæ½œåœ¨çš„å·¨å¤§å½±å“ã€‚\nè§£å†³è¿™ç±»é—®é¢˜çš„æ–¹æ³•å¾ˆç®€å•ï¼šä¸€æ—¦å¼•ç”¨è¿‡æ—¶ï¼Œå°±å°†ç½®ç©ºã€‚åœ¨æˆ‘ä»¬çš„ Stack ç±»ä¸­ï¼Œå¯¹æŸä¸ªé¡¹çš„å¼•ç”¨ä¸€æ—¦ä»å †æ ˆä¸­å¼¹å‡ºå°±ä¼šè¿‡æ—¶ã€‚pop æ–¹æ³•çš„æ­£ç¡®ç‰ˆæœ¬å¦‚ä¸‹ï¼š\npublic Object pop() { if (size == 0) throw new EmptyStackException(); Object result = elements[--size]; elements[size] = null; // Eliminate obsolete reference return result; } ç”¨ null å¤„ç†è¿‡æ—¶å¼•ç”¨çš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œå¦‚æœå®ƒä»¬éšåè¢«é”™è¯¯åœ°å…³è”å¼•ç”¨ï¼Œç¨‹åºå°†ç«‹å³å¤±è´¥ï¼Œå‡ºç° NullPointerExceptionï¼Œè€Œä¸æ˜¯æ‚„æ‚„åœ°åšé”™è¯¯çš„äº‹æƒ…ã€‚å°½å¯èƒ½å¿«åœ°æ£€æµ‹ç¼–ç¨‹é”™è¯¯æ€»æ˜¯æœ‰ç›Šçš„ã€‚\né‚£ä¹ˆï¼Œä»€ä¹ˆæ—¶å€™åº”è¯¥å–æ¶ˆå¼•ç”¨å‘¢ï¼ŸStack ç±»çš„å“ªäº›æ–¹é¢å®¹æ˜“å¯¼è‡´å†…å­˜æ³„æ¼ï¼Ÿç®€å•åœ°è¯´ï¼Œå®ƒç®¡ç†è‡ªå·±çš„å†…å­˜ã€‚å­˜å‚¨æ± åŒ…å«å…ƒç´ æ•°ç»„çš„å…ƒç´ ï¼ˆå¯¹è±¡å¼•ç”¨å•å…ƒï¼Œè€Œä¸æ˜¯å¯¹è±¡æœ¬èº«ï¼‰æ•°ç»„çš„æ´»åŠ¨éƒ¨åˆ†ï¼ˆå¦‚å‰é¢æ‰€å®šä¹‰çš„ï¼‰ä¸­çš„å…ƒç´ è¢«åˆ†é…ï¼Œè€Œæ•°ç»„å…¶ä½™éƒ¨åˆ†ä¸­çš„å…ƒç´ æ˜¯ç©ºé—²çš„ã€‚åƒåœ¾æ”¶é›†å™¨æ²¡æœ‰åŠæ³•çŸ¥é“è¿™ä¸€ç‚¹ï¼›å¯¹äºåƒåœ¾æ”¶é›†å™¨ï¼Œå…ƒç´ æ•°ç»„ä¸­çš„æ‰€æœ‰å¯¹è±¡å¼•ç”¨éƒ½åŒæ ·æœ‰æ•ˆã€‚åªæœ‰ç¨‹åºå‘˜çŸ¥é“æ•°ç»„çš„éæ´»åŠ¨éƒ¨åˆ†ä¸é‡è¦ã€‚åªè¦æ•°ç»„å…ƒç´ æˆä¸ºéæ´»åŠ¨éƒ¨åˆ†çš„ä¸€éƒ¨åˆ†ï¼Œç¨‹åºå‘˜å°±å¯ä»¥é€šè¿‡æ‰‹åŠ¨æ¸…ç©ºæ•°ç»„å…ƒç´ ï¼Œæœ‰æ•ˆåœ°å°†è¿™ä¸ªäº‹å®ä¼ é€’ç»™åƒåœ¾æ”¶é›†å™¨ã€‚\nä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªç±»ç®¡ç†å®ƒè‡ªå·±çš„å†…å­˜æ—¶ï¼Œç¨‹åºå‘˜åº”è¯¥è­¦æƒ•å†…å­˜æ³„æ¼ã€‚å½“é‡Šæ”¾ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œè¯¥å…ƒç´ ä¸­åŒ…å«çš„ä»»ä½•å¯¹è±¡å¼•ç”¨éƒ½åº”è¯¥è¢«ç½®ä¸º nullã€‚\nå¦ä¸€ä¸ªå¸¸è§çš„å†…å­˜æ³„æ¼æºæ˜¯ç¼“å­˜ã€‚ ä¸€æ—¦å°†å¯¹è±¡å¼•ç”¨æ”¾å…¥ç¼“å­˜ä¸­ï¼Œå°±å¾ˆå®¹æ˜“å¿˜è®°å®ƒå°±åœ¨é‚£é‡Œï¼Œå¹¶ä¸”åœ¨å®ƒå˜å¾—æ— å…³ç´§è¦ä¹‹åå¾ˆä¹…ä»å°†å®ƒç•™åœ¨ç¼“å­˜ä¸­ã€‚æœ‰å‡ ä¸ªè§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³•ã€‚å¦‚æœä½ éå¸¸å¹¸è¿åœ°å®ç°äº†ä¸€ä¸ªç¼“å­˜ï¼Œåªè¦ç¼“å­˜å¤–æœ‰å¯¹å…¶é”®çš„å¼•ç”¨ï¼Œé‚£ä¹ˆå°±å°†ç¼“å­˜è¡¨ç¤ºä¸º WeakHashMapï¼›å½“æ¡ç›®è¿‡æ—¶åï¼Œæ¡ç›®å°†è¢«è‡ªåŠ¨åˆ é™¤ã€‚è®°ä½ï¼ŒWeakHashMap åªæœ‰åœ¨ç¼“å­˜æ¡ç›®çš„é¢„æœŸç”Ÿå­˜æœŸç”±é”®çš„å¤–éƒ¨å¼•ç”¨ï¼ˆè€Œä¸æ˜¯å€¼ï¼‰å†³å®šæ—¶æ‰æœ‰ç”¨ã€‚\næ›´å¸¸è§çš„æƒ…å†µæ˜¯ï¼Œç¼“å­˜æ¡ç›®çš„æœ‰æ•ˆç”Ÿå­˜æœŸå®šä¹‰ä¸å¤ªå¥½ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œæ¡ç›®çš„ä»·å€¼ä¼šè¶Šæ¥è¶Šä½ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¼“å­˜å¶å°”åº”è¯¥æ¸…ç†é‚£äº›å·²ç»åœç”¨çš„æ¡ç›®ã€‚è¿™å¯ä»¥é€šè¿‡åå°çº¿ç¨‹ï¼ˆå¯èƒ½æ˜¯ ScheduledThreadPoolExecutorï¼‰æˆ–å‘ç¼“å­˜æ·»åŠ æ–°æ¡ç›®æ—¶é¡ºä¾¿å®Œæˆã€‚LinkedHashMap ç±»é€šè¿‡å…¶ removeEldestEntry æ–¹æ³•ç®€åŒ–äº†åä¸€ç§æ–¹æ³•ã€‚å¯¹äºæ›´å¤æ‚çš„ç¼“å­˜ï¼Œä½ å¯èƒ½éœ€è¦ç›´æ¥ä½¿ç”¨ java.lang.refã€‚\nå†…å­˜æ³„æ¼çš„ç¬¬ä¸‰ä¸ªå¸¸è§æ¥æºæ˜¯ä¾¦å¬å™¨å’Œå…¶ä»–å›è°ƒã€‚ å¦‚æœä½ å®ç°äº†ä¸€ä¸ª APIï¼Œå…¶ä¸­å®¢æˆ·ç«¯æ³¨å†Œå›è°ƒï¼Œä½†ä¸æ˜¾å¼å–æ¶ˆå®ƒä»¬ï¼Œé™¤éä½ é‡‡å–ä¸€äº›è¡ŒåŠ¨ï¼Œå¦åˆ™å®ƒä»¬å°†ç´¯ç§¯ã€‚ç¡®ä¿å›è°ƒè¢«åŠæ—¶åœ°åƒåœ¾æ”¶é›†çš„ä¸€ç§æ–¹æ³•æ˜¯ä»…å­˜å‚¨å¯¹å®ƒä»¬çš„å¼±å¼•ç”¨ï¼Œä¾‹å¦‚ï¼Œå°†å®ƒä»¬ä½œä¸ºé”®å­˜å‚¨åœ¨ WeakHashMap ä¸­ã€‚\nå¦‚ä½•æ’é™¤è¿‡æ—¶å¯¹è±¡å¼•ç”¨ ä»¥ä¸‹æ˜¯ä¸€äº›ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Java è¯­è¨€ä¸­çš„ä¸€äº›æŠ€æœ¯æ¥æ’é™¤è¿‡æ—¶çš„å¯¹è±¡å¼•ç”¨ã€‚\nåœ¨å¾ªç¯ä¸­ä½¿ç”¨å±€éƒ¨å˜é‡ List\u0026lt;String\u0026gt; list = new ArrayList\u0026lt;\u0026gt;(); for (int i = 0; i \u0026lt; list.size(); i++) { String str = list.get(i); // do something with str } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å±€éƒ¨å˜é‡stræ¥å¼•ç”¨åˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œè€Œä¸æ˜¯é‡å¤åœ°ä½¿ç”¨list.get(i)ã€‚è¿™æ ·ï¼Œå½“å¾ªç¯ç»“æŸæ—¶ï¼Œstrçš„å¼•ç”¨å°†è¢«è‡ªåŠ¨æ¸…é™¤ï¼Œé¿å…äº†è¿‡æ—¶çš„å¯¹è±¡å¼•ç”¨ã€‚\nåœ¨ä½¿ç”¨å®Œå¯¹è±¡ååŠæ—¶æ¸…é™¤å¼•ç”¨ SomeObject obj = new SomeObject(); // do something with obj obj = null; // clear the reference to obj åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨å®Œå¯¹è±¡åç«‹å³å°†å…¶å¼•ç”¨è®¾ç½®ä¸º nullï¼Œä»¥ä¾¿ JVM å¯ä»¥åŠæ—¶å›æ”¶å®ƒæ‰€å ç”¨çš„å†…å­˜ã€‚å¦‚æœä¸æ¸…é™¤å¼•ç”¨ï¼Œå¯¹è±¡å°†ä¸€ç›´å­˜åœ¨äºå†…å­˜ä¸­ï¼Œç›´åˆ° JVM è¿›è¡Œåƒåœ¾å›æ”¶ã€‚\nä½¿ç”¨å¼±å¼•ç”¨ WeakReference\u0026lt;SomeObject\u0026gt; ref = new WeakReference\u0026lt;\u0026gt;(new SomeObject()); SomeObject obj = ref.get(); // do something with obj obj = null; // clear the reference to obj åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªå¼±å¼•ç”¨æ¥å¼•ç”¨å¯¹è±¡ï¼Œä»¥ä¾¿åœ¨å¯¹è±¡ä¸å†è¢«å¼ºå¼•ç”¨æ—¶å¯ä»¥è¢«åŠæ—¶å›æ”¶ã€‚å½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨å¯¹è±¡æ—¶ï¼Œå¯ä»¥é€šè¿‡å¼±å¼•ç”¨è·å–å¯¹è±¡çš„å¼•ç”¨ï¼Œä½¿ç”¨å®ŒååŠæ—¶å°†å…¶å¼•ç”¨è®¾ç½®ä¸º nullã€‚\nä½¿ç”¨ try-with-resources è¯­å¥ try (InputStream in = new FileInputStream(\u0026#34;file.txt\u0026#34;)) { // do something with in } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† try-with-resources è¯­å¥æ¥æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æµï¼Œå¹¶åœ¨ä½¿ç”¨å®Œåè‡ªåŠ¨å…³é—­å®ƒã€‚è¿™æ ·å¯ä»¥ç¡®ä¿åœ¨ä¸å†éœ€è¦æ–‡ä»¶æµæ—¶ï¼Œå®ƒçš„å¼•ç”¨å°†è¢«æ¸…é™¤ï¼Œé¿å…äº†è¿‡æ—¶çš„å¯¹è±¡å¼•ç”¨ã€‚\nä½¿ç”¨è½¯å¼•ç”¨ SoftReference\u0026lt;SomeObject\u0026gt; ref = new SoftReference\u0026lt;\u0026gt;(new SomeObject()); SomeObject obj = ref.get(); // do something with obj obj = null; // clear the reference to obj åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªè½¯å¼•ç”¨æ¥å¼•ç”¨å¯¹è±¡ï¼Œä»¥ä¾¿åœ¨ JVM éœ€è¦å›æ”¶å†…å­˜æ—¶å¯ä»¥å›æ”¶å¯¹è±¡ã€‚è½¯å¼•ç”¨åœ¨å†…å­˜ä¸è¶³æ—¶é€šå¸¸ä¼šè¢«å›æ”¶ï¼Œä½†åœ¨å†…å­˜å……è¶³æ—¶å¯ä»¥ä¿ç•™å¯¹è±¡ï¼Œé¿å…äº†è¿‡æ—¶çš„å¯¹è±¡å¼•ç”¨ã€‚\nä½¿ç”¨è™šå¼•ç”¨ ReferenceQueue\u0026lt;SomeObject\u0026gt; queue = new ReferenceQueue\u0026lt;\u0026gt;(); PhantomReference\u0026lt;SomeObject\u0026gt; ref = new PhantomReference\u0026lt;\u0026gt;(new SomeObject(), queue); // do something ref.clear(); // clear the reference to obj åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªè™šå¼•ç”¨æ¥å¼•ç”¨å¯¹è±¡ï¼Œä»¥ä¾¿åœ¨ JVM å›æ”¶å¯¹è±¡ä¹‹å‰å¯ä»¥è¿›è¡Œä¸€äº›å¿…è¦çš„æ¸…ç†å·¥ä½œã€‚è™šå¼•ç”¨åœ¨ JVM å›æ”¶å¯¹è±¡æ—¶ä¼šè¢«æ·»åŠ åˆ°ä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨å¯¹è±¡è¢«å›æ”¶ä¹‹å‰æ‰§è¡Œå¿…è¦çš„æ¸…ç†å·¥ä½œã€‚\nä½¿ç”¨å¯¹è±¡æ±  class ObjectPool\u0026lt;T\u0026gt; { private final Set\u0026lt;T\u0026gt; objects = new HashSet\u0026lt;\u0026gt;(); public synchronized T getObject() { T obj; if (objects.isEmpty()) { obj = createObject(); } else { obj = objects.iterator().next(); objects.remove(obj); } return obj; } public synchronized void returnObject(T obj) { objects.add(obj); } private T createObject() { // create a new object } } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªå¯¹è±¡æ± æ¥ç®¡ç†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚å½“éœ€è¦ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬ä»å¯¹è±¡æ± ä¸­è·å–ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚å½“ä¸å†éœ€è¦å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬å°†å…¶è¿”å›åˆ°å¯¹è±¡æ± ä¸­ï¼Œä»¥ä¾¿å…¶ä»–å¯¹è±¡å¯ä»¥é‡å¤ä½¿ç”¨ã€‚å¯¹è±¡æ± å¯ä»¥é¿å…è¿‡æ—¶çš„å¯¹è±¡å¼•ç”¨ï¼Œå¹¶æé«˜ä»£ç çš„æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§ã€‚\nä½¿ç”¨å¼±æ•£åˆ—æ˜ å°„ Map\u0026lt;SomeObject, Object\u0026gt; map = new WeakHashMap\u0026lt;\u0026gt;(); SomeObject key = new SomeObject(); Object value = new Object(); map.put(key, value); // do something key = null; // clear the reference to key // do something // the entry in the map may be removed if key is not strongly referenced elsewhere åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªå¼±æ•£åˆ—æ˜ å°„æ¥å­˜å‚¨å¯¹è±¡å¼•ç”¨å’Œç›¸åº”çš„å€¼ã€‚å½“å¯¹è±¡ä¸å†è¢«å¼ºå¼•ç”¨æ—¶ï¼Œå®ƒçš„å¼•ç”¨å¯èƒ½è¢«ä»æ˜ å°„ä¸­åˆ é™¤ï¼Œä»è€Œé¿å…äº†è¿‡æ—¶çš„å¯¹è±¡å¼•ç”¨ã€‚å¼±æ•£åˆ—æ˜ å°„é€šå¸¸ç”¨äºç¼“å­˜å’Œäº‹ä»¶å¤„ç†ç­‰åœºæ™¯ã€‚\nä½¿ç”¨ç¼“å­˜ class SomeObjectCache { private static final int MAX_SIZE = 100; private static final Map\u0026lt;String, SomeObject\u0026gt; cache = new LinkedHashMap\u0026lt;String, SomeObject\u0026gt;(MAX_SIZE, 0.75f, true) { protected boolean removeEldestEntry(Map.Entry\u0026lt;String, SomeObject\u0026gt; eldest) { return size() \u0026gt; MAX_SIZE; } }; public synchronized static SomeObject get(String key) { return cache.get(key); } public synchronized static void put(String key, SomeObject value) { cache.put(key, value); } } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªç¼“å­˜æ¥å­˜å‚¨å¯¹è±¡å¼•ç”¨å’Œç›¸åº”çš„å€¼ã€‚å½“ç¼“å­˜è¾¾åˆ°æœ€å¤§å¤§å°æ—¶ï¼Œæœ€æ—§çš„æ¡ç›®å°†è¢«è‡ªåŠ¨åˆ é™¤ï¼Œä»è€Œé¿å…äº†è¿‡æ—¶çš„å¯¹è±¡å¼•ç”¨ã€‚ç¼“å­˜é€šå¸¸ç”¨äºé¢‘ç¹è®¿é—®çš„æ•°æ®å’Œè®¡ç®—ç»“æœï¼Œå¯ä»¥æé«˜ä»£ç çš„æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§ã€‚\nä½¿ç”¨å¯¹è±¡æ± æ¡†æ¶ å¯¹è±¡æ± æ¡†æ¶æ˜¯ä¸€ç§ç”¨äºç®¡ç†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„é€šç”¨æ¡†æ¶ï¼Œå¯ä»¥é¿å…è¿‡æ—¶çš„å¯¹è±¡å¼•ç”¨å’Œæé«˜ä»£ç çš„æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§ã€‚ä¸€äº›æµè¡Œçš„å¯¹è±¡æ± æ¡†æ¶åŒ…æ‹¬ Apache Commons Pool å’Œ Google Guava Cacheã€‚\næ‰©å±• å¼±å¼•ç”¨ã€è½¯å¼•ç”¨å’Œè™šå¼•ç”¨åŒºåˆ« å¼±å¼•ç”¨ã€è½¯å¼•ç”¨å’Œè™šå¼•ç”¨æ˜¯ Java ä¸­ä¸‰ç§ä¸åŒç±»å‹çš„å¼•ç”¨ï¼Œå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«å¦‚ä¸‹ï¼š\nå¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ å¼±å¼•ç”¨æ˜¯ä¸€ç§è¾ƒå¼±çš„å¼•ç”¨ç±»å‹ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åªè¢«å¼±å¼•ç”¨æ‰€å¼•ç”¨æ—¶ï¼Œå®ƒåœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ—¶ä¼šè¢«å›æ”¶ã€‚\nå¼±å¼•ç”¨é€šå¸¸ç”¨äºéœ€è¦ç¼“å­˜å¤§é‡å¯¹è±¡çš„åº”ç”¨åœºæ™¯ï¼Œä¾‹å¦‚ç¼“å­˜å’Œé«˜é€Ÿç¼“å­˜ç­‰ã€‚åœ¨è¿™äº›åœºæ™¯ä¸­ï¼Œä½¿ç”¨å¼±å¼•ç”¨å¯ä»¥é¿å…å ç”¨è¿‡å¤šçš„å†…å­˜ï¼ŒåŒæ—¶åˆå¯ä»¥å¿«é€Ÿè®¿é—®ç¼“å­˜ä¸­çš„å¯¹è±¡ã€‚\nåº”è¯¥ä½¿ç”¨å¼±å¼•ç”¨çš„æƒ…å†µåŒ…æ‹¬ï¼š\néœ€è¦ç¼“å­˜å¤§é‡å¯¹è±¡ï¼šä½¿ç”¨å¼±å¼•ç”¨å¯ä»¥é¿å…å ç”¨è¿‡å¤šçš„å†…å­˜ç©ºé—´ï¼Œä»è€Œå¯ä»¥ç¼“å­˜æ›´å¤šçš„å¯¹è±¡ã€‚\nä¸éœ€è¦å¿«é€Ÿè®¿é—®ç¼“å­˜ä¸­çš„å¯¹è±¡ï¼šç”±äºå¼±å¼•ç”¨åªæœ‰åœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å›æ”¶ï¼Œå› æ­¤å¯èƒ½ä¼šå¯¼è‡´è¾ƒé•¿çš„è®¿é—®å»¶è¿Ÿã€‚å¦‚æœåº”ç”¨ç¨‹åºå¯ä»¥å®¹å¿è¿™ç§æƒ…å†µï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å¼±å¼•ç”¨ã€‚\néœ€è¦é¢‘ç¹çš„åƒåœ¾å›æ”¶ï¼šç”±äºå¼±å¼•ç”¨åªæœ‰åœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å›æ”¶ï¼Œå› æ­¤å¯èƒ½ä¼šå¯¼è‡´é¢‘ç¹çš„åƒåœ¾å›æ”¶ã€‚å¦‚æœåº”ç”¨ç¨‹åºå¯ä»¥å®¹å¿è¿™ç§æƒ…å†µï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å¼±å¼•ç”¨ã€‚\nä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¼±å¼•ç”¨æ¥å®ç°ä¸€ä¸ªç¼“å­˜ï¼Œå½“å†…å­˜ä¸è¶³æ—¶ï¼ŒJVM ä¼šè‡ªåŠ¨å›æ”¶å¼±å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡ï¼Œä»è€Œé¿å…å†…å­˜æ³„æ¼å’Œ OOM é”™è¯¯ã€‚\nMap\u0026lt;String, WeakReference\u0026lt;SomeObject\u0026gt;\u0026gt; cache = new HashMap\u0026lt;\u0026gt;(); public SomeObject getObject(String key) { SomeObject obj = null; WeakReference\u0026lt;SomeObject\u0026gt; reference = cache.get(key); if (reference != null) { obj = reference.get(); } if (obj == null) { obj = createObject(); if (obj != null) { cache.put(key, new WeakReference\u0026lt;\u0026gt;(obj)); } } return obj; } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å¼±å¼•ç”¨æ¥ç¼“å­˜å¯¹è±¡ï¼Œå½“å†…å­˜ä¸è¶³æ—¶ï¼ŒJVM ä¼šè‡ªåŠ¨å›æ”¶å¼±å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡ã€‚è¿™æ ·å¯ä»¥é¿å…å ç”¨è¿‡å¤šçš„å†…å­˜ï¼ŒåŒæ—¶åˆå¯ä»¥å¿«é€Ÿè®¿é—®ç¼“å­˜ä¸­çš„å¯¹è±¡ã€‚\nè½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰ è½¯å¼•ç”¨æ˜¯ä¸€ç§è¾ƒå¼ºçš„å¼•ç”¨ç±»å‹ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åªè¢«è½¯å¼•ç”¨æ‰€å¼•ç”¨æ—¶ï¼Œåªæœ‰åœ¨å†…å­˜ä¸è¶³æ—¶æ‰ä¼šè¢«å›æ”¶ã€‚\nè½¯å¼•ç”¨é€šå¸¸ç”¨äºéœ€è¦ç¼“å­˜å¤§é‡å¯¹è±¡çš„åº”ç”¨åœºæ™¯ï¼Œä¾‹å¦‚å›¾ç‰‡ç¼“å­˜ã€æ•°æ®ç¼“å­˜ç­‰ã€‚åœ¨è¿™äº›åœºæ™¯ä¸­ï¼Œä½¿ç”¨è½¯å¼•ç”¨å¯ä»¥é¿å…å ç”¨è¿‡å¤šçš„å†…å­˜ï¼ŒåŒæ—¶åˆå¯ä»¥å¿«é€Ÿè®¿é—®ç¼“å­˜ä¸­çš„å¯¹è±¡ã€‚\nåº”è¯¥ä½¿ç”¨è½¯å¼•ç”¨çš„æƒ…å†µåŒ…æ‹¬ï¼š\néœ€è¦ç¼“å­˜å¤§é‡å¯¹è±¡ï¼šä½¿ç”¨è½¯å¼•ç”¨å¯ä»¥é¿å…å ç”¨è¿‡å¤šçš„å†…å­˜ç©ºé—´ï¼Œä»è€Œå¯ä»¥ç¼“å­˜æ›´å¤šçš„å¯¹è±¡ã€‚\néœ€è¦å¿«é€Ÿè®¿é—®ç¼“å­˜ä¸­çš„å¯¹è±¡ï¼šä½¿ç”¨è½¯å¼•ç”¨å¯ä»¥å¿«é€Ÿè®¿é—®ç¼“å­˜ä¸­çš„å¯¹è±¡ï¼Œé¿å…é¢‘ç¹åœ°åŠ è½½å’Œè®¡ç®—ã€‚\nå¯ä»¥å®¹å¿å¶å°”çš„åƒåœ¾å›æ”¶ï¼šç”±äºè½¯å¼•ç”¨åªæœ‰åœ¨å†…å­˜ä¸è¶³æ—¶æ‰ä¼šè¢«å›æ”¶ï¼Œå› æ­¤å¯èƒ½ä¼šå¯¼è‡´å¶å°”çš„åƒåœ¾å›æ”¶ã€‚å¦‚æœåº”ç”¨ç¨‹åºå¯ä»¥å®¹å¿è¿™ç§æƒ…å†µï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨è½¯å¼•ç”¨ã€‚\nä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è½¯å¼•ç”¨æ¥å®ç°ä¸€ä¸ªå›¾ç‰‡ç¼“å­˜ï¼Œå½“å†…å­˜ä¸è¶³æ—¶ï¼ŒJVM ä¼šè‡ªåŠ¨å›æ”¶è½¯å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡ï¼Œä»è€Œé¿å…å†…å­˜æ³„æ¼å’Œ OOM é”™è¯¯ã€‚\nMap\u0026lt;String, SoftReference\u0026lt;Bitmap\u0026gt;\u0026gt; imageCache = new HashMap\u0026lt;\u0026gt;(); public Bitmap loadImage(String url) { Bitmap bitmap = null; SoftReference\u0026lt;Bitmap\u0026gt; reference = imageCache.get(url); if (reference != null) { bitmap = reference.get(); } if (bitmap == null) { bitmap = downloadImage(url); if (bitmap != null) { imageCache.put(url, new SoftReference\u0026lt;\u0026gt;(bitmap)); } } return bitmap; } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨è½¯å¼•ç”¨æ¥ç¼“å­˜å›¾ç‰‡ï¼Œå½“å†…å­˜ä¸è¶³æ—¶ï¼ŒJVM ä¼šè‡ªåŠ¨å›æ”¶è½¯å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡ã€‚è¿™æ ·å¯ä»¥é¿å…å ç”¨è¿‡å¤šçš„å†…å­˜ï¼ŒåŒæ—¶åˆå¯ä»¥å¿«é€Ÿè®¿é—®ç¼“å­˜ä¸­çš„å›¾ç‰‡ã€‚\nè™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰ è™šå¼•ç”¨æ˜¯ Java ä¸­å››ç§å¼•ç”¨ç±»å‹ä¸­æœ€å¼±çš„ä¸€ç§ï¼Œå®ƒä¸»è¦ç”¨äºè·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶çš„çŠ¶æ€ã€‚è™šå¼•ç”¨æœ¬èº«å¹¶ä¸ä¼šå¯¹å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸäº§ç”Ÿå½±å“ï¼Œä½†å¯ä»¥åœ¨å¯¹è±¡è¢«åƒåœ¾å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªé€šçŸ¥ï¼Œä»è€Œè¿›è¡Œä¸€äº›æ¸…ç†æˆ–å…¶ä»–æ“ä½œã€‚\nè™šå¼•ç”¨çš„ä½¿ç”¨åœºæ™¯æ¯”è¾ƒå°‘ï¼Œä¸€èˆ¬ç”¨äºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\nå¯¹è±¡çš„ finalize()æ–¹æ³•ï¼š è™šå¼•ç”¨å¯ä»¥ç”¨äºå®ç°å¯¹è±¡çš„ finalize()æ–¹æ³•ï¼Œå½“å¯¹è±¡è¢«åƒåœ¾å›æ”¶æ—¶ï¼Œè™šå¼•ç”¨ä¼šæ”¶åˆ°ä¸€ä¸ªé€šçŸ¥ï¼Œä»è€Œè§¦å‘å¯¹è±¡çš„ finalize()æ–¹æ³•ã€‚ NIO DirectByteBuffer å¯¹è±¡çš„é‡Šæ”¾ï¼š åœ¨ä½¿ç”¨ NIO ç¼–ç¨‹æ—¶ï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤§é‡çš„ DirectByteBuffer å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡å¯èƒ½ä¼šå ç”¨å¤§é‡çš„å†…å­˜ç©ºé—´ã€‚å½“è¿™äº›å¯¹è±¡ä¸å†ä½¿ç”¨æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨è°ƒç”¨ System.gc()æ–¹æ³•è§¦å‘ä¸€æ¬¡åƒåœ¾å›æ”¶ï¼Œæ‰èƒ½é‡Šæ”¾è¿™äº›å¯¹è±¡çš„å†…å­˜ã€‚ä½¿ç”¨è™šå¼•ç”¨å¯ä»¥é¿å…æ‰‹åŠ¨è°ƒç”¨ System.gc()æ–¹æ³•ï¼Œå½“è¿™äº›å¯¹è±¡è¢«åƒåœ¾å›æ”¶æ—¶ï¼Œè™šå¼•ç”¨ä¼šæ”¶åˆ°ä¸€ä¸ªé€šçŸ¥ï¼Œä»è€Œé‡Šæ”¾è¿™äº›å¯¹è±¡çš„å†…å­˜ã€‚ å¯¹è±¡æ± çš„ç®¡ç†ï¼š åœ¨ä¸€äº›éœ€è¦é¢‘ç¹åˆ›å»ºå’Œé”€æ¯å¯¹è±¡çš„åº”ç”¨åœºæ™¯ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¯¹è±¡æ± æ¥æé«˜æ€§èƒ½ã€‚å½“å¯¹è±¡ä¸å†ä½¿ç”¨æ—¶ï¼Œå¯ä»¥å°†å¯¹è±¡æ”¾å…¥è™šå¼•ç”¨ä¸­ï¼Œå½“å¯¹è±¡è¢«åƒåœ¾å›æ”¶æ—¶ï¼Œè™šå¼•ç”¨ä¼šæ”¶åˆ°ä¸€ä¸ªé€šçŸ¥ï¼Œä»è€Œå°†å¯¹è±¡ä»å¯¹è±¡æ± ä¸­ç§»é™¤ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™šå¼•ç”¨ä¸é€‚ç”¨äºç¼“å­˜æˆ–å…¶ä»–éœ€è¦å¿«é€Ÿè®¿é—®å¯¹è±¡çš„åº”ç”¨åœºæ™¯ï¼Œå› ä¸ºè™šå¼•ç”¨æœ¬èº«å¹¶ä¸ä¿è¯å¯¹è±¡çš„å¯ç”¨æ€§å’Œå¯è®¿é—®æ€§ã€‚\nå› æ­¤ï¼Œè½¯å¼•ç”¨å’Œå¼±å¼•ç”¨çš„ä¸»è¦åŒºåˆ«åœ¨äºå®ƒä»¬çš„å¼ºåº¦å’Œåƒåœ¾å›æ”¶çš„æ—¶æœºã€‚è½¯å¼•ç”¨æ¯”å¼±å¼•ç”¨æ›´å¼ºï¼Œåªæœ‰åœ¨å†…å­˜ä¸è¶³æ—¶æ‰ä¼šè¢«å›æ”¶ï¼Œè€Œå¼±å¼•ç”¨åˆ™æ›´å¼±ï¼Œåªæœ‰åœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å›æ”¶ã€‚åŒæ—¶ï¼Œä½¿ç”¨è½¯å¼•ç”¨å¯èƒ½ä¼šå¯¼è‡´æ›´å°‘çš„åƒåœ¾å›æ”¶ï¼Œä½†å¯èƒ½ä¼šå ç”¨æ›´å¤šçš„å†…å­˜ç©ºé—´ï¼Œè€Œä½¿ç”¨å¼±å¼•ç”¨å¯èƒ½ä¼šå¯¼è‡´æ›´é¢‘ç¹çš„åƒåœ¾å›æ”¶ï¼Œä½†å¯ä»¥æ›´å¿«åœ°é‡Šæ”¾å†…å­˜ç©ºé—´ã€‚\nå¼±å¼•ç”¨æ˜¯å¦ä¼šå½±å“ç¨‹åºçš„æ€§èƒ½ï¼Ÿ å¼±å¼•ç”¨å¯èƒ½ä¼šå½±å“ç¨‹åºçš„æ€§èƒ½ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ä¼šå¯¼è‡´é¢‘ç¹çš„åƒåœ¾å›æ”¶ã€‚ç”±äºå¼±å¼•ç”¨åªæœ‰åœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å›æ”¶ï¼Œå› æ­¤å½“ä½¿ç”¨å¤§é‡çš„å¼±å¼•ç”¨æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ›´é¢‘ç¹çš„åƒåœ¾å›æ”¶ï¼Œä»è€Œé™ä½ç¨‹åºçš„æ€§èƒ½ã€‚\nå½“ä¸€ä¸ªå¯¹è±¡åªè¢«å¼±å¼•ç”¨æ‰€å¼•ç”¨æ—¶ï¼Œåœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ—¶å®ƒä¼šè¢«å›æ”¶ã€‚å¦‚æœåº”ç”¨ç¨‹åºä¸­å­˜åœ¨å¤§é‡çš„å¼±å¼•ç”¨å¯¹è±¡ï¼Œæ¯æ¬¡åƒåœ¾å›æ”¶éƒ½éœ€è¦æ‰«æè¿™äº›å¯¹è±¡ï¼Œä»è€Œå¢åŠ äº†åƒåœ¾å›æ”¶çš„æ—¶é—´å’Œå¼€é”€ã€‚\nå› æ­¤ï¼Œåœ¨ä½¿ç”¨å¼±å¼•ç”¨æ—¶éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š\nä¸è¦è¿‡åº¦ä½¿ç”¨å¼±å¼•ç”¨ï¼šå¦‚æœåº”ç”¨ç¨‹åºä¸­å­˜åœ¨å¤§é‡çš„å¼±å¼•ç”¨å¯¹è±¡ï¼Œå¯èƒ½ä¼šå¯¼è‡´é¢‘ç¹çš„åƒåœ¾å›æ”¶ï¼Œä»è€Œå½±å“ç¨‹åºçš„æ€§èƒ½ã€‚å› æ­¤ï¼Œåº”è¯¥é¿å…è¿‡åº¦ä½¿ç”¨å¼±å¼•ç”¨ï¼Œå°½å¯èƒ½å‡å°‘å¼±å¼•ç”¨å¯¹è±¡çš„æ•°é‡ã€‚ æ³¨æ„åƒåœ¾å›æ”¶çš„æ—¶æœºï¼šå¼±å¼•ç”¨åªåœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å›æ”¶ï¼Œå› æ­¤å¯èƒ½ä¼šå¯¼è‡´è¾ƒé•¿çš„è®¿é—®å»¶è¿Ÿã€‚åœ¨ä½¿ç”¨å¼±å¼•ç”¨æ—¶éœ€è¦æ³¨æ„åƒåœ¾å›æ”¶çš„æ—¶æœºï¼Œå¦‚æœåº”ç”¨ç¨‹åºéœ€è¦å¿«é€Ÿè®¿é—®ç¼“å­˜ä¸­çš„å¯¹è±¡ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨å…¶ä»–ç±»å‹çš„å¼•ç”¨ã€‚ æ£€æŸ¥å¼±å¼•ç”¨æ˜¯å¦è¢«å›æ”¶ï¼šå½“ä¸€ä¸ªå¯¹è±¡åªè¢«å¼±å¼•ç”¨æ‰€å¼•ç”¨æ—¶ï¼Œå®ƒåœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ—¶ä¼šè¢«å›æ”¶ã€‚åœ¨ä½¿ç”¨å¼±å¼•ç”¨æ—¶éœ€è¦æ³¨æ„æ£€æŸ¥å¼±å¼•ç”¨å¯¹è±¡æ˜¯å¦è¢«å›æ”¶ï¼Œé¿å…å¼•ç”¨æ— æ•ˆçš„å¯¹è±¡ã€‚ å¦‚ä½•æ£€æŸ¥å¼±å¼•ç”¨å¯¹è±¡æ˜¯å¦è¢«å›æ”¶ï¼Ÿ åœ¨ Java ä¸­ï¼Œå¯ä»¥é€šè¿‡è·å–å¼±å¼•ç”¨å¯¹è±¡çš„ get()æ–¹æ³•è¿”å›çš„å¯¹è±¡æ¥æ£€æŸ¥å¼•ç”¨å¯¹è±¡æ˜¯å¦è¢«å›æ”¶ã€‚å½“ä¸€ä¸ªå¼±å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«å›æ”¶åï¼Œget()æ–¹æ³•è¿”å›çš„å¯¹è±¡å°†ä¸º nullã€‚\nä¾‹å¦‚ï¼Œä»¥ä¸‹ç¤ºä¾‹ä»£ç æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨å¼±å¼•ç”¨æ£€æŸ¥å¯¹è±¡æ˜¯å¦è¢«å›æ”¶ï¼š\nObject obj = new Object(); WeakReference\u0026lt;Object\u0026gt; weakRef = new WeakReference\u0026lt;\u0026gt;(obj); // æ£€æŸ¥å¯¹è±¡æ˜¯å¦è¢«å›æ”¶ if (weakRef.get() != null) { // å¯¹è±¡æœªè¢«å›æ”¶ System.out.println(\u0026#34;Object is alive\u0026#34;); } else { // å¯¹è±¡å·²è¢«å›æ”¶ System.out.println(\u0026#34;Object has been collected\u0026#34;); } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä½¿ç”¨å¼±å¼•ç”¨æ¥å¼•ç”¨å®ƒã€‚ç„¶åï¼Œæˆ‘ä»¬é€šè¿‡æ£€æŸ¥å¼±å¼•ç”¨å¯¹è±¡çš„ get()æ–¹æ³•è¿”å›çš„å¯¹è±¡æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦è¢«å›æ”¶ã€‚\nå½“å¯¹è±¡æœªè¢«å›æ”¶æ—¶ï¼Œget()æ–¹æ³•è¿”å›çš„å¯¹è±¡ä¸ä¸º nullï¼Œè¡¨ç¤ºå¯¹è±¡ä»ç„¶å­˜æ´»ã€‚å½“å¯¹è±¡è¢«å›æ”¶æ—¶ï¼Œget()æ–¹æ³•è¿”å›çš„å¯¹è±¡ä¸º nullï¼Œè¡¨ç¤ºå¯¹è±¡å·²ç»è¢«å›æ”¶ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºå¼±å¼•ç”¨åªåœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å›æ”¶ï¼Œå› æ­¤åœ¨ä½¿ç”¨å¼±å¼•ç”¨æ£€æŸ¥å¯¹è±¡æ˜¯å¦è¢«å›æ”¶æ—¶ï¼Œéœ€è¦æ³¨æ„åƒåœ¾å›æ”¶çš„æ—¶æœºã€‚å¦‚æœåº”ç”¨ç¨‹åºéœ€è¦ç«‹å³æ£€æŸ¥å¯¹è±¡æ˜¯å¦è¢«å›æ”¶ï¼Œå¯ä»¥æ‰‹åŠ¨è§¦å‘ä¸€æ¬¡åƒåœ¾å›æ”¶ï¼Œä¾‹å¦‚é€šè¿‡System.gc()æ–¹æ³•æ¥è§¦å‘ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/05/05/eliminate-obsolete-object-references/","summary":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼šæ’é™¤è¿‡æ—¶çš„å¯¹è±¡å¼•ç”¨ã€‚\nä»‹ç» \u0026ldquo;Eliminate obsolete object references\u0026rdquo; æ˜¯ä¸€æ¡ Java ç¼–ç¨‹æœ€ä½³å®è·µçš„åŸåˆ™ï¼ŒæŒ‡çš„æ˜¯åœ¨ä»£ç ä¸­åŠæ—¶æ¸…ç†ä¸å†ä½¿ç”¨çš„å¯¹è±¡å¼•ç”¨ï¼Œä»¥é¿å…å†…å­˜æ³„æ¼å’Œæ€§èƒ½é—®é¢˜ã€‚å½“ä¸€ä¸ªå¯¹è±¡ä¸å†éœ€è¦æ—¶ï¼Œåº”è¯¥å°½å¿«å°†å…¶å¼•ç”¨è®¾ç½®ä¸º nullï¼Œè¿™æ · JVM å¯ä»¥åŠæ—¶å›æ”¶å®ƒæ‰€å ç”¨çš„å†…å­˜ã€‚\nè€ƒè™‘ä»¥ä¸‹ç®€å•çš„å †æ ˆå®ç°ï¼š\nimport java.util.Arrays; import java.util.EmptyStackException; // Can you spot the \u0026#34;memory leak\u0026#34;? public class Stack { private Object[] elements; private int size = 0; private static final int DEFAULT_INITIAL_CAPACITY = 16; public Stack() { elements = new Object[DEFAULT_INITIAL_CAPACITY]; } public void push(Object e) { ensureCapacity(); elements[size++] = e; } public Object pop() { if (size == 0) throw new EmptyStackException(); return elements[--size]; } /** * Ensure space for at least one more element, roughly * doubling the capacity each time the array needs to grow. */ private void ensureCapacity() { if (elements.","title":"ã€ŠEffective Java 3ã€‹ç¬”è®°7ï¼šæ’é™¤è¿‡æ—¶çš„å¯¹è±¡å¼•ç”¨"},{"content":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼šç”¨ç§æœ‰æ„é€ å‡½æ•°ä½¿ç±»ä¸å¯å®ä¾‹åŒ–ã€‚\nä»‹ç» ä½¿ç”¨ç§æœ‰æ„é€ å‡½æ•°å¼ºåˆ¶å®ç°ä¸å¯å®ä¾‹åŒ–çš„ä¸»è¦åŸå› æ˜¯é˜²æ­¢ç±»è¢«æ„å¤–åœ°å®ä¾‹åŒ–ï¼Œä»¥ä½¿ä»£ç æ›´åŠ å¥å£®å’Œå¯é ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ç±»ä¸­çš„é™æ€æ–¹æ³•å’Œé™æ€å­—æ®µï¼Œè€Œä¸éœ€è¦åˆ›å»ºè¯¥ç±»çš„å®ä¾‹ã€‚å¦‚æœç±»ä¸­æ²¡æœ‰æ˜¾å¼åœ°å®šä¹‰ç§æœ‰æ„é€ å‡½æ•°ï¼ŒJava ç¼–è¯‘å™¨å°†ä¼šè‡ªåŠ¨ä¸ºè¯¥ç±»ç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„å…¬å…±æ„é€ å‡½æ•°ï¼Œè¿™æ„å‘³ç€è¯¥ç±»å¯ä»¥åœ¨å…¶ä»–ç±»ä¸­è¢«å®ä¾‹åŒ–ã€‚å¦‚æœè¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œä¸ºäº†é˜²æ­¢å…¶ä»–äººæ„å¤–åœ°å®ä¾‹åŒ–æˆ‘ä»¬çš„ç±»ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ„é€ å‡½æ•°è®¾ç½®ä¸ºç§æœ‰ã€‚\næ­¤å¤–ï¼Œä½¿ç”¨ç§æœ‰æ„é€ å‡½æ•°å¼ºåˆ¶å®ç°ä¸å¯å®ä¾‹åŒ–è¿˜æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š\næ˜ç¡®è¡¨æ˜è¯¥ç±»ä¸å¯è¢«å®ä¾‹åŒ–ï¼Œæé«˜äº†ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ é˜²æ­¢ç±»è¢«å­ç±»åŒ–ï¼Œä»è€Œé¿å…äº†ç»§æ‰¿æ‰€å¸¦æ¥çš„å‰¯ä½œç”¨å’Œä¸å¿…è¦çš„å¤æ‚æ€§ã€‚ æé«˜äº†ä»£ç çš„å®‰å…¨æ€§ï¼Œé˜²æ­¢å…¶ä»–ç±»åœ¨ä¸åˆé€‚çš„æƒ…å†µä¸‹å®ä¾‹åŒ–è¯¥ç±»ã€‚ è¿™æ˜¯ä¸€ä¸ªå®ç°äº†ç§æœ‰æ„é€ å‡½æ•°å¼ºåˆ¶å®ç°ä¸å¯å®ä¾‹åŒ–çš„ç±»çš„ç¤ºä¾‹ï¼š\npublic class UtilityClass { // ç¦æ­¢é»˜è®¤æ„é€ å‡½æ•°é˜²æ­¢å®ä¾‹åŒ– private UtilityClass() { throw new AssertionError(); } // å…¶ä»–é™æ€æ–¹æ³•å’Œå­—æ®µ // ... } è¿™ä¸ªç±»ä¸­çš„ç§æœ‰æ„é€ å‡½æ•°ä¼šåœ¨è¢«è°ƒç”¨æ—¶æŠ›å‡ºAssertionErrorã€‚è¿™æ ·åšå¯ä»¥ç¡®ä¿æ„é€ å‡½æ•°æ°¸è¿œä¸ä¼šä»ç±»å†…éƒ¨æˆ–å¤–éƒ¨è°ƒç”¨ã€‚\né€šè¿‡å°†æ„é€ å‡½æ•°è®¾ç½®ä¸ºç§æœ‰ï¼Œè¿™ä¸ªç±»å°±ä¸èƒ½ä»å¤–éƒ¨è¢«å®ä¾‹åŒ–ã€‚è¿™ä¸ªä¹ æƒ¯ç”¨æ³•ä¹Ÿé˜²æ­¢äº†ç±»è¢«å­ç±»åŒ–ã€‚å¦‚æœä¸€ä¸ªç±»çš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ï¼Œé‚£ä¹ˆå®ƒä¸èƒ½è¢«å­ç±»è°ƒç”¨ï¼Œå› ä¸ºå­ç±»å¿…é¡»è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°æ¥å®Œæˆåˆå§‹åŒ–ã€‚å› æ­¤ï¼Œå¦‚æœä¸€ä¸ªç±»çš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ï¼Œå®ƒå°±ä¸èƒ½è¢«å­ç±»åŒ–ï¼Œå› ä¸ºå­ç±»ä¸èƒ½è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°æ¥å®Œæˆåˆå§‹åŒ–ã€‚\nä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ç§æœ‰æ„é€ å‡½æ•°é˜²æ­¢ç±»è¢«å­ç±»åŒ–ï¼š\npublic final class FinalClass { private FinalClass() { // private constructor } public static void doSomething() { // do something } } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒFinalClassè¢«å£°æ˜ä¸ºfinalï¼Œå› æ­¤ä¸èƒ½è¢«å­ç±»åŒ–ã€‚æ­¤å¤–ï¼Œå®ƒçš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ï¼Œå› æ­¤ä¸èƒ½ä»å­ç±»ä¸­è¢«è°ƒç”¨ã€‚ç”±äºè¯¥ç±»ä¸èƒ½è¢«å­ç±»åŒ–ï¼Œå› æ­¤å®ƒçš„è¡Œä¸ºä¸ä¼šå—åˆ°å­ç±»çš„å½±å“ï¼Œä»è€Œé¿å…äº†ç»§æ‰¿æ‰€å¸¦æ¥çš„å‰¯ä½œç”¨å’Œä¸å¿…è¦çš„å¤æ‚æ€§ã€‚\nåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå°†ç±»è®¾ç½®ä¸ºä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œä½†å¯ä»¥è¢«å­ç±»åŒ–æ˜¯æœ‰ç”¨çš„ã€‚è¿™é€šå¸¸æ˜¯å› ä¸ºæˆ‘ä»¬å¸Œæœ›å­ç±»åŒ–çš„ç±»èƒ½å¤Ÿç»§æ‰¿çˆ¶ç±»çš„è¡Œä¸ºå’Œå±æ€§ï¼ŒåŒæ—¶åˆä¸å¸Œæœ›å¤–éƒ¨èƒ½å¤Ÿå®ä¾‹åŒ–è¯¥ç±»ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼š\npublic abstract class Animal { private String name; protected Animal(String name) { this.name = name; } public String getName() { return name; } public abstract void makeSound(); } public class Dog extends Animal { public Dog(String name) { super(name); } @Override public void makeSound() { System.out.println(\u0026#34;Woof!\u0026#34;); } } åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒAnimalç±»è¢«è®¾ç½®ä¸ºæŠ½è±¡ç±»ï¼Œå®ƒçš„æ„é€ å‡½æ•°è¢«è®¾ç½®ä¸ºprotectedï¼Œè¿™æ„å‘³ç€è¯¥ç±»ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œä½†å¯ä»¥è¢«å­ç±»åŒ–ã€‚Dogç±»ç»§æ‰¿äº†Animalç±»ï¼Œå¹¶å®ç°äº†makeSound()æ–¹æ³•ã€‚ç”±äºAnimalç±»çš„æ„é€ å‡½æ•°è¢«è®¾ç½®ä¸ºprotectedï¼Œæ‰€ä»¥Dogç±»å¯ä»¥è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°æ¥è¿›è¡Œåˆå§‹åŒ–ã€‚\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›Animalç±»èƒ½å¤Ÿæä¾›ä¸€äº›é€šç”¨çš„è¡Œä¸ºå’Œå±æ€§ï¼ŒåŒæ—¶åˆä¸å¸Œæœ›å¤–éƒ¨èƒ½å¤Ÿå®ä¾‹åŒ–è¯¥ç±»ï¼Œå› ä¸ºAnimalç±»æœ¬èº«å¹¶ä¸æ˜¯ä¸€ç§å…·ä½“çš„åŠ¨ç‰©ã€‚è€ŒDogç±»ä½œä¸ºAnimalç±»çš„å­ç±»ï¼Œå¯ä»¥ç»§æ‰¿Animalç±»çš„è¡Œä¸ºå’Œå±æ€§ï¼Œå¹¶å®ç°è‡ªå·±çš„ç‰¹å®šè¡Œä¸ºï¼Œä»¥å®ç°å…·ä½“çš„åŠŸèƒ½ã€‚\nç”¨é€” ç§æœ‰æ„é€ å‡½æ•°è¿˜æœ‰å…¶ä»–ä¸€äº›ç”¨é€”ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ç”¨é€”ï¼š\né˜²æ­¢å®ä¾‹åŒ–ï¼šç§æœ‰æ„é€ å‡½æ•°å¯ä»¥é˜²æ­¢ç±»è¢«å®ä¾‹åŒ–ï¼Œè¿™å¯¹äºåªåŒ…å«é™æ€æ–¹æ³•å’Œé™æ€å­—æ®µçš„å®ç”¨å·¥å…·ç±»éå¸¸æœ‰ç”¨ã€‚è¿™äº›ç±»å¯ä»¥é€šè¿‡å°†æ„é€ å‡½æ•°è®¾ç½®ä¸ºç§æœ‰æ¥é˜²æ­¢å®ƒä»¬è¢«å®ä¾‹åŒ–ï¼Œä»è€Œé¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»ºå’Œèµ„æºæµªè´¹ã€‚\nå¼ºåˆ¶å®ç°å•ä¾‹ï¼šå•ä¾‹æ¨¡å¼æ˜¯ä¸€ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒè¦æ±‚ä¸€ä¸ªç±»æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ã€‚ç§æœ‰æ„é€ å‡½æ•°å¯ä»¥å¼ºåˆ¶å®ç°å•ä¾‹æ¨¡å¼ï¼Œå› ä¸ºå®ƒå¯ä»¥é˜²æ­¢ç±»è¢«å®ä¾‹åŒ–ï¼Œé™¤éç±»çš„å†…éƒ¨å®šä¹‰äº†ä¸€ä¸ªé™æ€å®ä¾‹å¹¶æä¾›äº†ä¸€ä¸ªå…¬å…±çš„é™æ€è®¿é—®æ–¹æ³•ã€‚\npublic class Singleton { private static Singleton instance; private Singleton() { // private constructor } public static Singleton getInstance() { if (instance == null) { instance = new Singleton(); } return instance; } } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒSingletonç±»çš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ï¼Œå› æ­¤å®ƒä¸èƒ½è¢«å…¶ä»–ç±»å®ä¾‹åŒ–ã€‚getInstance()æ–¹æ³•æä¾›äº†ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ï¼Œå¹¶åœ¨éœ€è¦æ—¶åˆ›å»ºäº†ä¸€ä¸ªé™æ€å®ä¾‹ã€‚ç”±äºæ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ï¼Œå› æ­¤åªæœ‰Singletonç±»çš„å†…éƒ¨æ‰èƒ½åˆ›å»ºå®ä¾‹ï¼Œä»è€Œå®ç°äº†å•ä¾‹æ¨¡å¼ã€‚\né˜²æ­¢å­ç±»åŒ–ï¼šç§æœ‰æ„é€ å‡½æ•°å¯ä»¥é˜²æ­¢ç±»è¢«å­ç±»åŒ–ï¼Œä»è€Œé¿å…äº†ç»§æ‰¿æ‰€å¸¦æ¥çš„å‰¯ä½œç”¨å’Œä¸å¿…è¦çš„å¤æ‚æ€§ã€‚\npublic final class FinalClass { private FinalClass() { // private constructor } public static void doSomething() { // do something } } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒFinalClassç±»è¢«å£°æ˜ä¸ºfinalï¼Œå®ƒçš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ï¼Œå› æ­¤å®ƒä¸èƒ½è¢«å­ç±»åŒ–ã€‚è¯¥ç±»æä¾›äº†ä¸€äº›é™æ€æ–¹æ³•ï¼Œå¯ä»¥åœ¨å…¶ä»–ç±»ä¸­è°ƒç”¨ï¼Œä½†æ˜¯ä¸èƒ½è¢«å­ç±»åŒ–ã€‚\né™åˆ¶ç»§æ‰¿ï¼šå¦‚æœä¸€ä¸ªç±»çš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ï¼Œé‚£ä¹ˆå®ƒä¸èƒ½è¢«ç»§æ‰¿ï¼Œè¿™å¯ä»¥ç”¨æ¥é™åˆ¶ç±»çš„ç»§æ‰¿ã€‚\nå®ç°å·¥å‚æ–¹æ³•ï¼šå·¥å‚æ–¹æ³•æ˜¯ä¸€ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œä½†æ˜¯å°†å…·ä½“çš„å¯¹è±¡åˆ›å»ºè¿‡ç¨‹ç•™ç»™äº†å­ç±»æˆ–å…·ä½“çš„å®ç°ç±»ã€‚ç§æœ‰æ„é€ å‡½æ•°å¯ä»¥ä¸å·¥å‚æ–¹æ³•ä¸€èµ·ä½¿ç”¨ï¼Œä»¥ç¡®ä¿åªæœ‰å·¥å‚æ–¹æ³•èƒ½å¤Ÿåˆ›å»ºå¯¹è±¡ï¼Œä»è€Œä½¿å¯¹è±¡åˆ›å»ºè¿‡ç¨‹æ›´åŠ å¯æ§å’Œå®‰å…¨ã€‚\npublic class Shape { private Shape() { // private constructor } public static Shape createRectangle() { return new Rectangle(); } public static Shape createCircle() { return new Circle(); } } class Rectangle extends Shape { public Rectangle() { // constructor } } class Circle extends Shape { public Circle() { // constructor } } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒShapeç±»çš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ï¼Œå› æ­¤å®ƒä¸èƒ½è¢«å®ä¾‹åŒ–ã€‚Shapeç±»æä¾›äº†ä¸¤ä¸ªé™æ€å·¥å‚æ–¹æ³•ï¼ŒcreateRectangle()å’ŒcreateCircle()ï¼Œç”¨äºåˆ›å»ºä¸åŒçš„å½¢çŠ¶ã€‚Rectangleå’ŒCircleç±»ç»§æ‰¿è‡ªShapeç±»ï¼Œå¹¶å®ç°äº†è‡ªå·±çš„æ„é€ å‡½æ•°ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/05/05/enforce-noninstantiability-with-a-private-constructor/","summary":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼šç”¨ç§æœ‰æ„é€ å‡½æ•°ä½¿ç±»ä¸å¯å®ä¾‹åŒ–ã€‚\nä»‹ç» ä½¿ç”¨ç§æœ‰æ„é€ å‡½æ•°å¼ºåˆ¶å®ç°ä¸å¯å®ä¾‹åŒ–çš„ä¸»è¦åŸå› æ˜¯é˜²æ­¢ç±»è¢«æ„å¤–åœ°å®ä¾‹åŒ–ï¼Œä»¥ä½¿ä»£ç æ›´åŠ å¥å£®å’Œå¯é ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ç±»ä¸­çš„é™æ€æ–¹æ³•å’Œé™æ€å­—æ®µï¼Œè€Œä¸éœ€è¦åˆ›å»ºè¯¥ç±»çš„å®ä¾‹ã€‚å¦‚æœç±»ä¸­æ²¡æœ‰æ˜¾å¼åœ°å®šä¹‰ç§æœ‰æ„é€ å‡½æ•°ï¼ŒJava ç¼–è¯‘å™¨å°†ä¼šè‡ªåŠ¨ä¸ºè¯¥ç±»ç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„å…¬å…±æ„é€ å‡½æ•°ï¼Œè¿™æ„å‘³ç€è¯¥ç±»å¯ä»¥åœ¨å…¶ä»–ç±»ä¸­è¢«å®ä¾‹åŒ–ã€‚å¦‚æœè¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œä¸ºäº†é˜²æ­¢å…¶ä»–äººæ„å¤–åœ°å®ä¾‹åŒ–æˆ‘ä»¬çš„ç±»ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ„é€ å‡½æ•°è®¾ç½®ä¸ºç§æœ‰ã€‚\næ­¤å¤–ï¼Œä½¿ç”¨ç§æœ‰æ„é€ å‡½æ•°å¼ºåˆ¶å®ç°ä¸å¯å®ä¾‹åŒ–è¿˜æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š\næ˜ç¡®è¡¨æ˜è¯¥ç±»ä¸å¯è¢«å®ä¾‹åŒ–ï¼Œæé«˜äº†ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ é˜²æ­¢ç±»è¢«å­ç±»åŒ–ï¼Œä»è€Œé¿å…äº†ç»§æ‰¿æ‰€å¸¦æ¥çš„å‰¯ä½œç”¨å’Œä¸å¿…è¦çš„å¤æ‚æ€§ã€‚ æé«˜äº†ä»£ç çš„å®‰å…¨æ€§ï¼Œé˜²æ­¢å…¶ä»–ç±»åœ¨ä¸åˆé€‚çš„æƒ…å†µä¸‹å®ä¾‹åŒ–è¯¥ç±»ã€‚ è¿™æ˜¯ä¸€ä¸ªå®ç°äº†ç§æœ‰æ„é€ å‡½æ•°å¼ºåˆ¶å®ç°ä¸å¯å®ä¾‹åŒ–çš„ç±»çš„ç¤ºä¾‹ï¼š\npublic class UtilityClass { // ç¦æ­¢é»˜è®¤æ„é€ å‡½æ•°é˜²æ­¢å®ä¾‹åŒ– private UtilityClass() { throw new AssertionError(); } // å…¶ä»–é™æ€æ–¹æ³•å’Œå­—æ®µ // ... } è¿™ä¸ªç±»ä¸­çš„ç§æœ‰æ„é€ å‡½æ•°ä¼šåœ¨è¢«è°ƒç”¨æ—¶æŠ›å‡ºAssertionErrorã€‚è¿™æ ·åšå¯ä»¥ç¡®ä¿æ„é€ å‡½æ•°æ°¸è¿œä¸ä¼šä»ç±»å†…éƒ¨æˆ–å¤–éƒ¨è°ƒç”¨ã€‚\né€šè¿‡å°†æ„é€ å‡½æ•°è®¾ç½®ä¸ºç§æœ‰ï¼Œè¿™ä¸ªç±»å°±ä¸èƒ½ä»å¤–éƒ¨è¢«å®ä¾‹åŒ–ã€‚è¿™ä¸ªä¹ æƒ¯ç”¨æ³•ä¹Ÿé˜²æ­¢äº†ç±»è¢«å­ç±»åŒ–ã€‚å¦‚æœä¸€ä¸ªç±»çš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ï¼Œé‚£ä¹ˆå®ƒä¸èƒ½è¢«å­ç±»è°ƒç”¨ï¼Œå› ä¸ºå­ç±»å¿…é¡»è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°æ¥å®Œæˆåˆå§‹åŒ–ã€‚å› æ­¤ï¼Œå¦‚æœä¸€ä¸ªç±»çš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ï¼Œå®ƒå°±ä¸èƒ½è¢«å­ç±»åŒ–ï¼Œå› ä¸ºå­ç±»ä¸èƒ½è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°æ¥å®Œæˆåˆå§‹åŒ–ã€‚\nä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ç§æœ‰æ„é€ å‡½æ•°é˜²æ­¢ç±»è¢«å­ç±»åŒ–ï¼š\npublic final class FinalClass { private FinalClass() { // private constructor } public static void doSomething() { // do something } } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒFinalClassè¢«å£°æ˜ä¸ºfinalï¼Œå› æ­¤ä¸èƒ½è¢«å­ç±»åŒ–ã€‚æ­¤å¤–ï¼Œå®ƒçš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ï¼Œå› æ­¤ä¸èƒ½ä»å­ç±»ä¸­è¢«è°ƒç”¨ã€‚ç”±äºè¯¥ç±»ä¸èƒ½è¢«å­ç±»åŒ–ï¼Œå› æ­¤å®ƒçš„è¡Œä¸ºä¸ä¼šå—åˆ°å­ç±»çš„å½±å“ï¼Œä»è€Œé¿å…äº†ç»§æ‰¿æ‰€å¸¦æ¥çš„å‰¯ä½œç”¨å’Œä¸å¿…è¦çš„å¤æ‚æ€§ã€‚\nåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå°†ç±»è®¾ç½®ä¸ºä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œä½†å¯ä»¥è¢«å­ç±»åŒ–æ˜¯æœ‰ç”¨çš„ã€‚è¿™é€šå¸¸æ˜¯å› ä¸ºæˆ‘ä»¬å¸Œæœ›å­ç±»åŒ–çš„ç±»èƒ½å¤Ÿç»§æ‰¿çˆ¶ç±»çš„è¡Œä¸ºå’Œå±æ€§ï¼ŒåŒæ—¶åˆä¸å¸Œæœ›å¤–éƒ¨èƒ½å¤Ÿå®ä¾‹åŒ–è¯¥ç±»ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼š\npublic abstract class Animal { private String name; protected Animal(String name) { this.name = name; } public String getName() { return name; } public abstract void makeSound(); } public class Dog extends Animal { public Dog(String name) { super(name); } @Override public void makeSound() { System.","title":"ã€ŠEffective Java 3ã€‹ç¬”è®°4ï¼šç”¨ç§æœ‰æ„é€ å‡½æ•°ä½¿ç±»ä¸å¯å®ä¾‹åŒ–"},{"content":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-04-17 åˆ° 2023-04-23 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¿™å‘¨çš„å·¥ä½œï¼Œæ‰‹ä¸Šç´¯ç§¯äº†ä¸‰ä¸ªè¿­ä»£ç‰ˆæœ¬ï¼Œå› ä¸ºä¸´è¿‘äº”ä¸€åŠå…¶ä»–åŸå› ï¼ŒçŸ­æœŸå†…æ— æ³•å‘å¸ƒä¸Šçº¿ã€‚å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæƒ³ç€è¿™äº›ç‰ˆæœ¬éƒ½ä¼šä¸€ä¸ªä¸ªä¸Šçº¿ï¼Œæ‰€ä»¥ä¸‰ä¸ªç‰ˆæœ¬ä¹‹é—´åˆå¹¶äº†ä»£ç ï¼Œå­˜åœ¨äº†ä¾èµ–å…³ç³»ã€‚ä»¥åï¼Œè¿˜æ˜¯éœ€è¦å°ç‰ˆæœ¬è¿­ä»£ã€ä¸Šä¸€ä¸ªç‰ˆæœ¬å‘å¸ƒä¹‹åå†ä» main åˆ†æ”¯åˆå¹¶ä»£ç ã€‚\nè¿™å‘¨å…ˆåçœ‹äº†ã€ŠçŒç¯®é«˜æ‰‹ã€‹ç”µå½±ã€ã€Šæ˜¥å±±å¦‚ç¬‘ã€‹è¯å‰§ï¼Œä½“éªŒäº†ä¸¤ç§è‰ºæœ¯è¡¨ç°å½¢å¼ï¼Œéƒ½è®©äººå¤±æœ›ã€‚\nåˆ©ç”¨ç©ºä½™æ—¶é—´ï¼Œå°† n8n è¿›è¡Œäº†è°ƒæ•´ï¼Œåªå°†æˆ‘åœ¨è±†ç“£ã€githubã€spotifyã€blogã€strava ä¸Šçš„æ´»åŠ¨åŒæ­¥åˆ° telegramï¼Œè€Œç›´æ¥ä¸åŒæ­¥åˆ° memosï¼Œå•ç‹¬åˆ›å»ºä¸€ä¸ª workflow å°† telegram åŒæ­¥åˆ° memosã€‚è¿™æ · telegram æ˜¯ä¸€ä¸ªå¯¹å¤–åˆ†äº«çš„é¢‘é“ï¼Œè€Œ memos å¯ä»¥åˆ†äº«ä¸€äº›ä¸ªäººçš„å¿ƒæƒ…æˆ–è€…è¯´è¯´ã€‚å¦å¤–ï¼Œä¸ºäº†å‡å°‘å¯¹å¤§å®¶çš„å¹²æ‰°ï¼Œä¸å†å°† rss è®¢é˜…å†…å®¹åŒæ­¥åˆ°æˆ‘çš„ telegram é¢‘é“ã€‚\nçŒç¯®é«˜æ‰‹ 4 æœˆ 20 æ—¥ï¼ŒçŒç¯®é«˜æ‰‹å›½å†…ä¸Šæ˜ ï¼ŒæŠ½æ—¶é—´ä¸‹ç­å’Œè€å©†å»çœ‹äº†è¿™åœºç”µå½±ã€‚çœ‹å®Œä¹‹åå‘äº†ä¸€ä¸ªæœ‹å‹åœˆï¼š\nä¸¤ä¸ªå°æ—¶çš„ç”µå½±ï¼Œä¸€åœºç¯®çƒæ¯”èµ›ï¼Œå°½æ˜¯å›å¿†ï¼Œç•™ä¸‹çš„æ˜¯åŠäº©è‰¯ç”°åŠäº©å·®è¯„\nè¿™å°±æ˜¯æˆ‘å¯¹è¿™ä¸ªç”µå½±çš„è¯„ä»·ã€‚å› ä¸ºæƒ…æ€€è€Œå»çœ‹äº†è¿™éƒ¨ç”µå½±ï¼Œå´è¢«æƒ…æ€€å‡ºå–äº†ï¼Œè¿™å¹´å¤´æƒ…æ€€ä¸å€¼é’±äº†ä¹ˆï¼Ÿæ•´éƒ¨ç”µå½±ä»¥å®«åŸè‰¯ç”°ä¸ºè§†è§’ï¼Œä¸åœçš„å›å¿†ï¼Œå››ååˆ†é’Ÿçš„æ¯”èµ›èŠ‚å¥ä¸åœçš„ä¸­æ–­ã€‚å¾ˆå¤šç‰‡æ®µéƒ½æ˜¯åŠ¨ç”»é‡Œçš„å†…å®¹ï¼Œæ²¡æœ‰å¤šå°‘æ–°å†…å®¹ã€‚æµå·æ«çš„åˆ»ç”»å¤ªå°‘ã€æ¨±æœ¨èŠ±é“è¿˜æ˜¯é‚£æ ·å‹‡çŒ›ã€æ™´å­å°±æ²¡å‡ºç°å‡ æ¬¡ã€‚ã€‚ã€‚\nçœ‹è¯å‰§ å‘¨å…­å»ä¸­å—å‰§åœºçœ‹äº†ä¸€ä¸ªè¯å‰§ã€Šæ˜¥å±±å¦‚ç¬‘ã€‹ï¼Œè¿™æ˜¯ç¬¬ä¸€æ¬¡çœ‹è¯å‰§ï¼Œç¬¬ä¸€æ¬¡æ¥è§¦è¯å‰§è¿™ä¸ªè‰ºæœ¯è¡¨ç°å½¢å¼ã€‚ç›¸æ¯”è¾ƒäºç”µå½±ï¼Œæˆ‘è¿˜æ˜¯æ›´å–œæ¬¢çœ‹ç”µå½±ã€‚\nç†è´¢ è¿™å‘¨æ€»è®¡æ”¯å‡º 292.5 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š\n4 æœˆ 21 æ—¥ï¼š59 å…ƒï¼Œå’ŒåŒäº‹ä¸€èµ·åƒé¥­ 4 æœˆ 22 æ—¥ï¼š232 å…ƒï¼Œå‘¨æœ«ä¹°èœåšé¥­ï¼Œä¹°æ°´æœ 4 æœˆ 24 æ—¥ï¼š1.5 å…ƒï¼Œè·‘æ­¥å°è…¿æŠ½ç­‹ï¼Œéª‘å…±äº«å•è½¦å›å…¬å¸ å››æœˆç´¯è®¡æ”¯å‡ºå…± 2417 å…ƒï¼Œå…¶ä¸­é¤é¥®å’Œè´­ç‰©å äº†ä¸€åŠã€‚\nå¥èº« æ¯å¤©èµ°ä¸€ä¸‡æ­¥ï¼Œè¿™å‘¨å®Œæˆäº†ç›®æ ‡ã€‚ä»¥åæ¯å¤©è·‘æ­¥çš„è¯ï¼Œè¿™ä¸ªç›®æ ‡å°±å¾ˆå®¹æ˜“è¾¾æˆäº†ï¼Œç”šè‡³è¿™ä¸ªç›®æ ‡ä¼šæ¢æˆæ¯å¤©è·‘æ­¥ã€‚\nä» strava çš„è®­ç»ƒæ—¥å¿—ï¼Œå¯ä»¥çœ‹åˆ°æœ¬å‘¨è¿åŠ¨è®°å½•å¦‚ä¸‹ï¼š\nä» strava çš„è®­ç»ƒæ—¥å†ï¼Œå¯ä»¥çœ‹åˆ°æˆªè‡³ 24 æ—¥ï¼Œæœ¬æœˆè¿åŠ¨äº† 20 å¤©ï¼Œ23 æ¬¡ï¼Œä¸€å…±è·‘æ­¥äº† 100 å…¬é‡Œã€‚\nå·¥ä½œ Effective Java 3 ç¬”è®° è¯·å‚è€ƒã€Šã€ŠEffective Java 3ã€‹ç¬”è®°ï¼šé¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ã€‹ã€‚\nä¸Šé¢è¿™ä¸ªå›¾æ˜¯ä½¿ç”¨ Shots åˆ¶ä½œçš„ï¼Œå®ƒæ˜¯å…è´¹çš„ï¼Œå¯ä»¥åˆ¶ä½œå¥½çœ‹çš„å›¾ç‰‡ï¼Œå¼ºçƒˆæ¨èä½¿ç”¨ã€‚\næœ¬å‘¨åˆ†äº« è™½ç„¶å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€ChenSoul Shareã€Telegram é¢‘é“ï¼Œä¸è¿‡è¿˜æ˜¯æŒ‘é€‰ä¸€éƒ¨åˆ†åœ¨è¿™é‡Œåˆ—ä¸¾ä¸€ä¸‹ï¼Œæ„Ÿè§‰æ›´åƒä¸€ä¸ª newsletter äº†ã€‚\nä¸€äº›æ–‡ç«  ä½¿ç”¨ Python å®ç° RSS è½¬ Newsletter 5 ç§å¾®æœåŠ¡æ³¨å†Œä¸­å¿ƒè¯¥å¦‚ä½•é€‰å‹ï¼Ÿ 5 Years of Indie Hacking ä¸€ä¸ªæŠ€æœ¯ç²¾è‡´çš„ç½‘ç«™ï¼šæ¥å£è®¾è®¡å’Œå›¾ç‰‡åŠ è½½ æŠ›å¼ƒåˆè´µåˆéš¾ç”¨çš„å½•å±è½¯ä»¶ï¼Œ3 åˆ†é’Ÿå…¥é—¨ FFmpeg å¼€å§‹å­¦ä¹ å’Œä½¿ç”¨ Rust ä¸€äº›å·¥å…· EnhanceAI ä½¿ç”¨ä¸€è¡Œä»£ç ä¸ºç½‘ç«™çš„è¾“å…¥æ¡†å¢åŠ ä¸Š AI èƒ½åŠ›ã€‚\nAvatar Maker ä¸€æ¬¾åœ¨çº¿ 2D åŠ¨æ¼«å¤´åƒç”Ÿæˆå™¨ï¼Œæ•ˆæœæ¯”è¾ƒåç¾æ¼«é£æ ¼ã€‚é’ˆå¯¹äºåŠèº«å¤´åƒçš„ä¸€äº›ç‰¹å¾ï¼Œæä¾›äº†ä¸°å¯Œçš„é€‰é¡¹ã€‚\nMarkflow ç½‘é¡µå…ƒç´ å¿«é€Ÿæ‹·è´çš„å·¥å…·ï¼Œæ”¯æŒå¤åˆ¶ç²˜è´´åˆ° Figmaï¼ŒReactï¼ŒHtml é‡Œã€‚è¿™ä¸ªç½‘é¡µä¸­å¯ä»¥è¯•ç”¨ï¼ŒInspector çš„æ•ˆæœè¿˜æ˜¯å¾ˆä¸é”™çš„ã€‚å°±æ˜¯ Free Plan æ¯ä¸ªæœˆåªèƒ½æ‹·è´ 5 ä¸ª elements æœ‰ç‚¹è¿‡äºæ²¡è¯šæ„ã€‚\nShots ä¸€æ¬¾åœ¨çº¿ Mockup å·¥å…·ï¼Œèƒ½éå¸¸å¿«é€Ÿçš„åšå‡ºå¥—å£³çš„æ•ˆæœå›¾ï¼Œå†…ç½®çš„æ¨¡ç‰ˆå¾ˆå¤šï¼Œæ ·å¼è°ƒæ•´çš„é¢—ç²’åº¦ä¹Ÿå¾ˆç»†ã€‚é€‚åˆç‹¬ç«‹å¼€å‘å¿«é€Ÿå‡ºå›¾ã€‚\næœ¬å‘¨å˜€å’• å…¶å®ï¼Œå¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€ChenSoul Shareã€Telegram é¢‘é“æˆ–è€…æˆ‘çš„ memos ä¸­ï¼Œå¦‚æœæœ‰ä¸€ä¸ªè„šæœ¬å¯ä»¥è¯»å– Telegram æˆ–è€… memos æ¥å£è·å–ä¸Šå‘¨çš„åˆ†äº«è®°å½•ï¼Œåˆ™å¯ä»¥è‡ªåŠ¨åŒ–ç”Ÿæˆåˆ†äº«å†…å®¹äº†ã€‚äºæ˜¯ï¼ŒèŠ±äº†ä¸€ç‚¹æ—¶é—´å†™äº†ä¸€ä¸ª python è„šæœ¬ fetch_memos.py æ¥è¯»å– memos æ¥å£ã€‚\nè·å–åˆ°çš„å†…å®¹å¦‚ä¸‹ï¼š\n2023-04-21 08:31:23 ğŸ“º çœ‹è¿‡çŒç¯®é«˜æ‰‹ #douban #watched æŸ¥çœ‹é“¾æ¥ 2023-04-18 20:33:47 ğŸ“º çœ‹è¿‡é¾™é©¬ç²¾ç¥ #douban #watched æŸ¥çœ‹é“¾æ¥ 2023-04-18 20:33:47 ğŸ“– æœ€è¿‘åœ¨è¯» Rust æƒå¨æŒ‡å— #douban #reading æŸ¥çœ‹é“¾æ¥ 2023-04-18 20:33:47 ğŸ“– æœ€è¿‘åœ¨è¯» Python ç¼–ç¨‹ #douban #reading æŸ¥çœ‹é“¾æ¥ 2023-04-18 20:33:47 ğŸ“– æœ€è¿‘åœ¨è¯» Python å·¥åŒ  #douban #reading æŸ¥çœ‹é“¾æ¥ 2023-04-18 18:40:50 ğŸ“ å‘¨æŠ¥-15 ï½œ Umami å‡çº§åˆ° 2.0ã€æ±‰è¡—èœ¡åƒé¦†ã€ä½¿ç”¨ Strava è·‘æ­¥ #blog æŸ¥çœ‹é“¾æ¥ 2023-04-17 17:48:43 ğŸŒŸ chensoul starred chensoul/chensoul.github.io #github #star æŸ¥çœ‹é“¾æ¥ 2023-04-17 17:10:45 ğŸ“ ã€ŠEffective Java 3ã€‹ç¬”è®°ï¼šä½¿ç”¨ç§æœ‰æ„é€ å‡½æ•°æˆ–æšä¸¾ç±»å‹åˆ›å»ºå•ä¾‹ #blog æŸ¥çœ‹é“¾æ¥ åç»­çš„æƒ³æ³•ï¼šå¯¹ä¸Šé¢å†…å®¹è¿›è¡Œåˆ†ç±»ï¼Œæ¯”å¦‚ï¼Œå°†å¸¦æœ‰è±†ç“£ã€Githubã€Stravaã€Spotfyã€Blog æ ‡ç­¾çš„å†…å®¹ï¼Œå½’çº³ä¸ºæˆ‘æœ€è¿‘çš„æ´»åŠ¨ï¼›å°†å¸¦æœ‰ toolã€skill ç­‰æ ‡ç­¾å…¶ä»–å†…å®¹å½’çº³ä¸ºæˆ‘çš„åˆ†äº«ï¼ˆæŠ€æœ¯ç›¸å…³ï¼‰ï¼›å°†å…¶ä»–å†…å®¹å½’çº³ä¸ºæˆ‘å‘è¡¨çš„è¯´è¯´ã€‚\nä»¥ä¸Šã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/04/25/weekly_review_16/","summary":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-04-17 åˆ° 2023-04-23 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¿™å‘¨çš„å·¥ä½œï¼Œæ‰‹ä¸Šç´¯ç§¯äº†ä¸‰ä¸ªè¿­ä»£ç‰ˆæœ¬ï¼Œå› ä¸ºä¸´è¿‘äº”ä¸€åŠå…¶ä»–åŸå› ï¼ŒçŸ­æœŸå†…æ— æ³•å‘å¸ƒä¸Šçº¿ã€‚å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæƒ³ç€è¿™äº›ç‰ˆæœ¬éƒ½ä¼šä¸€ä¸ªä¸ªä¸Šçº¿ï¼Œæ‰€ä»¥ä¸‰ä¸ªç‰ˆæœ¬ä¹‹é—´åˆå¹¶äº†ä»£ç ï¼Œå­˜åœ¨äº†ä¾èµ–å…³ç³»ã€‚ä»¥åï¼Œè¿˜æ˜¯éœ€è¦å°ç‰ˆæœ¬è¿­ä»£ã€ä¸Šä¸€ä¸ªç‰ˆæœ¬å‘å¸ƒä¹‹åå†ä» main åˆ†æ”¯åˆå¹¶ä»£ç ã€‚\nè¿™å‘¨å…ˆåçœ‹äº†ã€ŠçŒç¯®é«˜æ‰‹ã€‹ç”µå½±ã€ã€Šæ˜¥å±±å¦‚ç¬‘ã€‹è¯å‰§ï¼Œä½“éªŒäº†ä¸¤ç§è‰ºæœ¯è¡¨ç°å½¢å¼ï¼Œéƒ½è®©äººå¤±æœ›ã€‚\nåˆ©ç”¨ç©ºä½™æ—¶é—´ï¼Œå°† n8n è¿›è¡Œäº†è°ƒæ•´ï¼Œåªå°†æˆ‘åœ¨è±†ç“£ã€githubã€spotifyã€blogã€strava ä¸Šçš„æ´»åŠ¨åŒæ­¥åˆ° telegramï¼Œè€Œç›´æ¥ä¸åŒæ­¥åˆ° memosï¼Œå•ç‹¬åˆ›å»ºä¸€ä¸ª workflow å°† telegram åŒæ­¥åˆ° memosã€‚è¿™æ · telegram æ˜¯ä¸€ä¸ªå¯¹å¤–åˆ†äº«çš„é¢‘é“ï¼Œè€Œ memos å¯ä»¥åˆ†äº«ä¸€äº›ä¸ªäººçš„å¿ƒæƒ…æˆ–è€…è¯´è¯´ã€‚å¦å¤–ï¼Œä¸ºäº†å‡å°‘å¯¹å¤§å®¶çš„å¹²æ‰°ï¼Œä¸å†å°† rss è®¢é˜…å†…å®¹åŒæ­¥åˆ°æˆ‘çš„ telegram é¢‘é“ã€‚\nçŒç¯®é«˜æ‰‹ 4 æœˆ 20 æ—¥ï¼ŒçŒç¯®é«˜æ‰‹å›½å†…ä¸Šæ˜ ï¼ŒæŠ½æ—¶é—´ä¸‹ç­å’Œè€å©†å»çœ‹äº†è¿™åœºç”µå½±ã€‚çœ‹å®Œä¹‹åå‘äº†ä¸€ä¸ªæœ‹å‹åœˆï¼š\nä¸¤ä¸ªå°æ—¶çš„ç”µå½±ï¼Œä¸€åœºç¯®çƒæ¯”èµ›ï¼Œå°½æ˜¯å›å¿†ï¼Œç•™ä¸‹çš„æ˜¯åŠäº©è‰¯ç”°åŠäº©å·®è¯„\nè¿™å°±æ˜¯æˆ‘å¯¹è¿™ä¸ªç”µå½±çš„è¯„ä»·ã€‚å› ä¸ºæƒ…æ€€è€Œå»çœ‹äº†è¿™éƒ¨ç”µå½±ï¼Œå´è¢«æƒ…æ€€å‡ºå–äº†ï¼Œè¿™å¹´å¤´æƒ…æ€€ä¸å€¼é’±äº†ä¹ˆï¼Ÿæ•´éƒ¨ç”µå½±ä»¥å®«åŸè‰¯ç”°ä¸ºè§†è§’ï¼Œä¸åœçš„å›å¿†ï¼Œå››ååˆ†é’Ÿçš„æ¯”èµ›èŠ‚å¥ä¸åœçš„ä¸­æ–­ã€‚å¾ˆå¤šç‰‡æ®µéƒ½æ˜¯åŠ¨ç”»é‡Œçš„å†…å®¹ï¼Œæ²¡æœ‰å¤šå°‘æ–°å†…å®¹ã€‚æµå·æ«çš„åˆ»ç”»å¤ªå°‘ã€æ¨±æœ¨èŠ±é“è¿˜æ˜¯é‚£æ ·å‹‡çŒ›ã€æ™´å­å°±æ²¡å‡ºç°å‡ æ¬¡ã€‚ã€‚ã€‚\nçœ‹è¯å‰§ å‘¨å…­å»ä¸­å—å‰§åœºçœ‹äº†ä¸€ä¸ªè¯å‰§ã€Šæ˜¥å±±å¦‚ç¬‘ã€‹ï¼Œè¿™æ˜¯ç¬¬ä¸€æ¬¡çœ‹è¯å‰§ï¼Œç¬¬ä¸€æ¬¡æ¥è§¦è¯å‰§è¿™ä¸ªè‰ºæœ¯è¡¨ç°å½¢å¼ã€‚ç›¸æ¯”è¾ƒäºç”µå½±ï¼Œæˆ‘è¿˜æ˜¯æ›´å–œæ¬¢çœ‹ç”µå½±ã€‚\nç†è´¢ è¿™å‘¨æ€»è®¡æ”¯å‡º 292.5 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š\n4 æœˆ 21 æ—¥ï¼š59 å…ƒï¼Œå’ŒåŒäº‹ä¸€èµ·åƒé¥­ 4 æœˆ 22 æ—¥ï¼š232 å…ƒï¼Œå‘¨æœ«ä¹°èœåšé¥­ï¼Œä¹°æ°´æœ 4 æœˆ 24 æ—¥ï¼š1.5 å…ƒï¼Œè·‘æ­¥å°è…¿æŠ½ç­‹ï¼Œéª‘å…±äº«å•è½¦å›å…¬å¸ å››æœˆç´¯è®¡æ”¯å‡ºå…± 2417 å…ƒï¼Œå…¶ä¸­é¤é¥®å’Œè´­ç‰©å äº†ä¸€åŠã€‚\nå¥èº« æ¯å¤©èµ°ä¸€ä¸‡æ­¥ï¼Œè¿™å‘¨å®Œæˆäº†ç›®æ ‡ã€‚ä»¥åæ¯å¤©è·‘æ­¥çš„è¯ï¼Œè¿™ä¸ªç›®æ ‡å°±å¾ˆå®¹æ˜“è¾¾æˆäº†ï¼Œç”šè‡³è¿™ä¸ªç›®æ ‡ä¼šæ¢æˆæ¯å¤©è·‘æ­¥ã€‚\nä» strava çš„è®­ç»ƒæ—¥å¿—ï¼Œå¯ä»¥çœ‹åˆ°æœ¬å‘¨è¿åŠ¨è®°å½•å¦‚ä¸‹ï¼š\nä» strava çš„è®­ç»ƒæ—¥å†ï¼Œå¯ä»¥çœ‹åˆ°æˆªè‡³ 24 æ—¥ï¼Œæœ¬æœˆè¿åŠ¨äº† 20 å¤©ï¼Œ23 æ¬¡ï¼Œä¸€å…±è·‘æ­¥äº† 100 å…¬é‡Œã€‚\nå·¥ä½œ Effective Java 3 ç¬”è®° è¯·å‚è€ƒã€Šã€ŠEffective Java 3ã€‹ç¬”è®°ï¼šé¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ã€‹ã€‚\nä¸Šé¢è¿™ä¸ªå›¾æ˜¯ä½¿ç”¨ Shots åˆ¶ä½œçš„ï¼Œå®ƒæ˜¯å…è´¹çš„ï¼Œå¯ä»¥åˆ¶ä½œå¥½çœ‹çš„å›¾ç‰‡ï¼Œå¼ºçƒˆæ¨èä½¿ç”¨ã€‚\næœ¬å‘¨åˆ†äº« è™½ç„¶å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€ChenSoul Shareã€Telegram é¢‘é“ï¼Œä¸è¿‡è¿˜æ˜¯æŒ‘é€‰ä¸€éƒ¨åˆ†åœ¨è¿™é‡Œåˆ—ä¸¾ä¸€ä¸‹ï¼Œæ„Ÿè§‰æ›´åƒä¸€ä¸ª newsletter äº†ã€‚\nä¸€äº›æ–‡ç«  ä½¿ç”¨ Python å®ç° RSS è½¬ Newsletter 5 ç§å¾®æœåŠ¡æ³¨å†Œä¸­å¿ƒè¯¥å¦‚ä½•é€‰å‹ï¼Ÿ 5 Years of Indie Hacking ä¸€ä¸ªæŠ€æœ¯ç²¾è‡´çš„ç½‘ç«™ï¼šæ¥å£è®¾è®¡å’Œå›¾ç‰‡åŠ è½½ æŠ›å¼ƒåˆè´µåˆéš¾ç”¨çš„å½•å±è½¯ä»¶ï¼Œ3 åˆ†é’Ÿå…¥é—¨ FFmpeg å¼€å§‹å­¦ä¹ å’Œä½¿ç”¨ Rust ä¸€äº›å·¥å…· EnhanceAI ä½¿ç”¨ä¸€è¡Œä»£ç ä¸ºç½‘ç«™çš„è¾“å…¥æ¡†å¢åŠ ä¸Š AI èƒ½åŠ›ã€‚","title":"å‘¨æŠ¥-16ï½œã€ŠçŒç¯®é«˜æ‰‹ã€‹ç”µå½±ã€ã€Šæ˜¥å±±å¦‚ç¬‘ã€‹è¯å‰§"},{"content":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼šé¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ã€‚\nä»‹ç» åˆ›å»ºå¯¹è±¡æ—¶ï¼Œç»å¸¸ä¼šå¤ç”¨å¯¹è±¡ã€‚å¦‚æœå¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œé‚£ä¹ˆå®ƒæ€»æ˜¯å¯ä»¥è¢«å¤ç”¨çš„ã€‚\nä¸‹é¢ä¸€ä¸ªä¾‹å­ï¼š\nString s = new String(\u0026#34;bikini\u0026#34;); // DON\u0026#39;T DO THIS! è¯¥è¯­å¥æ¯æ¬¡æ‰§è¡Œæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ String å®ä¾‹ï¼Œè€Œè¿™äº›å¯¹è±¡åˆ›å»ºéƒ½ä¸æ˜¯å¿…éœ€çš„ã€‚String æ„é€ å‡½æ•°çš„å‚æ•° (\u0026quot;bikini\u0026quot;) æœ¬èº«å°±æ˜¯ä¸€ä¸ª String å®ä¾‹ï¼Œåœ¨åŠŸèƒ½ä¸Šä¸æ„é€ å‡½æ•°åˆ›å»ºçš„æ‰€æœ‰å¯¹è±¡ç›¸åŒã€‚å¦‚æœè¿™ç§ç”¨æ³•å‘ç”Ÿåœ¨å¾ªç¯æˆ–é¢‘ç¹è°ƒç”¨çš„æ–¹æ³•ä¸­ï¼Œåˆ›å»ºå¤§é‡ String å®ä¾‹æ˜¯ä¸å¿…è¦çš„ã€‚\næ”¹è¿›åçš„ç‰ˆæœ¬å¦‚ä¸‹ï¼š\nString s = \u0026#34;bikini\u0026#34;; è¿™ä¸ªç‰ˆæœ¬ä½¿ç”¨å•ä¸ª String å®ä¾‹ï¼Œè€Œä¸æ˜¯æ¯æ¬¡æ‰§è¡Œæ—¶éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚æ­¤å¤–ï¼Œå¯ä»¥ä¿è¯åœ¨åŒä¸€è™šæ‹Ÿæœºä¸­è¿è¡Œçš„å…¶ä»–ä»£ç éƒ½å¯ä»¥å¤ç”¨è¯¥å¯¹è±¡ï¼Œåªè¦æ°å¥½åŒ…å«ç›¸åŒçš„å­—ç¬¦ä¸²å­—é¢é‡ã€‚\né€šå¸¸å¯ä»¥é€šè¿‡ä½¿ç”¨é™æ€å·¥å‚æ–¹æ³•æ¥é¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯åœ¨æä¾›è¿™ä¸¤ç§æ–¹æ³•çš„ä¸å¯å˜ç±»ä¸Šä½¿ç”¨æ„é€ å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œå·¥å‚æ–¹æ³• Boolean.valueOf(String) æ¯”æ„é€ å‡½æ•° Boolean(String) æ›´å¯å–ï¼Œåè€…åœ¨ Java 9 ä¸­è¢«å¼ƒç”¨äº†ã€‚æ„é€ å‡½æ•°æ¯æ¬¡è°ƒç”¨æ—¶éƒ½å¿…é¡»åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè€Œå·¥å‚æ–¹æ³•ä»æ¥ä¸éœ€è¦è¿™æ ·åšï¼Œåœ¨å®é™…åº”ç”¨ä¸­ä¹Ÿä¸ä¼šè¿™æ ·åšã€‚é™¤äº†å¤ç”¨ä¸å¯å˜å¯¹è±¡ä¹‹å¤–ï¼Œå¦‚æœçŸ¥é“å¯å˜å¯¹è±¡ä¸ä¼šè¢«ä¿®æ”¹ï¼Œä¹Ÿå¯ä»¥å¤ç”¨å®ƒä»¬ã€‚\næœ‰äº›å¯¹è±¡çš„åˆ›å»ºçš„ä»£ä»·ç›¸æ¯”è€Œè¨€è¦æ˜‚è´µå¾—å¤šã€‚å¦‚æœä½ éœ€è¦é‡å¤åœ°ä½¿ç”¨è¿™æ ·ä¸€ä¸ªã€Œæ˜‚è´µçš„å¯¹è±¡ã€ï¼Œé‚£ä¹ˆæœ€å¥½å°†å…¶ç¼“å­˜ä»¥ä¾›å¤ç”¨ã€‚\nä¸‹é¢æ˜¯ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æœ€ç®€å•çš„æ–¹æ³•ï¼š\n// Performance can be greatly improved! static boolean isRomanNumeral(String s) { return s.matches(\u0026#34;^(?=.)M*(C[MD]|D?C{0,3})\u0026#34; + \u0026#34;(X[CL]|L?X{0,3})(I[XV]|V?I{0,3})$\u0026#34;); } è¿™ä¸ªå®ç°çš„é—®é¢˜æ˜¯å®ƒä¾èµ–äº String.matches æ–¹æ³•ã€‚è™½ç„¶ String.matches æ˜¯æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„æœ€ç®€å•æ–¹æ³•ï¼Œä½†å®ƒä¸é€‚åˆåœ¨æ€§èƒ½å…³é”®çš„æƒ…å†µä¸‹é‡å¤ä½¿ç”¨ã€‚ é—®é¢˜åœ¨äºï¼Œå®ƒåœ¨å†…éƒ¨ä¸ºæ­£åˆ™è¡¨è¾¾å¼åˆ›å»ºäº†ä¸€ä¸ª Pattern å®ä¾‹ï¼Œå¹¶ä¸”åªä½¿ç”¨ä¸€æ¬¡ï¼Œä¹‹åå°±è¿›è¡Œåƒåœ¾æ”¶é›†äº†ã€‚åˆ›å»ºä¸€ä¸ª Pattern å®ä¾‹æ˜¯å¾ˆæ˜‚è´µçš„ï¼Œå› ä¸ºå®ƒéœ€è¦å°†æ­£åˆ™è¡¨è¾¾å¼ç¼–è¯‘æˆæœ‰é™çš„çŠ¶æ€æœºã€‚\nä¸ºäº†æé«˜æ€§èƒ½ï¼Œå°†æ­£åˆ™è¡¨è¾¾å¼æ˜¾å¼ç¼–è¯‘ä¸º Pattern å®ä¾‹ï¼ˆå®ƒæ˜¯ä¸å¯å˜çš„ï¼‰ï¼Œä½œä¸ºç±»åˆå§‹åŒ–çš„ä¸€éƒ¨åˆ†ï¼Œç¼“å­˜å®ƒï¼Œå¹¶åœ¨æ¯æ¬¡è°ƒç”¨ isRomanNumeral æ–¹æ³•æ—¶å¤ç”¨åŒä¸€ä¸ªå®ä¾‹ï¼š\n// Reusing expensive object for improved performance public class RomanNumerals { private static final Pattern ROMAN = Pattern.compile(\u0026#34;^(?=.)M*(C[MD]|D?C{0,3})\u0026#34; + \u0026#34;(X[CL]|L?X{0,3})(I[XV]|V?I{0,3})$\u0026#34;); static boolean isRomanNumeral(String s) { return ROMAN.matcher(s).matches(); } } å¦‚æœé¢‘ç¹è°ƒç”¨ isRomanNumeralï¼Œæ”¹è¿›ç‰ˆæœ¬å°†æä¾›æ˜¾è‘—çš„æ€§èƒ½æå‡ã€‚ä¸ä»…æ€§èƒ½å¾—åˆ°äº†æ”¹å–„ï¼Œæ¸…æ™°åº¦ä¹Ÿå¾—åˆ°äº†æé«˜ã€‚ä¸ºä¸å¯è§çš„ Pattern å®ä¾‹åˆ›å»ºä¸€ä¸ªé™æ€ç»ˆæ€å­—æ®µå…è®¸æˆ‘ä»¬ä¸ºå®ƒå‘½åï¼Œè¿™æ¯”æ­£åˆ™è¡¨è¾¾å¼æœ¬èº«æ›´å®¹æ˜“é˜…è¯»ã€‚\nå¦‚æœåŠ è½½åŒ…å«æ”¹è¿›ç‰ˆ isRomanNumeral æ–¹æ³•çš„ç±»æ—¶ï¼Œè¯¥æ–¹æ³•ä»æœªè¢«è°ƒç”¨è¿‡ï¼Œé‚£ä¹ˆåˆå§‹åŒ–å­—æ®µ ROMAN æ˜¯ä¸å¿…è¦çš„ã€‚å› æ­¤ï¼Œå¯ä»¥ç”¨å»¶è¿Ÿåˆå§‹åŒ–å­—æ®µçš„æ–¹å¼åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨ isRomanNumeral æ–¹æ³•æ—¶æ‰åˆå§‹åŒ–å­—æ®µï¼Œè€Œä¸æ˜¯åœ¨ç±»åŠ è½½æ—¶åˆå§‹åŒ–ï¼Œä½†ä¸å»ºè®®è¿™æ ·åšã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå»¶è¿Ÿåˆå§‹åŒ–ä¼šä½¿å®ç°å¤æ‚åŒ–ï¼Œè€Œæ²¡æœ‰æ˜æ˜¾çš„æ€§èƒ½æ”¹å–„ã€‚\nå½“ä¸€ä¸ªå¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œå¾ˆæ˜æ˜¾ï¼Œå®ƒå¯ä»¥å®‰å…¨åœ°å¤ç”¨ï¼Œä½†åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œå®ƒè¿œä¸é‚£ä¹ˆæ˜æ˜¾ï¼Œç”šè‡³è¿åç›´è§‰ã€‚è€ƒè™‘é€‚é…å™¨çš„æƒ…å†µï¼Œä¹Ÿç§°ä¸ºè§†å›¾ã€‚é€‚é…å™¨æ˜¯å§”æ‰˜ç»™æ”¯æŒå¯¹è±¡çš„å¯¹è±¡ï¼Œæä¾›äº†ä¸€ä¸ªæ›¿ä»£æ¥å£ã€‚å› ä¸ºé€‚é…å™¨çš„çŠ¶æ€ä¸è¶…è¿‡å…¶æ”¯æŒå¯¹è±¡çš„çŠ¶æ€ï¼Œæ‰€ä»¥ä¸éœ€è¦ä¸ºç»™å®šå¯¹è±¡åˆ›å»ºä¸€ä¸ªç»™å®šé€‚é…å™¨çš„å¤šä¸ªå®ä¾‹ã€‚\nä¾‹å¦‚ï¼ŒMap æ¥å£çš„ keySet æ–¹æ³•è¿”å› Map å¯¹è±¡çš„ Set è§†å›¾ï¼Œå…¶ä¸­åŒ…å« Map ä¸­çš„æ‰€æœ‰é”®ã€‚äº‹å®ä¸Šï¼Œè¿”å›çš„ Set å®ä¾‹é€šå¸¸æ˜¯å¯å˜çš„ï¼Œä½†æ‰€æœ‰è¿”å›çš„å¯¹è±¡åœ¨åŠŸèƒ½ä¸Šéƒ½æ˜¯ç›¸åŒçš„ï¼Œå› ä¸ºå®ƒä»¬éƒ½ç”±ç›¸åŒçš„ Map å®ä¾‹æ”¯æŒã€‚å› æ­¤ï¼Œå¯¹ç»™å®š Map å¯¹è±¡ä¸Šçš„ keySet çš„æ¯æ¬¡è°ƒç”¨éƒ½å¯èƒ½è¿”å›ç›¸åŒçš„ Set å®ä¾‹ã€‚\nç”±äºè¿”å›çš„ Set å®ä¾‹åœ¨åŠŸèƒ½ä¸Šæ˜¯ç›¸åŒçš„ï¼Œå› æ­¤åˆ›å»º keySet è§†å›¾å¯¹è±¡çš„å¤šä¸ªå®ä¾‹æ˜¯ä¸å¿…è¦çš„ï¼Œä¹Ÿæ²¡æœ‰å¥½å¤„ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨ keySet è§†å›¾çš„æ—¶å€™ï¼Œæˆ‘ä»¬åº”è¯¥å°½å¯èƒ½åœ°é‡ç”¨åŒä¸€ä¸ª Set å®ä¾‹ï¼Œè€Œä¸æ˜¯æ¯æ¬¡è°ƒç”¨ keySet æ–¹æ³•éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„ Set å®ä¾‹ã€‚\nä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•é‡ç”¨ keySet è§†å›¾çš„ Set å®ä¾‹ï¼š\nimport java.util.HashMap; import java.util.Map; import java.util.Set; public class TestKeySetReuse { private static final Map\u0026lt;Integer, String\u0026gt; map = new HashMap\u0026lt;\u0026gt;(); public static void main(String[] args) { map.put(1, \u0026#34;one\u0026#34;); map.put(2, \u0026#34;two\u0026#34;); map.put(3, \u0026#34;three\u0026#34;); Set\u0026lt;Integer\u0026gt; keySet1 = map.keySet(); Set\u0026lt;Integer\u0026gt; keySet2 = map.keySet(); System.out.println(keySet1 == keySet2); // trueï¼Œè¯´æ˜æ˜¯åŒä¸€ä¸ªå®ä¾‹ keySet1.remove(1); System.out.println(map); // {2=two, 3=three} System.out.println(keySet2); // [2, 3] } } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª HashMap å¯¹è±¡ï¼Œå¹¶å‘å…¶ä¸­æ·»åŠ äº†ä¸€äº›é”®å€¼å¯¹ã€‚ç„¶åï¼Œæˆ‘ä»¬ä¸¤æ¬¡è°ƒç”¨ keySet æ–¹æ³•ï¼Œåˆ†åˆ«å°†è¿”å›çš„ Set å®ä¾‹ä¿å­˜åˆ° keySet1 å’Œ keySet2 å˜é‡ä¸­ã€‚\nç”±äº keySet1 å’Œ keySet2 æ˜¯ç”±ç›¸åŒçš„ Map å®ä¾‹æ”¯æŒçš„ï¼Œå› æ­¤å®ƒä»¬æ˜¯ç›¸ç­‰çš„ï¼Œå³ keySet1 == keySet2 è¿”å› trueã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå®é™…ä¸Šå®ƒä»¬æ˜¯åŒä¸€ä¸ª Set å®ä¾‹ã€‚\nç„¶åï¼Œæˆ‘ä»¬ä» keySet1 ä¸­åˆ é™¤ä¸€ä¸ªé”®ï¼Œå¹¶æ‰“å°å‡º Map å’Œ keySet2 çš„å†…å®¹ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬ä¿®æ”¹äº† keySet1 ä¸­çš„å†…å®¹æ—¶ï¼ŒkeySet2 ä¹Ÿè¢«ä¿®æ”¹äº†ï¼Œå› ä¸ºå®ƒä»¬æ˜¯åŒä¸€ä¸ª Set å®ä¾‹ã€‚\nå› æ­¤ï¼Œåœ¨ä½¿ç”¨ Map çš„ keySet æ–¹æ³•æ—¶ï¼Œåº”è¯¥å°½å¯èƒ½åœ°é‡ç”¨åŒä¸€ä¸ª Set å®ä¾‹ï¼Œä»¥é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»ºå’Œä¸å¿…è¦çš„è¡Œä¸ºã€‚\nå¦ä¸€ç§åˆ›å»ºä¸å¿…è¦å¯¹è±¡çš„æ–¹æ³•æ˜¯è‡ªåŠ¨è£…ç®±ï¼Œå®ƒå…è®¸ç¨‹åºå‘˜æ··åˆåŸºæœ¬ç±»å‹å’ŒåŒ…è£…ç±»å‹ï¼Œæ ¹æ®éœ€è¦è‡ªåŠ¨è£…ç®±å’Œæ‹†ç®±ã€‚è‡ªåŠ¨è£…ç®±æ¨¡ç³Šäº†åŸºæœ¬ç±»å‹å’ŒåŒ…è£…ç±»å‹ä¹‹é—´çš„åŒºåˆ«ï¼Œ ä¸¤è€…æœ‰ç»†å¾®çš„è¯­ä¹‰å·®åˆ«å’Œä¸æ˜æ˜¾çš„æ€§èƒ½å·®åˆ«ã€‚\n// Hideously slow! Can you spot the object creation? private static long sum() { Long sum = 0L; for (long i = 0; i \u0026lt;= Integer.MAX_VALUE; i++) sum += i; return sum; } è¿™ä¸ªç¨‹åºå¾—åˆ°äº†æ­£ç¡®çš„ç­”æ¡ˆï¼Œä½†æ˜¯ç”±äºä¸€ä¸ªå­—ç¬¦çš„å°åˆ·é”™è¯¯ï¼Œå®ƒçš„é€Ÿåº¦æ¯”å®é™…è¦æ…¢å¾—å¤šã€‚å˜é‡ sum è¢«å£°æ˜ä¸º Long è€Œä¸æ˜¯ longï¼Œè¿™æ„å‘³ç€ç¨‹åºå°†æ„é€ å¤§çº¦ 231 ä¸ªä¸å¿…è¦çš„ Long å®ä¾‹ï¼ˆå¤§çº¦æ¯æ¬¡å°† Long i æ·»åŠ åˆ° Long sum æ—¶éƒ½æœ‰ä¸€ä¸ªå®ä¾‹ï¼‰ã€‚å°† sum çš„å£°æ˜ä» Long æ›´æ”¹ä¸º longï¼Œæœºå™¨ä¸Šçš„è¿è¡Œæ—¶é—´å°†ä» 6.3 ç§’å‡å°‘åˆ° 0.59 ç§’ã€‚æ•™è®­å¾ˆæ¸…æ¥šï¼šåŸºæœ¬ç±»å‹ä¼˜äºåŒ…è£…ç±»ï¼Œè¿˜åº”æé˜²æ„å¤–çš„è‡ªåŠ¨è£…ç®±ã€‚\næœ¬æ¡ç›®ä¸åº”è¯¥è¢«æ›²è§£ä¸ºæ˜¯åœ¨æš—ç¤ºåˆ›å»ºå¯¹è±¡æ˜¯æˆæœ¬æ˜‚è´µçš„ï¼Œåº”è¯¥é¿å…ã€‚ç›¸åï¼Œåˆ›å»ºå’Œå›æ”¶è¿™äº›å°å¯¹è±¡çš„æ„é€ å‡½æ•°æˆæœ¬æ˜¯å¾ˆä½å»‰çš„ï¼Œå°¤å…¶æ˜¯åœ¨ç°ä»£ JVM å®ç°ä¸Šã€‚åˆ›å»ºé¢å¤–çš„å¯¹è±¡æ¥å¢å¼ºç¨‹åºçš„æ¸…æ™°æ€§ã€ç®€å•æ€§æˆ–åŠŸèƒ½é€šå¸¸æ˜¯ä»¶å¥½äº‹ã€‚\nç›¸åï¼Œé€šè¿‡ç»´æŠ¤è‡ªå·±çš„å¯¹è±¡æ± æ¥é¿å…åˆ›å»ºå¯¹è±¡ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œé™¤éæ± ä¸­çš„å¯¹è±¡éå¸¸é‡é‡çº§ã€‚è¯æ˜å¯¹è±¡æ± æ˜¯åˆç†çš„å¯¹è±¡çš„å…¸å‹ä¾‹å­æ˜¯æ•°æ®åº“è¿æ¥ã€‚å»ºç«‹è¿æ¥çš„æˆæœ¬éå¸¸é«˜ï¼Œå› æ­¤å¤ç”¨è¿™äº›å¯¹è±¡æ˜¯æœ‰æ„ä¹‰çš„ã€‚ç„¶è€Œï¼Œä¸€èˆ¬æ¥è¯´ï¼Œç»´æŠ¤è‡ªå·±çš„å¯¹è±¡æ± ä¼šä½¿ä»£ç æ··ä¹±ï¼Œå¢åŠ å†…å­˜å ç”¨ï¼Œå¹¶æŸå®³æ€§èƒ½ã€‚ç°ä»£ JVM å®ç°å…·æœ‰é«˜åº¦ä¼˜åŒ–çš„åƒåœ¾æ”¶é›†å™¨ï¼Œåœ¨è½»é‡çº§å¯¹è±¡ä¸Šå¾ˆå®¹æ˜“èƒœè¿‡è¿™æ ·çš„å¯¹è±¡æ± ã€‚\næ€»ç»“ é¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡å¯ä»¥æé«˜æ€§èƒ½å’Œå‡å°‘å†…å­˜å ç”¨ã€‚\n// ä¸æ¨èçš„å†™æ³•ï¼Œä¼šåˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ Integer sum = 0; for (int i = 0; i \u0026lt; 1000000; i++) { sum += i; } // æ¨èçš„å†™æ³•ï¼Œä½¿ç”¨åŸºæœ¬ç±»å‹ int sum = 0; for (int i = 0; i \u0026lt; 1000000; i++) { sum += i; } å¦‚æœä¸€ä¸ªå¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œå¯ä»¥å°†å…¶ç¼“å­˜èµ·æ¥å¹¶é‡å¤ä½¿ç”¨ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éœ€è¦æ—¶éƒ½åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ã€‚\nä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ä¸å¯å˜å¯¹è±¡å’Œå®ƒä»¬çš„ç¼“å­˜å®ç°ï¼š\nå­—ç¬¦ä¸²å¸¸é‡æ±  Java è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼Œå› æ­¤å­—ç¬¦ä¸²å¸¸é‡å¯ä»¥è¢«ç¼“å­˜èµ·æ¥å¹¶é‡å¤ä½¿ç”¨ã€‚Java è™šæ‹Ÿæœºç»´æŠ¤äº†ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œå®ƒç¼“å­˜äº†æ‰€æœ‰çš„å­—ç¬¦ä¸²å¸¸é‡ï¼Œå¹¶ç¡®ä¿ç›¸åŒçš„å­—ç¬¦ä¸²åªè¢«åˆ›å»ºä¸€æ¬¡ã€‚\nString s1 = \u0026#34;Hello\u0026#34;; // ä»å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­è·å– String s2 = \u0026#34;Hello\u0026#34;; // ä»å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­è·å– String s3 = new String(\u0026#34;Hello\u0026#34;); // åˆ›å»ºæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ System.out.println(s1 == s2); // true System.out.println(s1 == s3); // false æ•°å­—å¸¸é‡æ±  Java è¯­è¨€ä¸­çš„æ•´æ•°ã€æµ®ç‚¹æ•°å’Œå­—ç¬¦ç­‰åŸºæœ¬æ•°æ®ç±»å‹çš„å€¼ä¹Ÿå¯ä»¥è¢«ç¼“å­˜èµ·æ¥å¹¶é‡å¤ä½¿ç”¨ã€‚Java è™šæ‹Ÿæœºç»´æŠ¤äº†ä¸€ä¸ªæ•°å­—å¸¸é‡æ± ï¼Œå®ƒç¼“å­˜äº†ä¸€å®šèŒƒå›´å†…çš„æ•´æ•°ã€æµ®ç‚¹æ•°å’Œå­—ç¬¦ç­‰åŸºæœ¬æ•°æ®ç±»å‹çš„å€¼ï¼Œå¹¶ç¡®ä¿ç›¸åŒçš„å€¼åªè¢«åˆ›å»ºä¸€æ¬¡ã€‚\nInteger i1 = 100; // ä»æ•°å­—å¸¸é‡æ± ä¸­è·å– Integer i2 = 100; // ä»æ•°å­—å¸¸é‡æ± ä¸­è·å– Integer i3 = new Integer(100); // åˆ›å»ºæ–°çš„ Integer å¯¹è±¡ System.out.println(i1 == i2); // true System.out.println(i1 == i3); // false æ³¨æ„ï¼šæ•°å­—å¸¸é‡æ± çš„èŒƒå›´å¯ä»¥é€šè¿‡ JVM å‚æ•° -XX:AutoBoxCacheMax=\u0026lt;size\u0026gt; æ¥è°ƒæ•´ï¼Œå…¶ä¸­ \u0026lt;size\u0026gt; æ˜¯å¸¸é‡æ± çš„å¤§å°ã€‚\næšä¸¾å¸¸é‡ Java è¯­è¨€ä¸­çš„æšä¸¾å¸¸é‡æ˜¯ä¸å¯å˜çš„ï¼Œå®ƒä»¬åœ¨æšä¸¾ç±»å‹è¢«åŠ è½½æ—¶å°±è¢«åˆ›å»ºå¹¶ç¼“å­˜èµ·æ¥ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éœ€è¦æ—¶éƒ½åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ã€‚\nenum Color { RED, GREEN, BLUE }; Color c1 = Color.RED; // è·å–æšä¸¾å¸¸é‡ RED Color c2 = Color.GREEN; // è·å–æšä¸¾å¸¸é‡ GREEN Color c3 = new Color(\u0026#34;YELLOW\u0026#34;); // åˆ›å»ºæ–°çš„æšä¸¾å¸¸é‡ System.out.println(c1 == c2); // false System.out.println(c1 == Color.RED); // true LocalDateã€LocalTimeã€LocalDateTime Java 8 å¼•å…¥çš„æ—¥æœŸæ—¶é—´ API ä¸­çš„ LocalDateã€LocalTimeã€LocalDateTime ç±»å‹éƒ½æ˜¯ä¸å¯å˜çš„ã€‚è¿™äº›ç±»å‹çš„å¯¹è±¡å¯ä»¥è¢«ç¼“å­˜èµ·æ¥å¹¶é‡å¤ä½¿ç”¨ï¼Œä»¥æé«˜ç¨‹åºçš„æ€§èƒ½ã€‚\nLocalDate today = LocalDate.now(); // è·å–å½“å‰æ—¥æœŸ LocalDate tomorrow = today.plusDays(1); // è®¡ç®—æ˜å¤©çš„æ—¥æœŸ LocalDate yesterday = today.minusDays(1); // è®¡ç®—æ˜¨å¤©çš„æ—¥æœŸ å¯ä»¥ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„ ConcurrentHashMap æ¥å®ç° LocalDate çš„ç¼“å­˜ï¼š\nConcurrentHashMap\u0026lt;String, LocalDate\u0026gt; cache = new ConcurrentHashMap\u0026lt;\u0026gt;(); LocalDate date = cache.computeIfAbsent(\u0026#34;2023-04-24\u0026#34;, LocalDate::parse); BigDecimal Java ä¸­çš„ BigDecimal ç±»å‹ä¹Ÿæ˜¯ä¸å¯å˜çš„ï¼Œå®ƒä»¬çš„å€¼åœ¨åˆ›å»ºåä¸ä¼šæ”¹å˜ã€‚å› æ­¤ï¼Œå¯ä»¥å°† BigDecimal å¯¹è±¡ç¼“å­˜èµ·æ¥å¹¶é‡å¤ä½¿ç”¨ï¼Œä»¥é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»ºã€‚\nBigDecimal zero = BigDecimal.ZERO; // ç¼“å­˜ 0 BigDecimal one = BigDecimal.ONE; // ç¼“å­˜ 1 BigDecimal ten = BigDecimal.TEN; // ç¼“å­˜ 10 å¯ä»¥ä½¿ç”¨é™æ€ final å¸¸é‡æ¥å®ç° BigDecimal çš„ç¼“å­˜ï¼š\npublic class Constants { public static final BigDecimal ZERO = BigDecimal.ZERO; public static final BigDecimal ONE = BigDecimal.ONE; public static final BigDecimal TEN = BigDecimal.TEN; } Immutable Collections Guava å’Œ Java 9+ ä¸­éƒ½æä¾›äº†ä¸å¯å˜é›†åˆç±»ï¼Œå¦‚ ImmutableListã€ImmutableSetã€ImmutableMap ç­‰ã€‚è¿™äº›ä¸å¯å˜é›†åˆç±»çš„å¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œå› æ­¤å¯ä»¥è¢«ç¼“å­˜èµ·æ¥å¹¶é‡å¤ä½¿ç”¨ã€‚\nImmutableList\u0026lt;String\u0026gt; list = ImmutableList.of(\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;); // åˆ›å»ºä¸å¯å˜åˆ—è¡¨ ImmutableSet\u0026lt;Integer\u0026gt; set = ImmutableSet.of(1, 2, 3); // åˆ›å»ºä¸å¯å˜é›†åˆ ImmutableMap\u0026lt;String, Integer\u0026gt; map = ImmutableMap.of(\u0026#34;a\u0026#34;, 1, \u0026#34;b\u0026#34;, 2, \u0026#34;c\u0026#34;, 3); // åˆ›å»ºä¸å¯å˜æ˜ å°„ å¯ä»¥ä½¿ç”¨é™æ€ final å¸¸é‡æ¥å®ç°ä¸å¯å˜é›†åˆçš„ç¼“å­˜ï¼š\npublic class Constants { public static final ImmutableList\u0026lt;String\u0026gt; LIST = ImmutableList.of(\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;); public static final ImmutableSet\u0026lt;Integer\u0026gt; SET = ImmutableSet.of(1, 2, 3); public static final ImmutableMap\u0026lt;String, Integer\u0026gt; MAP = ImmutableMap.of(\u0026#34;a\u0026#34;, 1, \u0026#34;b\u0026#34;, 2, \u0026#34;c\u0026#34;, 3); } é¿å…ä½¿ç”¨è£…ç®±ç±»å‹ï¼Œå¦‚ Integerã€Boolean ç­‰ï¼Œå› ä¸ºå®ƒä»¬åœ¨è‡ªåŠ¨è£…ç®±å’Œæ‹†ç®±æ—¶ä¼šåˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ã€‚å¯ä»¥ä½¿ç”¨åŸºæœ¬ç±»å‹å’Œå¯¹è±¡åŒ…è£…ç±»å‹ä¹‹é—´çš„ç›¸äº’è½¬æ¢æ–¹æ³•æ¥é¿å…è¿™ç§æƒ…å†µã€‚\nå¯¹äºå¤§é‡çš„çŸ­å­—ç¬¦ä¸²ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å­—ç¬¦ä¸²æ± æˆ–è€…ä½¿ç”¨ String.intern() æ–¹æ³•ï¼Œä»¥é¿å…åˆ›å»ºå¤§é‡çš„ String å¯¹è±¡ã€‚\n// ä¸æ¨èçš„å†™æ³•ï¼Œä¼šåˆ›å»ºå¤§é‡çš„ String å¯¹è±¡ String str = \u0026#34;\u0026#34;; for (int i = 0; i \u0026lt; 1000000; i++) { str += \u0026#34;a\u0026#34;; } // æ¨èçš„å†™æ³•ï¼Œä½¿ç”¨ StringBuilder å’Œå­—ç¬¦ä¸²æ±  StringBuilder sb = new StringBuilder(); for (int i = 0; i \u0026lt; 1000000; i++) { sb.append(\u0026#34;a\u0026#34;); } String str = sb.toString().intern(); String.intern() æ–¹æ³•\nString.intern() æ–¹æ³•æ˜¯ä¸€ä¸ª native æ–¹æ³•ï¼Œå®ƒçš„ä½œç”¨æ˜¯è¿”å›å­—ç¬¦ä¸²å¯¹è±¡çš„è§„èŒƒåŒ–è¡¨ç¤ºå½¢å¼ï¼Œå³è¿”å›å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ä¸è¯¥å­—ç¬¦ä¸²ç›¸ç­‰çš„å¯¹è±¡çš„å¼•ç”¨ï¼ˆå¦‚æœå¸¸é‡æ± ä¸­å·²ç»å­˜åœ¨è¯¥å­—ç¬¦ä¸²ï¼Œåˆ™ç›´æ¥è¿”å›å¸¸é‡æ± ä¸­çš„å¯¹è±¡ï¼›å¦åˆ™ï¼Œå°†è¯¥å­—ç¬¦ä¸²æ·»åŠ åˆ°å¸¸é‡æ± ä¸­ï¼Œå¹¶è¿”å›è¯¥å­—ç¬¦ä¸²çš„å¼•ç”¨ï¼‰ã€‚\nä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰å¦‚ä¸‹ä»£ç ï¼š\nString s1 = \u0026#34;hello\u0026#34;; String s2 = new String(\u0026#34;hello\u0026#34;); String s3 = s2.intern(); åœ¨è¿™ä¸ªä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ s1ï¼Œå®ƒæ˜¯å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„ä¸€ä¸ªå¯¹è±¡ã€‚ç„¶åï¼Œæˆ‘ä»¬é€šè¿‡ new å…³é”®å­—åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ s2ï¼Œå®ƒä¸ s1 çš„å†…å®¹ç›¸åŒï¼Œä½†æ˜¯å®ƒåœ¨å †å†…å­˜ä¸­åˆ›å»ºã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è°ƒç”¨ s2 çš„ intern() æ–¹æ³•ï¼Œå°† s2 æ”¾å…¥å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œå¹¶è¿”å›å¸¸é‡æ± ä¸­çš„å¯¹è±¡å¼•ç”¨ã€‚å› æ­¤ï¼Œs3 æŒ‡å‘çš„æ˜¯å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å¯¹è±¡ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡æ˜¯å”¯ä¸€çš„ï¼Œå› æ­¤ä½¿ç”¨ intern() æ–¹æ³•å¯ä»¥èŠ‚çœå†…å­˜ç©ºé—´ã€‚ä½†æ˜¯ï¼Œç”±äºå­—ç¬¦ä¸²å¸¸é‡æ± çš„ç©ºé—´æ˜¯æœ‰é™çš„ï¼Œå¦‚æœç¨‹åºä¸­å¤§é‡ä½¿ç”¨ intern() æ–¹æ³•ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¸¸é‡æ± æº¢å‡ºçš„é—®é¢˜ã€‚å› æ­¤ï¼Œå¦‚æœä¸æ˜¯å¿…é¡»ä½¿ç”¨ intern() æ–¹æ³•ï¼Œæœ€å¥½ä¸è¦ä½¿ç”¨å®ƒã€‚\nå¦å¤–ï¼Œç”±äº intern() æ–¹æ³•æ˜¯ä¸€ä¸ª native æ–¹æ³•ï¼Œå®ƒçš„æ€§èƒ½å¯èƒ½ä¼šæ¯”è¾ƒä½ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œåº”è¯¥æ ¹æ®å…·ä½“æƒ…å†µè¿›è¡Œé€‰æ‹©ï¼Œé¿å…æ»¥ç”¨ intern() æ–¹æ³•ã€‚\nå°½é‡ä½¿ç”¨é™æ€å·¥å‚æ–¹æ³•è€Œä¸æ˜¯æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼Œå› ä¸ºé™æ€å·¥å‚æ–¹æ³•å¯ä»¥é‡å¤ä½¿ç”¨å·²ç»åˆ›å»ºçš„å¯¹è±¡ï¼Œä»è€Œé¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ã€‚\n// ä¸æ¨èçš„å†™æ³•ï¼Œæ¯æ¬¡éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ Date now = new Date(); // æ¨èçš„å†™æ³•ï¼Œä½¿ç”¨é™æ€å·¥å‚æ–¹æ³• Date now = Date.from(Instant.now()); é¿å…åˆ›å»ºä¸å¿…è¦çš„æ•°ç»„ï¼Œå¯ä»¥ä½¿ç”¨ Listã€Setã€Map ç­‰é›†åˆç±»å‹æ¥ä»£æ›¿æ•°ç»„ã€‚\n// ä¸æ¨èçš„å†™æ³•ï¼Œä¼šåˆ›å»ºä¸å¿…è¦çš„æ•°ç»„å¯¹è±¡ String[] arr = new String[]{\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;}; // æ¨èçš„å†™æ³•ï¼Œä½¿ç”¨ List List\u0026lt;String\u0026gt; list = Arrays.asList(\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;); å¦‚æœå¿…é¡»åˆ›å»ºä¸å¯å˜çš„æ•°ç»„ï¼Œå¯ä»¥ä½¿ç”¨é™æ€å·¥å‚æ–¹æ³• Arrays.asList() æ¥åˆ›å»º Listï¼Œä»è€Œé¿å…åˆ›å»ºé¢å¤–çš„æ•°ç»„å¯¹è±¡ã€‚\n// ä¸æ¨èçš„å†™æ³•ï¼Œä¼šåˆ›å»ºä¸å¿…è¦çš„æ•°ç»„å¯¹è±¡ String[] arr = new String[]{\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;}; List\u0026lt;String\u0026gt; list = new ArrayList\u0026lt;\u0026gt;(Arrays.asList(arr)); // æ¨èçš„å†™æ³•ï¼Œä½¿ç”¨ Arrays.asList() List\u0026lt;String\u0026gt; list = Arrays.asList(\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;); é¿å…åˆ›å»ºè¿‡å¤šçš„ä¸´æ—¶å¯¹è±¡ï¼Œå¦‚åœ¨å¾ªç¯ä¸­åˆ›å»ºçš„å¯¹è±¡ã€‚å¯ä»¥é‡å¤ä½¿ç”¨å·²ç»åˆ›å»ºçš„å¯¹è±¡ï¼Œæˆ–è€…ä½¿ç”¨å¯é‡ç”¨çš„å¯¹è±¡æ± æ¥å‡å°‘å¯¹è±¡çš„åˆ›å»ºå’Œåƒåœ¾å›æ”¶ã€‚\n// ä¸æ¨èçš„å†™æ³•ï¼Œä¼šåˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ List\u0026lt;String\u0026gt; list = new ArrayList\u0026lt;\u0026gt;(); for (int i = 0; i \u0026lt; 10000; i++) { list.add(String.valueOf(i)); } // æ¨èçš„å†™æ³•ï¼Œä½¿ç”¨å¯é‡ç”¨çš„å¯¹è±¡æ±  List\u0026lt;String\u0026gt; list = new ArrayList\u0026lt;\u0026gt;(); StringBuffer sb = new StringBuffer(); for (int i = 0; i \u0026lt; 10000; i++) { sb.setLength(0); sb.append(i); list.add(sb.toString()); } é¿å…åœ¨ç±»çš„æ„é€ æ–¹æ³•ä¸­åˆ›å»ºå¤§é‡çš„å¯¹è±¡ã€‚å¦‚æœåœ¨æ„é€ æ–¹æ³•ä¸­åˆ›å»ºå¤§é‡çš„å¯¹è±¡ï¼Œä¼šå¯¼è‡´å†…å­˜å ç”¨è¿‡å¤§ï¼Œä»è€Œå½±å“ç¨‹åºçš„æ€§èƒ½ã€‚å¯ä»¥å°†å¯¹è±¡çš„åˆ›å»ºæ”¾åœ¨éœ€è¦ä½¿ç”¨çš„æ–¹æ³•ä¸­ï¼Œæˆ–è€…ä½¿ç”¨æ‡’åŠ è½½çš„æ–¹å¼æ¥å»¶è¿Ÿå¯¹è±¡çš„åˆ›å»ºã€‚\n// ä¸æ¨èçš„å†™æ³•ï¼Œä¼šåœ¨æ„é€ æ–¹æ³•ä¸­åˆ›å»ºå¤§é‡çš„å¯¹è±¡ public class MyClass { private List\u0026lt;String\u0026gt; list = new ArrayList\u0026lt;\u0026gt;(); public MyClass() { for (int i = 0; i \u0026lt; 10000; i++) { list.add(String.valueOf(i)); } } } // æ¨èçš„å†™æ³•ï¼Œå°†å¯¹è±¡çš„åˆ›å»ºæ”¾åœ¨éœ€è¦ä½¿ç”¨çš„æ–¹æ³•ä¸­ public class MyClass { private List\u0026lt;String\u0026gt; list; public MyClass() {} public List\u0026lt;String\u0026gt; getList() { if (list == null) { list = new ArrayList\u0026lt;\u0026gt;(); for (int i = 0; i \u0026lt; 10000; i++) { list.add(String.valueOf(i)); } } return list; } } é¿å…åœ¨é€’å½’æ–¹æ³•ä¸­åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ã€‚å¦‚æœåœ¨é€’å½’æ–¹æ³•ä¸­åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ï¼Œä¼šå¯¼è‡´å†…å­˜å ç”¨è¿‡å¤§ï¼Œä»è€Œå¯¼è‡´æ ˆæº¢å‡ºç­‰é—®é¢˜ã€‚å¯ä»¥ä½¿ç”¨å¯é‡ç”¨çš„å¯¹è±¡æ± æ¥å‡å°‘å¯¹è±¡çš„åˆ›å»ºå’Œåƒåœ¾å›æ”¶ã€‚\n// ä¸æ¨èçš„å†™æ³•ï¼Œä¼šåœ¨é€’å½’æ–¹æ³•ä¸­åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ public static int fibonacci(int n) { if (n \u0026lt;= 1) { return n; } return fibonacci(n - 1) + fibonacci(n - 2); } // æ¨èçš„å†™æ³•ï¼Œä½¿ç”¨å¯é‡ç”¨çš„å¯¹è±¡æ±  public static int fibonacci(int n, Map\u0026lt;Integer, Integer\u0026gt; cache) { if (n \u0026lt;= 1) { return n; } if (cache.containsKey(n)) { return cache.get(n); } int result = fibonacci(n - 1, cache) + fibonacci(n - 2, cache); cache.put(n, result); return result; } é€‚é…å™¨æ¨¡å¼ é€‚é…å™¨æ¨¡å¼æ˜¯ä¸€ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬å°†ä¸€ä¸ªå¯¹è±¡çš„æ¥å£é€‚é…æˆå¦ä¸€ä¸ªå¯¹è±¡çš„æ¥å£ã€‚é€‚é…å™¨æ¨¡å¼é€šå¸¸ç”¨äºä»¥ä¸‹æƒ…å†µï¼š\nå½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€ä¸ªå·²æœ‰çš„ç±»ï¼Œä½†æ˜¯å®ƒçš„æ¥å£ä¸æˆ‘ä»¬æœŸæœ›çš„ä¸å…¼å®¹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é€‚é…å™¨æ¨¡å¼æ¥å°†å…¶æ¥å£é€‚é…æˆæˆ‘ä»¬éœ€è¦çš„æ¥å£ã€‚ å½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨å¤šä¸ªä¸å…¼å®¹çš„ç±»æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é€‚é…å™¨æ¨¡å¼æ¥å°†å®ƒä»¬çš„æ¥å£é€‚é…æˆä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ã€‚ åœ¨é€‚é…å™¨æ¨¡å¼ä¸­ï¼Œé€‚é…å™¨å¯¹è±¡é€šå¸¸æ˜¯ä¸å¯å˜çš„ï¼Œå› ä¸ºå®ƒä»¬çš„çŠ¶æ€ä¸è¶…è¿‡æ”¯æŒå¯¹è±¡çš„çŠ¶æ€ã€‚å› æ­¤ï¼Œå¯ä»¥å®‰å…¨åœ°å¤ç”¨é€‚é…å™¨å¯¹è±¡ã€‚\nä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸ªæ”¯æŒè‹±å›½æ’å¤´çš„è®¾å¤‡ï¼Œä½†æˆ‘ä»¬éœ€è¦å°†å…¶æ’å…¥åˆ°ä¸€ä¸ªç¾å›½æ’åº§ä¸Šã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªé€‚é…å™¨æ¥é€‚é…è‹±å›½æ’å¤´åˆ°ç¾å›½æ’åº§ã€‚é€‚é…å™¨çš„çŠ¶æ€ä¸è¶…è¿‡è‹±å›½æ’å¤´çš„çŠ¶æ€ï¼Œå› æ­¤å¯ä»¥å®‰å…¨åœ°å¤ç”¨é€‚é…å™¨å¯¹è±¡ï¼Œè€Œä¸å¿…ä¸ºæ¯ä¸ªè®¾å¤‡åˆ›å»ºä¸€ä¸ªæ–°çš„é€‚é…å™¨å¯¹è±¡ã€‚\nä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„é€‚é…å™¨ç¤ºä¾‹ï¼š\n// æ”¯æŒè‹±å›½æ’å¤´çš„è®¾å¤‡ public class BritishDevice { public void plugIn() { System.out.println(\u0026#34;Plugged in British device\u0026#34;); } } // ç¾å›½æ’åº§æ¥å£ public interface USPlug { void plug(); } // è‹±å›½åˆ°ç¾å›½çš„é€‚é…å™¨ public class BritishToUSAdapter implements USPlug { private final BritishDevice device; public BritishToUSAdapter(BritishDevice device) { this.device = device; } @Override public void plug() { device.plugIn(); } } // ç¾å›½æ’åº§ public class USOutlet { public void plugIn(USPlug plug) { plug.plug(); } } // æµ‹è¯•é€‚é…å™¨ public class TestAdapter { public static void main(String[] args) { BritishDevice device = new BritishDevice(); BritishToUSAdapter adapter = new BritishToUSAdapter(device); USOutlet outlet = new USOutlet(); outlet.plugIn(adapter); } } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª BritishDevice ç±»æ¥æ¨¡æ‹Ÿä¸€ä¸ªæ”¯æŒè‹±å›½æ’å¤´çš„è®¾å¤‡ã€‚æˆ‘ä»¬è¿˜å®šä¹‰äº†ä¸€ä¸ª USPlug æ¥å£æ¥è¡¨ç¤ºä¸€ä¸ªç¾å›½æ’å¤´ï¼Œä»¥åŠä¸€ä¸ª USOutlet ç±»æ¥è¡¨ç¤ºä¸€ä¸ªç¾å›½æ’åº§ã€‚\næˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªé€‚é…å™¨ç±» BritishToUSAdapter æ¥é€‚é… BritishDevice åˆ° USPlug æ¥å£ã€‚é€‚é…å™¨ç±»çš„æ„é€ å‡½æ•°æ¥æ”¶ä¸€ä¸ª BritishDevice å¯¹è±¡ï¼Œå¹¶å°†å…¶ä¿å­˜åœ¨ä¸€ä¸ªæˆå‘˜å˜é‡ä¸­ã€‚é€‚é…å™¨å®ç°äº† USPlug æ¥å£ï¼Œå¹¶å°† plug æ–¹æ³•å§”æ‰˜ç»™ BritishDevice å¯¹è±¡çš„ plugIn æ–¹æ³•ã€‚\nåœ¨æµ‹è¯•é€‚é…å™¨æ—¶ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª BritishDevice å¯¹è±¡å’Œä¸€ä¸ªé€‚é…å™¨å¯¹è±¡ï¼Œå¹¶å°†é€‚é…å™¨å¯¹è±¡ä¼ é€’ç»™ USOutlet çš„ plugIn æ–¹æ³•ã€‚USOutlet å¯¹è±¡ä½¿ç”¨é€‚é…å™¨å¯¹è±¡æ¥å°† BritishDevice å¯¹è±¡é€‚é…åˆ° USPlug æ¥å£ï¼Œä»è€Œå°†å…¶æ’å…¥åˆ°ç¾å›½æ’åº§ä¸­ã€‚\nåœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œé€‚é…å™¨å¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œå› ä¸ºå®ƒçš„çŠ¶æ€ä¸è¶…è¿‡æ”¯æŒå¯¹è±¡çš„çŠ¶æ€ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å®‰å…¨åœ°å¤ç”¨é€‚é…å™¨å¯¹è±¡ï¼Œè€Œä¸å¿…ä¸ºæ¯ä¸ªè®¾å¤‡åˆ›å»ºä¸€ä¸ªæ–°çš„é€‚é…å™¨å¯¹è±¡ã€‚\næ‰©å±• Java 8 çš„ Stream API é¿å…åˆ›å»ºä¸å¿…è¦å¯¹è±¡ ä¸‹é¢è¿™æ®µä»£ç ï¼š\nlong sum = categoryStatistics.getData().stream().mapToLong(t -\u0026gt; t.getValue()).sum(); åœ¨ä½¿ç”¨ list.stream().mapToLong(t -\u0026gt; t.getValue()).sum() å¯¹é›†åˆä¸­çš„å…ƒç´ è¿›è¡Œæ±‚å’Œæ—¶ï¼Œç¡®å®å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥é¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ã€‚\nå…·ä½“æ¥è¯´ï¼ŒmapToLong() æ–¹æ³•ä¼šå°†é›†åˆä¸­çš„å…ƒç´ æ˜ å°„ä¸ºä¸€ä¸ª LongStream å¯¹è±¡ï¼Œè€Œ LongStream å¯¹è±¡æ˜¯ä¸€ä¸ªåŸå§‹ç±»å‹æµï¼Œå®ƒåœ¨å†…å­˜ä¸­çš„å ç”¨ç©ºé—´æ¯”è¾ƒå°ã€‚å› æ­¤ï¼Œä½¿ç”¨ mapToLong() æ–¹æ³•å¯ä»¥é¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ï¼Œä»è€Œæé«˜ç¨‹åºçš„æ€§èƒ½ã€‚\nå¦å¤–ï¼Œsum() æ–¹æ³•æ˜¯ä¸€ä¸ªç»ˆç«¯æ“ä½œï¼Œå®ƒä¼šå¯¹æµä¸­çš„æ‰€æœ‰å…ƒç´ è¿›è¡Œæ±‚å’Œï¼Œå¹¶è¿”å›æœ€ç»ˆçš„ç»“æœã€‚ç”±äº sum() æ–¹æ³•æ˜¯ä¸€ä¸ªç»ˆç«¯æ“ä½œï¼Œå®ƒä¼šç›´æ¥å¯¹æµä¸­çš„å…ƒç´ è¿›è¡Œæ±‚å’Œï¼Œè€Œä¸ä¼šåˆ›å»ºæ–°çš„å¯¹è±¡ã€‚å› æ­¤ï¼Œä½¿ç”¨ sum() æ–¹æ³•å¯ä»¥è¿›ä¸€æ­¥é¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ï¼Œä»è€Œæé«˜ç¨‹åºçš„æ€§èƒ½ã€‚\nåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œlist.stream().mapToLong(t -\u0026gt; t.getValue()).sum() çš„æ€§èƒ½ä¼šæ¯” list.stream().mapToLong(t -\u0026gt; t.getValue()).reduce(0L, (a, b) -\u0026gt; a + b) æ›´å¥½ã€‚\nåŸå› æ˜¯ï¼Œsum() æ–¹æ³•æ˜¯ä¸€ä¸ªç»ˆç«¯æ“ä½œï¼Œå®ƒä¼šå¯¹æµä¸­çš„æ‰€æœ‰å…ƒç´ è¿›è¡Œæ±‚å’Œï¼Œå¹¶è¿”å›æœ€ç»ˆçš„ç»“æœã€‚sum() æ–¹æ³•åº•å±‚ä½¿ç”¨äº†ä¸€äº›ä¼˜åŒ–æŠ€æœ¯ï¼Œä¾‹å¦‚ä½¿ç”¨å¾ªç¯å±•å¼€ã€ä½¿ç”¨ SIMD æŒ‡ä»¤ç­‰ï¼Œä»è€Œå……åˆ†åˆ©ç”¨ CPU çš„æ€§èƒ½ä¼˜åŠ¿ï¼Œæé«˜è®¡ç®—é€Ÿåº¦ã€‚\nç›¸æ¯”ä¹‹ä¸‹ï¼Œreduce() æ–¹æ³•æ˜¯ä¸€ä¸ªå½’çº¦æ“ä½œï¼Œå®ƒå°†å¯¹æµä¸­çš„å…ƒç´ è¿›è¡Œç´¯è®¡è®¡ç®—ï¼Œå¹¶è¿”å›æœ€ç»ˆçš„ç»“æœã€‚ç”±äº reduce() æ–¹æ³•éœ€è¦å¯¹å…ƒç´ è¿›è¡ŒäºŒå…ƒæ“ä½œï¼Œå› æ­¤å®ƒæ¯” sum() æ–¹æ³•æ›´åŠ å¤æ‚ï¼Œå¯èƒ½ä¼šå¸¦æ¥ä¸€äº›é¢å¤–çš„å¼€é”€ã€‚æ­¤å¤–ï¼Œreduce() æ–¹æ³•è¿˜éœ€è¦æŒ‡å®šä¸€ä¸ªåˆå§‹å€¼ï¼Œå¦‚æœåˆå§‹å€¼ä¸å½“ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç»“æœé”™è¯¯æˆ–è€…æ€§èƒ½ä¸‹é™ã€‚\nä¸è¿‡ï¼Œå¯¹äºæŸäº›ç‰¹æ®Šæƒ…å†µï¼Œreduce() æ–¹æ³•å¯èƒ½ä¼šæ¯” sum() æ–¹æ³•æ›´åŠ é€‚ç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å¯¹æµä¸­çš„å…ƒç´ è¿›è¡Œè‡ªå®šä¹‰çš„ç´¯è®¡è®¡ç®—ï¼Œå°±éœ€è¦ä½¿ç”¨ reduce() æ–¹æ³•ã€‚æ­¤å¤–ï¼Œreduce()æ–¹æ³•è¿˜æ”¯æŒå¹¶è¡Œè®¡ç®—ï¼Œå¯ä»¥å……åˆ†åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨çš„æ€§èƒ½ä¼˜åŠ¿ï¼Œæé«˜è®¡ç®—é€Ÿåº¦ã€‚\nç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬åº”è¯¥æ ¹æ®å…·ä½“æƒ…å†µé€‰æ‹©ä½¿ç”¨ sum() æ–¹æ³•è¿˜æ˜¯ reduce() æ–¹æ³•ã€‚å¯¹äºå¤§å¤šæ•°æƒ…å†µä¸‹çš„æ±‚å’Œæ“ä½œï¼Œsum() æ–¹æ³•æ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒæ¯” reduce() æ–¹æ³•æ›´åŠ é«˜æ•ˆã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œreduce() æ–¹æ³•å¯èƒ½ä¼šæ›´åŠ é€‚ç”¨ã€‚\nä»¥ä¸Šã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/04/24/avoid-creating-unnecessary-objects/","summary":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼šé¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ã€‚\nä»‹ç» åˆ›å»ºå¯¹è±¡æ—¶ï¼Œç»å¸¸ä¼šå¤ç”¨å¯¹è±¡ã€‚å¦‚æœå¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œé‚£ä¹ˆå®ƒæ€»æ˜¯å¯ä»¥è¢«å¤ç”¨çš„ã€‚\nä¸‹é¢ä¸€ä¸ªä¾‹å­ï¼š\nString s = new String(\u0026#34;bikini\u0026#34;); // DON\u0026#39;T DO THIS! è¯¥è¯­å¥æ¯æ¬¡æ‰§è¡Œæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ String å®ä¾‹ï¼Œè€Œè¿™äº›å¯¹è±¡åˆ›å»ºéƒ½ä¸æ˜¯å¿…éœ€çš„ã€‚String æ„é€ å‡½æ•°çš„å‚æ•° (\u0026quot;bikini\u0026quot;) æœ¬èº«å°±æ˜¯ä¸€ä¸ª String å®ä¾‹ï¼Œåœ¨åŠŸèƒ½ä¸Šä¸æ„é€ å‡½æ•°åˆ›å»ºçš„æ‰€æœ‰å¯¹è±¡ç›¸åŒã€‚å¦‚æœè¿™ç§ç”¨æ³•å‘ç”Ÿåœ¨å¾ªç¯æˆ–é¢‘ç¹è°ƒç”¨çš„æ–¹æ³•ä¸­ï¼Œåˆ›å»ºå¤§é‡ String å®ä¾‹æ˜¯ä¸å¿…è¦çš„ã€‚\næ”¹è¿›åçš„ç‰ˆæœ¬å¦‚ä¸‹ï¼š\nString s = \u0026#34;bikini\u0026#34;; è¿™ä¸ªç‰ˆæœ¬ä½¿ç”¨å•ä¸ª String å®ä¾‹ï¼Œè€Œä¸æ˜¯æ¯æ¬¡æ‰§è¡Œæ—¶éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚æ­¤å¤–ï¼Œå¯ä»¥ä¿è¯åœ¨åŒä¸€è™šæ‹Ÿæœºä¸­è¿è¡Œçš„å…¶ä»–ä»£ç éƒ½å¯ä»¥å¤ç”¨è¯¥å¯¹è±¡ï¼Œåªè¦æ°å¥½åŒ…å«ç›¸åŒçš„å­—ç¬¦ä¸²å­—é¢é‡ã€‚\né€šå¸¸å¯ä»¥é€šè¿‡ä½¿ç”¨é™æ€å·¥å‚æ–¹æ³•æ¥é¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯åœ¨æä¾›è¿™ä¸¤ç§æ–¹æ³•çš„ä¸å¯å˜ç±»ä¸Šä½¿ç”¨æ„é€ å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œå·¥å‚æ–¹æ³• Boolean.valueOf(String) æ¯”æ„é€ å‡½æ•° Boolean(String) æ›´å¯å–ï¼Œåè€…åœ¨ Java 9 ä¸­è¢«å¼ƒç”¨äº†ã€‚æ„é€ å‡½æ•°æ¯æ¬¡è°ƒç”¨æ—¶éƒ½å¿…é¡»åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè€Œå·¥å‚æ–¹æ³•ä»æ¥ä¸éœ€è¦è¿™æ ·åšï¼Œåœ¨å®é™…åº”ç”¨ä¸­ä¹Ÿä¸ä¼šè¿™æ ·åšã€‚é™¤äº†å¤ç”¨ä¸å¯å˜å¯¹è±¡ä¹‹å¤–ï¼Œå¦‚æœçŸ¥é“å¯å˜å¯¹è±¡ä¸ä¼šè¢«ä¿®æ”¹ï¼Œä¹Ÿå¯ä»¥å¤ç”¨å®ƒä»¬ã€‚\næœ‰äº›å¯¹è±¡çš„åˆ›å»ºçš„ä»£ä»·ç›¸æ¯”è€Œè¨€è¦æ˜‚è´µå¾—å¤šã€‚å¦‚æœä½ éœ€è¦é‡å¤åœ°ä½¿ç”¨è¿™æ ·ä¸€ä¸ªã€Œæ˜‚è´µçš„å¯¹è±¡ã€ï¼Œé‚£ä¹ˆæœ€å¥½å°†å…¶ç¼“å­˜ä»¥ä¾›å¤ç”¨ã€‚\nä¸‹é¢æ˜¯ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æœ€ç®€å•çš„æ–¹æ³•ï¼š\n// Performance can be greatly improved! static boolean isRomanNumeral(String s) { return s.matches(\u0026#34;^(?=.)M*(C[MD]|D?C{0,3})\u0026#34; + \u0026#34;(X[CL]|L?X{0,3})(I[XV]|V?I{0,3})$\u0026#34;); } è¿™ä¸ªå®ç°çš„é—®é¢˜æ˜¯å®ƒä¾èµ–äº String.matches æ–¹æ³•ã€‚è™½ç„¶ String.matches æ˜¯æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„æœ€ç®€å•æ–¹æ³•ï¼Œä½†å®ƒä¸é€‚åˆåœ¨æ€§èƒ½å…³é”®çš„æƒ…å†µä¸‹é‡å¤ä½¿ç”¨ã€‚ é—®é¢˜åœ¨äºï¼Œå®ƒåœ¨å†…éƒ¨ä¸ºæ­£åˆ™è¡¨è¾¾å¼åˆ›å»ºäº†ä¸€ä¸ª Pattern å®ä¾‹ï¼Œå¹¶ä¸”åªä½¿ç”¨ä¸€æ¬¡ï¼Œä¹‹åå°±è¿›è¡Œåƒåœ¾æ”¶é›†äº†ã€‚åˆ›å»ºä¸€ä¸ª Pattern å®ä¾‹æ˜¯å¾ˆæ˜‚è´µçš„ï¼Œå› ä¸ºå®ƒéœ€è¦å°†æ­£åˆ™è¡¨è¾¾å¼ç¼–è¯‘æˆæœ‰é™çš„çŠ¶æ€æœºã€‚\nä¸ºäº†æé«˜æ€§èƒ½ï¼Œå°†æ­£åˆ™è¡¨è¾¾å¼æ˜¾å¼ç¼–è¯‘ä¸º Pattern å®ä¾‹ï¼ˆå®ƒæ˜¯ä¸å¯å˜çš„ï¼‰ï¼Œä½œä¸ºç±»åˆå§‹åŒ–çš„ä¸€éƒ¨åˆ†ï¼Œç¼“å­˜å®ƒï¼Œå¹¶åœ¨æ¯æ¬¡è°ƒç”¨ isRomanNumeral æ–¹æ³•æ—¶å¤ç”¨åŒä¸€ä¸ªå®ä¾‹ï¼š\n// Reusing expensive object for improved performance public class RomanNumerals { private static final Pattern ROMAN = Pattern.compile(\u0026#34;^(?=.)M*(C[MD]|D?C{0,3})\u0026#34; + \u0026#34;(X[CL]|L?X{0,3})(I[XV]|V?I{0,3})$\u0026#34;); static boolean isRomanNumeral(String s) { return ROMAN.","title":"ã€ŠEffective Java 3ã€‹ç¬”è®°6ï¼šé¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡"},{"content":"å‰è¨€ é¢˜å›¾ï¼šæ¥šæ²³æ±‰è¡—èœ¡åƒé¦†\næœ¬ç¯‡æ˜¯å¯¹ 2023-04-10 åˆ° 2023-04-16 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¿™å‘¨çš„å·¥ä½œä¸ç®—å¿™ç¢Œï¼Œç»§ç»­å­¦ä¹ ã€ŠEffective Java 3ã€‹è¿™æœ¬ä¹¦ï¼Œå¹¶èŠ±äº†ä¸€äº›æ—¶é—´å­¦ä¹  Rustã€Python çš„åŸºç¡€è¯­æ³•ã€‚\nè¿™ä¸ªæœˆå·²ç»è¿‡äº†ä¸€åŠï¼Œå‡è‚¥ä¹Ÿè¿›è¡Œäº†ä¸¤å‘¨ï¼Œä½“é‡ä» 72 å…¬æ–¤å‡åˆ°äº†ç°åœ¨çš„ 68.4 å…¬æ–¤ã€‚åœ¨ä¹‹å‰æ¯å¤©èµ°è·¯ 1 ä¸‡æ­¥çš„åŸºç¡€ä¸Šï¼Œæ‰“ç®—å¼€å§‹æ¯å¤©è·‘æ­¥ï¼Œæ¯”è®°å½•è·‘æ­¥æ•°æ®ã€‚\nè¿™å‘¨æ€»è®¡æ”¯å‡º 916 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š\n4 æœˆ 12 æ—¥ï¼š329 å…ƒï¼Œå¼€é€š ETC é¢„å­˜ 300 å…ƒ 4 æœˆ 15 æ—¥ï¼š116 å…ƒï¼Œå‘¨æœ«ä¹°èœåšé¥­ 4 æœˆ 16 æ—¥ï¼š471 å…ƒï¼Œè€å©†è¿‡ç”Ÿï¼Œåƒé¥­å’Œçœ‹ç”µå½± å››æœˆç´¯è®¡æ”¯å‡ºå…± 2025 å…ƒï¼Œå…¶ä¸­é¤é¥®å’Œè´­ç‰©å äº†ä¸€åŠã€‚\nå¥èº« è¿™å‘¨æ¯å¤©èµ°è·¯æ­¥æ•°å¦‚ä¸‹ï¼Œå…¶ä¸­æœ‰ä¸€å¤©å› ä¸ºåŠ ç­è€Œæ²¡æœ‰å®Œæˆä¸€ä¸‡æ­¥çš„ç›®æ ‡ã€‚\nå— @Conge åšå®¢å½±å“ï¼Œå¼€å§‹è®°å½•æ¯å¤©çš„è·‘æ­¥æ•°æ®ã€‚é¦–å…ˆæ˜¯æ³¨å†Œäº† strava è´¦å·ï¼Œç„¶åå‚è€ƒ running_page éƒ¨ç½²äº†ä¸€ä¸ªæˆ‘çš„è·‘æ­¥ä¸»é¡µ run.chensoul.ccã€‚\nå› ä¸ºæˆ‘ä¹‹å‰æ˜¯ä½¿ç”¨æ‚¦è·‘åœˆ APP è®°å½•è·‘æ­¥ï¼Œæ‰€ä»¥åˆå‚è€ƒè¿™ç¯‡æ–‡ç« å¯¼å‡º gpx æ•°æ®ï¼Œç„¶ååŒæ­¥åˆ° Stravaã€‚æœ€åï¼Œå¯ä»¥æŠŠæ‚¦è·‘åœˆ APP å¸è½½äº†ã€‚\nä¸Šå‘¨è·‘æ­¥æ•°æ®å¦‚ä¸‹ï¼Œæ€»è®¡ 28.64 å…¬é‡Œï¼Œæ¯”ä¸Šå‘¨çš„ 19.05 å…¬é‡Œå¤šäº† 9.6 å…¬é‡Œã€‚\nä¸Šé¢æå®šäº†ä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨ Strava æ¥è·‘æ­¥äº†ã€‚ä¸ºäº†å¢åŠ ç¤¾äº¤ä¹è¶£æ€§ï¼Œæˆ‘åœ¨ n8n é‡Œé¢åˆ›å»ºäº†ä¸€ä¸ª workflowï¼Œå°† Strava æ´»åŠ¨å‘é€åˆ°æˆ‘çš„ã€ChenSoul Shareã€Telegram é¢‘é“ï¼Œæ•ˆæœå¦‚ä¸‹ã€‚\nUmami å‡çº§åˆ° 2.0 1ã€é¦–å…ˆå¤‡ä»½æ•°æ®åº“\n2ã€å‡çº§æ•°æ®åº“\ngit clone https://github.com/umami-software/migrate-v1-v2.git cd migrate-v1-v2 yarn install yarn build åˆ›å»º .env æ–‡ä»¶ï¼š\n#ä¿®æ”¹ä¸ºä½ çš„æ•°æ®åº“åœ°å€ DATABASE_URL=postgresql://umami:xxxxx@postgres.chensoul.cc:5432/umami è¿è¡Œï¼š\nyarn start 3ã€é‡æ–°éƒ¨ç½²é™æ€é¡µé¢\næ—¥å¿—æç¤ºæŠ¥é”™ï¼š\nè§£å†³åŠæ³•æ˜¯ä¿®æ”¹ scripts/check-db.jsï¼š\n4ã€ä¿®æ”¹è·Ÿè¸ªè„šæœ¬ï¼ŒæŠŠç«™ç‚¹ä¸­æ‰€æœ‰è¿½è¸ªè„šæœ¬åå­—umami.jsæ”¹ä¸ºscript.jsã€‚\n5ã€æœ€åæŸ¥çœ‹å®æ—¶ä»ªè¡¨ç›˜ã€‚æˆ‘çš„ umami å®æ—¶ è®¿é—®åœ°å€\nå·¥ä½œ Effective Java 3 ç¬”è®° è¯·å‚è€ƒã€ŠEffective Java 3 ç¬”è®°ï¼šä¾èµ–æ³¨å…¥ä¼˜äºç¡¬ç¼–ç èµ„æºã€‹ã€‚\næ±‰è¡—èœ¡åƒé¦† å‘¨æœ«è¶æ­¦æ±‰æ—…æ¸¸å¤§å¹´å¡è¿˜æ²¡è¿‡æœŸï¼Œè·‘åˆ°æ¥šæ²³æ±‰è¡—èœ¡åƒé¦†å»æºœè¾¾äº†ä¸€åœˆã€‚å› ä¸ºæœ‰å¹´å¡ï¼Œçœå»äº† 150 å…ƒçš„é—¨ç¥¨ã€‚\nå¥½ç‰©åˆ†äº« è™½ç„¶å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€ChenSoul Shareã€Telegram é¢‘é“ï¼Œä¸è¿‡è¿˜æ˜¯æŒ‘é€‰ä¸€éƒ¨åˆ†åœ¨è¿™é‡Œåˆ—ä¸¾ä¸€ä¸‹ï¼Œæ„Ÿè§‰æ›´åƒä¸€ä¸ª newsletter äº†ã€‚\nä¸€äº›æ–‡ç«  1ã€Java ç¼–ç¨‹æ•™ç¨‹\nè¿™ä¸ªç½‘ç«™æ˜¯æ–°åŠ å¡å—æ´‹ç†å·¥å¤§å­¦çš„ä¸€ä½è€å¸ˆçš„æ•™æ¡ˆï¼ˆè‹±æ–‡ï¼‰ï¼Œä¸»è¦å†…å®¹ä¸ºæ–°ç”Ÿçš„ Java ç¼–ç¨‹\n2ã€offsec.tools\nè¿™ä¸ªç½‘ç«™æ”¶é›†å„ç§å®‰å…¨ç›¸å…³çš„è½¯ä»¶å·¥å…·ï¼Œç›®å‰å…±æœ‰ 600 å¤šä¸ªã€‚\n3ã€æˆ‘çš„ä¹ æƒ¯å…»æˆè®¡åˆ’ï¼šäº”åˆ†é’Ÿè§„åˆ™+æ‰“å¡\n4ã€æˆ‘ç¼–ç¨‹ 20 å¹´çš„æŒ‡å¯¼åŸåˆ™\n5ã€ç”¨ zmv æ‰¹é‡é‡å‘½åæ–‡ä»¶\nä¸€äº›å·¥å…· WebPerformance Report è¿™ä¸ªç½‘ç«™å¯ä»¥ç”¨é‚®ç®±è®¢é˜…ä½ çš„ç½‘ç«™æ€§èƒ½çš„ä¸ªæ€§åŒ–æŠ¥å‘Šã€‚å®ƒä¼šç›‘æ§æŒ‡å®šç½‘ç«™çš„æ€§èƒ½ï¼Œæ¯å‘¨ä¼šå‘é€ä¸€å°æŠ¥å‘Šé‚®ä»¶ç»™ä½ ã€‚ ","permalink":"https://blog.chensoul.cc/posts/2023/04/18/weekly_review_15/","summary":"å‰è¨€ é¢˜å›¾ï¼šæ¥šæ²³æ±‰è¡—èœ¡åƒé¦†\næœ¬ç¯‡æ˜¯å¯¹ 2023-04-10 åˆ° 2023-04-16 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¿™å‘¨çš„å·¥ä½œä¸ç®—å¿™ç¢Œï¼Œç»§ç»­å­¦ä¹ ã€ŠEffective Java 3ã€‹è¿™æœ¬ä¹¦ï¼Œå¹¶èŠ±äº†ä¸€äº›æ—¶é—´å­¦ä¹  Rustã€Python çš„åŸºç¡€è¯­æ³•ã€‚\nè¿™ä¸ªæœˆå·²ç»è¿‡äº†ä¸€åŠï¼Œå‡è‚¥ä¹Ÿè¿›è¡Œäº†ä¸¤å‘¨ï¼Œä½“é‡ä» 72 å…¬æ–¤å‡åˆ°äº†ç°åœ¨çš„ 68.4 å…¬æ–¤ã€‚åœ¨ä¹‹å‰æ¯å¤©èµ°è·¯ 1 ä¸‡æ­¥çš„åŸºç¡€ä¸Šï¼Œæ‰“ç®—å¼€å§‹æ¯å¤©è·‘æ­¥ï¼Œæ¯”è®°å½•è·‘æ­¥æ•°æ®ã€‚\nè¿™å‘¨æ€»è®¡æ”¯å‡º 916 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š\n4 æœˆ 12 æ—¥ï¼š329 å…ƒï¼Œå¼€é€š ETC é¢„å­˜ 300 å…ƒ 4 æœˆ 15 æ—¥ï¼š116 å…ƒï¼Œå‘¨æœ«ä¹°èœåšé¥­ 4 æœˆ 16 æ—¥ï¼š471 å…ƒï¼Œè€å©†è¿‡ç”Ÿï¼Œåƒé¥­å’Œçœ‹ç”µå½± å››æœˆç´¯è®¡æ”¯å‡ºå…± 2025 å…ƒï¼Œå…¶ä¸­é¤é¥®å’Œè´­ç‰©å äº†ä¸€åŠã€‚\nå¥èº« è¿™å‘¨æ¯å¤©èµ°è·¯æ­¥æ•°å¦‚ä¸‹ï¼Œå…¶ä¸­æœ‰ä¸€å¤©å› ä¸ºåŠ ç­è€Œæ²¡æœ‰å®Œæˆä¸€ä¸‡æ­¥çš„ç›®æ ‡ã€‚\nå— @Conge åšå®¢å½±å“ï¼Œå¼€å§‹è®°å½•æ¯å¤©çš„è·‘æ­¥æ•°æ®ã€‚é¦–å…ˆæ˜¯æ³¨å†Œäº† strava è´¦å·ï¼Œç„¶åå‚è€ƒ running_page éƒ¨ç½²äº†ä¸€ä¸ªæˆ‘çš„è·‘æ­¥ä¸»é¡µ run.chensoul.ccã€‚\nå› ä¸ºæˆ‘ä¹‹å‰æ˜¯ä½¿ç”¨æ‚¦è·‘åœˆ APP è®°å½•è·‘æ­¥ï¼Œæ‰€ä»¥åˆå‚è€ƒè¿™ç¯‡æ–‡ç« å¯¼å‡º gpx æ•°æ®ï¼Œç„¶ååŒæ­¥åˆ° Stravaã€‚æœ€åï¼Œå¯ä»¥æŠŠæ‚¦è·‘åœˆ APP å¸è½½äº†ã€‚\nä¸Šå‘¨è·‘æ­¥æ•°æ®å¦‚ä¸‹ï¼Œæ€»è®¡ 28.64 å…¬é‡Œï¼Œæ¯”ä¸Šå‘¨çš„ 19.05 å…¬é‡Œå¤šäº† 9.6 å…¬é‡Œã€‚\nä¸Šé¢æå®šäº†ä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨ Strava æ¥è·‘æ­¥äº†ã€‚ä¸ºäº†å¢åŠ ç¤¾äº¤ä¹è¶£æ€§ï¼Œæˆ‘åœ¨ n8n é‡Œé¢åˆ›å»ºäº†ä¸€ä¸ª workflowï¼Œå°† Strava æ´»åŠ¨å‘é€åˆ°æˆ‘çš„ã€ChenSoul Shareã€Telegram é¢‘é“ï¼Œæ•ˆæœå¦‚ä¸‹ã€‚\nUmami å‡çº§åˆ° 2.0 1ã€é¦–å…ˆå¤‡ä»½æ•°æ®åº“\n2ã€å‡çº§æ•°æ®åº“\ngit clone https://github.com/umami-software/migrate-v1-v2.git cd migrate-v1-v2 yarn install yarn build åˆ›å»º .env æ–‡ä»¶ï¼š\n#ä¿®æ”¹ä¸ºä½ çš„æ•°æ®åº“åœ°å€ DATABASE_URL=postgresql://umami:xxxxx@postgres.chensoul.cc:5432/umami è¿è¡Œï¼š","title":"å‘¨æŠ¥-15ï½œUmamiå‡çº§åˆ°2.0ã€æ±‰è¡—èœ¡åƒé¦†ã€ä½¿ç”¨Stravaè·‘æ­¥"},{"content":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼Œåœ¨æ•´ç†ç¬”è®°è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ chatgpt çš„å¸®åŠ©åšäº†ä¸€äº›æ‰©å±•ã€‚\nä»‹ç» ä¾èµ–æ³¨å…¥æ˜¯è½¯ä»¶å·¥ç¨‹ä¸­ä½¿ç”¨çš„ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œç”¨äºå°†ç»„ä»¶å’Œä¾èµ–é¡¹ç›¸äº’è§£è€¦ã€‚è€Œä¸æ˜¯åœ¨ç»„ä»¶å†…éƒ¨åˆ›å»ºå’Œç®¡ç†ä¾èµ–é¡¹ï¼Œæˆ‘ä»¬ä»å¤–éƒ¨ä¼ é€’å®ƒä»¬ã€‚è¿™ç§æ–¹æ³•å¯ä»¥å¸®åŠ©åˆ›å»ºæ›´æ¨¡å—åŒ–å’Œçµæ´»çš„ä»£ç ã€‚\nç›¸æ¯”ä¹‹ä¸‹ï¼Œç¡¬ç¼–ç èµ„æºæ¶‰åŠåœ¨ç»„ä»¶å†…éƒ¨ç›´æ¥åˆ›å»ºå’Œç®¡ç†ä¾èµ–é¡¹ã€‚è¿™ç§æ–¹æ³•å¯èƒ½ä¼šä½¿ä»£ç ä¸å¤ªçµæ´»ï¼Œéš¾ä»¥ç»´æŠ¤ã€‚\nä¸¾ä¾‹ è®¸å¤šç±»ä¾èµ–äºä¸€ä¸ªæˆ–å¤šä¸ªåº•å±‚èµ„æºã€‚ä¾‹å¦‚ï¼Œæ‹¼å†™æ£€æŸ¥ç¨‹åºä¾èµ–äºå­—å…¸ã€‚å¸¸è§åšæ³•æ˜¯ï¼Œå°†è¿™ç§ç±»å®ç°ä¸ºé™æ€å®ç”¨å·¥å…·ç±»ï¼š\n// Inappropriate use of static utility - inflexible \u0026amp; untestable! public class SpellChecker { private static final Lexicon dictionary = ...; private SpellChecker() {} // Noninstantiable public static boolean isValid(String word) { ... } public static List\u0026lt;String\u0026gt; suggestions(String typo) { ... } } ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬ä¹Ÿç»å¸¸çœ‹åˆ°å®ƒä»¬çš„å•ä¾‹å®ç°ï¼š\n// Inappropriate use of singleton - inflexible \u0026amp; untestable! public class SpellChecker { public static INSTANCE = new SpellChecker(...); private final Lexicon dictionary = ...; private SpellChecker(...) {} public boolean isValid(String word) { ... } public List\u0026lt;String\u0026gt; suggestions(String typo) { ... } } è¿™ä¸¤ç§æ–¹æ³•éƒ½ä¸ä»¤äººæ»¡æ„ï¼Œå› ä¸ºå®ƒä»¬å‡è®¾åªä½¿ç”¨ä¸€ä¸ªå­—å…¸ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ¯ç§è¯­è¨€éƒ½æœ‰è‡ªå·±çš„å­—å…¸ï¼Œç‰¹æ®Šçš„å­—å…¸ç”¨äºç‰¹æ®Šçš„è¯æ±‡è¡¨ã€‚å¦å¤–ï¼Œæœ€å¥½ä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„å­—å…¸è¿›è¡Œæµ‹è¯•ã€‚\nä½ å¯ä»¥å°è¯•è®© SpellChecker æ”¯æŒå¤šä¸ªå­—å…¸ï¼šé¦–å…ˆå–æ¶ˆ dictionary å­—æ®µçš„ final ä¿®é¥°ï¼Œå¹¶åœ¨ç°æœ‰çš„æ‹¼å†™æ£€æŸ¥å™¨ä¸­æ·»åŠ æ›´æ”¹ dictionary çš„æ–¹æ³•ã€‚ä½†æ˜¯åœ¨å¹¶å‘ç¯å¢ƒä¸­è¿™ç§åšæ³•æ˜¯ç¬¨æ‹™çš„ã€å®¹æ˜“å‡ºé”™çš„å’Œä¸å¯è¡Œçš„ã€‚é™æ€å®ç”¨å·¥å…·ç±»å’Œå•ä¾‹ä¸é€‚ç”¨äºç”±åº•å±‚èµ„æºå‚æ•°åŒ–çš„ç±»ã€‚\næ‰€éœ€è¦çš„æ˜¯æ”¯æŒç±»çš„å¤šä¸ªå®ä¾‹çš„èƒ½åŠ›ï¼ˆåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­æ˜¯ SpellCheckerï¼‰ï¼Œæ¯ä¸ªå®ä¾‹éƒ½ä½¿ç”¨å®¢æˆ·ç«¯éœ€è¦çš„èµ„æºï¼ˆåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­æ˜¯ dictionaryï¼‰ã€‚æ»¡è¶³æ­¤è¦æ±‚çš„ä¸€ä¸ªç®€å•æ¨¡å¼æ˜¯åœ¨åˆ›å»ºæ–°å®ä¾‹æ—¶å°†èµ„æºä¼ é€’ç»™æ„é€ å‡½æ•°ã€‚ è¿™æ˜¯ä¾èµ–æ³¨å…¥çš„ä¸€ç§å½¢å¼ï¼šå­—å…¸æ˜¯æ‹¼å†™æ£€æŸ¥å™¨çš„ä¾èµ–é¡¹ï¼Œåœ¨åˆ›å»ºå®ƒæ—¶è¢«æ³¨å…¥åˆ°æ‹¼å†™æ£€æŸ¥å™¨ä¸­ã€‚\n// Dependency injection provides flexibility and testability public class SpellChecker { private final Lexicon dictionary; public SpellChecker(Lexicon dictionary) { this.dictionary = Objects.requireNonNull(dictionary); } public boolean isValid(String word) { ... } public List\u0026lt;String\u0026gt; suggestions(String typo) { ... } } ä¾èµ–æ³¨å…¥æ¨¡å¼éå¸¸ç®€å•ï¼Œè®¸å¤šç¨‹åºå‘˜åœ¨ä¸çŸ¥é“å…¶åç§°çš„æƒ…å†µä¸‹ä½¿ç”¨äº†å¤šå¹´ã€‚è™½ç„¶æ‹¼å†™æ£€æŸ¥å™¨ç¤ºä¾‹åªæœ‰ä¸€ä¸ªèµ„æºï¼ˆå­—å…¸ï¼‰ï¼Œä½†æ˜¯ä¾èµ–æ³¨å…¥å¯ä»¥å¤„ç†ä»»æ„æ•°é‡çš„èµ„æºå’Œä»»æ„ä¾èµ–è·¯å¾„ã€‚å®ƒä¿æŒäº†ä¸å¯å˜æ€§ï¼Œå› æ­¤å¤šä¸ªå®¢æˆ·ç«¯å¯ä»¥å…±äº«ä¾èµ–å¯¹è±¡ï¼ˆå‡è®¾å®¢æˆ·ç«¯éœ€è¦ç›¸åŒçš„åº•å±‚èµ„æºï¼‰ã€‚ä¾èµ–æ³¨å…¥åŒæ ·é€‚ç”¨äºæ„é€ å‡½æ•°ã€é™æ€å·¥å‚å’Œæ„å»ºå™¨ã€‚\nä»¥ä¸‹æ˜¯è¿™äº›æƒ…å†µçš„ç¤ºä¾‹ï¼š\næ„é€ å‡½æ•° åœ¨æ„é€ å‡½æ•°ä¸­ä½¿ç”¨ä¾èµ–æ³¨å…¥æ˜¯æœ€å¸¸è§çš„æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸ºUserServiceçš„ç±»ï¼Œå®ƒéœ€è¦ä¸€ä¸ªèƒ½å¤ŸéªŒè¯ç”¨æˆ·çš„UserValidatoræ¥å£ä½œä¸ºä¾èµ–é¡¹ã€‚æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·åœ¨æ„é€ å‡½æ•°ä¸­æ³¨å…¥UserValidatorï¼š\npublic class UserService { private UserValidator userValidator; public UserService(UserValidator userValidator) { this.userValidator = userValidator; } // ... } é™æ€å·¥å‚ é™æ€å·¥å‚æ˜¯ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ï¼Œå®ƒå°†åˆ›å»ºå¯¹è±¡çš„é€»è¾‘å°è£…åœ¨ä¸€ä¸ªé™æ€æ–¹æ³•ä¸­ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸ºUserServiceFactoryçš„ç±»ï¼Œå®ƒè´Ÿè´£åˆ›å»ºUserServiceå®ä¾‹ã€‚æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·åœ¨é™æ€å·¥å‚æ–¹æ³•ä¸­æ³¨å…¥UserValidatorï¼š\npublic class UserServiceFactory { public static UserService createUserService(UserValidator userValidator) { return new UserService(userValidator); } } æ„å»ºå™¨ æ„å»ºå™¨æ˜¯ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ï¼Œå®ƒå°†åˆ›å»ºå¯¹è±¡çš„é€»è¾‘å°è£…åœ¨ä¸€ä¸ªæ„å»ºå™¨ç±»ä¸­ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸ºUserServiceBuilderçš„ç±»ï¼Œå®ƒè´Ÿè´£åˆ›å»ºUserServiceå®ä¾‹ã€‚æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·åœ¨æ„å»ºå™¨ç±»ä¸­æ³¨å…¥UserValidatorï¼š\npublic class UserServiceBuilder { private UserValidator userValidator; public UserServiceBuilder withUserValidator(UserValidator userValidator) { this.userValidator = userValidator; return this; } public UserService build() { return new UserService(userValidator); } } è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ„å»ºå™¨æ¥åˆ›å»ºUserServiceå®ä¾‹ï¼Œå¹¶åœ¨æ„å»ºå™¨ä¸­æ³¨å…¥UserValidatorã€‚ä¾‹å¦‚ï¼š\nUserValidator userValidator = new CustomUserValidator(); UserService userService = new UserServiceBuilder().withUserValidator(userValidator).build(); è¿™ç§æ¨¡å¼çš„ä¸€ä¸ªæœ‰ç”¨å˜ä½“æ˜¯å°†èµ„æºå·¥å‚ä¼ é€’ç»™æ„é€ å‡½æ•°ã€‚èµ„æºå·¥å‚æ˜¯ä¸€ç§åˆ›å»ºå’Œæä¾›å¯¹è±¡çš„æ–¹å¼ï¼Œå®ƒå¯ä»¥åœ¨éœ€è¦æ—¶åŠ¨æ€åœ°åˆ›å»ºå’Œè¿”å›èµ„æºã€‚åœ¨å°†èµ„æºå·¥å‚ä¼ é€’ç»™æ„é€ å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¯¹è±¡çš„åˆ›å»ºå’Œé…ç½®é€»è¾‘ä»ç±»ä¸­ç§»é™¤ï¼Œä»è€Œå®ç°æ›´å¥½çš„å¯æµ‹è¯•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚\nä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨èµ„æºå·¥å‚ä¼ é€’ç»™æ„é€ å‡½æ•°çš„ç¤ºä¾‹ï¼š\npublic class UserService { private UserValidator userValidator; private DataSource dataSource; public UserService(ResourceFactory resourceFactory) { this.userValidator = resourceFactory.createUserValidator(); this.dataSource = resourceFactory.createDataSource(); } public boolean authenticate(String username, String password) { // perform authentication using userValidator and dataSource ... } } åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒUserServiceç±»éœ€è¦ä¸€ä¸ªèƒ½å¤ŸéªŒè¯ç”¨æˆ·çš„UserValidatorå®ä¾‹å’Œä¸€ä¸ªDataSourceå®ä¾‹ã€‚è¿™ä¸¤ä¸ªä¾èµ–é¡¹éƒ½æ˜¯é€šè¿‡èµ„æºå·¥å‚æ¥åˆ›å»ºçš„ã€‚é€šè¿‡å°†èµ„æºå·¥å‚ä¼ é€’ç»™æ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¯¹è±¡çš„åˆ›å»ºå’Œé…ç½®é€»è¾‘ä»ç±»ä¸­ç§»é™¤ï¼Œå¹¶ä½¿å…¶æ›´åŠ çµæ´»å’Œå¯ç»´æŠ¤ã€‚\nä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸ºMySqlResourceFactoryçš„ç±»ï¼Œå®ƒå®ç°äº†ResourceFactoryæ¥å£ï¼Œå¹¶ç”¨äºåˆ›å»ºUserValidatorå’ŒDataSourceå®ä¾‹ã€‚æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·ä½¿ç”¨å®ƒæ¥åˆ›å»ºUserServiceå®ä¾‹ï¼š\nResourceFactory resourceFactory = new MySqlResourceFactory(); UserService userService = new UserService(resourceFactory); ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å°†UserServiceç±»ä¸å…·ä½“çš„èµ„æºå®ç°è§£è€¦ï¼Œå¹¶ä½¿å…¶æ›´åŠ çµæ´»å’Œå¯ç»´æŠ¤ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°æ¨¡æ‹Ÿå’Œæµ‹è¯•UserServiceç±»ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥åœ¨æµ‹è¯•ä¸­ä¼ é€’ä¸åŒçš„èµ„æºå·¥å‚å®ç°ï¼Œè€Œä¸éœ€è¦ä¾èµ–äºå¤–éƒ¨èµ„æºã€‚\nå‡½æ•°å¼æ¥å£ åœ¨ Java 8 ä¸­ï¼ŒSupplier\u0026lt;T\u0026gt;æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œç”¨äºè¡¨ç¤ºä¸€ä¸ªæ— å‚æ•°å‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›ç±»å‹ä¸ºTã€‚ç”±äºå…¶å‡½æ•°å¼ç‰¹æ€§ï¼ŒSupplier\u0026lt;T\u0026gt;éå¸¸é€‚åˆè¡¨ç¤ºå·¥å‚ï¼Œå› ä¸ºå®ƒå¯ä»¥æä¾›ä¸€ç§é€šç”¨çš„æ–¹å¼æ¥åˆ›å»ºå¯¹è±¡ã€‚\nä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨Supplier\u0026lt;T\u0026gt;è¡¨ç¤ºå·¥å‚çš„ç¤ºä¾‹ï¼š\npublic class UserService { private UserValidator userValidator; public UserService(Supplier\u0026lt;UserValidator\u0026gt; userValidatorFactory) { this.userValidator = userValidatorFactory.get(); } public boolean authenticate(String username, String password) { // perform authentication using userValidator ... } } åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒUserServiceç±»çš„æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªSupplier\u0026lt;UserValidator\u0026gt;ä½œä¸ºå‚æ•°ã€‚è¿™ä¸ªSupplierå¯ä»¥åœ¨éœ€è¦æ—¶åŠ¨æ€åœ°åˆ›å»ºUserValidatorå®ä¾‹ã€‚åœ¨UserServiceç±»ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨userValidatorFactory.get()æ¥è·å–UserValidatorå®ä¾‹ã€‚\nä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸ºCustomUserValidatorçš„ç±»ï¼Œå®ƒå®ç°äº†UserValidatoræ¥å£ï¼Œå¹¶ç”¨äºéªŒè¯ç”¨æˆ·ã€‚æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·ä½¿ç”¨UserServiceç±»å’ŒSupplier\u0026lt;T\u0026gt;æ¥åˆ›å»ºUserServiceå®ä¾‹ï¼š\nSupplier\u0026lt;UserValidator\u0026gt; userValidatorFactory = CustomUserValidator::new; UserService userService = new UserService(userValidatorFactory); åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒuserValidatorFactoryæ˜¯ä¸€ä¸ªSupplier\u0026lt;UserValidator\u0026gt;å®ä¾‹ï¼Œå®ƒä½¿ç”¨CustomUserValidator::newæ„é€ å‡½æ•°å¼•ç”¨æ¥åˆ›å»ºUserValidatorå®ä¾‹ã€‚é€šè¿‡å°†è¿™ä¸ªSupplierä¼ é€’ç»™UserServiceç±»çš„æ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºUserServiceå®ä¾‹ï¼Œè€Œæ— éœ€æ˜¾å¼åœ°åˆ›å»ºUserValidatorå®ä¾‹ã€‚\nä½¿ç”¨Supplier\u0026lt;T\u0026gt;è¡¨ç¤ºå·¥å‚å¯ä»¥ä½¿æˆ‘ä»¬çš„ä»£ç æ›´åŠ ç®€æ´å’Œçµæ´»ã€‚å®ƒå¯ä»¥ä½¿å¯¹è±¡çš„åˆ›å»ºæ›´åŠ é€šç”¨ï¼Œå¹¶å…è®¸æˆ‘ä»¬åœ¨éœ€è¦æ—¶åŠ¨æ€åœ°åˆ›å»ºå¯¹è±¡ã€‚åŒæ—¶ï¼Œç”±äºSupplier\u0026lt;T\u0026gt;æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ lambda è¡¨è¾¾å¼å’Œæ–¹æ³•å¼•ç”¨æ¥åˆ›å»ºå·¥å‚ï¼Œä½¿ä»£ç æ›´åŠ ç®€æ´å’Œæ˜“äºç†è§£ã€‚\nä¼˜ç‚¹ ä»¥ä¸‹æ˜¯ä½¿ç”¨ä¾èµ–æ³¨å…¥æ¯”ç¡¬ç¼–ç èµ„æºçš„ä¼˜ç‚¹ï¼š\nå¯æµ‹è¯•æ€§ï¼šä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼Œå¾ˆå®¹æ˜“åˆ›å»ºå’Œæ³¨å…¥æ¨¡æ‹Ÿå¯¹è±¡è¿›è¡Œæµ‹è¯•ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ­£åœ¨æµ‹è¯•çš„ç»„ä»¶éš”ç¦»å¼€æ¥ï¼Œå¹¶ä¸“æ³¨äºæµ‹è¯•å…¶è¡Œä¸ºï¼Œè€Œä¸å¿…æ‹…å¿ƒå…¶ä¾èµ–é¡¹çš„è¡Œä¸ºã€‚ çµæ´»æ€§ï¼šä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°ç”¨ä¸åŒå®ç°æ›¿æ¢ä¾èµ–é¡¹ã€‚è¿™åœ¨éœ€è¦æ›´æ”¹ç»„ä»¶çš„è¡Œä¸ºè€Œä¸æ›´æ”¹å…¶ä»£ç æ—¶éå¸¸æœ‰ç”¨ã€‚ è§£è€¦ï¼šä¾èµ–æ³¨å…¥æœ‰åŠ©äºå°†ç»„ä»¶ä¸å…¶ä¾èµ–é¡¹è§£è€¦ï¼Œä½¿ä»£ç æ›´åŠ æ¨¡å—åŒ–å¹¶æ˜“äºç»´æŠ¤ã€‚ å…³æ³¨ç‚¹åˆ†ç¦»ï¼šä¾èµ–æ³¨å…¥å°†ä¾èµ–é¡¹çš„åˆ›å»ºå’Œç®¡ç†ä¸ç»„ä»¶æœ¬èº«åˆ†ç¦»ï¼Œå…è®¸æ›´æ¸…æ™°åœ°åˆ†ç¦»å…³æ³¨ç‚¹ã€‚ è¿ç”¨ ä¾èµ–æ³¨å…¥æ˜¯ä¸€ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œè¢«å¹¿æ³›åº”ç”¨äºè®¸å¤šå¼€æºæ¡†æ¶ä¸­ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„å¼€æºæ¡†æ¶å’Œåº“ï¼Œå®ƒä»¬ä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç†å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼š\nSpring Frameworkï¼šSpring æ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„ Java æ¡†æ¶ï¼Œå®ƒä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç†åº”ç”¨ç¨‹åºä¸­çš„å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚Spring é€šè¿‡@Autowiredæ³¨è§£å’Œ XML é…ç½®æ–‡ä»¶æ¥å®ç°ä¾èµ–æ³¨å…¥ã€‚ Google Guiceï¼šGuice æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œå®ƒä½¿ç”¨ Java æ³¨è§£æ¥å®ç°ä¾èµ–æ³¨å…¥ã€‚Guice æä¾›äº†ä¸€ä¸ªBinderæ¥å£ï¼Œä½¿ç”¨æˆ·å¯ä»¥é…ç½®æ³¨å…¥è§„åˆ™ã€‚ Daggerï¼šDagger æ˜¯ä¸€ä¸ªåŸºäº Java å’Œ Android å¹³å°çš„ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œå®ƒä½¿ç”¨ Java æ³¨è§£å’Œä»£ç ç”ŸæˆæŠ€æœ¯æ¥å®ç°ä¾èµ–æ³¨å…¥ã€‚Dagger æä¾›äº†ä¸€ä¸ªComponentæ¥å£ï¼Œç”¨äºè¡¨ç¤ºåº”ç”¨ç¨‹åºå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚ CDIï¼šCDI æ˜¯ Java EE 6 ä¸­å¼•å…¥çš„ä¸€ç§ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œå®ƒä½¿ç”¨ Java æ³¨è§£å’Œ XML é…ç½®æ–‡ä»¶æ¥å®ç°ä¾èµ–æ³¨å…¥ã€‚CDI æä¾›äº†ä¸€ä¸ªBeanManageræ¥å£ï¼Œä½¿ç”¨æˆ·å¯ä»¥é…ç½®å’Œç®¡ç†åº”ç”¨ç¨‹åºå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚ Micronautï¼šMicronaut æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œå®ƒä½¿ç”¨ Java æ³¨è§£å’Œå­—èŠ‚ç ç”ŸæˆæŠ€æœ¯æ¥å®ç°ä¾èµ–æ³¨å…¥ã€‚Micronaut æä¾›äº†ä¸€ä¸ª@Injectæ³¨è§£ï¼Œç”¨äºæ ‡è®°éœ€è¦æ³¨å…¥çš„ä¾èµ–é¡¹ã€‚ Weldï¼šWeld æ˜¯ä¸€ä¸ª Java SE å’Œ Java EE çš„ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œå®ƒä½¿ç”¨ Java æ³¨è§£å’Œ XML é…ç½®æ–‡ä»¶æ¥å®ç°ä¾èµ–æ³¨å…¥ã€‚Weld æä¾›äº†ä¸€ä¸ªBeanManageræ¥å£ï¼Œç”¨äºé…ç½®å’Œç®¡ç†åº”ç”¨ç¨‹åºå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚ PicoContainerï¼šPicoContainer æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œå®ƒä½¿ç”¨ Java æ³¨è§£å’Œä»£ç ç”ŸæˆæŠ€æœ¯æ¥å®ç°ä¾èµ–æ³¨å…¥ã€‚PicoContainer æä¾›äº†ä¸€ä¸ªContaineræ¥å£ï¼Œç”¨äºè¡¨ç¤ºåº”ç”¨ç¨‹åºå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚ HK2ï¼šHK2 æ˜¯ Java EE 8 å’Œ Jakarta EE 9 çš„ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œå®ƒä½¿ç”¨ Java æ³¨è§£å’Œ XML é…ç½®æ–‡ä»¶æ¥å®ç°ä¾èµ–æ³¨å…¥ã€‚HK2 æä¾›äº†ä¸€ä¸ªServiceLocatoræ¥å£ï¼Œç”¨äºé…ç½®å’Œç®¡ç†åº”ç”¨ç¨‹åºå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚ Micrometerï¼šMicrometer æ˜¯ä¸€ä¸ªç”¨äºåº¦é‡åº”ç”¨ç¨‹åºæ€§èƒ½çš„åº“ï¼Œå®ƒä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç†åº¦é‡è®°å½•å™¨ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚Micrometer æ”¯æŒå¤šç§ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼ŒåŒ…æ‹¬ Spring å’Œ Guiceã€‚ Google Dagger Hiltï¼šDagger Hilt æ˜¯ä¸€ä¸ªåŸºäº Dagger 2 çš„ä¾èµ–æ³¨å…¥åº“ï¼Œå®ƒä½¿ç”¨æ³¨è§£æ¥ç®¡ç†å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å®ƒæä¾›äº†ä¸€äº›é™„åŠ åŠŸèƒ½ï¼Œä¾‹å¦‚ä½¿ç”¨@ViewModelInjectæ³¨è§£æ¥æ³¨å…¥ ViewModel ä¾èµ–é¡¹ã€‚ Quarkusï¼šQuarkus æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºå¯æ‰©å±•çš„ Java åº”ç”¨ç¨‹åºçš„æ¡†æ¶ï¼Œå®ƒä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç†åº”ç”¨ç¨‹åºå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å®ƒæ”¯æŒå¤šç§ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼ŒåŒ…æ‹¬ CDIã€Spring å’Œ Guiceã€‚ Micronaut Dataï¼šMicronaut Data æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†æ•°æ®åº“è®¿é—®çš„åº“ï¼Œå®ƒä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç†æ•°æ®è®¿é—®å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å®ƒæ”¯æŒå¤šç§ ORM æ¡†æ¶ï¼ŒåŒ…æ‹¬ Hibernate å’Œ JDBCã€‚ Akkaï¼šAkka æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºäº‹ä»¶é©±åŠ¨åº”ç”¨ç¨‹åºçš„åº“ï¼Œå®ƒä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç† Actor ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å®ƒæä¾›äº†ä¸€ä¸ª@Injectæ³¨è§£ï¼Œç”¨äºæ ‡è®°éœ€è¦æ³¨å…¥çš„ä¾èµ–é¡¹ã€‚ JHipsterï¼šJHipster æ˜¯ä¸€ä¸ªç”¨äºç”Ÿæˆç°ä»£ Web åº”ç”¨ç¨‹åºçš„æ¡†æ¶ï¼Œå®ƒä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç†åº”ç”¨ç¨‹åºå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å®ƒæ”¯æŒå¤šç§ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼ŒåŒ…æ‹¬ Spring å’Œ Guiceã€‚ Vert.xï¼šVert.x æ˜¯ä¸€ä¸ªåŸºäºäº‹ä»¶é©±åŠ¨çš„åº”ç”¨ç¨‹åºæ¡†æ¶ï¼Œå®ƒä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç†åº”ç”¨ç¨‹åºå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å®ƒæ”¯æŒå¤šç§ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼ŒåŒ…æ‹¬ CDI å’Œ Guiceã€‚ Quarkus Reactiveï¼šQuarkus Reactive æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºååº”å¼åº”ç”¨ç¨‹åºçš„æ¡†æ¶ï¼Œå®ƒä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç†åº”ç”¨ç¨‹åºå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å®ƒæ”¯æŒå¤šç§ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼ŒåŒ…æ‹¬ CDI å’Œ Springã€‚ Micronaut Securityï¼šMicronaut Security æ˜¯ä¸€ä¸ªç”¨äºç®¡ç† Web åº”ç”¨ç¨‹åºå®‰å…¨çš„åº“ï¼Œå®ƒä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç†å®‰å…¨æœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å®ƒæ”¯æŒå¤šç§å®‰å…¨æ¡†æ¶ï¼ŒåŒ…æ‹¬ Spring Security å’Œ Apache Shiroã€‚ Eclipse MicroProfileï¼šEclipse MicroProfile æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºå¾®æœåŠ¡çš„æ¡†æ¶ï¼Œå®ƒä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç†å¾®æœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å®ƒæ”¯æŒå¤šç§ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼ŒåŒ…æ‹¬ CDI å’Œ Guiceã€‚ Kotlin Koinï¼šKoin æ˜¯ä¸€ä¸ªç”¨äº Kotlin åº”ç”¨ç¨‹åºçš„ä¾èµ–æ³¨å…¥åº“ï¼Œå®ƒä½¿ç”¨ DSL è¯­æ³•æ¥ç®¡ç†åº”ç”¨ç¨‹åºå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å®ƒæ”¯æŒå•ä¾‹ã€å·¥å‚å’Œæ‡’åŠ è½½ç­‰ä¸åŒçš„æ³¨å…¥æ¨¡å¼ã€‚ Spring Cloudï¼šSpring Cloud æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„æ¡†æ¶ï¼Œå®ƒä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç†åˆ†å¸ƒå¼ç³»ç»Ÿä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å®ƒæ”¯æŒå¤šç§ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼ŒåŒ…æ‹¬ Spring å’Œ Guiceã€‚ Micronaut HTTP Clientï¼šMicronaut HTTP Client æ˜¯ä¸€ä¸ªç”¨äºç®¡ç† HTTP å®¢æˆ·ç«¯çš„åº“ï¼Œå®ƒä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç† HTTP å®¢æˆ·ç«¯ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å®ƒæ”¯æŒå¤šç§ HTTP å®¢æˆ·ç«¯å®ç°ï¼ŒåŒ…æ‹¬ Apache HttpClient å’Œ Nettyã€‚ Quarkus Securityï¼šQuarkus Security æ˜¯ä¸€ä¸ªç”¨äºç®¡ç† Web åº”ç”¨ç¨‹åºå®‰å…¨çš„åº“ï¼Œå®ƒä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç†å®‰å…¨æœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å®ƒæ”¯æŒå¤šç§å®‰å…¨æ¡†æ¶ï¼ŒåŒ…æ‹¬ Spring Security å’Œ Apache Shiroã€‚ è¿™äº›æ¡†æ¶å’Œåº“éƒ½ä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç†å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œä½¿ä»£ç æ›´åŠ çµæ´»ã€å¯ç»´æŠ¤å’Œå¯æµ‹è¯•ã€‚å®ƒä»¬æä¾›äº†ä¸€äº›ä¸åŒçš„æ³¨å…¥æŠ€æœ¯å’Œ APIï¼Œä»¥é€‚åº”ä¸åŒçš„åº”ç”¨åœºæ™¯å’Œéœ€æ±‚ã€‚\nSpring ä¾èµ–æ³¨å…¥ åœ¨ Spring æ¡†æ¶ä¸­ï¼Œä¾èµ–æ³¨å…¥æ˜¯æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€ã€‚Spring ä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç†åº”ç”¨ç¨‹åºå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œä»¥å®ç°æ¾è€¦åˆã€å¯æµ‹è¯•å’Œå¯æ‰©å±•çš„ä»£ç ã€‚ä»¥ä¸‹æ˜¯ Spring ä¸­ä½¿ç”¨ä¾èµ–æ³¨å…¥çš„æ–¹æ³•ï¼š\næ³¨è§£ï¼šSpring ä½¿ç”¨æ³¨è§£å°†ä¾èµ–é¡¹æ³¨å…¥åˆ°å¯¹è±¡ä¸­ã€‚å¸¸ç”¨çš„æ³¨è§£åŒ…æ‹¬@Autowiredã€@Qualifierå’Œ@Valueã€‚å…¶ä¸­ï¼Œ@Autowiredæ³¨è§£ç”¨äºè‡ªåŠ¨è£…é…ä¾èµ–é¡¹ï¼Œ@Qualifieræ³¨è§£ç”¨äºæŒ‡å®šä¾èµ–é¡¹çš„åç§°æˆ–é™å®šç¬¦ï¼Œ@Valueæ³¨è§£ç”¨äºä»å±æ€§æ–‡ä»¶æˆ–ç¯å¢ƒå˜é‡ä¸­æ³¨å…¥å€¼ã€‚ XML é…ç½®æ–‡ä»¶ï¼šSpring ä¹Ÿæ”¯æŒä½¿ç”¨ XML é…ç½®æ–‡ä»¶æ¥å®šä¹‰å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚åœ¨ XML é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨\u0026lt;bean\u0026gt;å…ƒç´ å®šä¹‰å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨\u0026lt;property\u0026gt;å…ƒç´ è®¾ç½®å¯¹è±¡çš„å±æ€§å’Œä¾èµ–é¡¹ã€‚ Java é…ç½®ç±»ï¼šSpring è¿˜æ”¯æŒä½¿ç”¨ Java é…ç½®ç±»æ¥å®šä¹‰å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚åœ¨ Java é…ç½®ç±»ä¸­ï¼Œå¯ä»¥ä½¿ç”¨@Configurationæ³¨è§£å®šä¹‰é…ç½®ç±»ï¼Œå¹¶ä½¿ç”¨@Beanæ³¨è§£å®šä¹‰å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨@Autowiredæ³¨è§£æ³¨å…¥ä¾èµ–é¡¹ã€‚ ä»¥ä¸‹æ˜¯ä¸€äº›åœ¨ Spring ä¸­ä½¿ç”¨ä¾èµ–æ³¨å…¥çš„ä¾‹å­ï¼š\n1ã€è‡ªåŠ¨è£…é…ç¤ºä¾‹ï¼š\n@Component public class MyService { private final MyRepository myRepository; @Autowired public MyService(MyRepository myRepository) { this.myRepository = myRepository; } // ... } åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒMyServiceç±»é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥äº†MyRepositoryä¾èµ–ã€‚åœ¨MyServiceå¯¹è±¡åˆ›å»ºæ—¶ï¼ŒSpring æ¡†æ¶è‡ªåŠ¨è£…é…å¹¶æ³¨å…¥äº†MyRepositoryå¯¹è±¡ã€‚\n2ã€XML é…ç½®ç¤ºä¾‹ï¼š\n\u0026lt;bean id=\u0026#34;myService\u0026#34; class=\u0026#34;com.example.MyService\u0026#34;\u0026gt; \u0026lt;constructor-arg ref=\u0026#34;myRepository\u0026#34;/\u0026gt; \u0026lt;/bean\u0026gt; \u0026lt;bean id=\u0026#34;myRepository\u0026#34; class=\u0026#34;com.example.MyRepository\u0026#34;/\u0026gt; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒMyServiceç±»å’ŒMyRepositoryç±»è¢«å®šä¹‰ä¸º Spring çš„ beanï¼Œå¹¶åœ¨ XML é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šå®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚åœ¨MyServiceå¯¹è±¡åˆ›å»ºæ—¶ï¼ŒSpring æ¡†æ¶è‡ªåŠ¨åˆ›å»ºå¹¶æ³¨å…¥äº†MyRepositoryå¯¹è±¡ã€‚\n3ã€Java é…ç½®ç¤ºä¾‹ï¼š\n@Configuration public class AppConfig { @Bean public MyService myService(MyRepository myRepository) { return new MyService(myRepository); } @Bean public MyRepository myRepository() { return new MyRepository(); } } åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒAppConfigç±»é€šè¿‡@Beanæ³¨è§£å®šä¹‰äº†MyServiceå¯¹è±¡å’ŒMyRepositoryå¯¹è±¡ï¼Œå¹¶é€šè¿‡æ–¹æ³•å‚æ•°çš„æ–¹å¼æ³¨å…¥äº†MyRepositoryä¾èµ–ã€‚åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼ŒSpring æ¡†æ¶ä¼šè‡ªåŠ¨åˆ›å»ºå¹¶æ³¨å…¥è¿™äº›å¯¹è±¡ã€‚\nSpring ä¾èµ–æ³¨å…¥æ„äº‹é¡¹ åœ¨ä½¿ç”¨ Spring ä¸­çš„ä¾èµ–æ³¨å…¥æ—¶ï¼Œæœ‰ä¸€äº›æ³¨æ„äº‹é¡¹éœ€è¦æ³¨æ„ï¼Œä»¥ç¡®ä¿ä»£ç çš„æ­£ç¡®æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚\nä¾èµ–é¡¹æ³¨å…¥çš„é¡ºåºï¼šå¦‚æœä¸€ä¸ªç±»ä¾èµ–äºå¤šä¸ªå…¶ä»–ç±»ï¼Œé‚£ä¹ˆè¿™äº›ä¾èµ–é¡¹çš„æ³¨å…¥é¡ºåºå¯èƒ½ä¼šå½±å“åˆ°ä»£ç çš„æ­£ç¡®æ€§ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨@DependsOnæ³¨è§£æŒ‡å®šä¾èµ–é¡¹ä¹‹é—´çš„é¡ºåºã€‚ å¾ªç¯ä¾èµ–ï¼šå¦‚æœä¸¤ä¸ªæˆ–å¤šä¸ªç±»ä¹‹é—´å‡ºç°å¾ªç¯ä¾èµ–ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´å¯¹è±¡æ— æ³•æ­£ç¡®åˆ›å»ºã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…¥æˆ– setter æ³¨å…¥æ¥è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ã€‚ ä½œç”¨åŸŸï¼šSpring æä¾›äº†å¤šç§ä½œç”¨åŸŸï¼ŒåŒ…æ‹¬å•ä¾‹ã€åŸå‹å’Œè¯·æ±‚ä½œç”¨åŸŸç­‰ã€‚åœ¨ä½¿ç”¨ä¾èµ–æ³¨å…¥æ—¶ï¼Œéœ€è¦äº†è§£æ¯ç§ä½œç”¨åŸŸçš„åŒºåˆ«å’Œé€‚ç”¨åœºæ™¯ï¼Œå¹¶é€‰æ‹©åˆé€‚çš„ä½œç”¨åŸŸã€‚ é…ç½®æ–‡ä»¶ç®¡ç†ï¼šåœ¨ä½¿ç”¨ XML é…ç½®æ–‡ä»¶æˆ– Java é…ç½®ç±»æ—¶ï¼Œéœ€è¦æ³¨æ„é…ç½®æ–‡ä»¶æˆ–ç±»çš„ç®¡ç†å’Œç»´æŠ¤ã€‚å¯ä»¥ä½¿ç”¨ Spring çš„ Profile åŠŸèƒ½æ¥ç®¡ç†ä¸åŒçš„é…ç½®æ–‡ä»¶æˆ–ç±»ï¼Œå¹¶æ ¹æ®ä¸åŒçš„ç¯å¢ƒæˆ–éœ€æ±‚æ¥é€‰æ‹©åˆé€‚çš„é…ç½®ã€‚ ä¾èµ–æ³¨å…¥ç±»å‹é€‰æ‹©ï¼šSpring æ”¯æŒå¤šç§ä¾èµ–æ³¨å…¥ç±»å‹ï¼ŒåŒ…æ‹¬æ„é€ å‡½æ•°æ³¨å…¥ã€setter æ³¨å…¥å’Œå­—æ®µæ³¨å…¥ç­‰ã€‚éœ€è¦æ ¹æ®æƒ…å†µé€‰æ‹©åˆé€‚çš„ä¾èµ–æ³¨å…¥ç±»å‹ï¼Œå¹¶è€ƒè™‘åˆ°ä»£ç çš„å¯æµ‹è¯•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ å¦‚ä½•é¿å…å¾ªç¯ä¾èµ–é—®é¢˜ å¾ªç¯ä¾èµ–æ˜¯æŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªç±»ä¹‹é—´ç›¸äº’ä¾èµ–è€Œå¯¼è‡´æ— æ³•æ­£ç¡®åˆ›å»ºå¯¹è±¡çš„æƒ…å†µã€‚åœ¨ Spring ä¸­ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼æ¥é¿å…å¾ªç¯ä¾èµ–é—®é¢˜ï¼š\nä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…¥ï¼šæ„é€ å‡½æ•°æ³¨å…¥æ˜¯æŒ‡ä¾èµ–é¡¹é€šè¿‡æ„é€ å‡½æ•°çš„æ–¹å¼è¿›è¡Œæ³¨å…¥ã€‚è¿™ç§æ–¹å¼å¯ä»¥é¿å…å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œå› ä¸ºå¯¹è±¡çš„åˆ›å»ºé¡ºåºæ˜¯ç¡®å®šçš„ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½å¿…é¡»å…ˆåˆ›å»ºå…¶ä¾èµ–é¡¹ï¼Œç„¶åæ‰èƒ½åˆ›å»ºè‡ªèº«ã€‚ ä½¿ç”¨ setter æ³¨å…¥ï¼šsetter æ³¨å…¥æ˜¯æŒ‡ä¾èµ–é¡¹é€šè¿‡ setter æ–¹æ³•è¿›è¡Œæ³¨å…¥ã€‚è¿™ç§æ–¹å¼å¯ä»¥é¿å…å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œå› ä¸ºå¯¹è±¡çš„åˆ›å»ºé¡ºåºæ˜¯ä¸ç¡®å®šçš„ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥å…ˆåˆ›å»ºè‡ªèº«ï¼Œç„¶åå†é€šè¿‡ setter æ–¹æ³•æ³¨å…¥å…¶ä¾èµ–é¡¹ã€‚ ä½¿ç”¨@Lazyæ³¨è§£ï¼š@Lazyæ³¨è§£å¯ä»¥å»¶è¿Ÿä¾èµ–é¡¹çš„æ³¨å…¥ï¼Œç›´åˆ°å¯¹è±¡ç¬¬ä¸€æ¬¡ä½¿ç”¨è¯¥ä¾èµ–é¡¹æ—¶æ‰è¿›è¡Œæ³¨å…¥ã€‚è¿™ç§æ–¹å¼å¯ä»¥é¿å…å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œå› ä¸ºå¯¹è±¡çš„åˆ›å»ºé¡ºåºæ˜¯ä¸ç¡®å®šçš„ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥å…ˆåˆ›å»ºè‡ªèº«ï¼Œç„¶åå†ç­‰å¾…å…¶ä¾èµ–é¡¹è¢«æ³¨å…¥ã€‚ ä¼˜åŒ–ä¾èµ–å…³ç³»ï¼šå¦‚æœå‡ºç°å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ä¼˜åŒ–ä¾èµ–å…³ç³»æ¥è§£å†³ã€‚ä¾‹å¦‚ï¼Œå°†ä¾èµ–é¡¹æŠ½è±¡æˆæ¥å£æˆ–æŠ½è±¡ç±»ï¼Œç„¶åé€šè¿‡ä¸åŒçš„å®ç°ç±»æ¥è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ã€‚ Spring å¤šç§ä¾èµ–æ³¨å…¥ç±»çš„ä¼˜ç¼ºç‚¹ Spring æ”¯æŒå¤šç§ä¾èµ–æ³¨å…¥ç±»å‹ï¼ŒåŒ…æ‹¬æ„é€ å‡½æ•°æ³¨å…¥ã€setter æ³¨å…¥å’Œå­—æ®µæ³¨å…¥ç­‰ã€‚å„ç§ä¾èµ–æ³¨å…¥ç±»å‹çš„ä¼˜ç¼ºç‚¹å¦‚ä¸‹ï¼š\n1ã€æ„é€ å‡½æ•°æ³¨å…¥\nä¼˜ç‚¹ï¼š\nå¯¹è±¡åˆ›å»ºæ—¶ä¾èµ–é¡¹å·²ç»ç¡®å®šï¼Œå¯ä»¥ä¿è¯ä¾èµ–é¡¹çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§ã€‚ ä¾èµ–é¡¹æ˜¯åªè¯»çš„ï¼Œå¯ä»¥ä¿è¯å¯¹è±¡çš„ä¸å˜æ€§ã€‚ ç¼ºç‚¹ï¼š\næ„é€ å‡½æ•°æ³¨å…¥æ¯”è¾ƒç¹çï¼Œéœ€è¦åœ¨æ¯ä¸ªç±»ä¸­æ·»åŠ æ„é€ å‡½æ•°å’Œä¾èµ–é¡¹å‚æ•°ã€‚ 2ã€setter æ³¨å…¥\nä¼˜ç‚¹ï¼š\nsetter æ³¨å…¥æ¯”è¾ƒçµæ´»ï¼Œå¯ä»¥éšæ—¶æ³¨å…¥æˆ–æ›´æ”¹ä¾èµ–é¡¹ã€‚ å¯ä»¥ä½¿ç”¨é»˜è®¤æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡ï¼Œç®€åŒ–ä»£ç ã€‚ ç¼ºç‚¹ï¼š\nå¯¹è±¡åˆ›å»ºæ—¶ä¾èµ–é¡¹å¯èƒ½è¿˜æœªæ³¨å…¥ï¼Œéœ€è¦è¿›è¡Œ null æ£€æŸ¥ã€‚ setter æ–¹æ³•æ˜¯å…¬å…±çš„ï¼Œå¯èƒ½ä¼šå½±å“å¯¹è±¡çš„ä¸å˜æ€§ã€‚ 3ã€å­—æ®µæ³¨å…¥\nä¼˜ç‚¹ï¼š\nç®€å•æ–¹ä¾¿ï¼Œä¸éœ€è¦æ‰‹åŠ¨ç¼–å†™æ„é€ å‡½æ•°æˆ– setter æ–¹æ³•ã€‚ å¯ä»¥ä½¿ç”¨é»˜è®¤æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡ï¼Œç®€åŒ–ä»£ç ã€‚ ç¼ºç‚¹ï¼š\nä¾èµ–é¡¹æ˜¯å…¬å…±çš„ï¼Œå¯èƒ½ä¼šå½±å“å¯¹è±¡çš„ä¸å˜æ€§ã€‚ å¯¹è±¡åˆ›å»ºæ—¶ä¾èµ–é¡¹å¯èƒ½è¿˜æœªæ³¨å…¥ï¼Œéœ€è¦è¿›è¡Œ null æ£€æŸ¥ã€‚ æ€»çš„æ¥è¯´ï¼Œ**æ„é€ å‡½æ•°æ³¨å…¥æ˜¯æœ€æ¨èçš„ä¾èµ–æ³¨å…¥æ–¹å¼ï¼Œå› ä¸ºå®ƒå¯ä»¥ä¿è¯å¯¹è±¡çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§ã€‚**setter æ³¨å…¥å’Œå­—æ®µæ³¨å…¥åˆ™æ¯”è¾ƒçµæ´»ï¼Œä½†éœ€è¦æ³¨æ„ä¾èµ–é¡¹çš„æ³¨å…¥æ—¶æœºå’Œå¯èƒ½å¯¹å¯¹è±¡ä¸å˜æ€§çš„å½±å“ã€‚æ ¹æ®å…·ä½“çš„æƒ…å†µå’Œéœ€æ±‚ï¼Œå¯ä»¥é€‰æ‹©åˆé€‚çš„ä¾èµ–æ³¨å…¥æ–¹å¼ã€‚\næ€»ç»“ æ€»ä¹‹ï¼Œä¸è¦ä½¿ç”¨å•ä¾‹æˆ–é™æ€å®ç”¨å·¥å…·ç±»æ¥å®ç°ä¾èµ–äºä¸€ä¸ªæˆ–å¤šä¸ªåº•å±‚èµ„æºçš„ç±»ï¼Œè¿™äº›èµ„æºçš„è¡Œä¸ºä¼šå½±å“ç±»çš„è¡Œä¸ºï¼Œä¹Ÿä¸è¦è®©ç±»ç›´æ¥åˆ›å»ºè¿™äº›èµ„æºã€‚ç›¸åï¼Œå°†åˆ›å»ºå®ƒä»¬çš„èµ„æºæˆ–å·¥å‚ä¼ é€’ç»™æ„é€ å‡½æ•°ï¼ˆæˆ–é™æ€å·¥å‚æˆ–æ„å»ºå™¨ï¼‰ã€‚è¿™ç§æ“ä½œç§°ä¸ºä¾èµ–æ³¨å…¥ï¼Œå®ƒå°†å¤§å¤§å¢å¼ºç±»çš„çµæ´»æ€§ã€å¯å¤ç”¨æ€§å’Œå¯æµ‹è¯•æ€§ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/04/17/prefer-dependency-injection-to-hardwiring-resources/","summary":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼Œåœ¨æ•´ç†ç¬”è®°è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ chatgpt çš„å¸®åŠ©åšäº†ä¸€äº›æ‰©å±•ã€‚\nä»‹ç» ä¾èµ–æ³¨å…¥æ˜¯è½¯ä»¶å·¥ç¨‹ä¸­ä½¿ç”¨çš„ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œç”¨äºå°†ç»„ä»¶å’Œä¾èµ–é¡¹ç›¸äº’è§£è€¦ã€‚è€Œä¸æ˜¯åœ¨ç»„ä»¶å†…éƒ¨åˆ›å»ºå’Œç®¡ç†ä¾èµ–é¡¹ï¼Œæˆ‘ä»¬ä»å¤–éƒ¨ä¼ é€’å®ƒä»¬ã€‚è¿™ç§æ–¹æ³•å¯ä»¥å¸®åŠ©åˆ›å»ºæ›´æ¨¡å—åŒ–å’Œçµæ´»çš„ä»£ç ã€‚\nç›¸æ¯”ä¹‹ä¸‹ï¼Œç¡¬ç¼–ç èµ„æºæ¶‰åŠåœ¨ç»„ä»¶å†…éƒ¨ç›´æ¥åˆ›å»ºå’Œç®¡ç†ä¾èµ–é¡¹ã€‚è¿™ç§æ–¹æ³•å¯èƒ½ä¼šä½¿ä»£ç ä¸å¤ªçµæ´»ï¼Œéš¾ä»¥ç»´æŠ¤ã€‚\nä¸¾ä¾‹ è®¸å¤šç±»ä¾èµ–äºä¸€ä¸ªæˆ–å¤šä¸ªåº•å±‚èµ„æºã€‚ä¾‹å¦‚ï¼Œæ‹¼å†™æ£€æŸ¥ç¨‹åºä¾èµ–äºå­—å…¸ã€‚å¸¸è§åšæ³•æ˜¯ï¼Œå°†è¿™ç§ç±»å®ç°ä¸ºé™æ€å®ç”¨å·¥å…·ç±»ï¼š\n// Inappropriate use of static utility - inflexible \u0026amp; untestable! public class SpellChecker { private static final Lexicon dictionary = ...; private SpellChecker() {} // Noninstantiable public static boolean isValid(String word) { ... } public static List\u0026lt;String\u0026gt; suggestions(String typo) { ... } } ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬ä¹Ÿç»å¸¸çœ‹åˆ°å®ƒä»¬çš„å•ä¾‹å®ç°ï¼š\n// Inappropriate use of singleton - inflexible \u0026amp; untestable! public class SpellChecker { public static INSTANCE = new SpellChecker(...); private final Lexicon dictionary = ...; private SpellChecker(...) {} public boolean isValid(String word) { ... } public List\u0026lt;String\u0026gt; suggestions(String typo) { ... } } è¿™ä¸¤ç§æ–¹æ³•éƒ½ä¸ä»¤äººæ»¡æ„ï¼Œå› ä¸ºå®ƒä»¬å‡è®¾åªä½¿ç”¨ä¸€ä¸ªå­—å…¸ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ¯ç§è¯­è¨€éƒ½æœ‰è‡ªå·±çš„å­—å…¸ï¼Œç‰¹æ®Šçš„å­—å…¸ç”¨äºç‰¹æ®Šçš„è¯æ±‡è¡¨ã€‚å¦å¤–ï¼Œæœ€å¥½ä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„å­—å…¸è¿›è¡Œæµ‹è¯•ã€‚\nä½ å¯ä»¥å°è¯•è®© SpellChecker æ”¯æŒå¤šä¸ªå­—å…¸ï¼šé¦–å…ˆå–æ¶ˆ dictionary å­—æ®µçš„ final ä¿®é¥°ï¼Œå¹¶åœ¨ç°æœ‰çš„æ‹¼å†™æ£€æŸ¥å™¨ä¸­æ·»åŠ æ›´æ”¹ dictionary çš„æ–¹æ³•ã€‚ä½†æ˜¯åœ¨å¹¶å‘ç¯å¢ƒä¸­è¿™ç§åšæ³•æ˜¯ç¬¨æ‹™çš„ã€å®¹æ˜“å‡ºé”™çš„å’Œä¸å¯è¡Œçš„ã€‚é™æ€å®ç”¨å·¥å…·ç±»å’Œå•ä¾‹ä¸é€‚ç”¨äºç”±åº•å±‚èµ„æºå‚æ•°åŒ–çš„ç±»ã€‚","title":"ã€ŠEffective Java 3ã€‹ç¬”è®°5ï¼šä¾èµ–æ³¨å…¥ä¼˜äºç¡¬ç¼–ç èµ„æº"},{"content":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-04-03 åˆ° 2023-04-09 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¿™å‘¨è¿˜æ˜¯å’Œä»¥å‰ä¸€æ ·æ¯å¤©è¿åŠ¨ï¼Œå¹¶å¼€å§‹æ–½è¡Œæ–­é£Ÿã€‚å› ä¸ºæ˜¯åˆšå¼€å§‹æ–­é£Ÿï¼Œæœ‰æ—¶å€™å¿ä¸ä½é¥¥é¥¿æ„Ÿè€Œåƒäº†ä¸€äº›ä¸œè¥¿ã€‚\næœ¬å‘¨å·¥ä½œä¸»è¦æ˜¯å‘å¸ƒäº†ä¸€ä¸ªç‰ˆæœ¬ï¼Œå…¶ä½™æ—¶é—´ç”¨æ¥å­¦ä¹  Rust å’Œ Pythonï¼Œåˆå­¦è¿™ä¸¤ç§è¯­è¨€ï¼Œä»–ä»¬è¯­æ³•ä¸Šæœ‰å¾ˆå¤šç›¸ä¼¼ä¹‹å¤„ã€‚å¦‚ä½•å­¦ä¹ ä¸€é—¨ç¼–ç¨‹è¯­è¨€ï¼Ÿæ•´ç†äº†ä¸€äº›æ­¥éª¤ã€‚å°è¯•äº†ä¸€ä¸‹ç”¨å¤šç§è¯­è¨€ç¼–å†™çŒœæ•°æ¸¸æˆï¼Œè¿™äº›è¯­è¨€åŒ…æ‹¬ Rustã€Ptyhonã€Goã€NodeJsã€JavaScriptã€Kotlinã€Bashï¼Œé™¤äº† Javaã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„äº‹æƒ…ï¼Œå¦‚æœèƒ½å¤ŸæŠŠè¿™äº›è¯­è¨€éƒ½ç†Ÿç»ƒæŒæ¡ï¼Œé‚£å°±æ›´å¥½äº†ã€‚\nå…³äºå¥èº« å®Œæˆäº†æ¯å¤©ä¸€ä¸‡æ­¥çš„è®¡åˆ’ï¼Œå¹¶ä¸”å…±è·‘æ­¥ 5 æ¬¡ï¼Œä¸€å…± 18.6 å…¬é‡Œï¼Œå¹³å‡é…é€Ÿ 7 åˆ†é’Ÿ 4 9 ç§’ï¼Œæ¯å¤©è·³ç»³ 500+ã€‚\nå…³äºè®°è´¦ æœ¬å‘¨ç»§ç»­ä½¿ç”¨å¾®ä¿¡è®°è´¦æœ¬è®°å½•æ¯å¤©æ”¯å‡ºã€‚ç´¯è®¡æ¶ˆè´¹ 835 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š\n4 æœˆ 3 æ—¥ï¼Œå‘¨ä¸€ï¼šæ”¯å‡º 59 å…ƒï¼Œé¤é¥®\n4 æœˆ 4 æ—¥ï¼Œå‘¨äºŒï¼šæ”¯å‡º 0 å…ƒï¼Œ\n4 æœˆ 5 æ—¥ï¼Œå‘¨ä¸‰ï¼šæ”¯å‡º 228 å…ƒï¼Œè¶…å¸‚è´­ç‰©\n4 æœˆ 6 æ—¥ï¼Œå‘¨å››ï¼šæ”¯å‡º 15 å…ƒï¼Œåœè½¦è´¹\n4 æœˆ 7 æ—¥ï¼Œå‘¨äº”ï¼šæ”¯å‡º 12 å…ƒ\n4 æœˆ 8 æ—¥ï¼Œå‘¨å…­ï¼šæ”¯å‡º 415 å…ƒï¼ŒåŠ æ²¹+é¤é¥®\n4 æœˆ 8 æ—¥ï¼Œå‘¨æ—¥ï¼šæ”¯å‡º 106 å…ƒï¼Œé¤é¥®\nå¦‚ä½•å­¦ä¹ ä¸€é—¨ç¼–ç¨‹è¯­è¨€ å­¦ä¹ ä¸€é—¨ç¼–ç¨‹è¯­è¨€çš„åŸºç¡€è¯­æ³•å¯¹äºåˆå­¦è€…æ¥è¯´éå¸¸é‡è¦ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›è¯¦ç»†çš„æ­¥éª¤ï¼š\näº†è§£ç¼–ç¨‹è¯­è¨€çš„åŸºç¡€æ¦‚å¿µï¼šåœ¨å­¦ä¹ ç¼–ç¨‹è¯­è¨€ä¹‹å‰ï¼Œäº†è§£ç¼–ç¨‹çš„åŸºç¡€æ¦‚å¿µæ˜¯éå¸¸é‡è¦çš„ã€‚ä¾‹å¦‚ï¼Œå˜é‡ã€æ•°æ®ç±»å‹ã€æ¡ä»¶è¯­å¥ã€å¾ªç¯ã€å‡½æ•°ç­‰ç­‰ã€‚ å¯»æ‰¾å­¦ä¹ èµ„æºï¼šå­¦ä¹ ç¼–ç¨‹è¯­è¨€çš„åŸºç¡€è¯­æ³•å¯ä»¥é€šè¿‡å„ç§å­¦ä¹ èµ„æºæ¥å®ç°ï¼Œå¦‚ä¹¦ç±ã€æ•™ç¨‹ã€åœ¨çº¿è§†é¢‘å’Œäº¤äº’å¼å­¦ä¹ å¹³å°ç­‰ã€‚é€‰æ‹©é€‚åˆè‡ªå·±çš„å­¦ä¹ èµ„æºæ˜¯éå¸¸é‡è¦çš„ã€‚ å­¦ä¹ å˜é‡å’Œæ•°æ®ç±»å‹ï¼šåœ¨å­¦ä¹ ç¼–ç¨‹è¯­è¨€ä¹‹å‰ï¼Œå­¦ä¹ å˜é‡å’Œæ•°æ®ç±»å‹æ˜¯å¿…é¡»çš„ã€‚äº†è§£å¦‚ä½•å®šä¹‰å˜é‡ã€èµ‹å€¼å’Œä½¿ç”¨ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚å­—ç¬¦ä¸²ã€æ•´æ•°ã€æµ®ç‚¹æ•°ã€å¸ƒå°”å€¼ç­‰ç­‰ã€‚ å­¦ä¹ æ¡ä»¶è¯­å¥ï¼šæ¡ä»¶è¯­å¥æ˜¯ç¼–ç¨‹è¯­è¨€ä¸­çš„é‡è¦æ¦‚å¿µä¹‹ä¸€ã€‚ä¾‹å¦‚ï¼Œå­¦ä¹ å¦‚ä½•ä½¿ç”¨ if è¯­å¥å’Œ else è¯­å¥ï¼Œä½¿ç¨‹åºåœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰§è¡Œä¸åŒçš„ä»£ç å—ã€‚ å­¦ä¹ å¾ªç¯ï¼šå¾ªç¯æ˜¯ç¼–ç¨‹è¯­è¨€ä¸­çš„å¦ä¸€ä¸ªé‡è¦æ¦‚å¿µã€‚ä¾‹å¦‚ï¼Œå­¦ä¹ å¦‚ä½•ä½¿ç”¨ while å¾ªç¯å’Œ for å¾ªç¯ï¼Œä½¿ç¨‹åºåœ¨ç‰¹å®šæ¡ä»¶ä¸‹é‡å¤æ‰§è¡Œä»£ç å—ã€‚ å­¦ä¹ å‡½æ•°ï¼šå‡½æ•°æ˜¯ç¼–ç¨‹è¯­è¨€ä¸­çš„é‡è¦æ¦‚å¿µä¹‹ä¸€ã€‚å­¦ä¹ å¦‚ä½•å®šä¹‰å’Œä½¿ç”¨å‡½æ•°ï¼Œä»¥å°†ä»£ç ç»“æ„åŒ–å¹¶é‡ç”¨ã€‚ ç»ƒä¹ ç¼–å†™ä»£ç ï¼šç»ƒä¹ ç¼–å†™ä»£ç æ˜¯å­¦ä¹ ç¼–ç¨‹è¯­è¨€åŸºç¡€è¯­æ³•çš„é‡è¦æ–¹å¼ã€‚ç¼–å†™å°ç¨‹åºæˆ–é¡¹ç›®ï¼Œä¾‹å¦‚æ‰“å°\u0026quot;Hello World\u0026quot;ã€è®¡ç®—å™¨æˆ–çŒœæ•°å­—æ¸¸æˆç­‰ã€‚ å­¦ä¹ è°ƒè¯•å’Œé”™è¯¯å¤„ç†ï¼šå­¦ä¹ å¦‚ä½•è°ƒè¯•ä»£ç å’Œå¤„ç†å¸¸è§é”™è¯¯ï¼Œä¾‹å¦‚è¯­æ³•é”™è¯¯ã€é€»è¾‘é”™è¯¯å’Œè¿è¡Œæ—¶é”™è¯¯ç­‰ã€‚ æ€»ç»“ä¸€ä¸‹ï¼Œå­¦ä¹ ä¸€é—¨ç¼–ç¨‹è¯­è¨€çš„æ­¥éª¤ï¼š\nå®‰è£…\nHello World\næ³¨é‡Š æ ¼å¼åŒ–è¾“å‡º å˜é‡å’Œå¸¸é‡\næ•°æ®ç±»å‹\nåŸºæœ¬ç±»å‹ è¿ç®— ç±»å‹è½¬æ¢ å¤æ‚ç±»å‹ è¡¨è¾¾å¼å’Œè¯­å¥\næ¡ä»¶ å¾ªç¯ æ–­è¨€ å‡½æ•°\nç±»å’Œå¯¹è±¡\nåŒ…å’Œæ¨¡å—\nå¼‚å¸¸å¤„ç†\næ ‡å‡†åº“\nIO ç½‘ç»œ å¤šçº¿ç¨‹ å•å…ƒæµ‹è¯•\næ¥ä¸‹æ¥ï¼Œæ‰“ç®—æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤æ¥å­¦ä¹  Rustã€Pythonã€Goï¼Œä¹Ÿè®¸è¿˜ä¼šæœ‰ NodeJs å’Œ Kotlinï¼Œå¹¶æ•´ç†ç›¸å…³ç¬”è®°ã€‚\nå·¥ä½œ Effective Java 3 ç¬”è®° è¯·å‚è€ƒ ã€ŠEffective Java 3ã€‹ç¬”è®°ï¼šä½¿ç”¨ç§æœ‰æ„é€ å‡½æ•°æˆ–æšä¸¾ç±»å‹åˆ›å»ºå•ä¾‹\nRust å› ä¸ºå¯¹ Tauri è¿™ä¸ª GUI æ¡†æ¶æŒºæ„Ÿå…´è¶£ï¼Œæ‰€ä»¥æˆ‘å¼€å§‹å­¦ä¹  Rust äº†ï¼Œç›®å‰åœ¨å‚è€ƒ https://rustwiki.org/ ä¸Šçš„ é€šè¿‡ä¾‹å­å­¦ Rust å’Œ ã€ŠRust æƒå¨æŒ‡å—ã€‹ å­¦ä¹  Rustã€‚\nå¥½ç‰©åˆ†äº« è™½ç„¶å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€ChenSoul Shareã€Telegram é¢‘é“ï¼Œä¸è¿‡è¿˜æ˜¯æŒ‘é€‰ä¸€éƒ¨åˆ†åœ¨è¿™é‡Œåˆ—ä¸¾ä¸€ä¸‹ï¼Œæ„Ÿè§‰æ›´åƒä¸€ä¸ª newsletter äº†ã€‚\nä¸€äº›æ–‡ç«  Where to find the EPUB file in iBooks for Mac under OS X 10.9 Mavericks ä½¿ç”¨ CDN åŠ é€Ÿ Umami é™æ€èµ„æº å®ç”¨ Web API è§„èŒƒ ä¸€æ¬¡æœ¬åœ°å…è´¹è¿‡æ»¤ RSS çš„å°è¯•ï¼šNetNewsWire ä¸æƒ³å½“ä½œå®¶çš„ç¨‹åºå‘˜å†™ä¸å‡º Redis Kotlin è¯­æ³•ä¸€ç«™å¼æ‰‹å†Œ ä¸€äº›å·¥å…· Listmonk ä¸€æ¬¾è‡ªä¸»æ‰˜ç®¡çš„ç”µå­é‚®ä»¶åˆ—è¡¨ç®¡ç†å·¥å…·ã€‚å®ƒå…è®¸æ‚¨å°†é‚®ä»¶åˆ—è¡¨å¯¼å…¥åˆ°è‡ªå·±çš„æœåŠ¡å™¨ä¸­ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥ç®¡ç†æ‚¨çš„é‚®ä»¶åˆ—è¡¨å’Œå‘é€ç”µå­é‚®ä»¶ã€‚Listmonk å…·æœ‰è‰¯å¥½çš„å¯æ‰©å±•æ€§å’Œè‡ªå®šä¹‰æ€§ï¼Œå¯é€šè¿‡ REST API è¿›è¡Œæ“ä½œï¼Œå¹¶æ”¯æŒé«˜çº§åŠŸèƒ½ï¼Œä¾‹å¦‚è‡ªå®šä¹‰å­—æ®µã€æ¨¡æ¿å’Œè‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹ï¼Œä»è€Œä½¿å…¶æˆä¸ºä¸€ä¸ªéå¸¸æœ‰ç”¨å’Œçµæ´»çš„ç”µå­é‚®ä»¶åˆ—è¡¨ç®¡ç†å·¥å…·ã€‚ä¸å…¶ä»–åœ¨çº¿é‚®ä»¶åˆ—è¡¨æœåŠ¡ç›¸æ¯”ï¼ŒListmonk çš„ä¼˜åŠ¿ä¹‹ä¸€æ˜¯æ‚¨å®Œå…¨æŒæ§è‡ªå·±çš„æ•°æ®å’ŒæœåŠ¡å™¨ï¼Œå› æ­¤æ‚¨ä¸å¿…æ‹…å¿ƒç¬¬ä¸‰æ–¹å…¬å¸çš„æ•°æ®éšç§é—®é¢˜ã€‚ SiteSucker SiteSucker æ˜¯ä¸€æ¬¾ MacOS å¹³å°ä¸Šçš„å…è´¹å·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ©ç”¨æˆ·å°†æ•´ä¸ªç½‘ç«™ä¸‹è½½åˆ°æœ¬åœ°ç”µè„‘ä¸­ã€‚ä½¿ç”¨ SiteSuckerï¼Œç”¨æˆ·åªéœ€è¦è¾“å…¥ç›®æ ‡ç½‘ç«™çš„ URLï¼Œå®ƒå°±ä¼šè‡ªåŠ¨ä¸‹è½½è¯¥ç½‘ç«™çš„æ‰€æœ‰é¡µé¢ã€å›¾åƒã€è§†é¢‘å’Œå…¶ä»–èµ„æºï¼Œå¹¶å°†å®ƒä»¬ä¿å­˜åœ¨æœ¬åœ°ç¡¬ç›˜ä¸Šï¼Œä»¥ä¾¿ç”¨æˆ·ç¦»çº¿æµè§ˆæˆ–å¤‡ä»½ã€‚SiteSucker æ”¯æŒå¤šçº¿ç¨‹ä¸‹è½½å’Œæ–­ç‚¹ç»­ä¼ ï¼Œå¯ä»¥åœ¨ä¸ä¸­æ–­ä¸‹è½½çš„æƒ…å†µä¸‹æš‚åœå’Œæ¢å¤ä¸‹è½½ä»»åŠ¡ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜å¯ä»¥è¿‡æ»¤ URLï¼Œä»¥ä¾¿ç”¨æˆ·åªä¸‹è½½ç‰¹å®šç±»å‹çš„æ–‡ä»¶ï¼Œä¾‹å¦‚ HTMLã€å›¾åƒæˆ–è§†é¢‘æ–‡ä»¶ã€‚æ€»ä¹‹ï¼ŒSiteSucker æ˜¯ä¸€æ¬¾éå¸¸å®ç”¨çš„å·¥å…·ï¼Œé€‚ç”¨äºéœ€è¦ç¦»çº¿æµè§ˆç½‘ç«™ã€å¤‡ä»½ç½‘ç«™æˆ–è¿›è¡Œç½‘ç«™æŠ“å–çš„ç”¨æˆ·ã€‚ Montaigne ç”¨è‹¹æœç¬”è®°æ¥åˆ›å»ºç½‘ç«™ã€åšå®¢æˆ–ä½œå“é›† WechatExporter èŠå¤©è®°å½•å¯¼å‡º RapidAPI ä¸€æ¬¾ MacOS å¹³å°ä¸Šçš„ API å¼€å‘å·¥å…·ï¼Œå®ƒæ—¨åœ¨å¸®åŠ©å¼€å‘äººå‘˜æ›´è½»æ¾åœ°è®¾è®¡ã€æµ‹è¯•å’Œè°ƒè¯• APIã€‚Paw æä¾›äº†ä¸€ä¸ªç›´è§‚çš„ç”¨æˆ·ç•Œé¢ï¼Œå¯ä»¥è®©ç”¨æˆ·è½»æ¾åœ°æ„å»ºå’Œè°ƒè¯• API è¯·æ±‚ï¼Œå¹¶æŸ¥çœ‹æœåŠ¡å™¨å“åº”ã€‚Paw æ”¯æŒå¤šç§ API åè®®å’Œæ ¼å¼ï¼Œä¾‹å¦‚ RESTã€SOAPã€GraphQLã€JSON å’Œ XML ç­‰ï¼Œå¯ä»¥ä¸å¤šç§æœåŠ¡å™¨ç«¯ç‚¹å’Œèº«ä»½éªŒè¯æ–¹å¼è¿›è¡Œé›†æˆã€‚æ­¤å¤–ï¼ŒPaw è¿˜å…·æœ‰å¼ºå¤§çš„è‡ªåŠ¨åŒ–å’Œè„šæœ¬åŒ–åŠŸèƒ½ï¼Œå…è®¸ç”¨æˆ·ä½¿ç”¨ JavaScript æˆ– Python ç¼–å†™è‡ªå®šä¹‰è„šæœ¬ï¼Œä»¥è‡ªåŠ¨åŒ– API æµ‹è¯•å’Œé›†æˆå·¥ä½œæµç¨‹ã€‚ å¸è½½ MacOS å¾®ä¿¡é”®ç›˜ ä»¥ä¸Šã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/04/13/weekly_review_14/","summary":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-04-03 åˆ° 2023-04-09 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¿™å‘¨è¿˜æ˜¯å’Œä»¥å‰ä¸€æ ·æ¯å¤©è¿åŠ¨ï¼Œå¹¶å¼€å§‹æ–½è¡Œæ–­é£Ÿã€‚å› ä¸ºæ˜¯åˆšå¼€å§‹æ–­é£Ÿï¼Œæœ‰æ—¶å€™å¿ä¸ä½é¥¥é¥¿æ„Ÿè€Œåƒäº†ä¸€äº›ä¸œè¥¿ã€‚\næœ¬å‘¨å·¥ä½œä¸»è¦æ˜¯å‘å¸ƒäº†ä¸€ä¸ªç‰ˆæœ¬ï¼Œå…¶ä½™æ—¶é—´ç”¨æ¥å­¦ä¹  Rust å’Œ Pythonï¼Œåˆå­¦è¿™ä¸¤ç§è¯­è¨€ï¼Œä»–ä»¬è¯­æ³•ä¸Šæœ‰å¾ˆå¤šç›¸ä¼¼ä¹‹å¤„ã€‚å¦‚ä½•å­¦ä¹ ä¸€é—¨ç¼–ç¨‹è¯­è¨€ï¼Ÿæ•´ç†äº†ä¸€äº›æ­¥éª¤ã€‚å°è¯•äº†ä¸€ä¸‹ç”¨å¤šç§è¯­è¨€ç¼–å†™çŒœæ•°æ¸¸æˆï¼Œè¿™äº›è¯­è¨€åŒ…æ‹¬ Rustã€Ptyhonã€Goã€NodeJsã€JavaScriptã€Kotlinã€Bashï¼Œé™¤äº† Javaã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„äº‹æƒ…ï¼Œå¦‚æœèƒ½å¤ŸæŠŠè¿™äº›è¯­è¨€éƒ½ç†Ÿç»ƒæŒæ¡ï¼Œé‚£å°±æ›´å¥½äº†ã€‚\nå…³äºå¥èº« å®Œæˆäº†æ¯å¤©ä¸€ä¸‡æ­¥çš„è®¡åˆ’ï¼Œå¹¶ä¸”å…±è·‘æ­¥ 5 æ¬¡ï¼Œä¸€å…± 18.6 å…¬é‡Œï¼Œå¹³å‡é…é€Ÿ 7 åˆ†é’Ÿ 4 9 ç§’ï¼Œæ¯å¤©è·³ç»³ 500+ã€‚\nå…³äºè®°è´¦ æœ¬å‘¨ç»§ç»­ä½¿ç”¨å¾®ä¿¡è®°è´¦æœ¬è®°å½•æ¯å¤©æ”¯å‡ºã€‚ç´¯è®¡æ¶ˆè´¹ 835 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š\n4 æœˆ 3 æ—¥ï¼Œå‘¨ä¸€ï¼šæ”¯å‡º 59 å…ƒï¼Œé¤é¥®\n4 æœˆ 4 æ—¥ï¼Œå‘¨äºŒï¼šæ”¯å‡º 0 å…ƒï¼Œ\n4 æœˆ 5 æ—¥ï¼Œå‘¨ä¸‰ï¼šæ”¯å‡º 228 å…ƒï¼Œè¶…å¸‚è´­ç‰©\n4 æœˆ 6 æ—¥ï¼Œå‘¨å››ï¼šæ”¯å‡º 15 å…ƒï¼Œåœè½¦è´¹\n4 æœˆ 7 æ—¥ï¼Œå‘¨äº”ï¼šæ”¯å‡º 12 å…ƒ\n4 æœˆ 8 æ—¥ï¼Œå‘¨å…­ï¼šæ”¯å‡º 415 å…ƒï¼ŒåŠ æ²¹+é¤é¥®\n4 æœˆ 8 æ—¥ï¼Œå‘¨æ—¥ï¼šæ”¯å‡º 106 å…ƒï¼Œé¤é¥®\nå¦‚ä½•å­¦ä¹ ä¸€é—¨ç¼–ç¨‹è¯­è¨€ å­¦ä¹ ä¸€é—¨ç¼–ç¨‹è¯­è¨€çš„åŸºç¡€è¯­æ³•å¯¹äºåˆå­¦è€…æ¥è¯´éå¸¸é‡è¦ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›è¯¦ç»†çš„æ­¥éª¤ï¼š\näº†è§£ç¼–ç¨‹è¯­è¨€çš„åŸºç¡€æ¦‚å¿µï¼šåœ¨å­¦ä¹ ç¼–ç¨‹è¯­è¨€ä¹‹å‰ï¼Œäº†è§£ç¼–ç¨‹çš„åŸºç¡€æ¦‚å¿µæ˜¯éå¸¸é‡è¦çš„ã€‚ä¾‹å¦‚ï¼Œå˜é‡ã€æ•°æ®ç±»å‹ã€æ¡ä»¶è¯­å¥ã€å¾ªç¯ã€å‡½æ•°ç­‰ç­‰ã€‚ å¯»æ‰¾å­¦ä¹ èµ„æºï¼šå­¦ä¹ ç¼–ç¨‹è¯­è¨€çš„åŸºç¡€è¯­æ³•å¯ä»¥é€šè¿‡å„ç§å­¦ä¹ èµ„æºæ¥å®ç°ï¼Œå¦‚ä¹¦ç±ã€æ•™ç¨‹ã€åœ¨çº¿è§†é¢‘å’Œäº¤äº’å¼å­¦ä¹ å¹³å°ç­‰ã€‚é€‰æ‹©é€‚åˆè‡ªå·±çš„å­¦ä¹ èµ„æºæ˜¯éå¸¸é‡è¦çš„ã€‚ å­¦ä¹ å˜é‡å’Œæ•°æ®ç±»å‹ï¼šåœ¨å­¦ä¹ ç¼–ç¨‹è¯­è¨€ä¹‹å‰ï¼Œå­¦ä¹ å˜é‡å’Œæ•°æ®ç±»å‹æ˜¯å¿…é¡»çš„ã€‚äº†è§£å¦‚ä½•å®šä¹‰å˜é‡ã€èµ‹å€¼å’Œä½¿ç”¨ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚å­—ç¬¦ä¸²ã€æ•´æ•°ã€æµ®ç‚¹æ•°ã€å¸ƒå°”å€¼ç­‰ç­‰ã€‚ å­¦ä¹ æ¡ä»¶è¯­å¥ï¼šæ¡ä»¶è¯­å¥æ˜¯ç¼–ç¨‹è¯­è¨€ä¸­çš„é‡è¦æ¦‚å¿µä¹‹ä¸€ã€‚ä¾‹å¦‚ï¼Œå­¦ä¹ å¦‚ä½•ä½¿ç”¨ if è¯­å¥å’Œ else è¯­å¥ï¼Œä½¿ç¨‹åºåœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰§è¡Œä¸åŒçš„ä»£ç å—ã€‚ å­¦ä¹ å¾ªç¯ï¼šå¾ªç¯æ˜¯ç¼–ç¨‹è¯­è¨€ä¸­çš„å¦ä¸€ä¸ªé‡è¦æ¦‚å¿µã€‚ä¾‹å¦‚ï¼Œå­¦ä¹ å¦‚ä½•ä½¿ç”¨ while å¾ªç¯å’Œ for å¾ªç¯ï¼Œä½¿ç¨‹åºåœ¨ç‰¹å®šæ¡ä»¶ä¸‹é‡å¤æ‰§è¡Œä»£ç å—ã€‚ å­¦ä¹ å‡½æ•°ï¼šå‡½æ•°æ˜¯ç¼–ç¨‹è¯­è¨€ä¸­çš„é‡è¦æ¦‚å¿µä¹‹ä¸€ã€‚å­¦ä¹ å¦‚ä½•å®šä¹‰å’Œä½¿ç”¨å‡½æ•°ï¼Œä»¥å°†ä»£ç ç»“æ„åŒ–å¹¶é‡ç”¨ã€‚ ç»ƒä¹ ç¼–å†™ä»£ç ï¼šç»ƒä¹ ç¼–å†™ä»£ç æ˜¯å­¦ä¹ ç¼–ç¨‹è¯­è¨€åŸºç¡€è¯­æ³•çš„é‡è¦æ–¹å¼ã€‚ç¼–å†™å°ç¨‹åºæˆ–é¡¹ç›®ï¼Œä¾‹å¦‚æ‰“å°\u0026quot;Hello World\u0026quot;ã€è®¡ç®—å™¨æˆ–çŒœæ•°å­—æ¸¸æˆç­‰ã€‚ å­¦ä¹ è°ƒè¯•å’Œé”™è¯¯å¤„ç†ï¼šå­¦ä¹ å¦‚ä½•è°ƒè¯•ä»£ç å’Œå¤„ç†å¸¸è§é”™è¯¯ï¼Œä¾‹å¦‚è¯­æ³•é”™è¯¯ã€é€»è¾‘é”™è¯¯å’Œè¿è¡Œæ—¶é”™è¯¯ç­‰ã€‚ æ€»ç»“ä¸€ä¸‹ï¼Œå­¦ä¹ ä¸€é—¨ç¼–ç¨‹è¯­è¨€çš„æ­¥éª¤ï¼š\nå®‰è£…\nHello World\næ³¨é‡Š æ ¼å¼åŒ–è¾“å‡º å˜é‡å’Œå¸¸é‡\næ•°æ®ç±»å‹\nåŸºæœ¬ç±»å‹ è¿ç®— ç±»å‹è½¬æ¢ å¤æ‚ç±»å‹ è¡¨è¾¾å¼å’Œè¯­å¥","title":"å‘¨æŠ¥-14ï½œå¦‚ä½•å­¦ä¹ ä¸€é—¨ç¼–ç¨‹è¯­è¨€"},{"content":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼Œåœ¨æ•´ç†ç¬”è®°è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ chatgpt çš„å¸®åŠ©åšäº†ä¸€äº›æ‰©å±•ã€‚\nä»‹ç» å•ä¾‹æ˜¯ä¸€ä¸ªåªå®ä¾‹åŒ–ä¸€æ¬¡çš„ç±»ã€‚å•ä¾‹é€šå¸¸è¡¨ç¤ºæ— çŠ¶æ€å¯¹è±¡ï¼Œæ¯”å¦‚å‡½æ•°æˆ–ç³»ç»Ÿç»„ä»¶ï¼Œå®ƒä»¬åœ¨æœ¬è´¨ä¸Šæ˜¯å”¯ä¸€çš„ã€‚å°†ä¸€ä¸ªç±»è®¾è®¡ä¸ºå•ä¾‹ä¼šä½¿å®ƒçš„å®¢æˆ·ç«¯æµ‹è¯•æ—¶å˜å¾—å›°éš¾ï¼Œ é™¤éå®ƒå®ç°äº†ä½œä¸ºå…¶ç±»å‹çš„æ¥å£ï¼Œå¦åˆ™æ— æ³•ç”¨æ¨¡æ‹Ÿå®ç°æ¥ä»£æ›¿å•ä¾‹ã€‚\nå®ç° å®ç°å•ä¾‹æœ‰ä¸¤ç§å¸¸è§çš„æ–¹æ³•ã€‚ä¸¤è€…éƒ½åŸºäºä¿æŒæ„é€ å‡½æ•°ç§æœ‰å’Œå¯¼å‡ºå…¬å…±é™æ€æˆå‘˜ä»¥æä¾›å¯¹å”¯ä¸€å®ä¾‹çš„è®¿é—®ã€‚\nåœ¨ç¬¬ä¸€ç§æ–¹æ³•ä¸­ï¼Œæˆå‘˜æ˜¯ä¸€ä¸ª final å­—æ®µï¼š\n// Singleton with public final field public class Elvis { public static final Elvis INSTANCE = new Elvis(); private Elvis() { ... } public void leaveTheBuilding() { ... } } ç§æœ‰æ„é€ å‡½æ•°åªè°ƒç”¨ä¸€æ¬¡ï¼Œç”¨äºåˆå§‹åŒ– public static final ä¿®é¥°çš„ Elvis ç±»å‹å­—æ®µ INSTANCEã€‚ä¸ä½¿ç”¨ public æˆ– protected çš„æ„é€ å‡½æ•°ä¿è¯äº†ã€Œç‹¬ä¸€æ— äºŒã€çš„ç©ºé—´ï¼šä¸€æ—¦åˆå§‹åŒ–äº† Elvis ç±»ï¼Œå°±åªä¼šå­˜åœ¨ä¸€ä¸ª Elvis å®ä¾‹ï¼Œä¸å¤šä¹Ÿä¸å°‘ã€‚å®¢æˆ·ç«¯æ‰€åšçš„ä»»ä½•äº‹æƒ…éƒ½ä¸èƒ½æ”¹å˜è¿™ä¸€ç‚¹ï¼Œä½†æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼šæ‹¥æœ‰ç‰¹æ®Šæƒé™çš„å®¢æˆ·ç«¯å¯ä»¥å€ŸåŠ© AccessibleObject.setAccessible æ–¹æ³•åˆ©ç”¨åå°„è°ƒç”¨ç§æœ‰æ„é€ å‡½æ•°ã€‚\nConstructor\u0026lt;?\u0026gt;[] constructors = Elvis.class.getDeclaredConstructors(); AccessibleObject.setAccessible(constructors, true); Arrays.stream(constructors).forEach(name -\u0026gt; { if (name.toString().contains(\u0026#34;Elvis\u0026#34;)) { Elvis instance = (Elvis) name.newInstance(); instance.leaveTheBuilding(); } }); å¦‚æœéœ€è¦é˜²èŒƒè¿™ç§æ”»å‡»ï¼Œè¯·ä¿®æ”¹æ„é€ å‡½æ•°ï¼Œä½¿å…¶åœ¨è¯·æ±‚åˆ›å»ºç¬¬äºŒä¸ªå®ä¾‹æ—¶æŠ›å‡ºå¼‚å¸¸ã€‚\nåœ¨å®ç°å•ä¾‹çš„ç¬¬äºŒç§æ–¹æ³•ä¸­ï¼Œå…¬å…±æˆå‘˜æ˜¯ä¸€ç§é™æ€å·¥å‚æ–¹æ³•ï¼š\n// Singleton with static factory public class Elvis { private static final Elvis INSTANCE = new Elvis(); private Elvis() { ... } public static Elvis getInstance() { return INSTANCE; } public void leaveTheBuilding() { ... } } æ‰€æœ‰å¯¹ getInstance() æ–¹æ³•çš„è°ƒç”¨éƒ½è¿”å›ç›¸åŒçš„å¯¹è±¡å¼•ç”¨ï¼Œå¹¶ä¸”ä¸ä¼šåˆ›å»ºå…¶ä»– Elvis å®ä¾‹ã€‚\nå…¬å…±å­—æ®µæ–¹æ³•çš„ä¸»è¦ä¼˜ç‚¹æ˜¯ API æ˜ç¡®äº†ç±»æ˜¯å•ä¾‹çš„ï¼špublic static ä¿®é¥°çš„å­—æ®µæ˜¯ final çš„ï¼Œå› æ­¤å®ƒæ€»æ˜¯åŒ…å«ç›¸åŒçš„å¯¹è±¡å¼•ç”¨ã€‚ç¬¬äºŒä¸ªä¼˜ç‚¹æ˜¯æ›´ç®€å•ã€‚\né™æ€å·¥å‚æ–¹æ³•çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯ï¼Œå®ƒå¯ä»¥åœ¨ä¸æ›´æ”¹ API çš„æƒ…å†µä¸‹å†³å®šç±»æ˜¯å¦æ˜¯å•ä¾‹ã€‚å·¥å‚æ–¹æ³•è¿”å›å”¯ä¸€çš„å®ä¾‹ï¼Œä½†æ˜¯å¯ä»¥å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œä¸ºè°ƒç”¨å®ƒçš„æ¯ä¸ªçº¿ç¨‹è¿”å›ä¸€ä¸ªå•ç‹¬çš„å®ä¾‹ã€‚ç¬¬äºŒä¸ªä¼˜ç‚¹æ˜¯ï¼Œå¦‚æœåº”ç”¨ç¨‹åºéœ€è¦çš„è¯ï¼Œå¯ä»¥ç¼–å†™æ³›å‹çš„å•ä¾‹å·¥å‚ã€‚ä½¿ç”¨é™æ€å·¥å‚çš„æœ€åä¸€ä¸ªä¼˜ç‚¹æ˜¯æ–¹æ³•å¼•ç”¨èƒ½å¤Ÿä½œä¸ºä¸€ä¸ªæä¾›è€…ï¼Œä¾‹å¦‚ Elvis::getInstance æ˜¯ Supplier\u0026lt;Elvis\u0026gt; çš„æä¾›è€…ã€‚\nSupplier\u0026lt;Elvis\u0026gt; sup = Elvis::getInstance; Elvis obj = sup.get(); obj.leaveTheBuilding(); é™¤éèƒ½å¤Ÿä¸è¿™äº›ä¼˜ç‚¹æ²¾è¾¹ï¼Œå¦åˆ™ä½¿ç”¨ public å­—æ®µçš„æ–¹å¼æ›´å¯å–ã€‚\nè¦ä½¿å•ä¾‹ç±»ä½¿ç”¨è¿™ä¸¤ç§æ–¹æ³•ä¸­çš„ä»»ä½•ä¸€ç§å®ç°å¯åºåˆ—åŒ–ï¼Œä»…ä»…åœ¨å…¶å£°æ˜ä¸­æ·»åŠ å®ç° serializable æ˜¯ä¸å¤Ÿçš„ã€‚è¦ç»´æŠ¤å•ä¾‹ä¿è¯ï¼Œåº”å£°æ˜æ‰€æœ‰å®ä¾‹å­—æ®µä¸º transientï¼Œå¹¶æä¾› readResolve æ–¹æ³•ã€‚å¦åˆ™ï¼Œæ¯æ¬¡ååºåˆ—åŒ–å®ä¾‹æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹ï¼Œåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œè¿™ä¼šå¯¼è‡´å‡ºç°è™šå‡çš„ Elvisã€‚\n// readResolve method to preserve singleton property private Object readResolve() { // Return the one true Elvis and let the garbage collector // take care of the Elvis impersonator. return INSTANCE; } å®ç°å•ä¾‹çš„ç¬¬ä¸‰ç§æ–¹æ³•æ˜¯å£°æ˜ä¸€ä¸ªå•å…ƒç´ æšä¸¾ï¼š\n// Enum singleton - the preferred approach public enum Elvis { INSTANCE; public void leaveTheBuilding() { ... } } è¿™ç§æ–¹æ³•ç±»ä¼¼äº public å­—æ®µæ–¹æ³•ï¼Œä½†æ˜¯å®ƒæ›´ç®€æ´ï¼Œé»˜è®¤æä¾›äº†åºåˆ—åŒ–æœºåˆ¶ï¼Œæä¾›äº†å¯¹å¤šä¸ªå®ä¾‹åŒ–çš„ä¸¥æ ¼ä¿è¯ï¼Œå³ä½¿é¢å¯¹å¤æ‚çš„åºåˆ—åŒ–æˆ–åå°„æ”»å‡»ä¹Ÿæ˜¯å¦‚æ­¤ã€‚è¿™ç§æ–¹æ³•å¯èƒ½æœ‰ç‚¹ä¸è‡ªç„¶ï¼Œä½†æ˜¯å•å…ƒç´ æšä¸¾ç±»å‹é€šå¸¸æ˜¯å®ç°å•ä¾‹çš„æœ€ä½³æ–¹æ³•ã€‚ æ³¨æ„ï¼Œå¦‚æœä½ çš„å•ä¾‹å¿…é¡»æ‰©å±•ä¸€ä¸ªè¶…ç±»è€Œä¸æ˜¯ Enumï¼ˆå°½ç®¡ä½ å¯ä»¥å£°æ˜ä¸€ä¸ª Enum æ¥å®ç°æ¥å£ï¼‰ï¼Œä½ å°±ä¸èƒ½ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚\næ‰©å±• å•ä¾‹æ¨¡å¼æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹æ¥è®¿é—®è¯¥å®ä¾‹ã€‚åœ¨ Java è¯­è¨€ä¸­ï¼Œå•ä¾‹æ¨¡å¼ä¸€èˆ¬æœ‰ä»¥ä¸‹å‡ ç§å®ç°æ–¹å¼ï¼š\né¥¿æ±‰å¼å•ä¾‹æ¨¡å¼ åœ¨ç±»åŠ è½½æ—¶å°±åˆ›å»ºå•ä¾‹å®ä¾‹ï¼Œå› æ­¤ä¹Ÿç§°ä¸ºé™æ€åˆå§‹åŒ–å•ä¾‹ã€‚\npublic class EagerSingleton { private static final EagerSingleton instance = new EagerSingleton(); private EagerSingleton() {} public static EagerSingleton getInstance() { return instance; } } æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼ åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨getInstance()æ–¹æ³•æ—¶æ‰åˆ›å»ºå•ä¾‹å®ä¾‹ï¼Œä¹Ÿç§°ä¸ºå»¶è¿Ÿåˆå§‹åŒ–å•ä¾‹ã€‚\npublic class LazySingleton { private static LazySingleton instance; private LazySingleton() {} public static synchronized LazySingleton getInstance() { if (instance == null) { instance = new LazySingleton(); } return instance; } } åœ¨è¿™ä¸ªç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†synchronizedå…³é”®å­—æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼ä¼šå½±å“æ€§èƒ½ï¼Œå› ä¸ºæ¯æ¬¡è°ƒç”¨getInstance()æ–¹æ³•éƒ½ä¼šè¿›è¡ŒåŒæ­¥ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒé‡æ£€æŸ¥é”å®šæ¥æé«˜æ€§èƒ½ã€‚\nåŒé‡æ£€æŸ¥é”å®šå•ä¾‹æ¨¡å¼ åœ¨æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼çš„åŸºç¡€ä¸Šï¼Œä½¿ç”¨åŒé‡æ£€æŸ¥é”å®šæ¥ä¿è¯çº¿ç¨‹å®‰å…¨å’Œæ€§èƒ½ã€‚\npublic class LazySingleton { private static volatile LazySingleton instance; private LazySingleton() {} public static LazySingleton getInstance() { if (instance == null) { synchronized (LazySingleton.class) { if (instance == null) { instance = new LazySingleton(); } } } return instance; } } åœ¨ä¸Šè¿°å®ç°ä¸­ï¼Œinstance å­—æ®µä½¿ç”¨ volatile å…³é”®å­—ä¿®é¥°ï¼Œå¯ä»¥ç¡®ä¿å¤šä¸ªçº¿ç¨‹éƒ½èƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†è¯¥å˜é‡ã€‚\nåœ¨ getInstance() æ–¹æ³•ä¸­ï¼Œé¦–å…ˆæ£€æŸ¥å®ä¾‹æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åˆ™ç›´æ¥è¿”å›å®ä¾‹å¼•ç”¨ã€‚å¦åˆ™ï¼Œè·å–ç±»å¯¹è±¡çš„é”ï¼Œå†æ¬¡æ£€æŸ¥å®ä¾‹æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœå®ä¾‹ä»ç„¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºå®ä¾‹ã€‚ç”±äº synchronized å…³é”®å­—å¯ä»¥ç¡®ä¿åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è¿›å…¥ä¸´ç•ŒåŒºï¼Œå› æ­¤å¯ä»¥é¿å…å¤šä¸ªçº¿ç¨‹åŒæ—¶åˆ›å»ºå®ä¾‹çš„æƒ…å†µã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä½¿ç”¨åŒé‡é”æ£€æµ‹æ—¶ï¼Œéœ€è¦ä½¿ç”¨ volatile å…³é”®å­—æ¥ä¿è¯å¤šä¸ªçº¿ç¨‹éƒ½èƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†å…±äº«å˜é‡ã€‚åŒæ—¶ï¼Œä¸ºäº†ä¿è¯æ‰€æœ‰çº¿ç¨‹éƒ½çœ‹åˆ°åŒä¸€ä¸ªå®ä¾‹ï¼Œéœ€è¦ä½¿ç”¨é™æ€å­—æ®µæ¥å­˜å‚¨å•ä¾‹å®ä¾‹ã€‚\nå…³äº volatile å…³é”®å­—ä¿®é¥°\nåœ¨ Java ä¸­ï¼Œå½“ä¸€ä¸ªå˜é‡è¢«å¤šä¸ªçº¿ç¨‹å…±äº«æ—¶ï¼Œå¦‚æœæ²¡æœ‰é‡‡å–ç‰¹æ®Šçš„æªæ–½ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å˜é‡å€¼ï¼Œä½†å…¶ä»–çº¿ç¨‹å¹¶æ²¡æœ‰çœ‹åˆ°è¯¥å˜é‡çš„å˜åŒ–çš„æƒ…å†µã€‚è¿™æ˜¯å› ä¸ºæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ CPU ç¼“å­˜ï¼Œè¯¥å˜é‡çš„å€¼å¯èƒ½å­˜åœ¨äºæŸä¸ªçº¿ç¨‹çš„ CPU ç¼“å­˜ä¸­ï¼Œä½†å…¶ä»–çº¿ç¨‹å¹¶æ²¡æœ‰åŠæ—¶æ›´æ–°ç¼“å­˜ä¸­çš„å€¼ã€‚\nvolatile æ˜¯ä¸€ç§ Java å…³é”®å­—ï¼Œå®ƒå¯ä»¥ç¡®ä¿å¤šä¸ªçº¿ç¨‹éƒ½èƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†è¯¥å˜é‡ã€‚å½“ä¸€ä¸ªå˜é‡è¢«å£°æ˜ä¸º volatile æ—¶ï¼Œå®ƒä¼šå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š\nå¯è§æ€§ï¼šå½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº† volatile å˜é‡çš„å€¼æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥ç«‹å³çœ‹åˆ°è¯¥å˜åŒ–ã€‚ ç¦æ­¢æŒ‡ä»¤é‡æ’ï¼šç¼–è¯‘å™¨å’Œ CPU ä¼šå¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’ä»¥æé«˜æ‰§è¡Œæ•ˆç‡ï¼Œä½†æœ‰æ—¶è¿™ç§é‡æ’å¯èƒ½ä¼šå¯¼è‡´å¤šçº¿ç¨‹ç¨‹åºå‡ºç°é—®é¢˜ã€‚volatile å˜é‡çš„å†™æ“ä½œä¼šåœ¨è¯»æ“ä½œä¹‹å‰ï¼Œç¡®ä¿å˜é‡çš„ä¿®æ”¹å¯¹å…¶ä»–çº¿ç¨‹ç«‹å³å¯è§ï¼Œä»è€Œç¦æ­¢æŒ‡ä»¤é‡æ’ã€‚ åœ¨ä¸Šè¿°å•ä¾‹æ¨¡å¼å®ç°ä¸­ï¼Œinstance å­—æ®µè¢«å£°æ˜ä¸º volatileï¼Œè¿™æ˜¯ä¸ºäº†ç¡®ä¿å¤šä¸ªçº¿ç¨‹éƒ½èƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†è¯¥å˜é‡ã€‚å¦‚æœæ²¡æœ‰ä½¿ç”¨ volatileï¼Œå¯èƒ½ä¼šå‡ºç°æŸä¸ªçº¿ç¨‹åˆ›å»ºäº†å®ä¾‹ï¼Œä½†å…¶ä»–çº¿ç¨‹å¹¶æ²¡æœ‰çœ‹åˆ°è¯¥å˜åŒ–çš„æƒ…å†µã€‚ä½¿ç”¨ volatile å¯ä»¥ç¡®ä¿å¤šä¸ªçº¿ç¨‹éƒ½èƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç† instance å˜é‡ï¼Œä»è€Œé¿å…å‡ºç°å¤šä¸ªå®ä¾‹çš„æƒ…å†µã€‚\næšä¸¾å•ä¾‹æ¨¡å¼ ä½¿ç”¨æšä¸¾ç±»å‹æ¥å®šä¹‰å•ä¾‹ï¼Œå®ƒä¿è¯äº†çº¿ç¨‹å®‰å…¨å’Œåºåˆ—åŒ–å®‰å…¨ã€‚\npublic enum EnumSingleton { INSTANCE; public void doSomething() { // do something } } å…³äºæšä¸¾\nåœ¨ Java ä¸­ï¼Œæšä¸¾æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç±»ï¼Œå®ƒå¯ä»¥ç”¨äºå®šä¹‰ä¸€ç»„å¸¸é‡ã€‚æšä¸¾å¸¸é‡æ˜¯åœ¨æšä¸¾ç±»è¢«åŠ è½½æ—¶åˆ›å»ºçš„ï¼Œä¸”åªä¼šè¢«åˆ›å»ºä¸€æ¬¡ã€‚å› æ­¤ï¼Œæšä¸¾å¤©ç„¶å…·æœ‰å•ä¾‹æ¨¡å¼çš„ç‰¹æ€§ã€‚\nåœ¨ Java ä¸­ï¼Œå•ä¾‹æ¨¡å¼æ˜¯ä¸€ç§å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒå¯ä»¥ç¡®ä¿æŸä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›å…¨å±€è®¿é—®ç‚¹ã€‚å•ä¾‹æ¨¡å¼çš„å®ç°æ–¹å¼æœ‰å¤šç§ï¼ŒåŒ…æ‹¬æ‡’æ±‰å¼ã€é¥¿æ±‰å¼ã€åŒé‡æ£€æŸ¥é”ç­‰ã€‚ä½†æ˜¯ï¼Œè¿™äº›å®ç°æ–¹å¼éƒ½éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨å’Œåºåˆ—åŒ–ç­‰é—®é¢˜ï¼Œè€Œæšä¸¾å¤©ç„¶å…·æœ‰çº¿ç¨‹å®‰å…¨å’Œåºåˆ—åŒ–çš„ç‰¹æ€§ã€‚\næšä¸¾ç±»æ˜¯åœ¨ Java 1.5 ç‰ˆæœ¬ä¸­å¼•å…¥çš„ï¼Œå®ƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç±»ï¼Œå¯ä»¥ç”¨äºå®šä¹‰ä¸€ç»„å¸¸é‡ã€‚æšä¸¾å¸¸é‡æ˜¯åœ¨æšä¸¾ç±»è¢«åŠ è½½æ—¶åˆ›å»ºçš„ï¼Œä¸”åªä¼šè¢«åˆ›å»ºä¸€æ¬¡ã€‚å› æ­¤ï¼Œæšä¸¾å¤©ç„¶å…·æœ‰å•ä¾‹æ¨¡å¼çš„ç‰¹æ€§ï¼Œè€Œä¸”æšä¸¾ç±»çš„å®ç°æ–¹å¼éå¸¸ç®€å•ï¼Œæ— éœ€è€ƒè™‘çº¿ç¨‹å®‰å…¨å’Œåºåˆ—åŒ–ç­‰é—®é¢˜ã€‚å› æ­¤ï¼Œä½¿ç”¨æšä¸¾å®ç°å•ä¾‹æ¨¡å¼æ˜¯ä¸€ç§ç®€å•ã€å®‰å…¨ã€é«˜æ•ˆçš„æ–¹å¼ã€‚\nä¸€ä¸ªå®é™…ä¸­ä½¿ç”¨çš„ä¾‹å­ï¼š\n@AllArgsConstructor @Getter public enum ChannelType implements CodeAware { VMS(2, \u0026#34;è¯­éŸ³ç”µè¯\u0026#34;) { @Override public AbstractNotificationStrategy strategy(Properties properties, NotificationTemplate notificationTemplate, Collection\u0026lt;NotificationUser\u0026gt; users) { return new VmsNotificationStrategy(new VmsNotificationChannel(properties), notificationTemplate, users); } @Override public NotificationTemplate template(String title, String template, Set\u0026lt;String\u0026gt; imageUrls) { return new VmsNotificationTemplate(title, template, imageUrls); } }, FEISHU(3, \u0026#34;é£ä¹¦\u0026#34;) { @Override public AbstractNotificationStrategy strategy(Properties properties, NotificationTemplate notificationTemplate, Collection\u0026lt;NotificationUser\u0026gt; users) { return new FeishuNotificationStrategy(new FeishuNotificationChannel(properties), notificationTemplate, users); } @Override public NotificationTemplate template(String title, String template, Set\u0026lt;String\u0026gt; imageUrls) { return new FeishuNotificationTemplate(title, template, imageUrls); } }; private Integer code; private String name; public abstract AbstractNotificationStrategy strategy(Properties properties, NotificationTemplate notificationTemplate, Collection\u0026lt;NotificationUser\u0026gt; users); public abstract NotificationTemplate template(String title, String template, Set\u0026lt;String\u0026gt; imageUrls); } é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼ é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼æ˜¯ä¸€ç§å¸¸ç”¨çš„å®ç°å•ä¾‹æ¨¡å¼çš„æ–¹å¼ï¼Œå®ƒå¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨ä¸”å®ç°ç®€å•ã€‚åœ¨è¯¥æ¨¡å¼ä¸­ï¼Œå•ä¾‹å®ä¾‹æ˜¯é€šè¿‡é™æ€å†…éƒ¨ç±»æ¥å®ç°çš„ã€‚\nåœ¨ Java ä¸­ï¼Œé™æ€å†…éƒ¨ç±»æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç±»ï¼Œå®ƒæ˜¯åœ¨å¦ä¸€ä¸ªç±»å†…éƒ¨å®šä¹‰çš„é™æ€ç±»ã€‚é™æ€å†…éƒ¨ç±»å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„é™æ€å­—æ®µå’Œæ–¹æ³•ï¼Œä½†ä¸èƒ½è®¿é—®å¤–éƒ¨ç±»çš„éé™æ€å­—æ®µå’Œæ–¹æ³•ã€‚\nä½¿ç”¨é™æ€å†…éƒ¨ç±»å®ç°å•ä¾‹æ¨¡å¼çš„æ–¹å¼å¦‚ä¸‹ï¼š\npublic class StaticInnerClassSingleton { private StaticInnerClassSingleton() {} private static class SingletonHolder { private static final StaticInnerClassSingleton INSTANCE = new StaticInnerClassSingleton(); } public static StaticInnerClassSingleton getInstance() { return SingletonHolder.INSTANCE; } } åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼ŒSingletonHolder æ˜¯é™æ€å†…éƒ¨ç±»ï¼Œå®ƒåŒ…å«ä¸€ä¸ªé™æ€å¸¸é‡ INSTANCEï¼Œè¯¥å¸¸é‡æ˜¯åœ¨é™æ€å†…éƒ¨ç±»è¢«åŠ è½½æ—¶åˆ›å»ºçš„ï¼Œä¸”åªä¼šè¢«åˆ›å»ºä¸€æ¬¡ã€‚ç”±äºé™æ€å†…éƒ¨ç±»çš„åŠ è½½æ˜¯åœ¨éœ€è¦æ—¶æ‰è¿›è¡Œçš„ï¼Œå› æ­¤å¯ä»¥å®ç°æ‡’åŠ è½½çš„æ•ˆæœã€‚åœ¨ getInstance æ–¹æ³•ä¸­ï¼Œç›´æ¥è¿”å› SingletonHolder.INSTANCE å³å¯è·å–å•ä¾‹å®ä¾‹ã€‚\nåœ¨é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼ä¸­ï¼Œç”±äºé™æ€å†…éƒ¨ç±»çš„åŠ è½½æ˜¯åœ¨éœ€è¦æ—¶æ‰è¿›è¡Œçš„ï¼Œä¸”åªä¼šè¢«åŠ è½½ä¸€æ¬¡ï¼Œå› æ­¤å¯ä»¥ä¿è¯å•ä¾‹å®ä¾‹çš„çº¿ç¨‹å®‰å…¨ã€‚åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨ getInstance æ–¹æ³•æ—¶ï¼Œç”±äºé™æ€å†…éƒ¨ç±»çš„åŠ è½½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤å¯ä»¥ä¿è¯åªæœ‰ä¸€ä¸ªå•ä¾‹å®ä¾‹è¢«åˆ›å»ºã€‚\næ­¤å¤–ï¼Œé™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼çš„å®ç°æ–¹å¼ç®€å•ä¸”æ˜“äºç†è§£ï¼Œè€Œä¸”ä¸éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨å’Œåºåˆ—åŒ–ç­‰é—®é¢˜ï¼Œå› æ­¤æ˜¯ä¸€ç§å¸¸ç”¨çš„å®ç°å•ä¾‹æ¨¡å¼çš„æ–¹å¼ã€‚\næ³¨å†Œå¼å•ä¾‹æ¨¡å¼ ä½¿ç”¨å®¹å™¨æ¥å­˜å‚¨å•ä¾‹å®ä¾‹ï¼Œé€šè¿‡å”¯ä¸€çš„æ ‡è¯†ç¬¦æ¥è®¿é—®å•ä¾‹å®ä¾‹ã€‚\næ€»çš„æ¥è¯´ï¼Œæ¯ç§å®ç°æ–¹å¼éƒ½æœ‰å…¶é€‚ç”¨çš„åœºæ™¯å’Œä¼˜ç¼ºç‚¹ï¼Œå¼€å‘è€…éœ€è¦æ ¹æ®å…·ä½“çš„éœ€æ±‚æ¥é€‰æ‹©åˆé€‚çš„å®ç°æ–¹å¼ã€‚\npublic class SingletonRegistry { private static Map\u0026lt;String, Object\u0026gt; registry = new HashMap\u0026lt;\u0026gt;(); private SingletonRegistry() {} public static synchronized void register(String name, Object obj) { registry.put(name, obj); } public static synchronized Object getSingleton(String name) { return registry.get(name); } } åœ¨è¿™ä¸ªç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬åœ¨register()æ–¹æ³•å’ŒgetSingleton()æ–¹æ³•ä¸Šéƒ½åŠ äº†synchronizedå…³é”®å­—ï¼Œç¡®ä¿äº†å¤šçº¿ç¨‹æƒ…å†µä¸‹çš„çº¿ç¨‹å®‰å…¨ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼ä¼šå½±å“æ€§èƒ½ï¼Œå› ä¸ºæ¯æ¬¡è°ƒç”¨getSingleton()æ–¹æ³•éƒ½ä¼šè¿›è¡ŒåŒæ­¥ã€‚\nä»¥ä¸‹æ˜¯ä½¿ç”¨å¹¶å‘å®¹å™¨å®ç°çº¿ç¨‹å®‰å…¨çš„ç¤ºä¾‹ä»£ç ï¼š\npublic class SingletonRegistry { private static ConcurrentMap\u0026lt;String, Object\u0026gt; registry = new ConcurrentHashMap\u0026lt;\u0026gt;(); private SingletonRegistry() {} public static void register(String name, Object obj) { registry.put(name, obj); } public static Object getSingleton(String name) { return registry.get(name); } } ä½¿ç”¨ConcurrentMapçš„computeIfAbsentæ–¹æ³•å¯ä»¥æ›´åŠ ç®€æ´åœ°å®ç°çº¿ç¨‹å®‰å…¨çš„æ³¨å†Œå¼å•ä¾‹æ¨¡å¼ï¼Œå®ƒå¯ä»¥ç¡®ä¿å¤šçº¿ç¨‹æƒ…å†µä¸‹çš„çº¿ç¨‹å®‰å…¨ï¼Œå¹¶ä¸”é¿å…äº†ä½¿ç”¨synchronizedå…³é”®å­—å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ã€‚\nä»¥ä¸‹æ˜¯ä½¿ç”¨ConcurrentMapçš„computeIfAbsentæ–¹æ³•å®ç°çº¿ç¨‹å®‰å…¨çš„ç¤ºä¾‹ä»£ç ï¼š\npublic class SingletonRegistry { private static ConcurrentMap\u0026lt;String, Object\u0026gt; registry = new ConcurrentHashMap\u0026lt;\u0026gt;(); private SingletonRegistry() {} public static void register(String name, Object obj) { registry.putIfAbsent(name, obj); } public static Object getSingleton(String name) { return registry.computeIfAbsent(name, key -\u0026gt; createSingleton(key)); } private static Object createSingleton(String name) { // create singleton object return new Object(); } } åœ¨è¿™ä¸ªç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ConcurrentHashMapæ¥å­˜å‚¨æ³¨å†Œä¿¡æ¯ï¼Œå¹¶ä¸”ä½¿ç”¨äº†putIfAbsentæ–¹æ³•æ¥é¿å…é‡å¤æ·»åŠ å…ƒç´ ã€‚åœ¨getSingletonæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†computeIfAbsentæ–¹æ³•æ¥è·å–å•ä¾‹å®ä¾‹ï¼Œå¦‚æœå®ä¾‹ä¸å­˜åœ¨ï¼Œåˆ™è°ƒç”¨createSingletonæ–¹æ³•åˆ›å»ºå®ä¾‹ã€‚ç”±äºConcurrentHashMapçš„å¹¶å‘æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤ä½¿ç”¨computeIfAbsentæ–¹æ³•å¯ä»¥ç¡®ä¿å¤šçº¿ç¨‹æƒ…å†µä¸‹çš„çº¿ç¨‹å®‰å…¨ã€‚\nè¿ç”¨ ä»¥ä¸‹ï¼Œæ•´ç†äº†å¸¸è§çš„å¼€æºæ¡†æ¶ä¸­å•ä¾‹æ¨¡å¼è¿ç”¨ã€‚\nLog4j Log4j æ˜¯ä¸€ä¸ªç”¨äºè®°å½•æ—¥å¿—çš„å¼€æºæ¡†æ¶ï¼Œå®ƒä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥ç®¡ç† Logger çš„å®ä¾‹ã€‚Logger æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œç”¨äºè®°å½•åº”ç”¨ç¨‹åºçš„æ—¥å¿—ä¿¡æ¯ã€‚\nä»¥ä¸‹æ˜¯ Log4j çš„å•ä¾‹æ¨¡å¼å®ç°ä»£ç ï¼š\npublic class Logger { private static final Map\u0026lt;String, Logger\u0026gt; instances = new ConcurrentHashMap\u0026lt;\u0026gt;(); private Logger() { // private constructor } public static Logger getLogger(String name) { Logger instance = instances.get(name); if (instance == null) { synchronized (instances) { instance = instances.get(name); if (instance == null) { instance = new Logger(); instances.put(name, instance); } } } return instance; } // other methods } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒLogger ä½¿ç”¨ä¸€ä¸ª Map æ¥ç¼“å­˜æ‰€æœ‰çš„ Logger å®ä¾‹ï¼Œå¹¶åœ¨éœ€è¦è·å– Logger å®ä¾‹æ—¶ä½¿ç”¨åŒé‡æ£€æŸ¥é”å®šæœºåˆ¶æ¥ç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åˆ›å»ºå®ä¾‹ã€‚\nJedis Jedis æ˜¯ä¸€ä¸ªç”¨äºè¿æ¥ Redis æ•°æ®åº“çš„å¼€æºæ¡†æ¶ï¼Œå®ƒä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥ç®¡ç† JedisPool çš„å®ä¾‹ã€‚JedisPool æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œç”¨äºç®¡ç†å¯é‡ç”¨çš„ Jedis å®ä¾‹ã€‚\nä»¥ä¸‹æ˜¯ Jedis çš„å•ä¾‹æ¨¡å¼å®ç°ä»£ç ï¼š\npublic class JedisPool { private static final Map\u0026lt;String, JedisPool\u0026gt; INSTANCES = new ConcurrentHashMap\u0026lt;\u0026gt;(); private JedisPool() { // private constructor } public static synchronized JedisPool getInstance(String host, int port) { String key = host + \u0026#34;:\u0026#34; + port; JedisPool instance = INSTANCES.get(key); if (instance == null) { instance = new JedisPool(host, port); INSTANCES.put(key, instance); } return instance; } // other methods } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒJedis ä½¿ç”¨ä¸€ä¸ª ConcurrentHashMap æ¥ç¼“å­˜æ‰€æœ‰çš„ JedisPool å®ä¾‹ï¼Œå¹¶åœ¨éœ€è¦è·å– JedisPool å®ä¾‹æ—¶ä½¿ç”¨ synchronized æ–¹æ³•æ¥ç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åˆ›å»ºå®ä¾‹ã€‚\nRetrofit Retrofit æ˜¯ä¸€ä¸ªç”¨äºç®€åŒ– HTTP è¯·æ±‚çš„å¼€æºæ¡†æ¶ï¼Œå®ƒä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥ç®¡ç† Retrofit çš„å®ä¾‹ã€‚Retrofit æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œç”¨äºåˆ›å»º HTTP è¯·æ±‚ã€‚\nä»¥ä¸‹æ˜¯ Retrofit çš„å•ä¾‹æ¨¡å¼å®ç°ä»£ç ï¼š\npublic class Retrofit { private static final Retrofit INSTANCE = new Retrofit(); private Retrofit() { // private constructor } public static Retrofit getInstance() { return INSTANCE; } public \u0026lt;T\u0026gt; T create(Class\u0026lt;T\u0026gt; service) { // create HTTP request using service interface } // other methods } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒRetrofit ä½¿ç”¨é™æ€å˜é‡å’Œé™æ€æ–¹æ³•æ¥è·å–å•ä¾‹å®ä¾‹ï¼Œå¹¶åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å…±äº«ä½¿ç”¨ã€‚\nGson Gson æ˜¯ä¸€ä¸ªç”¨äºå°† JSON å­—ç¬¦ä¸²è½¬æ¢ä¸º Java å¯¹è±¡çš„å¼€æºæ¡†æ¶ï¼Œå®ƒä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥ç®¡ç† Gson çš„å®ä¾‹ã€‚Gson æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œç”¨äºå¤„ç† JSON æ•°æ®ã€‚\nä»¥ä¸‹æ˜¯ Gson çš„å•ä¾‹æ¨¡å¼å®ç°ä»£ç ï¼š\npublic class Gson { private static final Gson INSTANCE = new Gson(); private Gson() { // private constructor } public static Gson getInstance() { return INSTANCE; } public \u0026lt;T\u0026gt; T fromJson(String json, Class\u0026lt;T\u0026gt; classOfT) { // convert JSON string to Java object } // other methods } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒGson ä½¿ç”¨é™æ€å˜é‡å’Œé™æ€æ–¹æ³•æ¥è·å–å•ä¾‹å®ä¾‹ï¼Œå¹¶åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å…±äº«ä½¿ç”¨ã€‚\nSpring Framework Spring Framework æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºä¼ä¸šçº§ Java åº”ç”¨ç¨‹åºçš„å¼€æºæ¡†æ¶ï¼Œå®ƒä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥ç®¡ç† Bean çš„å®ä¾‹ã€‚Bean æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œç”¨äºå®ç°åº”ç”¨ç¨‹åºçš„ä¸šåŠ¡é€»è¾‘ã€‚\nä»¥ä¸‹æ˜¯ Spring Framework çš„å•ä¾‹æ¨¡å¼å®ç°ä»£ç ï¼š\npublic class DefaultListableBeanFactory implements BeanFactory { private final Map\u0026lt;String, Object\u0026gt; singletonObjects = new ConcurrentHashMap\u0026lt;\u0026gt;(256); public Object getBean(String name) throws BeansException { Object bean = this.singletonObjects.get(name); if (bean == null) { synchronized (this.singletonObjects) { bean = this.singletonObjects.get(name); if (bean == null) { bean = createBean(name); this.singletonObjects.put(name, bean); } } } return bean; } private Object createBean(String name) { // create Bean instance } // other methods } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒSpring Framework ä½¿ç”¨ä¸€ä¸ª ConcurrentHashMap æ¥ç¼“å­˜æ‰€æœ‰çš„ Bean å®ä¾‹ï¼Œå¹¶åœ¨éœ€è¦è·å– Bean å®ä¾‹æ—¶ä½¿ç”¨åŒé‡æ£€æŸ¥é”å®šæœºåˆ¶æ¥ç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åˆ›å»ºå®ä¾‹ã€‚\nHibernate Hibernate æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†å…³ç³»æ•°æ®åº“çš„å¼€æºæ¡†æ¶ï¼Œå®ƒä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥ç®¡ç† SessionFactory çš„å®ä¾‹ã€‚SessionFactory æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œç”¨äºåˆ›å»ºå’Œç®¡ç† Session å¯¹è±¡ã€‚\nä»¥ä¸‹æ˜¯ Hibernate çš„å•ä¾‹æ¨¡å¼å®ç°ä»£ç ï¼š\npublic class SessionFactory { private static final SessionFactory INSTANCE = new SessionFactory(); private SessionFactory() { // private constructor } public static SessionFactory getInstance() { return INSTANCE; } public Session openSession() { // create and return new Session object } // other methods } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒHibernate ä½¿ç”¨é™æ€å˜é‡å’Œé™æ€æ–¹æ³•æ¥è·å–å•ä¾‹å®ä¾‹ï¼Œå¹¶åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å…±äº«ä½¿ç”¨ã€‚\nJUnit JUnit æ˜¯ä¸€ä¸ªç”¨äºç¼–å†™å•å…ƒæµ‹è¯•çš„å¼€æºæ¡†æ¶ï¼Œå®ƒä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥ç®¡ç† TestSuite çš„å®ä¾‹ã€‚TestSuite æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œç”¨äºç®¡ç†æµ‹è¯•ç”¨ä¾‹çš„é›†åˆã€‚\nä»¥ä¸‹æ˜¯ JUnit çš„å•ä¾‹æ¨¡å¼å®ç°ä»£ç ï¼š\npublic class TestSuite { private static final TestSuite INSTANCE = new TestSuite(); private final List\u0026lt;TestCase\u0026gt; testCases = new ArrayList\u0026lt;\u0026gt;(); private TestSuite() { // private constructor } public static TestSuite getInstance() { return INSTANCE; } public void addTestCase(TestCase testCase) { testCases.add(testCase); } public void run(TestResult result) { for (TestCase testCase : testCases) { testCase.run(result); } } // other methods } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒJUnit ä½¿ç”¨é™æ€å˜é‡å’Œé™æ€æ–¹æ³•æ¥è·å– TestSuite çš„å•ä¾‹å®ä¾‹ï¼Œå¹¶åœ¨æ•´ä¸ªæµ‹è¯•åº”ç”¨ç¨‹åºä¸­å…±äº«ä½¿ç”¨ã€‚\nApache Commons Lang Apache Commons Lang æ˜¯ä¸€ä¸ªç”¨äºæä¾›å¸¸ç”¨ Java å·¥å…·ç±»çš„å¼€æºåº“ï¼Œå®ƒä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥ç®¡ç† CharSet çš„å®ä¾‹ã€‚CharSet æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œç”¨äºç®¡ç†å­—ç¬¦é›†ç¼–ç ã€‚\nä»¥ä¸‹æ˜¯ Apache Commons Lang çš„å•ä¾‹æ¨¡å¼å®ç°ä»£ç ï¼š\npublic class CharSet { private static final Map\u0026lt;String, CharSet\u0026gt; INSTANCES = new ConcurrentHashMap\u0026lt;\u0026gt;(); private CharSet() { // private constructor } public static CharSet getInstance(String name) { CharSet instance = INSTANCES.get(name); if (instance == null) { synchronized (CharSet.class) { instance = INSTANCES.get(name); if (instance == null) { instance = new CharSet(); INSTANCES.put(name, instance); } } } return instance; } // other methods } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒApache Commons Lang ä½¿ç”¨ä¸€ä¸ª ConcurrentHashMap æ¥ç¼“å­˜æ‰€æœ‰çš„ CharSet å®ä¾‹ï¼Œå¹¶åœ¨éœ€è¦è·å– CharSet å®ä¾‹æ—¶ä½¿ç”¨åŒé‡æ£€æŸ¥é”å®šæœºåˆ¶æ¥ç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åˆ›å»ºå®ä¾‹ã€‚\nApache Commons Pool Apache Commons Pool æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†å¯¹è±¡æ± çš„å¼€æºåº“ï¼Œå®ƒä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥ç®¡ç† ObjectPool çš„å®ä¾‹ã€‚ObjectPool æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œç”¨äºç®¡ç†å¯é‡ç”¨å¯¹è±¡çš„æ± ã€‚\nä»¥ä¸‹æ˜¯ Apache Commons Pool çš„å•ä¾‹æ¨¡å¼å®ç°ä»£ç ï¼š\npublic class GenericObjectPool\u0026lt;T\u0026gt; implements ObjectPool\u0026lt;T\u0026gt; { private static final Map\u0026lt;String, ObjectPool\u0026lt;?\u0026gt;\u0026gt; INSTANCES = new ConcurrentHashMap\u0026lt;\u0026gt;(); private GenericObjectPool() { // private constructor } public static synchronized \u0026lt;T\u0026gt; ObjectPool\u0026lt;T\u0026gt; getInstance(String name, PooledObjectFactory\u0026lt;T\u0026gt; factory) { ObjectPool\u0026lt;?\u0026gt; instance = INSTANCES.get(name); if (instance == null) { instance = new GenericObjectPool\u0026lt;\u0026gt;(factory); INSTANCES.put(name, instance); } return (ObjectPool\u0026lt;T\u0026gt;) instance; } // other methods } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒApache Commons Pool ä½¿ç”¨ä¸€ä¸ª ConcurrentHashMap æ¥ç¼“å­˜æ‰€æœ‰çš„ ObjectPool å®ä¾‹ï¼Œå¹¶åœ¨éœ€è¦è·å– ObjectPool å®ä¾‹æ—¶ä½¿ç”¨ synchronized æ–¹æ³•æ¥ç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åˆ›å»ºå®ä¾‹ã€‚\nTomcat Tomcat æ˜¯ä¸€ä¸ªç”¨äºè¿è¡Œ Java Web åº”ç”¨ç¨‹åºçš„å¼€æºæœåŠ¡å™¨ï¼Œå®ƒä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥ç®¡ç† ServletContext çš„å®ä¾‹ã€‚ServletContext æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œç”¨äºç®¡ç† Web åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚\nä»¥ä¸‹æ˜¯ Tomcat çš„å•ä¾‹æ¨¡å¼å®ç°ä»£ç ï¼š\npublic class ApplicationContext extends StandardContext { private static final Map\u0026lt;String, ApplicationContext\u0026gt; INSTANCES = new ConcurrentHashMap\u0026lt;\u0026gt;(); private ApplicationContext() { // private constructor } public static ApplicationContext getInstance(String contextPath) { ApplicationContext instance = INSTANCES.get(contextPath); if (instance == null) { synchronized (ApplicationContext.class) { instance = INSTANCES.get(contextPath); if (instance == null) { instance = new ApplicationContext(); instance.setPath(contextPath); INSTANCES.put(contextPath, instance); } } } return instance; } // other methods } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒTomcat ä½¿ç”¨ä¸€ä¸ª ConcurrentHashMap æ¥ç¼“å­˜æ‰€æœ‰çš„ ServletContext å®ä¾‹ï¼Œå¹¶åœ¨éœ€è¦è·å– ServletContext å®ä¾‹æ—¶ä½¿ç”¨åŒé‡æ£€æŸ¥é”å®šæœºåˆ¶æ¥ç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åˆ›å»ºå®ä¾‹ã€‚\nOkHttp OkHttp æ˜¯ä¸€ä¸ªç”¨äºè¿›è¡Œç½‘ç»œè¯·æ±‚çš„å¼€æºæ¡†æ¶ï¼Œå®ƒä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥ç®¡ç† OkHttpClient çš„å®ä¾‹ã€‚OkHttpClient æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œç”¨äºç®¡ç†ç½‘ç»œè¯·æ±‚çš„é…ç½®å’Œæ‰§è¡Œã€‚\nä»¥ä¸‹æ˜¯ OkHttp çš„å•ä¾‹æ¨¡å¼å®ç°ä»£ç ï¼š\npublic class OkHttpClient { private static final Map\u0026lt;String, OkHttpClient\u0026gt; INSTANCES = new ConcurrentHashMap\u0026lt;\u0026gt;(); private OkHttpClient() { // private constructor } public static synchronized OkHttpClient getInstance() { String key = \u0026#34;default\u0026#34;; OkHttpClient instance = INSTANCES.get(key); if (instance == null) { instance = new OkHttpClient.Builder() .build(); INSTANCES.put(key, instance); } return instance; } // other methods } åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒOkHttp ä½¿ç”¨ä¸€ä¸ª ConcurrentHashMap æ¥ç¼“å­˜æ‰€æœ‰çš„ OkHttpClient å®ä¾‹ï¼Œå¹¶åœ¨éœ€è¦è·å– OkHttpClient å®ä¾‹æ—¶ä½¿ç”¨ synchronized æ–¹æ³•æ¥ç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åˆ›å»ºå®ä¾‹ã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/04/11/enforce-the-singleton-property-with-a-private-constructor-or-an-enum-type/","summary":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼Œåœ¨æ•´ç†ç¬”è®°è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ chatgpt çš„å¸®åŠ©åšäº†ä¸€äº›æ‰©å±•ã€‚\nä»‹ç» å•ä¾‹æ˜¯ä¸€ä¸ªåªå®ä¾‹åŒ–ä¸€æ¬¡çš„ç±»ã€‚å•ä¾‹é€šå¸¸è¡¨ç¤ºæ— çŠ¶æ€å¯¹è±¡ï¼Œæ¯”å¦‚å‡½æ•°æˆ–ç³»ç»Ÿç»„ä»¶ï¼Œå®ƒä»¬åœ¨æœ¬è´¨ä¸Šæ˜¯å”¯ä¸€çš„ã€‚å°†ä¸€ä¸ªç±»è®¾è®¡ä¸ºå•ä¾‹ä¼šä½¿å®ƒçš„å®¢æˆ·ç«¯æµ‹è¯•æ—¶å˜å¾—å›°éš¾ï¼Œ é™¤éå®ƒå®ç°äº†ä½œä¸ºå…¶ç±»å‹çš„æ¥å£ï¼Œå¦åˆ™æ— æ³•ç”¨æ¨¡æ‹Ÿå®ç°æ¥ä»£æ›¿å•ä¾‹ã€‚\nå®ç° å®ç°å•ä¾‹æœ‰ä¸¤ç§å¸¸è§çš„æ–¹æ³•ã€‚ä¸¤è€…éƒ½åŸºäºä¿æŒæ„é€ å‡½æ•°ç§æœ‰å’Œå¯¼å‡ºå…¬å…±é™æ€æˆå‘˜ä»¥æä¾›å¯¹å”¯ä¸€å®ä¾‹çš„è®¿é—®ã€‚\nåœ¨ç¬¬ä¸€ç§æ–¹æ³•ä¸­ï¼Œæˆå‘˜æ˜¯ä¸€ä¸ª final å­—æ®µï¼š\n// Singleton with public final field public class Elvis { public static final Elvis INSTANCE = new Elvis(); private Elvis() { ... } public void leaveTheBuilding() { ... } } ç§æœ‰æ„é€ å‡½æ•°åªè°ƒç”¨ä¸€æ¬¡ï¼Œç”¨äºåˆå§‹åŒ– public static final ä¿®é¥°çš„ Elvis ç±»å‹å­—æ®µ INSTANCEã€‚ä¸ä½¿ç”¨ public æˆ– protected çš„æ„é€ å‡½æ•°ä¿è¯äº†ã€Œç‹¬ä¸€æ— äºŒã€çš„ç©ºé—´ï¼šä¸€æ—¦åˆå§‹åŒ–äº† Elvis ç±»ï¼Œå°±åªä¼šå­˜åœ¨ä¸€ä¸ª Elvis å®ä¾‹ï¼Œä¸å¤šä¹Ÿä¸å°‘ã€‚å®¢æˆ·ç«¯æ‰€åšçš„ä»»ä½•äº‹æƒ…éƒ½ä¸èƒ½æ”¹å˜è¿™ä¸€ç‚¹ï¼Œä½†æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼šæ‹¥æœ‰ç‰¹æ®Šæƒé™çš„å®¢æˆ·ç«¯å¯ä»¥å€ŸåŠ© AccessibleObject.setAccessible æ–¹æ³•åˆ©ç”¨åå°„è°ƒç”¨ç§æœ‰æ„é€ å‡½æ•°ã€‚\nConstructor\u0026lt;?\u0026gt;[] constructors = Elvis.class.getDeclaredConstructors(); AccessibleObject.setAccessible(constructors, true); Arrays.stream(constructors).forEach(name -\u0026gt; { if (name.toString().contains(\u0026#34;Elvis\u0026#34;)) { Elvis instance = (Elvis) name.newInstance(); instance.leaveTheBuilding(); } }); å¦‚æœéœ€è¦é˜²èŒƒè¿™ç§æ”»å‡»ï¼Œè¯·ä¿®æ”¹æ„é€ å‡½æ•°ï¼Œä½¿å…¶åœ¨è¯·æ±‚åˆ›å»ºç¬¬äºŒä¸ªå®ä¾‹æ—¶æŠ›å‡ºå¼‚å¸¸ã€‚\nåœ¨å®ç°å•ä¾‹çš„ç¬¬äºŒç§æ–¹æ³•ä¸­ï¼Œå…¬å…±æˆå‘˜æ˜¯ä¸€ç§é™æ€å·¥å‚æ–¹æ³•ï¼š\n// Singleton with static factory public class Elvis { private static final Elvis INSTANCE = new Elvis(); private Elvis() { .","title":"ã€ŠEffective Java 3ã€‹ç¬”è®°3ï¼šä½¿ç”¨ç§æœ‰æ„é€ å‡½æ•°æˆ–æšä¸¾ç±»å‹åˆ›å»ºå•ä¾‹"},{"content":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-03-27 åˆ° 2023-04-02 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\næœ¬å‘¨æ˜¯ä¸‰æœˆçš„æœ€åä¸€å‘¨ï¼Œæƒ³åˆ°è¿™ï¼Œå°±æƒ³å¯¹éšä¾¿å¯¹ä¸‰æœˆä»½åšä¸ªæ€»ç»“ã€‚æ€»ç»“çš„æ–¹é¢ï¼Œå¤§æ¦‚åŒ…æ‹¬å·¥ä½œã€ç”Ÿæ´»ã€å­¦ä¹ ã€å¥èº«ã€è´¢åŠ¡ã€å¨±ä¹å‡ ä¸ªæ–¹é¢ã€‚ä¸‡äº‹å¼€å¤´éš¾ï¼Œä¸çŸ¥é“èƒ½è€…å¤šå°‘ï¼Œä½†æ˜¯ï¼Œç›¸ä¿¡ä¸ç®¡å†™å¤šå°‘ï¼Œéƒ½æ˜¯æœ‰æ„ä¹‰çš„ã€‚\nå…ˆæ¥è¯´è¯´æœ€è¿‘ä¸€å‘¨åšäº†ä»€ä¹ˆã€‚æŸ¥çœ‹ä¸€ä¸‹ gitlab ä¸Šæ ‡ç­¾æäº¤è®°å½•ï¼Œè¿™å‘¨å‘å¸ƒäº†ä¸€ä¸ªç‰ˆæœ¬ï¼Œå…¶ä½™æ—¶é—´æ˜¯è¿›è¡Œæµ‹è¯•ï¼Œä¸ºä¸‹å‘¨å‘å¸ƒåšå‡†å¤‡ã€‚åœ¨å·¥ä½œä¹‹ä½™ï¼Œå¼€å§‹å­¦ä¹ ã€ŠEffective Java 3ã€‹ï¼Œå¹¶ç”¨ chatgpt ä½œä¸ºè¾…åŠ©å·¥ä½œï¼ŒåŠ æ·±å¯¹æŠ€æœ¯çš„ç†è§£ã€‚å¦å¤–ï¼Œæœ‰äº†æƒ³å­¦ä¹  Reactã€Rustã€Goã€Pyhon çš„æƒ³æ³•ã€‚æƒ³å­¦çš„ä¸œè¥¿æœ‰ç‚¹å¤šï¼Œåªèƒ½ä¸€æ­¥æ­¥æ¥ã€‚äº‰å–æ¯å¤©åˆ©ç”¨ä¸‹ç­ä¹‹åçš„ä¸€ä¸ªå°æ—¶è¿›è¡Œç¢ç‰‡åŒ–çš„å­¦ä¹ ï¼Œå¹¶ä¸”åšå¥½ç›¸å…³ç¬”è®°ï¼Œå¦‚æœ‰å¯èƒ½å‘å¸ƒåœ¨è¿™ä¸ªåšå®¢ä¸Šé¢ã€‚åŠ æ²¹ï¼\nè¿™å‘¨å®Œæˆäº†æ¯å¤©ä¸€ä¸‡æ­¥çš„è®¡åˆ’ï¼Œå…¶ä¸­å‘¨æœ«èµ°äº† 3 ä¸‡å¤šæ­¥ï¼Œå¹¶ä¸”è¿˜å¼€å§‹äº†è·‘æ­¥ã€‚\nå…³äºå¥èº« å®Œæˆäº†æ¯å¤©ä¸€ä¸‡æ­¥çš„è®¡åˆ’ï¼Œå¹¶ä¸”å…±è·‘æ­¥ 8 æ¬¡ï¼Œä¸€å…± 26 å…¬é‡Œï¼Œæœ€é«˜å¹³å‡é…é€Ÿ 7 åˆ†é’Ÿï¼Œè¿˜è·³ç»³ä¸€æ¬¡ï¼ˆ550 ä¸‹ï¼‰ã€‚\nè·‘æ­¥çš„ç›®çš„ä¸æ˜¯å¿«ï¼Œè€Œæ˜¯ä¹æ­¤ä¸ç–²ã€‚æ¯å¤©è·‘æ­¥ 5 å…¬é‡Œï¼Œæ¯æ¬¡æ¶ˆè€— 300 å¡è·¯é‡Œçš„çƒ­é‡ï¼Œå¤§æ¦‚éœ€è¦ 10 å‘¨æ‰èƒ½ç˜¦ 10 æ–¤ã€‚\nå…‰é èµ°è·¯å’Œè·‘æ­¥ï¼Œæƒ³åœ¨ 4 æœˆå®Œæˆç˜¦ 10 æ–¤çš„ç›®æ ‡ï¼Œåº”è¯¥æ˜¯ä¸å¯èƒ½çš„ï¼Œæ‰“ç®—è¾…åŠ©é—´æ­‡æ€§æ–­é£Ÿï¼Œçœ‹ä¸‹æ•ˆæœã€‚\nè·‘æ­¥æ˜¯ä¸€ç§æœ‰æ°§è¿åŠ¨ï¼Œå¯ä»¥ä¿ƒè¿›èº«ä½“ä»£è°¢ï¼Œæ¶ˆè€—ä½“å†…çš„è„‚è‚ªå’Œçƒ­é‡ï¼Œè¾¾åˆ°å‡è‚¥çš„æ•ˆæœã€‚ä½†æ˜¯å‡è‚¥çš„æ•ˆæœå—åˆ°å¾ˆå¤šå› ç´ çš„å½±å“ï¼Œå¦‚ä¸ªäººçš„ä½“é‡ã€èº«é«˜ã€å¹´é¾„ã€æ€§åˆ«ã€é¥®é£Ÿä¹ æƒ¯ã€è·‘æ­¥å¼ºåº¦ã€é¢‘ç‡å’Œæ—¶é•¿ç­‰ã€‚\né€šå¸¸æ¥è¯´ï¼Œå‡è‚¥çš„åŸºæœ¬åŸç†æ˜¯æ¶ˆè€—æ›´å¤šçš„çƒ­é‡ï¼Œä»è€Œè¾¾åˆ°ä½“é‡å‡è½»çš„æ•ˆæœã€‚æ¯å¤©è·‘æ­¥ 5 å…¬é‡Œçš„è¿åŠ¨é‡ç›¸å¯¹è¾ƒå°ï¼Œä¸€èˆ¬åœ¨ä¸€ä¸ªå°æ—¶å·¦å³å¯ä»¥å®Œæˆã€‚å¦‚æœæ¯å¤©åšæŒè·‘æ­¥ï¼ŒåŒæ—¶æ³¨æ„é¥®é£Ÿæ§åˆ¶ï¼Œå¢åŠ å…¶ä»–æœ‰æ°§è¿åŠ¨å’Œåˆç†çš„ä¼‘æ¯ï¼Œå¯èƒ½ä¼šåœ¨å‡ ä¸ªæœˆå†…çœ‹åˆ°ä¸€å®šçš„å‡è‚¥æ•ˆæœã€‚\næ ¹æ®ä¸€èˆ¬çš„å‡è‚¥ç»éªŒï¼Œæ¯æ¶ˆè€— 3500 å¡è·¯é‡Œçš„çƒ­é‡å°±å¯ä»¥å‡å°‘ä¸€æ–¤ä½“é‡ã€‚å‡è®¾æ¯æ¬¡è·‘æ­¥æ¶ˆè€— 300 å¡è·¯é‡Œçš„çƒ­é‡ï¼Œé‚£ä¹ˆæ¯å¤©è·‘æ­¥ 5 å…¬é‡Œçº¦æ¶ˆè€— 300 ~ 400 å¡è·¯é‡Œçš„çƒ­é‡ã€‚å¦‚æœæ¯å¤©åšæŒè·‘æ­¥ï¼Œå¹¶ä¸”ä¿æŒæ¯å¤©æ¶ˆè€— 300 ~ 400 å¡è·¯é‡Œçš„çƒ­é‡ï¼Œé‚£ä¹ˆå¤§çº¦éœ€è¦ 10 å‘¨æ—¶é—´æ‰èƒ½å‡å°‘ 10 æ–¤ä½“é‡ã€‚\nå…³äºè®°è´¦ ä¸Šå‘¨å¼€å§‹ï¼Œåœ¨å¯»æ‰¾ä¸€ä¸ªè®°è´¦çš„ APPï¼Œæƒ³å¼€å§‹è®°å½•æ¯å¤©çš„æ”¶å…¥ä¸æ”¯å‡ºã€‚å½“ç„¶ï¼Œæ›´å¤šçš„åº”è¯¥æ˜¯æ”¯å‡ºäº†ã€‚ç°åœ¨ï¼Œå¤§ç¯å¢ƒä¸è¡Œï¼Œå…¬å¸è£å‘˜ä¸åœï¼Œå¿…é¡»è¦å¼€æºèŠ‚æµï¼Œæ‰‹ä¸Šå‚¨å¤‡è¶³å¤Ÿçš„ç°é‡‘ã€‚\næ‰¾æ¥æ‰¾å»ï¼Œå‘ç°å¾®ä¿¡é‡Œæ²¡æœ‰æœ‰ä¸ªã€å¾®ä¿¡è®°è´¦æœ¬ã€å°ç¨‹åºå°±å¯ä»¥åœ¨å¾®ä¿¡é‡Œè‡ªåŠ¨è®°è´¦ï¼Œä¹Ÿæ”¯æŒæ‰‹åŠ¨è®°è´¦ã€‚äºæ˜¯ï¼Œè¿™å‘¨è¯•äº†ä¸€ä¸‹è¿™ä¸ªå°ç¨‹åºï¼Œå¹¶æœ‰æ„çš„æ§åˆ¶è‡ªå·±æ¯å¤©çš„è¾“å‡ºã€‚å› ä¸ºæ¯å¤©éƒ½æœ‰å¸¦é¥­ï¼Œè¿™æ ·ä¸­é¥­å°±ä¸ç”¨èŠ±é’±äº†ï¼›æ—©é¤å‘¢ï¼Œæ˜¯æ³¡ä¹‹å‰ä¹°çš„é»‘èŠéº»ç³Šå–ï¼Œçœå»äº†æ—©é¤è´¹ç”¨ã€‚ç»“æœæ˜¯ï¼Œè¿™å‘¨çš„æ”¯å‡ºåªæœ‰ 4.5 å…ƒã€‚ä¸€æ¬¡æ˜¯æ—©ä¸Šä¹°äº†ä¸€æœ¬è±†æµ†ï¼Œä¸€æ¬¡æ˜¯æ—©ä¸Šè·‘æ­¥æ€•è¿Ÿåˆ°å°±éª‘äº†ä¸€æ¬¡åŠ¨æ„Ÿå•è½¦ã€‚\næ­£å¥½ä¸‰æœˆç»“æŸäº†ï¼ŒæŸ¥çœ‹äº†ä¸€ä¸‹ä¸‰æœˆçš„æ”¯å‡ºæŠ¥è¡¨ã€‚æ€»çš„æ¥è¯´ï¼Œä¸‰æœˆæ”¯å‡ºçš„æœ‰ç‚¹å¤šï¼Œè¶…ä¹äº†æˆ‘çš„æƒ³è±¡ã€‚å¦‚æœæ¯ä¸ªæœˆéƒ½æ˜¯æ”¯å‡ºè¿™ä¹ˆå¤šï¼Œé‚£ä»¥åçš„é›¶èŠ±é’±å°±ä¸å¤Ÿç”¨äº†ã€‚è¿˜æ˜¯è¦å‹’ç´§è£¤è…°å¸¦è¿‡æ—¥å­å•Šã€‚\næ›´æ–° SSL è¯ä¹¦ å®‰è£… acme.sh\ncurl https://get.acme.sh | sh -s email=chensoul.eth@gmail.com æˆ‘çš„åŸŸåæ‰˜ç®¡åœ¨ cloudflareï¼Œæ•…éœ€è¦è·å– cloudflare API keyï¼Œåœ¨ API ä»¤ç‰Œ é¡µé¢ï¼Œç‚¹å‡»æŸ¥çœ‹ Global API Keyã€‚\nä¿å­˜ CF_Key å’Œ CF_Emailï¼š\nexport CF_Key=\u0026#34;cloudflare ä¸­æŸ¥çœ‹ä½ çš„ key\u0026#34; export CF_Email=\u0026#34;chensoul.eth@gmail.com\u0026#34; ç”Ÿæˆè¯ä¹¦ï¼Œå¹¶é‡å¯ nginxï¼š\nacme.sh --issue -d \u0026#34;chensoul.cc\u0026#34; -d \u0026#34;*.chensoul.cc\u0026#34; --dns dns_cf \\ --cert-file /usr/local/nginx/ssl/chensoul.cc.cer \\ --key-file /usr/local/nginx/ssl/chensoul.cc.key \\ --fullchain-file /usr/local/nginx/ssl/fullchain.cer \\ --reloadcmd \u0026#34;nginx -s reload\u0026#34; ç§»é™¤åŸŸåè¯ä¹¦è‡ªåŠ¨æ›´æ–°\nacme.sh --remove -d chensoul.cc -d \u0026#34;*.chensoul.cc\u0026#34; ç™¾åº¦ç«™ç‚¹æ”¶å½• å‚è€ƒ å‘ç™¾åº¦ä¸»åŠ¨æ¨é€ç½‘ç«™é“¾æ¥ ä½¿ç”¨è„šæœ¬å®šæ—¶æ¨é€ç½‘ç«™é“¾æ¥åˆ°ç™¾åº¦ç«™ç‚¹ã€‚å¯¹ push_to_baidu.sh è„šæœ¬çš„ parse æ–¹æ³•åšäº†å¦‚ä¸‹ä¿®æ”¹ï¼Œä»¥è§£å†³ xmllint è§£æå¸¦æœ‰å‘½åç©ºé—´çš„ xml æ–‡ä»¶æŠ¥é”™ çš„é—®é¢˜ã€‚\nfunction parse { local file=$1 echo $file $XMLLINT --format --xpath \u0026#34;//*[local-name()=\u0026#39;loc\u0026#39; and namespace-uri()=\u0026#39;http://www.sitemaps.org/schemas/sitemap/0.9\u0026#39;]/text()\u0026#34; \u0026#34;$file\u0026#34; | sed -e \u0026#39;s/https/\\nhttps/g\u0026#39; \u0026gt; \u0026#34;$URL_TEMP\u0026#34; echo $URL_TEMP } å·¥ä½œ Effective Java 3 ç¬”è®° è¯·å‚è€ƒ ã€ŠEffective Java 3ã€‹ç¬”è®°ï¼šä½¿ç”¨æ„é€ å™¨ä»£æ›¿æ„é€ å‡½æ•°\nRust å› ä¸ºå¯¹ Tauri è¿™ä¸ª GUI æ¡†æ¶æŒºæ„Ÿå…´è¶£ï¼Œæ‰€ä»¥æˆ‘å¼€å§‹å­¦ä¹  Rust äº†ï¼Œç›®å‰åœ¨å‚è€ƒ https://rustwiki.org/ ä¸Šçš„ é€šè¿‡ä¾‹å­å­¦ Rust å’Œ Rust ç¨‹åºè®¾è®¡è¯­è¨€ å­¦ä¹  Rustã€‚\nå¥½ç‰©åˆ†äº« è™½ç„¶å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€ChenSoul Shareã€Telegram é¢‘é“ï¼Œä¸è¿‡è¿˜æ˜¯æŒ‘é€‰ä¸€éƒ¨åˆ†åœ¨è¿™é‡Œåˆ—ä¸¾ä¸€ä¸‹ï¼Œæ„Ÿè§‰æ›´åƒä¸€ä¸ª newsletter äº†ã€‚\nä¸€äº›æ–‡ç«  Go wasm ä½¿ç”¨ï¼šGo ä»£ç ç¼–è¯‘æˆ WebAssembly åŠè°ƒç”¨\nå¤±ä¸šä¸‰ä¸ªæœˆï¼Œæˆ‘éƒ½å¹²äº†å•¥ï¼Ÿ\nä»‹ç»ä¸€ä¸‹ gitea çš„ action\nä½œä¸ºç»å¯¹åˆå­¦è€…å­¦ä¹  Web å¼€å‘\nä¸€äº›å·¥å…· æ•°æ®ç»Ÿè®¡åˆ†æï¼šhttps://usefathom.com\nCloudflare å›¾åºŠï¼šCloudflare Images\nJava å•å…ƒæµ‹è¯•æ’ä»¶ï¼šSquaretest for IntelliJ IDEA\nåŸºäºæ ‡è®°çš„ç§‘å­¦æ’ç‰ˆç³»ç»Ÿï¼šTypstã€‚å¯ä»¥ååŒå·¥ä½œï¼Œä¸”ç•Œé¢æ›´å‹å¥½ã€‚æ—¨åœ¨æˆä¸º LaTeXã€Word å’Œ Google Docs ç­‰çš„æ›¿ä»£å“ã€‚\næ•°æ®å¯è§†åŒ–èµ„æºåº“ï¼šhttps://vis.zone/lib/ã€‚ç½‘ç«™æä¾›éå¸¸å…¨é¢çš„å¯è§†åŒ–å›¾è¡¨ç±»å‹ä¾›å‚è€ƒï¼Œè¿˜æ”¶é›†äº†å¾ˆå¤šå®ç°å¯è§†åŒ–çš„ä»£ç ã€å·¥å…·ã€è¯¾ç¨‹ã€ä¹¦ç±ã€‚\nä¸€ä¸ªå…è´¹çš„ chatgpt åœ¨çº¿ webï¼šhttps://chatbot.theb.ai/#/chat/1002\nä¸€äº›è§†é¢‘ ä»¥ä¸‹æ˜¯æœ€è¿‘åœ¨çœ‹çš„ç”µè§†ã€åŠ¨ç”»ç‰‡\n-ã€Šé£šé€Ÿå®…ç”·ã€‹ç¬¬äº”å­£ã€‚ä¸€ç¾¤é«˜ä¸­ç”Ÿéª‘è‡ªè¡Œè½¦çš„çƒ­è¡€æ•…äº‹ã€‚\n-ã€Šæ½˜å¤šæ‹‰ä¼ªé€ çš„ä¹å›­ã€‹ã€‚æ­¤å‰§è®²è¿°äº†ä¸€åæ‹¥æœ‰ä»¤äººç§°ç¾¡ç”Ÿæ´»çš„å¥³å­åœ¨æ¢å¤è¿‡å¾€çš„è®°å¿†åï¼Œä¸ºä¿æŠ¤è‡ªå·±å’Œå®¶äººå¯¹éšæ„æ“çºµè‡ªå·±å‘½è¿çš„äººå±•å¼€æŠ¥å¤çš„æ•…äº‹\nä»¥ä¸Šã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/04/04/weekly_review_13/","summary":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-03-27 åˆ° 2023-04-02 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\næœ¬å‘¨æ˜¯ä¸‰æœˆçš„æœ€åä¸€å‘¨ï¼Œæƒ³åˆ°è¿™ï¼Œå°±æƒ³å¯¹éšä¾¿å¯¹ä¸‰æœˆä»½åšä¸ªæ€»ç»“ã€‚æ€»ç»“çš„æ–¹é¢ï¼Œå¤§æ¦‚åŒ…æ‹¬å·¥ä½œã€ç”Ÿæ´»ã€å­¦ä¹ ã€å¥èº«ã€è´¢åŠ¡ã€å¨±ä¹å‡ ä¸ªæ–¹é¢ã€‚ä¸‡äº‹å¼€å¤´éš¾ï¼Œä¸çŸ¥é“èƒ½è€…å¤šå°‘ï¼Œä½†æ˜¯ï¼Œç›¸ä¿¡ä¸ç®¡å†™å¤šå°‘ï¼Œéƒ½æ˜¯æœ‰æ„ä¹‰çš„ã€‚\nå…ˆæ¥è¯´è¯´æœ€è¿‘ä¸€å‘¨åšäº†ä»€ä¹ˆã€‚æŸ¥çœ‹ä¸€ä¸‹ gitlab ä¸Šæ ‡ç­¾æäº¤è®°å½•ï¼Œè¿™å‘¨å‘å¸ƒäº†ä¸€ä¸ªç‰ˆæœ¬ï¼Œå…¶ä½™æ—¶é—´æ˜¯è¿›è¡Œæµ‹è¯•ï¼Œä¸ºä¸‹å‘¨å‘å¸ƒåšå‡†å¤‡ã€‚åœ¨å·¥ä½œä¹‹ä½™ï¼Œå¼€å§‹å­¦ä¹ ã€ŠEffective Java 3ã€‹ï¼Œå¹¶ç”¨ chatgpt ä½œä¸ºè¾…åŠ©å·¥ä½œï¼ŒåŠ æ·±å¯¹æŠ€æœ¯çš„ç†è§£ã€‚å¦å¤–ï¼Œæœ‰äº†æƒ³å­¦ä¹  Reactã€Rustã€Goã€Pyhon çš„æƒ³æ³•ã€‚æƒ³å­¦çš„ä¸œè¥¿æœ‰ç‚¹å¤šï¼Œåªèƒ½ä¸€æ­¥æ­¥æ¥ã€‚äº‰å–æ¯å¤©åˆ©ç”¨ä¸‹ç­ä¹‹åçš„ä¸€ä¸ªå°æ—¶è¿›è¡Œç¢ç‰‡åŒ–çš„å­¦ä¹ ï¼Œå¹¶ä¸”åšå¥½ç›¸å…³ç¬”è®°ï¼Œå¦‚æœ‰å¯èƒ½å‘å¸ƒåœ¨è¿™ä¸ªåšå®¢ä¸Šé¢ã€‚åŠ æ²¹ï¼\nè¿™å‘¨å®Œæˆäº†æ¯å¤©ä¸€ä¸‡æ­¥çš„è®¡åˆ’ï¼Œå…¶ä¸­å‘¨æœ«èµ°äº† 3 ä¸‡å¤šæ­¥ï¼Œå¹¶ä¸”è¿˜å¼€å§‹äº†è·‘æ­¥ã€‚\nå…³äºå¥èº« å®Œæˆäº†æ¯å¤©ä¸€ä¸‡æ­¥çš„è®¡åˆ’ï¼Œå¹¶ä¸”å…±è·‘æ­¥ 8 æ¬¡ï¼Œä¸€å…± 26 å…¬é‡Œï¼Œæœ€é«˜å¹³å‡é…é€Ÿ 7 åˆ†é’Ÿï¼Œè¿˜è·³ç»³ä¸€æ¬¡ï¼ˆ550 ä¸‹ï¼‰ã€‚\nè·‘æ­¥çš„ç›®çš„ä¸æ˜¯å¿«ï¼Œè€Œæ˜¯ä¹æ­¤ä¸ç–²ã€‚æ¯å¤©è·‘æ­¥ 5 å…¬é‡Œï¼Œæ¯æ¬¡æ¶ˆè€— 300 å¡è·¯é‡Œçš„çƒ­é‡ï¼Œå¤§æ¦‚éœ€è¦ 10 å‘¨æ‰èƒ½ç˜¦ 10 æ–¤ã€‚\nå…‰é èµ°è·¯å’Œè·‘æ­¥ï¼Œæƒ³åœ¨ 4 æœˆå®Œæˆç˜¦ 10 æ–¤çš„ç›®æ ‡ï¼Œåº”è¯¥æ˜¯ä¸å¯èƒ½çš„ï¼Œæ‰“ç®—è¾…åŠ©é—´æ­‡æ€§æ–­é£Ÿï¼Œçœ‹ä¸‹æ•ˆæœã€‚\nè·‘æ­¥æ˜¯ä¸€ç§æœ‰æ°§è¿åŠ¨ï¼Œå¯ä»¥ä¿ƒè¿›èº«ä½“ä»£è°¢ï¼Œæ¶ˆè€—ä½“å†…çš„è„‚è‚ªå’Œçƒ­é‡ï¼Œè¾¾åˆ°å‡è‚¥çš„æ•ˆæœã€‚ä½†æ˜¯å‡è‚¥çš„æ•ˆæœå—åˆ°å¾ˆå¤šå› ç´ çš„å½±å“ï¼Œå¦‚ä¸ªäººçš„ä½“é‡ã€èº«é«˜ã€å¹´é¾„ã€æ€§åˆ«ã€é¥®é£Ÿä¹ æƒ¯ã€è·‘æ­¥å¼ºåº¦ã€é¢‘ç‡å’Œæ—¶é•¿ç­‰ã€‚\né€šå¸¸æ¥è¯´ï¼Œå‡è‚¥çš„åŸºæœ¬åŸç†æ˜¯æ¶ˆè€—æ›´å¤šçš„çƒ­é‡ï¼Œä»è€Œè¾¾åˆ°ä½“é‡å‡è½»çš„æ•ˆæœã€‚æ¯å¤©è·‘æ­¥ 5 å…¬é‡Œçš„è¿åŠ¨é‡ç›¸å¯¹è¾ƒå°ï¼Œä¸€èˆ¬åœ¨ä¸€ä¸ªå°æ—¶å·¦å³å¯ä»¥å®Œæˆã€‚å¦‚æœæ¯å¤©åšæŒè·‘æ­¥ï¼ŒåŒæ—¶æ³¨æ„é¥®é£Ÿæ§åˆ¶ï¼Œå¢åŠ å…¶ä»–æœ‰æ°§è¿åŠ¨å’Œåˆç†çš„ä¼‘æ¯ï¼Œå¯èƒ½ä¼šåœ¨å‡ ä¸ªæœˆå†…çœ‹åˆ°ä¸€å®šçš„å‡è‚¥æ•ˆæœã€‚\næ ¹æ®ä¸€èˆ¬çš„å‡è‚¥ç»éªŒï¼Œæ¯æ¶ˆè€— 3500 å¡è·¯é‡Œçš„çƒ­é‡å°±å¯ä»¥å‡å°‘ä¸€æ–¤ä½“é‡ã€‚å‡è®¾æ¯æ¬¡è·‘æ­¥æ¶ˆè€— 300 å¡è·¯é‡Œçš„çƒ­é‡ï¼Œé‚£ä¹ˆæ¯å¤©è·‘æ­¥ 5 å…¬é‡Œçº¦æ¶ˆè€— 300 ~ 400 å¡è·¯é‡Œçš„çƒ­é‡ã€‚å¦‚æœæ¯å¤©åšæŒè·‘æ­¥ï¼Œå¹¶ä¸”ä¿æŒæ¯å¤©æ¶ˆè€— 300 ~ 400 å¡è·¯é‡Œçš„çƒ­é‡ï¼Œé‚£ä¹ˆå¤§çº¦éœ€è¦ 10 å‘¨æ—¶é—´æ‰èƒ½å‡å°‘ 10 æ–¤ä½“é‡ã€‚\nå…³äºè®°è´¦ ä¸Šå‘¨å¼€å§‹ï¼Œåœ¨å¯»æ‰¾ä¸€ä¸ªè®°è´¦çš„ APPï¼Œæƒ³å¼€å§‹è®°å½•æ¯å¤©çš„æ”¶å…¥ä¸æ”¯å‡ºã€‚å½“ç„¶ï¼Œæ›´å¤šçš„åº”è¯¥æ˜¯æ”¯å‡ºäº†ã€‚ç°åœ¨ï¼Œå¤§ç¯å¢ƒä¸è¡Œï¼Œå…¬å¸è£å‘˜ä¸åœï¼Œå¿…é¡»è¦å¼€æºèŠ‚æµï¼Œæ‰‹ä¸Šå‚¨å¤‡è¶³å¤Ÿçš„ç°é‡‘ã€‚\næ‰¾æ¥æ‰¾å»ï¼Œå‘ç°å¾®ä¿¡é‡Œæ²¡æœ‰æœ‰ä¸ªã€å¾®ä¿¡è®°è´¦æœ¬ã€å°ç¨‹åºå°±å¯ä»¥åœ¨å¾®ä¿¡é‡Œè‡ªåŠ¨è®°è´¦ï¼Œä¹Ÿæ”¯æŒæ‰‹åŠ¨è®°è´¦ã€‚äºæ˜¯ï¼Œè¿™å‘¨è¯•äº†ä¸€ä¸‹è¿™ä¸ªå°ç¨‹åºï¼Œå¹¶æœ‰æ„çš„æ§åˆ¶è‡ªå·±æ¯å¤©çš„è¾“å‡ºã€‚å› ä¸ºæ¯å¤©éƒ½æœ‰å¸¦é¥­ï¼Œè¿™æ ·ä¸­é¥­å°±ä¸ç”¨èŠ±é’±äº†ï¼›æ—©é¤å‘¢ï¼Œæ˜¯æ³¡ä¹‹å‰ä¹°çš„é»‘èŠéº»ç³Šå–ï¼Œçœå»äº†æ—©é¤è´¹ç”¨ã€‚ç»“æœæ˜¯ï¼Œè¿™å‘¨çš„æ”¯å‡ºåªæœ‰ 4.5 å…ƒã€‚ä¸€æ¬¡æ˜¯æ—©ä¸Šä¹°äº†ä¸€æœ¬è±†æµ†ï¼Œä¸€æ¬¡æ˜¯æ—©ä¸Šè·‘æ­¥æ€•è¿Ÿåˆ°å°±éª‘äº†ä¸€æ¬¡åŠ¨æ„Ÿå•è½¦ã€‚\næ­£å¥½ä¸‰æœˆç»“æŸäº†ï¼ŒæŸ¥çœ‹äº†ä¸€ä¸‹ä¸‰æœˆçš„æ”¯å‡ºæŠ¥è¡¨ã€‚æ€»çš„æ¥è¯´ï¼Œä¸‰æœˆæ”¯å‡ºçš„æœ‰ç‚¹å¤šï¼Œè¶…ä¹äº†æˆ‘çš„æƒ³è±¡ã€‚å¦‚æœæ¯ä¸ªæœˆéƒ½æ˜¯æ”¯å‡ºè¿™ä¹ˆå¤šï¼Œé‚£ä»¥åçš„é›¶èŠ±é’±å°±ä¸å¤Ÿç”¨äº†ã€‚è¿˜æ˜¯è¦å‹’ç´§è£¤è…°å¸¦è¿‡æ—¥å­å•Šã€‚\næ›´æ–° SSL è¯ä¹¦ å®‰è£… acme.sh\ncurl https://get.acme.sh | sh -s email=chensoul.eth@gmail.com æˆ‘çš„åŸŸåæ‰˜ç®¡åœ¨ cloudflareï¼Œæ•…éœ€è¦è·å– cloudflare API keyï¼Œåœ¨ API ä»¤ç‰Œ é¡µé¢ï¼Œç‚¹å‡»æŸ¥çœ‹ Global API Keyã€‚\nä¿å­˜ CF_Key å’Œ CF_Emailï¼š\nexport CF_Key=\u0026#34;cloudflare ä¸­æŸ¥çœ‹ä½ çš„ key\u0026#34; export CF_Email=\u0026#34;chensoul.","title":"å‘¨æŠ¥-13ï½œå¥èº«ã€è®°è´¦ã€æ›´æ–°SSLè¯ä¹¦ã€ä»£ç æäº¤ç™¾åº¦ç«™ç‚¹æ”¶å½•"},{"content":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼Œåœ¨æ•´ç†ç¬”è®°è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ chatgpt çš„å¸®åŠ©åšäº†ä¸€äº›æ‰©å±•ã€‚\nä»‹ç» å½“ä¸€ä¸ªç±»éœ€è¦å¤šä¸ªæ„é€ å‡½æ•°å‚æ•°æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æ„å»ºå™¨æ¨¡å¼æ¥åˆ›å»ºå¯¹è±¡ã€‚æ„å»ºå™¨æ¨¡å¼æ˜¯ä¸€ç§åˆ›å»ºå¯¹è±¡çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒå¯ä»¥é€šè¿‡é“¾å¼è°ƒç”¨æ–¹æ³•çš„æ–¹å¼æ¥è®¾ç½®å¯¹è±¡çš„æ„é€ å‚æ•°ï¼Œå¹¶æœ€ç»ˆè¿”å›ä¸€ä¸ªæ„é€ å®Œæ•´çš„å¯¹è±¡ã€‚\nä¼˜ç‚¹ ä½¿ç”¨æ„å»ºå™¨æ¨¡å¼çš„åŸå› æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š\né¿å…æ„é€ å‡½æ•°å‚æ•°è¿‡å¤šçš„é—®é¢˜ï¼šå½“ä¸€ä¸ªç±»éœ€è¦å¤šä¸ªæ„é€ å‡½æ•°å‚æ•°æ—¶ï¼Œæ„é€ å‡½æ•°çš„å‚æ•°åˆ—è¡¨å¯èƒ½ä¼šå˜å¾—å¾ˆé•¿ï¼Œè¿™ä¼šå¯¼è‡´ä»£ç éš¾ä»¥ç†è§£å’Œç»´æŠ¤ã€‚ä½¿ç”¨æ„å»ºå™¨æ¨¡å¼å¯ä»¥å°†æ„é€ å‡½æ•°å‚æ•°æ‹†åˆ†æˆå¤šä¸ªæ–¹æ³•ï¼Œä»è€Œä½¿ä»£ç æ›´åŠ æ¸…æ™°æ˜“æ‡‚ã€‚ æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼šä½¿ç”¨æ„å»ºå™¨æ¨¡å¼å¯ä»¥ä½¿ä»£ç æ›´åŠ æ˜“æ‡‚å’Œæ˜“ç»´æŠ¤ï¼Œå› ä¸ºå¯ä»¥é€šè¿‡æ–¹æ³•åæ¥æ¸…æ™°åœ°è¡¨è¾¾æ¯ä¸ªå‚æ•°çš„å«ä¹‰ã€‚ æä¾›æ›´å¤šçš„çµæ´»æ€§å’Œå¯å®šåˆ¶æ€§ï¼šæ„å»ºå™¨æ¨¡å¼å¯ä»¥æä¾›æ›´å¤šçš„çµæ´»æ€§å’Œå¯å®šåˆ¶æ€§ï¼Œå› ä¸ºå¯ä»¥åœ¨æ„é€ å¯¹è±¡æ—¶è¿›è¡Œæ›´å¤šçš„é€»è¾‘å¤„ç†å’Œåˆ¤æ–­ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨æ„å»ºå™¨ä¸­æ·»åŠ éªŒè¯é€»è¾‘ï¼Œä»¥ç¡®ä¿å‚æ•°çš„æœ‰æ•ˆæ€§ã€‚ æ”¯æŒå¤šçº¿ç¨‹ç¯å¢ƒï¼šæ„å»ºå™¨æ¨¡å¼å¯ä»¥æ”¯æŒå¤šçº¿ç¨‹ç¯å¢ƒï¼Œå› ä¸ºæ¯ä¸ªæ„å»ºå™¨éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¼šå—åˆ°å…¶ä»–çº¿ç¨‹çš„å½±å“ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼š\npublic class NutritionFacts { private final int servingSize; private final int servings; private final int calories; private final int fat; private final int sodium; private final int carbohydrate; private NutritionFacts(Builder builder) { this.servingSize = builder.servingSize; this.servings = builder.servings; this.calories = builder.calories; this.fat = builder.fat; this.sodium = builder.sodium; this.carbohydrate = builder.carbohydrate; } //çœç•¥ get set public static class Builder { // Required parameters private final int servingSize; private final int servings; // Optional parameters - initialized to default values private int calories = 0; private int fat = 0; private int sodium = 0; private int carbohydrate = 0; public Builder(int servingSize, int servings) { this.servingSize = servingSize; this.servings = servings; } public Builder calories(int calories) { this.calories = calories; return this; } public Builder fat(int fat) { this.fat = fat; return this; } public Builder sodium(int sodium) { this.sodium = sodium; return this; } public Builder carbohydrate(int carbohydrate) { this.carbohydrate = carbohydrate; return this; } public NutritionFacts build() { return new NutritionFacts(this); } } } åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸º NutritionFacts çš„ç±»ï¼Œå®ƒåŒ…å«äº†ä¸€äº›è¥å…»æˆåˆ†çš„ä¿¡æ¯ï¼Œä¾‹å¦‚æ¯ä»½çš„å¤§å°ã€æ€»ä»½æ•°ã€å¡è·¯é‡Œã€è„‚è‚ªã€é’ å’Œç¢³æ°´åŒ–åˆç‰©ç­‰æˆå‘˜å˜é‡ã€‚æˆ‘ä»¬è¿˜å®šä¹‰äº†ä¸€ä¸ªåä¸º Builder çš„é™æ€å†…éƒ¨ç±»ï¼Œç”¨äºæ„å»º NutritionFacts å¯¹è±¡ã€‚\nåœ¨ Builder ç±»ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå¸¦æœ‰ä¸¤ä¸ªå‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œå¹¶åœ¨å…¶ä¸­åˆå§‹åŒ–äº†å¿…éœ€çš„æˆå‘˜å˜é‡ servingSize å’Œ servingsã€‚æˆ‘ä»¬è¿˜å®šä¹‰äº†ä¸€äº›å¯é€‰çš„æ–¹æ³•ï¼Œç”¨äºè®¾ç½® NutritionFacts å¯¹è±¡çš„å¡è·¯é‡Œã€è„‚è‚ªã€é’ å’Œç¢³æ°´åŒ–åˆç‰©ç­‰æˆå‘˜å˜é‡ã€‚è¿™äº›æ–¹æ³•éƒ½æ”¯æŒé“¾å¼è°ƒç”¨ï¼Œå¹¶è¿”å› Builder å¯¹è±¡æœ¬èº«ï¼Œä»¥ä¾¿è¿›è¡Œå¤šæ¬¡æ–¹æ³•è°ƒç”¨ã€‚\nåœ¨ Builder ç±»ä¸­ï¼Œæˆ‘ä»¬æœ€ç»ˆå®šä¹‰äº†ä¸€ä¸ª build() æ–¹æ³•ï¼Œç”¨äºåˆ›å»º NutritionFacts å¯¹è±¡å¹¶è¿”å›ã€‚åœ¨ build() æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨ NutritionFacts çš„ç§æœ‰æ„é€ å™¨å¹¶å°† Builder å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’è¿›å»ï¼Œä»è€Œåˆ›å»º NutritionFacts å¯¹è±¡å¹¶åˆå§‹åŒ–å…¶æˆå‘˜å˜é‡ã€‚\nç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ NutritionFacts.Builder ç±»æ¥åˆ›å»º NutritionFacts å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨é“¾å¼è°ƒç”¨æ¥è®¾ç½® NutritionFacts å¯¹è±¡çš„æˆå‘˜å˜é‡ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç æ¥åˆ›å»ºä¸€ä¸ªæ¯ä»½å¤§å°ä¸º 240mlã€æ€»å…±æœ‰ 8 ä»½ã€å¡è·¯é‡Œä¸º 100ã€è„‚è‚ªä¸º 2ã€é’ ä¸º 35ã€ç¢³æ°´åŒ–åˆç‰©ä¸º 27 çš„ NutritionFacts å¯¹è±¡ï¼š\nNutritionFacts cocaCola = new NutritionFacts.Builder(240, 8) .calories(100) .fat(2) .sodium(35) .carbohydrate(27) .build(); åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª NutritionFacts.Builder å¯¹è±¡ï¼Œå¹¶åœ¨æ„é€ å‡½æ•°ä¸­ä¼ é€’äº†æ¯ä»½å¤§å°å’Œæ€»ä»½æ•°ç­‰å‚æ•°ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨é“¾å¼è°ƒç”¨æ¥è®¾ç½®å¡è·¯é‡Œã€è„‚è‚ªã€é’ å’Œç¢³æ°´åŒ–åˆç‰©ç­‰æˆå‘˜å˜é‡ï¼Œå¹¶æœ€ç»ˆè°ƒç”¨ build() æ–¹æ³•æ¥åˆ›å»º NutritionFacts å¯¹è±¡ã€‚\nå¯ä»¥ä½¿ç”¨ lombok æ³¨è§£æ¥ç®€åŒ–ä»£ç ï¼Œä½†æ˜¯ï¼Œæ— æ³•åœ¨æ„é€ å™¨çš„æ„é€ æ–¹æ³•é‡Œè®¾ç½®å¿…è¦å‚æ•°ã€‚\nimport lombok.Builder; @Builder public class NutritionFacts { private final int servingSize; private final int servings; private final int calories; private final int fat; private final int sodium; private final int carbohydrate; } ç¼ºç‚¹ è™½ç„¶æ„å»ºå™¨æ¨¡å¼å¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§ä»¥åŠæä¾›æ›´å¤šçš„çµæ´»æ€§å’Œå¯å®šåˆ¶æ€§ï¼Œä½†å®ƒä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ï¼ŒåŒ…æ‹¬ï¼š\nå¢åŠ ä»£ç å¤æ‚åº¦ï¼šä½¿ç”¨æ„å»ºå™¨æ¨¡å¼ä¼šå¢åŠ ä»£ç çš„å¤æ‚åº¦ï¼Œå› ä¸ºéœ€è¦åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„æ„å»ºå™¨ç±»ï¼Œå¹¶ä¸”éœ€è¦åœ¨æ„å»ºå™¨ç±»ä¸­å®šä¹‰å¤šä¸ªæ–¹æ³•æ¥è®¾ç½®å¯¹è±¡çš„å±æ€§ã€‚è¿™ä¼šå¢åŠ ä»£ç é‡å¹¶ä¸”éœ€è¦æ›´å¤šçš„æ—¶é—´æ¥ç¼–å†™å’Œç»´æŠ¤ä»£ç ã€‚ å¢åŠ å†…å­˜å¼€é”€ï¼šä½¿ç”¨æ„å»ºå™¨æ¨¡å¼éœ€è¦åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„æ„å»ºå™¨å¯¹è±¡ï¼Œå¹¶ä¸”éœ€è¦åœ¨æ„å»ºå™¨å¯¹è±¡ä¸­ä¿å­˜å¯¹è±¡çš„å±æ€§ã€‚è¿™ä¼šå¢åŠ å†…å­˜å¼€é”€ï¼Œå¹¶ä¸”åœ¨åˆ›å»ºå¯¹è±¡æ—¶éœ€è¦æ›´å¤šçš„æ—¶é—´å’Œèµ„æºã€‚ å¯¹äºç®€å•å¯¹è±¡ä¸é€‚ç”¨ï¼šæ„å»ºå™¨æ¨¡å¼æ›´é€‚ç”¨äºæ„é€ å¤æ‚å¯¹è±¡ï¼Œå¯¹äºç®€å•å¯¹è±¡æ¥è¯´ï¼Œä½¿ç”¨æ„å»ºå™¨æ¨¡å¼å¯èƒ½ä¼šå¢åŠ ä»£ç çš„å¤æ‚åº¦å’Œå¼€é”€ã€‚ éœ€è¦é¢å¤–çš„ä»£ç ï¼šä½¿ç”¨æ„å»ºå™¨æ¨¡å¼éœ€è¦ç¼–å†™é¢å¤–çš„ä»£ç æ¥åˆ›å»ºæ„å»ºå™¨ç±»å’Œå®šä¹‰æ–¹æ³•ã€‚å¦‚æœåªéœ€è¦æ„é€ ä¸€ä¸ªç®€å•çš„å¯¹è±¡ï¼Œä½¿ç”¨æ„å»ºå™¨æ¨¡å¼å¯èƒ½ä¼šæµªè´¹æ—¶é—´å’Œèµ„æºã€‚ å±‚æ¬¡æ„å»ºå™¨ å±‚æ¬¡æ„å»ºå™¨ï¼ˆHierarchical Builderï¼‰æ˜¯ä¸€ç§æ„å»ºå™¨æ¨¡å¼çš„æ‰©å±•ï¼Œå®ƒå…è®¸åˆ›å»ºå±‚æ¬¡ç»“æ„çš„å¯¹è±¡ï¼Œå¹¶æ”¯æŒåœ¨çˆ¶å¯¹è±¡ä¸­åµŒå¥—å­å¯¹è±¡ã€‚å®ƒé€šå¸¸ç”±ä¸€ä¸ªæŠ½è±¡çš„æ„å»ºå™¨æ¥å£ï¼Œå¤šä¸ªå…·ä½“çš„æ„å»ºå™¨å®ç°å’Œä¸€ä¸ªæŒ‡å¯¼è€…ï¼ˆDirectorï¼‰ç»„æˆã€‚\nåœ¨å±‚æ¬¡æ„å»ºå™¨ä¸­ï¼Œæ¯ä¸ªæ„å»ºå™¨éƒ½è´Ÿè´£åˆ›å»ºç‰¹å®šç±»å‹çš„å¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥åœ¨å…¶æ„å»ºæ–¹æ³•ä¸­è°ƒç”¨å…¶ä»–æ„å»ºå™¨çš„æ„å»ºæ–¹æ³•æ¥åˆ›å»ºåµŒå¥—çš„å­å¯¹è±¡ã€‚æŒ‡å¯¼è€…è´Ÿè´£åè°ƒæ„å»ºå™¨çš„é¡ºåºå’Œè°ƒç”¨æ„å»ºå™¨çš„æ–¹æ³•æ¥æ„å»ºå¯¹è±¡å±‚æ¬¡ç»“æ„ã€‚\nå±‚æ¬¡æ„å»ºå™¨æ¨¡å¼çš„ä¼˜ç‚¹åŒ…æ‹¬ï¼š\næ”¯æŒåˆ›å»ºå¤æ‚çš„å¯¹è±¡å±‚æ¬¡ç»“æ„ï¼Œèƒ½å¤Ÿæ„å»ºåŒ…å«å¤šä¸ªå±‚æ¬¡å’ŒåµŒå¥—å­å¯¹è±¡çš„å¯¹è±¡ã€‚ æä¾›äº†æ›´å¥½çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œå› ä¸ºæ¯ä¸ªæ„å»ºå™¨éƒ½åªéœ€è¦å…³æ³¨ä¸€ä¸ªç‰¹å®šç±»å‹çš„å¯¹è±¡ï¼Œè€Œä¸”å¯ä»¥é€šè¿‡æ–¹æ³•åæ¥æ¸…æ™°åœ°è¡¨è¾¾æ¯ä¸ªå‚æ•°çš„å«ä¹‰ã€‚ æä¾›äº†æ›´å¤šçš„çµæ´»æ€§å’Œå¯å®šåˆ¶æ€§ï¼Œå› ä¸ºå¯ä»¥åœ¨æ„å»ºå™¨ä¸­æ·»åŠ éªŒè¯é€»è¾‘ï¼Œä»¥ç¡®ä¿å‚æ•°çš„æœ‰æ•ˆæ€§ï¼Œå¹¶ä¸”å¯ä»¥åŠ¨æ€åœ°ç»„åˆæ„å»ºå™¨æ¥åˆ›å»ºä¸åŒç±»å‹çš„å¯¹è±¡ã€‚ å±‚æ¬¡æ„å»ºå™¨æ¨¡å¼çš„ç¼ºç‚¹åŒ…æ‹¬ï¼š\nä»£ç é‡ï¼šç”±äºå±‚æ¬¡æ„å»ºå™¨æ¨¡å¼éœ€è¦å®šä¹‰å¤šä¸ªæ„å»ºå™¨ç±»ï¼Œå› æ­¤ä»£ç é‡ä¼šæ¯”è¾ƒå¤§ï¼Œå°¤å…¶æ˜¯åœ¨æ„å»ºå¤æ‚å¯¹è±¡æ—¶ã€‚\nåµŒå¥—å±‚æ¬¡ï¼šå±‚æ¬¡æ„å»ºå™¨æ¨¡å¼ä¸­çš„å¯¹è±¡å±‚æ¬¡ç»“æ„æ˜¯é€šè¿‡åµŒå¥—å¤šä¸ªæ„å»ºå™¨å®ç°çš„ï¼Œè¿™ä¼šå¯¼è‡´ä»£ç çš„åµŒå¥—å±‚æ¬¡è¾ƒæ·±ï¼Œå¯èƒ½ä¼šå½±å“ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚\nå¯èƒ½ä¼šå¢åŠ å†…å­˜å¼€é”€ï¼šå› ä¸ºæ¯ä¸ªæ„å»ºå™¨éƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„å¯¹è±¡ï¼Œå¹¶ä¸”éœ€è¦åœ¨æ„å»ºå™¨å¯¹è±¡ä¸­ä¿å­˜å¯¹è±¡çš„å±æ€§ã€‚å¯¹äºå¤§å‹å¯¹è±¡å’Œå¤šçº§åµŒå¥—ç»“æ„ï¼Œå¼€é”€å¯èƒ½ä¼šå¾ˆå¤§ã€‚\nä¸é€‚åˆç®€å•å¯¹è±¡çš„æ„å»ºï¼šå±‚æ¬¡æ„å»ºå™¨æ¨¡å¼é€‚ç”¨äºæ„å»ºå¤æ‚å¯¹è±¡å±‚æ¬¡ç»“æ„ï¼Œä½†å¯¹äºç®€å•çš„å¯¹è±¡æ„å»ºï¼Œä½¿ç”¨å±‚æ¬¡æ„å»ºå™¨æ¨¡å¼å¯èƒ½ä¼šæ˜¾å¾—è¿‡äºç¹çå’Œä¸å¿…è¦ã€‚\nä½¿ç”¨ ä¸¾ä¾‹ 1 1ã€å®šä¹‰æŠ½è±¡çš„æ„å»ºå™¨æ¥å£ï¼Œç”¨äºåˆ›å»ºä¸åŒç±»å‹çš„å¯¹è±¡å’Œæ·»åŠ å­å¯¹è±¡ï¼š\npublic interface ComputerBuilder { void buildCPU(String model); void buildGPU(String model); void buildMemory(int size); void addStorage(String type, int size); void addPeripheral(String type); Computer getResult(); } 2ã€åˆ›å»ºå…·ä½“çš„æ„å»ºå™¨å®ç°ï¼Œç”¨äºæ„å»ºä¸åŒç±»å‹çš„å¯¹è±¡å’Œæ·»åŠ å­å¯¹è±¡ï¼š\npublic class DesktopBuilder implements ComputerBuilder { private Desktop computer = new Desktop(); public void buildCPU(String model) { computer.setCPU(new CPU(model)); } public void buildGPU(String model) { computer.setGPU(new GPU(model)); } public void buildMemory(int size) { computer.setMemory(new Memory(size)); } public void addStorage(String type, int size) { computer.addStorage(new Storage(type, size)); } public void addPeripheral(String type) { computer.addPeripheral(new Peripheral(type)); } public Computer getResult() { return computer; } } public class LaptopBuilder implements ComputerBuilder { private Laptop computer = new Laptop(); public void buildCPU(String model) { computer.setCPU(new CPU(model)); } public void buildGPU(String model) { computer.setGPU(new GPU(model)); } public void buildMemory(int size) { computer.setMemory(new Memory(size)); } public void addStorage(String type, int size) { computer.addStorage(new Storage(type, size)); } public void addPeripheral(String type) { computer.addPeripheral(new Peripheral(type)); } public Computer getResult() { return computer; } } 3ã€åˆ›å»ºæŒ‡å¯¼è€…ç±»ï¼Œç”¨äºåè°ƒæ„å»ºå™¨çš„é¡ºåºå’Œè°ƒç”¨æ„å»ºå™¨çš„æ–¹æ³•æ¥æ„å»ºå¯¹è±¡å±‚æ¬¡ç»“æ„ï¼š\npublic class ComputerDirector { private ComputerBuilder builder; public ComputerDirector(ComputerBuilder builder) { this.builder = builder; } public void construct() { builder.buildCPU(\u0026#34;Intel Core i7\u0026#34;); builder.buildGPU(\u0026#34;Nvidia GeForce RTX 3080\u0026#34;); builder.buildMemory(16); builder.addStorage(\u0026#34;SSD\u0026#34;, 512); builder.addPeripheral(\u0026#34;Keyboard\u0026#34;); builder.addPeripheral(\u0026#34;Mouse\u0026#34;); } } 4ã€ä½¿ç”¨å±‚æ¬¡æ„å»ºå™¨æ¨¡å¼åˆ›å»ºè®¡ç®—æœºç³»ç»Ÿå¯¹è±¡ï¼š\nComputerBuilder desktopBuilder = new DesktopBuilder(); ComputerBuilder laptopBuilder = new LaptopBuilder(); ComputerDirector director = new ComputerDirector(desktopBuilder); director.construct(); Computer desktop = desktopBuilder.getResult(); director = new ComputerDirector(laptopBuilder); director.construct(); Computer laptop = laptopBuilder.getResult(); // å°†ä¸¤ä¸ªè®¡ç®—æœºç³»ç»Ÿå¯¹è±¡ç»„åˆæˆä¸€ä¸ªæ›´å¤§çš„è®¡ç®—æœºç³»ç»Ÿå¯¹è±¡ ComputerSystem system = new ComputerSystem(); system.addComputer(desktop); system.addComputer(laptop); åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒDesktopBuilder å’Œ LaptopBuilder åˆ†åˆ«æ˜¯å…·ä½“çš„æ„å»ºå™¨å®ç°ï¼Œç”¨äºåˆ›å»ºæ¡Œé¢è®¡ç®—æœºå’Œç¬”è®°æœ¬ç”µè„‘å¯¹è±¡ã€‚ComputerDirector æ˜¯æŒ‡å¯¼è€…ç±»ï¼Œç”¨äºåè°ƒæ„å»ºå™¨çš„é¡ºåºå’Œè°ƒç”¨æ„å»ºå™¨çš„æ–¹æ³•æ¥æ„å»ºå¯¹è±¡å±‚æ¬¡ç»“æ„ã€‚ä½¿ç”¨ ComputerDirector æ„å»ºè®¡ç®—æœºç³»ç»Ÿå¯¹è±¡æ—¶ï¼Œå¯ä»¥å…ˆä½¿ç”¨ DesktopBuilder æ„å»ºæ¡Œé¢è®¡ç®—æœºå¯¹è±¡ï¼Œå†ä½¿ç”¨ LaptopBuilder æ„å»ºç¬”è®°æœ¬ç”µè„‘å¯¹è±¡ï¼Œæœ€åå°†ä¸¤ä¸ªè®¡ç®—æœºç³»ç»Ÿå¯¹è±¡ç»„åˆæˆä¸€ä¸ªæ›´å¤§çš„è®¡ç®—æœºç³»ç»Ÿå¯¹è±¡ã€‚\nä¸‹é¢æ˜¯å¦ä¸€ä¸ªä½¿ç”¨å±‚æ¬¡æ„å»ºå™¨æ¨¡å¼åˆ›å»ºå±‚æ¬¡ç»“æ„å¯¹è±¡çš„ä¾‹å­ï¼Œå‡è®¾éœ€è¦åˆ›å»ºä¸€ä¸ªç»„ç»‡ç»“æ„çš„å±‚æ¬¡ç»“æ„å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«å¤šä¸ªéƒ¨é—¨å’ŒåµŒå¥—å­éƒ¨é—¨ï¼š\n1ã€å®šä¹‰æŠ½è±¡çš„æ„å»ºå™¨æ¥å£ï¼Œç”¨äºåˆ›å»ºä¸åŒç±»å‹çš„å¯¹è±¡å’Œæ·»åŠ å­å¯¹è±¡ï¼š\npublic interface DepartmentBuilder { void buildName(String name); void buildManager(String manager); void addSubDepartment(Department subDepartment); Department getResult(); } public abstract class DepartmentImpl implements Department { protected String name; protected String manager; protected List\u0026lt;Department\u0026gt; subDepartments = new ArrayList\u0026lt;\u0026gt;(); public void setName(String name) { this.name = name; } public void setManager(String manager) { this.manager = manager; } public void addSubDepartment(Department subDepartment) { subDepartments.add(subDepartment); } public void removeSubDepartment(Department subDepartment) { subDepartments.remove(subDepartment); } public List\u0026lt;Department\u0026gt; getSubDepartments() { return subDepartments; } public String getName() { return name; } public String getManager() { return manager; } } public class DevelopmentDepartment extends DepartmentImpl { // æ·»åŠ ç‰¹å®šäºå¼€å‘éƒ¨é—¨çš„å±æ€§å’Œæ–¹æ³• } public class SalesDepartment extends DepartmentImpl { // æ·»åŠ ç‰¹å®šäºé”€å”®éƒ¨é—¨çš„å±æ€§å’Œæ–¹æ³• } 2ã€åˆ›å»ºå…·ä½“çš„æ„å»ºå™¨å®ç°ï¼Œç”¨äºæ„å»ºä¸åŒç±»å‹çš„å¯¹è±¡å’Œæ·»åŠ å­å¯¹è±¡ï¼š\npublic class SalesDepartmentBuilder implements DepartmentBuilder { private SalesDepartment department = new SalesDepartment(); public void buildName(String name) { department.setName(name); } public void buildManager(String manager) { department.setManager(manager); } public void addSubDepartment(Department subDepartment) { department.addSubDepartment(subDepartment); } public Department getResult() { return department; } } public class DevelopmentDepartmentBuilder implements DepartmentBuilder { private DevelopmentDepartment department = new DevelopmentDepartment(); public void buildName(String name) { department.setName(name); } public void buildManager(String manager) { department.setManager(manager); } public void addSubDepartment(Department subDepartment) { department.addSubDepartment(subDepartment); } public Department getResult() { return department; } } 3ã€åˆ›å»ºæŒ‡å¯¼è€…ç±»ï¼Œç”¨äºåè°ƒæ„å»ºå™¨çš„é¡ºåºå’Œè°ƒç”¨æ„å»ºå™¨çš„æ–¹æ³•æ¥æ„å»ºå¯¹è±¡å±‚æ¬¡ç»“æ„ï¼š\npublic class OrganizationDirector { private DepartmentBuilder builder; public OrganizationDirector(DepartmentBuilder builder) { this.builder = builder; } public void construct() { builder.buildName(\u0026#34;Organization\u0026#34;); builder.buildManager(\u0026#34;CEO\u0026#34;); Department salesDept = new SalesDepartment(); salesDept.setName(\u0026#34;Sales Department\u0026#34;); salesDept.setManager(\u0026#34;Sales Manager\u0026#34;); builder.addSubDepartment(salesDept); Department devDept = new DevelopmentDepartment(); devDept.setName(\u0026#34;Development Department\u0026#34;); devDept.setManager(\u0026#34;Development Manager\u0026#34;); Department frontendDevDept = new DevelopmentDepartment(); frontendDevDept.setName(\u0026#34;Front-end Development Department\u0026#34;); frontendDevDept.setManager(\u0026#34;Front-end Development Manager\u0026#34;); devDept.addSubDepartment(frontendDevDept); Department backendDevDept = new DevelopmentDepartment(); backendDevDept.setName(\u0026#34;Back-end Development Department\u0026#34;); backendDevDept.setManager(\u0026#34;Back-end Development Manager\u0026#34;); devDept.addSubDepartment(backendDevDept); builder.addSubDepartment(devDept); } } 4ã€ä½¿ç”¨å±‚æ¬¡æ„å»ºå™¨æ¨¡å¼åˆ›å»ºç»„ç»‡ç»“æ„å¯¹è±¡ï¼š\nDepartmentBuilder salesDeptBuilder = new SalesDepartmentBuilder(); DepartmentBuilder devDeptBuilder = new DevelopmentDepartmentBuilder(); OrganizationDirector director = new OrganizationDirector(salesDeptBuilder); director.construct(); Department salesDept = salesDeptBuilder.getResult(); director = new OrganizationDirector(devDeptBuilder); director.construct(); Department devDept = devDeptBuilder.getResult(); // å°†ä¸¤ä¸ªéƒ¨é—¨å¯¹è±¡ç»„åˆæˆä¸€ä¸ªæ›´å¤§çš„ç»„ç»‡ç»“æ„å¯¹è±¡ Organization organization = new Organization(); organization.addDepartment(salesDept); organization.addDepartment(devDept); åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒSalesDepartmentBuilder å’Œ DevelopmentDepartmentBuilder åˆ†åˆ«æ˜¯å…·ä½“çš„æ„å»ºå™¨å®ç°ï¼Œç”¨äºåˆ›å»ºé”€å”®éƒ¨é—¨å’Œå¼€å‘éƒ¨é—¨å¯¹è±¡ã€‚OrganizationDirector æ˜¯æŒ‡å¯¼è€…ç±»ï¼Œç”¨äºåè°ƒæ„å»ºå™¨çš„é¡ºåºå’Œè°ƒç”¨æ„å»ºå™¨çš„æ–¹æ³•æ¥æ„å»ºå¯¹è±¡å±‚æ¬¡ç»“æ„ã€‚ä½¿ç”¨ OrganizationDirector æ„å»ºç»„ç»‡ç»“æ„å¯¹è±¡æ—¶ï¼Œå¯ä»¥å…ˆä½¿ç”¨ SalesDepartmentBuilder æ„å»ºé”€å”®éƒ¨é—¨å¯¹è±¡ï¼Œå†ä½¿ç”¨ DevelopmentDepartmentBuilder æ„å»ºå¼€å‘éƒ¨é—¨å¯¹è±¡ï¼Œæœ€åå°†ä¸¤ä¸ªéƒ¨é—¨å¯¹è±¡ç»„åˆæˆä¸€ä¸ªæ›´å¤§çš„ç»„ç»‡ç»“æ„å¯¹è±¡ã€‚\nä¸¾ä¾‹ 2 public abstract class ComputerComponent { private final String manufacturer; private final String model; // ... protected ComputerComponent(Builder\u0026lt;?\u0026gt; builder) { manufacturer = builder.manufacturer; model = builder.model; // ... } public String getManufacturer() { return manufacturer; } public String getModel() { return model; } public static abstract class Builder\u0026lt;T extends Builder\u0026lt;T\u0026gt;\u0026gt; { private String manufacturer; private String model; // ... public T setManufacturer(String manufacturer) { this.manufacturer = manufacturer; return self(); } public T setModel(String model) { this.model = model; return self(); } protected abstract T self(); public abstract ComputerComponent build(); } } public class Motherboard extends ComputerComponent { private final String socketType; // ... protected Motherboard(Builder builder) { super(builder); socketType = builder.socketType; // ... } public String getSocketType() { return socketType; } public static class Builder extends ComputerComponent.Builder\u0026lt;Builder\u0026gt; { private String socketType; // ... public Builder setSocketType(String socketType) { this.socketType = socketType; return this; } @Override protected Builder self() { return this; } @Override public Motherboard build() { return new Motherboard(this); } } } public class CPU extends ComputerComponent { private final int coreCount; // ... protected CPU(Builder builder) { super(builder); coreCount = builder.coreCount; // ... } public int getCoreCount() { return coreCount; } public static class Builder extends ComputerComponent.Builder\u0026lt;Builder\u0026gt; { private int coreCount; // ... public Builder setCoreCount(int coreCount) { this.coreCount = coreCount; return this; } @Override protected Builder self() { return this; } @Override public CPU build() { return new CPU(this); } } } public class Computer { private final Motherboard motherboard; private final CPU cpu; // ... protected Computer(Builder builder) { motherboard = builder.motherboard; cpu = builder.cpu; // ... } public Motherboard getMotherboard() { return motherboard; } public CPU getCpu() { return cpu; } public static class Builder { private Motherboard motherboard; private CPU cpu; // ... public Builder setMotherboard(Motherboard motherboard) { this.motherboard = motherboard; return this; } public Builder setCpu(CPU cpu) { this.cpu = cpu; return this; } public Computer build() { return new Computer(this); } } } ä½¿ç”¨ç¤ºä¾‹ï¼š\nMotherboard.Builder motherboardBuilder = new Motherboard.Builder() .setManufacturer(\u0026#34;ASUS\u0026#34;) .setModel(\u0026#34;ROG Strix Z590-E Gaming\u0026#34;) .setSocketType(\u0026#34;LGA 1200\u0026#34;) // ... CPU.Builder cpuBuilder = new CPU.Builder() .setManufacturer(\u0026#34;Intel\u0026#34;) .setModel(\u0026#34;Core i9-11900K\u0026#34;) .setCoreCount(8) // ... Computer.Builder computerBuilder = new Computer.Builder() .setMotherboard(motherboardBuilder.build()) .setCpu(cpuBuilder.build()) // ... Computer computer = computerBuilder.build(); åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒComputerComponent ç±»æ˜¯ä¸€ä¸ªæŠ½è±¡åŸºç±»ï¼Œå®šä¹‰äº†è®¡ç®—æœºç»„ä»¶çš„åŸºæœ¬å±æ€§å’Œæ–¹æ³•ã€‚å®ƒè¿˜å®šä¹‰äº†ä¸€ä¸ªæŠ½è±¡çš„æ„å»ºå™¨ç±»ï¼Œç”¨äºæ„å»ºå®ƒçš„å­ç±»çš„å®ä¾‹ã€‚\næ¯ä¸ª ComputerComponent çš„å…·ä½“å­ç±»éƒ½æœ‰è‡ªå·±çš„å…·ä½“æ„å»ºå™¨ç±»ï¼Œè¯¥ç±»æ‰©å±•äº†æŠ½è±¡æ„å»ºå™¨ç±»ã€‚å…·ä½“æ„å»ºå™¨æä¾›äº†è®¾ç½®ç›¸åº”ç»„ä»¶å±æ€§çš„æ–¹æ³•ï¼Œä¾‹å¦‚ä¸»æ¿çš„åˆ¶é€ å•†ã€å‹å·å’Œæ’åº§ç±»å‹ï¼Œå¤„ç†å™¨çš„æ—¶é’Ÿé€Ÿåº¦å’Œå†…å­˜çš„å®¹é‡ã€‚\nComputer ç±»ä»£è¡¨ä¸€ä¸ªå®Œæ•´çš„è®¡ç®—æœºç³»ç»Ÿï¼Œå¹¶å…·æœ‰ç”¨äºæ„å»º Computer ç±»çš„å®ä¾‹çš„æ„å»ºå™¨ç±»ã€‚Computer.Builder ç±»æä¾›äº†è®¾ç½®æ¯ä¸ªç»„ä»¶å±æ€§çš„æ–¹æ³•ï¼Œä½¿ç”¨ Consumer å‡½æ•°æ¥å£æ¥æ¥å—é…ç½®ç›¸åº”æ„å»ºå™¨çš„ lambda è¡¨è¾¾å¼ã€‚\nä½¿ç”¨ ä»¥ä¸‹æ˜¯å‡ ä¸ªå¸¸è§å¼€æºæ¡†æ¶ä¸­ä½¿ç”¨å»ºé€ è€…æ¨¡å¼çš„ä¾‹å­ï¼š\nRetrofit Retrofit æ˜¯ä¸€ä¸ª Android å’Œ Java å¹³å°ä¸Šçš„ RESTful API åº“ï¼Œå®ƒä½¿ç”¨å»ºé€ è€…æ¨¡å¼æ¥åˆ›å»º RestAdapter å¯¹è±¡ã€‚RestAdapter.Builder ç±»æ˜¯ä¸€ä¸ªå»ºé€ è€…ç±»ï¼Œå®ƒåŒ…å«äº†ä¸€ç³»åˆ—çš„æ–¹æ³•ï¼Œç”¨äºè®¾ç½® Retrofit çš„é…ç½®é€‰é¡¹ï¼Œå¦‚è®¾ç½® API çš„ base URLã€è®¾ç½® HTTP Clientã€è®¾ç½® Converter ç­‰ã€‚\nç¤ºä¾‹ä»£ç ï¼š\nRestAdapter restAdapter = new RestAdapter.Builder() .setEndpoint(\u0026#34;https://api.github.com\u0026#34;) .setClient(new OkClient()) .setLogLevel(RestAdapter.LogLevel.FULL) .build(); Gson Gson æ˜¯ä¸€ä¸ªç”¨äºåœ¨ Java å¯¹è±¡å’Œ JSON æ•°æ®ä¹‹é—´è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„åº“ã€‚å®ƒä½¿ç”¨å»ºé€ è€…æ¨¡å¼æ¥åˆ›å»º Gson å¯¹è±¡ã€‚GsonBuilder ç±»æ˜¯ä¸€ä¸ªå»ºé€ è€…ç±»ï¼Œå®ƒåŒ…å«äº†ä¸€ç³»åˆ—çš„æ–¹æ³•ï¼Œç”¨äºé…ç½® Gson çš„è¡Œä¸ºï¼Œå¦‚è®¾ç½®æ—¥æœŸæ ¼å¼ã€è®¾ç½®å­—æ®µçš„å‘½åç­–ç•¥ç­‰ã€‚\nç¤ºä¾‹ä»£ç ï¼š\nGson gson = new GsonBuilder() .setDateFormat(\u0026#34;yyyy-MM-dd\u0026#39;T\u0026#39;HH:mm:ssZ\u0026#34;) .setFieldNamingPolicy(FieldNamingPolicy.LOWER_CASE_WITH_UNDERSCORES) .create(); Apache HttpClient Apache HttpClient æ˜¯ä¸€ä¸ªç”¨äºåˆ›å»º HTTP å®¢æˆ·ç«¯çš„åº“ï¼Œå®ƒä½¿ç”¨å»ºé€ è€…æ¨¡å¼æ¥åˆ›å»º HttpClient å¯¹è±¡ã€‚HttpClientBuilder ç±»æ˜¯ä¸€ä¸ªå»ºé€ è€…ç±»ï¼Œå®ƒåŒ…å«äº†ä¸€ç³»åˆ—çš„æ–¹æ³•ï¼Œç”¨äºé…ç½® HttpClient çš„è¡Œä¸ºï¼Œå¦‚è®¾ç½®è¿æ¥æ± ã€è®¾ç½®ä»£ç†ã€è®¾ç½® Cookie ç®¡ç†å™¨ç­‰ã€‚\nç¤ºä¾‹ä»£ç ï¼š\nHttpClient httpClient = HttpClientBuilder.create() .setMaxConnTotal(100) .setMaxConnPerRoute(10) .setProxy(new HttpHost(\u0026#34;localhost\u0026#34;, 8080)) .setDefaultCookieStore(new BasicCookieStore()) .build(); Apache Kafka Apache Kafka æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼Œå®ƒä½¿ç”¨å»ºé€ è€…æ¨¡å¼æ¥åˆ›å»º Producer å’Œ Consumer å¯¹è±¡ã€‚ProducerConfig å’Œ ConsumerConfig ç±»æ˜¯å»ºé€ è€…ç±»ï¼Œå®ƒä»¬åŒ…å«äº†ä¸€ç³»åˆ—çš„æ–¹æ³•ï¼Œç”¨äºé…ç½® Producer å’Œ Consumer çš„è¡Œä¸ºï¼Œå¦‚è®¾ç½® broker åœ°å€ã€è®¾ç½®åºåˆ—åŒ–å™¨ç­‰ã€‚\nç¤ºä¾‹ä»£ç ï¼š\nProperties producerProps = new Properties(); producerProps.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, \u0026#34;localhost:9092\u0026#34;); producerProps.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName()); producerProps.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName()); Producer\u0026lt;String, String\u0026gt; producer = new KafkaProducer\u0026lt;\u0026gt;(producerProps); Properties consumerProps = new Properties(); consumerProps.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, \u0026#34;localhost:9092\u0026#34;); consumerProps.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName()); consumerProps.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName()); consumerProps.put(ConsumerConfig.GROUP_ID_CONFIG, \u0026#34;my-group\u0026#34;); Consumer\u0026lt;String, String\u0026gt; consumer = new KafkaConsumer\u0026lt;\u0026gt;(consumerProps); Apache Commons Configuration Apache Commons Configuration æ˜¯ä¸€ä¸ªç”¨äºè¯»å–å’Œå†™å…¥å„ç§é…ç½®æ–‡ä»¶çš„åº“ï¼Œå®ƒä½¿ç”¨å»ºé€ è€…æ¨¡å¼æ¥åˆ›å»º Configuration å¯¹è±¡ã€‚ConfigurationBuilder ç±»æ˜¯ä¸€ä¸ªå»ºé€ è€…ç±»ï¼Œå®ƒåŒ…å«äº†ä¸€ç³»åˆ—çš„æ–¹æ³•ï¼Œç”¨äºé…ç½® Configuration çš„è¡Œä¸ºï¼Œå¦‚è®¾ç½®é…ç½®æ–‡ä»¶ç±»å‹ã€è®¾ç½®å±æ€§çš„åˆ†éš”ç¬¦ç­‰ã€‚\nç¤ºä¾‹ä»£ç ï¼š\nConfiguration config = new ConfigurationBuilder() .setDelimiterParsingDisabled(true) .setFile(new File(\u0026#34;config.properties\u0026#34;)) .setListDelimiterHandler(new DefaultListDelimiterHandler(\u0026#39;,\u0026#39;)) .build(); Guava Guava æ˜¯ä¸€ä¸ª Google å¼€å‘çš„ Java åº“ï¼Œå®ƒåŒ…å«äº†è®¸å¤šå®ç”¨çš„å·¥å…·ç±»å’Œæ•°æ®ç»“æ„ï¼Œå…¶ä¸­åŒ…æ‹¬ä½¿ç”¨å»ºé€ è€…æ¨¡å¼æ¥åˆ›å»ºçš„ ImmutableListã€ImmutableMap å’Œ ImmutableSet ç­‰ä¸å¯å˜é›†åˆç±»ã€‚\nç¤ºä¾‹ä»£ç ï¼š\nImmutableList\u0026lt;String\u0026gt; list = ImmutableList.\u0026lt;String\u0026gt;builder() .add(\u0026#34;foo\u0026#34;) .add(\u0026#34;bar\u0026#34;) .add(\u0026#34;baz\u0026#34;) .build(); ImmutableMap\u0026lt;String, Integer\u0026gt; map = ImmutableMap.\u0026lt;String, Integer\u0026gt;builder() .put(\u0026#34;foo\u0026#34;, 1) .put(\u0026#34;bar\u0026#34;, 2) .put(\u0026#34;baz\u0026#34;, 3) .build(); ImmutableSet\u0026lt;String\u0026gt; set = ImmutableSet.\u0026lt;String\u0026gt;builder() .add(\u0026#34;foo\u0026#34;) .add(\u0026#34;bar\u0026#34;) .add(\u0026#34;baz\u0026#34;) .build(); JPA Java Persistence APIï¼ˆJPAï¼‰æ˜¯ Java EE å¹³å°çš„ä¸€ä¸ª ORM æ¡†æ¶ï¼Œå®ƒä½¿ç”¨å»ºé€ è€…æ¨¡å¼æ¥åˆ›å»º EntityManagerFactory å¯¹è±¡ã€‚EntityManagerFactoryBuilder ç±»æ˜¯ä¸€ä¸ªå»ºé€ è€…ç±»ï¼Œå®ƒåŒ…å«äº†ä¸€ç³»åˆ—çš„æ–¹æ³•ï¼Œç”¨äºé…ç½® EntityManagerFactory çš„è¡Œä¸ºï¼Œå¦‚è®¾ç½®æ•°æ®æºã€è®¾ç½® JPA çš„å±æ€§ç­‰ã€‚\nç¤ºä¾‹ä»£ç ï¼š\nEntityManagerFactory entityManagerFactory = new EntityManagerFactoryBuilder() .dataSource(myDataSource) .persistenceUnit(\u0026#34;myPersistenceUnit\u0026#34;) .properties(myProperties) .build(); Spring Framework Spring Framework æ˜¯ä¸€ä¸ª Java å¹³å°ä¸Šçš„å¼€æºåº”ç”¨ç¨‹åºæ¡†æ¶ï¼Œå®ƒä½¿ç”¨å»ºé€ è€…æ¨¡å¼æ¥åˆ›å»º RestTemplate å’Œ HttpHeaders å¯¹è±¡ã€‚RestTemplateBuilder å’Œ HttpHeadersBuilder ç±»æ˜¯å»ºé€ è€…ç±»ï¼Œå®ƒä»¬åŒ…å«äº†ä¸€ç³»åˆ—çš„æ–¹æ³•ï¼Œç”¨äºé…ç½® RestTemplate å’Œ HttpHeaders çš„è¡Œä¸ºï¼Œå¦‚è®¾ç½®è¿æ¥è¶…æ—¶ã€è®¾ç½®è¯·æ±‚å¤´ç­‰ã€‚\nç¤ºä¾‹ä»£ç ï¼š\nRestTemplate restTemplate = new RestTemplateBuilder() .setConnectTimeout(Duration.ofSeconds(10)) .setReadTimeout(Duration.ofSeconds(10)) .build(); HttpHeaders headers = new HttpHeadersBuilder() .setContentType(MediaType.APPLICATION_JSON) .build(); ä¼˜åŒ– å»ºé€ è€…æ¨¡å¼çš„ä¼˜åŒ–ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\nä½¿ç”¨é™æ€å†…éƒ¨ç±»ä¼˜åŒ–å»ºé€ è€…æ¨¡å¼ å»ºé€ è€…æ¨¡å¼é€šå¸¸ä½¿ç”¨ä¸€ä¸ª Builder ç±»æ¥æ„å»ºå¤æ‚å¯¹è±¡ï¼Œä¸ºäº†é¿å… Builder ç±»å˜å¾—è¿‡äºè‡ƒè‚¿ï¼Œå¯ä»¥å°†å…¶è®¾è®¡ä¸ºé™æ€å†…éƒ¨ç±»ï¼Œè¿™æ ·å¯ä»¥ä½¿ä»£ç æ›´åŠ æ¸…æ™°ï¼ŒåŒæ—¶ä¹Ÿèƒ½å¤Ÿä¿è¯çº¿ç¨‹å®‰å…¨ã€‚\nä½¿ç”¨æµå¼æ¥å£ä¼˜åŒ–å»ºé€ è€…æ¨¡å¼ æµå¼æ¥å£æ˜¯ä¸€ç§é“¾å¼è°ƒç”¨çš„æ–¹å¼ï¼Œå®ƒå¯ä»¥å°†å¤šä¸ªæ–¹æ³•è°ƒç”¨è¿æ¥èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªé“¾å¼ç»“æ„ï¼Œä½¿å¾—ä»£ç æ›´åŠ ç®€æ´æ˜“è¯»ã€‚åœ¨å»ºé€ è€…æ¨¡å¼ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æµå¼æ¥å£æ¥ä¼˜åŒ– Builder ç±»ï¼Œä½¿å¾—å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡é“¾å¼è°ƒç”¨çš„æ–¹å¼æ¥åˆ›å»ºå¤æ‚å¯¹è±¡ï¼Œä»è€Œç®€åŒ–ä»£ç ã€‚\nä½¿ç”¨é»˜è®¤å€¼ä¼˜åŒ–å»ºé€ è€…æ¨¡å¼ åœ¨å»ºé€ è€…æ¨¡å¼ä¸­ï¼Œæœ‰äº›å±æ€§æ˜¯å¿…é¡»çš„ï¼Œè€Œæœ‰äº›å±æ€§æ˜¯å¯é€‰çš„ï¼Œå¯ä»¥ä½¿ç”¨é»˜è®¤å€¼æ¥ä¸ºå¯é€‰å±æ€§è®¾ç½®é»˜è®¤å€¼ï¼Œä»è€Œé¿å…å®¢æˆ·ç«¯å¿…é¡»ä¸ºæ¯ä¸ªå¯é€‰å±æ€§éƒ½æä¾›å€¼çš„æƒ…å†µï¼ŒåŒæ—¶ä¹Ÿèƒ½å¤Ÿç®€åŒ–å®¢æˆ·ç«¯ä»£ç ã€‚\nä½¿ç”¨ Java 8 ä¸­çš„ Optional ç±»ä¼˜åŒ–å»ºé€ è€…æ¨¡å¼ Java 8 ä¸­å¼•å…¥äº† Optional ç±»ï¼Œè¯¥ç±»å¯ä»¥ç”¨äºå¤„ç†å¯èƒ½ä¸º null çš„å€¼ï¼Œå¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–å»ºé€ è€…æ¨¡å¼ä¸­çš„ä»£ç ã€‚\nåœ¨å»ºé€ è€…æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦è®¾ç½®å¤šä¸ªå±æ€§ï¼Œå…¶ä¸­æœ‰äº›å±æ€§å¯èƒ½æ˜¯å¯é€‰çš„ï¼Œå¦‚æœç›´æ¥ä½¿ç”¨ null æ¥è¡¨ç¤ºå¯é€‰å±æ€§çš„å€¼ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä»£ç å‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œè€Œä½¿ç”¨ Optional ç±»å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ Optional ç±»ä¼˜åŒ–å»ºé€ è€…æ¨¡å¼çš„ç¤ºä¾‹ä»£ç ï¼š\nimport java.util.Optional; public class Computer { private String cpu; private String memory; private String hardDisk; private Optional\u0026lt;String\u0026gt; graphicsCard; private Computer(ComputerBuilder builder) { this.cpu = builder.cpu; this.memory = builder.memory; this.hardDisk = builder.hardDisk; this.graphicsCard = builder.graphicsCard; } // çœç•¥getteræ–¹æ³• public static class ComputerBuilder { private String cpu; private String memory; private String hardDisk; private Optional\u0026lt;String\u0026gt; graphicsCard = Optional.empty(); public ComputerBuilder setCpu(String cpu) { this.cpu = cpu; return this; } public ComputerBuilder setMemory(String memory) { this.memory = memory; return this; } public ComputerBuilder setHardDisk(String hardDisk) { this.hardDisk = hardDisk; return this; } public ComputerBuilder setGraphicsCard(String graphicsCard) { this.graphicsCard = Optional.ofNullable(graphicsCard); return this; } public Computer build() { return new Computer(this); } } } åœ¨è¿™ä¸ªç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Optional ç±»æ¥è¡¨ç¤ºå¯é€‰å±æ€§çš„å€¼ï¼Œå°† graphicsCard å±æ€§çš„ç±»å‹æ”¹ä¸ºOptional\u0026lt;String\u0026gt;ã€‚åœ¨ ComputerBuilder ç±»ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Optional.ofNullable æ–¹æ³•æ¥å°†å¯é€‰å±æ€§çš„å€¼è½¬æ¢ä¸º Optional å¯¹è±¡ï¼Œå¹¶åœ¨è°ƒç”¨ build æ–¹æ³•æ—¶ï¼Œå°† Optional å¯¹è±¡è½¬æ¢ä¸ºæ™®é€šçš„å­—ç¬¦ä¸²ç±»å‹ã€‚\nä½¿ç”¨ Lambda è¡¨è¾¾å¼ä¼˜åŒ–å»ºé€ è€…æ¨¡å¼ Lambda è¡¨è¾¾å¼æ˜¯ Java 8 ä¸­å¼•å…¥çš„ä¸€ç§æ–°çš„è¯­è¨€ç‰¹æ€§ï¼Œå¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–å»ºé€ è€…æ¨¡å¼ä¸­çš„ä»£ç ï¼Œä½¿å¾—ä»£ç æ›´åŠ ç®€æ´æ˜“è¯»ã€‚\nåœ¨å»ºé€ è€…æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦å®šä¹‰å¤šä¸ªå±æ€§ï¼Œå¹¶åœ¨æ„é€ æ–¹æ³•ä¸­è¿›è¡Œåˆå§‹åŒ–ã€‚ä½¿ç”¨ Lambda è¡¨è¾¾å¼å¯ä»¥é¿å…å®šä¹‰å¤šä¸ªå±æ€§çš„é—®é¢˜ï¼Œå°†å±æ€§çš„èµ‹å€¼æ“ä½œé€šè¿‡ Lambda è¡¨è¾¾å¼ä¼ é€’ç»™æ„é€ æ–¹æ³•ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ Lambda è¡¨è¾¾å¼ä¼˜åŒ–å»ºé€ è€…æ¨¡å¼çš„ç¤ºä¾‹ä»£ç ï¼š\nimport java.util.Optional; import java.util.function.Consumer; public class Computer { private String cpu; private String memory; private String hardDisk; private Optional\u0026lt;String\u0026gt; graphicsCard; private Computer(Consumer\u0026lt;ComputerBuilder\u0026gt; builder) { ComputerBuilder computerBuilder = new ComputerBuilder(); builder.accept(computerBuilder); this.cpu = computerBuilder.cpu; this.memory = computerBuilder.memory; this.hardDisk = computerBuilder.hardDisk; this.graphicsCard = computerBuilder.graphicsCard; } // çœç•¥getteræ–¹æ³• public static class ComputerBuilder { private String cpu; private String memory; private String hardDisk; private Optional\u0026lt;String\u0026gt; graphicsCard = Optional.empty(); public ComputerBuilder setCpu(String cpu) { this.cpu = cpu; return this; } public ComputerBuilder setMemory(String memory) { this.memory = memory; return this; } public ComputerBuilder setHardDisk(String hardDisk) { this.hardDisk = hardDisk; return this; } public ComputerBuilder setGraphicsCard(String graphicsCard) { this.graphicsCard = Optional.ofNullable(graphicsCard); return this; } } public static void main(String[] args) { Computer computer = new Computer(builder -\u0026gt; builder .setCpu(\u0026#34;Intel i7\u0026#34;) .setMemory(\u0026#34;16GB\u0026#34;) .setHardDisk(\u0026#34;512GB SSD\u0026#34;) .setGraphicsCard(\u0026#34;NVIDIA GTX 1660\u0026#34;)); } } åœ¨è¿™ä¸ªç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬å°† Computer ç±»çš„æ„é€ æ–¹æ³•æ”¹ä¸ºæ¥æ”¶ä¸€ä¸ª Consumer\u0026lt;ComputerBuilder\u0026gt; ç±»å‹çš„å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°è¡¨ç¤ºä¸€ä¸ªåŒ…å«å±æ€§èµ‹å€¼æ“ä½œçš„ Lambda è¡¨è¾¾å¼ã€‚åœ¨æ„é€ æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ª ComputerBuilder å¯¹è±¡ï¼Œç„¶åé€šè¿‡ Lambda è¡¨è¾¾å¼è°ƒç”¨ ComputerBuilder å¯¹è±¡çš„æ–¹æ³•æ¥è®¾ç½®å±æ€§å€¼ï¼Œå¹¶æœ€ç»ˆé€šè¿‡ ComputerBuilder å¯¹è±¡åˆ›å»º Computer å¯¹è±¡ã€‚\nä½¿ç”¨æ³›å‹å’Œåå°„ä¼˜åŒ– class EntityCreator\u0026lt;T\u0026gt; { private Class\u0026lt;T\u0026gt; classInstance; private T entityObj; public EntityCreator(Class\u0026lt;T\u0026gt; classInstance, Object... initParams) throws Exception { this.classInstance = classInstance; Class\u0026lt;?\u0026gt;[] paramTypes = new Class\u0026lt;?\u0026gt;[initParams.length]; for (int index = 0, length = initParams.length; index \u0026lt; length; index++) { String checkStr = initParams[index].getClass().getSimpleName(); if (checkStr.contains(\u0026#34;Integer\u0026#34;)) { paramTypes[index] = int.class; } if (checkStr.contains(\u0026#34;Double\u0026#34;)) { paramTypes[index] = double.class; } if (checkStr.contains(\u0026#34;Boolean\u0026#34;)) { paramTypes[index] = boolean.class; } if (checkStr.contains(\u0026#34;String\u0026#34;)) { paramTypes[index] = initParams[index].getClass(); } } Constructor\u0026lt;T\u0026gt; constructor = classInstance.getDeclaredConstructor(paramTypes); constructor.setAccessible(true); this.entityObj = constructor.newInstance(initParams); } public EntityCreator\u0026lt;T\u0026gt; setValue(String paramName, Object paramValue) throws Exception { Field field = classInstance.getDeclaredField(paramName); field.setAccessible(true); field.set(entityObj, paramValue); return this; } public T build() { return entityObj; } } â€‹ å¦‚æ­¤ï¼Œå¯ç§»é™¤æ•´ä¸ªå†…éƒ¨ Builder ç±»ï¼ŒNutritionFacts ç±»ç§æœ‰æ„é€ çš„å‚æ•°ä»…åŒ…æ‹¬ä¸¤ä¸ªå¿…å¡«çš„ servingSizeã€servings å­—æ®µï¼š\npublic class NutritionFacts { // Required parameters private final int servingSize; private final int servings; // Optional parameters - initialized to default values private int calories = 0; private int fat = 0; private int sodium = 0; private int carbohydrate = 0; private NutritionFacts(int servingSize, int servings) { this.servingSize = servingSize; this.servings = servings; } } è¯¥æ¡ˆä¾‹çš„å®¢æˆ·ç«¯ä»£ç æ”¹ä¸ºï¼š\nNutritionFacts cocaCola = new EntityCreator\u0026lt;\u0026gt;(NutritionFacts.class, 240, 8) .setValue(\u0026#34;calories\u0026#34;, 100) .setValue(\u0026#34;sodium\u0026#34;, 35) .setValue(\u0026#34;carbohydrate\u0026#34;, 27).build(); ","permalink":"https://blog.chensoul.cc/posts/2023/04/03/builder-instead-of-constructors/","summary":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼Œåœ¨æ•´ç†ç¬”è®°è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ chatgpt çš„å¸®åŠ©åšäº†ä¸€äº›æ‰©å±•ã€‚\nä»‹ç» å½“ä¸€ä¸ªç±»éœ€è¦å¤šä¸ªæ„é€ å‡½æ•°å‚æ•°æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æ„å»ºå™¨æ¨¡å¼æ¥åˆ›å»ºå¯¹è±¡ã€‚æ„å»ºå™¨æ¨¡å¼æ˜¯ä¸€ç§åˆ›å»ºå¯¹è±¡çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒå¯ä»¥é€šè¿‡é“¾å¼è°ƒç”¨æ–¹æ³•çš„æ–¹å¼æ¥è®¾ç½®å¯¹è±¡çš„æ„é€ å‚æ•°ï¼Œå¹¶æœ€ç»ˆè¿”å›ä¸€ä¸ªæ„é€ å®Œæ•´çš„å¯¹è±¡ã€‚\nä¼˜ç‚¹ ä½¿ç”¨æ„å»ºå™¨æ¨¡å¼çš„åŸå› æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š\né¿å…æ„é€ å‡½æ•°å‚æ•°è¿‡å¤šçš„é—®é¢˜ï¼šå½“ä¸€ä¸ªç±»éœ€è¦å¤šä¸ªæ„é€ å‡½æ•°å‚æ•°æ—¶ï¼Œæ„é€ å‡½æ•°çš„å‚æ•°åˆ—è¡¨å¯èƒ½ä¼šå˜å¾—å¾ˆé•¿ï¼Œè¿™ä¼šå¯¼è‡´ä»£ç éš¾ä»¥ç†è§£å’Œç»´æŠ¤ã€‚ä½¿ç”¨æ„å»ºå™¨æ¨¡å¼å¯ä»¥å°†æ„é€ å‡½æ•°å‚æ•°æ‹†åˆ†æˆå¤šä¸ªæ–¹æ³•ï¼Œä»è€Œä½¿ä»£ç æ›´åŠ æ¸…æ™°æ˜“æ‡‚ã€‚ æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼šä½¿ç”¨æ„å»ºå™¨æ¨¡å¼å¯ä»¥ä½¿ä»£ç æ›´åŠ æ˜“æ‡‚å’Œæ˜“ç»´æŠ¤ï¼Œå› ä¸ºå¯ä»¥é€šè¿‡æ–¹æ³•åæ¥æ¸…æ™°åœ°è¡¨è¾¾æ¯ä¸ªå‚æ•°çš„å«ä¹‰ã€‚ æä¾›æ›´å¤šçš„çµæ´»æ€§å’Œå¯å®šåˆ¶æ€§ï¼šæ„å»ºå™¨æ¨¡å¼å¯ä»¥æä¾›æ›´å¤šçš„çµæ´»æ€§å’Œå¯å®šåˆ¶æ€§ï¼Œå› ä¸ºå¯ä»¥åœ¨æ„é€ å¯¹è±¡æ—¶è¿›è¡Œæ›´å¤šçš„é€»è¾‘å¤„ç†å’Œåˆ¤æ–­ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨æ„å»ºå™¨ä¸­æ·»åŠ éªŒè¯é€»è¾‘ï¼Œä»¥ç¡®ä¿å‚æ•°çš„æœ‰æ•ˆæ€§ã€‚ æ”¯æŒå¤šçº¿ç¨‹ç¯å¢ƒï¼šæ„å»ºå™¨æ¨¡å¼å¯ä»¥æ”¯æŒå¤šçº¿ç¨‹ç¯å¢ƒï¼Œå› ä¸ºæ¯ä¸ªæ„å»ºå™¨éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¼šå—åˆ°å…¶ä»–çº¿ç¨‹çš„å½±å“ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼š\npublic class NutritionFacts { private final int servingSize; private final int servings; private final int calories; private final int fat; private final int sodium; private final int carbohydrate; private NutritionFacts(Builder builder) { this.servingSize = builder.servingSize; this.servings = builder.servings; this.calories = builder.calories; this.fat = builder.fat; this.sodium = builder.sodium; this.carbohydrate = builder.carbohydrate; } //çœç•¥ get set public static class Builder { // Required parameters private final int servingSize; private final int servings; // Optional parameters - initialized to default values private int calories = 0; private int fat = 0; private int sodium = 0; private int carbohydrate = 0; public Builder(int servingSize, int servings) { this.","title":"ã€ŠEffective Java 3ã€‹ç¬”è®°2ï¼šä½¿ç”¨æ„é€ å™¨ä»£æ›¿æ„é€ æ–¹æ³•"},{"content":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼Œåœ¨æ•´ç†ç¬”è®°è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ chatgpt çš„å¸®åŠ©åšäº†ä¸€äº›æ‰©å±•ã€‚\nä»‹ç» é™æ€å·¥å‚æ–¹æ³•æ˜¯æŒ‡åœ¨ç±»ä¸­å®šä¹‰ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºè¯¥ç±»çš„å®ä¾‹ã€‚ç¤ºä¾‹ï¼š\npublic static Boolean valueOf(boolean b) { return b ? Boolean.TRUE : Boolean.FALSE; } ä¸æ„é€ å‡½æ•°ä¸åŒçš„æ˜¯ï¼Œé™æ€å·¥å‚æ–¹æ³•å¯ä»¥æœ‰è‡ªå·±çš„åç§°ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®å‚æ•°çš„ä¸åŒè¿”å›ä¸åŒçš„å¯¹è±¡å®ä¾‹ã€‚\nä¼˜ç‚¹ è¿™æœ¬ä¹¦ä¸­æåˆ°äº†ä¸€äº›é™æ€å·¥å‚æ–¹æ³•çš„ä¼˜ç‚¹ï¼ŒåŒ…æ‹¬ï¼š\né™æ€å·¥å‚æ–¹æ³•å¯ä»¥æœ‰æ„ä¹‰çš„åç§°ï¼šä¸æ„é€ å‡½æ•°ä¸åŒï¼Œé™æ€å·¥å‚æ–¹æ³•å¯ä»¥æœ‰è‡ªå·±çš„åç§°ï¼Œè¿™ä½¿å¾—ä»£ç æ›´å…·æœ‰å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚\nä¾‹å¦‚ï¼ŒBigInteger ç±»æä¾›äº†ä¸€ä¸ªè¿”å›ç´ æ•°çš„é™æ€å·¥å‚æ–¹æ³• BigInteger.probablePrime ã€‚\né™æ€å·¥å‚æ–¹æ³•å¯ä»¥éšè—å®ç°ç»†èŠ‚ï¼šé™æ€å·¥å‚æ–¹æ³•å¯ä»¥éšè—å¯¹è±¡çš„åˆ›å»ºå’Œåˆå§‹åŒ–è¿‡ç¨‹ï¼Œä½¿å®¢æˆ·ç«¯ä»£ç æ›´åŠ ç®€æ´å’Œæ˜“äºç»´æŠ¤ã€‚\nè¿™æ˜¯æœåŠ¡æä¾›è€…æ¡†æ¶çš„åŸºç¡€ã€‚\næœåŠ¡æä¾›è€…æ¡†æ¶ä¸­æœ‰ä¸‰ä¸ªåŸºæœ¬ç»„ä»¶ï¼šæœåŠ¡æ¥å£ï¼Œä»£è¡¨è¦å®ç°çš„æœåŠ¡ï¼›æä¾›è€…æ³¨å†Œ APIï¼Œæä¾›è€…ä½¿ç”¨å®ƒæ¥æ³¨å†Œå®ç°ï¼Œä»¥åŠæœåŠ¡è®¿é—® APIï¼Œå®¢æˆ·ç«¯ä½¿ç”¨å®ƒæ¥è·å–æœåŠ¡çš„å®ä¾‹ã€‚æœåŠ¡è®¿é—® API å…è®¸å®¢æˆ·ç«¯æŒ‡å®šé€‰æ‹©å®ç°çš„æ ‡å‡†ã€‚åœ¨æ²¡æœ‰è¿™äº›æ¡ä»¶çš„æƒ…å†µä¸‹ï¼ŒAPI è¿”å›ä¸€ä¸ªé»˜è®¤å®ç°çš„å®ä¾‹ï¼Œæˆ–è€…å…è®¸å®¢æˆ·ç«¯å¾ªç¯ä½¿ç”¨æ‰€æœ‰å¯ç”¨çš„å®ç°ã€‚æœåŠ¡è®¿é—® API æ˜¯çµæ´»çš„é™æ€å·¥å‚ï¼Œå®ƒæ„æˆäº†æœåŠ¡æä¾›è€…æ¡†æ¶çš„åŸºç¡€ã€‚\næœåŠ¡æä¾›è€…æ¡†æ¶çš„ç¬¬å››ä¸ªå¯é€‰ç»„ä»¶æ˜¯æœåŠ¡æä¾›è€…æ¥å£ï¼Œå®ƒæè¿°äº†äº§ç”ŸæœåŠ¡æ¥å£å®ä¾‹çš„å·¥å‚å¯¹è±¡ã€‚åœ¨æ²¡æœ‰æœåŠ¡æä¾›è€…æ¥å£çš„æƒ…å†µä¸‹ï¼Œå¿…é¡»ä»¥åå°„çš„æ–¹å¼å®ä¾‹åŒ–å®ç°ã€‚\nåœ¨ JDBC ä¸­ï¼ŒConnection æ‰®æ¼”æœåŠ¡æ¥å£çš„è§’è‰²ã€‚DriverManager.registerDriver æ˜¯æä¾›è€…æ³¨å†Œçš„ APIï¼ŒDriverManager.getConnection æ˜¯æœåŠ¡è®¿é—® APIï¼ŒDriver æ˜¯æœåŠ¡æä¾›è€…æ¥å£ã€‚\næœåŠ¡æä¾›è€…æ¡†æ¶æ¨¡å¼æœ‰è®¸å¤šå˜ä½“ã€‚ä¾‹å¦‚ï¼ŒæœåŠ¡è®¿é—® API å¯ä»¥å‘å®¢æˆ·ç«¯è¿”å›æ¯”æä¾›è€…æä¾›çš„æ›´ä¸°å¯Œçš„æœåŠ¡æ¥å£ï¼Œè¿™æ˜¯æ¡¥æ¥æ¨¡å¼ã€‚ä¾èµ–æ³¨å…¥æ¡†æ¶å¯ä»¥çœ‹ä½œæ˜¯å¼ºå¤§çš„æœåŠ¡æä¾›è€…ã€‚ç”±äºæ˜¯ Java 6ï¼Œè¯¥å¹³å°åŒ…æ‹¬ä¸€ä¸ªé€šç”¨æœåŠ¡æä¾›è€…æ¡†æ¶ Java.util.ServiceLoaderï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦ï¼Œé€šå¸¸ä¹Ÿä¸åº”è¯¥è‡ªå·±å†™ã€‚JDBC ä¸ä½¿ç”¨ ServiceLoaderï¼Œå› ä¸ºå‰è€…æ¯”åè€…è¦æ—©ã€‚\né™æ€å·¥å‚æ–¹æ³•å¯ä»¥è¿”å›ç¼“å­˜çš„å¯¹è±¡ï¼šé™æ€å·¥å‚æ–¹æ³•å¯ä»¥è¿”å›ç¼“å­˜çš„å¯¹è±¡ï¼Œè¿™é¿å…äº†åˆ›å»ºæ–°å¯¹è±¡çš„å¼€é”€ï¼Œæé«˜äº†æ€§èƒ½ã€‚\nè¿™ç§æŠ€æœ¯ç±»ä¼¼äºäº«å…ƒæ¨¡å¼ã€‚å¦‚æœç»å¸¸è¯·æ±‚ç›¸åŒçš„å¯¹è±¡ï¼Œç‰¹åˆ«æ˜¯åœ¨åˆ›å»ºå¯¹è±¡çš„ä»£ä»·å¾ˆé«˜æ—¶ï¼Œå®ƒå¯ä»¥æå¤§åœ°æé«˜æ€§èƒ½ã€‚\nä¸¾ä¾‹ 1ï¼šä½¿ç”¨ ConcurrentHashMap\npublic class ThreadSafeCache { private static final Map\u0026lt;String, ThreadSafeCache\u0026gt; instances = new ConcurrentHashMap\u0026lt;\u0026gt;(); private ThreadSafeCache() {} public static ThreadSafeCache getInstance(String key) { return instances.computeIfAbsent(key, k -\u0026gt; new ThreadSafeCache()); } } åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒcomputeIfAbsent æ–¹æ³•ç”¨äºè®¡ç®—ç¼“å­˜å¯¹è±¡ã€‚å¦‚æœ key åœ¨ instances ä¸­ä¸å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨ lambda è¡¨è¾¾å¼ k -\u0026gt; new ThreadSafeCache() åˆ›å»ºä¸€ä¸ªæ–°çš„ ThreadSafeCache å¯¹è±¡ï¼Œå¹¶å°†è¯¥å¯¹è±¡ä¸ key å…³è”ã€‚å¦‚æœ key å·²ç»å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›ä¸ä¹‹å…³è”çš„ ThreadSafeCache å¯¹è±¡ã€‚\nä½¿ç”¨ computeIfAbsent æ–¹æ³•å¯ä»¥æ›´ç®€æ´åœ°å®ç°çº¿ç¨‹å®‰å…¨çš„ç¼“å­˜ç±»ï¼Œå¹¶ä¸”å¯ä»¥ç¡®ä¿åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„çº¿ç¨‹å®‰å…¨æ€§ã€‚\nä¸¾ä¾‹ 2ï¼šä½¿ç”¨ synchronized å…³é”®å­—\npublic class ThreadSafeCache { private static final Map\u0026lt;String, ThreadSafeCache\u0026gt; instances = new HashMap\u0026lt;\u0026gt;(); private ThreadSafeCache() {} public static synchronized ThreadSafeCache getInstance(String key) { if (!instances.containsKey(key)) { instances.put(key, new ThreadSafeCache()); } return instances.get(key); } } é™æ€å·¥å‚æ–¹æ³•å¯ä»¥è¿”å›å­ç±»å¯¹è±¡ï¼šé™æ€å·¥å‚æ–¹æ³•å¯ä»¥è¿”å›å®ç°äº†æŸä¸ªæ¥å£æˆ–ç»§æ‰¿äº†æŸä¸ªç±»çš„å­ç±»å¯¹è±¡ï¼Œè¿™æé«˜äº†ä»£ç çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚\nä¾‹å¦‚ï¼ŒJava çš„ Collections æ¡†æ¶æœ‰ 45 ä¸ªæ¥å£å®ç”¨å·¥å…·å®ç°ï¼Œæä¾›äº†ä¸å¯ä¿®æ”¹çš„é›†åˆã€åŒæ­¥é›†åˆç­‰ã€‚å‡ ä¹æ‰€æœ‰è¿™äº›å®ç°éƒ½æ˜¯é€šè¿‡ä¸€ä¸ªéå®ä¾‹åŒ–ç±»ï¼ˆjava.util.Collections ï¼‰ä¸­çš„é™æ€å·¥å‚æ–¹æ³•å¯¼å‡ºçš„ã€‚è¿”å›å¯¹è±¡çš„ç±»éƒ½æ˜¯ç§æœ‰çš„å­ç±»ã€‚\nä¸¾ä¾‹ï¼š\npublic interface Shape { void draw(); } public class Circle implements Shape { @Override public void draw() { System.out.println(\u0026#34;Drawing Circle\u0026#34;); } } public class Square implements Shape { @Override public void draw() { System.out.println(\u0026#34;Drawing Square\u0026#34;); } } public class ShapeFactory { public static Shape getShape(String shapeType) { if (shapeType == null) { return null; } if (shapeType.equalsIgnoreCase(\u0026#34;CIRCLE\u0026#34;)) { return new Circle(); } else if (shapeType.equalsIgnoreCase(\u0026#34;SQUARE\u0026#34;)) { return new Square(); } return null; } } åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒShapeFactory ç±»ä½¿ç”¨é™æ€å·¥å‚æ–¹æ³• getShape æ¥åˆ›å»º Shape å¯¹è±¡ã€‚å¦‚æœ shapeType å‚æ•°ä¸º CIRCLE ï¼Œåˆ™åˆ›å»º Circle å¯¹è±¡å¹¶è¿”å›ï¼Œå¦‚æœå‚æ•°ä¸º SQUAREï¼Œåˆ™åˆ›å»º Square å¯¹è±¡å¹¶è¿”å›ã€‚\né™æ€å·¥å‚æ–¹æ³•å¯ä»¥è¿”å›ä¸å¯å˜å¯¹è±¡ï¼šé™æ€å·¥å‚æ–¹æ³•å¯ä»¥è¿”å›ä¸å¯å˜å¯¹è±¡ï¼Œè¿™ç¡®ä¿äº†å¯¹è±¡çš„å®‰å…¨æ€§å’Œçº¿ç¨‹å®‰å…¨æ€§ã€‚\nä¸¾ä¾‹ï¼š\npublic final class ThreadSafeImmutableClass { private final int id; private final String name; private ThreadSafeImmutableClass(int id, String name) { this.id = id; this.name = name; } public static ThreadSafeImmutableClass getInstance(int id, String name) { return new ThreadSafeImmutableClass(id, name); } public int getId() { return id; } public String getName() { return name; } } åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒThreadSafeImmutableClass ç±»ä½¿ç”¨é™æ€å·¥å‚æ–¹æ³• getInstance æ¥åˆ›å»ºä¸å¯å˜å¯¹è±¡ã€‚ç”±äºè¯¥ç±»çš„å±æ€§éƒ½æ˜¯ final çš„ï¼Œå› æ­¤è¯¥å¯¹è±¡æ˜¯ä¸å¯å˜çš„ã€‚ç”±äºæ²¡æœ‰ä»»ä½•çŠ¶æ€å¯ä»¥ä¿®æ”¹ï¼Œå› æ­¤è¯¥å¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚\nç¼ºç‚¹ ä½¿ç”¨é™æ€å·¥å‚æ–¹æ³•ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ï¼Œä¾‹å¦‚ï¼š\né™æ€å·¥å‚æ–¹æ³•å¯èƒ½ä¼šå¯¼è‡´ä»£ç çš„å¯æµ‹è¯•æ€§å˜å·®ï¼Œå› ä¸ºå®ƒä»¬å¾€å¾€æ˜¯é™æ€çš„ï¼Œéš¾ä»¥è¿›è¡Œæ¨¡æ‹Ÿå’Œæ›¿æ¢ã€‚ é™æ€å·¥å‚æ–¹æ³•å¯èƒ½ä¼šä½¿ä»£ç çš„æ‰©å±•æ€§å˜å·®ï¼Œå› ä¸ºå®ƒä»¬é€šå¸¸æ˜¯é™æ€çš„ï¼Œéš¾ä»¥æ‰©å±•å’Œä¿®æ”¹ã€‚ é™æ€å·¥å‚æ–¹æ³•å¯èƒ½ä¼šä½¿ä»£ç çš„å¯è¯»æ€§å˜å·®ï¼Œå› ä¸ºå®ƒä»¬å¾€å¾€æ˜¯è‡ªå®šä¹‰çš„ï¼Œéš¾ä»¥ç†è§£å’Œç»´æŠ¤ã€‚ ä»…æä¾›é™æ€å·¥å‚æ–¹æ³•ä¹Ÿå­˜åœ¨ä¸€äº›å±€é™ï¼š\nä¸å¯ç»§æ‰¿ï¼šé™æ€å·¥å‚æ–¹æ³•æ˜¯é€šè¿‡ç±»åç›´æ¥è°ƒç”¨çš„ï¼Œå› æ­¤æ— æ³•é€šè¿‡ç»§æ‰¿æ¥åˆ›å»ºå¯¹è±¡çš„å˜ä½“æˆ–å­ç±»å¯¹è±¡ã€‚ å¯èƒ½éš¾ä»¥æ‰©å±•ï¼šå¦‚æœåœ¨å®ç°é™æ€å·¥å‚æ–¹æ³•æ—¶æ²¡æœ‰è€ƒè™‘åˆ°æ‰€æœ‰å¯èƒ½çš„ç”¨ä¾‹ï¼Œé‚£ä¹ˆåœ¨éœ€è¦æ·»åŠ æ–°åŠŸèƒ½æˆ–å¯¹è±¡ç±»å‹æ—¶å¯èƒ½ä¼šå¾ˆéš¾æ‰©å±•ã€‚ å¯èƒ½éš¾ä»¥æµ‹è¯•ï¼šå¦‚æœé™æ€å·¥å‚æ–¹æ³•ä¸­åŒ…å«å¤æ‚çš„é€»è¾‘æˆ–ä¾èµ–å¤–éƒ¨èµ„æºï¼Œé‚£ä¹ˆåœ¨æµ‹è¯•æ—¶å¯èƒ½ä¼šå¾ˆéš¾æ¨¡æ‹Ÿæˆ–æ›¿æ¢è¿™äº›ä¾èµ–é¡¹ã€‚ å¯èƒ½ä¼šå¼•èµ·æ··æ·†ï¼šå¦‚æœåœ¨åŒä¸€ä¸ªç±»ä¸­å®šä¹‰å¤šä¸ªé™æ€å·¥å‚æ–¹æ³•ï¼Œå®ƒä»¬å¯èƒ½å…·æœ‰ç›¸ä¼¼çš„åç§°æˆ–å‚æ•°ç±»å‹ï¼Œä»è€Œå¯èƒ½ä¼šå¯¼è‡´æ··æ·†æˆ–è¯¯ç”¨ã€‚ å¯¹è±¡åˆ›å»ºå¯èƒ½è¾ƒæ…¢ï¼šå¦‚æœåˆ›å»ºå¯¹è±¡éœ€è¦è¿›è¡Œå¤æ‚çš„è®¡ç®—æˆ–ä¾èµ–å¤§é‡çš„å¤–éƒ¨èµ„æºï¼Œé‚£ä¹ˆé™æ€å·¥å‚æ–¹æ³•å¯èƒ½ä¼šå¯¼è‡´å¯¹è±¡åˆ›å»ºçš„æ€§èƒ½é—®é¢˜ã€‚ æ‰€ä»¥ï¼Œåœ¨é€‰æ‹©ä¸åŒçš„é™æ€å·¥å‚æ–¹æ³•æ—¶ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªå› ç´ ï¼š\nç›®çš„ï¼šè€ƒè™‘æ¯ä¸ªå·¥å‚æ–¹æ³•çš„ç›®çš„ï¼Œä»¥åŠå®ƒæ˜¯å¦ç¬¦åˆæ‚¨çš„éœ€æ±‚ã€‚ä¸åŒçš„å·¥å‚æ–¹æ³•å¯èƒ½æœ‰ä¸åŒçš„ç›®çš„ï¼Œä¾‹å¦‚åˆ›å»ºæ–°å¯¹è±¡ã€è¿”å›å…±äº«å®ä¾‹æˆ–ä»ä¸€ç§ç±»å‹è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹ã€‚ çµæ´»æ€§ï¼šè€ƒè™‘æ¯ä¸ªå·¥å‚æ–¹æ³•çš„çµæ´»æ€§ã€‚æŸäº›å·¥å‚æ–¹æ³•å¯èƒ½æ¯”å…¶ä»–å·¥å‚æ–¹æ³•æ›´çµæ´»ï¼Œå…è®¸æ›´å¤šçš„è‡ªå®šä¹‰æˆ–é…ç½®é€‰é¡¹ã€‚ å¯è¯»æ€§ï¼šè€ƒè™‘å·¥å‚æ–¹æ³•çš„å¯è¯»æ€§ã€‚å¥½çš„å·¥å‚æ–¹æ³•åº”è¯¥æ˜“äºé˜…è¯»å’Œç†è§£ï¼Œå…·æœ‰æ¸…æ™°çš„åç§°å’Œæ˜ç¡®çš„å‚æ•°ã€‚ æ€§èƒ½ï¼šè€ƒè™‘æ¯ä¸ªå·¥å‚æ–¹æ³•çš„æ€§èƒ½å½±å“ã€‚æ ¹æ®å…·ä½“çš„ç”¨ä¾‹ï¼ŒæŸäº›å·¥å‚æ–¹æ³•å¯èƒ½æ¯”å…¶ä»–å·¥å‚æ–¹æ³•æ›´é«˜æ•ˆæˆ–æ›´å¿«ã€‚ å…¼å®¹æ€§ï¼šè€ƒè™‘å·¥å‚æ–¹æ³•æ˜¯å¦ä¸æ‚¨ç°æœ‰çš„ä»£ç åº“å’Œç¬¬ä¸‰æ–¹åº“å…¼å®¹ã€‚æ ¹æ®å…·ä½“çš„æŠ€æœ¯å’Œæ¡†æ¶ï¼ŒæŸäº›å·¥å‚æ–¹æ³•å¯èƒ½æ¯”å…¶ä»–å·¥å‚æ–¹æ³•æ›´å…¼å®¹ã€‚ ç»´æŠ¤ï¼šè€ƒè™‘æ¯ä¸ªå·¥å‚æ–¹æ³•çš„ç»´æŠ¤å½±å“ã€‚æ ¹æ®å®ç°çš„å¤æ‚æ€§ä»¥åŠæ–‡æ¡£å’Œæ”¯æŒçš„å¯ç”¨æ€§ï¼ŒæŸäº›å·¥å‚æ–¹æ³•å¯èƒ½æ¯”å…¶ä»–å·¥å‚æ–¹æ³•æ›´æ˜“äºç»´æŠ¤ã€‚ ä½¿ç”¨ ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§é™æ€å·¥å‚æ–¹æ³•çš„åç§°ï¼š\nfromï¼Œç”¨äºä»å…¶ä»–ç±»å‹çš„å¯¹è±¡æˆ–æ•°æ®æºä¸­åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œä¾‹å¦‚ Date.from å’Œ Duration.fromã€‚\nDate d = Date.from(instant); ofï¼Œä¸€ä¸ªèšåˆæ–¹æ³•ï¼Œå®ƒæ¥å—å¤šä¸ªå‚æ•°å¹¶è¿”å›ä¸€ä¸ªåŒ…å«è¿™äº›å‚æ•°çš„å®ä¾‹ï¼Œä¾‹å¦‚ï¼š\nSet\u0026lt;Rank\u0026gt; faceCards = EnumSet.of(JACK, QUEEN, KING); valueOfï¼Œä¸€ç§æ›¿ä»£ from å’Œ of ä½†æ›´å†—é•¿çš„æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š\nBigInteger prime = BigInteger.valueOf(Integer.MAX_VALUE); instance æˆ– getInstanceï¼Œè¿”å›ä¸€ä¸ªå®ä¾‹ï¼Œè¯¥å®ä¾‹ç”±å…¶å‚æ•°ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰æè¿°ï¼Œä½†ä¸å…·æœ‰ç›¸åŒçš„å€¼ï¼Œä¾‹å¦‚ï¼š\nStackWalker luke = StackWalker.getInstance(options); create æˆ– newInstanceï¼Œä¸ instance æˆ– getInstance ç±»ä¼¼ï¼Œåªæ˜¯è¯¥æ–¹æ³•ä¿è¯æ¯ä¸ªè°ƒç”¨éƒ½è¿”å›ä¸€ä¸ªæ–°å®ä¾‹ï¼Œä¾‹å¦‚ï¼š\nObject newArray = Array.newInstance(classObject, arrayLen); getTypeï¼Œç±»ä¼¼äº getInstanceï¼Œä½†å¦‚æœå·¥å‚æ–¹æ³•ä½äºä¸åŒçš„ç±»ä¸­ï¼Œåˆ™ä½¿ç”¨æ­¤æ–¹æ³•ã€‚å…¶ç±»å‹æ˜¯å·¥å‚æ–¹æ³•è¿”å›çš„å¯¹è±¡ç±»å‹ï¼Œä¾‹å¦‚ï¼š\nFileStore fs = Files.getFileStore(path); Runtime runtime = Runtime.getRuntime(); newTypeï¼Œä¸ newInstance ç±»ä¼¼ï¼Œä½†æ˜¯å¦‚æœå·¥å‚æ–¹æ³•åœ¨ä¸åŒçš„ç±»ä¸­ä½¿ç”¨ã€‚ç±»å‹æ˜¯å·¥å‚æ–¹æ³•è¿”å›çš„å¯¹è±¡ç±»å‹ï¼Œä¾‹å¦‚ï¼š\nBufferedReader br = Files.newBufferedReader(path); typeï¼Œä¸€ä¸ªç”¨æ¥æ›¿ä»£ getType å’Œ newType çš„æ¯”è¾ƒç®€å•çš„æ–¹å¼ï¼Œä¾‹å¦‚ï¼š\nList\u0026lt;Complaint\u0026gt; litany = Collections.list(legacyLitany); parseï¼šç”¨äºä»å­—ç¬¦ä¸²æˆ–å…¶ä»–æ ¼å¼ä¸­è§£æå‡ºä¸€ä¸ªå¯¹è±¡ï¼Œä¾‹å¦‚ LocalDate.parse å’Œ NumberFormat.parseã€‚\nbuildï¼šç”¨äºæ„å»ºä¸€ä¸ªå¯¹è±¡ï¼Œä¾‹å¦‚ RequestBuilder.build å’Œ ResponseBuilder.buildã€‚\nè¿˜æœ‰ä¸€äº›å¸¸ç”¨çš„é™æ€å·¥å‚æ–¹æ³•åç§°ï¼š\nasXxxï¼šç”¨äºå°†è¯¥ç±»çš„å¯¹è±¡è½¬æ¢ä¸ºå…¶ä»–ç±»å‹çš„å¯¹è±¡ï¼Œä¾‹å¦‚ ByteBuffer.asCharBuffer å’Œ FileChannel.asIntBufferã€‚ toXxxï¼šç”¨äºå°†è¯¥ç±»çš„å¯¹è±¡è½¬æ¢ä¸ºå…¶ä»–ç±»å‹çš„å¯¹è±¡ï¼Œä¾‹å¦‚ BigInteger.toByteArray å’Œ String.toCharArrayã€‚ getXXXï¼šç”¨äºè·å–æŸä¸ªå¯¹è±¡ï¼Œä¾‹å¦‚ TimeZone.getDefaultã€‚ newXxxï¼šç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œä¾‹å¦‚ File.newFile å’Œ Thread.newThreadã€‚ withXxxï¼šç”¨äºåˆ›å»ºä¸€ä¸ªä¿®æ”¹äº†æŒ‡å®šå±æ€§çš„å¯¹è±¡çš„å‰¯æœ¬ï¼Œä¾‹å¦‚ LocalDate.withYear å’Œ HttpHeaders.withAcceptã€‚ forXxxï¼šç”¨äºåˆ›å»ºä¸€ä¸ªä¸æŒ‡å®šå‚æ•°ç›¸å…³çš„å¯¹è±¡ï¼Œä¾‹å¦‚ Charset.forName å’Œ ThreadLocalRandom.forWebã€‚ ","permalink":"https://blog.chensoul.cc/posts/2023/04/03/static-factory-methods-instead-of-constructors/","summary":"æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼Œåœ¨æ•´ç†ç¬”è®°è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ chatgpt çš„å¸®åŠ©åšäº†ä¸€äº›æ‰©å±•ã€‚\nä»‹ç» é™æ€å·¥å‚æ–¹æ³•æ˜¯æŒ‡åœ¨ç±»ä¸­å®šä¹‰ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºè¯¥ç±»çš„å®ä¾‹ã€‚ç¤ºä¾‹ï¼š\npublic static Boolean valueOf(boolean b) { return b ? Boolean.TRUE : Boolean.FALSE; } ä¸æ„é€ å‡½æ•°ä¸åŒçš„æ˜¯ï¼Œé™æ€å·¥å‚æ–¹æ³•å¯ä»¥æœ‰è‡ªå·±çš„åç§°ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®å‚æ•°çš„ä¸åŒè¿”å›ä¸åŒçš„å¯¹è±¡å®ä¾‹ã€‚\nä¼˜ç‚¹ è¿™æœ¬ä¹¦ä¸­æåˆ°äº†ä¸€äº›é™æ€å·¥å‚æ–¹æ³•çš„ä¼˜ç‚¹ï¼ŒåŒ…æ‹¬ï¼š\né™æ€å·¥å‚æ–¹æ³•å¯ä»¥æœ‰æ„ä¹‰çš„åç§°ï¼šä¸æ„é€ å‡½æ•°ä¸åŒï¼Œé™æ€å·¥å‚æ–¹æ³•å¯ä»¥æœ‰è‡ªå·±çš„åç§°ï¼Œè¿™ä½¿å¾—ä»£ç æ›´å…·æœ‰å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚\nä¾‹å¦‚ï¼ŒBigInteger ç±»æä¾›äº†ä¸€ä¸ªè¿”å›ç´ æ•°çš„é™æ€å·¥å‚æ–¹æ³• BigInteger.probablePrime ã€‚\né™æ€å·¥å‚æ–¹æ³•å¯ä»¥éšè—å®ç°ç»†èŠ‚ï¼šé™æ€å·¥å‚æ–¹æ³•å¯ä»¥éšè—å¯¹è±¡çš„åˆ›å»ºå’Œåˆå§‹åŒ–è¿‡ç¨‹ï¼Œä½¿å®¢æˆ·ç«¯ä»£ç æ›´åŠ ç®€æ´å’Œæ˜“äºç»´æŠ¤ã€‚\nè¿™æ˜¯æœåŠ¡æä¾›è€…æ¡†æ¶çš„åŸºç¡€ã€‚\næœåŠ¡æä¾›è€…æ¡†æ¶ä¸­æœ‰ä¸‰ä¸ªåŸºæœ¬ç»„ä»¶ï¼šæœåŠ¡æ¥å£ï¼Œä»£è¡¨è¦å®ç°çš„æœåŠ¡ï¼›æä¾›è€…æ³¨å†Œ APIï¼Œæä¾›è€…ä½¿ç”¨å®ƒæ¥æ³¨å†Œå®ç°ï¼Œä»¥åŠæœåŠ¡è®¿é—® APIï¼Œå®¢æˆ·ç«¯ä½¿ç”¨å®ƒæ¥è·å–æœåŠ¡çš„å®ä¾‹ã€‚æœåŠ¡è®¿é—® API å…è®¸å®¢æˆ·ç«¯æŒ‡å®šé€‰æ‹©å®ç°çš„æ ‡å‡†ã€‚åœ¨æ²¡æœ‰è¿™äº›æ¡ä»¶çš„æƒ…å†µä¸‹ï¼ŒAPI è¿”å›ä¸€ä¸ªé»˜è®¤å®ç°çš„å®ä¾‹ï¼Œæˆ–è€…å…è®¸å®¢æˆ·ç«¯å¾ªç¯ä½¿ç”¨æ‰€æœ‰å¯ç”¨çš„å®ç°ã€‚æœåŠ¡è®¿é—® API æ˜¯çµæ´»çš„é™æ€å·¥å‚ï¼Œå®ƒæ„æˆäº†æœåŠ¡æä¾›è€…æ¡†æ¶çš„åŸºç¡€ã€‚\næœåŠ¡æä¾›è€…æ¡†æ¶çš„ç¬¬å››ä¸ªå¯é€‰ç»„ä»¶æ˜¯æœåŠ¡æä¾›è€…æ¥å£ï¼Œå®ƒæè¿°äº†äº§ç”ŸæœåŠ¡æ¥å£å®ä¾‹çš„å·¥å‚å¯¹è±¡ã€‚åœ¨æ²¡æœ‰æœåŠ¡æä¾›è€…æ¥å£çš„æƒ…å†µä¸‹ï¼Œå¿…é¡»ä»¥åå°„çš„æ–¹å¼å®ä¾‹åŒ–å®ç°ã€‚\nåœ¨ JDBC ä¸­ï¼ŒConnection æ‰®æ¼”æœåŠ¡æ¥å£çš„è§’è‰²ã€‚DriverManager.registerDriver æ˜¯æä¾›è€…æ³¨å†Œçš„ APIï¼ŒDriverManager.getConnection æ˜¯æœåŠ¡è®¿é—® APIï¼ŒDriver æ˜¯æœåŠ¡æä¾›è€…æ¥å£ã€‚\næœåŠ¡æä¾›è€…æ¡†æ¶æ¨¡å¼æœ‰è®¸å¤šå˜ä½“ã€‚ä¾‹å¦‚ï¼ŒæœåŠ¡è®¿é—® API å¯ä»¥å‘å®¢æˆ·ç«¯è¿”å›æ¯”æä¾›è€…æä¾›çš„æ›´ä¸°å¯Œçš„æœåŠ¡æ¥å£ï¼Œè¿™æ˜¯æ¡¥æ¥æ¨¡å¼ã€‚ä¾èµ–æ³¨å…¥æ¡†æ¶å¯ä»¥çœ‹ä½œæ˜¯å¼ºå¤§çš„æœåŠ¡æä¾›è€…ã€‚ç”±äºæ˜¯ Java 6ï¼Œè¯¥å¹³å°åŒ…æ‹¬ä¸€ä¸ªé€šç”¨æœåŠ¡æä¾›è€…æ¡†æ¶ Java.util.ServiceLoaderï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦ï¼Œé€šå¸¸ä¹Ÿä¸åº”è¯¥è‡ªå·±å†™ã€‚JDBC ä¸ä½¿ç”¨ ServiceLoaderï¼Œå› ä¸ºå‰è€…æ¯”åè€…è¦æ—©ã€‚\né™æ€å·¥å‚æ–¹æ³•å¯ä»¥è¿”å›ç¼“å­˜çš„å¯¹è±¡ï¼šé™æ€å·¥å‚æ–¹æ³•å¯ä»¥è¿”å›ç¼“å­˜çš„å¯¹è±¡ï¼Œè¿™é¿å…äº†åˆ›å»ºæ–°å¯¹è±¡çš„å¼€é”€ï¼Œæé«˜äº†æ€§èƒ½ã€‚\nè¿™ç§æŠ€æœ¯ç±»ä¼¼äºäº«å…ƒæ¨¡å¼ã€‚å¦‚æœç»å¸¸è¯·æ±‚ç›¸åŒçš„å¯¹è±¡ï¼Œç‰¹åˆ«æ˜¯åœ¨åˆ›å»ºå¯¹è±¡çš„ä»£ä»·å¾ˆé«˜æ—¶ï¼Œå®ƒå¯ä»¥æå¤§åœ°æé«˜æ€§èƒ½ã€‚\nä¸¾ä¾‹ 1ï¼šä½¿ç”¨ ConcurrentHashMap\npublic class ThreadSafeCache { private static final Map\u0026lt;String, ThreadSafeCache\u0026gt; instances = new ConcurrentHashMap\u0026lt;\u0026gt;(); private ThreadSafeCache() {} public static ThreadSafeCache getInstance(String key) { return instances.computeIfAbsent(key, k -\u0026gt; new ThreadSafeCache()); } } åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒcomputeIfAbsent æ–¹æ³•ç”¨äºè®¡ç®—ç¼“å­˜å¯¹è±¡ã€‚å¦‚æœ key åœ¨ instances ä¸­ä¸å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨ lambda è¡¨è¾¾å¼ k -\u0026gt; new ThreadSafeCache() åˆ›å»ºä¸€ä¸ªæ–°çš„ ThreadSafeCache å¯¹è±¡ï¼Œå¹¶å°†è¯¥å¯¹è±¡ä¸ key å…³è”ã€‚å¦‚æœ key å·²ç»å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›ä¸ä¹‹å…³è”çš„ ThreadSafeCache å¯¹è±¡ã€‚","title":"ã€ŠEffective Java 3ã€‹ç¬”è®°1ï¼šé™æ€å·¥å‚æ–¹æ³•ä»£æ›¿æ„é€ å‡½æ•°"},{"content":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-03-20 åˆ° 2023-03-26 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nä¸Šå‘¨å»åŒæµåŒ»é™¢æ£€æŸ¥é¼¾ç—‡ï¼Œæ£€æŸ¥ç»“æœæ˜¯è½»åº¦ç—‡çŠ¶ï¼ŒåŒ»ç”Ÿå»ºè®®å¤šè¿åŠ¨å‡è‚¥ã€‚è¿™å‘¨æ¯å¤©èµ°è·¯ 1 ä¸‡æ­¥çš„ç›®æ ‡å·²è¾¾æˆã€‚\nå·¥ä½œä¸Šå‘å¸ƒäº†ä¸€ä¸ªç‰ˆæœ¬ï¼Œå¦å¤–ä¸¤ä¸ªè¿­ä»£æ­£åœ¨è¿›è¡Œä¸­ï¼Œé¢„è®¡è¿™å‘¨å†å‘å¸ƒä¸€ä¸ªç‰ˆæœ¬ã€‚ä»é£ä¹¦é€šè®¯å½•çœ‹åˆ°åˆæœ‰ä¸‰ä¸ªéæŠ€æœ¯ç±»åŒäº‹è¢«è£ï¼Œè¿™å‘¨å‘¨ä¼šï¼Œéƒ¨é—¨é¢†å¯¼è¯´æœ€è¿‘åˆæœ‰ä¸€ä¸ªåšå•†åŠ¡çš„åŒäº‹è¢«ä¼˜åŒ–äº†ã€‚\nä¸Šå‘¨æœ‰ä¸€å¤©æ—©ä¸Šï¼Œè½¦å­åœåœ¨å°åŒºé‡Œé¢ï¼Œè¢«ä¸¤ä¸ªè½¦å­æŒ¡ä½äº†å‰åé“è·¯ï¼Œè”ç³»ä¸ä¸Šè½¦ä¸»ï¼Œåªå¥½ååœ°é“ä¸Šç­ã€‚è¯è¯´ï¼Œè‡ªä»å¼€è½¦ä¸Šç­ä¹‹åï¼Œä½¿ç”¨æ‰‹æœºçš„é¢‘ç‡æ˜æ˜¾é™ä½äº†å¾ˆå¤šã€‚\nä¸Šå‘¨æœ«é˜³å…‰æ­£å¥½ï¼Œäºæ˜¯å›å®¶å»ç»™å·²æ•…çš„äº²äººæ‰«å¢“ã€‚å‘¨å…­å›è€å®¶ï¼Œå‘¨æ—¥å›è€å©†å®¶ã€‚é€è€…å·²é€ï¼Œæ´»ç€çš„äººè¦å–„å¾…è‡ªå·±ï¼Œå¥½å¥½åƒé¥­ï¼Œå¥½å¥½ç¡è§‰ï¼Œå¥½å¥½å·¥ä½œï¼Œå¥½å¥½è¿åŠ¨ã€‚\nå·¥ä½œ Effective Java 3 ç¬”è®° è¯·å‚è€ƒ ã€ŠEffective Java 3ã€‹ç¬”è®°ï¼šé™æ€å·¥å‚æ–¹æ³•ä»£æ›¿æ„é€ å‡½æ•°ã€‚\nMachine-Learning-With-Go B ç«™è§†é¢‘ï¼šã€Œè¯¾ç¨‹ã€ä½¿ç”¨ Go åšæœºå™¨å­¦ä¹ \næºä»£ç ï¼šMachine-Learning-With-Go\nç”Ÿæ´» è½¦è¾†è¢«å µ æ—©ä¸Šå‡†å¤‡å¼€è½¦ä¸Šç­ï¼Œå‘ç°è½¦å­å‰åé“è·¯éƒ½è¢«è½¦è¾†å é“äº†ã€‚å‰é¢è½¦è¾†å é“ï¼Œæ˜¨å¤©æ™šä¸Šä¸‹ç­å›æ¥å°±å‘ç°äº†ï¼Œä¹Ÿç¡®è®¤äº†è¿™ä¸ªè½¦è¾†æ²¡æœ‰ç•™æŒªè½¦ç”µè¯ã€‚å½“æ—¶å°±éšéšæ‹…å¿§ä»Šå¤©æ—©ä¸Šä¼šè¢«æŒ¡ä½å‰åé“è·¯ã€‚æ²¡æœ‰æƒ³åˆ°ï¼ŒçœŸçš„è¢«æŒ¡äº†ã€‚åé¢çš„è½¦è¾†ç•™äº†æŒªè½¦ç”µè¯ã€‚å…­ç‚¹åŠå¼€å§‹ï¼Œæˆ‘å°±ç»™åé¢è½¦çš„è½¦ä¸»æ‰“ç”µè¯å‘çŸ­ä¿¡ï¼Œå¯¹æ–¹ä¸€ç›´æ²¡æ¥ç”µè¯ï¼Œä¼°è®¡æ‰‹æœºè°ƒé™éŸ³è¿˜åœ¨ç¡è§‰å§ã€‚æ²¡æœ‰æƒ³åˆ°çš„æ˜¯ï¼Œæˆªæ­¢åˆ°ç°åœ¨æ—¶é—´å…«ç‚¹ï¼Œä»–è¿˜æ²¡æœ‰ç»™æˆ‘å›ç”µè¯ï¼Œè¿™å“¥ä»¬ç¡å¾—é‚£æ˜¯çœŸé¦™å•Šã€‚\nåœ¨é“è·¯è¢«å ç”¨ä¹‹åï¼Œæˆ‘åšäº†ä»€ä¹ˆï¼Ÿé™¤äº†ç»™ç•™äº†å·ç çš„é‚£ä¸ªè½¦ä¸»æ‰“ç”µè¯ä¹‹å¤–ï¼Œæˆ‘è¿˜æƒ³åˆ°äº¤ç®¡ 12123 APP ä¸Šé¢æœ‰ä¸€ä¸ªä¸€é”®æŒªè½¦åŠŸèƒ½ã€‚äºæ˜¯ï¼Œè¯•äº†ä¸€ä¸‹è¿™ä¸ªåŠŸèƒ½ã€‚åŸä»¥ä¸ºè¿™ä¸ªåŠŸèƒ½å¯ä»¥ç”µè¯é€šçŸ¥åˆ°å¯¹æ–¹æŒªè½¦ã€‚å®é™…æƒ…å†µå´åªæ˜¯æäº¤äº†ä¸€ä¸ªå·¥å•è€Œå·²ï¼ŒçœŸæ˜¯ä¸€ä¸ªé¸¡è‚‹çš„åŠŸèƒ½ã€‚ç”¨æˆ·ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Œæ˜¯å¸Œæœ›åŠæ—¶è”ç³»åˆ°è½¦ä¸»è¿‡æ¥æŒªè½¦ï¼Œè€Œä¸æ˜¯æäº¤ä¸€ä¸ªå·¥å•ä¹‹åï¼Œå‚»å‚»çš„ç­‰å¾…ã€‚å¦å¤–ï¼Œè¿™ä¸ªåŠŸèƒ½ä¹Ÿä¸èƒ½å«ä¸€é”®æŒªè½¦ï¼Œå› ä¸ºç‚¹å‡»äº†è¿™ä¸ªåŠŸèƒ½ä¹‹åï¼Œè¿˜è¦è¾“å…¥è½¦ç‰Œå·ã€ä¸Šä¼ ç…§ç‰‡ã€‚æ›´å¥½çš„ä½“éªŒåº”è¯¥æ˜¯åªç”¨ä¸Šä¼ å ç”¨é“è·¯çš„è½¦è¾†ç…§ç‰‡ï¼Œç”±ç³»ç»Ÿè¯†åˆ«å‡ºè½¦ç‰Œå·ï¼Œç„¶ååå°æ‰¾åˆ°è½¦ä¸»çš„æ‰‹æœºå·ï¼Œç”Ÿæˆä¸€ä¸ªä¸´æ—¶å·ç å¹¶è°ƒç”¨æ‰‹æœºçš„æ‹¨å·åŠŸèƒ½ã€‚\nåœ¨é“è·¯è¢«å ç”¨ä¹‹åï¼Œæˆ‘çš„å¿ƒæ€æ˜¯æ€æ ·çš„ï¼Ÿåˆšå¼€å§‹æƒ³ç”Ÿæ°”æ„¤æ€’ï¼Œåæ¥æƒ³äº†æƒ³ï¼Œäº‹å·²è‡³æ­¤ï¼Œæ²¡æœ‰å¿…è¦ç”Ÿæ°”ï¼Œç”Ÿæ°”åªèƒ½å½±å“è‡ªå·±ä¸€å¤©çš„å¿ƒæƒ…å’Œå¥½è¿ã€‚å¹¶å°è¯•æŠŠè¿™ç§å¯¹è‡ªå·±ä¸åˆ©çš„ä¸€é¢è½¬åŒ–ä¸ºå¯¹è‡ªå·±æœ‰åˆ©çš„ä¸€é¢ã€‚åŸæƒ³å…­ç‚¹åŠå¼€è½¦ä¸Šç­ï¼Œé“è·¯è¢«å ä¹‹åï¼Œå°±å¯ä»¥ä½“éªŒä¸€ä¸‹ä¸ƒç‚¹å¤šç”šè‡³å…«ç‚¹å¤šå¼€è½¦ä¸Šç­éœ€è¦å¤šé•¿æ—¶é—´ä»¥åŠæ˜¯å¦å µè½¦ã€‚\nå¦‚æœæ˜¯æˆ‘æŠŠé“è·¯å ç”¨äº†ï¼Œæˆ‘è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿé¦–å…ˆï¼Œæ˜¯è½¦ä¸Šç•™ä¸€ä¸ªæ‰‹æœºå·ç ï¼›å…¶æ¬¡ï¼Œæ˜¯ç¬¬äºŒå¤©æ—©ä¸Šä¿è¯æ‰‹æœºä¸å…³æœºå¹¶ä¸”æ²¡æœ‰é™éŸ³ã€‚\nå¦‚ä½•é¿å…å†æ¬¡å‡ºç°è¿™æ ·çš„æƒ…å†µå‘¢ï¼Ÿä¸€æ˜¯é€šè¿‡ç”µè¯æˆ–è€…ä¾¿æ¡çš„å½¢å¼æé†’è½¦ä¸»è¦åœ¨è½¦ä¸Šç•™ä¸€ä¸ªæŒªè½¦ç”µè¯å¹¶ä¿è¯ç”µè¯ç•…é€šï¼ŒäºŒæ˜¯åé¦ˆç»™ç‰©ä¸šè®©ç‰©ä¸šæ¥æé†’å°åŒºé‡Œçš„è½¦ä¸»ä¸è¦éšæ„å ç”¨è½¦é“ã€‚\nå¼€è½¦æ€»ç»“ å­¦åˆ°äº†æ–°çŸ¥è¯†ï¼š\nå­¦ä¼šäº†å¦‚ä½•è°ƒèŠ‚å‰ç¯çš„é«˜åº¦ã€‚æ•°å­—è¶Šå¤§ï¼Œç¯å…‰ç…§å°„çš„è¶Šè¿‘ã€‚ å¼€è½¦éœ€è¦æ”¹è¿›çš„åœ°æ–¹ï¼š\n1ã€ä»Šå¤©åœ¨èœåœºç‚¹ç«çš„æ—¶å€™ï¼Œé”™æŠŠæ²¹é—¨å½“åˆ¹è½¦ 2ã€å‡†å¤‡åŠ é€Ÿè¶…è¿‡å·¦è¾¹è´§è½¦çš„æ—¶å€™ï¼Œè´§è½¦æ‰“äº†å³å‰ç¯ï¼Œä¸‹æ„è¯†åœ°æŠŠæ–¹å‘ç›˜å‘å³æ‰“äº†ä¸€ç‚¹ 3ã€é‡åˆ°çº¢ç»¿ç¯å˜é»„ç¯æ—¶ï¼Œåˆ¹è½¦å¤ªæ€¥ã€‚æƒ³å†²è¿‡å»ï¼Œä½†çŠ¹è±«äº†ã€‚è¿™æ ·åšå¤ªå±é™©ï¼Œä¸èƒ½å­˜åœ¨ä¾¥å¹¸å¿ƒç†ã€‚ä¸‹æ¬¡é‡åˆ°è¿™ç§æƒ…å†µï¼Œå®å¯æå‰åˆ¹è½¦ï¼Œç­‰çº¢ç¯è¿‡äº†ï¼Œå†å‘å‰è¡Œé©¶ã€‚ å¥½ç‰©åˆ†äº« è™½ç„¶å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€ChenSoul Shareã€Telegram é¢‘é“ï¼Œä¸è¿‡è¿˜æ˜¯æŒ‘é€‰ä¸€éƒ¨åˆ†åœ¨è¿™é‡Œåˆ—ä¸¾ä¸€ä¸‹ï¼Œæ„Ÿè§‰æ›´åƒä¸€ä¸ª newsletter äº†ã€‚\nä¸€äº›æ–‡ç«  åšäº† 6 å¹´ç¨‹åºå‘˜ï¼Œæˆ‘å­¦åˆ°çš„ 10 æ¡ç»éªŒ\nJetBrains å¸¸ç”¨æ’ä»¶\nv2ray + warp-go éå…¨å±€ä½¿ç”¨ Cloudflare WARP è§£é” New Bing ç­‰æœåŠ¡\nå¦‚ä½•åˆ›å»ºå±äºè‡ªå·±çš„ç§äººèµ„æ–™åº“ä¸ç§äººæœç´¢å¼•æ“ _\nå¦‚ä½•é«˜æ•ˆåœ°åä½œå¼€å‘ï¼šä¸€äº› Google çš„å®è·µ\nJava é«˜æ€§èƒ½ç¼“å­˜åº“ Caffeine\nä¸€äº›å·¥å…· ä¼˜è®¾å¯¼èˆªå®˜ç½‘ï¼šè®¾è®¡å¯¼èˆª 2013 å¹´ä¸Šçº¿è‡³ä»Šï¼Œæ˜¯ä¼˜è®¾ç½‘æ——ä¸‹æœ€ä¸“ä¸šå¥½ç”¨çš„è®¾è®¡å¸ˆå¯¼èˆªç½‘ç«™ï¼è®¾è®¡å¯¼èˆªä¸ºè®¾è®¡å¸ˆæä¾› UI è®¾è®¡ã€è®¾è®¡æ•™ç¨‹ã€ç´ æä¸‹è½½ã€é«˜æ¸…å›¾åº“ã€é…è‰²æ–¹æ¡ˆã€App è®¾è®¡ã€ç½‘é¡µè®¾è®¡ç­‰è®¾è®¡ç½‘ç«™å¯¼èˆªæŒ‡å¼•ã€‚è®¾è®¡å¯¼èˆªæ¯å‘¨æ›´æ–°ï¼Œè®¾è®¡é£å‘æ ‡å°±çœ‹ä¼˜è®¾ç½‘ï¼\nZeabur å±äºå›½äººçš„å…è´¹æ‰˜ç®¡å¹³å°\nNeovim ä½¿ç”¨ä½“éªŒ\nGithub Copilot å…è´¹å¹³æ›¿ - Codeium\nChat with documents\nCodeiumï¼šä¸€æ¬¾å…è´¹çš„ç±» Github Copilot çš„ AI ä»£ç è¾…åŠ©äº§å“ï¼Œå¯ä»¥ä¾¿æ·çš„å’Œ AI è¿›è¡Œç»“å¯¹ç¼–ç¨‹ã€‚åˆæ­¥ä½¿ç”¨ä¸‹æ¥å’Œä¸»æµçš„ IDE çš„é›†æˆå¾ˆå¥½ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å…ˆåˆ°æµè§ˆå™¨é‡Œåœ¨çº¿å°è¯•ä¸€ç•ªã€‚\nä¸€äº›è§†é¢‘ é£šé€Ÿå®…ç”·ç¬¬äº”å­£ é­”å¥³ ä»¥ä¸Šã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/03/28/weekly_review_12/","summary":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-03-20 åˆ° 2023-03-26 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nä¸Šå‘¨å»åŒæµåŒ»é™¢æ£€æŸ¥é¼¾ç—‡ï¼Œæ£€æŸ¥ç»“æœæ˜¯è½»åº¦ç—‡çŠ¶ï¼ŒåŒ»ç”Ÿå»ºè®®å¤šè¿åŠ¨å‡è‚¥ã€‚è¿™å‘¨æ¯å¤©èµ°è·¯ 1 ä¸‡æ­¥çš„ç›®æ ‡å·²è¾¾æˆã€‚\nå·¥ä½œä¸Šå‘å¸ƒäº†ä¸€ä¸ªç‰ˆæœ¬ï¼Œå¦å¤–ä¸¤ä¸ªè¿­ä»£æ­£åœ¨è¿›è¡Œä¸­ï¼Œé¢„è®¡è¿™å‘¨å†å‘å¸ƒä¸€ä¸ªç‰ˆæœ¬ã€‚ä»é£ä¹¦é€šè®¯å½•çœ‹åˆ°åˆæœ‰ä¸‰ä¸ªéæŠ€æœ¯ç±»åŒäº‹è¢«è£ï¼Œè¿™å‘¨å‘¨ä¼šï¼Œéƒ¨é—¨é¢†å¯¼è¯´æœ€è¿‘åˆæœ‰ä¸€ä¸ªåšå•†åŠ¡çš„åŒäº‹è¢«ä¼˜åŒ–äº†ã€‚\nä¸Šå‘¨æœ‰ä¸€å¤©æ—©ä¸Šï¼Œè½¦å­åœåœ¨å°åŒºé‡Œé¢ï¼Œè¢«ä¸¤ä¸ªè½¦å­æŒ¡ä½äº†å‰åé“è·¯ï¼Œè”ç³»ä¸ä¸Šè½¦ä¸»ï¼Œåªå¥½ååœ°é“ä¸Šç­ã€‚è¯è¯´ï¼Œè‡ªä»å¼€è½¦ä¸Šç­ä¹‹åï¼Œä½¿ç”¨æ‰‹æœºçš„é¢‘ç‡æ˜æ˜¾é™ä½äº†å¾ˆå¤šã€‚\nä¸Šå‘¨æœ«é˜³å…‰æ­£å¥½ï¼Œäºæ˜¯å›å®¶å»ç»™å·²æ•…çš„äº²äººæ‰«å¢“ã€‚å‘¨å…­å›è€å®¶ï¼Œå‘¨æ—¥å›è€å©†å®¶ã€‚é€è€…å·²é€ï¼Œæ´»ç€çš„äººè¦å–„å¾…è‡ªå·±ï¼Œå¥½å¥½åƒé¥­ï¼Œå¥½å¥½ç¡è§‰ï¼Œå¥½å¥½å·¥ä½œï¼Œå¥½å¥½è¿åŠ¨ã€‚\nå·¥ä½œ Effective Java 3 ç¬”è®° è¯·å‚è€ƒ ã€ŠEffective Java 3ã€‹ç¬”è®°ï¼šé™æ€å·¥å‚æ–¹æ³•ä»£æ›¿æ„é€ å‡½æ•°ã€‚\nMachine-Learning-With-Go B ç«™è§†é¢‘ï¼šã€Œè¯¾ç¨‹ã€ä½¿ç”¨ Go åšæœºå™¨å­¦ä¹ \næºä»£ç ï¼šMachine-Learning-With-Go\nç”Ÿæ´» è½¦è¾†è¢«å µ æ—©ä¸Šå‡†å¤‡å¼€è½¦ä¸Šç­ï¼Œå‘ç°è½¦å­å‰åé“è·¯éƒ½è¢«è½¦è¾†å é“äº†ã€‚å‰é¢è½¦è¾†å é“ï¼Œæ˜¨å¤©æ™šä¸Šä¸‹ç­å›æ¥å°±å‘ç°äº†ï¼Œä¹Ÿç¡®è®¤äº†è¿™ä¸ªè½¦è¾†æ²¡æœ‰ç•™æŒªè½¦ç”µè¯ã€‚å½“æ—¶å°±éšéšæ‹…å¿§ä»Šå¤©æ—©ä¸Šä¼šè¢«æŒ¡ä½å‰åé“è·¯ã€‚æ²¡æœ‰æƒ³åˆ°ï¼ŒçœŸçš„è¢«æŒ¡äº†ã€‚åé¢çš„è½¦è¾†ç•™äº†æŒªè½¦ç”µè¯ã€‚å…­ç‚¹åŠå¼€å§‹ï¼Œæˆ‘å°±ç»™åé¢è½¦çš„è½¦ä¸»æ‰“ç”µè¯å‘çŸ­ä¿¡ï¼Œå¯¹æ–¹ä¸€ç›´æ²¡æ¥ç”µè¯ï¼Œä¼°è®¡æ‰‹æœºè°ƒé™éŸ³è¿˜åœ¨ç¡è§‰å§ã€‚æ²¡æœ‰æƒ³åˆ°çš„æ˜¯ï¼Œæˆªæ­¢åˆ°ç°åœ¨æ—¶é—´å…«ç‚¹ï¼Œä»–è¿˜æ²¡æœ‰ç»™æˆ‘å›ç”µè¯ï¼Œè¿™å“¥ä»¬ç¡å¾—é‚£æ˜¯çœŸé¦™å•Šã€‚\nåœ¨é“è·¯è¢«å ç”¨ä¹‹åï¼Œæˆ‘åšäº†ä»€ä¹ˆï¼Ÿé™¤äº†ç»™ç•™äº†å·ç çš„é‚£ä¸ªè½¦ä¸»æ‰“ç”µè¯ä¹‹å¤–ï¼Œæˆ‘è¿˜æƒ³åˆ°äº¤ç®¡ 12123 APP ä¸Šé¢æœ‰ä¸€ä¸ªä¸€é”®æŒªè½¦åŠŸèƒ½ã€‚äºæ˜¯ï¼Œè¯•äº†ä¸€ä¸‹è¿™ä¸ªåŠŸèƒ½ã€‚åŸä»¥ä¸ºè¿™ä¸ªåŠŸèƒ½å¯ä»¥ç”µè¯é€šçŸ¥åˆ°å¯¹æ–¹æŒªè½¦ã€‚å®é™…æƒ…å†µå´åªæ˜¯æäº¤äº†ä¸€ä¸ªå·¥å•è€Œå·²ï¼ŒçœŸæ˜¯ä¸€ä¸ªé¸¡è‚‹çš„åŠŸèƒ½ã€‚ç”¨æˆ·ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Œæ˜¯å¸Œæœ›åŠæ—¶è”ç³»åˆ°è½¦ä¸»è¿‡æ¥æŒªè½¦ï¼Œè€Œä¸æ˜¯æäº¤ä¸€ä¸ªå·¥å•ä¹‹åï¼Œå‚»å‚»çš„ç­‰å¾…ã€‚å¦å¤–ï¼Œè¿™ä¸ªåŠŸèƒ½ä¹Ÿä¸èƒ½å«ä¸€é”®æŒªè½¦ï¼Œå› ä¸ºç‚¹å‡»äº†è¿™ä¸ªåŠŸèƒ½ä¹‹åï¼Œè¿˜è¦è¾“å…¥è½¦ç‰Œå·ã€ä¸Šä¼ ç…§ç‰‡ã€‚æ›´å¥½çš„ä½“éªŒåº”è¯¥æ˜¯åªç”¨ä¸Šä¼ å ç”¨é“è·¯çš„è½¦è¾†ç…§ç‰‡ï¼Œç”±ç³»ç»Ÿè¯†åˆ«å‡ºè½¦ç‰Œå·ï¼Œç„¶ååå°æ‰¾åˆ°è½¦ä¸»çš„æ‰‹æœºå·ï¼Œç”Ÿæˆä¸€ä¸ªä¸´æ—¶å·ç å¹¶è°ƒç”¨æ‰‹æœºçš„æ‹¨å·åŠŸèƒ½ã€‚\nåœ¨é“è·¯è¢«å ç”¨ä¹‹åï¼Œæˆ‘çš„å¿ƒæ€æ˜¯æ€æ ·çš„ï¼Ÿåˆšå¼€å§‹æƒ³ç”Ÿæ°”æ„¤æ€’ï¼Œåæ¥æƒ³äº†æƒ³ï¼Œäº‹å·²è‡³æ­¤ï¼Œæ²¡æœ‰å¿…è¦ç”Ÿæ°”ï¼Œç”Ÿæ°”åªèƒ½å½±å“è‡ªå·±ä¸€å¤©çš„å¿ƒæƒ…å’Œå¥½è¿ã€‚å¹¶å°è¯•æŠŠè¿™ç§å¯¹è‡ªå·±ä¸åˆ©çš„ä¸€é¢è½¬åŒ–ä¸ºå¯¹è‡ªå·±æœ‰åˆ©çš„ä¸€é¢ã€‚åŸæƒ³å…­ç‚¹åŠå¼€è½¦ä¸Šç­ï¼Œé“è·¯è¢«å ä¹‹åï¼Œå°±å¯ä»¥ä½“éªŒä¸€ä¸‹ä¸ƒç‚¹å¤šç”šè‡³å…«ç‚¹å¤šå¼€è½¦ä¸Šç­éœ€è¦å¤šé•¿æ—¶é—´ä»¥åŠæ˜¯å¦å µè½¦ã€‚\nå¦‚æœæ˜¯æˆ‘æŠŠé“è·¯å ç”¨äº†ï¼Œæˆ‘è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿé¦–å…ˆï¼Œæ˜¯è½¦ä¸Šç•™ä¸€ä¸ªæ‰‹æœºå·ç ï¼›å…¶æ¬¡ï¼Œæ˜¯ç¬¬äºŒå¤©æ—©ä¸Šä¿è¯æ‰‹æœºä¸å…³æœºå¹¶ä¸”æ²¡æœ‰é™éŸ³ã€‚\nå¦‚ä½•é¿å…å†æ¬¡å‡ºç°è¿™æ ·çš„æƒ…å†µå‘¢ï¼Ÿä¸€æ˜¯é€šè¿‡ç”µè¯æˆ–è€…ä¾¿æ¡çš„å½¢å¼æé†’è½¦ä¸»è¦åœ¨è½¦ä¸Šç•™ä¸€ä¸ªæŒªè½¦ç”µè¯å¹¶ä¿è¯ç”µè¯ç•…é€šï¼ŒäºŒæ˜¯åé¦ˆç»™ç‰©ä¸šè®©ç‰©ä¸šæ¥æé†’å°åŒºé‡Œçš„è½¦ä¸»ä¸è¦éšæ„å ç”¨è½¦é“ã€‚\nå¼€è½¦æ€»ç»“ å­¦åˆ°äº†æ–°çŸ¥è¯†ï¼š\nå­¦ä¼šäº†å¦‚ä½•è°ƒèŠ‚å‰ç¯çš„é«˜åº¦ã€‚æ•°å­—è¶Šå¤§ï¼Œç¯å…‰ç…§å°„çš„è¶Šè¿‘ã€‚ å¼€è½¦éœ€è¦æ”¹è¿›çš„åœ°æ–¹ï¼š\n1ã€ä»Šå¤©åœ¨èœåœºç‚¹ç«çš„æ—¶å€™ï¼Œé”™æŠŠæ²¹é—¨å½“åˆ¹è½¦ 2ã€å‡†å¤‡åŠ é€Ÿè¶…è¿‡å·¦è¾¹è´§è½¦çš„æ—¶å€™ï¼Œè´§è½¦æ‰“äº†å³å‰ç¯ï¼Œä¸‹æ„è¯†åœ°æŠŠæ–¹å‘ç›˜å‘å³æ‰“äº†ä¸€ç‚¹ 3ã€é‡åˆ°çº¢ç»¿ç¯å˜é»„ç¯æ—¶ï¼Œåˆ¹è½¦å¤ªæ€¥ã€‚æƒ³å†²è¿‡å»ï¼Œä½†çŠ¹è±«äº†ã€‚è¿™æ ·åšå¤ªå±é™©ï¼Œä¸èƒ½å­˜åœ¨ä¾¥å¹¸å¿ƒç†ã€‚ä¸‹æ¬¡é‡åˆ°è¿™ç§æƒ…å†µï¼Œå®å¯æå‰åˆ¹è½¦ï¼Œç­‰çº¢ç¯è¿‡äº†ï¼Œå†å‘å‰è¡Œé©¶ã€‚ å¥½ç‰©åˆ†äº« è™½ç„¶å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€ChenSoul Shareã€Telegram é¢‘é“ï¼Œä¸è¿‡è¿˜æ˜¯æŒ‘é€‰ä¸€éƒ¨åˆ†åœ¨è¿™é‡Œåˆ—ä¸¾ä¸€ä¸‹ï¼Œæ„Ÿè§‰æ›´åƒä¸€ä¸ª newsletter äº†ã€‚\nä¸€äº›æ–‡ç«  åšäº† 6 å¹´ç¨‹åºå‘˜ï¼Œæˆ‘å­¦åˆ°çš„ 10 æ¡ç»éªŒ\nJetBrains å¸¸ç”¨æ’ä»¶\nv2ray + warp-go éå…¨å±€ä½¿ç”¨ Cloudflare WARP è§£é” New Bing ç­‰æœåŠ¡\nå¦‚ä½•åˆ›å»ºå±äºè‡ªå·±çš„ç§äººèµ„æ–™åº“ä¸ç§äººæœç´¢å¼•æ“ _\nå¦‚ä½•é«˜æ•ˆåœ°åä½œå¼€å‘ï¼šä¸€äº› Google çš„å®è·µ\nJava é«˜æ€§èƒ½ç¼“å­˜åº“ Caffeine\nä¸€äº›å·¥å…· ä¼˜è®¾å¯¼èˆªå®˜ç½‘ï¼šè®¾è®¡å¯¼èˆª 2013 å¹´ä¸Šçº¿è‡³ä»Šï¼Œæ˜¯ä¼˜è®¾ç½‘æ——ä¸‹æœ€ä¸“ä¸šå¥½ç”¨çš„è®¾è®¡å¸ˆå¯¼èˆªç½‘ç«™ï¼è®¾è®¡å¯¼èˆªä¸ºè®¾è®¡å¸ˆæä¾› UI è®¾è®¡ã€è®¾è®¡æ•™ç¨‹ã€ç´ æä¸‹è½½ã€é«˜æ¸…å›¾åº“ã€é…è‰²æ–¹æ¡ˆã€App è®¾è®¡ã€ç½‘é¡µè®¾è®¡ç­‰è®¾è®¡ç½‘ç«™å¯¼èˆªæŒ‡å¼•ã€‚è®¾è®¡å¯¼èˆªæ¯å‘¨æ›´æ–°ï¼Œè®¾è®¡é£å‘æ ‡å°±çœ‹ä¼˜è®¾ç½‘ï¼\nZeabur å±äºå›½äººçš„å…è´¹æ‰˜ç®¡å¹³å°\nNeovim ä½¿ç”¨ä½“éªŒ\nGithub Copilot å…è´¹å¹³æ›¿ - Codeium\nChat with documents\nCodeiumï¼šä¸€æ¬¾å…è´¹çš„ç±» Github Copilot çš„ AI ä»£ç è¾…åŠ©äº§å“ï¼Œå¯ä»¥ä¾¿æ·çš„å’Œ AI è¿›è¡Œç»“å¯¹ç¼–ç¨‹ã€‚åˆæ­¥ä½¿ç”¨ä¸‹æ¥å’Œä¸»æµçš„ IDE çš„é›†æˆå¾ˆå¥½ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å…ˆåˆ°æµè§ˆå™¨é‡Œåœ¨çº¿å°è¯•ä¸€ç•ªã€‚","title":"å‘¨æŠ¥-12ï½œè½¦è¾†è¢«å µã€å¼€è½¦æ€»ç»“ã€Effective Java3ç¬”è®°"},{"content":"å‰è¨€ å›¾ç‰‡ï¼šæ¶¨æ¸¡æ¹–æ¹¿åœ°æ°´ä¸Šæ£®æ—å…¬å›­\næœ¬ç¯‡æ˜¯å¯¹ 2023-03-13 åˆ° 2023-03-19 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¿™å‘¨çš„å·¥ä½œä¸»è¦æ˜¯é‡æ„ã€ä¼˜åŒ–ç³»ç»Ÿï¼Œå·¥ä½œèŠ‚å¥æ¯”ä¹‹å‰è½»ç¼“äº†å¾ˆå¤šã€‚è¿™å‘¨ä¹Ÿå¼€å§‹äº†å¼€è½¦ä¸Šä¸‹ç­ï¼Œé™¤å»å‘¨äº”å»åŒ»é™¢åšæ£€æŸ¥ï¼Œä¸€å…±å¼€äº† 4 å¤©è½¦ã€‚ä»æ±‰å£åˆ°å…‰è°·ï¼Œä¸€å…± 29 å…¬é‡Œï¼Œå¦‚æœæ—©ä¸Š 6:30 å‡ºå‘ï¼Œå°±åªéœ€è¦ 50 åˆ†é’Ÿï¼›å¦‚æœ 6:45 å‡ºå‘ï¼Œç«Ÿç„¶éœ€è¦ä¸¤ä¸ªå°æ—¶ï¼ŒçœŸæ˜¯æ— è¯­äº†ã€‚æ— å¥ˆä¹‹ä¸‹ï¼Œåªèƒ½æ¯å¤©æ—©ç‚¹å‡ºé—¨æ—©ç‚¹åˆ°å…¬å¸ï¼Œç„¶åï¼Œæ‰“å®Œå¡ä¹‹åï¼Œåœ¨å…¬å¸æ¥¼ä¸‹èµ°è·¯ã€‚\nè¿™å‘¨å¼€å§‹å¿ƒé‡Œé»˜é»˜å®šäº†ä¸€ä¸ª flagï¼Œå°±æ˜¯æ¯å¤©èµ°è·¯ 10000 æ­¥ã€‚çœ‹äº†ä¸€ä¸‹å¾®ä¿¡è¿åŠ¨ï¼ŒåŸºæœ¬ä¸Šè¾¾æˆäº†ï¼Œé™¤äº†å‘¨äº”æ™šä¸Šå› ä¸ºåŠ ç­ï¼Œè€Œå°‘èµ°äº† 64 æ­¥ã€‚\nä»è¯­é›€è¿ç§»åˆ° Obsidian ä¸Šå‘¨æåˆ°å¼€å§‹ä½¿ç”¨æ ¼å¿— APP æ¥å†™æ—¥å¿—ï¼Œä½¿ç”¨äº†ä¸€æ®µæ—¶é—´ä¹‹åï¼Œå‘ç°äº†ä¸€äº›ç¼ºç‚¹ï¼š\néƒ¨åˆ†åŠŸèƒ½æ”¶è´¹ å¯¼å‡ºçš„ markdown ä¸æ”¯æŒå›¾ç‰‡æ˜¾ç¤º ä¸æ”¯æŒæœ¬åœ°å­˜å‚¨ äºæ˜¯ï¼Œæ”¾å¼ƒäº†ä½¿ç”¨æ ¼å¿— APPï¼Œç»§è€Œåœ¨ä½¿ç”¨äº†ä¸€æ®µæ—¶é—´ Obsidian ä¹‹åï¼Œæ”¹ä¸ºä½¿ç”¨ Obsidian æ¥å†™æ—¥å¿—å’Œå‘¨æŠ¥ã€‚\nä¸ºäº†ä¸ç»™è‡ªå·±å¤ªå¤§å‹åŠ›ï¼Œæ—¥æŠ¥æ¯å¤©å¤ç›˜å†…å®¹åŒ…æ‹¬ä»¥ä¸‹å‡ æ–¹é¢ï¼š\nä»Šæ—¥å¾…åŠ\nå­¦ä¹ \nå·¥ä½œ\nç”Ÿæ´»\nå¥èº«\nå¯¼å‡ºè¯­é›€æ–‡æ¡£ä¸º markdown å‚è€ƒ yuque/yuque-exporter æ–‡æ¡£ï¼Œä¸‹è½½ yuque-exporter ä¹‹åè¿›è¡Œå¯¼å‡ºæ“ä½œï¼Œå‘ç°ä»¥ä¸‹é—®é¢˜ï¼š\nè¯¥é¡¹ç›®éœ€è¦ä½¿ç”¨çš„ nodejs ç‰ˆæœ¬ä¸º 18.0.4 nodejs ä½¿ç”¨æ­£ç¡®çš„ç‰ˆæœ¬è¿˜æ˜¯å¯¼å‡ºå¤±è´¥ äºæ˜¯ï¼Œæ”¹ä¸ºä½¿ç”¨æºç ç¼–è¯‘å’Œè¿è¡Œå¯¼å‡ºã€‚\n1ã€å…ˆä¸‹è½½ä»£ç ï¼š\ngit clone https://github.com/yuque/yuque-exporter.git 2ã€ä¿®æ”¹ main.ts ä¸­éœ€è¦å¯¼å‡ºçš„è¯­é›€çŸ¥è¯†åº“åœ°å€ä¸ºè‡ªå·±çš„ä»“åº“åœ°å€ï¼š\n// Determining if an ESM module is main then run the code if (import.meta.url.startsWith(\u0026#34;file:\u0026#34;)) { const modulePath = fileURLToPath(import.meta.url); if (process.argv[1] === modulePath) { const urlPaths = [\u0026#34;chensoul/rose\u0026#34;, \u0026#34;chensoul/growup\u0026#34;, \u0026#34;chensoul/tech\u0026#34;]; await start({ urlPaths }); } } 3ã€å‚è€ƒ æ–‡æ¡£ ç”³è¯·è¯­é›€ TOKENã€‚\n4ã€ä¸‹è½½é¡¹ç›®ä¾èµ–ï¼š\nnpm i 5ã€è¿è¡Œé¡¹ç›®ï¼Œå¼€å§‹å¯¼å‡ºï¼š\nYUQUE_TOKEN=XXXXXX npm start å¯¼å‡ºçš„æ–‡ä»¶åœ¨ storage ç›®å½•ï¼Œæ¥ä¸‹æ¥å¯ä»¥æ‹·è´åˆ° Obsidian ç›®å½•é‡Œã€‚\n6ã€å¦å¤–ï¼Œå¯ä»¥å¯¹ yuque-exporter æºç åšä¸€äº›ä¿®æ”¹ï¼š\nå¯¼å‡ºçš„ markdown æ–‡ä»¶ä¸è¦æœ‰ frontmatterï¼Œä¿®æ”¹ doc.ts ä¸­ buildDoc æ–¹æ³•ï¼š export async function buildDoc( doc: TreeNode, mapping: Record\u0026lt;string, TreeNode\u0026gt; ) { const docDetail = await readJSON( path.join(metaDir, doc.namespace, \u0026#34;docs\u0026#34;, `${doc.url}.json`) ); const content = await remark() .data(\u0026#34;settings\u0026#34;, { bullet: \u0026#34;-\u0026#34;, listItemIndent: \u0026#34;one\u0026#34; }) .use([ [replaceHTML], [relativeLink, { doc, mapping }], [downloadAsset, { doc, mapping }], ]) .process(docDetail.body); // doc.content = frontmatter(doc) + content.toString(); doc.content = content.toString(); // FIXME: remark will transform `*` to `\\*` doc.content = doc.content.replaceAll(\u0026#34;\\\\*\u0026#34;, \u0026#34;*\u0026#34;); return doc; } å¯¼å‡ºçš„æ®µè½ä¹‹é—´å¢åŠ æ¢è¡Œï¼Œä¿®æ”¹ doc.ts ä¸­ replaceHTML æ–¹æ³•ï¼š function replaceHTML() { return (tree) =\u0026gt; { const htmlNodes = selectAll(\u0026#34;html\u0026#34;, tree) as Text[]; for (const node of htmlNodes) { if (node.value === \u0026#34;\u0026lt;br /\u0026gt;\u0026#34; || node.value === \u0026#34;\u0026lt;br/\u0026gt;\u0026#34;) { node.type = \u0026#34;text\u0026#34;; node.value = \u0026#34;\\n\\n\\n\u0026#34;; } } }; } 7ã€åˆ é™¤å¯¼å‡ºçš„ markdown æ–‡ä»¶å½“ä¸­çš„é”šç‚¹æ ‡ç­¾ï¼ˆä¾‹å¦‚ï¼š\u0026lt;a name=\u0026quot;xx\u0026quot;\u0026gt;\u0026lt;/a\u0026gt;ï¼‰\ncd storage # macos ä¸Šæ‰§è¡Œ find . -type f -name \u0026#39;*.md\u0026#39; -exec sed -i \u0026#39;\u0026#39; \u0026#39;s/\u0026lt;a name=\\\u0026#34;[^\\\u0026#34;]*\\\u0026#34;\u0026gt;\u0026lt;\\/a\u0026gt;//g\u0026#39; {} + åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† sed å‘½ä»¤æ¥åˆ é™¤ Markdown æ–‡ä»¶ä¸­æ‰€æœ‰çš„ç±»ä¼¼ \u0026lt;a name=\u0026quot;xx\u0026quot;\u0026gt;\u0026lt;/a\u0026gt; çš„é”šç‚¹æ ‡ç­¾ã€‚å…¶ä¸­ï¼š\n-i '' å‚æ•°è¡¨ç¤ºç›´æ¥ä¿®æ”¹æºæ–‡ä»¶ï¼Œè€Œä¸æ˜¯è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºæµã€‚'' è¡¨ç¤ºåœ¨ macOS ç³»ç»Ÿä¸Šå¤‡ä»½ä¿®æ”¹å‰çš„æ–‡ä»¶ï¼Œå¦‚æœåœ¨ Linux ç³»ç»Ÿä¸Šä½¿ç”¨è¯¥å‘½ä»¤ï¼Œå¯ä»¥çœç•¥è¯¥å‚æ•°ã€‚ s/\u0026lt;a name=\\\u0026quot;[^\\\u0026quot;]*\\\u0026quot;\u0026gt;\u0026lt;\\/a\u0026gt;//g è¡¨ç¤ºç”¨ç©ºå­—ç¬¦ä¸²æ›¿æ¢æ‰€æœ‰ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼ \u0026lt;a name=\\\u0026quot;[^\\\u0026quot;]*\\\u0026quot;\u0026gt;\u0026lt;\\/a\u0026gt; çš„å­—ç¬¦ä¸²ã€‚è¯¥æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ‰€æœ‰ä»¥ \u0026lt;a name= å¼€å¤´ï¼Œä»¥ \u0026quot;\u0026gt;\u0026lt;/a\u0026gt; ç»“å°¾çš„æ ‡ç­¾ï¼Œä¸”ä¸­é—´çš„æ–‡æœ¬ä¸åŒ…å«åŒå¼•å·ã€‚ 8ã€å°†å¯¼å‡ºçš„ markdown æ–‡ä»¶ä¸­çš„æœ¬åœ°å›¾ç‰‡æ‰¹é‡ä¸Šä¼ åˆ°å›¾åºŠï¼Œæ“ä½œæ–¹æ³•ï¼šä½¿ç”¨ typora æ‰“å¼€ storage ç›®å½•ï¼Œç„¶åä¾æ¬¡ç‚¹å‡» æ ¼å¼ã€å›¾åƒã€ä¸Šä¼ æ‰€æœ‰æœ¬åœ°å›¾ç‰‡\nå¥½ç‰©åˆ†äº« è™½ç„¶å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€ChenSoul Shareã€Telegram é¢‘é“ï¼Œä¸è¿‡è¿˜æ˜¯æŒ‘é€‰ä¸€éƒ¨åˆ†åœ¨è¿™é‡Œåˆ—ä¸¾ä¸€ä¸‹ï¼Œæ„Ÿè§‰æ›´åƒä¸€ä¸ª newsletter äº†ã€‚\nä¸€äº›æ–‡ç«  GitHub Actions æˆæœ¬ä¼˜åŒ–ï¼šè®©ä½ çš„å›¢é˜Ÿæ›´å…·ç«äº‰åŠ›\nNginx å¼€å¯ gzip å‹ç¼©\nObsidan æ—¥è®°ã€è®°è´¦ä¸è‡ªåŠ¨åŒæ­¥\nDoprax æ­å»ºå…è´¹ V2ray èŠ‚ç‚¹\nHiï¼ŒåœŸåŒº iCloud\nå›½åŒºä½¿ç”¨åœŸè€³å…¶ iCloud æœåŠ¡ï¼Œæ‰‹æŠŠæ‰‹ä¿å§†çº§ä¸Šè½¦æ•™ç¨‹\nä»¥ä¸Šã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/03/20/weekly_review_11/","summary":"å‰è¨€ å›¾ç‰‡ï¼šæ¶¨æ¸¡æ¹–æ¹¿åœ°æ°´ä¸Šæ£®æ—å…¬å›­\næœ¬ç¯‡æ˜¯å¯¹ 2023-03-13 åˆ° 2023-03-19 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¿™å‘¨çš„å·¥ä½œä¸»è¦æ˜¯é‡æ„ã€ä¼˜åŒ–ç³»ç»Ÿï¼Œå·¥ä½œèŠ‚å¥æ¯”ä¹‹å‰è½»ç¼“äº†å¾ˆå¤šã€‚è¿™å‘¨ä¹Ÿå¼€å§‹äº†å¼€è½¦ä¸Šä¸‹ç­ï¼Œé™¤å»å‘¨äº”å»åŒ»é™¢åšæ£€æŸ¥ï¼Œä¸€å…±å¼€äº† 4 å¤©è½¦ã€‚ä»æ±‰å£åˆ°å…‰è°·ï¼Œä¸€å…± 29 å…¬é‡Œï¼Œå¦‚æœæ—©ä¸Š 6:30 å‡ºå‘ï¼Œå°±åªéœ€è¦ 50 åˆ†é’Ÿï¼›å¦‚æœ 6:45 å‡ºå‘ï¼Œç«Ÿç„¶éœ€è¦ä¸¤ä¸ªå°æ—¶ï¼ŒçœŸæ˜¯æ— è¯­äº†ã€‚æ— å¥ˆä¹‹ä¸‹ï¼Œåªèƒ½æ¯å¤©æ—©ç‚¹å‡ºé—¨æ—©ç‚¹åˆ°å…¬å¸ï¼Œç„¶åï¼Œæ‰“å®Œå¡ä¹‹åï¼Œåœ¨å…¬å¸æ¥¼ä¸‹èµ°è·¯ã€‚\nè¿™å‘¨å¼€å§‹å¿ƒé‡Œé»˜é»˜å®šäº†ä¸€ä¸ª flagï¼Œå°±æ˜¯æ¯å¤©èµ°è·¯ 10000 æ­¥ã€‚çœ‹äº†ä¸€ä¸‹å¾®ä¿¡è¿åŠ¨ï¼ŒåŸºæœ¬ä¸Šè¾¾æˆäº†ï¼Œé™¤äº†å‘¨äº”æ™šä¸Šå› ä¸ºåŠ ç­ï¼Œè€Œå°‘èµ°äº† 64 æ­¥ã€‚\nä»è¯­é›€è¿ç§»åˆ° Obsidian ä¸Šå‘¨æåˆ°å¼€å§‹ä½¿ç”¨æ ¼å¿— APP æ¥å†™æ—¥å¿—ï¼Œä½¿ç”¨äº†ä¸€æ®µæ—¶é—´ä¹‹åï¼Œå‘ç°äº†ä¸€äº›ç¼ºç‚¹ï¼š\néƒ¨åˆ†åŠŸèƒ½æ”¶è´¹ å¯¼å‡ºçš„ markdown ä¸æ”¯æŒå›¾ç‰‡æ˜¾ç¤º ä¸æ”¯æŒæœ¬åœ°å­˜å‚¨ äºæ˜¯ï¼Œæ”¾å¼ƒäº†ä½¿ç”¨æ ¼å¿— APPï¼Œç»§è€Œåœ¨ä½¿ç”¨äº†ä¸€æ®µæ—¶é—´ Obsidian ä¹‹åï¼Œæ”¹ä¸ºä½¿ç”¨ Obsidian æ¥å†™æ—¥å¿—å’Œå‘¨æŠ¥ã€‚\nä¸ºäº†ä¸ç»™è‡ªå·±å¤ªå¤§å‹åŠ›ï¼Œæ—¥æŠ¥æ¯å¤©å¤ç›˜å†…å®¹åŒ…æ‹¬ä»¥ä¸‹å‡ æ–¹é¢ï¼š\nä»Šæ—¥å¾…åŠ\nå­¦ä¹ \nå·¥ä½œ\nç”Ÿæ´»\nå¥èº«\nå¯¼å‡ºè¯­é›€æ–‡æ¡£ä¸º markdown å‚è€ƒ yuque/yuque-exporter æ–‡æ¡£ï¼Œä¸‹è½½ yuque-exporter ä¹‹åè¿›è¡Œå¯¼å‡ºæ“ä½œï¼Œå‘ç°ä»¥ä¸‹é—®é¢˜ï¼š\nè¯¥é¡¹ç›®éœ€è¦ä½¿ç”¨çš„ nodejs ç‰ˆæœ¬ä¸º 18.0.4 nodejs ä½¿ç”¨æ­£ç¡®çš„ç‰ˆæœ¬è¿˜æ˜¯å¯¼å‡ºå¤±è´¥ äºæ˜¯ï¼Œæ”¹ä¸ºä½¿ç”¨æºç ç¼–è¯‘å’Œè¿è¡Œå¯¼å‡ºã€‚\n1ã€å…ˆä¸‹è½½ä»£ç ï¼š\ngit clone https://github.com/yuque/yuque-exporter.git 2ã€ä¿®æ”¹ main.ts ä¸­éœ€è¦å¯¼å‡ºçš„è¯­é›€çŸ¥è¯†åº“åœ°å€ä¸ºè‡ªå·±çš„ä»“åº“åœ°å€ï¼š\n// Determining if an ESM module is main then run the code if (import.meta.url.startsWith(\u0026#34;file:\u0026#34;)) { const modulePath = fileURLToPath(import.meta.url); if (process.argv[1] === modulePath) { const urlPaths = [\u0026#34;chensoul/rose\u0026#34;, \u0026#34;chensoul/growup\u0026#34;, \u0026#34;chensoul/tech\u0026#34;]; await start({ urlPaths }); } } 3ã€å‚è€ƒ æ–‡æ¡£ ç”³è¯·è¯­é›€ TOKENã€‚","title":"å‘¨æŠ¥-11ï½œä»è¯­é›€è¿ç§»åˆ°Obsidian"},{"content":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-03-06 åˆ° 2023-03-12 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¿™å‘¨å‘ç° VPS ä¸Š æŸäº›ä½¿ç”¨ docker éƒ¨ç½²çš„æœåŠ¡ï¼ˆcusdisã€umamiã€uptimeã€n8nã€rsshubã€memosï¼‰å›½å†…ç”¨æˆ·æ— æ³•è®¿é—®äº†ï¼Œäºæ˜¯å°±æŠ˜è…¾äº†ä¸€ä¸‹ä½¿ç”¨ Cloudflare Tunnel æ¥ä»£ç†è¿™äº›æœåŠ¡ã€‚é…ç½®æˆåŠŸä¹‹åï¼Œåˆå‘ç°æœ¬åœ°å¦‚æœå¼€å¯ VPNï¼ŒCloudflare Tunnel ä»£ç†çš„åŸŸåè¿˜æ˜¯æ— æ³•è®¿é—®ï¼Œäºæ˜¯æ”¾å¼ƒäº†ä½¿ç”¨ Cloudflare Tunnelï¼Œæ”¹ä¸ºå°†è¿™äº›å›½å†…æ— æ³•è®¿é—®çš„æœåŠ¡éƒ¨ç½²åˆ°å…è´¹çš„ VPS æœåŠ¡å™¨ä¸Šï¼Œæ¯”å¦‚ï¼šRailwayã€Vercelã€‚\nè¿™å‘¨å·¥ä½œå¿™å®Œä¹‹åï¼Œå°±å¼€å§‹ç€æ‰‹é€šçŸ¥ç³»ç»Ÿçš„é‡æ„æ”¹é€ æœåŠ¡ï¼Œæƒ³ç€ chatgpt è¿™ä¹ˆç«ï¼Œäºæ˜¯å°±è¯•è¯•è®©å®ƒæ¥å†™ä»£ç ã€‚åœ¨ä¸æ–­åœ°ä¿®æ”¹éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œchatgpt å†™å‡ºæ¥çš„ä»£ç ç¨åŠ è°ƒæ•´é€æ¸å¯ä»¥ä½¿ç”¨äº†ã€‚\nå‘¨å…­ä»æ±‰å£å¼€è½¦å»ç™½æ²™æ´²æ¹–åŒ—è´¢ç¨èŒä¸šå­¦é™¢ï¼Œå…¨ç¨‹ 20 å…¬é‡Œï¼Œå›æ¥çš„æ—¶å€™ä¸å°å¿ƒæŠŠè·¯è¾¹çš„é¢åŒ…è½¦æ“¦ç¢°äº†ä¸€ä¸‹ã€‚äºæ˜¯ä¸€è„¸æ‡µçš„ç»å†äº†ä¸€æ¬¡ä¿é™©å®šæŸç»´ä¿®ã€‚\nå‘¨å…­å¼€å§‹ä½¿ç”¨ æ ¼å¿— APP å†™æ—¥å¿—ï¼Œé€‰æ‹©å®ƒæ¥è®°å½•æ—¥å¿—çš„åŸå› æ˜¯å®ƒæ”¯æŒæ‰¹é‡å¯¼å‡º mardkownã€pdfã€å›¾ç‰‡ç­‰ã€‚å”¯ä¸€æœ‰ä¸ªå°é—æ†¾çš„æ˜¯ï¼Œè¿™ä¸ªåº”ç”¨æ²¡æœ‰å›¾åºŠï¼Œå¯¼å‡ºçš„ markdown æ–‡ä»¶é‡Œé¢å›¾ç‰‡çš„é“¾æ¥ä¸æ˜¯ http åè®®ã€‚\nå‘¨æ—¥å»æ–°è£é¾™æ¹–å¤©è€€å¤©è¡—å”®æˆ¿éƒ¨çœ‹äº†ä¸€ä¸‹æˆ¿å­ã€‚107 å¹³ä¸‰å®¤ä¸¤å…ä¸¤å«ï¼Œå•ä»· 2 ä¸‡ 5 å¸¦ç²¾è£…ä¿®ï¼Œå…¬ç§¯é‡‘è´·æ¬¾ 90 ä¸‡ï¼Œå•†ä¸šè´·æ¬¾ 30 å¹´ï¼Œæ¯ä¸ªæœˆæˆ¿è´· 6000ã€‚ç›®å‰æ¥è¯´ï¼Œä¹°ä¸èµ·è¿™é‡Œçš„æˆ¿å­ï¼Œä½†æ˜¯ï¼Œä½œä¸ºä¸€ä¸ªä¹°æˆ¿ç›®æ ‡è¿˜æ˜¯å¯ä»¥çš„ï¼ŒåŠ æ²¹ï¼\nå¼€è½¦æ€»ç»“ æœ€è¿‘åˆ·è§†é¢‘ï¼Œæ€»ç»“çš„ä¸€äº›å¼€è½¦ç»éªŒå¦‚ä¸‹ï¼š\næå‰é¢„åˆ¤ï¼Œå‰é¢è½¦å­åˆ¹è½¦ï¼Œä¸ç®¡æ˜¯æ­£å‰æ–¹ï¼Œè¿˜æ˜¯å·¦å³å‰æ–¹ï¼Œè¿™æ—¶å€™ä¹Ÿè¦åˆ¹è½¦\nå‰é¢æœ‰å¤§è´§è½¦ï¼Œä¸è¦ä»å³è¾¹è¶…è½¦\nä¼šè½¦æ—¶ï¼Œçœ‹è·¯å®½\nä¸è¦è¿ç»­å˜é“ï¼Œå˜é“æ—¶æ—¢è¦çœ‹åè§†é•œï¼Œåˆè¦çœ‹çª—è¾¹\nçº¢ç¯è·¯å£å³è½¬æ—¶ï¼Œè¦çœ‹åœ°é¢æˆ–è€…è·¯è¾¹æ˜¯å¦æœ‰ç¦æ­¢å³è½¬æ ‡è¯†\né€šè¿‡ Cloudflare Tunnel è®¿é—®æœåŠ¡ ä»¥ä¸‹å†…å®¹å‚è€ƒ åˆæ¢ Cloudflare é›¶ä¿¡ä»» - é€šè¿‡ Cloudflare Tunnel è®¿é—®æœåŠ¡ã€‚\n1ã€åˆ›å»º Cloudflare Tunnel ç™»å½• Cloudflare Zero Trust æ§åˆ¶å°ï¼Œé€‰æ‹©å·¦ä¾§å¯¼èˆªæ çš„ Access èœå•ï¼Œè¿›å…¥ Tunnels é…ç½®ï¼Œç‚¹å‡» Create a tunnel åˆ›å»ºä¸€ä¸ª Tunnelï¼Œè¾“å…¥ Tunnel éš§é“åç§°\né€‰æ‹©æœåŠ¡å™¨çš„æ“ä½œç³»ç»Ÿå’Œå¹³å°æ¶æ„ï¼š\nå¯ä»¥çœ‹åˆ°å®‰è£…å‘½ä»¤ï¼š\nå¤åˆ¶å·¦è¾¹å‘½ä»¤ç²˜è´´åˆ° SSH ä¼šè¯é‡Œå®‰è£… Cloudflaredï¼ˆæ³¨æ„ä¿æŠ¤ Refresh Token ä¸è¦æ³„æ¼ï¼‰\nbrew install cloudflare/cloudflare/cloudflared \u0026amp;\u0026amp; sudo cloudflared service install eyJhIjoiMmUxOTgwYTBlZjQzZjU3YjkyMGVhMjhjZGY5ZDM4ZDEiLCJ0IjoiYzU1ZTU3MmUtMTEyMS00OWJkLTgzMTgtNjc3NDIyYWMwMjU0IiwicyI6Ik1qZGtZakkyTldFdE5XVTRNUzAwTXpWaExXRXlNRFl0T0RobE5EbGpObVZpWmpJMSJ9 2ã€åˆ é™¤ Cloudflare DNS çš„ A è®°å½•è§£æ æˆ‘çš„åŸŸåæ‰˜ç®¡åœ¨ Cloudflare ä¸Šï¼Œæ‰€ä»¥éœ€è¦å°†åŸæ¥çš„åŸŸåè§£æè®°å½•åˆ é™¤ï¼Œä¸»è¦æ¶‰åŠä»¥ä¸‹ä¸¤ä¸ªéœ€è¦è¢«å›½å†…ç”¨æˆ·è®¿é—®çš„åŸŸåï¼ˆå…¶ä½™åŸŸåæ˜¯æˆ‘ä¸ªäººä½¿ç”¨ï¼Œæ‰€ä»¥åªéœ€è¦æˆ‘å¼€å¯ VPN è®¿é—®å³å¯ã€‚ï¼‰ï¼š\ncusdis.chensoul.cc umami.chensoul.cc 3ã€åœ¨ Cloudflare Tunnel æ·»åŠ  hostname å¦‚æœéœ€è¦å¯¹ ssh æœåŠ¡å¼€å¯ä»£ç†ï¼Œè¯·å‚è€ƒï¼šConnect with SSH through Cloudflare Tunnelã€‚\nå…³é”®æ­¥éª¤æ˜¯ï¼š\nä¸º ssh é€šé“åˆ›å»º Hostname\nåœ¨æœ¬åœ°å®‰è£… cloudflared\né…ç½® ~/.ssh/configï¼Œæ·»åŠ ä¸‹é¢é…ç½®ï¼ˆæ³¨æ„ï¼šæˆ‘ä½¿ç”¨ Homebrew å®‰è£…çš„ cloudflaredï¼‰ï¼š\nHost ssh.chensoul.cc ProxyCommand /opt/homebrew/bin/cloudflared access ssh --hostname %h é€šè¿‡ ssh è®¿é—® ssh.chensoul.ccï¼š\nssh root@ssh.chensoul.cc 4ã€åœ¨ vps ä¸Šå¯ç”¨é˜²ç«å¢™ï¼Œåœæ­¢ nginx æœåŠ¡ å°† vps ä¸Š nginx é…ç½®çš„åå‘ä»£ç†åˆ é™¤ï¼Œå¹¶å¯ä»¥ç¦ç”¨è¿™äº›æœåŠ¡æš´éœ²çš„ç«¯å£ã€‚\n5ã€æµ‹è¯• ç»è¿‡æµ‹è¯•ï¼Œåˆå‘ç°æœ¬åœ°å¦‚æœå¼€å¯ VPNï¼ŒCloudflare Tunnel ä»£ç†çš„åŸŸåè¿˜æ˜¯æ— æ³•è®¿é—®ï¼Œäºæ˜¯æ”¾å¼ƒäº†ä½¿ç”¨ Cloudflare Tunnelï¼Œæ”¹ä¸ºå°†è¿™äº›å›½å†…æ— æ³•è®¿é—®çš„æœåŠ¡éƒ¨ç½²åˆ°å…è´¹çš„ VPS æœåŠ¡å™¨ä¸Šï¼Œæ¯”å¦‚ï¼šRailwayã€Vercelã€‚\nVercel éƒ¨ç½² Cusdisã€umami å‚è€ƒ è½»é‡çº§å¼€æºå…è´¹åšå®¢è¯„è®ºç³»ç»Ÿè§£å†³æ–¹æ¡ˆï¼ˆCusdis + Railwayï¼‰ åœ¨ Railway ä¸Šéƒ¨ç½² cusdisï¼Œæ•°æ®åº“è¿˜æ˜¯å¯ä»¥ä½¿ç”¨ vps ä¸Šéƒ¨ç½²çš„ postgresqlï¼Œåªéœ€è¦é…ç½®ä¸€ä¸ª jdbc é“¾æ¥å³å¯ï¼š\npostgresql://cusdis:xxxxxx@postgres.chensoul.cc:5432/cusdis éƒ¨ç½²å®Œä¹‹åï¼Œå‘ç°å­˜åœ¨è·¨åŸŸé—®é¢˜ï¼Œæ•…å…¨éƒ¨æ”¹ä¸ºä½¿ç”¨ Vercel æ¥éƒ¨ç½²ã€‚\nå‚è€ƒ Cusdis å®˜æ–¹æ–‡æ¡£ æ¥éƒ¨ç½² Cusdisï¼Œå¯¹äº Cusdis å­˜åœ¨è·¨åŸŸé—®é¢˜ï¼Œå‚è€ƒ Sometimes form shows on page, sometimes not - CORS issue #135ï¼Œä¿®æ”¹ä½ çš„ github çš„ cusdis ä»“åº“ä¸­çš„ next.config.js æ–‡ä»¶ï¼š\nasync headers() { return [ { source: \u0026#34;/:path*\u0026#34;, headers: [ { key: \u0026#34;Access-Control-Allow-Origin\u0026#34;, value: \u0026#34;*\u0026#34; }, ], }, ] }, å‚è€ƒ Umami å®˜æ–¹æ–‡æ¡£ æ¥éƒ¨ç½² Umamiï¼Œumami çš„ postgresql jdbc é“¾æ¥è¿˜æ˜¯ä½¿ç”¨ vps ä¸Šé¢éƒ¨ç½²çš„ postgresql\npostgresql://umami:xxxxxxpostgres.chensoul.cc:5432/umami Chatgpt å†™ä»£ç  åœ¨ https://poe.com/chatgpt é‡Œé¢è¾“å…¥ä¸‹é¢æ–‡å­—ï¼š\nè¯·ç”¨ java å®ç°ä¸€ä¸ªé€šçŸ¥ç³»ç»Ÿï¼Œç»™å‡ºå®Œæ•´çš„ä»£ç ï¼Œéœ€æ±‚å¦‚ä¸‹ï¼š\n1ã€é€šçŸ¥äº‹ä»¶ï¼ŒæŒ‡ä¸šåŠ¡å¹³å°è§¦å‘çš„äº‹ä»¶ï¼Œé€šçŸ¥äº‹ä»¶æœ‰åç§°ï¼Œæè¿°ï¼Œç¼–ç ã€‚é€šçŸ¥äº‹ä»¶å¯ä»¥å®šä¹‰å¤šä¸ªå±æ€§ã€‚å±æ€§æœ‰åç§°ã€æè¿°ã€ç¼–ç ï¼Œç±»å‹ã€‚ç±»å‹æœ‰æ•´å½¢ã€å­—ç¬¦ä¸²ã€æ—¥æœŸã€æ—¶é—´ã€æµ®ç‚¹æ•°ã€åˆ—è¡¨å‡ ç§ã€‚\n2ã€é€šçŸ¥è§„åˆ™ã€‚é€šçŸ¥è§„åˆ™æœ‰åç§°ã€ç”Ÿæ•ˆæ—¶é—´ï¼ˆä¸€ç›´ç”Ÿæ•ˆï¼Œæˆ–è€…æŒ‡å®šæ—¶é—´æ®µç”Ÿæ•ˆï¼‰ï¼Œé€šçŸ¥äº‹ä»¶ï¼ˆä»åˆ›å»ºå¥½çš„äº‹ä»¶é€‰æ‹©ä¸€ä¸ªï¼‰ã€æè¿°ã€‚é€šçŸ¥è§„åˆ™å¯ä»¥åˆ›å»ºå¤šä¸ªè§„åˆ™é¡¹ã€‚æ¯ä¸ªè§„åˆ™é¡¹è¦é€‰æ‹©äº‹ä»¶ä¸‹é¢çš„æŸä¸€ä¸ªå±æ€§ï¼Œå¹¶ä¸”å¯ä»¥å¯¹è¯¥äº‹ä»¶å±æ€§é€‰æ‹©ä¸€ä¸ªæ“ä½œç¬¦ï¼ˆå¤§äºã€å°äºã€ç­‰äºã€åœ¨ä¸¤ä¸ªæŒ‡ä¹‹é—´ï¼‰å’Œè®¾ç½®å¯¹åº”çš„å€¼ã€‚å¦‚æœæ˜¯å¤§äºã€å°äºã€ç­‰äºï¼Œåˆ™åªç”¨é€‰æ‹©ä¸€ä¸ªå€¼ã€‚å¦‚æœæ˜¯åœ¨ä¸¤ä¸ªæŒ‡ä¹‹é—´ï¼Œåˆ™éœ€è¦é€‰æ‹©ä¸¤ä¸ªå€¼ã€‚å¤šä¸ªæ‰§è¡Œæ¡ä»¶åœ¨è§„åˆ™æ‰§è¡Œæ—¶ï¼Œæ˜¯æŒ‰ä¸æ‰§è¡Œã€‚è§„åˆ™å¯ä»¥æŒ‡å®šå¤šä¸ªé€šçŸ¥ç”¨æˆ·ï¼ˆå§“åã€æ‰‹æœºå·ï¼‰ã€‚\n3ã€é€šçŸ¥ç­–ç•¥ã€‚ä¸€ä¸ªè§„åˆ™å¯ä»¥å®šä¹‰å¤šä¸ªé€šçŸ¥ç­–ç•¥ã€‚é€šçŸ¥ç­–ç•¥æœ‰é€šçŸ¥æ¨¡ç‰ˆã€é€šçŸ¥æ¸ é“ã€‚æ¯ä¸ªé€šçŸ¥æ¨¡ç‰ˆæœ‰æ ‡é¢˜ã€æè¿°ä»¥åŠæ¨¡ç‰ˆå†…å®¹ï¼ˆæ¨¡æ¿å†…å®¹æ”¯æŒå˜é‡æ›¿æ¢ï¼‰ã€‚\n4ã€é€šçŸ¥æ¸ é“æœ‰ç±»å‹ã€é…ç½®å±æ€§ï¼Œå¯ä»¥å‘é€æ¶ˆæ¯ï¼Œæ”¯æŒçš„é€šçŸ¥æ¸ é“æœ‰é£ä¹¦ã€é‚®ä»¶ã€‚\n5ã€é€šçŸ¥è§„åˆ™æµ‹è¯•ã€‚ç»™å®šä¸€ä¸ªäº‹ä»¶ç å’Œäº‹å®æ•°æ®ï¼Œç³»ç»ŸæŸ¥è¯¢å‡ºè¯¥äº‹ä»¶ç å…³è”çš„å¤šä¸ªè§„åˆ™ã€‚æ¯ä¸ªè§„åˆ™é€šè¿‡ easy-rule 4.1.0 æ¡†æ¶å»æ‰§è¡Œã€‚æ¯ä¸ªè§„åˆ™é¡¹æ‰§è¡Œå‰ï¼Œéœ€è¦æ ¡éªŒäº‹å®æ•°æ®é‡Œçš„å€¼çš„ç±»å‹å’Œäº‹ä»¶å±æ€§å®šä¹‰çš„ç±»å‹æ˜¯å¦ä¸€è‡´ã€‚å¤šä¸ªè§„åˆ™é¡¹çš„æ‰§è¡Œç»“æœæ±‚äº¤é›†ã€‚å½“æœ€åç»“æœä¸º true æ—¶ï¼Œå°†é€šçŸ¥ç­–ç•¥ä¸­çš„æ¨¡æ¿å†…å®¹è¿›è¡Œå˜é‡æ›¿æ¢ï¼Œç„¶åé€šè¿‡æ¸ é“å‘é€æ¶ˆæ¯ç»™è¿™äº›äººã€‚\næ³¨æ„ï¼šç›¸åŒçš„æ¶ˆæ¯å†…å®¹ï¼Œåœ¨ä¸€åˆ†é’Ÿå†…ï¼Œåªé€šè¿‡ä¸€ä¸ªæ¸ é“ç»™æŸä¸€ä¸ªç”¨æˆ·å‘é€ä¸€æ¬¡ï¼Œä¸è¦é‡å¤å‘é€ã€‚\nchatgpt å›ç­”å¦‚ä¸‹ï¼š\næ€»ç»“ï¼š\nè®© chatgpt å†™ä»£ç ç›¸å¯¹æ¥è¯´ï¼Œè¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œå¯ä»¥æä¾›ä¸€äº›ç¼–ç¨‹ç¤ºä¾‹æˆ–è€…å¼€é˜”ç¼–ç¨‹æ€è·¯ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›ç¼ºé™·ï¼š\nchatgpt å†™çš„ä»£ç ä¸ä¸€å®šå‡†ç¡®ï¼Œæˆ–è€…è¯´æ²¡æœ‰è€ƒè™‘ä¸€äº›å¼‚å¸¸æƒ…å†µã€‚éœ€è¦ä¸æ–­åœ°å’Œ chatgpt èŠå¤©ï¼Œæè¿°æ¸…æ¥šéœ€æ±‚ï¼Œè®© chatgpt æ¥ä¿®æ­£ä»£ç ï¼Œè¿™æ ·äº¤äº’å¼èŠå¤©ï¼Œç›¸å¯¹æ¥è¯´ä¼šæœ‰ç‚¹è€—æ—¶ã€‚ æä¾›çš„ url é“¾æ¥å¯èƒ½ 404ã€‚ å¥½ç‰©åˆ†äº« è™½ç„¶å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€ChenSoul Shareã€Telegram é¢‘é“ï¼Œä¸è¿‡è¿˜æ˜¯æŒ‘é€‰ä¸€éƒ¨åˆ†åœ¨è¿™é‡Œåˆ—ä¸¾ä¸€ä¸‹ï¼Œæ„Ÿè§‰æ›´åƒä¸€ä¸ª newsletter äº†ã€‚\nä¸€äº›æ–‡ç«  Java è¿‘æœŸæ–°é—»ï¼šGradle 8.0ã€Mavenã€Payara å¹³å°ã€Piranhaã€Spring Frameworkã€MyFaces å’Œ Piranha\nRackNerd VPS æ¨è\nä¸€äº›å·¥å…· Zed Atom ä½œè€…æ–°å¼€å‘çš„ç¼–è¾‘å™¨ Zed é€Ÿåº¦ç¡®å®éå¸¸å¿«ï¼ŒåŸºæœ¬çš„åŠŸèƒ½ä¹Ÿéƒ½æ”¯æŒï¼Œç°åœ¨è¿˜åœ¨å†…æµ‹é˜¶æ®µï¼Œæš‚æ—¶ä¸æ”¯æŒå®‰è£… extensionã€‚\nå›¾ç‰‡è½¬ webp mac ä¸Šå®‰è£…ï¼š\nbrew install webp ä½¿ç”¨ç¤ºä¾‹ï¼š\ncwebp -q 50 -lossless picture.png -o picture_lossless.webp cwebp -q 70 picture_with_alpha.png -o picture_with_alpha.webp cwebp -sns 70 -f 50 -size 60000 picture.png -o picture.webp ä¸€äº›å½±è§† å†°æµ·é™·è½ï¼Œæ¨èæŒ‡æ•°ï¼šâ˜†â˜†â˜†â˜†ã€‚ç–¯ç‹‚çš„èŠ­å ¤é›…å°†å†›æœç½—å¤«ï¼ˆç±³å“ˆä¼Šå°”ãƒ»æˆˆå°”æ²ƒä¼Š Mikhail Gorevoy é¥°ï¼‰é¢„è°‹å‘åŠ¨ç¬¬ä¸‰æ¬¡ä¸–ç•Œå¤§æˆ˜ï¼Œä»–åˆ¶é€ äº†ä¸€åœºå·¨å¤§çš„æ°´åŸŸçˆ†ç‚¸ï¼Œè‡´ä½¿é™„è¿‘çš„ç¾å†›æ½œè‰‡é˜Ÿé‡è¢­ã€‚ç¾å›½æµ·å†›æ´¾å‡ºäº†æµ·åº•ç»éªŒä¸°å¯Œä½†åå£°å¯¥å¯¥çš„ä¹”ãƒ»æ ¼æ‹‰æ–¯æ½œæ°´è‰‡èˆ¹é•¿ï¼ˆæ°æ‹‰å¾·ãƒ»å·´ç‰¹å‹’ Gerard Butler é¥°ï¼‰ç‡é¢†æ½œè‰‡é˜Ÿå‰å»è°ƒæŸ¥ã€‚\né»‘æš—è£è€€ç¬¬äºŒå­£ï¼Œæ¨èæŒ‡æ•°ï¼šâ˜†â˜†â˜†â˜†ã€‚\nä»¥ä¸Šã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/03/13/weekly_review_10/","summary":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-03-06 åˆ° 2023-03-12 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¿™å‘¨å‘ç° VPS ä¸Š æŸäº›ä½¿ç”¨ docker éƒ¨ç½²çš„æœåŠ¡ï¼ˆcusdisã€umamiã€uptimeã€n8nã€rsshubã€memosï¼‰å›½å†…ç”¨æˆ·æ— æ³•è®¿é—®äº†ï¼Œäºæ˜¯å°±æŠ˜è…¾äº†ä¸€ä¸‹ä½¿ç”¨ Cloudflare Tunnel æ¥ä»£ç†è¿™äº›æœåŠ¡ã€‚é…ç½®æˆåŠŸä¹‹åï¼Œåˆå‘ç°æœ¬åœ°å¦‚æœå¼€å¯ VPNï¼ŒCloudflare Tunnel ä»£ç†çš„åŸŸåè¿˜æ˜¯æ— æ³•è®¿é—®ï¼Œäºæ˜¯æ”¾å¼ƒäº†ä½¿ç”¨ Cloudflare Tunnelï¼Œæ”¹ä¸ºå°†è¿™äº›å›½å†…æ— æ³•è®¿é—®çš„æœåŠ¡éƒ¨ç½²åˆ°å…è´¹çš„ VPS æœåŠ¡å™¨ä¸Šï¼Œæ¯”å¦‚ï¼šRailwayã€Vercelã€‚\nè¿™å‘¨å·¥ä½œå¿™å®Œä¹‹åï¼Œå°±å¼€å§‹ç€æ‰‹é€šçŸ¥ç³»ç»Ÿçš„é‡æ„æ”¹é€ æœåŠ¡ï¼Œæƒ³ç€ chatgpt è¿™ä¹ˆç«ï¼Œäºæ˜¯å°±è¯•è¯•è®©å®ƒæ¥å†™ä»£ç ã€‚åœ¨ä¸æ–­åœ°ä¿®æ”¹éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œchatgpt å†™å‡ºæ¥çš„ä»£ç ç¨åŠ è°ƒæ•´é€æ¸å¯ä»¥ä½¿ç”¨äº†ã€‚\nå‘¨å…­ä»æ±‰å£å¼€è½¦å»ç™½æ²™æ´²æ¹–åŒ—è´¢ç¨èŒä¸šå­¦é™¢ï¼Œå…¨ç¨‹ 20 å…¬é‡Œï¼Œå›æ¥çš„æ—¶å€™ä¸å°å¿ƒæŠŠè·¯è¾¹çš„é¢åŒ…è½¦æ“¦ç¢°äº†ä¸€ä¸‹ã€‚äºæ˜¯ä¸€è„¸æ‡µçš„ç»å†äº†ä¸€æ¬¡ä¿é™©å®šæŸç»´ä¿®ã€‚\nå‘¨å…­å¼€å§‹ä½¿ç”¨ æ ¼å¿— APP å†™æ—¥å¿—ï¼Œé€‰æ‹©å®ƒæ¥è®°å½•æ—¥å¿—çš„åŸå› æ˜¯å®ƒæ”¯æŒæ‰¹é‡å¯¼å‡º mardkownã€pdfã€å›¾ç‰‡ç­‰ã€‚å”¯ä¸€æœ‰ä¸ªå°é—æ†¾çš„æ˜¯ï¼Œè¿™ä¸ªåº”ç”¨æ²¡æœ‰å›¾åºŠï¼Œå¯¼å‡ºçš„ markdown æ–‡ä»¶é‡Œé¢å›¾ç‰‡çš„é“¾æ¥ä¸æ˜¯ http åè®®ã€‚\nå‘¨æ—¥å»æ–°è£é¾™æ¹–å¤©è€€å¤©è¡—å”®æˆ¿éƒ¨çœ‹äº†ä¸€ä¸‹æˆ¿å­ã€‚107 å¹³ä¸‰å®¤ä¸¤å…ä¸¤å«ï¼Œå•ä»· 2 ä¸‡ 5 å¸¦ç²¾è£…ä¿®ï¼Œå…¬ç§¯é‡‘è´·æ¬¾ 90 ä¸‡ï¼Œå•†ä¸šè´·æ¬¾ 30 å¹´ï¼Œæ¯ä¸ªæœˆæˆ¿è´· 6000ã€‚ç›®å‰æ¥è¯´ï¼Œä¹°ä¸èµ·è¿™é‡Œçš„æˆ¿å­ï¼Œä½†æ˜¯ï¼Œä½œä¸ºä¸€ä¸ªä¹°æˆ¿ç›®æ ‡è¿˜æ˜¯å¯ä»¥çš„ï¼ŒåŠ æ²¹ï¼\nå¼€è½¦æ€»ç»“ æœ€è¿‘åˆ·è§†é¢‘ï¼Œæ€»ç»“çš„ä¸€äº›å¼€è½¦ç»éªŒå¦‚ä¸‹ï¼š\næå‰é¢„åˆ¤ï¼Œå‰é¢è½¦å­åˆ¹è½¦ï¼Œä¸ç®¡æ˜¯æ­£å‰æ–¹ï¼Œè¿˜æ˜¯å·¦å³å‰æ–¹ï¼Œè¿™æ—¶å€™ä¹Ÿè¦åˆ¹è½¦\nå‰é¢æœ‰å¤§è´§è½¦ï¼Œä¸è¦ä»å³è¾¹è¶…è½¦\nä¼šè½¦æ—¶ï¼Œçœ‹è·¯å®½\nä¸è¦è¿ç»­å˜é“ï¼Œå˜é“æ—¶æ—¢è¦çœ‹åè§†é•œï¼Œåˆè¦çœ‹çª—è¾¹\nçº¢ç¯è·¯å£å³è½¬æ—¶ï¼Œè¦çœ‹åœ°é¢æˆ–è€…è·¯è¾¹æ˜¯å¦æœ‰ç¦æ­¢å³è½¬æ ‡è¯†\né€šè¿‡ Cloudflare Tunnel è®¿é—®æœåŠ¡ ä»¥ä¸‹å†…å®¹å‚è€ƒ åˆæ¢ Cloudflare é›¶ä¿¡ä»» - é€šè¿‡ Cloudflare Tunnel è®¿é—®æœåŠ¡ã€‚\n1ã€åˆ›å»º Cloudflare Tunnel ç™»å½• Cloudflare Zero Trust æ§åˆ¶å°ï¼Œé€‰æ‹©å·¦ä¾§å¯¼èˆªæ çš„ Access èœå•ï¼Œè¿›å…¥ Tunnels é…ç½®ï¼Œç‚¹å‡» Create a tunnel åˆ›å»ºä¸€ä¸ª Tunnelï¼Œè¾“å…¥ Tunnel éš§é“åç§°\né€‰æ‹©æœåŠ¡å™¨çš„æ“ä½œç³»ç»Ÿå’Œå¹³å°æ¶æ„ï¼š\nå¯ä»¥çœ‹åˆ°å®‰è£…å‘½ä»¤ï¼š\nå¤åˆ¶å·¦è¾¹å‘½ä»¤ç²˜è´´åˆ° SSH ä¼šè¯é‡Œå®‰è£… Cloudflaredï¼ˆæ³¨æ„ä¿æŠ¤ Refresh Token ä¸è¦æ³„æ¼ï¼‰\nbrew install cloudflare/cloudflare/cloudflared \u0026amp;\u0026amp; sudo cloudflared service install eyJhIjoiMmUxOTgwYTBlZjQzZjU3YjkyMGVhMjhjZGY5ZDM4ZDEiLCJ0IjoiYzU1ZTU3MmUtMTEyMS00OWJkLTgzMTgtNjc3NDIyYWMwMjU0IiwicyI6Ik1qZGtZakkyTldFdE5XVTRNUzAwTXpWaExXRXlNRFl0T0RobE5EbGpObVZpWmpJMSJ9 2ã€åˆ é™¤ Cloudflare DNS çš„ A è®°å½•è§£æ æˆ‘çš„åŸŸåæ‰˜ç®¡åœ¨ Cloudflare ä¸Šï¼Œæ‰€ä»¥éœ€è¦å°†åŸæ¥çš„åŸŸåè§£æè®°å½•åˆ é™¤ï¼Œä¸»è¦æ¶‰åŠä»¥ä¸‹ä¸¤ä¸ªéœ€è¦è¢«å›½å†…ç”¨æˆ·è®¿é—®çš„åŸŸåï¼ˆå…¶ä½™åŸŸåæ˜¯æˆ‘ä¸ªäººä½¿ç”¨ï¼Œæ‰€ä»¥åªéœ€è¦æˆ‘å¼€å¯ VPN è®¿é—®å³å¯ã€‚ï¼‰ï¼š","title":"å‘¨æŠ¥-10ï½œé€šè¿‡Cloudflare Tunnelè®¿é—®æœåŠ¡ã€Verceléƒ¨ç½²Cusdiså’ŒUmami"},{"content":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-02-27 åˆ° 2023-03-05 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¿™å‘¨çš„ä¸»è¦å·¥ä½œæ˜¯ç‰ˆæœ¬æµ‹è¯•å’Œé¡¹ç›®ä¸Šçº¿ï¼Œåœ¨å¤§å®¶çš„å…±åŒåŠªåŠ›ä¸‹ï¼Œæœ€åæ˜¯æˆåŠŸä¸Šçº¿ã€‚\nç”±äºå…¬å¸æœ€è¿‘åœ¨è£å‘˜ï¼Œç•™ä¸‹æ¥çš„éƒ½å¼€å§‹å·èµ·æ¥ï¼Œæ¯å¤©æ™šä¸Š 8 ç‚¹ä¹‹åä¸‹ç­ï¼Œè¿™æ ·å¹³å‡ä¸€å¤©çš„å·¥ä½œæ—¶é—´æ‰æœ‰ 11 å°æ—¶ã€‚æ®è¯´ï¼Œæ—è¾¹ç»„çš„åŒäº‹å¹³å‡æ¯å¤©éƒ½æ˜¯ 12 ä¸ªå°æ—¶å·¥ä½œæ—¶é—´ã€‚è£äº†ä¸‰ä½åŒäº‹ä¹‹åï¼Œæˆ‘ä»¬è½¯ä»¶ç»„è¿˜æœ‰ 8 äººï¼Œç®—æ³•ç»„æœ‰ 7 äººï¼Œäº§å“ç»„æœ‰ 6 äººï¼Œç»ˆç«¯ç»„æœ‰ 4 äººã€‚è·é›†å›¢å…¬å¸å…­æœˆä¸Šå¸‚è¿˜æœ‰ä¸¤ä¸ªæœˆï¼Œè£å‘˜ä¼°è®¡è¿˜ä¼šç»§ç»­ï¼ŒåŒå¿—ä»¬è¿˜éœ€åŠªåŠ›åŠ ç­ï¼Œäº‰å–è¢«è£çš„ä¸æ˜¯è‡ªå·±ã€‚\nè¿™å‘¨è¿˜æ˜¯æ²¡æœ‰å¼€è½¦ï¼Œæ¯å¤©ååœ°é“ä¸Šä¸‹ç­ï¼Œåˆ·åˆ· rss çœ‹çœ‹ b ç«™è§†é¢‘ï¼Œäº†è§£ä¸€äº›è¡Œä¸šæœ€æ–°åŠ¨æ€ï¼ŒåŒæ—¶ä¹Ÿçœ‹çœ‹åŒæ ·åœ¨å†™åšå®¢çš„é‚£äº›ç‹¬ç«‹å¼€å‘è€…æ¯å‘¨éƒ½åœ¨åšä»€ä¹ˆï¼Œä¹Ÿå­¦ä¹ ä¸€äº›æ–°æŠ€æœ¯æˆ–è€…æ–°æŠ€èƒ½ã€‚\nè¿™å‘¨æ¥è§¦äº† web3 ç©ºæŠ•ï¼ŒèŠ±äº†å‡ ä¸ªå°æ—¶ä½¿ç”¨è‡ªåŠ¨åŠ æ‰‹åŠ¨çš„æ–¹å¼åˆ·äº† 120 å¤šä¸ªè´¦å·ã€‚è‡ªåŠ¨çš„æ–¹å¼ï¼Œå°±æ˜¯ç”¨ nodejs ä»£ç åœ¨ bsc ç½‘ç»œæ‰¹é‡åˆ›å»ºè´¦å·å¹¶ä¿å­˜ä¸º csv æ–‡ä»¶ï¼›å…¶æ¬¡ï¼Œé€šè¿‡ onekey web ä¸Šçš„æ‰¹é‡è½¬è´¦åŠŸèƒ½ï¼Œç»™æ¯ä¸ªè´¦æˆ·è½¬äº† 0.00125bnbã€‚æ‰‹åŠ¨æ“ä½œçš„éƒ¨åˆ†å°±æ˜¯ï¼Œä¸€ä¸ªä¸ªçš„å°†è´¦å·ç§é’¥å¯¼å…¥ç‹ç‹¸é’±åŒ…ï¼Œç„¶åï¼Œç”¨ lifeform cartoon è¿æ¥é’±åŒ…è´¦æˆ·ï¼Œmint æˆåŠŸä¹‹åï¼Œåˆ†äº«é“¾æ¥ï¼Œå†ç»§ç»­è¿æ¥ç‹ç‹¸çš„ä¸‹ä¸€ä¸ªè´¦å·ï¼Œé‡å¤ä¸Šé¢æ“ä½œã€‚\nå› ä¸ºå¤ªè€—æ—¶é—´ï¼Œæ‰€ä»¥åªåˆ·äº† 120 ä¸ªè´¦å·ã€‚è¶å·¥ä½œä¸å¿™çš„æ—¶å€™ï¼Œç”¨ chatgpt æœç´¢ä¸€ä¸‹å¦‚ä½•å°†ä¸Šé¢çš„æ“ä½œå…¨éƒ¨è‡ªåŠ¨åŒ–ã€‚\nå‘¨æœ«ä¸¤å¤©ï¼Œç»§ç»­ç»ƒè½¦ï¼Œä»æ±‰å£åˆ°é˜³é€»ï¼Œå†åˆ°æ–°æ´²ï¼Œæœ€åå»æ–°æ´²çš„å°†å†›å±±çˆ¬å±±ã€å»é“è§‚æ²³çœ‹é£æ™¯ã€‚ç®—ä¸‹æ¥ï¼Œæœ€è¿‘è¿™ä¸‰ä¸ªå‘¨æœ«å…­å¤©æ—¶é—´ï¼Œæˆ‘ä¸€å…±å¼€äº† 800 å¤šå…¬é‡Œäº†ã€‚ç›®å‰ï¼Œæš‚æ—¶æ²¡æœ‰æ”¶åˆ°è¿è§„é€šçŸ¥ï¼Œä½†è¿˜æ˜¯å­˜åœ¨å¾ˆå¤šä¸è¶³çš„åœ°æ–¹ã€‚\nå¼€è½¦æ€»ç»“ è¿™å‘¨å¼€è½¦ï¼Œå‘ç°å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š\n1ã€åœè½¦è¿˜æ˜¯ä¼šå¿˜è®°ç†„ç«æ‹”é’¥åŒ™ã€‚ 2ã€çº¢ç»¿ç¯å£ï¼Œåœåœ¨å¤§è´§è½¦åé¢ï¼Œå¹¶é å¾—è¿‘ï¼Œå‰æ–¹è§†çº¿å—é˜»ã€‚ç»è¿‡çº¢ç»¿ç¯æ—¶ï¼Œæ„Ÿè§‰åƒæ˜¯é—¯äº†çº¢ç¯ã€‚ 3ã€è¶…è½¦æ—¶å€™ï¼Œæ²¡æœ‰åŠ é€Ÿã€‚ 4ã€åœ¨å±±è·¯è¡Œé©¶ï¼Œå…¥å¼¯å’Œå‡ºå¼¯éƒ½ä¼šå‡é€Ÿã€‚ 5ã€åˆ¤æ–­è½¦è·çš„ç»éªŒä¸è¶³ã€‚è¡¨ç°åœ¨è¡Œé©¶è¿‡ç¨‹ä¸­ã€ä¾§æ–¹åœè½¦ã€å€’è½¦å…¥åº“ã€‚ é’ˆå¯¹ä»¥ä¸Šé—®é¢˜ï¼Œæ™šä¸Šåˆ·äº†ä¸€äº›è§†é¢‘ï¼Œåšäº†ä¸€äº›ç¬”è®°ï¼Œå¸Œæœ›èƒ½å¤Ÿå¸®åŠ©è‡ªå·±æ”¹æ­£ä¸Šé¢è¿™äº›é—®é¢˜ã€‚\n1ã€ç›®å…‰çœ‹è¿œã€‚å…¥å¼¯æå‰æ”¶æ²¹ï¼Œè„šå¤‡åˆ¹è½¦ã€‚å¦‚æœå¼¯é“è¿‡æ€¥ï¼Œå°±å¸¦ç‚¹åˆ¹è½¦ï¼Œå¦‚æœè½¦é€Ÿä½ å¯ä»¥æ§åˆ¶ï¼Œç›´æ¥æ”¶æ²¹è¿‡å¼¯ï¼›å‡ºå¼¯åŠ æ²¹ï¼Œçœ¼ç›çœ‹å‡ºå¼¯å£ã€‚èº«ä½“è·Ÿéšæ–¹å‘ç›˜é ã€‚è¿™æ ·ï¼Œè½¦é€Ÿä¸é™ï¼Œå¯ä»¥æ§åˆ¶è½¦é€Ÿã€‚å¦‚æœä»¥ 80 ç é€Ÿåº¦è¿‡å¼¯ï¼Œä¸”è¿™ä¸ªè½¦è¿˜åœ¨è½¦é“å†…ï¼Œè¿™ä¸ªè½¦çš„é€Ÿåº¦ä½ å°±æ§åˆ¶ä½äº†ã€‚ä½†å‡¡æœ‰ç‚¹è¶Šçº¿ï¼Œè¯´æ˜è½¦é€Ÿè¿‡å¿«ï¼Œä½ å°±è¦é™ä½é€Ÿåº¦ã€‚\n2ã€é å³è¡Œé©¶ã€‚ä¼šè½¦æ—¶ï¼Œä¸»åŠ¨é å³ã€‚è½¬å¼¯æ—¶ï¼Œå‘ç°å¯¹é¢æœ‰æ¥è½¦ï¼Œé¸£ç¬›ç¤ºæ„ã€‚\n3ã€è·¯å£è¿œé“çš„åŸåˆ™ï¼Œè·Ÿå°è½¦ä¸è·Ÿå¤§è½¦ã€‚å¦‚æœè·Ÿç€å¤§è½¦ï¼Œç•™ä¸€ä¸ªè½¦ä½ç©ºé—´ï¼Œè®©å¤§è½¦å…ˆèµ°ï¼Œç¡®è®¤ç»¿ç¯å†èµ°ã€‚\n4ã€çº¢ç»¿ç¯è·¯å£ï¼Œæå‰å‡é€Ÿï¼Œæé†’åé¢è½¦å‡é€Ÿï¼Œä¸è¦æ€¥åˆ¹è½¦ï¼Œé˜²æ­¢åé¢è½¦è¿½å°¾ã€‚ç‰¹åˆ«æ˜¯åœ¨ç»¿ç¯é—ªçš„æ—¶å€™ï¼Œä¸è¦æ²¡æœ‰å‡é€Ÿï¼Œçªç„¶åœè½¦ã€‚å¦åˆ™åé¢è½¦ä¼šä»¥ä¸ºä½ è¦åŠ é€Ÿå†²è¿‡å»ï¼Œä»–ä¹ŸåŠ é€Ÿï¼Œè¿™æ ·ï¼Œä»–å°±ä¼šè¿½å°¾ä½ ã€‚\nåšå®¢è¯¥å†™ä»€ä¹ˆ çœ‹åˆ°ä¸€ç¯‡åšå®¢ What to blog aboutï¼Œé‡Œé¢èŠåˆ°äº†åšå®¢è¯¥å†™ä»€ä¹ˆã€‚ä¸€æ—¶å…´èµ·ï¼Œæƒ³ç¿»è¯‘æˆä¸­æ–‡ã€‚äºæ˜¯ï¼Œåˆ†åˆ«ä½¿ç”¨äº† chrome æ²‰æµ¸å¼ç¿»è¯‘æ’ä»¶å’Œ chatgpt æ¥ç¿»è¯‘è¿™ç¯‡æ–‡ç« ï¼Œå¾—åˆ°ç»“æœå¦‚ä¸‹ï¼š\n1ã€ä½¿ç”¨ chrome æ²‰æµ¸å¼ç¿»è¯‘æ’ä»¶ ç¿»è¯‘è¿™ç¯‡æ–‡ç« ï¼š\næ€»ç»“æ¥è¯´ï¼Œåšå®¢å¯ä»¥å†™ä¸¤éƒ¨åˆ†å†…å®¹ï¼š\nä»Šå¤©å­¦åˆ°çš„ä¸œè¥¿ æ­£åœ¨åšçš„é¡¹ç›® 2ã€ä½¿ç”¨ chatgpt ç¿»è¯‘è¿™ç¯‡æ–‡ç« ï¼š\nè¯· chatgpt ç¿»è¯‘è¿™ç¯‡æ–‡ç«  https://simonwillison.net/2022/Nov/6/what-to-blog-about/ ä¸ºä¸­æ–‡ï¼Œå¾—åˆ°çš„ç»“æœå¦‚ä¸‹ï¼š\næ ‡é¢˜ï¼šè¯¥å†™ä»€ä¹ˆåšå®¢ï¼Ÿ\néšç€æˆ‘å†™äº†ä¸€ç¯‡æ–°çš„åšå®¢æ–‡ç« ï¼Œæˆ‘æƒ³åˆ†äº«ä¸€ä¸‹æˆ‘æœ€è¿‘å­¦åˆ°çš„å…³äºå†™åšå®¢çš„ä¸€äº›äº‹æƒ…ã€‚\nä¸€æ—¦ä½ å¼€å§‹å†™åšå®¢ï¼Œä½ å°±å¿…é¡»ä¿æŒä¸€å®šçš„é¢‘ç‡å’ŒæŒç»­çš„å†…å®¹æ›´æ–°ã€‚è¿™ä¸ä»…æ˜¯ä¸ºäº†å¸å¼•å’Œä¿æŒè¯»è€…ï¼Œä¹Ÿæ˜¯ä¸ºäº†è®©è‡ªå·±ä¸æ–­æˆé•¿å’Œå‘å±•ã€‚å¯¹äºæˆ‘æ¥è¯´ï¼Œåšå®¢æ˜¯æˆ‘æœ€æœ‰ä»·å€¼çš„è‡ªæˆ‘è¡¨è¾¾å½¢å¼ä¹‹ä¸€ï¼Œå› ä¸ºå®ƒè¿«ä½¿æˆ‘å»æ€è€ƒå’Œç»„ç»‡æˆ‘çš„æƒ³æ³•ï¼Œè€Œè¿™äº›æƒ³æ³•å¯èƒ½ä¼šè¢«æ·¹æ²¡åœ¨æ—¥å¸¸ç”Ÿæ´»çš„å–§åš£ä¸­ã€‚\nä½†æ˜¯ï¼Œé€‰æ‹©åšå®¢å†…å®¹å¯ä»¥å¾ˆå›°éš¾ï¼Œç‰¹åˆ«æ˜¯å½“ä½ æœ‰å¤šä¸ªæ„Ÿå…´è¶£çš„è¯é¢˜å’Œé¡¹ç›®ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æˆ‘æœ€è¿‘å­¦åˆ°çš„æœ‰å…³é€‰æ‹©åšå®¢ä¸»é¢˜çš„æŠ€å·§ï¼š\næ¯å‘¨è‡³å°‘å†™ä¸€ç¯‡æ–‡ç«  å°½ç®¡è¿™å¯èƒ½å¬èµ·æ¥åƒä¸€ä¸ªè‰°å·¨çš„ä»»åŠ¡ï¼Œä½†ä¿æŒæ¯å‘¨è‡³å°‘å†™ä¸€ç¯‡æ–‡ç« çš„é¢‘ç‡å¯ä»¥å¸®åŠ©ä½ ä¿æŒå†™ä½œçš„ä¹ æƒ¯å’Œè¿›å±•ã€‚è¿™ä¹Ÿæœ‰åŠ©äºé¿å…é•¿æ—¶é—´çš„ç©ºç™½æœŸï¼Œè¿™å¯èƒ½ä¼šä½¿ä½ å¤±å»å†™ä½œçš„åŠ¨åŠ›å’Œè¯»è€…çš„å…´è¶£ã€‚\nå†™ä¸‹ä½ çš„ç›®æ ‡å’Œæƒ³æ³•æ¸…å• åœ¨å¼€å§‹å†™åšå®¢ä¹‹å‰ï¼Œå…ˆå†™ä¸‹ä½ æ„Ÿå…´è¶£çš„è¯é¢˜å’Œä½ æƒ³å†™çš„å†…å®¹ã€‚è¿™å¯ä»¥å¸®åŠ©ä½ ä¿æŒç„¦ç‚¹å¹¶é¿å…æµªè´¹æ—¶é—´åœ¨æƒ³è¦çš„å†…å®¹ä¸Šã€‚\nå…³æ³¨ä½ çš„è¯»è€… è™½ç„¶ä½ çš„åšå®¢å¯èƒ½æ˜¯ä¸€ä¸ªäººçš„é¡¹ç›®ï¼Œä½†æ˜¯è€ƒè™‘åˆ°ä½ çš„è¯»è€…çš„å…´è¶£å’Œéœ€æ±‚æ˜¯è‡³å…³é‡è¦çš„ã€‚è¯•ç€æƒ³ä¸€ä¸‹ä½ çš„è¯»è€…ä¼šå¯¹å“ªäº›è¯é¢˜æ„Ÿå…´è¶£ï¼Œå¹¶å°è¯•å†™å‡ºä»–ä»¬ä¼šå‘ç°æœ‰è¶£æˆ–æœ‰ç”¨çš„å†…å®¹ã€‚\nä¿æŒå¼€æ”¾å’Œçµæ´» ä¸è¦æŠŠè‡ªå·±å±€é™åœ¨ä¸€ä¸ªä¸»é¢˜æˆ–é¢†åŸŸä¸­ã€‚ä¿æŒå¼€æ”¾å’Œçµæ´»ï¼Œå°è¯•ä¸åŒçš„è¯é¢˜å’Œé¢†åŸŸã€‚è¿™ä¸ä»…å¯ä»¥è®©ä½ å‘ç°æ–°çš„å…´è¶£å’Œæœºä¼šï¼Œè¿˜å¯ä»¥è®©ä½ åœ¨å†™ä½œæ–¹é¢æ›´æœ‰åˆ›æ„å’Œçµæ„Ÿã€‚\nå°è¯•ä¸åŒçš„åšå®¢æ ¼å¼ ä¸ä»…å¯ä»¥é€šè¿‡å†™ä½œæ¥è¡¨è¾¾è‡ªå·±ï¼Œè¿˜å¯ä»¥é€šè¿‡ä¸åŒçš„åšå®¢æ ¼å¼æ¥å®ç°è¿™ä¸€ç‚¹ã€‚å°è¯•å†™ä¸€ç¯‡æ•™ç¨‹ã€ä¸€ç¯‡æ¼”ç¤ºã€ä¸€ç¯‡è¯„è®ºæˆ–ä¸€ç¯‡é—®é¢˜è§£ç­”æ–‡ç« ã€‚è¿™å¯ä»¥è®©ä½ æ›´å¥½åœ°æ¢ç´¢å’Œå±•ç¤ºä½ çš„æŠ€èƒ½å’ŒçŸ¥è¯†ã€‚\næ€»ä¹‹ï¼Œå†™åšå®¢å¯ä»¥æ˜¯ä¸€ç§ä»¤äººæ»¡æ„çš„è¡¨è¾¾æ–¹å¼ï¼Œå¯ä»¥å¸®åŠ©ä½ æ¢ç´¢å’Œå‘ç°æ–°çš„æƒ³æ³•å’Œæœºä¼šã€‚å…³é”®æ˜¯è¦ä¿æŒé¢‘ç‡å’Œçµæ´»æ€§ï¼Œå¹¶å°è¯•ä¸åŒçš„åšå®¢æ ¼å¼ã€‚\nWeb3 æ‰¹é‡ç©ºæŠ• æœ€è¿‘ï¼Œå‚ä¸äº† Lifeform Cartoon çš„ç©ºæŠ•ï¼Œè¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡å‚ä¸ web3ã€‚ä¸‹é¢æ˜¯è®°å½•ä¸€ä¸‹æ“ä½œæ­¥éª¤ï¼š\nä¸‹è½½ç‹ç‹¸é’±åŒ… æ‰¹é‡åˆ›å»ºè´¦å· æ‰¹é‡ä»ä¸€ä¸ªè´¦å·è½¬å¸åˆ°å¤šä¸ªè´¦å· æ‰¹é‡å¯¼å…¥è´¦å·åˆ°ç‹ç‹¸é’±åŒ… è®¿é—® Lifeform Cartoon çš„é‚€è¯·é“¾æ¥åœ°å€ï¼Œæ¯”å¦‚ï¼šhttps://cartoon.lifeform.cc?referral=0x068b021B7d44e4795c6ec07234D66c144644dC37ï¼Œç„¶åï¼Œè¿æ¥ç‹ç‹¸é’±åŒ…é‡Œçš„è´¦å·ï¼Œmint ä¹‹åï¼Œåˆ†äº«é“¾æ¥å†ä½¿ç”¨æ–°çš„é“¾æ¥é‡å¤ä¸Šé¢åŠ¨ä½œ ä¸Šé¢çš„æ­¥éª¤ï¼Œå¦‚æœæ˜¯å‡ ç™¾ä¸ªè´¦å·æ‰‹åŠ¨æ‰§è¡Œï¼Œåˆ™éœ€è¦èŠ±è´¹å¾ˆé•¿æ—¶é—´ã€‚ä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œæœ‰æ²¡æœ‰åŠæ³•è®©ç¨‹åºè‡ªåŠ¨å®ç°å‘¢ï¼Ÿ\nåœ¨ç½‘ä¸ŠæŸ¥æ‰¾äº†ä¸€äº›èµ„æ–™ï¼ŒåŒæ—¶ä½¿ç”¨ chatgptï¼ˆå¤‡æ³¨ï¼šhttps://poe.com/chatgptï¼‰æ‰¾åˆ°äº†ä½¿ç”¨ nodejs å®ç°çš„ç›¸å…³ä»£ç ã€‚\n1ã€æ‰¹é‡åˆ›å»ºè´¦å· åœ¨ BSC ç½‘ç»œä¸Šä½¿ç”¨ Node.js ç¼–ç¨‹è¯­è¨€æ‰¹é‡åˆ›å»ºè´¦æˆ·å¹¶ä¿å­˜ä¸º CSV æ–‡ä»¶çš„å®Œæ•´ä»£ç ï¼Œä¸ä½¿ç”¨ csv-writer åº“\n2ã€æ‰¹é‡è½¬è´¦ åœ¨ BSC ç½‘ç»œä¸Šä½¿ç”¨ Node.js ç¼–ç¨‹è¯­è¨€ä»ä¸€ä¸ªè´¦å·æ‰¹é‡è½¬ 0.0125bnb åˆ°å‰é¢åˆ›å»ºçš„å¤šä¸ªè´¦å·ï¼Œè¾“å‡ºå®Œæ•´çš„å¯ä»¥è¿è¡Œçš„ä»£ç \n3ã€æ‰¹é‡å¯¼å…¥è´¦å·åˆ° metamask é’±åŒ… é€šè¿‡ç¼–ç¨‹å®ç°åœ¨ BSC ç½‘ç»œ æ‰¹é‡å¯¼å…¥è´¦å·åˆ°æµè§ˆå™¨çš„ metamask é’±åŒ…\nä¸‹ä¸€æ­¥ï¼Œå°±æ˜¯æµ‹è¯•ä¸Šé¢ä»£ç ï¼Œå®ç°å…¨æµç¨‹ä»£ç æ‰˜ç®¡ã€‚\nå¥½ç‰©åˆ†äº« è™½ç„¶å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€ChenSoul Shareã€Telegram é¢‘é“ï¼Œä¸è¿‡è¿˜æ˜¯æŒ‘é€‰ä¸€éƒ¨åˆ†åœ¨è¿™é‡Œåˆ—ä¸¾ä¸€ä¸‹ï¼Œæ„Ÿè§‰æ›´åƒä¸€ä¸ª newsletter äº†ã€‚\nä¸€äº›æ–‡ç«  Service Profiles in Docker | Baeldung ChatGPT ç»ˆææŒ‡å— è°ˆè°ˆæˆ‘å¯¹ ChatGPT åº”ç”¨çš„ prompt çš„çœ‹æ³• æ”¯æŒ OpenAI ChatGPT API çš„ä¼˜ç§€è½¯ä»¶ ç¼–ç¨‹æ–°æ‰‹å¦‚ä½•é€šè¿‡ ChatGPT ä¸€å¤©å®Œæˆä¸€ä¸ª MVP äº§å“ è®© OpenAI ç”Ÿæˆ git commit message å¥½ä»£ç çš„äº”ä¸ªç‰¹è´¨ - Thoughtworks æ´è§ æˆ‘å¦‚ä½•æ­å»ºè‡ªå·±çš„åšå®¢ï¼ˆè‹±æ–‡ï¼‰ ä» Mac å¼€ç®±å¼€å§‹ è®¾ç½®ä¸€ä¸ªå¼€å‘ç¯å¢ƒ - ZedeX åˆ›å§‹äºº CEO ä¸ºä»€ä¹ˆè¦å†™ä½œï¼ˆåŸåˆ› 5000 å­—é•¿æ–‡å°è¯•è¯´é€ï¼‰ ä»æŠ„ä¹¦åˆ°å¼€æºä¹‹å·…ï¼šç« äº¦æ˜¥çš„ç¨‹åºäººç”Ÿ ä¸€äº›å·¥å…· 1ã€poe.com ç¾å›½é—®ç­”ç½‘ç«™ Quora å¼€å‘çš„ ChatBot äº§å“ï¼Œæ•´åˆä¸åŒèŠå¤©æœºå™¨ï¼ŒåŒ…æ‹¬ ChatGPTã€‚å“åº”é€Ÿåº¦éå¸¸å¿«ï¼Œæ¯” chat.openai.com çš„å…è´¹è´¦æˆ·å¿«éå¸¸å¤šã€‚æœ‰ ios ç‰ˆï¼Œæ‰‹æœºä¹Ÿèƒ½ç”¨äº†ã€‚ios ç‰ˆæœ‰ç¤¾åŒºï¼Œå¯ä»¥åˆ†äº«èŠå¤©è®°å½•ã€‚\n2ã€FounderBeats Founder Beats æ˜¯ä¸€å®¶é¢å‘åˆåˆ›ä¼ä¸šå’Œåˆ›ä¸šè€…çš„éŸ³ä¹åˆ¶ä½œå·¥ä½œå®¤ï¼Œä¸“é—¨ä¸ºä»–ä»¬æä¾›é«˜è´¨é‡çš„èƒŒæ™¯éŸ³ä¹å’ŒéŸ³æ•ˆã€‚Founder Beats çš„éŸ³ä¹åº“åŒ…å«äº†å„ç§ç±»å‹çš„éŸ³ä¹ï¼Œå¦‚æµè¡Œã€æ‘‡æ»šã€ç”µå­ã€å˜»å“ˆã€æ°‘è°£ç­‰ï¼Œä»¥åŠå„ç§éŸ³æ•ˆå’Œé…ä¹ï¼Œå¯ä»¥æ»¡è¶³ä¸åŒç”¨æˆ·çš„éœ€æ±‚ã€‚Founder Beats çš„éŸ³ä¹éƒ½æ˜¯ç”±ä¸“ä¸šéŸ³ä¹äººå’Œåˆ¶ä½œäººåˆ¶ä½œçš„ï¼Œå…·æœ‰é«˜å“è´¨å’ŒåŸåˆ›æ€§ã€‚\né™¤äº†éŸ³ä¹åˆ¶ä½œï¼ŒFounder Beats è¿˜æä¾›äº†å…¶ä»–æœåŠ¡ï¼Œå¦‚éŸ³é¢‘åˆ¶ä½œã€æ··éŸ³å’Œæ¯å¸¦å¤„ç†ç­‰ï¼Œå¯ä»¥å¸®åŠ©å®¢æˆ·åˆ¶ä½œé«˜è´¨é‡çš„éŸ³é¢‘å†…å®¹ã€‚Founder Beats çš„å›¢é˜Ÿæ‹¥æœ‰ä¸°å¯Œçš„éŸ³ä¹åˆ¶ä½œå’ŒéŸ³é¢‘å¤„ç†ç»éªŒï¼Œå¯ä»¥ä¸ºå®¢æˆ·æä¾›ä¸“ä¸šçš„å»ºè®®å’Œæ”¯æŒã€‚\nFounder Beats çš„å®¢æˆ·åŒ…æ‹¬åˆåˆ›ä¼ä¸šã€å¹¿å‘Šä»£ç†å•†ã€è§†é¢‘åˆ¶ä½œå…¬å¸ã€æ¸¸æˆå¼€å‘å•†ç­‰ï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨ Founder Beats çš„éŸ³ä¹å’ŒéŸ³æ•ˆæ¥å¢å¼ºä»–ä»¬çš„å“ç‰Œå½¢è±¡ã€è§†é¢‘å†…å®¹ã€æ¸¸æˆä½“éªŒç­‰ã€‚Founder Beats çš„å®šä»·æ¨¡å¼çµæ´»ï¼Œå®¢æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©é€‚åˆè‡ªå·±çš„ä»·æ ¼å’Œè®¸å¯è¯ã€‚\n3ã€Manticore Search Manticore Search æ˜¯ä¸€æ¬¾å¼€æºçš„å…¨æ–‡æœç´¢å¼•æ“ï¼Œæ”¯æŒé«˜æ€§èƒ½çš„æœç´¢å’Œåˆ†æã€‚å®ƒæ˜¯ Sphinx Search çš„åç»§è€…ï¼Œä½¿ç”¨äº†ç±»ä¼¼çš„æ¶æ„å’Œ APIï¼Œå¹¶ä¸”åœ¨åŠŸèƒ½å’Œæ€§èƒ½æ–¹é¢æœ‰å¾ˆå¤šæ”¹è¿›ã€‚Manticore Search ä½¿ç”¨ C++ç¼–å†™ï¼Œå…·æœ‰é«˜æ•ˆçš„ç´¢å¼•å’ŒæŸ¥è¯¢å¼•æ“ï¼Œå¯ä»¥å¤„ç†å¤§é‡çš„æ•°æ®å’Œé«˜å¹¶å‘è®¿é—®ã€‚å®ƒæ”¯æŒå¤šç§æ•°æ®æºå’Œæ•°æ®æ ¼å¼ï¼ŒåŒ…æ‹¬ MySQLã€PostgreSQLã€XMLã€JSONã€CSV ç­‰ã€‚\nManticore Search æä¾›äº†ä¸°å¯Œçš„æŸ¥è¯¢è¯­è¨€å’Œ APIï¼ŒåŒ…æ‹¬ SQLã€SPHINQL å’Œ HTTP API ç­‰ï¼Œå¯ä»¥æ»¡è¶³ä¸åŒç”¨æˆ·çš„éœ€æ±‚ã€‚å®ƒæ”¯æŒå…¨æ–‡æœç´¢ã€æ¨¡ç³Šæœç´¢ã€çŸ­è¯­æœç´¢ã€è¿‘ä¹‰è¯æœç´¢ã€åœ°ç†ä½ç½®æœç´¢ç­‰å¤šç§æœç´¢æ–¹å¼ï¼Œå¹¶ä¸”æ”¯æŒé«˜çº§è¿‡æ»¤ã€æ’åºã€åˆ†ç»„ã€èšåˆç­‰åŠŸèƒ½ã€‚Manticore Search è¿˜å…·æœ‰é«˜å¯ç”¨æ€§å’Œå¯æ‰©å±•æ€§ï¼Œæ”¯æŒä¸»ä»å¤åˆ¶ã€åˆ†ç‰‡ã€é›†ç¾¤ç­‰éƒ¨ç½²æ–¹å¼ï¼Œå¯ä»¥æ»¡è¶³ä¸åŒè§„æ¨¡å’Œè´Ÿè½½çš„åº”ç”¨åœºæ™¯ã€‚\nManticore Search æ˜¯ä¸€æ¬¾ä½¿ç”¨å¹¿æ³›çš„å…¨æ–‡æœç´¢å¼•æ“ï¼Œå®ƒè¢«å¹¿æ³›åº”ç”¨äºç”µå­å•†åŠ¡ã€ç¤¾äº¤ç½‘ç»œã€æ–°é—»åª’ä½“ã€åœ¨çº¿æ•™è‚²ç­‰é¢†åŸŸï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿæ£€ç´¢å’Œå‘ç°æ‰€éœ€ä¿¡æ¯ã€‚Manticore Search åœ¨ GitHub ä¸Šå¼€æºï¼Œæ‹¥æœ‰æ´»è·ƒçš„ç¤¾åŒºå’Œå¼€å‘è€…ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ GitHub ç¤¾åŒºè·å¾—æ”¯æŒå’Œè´¡çŒ®ä»£ç ã€‚\n4ã€Unsilence unsilence æ˜¯ä¸€ä¸ªåŸºäº Python çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºæ£€æµ‹å’Œä¿®å¤éŸ³é¢‘æ–‡ä»¶ä¸­çš„é™éŸ³åŒºåŸŸã€‚å®ƒå¯ä»¥å¸®åŠ©ç”¨æˆ·è‡ªåŠ¨æ£€æµ‹å’Œåˆ é™¤éŸ³é¢‘æ–‡ä»¶ä¸­çš„é™éŸ³éƒ¨åˆ†ï¼Œä»è€Œæé«˜éŸ³é¢‘çš„è´¨é‡å’Œå¯å¬æ€§ã€‚unsilence æ”¯æŒå¤šç§éŸ³é¢‘æ ¼å¼ï¼Œå¦‚ MP3ã€WAVã€OGG ç­‰ï¼Œå¯ä»¥åœ¨ä¸æŸå¤±éŸ³é¢‘è´¨é‡çš„æƒ…å†µä¸‹åˆ é™¤é™éŸ³ã€‚\nä½¿ç”¨ unsilence éå¸¸ç®€å•ï¼Œç”¨æˆ·åªéœ€åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ unsilence å‘½ä»¤å’ŒéŸ³é¢‘æ–‡ä»¶åï¼Œunsilence å°±ä¼šè‡ªåŠ¨æ£€æµ‹å’Œä¿®å¤éŸ³é¢‘æ–‡ä»¶ä¸­çš„é™éŸ³éƒ¨åˆ†ã€‚ç”¨æˆ·ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®å‚æ•°æ¥è°ƒæ•´ unsilence çš„å¤„ç†æ–¹å¼ï¼Œå¦‚è®¾ç½®æœ€å°é™éŸ³é•¿åº¦ã€æœ€å°éŸ³é‡é˜ˆå€¼ç­‰ã€‚\n5ã€CSS Bed è¿™ä¸ªç½‘é¡µæ”¶é›†å¹¶å±•ç¤ºå„ç§æ— ç±»çš„æç®€åŒ– CSS æ¡†æ¶ã€‚å¦‚æœä½ æƒ³é€‰ä¸€ä¸ªç®€å•çš„ CSS æ¡†æ¶ï¼Œå¯ä»¥çœ‹çœ‹å®ƒ\n6ã€lightrun lightrun.com æ˜¯ä¸€æ¬¾åŸºäºäº‘çš„å®æ—¶ Java å’Œ Kotlin åº”ç”¨ç¨‹åºè°ƒè¯•å’Œè§‚å¯Ÿå·¥å…·ã€‚å®ƒæä¾›äº†ä¸€ç§æ— éœ€ä¿®æ”¹ä»£ç å³å¯å®æ—¶è°ƒè¯• Java å’Œ Kotlin åº”ç”¨ç¨‹åºçš„æ–¹å¼ï¼Œå‡å°‘äº†å¼€å‘äººå‘˜çš„è°ƒè¯•æ—¶é—´ï¼Œæé«˜äº†åº”ç”¨ç¨‹åºçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚lightrun.com è¿˜æä¾›äº†å®æ—¶æ—¥å¿—æŸ¥çœ‹å’Œåˆ†æï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜å¿«é€Ÿå®šä½é—®é¢˜å’Œè§£å†³é—®é¢˜ï¼Œæé«˜äº†åº”ç”¨ç¨‹åºçš„å¯ç»´æŠ¤æ€§ã€‚\nlightrun.com å¯ä»¥ä¸å¸¸è§çš„ Java å¼€å‘å·¥å…·é›†æˆï¼Œå¦‚ Eclipseã€IntelliJ IDEA å’Œ VS Codeã€‚å®ƒè¿˜æ”¯æŒå¤šç§æ“ä½œç³»ç»Ÿå’Œäº‘å¹³å°ï¼Œå¦‚ Windowsã€Linuxã€Dockerã€AWS å’Œ Azure ç­‰ã€‚å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨ lightrun.com æ¥è°ƒè¯•å’Œç›‘è§†æœ¬åœ°åº”ç”¨ç¨‹åºï¼Œä¹Ÿå¯ä»¥åœ¨äº‘ç«¯å¿«é€Ÿè¯Šæ–­ç”Ÿäº§ç¯å¢ƒä¸­çš„é—®é¢˜ã€‚\nlightrun.com é‡‡ç”¨äº†å®‰å…¨çš„äº‘æ¶æ„ï¼Œå¹¶ä¸”ä½¿ç”¨äº†ç«¯åˆ°ç«¯åŠ å¯†æ¥ä¿æŠ¤ç”¨æˆ·æ•°æ®çš„å®‰å…¨æ€§ã€‚å®ƒè¿˜æä¾›äº†çµæ´»çš„è®¡è´¹æ¨¡å¼ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©é€‚åˆè‡ªå·±çš„è®¡è´¹æ–¹å¼ã€‚\n7ã€https://github.com/apps/cr-gpt åŸºäº ChatGPT çš„ Github Code Review æœºå™¨äºº\n8ã€å¦™è®°å¤š Mojidoc æ–°ä¸€ä»£ç”Ÿäº§ååŒå·¥å…·\nä»¥ä¸Šã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/03/07/weekly_review_9/","summary":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-02-27 åˆ° 2023-03-05 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¿™å‘¨çš„ä¸»è¦å·¥ä½œæ˜¯ç‰ˆæœ¬æµ‹è¯•å’Œé¡¹ç›®ä¸Šçº¿ï¼Œåœ¨å¤§å®¶çš„å…±åŒåŠªåŠ›ä¸‹ï¼Œæœ€åæ˜¯æˆåŠŸä¸Šçº¿ã€‚\nç”±äºå…¬å¸æœ€è¿‘åœ¨è£å‘˜ï¼Œç•™ä¸‹æ¥çš„éƒ½å¼€å§‹å·èµ·æ¥ï¼Œæ¯å¤©æ™šä¸Š 8 ç‚¹ä¹‹åä¸‹ç­ï¼Œè¿™æ ·å¹³å‡ä¸€å¤©çš„å·¥ä½œæ—¶é—´æ‰æœ‰ 11 å°æ—¶ã€‚æ®è¯´ï¼Œæ—è¾¹ç»„çš„åŒäº‹å¹³å‡æ¯å¤©éƒ½æ˜¯ 12 ä¸ªå°æ—¶å·¥ä½œæ—¶é—´ã€‚è£äº†ä¸‰ä½åŒäº‹ä¹‹åï¼Œæˆ‘ä»¬è½¯ä»¶ç»„è¿˜æœ‰ 8 äººï¼Œç®—æ³•ç»„æœ‰ 7 äººï¼Œäº§å“ç»„æœ‰ 6 äººï¼Œç»ˆç«¯ç»„æœ‰ 4 äººã€‚è·é›†å›¢å…¬å¸å…­æœˆä¸Šå¸‚è¿˜æœ‰ä¸¤ä¸ªæœˆï¼Œè£å‘˜ä¼°è®¡è¿˜ä¼šç»§ç»­ï¼ŒåŒå¿—ä»¬è¿˜éœ€åŠªåŠ›åŠ ç­ï¼Œäº‰å–è¢«è£çš„ä¸æ˜¯è‡ªå·±ã€‚\nè¿™å‘¨è¿˜æ˜¯æ²¡æœ‰å¼€è½¦ï¼Œæ¯å¤©ååœ°é“ä¸Šä¸‹ç­ï¼Œåˆ·åˆ· rss çœ‹çœ‹ b ç«™è§†é¢‘ï¼Œäº†è§£ä¸€äº›è¡Œä¸šæœ€æ–°åŠ¨æ€ï¼ŒåŒæ—¶ä¹Ÿçœ‹çœ‹åŒæ ·åœ¨å†™åšå®¢çš„é‚£äº›ç‹¬ç«‹å¼€å‘è€…æ¯å‘¨éƒ½åœ¨åšä»€ä¹ˆï¼Œä¹Ÿå­¦ä¹ ä¸€äº›æ–°æŠ€æœ¯æˆ–è€…æ–°æŠ€èƒ½ã€‚\nè¿™å‘¨æ¥è§¦äº† web3 ç©ºæŠ•ï¼ŒèŠ±äº†å‡ ä¸ªå°æ—¶ä½¿ç”¨è‡ªåŠ¨åŠ æ‰‹åŠ¨çš„æ–¹å¼åˆ·äº† 120 å¤šä¸ªè´¦å·ã€‚è‡ªåŠ¨çš„æ–¹å¼ï¼Œå°±æ˜¯ç”¨ nodejs ä»£ç åœ¨ bsc ç½‘ç»œæ‰¹é‡åˆ›å»ºè´¦å·å¹¶ä¿å­˜ä¸º csv æ–‡ä»¶ï¼›å…¶æ¬¡ï¼Œé€šè¿‡ onekey web ä¸Šçš„æ‰¹é‡è½¬è´¦åŠŸèƒ½ï¼Œç»™æ¯ä¸ªè´¦æˆ·è½¬äº† 0.00125bnbã€‚æ‰‹åŠ¨æ“ä½œçš„éƒ¨åˆ†å°±æ˜¯ï¼Œä¸€ä¸ªä¸ªçš„å°†è´¦å·ç§é’¥å¯¼å…¥ç‹ç‹¸é’±åŒ…ï¼Œç„¶åï¼Œç”¨ lifeform cartoon è¿æ¥é’±åŒ…è´¦æˆ·ï¼Œmint æˆåŠŸä¹‹åï¼Œåˆ†äº«é“¾æ¥ï¼Œå†ç»§ç»­è¿æ¥ç‹ç‹¸çš„ä¸‹ä¸€ä¸ªè´¦å·ï¼Œé‡å¤ä¸Šé¢æ“ä½œã€‚\nå› ä¸ºå¤ªè€—æ—¶é—´ï¼Œæ‰€ä»¥åªåˆ·äº† 120 ä¸ªè´¦å·ã€‚è¶å·¥ä½œä¸å¿™çš„æ—¶å€™ï¼Œç”¨ chatgpt æœç´¢ä¸€ä¸‹å¦‚ä½•å°†ä¸Šé¢çš„æ“ä½œå…¨éƒ¨è‡ªåŠ¨åŒ–ã€‚\nå‘¨æœ«ä¸¤å¤©ï¼Œç»§ç»­ç»ƒè½¦ï¼Œä»æ±‰å£åˆ°é˜³é€»ï¼Œå†åˆ°æ–°æ´²ï¼Œæœ€åå»æ–°æ´²çš„å°†å†›å±±çˆ¬å±±ã€å»é“è§‚æ²³çœ‹é£æ™¯ã€‚ç®—ä¸‹æ¥ï¼Œæœ€è¿‘è¿™ä¸‰ä¸ªå‘¨æœ«å…­å¤©æ—¶é—´ï¼Œæˆ‘ä¸€å…±å¼€äº† 800 å¤šå…¬é‡Œäº†ã€‚ç›®å‰ï¼Œæš‚æ—¶æ²¡æœ‰æ”¶åˆ°è¿è§„é€šçŸ¥ï¼Œä½†è¿˜æ˜¯å­˜åœ¨å¾ˆå¤šä¸è¶³çš„åœ°æ–¹ã€‚\nå¼€è½¦æ€»ç»“ è¿™å‘¨å¼€è½¦ï¼Œå‘ç°å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š\n1ã€åœè½¦è¿˜æ˜¯ä¼šå¿˜è®°ç†„ç«æ‹”é’¥åŒ™ã€‚ 2ã€çº¢ç»¿ç¯å£ï¼Œåœåœ¨å¤§è´§è½¦åé¢ï¼Œå¹¶é å¾—è¿‘ï¼Œå‰æ–¹è§†çº¿å—é˜»ã€‚ç»è¿‡çº¢ç»¿ç¯æ—¶ï¼Œæ„Ÿè§‰åƒæ˜¯é—¯äº†çº¢ç¯ã€‚ 3ã€è¶…è½¦æ—¶å€™ï¼Œæ²¡æœ‰åŠ é€Ÿã€‚ 4ã€åœ¨å±±è·¯è¡Œé©¶ï¼Œå…¥å¼¯å’Œå‡ºå¼¯éƒ½ä¼šå‡é€Ÿã€‚ 5ã€åˆ¤æ–­è½¦è·çš„ç»éªŒä¸è¶³ã€‚è¡¨ç°åœ¨è¡Œé©¶è¿‡ç¨‹ä¸­ã€ä¾§æ–¹åœè½¦ã€å€’è½¦å…¥åº“ã€‚ é’ˆå¯¹ä»¥ä¸Šé—®é¢˜ï¼Œæ™šä¸Šåˆ·äº†ä¸€äº›è§†é¢‘ï¼Œåšäº†ä¸€äº›ç¬”è®°ï¼Œå¸Œæœ›èƒ½å¤Ÿå¸®åŠ©è‡ªå·±æ”¹æ­£ä¸Šé¢è¿™äº›é—®é¢˜ã€‚\n1ã€ç›®å…‰çœ‹è¿œã€‚å…¥å¼¯æå‰æ”¶æ²¹ï¼Œè„šå¤‡åˆ¹è½¦ã€‚å¦‚æœå¼¯é“è¿‡æ€¥ï¼Œå°±å¸¦ç‚¹åˆ¹è½¦ï¼Œå¦‚æœè½¦é€Ÿä½ å¯ä»¥æ§åˆ¶ï¼Œç›´æ¥æ”¶æ²¹è¿‡å¼¯ï¼›å‡ºå¼¯åŠ æ²¹ï¼Œçœ¼ç›çœ‹å‡ºå¼¯å£ã€‚èº«ä½“è·Ÿéšæ–¹å‘ç›˜é ã€‚è¿™æ ·ï¼Œè½¦é€Ÿä¸é™ï¼Œå¯ä»¥æ§åˆ¶è½¦é€Ÿã€‚å¦‚æœä»¥ 80 ç é€Ÿåº¦è¿‡å¼¯ï¼Œä¸”è¿™ä¸ªè½¦è¿˜åœ¨è½¦é“å†…ï¼Œè¿™ä¸ªè½¦çš„é€Ÿåº¦ä½ å°±æ§åˆ¶ä½äº†ã€‚ä½†å‡¡æœ‰ç‚¹è¶Šçº¿ï¼Œè¯´æ˜è½¦é€Ÿè¿‡å¿«ï¼Œä½ å°±è¦é™ä½é€Ÿåº¦ã€‚\n2ã€é å³è¡Œé©¶ã€‚ä¼šè½¦æ—¶ï¼Œä¸»åŠ¨é å³ã€‚è½¬å¼¯æ—¶ï¼Œå‘ç°å¯¹é¢æœ‰æ¥è½¦ï¼Œé¸£ç¬›ç¤ºæ„ã€‚\n3ã€è·¯å£è¿œé“çš„åŸåˆ™ï¼Œè·Ÿå°è½¦ä¸è·Ÿå¤§è½¦ã€‚å¦‚æœè·Ÿç€å¤§è½¦ï¼Œç•™ä¸€ä¸ªè½¦ä½ç©ºé—´ï¼Œè®©å¤§è½¦å…ˆèµ°ï¼Œç¡®è®¤ç»¿ç¯å†èµ°ã€‚\n4ã€çº¢ç»¿ç¯è·¯å£ï¼Œæå‰å‡é€Ÿï¼Œæé†’åé¢è½¦å‡é€Ÿï¼Œä¸è¦æ€¥åˆ¹è½¦ï¼Œé˜²æ­¢åé¢è½¦è¿½å°¾ã€‚ç‰¹åˆ«æ˜¯åœ¨ç»¿ç¯é—ªçš„æ—¶å€™ï¼Œä¸è¦æ²¡æœ‰å‡é€Ÿï¼Œçªç„¶åœè½¦ã€‚å¦åˆ™åé¢è½¦ä¼šä»¥ä¸ºä½ è¦åŠ é€Ÿå†²è¿‡å»ï¼Œä»–ä¹ŸåŠ é€Ÿï¼Œè¿™æ ·ï¼Œä»–å°±ä¼šè¿½å°¾ä½ ã€‚\nåšå®¢è¯¥å†™ä»€ä¹ˆ çœ‹åˆ°ä¸€ç¯‡åšå®¢ What to blog aboutï¼Œé‡Œé¢èŠåˆ°äº†åšå®¢è¯¥å†™ä»€ä¹ˆã€‚ä¸€æ—¶å…´èµ·ï¼Œæƒ³ç¿»è¯‘æˆä¸­æ–‡ã€‚äºæ˜¯ï¼Œåˆ†åˆ«ä½¿ç”¨äº† chrome æ²‰æµ¸å¼ç¿»è¯‘æ’ä»¶å’Œ chatgpt æ¥ç¿»è¯‘è¿™ç¯‡æ–‡ç« ï¼Œå¾—åˆ°ç»“æœå¦‚ä¸‹ï¼š\n1ã€ä½¿ç”¨ chrome æ²‰æµ¸å¼ç¿»è¯‘æ’ä»¶ ç¿»è¯‘è¿™ç¯‡æ–‡ç« ï¼š\næ€»ç»“æ¥è¯´ï¼Œåšå®¢å¯ä»¥å†™ä¸¤éƒ¨åˆ†å†…å®¹ï¼š\nä»Šå¤©å­¦åˆ°çš„ä¸œè¥¿ æ­£åœ¨åšçš„é¡¹ç›® 2ã€ä½¿ç”¨ chatgpt ç¿»è¯‘è¿™ç¯‡æ–‡ç« ï¼š\nè¯· chatgpt ç¿»è¯‘è¿™ç¯‡æ–‡ç«  https://simonwillison.net/2022/Nov/6/what-to-blog-about/ ä¸ºä¸­æ–‡ï¼Œå¾—åˆ°çš„ç»“æœå¦‚ä¸‹ï¼š\næ ‡é¢˜ï¼šè¯¥å†™ä»€ä¹ˆåšå®¢ï¼Ÿ\néšç€æˆ‘å†™äº†ä¸€ç¯‡æ–°çš„åšå®¢æ–‡ç« ï¼Œæˆ‘æƒ³åˆ†äº«ä¸€ä¸‹æˆ‘æœ€è¿‘å­¦åˆ°çš„å…³äºå†™åšå®¢çš„ä¸€äº›äº‹æƒ…ã€‚\nä¸€æ—¦ä½ å¼€å§‹å†™åšå®¢ï¼Œä½ å°±å¿…é¡»ä¿æŒä¸€å®šçš„é¢‘ç‡å’ŒæŒç»­çš„å†…å®¹æ›´æ–°ã€‚è¿™ä¸ä»…æ˜¯ä¸ºäº†å¸å¼•å’Œä¿æŒè¯»è€…ï¼Œä¹Ÿæ˜¯ä¸ºäº†è®©è‡ªå·±ä¸æ–­æˆé•¿å’Œå‘å±•ã€‚å¯¹äºæˆ‘æ¥è¯´ï¼Œåšå®¢æ˜¯æˆ‘æœ€æœ‰ä»·å€¼çš„è‡ªæˆ‘è¡¨è¾¾å½¢å¼ä¹‹ä¸€ï¼Œå› ä¸ºå®ƒè¿«ä½¿æˆ‘å»æ€è€ƒå’Œç»„ç»‡æˆ‘çš„æƒ³æ³•ï¼Œè€Œè¿™äº›æƒ³æ³•å¯èƒ½ä¼šè¢«æ·¹æ²¡åœ¨æ—¥å¸¸ç”Ÿæ´»çš„å–§åš£ä¸­ã€‚\nä½†æ˜¯ï¼Œé€‰æ‹©åšå®¢å†…å®¹å¯ä»¥å¾ˆå›°éš¾ï¼Œç‰¹åˆ«æ˜¯å½“ä½ æœ‰å¤šä¸ªæ„Ÿå…´è¶£çš„è¯é¢˜å’Œé¡¹ç›®ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æˆ‘æœ€è¿‘å­¦åˆ°çš„æœ‰å…³é€‰æ‹©åšå®¢ä¸»é¢˜çš„æŠ€å·§ï¼š\næ¯å‘¨è‡³å°‘å†™ä¸€ç¯‡æ–‡ç«  å°½ç®¡è¿™å¯èƒ½å¬èµ·æ¥åƒä¸€ä¸ªè‰°å·¨çš„ä»»åŠ¡ï¼Œä½†ä¿æŒæ¯å‘¨è‡³å°‘å†™ä¸€ç¯‡æ–‡ç« çš„é¢‘ç‡å¯ä»¥å¸®åŠ©ä½ ä¿æŒå†™ä½œçš„ä¹ æƒ¯å’Œè¿›å±•ã€‚è¿™ä¹Ÿæœ‰åŠ©äºé¿å…é•¿æ—¶é—´çš„ç©ºç™½æœŸï¼Œè¿™å¯èƒ½ä¼šä½¿ä½ å¤±å»å†™ä½œçš„åŠ¨åŠ›å’Œè¯»è€…çš„å…´è¶£ã€‚","title":"å‘¨æŠ¥-9ï½œå¼€è½¦æ€»ç»“ã€åšå®¢è¯¥å†™ä»€ä¹ˆã€Web3æ‰¹é‡ç©ºæŠ•"},{"content":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-02-20 åˆ° 2023-02-26 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¿™ç¯‡å‘¨æŠ¥åˆæ˜¯åœ¨åœ°é“ä¸Šå®Œæˆç¼–å†™çš„ã€‚å›é¡¾è¿™ä¸€å‘¨çš„å·¥ä½œï¼Œè¿˜æ˜¯é¡¹ç›®æµ‹è¯•ã€ä¿®å¤ bug å’Œå‡†å¤‡ä¸Šçº¿å‘å¸ƒã€‚å¹³é™çš„å·¥ä½œèŠ‚å¥å› ä¸ºçªå¦‚å…¶æ¥çš„è£å‘˜æ¶ˆæ¯è€Œå˜å¾—å†…å·èµ·æ¥ï¼Œå¤§å®¶ä¸‹ç­çš„æ—¶é—´éƒ½çº·çº·å¾€åç§»åˆ°äº† 20 ç‚¹å·¦å³ã€‚å‘¨æœ«çš„æ—¶å€™ï¼Œè¿˜æ˜¯ç»ƒè½¦ï¼Œä»æ±‰å£å¼€è½¦åˆ°æ–°æ´²ã€‚åˆšå¼€å§‹æœ‰ç‚¹ä¸æ•¢ï¼Œåæ¥è¿˜æ˜¯é¼“èµ·å‹‡æ°”ï¼Œå¹³å®‰çš„åˆ°è¾¾ã€‚\nå·¥ä½œ å†…å­˜æ³„æ¼ è¿™å‘¨çº¿ä¸Šç¯å¢ƒï¼Œå‡ºç°äº†å‘Šè­¦ï¼Œæç¤º jvm å‡ºç°äº† full gcã€‚äºæ˜¯èµ¶ç´§ dump å†…å­˜è¿›è¡Œåˆ†ææŸ¥æ‰¾åŸå› ã€‚é¡ºä¾¿æ•´ç†äº†å†…å­˜ç›¸å…³çš„çŸ¥è¯†ã€‚\nä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼ï¼Ÿ\nè¿™ä¸ªé—®é¢˜ç›´æ¥é—® chatgptï¼š\nå†…å­˜æ³„æ¼ï¼ˆMemory Leakï¼‰æ˜¯æŒ‡åœ¨ç¨‹åºä¸­åŠ¨æ€åˆ†é…çš„å†…å­˜ç”±äºæŸäº›åŸå› ç¨‹åºæœªèƒ½é‡Šæ”¾æˆ–æ— æ³•é‡Šæ”¾ï¼Œå¯¼è‡´ç³»ç»Ÿå†…å­˜çš„å®é™…å¯ç”¨ç©ºé—´ä¸æ–­å‡å°‘çš„ç°è±¡ã€‚å†…å­˜æ³„æ¼çš„å‘ç”Ÿä¼šå¯¼è‡´ç¨‹åºå ç”¨çš„å†…å­˜è¶Šæ¥è¶Šå¤šï¼Œæœ€ç»ˆå¯¼è‡´ç¨‹åºå´©æºƒæˆ–ç³»ç»Ÿå˜æ…¢ã€‚\nåœ¨ Java ä¸­ï¼Œç¨‹åºå‘˜é€šå¸¸ä½¿ç”¨ new è¿ç®—ç¬¦åœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼Œè¿™äº›å†…å­˜ä¸å†ä½¿ç”¨æ—¶å¿…é¡»é‡Šæ”¾ï¼Œå¦åˆ™å°±ä¼šå‡ºç°å†…å­˜æ³„æ¼ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„ Java å†…å­˜æ³„æ¼çš„æƒ…å†µï¼š\nå¯¹è±¡æŒæœ‰è¿‡å¤šçš„å¼•ç”¨ å½“ä¸€ä¸ªå¯¹è±¡æŒæœ‰å…¶ä»–å¯¹è±¡çš„å¼•ç”¨æ—¶ï¼Œè¿™äº›å¯¹è±¡å°±ä¸èƒ½è¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªé™æ€é›†åˆï¼ˆå¦‚ Mapã€Listï¼‰æŒæœ‰äº†å¤§é‡å¯¹è±¡çš„å¼•ç”¨ï¼Œä½†æ˜¯è¿™äº›å¯¹è±¡å·²ç»ä¸å†éœ€è¦äº†ï¼Œå´å› ä¸ºé›†åˆä¸­ä»ç„¶æŒæœ‰è¿™äº›å¯¹è±¡çš„å¼•ç”¨ï¼Œå¯¼è‡´è¿™äº›å¯¹è±¡æ— æ³•è¢«å›æ”¶ï¼Œé€ æˆå†…å­˜æ³„æ¼ã€‚\né•¿æ—¶é—´æŒæœ‰å¯¹è±¡é” åœ¨ Java ä¸­ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹è·å–äº†ä¸€ä¸ªå¯¹è±¡çš„é”ï¼Œä½†æ˜¯åœ¨é‡Šæ”¾é”ä¹‹å‰å‘ç”Ÿäº†å¼‚å¸¸ï¼Œé‚£ä¹ˆè¿™ä¸ªé”å°±ä¸ä¼šè¢«é‡Šæ”¾ï¼Œä»è€Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚è¿™ç§æƒ…å†µç‰¹åˆ«å®¹æ˜“å‘ç”Ÿåœ¨ synchronized å—ä¸­ã€‚\nä¸æ­£ç¡®çš„ç¼“å­˜ä½¿ç”¨ å¦‚æœç¨‹åºå‘˜ä¸æ­£ç¡®åœ°ä½¿ç”¨ç¼“å­˜ï¼Œå°±ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚æ¯”å¦‚ï¼Œå¦‚æœä½¿ç”¨ä¸€ä¸ªé™æ€ Map æ¥ç¼“å­˜å¯¹è±¡ï¼Œä½†æ˜¯ä¸ä» Map ä¸­åˆ é™¤å¯¹è±¡ï¼Œé‚£ä¹ˆè¿™äº›å¯¹è±¡å°±ä¼šä¸€ç›´å­˜åœ¨äºå†…å­˜ä¸­ï¼Œé€ æˆå†…å­˜æ³„æ¼ã€‚\nå¤§é‡åˆ›å»ºä¸´æ—¶å¯¹è±¡ å¦‚æœç¨‹åºé¢‘ç¹åœ°åˆ›å»ºä¸´æ—¶å¯¹è±¡ï¼Œè€Œè¿™äº›å¯¹è±¡åˆæ²¡æœ‰è¢«åŠæ—¶æ¸…é™¤ï¼Œå°±ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚æ¯”å¦‚ï¼Œåœ¨å¾ªç¯ä¸­åˆ›å»ºå¤§é‡çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œä½†æ˜¯æ²¡æœ‰åŠæ—¶æ¸…é™¤ï¼Œå°±ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚\nä¸ºäº†é¿å…å†…å­˜æ³„æ¼ï¼ŒJava ç¨‹åºå‘˜å¯ä»¥ä½¿ç”¨ä¸€äº›æŠ€æœ¯æ¥ä¼˜åŒ–ç¨‹åºï¼Œæ¯”å¦‚ä½¿ç”¨ç¼“å­˜æ± ã€é¿å…ä½¿ç”¨ä¸å¿…è¦çš„é™æ€å˜é‡ã€ä½¿ç”¨ finalize()æ–¹æ³•é‡Šæ”¾èµ„æºç­‰ç­‰ã€‚\nå¦‚ä½•æ’æŸ¥å†…å­˜æ³„æ¼ï¼Ÿ\nå†…å­˜åˆ†æå·¥å…·ï¼šå†…å­˜åˆ†æå·¥å…·å¯ä»¥å¸®åŠ©æ‚¨æ‰¾åˆ°å“ªäº›å¯¹è±¡å ç”¨äº†å¤§é‡çš„å†…å­˜ã€‚ä¸€äº›å¸¸ç”¨çš„å†…å­˜åˆ†æå·¥å…·åŒ…æ‹¬ï¼šEclipse MATã€VisualVM å’Œ YourKitã€‚è¿™äº›å·¥å…·å¯ä»¥å¸®åŠ©æ‚¨åˆ†æå†…å­˜å¿«ç…§ã€æŸ¥æ‰¾å†…å­˜æ³„æ¼å¹¶ç¡®å®šå¯¼è‡´å†…å­˜æ³„æ¼çš„ä»£ç ä½ç½®ã€‚\nå †è½¬å‚¨æ–‡ä»¶ï¼šå †è½¬å‚¨æ–‡ä»¶æ˜¯ä¸€ä¸ªåŒ…å«äº† JVM å †ä¸­æ‰€æœ‰å¯¹è±¡çš„å¿«ç…§ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç”Ÿæˆä¸€ä¸ªå †è½¬å‚¨æ–‡ä»¶ï¼šjmap -dump:format=b,file=heap.bin ï¼Œå…¶ä¸­æ˜¯æ‚¨çš„ Java åº”ç”¨ç¨‹åºçš„è¿›ç¨‹ IDã€‚ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å†…å­˜åˆ†æå·¥å…·æ¥åˆ†æè¯¥æ–‡ä»¶ã€‚\nä»£ç å®¡æŸ¥ï¼šåœ¨ç¼–å†™ä»£ç æ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸€äº›æŠ€å·§æ¥é¿å…å†…å­˜æ³„æ¼ã€‚ä¾‹å¦‚ï¼Œæ‚¨åº”è¯¥ç¡®ä¿æ­£ç¡®åœ°å…³é—­æµå’Œæ•°æ®åº“è¿æ¥ï¼Œé¿å…åœ¨å¾ªç¯ä¸­åˆ›å»ºå¯¹è±¡ï¼Œä»¥åŠä½¿ç”¨è½¯å¼•ç”¨æˆ–å¼±å¼•ç”¨æ¥å­˜å‚¨ç¼“å­˜æ•°æ®ç­‰ã€‚é€šè¿‡ä»”ç»†å®¡æŸ¥ä»£ç å¹¶è¯†åˆ«å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼çš„éƒ¨åˆ†ï¼Œå¯ä»¥é¿å…è¿™äº›é—®é¢˜åœ¨è¿è¡Œæ—¶å‘ç”Ÿã€‚\nç›‘è§†å·¥å…·ï¼šJVM æä¾›äº†ä¸€äº›ç›‘è§†å·¥å…·ï¼Œä¾‹å¦‚ jstat å’Œ jconsoleï¼Œå¯ä»¥ç”¨äºç›‘è§† JVM çš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚é€šè¿‡ç›‘è§†è¿™äº›æŒ‡æ ‡ï¼Œæ‚¨å¯ä»¥è¯†åˆ«æ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼çš„è¿¹è±¡ã€‚\nä»£ç æ³¨å…¥ï¼šåœ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¸­ï¼Œæ‚¨å¯ä»¥æ³¨å…¥ä¸€äº›ä»£ç ï¼Œä¾‹å¦‚ä½¿ç”¨ JMXã€AOP ç­‰ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥å®æ—¶ç›‘è§†å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå¹¶è®°å½•ä»»ä½•å†…å­˜æ³„æ¼è¿¹è±¡ã€‚\nå‚è€ƒæ–‡ç« \nä¸€æ¬¡å®Œæ•´çš„ JVM å †å¤–å†…å­˜æ³„æ¼æ•…éšœæ’æŸ¥è®°å½•\næ·±å…¥æ¢ç´¢ Java 8 Lambda è¡¨è¾¾å¼\njava lambda è¡¨è¾¾å¼å†…å­˜æ³„éœ²_æµ…è°ˆ Java å†…å­˜æ³„éœ²\nè£å‘˜ å»å¹´å…¬å¸å°±åœ¨è£å‘˜ï¼Œé™†é™†ç»­ç»­è£äº†å‡ æ¬¡ï¼Œæ¯æ¬¡éƒ½æ˜¯è£ä¸¤ä¸‰ä¸ªï¼ŒåŠ¨ä½œéƒ½ä¸å¤§ï¼Œä½†æ˜¯å¾ˆé«˜æ•ˆã€‚å› ä¸ºéƒ¨é—¨äººæ•°å°±åœ¨äº”åå·¦å³ï¼Œæ‰€ä»¥è°æ²¡æ¥ä¸Šç­ï¼Œéƒ½èƒ½å¾ˆå¿«å¯Ÿè§‰ã€‚\nå…¬å¸è¦åœ¨å…­æœˆä»½ä¸Šå¸‚ï¼Œä¸Šå¸‚ä¹‹å‰è¦ä½¿è´¢æŠ¥å¥½çœ‹ï¼Œå°±è¦å¼€æºèŠ‚æµã€é™æœ¬å¢æ•ˆã€‚èŠ‚çº¦æˆæœ¬çš„ä¸€ä¸ªæ–¹å¼å°±æ˜¯è£å‘˜ï¼Œæ®è¯´è¿™æ¬¡è£å‘˜åŠ¨ä½œæ¯”ä»¥å‰éƒ½å¤§éƒ½è¿…é€Ÿï¼Œä»Šå¤©æå‡ºè£å‘˜äººæ•°ï¼Œæ˜å¤©å°±è¦ç»™å‡ºåå•ï¼Œæœˆåº•å°±è¦èµ°äººã€‚\nç°åœ¨è¿˜åªæ˜¯äºŒæœˆä»½ï¼Œç¦»å…­æœˆè¿˜æœ‰ä¸‰ä¸ªæœˆã€‚è°ä¹Ÿä¸çŸ¥é“ï¼Œåé¢è¿˜ä¼šæœ‰ä»€ä¹ˆæ›´å¤§çš„è£å‘˜åŠ¨ä½œã€‚è¯´ä¸å®šå“ªå¤©å°±ç©ºå‡ºä¸€ä¸ªå·¥ä½ï¼Œè¯´ä¸å®šå“ªå¤©é¢†å¯¼å°±æ¢äº†äººï¼Œè¯´ä¸å®šå“ªå¤©éƒ¨é—¨å°±è¢«æ‹†æ•£äº†ã€‚\näº’è”ç½‘å…¬å¸æœ€å¤§çš„å˜åŒ–å°±æ˜¯å˜åŒ–ã€‚ä¹‹å‰åœ¨é˜¿é‡Œå·¥ä½œï¼Œå…¬å¸çš„ä»·å€¼è§‚é‡Œæœ‰ä¸€æ¡å°±æ˜¯æ‹¥æŠ±å˜åŒ–ã€‚\næ‹¥æŠ±å˜åŒ–çš„æœ€å¥½æ–¹å¼å°±æ˜¯ç§¯æé¢å¯¹ï¼Œä¸»åŠ¨åŠ ç­ï¼Œæé«˜å·¥ä½œæ•ˆç‡ï¼Œå¢åŠ å·¥ä½œäº§å‡ºã€‚\nç”Ÿæ´» ç»ƒè½¦ è¿™æ˜¯ä¹°è½¦ä¹‹åçš„ç¬¬äºŒå‘¨ï¼Œè¿˜æ˜¯æ²¡æœ‰å¼€è½¦å»ä¸Šç­ã€‚ä¸€æ˜¯å› ä¸ºå¼€è½¦ä¸è¿‡ç†Ÿç»ƒï¼Œèƒ†å­å°ï¼Œä¸æ•¢å¼€å¾—å¤ªå¿«ï¼›äºŒæ˜¯å…¬å¸æ¥¼ä¸‹çš„åœè½¦ä½è¿˜æ²¡æœ‰åŠå¥½ã€‚\nå‘¨å…­æœ¬æƒ³å«æœ‹å‹è¿‡æ¥ç»™æˆ‘å½“é™ªç»ƒï¼Œåæ¥å› ä¸ºè¦å›æ–°æ´²ï¼Œå°±ç®—äº†ï¼Œè¿˜æ˜¯è‡ªå·±å¼€è½¦ï¼Œå¸¦ç€è€å©†å›æ–°æ´²ã€‚\nè€å©†ç§‘ç›®ä¸€è€ƒè¿‡äº†ï¼Œåé¢å› ä¸ºå·¥ä½œåŸå› å°±æ²¡å»ç»ƒè½¦å’Œè€ƒè¯•ã€‚å¥¹åå‰¯é©¾é©¶ï¼Œä¸€è¾¹å‰¥è±†å­ä¸€è¾¹æé†’æˆ‘æ³¨æ„äº¤é€šè§„åˆ™ã€‚\nåœ¨è€å©†çš„åé•‡ä¹‹ä¸‹ï¼Œé¡ºåˆ©çš„ä»æ±‰å£å¼€è½¦å…­åå…¬é‡Œåˆ°è¾¾æ–°æ´²ï¼Œè·¯ä¸Šæ²¡æœ‰è¿åäº¤é€šè§„åˆ™ã€‚\nå‘¨å…­ä¸‹åˆå»çœ‹äº†ä¸€ä¸‹æ½˜å¡˜èŠ±æœèŠ‚ï¼Œæœ‰ç‚¹å¤±æœ›ï¼Œæ²¡æœ‰æƒ³è±¡ä¸­çš„çƒ­é—¹ã€‚å¯èƒ½å› ä¸ºè¿™ä¸æ˜¯æ­£å®—çš„èŠ±æœèŠ‚ï¼Œæ­£å®—çš„åº”è¯¥æ˜¯åœ¨æ—§è¡—ã€‚\né€›äº†ä¸€åœˆï¼Œä¹°äº†ä¸¤ç™¾èœåˆ€ã€ä¸€ä¸ªç §æ¿ã€ä¸¤é¢—æœæ ‘ã€ä¸€ç›†å¢¨å…°èŠ±ã€‚\nå‘¨å…­ä»æ–°æ´²å¼€å›é˜³é€»ï¼Œå‘¨æ—¥åˆä»é˜³é€»å¼€å›è€å®¶å»çœ‹çˆ¶äº²ã€‚ä¹°è½¦åç¬¬ä¸€æ¬¡å›å®¶ï¼Œæ”¾äº†é­ç‚® ğŸ§¨ã€‚\nä¸­åˆåŒ…é¥ºå­ï¼Œåƒå®Œé¥­å°±å»èœå›­æ”¶å‰²é’èœã€‚å†œæ‘å¯¹äºåŸå¸‚é‡Œä¸Šç­æ—æ¥è¯´ï¼Œä¸€å¤§å¥½å¤„æ˜¯ï¼Œæ¯æ¬¡å›å®¶ï¼Œéƒ½å¯ä»¥è£…æ»¡é’èœå¸¦å›åŸå¸‚ã€‚\nä¸‹åˆï¼Œä»è€å®¶é©±è½¦å›é˜³é€»å†åˆ°æ±‰å£ã€‚åœ¨å¼€è½¦çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°å’Œæ€»ç»“äº†ä¸€äº›é—®é¢˜ã€‚\nä¹‹å‰å¼€è½¦ï¼Œæ€»æ˜¯ç›¯ç€ä»ªè¡¨ç›˜ï¼Œçœ‹è½¦é€Ÿè¾¾åˆ°äº†å¤šå°‘ã€‚è½¦é€Ÿä¸€åˆ° 70 å¤šå°±ä¸‹æ„è¯†åœ°æ¾æ²¹é—¨å’Œè¸©åˆ¹è½¦ã€‚ç°åœ¨å¼€å§‹æŠŠçœ¼ç›æ³¨æ„åŠ›æ”¾åˆ°å‰æ–¹ï¼Œä¸å»å¯ä»¥åœ¨æ„è½¦é€Ÿï¼Œåªæ˜¯å½“å¯¼èˆªæç¤ºæˆ‘è¶…é€Ÿçš„æ—¶å€™ï¼Œæˆ‘ç™½é™ä½ä¸€ç‚¹é€Ÿåº¦ã€‚\nåœ¨çº¢ç»¿ç¯ä¹‹å‰ï¼Œå¦‚æœä¸è½¬å¼¯ï¼Œä¸è¦æå‰æ¢é“æˆ–è€…è¶…è½¦ï¼Œä¿æŒä¸­é—´é“è·¯è¡Œé©¶å³å¯ã€‚\nå¥½ç‰©åˆ†äº« è™½ç„¶å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€ChenSoul Shareã€Telegram é¢‘é“ï¼Œä¸è¿‡è¿˜æ˜¯æŒ‘é€‰ä¸€éƒ¨åˆ†åœ¨è¿™é‡Œåˆ—ä¸¾ä¸€ä¸‹ï¼Œæ„Ÿè§‰æ›´åƒä¸€ä¸ª newsletter äº†ã€‚\nä¸€äº›æ–‡ç«  ä½¿ç”¨ GitHub Actions è‡ªåŠ¨ç”³è¯·ä¸éƒ¨ç½² SSL è¯ä¹¦\nThe AI search engine for developers\nç”¨ AI å†™æ–‡ç« \njava lambda è¡¨è¾¾å¼å†…å­˜æ³„éœ²_æµ…è°ˆ Java å†…å­˜æ³„éœ²\nåœ¨å®¶èººç€æ‹¿å·¥èµ„ï¼Œæ˜¯æŒºè¿‡æ„ä¸å»çš„\nè½¦è¾†è¿ç« å’Œäº¤é€šäº‹æ•…å¤„ç†æµç¨‹\næµ…è°ˆ Code Review ä¹‹äº‹å‰å‡†å¤‡\nä¸€äº›å·¥å…· 1ã€Raycast Raycast æ˜¯ä¸€æ¬¾æƒ³è¦å–ä»£ Spotlight çš„å¿«æ·å¯åŠ¨å™¨ï¼Œé€šè¿‡ Mac ä¸Šé¢çš„ä¸€äº›ç»„åˆé”®æ¥ä¸ºè®©ä½ å®Œæˆåœ¨ Mac ä¸Šé¢çš„å¿«æ·å¯åŠ¨ï¼Œæé«˜ä½ æ—¥å¸¸å½“ä¸­åœ¨ Mac ä¸Šé¢çš„æ“ä½œæ•ˆç‡ï¼Œå¦‚æœä»¥ macOS ç³»ç»Ÿç‰ˆæœ¬é£æ ¼æ¥æ¯”å–»çš„è¯ï¼ŒAlfred çš„ UI é£æ ¼åº”è¯¥èƒ½åŒ¹é…å‡ å¹´å‰çš„ macOS å§ï¼Œè€Œ Raycast å´æ˜¯èƒ½å¤Ÿé©¾é©­ macOS Big Sur å…¨æ–°çš„è§†è§‰é£æ ¼ã€‚\nä»¥ä¸Šã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/02/27/weekly_review_8/","summary":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-02-20 åˆ° 2023-02-26 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¿™ç¯‡å‘¨æŠ¥åˆæ˜¯åœ¨åœ°é“ä¸Šå®Œæˆç¼–å†™çš„ã€‚å›é¡¾è¿™ä¸€å‘¨çš„å·¥ä½œï¼Œè¿˜æ˜¯é¡¹ç›®æµ‹è¯•ã€ä¿®å¤ bug å’Œå‡†å¤‡ä¸Šçº¿å‘å¸ƒã€‚å¹³é™çš„å·¥ä½œèŠ‚å¥å› ä¸ºçªå¦‚å…¶æ¥çš„è£å‘˜æ¶ˆæ¯è€Œå˜å¾—å†…å·èµ·æ¥ï¼Œå¤§å®¶ä¸‹ç­çš„æ—¶é—´éƒ½çº·çº·å¾€åç§»åˆ°äº† 20 ç‚¹å·¦å³ã€‚å‘¨æœ«çš„æ—¶å€™ï¼Œè¿˜æ˜¯ç»ƒè½¦ï¼Œä»æ±‰å£å¼€è½¦åˆ°æ–°æ´²ã€‚åˆšå¼€å§‹æœ‰ç‚¹ä¸æ•¢ï¼Œåæ¥è¿˜æ˜¯é¼“èµ·å‹‡æ°”ï¼Œå¹³å®‰çš„åˆ°è¾¾ã€‚\nå·¥ä½œ å†…å­˜æ³„æ¼ è¿™å‘¨çº¿ä¸Šç¯å¢ƒï¼Œå‡ºç°äº†å‘Šè­¦ï¼Œæç¤º jvm å‡ºç°äº† full gcã€‚äºæ˜¯èµ¶ç´§ dump å†…å­˜è¿›è¡Œåˆ†ææŸ¥æ‰¾åŸå› ã€‚é¡ºä¾¿æ•´ç†äº†å†…å­˜ç›¸å…³çš„çŸ¥è¯†ã€‚\nä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼ï¼Ÿ\nè¿™ä¸ªé—®é¢˜ç›´æ¥é—® chatgptï¼š\nå†…å­˜æ³„æ¼ï¼ˆMemory Leakï¼‰æ˜¯æŒ‡åœ¨ç¨‹åºä¸­åŠ¨æ€åˆ†é…çš„å†…å­˜ç”±äºæŸäº›åŸå› ç¨‹åºæœªèƒ½é‡Šæ”¾æˆ–æ— æ³•é‡Šæ”¾ï¼Œå¯¼è‡´ç³»ç»Ÿå†…å­˜çš„å®é™…å¯ç”¨ç©ºé—´ä¸æ–­å‡å°‘çš„ç°è±¡ã€‚å†…å­˜æ³„æ¼çš„å‘ç”Ÿä¼šå¯¼è‡´ç¨‹åºå ç”¨çš„å†…å­˜è¶Šæ¥è¶Šå¤šï¼Œæœ€ç»ˆå¯¼è‡´ç¨‹åºå´©æºƒæˆ–ç³»ç»Ÿå˜æ…¢ã€‚\nåœ¨ Java ä¸­ï¼Œç¨‹åºå‘˜é€šå¸¸ä½¿ç”¨ new è¿ç®—ç¬¦åœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼Œè¿™äº›å†…å­˜ä¸å†ä½¿ç”¨æ—¶å¿…é¡»é‡Šæ”¾ï¼Œå¦åˆ™å°±ä¼šå‡ºç°å†…å­˜æ³„æ¼ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„ Java å†…å­˜æ³„æ¼çš„æƒ…å†µï¼š\nå¯¹è±¡æŒæœ‰è¿‡å¤šçš„å¼•ç”¨ å½“ä¸€ä¸ªå¯¹è±¡æŒæœ‰å…¶ä»–å¯¹è±¡çš„å¼•ç”¨æ—¶ï¼Œè¿™äº›å¯¹è±¡å°±ä¸èƒ½è¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªé™æ€é›†åˆï¼ˆå¦‚ Mapã€Listï¼‰æŒæœ‰äº†å¤§é‡å¯¹è±¡çš„å¼•ç”¨ï¼Œä½†æ˜¯è¿™äº›å¯¹è±¡å·²ç»ä¸å†éœ€è¦äº†ï¼Œå´å› ä¸ºé›†åˆä¸­ä»ç„¶æŒæœ‰è¿™äº›å¯¹è±¡çš„å¼•ç”¨ï¼Œå¯¼è‡´è¿™äº›å¯¹è±¡æ— æ³•è¢«å›æ”¶ï¼Œé€ æˆå†…å­˜æ³„æ¼ã€‚\né•¿æ—¶é—´æŒæœ‰å¯¹è±¡é” åœ¨ Java ä¸­ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹è·å–äº†ä¸€ä¸ªå¯¹è±¡çš„é”ï¼Œä½†æ˜¯åœ¨é‡Šæ”¾é”ä¹‹å‰å‘ç”Ÿäº†å¼‚å¸¸ï¼Œé‚£ä¹ˆè¿™ä¸ªé”å°±ä¸ä¼šè¢«é‡Šæ”¾ï¼Œä»è€Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚è¿™ç§æƒ…å†µç‰¹åˆ«å®¹æ˜“å‘ç”Ÿåœ¨ synchronized å—ä¸­ã€‚\nä¸æ­£ç¡®çš„ç¼“å­˜ä½¿ç”¨ å¦‚æœç¨‹åºå‘˜ä¸æ­£ç¡®åœ°ä½¿ç”¨ç¼“å­˜ï¼Œå°±ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚æ¯”å¦‚ï¼Œå¦‚æœä½¿ç”¨ä¸€ä¸ªé™æ€ Map æ¥ç¼“å­˜å¯¹è±¡ï¼Œä½†æ˜¯ä¸ä» Map ä¸­åˆ é™¤å¯¹è±¡ï¼Œé‚£ä¹ˆè¿™äº›å¯¹è±¡å°±ä¼šä¸€ç›´å­˜åœ¨äºå†…å­˜ä¸­ï¼Œé€ æˆå†…å­˜æ³„æ¼ã€‚\nå¤§é‡åˆ›å»ºä¸´æ—¶å¯¹è±¡ å¦‚æœç¨‹åºé¢‘ç¹åœ°åˆ›å»ºä¸´æ—¶å¯¹è±¡ï¼Œè€Œè¿™äº›å¯¹è±¡åˆæ²¡æœ‰è¢«åŠæ—¶æ¸…é™¤ï¼Œå°±ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚æ¯”å¦‚ï¼Œåœ¨å¾ªç¯ä¸­åˆ›å»ºå¤§é‡çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œä½†æ˜¯æ²¡æœ‰åŠæ—¶æ¸…é™¤ï¼Œå°±ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚\nä¸ºäº†é¿å…å†…å­˜æ³„æ¼ï¼ŒJava ç¨‹åºå‘˜å¯ä»¥ä½¿ç”¨ä¸€äº›æŠ€æœ¯æ¥ä¼˜åŒ–ç¨‹åºï¼Œæ¯”å¦‚ä½¿ç”¨ç¼“å­˜æ± ã€é¿å…ä½¿ç”¨ä¸å¿…è¦çš„é™æ€å˜é‡ã€ä½¿ç”¨ finalize()æ–¹æ³•é‡Šæ”¾èµ„æºç­‰ç­‰ã€‚\nå¦‚ä½•æ’æŸ¥å†…å­˜æ³„æ¼ï¼Ÿ\nå†…å­˜åˆ†æå·¥å…·ï¼šå†…å­˜åˆ†æå·¥å…·å¯ä»¥å¸®åŠ©æ‚¨æ‰¾åˆ°å“ªäº›å¯¹è±¡å ç”¨äº†å¤§é‡çš„å†…å­˜ã€‚ä¸€äº›å¸¸ç”¨çš„å†…å­˜åˆ†æå·¥å…·åŒ…æ‹¬ï¼šEclipse MATã€VisualVM å’Œ YourKitã€‚è¿™äº›å·¥å…·å¯ä»¥å¸®åŠ©æ‚¨åˆ†æå†…å­˜å¿«ç…§ã€æŸ¥æ‰¾å†…å­˜æ³„æ¼å¹¶ç¡®å®šå¯¼è‡´å†…å­˜æ³„æ¼çš„ä»£ç ä½ç½®ã€‚\nå †è½¬å‚¨æ–‡ä»¶ï¼šå †è½¬å‚¨æ–‡ä»¶æ˜¯ä¸€ä¸ªåŒ…å«äº† JVM å †ä¸­æ‰€æœ‰å¯¹è±¡çš„å¿«ç…§ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç”Ÿæˆä¸€ä¸ªå †è½¬å‚¨æ–‡ä»¶ï¼šjmap -dump:format=b,file=heap.bin ï¼Œå…¶ä¸­æ˜¯æ‚¨çš„ Java åº”ç”¨ç¨‹åºçš„è¿›ç¨‹ IDã€‚ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å†…å­˜åˆ†æå·¥å…·æ¥åˆ†æè¯¥æ–‡ä»¶ã€‚\nä»£ç å®¡æŸ¥ï¼šåœ¨ç¼–å†™ä»£ç æ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸€äº›æŠ€å·§æ¥é¿å…å†…å­˜æ³„æ¼ã€‚ä¾‹å¦‚ï¼Œæ‚¨åº”è¯¥ç¡®ä¿æ­£ç¡®åœ°å…³é—­æµå’Œæ•°æ®åº“è¿æ¥ï¼Œé¿å…åœ¨å¾ªç¯ä¸­åˆ›å»ºå¯¹è±¡ï¼Œä»¥åŠä½¿ç”¨è½¯å¼•ç”¨æˆ–å¼±å¼•ç”¨æ¥å­˜å‚¨ç¼“å­˜æ•°æ®ç­‰ã€‚é€šè¿‡ä»”ç»†å®¡æŸ¥ä»£ç å¹¶è¯†åˆ«å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼çš„éƒ¨åˆ†ï¼Œå¯ä»¥é¿å…è¿™äº›é—®é¢˜åœ¨è¿è¡Œæ—¶å‘ç”Ÿã€‚\nç›‘è§†å·¥å…·ï¼šJVM æä¾›äº†ä¸€äº›ç›‘è§†å·¥å…·ï¼Œä¾‹å¦‚ jstat å’Œ jconsoleï¼Œå¯ä»¥ç”¨äºç›‘è§† JVM çš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚é€šè¿‡ç›‘è§†è¿™äº›æŒ‡æ ‡ï¼Œæ‚¨å¯ä»¥è¯†åˆ«æ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼çš„è¿¹è±¡ã€‚\nä»£ç æ³¨å…¥ï¼šåœ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¸­ï¼Œæ‚¨å¯ä»¥æ³¨å…¥ä¸€äº›ä»£ç ï¼Œä¾‹å¦‚ä½¿ç”¨ JMXã€AOP ç­‰ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥å®æ—¶ç›‘è§†å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå¹¶è®°å½•ä»»ä½•å†…å­˜æ³„æ¼è¿¹è±¡ã€‚\nå‚è€ƒæ–‡ç« \nä¸€æ¬¡å®Œæ•´çš„ JVM å †å¤–å†…å­˜æ³„æ¼æ•…éšœæ’æŸ¥è®°å½•\næ·±å…¥æ¢ç´¢ Java 8 Lambda è¡¨è¾¾å¼\njava lambda è¡¨è¾¾å¼å†…å­˜æ³„éœ²_æµ…è°ˆ Java å†…å­˜æ³„éœ²\nè£å‘˜ å»å¹´å…¬å¸å°±åœ¨è£å‘˜ï¼Œé™†é™†ç»­ç»­è£äº†å‡ æ¬¡ï¼Œæ¯æ¬¡éƒ½æ˜¯è£ä¸¤ä¸‰ä¸ªï¼ŒåŠ¨ä½œéƒ½ä¸å¤§ï¼Œä½†æ˜¯å¾ˆé«˜æ•ˆã€‚å› ä¸ºéƒ¨é—¨äººæ•°å°±åœ¨äº”åå·¦å³ï¼Œæ‰€ä»¥è°æ²¡æ¥ä¸Šç­ï¼Œéƒ½èƒ½å¾ˆå¿«å¯Ÿè§‰ã€‚\nå…¬å¸è¦åœ¨å…­æœˆä»½ä¸Šå¸‚ï¼Œä¸Šå¸‚ä¹‹å‰è¦ä½¿è´¢æŠ¥å¥½çœ‹ï¼Œå°±è¦å¼€æºèŠ‚æµã€é™æœ¬å¢æ•ˆã€‚èŠ‚çº¦æˆæœ¬çš„ä¸€ä¸ªæ–¹å¼å°±æ˜¯è£å‘˜ï¼Œæ®è¯´è¿™æ¬¡è£å‘˜åŠ¨ä½œæ¯”ä»¥å‰éƒ½å¤§éƒ½è¿…é€Ÿï¼Œä»Šå¤©æå‡ºè£å‘˜äººæ•°ï¼Œæ˜å¤©å°±è¦ç»™å‡ºåå•ï¼Œæœˆåº•å°±è¦èµ°äººã€‚\nç°åœ¨è¿˜åªæ˜¯äºŒæœˆä»½ï¼Œç¦»å…­æœˆè¿˜æœ‰ä¸‰ä¸ªæœˆã€‚è°ä¹Ÿä¸çŸ¥é“ï¼Œåé¢è¿˜ä¼šæœ‰ä»€ä¹ˆæ›´å¤§çš„è£å‘˜åŠ¨ä½œã€‚è¯´ä¸å®šå“ªå¤©å°±ç©ºå‡ºä¸€ä¸ªå·¥ä½ï¼Œè¯´ä¸å®šå“ªå¤©é¢†å¯¼å°±æ¢äº†äººï¼Œè¯´ä¸å®šå“ªå¤©éƒ¨é—¨å°±è¢«æ‹†æ•£äº†ã€‚\näº’è”ç½‘å…¬å¸æœ€å¤§çš„å˜åŒ–å°±æ˜¯å˜åŒ–ã€‚ä¹‹å‰åœ¨é˜¿é‡Œå·¥ä½œï¼Œå…¬å¸çš„ä»·å€¼è§‚é‡Œæœ‰ä¸€æ¡å°±æ˜¯æ‹¥æŠ±å˜åŒ–ã€‚\næ‹¥æŠ±å˜åŒ–çš„æœ€å¥½æ–¹å¼å°±æ˜¯ç§¯æé¢å¯¹ï¼Œä¸»åŠ¨åŠ ç­ï¼Œæé«˜å·¥ä½œæ•ˆç‡ï¼Œå¢åŠ å·¥ä½œäº§å‡ºã€‚\nç”Ÿæ´» ç»ƒè½¦ è¿™æ˜¯ä¹°è½¦ä¹‹åçš„ç¬¬äºŒå‘¨ï¼Œè¿˜æ˜¯æ²¡æœ‰å¼€è½¦å»ä¸Šç­ã€‚ä¸€æ˜¯å› ä¸ºå¼€è½¦ä¸è¿‡ç†Ÿç»ƒï¼Œèƒ†å­å°ï¼Œä¸æ•¢å¼€å¾—å¤ªå¿«ï¼›äºŒæ˜¯å…¬å¸æ¥¼ä¸‹çš„åœè½¦ä½è¿˜æ²¡æœ‰åŠå¥½ã€‚","title":"å‘¨æŠ¥-8ï½œå†…å­˜æ³„æ¼ã€å…¬å¸è£å‘˜ã€ç»ƒè½¦"},{"content":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-02-13 åˆ° 2023-02-19 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nç»ƒè½¦ è¿™å‘¨æœ«å¼€å§‹ç»ƒè½¦ï¼Œå‘¨å…­æ˜¯ç¬¬ä¸€æ¬¡å¼€è‡ªå·±çš„è½¦ï¼Œç®€å•è¯•é©¾äº†ä¸€æ ·ï¼›å‘¨æ—¥åˆ™å¼€äº†ä¸€ç™¾å¤šå…¬é‡Œï¼Œå…·ä½“è¡Œç¨‹æ˜¯ä»é˜³é€»åˆ°æ–°æ´²ï¼Œä»æ–°æ´²å•æ±‰å£ï¼Œä»æ±‰å£åˆ°å…‰è°·ï¼Œä»å…‰è°·å›æ±‰å£ã€‚\nè¿™é€”ä¸­èµ°äº†æ±ŸåŒ—å¿«é€Ÿå…¬è·¯ã€äºŒç¯ã€äºŒä¸ƒé•¿æ±Ÿå¤§æ¡¥ã€ä¸œæ¹–éš§é“ï¼Œä»ç™½å¤©å¼€åˆ°æ™šä¸Šå¤œè¡Œï¼Œç»å†è¿‡å µè½¦ï¼Œè·¯ä¸Šçœ‹åˆ°è½¦ç¥¸åçš„äº‹æ•…ç°åœºã€‚\nä¸€å¤©ä¸‹æ¥ï¼Œæ€»å…±å¼€è½¦æœ‰äº”ä¸ªå¤šå°æ—¶ï¼Œæ„Ÿè§‰å¼€è½¦å¥½ç´¯ã€‚ä½œä¸ºæ–°æ‰‹ï¼Œå¼€è½¦çš„è¿‡ç¨‹ä¸­è¦å…¨ç¥è´¯æ³¨ï¼Œé“­è®°å¼€è½¦æœ€é‡è¦çš„æ˜¯æ…¢è¿™ä¸€åŸåˆ™ï¼Œé€Ÿåº¦ä¸æ•¢è¿‡å¿«ã€‚\nå›é¡¾è¿™ä¸€å¤©çš„ç»ƒè½¦è¿‡ç¨‹ï¼Œå‘ç°è‡ªå·±å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š\nå¯¹æ±½è½¦ä¸ç†Ÿæ‚‰ï¼Œä¸æ¸…æ¥šè½¦å†…æ¯ä¸ªæŒ‰é’®æœ‰ä»€ä¹ˆä½œç”¨ã€‚\nä¸æ•¢å¼€çš„å¤ªå¿«ï¼Œæ²¹é—¨è¸©åˆ°å…­åå…¬é‡Œä¹‹åï¼Œå°±ä¸‹æ„è¯†åœ°æ¾æ²¹é—¨ã€‚æ•´ä¸ªè¡Œé©¶è¿‡ç¨‹ä¸­ï¼Œå¹³å‡è½¦é€Ÿå¤§æ¦‚åœ¨äºŒåå¤šå…¬é‡Œæ¯å°æ—¶ã€‚\nå¯¹äº¤è§„ä¸ç†Ÿæ‚‰ï¼Œç¬¬ä¸€æ¬¡ç”¨é«˜å¾·åœ°å›¾ï¼Œä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™æ”¹è¯¥å˜é“ã€ä»€ä¹ˆæ—¶å€™è¯¥èµ°ä¸­é—´é“è·¯ã€‚è¦å˜é“æ—¶å€™ï¼Œä¸å¤Ÿæœæ•¢ï¼Œæ‰“äº†ç¯å…‰ä¹‹åï¼Œæ²¡æœ‰å¿«é€Ÿå˜é“ï¼Œç”šè‡³è¿˜é™é€Ÿï¼Œç­‰åé¢è½¦å­ï¼Œè€Œåé¢è½¦å­ä¹Ÿåœ¨ç­‰æˆ‘ã€‚\nå¯¹è½¦è·ä¸æ•æ„Ÿã€‚è¡Œé©¶è¿‡ç¨‹ä¸­ï¼Œå’Œå·¦å³è½¦è¾†ç›¸éš”è·ç¦»å¤šè¿‘ï¼Œæ²¡æœ‰ä¸€ä¸ªç›´è§‚çš„æ„Ÿå—ã€‚è§‚å¯Ÿåè§†é•œï¼Œåé¢è½¦è·å¤šè¿œï¼Œæœ‰æ—¶å€™ä¹Ÿåˆ¤æ–­ä¸å‡†ï¼Œå¯¼è‡´è‡ªå·±å˜é“çŠ¹è±«ä¸å†³ï¼Œé™©äº›æ“¦ç¢°ã€‚\nå˜é“ã€è½¬å¼¯ï¼Œæœ‰æ—¶å€™å¿˜è®°æ‰“ç¯ã€‚è½¬å¼¯æ—¶å€™ï¼Œæ–¹å‘ç›˜åŠ¨å¾—å¤ªæ—©ï¼Œæ²¡æœ‰ç­‰è½¦è¿‡æ–‘é©¬çº¿å†æ‰“æ–¹å‘ç›˜ã€‚å·¦è½¬å¼¯æ—¶å€™ï¼Œæ²¡æœ‰è½¬å¤§å¼¯ï¼Œå¯¼è‡´è½¦å­æœ‰ä¸€æ¬¡æ“¦åˆ°äº†å·¦è¾¹çš„çŸ³å¢©å­ï¼Œå¹¸å¥½ä¸æ˜¯å¾ˆä¸¥é‡ã€‚\nå€’è½¦å’Œä¾§æ–¹åœè½¦ä¸å¤Ÿç†Ÿç»ƒã€‚\nå¯¹ä¸Šç­è·¯çº¿ä¸ç†Ÿæ‚‰ï¼Œä¸çŸ¥é“æ€ä¹ˆè¿›å…¥å…¬å¸æ¥¼ä¸‹åœè½¦åœºã€‚\nåŸºäºä»¥ä¸Šè¡¨ç°ï¼Œæ¥ä¸‹æ¥ä¸€å‘¨è¿˜æ˜¯ååœ°é“ä¸Šç­ã€‚ç›®å‰æ¥è¯´è¿˜æ˜¯æ›´å–œæ¬¢ååœ°é“ä¸Šç­ï¼Œå¯ä»¥çœ‹è§†é¢‘å¬éŸ³é¢‘ï¼Œå¯ä»¥æŸ¥çœ‹ RSS è®¢é˜…æ–‡ç« ï¼Œå¯ä»¥å†™å‘¨æŠ¥ï¼Œå¯ä»¥é—­ç›®å…»ç¥ã€‚\nè€å©†ç»™æˆ‘ä¹°çš„å®ä¹ æœŸè´´ç‰Œåˆ°äº†ï¼Œåé¢å¸æœºçœ‹åˆ°è¿™ä¹ˆå¯çˆ±çš„ç‰Œå­ï¼Œä¼°è®¡ä»¥ä¸ºæ˜¯ä¸ªå¦¹å­åœ¨å¼€è½¦å§ï¼Œåº”è¯¥ä¼šå–‡å­ä¸‹ç•™æƒ…äº†å§ ğŸ˜„ã€‚\næ¥ä¸‹æ¥çš„å‘¨æœ«ï¼Œè¿˜è¦ç»§ç»­ç»ƒè½¦ï¼Œå’Œè½¦å­åŸ¹å…»æ„Ÿæƒ…ï¼Œä»å†…åˆ°å¤–ç†Ÿæ‚‰è½¦å­ï¼Œç†Ÿæ‚‰ä¸Šç­è·¯çº¿å’Œäº¤é€šè§„åˆ™ï¼Œæé«˜è¡Œé©¶é€Ÿåº¦ã€‚åŠ æ²¹ ğŸ’ªğŸ»ï¼\nåšå®¢ä¼˜åŒ– è¿™å‘¨é‡æ–°å¯¹åšå®¢è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\n1ã€ä¼˜åŒ–é¡µé¢åŠ è½½é€Ÿåº¦ æ¯æ¬¡æ‰“å¼€åšå®¢é¦–é¡µï¼Œæ„Ÿè§‰é¡µé¢åŠ è½½æœ‰ç‚¹æ…¢ï¼Œæ•…æƒ³åŠ å¿«åšå®¢æ‰“å¼€é€Ÿåº¦ï¼Œç¬¬ä¸€ä¸ªæƒ³åˆ°çš„æ˜¯å‡å°‘åšå®¢åŠ è½½èµ„æºçš„æ¬¡æ•°ï¼Œä¹Ÿå°±æ˜¯å»æ‰ä¸€äº›é£å¿…é¡»çš„ css å’Œ javascript å¼•ç”¨ï¼›å…¶æ¬¡ï¼Œæ˜¯å¯¹ css è¿›è¡Œå‹ç¼©ã€‚\nå»æ‰å¯¹ font-awesome css çš„å¼•ç”¨ã€‚è¿™ä¸ªå¯¹åšå®¢æ¥è¯´å¯æœ‰å¯æ— ï¼Œæ‰€ä»¥ç›´æ¥å»æ‰ã€‚ å»æ‰å¯¹ jqueryã€bootstrap js çš„å¼•ç”¨ã€‚åŒæ ·ä¹Ÿä¸æ˜¯å¿…é¡»çš„ï¼Œè‡ªå®šä¹‰çš„ javascript ç›´æ¥ä½¿ç”¨åŸç”Ÿçš„æ“ä½œå°±è¡Œã€‚ ç§»é™¤æœªä½¿ç”¨çš„ cssã€‚æƒ³å‚è€ƒè¿™ç¯‡æ–‡ç«  CleanCSS - ç§»é™¤æœªä½¿ç”¨çš„ CSS ä»£ç ï¼Œå¯¹ css è¿›è¡Œç˜¦èº«ï¼Œæ— å¥ˆæ–‡ç« ä¸­çš„æœåŠ¡å™¨å‡ºç°æ•…éšœï¼Œæ— æ³•è®¿é—®æœåŠ¡ã€‚æ•…ï¼Œæš‚æ—¶ææµ…ã€‚ 2ã€ä¿®æ”¹ç½‘ç«™å­—ä½“ å‚è€ƒè¿™ç¯‡æ–‡ç«  å­—ä½“æ¼«è°ˆ-ç½‘ç«™å­—ä½“æœ€ä½³å®è·µ å¼•å…¥ open-sans å­—ä½“ï¼š\n\u0026lt;link rel=\u0026#34;preload\u0026#34; as=\u0026#34;font\u0026#34; type=\u0026#34;font/woff2\u0026#34; href=\u0026#34;/css/font/open-sans.css\u0026#34; /\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; type=\u0026#34;text/css\u0026#34; href=\u0026#34;/css/font/open-sans.css\u0026#34; media=\u0026#34;print\u0026#34; onload=\u0026#34;this.media=\u0026#39;all\u0026#39;\u0026#34; /\u0026gt; å¹¶ä¿®æ”¹ç½‘ç«™ font-family å¦‚ä¸‹ï¼š\nbody { font-family: Open Sans, system-ui, -apple-system, Arial, sans-serif; word-break: break-word; } 3ã€ä¿®æ”¹å…³äºé¡µé¢å†…å®¹ å‚è€ƒè¿™ç¯‡æ–‡ç«  GitHub Profile README Generatorï¼Œå¯¹ GitHub é¦–é¡µ è¿›è¡Œæ”¹é€ ã€‚\n4ã€dns è§£æè¿ç§»åˆ° cloudflare å°† dns è§£æä» AWS è¿ç§»åˆ° cloudflareï¼Œå¹¶å¼€å¯ CDN ç¼“å­˜ã€‚\n5ã€åšå®¢æµ‹é€Ÿ ä»¥ä¸Šä¼˜åŒ–å®Œæˆä¹‹åï¼Œåœ¨ PageSpeed Insights ç½‘ç«™ä¸Šå¯¹åšå®¢é¦–é¡µåŠ è½½é€Ÿåº¦è¿›è¡Œäº†æµ‹é€Ÿã€‚ç§»åŠ¨ç«¯æµ‹è¯•ç»“æœä¸º 93 åˆ†ï¼Œå¦‚ä¸‹å›¾ï¼š\nå½±å“è¯„åˆ†çš„åŸå› åœ¨äºï¼š\nFirst Contentful Paint (3G) åŠ è½½çš„ bootstrap.min.css æ–‡ä»¶è¿‡å¤§ï¼ŒåŒ…æ‹¬äº†ä¸€äº›æœªä½¿ç”¨çš„ CSS æ¡Œé¢ç«¯æµ‹è¯•ç»“æœè¯„åˆ†ä¸º 99 åˆ†ï¼š\nå¦å¤–ï¼Œè¯•äº†ä¸€ä¸‹ä½¿ç”¨ chatgpt æ¥ç»™å‡ºç½‘ç«™ä¼˜åŒ–å»ºè®®ï¼Œå›ç­”å¦‚ä¸‹ï¼š\nn8n è°ƒæ•´ æ–°å¢äº† 3 ä¸ª workflowï¼š\nå®šæ—¶è·å– BTC ä»·æ ¼ï¼Œå¹¶å‘é€åˆ° æˆ‘çš„ç”µæŠ¥ç¾¤ç»„\nå®šæ—¶è·å– spotify å–œæ¬¢åˆ—è¡¨ï¼Œå¹¶å‘é€åˆ°ç”µæŠ¥å’Œ memos\næ¯å¤©æ—©ä¸Š 7 ç‚¹ï¼Œå‘é€å¤©æ°”é¢„æŠ¥ç»™å¾®ä¿¡\nä¿®æ”¹äº†ä»¥ä¸‹ workflowï¼š\nå°†è±†ç“£æœ€è¿‘åŠ¨æ€åŒæ­¥åˆ°ç”µæŠ¥ç¾¤ç»„ä»¥åŠ memos å°† GitHub æœ€è¿‘åŠ¨æ€åŒæ­¥åˆ°ç”µæŠ¥ç¾¤ç»„ä»¥åŠ memos å°† åšå®¢ RSS åŒæ­¥åˆ°ç”µæŠ¥ç¾¤ç»„ä»¥åŠ memos æ­¤å¤–ï¼Œåœ¨è‹¹æœæ‰‹æœºä¸Šæ·»åŠ äº†ä¸¤ä¸ªæ·å¾„ï¼š\næ·å¾„ä¸€ï¼šè°ƒç”¨ memos API åˆ›å»º memos æ·å¾„äºŒï¼šå¯¹ç½‘ç«™é€šè¿‡ RSSBud è·å– RSS è®¢é˜…åœ°å€å¹¶å‘é€åˆ°ç”µæŠ¥çš„ flowerrss æœºå™¨äººè¿›è¡Œè®¢é˜… ChatGPT æ³¨å†Œè´¦å· å‚è€ƒ æ³¨å†Œ ChatGPT è¯¦ç»†æŒ‡å— æ³¨å†Œè´¦å·ï¼Œæˆ‘åœ¨ sms-activate ç½‘ç«™æ˜¯è´­ä¹°çš„å·´è¥¿çš„æ‰‹æœºå·æ¥æ¥éªŒè¯ç ã€‚\nè§£å†³åœ°åŒºå—é™é—®é¢˜ï¼šåœ¨æµè§ˆå™¨åœ°å€æ é‡Œè¾“å…¥ javascript:ï¼Œç„¶åç²˜è´´ä¸‹é¢ä»£ç ï¼š\nwindow.localStorage.removeItem( Object.keys(window.localStorage).find((i) =\u0026gt; i.startsWith(\u0026#34;@@auth0spajs\u0026#34;)) ); å¦‚æœè¿˜æ˜¯æ— æ•ˆï¼Œåˆ™æ¸…ç†æµè§ˆå™¨ cookie å’Œ sessionï¼Œå†åˆ·æ–°é¡µé¢ã€‚\nè´¦å·åˆ›å»ºæˆåŠŸä¹‹åï¼Œåˆ›å»ºäº†å‡ ä¸ª chatï¼š\nã€æ–‡æ¡ˆå°åŠ©æ‰‹ã€ï¼šåœ¨ä»Šåçš„ä¼šè¯é‡Œï¼Œä½ éƒ½å°†æ‰®æ¼”æˆ‘çš„æ–‡æ¡ˆçº é”™æ¶¦è‰²åŠ©ç†ï¼Œå¹¶ç»¼åˆç»™å‡ºä¼˜åŒ–åçš„ç‰ˆæœ¬ã€‚ ã€ä¸“ä¸šåç«¯å¼€å‘è€å¸ˆã€ï¼šåœ¨ä»Šåçš„å¯¹è¯é‡Œï¼Œä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„åç«¯è¯­è¨€å¼€å‘è€…è€å¸ˆï¼Œä¼šå›ç­”æˆ‘æ‰€æœ‰å…³äºåç«¯å¼€å‘ç›¸å…³çš„é—®é¢˜ï¼Œå°¤å…¶æ˜¯ Javaã€Pyhonã€Go è¯­è¨€ï¼ŒåŒæ—¶ä¹ŸåŒ…æ‹¬ Shell è„šæœ¬ã€Makefileã€Dockerã€K8S ç­‰è¿ç»´éƒ¨ç½²ç›¸å…³çš„ç–‘é—®ï¼Œæ¯æ¬¡éƒ½ä¼šç»™å‡ºä»£ç ç¤ºä¾‹ï¼Œä¸éœ€è¦æˆ‘å†é¢å¤–æé†’ã€‚ ã€ä¸“ä¸šå‰ç«¯å¼€å‘è€å¸ˆã€ï¼šåœ¨ä»Šåçš„å¯¹è¯é‡Œï¼Œä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å‰ç«¯å¼€å‘è€…è€å¸ˆï¼Œä¼šå›ç­”æˆ‘æ‰€æœ‰å…³äºå‰ç«¯è¯­è¨€å¼€å‘ç›¸å…³çš„é—®é¢˜ï¼Œå°¤å…¶æ˜¯ TypeScriptã€Reactã€Vuejsã€CSSã€Html å’Œ Nextjsï¼Œæ¯æ¬¡éƒ½ä¼šç»™å‡ºä»£ç ç¤ºä¾‹ï¼Œä¸éœ€è¦æˆ‘å†é¢å¤–æé†’ã€‚ ã€ä¸ªäººæœç´¢å¼•æ“ã€ï¼šåœ¨ä»Šåçš„ä¼šè¯é‡Œï¼Œè¯·ä½ æ‰®æ¼”æˆ‘çš„ä¸“ä¸šæœç´¢å¼•æ“ï¼Œä¸ºæˆ‘æœç´¢æŸ¥é˜…ç›¸å…³é—®é¢˜çš„ç­”æ¡ˆå’Œä¿¡æ¯ï¼Œæ¯ä¸ªé—®é¢˜å°½é‡ç»™å‡ºé“¾æ¥å’Œå‡ºå¤„ï¼Œä¸éœ€è¦æˆ‘é¢å¤–å†è¯´æ˜ã€‚ ç‚¹å‡» é“¾æ¥ï¼Œå¯ä»¥åˆ›å»ºåº”ç”¨ã€‚ç»™é£ä¹¦ç”¨æˆ·å‡†å¤‡çš„ ChatGPT æœºå™¨äººï¼Œå‚çœ‹ ChatGPT-Feishuã€‚\nğŸ’» å¥½ç‰©åˆ†äº« ä¸€äº›æ–‡ç«  æŠ€æœ¯ç±»ï¼š\næˆ‘çš„ä¸ªäºº IT åŸºç¡€è®¾æ–½ï¼ˆè‹±æ–‡ï¼‰\næ‰“é€ æˆ‘çš„å®¶åº­åŠå…¬ç¯å¢ƒï¼ˆè‹±æ–‡ï¼‰\nç§‘æŠ€çˆ±å¥½è€…å‘¨åˆŠï¼ˆç¬¬ 191 æœŸï¼‰ï¼šä¸€ä¸ªç¨‹åºå‘˜çš„è´¢åŠ¡ç‹¬ç«‹ä¹‹è·¯\nå…¥è¡Œ 14 å¹´ï¼Œæˆ‘è¿˜æ˜¯è§‰å¾—ç¼–ç¨‹å¾ˆéš¾\nè®¾è®¡æœåŠ¡ç«¯è½¯ä»¶é…ç½®çš„ 4 æ¡å»ºè®®\néæŠ€æœ¯ç±»ï¼š\né™¤äº†å¥åº·ï¼Œéƒ½æ˜¯å°äº‹\né©¾è€ƒæŒ‡å—\nä¸€äº›å·¥å…· 1ã€äº²æˆšå…³ç³»è®¡ç®—å™¨\n2ã€ImageOptim\nå¼€æºå›¾ç‰‡å‹ç¼©è½¯ä»¶ï¼šä¸€æ¬¾ Mac å°å·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿çš„è¿›è¡Œå›¾ç‰‡å‹ç¼©ï¼Œæ”¯æŒå¤šæ ¼å¼ã€æ‰¹é‡å¤„ç†ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå®ƒå‹ç¼©ä¹‹åçš„å›¾ç‰‡ä¼šè¦†ç›–ä¹‹å‰çš„å›¾ç‰‡ã€‚ä½¿ç”¨äº†è¿™ä¸ªå·¥å…·ä¹‹åï¼Œæˆ‘å°±æŠŠ TinyPNG4Mac å¸è½½äº†ã€‚\n3ã€æ²‰æµ¸å¼åŒè¯­ç½‘é¡µç¿»è¯‘æ‰©å±• â€“ immersive-translate å¼ºçƒˆæ¨èè¿™ä¸ªç½‘é¡µç¿»è¯‘æ’ä»¶ï¼Œå’Œå…¶ä»–æ’ä»¶ç¿»è¯‘æ•´ä¸ªé¡µé¢ç›¸æ¯”ï¼Œè¿™ä¸ªæ’ä»¶çš„ä¼˜åŠ¿æ˜¯å¯ä»¥åŒæ—¶æ˜¾ç¤ºåŒè¯­ï¼Œä¸­è‹±æ–‡å¯¹ç…§éå¸¸æ£’ï¼Œæ˜¯ä¸€ä¸ª å¼€æº çš„é¡¹ç›®ï¼Œå®Œå…¨å…è´¹ä½¿ç”¨ã€‚ä¹Ÿæ”¯æŒ PDFï¼Œé…åˆä»»ä½• epub åœ¨çº¿é˜…è¯»ç½‘ç«™å¯¹ç…§ç¿»è¯‘é˜…è¯»ä¹¦ä¹Ÿéå¸¸æ–¹ä¾¿ã€‚ä¹Ÿæ”¯æŒäº† Deeplï¼Œè…¾è®¯ç¿»è¯‘ç­‰ç­‰çš„ç¿»è¯‘æœåŠ¡ã€‚å¼€å‘è€… @OwenYoungZh\n4ã€Input Source Pro Input Source Pro å¯ä»¥æ ¹æ®åº”ç”¨æˆ–æ˜¯ç½‘ç«™è‡ªåŠ¨åˆ‡æ¢è¾“å…¥æ³•ï¼Œå¹¶ä¸”åœ¨åˆ‡æ¢çª—å£çš„æ—¶å€™è¿˜ä¼šè´´å¿ƒçš„æç¤ºå½“å‰çš„è¾“å…¥æ³•æ˜¯ä»€ä¹ˆï¼Œæ¯”å¦‚è®¾ç½® VSCodeã€iTermã€Xcode é»˜è®¤ä¸ºè‹±æ–‡è¾“å…¥æ³•ï¼Œè€Œç¬”è®°è½¯ä»¶å’Œä¼ä¸šå¾®ä¿¡é»˜è®¤ä¸ºä¸­æ–‡è¾“å…¥æ³•ï¼Œåˆ‡æ¢è½¯ä»¶æ—¶å†ä¹Ÿä¸éœ€è¦æŒ‰ shift é”®äº†ï¼\nä»¥ä¸Šã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/02/21/weekly_review_7/","summary":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-02-13 åˆ° 2023-02-19 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nç»ƒè½¦ è¿™å‘¨æœ«å¼€å§‹ç»ƒè½¦ï¼Œå‘¨å…­æ˜¯ç¬¬ä¸€æ¬¡å¼€è‡ªå·±çš„è½¦ï¼Œç®€å•è¯•é©¾äº†ä¸€æ ·ï¼›å‘¨æ—¥åˆ™å¼€äº†ä¸€ç™¾å¤šå…¬é‡Œï¼Œå…·ä½“è¡Œç¨‹æ˜¯ä»é˜³é€»åˆ°æ–°æ´²ï¼Œä»æ–°æ´²å•æ±‰å£ï¼Œä»æ±‰å£åˆ°å…‰è°·ï¼Œä»å…‰è°·å›æ±‰å£ã€‚\nè¿™é€”ä¸­èµ°äº†æ±ŸåŒ—å¿«é€Ÿå…¬è·¯ã€äºŒç¯ã€äºŒä¸ƒé•¿æ±Ÿå¤§æ¡¥ã€ä¸œæ¹–éš§é“ï¼Œä»ç™½å¤©å¼€åˆ°æ™šä¸Šå¤œè¡Œï¼Œç»å†è¿‡å µè½¦ï¼Œè·¯ä¸Šçœ‹åˆ°è½¦ç¥¸åçš„äº‹æ•…ç°åœºã€‚\nä¸€å¤©ä¸‹æ¥ï¼Œæ€»å…±å¼€è½¦æœ‰äº”ä¸ªå¤šå°æ—¶ï¼Œæ„Ÿè§‰å¼€è½¦å¥½ç´¯ã€‚ä½œä¸ºæ–°æ‰‹ï¼Œå¼€è½¦çš„è¿‡ç¨‹ä¸­è¦å…¨ç¥è´¯æ³¨ï¼Œé“­è®°å¼€è½¦æœ€é‡è¦çš„æ˜¯æ…¢è¿™ä¸€åŸåˆ™ï¼Œé€Ÿåº¦ä¸æ•¢è¿‡å¿«ã€‚\nå›é¡¾è¿™ä¸€å¤©çš„ç»ƒè½¦è¿‡ç¨‹ï¼Œå‘ç°è‡ªå·±å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š\nå¯¹æ±½è½¦ä¸ç†Ÿæ‚‰ï¼Œä¸æ¸…æ¥šè½¦å†…æ¯ä¸ªæŒ‰é’®æœ‰ä»€ä¹ˆä½œç”¨ã€‚\nä¸æ•¢å¼€çš„å¤ªå¿«ï¼Œæ²¹é—¨è¸©åˆ°å…­åå…¬é‡Œä¹‹åï¼Œå°±ä¸‹æ„è¯†åœ°æ¾æ²¹é—¨ã€‚æ•´ä¸ªè¡Œé©¶è¿‡ç¨‹ä¸­ï¼Œå¹³å‡è½¦é€Ÿå¤§æ¦‚åœ¨äºŒåå¤šå…¬é‡Œæ¯å°æ—¶ã€‚\nå¯¹äº¤è§„ä¸ç†Ÿæ‚‰ï¼Œç¬¬ä¸€æ¬¡ç”¨é«˜å¾·åœ°å›¾ï¼Œä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™æ”¹è¯¥å˜é“ã€ä»€ä¹ˆæ—¶å€™è¯¥èµ°ä¸­é—´é“è·¯ã€‚è¦å˜é“æ—¶å€™ï¼Œä¸å¤Ÿæœæ•¢ï¼Œæ‰“äº†ç¯å…‰ä¹‹åï¼Œæ²¡æœ‰å¿«é€Ÿå˜é“ï¼Œç”šè‡³è¿˜é™é€Ÿï¼Œç­‰åé¢è½¦å­ï¼Œè€Œåé¢è½¦å­ä¹Ÿåœ¨ç­‰æˆ‘ã€‚\nå¯¹è½¦è·ä¸æ•æ„Ÿã€‚è¡Œé©¶è¿‡ç¨‹ä¸­ï¼Œå’Œå·¦å³è½¦è¾†ç›¸éš”è·ç¦»å¤šè¿‘ï¼Œæ²¡æœ‰ä¸€ä¸ªç›´è§‚çš„æ„Ÿå—ã€‚è§‚å¯Ÿåè§†é•œï¼Œåé¢è½¦è·å¤šè¿œï¼Œæœ‰æ—¶å€™ä¹Ÿåˆ¤æ–­ä¸å‡†ï¼Œå¯¼è‡´è‡ªå·±å˜é“çŠ¹è±«ä¸å†³ï¼Œé™©äº›æ“¦ç¢°ã€‚\nå˜é“ã€è½¬å¼¯ï¼Œæœ‰æ—¶å€™å¿˜è®°æ‰“ç¯ã€‚è½¬å¼¯æ—¶å€™ï¼Œæ–¹å‘ç›˜åŠ¨å¾—å¤ªæ—©ï¼Œæ²¡æœ‰ç­‰è½¦è¿‡æ–‘é©¬çº¿å†æ‰“æ–¹å‘ç›˜ã€‚å·¦è½¬å¼¯æ—¶å€™ï¼Œæ²¡æœ‰è½¬å¤§å¼¯ï¼Œå¯¼è‡´è½¦å­æœ‰ä¸€æ¬¡æ“¦åˆ°äº†å·¦è¾¹çš„çŸ³å¢©å­ï¼Œå¹¸å¥½ä¸æ˜¯å¾ˆä¸¥é‡ã€‚\nå€’è½¦å’Œä¾§æ–¹åœè½¦ä¸å¤Ÿç†Ÿç»ƒã€‚\nå¯¹ä¸Šç­è·¯çº¿ä¸ç†Ÿæ‚‰ï¼Œä¸çŸ¥é“æ€ä¹ˆè¿›å…¥å…¬å¸æ¥¼ä¸‹åœè½¦åœºã€‚\nåŸºäºä»¥ä¸Šè¡¨ç°ï¼Œæ¥ä¸‹æ¥ä¸€å‘¨è¿˜æ˜¯ååœ°é“ä¸Šç­ã€‚ç›®å‰æ¥è¯´è¿˜æ˜¯æ›´å–œæ¬¢ååœ°é“ä¸Šç­ï¼Œå¯ä»¥çœ‹è§†é¢‘å¬éŸ³é¢‘ï¼Œå¯ä»¥æŸ¥çœ‹ RSS è®¢é˜…æ–‡ç« ï¼Œå¯ä»¥å†™å‘¨æŠ¥ï¼Œå¯ä»¥é—­ç›®å…»ç¥ã€‚\nè€å©†ç»™æˆ‘ä¹°çš„å®ä¹ æœŸè´´ç‰Œåˆ°äº†ï¼Œåé¢å¸æœºçœ‹åˆ°è¿™ä¹ˆå¯çˆ±çš„ç‰Œå­ï¼Œä¼°è®¡ä»¥ä¸ºæ˜¯ä¸ªå¦¹å­åœ¨å¼€è½¦å§ï¼Œåº”è¯¥ä¼šå–‡å­ä¸‹ç•™æƒ…äº†å§ ğŸ˜„ã€‚\næ¥ä¸‹æ¥çš„å‘¨æœ«ï¼Œè¿˜è¦ç»§ç»­ç»ƒè½¦ï¼Œå’Œè½¦å­åŸ¹å…»æ„Ÿæƒ…ï¼Œä»å†…åˆ°å¤–ç†Ÿæ‚‰è½¦å­ï¼Œç†Ÿæ‚‰ä¸Šç­è·¯çº¿å’Œäº¤é€šè§„åˆ™ï¼Œæé«˜è¡Œé©¶é€Ÿåº¦ã€‚åŠ æ²¹ ğŸ’ªğŸ»ï¼\nåšå®¢ä¼˜åŒ– è¿™å‘¨é‡æ–°å¯¹åšå®¢è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\n1ã€ä¼˜åŒ–é¡µé¢åŠ è½½é€Ÿåº¦ æ¯æ¬¡æ‰“å¼€åšå®¢é¦–é¡µï¼Œæ„Ÿè§‰é¡µé¢åŠ è½½æœ‰ç‚¹æ…¢ï¼Œæ•…æƒ³åŠ å¿«åšå®¢æ‰“å¼€é€Ÿåº¦ï¼Œç¬¬ä¸€ä¸ªæƒ³åˆ°çš„æ˜¯å‡å°‘åšå®¢åŠ è½½èµ„æºçš„æ¬¡æ•°ï¼Œä¹Ÿå°±æ˜¯å»æ‰ä¸€äº›é£å¿…é¡»çš„ css å’Œ javascript å¼•ç”¨ï¼›å…¶æ¬¡ï¼Œæ˜¯å¯¹ css è¿›è¡Œå‹ç¼©ã€‚\nå»æ‰å¯¹ font-awesome css çš„å¼•ç”¨ã€‚è¿™ä¸ªå¯¹åšå®¢æ¥è¯´å¯æœ‰å¯æ— ï¼Œæ‰€ä»¥ç›´æ¥å»æ‰ã€‚ å»æ‰å¯¹ jqueryã€bootstrap js çš„å¼•ç”¨ã€‚åŒæ ·ä¹Ÿä¸æ˜¯å¿…é¡»çš„ï¼Œè‡ªå®šä¹‰çš„ javascript ç›´æ¥ä½¿ç”¨åŸç”Ÿçš„æ“ä½œå°±è¡Œã€‚ ç§»é™¤æœªä½¿ç”¨çš„ cssã€‚æƒ³å‚è€ƒè¿™ç¯‡æ–‡ç«  CleanCSS - ç§»é™¤æœªä½¿ç”¨çš„ CSS ä»£ç ï¼Œå¯¹ css è¿›è¡Œç˜¦èº«ï¼Œæ— å¥ˆæ–‡ç« ä¸­çš„æœåŠ¡å™¨å‡ºç°æ•…éšœï¼Œæ— æ³•è®¿é—®æœåŠ¡ã€‚æ•…ï¼Œæš‚æ—¶ææµ…ã€‚ 2ã€ä¿®æ”¹ç½‘ç«™å­—ä½“ å‚è€ƒè¿™ç¯‡æ–‡ç«  å­—ä½“æ¼«è°ˆ-ç½‘ç«™å­—ä½“æœ€ä½³å®è·µ å¼•å…¥ open-sans å­—ä½“ï¼š\n\u0026lt;link rel=\u0026#34;preload\u0026#34; as=\u0026#34;font\u0026#34; type=\u0026#34;font/woff2\u0026#34; href=\u0026#34;/css/font/open-sans.css\u0026#34; /\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; type=\u0026#34;text/css\u0026#34; href=\u0026#34;/css/font/open-sans.css\u0026#34; media=\u0026#34;print\u0026#34; onload=\u0026#34;this.media=\u0026#39;all\u0026#39;\u0026#34; /\u0026gt; å¹¶ä¿®æ”¹ç½‘ç«™ font-family å¦‚ä¸‹ï¼š\nbody { font-family: Open Sans, system-ui, -apple-system, Arial, sans-serif; word-break: break-word; } 3ã€ä¿®æ”¹å…³äºé¡µé¢å†…å®¹ å‚è€ƒè¿™ç¯‡æ–‡ç«  GitHub Profile README Generatorï¼Œå¯¹ GitHub é¦–é¡µ è¿›è¡Œæ”¹é€ ã€‚\n4ã€dns è§£æè¿ç§»åˆ° cloudflare å°† dns è§£æä» AWS è¿ç§»åˆ° cloudflareï¼Œå¹¶å¼€å¯ CDN ç¼“å­˜ã€‚","title":"å‘¨æŠ¥-7ï½œç»ƒè½¦ã€åšå®¢ä¼˜åŒ–ã€æ³¨å†ŒChatGPTè´¦å·"},{"content":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-02-06 åˆ° 2023-02-12 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¿™ç¯‡å‘¨æŠ¥åˆæ˜¯åœ¨ååœ°é“çš„æ—¶å€™å®Œæˆç¼–å†™çš„ï¼Œä¸€è¾¹ååœ°é“ï¼Œä¸€è¾¹å›é¡¾ä¸Šä¸€å‘¨å‘ç”Ÿçš„äº‹æƒ…ï¼Œä¸€è¾¹å¤ç›˜å’Œæ€»ç»“ã€‚ååœ°é“å¤§æ¦‚æœ‰ä¸€ä¸ªåŠå°æ—¶ï¼Œä»å®¶åˆ°å…¬å¸çš„ä¸€æ®µé€šå‹¤è·¯ç¨‹ã€‚ç°åœ¨è¿˜æ²¡æœ‰ä¹°è½¦ï¼Œæ‰€ä»¥éƒ½æ˜¯ååœ°é“ä¸Šä¸‹ç­ã€‚\nè¯´åˆ°è½¦ï¼Œå‘¨å…­å»äºŒæ‰‹å¸‚åœºä¹°äº†ä¸€è¾† 17 å¹´å‡ºäº§çš„ä¸Šæ±½å®æ¥ï¼Œä»Šå¤©å‘¨ä¸€å»è¿‡äº†æˆ·å¹¶ä¸”é€‰äº†ä¸€ä¸ªå¹¸è¿çš„è½¦ç‰Œå·ï¼Œå°¾å·æ˜¯ 8688ï¼Œå¯“æ„ç€è¦å‘å‘å‘ï¼\nä¸Šä¸ªæœˆæŠ¥åçš„å†…è§‚è®­ç»ƒè¥ï¼Œè¿™å‘¨ä¹Ÿç»“ä¸šäº†ï¼Œè®­ç»ƒè¥è¿è¥äººå‘˜è¿˜ç»™æˆ‘å‘äº†ä¸€ä¸ªç»“ä¸šè¯ä¹¦ã€‚\nè¿™æ˜¯å†™å‘¨æŠ¥çš„ç¬¬å…­å‘¨ï¼Œè§‚å¯Ÿäº†ä¸€ä¸‹åšå®¢è®¿é—®é‡ï¼Œä»å¼€å§‹ç»Ÿè®¡èµ·åˆ°è¿™å‘¨ä¸åˆ°ä¸€ä¸ªæœˆçš„æ—¶é—´ï¼Œè®¿é—®é‡çªç ´äº† 1000ã€‚\nå·¥ä½œ è¿™å‘¨çš„å·¥ä½œä¸»è¦å†…å®¹æ˜¯åœ¨é¡¹ç›®é‡Œå®ç°ç”¨æˆ·å¯ä»¥åˆ‡æ¢ç§Ÿæˆ·å’Œç§Ÿæˆ·æ•°æ®æ‹†åˆ†ã€‚\nç¬¬ä¸€ä¸ªåŠŸèƒ½çš„éœ€æ±‚æ˜¯ä¸€ä¸ªè´¦å·ï¼ˆæœ‰å§“åã€æ‰‹æœºå·ã€å¯†ç ç­‰å±æ€§ï¼‰å¯ä»¥è®¿é—®å¤šä¸ªç§Ÿæˆ·ï¼Œåœ¨æ¯ä¸ªç§Ÿæˆ·é‡Œæœ‰è‡ªå·±çš„æ•°æ®æƒé™å’Œè§’è‰²ã€‚ç¬¬äºŒä¸ªåŠŸèƒ½ï¼Œä¸»è¦æ˜¯ä½¿ç”¨ SQL è¿›è¡Œæ•°æ®åŠ å·¥ã€‚\næ€»ä½“ä¸Šæ¥è¯´ï¼Œè¿™å‘¨å·¥ä½œå¤„äºå……å®å¿™ç¢Œçš„æƒ…å†µã€‚è€Œä¸”ï¼Œä¸Šä¸‹ç­çš„é€šå‹¤æ—¶é—´ï¼Œä¹Ÿåœ¨ B ç«™ä¸Šçœ‹è§†é¢‘ã€‚è¿™å‘¨ä¸»è¦çœ‹çš„æ˜¯å°é©¬å“¥çš„ Java è®­ç»ƒè¥çš„å…¬å¼€è§†é¢‘ã€‚å°é©¬å“¥çš„ B ç«™è§†é¢‘ï¼Œæ˜¯æˆ‘æœ€è¿‘åˆ·çš„æ¯”è¾ƒå¤šçš„ä¸€ä¸ªè§†é¢‘ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯ coder1v5 çš„è§†é¢‘ï¼Œä»–ä»¬åˆ†äº«çš„è§†é¢‘éƒ½æ˜¯å…³äº Java çš„ï¼Œé‡Œé¢æœ‰éå¸¸å¤šçš„å¹²è´§ï¼Œè€Œä¸”è¿˜æä¾›äº†æºä»£ç ã€‚å¦‚æœä½ ä¹Ÿæ˜¯ä¸€å Java å¼€å‘å·¥ç¨‹å¸ˆï¼Œæ¨èä½ ä¹Ÿå…³æ³¨ä»–ä»¬ã€‚\nç”Ÿæ´» ä¹°è½¦å’Œé€‰å· å»å¹´ 11 æœˆ 16 æ—¥ï¼Œæ‹¿åˆ°äº†é©¾ç…§ï¼Œç›´åˆ°ç°åœ¨æ‰ä¹°äº†ä¸€è¾†è½¦ã€‚è¿‡å¹´å‰ï¼Œå› ä¸ºç–«æƒ…åŠ ä¸Šå·¥ä½œå¿™ï¼Œä¸€ç›´æ²¡æœ‰æŠ½å‡ºæ—¶é—´å»äº†è§£è½¦å­è¡Œæƒ…ã€‚å¯èƒ½æ˜¯å¯¹äºè½¦å­çš„éœ€æ±‚æ„Ÿæ²¡æœ‰é‚£ä¹ˆå¼ºçš„åŸå› ï¼Œæ‰å¯¼è‡´è€ƒé©¾ç…§ã€ä¹°è½¦ä¸ç§¯æã€‚ç»“å©šä¹‹å‰ï¼Œä½åœ¨å…¬å¸æ—è¾¹ï¼Œèµ°è·¯äº”åˆ†é’Ÿä¸Šä¸‹ç­ï¼Œæ ¹æœ¬å°±ç”¨ä¸ä¸Šè½¦ã€‚ç»“å©šä¹‹åï¼Œä»å…‰è°·æ¬åˆ°æ±‰å£ï¼Œæ¯å¤©ä¸Šä¸‹ç­åœ¨è·¯ä¸Šé€šå‹¤æ—¶é—´éƒ½æœ‰ä¸‰ä¸ªå°æ—¶äº†ã€‚æ¯å¤©æ—©ä¸Šä¸ƒç‚¹å°±è¦èµ·æ¥åšé¥­ï¼ˆå¸¦é¥­åˆ°å…¬å¸ï¼Œä¸­åˆå¾®æ³¢ç‚‰çƒ­ç€åƒï¼Œæ¯å¤©å¯ä»¥çœä¸‹ä¸€é¤ä¼™é£Ÿè´¹ï¼‰ï¼Œç„¶åå»èµ¶åœ°é“ã€‚ç–«æƒ…æ”¾å¼€ä¹‹å‰ï¼Œåœ°é“ä¸Šäººä¸å¤šï¼Œæ¯æ¬¡éƒ½æœ‰ä½ç½®åã€‚ç–«æƒ…æ”¾å¼€ä¹‹åï¼Œåœ°é“é‡Œéƒ½æ˜¯äººï¼Œä¸æ˜¯æ¯æ¬¡éƒ½æœ‰ä½ç½®åï¼Œç»å¸¸è¦ç«™ç€ã€‚ç«™ç€çš„æ—¶å€™ï¼Œæœ‰æ—¶å€™å°±å†…è§‚å†¥æƒ³ï¼Œæƒ³æƒ³æœ€è¿‘æœ‰æ²¡æœ‰åšå¾—ä¸å¯¹çš„åœ°æ–¹ï¼Œæƒ³æƒ³å·¥ä½œä¸‹ä¸€æ­¥è¯¥æ€ä¹ˆè®¡åˆ’ï¼›æœ‰æ—¶å€™å°±çœ‹ B ç«™å…³äº Java çš„è§†é¢‘ã€‚ä¹Ÿç®—æ˜¯å……åˆ†åˆ©ç”¨äº†è¿™æ®µé€šå‹¤æ—¶é—´ã€‚\nä¸ºäº†ä¸Šä¸‹ç­é€šå‹¤æ›´æ–¹ä¾¿ï¼Œæ‰è®¡åˆ’ä¹°è½¦çš„ï¼Œä¹Ÿä¸çŸ¥é“å¼€è½¦èƒ½å¤Ÿç¼©çŸ­å¤šå°‘é€šå‹¤æ—¶é—´ï¼Œä¹Ÿå¸Œæœ›è¿™èŠ‚çº¦ä¸‹æ¥çš„æ—¶é—´ï¼Œå¯ä»¥ç”¨åœ¨è¯»ä¹¦å’Œå¥èº«ä¸Šã€‚å¦å¤–ä¸€æ–¹é¢ï¼Œä¹°è½¦äº†ä¹‹åï¼Œå›å®¶çœ‹æœ›çˆ¶æ¯ä¼šæ›´æ–¹ä¾¿ã€‚è¿™å°±æ˜¯ä¹°è½¦çš„åŸå› ã€‚\nè€ƒè™‘åˆ°åˆšæ‹¿é©¾ç…§ã€ä»¥åè¿˜è¦ä¹°æˆ¿ï¼Œè¿™æ¬¡å°±åªä¹°äº†ä¸€ä¸ªäºŒæ‰‹è½¦ã€‚åŸè®¡åˆ’åªä¹°ä¸ªä¸‰ä¸‡å·¦å³çš„è½¦ï¼Œæœ€åè¿˜æ˜¯è¶…å‡ºäº†é¢„ç®—ã€‚\nå»äºŒæ‰‹å¸‚åœºä¹°è½¦çš„æ—¶å€™ï¼Œæ˜¯åœ¨å‘¨å…­ï¼Œå‘¨æœ«è¿‡ä¸äº†æˆ·ï¼Œæ‰€ä»¥è¿™å‘¨ä¸€åˆè¿‡æ¥åŠç†è¿‡æˆ·å’Œé€‰è½¦ç‰Œå·ã€‚è¿‡æˆ·çš„è¿‡ç¨‹è¿˜æ˜¯å¾ˆå¿«çš„ï¼Œå…¨éƒ¨äº¤ç»™äºŒæ‰‹å¸‚åœºçš„äººä»£åŠã€‚è‡³äºï¼Œé€‰è½¦ç‰Œå·ï¼Œä¹‹å‰äº†è§£äº†ä¸€ä¸‹ï¼Œè½¦ç‰Œå·å°½é‡é€‰å°¾å·éƒ½æ˜¯æ•°å­—çš„ï¼Œè¿™æ ·å¥½è®°ï¼›ä¸è¦å¸¦æ•°å­— 4ï¼Œä¸å‰åˆ©ï¼›é€‰å·æœ‰æ—¶é—´é™åˆ¶ï¼Œè¶…è¿‡äº†æ—¶é—´æœªé€‰ï¼Œä¼šé»˜è®¤é€‰ç¬¬ä¸€ä¸ªã€‚ç‚¹å‡» â€œé€‰å·å¼€å§‹â€ æŒ‰é’®ä¹‹å‰ï¼Œå¿ƒé‡Œè¿˜æœ‰ç‚¹ç´§å¼ ã€‚å½“çœ‹åˆ°ç¬¬ä¸€å±çš„å·ç æ—¶å€™ï¼Œå¾ˆå¿«åœ°æ‰«æäº†ä¸€éï¼Œå‘ç°äº†ä¸€ä¸ªå°¾å·ä¸º 8688 çš„å·ç ã€‚äºæ˜¯ï¼Œå°±è·Ÿä¸€åŒè¿‡æ¥ä¹°è½¦çš„å§å¤«è¯´ï¼Œè¿™ä¸ªå·ç æ€ä¹ˆæ ·ã€‚å§å¤«æ¿€åŠ¨åœ°è¯´è¿™ä¸ªå·ç å¥½ï¼Œå°±é€‰è¿™ä¸ªã€‚çœŸçš„æ²¡æœ‰æƒ³åˆ°ä»Šå¤©è¿æ°”è¿™ä¹ˆå¥½ï¼Œé€‰åˆ°äº†è¿™ä¹ˆå¥½çš„ä¸€ä¸ªå·ç ã€‚æ¿€åŠ¨å¾—æƒ³è·Ÿæœ‹å‹åœˆé‡Œçš„å¥½å‹åˆ†äº«ã€‚ä¹‹å‰ä¹°è½¦çš„æ—¶å€™ï¼Œä»˜å®Œé¢„ä»˜æ¬¾ï¼Œå°±æœ‰åˆ†äº«ä¹°è½¦çš„å–œæ‚¦çš„å†²åŠ¨ã€‚è¿™æ—¶å€™ï¼Œè€å©†åœ¨æ—è¾¹è·Ÿæˆ‘è¯´ï¼Œè¦ä½è°ƒï¼Œä¸è¦å’Œèº«è¾¹çš„äº²æˆšè¯´ã€‚æ‰€ä»¥ï¼Œå°±ä¸€ç›´æ²¡æœ‰å‘Šè¯‰äº²äººå’Œèº«è¾¹çš„æœ‹å‹ã€‚æ²¡æƒ³åˆ°ï¼Œè¿™æ¬¡é€‰äº†ä¸€ä¸ªå¹¸è¿çš„è½¦ç‰Œå·ï¼Œè¿˜æ˜¯æ²¡å¿ä½å‘äº†ä¸€ä¸ªéƒ¨åˆ†å¥½å‹ä¸å¯è§çš„æœ‹å‹åœˆã€‚\nè¿™è¯´æ˜è‡ªå·±å®šåŠ›è¿˜æ˜¯ä¸å¤Ÿï¼Œåˆ†äº«æ¬²å¤ªå¼ºï¼Œä¸å¤Ÿè°¦è™šå’Œä½è°ƒã€‚æ»¡æ‹›æŸï¼Œè°¦å—ç›Šã€‚åªæ˜¯ä¹°äº†ä¸€ä¸ªè½¦å’Œé€‰åˆ°ä¸€ä¸ªå¹¸è¿çš„è½¦ç‰Œå·è€Œå·²ï¼Œä¸èƒ½é«˜å…´å¤ªæ—©ï¼Œåé¢è¿˜è¦èŠ±æ—¶é—´ç»ƒè½¦ä¸Šè·¯ã€å¼€è½¦è¿˜è¦æ…¢å’Œç¨³ï¼Œä¸èƒ½å‡ºäº¤é€šäº‹æ•…ï¼Œé“­è®° â€œæ–°æ‰‹ä¸Šè·¯ï¼Œå¤šå¤šæŒ‡æ•™â€ã€‚\nå­¦è‹±è¯­ï¼Œæœ€é‡è¦çš„æ˜¯ç»ƒä¹ ã€‚å¼€è½¦ï¼Œæœ€é‡è¦çš„æ˜¯æ…¢ã€‚\nå­¦ä¹  å†…è§‚å†¥æƒ³ ä¸€æœˆä»½æŠ¥åå†…è§‚å†¥æƒ³è®­ç»ƒè¥çš„åˆè¡·æ˜¯æƒ³å­¦ä¹ å†…è§‚å†¥æƒ³çš„æ–¹æ³•ï¼Œåæ¥å› ä¸ºæ¯å¤©æ—©ä¸Šè¦èµ¶åœ°é“ä»¥åŠè§‰å¾—è¯¾ç¨‹å†…å®¹å’Œè‡ªå·±æœŸæœ›çš„æœ‰äº›å·®è·ï¼Œå°±æ²¡æœ‰åšæŒå¬è¯¾å’Œæ‰“å¡ã€‚\nè™½ç„¶ï¼Œæ²¡æœ‰å¬å®Œæ‰€æœ‰è¯¾ç¨‹ï¼Œä½†æ˜¯ä»å¼€å§‹å‡ èŠ‚è¯¾ç¨‹ï¼Œåˆæ­¥ä½“ä¼šå’Œæ„Ÿå—äº†ä¸€ä¸‹ä»€ä¹ˆæ˜¯å†…è§‚å†¥æƒ³ï¼Œä¹Ÿè®¤è¯†äº†ä¸€äº›å†…è§‚å†¥æƒ³çš„æœ‹å‹ã€‚ä¹Ÿæ²¡æœ‰æƒ³åˆ°ï¼Œæœ€åè¿˜æ”¶åˆ°äº†ä¸€ä¸ªç»“ä¸šè¯ä¹¦ã€‚\nPython æœ€è¿‘æœ‰ä¸ªæœºå™¨å­¦ä¹ çš„é¡¹ç›®ï¼Œç”¨åˆ°äº† Pythonï¼Œæ‰€ä»¥éœ€è¦å­¦ä¹  Python å¹¶æŒæ¡ç›¸å…³çš„ä¸šåŠ¡çŸ¥è¯†ã€‚è¿™ä¸€ä¸ªæœºä¼šï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚\nå¨±ä¹ -ã€Šç²‰è‰²ç†è®ºã€‹ã€‚è¿™éƒ¨æ³°å›½åŒå¥³ä¸»çš„åŒæ€§ç”µè§†å‰§ï¼Œè±†ç“£ä¸Šè¯„åˆ† 9.2ï¼Œåœ¨è¿™å‘¨å®Œç»“äº†ã€‚\nåˆ†äº« HashedWheelTimerï¼šæ˜¯æ¥è‡ªäº Netty çš„å·¥å…·ç±»ï¼Œåœ¨ netty-common åŒ…ä¸­ã€‚å®ƒç”¨äºå®ç°å»¶æ—¶ä»»åŠ¡ã€‚\nKillbill common queueï¼šä¸€ä¸ªåŸºäº DB å®ç°çš„åˆ†å¸ƒå¼çš„é˜Ÿåˆ—ï¼Œå®ƒä¸Šå±‚è¿˜åŒ…è£…äº† EventBus äº‹ä»¶æ€»çº¿æœºåˆ¶ã€‚\nä»¥ä¸Šã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/02/13/weekly_review_6/","summary":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-02-06 åˆ° 2023-02-12 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¿™ç¯‡å‘¨æŠ¥åˆæ˜¯åœ¨ååœ°é“çš„æ—¶å€™å®Œæˆç¼–å†™çš„ï¼Œä¸€è¾¹ååœ°é“ï¼Œä¸€è¾¹å›é¡¾ä¸Šä¸€å‘¨å‘ç”Ÿçš„äº‹æƒ…ï¼Œä¸€è¾¹å¤ç›˜å’Œæ€»ç»“ã€‚ååœ°é“å¤§æ¦‚æœ‰ä¸€ä¸ªåŠå°æ—¶ï¼Œä»å®¶åˆ°å…¬å¸çš„ä¸€æ®µé€šå‹¤è·¯ç¨‹ã€‚ç°åœ¨è¿˜æ²¡æœ‰ä¹°è½¦ï¼Œæ‰€ä»¥éƒ½æ˜¯ååœ°é“ä¸Šä¸‹ç­ã€‚\nè¯´åˆ°è½¦ï¼Œå‘¨å…­å»äºŒæ‰‹å¸‚åœºä¹°äº†ä¸€è¾† 17 å¹´å‡ºäº§çš„ä¸Šæ±½å®æ¥ï¼Œä»Šå¤©å‘¨ä¸€å»è¿‡äº†æˆ·å¹¶ä¸”é€‰äº†ä¸€ä¸ªå¹¸è¿çš„è½¦ç‰Œå·ï¼Œå°¾å·æ˜¯ 8688ï¼Œå¯“æ„ç€è¦å‘å‘å‘ï¼\nä¸Šä¸ªæœˆæŠ¥åçš„å†…è§‚è®­ç»ƒè¥ï¼Œè¿™å‘¨ä¹Ÿç»“ä¸šäº†ï¼Œè®­ç»ƒè¥è¿è¥äººå‘˜è¿˜ç»™æˆ‘å‘äº†ä¸€ä¸ªç»“ä¸šè¯ä¹¦ã€‚\nè¿™æ˜¯å†™å‘¨æŠ¥çš„ç¬¬å…­å‘¨ï¼Œè§‚å¯Ÿäº†ä¸€ä¸‹åšå®¢è®¿é—®é‡ï¼Œä»å¼€å§‹ç»Ÿè®¡èµ·åˆ°è¿™å‘¨ä¸åˆ°ä¸€ä¸ªæœˆçš„æ—¶é—´ï¼Œè®¿é—®é‡çªç ´äº† 1000ã€‚\nå·¥ä½œ è¿™å‘¨çš„å·¥ä½œä¸»è¦å†…å®¹æ˜¯åœ¨é¡¹ç›®é‡Œå®ç°ç”¨æˆ·å¯ä»¥åˆ‡æ¢ç§Ÿæˆ·å’Œç§Ÿæˆ·æ•°æ®æ‹†åˆ†ã€‚\nç¬¬ä¸€ä¸ªåŠŸèƒ½çš„éœ€æ±‚æ˜¯ä¸€ä¸ªè´¦å·ï¼ˆæœ‰å§“åã€æ‰‹æœºå·ã€å¯†ç ç­‰å±æ€§ï¼‰å¯ä»¥è®¿é—®å¤šä¸ªç§Ÿæˆ·ï¼Œåœ¨æ¯ä¸ªç§Ÿæˆ·é‡Œæœ‰è‡ªå·±çš„æ•°æ®æƒé™å’Œè§’è‰²ã€‚ç¬¬äºŒä¸ªåŠŸèƒ½ï¼Œä¸»è¦æ˜¯ä½¿ç”¨ SQL è¿›è¡Œæ•°æ®åŠ å·¥ã€‚\næ€»ä½“ä¸Šæ¥è¯´ï¼Œè¿™å‘¨å·¥ä½œå¤„äºå……å®å¿™ç¢Œçš„æƒ…å†µã€‚è€Œä¸”ï¼Œä¸Šä¸‹ç­çš„é€šå‹¤æ—¶é—´ï¼Œä¹Ÿåœ¨ B ç«™ä¸Šçœ‹è§†é¢‘ã€‚è¿™å‘¨ä¸»è¦çœ‹çš„æ˜¯å°é©¬å“¥çš„ Java è®­ç»ƒè¥çš„å…¬å¼€è§†é¢‘ã€‚å°é©¬å“¥çš„ B ç«™è§†é¢‘ï¼Œæ˜¯æˆ‘æœ€è¿‘åˆ·çš„æ¯”è¾ƒå¤šçš„ä¸€ä¸ªè§†é¢‘ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯ coder1v5 çš„è§†é¢‘ï¼Œä»–ä»¬åˆ†äº«çš„è§†é¢‘éƒ½æ˜¯å…³äº Java çš„ï¼Œé‡Œé¢æœ‰éå¸¸å¤šçš„å¹²è´§ï¼Œè€Œä¸”è¿˜æä¾›äº†æºä»£ç ã€‚å¦‚æœä½ ä¹Ÿæ˜¯ä¸€å Java å¼€å‘å·¥ç¨‹å¸ˆï¼Œæ¨èä½ ä¹Ÿå…³æ³¨ä»–ä»¬ã€‚\nç”Ÿæ´» ä¹°è½¦å’Œé€‰å· å»å¹´ 11 æœˆ 16 æ—¥ï¼Œæ‹¿åˆ°äº†é©¾ç…§ï¼Œç›´åˆ°ç°åœ¨æ‰ä¹°äº†ä¸€è¾†è½¦ã€‚è¿‡å¹´å‰ï¼Œå› ä¸ºç–«æƒ…åŠ ä¸Šå·¥ä½œå¿™ï¼Œä¸€ç›´æ²¡æœ‰æŠ½å‡ºæ—¶é—´å»äº†è§£è½¦å­è¡Œæƒ…ã€‚å¯èƒ½æ˜¯å¯¹äºè½¦å­çš„éœ€æ±‚æ„Ÿæ²¡æœ‰é‚£ä¹ˆå¼ºçš„åŸå› ï¼Œæ‰å¯¼è‡´è€ƒé©¾ç…§ã€ä¹°è½¦ä¸ç§¯æã€‚ç»“å©šä¹‹å‰ï¼Œä½åœ¨å…¬å¸æ—è¾¹ï¼Œèµ°è·¯äº”åˆ†é’Ÿä¸Šä¸‹ç­ï¼Œæ ¹æœ¬å°±ç”¨ä¸ä¸Šè½¦ã€‚ç»“å©šä¹‹åï¼Œä»å…‰è°·æ¬åˆ°æ±‰å£ï¼Œæ¯å¤©ä¸Šä¸‹ç­åœ¨è·¯ä¸Šé€šå‹¤æ—¶é—´éƒ½æœ‰ä¸‰ä¸ªå°æ—¶äº†ã€‚æ¯å¤©æ—©ä¸Šä¸ƒç‚¹å°±è¦èµ·æ¥åšé¥­ï¼ˆå¸¦é¥­åˆ°å…¬å¸ï¼Œä¸­åˆå¾®æ³¢ç‚‰çƒ­ç€åƒï¼Œæ¯å¤©å¯ä»¥çœä¸‹ä¸€é¤ä¼™é£Ÿè´¹ï¼‰ï¼Œç„¶åå»èµ¶åœ°é“ã€‚ç–«æƒ…æ”¾å¼€ä¹‹å‰ï¼Œåœ°é“ä¸Šäººä¸å¤šï¼Œæ¯æ¬¡éƒ½æœ‰ä½ç½®åã€‚ç–«æƒ…æ”¾å¼€ä¹‹åï¼Œåœ°é“é‡Œéƒ½æ˜¯äººï¼Œä¸æ˜¯æ¯æ¬¡éƒ½æœ‰ä½ç½®åï¼Œç»å¸¸è¦ç«™ç€ã€‚ç«™ç€çš„æ—¶å€™ï¼Œæœ‰æ—¶å€™å°±å†…è§‚å†¥æƒ³ï¼Œæƒ³æƒ³æœ€è¿‘æœ‰æ²¡æœ‰åšå¾—ä¸å¯¹çš„åœ°æ–¹ï¼Œæƒ³æƒ³å·¥ä½œä¸‹ä¸€æ­¥è¯¥æ€ä¹ˆè®¡åˆ’ï¼›æœ‰æ—¶å€™å°±çœ‹ B ç«™å…³äº Java çš„è§†é¢‘ã€‚ä¹Ÿç®—æ˜¯å……åˆ†åˆ©ç”¨äº†è¿™æ®µé€šå‹¤æ—¶é—´ã€‚\nä¸ºäº†ä¸Šä¸‹ç­é€šå‹¤æ›´æ–¹ä¾¿ï¼Œæ‰è®¡åˆ’ä¹°è½¦çš„ï¼Œä¹Ÿä¸çŸ¥é“å¼€è½¦èƒ½å¤Ÿç¼©çŸ­å¤šå°‘é€šå‹¤æ—¶é—´ï¼Œä¹Ÿå¸Œæœ›è¿™èŠ‚çº¦ä¸‹æ¥çš„æ—¶é—´ï¼Œå¯ä»¥ç”¨åœ¨è¯»ä¹¦å’Œå¥èº«ä¸Šã€‚å¦å¤–ä¸€æ–¹é¢ï¼Œä¹°è½¦äº†ä¹‹åï¼Œå›å®¶çœ‹æœ›çˆ¶æ¯ä¼šæ›´æ–¹ä¾¿ã€‚è¿™å°±æ˜¯ä¹°è½¦çš„åŸå› ã€‚\nè€ƒè™‘åˆ°åˆšæ‹¿é©¾ç…§ã€ä»¥åè¿˜è¦ä¹°æˆ¿ï¼Œè¿™æ¬¡å°±åªä¹°äº†ä¸€ä¸ªäºŒæ‰‹è½¦ã€‚åŸè®¡åˆ’åªä¹°ä¸ªä¸‰ä¸‡å·¦å³çš„è½¦ï¼Œæœ€åè¿˜æ˜¯è¶…å‡ºäº†é¢„ç®—ã€‚\nå»äºŒæ‰‹å¸‚åœºä¹°è½¦çš„æ—¶å€™ï¼Œæ˜¯åœ¨å‘¨å…­ï¼Œå‘¨æœ«è¿‡ä¸äº†æˆ·ï¼Œæ‰€ä»¥è¿™å‘¨ä¸€åˆè¿‡æ¥åŠç†è¿‡æˆ·å’Œé€‰è½¦ç‰Œå·ã€‚è¿‡æˆ·çš„è¿‡ç¨‹è¿˜æ˜¯å¾ˆå¿«çš„ï¼Œå…¨éƒ¨äº¤ç»™äºŒæ‰‹å¸‚åœºçš„äººä»£åŠã€‚è‡³äºï¼Œé€‰è½¦ç‰Œå·ï¼Œä¹‹å‰äº†è§£äº†ä¸€ä¸‹ï¼Œè½¦ç‰Œå·å°½é‡é€‰å°¾å·éƒ½æ˜¯æ•°å­—çš„ï¼Œè¿™æ ·å¥½è®°ï¼›ä¸è¦å¸¦æ•°å­— 4ï¼Œä¸å‰åˆ©ï¼›é€‰å·æœ‰æ—¶é—´é™åˆ¶ï¼Œè¶…è¿‡äº†æ—¶é—´æœªé€‰ï¼Œä¼šé»˜è®¤é€‰ç¬¬ä¸€ä¸ªã€‚ç‚¹å‡» â€œé€‰å·å¼€å§‹â€ æŒ‰é’®ä¹‹å‰ï¼Œå¿ƒé‡Œè¿˜æœ‰ç‚¹ç´§å¼ ã€‚å½“çœ‹åˆ°ç¬¬ä¸€å±çš„å·ç æ—¶å€™ï¼Œå¾ˆå¿«åœ°æ‰«æäº†ä¸€éï¼Œå‘ç°äº†ä¸€ä¸ªå°¾å·ä¸º 8688 çš„å·ç ã€‚äºæ˜¯ï¼Œå°±è·Ÿä¸€åŒè¿‡æ¥ä¹°è½¦çš„å§å¤«è¯´ï¼Œè¿™ä¸ªå·ç æ€ä¹ˆæ ·ã€‚å§å¤«æ¿€åŠ¨åœ°è¯´è¿™ä¸ªå·ç å¥½ï¼Œå°±é€‰è¿™ä¸ªã€‚çœŸçš„æ²¡æœ‰æƒ³åˆ°ä»Šå¤©è¿æ°”è¿™ä¹ˆå¥½ï¼Œé€‰åˆ°äº†è¿™ä¹ˆå¥½çš„ä¸€ä¸ªå·ç ã€‚æ¿€åŠ¨å¾—æƒ³è·Ÿæœ‹å‹åœˆé‡Œçš„å¥½å‹åˆ†äº«ã€‚ä¹‹å‰ä¹°è½¦çš„æ—¶å€™ï¼Œä»˜å®Œé¢„ä»˜æ¬¾ï¼Œå°±æœ‰åˆ†äº«ä¹°è½¦çš„å–œæ‚¦çš„å†²åŠ¨ã€‚è¿™æ—¶å€™ï¼Œè€å©†åœ¨æ—è¾¹è·Ÿæˆ‘è¯´ï¼Œè¦ä½è°ƒï¼Œä¸è¦å’Œèº«è¾¹çš„äº²æˆšè¯´ã€‚æ‰€ä»¥ï¼Œå°±ä¸€ç›´æ²¡æœ‰å‘Šè¯‰äº²äººå’Œèº«è¾¹çš„æœ‹å‹ã€‚æ²¡æƒ³åˆ°ï¼Œè¿™æ¬¡é€‰äº†ä¸€ä¸ªå¹¸è¿çš„è½¦ç‰Œå·ï¼Œè¿˜æ˜¯æ²¡å¿ä½å‘äº†ä¸€ä¸ªéƒ¨åˆ†å¥½å‹ä¸å¯è§çš„æœ‹å‹åœˆã€‚\nè¿™è¯´æ˜è‡ªå·±å®šåŠ›è¿˜æ˜¯ä¸å¤Ÿï¼Œåˆ†äº«æ¬²å¤ªå¼ºï¼Œä¸å¤Ÿè°¦è™šå’Œä½è°ƒã€‚æ»¡æ‹›æŸï¼Œè°¦å—ç›Šã€‚åªæ˜¯ä¹°äº†ä¸€ä¸ªè½¦å’Œé€‰åˆ°ä¸€ä¸ªå¹¸è¿çš„è½¦ç‰Œå·è€Œå·²ï¼Œä¸èƒ½é«˜å…´å¤ªæ—©ï¼Œåé¢è¿˜è¦èŠ±æ—¶é—´ç»ƒè½¦ä¸Šè·¯ã€å¼€è½¦è¿˜è¦æ…¢å’Œç¨³ï¼Œä¸èƒ½å‡ºäº¤é€šäº‹æ•…ï¼Œé“­è®° â€œæ–°æ‰‹ä¸Šè·¯ï¼Œå¤šå¤šæŒ‡æ•™â€ã€‚\nå­¦è‹±è¯­ï¼Œæœ€é‡è¦çš„æ˜¯ç»ƒä¹ ã€‚å¼€è½¦ï¼Œæœ€é‡è¦çš„æ˜¯æ…¢ã€‚\nå­¦ä¹  å†…è§‚å†¥æƒ³ ä¸€æœˆä»½æŠ¥åå†…è§‚å†¥æƒ³è®­ç»ƒè¥çš„åˆè¡·æ˜¯æƒ³å­¦ä¹ å†…è§‚å†¥æƒ³çš„æ–¹æ³•ï¼Œåæ¥å› ä¸ºæ¯å¤©æ—©ä¸Šè¦èµ¶åœ°é“ä»¥åŠè§‰å¾—è¯¾ç¨‹å†…å®¹å’Œè‡ªå·±æœŸæœ›çš„æœ‰äº›å·®è·ï¼Œå°±æ²¡æœ‰åšæŒå¬è¯¾å’Œæ‰“å¡ã€‚\nè™½ç„¶ï¼Œæ²¡æœ‰å¬å®Œæ‰€æœ‰è¯¾ç¨‹ï¼Œä½†æ˜¯ä»å¼€å§‹å‡ èŠ‚è¯¾ç¨‹ï¼Œåˆæ­¥ä½“ä¼šå’Œæ„Ÿå—äº†ä¸€ä¸‹ä»€ä¹ˆæ˜¯å†…è§‚å†¥æƒ³ï¼Œä¹Ÿè®¤è¯†äº†ä¸€äº›å†…è§‚å†¥æƒ³çš„æœ‹å‹ã€‚ä¹Ÿæ²¡æœ‰æƒ³åˆ°ï¼Œæœ€åè¿˜æ”¶åˆ°äº†ä¸€ä¸ªç»“ä¸šè¯ä¹¦ã€‚\nPython æœ€è¿‘æœ‰ä¸ªæœºå™¨å­¦ä¹ çš„é¡¹ç›®ï¼Œç”¨åˆ°äº† Pythonï¼Œæ‰€ä»¥éœ€è¦å­¦ä¹  Python å¹¶æŒæ¡ç›¸å…³çš„ä¸šåŠ¡çŸ¥è¯†ã€‚è¿™ä¸€ä¸ªæœºä¼šï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚\nå¨±ä¹ -ã€Šç²‰è‰²ç†è®ºã€‹ã€‚è¿™éƒ¨æ³°å›½åŒå¥³ä¸»çš„åŒæ€§ç”µè§†å‰§ï¼Œè±†ç“£ä¸Šè¯„åˆ† 9.2ï¼Œåœ¨è¿™å‘¨å®Œç»“äº†ã€‚\nåˆ†äº« HashedWheelTimerï¼šæ˜¯æ¥è‡ªäº Netty çš„å·¥å…·ç±»ï¼Œåœ¨ netty-common åŒ…ä¸­ã€‚å®ƒç”¨äºå®ç°å»¶æ—¶ä»»åŠ¡ã€‚\nKillbill common queueï¼šä¸€ä¸ªåŸºäº DB å®ç°çš„åˆ†å¸ƒå¼çš„é˜Ÿåˆ—ï¼Œå®ƒä¸Šå±‚è¿˜åŒ…è£…äº† EventBus äº‹ä»¶æ€»çº¿æœºåˆ¶ã€‚\nä»¥ä¸Šã€‚","title":"å‘¨æŠ¥-6ï½œä¹°è½¦å’Œé€‰å·ã€ç²‰è‰²ç†è®º"},{"content":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-01-30 åˆ° 2023-02-05 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¿™å‘¨æ˜¯è¿‡å¹´åçš„ç¬¬ä¸€ä¸ªå·¥ä½œå‘¨ï¼Œè¢«å›½å®¶å®‰æ’äº†è¿ä¸Šä¸ƒå¤©ç­ï¼Œç®—æ˜¯ä½“ä¼šäº†ä¸€æ¬¡ â€œè¿‡å¹´ä¸ƒå¤©ä¹ï¼Œä¸Šç­ä¸ƒå¤©ç´¯â€ çš„è¿‡å±±è½¦ã€‚ä¸ƒå¤©çš„å·¥ä½œä¸»è¦æ˜¯æµ‹è¯•å¹¶å‘å¸ƒé¡¹ç›®ï¼Œæ¯å¤©å¿™çš„ç„¦å¤´ä¹±é¢ï¼Œç”Ÿæ€•é¡¹ç›®å‡ºäº†é—®é¢˜ã€‚æœ‰å¥è¯è¯´ï¼Œæ€•ä»€ä¹ˆæ¥ä»€ä¹ˆã€‚æ²¡æƒ³åˆ°å‘¨å…­è¿˜æ˜¯æŠ¥å‡ºäº†ä¸€ä¸ªæ•…éšœï¼Œè¿˜åœ¨ç¡è§‰ä¸­çš„æˆ‘è¢«ä¸€ä¸ªç”µè¯åµé†’ï¼Œæ¥ç€å¿™ç€æ‰¾é—®é¢˜å’Œè§£å†³æ–¹æ³•ï¼Œä¸€å¤©çš„æ—¶é—´å°±éƒ½èŠ±åœ¨è¿™ä¸Šé¢ã€‚ä¸‡å¹¸çš„æ˜¯äº‹æ•…å½±å“ä¸å¤§ï¼Œå‘å¸ƒäº†ä¸€ä¸ªå°ç‰ˆæœ¬è¿›è¡Œä¿®å¤ã€‚äº‹æ•…åŸå› ï¼Œè¿˜æ˜¯å€¼å¾—è­¦æƒ•ã€‚\nå·¥ä½œæ€»ç»“ é¡¹ç›®äº‹æ•… è¿™å‘¨ä¸»è¦æ˜¯è‡ªå®šä¹‰æ‹¦æˆªå™¨å’Œ ErrorCoder æ¥è®°å½• feign è¯·æ±‚çš„è°ƒç”¨æ¬¡æ•°ï¼ŒåŒ…æ‹¬è°ƒç”¨æˆåŠŸçš„å’Œå¤±è´¥çš„ã€‚å¦å¤–ï¼Œå¦‚æœè°ƒç”¨å¤±è´¥ï¼Œè®¾ç½®äº†é‡è¯•ä¸¤æ¬¡ã€‚è¿™é‡Œé‡è¯•çš„å‰ææ˜¯ http è¯·æ±‚å‡ºç° 4xx æˆ–è€… 5xx çŠ¶æ€ç é”™è¯¯ï¼Œå¦‚æœæ˜¯çŠ¶æ€ç ä¸º 200 ä½†è¿”å›äº†è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸ï¼Œæ˜¯ä¸ä¼šè§¦å‘é‡è¯•æœºåˆ¶çš„ã€‚è¿™ä¸€ç‚¹æ²¡æœ‰æ³¨æ„åˆ°ï¼Œè€Œå‘å¸ƒå‰ï¼Œæˆ‘æƒ³å½“ç„¶çš„æŠŠä¸€ä¸ªæ¥å£çš„æ‰‹åŠ¨é‡è¯•ä»£ç åˆ æ‰äº†ï¼Œå¯¼è‡´è°ƒç”¨è¯¥æ¥å£å‡ºç°ä¸šåŠ¡å¼‚å¸¸ä¹‹åæ²¡æœ‰è¿›è¡Œé‡è¯•ï¼Œå½±å“äº†ä¸šåŠ¡æ–¹çš„ä½¿ç”¨ã€‚\nå‡ºç°è¯¥é—®é¢˜çš„åŸå› ï¼Œä¸€æ˜¯æ²¡æƒ³å‡ºé‡è¯•çš„å‰ææ¡ä»¶ï¼Œæ²¡æœ‰å†™ä»£ç æ³¨é‡Šï¼›äºŒæ˜¯æ²¡æœ‰å†™å•å…ƒæµ‹è¯•ï¼›ä¸‰æ˜¯æ²¡æœ‰äº¤å‰ä»£ç å®¡æ ¸ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ç‚¹ï¼Œè¶Šæ˜¯é¡¹ç›®å‘å¸ƒå…³é”®æ—¶æœŸï¼Œè¶Šè¦æ³¨æ„ä¼‘æ¯ï¼Œä¿æŒå¤§è„‘è¶³å¤Ÿæ¸…æ™°å’Œæ•æ·ã€‚\nAOP æ—¥å¿—è®°å½• å‚è€ƒ ã€æ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹ï¼ˆäºŒï¼‰-å“”å“©å“”å“©ã€‘ åœ¨é¡¹ç›®é‡Œæ·»åŠ ä»£ç å¯¹ controller æ–¹æ³•è¯·æ±‚å‚æ•°ã€è¿”å›ç»“æœã€æ‰§è¡Œæ—¶é—´çš„è®°å½•ã€‚è§†é¢‘ä¸­è®²çš„å¾ˆæ¸…æ¥šï¼Œè¿™é‡Œå°±ä¸è´´ä»£ç äº†ã€‚\nè¯¥æ–¹æ³•ï¼Œå¯ä»¥å¯¹ controller çš„æ‰€æœ‰æ–¹æ³•ï¼ˆä¸ç®¡æ˜¯ get è¿˜æ˜¯ post æˆ–å…¶ä»–æ–¹æ³•ï¼‰ï¼Œéƒ½è®°å½•æ—¥å¿—ã€‚å¦‚æœæƒ³æ’é™¤ get æ–¹æ³•ï¼ˆä¸€ä¸ªé¡¹ç›®é‡ŒæŸ¥è¯¢æ¯”ä¿®æ”¹è¯·æ±‚å¤§å¾ˆå¤šï¼‰ï¼Œéœ€è¦æ·»åŠ ä»£ç è¿›è¡Œè¿‡æ»¤ã€‚\nå¦å¤–ï¼Œæ‰“å°è¯·æ±‚å‚æ•°æ—¶ï¼Œå®é™…æ˜¯è®°å½•çš„è¯·æ±‚å‚æ•°çš„ toString æ–¹æ³•ï¼Œå¦‚æœè¯·æ±‚å‚æ•°é‡Œæœ‰äº›å¯¹è±¡æ²¡æœ‰å®šä¹‰ toString æ–¹æ³•ï¼Œåˆ™è®°å½•çš„æ˜¯å¯¹è±¡çš„å¼•ç”¨åœ°å€ã€‚å†è€…ï¼Œå¦‚æœå¯¹è±¡é‡Œæœ‰äº›æ•æ„Ÿå­—æ®µä¸æƒ³è¾“å‡ºåˆ°æ—¥å¿—é‡Œï¼Œåˆ™éœ€è¦é‡å†™ toString æ–¹æ³•ã€‚ä¸€ä¸ªå¯é€‰çš„æ–¹æ³•æ˜¯ï¼Œæ”¹ä¸ºæ‰“å°è¯·æ±‚å‚æ•°çš„ json åºåˆ—åŒ–å€¼ï¼Œè¿™æ ·åšåˆä¼šå¸¦æ¥åºåˆ—åŒ–å¼€é”€ã€‚\nå¦‚æœ controller å±‚ä»£ç è¢«ä»£ç†äº†å¤šæ¬¡ï¼Œåˆ™è¯·æ±‚å‚æ•°å’Œè¿”å›ç»“æœä¼šæ‰“å°å¤šæ¬¡ã€‚\nç”Ÿæ´» ç‰™ç–¼ ä¸€ä¸ªæœˆé»‘é£é«˜çš„æ™šä¸Šï¼ŒåŠ ç­å›æ¥çš„ç¨‹åºå‘˜å·å·å–äº†ä¸‰æ¯ç‰›å¥¶ï¼Œç»“æœç¬¬äºŒå¤©ç‰™é½¿å¼€å§‹ç–¼äº†ï¼Œç‰¹åˆ«æ˜¯åƒåˆ°å†·çƒ­é…¸ç”œçš„ä¸œè¥¿ï¼Œéƒ½ä¼šçŸ­æš‚çš„å·¨ç–¼ã€‚å»ç‰™ç§‘è¯Šæ‰€çœ‹äº†ï¼ŒåŒ»ç”Ÿè¯´è¦åšæ ¹ç®¡æ²»ç–—ï¼Œè´¹ç”¨ 800ï¼Œå¯ä»¥æŠ¥é”€ 420ï¼Œåšå®Œä»¥åï¼Œç‰™å¥—ä»·æ ¼å¦ç®—ï¼Œæœ‰ä¸€åƒåˆ°å‡ åƒçš„ä»·æ ¼ä¸ç­‰ã€‚åˆšä¸ä¹…è¿˜åˆ·åˆ°è§†é¢‘è¯´ï¼Œæœ‰ä¸¤ä¸ªçœè¦è§„èŒƒæ²»ç–—ç‰™é½¿è´¹ç”¨ã€‚\nå¿ç€ç–¼ç—›ä¸Šäº†ä¸€å‘¨ç­ï¼Œç»“æœä¸ä»…ç‰™ç—›ï¼Œåƒé¥­æ²¡èƒƒå£ï¼Œè¿˜å½±å“äº†ä¸Šç­ï¼ŒçœŸæ˜¯å¾—ä¸å¿å¤±ã€‚\nå‘¨å…­æ™šä¸Šï¼Œåœ¨ç‰™é½¿ç–¼ç—›çš„åœ°æ–¹ï¼Œæ’äº†ä¸€ç‚¹è€çˆ¸ç»™æˆ‘çš„è¯æ°´ã€‚ç¡è§‰æ—¶ï¼Œå…ˆæ˜¯ç•å†·ï¼Œå†å°±æ˜¯ç‰™ç–¼çš„åœ°æ–¹å‘ç‚ï¼Œè‚šå­å‘çƒ§ï¼Œçƒ§åˆ°äº†ä¸çŸ¥é“å¤šå°‘åº¦ï¼Œåæ­£æˆ‘æ˜¯æ²¡æœ‰æ‹¿æ¸©åº¦è®¡å»æµ‹é‡ã€‚çƒ§çš„æˆ‘å¤§è„‘éƒ½æ˜¯ç³Šçš„ï¼Œä¸€æ™šä¸Šæ²¡ç¡å¥½ï¼Œä¸­é€”è¿˜é†’äº†å‡ æ¬¡ã€‚å¥½åœ¨ç¬¬äºŒå¤©ï¼Œå°±å¥½äº†ä¸€äº›ï¼Œåƒä¸œè¥¿ä¹Ÿæ²¡é‚£ä¹ˆç–¼äº†ã€‚çœ‹æ¥ï¼Œä¸“å®¶é¡ºå‘çƒ§æ˜¯ä½“å†…ç»†èŒåœ¨å’Œç—…æ¯’åšæ–—äº‰ï¼Œåº”è¯¥æ˜¯å¯¹çš„å•°ã€‚\nç»å†äº†è¿™ä¸€æ™šä¸Šï¼Œæ„Ÿè§‰åƒæ˜¯ä½“éªŒäº†ä¸€æ¬¡é˜³çš„è¿‡ç¨‹ã€‚ä¹‹å‰æ–°å† é˜³äº†ï¼Œæˆ‘æ˜¯è½»ç—‡çŠ¶ï¼Œæ²¡æœ‰å‘çƒ§ã€‚è¿™æ¬¡ç‰™ç–¼å‘çƒ§ï¼Œç®—æ˜¯æŠŠä¹‹å‰æ–°å† æ²¡æœ‰åƒè¿‡çš„è‹¦æ‰¾è¡¥å›æ¥ï¼Œäººç”Ÿä¹Ÿç®—æ˜¯å¤šäº†ä¸€ç§ä½“éªŒã€‚\nå¨±ä¹ -ã€Šç‹‚é£™ã€‹ã€‚æœ€è¿‘å¾ˆç«ï¼Œä¹Ÿåˆšå¥½å®Œç»“äº†ã€‚æˆ‘æ²¡æœ‰å»çœ‹ï¼Œæ²¡æœ‰æ—¶é—´å»è¿½ï¼Œå°±çœ‹äº†å‰é¢å‡ é›†ã€‚\n-ã€Šç²‰çº¢ç†è®ºã€‹ã€‚è€å©†åœ¨è¿½çš„ä¸€éƒ¨æ³°å‰§ï¼Œå¥¹æ˜¯åœ¨å¾®åšçœ‹äº›åˆ«äººå‰ªè¾‘çš„å‡ åˆ†é’Ÿçš„ç‰‡æ®µã€‚å«æˆ‘ä¹Ÿå»å¾®åšçœ‹çœ‹ï¼Œæˆ‘è¯´æˆ‘ä¸ç”¨å¾®åšï¼Œæˆ‘ç¿»å¢™å»æ‰¾ç½‘ç«™è§‚çœ‹ã€‚è€å©†çœ¼ç›ä¸€äº®ï¼Œè¯´é‚£ä¸æ˜¯å¯ä»¥çœ‹åˆ°æ— åˆ å‡ç‰ˆæœ¬ï¼Œé‚£ä¸ªå…´å¥‹åŠ²å“Ÿï¼å¾ˆå¿«ï¼Œæˆ‘æ‰¾åˆ°äº†ç½‘ç«™ï¼Œå‘ç°å·²ç»ä¸Šçº¿äº† 11 é›†ï¼Œè€Œä¸”æ¯é›†éƒ½æœ‰ 60 å¤šåˆ†é’Ÿé•¿ï¼ˆè€å©†çœ‹çš„éƒ½æ˜¯é˜‰å‰²ç‰ˆï½ ğŸ˜¯ï¼‰ã€‚\nå­¦ä¹  æœ€è¿‘ Damus å¾ˆç«ï¼Œæˆ‘ä¹Ÿå»æ³¨å†Œäº†ä¸€ä¸ªè´¦å·ï¼Œä¸ºæ­¤è¿˜é‡æ–°ä¸‹è½½äº†ç‹ç‹¸ ğŸ¦Š é’±åŒ…ã€‚éšå³ï¼Œå¹²è„†ä¹Ÿæ³¨å†Œäº† Mastodon è´¦å·å’Œ Crossbell è´¦å·ã€‚\næˆ‘çš„ Damus è´¦å· npub1dav96pmjv58n60eqz7ctmhvsd7t2yljvzevf6uckmchz6zamx2wq0k7dm5\næˆ‘çš„ Mastodon è´¦å· @chensoul@mas.to\næˆ‘çš„ crossbell è´¦å· chensoul@crossbell\nå¥½ç‰©åˆ†äº« Mac åˆ é™¤åŸç”Ÿè‹±æ–‡ ABC ä»¥ä¸Šã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/02/07/weekly_review_5/","summary":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-01-30 åˆ° 2023-02-05 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¿™å‘¨æ˜¯è¿‡å¹´åçš„ç¬¬ä¸€ä¸ªå·¥ä½œå‘¨ï¼Œè¢«å›½å®¶å®‰æ’äº†è¿ä¸Šä¸ƒå¤©ç­ï¼Œç®—æ˜¯ä½“ä¼šäº†ä¸€æ¬¡ â€œè¿‡å¹´ä¸ƒå¤©ä¹ï¼Œä¸Šç­ä¸ƒå¤©ç´¯â€ çš„è¿‡å±±è½¦ã€‚ä¸ƒå¤©çš„å·¥ä½œä¸»è¦æ˜¯æµ‹è¯•å¹¶å‘å¸ƒé¡¹ç›®ï¼Œæ¯å¤©å¿™çš„ç„¦å¤´ä¹±é¢ï¼Œç”Ÿæ€•é¡¹ç›®å‡ºäº†é—®é¢˜ã€‚æœ‰å¥è¯è¯´ï¼Œæ€•ä»€ä¹ˆæ¥ä»€ä¹ˆã€‚æ²¡æƒ³åˆ°å‘¨å…­è¿˜æ˜¯æŠ¥å‡ºäº†ä¸€ä¸ªæ•…éšœï¼Œè¿˜åœ¨ç¡è§‰ä¸­çš„æˆ‘è¢«ä¸€ä¸ªç”µè¯åµé†’ï¼Œæ¥ç€å¿™ç€æ‰¾é—®é¢˜å’Œè§£å†³æ–¹æ³•ï¼Œä¸€å¤©çš„æ—¶é—´å°±éƒ½èŠ±åœ¨è¿™ä¸Šé¢ã€‚ä¸‡å¹¸çš„æ˜¯äº‹æ•…å½±å“ä¸å¤§ï¼Œå‘å¸ƒäº†ä¸€ä¸ªå°ç‰ˆæœ¬è¿›è¡Œä¿®å¤ã€‚äº‹æ•…åŸå› ï¼Œè¿˜æ˜¯å€¼å¾—è­¦æƒ•ã€‚\nå·¥ä½œæ€»ç»“ é¡¹ç›®äº‹æ•… è¿™å‘¨ä¸»è¦æ˜¯è‡ªå®šä¹‰æ‹¦æˆªå™¨å’Œ ErrorCoder æ¥è®°å½• feign è¯·æ±‚çš„è°ƒç”¨æ¬¡æ•°ï¼ŒåŒ…æ‹¬è°ƒç”¨æˆåŠŸçš„å’Œå¤±è´¥çš„ã€‚å¦å¤–ï¼Œå¦‚æœè°ƒç”¨å¤±è´¥ï¼Œè®¾ç½®äº†é‡è¯•ä¸¤æ¬¡ã€‚è¿™é‡Œé‡è¯•çš„å‰ææ˜¯ http è¯·æ±‚å‡ºç° 4xx æˆ–è€… 5xx çŠ¶æ€ç é”™è¯¯ï¼Œå¦‚æœæ˜¯çŠ¶æ€ç ä¸º 200 ä½†è¿”å›äº†è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸ï¼Œæ˜¯ä¸ä¼šè§¦å‘é‡è¯•æœºåˆ¶çš„ã€‚è¿™ä¸€ç‚¹æ²¡æœ‰æ³¨æ„åˆ°ï¼Œè€Œå‘å¸ƒå‰ï¼Œæˆ‘æƒ³å½“ç„¶çš„æŠŠä¸€ä¸ªæ¥å£çš„æ‰‹åŠ¨é‡è¯•ä»£ç åˆ æ‰äº†ï¼Œå¯¼è‡´è°ƒç”¨è¯¥æ¥å£å‡ºç°ä¸šåŠ¡å¼‚å¸¸ä¹‹åæ²¡æœ‰è¿›è¡Œé‡è¯•ï¼Œå½±å“äº†ä¸šåŠ¡æ–¹çš„ä½¿ç”¨ã€‚\nå‡ºç°è¯¥é—®é¢˜çš„åŸå› ï¼Œä¸€æ˜¯æ²¡æƒ³å‡ºé‡è¯•çš„å‰ææ¡ä»¶ï¼Œæ²¡æœ‰å†™ä»£ç æ³¨é‡Šï¼›äºŒæ˜¯æ²¡æœ‰å†™å•å…ƒæµ‹è¯•ï¼›ä¸‰æ˜¯æ²¡æœ‰äº¤å‰ä»£ç å®¡æ ¸ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ç‚¹ï¼Œè¶Šæ˜¯é¡¹ç›®å‘å¸ƒå…³é”®æ—¶æœŸï¼Œè¶Šè¦æ³¨æ„ä¼‘æ¯ï¼Œä¿æŒå¤§è„‘è¶³å¤Ÿæ¸…æ™°å’Œæ•æ·ã€‚\nAOP æ—¥å¿—è®°å½• å‚è€ƒ ã€æ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹ï¼ˆäºŒï¼‰-å“”å“©å“”å“©ã€‘ åœ¨é¡¹ç›®é‡Œæ·»åŠ ä»£ç å¯¹ controller æ–¹æ³•è¯·æ±‚å‚æ•°ã€è¿”å›ç»“æœã€æ‰§è¡Œæ—¶é—´çš„è®°å½•ã€‚è§†é¢‘ä¸­è®²çš„å¾ˆæ¸…æ¥šï¼Œè¿™é‡Œå°±ä¸è´´ä»£ç äº†ã€‚\nè¯¥æ–¹æ³•ï¼Œå¯ä»¥å¯¹ controller çš„æ‰€æœ‰æ–¹æ³•ï¼ˆä¸ç®¡æ˜¯ get è¿˜æ˜¯ post æˆ–å…¶ä»–æ–¹æ³•ï¼‰ï¼Œéƒ½è®°å½•æ—¥å¿—ã€‚å¦‚æœæƒ³æ’é™¤ get æ–¹æ³•ï¼ˆä¸€ä¸ªé¡¹ç›®é‡ŒæŸ¥è¯¢æ¯”ä¿®æ”¹è¯·æ±‚å¤§å¾ˆå¤šï¼‰ï¼Œéœ€è¦æ·»åŠ ä»£ç è¿›è¡Œè¿‡æ»¤ã€‚\nå¦å¤–ï¼Œæ‰“å°è¯·æ±‚å‚æ•°æ—¶ï¼Œå®é™…æ˜¯è®°å½•çš„è¯·æ±‚å‚æ•°çš„ toString æ–¹æ³•ï¼Œå¦‚æœè¯·æ±‚å‚æ•°é‡Œæœ‰äº›å¯¹è±¡æ²¡æœ‰å®šä¹‰ toString æ–¹æ³•ï¼Œåˆ™è®°å½•çš„æ˜¯å¯¹è±¡çš„å¼•ç”¨åœ°å€ã€‚å†è€…ï¼Œå¦‚æœå¯¹è±¡é‡Œæœ‰äº›æ•æ„Ÿå­—æ®µä¸æƒ³è¾“å‡ºåˆ°æ—¥å¿—é‡Œï¼Œåˆ™éœ€è¦é‡å†™ toString æ–¹æ³•ã€‚ä¸€ä¸ªå¯é€‰çš„æ–¹æ³•æ˜¯ï¼Œæ”¹ä¸ºæ‰“å°è¯·æ±‚å‚æ•°çš„ json åºåˆ—åŒ–å€¼ï¼Œè¿™æ ·åšåˆä¼šå¸¦æ¥åºåˆ—åŒ–å¼€é”€ã€‚\nå¦‚æœ controller å±‚ä»£ç è¢«ä»£ç†äº†å¤šæ¬¡ï¼Œåˆ™è¯·æ±‚å‚æ•°å’Œè¿”å›ç»“æœä¼šæ‰“å°å¤šæ¬¡ã€‚\nç”Ÿæ´» ç‰™ç–¼ ä¸€ä¸ªæœˆé»‘é£é«˜çš„æ™šä¸Šï¼ŒåŠ ç­å›æ¥çš„ç¨‹åºå‘˜å·å·å–äº†ä¸‰æ¯ç‰›å¥¶ï¼Œç»“æœç¬¬äºŒå¤©ç‰™é½¿å¼€å§‹ç–¼äº†ï¼Œç‰¹åˆ«æ˜¯åƒåˆ°å†·çƒ­é…¸ç”œçš„ä¸œè¥¿ï¼Œéƒ½ä¼šçŸ­æš‚çš„å·¨ç–¼ã€‚å»ç‰™ç§‘è¯Šæ‰€çœ‹äº†ï¼ŒåŒ»ç”Ÿè¯´è¦åšæ ¹ç®¡æ²»ç–—ï¼Œè´¹ç”¨ 800ï¼Œå¯ä»¥æŠ¥é”€ 420ï¼Œåšå®Œä»¥åï¼Œç‰™å¥—ä»·æ ¼å¦ç®—ï¼Œæœ‰ä¸€åƒåˆ°å‡ åƒçš„ä»·æ ¼ä¸ç­‰ã€‚åˆšä¸ä¹…è¿˜åˆ·åˆ°è§†é¢‘è¯´ï¼Œæœ‰ä¸¤ä¸ªçœè¦è§„èŒƒæ²»ç–—ç‰™é½¿è´¹ç”¨ã€‚\nå¿ç€ç–¼ç—›ä¸Šäº†ä¸€å‘¨ç­ï¼Œç»“æœä¸ä»…ç‰™ç—›ï¼Œåƒé¥­æ²¡èƒƒå£ï¼Œè¿˜å½±å“äº†ä¸Šç­ï¼ŒçœŸæ˜¯å¾—ä¸å¿å¤±ã€‚\nå‘¨å…­æ™šä¸Šï¼Œåœ¨ç‰™é½¿ç–¼ç—›çš„åœ°æ–¹ï¼Œæ’äº†ä¸€ç‚¹è€çˆ¸ç»™æˆ‘çš„è¯æ°´ã€‚ç¡è§‰æ—¶ï¼Œå…ˆæ˜¯ç•å†·ï¼Œå†å°±æ˜¯ç‰™ç–¼çš„åœ°æ–¹å‘ç‚ï¼Œè‚šå­å‘çƒ§ï¼Œçƒ§åˆ°äº†ä¸çŸ¥é“å¤šå°‘åº¦ï¼Œåæ­£æˆ‘æ˜¯æ²¡æœ‰æ‹¿æ¸©åº¦è®¡å»æµ‹é‡ã€‚çƒ§çš„æˆ‘å¤§è„‘éƒ½æ˜¯ç³Šçš„ï¼Œä¸€æ™šä¸Šæ²¡ç¡å¥½ï¼Œä¸­é€”è¿˜é†’äº†å‡ æ¬¡ã€‚å¥½åœ¨ç¬¬äºŒå¤©ï¼Œå°±å¥½äº†ä¸€äº›ï¼Œåƒä¸œè¥¿ä¹Ÿæ²¡é‚£ä¹ˆç–¼äº†ã€‚çœ‹æ¥ï¼Œä¸“å®¶é¡ºå‘çƒ§æ˜¯ä½“å†…ç»†èŒåœ¨å’Œç—…æ¯’åšæ–—äº‰ï¼Œåº”è¯¥æ˜¯å¯¹çš„å•°ã€‚\nç»å†äº†è¿™ä¸€æ™šä¸Šï¼Œæ„Ÿè§‰åƒæ˜¯ä½“éªŒäº†ä¸€æ¬¡é˜³çš„è¿‡ç¨‹ã€‚ä¹‹å‰æ–°å† é˜³äº†ï¼Œæˆ‘æ˜¯è½»ç—‡çŠ¶ï¼Œæ²¡æœ‰å‘çƒ§ã€‚è¿™æ¬¡ç‰™ç–¼å‘çƒ§ï¼Œç®—æ˜¯æŠŠä¹‹å‰æ–°å† æ²¡æœ‰åƒè¿‡çš„è‹¦æ‰¾è¡¥å›æ¥ï¼Œäººç”Ÿä¹Ÿç®—æ˜¯å¤šäº†ä¸€ç§ä½“éªŒã€‚\nå¨±ä¹ -ã€Šç‹‚é£™ã€‹ã€‚æœ€è¿‘å¾ˆç«ï¼Œä¹Ÿåˆšå¥½å®Œç»“äº†ã€‚æˆ‘æ²¡æœ‰å»çœ‹ï¼Œæ²¡æœ‰æ—¶é—´å»è¿½ï¼Œå°±çœ‹äº†å‰é¢å‡ é›†ã€‚\n-ã€Šç²‰çº¢ç†è®ºã€‹ã€‚è€å©†åœ¨è¿½çš„ä¸€éƒ¨æ³°å‰§ï¼Œå¥¹æ˜¯åœ¨å¾®åšçœ‹äº›åˆ«äººå‰ªè¾‘çš„å‡ åˆ†é’Ÿçš„ç‰‡æ®µã€‚å«æˆ‘ä¹Ÿå»å¾®åšçœ‹çœ‹ï¼Œæˆ‘è¯´æˆ‘ä¸ç”¨å¾®åšï¼Œæˆ‘ç¿»å¢™å»æ‰¾ç½‘ç«™è§‚çœ‹ã€‚è€å©†çœ¼ç›ä¸€äº®ï¼Œè¯´é‚£ä¸æ˜¯å¯ä»¥çœ‹åˆ°æ— åˆ å‡ç‰ˆæœ¬ï¼Œé‚£ä¸ªå…´å¥‹åŠ²å“Ÿï¼å¾ˆå¿«ï¼Œæˆ‘æ‰¾åˆ°äº†ç½‘ç«™ï¼Œå‘ç°å·²ç»ä¸Šçº¿äº† 11 é›†ï¼Œè€Œä¸”æ¯é›†éƒ½æœ‰ 60 å¤šåˆ†é’Ÿé•¿ï¼ˆè€å©†çœ‹çš„éƒ½æ˜¯é˜‰å‰²ç‰ˆï½ ğŸ˜¯ï¼‰ã€‚\nå­¦ä¹  æœ€è¿‘ Damus å¾ˆç«ï¼Œæˆ‘ä¹Ÿå»æ³¨å†Œäº†ä¸€ä¸ªè´¦å·ï¼Œä¸ºæ­¤è¿˜é‡æ–°ä¸‹è½½äº†ç‹ç‹¸ ğŸ¦Š é’±åŒ…ã€‚éšå³ï¼Œå¹²è„†ä¹Ÿæ³¨å†Œäº† Mastodon è´¦å·å’Œ Crossbell è´¦å·ã€‚\næˆ‘çš„ Damus è´¦å· npub1dav96pmjv58n60eqz7ctmhvsd7t2yljvzevf6uckmchz6zamx2wq0k7dm5\næˆ‘çš„ Mastodon è´¦å· @chensoul@mas.to\næˆ‘çš„ crossbell è´¦å· chensoul@crossbell\nå¥½ç‰©åˆ†äº« Mac åˆ é™¤åŸç”Ÿè‹±æ–‡ ABC ä»¥ä¸Šã€‚","title":"å‘¨æŠ¥-5ï½œé¡¹ç›®äº‹æ•…ã€ç‰™ç–¼ã€Damus"},{"content":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-01-23 åˆ° 2023-01-29 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¿‡å¹´ è¿™å‘¨å¤„äºè¿‡å¹´åƒå–æ‹œå¹´æ¨¡å¼ï¼Œé™¤äº†è…ŠæœˆäºŒåä¹å’Œæ­£æœˆåˆä¸€ï¼Œå…¶ä»–æ—¶é—´éƒ½æ˜¯å’Œè€å©†åœ¨è·¯ä¸Šã€‚å› ä¸ºæ˜¯ç»“å©šç¬¬ä¸€ä¸ªæ–°å¹´ï¼Œéœ€è¦å¸¦ç€è€å©†å»å„ä¸ªäº²æˆšå®¶æ‹œå¹´ã€‚å› ä¸ºæ˜¯ç¬¬ä¸€æ¬¡åœ¨æ–°æˆ¿è¿‡å¹´ï¼Œå°±æŠŠè€çˆ¸ä»å†œæ‘æ¥è¿‡æ¥ä¸€èµ·è¿‡å¹´ã€‚å› ä¸ºå¹´å‰æ²¡æœ‰æ¥å¾—åŠä¹°è½¦ï¼Œå»å“ªé‡Œéƒ½ä¸æ–¹ä¾¿ï¼Œéƒ½è¦éœ€è¦æ»´æ»´æ‰“è½¦ã€‚ä¸ºæ­¤ï¼Œæ‰“è½¦èŠ±äº†ä¸å°‘é’±ï¼Œå½“ç„¶ï¼Œç»™çº¢åŒ…ä¹Ÿç»™äº†ä¸å°‘é’±ã€‚è¶åˆä¸€ä¸ç”¨æ‹œå¹´çš„ç¼éš™æ—¶é—´ï¼Œå¸¦è€å©†å’Œè€çˆ¸å»çœ‹äº†ä¸¤åœºç”µå½±ã€Šæ— åã€‹å’Œã€Šäº¤æ¢äººç”Ÿã€‹ã€‚è€çˆ¸å¾ˆå°‘å»çœ‹ç”µå½±é™¢çœ‹ç”µå½±ï¼Œå¬åˆ°è¦å»çœ‹ç”µå½±ï¼Œåƒä¸ªå°å­©ä¼¼çš„ï¼Œé¥­è¿˜åƒå®Œï¼Œå°±è·‘å»ç”µæ¢¯é—¨å£ç­‰ç”µæ¢¯ã€‚è¿™ä¸¤åœºç”µå½±ï¼Œçœ‹çš„æˆ‘çŒç¡æ¥äº†ï¼Œå€’æ˜¯åˆäºŒæ™šä¸Šçœ‹ã€Šæ»¡æ±Ÿçº¢ã€‹ç¡æ„å…¨æ— ã€‚\næ€»ç»“ä¸‹æ¥ï¼Œè¿™ä¸ªå¹´è¿‡çš„ä¸è½»æ¾ï¼Œèº«ä½“å¿™ç¢Œï¼Œå¿ƒé‡Œå¹¸ç¦ ğŸ¥°ã€‚\nå‘ä¸Šç®¡ç† å¹´å‰ï¼Œéƒ¨é—¨é¢†å¯¼æ‰¾æˆ‘è°ˆ 2022 å¹´ç»©æ•ˆç»“æœæ—¶å€™ï¼Œæåˆ°æˆ‘å¯ä»¥ â€œå‘ä¸Šç®¡ç†â€ ä»–ã€‚æœ€è¿‘ä» æœå±¹ä¸œ çš„åšå®¢ è¿™ä¸€å¹´æˆ‘åœ¨é˜¿é‡Œå­¦åˆ°çš„ ä¹Ÿçœ‹åˆ°äº†ä»–åœ¨é˜¿é‡Œå·¥ä½œä¸€å¹´åæ‚Ÿåˆ°å¯¹å‘ä¸Šç®¡ç†çš„ç†è§£ã€‚\nåŠæ—¶å’Œè€æ¿è¡¨è¾¾æƒ³æ³• è®©è€æ¿çŸ¥é“ä½ åœ¨å¿™ä»€ä¹ˆ ä¸»åŠ¨å¸®è€æ¿åšä¸€äº›è„æ´»ç´¯æ´» å‰ä¸¤æ¡æ˜¯è€æ¿çŸ¥é“ä½ çš„æƒ³æ³•ï¼Œåé¢ä¸€æ¡æ˜¯å¸®è€æ¿è§£å†³é—®é¢˜ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥å¸®è€æ¿è§„é¿é£é™©ã€‚\næœ¬å‘¨å·¥ä½œ è¿™æ˜¯å¹´åçš„ç¬¬ä¸€å‘¨ï¼Œä¸»è¦æ˜¯å¤„ç†å¹´å‰æ²¡æœ‰å®Œæˆçš„é¡¹ç›®è¿­ä»£ã€‚\nFeign é›†æˆ Micometer OpenFeign å®˜æ–¹æä¾›äº† feign-micrometer æ¥æ”¯æŒ feign é›†æˆ micrometerã€‚\nGitHub github = Feign.builder() .addCapability(new MicrometerCapability()) .target(GitHub.class, \u0026#34;https://api.github.com\u0026#34;); å…¶æœ¬è´¨æ˜¯å¯¹ feign æ‹¦æˆªå™¨ã€clientã€encoderã€decoder è¿›è¡Œå°è£…ï¼Œæµ‹è¯•è¿‡ç¨‹ä¸­åœ¨æ²¡æœ‰è·å–åˆ°æŒ‡æ ‡ã€‚æ•…ï¼Œæ”¹ä¸ºä½¿ç”¨ z è‡ªå®šä¹‰æ‹¦æˆªå™¨å’Œ ErrorCoder æ¥è®°å½•è¯·æ±‚æ¬¡æ•°å’Œå¤±è´¥æ¬¡æ•°ã€‚\n@Bean public GitHub gihhub(MetricsInterceptor metricsInterceptor){ GitHub github = Feign.builder() .requestInterceptor(metricsInterceptor) .errorDecoder(new MetricsErrorDecoder()) .target(GitHub.class, \u0026#34;https://api.github.com\u0026#34;); } MetricsInterceptor ä»£ç å¦‚ä¸‹ï¼š\npublic class MetricsInterceptor implements RequestInterceptor, MeterBinder { private static MeterRegistry meterRegistry; public static final String FEIGN_REQUEST = \u0026#34;feign.requests\u0026#34;; public static final String FEIGN_REQUEST_ERROR = \u0026#34;feign.requests.error\u0026#34;; public MetricsInterceptor() { } public void apply(RequestTemplate template) { Micrometers.async(() -\u0026gt; { String methodKey = template.methodMetadata().configKey(); Counter counter = Counter.builder(\u0026#34;feign.requests\u0026#34;).tags(new String[]{\u0026#34;method\u0026#34;, StringUtils.substringBefore(methodKey, \u0026#34;(\u0026#34;)}).register(meterRegistry); counter.increment(); }); } public void bindTo(MeterRegistry registry) { meterRegistry = registry; } } MetricsErrorDecoder ä»£ç å¦‚ä¸‹ï¼š\npublic class MetricsErrorDecoder implements ErrorDecoder { private static final Logger log = LoggerFactory.getLogger(MetricsErrorDecoder.class); private static MeterRegistry registry = new SimpleMeterRegistry(); public MetricsErrorDecoder() { } protected void metrics(String methodKey) { Micrometers.async(() -\u0026gt; { Metrics.counter(\u0026#34;feign.requests.error\u0026#34;, new String[]{\u0026#34;method\u0026#34;, StringUtils.substringBefore(methodKey, \u0026#34;(\u0026#34;)}).increment(); }); } public Exception decode(String methodKey, Response response) { this.metrics(methodKey); FeignException exception = FeignException.errorStatus(methodKey, response); return exception; } static { Counter.builder(\u0026#34;feign.requests.error\u0026#34;).register(registry); } } Sentry é›†æˆé£ä¹¦é€šçŸ¥ å‚è€ƒ é€šè¿‡ Webhook å®ç° Sentry é”™è¯¯è‡ªåŠ¨åŒ–é£ä¹¦æœºå™¨äººæŠ¥è­¦ è¿™ç¯‡æ–‡ç« ï¼Œä½¿ç”¨ fastapi éƒ¨ç½²ä¸€ä¸ª http æœåŠ¡å°† sentry çš„å›è°ƒè½¬å‘åˆ°é£ä¹¦ç¾¤çš„æœºå™¨äººã€‚ç”±äºï¼Œfastapi éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šå®‰è£… python3ï¼Œä¸ºäº†ä¸æ±¡æŸ“æˆ‘çš„ vpsï¼Œæˆ‘åˆ›å»ºä¸€ä¸ª docker é•œåƒ sentry-feishu-hookï¼Œä¿®æ”¹äº† python è„šæœ¬ä¸­çš„ç¼–è¯‘é”™è¯¯ï¼Œå¹¶åœ¨ vps ä¸Šé€šè¿‡ docker å¯åŠ¨è¯¥æœåŠ¡ã€‚\nå…ˆç¼–è¯‘é•œåƒï¼Œå†è¿è¡Œï¼š\ndocker build -t sentry-feishu-hook . docker run -d --name sentry-feishu-hook -p 3080:3080 sentry-feishu-hook æ¥ä¸‹æ¥åœ¨ sentry é¡¹ç›®çš„ WebHooks é‡Œæ·»åŠ  http://ip:3080/hook\nç‚¹å‡» Test Pluginï¼Œé£ä¹¦ç¾¤ç»„å¯ä»¥æ”¶åˆ°æ¶ˆæ¯ï¼š\nå¥½ç‰©åˆ†äº« https://www.warp.dev/ï¼šä¸€ä¸ª Rust ç¼–å†™ï¼Œä½¿ç”¨ GPU æ¸²æŸ“çš„ç»ˆç«¯åº”ç”¨ã€‚ç›®æ ‡æ˜¯æå‡å¼€å‘è€…çš„æ•ˆç‡ã€‚ Restful API Mock å·¥å…·ï¼šJSONPlaceholder NetNewsWireã€‚Inoreader æœ€è¿‘æ€»æ˜¯æŠ½é£ï¼Œå°±æ”¹ä¸ºä½¿ç”¨ NetNewsWire äº†ã€‚ä½¿ç”¨èµ·æ¥ï¼Œè¿˜æ˜¯æ¯”è¾ƒé¡ºæ»‘ï¼Œé—æ†¾çš„æ˜¯æ²¡æœ‰å®‰å“ Appã€‚ Cuboxã€‚æœ€è¿‘çœ‹åˆ°è¿™ä¸ªæ”¶è—å·¥å…·ï¼Œä¸‹è½½äº†ä½¿ç”¨èµ·æ¥ã€‚ ä»¥ä¸Šã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/01/30/weekly_review_4/","summary":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-01-23 åˆ° 2023-01-29 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¿‡å¹´ è¿™å‘¨å¤„äºè¿‡å¹´åƒå–æ‹œå¹´æ¨¡å¼ï¼Œé™¤äº†è…ŠæœˆäºŒåä¹å’Œæ­£æœˆåˆä¸€ï¼Œå…¶ä»–æ—¶é—´éƒ½æ˜¯å’Œè€å©†åœ¨è·¯ä¸Šã€‚å› ä¸ºæ˜¯ç»“å©šç¬¬ä¸€ä¸ªæ–°å¹´ï¼Œéœ€è¦å¸¦ç€è€å©†å»å„ä¸ªäº²æˆšå®¶æ‹œå¹´ã€‚å› ä¸ºæ˜¯ç¬¬ä¸€æ¬¡åœ¨æ–°æˆ¿è¿‡å¹´ï¼Œå°±æŠŠè€çˆ¸ä»å†œæ‘æ¥è¿‡æ¥ä¸€èµ·è¿‡å¹´ã€‚å› ä¸ºå¹´å‰æ²¡æœ‰æ¥å¾—åŠä¹°è½¦ï¼Œå»å“ªé‡Œéƒ½ä¸æ–¹ä¾¿ï¼Œéƒ½è¦éœ€è¦æ»´æ»´æ‰“è½¦ã€‚ä¸ºæ­¤ï¼Œæ‰“è½¦èŠ±äº†ä¸å°‘é’±ï¼Œå½“ç„¶ï¼Œç»™çº¢åŒ…ä¹Ÿç»™äº†ä¸å°‘é’±ã€‚è¶åˆä¸€ä¸ç”¨æ‹œå¹´çš„ç¼éš™æ—¶é—´ï¼Œå¸¦è€å©†å’Œè€çˆ¸å»çœ‹äº†ä¸¤åœºç”µå½±ã€Šæ— åã€‹å’Œã€Šäº¤æ¢äººç”Ÿã€‹ã€‚è€çˆ¸å¾ˆå°‘å»çœ‹ç”µå½±é™¢çœ‹ç”µå½±ï¼Œå¬åˆ°è¦å»çœ‹ç”µå½±ï¼Œåƒä¸ªå°å­©ä¼¼çš„ï¼Œé¥­è¿˜åƒå®Œï¼Œå°±è·‘å»ç”µæ¢¯é—¨å£ç­‰ç”µæ¢¯ã€‚è¿™ä¸¤åœºç”µå½±ï¼Œçœ‹çš„æˆ‘çŒç¡æ¥äº†ï¼Œå€’æ˜¯åˆäºŒæ™šä¸Šçœ‹ã€Šæ»¡æ±Ÿçº¢ã€‹ç¡æ„å…¨æ— ã€‚\næ€»ç»“ä¸‹æ¥ï¼Œè¿™ä¸ªå¹´è¿‡çš„ä¸è½»æ¾ï¼Œèº«ä½“å¿™ç¢Œï¼Œå¿ƒé‡Œå¹¸ç¦ ğŸ¥°ã€‚\nå‘ä¸Šç®¡ç† å¹´å‰ï¼Œéƒ¨é—¨é¢†å¯¼æ‰¾æˆ‘è°ˆ 2022 å¹´ç»©æ•ˆç»“æœæ—¶å€™ï¼Œæåˆ°æˆ‘å¯ä»¥ â€œå‘ä¸Šç®¡ç†â€ ä»–ã€‚æœ€è¿‘ä» æœå±¹ä¸œ çš„åšå®¢ è¿™ä¸€å¹´æˆ‘åœ¨é˜¿é‡Œå­¦åˆ°çš„ ä¹Ÿçœ‹åˆ°äº†ä»–åœ¨é˜¿é‡Œå·¥ä½œä¸€å¹´åæ‚Ÿåˆ°å¯¹å‘ä¸Šç®¡ç†çš„ç†è§£ã€‚\nåŠæ—¶å’Œè€æ¿è¡¨è¾¾æƒ³æ³• è®©è€æ¿çŸ¥é“ä½ åœ¨å¿™ä»€ä¹ˆ ä¸»åŠ¨å¸®è€æ¿åšä¸€äº›è„æ´»ç´¯æ´» å‰ä¸¤æ¡æ˜¯è€æ¿çŸ¥é“ä½ çš„æƒ³æ³•ï¼Œåé¢ä¸€æ¡æ˜¯å¸®è€æ¿è§£å†³é—®é¢˜ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥å¸®è€æ¿è§„é¿é£é™©ã€‚\næœ¬å‘¨å·¥ä½œ è¿™æ˜¯å¹´åçš„ç¬¬ä¸€å‘¨ï¼Œä¸»è¦æ˜¯å¤„ç†å¹´å‰æ²¡æœ‰å®Œæˆçš„é¡¹ç›®è¿­ä»£ã€‚\nFeign é›†æˆ Micometer OpenFeign å®˜æ–¹æä¾›äº† feign-micrometer æ¥æ”¯æŒ feign é›†æˆ micrometerã€‚\nGitHub github = Feign.builder() .addCapability(new MicrometerCapability()) .target(GitHub.class, \u0026#34;https://api.github.com\u0026#34;); å…¶æœ¬è´¨æ˜¯å¯¹ feign æ‹¦æˆªå™¨ã€clientã€encoderã€decoder è¿›è¡Œå°è£…ï¼Œæµ‹è¯•è¿‡ç¨‹ä¸­åœ¨æ²¡æœ‰è·å–åˆ°æŒ‡æ ‡ã€‚æ•…ï¼Œæ”¹ä¸ºä½¿ç”¨ z è‡ªå®šä¹‰æ‹¦æˆªå™¨å’Œ ErrorCoder æ¥è®°å½•è¯·æ±‚æ¬¡æ•°å’Œå¤±è´¥æ¬¡æ•°ã€‚\n@Bean public GitHub gihhub(MetricsInterceptor metricsInterceptor){ GitHub github = Feign.builder() .requestInterceptor(metricsInterceptor) .errorDecoder(new MetricsErrorDecoder()) .target(GitHub.class, \u0026#34;https://api.github.com\u0026#34;); } MetricsInterceptor ä»£ç å¦‚ä¸‹ï¼š\npublic class MetricsInterceptor implements RequestInterceptor, MeterBinder { private static MeterRegistry meterRegistry; public static final String FEIGN_REQUEST = \u0026#34;feign.requests\u0026#34;; public static final String FEIGN_REQUEST_ERROR = \u0026#34;feign.requests.error\u0026#34;; public MetricsInterceptor() { } public void apply(RequestTemplate template) { Micrometers.","title":"å‘¨æŠ¥-4ï½œè¿‡å¹´ã€å‘ä¸Šç®¡ç†ã€å·¥ä½œå‘¨æ€»ç»“"},{"content":"æˆ‘çš„ VPS ä½¿ç”¨çš„æ˜¯ centos æœåŠ¡å™¨ï¼Œæ‰€ä»¥ä»¥ä¸‹æ“ä½œéƒ½æ˜¯åŸºäº centos ç³»ç»Ÿã€‚\næœåŠ¡å™¨è®¾ç½® æ›´æ–° yum æºï¼š\nyum update å®‰è£…å¸¸ç”¨è½¯ä»¶ï¼š\nyum install wget curl git vim -y è®¾ç½®æ—¶åŒºä¸º\n[å¯é€‰] è®¾ç½®ç³»ç»Ÿ Swap äº¤æ¢åˆ†åŒº\nå› ä¸º vps æœåŠ¡å™¨çš„è¿è¡Œå†…å­˜å¾ˆå°ï¼Œæ‰€ä»¥è¿™é‡Œå…ˆè®¾ç½®ä¸‹ Swap\n# 1GB RAM with 2GB Swap sudo fallocate -l 2G /swapfile \u0026amp;\u0026amp; \\ sudo dd if=/dev/zero of=/swapfile bs=1024 count=2097152 \u0026amp;\u0026amp; \\ sudo chmod 600 /swapfile \u0026amp;\u0026amp; \\ sudo mkswap /swapfile \u0026amp;\u0026amp; \\ sudo swapon /swapfile \u0026amp;\u0026amp; \\ echo \u0026#34;/swapfile swap swap defaults 0 0\u0026#34; | sudo tee -a /etc/fstab \u0026amp;\u0026amp; \\ sudo swapon --show \u0026amp;\u0026amp; \\ sudo free -h å®‰è£… Nginx å‚è€ƒ CentOS 7 ä¸‹ yum å®‰è£…å’Œé…ç½® Nginx ï¼Œä½¿ç”¨ yum å®‰è£…ï¼š\nrpm -ivh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm yum install nginx -y systemctl enable nginx æ‰“å¼€é˜²ç«å¢™ç«¯å£\nyum install firewalld -y firewall-cmd --zone=public --permanent --add-service=http firewall-cmd --reload ä½¿ç”¨åå‘ä»£ç†éœ€è¦æ‰“å¼€ç½‘ç»œè®¿é—®æƒé™\nsetsebool -P httpd_can_network_connect on å®‰è£…å¹¶ç”Ÿæˆè¯ä¹¦ åŸŸåæ‰˜ç®¡åœ¨ CloudFlareï¼Œå¯ä»¥å‚è€ƒ æ–‡ç« \ncurl https://get.acme.sh | sh -s email=ichensoul@gmail.com export CF_Key=\u0026#34;XXXXXXXXXXXXXXXXXX\u0026#34; export CF_Email=\u0026#34;ichensoul@gmail.com\u0026#34; .acme.sh/acme.sh --issue --server letsencrypt --dns dns_cf -d chensoul.cc -d \u0026#39;*.chensoul.cc\u0026#39; cp .acme.sh/chensoul.cc_ecc/{chensoul.cc.cer,chensoul.cc.key,fullchain.cer,ca.cer} /etc/nginx/ssl/ .acme.sh/acme.sh --installcert -d chensoul.cc -d *.chensoul.cc --cert-file /etc/nginx/ssl/chensoul.cc.cer --key-file /etc/nginx/ssl/chensoul.cc.key --fullchain-file /etc/nginx/ssl/fullchain.cer --ca-file /etc/nginx/ssl/ca.cer --reloadcmd \u0026#34;sudo nginx -s reload\u0026#34; Docker å®‰è£…å’Œé…ç½® Docker å®‰è£…\ncurl -fsSL https://get.docker.com -o get-docker.sh sh get-docker.sh å¯åŠ¨ dockerï¼š\nsystemctl enable docker systemctl start docker è®¾ç½® iptables å…è®¸æµé‡è½¬å‘ï¼š\niptables -P FORWARD ACCEPT å®‰è£… Compose\ncurl -L \u0026#34;https://github.com/docker/compose/releases/download/v2.23.3/docker-compose-$(uname -s)-$(uname -m)\u0026#34; -o /usr/local/bin/docker-compose è®¾ç½®æ‰§è¡Œæƒé™ï¼š\nchmod +x /usr/local/bin/docker-compose å‚è€ƒ Best Practice: Use a Docker network ï¼Œåˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ç½‘ç»œï¼š\ndocker network create custom æŸ¥çœ‹ docker ç½‘ç»œï¼š\ndocker network ls NETWORK ID NAME DRIVER SCOPE 68f4aeaa57bd bridge bridge local 6a96b9d8617e custom bridge local 4a8679e35f4d host host local ba21bef23b04 none null local æ³¨æ„ï¼šbridgeã€hostã€none æ˜¯å†…éƒ¨é¢„å…ˆåˆ›å»ºçš„ç½‘ç»œã€‚\nç„¶åï¼Œåœ¨å…¶ä»–æœåŠ¡çš„ docker-compose.yml æ–‡ä»¶æ·»åŠ ï¼š\nnetworks: - custom networks: custom: external: true æœåŠ¡éƒ¨ç½² MySQL 1ã€ä½¿ç”¨ docker-compose å®‰è£…\nmysql.yaml\nversion: \u0026#34;3\u0026#34; services: mysql: image: mysql:8 container_name: mysql platform: linux/amd64 restart: unless-stopped volumes: - /data/volumes/mysql/:/var/lib/mysql/ environment: - MYSQL_ROOT_HOST=% - MYSQL_ROOT_PASSWORD=admin@mysql! - TZ=Asia/Shanghai ports: - \u0026#34;3306:3306\u0026#34; command: --default-authentication-plugin=mysql_native_password --explicit_defaults_for_timestamp=true --lower_case_table_names=1 --tls-version=\u0026#39;\u0026#39; healthcheck: test: \u0026#34;/usr/bin/mysql -e \u0026#39;SHOW DATABASES;\u0026#39;\u0026#34; interval: 5s timeout: 2s retries: 10 networks: - custom networks: custom: external: true æ³¨æ„ï¼šä¿®æ”¹ Docker-MySQL å®¹å™¨çš„ é»˜è®¤ç”¨æˆ·åŠ å¯†è§„åˆ™\n2ã€å¯åŠ¨\ndocker-compose -f mysql.yaml up -d 3ã€è¿›å…¥å®¹å™¨ï¼š\ndocker exec -it mysql bash Rsshub ç›´æ¥é€šè¿‡ Docker å®‰è£…è¿è¡Œï¼š\ndocker run -d --name rsshub -p 1200:1200 diygod/rsshub é…ç½® nginx ï¼š\nserver { listen 80; listen [::]:80; server_name rsshub.chensoul.cc; return 301 https://$host$request_uri; } server { listen 443 ssl; server_name rsshub.chensoul.cc; ssl_certificate /etc/nginx/ssl/fullchain.cer; ssl_certificate_key /etc/nginx/ssl/chensoul.cc.key; ssl_session_cache shared:SSL:1m; ssl_session_timeout 5m; ssl_ciphers HIGH:!aNULL:!MD5; ssl_prefer_server_ciphers on; location / { proxy_pass http://127.0.0.1:1200; } } Uptime Kuma å‚è€ƒ kumaï¼Œä½¿ç”¨ docker compose éƒ¨ç½²ï¼Œåˆ›å»º uptime.yamlï¼š\nversion: \u0026#34;3.3\u0026#34; services: uptime-kuma: image: louislam/uptime-kuma:1 container_name: uptime-kuma volumes: - ~/.uptime-kuma:/app/data ports: - 3001:3001 # \u0026lt;Host Port\u0026gt;:\u0026lt;Container Port\u0026gt; restart: always å¯åŠ¨ï¼š\ndocker-compose -f uptime.yaml up -d é…ç½® nginx é…ç½®æ–‡ä»¶ /etc/nginx/conf.d/uptime.conf ï¼š\nserver { listen 80; listen [::]:80; server_name uptime.chensoul.cc; return 301 https://$host$request_uri; } server { listen 443 ssl; server_name uptime.chensoul.cc; ssl_certificate /etc/nginx/ssl/fullchain.cer; ssl_certificate_key /etc/nginx/ssl/chensoul.cc.key; ssl_session_cache shared:SSL:1m; ssl_session_timeout 5m; ssl_ciphers HIGH:!aNULL:!MD5; ssl_prefer_server_ciphers on; location / { proxy_pass http://127.0.0.1:3001; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header Host $host; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;upgrade\u0026#34;; } } å‡çº§\ndocker compose -f uptime.yaml down docker pull louislam/uptime-kuma:1 docker-compose -f uptime.yaml up -d Umami 1ã€åœ¨ mysql å®¹å™¨åˆ›å»º umami æ•°æ®åº“å’Œç”¨æˆ·ï¼š\ndocker exec -it mysql bash mysql -uroot -padmin@mysql! CREATE USER \u0026#39;umami\u0026#39;@\u0026#39;%\u0026#39; IDENTIFIED BY \u0026#39;umami@mysql!\u0026#39;; CREATE DATABASE umami; GRANT ALL ON umami.* TO \u0026#39;umami\u0026#39;@\u0026#39;%\u0026#39;; ALTER USER \u0026#39;umami\u0026#39; IDENTIFIED WITH caching_sha2_password BY \u0026#39;umami@mysql!\u0026#39;; å‚è€ƒï¼šHCL SafeLinx Server with MySQL 8.0 causes \u0026ldquo;Authentication plugin \u0026lsquo;caching_sha2_password\u0026rsquo; reported error: Authentication requires secure connection.\u0026rdquo;\n2ã€é€šè¿‡ docker-compose å®‰è£…ï¼Œåˆ›å»º umami.yamlï¼š\nversion: \u0026#34;3\u0026#34; services: umami: image: ghcr.io/umami-software/umami:mysql-latest container_name: umami ports: - \u0026#34;3000:3000\u0026#34; environment: DATABASE_URL: mysql://umami:umami@mysql!@mysql:3306/umami DATABASE_TYPE: mysql HASH_SALT: vps@2023 TRACKER_SCRIPT_NAME: random-string.js networks: - custom restart: always networks: custom: external: true å‚è€ƒ https://eallion.com/umami/ï¼ŒUmami çš„é»˜è®¤è·Ÿè¸ªä»£ç æ˜¯è¢«å¤§å¤šæ•°çš„å¹¿å‘Šæ’ä»¶å±è”½çš„ï¼Œè¢«å±è”½äº†ä½ å°±ç»Ÿè®¡ä¸åˆ°è®¿å®¢ä¿¡æ¯äº†ã€‚å¦‚æœéœ€è¦åå±è”½ï¼Œéœ€è¦åœ¨ docker-compose.yml æ–‡ä»¶ä¸­æ·»åŠ ç¯å¢ƒå˜é‡ï¼šTRACKER_SCRIPT_NAMEï¼Œå¦‚ï¼š\nenvironment: TRACKER_SCRIPT_NAME: random-string.js ç„¶åè·å–åˆ°çš„è·Ÿè¸ªä»£ç çš„ src ä¼šå˜æˆï¼š\nsrcipt.js =\u0026gt; random-string.js å¯åŠ¨ï¼š\ndocker-compose -f umami.yaml up -d 3ã€è®¾ç½®è‡ªå®šä¹‰åŸŸå\numami.chensoul.cc\n4ã€é…ç½® nginx é…ç½®æ–‡ä»¶ /etc/nginx/conf.d/umami.conf\nserver { listen 80; listen [::]:80; server_name umami.chensoul.cc; return 301 https://$host$request_uri; } server { listen 443 ssl; server_name umami.chensoul.cc; ssl_certificate /etc/nginx/ssl/fullchain.cer; ssl_certificate_key /etc/nginx/ssl/chensoul.cc.key; ssl_session_cache shared:SSL:1m; ssl_session_timeout 5m; ssl_ciphers HIGH:!aNULL:!MD5; ssl_prefer_server_ciphers on; location / { proxy_pass http://127.0.0.1:3000; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header REMOTE-HOST $remote_addr; add_header X-Cache $upstream_cache_status; # ç¼“å­˜ add_header Cache-Control no-cache; expires 12h; } } 5ã€æ·»åŠ ç½‘ç«™\nè®¿é—® https://umami.chensoul.cc/ï¼Œé»˜è®¤ç”¨æˆ·åå’Œå¯†ç ä¸º admin/umamiã€‚ç™»é™†ä¹‹åï¼Œä¿®æ”¹å¯†ç ï¼Œå¹¶æ·»åŠ ç½‘ç«™ã€‚\n6ã€å‡çº§\ndocker compose -f umami.yaml down docker pull ghcr.io/umami-software/umami:mysql-latest docker-compose -f umami.yaml up -d Cusdis VPS IP å¯èƒ½è¢«å¢™ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ä¸‰æ–¹äº‘æœåŠ¡éƒ¨ç½²ï¼Œå…·ä½“å‚è€ƒè½»é‡çº§å¼€æºå…è´¹åšå®¢è¯„è®ºç³»ç»Ÿè§£å†³æ–¹æ¡ˆ ï¼ˆCusdis + Railwayï¼‰\n1ã€åœ¨ mysql å®¹å™¨åˆ›å»º cusdis æ•°æ®åº“å’Œç”¨æˆ·ï¼š\ndocker exec -it mysql bash mysql -uroot -p CREATE USER \u0026#39;cusdis\u0026#39;@\u0026#39;%\u0026#39; IDENTIFIED BY \u0026#39;cusdis@mysql!\u0026#39;; CREATE DATABASE cusdis; GRANT ALL ON cusdis.* TO \u0026#39;cusdis\u0026#39;@\u0026#39;%\u0026#39;; ALTER USER \u0026#39;cusdis\u0026#39; IDENTIFIED WITH caching_sha2_password BY \u0026#39;cusdis@mysql!\u0026#39;; 2ã€é€šè¿‡ docker-compose å®‰è£…ï¼Œåˆ›å»º cusdis.yamlï¼š\nversion: \u0026#34;3\u0026#34; services: cusdis: image: djyde/cusdis:latest container_name: cusdis ports: - \u0026#34;3010:3000\u0026#34; environment: - USERNAME=admin - PASSWORD=cusdis - JWT_SECRET=vps@2023 - NEXTAUTH_URL=https://cusdis.chensoul.cc - HOST=https://cusdis.chensoul.cc - DB_TYPE=mysql - DB_URL=mysql://cusdis:cusdis@mysql!@mysql:3306/cusdis networks: - custom restart: always networks: custom: external: true ä»¥ä¸‹é…ç½®ä¸º EMAIL é…ç½®å¯é€‰ï¼Œä¸‹é¢æ˜¯ä½¿ç”¨ Gmail è¿›è¡Œé…ç½®ï¼Œéœ€è¦é¦–å…ˆå¼€å¯ä¸¤é˜¶æ®µéªŒè¯å¹¶åˆ›å»ºä¸€ä¸ªåº”ç”¨å¯†ç ï¼š\nSMTP_HOST=smtp.gmail.com SMTP_PORT=465 SMTP_SECURE=true SMTP_USER=your gmail email SMTP_PASSWORD=\u0026lt;app password\u0026gt; SMTP_SENDER=your gmail email 3ã€å¯åŠ¨\ndocker-compose -f cusdis.yaml up -d 4ã€é…ç½® nginx\nserver { listen 80; listen [::]:80; server_name cusdis.chensoul.cc; return 301 https://$host$request_uri; } server { listen 443 ssl; server_name cusdis.chensoul.cc; ssl_certificate /etc/nginx/ssl/fullchain.cer; ssl_certificate_key /etc/nginx/ssl/chensoul.cc.key; ssl_session_cache shared:SSL:1m; ssl_session_timeout 5m; ssl_ciphers HIGH:!aNULL:!MD5; ssl_prefer_server_ciphers on; location / { proxy_pass http://127.0.0.1:3010; proxy_pass_header Authorization; proxy_pass_header WWW-Authenticate; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; if ($uri = \u0026#39;/js/iframe.umd.js\u0026#39;) { add_header \u0026#39;Access-Control-Allow-Origin\u0026#39; \u0026#39;*\u0026#39;; #add_header \u0026#39;Access-Control-Allow-Origin\u0026#39; \u0026#39;http://localhost:1313\u0026#39;; } } } 5ã€éƒ¨ç½²ä¸€ä¸ª Telegram æœºå™¨äººï¼Œå‚è€ƒ Official Telegram botã€‚\n6ã€å‡çº§\ndocker compose -f cusdis.yaml down docker pull djyde/cusdis:latest docker-compose -f cusdis.yaml up -d memos 1ã€åœ¨ mysql å®¹å™¨åˆ›å»º n8n æ•°æ®åº“å’Œç”¨æˆ·ï¼š\ndocker exec -it mysql bash mysql -uroot -p CREATE USER \u0026#39;memos\u0026#39;@\u0026#39;%\u0026#39; IDENTIFIED BY \u0026#39;memos@mysql!\u0026#39;; CREATE DATABASE memos; GRANT ALL ON memos.* TO \u0026#39;memos\u0026#39;@\u0026#39;%\u0026#39;; ALTER USER \u0026#39;memos\u0026#39; IDENTIFIED WITH caching_sha2_password BY \u0026#39;memos@mysql!\u0026#39;; 2ã€é€šè¿‡ docker-compose å®‰è£…ï¼Œåˆ›å»º memos.yamlï¼š\nversion: \u0026#34;3.0\u0026#34; services: memos: image: neosmemo/memos:latest container_name: memos environment: - MEMOS_DRIVER=mysql - MEMOS_DSN=memos:memos@mysql!@tcp(mysql)/memos volumes: - ~/.memos/:/var/opt/memos ports: - 5230:5230 networks: - custom networks: custom: external: true å¯åŠ¨\ndocker-compose -f memos.yaml up -d é…ç½® nginx é…ç½®æ–‡ä»¶ /etc/nginx/conf.d/memos.conf\nserver { listen 80; listen [::]:80; server_name memos.chensoul.cc; return 301 https://$host$request_uri; } server { listen 443 ssl; server_name memos.chensoul.cc; ssl_certificate /etc/nginx/ssl/fullchain.cer; ssl_certificate_key /etc/nginx/ssl/chensoul.cc.key; ssl_session_cache shared:SSL:1m; ssl_session_timeout 5m; ssl_ciphers HIGH:!aNULL:!MD5; ssl_prefer_server_ciphers on; location / { proxy_pass http://127.0.0.1:5230; } } å‡çº§\ndocker compose -f memos.yaml down docker pull neosmemo/memos:latest docker-compose -f memos.yaml up -d n8n 1ã€åœ¨ mysql å®¹å™¨åˆ›å»º n8n æ•°æ®åº“å’Œç”¨æˆ·ï¼š\ndocker exec -it mysql bash mysql -uroot -p CREATE USER \u0026#39;n8n\u0026#39;@\u0026#39;%\u0026#39; IDENTIFIED BY \u0026#39;n8n@mysql!\u0026#39;; CREATE DATABASE n8n; GRANT ALL ON n8n.* TO \u0026#39;n8n\u0026#39;@\u0026#39;%\u0026#39;; ALTER USER \u0026#39;n8n\u0026#39; IDENTIFIED WITH caching_sha2_password BY \u0026#39;n8n@mysql!\u0026#39;; 2ã€é€šè¿‡ docker-compose å®‰è£…ï¼Œåˆ›å»º n8n.yamlï¼š\nversion: \u0026#34;3.8\u0026#34; services: n8n: image: n8nio/n8n container_name: n8n restart: always environment: - DB_TYPE=mysqldb - DB_MYSQLDB_HOST=mysql - DB_MYSQLDB_PORT=3306 - DB_MYSQLDB_DATABASE=n8n - DB_MYSQLDB_USER=n8n - DB_MYSQLDB_PASSWORD=n8n@mysql! - TZ=\u0026#34;Asia/Shanghai\u0026#34; - GENERIC_TIMEZONE=\u0026#34;Asia/Shanghai\u0026#34; - WEBHOOK_URL=https://n8n.chensoul.cc/ ports: - 5678:5678 volumes: - ~/.n8n:/home/node/.n8n networks: - custom networks: custom: external: true 3ã€å¯åŠ¨\ndocker-compose -f n8n.yaml up -d 4ã€é…ç½® nginx é…ç½®æ–‡ä»¶ /etc/nginx/conf.d/n8n.conf\nserver { listen 80; listen [::]:80; server_name n8n.chensoul.cc; return 301 https://$host$request_uri; } server { listen 443 ssl; server_name n8n.chensoul.cc; ssl_certificate /etc/nginx/ssl/fullchain.cer; ssl_certificate_key /etc/nginx/ssl/chensoul.cc.key; ssl_session_cache shared:SSL:1m; ssl_session_timeout 5m; ssl_ciphers HIGH:!aNULL:!MD5; ssl_prefer_server_ciphers on; location / { proxy_pass http://127.0.0.1:5678; chunked_transfer_encoding off; proxy_buffering off; proxy_cache off; access_log /var/log/nginx/n8n.log combined buffer=128k flush=5s; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \u0026#34;Upgrade\u0026#34;; } } è¿™é‡Œé¢çš„è½¬å‘é…ç½®ä¸å¯¹çš„è¯ï¼Œä¼šå¯¼è‡´ç›´æ¥è®¿é—® 5678 ç«¯å£æ­£å¸¸ï¼Œä½†æ˜¯è®¿é—® nginx çš„è¯ï¼Œworkflow ä¼šä¸€ç›´å¤„äºæ‰§è¡Œã€‚\n5ã€æ·»åŠ  workflow\nå‚è€ƒè¿™ç¯‡æ–‡ç«  http://stiles.cc/archives/237/ ï¼Œç›®å‰æˆ‘é…ç½®äº†ä»¥ä¸‹ workflowsï¼Œå®ç°äº† githubã€doubanã€rssã€memos åŒæ­¥åˆ° Telegramã€‚\nworkflows å‚è€ƒï¼š\nReorx Pseudoyu raye Zeabur 6ã€å‡çº§\ndocker compose -f n8n.yaml down docker pull n8nio/n8n docker-compose -f n8n.yaml up -d 7ã€å¤‡ä»½\nå®‰è£… jq\nyum install epel-release -y yum install jq -y #!/bin/bash DATE=$(date +%Y%m%d_%H%M%S) BACKUP_DIR=\u0026#34;/opt/backup/n8n\u0026#34; mkdir -p $BACKUP_DIR EXPORT_DIR=\u0026#34;workflow-${DATE}\u0026#34; docker exec -u node -it n8n n8n export:workflow --backup --output=./$EXPORT_DIR/ docker cp n8n:/home/node/$EXPORT_DIR ${BACKUP_DIR}/$EXPORT_DIR #docker exec -u node -it n8n n8n export:credentials --all --output=./credentials.json #docker cp n8n:/home/node/credentials.json . cd $BACKUP_DIR/$EXPORT_DIR for file in *; do filename=$(cat \u0026#34;$file\u0026#34; | jq -r \u0026#39;.name\u0026#39;) # ä½¿ç”¨-ré€‰é¡¹ä»¥çº¯æ–‡æœ¬å½¢å¼è¾“å‡ºå­—æ®µå€¼ echo \u0026#34;$filename\u0026#34; mv \u0026#34;$file\u0026#34; \u0026#34;$filename\u0026#34;.json done æ•°æ®åº“å¤‡ä»½ #!/bin/bash # å®¹å™¨åç§° CONTAINER_NAME=\u0026#34;mysql\u0026#34; # å¤‡ä»½ç›®å½• BACKUP_DIR=\u0026#34;/opt/backup/mysql\u0026#34; # æ—¥æœŸæ—¶é—´ DATE=$(date +%Y%m%d_%H%M%S) # å¤‡ä»½æ–‡ä»¶ååç¼€ BACKUP_POSTFIX=\u0026#34;backup_${DATE}\u0026#34; # MySQLè¿æ¥å‚æ•° DB_USER=\u0026#34;root\u0026#34; DB_PASSWORD=\u0026#34;admin@mysql!\u0026#34; # è¦å¤‡ä»½çš„æ•°æ®åº“åˆ—è¡¨ DATABASES=(\u0026#34;memos\u0026#34; \u0026#34;n8n\u0026#34; \u0026#34;umami\u0026#34;) # åˆ›å»ºå¤‡ä»½ç›®å½• mkdir -p $BACKUP_DIR # éå†æ•°æ®åº“åˆ—è¡¨è¿›è¡Œå¤‡ä»½ for DB_NAME in \u0026#34;${DATABASES[@]}\u0026#34; do # å¤‡ä»½æ–‡ä»¶å BACKUP_FILE=\u0026#34;${DB_NAME}_${BACKUP_POSTFIX}.sql\u0026#34; # æ‰§è¡Œå¤‡ä»½ docker exec $CONTAINER_NAME mysqldump -u $DB_USER --password=$DB_PASSWORD $DB_NAME \u0026gt; $BACKUP_DIR/$BACKUP_FILE # æ£€æŸ¥å¤‡ä»½æ˜¯å¦æˆåŠŸ if [ $? -eq 0 ]; then echo \u0026#34;æ•°æ®åº“ $DB_NAME å¤‡ä»½æˆåŠŸ: $BACKUP_FILE\u0026#34; else echo \u0026#34;æ•°æ®åº“ $DB_NAME å¤‡ä»½å¤±è´¥\u0026#34; fi done ","permalink":"https://blog.chensoul.cc/posts/2023/01/25/notes-about-deploy-services-in-vps/","summary":"æˆ‘çš„ VPS ä½¿ç”¨çš„æ˜¯ centos æœåŠ¡å™¨ï¼Œæ‰€ä»¥ä»¥ä¸‹æ“ä½œéƒ½æ˜¯åŸºäº centos ç³»ç»Ÿã€‚\næœåŠ¡å™¨è®¾ç½® æ›´æ–° yum æºï¼š\nyum update å®‰è£…å¸¸ç”¨è½¯ä»¶ï¼š\nyum install wget curl git vim -y è®¾ç½®æ—¶åŒºä¸º\n[å¯é€‰] è®¾ç½®ç³»ç»Ÿ Swap äº¤æ¢åˆ†åŒº\nå› ä¸º vps æœåŠ¡å™¨çš„è¿è¡Œå†…å­˜å¾ˆå°ï¼Œæ‰€ä»¥è¿™é‡Œå…ˆè®¾ç½®ä¸‹ Swap\n# 1GB RAM with 2GB Swap sudo fallocate -l 2G /swapfile \u0026amp;\u0026amp; \\ sudo dd if=/dev/zero of=/swapfile bs=1024 count=2097152 \u0026amp;\u0026amp; \\ sudo chmod 600 /swapfile \u0026amp;\u0026amp; \\ sudo mkswap /swapfile \u0026amp;\u0026amp; \\ sudo swapon /swapfile \u0026amp;\u0026amp; \\ echo \u0026#34;/swapfile swap swap defaults 0 0\u0026#34; | sudo tee -a /etc/fstab \u0026amp;\u0026amp; \\ sudo swapon --show \u0026amp;\u0026amp; \\ sudo free -h å®‰è£… Nginx å‚è€ƒ CentOS 7 ä¸‹ yum å®‰è£…å’Œé…ç½® Nginx ï¼Œä½¿ç”¨ yum å®‰è£…ï¼š","title":"æˆ‘çš„VPSæœåŠ¡éƒ¨ç½²è®°å½•"},{"content":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-01-16 åˆ° 2023-01-22 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¿™æ˜¯è¿‡å¹´å‰çš„æœ€åä¸€å‘¨ï¼Œä¸Šäº†ä¸‰å¤©ç­ï¼Œè¯·äº†ä¸¤å¤©å‡å›å»å‡†å¤‡å¹´è´§ã€å»äº²æˆšå®¶åƒå¹´é¥­ã€‚è¶æ”¾å‡ä¹‹å‰ï¼Œç»§ç»­å¯¹åšå®¢åšäº†ä¸€äº›å®šåˆ¶ï¼Œä¹Ÿåœ¨æˆ‘çš„ VPS ä¸Šé€šè¿‡ Docker éƒ¨ç½²äº†ä¸€äº›æœåŠ¡ã€‚\nå®šåˆ¶åšå®¢ åŸºäº pseudoyu çš„åšå®¢å’Œä¸»é¢˜å®šåˆ¶åšå®¢ï¼Œå‘ç°å¹¶ä¿®å¤äº† bugï¼Œè¿˜åšäº†ä¸€äº›æ”¹è¿›ï¼Œå¹¶åœ¨ä»–çš„ github æäº¤ issue å’Œ merge requestã€‚\næ¥ç€åœ¨ä»–åšå®¢ä¸»é¡µç•™è¨€ï¼Œå‡ ä¸ªæ¥å›ä¸‹æ¥ï¼Œæ”¶è·ä¸å°‘ã€‚ä¸€æ˜¯è§£å†³äº†æˆ‘æå‡ºçš„é—®é¢˜ï¼ŒäºŒæ˜¯ç»™æˆ‘åˆ†äº«äº†ä¸€ä¸ªæ¬ç“¦å·¥çš„ the plan ä¼˜æƒ ç ã€‚è¿™æ—¶å€™å»çœ‹äº†ä¸‹æˆ‘åŸæ¥çš„ vps åˆšå¥½è¿˜æœ‰ä¸€å¤©è¦åˆ°æœŸï¼Œå°±ç«‹å³èŠ±äº† 92 ç¾å…ƒï¼ˆåŸä»·æ˜¯ 99 ç¾å…ƒï¼‰è´­ä¹°äº†ä¸€å° 2G å†…å­˜æ‰˜ç®¡åœ¨é¦™æ¸¯çš„æœåŠ¡å™¨ã€‚\nç¼˜åˆ†å°±æ˜¯è¿™ä¹ˆå¥‡å¦™ï¼Œå¦‚æœæˆ‘ä¸ä¸»åŠ¨å’Œè¿™ä¸ªåšä¸»è”ç³»ï¼Œå°±ä¸ä¼šçŸ¥é“æ¬ç“¦å·¥è¿˜æœ‰è¿™ä¸ªä¼˜æƒ ï¼Œå°±ä¸ä¼šå¸®åŠ©æˆ‘è§£å†³äº†åšå®¢å®šåˆ¶è¿‡ç¨‹ä¸­é‡åˆ°çš„ç–‘æƒ‘ã€‚\nå½“ä½ æƒ³è¦ä»€çš„æ—¶å€™ï¼Œå…ˆç»™å‡ºå»ï¼Œä½ å°±ä¼šæ”¶è·æ›´ã€‚æœ‰èˆæ‰æœ‰å¾—ã€‚\nåšå®¢ä¸ªäººä»‹ç» æˆ‘çš„åšå®¢æºæ–‡ä»¶æ‰˜ç®¡åœ¨ gihubï¼Œåœ¨è¿™ä¸ªä»“åº“å¯ä»¥çœ‹åˆ°æˆ‘çš„ä¸€äº›ä¸ªäººä»‹ç»ã€‚\nvps ä¸ŠæœåŠ¡éƒ¨ç½² è´­ä¹°äº†æ–°çš„ VPS ä¹‹åï¼Œå°±å°†åŸæ¥çš„ VPS å¯¼å‡ºé•œåƒï¼Œç„¶åå¯¼å…¥åˆ°æ–°çš„ VPSï¼Œæœ€åå†å®‰è£…äº†ä»¥ä¸‹æœåŠ¡ï¼š\nflowerss-botï¼šä¸€ä¸ªæ”¯æŒåº”ç”¨å†…é˜…è¯»çš„ Telegram RSS Botã€‚ n8nï¼šä¸€æ¬¾å¼€æºçš„è‡ªåŠ¨å·¥ä½œæµæœåŠ¡ï¼Œç±»ä¼¼ IFTTTã€Zapierï¼Œå¯ä»¥äº’è”äº’é€šåŒ…æ‹¬ GitHubã€Dropboxã€Googleã€NextCLoudã€RSSã€Slackã€Telegram åœ¨å†…çš„å‡ åæ¬¾åœ¨çº¿æœåŠ¡ã€‚ memosï¼šä¸€ä¸ªå¼€æºä¸”å…è´¹çš„è‡ªæ‰˜ç®¡çŸ¥è¯†åº“ cusdisï¼šä¸€ä¸ªç•Œé¢æ¸…çˆ½ã€æ³¨é‡éšç§çš„è½»é‡çº§ (~5kb gzip) è¯„è®ºç³»ç»Ÿï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä¸ Reactã€Vue æˆ–å…¶ä»–åšå®¢ç³»ç»Ÿç»“åˆï¼Œå¹¶ä¸”è¿˜æä¾›äº†ä¸€ä¸ªåå°æ¥ç®¡ç†æ‰€æœ‰çš„è¯„è®º umamiï¼šä¸€ä¸ªç®€å•æ˜“ç”¨ã€è‡ªæ‰˜ç®¡çš„å¼€æºç½‘ç«™è®¿é—®æµé‡ç»Ÿè®¡åˆ†æå·¥å…· pgsql uptime-kumaï¼šä¸€ä¸ªå¼€æºå…è´¹çš„ç›‘æ§å·¥å…· rsshubï¼šä¸€ä¸ªå¼€æºã€ç®€å•æ˜“ç”¨ã€æ˜“äºæ‰©å±•çš„ RSS ç”Ÿæˆå™¨ï¼Œå¯ä»¥ç»™ä»»ä½•å¥‡å¥‡æ€ªæ€ªçš„å†…å®¹ç”Ÿæˆ RSS è®¢é˜…æº é€šè¿‡ Docker éƒ¨ç½²è¿™äº›æœåŠ¡éå¸¸ç®€å•ï¼Œä¸»è¦æ˜¯éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼šå°†è¿™äº›æœåŠ¡éƒ¨ç½²åˆ°åŒä¸€ä¸ªç½‘è·¯ï¼Œè¿™æ ·å„ä¸ªæœåŠ¡ä¹‹é—´å¯ä»¥äº’ç›¸é€šä¿¡ã€‚æ¯”å¦‚ï¼šå¾ˆå¤šæœåŠ¡éƒ½éœ€è¦ä¾èµ–æ•°æ®åº“ postgresqlï¼Œå¯ä»¥ä½¿ç”¨ docker-compose æ¥ç¼–æ’æœåŠ¡ã€‚å®‰è£…éƒ¨ç½²è¿‡ç¨‹å‚è€ƒï¼šæˆ‘çš„ VPS æœåŠ¡éƒ¨ç½²è®°å½•\nä»¥ä¸Šã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/01/25/weekly_review_3/","summary":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-01-16 åˆ° 2023-01-22 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¿™æ˜¯è¿‡å¹´å‰çš„æœ€åä¸€å‘¨ï¼Œä¸Šäº†ä¸‰å¤©ç­ï¼Œè¯·äº†ä¸¤å¤©å‡å›å»å‡†å¤‡å¹´è´§ã€å»äº²æˆšå®¶åƒå¹´é¥­ã€‚è¶æ”¾å‡ä¹‹å‰ï¼Œç»§ç»­å¯¹åšå®¢åšäº†ä¸€äº›å®šåˆ¶ï¼Œä¹Ÿåœ¨æˆ‘çš„ VPS ä¸Šé€šè¿‡ Docker éƒ¨ç½²äº†ä¸€äº›æœåŠ¡ã€‚\nå®šåˆ¶åšå®¢ åŸºäº pseudoyu çš„åšå®¢å’Œä¸»é¢˜å®šåˆ¶åšå®¢ï¼Œå‘ç°å¹¶ä¿®å¤äº† bugï¼Œè¿˜åšäº†ä¸€äº›æ”¹è¿›ï¼Œå¹¶åœ¨ä»–çš„ github æäº¤ issue å’Œ merge requestã€‚\næ¥ç€åœ¨ä»–åšå®¢ä¸»é¡µç•™è¨€ï¼Œå‡ ä¸ªæ¥å›ä¸‹æ¥ï¼Œæ”¶è·ä¸å°‘ã€‚ä¸€æ˜¯è§£å†³äº†æˆ‘æå‡ºçš„é—®é¢˜ï¼ŒäºŒæ˜¯ç»™æˆ‘åˆ†äº«äº†ä¸€ä¸ªæ¬ç“¦å·¥çš„ the plan ä¼˜æƒ ç ã€‚è¿™æ—¶å€™å»çœ‹äº†ä¸‹æˆ‘åŸæ¥çš„ vps åˆšå¥½è¿˜æœ‰ä¸€å¤©è¦åˆ°æœŸï¼Œå°±ç«‹å³èŠ±äº† 92 ç¾å…ƒï¼ˆåŸä»·æ˜¯ 99 ç¾å…ƒï¼‰è´­ä¹°äº†ä¸€å° 2G å†…å­˜æ‰˜ç®¡åœ¨é¦™æ¸¯çš„æœåŠ¡å™¨ã€‚\nç¼˜åˆ†å°±æ˜¯è¿™ä¹ˆå¥‡å¦™ï¼Œå¦‚æœæˆ‘ä¸ä¸»åŠ¨å’Œè¿™ä¸ªåšä¸»è”ç³»ï¼Œå°±ä¸ä¼šçŸ¥é“æ¬ç“¦å·¥è¿˜æœ‰è¿™ä¸ªä¼˜æƒ ï¼Œå°±ä¸ä¼šå¸®åŠ©æˆ‘è§£å†³äº†åšå®¢å®šåˆ¶è¿‡ç¨‹ä¸­é‡åˆ°çš„ç–‘æƒ‘ã€‚\nå½“ä½ æƒ³è¦ä»€çš„æ—¶å€™ï¼Œå…ˆç»™å‡ºå»ï¼Œä½ å°±ä¼šæ”¶è·æ›´ã€‚æœ‰èˆæ‰æœ‰å¾—ã€‚\nåšå®¢ä¸ªäººä»‹ç» æˆ‘çš„åšå®¢æºæ–‡ä»¶æ‰˜ç®¡åœ¨ gihubï¼Œåœ¨è¿™ä¸ªä»“åº“å¯ä»¥çœ‹åˆ°æˆ‘çš„ä¸€äº›ä¸ªäººä»‹ç»ã€‚\nvps ä¸ŠæœåŠ¡éƒ¨ç½² è´­ä¹°äº†æ–°çš„ VPS ä¹‹åï¼Œå°±å°†åŸæ¥çš„ VPS å¯¼å‡ºé•œåƒï¼Œç„¶åå¯¼å…¥åˆ°æ–°çš„ VPSï¼Œæœ€åå†å®‰è£…äº†ä»¥ä¸‹æœåŠ¡ï¼š\nflowerss-botï¼šä¸€ä¸ªæ”¯æŒåº”ç”¨å†…é˜…è¯»çš„ Telegram RSS Botã€‚ n8nï¼šä¸€æ¬¾å¼€æºçš„è‡ªåŠ¨å·¥ä½œæµæœåŠ¡ï¼Œç±»ä¼¼ IFTTTã€Zapierï¼Œå¯ä»¥äº’è”äº’é€šåŒ…æ‹¬ GitHubã€Dropboxã€Googleã€NextCLoudã€RSSã€Slackã€Telegram åœ¨å†…çš„å‡ åæ¬¾åœ¨çº¿æœåŠ¡ã€‚ memosï¼šä¸€ä¸ªå¼€æºä¸”å…è´¹çš„è‡ªæ‰˜ç®¡çŸ¥è¯†åº“ cusdisï¼šä¸€ä¸ªç•Œé¢æ¸…çˆ½ã€æ³¨é‡éšç§çš„è½»é‡çº§ (~5kb gzip) è¯„è®ºç³»ç»Ÿï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä¸ Reactã€Vue æˆ–å…¶ä»–åšå®¢ç³»ç»Ÿç»“åˆï¼Œå¹¶ä¸”è¿˜æä¾›äº†ä¸€ä¸ªåå°æ¥ç®¡ç†æ‰€æœ‰çš„è¯„è®º umamiï¼šä¸€ä¸ªç®€å•æ˜“ç”¨ã€è‡ªæ‰˜ç®¡çš„å¼€æºç½‘ç«™è®¿é—®æµé‡ç»Ÿè®¡åˆ†æå·¥å…· pgsql uptime-kumaï¼šä¸€ä¸ªå¼€æºå…è´¹çš„ç›‘æ§å·¥å…· rsshubï¼šä¸€ä¸ªå¼€æºã€ç®€å•æ˜“ç”¨ã€æ˜“äºæ‰©å±•çš„ RSS ç”Ÿæˆå™¨ï¼Œå¯ä»¥ç»™ä»»ä½•å¥‡å¥‡æ€ªæ€ªçš„å†…å®¹ç”Ÿæˆ RSS è®¢é˜…æº é€šè¿‡ Docker éƒ¨ç½²è¿™äº›æœåŠ¡éå¸¸ç®€å•ï¼Œä¸»è¦æ˜¯éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼šå°†è¿™äº›æœåŠ¡éƒ¨ç½²åˆ°åŒä¸€ä¸ªç½‘è·¯ï¼Œè¿™æ ·å„ä¸ªæœåŠ¡ä¹‹é—´å¯ä»¥äº’ç›¸é€šä¿¡ã€‚æ¯”å¦‚ï¼šå¾ˆå¤šæœåŠ¡éƒ½éœ€è¦ä¾èµ–æ•°æ®åº“ postgresqlï¼Œå¯ä»¥ä½¿ç”¨ docker-compose æ¥ç¼–æ’æœåŠ¡ã€‚å®‰è£…éƒ¨ç½²è¿‡ç¨‹å‚è€ƒï¼šæˆ‘çš„ VPS æœåŠ¡éƒ¨ç½²è®°å½•\nä»¥ä¸Šã€‚","title":"å‘¨æŠ¥-3ï½œåšå®¢å®šåˆ¶ã€VPSéƒ¨ç½²æœåŠ¡"},{"content":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-01-09 åˆ° 2023-01-15 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¿™æ˜¯å¹´å‰å€’æ•°ç¬¬äºŒä¸ªå·¥ä½œå‘¨ï¼Œå·¥ä½œä¸Šä¸»è¦æ˜¯å®Œæˆé¡¹ç›®ä¸€ä¸ªç‰ˆæœ¬çš„æµ‹è¯•å’Œå‘å¸ƒã€‚è¿™ä¸ªåšå®¢ä¸»è¦æ˜¯åˆ†äº«ä¸€äº›æŠ€æœ¯ç›¸å…³ç¬”è®°å’Œä¸ªäººçš„ç”Ÿæ´»è®°å½•ä¸æ€è€ƒï¼Œæ‰€ä»¥ä¸ä¼šæ¶‰åŠå…·ä½“çš„å·¥ä½œå†…å®¹ã€‚\nå‘¨ä¸‰æ™šä¸Šæ˜¯éƒ¨é—¨å¹´ä¼šï¼Œé¢†å¯¼æå‡ºäº† 2023 å¹´æ”¶å…¥ 6.2 äº¿çš„ç›®æ ‡ï¼Œæ¯” 2022 å¹´æ”¶å…¥å¢é•¿ 140%ã€‚ä»å…¬å¸é¢†å¯¼å±‚è¿™ä¹è§‚çš„å¹´åº¦è§„åˆ’ï¼Œçœ‹å¾—å‡ºæ¥å…¬å¸çš„å‘å±•å±äºä¸Šå‡è¶‹åŠ¿ï¼ŒåŒæ—¶æ„å‘³ç€ 2023 å¹´åˆæ˜¯å¿™ç¢Œå’Œå‹åŠ›å·¨å¤§çš„ä¸€å¹´ã€‚\nå·¥ä½œé—²æš‡ä¹‹ä½™ï¼Œçœ‹åˆ°äº†ä¸€äº›ç‹¬ç«‹å¼€å‘è€…çš„åšå®¢ï¼Œå¹¶å—ä»–ä»¬åšå®¢æ–‡ç« çš„å½±å“ï¼Œç«‹å³å†³å®šé‡æ–°æ£é¼“åšå®¢ã€‚äºæ˜¯ï¼Œåœ¨ä¸€è…”çƒ­æƒ…ä¹‹ä¸‹ï¼ŒèŠ±äº†ä¸‰å¤©æ—¶é—´é‡æ„äº†åšå®¢ï¼Œä¹Ÿå¯¹åšå®¢ä»¥åçš„æ–¹å‘åšäº†ä¸€äº›è§„åˆ’ã€‚\nå‘¨æœ«æ˜¯è¿‡å°å¹´ï¼Œå°å¹´ä¼Šå§‹ï¼Œå¹´å‘³æ¸æµ“ã€‚å‘¨å…­æ™šä¸Šï¼Œå ‚å“¥å®¶åƒå¹´é¥­ã€‚å‘¨æ—¥ä¸­åˆï¼Œè‡ªå·±å®¶åƒå¹´é¥­ã€‚è¿™æ˜¯æ–°å©šåç¬¬ä¸€æ¬¡ä¸¤è¾¹çš„å®¶äººä¸€èµ·åƒå¹´é¥­ã€‚è™½ç„¶å¾ˆæ—©å°±ç¡®å®šäº†å¹´é¥­æ—¶é—´å¤§å®¶éƒ½æœ‰æ—¶é—´çš„å‘¨æœ«ã€é¢„å®šäº†å¯ä»¥åä¸‹ 20 å¤šäººçš„å¤§æ¡Œï¼Œä½†è¿˜æ˜¯é—æ†¾äººæ²¡æœ‰åˆ°é½ã€‚\nåšå®¢é‡æ„ åšå®¢ä¸»é¢˜ ä»¥å‰çš„åšå®¢ä¸»è¦æ˜¯çº¯ç²¹åˆ†äº«æŠ€æœ¯ï¼Œå¾ˆå°‘æœ‰è‡ªå·±çš„æ€è€ƒï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯ä»£ç æ¯”æ±‰å­—è¦å¤šä¸å°‘ã€‚åšå®¢æ²¡æœ‰åšä¸»çš„æ€è€ƒï¼Œæ— æ³•è®©è¯»è€…è®¤è¯†ã€äº†è§£åšä¸»ï¼Œå¹¶å’Œåšä¸»äº§ç”Ÿæ·±å…¥çš„é“¾æ¥ã€‚è¿™æ ·çš„åšå®¢æ²¡æœ‰çµé­‚ï¼Œå°±ä»…ä»…æ˜¯ä¸€ä¸ªçº¯åˆ†äº«çš„ wikiã€‚\nè¿™æ¬¡é‡æ–°å¼€å§‹å†™åšå®¢ä¹‹åï¼Œè§„åˆ’çš„åšå®¢ä¸»é¢˜æ˜¯åˆ†äº«æŠ€æœ¯ã€è®°å½•ç”Ÿæ´»ã€å¯å‘æ€è€ƒã€‚æŠ€æœ¯ä¸Šçš„æ–‡ç« ï¼Œè¦æœ‰æ·±åº¦ï¼›ç”Ÿæ´»çš„ç‚¹æ»´ï¼Œè¦æœ‰å¤ç›˜ï¼›æ€è€ƒçš„å†…å®¹ï¼Œè¦æœ‰å…±é¸£ã€‚\nåšå®¢è§„åˆ’ ä»¥å‰åšå®¢æ–‡ç« çš„åˆ†ç±»æœ‰ javaã€databaseã€devopsã€webï¼Œåœ¨åˆ äº†ä¸€äº›æ–‡ç« ä¹‹åï¼Œå°†åšå®¢çš„åˆ†ç±»è°ƒæ•´ä¸ºæƒ³æ³•ï¼ˆIdeasï¼‰ã€ç¬”è®°ï¼ˆNotesï¼‰ä¸¤ç±»ï¼Œåé¢å†æ ¹æ®å®é™…æƒ…å†µæ·»åŠ æˆ–è€…è°ƒæ•´åˆ†ç±»ã€‚\nå¥åº·ï¼Œçˆ±æƒ…å’Œä½¿å‘½ï¼ŒæŒ‰ç…§è¿™ä¸ªé¡ºåºï¼Œå…¶å®ƒçš„éƒ½ä¸é‡è¦\næ–‡ç« é“¾æ¥ ä»¥å‰çš„åšå®¢é“¾æ¥æ ¼å¼æ˜¯ posts/:slugï¼Œç°åœ¨è°ƒæ•´ä¸º posts/:year/:month/:day/:slugã€‚å› ä¸ºç°åœ¨åšå®¢åªæœ‰å‡ ç¯‡æ–‡ç« ï¼Œæ‰€ä»¥æš‚æ—¶ä¸æ‰“ç®—åšåŸæœ‰é“¾æ¥è·¯å¾„åˆ°æ–°è·¯å¾„çš„é‡å®šå‘å·¥ä½œã€‚\nåšå®¢éƒ¨ç½² ç›®å‰æœ‰ä¸‰ç§æ–¹æ¡ˆéƒ¨ç½²æ–¹æ¡ˆï¼š\ngithub pagesã€‚å›½å†…è®¿é—®é€Ÿåº¦å—å½±å“ã€‚ cloudflare pagesã€‚å¯ä»¥ä½¿ç”¨ cdn åŠ é€Ÿã€‚ Self hostedã€‚éœ€è¦è´­ä¹°äº‘ä¸»æœºå’Œæ‰‹åŠ¨è¿ç»´ã€‚ ç›®å‰ï¼Œæ˜¯å€¾å‘äºä½¿ç”¨ç¬¬äºŒç§æ–¹æ¡ˆã€‚æºç ä¿å­˜åˆ° github ä¸Šï¼Œgithub actions ç¼–è¯‘å’Œéƒ¨ç½²é™æ€æ–‡ä»¶åˆ° cf-pages åˆ†æ”¯ï¼Œé€šè¿‡ cloudflare pages é“¾æ¥ github ä»“åº“ã€è‡ªåŠ¨åŒ–éƒ¨ç½²é™æ€æ–‡ä»¶å¹¶è®¾ç½®è‡ªå®šä¹‰åŸŸå blog.chensoul.ccã€‚\nå‘å¸ƒæµç¨‹ æœ¬åœ°ç¼–å†™ markdown æ–‡ä»¶ï¼Œå›¾ç‰‡ä¿å­˜åˆ°å…¬æœ‰äº‘ï¼Œé€šè¿‡ git æäº¤åˆ° github ä»“åº“ï¼Œä½¿ç”¨ github actions é€šè¿‡ n8n è‡ªåŠ¨å‘å¸ƒåˆ°å¤šå¹³å°ï¼Œæ¯”å¦‚ï¼šå…¬ä¼—å·ï¼Œè¯­é›€ç­‰ã€‚\nå¾…åŠäº‹é¡¹ æœ¬å‘¨å¯¹åšå®¢é‡æ„ï¼Œè®¡åˆ’å®Œæˆä»¥ä¸‹åŠŸèƒ½ï¼š\nåœ¨ä¸ä¿®æ”¹åŸä¸»é¢˜çš„å‰æä¸‹ï¼Œé€šè¿‡ git log è®°å½•å¯¹ä¸»é¢˜çš„æ”¹åŠ¨ æ·»åŠ  Cusdis è¯„è®ºç³»ç»Ÿ æ·»åŠ  Umami ç»Ÿè®¡åˆ†æ æ·»åŠ  Kuma æœåŠ¡ç›‘æ§ æ·»åŠ æœç´¢ã€å›åˆ°é¡¶éƒ¨åŠŸèƒ½ ä½¿ç”¨ é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨ ä½œä¸ºå›¾åºŠ github actions é›†æˆ n8n åŸŸå dns è§£æè¿ç§»åˆ° cloudflare ä»¥ä¸‹æ˜¯ä½¿ç”¨ kuma ç›‘æ§æˆ‘çš„ VPS ä¸Šçš„æœåŠ¡ã€‚\nä»¥ä¸Šã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/01/15/weekly_review_2/","summary":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-01-09 åˆ° 2023-01-15 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¿™æ˜¯å¹´å‰å€’æ•°ç¬¬äºŒä¸ªå·¥ä½œå‘¨ï¼Œå·¥ä½œä¸Šä¸»è¦æ˜¯å®Œæˆé¡¹ç›®ä¸€ä¸ªç‰ˆæœ¬çš„æµ‹è¯•å’Œå‘å¸ƒã€‚è¿™ä¸ªåšå®¢ä¸»è¦æ˜¯åˆ†äº«ä¸€äº›æŠ€æœ¯ç›¸å…³ç¬”è®°å’Œä¸ªäººçš„ç”Ÿæ´»è®°å½•ä¸æ€è€ƒï¼Œæ‰€ä»¥ä¸ä¼šæ¶‰åŠå…·ä½“çš„å·¥ä½œå†…å®¹ã€‚\nå‘¨ä¸‰æ™šä¸Šæ˜¯éƒ¨é—¨å¹´ä¼šï¼Œé¢†å¯¼æå‡ºäº† 2023 å¹´æ”¶å…¥ 6.2 äº¿çš„ç›®æ ‡ï¼Œæ¯” 2022 å¹´æ”¶å…¥å¢é•¿ 140%ã€‚ä»å…¬å¸é¢†å¯¼å±‚è¿™ä¹è§‚çš„å¹´åº¦è§„åˆ’ï¼Œçœ‹å¾—å‡ºæ¥å…¬å¸çš„å‘å±•å±äºä¸Šå‡è¶‹åŠ¿ï¼ŒåŒæ—¶æ„å‘³ç€ 2023 å¹´åˆæ˜¯å¿™ç¢Œå’Œå‹åŠ›å·¨å¤§çš„ä¸€å¹´ã€‚\nå·¥ä½œé—²æš‡ä¹‹ä½™ï¼Œçœ‹åˆ°äº†ä¸€äº›ç‹¬ç«‹å¼€å‘è€…çš„åšå®¢ï¼Œå¹¶å—ä»–ä»¬åšå®¢æ–‡ç« çš„å½±å“ï¼Œç«‹å³å†³å®šé‡æ–°æ£é¼“åšå®¢ã€‚äºæ˜¯ï¼Œåœ¨ä¸€è…”çƒ­æƒ…ä¹‹ä¸‹ï¼ŒèŠ±äº†ä¸‰å¤©æ—¶é—´é‡æ„äº†åšå®¢ï¼Œä¹Ÿå¯¹åšå®¢ä»¥åçš„æ–¹å‘åšäº†ä¸€äº›è§„åˆ’ã€‚\nå‘¨æœ«æ˜¯è¿‡å°å¹´ï¼Œå°å¹´ä¼Šå§‹ï¼Œå¹´å‘³æ¸æµ“ã€‚å‘¨å…­æ™šä¸Šï¼Œå ‚å“¥å®¶åƒå¹´é¥­ã€‚å‘¨æ—¥ä¸­åˆï¼Œè‡ªå·±å®¶åƒå¹´é¥­ã€‚è¿™æ˜¯æ–°å©šåç¬¬ä¸€æ¬¡ä¸¤è¾¹çš„å®¶äººä¸€èµ·åƒå¹´é¥­ã€‚è™½ç„¶å¾ˆæ—©å°±ç¡®å®šäº†å¹´é¥­æ—¶é—´å¤§å®¶éƒ½æœ‰æ—¶é—´çš„å‘¨æœ«ã€é¢„å®šäº†å¯ä»¥åä¸‹ 20 å¤šäººçš„å¤§æ¡Œï¼Œä½†è¿˜æ˜¯é—æ†¾äººæ²¡æœ‰åˆ°é½ã€‚\nåšå®¢é‡æ„ åšå®¢ä¸»é¢˜ ä»¥å‰çš„åšå®¢ä¸»è¦æ˜¯çº¯ç²¹åˆ†äº«æŠ€æœ¯ï¼Œå¾ˆå°‘æœ‰è‡ªå·±çš„æ€è€ƒï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯ä»£ç æ¯”æ±‰å­—è¦å¤šä¸å°‘ã€‚åšå®¢æ²¡æœ‰åšä¸»çš„æ€è€ƒï¼Œæ— æ³•è®©è¯»è€…è®¤è¯†ã€äº†è§£åšä¸»ï¼Œå¹¶å’Œåšä¸»äº§ç”Ÿæ·±å…¥çš„é“¾æ¥ã€‚è¿™æ ·çš„åšå®¢æ²¡æœ‰çµé­‚ï¼Œå°±ä»…ä»…æ˜¯ä¸€ä¸ªçº¯åˆ†äº«çš„ wikiã€‚\nè¿™æ¬¡é‡æ–°å¼€å§‹å†™åšå®¢ä¹‹åï¼Œè§„åˆ’çš„åšå®¢ä¸»é¢˜æ˜¯åˆ†äº«æŠ€æœ¯ã€è®°å½•ç”Ÿæ´»ã€å¯å‘æ€è€ƒã€‚æŠ€æœ¯ä¸Šçš„æ–‡ç« ï¼Œè¦æœ‰æ·±åº¦ï¼›ç”Ÿæ´»çš„ç‚¹æ»´ï¼Œè¦æœ‰å¤ç›˜ï¼›æ€è€ƒçš„å†…å®¹ï¼Œè¦æœ‰å…±é¸£ã€‚\nåšå®¢è§„åˆ’ ä»¥å‰åšå®¢æ–‡ç« çš„åˆ†ç±»æœ‰ javaã€databaseã€devopsã€webï¼Œåœ¨åˆ äº†ä¸€äº›æ–‡ç« ä¹‹åï¼Œå°†åšå®¢çš„åˆ†ç±»è°ƒæ•´ä¸ºæƒ³æ³•ï¼ˆIdeasï¼‰ã€ç¬”è®°ï¼ˆNotesï¼‰ä¸¤ç±»ï¼Œåé¢å†æ ¹æ®å®é™…æƒ…å†µæ·»åŠ æˆ–è€…è°ƒæ•´åˆ†ç±»ã€‚\nå¥åº·ï¼Œçˆ±æƒ…å’Œä½¿å‘½ï¼ŒæŒ‰ç…§è¿™ä¸ªé¡ºåºï¼Œå…¶å®ƒçš„éƒ½ä¸é‡è¦\næ–‡ç« é“¾æ¥ ä»¥å‰çš„åšå®¢é“¾æ¥æ ¼å¼æ˜¯ posts/:slugï¼Œç°åœ¨è°ƒæ•´ä¸º posts/:year/:month/:day/:slugã€‚å› ä¸ºç°åœ¨åšå®¢åªæœ‰å‡ ç¯‡æ–‡ç« ï¼Œæ‰€ä»¥æš‚æ—¶ä¸æ‰“ç®—åšåŸæœ‰é“¾æ¥è·¯å¾„åˆ°æ–°è·¯å¾„çš„é‡å®šå‘å·¥ä½œã€‚\nåšå®¢éƒ¨ç½² ç›®å‰æœ‰ä¸‰ç§æ–¹æ¡ˆéƒ¨ç½²æ–¹æ¡ˆï¼š\ngithub pagesã€‚å›½å†…è®¿é—®é€Ÿåº¦å—å½±å“ã€‚ cloudflare pagesã€‚å¯ä»¥ä½¿ç”¨ cdn åŠ é€Ÿã€‚ Self hostedã€‚éœ€è¦è´­ä¹°äº‘ä¸»æœºå’Œæ‰‹åŠ¨è¿ç»´ã€‚ ç›®å‰ï¼Œæ˜¯å€¾å‘äºä½¿ç”¨ç¬¬äºŒç§æ–¹æ¡ˆã€‚æºç ä¿å­˜åˆ° github ä¸Šï¼Œgithub actions ç¼–è¯‘å’Œéƒ¨ç½²é™æ€æ–‡ä»¶åˆ° cf-pages åˆ†æ”¯ï¼Œé€šè¿‡ cloudflare pages é“¾æ¥ github ä»“åº“ã€è‡ªåŠ¨åŒ–éƒ¨ç½²é™æ€æ–‡ä»¶å¹¶è®¾ç½®è‡ªå®šä¹‰åŸŸå blog.chensoul.ccã€‚\nå‘å¸ƒæµç¨‹ æœ¬åœ°ç¼–å†™ markdown æ–‡ä»¶ï¼Œå›¾ç‰‡ä¿å­˜åˆ°å…¬æœ‰äº‘ï¼Œé€šè¿‡ git æäº¤åˆ° github ä»“åº“ï¼Œä½¿ç”¨ github actions é€šè¿‡ n8n è‡ªåŠ¨å‘å¸ƒåˆ°å¤šå¹³å°ï¼Œæ¯”å¦‚ï¼šå…¬ä¼—å·ï¼Œè¯­é›€ç­‰ã€‚\nå¾…åŠäº‹é¡¹ æœ¬å‘¨å¯¹åšå®¢é‡æ„ï¼Œè®¡åˆ’å®Œæˆä»¥ä¸‹åŠŸèƒ½ï¼š\nåœ¨ä¸ä¿®æ”¹åŸä¸»é¢˜çš„å‰æä¸‹ï¼Œé€šè¿‡ git log è®°å½•å¯¹ä¸»é¢˜çš„æ”¹åŠ¨ æ·»åŠ  Cusdis è¯„è®ºç³»ç»Ÿ æ·»åŠ  Umami ç»Ÿè®¡åˆ†æ æ·»åŠ  Kuma æœåŠ¡ç›‘æ§ æ·»åŠ æœç´¢ã€å›åˆ°é¡¶éƒ¨åŠŸèƒ½ ä½¿ç”¨ é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨ ä½œä¸ºå›¾åºŠ github actions é›†æˆ n8n åŸŸå dns è§£æè¿ç§»åˆ° cloudflare ä»¥ä¸‹æ˜¯ä½¿ç”¨ kuma ç›‘æ§æˆ‘çš„ VPS ä¸Šçš„æœåŠ¡ã€‚","title":"å‘¨æŠ¥-2ï½œåšå®¢é‡æ„"},{"content":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-01-02 åˆ° 2023-01-08 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¿™æ˜¯ 2023 å¹´çš„ç¬¬ä¸€å‘¨ï¼Œå…ƒæ—¦æ”¾äº†ä¸‰å¤©å‡ä¹‹åï¼Œå°±ç”¨æŠ•å…¥äº†å·¥ä½œä¹‹ä¸­ã€‚å…ƒæ—¦å·²è¿‡ï¼Œè¿‡å¹´å°±æ²¡å¤šè¿œäº†ï¼Œå¾ˆå¤šå…¬å¸ä¹Ÿå¼€å§‹å‡†å¤‡å¹´ä¼šäº†ã€‚å› ä¸ºç–«æƒ…ï¼Œè¿™ä¸ªå¹´æ³¨å®šä¸å¥½è¿‡ã€‚ç°åœ¨ç–«æƒ…æ”¾å¼€ï¼Œä¸çŸ¥é“æœ‰å¤šå°‘å…¬å¸èƒ½å¤Ÿç†¬è¿‡è¿™ä¸ªå¹´ï¼Œè¿›å…¥ç™¾åºŸå¾…å…´çš„èŠ‚å¥ã€‚\næœ€è¿‘æŠŠ rss é˜…è¯»å™¨åˆç”¨èµ·æ¥ï¼Œæ¯å¤©é˜…è¯»è®¢é˜…çš„æœªè¯»æ–‡ç« ï¼Œå…³æ³¨åˆ°å¥½å‡ ä¸ªç‹¬ç«‹å¼€å‘è€…ã€‚ä»–ä»¬æ¯å‘¨éƒ½åœ¨åšæŒå†™åšå®¢ã€åˆ†äº«æŠ€æœ¯æ–‡ç« ã€‚ä»ä»–ä»¬çš„åˆ†äº«é‡Œé¢ï¼Œå¯ä»¥çœ‹åˆ°ä»–ä»¬æœ‰åœ¨åšè‡ªå·±çš„ side projectsï¼Œä¹Ÿæœ‰åœ¨å¼€æºé¡¹ç›®æäº¤ä»£ç ã€‚çœ‹ç€ä»–ä»¬çš„ github ä¸»é¡µæ¯å¤©éƒ½æœ‰æäº¤ä»£ç ï¼Œå†çœ‹çœ‹æˆ‘çš„ github ä¸»é¡µå¾ˆä¹…æ²¡æœ‰æäº¤è¿‡ä»£ç ï¼Œé¡¿æ„Ÿæƒ­æ„§ã€‚ç›®å‰ï¼Œå…¬å¸ä½¿ç”¨çš„æ˜¯è‡ªå»ºçš„ gitlab ä»“åº“æ‰˜ç®¡ä»£ç ï¼Œå¾ˆå¤šä»£ç ä¸æ–¹ä¾¿å…¬å¼€åˆ†äº«ï¼Œè‡ªå·±å¤œå¾ˆå°‘èŠ±æ—¶é—´å†™ä¸€äº›å°é¡¹ç›®å…¬å¼€åˆ†äº«åˆ° githubã€‚å¹²è„†å°±æ¸…ç†ä¸€äº› github é•¿æœŸæ²¡æœ‰ç»´æŠ¤çš„ä»“åº“ï¼Œå–å…³äº†ä¸€äº›å¥½å‹ï¼Œæ›´æ–°äº† github ä¸»é¡µï¼Œæœ€åçœ‹äº†ä¸€ä¸‹ç²‰ä¸è¿˜æœ‰ 574 äººï¼Œç›¸å¯¹è€Œè¨€ä¹Ÿæ˜¯å°‘çš„å¯æ€œ ğŸ¥ºã€‚\nå¼€å§‹å†™å‘¨æŠ¥ å‰æ®µæ—¶é—´ï¼Œå¼€å§‹å°è¯•åœ¨ è¯­é›€ ä¸Šæ¯å¤©å†™æ—¥è®°ï¼Œå†™äº†å‡ å¤©ä¹‹åï¼Œæ²¡æœ‰åšæŒä¸‹æ¥ã€‚\næ€»ç»“äº†ä¸€ä¸‹ï¼Œæ²¡æœ‰åšæŒä¸‹æ¥çš„åŸå› ä¸»è¦æ˜¯åœ¨äºæ¯å¤©æ²¡æœ‰ç§¯ç´¯è¶³å¤Ÿçš„åˆ†äº«å†…å®¹ï¼Œä¹Ÿå°±æ˜¯è¾“å…¥ä¸å¤Ÿï¼›å¦å¤–ï¼Œè¾“å‡ºä¹‹åçš„åé¦ˆä¸å¤Ÿï¼Œè¿™å’Œè§‚ä¼—æµé‡æœ‰å…³ã€‚ä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œæ›´å–œæ¬¢è‡ªåŠ¨åŒ–å·¥ä½œçš„å¿«æ„Ÿå’Œæ»¡è¶³æ„Ÿã€‚å“Ÿè¿˜æ˜¯æ›´å€¾å‘äºå°†åšå®¢ä»¥ markdown æ–‡ä»¶ä¿å­˜åˆ°æœ¬åœ°æˆ–è€… git ä»“åº“ï¼Œç„¶åé€šè¿‡è‡ªåŠ¨åŒ–è„šæœ¬ç¼–è¯‘éƒ¨ç½²åˆ°å¤šå¹³å°ã€‚åœ¨å…³æ³¨äº†ä¸€äº›ç‹¬ç«‹å¼€å‘è€…çš„åšå®¢ä¹‹åï¼Œæ›´æ˜¯åšå®šäº†è¿™ç§æƒ³æ³•ã€‚äºæ˜¯æœ‰äº†è¿™ç¯‡å†™å‘¨æŠ¥çš„æ–‡ç« ï¼Œä»¥å‘¨ä¸ºå•ä½è®°å½•æ¯ä¸€å‘¨çš„æ‰€çœ‹æ‰€æ€æ‰€æ„Ÿã€‚\nå…³äºå†™åšå®¢çš„æµç¨‹ï¼Œç”µè„‘ä¸Šä½¿ç”¨ typora ç¼–è¾‘å™¨æœ‰ç€å¾ˆå¥½çš„ç”¨æˆ·ä½“éªŒã€‚å¦‚æœä¹Ÿèƒ½åœ¨æ‰‹æœºä¸Šç”¨ markdown å†™æ–‡ç« å¹¶æäº¤åˆ° github ä¸Šå°±æ›´å®Œç¾äº†ã€‚åˆšå¼€å§‹æˆ‘ä½¿ç”¨çš„æ˜¯ mweb è¿™ä¸ª appï¼Œæœ€è¿‘åœ¨ ios ä¸Šåˆå‘ç°äº† metion è¿™ä¸ª app å°±å¯ä»¥æ”¯æŒå’Œ git åŒæ­¥ã€‚\nè¿™ç¯‡æ–‡ç« å°±æ˜¯é€šè¿‡ metion ç¼–å†™å’Œæäº¤çš„ã€‚å›¾ç‰‡æ˜¯æœ¬åœ°ä¸Šä¼ çš„ï¼Œå›¾ç‰‡åç§°åº”è¯¥æ˜¯ä¸€ä¸²éšæœºæ•°ï¼Œå¾…æ–‡ç« å‘å¸ƒä¹‹åï¼Œéœ€è¦å°†å›¾ç‰‡é‡å‘½åä¸ºæœ‰æ„ä¹‰çš„åç§°ï¼Œè¿™æ ·æ–¹ä¾¿åœ¨å›¾åºŠé‡ŒæŸ¥é˜…å’Œç®¡ç†ã€‚\nå…³äºå›¾ç‰‡çš„å®½åº¦è®¾ç½®ï¼Œç‰¹åˆ«æ˜¯ç«–å½¢å›¾ï¼Œå»ºè®®å°†å®½åº¦è®¾ç½®ä¸ºä¸€åŠã€‚è®¾ç½®æ–¹æ³•æ˜¯ï¼šåœ¨ md æ–‡ä»¶é‡Œä½¿ç”¨ img æ ‡ç­¾å¼•å…¥å›¾ç‰‡ï¼Œè¿™æ ·å°±å¯ä»¥æ·»åŠ ä¸€ä¸ª sytle=\u0026quot;width: 50%\u0026quot; æ¥è®¾ç½®å®½åº¦ã€‚ä¾‹å¦‚ï¼Œä¸Šé¢å›¾ç‰‡å°±æ˜¯è¿™æ ·è®¾ç½®çš„ã€‚\n\u0026lt;img src=\u0026#34;http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/ios-app-metion.png\u0026#34; alt=\u0026#34;ios-app-metion\u0026#34; style=\u0026#34;width: 50%\u0026#34; /\u0026gt; å†…è§‚å†¥æƒ³ è¿™ä¸ªæœˆå‚åŠ äº†ä¸€ä¸ªå†…è§‚å†¥æƒ³ 21 å¤©è®­ç»ƒè¥ï¼Œæ¯å¤©æ—©ä¸Š 7 ç‚¹åˆ° 8 ç‚¹æ˜¯ä¸Šè¯¾æ—¶é—´ï¼Œæ­£å¥½ä¹Ÿæ˜¯æˆ‘ä¸Šç­æ—¶é—´ã€‚åœ¨å¬äº†å‡ å¤©è¯¾ç¨‹å¹¶æ‰“å¡ä¹‹åï¼Œå°±æ”¾å¼ƒäº†ã€‚\n21 å¤©è¯¾ç¨‹å†…å®¹ï¼Œæ¯å¤©çš„ä¸»é¢˜åˆ†åˆ«æ˜¯ï¼š\nç›®æ ‡ è®¡åˆ’ ç»“æœ æ¯”è¾ƒ æŠ±æ€¨ åæ‚” ä»–åº”è¯¥çŸ¥é“è‡ªå·±é”™äº† ä¸å¯èƒ½ ç›®æ ‡ ä»Šæ—¥å†…è§‚å†¥æƒ³ä¸»é¢˜æ˜¯ç›®æ ‡\né™é™åœ°æ”¾ç©ºè‡ªå·±ï¼Œå›æƒ³è‡ªå·±å…³æ³¨ç›®æ ‡çš„è®°å¿†ã€‚å¥½åƒè‡ªå·±æ›¾ç»è®¾ç«‹è¿‡å¾ˆå¤šç›®æ ‡ï¼Œåˆå¥½åƒä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Œå¥½åƒæè¿°ä¸å‡ºæ¥ï¼Œåˆç¢ç£¨ä¸é€ã€‚\næ›¾ç»ç«‹ä¸‹çš„é‚£äº›ç›®æ ‡ç®—æ˜¯ç›®æ ‡å—ï¼Ÿä»–ä»¬å¯ä»¥å®ç°å—ï¼Ÿä»–ä»¬å®ç°äº†å—ï¼Ÿä¸ºä»€ä¹ˆæ²¡æœ‰å®ç°å‘¢ï¼Ÿæ— å¿—ä¹‹äººå¸¸ç«‹å¿—ï¼Œæœ‰å¿—ä¹‹äººç«‹å¸¸å¿—ã€‚è¿œçš„ä¸è¯´ï¼Œå…ˆçœ‹çœ‹ 2022 å¹´å®ç°äº†å“ªäº›ç›®æ ‡ã€‚è¯»ä¹¦ï¼Œæ˜¯å½»åº•æ”¾ä¸‹äº†ï¼›å¥èº«ï¼Œå…ƒæ—¦å‰å‡åˆ° 130 æ–¤çš„ç›®æ ‡åœ¨ â€œé˜³åº·åä¸è¦å‰§çƒˆè¿åŠ¨â€ çš„è¯´è¾ä¸‹è€½è¯¯äº†ï¼›å®šæŠ•ï¼Œä¹Ÿæ˜¯ç»ˆæ­¢äº†ï¼›ä¹°è½¦ï¼Œè½¦æ˜¯æ¶ˆè€—å“ï¼›ç»“å©šï¼Œå®ç°äº†ã€‚\nç®—äº†ä¸‹ï¼Œå®ç°äº†çš„ç›®æ ‡ä¹Ÿå°±æ˜¯ç»“å©šäº†ã€‚å°‘çš„å¯æ€œã€‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿå¤§æŠµæ˜¯è‡ªå·±ä¸å¤Ÿè‡ªå¾‹ï¼Œæ²¡æœ‰æŒç»­çš„åšæŒï¼Œä¹Ÿæ²¡æœ‰åŠæ—¶çš„åæ€å’Œè°ƒæ•´ã€‚ä¹Ÿå°±æ˜¯è‡ªæˆ‘å¯Ÿè§‰ä¸å¤Ÿå§ï¼æˆ–è€…è¯´æ²¡æœ‰å…»æˆè‡ªæˆ‘å¯Ÿè§‰çš„æ–¹æ³•å’Œä¹ æƒ¯ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆè¦å‚åŠ  21 å¤©å†…è§‚è®­ç»ƒè¥çš„åŸå› å§ã€‚\nä¸€ä¸ªäººå¾ˆéš¾è®¤æ¸…è‡ªèº«çš„å±€é™æ€§ï¼Œå¾ˆéš¾æ‰©å¤§è‡ªå·±çš„è®¤çŸ¥ï¼Œå¤šä¸èº«è¾¹çš„äººäº¤æµå’Œå­¦ä¹ ï¼Œé€šè¿‡è§‚ä»–äººï¼Œå†æ¥æ€è‡ªå·±ï¼Œåº”è¯¥å¯ä»¥æå‡è‡ªå·±çš„å¯Ÿè§‰æ„è¯†ã€‚\nè®¡åˆ’ ä»Šæ—¥å†…è§‚å†¥æƒ³ä¸»é¢˜æ˜¯è®¡åˆ’ã€‚\næ—©ä¸Šå†¥æƒ³æ˜¯åœ¨åœ°é“ï¼Œå†¥æƒ³çš„æ—¶å€™æ”¾ç©ºè‡ªå·±ï¼Œæ„Ÿå—è‡ªå·±çš„æ€ç»ªã€æƒ…ç»ªå’Œèº«ä½“çš„æ³¨æ„åŠ›ã€‚å› ä¸ºæ˜¯ç«™ç€ï¼Œæ³¨æ„åŠ›ä¸€ä¼šå„¿åœ¨è„šä¸Šï¼Œä¸€ä¼šå„¿åœ¨æ‰‹ä¸Šï¼Œä¸èƒ½å®Œå…¨åœ°æ”¾ç©ºè‡ªå·±ã€‚æƒ³å¿…è¦æ˜¯å®Œå…¨æ”¾æ¾ï¼Œä¼°è®¡å°±ç«™ä¸ä½äº†å§ã€‚\nå†¥æƒ³åœ°è¿‡ç¨‹ä¸­ï¼Œé‡è¦çš„æ˜¯æ„Ÿå—å’Œè§‚å¯Ÿã€‚æ„Ÿå—å½“ä¸‹çš„æ„Ÿå—ï¼Œè§‚å¯Ÿè‡ªå·±çš„è§‚å¯Ÿï¼Œä»»æœ‰ä»–ä»¬æµåŠ¨å’Œå‘å±•ã€‚æ‰€è°“æ²¡æœ‰ç»å¯¹çš„å¯¹ä¸é”™ï¼Œå†¥æƒ³çš„è¿‡ç¨‹ä¸­ï¼Œé‡è¦çš„æ˜¯ä½œä¸ºä¸€ä¸ªæ—è§‚è€…ï¼Œä¸è¦æœ‰è¿‡å¤šçš„ä¸»è§‚æ„è¯†ã€‚\nç»“æœ ä»Šå¤©çš„å†…è§‚å†¥æƒ³ä¸»é¢˜æ˜¯ç»“æœã€‚\næŠŠèº«ä½“æŒ‚åœ¨é’©å­ä¸Šï¼Œé™é™åœ°è§‚å¯Ÿå’Œæ„Ÿå—ã€‚ä¸€æ–¹é¢æ„Ÿå—èº«ä½“ï¼Œä¸€æ–¹é¢ä¼šæ€è€ƒè‡ªå·±å¯¹ç»“æœçš„ç†è§£ã€‚ä»€ä¹ˆæ˜¯ç»“æœï¼Ÿè‡ªå·±è¿‡å»ä¸€å¹´å–å¾—äº†ä»€ä¹ˆæ ·çš„ç»“æœï¼Ÿä¸ºä»€ä¹ˆæ²¡æœ‰å–å¾—ï¼Ÿ\næ¯”è¾ƒ ä»Šæ—¥å†…è§‚å†¥æƒ³ä¸»é¢˜æ˜¯æ¯”è¾ƒã€‚å†¥æƒ³æ—¶ï¼Œè§‚å¯Ÿè‡ªå·±çš„æ„Ÿå—ã€æƒ…ç»ªã€æƒ³æ³•ï¼Œä»–ä»¬å¯èƒ½æ˜¯ä»»ä½•æ ·å­çš„ã€‚ä¸ç®¡æ˜¯æ€æ ·çš„ï¼Œä»–ä»¬éƒ½æ˜¯æ­£å¸¸çš„ï¼Œéƒ½æ˜¯ä»–ä»¬æœ¬æ¥çš„æ ·å­ï¼Œä¹Ÿå°±æ˜¯ç©ºæ€§ã€‚\næŠŠæ¯”è¾ƒè¿™ä¸ªå¿µå¤´æŒ‚èµ·æ¥ï¼Œé™é™åœ°çœ‹æ¯”è¾ƒè¿™ä¸¤ä¸ªå­—ã€‚ç„¶åå¼€å§‹è§‰å¯Ÿæ¯”è¾ƒè¿™ä¸¤ä¸ªå­—ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå¤§è„‘å¼€å§‹åœ¨æ€è€ƒæ¯”è¾ƒè¿™ä¸ªå¿µå¤´æ˜¯ä»€ä¹ˆã€‚æ€ç»ªåœ¨å˜åŒ–çš„æ—¶å€™ï¼Œå¯¹å¯¹æ¯”è¾ƒè¿™ä¸ªå¿µå¤´çš„æ„Ÿå—ä¹Ÿåœ¨å˜åŒ–ã€‚æ— è®ºå¦‚ä½•å˜åŒ–ï¼Œè‡ªå·±éƒ½ä¸è¦å¹²é¢„ã€‚å½“è‡ªå·±æœ‰äº†æ¯”è¾ƒè¿™ä¸ªå¿µå¤´ï¼Œè‡ªå·±çš„æ„Ÿå—æ˜¯å¤±æœ›çš„ã€‚å¤±æœ›è‡ªå·±ä¸å¦‚åˆ«äººï¼Œä¸å¦‚è¿‡å»ã€‚å¤±æœ›è¿‡åï¼Œåˆä¸æœæ°”ï¼Œåˆæš—ä¸‹å†³å¿ƒè¦å¥½å¥½åŠªåŠ›ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘æ˜¯æˆ‘çš„ä¸»äººï¼Œæ˜¯æˆ‘åœ¨æœ‰ç€å„ç§å„æ ·çš„æ„Ÿå—ã€‚å¦‚æœæˆ‘èƒ½æ§åˆ¶è‡ªå·±çš„æƒ…ç»ªï¼Œå°±èƒ½æ§åˆ¶è‡ªå·±çš„è¡Œä¸ºã€‚\næŠ±æ€¨ ä»Šæ—¥å†¥æƒ³ä¸»é¢˜æ˜¯æŠ±æ€¨ã€‚\nç”Ÿæ´»ä¸­æœ‰ä»€ä¹ˆæŠ±æ€¨çš„ï¼ŸæŠ±æ€¨åˆè§£å†³ä¸äº†é—®é¢˜ï¼Ÿé—®é¢˜åˆä¸æ˜¯è‡ªå·±é€ æˆçš„ï¼Œå¯èƒ½æ˜¯åˆ«äººé€ æˆçš„ï¼åˆ«äººçš„äº‹æƒ…æ˜¯åˆ«äººçš„äº‹æƒ…ï¼Œè‡ªå·±çš„äº‹æƒ…æ˜¯è‡ªå·±é€ æˆã€‚åˆ«äººçš„äº‹æƒ…ï¼Œä½ ç®¡ä¸äº†ï¼Œä½ èƒ½ç®¡ç†çš„æ˜¯ä½ è‡ªå·±çš„ã€‚ç®¡å¥½è‡ªå·±çš„å¿ƒæ€æƒ…ç»ªå’Œè¡Œä¸ºï¼Œå› ä¸ºæŠ±æ€¨è§£å†³ä¸äº†åˆ«äººçš„é—®é¢˜ï¼Œä¹Ÿè§£å†³ä¸äº†è‡ªå·±çš„äº‹æƒ…ã€‚ç”šè‡³ä½ çš„æŠ±æ€¨è¿˜ä¼šç»™åˆ«äººå¸¦æ¥è´Ÿèƒ½é‡ï¼Œç»™ä½ ä»¬å¸¦æ¥äº‰åµï¼Œç»™è‡ªå·±å¸¦æ¥è›®çƒ¦ï¼Œç»™è‡ªå·±åœ°èƒ½åŠ›å’Œæƒ…ç»ªå¸¦æ¥æ¶ˆè€—ã€‚ä¸å…¶æ¶ˆè€—è‡ªå·±ï¼Œè¿˜ä¸å¦‚æå‡è‡ªå·±ã€‚æœ‰æ—¶å€™ä¸è¦å±€é™åœ¨è‡ªå·±çš„æ€ç»´é‡Œï¼Œæ¢ä¸ªè§’åº¦ï¼Œæå‡æ ¼å±€ï¼Œä¸€åˆ‡äº‹æƒ…éƒ½ä¸æ˜¯äº‹æƒ…äº†ã€‚è¿™ä¸ªä¸–ç•Œå“ªæœ‰é‚£ä¹ˆå¤šæ‰€è°“é‡è¦çš„äº‹æƒ…ã€‚é‚£äº›ä»Šå¤©ä½ çœ‹æ¥å¾ˆé‡è¦çš„äº‹å„¿ï¼Œåœ¨åå¹´äºŒåå¹´ä¹‹åï¼Œæ ¹æœ¬å°±ä¸å€¼å¾—ä¸€æã€‚æ‰€ä»¥å¾ˆå¤šæ—¶å€™ï¼Œè¦ç”¨å‘å±•çš„çœ¼å…‰çœ‹é—®é¢˜ã€‚ä¸€åˆ‡éƒ½ä¼šè¿‡å»ï¼Œä¸€åˆ‡éƒ½ä¼šå¥½èµ·æ¥ã€‚å½“ä½ è¿™æ ·æƒ³çš„æ—¶å€™ï¼Œåœ¨ä½ å¿ƒé‡Œåœ¨ä½ çœ¼å‰ï¼Œå°±æ²¡æœ‰ä»€ä¹ˆçƒ¦æ¼äº†ï¼Œä¹Ÿå°±ä¸ä¼šæŠ±æ€¨äº†ã€‚\nå¥½ç‰©åˆ†äº« å‡ ä¸ªæˆªå›¾è½¯ä»¶ï¼š\nTinySnap Chrome æˆªå›¾æ’ä»¶ï¼Œæ”¯æŒè®¾ç½®èƒŒæ™¯\nSnipaste æˆªå›¾\nä»¥ä¸Šã€‚\n","permalink":"https://blog.chensoul.cc/posts/2023/01/08/weekly_review_1/","summary":"å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-01-02 åˆ° 2023-01-08 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚\nè¿™æ˜¯ 2023 å¹´çš„ç¬¬ä¸€å‘¨ï¼Œå…ƒæ—¦æ”¾äº†ä¸‰å¤©å‡ä¹‹åï¼Œå°±ç”¨æŠ•å…¥äº†å·¥ä½œä¹‹ä¸­ã€‚å…ƒæ—¦å·²è¿‡ï¼Œè¿‡å¹´å°±æ²¡å¤šè¿œäº†ï¼Œå¾ˆå¤šå…¬å¸ä¹Ÿå¼€å§‹å‡†å¤‡å¹´ä¼šäº†ã€‚å› ä¸ºç–«æƒ…ï¼Œè¿™ä¸ªå¹´æ³¨å®šä¸å¥½è¿‡ã€‚ç°åœ¨ç–«æƒ…æ”¾å¼€ï¼Œä¸çŸ¥é“æœ‰å¤šå°‘å…¬å¸èƒ½å¤Ÿç†¬è¿‡è¿™ä¸ªå¹´ï¼Œè¿›å…¥ç™¾åºŸå¾…å…´çš„èŠ‚å¥ã€‚\næœ€è¿‘æŠŠ rss é˜…è¯»å™¨åˆç”¨èµ·æ¥ï¼Œæ¯å¤©é˜…è¯»è®¢é˜…çš„æœªè¯»æ–‡ç« ï¼Œå…³æ³¨åˆ°å¥½å‡ ä¸ªç‹¬ç«‹å¼€å‘è€…ã€‚ä»–ä»¬æ¯å‘¨éƒ½åœ¨åšæŒå†™åšå®¢ã€åˆ†äº«æŠ€æœ¯æ–‡ç« ã€‚ä»ä»–ä»¬çš„åˆ†äº«é‡Œé¢ï¼Œå¯ä»¥çœ‹åˆ°ä»–ä»¬æœ‰åœ¨åšè‡ªå·±çš„ side projectsï¼Œä¹Ÿæœ‰åœ¨å¼€æºé¡¹ç›®æäº¤ä»£ç ã€‚çœ‹ç€ä»–ä»¬çš„ github ä¸»é¡µæ¯å¤©éƒ½æœ‰æäº¤ä»£ç ï¼Œå†çœ‹çœ‹æˆ‘çš„ github ä¸»é¡µå¾ˆä¹…æ²¡æœ‰æäº¤è¿‡ä»£ç ï¼Œé¡¿æ„Ÿæƒ­æ„§ã€‚ç›®å‰ï¼Œå…¬å¸ä½¿ç”¨çš„æ˜¯è‡ªå»ºçš„ gitlab ä»“åº“æ‰˜ç®¡ä»£ç ï¼Œå¾ˆå¤šä»£ç ä¸æ–¹ä¾¿å…¬å¼€åˆ†äº«ï¼Œè‡ªå·±å¤œå¾ˆå°‘èŠ±æ—¶é—´å†™ä¸€äº›å°é¡¹ç›®å…¬å¼€åˆ†äº«åˆ° githubã€‚å¹²è„†å°±æ¸…ç†ä¸€äº› github é•¿æœŸæ²¡æœ‰ç»´æŠ¤çš„ä»“åº“ï¼Œå–å…³äº†ä¸€äº›å¥½å‹ï¼Œæ›´æ–°äº† github ä¸»é¡µï¼Œæœ€åçœ‹äº†ä¸€ä¸‹ç²‰ä¸è¿˜æœ‰ 574 äººï¼Œç›¸å¯¹è€Œè¨€ä¹Ÿæ˜¯å°‘çš„å¯æ€œ ğŸ¥ºã€‚\nå¼€å§‹å†™å‘¨æŠ¥ å‰æ®µæ—¶é—´ï¼Œå¼€å§‹å°è¯•åœ¨ è¯­é›€ ä¸Šæ¯å¤©å†™æ—¥è®°ï¼Œå†™äº†å‡ å¤©ä¹‹åï¼Œæ²¡æœ‰åšæŒä¸‹æ¥ã€‚\næ€»ç»“äº†ä¸€ä¸‹ï¼Œæ²¡æœ‰åšæŒä¸‹æ¥çš„åŸå› ä¸»è¦æ˜¯åœ¨äºæ¯å¤©æ²¡æœ‰ç§¯ç´¯è¶³å¤Ÿçš„åˆ†äº«å†…å®¹ï¼Œä¹Ÿå°±æ˜¯è¾“å…¥ä¸å¤Ÿï¼›å¦å¤–ï¼Œè¾“å‡ºä¹‹åçš„åé¦ˆä¸å¤Ÿï¼Œè¿™å’Œè§‚ä¼—æµé‡æœ‰å…³ã€‚ä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œæ›´å–œæ¬¢è‡ªåŠ¨åŒ–å·¥ä½œçš„å¿«æ„Ÿå’Œæ»¡è¶³æ„Ÿã€‚å“Ÿè¿˜æ˜¯æ›´å€¾å‘äºå°†åšå®¢ä»¥ markdown æ–‡ä»¶ä¿å­˜åˆ°æœ¬åœ°æˆ–è€… git ä»“åº“ï¼Œç„¶åé€šè¿‡è‡ªåŠ¨åŒ–è„šæœ¬ç¼–è¯‘éƒ¨ç½²åˆ°å¤šå¹³å°ã€‚åœ¨å…³æ³¨äº†ä¸€äº›ç‹¬ç«‹å¼€å‘è€…çš„åšå®¢ä¹‹åï¼Œæ›´æ˜¯åšå®šäº†è¿™ç§æƒ³æ³•ã€‚äºæ˜¯æœ‰äº†è¿™ç¯‡å†™å‘¨æŠ¥çš„æ–‡ç« ï¼Œä»¥å‘¨ä¸ºå•ä½è®°å½•æ¯ä¸€å‘¨çš„æ‰€çœ‹æ‰€æ€æ‰€æ„Ÿã€‚\nå…³äºå†™åšå®¢çš„æµç¨‹ï¼Œç”µè„‘ä¸Šä½¿ç”¨ typora ç¼–è¾‘å™¨æœ‰ç€å¾ˆå¥½çš„ç”¨æˆ·ä½“éªŒã€‚å¦‚æœä¹Ÿèƒ½åœ¨æ‰‹æœºä¸Šç”¨ markdown å†™æ–‡ç« å¹¶æäº¤åˆ° github ä¸Šå°±æ›´å®Œç¾äº†ã€‚åˆšå¼€å§‹æˆ‘ä½¿ç”¨çš„æ˜¯ mweb è¿™ä¸ª appï¼Œæœ€è¿‘åœ¨ ios ä¸Šåˆå‘ç°äº† metion è¿™ä¸ª app å°±å¯ä»¥æ”¯æŒå’Œ git åŒæ­¥ã€‚\nè¿™ç¯‡æ–‡ç« å°±æ˜¯é€šè¿‡ metion ç¼–å†™å’Œæäº¤çš„ã€‚å›¾ç‰‡æ˜¯æœ¬åœ°ä¸Šä¼ çš„ï¼Œå›¾ç‰‡åç§°åº”è¯¥æ˜¯ä¸€ä¸²éšæœºæ•°ï¼Œå¾…æ–‡ç« å‘å¸ƒä¹‹åï¼Œéœ€è¦å°†å›¾ç‰‡é‡å‘½åä¸ºæœ‰æ„ä¹‰çš„åç§°ï¼Œè¿™æ ·æ–¹ä¾¿åœ¨å›¾åºŠé‡ŒæŸ¥é˜…å’Œç®¡ç†ã€‚\nå…³äºå›¾ç‰‡çš„å®½åº¦è®¾ç½®ï¼Œç‰¹åˆ«æ˜¯ç«–å½¢å›¾ï¼Œå»ºè®®å°†å®½åº¦è®¾ç½®ä¸ºä¸€åŠã€‚è®¾ç½®æ–¹æ³•æ˜¯ï¼šåœ¨ md æ–‡ä»¶é‡Œä½¿ç”¨ img æ ‡ç­¾å¼•å…¥å›¾ç‰‡ï¼Œè¿™æ ·å°±å¯ä»¥æ·»åŠ ä¸€ä¸ª sytle=\u0026quot;width: 50%\u0026quot; æ¥è®¾ç½®å®½åº¦ã€‚ä¾‹å¦‚ï¼Œä¸Šé¢å›¾ç‰‡å°±æ˜¯è¿™æ ·è®¾ç½®çš„ã€‚\n\u0026lt;img src=\u0026#34;http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/ios-app-metion.png\u0026#34; alt=\u0026#34;ios-app-metion\u0026#34; style=\u0026#34;width: 50%\u0026#34; /\u0026gt; å†…è§‚å†¥æƒ³ è¿™ä¸ªæœˆå‚åŠ äº†ä¸€ä¸ªå†…è§‚å†¥æƒ³ 21 å¤©è®­ç»ƒè¥ï¼Œæ¯å¤©æ—©ä¸Š 7 ç‚¹åˆ° 8 ç‚¹æ˜¯ä¸Šè¯¾æ—¶é—´ï¼Œæ­£å¥½ä¹Ÿæ˜¯æˆ‘ä¸Šç­æ—¶é—´ã€‚åœ¨å¬äº†å‡ å¤©è¯¾ç¨‹å¹¶æ‰“å¡ä¹‹åï¼Œå°±æ”¾å¼ƒäº†ã€‚\n21 å¤©è¯¾ç¨‹å†…å®¹ï¼Œæ¯å¤©çš„ä¸»é¢˜åˆ†åˆ«æ˜¯ï¼š\nç›®æ ‡ è®¡åˆ’ ç»“æœ æ¯”è¾ƒ æŠ±æ€¨ åæ‚” ä»–åº”è¯¥çŸ¥é“è‡ªå·±é”™äº† ä¸å¯èƒ½ ç›®æ ‡ ä»Šæ—¥å†…è§‚å†¥æƒ³ä¸»é¢˜æ˜¯ç›®æ ‡\né™é™åœ°æ”¾ç©ºè‡ªå·±ï¼Œå›æƒ³è‡ªå·±å…³æ³¨ç›®æ ‡çš„è®°å¿†ã€‚å¥½åƒè‡ªå·±æ›¾ç»è®¾ç«‹è¿‡å¾ˆå¤šç›®æ ‡ï¼Œåˆå¥½åƒä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Œå¥½åƒæè¿°ä¸å‡ºæ¥ï¼Œåˆç¢ç£¨ä¸é€ã€‚\næ›¾ç»ç«‹ä¸‹çš„é‚£äº›ç›®æ ‡ç®—æ˜¯ç›®æ ‡å—ï¼Ÿä»–ä»¬å¯ä»¥å®ç°å—ï¼Ÿä»–ä»¬å®ç°äº†å—ï¼Ÿä¸ºä»€ä¹ˆæ²¡æœ‰å®ç°å‘¢ï¼Ÿæ— å¿—ä¹‹äººå¸¸ç«‹å¿—ï¼Œæœ‰å¿—ä¹‹äººç«‹å¸¸å¿—ã€‚è¿œçš„ä¸è¯´ï¼Œå…ˆçœ‹çœ‹ 2022 å¹´å®ç°äº†å“ªäº›ç›®æ ‡ã€‚è¯»ä¹¦ï¼Œæ˜¯å½»åº•æ”¾ä¸‹äº†ï¼›å¥èº«ï¼Œå…ƒæ—¦å‰å‡åˆ° 130 æ–¤çš„ç›®æ ‡åœ¨ â€œé˜³åº·åä¸è¦å‰§çƒˆè¿åŠ¨â€ çš„è¯´è¾ä¸‹è€½è¯¯äº†ï¼›å®šæŠ•ï¼Œä¹Ÿæ˜¯ç»ˆæ­¢äº†ï¼›ä¹°è½¦ï¼Œè½¦æ˜¯æ¶ˆè€—å“ï¼›ç»“å©šï¼Œå®ç°äº†ã€‚","title":"å‘¨æŠ¥-1ï½œå¼€å§‹å†™å‘¨æŠ¥ã€å†¥æƒ³"},{"content":"æœ€è¿‘ç¼–å†™æ–‡æ¡£æˆ–è€…å†™åšå®¢ï¼Œå–œæ¬¢ç”¨ Typora ç¼–è¾‘å™¨é€šè¿‡ Markdown è¯­æ³•å®Œæˆç¼–å†™æ‰€æœ‰å†…å®¹ã€‚ä¸ºæ­¤ï¼Œè¿˜ä»˜è´¹è´­ä¹°äº†è®¸å¯è¯ã€‚\nå–œæ¬¢ Typora çš„ç†ç”±ï¼š\næ‰€è§å³æ‰€å¾—çš„ç¼–è¾‘ï¼ŒMarkdown çš„è¯­æ³•éƒ½æ”¯æŒå¿«æ·é”®æ“ä½œï¼Œéå¸¸æ–¹ä¾¿\nå¯ä»¥è‡ªå®šä¹‰ä¸»é¢˜çš„ CSSï¼ŒåŒ…æ‹¬æ–‡ç« å†…å®¹å°±å¯ä»¥ç²˜è´´åˆ°å…¬ä¼—å·é‡Œ\nä¸Šä¼ å›¾ç‰‡ï¼Œæ”¯æŒå›¾åºŠæœåŠ¡ã€‚å¯ä»¥å°†å›¾ç‰‡ä¸Šä¼ åˆ°æŒ‡å®šçš„å›¾åºŠï¼Œå‰ææ˜¯éœ€è¦å…ˆå®‰è£…ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯ PicGoã€‚ç„¶åï¼ŒPicGo æ”¯æŒå¸¸è§çš„ä¸€äº›å›¾åºŠæœåŠ¡ã€‚\næ”¯æŒå¯¼å‡º\nTypora å›¾ç‰‡å¤åˆ¶åˆ°æœ¬åœ° æ¥ä¸‹æ¥ï¼ŒèŠèŠ Typora çš„å›¾ç‰‡ä¸Šä¼ è®¾ç½®ï¼š\nå½“ä½ æ’å…¥å›¾ç‰‡æ—¶ï¼Œä½ å¯ä»¥åˆ†æƒ…å†µå¯¹å›¾ç‰‡è¿›è¡Œè®¾ç½®ã€‚æ¯”å¦‚ï¼š\n1ã€å¯¹æœ¬åœ°ä½ç½®çš„å›¾ç‰‡ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªä¸Šä¼ è§„åˆ™ï¼šå¤åˆ¶åˆ°æŒ‡å®šè·¯å¾„æˆ–è€…æ˜¯å½“å‰è·¯å¾„ä¸‹çš„ä¸€ä¸ªæ–‡ä»¶å¤¹ã€ä¸Šä¼ å›¾ç‰‡ã€‚\nå¦‚æœæ˜¯ç¼–å†™ä¸€ä¸ªæ–‡æ¡£ï¼Œæˆ‘ä»¬å°±è®¾ç½®æŠŠå›¾ç‰‡ä¿å­˜åˆ°æœ¬åœ°çš„ assets æ–‡ä»¶å¤¹å†…ï¼Œè¿™æ ·æ–¹ä¾¿ç®¡ç†ã€‚ å¦‚æœæ˜¯ç¼–å†™åšå®¢ï¼Œå›¾ç‰‡ä¸€èˆ¬æ˜¯é›†ä¸­ç®¡ç†çš„ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®å¤åˆ¶åˆ°ä¸€ä¸ªæŒ‡å®šè·¯å¾„ 2ã€ç±»ä¼¼çš„ï¼Œå¯¹ç½‘ç»œä½ç½®çš„å›¾ç‰‡ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸Šé¢çš„è§„åˆ™ã€‚\næ³¨æ„ï¼Œå¦‚æœå°†å›¾ç‰‡ä¿å­˜åˆ°æœ¬åœ°ç›®å½•ï¼Œåœ¨æ–‡ç« ä¸­å¼•ç”¨å›¾ç‰‡æ˜¯ä½¿ç”¨çš„ç›¸å¯¹æˆ–è€…ç»å¯¹è·¯å¾„ã€‚å¦‚æœåªæ˜¯åœ¨æœ¬åœ°æŸ¥çœ‹ï¼Œæ˜¯å¯ä»¥é¢„è§ˆå›¾ç‰‡çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœå°†åšå®¢ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œåˆ™å› ä¸ºè·¯å¾„é—®é¢˜å¯èƒ½ä¼šå‡ºç°æ— æ³•é¢„è§ˆå›¾ç‰‡çš„æƒ…å†µã€‚\næ‰€ä»¥ï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬éœ€è¦åšä¸€äº›ä¿®æ”¹ã€‚é€šå¸¸æˆ‘ä¼šè®¾ç½®å›¾ç‰‡å¤åˆ¶åˆ°åšå®¢çš„é™æ€é¡µé¢ç›®å½•ä¸‹é¢ï¼Œæ¯”å¦‚ï¼Œæˆ‘ç°åœ¨ä½¿ç”¨çš„æ˜¯ Hugo æ„å»ºé™æ€åšå®¢ï¼Œä¼šå°†å›¾ç‰‡ä¿å­˜åˆ° static/img ç›®å½•ä¸‹ï¼Œå¹¶ä¸”ï¼Œè¿˜éœ€è¦ä¿®æ”¹å›¾ç‰‡çš„ markdown å¼•ç”¨è·¯å¾„ä¸º /images/image-20220819124422239.png ï¼Œä»¥è¡¨ç¤ºç»å¯¹è·¯å¾„æŸ¥æ‰¾å›¾ç‰‡ï¼Œåœ¨åšå®¢æœåŠ¡å™¨ä¸Šå°±æ˜¯ç›¸å¯¹æ ¹åŸŸåç›®å½•å» img è·¯å¾„ä¸‹æŸ¥æ‰¾å›¾ç‰‡ã€‚å¾… hugo ç¼–è¯‘å®Œæˆä¸Šä¼ é™æ€æ–‡ä»¶åˆ°æœåŠ¡å™¨ä¹‹åï¼Œå¯ä»¥é€šè¿‡ https://blog.chensoul.cc/images/ åŠ ä¸Šå›¾ç‰‡åç§°çš„æ–¹å¼è®¿é—®åˆ°å›¾ç‰‡ã€‚\nä½†æ˜¯ï¼Œæ˜¾ç„¶ï¼Œè¿™æ—¶å€™åœ¨ Typora æ˜¯æ— æ³•é¢„è§ˆå›¾ç‰‡çš„ï¼Œå› ä¸ºåœ¨æœ¬åœ°æŸ¥æ‰¾ä¸åˆ°è¿™ä¸ªç»å¯¹è·¯å¾„åœ°å€ã€‚è¿™æ—¶å€™å¯ä»¥åœ¨ Typora é‡Œé¢è®¾ç½®ä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œæ“ä½œæ–¹æ³•æ˜¯ï¼Œåœ¨ æ˜¾ç¤º -\u0026gt; å›¾ç‰‡ -\u0026gt; å›¾åƒ -\u0026gt; è®¾ç½®å›¾ç‰‡æ ¹ç›®å½• é‡Œè¿›è¡Œè®¾ç½®ã€‚\nè®¾ç½®å®Œæˆä¹‹åï¼Œåœ¨å½“å‰æ–‡ä»¶çš„ md æ–‡ä»¶çš„é¡¶éƒ¨å…ƒæ•°æ®ä»£ç é‡Œä¼šå¤šä¸€è¡Œä»£ç ï¼š\ntitle: \u0026#34;åšå®¢ä¸­å¦‚ä½•ä½¿ç”¨å›¾åºŠæœåŠ¡\u0026#34; date: 2022-08-19T12:15:54+08:00 slug: using-images-in-blog categories: [æ—¥å¿—] tags: [hugo] draft: true typora-root-url: ../../static è¿™æ ·åšå®¢é‡Œæ‰€æœ‰çš„å›¾ç‰‡éƒ½ä¼šä¿å­˜çš„åšå®¢æœåŠ¡å™¨ï¼Œå¦‚æœåšå®¢è®¿é—®é‡å¢å¤§ï¼Œåˆ™å›¾ç‰‡åŠ è½½æ—¶é—´ä¼šå˜æ…¢ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦å°†å›¾ç‰‡è¿›è¡Œå‹ç¼©ï¼Œå¹¶ç»™åšå®¢è®¾ç½® CDN åŠ é€Ÿã€‚\nTypora å›¾ç‰‡ä¸Šä¼ åˆ°ç½‘ç»œ å°†å›¾ç‰‡ä¿å­˜åˆ°æœ¬åœ°ï¼Œå¾…åšå®¢é™æ€é¡µé¢éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šä¹‹åï¼Œå¯ä»¥å®ç°æ­£å¸¸é¢„è§ˆæƒ…å†µã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æŠŠ md æ–‡ä»¶æ‰“åŒ…ä¸Šä¼ åˆ°ä¸€äº›äº‘ç¬”è®°ï¼Œæ¯”å¦‚ï¼šè¯­é›€ï¼Œä½ ä¼šå‘ç°ä¸Šä¼ ä¹‹åä¼šå‡ºç°å›¾ç‰‡æ— æ³•é¢„è§ˆçš„æƒ…å†µã€‚\nè¿™æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å°†å›¾ç‰‡ä¸Šä¼ åˆ°ç½‘ç»œã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®‰è£… PicGoï¼Œç„¶åè®¾ç½®å›¾åºŠæœåŠ¡ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯ github ä½œä¸ºå›¾åºŠæ¥ä¿å­˜å›¾ç‰‡ï¼Œå¹¶ä½¿ç”¨ jsDelivr çš„ CDN æœåŠ¡è¿›è¡ŒåŠ é€Ÿè®¿é—®ã€‚\nå¦‚ä½•åˆ©ç”¨ Github æ­å»ºè‡ªå·±çš„å…è´¹å›¾åºŠï¼Ÿå¯ä»¥å‚è€ƒè¿™ç¯‡ æ–‡ç« ã€‚è¿™é‡Œï¼Œè®°å½•ä¸€ä¸‹æˆ‘çš„æ“ä½œæ­¥éª¤ã€‚\n1ã€ä½¿ç”¨åšå®¢çš„æ‰˜ç®¡ä»“åº“ çš„ static/img ç›®å½•æ¥ä¿å­˜å›¾ç‰‡ï¼Œè¿™æ ·æ–¹ä¾¿å›¾ç‰‡çš„ç®¡ç†ï¼ˆæ¯”å¦‚ï¼šå‹ç¼©ã€é‡å‘½åï¼Œåˆ é™¤æ— ç”¨å›¾ç‰‡ï¼‰ï¼Œå¦‚æœå›¾åºŠæœåŠ¡ä¸å¯ç”¨äº†ï¼Œæ‰€æœ‰åšå®¢å›¾ç‰‡è¿˜æœ‰ä¸€ä¸ªå¤‡ä»½ï¼Œåªéœ€è¦ä¿®æ”¹åšå®¢å†…å›¾ç‰‡çš„å¼•ç”¨åœ°å€ã€‚å‰ææ˜¯éœ€è¦å°†ä»“åº“è®¾ç½®ä¸º publicã€‚\n2ã€åœ¨ github è®¾ç½®é‡Œé¢åˆ›å»ºä¸€ä¸ª Tokenã€‚ä»¥æ­¤æ‰“å¼€ Settings -\u0026gt; Developer settings -\u0026gt; Personal access tokensï¼Œæœ€åç‚¹å‡» generate new token\n3ã€åœ¨ PicGo é‡Œè®¾ç½® github å›¾åºŠï¼š\nè®¾å®šä»“åº“åï¼šchensoul/blog.chensoul.cc\nè®¾å®šåˆ†æ”¯ï¼šmain\nè®¾å®š Tokenï¼šXXXXXXXXXXXXXXXXX\næŒ‡å®šå­˜å‚¨è·¯å¾„ï¼šstatic/images/\nè®¾ç½®è‡ªå®šä¹‰åŸŸåï¼šhttps://cdn.jsdelivr.net/gh/chensoul/blog.chensoul.cc\n4ã€éœ€è¦ä¿®æ”¹åšå®¢æ–‡ç« å†…å¼•ç”¨çš„å›¾ç‰‡åœ°å€ï¼Œå°† /images/ æ›¿æ¢ä¸º https://cdn.jsdelivr.net/gh/chensoul/blog.chensoul.cc/images/ ï¼Œå¯ä»¥ä½¿ç”¨è„šæœ¬æ‰¹é‡æ›¿æ¢ï¼š\ngrep -lr --null \u0026#39;](\\/img\\/\u0026#39; | xargs -0 sed -i \u0026#39;\u0026#39; \u0026#39;s/](\\/img\\//](https:\\/\\/cdn.jsdelivr.net\\/gh\\/chensoul\\/blog.chensoul.cc\\/static\\/img\\//g\u0026#39; å‚æ•°è¯´æ˜ï¼š\ngrep -i, --ignore-case æŸ¥æ‰¾æ–‡ä»¶æ—¶ä¸åŒºåˆ†å¤§å°å†™ -l, --files-with-matches è¿”å›æ–‡ä»¶å -R, -r, --recursive é€’å½’æœç´¢å­ç›®å½• sed -i é»˜è®¤ sed ä¼šæ‰“å°åˆ°æ ‡å‡†è¾“å‡ºï¼Œä½¿ç”¨ -i å°†ç›´æ¥åœ¨æ–‡ä»¶å†…ç¼–è¾‘æ›¿æ¢ s æ›¿æ¢ g å…¨å±€æ›¿æ¢æ ‡å¿— I å¤§å°å†™ä¸æ•æ„Ÿæ ‡å¿— åè¿‡æ¥ï¼ŒæŸ¥è¯¢ https://cdn.jsdelivr.net/gh/chensoul/blog.chensoul.cc/static/images/ ä¸‹çš„å›¾ç‰‡åœ°å€æ›¿æ¢ /img\ngrep -lr --null \u0026#39;](https://cdn.jsdelivr.net/gh/chensoul/blog.chensoul.cc/static/images/\u0026#39; | xargs -0 sed -i \u0026#39;\u0026#39; \u0026#39;s/](https:\\/\\/cdn.jsdelivr.net\\/gh\\/chensoul\\/blog.chensoul.cc\\/static\\/img\\//](\\/img\\//g\u0026#39; å¦å¤–ï¼Œåœ¨åšå®¢ç¼–è¯‘éƒ¨ç½²çš„æµç¨‹ä¹‹ä¸­ï¼Œå¯ä»¥å®šåˆ¶åŒ–ä¸€äº›æ­¥éª¤å°†åšå®¢åŒæ­¥å‘å¸ƒåˆ°å…¶ä»–ç³»ç»Ÿã€‚å½“ç„¶ï¼Œåœ¨å‘å¸ƒä¹‹å‰ï¼Œä¹Ÿå¯ä»¥å…ˆå°†æœ¬åœ°å›¾ç‰‡çš„ url æ›¿æ¢æˆå›¾åºŠåœ°å€çš„ urlã€‚ç­‰åç»­å®ç°äº†ï¼Œå†å‘å¸ƒä¸€ç¯‡æ–‡ç« ã€‚\nå¦‚æœ github æˆ–è€… jsdelivr æœåŠ¡ä¸ç¨³å®šï¼Œåˆ™éœ€è¦è€ƒè™‘ä½¿ç”¨å…¶ä»–å›¾åºŠäº†ã€‚\nå¯ä»¥é€šè¿‡è¿™ä¸ªåœ°å€ https://tcp.ping.pe/ æ¥æ£€æµ‹ IP æˆ–è€…åŸŸåæ˜¯å¦å¯ä»¥è®¿é—®\n","permalink":"https://blog.chensoul.cc/posts/2022/08/19/using-images-in-blog/","summary":"æœ€è¿‘ç¼–å†™æ–‡æ¡£æˆ–è€…å†™åšå®¢ï¼Œå–œæ¬¢ç”¨ Typora ç¼–è¾‘å™¨é€šè¿‡ Markdown è¯­æ³•å®Œæˆç¼–å†™æ‰€æœ‰å†…å®¹ã€‚ä¸ºæ­¤ï¼Œè¿˜ä»˜è´¹è´­ä¹°äº†è®¸å¯è¯ã€‚\nå–œæ¬¢ Typora çš„ç†ç”±ï¼š\næ‰€è§å³æ‰€å¾—çš„ç¼–è¾‘ï¼ŒMarkdown çš„è¯­æ³•éƒ½æ”¯æŒå¿«æ·é”®æ“ä½œï¼Œéå¸¸æ–¹ä¾¿\nå¯ä»¥è‡ªå®šä¹‰ä¸»é¢˜çš„ CSSï¼ŒåŒ…æ‹¬æ–‡ç« å†…å®¹å°±å¯ä»¥ç²˜è´´åˆ°å…¬ä¼—å·é‡Œ\nä¸Šä¼ å›¾ç‰‡ï¼Œæ”¯æŒå›¾åºŠæœåŠ¡ã€‚å¯ä»¥å°†å›¾ç‰‡ä¸Šä¼ åˆ°æŒ‡å®šçš„å›¾åºŠï¼Œå‰ææ˜¯éœ€è¦å…ˆå®‰è£…ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯ PicGoã€‚ç„¶åï¼ŒPicGo æ”¯æŒå¸¸è§çš„ä¸€äº›å›¾åºŠæœåŠ¡ã€‚\næ”¯æŒå¯¼å‡º\nTypora å›¾ç‰‡å¤åˆ¶åˆ°æœ¬åœ° æ¥ä¸‹æ¥ï¼ŒèŠèŠ Typora çš„å›¾ç‰‡ä¸Šä¼ è®¾ç½®ï¼š\nå½“ä½ æ’å…¥å›¾ç‰‡æ—¶ï¼Œä½ å¯ä»¥åˆ†æƒ…å†µå¯¹å›¾ç‰‡è¿›è¡Œè®¾ç½®ã€‚æ¯”å¦‚ï¼š\n1ã€å¯¹æœ¬åœ°ä½ç½®çš„å›¾ç‰‡ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªä¸Šä¼ è§„åˆ™ï¼šå¤åˆ¶åˆ°æŒ‡å®šè·¯å¾„æˆ–è€…æ˜¯å½“å‰è·¯å¾„ä¸‹çš„ä¸€ä¸ªæ–‡ä»¶å¤¹ã€ä¸Šä¼ å›¾ç‰‡ã€‚\nå¦‚æœæ˜¯ç¼–å†™ä¸€ä¸ªæ–‡æ¡£ï¼Œæˆ‘ä»¬å°±è®¾ç½®æŠŠå›¾ç‰‡ä¿å­˜åˆ°æœ¬åœ°çš„ assets æ–‡ä»¶å¤¹å†…ï¼Œè¿™æ ·æ–¹ä¾¿ç®¡ç†ã€‚ å¦‚æœæ˜¯ç¼–å†™åšå®¢ï¼Œå›¾ç‰‡ä¸€èˆ¬æ˜¯é›†ä¸­ç®¡ç†çš„ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®å¤åˆ¶åˆ°ä¸€ä¸ªæŒ‡å®šè·¯å¾„ 2ã€ç±»ä¼¼çš„ï¼Œå¯¹ç½‘ç»œä½ç½®çš„å›¾ç‰‡ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸Šé¢çš„è§„åˆ™ã€‚\næ³¨æ„ï¼Œå¦‚æœå°†å›¾ç‰‡ä¿å­˜åˆ°æœ¬åœ°ç›®å½•ï¼Œåœ¨æ–‡ç« ä¸­å¼•ç”¨å›¾ç‰‡æ˜¯ä½¿ç”¨çš„ç›¸å¯¹æˆ–è€…ç»å¯¹è·¯å¾„ã€‚å¦‚æœåªæ˜¯åœ¨æœ¬åœ°æŸ¥çœ‹ï¼Œæ˜¯å¯ä»¥é¢„è§ˆå›¾ç‰‡çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœå°†åšå®¢ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œåˆ™å› ä¸ºè·¯å¾„é—®é¢˜å¯èƒ½ä¼šå‡ºç°æ— æ³•é¢„è§ˆå›¾ç‰‡çš„æƒ…å†µã€‚\næ‰€ä»¥ï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬éœ€è¦åšä¸€äº›ä¿®æ”¹ã€‚é€šå¸¸æˆ‘ä¼šè®¾ç½®å›¾ç‰‡å¤åˆ¶åˆ°åšå®¢çš„é™æ€é¡µé¢ç›®å½•ä¸‹é¢ï¼Œæ¯”å¦‚ï¼Œæˆ‘ç°åœ¨ä½¿ç”¨çš„æ˜¯ Hugo æ„å»ºé™æ€åšå®¢ï¼Œä¼šå°†å›¾ç‰‡ä¿å­˜åˆ° static/img ç›®å½•ä¸‹ï¼Œå¹¶ä¸”ï¼Œè¿˜éœ€è¦ä¿®æ”¹å›¾ç‰‡çš„ markdown å¼•ç”¨è·¯å¾„ä¸º /images/image-20220819124422239.png ï¼Œä»¥è¡¨ç¤ºç»å¯¹è·¯å¾„æŸ¥æ‰¾å›¾ç‰‡ï¼Œåœ¨åšå®¢æœåŠ¡å™¨ä¸Šå°±æ˜¯ç›¸å¯¹æ ¹åŸŸåç›®å½•å» img è·¯å¾„ä¸‹æŸ¥æ‰¾å›¾ç‰‡ã€‚å¾… hugo ç¼–è¯‘å®Œæˆä¸Šä¼ é™æ€æ–‡ä»¶åˆ°æœåŠ¡å™¨ä¹‹åï¼Œå¯ä»¥é€šè¿‡ https://blog.chensoul.cc/images/ åŠ ä¸Šå›¾ç‰‡åç§°çš„æ–¹å¼è®¿é—®åˆ°å›¾ç‰‡ã€‚\nä½†æ˜¯ï¼Œæ˜¾ç„¶ï¼Œè¿™æ—¶å€™åœ¨ Typora æ˜¯æ— æ³•é¢„è§ˆå›¾ç‰‡çš„ï¼Œå› ä¸ºåœ¨æœ¬åœ°æŸ¥æ‰¾ä¸åˆ°è¿™ä¸ªç»å¯¹è·¯å¾„åœ°å€ã€‚è¿™æ—¶å€™å¯ä»¥åœ¨ Typora é‡Œé¢è®¾ç½®ä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œæ“ä½œæ–¹æ³•æ˜¯ï¼Œåœ¨ æ˜¾ç¤º -\u0026gt; å›¾ç‰‡ -\u0026gt; å›¾åƒ -\u0026gt; è®¾ç½®å›¾ç‰‡æ ¹ç›®å½• é‡Œè¿›è¡Œè®¾ç½®ã€‚\nè®¾ç½®å®Œæˆä¹‹åï¼Œåœ¨å½“å‰æ–‡ä»¶çš„ md æ–‡ä»¶çš„é¡¶éƒ¨å…ƒæ•°æ®ä»£ç é‡Œä¼šå¤šä¸€è¡Œä»£ç ï¼š\ntitle: \u0026#34;åšå®¢ä¸­å¦‚ä½•ä½¿ç”¨å›¾åºŠæœåŠ¡\u0026#34; date: 2022-08-19T12:15:54+08:00 slug: using-images-in-blog categories: [æ—¥å¿—] tags: [hugo] draft: true typora-root-url: ../../static è¿™æ ·åšå®¢é‡Œæ‰€æœ‰çš„å›¾ç‰‡éƒ½ä¼šä¿å­˜çš„åšå®¢æœåŠ¡å™¨ï¼Œå¦‚æœåšå®¢è®¿é—®é‡å¢å¤§ï¼Œåˆ™å›¾ç‰‡åŠ è½½æ—¶é—´ä¼šå˜æ…¢ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦å°†å›¾ç‰‡è¿›è¡Œå‹ç¼©ï¼Œå¹¶ç»™åšå®¢è®¾ç½® CDN åŠ é€Ÿã€‚\nTypora å›¾ç‰‡ä¸Šä¼ åˆ°ç½‘ç»œ å°†å›¾ç‰‡ä¿å­˜åˆ°æœ¬åœ°ï¼Œå¾…åšå®¢é™æ€é¡µé¢éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šä¹‹åï¼Œå¯ä»¥å®ç°æ­£å¸¸é¢„è§ˆæƒ…å†µã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æŠŠ md æ–‡ä»¶æ‰“åŒ…ä¸Šä¼ åˆ°ä¸€äº›äº‘ç¬”è®°ï¼Œæ¯”å¦‚ï¼šè¯­é›€ï¼Œä½ ä¼šå‘ç°ä¸Šä¼ ä¹‹åä¼šå‡ºç°å›¾ç‰‡æ— æ³•é¢„è§ˆçš„æƒ…å†µã€‚\nè¿™æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å°†å›¾ç‰‡ä¸Šä¼ åˆ°ç½‘ç»œã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®‰è£… PicGoï¼Œç„¶åè®¾ç½®å›¾åºŠæœåŠ¡ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯ github ä½œä¸ºå›¾åºŠæ¥ä¿å­˜å›¾ç‰‡ï¼Œå¹¶ä½¿ç”¨ jsDelivr çš„ CDN æœåŠ¡è¿›è¡ŒåŠ é€Ÿè®¿é—®ã€‚\nå¦‚ä½•åˆ©ç”¨ Github æ­å»ºè‡ªå·±çš„å…è´¹å›¾åºŠï¼Ÿå¯ä»¥å‚è€ƒè¿™ç¯‡ æ–‡ç« ã€‚è¿™é‡Œï¼Œè®°å½•ä¸€ä¸‹æˆ‘çš„æ“ä½œæ­¥éª¤ã€‚\n1ã€ä½¿ç”¨åšå®¢çš„æ‰˜ç®¡ä»“åº“ çš„ static/img ç›®å½•æ¥ä¿å­˜å›¾ç‰‡ï¼Œè¿™æ ·æ–¹ä¾¿å›¾ç‰‡çš„ç®¡ç†ï¼ˆæ¯”å¦‚ï¼šå‹ç¼©ã€é‡å‘½åï¼Œåˆ é™¤æ— ç”¨å›¾ç‰‡ï¼‰ï¼Œå¦‚æœå›¾åºŠæœåŠ¡ä¸å¯ç”¨äº†ï¼Œæ‰€æœ‰åšå®¢å›¾ç‰‡è¿˜æœ‰ä¸€ä¸ªå¤‡ä»½ï¼Œåªéœ€è¦ä¿®æ”¹åšå®¢å†…å›¾ç‰‡çš„å¼•ç”¨åœ°å€ã€‚å‰ææ˜¯éœ€è¦å°†ä»“åº“è®¾ç½®ä¸º publicã€‚\n2ã€åœ¨ github è®¾ç½®é‡Œé¢åˆ›å»ºä¸€ä¸ª Tokenã€‚ä»¥æ­¤æ‰“å¼€ Settings -\u0026gt; Developer settings -\u0026gt; Personal access tokensï¼Œæœ€åç‚¹å‡» generate new token","title":"åšå®¢ä¸­å¦‚ä½•ä½¿ç”¨å›¾åºŠæœåŠ¡"},{"content":"è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œä½œä¸ºç¨‹åºå‘˜ï¼Œé¦–å…ˆè¦åšå¾—ç¬¬ä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯é…ç½®å¥½å¼€å‘ç¯å¢ƒï¼Œå› ä¸ºæˆ‘ä½¿ç”¨çš„æ˜¯ Mac å¼€å‘ç¯å¢ƒï¼Œæ‰€ä»¥ï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯åŸºäº Mac æ“ä½œç³»ç»Ÿï¼Œè®°å½•å¼€å‘ç¯å¢ƒæ­å»ºè¿‡ç¨‹ã€‚\nç³»ç»Ÿè®¾ç½® dotfile é…ç½® ä¸‹è½½ dotfile æ–‡ä»¶ï¼š\ngit clone git@github.com:chensoul/snippets.git æ‹·è´åˆ°ç”¨æˆ·ç›®å½•ï¼š\ncd dotfiles sh bootstrap.sh macos ç³»ç»Ÿè®¾ç½®ï¼š\n. .macos å®‰è£…è½¯ä»¶ å®‰è£… brewã€nvs sh install.sh å®‰è£… MySQL å®‰è£… MySQLï¼š\n# æœç´¢å¯ä»¥å®‰è£…çš„ç‰ˆæœ¬ âœ brew search mysql # å®‰è£…å¯¹åº”çš„ç‰ˆæœ¬ âœ brew install mysql@5.7 # å†™å…¥ç¯å¢ƒå˜é‡ echo \u0026#39;export PATH=\u0026#34;/opt/homebrew/opt/mysql@5.7/bin:$PATH\u0026#34;\u0026#39; \u0026gt;\u0026gt; ~/.zshrc # ä¸ºäº†è®©ç¼–è¯‘å™¨æ‰¾åˆ° mysql@5.7 è¿˜éœ€è¦å†™å…¥ echo \u0026#39;export LDFLAGS=\u0026#34;-L/opt/homebrew/opt/mysql@5.7/lib\u0026#34;\u0026#39; \u0026gt;\u0026gt; ~/.zshrc echo \u0026#39;export CPPFLAGS=\u0026#34;-I/opt/homebrew/opt/mysql@5.7/include\u0026#34;\u0026#39; \u0026gt;\u0026gt; ~/.zshrc # ä¸ºäº†è®© pkg-config æ‰¾åˆ° mysql@5.7 è¿˜éœ€è¦å†™å…¥ echo \u0026#39;PKG_CONFIG_PATH=\u0026#34;/opt/homebrew/opt/mysql@5.7/lib/pkgconfig\u0026#34;\u0026#39; \u0026gt;\u0026gt; ~/.zshrc MySQL æœåŠ¡ç›¸å…³ï¼š\n# æŸ¥çœ‹ MySQL æœåŠ¡çŠ¶æ€ âœ brew services info mysql@5.7 âœ mysql.server status # å¯åŠ¨ MySQL æœåŠ¡ âœ brew services start mysql@5.7 âœ mysql.server start # é‡å¯ MySQL æœåŠ¡ âœ brew services restart mysql@5.7 âœ mysql.server restart # åœæ­¢ MySQL æœåŠ¡ âœ brew services stop mysql@5.7 âœ mysql.server stop æ¥ç€åˆå§‹åŒ– MySQL è®¾ç½®ï¼Œä¸»è¦é…ç½®ä¸€ä¸‹ root å¯†ç å·²ç»æ˜¯å¦è¿œç¨‹ç™»å½•ç™»ï¼Œæ ¹æ®æç¤ºæ¥æ“ä½œå°±è¡Œäº†ï¼š\nmysql_secure_installation æ•°æ®åº“å¤–è¿ï¼Œè¿™æ˜¯ä¸ªå¯é€‰æ“ä½œ æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µè‡ªè¡Œå†³å®šæ˜¯å¦å¼€å¯ï¼ˆæœ‰è¢«æ”»å‡»çš„é£é™©ï¼‰ï¼š\nmysql \u0026gt; grant all on *.* to root@\u0026#39;%\u0026#39; identified by \u0026#39;ä½ è®¾ç½®çš„å¯†ç \u0026#39; with grant option; mysql \u0026gt; flush privileges; å®‰è£… Redis # å®‰è£… redis âœ brew install redis # æŸ¥çœ‹ redis æœåŠ¡çŠ¶æ€ âœ brew services info redis # å¯åŠ¨ redis æœåŠ¡ç«¯ âœ brew services start redis # å¯åŠ¨ redis å®¢æˆ·ç«¯ âœ redis-cli # ç¼–è¾‘é»˜è®¤é…ç½®æ–‡ä»¶ âœ sudo vim /opt/homebrew/etc/redis.conf ç³»ç»Ÿå¤‡ä»½ 1ã€å¤‡ä»½ maven ä»“åº“ï¼š\nzip -r m2.zip ~/.m2 2ã€å¤‡ä»½ä»£ç ç©ºé—´\nfind ~/workspace -type d -name \u0026#34;target\u0026#34; -exec rm -rf {} + zip -r workspace.zip ~/workspace ","permalink":"https://blog.chensoul.cc/posts/2021/09/09/mac-development-environment-setup/","summary":"è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œä½œä¸ºç¨‹åºå‘˜ï¼Œé¦–å…ˆè¦åšå¾—ç¬¬ä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯é…ç½®å¥½å¼€å‘ç¯å¢ƒï¼Œå› ä¸ºæˆ‘ä½¿ç”¨çš„æ˜¯ Mac å¼€å‘ç¯å¢ƒï¼Œæ‰€ä»¥ï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯åŸºäº Mac æ“ä½œç³»ç»Ÿï¼Œè®°å½•å¼€å‘ç¯å¢ƒæ­å»ºè¿‡ç¨‹ã€‚\nç³»ç»Ÿè®¾ç½® dotfile é…ç½® ä¸‹è½½ dotfile æ–‡ä»¶ï¼š\ngit clone git@github.com:chensoul/snippets.git æ‹·è´åˆ°ç”¨æˆ·ç›®å½•ï¼š\ncd dotfiles sh bootstrap.sh macos ç³»ç»Ÿè®¾ç½®ï¼š\n. .macos å®‰è£…è½¯ä»¶ å®‰è£… brewã€nvs sh install.sh å®‰è£… MySQL å®‰è£… MySQLï¼š\n# æœç´¢å¯ä»¥å®‰è£…çš„ç‰ˆæœ¬ âœ brew search mysql # å®‰è£…å¯¹åº”çš„ç‰ˆæœ¬ âœ brew install mysql@5.7 # å†™å…¥ç¯å¢ƒå˜é‡ echo \u0026#39;export PATH=\u0026#34;/opt/homebrew/opt/mysql@5.7/bin:$PATH\u0026#34;\u0026#39; \u0026gt;\u0026gt; ~/.zshrc # ä¸ºäº†è®©ç¼–è¯‘å™¨æ‰¾åˆ° mysql@5.7 è¿˜éœ€è¦å†™å…¥ echo \u0026#39;export LDFLAGS=\u0026#34;-L/opt/homebrew/opt/mysql@5.7/lib\u0026#34;\u0026#39; \u0026gt;\u0026gt; ~/.zshrc echo \u0026#39;export CPPFLAGS=\u0026#34;-I/opt/homebrew/opt/mysql@5.7/include\u0026#34;\u0026#39; \u0026gt;\u0026gt; ~/.zshrc # ä¸ºäº†è®© pkg-config æ‰¾åˆ° mysql@5.7 è¿˜éœ€è¦å†™å…¥ echo \u0026#39;PKG_CONFIG_PATH=\u0026#34;/opt/homebrew/opt/mysql@5.7/lib/pkgconfig\u0026#34;\u0026#39; \u0026gt;\u0026gt; ~/.zshrc MySQL æœåŠ¡ç›¸å…³ï¼š\n# æŸ¥çœ‹ MySQL æœåŠ¡çŠ¶æ€ âœ brew services info mysql@5.7 âœ mysql.server status # å¯åŠ¨ MySQL æœåŠ¡ âœ brew services start mysql@5.7 âœ mysql.server start # é‡å¯ MySQL æœåŠ¡ âœ brew services restart mysql@5.","title":"Macå¼€å‘ç¯å¢ƒé…ç½®"},{"content":"ä»é›¶å¼€å§‹æ­å»ºåšå®¢ï¼ŒåŒ…æ‹¬æ³¨å†ŒåŸŸåã€è´­ä¹°æœåŠ¡å™¨ã€éƒ¨ç½²ç¨‹åºåŠç½‘ç«™é…ç½®å’Œä¼˜åŒ–ã€‚\nåŸŸå æ­å»ºä¸€ä¸ªåšå®¢æˆ–è€…ç½‘ç«™ï¼Œéœ€è¦æœ‰ä¸€ä¸ªåŸŸåã€‚é‚£ä»€ä¹ˆæ˜¯åŸŸåå‘¢ï¼Ÿçœ‹çœ‹ç™¾åº¦ç™¾ç§‘ä¸Šçš„è§£é‡Šï¼š\nåŸŸåï¼ˆè‹±è¯­ï¼šDomain Nameï¼‰ï¼Œåˆç§°ç½‘åŸŸï¼Œæ˜¯ç”±ä¸€ä¸²ç”¨ç‚¹åˆ†éš”çš„åå­—ç»„æˆçš„Internetä¸ŠæŸä¸€å°è®¡ç®—æœºæˆ–è®¡ç®—æœºç»„çš„åç§°ï¼Œç”¨äºåœ¨æ•°æ®ä¼ è¾“æ—¶å¯¹è®¡ç®—æœºçš„å®šä½æ ‡è¯†ï¼ˆæœ‰æ—¶ä¹ŸæŒ‡åœ°ç†ä½ç½®ï¼‰ã€‚\nç”±äºIP åœ°å€å…·æœ‰ä¸æ–¹ä¾¿è®°å¿†å¹¶ä¸”ä¸èƒ½æ˜¾ç¤ºåœ°å€ç»„ç»‡çš„åç§°å’Œæ€§è´¨ç­‰ç¼ºç‚¹ï¼Œäººä»¬è®¾è®¡å‡ºäº†åŸŸåï¼Œå¹¶é€šè¿‡ç½‘åŸŸåç§°ç³»ç»Ÿï¼ˆDNSï¼ŒDomain Name Systemï¼‰æ¥å°†åŸŸåå’ŒIP åœ°å€ç›¸äº’æ˜ å°„ï¼Œä½¿äººæ›´æ–¹ä¾¿åœ°è®¿é—®äº’è”ç½‘ï¼Œè€Œä¸ç”¨å»è®°ä½èƒ½å¤Ÿè¢«æœºå™¨ç›´æ¥è¯»å–çš„IP åœ°å€æ•°ä¸²ã€‚\nç®€å•æ¥è¯´ï¼ŒIP åœ°å€å¯ä»¥æ ‡è¯†ä¸€å°è®¡ç®—æœºï¼Œä½†æ˜¯ä¸å®¹æ˜“è®°å¿†ï¼Œæ‰€ä»¥ï¼Œè®¾è®¡å‡ºäº†åŸŸåã€‚è€ŒåŸŸåå°±æ˜¯æ ‡è¯†å› ç‰¹ç½‘ä¸Šçš„ä¸€å°è®¡ç®—æœºï¼Œç”±ç½‘åŸŸåç§°ç³»ç»Ÿ DNS æ¥å®ŒæˆåŸŸåå’Œ IP ä¹‹é—´çš„æ˜ å°„ã€‚\nå¦‚ä½•æ³¨å†ŒåŸŸåï¼Ÿæœ‰å¾ˆå¤šç½‘ç«™æä¾›åŸŸåæ³¨å†ŒæœåŠ¡ï¼Œæ¯”å¦‚å›½å†…çš„ï¼š\né˜¿é‡Œäº‘ è…¾è®¯äº‘ åä¸ºäº‘ å›½å¤–çš„ï¼š\nGoDaddy Namecheap Amazon æ³¨å†ŒåŸŸåçš„å»ºè®®ï¼š\n1ã€å»ºè®®åœ¨æ­£è§„ã€å‡ºåçš„ç½‘ç«™æ³¨å†ŒåŸŸåï¼Œé˜²æ­¢ç½‘ç«™è·‘è·¯ã€‚æˆ‘æ›¾ç»åœ¨ä¸€ä¸ªå°ç½‘ç«™æ³¨å†Œäº†ä¸€ä¸ªåŸŸåï¼Œä½¿ç”¨äº†å‡ å¹´ä¹‹åï¼Œç»­æœŸçš„æ—¶å€™ï¼Œè”ç³»ä¸ä¸Šå¯¹æ–¹ï¼Œå¯¼è‡´æ— æ³•ä½¿ç”¨è¯¥åŸŸåï¼Œç”šè‡³è¯¥åŸŸåè¢«åˆ«äººæŠ¢æ³¨å†Œäº†ã€‚ 2ã€åœ¨å›½å†…ç½‘ç«™æ³¨å†ŒåŸŸåï¼Œéƒ½éœ€è¦å¤‡æ¡ˆã€‚å¦‚æœä¸æƒ³å¤‡æ¡ˆï¼Œè¯·åœ¨å›½å¤–ç½‘ç«™æ³¨å†ŒåŸŸåã€‚æˆ‘çš„åŸŸå chensoul.cc å°±æ˜¯åœ¨äºšé©¬é€Šä¸Šæ³¨å†Œçš„ã€‚ä¸€æ˜¯ä¸æƒ³å¤‡æ¡ˆï¼ŒäºŒæ˜¯å¯¹æ¯”äº†ä¸Šé¢å‡ ä¸ªç½‘ç«™ï¼Œå‘ç°äºšé©¬é€Šä¸Šçš„ com åŸŸåä»·æ ¼ç›¸å¯¹ä¾¿å®œï¼Œæ‰€ä»¥ä¸€æ¬¡æ€§è´­ä¹°äº† 5 å¹´ã€‚ 3ã€å»ºè®®ä¼˜å…ˆæ³¨å†Œ com åŸŸåï¼ŒåŸŸåå°½å¯èƒ½çš„ç®€çŸ­å¹¶ä¸”æ–¹ä¾¿è®°å¿†ã€‚ æˆ‘æ›¾ç»æ³¨å†Œè¿‡çš„åŸŸåï¼š\njavachen.comã€javachen.spaceã€javachen.xyz huaiu.com æœåŠ¡å™¨ æ³¨å†Œäº†åŸŸåä¹‹åï¼Œéœ€è¦ä¸€å°æœåŠ¡å™¨è¿è¡Œç¨‹åºã€‚æœåŠ¡å™¨å¯ä»¥æ˜¯ä¸€å°ç‰©ç†æœºï¼Œæ¯”å¦‚ä½ å¯ä»¥ä½¿ç”¨è‡ªå·±çš„ç”µè„‘ä½œä¸ºæœåŠ¡å™¨ï¼›ä¹Ÿå¯ä»¥æ˜¯ä¸€å°è™šæ‹Ÿçš„äº‘æœåŠ¡å™¨ï¼Œæ¯”å¦‚åœ¨äº‘æœåŠ¡æä¾›å•†è´­ä¹°ä¸€å°ç‹¬ç«‹çš„æœåŠ¡å™¨ï¼›ä¹Ÿå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹æä¾›çš„æœåŠ¡å™¨ç©ºé—´ï¼Œæ¯”å¦‚ Github ä¸Šå¯ä»¥éƒ¨ç½²é™æ€ç¨‹åºã€‚ä¸ç®¡å“ªç§æ–¹å¼ï¼ŒæœåŠ¡å™¨éƒ½éœ€è¦æœ‰ä¸€ä¸ªå…¬ç½‘ IPï¼Œè¿™æ ·æ‰èƒ½åœ¨å› ç‰¹ç½‘ä¸Šè®¿é—®ä½ æœåŠ¡å™¨ä¸Šéƒ¨ç½²çš„ç¨‹åºã€‚æœ‰äº†æœåŠ¡å™¨ä¹‹åï¼Œå°±å¯ä»¥ç»™æœåŠ¡å™¨å…¬ç½‘ IP è®¾ç½®åŸŸåè§£æã€‚\næˆ‘çš„æœåŠ¡å™¨æ˜¯åœ¨æ¬ç“¦å·¥è´­ä¹°çš„ï¼Œä¸€å¹´ 49.99 ç¾å…ƒã€‚\nç¨‹åº å®‰è£… Hugo åœ¨ Mac ä¸‹å®‰è£… Hugoï¼š\nbrew install hugo æ–°å»ºç«™ç‚¹ hugo new site chensoul.github.io -y yaml ä¸Šè¿°å‘½ä»¤ä¼šç”Ÿæˆä¸€ä¸ªåä¸º chensoul.github.io çš„æ–‡ä»¶å¤¹ï¼Œä¸‹é¢å¯¹æ–‡ä»¶å¤¹ç»“æ„åšä¸ªè¯´æ˜ï¼š\n$ tree chensoul.github.io chensoul.github.io â”œâ”€â”€ archetypes â”‚ â””â”€â”€ default.md â”œâ”€â”€ config.yaml â”œâ”€â”€ content â”œâ”€â”€ data â”œâ”€â”€ layouts â”œâ”€â”€ static â””â”€â”€ themes 6 directories, 2 files æ–°å»ºçš„ç«™ç‚¹ï¼Œè¿˜æ²¡æœ‰åŠ å…¥ Git ç‰ˆæœ¬ç®¡ç†ï¼Œè¿›å…¥åˆ°è¿™ä¸ªç›®å½•ä¸‹ï¼Œæ‰§è¡Œä¸€ä¸‹å¦‚ä¸‹å‘½ä»¤ï¼Œå®Œæˆ Git Repo çš„åˆå§‹åŒ–ï¼š\ncd chensoul.github.io git init . æ–°å»ºç«™ç‚¹åï¼Œæˆ‘ä»¬å¼€å§‹æ·»åŠ ä¸»é¢˜ã€‚\næ·»åŠ ä¸»é¢˜ åœ¨ Hugo çš„å®˜ç½‘ä¸Š Hugo Themes æœ‰éå¸¸éå¸¸å¤šçš„ä¸»é¢˜ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„å–œå¥½é€‰æ‹©ä¸€ä¸ªä¸»é¢˜ã€‚è¿™é‡Œï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ hugo-theme-den ä¸»é¢˜ã€‚\nä½¿ç”¨ git submodule\u0026ndash;helper ä¸‹è½½ä¸»é¢˜åˆ° theme ç›®å½•ä¸‹ï¼š\ngit submodule--helper add https://github.com/shaform/hugo-theme-den themes/den --depth=1 git submodule--helper update --init --recursive # needed when you reclone your repo (submodules may not get cloned automatically) ä»¥åï¼Œå½“ä¸»é¢˜æœ‰æ›´æ–°æ—¶ï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤æ›´æ–°ï¼š\ngit submodule update --remote --merge å¦‚æœé‡åˆ°å¼‚å¸¸ï¼Œå¯ä»¥å‚è€ƒæ–‡ç« è§£å†³ã€‚\nfatal: remote error: upload-pack: not our ref fc7223ca00124e8f5b5b354457379071e2fd091b å¯åŠ¨ å¯åŠ¨é¢„è§ˆï¼š\nhugo server é»˜è®¤æ˜¯ 1313 ç«¯å£å·ï¼Œåœ¨æµè§ˆå™¨ä¸­ç›´æ¥è®¿é—® http://localhost:1313/ å°±å¯ä»¥è®¿é—®åˆ°æ–°å»ºçš„åšå®¢äº†ã€‚\nå®šåˆ¶åŒ– ç«™ç‚¹ä¿¡æ¯ é…ç½®ç½‘ç«™çš„åŸºæœ¬ä¿¡æ¯ï¼Œå°† config.yaml ä¿®æ”¹å¦‚ä¸‹ï¼š\nbaseURL: https://blog.chensoul.cc/ title: ChenSoul theme: den enableRobotsTXT: true enableEmoji: true hasCJKLanguage: true preserveTaxonomyNames: true rssLimit: 100 page_view_conter: true enableRelated: true # Copyright, appears in the footer # copyright = \u0026#34;\u0026#34; # default: author.name # Pagination # number of entries per page for archives, tags and categories # since we don\u0026#39;t have list view, recommend a large value paginate: 20 paginatePath: \u0026#34;page\u0026#34; # Syntax Hightlight PygmentsCodeFences: true PygmentsUseClasses: true # required for shhighlight shortcode # service plugins disqusShortname: \u0026#34;\u0026#34; # disqus_shortname googleAnalytics: \u0026#34;\u0026#34; # UA-XXXXXXXX-X # language support # en / zh / other... translations present in i18n/ defaultContentLanguage: \u0026#34;zh\u0026#34; # Default language to use defaultContentLanguageInSubdir: true permalinks: posts: /posts/:slug/ categories: /categories/:slug/ tags: /tags/:slug/ pages: /:slug/ author: name: chensoul sitemap: changefreq: weekly priority: 0.5 filename: sitemap.xml params: since: \u0026#34;2020\u0026#34; rssFullContent: true keywords: - devops - programming description: Programming | Devops logoTitle: ChenSoul siteLogoImage: images/fly.png # headerTitle = \u0026#34;chensoul\u0026#34; # default: title headerImage: images/background.webp showAuthorCard: true showMenuLanguages: true autoLoadComments: false paginateOriginalStyle: true # The date format to use; for a list of valid formats, see https://gohugo.io/functions/format/ dateFormatToUse: 2006-01-02 google_verification: \u0026#34;D8XBzUhT4irNUQLKut79HFni0v3Xow4FY-oxUcsUlVk\u0026#34; # Link custom CSS and JS assets # (relative to /static/css and /static/js respectively) customCSS: [] customJS: [] markup: goldmark: renderer: unsafe: true # ------------------------------------- # # ---- Related Articles --------------- # # ------------------------------------- # related: # Only include matches with rank \u0026gt;= threshold. This is a normalized rank between 0 and 100. threshold: 50 # To get stable \u0026#34;See also\u0026#34; sections we, by default, exclude newer related pages. includeNewer: true # Will lower case keywords in both queries and in the indexes. toLower: true indices: - name: categories weight: 200 - name: keywords weight: 150 - name: tags weight: 100 languages: zh: languageCode: zh languageName: ä¸­æ–‡ contentDir: content weight: 1 params: description: Devops | Programming menu: main: - name: æ€è€ƒ weight: 10 identifier: idea url: categories/idea/ social: - name: Telegram weight: 10 identifier: telegram url: https://t.me/chensoul_share - name: Twitter weight: 20 identifier: twitter url: https://twitter.com/chensoul_eth - name: BiliBili weight: 40 identifier: bilibili url: https://space.bilibili.com/699805065/ links: - name: GitHub weight: 10 identifier: github url: https://github.com/chensoul - name: Services weight: 20 identifier: services-status url: https://uptime.chensoul.cc/status/services - name: Analytics weight: 30 identifier: chensoul-analytics url: https://data.chensoul.cc/share/8YKX7FUa/pseudoyu-blog éƒ¨ç½² GitHub Actions éƒ¨ç½² 1ã€é¦–å…ˆåœ¨ github é‡Œåˆ›å»ºä¸€ä¸ªä»“åº“ï¼šchensoul.github.io\n2ã€å°†æœ¬åœ°æ–‡ä»¶æäº¤åˆ° github\ncd chensoul.github.io git init . echo \u0026#34;# chensoul.github.io\u0026#34; \u0026gt;\u0026gt; README.md git remote add origin git@github.com:chensoul/chensoul.github.io.git 3ã€å°†æœ¬åœ°ä»£ç æ¨é€åˆ°ä»“åº“\ngit commit -m \u0026#34;first commit\u0026#34; git push -u origin main 4ã€åˆ›å»º GitHub Actions çš„ workflow\nmkdir -p .github/workflows touch .github/workflows/gh-page.yml gh-page.yml å†…å®¹å¦‚ä¸‹ï¼š\nname: github pages on: workflow_dispatch: push: branches: - hugo jobs: deploy: runs-on: ubuntu-18.04 timeout-minutes: 3 steps: - name: Checkout uses: actions/checkout@v2 with: submodules: true # Fetch Hugo themes (true OR recursive) fetch-depth: 0 # Fetch all history for .GitInfo and .Lastmod - name: Setup hugo uses: peaceiris/actions-hugo@v2 with: hugo-version: latest extended: true - name: Build web run: hugo --minify - name: Deploy uses: peaceiris/actions-gh-pages@v3 with: github_token: ${{ secrets.GITHUB_TOKEN }} publish_branch: gh-pages publish_dir: ./public ä¸Šé¢çš„å·¥ä½œæµæ˜¯åœ¨ gh-pages åˆ†æ”¯ä¸Šè§¦å‘ï¼Œå½“æœ‰ä»£ç æäº¤æ—¶å€™ï¼Œä¼šè¿è¡Œ hugo å‘½ä»¤ç”Ÿæˆé™æ€æ–‡ä»¶ï¼ˆpublic ç›®å½•ï¼‰ï¼Œå¹¶ä¸”å°†ä»–ä»¬æ¨é€åˆ° main åˆ†æ”¯ã€‚\næ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦åŸºäºå½“å‰åˆ†æ”¯åˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯ gh-pages ï¼Œå¹¶ä¸”æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼š\ngit branch gh-pages git checkout gh-pages git push origin gh-pages 5ã€ä¿®æ”¹ä»£ç ï¼Œæ¨é€åˆ°ä»“åº“ï¼Œè§¦å‘å·¥ä½œæµ\nåœ¨æœ¬åœ°ä¿®æ”¹æŸä¸ªæ–‡ä»¶ï¼Œæäº¤ä»£ç ï¼Œç„¶ååœ¨ github ç½‘ç«™ æŸ¥çœ‹å·¥ä½œæµ\ngit push origin gh-pages 7ã€è®¾ç½®è‡ªå®šä¹‰åŸŸå\nå‚è€ƒç®¡ç† GitHub Pages ç«™ç‚¹çš„è‡ªå®šä¹‰åŸŸï¼Œæ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰åŸŸåï¼šblog.chensoul.ccï¼š\næˆ–è€…ï¼Œåœ¨ä»“åº“çš„ static ç›®å½•åˆ›å»ºä¸€ä¸ª CNAME æ–‡ä»¶ï¼Œå†…å®¹ä¸ºï¼šblog.chensoul.ccï¼Œç„¶åï¼Œä¿å­˜æäº¤ï¼ŒGithub Actions ä¼šå°†è¯¥æ–‡ä»¶æ¨é€åˆ° main åˆ†æ”¯ã€‚\nç„¶åï¼Œåœ¨äºšé©¬é€Šç½‘ç«™æ·»åŠ  CNAME è®°å½•ï¼š\n8ã€éƒ¨ç½²åˆ° CloudFlare Pages\nå‚è€ƒ ä» GitHub Pages è¿ç§»åˆ° CloudFlare Pages çš„ä½“éªŒä¸è¸©å‘å°è®°\n","permalink":"https://blog.chensoul.cc/posts/2021/09/09/build-personal-blog-from-zero/","summary":"ä»é›¶å¼€å§‹æ­å»ºåšå®¢ï¼ŒåŒ…æ‹¬æ³¨å†ŒåŸŸåã€è´­ä¹°æœåŠ¡å™¨ã€éƒ¨ç½²ç¨‹åºåŠç½‘ç«™é…ç½®å’Œä¼˜åŒ–ã€‚\nåŸŸå æ­å»ºä¸€ä¸ªåšå®¢æˆ–è€…ç½‘ç«™ï¼Œéœ€è¦æœ‰ä¸€ä¸ªåŸŸåã€‚é‚£ä»€ä¹ˆæ˜¯åŸŸåå‘¢ï¼Ÿçœ‹çœ‹ç™¾åº¦ç™¾ç§‘ä¸Šçš„è§£é‡Šï¼š\nåŸŸåï¼ˆè‹±è¯­ï¼šDomain Nameï¼‰ï¼Œåˆç§°ç½‘åŸŸï¼Œæ˜¯ç”±ä¸€ä¸²ç”¨ç‚¹åˆ†éš”çš„åå­—ç»„æˆçš„Internetä¸ŠæŸä¸€å°è®¡ç®—æœºæˆ–è®¡ç®—æœºç»„çš„åç§°ï¼Œç”¨äºåœ¨æ•°æ®ä¼ è¾“æ—¶å¯¹è®¡ç®—æœºçš„å®šä½æ ‡è¯†ï¼ˆæœ‰æ—¶ä¹ŸæŒ‡åœ°ç†ä½ç½®ï¼‰ã€‚\nç”±äºIP åœ°å€å…·æœ‰ä¸æ–¹ä¾¿è®°å¿†å¹¶ä¸”ä¸èƒ½æ˜¾ç¤ºåœ°å€ç»„ç»‡çš„åç§°å’Œæ€§è´¨ç­‰ç¼ºç‚¹ï¼Œäººä»¬è®¾è®¡å‡ºäº†åŸŸåï¼Œå¹¶é€šè¿‡ç½‘åŸŸåç§°ç³»ç»Ÿï¼ˆDNSï¼ŒDomain Name Systemï¼‰æ¥å°†åŸŸåå’ŒIP åœ°å€ç›¸äº’æ˜ å°„ï¼Œä½¿äººæ›´æ–¹ä¾¿åœ°è®¿é—®äº’è”ç½‘ï¼Œè€Œä¸ç”¨å»è®°ä½èƒ½å¤Ÿè¢«æœºå™¨ç›´æ¥è¯»å–çš„IP åœ°å€æ•°ä¸²ã€‚\nç®€å•æ¥è¯´ï¼ŒIP åœ°å€å¯ä»¥æ ‡è¯†ä¸€å°è®¡ç®—æœºï¼Œä½†æ˜¯ä¸å®¹æ˜“è®°å¿†ï¼Œæ‰€ä»¥ï¼Œè®¾è®¡å‡ºäº†åŸŸåã€‚è€ŒåŸŸåå°±æ˜¯æ ‡è¯†å› ç‰¹ç½‘ä¸Šçš„ä¸€å°è®¡ç®—æœºï¼Œç”±ç½‘åŸŸåç§°ç³»ç»Ÿ DNS æ¥å®ŒæˆåŸŸåå’Œ IP ä¹‹é—´çš„æ˜ å°„ã€‚\nå¦‚ä½•æ³¨å†ŒåŸŸåï¼Ÿæœ‰å¾ˆå¤šç½‘ç«™æä¾›åŸŸåæ³¨å†ŒæœåŠ¡ï¼Œæ¯”å¦‚å›½å†…çš„ï¼š\né˜¿é‡Œäº‘ è…¾è®¯äº‘ åä¸ºäº‘ å›½å¤–çš„ï¼š\nGoDaddy Namecheap Amazon æ³¨å†ŒåŸŸåçš„å»ºè®®ï¼š\n1ã€å»ºè®®åœ¨æ­£è§„ã€å‡ºåçš„ç½‘ç«™æ³¨å†ŒåŸŸåï¼Œé˜²æ­¢ç½‘ç«™è·‘è·¯ã€‚æˆ‘æ›¾ç»åœ¨ä¸€ä¸ªå°ç½‘ç«™æ³¨å†Œäº†ä¸€ä¸ªåŸŸåï¼Œä½¿ç”¨äº†å‡ å¹´ä¹‹åï¼Œç»­æœŸçš„æ—¶å€™ï¼Œè”ç³»ä¸ä¸Šå¯¹æ–¹ï¼Œå¯¼è‡´æ— æ³•ä½¿ç”¨è¯¥åŸŸåï¼Œç”šè‡³è¯¥åŸŸåè¢«åˆ«äººæŠ¢æ³¨å†Œäº†ã€‚ 2ã€åœ¨å›½å†…ç½‘ç«™æ³¨å†ŒåŸŸåï¼Œéƒ½éœ€è¦å¤‡æ¡ˆã€‚å¦‚æœä¸æƒ³å¤‡æ¡ˆï¼Œè¯·åœ¨å›½å¤–ç½‘ç«™æ³¨å†ŒåŸŸåã€‚æˆ‘çš„åŸŸå chensoul.cc å°±æ˜¯åœ¨äºšé©¬é€Šä¸Šæ³¨å†Œçš„ã€‚ä¸€æ˜¯ä¸æƒ³å¤‡æ¡ˆï¼ŒäºŒæ˜¯å¯¹æ¯”äº†ä¸Šé¢å‡ ä¸ªç½‘ç«™ï¼Œå‘ç°äºšé©¬é€Šä¸Šçš„ com åŸŸåä»·æ ¼ç›¸å¯¹ä¾¿å®œï¼Œæ‰€ä»¥ä¸€æ¬¡æ€§è´­ä¹°äº† 5 å¹´ã€‚ 3ã€å»ºè®®ä¼˜å…ˆæ³¨å†Œ com åŸŸåï¼ŒåŸŸåå°½å¯èƒ½çš„ç®€çŸ­å¹¶ä¸”æ–¹ä¾¿è®°å¿†ã€‚ æˆ‘æ›¾ç»æ³¨å†Œè¿‡çš„åŸŸåï¼š\njavachen.comã€javachen.spaceã€javachen.xyz huaiu.com æœåŠ¡å™¨ æ³¨å†Œäº†åŸŸåä¹‹åï¼Œéœ€è¦ä¸€å°æœåŠ¡å™¨è¿è¡Œç¨‹åºã€‚æœåŠ¡å™¨å¯ä»¥æ˜¯ä¸€å°ç‰©ç†æœºï¼Œæ¯”å¦‚ä½ å¯ä»¥ä½¿ç”¨è‡ªå·±çš„ç”µè„‘ä½œä¸ºæœåŠ¡å™¨ï¼›ä¹Ÿå¯ä»¥æ˜¯ä¸€å°è™šæ‹Ÿçš„äº‘æœåŠ¡å™¨ï¼Œæ¯”å¦‚åœ¨äº‘æœåŠ¡æä¾›å•†è´­ä¹°ä¸€å°ç‹¬ç«‹çš„æœåŠ¡å™¨ï¼›ä¹Ÿå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹æä¾›çš„æœåŠ¡å™¨ç©ºé—´ï¼Œæ¯”å¦‚ Github ä¸Šå¯ä»¥éƒ¨ç½²é™æ€ç¨‹åºã€‚ä¸ç®¡å“ªç§æ–¹å¼ï¼ŒæœåŠ¡å™¨éƒ½éœ€è¦æœ‰ä¸€ä¸ªå…¬ç½‘ IPï¼Œè¿™æ ·æ‰èƒ½åœ¨å› ç‰¹ç½‘ä¸Šè®¿é—®ä½ æœåŠ¡å™¨ä¸Šéƒ¨ç½²çš„ç¨‹åºã€‚æœ‰äº†æœåŠ¡å™¨ä¹‹åï¼Œå°±å¯ä»¥ç»™æœåŠ¡å™¨å…¬ç½‘ IP è®¾ç½®åŸŸåè§£æã€‚\næˆ‘çš„æœåŠ¡å™¨æ˜¯åœ¨æ¬ç“¦å·¥è´­ä¹°çš„ï¼Œä¸€å¹´ 49.99 ç¾å…ƒã€‚\nç¨‹åº å®‰è£… Hugo åœ¨ Mac ä¸‹å®‰è£… Hugoï¼š\nbrew install hugo æ–°å»ºç«™ç‚¹ hugo new site chensoul.github.io -y yaml ä¸Šè¿°å‘½ä»¤ä¼šç”Ÿæˆä¸€ä¸ªåä¸º chensoul.github.io çš„æ–‡ä»¶å¤¹ï¼Œä¸‹é¢å¯¹æ–‡ä»¶å¤¹ç»“æ„åšä¸ªè¯´æ˜ï¼š\n$ tree chensoul.github.io chensoul.github.io â”œâ”€â”€ archetypes â”‚ â””â”€â”€ default.md â”œâ”€â”€ config.yaml â”œâ”€â”€ content â”œâ”€â”€ data â”œâ”€â”€ layouts â”œâ”€â”€ static â””â”€â”€ themes 6 directories, 2 files æ–°å»ºçš„ç«™ç‚¹ï¼Œè¿˜æ²¡æœ‰åŠ å…¥ Git ç‰ˆæœ¬ç®¡ç†ï¼Œè¿›å…¥åˆ°è¿™ä¸ªç›®å½•ä¸‹ï¼Œæ‰§è¡Œä¸€ä¸‹å¦‚ä¸‹å‘½ä»¤ï¼Œå®Œæˆ Git Repo çš„åˆå§‹åŒ–ï¼š","title":"ä»é›¶å¼€å§‹æ­å»ºä¸ªäººåšå®¢"}]