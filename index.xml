<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>ChenSoul</title>
    <link>https://blog.chensoul.com/</link>
    <description>Recent content on ChenSoul</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <lastBuildDate>Thu, 27 Jul 2023 09:00:00 +0800</lastBuildDate><atom:link href="https://blog.chensoul.com/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>å‘¨æŠ¥-28ï½œæŠ€æœ¯æ–‡æ¡£èŒƒä¾‹</title>
      <link>https://blog.chensoul.com/posts/2023/07/27/weekly_review_28/</link>
      <pubDate>Thu, 27 Jul 2023 09:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/07/27/weekly_review_28/</guid>
      <description>å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-07-10 åˆ° 2023-07-16 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚ è¯»ä¹¦ã€å¥èº«ã€æŠ•èµ„ã€å¸®æœ‹å‹ã€é™ªå®¶äººã€‚ è¿™æ˜¯æˆ‘çš„ç¬¬27</description>
      <content:encoded><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p>æœ¬ç¯‡æ˜¯å¯¹ <code>2023-07-10</code> åˆ° <code>2023-07-16</code> è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº <a href="https://blog.chensoul.com/">åšå®¢</a>ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚</p>
<blockquote>
<p>è¯»ä¹¦ã€å¥èº«ã€æŠ•èµ„ã€å¸®æœ‹å‹ã€é™ªå®¶äººã€‚</p>
</blockquote>
<p>è¿™æ˜¯æˆ‘çš„ç¬¬27ç¯‡å‘¨æŠ¥ï¼Œç”±äºå·¥ä½œçš„åŸå› ï¼Œå‰ä¸¤å‘¨çš„å‘¨æŠ¥æ˜¯ä¸€èµ·å‘å¸ƒçš„ï¼Œæ‰€ä»¥ç¬¬27ç¯‡å‘¨æŠ¥è¢«è·³è¿‡å»äº†ã€‚</p>
<h2 id="æŠ€æœ¯æ–‡æ¡£èŒƒä¾‹">æŠ€æœ¯æ–‡æ¡£èŒƒä¾‹</h2>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ä¸­æ–‡æ ‡é¢˜çš„æŠ€æœ¯æ–‡æ¡£èŒƒä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ä¸€ã€ä»‹ç»
</span></span><span class="line"><span class="cl">    1.1 ç›®çš„
</span></span><span class="line"><span class="cl">    1.2 èŒƒå›´
</span></span><span class="line"><span class="cl">    1.3 å—ä¼—
</span></span><span class="line"><span class="cl">    1.4 å®šä¹‰ã€ç¼©ç•¥è¯­å’Œæœ¯è¯­
</span></span><span class="line"><span class="cl">äºŒã€æ¦‚è¿°
</span></span><span class="line"><span class="cl">    2.1 ç³»ç»Ÿæ¶æ„
</span></span><span class="line"><span class="cl">    2.2 ä¸»è¦åŠŸèƒ½
</span></span><span class="line"><span class="cl">    2.3 ç³»ç»Ÿè¦æ±‚
</span></span><span class="line"><span class="cl">ä¸‰ã€å…¥é—¨æŒ‡å—
</span></span><span class="line"><span class="cl">    3.1 å®‰è£…
</span></span><span class="line"><span class="cl">    3.2 é…ç½®
</span></span><span class="line"><span class="cl">    3.3 ç¬¬ä¸€æ­¥æ“ä½œ
</span></span><span class="line"><span class="cl">å››ã€ç”¨æˆ·æŒ‡å—
</span></span><span class="line"><span class="cl">    4.1 ç”¨æˆ·ç•Œé¢
</span></span><span class="line"><span class="cl">    4.2 å¯¼èˆª
</span></span><span class="line"><span class="cl">    4.3 åŠŸèƒ½
</span></span><span class="line"><span class="cl">äº”ã€ç®¡ç†æŒ‡å—
</span></span><span class="line"><span class="cl">    5.1 ç³»ç»Ÿé…ç½®
</span></span><span class="line"><span class="cl">    5.2 ç”¨æˆ·ç®¡ç†
</span></span><span class="line"><span class="cl">    5.3 å®‰å…¨æ€§
</span></span><span class="line"><span class="cl">å…­ã€æ•…éšœæ’é™¤
</span></span><span class="line"><span class="cl">    6.1 å¸¸è§é—®é¢˜
</span></span><span class="line"><span class="cl">    6.2 é”™è¯¯æ¶ˆæ¯
</span></span><span class="line"><span class="cl">ä¸ƒã€é™„å½•
</span></span><span class="line"><span class="cl">    7.1 å‘è¡Œè¯´æ˜
</span></span><span class="line"><span class="cl">    7.2 æœ¯è¯­è¡¨
</span></span><span class="line"><span class="cl">    7.3 å‚è€ƒæ–‡çŒ®
</span></span></code></pre></div><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨æ•°å­—æ ‡é¢˜çš„ Spring Cloud Gateway æ•™ç¨‹ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">1. ä»‹ç»
</span></span><span class="line"><span class="cl">    1.1 ç›®çš„
</span></span><span class="line"><span class="cl">    1.2 èŒƒå›´
</span></span><span class="line"><span class="cl">    1.3 å—ä¼—
</span></span><span class="line"><span class="cl">    1.4 æœ¯è¯­å’Œå®šä¹‰
</span></span><span class="line"><span class="cl">2. æ¦‚è¿°
</span></span><span class="line"><span class="cl">    2.1 ä»€ä¹ˆæ˜¯ Spring Cloud Gateway
</span></span><span class="line"><span class="cl">    2.2 Spring Cloud Gateway çš„ä¼˜åŠ¿
</span></span><span class="line"><span class="cl">3. å¿«é€Ÿå…¥é—¨
</span></span><span class="line"><span class="cl">    3.1 ç¯å¢ƒé…ç½®
</span></span><span class="line"><span class="cl">    3.2 åˆ›å»ºSpring Cloud Gatewayé¡¹ç›®
</span></span><span class="line"><span class="cl">    3.3 é…ç½®è·¯ç”±è§„åˆ™
</span></span><span class="line"><span class="cl">    3.4 è¿è¡Œå’Œæµ‹è¯•
</span></span><span class="line"><span class="cl">4. è·¯ç”±é…ç½®
</span></span><span class="line"><span class="cl">    4.1 URIè·¯ç”±
</span></span><span class="line"><span class="cl">    4.2 æ–­è¨€è·¯ç”±
</span></span><span class="line"><span class="cl">    4.3 è¿‡æ»¤å™¨
</span></span><span class="line"><span class="cl">5. é«˜çº§ç‰¹æ€§
</span></span><span class="line"><span class="cl">    5.1 ç†”æ–­å™¨
</span></span><span class="line"><span class="cl">    5.2 é™æµ
</span></span><span class="line"><span class="cl">    5.3 æ—¥å¿—å’Œç›‘æ§
</span></span><span class="line"><span class="cl">6. éƒ¨ç½²å’Œç®¡ç†
</span></span><span class="line"><span class="cl">    6.1 éƒ¨ç½²é€‰é¡¹
</span></span><span class="line"><span class="cl">    6.2 å®¹å™¨åŒ–éƒ¨ç½²
</span></span><span class="line"><span class="cl">    6.3 ç®¡ç†å’Œç›‘æ§
</span></span><span class="line"><span class="cl">7. æ•…éšœæ’é™¤
</span></span><span class="line"><span class="cl">    7.1 å¸¸è§é—®é¢˜
</span></span><span class="line"><span class="cl">    7.2 æ—¥å¿—åˆ†æ
</span></span><span class="line"><span class="cl">8. æ€»ç»“å’Œå‚è€ƒèµ„æ–™
</span></span><span class="line"><span class="cl">    8.1 æ€»ç»“
</span></span><span class="line"><span class="cl">    8.2 å‚è€ƒèµ„æ–™
</span></span></code></pre></div><h2 id="è¯»ä¹¦">è¯»ä¹¦</h2>
<h2 id="å¥èº«">å¥èº«</h2>
<blockquote>
<p>æˆ‘è·‘è¿‡äº†ä¸€äº›åœ°æ–¹ï¼Œå¸Œæœ›éšç€æ—¶é—´æ¨ç§»ï¼Œåœ°å›¾ç‚¹äº®çš„åœ°æ–¹è¶Šæ¥è¶Šå¤šã€‚2 å¹´é‡Œæˆ‘è·‘è¿‡ 2ä¸ªçœä»½ 2ä¸ªåŸå¸‚ã€‚æ›´å¤šè·‘æ­¥æ•°æ®åœ¨æˆ‘çš„ <a href="https://run.chensoul.com/">è·‘æ­¥</a> ä¸»é¡µã€‚</p>
</blockquote>
<h2 id="ç†è´¢">ç†è´¢</h2>
<p>è¿™å‘¨æ€»è®¡æ”¯å‡º 5006 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>7æœˆ16æ—¥ï¼š4057å…ƒï¼Œçˆ¶äº²å‡ºé™¢æ”¯ä»˜3475å…ƒ</p>
</li>
<li>
<p>7æœˆ15æ—¥ï¼š108å…ƒ</p>
</li>
<li>
<p>7æœˆ14æ—¥ï¼š86å…ƒ</p>
</li>
<li>
<p>7æœˆ13æ—¥ï¼š367å…ƒ</p>
</li>
<li>
<p>7æœˆ12æ—¥ï¼š179å…ƒ</p>
</li>
<li>
<p>7æœˆ11æ—¥ï¼š117å…ƒ</p>
</li>
<li>
<p>7æœˆ10æ—¥ï¼š92å…ƒ</p>
</li>
</ul>
<h2 id="é™ªå®¶äºº">é™ªå®¶äºº</h2>
<h2 id="å·¥ä½œ">å·¥ä½œ</h2>
<p>æœ€è¿‘åœ¨å­¦ä¹ çš„å†…å®¹æ¸…å•ï¼š</p>
<ul>
<li><a href="https://github.com/clxering/Effective-Java-3rd-edition-Chinese-English-bilingual/tree/dev">Effective Javaï¼ˆç¬¬ 3 ç‰ˆï¼‰</a></li>
<li><a href="https://java-design-patterns.com/zh/">Java Design Patterns (ä¸­æ–‡)</a></li>
<li><a href="https://realpython.com/">Real Python</a></li>
</ul>
<p>æœ¬å‘¨å®Œæˆä¸€ç¯‡åšå®¢ï¼š</p>
<ul>
<li><a href="/posts/2023/07/14/oauth-2-centralized-authorization-with-spring-boot-2-and-spring-security-5-and-jdbc-token-store/">[è¯‘]ä½¿ç”¨Spring Boot2å’ŒSpring Security 5ä»¥åŠJDBCä»¤ç‰Œå­˜å‚¨è¿›è¡ŒOauth2é›†ä¸­æˆæƒ</a></li>
</ul>
<h2 id="æœ¬å‘¨åˆ†äº«">æœ¬å‘¨åˆ†äº«</h2>
<p>å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€<a href="https://t.me/chensoul_share">ChenSoul Share</a>ã€Telegram é¢‘é“æˆ–è€…æˆ‘çš„ <a href="https://memos.chensoul.com/">Memos</a> ä¸­ã€‚æˆ‘å†™äº†ä¸€ä¸ª Python è„šæœ¬ä» Memos è¯»å–æœ€è¿‘ä¸€å‘¨å¸¦æœ‰ <code>#memos</code> æ ‡ç­¾çš„è®°å½•ï¼Œåˆ†äº«åˆ°è¿™é‡Œã€‚</p>
<ul>
<li>
<p>ğŸ“Œ<code>2023-07-15</code> Mysql updateè¯­å¥ä½¿ç”¨å­æŸ¥è¯¢ | CHEGVA <code>#memos</code> <a href="https://chegva.com/5744.html">https://chegva.com/5744.html</a></p>
</li>
<li>
<p>ğŸ“Œ<code>2023-07-15</code> ä¸€ç¯‡ã€ŠOAuth2 æ¦‚è¿°ã€‹ï¼ˆè‹±æ–‡ï¼‰ï¼Œåœ¨å¾ˆçŸ­çš„ç¯‡å¹…é‡Œé¢ï¼Œæ¸…æ¥šåœ°ä»‹ç»äº† OAuthã€‚<code>#memos</code> <a href="https://metacpan.org/dist/LWP-Authen-OAuth2/view/lib/LWP/Authen/OAuth2/Overview.pod">https://metacpan.org/dist/LWP-Authen-OAuth2/view/lib/LWP/Authen/OAuth2/Overview.pod</a></p>
</li>
<li>
<p>ğŸ“Œ<code>2023-07-15</code> æ‹¥æŠ± TypeScript çš„å†ç¨‹ | Usubeni Fantasy<code>#memos</code> <a href="https://ssshooter.com/typescript-tittle-tattle/">https://ssshooter.com/typescript-tittle-tattle/</a></p>
</li>
<li>
<p>ğŸ“Œ<code>2023-07-15</code> ä¸€ä¸ªç‹¬ç«‹åˆ›é€ è€…çš„äº”å¹´<code>#memos</code> <a href="http://hawstein.com/2023/07/12/five-years-of-an-indie-hacker/">http://hawstein.com/2023/07/12/five-years-of-an-indie-hacker/</a></p>
</li>
<li>
<p>ğŸ“Œ<code>2023-07-15</code> ä¸€ä¸ªçŸ­é“¾æ¥æµè§ˆå™¨æ‰©å±•æ’ä»¶ï¼Œæœˆæ”¶å…¥2.6Kç¾é‡‘ <code>#memos</code> <a href="https://www.ezindie.com/weekly/issue-95">https://www.ezindie.com/weekly/issue-95</a></p>
</li>
<li>
<p>ğŸ“Œ<code>2023-07-15</code> é…ç½®è½»é‡çº§ Linux è¿œç¨‹å¼€å‘ç¯å¢ƒï¼ˆFedora 38ï¼‰<code>#memos</code> <a href="https://rook1e.com/p/lightweight-remote-linux-devenv-fedora38/">https://rook1e.com/p/lightweight-remote-linux-devenv-fedora38/</a></p>
</li>
<li>
<p>ğŸ“Œ<code>2023-07-11</code> React Design Patterns <code>#memos</code>  <a href="https://anuradha.hashnode.dev/react-design-patterns">https://anuradha.hashnode.dev/react-design-patterns</a></p>
</li>
<li>
<p>ğŸ“Œ<code>2023-07-11</code> æ¨èï¼šéå¸¸è¯¦ç»†çš„viteå¼€å‘ç¬”è®°ï¼ˆ7kå­—ï¼‰<code>#memos</code> <a href="https://juejin.cn/post/7251873578157113401">https://juejin.cn/post/7251873578157113401</a></p>
</li>
</ul>
<p>ä»¥ä¸Šã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>[è¯‘]Spring BootæˆæƒæœåŠ¡å™¨ - ä½¿ç”¨ Java çš„èµ„æºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å‡­è¯ç¤ºä¾‹</title>
      <link>https://blog.chensoul.com/posts/2023/07/26/spring-boot-authorization-server/</link>
      <pubDate>Wed, 26 Jul 2023 14:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/07/26/spring-boot-authorization-server/</guid>
      <description>æ¦‚è¿° åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæˆæƒæœåŠ¡å™¨ï¼Œä¸ºä»»ä½•å®¢æˆ·ç«¯ç”Ÿæˆ access_tokenã€‚è¿™ç§°ä¸º OAuth2 çš„ client_credentials æµç¨‹ã€‚å®ƒä¸»è¦ç”¨äºæœåŠ¡é—´é€šä¿¡ã€‚ æˆ‘ä»¬å°†ä½¿ç”¨ spring boot oauth2 æˆ</description>
      <content:encoded><![CDATA[<h1 id="æ¦‚è¿°">æ¦‚è¿°</h1>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæˆæƒæœåŠ¡å™¨ï¼Œä¸ºä»»ä½•å®¢æˆ·ç«¯ç”Ÿæˆ access_tokenã€‚è¿™ç§°ä¸º OAuth2 çš„ <code>client_credentials</code> æµç¨‹ã€‚å®ƒä¸»è¦ç”¨äºæœåŠ¡é—´é€šä¿¡ã€‚</p>
<p>æˆ‘ä»¬å°†ä½¿ç”¨ spring boot oauth2 æˆæƒæœåŠ¡å™¨ä¾èµ–é¡¹æ¥åˆ›å»ºèº«ä»½éªŒè¯æœåŠ¡å™¨ã€‚æˆ‘ä»¬è¿˜å°†åˆ›å»ºä¸€ä¸ªèµ„æºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ¥å¯¹å…¶è¿›è¡Œç«¯åˆ°ç«¯æµ‹è¯•ã€‚</p>
<p><img loading="lazy" src="https://miro.medium.com/v2/resize:fit:1400/1*8-okMlYgO09HrFbdEpWm6w.png" alt="img"  />
</p>
<h1 id="springæˆæƒæœåŠ¡å™¨">SpringæˆæƒæœåŠ¡å™¨</h1>
<p>æˆ‘ä»¬é¦–å…ˆåˆ›å»ºæˆæƒæœåŠ¡å™¨ã€‚</p>
<h2 id="ä¾èµ–é¡¹"><strong>ä¾èµ–é¡¹ï¼š</strong></h2>
<p>è®©æˆ‘ä»¬å°†ä»¥ä¸‹ä¾èµ–é¡¹æ·»åŠ åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">implementation &#39;org.springframework.security:spring-security-oauth2-authorization-server:1.0.0&#39;
</span></span><span class="line"><span class="cl">implementation &#39;org.springframework.boot:spring-boot-starter-security&#39;
</span></span><span class="line"><span class="cl">implementation &#39;org.springframework.boot:spring-boot-starter-web&#39;
</span></span><span class="line"><span class="cl">testImplementation &#39;org.springframework.boot:spring-boot-starter-test&#39;
</span></span><span class="line"><span class="cl">testImplementation &#39;org.springframework.security:spring-security-test&#39;
</span></span></code></pre></div><p>æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ spring oauth2 ä¾èµ–é¡¹çš„æœ€æ–°ï¼ˆå½“æ—¶ï¼‰ç¨³å®šç‰ˆæœ¬ã€‚</p>
<h2 id="javaå®ç°"><strong>Javaå®ç°ï¼š</strong></h2>
<p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º AuthorizationServerConfig çš„é…ç½®ç±»ï¼Œå¹¶å‘è¯¥ç±»æ·»åŠ  @Configuration æ³¨è§£ã€‚ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºä»¥ä¸‹ bean æ¥å®Œæˆé…ç½®ï¼š</p>
<ul>
<li><strong>SecurityFilterChain</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Order</span><span class="o">(</span><span class="n">Ordered</span><span class="o">.</span><span class="na">HIGHEST_PRECEDENCE</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">SecurityFilterChain</span> <span class="nf">authServerSecurityFilterChain</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">OAuth2AuthorizationServerConfiguration</span><span class="o">.</span><span class="na">applyDefaultSecurity</span><span class="o">(</span><span class="n">http</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æˆ‘ä»¬å°†æŠŠ bean çš„é¡ºåºè®¾ç½®ä¸ºæœ€é«˜ï¼Œå› ä¸ºæˆ‘ä»¬æƒ³é¦–å…ˆæ‰§è¡Œå®ƒã€‚</p>
<ul>
<li><strong>RegisteredClientRepository</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">RegisteredClientRepository</span> <span class="nf">registeredClientRepository</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">RegisteredClient</span> <span class="n">registeredClient</span> <span class="o">=</span> <span class="n">RegisteredClient</span><span class="o">.</span><span class="na">withId</span><span class="o">(</span><span class="n">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="na">clientId</span><span class="o">(</span><span class="s">&#34;oauth-client&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="na">clientSecret</span><span class="o">(</span><span class="s">&#34;{noop}oauth-secret&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="na">clientAuthenticationMethod</span><span class="o">(</span><span class="n">ClientAuthenticationMethod</span><span class="o">.</span><span class="na">CLIENT_SECRET_BASIC</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="na">authorizationGrantType</span><span class="o">(</span><span class="n">AuthorizationGrantType</span><span class="o">.</span><span class="na">CLIENT_CREDENTIALS</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="na">scope</span><span class="o">(</span><span class="n">OidcScopes</span><span class="o">.</span><span class="na">OPENID</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="na">scope</span><span class="o">(</span><span class="s">&#34;articles.read&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">new</span> <span class="n">InMemoryRegisteredClientRepository</span><span class="o">(</span><span class="n">registeredClient</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ç°åœ¨è®©æˆ‘ä»¬ä½¿ç”¨å†…å­˜å­˜å‚¨åº“å¯¹å†…å®¹è¿›è¡Œç¡¬ç¼–ç ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®æˆ‘ä»¬çš„éœ€è¦æ›´æ–°è¿™äº›ã€‚</p>
<ul>
<li><strong>JwtDecoder</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">JwtDecoder</span> <span class="nf">jwtDecoder</span><span class="o">(</span><span class="n">JWKSource</span><span class="o">&lt;</span><span class="n">SecurityContext</span><span class="o">&gt;</span> <span class="n">jwkSource</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">OAuth2AuthorizationServerConfiguration</span><span class="o">.</span><span class="na">jwtDecoder</span><span class="o">(</span><span class="n">jwkSource</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æˆ‘ä»¬å°†ä½¿ç”¨å®ƒæ¥è§£ç ä»¤ç‰Œä»¥è¿›è¡ŒéªŒè¯ã€‚</p>
<ul>
<li><strong>JWKSource<SecurityContext></strong></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">JWKSource</span><span class="o">&lt;</span><span class="n">SecurityContext</span><span class="o">&gt;</span> <span class="nf">jwkSource</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">NoSuchAlgorithmException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">RSAKey</span> <span class="n">rsaKey</span> <span class="o">=</span> <span class="n">generateRsa</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">JWKSet</span> <span class="n">jwkSet</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JWKSet</span><span class="o">(</span><span class="n">rsaKey</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">(</span><span class="n">jwkSelector</span><span class="o">,</span> <span class="n">securityContext</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">jwkSelector</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="n">jwkSet</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="kd">static</span> <span class="n">RSAKey</span> <span class="nf">generateRsa</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">NoSuchAlgorithmException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">KeyPair</span> <span class="n">keyPair</span> <span class="o">=</span> <span class="n">generateRsaKey</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">RSAPublicKey</span> <span class="n">publicKey</span> <span class="o">=</span> <span class="o">(</span><span class="n">RSAPublicKey</span><span class="o">)</span> <span class="n">keyPair</span><span class="o">.</span><span class="na">getPublic</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">RSAPrivateKey</span> <span class="n">privateKey</span> <span class="o">=</span> <span class="o">(</span><span class="n">RSAPrivateKey</span><span class="o">)</span> <span class="n">keyPair</span><span class="o">.</span><span class="na">getPrivate</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">new</span> <span class="n">RSAKey</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">publicKey</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="na">privateKey</span><span class="o">(</span><span class="n">privateKey</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="na">keyID</span><span class="o">(</span><span class="n">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">      <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="kd">static</span> <span class="n">KeyPair</span> <span class="nf">generateRsaKey</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">NoSuchAlgorithmException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">KeyPairGenerator</span> <span class="n">keyPairGenerator</span> <span class="o">=</span> <span class="n">KeyPairGenerator</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">&#34;RSA&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">keyPairGenerator</span><span class="o">.</span><span class="na">initialize</span><span class="o">(</span><span class="n">2048</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">keyPairGenerator</span><span class="o">.</span><span class="na">generateKeyPair</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æˆ‘ä»¬åœ¨è§£ç å™¨ bean ä¸­ä½¿ç”¨è¿™ä¸ªæºï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®šä¹‰å®ƒã€‚æˆ‘ä»¬ä½¿ç”¨ RSA 2048 å¯†é’¥å¯¹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨éœ€è¦æ—¶æ›´æ”¹å®ƒã€‚</p>
<ul>
<li><strong>AuthorizationServerSettings</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">AuthorizationServerSettings</span> <span class="nf">authorizationServerSettings</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">AuthorizationServerSettings</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ç°åœ¨æˆ‘ä»¬å·²ç»é…ç½®äº†ä¸€åˆ‡ï¼Œè®©æˆ‘ä»¬å°è¯•è¿è¡Œåº”ç”¨ç¨‹åºå¹¶è·å–ä»¤ç‰Œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -X POST <span class="s1">&#39;http://localhost:9090/oauth2/token?grant_type=client_credentials&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --header <span class="s1">&#39;Authorization: Basic b2F1dGgtY2xpZW50Om9hdXRoLXNlY3JldA==&#39;</span>
</span></span></code></pre></div><p>æ³¨æ„ï¼šæ ¹æ®æ‚¨çš„é…ç½®æ›´æ–°ç«¯å£å·ã€‚</p>
<p>å®ƒåº”è¯¥ç»™å‡ºå¦‚ä¸‹å“åº”ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;access_token&#34;</span><span class="p">:</span> <span class="s2">&#34;eyJraWQiOiJiYWM0ZmMxYS02MGJiLTQ0ZTAtODU4MC1iNzcwYWU2MjkwZWEiLCJhbGciOiJSUzI1NiJ9.eyJzdWIiOiJvYXV0aC1jbGllbnQiLCJhdWQiOiJvYXV0aC1jbGllbnQiLCJuYmYiOjE2NzQ5ODYzNjcsImlzcyI6Imh0dHA6Ly9sb2NhbGhvc3Q6OTA5MCIsImV4cCI6MTY3NDk4NjY2NywiaWF0IjoxNjc0OTg2MzY3fQ.DxiIbV7jdRnW15WnnqcjFCLyfXmrU_trl1M3nxej_nIWK60Jx9Vm4HzpxBJugemhrMg-qizQ03TTNswfL9AgTIsLeh_D8TDjcQJy6XFWgElxfUYqUFeZmlXPmQKFmmPyIChlSAFbX1L8QvcgFE1c8GHC900RiKVgGLhT5MOZx5l1WBCbNQ_Rv2u9utcz7EqYTb0y_PjD4EC8UaGdGGlqvEAnKvRVIhxRqFarqh-OW4oUfwfwu1xQIvyWphSDegcOjIERFkhVcQeKO-a3zZS9sfJ03ppZhzAsa5O-qswtbzThO9SWQg7JUgyo7qd-zHIRhwPtEWxDGaBt2QGo7jjopw&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;token_type&#34;</span><span class="p">:</span> <span class="s2">&#34;Bearer&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;expires_in&#34;</span><span class="p">:</span> <span class="mi">299</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h1 id="springèµ„æºæœåŠ¡å™¨">Springèµ„æºæœåŠ¡å™¨</h1>
<p>ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå—æ­¤èº«ä»½éªŒè¯æœåŠ¡å™¨ä¿æŠ¤çš„ API ç«¯ç‚¹ï¼Œå…¶èŒƒå›´ä¸ºæˆ‘ä»¬åœ¨ä»¤ç‰Œåˆ›å»ºä¸­ä½¿ç”¨çš„articles.readã€‚</p>
<h2 id="ä¾èµ–é¡¹-1">ä¾èµ–é¡¹ï¼š</h2>
<p>è®©æˆ‘ä»¬å°†ä»¥ä¸‹ä¾èµ–é¡¹æ·»åŠ åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">implementation &#39;org.springframework.boot:spring-boot-starter-oauth2-resource-server&#39;
</span></span><span class="line"><span class="cl">implementation &#39;org.springframework.boot:spring-boot-starter-security&#39;
</span></span><span class="line"><span class="cl">implementation &#39;org.springframework.boot:spring-boot-starter-web&#39;
</span></span><span class="line"><span class="cl">testImplementation &#39;org.springframework.boot:spring-boot-starter-test&#39;
</span></span><span class="line"><span class="cl">testImplementation &#39;org.springframework.security:spring-security-test&#39;
</span></span></code></pre></div><h2 id="javaå®ç°-1">Javaå®ç°ï¼š</h2>
<p>è®©æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªç®€å•çš„ rest æ§åˆ¶å™¨ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªé…ç½®ï¼Œä»¥åœ¨æ­£ç¡®çš„èŒƒå›´å†…ä¿æŠ¤è¯¥ APIã€‚ä¹‹åï¼Œæˆ‘ä»¬å°†åœ¨ application.yml æ–‡ä»¶ä¸­é…ç½®èº«ä»½éªŒè¯æœåŠ¡å™¨è®¾ç½®ã€‚</p>
<ul>
<li><strong>APIæ§åˆ¶å™¨</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ArticlesController</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/articles&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span><span class="o">[]</span> <span class="nf">getArticles</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]</span> <span class="o">{</span> <span class="s">&#34;Article 1&#34;</span><span class="o">,</span> <span class="s">&#34;Article 2&#34;</span><span class="o">,</span> <span class="s">&#34;Article 3&#34;</span> <span class="o">};</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ GET API ç«¯ç‚¹ /articlesï¼Œå®ƒå°†è¿”å›æ–‡ç« åˆ—è¡¨ã€‚</p>
<ul>
<li><strong>ResourceServerConfig</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@EnableWebSecurity</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ResourceServerConfig</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="n">SecurityFilterChain</span> <span class="nf">securityFilterChain</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">http</span>
</span></span><span class="line"><span class="cl">          <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">          <span class="o">.</span><span class="na">requestMatchers</span><span class="o">(</span><span class="s">&#34;/articles/**&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">.</span><span class="na">access</span><span class="o">(</span><span class="s">&#34;hasAuthority(&#39;SCOPE_articles.read&#39;)&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">.</span><span class="na">and</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">          <span class="o">.</span><span class="na">oauth2ResourceServer</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">          <span class="o">.</span><span class="na">jwt</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªé…ç½®ç±»å¹¶ä½¿ç”¨@EnableWebSecurityå¯¹å…¶è¿›è¡Œæ³¨é‡Šã€‚æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª SecurityFilterChain çš„ beanï¼Œåœ¨å…¶ä¸­å®šä¹‰ API å’Œæ‰€éœ€çš„èŒƒå›´ã€‚</p>
<ul>
<li><strong>application.yml</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">security</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">oauth2</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">resourceserver</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">jwt</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">issuer-uri</span><span class="p">:</span><span class="w"> </span><span class="l">http://localhost:9090</span><span class="w">
</span></span></span></code></pre></div><p>æˆ‘ä»¬åœ¨è¿™é‡Œå®šä¹‰oauth2é…ç½®ï¼Œæ³¨æ„å°†issuer-urlçš„ç«¯å£æ›´æ–°ä¸ºæ­£ç¡®çš„ç«¯å£ã€‚</p>
<p>ç°åœ¨ä¸€åˆ‡éƒ½å·²é…ç½®å®Œæ¯•ï¼Œè®©æˆ‘ä»¬å¯åŠ¨è¯¥æœåŠ¡å¹¶å‘ API å‘å‡ºå¸¦æœ‰æˆ–ä¸å¸¦æœ‰ä»¤ç‰Œçš„è¯·æ±‚ã€‚æ‚¨åº”è¯¥å¾—åˆ°ä¸€ä¸ªæ²¡æœ‰ä»¤ç‰Œæˆ–å¸¦æœ‰æ— æ•ˆä»¤ç‰Œçš„ 401 å“åº”ï¼Œå¹¶ä¸”æ‚¨åº”è¯¥å¾—åˆ°å¸¦æœ‰æœ‰æ•ˆä»¤ç‰Œçš„æ­£ç¡®å“åº”ã€‚</p>
<h1 id="å®¢æˆ·ç«¯æœåŠ¡å™¨">å®¢æˆ·ç«¯æœåŠ¡å™¨</h1>
<p>æˆ‘ä»¬ç°åœ¨å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„ Spring Boot é¡¹ç›®ï¼Œå®ƒå°†ä½¿ç”¨èµ„æºæœåŠ¡å™¨åˆ›å»ºçš„ APIã€‚æˆ‘ä»¬å°†åœ¨æ­¤å¤„é…ç½®èº«ä»½éªŒè¯æœåŠ¡å™¨è¯¦ç»†ä¿¡æ¯ï¼Œä»¥ä¾¿å®ƒåœ¨å‘å‡º API è¯·æ±‚ä¹‹å‰è‡ªåŠ¨è·å–ä»¤ç‰Œã€‚</p>
<h2 id="ä¾èµ–é¡¹-2">ä¾èµ–é¡¹ï¼š</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">implementation &#39;org.springframework.boot:spring-boot-starter-oauth2-client&#39;
</span></span><span class="line"><span class="cl">implementation &#39;org.springframework.boot:spring-boot-starter-web&#39;
</span></span><span class="line"><span class="cl">implementation &#39;org.springframework:spring-webflux&#39;
</span></span><span class="line"><span class="cl">testImplementation &#39;org.springframework.boot:spring-boot-starter-test&#39;
</span></span><span class="line"><span class="cl">testImplementation &#39;org.springframework.security:spring-security-test&#39;
</span></span></code></pre></div><h2 id="javaå®ç°-2">Javaå®ç°ï¼š</h2>
<p>æˆ‘ä»¬é¦–å…ˆåˆ›å»ºé…ç½®ç±»ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæµ‹è¯• API æ¥å‘èµ„æºæœåŠ¡å™¨å‘å‡ºè¯·æ±‚ã€‚ä¹‹åï¼Œæˆ‘ä»¬å°†åœ¨ application.yml æ–‡ä»¶ä¸­å®šä¹‰ä»¤ç‰Œé…ç½®ã€‚</p>
<ul>
<li>**SecurityConfig **</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfig</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="n">SecurityFilterChain</span> <span class="nf">securityFilterChain</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="na">oauth2Client</span><span class="o">().</span><span class="na">and</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="n">WebClient</span> <span class="nf">webClient</span><span class="o">(</span><span class="n">OAuth2AuthorizedClientManager</span> <span class="n">authorizedClientManager</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ServletOAuth2AuthorizedClientExchangeFilterFunction</span> <span class="n">oauth2Client</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServletOAuth2AuthorizedClientExchangeFilterFunction</span><span class="o">(</span><span class="n">authorizedClientManager</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">WebClient</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">          <span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">oauth2Client</span><span class="o">.</span><span class="na">oauth2Configuration</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">          <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="n">OAuth2AuthorizedClientManager</span> <span class="nf">authorizedClientManager</span><span class="o">(</span><span class="n">ClientRegistrationRepository</span> <span class="n">clientRegistrationRepository</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">OAuth2AuthorizedClientService</span> <span class="n">oAuth2AuthorizedClientService</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">OAuth2AccessTokenResponseClient</span><span class="o">&lt;</span><span class="n">OAuth2ClientCredentialsGrantRequest</span><span class="o">&gt;</span> <span class="n">tokenResponseClient</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">OAuth2AuthorizedClientProvider</span> <span class="n">authorizedClientProvider</span> <span class="o">=</span> <span class="n">OAuth2AuthorizedClientProviderBuilder</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">          <span class="o">.</span><span class="na">clientCredentials</span><span class="o">(</span><span class="n">r</span> <span class="o">-&gt;</span> <span class="n">r</span><span class="o">.</span><span class="na">accessTokenResponseClient</span><span class="o">(</span><span class="n">tokenResponseClient</span><span class="o">)).</span><span class="na">clientCredentials</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">var</span> <span class="n">authorizedClientManager</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AuthorizedClientServiceOAuth2AuthorizedClientManager</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">          <span class="n">clientRegistrationRepository</span><span class="o">,</span> <span class="n">oAuth2AuthorizedClientService</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">authorizedClientManager</span><span class="o">.</span><span class="na">setAuthorizedClientProvider</span><span class="o">(</span><span class="n">authorizedClientProvider</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">authorizedClientManager</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="n">OAuth2AccessTokenResponseClient</span><span class="o">&lt;</span><span class="n">OAuth2ClientCredentialsGrantRequest</span><span class="o">&gt;</span> <span class="nf">tokenResponseClient</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">DefaultClientCredentialsTokenResponseClient</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><ul>
<li><strong>application.yml</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">security</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">oauth2</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">client</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">registration</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">articles-client</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">client-id</span><span class="p">:</span><span class="w"> </span><span class="l">oauth-client</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">client-secret</span><span class="p">:</span><span class="w"> </span><span class="l">oauth-secret</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">authorization-grant-type</span><span class="p">:</span><span class="w"> </span><span class="l">client_credentials</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">scope</span><span class="p">:</span><span class="w"> </span><span class="l">articles.read</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">client-name</span><span class="p">:</span><span class="w"> </span><span class="l">spring-client</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">provider</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">articles-client</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">token-uri</span><span class="p">:</span><span class="w"> </span><span class="l">http://localhost:9090/oauth2/token</span><span class="w">
</span></span></span></code></pre></div><ul>
<li>å®¢æˆ·ç«¯APIï¼ˆå‘èµ„æºæœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ArticlesController</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Autowired</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">WebClient</span> <span class="n">webClient</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/test&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span><span class="o">[]</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">webClient</span>
</span></span><span class="line"><span class="cl">          <span class="o">.</span><span class="na">get</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">          <span class="o">.</span><span class="na">uri</span><span class="o">(</span><span class="s">&#34;http://127.0.0.1:9091/articles&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">.</span><span class="na">attributes</span><span class="o">(</span><span class="n">clientRegistrationId</span><span class="o">(</span><span class="s">&#34;articles-client&#34;</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">          <span class="o">.</span><span class="na">retrieve</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">          <span class="o">.</span><span class="na">bodyToMono</span><span class="o">(</span><span class="n">String</span><span class="o">[].</span><span class="na">class</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">          <span class="o">.</span><span class="na">block</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°ï¼Œå½“æˆ‘ä»¬è°ƒç”¨ /test API æ—¶ï¼Œå®ƒä¼šä»æˆ‘ä»¬çš„èº«ä»½éªŒè¯æœåŠ¡å™¨è·å–ä»¤ç‰Œï¼Œç„¶åå‘æˆ‘ä»¬çš„èµ„æºæœåŠ¡å™¨ /articles ç«¯ç‚¹å‘å‡ºè¯·æ±‚å¹¶è¿”å›å“åº”ã€‚</p>
<p>è®©æˆ‘ä»¬è¿è¡Œæ‰€æœ‰ä¸‰ä¸ªæœåŠ¡å™¨å¹¶å‘å®¢æˆ·ç«¯æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œå®ƒåº”è¯¥è¿”å›æ­£ç¡®çš„å“åº”ã€‚è¯·æ³¨æ„æ›´æ–°æ‰€æœ‰ä½ç½®çš„ç«¯å£å·ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä½¿ç”¨äº†ä»¥ä¸‹ç«¯å£ï¼š</p>
<ul>
<li>9090: auth-server 9090ï¼šè®¤è¯æœåŠ¡å™¨</li>
<li>9091: resource-server 9091ï¼šèµ„æºæœåŠ¡å™¨</li>
<li>9092: client-server 9092ï¼šå®¢æˆ·ç«¯-æœåŠ¡å™¨</li>
</ul>
<h1 id="ç»“è®º">ç»“è®º</h1>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨ Spring Boot åˆ›å»ºæˆæƒæœåŠ¡å™¨ä»¥åŠå¦‚ä½•åœ¨èµ„æºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æœåŠ¡å™¨ä¸­é…ç½®å®ƒã€‚</p>
<p>æ‚¨å¯ä»¥åœ¨æ­¤ GitHub å­˜å‚¨åº“ä¸­æ‰¾åˆ°æ­¤<a href="https://github.com/kumarprabhashanand/spring-authorization-server">ç¤ºä¾‹çš„ä»£ç </a>ã€‚</p>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.devgenius.io/spring-boot-authorization-server-825230ae0ed2">https://blog.devgenius.io/spring-boot-authorization-server-825230ae0ed2</a></p>
]]></content:encoded>
    </item>
    
    <item>
      <title>[è¯‘]Spring Bootå¼‚å¸¸å¤„ç†å®Œæ•´æŒ‡å—</title>
      <link>https://blog.chensoul.com/posts/2023/07/26/spring-boot-exception-handling/</link>
      <pubDate>Wed, 26 Jul 2023 08:30:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/07/26/spring-boot-exception-handling/</guid>
      <description>å¤„ç†å¼‚å¸¸æ˜¯æ„å»ºå¥å£®åº”ç”¨ç¨‹åºçš„é‡è¦éƒ¨åˆ†ã€‚ Spring Boot æä¾›äº†ä¸æ­¢ä¸€ç§æ–¹æ³•ã€‚ æœ¬æ–‡å°†æ¢è®¨è¿™äº›æ–¹æ³•ï¼Œå¹¶æä¾›ä¸€äº›å…³äºä½•æ—¶æŸç§ç»™å®šæ–¹æ³•å¯èƒ½ä¼˜äºå¦ä¸€ç§æ–¹æ³•çš„æŒ‡å¯¼ã€‚ ç¤º</description>
      <content:encoded><![CDATA[<p>å¤„ç†å¼‚å¸¸æ˜¯æ„å»ºå¥å£®åº”ç”¨ç¨‹åºçš„é‡è¦éƒ¨åˆ†ã€‚ Spring Boot æä¾›äº†ä¸æ­¢ä¸€ç§æ–¹æ³•ã€‚</p>
<p>æœ¬æ–‡å°†æ¢è®¨è¿™äº›æ–¹æ³•ï¼Œå¹¶æä¾›ä¸€äº›å…³äºä½•æ—¶æŸç§ç»™å®šæ–¹æ³•å¯èƒ½ä¼˜äºå¦ä¸€ç§æ–¹æ³•çš„æŒ‡å¯¼ã€‚</p>
<h2 id="ç¤ºä¾‹ä»£ç ">ç¤ºä¾‹ä»£ç </h2>
<p>æœ¬æ–‡é™„æœ‰ GitHub ä¸Šçš„å·¥ä½œ<a href="https://github.com/thombergs/code-examples/tree/master/spring-boot/exception-handling">ä»£ç ç¤ºä¾‹</a>ã€‚</p>
<h2 id="ä»‹ç»">ä»‹ç»</h2>
<p>Spring Boot ä¸ºæˆ‘ä»¬æä¾›äº†å¤„ç†å¼‚å¸¸çš„å·¥å…·ï¼Œè€Œä¸ä»…ä»…æ˜¯ç®€å•çš„â€œtry-catchâ€å—ã€‚ä¸ºäº†ä½¿ç”¨è¿™äº›å·¥å…·ï¼Œæˆ‘ä»¬åº”ç”¨äº†ä¸€äº›æ³¨é‡Šï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿå°†å¼‚å¸¸å¤„ç†è§†ä¸ºæ¨ªåˆ‡å…³æ³¨ç‚¹ï¼š</p>
<ul>
<li><a href="https://reflectoring.io/spring-boot-exception-handling/#responsestatus"><code>@ResponseStatus</code></a></li>
<li><a href="https://reflectoring.io/spring-boot-exception-handling/#exceptionhandler"><code>@ExceptionHandler</code></a></li>
<li><a href="https://reflectoring.io/spring-boot-exception-handling/#controlleradvice"><code>@ControllerAdvice</code></a></li>
</ul>
<p>åœ¨æ·±å…¥äº†è§£è¿™äº›æ³¨é‡Šä¹‹å‰ï¼Œæˆ‘ä»¬å°†é¦–å…ˆäº†è§£ Spring å¦‚ä½•å¤„ç† Web æ§åˆ¶å™¨æŠ›å‡ºçš„å¼‚å¸¸â€”â€”è¿™æ˜¯æ•è·å¼‚å¸¸çš„æœ€åä¸€é“é˜²çº¿ã€‚</p>
<p>æˆ‘ä»¬è¿˜å°†æŸ¥çœ‹ Spring Boot æä¾›çš„ä¸€äº›é…ç½®æ¥ä¿®æ”¹é»˜è®¤è¡Œä¸ºã€‚</p>
<p>æˆ‘ä»¬å°†ç¡®å®šè¿™æ ·åšæ—¶é¢ä¸´çš„æŒ‘æˆ˜ï¼Œç„¶åæˆ‘ä»¬å°†å°è¯•ä½¿ç”¨è¿™äº›æ³¨é‡Šæ¥å…‹æœè¿™äº›æŒ‘æˆ˜ã€‚</p>
<h2 id="spring-booté»˜è®¤çš„å¼‚å¸¸å¤„ç†æœºåˆ¶">Spring Booté»˜è®¤çš„å¼‚å¸¸å¤„ç†æœºåˆ¶</h2>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º <code>ProductController</code> çš„æ§åˆ¶å™¨ï¼Œå½“æœªæ‰¾åˆ°å…·æœ‰ç»™å®š id çš„ <code>Product</code> æ—¶ï¼Œå…¶ <code>getProduct(...)</code> æ–¹æ³•ä¼šæŠ›å‡º <code>NoSuchElementFoundException</code> è¿è¡Œæ—¶å¼‚å¸¸ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span>
</span></span><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/product&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductController</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="kd">final</span> <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//constructor omitted for brevity...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  
</span></span><span class="line"><span class="cl">  <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/{id}&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">Response</span> <span class="nf">getProduct</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="n">String</span> <span class="n">id</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// this method throws a &#34;NoSuchElementFoundException&#34; exception
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="n">productService</span><span class="o">.</span><span class="na">getProduct</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ— æ•ˆçš„ <code>id</code> è°ƒç”¨ <code>/product</code> APIï¼ŒæœåŠ¡å°†æŠ›å‡º <code>NoSuchElementFoundException</code> è¿è¡Œæ—¶å¼‚å¸¸ï¼Œæˆ‘ä»¬å°†å¾—åˆ°ä»¥ä¸‹å“åº”ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;timestamp&#34;</span><span class="p">:</span> <span class="s2">&#34;2020-11-28T13:24:02.239+00:00&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;status&#34;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;error&#34;</span><span class="p">:</span> <span class="s2">&#34;Internal Server Error&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;message&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;path&#34;</span><span class="p">:</span> <span class="s2">&#34;/product/1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†æ ¼å¼è‰¯å¥½çš„é”™è¯¯å“åº”ä¹‹å¤–ï¼Œæœ‰æ•ˆè´Ÿè½½æ²¡æœ‰ä¸ºæˆ‘ä»¬æä¾›ä»»ä½•æœ‰ç”¨çš„ä¿¡æ¯ã€‚ç”šè‡³ <code>message</code> å­—æ®µä¹Ÿæ˜¯ç©ºçš„ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›åŒ…å«â€œæœªæ‰¾åˆ° id 1 çš„é¡¹ç›®â€ä¹‹ç±»çš„å†…å®¹ã€‚</p>
<p>è®©æˆ‘ä»¬ä»ä¿®å¤é”™è¯¯æ¶ˆæ¯é—®é¢˜å¼€å§‹ã€‚</p>
<p>Spring Boot æä¾›äº†ä¸€äº›å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒä»¬æ·»åŠ å¼‚å¸¸æ¶ˆæ¯ã€å¼‚å¸¸ç±»ï¼Œç”šè‡³å †æ ˆè·Ÿè¸ªä½œä¸ºå“åº”è´Ÿè½½çš„ä¸€éƒ¨åˆ†ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">server</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">error</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">include-message</span><span class="p">:</span><span class="w"> </span><span class="l">always</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">include-binding-errors</span><span class="p">:</span><span class="w"> </span><span class="l">always</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">include-stacktrace</span><span class="p">:</span><span class="w"> </span><span class="l">on_trace_param</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">include-exception</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span></code></pre></div><p>åœ¨ <code>application.yml</code> ä¸­ä½¿ç”¨è¿™äº› <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/appendix-application-properties.html#server-properties">Spring Boot æœåŠ¡å™¨å±æ€§</a>ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æŸç§ç¨‹åº¦ä¸Šæ”¹å˜é”™è¯¯å“åº”ã€‚</p>
<p>ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨æ— æ•ˆçš„ <code>id</code> å†æ¬¡è°ƒç”¨ <code>/product</code> APIï¼Œæˆ‘ä»¬å°†å¾—åˆ°ä»¥ä¸‹å“åº”ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;timestamp&#34;</span><span class="p">:</span> <span class="s2">&#34;2020-11-29T09:42:12.287+00:00&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;status&#34;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;error&#34;</span><span class="p">:</span> <span class="s2">&#34;Internal Server Error&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;message&#34;</span><span class="p">:</span> <span class="s2">&#34;Item with id 1 not found&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;path&#34;</span><span class="p">:</span> <span class="s2">&#34;/product/1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span></code></pre></div><p>è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å·²å°†å±æ€§ <code>include-stacktrace</code> è®¾ç½®ä¸º <code>on_trace_param</code> ï¼Œè¿™æ„å‘³ç€ä»…å½“æˆ‘ä»¬åœ¨ URL ( <code>?trace=true</code> ) ä¸­åŒ…å« <code>trace</code> å‚æ•°æ—¶ï¼Œæˆ‘ä»¬æ‰ä¼šåœ¨å“åº”è´Ÿè½½ä¸­è·å¾—å †æ ˆè·Ÿè¸ªï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;timestamp&#34;</span><span class="p">:</span> <span class="s2">&#34;2020-11-29T09:42:12.287+00:00&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;status&#34;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;error&#34;</span><span class="p">:</span> <span class="s2">&#34;Internal Server Error&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;message&#34;</span><span class="p">:</span> <span class="s2">&#34;Item with id 1 not found&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;trace&#34;</span><span class="p">:</span> <span class="s2">&#34;io.reflectoring.exception.exception.NoSuchElementFoundException: Item with id 1 not found...&#34;</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;path&#34;</span><span class="p">:</span> <span class="s2">&#34;/product/1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span></code></pre></div><p>æˆ‘ä»¬å¯èƒ½å¸Œæœ›å°† <code>include-stacktrace</code> æ ‡å¿—çš„å€¼ä¿ç•™ä¸º <code>never</code> ï¼Œè‡³å°‘åœ¨ç”Ÿäº§ä¸­ï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šæ­ç¤ºæˆ‘ä»¬åº”ç”¨ç¨‹åºçš„å†…éƒ¨å·¥ä½œåŸç†ã€‚</p>
<p>ç»§ç»­ï¼çŠ¶æ€å’Œé”™è¯¯æ¶ˆæ¯ - <code>500</code> - è¡¨æ˜æˆ‘ä»¬çš„æœåŠ¡å™¨ä»£ç æœ‰é—®é¢˜ï¼Œä½†å®é™…ä¸Šè¿™æ˜¯å®¢æˆ·ç«¯é”™è¯¯ï¼Œå› ä¸ºå®¢æˆ·ç«¯æä¾›äº†æ— æ•ˆçš„ IDã€‚</p>
<p>æˆ‘ä»¬å½“å‰çš„çŠ¶æ€ä»£ç æ²¡æœ‰æ­£ç¡®åæ˜ è¿™ä¸€ç‚¹ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>server.error</code> é…ç½®å±æ€§çš„èŒƒå›´ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»æŸ¥çœ‹ Spring Boot æä¾›çš„æ³¨é‡Šã€‚</p>
<h2 id="responsestatus"><code>@ResponseStatus</code></h2>
<p>é¡¾åæ€ä¹‰ï¼Œ <code>@ResponseStatus</code> å…è®¸æˆ‘ä»¬ä¿®æ”¹å“åº”çš„ HTTP çŠ¶æ€ã€‚å®ƒå¯ä»¥åº”ç”¨åœ¨ä»¥ä¸‹åœ°æ–¹ï¼š</p>
<ul>
<li>å…³äºå¼‚å¸¸ç±»æœ¬èº«</li>
<li>ä»¥åŠæ–¹æ³•ä¸Šçš„ <code>@ExceptionHandler</code> æ³¨é‡Š</li>
<li>ä»¥åŠç±»ä¸Šçš„ <code>@ControllerAdvice</code> æ³¨é‡Š</li>
</ul>
<p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»…è®¨è®ºç¬¬ä¸€ç§æƒ…å†µã€‚</p>
<p>è®©æˆ‘ä»¬å›åˆ°å½“å‰çš„é—®é¢˜ï¼Œå³æˆ‘ä»¬çš„é”™è¯¯å“åº”æ€»æ˜¯ç»™æˆ‘ä»¬ HTTP çŠ¶æ€ 500ï¼Œè€Œä¸æ˜¯æ›´å…·æè¿°æ€§çš„çŠ¶æ€ä»£ç ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ <code>@ResponseStatus</code> æ³¨é‡Šæˆ‘ä»¬çš„ Exception ç±»ï¼Œå¹¶åœ¨å…¶ <code>value</code> å±æ€§ä¸­ä¼ å…¥æ‰€éœ€çš„ HTTP å“åº”çŠ¶æ€ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@ResponseStatus</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="n">HttpStatus</span><span class="o">.</span><span class="na">NOT_FOUND</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NoSuchElementFoundException</span> <span class="kd">extends</span> <span class="n">RuntimeException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ— æ•ˆ ID è°ƒç”¨æ§åˆ¶å™¨ï¼Œæ­¤æ›´æ”¹å°†å¸¦æ¥æ›´å¥½çš„å“åº”ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;timestamp&#34;</span><span class="p">:</span> <span class="s2">&#34;2020-11-29T09:42:12.287+00:00&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;status&#34;</span><span class="p">:</span> <span class="mi">404</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;error&#34;</span><span class="p">:</span> <span class="s2">&#34;Not Found&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;message&#34;</span><span class="p">:</span> <span class="s2">&#34;Item with id 1 not found&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;path&#34;</span><span class="p">:</span> <span class="s2">&#34;/product/1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span></code></pre></div><p>å®ç°ç›¸åŒç›®çš„çš„å¦ä¸€ç§æ–¹æ³•æ˜¯æ‰©å±• <code>ResponseStatusException</code> ç±»ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NoSuchElementFoundException</span> <span class="kd">extends</span> <span class="n">ResponseStatusException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="nf">NoSuchElementFoundException</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">    <span class="kd">super</span><span class="o">(</span><span class="n">HttpStatus</span><span class="o">.</span><span class="na">NOT_FOUND</span><span class="o">,</span> <span class="n">message</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">HttpHeaders</span> <span class="nf">getResponseHeaders</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// return response headers
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>å½“æˆ‘ä»¬æƒ³è¦æ“ä½œå“åº”å¤´æ—¶ï¼Œè¿™ç§æ–¹æ³•ä¼šæ´¾ä¸Šç”¨åœºï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥é‡å†™ <code>getResponseHeaders()</code> æ–¹æ³•ã€‚</p>
<p><code>@ResponseStatus</code> ä¸ <code>server.error</code> é…ç½®å±æ€§ç›¸ç»“åˆï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿæ“ä½œ Spring å®šä¹‰çš„é”™è¯¯å“åº”è´Ÿè½½ä¸­çš„å‡ ä¹æ‰€æœ‰å­—æ®µã€‚</p>
<p>ä½†æ˜¯å¦‚æœè¿˜æƒ³æ“çºµå“åº”è´Ÿè½½çš„ç»“æ„æ€ä¹ˆåŠï¼Ÿ</p>
<p>è®©æˆ‘ä»¬åœ¨ä¸‹ä¸€èŠ‚ä¸­çœ‹çœ‹å¦‚ä½•å®ç°è¿™ä¸€ç›®æ ‡ã€‚</p>
<h2 id="exceptionhandler"><code>@ExceptionHandler</code></h2>
<p><code>@ExceptionHandler</code> æ³¨é‡Šåœ¨å¤„ç†å¼‚å¸¸æ–¹é¢ä¸ºæˆ‘ä»¬æä¾›äº†å¾ˆå¤§çš„çµæ´»æ€§ã€‚å¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œè¦ä½¿ç”¨å®ƒï¼Œæˆ‘ä»¬åªéœ€åœ¨æ§åˆ¶å™¨æœ¬èº«æˆ– <code>@ControllerAdvice</code> ç±»ä¸­åˆ›å»ºä¸€ä¸ªæ–¹æ³•ï¼Œå¹¶ç”¨ <code>@ExceptionHandler</code> æ³¨é‡Šå®ƒï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span>
</span></span><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/product&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductController</span> <span class="o">{</span> 
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="kd">final</span> <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1">//constructor omitted for brevity...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/{id}&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">Response</span> <span class="nf">getProduct</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">productService</span><span class="o">.</span><span class="na">getProduct</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="n">NoSuchElementFoundException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="nd">@ResponseStatus</span><span class="o">(</span><span class="n">HttpStatus</span><span class="o">.</span><span class="na">NOT_FOUND</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">handleNoSuchElementFoundException</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">NoSuchElementFoundException</span> <span class="n">exception</span>
</span></span><span class="line"><span class="cl">  <span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">ResponseEntity</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="n">HttpStatus</span><span class="o">.</span><span class="na">NOT_FOUND</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="n">exception</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>å¼‚å¸¸å¤„ç†ç¨‹åºæ–¹æ³•æ¥å—ä¸€ä¸ªå¼‚å¸¸æˆ–å¼‚å¸¸åˆ—è¡¨ä½œä¸ºæˆ‘ä»¬è¦åœ¨å®šä¹‰çš„æ–¹æ³•ä¸­å¤„ç†çš„å‚æ•°ã€‚æˆ‘ä»¬ç”¨ <code>@ExceptionHandler</code> å’Œ <code>@ResponseStatus</code> æ³¨é‡Šè¯¥æ–¹æ³•æ¥å®šä¹‰æˆ‘ä»¬æƒ³è¦å¤„ç†çš„å¼‚å¸¸å’Œæˆ‘ä»¬æƒ³è¦è¿”å›çš„çŠ¶æ€ä»£ç ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬ä¸æƒ³ä½¿ç”¨è¿™äº›æ³¨é‡Šï¼Œé‚£ä¹ˆåªéœ€å°†å¼‚å¸¸å®šä¹‰ä¸ºæ–¹æ³•çš„å‚æ•°ä¹Ÿå¯ä»¥ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@ExceptionHandler</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">handleNoSuchElementFoundException</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">NoSuchElementFoundException</span> <span class="n">exception</span><span class="o">)</span>
</span></span></code></pre></div><p>å°½ç®¡æˆ‘ä»¬å·²ç»åœ¨æ–¹æ³•ç­¾åä¸­æåˆ°äº†å®ƒï¼Œä½†åœ¨æ³¨é‡Šä¸­æåŠå¼‚å¸¸ç±»æ˜¯ä¸ªå¥½ä¸»æ„ã€‚å®ƒæä¾›äº†æ›´å¥½çš„å¯è¯»æ€§ã€‚</p>
<p>æ­¤å¤–ï¼Œå¤„ç†ç¨‹åºæ–¹æ³•ä¸Šçš„æ³¨é‡Š <code>@ResponseStatus(HttpStatus.NOT_FOUND)</code> ä¸æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºä¼ é€’åˆ° <code>ResponseEnity</code> çš„ HTTP çŠ¶æ€å°†ä¼˜å…ˆï¼Œä½†å‡ºäºç›¸åŒçš„å¯è¯»æ€§åŸå› ï¼Œæˆ‘ä»¬ä»ç„¶ä¿ç•™å®ƒã€‚</p>
<p>é™¤äº†å¼‚å¸¸å‚æ•°ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ <code>HttpServletRequest</code> ã€ <code>WebRequest</code> æˆ– <code>HttpSession</code> ç±»å‹ä½œä¸ºå‚æ•°ã€‚</p>
<p>åŒæ ·ï¼Œå¤„ç†ç¨‹åºæ–¹æ³•æ”¯æŒå„ç§è¿”å›ç±»å‹ï¼Œä¾‹å¦‚ <code>ResponseEntity</code> ã€ <code>String</code> ç”šè‡³ <code>void</code> ã€‚</p>
<p>åœ¨ <code>@ExceptionHandler</code> <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/ExceptionHandler.html">java æ–‡æ¡£</a>ä¸­æŸ¥æ‰¾æ›´å¤šè¾“å…¥å’Œè¿”å›ç±»å‹ã€‚</p>
<p>åœ¨å¼‚å¸¸å¤„ç†å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¾“å…¥å‚æ•°å’Œè¿”å›ç±»å‹çš„å½¢å¼ä½¿ç”¨è®¸å¤šä¸åŒçš„é€‰é¡¹ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å®Œå…¨æ§åˆ¶é”™è¯¯å“åº”ã€‚</p>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æœ€ç»ˆç¡®å®š API çš„é”™è¯¯å“åº”è´Ÿè½½ã€‚å¦‚æœå‡ºç°ä»»ä½•é”™è¯¯ï¼Œå®¢æˆ·é€šå¸¸ä¼šæœŸæœ›ä¸¤ä»¶äº‹ï¼š</p>
<ul>
<li>
<p>é”™è¯¯ä»£ç å‘Šè¯‰å®¢æˆ·ç«¯å®ƒæ˜¯ä»€ä¹ˆç±»å‹çš„é”™è¯¯ã€‚å®¢æˆ·ç«¯å¯ä»¥åœ¨å…¶ä»£ç ä¸­ä½¿ç”¨é”™è¯¯ä»£ç æ¥é©±åŠ¨åŸºäºå®ƒçš„æŸäº›ä¸šåŠ¡é€»è¾‘ã€‚é€šå¸¸ï¼Œé”™è¯¯ä»£ç æ˜¯æ ‡å‡†çš„ HTTP çŠ¶æ€ä»£ç ï¼Œä½†æˆ‘ä¹Ÿçœ‹åˆ° API è¿”å›è‡ªå®šä¹‰é”™è¯¯ä»£ç ï¼Œä¾‹å¦‚ <code>E001</code> ã€‚</p>
</li>
<li>
<p>ä¸€æ¡é™„åŠ çš„äººç±»å¯è¯»æ¶ˆæ¯ï¼Œæä¾›æœ‰å…³é”™è¯¯çš„æ›´å¤šä¿¡æ¯ï¼Œç”šè‡³æä¾›æœ‰å…³å¦‚ä½•ä¿®å¤é”™è¯¯çš„ä¸€äº›æç¤ºæˆ– API æ–‡æ¡£çš„é“¾æ¥ã€‚</p>
</li>
</ul>
<p>æˆ‘ä»¬è¿˜å°†æ·»åŠ ä¸€ä¸ªå¯é€‰çš„ <code>stackTrace</code> å­—æ®µï¼Œè¿™å°†å¸®åŠ©æˆ‘ä»¬åœ¨å¼€å‘ç¯å¢ƒä¸­è¿›è¡Œè°ƒè¯•ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬è¿˜æƒ³å¤„ç†å“åº”ä¸­çš„éªŒè¯é”™è¯¯ã€‚æ‚¨å¯ä»¥åœ¨è¿™ç¯‡æœ‰å…³ä½¿ç”¨ Spring Boot å¤„ç†éªŒè¯çš„æ–‡ç« ä¸­æ‰¾åˆ°æœ‰å…³ bean éªŒè¯çš„æ›´å¤šä¿¡æ¯ã€‚</p>
<p>è®°ä½è¿™äº›ç‚¹ï¼Œæˆ‘ä»¬å°†ä¸ºé”™è¯¯å“åº”ä½¿ç”¨ä»¥ä¸‹æœ‰æ•ˆè´Ÿè½½ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Getter</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Setter</span>
</span></span><span class="line"><span class="cl"><span class="nd">@RequiredArgsConstructor</span>
</span></span><span class="line"><span class="cl"><span class="nd">@JsonInclude</span><span class="o">(</span><span class="n">JsonInclude</span><span class="o">.</span><span class="na">Include</span><span class="o">.</span><span class="na">NON_NULL</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ErrorResponse</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">status</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">message</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="n">String</span> <span class="n">stackTrace</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ValidationError</span><span class="o">&gt;</span> <span class="n">errors</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Getter</span>
</span></span><span class="line"><span class="cl">  <span class="nd">@Setter</span>
</span></span><span class="line"><span class="cl">  <span class="nd">@RequiredArgsConstructor</span>
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ValidationError</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">field</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">message</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addValidationError</span><span class="o">(</span><span class="n">String</span> <span class="n">field</span><span class="o">,</span> <span class="n">String</span> <span class="n">message</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="o">(</span><span class="n">Objects</span><span class="o">.</span><span class="na">isNull</span><span class="o">(</span><span class="n">errors</span><span class="o">)){</span>
</span></span><span class="line"><span class="cl">      <span class="n">errors</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">errors</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">ValidationError</span><span class="o">(</span><span class="n">field</span><span class="o">,</span> <span class="n">message</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°†æ‰€æœ‰è¿™äº›åº”ç”¨åˆ° <code>NoSuchElementFoundException</code> å¤„ç†ç¨‹åºæ–¹æ³•ä¸­ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span>
</span></span><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;/product&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@AllArgsConstructor</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductController</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TRACE</span> <span class="o">=</span> <span class="s">&#34;trace&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Value</span><span class="o">(</span><span class="s">&#34;${reflectoring.trace:false}&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">printStackTrace</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="kd">final</span> <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/{id}&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">Product</span> <span class="nf">getProduct</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="n">String</span> <span class="n">id</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">productService</span><span class="o">.</span><span class="na">getProduct</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@PostMapping</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">Product</span> <span class="nf">addProduct</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="nd">@Valid</span> <span class="n">ProductInput</span> <span class="n">input</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">productService</span><span class="o">.</span><span class="na">addProduct</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="n">NoSuchElementFoundException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="nd">@ResponseStatus</span><span class="o">(</span><span class="n">HttpStatus</span><span class="o">.</span><span class="na">NOT_FOUND</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">ErrorResponse</span><span class="o">&gt;</span> <span class="nf">handleItemNotFoundException</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">NoSuchElementFoundException</span> <span class="n">exception</span><span class="o">,</span> 
</span></span><span class="line"><span class="cl">      <span class="n">WebRequest</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl">  <span class="o">){</span>
</span></span><span class="line"><span class="cl">    <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;Failed to find the requested element&#34;</span><span class="o">,</span> <span class="n">exception</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">buildErrorResponse</span><span class="o">(</span><span class="n">exception</span><span class="o">,</span> <span class="n">HttpStatus</span><span class="o">.</span><span class="na">NOT_FOUND</span><span class="o">,</span> <span class="n">request</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="n">MethodArgumentNotValidException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="nd">@ResponseStatus</span><span class="o">(</span><span class="n">HttpStatus</span><span class="o">.</span><span class="na">UNPROCESSABLE_ENTITY</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">ErrorResponse</span><span class="o">&gt;</span> <span class="nf">handleMethodArgumentNotValid</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">MethodArgumentNotValidException</span> <span class="n">ex</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">WebRequest</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl">  <span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">ErrorResponse</span> <span class="n">errorResponse</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ErrorResponse</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">HttpStatus</span><span class="o">.</span><span class="na">UNPROCESSABLE_ENTITY</span><span class="o">.</span><span class="na">value</span><span class="o">(),</span> 
</span></span><span class="line"><span class="cl">        <span class="s">&#34;Validation error. Check &#39;errors&#39; field for details.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="o">(</span><span class="n">FieldError</span> <span class="n">fieldError</span> <span class="o">:</span> <span class="n">ex</span><span class="o">.</span><span class="na">getBindingResult</span><span class="o">().</span><span class="na">getFieldErrors</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">errorResponse</span><span class="o">.</span><span class="na">addValidationError</span><span class="o">(</span><span class="n">fieldError</span><span class="o">.</span><span class="na">getField</span><span class="o">(),</span> 
</span></span><span class="line"><span class="cl">          <span class="n">fieldError</span><span class="o">.</span><span class="na">getDefaultMessage</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">ResponseEntity</span><span class="o">.</span><span class="na">unprocessableEntity</span><span class="o">().</span><span class="na">body</span><span class="o">(</span><span class="n">errorResponse</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="n">Exception</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="nd">@ResponseStatus</span><span class="o">(</span><span class="n">HttpStatus</span><span class="o">.</span><span class="na">INTERNAL_SERVER_ERROR</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">ErrorResponse</span><span class="o">&gt;</span> <span class="nf">handleAllUncaughtException</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">Exception</span> <span class="n">exception</span><span class="o">,</span> 
</span></span><span class="line"><span class="cl">      <span class="n">WebRequest</span> <span class="n">request</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">    <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;Unknown error occurred&#34;</span><span class="o">,</span> <span class="n">exception</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">buildErrorResponse</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">exception</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#34;Unknown error occurred&#34;</span><span class="o">,</span> 
</span></span><span class="line"><span class="cl">        <span class="n">HttpStatus</span><span class="o">.</span><span class="na">INTERNAL_SERVER_ERROR</span><span class="o">,</span> 
</span></span><span class="line"><span class="cl">        <span class="n">request</span>
</span></span><span class="line"><span class="cl">    <span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">ErrorResponse</span><span class="o">&gt;</span> <span class="nf">buildErrorResponse</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">Exception</span> <span class="n">exception</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">HttpStatus</span> <span class="n">httpStatus</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">WebRequest</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl">  <span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">buildErrorResponse</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">exception</span><span class="o">,</span> 
</span></span><span class="line"><span class="cl">        <span class="n">exception</span><span class="o">.</span><span class="na">getMessage</span><span class="o">(),</span> 
</span></span><span class="line"><span class="cl">        <span class="n">httpStatus</span><span class="o">,</span> 
</span></span><span class="line"><span class="cl">        <span class="n">request</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">ErrorResponse</span><span class="o">&gt;</span> <span class="nf">buildErrorResponse</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">Exception</span> <span class="n">exception</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">String</span> <span class="n">message</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">HttpStatus</span> <span class="n">httpStatus</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">WebRequest</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl">  <span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">ErrorResponse</span> <span class="n">errorResponse</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ErrorResponse</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">httpStatus</span><span class="o">.</span><span class="na">value</span><span class="o">(),</span> 
</span></span><span class="line"><span class="cl">        <span class="n">exception</span><span class="o">.</span><span class="na">getMessage</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="o">(</span><span class="n">printStackTrace</span> <span class="o">&amp;&amp;</span> <span class="n">isTraceOn</span><span class="o">(</span><span class="n">request</span><span class="o">)){</span>
</span></span><span class="line"><span class="cl">      <span class="n">errorResponse</span><span class="o">.</span><span class="na">setStackTrace</span><span class="o">(</span><span class="n">ExceptionUtils</span><span class="o">.</span><span class="na">getStackTrace</span><span class="o">(</span><span class="n">exception</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">ResponseEntity</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="n">httpStatus</span><span class="o">).</span><span class="na">body</span><span class="o">(</span><span class="n">errorResponse</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">isTraceOn</span><span class="o">(</span><span class="n">WebRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="o">[]</span> <span class="n">value</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameterValues</span><span class="o">(</span><span class="n">TRACE</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Objects</span><span class="o">.</span><span class="na">nonNull</span><span class="o">(</span><span class="n">value</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">&amp;&amp;</span> <span class="n">value</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="n">0</span>
</span></span><span class="line"><span class="cl">        <span class="o">&amp;&amp;</span> <span class="n">value</span><span class="o">[</span><span class="n">0</span><span class="o">].</span><span class="na">contentEquals</span><span class="o">(</span><span class="s">&#34;true&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>è¿™é‡Œéœ€è¦æ³¨æ„å‡ ç‚¹ï¼š</p>
<h3 id="æä¾›å †æ ˆè·Ÿè¸ª">æä¾›å †æ ˆè·Ÿè¸ª</h3>
<p>åœ¨é”™è¯¯å“åº”ä¸­æä¾›å †æ ˆè·Ÿè¸ªå¯ä»¥ä½¿æˆ‘ä»¬çš„å¼€å‘äººå‘˜å’Œ QA å·¥ç¨‹å¸ˆå…å»çˆ¬è¡Œæ—¥å¿—æ–‡ä»¶çš„éº»çƒ¦ã€‚</p>
<p>æ­£å¦‚æˆ‘ä»¬åœ¨ <a href="https://reflectoring.io/spring-boot-exception-handling/#spring-boots-default-exception-handling-mechanism">Spring Boot çš„é»˜è®¤å¼‚å¸¸å¤„ç†æœºåˆ¶</a>ä¸­çœ‹åˆ°çš„ï¼ŒSpring å·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†è¿™ä¸ªåŠŸèƒ½ã€‚ä½†ç°åœ¨ï¼Œç”±äºæˆ‘ä»¬è‡ªå·±å¤„ç†é”™è¯¯å“åº”ï¼Œå› æ­¤è¿™ä¹Ÿéœ€è¦æˆ‘ä»¬è‡ªå·±å¤„ç†ã€‚</p>
<p>ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº†ä¸€ä¸ªåä¸º <code>reflectoring.trace</code> çš„æœåŠ¡å™¨ç«¯é…ç½®å±æ€§ï¼Œå¦‚æœå°†å…¶è®¾ç½®ä¸º <code>true</code> ï¼Œä¸ºäº†å®ç°æ­¤ç›®çš„ï¼Œæˆ‘ä»¬é¦–å…ˆå¼•å…¥äº†ä¸€ä¸ªåä¸º <code>reflectoring.trace</code> çš„æœåŠ¡å™¨ç«¯é…ç½®å±æ€§ï¼Œå¦‚æœå°†å…¶è®¾ç½®ä¸º <code>true</code> ï¼Œå°†å¯ç”¨å“åº”ä¸­çš„ <code>stackTrace</code> å­—æ®µã€‚è¦å®é™…åœ¨ API å“åº”ä¸­è·å– <code>stackTrace</code> ï¼Œæˆ‘ä»¬çš„å®¢æˆ·ç«¯è¿˜å¿…é¡»ä¼ é€’å¸¦æœ‰å€¼ <code>true</code> çš„ <code>trace</code> å‚æ•°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl --location --request GET <span class="s1">&#39;http://localhost:8080/product/1?trace=true&#39;</span>
</span></span></code></pre></div><p>ç°åœ¨ï¼Œç”±äº <code>stackTrace</code> çš„è¡Œä¸ºç”±å±æ€§æ–‡ä»¶ä¸­çš„åŠŸèƒ½æ ‡å¿—æ§åˆ¶ï¼Œå› æ­¤å½“æˆ‘ä»¬åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éƒ¨ç½²æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶åˆ é™¤æˆ–å°†å…¶è®¾ç½®ä¸º <code>false</code> ã€‚</p>
<h3 id="æ•è·æ‰€æœ‰å¼‚å¸¸å¤„ç†ç¨‹åº">æ•è·æ‰€æœ‰å¼‚å¸¸å¤„ç†ç¨‹åº</h3>
<p><em>éœ€è¦æŠŠä»–ä»¬å…¨éƒ½æŠ“åˆ°ï¼š</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">try</span><span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">performSomeOperation</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">OperationSpecificException</span> <span class="n">ex</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">catchAllExcetion</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//...  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>ä½œä¸ºä¸€é¡¹è°¨æ…æªæ–½ï¼Œæˆ‘ä»¬ç»å¸¸ç”¨ä¸€ä¸ªåŒ…ç½—ä¸‡è±¡çš„ try-catch å¼‚å¸¸å¤„ç†ç¨‹åºå—åŒ…å›´é¡¶çº§æ–¹æ³•çš„ä¸»ä½“ï¼Œä»¥é¿å…ä»»ä½•ä¸éœ€è¦çš„å‰¯ä½œç”¨æˆ–è¡Œä¸ºã€‚æˆ‘ä»¬æ§åˆ¶å™¨ä¸­çš„ <code>handleAllUncaughtException()</code> æ–¹æ³•çš„è¡Œä¸ºç±»ä¼¼ã€‚å®ƒå°†æ•è·æˆ‘ä»¬æ²¡æœ‰ç‰¹å®šå¤„ç†ç¨‹åºçš„æ‰€æœ‰å¼‚å¸¸ã€‚</p>
<p>æˆ‘æƒ³åœ¨è¿™é‡ŒæŒ‡å‡ºçš„ä¸€ä»¶äº‹æ˜¯ï¼Œå³ä½¿æˆ‘ä»¬æ²¡æœ‰è¿™ä¸ªåŒ…ç½—ä¸‡è±¡çš„å¼‚å¸¸å¤„ç†ç¨‹åºï¼ŒSpring ä¹Ÿä¼šå¤„ç†å®ƒã€‚ä½†æˆ‘ä»¬å¸Œæœ›å“åº”é‡‡ç”¨æˆ‘ä»¬çš„æ ¼å¼è€Œä¸æ˜¯ Spring çš„æ ¼å¼ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»è‡ªå·±å¤„ç†å¼‚å¸¸ã€‚</p>
<p>åŒ…ç½—ä¸‡è±¡çš„å¤„ç†ç¨‹åºæ–¹æ³•ä¹Ÿæ˜¯è®°å½•å¼‚å¸¸çš„å¥½åœ°æ–¹ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥æ·±å…¥äº†è§£å¯èƒ½çš„é”™è¯¯ã€‚æˆ‘ä»¬å¯ä»¥è·³è¿‡è®°å½•å­—æ®µéªŒè¯å¼‚å¸¸ï¼Œä¾‹å¦‚ <code>MethodArgumentNotValidException</code> ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ç”±äºè¯­æ³•ä¸Šæ— æ•ˆçš„è¾“å…¥è€Œå¼•å‘çš„ï¼Œä½†æˆ‘ä»¬åº”è¯¥å§‹ç»ˆåœ¨æ•è·æ‰€æœ‰å¤„ç†ç¨‹åºä¸­è®°å½•æœªçŸ¥å¼‚å¸¸ã€‚</p>
<h3 id="å¼‚å¸¸å¤„ç†ç¨‹åºçš„é¡ºåº">å¼‚å¸¸å¤„ç†ç¨‹åºçš„é¡ºåº</h3>
<p>æåŠå¤„ç†ç¨‹åºæ–¹æ³•çš„é¡ºåºå¹¶ä¸é‡è¦ã€‚ Springå°†é¦–å…ˆå¯»æ‰¾æœ€å…·ä½“çš„å¼‚å¸¸å¤„ç†æ–¹æ³•ã€‚</p>
<p>å¦‚æœæ‰¾ä¸åˆ°å®ƒï¼Œé‚£ä¹ˆå®ƒå°†æŸ¥æ‰¾çˆ¶å¼‚å¸¸çš„å¤„ç†ç¨‹åºï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯ <code>RuntimeException</code> ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ <code>handleAllUncaughtException()</code> æ–¹æ³•å°†æœ€ç»ˆå¤„ç†è¯¥å¼‚å¸¸ã€‚</p>
<p>è¿™åº”è¯¥å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¤„ç†è¿™ä¸ªç‰¹å®šæ§åˆ¶å™¨ä¸­çš„å¼‚å¸¸ï¼Œä½†æ˜¯å¦‚æœå…¶ä»–æ§åˆ¶å™¨ä¹ŸæŠ›å‡ºè¿™äº›ç›¸åŒçš„å¼‚å¸¸æ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬å¦‚ä½•å¤„ç†è¿™äº›ï¼Ÿæˆ‘ä»¬æ˜¯å¦åœ¨æ‰€æœ‰æ§åˆ¶å™¨ä¸­åˆ›å»ºç›¸åŒçš„å¤„ç†ç¨‹åºï¼Œæˆ–è€…åˆ›å»ºå…·æœ‰å…¬å…±å¤„ç†ç¨‹åºçš„åŸºç±»å¹¶åœ¨æ‰€æœ‰æ§åˆ¶å™¨ä¸­æ‰©å±•å®ƒï¼Ÿ</p>
<p>å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬ä¸å¿…è¿™æ ·åšã€‚ Spring ä»¥â€œæ§åˆ¶å™¨å»ºè®®â€çš„å½¢å¼ä¸ºè¿™ä¸ªé—®é¢˜æä¾›äº†ä¸€ä¸ªéå¸¸ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>è®©æˆ‘ä»¬ç ”ç©¶ä¸€ä¸‹å®ƒä»¬ã€‚</p>
<h2 id="controlleradvice"><code>@ControllerAdvice</code></h2>
<blockquote>
<p><strong>ä¸ºä»€ä¹ˆç§°ä¸ºâ€œæ§åˆ¶å™¨å»ºè®®â€ï¼Ÿ</strong></p>
<p>â€œå»ºè®®â€ä¸€è¯æ¥è‡ªé¢å‘æ–¹é¢ç¼–ç¨‹ (AOP)ï¼Œå®ƒå…è®¸æˆ‘ä»¬å›´ç»•ç°æœ‰æ–¹æ³•æ³¨å…¥æ¨ªåˆ‡ä»£ç ï¼ˆç§°ä¸ºâ€œå»ºè®®â€ï¼‰ã€‚æ§åˆ¶å™¨å»ºè®®å…è®¸æˆ‘ä»¬æ‹¦æˆªå’Œä¿®æ”¹æ§åˆ¶å™¨æ–¹æ³•çš„è¿”å›å€¼ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯ä¸ºäº†å¤„ç†å¼‚å¸¸ã€‚</p>
</blockquote>
<p>æ§åˆ¶å™¨å»ºè®®ç±»å…è®¸æˆ‘ä»¬å°†å¼‚å¸¸å¤„ç†ç¨‹åºåº”ç”¨äºåº”ç”¨ç¨‹åºä¸­çš„å¤šä¸ªæˆ–æ‰€æœ‰æ§åˆ¶å™¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@ControllerAdvice</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GlobalExceptionHandler</span> <span class="kd">extends</span> <span class="n">ResponseEntityExceptionHandler</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TRACE</span> <span class="o">=</span> <span class="s">&#34;trace&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Value</span><span class="o">(</span><span class="s">&#34;${reflectoring.trace:false}&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">printStackTrace</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="nd">@ResponseStatus</span><span class="o">(</span><span class="n">HttpStatus</span><span class="o">.</span><span class="na">UNPROCESSABLE_ENTITY</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="kd">protected</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="nf">handleMethodArgumentNotValid</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">MethodArgumentNotValidException</span> <span class="n">ex</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">HttpHeaders</span> <span class="n">headers</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">HttpStatus</span> <span class="n">status</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">WebRequest</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl">  <span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">//Body omitted as it&#39;s similar to the method of same name
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">// in ProductController example...  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">//.....
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="n">ItemNotFoundException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="nd">@ResponseStatus</span><span class="o">(</span><span class="n">HttpStatus</span><span class="o">.</span><span class="na">NOT_FOUND</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="nf">handleItemNotFoundException</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">ItemNotFoundException</span> <span class="n">itemNotFoundException</span><span class="o">,</span> 
</span></span><span class="line"><span class="cl">      <span class="n">WebRequest</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl">  <span class="o">){</span>
</span></span><span class="line"><span class="cl">      <span class="c1">//Body omitted as it&#39;s similar to the method of same name
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">// in ProductController example...  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">//.....  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@ExceptionHandler</span><span class="o">(</span><span class="n">RuntimeException</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="nd">@ResponseStatus</span><span class="o">(</span><span class="n">HttpStatus</span><span class="o">.</span><span class="na">INTERNAL_SERVER_ERROR</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="nf">handleAllUncaughtException</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">RuntimeException</span> <span class="n">exception</span><span class="o">,</span> 
</span></span><span class="line"><span class="cl">      <span class="n">WebRequest</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl">  <span class="o">){</span>
</span></span><span class="line"><span class="cl">      <span class="c1">//Body omitted as it&#39;s similar to the method of same name
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">// in ProductController example...  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">//.....
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="o">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1">//....
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="nf">handleExceptionInternal</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="n">Exception</span> <span class="n">ex</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">Object</span> <span class="n">body</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">HttpHeaders</span> <span class="n">headers</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">HttpStatus</span> <span class="n">status</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">WebRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">buildErrorResponse</span><span class="o">(</span><span class="n">ex</span><span class="o">,</span><span class="n">status</span><span class="o">,</span><span class="n">request</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>å¤„ç†å‡½æ•°çš„ä¸»ä½“å’Œå…¶ä»–æ”¯æŒä»£ç è¢«çœç•¥ï¼Œå› ä¸ºå®ƒä»¬ä¸æˆ‘ä»¬åœ¨ @ExceptionHandler éƒ¨åˆ†çœ‹åˆ°çš„ä»£ç å‡ ä¹ç›¸åŒã€‚è¯·åœ¨ Github Repo çš„ <a href="https://github.com/thombergs/code-examples/blob/master/spring-boot/exception-handling/src/main/java/io/reflectoring/exception/exception/GlobalExceptionHandler.java">GlobalExceptionHandler</a> ç±»ä¸­æ‰¾åˆ°å®Œæ•´çš„ä»£ç ã€‚</p>
<p>æœ‰å‡ ä»¶äº‹æ˜¯æ–°çš„ï¼Œæˆ‘ä»¬ç¨åä¼šè®¨è®ºã€‚è¿™é‡Œçš„ä¸€ä¸ªä¸»è¦åŒºåˆ«æ˜¯è¿™äº›å¤„ç†ç¨‹åºå°†å¤„ç†åº”ç”¨ç¨‹åºä¸­æ‰€æœ‰æ§åˆ¶å™¨æŠ›å‡ºçš„å¼‚å¸¸ï¼Œè€Œä¸ä»…ä»…æ˜¯ <code>ProductController</code> ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æƒ³æœ‰é€‰æ‹©åœ°å°†æ§åˆ¶å™¨å»ºè®®çš„èŒƒå›´åº”ç”¨æˆ–é™åˆ¶åˆ°ç‰¹å®šæ§åˆ¶å™¨æˆ–åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ³¨é‡Šæä¾›çš„å±æ€§ï¼š</p>
<ul>
<li><code>@ControllerAdvice(&quot;com.reflectoring.controller&quot;)</code> ï¼šæˆ‘ä»¬å¯ä»¥åœ¨æ³¨é‡Šçš„ <code>value</code> æˆ– <code>basePackages</code> å‚æ•°ä¸­ä¼ é€’åŒ…åç§°æˆ–åŒ…åç§°åˆ—è¡¨ã€‚è¿™æ ·ï¼Œæ§åˆ¶å™¨å»ºè®®å°†ä»…å¤„ç†è¯¥åŒ…æ§åˆ¶å™¨çš„å¼‚å¸¸ã€‚</li>
<li><code>@ControllerAdvice(annotations = Advised.class)</code> ï¼šåªæœ‰æ ‡æœ‰ <code>@Advised</code> æ³¨é‡Šçš„æ§åˆ¶å™¨æ‰ä¼šç”±æ§åˆ¶å™¨å»ºè®®å¤„ç†ã€‚</li>
</ul>
<p>åœ¨ <code>@ControllerAdvice</code> <a href="https://www.javadoc.io/doc/org.springframework/spring-web/4.3.8.RELEASE/org/springframework/web/bind/annotation/ControllerAdvice.html">æ³¨é‡Šæ–‡æ¡£</a>ä¸­æŸ¥æ‰¾å…¶ä»–å‚æ•°ã€‚</p>
<h3 id="responseentityexceptionhandler"><code>ResponseEntityExceptionHandler</code></h3>
<p><code>ResponseEntityExceptionHandler</code> æ˜¯æ§åˆ¶å™¨å»ºè®®ç±»çš„ä¾¿æ·åŸºç±»ã€‚å®ƒä¸ºå†…éƒ¨ Spring å¼‚å¸¸æä¾›å¼‚å¸¸å¤„ç†ç¨‹åºã€‚å¦‚æœæˆ‘ä»¬ä¸æ‰©å±•å®ƒï¼Œé‚£ä¹ˆæ‰€æœ‰å¼‚å¸¸å°†è¢«é‡å®šå‘åˆ° <code>DefaultHandlerExceptionResolver</code> ï¼Œå®ƒè¿”å›ä¸€ä¸ª <code>ModelAndView</code> å¯¹è±¡ã€‚å› ä¸ºæˆ‘ä»¬çš„ä½¿å‘½æ˜¯å¡‘é€ æˆ‘ä»¬è‡ªå·±çš„é”™è¯¯å“åº”ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¸Œæœ›è¿™æ ·ã€‚</p>
<p>æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬é‡å†™äº†ä¸¤ä¸ª <code>ResponseEntityExceptionHandler</code> æ–¹æ³•ï¼š</p>
<ul>
<li><code>handleMethodArgumentNotValid()</code> ï¼šåœ¨ @ExceptionHandler éƒ¨åˆ†ï¼Œæˆ‘ä»¬è‡ªå·±å®ç°äº†ä¸€ä¸ªå¤„ç†ç¨‹åºã€‚åœ¨è¿™é‡Œæˆ‘ä»¬åªæ˜¯è¦†ç›–äº†å®ƒçš„è¡Œä¸ºã€‚</li>
<li><code>handleExceptionInternal()</code> ï¼š <code>ResponseEntityExceptionHandler</code> ä¸­çš„æ‰€æœ‰å¤„ç†ç¨‹åºéƒ½ä½¿ç”¨æ­¤å‡½æ•°æ¥æ„å»ºç±»ä¼¼äº <code>buildErrorResponse()</code> çš„ <code>ResponseEntity</code> ã€‚å¦‚æœæˆ‘ä»¬ä¸é‡å†™æ­¤æ–¹æ³•ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å°†ä»…æ”¶åˆ°å“åº”æ ‡å¤´ä¸­çš„ HTTP çŠ¶æ€ï¼Œä½†ç”±äºæˆ‘ä»¬ä¹Ÿå¸Œæœ›åœ¨å“åº”æ­£æ–‡ä¸­åŒ…å« HTTP çŠ¶æ€ï¼Œå› æ­¤æˆ‘ä»¬é‡å†™äº†è¯¥æ–¹æ³•ã€‚</li>
</ul>
<blockquote>
<h4 id="å¤„ç†-nohandlerfoundexception-éœ€è¦ä¸€äº›é¢å¤–çš„æ­¥éª¤">å¤„ç† <code>NoHandlerFoundException</code> éœ€è¦ä¸€äº›é¢å¤–çš„æ­¥éª¤</h4>
<p>å½“æ‚¨å°è¯•è°ƒç”¨ç³»ç»Ÿä¸­ä¸å­˜åœ¨çš„APIæ—¶ï¼Œä¼šå‡ºç°æ­¤å¼‚å¸¸ã€‚å°½ç®¡æˆ‘ä»¬é€šè¿‡ <code>ResponseEntityExceptionHandler</code> ç±»å®ç°å…¶å¤„ç†ç¨‹åºï¼Œä½†å¼‚å¸¸ä»è¢«é‡å®šå‘åˆ° <code>DefaultHandlerExceptionResolver</code> ã€‚</p>
<p>è¦å°†å¼‚å¸¸é‡å®šå‘åˆ°æˆ‘ä»¬çš„å»ºè®®ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å±æ€§æ–‡ä»¶ä¸­è®¾ç½®å‡ ä¸ªå±æ€§ï¼š <code>spring.mvc.throw-exception-if-no-handler-found=true</code> å’Œ <code>spring.web.resources.add-mappings=false</code></p>
</blockquote>
<h3 id="ä½¿ç”¨-controlleradvice-æ—¶è¦è®°ä½çš„ä¸€äº›è¦ç‚¹">ä½¿ç”¨ <code>@ControllerAdvice</code> æ—¶è¦è®°ä½çš„ä¸€äº›è¦ç‚¹</h3>
<ul>
<li>
<p>ä¸ºäº†ç®€å•èµ·è§ï¼Œé¡¹ç›®ä¸­å§‹ç»ˆåªæœ‰ä¸€ä¸ªæ§åˆ¶å™¨å»ºè®®ç±»ã€‚æœ€å¥½æœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºä¸­æ‰€æœ‰å¼‚å¸¸çš„å•ä¸€å­˜å‚¨åº“ã€‚å¦‚æœæ‚¨åˆ›å»ºå¤šä¸ªæ§åˆ¶å™¨å»ºè®®ï¼Œè¯·å°è¯•ä½¿ç”¨ <code>basePackages</code> æˆ– <code>annotations</code> å±æ€§æ¥æ˜ç¡®å®ƒå°†å»ºè®®å“ªäº›æ§åˆ¶å™¨ã€‚</p>
</li>
<li>
<p>Spring å¯ä»¥æŒ‰ä»»ä½•é¡ºåºå¤„ç†æ§åˆ¶å™¨å»ºè®®ç±»ï¼Œé™¤éæˆ‘ä»¬ä½¿ç”¨ <code>@Order</code> æ³¨é‡Šå¯¹å…¶è¿›è¡Œæ³¨é‡Šã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨æœ‰å¤šä¸ªæ§åˆ¶å™¨å»ºè®®ï¼Œé‚£ä¹ˆåœ¨ç¼–å†™ä¸€ä¸ªåŒ…ç½—ä¸‡è±¡çš„å¤„ç†ç¨‹åºæ—¶è¦å°å¿ƒã€‚ç‰¹åˆ«æ˜¯å½“æ‚¨æ²¡æœ‰åœ¨æ³¨é‡Šä¸­æŒ‡å®š <code>basePackages</code> æˆ– <code>annotations</code> æ—¶ã€‚</p>
</li>
</ul>
<h2 id="springå¦‚ä½•å¤„ç†å¼‚å¸¸">Springå¦‚ä½•å¤„ç†å¼‚å¸¸ï¼Ÿ</h2>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»ä»‹ç»äº† Spring ä¸­å¤„ç†å¼‚å¸¸çš„å¯ç”¨æœºåˆ¶ï¼Œè®©æˆ‘ä»¬ç®€è¦äº†è§£ Spring å¦‚ä½•å¤„ç†å®ƒä»¥åŠä½•æ—¶ä¸€ç§æœºåˆ¶ä¼˜å…ˆäºå¦ä¸€ç§æœºåˆ¶ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬è¿˜æ²¡æœ‰æ„å»ºè‡ªå·±çš„å¼‚å¸¸å¤„ç†ç¨‹åºï¼Œè¯·çœ‹ä¸‹é¢çš„æµç¨‹å›¾ï¼Œå®ƒè·Ÿè¸ªäº† Spring å¼‚å¸¸å¤„ç†çš„è¿‡ç¨‹ï¼š</p>
<p><img loading="lazy" src="https://reflectoring.io/images/posts/spring-exception-handling/spring-exception-handling-mechanism_hubae3aff6e8617ef25d3790cb826a42d7_144133_2512x0_resize_box_3.png" alt="Spring Exception Handling Flow"  />
</p>
<h2 id="ç»“è®º">ç»“è®º</h2>
<p>å½“å¼‚å¸¸è·¨è¶Šæ§åˆ¶å™¨çš„è¾¹ç•Œæ—¶ï¼Œå®ƒæ³¨å®šä¼šä»¥ JSON å“åº”æˆ– HTML ç½‘é¡µçš„å½¢å¼åˆ°è¾¾å®¢æˆ·ç«¯ã€‚</p>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº† Spring Boot å¦‚ä½•å°†è¿™äº›å¼‚å¸¸è½¬æ¢ä¸ºå®¢æˆ·å‹å¥½çš„è¾“å‡ºï¼Œä»¥åŠé…ç½®å’Œæ³¨é‡Šï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿå°†å®ƒä»¬è¿›ä¸€æ­¥å¡‘é€ æˆæˆ‘ä»¬æƒ³è¦çš„å½¢çŠ¶ã€‚</p>
<p>æ„Ÿè°¢æ‚¨çš„é˜…è¯»ï¼æ‚¨å¯ä»¥åœ¨ GitHub ä¸Šæ‰¾åˆ°å·¥ä½œä»£ç ã€‚</p>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://reflectoring.io/spring-boot-exception-handling/">https://reflectoring.io/spring-boot-exception-handling/</a></p>
]]></content:encoded>
    </item>
    
    <item>
      <title>[è¯‘]ä½¿ç”¨ Spring çš„ Null-Safety æ³¨è§£ä¿æŠ¤æ‚¨çš„ä»£ç å…å— NullPointerExceptions çš„å½±å“</title>
      <link>https://blog.chensoul.com/posts/2023/07/26/spring-boot-null-safety-annotations/</link>
      <pubDate>Wed, 26 Jul 2023 08:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/07/26/spring-boot-null-safety-annotations/</guid>
      <description>NullPointerExceptions ï¼ˆé€šå¸¸ç¼©å†™ä¸ºâ€œNPEâ€ï¼‰å¯¹äºæ¯ä¸ª Java ç¨‹åºå‘˜æ¥è¯´éƒ½æ˜¯ä¸€åœºå™©æ¢¦ã€‚ æˆ‘ä»¬å¯ä»¥åœ¨äº’è”ç½‘ä¸Šæ‰¾åˆ°å¤§é‡è§£é‡Šå¦‚ä½•ç¼–å†™ç©ºå®‰å…¨ä»£ç çš„æ–‡ç« ã€‚ç©ºå®‰å…¨ç¡®ä¿æˆ‘ä»¬åœ¨ä»£ç ä¸­æ·»</description>
      <content:encoded><![CDATA[<p><code>NullPointerExceptions</code> ï¼ˆé€šå¸¸ç¼©å†™ä¸ºâ€œNPEâ€ï¼‰å¯¹äºæ¯ä¸ª Java ç¨‹åºå‘˜æ¥è¯´éƒ½æ˜¯ä¸€åœºå™©æ¢¦ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨äº’è”ç½‘ä¸Šæ‰¾åˆ°å¤§é‡è§£é‡Šå¦‚ä½•ç¼–å†™ç©ºå®‰å…¨ä»£ç çš„æ–‡ç« ã€‚ç©ºå®‰å…¨ç¡®ä¿æˆ‘ä»¬åœ¨ä»£ç ä¸­æ·»åŠ äº†é€‚å½“çš„æ£€æŸ¥ï¼Œä»¥ä¿è¯å¯¹è±¡å¼•ç”¨ä¸èƒ½ä¸ºç©ºï¼Œæˆ–è€…æ¯•ç«Ÿåœ¨å¯¹è±¡ä¸ºç©ºæ—¶é‡‡å–å¯èƒ½çš„å®‰å…¨æªæ–½ã€‚</p>
<p>ç”±äº <code>NullPointerException</code> æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶å¼‚å¸¸ï¼Œå› æ­¤åœ¨ä»£ç ç¼–è¯‘è¿‡ç¨‹ä¸­å¾ˆéš¾æ‰¾å‡ºè¿™ç§æƒ…å†µã€‚ Java çš„ç±»å‹ç³»ç»Ÿæ²¡æœ‰åŠæ³•å¿«é€Ÿæ¶ˆé™¤å±é™©çš„ç©ºå¯¹è±¡å¼•ç”¨ã€‚</p>
<p>å¹¸è¿çš„æ˜¯ï¼ŒSpring æ¡†æ¶æä¾›äº†ä¸€äº›æ³¨é‡Šæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨è¿™äº›æ³¨é‡Šé€šè¿‡ <a href="https://reflectoring.io/categories/spring-boot/">Spring Boot</a> ç¼–å†™ç©ºå®‰å…¨ä»£ç ã€‚</p>
<h2 id="ç¤ºä¾‹ä»£ç ">ç¤ºä¾‹ä»£ç </h2>
<p>æœ¬æ–‡é™„æœ‰ GitHub ä¸Šçš„å·¥ä½œ<a href="https://github.com/thombergs/code-examples/tree/master/spring-boot/spring-boot-null-safe-annotations">ä»£ç ç¤ºä¾‹</a>ã€‚</p>
<h2 id="spring-ä¸­çš„ç©ºå®‰å…¨æ³¨è§£">Spring ä¸­çš„ç©ºå®‰å…¨æ³¨è§£</h2>
<p>åœ¨Springæ ¸å¿ƒåŒ… <code>org.springframework.lang</code> ä¸‹ï¼Œæœ‰4ä¸ªè¿™æ ·çš„æ³¨è§£ï¼š</p>
<ul>
<li><code>@NonNull</code>, <code>@NonNull</code> ï¼Œ</li>
<li><code>@NonNullFields</code>, <code>@NonNullFields</code> ï¼Œ</li>
<li><code>@Nullable</code>,</li>
<li><code>@NonNullApi</code>.</li>
</ul>
<p>Eclipse å’Œ IntelliJ IDEA ç­‰æµè¡Œçš„ IDE å¯ä»¥ç†è§£è¿™äº›æ³¨é‡Šã€‚å®ƒä»¬å¯ä»¥åœ¨ç¼–è¯‘æœŸé—´è­¦å‘Šå¼€å‘äººå‘˜æ½œåœ¨çš„é—®é¢˜ã€‚</p>
<p>æˆ‘ä»¬å°†åœ¨æœ¬æ•™ç¨‹ä¸­ä½¿ç”¨ IntelliJ IDEAã€‚è®©æˆ‘ä»¬é€šè¿‡ä¸€äº›ä»£ç ç¤ºä¾‹æ¥äº†è§£æ›´å¤šä¿¡æ¯ã€‚</p>
<p>è¦åˆ›å»ºåŸºç¡€é¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Spring Initializrã€‚ Spring Bootå¯åŠ¨å™¨å°±æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ï¼Œä¸éœ€è¦æ·»åŠ ä»»ä½•é¢å¤–çš„ä¾èµ–é¡¹ã€‚</p>
<h2 id="ideé…ç½®">IDEé…ç½®</h2>
<p><strong>è¯·æ³¨æ„ï¼Œå¹¶éæ‰€æœ‰å¼€å‘å·¥å…·éƒ½å¯ä»¥æ˜¾ç¤ºè¿™äº›ç¼–è¯‘è­¦å‘Šã€‚å¦‚æœæ‚¨æ²¡æœ‰çœ‹åˆ°ç›¸å…³è­¦å‘Šï¼Œè¯·æ£€æŸ¥ IDE ä¸­çš„ç¼–è¯‘å™¨è®¾ç½®ã€‚</strong></p>
<h3 id="intellij">IntelliJ</h3>
<p>å¯¹äº IntelliJï¼Œæˆ‘ä»¬å¯ä»¥åœ¨â€œBuild, Execution, Deployment -&gt; Compilerâ€ä¸‹æ¿€æ´»æ³¨é‡Šæ£€æŸ¥ï¼š</p>
<p><img loading="lazy" src="https://reflectoring.io/images/posts/spring-boot-null-safety-annotations/intellij-compiler-settings_hud188e08fdc0139feec7b91a21ff944e5_145688_1866x0_resize_box_3.png" alt="IntelliJ compiler config"  />
</p>
<h3 id="eclipse">Eclipse</h3>
<p>å¯¹äº Eclipseï¼Œæˆ‘ä»¬å¯ä»¥åœ¨â€œJava -&gt; Compiler -&gt; Errors/Warningsâ€ä¸‹æ‰¾åˆ°è®¾ç½®ï¼š</p>
<p><img loading="lazy" src="https://reflectoring.io/images/posts/spring-boot-null-safety-annotations/eclipse-compiler-settings_hu8534a04dde40f239dc7f4772e1ef3337_850180_2084x0_resize_box_3.png" alt="Eclipse compiler config"  />
</p>
<h2 id="ç¤ºä¾‹ä»£ç -1">ç¤ºä¾‹ä»£ç </h2>
<p>è®©æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ <code>Employee</code> ç±»æ¥ç†è§£æ³¨é‡Šï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">io.reflectoring.nullsafety</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// imports 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">Employee</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">String</span> <span class="n">id</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">LocalDate</span> <span class="n">joiningDate</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">String</span> <span class="n">pastEmployment</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// standard constructor, getters, setters
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><h2 id="nonnull"><code>@NonNull</code></h2>
<p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ <code>id</code> å­—æ®µï¼ˆåœ¨ <code>Employee</code> ç±»ä¸­ï¼‰å°†æ˜¯ä¸€ä¸ªä¸å¯ä¸º null çš„å€¼ã€‚å› æ­¤ï¼Œä¸ºäº†é¿å…ä»»ä½•æ½œåœ¨çš„ <code>NullPointerException</code> æˆ‘ä»¬å¯ä»¥å°†æ­¤å­—æ®µæ ‡è®°ä¸º <code>@NonNull</code> ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">Employee</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@NonNull</span> 
</span></span><span class="line"><span class="cl">  <span class="n">String</span> <span class="n">id</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">//...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬ä¸å°å¿ƒå°è¯•åœ¨ä»£ç ä¸­çš„ä»»ä½•ä½ç½®å°† <code>id</code> çš„å€¼è®¾ç½®ä¸º nullï¼ŒIDE å°†æ˜¾ç¤ºç¼–è¯‘è­¦å‘Šï¼š</p>
<p><img loading="lazy" src="https://reflectoring.io/images/posts/spring-boot-null-safety-annotations/nonnull-ide-warning_hu5348352c54dfc5689093e49bbc5394b7_33745_1138x0_resize_box_3.png" alt="IDE warning for NonNull"  />
</p>
<p><code>@NonNull</code> æ³¨é‡Šå¯ä»¥åœ¨æ–¹æ³•ã€å‚æ•°æˆ–å­—æ®µçº§åˆ«ä½¿ç”¨ã€‚**</p>
<p>æ­¤æ—¶ï¼Œæ‚¨å¯èƒ½ä¼šæƒ³â€œå¦‚æœä¸€ä¸ªç±»æœ‰å¤šä¸ªéç©ºå­—æ®µæ€ä¹ˆåŠï¼Ÿâ€ã€‚å¦‚æœæˆ‘ä»¬å¿…é¡»åœ¨æ¯ä¸€ä¸ªä¹‹å‰æ·»åŠ  <code>@NonNull</code> æ³¨é‡Šï¼Œæ˜¯ä¸æ˜¯å¤ªç½—å—¦äº†ï¼Ÿ</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>@NonNullFields</code> æ³¨é‡Šæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ <code>@NonNull</code> çš„å¿«é€Ÿæ‘˜è¦ï¼š</p>
<table>
<thead>
<tr>
<th>å¸¦æ³¨é‡Šçš„å…ƒç´ </th>
<th>å½±å“</th>
</tr>
</thead>
<tbody>
<tr>
<td>field</td>
<td>å½“å­—æ®µä¸ºç©ºæ—¶æ˜¾ç¤ºè­¦å‘Š</td>
</tr>
<tr>
<td>parameter</td>
<td>å½“å‚æ•°ä¸ºç©ºæ—¶æ˜¾ç¤ºè­¦å‘Š</td>
</tr>
<tr>
<td>method</td>
<td>å½“æ–¹æ³•è¿”å› null æ—¶æ˜¾ç¤ºè­¦å‘Š</td>
</tr>
<tr>
<td>package</td>
<td>ä¸é€‚ç”¨</td>
</tr>
</tbody>
</table>
<h2 id="nonnullfields"><code>@NonNullFields</code></h2>
<p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <code>package-info.java</code> æ–‡ä»¶ä»¥åœ¨åŒ…çº§åˆ«åº”ç”¨éç©ºå­—æ®µæ£€æŸ¥ã€‚è¯¥æ–‡ä»¶å°†åŒ…å«å¸¦æœ‰ <code>@NonNullFields</code> æ³¨é‡Šçš„æ ¹åŒ…åç§°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@NonNullFields</span>
</span></span><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">io.reflectoring.nullsafety</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.lang.NonNullFields</span><span class="o">;</span>
</span></span></code></pre></div><p>ç°åœ¨ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦ä½¿ç”¨ <code>@NonNull</code> æ³¨é‡Šæ¥æ³¨é‡Šå­—æ®µã€‚å› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥åŒ…ä¸­ç±»çš„æ‰€æœ‰å­—æ®µç°åœ¨éƒ½è¢«è§†ä¸ºéç©ºã€‚è€Œä¸”ï¼Œæˆ‘ä»¬ä»ç„¶ä¼šçœ‹åˆ°ä¸ä»¥å‰ç›¸åŒçš„è­¦å‘Šï¼š</p>
<p><img loading="lazy" src="https://reflectoring.io/images/posts/spring-boot-null-safety-annotations/nonnull-ide-warning_hu5348352c54dfc5689093e49bbc5394b7_33745_1138x0_resize_box_3.png" alt="IDE warning for NonNullFields"  />
</p>
<p>è¿™é‡Œè¦æ³¨æ„çš„å¦ä¸€ç‚¹æ˜¯ï¼Œå¦‚æœæœ‰ä»»ä½•æœªåˆå§‹åŒ–çš„å­—æ®µï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†çœ‹åˆ°åˆå§‹åŒ–è¿™äº›å­—æ®µçš„è­¦å‘Šï¼š</p>
<p><img loading="lazy" src="https://reflectoring.io/images/posts/spring-boot-null-safety-annotations/nonnullfields-ide-warning_huf1e2dea76ed1bc462a15a89ca8946d6c_20352_612x0_resize_box_3.png" alt="IDE warning for NonNull"  />
</p>
<p>ä»¥ä¸‹æ˜¯ <code>@NonNullFields</code> çš„å¿«é€Ÿæ‘˜è¦ï¼š</p>
<table>
<thead>
<tr>
<th>å¸¦æ³¨é‡Šçš„å…ƒç´ </th>
<th>å½±å“</th>
</tr>
</thead>
<tbody>
<tr>
<td>field</td>
<td>ä¸é€‚ç”¨</td>
</tr>
<tr>
<td>parameter</td>
<td>ä¸é€‚ç”¨</td>
</tr>
<tr>
<td>method</td>
<td>ä¸é€‚ç”¨</td>
</tr>
<tr>
<td>package</td>
<td>å¦‚æœæ‰€åº”ç”¨çš„åŒ…çš„ä»»ä½•å­—æ®µä¸ºç©ºï¼Œåˆ™æ˜¾ç¤ºè­¦å‘Š</td>
</tr>
</tbody>
</table>
<h2 id="nonnullapi"><code>@NonNullApi</code></h2>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ‚¨å¯èƒ½å·²ç»å‘ç°äº†å¦ä¸€ä¸ªè¦æ±‚ï¼Œå³å¯¹æ–¹æ³•å‚æ•°æˆ–è¿”å›å€¼è¿›è¡Œç±»ä¼¼çš„æ£€æŸ¥ã€‚ <code>@NonNullApi</code> å°†ä¼šæ¥æ‹¯æ•‘æˆ‘ä»¬ã€‚</p>
<p>ä¸ <code>@NonNullFields</code> ç±»ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>package-info.java</code> æ–‡ä»¶å¹¶ä¸ºç›®æ ‡åŒ…æ·»åŠ  <code>@NonNullApi</code> æ³¨é‡Šï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@NonNullApi</span>
</span></span><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">io.reflectoring.nullsafety</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.lang.NonNullApi</span><span class="o">;</span>
</span></span></code></pre></div><p>ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬ç¼–å†™æ–¹æ³•è¿”å› null çš„ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">io.reflectoring.nullsafety</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// imports
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">Employee</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">String</span> <span class="nf">getPastEmployment</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">//...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>  
</span></span></code></pre></div><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° IDE ç°åœ¨è­¦å‘Šæˆ‘ä»¬æœ‰å…³ä¸å¯ä¸º null çš„è¿”å›å€¼ï¼š</p>
<p><img loading="lazy" src="https://reflectoring.io/images/posts/spring-boot-null-safety-annotations/nonnullapi-method-ide-warning_hu0f179a30c6c723f579ce7eeee2a50ca2_40298_1084x0_resize_box_3.png" alt="IDE warning for NonNullApi"  />
</p>
<p>ä»¥ä¸‹æ˜¯ <code>@NonNullApi</code> çš„å¿«é€Ÿæ‘˜è¦ï¼š</p>
<table>
<thead>
<tr>
<th>å¸¦æ³¨é‡Šçš„å…ƒç´ </th>
<th>å½±å“</th>
</tr>
</thead>
<tbody>
<tr>
<td>field</td>
<td>ä¸é€‚ç”¨</td>
</tr>
<tr>
<td>parameter</td>
<td>ä¸é€‚ç”¨</td>
</tr>
<tr>
<td>method</td>
<td>ä¸é€‚ç”¨</td>
</tr>
<tr>
<td>package</td>
<td>å¦‚æœæ‰€åº”ç”¨çš„åŒ…çš„ä»»ä½•å‚æ•°æˆ–è¿”å›å€¼ä¸ºç©ºï¼Œåˆ™æ˜¾ç¤ºè­¦å‘Š</td>
</tr>
</tbody>
</table>
<h2 id="nullable"><code>@Nullable</code></h2>
<p>ä½†è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç‰¹å®šå­—æ®µå¯èƒ½ä¸ºç©ºï¼ˆæ— è®ºæˆ‘ä»¬å¤šä¹ˆæƒ³é¿å…å®ƒï¼‰ã€‚</p>
<p>ä¾‹å¦‚ï¼Œ <code>pastEmployment</code> å­—æ®µåœ¨ <code>Employee</code> ç±»ä¸­å¯ä»¥ä¸ºç©ºï¼ˆå¯¹äºä»¥å‰æ²¡æœ‰å·¥ä½œè¿‡çš„äººï¼‰ã€‚ä½†æ ¹æ®æˆ‘ä»¬çš„å®‰å…¨æ£€æŸ¥ï¼ŒIDE è®¤ä¸ºä¸å¯èƒ½ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å­—æ®µä¸Šçš„ <code>@Nullable</code> æ³¨é‡Šæ¥è¡¨è¾¾æˆ‘ä»¬çš„æ„å›¾ã€‚è¿™å°†å‘Šè¯‰ IDE è¯¥å­—æ®µåœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥ä¸ºç©ºï¼Œå› æ­¤æ— éœ€è§¦å‘è­¦æŠ¥ã€‚æ­£å¦‚ <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/lang/Nullable.html">JavaDoc</a> æ‰€å»ºè®®çš„ï¼š</p>
<blockquote>
<p>å¯ä»¥ä¸ <code>@NonNullApi</code> æˆ– <code>@NonNullFields</code> ç»“åˆä½¿ç”¨ï¼Œå°†é»˜è®¤çš„ä¸å¯ä¸ºç©ºè¯­ä¹‰è¦†ç›–ä¸ºå¯ä¸ºç©ºã€‚</p>
</blockquote>
<p>ä¸ <code>NonNull</code> ç±»ä¼¼ï¼Œ <code>Nullable</code> æ³¨é‡Šå¯ä»¥åº”ç”¨äºæ–¹æ³•ã€å‚æ•°æˆ–å­—æ®µçº§åˆ«ã€‚</p>
<p>æˆ‘ä»¬ç°åœ¨å¯ä»¥å°† <code>pastEmployment</code> å­—æ®µæ ‡è®°ä¸ºå¯ä¸ºç©ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">io.reflectoring.nullsafety</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// imports
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">Employee</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Nullable</span>
</span></span><span class="line"><span class="cl">  <span class="n">String</span> <span class="n">pastEmployment</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Nullable</span> <span class="n">String</span> <span class="nf">getPastEmployment</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">pastEmployment</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">//...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>  
</span></span></code></pre></div><p>ä»¥ä¸‹æ˜¯ <code>@Nullable</code> çš„å¿«é€Ÿæ‘˜è¦ï¼š</p>
<table>
<thead>
<tr>
<th>å¸¦æ³¨é‡Šçš„å…ƒç´ </th>
<th>å½±å“</th>
</tr>
</thead>
<tbody>
<tr>
<td>field</td>
<td>è¡¨ç¤ºè¯¥å­—æ®µå¯ä»¥ä¸ºç©º</td>
</tr>
<tr>
<td>parameter</td>
<td>è¡¨ç¤ºå‚æ•°å¯ä»¥ä¸ºç©º</td>
</tr>
<tr>
<td>method</td>
<td>è¡¨ç¤ºè¯¥æ–¹æ³•å¯ä»¥è¿”å›null</td>
</tr>
<tr>
<td>package</td>
<td>ä¸é€‚ç”¨</td>
</tr>
</tbody>
</table>
<h2 id="è‡ªåŠ¨æ„å»ºæ£€æŸ¥">è‡ªåŠ¨æ„å»ºæ£€æŸ¥</h2>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æ­£åœ¨è®¨è®ºç°ä»£ IDE å¦‚ä½•ä½¿ç¼–å†™ç©ºå®‰å…¨ä»£ç å˜å¾—æ›´å®¹æ˜“ã€‚ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬æƒ³åœ¨æ„å»ºç®¡é“ä¸­è¿›è¡Œä¸€äº›è‡ªåŠ¨ä»£ç æ£€æŸ¥ï¼Œè¿™åœ¨æŸç§ç¨‹åº¦ä¸Šä¹Ÿæ˜¯å¯è¡Œçš„ã€‚</p>
<p><a href="https://spotbugs.github.io/">SpotBugs</a>ï¼ˆè‘—åä½†å·²åºŸå¼ƒçš„ <a href="http://findbugs.sourceforge.net/">FindBugs</a> é¡¹ç›®çš„è½¬ä¸–ï¼‰æä¾›äº†ä¸€ä¸ª Maven/Gradle æ’ä»¶ï¼Œå¯ä»¥æ£€æµ‹ç”±äºå¯ç©ºæ€§è€Œå¯¼è‡´çš„ä»£ç å¼‚å‘³ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨å®ƒã€‚</p>
<p>å¯¹äº Maven é¡¹ç›®ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–° <code>pom.xml</code> ä»¥æ·»åŠ  <a href="https://spotbugs.readthedocs.io/en/latest/maven.html">SpotBugs Maven</a> æ’ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;groupId&gt;</span>com.github.spotbugs<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;artifactId&gt;</span>spotbugs-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;version&gt;</span>4.5.2.0<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;dependencies&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- overwrite dependency on spotbugs if you want to specify the version of spotbugs --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;groupId&gt;</span>com.github.spotbugs<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;artifactId&gt;</span>spotbugs<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;version&gt;</span>4.5.3<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/dependencies&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/plugin&gt;</span>
</span></span></code></pre></div><p>æ„å»ºé¡¹ç›®åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¥æ’ä»¶çš„ä»¥ä¸‹ç›®æ ‡ï¼š</p>
<ul>
<li>
<p><code>spotbugs</code> ç›®æ ‡åˆ†æç›®æ ‡é¡¹ç›®ã€‚</p>
</li>
<li>
<p><code>check</code> ç›®æ ‡è¿è¡Œ <code>spotbugs</code> ç›®æ ‡ï¼Œå¦‚æœå‘ç°ä»»ä½•é”™è¯¯ï¼Œåˆ™ä½¿æ„å»ºå¤±è´¥ã€‚</p>
</li>
</ul>
<p>å¦‚æœæ‚¨ä½¿ç”¨ Gradle è€Œä¸æ˜¯ Mavenï¼Œåˆ™å¯ä»¥åœ¨ <code>build.gradle</code> æ–‡ä»¶ä¸­é…ç½® SpotBugs Gradle æ’ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-groovy" data-lang="groovy"><span class="line"><span class="cl"><span class="n">dependencies</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">spotbugsPlugins</span> <span class="s1">&#39;com.h3xstream.findsecbugs:findsecbugs-plugin:1.11.0&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">spotbugs</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">toolVersion</span> <span class="o">=</span> <span class="s1">&#39;4.5.3&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>é¡¹ç›®æ›´æ–°åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>gradle check</code> å‘½ä»¤è¿è¡Œæ£€æŸ¥ã€‚</p>
<p>SpotBugs æä¾›äº†ä¸€äº›è§„åˆ™ï¼Œé€šè¿‡åœ¨ Maven æ„å»ºæœŸé—´å¤„ç† <code>@NonNull</code> æ³¨é‡Šæ¥æ ‡è®°æ½œåœ¨é—®é¢˜ã€‚æ‚¨å¯ä»¥æŸ¥çœ‹<a href="https://spotbugs.readthedocs.io/en/latest/bugDescriptions.html">é”™è¯¯æè¿°çš„è¯¦ç»†åˆ—è¡¨</a>ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœä»»ä½•ç”¨ <code>@NonNull</code> æ³¨é‡Šçš„æ–¹æ³•æ„å¤–è¿”å› nullï¼Œåˆ™ SpotBugs æ£€æŸ¥å°†å¤±è´¥ï¼Œå¹¶æ˜¾ç¤ºç±»ä¼¼ä»¥ä¸‹å†…å®¹çš„é”™è¯¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">[ERROR] High: io.reflectoring.nullsafety.Employee.getJoiningDate() may return null, but is declared @Nonnull [io.reflectoring.nullsafety.Employee] At Employee.java:[line 36] NP_NONNULL_RETURN_VIOLATION
</span></span></code></pre></div><h2 id="ç»“è®º">ç»“è®º</h2>
<p>è¿™äº›æ³¨è§£å¯¹äºJavaç¨‹åºå‘˜æ¥è¯´ç¡®å®æ˜¯ä¸€ä¸ªç¦éŸ³ï¼Œå¯ä»¥å‡å°‘è¿è¡Œæ—¶å‡ºç° <code>NullPointerException</code> çš„å¯èƒ½æ€§ã€‚ä½†æ˜¯è¯·è®°ä½ï¼Œè¿™å¹¶ä¸èƒ½ä¿è¯å®Œå…¨çš„ç©ºå®‰å…¨ã€‚</p>
<p>Kotlin ä½¿ç”¨è¿™äº›æ³¨é‡Šæ¥æ¨æ–­ Spring API çš„å¯ä¸ºç©ºæ€§ã€‚</p>
<p>æˆ‘å¸Œæœ›æ‚¨ç°åœ¨å·²ç»å‡†å¤‡å¥½åœ¨ Spring Boot ä¸­ç¼–å†™ null å®‰å…¨ä»£ç ï¼</p>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://reflectoring.io/spring-boot-null-safety-annotations/">https://reflectoring.io/spring-boot-null-safety-annotations/</a></p>
]]></content:encoded>
    </item>
    
    <item>
      <title>[è¯‘]ä½¿ç”¨ Spring Boot å’Œ Spring Security é…ç½® CORS</title>
      <link>https://blog.chensoul.com/posts/2023/07/26/spring-cors/</link>
      <pubDate>Wed, 26 Jul 2023 07:20:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/07/26/spring-cors/</guid>
      <description>è·¨æºèµ„æºå…±äº« (CORS) æ˜¯ä¸€ç§åŸºäº HTTP æ ‡å¤´çš„æœºåˆ¶ï¼Œå…è®¸æœåŠ¡å™¨æ˜¾å¼å°†æŸäº›æºåˆ—å…¥ç™½åå•ï¼Œå¹¶å¸®åŠ©ç»•è¿‡åŒæºç­–ç•¥ã€‚ è¿™æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºæµè§ˆå™¨é»˜è®¤åº”ç”¨åŒæºç­–ç•¥ä»¥ç¡®ä¿å®‰å…¨</description>
      <content:encoded><![CDATA[<p>è·¨æºèµ„æºå…±äº« (CORS) æ˜¯ä¸€ç§åŸºäº HTTP æ ‡å¤´çš„æœºåˆ¶ï¼Œå…è®¸æœåŠ¡å™¨æ˜¾å¼å°†æŸäº›æºåˆ—å…¥ç™½åå•ï¼Œå¹¶å¸®åŠ©ç»•è¿‡åŒæºç­–ç•¥ã€‚</p>
<p>è¿™æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºæµè§ˆå™¨é»˜è®¤åº”ç”¨åŒæºç­–ç•¥ä»¥ç¡®ä¿å®‰å…¨ã€‚é€šè¿‡åœ¨ Web åº”ç”¨ç¨‹åºä¸­å®æ–½ CORSï¼Œç½‘é¡µå¯ä»¥è¯·æ±‚é¢å¤–çš„èµ„æºå¹¶ä»å…¶ä»–åŸŸåŠ è½½åˆ°æµè§ˆå™¨ä¸­ã€‚</p>
<p>æœ¬æ–‡å°†é‡ç‚¹ä»‹ç»åœ¨åŸºäº Spring çš„åº”ç”¨ç¨‹åºä¸­å®ç° CORS çš„å„ç§æ–¹å¼ã€‚è¦è¯¦ç»†äº†è§£ CORS çš„å·¥ä½œåŸç†ï¼Œè¯·å‚é˜…è¿™ç¯‡ä¼˜ç§€çš„<a href="https://reflectoring.io/complete-guide-to-cors/">ä»‹ç»æ€§æ–‡ç« </a>ã€‚</p>
<h2 id="ç¤ºä¾‹ä»£ç ">ç¤ºä¾‹ä»£ç </h2>
<p>æœ¬æ–‡é™„æœ‰ GitHub ä¸Šçš„å·¥ä½œ<a href="https://github.com/thombergs/code-examples/tree/master/spring-boot/cors/configuring-cors-with-spring">ä»£ç ç¤ºä¾‹</a>ã€‚</p>
<h2 id="cors-ç‰¹å®š-http-å“åº”æ ‡å¤´æ¦‚è¿°">CORS ç‰¹å®š HTTP å“åº”æ ‡å¤´æ¦‚è¿°</h2>
<p>CORS è§„èŒƒå®šä¹‰äº†æœåŠ¡å™¨è¿”å›çš„ä¸€ç»„å“åº”æ ‡å¤´ï¼Œè¿™å°†æ˜¯åç»­éƒ¨åˆ†çš„é‡ç‚¹ã€‚</p>
<table>
<thead>
<tr>
<th>å“åº”å¤´</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Access-Control-Allow-Origin</code></td>
<td>ä»¥é€—å·åˆ†éš”çš„ç™½åå•æ¥æºåˆ—è¡¨æˆ–â€œ*â€ã€‚</td>
</tr>
<tr>
<td><code>Access-Control-Allow-Methods</code></td>
<td>Web æœåŠ¡å™¨å…è®¸è·¨æºè¯·æ±‚çš„ HTTP æ–¹æ³•çš„é€—å·åˆ†éš”åˆ—è¡¨ã€‚</td>
</tr>
<tr>
<td><code>Access-Control-Allow-Headers</code></td>
<td>Web æœåŠ¡å™¨å…è®¸è·¨æºè¯·æ±‚çš„ HTTP æ ‡å¤´çš„é€—å·åˆ†éš”åˆ—è¡¨ã€‚</td>
</tr>
<tr>
<td><code>Access-Control-Expose-Headers</code></td>
<td>å®¢æˆ·ç«¯è„šæœ¬è®¤ä¸ºå¯ä»¥å®‰å…¨æ˜¾ç¤ºçš„ä»¥é€—å·åˆ†éš”çš„ HTTP æ ‡å¤´åˆ—è¡¨ã€‚</td>
</tr>
<tr>
<td><code>Access-Control-Allow-Credentials</code></td>
<td>å¦‚æœæµè§ˆå™¨é€šè¿‡ä¼ é€’å‡­æ®ï¼ˆä»¥ cookie æˆ–æˆæƒæ ‡å¤´çš„å½¢å¼ï¼‰å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œåˆ™å…¶å€¼è®¾ç½®ä¸º <code>true</code> ã€‚</td>
</tr>
<tr>
<td><code>Access-Control-Max-Age</code></td>
<td>æŒ‡ç¤ºé¢„æ£€è¯·æ±‚çš„ç»“æœå¯ä»¥ç¼“å­˜å¤šé•¿æ—¶é—´ã€‚</td>
</tr>
</tbody>
</table>
<h2 id="è®¾ç½®ç¤ºä¾‹å®¢æˆ·ç«¯åº”ç”¨ç¨‹åº">è®¾ç½®ç¤ºä¾‹å®¢æˆ·ç«¯åº”ç”¨ç¨‹åº</h2>
<p>æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªç®€å•çš„è§’åº¦åº”ç”¨ç¨‹åºæ¥è°ƒç”¨ REST ç«¯ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æµè§ˆå™¨å¼€å‘äººå‘˜å·¥å…·æ£€æŸ¥è¿™äº›ç«¯ç‚¹ã€‚æ‚¨å¯ä»¥åœ¨ GitHub ä¸ŠæŸ¥çœ‹<a href="https://github.com/thombergs/code-examples/tree/master/spring-boot/cors/configuring-cors-with-spring/cors-app">æºä»£ç </a>ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">    ng serve --open
</span></span></code></pre></div><p>æˆ‘ä»¬åº”è¯¥èƒ½å¤ŸæˆåŠŸå¯åŠ¨å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºã€‚</p>
<p><img loading="lazy" src="https://reflectoring.io/images/posts/configuring-cors-with-spring/client_hu6933403b7320f6f893a41150b2491685_84510_1441x0_resize_q90_box.JPG" alt="settings"  />
</p>
<h2 id="è®¾ç½®ç¤ºä¾‹æœåŠ¡å™¨åº”ç”¨ç¨‹åº">è®¾ç½®ç¤ºä¾‹æœåŠ¡å™¨åº”ç”¨ç¨‹åº</h2>
<p>æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªåŸºäº Spring çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­åŒ…å«å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå¯ä»¥è°ƒç”¨çš„ <code>GET</code> å’Œ <code>POST</code> è¯·æ±‚ã€‚è¯·æ³¨æ„ï¼Œæ‚¨ä¼šå‘ç°ä¸¤ä¸ªç‹¬ç«‹çš„åº”ç”¨ç¨‹åºï¼šä¸€ä¸ªä½¿ç”¨ Spring MVC (REST)ï¼Œå¦ä¸€ä¸ªä½¿ç”¨ Spring Reactive å †æ ˆã€‚</p>
<p>ä¸ºç®€å•èµ·è§ï¼Œä¸¤ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´çš„ CORS é…ç½®ç›¸åŒï¼Œå¹¶ä¸”å®šä¹‰äº†ç›¸åŒçš„ç«¯ç‚¹ã€‚ä¸¤å°æœåŠ¡å™¨éƒ½ä»ä¸åŒçš„ç«¯å£ 8091 å’Œ 8092 å¯åŠ¨ã€‚</p>
<p>ä¸åº”ç”¨ç¨‹åºæ†ç»‘åœ¨ä¸€èµ·çš„ Maven Wrapper å°†ç”¨äºå¯åŠ¨æœåŠ¡ã€‚æ‚¨å¯ä»¥æŸ¥çœ‹ <a href="https://github.com/thombergs/code-examples/tree/master/spring-boot/cors/configuring-cors-with-spring/SimpleLibraryApplication">Spring REST æºä»£ç </a>å’Œ <a href="https://github.com/thombergs/code-examples/tree/master/spring-boot/cors/configuring-cors-with-spring/LibraryWebfluxApplication">Spring Reactive æºä»£ç </a>ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">    mvnw clean verify spring-boot:run <span class="o">(</span><span class="k">for</span> Windows<span class="o">)</span>
</span></span><span class="line"><span class="cl">   ./mvnw clean verify spring-boot:run <span class="o">(</span><span class="k">for</span> Linux<span class="o">)</span>
</span></span></code></pre></div><p>ä¸€æ—¦ Spring åº”ç”¨ç¨‹åºæˆåŠŸå¯åŠ¨ï¼Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºåº”è¯¥èƒ½å¤ŸæˆåŠŸä»æœåŠ¡å™¨åŠ è½½æ•°æ®ã€‚</p>
<p>è°ƒç”¨ Spring REST æœåŠ¡å™¨ï¼š</p>
<p><img loading="lazy" src="https://reflectoring.io/images/posts/configuring-cors-with-spring/app_hu6933403b7320f6f893a41150b2491685_157341_1871x0_resize_q90_box.JPG" alt="settings"  />

è°ƒç”¨ Spring Reactive æœåŠ¡å™¨ï¼š</p>
<p><img loading="lazy" src="https://reflectoring.io/images/posts/configuring-cors-with-spring/app_reactive_hu6933403b7320f6f893a41150b2491685_154439_1859x0_resize_q90_box.JPG" alt="settings"  />
</p>
<h2 id="äº†è§£-crossorigin-å±æ€§">äº†è§£ <code>@CrossOrigin</code> å±æ€§</h2>
<p>åœ¨ Spring Boot åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>@CrossOrigin</code> æ³¨è§£æ¥å¯ç”¨è·¨åŸŸè°ƒç”¨ã€‚æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ <code>@CrossOrigin</code> æ”¯æŒçš„å±æ€§ã€‚</p>
<table>
<thead>
<tr>
<th>å±æ€§</th>
<th>Description æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>origins</code></td>
<td>å…è®¸æ‚¨æŒ‡å®šå…è®¸çš„æ¥æºåˆ—è¡¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå…è®¸æ‰€æœ‰æ¥æºã€‚ è¯¥å±æ€§å€¼å°†åœ¨é¢„æ£€å“åº”å’Œå®é™…å“åº”çš„ <code>Access-Control-Allow-Origin</code> æ ‡å¤´ä¸­è®¾ç½®ã€‚ ç”¨æ³•ç¤ºä¾‹ï¼š <code>@CrossOrigin(origins = &quot;http://localhost:8080&quot;)</code>  <code>@CrossOrigin(origins = {&quot;http://localhost:8080&quot;, &quot;http://testserver:8087&quot;})</code></td>
</tr>
<tr>
<td><code>allowedHeaders</code></td>
<td>å…è®¸æ‚¨æŒ‡å®šæµè§ˆå™¨å‘å‡ºè¯·æ±‚æ—¶å°†æ¥å—çš„æ ‡å¤´åˆ—è¡¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä»»ä½•æ ‡å¤´éƒ½å°†è¢«å…è®¸ã€‚æ­¤å±æ€§ä¸­æŒ‡å®šçš„å€¼ç”¨äºé¢„æ£€å“åº”ä¸­çš„ <code>Access-Control-Allow-Headers</code> ä¸­ã€‚  <strong>ç”¨æ³•ç¤ºä¾‹ï¼š</strong> <code>@CrossOrigin(allowedHeaders = {&quot;Authorization&quot;, &quot;Origin&quot;})</code></td>
</tr>
<tr>
<td><code>exposedHeaders</code></td>
<td>åœ¨å®é™…å“åº”æ ‡å¤´ä¸­è®¾ç½®çš„æ ‡å¤´åˆ—è¡¨ã€‚å¦‚æœæœªæŒ‡å®šï¼Œåˆ™åªæœ‰å®‰å…¨åˆ—è¡¨ä¸­çš„æ ‡å¤´æ‰ä¼šè¢«è®¤ä¸ºå¯ä»¥å®‰å…¨åœ°ç”±å®¢æˆ·ç«¯è„šæœ¬å…¬å¼€ã€‚  <strong>ç”¨æ³•ç¤ºä¾‹ï¼š</strong> <code>@CrossOrigin(exposedHeaders = {&quot;Access-Control-Allow-Origin&quot;,&quot;Access-Control-Allow-Credentials&quot;})</code></td>
</tr>
<tr>
<td><code>allowCredentials</code></td>
<td>å½“éœ€è¦å‡­æ®æ¥è°ƒç”¨ API æ—¶ï¼Œè¯·å°† <code>Access-Control-Allow-Credentials</code> æ ‡å¤´å€¼è®¾ç½®ä¸º trueã€‚å¦‚æœä¸éœ€è¦å‡­æ®ï¼Œè¯·çœç•¥æ ‡å¤´ã€‚  <strong>ç”¨æ³•ç¤ºä¾‹ï¼š</strong> <code>@CrossOrigin(allowCredentials = true)</code></td>
</tr>
<tr>
<td><code>maxAge</code></td>
<td>é»˜è®¤ <code>maxAge</code> è®¾ç½®ä¸º 1800 ç§’ï¼ˆ30 åˆ†é’Ÿï¼‰ã€‚æŒ‡ç¤ºé¢„æ£€å“åº”å¯ä»¥ç¼“å­˜å¤šé•¿æ—¶é—´ã€‚  <strong>ç”¨æ³•ç¤ºä¾‹ï¼š</strong> <code>@CrossOrigin(maxAge = 300)</code></td>
</tr>
</tbody>
</table>
<h2 id="å¦‚æœä¸é…ç½®corsæ€ä¹ˆåŠ">å¦‚æœä¸é…ç½®CORSæ€ä¹ˆåŠï¼Ÿ</h2>
<p>è€ƒè™‘æˆ‘ä»¬çš„ Spring Boot åº”ç”¨ç¨‹åºå°šæœªé…ç½®ä¸º CORS æ”¯æŒã€‚å¦‚æœæˆ‘ä»¬å°è¯•è®¿é—®åœ¨ç«¯å£ 4200 ä¸Šè¿è¡Œçš„ Angular åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬ä¼šåœ¨å¼€å‘äººå‘˜æ§åˆ¶å°ä¸Šçœ‹åˆ°ä»¥ä¸‹é”™è¯¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Access to XMLHttpRequest at http://localhost:8091 
</span></span><span class="line"><span class="cl">from origin http://localhost:4200 has been blocked by CORS policy: 
</span></span><span class="line"><span class="cl">No &#39;Access-Control-Allow-Origin` header is present on the requested 
</span></span><span class="line"><span class="cl">resource
</span></span></code></pre></div><p><img loading="lazy" src="https://reflectoring.io/images/posts/configuring-cors-with-spring/cors-error_hu6933403b7320f6f893a41150b2491685_149954_1882x0_resize_q90_box.JPG" alt="settings"  />
</p>
<p>è¿™æ˜¯å› ä¸ºï¼Œå³ä½¿ä¸¤ä¸ªåº”ç”¨ç¨‹åºå‡ç”± <code>localhost</code> æä¾›æœåŠ¡ï¼Œä½†<a href="https://reflectoring.io/complete-guide-to-cors/#same-origin-vs-cross-origin">ç”±äºç«¯å£ä¸åŒ</a>ï¼Œå®ƒä»¬ä¸ä¼šè¢«è§†ä¸ºåŒä¸€æ¥æºã€‚</p>
<h2 id="åœ¨-spring-web-mvc-åº”ç”¨ç¨‹åºä¸­é…ç½®-cors">åœ¨ Spring Web MVC åº”ç”¨ç¨‹åºä¸­é…ç½® CORS</h2>
<p>ä½¿ç”¨ Spring Initializr åˆ›å»ºçš„åˆå§‹è®¾ç½®åŒ…å«æ‰€æœ‰å¿…éœ€çš„ CORS ä¾èµ–é¡¹ã€‚æ— éœ€æ·»åŠ å¤–éƒ¨ä¾èµ–é¡¹ã€‚è¯·å‚é˜…æ­¤<a href="https://github.com/thombergs/code-examples/tree/master/spring-boot/cors/configuring-cors-with-spring/SpringWebApplication">ç¤ºä¾‹ Spring Web åº”ç”¨ç¨‹åºé¡¹ç›®</a>ã€‚</p>
<h3 id="åœ¨ç±»çº§åˆ«å®šä¹‰-crossorigin">åœ¨ç±»çº§åˆ«å®šä¹‰ <code>@CrossOrigin</code></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@CrossOrigin</span><span class="o">(</span><span class="n">maxAge</span> <span class="o">=</span> <span class="n">3600</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@RestController</span>
</span></span><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;cors-library/managed/books&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LibraryController</span> <span class="o">{}</span>
</span></span></code></pre></div><p>ç”±äºæˆ‘ä»¬å·²ç»å®šä¹‰äº† <code>@CrossOrigin</code> ï¼š</p>
<ul>
<li>æ§åˆ¶å™¨ä¸­çš„æ‰€æœ‰ <code>@RequestMapping</code> æ–¹æ³•ï¼ˆä»¥åŠä½¿ç”¨é€Ÿè®°æ³¨é‡Š <code>@GetMapping</code> ã€ <code>@PostMapping</code> ç­‰çš„æ–¹æ³•ï¼‰éƒ½å°†æ¥å—è·¨åŸŸè¯·æ±‚ã€‚</li>
<li>è‡ª <code>maxAge = 3600</code> èµ·ï¼Œæ‰€æœ‰é£è¡Œå‰å“åº”å°†è¢«ç¼“å­˜ 60 åˆ†é’Ÿã€‚</li>
</ul>
<h3 id="åœ¨æ–¹æ³•çº§åˆ«å®šä¹‰-crossorigin">åœ¨æ–¹æ³•çº§åˆ«å®šä¹‰ <code>@CrossOrigin</code></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@CrossOrigin</span><span class="o">(</span><span class="n">origins</span> <span class="o">=</span> <span class="s">&#34;http://localhost:4200&#34;</span><span class="o">,</span> <span class="n">allowedHeaders</span> <span class="o">=</span> <span class="s">&#34;Requestor-Type&#34;</span><span class="o">,</span> <span class="n">exposedHeaders</span> <span class="o">=</span> <span class="s">&#34;X-Get-Header&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@GetMapping</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">BookDto</span><span class="o">&gt;&gt;</span> <span class="nf">getBooks</span><span class="o">(</span><span class="nd">@RequestParam</span> <span class="n">String</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">HttpHeaders</span> <span class="n">headers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpHeaders</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">headers</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">&#34;X-Get-Header&#34;</span><span class="o">,</span> <span class="s">&#34;ExampleHeader&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">().</span><span class="na">headers</span><span class="o">(</span><span class="n">headers</span><span class="o">).</span><span class="na">body</span><span class="o">(</span><span class="n">libraryService</span><span class="o">.</span><span class="na">getAllBooks</span><span class="o">(</span><span class="n">type</span><span class="o">));</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>è¿™å°†äº§ç”Ÿä»¥ä¸‹æ•ˆæœï¼š</p>
<ul>
<li>
<p>ä»…æ¥å—æ¥è‡ªæ¥æº <code>http://localhost:4200</code> çš„è¯·æ±‚ã€‚</p>
</li>
<li>
<p>å¦‚æœæˆ‘ä»¬å¸Œæœ›åªæ¥å—æŸäº›æ ‡å¤´ï¼Œåˆ™å¯ä»¥åœ¨ <code>allowedHeaders</code> å±æ€§ä¸­æŒ‡å®šè¿™äº›æ ‡å¤´ã€‚å¦‚æœæµè§ˆå™¨æœªå‘é€ <code>Requestor-Type</code> æ ‡å¤´ï¼Œåˆ™ä¸ä¼šå¤„ç†è¯¥è¯·æ±‚ã€‚</p>
</li>
<li>
<p>å¦‚æœæˆ‘ä»¬è®¾ç½®æŸäº›å“åº”æ ‡å¤´ï¼Œä¸ºäº†è®©å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºèƒ½å¤Ÿä½¿ç”¨å®ƒä»¬ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ <code>exposedHeaders</code> å±æ€§æ˜¾å¼è®¾ç½®è¦å…¬å¼€çš„å“åº”æ ‡å¤´åˆ—è¡¨ã€‚</p>
</li>
</ul>
<h3 id="ç±»å’Œæ–¹æ³•çº§åˆ«çš„-crossorigin-ç»„åˆ">ç±»å’Œæ–¹æ³•çº§åˆ«çš„ <code>@CrossOrigin</code> ç»„åˆ</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@CrossOrigin</span><span class="o">(</span><span class="n">maxAge</span> <span class="o">=</span> <span class="n">3600</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@RestController</span>
</span></span><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;cors-library/managed/books&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LibraryController</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">LibraryController</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">LibraryService</span> <span class="n">libraryService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">LibraryController</span><span class="o">(</span><span class="n">LibraryService</span> <span class="n">libraryService</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">libraryService</span> <span class="o">=</span> <span class="n">libraryService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@CrossOrigin</span><span class="o">(</span><span class="n">origins</span> <span class="o">=</span> <span class="s">&#34;http://localhost:4200&#34;</span><span class="o">,</span> <span class="n">allowedHeaders</span> <span class="o">=</span> <span class="s">&#34;Requestor-Type&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@GetMapping</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">BookDto</span><span class="o">&gt;&gt;</span> <span class="nf">getBooks</span><span class="o">(</span><span class="nd">@RequestParam</span> <span class="n">String</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">HttpHeaders</span> <span class="n">headers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpHeaders</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">headers</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">&#34;X-Get-Header&#34;</span><span class="o">,</span> <span class="s">&#34;ExampleHeader&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">().</span><span class="na">headers</span><span class="o">(</span><span class="n">headers</span><span class="o">).</span><span class="na">body</span><span class="o">(</span><span class="n">libraryService</span><span class="o">.</span><span class="na">getAllBooks</span><span class="o">(</span><span class="n">type</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><ul>
<li>
<p>é€šè¿‡åœ¨ç±»å’Œæ–¹æ³•çº§åˆ«å®šä¹‰æ³¨é‡Šï¼Œå…¶ç»„åˆå±æ€§å°†åº”ç”¨äºæ–¹æ³•ï¼Œå³ï¼ˆ <code>origins</code> ã€ <code>allowedHeaders</code> ã€``ï¼‰</p>
</li>
<li>
<p>åœ¨ä¸Šè¿°æ‰€æœ‰æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>@CrossOrigin</code> å®šä¹‰å…¨å±€ CORS cmaxAgeonconfiguration å’Œæœ¬åœ°é…ç½®ã€‚å¯¹äºæ¥å—å¤šä¸ªå€¼çš„å±æ€§ï¼Œå°†åº”ç”¨å…¨å±€å€¼å’Œæœ¬åœ°å€¼çš„ç»„åˆï¼ˆå³å®ƒä»¬è¢«åˆå¹¶ï¼‰ã€‚å¯¹äºä»…æ¥å—å•ä¸ªå€¼çš„å±æ€§ï¼Œæœ¬åœ°å€¼å°†ä¼˜å…ˆäºå…¨å±€å€¼ã€‚</p>
</li>
</ul>
<h3 id="å…¨å±€å¯ç”¨-cors">å…¨å±€å¯ç”¨ CORS</h3>
<p>æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªé€‚ç”¨äºå®šä¹‰çš„æ‰€æœ‰èµ„æºçš„é€šç”¨ CORS é…ç½®ï¼Œè€Œä¸æ˜¯åˆ†åˆ«å‘æ¯ä¸ªèµ„æºæ·»åŠ  CORSã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ <code>WebMvcConfigurer</code> ï¼Œå®ƒæ˜¯ Spring Web MVC åº“çš„ä¸€éƒ¨åˆ†</p>
<p>é€šè¿‡é‡å†™ <code>addCorsMapping()</code> æ–¹æ³•ï¼Œæˆ‘ä»¬å°†ä¸º Spring Web MVC å¤„ç†çš„æ‰€æœ‰ URL é…ç½® CORSã€‚</p>
<p>ä¸ºäº†å…¨å±€å®šä¹‰ç›¸åŒçš„é…ç½®ï¼ˆå¦‚å‰å‡ èŠ‚æ‰€è¿°ï¼‰ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ <code>application.yml</code> ä¸­å®šä¹‰çš„é…ç½®å‚æ•°æ¥åˆ›å»ºä¸€ä¸ª beanï¼Œå¦‚ä¸‹å®šä¹‰ã€‚</p>
<p><code>application.yml</code> ä¸­å®šä¹‰çš„å±æ€§ï¼ˆ <code>allowed-origins</code> ã€ <code>allowed-methods</code> ã€ <code>max-age</code> ã€ <code>allowed-headers</code> ã€ <code>exposed-headers</code> ) æ˜¯é€šè¿‡ <code>@ConfigurationProperties(prefix = &quot;web&quot;)</code> æ˜ å°„åˆ°è‡ªå®šä¹‰ç±» Cors çš„è‡ªå®šä¹‰å±æ€§</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">web</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cors</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">allowed-origins</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;http://localhost:4200&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">allowed-methods</span><span class="p">:</span><span class="w"> </span><span class="l">GET, POST, PATCH, PUT, DELETE, OPTIONS, HEAD</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">max-age</span><span class="p">:</span><span class="w"> </span><span class="m">3600</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">allowed-headers</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Requestor-Type&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">exposed-headers</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;X-Get-Header&#34;</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">WebMvcConfigurer</span> <span class="nf">corsMappingConfigurer</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">   <span class="k">return</span> <span class="k">new</span> <span class="n">WebMvcConfigurer</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">       <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">       <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addCorsMappings</span><span class="o">(</span><span class="n">CorsRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">           <span class="n">WebConfigProperties</span><span class="o">.</span><span class="na">Cors</span> <span class="n">cors</span> <span class="o">=</span> <span class="n">webConfigProperties</span><span class="o">.</span><span class="na">getCors</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">           <span class="n">registry</span><span class="o">.</span><span class="na">addMapping</span><span class="o">(</span><span class="s">&#34;/**&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">             <span class="o">.</span><span class="na">allowedOrigins</span><span class="o">(</span><span class="n">cors</span><span class="o">.</span><span class="na">getAllowedOrigins</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">             <span class="o">.</span><span class="na">allowedMethods</span><span class="o">(</span><span class="n">cors</span><span class="o">.</span><span class="na">getAllowedMethods</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">             <span class="o">.</span><span class="na">maxAge</span><span class="o">(</span><span class="n">cors</span><span class="o">.</span><span class="na">getMaxAge</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">             <span class="o">.</span><span class="na">allowedHeaders</span><span class="o">(</span><span class="n">cors</span><span class="o">.</span><span class="na">getAllowedHeaders</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">             <span class="o">.</span><span class="na">exposedHeaders</span><span class="o">(</span><span class="n">cors</span><span class="o">.</span><span class="na">getExposedHeaders</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">       <span class="o">}</span>
</span></span><span class="line"><span class="cl">   <span class="o">};</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><blockquote>
<h4 id="corsconfiguration-é»˜è®¤å€¼"><code>CorsConfiguration</code> é»˜è®¤å€¼</h4>
<p>å¦‚æœæœªæ˜¾å¼å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªæ–¹æ³•ï¼ˆ <code>allowedOrigins</code> ã€ <code>allowedMethods</code> ã€ <code>maxAge</code> ã€ <code>allowedHeaders</code> ã€ <code>exposedHeaders</code> ï¼‰ï¼Œåˆ™ <code>addMapping()</code> è¿”å›ä¸€ä¸ª <code>CorsRegistration</code> å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åº”ç”¨é»˜è®¤çš„ <code>CorsConfiguration</code> ã€‚è¯·å‚é˜… Spring åº“æ–¹æ³• <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/cors/CorsConfiguration.html#applyPermitDefaultValues--">CorsConfiguration.applyPermitDefaultValues()</a> ä»¥äº†è§£åº”ç”¨çš„é»˜è®¤å€¼ã€‚</p>
</blockquote>
<h2 id="åœ¨-spring-webflux-åº”ç”¨ç¨‹åºä¸­é…ç½®-cors">åœ¨ Spring Webflux åº”ç”¨ç¨‹åºä¸­é…ç½® CORS</h2>
<p>åˆå§‹è®¾ç½®æ˜¯ä½¿ç”¨ Spring Initializr åˆ›å»ºçš„ï¼Œå¹¶ä½¿ç”¨ Spring Webfluxã€Spring Data R2DBC å’Œ H2 æ•°æ®åº“ã€‚æ— éœ€æ·»åŠ å¤–éƒ¨ä¾èµ–é¡¹ã€‚è¯·å‚é˜…<a href="https://github.com/thombergs/code-examples/tree/master/spring-boot/cors/configuring-cors-with-spring/SpringWebfluxApplication">æ­¤ç¤ºä¾‹ Spring Webflux é¡¹ç›®</a>ã€‚</p>
<h3 id="ä½¿ç”¨-crossorigin-è¿›è¡Œ-spring-webflux-çš„-cors-é…ç½®">ä½¿ç”¨ <code>@CrossOrigin</code> è¿›è¡Œ Spring Webflux çš„ CORS é…ç½®</h3>
<p>ä¸Spring MVCç±»ä¼¼ï¼Œåœ¨Spring Webfluxä¸­æˆ‘ä»¬å¯ä»¥åœ¨ç±»çº§åˆ«æˆ–æ–¹æ³•çº§åˆ«å®šä¹‰ <code>@CrossOrigin</code> ã€‚å‰é¢å‡ èŠ‚ä¸­æè¿°çš„ç›¸åŒ <code>@CrossOrigin</code> å±æ€§å°†é€‚ç”¨ã€‚æ­¤å¤–ï¼Œå½“åœ¨ç±»å’Œæ–¹æ³•ä¸­éƒ½å®šä¹‰äº†æ³¨é‡Šæ—¶ï¼Œå…¶ç»„åˆå±æ€§å°†åº”ç”¨äºæ–¹æ³•ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@CrossOrigin</span><span class="o">(</span><span class="n">origins</span> <span class="o">=</span> <span class="s">&#34;http://localhost:4200&#34;</span><span class="o">,</span> <span class="n">allowedHeaders</span> <span class="o">=</span> <span class="s">&#34;Requestor-Type&#34;</span><span class="o">,</span> <span class="n">exposedHeaders</span> <span class="o">=</span> <span class="s">&#34;X-Get-Header&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@GetMapping</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Mono</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">BookDto</span><span class="o">&gt;&gt;&gt;</span> <span class="nf">getBooks</span><span class="o">(</span><span class="nd">@RequestParam</span> <span class="n">String</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">HttpHeaders</span> <span class="n">headers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpHeaders</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">headers</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">&#34;X-Get-Header&#34;</span><span class="o">,</span> <span class="s">&#34;ExampleHeader&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">().</span><span class="na">headers</span><span class="o">(</span><span class="n">headers</span><span class="o">).</span><span class="na">body</span><span class="o">(</span><span class="n">libraryService</span><span class="o">.</span><span class="na">getAllBooks</span><span class="o">(</span><span class="n">type</span><span class="o">));</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h3 id="åœ¨-spring-webflux-ä¸­å…¨å±€å¯ç”¨-cors-é…ç½®">åœ¨ Spring Webflux ä¸­å…¨å±€å¯ç”¨ CORS é…ç½®</h3>
<p>è¦åœ¨ Spring Webflux åº”ç”¨ç¨‹åºä¸­å…¨å±€å®šä¹‰ CORSï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>WebfluxConfigurer</code> å¹¶è¦†ç›– <code>addCorsMappings()</code> ã€‚ä¸ Spring MVC ç±»ä¼¼ï¼Œå®ƒä½¿ç”¨å¸¦æœ‰é»˜è®¤å€¼çš„ <code>CorsConfiguration</code> ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è¦†ç›–é»˜è®¤å€¼ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">WebFluxConfigurer</span> <span class="nf">corsMappingConfigurer</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">new</span> <span class="n">WebFluxConfigurer</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addCorsMappings</span><span class="o">(</span><span class="n">CorsRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">WebConfigProperties</span><span class="o">.</span><span class="na">Cors</span> <span class="n">cors</span> <span class="o">=</span> <span class="n">webConfigProperties</span><span class="o">.</span><span class="na">getCors</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="n">registry</span><span class="o">.</span><span class="na">addMapping</span><span class="o">(</span><span class="s">&#34;/**&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">              <span class="o">.</span><span class="na">allowedOrigins</span><span class="o">(</span><span class="n">cors</span><span class="o">.</span><span class="na">getAllowedOrigins</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">              <span class="o">.</span><span class="na">allowedMethods</span><span class="o">(</span><span class="n">cors</span><span class="o">.</span><span class="na">getAllowedMethods</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">              <span class="o">.</span><span class="na">maxAge</span><span class="o">(</span><span class="n">cors</span><span class="o">.</span><span class="na">getMaxAge</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">              <span class="o">.</span><span class="na">allowedHeaders</span><span class="o">(</span><span class="n">cors</span><span class="o">.</span><span class="na">getAllowedHeaders</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">              <span class="o">.</span><span class="na">exposedHeaders</span><span class="o">(</span><span class="n">cors</span><span class="o">.</span><span class="na">getExposedHeaders</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">};</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h3 id="ä½¿ç”¨-webfilter-å¯ç”¨-cors">ä½¿ç”¨ <code>WebFilter</code> å¯ç”¨ CORS</h3>
<p>Webflux æ¡†æ¶å…è®¸é€šè¿‡ <code>CorsWebFilter</code> å…¨å±€è®¾ç½® CORS é…ç½®ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>CorsConfiguration</code> å¯¹è±¡æ¥è®¾ç½®æ‰€éœ€çš„é…ç½®å¹¶æ³¨å†Œè¦ä¸è¿‡æ»¤å™¨ä¸€èµ·ä½¿ç”¨çš„ <code>CorsConfigurationSource</code> ã€‚</p>
<p>ä½†æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿‡æ»¤å™¨ä¸­çš„ <code>CorsConfiguration</code> ä¸ä¼šå°†é»˜è®¤é…ç½®åˆ†é…ç»™ç«¯ç‚¹ï¼åªèƒ½åº”ç”¨æŒ‡å®šçš„é…ç½®ã€‚</p>
<p>å¦ä¸€ç§é€‰æ‹©æ˜¯æ˜¾å¼è°ƒç”¨ <code>CorsConfiguration.applyPermitDefaultValues()</code> ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">CorsWebFilter</span> <span class="nf">corsWebFilter</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">CorsConfiguration</span> <span class="n">corsConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CorsConfiguration</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">corsConfig</span><span class="o">.</span><span class="na">setAllowedOrigins</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;http://localhost:4200&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="n">corsConfig</span><span class="o">.</span><span class="na">setMaxAge</span><span class="o">(</span><span class="n">3600L</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">corsConfig</span><span class="o">.</span><span class="na">addAllowedMethod</span><span class="o">(</span><span class="s">&#34;*&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">corsConfig</span><span class="o">.</span><span class="na">addAllowedHeader</span><span class="o">(</span><span class="s">&#34;Requestor-Type&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">corsConfig</span><span class="o">.</span><span class="na">addExposedHeader</span><span class="o">(</span><span class="s">&#34;X-Get-Header&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">UrlBasedCorsConfigurationSource</span> <span class="n">source</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">        <span class="k">new</span> <span class="n">UrlBasedCorsConfigurationSource</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">source</span><span class="o">.</span><span class="na">registerCorsConfiguration</span><span class="o">(</span><span class="s">&#34;/**&#34;</span><span class="o">,</span> <span class="n">corsConfig</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">new</span> <span class="n">CorsWebFilter</span><span class="o">(</span><span class="n">source</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h2 id="ä½¿ç”¨-spring-security-å¯ç”¨-cors">ä½¿ç”¨ Spring Security å¯ç”¨ CORS</h2>
<p>å¦‚æœ Spring Security åº”ç”¨äº Spring åº”ç”¨ç¨‹åºï¼Œåˆ™å¿…é¡»åœ¨ Spring Security ç”Ÿæ•ˆä¹‹å‰å¤„ç† CORSï¼Œå› ä¸ºé¢„æ£€è¯·æ±‚ä¸ä¼šåŒ…å« cookieï¼Œå¹¶ä¸” Spring Security å°†æ‹’ç»è¯¥è¯·æ±‚ï¼Œå› ä¸ºå®ƒå°†ç¡®å®šç”¨æˆ·æœªç»è¿‡èº«ä»½éªŒè¯ã€‚è¿™é‡Œæ˜¾ç¤ºçš„ç¤ºä¾‹å°†æ¼”ç¤ºåŸºæœ¬èº«ä»½éªŒè¯ã€‚</p>
<p>ä¸ºäº†åº”ç”¨ Spring å®‰å…¨æ€§ï¼Œæˆ‘ä»¬å°†æ·»åŠ ä»¥ä¸‹ä¾èµ– Mavenï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-security<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>Gradle:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-groovy" data-lang="groovy"><span class="line"><span class="cl">  <span class="n">implementation</span> <span class="s1">&#39;org.springframework.boot:spring-boot-starter-security&#39;</span>
</span></span></code></pre></div><h3 id="spring-security-åº”ç”¨äº-spring-web-mvc">Spring Security åº”ç”¨äº Spring Web MVC</h3>
<p>Spring security é»˜è®¤ä¿æŠ¤æ¯ä¸ªç«¯ç‚¹ã€‚ä½†æ˜¯ï¼Œè¿™ä¼šå¯¼è‡´ CORS é”™è¯¯ï¼Œå› ä¸ºæµè§ˆå™¨çš„ <code>OPTIONS</code> é¢„æ£€è¯·æ±‚å°†è¢«é˜»æ­¢ã€‚è¦ä½¿ Spring Security ç»•è¿‡é¢„æ£€è¯·æ±‚ï¼Œæˆ‘ä»¬éœ€è¦å°† <code>http.cors()</code> æ·»åŠ åˆ° <code>HTTPSecurity</code> å¯¹è±¡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span>
</span></span><span class="line"><span class="cl"><span class="nd">@EnableConfigurationProperties</span><span class="o">(</span><span class="n">BasicAuthConfigProperties</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@EnableWebSecurity</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfiguration</span> <span class="kd">extends</span> <span class="n">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">BasicAuthConfigProperties</span> <span class="n">basicAuth</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">SecurityConfiguration</span><span class="o">(</span><span class="n">BasicAuthConfigProperties</span> <span class="n">basicAuth</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">basicAuth</span> <span class="o">=</span> <span class="n">basicAuth</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">http</span><span class="o">.</span><span class="na">cors</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>è¦åœ¨ç»•è¿‡é¢„æ£€è¯·æ±‚åä½¿ç”¨ Spring Security è®¾ç½®é¢å¤–çš„ CORS é…ç½®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>@CrossOrigin</code> æ³¨é‡Šæ¥é…ç½® CORSï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@CrossOrigin</span><span class="o">(</span><span class="n">maxAge</span> <span class="o">=</span> <span class="n">3600</span><span class="o">,</span> <span class="n">allowCredentials</span> <span class="o">=</span> <span class="s">&#34;true&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nd">@RestController</span>
</span></span><span class="line"><span class="cl"><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&#34;cors-library/managed/books&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LibraryController</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">LibraryController</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">LibraryService</span> <span class="n">libraryService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">LibraryController</span><span class="o">(</span><span class="n">LibraryService</span> <span class="n">libraryService</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">libraryService</span> <span class="o">=</span> <span class="n">libraryService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@CrossOrigin</span><span class="o">(</span><span class="n">origins</span> <span class="o">=</span> <span class="s">&#34;http://localhost:4200&#34;</span><span class="o">,</span> <span class="n">allowedHeaders</span> <span class="o">=</span> <span class="o">{</span><span class="s">&#34;Requestor-Type&#34;</span><span class="o">,</span> <span class="s">&#34;Authorization&#34;</span><span class="o">},</span> <span class="n">exposedHeaders</span> <span class="o">=</span> <span class="s">&#34;X-Get-Header&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@GetMapping</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">BookDto</span><span class="o">&gt;&gt;</span> <span class="nf">getBooks</span><span class="o">(</span><span class="nd">@RequestParam</span> <span class="n">String</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">HttpHeaders</span> <span class="n">headers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpHeaders</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">headers</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">&#34;X-Get-Header&#34;</span><span class="o">,</span> <span class="s">&#34;ExampleHeader&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">().</span><span class="na">headers</span><span class="o">(</span><span class="n">headers</span><span class="o">).</span><span class="na">body</span><span class="o">(</span><span class="n">libraryService</span><span class="o">.</span><span class="na">getAllBooks</span><span class="o">(</span><span class="n">type</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª <code>CorsConfigurationSource</code> beanï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl"><span class="n">CorsConfigurationSource</span> <span class="nf">corsConfigurationSource</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">CorsConfiguration</span> <span class="n">configuration</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CorsConfiguration</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">  <span class="n">configuration</span><span class="o">.</span><span class="na">setAllowedOrigins</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;http://localhost:4200&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">  <span class="n">configuration</span><span class="o">.</span><span class="na">setAllowedMethods</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;GET&#34;</span><span class="o">,</span><span class="s">&#34;POST&#34;</span><span class="o">,</span><span class="s">&#34;PATCH&#34;</span><span class="o">,</span> <span class="s">&#34;PUT&#34;</span><span class="o">,</span> <span class="s">&#34;DELETE&#34;</span><span class="o">,</span> <span class="s">&#34;OPTIONS&#34;</span><span class="o">,</span> <span class="s">&#34;HEAD&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">  <span class="n">configuration</span><span class="o">.</span><span class="na">setAllowCredentials</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">configuration</span><span class="o">.</span><span class="na">setAllowedHeaders</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;Authorization&#34;</span><span class="o">,</span> <span class="s">&#34;Requestor-Type&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">  <span class="n">configuration</span><span class="o">.</span><span class="na">setExposedHeaders</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;X-Get-Header&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">  <span class="n">configuration</span><span class="o">.</span><span class="na">setMaxAge</span><span class="o">(</span><span class="n">3600L</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">UrlBasedCorsConfigurationSource</span> <span class="n">source</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UrlBasedCorsConfigurationSource</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">  <span class="n">source</span><span class="o">.</span><span class="na">registerCorsConfiguration</span><span class="o">(</span><span class="s">&#34;/**&#34;</span><span class="o">,</span> <span class="n">configuration</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">source</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h3 id="spring-security-åº”ç”¨äº-spring-webflux">Spring Security åº”ç”¨äº Spring Webflux</h3>
<p>å¯¹äº Webfluxï¼Œå°½ç®¡ä½¿ç”¨ Spring Securityï¼Œå°† CORS é…ç½®åº”ç”¨äºä¼ å…¥è¯·æ±‚çš„æœ€é¦–é€‰æ–¹æ³•æ˜¯ä½¿ç”¨ <code>CorsWebFilter</code> ã€‚æˆ‘ä»¬å¯ä»¥ç¦ç”¨ CORS ä¸ Spring security çš„é›†æˆï¼Œè€Œæ˜¯é€šè¿‡æä¾› <code>CorsConfigurationSource</code> ä¸ <code>CorsWebFilter</code> é›†æˆï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span>
</span></span><span class="line"><span class="cl"><span class="nd">@EnableWebFluxSecurity</span>
</span></span><span class="line"><span class="cl"><span class="nd">@EnableConfigurationProperties</span><span class="o">(</span><span class="n">BasicAuthConfigProperties</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfiguration</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">BasicAuthConfigProperties</span> <span class="n">basicAuth</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">SecurityConfiguration</span><span class="o">(</span><span class="n">BasicAuthConfigProperties</span> <span class="n">basicAuth</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">basicAuth</span> <span class="o">=</span> <span class="n">basicAuth</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">SecurityWebFilterChain</span> <span class="nf">securityWebFilterChain</span><span class="o">(</span><span class="n">ServerHttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">http</span><span class="o">.</span><span class="na">cors</span><span class="o">(</span><span class="n">cors</span> <span class="o">-&gt;</span> <span class="n">cors</span><span class="o">.</span><span class="na">disable</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">securityMatcher</span><span class="o">(</span><span class="k">new</span> <span class="n">PathPatternParserServerWebExchangeMatcher</span><span class="o">(</span><span class="s">&#34;/**&#34;</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">authorizeExchange</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">anyExchange</span><span class="o">().</span><span class="na">authenticated</span><span class="o">().</span><span class="na">and</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">httpBasic</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">http</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">MapReactiveUserDetailsService</span> <span class="nf">userDetailsService</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">UserDetails</span> <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="na">withDefaultPasswordEncoder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">username</span><span class="o">(</span><span class="n">basicAuth</span><span class="o">.</span><span class="na">getUsername</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">password</span><span class="o">(</span><span class="n">basicAuth</span><span class="o">.</span><span class="na">getPassword</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">roles</span><span class="o">(</span><span class="s">&#34;USER&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">MapReactiveUserDetailsService</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">CorsConfigurationSource</span> <span class="nf">corsConfiguration</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">CorsConfiguration</span> <span class="n">corsConfig</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CorsConfiguration</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">corsConfig</span><span class="o">.</span><span class="na">applyPermitDefaultValues</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">corsConfig</span><span class="o">.</span><span class="na">setAllowCredentials</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">corsConfig</span><span class="o">.</span><span class="na">addAllowedMethod</span><span class="o">(</span><span class="s">&#34;GET&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">corsConfig</span><span class="o">.</span><span class="na">addAllowedMethod</span><span class="o">(</span><span class="s">&#34;PATCH&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">corsConfig</span><span class="o">.</span><span class="na">addAllowedMethod</span><span class="o">(</span><span class="s">&#34;POST&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">corsConfig</span><span class="o">.</span><span class="na">addAllowedMethod</span><span class="o">(</span><span class="s">&#34;OPTIONS&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">corsConfig</span><span class="o">.</span><span class="na">setAllowedOrigins</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;http://localhost:4200&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">corsConfig</span><span class="o">.</span><span class="na">setAllowedHeaders</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;Authorization&#34;</span><span class="o">,</span> <span class="s">&#34;Requestor-Type&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">corsConfig</span><span class="o">.</span><span class="na">setExposedHeaders</span><span class="o">(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;X-Get-Header&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">UrlBasedCorsConfigurationSource</span> <span class="n">source</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">                <span class="k">new</span> <span class="n">UrlBasedCorsConfigurationSource</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">source</span><span class="o">.</span><span class="na">registerCorsConfiguration</span><span class="o">(</span><span class="s">&#34;/**&#34;</span><span class="o">,</span> <span class="n">corsConfig</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">source</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">CorsWebFilter</span> <span class="nf">corsWebFilter</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">CorsWebFilter</span><span class="o">(</span><span class="n">corsConfiguration</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h2 id="ç»“è®º">ç»“è®º</h2>
<p>ç®€è€Œè¨€ä¹‹ï¼ŒCORS é…ç½®å–å†³äºå¤šä¸ªå› ç´ ï¼š</p>
<ul>
<li>Spring Web / Spring Webflux</li>
<li>æœ¬åœ°/å…¨å±€ CORS é…ç½®</li>
<li>æ˜¯å¦ä½¿ç”¨ Spring Security</li>
</ul>
<p>æ ¹æ®æ¡†æ¶ï¼Œæˆ‘ä»¬å¯ä»¥å†³å®šå“ªç§æ–¹æ³•æ•ˆæœæœ€å¥½å¹¶ä¸”æœ€å®¹æ˜“å®ç°ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é¿å… CORS é”™è¯¯ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ <a href="https://github.com/thombergs/code-examples/tree/master/spring-boot/cors/configuring-cors-with-spring">GitHub ä¸Šçš„ç¤ºä¾‹åº”ç”¨ç¨‹åº</a>ã€‚</p>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://reflectoring.io/spring-cors/">https://reflectoring.io/spring-cors/</a></p>
]]></content:encoded>
    </item>
    
    <item>
      <title>[è¯‘]ä½¿ç”¨Spring Boot Actuatorå…¬å¼€æœ‰ç”¨çš„ä¿¡æ¯ç«¯ç‚¹</title>
      <link>https://blog.chensoul.com/posts/2023/07/26/spring-boot-info-endpoint/</link>
      <pubDate>Wed, 26 Jul 2023 07:05:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/07/26/spring-boot-info-endpoint/</guid>
      <description>åœ¨åˆ†å¸ƒå¼ã€å¿«èŠ‚å¥çš„ç¯å¢ƒä¸­ï¼Œå¼€å‘å›¢é˜Ÿé€šå¸¸å¸Œæœ›äº†è§£ä»–ä»¬éƒ¨ç½²åº”ç”¨ç¨‹åºçš„æ—¶é—´ã€éƒ¨ç½²çš„åº”ç”¨ç¨‹åºç‰ˆæœ¬ã€éƒ¨ç½²çš„ Git æäº¤ç­‰ç­‰ã€‚ Spring Boot Actuatorå¸®åŠ©æˆ‘ä»¬ç›‘æ§</description>
      <content:encoded><![CDATA[<p>åœ¨åˆ†å¸ƒå¼ã€å¿«èŠ‚å¥çš„ç¯å¢ƒä¸­ï¼Œå¼€å‘å›¢é˜Ÿé€šå¸¸å¸Œæœ›äº†è§£ä»–ä»¬éƒ¨ç½²åº”ç”¨ç¨‹åºçš„æ—¶é—´ã€éƒ¨ç½²çš„åº”ç”¨ç¨‹åºç‰ˆæœ¬ã€éƒ¨ç½²çš„ Git æäº¤ç­‰ç­‰ã€‚</p>
<p>Spring Boot Actuatorå¸®åŠ©æˆ‘ä»¬ç›‘æ§å’Œç®¡ç†åº”ç”¨ç¨‹åºã€‚å®ƒå…¬å¼€äº†æä¾›åº”ç”¨ç¨‹åºè¿è¡ŒçŠ¶å†µã€æŒ‡æ ‡å’Œå…¶ä»–ç›¸å…³ä¿¡æ¯çš„å„ç§ç«¯ç‚¹ã€‚</p>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•ä½¿ç”¨ Spring Boot Actuator å’Œ Maven/Gradle æ„å»ºæ’ä»¶å°†æ­¤ç±»ä¿¡æ¯æ·»åŠ åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­ã€‚</p>
<h2 id="ç¤ºä¾‹ä»£ç ">ç¤ºä¾‹ä»£ç </h2>
<p>æœ¬æ–‡é™„æœ‰ GitHub ä¸Šçš„å·¥ä½œ<a href="https://github.com/thombergs/code-examples/tree/master/spring-boot/spring-boot-app-info">ä»£ç ç¤ºä¾‹</a>ã€‚</p>
<h2 id="å¯ç”¨-spring-boot-æ‰§è¡Œå™¨">å¯ç”¨ Spring Boot æ‰§è¡Œå™¨</h2>
<p>Spring Boot Actuatoræ˜¯Spring Bootçš„ä¸€ä¸ªå­é¡¹ç›®ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å¿«é€Ÿäº†è§£å¦‚ä½•å¼•å¯¼ç¤ºä¾‹é¡¹ç›®å¹¶å¯ç”¨ <code>/info</code> ç«¯ç‚¹ã€‚å¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šæœ‰å…³ Spring Boot Actuator çš„ä¿¡æ¯ï¼Œå·²ç»æœ‰ä¸€ä¸ªå¾ˆæ£’çš„<a href="https://reflectoring.io/exploring-a-spring-boot-app-with-actuator-and-jq/">æ•™ç¨‹</a>äº†ã€‚</p>
<p>è®©æˆ‘ä»¬ä½¿ç”¨ <a href="https://start.spring.io/">Spring Initializr</a> å¿«é€Ÿåˆ›å»ºä¸€ä¸ª Spring Boot é¡¹ç›®ã€‚æˆ‘ä»¬å°†éœ€è¦ä»¥ä¸‹ä¾èµ–é¡¹ï¼š</p>
<table>
<thead>
<tr>
<th>ä¾èµ–æ€§</th>
<th>ç›®çš„</th>
</tr>
</thead>
<tbody>
<tr>
<td>Spring Boot Actuator</td>
<td>å…¬å¼€åº”ç”¨ç¨‹åºç®¡ç†ç«¯ç‚¹ï¼Œä¾‹å¦‚ <code>info</code> ã€‚</td>
</tr>
<tr>
<td>Spring Web</td>
<td>å¯ç”¨ Web åº”ç”¨ç¨‹åºè¡Œä¸ºã€‚</td>
</tr>
</tbody>
</table>
<p>å¦‚æœæœ‰å¸®åŠ©ï¼Œè¿™é‡Œæ˜¯ <a href="https://start.spring.io/#!type=maven-project&amp;language=java&amp;platformVersion=2.6.4&amp;packaging=jar&amp;jvmVersion=11&amp;groupId=io.reflectoring&amp;artifactId=demo&amp;name=Demo%20Application&amp;description=Demo%20project%20for%20Spring%20Boot%20Application%20Info&amp;packageName=io.reflectoring.demo&amp;dependencies=web,actuator">Maven</a> å’Œ <a href="https://start.spring.io/#!type=gradle-project&amp;language=java&amp;platformVersion=2.6.4&amp;packaging=jar&amp;jvmVersion=11&amp;groupId=io.reflectoring&amp;artifactId=demo&amp;name=Demo%20Application&amp;description=Demo%20project%20for%20Spring%20Boot%20Application%20Info&amp;packageName=io.reflectoring.demo&amp;dependencies=web,actuator">Gradle</a> ä¸­é¢„å¡«å……é¡¹ç›®çš„é“¾æ¥ã€‚</p>
<p>é¡¹ç›®æ„å»ºåï¼Œæˆ‘ä»¬å°†é€šè¿‡ HTTP å…¬å¼€å†…ç½®çš„ <code>/info</code> ç«¯ç‚¹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ <code>/info</code> Web ç«¯ç‚¹å¤„äºç¦ç”¨çŠ¶æ€ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ <code>application.properties</code> é…ç½®ä¸­æ·»åŠ  <code>management.endpoints.web.exposure.include</code> å±æ€§æ¥ç®€å•åœ°å¯ç”¨å®ƒï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-properties" data-lang="properties"><span class="line"><span class="cl"><span class="na">management.endpoints.web.exposure.include</span><span class="o">=</span><span class="s">health,info</span>
</span></span></code></pre></div><p>è®©æˆ‘ä»¬è¿è¡Œ Spring Boot åº”ç”¨ç¨‹åºå¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ URL <code>http://localhost:8080/actuator/info</code> ã€‚ç›®å‰è¿˜çœ‹ä¸åˆ°ä»»ä½•æœ‰ç”¨çš„ä¸œè¥¿ï¼Œå› ä¸ºæˆ‘ä»¬ä»ç„¶éœ€è¦è¿›è¡Œä¸€äº›é…ç½®æ›´æ”¹ã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•åœ¨æ­¤å“åº”ä¸­æ·»åŠ ä¿¡æ¯ä¸°å¯Œçš„æ„å»ºä¿¡æ¯ã€‚</p>
<blockquote>
<h4 id="ä¿æŠ¤ç«¯ç‚¹">ä¿æŠ¤ç«¯ç‚¹</h4>
<p>å¦‚æœæ‚¨å…¬å¼€å…¬å¼€ç«¯ç‚¹ï¼Œè¯·ç¡®ä¿é€‚å½“<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html#actuator.endpoints.security">ä¿æŠ¤</a>å®ƒä»¬ã€‚æˆ‘ä»¬ä¸åº”åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ³„éœ²ä»»ä½•æ•æ„Ÿä¿¡æ¯ã€‚</p>
</blockquote>
<h2 id="spring-bootåº”ç”¨ç¨‹åºä¿¡æ¯">Spring Bootåº”ç”¨ç¨‹åºä¿¡æ¯</h2>
<p>Spring ä»åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­å®šä¹‰çš„å„ç§ <a href="https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/actuate/info/InfoContributor.html">InfoContributor</a> bean æ”¶é›†æœ‰ç”¨çš„åº”ç”¨ç¨‹åºä¿¡æ¯ã€‚ä¸‹é¢æ˜¯é»˜è®¤ <code>InfoContributor</code> beans çš„æ‘˜è¦ï¼š</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Bean Name</th>
<th>ç”¨æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>build</code></td>
<td><code>BuildInfoContributor</code></td>
<td>å…¬å¼€æ„å»ºä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td><code>env</code></td>
<td><code>EnvironmentInfoContributor</code></td>
<td>å…¬å¼€ <code>Environment</code> ä¸­åç§°ä»¥ <code>info.</code> å¼€å¤´çš„ä»»ä½•å±æ€§</td>
</tr>
<tr>
<td><code>git</code></td>
<td><code>GitInfoContributor</code></td>
<td>å…¬å¼€ Git ç›¸å…³ä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td><code>java</code></td>
<td><code>JavaInfoContributor</code></td>
<td>å…¬å¼€ Java è¿è¡Œæ—¶ä¿¡æ¯ã€‚</td>
</tr>
</tbody>
</table>
<p><strong>é»˜è®¤æƒ…å†µä¸‹ï¼Œ <code>env</code> å’Œ <code>java</code> è´¡çŒ®è€…è¢«ç¦ç”¨ã€‚</strong></p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å°†é€šè¿‡åœ¨ <code>application.properties</code> ä¸­æ·»åŠ ä»¥ä¸‹é”®å€¼å¯¹æ¥å¯ç”¨ <code>java</code> è´¡çŒ®è€…ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-properties" data-lang="properties"><span class="line"><span class="cl"><span class="na">management.info.java.enabled</span><span class="o">=</span><span class="s">true</span>
</span></span></code></pre></div><p>è®©æˆ‘ä»¬é‡æ–°è¿è¡Œè¯¥åº”ç”¨ç¨‹åºã€‚å¦‚æœæˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­å†æ¬¡æ‰“å¼€æ‰§è¡Œå™¨ <code>/info</code> ç«¯ç‚¹ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;java&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;vendor&#34;</span><span class="p">:</span> <span class="s2">&#34;Eclipse Adoptium&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;11.0.14&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;runtime&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;OpenJDK Runtime Environment&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;11.0.14+9&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;jvm&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;OpenJDK 64-Bit Server VM&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;vendor&#34;</span><span class="p">:</span> <span class="s2">&#34;Eclipse Adoptium&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;11.0.14+9&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>æ ¹æ®å®‰è£…çš„ Java ç‰ˆæœ¬ï¼Œæ‚¨å¯èƒ½ä¼šçœ‹åˆ°ä¸åŒçš„å€¼ã€‚</p>
<p>ç°åœ¨ï¼Œæ˜¯æ—¶å€™æ˜¾ç¤ºç¯å¢ƒå˜é‡äº†ã€‚ Spring ä¼šé€‰å–å±æ€§åç§°ä»¥ <code>info</code> å¼€å¤´çš„ä»»ä½•ç¯å¢ƒå˜é‡ã€‚è¦æŸ¥çœ‹å®é™…æ•ˆæœï¼Œè®©æˆ‘ä»¬åœ¨ <code>application.properties</code> æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å±æ€§ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-properties" data-lang="properties"><span class="line"><span class="cl"><span class="na">management.info.env.enabled</span><span class="o">=</span><span class="s">true</span>
</span></span><span class="line"><span class="cl"><span class="na">info.app.website</span><span class="o">=</span><span class="s">reflectoring.io</span>
</span></span></code></pre></div><p>é‡æ–°å¯åŠ¨åº”ç”¨ç¨‹åºåï¼Œæˆ‘ä»¬å°†å¼€å§‹çœ‹åˆ°æ·»åŠ åˆ°æ‰§è¡Œå™¨ <code>info</code> ç«¯ç‚¹çš„ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;app&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;website&#34;</span><span class="p">:</span> <span class="s2">&#34;reflectoring.io&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>è¯·éšæ„æ·»åŠ æ‚¨æƒ³è¦çš„ä»»æ„æ•°é‡çš„ä¿¡æ¯å˜é‡:)</p>
<p>åœ¨ä»¥ä¸‹éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•æ·»åŠ  Git å’Œåº”ç”¨ç¨‹åºæ„å»ºç‰¹å®šä¿¡æ¯ã€‚</p>
<h2 id="æ·»åŠ æ„å»ºä¿¡æ¯">æ·»åŠ æ„å»ºä¿¡æ¯</h2>
<p>æ·»åŠ æœ‰ç”¨çš„<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/howto.html#howto.build.generate-info">æ„å»ºä¿¡æ¯</a>æœ‰åŠ©äºå¿«é€Ÿè¯†åˆ«æ„å»ºå·¥ä»¶åç§°ã€ç‰ˆæœ¬ã€åˆ›å»ºæ—¶é—´ç­‰ã€‚å®ƒå¯ä»¥æ–¹ä¾¿åœ°æ£€æŸ¥å›¢é˜Ÿæ˜¯å¦éƒ¨ç½²äº†åº”ç”¨ç¨‹åºçš„ç›¸å…³ç‰ˆæœ¬ã€‚ Spring Boot å…è®¸ä½¿ç”¨ Maven æˆ– Gradle æ„å»ºæ’ä»¶è½»æ¾æ·»åŠ æ­¤å†…å®¹ã€‚</p>
<h3 id="ä½¿ç”¨-maven-æ’ä»¶">ä½¿ç”¨ Maven æ’ä»¶</h3>
<p>Spring Boot Maven æ’ä»¶æ†ç»‘äº†è®¸å¤šæœ‰ç”¨çš„åŠŸèƒ½ï¼Œä¾‹å¦‚åˆ›å»ºå¯æ‰§è¡Œ jar æˆ– war å­˜æ¡£ã€è¿è¡Œåº”ç”¨ç¨‹åºç­‰ã€‚å®ƒè¿˜æä¾›äº†ä¸€ç§æ·»åŠ åº”ç”¨ç¨‹åºæ„å»ºä¿¡æ¯çš„æ–¹æ³•ã€‚</p>
<p>å¦‚æœå­˜åœ¨æœ‰æ•ˆçš„ <code>META-INF/build-info.properties</code> æ–‡ä»¶ï¼ŒSpring Boot Actuator å°†æ˜¾ç¤ºæ„å»ºè¯¦ç»†ä¿¡æ¯ã€‚ Spring Boot Maven æ’ä»¶çš„ <code>build-info</code> ç›®æ ‡æ˜¯åˆ›å»ºæ­¤æ–‡ä»¶ã€‚</p>
<p>å¦‚æœæ‚¨ä½¿ç”¨ Spring Initializr å¼•å¯¼é¡¹ç›®ï¼Œåˆ™é»˜è®¤æƒ…å†µä¸‹è¯¥æ’ä»¶å°†å‡ºç°åœ¨ <code>pom.xml</code> ä¸­ã€‚æˆ‘ä»¬åªéœ€æ·»åŠ  <code>build-info</code> æ‰§è¡Œç›®æ ‡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;version&gt;</span>2.6.4<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;executions&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;execution&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;goals&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;goal&gt;</span>build-info<span class="nt">&lt;/goal&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;/goals&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/execution&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/executions&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/plugin&gt;</span>
</span></span></code></pre></div><p>å¦‚æœæˆ‘ä»¬ç°åœ¨è¿è¡Œå‘½ä»¤ <code>./mvnw spring-boot:run</code> ï¼ˆå¯¹äº Linux/macOSï¼‰æˆ– <code>mvnw.bat spring-boot:run</code> ï¼ˆå¯¹äº Windowsï¼‰ï¼Œæ‰€éœ€çš„æ–‡ä»¶å°†åœ¨ <code>target/classes/META-INF/build-info.properties</code> ä¸­åˆ›å»ºã€‚</p>
<p><strong>æ–‡ä»¶å†…å®¹å°†ä¸æ­¤ç±»ä¼¼ï¼š</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-properties" data-lang="properties"><span class="line"><span class="cl"><span class="na">build.artifact</span><span class="o">=</span><span class="s">spring-boot-build-info</span>
</span></span><span class="line"><span class="cl"><span class="na">build.group</span><span class="o">=</span><span class="s">io.reflectoring</span>
</span></span><span class="line"><span class="cl"><span class="na">build.name</span><span class="o">=</span><span class="s">spring-boot-build-info</span>
</span></span><span class="line"><span class="cl"><span class="na">build.time</span><span class="o">=</span><span class="s">2022-03-06T05\:53\:45.236Z</span>
</span></span><span class="line"><span class="cl"><span class="na">build.version</span><span class="o">=</span><span class="s">0.0.1-SNAPSHOT</span>
</span></span></code></pre></div><p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ <code>additionalProperties</code> å±æ€§å°†è‡ªå®šä¹‰å±æ€§æ·»åŠ åˆ°æ­¤åˆ—è¡¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;execution&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;goals&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;goal&gt;</span>build-info<span class="nt">&lt;/goal&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/goals&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;configuration&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;additionalProperties&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;custom.key1&gt;</span>value1<span class="nt">&lt;/custom.key1&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;custom.key2&gt;</span>value2<span class="nt">&lt;/custom.key2&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/additionalProperties&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/configuration&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/execution&gt;</span>
</span></span></code></pre></div><p>å¦‚æœæˆ‘ä»¬ç°åœ¨è¿è¡Œåº”ç”¨ç¨‹åºå¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ <code>http://localhost:8080/actuator/info</code> ç«¯ç‚¹ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ç±»ä¼¼äºä»¥ä¸‹å†…å®¹çš„å“åº”ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;build&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;custom&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;key2&#34;</span><span class="p">:</span> <span class="s2">&#34;value2&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;key1&#34;</span><span class="p">:</span> <span class="s2">&#34;value1&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;0.0.1-SNAPSHOT&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;artifact&#34;</span><span class="p">:</span> <span class="s2">&#34;spring-boot-build-info&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;spring-boot-build-info&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;time&#34;</span><span class="p">:</span> <span class="s2">&#34;2022-03-06T06:34:30.306Z&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;group&#34;</span><span class="p">:</span> <span class="s2">&#34;io.reflectoring&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>å¦‚æœæ‚¨æƒ³æ’é™¤ä»»ä½•å¯ä»¥ä½¿ç”¨ <code>excludeInfoProperties</code> é…ç½®çš„å±æ€§ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•æ’é™¤ <code>artifact</code> å±æ€§ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;configuration&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;excludeInfoProperties&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;infoProperty&gt;</span>artifact<span class="nt">&lt;/infoProperty&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/excludeInfoProperties&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/configuration&gt;</span>
</span></span></code></pre></div><p>è¯·å‚é˜… Spring Boot <a href="https://docs.spring.io/spring-boot/docs/current/maven-plugin/reference/htmlsingle/#goals-build-info">å®˜æ–¹æ–‡æ¡£</a>äº†è§£æ›´å¤šä¿¡æ¯ã€‚</p>
<p>ç°åœ¨ï¼Œæ˜¯æ—¶å€™çœ‹çœ‹æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨ Spring Boot Gradle æ’ä»¶å®ç°ç›¸åŒçš„è¾“å‡ºäº†ã€‚</p>
<h3 id="ä½¿ç”¨-gradle-æ’ä»¶">ä½¿ç”¨ Gradle æ’ä»¶</h3>
<p>æ·»åŠ æ„å»ºä¿¡æ¯çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨æ’ä»¶ DSLã€‚åœ¨ <code>build.gradle</code> æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä»¥ä¸‹å—ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gradle" data-lang="gradle"><span class="line"><span class="cl"><span class="n">springBoot</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">buildInfo</span><span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>å¦‚æœæˆ‘ä»¬ç°åœ¨åŒæ­¥ Gradle é¡¹ç›®ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæ–°ä»»åŠ¡ <code>bootBuildInfo</code> å¯ä¾›ä½¿ç”¨ã€‚è¿è¡Œè¯¥ä»»åŠ¡å°†ç”Ÿæˆå¸¦æœ‰æ„å»ºä¿¡æ¯çš„ç±»ä¼¼ <code>build/resources/main/META-INF/build-info.properties</code> æ–‡ä»¶ï¼ˆæºè‡ªé¡¹ç›®ï¼‰ã€‚ä½¿ç”¨ DSLï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ç°æœ‰å€¼æˆ–æ·»åŠ æ–°å±æ€§ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gradle" data-lang="gradle"><span class="line"><span class="cl"><span class="n">springBoot</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">buildInfo</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">properties</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Sample App&#39;</span>
</span></span><span class="line"><span class="cl">      <span class="n">additional</span> <span class="o">=</span> <span class="o">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;customKey&#39;</span><span class="o">:</span> <span class="s1">&#39;customValue&#39;</span>
</span></span><span class="line"><span class="cl">      <span class="o">]</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æ˜¯æ—¶å€™ä½¿ç”¨ <code>./gradlew bootRun</code> ï¼ˆå¯¹äº macOS/Linuxï¼‰æˆ– <code>gradlew.bat bootRun</code> ï¼ˆå¯¹äº Windowsï¼‰å‘½ä»¤è¿è¡Œåº”ç”¨ç¨‹åºäº†ã€‚åº”ç”¨ç¨‹åºè¿è¡Œåï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ <code>http://localhost:8080/actuator/info</code> ç«¯ç‚¹å¹¶æ‰¾åˆ°å“åº”ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;build&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;customKey&#34;</span><span class="p">:</span> <span class="s2">&#34;customValue&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;0.0.1-SNAPSHOT&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;artifact&#34;</span><span class="p">:</span> <span class="s2">&#34;spring-boot-build-info&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Sample App&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;time&#34;</span><span class="p">:</span> <span class="s2">&#34;2022-03-06T09:11:53.380Z&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;group&#34;</span><span class="p">:</span> <span class="s2">&#34;io.reflectoring&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†å…¶å€¼è®¾ç½®ä¸º <code>null</code> æ¥ä»ç”Ÿæˆçš„æ„å»ºä¿¡æ¯ä¸­æ’é™¤ä»»ä½•é»˜è®¤å±æ€§ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gradle" data-lang="gradle"><span class="line"><span class="cl"><span class="n">properties</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">group</span> <span class="o">=</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æƒ³äº†è§£æ›´å¤šå…³äºè¯¥æ’ä»¶çš„ä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒ Spring Boot <a href="https://docs.spring.io/spring-boot/docs/current/gradle-plugin/reference/htmlsingle/#integrating-with-actuator">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<h2 id="æ·»åŠ -git-ä¿¡æ¯">æ·»åŠ  Git ä¿¡æ¯</h2>
<p><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/howto.html#howto.build.generate-git-info">Git ä¿¡æ¯</a>å¯ä»¥æ–¹ä¾¿åœ°å¿«é€Ÿè¯†åˆ«ç”Ÿäº§ä¸­æ˜¯å¦å­˜åœ¨ç›¸å…³ä»£ç æˆ–è€…åˆ†å¸ƒå¼éƒ¨ç½²æ˜¯å¦ä¸é¢„æœŸåŒæ­¥ã€‚ Spring Boot å¯ä»¥ä½¿ç”¨ Maven å’Œ Gradle æ’ä»¶è½»æ¾åœ°å°† Git å±æ€§åŒ…å«åœ¨ Actuator ç«¯ç‚¹ä¸­ã€‚</p>
<p>ä½¿ç”¨è¿™ä¸ªæ’ä»¶æˆ‘ä»¬å¯ä»¥ç”Ÿæˆä¸€ä¸ª <code>git.properties</code> æ–‡ä»¶ã€‚æ­¤æ–‡ä»¶çš„å­˜åœ¨å°†è‡ªåŠ¨é…ç½® <a href="https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/info/GitProperties.html">GitProperties</a> beanï¼Œä¾› <a href="https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/actuate/info/GitInfoContributor.html">GitInfoContributor</a> bean ä½¿ç”¨æ¥æ•´ç†ç›¸å…³ä¿¡æ¯ã€‚</p>
<p><strong>é»˜è®¤æƒ…å†µä¸‹ï¼Œå°†å…¬å¼€ä»¥ä¸‹ä¿¡æ¯ï¼š</strong></p>
<ul>
<li><code>git.branch</code></li>
<li><code>git.commit.id</code></li>
<li><code>git.commit.time</code></li>
</ul>
<p>ä»¥ä¸‹ç®¡ç†åº”ç”¨ç¨‹åºå±æ€§æ§åˆ¶ Git ç›¸å…³ä¿¡æ¯ï¼š</p>
<table>
<thead>
<tr>
<th>åº”ç”¨å±æ€§</th>
<th>ç›®çš„</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>management.info.git.enabled=false</code></td>
<td>å®Œå…¨ä» <code>info</code> ç«¯ç‚¹ç¦ç”¨ Git ä¿¡æ¯</td>
</tr>
<tr>
<td><code>management.info.git.mode=full</code></td>
<td>æ˜¾ç¤º <code>git.properties</code> æ–‡ä»¶ä¸­çš„æ‰€æœ‰å±æ€§</td>
</tr>
</tbody>
</table>
<h3 id="ä½¿ç”¨-maven-æ’ä»¶-1">ä½¿ç”¨ Maven æ’ä»¶</h3>
<p><a href="https://github.com/git-commit-id/git-commit-id-maven-plugin">Maven Git Commit ID æ’ä»¶</a>é€šè¿‡ <code>spring-boot-starter-parent</code> pom.xml è¿›è¡Œç®¡ç†ã€‚è¦ä½¿ç”¨å®ƒï¼Œæˆ‘ä»¬å¿…é¡»ç¼–è¾‘ <code>pom.xml</code> å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;groupId&gt;</span>pl.project13.maven<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;artifactId&gt;</span>git-commit-id-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/plugin&gt;</span>
</span></span></code></pre></div><p>å¦‚æœæˆ‘ä»¬è¿è¡Œè¯¥é¡¹ç›®å¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ <code>/actuator/info</code> ç«¯ç‚¹ï¼Œå®ƒå°†è¿”å›Gitç›¸å…³ä¿¡æ¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;git&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;branch&#34;</span><span class="p">:</span> <span class="s2">&#34;main&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;commit&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;5404bdf&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;time&#34;</span><span class="p">:</span> <span class="s2">&#34;2022-03-06T10:34:16Z&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>æˆ‘ä»¬è¿˜å¯ä»¥æ£€æŸ¥ <code>target/classes/git.properties</code> ä¸‹ç”Ÿæˆçš„æ–‡ä»¶ã€‚è¿™å¯¹æˆ‘æ¥è¯´æ˜¯è¿™æ ·çš„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">#Generated by Git-Commit-Id-Plugin
</span></span><span class="line"><span class="cl">git.branch=main
</span></span><span class="line"><span class="cl">git.build.host=mylaptop
</span></span><span class="line"><span class="cl">git.build.time=2022-03-06T23\:22\:16+0530
</span></span><span class="line"><span class="cl">git.build.user.email=user@email.com
</span></span><span class="line"><span class="cl">git.build.user.name=user
</span></span><span class="line"><span class="cl">git.build.version=0.0.1-SNAPSHOT
</span></span><span class="line"><span class="cl">git.closest.tag.commit.count=
</span></span><span class="line"><span class="cl">git.closest.tag.name=
</span></span><span class="line"><span class="cl">git.commit.author.time=2022-03-06T22\:46\:56+0530
</span></span><span class="line"><span class="cl">git.commit.committer.time=2022-03-06T22\:46\:56+0530
</span></span><span class="line"><span class="cl">git.commit.id=e9fa20d4914367c1632e3a0eb8ca4d2f32b31a89
</span></span><span class="line"><span class="cl">git.commit.id.abbrev=e9fa20d
</span></span><span class="line"><span class="cl">git.commit.id.describe=e9fa20d-dirty
</span></span><span class="line"><span class="cl">git.commit.id.describe-short=e9fa20d-dirty
</span></span><span class="line"><span class="cl">git.commit.message.full=Update config
</span></span><span class="line"><span class="cl">git.commit.message.short=Update config
</span></span><span class="line"><span class="cl">git.commit.time=2022-03-06T22\:46\:56+0530
</span></span><span class="line"><span class="cl">git.commit.user.email=saikat@email.com
</span></span><span class="line"><span class="cl">git.commit.user.name=Saikat
</span></span><span class="line"><span class="cl">git.dirty=true
</span></span><span class="line"><span class="cl">git.local.branch.ahead=NO_REMOTE
</span></span><span class="line"><span class="cl">git.local.branch.behind=NO_REMOTE
</span></span><span class="line"><span class="cl">git.remote.origin.url=Unknown
</span></span><span class="line"><span class="cl">git.tags=
</span></span><span class="line"><span class="cl">git.total.commit.count=2
</span></span></code></pre></div><p>è¿™ä¸ªæ’ä»¶å¸¦æœ‰å¾ˆå¤š<a href="https://github.com/git-commit-id/git-commit-id-maven-plugin/blob/master/docs/using-the-plugin.md">é…ç½®</a>é€‰é¡¹ã€‚ä¾‹å¦‚ï¼Œè¦åŒ…å«/æ’é™¤ç‰¹å®šå±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ  <code>configuration</code> éƒ¨åˆ†ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;configuration&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;excludeProperties&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;excludeProperty&gt;</span>time<span class="nt">&lt;/excludeProperty&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/excludeProperties&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;includeOnlyProperties&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;property&gt;</span>git.commit.id<span class="nt">&lt;/property&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/includeOnlyProperties&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/configuration&gt;</span>
</span></span></code></pre></div><p>å®ƒå°†ç”Ÿæˆå¦‚ä¸‹è¾“å‡ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;git&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;commit&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;5404bdf&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><blockquote>
<p>è¯‘è€…å¤‡æ³¨ï¼š</p>
<p>ä½¿ç”¨ 4.9.10 ç‰ˆæœ¬æ—¶ï¼Œå¦‚æœæƒ³æŒ‡å®šè¾“å‡ºå†…å®¹ï¼Œéœ€è¦è¿™æ ·è®¾ç½®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;plugin&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&lt;groupId&gt;</span>pl.project13.maven<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&lt;artifactId&gt;</span>git-commit-id-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&lt;version&gt;</span>4.9.10<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&lt;executions&gt;</span>
</span></span><span class="line"><span class="cl">       <span class="nt">&lt;execution&gt;</span>
</span></span><span class="line"><span class="cl">           <span class="nt">&lt;goals&gt;</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&lt;goal&gt;</span>revision<span class="nt">&lt;/goal&gt;</span>
</span></span><span class="line"><span class="cl">           <span class="nt">&lt;/goals&gt;</span>
</span></span><span class="line"><span class="cl">       <span class="nt">&lt;/execution&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&lt;/executions&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&lt;configuration&gt;</span>
</span></span><span class="line"><span class="cl">       <span class="nt">&lt;generateGitPropertiesFile&gt;</span>true<span class="nt">&lt;/generateGitPropertiesFile&gt;</span>
</span></span><span class="line"><span class="cl">       <span class="nt">&lt;dateFormat&gt;</span>yyyy-MM-dd HH:mm:ss<span class="nt">&lt;/dateFormat&gt;</span>
</span></span><span class="line"><span class="cl">       <span class="nt">&lt;dateFormatTimeZone&gt;</span>GMT+8<span class="nt">&lt;/dateFormatTimeZone&gt;</span>           <span class="nt">&lt;includeOnlyProperties&gt;</span>git.branch,git.build.time,git.build.version,git.commit.id,git.commit.time,git.commit.message.full<span class="nt">&lt;/includeOnlyProperties&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&lt;/configuration&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/plugin&gt;</span>
</span></span></code></pre></div></blockquote>
<p>ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹ Gradle ç”¨æˆ·å¯ä»¥ä½¿ç”¨å“ªäº›é€‰é¡¹ã€‚</p>
<h3 id="ä½¿ç”¨-gradle-æ’ä»¶-1">ä½¿ç”¨ Gradle æ’ä»¶</h3>
<p>åœ¨ <code>build.gradle</code> ä¸­ï¼Œæˆ‘ä»¬å°†æ·»åŠ  <code>gradle-git-properties</code> æ’ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gradle" data-lang="gradle"><span class="line"><span class="cl"><span class="n">plugins</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">id</span> <span class="s1">&#39;com.gorylenko.gradle-git-properties&#39;</span> <span class="n">version</span> <span class="s1">&#39;2.4.0&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ç°åœ¨è®©æˆ‘ä»¬æ„å»º Gradle é¡¹ç›®ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>build/resources/main/git.properties</code> æ–‡ä»¶å·²åˆ›å»ºã€‚å¹¶ä¸”ï¼Œæ‰§è¡Œå™¨ <code>info</code> ç«¯ç‚¹å°†æ˜¾ç¤ºç›¸åŒçš„æ•°æ®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;git&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;branch&#34;</span><span class="p">:</span> <span class="s2">&#34;main&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;commit&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;5404bdf&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;time&#34;</span><span class="p">:</span> <span class="s2">&#34;2022-03-06T10:34:16Z&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>è¯¥æ’ä»¶ä¹Ÿæä¾›äº†å¤šç§ä½¿ç”¨å±æ€§ <code>gitProperties</code> é…ç½®è¾“å‡ºçš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬é€šè¿‡æ·»åŠ ä»¥ä¸‹å†…å®¹æ¥é™åˆ¶è¦å‡ºç°çš„é”®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gradle" data-lang="gradle"><span class="line"><span class="cl"><span class="n">gitProperties</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">keys</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;git.commit.id&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>é‡æ–°è¿è¡Œåº”ç”¨ç¨‹åºç°åœ¨å°†æ˜¾ç¤ºæœ‰é™çš„ Git ä¿¡æ¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;git&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;commit&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;5404bdf&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="ç»“è®º">ç»“è®º</h2>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•ä½¿ç”¨ Spring Actuator æ¥å…¬å¼€æœ‰å…³æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„ç›¸å…³ä¿¡æ¯ã€‚æˆ‘ä»¬äº†è§£äº†å¦‚ä½•å°†æœ‰å…³æ„å»ºã€ç¯å¢ƒã€Git å’Œ Java ç¯å¢ƒçš„ä¿¡æ¯æ·»åŠ åˆ° Actuator <code>/info</code> ç«¯ç‚¹ã€‚æˆ‘ä»¬è¿˜ç ”ç©¶äº†å¦‚ä½•é€šè¿‡ Maven/Gradle æ„å»ºæ’ä»¶é…ç½®å’Œæ§åˆ¶æ‰€æœ‰è¿™äº›ä¿¡æ¯ã€‚</p>
<p>æ‚¨å¯ä»¥ä½¿ç”¨ GitHub ä¸Šçš„<a href="https://github.com/thombergs/code-examples/tree/master/spring-boot/spring-boot-app-info">ä»£ç </a>æ¥å°è¯•ä¸€ä¸ªå®Œæ•´çš„åº”ç”¨ç¨‹åºæ¥è¯´æ˜è¿™äº›æƒ³æ³•ã€‚</p>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://reflectoring.io/spring-boot-info-endpoint/">https://reflectoring.io/spring-boot-info-endpoint/</a></p>
]]></content:encoded>
    </item>
    
    <item>
      <title>[è¯‘]åœ¨ Spring ä¸­å®ç° OAuth2ï¼šä½¿ç”¨èŒƒå›´ï¼ˆç¬¬ 2 éƒ¨åˆ†ï¼‰</title>
      <link>https://blog.chensoul.com/posts/2023/07/26/using-oauth2-in-spring-scopes/</link>
      <pubDate>Wed, 26 Jul 2023 07:05:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/07/26/using-oauth2-in-spring-scopes/</guid>
      <description>æˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­äº†è§£äº†åŸºæœ¬çš„ OAuth2 æ¦‚å¿µä»¥åŠå¦‚ä½•åœ¨ Spring ä¸­å®ç°å’Œæ‰§è¡Œä¸åŒçš„æˆæƒã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç» OAuth2 çš„å¦ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼šèŒƒå›´ã€‚ OAuth èŒƒå›´ ä¿æŠ¤å¯¹åº”ç”¨ç¨‹</description>
      <content:encoded><![CDATA[<p>æˆ‘ä»¬åœ¨<a href="/posts/2023/07/26/using-oauth2-in-spring/">ä¸Šä¸€ç¯‡æ–‡ç« </a>ä¸­äº†è§£äº†åŸºæœ¬çš„ OAuth2 æ¦‚å¿µä»¥åŠå¦‚ä½•åœ¨ Spring ä¸­å®ç°å’Œæ‰§è¡Œä¸åŒçš„æˆæƒã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç» OAuth2 çš„å¦ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼šèŒƒå›´ã€‚</p>
<h2 id="oauth-èŒƒå›´">OAuth èŒƒå›´</h2>
<p>ä¿æŠ¤å¯¹åº”ç”¨ç¨‹åºçš„è®¿é—®é€šå¸¸åˆ†ä¸¤ä¸ªæ­¥éª¤è¿›è¡Œï¼šèº«ä»½éªŒè¯å’Œæˆæƒã€‚è¦ç†è§£è¿™ä¸¤ä¸ªæ¦‚å¿µï¼Œå‡è®¾æ‚¨åœ¨ç»å¯†æ”¿åºœå¤§æ¥¼å·¥ä½œã€‚åœ¨å¼€å§‹ä¹‹å‰ï¼Œä½ ä¼šå¾—åˆ°ä¸€å¼ å¡ç‰‡ï¼Œå¯ä»¥è®©ä½ è¿›å…¥å»ºç­‘ç‰©ã€‚ OAuth ä»¤ç‰Œå¯ä»¥çœ‹ä½œæ˜¯å…è®¸æ‚¨è®¿é—®çš„å¡ç‰‡ã€‚</p>
<p>ä¸€æ—¦ä½ è¿›å»ï¼Œä½ å†³å®šå»ä¸‰æ¥¼è§ä½ çš„ä¸€ä½åŒäº‹ï¼Œåœ¨å°è¯•ä½¿ç”¨ä½ çš„å¡æ‰“å¼€ä¸‰æ¥¼çš„é—¨åï¼Œä½ å¬åˆ°ä¸€å£°å˜Ÿå˜Ÿå£°ï¼Œå‘Šè¯‰ä½ ä½ æ²¡æœ‰è¢«æˆæƒã€‚åœ¨ OAuth ä¸­ï¼ŒèŒƒå›´æ˜¯ä¸€ç§å®šä¹‰ä»¤ç‰Œå¯ä»¥è®¿é—®å“ªäº›èµ„æºä»¥åŠä¸èƒ½è®¿é—®å“ªäº›èµ„æºçš„æ–¹æ³•ã€‚èŒƒå›´å…è®¸è®¿é—®æ§åˆ¶ï¼Œå¹¶ä¸”å¯ä»¥è¢«è§†ä¸ºç›¸å½“äºä¼ ç»Ÿèº«ä»½éªŒè¯ä¸­çš„ç”¨æˆ·è§’è‰²ã€‚</p>
<h2 id="å®ç°">å®ç°</h2>
<p>ä¸ºäº†æ¼”ç¤ºèŒƒå›´ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ç¬¬ 1 éƒ¨åˆ†ä¸­çš„<a href="https://github.com/zak905/oauth2-example">ç¤ºä¾‹</a>ã€‚</p>
<p>åœ¨<a href="https://github.com/zak905/oauth2-example/blob/master/resource-server/src/main/java/com/gwidgets/examples/resourceserver/ResourceController.java">èµ„æºæœåŠ¡å™¨</a>çš„æ§åˆ¶å™¨ä¸­ï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹ç«¯ç‚¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="o">(</span><span class="s">&#34;/&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ResourceController</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/hello&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;hello&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/foo&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">foo</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;foo&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">&#34;/bar&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">bar</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;bar&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@DeleteMapping</span><span class="o">(</span><span class="s">&#34;/test&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">test</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;test&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ç¬¬ä¸€æ­¥æ˜¯ä½¿ç”¨æ‰€éœ€çš„èŒƒå›´é…ç½®<a href="https://github.com/zak905/oauth2-example/blob/master/authorization-server/src/main/java/com/gwidgets/examples/authorizationserver/AuthorizationSecurityConfig.java#L34">æˆæƒæœåŠ¡å™¨</a>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"> <span class="n">clients</span><span class="o">.</span><span class="na">inMemory</span><span class="o">().</span><span class="na">withClient</span><span class="o">(</span><span class="s">&#34;my-trusted-client&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">authorizedGrantTypes</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                        <span class="s">&#34;refresh_token&#34;</span><span class="o">,</span> <span class="s">&#34;implicit&#34;</span><span class="o">,</span> <span class="s">&#34;client_credentials&#34;</span><span class="o">,</span> <span class="s">&#34;authorization_code&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">authorities</span><span class="o">(</span><span class="s">&#34;CLIENT&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">scopes</span><span class="o">(</span><span class="s">&#34;read&#34;</span><span class="o">,</span> <span class="s">&#34;write&#34;</span><span class="o">,</span> <span class="s">&#34;trust&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">accessTokenValiditySeconds</span><span class="o">(</span><span class="n">60</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">redirectUris</span><span class="o">(</span><span class="s">&#34;http://localhost:8081/test.html&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">resourceIds</span><span class="o">(</span><span class="s">&#34;resource&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">secret</span><span class="o">(</span><span class="s">&#34;mysecret&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"> 
</span></span></code></pre></div><p>è¦åœ¨èµ„æºæœåŠ¡å™¨ä¸­å¯ç”¨èŒƒå›´æ£€æŸ¥ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªé€‰é¡¹ï¼šä½¿ç”¨å®‰å…¨é…ç½®æˆ–ä½¿ç”¨æ–¹æ³•å®‰å…¨æ€§ã€‚</p>
<ul>
<li>ä½¿ç”¨å®‰å…¨é…ç½®ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">	<span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">http</span>
</span></span><span class="line"><span class="cl">			<span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">			 <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="n">HttpMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span><span class="s">&#34;/hello&#34;</span><span class="o">).</span><span class="na">access</span><span class="o">(</span><span class="s">&#34;#oauth2.hasScope(&#39;read&#39;)&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">			 <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="n">HttpMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span><span class="s">&#34;/foo&#34;</span><span class="o">).</span><span class="na">access</span><span class="o">(</span><span class="s">&#34;#oauth2.hasScope(&#39;read&#39;)&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">			 <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="n">HttpMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">,</span><span class="s">&#34;/bar&#34;</span><span class="o">).</span><span class="na">access</span><span class="o">(</span><span class="s">&#34;#oauth2.hasScope(&#39;write&#39;)&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">			 <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="n">HttpMethod</span><span class="o">.</span><span class="na">DELETE</span><span class="o">,</span><span class="s">&#34;/test&#34;</span><span class="o">).</span><span class="na">access</span><span class="o">(</span><span class="s">&#34;#oauth2.hasScope(&#39;trust&#39;)&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">			<span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">().</span>
</span></span><span class="line"><span class="cl">			 <span class="n">and</span><span class="o">().</span><span class="na">csrf</span><span class="o">().</span><span class="na">disable</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span></code></pre></div><ul>
<li>ä½¿ç”¨æ–¹æ³•å®‰å…¨æ€§ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">    <span class="nd">@PreAuthorize</span><span class="o">(</span><span class="s">&#34;#oauth2.hasScope(&#39;read&#39;)&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/hello&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;hello&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@PreAuthorize</span><span class="o">(</span><span class="s">&#34;#oauth2.hasScope(&#39;read&#39;)&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/foo&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">foo</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;foo&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@PreAuthorize</span><span class="o">(</span><span class="s">&#34;#oauth2.hasScope(&#39;write&#39;)&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">&#34;/bar&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">bar</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;bar&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@PreAuthorize</span><span class="o">(</span><span class="s">&#34;#oauth2.hasScope(&#39;trust&#39;)&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@DeleteMapping</span><span class="o">(</span><span class="s">&#34;/test&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">test</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;test&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span></code></pre></div><p>å¦å¤–ï¼Œæˆ‘ä»¬éœ€è¦å°† <code>@EnableGlobalMethodSecurity(prePostEnabled = true)</code> æ·»åŠ åˆ° Spring å¯ä»¥è·å–çš„ä»»ä½•ç±»ï¼ˆ <code>@Configuration</code> ã€ <code>@Service</code> ç­‰ï¼‰ã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å·²å°†å…¶æ·»åŠ åˆ° <a href="https://github.com/zak905/oauth2-example/blob/master/resource-server/src/main/java/com/gwidgets/examples/resourceserver/ResourceSecurityConfiguration.java#L18">ResourceSecurityConfiguration</a> ç±»ä¸­ã€‚ <code>prePostEnabled = true</code> å‘Šè¯‰ Spring å¯ç”¨å‰æ³¨è§£å’Œåæ³¨è§£ï¼Œä¾‹å¦‚ <code>@PreAuthorize</code> ã€ <code>@PostFilter</code> ç­‰&hellip;&hellip;</p>
<p>å¯¹äºé‚£äº›æƒ³äº†è§£ <code>#oauth2.hasScope('trust')</code> è¿™æ ·çš„è¡¨è¾¾å¼çš„äººæ¥è¯´ï¼Œå®ƒä»¬æ˜¯ä½¿ç”¨ <a href="https://docs.spring.io/spring/docs/4.3.12.RELEASE/spring-framework-reference/html/expressions.html">Spring è¡¨è¾¾å¼è¯­è¨€</a>ï¼ˆSpELï¼‰æ„å»ºçš„ã€‚</p>
<h2 id="è¡ŒåŠ¨èŒƒå›´">è¡ŒåŠ¨èŒƒå›´</h2>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä»¤ç‰Œè¯·æ±‚ä¸­ä¸å­˜åœ¨èŒƒå›´ï¼ŒSpring ä¼šå‡å®šä»¤ç‰Œå…·æœ‰æ‰€æœ‰é…ç½®çš„èŒƒå›´ã€‚è®©æˆ‘ä»¬é¦–å…ˆè¯·æ±‚ä¸€ä¸ªå…·æœ‰ <code>read</code> èŒƒå›´çš„ä»¤ç‰Œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -X POST --user my-trusted-client:mysecret localhost:8081/oauth/token -d <span class="s1">&#39;grant_type=client_credentials&amp;client_id=my-trusted-client&amp;scope=read&#39;</span> -H <span class="s2">&#34;Accept: application/json&#34;</span>
</span></span></code></pre></div><p>å›å¤ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;access_token&#34;</span><span class="p">:</span> <span class="s2">&#34;acadbb31-f126-411d-ae5b-6a278cee2ed6&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;token_type&#34;</span><span class="p">:</span> <span class="s2">&#34;bearer&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;expires_in&#34;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;scope&#34;</span><span class="p">:</span> <span class="s2">&#34;read&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span></code></pre></div><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¤ç‰Œæ¥è®¿é—®å…·æœ‰ <code>read</code> èŒƒå›´è®¿é—®æƒé™çš„ç«¯ç‚¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"> curl -XGET localhost:8989/hello -H <span class="s2">&#34;Authorization: Bearer acadbb31-f126-411d-ae5b-6a278cee2ed6&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> hello
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">curl -XGET localhost:8989/foo -H <span class="s2">&#34;Authorization: Bearer acadbb31-f126-411d-ae5b-6a278cee2ed6&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> foo
</span></span></code></pre></div><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°è¯•åœ¨ä»…æ¥å— <code>write</code> èŒƒå›´çš„ç«¯ç‚¹ä¸Šä½¿ç”¨æ­¤ä»¤ç‰Œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -XPOST localhost:8989/bar -H <span class="s2">&#34;Authorization: Bearer acadbb31-f126-411d-ae5b-6a278cee2ed6&#34;</span>
</span></span></code></pre></div><p>å›å¤ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;error&#34;</span><span class="p">:</span> <span class="s2">&#34;access_denied&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;error_description&#34;</span><span class="p">:</span> <span class="s2">&#34;Access is denied&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>ç”±äºä»¤ç‰Œä¸å…·æœ‰æ‰€éœ€çš„èŒƒå›´ï¼Œå› æ­¤è®¿é—®è¢«æ‹’ç»ã€‚è®©æˆ‘ä»¬å°è¯•è·å–ä¸€ä¸ªå…·æœ‰ <code>write</code> èŒƒå›´çš„æ–°ä»¤ç‰Œï¼Œç„¶åé‡è¯•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -X POST --user my-trusted-client:mysecret localhost:8081/oauth/token -d <span class="s1">&#39;grant_type=client_credentials&amp;client_id=my-trusted-client&amp;scope=write&#39;</span> -H <span class="s2">&#34;Accept: application/json&#34;</span>
</span></span></code></pre></div><p>å›å¤ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;access_token&#34;</span><span class="p">:</span> <span class="s2">&#34;bf0fa83a-23bd-4633-ac6c-a06f40d53e5f&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;token_type&#34;</span><span class="p">:</span> <span class="s2">&#34;bearer&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;expires_in&#34;</span><span class="p">:</span> <span class="mi">3599</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;scope&#34;</span><span class="p">:</span> <span class="s2">&#34;write&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -XPOST localhost:8989/bar -H <span class="s2">&#34;Authorization: Bearer bf0fa83a-23bd-4633-ac6c-a06f40d53e5f&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">bar
</span></span></code></pre></div><h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>èŒƒå›´æ˜¯ OAuth çš„ä¸€ä¸ªé‡è¦æ–¹é¢ï¼Œå› ä¸ºä»¤ç‰Œä¸æºå¸¦æœ‰å…³å…¶ç”¨æˆ·æˆ–è¯·æ±‚è€…çš„ä¿¡æ¯ã€‚èŒƒå›´å…è®¸é™åˆ¶å¯¹èµ„æºçš„è®¿é—®ï¼Œä»¥å®ç°æ›´å¥½çš„è®¿é—®æ§åˆ¶å’Œå®‰å…¨æ€§ã€‚åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•å°† Google å’Œ Facebook ç­‰å¤–éƒ¨ OAuth æä¾›å•†é›†æˆåˆ°æµç¨‹ä¸­ã€‚</p>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="http://www.zakariaamine.com/2018-03-01/using-oauth2-in-spring-scopes/">http://www.zakariaamine.com/2018-03-01/using-oauth2-in-spring-scopes/</a></p>
]]></content:encoded>
    </item>
    
    <item>
      <title>[è¯‘]åœ¨ Spring ä¸­å®ç° OAuth2ï¼šç¬¬ 1 éƒ¨åˆ†</title>
      <link>https://blog.chensoul.com/posts/2023/07/26/using-oauth2-in-spring/</link>
      <pubDate>Wed, 26 Jul 2023 07:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/07/26/using-oauth2-in-spring/</guid>
      <description>OAuth2 æ˜¯ä¸€ç»„è§„èŒƒï¼Œä¸»è¦æä¾›å¯¹ Rest API çš„å®‰å…¨è®¿é—®çš„æ–¹æ³•ã€‚ OAuth çš„ä¸»è¦ç›®çš„æ˜¯å…è®¸é€šè¿‡ä½¿ç”¨ä»¤ç‰Œæ¥æ‰§è¡Œèº«ä»½éªŒè¯å’Œæˆæƒï¼Œè€Œä¸å¿…ä¸ºæ¯ä¸ªæ“ä½œæä¾›å‡­æ®ã€‚ç”±äºæœ¬æ–‡çš„é‡ç‚¹æ˜¯</description>
      <content:encoded><![CDATA[<p>OAuth2 æ˜¯ä¸€ç»„è§„èŒƒï¼Œä¸»è¦æä¾›å¯¹ Rest API çš„å®‰å…¨è®¿é—®çš„æ–¹æ³•ã€‚ OAuth çš„ä¸»è¦ç›®çš„æ˜¯å…è®¸é€šè¿‡ä½¿ç”¨ä»¤ç‰Œæ¥æ‰§è¡Œèº«ä»½éªŒè¯å’Œæˆæƒï¼Œè€Œä¸å¿…ä¸ºæ¯ä¸ªæ“ä½œæä¾›å‡­æ®ã€‚ç”±äºæœ¬æ–‡çš„é‡ç‚¹æ˜¯å®ç°ï¼Œå¹¶ä¸”ä¸ºäº†ä¸é‡æ–°å‘æ˜è½®å­ï¼Œå¯ä»¥æŸ¥çœ‹ <a href="https://tools.ietf.org/html/rfc6749">OAuth RFC</a> æˆ–<a href="https://en.wikipedia.org/wiki/OAuth">ç»´åŸºç™¾ç§‘</a>ä»¥è·å–æ›´å¤šç†è®ºèƒŒæ™¯ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ Spring ä¸­çš„ OAuth2 å®ç°ä»¥åŠå¦‚ä½•ä½¿ç”¨ä¸åŒçš„æˆæƒç±»å‹ï¼Œä½†åœ¨æ­¤ä¹‹å‰å€¼å¾—æä¾›ä¸€äº›é‡è¦æ¦‚å¿µçš„ç®€è¦å®šä¹‰ã€‚</p>
<h2 id="è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œ"><strong>è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œ</strong></h2>
<p>èº«ä»½éªŒè¯æˆåŠŸåå°†æä¾›è®¿é—®ä»¤ç‰Œä»¥åŠåˆ·æ–°ä»¤ç‰Œã€‚è®¿é—®ä»¤ç‰Œæœ‰ä¸€ä¸ªæœ‰é™çš„æœ‰æ•ˆæœŸï¼ˆæ ‡å‡†ä¸º 1 å°æ—¶ï¼‰ï¼Œä¹‹åéœ€è¦åˆ·æ–°ä»¤ç‰Œæ‰èƒ½è·å–æ–°çš„è®¿é—®ä»¤ç‰Œå’Œæ–°çš„åˆ·æ–°ä»¤ç‰Œã€‚ Referesh ä»¤ç‰Œé€šå¸¸ä¼šåœ¨ä½¿ç”¨åè¿‡æœŸã€‚</p>
<h2 id="èµ„æºæœåŠ¡å™¨å’ŒæˆæƒæœåŠ¡å™¨">èµ„æºæœåŠ¡å™¨å’ŒæˆæƒæœåŠ¡å™¨</h2>
<p>OAuth å¼•å…¥äº†æˆæƒæœåŠ¡å™¨çš„æ¦‚å¿µï¼ŒæˆæƒæœåŠ¡å™¨æ˜¯å‘å‡ºè®¿é—®å’Œåˆ·æ–°ä»¤ç‰Œçš„å®ä½“ï¼Œå¹¶åœ¨æ¯ä¸ªæ“ä½œä¸­è¿›è¡Œå’¨è¯¢ä»¥æŸ¥çœ‹ä»¤ç‰Œæ˜¯å¦æœ‰æ•ˆã€‚èµ„æºæœåŠ¡å™¨åªæ˜¯ç”±ä¸åŒå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºï¼ˆå‰ç«¯åº”ç”¨ç¨‹åºã€ç§»åŠ¨è®¾å¤‡ã€å…¶ä»–åç«¯æœåŠ¡&hellip;&hellip;ï¼‰è®¿é—®çš„å®é™… Rest APIã€‚èµ„æºæœåŠ¡å™¨å’ŒæˆæƒæœåŠ¡å™¨å¯ä»¥æ˜¯ä¸åŒçš„å®ä½“ï¼Œä¹Ÿå¯ä»¥æ˜¯åŒä¸€å®ä½“ã€‚</p>
<h2 id="æˆæƒç±»å‹">æˆæƒç±»å‹</h2>
<p>OAuth ä¸­æœ€å¸¸ç”¨çš„æˆæƒæœ‰ï¼šå®¢æˆ·ç«¯å‡­æ®ã€å¯†ç ã€æˆæƒç å’Œéšå¼æˆæƒã€‚æ¯é¡¹èµ„åŠ©éƒ½æœ‰ç‰¹å®šçš„æµç¨‹å’Œç”¨ä¾‹ï¼Œä½†ç”±äºæœ¬æ–‡çš„é‡ç‚¹ä¸æ˜¯ç†è®ºï¼Œå› æ­¤æˆ‘ä»¬å°†é‡ç‚¹å…³æ³¨å…¶å®æ–½ã€‚æœ‰å…³æˆæƒåŠå…¶ç”¨é€”çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a href="https://tools.ietf.org/html/rfc6749#page-8">OAuth RFC</a>ã€‚</p>
<h2 id="å®ç°">å®ç°</h2>
<p>åœ¨å®ç°æ–¹é¢ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Spring Boot æ¥åˆ©ç”¨å…¶è‡ªåŠ¨é…ç½®å’Œå¼•å¯¼åŠŸèƒ½ï¼Œå¹¶æ›´å¤šåœ°å…³æ³¨æˆ‘ä»¬çš„æ ¸å¿ƒä¸»é¢˜ã€‚</p>
<ul>
<li>èµ„æºæœåŠ¡å™¨ï¼š</li>
</ul>
<p>æˆ‘ä»¬æœ‰ä¸€ä¸ªèµ„æºæœåŠ¡å™¨ï¼Œå…¶ä¸­åŒ…å«æˆ‘ä»¬å¸Œæœ›ä¿æŠ¤çš„ä»¥ä¸‹ç«¯ç‚¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span><span class="o">(</span><span class="s">&#34;/&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ResourceController</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/hello&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;hello&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/foo&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">foo</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;foo&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/bar&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">bar</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;bar&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&#34;/test&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">test</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;test&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®ä¸€ä¸ªç”¨ <code>@EnableResourceServer</code> æ³¨é‡Šçš„ <code>ResourceServerConfigurerAdapter</code> beanï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span>
</span></span><span class="line"><span class="cl"><span class="nd">@EnableResourceServer</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ResourceSecurityConfiguration</span> <span class="kd">extends</span> <span class="n">ResourceServerConfigurerAdapter</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">ResourceServerSecurityConfigurer</span> <span class="n">resources</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">resources</span><span class="o">.</span><span class="na">resourceId</span><span class="o">(</span><span class="s">&#34;resource&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">http</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">().</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">&#34;/foo&#34;</span><span class="o">,</span> <span class="s">&#34;/bar&#34;</span><span class="o">,</span> <span class="s">&#34;/hello&#34;</span><span class="o">,</span> <span class="s">&#34;/test&#34;</span><span class="o">).</span><span class="na">authenticated</span><span class="o">().</span>
</span></span><span class="line"><span class="cl">                <span class="n">and</span><span class="o">().</span><span class="na">csrf</span><span class="o">().</span><span class="na">disable</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">RemoteTokenServices</span> <span class="nf">LocalTokenService</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">final</span> <span class="n">RemoteTokenServices</span> <span class="n">tokenService</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RemoteTokenServices</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">tokenService</span><span class="o">.</span><span class="na">setCheckTokenEndpointUrl</span><span class="o">(</span><span class="s">&#34;http://localhost:8081/oauth/check_token&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">tokenService</span><span class="o">.</span><span class="na">setClientId</span><span class="o">(</span><span class="s">&#34;my-client&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">tokenService</span><span class="o">.</span><span class="na">setClientSecret</span><span class="o">(</span><span class="s">&#34;mysecret&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">tokenService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æˆ‘ä»¬å·²ç»å‘Šè¯‰ spring æ£€æŸ¥ç«¯ç‚¹çš„èº«ä»½éªŒè¯ï¼ˆå¯ä»¥ä½¿ç”¨ <code>&quot;/*&quot;</code> æˆ– <code>.anyRequest()</code> æ¥è¡¨ç¤ºæ‰€æœ‰ç«¯ç‚¹ï¼‰ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜é…ç½®äº†ä¸€ä¸ª <code>RemoteTokenServices</code> bean æ¥å‘Šè¯‰ Spring æä¾›ä»¤ç‰Œæ£€æŸ¥ç«¯ç‚¹ï¼ˆæˆæƒæœåŠ¡å™¨ï¼‰ï¼Œå¹¶é…ç½®äº†å®¢æˆ·ç«¯ id å’Œå¯†é’¥ã€‚è¿™æ ·æˆ‘ä»¬çš„èµ„æºæœåŠ¡å™¨å°±é…ç½®å¥½äº†ã€‚æœ€åï¼Œæˆ‘ä»¬è®¾ç½®äº†èµ„æº idï¼Œå¦‚æœå¤šä¸ªèµ„æºæœåŠ¡å™¨ä½¿ç”¨è¯¥èµ„æºï¼ˆè¿™å¾ˆå¸¸è§ï¼‰ï¼Œåˆ™è¯¥èµ„æº id å¯ä»¥åœ¨æˆæƒæœåŠ¡å™¨ä¸­ç”¨ä½œæ ‡è¯†ã€‚</p>
<ul>
<li>æˆæƒæœåŠ¡å™¨ï¼š</li>
</ul>
<p>ä¸ºäº†å®ç°æˆæƒæœåŠ¡å™¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å†…å­˜å®¢æˆ·ç«¯é…ç½®ã€‚ Spring Security è¿˜æä¾›äº†å°† oauth å®¢æˆ·ç«¯é…ç½®å­˜å‚¨åœ¨æ›´é€‚åˆç”Ÿäº§åº”ç”¨ç¨‹åºçš„æ•°æ®åº“ä¸­çš„å¯èƒ½æ€§ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span>
</span></span><span class="line"><span class="cl"><span class="nd">@EnableAuthorizationServer</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AuthorizationSecurityConfig</span> <span class="kd">extends</span> <span class="n">AuthorizationServerConfigurerAdapter</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Autowired</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">AuthenticationManager</span> <span class="n">authenticationManager</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">AuthorizationServerEndpointsConfigurer</span> <span class="n">endpoints</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">endpoints</span><span class="o">.</span><span class="na">authenticationManager</span><span class="o">(</span><span class="n">authenticationManager</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">ClientDetailsServiceConfigurer</span> <span class="n">clients</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">clients</span><span class="o">.</span><span class="na">inMemory</span><span class="o">().</span><span class="na">withClient</span><span class="o">(</span><span class="s">&#34;my-trusted-client&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">authorizedGrantTypes</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                        <span class="s">&#34;refresh_token&#34;</span><span class="o">,</span> <span class="s">&#34;implicit&#34;</span><span class="o">,</span> <span class="s">&#34;client_credentials&#34;</span><span class="o">,</span> <span class="s">&#34;authorization_code&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">authorities</span><span class="o">(</span><span class="s">&#34;ROLE_CLIENT&#34;</span><span class="o">,</span> <span class="s">&#34;ROLE_TRUSTED_CLIENT&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">scopes</span><span class="o">(</span><span class="s">&#34;read&#34;</span><span class="o">,</span> <span class="s">&#34;write&#34;</span><span class="o">,</span> <span class="s">&#34;trust&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">accessTokenValiditySeconds</span><span class="o">(</span><span class="n">60</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">redirectUris</span><span class="o">(</span><span class="s">&#34;http://localhost:8081/test.html&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">resourceIds</span><span class="o">(</span><span class="s">&#34;resource&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">secret</span><span class="o">(</span><span class="s">&#34;mysecret&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">AuthorizationServerSecurityConfigurer</span> <span class="n">oauthServer</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                 <span class="n">oauthServer</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">tokenKeyAccess</span><span class="o">(</span><span class="s">&#34;permitAll()&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">checkTokenAccess</span><span class="o">(</span><span class="s">&#34;permitAll()&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>é™¤äº†æˆ‘ä»¬åœ¨å…¶ä¸­é…ç½®å®¢æˆ·ç«¯ã€å¯†é’¥ã€oauth èŒƒå›´ï¼ˆä¸‹ä¸€ç¯‡æ–‡ç« ä¸­å°†è¯¦ç»†ä»‹ç»ï¼‰ã€æƒé™ï¼ˆä¸ä»¤ç‰Œå…³è”çš„è§’è‰²ï¼‰ã€ä»¤ç‰Œæœ‰æ•ˆæ€§ã€èµ„æº id ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜é…ç½®äº†å¯¹ Spring Boot åœ¨ <code>/oauth/check_token</code> å¤„æä¾›çš„æ£€æŸ¥ä»¤ç‰Œç«¯ç‚¹çš„è®¿é—®ï¼Œä»¥åŠå¯¹ä¹Ÿè‡ªåŠ¨æ˜ å°„åœ¨ <code>/oauth/token</code> å¤„çš„ä»¤ç‰Œå‘è¡Œç«¯ç‚¹çš„è®¿é—®ã€‚</p>
<h2 id="oauth-çš„å®é™…åº”ç”¨">OAuth çš„å®é™…åº”ç”¨</h2>
<p>æˆ‘ä»¬å·²å°†æˆæƒæœåŠ¡å™¨é…ç½®ä¸ºåœ¨ç«¯å£ 8081 ä¸Šè¿è¡Œï¼Œå°†èµ„æºæœåŠ¡å™¨é…ç½®ä¸ºåœ¨ç«¯å£ 8989 ä¸Šè¿è¡Œã€‚å¯¹äºä¸‹é¢çš„æ‰€æœ‰ç¤ºä¾‹ï¼Œéƒ½ä½¿ç”¨ <code>curl</code> ï¼Œä½†å®¢æˆ·ç«¯å¯ä»¥æ˜¯ä»»ä½•åº”ç”¨ç¨‹åºã€‚</p>
<p>æˆ‘ä»¬é¦–å…ˆå°è¯•è®¿é—®èµ„æºæœåŠ¡å™¨ä¸­çš„ä¸€ä¸ªç«¯ç‚¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl localhost:8989/foo
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;error&#34;</span><span class="p">:</span> <span class="s2">&#34;unauthorized&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;error_description&#34;</span><span class="p">:</span> <span class="s2">&#34;Full authentication is required to access this resource&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>è®©æˆ‘ä»¬è·å–ä¸€ä¸ªä»¤ç‰Œå¹¶é‡è¯•ã€‚</p>
<ul>
<li>å®¢æˆ·å‡­è¯æˆäºˆï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -X POST --user my-trusted-client:mysecret localhost:8081/oauth/token -d <span class="s1">&#39;grant_type=client_credentials&amp;client_id=my-trusted-client&#39;</span> -H <span class="s2">&#34;Accept: application/json&#34;</span>
</span></span></code></pre></div><p>å›å¤ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;access_token&#34;</span><span class="p">:</span> <span class="s2">&#34;3670fea1-eab3-4981-b80a-e5c57203b20e&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;token_type&#34;</span><span class="p">:</span> <span class="s2">&#34;bearer&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;expires_in&#34;</span><span class="p">:</span> <span class="mi">51</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;scope&#34;</span><span class="p">:</span> <span class="s2">&#34;read write trust&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>æˆ‘ä»¬ç°åœ¨å¯ä»¥ä½¿ç”¨ä»¤ç‰Œæ¥è®¿é—®å—ä¿æŠ¤çš„ç«¯ç‚¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -v localhost:8989/foo -H <span class="s2">&#34;Authorization: Bearer 6bb86f18-e69e-4c2b-8fbf-85d7d5b800a4&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">foo
</span></span></code></pre></div><p>å®¢æˆ·ç«¯å‡­æ®æˆäºˆä¸æ”¯æŒåˆ·æ–°ä»¤ç‰Œã€‚</p>
<ul>
<li>å¯†ç æˆäºˆï¼š</li>
</ul>
<p>å°±è·å–ä»¤ç‰Œçš„æµç¨‹è€Œè¨€ï¼Œå¯†ç æˆäºˆä¸å®¢æˆ·ç«¯å‡­æ®ç±»ä¼¼ï¼Œåªæ˜¯å®ƒä½¿ç”¨å®é™…çš„ç”¨æˆ·å‡­æ®ã€‚å®ƒè¿˜æ„å‘³ç€éœ€è¦ä¸ºåº”ç”¨ç¨‹åºé…ç½®ç”¨æˆ·ã€‚ Webå®‰å…¨é…ç½®å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span>
</span></span><span class="line"><span class="cl"><span class="nd">@EnableWebSecurity</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebSecurity</span> <span class="kd">extends</span> <span class="n">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">	<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">AuthenticationManagerBuilder</span> <span class="n">auth</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">auth</span><span class="o">.</span><span class="na">inMemoryAuthentication</span><span class="o">().</span><span class="na">withUser</span><span class="o">(</span><span class="s">&#34;gwidgets&#34;</span><span class="o">).</span><span class="na">password</span><span class="o">(</span><span class="s">&#34;gwidgets&#34;</span><span class="o">).</span><span class="na">authorities</span><span class="o">(</span><span class="s">&#34;CLIENT&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">	 
</span></span><span class="line"><span class="cl">	<span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">	<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		 <span class="n">http</span><span class="o">.</span><span class="na">authorizeRequests</span><span class="o">().</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">authenticated</span><span class="o">().</span><span class="na">and</span><span class="o">().</span><span class="na">formLogin</span><span class="o">().</span><span class="na">defaultSuccessUrl</span><span class="o">(</span><span class="s">&#34;/test.html&#34;</span><span class="o">).</span><span class="na">and</span><span class="o">().</span><span class="na">csrf</span><span class="o">().</span><span class="na">disable</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç”¨æˆ·å‡­æ®æ¥è·å–ä»¤ç‰Œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -X POST --user my-trusted-client:mysecret localhost:8081/oauth/token -d <span class="s1">&#39;grant_type=password&amp;username=gwidgets&amp;password=gwidgets&#39;</span> -H <span class="s2">&#34;Accept: application/json&#34;</span>
</span></span></code></pre></div><p>å›å¤ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;access_token&#34;</span><span class="p">:</span> <span class="s2">&#34;3670fea1-eab3-4981-b80a-e5c57203b20e&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;token_type&#34;</span><span class="p">:</span> <span class="s2">&#34;bearer&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;expires_in&#34;</span><span class="p">:</span> <span class="mi">51</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;scope&#34;</span><span class="p">:</span> <span class="s2">&#34;read write trust&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>å¯†ç æˆäºˆä¸æ”¯æŒåˆ·æ–°ä»¤ç‰Œã€‚</p>
<ul>
<li>éšå¼æˆäºˆï¼š</li>
</ul>
<p>éšå¼æˆæƒæœ€é€‚åˆå‰ç«¯è·¯ç”±åº”ç”¨ç¨‹åºã€‚éšå¼æˆæƒéœ€è¦åŸºæœ¬èº«ä»½éªŒè¯å’Œ HTTP ä¼šè¯ã€‚ä¸ºäº†æ‰§è¡Œéšå¼æˆæƒï¼Œæˆ‘ä»¬å°†å‘æˆæƒæœåŠ¡å™¨æ·»åŠ ä¸€ä¸ªç®€å•çš„ http é¡µé¢ï¼ˆå®ƒå¯ä»¥ä½äºä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Title<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>we are here<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>è¦æ‰§è¡Œéšå¼æˆäºˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨æµè§ˆå™¨ä¸­å¯¼èˆªåˆ°ä»¥ä¸‹åœ°å€ï¼šhttp://localhost:8081/oauth/authorize?response_type=token&amp;client_id=my-trusted-client&amp;redirect-uri=http://localhost:8081/test.html</p>
<p><img loading="lazy" src="https://s3-eu-west-1.amazonaws.com/gwidgets/login-spring.png" alt="Login redirect"  />
</p>
<p>ç™»å½•åï¼Œæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªOAuthå®¡æ‰¹é¡µé¢ï¼ˆspringé»˜è®¤æä¾›ï¼Œä½†å¯ä»¥è‡ªå®šä¹‰ï¼‰ï¼š</p>
<p><img loading="lazy" src="https://s3-eu-west-1.amazonaws.com/gwidgets/oauth-approval.png" alt="OAuth approval"  />

æ‰¹å‡†ä»¤ç‰Œçš„èŒƒå›´åï¼Œæˆ‘ä»¬æœ€ç»ˆä¼šé‡å®šå‘åˆ°æˆ‘ä»¬çš„é¡µé¢ï¼Œåœ¨è¯¥é¡µé¢ä¸­æˆ‘ä»¬åœ¨ url çš„å“ˆå¸Œä¸­æ‰¾åˆ°ä»¤ç‰Œï¼š</p>
<p><img loading="lazy" src="https://s3-eu-west-1.amazonaws.com/gwidgets/implicit_grant.png" alt="Implicit grant"  />
</p>
<ul>
<li>æˆæƒç æˆäºˆï¼š</li>
</ul>
<p>å¯¹äºæˆæƒç æˆäºˆï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆä»¥ä¸éšå¼æµç¨‹ç›¸åŒçš„æ–¹å¼è¿›è¡Œæˆæƒï¼Œåªä¸è¿‡ <code>response_type</code> ç°åœ¨æ˜¯ <code>code</code> ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦å¯¼èˆªåˆ°ï¼š<a href="http://localhost:8081/oauth/authorize?response_type=code&amp;client_id=my-trusted-client&amp;redirect-uri=http://localhost:8081/test.html">http://localhost:8081/oauth/authorize?response_type=code&amp;client_id=my-trusted-client&amp;redirect-uri=http://localhost:8081/test.html</a></p>
<p>ç„¶åæˆ‘ä»¬è¢«é‡å®šå‘åˆ°ç™»å½•ï¼Œç™»å½•åï¼Œæˆ‘ä»¬è¢«é‡å®šå‘åˆ° OAuth èŒƒå›´æ‰¹å‡†ï¼Œå¦‚ä¸Šä¸€èŠ‚ä¸­çš„éšå¼æµç¨‹ã€‚ä¹‹åï¼Œæˆ‘ä»¬è¢«é‡å®šå‘åˆ°ä»¥ä¸‹åœ°å€ï¼š<a href="http://localhost:8081/test.html?code=bD0mVb">http://localhost:8081/test.html?code=bD0mVb</a>ï¼Œè¿™æ˜¯æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„æ¬¢è¿é¡µé¢ï¼Œä½†å¸¦æœ‰ä¸€ä¸ªç‰¹æ®Šçš„æŸ¥è¯¢å‚æ•°ï¼š <code>code</code> ã€‚æˆ‘ä»¬å°†ä½¿ç”¨curl æ¥è·å–ä»¤ç‰Œä»¥è¿›è¡Œæ¼”ç¤ºï¼Œä½†ä¹Ÿå¯ä»¥ä½¿ç”¨JavaScript åœ¨é¡µé¢ä¸­å®Œæˆæ­¤æ“ä½œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -X POST --user my-trusted-client:mysecret localhost:8081/oauth/token -d <span class="s1">&#39;grant_type=authorization_code&amp;code=bD0mVb&amp;redirect_uri=http://localhost:8081/test.html&#39;</span> -H <span class="s2">&#34;Accept: application/json&#34;</span>
</span></span></code></pre></div><p>å›å¤ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;access_token&#34;</span><span class="p">:</span> <span class="s2">&#34;0abe701b-0f5a-4d25-81df-f2c4db2af555&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;token_type&#34;</span><span class="p">:</span> <span class="s2">&#34;bearer&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;refresh_token&#34;</span><span class="p">:</span> <span class="s2">&#34;cf6aa9db-3757-465e-af68-b7d59d1f0b77&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;expires_in&#34;</span><span class="p">:</span> <span class="mi">59</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;scope&#34;</span><span class="p">:</span> <span class="s2">&#34;trust read write&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li>åˆ·æ–°ä»¤ç‰Œï¼š</li>
</ul>
<p>æˆ‘ä»¬å·²ç»çœ‹åˆ°æˆæƒæˆäºˆæ˜¯å”¯ä¸€æ”¯æŒåˆ·æ–°ä»¤ç‰Œçš„æˆäºˆã€‚ä½¿ç”¨è®¿é—®ä»¤ç‰Œ 60 ç§’åï¼Œå®ƒå°±ä¼šè¿‡æœŸï¼Œæˆ‘ä»¬å¾—åˆ°ä»¥ä¸‹å“åº”ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;error&#34;</span><span class="p">:</span> <span class="s2">&#34;invalid_token&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;error_description&#34;</span><span class="p">:</span> <span class="s2">&#34;0abe701b-0f5a-4d25-81df-f2c4db2af555&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span></code></pre></div><p>è¿™æ„å‘³ç€è®¿é—®ä»¤ç‰Œå·²è¿‡æœŸã€‚è¦è·å–æ–°ä»¤ç‰Œï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨åˆ·æ–°ä»¤ç‰Œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -X POST --user my-trusted-client:mysecret localhost:8081/oauth/token -d <span class="s1">&#39;client_id=my-trusted-client&amp;grant_type=refresh_token&amp;refresh_token=cf6aa9db-3757-465e-af68-b7d59d1f0b77&#39;</span> -H <span class="s2">&#34;Accept: application/json&#34;</span>
</span></span></code></pre></div><p>å›å¤ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;access_token&#34;</span><span class="p">:</span> <span class="s2">&#34;2f9a6609-fc64-4b1e-93a3-8232827da881&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;token_type&#34;</span><span class="p">:</span> <span class="s2">&#34;bearer&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;refresh_token&#34;</span><span class="p">:</span> <span class="s2">&#34;cf6aa9db-3757-465e-af68-b7d59d1f0b77&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;expires_in&#34;</span><span class="p">:</span> <span class="mi">59</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;scope&#34;</span><span class="p">:</span> <span class="s2">&#34;trust read write&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>æ¯æ¬¡ä»¤ç‰Œè¿‡æœŸæ—¶éƒ½å¯ä»¥é‡å¤æ­¤è¿‡ç¨‹ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>Spring OAuth æä¾›å¼€ç®±å³ç”¨çš„ OAuth ç«¯ç‚¹å’Œæµç¨‹ï¼Œå¹¶ä¸”å¯ä»¥æˆä¸ºä»¥æœ€å°çš„åŠªåŠ›è®¾ç½® OAuth çš„ç»ä½³è§£å†³æ–¹æ¡ˆã€‚ç„¶è€Œï¼Œå¯¹äºä¸ç†Ÿæ‚‰ Spring çš„å¼€å‘äººå‘˜æ¥è¯´ï¼Œè¿™å¯èƒ½æœ‰ç‚¹ä»¤äººç•æƒ§ï¼Œå› ä¸ºå¾ˆå¤šäº‹æƒ…éƒ½åœ¨å¹•åå‘ç”Ÿã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« å¯ä»¥å¸®åŠ©æ‚¨äº†è§£å…¨å±€ã€‚åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºä½¿ç”¨ OAuth èŒƒå›´æ¥ä¿æŠ¤ç«¯ç‚¹ã€‚</p>
<p>å®Œæ•´çš„æºä»£ç å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ï¼š<a href="https://github.com/zak905/oauth2-example">https://github.com/zak905/oauth2-example</a></p>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="http://www.zakariaamine.com/2018-01-27/using-oauth2-in-spring/">http://www.zakariaamine.com/2018-01-27/using-oauth2-in-spring/</a></p>
]]></content:encoded>
    </item>
    
    <item>
      <title>[è¯‘]ä½¿ç”¨Spring Boot2å’ŒSpring Security 5ä»¥åŠJDBCä»¤ç‰Œå­˜å‚¨è¿›è¡ŒOauth2é›†ä¸­æˆæƒ</title>
      <link>https://blog.chensoul.com/posts/2023/07/14/oauth-2-centralized-authorization-with-spring-boot-2-and-spring-security-5-and-jdbc-token-store/</link>
      <pubDate>Fri, 14 Jul 2023 09:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/07/14/oauth-2-centralized-authorization-with-spring-boot-2-and-spring-security-5-and-jdbc-token-store/</guid>
      <description>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•ä½¿ç”¨ Spring Boot 2 å’Œ Spring Security 5 OAuth2 æ¥å®ç°é›†ä¸­æˆæƒçš„æˆæƒæœåŠ¡å™¨ä»¥åŠå¦‚ä½•é€šè¿‡ GUI å¯¹å…¶è¿›è¡Œç®¡ç†ï¼Œè¿˜å°†æä¾›èµ„æºæœåŠ¡å™¨æ¼”ç¤ºä»¥åŠ github ä¸‹çš„æ•´ä¸ªé¡¹</description>
      <content:encoded><![CDATA[<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•ä½¿ç”¨ Spring Boot 2 å’Œ Spring Security 5 OAuth2 æ¥å®ç°é›†ä¸­æˆæƒçš„æˆæƒæœåŠ¡å™¨ä»¥åŠå¦‚ä½•é€šè¿‡ GUI å¯¹å…¶è¿›è¡Œç®¡ç†ï¼Œè¿˜å°†æä¾›èµ„æºæœåŠ¡å™¨æ¼”ç¤ºä»¥åŠ github ä¸‹çš„æ•´ä¸ªé¡¹ç›®ã€‚</p>
<p>å¾ˆå¤šç¤ºä¾‹æ¶µç›–äº†åŸºäºæ—©æœŸç‰ˆæœ¬çš„ Spring boot 2 å’Œ Spring Security 5 ä½¿ç”¨å†…å­˜ä»¤ç‰Œå®ç° Oauth2ï¼Œå› æ­¤æƒ³æ³•æ˜¯ä½¿ç”¨ MySql æ•°æ®åº“ä½œä¸ºä»¤ç‰Œå­˜å‚¨ã€‚</p>
<p>ä¸ºäº†æ·±å…¥æ¢è®¨è¿™ä¸ªä¸»é¢˜ï¼Œæˆ‘ä»¬å¿…é¡»ï¼š</p>
<ul>
<li>é…ç½®Springå®‰å…¨ã€‚</li>
<li>é…ç½®æ•°æ®åº“ã€‚</li>
<li>åˆ›å»ºæˆæƒæœåŠ¡å™¨ã€‚</li>
<li>åˆ›å»ºèµ„æºæœåŠ¡å™¨ã€‚</li>
<li>ä½¿ç”¨curl å®¢æˆ·ç«¯ä½¿ç”¨è®¿é—®ä»¤ç‰Œè·å–å®‰å…¨èµ„æºã€‚</li>
</ul>
<h2 id="ä»€ä¹ˆæ˜¯-oauth-2">ä»€ä¹ˆæ˜¯ Oauth 2ï¼Ÿ</h2>
<p>OAuth 2.0 æ˜¯è¡Œä¸šæ ‡å‡†æˆæƒåè®®ã€‚ OAuth 2.0 å–ä»£äº† 2006 å¹´åˆ›å»ºçš„åŸå§‹ OAuth åè®®ä¸Šæ‰€åšçš„å·¥ä½œã€‚OAuth 2.0 æ³¨é‡å®¢æˆ·ç«¯å¼€å‘äººå‘˜çš„ç®€å•æ€§ï¼ŒåŒæ—¶ä¸º Web åº”ç”¨ç¨‹åºã€æ¡Œé¢åº”ç”¨ç¨‹åºã€ç§»åŠ¨ç”µè¯å’Œå®¢å…è®¾å¤‡æä¾›ç‰¹å®šçš„æˆæƒæµç¨‹ã€‚</p>
<p>è¯¥è§„èŒƒåŠå…¶æ‰©å±•æ­£åœ¨ <a href="https://www.ietf.org/mailman/listinfo/oauth">IETF OAuth å·¥ä½œç»„å†…</a>å¼€å‘ã€‚</p>
<h2 id="oauth-2-è§’è‰²">Oauth 2 è§’è‰²</h2>
<p>OAuth2å®šä¹‰äº†4ä¸ªè§’è‰²ï¼š</p>
<ul>
<li>
<p>èµ„æºæ‰€æœ‰è€…ï¼šé€šå¸¸æ˜¯æ‚¨è‡ªå·±ã€‚</p>
</li>
<li>
<p>èµ„æºæœåŠ¡å™¨ï¼šæ‰˜ç®¡å—ä¿æŠ¤æ•°æ®çš„æœåŠ¡å™¨ï¼ˆä¾‹å¦‚ Google æ‰˜ç®¡æ‚¨çš„ä¸ªäººèµ„æ–™å’Œä¸ªäººä¿¡æ¯ï¼‰ã€‚</p>
</li>
<li>
<p>å®¢æˆ·ç«¯ï¼šè¯·æ±‚è®¿é—®èµ„æºæœåŠ¡å™¨çš„åº”ç”¨ç¨‹åºï¼ˆç½‘ç«™ã€Javascript åº”ç”¨ç¨‹åºæˆ–ç§»åŠ¨åº”ç”¨ç¨‹åº&hellip;&hellip;ï¼‰ã€‚</p>
</li>
<li>
<p>æˆæƒæœåŠ¡å™¨ï¼šå‘å®¢æˆ·ç«¯é¢å‘è®¿é—®ä»¤ç‰Œçš„æœåŠ¡å™¨ã€‚è¯¥ä»¤ç‰Œå°†ç”¨äºå®¢æˆ·ç«¯è¯·æ±‚èµ„æºæœåŠ¡å™¨ã€‚è¯¥æœåŠ¡å™¨å¯ä»¥ä¸èµ„æºæœåŠ¡å™¨ç›¸åŒï¼ˆç›¸åŒçš„ç‰©ç†æœåŠ¡å™¨å’Œç›¸åŒçš„åº”ç”¨ç¨‹åºï¼‰ï¼Œè€Œä¸”ç»å¸¸æ˜¯è¿™ç§æƒ…å†µã€‚</p>
</li>
</ul>
<p>ä¸‹å›¾è¯´æ˜äº†è§’è‰²æµç¨‹ï¼š</p>
<p><img loading="lazy" src="https://miro.medium.com/v2/resize:fit:862/1*LrU0kZBljjwd32vLy5IlwA.png" alt="img"  />
</p>
<h2 id="æˆæƒç±»å‹">æˆæƒç±»å‹</h2>
<p>OAuth 2 ä¸ºä¸åŒçš„ç”¨ä¾‹æä¾›äº†å¤šç§â€œæˆæƒç±»å‹â€ã€‚å®šä¹‰çš„æˆæƒç±»å‹å‹æœ‰ï¼š</p>
<ul>
<li>æˆæƒç ï¼šæˆæƒç æˆäºˆæ˜¯ä½¿ç”¨æ‚¨çš„ Facebook æˆ– Google å¸æˆ·ç™»å½•åº”ç”¨ç¨‹åºçš„åŠŸèƒ½ã€‚</li>
<li>å¯†ç ï¼šæ—¨åœ¨ç”¨äºåŸºäºç”¨æˆ·ä»£ç†çš„å®¢æˆ·ç«¯ã€‚å…¶æ¬¡ï¼ŒæˆæƒæœåŠ¡å™¨ä¸ä¼šåƒæˆæƒä»£ç æˆäºˆé‚£æ ·è¿”å›æˆæƒä»£ç æ¥äº¤æ¢è®¿é—®ä»¤ç‰Œï¼Œè€Œæ˜¯è¿”å›è®¿é—®ä»¤ç‰Œã€‚</li>
<li>å®¢æˆ·ç«¯å‡­æ®ï¼šå®¢æˆ·ç«¯å¯ä»¥ä»…ä½¿ç”¨å…¶å®¢æˆ·ç«¯å‡­æ®ï¼ˆæˆ–å…¶ä»–æ”¯æŒçš„èº«ä»½éªŒè¯æ–¹å¼ï¼‰è¯·æ±‚è®¿é—®ä»¤ç‰Œï¼Œå½“å®¢æˆ·ç«¯è¯·æ±‚è®¿é—®å…¶ä¸‹çš„å—ä¿æŠ¤èµ„æºæ§åˆ¶æƒï¼Œæˆ–å…ˆå‰å·²è¢«å…¶ä»–èµ„æºæ‰€æœ‰è€…æ§åˆ¶çš„ä¸æˆæƒæœåŠ¡å™¨å®‰æ’ã€‚</li>
<li>éšå¼æˆæƒï¼šéšå¼æˆæƒæ˜¯ä¸€ç§ç®€åŒ–çš„æˆæƒä»£ç æµï¼Œé’ˆå¯¹ä½¿ç”¨ JavaScript ç­‰è„šæœ¬è¯­è¨€åœ¨æµè§ˆå™¨ä¸­å®ç°çš„å®¢æˆ·ç«¯è¿›è¡Œäº†ä¼˜åŒ–ã€‚åœ¨éšå¼æµç¨‹ä¸­ï¼Œè€Œä¸æ˜¯å‘å®¢æˆ·ç«¯å‘å‡ºæˆæƒä»£ç ï¼Œç›´æ¥å‘å®¢æˆ·ç«¯é¢å‘è®¿é—®ä»¤ç‰Œã€‚</li>
</ul>
<h2 id="ç¤ºèŒƒ">ç¤ºèŒƒ</h2>
<p>è®©æˆ‘ä»¬åŠ¨æ‰‹å§</p>
<h3 id="ä¸šåŠ¡å±‚"><strong>ä¸šåŠ¡å±‚</strong></h3>
<p>ä¸ºç®€å•èµ·è§ï¼Œæˆ‘ä»¬çš„ä¸»è¦ä¸šåŠ¡åº”ç”¨ç¨‹åºå°†æ˜¯ä½¿ç”¨ä¸€ä¸ªå®ä½“çš„äº§å“ APIï¼Œæˆ‘ä»¬çš„è®¿é—®è§„åˆ™å°†æ˜¯ï¼š</p>
<ul>
<li>PRODUCT_CREATE</li>
<li>PRODUCT_UPDATE</li>
<li>PRODUCT_DISPLAY</li>
<li>PRODUCT_ADMIN</li>
</ul>
<h3 id="oauth2-å®¢æˆ·ç«¯è®¾ç½®">OAuth2 å®¢æˆ·ç«¯è®¾ç½®</h3>
<p>è¦è®¾ç½® Oauth 2 å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸‹è¡¨ [æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…é“¾æ¥]</p>
<ul>
<li><a href="https://github.com/spring-projects/spring-security-oauth/blob/2.2.1.RELEASE/spring-security-oauth2/src/main/java/org/springframework/security/oauth2/provider/client/JdbcClientDetailsService.java">OAUTH_CLIENT_DETAILS OAUTH_CLIENT_DETAILS</a></li>
<li><a href="https://github.com/spring-projects/spring-security-oauth/blob/2.2.1.RELEASE/spring-security-oauth2/src/main/java/org/springframework/security/oauth2/client/token/JdbcClientTokenServices.java">OAUTH_CLIENT_TOKEN OAUTH_CLIENT_TOKEN</a></li>
<li><a href="https://github.com/spring-projects/spring-security-oauth/blob/2.2.1.RELEASE/spring-security-oauth2/src/main/java/org/springframework/security/oauth2/provider/token/store/JdbcTokenStore.java">OAUTH_ACCESS_TOKEN OAUTH_ACCESS_TOKEN</a></li>
<li><a href="https://github.com/spring-projects/spring-security-oauth/blob/2.2.1.RELEASE/spring-security-oauth2/src/main/java/org/springframework/security/oauth2/provider/token/store/JdbcTokenStore.java">OAUTH_REFRESH_TOKEN OAUTH_REFRESH_TOKEN</a></li>
<li><a href="https://github.com/spring-projects/spring-security-oauth/blob/2.2.1.RELEASE/spring-security-oauth2/src/main/java/org/springframework/security/oauth2/provider/code/JdbcAuthorizationCodeServices.java">OAUTH_CODE OAUTH_ä»£ç </a></li>
<li><a href="https://github.com/spring-projects/spring-security-oauth/blob/2.2.1.RELEASE/spring-security-oauth2/src/main/java/org/springframework/security/oauth2/provider/approval/JdbcApprovalStore.java">OAUTH_APPROVALS OAUTH_APPROVALS</a></li>
</ul>
<p>æˆ‘ä»¬å°†è°ƒç”¨åƒâ€œproduct_apiâ€è¿™æ ·çš„èµ„æºæœåŠ¡å™¨ å¯¹äºè¯¥æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œç§°ä¸ºï¼š</p>
<ul>
<li>è¯»-å†™-å®¢æˆ·ç«¯ï¼ˆæˆæƒæˆæƒç±»å‹ï¼šè¯»ã€å†™ï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">OAUTH_CLIENT_DETAILS</span><span class="p">(</span><span class="n">CLIENT_ID</span><span class="p">,</span><span class="w"> </span><span class="n">RESOURCE_IDS</span><span class="p">,</span><span class="w"> </span><span class="n">CLIENT_SECRET</span><span class="p">,</span><span class="w"> </span><span class="k">SCOPE</span><span class="p">,</span><span class="w"> </span><span class="n">AUTHORIZED_GRANT_TYPES</span><span class="p">,</span><span class="w"> </span><span class="n">AUTHORITIES</span><span class="p">,</span><span class="w"> </span><span class="n">ACCESS_TOKEN_VALIDITY</span><span class="p">,</span><span class="w"> </span><span class="n">REFRESH_TOKEN_VALIDITY</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;read-write-client&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;product-api&#39;</span><span class="p">,</span><span class="s1">&#39;$2a$10$BurTWIy5NTF9GJJH4magz.9Bd4bBurWYG8tmXxeQh1vs7r/wnCFG2&#39;</span><span class="p">,</span><span class="s1">&#39;read,write&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;client_credentials&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ROLE_PRODUCT_ADMIN&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10800</span><span class="p">,</span><span class="w"> </span><span class="mi">2592000</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">#</span><span class="n">password</span><span class="w"> </span><span class="p">[</span><span class="n">hashed</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">BCCrypt</span><span class="p">]</span><span class="w"> </span><span class="p">:</span><span class="k">user</span><span class="w"> 
</span></span></span></code></pre></div><h3 id="æƒé™å’Œç”¨æˆ·è®¾ç½®">æƒé™å’Œç”¨æˆ·è®¾ç½®</h3>
<p>Spring Security é™„å¸¦ä¸¤ä¸ªæœ‰ç”¨çš„æ¥å£ï¼š</p>
<ul>
<li>
<p><a href="https://docs.spring.io/spring-security/site/docs/5.0.x/api/org/springframework/security/core/userdetails/UserDetails.html">UserDetails</a> â€” æä¾›æ ¸å¿ƒç”¨æˆ·ä¿¡æ¯ã€‚</p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-security/site/docs/5.0.x/api/org/springframework/security/core/GrantedAuthority.html">GrantedAuthority</a> â€” è¡¨ç¤ºæˆäºˆèº«ä»½éªŒè¯å¯¹è±¡çš„æƒé™ã€‚</p>
</li>
</ul>
<p>ä¸‹é¢çš„è„šæœ¬å°†åŠ è½½æ‰€æœ‰æƒé™å’Œå‡­æ®ï¼ˆç”¨æˆ·ï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">authority</span><span class="w">  </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;ROLE_OAUTH_ADMIN&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">authority</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;ROLE_ADMIN_PRODUCT&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">authority</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;ROLE_RESOURCE_ADMIN&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">credentials</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;oauth_admin&#39;</span><span class="p">,</span><span class="s1">&#39;$2a$10$BurTWIy5NTF9GJJH4magz.9Bd4bBurWYG8tmXxeQh1vs7r/wnCFG2&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">credentials</span><span class="w"> </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">b</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;resource_admin&#39;</span><span class="p">,</span><span class="s1">&#39;$2a$10$BurTWIy5NTF9GJJH4magz.9Bd4bBurWYG8tmXxeQh1vs7r/wnCFG2&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">credentials</span><span class="w">  </span><span class="k">VALUES</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">b</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;user&#39;</span><span class="p">,</span><span class="s1">&#39;$2a$10$BurTWIy5NTF9GJJH4magz.9Bd4bBurWYG8tmXxeQh1vs7r/wnCFG2&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">credentials_authorities</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">credentials_authorities</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">credentials_authorities</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">#</span><span class="n">Password</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">user</span><span class="w">
</span></span></span></code></pre></div><h3 id="apiå±‚">APIå±‚</h3>
<p>å¯¹äºæ¼”ç¤ºï¼ŒåŸºäº Spring Boot å¼€å‘äº† RESTful åº”ç”¨ç¨‹åºå¹¶å…¬å¼€ä»¥ä¸‹ç«¯ç‚¹ï¼š</p>
<p><img loading="lazy" src="https://miro.medium.com/v2/resize:fit:1400/1*hHVGQGdvto-JkXNCZxzNyw.jpeg" alt="img"  />
</p>
<h3 id="springå®‰å…¨é…ç½®">Springå®‰å…¨é…ç½®</h3>
<p>æˆ‘ä»¬å¿…é¡»æä¾› <a href="https://docs.spring.io/spring-security/site/docs/4.2.3.RELEASE/apidocs/org/springframework/security/core/userdetails/UserDetailsService.html">UserDetailsService</a> æ¥å£çš„å®ç°ï¼Œä»¥ä¾¿è·å–ç”¨æˆ·å‡­æ®å’Œæƒé™ï¼Œå¦‚ä¸‹æ‰€ç¤º</p>
<p><img loading="lazy" src="https://miro.medium.com/v2/resize:fit:1400/1*dyyiX3P9XSdsPuYQyc4_kA.jpeg" alt="img"  />
</p>
<p>ä¸ºäº†å‘åº”ç”¨ç¨‹åºæä¾›å®‰å…¨æ€§ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ <a href="https://docs.spring.io/spring-security/site/docs/4.2.3.RELEASE/apidocs/org/springframework/security/config/annotation/web/configuration/EnableWebSecurity.html">@EnableWebSecurity</a> æ³¨é‡Šå’Œ WebSecurityConfigurerAdapter</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">com.aak.configuration</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.web.builders.WebSecurity</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.web.configuration.EnableWebSecurity</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.security.core.userdetails.UserDetailsService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.security.crypto.password.PasswordEncoder</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.security.provisioning.JdbcUserDetailsManager</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.security.web.util.matcher.AntPathRequestMatcher</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Created by ahmed on 20.5.18.
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="nd">@EnableWebSecurity</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Configuration</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebSecurityConfiguration</span> <span class="kd">extends</span> <span class="n">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">PasswordEncoder</span> <span class="nf">passwordEncoder</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">BCryptPasswordEncoder</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">UserDetailsService</span> <span class="nf">userDetailsServiceBean</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">JdbcUserDetails</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">WebSecurity</span> <span class="n">web</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">web</span><span class="o">.</span><span class="na">ignoring</span><span class="o">().</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">&#34;/webjars/**&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">http</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">&#34;/login&#34;</span><span class="o">,</span><span class="s">&#34;/logout.do&#34;</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">&#34;/**&#34;</span><span class="o">).</span><span class="na">authenticated</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">formLogin</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">loginProcessingUrl</span><span class="o">(</span><span class="s">&#34;/login.do&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">usernameParameter</span><span class="o">(</span><span class="s">&#34;username&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">passwordParameter</span><span class="o">(</span><span class="s">&#34;password&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">loginPage</span><span class="o">(</span><span class="s">&#34;/login&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">logout</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">logoutRequestMatcher</span><span class="o">(</span><span class="k">new</span> <span class="n">AntPathRequestMatcher</span><span class="o">(</span><span class="s">&#34;/logout.do&#34;</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">userDetailsService</span><span class="o">(</span><span class="n">userDetailsServiceBean</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">AuthenticationManagerBuilder</span> <span class="n">auth</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">auth</span><span class="o">.</span><span class="na">userDetailsService</span><span class="o">(</span><span class="n">userDetailsServiceBean</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">passwordEncoder</span><span class="o">(</span><span class="n">passwordEncoder</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h3 id="oauth2-é…ç½®">OAuth2 é…ç½®</h3>
<p>è¦è®¾ç½® Oauth 2ï¼Œéœ€è¦å®ç°ä¸¤ä¸ªç»„ä»¶</p>
<ul>
<li>Authorization Server æˆæƒæœåŠ¡å™¨</li>
<li>Resource Server èµ„æºæœåŠ¡å™¨</li>
</ul>
<h3 id="æˆæƒæœåŠ¡å™¨">æˆæƒæœåŠ¡å™¨</h3>
<p>æˆæƒæœåŠ¡å™¨è´Ÿè´£éªŒè¯ç”¨æˆ·èº«ä»½å¹¶æä¾›ä»¤ç‰Œï¼Œä½¿ç”¨@EnableAuthorizationServeræ³¨è§£å¯ç”¨æˆæƒæœåŠ¡å™¨é…ç½®</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">com.aak.configuration</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.boot.context.properties.ConfigurationProperties</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.boot.jdbc.DataSourceBuilder</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.security.oauth2.config.annotation.configurers.ClientDetailsServiceConfigurer</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.security.oauth2.config.annotation.web.configuration.AuthorizationServerConfigurerAdapter</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.security.oauth2.config.annotation.web.configuration.EnableAuthorizationServer</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.security.oauth2.config.annotation.web.configurers.AuthorizationServerEndpointsConfigurer</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.security.oauth2.config.annotation.web.configurers.AuthorizationServerSecurityConfigurer</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.security.oauth2.provider.approval.ApprovalStore</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.security.oauth2.provider.approval.JdbcApprovalStore</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.security.oauth2.provider.client.JdbcClientDetailsService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.security.oauth2.provider.code.AuthorizationCodeServices</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.security.oauth2.provider.code.JdbcAuthorizationCodeServices</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.security.oauth2.provider.token.TokenStore</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.security.oauth2.provider.token.store.JdbcTokenStore</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">javax.sql.DataSource</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Created by ahmed on 21.5.18.
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Configuration</span>
</span></span><span class="line"><span class="cl"><span class="nd">@EnableAuthorizationServer</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AuthorizationServerConfiguration</span> <span class="kd">extends</span> <span class="n">AuthorizationServerConfigurerAdapter</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@ConfigurationProperties</span><span class="o">(</span><span class="n">prefix</span> <span class="o">=</span> <span class="s">&#34;spring.datasource&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">oauthDataSource</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">DataSourceBuilder</span><span class="o">.</span><span class="na">create</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">JdbcClientDetailsService</span> <span class="nf">clientDetailsService</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">JdbcClientDetailsService</span><span class="o">(</span><span class="n">oauthDataSource</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">TokenStore</span> <span class="nf">tokenStore</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">JdbcTokenStore</span><span class="o">(</span><span class="n">oauthDataSource</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">ApprovalStore</span> <span class="nf">approvalStore</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">JdbcApprovalStore</span><span class="o">(</span><span class="n">oauthDataSource</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">AuthorizationCodeServices</span> <span class="nf">authorizationCodeServices</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">JdbcAuthorizationCodeServices</span><span class="o">(</span><span class="n">oauthDataSource</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">ClientDetailsServiceConfigurer</span> <span class="n">clients</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">clients</span><span class="o">.</span><span class="na">withClientDetails</span><span class="o">(</span><span class="n">clientDetailsService</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">AuthorizationServerSecurityConfigurer</span> <span class="n">oauthServer</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">AuthorizationServerEndpointsConfigurer</span> <span class="n">endpoints</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">endpoints</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">approvalStore</span><span class="o">(</span><span class="n">approvalStore</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">authorizationCodeServices</span><span class="o">(</span><span class="n">authorizationCodeServices</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">tokenStore</span><span class="o">(</span><span class="n">tokenStore</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æˆåŠŸé…ç½®è¿è¡ŒæˆæƒæœåŠ¡å™¨åï¼Œæ‚¨å°†è·å¾—ç™»å½•é¡µé¢æ¥ç®¡ç†æˆæƒæœåŠ¡å™¨</p>
<p><img loading="lazy" src="https://miro.medium.com/v2/resize:fit:1400/1*2pQ9mmQ-AvOv3uBctFPHew.jpeg" alt="img"  />
</p>
<p>ä½¿ç”¨ oauth_admin/user ä½œä¸ºç”¨æˆ·å/å¯†ç è®¿é—® Oauth2 ä»ªè¡¨æ¿ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­åˆ›å»ºæœåŠ¡å™¨å®¢æˆ·ç«¯</p>
<p><img loading="lazy" src="https://miro.medium.com/v2/resize:fit:1400/1*L4h4ZNPrYt0sa8Qln_c4NA.jpeg" alt="img"  />
</p>
<h2 id="èµ„æºæœåŠ¡å™¨">èµ„æºæœåŠ¡å™¨</h2>
<p>èµ„æºæœåŠ¡å™¨æ‰˜ç®¡å— OAuth2 ä»¤ç‰Œä¿æŠ¤çš„èµ„æºï¼ˆåŸºæœ¬ä¸Šæ˜¯æˆ‘ä»¬çš„äº§å“ APIï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">com.aak.configuration</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.boot.context.properties.ConfigurationProperties</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.boot.jdbc.DataSourceBuilder</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.http.HttpMethod</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.security.oauth2.config.annotation.web.configuration.EnableResourceServer</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.security.oauth2.config.annotation.web.configuration.ResourceServerConfigurerAdapter</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.security.oauth2.config.annotation.web.configurers.ResourceServerSecurityConfigurer</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.security.oauth2.provider.token.TokenStore</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.security.oauth2.provider.token.store.JdbcTokenStore</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">javax.sql.DataSource</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Created by ahmed on 30.5.18.
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="nd">@EnableResourceServer</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Configuration</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ResourcesServerConfiguration</span>  <span class="kd">extends</span> <span class="n">ResourceServerConfigurerAdapter</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@ConfigurationProperties</span><span class="o">(</span><span class="n">prefix</span><span class="o">=</span><span class="s">&#34;spring.datasource&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">DataSource</span> <span class="nf">ouathDataSource</span><span class="o">(){</span><span class="k">return</span> <span class="n">DataSourceBuilder</span><span class="o">.</span><span class="na">create</span><span class="o">().</span><span class="na">build</span><span class="o">();}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">ResourceServerSecurityConfigurer</span> <span class="n">resources</span><span class="o">)</span><span class="kd">throws</span> <span class="n">Exception</span><span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">TokenStore</span> <span class="n">tokenStore</span><span class="o">=</span><span class="k">new</span> <span class="n">JdbcTokenStore</span><span class="o">(</span><span class="n">ouathDataSource</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="n">resources</span><span class="o">.</span><span class="na">resourceId</span><span class="o">(</span><span class="s">&#34;product_api&#34;</span><span class="o">).</span><span class="na">tokenStore</span><span class="o">(</span><span class="n">tokenStore</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">http</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="n">HttpMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span> <span class="s">&#34;/**&#34;</span><span class="o">).</span><span class="na">access</span><span class="o">(</span><span class="s">&#34;#oauth2.hasScope(&#39;read&#39;)&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="n">HttpMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">,</span> <span class="s">&#34;/**&#34;</span><span class="o">).</span><span class="na">access</span><span class="o">(</span><span class="s">&#34;#oauth2.hasScope(&#39;write&#39;)&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="n">HttpMethod</span><span class="o">.</span><span class="na">PATCH</span><span class="o">,</span> <span class="s">&#34;/**&#34;</span><span class="o">).</span><span class="na">access</span><span class="o">(</span><span class="s">&#34;#oauth2.hasScope(&#39;write&#39;)&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="n">HttpMethod</span><span class="o">.</span><span class="na">PUT</span><span class="o">,</span> <span class="s">&#34;/**&#34;</span><span class="o">).</span><span class="na">access</span><span class="o">(</span><span class="s">&#34;#oauth2.hasScope(&#39;write&#39;)&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="n">HttpMethod</span><span class="o">.</span><span class="na">DELETE</span><span class="o">,</span> <span class="s">&#34;/**&#34;</span><span class="o">).</span><span class="na">access</span><span class="o">(</span><span class="s">&#34;#oauth2.hasScope(&#39;write&#39;)&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">headers</span><span class="o">().</span><span class="na">addHeaderWriter</span><span class="o">((</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            			<span class="n">response</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">&#34;Access-Control-Allow-Origin&#34;</span><span class="o">,</span> <span class="s">&#34;*&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                  <span class="k">if</span> <span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">&#34;OPTIONS&#34;</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                      <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">&#34;Access-Control-Allow-Methods&#34;</span><span class="o">,</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">&#34;Access-Control-Request-Method&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">                      <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">&#34;Access-Control-Allow-Headers&#34;</span><span class="o">,</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">&#34;Access-Control-Request-Headers&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">                  <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">});</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ä½¿ç”¨ä»¥ä¸‹ Curl å®¢æˆ·ç«¯æµ‹è¯•äº§å“åˆ—è¡¨ç«¯ç‚¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/sh
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="nv">TOKEN</span><span class="o">=</span><span class="sb">`</span>curl -s -u curl_client:user -X POST localhost:8081/oauth/token<span class="se">\?</span><span class="nv">grant_type</span><span class="o">=</span>client_credentials <span class="p">|</span> egrep -o â€˜<span class="o">[</span>a-f0â€“9-<span class="o">]{</span>20,<span class="o">}</span>â€™<span class="sb">`</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> â€œ tGot token <span class="k">for</span> curl client as :<span class="nv">$TOKEN</span>â€
</span></span><span class="line"><span class="cl">curl localhost:8083/product/products -H â€œAuthorization: Bearer <span class="nv">$TOKEN</span>â€
</span></span></code></pre></div><p>è¿è¡Œ Curl å®¢æˆ·ç«¯ bash è„šæœ¬åå¾—åˆ°å“åº”ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ ./client.sh
</span></span><span class="line"><span class="cl">Got token <span class="k">for</span> curl client as : 3be01519â€“0cab-4049-b87d-617c48bda502
</span></span><span class="line"><span class="cl"><span class="o">[{</span>â€œversionâ€:0,â€nameâ€:â€product_1<span class="s2">&#34;,â€availableâ€:false},{â€œversionâ€:0,â€nameâ€:â€product_2&#34;</span>,â€availableâ€:true<span class="o">}]</span>
</span></span></code></pre></div><p>ä» github ä¸ŠæŸ¥çœ‹æ•´ä¸ªä»£ç ï¼šhttps://github.com/Akourtiim/oauth2-spring-boot-2.0.2.git</p>
<p><strong>å‚è€ƒï¼š</strong></p>
<ul>
<li><a href="https://tools.ietf.org/html/rfc6749">https://tools.ietf.org/html/rfc6749</a></li>
<li><a href="https://dzone.com/articles/secure-spring-rest-with-spring-security-and-oauth2">https://dzone.com/articles/secure-spring-rest-with-spring-security-and-oauth2</a></li>
<li><a href="http://www.bubblecode.net/en/2016/01/22/understanding-oauth2/">http://www.bubblecode.net/en/2016/01/22/understanding-oauth2/</a></li>
<li><a href="https://github.com/FrontierPsychiatrist/spring-oauth-example">https://github.com/FrontierPsychiatrist/spring-oauth-example</a></li>
</ul>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://akourtim-ahmed.medium.com/oauth-2-centralized-authorization-with-spring-boot-2-0-2-and-spring-security-5-and-jdbc-token-store-8dbc063bd5d4">Oauth 2 Centralized Authorization with Spring Boot 2.0.2 and Spring Security 5 and JDBC token store</a></p>
]]></content:encoded>
    </item>
    
    <item>
      <title>å‘¨æŠ¥-26ï½œä¸ŠåŠå¹´çš„ç»©æ•ˆæ€»ç»“</title>
      <link>https://blog.chensoul.com/posts/2023/07/11/weekly_review_26/</link>
      <pubDate>Tue, 11 Jul 2023 09:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/07/11/weekly_review_26/</guid>
      <description>å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-06-26 åˆ° 2023-07-09 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚ è¯»ä¹¦ã€å¥èº«ã€æŠ•èµ„ã€å¸®æœ‹å‹ã€é™ªå®¶äººã€‚ è¿™ä¸¤å‘¨ä¸»è¦æ˜¯å¿™</description>
      <content:encoded><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p>æœ¬ç¯‡æ˜¯å¯¹ <code>2023-06-26</code> åˆ° <code>2023-07-09</code> è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº <a href="https://blog.chensoul.com/">åšå®¢</a>ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚</p>
<blockquote>
<p>è¯»ä¹¦ã€å¥èº«ã€æŠ•èµ„ã€å¸®æœ‹å‹ã€é™ªå®¶äººã€‚</p>
</blockquote>
<p>è¿™ä¸¤å‘¨ä¸»è¦æ˜¯å¿™äºå·¥ä½œï¼ŒWekatime ä¸Šç»Ÿè®¡çš„ä¸Šå‘¨æ¯å¤©å¹³å‡ç¼–ç¨‹æ—¶é—´è¾¾åˆ°äº† <strong>6 hrs 52 mins</strong>ï¼ŒåŸºæœ¬ä¸Šæ¯å¤©éƒ½æ˜¯æ—©ä¸ƒæ™šä¸ƒçš„ä¸Šç­èŠ‚å¥ã€‚äºæ˜¯ï¼Œå­¦ä¹ çš„æ—¶é—´éƒ½è¢«å·¥ä½œå ç”¨äº†ã€‚å·¥ä½œçš„å†…å®¹ä¸»è¦æ˜¯æ•´åˆå¤šä¸ªç³»ç»Ÿå®ç°ssoç™»å½•ï¼Œç”¨åˆ°çš„æŠ€æœ¯æœ‰SpringCloudã€Spring Security Oauth2ç­‰ç­‰ã€‚</p>
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-26-01.png" alt="weekly-review-26-01" style="width:50%;" />
<p>å¦å¤–ï¼Œæœ¬å‘¨å®Œæˆäº†ä¸ŠåŠå¹´çš„ç»©æ•ˆæ€»ç»“ï¼Œå›é¡¾äº†è¿™åŠå¹´çš„å·¥ä½œå†…å®¹ã€‚</p>
<h2 id="ç»©æ•ˆæ€»ç»“">ç»©æ•ˆæ€»ç»“</h2>
<p>1ã€é¡¹ç›®æ–¹é¢çš„æˆæœï¼š</p>
<p>aã€å®Œæˆäº†æ™ºèƒ½å®‰é˜²å¤šä¸ªé¡¹ç›®çš„è¿­ä»£å¼€å‘å’Œä¸Šçº¿ï¼ŒåŒ…æ‹¬ç”¨æˆ·åˆ‡æ¢ç§Ÿæˆ·ã€æŠ¥è¡¨å‘é€åˆ°é£ä¹¦ã€åä¸ºè½¦ç‰Œè¯†åˆ«ã€å¤œæ”¶æ¨¡å—æ‹†åˆ†ã€å·¡æ£€åœºæ™¯åŠŸèƒ½ä¼˜åŒ–ç­‰ã€‚åŒæ—¶ï¼Œä¹Ÿå®Œæˆäº†é€šçŸ¥æ¨¡å—é‡æ„ã€å¤§å±æŠ¥è¡¨æ”¯æŒå¤šç§Ÿæˆ·å’Œé—¨åº—ã€Dmallai å¯¼èˆªç­‰éœ€æ±‚çš„å¼€å‘ã€‚è¿™äº›å·¥ä½œçš„å®Œæˆï¼Œä¸ºç³»ç»Ÿçš„ç¨³å®šæ€§å’ŒåŠŸèƒ½æ‰©å±•æä¾›äº†æœ‰åŠ›çš„æ”¯æŒã€‚</p>
<p>bã€å…±å‘å¸ƒäº†32æ¬¡ç‰ˆæœ¬ï¼Œå…¶ä¸­7æ¬¡ä¸ºåŠŸèƒ½è¿­ä»£ï¼Œ25æ¬¡ä¸ºbugä¿®å¤ã€‚å¹³å‡æ¯æœˆå®Œæˆäº†1æ¬¡é¡¹ç›®è¿­ä»£å’Œ4æ¬¡bugä¿®å¤ï¼Œåšåˆ°äº†åŠæ—¶å“åº”å’Œå¿«é€Ÿè§£å†³é—®é¢˜ï¼Œæå‡äº†ç”¨æˆ·çš„ä½¿ç”¨ä½“éªŒå’Œæ»¡æ„åº¦ï¼Œæé«˜äº†ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œé™ä½ç³»ç»Ÿçš„æ•…éšœç‡å’Œç”¨æˆ·çš„æŠ•è¯‰ç‡ï¼Œæ²¡æœ‰å‡ºç°P3çº§åˆ«ä»¥ä¸Šæ•…éšœã€‚</p>
<p>2ã€æŠ€æœ¯æ–¹é¢çš„æˆæœï¼š</p>
<p>åˆ©ç”¨ç©ºä½™æ—¶é—´å­¦ä¹ æ–°æŠ€æœ¯å’Œæ¡†æ¶ï¼Œå¦‚ Pyhonã€Rustã€Reactï¼Œæ¯å‘¨å†™å‘¨æŠ¥å’Œå­¦ä¹ æ€»ç»“ï¼Œæ€»è®¡è¾“å‡º66ç¯‡æ–‡ç« ã€‚</p>
<p>ä¸æ–­ä¼˜åŒ–å’Œè¿­ä»£ Rose æ¡†æ¶ï¼Œå¹¶å°† Rose åˆå¹¶åˆ° Cocktail cloudï¼Œæ–¹ä¾¿ä»£ç ç®¡ç†å’Œç»´æŠ¤ã€‚åŒæ—¶ï¼ŒCocktail cloud è¿˜å¢åŠ äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œç‰¹æ€§ï¼Œå¦‚å›½é™…åŒ–ã€æ—¥å¿—æ‰“å°ã€åä¸ºäº‘æ¥å£å°è£…ç­‰ã€‚</p>
<p>åˆ©ç”¨è®¾è®¡æ¨¡å¼é‡æ„é€šçŸ¥æ¨¡å—ï¼Œæå‡ä»£ç è´¨é‡ï¼ŒåŒæ—¶ç³»ç»Ÿæ‰©å±•æ€§å’Œå¹¶å‘ä¹Ÿå¾—åˆ°å¾ˆå¤§çš„æå‡ã€‚</p>
<p>3ã€ä¸ªäººå‘å±•æ–¹é¢çš„æˆæœï¼š</p>
<p>é€šè¿‡ä¸æ–­å­¦ä¹ å’Œå®è·µï¼Œæé«˜äº†è‡ªå·±çš„æ²Ÿé€šèƒ½åŠ›å’Œæ—¶é—´ç®¡ç†çš„èƒ½åŠ›ã€‚æ¯å¤©æ—©ä¸Š7ç‚¹åˆ°å…¬å¸å­¦ä¹ ï¼Œæé«˜äº†ä¸ªäººå·¥ä½œæ•ˆç‡å’Œæ‰§è¡ŒåŠ›ã€‚</p>
<p>4ã€å›¢é˜Ÿåˆä½œæ–¹é¢çš„æˆæœï¼š</p>
<p>åŠ å¼ºäº†å’ŒåŒäº‹ä¹‹é—´çš„æ²Ÿé€šå’Œåä½œï¼ŒåŠæ—¶è®¨è®ºé¡¹ç›®éœ€æ±‚å’Œè¿›åº¦ï¼Œä¿éšœé¡¹ç›®æŒ‰æ—¶ä¸Šçº¿ã€‚</p>
<h2 id="è¯»ä¹¦">è¯»ä¹¦</h2>
<h2 id="å¥èº«">å¥èº«</h2>
<blockquote>
<p>æˆ‘è·‘è¿‡äº†ä¸€äº›åœ°æ–¹ï¼Œå¸Œæœ›éšç€æ—¶é—´æ¨ç§»ï¼Œåœ°å›¾ç‚¹äº®çš„åœ°æ–¹è¶Šæ¥è¶Šå¤šã€‚2 å¹´é‡Œæˆ‘è·‘è¿‡ 2ä¸ªçœä»½ 2ä¸ªåŸå¸‚ã€‚æ›´å¤šè·‘æ­¥æ•°æ®åœ¨æˆ‘çš„ <a href="https://run.chensoul.com/">è·‘æ­¥</a> ä¸»é¡µã€‚</p>
</blockquote>
<h2 id="ç†è´¢">ç†è´¢</h2>
<p>è¿™å‘¨æ€»è®¡æ”¯å‡º 1483 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>7æœˆ2æ—¥ï¼š1276å…ƒï¼Œå…¶ä¸­1000å…ƒåŠ æ²¹</p>
</li>
<li>
<p>7æœˆ1æ—¥ï¼š32å…ƒ</p>
</li>
<li>
<p>6æœˆ30æ—¥ï¼š35å…ƒ</p>
</li>
<li>
<p>6æœˆ29æ—¥ï¼š15å…ƒ</p>
</li>
<li>
<p>6æœˆ28æ—¥ï¼š41å…ƒ</p>
</li>
<li>
<p>6æœˆ27æ—¥ï¼š41å…ƒ</p>
</li>
<li>
<p>6æœˆ26æ—¥ï¼š43å…ƒ</p>
</li>
</ul>
<h2 id="é™ªå®¶äºº">é™ªå®¶äºº</h2>
<h2 id="å·¥ä½œ">å·¥ä½œ</h2>
<p>æœ€è¿‘åœ¨å­¦ä¹ çš„å†…å®¹æ¸…å•ï¼š</p>
<ul>
<li><a href="https://github.com/clxering/Effective-Java-3rd-edition-Chinese-English-bilingual/tree/dev">Effective Javaï¼ˆç¬¬ 3 ç‰ˆï¼‰</a></li>
<li><a href="https://java-design-patterns.com/zh/">Java Design Patterns (ä¸­æ–‡)</a></li>
<li><a href="https://realpython.com/">Real Python</a></li>
</ul>
<p>æœ¬å‘¨å®Œæˆä¸‰ç¯‡åšå®¢ï¼š</p>
<ul>
<li><a href="/posts/2023/07/06/java-design-patterns-ambassador/">Javaè®¾è®¡æ¨¡å¼ï¼šAmbassador</a></li>
<li><a href="/posts/2023/07/06/python-module-package/">Pythonå­¦ä¹ 6ï¼šæ¨¡å—å’ŒåŒ…</a></li>
<li><a href="/posts/2023/07/08/python-input-and-output/">Pythonå­¦ä¹ 7ï¼šè¾“å…¥å’Œè¾“å‡º</a></li>
</ul>
<h2 id="æœ¬å‘¨åˆ†äº«">æœ¬å‘¨åˆ†äº«</h2>
<p>å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€<a href="https://t.me/chensoul_share">ChenSoul Share</a>ã€Telegram é¢‘é“æˆ–è€…æˆ‘çš„ <a href="https://memos.chensoul.com/">Memos</a> ä¸­ã€‚æˆ‘å†™äº†ä¸€ä¸ª Python è„šæœ¬ä» Memos è¯»å–æœ€è¿‘ä¸€å‘¨å¸¦æœ‰ <code>#memos</code> æ ‡ç­¾çš„è®°å½•ï¼Œåˆ†äº«åˆ°è¿™é‡Œã€‚</p>
<ul>
<li>
<p>ğŸ“Œ<code>2023-06-27</code>  <a href="https://twitter.com/hashtag/%E5%B7%A5%E7%A8%8B%E5%B8%88%E5%B7%A5%E5%85%B7?src=hashtag_click">#å·¥ç¨‹å¸ˆå·¥å…·</a> æœ‰å°ä¼™ä¼´å¼€å§‹ç©è¿™ä¸ªç‰›é€¼çš„ AI PS å·¥å…·äº†å—ï¼Ÿå« <strong>DragGAN</strong>ï¼Œä»£ç å¼€æºäº†ï¼ŒCC-BY-NC è®¸å¯ï¼Œç®€å•æ¥è¯´å°±æ˜¯é€šè¿‡æ‹–åŠ¨ä»¥åŠç®€å•æ“ä½œçš„æ–¹å¼å¯¹å›¾ä¸­å¯¹è±¡è¿›è¡Œå§¿åŠ¿ã€å½¢çŠ¶ã€è¡¨æƒ…å’Œå¸ƒå±€å…·æœ‰çµæ´»è€Œç²¾ç¡®çš„æ§åˆ¶ï¼Œæ•ˆæœå¤ªç‰›é€¼äº†ï¼Œå¯ç©ç©çœ‹ã€‚ <a href="https://t.co/0K5fPzsYdU">https://github.com/XingangPan/DragGAN</a> <code>#memos</code> <a href="https://twitter.com/hitw93/status/1673700825989013504?s=12&amp;t=N9Km7vJe9ghZkB_zBEJh4A">https://twitter.com/hitw93/status/1673700825989013504?s=12&amp;t=N9Km7vJe9ghZkB_zBEJh4A</a></p>
</li>
<li>
<p>ğŸ“Œ<code>2023-06-27</code> Z-Library å‘å¸ƒæ¡Œé¢å®¢æˆ·ç«¯ï¼Œæ”¯æŒ Windowsã€macOSã€Linuxï¼Œé’ˆå¯¹ä¸­å›½è¿æ¥ç¨³å®šæ€§ä¼˜åŒ– <a href="https://t.co/SdurrvlMht">https://ift.tt/h8KyIdF</a> <code>#memos</code> <a href="https://twitter.com/appinn/status/1673640410156093441?s=12&amp;t=N9Km7vJe9ghZkB_zBEJh4A">https://twitter.com/appinn/status/1673640410156093441?s=12&amp;t=N9Km7vJe9ghZkB_zBEJh4A</a></p>
</li>
<li>
<p>ğŸ“Œ<code>2023-06-27</code> èƒ½ä¸‹è½½å…¨ç½‘ï¼ˆMac/Winå‡å¯ï¼‰æ‰€æœ‰éŸ³ã€è§†é¢‘çš„æ•ˆç‡æ’ä»¶å·¥å…·ï¼Œæ˜¯æˆ‘è‡ªå·±å¤šå¹´æ¥çš„æ”¶è—ï¼Œä¹Ÿæ˜¯æˆ‘å¹³å¸¸åƒé¥­ç”¨çš„å®¶ä¼™ï¼Œã€æ­é…ä½¿ç”¨ã€‘æ•ˆæœæ›´ä½³  1ã€æµè§ˆå™¨ä¸‹è½½æ’ä»¶å›¾1 <a href="https://t.co/xouLavoWtp">https://cococut.net</a> 2ã€ç½‘é¡µåœ¨çº¿ä¸‹è½½å›¾2 <a href="https://t.co/rgxWNyapcV">https://y2mate.com/en640</a> 3ã€Bç«™è§†é¢‘åœ¨çº¿ä¸‹è½½å›¾3 <a href="https://t.co/L4Ms9nK5mG">https://xbeibeix.com/api/bilibili/</a>  <code>#memos</code> <a href="https://twitter.com/mooenychu/status/1673489537472008192?s=12&amp;t=N9Km7vJe9ghZkB_zBEJh4A">https://twitter.com/mooenychu/status/1673489537472008192?s=12&amp;t=N9Km7vJe9ghZkB_zBEJh4A</a></p>
</li>
<li>
<p>ğŸ“Œ<code>2023-06-27</code> Macå…¶å®è¿˜æœ‰ä¸€ä¸ªä¸‡èƒ½ä¸‹è½½å™¨å·¥å…·ï¼š<a href="https://twitter.com/hashtag/Downie4?src=hashtag_click">Downie4</a>ï¼Œæ¨ç‰¹è§†é¢‘ï¼Œæ²¹ç®¡è§†é¢‘ï¼ŒBç«™è§†é¢‘ç­‰ç­‰ï¼Œåªè¦é“¾æ¥å¤åˆ¶è¿›å»å°±å¯ä»¥è‡ªåŠ¨ä¸‹è½½å†…å®¹å’Œå­—å¹•ï¼Œå¾ˆå¥½ç”¨ï¼Œæœ‰éœ€è¦çš„æœ‹å‹æ‰¾æ¥å®‰è£…ä½¿ç”¨ã€‚éè‹¹æœç”¨æˆ·å¦‚æœæœ‰è¿™æ–¹é¢çš„éœ€æ±‚ï¼Œæˆ‘å¯ä»¥æŠŠè¿™å‡ å¹´ä¸€ç›´åœ¨ç”¨èƒ½ä¸‹æ‰€æœ‰åœºæ™¯ä¸‹çš„åƒé¥­å®¶ä¼™åˆ†äº«å‡ºæ¥ï¼Œéœ€è¦çš„è¯„è®ºåŒºç•™è¨€å§ï¼Œä¸Šç­å»äº†ã€‚<a href="https://twitter.com/hashtag/videodownlaod?src=hashtag_click">videodownlaod</a> <code>#memos</code> <a href="https://twitter.com/mooenychu/status/1673144297389174784?s=12&amp;t=N9Km7vJe9ghZkB_zBEJh4A">https://twitter.com/mooenychu/status/1673144297389174784?s=12&amp;t=N9Km7vJe9ghZkB_zBEJh4A</a></p>
</li>
<li>
<p>ğŸ“Œ<code>2023-06-27</code> å‘Šè¯‰å¤§å®¶ä¸€ä¸ªå…è´¹ç”¨MySQLäº‘æ•°æ®åº“çš„æ¸ é“ï¼š  ç›´æ¥ç”¨TiDB Cloudçš„Serverlesså®ä¾‹å½“ä½œå…è´¹äº‘æ•°æ®åº“å°±å¥½äº† æä¾›5GiBå…è´¹å­˜å‚¨å’Œäº”åƒä¸‡è¯·æ±‚å•å…ƒ(ä¸€ç§Serverlessç”¨é‡ç»Ÿè®¡æŒ‡æ ‡) åƒæ˜¯ä¸ªäººçš„åšå®¢ ä¾‹å¦‚wordpress ä¸€äº›ä¸­å°å‹ä¼ä¸šç½‘ç«™çš„CMSç³»ç»Ÿ ä¸ªäººå°é¡¹ç›®ç”¨åº”è¯¥æ˜¯è¶³å¤Ÿäº† regionè¦†ç›–ä¸œäºšå’ŒåŒ—ç¾ ç›´è¿é€Ÿåº¦ä¹Ÿè¿˜ä¸é”™ <code>#memos</code> <a href="https://twitter.com/changwei1006/status/1673169925710700545?s=12&amp;t=N9Km7vJe9ghZkB_zBEJh4A">https://twitter.com/changwei1006/status/1673169925710700545?s=12&amp;t=N9Km7vJe9ghZkB_zBEJh4A</a></p>
</li>
</ul>
<p>ä»¥ä¸Šã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>Pythonå­¦ä¹ 7ï¼šè¾“å…¥å’Œè¾“å‡º</title>
      <link>https://blog.chensoul.com/posts/2023/07/08/python-input-and-output/</link>
      <pubDate>Sat, 08 Jul 2023 10:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/07/08/python-input-and-output/</guid>
      <description>åœ¨ Python ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ input() å‡½æ•°ä»æ ‡å‡†è¾“å…¥è¯»å–ç”¨æˆ·è¾“å…¥çš„æ•°æ®ï¼Œå¹¶ä½¿ç”¨ print() å‡½æ•°å°†æ•°æ®è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„è¾“å…¥è¾“å‡ºæ–¹æ³•ï¼š 1ã€ä½¿ç”¨ input() å‡½æ•°è¯»å–ç”¨æˆ·è¾“</description>
      <content:encoded><![CDATA[<p>åœ¨ Python ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ input() å‡½æ•°ä»æ ‡å‡†è¾“å…¥è¯»å–ç”¨æˆ·è¾“å…¥çš„æ•°æ®ï¼Œå¹¶ä½¿ç”¨ print() å‡½æ•°å°†æ•°æ®è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„è¾“å…¥è¾“å‡ºæ–¹æ³•ï¼š</p>
<p>1ã€ä½¿ç”¨ input() å‡½æ•°è¯»å–ç”¨æˆ·è¾“å…¥</p>
<p>input() å‡½æ•°ä¼šä»æ ‡å‡†è¾“å…¥è¯»å–ç”¨æˆ·è¾“å…¥çš„æ•°æ®ï¼Œå¹¶è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å€¼ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;What&#39;s your name? &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Hello, &#34;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&#34;!&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ input() å‡½æ•°è¯»å–ç”¨æˆ·è¾“å…¥çš„å§“åï¼Œå¹¶ä½¿ç”¨ print() å‡½æ•°è¾“å‡ºé—®å€™è¯­ã€‚</p>
<p>2ã€ä½¿ç”¨ print() å‡½æ•°è¾“å‡ºå­—ç¬¦ä¸²</p>
<p>print() å‡½æ•°å¯ä»¥å°†å­—ç¬¦ä¸²è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚å¯ä»¥ä½¿ç”¨åŠ å·ï¼ˆ+ï¼‰å°†å¤šä¸ªå­—ç¬¦ä¸²è¿æ¥èµ·æ¥ï¼Œå¹¶ä½¿ç”¨é€—å·ï¼ˆ,ï¼‰å°†å¤šä¸ªå‚æ•°è¾“å‡ºåˆ°åŒä¸€è¡Œã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Hello, World!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;The answer is&#34;</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ print() å‡½æ•°è¾“å‡ºäº†ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œç¬¬äºŒä¸ªå­—ç¬¦ä¸²åŒ…å«äº†ä¸€ä¸ªæ•°å­—ã€‚</p>
<p>3ã€ä½¿ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²è¾“å‡ºæ•°æ®</p>
<p>å¯ä»¥ä½¿ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²å°†å˜é‡çš„å€¼æ’å…¥åˆ°å­—ç¬¦ä¸²ä¸­ã€‚å¯ä»¥ä½¿ç”¨èŠ±æ‹¬å·ï¼ˆ{}ï¼‰è¡¨ç¤ºå˜é‡çš„ä½ç½®ï¼Œå¹¶ä½¿ç”¨ format() æ–¹æ³•å°†å˜é‡çš„å€¼æ’å…¥åˆ°èŠ±æ‹¬å·ä¸­ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;Alice&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">age</span> <span class="o">=</span> <span class="mi">25</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;My name is </span><span class="si">{}</span><span class="s2"> and I&#39;m </span><span class="si">{}</span><span class="s2"> years old.&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">))</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ format() æ–¹æ³•å°†å˜é‡ name å’Œ age çš„å€¼æ’å…¥åˆ°å­—ç¬¦ä¸²ä¸­ã€‚</p>
<p>4ã€ä½¿ç”¨ f-å­—ç¬¦ä¸²è¾“å‡ºæ•°æ®</p>
<p>åœ¨ Python 3.6 åŠä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ f-å­—ç¬¦ä¸²æ¥æ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚f-å­—ç¬¦ä¸²æ˜¯ä¸€ç§ç‰¹æ®Šçš„å­—ç¬¦ä¸²ï¼Œä»¥å­—æ¯ f æˆ– F å¼€å¤´ï¼Œå¹¶ä»¥èŠ±æ‹¬å·è¡¨ç¤ºå˜é‡çš„ä½ç½®ã€‚åœ¨èŠ±æ‹¬å·ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨å˜é‡åï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼è®¡ç®—å˜é‡çš„å€¼ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;Bob&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">age</span> <span class="o">=</span> <span class="mi">32</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;My name is </span><span class="si">{</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2"> and I&#39;m </span><span class="si">{</span><span class="n">age</span> <span class="o">*</span> <span class="mi">2</span><span class="si">}</span><span class="s2"> years old.&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ f-å­—ç¬¦ä¸²å°†å˜é‡ name çš„å€¼è½¬æ¢ä¸ºå¤§å†™å­—æ¯ï¼Œå¹¶å°†å˜é‡ age çš„å€¼ä¹˜ä»¥ 2ã€‚</p>
<p>5ã€ä½¿ç”¨æ–‡ä»¶è¯»å†™æ•°æ®</p>
<p>Python æä¾›äº†å¤šç§æ–¹å¼è¯»å†™æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ open() å‡½æ•°æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ read()ã€write() å’Œ close() æ–¹æ³•è¯»å†™æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼š</p>
<p>livecodeserver</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># è¯»å–æ–‡ä»¶</span>
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;input.txt&#34;</span><span class="p">,</span> <span class="s2">&#34;r&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å†™å…¥æ–‡ä»¶</span>
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;output.txt&#34;</span><span class="p">,</span> <span class="s2">&#34;w&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&#34;Hello, World!&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ with è¯­å¥æ‰“å¼€æ–‡ä»¶å¹¶è¯»å–æˆ–å†™å…¥æ•°æ®ã€‚ä½¿ç”¨ &ldquo;r&rdquo; å‚æ•°è¡¨ç¤ºè¯»å–æ–‡ä»¶ï¼Œä½¿ç”¨ &ldquo;w&rdquo; å‚æ•°è¡¨ç¤ºå†™å…¥æ–‡ä»¶ã€‚ä½¿ç”¨ read() æ–¹æ³•è¯»å–æ–‡ä»¶å†…å®¹ï¼Œä½¿ç”¨ write() æ–¹æ³•å†™å…¥æ–‡ä»¶å†…å®¹ã€‚</p>
<p>6ã€ä½¿ç”¨æ ‡å‡†é”™è¯¯è¾“å‡ºé”™è¯¯ä¿¡æ¯</p>
<p>é™¤äº†ä½¿ç”¨ print() å‡½æ•°è¾“å‡ºå­—ç¬¦ä¸²åˆ°æ ‡å‡†è¾“å‡ºå¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨æ ‡å‡†é”™è¯¯å°†é”™è¯¯ä¿¡æ¯è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚å¯ä»¥ä½¿ç”¨ sys æ¨¡å—ä¸­çš„ stderr å±æ€§æ¥è¾“å‡ºé”™è¯¯ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&#34;Enter a number: &#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="mi">10</span> <span class="o">/</span> <span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Invalid input.&#34;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Cannot divide by zero.&#34;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ try-except è¯­å¥å¤„ç†è¾“å…¥é”™è¯¯å’Œé™¤ä»¥é›¶é”™è¯¯ï¼Œå¹¶ä½¿ç”¨ print() å‡½æ•°å°†é”™è¯¯ä¿¡æ¯è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯ã€‚</p>
<p>7ã€ä½¿ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„é«˜çº§ç‰¹æ€§</p>
<p>é™¤äº†ç®€å•çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„é«˜çº§ç‰¹æ€§æ¥æ ¼å¼åŒ–è¾“å‡ºã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ {name:width} æ ¼å¼æ¥æŒ‡å®šå­—ç¬¦ä¸²çš„å®½åº¦ï¼Œä½¿ç”¨ {name:.2f} æ ¼å¼æ¥æŒ‡å®šæµ®ç‚¹æ•°çš„å°æ•°ä½æ•°ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;Alice&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">age</span> <span class="o">=</span> <span class="mi">25</span>
</span></span><span class="line"><span class="cl"><span class="n">score</span> <span class="o">=</span> <span class="mf">85.1234</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="s1">&#39;Name:&#39;</span><span class="si">:</span><span class="s2">&lt;10</span><span class="si">}{</span><span class="n">name</span><span class="si">:</span><span class="s2">&gt;10</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="s1">&#39;Age:&#39;</span><span class="si">:</span><span class="s2">&lt;10</span><span class="si">}{</span><span class="n">age</span><span class="si">:</span><span class="s2">&gt;10</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="s1">&#39;Score:&#39;</span><span class="si">:</span><span class="s2">&lt;10</span><span class="si">}{</span><span class="n">score</span><span class="si">:</span><span class="s2">&gt;10.2f</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ f-å­—ç¬¦ä¸²å’Œ {} æ ¼å¼æŒ‡å®šå­—ç¬¦ä¸²çš„å®½åº¦å’Œå¯¹é½æ–¹å¼ï¼Œå¹¶ä½¿ç”¨ {:.2f} æ ¼å¼æŒ‡å®šæµ®ç‚¹æ•°çš„å°æ•°ä½æ•°ã€‚</p>
<p>8ã€ä½¿ç”¨ pprint æ¨¡å—ç¾åŒ–è¾“å‡º</p>
<p>pprint æ¨¡å—å¯ä»¥ç¾åŒ– Python æ•°æ®ç»“æ„çš„è¾“å‡ºï¼Œä»¥ä¾¿æ›´å¥½åœ°æŸ¥çœ‹å’Œè°ƒè¯•æ•°æ®ã€‚å¯ä»¥ä½¿ç”¨ pprint æ¨¡å—ä¸­çš„ pprint() å‡½æ•°å°†æ•°æ®ç»“æ„è¾“å‡ºä¸ºç¾åŒ–çš„æ ¼å¼ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pprint</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Alice&#34;</span><span class="p">,</span> <span class="s2">&#34;age&#34;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="s2">&#34;scores&#34;</span><span class="p">:</span> <span class="p">[</span><span class="mi">80</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">90</span><span class="p">]}</span>
</span></span><span class="line"><span class="cl"><span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ pprint.pprint() å‡½æ•°å°†æ•°æ®ç»“æ„ data è¾“å‡ºä¸ºç¾åŒ–çš„æ ¼å¼ã€‚</p>
<p>9ã€ä½¿ç”¨ logging æ¨¡å—è¾“å‡ºæ—¥å¿—ä¿¡æ¯</p>
<p>logging æ¨¡å—å¯ä»¥ç”¨äºè¾“å‡ºæ—¥å¿—ä¿¡æ¯ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç†è§£ç¨‹åºçš„è¿è¡ŒçŠ¶æ€å’Œé”™è¯¯ä¿¡æ¯ã€‚å¯ä»¥ä½¿ç”¨ logging æ¨¡å—ä¸­çš„ getLogger() æ–¹æ³•åˆ›å»º Logger å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨è¯¥å¯¹è±¡çš„ä¸åŒæ–¹æ³•è¾“å‡ºä¸åŒçº§åˆ«çš„æ—¥å¿—ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">logging</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> </span><span class="si">%(levelname)s</span><span class="s1"> </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">divide</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Dividing </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2"> by </span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">y</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&#34;Division by zero!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Result is </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">result</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ logging.basicConfig() æ–¹æ³•é…ç½®æ—¥å¿—çº§åˆ«å’Œæ ¼å¼ï¼Œä½¿ç”¨ getLogger() æ–¹æ³•åˆ›å»º Logger å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨ info()ã€error() ç­‰æ–¹æ³•è¾“å‡ºä¸åŒçº§åˆ«çš„æ—¥å¿—ä¿¡æ¯ã€‚</p>
<p>10ã€ä½¿ç”¨ traceback æ¨¡å—è¾“å‡ºå¼‚å¸¸ä¿¡æ¯</p>
<p>traceback æ¨¡å—å¯ä»¥ç”¨äºè¾“å‡ºå¼‚å¸¸ä¿¡æ¯ï¼Œä»¥ä¾¿æ›´å¥½åœ°å®šä½å’Œè§£å†³ç¨‹åºé”™è¯¯ã€‚å¯ä»¥ä½¿ç”¨ traceback æ¨¡å—ä¸­çš„ print_exc() å‡½æ•°è¾“å‡ºå¼‚å¸¸ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">traceback</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&#34;Enter a number: &#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="mi">10</span> <span class="o">/</span> <span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ try-except è¯­å¥æ•è·æ‰€æœ‰å¼‚å¸¸ï¼Œå¹¶ä½¿ç”¨ traceback.print_exc() å‡½æ•°è¾“å‡ºå¼‚å¸¸ä¿¡æ¯ã€‚</p>
<p>11ã€ä½¿ç”¨ cProfile æ¨¡å—åˆ†æç¨‹åºæ€§èƒ½</p>
<p>cProfile æ¨¡å—å¯ä»¥ç”¨äºåˆ†æç¨‹åºçš„æ€§èƒ½ï¼Œä»¥ä¾¿æ›´å¥½åœ°ä¼˜åŒ–ç¨‹åºè¿è¡Œæ•ˆç‡ã€‚å¯ä»¥ä½¿ç”¨ cProfile æ¨¡å—ä¸­çš„ run() æ–¹æ³•åˆ†æç¨‹åºæ€§èƒ½ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">cProfile</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å®šä¹‰ç¨‹åº</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">k</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">j</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åˆ†æç¨‹åºæ€§èƒ½</span>
</span></span><span class="line"><span class="cl"><span class="n">cProfile</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="s1">&#39;func()&#39;</span><span class="p">)</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå®šä¹‰ä¸€ä¸ªç¨‹åº func() è¿›è¡Œè®¡ç®—ï¼Œä½¿ç”¨ cProfile.run() æ–¹æ³•åˆ†æç¨‹åºæ€§èƒ½ã€‚</p>
<p>12ã€ä½¿ç”¨ argparse æ¨¡å—è§£æå‘½ä»¤è¡Œå‚æ•°</p>
<p>argparse æ¨¡å—å¯ä»¥ç”¨äºè§£æå‘½ä»¤è¡Œå‚æ•°ï¼Œä»¥ä¾¿æ›´å¥½åœ°æ§åˆ¶ç¨‹åºçš„è¡Œä¸ºå’Œè¾“å…¥è¾“å‡ºã€‚å¯ä»¥ä½¿ç”¨ argparse æ¨¡å—ä¸­çš„ ArgumentParser ç±»åˆ›å»ºè§£æå™¨å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨è¯¥å¯¹è±¡çš„ add_argument() æ–¹æ³•æ·»åŠ å‘½ä»¤è¡Œå‚æ•°ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">argparse</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Process some integers.&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;integers&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;an integer for the accumulator&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--sum&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;accumulate&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_const&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">const</span><span class="o">=</span><span class="nb">sum</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">max</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;sum the integers (default: find the max)&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">accumulate</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">integers</span><span class="p">))</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ ArgumentParser ç±»åˆ›å»ºè§£æå™¨å¯¹è±¡ï¼Œä½¿ç”¨ add_argument() æ–¹æ³•æ·»åŠ å‘½ä»¤è¡Œå‚æ•°ï¼Œä½¿ç”¨ parse_args() æ–¹æ³•è§£æå‘½ä»¤è¡Œå‚æ•°ï¼Œå¹¶ä½¿ç”¨ argparse.Namespace å¯¹è±¡è®¿é—®è§£æç»“æœã€‚</p>
<p>13ã€ä½¿ç”¨ pprint æ¨¡å—è¾“å‡ºå¯¹è±¡ä¿¡æ¯</p>
<p>pprint æ¨¡å—å¯ä»¥ç”¨äºè¾“å‡º Python å¯¹è±¡çš„ä¿¡æ¯ï¼Œä»¥ä¾¿æ›´å¥½åœ°æŸ¥çœ‹å’Œè°ƒè¯•å¯¹è±¡ã€‚å¯ä»¥ä½¿ç”¨ pprint æ¨¡å—ä¸­çš„ pprint() å‡½æ•°å°†å¯¹è±¡è¾“å‡ºä¸ºç¾åŒ–çš„æ ¼å¼ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pprint</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&#34;Person(name=&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;, age=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="si">}</span><span class="s2">)&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">person</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s2">&#34;Alice&#34;</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">pprint</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ pprint.pprint() å‡½æ•°å°†å¯¹è±¡ person è¾“å‡ºä¸ºç¾åŒ–çš„æ ¼å¼ï¼Œä½¿ç”¨ <strong>repr</strong>() æ–¹æ³•å®šä¹‰å¯¹è±¡çš„è¡¨ç¤ºå½¢å¼ã€‚</p>
<p>14ã€ä½¿ç”¨ csv æ¨¡å—è¯»å†™ CSV æ–‡ä»¶</p>
<p>csv æ¨¡å—å¯ä»¥ç”¨äºè¯»å†™ CSV æ–‡ä»¶ï¼Œä»¥ä¾¿æ›´å¥½åœ°å¤„ç†è¡¨æ ¼æ•°æ®ã€‚å¯ä»¥ä½¿ç”¨ csv æ¨¡å—ä¸­çš„ reader() å’Œ writer() å‡½æ•°è¯»å†™ CSV æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">csv</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¯»å– CSV æ–‡ä»¶</span>
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;data.csv&#34;</span><span class="p">,</span> <span class="s2">&#34;r&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å†™å…¥ CSV æ–‡ä»¶</span>
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;data.csv&#34;</span><span class="p">,</span> <span class="s2">&#34;w&#34;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&#34;&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s2">&#34;Name&#34;</span><span class="p">,</span> <span class="s2">&#34;Age&#34;</span><span class="p">,</span> <span class="s2">&#34;Score&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s2">&#34;Alice&#34;</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">85</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s2">&#34;Bob&#34;</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">90</span><span class="p">])</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ csv.reader() å‡½æ•°è¯»å– CSV æ–‡ä»¶ï¼Œä½¿ç”¨ csv.writer() å‡½æ•°å†™å…¥ CSV æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ newline=&quot;&quot; å‚æ•°æŒ‡å®šè¡Œç»“æŸç¬¦ã€‚</p>
<p>15ã€ä½¿ç”¨ json æ¨¡å—è¯»å†™ JSON æ•°æ®</p>
<p>json æ¨¡å—å¯ä»¥ç”¨äºè¯»å†™ JSON æ•°æ®ï¼Œä»¥ä¾¿æ›´å¥½åœ°å¤„ç†æ•°æ®äº¤æ¢å’Œå­˜å‚¨ã€‚å¯ä»¥ä½¿ç”¨ json æ¨¡å—ä¸­çš„ loads() å’Œ dumps() å‡½æ•°è¯»å†™ JSON æ•°æ®ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¯»å– JSON æ•°æ®</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;{&#34;name&#34;: &#34;Alice&#34;, &#34;age&#34;: 25, &#34;scores&#34;: [80, 85, 90]}&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å†™å…¥ JSON æ•°æ®</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Bob&#34;</span><span class="p">,</span> <span class="s2">&#34;age&#34;</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span> <span class="s2">&#34;scores&#34;</span><span class="p">:</span> <span class="p">[</span><span class="mi">90</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">100</span><span class="p">]}</span>
</span></span><span class="line"><span class="cl"><span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ json.loads() å‡½æ•°è¯»å– JSON æ•°æ®ï¼Œä½¿ç”¨ json.dumps() å‡½æ•°å†™å…¥ JSON æ•°æ®ã€‚</p>
<p>16ã€ä½¿ç”¨ xml.etree.ElementTree æ¨¡å—è¯»å†™ XML æ•°æ®</p>
<p>xml.etree.ElementTree æ¨¡å—å¯ä»¥ç”¨äºè¯»å†™ XML æ•°æ®ï¼Œä»¥ä¾¿æ›´å¥½åœ°å¤„ç†æ•°æ®äº¤æ¢å’Œå­˜å‚¨ã€‚å¯ä»¥ä½¿ç”¨ xml.etree.ElementTree æ¨¡å—ä¸­çš„ ElementTree ç±»å’Œ Element ç±»è¯»å†™ XML æ•°æ®ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="k">as</span> <span class="nn">ET</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¯»å– XML æ•°æ®</span>
</span></span><span class="line"><span class="cl"><span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&#34;data.xml&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">attrib</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å†™å…¥ XML æ•°æ®</span>
</span></span><span class="line"><span class="cl"><span class="n">root</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&#34;data&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">child1</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s2">&#34;name&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">child1</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&#34;Alice&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">child2</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="s2">&#34;age&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">child2</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&#34;25&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">tree</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">ElementTree</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">tree</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&#34;data.xml&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ ET.parse() æ–¹æ³•è¯»å– XML æ–‡ä»¶ï¼Œä½¿ç”¨ Element å¯¹è±¡å’Œ SubElement() æ–¹æ³•åˆ›å»º XML å…ƒç´ ï¼Œä½¿ç”¨ ElementTree å¯¹è±¡å’Œ write() æ–¹æ³•å†™å…¥ XML æ–‡ä»¶ã€‚</p>
<p>17ã€ä½¿ç”¨ sqlite3 æ¨¡å—è¯»å†™ SQLite æ•°æ®åº“</p>
<p>sqlite3 æ¨¡å—å¯ä»¥ç”¨äºè¯»å†™ SQLite æ•°æ®åº“ï¼Œä»¥ä¾¿æ›´å¥½åœ°æŒä¹…åŒ–æ•°æ®ã€‚å¯ä»¥ä½¿ç”¨ sqlite3 æ¨¡å—ä¸­çš„ connect() å’Œ cursor() æ–¹æ³•è¿æ¥æ•°æ®åº“å’Œæ‰§è¡Œ SQL è¯­å¥ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sqlite3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¿æ¥æ•°æ®åº“</span>
</span></span><span class="line"><span class="cl"><span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&#34;data.db&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åˆ›å»ºè¡¨æ ¼</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;CREATE TABLE IF NOT EXISTS students
</span></span></span><span class="line"><span class="cl"><span class="s1">             (id INTEGER PRIMARY KEY, name TEXT, age INTEGER, score REAL)&#39;&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ’å…¥æ•°æ®</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&#34;INSERT INTO students (name, age, score) VALUES (?, ?, ?)&#34;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&#34;Alice&#34;</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">85</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&#34;INSERT INTO students (name, age, score) VALUES (?, ?, ?)&#34;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&#34;Bob&#34;</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">90</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æŸ¥è¯¢æ•°æ®</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&#34;SELECT * FROM students&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">rows</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å…³é—­æ•°æ®åº“</span>
</span></span><span class="line"><span class="cl"><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ sqlite3.connect() æ–¹æ³•è¿æ¥æ•°æ®åº“ï¼Œä½¿ç”¨ cursor() æ–¹æ³•æ‰§è¡Œ SQL è¯­å¥ï¼Œä½¿ç”¨ fetchall() æ–¹æ³•è·å–æŸ¥è¯¢ç»“æœï¼Œä½¿ç”¨ commit() æ–¹æ³•æäº¤äº‹åŠ¡å¹¶å…³é—­æ•°æ®åº“ã€‚</p>
<p>18ã€ä½¿ç”¨ Pillow æ¨¡å—è¯»å†™å›¾ç‰‡æ–‡ä»¶</p>
<p>Pillow æ¨¡å—å¯ä»¥ç”¨äºè¯»å†™å›¾ç‰‡æ–‡ä»¶ï¼Œä»¥ä¾¿æ›´å¥½åœ°å¤„ç†å›¾åƒæ•°æ®ã€‚å¯ä»¥ä½¿ç”¨ Pillow æ¨¡å—ä¸­çš„ Image ç±»è¯»å†™å›¾ç‰‡æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¯»å–å›¾ç‰‡æ–‡ä»¶</span>
</span></span><span class="line"><span class="cl"><span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&#34;image.jpg&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="n">im</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">im</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ˜¾ç¤ºå›¾ç‰‡</span>
</span></span><span class="line"><span class="cl"><span class="n">im</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ä¿å­˜å›¾ç‰‡æ–‡ä»¶</span>
</span></span><span class="line"><span class="cl"><span class="n">im</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&#34;image.png&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ Image.open() æ–¹æ³•è¯»å–å›¾ç‰‡æ–‡ä»¶ï¼Œä½¿ç”¨ formatã€size å’Œ mode å±æ€§è·å–å›¾ç‰‡ä¿¡æ¯ï¼Œä½¿ç”¨ show() æ–¹æ³•æ˜¾ç¤ºå›¾ç‰‡ï¼Œä½¿ç”¨ save() æ–¹æ³•ä¿å­˜å›¾ç‰‡æ–‡ä»¶ã€‚</p>
<p>19ã€ä½¿ç”¨ matplotlib æ¨¡å—ç»˜åˆ¶å›¾è¡¨</p>
<p>matplotlib æ¨¡å—å¯ä»¥ç”¨äºç»˜åˆ¶å„ç§ç±»å‹çš„å›¾è¡¨ï¼Œä»¥ä¾¿æ›´å¥½åœ°å±•ç¤ºæ•°æ®åˆ†å¸ƒå’Œè¶‹åŠ¿ã€‚å¯ä»¥ä½¿ç”¨ matplotlib æ¨¡å—ä¸­çš„ pyplot æ¨¡å—ç»˜åˆ¶å›¾è¡¨ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ç»˜åˆ¶æŠ˜çº¿å›¾</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">25</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&#34;X Label&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&#34;Y Label&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;Line Chart&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ç»˜åˆ¶æŸ±çŠ¶å›¾</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;Apple&#34;</span><span class="p">,</span> <span class="s2">&#34;Banana&#34;</span><span class="p">,</span> <span class="s2">&#34;Orange&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">70</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&#34;Fruit&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&#34;Quantity&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&#34;Bar Chart&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ plt.plot() æ–¹æ³•ç»˜åˆ¶æŠ˜çº¿å›¾ï¼Œä½¿ç”¨ plt.bar() æ–¹æ³•ç»˜åˆ¶æŸ±çŠ¶å›¾ï¼Œä½¿ç”¨ xlabelã€ylabel å’Œ title æ–¹æ³•è®¾ç½®å›¾è¡¨æ ‡ç­¾ï¼Œä½¿ç”¨ show() æ–¹æ³•æ˜¾ç¤ºå›¾è¡¨ã€‚</p>
<p>20ã€ä½¿ç”¨ Pygame æ¨¡å—ç»˜åˆ¶æ¸¸æˆç•Œé¢</p>
<p>Pygame æ¨¡å—å¯ä»¥ç”¨äºç»˜åˆ¶æ¸¸æˆç•Œé¢ï¼Œä»¥ä¾¿æ›´å¥½åœ°å®ç°æ¸¸æˆåŠŸèƒ½ã€‚å¯ä»¥ä½¿ç”¨ Pygame æ¨¡å—ä¸­çš„å„ç§ç±»å’Œæ–¹æ³•ç»˜åˆ¶æ¸¸æˆç•Œé¢å’Œå¤„ç†æ¸¸æˆäº‹ä»¶ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pygame</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åˆå§‹åŒ– Pygame</span>
</span></span><span class="line"><span class="cl"><span class="n">pygame</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åˆ›å»ºæ¸¸æˆçª—å£</span>
</span></span><span class="line"><span class="cl"><span class="n">screen</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">((</span><span class="mi">400</span><span class="p">,</span> <span class="mi">300</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s2">&#34;My Game&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åˆ›å»ºæ¸¸æˆå¾ªç¯</span>
</span></span><span class="line"><span class="cl"><span class="n">running</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="n">running</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># å¤„ç†æ¸¸æˆäº‹ä»¶</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">pygame</span><span class="o">.</span><span class="n">QUIT</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># ç»˜åˆ¶æ¸¸æˆç•Œé¢</span>
</span></span><span class="line"><span class="cl">    <span class="n">screen</span><span class="o">.</span><span class="n">fill</span><span class="p">((</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">pygame</span><span class="o">.</span><span class="n">draw</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">150</span><span class="p">),</span> <span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># é€€å‡º Pygame</span>
</span></span><span class="line"><span class="cl"><span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ pygame.init() åˆå§‹åŒ– Pygameï¼Œä½¿ç”¨ pygame.display.set_mode() åˆ›å»ºæ¸¸æˆçª—å£ï¼Œä½¿ç”¨ pygame.event.get() å¤„ç†æ¸¸æˆäº‹ä»¶ï¼Œä½¿ç”¨ pygame.draw.circle() ç»˜åˆ¶æ¸¸æˆç•Œé¢ï¼Œä½¿ç”¨ pygame.display.update() æ›´æ–°æ¸¸æˆç•Œé¢ï¼Œä½¿ç”¨ pygame.quit() é€€å‡º Pygameã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>Pythonå­¦ä¹ 6ï¼šæ¨¡å—å’ŒåŒ…</title>
      <link>https://blog.chensoul.com/posts/2023/07/06/python-module-package/</link>
      <pubDate>Thu, 06 Jul 2023 10:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/07/06/python-module-package/</guid>
      <description>åœ¨ Python ä¸­ï¼Œæ¨¡å—ï¼ˆmoduleï¼‰æ˜¯æŒ‡ä¸€ä¸ªåŒ…å« Python ä»£ç çš„æ–‡ä»¶ï¼Œè€ŒåŒ…ï¼ˆpackageï¼‰åˆ™æ˜¯æŒ‡ä¸€ä¸ªåŒ…å«å¤šä¸ªæ¨¡å—çš„æ–‡ä»¶å¤¹ã€‚æ¨¡å—å’ŒåŒ…å¯ä»¥ç”¨æ¥ç»„ç»‡å’Œç®¡ç† Python ä»£ç </description>
      <content:encoded><![CDATA[<p>åœ¨ Python ä¸­ï¼Œæ¨¡å—ï¼ˆmoduleï¼‰æ˜¯æŒ‡ä¸€ä¸ªåŒ…å« Python ä»£ç çš„æ–‡ä»¶ï¼Œè€ŒåŒ…ï¼ˆpackageï¼‰åˆ™æ˜¯æŒ‡ä¸€ä¸ªåŒ…å«å¤šä¸ªæ¨¡å—çš„æ–‡ä»¶å¤¹ã€‚æ¨¡å—å’ŒåŒ…å¯ä»¥ç”¨æ¥ç»„ç»‡å’Œç®¡ç† Python ä»£ç ï¼Œä½¿å¾—ä»£ç æ›´åŠ æ˜“äºç»´æŠ¤å’Œæ‰©å±•ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›æœ‰å…³ Python æ¨¡å—å’ŒåŒ…çš„åŸºæœ¬çŸ¥è¯†ï¼š</p>
<p>1ã€å¯¼å…¥æ¨¡å—</p>
<p>ä½¿ç”¨ import è¯­å¥å¯ä»¥å¯¼å…¥ä¸€ä¸ªæ¨¡å—ï¼ˆæˆ–åŒ…ï¼‰ä¸­çš„ä»£ç ã€‚ä¾‹å¦‚ï¼Œè¦å¯¼å…¥åä¸º &ldquo;math&rdquo; çš„æ¨¡å—ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­å¥ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">math</span>
</span></span></code></pre></div><p>è¿™ä¼šå°† math æ¨¡å—ä¸­çš„æ‰€æœ‰å‡½æ•°å’Œå˜é‡å¯¼å…¥åˆ°å½“å‰ Python è„šæœ¬ä¸­ï¼Œæ‚¨å°±å¯ä»¥åœ¨è„šæœ¬ä¸­ä½¿ç”¨ math æ¨¡å—ä¸­çš„å‡½æ•°å’Œå˜é‡äº†ã€‚</p>
<p>2ã€å¯¼å…¥ç‰¹å®šå‡½æ•°æˆ–å˜é‡</p>
<p>æœ‰æ—¶å€™æ‚¨åªéœ€è¦ä½¿ç”¨æ¨¡å—ä¸­çš„æŸä¸ªå‡½æ•°æˆ–å˜é‡ï¼Œè€Œä¸éœ€è¦å¯¼å…¥æ•´ä¸ªæ¨¡å—ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ from&hellip;import è¯­å¥ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span>
</span></span></code></pre></div><p>è¿™ä¼šå°† math æ¨¡å—ä¸­çš„ sqrt å‡½æ•°å¯¼å…¥åˆ°å½“å‰ Python è„šæœ¬ä¸­ï¼Œæ‚¨å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ sqrt å‡½æ•°äº†ã€‚</p>
<p>3ã€å¯¼å…¥å¤šä¸ªå‡½æ•°æˆ–å˜é‡</p>
<p>å¦‚æœæ‚¨éœ€è¦å¯¼å…¥å¤šä¸ªå‡½æ•°æˆ–å˜é‡ï¼Œå¯ä»¥ä½¿ç”¨é€—å·åˆ†éš”å®ƒä»¬ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">floor</span>
</span></span></code></pre></div><p>è¿™ä¼šå°† math æ¨¡å—ä¸­çš„ sqrt å‡½æ•°å’Œ floor å‡½æ•°å¯¼å…¥åˆ°å½“å‰ Python è„šæœ¬ä¸­ï¼Œæ‚¨å°±å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸¤ä¸ªå‡½æ•°äº†ã€‚</p>
<p>4ã€å¯¼å…¥æ‰€æœ‰å‡½æ•°å’Œå˜é‡</p>
<p>æœ‰æ—¶å€™ï¼Œæ‚¨å¯èƒ½éœ€è¦å¯¼å…¥æ¨¡å—ä¸­çš„æ‰€æœ‰å‡½æ•°å’Œå˜é‡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­å¥ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="o">*</span>
</span></span></code></pre></div><p>è¿™ä¼šå°† math æ¨¡å—ä¸­çš„æ‰€æœ‰å‡½æ•°å’Œå˜é‡å¯¼å…¥åˆ°å½“å‰ Python è„šæœ¬ä¸­ã€‚ä½†æ˜¯ï¼Œè¿™ç§å¯¼å…¥æ–¹å¼å¯èƒ½ä¼šå¯¼è‡´å‘½åå†²çªå’Œä»£ç å¯è¯»æ€§é™ä½ï¼Œå› æ­¤æœ€å¥½åªåœ¨ä¸€äº›å°å‹ç¨‹åºä¸­ä½¿ç”¨ã€‚</p>
<p>5ã€åˆ›å»ºåŒ…</p>
<p>è¦åˆ›å»ºä¸€ä¸ªåŒ…ï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªåŒ…å« <strong>init</strong>.py æ–‡ä»¶çš„æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨è¯¥æ–‡ä»¶å¤¹ä¸­æ·»åŠ å…¶ä»– Python æ¨¡å—ã€‚<strong>init</strong>.py æ–‡ä»¶å¯ä»¥æ˜¯ä¸€ä¸ªç©ºæ–‡ä»¶ï¼Œæˆ–è€…åŒ…å«ä¸€äº›åˆå§‹åŒ–ä»£ç ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³åˆ›å»ºä¸€ä¸ªåä¸º &ldquo;my_package&rdquo; çš„åŒ…ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ–¹å¼ç»„ç»‡ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_package</span><span class="o">/</span>
</span></span><span class="line"><span class="cl">    <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
</span></span><span class="line"><span class="cl">    <span class="n">module1</span><span class="o">.</span><span class="n">py</span>
</span></span><span class="line"><span class="cl">    <span class="n">module2</span><span class="o">.</span><span class="n">py</span>
</span></span></code></pre></div><p>è¿™ä¸ªåŒ…åŒ…å«äº† <strong>init</strong>.py æ–‡ä»¶å’Œä¸¤ä¸ªæ¨¡å—ï¼ˆmodule1.py å’Œ module2.pyï¼‰ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ import è¯­å¥æ¥å¯¼å…¥è¿™ä¸ªåŒ…ä¸­çš„æ¨¡å—ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">my_package.module1</span>
</span></span></code></pre></div><p>è¿™ä¼šå°† my_package åŒ…ä¸­çš„ module1.py æ–‡ä»¶å¯¼å…¥åˆ°å½“å‰ Python è„šæœ¬ä¸­ï¼Œæ‚¨å°±å¯ä»¥ä½¿ç”¨å…¶ä¸­å®šä¹‰çš„å‡½æ•°å’Œå˜é‡äº†ã€‚</p>
<p>6ã€å¯¼å…¥è‡ªå®šä¹‰æ¨¡å—</p>
<p>å¦‚æœæ‚¨æƒ³å¯¼å…¥è‡ªå·±ç¼–å†™çš„æ¨¡å—ï¼Œå¯ä»¥å°†æ¨¡å—æ–‡ä»¶ä¿å­˜åœ¨æ‚¨çš„ Python è„šæœ¬æ‰€åœ¨çš„ç›®å½•ä¸­ï¼Œç„¶åä½¿ç”¨ import è¯­å¥å¯¼å…¥æ¨¡å—ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„æ¨¡å—æ–‡ä»¶åä¸º &ldquo;mymodule.py&rdquo;ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­å¥å¯¼å…¥æ¨¡å—ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">mymodule</span>
</span></span></code></pre></div><p>å¦‚æœæ‚¨çš„æ¨¡å—æ–‡ä»¶ä¸åœ¨ Python è„šæœ¬æ‰€åœ¨çš„ç›®å½•ä¸­ï¼Œæ‚¨éœ€è¦å°†æ¨¡å—æ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„æ·»åŠ åˆ° sys.path åˆ—è¡¨ä¸­ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl"><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;/path/to/mymodule/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">mymodule</span>
</span></span></code></pre></div><p>7ã€åŒ…çš„ç›¸å¯¹å¯¼å…¥</p>
<p>åœ¨ä¸€ä¸ªåŒ…ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ç›¸å¯¹å¯¼å…¥æ¥å¯¼å…¥å…¶ä»–æ¨¡å—ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨åœ¨ my_package åŒ…ä¸­çš„ module1.py ä¸­æƒ³è¦å¯¼å…¥ my_package åŒ…ä¸­çš„ module2.pyï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­å¥ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">module2</span>
</span></span></code></pre></div><p>è¿™é‡Œçš„ &ldquo;.&rdquo; è¡¨ç¤ºå½“å‰åŒ…ï¼Œ&quot;.&quot; åé¢çš„ module2 è¡¨ç¤ºè¦å¯¼å…¥çš„æ¨¡å—ã€‚</p>
<p>8ã€åŒ…çš„å‘½åç©ºé—´</p>
<p>åœ¨ä¸€ä¸ªåŒ…ä¸­ï¼Œå¤šä¸ªæ¨¡å—å¯èƒ½ä¼šå®šä¹‰ç›¸åŒçš„å‡½æ•°æˆ–å˜é‡åï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´å‘½åå†²çªã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼ŒPython ä½¿ç”¨åŒ…çš„å‘½åç©ºé—´æ¥åŒºåˆ†ä¸åŒæ¨¡å—ä¸­çš„å‡½æ•°å’Œå˜é‡ã€‚å½“æ‚¨å¯¼å…¥ä¸€ä¸ªåŒ…æ—¶ï¼Œåªæœ‰åŒ…ä¸­çš„æ¨¡å—æ‰ä¼šè¢«å¯¼å…¥åˆ°å‘½åç©ºé—´ä¸­ã€‚è¿™æ„å‘³ç€æ‚¨éœ€è¦ä½¿ç”¨æ¨¡å—åç§°æ¥è®¿é—®å…¶ä¸­çš„å‡½æ•°å’Œå˜é‡ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">my_package.module1</span>
</span></span><span class="line"><span class="cl"><span class="n">my_package</span><span class="o">.</span><span class="n">module1</span><span class="o">.</span><span class="n">my_function</span><span class="p">()</span>
</span></span></code></pre></div><p>è¿™é‡Œçš„ my_function() æ˜¯ my_package åŒ…ä¸­çš„ module1.py æ¨¡å—ä¸­çš„ä¸€ä¸ªå‡½æ•°ã€‚</p>
<p>9ã€åœ¨æ¨¡å—ä¸­å®šä¹‰å˜é‡</p>
<p>åœ¨ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œæ‚¨å¯ä»¥å®šä¹‰å…¨å±€å˜é‡ï¼Œè¿™äº›å˜é‡å¯ä»¥åœ¨æ¨¡å—ä¸­çš„å…¶ä»–å‡½æ•°ä¸­ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># module1.py</span>
</span></span><span class="line"><span class="cl"><span class="n">my_variable</span> <span class="o">=</span> <span class="mi">42</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">my_function</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">my_variable</span><span class="p">)</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œmy_variable æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå¯ä»¥åœ¨æ¨¡å—ä¸­çš„ä»»ä½•å‡½æ•°ä¸­ä½¿ç”¨ã€‚</p>
<p>10ã€ä½¿ç”¨ <strong>name</strong> å˜é‡</p>
<p>åœ¨ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <strong>name</strong> å˜é‡æ¥åˆ¤æ–­è¯¥æ¨¡å—æ˜¯è¢«å¯¼å…¥è¿˜æ˜¯ç›´æ¥è¿è¡Œã€‚ä¾‹å¦‚ï¼š</p>
<p>Copy</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># module1.py</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">my_function</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Hello, world!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">my_function</span><span class="p">()</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¦‚æœæ‚¨ç›´æ¥è¿è¡Œ module1.pyï¼Œå°†ä¼šæ‰§è¡Œ my_function() å‡½æ•°ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨åœ¨å…¶ä»– Python è„šæœ¬ä¸­å¯¼å…¥äº† module1.pyï¼Œmy_function() å‡½æ•°ä¸ä¼šè¢«æ‰§è¡Œã€‚</p>
<p>11ã€æ¨¡å—çš„æ–‡æ¡£å­—ç¬¦ä¸²</p>
<p>åœ¨ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ–‡æ¡£å­—ç¬¦ä¸²æ¥æè¿°æ¨¡å—çš„åŠŸèƒ½å’Œä½¿ç”¨æ–¹æ³•ã€‚æ–‡æ¡£å­—ç¬¦ä¸²æ˜¯æ”¾ç½®åœ¨æ¨¡å—å¼€å¤´çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥é€šè¿‡æ¨¡å—çš„ <strong>doc</strong> å±æ€§è®¿é—®ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># module1.py</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">è¿™æ˜¯ä¸€ä¸ªæ¼”ç¤ºæ¨¡å—çš„ç¤ºä¾‹ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">è¯¥æ¨¡å—åŒ…å«äº†ä¸€ä¸ªåä¸º my_function() çš„å‡½æ•°ï¼Œå¯ä»¥è¾“å‡ºä¸€æ¡ç®€å•çš„ä¿¡æ¯ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">my_function</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    è¯¥å‡½æ•°å¯ä»¥è¾“å‡ºä¸€æ¡ç®€å•çš„ä¿¡æ¯ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Hello, world!&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ¨¡å—çš„æ–‡æ¡£å­—ç¬¦ä¸²ç”¨ä¸‰é‡åŒå¼•å·æ‹¬èµ·æ¥ï¼Œå¹¶æè¿°äº†æ¨¡å—çš„åŠŸèƒ½å’Œä½¿ç”¨æ–¹æ³•ã€‚å‡½æ•° my_function() çš„æ–‡æ¡£å­—ç¬¦ä¸²ç”¨ä¸‰é‡åŒå¼•å·æ‹¬èµ·æ¥ï¼Œå¹¶æè¿°äº†è¯¥å‡½æ•°çš„åŠŸèƒ½å’Œä½¿ç”¨æ–¹æ³•ã€‚</p>
<p>12ã€ä½¿ç”¨ <strong>init</strong>.py æ–‡ä»¶</p>
<p>åœ¨ä¸€ä¸ªåŒ…ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <strong>init</strong>.py æ–‡ä»¶æ¥æ‰§è¡Œåˆå§‹åŒ–ä»£ç ï¼Œä¹Ÿå¯ä»¥åœ¨å…¶ä¸­å®šä¹‰åŒ…çº§åˆ«çš„å˜é‡å’Œå‡½æ•°ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># my_package/__init__.py</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;my_package å·²è¢«å¯¼å…¥&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">my_variable</span> <span class="o">=</span> <span class="mi">42</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">my_function</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;my_function å·²è¢«è°ƒç”¨&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå½“æ‚¨å¯¼å…¥ my_package åŒ…æ—¶ï¼Œå°†ä¼šæ‰§è¡Œ <strong>init</strong>.py æ–‡ä»¶ä¸­çš„ä»£ç ï¼Œè¾“å‡º &ldquo;my_package å·²è¢«å¯¼å…¥&rdquo;ã€‚æ‚¨è¿˜å¯ä»¥åœ¨ <strong>init</strong>.py æ–‡ä»¶ä¸­å®šä¹‰å…¨å±€å˜é‡å’Œå‡½æ•°ï¼Œè¿™äº›å˜é‡å’Œå‡½æ•°å¯ä»¥åœ¨åŒ…ä¸­çš„å…¶ä»–æ¨¡å—ä¸­ä½¿ç”¨ã€‚</p>
<p>13ã€ä½¿ç”¨ <strong>all</strong> å˜é‡</p>
<p>åœ¨ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œå¦‚æœæ‚¨æƒ³æ˜ç¡®å¯¼å‡ºå“ªäº›å‡½æ•°å’Œå˜é‡ï¼Œå¯ä»¥ä½¿ç”¨ <strong>all</strong> å˜é‡ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># module1.py</span>
</span></span><span class="line"><span class="cl"><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;my_function&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">my_function</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;my_function å·²è¢«è°ƒç”¨&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">my_private_function</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;my_private_function å·²è¢«è°ƒç”¨&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<strong>all</strong> å˜é‡æŒ‡å®šäº†è¦å¯¼å‡ºçš„å‡½æ•°åç§°ï¼Œè¿™é‡Œåªå¯¼å‡ºäº† my_function()ã€‚å¦‚æœæ‚¨åœ¨å…¶ä»– Python è„šæœ¬ä¸­å¯¼å…¥äº† module1.pyï¼Œåªæœ‰ my_function() å‡½æ•°ä¼šè¢«å¯¼å…¥åˆ°å½“å‰å‘½åç©ºé—´ä¸­ã€‚</p>
<p>14ã€ä½¿ç”¨ setup.py æ–‡ä»¶</p>
<p>å¦‚æœæ‚¨æƒ³å°†è‡ªå·±ç¼–å†™çš„ Python æ¨¡å—æˆ–åŒ…å‘å¸ƒåˆ° PyPIï¼ˆPython Package Indexï¼‰ä¸Šï¼Œå¯ä»¥ä½¿ç”¨ setup.py æ–‡ä»¶æ¥æ„å»ºå’Œæ‰“åŒ…æ‚¨çš„ä»£ç ã€‚setup.py æ–‡ä»¶é€šå¸¸åŒ…å«ä¸€äº›å…ƒæ•°æ®ï¼ˆä¾‹å¦‚æ¨¡å—åç§°ã€ç‰ˆæœ¬å·ã€ä½œè€…ã€è®¸å¯è¯ç­‰ï¼‰å’Œæ„å»ºè„šæœ¬ï¼Œå¯ä»¥ä½¿ç”¨ setuptools æˆ– distutils æ¨¡å—æ‰§è¡Œæ„å»ºå’Œæ‰“åŒ…æ“ä½œã€‚</p>
<p>15ã€å¸¸ç”¨çš„ Python æ¨¡å—å’ŒåŒ…</p>
<p>Python æ ‡å‡†åº“ä¸­åŒ…å«äº†è®¸å¤šæœ‰ç”¨çš„æ¨¡å—å’ŒåŒ…ï¼Œå¯ä»¥å¸®åŠ©æ‚¨å®Œæˆå„ç§ä»»åŠ¡ï¼Œä¾‹å¦‚å¤„ç†æ–‡ä»¶ã€ç½‘ç»œç¼–ç¨‹ã€æ—¥æœŸå’Œæ—¶é—´å¤„ç†ã€æ•°å­¦è®¡ç®—ç­‰ã€‚ä¸€äº›å¸¸ç”¨çš„ Python æ¨¡å—å’ŒåŒ…åŒ…æ‹¬ï¼š</p>
<ul>
<li>osï¼šæä¾›äº†è®¸å¤šä¸æ“ä½œç³»ç»Ÿäº¤äº’çš„å‡½æ•°å’Œå˜é‡ã€‚</li>
<li>sysï¼šæä¾›äº†ä¸€äº›ä¸ Python è§£é‡Šå™¨äº¤äº’çš„å‡½æ•°å’Œå˜é‡ã€‚</li>
<li>datetimeï¼šæä¾›äº†æ—¥æœŸå’Œæ—¶é—´å¤„ç†åŠŸèƒ½ã€‚</li>
<li>mathï¼šæä¾›äº†æ•°å­¦è®¡ç®—å‡½æ•°ã€‚</li>
<li>randomï¼šæä¾›äº†ç”Ÿæˆéšæœºæ•°çš„å‡½æ•°ã€‚</li>
<li>reï¼šæä¾›äº†å¤„ç†æ­£åˆ™è¡¨è¾¾å¼çš„å‡½æ•°ã€‚</li>
<li>urllibã€requestsï¼šæä¾›äº†è¿›è¡Œç½‘ç»œç¼–ç¨‹çš„åŠŸèƒ½ã€‚</li>
<li>jsonã€pickleï¼šæä¾›äº†è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„åŠŸèƒ½ã€‚</li>
</ul>
<p>16ã€ä½¿ç”¨ virtualenv</p>
<p>å¦‚æœæ‚¨éœ€è¦åœ¨åŒä¸€å°è®¡ç®—æœºä¸Šè¿è¡Œå¤šä¸ª Python é¡¹ç›®ï¼Œæ¯ä¸ªé¡¹ç›®å¯èƒ½éƒ½éœ€è¦ä¸åŒç‰ˆæœ¬çš„ Python å’Œå„ç§ä¾èµ–åº“ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ virtualenv æ¥åˆ›å»ºç‹¬ç«‹çš„ Python ç¯å¢ƒï¼Œæ¯ä¸ªç¯å¢ƒéƒ½å¯ä»¥å®‰è£…ä¸åŒç‰ˆæœ¬çš„ Python å’Œä¾èµ–åº“ï¼Œä»¥é¿å…ç‰ˆæœ¬å†²çªå’Œä¾èµ–å†²çªã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># åˆ›å»ºä¸€ä¸ªåä¸º myenv çš„è™šæ‹Ÿç¯å¢ƒ</span>
</span></span><span class="line"><span class="cl">$ virtualenv myenv
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</span>
</span></span><span class="line"><span class="cl">$ <span class="nb">source</span> myenv/bin/activate
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å®‰è£…ä¾èµ–åº“</span>
</span></span><span class="line"><span class="cl">$ pip install package1 package2
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¿è¡Œ Python è„šæœ¬</span>
</span></span><span class="line"><span class="cl">$ python myscript.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># é€€å‡ºè™šæ‹Ÿç¯å¢ƒ</span>
</span></span><span class="line"><span class="cl">$ deactivate
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ virtualenv åˆ›å»ºäº†ä¸€ä¸ªåä¸º myenv çš„è™šæ‹Ÿç¯å¢ƒï¼Œå¹¶ä½¿ç”¨ pip å®‰è£…äº† package1 å’Œ package2 ä¸¤ä¸ªä¾èµ–åº“ã€‚åœ¨æ¿€æ´»è™šæ‹Ÿç¯å¢ƒåï¼Œè¿è¡Œ myscript.py è„šæœ¬æ—¶ï¼Œå°†ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒä¸­çš„ Python ç‰ˆæœ¬å’Œä¾èµ–åº“ã€‚</p>
<p>17ã€ä½¿ç”¨ pipenv</p>
<p>pipenv æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå¯ä»¥ç®¡ç† Python é¡¹ç›®çš„ä¾èµ–å…³ç³»å’Œè™šæ‹Ÿç¯å¢ƒã€‚å®ƒä½¿ç”¨ Pipfile å’Œ Pipfile.lock æ–‡ä»¶æ¥è·Ÿè¸ªé¡¹ç›®çš„ä¾èµ–å…³ç³»ï¼Œå¹¶ä½¿ç”¨ virtualenv æ¥åˆ›å»ºå’Œç®¡ç†è™šæ‹Ÿç¯å¢ƒã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># å®‰è£… pipenv</span>
</span></span><span class="line"><span class="cl">$ pip install pipenv
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®å¹¶å®‰è£…ä¾èµ–åº“</span>
</span></span><span class="line"><span class="cl">$ mkdir myproject
</span></span><span class="line"><span class="cl">$ <span class="nb">cd</span> myproject
</span></span><span class="line"><span class="cl">$ pipenv install package1 package2
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¿è¡Œ Python è„šæœ¬</span>
</span></span><span class="line"><span class="cl">$ pipenv run python myscript.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># é€€å‡ºè™šæ‹Ÿç¯å¢ƒ</span>
</span></span><span class="line"><span class="cl">$ <span class="nb">exit</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ pipenv åˆ›å»ºäº†ä¸€ä¸ªåä¸º myproject çš„æ–°é¡¹ç›®ï¼Œå¹¶ä½¿ç”¨ pipenv install å‘½ä»¤å®‰è£…äº† package1 å’Œ package2 ä¸¤ä¸ªä¾èµ–åº“ã€‚åœ¨è¿è¡Œ myscript.py è„šæœ¬æ—¶ï¼Œä½¿ç”¨ pipenv run å‘½ä»¤æ¥æ¿€æ´»è™šæ‹Ÿç¯å¢ƒå¹¶è¿è¡Œè„šæœ¬ã€‚</p>
<p>18ã€ä½¿ç”¨ Anaconda</p>
<p>Anaconda æ˜¯ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„ Python æ•°æ®ç§‘å­¦å¹³å°ï¼Œå®ƒåŒ…å«äº†è®¸å¤šå¸¸ç”¨çš„æ•°æ®ç§‘å­¦åº“å’Œå·¥å…·ï¼Œä¾‹å¦‚ NumPyã€SciPyã€Pandasã€Matplotlib ç­‰ã€‚Anaconda è¿˜æä¾›äº†ä¸€ä¸ªåä¸º conda çš„è™šæ‹Ÿç¯å¢ƒç®¡ç†å™¨ï¼Œå¯ä»¥è½»æ¾åœ°åˆ›å»ºå’Œç®¡ç†ç‹¬ç«‹çš„ Python ç¯å¢ƒã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># åˆ›å»ºä¸€ä¸ªåä¸º myenv çš„è™šæ‹Ÿç¯å¢ƒ</span>
</span></span><span class="line"><span class="cl">$ conda create --name myenv
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</span>
</span></span><span class="line"><span class="cl">$ conda activate myenv
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å®‰è£…ä¾èµ–åº“</span>
</span></span><span class="line"><span class="cl">$ conda install package1 package2
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¿è¡Œ Python è„šæœ¬</span>
</span></span><span class="line"><span class="cl">$ python myscript.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># é€€å‡ºè™šæ‹Ÿç¯å¢ƒ</span>
</span></span><span class="line"><span class="cl">$ conda deactivate
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ conda create å‘½ä»¤åˆ›å»ºäº†ä¸€ä¸ªåä¸º myenv çš„è™šæ‹Ÿç¯å¢ƒï¼Œå¹¶ä½¿ç”¨ conda install å‘½ä»¤å®‰è£…äº† package1 å’Œ package2 ä¸¤ä¸ªä¾èµ–åº“ã€‚åœ¨æ¿€æ´»è™šæ‹Ÿç¯å¢ƒåï¼Œè¿è¡Œ myscript.py è„šæœ¬æ—¶ï¼Œå°†ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒä¸­çš„ Python ç‰ˆæœ¬å’Œä¾èµ–åº“ã€‚</p>
<p>19ã€ä½¿ç”¨ pytest è¿›è¡Œå•å…ƒæµ‹è¯•</p>
<p>pytest æ˜¯ä¸€ä¸ªæµè¡Œçš„ Python æµ‹è¯•æ¡†æ¶ï¼Œå¯ä»¥å¸®åŠ©æ‚¨ç¼–å†™å¹¶è¿è¡Œå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ã€‚pytest è‡ªåŠ¨å‘ç°æµ‹è¯•æ–‡ä»¶å’Œæµ‹è¯•å‡½æ•°ï¼Œå¹¶æä¾›ä¸°å¯Œçš„æ–­è¨€å‡½æ•°å’Œæµ‹è¯•æŠ¥å‘Šã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># test_module.py</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">test_addition</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">test_subtraction</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="mi">5</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">2</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå®šä¹‰äº†ä¸¤ä¸ªæµ‹è¯•å‡½æ•° test_addition() å’Œ test_subtraction()ï¼Œä½¿ç”¨ assert è¯­å¥è¿›è¡Œæ–­è¨€ã€‚ä½¿ç”¨ pytest è¿è¡Œæµ‹è¯•æ—¶ï¼Œpytest ä¼šè‡ªåŠ¨å‘ç°å¹¶è¿è¡Œ test_module.py æ–‡ä»¶ï¼Œè¾“å‡ºæµ‹è¯•ç»“æœå’Œæµ‹è¯•æŠ¥å‘Šã€‚</p>
<p>20ã€ä½¿ç”¨ logging æ¨¡å—è¿›è¡Œæ—¥å¿—è®°å½•</p>
<p>logging æ˜¯ Python æ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œå¯ä»¥å¸®åŠ©æ‚¨è®°å½•å’Œç®¡ç†åº”ç”¨ç¨‹åºçš„æ—¥å¿—ã€‚logging æ¨¡å—æä¾›äº†å¤šä¸ªæ—¥å¿—çº§åˆ«ï¼ˆä¾‹å¦‚ DEBUGã€INFOã€WARNINGã€ERROR å’Œ CRITICALï¼‰å’Œå¤šä¸ªæ—¥å¿—å¤„ç†å™¨ï¼ˆä¾‹å¦‚æ§åˆ¶å°å¤„ç†å™¨ã€æ–‡ä»¶å¤„ç†å™¨ã€ç½‘ç»œå¤„ç†å™¨ç­‰ï¼‰ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œé…ç½®ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># my_module.py</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">logging</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åˆ›å»ºä¸€ä¸ªåä¸º my_logger çš„æ—¥å¿—è®°å½•å™¨</span>
</span></span><span class="line"><span class="cl"><span class="n">my_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&#34;my_logger&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åˆ›å»ºä¸€ä¸ªæ§åˆ¶å°å¤„ç†å™¨å’Œä¸€ä¸ªæ–‡ä»¶å¤„ç†å™¨</span>
</span></span><span class="line"><span class="cl"><span class="n">console_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">file_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="s2">&#34;my_log.log&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åˆ›å»ºä¸€ä¸ªæ—¥å¿—æ ¼å¼å™¨å’Œå°†å…¶æ·»åŠ åˆ°å¤„ç†å™¨ä¸­</span>
</span></span><span class="line"><span class="cl"><span class="n">log_formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">%(asctime)s</span><span class="s2"> [</span><span class="si">%(levelname)s</span><span class="s2">] </span><span class="si">%(message)s</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">console_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">log_formatter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">file_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">log_formatter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å°†å¤„ç†å™¨æ·»åŠ åˆ°æ—¥å¿—è®°å½•å™¨ä¸­</span>
</span></span><span class="line"><span class="cl"><span class="n">my_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">console_handler</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">my_logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">file_handler</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è®¾ç½®æ—¥å¿—çº§åˆ«</span>
</span></span><span class="line"><span class="cl"><span class="n">my_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">my_function</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">my_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&#34;debug message&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">my_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&#34;info message&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">my_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&#34;warning message&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">my_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&#34;error message&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">my_logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&#34;critical message&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä½¿ç”¨ logging æ¨¡å—åˆ›å»ºäº†ä¸€ä¸ªåä¸º my_logger çš„æ—¥å¿—è®°å½•å™¨ï¼Œå¹¶åˆ›å»ºäº†ä¸€ä¸ªæ§åˆ¶å°å¤„ç†å™¨å’Œä¸€ä¸ªæ–‡ä»¶å¤„ç†å™¨ã€‚ä½¿ç”¨æ—¥å¿—æ ¼å¼å™¨å°†æ—¥å¿—æ¶ˆæ¯æ ¼å¼åŒ–åï¼Œå°†å¤„ç†å™¨æ·»åŠ åˆ°æ—¥å¿—è®°å½•å™¨ä¸­ï¼Œå¹¶è®¾ç½®æ—¥å¿—çº§åˆ«ä¸º DEBUGã€‚åœ¨ my_function() å‡½æ•°ä¸­ï¼Œä½¿ç”¨ my_logger è®°å½•äº†ä¸åŒçº§åˆ«çš„æ—¥å¿—æ¶ˆæ¯ã€‚æ—¥å¿—æ¶ˆæ¯å°†åŒæ—¶è¾“å‡ºåˆ°æ§åˆ¶å°å’Œ my_log.log æ–‡ä»¶ä¸­ã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>Javaè®¾è®¡æ¨¡å¼ï¼šAmbassador</title>
      <link>https://blog.chensoul.com/posts/2023/07/06/java-design-patterns-ambassador/</link>
      <pubDate>Thu, 06 Jul 2023 09:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/07/06/java-design-patterns-ambassador/</guid>
      <description>æœ¬æ–‡ä¸»è¦ä»‹ç» Ambassador æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚ Java Design Patterns æä¾›äº†å„ç§ Java è®¾è®¡æ¨¡</description>
      <content:encoded><![CDATA[<p>æœ¬æ–‡ä¸»è¦ä»‹ç» Ambassador æ¨¡å¼ï¼Œåœ¨ <a href="https://java-design-patterns.com/">Java Design Patterns</a>  ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚</p>
<blockquote>
<p><a href="https://java-design-patterns.com/">Java Design Patterns</a> æä¾›äº†å„ç§ Java è®¾è®¡æ¨¡å¼çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ã€‚è¯¥ç½‘ç«™æ—¨åœ¨å¸®åŠ© Java å¼€å‘äººå‘˜äº†è§£å’Œåº”ç”¨å„ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p>
<p>Java Design Patterns ç½‘ç«™æä¾›äº†å¤šç§è®¾è®¡æ¨¡å¼åˆ†ç±»æ–¹å¼ï¼ŒåŒ…æ‹¬åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational Patternsï¼‰ã€ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternsï¼‰å’Œè¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰ï¼Œä»¥åŠå…¶ä»–ä¸€äº›å¸¸è§çš„æ¨¡å¼ã€‚</p>
<p>å¯¹äºæ¯ä¸ªè®¾è®¡æ¨¡å¼ï¼Œè¯¥ç½‘ç«™æä¾›äº†è¯¦ç»†çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ï¼Œå¹¶ä¸”æä¾›äº†ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ã€‚å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©é€‚åˆè‡ªå·±çš„è®¾è®¡æ¨¡å¼ï¼Œå¹¶ä¸”å¯ä»¥å‚è€ƒç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜æ¥ç†è§£å’Œåº”ç”¨è¯¥æ¨¡å¼ã€‚</p>
<p>æ­¤å¤–ï¼ŒJava Design Patterns ç½‘ç«™è¿˜æä¾›äº†ä¸€äº›å…¶ä»–èµ„æºï¼Œå¦‚è®¾è®¡æ¨¡å¼çš„ UML å›¾ã€è®¾è®¡æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ã€è®¾è®¡æ¨¡å¼çš„æ¯”è¾ƒç­‰ã€‚è¿™äº›èµ„æºå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨è®¾è®¡æ¨¡å¼ã€‚</p>
<p>ä¸­æ–‡ç½‘ç«™ï¼š<a href="https://java-design-patterns.com/zh/">https://java-design-patterns.com/zh/</a></p>
<p>Github ä¸Šæºç ä»“åº“ï¼ˆéå®˜æ–¹ï¼‰ï¼š<a href="https://github.com/iluwatar/java-design-patterns">https://github.com/iluwatar/java-design-patterns</a></p>
</blockquote>
<h2 id="ç›®çš„">ç›®çš„</h2>
<p>åœ¨å®¢æˆ·ç«¯ä¸Šæä¾›å¸®åŠ©ç¨‹åºæœåŠ¡å®ä¾‹ï¼Œå¹¶ä»å…±äº«èµ„æºä¸Šè½¬ç§»å¸¸ç”¨åŠŸèƒ½ã€‚</p>
<blockquote>
<p>Ambassador è®¾è®¡æ¨¡å¼çš„ä¸»è¦ç›®çš„æ˜¯å°†å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¸è¿œç¨‹æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ç»†èŠ‚éš”ç¦»å¼€æ¥ï¼Œä»è€Œä½¿å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå¯ä»¥ä¸“æ³¨äºè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸å¿…å…³æ³¨ç½‘ç»œé€šä¿¡ç»†èŠ‚å’Œé”™è¯¯å¤„ç†ã€‚</p>
<p>åœ¨ä¼ ç»Ÿçš„å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¸­ï¼Œé€šå¸¸éœ€è¦å¤„ç†å¤§é‡çš„ç½‘ç»œé€šä¿¡ç»†èŠ‚å’Œé”™è¯¯å¤„ç†ï¼Œè¿™ä¼šä½¿ä»£ç å˜å¾—å¤æ‚ä¸”éš¾ä»¥ç»´æŠ¤ã€‚è€Œä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å¯ä»¥å°†è¿™äº›ç»†èŠ‚å’Œå¤„ç†é€»è¾‘é›†ä¸­åœ¨ä¸€ä¸ªå•ç‹¬çš„ç±»ä¸­ï¼Œä»è€Œä½¿å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºçš„ä»£ç æ›´åŠ ç®€æ´ã€æ˜“äºç»´æŠ¤å’Œæ‰©å±•ã€‚</p>
<p>æ­¤å¤–ï¼Œä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼è¿˜å¯ä»¥æé«˜å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºä¸è¿œç¨‹æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡å®‰å…¨æ€§å’Œå¯é æ€§ã€‚ä¾‹å¦‚ï¼ŒAmbassador ç±»å¯ä»¥è´Ÿè´£ç»Ÿä¸€å¤„ç†æ‰€æœ‰çš„ç½‘ç»œé€šä¿¡ï¼Œä»è€Œå¯ä»¥æ›´è½»æ¾åœ°å®ç°å®‰å…¨æ€§å’Œå¯é æ€§æ§åˆ¶ã€‚</p>
</blockquote>
<h2 id="è§£é‡Š">è§£é‡Š</h2>
<p>å‡è®¾æœ‰ä¸€ä¸ªæ—§ç‰ˆçš„è¿œç¨‹æœåŠ¡ï¼Œè¯¥æœåŠ¡æä¾›äº†è®¸å¤šå®¢æˆ·ç«¯è®¿é—®çš„åŠŸèƒ½ï¼Œä½†ç”±äºç”¨æˆ·çš„å¤§é‡è¯·æ±‚ï¼Œå¯¼è‡´è¿æ¥é—®é¢˜å˜å¾—æ™®éã€‚æ­¤å¤–ï¼Œæ–°çš„è¯·æ±‚é¢‘ç‡è§„åˆ™éœ€è¦åŒæ—¶å®ç°å»¶è¿Ÿæ£€æµ‹å’Œå®¢æˆ·ç«¯æ—¥å¿—åŠŸèƒ½ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼ã€‚</p>
<p><a href="https://learn.microsoft.com/en-us/azure/architecture/patterns/ambassador">å¾®è½¯æ–‡æ¡£</a> åšäº†å¦‚ä¸‹é˜è¿°</p>
<blockquote>
<p>å¯ä»¥å°†å¤§ä½¿æœåŠ¡è§†ä¸ºä¸å®¢æˆ·ç«¯ä½äºåŒä¸€ä½ç½®çš„è¿›ç¨‹å¤–ä»£ç†ã€‚ æ­¤æ¨¡å¼å¯¹äºä»¥è¯­è¨€ä¸å¯çŸ¥çš„æ–¹å¼å‡è½»å¸¸è§çš„å®¢æˆ·ç«¯è¿æ¥ä»»åŠ¡ï¼ˆä¾‹å¦‚ç›‘è§†ï¼Œæ—¥å¿—è®°å½•ï¼Œè·¯ç”±ï¼Œå®‰å…¨æ€§ï¼ˆå¦‚TLSï¼‰å’Œå¼¹æ€§æ¨¡å¼ï¼‰çš„å·¥ä½œå¾ˆæœ‰ç”¨ã€‚ å®ƒé€šå¸¸ä¸æ—§ç‰ˆåº”ç”¨ç¨‹åºæˆ–å…¶ä»–éš¾ä»¥ä¿®æ”¹çš„åº”ç”¨ç¨‹åºä¸€èµ·ä½¿ç”¨ï¼Œä»¥æ‰©å±•å…¶ç½‘ç»œåŠŸèƒ½ã€‚ å®ƒè¿˜å¯ä»¥ä½¿ä¸“ä¸šå›¢é˜Ÿå®ç°è¿™äº›åŠŸèƒ½ã€‚</p>
</blockquote>
<p>åœ¨è¯¥æ¨¡å¼ä¸­ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ª Ambassador ç±»æ¥å……å½“å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå’Œè¿œç¨‹æœåŠ¡ä¹‹é—´çš„ä»£ç†ã€‚Ambassador ç±»è´Ÿè´£å¤„ç†æ‰€æœ‰çš„ç½‘ç»œé€šä¿¡ç»†èŠ‚å’Œé”™è¯¯å¤„ç†ï¼Œå¹¶å®ç°æ–°çš„è¯·æ±‚é¢‘ç‡è§„åˆ™ï¼ŒåŒ…æ‹¬å»¶è¿Ÿæ£€æµ‹å’Œå®¢æˆ·ç«¯æ—¥å¿—åŠŸèƒ½ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼ŒAmbassador ç±»å¯ä»¥å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<ol>
<li>å»¶è¿Ÿæ£€æµ‹ï¼šåœ¨è¯·æ±‚åˆ°è¾¾è¿œç¨‹æœåŠ¡ä¹‹å‰ï¼ŒAmbassador ç±»å¯ä»¥æ£€æµ‹è¯·æ±‚çš„æ—¶é—´æˆ³ï¼Œå¹¶è®¡ç®—å‡ºè¯·æ±‚çš„å»¶è¿Ÿæ—¶é—´ã€‚å¦‚æœè¯·æ±‚çš„å»¶è¿Ÿæ—¶é—´è¶…è¿‡äº†é¢„è®¾çš„é˜ˆå€¼ï¼ŒAmbassador ç±»å¯ä»¥å°†è¯·æ±‚æ‹’ç»ã€‚</li>
<li>å®¢æˆ·ç«¯æ—¥å¿—åŠŸèƒ½ï¼šAmbassador ç±»å¯ä»¥è®°å½•è¯·æ±‚çš„æ—¶é—´æˆ³ã€è¯·æ±‚çš„å†…å®¹å’Œå“åº”çš„å†…å®¹ï¼Œå¹¶å°†è¿™äº›ä¿¡æ¯ä¿å­˜åˆ°å®¢æˆ·ç«¯çš„æ—¥å¿—æ–‡ä»¶ä¸­ã€‚è¿™æ ·å¯ä»¥å¸®åŠ©å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºè¿›è¡Œè°ƒè¯•å’Œæ•…éšœæ’é™¤ã€‚</li>
<li>è¿æ¥é—®é¢˜å¤„ç†ï¼šAmbassador ç±»å¯ä»¥ç›‘æ§è¿œç¨‹æœåŠ¡çš„è¿æ¥çŠ¶æ€ï¼Œå¹¶åœ¨è¿æ¥å‡ºç°é—®é¢˜æ—¶è¿›è¡Œè‡ªåŠ¨é‡è¯•ã€‚åŒæ—¶ï¼ŒAmbassador ç±»è¿˜å¯ä»¥å®ç°ä¸€äº›ä¼˜åŒ–ç­–ç•¥ï¼Œä¾‹å¦‚ä½¿ç”¨è¿æ¥æ± ç­‰ï¼Œä»¥æé«˜è¿æ¥çš„å¯é æ€§å’Œæ€§èƒ½ã€‚</li>
</ol>
<p><strong>ç¨‹åºç¤ºä¾‹</strong></p>
<p>æœ‰äº†ä¸Šé¢çš„ä»‹ç»æˆ‘ä»¬å°†åœ¨è¿™ä¸ªä¾‹å­ä¸­æ¨¡ä»¿åŠŸèƒ½ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ªç”¨è¿œç¨‹æœåŠ¡å®ç°çš„æ¥å£ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å¤§ä½¿æœåŠ¡ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">interface</span> <span class="nc">RemoteServiceInterface</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">long</span> <span class="nf">doRemoteFunction</span><span class="o">(</span><span class="kt">int</span> <span class="n">value</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>è¡¨ç¤ºä¸ºå•ä¾‹çš„è¿œç¨‹æœåŠ¡ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RemoteService</span> <span class="kd">implements</span> <span class="n">RemoteServiceInterface</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">LOGGER</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">RemoteService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="n">RemoteService</span> <span class="n">service</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">static</span> <span class="kd">synchronized</span> <span class="n">RemoteService</span> <span class="nf">getRemoteService</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">service</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">service</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RemoteService</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">service</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">RemoteService</span><span class="o">()</span> <span class="o">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">doRemoteFunction</span><span class="o">(</span><span class="kt">int</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">long</span> <span class="n">waitTime</span> <span class="o">=</span> <span class="o">(</span><span class="kt">long</span><span class="o">)</span> <span class="n">Math</span><span class="o">.</span><span class="na">floor</span><span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">*</span> <span class="n">1000</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">sleep</span><span class="o">(</span><span class="n">waitTime</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">LOGGER</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;Thread sleep interrupted&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">waitTime</span> <span class="o">&gt;=</span> <span class="n">200</span> <span class="o">?</span> <span class="n">value</span> <span class="o">*</span> <span class="n">10</span> <span class="o">:</span> <span class="o">-</span><span class="n">1</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æœåŠ¡å¤§ä½¿æ·»åŠ äº†åƒæ—¥å¿—å’Œå»¶è¿Ÿæ£€æµ‹çš„é¢å¤–åŠŸèƒ½</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServiceAmbassador</span> <span class="kd">implements</span> <span class="n">RemoteServiceInterface</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">LOGGER</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">ServiceAmbassador</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">RETRIES</span> <span class="o">=</span> <span class="n">3</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">DELAY_MS</span> <span class="o">=</span> <span class="n">3000</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">ServiceAmbassador</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">long</span> <span class="nf">doRemoteFunction</span><span class="o">(</span><span class="kt">int</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">safeCall</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="kt">long</span> <span class="nf">checkLatency</span><span class="o">(</span><span class="kt">int</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Long</span> <span class="n">startTime</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kt">long</span> <span class="n">result</span> <span class="o">=</span> <span class="n">RemoteService</span><span class="o">.</span><span class="na">getRemoteService</span><span class="o">().</span><span class="na">doRemoteFunction</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Long</span> <span class="n">timeTaken</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">startTime</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;Time taken (ms): &#34;</span> <span class="o">+</span> <span class="n">timeTaken</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="kt">long</span> <span class="nf">safeCall</span><span class="o">(</span><span class="kt">int</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">retries</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">long</span> <span class="n">result</span> <span class="o">=</span> <span class="o">(</span><span class="kt">long</span><span class="o">)</span> <span class="n">FAILURE</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">RETRIES</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="o">(</span><span class="n">retries</span> <span class="o">&gt;=</span> <span class="n">RETRIES</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">FAILURE</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="o">((</span><span class="n">result</span> <span class="o">=</span> <span class="n">checkLatency</span><span class="o">(</span><span class="n">value</span><span class="o">))</span> <span class="o">==</span> <span class="n">FAILURE</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;Failed to reach remote: (&#34;</span> <span class="o">+</span> <span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">1</span><span class="o">)</span> <span class="o">+</span> <span class="s">&#34;)&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">retries</span><span class="o">++;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">sleep</span><span class="o">(</span><span class="n">DELAY_MS</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">          <span class="n">LOGGER</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;Thread sleep state interrupted&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>å®¢æˆ·ç«¯å…·æœ‰ç”¨äºä¸è¿œç¨‹æœåŠ¡è¿›è¡Œäº¤äº’çš„æœ¬åœ°æœåŠ¡å¤§ä½¿ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">LOGGER</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">Client</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="kd">final</span> <span class="n">ServiceAmbassador</span> <span class="n">serviceAmbassador</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ServiceAmbassador</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kt">long</span> <span class="nf">useService</span><span class="o">(</span><span class="kt">int</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">long</span> <span class="n">result</span> <span class="o">=</span> <span class="n">serviceAmbassador</span><span class="o">.</span><span class="na">doRemoteFunction</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;Service result: &#34;</span> <span class="o">+</span> <span class="n">result</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>è¿™æ˜¯ä¸¤ä¸ªä½¿ç”¨è¯¥æœåŠ¡çš„å®¢æˆ·ç«¯ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Client</span> <span class="n">host1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Client</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">Client</span> <span class="n">host2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Client</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">host1</span><span class="o">.</span><span class="na">useService</span><span class="o">(</span><span class="n">12</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">host2</span><span class="o">.</span><span class="na">useService</span><span class="o">(</span><span class="n">73</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>Here&rsquo;s the output for running the example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Time</span> <span class="nf">taken</span> <span class="o">(</span><span class="n">ms</span><span class="o">):</span> <span class="n">111</span>
</span></span><span class="line"><span class="cl"><span class="n">Service</span> <span class="n">result</span><span class="o">:</span> <span class="n">120</span>
</span></span><span class="line"><span class="cl"><span class="n">Time</span> <span class="nf">taken</span> <span class="o">(</span><span class="n">ms</span><span class="o">):</span> <span class="n">931</span>
</span></span><span class="line"><span class="cl"><span class="n">Failed</span> <span class="n">to</span> <span class="n">reach</span> <span class="n">remote</span><span class="o">:</span> <span class="o">(</span><span class="n">1</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Time</span> <span class="nf">taken</span> <span class="o">(</span><span class="n">ms</span><span class="o">):</span> <span class="n">665</span>
</span></span><span class="line"><span class="cl"><span class="n">Failed</span> <span class="n">to</span> <span class="n">reach</span> <span class="n">remote</span><span class="o">:</span> <span class="o">(</span><span class="n">2</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Time</span> <span class="nf">taken</span> <span class="o">(</span><span class="n">ms</span><span class="o">):</span> <span class="n">538</span>
</span></span><span class="line"><span class="cl"><span class="n">Failed</span> <span class="n">to</span> <span class="n">reach</span> <span class="n">remote</span><span class="o">:</span> <span class="o">(</span><span class="n">3</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Service</span> <span class="n">result</span><span class="o">:</span> <span class="o">-</span><span class="n">1</span>
</span></span></code></pre></div><h2 id="ç±»å›¾">ç±»å›¾</h2>
<p><img loading="lazy" src="https://java-design-patterns.com/assets/ambassador.urm-75077e88.png" alt="alt text"  />
</p>
<h2 id="é€‚ç”¨åœºæ™¯">é€‚ç”¨åœºæ™¯</h2>
<p>Ambassador è®¾è®¡æ¨¡å¼é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š</p>
<ol>
<li>å½“å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºéœ€è¦ä¸è¿œç¨‹æœåŠ¡å™¨è¿›è¡Œé€šä¿¡ï¼Œå¹¶ä¸”éœ€è¦å¤„ç†ä¸ç½‘ç»œé€šä¿¡ç›¸å…³çš„æ‰€æœ‰ç»†èŠ‚æ—¶ã€‚</li>
<li>å½“å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºéœ€è¦éš”ç¦»ä¸è¿œç¨‹æœåŠ¡å™¨çš„é€šä¿¡ç»†èŠ‚æ—¶ï¼Œä»¥ä¾¿æ›´å¥½åœ°ä¸“æ³¨äºè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ã€‚</li>
<li>å½“å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºéœ€è¦å¤„ç†ä¸è¿œç¨‹æœåŠ¡å™¨çš„é€šä¿¡é”™è¯¯æ—¶ã€‚</li>
<li>å½“å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºéœ€è¦å®ç°æ–°çš„è¯·æ±‚é¢‘ç‡è§„åˆ™ï¼Œä¾‹å¦‚å»¶è¿Ÿæ£€æµ‹å’Œå®¢æˆ·ç«¯æ—¥å¿—åŠŸèƒ½ç­‰ã€‚</li>
<li>å½“å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºéœ€è¦åœ¨ä¸æ›´æ”¹æ—§ç‰ˆè¿œç¨‹æœåŠ¡ä»£ç çš„æƒ…å†µä¸‹ï¼Œå¯¹è¿œç¨‹æœåŠ¡è¿›è¡Œå®šåˆ¶åŒ–æ‰©å±•æ—¶ã€‚</li>
</ol>
<h2 id="å…¸å‹ç”¨ä¾‹">å…¸å‹ç”¨ä¾‹</h2>
<p>Ambassador è®¾è®¡æ¨¡å¼å¯ä»¥ç”¨äºè®¸å¤šåœºæ™¯ï¼Œä»¥ä¸‹æ˜¯å…¶ä¸­çš„ä¸€äº›å…¸å‹ç”¨ä¾‹ï¼š</p>
<h3 id="é™æµå’Œç†”æ–­ä¿æŠ¤">é™æµå’Œç†”æ–­ä¿æŠ¤</h3>
<p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒæœåŠ¡ä¹‹é—´çš„è°ƒç”¨æ˜¯é€šè¿‡ç½‘ç»œè¿›è¡Œçš„ï¼Œç½‘ç»œå»¶è¿Ÿã€æ•…éšœå’Œä¸å¯ç”¨æ€§æ˜¯å¸¸è§çš„é—®é¢˜ã€‚å½“ä¸€ä¸ªæœåŠ¡è¢«é¢‘ç¹è°ƒç”¨æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´å…¶è¿‡è½½æˆ–å´©æºƒï¼Œä»è€Œå½±å“æ•´ä¸ªç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯ç”¨æ€§ã€‚ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å¯ä»¥å®ç°å¯¹æœåŠ¡çš„è¯·æ±‚æµé‡å’Œæ‰§è¡Œé¢‘ç‡è¿›è¡Œé™åˆ¶ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å®ç°ç†”æ–­ä¿æŠ¤ï¼Œå½“ä¸€ä¸ªæœåŠ¡å‡ºç°æ•…éšœæˆ–ä¸å¯ç”¨æ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨æœåŠ¡ã€‚</p>
<h4 id="é™æµ">é™æµ</h4>
<p>å½“ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼æ—¶ï¼Œå¯ä»¥åœ¨ Ambassador ç±»ä¸­å®ç°æ–°çš„è¯·æ±‚é¢‘ç‡è§„åˆ™ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œè¯´æ˜å¦‚ä½•ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼æ¥å®ç°è¯·æ±‚é¢‘ç‡è§„åˆ™ï¼š</p>
<p>å‡è®¾æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºéœ€è¦å‘è¿œç¨‹æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œå¹¶ä¸”éœ€è¦å®ç°ä»¥ä¸‹è¯·æ±‚é¢‘ç‡è§„åˆ™ï¼šæ¯ä¸ªå®¢æˆ·ç«¯åœ¨ 10 ç§’é’Ÿå†…åªèƒ½å‘é€ 10 ä¸ªè¯·æ±‚ã€‚å¦‚æœå®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚è¶…è¿‡äº†è¿™ä¸ªé™åˆ¶ï¼ŒæœåŠ¡å™¨å°†è¿”å› 429 Too Many Requests é”™è¯¯ã€‚</p>
<p>ä¸ºäº†å®ç°è¿™ä¸ªè§„åˆ™ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ª Ambassador ç±»æ¥å……å½“å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºå’Œè¿œç¨‹æœåŠ¡å™¨ä¹‹é—´çš„ä»£ç†ã€‚åœ¨ Ambassador ç±»ä¸­ï¼Œå¯ä»¥ä½¿ç”¨è®¡æ•°å™¨å’Œå®šæ—¶å™¨æ¥å®ç°è¯·æ±‚é¢‘ç‡æ§åˆ¶é€»è¾‘ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼ŒAmbassador ç±»å¯ä»¥å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<ol>
<li>å®šä¹‰è®¡æ•°å™¨å’Œå®šæ—¶å™¨ï¼šåœ¨ Ambassador ç±»çš„æ„é€ å‡½æ•°ä¸­ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªè®¡æ•°å™¨å’Œä¸€ä¸ªå®šæ—¶å™¨ã€‚è®¡æ•°å™¨ç”¨äºè®°å½•å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚æ¬¡æ•°ï¼Œå®šæ—¶å™¨ç”¨äºåœ¨æ¯ä¸ª 10 ç§’é’Ÿåé‡ç½®è®¡æ•°å™¨çš„å€¼ã€‚</li>
<li>å¤„ç†è¯·æ±‚ï¼šåœ¨ Ambassador ç±»çš„å¤„ç†è¯·æ±‚æ–¹æ³•ä¸­ï¼Œå¯ä»¥é¦–å…ˆæ£€æŸ¥è®¡æ•°å™¨çš„å€¼æ˜¯å¦è¶…è¿‡äº†é™åˆ¶ã€‚å¦‚æœè¶…è¿‡äº†é™åˆ¶ï¼Œåˆ™è¿”å› 429 Too Many Requests é”™è¯¯ï¼›å¦åˆ™ï¼Œå°†è¯·æ±‚å‘é€åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œå¹¶å°†è®¡æ•°å™¨çš„å€¼å¢åŠ  1ã€‚</li>
<li>å¤„ç†å®šæ—¶å™¨ï¼šåœ¨ Ambassador ç±»ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å®šæ—¶å™¨æ¥å®šæœŸé‡ç½®è®¡æ•°å™¨çš„å€¼ã€‚å½“å®šæ—¶å™¨è§¦å‘æ—¶ï¼Œå°†è®¡æ•°å™¨çš„å€¼è®¾ç½®ä¸º 0ã€‚</li>
</ol>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºäº Java 8 çš„ Ambassador è®¾è®¡æ¨¡å¼çš„ç¤ºä¾‹ä»£ç ï¼Œä½¿ç”¨äº† Java 8 ä¸­çš„ HttpClient ç±»æ¥å‘é€ HTTP è¯·æ±‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.time.Instant</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.concurrent.Executors</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.concurrent.ScheduledExecutorService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.concurrent.TimeUnit</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.concurrent.atomic.LongAdder</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Ambassador</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">LongAdder</span> <span class="n">counter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LongAdder</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">ScheduledExecutorService</span> <span class="n">scheduler</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newSingleThreadScheduledExecutor</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Instant</span> <span class="n">lastResetTime</span> <span class="o">=</span> <span class="n">Instant</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">handleRequest</span><span class="o">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// æ£€æŸ¥è®¡æ•°å™¨æ˜¯å¦è¶…è¿‡äº†é™åˆ¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">counter</span><span class="o">.</span><span class="na">incrementAndGet</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">10</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// è¿”å›â€œToo Many Requestsâ€é”™è¯¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">counter</span><span class="o">.</span><span class="na">decrementAndGet</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s">&#34;429 Too Many Requests&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// å‘é€è¯·æ±‚åˆ°è¿œç¨‹æœåŠ¡å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">String</span> <span class="n">response</span> <span class="o">=</span> <span class="n">sendRequest</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// æ£€æŸ¥æ˜¯å¦éœ€è¦é‡ç½®è®¡æ•°å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">Instant</span> <span class="n">currentTime</span> <span class="o">=</span> <span class="n">Instant</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">currentTime</span><span class="o">.</span><span class="na">getEpochSecond</span><span class="o">()</span> <span class="o">-</span> <span class="n">lastResetTime</span><span class="o">.</span><span class="na">getEpochSecond</span><span class="o">()</span> <span class="o">&gt;=</span> <span class="n">10</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">counter</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="n">lastResetTime</span> <span class="o">=</span> <span class="n">currentTime</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// è¿”å›å“åº”ç»“æœ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">return</span> <span class="n">response</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="nf">sendRequest</span><span class="o">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// å‘é€ HTTP GET è¯·æ±‚å¹¶è¿”å›å“åº”ç»“æœ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">HttpClient</span> <span class="n">client</span> <span class="o">=</span> <span class="n">HttpClient</span><span class="o">.</span><span class="na">newHttpClient</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">HttpRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="n">HttpRequest</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">uri</span><span class="o">(</span><span class="n">URI</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">url</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">GET</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">HttpResponse</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">HttpResponse</span><span class="o">.</span><span class="na">BodyHandlers</span><span class="o">.</span><span class="na">ofString</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="na">body</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="o">|</span> <span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// å¤„ç†è¯·æ±‚å¼‚å¸¸
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">return</span> <span class="s">&#34;500 Internal Server Error&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">Ambassador</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// å®šæ—¶é‡ç½®è®¡æ•°å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">scheduler</span><span class="o">.</span><span class="na">scheduleAtFixedRate</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">counter</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="n">lastResetTime</span> <span class="o">=</span> <span class="n">Instant</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">},</span> <span class="n">10</span><span class="o">,</span> <span class="n">10</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">shutdown</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// å…³é—­å®šæ—¶å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">scheduler</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼ŒAmbassador ç±»ä½¿ç”¨äº† LongAdder ç±»å‹çš„è®¡æ•°å™¨å’Œ ScheduledExecutorService ç±»å‹çš„å®šæ—¶å™¨ï¼Œå¹¶å®ç°äº†å¤„ç†è¯·æ±‚çš„æ–¹æ³• handleRequestã€‚å½“å®¢æˆ·ç«¯è°ƒç”¨ handleRequest æ–¹æ³•æ—¶ï¼ŒAmbassador ç±»ä¼šæ£€æŸ¥è®¡æ•°å™¨çš„å€¼æ˜¯å¦è¶…è¿‡äº†é™åˆ¶ã€‚å¦‚æœè¶…è¿‡äº†é™åˆ¶ï¼Œåˆ™è¿”å› 429 Too Many Requests é”™è¯¯ï¼›å¦åˆ™ï¼Œå°†è¯·æ±‚å‘é€åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œå¹¶å°†è®¡æ•°å™¨çš„å€¼å¢åŠ  1ã€‚åŒæ—¶ï¼ŒAmbassador ç±»è¿˜ä¼šä½¿ç”¨ ScheduledExecutorService æ¥å®šæœŸé‡ç½®è®¡æ•°å™¨çš„å€¼ã€‚</p>
<h4 id="ç†”æ–­">ç†”æ–­</h4>
<p>Ambassador è®¾è®¡æ¨¡å¼å¯ä»¥ä½¿ç”¨ç†”æ–­æ¨¡å¼æ¥ä¿æŠ¤æœåŠ¡å…å—æ•…éšœæˆ–ä¸å¯ç”¨æ€§çš„å½±å“ã€‚ç†”æ–­æ¨¡å¼æ˜¯ä¸€ç§é˜²æ­¢æ•…éšœæ‰©æ•£çš„æœºåˆ¶ï¼Œå½“æœåŠ¡å‡ºç°æ•…éšœæˆ–ä¸å¯ç”¨æ—¶ï¼Œç†”æ–­å™¨ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨æœåŠ¡ï¼Œå¹¶åœ¨ä¸€æ®µæ—¶é—´å†…åœæ­¢å‘é€è¯·æ±‚ã€‚å¦‚æœå¤‡ç”¨æœåŠ¡ä¹Ÿå‡ºç°æ•…éšœæˆ–ä¸å¯ç”¨ï¼Œç†”æ–­å™¨ä¼šé‡æ–°å¯åŠ¨å¹¶ç»§ç»­å‘é€è¯·æ±‚ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å®ç°ç†”æ–­çš„ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.concurrent.*</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.concurrent.atomic.AtomicInteger</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.logging.Level</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.logging.Logger</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Ambassador</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">AtomicInteger</span> <span class="n">failureCount</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicInteger</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">AtomicBoolean</span> <span class="n">circuitBreaker</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicBoolean</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Service</span> <span class="n">primaryService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Service</span> <span class="n">backupService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">failureThreshold</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">timeout</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">ExecutorService</span> <span class="n">executor</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">logger</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">Ambassador</span><span class="o">(</span><span class="n">Service</span> <span class="n">primaryService</span><span class="o">,</span> <span class="n">Service</span> <span class="n">backupService</span><span class="o">,</span> <span class="kt">int</span> <span class="n">failureThreshold</span><span class="o">,</span> <span class="kt">int</span> <span class="n">timeout</span><span class="o">,</span> <span class="kt">int</span> <span class="n">maxConcurrentRequests</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">primaryService</span> <span class="o">=</span> <span class="n">primaryService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">backupService</span> <span class="o">=</span> <span class="n">backupService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">failureThreshold</span> <span class="o">=</span> <span class="n">failureThreshold</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">timeout</span> <span class="o">=</span> <span class="n">timeout</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">executor</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="n">maxConcurrentRequests</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">Ambassador</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">handleRequest</span><span class="o">(</span><span class="n">String</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">TimeoutException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// æ£€æŸ¥ç†”æ–­å™¨çŠ¶æ€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">circuitBreaker</span><span class="o">.</span><span class="na">get</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// è¿”å›å¤‡ç”¨æœåŠ¡çš„å“åº”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">return</span> <span class="n">backupService</span><span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// åˆ›å»º Callable å¯¹è±¡ï¼Œå¹¶è®¾ç½®è¶…æ—¶æ—¶é—´
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">Callable</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">task</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">primaryService</span><span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">Future</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">future</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span><span class="n">task</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">String</span> <span class="n">response</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">timeout</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// é‡ç½®æ•…éšœè®¡æ•°å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">failureCount</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">response</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="o">|</span> <span class="n">ExecutionException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// å¤„ç†è¯·æ±‚å¼‚å¸¸
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="c1">// å¢åŠ æ•…éšœè®¡æ•°å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">failureCount</span><span class="o">.</span><span class="na">incrementAndGet</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// æ£€æŸ¥æ•…éšœè®¡æ•°å™¨æ˜¯å¦è¶…è¿‡é˜ˆå€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="k">if</span> <span class="o">(</span><span class="n">failureCount</span><span class="o">.</span><span class="na">get</span><span class="o">()</span> <span class="o">&gt;=</span> <span class="n">failureThreshold</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="c1">// å¯åŠ¨ç†”æ–­å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="n">circuitBreaker</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                    <span class="n">logger</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="n">Level</span><span class="o">.</span><span class="na">WARNING</span><span class="o">,</span> <span class="s">&#34;Circuit breaker is tripped, switching to backup service&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// è¿”å›å¤‡ç”¨æœåŠ¡çš„å“åº”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="k">return</span> <span class="n">backupService</span><span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">TimeoutException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// å¤„ç†è¯·æ±‚è¶…æ—¶å¼‚å¸¸
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="k">throw</span> <span class="k">new</span> <span class="n">TimeoutException</span><span class="o">(</span><span class="s">&#34;Request timed out&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">// æ£€æŸ¥ç†”æ–­å™¨çŠ¶æ€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="k">if</span> <span class="o">(</span><span class="n">circuitBreaker</span><span class="o">.</span><span class="na">get</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="c1">// åˆ›å»ºå®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶é‡ç½®ç†”æ–­å™¨çŠ¶æ€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="n">ScheduledExecutorService</span> <span class="n">scheduler</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newSingleThreadScheduledExecutor</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                    <span class="n">scheduler</span><span class="o">.</span><span class="na">schedule</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                        <span class="c1">// é‡ç½®æ•…éšœè®¡æ•°å™¨å’Œç†”æ–­å™¨çŠ¶æ€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                        <span class="n">failureCount</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                        <span class="n">circuitBreaker</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                        <span class="n">logger</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="n">Level</span><span class="o">.</span><span class="na">INFO</span><span class="o">,</span> <span class="s">&#34;Circuit breaker is reset, switching back to primary service&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                        <span class="c1">// å…³é—­å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                        <span class="n">scheduler</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                    <span class="o">},</span> <span class="n">timeout</span><span class="o">,</span> <span class="n">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚å’Œç³»ç»Ÿè´Ÿè½½æ¥è®¾ç½®æ•…éšœè®¡æ•°å™¨çš„é˜ˆå€¼å’Œç†”æ–­å™¨çš„åœæ­¢æ—¶é—´ã€‚å¦‚æœæ•…éšœè®¡æ•°å™¨çš„å€¼è¶…è¿‡äº†é˜ˆå€¼ï¼Œç†”æ–­å™¨ä¼šå¯åŠ¨ï¼Œå¹¶åœ¨ä¸€å®šæ—¶é—´å†…åœæ­¢å‘é€è¯·æ±‚ã€‚åœ¨ç†”æ–­å™¨åœæ­¢æœŸé—´ï¼ŒAmbassador ç±»ä¼šå°†æ‰€æœ‰è¯·æ±‚è½¬å‘åˆ°å¤‡ç”¨æœåŠ¡ã€‚å½“ç†”æ–­å™¨åœæ­¢æ—¶é—´åˆ°è¾¾åï¼ŒAmbassador ç±»ä¼šé‡æ–°å¯åŠ¨ç†”æ–­å™¨ï¼Œå¹¶å°†è¯·æ±‚è½¬å‘åˆ°ä¸»æœåŠ¡è¿›è¡Œå¤„ç†ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘å¹¶å‘è¯·æ±‚çš„æ•°é‡å’Œè¯·æ±‚çš„å“åº”æ—¶é—´ï¼Œä»¥ä¾¿æ›´å¥½åœ°ä¿è¯ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œæ€§èƒ½ã€‚</p>
<h3 id="å®‰å…¨è¿‡æ»¤å™¨">å®‰å…¨è¿‡æ»¤å™¨</h3>
<p>åœ¨ Web åº”ç”¨ç¨‹åºä¸­ï¼Œå®‰å…¨è¿‡æ»¤å™¨é€šå¸¸ç”¨äºæ£€æŸ¥è¾“å…¥æ•°æ®çš„åˆæ³•æ€§å’Œé˜²æ­¢æ”»å‡»ï¼Œå¦‚ SQL æ³¨å…¥ã€è·¨ç«™è„šæœ¬æ”»å‡»ç­‰ã€‚ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å¯ä»¥å°†å®‰å…¨è¿‡æ»¤å™¨éƒ¨ç½²åœ¨åº”ç”¨ç¨‹åºçš„å‰ç«¯ï¼Œæ£€æŸ¥æ‰€æœ‰çš„è¾“å…¥æ•°æ®ï¼Œé˜²æ­¢æ”»å‡»å’Œæ¶æ„è¡Œä¸ºã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼æ¥å®ç°å®‰å…¨è¿‡æ»¤å™¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.regex.Pattern</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityFilter</span> <span class="kd">implements</span> <span class="n">Service</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Service</span> <span class="n">service</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">SecurityFilter</span><span class="o">(</span><span class="n">Service</span> <span class="n">service</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">service</span> <span class="o">=</span> <span class="n">service</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">process</span><span class="o">(</span><span class="n">String</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// æ£€æŸ¥è¾“å…¥æ•°æ®ï¼Œé˜²æ­¢æ”»å‡»å’Œæ¶æ„è¡Œä¸º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="o">(!</span><span class="n">isValid</span><span class="o">(</span><span class="n">request</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">&#34;Invalid request&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// è°ƒç”¨æœåŠ¡å¤„ç†è¯·æ±‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="n">service</span><span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">isValid</span><span class="o">(</span><span class="n">String</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// æ£€æŸ¥è¾“å…¥æ•°æ®æ˜¯å¦åŒ…å«æ¶æ„ä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">Pattern</span> <span class="n">pattern</span> <span class="o">=</span> <span class="n">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="s">&#34;&lt;script&gt;(.*?)&lt;/script&gt;&#34;</span><span class="o">,</span> <span class="n">Pattern</span><span class="o">.</span><span class="na">CASE_INSENSITIVE</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="o">!</span><span class="n">pattern</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">request</span><span class="o">).</span><span class="na">find</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª SecurityFilter ç±»ï¼Œå®ç°äº† Service æ¥å£ï¼Œå¹¶åœ¨æ„é€ å‡½æ•°ä¸­ä¼ å…¥äº†ä¸€ä¸ªæœåŠ¡å¯¹è±¡ã€‚åœ¨ process æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆæ£€æŸ¥è¾“å…¥æ•°æ®ï¼Œé˜²æ­¢æ”»å‡»å’Œæ¶æ„è¡Œä¸ºï¼Œç„¶åè°ƒç”¨æœåŠ¡å¤„ç†è¯·æ±‚ã€‚</p>
<p>åœ¨ isValid æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ£€æŸ¥è¾“å…¥æ•°æ®æ˜¯å¦åŒ…å«æ¶æ„ä»£ç ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ£€æŸ¥è¾“å…¥æ•°æ®ä¸­æ˜¯å¦åŒ…å« <code>&lt;script&gt;</code> å’Œ <code>&lt;/script&gt;</code> æ ‡ç­¾ï¼Œå¦‚æœåŒ…å«åˆ™è®¤ä¸ºæ˜¯æ¶æ„ä»£ç ã€‚</p>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚å’Œå®‰å…¨ç­–ç•¥ï¼Œè®¾è®¡æ›´åŠ å¤æ‚å’Œå®Œå–„çš„å®‰å…¨è¿‡æ»¤å™¨ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–çš„è®¾è®¡æ¨¡å¼å’ŒæŠ€æœ¯ï¼Œå¦‚æ‹¦æˆªå™¨ã€è¿‡æ»¤å™¨é“¾ã€é»‘ç™½åå•ã€åŠ å¯†ç®—æ³•ç­‰ï¼Œæ¥æé«˜åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§å’Œå¯é æ€§ã€‚</p>
<p>ä»¥ä¸‹æ˜¯æ›´è¿›ä¸€æ­¥ä¼˜åŒ–åçš„ SecurityFilter ç±»ç¤ºä¾‹ä»£ç ï¼Œå…¶ä¸­ä½¿ç”¨äº†è¿‡æ»¤å™¨é“¾å’Œé»‘ç™½åå•æ¥å®ç°æ›´åŠ çµæ´»å’Œå¯é…ç½®çš„å®‰å…¨è¿‡æ»¤å™¨ï¼ŒåŒæ—¶å¢åŠ äº†æ—¥å¿—è®°å½•å’Œå¼‚å¸¸å¤„ç†ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç›‘æ§å’Œè°ƒè¯•ç³»ç»Ÿï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.regex.Pattern</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.logging.Level</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.logging.Logger</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityFilter</span> <span class="kd">implements</span> <span class="n">Service</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Service</span> <span class="n">service</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Filter</span><span class="o">&gt;</span> <span class="n">filters</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">whiteList</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">blackList</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">SecurityFilter</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">SecurityFilter</span><span class="o">(</span><span class="n">Service</span> <span class="n">service</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">service</span> <span class="o">=</span> <span class="n">service</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">filters</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">whiteList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">blackList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addFilter</span><span class="o">(</span><span class="n">Filter</span> <span class="n">filter</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">filters</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">filter</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addWhiteList</span><span class="o">(</span><span class="n">String</span> <span class="n">pattern</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">whiteList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">pattern</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addBlackList</span><span class="o">(</span><span class="n">String</span> <span class="n">pattern</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">blackList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">pattern</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">process</span><span class="o">(</span><span class="n">String</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// æ£€æŸ¥ç™½åå•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="o">(!</span><span class="n">isAllowed</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">whiteList</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">logger</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="n">Level</span><span class="o">.</span><span class="na">WARNING</span><span class="o">,</span> <span class="s">&#34;Request not allowed: &#34;</span> <span class="o">+</span> <span class="n">request</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">&#34;Request not allowed&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// æ£€æŸ¥é»‘åå•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">isBlocked</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">blackList</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">logger</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="n">Level</span><span class="o">.</span><span class="na">WARNING</span><span class="o">,</span> <span class="s">&#34;Request blocked: &#34;</span> <span class="o">+</span> <span class="n">request</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">&#34;Request blocked&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// æ‰§è¡Œè¿‡æ»¤å™¨é“¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">for</span> <span class="o">(</span><span class="n">Filter</span> <span class="n">filter</span> <span class="o">:</span> <span class="n">filters</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">request</span> <span class="o">=</span> <span class="n">filter</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// è°ƒç”¨æœåŠ¡å¤„ç†è¯·æ±‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="n">service</span><span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">isAllowed</span><span class="o">(</span><span class="n">String</span> <span class="n">request</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">patterns</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// æ£€æŸ¥è¯·æ±‚æ˜¯å¦åœ¨ç™½åå•ä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="n">patterns</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">anyMatch</span><span class="o">(</span><span class="n">pattern</span> <span class="o">-&gt;</span> <span class="n">Pattern</span><span class="o">.</span><span class="na">matches</span><span class="o">(</span><span class="n">pattern</span><span class="o">,</span> <span class="n">request</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">isBlocked</span><span class="o">(</span><span class="n">String</span> <span class="n">request</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">patterns</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// æ£€æŸ¥è¯·æ±‚æ˜¯å¦åœ¨é»‘åå•ä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="n">patterns</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">anyMatch</span><span class="o">(</span><span class="n">pattern</span> <span class="o">-&gt;</span> <span class="n">Pattern</span><span class="o">.</span><span class="na">matches</span><span class="o">(</span><span class="n">pattern</span><span class="o">,</span> <span class="n">request</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Filter</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">String</span> <span class="nf">doFilter</span><span class="o">(</span><span class="n">String</span> <span class="n">request</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h3 id="è´Ÿè½½å‡è¡¡">è´Ÿè½½å‡è¡¡</h3>
<p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œè´Ÿè½½å‡è¡¡é€šå¸¸ç”¨äºå°†è¯·æ±‚åˆ†å‘åˆ°å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œä»¥å®ç°é«˜å¯ç”¨æ€§å’Œå®¹é”™æ€§ã€‚ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å¯ä»¥å®ç°è´Ÿè½½å‡è¡¡ï¼Œå°†è¯·æ±‚åˆ†å‘åˆ°å¤šä¸ªæœåŠ¡å®ä¾‹ä¸Šï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œæ€§èƒ½ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼æ¥å®ç°è´Ÿè½½å‡è¡¡ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.concurrent.ThreadLocalRandom</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoadBalancer</span> <span class="kd">implements</span> <span class="n">Service</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Service</span><span class="o">&gt;</span> <span class="n">services</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">LoadBalancingStrategy</span> <span class="n">strategy</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">LoadBalancer</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Service</span><span class="o">&gt;</span> <span class="n">services</span><span class="o">,</span> <span class="n">LoadBalancingStrategy</span> <span class="n">strategy</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">services</span> <span class="o">=</span> <span class="n">services</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">strategy</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">process</span><span class="o">(</span><span class="n">String</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// æ ¹æ®è´Ÿè½½å‡è¡¡ç­–ç•¥é€‰æ‹©æœåŠ¡å®ä¾‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">Service</span> <span class="n">service</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="n">services</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// è°ƒç”¨é€‰æ‹©çš„æœåŠ¡å¤„ç†è¯·æ±‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="n">service</span><span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">interface</span> <span class="nc">LoadBalancingStrategy</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Service</span> <span class="nf">select</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Service</span><span class="o">&gt;</span> <span class="n">services</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">RandomStrategy</span> <span class="kd">implements</span> <span class="n">LoadBalancingStrategy</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">Service</span> <span class="nf">select</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Service</span><span class="o">&gt;</span> <span class="n">services</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// éšæœºé€‰æ‹©ä¸€ä¸ªæœåŠ¡å®ä¾‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">ThreadLocalRandom</span><span class="o">.</span><span class="na">current</span><span class="o">().</span><span class="na">nextInt</span><span class="o">(</span><span class="n">services</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">services</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">index</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">RoundRobinStrategy</span> <span class="kd">implements</span> <span class="n">LoadBalancingStrategy</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">Service</span> <span class="nf">select</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Service</span><span class="o">&gt;</span> <span class="n">services</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// è½®è¯¢é€‰æ‹©æœåŠ¡å®ä¾‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">Service</span> <span class="n">service</span> <span class="o">=</span> <span class="n">services</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">index</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">index</span> <span class="o">=</span> <span class="o">(</span><span class="n">index</span> <span class="o">+</span> <span class="n">1</span><span class="o">)</span> <span class="o">%</span> <span class="n">services</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">service</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª LoadBalancer ç±»ï¼Œå®ç°äº† Service æ¥å£ï¼Œå¹¶åœ¨æ„é€ å‡½æ•°ä¸­ä¼ å…¥äº†ä¸€ä¸ªæœåŠ¡åˆ—è¡¨å’Œä¸€ä¸ªè´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚åœ¨ process æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æ ¹æ®è´Ÿè½½å‡è¡¡ç­–ç•¥é€‰æ‹©ä¸€ä¸ªæœåŠ¡å®ä¾‹ï¼Œç„¶åè°ƒç”¨é€‰æ‹©çš„æœåŠ¡å¤„ç†è¯·æ±‚ã€‚</p>
<p>åœ¨ LoadBalancingStrategy æ¥å£ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª select æ–¹æ³•ï¼Œç”¨äºé€‰æ‹©æœåŠ¡å®ä¾‹ã€‚åœ¨ RandomStrategy ç±»ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ ThreadLocalRandom æ¥éšæœºé€‰æ‹©ä¸€ä¸ªæœåŠ¡å®ä¾‹ã€‚åœ¨ RoundRobinStrategy ç±»ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨è½®è¯¢ç®—æ³•æ¥é€‰æ‹©æœåŠ¡å®ä¾‹ã€‚</p>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚å’Œæ€§èƒ½æŒ‡æ ‡ï¼Œé€‰æ‹©åˆé€‚çš„è´Ÿè½½å‡è¡¡ç­–ç•¥å’Œç®—æ³•ï¼Œå¦‚åŠ æƒè½®è¯¢ã€æœ€å°‘è¿æ¥æ•°ã€å“ˆå¸Œç®—æ³•ç­‰ï¼Œæ¥å®ç°æ›´åŠ é«˜æ•ˆå’Œçµæ´»çš„è´Ÿè½½å‡è¡¡ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–çš„è®¾è®¡æ¨¡å¼å’ŒæŠ€æœ¯ï¼Œå¦‚ç¼“å­˜ã€å¼‚æ­¥å¤„ç†ã€åˆ†å¸ƒå¼é”ç­‰ï¼Œæ¥è¿›ä¸€æ­¥æé«˜ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œæ€§èƒ½ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è®¾è®¡è´Ÿè½½å‡è¡¡å™¨æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®å®é™…æƒ…å†µå’Œè´Ÿè½½å‡è¡¡ç®—æ³•çš„ç‰¹ç‚¹ï¼Œåˆç†åœ°åˆ†é…æœåŠ¡å®ä¾‹å’Œè¯·æ±‚ï¼Œé¿å…å‡ºç°è´Ÿè½½ä¸å‡è¡¡æˆ–æ€§èƒ½ç“¶é¢ˆçš„é—®é¢˜ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ç»è¿‡ä¼˜åŒ–åçš„è´Ÿè½½å‡è¡¡å™¨çš„ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.concurrent.ConcurrentHashMap</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.concurrent.ThreadLocalRandom</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.concurrent.atomic.AtomicInteger</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.function.Function</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoadBalancer</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Service</span><span class="o">&gt;</span> <span class="n">services</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">LoadBalancingStrategy</span> <span class="n">strategy</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;</span><span class="n">Service</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">weights</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">LoadBalancer</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Service</span><span class="o">&gt;</span> <span class="n">services</span><span class="o">,</span> <span class="n">LoadBalancingStrategy</span> <span class="n">strategy</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">services</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">services</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">strategy</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="n">Service</span> <span class="n">service</span> <span class="o">:</span> <span class="n">services</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">weights</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">service</span><span class="o">,</span> <span class="n">1</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Service</span> <span class="nf">getService</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">strategy</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="n">services</span><span class="o">,</span> <span class="n">weights</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setWeight</span><span class="o">(</span><span class="n">Service</span> <span class="n">service</span><span class="o">,</span> <span class="kt">int</span> <span class="n">weight</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">weights</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">service</span><span class="o">,</span> <span class="n">weight</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">LoadBalancer</span> <span class="nf">create</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Service</span><span class="o">&gt;</span> <span class="n">services</span><span class="o">,</span> <span class="n">LoadBalancingStrategy</span> <span class="n">strategy</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">LoadBalancer</span><span class="o">(</span><span class="n">services</span><span class="o">,</span> <span class="n">strategy</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">LoadBalancer</span> <span class="nf">createWithRoundRobin</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Service</span><span class="o">&gt;</span> <span class="n">services</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">LoadBalancer</span><span class="o">(</span><span class="n">services</span><span class="o">,</span> <span class="n">LoadBalancingStrategy</span><span class="o">.</span><span class="na">ROUND_ROBIN</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">LoadBalancer</span> <span class="nf">createWithRandom</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Service</span><span class="o">&gt;</span> <span class="n">services</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">LoadBalancer</span><span class="o">(</span><span class="n">services</span><span class="o">,</span> <span class="n">LoadBalancingStrategy</span><span class="o">.</span><span class="na">RANDOM</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">enum</span> <span class="n">LoadBalancingStrategy</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">RANDOM</span><span class="o">(</span><span class="n">services</span> <span class="o">-&gt;</span> <span class="n">services</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ThreadLocalRandom</span><span class="o">.</span><span class="na">current</span><span class="o">().</span><span class="na">nextInt</span><span class="o">(</span><span class="n">services</span><span class="o">.</span><span class="na">size</span><span class="o">()))),</span>
</span></span><span class="line"><span class="cl">        <span class="n">ROUND_ROBIN</span><span class="o">(</span><span class="n">services</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">AtomicInteger</span> <span class="n">index</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicInteger</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">services</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">index</span><span class="o">.</span><span class="na">getAndIncrement</span><span class="o">()</span> <span class="o">%</span> <span class="n">services</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="kd">final</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Service</span><span class="o">&gt;,</span> <span class="n">Service</span><span class="o">&gt;</span> <span class="n">selector</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">LoadBalancingStrategy</span><span class="o">(</span><span class="n">Function</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Service</span><span class="o">&gt;,</span> <span class="n">Service</span><span class="o">&gt;</span> <span class="n">selector</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">selector</span> <span class="o">=</span> <span class="n">selector</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">Service</span> <span class="nf">select</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Service</span><span class="o">&gt;</span> <span class="n">services</span><span class="o">,</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;</span><span class="n">Service</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">weights</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">services</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">services</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">&#34;Services cannot be empty&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">services</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="n">1</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">services</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">List</span><span class="o">&lt;</span><span class="n">Service</span><span class="o">&gt;</span> <span class="n">candidates</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">services</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">*</span> <span class="n">100</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="o">(</span><span class="n">Service</span> <span class="n">service</span> <span class="o">:</span> <span class="n">services</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="kt">int</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">weights</span><span class="o">.</span><span class="na">getOrDefault</span><span class="o">(</span><span class="n">service</span><span class="o">,</span> <span class="n">1</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">weight</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">candidates</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">service</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">selector</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">candidates</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬è¿›è¡Œäº†ä»¥ä¸‹ä¼˜åŒ–ï¼š</p>
<ol>
<li>ä½¿ç”¨äº† ConcurrentHashMap æ¥ä»£æ›¿ HashMapï¼Œç¡®ä¿åœ¨å¹¶å‘ç¯å¢ƒä¸‹çš„çº¿ç¨‹å®‰å…¨æ€§ã€‚</li>
<li>ä½¿ç”¨äº†æšä¸¾ç±»å‹æ¥ä»£æ›¿å­—ç¬¦ä¸²å¸¸é‡ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå®‰å…¨æ€§ã€‚</li>
<li>ä½¿ç”¨äº† Lambda è¡¨è¾¾å¼å’Œæ–¹æ³•å¼•ç”¨æ¥ç®€åŒ–è´Ÿè½½å‡è¡¡ç­–ç•¥çš„å®ç°ã€‚</li>
<li>ä½¿ç”¨äº†é™æ€å·¥å‚æ–¹æ³•æ¥åˆ›å»ºè´Ÿè½½å‡è¡¡å™¨å¯¹è±¡ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œçµæ´»æ€§ã€‚</li>
<li>é‡æ„äº† select æ–¹æ³•ï¼Œå°†å…¶å®ç°é€»è¾‘ä» LoadBalancer ç±»ä¸­æŠ½ç¦»å‡ºæ¥ï¼Œå¹¶ä¼˜åŒ–äº†æƒé‡çš„å¤„ç†é€»è¾‘ã€‚</li>
</ol>
<h3 id="ç¼“å­˜">ç¼“å­˜</h3>
<p>ç¼“å­˜å¯ä»¥æé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œå“åº”é€Ÿåº¦ï¼Œå‡å°‘å¯¹æ•°æ®åº“ç­‰åç«¯èµ„æºçš„è®¿é—®ã€‚ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å¯ä»¥å°†ç¼“å­˜éƒ¨ç½²åœ¨åº”ç”¨ç¨‹åºçš„å‰ç«¯ï¼Œå°†è¯·æ±‚è½¬å‘ç»™ç¼“å­˜æœåŠ¡å™¨è¿›è¡Œå¤„ç†ï¼Œå‡å°‘å¯¹åç«¯èµ„æºçš„è®¿é—®ï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå“åº”é€Ÿåº¦ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ Java å®ç°çš„ç®€å•ç¤ºä¾‹ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å°†è¯·æ±‚è½¬å‘ç»™ç¼“å­˜æœåŠ¡å™¨ï¼š</p>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„ç”µå­å•†åŠ¡åº”ç”¨ç¨‹åºï¼Œç”¨æˆ·å¯ä»¥æµè§ˆå•†å“ã€ä¸‹å•ã€æ”¯ä»˜ç­‰æ“ä½œã€‚ä¸ºäº†æé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå“åº”é€Ÿåº¦ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„å‰ç«¯éƒ¨ç½²ä¸€ä¸ªç¼“å­˜æœåŠ¡å™¨ï¼Œå¹¶ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å°†è¯·æ±‚è½¬å‘ç»™ç¼“å­˜æœåŠ¡å™¨è¿›è¡Œå¤„ç†ã€‚åœ¨è¿™ä¸ªåº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å‡è®¾æœ‰ä¸€ä¸ªåä¸º <code>ProductService</code> çš„æœåŠ¡ï¼Œç”¨äºè·å–å•†å“ä¿¡æ¯ã€‚æˆ‘ä»¬å¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„å‰ç«¯éƒ¨ç½²ä¸€ä¸ªç¼“å­˜æœåŠ¡å™¨ï¼Œå¹¶ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å°†è¯·æ±‚è½¬å‘ç»™ç¼“å­˜æœåŠ¡å™¨ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ª <code>ProductService</code> æ¥å£ï¼Œç”¨äºè·å–å•†å“ä¿¡æ¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProductService</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Product</span> <span class="nf">getProductById</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª <code>ProductServiceImpl</code> ç±»ï¼Œå®ç° <code>ProductService</code> æ¥å£ï¼Œå¹¶ç”¨äºä»åç«¯æ•°æ®åº“è·å–å•†å“ä¿¡æ¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductServiceImpl</span> <span class="kd">implements</span> <span class="n">ProductService</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Product</span> <span class="nf">getProductById</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ä»åç«¯æ•°æ®åº“è·å–å•†å“ä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="k">new</span> <span class="n">Product</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="s">&#34;Product &#34;</span> <span class="o">+</span> <span class="n">id</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ç„¶åï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª <code>ProductCache</code> ç±»ï¼Œç”¨äºç¼“å­˜å•†å“ä¿¡æ¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductCache</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Product</span><span class="o">&gt;</span> <span class="n">cache</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Product</span> <span class="nf">getProductById</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">cache</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">putProduct</span><span class="o">(</span><span class="n">Product</span> <span class="n">product</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">cache</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">product</span><span class="o">.</span><span class="na">getId</span><span class="o">(),</span> <span class="n">product</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª <code>ProductCacheService</code> ç±»ï¼Œå®ç° <code>ProductService</code> æ¥å£ï¼Œå¹¶ç”¨äºä»ç¼“å­˜æœåŠ¡å™¨è·å–å•†å“ä¿¡æ¯ã€‚å¦‚æœç¼“å­˜æœåŠ¡å™¨ä¸­æ²¡æœ‰æ‰€éœ€çš„æ•°æ®ï¼Œé‚£ä¹ˆå°±å°†è¯·æ±‚è½¬å‘ç»™åç«¯æœåŠ¡è¿›è¡Œå¤„ç†ï¼Œå¹¶å°†å¤„ç†ç»“æœç¼“å­˜èµ·æ¥ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductCacheService</span> <span class="kd">implements</span> <span class="n">ProductService</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">ProductService</span> <span class="n">backendService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">ProductCache</span> <span class="n">cache</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">ProductCacheService</span><span class="o">(</span><span class="n">ProductService</span> <span class="n">backendService</span><span class="o">,</span> <span class="n">ProductCache</span> <span class="n">cache</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">backendService</span> <span class="o">=</span> <span class="n">backendService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">cache</span> <span class="o">=</span> <span class="n">cache</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Product</span> <span class="nf">getProductById</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Product</span> <span class="n">product</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="na">getProductById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">product</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// ç¼“å­˜æœåŠ¡å™¨ä¸­æ²¡æœ‰æ‰€éœ€çš„æ•°æ®ï¼Œå°†è¯·æ±‚è½¬å‘ç»™åç«¯æœåŠ¡è¿›è¡Œå¤„ç†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">product</span> <span class="o">=</span> <span class="n">backendService</span><span class="o">.</span><span class="na">getProductById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// å°†å¤„ç†ç»“æœç¼“å­˜èµ·æ¥ï¼Œä»¥ä¾¿åç»­çš„è¯·æ±‚å¯ä»¥ç›´æ¥ä»ç¼“å­˜æœåŠ¡å™¨è·å–æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">cache</span><span class="o">.</span><span class="na">putProduct</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">product</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æœ€åï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª <code>ProductServiceAmbassador</code> ç±»ï¼Œç”¨äºæ¥æ”¶æ¥è‡ªåº”ç”¨ç¨‹åºçš„è¯·æ±‚ï¼Œå¹¶æ ¹æ®ä¸€å®šçš„è§„åˆ™å°†è¯·æ±‚è½¬å‘ç»™ç¼“å­˜æœåŠ¡å™¨æˆ–åç«¯æœåŠ¡ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductServiceAmbassador</span> <span class="kd">implements</span> <span class="n">ProductService</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">ProductService</span> <span class="n">cacheService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">ProductService</span> <span class="n">backendService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="n">cachedIds</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">cacheExpireTime</span> <span class="o">=</span> <span class="n">60</span> <span class="o">*</span> <span class="n">1000L</span><span class="o">;</span> <span class="c1">// ç¼“å­˜è¿‡æœŸæ—¶é—´ä¸º 60 ç§’
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Autowired</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">ProductServiceAmbassador</span><span class="o">(</span><span class="n">ProductService</span> <span class="n">cacheService</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                                    <span class="n">ProductService</span> <span class="n">backendService</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">cacheService</span> <span class="o">=</span> <span class="n">cacheService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">backendService</span> <span class="o">=</span> <span class="n">backendService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Product</span> <span class="nf">getProductById</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Long</span> <span class="n">cachedTime</span> <span class="o">=</span> <span class="n">cachedIds</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// å¦‚æœå•†å“ ID åœ¨ç¼“å­˜ä¸­å­˜åœ¨ï¼Œå¹¶ä¸”ç¼“å­˜æœªè¿‡æœŸï¼Œé‚£ä¹ˆå°±ç›´æ¥è¿”å›ç¼“å­˜ä¸­çš„å•†å“ä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="o">(</span><span class="n">cachedTime</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">cachedTime</span> <span class="o">&lt;</span> <span class="n">cacheExpireTime</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">cacheService</span><span class="o">.</span><span class="na">getProductById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// å¦‚æœå•†å“ ID åœ¨ç¼“å­˜ä¸­ä¸å­˜åœ¨ï¼Œæˆ–è€…ç¼“å­˜å·²è¿‡æœŸï¼Œé‚£ä¹ˆå°±å°†è¯·æ±‚è½¬å‘ç»™åç«¯æœåŠ¡è¿›è¡Œå¤„ç†ï¼Œå¹¶å°†å¤„ç†ç»“æœç¼“å­˜èµ·æ¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">Product</span> <span class="n">product</span> <span class="o">=</span> <span class="n">backendService</span><span class="o">.</span><span class="na">getProductById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">cacheService</span><span class="o">.</span><span class="na">putProduct</span><span class="o">(</span><span class="n">product</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">cachedIds</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">product</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h3 id="æœåŠ¡å‘ç°å’Œè·¯ç”±">æœåŠ¡å‘ç°å’Œè·¯ç”±</h3>
<p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒæœåŠ¡å‘ç°å’Œè·¯ç”±é€šå¸¸ç”¨äºå°†è¯·æ±‚è·¯ç”±åˆ°æ­£ç¡®çš„æœåŠ¡å®ä¾‹ä¸Šï¼Œä»¥å®ç°é«˜å¯ç”¨æ€§å’Œå®¹é”™æ€§ã€‚ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å¯ä»¥å®ç°æœåŠ¡å‘ç°å’Œè·¯ç”±ï¼Œå°†è¯·æ±‚è·¯ç”±åˆ°æ­£ç¡®çš„æœåŠ¡å®ä¾‹ä¸Šï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œæ€§èƒ½ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å®ç°æœåŠ¡å‘ç°å’Œè·¯ç”±çš„ Java ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProductService</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Product</span> <span class="nf">getProductById</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">id</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">Product</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">,</span> <span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProductDiscoveryClient</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getInstances</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductDiscoveryClientImpl</span> <span class="kd">implements</span> <span class="n">ProductDiscoveryClient</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getInstances</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// å‡è£…ä»æœåŠ¡æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡å®ä¾‹åˆ—è¡¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;http://localhost:8080&#34;</span><span class="o">,</span> <span class="s">&#34;http://localhost:8081&#34;</span><span class="o">,</span> <span class="s">&#34;http://localhost:8082&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProductRoutingStrategy</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="nf">getRoute</span><span class="o">(</span><span class="n">String</span> <span class="n">productId</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">instances</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductRoutingStrategyImpl</span> <span class="kd">implements</span> <span class="n">ProductRoutingStrategy</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getRoute</span><span class="o">(</span><span class="n">String</span> <span class="n">productId</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">instances</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// å‡è£…ä½¿ç”¨è´Ÿè½½å‡è¡¡ç®—æ³•é€‰æ‹©ä¸€ä¸ªæœåŠ¡å®ä¾‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Random</span><span class="o">().</span><span class="na">nextInt</span><span class="o">(</span><span class="n">instances</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">instances</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">index</span><span class="o">)</span> <span class="o">+</span> <span class="s">&#34;/product/&#34;</span> <span class="o">+</span> <span class="n">productId</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductServiceAmbassador</span> <span class="kd">implements</span> <span class="n">ProductService</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">ProductDiscoveryClient</span> <span class="n">discoveryClient</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">ProductRoutingStrategy</span> <span class="n">routingStrategy</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">RestTemplate</span> <span class="n">restTemplate</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">ProductServiceAmbassador</span><span class="o">(</span><span class="n">ProductDiscoveryClient</span> <span class="n">discoveryClient</span><span class="o">,</span> <span class="n">ProductRoutingStrategy</span> <span class="n">routingStrategy</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">discoveryClient</span> <span class="o">=</span> <span class="n">discoveryClient</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">routingStrategy</span> <span class="o">=</span> <span class="n">routingStrategy</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">restTemplate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RestTemplate</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Product</span> <span class="nf">getProductById</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">instances</span> <span class="o">=</span> <span class="n">discoveryClient</span><span class="o">.</span><span class="na">getInstances</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">String</span> <span class="n">route</span> <span class="o">=</span> <span class="n">routingStrategy</span><span class="o">.</span><span class="na">getRoute</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">instances</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">restTemplate</span><span class="o">.</span><span class="na">getForEntity</span><span class="o">(</span><span class="n">route</span><span class="o">,</span> <span class="n">Product</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="na">getBody</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª <code>ProductService</code> æ¥å£å’Œä¸€ä¸ª <code>Product</code> ç±»ï¼Œç”¨äºè¡¨ç¤ºå•†å“æœåŠ¡å’Œå•†å“ä¿¡æ¯ã€‚ç„¶åï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª <code>ProductDiscoveryClient</code> æ¥å£å’Œä¸€ä¸ª <code>ProductDiscoveryClientImpl</code> ç±»ï¼Œç”¨äºè·å–æœåŠ¡å®ä¾‹åˆ—è¡¨ã€‚åœ¨ <code>ProductDiscoveryClientImpl</code> ç±»ä¸­ï¼Œæˆ‘ä»¬å‡è£…ä»æœåŠ¡æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡å®ä¾‹åˆ—è¡¨ï¼Œè¿™é‡Œæˆ‘ä»¬å°†æœåŠ¡å®ä¾‹åˆ—è¡¨ç¡¬ç¼–ç ä¸ºä¸‰ä¸ªæœ¬åœ°çš„ HTTP åœ°å€ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª <code>ProductRoutingStrategy</code> æ¥å£å’Œä¸€ä¸ª <code>ProductRoutingStrategyImpl</code> ç±»ï¼Œç”¨äºé€‰æ‹©æœåŠ¡å®ä¾‹ã€‚åœ¨ <code>ProductRoutingStrategyImpl</code> ç±»ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†éšæœºè´Ÿè½½å‡è¡¡ç®—æ³•æ¥é€‰æ‹©ä¸€ä¸ªæœåŠ¡å®ä¾‹ï¼Œå¹¶å°†å•†å“ ID å’ŒæœåŠ¡å®ä¾‹çš„ URL æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œå½¢æˆæœ€ç»ˆçš„è·¯ç”±ä¿¡æ¯ã€‚</p>
<p>åœ¨æœ€åï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª <code>ProductServiceAmbassador</code> ç±»ï¼Œç”¨äºå®ç°å•†å“æœåŠ¡çš„ä»£ç†ã€‚åœ¨ <code>ProductServiceAmbassador</code> ç±»ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰çš„æ–¹å¼æ¥æ³¨å…¥ <code>ProductDiscoveryClient</code> å’Œ <code>ProductRoutingStrategy</code> çš„å®ç°ç±»ã€‚åœ¨ <code>getProductById</code> æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆé€šè¿‡ <code>ProductDiscoveryClient</code> è·å–æœåŠ¡å®ä¾‹åˆ—è¡¨ï¼Œç„¶åä½¿ç”¨ <code>ProductRoutingStrategy</code> é€‰æ‹©ä¸€ä¸ªæœåŠ¡å®ä¾‹ï¼Œå¹¶å°†å•†å“ ID å’ŒæœåŠ¡å®ä¾‹çš„ URL æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œå½¢æˆæœ€ç»ˆçš„è·¯ç”±ä¿¡æ¯ã€‚æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>RestTemplate</code> å‘é€ HTTP GET è¯·æ±‚ï¼Œå¹¶å°†å“åº”çš„ JSON æ•°æ®è½¬æ¢ä¸º <code>Product</code> å¯¹è±¡è¿”å›ã€‚</p>
<p>ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å¯ä»¥å®ç°æœåŠ¡å‘ç°å’Œè·¯ç”±ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œæ€§èƒ½ï¼Œä½¿å¾—æœåŠ¡æ¶ˆè´¹è€…æ— éœ€å…³å¿ƒæœåŠ¡å®ä¾‹çš„å…·ä½“ä½ç½®å’Œè´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œåªéœ€è¦é€šè¿‡ä»£ç†å¯¹è±¡æ¥è®¿é—®æœåŠ¡å³å¯ã€‚</p>
<h3 id="æ—¥å¿—è®°å½•å’Œç›‘æ§">æ—¥å¿—è®°å½•å’Œç›‘æ§</h3>
<p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ—¥å¿—è®°å½•å’Œç›‘æ§é€šå¸¸ç”¨äºè·Ÿè¸ªæœåŠ¡çš„è¿è¡ŒçŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡ï¼Œä»¥ä¾¿è¿›è¡Œæ•…éšœæ’é™¤å’Œæ€§èƒ½ä¼˜åŒ–ã€‚ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å¯ä»¥å°†æ—¥å¿—è®°å½•å’Œç›‘æ§éƒ¨ç½²åœ¨åº”ç”¨ç¨‹åºçš„å‰ç«¯ï¼Œç›‘æ§æœåŠ¡çš„è¿è¡ŒçŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡ï¼Œä»è€Œå®ç°æ•…éšœæ’é™¤å’Œæ€§èƒ½ä¼˜åŒ–ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å®ç°æ—¥å¿—è®°å½•å’Œç›‘æ§çš„ Java ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProductService</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Product</span> <span class="nf">getProductById</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">id</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">Product</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">,</span> <span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProductLogger</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">logRequest</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">logResponse</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">,</span> <span class="n">Product</span> <span class="n">product</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductLoggerImpl</span> <span class="kd">implements</span> <span class="n">ProductLogger</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">ProductLoggerImpl</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">logRequest</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;Requesting product with ID: {}&#34;</span><span class="o">,</span> <span class="n">id</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">logResponse</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">,</span> <span class="n">Product</span> <span class="n">product</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;Received product with ID: {}, Name: {}&#34;</span><span class="o">,</span> <span class="n">id</span><span class="o">,</span> <span class="n">product</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ProductMonitor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">recordLatency</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">,</span> <span class="kt">long</span> <span class="n">latency</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">incrementCounter</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductMonitorImpl</span> <span class="kd">implements</span> <span class="n">ProductMonitor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">StatsDClient</span> <span class="n">statsd</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">ProductMonitorImpl</span><span class="o">(</span><span class="n">String</span> <span class="n">host</span><span class="o">,</span> <span class="kt">int</span> <span class="n">port</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">statsd</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NonBlockingStatsDClient</span><span class="o">(</span><span class="s">&#34;product-service&#34;</span><span class="o">,</span> <span class="n">host</span><span class="o">,</span> <span class="n">port</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">recordLatency</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">,</span> <span class="kt">long</span> <span class="n">latency</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">statsd</span><span class="o">.</span><span class="na">recordExecutionTime</span><span class="o">(</span><span class="s">&#34;product.latency&#34;</span><span class="o">,</span> <span class="n">latency</span><span class="o">,</span> <span class="s">&#34;id:&#34;</span> <span class="o">+</span> <span class="n">id</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">incrementCounter</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">statsd</span><span class="o">.</span><span class="na">increment</span><span class="o">(</span><span class="s">&#34;product.counter&#34;</span><span class="o">,</span> <span class="s">&#34;id:&#34;</span> <span class="o">+</span> <span class="n">id</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProductServiceAmbassador</span> <span class="kd">implements</span> <span class="n">ProductService</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">ProductService</span> <span class="n">productService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">ProductLogger</span> <span class="n">logger</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">ProductMonitor</span> <span class="n">monitor</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">ProductServiceAmbassador</span><span class="o">(</span><span class="n">ProductService</span> <span class="n">productService</span><span class="o">,</span> <span class="n">ProductLogger</span> <span class="n">logger</span><span class="o">,</span> <span class="n">ProductMonitor</span> <span class="n">monitor</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">productService</span> <span class="o">=</span> <span class="n">productService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">logger</span> <span class="o">=</span> <span class="n">logger</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">monitor</span> <span class="o">=</span> <span class="n">monitor</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Product</span> <span class="nf">getProductById</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">logger</span><span class="o">.</span><span class="na">logRequest</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="kt">long</span> <span class="n">startTime</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">Product</span> <span class="n">product</span> <span class="o">=</span> <span class="n">productService</span><span class="o">.</span><span class="na">getProductById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="kt">long</span> <span class="n">endTime</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">logger</span><span class="o">.</span><span class="na">logResponse</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">product</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="kt">long</span> <span class="n">latency</span> <span class="o">=</span> <span class="n">endTime</span> <span class="o">-</span> <span class="n">startTime</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">monitor</span><span class="o">.</span><span class="na">recordLatency</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">latency</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">monitor</span><span class="o">.</span><span class="na">incrementCounter</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">product</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª <code>ProductService</code> æ¥å£å’Œä¸€ä¸ª <code>Product</code> ç±»ï¼Œç”¨äºè¡¨ç¤ºå•†å“æœåŠ¡å’Œå•†å“ä¿¡æ¯ã€‚ç„¶åï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª <code>ProductLogger</code> æ¥å£å’Œä¸€ä¸ª <code>ProductLoggerImpl</code> ç±»ï¼Œç”¨äºè®°å½•è¯·æ±‚å’Œå“åº”çš„æ—¥å¿—ä¿¡æ¯ã€‚åœ¨ <code>ProductLoggerImpl</code> ç±»ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <code>SLF4J</code> æ—¥å¿—æ¡†æ¶æ¥è®°å½•æ—¥å¿—ä¿¡æ¯ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª <code>ProductMonitor</code> æ¥å£å’Œä¸€ä¸ª <code>ProductMonitorImpl</code> ç±»ï¼Œç”¨äºè®°å½•è¿è¡ŒçŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡ã€‚åœ¨ <code>ProductMonitorImpl</code> ç±»ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <code>StatsD</code> å®¢æˆ·ç«¯æ¥è®°å½•è¿è¡ŒçŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡ï¼Œä¾‹å¦‚è¯·æ±‚çš„å»¶è¿Ÿå’Œè°ƒç”¨æ¬¡æ•°ç­‰ã€‚åœ¨ <code>ProductMonitorImpl</code> çš„æ„é€ å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®š <code>StatsD</code> å®¢æˆ·ç«¯çš„ä¸»æœºå’Œç«¯å£ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª <code>ProductServiceAmbassador</code> ç±»ï¼Œç”¨äºå®ç°å•†å“æœåŠ¡çš„ä»£ç†ã€‚åœ¨ <code>ProductServiceAmbassador</code> ç±»ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰çš„æ–¹å¼å°† <code>ProductService</code>ã€<code>ProductLogger</code> å’Œ <code>ProductMonitor</code> çš„å®ç°ç±»æ³¨å…¥åˆ°æ„é€ å‡½æ•°ä¸­ã€‚åœ¨ <code>getProductById</code> æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆè°ƒç”¨ <code>ProductLogger</code> çš„ <code>logRequest</code> æ–¹æ³•æ¥è®°å½•è¯·æ±‚çš„æ—¥å¿—ä¿¡æ¯ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>System.currentTimeMillis()</code> æ¥è®°å½•è¯·æ±‚çš„å¼€å§‹æ—¶é—´ï¼Œç„¶åè°ƒç”¨ <code>ProductService</code> çš„ <code>getProductById</code> æ–¹æ³•æ¥è·å–å•†å“ä¿¡æ¯ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>System.currentTimeMillis()</code> æ¥è®°å½•è¯·æ±‚çš„ç»“æŸæ—¶é—´ï¼Œå¹¶è°ƒç”¨ <code>ProductLogger</code> çš„ <code>logResponse</code> æ–¹æ³•æ¥è®°å½•å“åº”çš„æ—¥å¿—ä¿¡æ¯ã€‚æœ€åï¼Œæˆ‘ä»¬è®¡ç®—è¯·æ±‚çš„å»¶è¿Ÿï¼Œå¹¶è°ƒç”¨ <code>ProductMonitor</code> çš„ <code>recordLatency</code> æ–¹æ³•æ¥è®°å½•è¯·æ±‚çš„å»¶è¿Ÿï¼Œè°ƒç”¨ <code>ProductMonitor</code> çš„ <code>incrementCounter</code> æ–¹æ³•æ¥è®°å½•è°ƒç”¨æ¬¡æ•°ã€‚</p>
<p>ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å¯ä»¥å°†æ—¥å¿—è®°å½•å’Œç›‘æ§éƒ¨ç½²åœ¨åº”ç”¨ç¨‹åºçš„å‰ç«¯ï¼Œä»è€Œç›‘æ§æœåŠ¡çš„è¿è¡ŒçŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡ï¼Œå¹¶æä¾›å®æ—¶çš„æ•…éšœæ’é™¤å’Œæ€§èƒ½ä¼˜åŒ–ã€‚ç”±äºæ—¥å¿—è®°å½•å’Œç›‘æ§æ˜¯ä¸ä¸šåŠ¡é€»è¾‘è§£è€¦çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥éšæ—¶åœ¨è¿è¡Œæ—¶æ·»åŠ ã€åˆ é™¤æˆ–æ›´æ”¹æ—¥å¿—è®°å½•å’Œç›‘æ§çš„å®ç°ï¼Œè€Œä¸å½±å“åº”ç”¨ç¨‹åºçš„æ­£å¸¸è¿è¡Œã€‚</p>
<h2 id="å·²çŸ¥ä½¿ç”¨">å·²çŸ¥ä½¿ç”¨</h2>
<p>Ambassador è®¾è®¡æ¨¡å¼é€šå¸¸ç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç”¨äºè§£å†³æœåŠ¡é—´çš„é€šä¿¡é—®é¢˜å’Œè´Ÿè½½å‡è¡¡é—®é¢˜ã€‚è®¸å¤šå¼€æºæ¡†æ¶å’Œå·¥å…·éƒ½ä½¿ç”¨äº† Ambassador æ¨¡å¼æ¥å®ç°æœåŠ¡ä»£ç†å’Œå¢å¼ºç­‰åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ä½¿ç”¨äº† Ambassador æ¨¡å¼çš„å¼€æºæ¡†æ¶å’Œå·¥å…·ï¼š</p>
<ol>
<li>Istioï¼šIstio æ˜¯ä¸€ä¸ªæµè¡Œçš„æœåŠ¡ç½‘æ ¼æ¡†æ¶ï¼Œå®ƒä½¿ç”¨äº† Ambassador æ¨¡å¼æ¥å®ç°æœåŠ¡ä»£ç†å’Œå¢å¼ºç­‰åŠŸèƒ½ï¼Œä¾‹å¦‚æµé‡ç®¡ç†ã€å®‰å…¨è®¤è¯ã€ç›‘æ§å’Œæ—¥å¿—ç­‰ã€‚</li>
<li>Envoyï¼šEnvoy æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ä»£ç†æœåŠ¡å™¨ï¼Œå®ƒä½¿ç”¨äº† Ambassador æ¨¡å¼æ¥å®ç°è´Ÿè½½å‡è¡¡ã€æµé‡è½¬å‘å’ŒæœåŠ¡ä»£ç†ç­‰åŠŸèƒ½ã€‚</li>
<li>Linkerdï¼šLinkerd æ˜¯å¦ä¸€ä¸ªæµè¡Œçš„æœåŠ¡ç½‘æ ¼æ¡†æ¶ï¼Œå®ƒä½¿ç”¨äº† Ambassador æ¨¡å¼æ¥å®ç°æœåŠ¡ä»£ç†å’Œå¢å¼ºç­‰åŠŸèƒ½ï¼Œä¾‹å¦‚è´Ÿè½½å‡è¡¡ã€æ•…éšœæ¢å¤å’Œæµé‡ç®¡ç†ç­‰ã€‚</li>
<li>Open Service Meshï¼šOpen Service Mesh æ˜¯ä¸€ä¸ªå¼€æºçš„æœåŠ¡ç½‘æ ¼æ¡†æ¶ï¼Œå®ƒä½¿ç”¨äº† Ambassador æ¨¡å¼æ¥å®ç°æœåŠ¡ä»£ç†å’Œå¢å¼ºç­‰åŠŸèƒ½ï¼Œä¾‹å¦‚æµé‡ç®¡ç†ã€å®‰å…¨è®¤è¯å’Œç›‘æ§ç­‰ã€‚</li>
<li>Consulï¼šConsul æ˜¯ä¸€ä¸ªæµè¡Œçš„æœåŠ¡å‘ç°å’Œé…ç½®å·¥å…·ï¼Œå®ƒä½¿ç”¨äº† Ambassador æ¨¡å¼æ¥å®ç°æœåŠ¡ä»£ç†å’Œå¢å¼ºç­‰åŠŸèƒ½ï¼Œä¾‹å¦‚è´Ÿè½½å‡è¡¡ã€å¥åº·æ£€æŸ¥å’Œæ•…éšœæ¢å¤ç­‰ã€‚</li>
<li>Kubernetesï¼šKubernetes æ˜¯ä¸€ä¸ªæµè¡Œçš„å®¹å™¨ç¼–æ’å¹³å°ï¼Œå®ƒä½¿ç”¨äº† Ambassador æ¨¡å¼æ¥å®ç°æœåŠ¡ä»£ç†å’Œå¢å¼ºç­‰åŠŸèƒ½ï¼Œä¾‹å¦‚æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡å’Œæµé‡ç®¡ç†ç­‰ã€‚</li>
<li>Nginxï¼šNginx æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ Web æœåŠ¡å™¨å’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œå®ƒä½¿ç”¨äº† Ambassador æ¨¡å¼æ¥å®ç°è´Ÿè½½å‡è¡¡ã€æµé‡è½¬å‘å’ŒæœåŠ¡ä»£ç†ç­‰åŠŸèƒ½ã€‚</li>
<li>Kongï¼šKong æ˜¯ä¸€ä¸ªå¼€æºçš„ API ç½‘å…³ï¼Œå®ƒä½¿ç”¨äº† Ambassador æ¨¡å¼æ¥å®ç°æµé‡ç®¡ç†ã€å®‰å…¨è®¤è¯å’Œç›‘æ§ç­‰åŠŸèƒ½ã€‚</li>
<li>Traefikï¼šTraefik æ˜¯ä¸€ä¸ªæµè¡Œçš„åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡å™¨ï¼Œå®ƒä½¿ç”¨äº† Ambassador æ¨¡å¼æ¥å®ç°æœåŠ¡ä»£ç†å’Œå¢å¼ºç­‰åŠŸèƒ½ï¼Œä¾‹å¦‚åŠ¨æ€é…ç½®ã€è‡ªåŠ¨å‘ç°å’Œæµé‡è½¬å‘ç­‰ã€‚</li>
</ol>
<p>å½“ç„¶ï¼ŒJava ç”Ÿæ€ç³»ç»Ÿä¸­ä¹Ÿæœ‰è®¸å¤šå¼€æºæ¡†æ¶å’Œå·¥å…·ä½¿ç”¨äº† Ambassador æ¨¡å¼ã€‚ä»¥ä¸‹æ˜¯å…¶ä¸­çš„ä¸€äº›ï¼š</p>
<ol>
<li>Spring Cloud Netflixï¼šSpring Cloud Netflix æ˜¯ä¸€ä¸ªæµè¡Œçš„å¾®æœåŠ¡æ¡†æ¶ï¼Œå®ƒä½¿ç”¨äº† Netflix OSS ä¸­çš„ Ribbon å’Œ Zuul ç»„ä»¶æ¥å®ç°æœåŠ¡ä»£ç†å’Œå¢å¼ºç­‰åŠŸèƒ½ï¼Œä¾‹å¦‚è´Ÿè½½å‡è¡¡ã€æœåŠ¡å‘ç°å’Œè·¯ç”±ç­‰ã€‚</li>
<li>Spring Cloud Gatewayï¼šSpring Cloud Gateway æ˜¯ Spring Cloud ç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¸€ä¸ªæ–°å‹ API ç½‘å…³ï¼Œå®ƒä½¿ç”¨äº† Reactor Netty å’Œ Spring WebFlux ç­‰æŠ€æœ¯æ¥å®ç°æœåŠ¡ä»£ç†å’Œå¢å¼ºç­‰åŠŸèƒ½ï¼Œä¾‹å¦‚è´Ÿè½½å‡è¡¡ã€è·¯ç”±å’Œé™æµç­‰ã€‚</li>
<li>Netflix OSSï¼šNetflix OSS æ˜¯ Netflix å¼€æºçš„ä¸€ç»„åˆ†å¸ƒå¼ç³»ç»Ÿå·¥å…·ï¼Œå…¶ä¸­åŒ…æ‹¬äº†è®¸å¤šä½¿ç”¨äº† Ambassador æ¨¡å¼çš„ç»„ä»¶ï¼Œä¾‹å¦‚ Ribbonã€Hystrixã€Zuul å’Œ Eureka ç­‰ã€‚</li>
<li>Micronautï¼šMicronaut æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ Java æ¡†æ¶ï¼Œå®ƒä½¿ç”¨äº† Netty å’Œ Reactive Streams ç­‰æŠ€æœ¯æ¥å®ç°æœåŠ¡ä»£ç†å’Œå¢å¼ºç­‰åŠŸèƒ½ï¼Œä¾‹å¦‚è´Ÿè½½å‡è¡¡ã€æœåŠ¡å‘ç°å’Œè·¯ç”±ç­‰ã€‚</li>
<li>Vert.xï¼šVert.x æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„å¼‚æ­¥ç¼–ç¨‹æ¡†æ¶ï¼Œå®ƒä½¿ç”¨äº† Netty å’Œ Reactive Streams ç­‰æŠ€æœ¯æ¥å®ç°æœåŠ¡ä»£ç†å’Œå¢å¼ºç­‰åŠŸèƒ½ï¼Œä¾‹å¦‚è´Ÿè½½å‡è¡¡ã€è·¯ç”±å’Œé™æµç­‰ã€‚</li>
</ol>
<h3 id="spring-cloud-gateway">Spring Cloud Gateway</h3>
<p>Spring Cloud Gateway æ˜¯ Spring Cloud ç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¸€ä¸ªæ–°å‹ API ç½‘å…³ï¼Œå®ƒä½¿ç”¨äº† Reactor Netty å’Œ Spring WebFlux ç­‰æŠ€æœ¯æ¥å®ç°æœåŠ¡ä»£ç†å’Œå¢å¼ºç­‰åŠŸèƒ½ã€‚å®ƒçš„è®¾è®¡ç†å¿µå°±æ˜¯åŸºäº Ambassador æ¨¡å¼æ¥æ„å»ºçš„ï¼Œå®ƒå°†æ¯ä¸ªåç«¯æœåŠ¡éƒ½çœ‹ä½œä¸€ä¸ªç‹¬ç«‹çš„å®ä½“ï¼Œé€šè¿‡ä¸€ä¸ªä¸­å¤®å…¥å£ç‚¹æ¥ç»Ÿä¸€ç®¡ç†å’Œæ§åˆ¶ã€‚</p>
<p>ä¸‹é¢é€šè¿‡ä»£ç æ¥è¯´æ˜ Spring Cloud Gateway å¦‚ä½•ä½¿ç”¨ Ambassador æ¨¡å¼ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªåç«¯æœåŠ¡ï¼Œä¸€ä¸ªæ˜¯ user-serviceï¼Œä¸€ä¸ªæ˜¯ order-serviceï¼Œæˆ‘ä»¬å¸Œæœ›é€šè¿‡ Spring Cloud Gateway æ¥å®ç°è´Ÿè½½å‡è¡¡å’Œè·¯ç”±çš„åŠŸèƒ½ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ  Spring Cloud Gateway ä¾èµ–ï¼Œå¯ä»¥åœ¨ Maven ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-gateway<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>ç„¶åï¼Œæˆ‘ä»¬éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½® Spring Cloud Gatewayï¼Œä¾‹å¦‚ application.yml æ–‡ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">gateway</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">routes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">user-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">lb://user-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">Path=/users/**</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l">order-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l">lb://order-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">predicates</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">Path=/orders/**</span><span class="w">
</span></span></span></code></pre></div><p>è¿™æ®µé…ç½®ä»£ç çš„æ„æ€æ˜¯ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªè·¯ç”±è§„åˆ™ï¼Œä¸€ä¸ªæ˜¯å¯¹äº /users/** çš„è¯·æ±‚ï¼Œå°†ä¼šè¢«è·¯ç”±åˆ° user-service æœåŠ¡ä¸Šï¼Œå¦ä¸€ä¸ªæ˜¯å¯¹äº /orders/** çš„è¯·æ±‚ï¼Œå°†ä¼šè¢«è·¯ç”±åˆ° order-service æœåŠ¡ä¸Šã€‚å…¶ä¸­ï¼Œuri å‰ç¼€çš„ lb:// è¡¨ç¤ºä½¿ç”¨è´Ÿè½½å‡è¡¡çš„æ–¹å¼æ¥è·¯ç”±è¯·æ±‚ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† Spring Cloud LoadBalancer ç»„ä»¶æ¥å®ç°è´Ÿè½½å‡è¡¡çš„åŠŸèƒ½ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬éœ€è¦åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ  @EnableGateway æ³¨è§£ï¼Œæ¥å¯ç”¨ Spring Cloud Gatewayï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@SpringBootApplication</span>
</span></span><span class="line"><span class="cl"><span class="nd">@EnableDiscoveryClient</span>
</span></span><span class="line"><span class="cl"><span class="nd">@EnableGateway</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GatewayApplication</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">GatewayApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å®Œæˆäº† Spring Cloud Gateway çš„é…ç½®å’Œå¯ç”¨ã€‚é€šè¿‡ä»¥ä¸Šçš„é…ç½®å’Œä»£ç ï¼Œæˆ‘ä»¬å®ç°äº† Ambassador æ¨¡å¼çš„åŸºæœ¬åŠŸèƒ½ï¼Œå³é€šè¿‡ä¸€ä¸ªä¸­å¤®å…¥å£ç‚¹æ¥ç»Ÿä¸€ç®¡ç†å’Œæ§åˆ¶åç«¯æœåŠ¡ã€‚åŒæ—¶ï¼Œç”±äº Spring Cloud Gateway åŸºäº Reactor Netty å’Œ Spring WebFlux ç­‰æŠ€æœ¯å®ç°ï¼Œå®ƒä¹Ÿå…·æœ‰éå¸¸é«˜çš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§ã€‚</p>
<p>Spring Cloud Gateway æºç ä¸­çš„å®ç°æ–¹å¼ï¼Œä¸»è¦æ˜¯åŸºäº Reactor Netty å’Œ Spring WebFlux æ¡†æ¶æ¥å®ç°çš„ã€‚å®ƒçš„æ ¸å¿ƒç»„ä»¶æ˜¯ GatewayFilter å’Œ RouteLocatorï¼Œå…¶ä¸­ GatewayFilter ç”¨äºå®ç°å„ç§è¿‡æ»¤å™¨ï¼Œä¾‹å¦‚è¯·æ±‚è½¬å‘ã€é‡å®šå‘ã€é™æµå’Œè®¤è¯ç­‰ï¼Œè€Œ RouteLocator ç”¨äºå®ç°åŠ¨æ€è·¯ç”±å’Œè´Ÿè½½å‡è¡¡ç­‰åŠŸèƒ½ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼ŒSpring Cloud Gateway çš„å·¥ä½œåŸç†å¦‚ä¸‹ï¼š</p>
<ol>
<li>Spring Cloud Gateway æ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œç„¶åæ ¹æ®é…ç½®æ–‡ä»¶ä¸­çš„è·¯ç”±è§„åˆ™ï¼Œé€‰æ‹©ä¸€ä¸ªåˆé€‚çš„è·¯ç”±å™¨è¿›è¡Œå¤„ç†ã€‚</li>
<li>è·¯ç”±å™¨ä¼šæ ¹æ®è¯·æ±‚çš„ URL å’Œé…ç½®æ–‡ä»¶ä¸­çš„è·¯ç”±è§„åˆ™ï¼Œé€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªè¿‡æ»¤å™¨å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ã€‚è¿‡æ»¤å™¨å¯ä»¥é€‰æ‹©æ€§åœ°ä¿®æ”¹è¯·æ±‚å’Œå“åº”ï¼Œæˆ–è€…ä¸­æ–­è¯·æ±‚å¹¶è¿”å›å“åº”ã€‚</li>
<li>è¿‡æ»¤å™¨å°†å¤„ç†åçš„è¯·æ±‚å‘é€åˆ°åç«¯æœåŠ¡ï¼Œç„¶åå°†å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li>
<li>åœ¨å¤„ç†è¯·æ±‚å’Œå“åº”çš„è¿‡ç¨‹ä¸­ï¼ŒSpring Cloud Gateway æ”¯æŒå¤šç§åè®®å’Œæ ¼å¼ï¼Œä¾‹å¦‚ HTTPã€WebSocketã€JSON å’Œ XML ç­‰ã€‚</li>
</ol>
<p>åœ¨ Spring Cloud Gateway çš„æºç ä¸­ï¼Œå®ƒçš„æ ¸å¿ƒç»„ä»¶æ˜¯ GatewayFilter å’Œ RouteLocatorã€‚å…¶ä¸­ï¼ŒGatewayFilter æ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨æ¥å£ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªè¿‡æ»¤å™¨çš„åŸºæœ¬æ–¹æ³•é“¾ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡å®ç° GatewayFilter æ¥å£æ¥å®ç°è‡ªå®šä¹‰çš„è¿‡æ»¤å™¨ã€‚è€Œ RouteLocator åˆ™æ˜¯ä¸€ä¸ªè·¯ç”±è§„åˆ™æ¥å£ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªåŠ¨æ€è·¯ç”±è¡¨ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡å®ç° RouteLocator æ¥å£æ¥å®ç°è‡ªå®šä¹‰çš„è·¯ç”±è§„åˆ™ï¼Œä¾‹å¦‚åŸºäºæœåŠ¡å‘ç°çš„è·¯ç”±è§„åˆ™ã€‚</p>
<blockquote>
<p>Spring Cloud Gateway æ”¯æŒ WebSocket åè®®ã€‚WebSocket æ˜¯ä¸€ç§åœ¨å•ä¸ª TCP è¿æ¥ä¸Šè¿›è¡Œå…¨åŒå·¥é€šä¿¡çš„åè®®ï¼Œå®ƒå…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œå®æ—¶äº¤äº’å’Œé€šä¿¡ã€‚Spring Cloud Gateway é€šè¿‡æ”¯æŒ WebSocket åè®®ï¼Œå¯ä»¥å®ç°å®æ—¶é€šä¿¡ã€æ¨é€å’Œå¹¿æ’­ç­‰åŠŸèƒ½ã€‚</p>
<p>è¦åœ¨ Spring Cloud Gateway ä¸­æ”¯æŒ WebSocket åè®®ï¼Œéœ€è¦è¿›è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol>
<li>
<p>å¼•å…¥ Spring Cloud Gateway WebSocket ä¾èµ–ï¼Œå¯ä»¥åœ¨ Maven ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-gateway-websocket<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div></li>
<li>
<p>é…ç½® Spring Cloud Gatewayï¼Œéœ€è¦åœ¨ application.yml æˆ– application.properties æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w"> </span><span class="nt">spring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nt">cloud</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">     </span><span class="nt">gateway</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">       </span><span class="nt">websockets</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">         </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span></code></pre></div><pre><code>  è¿™æ®µé…ç½®ä»£ç çš„æ„æ€æ˜¯ï¼Œå¯ç”¨ Spring Cloud Gateway çš„ WebSocket æ”¯æŒã€‚
</code></pre>
<ol start="3">
<li>
<p>é…ç½® WebSocket è·¯ç”±ï¼Œéœ€è¦åœ¨ application.yml æˆ– application.properties æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"></code></pre></div></li>
</ol>
<p>spring:
cloud:
gateway:
routes:
- id: ws-route
uri: ws://localhost:8080
predicates:
- Path=/ws/**</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">è¿™æ®µé…ç½®ä»£ç çš„æ„æ€æ˜¯ï¼Œå°† /ws/** çš„è¯·æ±‚è·¯ç”±åˆ° uri ä¸º ws://localhost:8080 çš„ WebSocket æœåŠ¡ä¸Šã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">4. å®ç° WebSocket å¤„ç†å™¨ï¼Œéœ€è¦ç¼–å†™ä¸€ä¸ªå®ç° WebSocketHandler æ¥å£çš„å¤„ç†å™¨ï¼Œä¾‹å¦‚ï¼š
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">```java
</span></span><span class="line"><span class="cl">@Component
</span></span><span class="line"><span class="cl">public class EchoWebSocketHandler implements WebSocketHandler {
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    @Override
</span></span><span class="line"><span class="cl">       public Mono&lt;Void&gt; handle(WebSocketSession session) {
</span></span><span class="line"><span class="cl">        // å¤„ç† WebSocketSession
</span></span><span class="line"><span class="cl">        return session.send(session.receive().map(msg -&gt; session.textMessage(&#34;Echo: &#34; + msg.getPayloadAsText())));
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><p>è¿™æ®µä»£ç çš„æ„æ€æ˜¯ï¼Œå®ç°ä¸€ä¸ªå¤„ç†å™¨ï¼Œç”¨æ¥å¤„ç† WebSocketSessionã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œå¤„ç†å™¨ä¼šå°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯è¿›è¡Œå›æ˜¾ï¼Œå¹¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
<ol start="5">
<li>
<p>é…ç½® WebSocket å¤„ç†å™¨ï¼Œéœ€è¦åœ¨ application.yml æˆ– application.properties æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"></code></pre></div></li>
</ol>
<p>spring:
cloud:
gateway:
routes:
- id: ws-route
uri: ws://localhost:8080
predicates:
- Path=/ws/**
filters:
- name: WebSocket
args:
handler: echoWebSocketHandler
subprotocols: subprotocol1, subprotocol2</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">è¿™æ®µé…ç½®ä»£ç çš„æ„æ€æ˜¯ï¼Œå°† WebSocket å¤„ç†å™¨ echoWebSocketHandler ç»‘å®šåˆ° WebSocket è·¯ç”±ä¸Šï¼Œå¹¶æŒ‡å®šäº†å­åè®® subprotocol1 å’Œ subprotocol2ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">è¿™æ ·ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†åœ¨ Spring Cloud Gateway ä¸­æ”¯æŒ WebSocket åè®®çš„é…ç½®å’Œä»£ç å®ç°ã€‚é€šè¿‡ä»¥ä¸Šçš„é…ç½®å’Œä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Spring Cloud Gateway ä¸Šå®ç° WebSocket çš„åŠŸèƒ½ï¼Œä¾‹å¦‚å®æ—¶é€šä¿¡ã€æ¨é€å’Œå¹¿æ’­ç­‰ã€‚
</span></span></code></pre></div></blockquote>
<h2 id="ç›¸å…³æ¨¡å¼">ç›¸å…³æ¨¡å¼</h2>
<ul>
<li><a href="https://java-design-patterns.com/patterns/proxy/">Proxy</a></li>
</ul>
<h2 id="å…¶ä»–">å…¶ä»–</h2>
<h3 id="ambassador-å’Œ-aop">Ambassador å’Œ AOP</h3>
<p>Ambassador è®¾è®¡æ¨¡å¼å’Œ AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰éƒ½æ˜¯ç”¨äºå®ç°æ¨ªåˆ‡å…³æ³¨ç‚¹çš„è®¾è®¡æ¨¡å¼ã€‚å®ƒä»¬éƒ½å¯ä»¥åœ¨ä¸ä¿®æ”¹ç°æœ‰ä»£ç çš„æƒ…å†µä¸‹ï¼Œå¾€ç¨‹åºä¸­æ·»åŠ ä¸€äº›é¢å¤–çš„è¡Œä¸ºï¼Œä¾‹å¦‚æ—¥å¿—è®°å½•ã€æ€§èƒ½ç›‘æ§ã€å®‰å…¨éªŒè¯ç­‰ã€‚</p>
<p>Ambassador è®¾è®¡æ¨¡å¼æ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒé€šè¿‡ä»£ç†å¯¹è±¡æ¥éšè—åº•å±‚æœåŠ¡çš„å®ç°ç»†èŠ‚ï¼Œå¹¶æä¾›ä¸€äº›é¢å¤–çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€æ—¥å¿—è®°å½•å’Œç›‘æ§ç­‰ã€‚åœ¨ Ambassador è®¾è®¡æ¨¡å¼ä¸­ï¼Œä»£ç†å¯¹è±¡å’ŒåŸå§‹å¯¹è±¡éƒ½å®ç°äº†åŒä¸€ä¸ªæ¥å£ï¼Œä»£ç†å¯¹è±¡è´Ÿè´£å°†è°ƒç”¨è½¬å‘åˆ°åŸå§‹å¯¹è±¡ï¼Œå¹¶åœ¨è°ƒç”¨å‰åæ‰§è¡Œä¸€äº›é¢å¤–çš„é€»è¾‘ã€‚</p>
<p>AOP ä¹Ÿæ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒé€šè¿‡å°†æ¨ªåˆ‡å…³æ³¨ç‚¹ä»ä¸šåŠ¡é€»è¾‘ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå®ç°äº†ä¸€ç§åŸºäºåˆ‡é¢çš„æ¨¡å—åŒ–è®¾è®¡ã€‚åœ¨ AOP ä¸­ï¼Œæ¨ªåˆ‡å…³æ³¨ç‚¹è¢«å°è£…æˆåˆ‡é¢ï¼Œå¹¶é€šè¿‡åˆ‡ç‚¹å’Œé€šçŸ¥æ¥å®šä¹‰åˆ‡é¢çš„è¡Œä¸ºã€‚åœ¨ç¨‹åºè¿è¡ŒæœŸé—´ï¼ŒAOP æ¡†æ¶ä¼šåŠ¨æ€åœ°å°†åˆ‡é¢ç»‡å…¥åˆ°ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨ä¸­ï¼Œä»è€Œå®ç°åˆ‡é¢çš„åŠŸèƒ½ã€‚</p>
<p>è™½ç„¶ Ambassador è®¾è®¡æ¨¡å¼å’Œ AOP éƒ½å¯ä»¥å®ç°æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œä½†å®ƒä»¬çš„åº”ç”¨åœºæ™¯å’Œç›®çš„ç•¥æœ‰ä¸åŒã€‚Ambassador è®¾è®¡æ¨¡å¼é€šå¸¸ç”¨äºå®ç°ä¸åº•å±‚æœåŠ¡ç›¸å…³çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€æ—¥å¿—è®°å½•å’Œç›‘æ§ç­‰ã€‚è€Œ AOP åˆ™æ›´åŠ é€šç”¨ï¼Œå¯ä»¥ç”¨äºå®ç°ä»»ä½•ä¸ä¸šåŠ¡é€»è¾‘æ— å…³çš„åŠŸèƒ½ï¼Œä¾‹å¦‚äº‹åŠ¡ç®¡ç†ã€å®‰å…¨éªŒè¯ã€æ€§èƒ½ç›‘æ§ç­‰ã€‚æ­¤å¤–ï¼ŒAOP è¿˜å¯ä»¥é€šè¿‡åˆ‡é¢çš„ç»‡å…¥é¡ºåºæ¥å®ç°ä¸€äº›å¤æ‚çš„åŠŸèƒ½ï¼Œä¾‹å¦‚äº‹åŠ¡åµŒå¥—å’Œå¹¶å‘æ§åˆ¶ç­‰ã€‚</p>
<p>åœ¨å®è·µä¸­ï¼ŒAmbassador è®¾è®¡æ¨¡å¼å’Œ AOP å¯ä»¥ç»“åˆä½¿ç”¨ï¼Œä»è€Œå®ç°æ›´åŠ çµæ´»å’Œå¯æ‰©å±•çš„åº”ç”¨ç¨‹åºè®¾è®¡ã€‚ä¾‹å¦‚ï¼Œåœ¨ä½¿ç”¨ Ambassador è®¾è®¡æ¨¡å¼å®ç°æœåŠ¡è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ AOP æ¥è®°å½•è¯·æ±‚å’Œå“åº”çš„æ—¥å¿—ä¿¡æ¯ï¼Œæˆ–è€…å®ç°å®‰å…¨éªŒè¯å’Œæ€§èƒ½ç›‘æ§ç­‰åŠŸèƒ½ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒAmbassador è®¾è®¡æ¨¡å¼å’Œ AOP é€šå¸¸æ˜¯ç›¸äº’è¡¥å……çš„ï¼Œå¯ä»¥åœ¨ä¸åŒçš„å±‚æ¬¡ä¸Šå®ç°æ¨ªåˆ‡å…³æ³¨ç‚¹çš„åŠŸèƒ½ã€‚</p>
<h3 id="ambassador-å’Œä»£ç†">Ambassador å’Œä»£ç†</h3>
<p>Ambassador è®¾è®¡æ¨¡å¼å’Œä»£ç†æ¨¡å¼éƒ½æ˜¯ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒä»¬éƒ½ä½¿ç”¨ä»£ç†å¯¹è±¡æ¥éšè—çœŸå®å¯¹è±¡çš„å®ç°ç»†èŠ‚ï¼Œå¹¶æä¾›ä¸€äº›é¢å¤–çš„åŠŸèƒ½ã€‚ç„¶è€Œï¼Œå®ƒä»¬çš„ç›®çš„å’Œå®ç°æ–¹å¼ç•¥æœ‰ä¸åŒã€‚</p>
<p>ä»£ç†æ¨¡å¼æ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒé€šè¿‡ä»£ç†å¯¹è±¡æ¥æ§åˆ¶å¯¹çœŸå®å¯¹è±¡çš„è®¿é—®ã€‚åœ¨ä»£ç†æ¨¡å¼ä¸­ï¼Œä»£ç†å¯¹è±¡å’ŒçœŸå®å¯¹è±¡å®ç°ç›¸åŒçš„æ¥å£ï¼Œä»£ç†å¯¹è±¡è´Ÿè´£å°†æ–¹æ³•è°ƒç”¨ä¼ é€’ç»™çœŸå®å¯¹è±¡ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ ä¸€äº›é¢å¤–çš„é€»è¾‘ï¼Œä¾‹å¦‚æƒé™æ§åˆ¶ã€ç¼“å­˜ã€è¿œç¨‹è®¿é—®ç­‰ã€‚ä»£ç†æ¨¡å¼å¯ä»¥åœ¨ä¸ä¿®æ”¹ç°æœ‰ä»£ç çš„æƒ…å†µä¸‹ï¼Œä¸ºçœŸå®å¯¹è±¡æä¾›é¢å¤–çš„åŠŸèƒ½å’Œä¿æŠ¤ã€‚</p>
<p>Ambassador è®¾è®¡æ¨¡å¼ä¹Ÿæ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒé€šè¿‡ä»£ç†å¯¹è±¡æ¥éšè—åº•å±‚æœåŠ¡çš„å®ç°ç»†èŠ‚ï¼Œå¹¶æä¾›ä¸€äº›é¢å¤–çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€æ—¥å¿—è®°å½•å’Œç›‘æ§ç­‰ã€‚åœ¨ Ambassador è®¾è®¡æ¨¡å¼ä¸­ï¼Œä»£ç†å¯¹è±¡å’Œåº•å±‚æœåŠ¡å®ç°ç›¸åŒçš„æ¥å£ï¼Œä»£ç†å¯¹è±¡è´Ÿè´£å°†è°ƒç”¨è½¬å‘åˆ°åº•å±‚æœåŠ¡ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ ä¸€äº›é¢å¤–çš„é€»è¾‘ã€‚Ambassador è®¾è®¡æ¨¡å¼é€šå¸¸ç”¨äºå®ç°ä¸åº•å±‚æœåŠ¡ç›¸å…³çš„åŠŸèƒ½ã€‚</p>
<p>Ambassador è®¾è®¡æ¨¡å¼å’Œä»£ç†æ¨¡å¼åœ¨æŸäº›æ–¹é¢ç¡®å®éå¸¸ç›¸ä¼¼ï¼Œå®ƒä»¬éƒ½ä½¿ç”¨ä»£ç†å¯¹è±¡æ¥éšè—çœŸå®å¯¹è±¡çš„å®ç°ç»†èŠ‚ï¼Œå¹¶æä¾›ä¸€äº›é¢å¤–çš„åŠŸèƒ½ã€‚ç„¶è€Œï¼Œå®ƒä»¬çš„ç›®çš„å’Œåº”ç”¨åœºæ™¯ç•¥æœ‰ä¸åŒï¼Œè¿™ä¹Ÿæ˜¯å®ƒä»¬çš„åŒºåˆ«æ‰€åœ¨ã€‚</p>
<p>ä»£ç†æ¨¡å¼é€šå¸¸ç”¨äºæ§åˆ¶å¯¹çœŸå®å¯¹è±¡çš„è®¿é—®ï¼Œä¾‹å¦‚æƒé™æ§åˆ¶ã€ç¼“å­˜ã€è¿œç¨‹è®¿é—®ç­‰ã€‚å®ƒçš„é‡ç‚¹åœ¨äºå®ç°å¯¹çœŸå®å¯¹è±¡çš„ä¿æŠ¤å’Œæ§åˆ¶ã€‚ä»£ç†æ¨¡å¼çš„åº”ç”¨åœºæ™¯éå¸¸å¹¿æ³›ï¼Œå¯ä»¥ç”¨äºä»»ä½•éœ€è¦å¯¹çœŸå®å¯¹è±¡è¿›è¡Œè®¿é—®æ§åˆ¶å’Œä¿æŠ¤çš„åœºæ™¯ã€‚</p>
<p>Ambassador è®¾è®¡æ¨¡å¼åˆ™æ›´åŠ ä¸“æ³¨äºåº•å±‚æœåŠ¡çš„ä»£ç†å’Œå¢å¼ºï¼Œä¾‹å¦‚æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€æ—¥å¿—è®°å½•å’Œç›‘æ§ç­‰ã€‚å®ƒé€šå¸¸ç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç”¨äºè§£å†³æœåŠ¡é—´çš„é€šä¿¡é—®é¢˜å’Œè´Ÿè½½å‡è¡¡é—®é¢˜ã€‚Ambassador è®¾è®¡æ¨¡å¼çš„é‡ç‚¹åœ¨äºä¸ºåº•å±‚æœåŠ¡æä¾›ä»£ç†å’Œå¢å¼ºåŠŸèƒ½ï¼Œä»¥ä¾¿æ›´å¥½åœ°ç®¡ç†å’Œæ§åˆ¶åº•å±‚æœåŠ¡ã€‚</p>
<p>è™½ç„¶ Ambassador è®¾è®¡æ¨¡å¼å’Œä»£ç†æ¨¡å¼åœ¨æŸäº›æ–¹é¢éå¸¸ç›¸ä¼¼ï¼Œä½†å®ƒä»¬åœ¨å®é™…åº”ç”¨ä¸­é€šå¸¸è¢«ç”¨äºä¸åŒçš„åœºæ™¯å’Œç›®çš„ã€‚åœ¨å®è·µä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å…·ä½“çš„éœ€æ±‚å’Œåº”ç”¨åœºæ™¯æ¥é€‰æ‹©ä½¿ç”¨å“ªç§æ¨¡å¼ï¼Œæˆ–è€…å°†å®ƒä»¬ç»“åˆèµ·æ¥ä½¿ç”¨ï¼Œä»¥å®ç°æ›´åŠ çµæ´»å’Œå¯æ‰©å±•çš„åº”ç”¨ç¨‹åºè®¾è®¡ã€‚</p>
<h2 id="å‚è€ƒæ–‡ç« ">å‚è€ƒæ–‡ç« </h2>
<ol>
<li><a href="https://docs.microsoft.com/en-us/azure/architecture/patterns/ambassador">Ambassador Pattern</a>: è¯¥æ–‡ç« ä»‹ç»äº† Ambassador æ¨¡å¼çš„æ¦‚å¿µå’Œåº”ç”¨åœºæ™¯ï¼Œå¹¶æä¾›äº†ä¸€äº›å®é™…æ¡ˆä¾‹ä¾›å‚è€ƒã€‚</li>
<li><a href="https://dzone.com/articles/design-patterns-for-microservices-ambassador-anti">Design Patterns for Microservices: Ambassador, Anti-Corruption Layer, and Backends for Frontends</a> : è¿™ç¯‡æ–‡ç« ä»‹ç»äº†åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ä½¿ç”¨çš„ä¸¤ç§è®¾è®¡æ¨¡å¼ï¼šAmbassador æ¨¡å¼å’Œ Anti-corruption Layer æ¨¡å¼ã€‚ã€‚</li>
<li><a href="https://itnext.io/ambassador-and-istio-edge-proxy-and-service-mesh-814aac9f23df">The Ambassador pattern and Istio</a>: è¿™ç¯‡æ–‡ç« ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ Istio å’Œ Ambassador æ¨¡å¼æ¥å®ç°å¾®æœåŠ¡çš„è¾¹ç¼˜ä»£ç†å’ŒæœåŠ¡ç½‘æ ¼ã€‚</li>
<li><a href="https://medium.com/bb-tutorials-and-thoughts/kubernetes-learn-ambassador-container-pattern-bc2e1331bd3a">Kubernetes â€” Learn Ambassador Container Pattern</a> ä»‹ç»äº†å¦‚ä½•åœ¨ Kubernetes ä¸­ä½¿ç”¨ Ambassador æ¨¡å¼æ¥è§£å†³å¾®æœåŠ¡é€šä¿¡çš„é—®é¢˜ã€‚</li>
<li><a href="https://blog.getambassador.io/api-gateway-vs-service-mesh-104c01fa4784">Ambassador vs API Gateway</a>: è¯¥æ–‡ç« å¯¹æ¯”äº† Ambassador æ¨¡å¼å’Œä¼ ç»Ÿçš„ API ç½‘å…³çš„ä¼˜ç¼ºç‚¹ï¼Œåˆ†æäº†å®ƒä»¬åœ¨ä¸åŒåœºæ™¯ä¸‹çš„åº”ç”¨å’Œé€‚ç”¨æ€§ã€‚</li>
</ol>
]]></content:encoded>
    </item>
    
    <item>
      <title>å‘¨æŠ¥-25ï½œç«¯åˆå®‰åº·</title>
      <link>https://blog.chensoul.com/posts/2023/06/28/weekly_review_25/</link>
      <pubDate>Wed, 28 Jun 2023 09:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/06/28/weekly_review_25/</guid>
      <description>å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-06-19 åˆ° 2023-06-25 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚ è¯»ä¹¦ã€å¥èº«ã€æŠ•èµ„ã€å¸®æœ‹å‹ã€é™ªå®¶äººã€‚ è¿™å‘¨å› ä¸ºç«¯åˆèŠ‚</description>
      <content:encoded><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p>æœ¬ç¯‡æ˜¯å¯¹ <code>2023-06-19</code> åˆ° <code>2023-06-25</code> è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº <a href="https://blog.chensoul.com/">åšå®¢</a>ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚</p>
<blockquote>
<p>è¯»ä¹¦ã€å¥èº«ã€æŠ•èµ„ã€å¸®æœ‹å‹ã€é™ªå®¶äººã€‚</p>
</blockquote>
<p>è¿™å‘¨å› ä¸ºç«¯åˆèŠ‚ï¼Œåªä¸Šä¸‰å¤©ç­ï¼Œæ”¾ä¸‰å¤©å‡ã€‚ç¥æ„¿æ‰€æœ‰çˆ¶æ¯ç«¯åˆå®‰åº·ï¼</p>
<h2 id="è¯»ä¹¦">è¯»ä¹¦</h2>
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-25-03.jpeg" alt="weekly-review-25-03" style="width:50%;" />
<p>æœ¬å‘¨é˜…è¯»æ—¶é•¿15åˆ†é’Ÿï¼Œä¸»è¦æ˜¯é˜…è¯»ã€ŠJavaé«˜å¹¶å‘æ ¸å¿ƒç¼–ç¨‹ï¼šå¤šçº¿ç¨‹ã€é”ã€JVMã€JUCã€é«˜å¹¶å‘è®¾è®¡æ¨¡å¼ã€‹ã€‚</p>
<h2 id="å¥èº«">å¥èº«</h2>
<blockquote>
<p>æˆ‘è·‘è¿‡äº†ä¸€äº›åœ°æ–¹ï¼Œå¸Œæœ›éšç€æ—¶é—´æ¨ç§»ï¼Œåœ°å›¾ç‚¹äº®çš„åœ°æ–¹è¶Šæ¥è¶Šå¤šã€‚2 å¹´é‡Œæˆ‘è·‘è¿‡ 2ä¸ªçœä»½ 2ä¸ªåŸå¸‚ã€‚æ›´å¤šè·‘æ­¥æ•°æ®åœ¨æˆ‘çš„ <a href="https://run.chensoul.com/">è·‘æ­¥</a> ä¸»é¡µã€‚</p>
</blockquote>
<p>æœ¬å‘¨å°šæœªè·‘æ­¥ã€‚æœ€è¿‘ä¸Šç­æ²¡æœ‰å¸¦é¥­ï¼Œæ¯å¤©ä¸­åˆåƒé¥­éƒ½è¶…æ ‡äº†ï¼Œæ¯å¤©ä¹Ÿæ²¡æœ‰æµ‹é‡ä½“é‡ï¼Œä¸¥é‡æ€€ç–‘ä½“é‡åˆæ¶¨äº†å‡ æ–¤ã€‚è¿™ä¸ªæœˆä¹Ÿå¿«ç»“æŸäº†ï¼Œä¸‹ä¸ªæœˆç»§ç»­å‡è‚¥ã€‚</p>
<h2 id="ç†è´¢">ç†è´¢</h2>
<p>è¿™å‘¨æ€»è®¡æ”¯å‡º 1027 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>6æœˆ25æ—¥ï¼š30å…ƒ</p>
</li>
<li>
<p>6æœˆ24æ—¥ï¼š133å…ƒ</p>
</li>
<li>
<p>6æœˆ23æ—¥ï¼š462å…ƒ</p>
</li>
<li>
<p>6æœˆ22æ—¥ï¼š69å…ƒ</p>
</li>
<li>
<p>6æœˆ21æ—¥ï¼š147å…ƒ</p>
</li>
<li>
<p>6æœˆ20æ—¥ï¼š159å…ƒ</p>
</li>
<li>
<p>6æœˆ19æ—¥ï¼š27å…ƒ</p>
</li>
</ul>
<h2 id="é™ªå®¶äºº">é™ªå®¶äºº</h2>
<p>å†œå†5æœˆ4æ—¥ï¼Œå…­èˆ…èµ°äº†ã€‚ç«¯åˆèŠ‚çš„ä¸‰å¤©å‡æœŸï¼Œä¸»è¦æ˜¯å›å»å¥”ä¸§ï¼Œé€å…­èˆ…æœ€åä¸€ç¨‹ã€‚</p>
<p>ç®—äº†ä¸‹æ—¥å­ï¼Œè€çˆ¸æ¥é˜³é€»å¿«ä¸€ä¸ªæœˆäº†ï¼Œè€å©†æ”¾ä¸‹æ‰‹ä¸Šçš„å·¥ä½œå›æ¥ç…§é¡¾è€çˆ¸ä¹Ÿæœ‰ä¸¤å‘¨æ—¶é—´äº†ã€‚çœ‹å¾—å‡ºæ¥ï¼Œè€å©†æœ‰æ•ˆç–²æƒ«äº†ã€‚è€çˆ¸ç°åœ¨å¯ä»¥èµ°ï¼Œä½†æ˜¯èµ°çš„ä¸å¤Ÿåˆ©ç´¢ã€‚å¸Œæœ›è€çˆ¸æ¢å¤å¾—å†å¿«äº›ï¼Œè®©è€å©†å›å»ä¸Šç­ã€‚å¦‚æœ‰å¯èƒ½ï¼Œä¸‹å‘¨æœ«æŠŠè€çˆ¸é€å›è€å®¶ï¼Œè®©è€çˆ¸è‡ªå·±åœ¨å®¶ç…§é¡¾è‡ªå·±ã€‚å†œæ‘çš„ç©ºæ°”å¥½äº›ï¼Œä¸ä¼šæ†‹å¾—æ…Œã€‚ä½†è¿˜æ˜¯æ‹…å¿ƒå¤©æ°”å¤ªçƒ­ï¼Œè€çˆ¸ç…§é¡¾ä¸å¥½è‡ªå·±ã€‚åœ¨ç…§é¡¾è€çˆ¸çš„äº‹æƒ…ï¼Œé™¤äº†èƒ½å¤Ÿä¾é è€å©†ï¼Œå…¶ä»–è°éƒ½é ä¸ä¸Šã€‚ä½†æ˜¯ï¼Œè€å©†ä¹Ÿæœ‰å·¥ä½œè¦å¤„ç†ï¼Œæˆ‘çš„å·¥ä½œåˆä¸èƒ½è¾æ‰ã€‚è¿™å¤§æŠµç®—æ˜¯å…«é›¶åçš„å‹åŠ›å§ï¼Œçˆ¶äº²åœ¨ä¹°æˆ¿ä¹°è½¦ç»“å©šä¸Šæ²¡æœ‰å¸®ä¸Šå¿™ï¼Œåè€Œè¿˜ä¼šå› ä¸ºè‡ªå·±ä¸å¥½å¥½ç…§é¡¾è‡ªå·±è€Œç»™å­å¥³å¢åŠ è´Ÿæ‹…ã€‚æ€»æ˜¯è·Ÿè€çˆ¸è¯´è¿™è¯¥åšé‚£ä¸è¯¥åšï¼Œè€çˆ¸å°±åƒä¸ªå­©å­ä¼¼çš„ï¼Œä¸€ç‚¹éƒ½ä¸å¬è¯ã€‚</p>
<p>å‘¨å…­ï¼Œåœ¨é»„çŸ³å¼€ç‰™åŒ»é™¢çš„è¡¨å“¥çš„å¥³å„¿è€ƒä¸Šå¢¨å°”æœ¬çš„ç ”ç©¶ç”Ÿåœ¨è€å®¶åŠé…’ã€‚ä¹Ÿè®¸æ˜¯ä¸Šäº†å¹´çºªçš„ç¼˜æ•…ï¼Œä¹Ÿè®¸æ˜¯è€çˆ¸å–œæ¬¢å‡‘çƒ­é—¹ï¼Œè€çˆ¸æƒ³å»å–é…’ã€‚äºæ˜¯ï¼Œæˆå…¨äº†è€çˆ¸çš„å¿ƒæ„¿ã€‚è€çˆ¸å¹´çºªå¤§äº†ï¼Œå°½å¯èƒ½çš„æ»¡è¶³è€çˆ¸çš„ä¸€äº›æƒ³æ³•å’Œå¿ƒæ„¿ï¼Œå°½å¯èƒ½çš„å¸¦è€çˆ¸ä½“éªŒ&quot;æ–°é²œ&quot;çš„äº‹ç‰©ï¼Œæ¯”å¦‚ï¼Œçœ‹ç”µå½±ï¼Œæ—…æ¸¸ã€‚äºæ˜¯ï¼Œå‘¨å››å¸¦è€çˆ¸å»çœ‹äº†ç”µå½±ã€Šæ¶ˆå¤±çš„å¥¹ã€‹ã€‚è¿˜æœ‰ä»€ä¹ˆäº‹æƒ…å¯ä»¥åšå‘¢ï¼Ÿè¿™æ ·ä¸€æƒ³ï¼Œè€çˆ¸å¹´çºªè¶Šæ¥è¶Šå¤§äº†ï¼Œè…¿è„šè¶Šæ¥è¶Šä¸åˆ©ç´¢ï¼Œèƒ½å¤Ÿåšçš„äº‹æƒ…è¶Šæ¥è¶Šå°‘äº†ã€‚è¶å…‰é˜´è¿˜åœ¨ï¼Œå¤šé™ªé™ªçˆ¶æ¯ï¼Œå¸¸å›å®¶çœ‹çœ‹ã€‚</p>
<h2 id="å·¥ä½œ">å·¥ä½œ</h2>
<p>æœ€è¿‘åœ¨å­¦ä¹ çš„å†…å®¹æ¸…å•ï¼š</p>
<ul>
<li><a href="https://github.com/clxering/Effective-Java-3rd-edition-Chinese-English-bilingual/tree/dev">Effective Javaï¼ˆç¬¬ 3 ç‰ˆï¼‰</a></li>
<li><a href="https://java-design-patterns.com/zh/">Java Design Patterns (ä¸­æ–‡)</a></li>
<li><a href="https://realpython.com/">Real Python</a></li>
</ul>
<p>æœ¬å‘¨å®Œæˆäº”ç¯‡åšå®¢ï¼š</p>
<ul>
<li><a href="/posts/2023/06/26/microservice-design-patterns/">[è¯‘]å¾®æœåŠ¡è®¾è®¡æ¨¡å¼</a></li>
<li><a href="/posts/2023/06/26/java-design-patterns-aggregator-microservices/">Javaè®¾è®¡æ¨¡å¼ï¼šAggregator Microservices</a></li>
<li><a href="/posts/2023/06/25/python-function/">Pythonå­¦ä¹ 5ï¼šå‡½æ•°</a></li>
<li><a href="/posts/2023/06/25/python-modules-packages/">[è¯‘]Pythonæ¨¡å—å’ŒåŒ…-ç®€ä»‹</a></li>
<li><a href="/posts/2023/06/25/developing-with-bottle/">[è¯‘]ç”¨ Bottle å¼€å‘</a></li>
</ul>
<h2 id="æœ¬å‘¨åˆ†äº«">æœ¬å‘¨åˆ†äº«</h2>
<p>å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€<a href="https://t.me/chensoul_share">ChenSoul Share</a>ã€Telegram é¢‘é“æˆ–è€…æˆ‘çš„ <a href="https://memos.chensoul.com/">Memos</a> ä¸­ã€‚æˆ‘å†™äº†ä¸€ä¸ª Python è„šæœ¬ä» Memos è¯»å–æœ€è¿‘ä¸€å‘¨å¸¦æœ‰ <code>#memos</code> æ ‡ç­¾çš„è®°å½•ï¼Œåˆ†äº«åˆ°è¿™é‡Œã€‚</p>
<ul>
<li>ğŸ“Œ<code>2023-06-24</code> 365èµ„è®¯ç®€æŠ¥ï¼Œæ¯å¤©ç²¾é€‰15æ¡çƒ­ç‚¹æ–°é—»ç®€æŠ¥1æ¡å¾®è¯­ï¼Œæ¯å¤©ä¸€åˆ†é’Ÿï¼ŒçŸ¥æ™“å¤©ä¸‹äº‹ï¼  2023å¹´6æœˆ24æ—¥ æ˜ŸæœŸå…­ å†œå†äº”æœˆåˆä¸ƒ  1. å†…è’™å¤ã€ä¸Šæµ·ã€äº‘å—ç­‰åœ°é™†ç»­å…¬å¸ƒ2023é«˜è€ƒåˆ†æ•°çº¿ã€‚  2. å…¨å›½å¤šåœ°ä»æœ‰è¶…40â„ƒé«˜æ¸©ï¼Œä¸­å›½æ°”è±¡å±€å¯åŠ¨å››çº§åº”æ€¥å“åº”ã€‚  3. æ•°å­—äººæ°‘å¸æ— ç½‘æ— ç”µæ”¯ä»˜ï¼Œåœ¨å…¨å›½è½¨é“äº¤é€šåº”ç”¨åœºæ™¯é¦–æ¬¡è½åœ°ã€‚  4. è¿ˆå…¥åŠ¨è½¦æ—¶ä»£ï¼7æœˆ1æ—¥ï¼Œå¤å…´å·å°†åœ¨é’è—é“è·¯ä¸Šè¿è¥ã€‚  5. æ·±åœ³å·²æ”¶åˆ°1635ä»¶ä¸ªäººç ´äº§ç”³è¯·ï¼ŒåŸå› åŒ…æ‹¬è¶…å‰æ¶ˆè´¹ã€ç»è¥ä¸å–„ç­‰ã€‚  6. å¥³ç¯®äºšæ´²æ¯æœ€æ–°å®åŠ›æ¦œï¼Œä¸­å›½å¥³ç¯®åè¶…æ—¥æœ¬å‡è‡³ç¬¬ä¸€ä½ã€‚  7. é“¶å·çƒ§çƒ¤åº—çˆ†ç‚¸äº‹æ•…é¢„ä¼°ä¿é™©èµ”ä»˜è¶…1400ä¸‡å…ƒï¼Œé¦–ç¬”èµ”ä»˜æ¬¾å·²åˆ°ä½ã€‚  8. è¾½å®è¥å£ä¸€é’¢é“å‚çƒ«ä¼¤äº‹æ•…ï¼Œ4æ­»5ä¼¤ï¼Œä¸“å®¶ç»„åˆæ­¥è®¤å®šç³»è®¾å¤‡æ•…éšœæ‰€è‡´ã€‚  9. ç¬¬28å±Šç™½ç‰å…°å¥–æ­æ™“ï¼šæ¼”å‘˜é›·ä½³éŸ³ã€å´è¶Šåˆ†è·æœ€ä½³ç”·ã€å¥³ä¸»è§’ã€‚  10. å·´è²ç‰¹å†æ46äº¿ç¾å…ƒè‚¡ç¥¨ï¼Œæ‰¿è¯º99ï¼…ä»¥ä¸Šçš„é—äº§å°†ç”¨äºæ…ˆå–„ã€‚  11. æ—¥æœ¬å¹¿å²›å’Œå¹³çºªå¿µå…¬å›­å°†ä¸ç¾å›½çç æ¸¯å…¬å›­ç»“ä¸ºâ€œå§å¦¹å…¬å›­â€ã€‚  12. æ²™ç‰¹å®£å¸ƒï¼šé€€å‡º2030å¹´ä¸–ç•Œæ¯ç”³åŠå·¥ä½œã€‚  13. è«è¿ªåœ¨ç¾å›½æ”¾å‡ºè±ªè¨€ï¼šå°åº¦å¾ˆå¿«å°†æ˜¯ä¸–ç•Œç¬¬ä¸‰å¤§ç»æµä½“ã€‚  14. ç¾å›½â€œé‡Œæ ¹â€å·èˆªæ¯å°†åœé è¶Šå—æ¸¯å£ï¼Œè¶Šæ–¹ç§°â€œæ­£å¸¸å‹å¥½äº¤æµâ€ã€‚  15. è¥¿æ–¹å®˜å‘˜ç§°ä¹Œåæ”»æ—©æœŸ&quot;ä½äºé¢„æœŸ&quot;ï¼Œä¹Œå®˜å‘˜ï¼šä¸»è¦åæ”»è¿˜æ²¡å¼€å§‹ï¼Œç§‹å†¬å†çœ‹æˆæœã€‚  ã€å¾®è¯­ã€‘å¿ƒæœ‰ä¸‡ä¸‡å¿µï¼Œä¸€å¿µä¸€ä¸–ç•Œã€‚é™ï¼Œä¸æ˜¯è€³è¾¹æ— å£°ï¼Œè€Œæ˜¯å¿ƒä¸­æ— äº‰ã€‚  æ–°é—»æ¥æºï¼š<a href="https://www.163.com/dy/article/I7VSKUF90534QBVQ.html?spss=dy_author">https://www.163.com/dy/article/I7VSKUF90534QBVQ.html?spss=dy_author</a>  <code>#æ¯æ—¥æ—©æŠ¥</code> <code>#memos</code></li>
<li>ğŸ“Œ<code>2023-06-22</code> 365èµ„è®¯ç®€æŠ¥ï¼Œæ¯å¤©ç²¾é€‰15æ¡çƒ­ç‚¹æ–°é—»ç®€æŠ¥1æ¡å¾®è¯­ï¼Œæ¯å¤©ä¸€åˆ†é’Ÿï¼ŒçŸ¥æ™“å¤©ä¸‹äº‹ï¼  2023å¹´6æœˆ22æ—¥ æ˜ŸæœŸå›› å†œå†äº”æœˆåˆäº” ç«¯åˆèŠ‚  1. ä¸‰éƒ¨é—¨ï¼šæ–°èƒ½æºæ±½è½¦å…å¾è´­ç½®ç¨å»¶ç»­è‡³2025å¹´åº•ï¼Œ2026-2027å¹´å‡åŠå¾æ”¶ã€‚  2. åŒ»ä¿å±€ï¼šæé€ŸåŒ»ä¿è½¬ç§»æ¥ç»­ï¼Œå°†åŠç†æ—¶é•¿ç”±45ä¸ªå·¥ä½œæ—¥å‹ç¼©ä¸º15ä¸ªå·¥ä½œæ—¥ã€‚  3. æ•™è‚²éƒ¨ï¼šå»ºç«‹é«˜æ ¡æ¯•ä¸šç”Ÿæ¯•ä¸šå»å‘ç™»è®°åˆ¶åº¦ã€‚  4. ä»Šå¹´ç«¯åˆé¢„è®¡æ—…æ¸¸äººæ¬¡è¾¾1äº¿ï¼Œä»¥å‘¨è¾¹æ¸¸ã€è¿‘ç¨‹æ¸¸ä¸ºä¸»ï¼Œæ°‘å®¿ä»·æ ¼é«˜äºäº”ä¸€ã€‚  5. é«˜æ¸©é»„è‰²é¢„è­¦ï¼šé¢„è®¡ä»Šå¤©ç™½å¤©ï¼Œäº¬æ´¥å†€ç­‰åœ°æœ€é«˜æ°”æ¸©å¯è¾¾40â„ƒä»¥ä¸Šã€‚  6. ä¸­å›½å°çƒåä¼šï¼šå¤„ç½š10åæ‰“å‡çƒçš„çƒå‘˜ï¼Œå…¶ä¸­æ¢æ–‡åšã€æè¡Œè¢«ç»ˆèº«ç¦èµ›ã€‚  7. å¦é—¨ç«‹æ³•ç¦æ–‘é©¬çº¿ä¸Šåˆ·æ‰‹æœºï¼Œè¿è€…æˆ–è¢«ç½šæ¬¾50å…ƒï¼Œ8æœˆ1æ—¥èµ·æ–½è¡Œã€‚  8. æµ™æ±Ÿå¤šåœ°å¼€æ”¾å…±äº«æœºå…³ä¼äº‹ä¸šå•ä½æœåŠ¡èµ„æºï¼Œå«ä¼šè®®å®¤ã€å¥èº«æˆ¿ç­‰ã€‚  9. å¹¿å·æ‹Ÿé™è¡Œ&quot;ç”µé©´&quot;ï¼šä¸åˆ°6äººå°±æ‹¥æœ‰1è¾†ï¼Œè¿œè¶…é“è·¯æ‰¿è½½èƒ½åŠ›ã€‚  10. ç¦å»ºå¤§ç”°ç§»é£æ˜“ä¿—è§æˆæ•ˆï¼šæ–‡æ˜æ–°é£æ‚„ç„¶å…´èµ·ï¼Œç»“å©šå‡ºç°é›¶å½©ç¤¼ã€‚  11. ç†ŠçŒ«å…¬å›­å…¨é¢å¯åŠ¨å»ºè®¾ï¼ŒåŒ—äº¬å°†è¿æ¥è¿‘50åªå¤§ç†ŠçŒ«ã€‚  12. ç ”ç©¶ï¼šå–œé©¬æ‹‰é›…å†°å·æˆ–åœ¨æœ¬ä¸–çºªæœ«æ¶ˆè80%ï¼Œå½±å“äºšæ´²20äº¿äººã€‚  13. ä¸­å¡å†ç­¾é‡ç£…å¤©ç„¶æ°”åè®®ï¼š27å¹´ä¾›æ°”é•¿åï¼Œä¸­çŸ³æ²¹å…¥è‚¡å¡å¡”å°”è¶…å¤§æ°”ç”°ã€‚  14. è‹±å›½å€ºåŠ¡è¶…2.5ä¸‡äº¿è‹±é•‘ï¼Œ60ä½™å¹´æ¥é¦–è¶…å›½å†…ç”Ÿäº§æ€»å€¼ã€‚  15. æ¬§ç›Ÿå°±å¯¹ä¿„å®æ–½ç¬¬11è½®åˆ¶è£è¾¾æˆä¸€è‡´ã€‚  ã€å¾®è¯­ã€‘ç«¯åˆä½³èŠ‚è‡³ï¼Œé£æ‘‡è‰¾è‰ï¼Œç²½å¶é£˜é¦™ï¼Œæ„¿ä½ å¤æ—¥æ¸…å¹³ï¼Œå–œä¹å®‰åº·ã€‚  æ–°é—»æ¥æºï¼š<a href="https://www.163.com/dy/article/I7QN8IJB0534QBVQ.html?spss=dy_author">https://www.163.com/dy/article/I7QN8IJB0534QBVQ.html?spss=dy_author</a>  <code>#æ¯æ—¥æ—©æŠ¥</code> <code>#memos</code></li>
<li>ğŸ“Œ<code>2023-06-21</code> 365èµ„è®¯ç®€æŠ¥ï¼Œæ¯å¤©ç²¾é€‰15æ¡çƒ­ç‚¹æ–°é—»ç®€æŠ¥1æ¡å¾®è¯­ï¼Œæ¯å¤©ä¸€åˆ†é’Ÿï¼ŒçŸ¥æ™“å¤©ä¸‹äº‹ï¼  2023å¹´6æœˆ21æ—¥ æ˜ŸæœŸä¸‰ å†œå†äº”æœˆåˆå›› ä»Šæ—¥å¤è‡³  1. é™æ¯æ¥äº†ï¼šä¸€å¹´æœŸLPRä¸º3.55%ï¼Œäº”å¹´æœŸä»¥ä¸ŠLPRä¸º4.2%ï¼Œå‡ä¸‹é™10ä¸ªåŸºç‚¹ã€‚  2. æ•™è‚²éƒ¨å‘å¸ƒå…¨å›½é«˜æ ¡åå•ï¼Œæˆªè‡³ç›®å‰ï¼Œå…¨å›½é«˜ç­‰å­¦æ ¡å…±è®¡3072æ‰€ã€‚  3. å¤§é™†æ¢å¤å°åœ°åŒºç•ªè”æè¾“å…¥ï¼Œå°å†œï¼šæœŸç›¼è¿™å¤©åˆ°æ¥å·²ç­‰è¿‘3å¹´ã€‚  4. åŒ—äº¬å¸‚æœªæˆå¹´äººä¿æŠ¤å®£æ•™è”ç›Ÿæˆç«‹ï¼Œæ—¨åœ¨æ¨åŠ¨åŒ—äº¬å¸‚æœªæˆå¹´äººä¿æŠ¤å·¥ä½œé«˜è´¨é‡å‘å±•ã€‚  5. å¹¿å·å¿«é€’æ–°è§„ï¼šå¿«é€’å…¥æŸœéœ€æ”¶ä»¶äººåŒæ„ï¼Œè™šå‡ç­¾æ”¶å¿«é€’æœ€é«˜å¯ç½šä¸‰ä¸‡ã€‚  6. æ­å·æ‹Ÿç«‹æ³•ä¼ æ‰¿å‘å±•è€å­—å·ï¼Œé¼“åŠ±èŒä¸šå­¦æ ¡å¼€è®¾ä¼ ç»ŸæŠ€è‰ºè¯¾ç¨‹ã€‚  7. æ²ˆé˜³ï¼šå…¨æ—¥åˆ¶ä¸­ä¸“ä»¥ä¸Šæ¯•ä¸šç”Ÿè´­æˆ¿å¯äº«å—å…¨é¢å¥‘ç¨è¡¥è´´ã€‚  8. æµ™æ±Ÿï¼šä¸‰å¹´å°†åŸ¹è‚²åƒåçœçº§ä¹¡æ‘å·¥åŒ åå¸ˆï¼Œå…¶å­å¥³æ•™è‚²ã€è´­æˆ¿ç­‰å¯äº«ä¼˜æƒ ã€‚  9. å†…è’™å¤å‰äº”æœˆå®‰å…¨ç”Ÿäº§äº‹æ•…æ­»äº¡160äººï¼Œæ–°äº•ç…¤çŸ¿äº‹æ•…å¤±è”è€…å…¨éƒ¨é‡éš¾ã€‚  10. é˜¿é‡Œé›†å›¢å®£å¸ƒæ¢å¸…ï¼šå¼ å‹‡9æœˆå¸ä»»è‘£äº‹é•¿å’ŒCEOï¼Œè”¡å´‡ä¿¡å’Œå´æ³³é“­æ¥ä»»ã€‚  11. å›½è¶³çƒ­èº«èµ›2-0å·´å‹’æ–¯å¦ï¼Œç»ˆç»“14å¹´ä¸èƒœå¯¹æ‰‹å°´å°¬çºªå½•ã€‚  12. çˆ±å°”å…°ä¸ºå‡æ’æ‹Ÿåœ¨ä»Šåä¸‰å¹´å†…å®°æ€çº¦20ä¸‡å¤´ç‰›ï¼Œä»¥è¾¾åˆ°å…¶æ¸©å®¤æ°”ä½“å‡æ’ç›®æ ‡ã€‚  13. ç»Ÿè®¡ï¼šè¿ç»­3å¹´ï¼ŒéŸ©å›½60-69å²å°±ä¸šäººå£æ•°é«˜äº20-29å²å¹´é¾„æ®µã€‚  14. å¤–åª’ï¼šå°åº¦è‚¡å¸‚å¸‚å€¼åˆ›æ–°é«˜ï¼Œå·²è¶…è‹±æ³•ï¼Œä½å±…å…¨çƒç¬¬å››ã€‚  15. å­ŸåŠ æ‹‰å›½æ­£å¼ç”³è¯·åŠ å…¥é‡‘ç –å›½å®¶ï¼Œå¤–äº¤éƒ¨ï¼šæ¬¢è¿æ›´å¤šä¼™ä¼´åŠ å…¥ã€‚  ã€å¾®è¯­ã€‘å¤è‡³è‰å§‹é¸£ï¼Œä¸‡ç‰©çš†ç¹ç››ï¼Œæ„¿æ‰€æœ‰æ˜¥å¤©é‡Œçš„é…é…¿ï¼Œéƒ½åœ¨è¿™ä¸ªå¤å¤©çƒ­çƒˆç»½æ”¾ï¼Œä¸€è·¯èŠ¬èŠ³ï¼Œä¸è´ŸéŸ¶åã€‚  æ–°é—»æ¥æºï¼š<a href="https://www.163.com/dy/article/I7O5BKR40534QBVQ.html?spss=dy_author">https://www.163.com/dy/article/I7O5BKR40534QBVQ.html?spss=dy_author</a>  <code>#æ¯æ—¥æ—©æŠ¥</code> <code>#memos</code></li>
<li>ğŸ“Œ<code>2023-06-20</code> 365èµ„è®¯ç®€æŠ¥ï¼Œæ¯å¤©ç²¾é€‰15æ¡çƒ­ç‚¹æ–°é—»ç®€æŠ¥1æ¡å¾®è¯­ï¼Œæ¯å¤©ä¸€åˆ†é’Ÿï¼ŒçŸ¥æ™“å¤©ä¸‹äº‹ï¼  2023å¹´6æœˆ19æ—¥ æ˜ŸæœŸä¸€ å†œå†äº”æœˆåˆäºŒ  1. æ°”è±¡å°ï¼šé¢„è®¡19æ—¥è‡³21æ—¥å—æ–¹æœ‰å¤§èŒƒå›´è¾ƒå¼ºé™æ°´è¿‡ç¨‹ï¼Œä¸œåŒ—ç­‰åœ°é«˜æ¸©å¤©æ°”å‡å¼±ã€‚  2. å›½å®¶é˜²æ€»ï¼šå°†é˜²æ±›å››çº§åº”æ€¥å“åº”èŒƒå›´æ‰©å±•è‡³æ¡‚è‹æµ™çš–èµ£é„‚æ¹˜é»”å…«çœä»½ã€‚  3. å†œä¸šå†œæ‘éƒ¨ï¼šå…¨å›½å·²æ”¶è·å†¬å°éº¦é¢ç§¯è¶…è¿‡2.97äº¿äº©ï¼Œæ”¶è·è¿›åº¦è¿‡ä¹æˆäº”ã€‚  4. æµ·å…³æ€»ç½²ï¼šå»å¹´ï¼Œä¸­å›½è·¨å¢ƒç”µå•†è¿›å‡ºå£è§„æ¨¡é¦–æ¬¡çªç ´2ä¸‡äº¿å…ƒäººæ°‘å¸ã€‚  5. 618æœ€æ–°è°ƒæŸ¥ï¼š75%çš„äººè´­ç‰©æ„æ„¿æ¯”å»å¹´å‡å°‘ï¼Œ60%çš„äººé¢„ç®—ä¸è¶…è¿‡500å…ƒã€‚  6. äº¬ä¸œ618æœ€æ–°æ•°æ®ï¼šå¹¿ä¸œäººè‰è”è´­ä¹°åŠ›å…¨å›½ç¬¬ä¸€ã€‚  7. é‡åº†ï¼š8æœˆ1æ—¥èµ·ï¼Œé¤é¥®ä¸šã€æ—…æ¸¸ä½å®¿ä¸šä¸å¾—ä¸»åŠ¨æä¾›ä¸€æ¬¡æ€§ç”¨å“ã€‚  8. å¤©æ´¥ï¼šæ‹Ÿæé«˜é¦–å¥—æˆ¿å…¬ç§¯é‡‘è´·æ¬¾é¢åº¦ï¼Œæœ€é«˜100ä¸‡å…ƒã€‚  9. åä¸ºè½®å€¼è‘£äº‹é•¿èƒ¡åšå´‘ï¼šæœ€æ–°è¶…å¿«å……æŠ€æœ¯å¯15åˆ†é’Ÿå……æ»¡ä¸€è¾†æ–°èƒ½æºè½¦ã€‚  10. ç»æµå­¦å®¶æå®ï¼šæˆ‘å›½ä¸­ç­‰æ”¶å…¥ç¾¤ä½“æˆ–å·²è¾¾4.6äº¿ï¼Œæ¯æœˆæŒ£3000å…ƒå·¦å³å°±ç®—ã€‚  11. ç¯å¡”ä¸“ä¸šç‰ˆæ•°æ®ï¼š2023å¹´ç«¯åˆæ¡£æ–°ç‰‡é¢„å”®æ€»ç¥¨æˆ¿çªç ´3000ä¸‡ã€‚  12. æ³°å›½å°†åŠ å¿«ä¸­å›½æ¸¸å®¢å…¥å¢ƒç­¾è¯å®¡æ‰¹ï¼Œäº‰å–7å¤©å†…å®Œæˆã€‚  13. å°åº¦åŒ—éƒ¨é­å—æç«¯çƒ­æµªä¾µè¢­ï¼š3å¤©å†…å·²æœ‰98äººæ­»äºé«˜æ¸©ã€‚  14. é˜¿å¯Œæ±—å¡”åˆ©ç­æ”¿åºœå°†ç¾å›½æ’¤å†›æ—¥å®šä¸ºå…¨å›½å‡æ—¥ï¼Œæ¯å¹´åº†ç¥ã€‚  15. ä¹Œæ–¹ç§°åŸºè¾…è®¡åˆ’æœ€å¤§é™åº¦æ¶ˆç­ä¿„ç½—æ–¯äººï¼Œå…‹å®«è­¦å‘Šï¼šä¿„ç½—æ–¯äººä¼šå°±æ­¤å®æ–½æƒ©ç½šã€‚  ã€å¾®è¯­ã€‘åŠªåŠ›çš„æ„ä¹‰åœ¨äºï¼šä»¥åæ—¥å­é‡Œï¼Œæ”¾çœ¼æœ›å»ï¼Œå…¨éƒ½æ˜¯è‡ªå·±å–œæ¬¢çš„äººå’Œäº‹ã€‚  æ–°é—»æ¥æºï¼š<a href="https://www.163.com/dy/article/I7IV8TLQ0534QBVQ.html?spss=dy_author">https://www.163.com/dy/article/I7IV8TLQ0534QBVQ.html?spss=dy_author</a>  <code>#æ¯æ—¥æ—©æŠ¥</code> <code>#memos</code></li>
</ul>
<p>ä»¥ä¸Šã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>[è¯‘]å¾®æœåŠ¡è®¾è®¡æ¨¡å¼</title>
      <link>https://blog.chensoul.com/posts/2023/06/26/microservice-design-patterns/</link>
      <pubDate>Mon, 26 Jun 2023 08:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/06/26/microservice-design-patterns/</guid>
      <description>åœ¨ MySQL ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¤šç§æ–¹å¼æ¥è®¾è®¡æ ‘å½¢ç»“æ„çš„åŒºåŸŸè¡¨ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„æ–¹æ¡ˆï¼š Adjacency List æ¨¡å‹ Adjacency List æ¨¡å‹æ˜¯æœ€å¸¸è§çš„æ ‘å½¢ç»“æ„æ¨¡å‹ä¹‹ä¸€ï¼Œåœ¨è¯¥æ¨¡å‹ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«</description>
      <content:encoded><![CDATA[<p>åœ¨ MySQL ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¤šç§æ–¹å¼æ¥è®¾è®¡æ ‘å½¢ç»“æ„çš„åŒºåŸŸè¡¨ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„æ–¹æ¡ˆï¼š</p>
<h2 id="adjacency-list-æ¨¡å‹">Adjacency List æ¨¡å‹</h2>
<p>Adjacency List æ¨¡å‹æ˜¯æœ€å¸¸è§çš„æ ‘å½¢ç»“æ„æ¨¡å‹ä¹‹ä¸€ï¼Œåœ¨è¯¥æ¨¡å‹ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«ä¸€ä¸ªæŒ‡å‘å…¶çˆ¶èŠ‚ç‚¹çš„å¤–é”®ã€‚åœ¨åŒºåŸŸè¡¨ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ª <code>parent_id</code> åˆ—æ¥å­˜å‚¨æ¯ä¸ªåœ°åŒºçš„çˆ¶èŠ‚ç‚¹ IDã€‚è¯¥æ¨¡å‹çš„ä¼˜ç‚¹æ˜¯ç®€å•æ˜“ç†è§£ï¼Œæ˜“äºå®ç°ï¼Œä½†æ˜¯æŸ¥è¯¢æŸä¸ªèŠ‚ç‚¹çš„å­å­™èŠ‚ç‚¹éœ€è¦ä½¿ç”¨é€’å½’æŸ¥è¯¢ï¼Œæ•ˆç‡è¾ƒä½ã€‚</p>
<p>ä¸‹é¢æ˜¯åœ¨ MySQL ä¸­ä½¿ç”¨ Adjacency List æ¨¡å‹åˆ›å»ºåŒºåŸŸè¡¨ <code>sys_area</code>ï¼Œå¹¶å®ç°å¢åˆ æ”¹æŸ¥æ“ä½œçš„ç¤ºä¾‹ä»£ç ã€‚</p>
<p>é¦–å…ˆï¼Œåˆ›å»º <code>sys_area</code> è¡¨ï¼ŒåŒ…å« <code>id</code>ã€<code>name</code> å’Œ <code>parent_id</code> ä¸‰ä¸ªå­—æ®µï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">sys_area</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">parent_id</span><span class="w"> </span><span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_parent_id</span><span class="w"> </span><span class="p">(</span><span class="n">parent_id</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p>åœ¨è¯¥è¡¨ä¸­ï¼Œ<code>id</code> æ˜¯åœ°åŒºçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œ<code>name</code> æ˜¯åœ°åŒºçš„åç§°ï¼Œ<code>parent_id</code> æ˜¯åœ°åŒºçš„çˆ¶èŠ‚ç‚¹ IDã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œå¯ä»¥å®ç°å¢åˆ æ”¹æŸ¥æ“ä½œçš„ SQL è¯­å¥ï¼Œä¾‹å¦‚ï¼š</p>
<p>1ã€æ’å…¥åœ°åŒºè®°å½•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">sys_area</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">parent_id</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;ä¸­å›½&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">sys_area</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">parent_id</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;æµ™æ±Ÿçœ&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">sys_area</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">parent_id</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;æ­å·å¸‚&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">sys_area</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">parent_id</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;è¥¿æ¹–åŒº&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">sys_area</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">parent_id</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;ä¸ŠåŸåŒº&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œé¦–å…ˆæ’å…¥äº†ä¸€ä¸ªé¡¶çº§åœ°åŒº <code>ä¸­å›½</code>ï¼Œç„¶åæ’å…¥äº†å…¶ä¸‹å±çš„åœ°åŒº <code>æµ™æ±Ÿçœ</code>ã€<code>æ­å·å¸‚</code> å’Œ <code>è¥¿æ¹–åŒº</code>ï¼Œå…¶ä¸­ <code>parent_id</code> åˆ†åˆ«ä¸º <code>NULL</code>ã€<code>1</code>ã€<code>2</code>ï¼Œè¡¨ç¤ºå®ƒä»¬çš„çˆ¶èŠ‚ç‚¹åˆ†åˆ«æ˜¯é¡¶çº§èŠ‚ç‚¹ã€<code>ä¸­å›½</code>ã€<code>æµ™æ±Ÿçœ</code>ã€‚</p>
<p>2ã€æŸ¥è¯¢åœ°åŒºè®°å½•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">sys_area</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">sys_area</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">parent_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œç¬¬ä¸€ä¸ª SQL è¯­å¥æŸ¥è¯¢äº†æ‰€æœ‰çš„åœ°åŒºè®°å½•ï¼Œç¬¬äºŒä¸ª SQL è¯­å¥æŸ¥è¯¢äº†çˆ¶èŠ‚ç‚¹ä¸º <code>2</code>ï¼ˆå³ <code>æ­å·å¸‚</code>ï¼‰çš„åœ°åŒºè®°å½•ï¼Œå³å…¶ä¸‹å±çš„åœ°åŒº <code>è¥¿æ¹–åŒº</code>ã€‚</p>
<p>3ã€æŸ¥è¯¢æ‰€æœ‰å­èŠ‚ç‚¹</p>
<p>ä¾‹å¦‚ï¼šæŸ¥è¯¢æµ™æ±Ÿçœä¸‹çš„æ‰€æœ‰åŒºåŸŸã€‚ä»¥ä¸‹æ˜¯ä¸€ç§å¸¸è§çš„é€’å½’æŸ¥è¯¢æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="k">RECURSIVE</span><span class="w"> </span><span class="n">cte</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">parent_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">sys_area</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;æµ™æ±Ÿçœ&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">parent_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">sys_area</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">cte</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">parent_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">cte</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>åœ¨è¿™ä¸ª SQL è¯­å¥ä¸­ï¼Œä½¿ç”¨äº† CTEï¼ˆCommon Table Expressionï¼‰å’Œé€’å½’æŸ¥è¯¢æ¥æŸ¥è¯¢æµ™æ±Ÿçœä¸‹çš„æ‰€æœ‰åŒºåŸŸã€‚é¦–å…ˆï¼Œä» <code>sys_area</code> è¡¨ä¸­é€‰å–åç§°ä¸º <code>æµ™æ±Ÿçœ</code> çš„åœ°åŒºä½œä¸ºèµ·å§‹èŠ‚ç‚¹ï¼Œç„¶åé€šè¿‡é€’å½’æŸ¥è¯¢æ‰¾åˆ°å…¶æ‰€æœ‰çš„å­å­™èŠ‚ç‚¹ã€‚æœ€åï¼ŒæŸ¥è¯¢ç»“æœåŒ…æ‹¬æ‰€æœ‰å­å­™èŠ‚ç‚¹çš„ IDã€åç§°å’Œçˆ¶èŠ‚ç‚¹ IDã€‚</p>
<blockquote>
<p>Common Table Expressionï¼ˆCTEï¼‰æ˜¯ä¸€ç§éæ ‡å‡†çš„ SQL è¯­æ³•ï¼Œå®ƒåœ¨ MySQL ä¸­çš„æ”¯æŒæƒ…å†µå–å†³äºå…·ä½“çš„ MySQL ç‰ˆæœ¬ã€‚åœ¨ MySQL 5.7 ç‰ˆæœ¬ä¸­ï¼ŒCTE ç¡®å®æ˜¯ä¸æ”¯æŒçš„ã€‚ä¸è¿‡ï¼Œä» MySQL 8.0 ç‰ˆæœ¬å¼€å§‹ï¼ŒMySQL å¼€å§‹æ”¯æŒ CTE è¯­æ³•ã€‚</p>
<p>åœ¨ MySQL 5.7 ç‰ˆæœ¬åŠä»¥ä¸‹ç‰ˆæœ¬ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å­æŸ¥è¯¢æˆ–è€…ä¸´æ—¶è¡¨ç­‰æ–¹å¼æ¥æ›¿ä»£ CTE çš„åŠŸèƒ½ã€‚</p>
</blockquote>
<p>4ã€æŸ¥è¯¢æ‰€æœ‰çˆ¶èŠ‚ç‚¹</p>
<p>ä½¿ç”¨ Adjacency List æ¨¡å‹ï¼ŒæŸ¥è¯¢æ­å·å¸‚çš„æ‰€æœ‰çˆ¶èŠ‚ç‚¹éœ€è¦ä½¿ç”¨é€’å½’æŸ¥è¯¢ã€‚ä»¥ä¸‹æ˜¯ä¸€ç§å¸¸è§çš„é€’å½’æŸ¥è¯¢æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">WITH</span><span class="w"> </span><span class="k">RECURSIVE</span><span class="w"> </span><span class="n">cte</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">parent_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">sys_area</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;æ­å·å¸‚&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">UNION</span><span class="w"> </span><span class="k">ALL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">parent_id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">sys_area</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">cte</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">parent_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">cte</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>åœ¨è¿™ä¸ª SQL è¯­å¥ä¸­ï¼Œä½¿ç”¨äº† CTE å’Œé€’å½’æŸ¥è¯¢æ¥æŸ¥è¯¢æ­å·å¸‚çš„æ‰€æœ‰çˆ¶èŠ‚ç‚¹ã€‚é¦–å…ˆï¼Œä» <code>sys_area</code> è¡¨ä¸­é€‰å–åç§°ä¸º <code>æ­å·å¸‚</code> çš„åœ°åŒºä½œä¸ºèµ·å§‹èŠ‚ç‚¹ï¼Œç„¶åé€šè¿‡é€’å½’æŸ¥è¯¢æ‰¾åˆ°å…¶æ‰€æœ‰çš„çˆ¶èŠ‚ç‚¹ã€‚æœ€åï¼ŒæŸ¥è¯¢ç»“æœåŒ…æ‹¬æ‰€æœ‰çˆ¶èŠ‚ç‚¹çš„ IDã€åç§°å’Œçˆ¶èŠ‚ç‚¹ IDã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä½¿ç”¨å­æŸ¥è¯¢å®ç°æŸ¥è¯¢æ­å·å¸‚çš„æ‰€æœ‰çˆ¶èŠ‚ç‚¹çš„ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">t1</span><span class="p">.</span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">sys_area</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;æ­å·å¸‚&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">t1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">sys_area</span><span class="w"> </span><span class="n">t2</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">t1</span><span class="p">.</span><span class="n">parent_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t2</span><span class="p">.</span><span class="n">id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">sys_area</span><span class="w"> </span><span class="n">t3</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">t2</span><span class="p">.</span><span class="n">parent_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t3</span><span class="p">.</span><span class="n">id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">sys_area</span><span class="w"> </span><span class="n">t4</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">t3</span><span class="p">.</span><span class="n">parent_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t4</span><span class="p">.</span><span class="n">id</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨äº†å››ä¸ªå­æŸ¥è¯¢ï¼Œæ¯ä¸ªå­æŸ¥è¯¢æŸ¥è¯¢ä¸€ä¸ªå±‚çº§çš„çˆ¶èŠ‚ç‚¹ã€‚é€šè¿‡ä½¿ç”¨å¤šä¸ªå­æŸ¥è¯¢å’Œ LEFT JOIN æ“ä½œï¼ŒæŸ¥è¯¢ç»“æœåŒ…å«äº†æ­å·å¸‚çš„æ‰€æœ‰çˆ¶èŠ‚ç‚¹ã€‚</p>
<p>å¦‚æœéœ€è¦æŸ¥è¯¢çš„å±‚çº§è¾ƒå¤šï¼Œä½¿ç”¨å¤šä¸ªå­æŸ¥è¯¢æˆ–è€…ä¸´æ—¶è¡¨ç­‰æ–¹å¼å¯èƒ½ä¼šå¯¼è‡´ SQL è¯­å¥å¤æ‚åº¦æé«˜ï¼Œä¸åˆ©äºç»´æŠ¤å’Œä¼˜åŒ–ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å…¶ä»–æ ‘å½¢ç»“æ„æ¨¡å‹ï¼Œä¾‹å¦‚ Nested Set æ¨¡å‹æˆ–è€… Closure Table æ¨¡å‹ï¼Œæ¥ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ã€‚</p>
<h2 id="path-enumeration-æ¨¡å‹">Path Enumeration æ¨¡å‹</h2>
<p>Path Enumeration æ¨¡å‹æ˜¯ä¸€ç§åŸºäºè·¯å¾„çš„æ ‘å½¢ç»“æ„æ¨¡å‹ï¼Œåœ¨è¯¥æ¨¡å‹ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«ä¸€ä¸ªè¡¨ç¤ºå…¶è·¯å¾„çš„å­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²åŒ…å«è¯¥èŠ‚ç‚¹çš„æ‰€æœ‰ç¥–å…ˆèŠ‚ç‚¹çš„ IDã€‚åœ¨åŒºåŸŸè¡¨ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ª <code>path</code> åˆ—æ¥å­˜å‚¨æ¯ä¸ªåœ°åŒºçš„è·¯å¾„ã€‚è¯¥æ¨¡å‹çš„ä¼˜ç‚¹æ˜¯æŸ¥è¯¢æŸä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰ç¥–å…ˆã€åä»£èŠ‚ç‚¹éƒ½éå¸¸é«˜æ•ˆï¼Œä½†æ˜¯éœ€è¦å¯¹è·¯å¾„è¿›è¡Œä¿®æ”¹ã€ç»´æŠ¤è¾ƒä¸ºéº»çƒ¦ã€‚</p>
<p>åœ¨ Path Enumeration æ¨¡å‹ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„è·¯å¾„ï¼Œè¡¨ç¤ºèŠ‚ç‚¹åœ¨æ ‘ä¸­çš„ä½ç½®ã€‚è·¯å¾„é€šå¸¸ä½¿ç”¨å­—ç¬¦ä¸²æˆ–è€…æ•°ç»„çš„å½¢å¼æ¥è¡¨ç¤ºï¼Œä¾‹å¦‚ä½¿ç”¨æ–œæ åˆ†éš”ç¬¦ <code>/</code> å°†æ¯ä¸ªèŠ‚ç‚¹çš„ ID è¿æ¥èµ·æ¥ä½œä¸ºè·¯å¾„ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ Path Enumeration æ¨¡å‹çš„è¡¨ç»“æ„è®¾è®¡ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">sys_area</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">path</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>sys_area</code> è¡¨åŒ…å«äº†æ ‘å½¢ç»“æ„ä¸­çš„èŠ‚ç‚¹ä¿¡æ¯ï¼ŒåŒ…æ‹¬èŠ‚ç‚¹ IDã€åç§°å’Œè·¯å¾„ã€‚å…¶ä¸­ï¼ŒèŠ‚ç‚¹ ID æ˜¯ä¸€ä¸ªè‡ªå¢çš„æ•´æ•°ï¼Œç”¨äºå”¯ä¸€æ ‡è¯†æ¯ä¸ªèŠ‚ç‚¹ã€‚èŠ‚ç‚¹åç§°ç”¨äºæè¿°èŠ‚ç‚¹çš„åç§°ä¿¡æ¯ã€‚èŠ‚ç‚¹è·¯å¾„ç”¨äºè¡¨ç¤ºèŠ‚ç‚¹åœ¨æ ‘ä¸­çš„ä½ç½®ï¼Œä¾‹å¦‚ <code>/1/2/3</code> è¡¨ç¤ºä¸€ä¸ªæ·±åº¦ä¸º 3 çš„èŠ‚ç‚¹ï¼Œå…¶ç¥–å…ˆèŠ‚ç‚¹åˆ†åˆ«ä¸º ID ä¸º 1ã€2 å’Œ 3 çš„èŠ‚ç‚¹ã€‚</p>
<p>æ’å…¥æ•°æ®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">sys_area</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ä¸­å›½&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;æµ™æ±Ÿçœ&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1/&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;æ­å·å¸‚&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1/2/&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ä¸ŠåŸåŒº&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1/2/3/&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ä¸‹åŸåŒº&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1/2/4/&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;æ±Ÿå¹²åŒº&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1/2/5/&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;è¥¿æ¹–åŒº&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1/2/6/&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;æ»¨æ±ŸåŒº&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1/2/7/&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;è§å±±åŒº&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1/2/8/&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ä½™æ­åŒº&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1/2/9/&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ä¸´å®‰å¸‚&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1/2/10/&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;å¯Œé˜³åŒº&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1/2/11/&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;å®æ³¢å¸‚&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1/12/&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;æµ·æ›™åŒº&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1/12/13/&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;æ±ŸåŒ—åŒº&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1/12/14/&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;åŒ—ä»‘åŒº&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1/12/15/&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;é•‡æµ·åŒº&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1/12/16/&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;é„å·åŒº&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1/12/17/&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ä½™å§šå¸‚&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1/12/18/&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;æ…ˆæºªå¸‚&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1/12/19/&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="mi">21</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;å¥‰åŒ–å¸‚&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1/12/20/&#39;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹æ•°æ®ä¸­ï¼Œä½¿ç”¨äº† Path Enumeration æ¨¡å‹è¡¨ç¤ºäº†ä¸€ä¸ªåœ°åŒºæ ‘å½¢ç»“æ„ï¼ŒåŒ…æ‹¬äº†ä¸­å›½ã€æµ™æ±Ÿçœã€æ­å·å¸‚ã€ä¸ŠåŸåŒºã€ä¸‹åŸåŒºç­‰å¤šä¸ªå±‚çº§ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ ID å’Œä¸€ä¸ªè·¯å¾„ï¼Œç”¨äºæ ‡è¯†èŠ‚ç‚¹åœ¨æ ‘ä¸­çš„ä½ç½®ã€‚</p>
<p>æŸ¥è¯¢æ¯ä¸ªèŠ‚ç‚¹çš„å±‚çº§ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">LENGTH</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">LENGTH</span><span class="p">(</span><span class="k">REPLACE</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">level</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">sys_area</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>æŸ¥è¯¢æ­å·å¸‚çš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬æ­å·å¸‚ï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">sys_area</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;/1/2/%&#39;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>æŸ¥è¯¢æ­å·å¸‚çš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼ˆä¸åŒ…æ‹¬æ­å·å¸‚ï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">sys_area</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;/1/2/%&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">path</span><span class="o">&lt;&gt;</span><span class="s1">&#39;/1/2/&#39;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>æŸ¥è¯¢æ­å·å¸‚çš„æ‰€æœ‰ç›´æ¥å­èŠ‚ç‚¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">sys_area</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;/1/2/%&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">LENGTH</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">LENGTH</span><span class="p">(</span><span class="k">REPLACE</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">=</span><span class="mi">4</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>æŸ¥è¯¢æ­å·å¸‚çš„æ‰€æœ‰çˆ¶èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬æ­å·å¸‚ï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">sys_area</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="s1">&#39;/1/2/&#39;</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="n">CONCAT</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;%&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">LENGTH</span><span class="p">(</span><span class="n">path</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p>æŸ¥è¯¢æ­å·å¸‚çš„æ‰€æœ‰çˆ¶èŠ‚ç‚¹ï¼ˆä¸åŒ…æ‹¬æ­å·å¸‚ï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">sys_area</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="s1">&#39;/1/2/&#39;</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="n">CONCAT</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;%&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">path</span><span class="o">&lt;&gt;</span><span class="s1">&#39;/1/2/&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">LENGTH</span><span class="p">(</span><span class="n">path</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ Path Enumeration æ¨¡å‹éœ€è¦åœ¨æ¯æ¬¡æ’å…¥ã€åˆ é™¤æˆ–ç§»åŠ¨èŠ‚ç‚¹æ—¶æ›´æ–°èŠ‚ç‚¹çš„è·¯å¾„ï¼Œå› æ­¤åœ¨å¤„ç†é¢‘ç¹çš„æ ‘å½¢ç»“æ„æ“ä½œæ—¶ï¼Œå¯èƒ½ä¼šå½±å“æ•°æ®åº“çš„æ€§èƒ½ã€‚åŒæ—¶ï¼ŒPath Enumeration æ¨¡å‹ä¹Ÿæœ‰ä¸€äº›å±€é™æ€§ï¼Œä¾‹å¦‚ä¸æ”¯æŒèŠ‚ç‚¹çš„éšæ„ç§»åŠ¨å’Œæ’å…¥ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨ Path Enumeration æ¨¡å‹æ—¶ï¼Œéœ€è¦æ ¹æ®å…·ä½“çš„éœ€æ±‚å’Œåœºæ™¯æ¥é€‰æ‹©åˆé€‚çš„æ ‘å½¢ç»“æ„æ¨¡å‹ã€‚</p>
<h2 id="materialized-path-æ¨¡å‹">Materialized Path æ¨¡å‹</h2>
<p>Materialized Path æ¨¡å‹æ˜¯ä¸€ç§åŸºäºè·¯å¾„çš„æ ‘å½¢ç»“æ„æ¨¡å‹ï¼Œåœ¨è¯¥æ¨¡å‹ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«ä¸€ä¸ªè¡¨ç¤ºå…¶è·¯å¾„çš„å­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²åŒ…å«è¯¥èŠ‚ç‚¹çš„æ‰€æœ‰ç¥–å…ˆèŠ‚ç‚¹çš„ IDï¼ŒåŒæ—¶è¿˜åŒ…æ‹¬è¯¥èŠ‚ç‚¹è‡ªèº«çš„ IDã€‚åœ¨åŒºåŸŸè¡¨ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ª <code>path</code> åˆ—æ¥å­˜å‚¨æ¯ä¸ªåœ°åŒºçš„è·¯å¾„ã€‚è¯¥æ¨¡å‹çš„ä¼˜ç‚¹æ˜¯æŸ¥è¯¢æŸä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰ç¥–å…ˆã€åä»£èŠ‚ç‚¹éƒ½éå¸¸é«˜æ•ˆï¼Œä¸”å¯¹è·¯å¾„çš„ä¿®æ”¹ã€ç»´æŠ¤è¾ƒä¸ºæ–¹ä¾¿ã€‚</p>
<p>éœ€è¦æ ¹æ®å…·ä½“çš„éœ€æ±‚å’Œåœºæ™¯æ¥é€‰æ‹©åˆé€‚çš„æ ‘å½¢ç»“æ„æ¨¡å‹ï¼Œä¸åŒçš„æ¨¡å‹å„æœ‰ä¼˜ç¼ºç‚¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœéœ€è¦é¢‘ç¹æŸ¥è¯¢æŸä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰ç¥–å…ˆã€åä»£èŠ‚ç‚¹ï¼Œåˆ™å¯ä»¥é€‰æ‹© Path Enumeration æ¨¡å‹æˆ– Materialized Path æ¨¡å‹ï¼›å¦‚æœéœ€è¦é¢‘ç¹æ’å…¥ã€åˆ é™¤èŠ‚ç‚¹ï¼Œåˆ™å¯ä»¥é€‰æ‹© Nested Set æ¨¡å‹ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ª Materialized Path æ¨¡å‹çš„å»ºè¡¨è¯­å¥ï¼Œå¹¶æ’å…¥ä¸€äº›æµ‹è¯•æ•°æ®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">sys_area</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">id</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="n">path</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">sys_area</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="s1">&#39;ä¸­å›½&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="s1">&#39;æµ™æ±Ÿçœ&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1/2&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="s1">&#39;æ­å·å¸‚&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1/2/3&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="s1">&#39;è¥¿æ¹–åŒº&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1/2/3/4&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="s1">&#39;ä¸ŠåŸåŒº&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1/2/3/5&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="s1">&#39;æ±Ÿå¹²åŒº&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1/2/3/6&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="s1">&#39;ä¸‹åŸåŒº&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1/2/3/7&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="s1">&#39;æ‹±å¢…åŒº&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1/2/3/8&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="s1">&#39;æ»¨æ±ŸåŒº&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1/2/3/9&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="s1">&#39;è§å±±åŒº&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1/2/3/10&#39;</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="s1">&#39;ä½™æ­åŒº&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/1/2/3/11&#39;</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p>åœ¨è¿™ä¸ªè¡¨ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªè‡ªå¢çš„ IDï¼Œä¸€ä¸ªåç§°å­—æ®µå’Œä¸€ä¸ªè·¯å¾„å­—æ®µã€‚è·¯å¾„å­—æ®µä¸­å­˜å‚¨äº†ä»æ ¹èŠ‚ç‚¹åˆ°è¯¥èŠ‚ç‚¹çš„å®Œæ•´è·¯å¾„ï¼Œä½¿ç”¨ <code>/</code> åˆ†éš”å„çº§èŠ‚ç‚¹çš„ IDã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¸­å›½èŠ‚ç‚¹çš„è·¯å¾„ä¸º <code>/1</code>ï¼Œæ­å·å¸‚èŠ‚ç‚¹çš„è·¯å¾„ä¸º <code>/1/2/3</code>ã€‚è¿™ä¸ªè¡¨ä¸­çš„æ•°æ®ä»…ä¾›æµ‹è¯•å’Œæ¼”ç¤ºä½¿ç”¨ï¼Œå®é™…åº”ç”¨ä¸­å¯èƒ½éœ€è¦æ ¹æ®å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚è¿›è¡Œè°ƒæ•´ã€‚</p>
<p>æŸ¥è¯¢æ¯ä¸ªèŠ‚ç‚¹çš„å±‚çº§ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">LENGTH</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">LENGTH</span><span class="p">(</span><span class="k">REPLACE</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">level</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">sys_area</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>æŸ¥è¯¢æ­å·å¸‚çš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼ˆä¸åŒ…æ‹¬æ­å·å¸‚ï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">sys_area</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;/1/2/3/%&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">sys_area</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="k">SUBSTRING</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">LENGTH</span><span class="p">(</span><span class="s1">&#39;/1/2/3&#39;</span><span class="p">))</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;/1/2/3&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s1">&#39;/1/2/3&#39;</span><span class="w">
</span></span></span></code></pre></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ª SQL è¯­å¥ä¸­çš„ <code>%</code> ç¬¦å·è¡¨ç¤ºåŒ¹é…ä»»æ„å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºå­—ç¬¦ä¸²ã€‚å¦‚æœæƒ³è¦æ’é™¤ç©ºå­—ç¬¦ä¸²ï¼Œå¯ä»¥ä½¿ç”¨ <code>_</code> ç¬¦å·è¡¨ç¤ºåŒ¹é…å•ä¸ªå­—ç¬¦ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">sys_area</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;/1/2/3/_&#39;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>æŸ¥è¯¢æµ™æ±Ÿçœçš„æ‰€æœ‰ç›´æ¥å­èŠ‚ç‚¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- æµ™æ±Ÿçœ path=/1/2, å±‚çº§=2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">sys_area</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;/1/2%&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">LENGTH</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">LENGTH</span><span class="p">(</span><span class="k">REPLACE</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">=</span><span class="mi">3</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>æŸ¥è¯¢æ­å·å¸‚çš„æ‰€æœ‰çˆ¶èŠ‚ç‚¹</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">sys_area</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="s1">&#39;/1/2/3&#39;</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="n">CONCAT</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;%&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">path</span><span class="o">&lt;&gt;</span><span class="s1">&#39;/1/2/3&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="k">LENGTH</span><span class="p">(</span><span class="n">path</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><h2 id="nested-set-æ¨¡å‹">Nested Set æ¨¡å‹</h2>
<p>Nested Set æ¨¡å‹æ˜¯ä¸€ç§åŸºäºåµŒå¥—é›†åˆçš„æ ‘å½¢ç»“æ„æ¨¡å‹ï¼Œåœ¨è¯¥æ¨¡å‹ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«ä¸€ä¸ªå·¦å³å€¼ï¼Œè¯¥å€¼è¡¨ç¤ºè¯¥èŠ‚ç‚¹çš„å­å­™èŠ‚ç‚¹åœ¨ä¸€ä¸ªå®Œæ•´çš„åµŒå¥—é›†åˆä¸­çš„ä½ç½®ã€‚åœ¨åŒºåŸŸè¡¨ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ª <code>lft</code> å’Œ <code>rgt</code> åˆ—æ¥å­˜å‚¨æ¯ä¸ªåœ°åŒºçš„å·¦å³å€¼ã€‚è¯¥æ¨¡å‹çš„ä¼˜ç‚¹æ˜¯æŸ¥è¯¢æŸä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰ç¥–å…ˆã€åä»£èŠ‚ç‚¹éå¸¸é«˜æ•ˆï¼Œä½†æ˜¯éœ€è¦å¯¹å·¦å³å€¼è¿›è¡Œä¿®æ”¹ã€ç»´æŠ¤è¾ƒä¸ºéº»çƒ¦ã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>[è¯‘]å¾®æœåŠ¡è®¾è®¡æ¨¡å¼</title>
      <link>https://blog.chensoul.com/posts/2023/06/26/microservice-design-patterns/</link>
      <pubDate>Mon, 26 Jun 2023 08:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/06/26/microservice-design-patterns/</guid>
      <description>åŸºäºå¾®æœåŠ¡çš„åº”ç”¨ç¨‹åºçš„ä¸»è¦ç‰¹å¾åœ¨ å¾®æœåŠ¡ã€å•ä½“å’Œ NoOps ä¸­å®šä¹‰ã€‚å®ƒä»¬æ˜¯åŠŸèƒ½åˆ†è§£æˆ–é¢†åŸŸé©±åŠ¨è®¾è®¡ã€å®šä¹‰è‰¯å¥½çš„æ¥å£ã€æ˜ç¡®å‘å¸ƒçš„æ¥å£ã€å•ä¸€è´£ä»»åŸåˆ™å’Œæ½œåœ¨çš„å¤š</description>
      <content:encoded><![CDATA[<p>åŸºäºå¾®æœåŠ¡çš„åº”ç”¨ç¨‹åºçš„ä¸»è¦ç‰¹å¾åœ¨ <a href="http://web.archive.org/web/20190705163602/http://blog.arungupta.me/microservices-monoliths-noops/">å¾®æœåŠ¡ã€å•ä½“å’Œ NoOps</a> ä¸­å®šä¹‰ã€‚å®ƒä»¬æ˜¯åŠŸèƒ½åˆ†è§£æˆ–é¢†åŸŸé©±åŠ¨è®¾è®¡ã€å®šä¹‰è‰¯å¥½çš„æ¥å£ã€æ˜ç¡®å‘å¸ƒçš„æ¥å£ã€å•ä¸€è´£ä»»åŸåˆ™å’Œæ½œåœ¨çš„å¤šè¯­è¨€ã€‚æ¯é¡¹æœåŠ¡éƒ½æ˜¯å®Œå…¨è‡ªä¸»å’Œå…¨æ ˆçš„ã€‚</p>
<p>å› æ­¤ï¼Œæ›´æ”¹æœåŠ¡å®ç°ä¸ä¼šå½±å“å…¶ä»–æœåŠ¡ï¼Œå› ä¸ºå®ƒä»¬ä½¿ç”¨å®šä¹‰è‰¯å¥½çš„æ¥å£è¿›è¡Œé€šä¿¡ã€‚è¿™ç§åº”ç”¨ç¨‹åºæœ‰å‡ ä¸ªä¼˜ç‚¹ï¼Œä½†å®ƒä¸æ˜¯ <a href="http://web.archive.org/web/20190705163602/http://highscalability.com/blog/2014/4/8/microservices-not-a-free-lunch.html">å…è´¹çš„åˆé¤</a>ï¼Œéœ€è¦åœ¨ NoOps æ–¹é¢ä»˜å‡ºå¤§é‡åŠªåŠ›ã€‚</p>
<p>ä½†æ˜¯å‡è®¾æ‚¨äº†è§£æ„å»ºæ­¤ç±»åº”ç”¨ç¨‹åºæ‰€éœ€çš„å·¥ä½œæˆ–è‡³å°‘å…¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”æ„¿æ„è·³æ§½ã€‚ä½ åšä»€ä¹ˆå·¥ä½œï¼Ÿæ‚¨æ„å»ºæ­¤ç±»åº”ç”¨ç¨‹åºçš„æ–¹æ³•æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>æ˜¯å¦æœ‰ä»»ä½•å…³äºè¿™äº›å¾®æœåŠ¡å¦‚ä½•ç›¸äº’åä½œçš„è®¾è®¡æ¨¡å¼ï¼Ÿ</p>
<p>åº”ç”¨ç¨‹åºå’Œå›¢é˜Ÿçš„åŠŸèƒ½åˆ†è§£æ˜¯æ„å»ºæˆåŠŸçš„å¾®æœåŠ¡æ¶æ„çš„å…³é”®ã€‚</p>
<p>è¿™å…è®¸æ‚¨å®ç°æ¾è€¦åˆï¼ˆREST æ¥å£ï¼‰å’Œé«˜å†…èšï¼ˆå¤šä¸ªæœåŠ¡å¯ä»¥ç›¸äº’ç»„åˆä»¥å®šä¹‰æ›´é«˜çº§åˆ«çš„æœåŠ¡æˆ–åº”ç”¨ç¨‹åºï¼‰ã€‚</p>
<p>åº”ç”¨ç¨‹åºçš„åŠ¨è¯ï¼ˆä¾‹å¦‚ Checkoutï¼‰æˆ–åè¯ï¼ˆProductï¼‰æ˜¯å®ç°ç°æœ‰åº”ç”¨ç¨‹åºåˆ†è§£çš„æœ‰æ•ˆæ–¹æ³•ä¹‹ä¸€ã€‚</p>
<p>ä¾‹å¦‚ï¼Œäº§å“ã€ç›®å½•å’Œç»“å¸å¯ä»¥æ˜¯ä¸‰ä¸ªç‹¬ç«‹çš„å¾®æœåŠ¡ï¼Œç„¶åç›¸äº’åä½œä»¥æä¾›å®Œæ•´çš„è´­ç‰©è½¦ä½“éªŒã€‚</p>
<p>åŠŸèƒ½åˆ†è§£æä¾›äº†æ•æ·æ€§ã€çµæ´»æ€§ã€å¯æ‰©å±•æ€§å’Œå…¶ä»–èƒ½åŠ›ï¼Œä½†ä¸šåŠ¡ç›®æ ‡ä»ç„¶æ˜¯åˆ›å»ºåº”ç”¨ç¨‹åºã€‚å› æ­¤ï¼Œä¸€æ—¦è¯†åˆ«å‡ºä¸åŒçš„å¾®æœåŠ¡ï¼Œæ‚¨å¦‚ä½•ç»„åˆå®ƒä»¬ä»¥æä¾›åº”ç”¨ç¨‹åºçš„åŠŸèƒ½ï¼Ÿ</p>
<p>æœ¬åšå®¢å°†è®¨è®ºä¸€äº›å…³äºå¦‚ä½•å°†å¾®æœåŠ¡ç»„åˆåœ¨ä¸€èµ·çš„æ¨èæ¨¡å¼ã€‚</p>
<h2 id="èšåˆå¾®æœåŠ¡è®¾è®¡æ¨¡å¼">èšåˆå¾®æœåŠ¡è®¾è®¡æ¨¡å¼</h2>
<p>ç¬¬ä¸€ä¸ªï¼Œä¹Ÿå¯èƒ½æ˜¯æœ€å¸¸è§çš„ï¼Œæ˜¯èšåˆå™¨å¾®æœåŠ¡è®¾è®¡æ¨¡å¼ã€‚</p>
<p>åœ¨å…¶æœ€ç®€å•çš„å½¢å¼ä¸­ï¼Œèšåˆå™¨å°†æ˜¯ä¸€ä¸ªç®€å•çš„ç½‘é¡µï¼Œå®ƒè°ƒç”¨å¤šä¸ªæœåŠ¡æ¥å®ç°åº”ç”¨ç¨‹åºæ‰€éœ€çš„åŠŸèƒ½ã€‚ç”±äºæ¯ä¸ªæœåŠ¡ï¼ˆæœåŠ¡ Aã€æœåŠ¡ B å’ŒæœåŠ¡ Cï¼‰éƒ½ä½¿ç”¨è½»é‡çº§ REST æœºåˆ¶å…¬å¼€ï¼Œå› æ­¤ç½‘é¡µå¯ä»¥æ£€ç´¢æ•°æ®å¹¶ç›¸åº”åœ°å¤„ç†/æ˜¾ç¤ºæ•°æ®ã€‚å¦‚æœéœ€è¦æŸç§å¤„ç†ï¼Œæ¯”å¦‚å°†ä¸šåŠ¡é€»è¾‘åº”ç”¨äºä»å„ä¸ªæœåŠ¡æ¥æ”¶çš„æ•°æ®ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½æœ‰ä¸€ä¸ª CDI bean å¯ä»¥è½¬æ¢æ•°æ®ï¼Œä»¥ä¾¿ç½‘é¡µå¯ä»¥æ˜¾ç¤ºå®ƒã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/microservices-aggregator.png" alt="microservices-aggregator"  />
</p>
<p>èšåˆå™¨çš„å¦ä¸€ä¸ªé€‰æ‹©æ˜¯ä¸éœ€è¦æ˜¾ç¤ºï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæ›´é«˜çº§åˆ«çš„å¤åˆå¾®æœåŠ¡ï¼Œå¯ä»¥è¢«å…¶ä»–æœåŠ¡ä½¿ç”¨ã€‚</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œèšåˆå™¨åªéœ€ä»æ¯ä¸ªå•ç‹¬çš„å¾®æœåŠ¡æ”¶é›†æ•°æ®ï¼Œå¯¹å…¶åº”ç”¨ä¸šåŠ¡é€»è¾‘ï¼Œç„¶åå°†å…¶è¿›ä¸€æ­¥å‘å¸ƒä¸º REST ç«¯ç‚¹ã€‚ç„¶åå¯ä»¥ç”±éœ€è¦å®ƒçš„å…¶ä»–æœåŠ¡ä½¿ç”¨ã€‚</p>
<p>è¿™ç§è®¾è®¡æ¨¡å¼éµå¾ª DRY åŸåˆ™ã€‚</p>
<p>å¦‚æœæœ‰å¤šä¸ªæœåŠ¡éœ€è¦è®¿é—®æœåŠ¡ Aã€B å’Œ Cï¼Œé‚£ä¹ˆå»ºè®®å°†è¯¥é€»è¾‘æŠ½è±¡ä¸ºä¸€ä¸ªå¤åˆå¾®æœåŠ¡ï¼Œå¹¶å°†è¯¥é€»è¾‘èšåˆåˆ°ä¸€ä¸ªæœåŠ¡ä¸­ã€‚åœ¨æ­¤çº§åˆ«è¿›è¡ŒæŠ½è±¡çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯å„ä¸ªæœåŠ¡ï¼Œå³æœåŠ¡ Aã€B å’Œ Cï¼Œå¹¶ä¸”å¯ä»¥ç‹¬ç«‹å‘å±•ï¼Œä¸šåŠ¡éœ€æ±‚ä»ç„¶ç”±ç»„åˆå¾®æœåŠ¡æä¾›ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œæ¯ä¸ªå•ç‹¬çš„å¾®æœåŠ¡éƒ½æœ‰è‡ªå·±çš„ï¼ˆå¯é€‰ï¼‰ç¼“å­˜å’Œæ•°æ®åº“ã€‚å¦‚æœèšåˆå™¨æ˜¯ä¸€ä¸ªå¤åˆå¾®æœåŠ¡ï¼Œé‚£ä¹ˆå®ƒä¹Ÿå¯èƒ½æœ‰è‡ªå·±çš„ç¼“å­˜å’Œæ•°æ®åº“å±‚ã€‚</p>
<p>èšåˆå™¨ä¹Ÿå¯ä»¥åœ¨ X è½´å’Œ Z è½´ä¸Šç‹¬ç«‹ç¼©æ”¾ã€‚å› æ­¤ï¼Œå¦‚æœå®ƒæ˜¯ä¸€ä¸ªç½‘é¡µï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥å¯åŠ¨é¢å¤–çš„ Web æœåŠ¡å™¨ï¼Œæˆ–è€…å¦‚æœå®ƒæ˜¯ä¸€ä¸ªä½¿ç”¨ Java EE çš„å¤åˆå¾®æœåŠ¡ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥å¯åŠ¨é¢å¤–çš„ WildFly å®ä¾‹æ¥æ»¡è¶³ä¸æ–­å¢é•¿çš„éœ€æ±‚ã€‚</p>
<h2 id="ä»£ç†å¾®æœåŠ¡è®¾è®¡æ¨¡å¼">ä»£ç†å¾®æœåŠ¡è®¾è®¡æ¨¡å¼</h2>
<p>ä»£ç†å¾®æœåŠ¡è®¾è®¡æ¨¡å¼æ˜¯èšåˆå™¨çš„ä¸€ç§å˜ä½“ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦è¿›è¡Œèšåˆï¼Œä½†å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€è¦è°ƒç”¨ä¸åŒçš„å¾®æœåŠ¡ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/microservices-proxy.png" alt="microservices-proxy"  />
</p>
<p>å°±åƒ Aggregator ä¸€æ ·ï¼ŒProxy ä¹Ÿå¯ä»¥åœ¨ X è½´å’Œ Z è½´ä¸Šç‹¬ç«‹æ‰©å±•ã€‚æ‚¨å¯èƒ½å–œæ¬¢è¿™æ ·åšï¼Œå› ä¸ºæ¯ä¸ªå•ç‹¬çš„æœåŠ¡éƒ½ä¸éœ€è¦å‘æ¶ˆè´¹è€…å…¬å¼€ï¼Œè€Œæ˜¯åº”è¯¥é€šè¿‡ä¸€ä¸ªç•Œé¢ã€‚</p>
<p>ä»£ç†å¯èƒ½æ˜¯ä¸€ä¸ªå“‘ä»£ç†ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒåªæ˜¯å°†è¯·æ±‚å§”æ‰˜ç»™å…¶ä¸­ä¸€é¡¹æœåŠ¡ã€‚æˆ–è€…ï¼Œå®ƒå¯èƒ½æ˜¯ä¸€ä¸ªæ™ºèƒ½ä»£ç†ï¼Œåœ¨å°†å“åº”æä¾›ç»™å®¢æˆ·ç«¯ä¹‹å‰åº”ç”¨ä¸€äº›æ•°æ®è½¬æ¢ã€‚ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­å°±æ˜¯å¯ä»¥å°†ä¸åŒè®¾å¤‡çš„è¡¨ç¤ºå±‚å°è£…åœ¨æ™ºèƒ½ä»£ç†ä¸­ã€‚</p>
<h2 id="é“¾å¼å¾®æœåŠ¡è®¾è®¡æ¨¡å¼">é“¾å¼å¾®æœåŠ¡è®¾è®¡æ¨¡å¼</h2>
<p>é“¾å¼å¾®æœåŠ¡è®¾è®¡æ¨¡å¼å¯¹è¯·æ±‚äº§ç”Ÿå•ä¸€çš„ç»¼åˆå“åº”ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ç”±æœåŠ¡ A æ¥æ”¶ï¼Œç„¶åæœåŠ¡ A ä¸æœåŠ¡ B é€šä¿¡ï¼Œè€ŒæœåŠ¡ B åˆå¯èƒ½ä¸æœåŠ¡ C é€šä¿¡ã€‚</p>
<p>æ‰€æœ‰æœåŠ¡éƒ½å¯èƒ½ä½¿ç”¨åŒæ­¥ HTTP è¯·æ±‚/å“åº”æ¶ˆæ¯ä¼ é€’ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/microservices-chain.png" alt="microservices-chain"  />
</p>
<p>è¦è®°ä½çš„å…³é”®éƒ¨åˆ†æ˜¯å®¢æˆ·ç«¯è¢«é˜»å¡ï¼Œç›´åˆ°å®Œæˆè¯·æ±‚/å“åº”é“¾ï¼Œå³æœåŠ¡&lt;-&gt;æœåŠ¡Bå’ŒæœåŠ¡B&lt;-&gt;æœåŠ¡Cï¼Œå®Œæˆã€‚ä»æœåŠ¡ B åˆ°æœåŠ¡ C çš„è¯·æ±‚å¯èƒ½çœ‹èµ·æ¥ä¸ä»æœåŠ¡ A åˆ°æœåŠ¡ B çš„è¯·æ±‚å®Œå…¨ä¸åŒã€‚</p>
<p>åŒæ ·ï¼ŒæœåŠ¡ B å¯¹æœåŠ¡ A çš„å“åº”å¯èƒ½çœ‹èµ·æ¥ä¸æœåŠ¡ C å¯¹æœåŠ¡ B çš„å“åº”å®Œå…¨ä¸åŒã€‚æ— è®ºå¦‚ä½•ï¼Œè¿™å°±æ˜¯ä¸åŒæœåŠ¡å¢åŠ å…¶ä¸šåŠ¡ä»·å€¼çš„å…¨éƒ¨è¦ç‚¹ã€‚</p>
<p>è¿™é‡Œè¦ç†è§£çš„å¦ä¸€ä¸ªé‡è¦æ–¹é¢æ˜¯ä¸è¦è®©é“¾æ¡å¤ªé•¿ã€‚è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œå› ä¸ºé“¾çš„åŒæ­¥ç‰¹æ€§åœ¨å®¢æˆ·ç«¯çœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªæ¼«é•¿çš„ç­‰å¾…ï¼Œç‰¹åˆ«æ˜¯å¦‚æœå®ƒæ˜¯ä¸€ä¸ªç­‰å¾…æ˜¾ç¤ºå“åº”çš„ç½‘é¡µã€‚</p>
<p>è¿™ä¸ªé˜»å¡è¯·æ±‚/å“åº”æœ‰å˜é€šæ–¹æ³•ï¼Œå¹¶åœ¨åç»­è®¾è®¡æ¨¡å¼ä¸­è®¨è®ºã€‚</p>
<p>å…·æœ‰å•ä¸ªå¾®æœåŠ¡çš„é“¾ç§°ä¸ºå•ä¾‹é“¾ã€‚è¿™å¯èƒ½å…è®¸é“¾åœ¨ä»¥åæ‰©å±•ã€‚</p>
<h2 id="åˆ†æ”¯å¾®æœåŠ¡è®¾è®¡æ¨¡å¼">åˆ†æ”¯å¾®æœåŠ¡è®¾è®¡æ¨¡å¼</h2>
<p>åˆ†æ”¯å¾®æœåŠ¡è®¾è®¡æ¨¡å¼æ‰©å±•äº†èšåˆå™¨è®¾è®¡æ¨¡å¼ï¼Œå¹¶å…è®¸åŒæ—¶å¤„ç†æ¥è‡ªä¸¤ä¸ªå¯èƒ½äº’æ–¥çš„å¾®æœåŠ¡é“¾çš„å“åº”ã€‚æ­¤æ¨¡å¼è¿˜å¯ç”¨äºæ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒç”¨ä¸åŒçš„é“¾æˆ–å•ä¸ªé“¾ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/microservices-branch.png" alt="microservices-branch"  />
</p>
<p>æœåŠ¡ Aï¼ˆç½‘é¡µæˆ–å¤åˆå¾®æœåŠ¡ï¼‰å¯ä»¥åŒæ—¶è°ƒç”¨ä¸¤ä¸ªä¸åŒçš„é“¾ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ç±»ä¼¼äºèšåˆå™¨è®¾è®¡æ¨¡å¼ã€‚æˆ–è€…ï¼ŒæœåŠ¡ A å¯ä»¥æ ¹æ®ä»å®¢æˆ·ç«¯æ”¶åˆ°çš„è¯·æ±‚ä»…è°ƒç”¨ä¸€ä¸ªé“¾ã€‚</p>
<p>è¿™å¯ä»¥ä½¿ç”¨ JAX-RS æˆ– Camel ç«¯ç‚¹çš„è·¯ç”±è¿›è¡Œé…ç½®ï¼Œå¹¶ä¸”éœ€è¦åŠ¨æ€é…ç½®ã€‚</p>
<h2 id="å…±äº«æ•°æ®å¾®æœåŠ¡è®¾è®¡æ¨¡å¼">å…±äº«æ•°æ®å¾®æœåŠ¡è®¾è®¡æ¨¡å¼</h2>
<p>å¾®æœåŠ¡çš„è®¾è®¡åŸåˆ™ä¹‹ä¸€æ˜¯è‡ªæ²»ã€‚è¿™æ„å‘³ç€è¯¥æœåŠ¡æ˜¯å…¨æ ˆå¼çš„ï¼Œå¹¶ä¸”å¯ä»¥æ§åˆ¶æ‰€æœ‰ç»„ä»¶â€”â€”UIã€ä¸­é—´ä»¶ã€æŒä¹…æ€§ã€äº‹åŠ¡ã€‚è¿™å…è®¸æœåŠ¡æ˜¯å¤šè¯­è¨€çš„ï¼Œå¹¶ä½¿ç”¨æ­£ç¡®çš„å·¥å…·æ¥å®Œæˆæ­£ç¡®çš„å·¥ä½œã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœå¯ä»¥ä½¿ç”¨ NoSQL æ•°æ®å­˜å‚¨è€Œä¸æ˜¯å°†æ•°æ®å¡å…¥ SQL æ•°æ®åº“ä¸­æ›´åˆé€‚çš„è¯ã€‚</p>
<p>ç„¶è€Œï¼Œä¸€ä¸ªå…¸å‹çš„é—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨ä»ç°æœ‰çš„å•ä½“åº”ç”¨ç¨‹åºé‡æ„æ—¶ï¼Œæ˜¯æ•°æ®åº“è§„èŒƒåŒ–ï¼Œè¿™æ ·æ¯ä¸ªå¾®æœåŠ¡éƒ½æœ‰æ­£ç¡®æ•°é‡çš„æ•°æ®â€”â€”ä»…æ­¤è€Œå·²ã€‚</p>
<p>å³ä½¿åœ¨å•ä½“åº”ç”¨ç¨‹åºä¸­ä»…ä½¿ç”¨ SQL æ•°æ®åº“ï¼Œå¯¹æ•°æ®åº“è¿›è¡Œéè§„èŒƒåŒ–ä¹Ÿä¼šå¯¼è‡´æ•°æ®é‡å¤ï¼Œå¹¶å¯èƒ½å¯¼è‡´ä¸ä¸€è‡´ã€‚åœ¨è¿‡æ¸¡é˜¶æ®µï¼Œä¸€äº›åº”ç”¨ç¨‹åºå¯èƒ½ä¼šå—ç›Šäºå…±äº«æ•°æ®å¾®æœåŠ¡è®¾è®¡æ¨¡å¼ã€‚</p>
<p>åœ¨è¿™ç§è®¾è®¡æ¨¡å¼ä¸­ï¼Œä¸€äº›å¾®æœåŠ¡ï¼ˆå¯èƒ½åœ¨ä¸€ä¸ªé“¾ä¸­ï¼‰å¯ä»¥å…±äº«ç¼“å­˜å’Œæ•°æ®åº“å­˜å‚¨ã€‚</p>
<p>è¿™åªæœ‰åœ¨ä¸¤ç§æœåŠ¡ä¹‹é—´å­˜åœ¨å¼ºè€¦åˆæ—¶æ‰æœ‰æ„ä¹‰ã€‚æœ‰äº›äººå¯èƒ½è®¤ä¸ºè¿™æ˜¯ä¸€ç§åæ¨¡å¼ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ä¸šåŠ¡éœ€æ±‚å¯èƒ½éœ€è¦éµå¾ªè¿™ä¸€ç‚¹ã€‚å¯¹äºåŸºäºå¾®æœåŠ¡è®¾è®¡çš„å…¨æ–°åº”ç”¨ç¨‹åºï¼Œè¿™è‚¯å®šæ˜¯ä¸€ç§åæ¨¡å¼ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/microservices-branch-shared-data.png" alt="microservices-branch-shared-data"  />
</p>
<p>è¿™ä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªè¿‡æ¸¡é˜¶æ®µï¼Œç›´åˆ°å¾®æœåŠ¡è¿‡æ¸¡åˆ°å®Œå…¨è‡ªä¸»ã€‚</p>
<h2 id="å¼‚æ­¥æ¶ˆæ¯å¾®æœåŠ¡è®¾è®¡æ¨¡å¼">å¼‚æ­¥æ¶ˆæ¯å¾®æœåŠ¡è®¾è®¡æ¨¡å¼</h2>
<p>è™½ç„¶ REST è®¾è®¡æ¨¡å¼éå¸¸æ™®éä¸”æ˜“äºç†è§£ï¼Œä½†å®ƒå…·æœ‰åŒæ­¥å’Œé˜»å¡çš„å±€é™æ€§ã€‚</p>
<p>å¯ä»¥å®ç°å¼‚æ­¥ï¼Œä½†è¿™æ˜¯ä»¥ç‰¹å®šäºåº”ç”¨ç¨‹åºçš„æ–¹å¼å®Œæˆçš„ã€‚å› æ­¤ï¼Œä¸€äº›å¾®æœåŠ¡æ¶æ„å¯èƒ½ä¼šé€‰æ‹©ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—è€Œä¸æ˜¯ REST è¯·æ±‚/å“åº”ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/microservices-async-messaging.png" alt="microservices-async-messaging"  />
</p>
<p>åœ¨è¿™ç§è®¾è®¡æ¨¡å¼ä¸­ï¼ŒæœåŠ¡ A å¯ä»¥åŒæ­¥è°ƒç”¨æœåŠ¡ Cï¼Œç„¶åæœåŠ¡ C ä½¿ç”¨å…±äº«æ¶ˆæ¯é˜Ÿåˆ—ä¸æœåŠ¡ B å’Œ D å¼‚æ­¥é€šä¿¡ã€‚</p>
<p>æœåŠ¡ A -&gt; æœåŠ¡ C é€šä¿¡å¯èƒ½æ˜¯å¼‚æ­¥çš„ï¼Œå¯èƒ½ä½¿ç”¨ WebSocketsï¼Œä»¥å®ç°æ‰€éœ€çš„å¯ä¼¸ç¼©æ€§ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨ REST è¯·æ±‚/å“åº”å’Œå‘å¸ƒ/è®¢é˜…æ¶ˆæ¯ä¼ é€’çš„ç»„åˆæ¥å®Œæˆä¸šåŠ¡éœ€æ±‚ã€‚</p>
<p><a href="http://web.archive.org/web/20190705163602/https://www.voxxed.com/blog/2015/04/coupling-versus-autonomy-in-microservices/">Coupling vs Autonomy in Microservices</a> æ˜¯ä¸€æœ¬å…³äºä¸ºæ‚¨çš„å¾®æœåŠ¡é€‰æ‹©å“ªç§æ¶ˆæ¯ä¼ é€’æ¨¡å¼çš„å¥½è¯»ç‰©ã€‚</p>
<p>å¸Œæœ›æ‚¨å‘ç°è¿™äº›è®¾è®¡æ¨¡å¼å¾ˆæœ‰ç”¨ã€‚</p>
<p>æ‚¨ä½¿ç”¨ä»€ä¹ˆå¾®æœåŠ¡è®¾è®¡æ¨¡å¼ï¼Ÿ</p>
<p>å–„äºäº¤é™…ï¼Œåˆ†äº«ï¼</p>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="http://web.archive.org/web/20190705163602/http://blog.arungupta.me/microservice-design-patterns/">http://web.archive.org/web/20190705163602/http://blog.arungupta.me/microservice-design-patterns/</a></p>
]]></content:encoded>
    </item>
    
    <item>
      <title>Javaè®¾è®¡æ¨¡å¼ï¼šAggregator Microservices</title>
      <link>https://blog.chensoul.com/posts/2023/06/26/java-design-patterns-aggregator-microservices/</link>
      <pubDate>Mon, 26 Jun 2023 07:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/06/26/java-design-patterns-aggregator-microservices/</guid>
      <description>æœ¬æ–‡ä¸»è¦ä»‹ç» Aggregator Microservices æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚ Java Design Patterns æä¾›äº†å„ç§ Java è®¾è®¡</description>
      <content:encoded><![CDATA[<p>æœ¬æ–‡ä¸»è¦ä»‹ç» Aggregator Microservices æ¨¡å¼ï¼Œåœ¨ <a href="https://java-design-patterns.com/">Java Design Patterns</a>  ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚</p>
<blockquote>
<p><a href="https://java-design-patterns.com/">Java Design Patterns</a> æä¾›äº†å„ç§ Java è®¾è®¡æ¨¡å¼çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ã€‚è¯¥ç½‘ç«™æ—¨åœ¨å¸®åŠ© Java å¼€å‘äººå‘˜äº†è§£å’Œåº”ç”¨å„ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p>
<p>Java Design Patterns ç½‘ç«™æä¾›äº†å¤šç§è®¾è®¡æ¨¡å¼åˆ†ç±»æ–¹å¼ï¼ŒåŒ…æ‹¬åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational Patternsï¼‰ã€ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternsï¼‰å’Œè¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰ï¼Œä»¥åŠå…¶ä»–ä¸€äº›å¸¸è§çš„æ¨¡å¼ã€‚</p>
<p>å¯¹äºæ¯ä¸ªè®¾è®¡æ¨¡å¼ï¼Œè¯¥ç½‘ç«™æä¾›äº†è¯¦ç»†çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ï¼Œå¹¶ä¸”æä¾›äº†ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ã€‚å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©é€‚åˆè‡ªå·±çš„è®¾è®¡æ¨¡å¼ï¼Œå¹¶ä¸”å¯ä»¥å‚è€ƒç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜æ¥ç†è§£å’Œåº”ç”¨è¯¥æ¨¡å¼ã€‚</p>
<p>æ­¤å¤–ï¼ŒJava Design Patterns ç½‘ç«™è¿˜æä¾›äº†ä¸€äº›å…¶ä»–èµ„æºï¼Œå¦‚è®¾è®¡æ¨¡å¼çš„ UML å›¾ã€è®¾è®¡æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ã€è®¾è®¡æ¨¡å¼çš„æ¯”è¾ƒç­‰ã€‚è¿™äº›èµ„æºå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨è®¾è®¡æ¨¡å¼ã€‚</p>
<p>ä¸­æ–‡ç½‘ç«™ï¼š<a href="https://java-design-patterns.com/zh/">https://java-design-patterns.com/zh/</a></p>
<p>Github ä¸Šæºç ä»“åº“ï¼ˆéå®˜æ–¹ï¼‰ï¼š<a href="https://github.com/iluwatar/java-design-patterns">https://github.com/iluwatar/java-design-patterns</a></p>
</blockquote>
<h2 id="æ„å›¾">æ„å›¾</h2>
<p>ç”¨æˆ·å¯¹èšåˆå™¨æœåŠ¡è¿›è¡Œä¸€æ¬¡è°ƒç”¨ï¼Œç„¶åèšåˆå™¨å°†è°ƒç”¨æ¯ä¸ªç›¸å…³çš„å¾®æœåŠ¡ã€‚</p>
<blockquote>
<p>Aggregator Microservices æ˜¯ä¸€ç§å¾®æœåŠ¡æ¶æ„æ¨¡å¼ï¼Œç”¨äºè§£å†³å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ•°æ®èšåˆé—®é¢˜ã€‚è¯¥æ¨¡å¼é€šå¸¸ç”¨äºæœ‰å¤šä¸ªæ•°æ®æºçš„åœºæ™¯ï¼Œä¾‹å¦‚ç”µå­å•†åŠ¡ç½‘ç«™ä¸­çš„äº§å“åˆ—è¡¨é¡µé¢ï¼Œå…¶ä¸­éœ€è¦ä»å¤šä¸ªæœåŠ¡ä¸­è·å–äº§å“ä¿¡æ¯å¹¶ç»„åˆåœ¨ä¸€èµ·æ˜¾ç¤ºã€‚</p>
<p>Aggregator Microservices æ¨¡å¼åŒ…æ‹¬ä¸€ä¸ªèšåˆå™¨æœåŠ¡å’Œå¤šä¸ªåç«¯æœåŠ¡ã€‚èšåˆå™¨æœåŠ¡è´Ÿè´£ä»å¤šä¸ªåç«¯æœåŠ¡ä¸­æ”¶é›†æ•°æ®ï¼Œå¹¶å°†æ•°æ®ç»„åˆæˆä¸€ä¸ªèšåˆçš„å“åº”ã€‚åç«¯æœåŠ¡åˆ™è´Ÿè´£æä¾›ç‰¹å®šçš„æ•°æ®æºï¼Œä¾‹å¦‚äº§å“ä¿¡æ¯ã€åº“å­˜ä¿¡æ¯ã€ä»·æ ¼ä¿¡æ¯ç­‰ã€‚</p>
</blockquote>
<h2 id="è§£é‡Š">è§£é‡Š</h2>
<p>çœŸå®ä¸–ç•Œä¾‹å­</p>
<blockquote>
<p>æˆ‘ä»¬çš„ç½‘ç»œå¸‚åœºéœ€è¦æœ‰å…³äº§å“åŠå…¶å½“å‰åº“å­˜çš„ä¿¡æ¯ã€‚ å®ƒè°ƒç”¨èšåˆæœåŠ¡ï¼ŒèšåˆæœåŠ¡ä¾æ¬¡è°ƒç”¨äº§å“ä¿¡æ¯å¾®æœåŠ¡å’Œäº§å“åº“å­˜å¾®æœåŠ¡ï¼Œè¿”å›ç»„åˆä¿¡æ¯ã€‚</p>
</blockquote>
<p>é€šä¿—åœ°è¯´</p>
<blockquote>
<p>èšåˆå™¨å¾®æœåŠ¡ä»å„ç§å¾®æœåŠ¡ä¸­æ”¶é›†æ•°æ®ï¼Œå¹¶è¿”å›ä¸€ä¸ªèšåˆæ•°æ®ä»¥è¿›è¡Œå¤„ç†ã€‚</p>
</blockquote>
<p>Stack Overflowä¸Šè¯´</p>
<blockquote>
<p>èšåˆå™¨å¾®æœåŠ¡è°ƒç”¨å¤šä¸ªæœåŠ¡ä»¥å®ç°åº”ç”¨ç¨‹åºæ‰€éœ€çš„åŠŸèƒ½ã€‚</p>
</blockquote>
<p><strong>ç¨‹åºç¤ºä¾‹</strong></p>
<p>è®©æˆ‘ä»¬ä»æ•°æ®æ¨¡å‹å¼€å§‹ã€‚ è¿™æ˜¯æˆ‘ä»¬çš„<code>äº§å“</code>ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="kt">int</span> <span class="n">productInventories</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// getters and setters -&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä»‹ç»æˆ‘ä»¬çš„èšåˆå™¨å¾®æœåŠ¡ã€‚ å®ƒåŒ…å«ç”¨äºè°ƒç”¨ç›¸åº”å¾®æœåŠ¡çš„å®¢æˆ·ç«¯<code>ProductInformationClient</code>å’Œ<code> ProductInventoryClient</code>ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Aggregator</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Resource</span>
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="n">ProductInformationClient</span> <span class="n">informationClient</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Resource</span>
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="n">ProductInventoryClient</span> <span class="n">inventoryClient</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">&#34;/product&#34;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">Product</span> <span class="nf">getProduct</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">var</span> <span class="n">product</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Product</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">var</span> <span class="n">productTitle</span> <span class="o">=</span> <span class="n">informationClient</span><span class="o">.</span><span class="na">getProductTitle</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">var</span> <span class="n">productInventory</span> <span class="o">=</span> <span class="n">inventoryClient</span><span class="o">.</span><span class="na">getProductInventories</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//Fallback to error message
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">product</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="n">requireNonNullElse</span><span class="o">(</span><span class="n">productTitle</span><span class="o">,</span> <span class="s">&#34;Error: Fetching Product Title Failed&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//Fallback to default error inventory
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">product</span><span class="o">.</span><span class="na">setProductInventories</span><span class="o">(</span><span class="n">requireNonNullElse</span><span class="o">(</span><span class="n">productInventory</span><span class="o">,</span> <span class="o">-</span><span class="n">1</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">product</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>è¿™æ˜¯äº§å“ä¿¡æ¯å¾®æœåŠ¡çš„ç²¾åå®ç°ã€‚ åº“å­˜å¾®æœåŠ¡ç±»ä¼¼ï¼Œå®ƒåªè¿”å›åº“å­˜è®¡æ•°ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@RestController</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">InformationController</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/information&#34;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getProductTitle</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s">&#34;The Product Title.&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ç°åœ¨è°ƒç”¨æˆ‘ä»¬çš„èšåˆå™¨ REST API ä¼šè¿”å›äº§å“ä¿¡æ¯ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl http://localhost:50004/product
</span></span><span class="line"><span class="cl"><span class="o">{</span><span class="s2">&#34;title&#34;</span>:<span class="s2">&#34;The Product Title.&#34;</span>,<span class="s2">&#34;productInventories&#34;</span>:5<span class="o">}</span>
</span></span></code></pre></div><h2 id="ç‰¹ç‚¹">ç‰¹ç‚¹</h2>
<p>ä»¥ä¸‹æ˜¯è¯¥æ¨¡å¼çš„ä¸€äº›å…³é”®ç‰¹ç‚¹ï¼š</p>
<ul>
<li>å¤šä¸ªåç«¯æœåŠ¡ï¼šAggregator Microservices æ¨¡å¼é€šå¸¸æ¶‰åŠå¤šä¸ªåç«¯æœåŠ¡ï¼Œæ¯ä¸ªåç«¯æœåŠ¡è´Ÿè´£æä¾›ç‰¹å®šç±»å‹çš„æ•°æ®ã€‚</li>
<li>æ•°æ®èšåˆï¼šèšåˆå™¨æœåŠ¡è´Ÿè´£ä»å¤šä¸ªåç«¯æœåŠ¡ä¸­æ”¶é›†æ•°æ®ï¼Œå¹¶å°†æ•°æ®ç»„åˆæˆä¸€ä¸ªèšåˆçš„å“åº”ã€‚</li>
<li>é€æ˜çš„ç»„åˆï¼šèšåˆå™¨æœåŠ¡åº”è¯¥å°½å¯èƒ½é€æ˜åœ°ç»„åˆæ•°æ®ï¼Œä½¿å…¶å¯¹è°ƒç”¨æ–¹çœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªå•ä¸€çš„æ•°æ®æºã€‚</li>
<li>å¼‚æ­¥é€šä¿¡ï¼šç”±äºåç«¯æœåŠ¡å¯èƒ½ä½äºä¸åŒçš„ç½‘ç»œä½ç½®ï¼Œèšåˆå™¨æœåŠ¡é€šå¸¸ä½¿ç”¨å¼‚æ­¥é€šä¿¡æ¥æ”¶é›†æ•°æ®ã€‚</li>
</ul>
<p>Aggregator Microservices æ¨¡å¼å¯ä»¥å¸¦æ¥è®¸å¤šå¥½å¤„ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>å¯ä¼¸ç¼©æ€§ï¼šç”±äºèšåˆå™¨æœåŠ¡å¯ä»¥å¹¶è¡Œåœ°ä»å¤šä¸ªåç«¯æœåŠ¡ä¸­æ”¶é›†æ•°æ®ï¼Œå› æ­¤è¯¥æ¨¡å¼å¯ä»¥é€šè¿‡å¢åŠ åç«¯æœåŠ¡æ¥å®ç°å¯ä¼¸ç¼©æ€§ã€‚</li>
<li>ä½è€¦åˆæ€§ï¼šåç«¯æœåŠ¡å’Œèšåˆå™¨æœåŠ¡ä¹‹é—´çš„ä½è€¦åˆæ€§ä½¿å¾—ç³»ç»Ÿæ›´åŠ çµæ´»ï¼Œå¯ä»¥æ›´è½»æ¾åœ°æ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤åç«¯æœåŠ¡ã€‚</li>
<li>å¯å®šåˆ¶æ€§ï¼šèšåˆå™¨æœåŠ¡å¯ä»¥æ ¹æ®éœ€è¦è‡ªå®šä¹‰æ•°æ®èšåˆçš„é€»è¾‘ï¼Œä»¥æ»¡è¶³ç‰¹å®šçš„ä¸šåŠ¡éœ€æ±‚ã€‚</li>
</ul>
<h2 id="ç±»å›¾">ç±»å›¾</h2>
<p><img loading="lazy" src="https://java-design-patterns.com/assets/aggregator-service-4c5a6036.png" alt="alt text"  />
</p>
<h2 id="é€‚ç”¨æ€§">é€‚ç”¨æ€§</h2>
<p>Aggregator Microservices æ¨¡å¼å¯ä»¥åº”ç”¨äºå„ç§ä¸åŒçš„åœºæ™¯ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„åº”ç”¨ï¼š</p>
<ol>
<li>ç”µå­å•†åŠ¡å¹³å°ï¼šåœ¨ç”µå­å•†åŠ¡å¹³å°ä¸­ï¼Œé€šå¸¸éœ€è¦ä»å¤šä¸ªä¾›åº”å•†é‚£é‡Œè·å–äº§å“ä¿¡æ¯å’Œä»·æ ¼ï¼Œå¹¶å°†å…¶èšåˆåˆ°ä¸€ä¸ªç»Ÿä¸€çš„äº§å“åˆ—è¡¨ä¸­ã€‚Aggregator Microservices å¯ä»¥ç”¨æ¥å¤„ç†è¿™äº›æ•°æ®æºï¼Œå¹¶å°†æ•°æ®èšåˆåˆ°ä¸€ä¸ªå…±åŒçš„äº§å“åˆ—è¡¨ä¸­ã€‚</li>
<li>æ–°é—»èšåˆå¹³å°ï¼šåœ¨æ–°é—»èšåˆå¹³å°ä¸­ï¼Œéœ€è¦ä»ä¸åŒçš„æ–°é—»æ¥æºè·å–æ–°é—»å†…å®¹ï¼Œå¹¶å°†å…¶èšåˆåˆ°ä¸€ä¸ªç»Ÿä¸€çš„æ–°é—»åˆ—è¡¨ä¸­ã€‚Aggregator Microservices å¯ä»¥ç”¨æ¥å¤„ç†è¿™äº›æ–°é—»æ¥æºï¼Œå¹¶å°†æ–°é—»å†…å®¹èšåˆåˆ°ä¸€ä¸ªå…±åŒçš„æ–°é—»åˆ—è¡¨ä¸­ã€‚</li>
<li>é‡‘èæ•°æ®åˆ†æï¼šåœ¨é‡‘èæ•°æ®åˆ†æä¸­ï¼Œéœ€è¦ä»å¤šä¸ªæ•°æ®æºä¸­è·å–æ•°æ®ï¼Œä¾‹å¦‚è‚¡ç¥¨å¸‚åœºæ•°æ®ã€è´§å¸æ±‡ç‡æ•°æ®ã€ç»æµæŒ‡æ ‡æ•°æ®ç­‰ï¼Œå¹¶å°†æ•°æ®èšåˆåˆ°ä¸€ä¸ªç»Ÿä¸€çš„æ•°æ®åˆ†æå·¥å…·ä¸­ã€‚Aggregator Microservices å¯ä»¥ç”¨æ¥å¤„ç†è¿™äº›æ•°æ®æºï¼Œå¹¶å°†æ•°æ®èšåˆåˆ°ä¸€ä¸ªå…±åŒçš„æ•°æ®åˆ†æå·¥å…·ä¸­ã€‚</li>
<li>ç‰©è”ç½‘å¹³å°ï¼šåœ¨ç‰©è”ç½‘å¹³å°ä¸­ï¼Œéœ€è¦ä»å¤šä¸ªä¼ æ„Ÿå™¨è·å–æ•°æ®ï¼Œå¹¶å°†å…¶èšåˆåˆ°ä¸€ä¸ªç»Ÿä¸€çš„æ•°æ®ä¸­å¿ƒä¸­ã€‚Aggregator Microservices å¯ä»¥ç”¨æ¥å¤„ç†è¿™äº›ä¼ æ„Ÿå™¨æ•°æ®æºï¼Œå¹¶å°†æ•°æ®èšåˆåˆ°ä¸€ä¸ªå…±åŒçš„æ•°æ®ä¸­å¿ƒä¸­ã€‚</li>
</ol>
<p>Aggregator Microservices å¯ä»¥ä½¿ç”¨å¤šç§å®ç°æ–¹å¼æ¥å®ç°æ•°æ®èšåˆï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„å®ç°æ–¹å¼ï¼š</p>
<ol>
<li>åŒæ­¥é˜»å¡æ–¹å¼ï¼šåœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œèšåˆå™¨æœåŠ¡æŒ‰ç…§é¡ºåºä»å¤šä¸ªåç«¯æœåŠ¡ä¸­æ”¶é›†æ•°æ®ï¼Œæ¯æ¬¡æ”¶é›†å®Œä¸€ä¸ªæœåŠ¡çš„æ•°æ®åå†æ”¶é›†ä¸‹ä¸€ä¸ªæœåŠ¡çš„æ•°æ®ï¼Œç›´åˆ°æ‰€æœ‰æ•°æ®éƒ½è¢«æ”¶é›†å®Œæ¯•ã€‚è¿™ç§æ–¹å¼çš„ç¼ºç‚¹æ˜¯æ•ˆç‡è¾ƒä½ï¼Œå› ä¸ºæ‰€æœ‰æ“ä½œéƒ½æ˜¯åŒæ­¥é˜»å¡çš„ã€‚</li>
<li>å¼‚æ­¥éé˜»å¡æ–¹å¼ï¼šåœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œèšåˆå™¨æœåŠ¡ä½¿ç”¨å¼‚æ­¥éé˜»å¡çš„æ–¹å¼ä»å¤šä¸ªåç«¯æœåŠ¡ä¸­æ”¶é›†æ•°æ®ï¼Œè¿™å¯ä»¥æé«˜æ•ˆç‡å’Œæ€§èƒ½ã€‚ä¾‹å¦‚ï¼Œèšåˆå™¨æœåŠ¡å¯ä»¥ä½¿ç”¨ Java 8 çš„ CompletableFuture å’Œæµå¼ API æ¥å®ç°å¼‚æ­¥é€šä¿¡å¹¶è¡Œæ”¶é›†æ•°æ®ã€‚</li>
<li>æ•°æ®åº“æ–¹å¼ï¼šåœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œæ¯ä¸ªåç«¯æœåŠ¡è´Ÿè´£å°†æ•°æ®å†™å…¥æ•°æ®åº“ä¸­ï¼Œèšåˆå™¨æœåŠ¡å†ä»æ•°æ®åº“ä¸­è¯»å–æ•°æ®å¹¶è¿›è¡Œèšåˆã€‚è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯å¯ä»¥ä½¿ç”¨æ•°æ®åº“çš„é«˜æ•ˆæŸ¥è¯¢è¯­å¥æ¥èšåˆæ•°æ®ï¼Œä½†ç¼ºç‚¹æ˜¯éœ€è¦é¢å¤–çš„æ•°æ®åº“ç®¡ç†å¼€é”€ã€‚</li>
<li>æ¶ˆæ¯é˜Ÿåˆ—æ–¹å¼ï¼šåœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œæ¯ä¸ªåç«¯æœåŠ¡å°†æ•°æ®å‘é€åˆ°ä¸€ä¸ªå…±äº«çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œèšåˆå™¨æœåŠ¡å†ä»é˜Ÿåˆ—ä¸­è·å–æ•°æ®å¹¶è¿›è¡Œèšåˆã€‚è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯å¯ä»¥å®ç°å¼‚æ­¥é€šä¿¡ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„é«˜æ•ˆæ¶ˆæ¯ä¼ é€’æœºåˆ¶æ¥å®ç°æ•°æ®èšåˆï¼Œä½†ç¼ºç‚¹æ˜¯éœ€è¦é¢å¤–çš„æ¶ˆæ¯é˜Ÿåˆ—ç®¡ç†å¼€é”€ã€‚</li>
<li>è¾¹ç¼˜è®¡ç®—æ–¹å¼ï¼šåœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œèšåˆå™¨æœåŠ¡å¯ä»¥åœ¨è¾¹ç¼˜è®¾å¤‡ä¸­è¿è¡Œï¼Œç›´æ¥ä»å¤šä¸ªä¼ æ„Ÿå™¨æˆ–è®¾å¤‡ä¸­æ”¶é›†æ•°æ®å¹¶è¿›è¡Œèšåˆã€‚è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹æ˜¯å¯ä»¥å‡å°‘æ•°æ®ä¼ è¾“å’Œå­˜å‚¨çš„å¼€é”€ï¼Œä½†ç¼ºç‚¹æ˜¯éœ€è¦å¤„ç†è¾¹ç¼˜è®¾å¤‡çš„ç¡¬ä»¶å’Œè½¯ä»¶é™åˆ¶ã€‚</li>
</ol>
<p>å½“ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ–¹å¼æ¥å®ç° Aggregator Microservices æ—¶ï¼Œå¯ä»¥åº”ç”¨äºä»¥ä¸‹ä¸€äº›å®é™…çš„åœºæ™¯ï¼š</p>
<ol>
<li>
<p>æ—¥å¿—èšåˆï¼šåœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¯èƒ½ä¼šç”Ÿæˆå¤§é‡çš„æ—¥å¿—æ•°æ®ï¼Œå¦‚æœå°†æ‰€æœ‰çš„æ—¥å¿—æ•°æ®å‘é€åˆ°ä¸­å¿ƒæœåŠ¡å™¨ä¸Šè¿›è¡Œèšåˆï¼Œè¿™ä¼šå¯¼è‡´ä¸­å¿ƒæœåŠ¡å™¨çš„å‹åŠ›éå¸¸å¤§ã€‚ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ–¹å¼ï¼Œå¯ä»¥å°†æ—¥å¿—æ•°æ®å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå†ç”±èšåˆå™¨æœåŠ¡ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å–æ•°æ®æ¥è¿›è¡Œèšåˆï¼Œè¿™æ ·å¯ä»¥é™ä½ä¸­å¿ƒæœåŠ¡å™¨çš„å‹åŠ›ï¼Œæé«˜ç³»ç»Ÿçš„å¯ä¼¸ç¼©æ€§å’Œæ€§èƒ½ã€‚</p>
</li>
<li>
<p>ç”µå•†å¹³å°è®¢å•å¤„ç†ï¼šåœ¨ä¸€ä¸ªç”µå•†å¹³å°ä¸­ï¼Œè®¢å•æ•°æ®å¯èƒ½ä¼šåˆ†æ•£åœ¨å¤šä¸ªè®¢å•ç³»ç»Ÿä¸­ï¼Œä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ–¹å¼ï¼Œå¯ä»¥å°†è®¢å•æ•°æ®å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå†ç”±èšåˆå™¨æœåŠ¡ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å–æ•°æ®æ¥è¿›è¡Œèšåˆï¼Œè¿™æ ·å¯ä»¥å®ç°è®¢å•æ•°æ®çš„ç»Ÿä¸€å¤„ç†ï¼Œæé«˜ç³»ç»Ÿçš„å¯é æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
</li>
<li>
<p>ç‰©è”ç½‘æ•°æ®èšåˆï¼šåœ¨ä¸€ä¸ªç‰©è”ç½‘ç³»ç»Ÿä¸­ï¼Œå¯èƒ½éœ€è¦ä»å¤šä¸ªä¼ æ„Ÿå™¨ä¸­è·å–æ•°æ®ï¼Œå¹¶å°†æ•°æ®èšåˆåˆ°ä¸€ä¸ªå…±åŒçš„æ•°æ®ä¸­å¿ƒä¸­ã€‚ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ–¹å¼ï¼Œå¯ä»¥å°†ä¼ æ„Ÿå™¨æ•°æ®å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå†ç”±èšåˆå™¨æœåŠ¡ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å–æ•°æ®æ¥è¿›è¡Œèšåˆï¼Œè¿™æ ·å¯ä»¥æé«˜ç³»ç»Ÿçš„å¯ä¼¸ç¼©æ€§å’Œæ€§èƒ½ï¼Œå¹¶ä¸”ç¼“è§£è¾¹ç¼˜è®¾å¤‡çš„è´Ÿè½½å‹åŠ›ã€‚</p>
</li>
<li>
<p>å®æ—¶æ•°æ®å¤„ç†ï¼šåœ¨ä¸€ä¸ªå®æ—¶æ•°æ®å¤„ç†ç³»ç»Ÿä¸­ï¼Œå¯èƒ½éœ€è¦ä»å¤šä¸ªæ•°æ®æºä¸­è·å–æ•°æ®ï¼Œå¹¶å°†æ•°æ®èšåˆåˆ°ä¸€ä¸ªå…±åŒçš„æ•°æ®å¤„ç†ä¸­å¿ƒä¸­ã€‚ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ–¹å¼ï¼Œå¯ä»¥å°†å®æ—¶æ•°æ®å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå†ç”±èšåˆå™¨æœåŠ¡ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å–æ•°æ®æ¥è¿›è¡Œèšåˆï¼Œè¿™æ ·å¯ä»¥å®ç°å®æ—¶æ•°æ®çš„å¿«é€Ÿå¤„ç†å’Œåˆ†æã€‚</p>
</li>
</ol>
<p>ä¸€ä¸ªå¼‚æ­¥èšåˆæœåŠ¡ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// èšåˆå™¨æœåŠ¡ç±»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AggregatorService</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// åç«¯æœåŠ¡åˆ—è¡¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">BackendService</span><span class="o">&gt;</span> <span class="n">backendServices</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">AggregatorService</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">BackendService</span><span class="o">&gt;</span> <span class="n">backendServices</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">backendServices</span> <span class="o">=</span> <span class="n">backendServices</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// èšåˆæ•°æ®çš„æ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="nf">getProducts</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">products</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// å¹¶è¡Œæ”¶é›†æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">List</span><span class="o">&lt;</span><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;&gt;&gt;</span> <span class="n">futures</span> <span class="o">=</span> <span class="n">backendServices</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">backendService</span> <span class="o">-&gt;</span> <span class="n">CompletableFuture</span><span class="o">.</span><span class="na">supplyAsync</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">backendService</span><span class="o">.</span><span class="na">getProducts</span><span class="o">()))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// ç­‰å¾…æ‰€æœ‰å¼‚æ­¥æ“ä½œå®Œæˆå¹¶èšåˆæ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">CompletableFuture</span><span class="o">.</span><span class="na">allOf</span><span class="o">(</span><span class="n">futures</span><span class="o">.</span><span class="na">toArray</span><span class="o">(</span><span class="k">new</span> <span class="n">CompletableFuture</span><span class="o">[</span><span class="n">futures</span><span class="o">.</span><span class="na">size</span><span class="o">()]))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">join</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">futures</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">CompletableFuture</span><span class="o">::</span><span class="n">join</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">products</span><span class="o">::</span><span class="n">addAll</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">products</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// åç«¯æœåŠ¡æ¥å£
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">BackendService</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="nf">getProducts</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// åç«¯æœåŠ¡å®ç°ç±»1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BackendServiceA</span> <span class="kd">implements</span> <span class="n">BackendService</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="nf">getProducts</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ä»æ•°æ®åº“è·å–äº§å“ä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">products</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">        <span class="n">products</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Product</span><span class="o">(</span><span class="s">&#34;Product A1&#34;</span><span class="o">,</span> <span class="n">10</span><span class="o">.</span><span class="na">0</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">products</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Product</span><span class="o">(</span><span class="s">&#34;Product A2&#34;</span><span class="o">,</span> <span class="n">20</span><span class="o">.</span><span class="na">0</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">products</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Product</span><span class="o">(</span><span class="s">&#34;Product A3&#34;</span><span class="o">,</span> <span class="n">30</span><span class="o">.</span><span class="na">0</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">products</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// åç«¯æœåŠ¡å®ç°ç±»2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BackendServiceB</span> <span class="kd">implements</span> <span class="n">BackendService</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="nf">getProducts</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ä»APIè·å–äº§å“ä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">List</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span> <span class="n">products</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">        <span class="n">products</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Product</span><span class="o">(</span><span class="s">&#34;Product B1&#34;</span><span class="o">,</span> <span class="n">15</span><span class="o">.</span><span class="na">0</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">products</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Product</span><span class="o">(</span><span class="s">&#34;Product B2&#34;</span><span class="o">,</span> <span class="n">25</span><span class="o">.</span><span class="na">0</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">products</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// äº§å“ç±»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Product</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">double</span> <span class="n">price</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">Product</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">double</span> <span class="n">price</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">price</span> <span class="o">=</span> <span class="n">price</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// çœç•¥ getter å’Œ setter æ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªèšåˆå™¨æœåŠ¡ç±» <code>AggregatorService</code>ï¼Œå®ƒåŒ…å«äº†å¤šä¸ªåç«¯æœåŠ¡æ¥å£ <code>BackendService</code> çš„å®ç°ç±» <code>BackendServiceA</code> å’Œ <code>BackendServiceB</code>ã€‚èšåˆå™¨æœåŠ¡ç±»çš„ <code>getProducts()</code> æ–¹æ³•è´Ÿè´£ä»å¤šä¸ªåç«¯æœåŠ¡ä¸­æ”¶é›†äº§å“æ•°æ®ï¼Œå¹¶å°†æ•°æ®ç»„åˆæˆä¸€ä¸ªèšåˆçš„å“åº”ã€‚åœ¨æ”¶é›†æ•°æ®æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Java 8 çš„ <code>CompletableFuture</code> å’Œæµå¼ API æ¥å®ç°å¼‚æ­¥é€šä¿¡å¹¶è¡Œæ”¶é›†æ•°æ®ã€‚æœ€åï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç®€å•çš„äº§å“ç±» <code>Product</code>ï¼Œç”¨äºå°è£…äº§å“ä¿¡æ¯ã€‚</p>
<p>Aggregator Microservices æ¨¡å¼å·²ç»å¾—åˆ°äº†å¹¿æ³›çš„åº”ç”¨å’Œæ”¯æŒï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„å¼€æºæ¡†æ¶å’Œå·¥å…·ï¼Œå®ƒä»¬æä¾›äº† Aggregator Microservices æ¨¡å¼çš„å®ç°ï¼š</p>
<ol>
<li>
<p>Apache Camelï¼šæ˜¯ä¸€ä¸ªåŸºäº Java çš„å¼€æºæ¡†æ¶ï¼Œç”¨äºå¿«é€Ÿå®ç°å„ç§ä¼ä¸šé›†æˆæ¨¡å¼ï¼ˆEIPï¼‰ï¼ŒåŒ…æ‹¬èšåˆå™¨æ¨¡å¼ã€‚Apache Camel æä¾›äº†å¤šç§èšåˆå™¨ç»„ä»¶ï¼Œä¾‹å¦‚ Aggregatorã€Splitterã€Resequencer ç­‰ï¼Œå¯ä»¥çµæ´»åœ°èšåˆå’Œå¤„ç†æ•°æ®ã€‚</p>
</li>
<li>
<p>Spring Integrationï¼šæ˜¯ Spring ç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¸€ä¸ªé›†æˆæ¡†æ¶ï¼Œä¹Ÿæ”¯æŒ Aggregator Microservices æ¨¡å¼ã€‚Spring Integration æä¾›äº†å¤šç§èšåˆå™¨ç»„ä»¶ï¼Œä¾‹å¦‚ Aggregatorã€Barrierã€ReleaseStrategy ç­‰ï¼Œå¯ä»¥ç”¨æ¥èšåˆå’Œå¤„ç†æ¶ˆæ¯ã€‚</p>
</li>
<li>
<p>Apache Kafkaï¼šæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æµå¤„ç†å¹³å°ï¼Œç”¨äºå¤„ç†é«˜ååé‡çš„å®æ—¶æ•°æ®æµï¼Œä¹Ÿæ”¯æŒ Aggregator Microservices æ¨¡å¼ã€‚Apache Kafka æä¾›äº†æ¶ˆæ¯é˜Ÿåˆ—å’Œæµå¤„ç†åŠŸèƒ½ï¼Œå¯ä»¥ç”¨æ¥èšåˆå’Œå¤„ç†æ•°æ®æµã€‚</p>
</li>
<li>
<p>RabbitMQï¼šæ˜¯ä¸€ä¸ªå¼€æºçš„æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼Œæ”¯æŒå¤šç§æ¶ˆæ¯åè®®å’Œæ¶ˆæ¯æ¨¡å¼ï¼Œä¹Ÿæ”¯æŒ Aggregator Microservices æ¨¡å¼ã€‚RabbitMQ æä¾›äº†å¤šç§æ¶ˆæ¯åè®®å’Œæ¶ˆæ¯æ¨¡å¼ï¼Œå¯ä»¥ç”¨æ¥èšåˆå’Œå¤„ç†æ¶ˆæ¯ã€‚</p>
</li>
<li>
<p>Apache Sparkï¼šæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶ï¼Œç”¨äºå¤„ç†å¤§è§„æ¨¡æ•°æ®é›†ï¼Œä¹Ÿæ”¯æŒ Aggregator Microservices æ¨¡å¼ã€‚Apache Spark æä¾›äº†å¤šç§æ•°æ®å¤„ç†å’ŒèšåˆåŠŸèƒ½ï¼Œå¯ä»¥ç”¨æ¥èšåˆå’Œå¤„ç†å¤§è§„æ¨¡æ•°æ®é›†ã€‚</p>
</li>
</ol>
<h2 id="å‚è€ƒæ–‡ç« ">å‚è€ƒæ–‡ç« </h2>
<ul>
<li><a href="http://web.archive.org/web/20190705163602/http://blog.arungupta.me/microservice-design-patterns/">Microservice Design Patterns</a></li>
<li><a href="https://www.amazon.com/gp/product/1617294543/ref=as_li_qf_asin_il_tl?ie=UTF8&amp;tag=javadesignpat-20&amp;creative=9325&amp;linkCode=as2&amp;creativeASIN=1617294543&amp;linkId=8b4e570267bc5fb8b8189917b461dc60">Microservices Patterns: With examples in Java</a></li>
<li><a href="https://www.amazon.com/gp/product/B077T7V8RC/ref=as_li_qf_asin_il_tl?ie=UTF8&amp;tag=javadesignpat-20&amp;creative=9325&amp;linkCode=as2&amp;creativeASIN=B077T7V8RC&amp;linkId=c34d204bfe1b277914b420189f09c1a4">Architectural Patterns: Uncover essential patterns in the most indispensable realm of enterprise architecture</a></li>
</ul>
]]></content:encoded>
    </item>
    
    <item>
      <title>[è¯‘]Pythonæ¨¡å—å’ŒåŒ…-ç®€ä»‹</title>
      <link>https://blog.chensoul.com/posts/2023/06/25/python-modules-packages/</link>
      <pubDate>Sun, 25 Jun 2023 14:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/06/25/python-modules-packages/</guid>
      <description>æœ¬æ–‡æ¢è®¨äº† Python æ¨¡å—å’Œ Python åŒ…ï¼Œè¿™ä¸¤ç§æœºåˆ¶æœ‰åŠ©äºæ¨¡å—åŒ–ç¼–ç¨‹ã€‚ æ¨¡å—åŒ–ç¼–ç¨‹æ˜¯æŒ‡å°†å¤§å‹ã€ç¬¨é‡çš„ç¼–ç¨‹ä»»åŠ¡åˆ†è§£ä¸ºå•ç‹¬çš„ã€æ›´å°çš„ã€æ›´æ˜“äºç®¡ç†çš„å­ä»»åŠ¡æˆ–æ¨¡å—çš„è¿‡ç¨‹</description>
      <content:encoded><![CDATA[<p><img loading="lazy" src="https://files.realpython.com/media/Python-Modules-and-Packages-An-Introduction_Watermarked.20936240a94d.jpg" alt="Python Modules &amp;amp; Packages"  />
</p>
<p>æœ¬æ–‡æ¢è®¨äº† Python æ¨¡å—å’Œ Python åŒ…ï¼Œè¿™ä¸¤ç§æœºåˆ¶æœ‰åŠ©äºæ¨¡å—åŒ–ç¼–ç¨‹ã€‚</p>
<p>æ¨¡å—åŒ–ç¼–ç¨‹æ˜¯æŒ‡å°†å¤§å‹ã€ç¬¨é‡çš„ç¼–ç¨‹ä»»åŠ¡åˆ†è§£ä¸ºå•ç‹¬çš„ã€æ›´å°çš„ã€æ›´æ˜“äºç®¡ç†çš„å­ä»»åŠ¡æˆ–æ¨¡å—çš„è¿‡ç¨‹ã€‚ç„¶åå¯ä»¥åƒæ„å»ºå—ä¸€æ ·å°†å„ä¸ªæ¨¡å—æ‹¼å‡‘åœ¨ä¸€èµ·ä»¥åˆ›å»ºæ›´å¤§çš„åº”ç”¨ç¨‹åºã€‚</p>
<p>åœ¨å¤§å‹åº”ç”¨ç¨‹åºä¸­æ¨¡å—åŒ–ä»£ç æœ‰å‡ ä¸ªä¼˜ç‚¹ï¼š</p>
<ul>
<li>
<p>ç®€å•æ€§ï¼šæ¨¡å—é€šå¸¸ä¸ä¼šä¸“æ³¨äºæ‰‹å¤´çš„æ•´ä¸ªé—®é¢˜ï¼Œè€Œæ˜¯ä¸“æ³¨äºé—®é¢˜çš„ä¸€ä¸ªç›¸å¯¹è¾ƒå°çš„éƒ¨åˆ†ã€‚å¦‚æœæ‚¨æ­£åœ¨å¤„ç†å•ä¸ªæ¨¡å—ï¼Œé‚£ä¹ˆæ‚¨å°†æœ‰ä¸€ä¸ªè¾ƒå°çš„é—®é¢˜åŸŸæ¥è§£å†³é—®é¢˜ã€‚è¿™ä½¿å¾—å¼€å‘æ›´å®¹æ˜“å¹¶ä¸”æ›´ä¸å®¹æ˜“å‡ºé”™ã€‚</p>
</li>
<li>
<p>å¯ç»´æŠ¤æ€§ï¼šæ¨¡å—é€šå¸¸è®¾è®¡ä¸ºåœ¨ä¸åŒé—®é¢˜åŸŸä¹‹é—´å¼ºåˆ¶æ‰§è¡Œé€»è¾‘è¾¹ç•Œã€‚å¦‚æœæ¨¡å—æ˜¯ä»¥æœ€å°åŒ–ç›¸äº’ä¾èµ–çš„æ–¹å¼ç¼–å†™çš„ï¼Œé‚£ä¹ˆå¯¹å•ä¸ªæ¨¡å—çš„ä¿®æ”¹å¯¹ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†äº§ç”Ÿå½±å“çš„å¯èƒ½æ€§å°±ä¼šé™ä½ã€‚ï¼ˆæ‚¨ç”šè‡³å¯ä»¥åœ¨ä¸äº†è§£è¯¥æ¨¡å—ä¹‹å¤–çš„åº”ç”¨ç¨‹åºçš„æƒ…å†µä¸‹å¯¹è¯¥æ¨¡å—è¿›è¡Œæ›´æ”¹ã€‚ï¼‰è¿™ä½¿å¾—ç”±è®¸å¤šç¨‹åºå‘˜ç»„æˆçš„å›¢é˜Ÿåœ¨å¤§å‹åº”ç”¨ç¨‹åºä¸ŠååŒå·¥ä½œå˜å¾—æ›´åŠ å¯è¡Œã€‚</p>
</li>
<li>
<p>å¯é‡ç”¨æ€§ï¼šåœ¨å•ä¸ªæ¨¡å—ä¸­å®šä¹‰çš„åŠŸèƒ½å¯ä»¥å¾ˆå®¹æ˜“åœ°è¢«åº”ç”¨ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†é‡ç”¨ï¼ˆé€šè¿‡é€‚å½“å®šä¹‰çš„æ¥å£ï¼‰ã€‚è¿™æ¶ˆé™¤äº†é‡å¤ä»£ç çš„éœ€è¦ã€‚</p>
</li>
<li>
<p>ä½œç”¨åŸŸï¼šæ¨¡å—é€šå¸¸å®šä¹‰ä¸€ä¸ªå•ç‹¬çš„<a href="https://realpython.com/python-namespaces-scope/">åç§°ç©ºé—´</a>ï¼Œè¿™æœ‰åŠ©äºé¿å…ç¨‹åºä¸åŒåŒºåŸŸä¸­æ ‡è¯†ç¬¦ä¹‹é—´çš„å†²çªã€‚ ï¼ˆ<a href="https://realpython.com/zen-of-python/">Python ä¹‹ç¦…</a>çš„ä¿¡æ¡ä¹‹ä¸€æ˜¯å‘½åç©ºé—´æ˜¯ä¸€ä¸ªéå¸¸æ£’çš„æƒ³æ³•â€”â€”è®©æˆ‘ä»¬åšæ›´å¤šè¿™æ ·çš„äº‹æƒ…å§ï¼ï¼‰</p>
</li>
</ul>
<p>å‡½æ•°ã€æ¨¡å—å’ŒåŒ…éƒ½æ˜¯ Python ä¸­ä¿ƒè¿›ä»£ç æ¨¡å—åŒ–çš„æ„é€ ã€‚</p>
<h2 id="python-æ¨¡å—æ¦‚è¿°">Python æ¨¡å—ï¼šæ¦‚è¿°</h2>
<p>åœ¨ Python ä¸­å®é™…ä¸Šæœ‰ä¸‰ç§ä¸åŒçš„æ–¹å¼æ¥å®šä¹‰æ¨¡å—ï¼š</p>
<ul>
<li>
<p>æ¨¡å—å¯ä»¥ç”¨ Python æœ¬èº«ç¼–å†™ã€‚</p>
</li>
<li>
<p>æ¨¡å—å¯ä»¥ç”¨ C è¯­è¨€ç¼–å†™å¹¶åœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½ï¼Œä¾‹å¦‚ <code>re</code> ï¼ˆ<a href="https://realpython.com/regex-python/">æ­£åˆ™è¡¨è¾¾å¼</a>ï¼‰æ¨¡å—ã€‚</p>
</li>
<li>
<p>å†…ç½®æ¨¡å—æœ¬è´¨ä¸ŠåŒ…å«åœ¨è§£é‡Šå™¨ä¸­ï¼Œä¾‹å¦‚ <code>itertools</code> æ¨¡å—ã€‚</p>
</li>
</ul>
<p>åœ¨æ‰€æœ‰ä¸‰ç§æƒ…å†µä¸‹ï¼Œæ¨¡å—çš„å†…å®¹éƒ½ä»¥ç›¸åŒçš„æ–¹å¼è®¿é—®ï¼šä½¿ç”¨ <code>import</code> è¯­å¥ã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œé‡ç‚¹å°†ä¸»è¦æ”¾åœ¨ç”¨ Python ç¼–å†™çš„æ¨¡å—ä¸Šã€‚ç”¨ Python ç¼–å†™çš„æ¨¡å—çš„å¦™å¤„åœ¨äºå®ƒä»¬çš„æ„å»ºéå¸¸ç®€å•ã€‚</p>
<p>æ‚¨éœ€è¦åšçš„å°±æ˜¯åˆ›å»ºä¸€ä¸ªåŒ…å«åˆæ³• Python ä»£ç çš„æ–‡ä»¶ï¼Œç„¶åä¸ºè¯¥æ–‡ä»¶æŒ‡å®šä¸€ä¸ªå¸¦æœ‰ <code>.py</code> æ‰©å±•åçš„åç§°ã€‚å°±æ˜¯è¿™æ ·ï¼ä¸éœ€è¦ç‰¹æ®Šçš„è¯­æ³•æˆ–å·«æœ¯ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨åˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>mod.py</code> çš„æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p>
<p>mod.py</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">s</span> <span class="o">=</span> <span class="s2">&#34;If Comrade Napoleon says it, it must be right.&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;arg = </span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span></code></pre></div><p><code>mod.py</code> ä¸­å®šä¹‰äº†å‡ ä¸ªå¯¹è±¡ï¼š</p>
<ul>
<li><code>s</code> ï¼ˆå­—ç¬¦ä¸²ï¼‰</li>
<li><code>a</code> ï¼ˆåˆ—è¡¨ï¼‰</li>
<li><code>foo()</code> ï¼ˆå‡½æ•°ï¼‰</li>
<li><code>Foo</code> ï¼ˆç±»ï¼‰</li>
</ul>
<p>å‡è®¾ <code>mod.py</code> ä½äºé€‚å½“çš„ä½ç½®ï¼ˆæ‚¨å¾ˆå¿«å°±ä¼šäº†è§£æ›´å¤šä¿¡æ¯ï¼‰ï¼Œå¯ä»¥é€šè¿‡å¯¼å…¥æ¨¡å—æ¥è®¿é—®è¿™äº›å¯¹è±¡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; import mod
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; print<span class="o">(</span>mod.s<span class="o">)</span>
</span></span><span class="line"><span class="cl">If Comrade Napoleon says it, it must be right.
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; mod.a
</span></span><span class="line"><span class="cl"><span class="o">[</span>100, 200, 300<span class="o">]</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; mod.foo<span class="o">([</span><span class="s1">&#39;quux&#39;</span>, <span class="s1">&#39;corge&#39;</span>, <span class="s1">&#39;grault&#39;</span><span class="o">])</span>
</span></span><span class="line"><span class="cl"><span class="nv">arg</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;quux&#39;</span>, <span class="s1">&#39;corge&#39;</span>, <span class="s1">&#39;grault&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; <span class="nv">x</span> <span class="o">=</span> mod.Foo<span class="o">()</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; x
</span></span><span class="line"><span class="cl">&lt;mod.Foo object at 0x03C181F0&gt;
</span></span></code></pre></div><h2 id="æ¨¡å—æœç´¢è·¯å¾„">æ¨¡å—æœç´¢è·¯å¾„</h2>
<p>ç»§ç»­ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹Pythonæ‰§è¡Œè¯­å¥æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">mod</span>
</span></span></code></pre></div><p>å½“è§£é‡Šå™¨æ‰§è¡Œä¸Šè¿° <code>import</code> è¯­å¥æ—¶ï¼Œå®ƒä¼šåœ¨ç”±ä»¥ä¸‹æ¥æºç»„è£…çš„ç›®å½•åˆ—è¡¨ä¸­æœç´¢ <code>mod.py</code> ï¼š</p>
<ul>
<li>è¿è¡Œè¾“å…¥è„šæœ¬çš„ç›®å½•æˆ–å½“å‰ç›®å½•ï¼ˆå¦‚æœè§£é‡Šå™¨æ­£åœ¨äº¤äº’å¼è¿è¡Œï¼‰</li>
<li><code>PYTHONPATH</code> ç¯å¢ƒå˜é‡ä¸­åŒ…å«çš„ç›®å½•åˆ—è¡¨ï¼ˆå¦‚æœå·²è®¾ç½®ï¼‰ã€‚ ï¼ˆ <code>PYTHONPATH</code> çš„æ ¼å¼å–å†³äºæ“ä½œç³»ç»Ÿï¼Œä½†åº”æ¨¡ä»¿ <code>PATH</code> ç¯å¢ƒå˜é‡ã€‚ï¼‰</li>
<li>å®‰è£… Python æ—¶é…ç½®çš„ä¾èµ–äºå®‰è£…çš„ç›®å½•åˆ—è¡¨</li>
</ul>
<p>ç”Ÿæˆçš„æœç´¢è·¯å¾„å¯åœ¨ Python å˜é‡ <code>sys.path</code> ä¸­è®¿é—®ï¼Œè¯¥å˜é‡æ˜¯ä»åä¸º <code>sys</code> çš„æ¨¡å—è·å–çš„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; import sys
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; sys.path
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="s1">&#39;&#39;</span>, <span class="s1">&#39;C:\\Users\\john\\Documents\\Python\\doc&#39;</span>, <span class="s1">&#39;C:\\Python36\\Lib\\idlelib&#39;</span>,
</span></span><span class="line"><span class="cl"><span class="s1">&#39;C:\\Python36\\python36.zip&#39;</span>, <span class="s1">&#39;C:\\Python36\\DLLs&#39;</span>, <span class="s1">&#39;C:\\Python36\\lib&#39;</span>,
</span></span><span class="line"><span class="cl"><span class="s1">&#39;C:\\Python36&#39;</span>, <span class="s1">&#39;C:\\Python36\\lib\\site-packages&#39;</span><span class="o">]</span>
</span></span></code></pre></div><blockquote>
<p>æ³¨æ„ï¼š <code>sys.path</code> çš„å…·ä½“å†…å®¹å–å†³äºå®‰è£…ã€‚å‡ ä¹å¯ä»¥è‚¯å®šï¼Œä¸Šé¢çš„å†…å®¹åœ¨æ‚¨çš„è®¡ç®—æœºä¸Šçœ‹èµ·æ¥ä¼šç•¥æœ‰ä¸åŒã€‚</p>
</blockquote>
<p>å› æ­¤ï¼Œä¸ºç¡®ä¿æ‰¾åˆ°æ‚¨çš„æ¨¡å—ï¼Œæ‚¨éœ€è¦æ‰§è¡Œä»¥ä¸‹æ“ä½œä¹‹ä¸€ï¼š</p>
<ul>
<li>å°† <code>mod.py</code> æ”¾å…¥è¾“å…¥è„šæœ¬æ‰€åœ¨ç›®å½•æˆ–å½“å‰ç›®å½•ï¼Œå¦‚æœæ˜¯äº¤äº’å¼çš„</li>
<li>åœ¨å¯åŠ¨è§£é‡Šå™¨ä¹‹å‰ä¿®æ”¹ <code>PYTHONPATH</code> ç¯å¢ƒå˜é‡ä»¥åŒ…å« <code>mod.py</code> æ‰€åœ¨ç›®å½•
<ul>
<li>æˆ–è€…ï¼šå°† <code>mod.py</code> æ”¾å…¥ <code>PYTHONPATH</code> å˜é‡ä¸­å·²åŒ…å«çš„ç›®å½•ä¹‹ä¸€</li>
</ul>
</li>
<li>å°† <code>mod.py</code> æ”¾å…¥ä¾èµ–äºå®‰è£…çš„ç›®å½•ä¹‹ä¸€ï¼Œæ‚¨å¯èƒ½æœ‰ä¹Ÿå¯èƒ½æ²¡æœ‰å†™å…¥æƒé™ï¼Œå…·ä½“å–å†³äºæ“ä½œç³»ç»Ÿ</li>
</ul>
<p>å®é™…ä¸Šè¿˜æœ‰ä¸€ä¸ªé™„åŠ é€‰é¡¹ï¼šæ‚¨å¯ä»¥å°†æ¨¡å—æ–‡ä»¶æ”¾åœ¨æ‚¨é€‰æ‹©çš„ä»»ä½•ç›®å½•ä¸­ï¼Œç„¶ååœ¨è¿è¡Œæ—¶ä¿®æ”¹ <code>sys.path</code> ä»¥ä½¿å…¶åŒ…å«è¯¥ç›®å½•ã€‚ä¾‹å¦‚ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥å°† <code>mod.py</code> æ”¾å…¥ç›®å½• <code>C:\Users\john</code> ä¸­ï¼Œç„¶åå‘å‡ºä»¥ä¸‹è¯­å¥ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; sys.path.append<span class="o">(</span>r<span class="s1">&#39;C:\Users\john&#39;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; sys.path
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="s1">&#39;&#39;</span>, <span class="s1">&#39;C:\\Users\\john\\Documents\\Python\\doc&#39;</span>, <span class="s1">&#39;C:\\Python36\\Lib\\idlelib&#39;</span>,
</span></span><span class="line"><span class="cl"><span class="s1">&#39;C:\\Python36\\python36.zip&#39;</span>, <span class="s1">&#39;C:\\Python36\\DLLs&#39;</span>, <span class="s1">&#39;C:\\Python36\\lib&#39;</span>,
</span></span><span class="line"><span class="cl"><span class="s1">&#39;C:\\Python36&#39;</span>, <span class="s1">&#39;C:\\Python36\\lib\\site-packages&#39;</span>, <span class="s1">&#39;C:\\Users\\john&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; import mod
</span></span></code></pre></div><p>å¯¼å…¥æ¨¡å—åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ¨¡å—çš„ <code>__file__</code> å±æ€§ç¡®å®šæ‰¾åˆ°å®ƒçš„ä½ç½®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; import mod
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; mod.__file__
</span></span><span class="line"><span class="cl"><span class="s1">&#39;C:\\Users\\john\\mod.py&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; import re
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; re.__file__
</span></span><span class="line"><span class="cl"><span class="s1">&#39;C:\\Python36\\lib\\re.py&#39;</span>
</span></span></code></pre></div><p><code>__file__</code> çš„ç›®å½•éƒ¨åˆ†åº”è¯¥æ˜¯ <code>sys.path</code> ä¸­çš„ç›®å½•ä¹‹ä¸€ã€‚</p>
<h2 id="import-å£°æ˜"><code>import</code> å£°æ˜</h2>
<p>æ¨¡å—å†…å®¹å¯é€šè¿‡ <code>import</code> è¯­å¥æä¾›ç»™è°ƒç”¨è€…ã€‚ <code>import</code> è¯­å¥æœ‰å¤šç§ä¸åŒçš„å½¢å¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<h3 id="import-module_name"><code>import &lt;module_name&gt;</code></h3>
<p>æœ€ç®€å•çš„å½¢å¼æ˜¯ä¸Šé¢å·²ç»æ˜¾ç¤ºçš„å½¢å¼ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="o">&lt;</span><span class="n">module_name</span><span class="o">&gt;</span>
</span></span></code></pre></div><p>è¯·æ³¨æ„ï¼Œè¿™ä¸ä¼šä½¿è°ƒç”¨è€…ç›´æ¥è®¿é—®æ¨¡å—å†…å®¹ã€‚æ¯ä¸ªæ¨¡å—éƒ½æœ‰è‡ªå·±çš„ç§æœ‰ç¬¦å·è¡¨ï¼Œä½œä¸ºæ¨¡å—ä¸­å®šä¹‰çš„æ‰€æœ‰å¯¹è±¡çš„å…¨å±€ç¬¦å·è¡¨ã€‚å› æ­¤ï¼Œå¦‚å‰æ‰€è¿°ï¼Œæ¨¡å—åˆ›å»ºäº†ä¸€ä¸ªå•ç‹¬çš„åç§°ç©ºé—´ã€‚</p>
<p>è¯­å¥ <code>import &lt;module_name&gt;</code> ä»…å°† <code>&lt;module_name&gt;</code> æ”¾å…¥è°ƒç”¨è€…çš„ç¬¦å·è¡¨ä¸­ã€‚æ¨¡å—ä¸­å®šä¹‰çš„å¯¹è±¡ä¿ç•™åœ¨æ¨¡å—çš„ç§æœ‰ç¬¦å·è¡¨ä¸­ã€‚</p>
<p>å¯¹äºè°ƒç”¨è€…æ¥è¯´ï¼Œåªæœ‰é€šè¿‡ç‚¹ç¬¦å·ä»¥ <code>&lt;module_name&gt;</code> ä¸ºå‰ç¼€æ—¶æ‰èƒ½è®¿é—®æ¨¡å—ä¸­çš„å¯¹è±¡ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p>åœ¨ä»¥ä¸‹ <code>import</code> è¯­å¥ä¹‹åï¼Œ <code>mod</code> è¢«æ”¾å…¥æœ¬åœ°ç¬¦å·è¡¨ä¸­ã€‚å› æ­¤ï¼Œ <code>mod</code> åœ¨è°ƒç”¨è€…çš„æœ¬åœ°ä¸Šä¸‹æ–‡ä¸­æœ‰æ„ä¹‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; import mod
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; mod
</span></span><span class="line"><span class="cl">&lt;module <span class="s1">&#39;mod&#39;</span> from <span class="s1">&#39;C:\\Users\\john\\Documents\\Python\\doc\\mod.py&#39;</span>&gt;
</span></span></code></pre></div><p>ä½†æ˜¯ <code>s</code> å’Œ <code>foo</code> ä¿ç•™åœ¨æ¨¡å—çš„ç§æœ‰ç¬¦å·è¡¨ä¸­ï¼Œå¹¶ä¸”åœ¨æœ¬åœ°ä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰æ„ä¹‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; s
</span></span><span class="line"><span class="cl">NameError: name <span class="s1">&#39;s&#39;</span> is not defined
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; foo<span class="o">(</span><span class="s1">&#39;quux&#39;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">NameError: name <span class="s1">&#39;foo&#39;</span> is not defined
</span></span></code></pre></div><p>è¦åœ¨æœ¬åœ°ä¸Šä¸‹æ–‡ä¸­è®¿é—®ï¼Œæ¨¡å—ä¸­å®šä¹‰çš„å¯¹è±¡åç§°å¿…é¡»ä»¥ <code>mod</code> ä¸ºå‰ç¼€ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; mod.s
</span></span><span class="line"><span class="cl"><span class="s1">&#39;If Comrade Napoleon says it, it must be right.&#39;</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; mod.foo<span class="o">(</span><span class="s1">&#39;quux&#39;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">arg</span> <span class="o">=</span> quux
</span></span></code></pre></div><p>å¯ä»¥åœ¨å•ä¸ª <code>import</code> è¯­å¥ä¸­æŒ‡å®šå¤šä¸ªä»¥é€—å·åˆ†éš”çš„æ¨¡å—ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">import &lt;module_name&gt;<span class="o">[</span>, &lt;module_name&gt; ...<span class="o">]</span>
</span></span></code></pre></div><h3 id="from-module_name-import-names"><code>from &lt;module_name&gt; import &lt;name(s)&gt;</code></h3>
<p><code>import</code> è¯­å¥çš„å¦ä¸€ç§å½¢å¼å…è®¸å°†æ¨¡å—ä¸­çš„å„ä¸ªå¯¹è±¡ç›´æ¥å¯¼å…¥åˆ°è°ƒç”¨è€…çš„ç¬¦å·è¡¨ä¸­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="o">&lt;</span><span class="n">module_name</span><span class="o">&gt;</span> <span class="kn">import</span> <span class="o">&lt;</span><span class="n">name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">&gt;</span>
</span></span></code></pre></div><p>æ‰§è¡Œä¸Šè¿°è¯­å¥åï¼Œå¯ä»¥åœ¨è°ƒç”¨è€…çš„ç¯å¢ƒä¸­å¼•ç”¨ <code>&lt;name(s)&gt;</code> ï¼Œè€Œæ— éœ€ä½¿ç”¨ <code>&lt;module_name&gt;</code> å‰ç¼€ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; from mod import s, foo
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; s
</span></span><span class="line"><span class="cl"><span class="s1">&#39;If Comrade Napoleon says it, it must be right.&#39;</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; foo<span class="o">(</span><span class="s1">&#39;quux&#39;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">arg</span> <span class="o">=</span> quux
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; from mod import Foo
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; <span class="nv">x</span> <span class="o">=</span> Foo<span class="o">()</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; x
</span></span><span class="line"><span class="cl">&lt;mod.Foo object at 0x02E3AD50&gt;
</span></span></code></pre></div><p>å› ä¸ºè¿™ç§å½¢å¼çš„ <code>import</code> å°†å¯¹è±¡åç§°ç›´æ¥æ”¾å…¥è°ƒç”¨è€…çš„ç¬¦å·è¡¨ä¸­ï¼Œå› æ­¤ä»»ä½•å·²å­˜åœ¨çš„åŒåå¯¹è±¡éƒ½å°†è¢«è¦†ç›–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; <span class="nv">a</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;foo&#39;</span>, <span class="s1">&#39;bar&#39;</span>, <span class="s1">&#39;baz&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; a
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="s1">&#39;foo&#39;</span>, <span class="s1">&#39;bar&#39;</span>, <span class="s1">&#39;baz&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; from mod import a
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; a
</span></span><span class="line"><span class="cl"><span class="o">[</span>100, 200, 300<span class="o">]</span>
</span></span></code></pre></div><p>ç”šè‡³å¯ä»¥ä¸åŠ åŒºåˆ«åœ°ä¸€æ¬¡æ€§ <code>import</code> æ¨¡å—ä¸­çš„æ‰€æœ‰å†…å®¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="o">&lt;</span><span class="n">module_name</span><span class="o">&gt;</span> <span class="kn">import</span> <span class="o">*</span>
</span></span></code></pre></div><p>è¿™ä¼šå°† <code>&lt;module_name&gt;</code> ä¸­çš„æ‰€æœ‰å¯¹è±¡çš„åç§°æ”¾å…¥æœ¬åœ°ç¬¦å·è¡¨ä¸­ï¼Œä½†ä»¥ä¸‹åˆ’çº¿ ( <code>_</code> ) å­—ç¬¦å¼€å¤´çš„å¯¹è±¡é™¤å¤–ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; from mod import *
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; s
</span></span><span class="line"><span class="cl"><span class="s1">&#39;If Comrade Napoleon says it, it must be right.&#39;</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; a
</span></span><span class="line"><span class="cl"><span class="o">[</span>100, 200, 300<span class="o">]</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; foo
</span></span><span class="line"><span class="cl">&lt;<span class="k">function</span> foo at 0x03B449C0&gt;
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; Foo
</span></span><span class="line"><span class="cl">&lt;class <span class="s1">&#39;mod.Foo&#39;</span>&gt;
</span></span></code></pre></div><p>åœ¨å¤§è§„æ¨¡ç”Ÿäº§ä»£ç ä¸­ä¸ä¸€å®šæ¨èè¿™æ ·åšã€‚è¿™æœ‰ç‚¹å±é™©ï¼Œå› ä¸ºæ‚¨æ­£åœ¨å°†åç§°ä¸€èµ·è¾“å…¥åˆ°æœ¬åœ°ç¬¦å·è¡¨ä¸­ã€‚é™¤éæ‚¨éå¸¸äº†è§£å®ƒä»¬å¹¶ä¸”å¯ä»¥ç¡®ä¿¡ä¸ä¼šå‘ç”Ÿå†²çªï¼Œå¦åˆ™æ‚¨å¾ˆæœ‰å¯èƒ½ä¼šæ— æ„ä¸­è¦†ç›–ç°æœ‰åç§°ã€‚</p>
<p>ä½†æ˜¯ï¼Œå½“æ‚¨åªæ˜¯ä¸ºäº†æµ‹è¯•æˆ–å‘ç°ç›®çš„è€Œä½¿ç”¨äº¤äº’å¼è§£é‡Šå™¨æ—¶ï¼Œè¿™ç§è¯­æ³•éå¸¸æ–¹ä¾¿ï¼Œå› ä¸ºå®ƒå¯ä»¥è®©æ‚¨å¿«é€Ÿè®¿é—®æ¨¡å—å¿…é¡»æä¾›çš„æ‰€æœ‰å†…å®¹ï¼Œè€Œæ— éœ€è¿›è¡Œå¤§é‡è¾“å…¥ã€‚</p>
<h3 id="from-module_name-import-name-as-alt_name"><code>from &lt;module_name&gt; import &lt;name&gt; as &lt;alt_name&gt;</code></h3>
<p>ä¹Ÿå¯ä»¥ <code>import</code> å•ä¸ªå¯¹è±¡ï¼Œä½†ä½¿ç”¨å¤‡ç”¨åç§°å°†å®ƒä»¬è¾“å…¥åˆ°æœ¬åœ°ç¬¦å·è¡¨ä¸­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="o">&lt;</span><span class="n">module_name</span><span class="o">&gt;</span> <span class="kn">import</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span> <span class="k">as</span> <span class="o">&lt;</span><span class="n">alt_name</span><span class="o">&gt;</span><span class="p">[,</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span> <span class="k">as</span> <span class="o">&lt;</span><span class="n">alt_name</span><span class="o">&gt;</span> <span class="err">â€¦</span><span class="p">]</span>
</span></span></code></pre></div><p>è¿™ä½¿å¾—å°†åç§°ç›´æ¥æ”¾å…¥æœ¬åœ°ç¬¦å·è¡¨æˆä¸ºå¯èƒ½ï¼Œä½†é¿å…ä¸ä»¥å‰å­˜åœ¨çš„åç§°å‘ç”Ÿå†²çªï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; <span class="nv">s</span> <span class="o">=</span> <span class="s1">&#39;foo&#39;</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; <span class="nv">a</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;foo&#39;</span>, <span class="s1">&#39;bar&#39;</span>, <span class="s1">&#39;baz&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; from mod import s as string, a as alist
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; s
</span></span><span class="line"><span class="cl"><span class="s1">&#39;foo&#39;</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; string
</span></span><span class="line"><span class="cl"><span class="s1">&#39;If Comrade Napoleon says it, it must be right.&#39;</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; a
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="s1">&#39;foo&#39;</span>, <span class="s1">&#39;bar&#39;</span>, <span class="s1">&#39;baz&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; alist
</span></span><span class="line"><span class="cl"><span class="o">[</span>100, 200, 300<span class="o">]</span>
</span></span></code></pre></div><h3 id="import-module_name-as-alt_name"><code>import &lt;module_name&gt; as &lt;alt_name&gt;</code></h3>
<p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨å¤‡ç”¨åç§°å¯¼å…¥æ•´ä¸ªæ¨¡å—ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="o">&lt;</span><span class="n">module_name</span><span class="o">&gt;</span> <span class="k">as</span> <span class="o">&lt;</span><span class="n">alt_name</span><span class="o">&gt;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; import mod as my_module
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; my_module.a
</span></span><span class="line"><span class="cl"><span class="o">[</span>100, 200, 300<span class="o">]</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; my_module.foo<span class="o">(</span><span class="s1">&#39;qux&#39;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">arg</span> <span class="o">=</span> qux
</span></span></code></pre></div><p>æ¨¡å—å†…å®¹å¯ä»¥ä»å‡½æ•°å®šä¹‰ä¸­å¯¼å…¥ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨è°ƒç”¨è¯¥å‡½æ•°ä¹‹å‰ï¼Œ <code>import</code> ä¸ä¼šå‘ç”Ÿï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; def bar<span class="o">()</span>:
</span></span><span class="line"><span class="cl">...     from mod import foo
</span></span><span class="line"><span class="cl">...     foo<span class="o">(</span><span class="s1">&#39;corge&#39;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; bar<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="nv">arg</span> <span class="o">=</span> corge
</span></span></code></pre></div><p>ç„¶è€Œï¼ŒPython 3 ä¸å…è®¸å‡½æ•°å†…ä¸åŠ åŒºåˆ«åœ°ä½¿ç”¨ <code>import *</code> è¯­æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; def bar<span class="o">()</span>:
</span></span><span class="line"><span class="cl">...     from mod import *
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">SyntaxError: import * only allowed at module level
</span></span></code></pre></div><p>æœ€åï¼Œå¸¦æœ‰ <code>except ImportError</code> å­å¥çš„ <code>try</code> è¯­å¥å¯ç”¨äºé˜²æ­¢ä¸æˆåŠŸçš„ <code>import</code> å°è¯•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; try:
</span></span><span class="line"><span class="cl">...     <span class="c1"># Non-existent module</span>
</span></span><span class="line"><span class="cl">...     import baz
</span></span><span class="line"><span class="cl">... except ImportError:
</span></span><span class="line"><span class="cl">...     print<span class="o">(</span><span class="s1">&#39;Module not found&#39;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Module not found
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; try:
</span></span><span class="line"><span class="cl">...     <span class="c1"># Existing module, but non-existent object</span>
</span></span><span class="line"><span class="cl">...     from mod import baz
</span></span><span class="line"><span class="cl">... except ImportError:
</span></span><span class="line"><span class="cl">...     print<span class="o">(</span><span class="s1">&#39;Object not found in module&#39;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Object not found in module
</span></span></code></pre></div><h2 id="dir-å‡½æ•°"><code>dir()</code> å‡½æ•°</h2>
<p>å†…ç½®å‡½æ•° <code>dir()</code> è¿”å›å‘½åç©ºé—´ä¸­å·²å®šä¹‰åç§°çš„åˆ—è¡¨ã€‚å¦‚æœæ²¡æœ‰å‚æ•°ï¼Œå®ƒä¼šåœ¨å½“å‰æœ¬åœ°ç¬¦å·è¡¨ä¸­ç”ŸæˆæŒ‰å­—æ¯é¡ºåºæ’åºçš„åç§°åˆ—è¡¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; dir<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="s1">&#39;__annotations__&#39;</span>, <span class="s1">&#39;__builtins__&#39;</span>, <span class="s1">&#39;__doc__&#39;</span>, <span class="s1">&#39;__loader__&#39;</span>, <span class="s1">&#39;__name__&#39;</span>,
</span></span><span class="line"><span class="cl"><span class="s1">&#39;__package__&#39;</span>, <span class="s1">&#39;__spec__&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; <span class="nv">qux</span> <span class="o">=</span> <span class="o">[</span>1, 2, 3, 4, 5<span class="o">]</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; dir<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="s1">&#39;__annotations__&#39;</span>, <span class="s1">&#39;__builtins__&#39;</span>, <span class="s1">&#39;__doc__&#39;</span>, <span class="s1">&#39;__loader__&#39;</span>, <span class="s1">&#39;__name__&#39;</span>,
</span></span><span class="line"><span class="cl"><span class="s1">&#39;__package__&#39;</span>, <span class="s1">&#39;__spec__&#39;</span>, <span class="s1">&#39;qux&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; class Bar<span class="o">()</span>:
</span></span><span class="line"><span class="cl">...     pass
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; <span class="nv">x</span> <span class="o">=</span> Bar<span class="o">()</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; dir<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="s1">&#39;Bar&#39;</span>, <span class="s1">&#39;__annotations__&#39;</span>, <span class="s1">&#39;__builtins__&#39;</span>, <span class="s1">&#39;__doc__&#39;</span>, <span class="s1">&#39;__loader__&#39;</span>, <span class="s1">&#39;__name__&#39;</span>,
</span></span><span class="line"><span class="cl"><span class="s1">&#39;__package__&#39;</span>, <span class="s1">&#39;__spec__&#39;</span>, <span class="s1">&#39;qux&#39;</span>, <span class="s1">&#39;x&#39;</span><span class="o">]</span>
</span></span></code></pre></div><p>è¯·æ³¨æ„ä¸Šé¢å¯¹ <code>dir()</code> çš„ç¬¬ä¸€æ¬¡è°ƒç”¨å¦‚ä½•åˆ—å‡ºè§£é‡Šå™¨å¯åŠ¨æ—¶è‡ªåŠ¨å®šä¹‰ä¸”å·²åœ¨å‘½åç©ºé—´ä¸­çš„å‡ ä¸ªåç§°ã€‚å½“å®šä¹‰æ–°åç§°ï¼ˆ <code>qux</code> ã€ <code>Bar</code> ã€ <code>x</code> ï¼‰æ—¶ï¼Œå®ƒä»¬ä¼šå‡ºç°åœ¨ <code>dir()</code> çš„åç»­è°ƒç”¨ä¸­ã€‚</p>
<p>è¿™å¯¹äºè¯†åˆ« import è¯­å¥åˆ°åº•æ·»åŠ åˆ°å‘½åç©ºé—´ä¸­çš„å†…å®¹éå¸¸æœ‰ç”¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; dir<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="s1">&#39;__annotations__&#39;</span>, <span class="s1">&#39;__builtins__&#39;</span>, <span class="s1">&#39;__doc__&#39;</span>, <span class="s1">&#39;__loader__&#39;</span>, <span class="s1">&#39;__name__&#39;</span>,
</span></span><span class="line"><span class="cl"><span class="s1">&#39;__package__&#39;</span>, <span class="s1">&#39;__spec__&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; import mod
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; dir<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="s1">&#39;__annotations__&#39;</span>, <span class="s1">&#39;__builtins__&#39;</span>, <span class="s1">&#39;__doc__&#39;</span>, <span class="s1">&#39;__loader__&#39;</span>, <span class="s1">&#39;__name__&#39;</span>,
</span></span><span class="line"><span class="cl"><span class="s1">&#39;__package__&#39;</span>, <span class="s1">&#39;__spec__&#39;</span>, <span class="s1">&#39;mod&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; mod.s
</span></span><span class="line"><span class="cl"><span class="s1">&#39;If Comrade Napoleon says it, it must be right.&#39;</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; mod.foo<span class="o">([</span>1, 2, 3<span class="o">])</span>
</span></span><span class="line"><span class="cl"><span class="nv">arg</span> <span class="o">=</span> <span class="o">[</span>1, 2, 3<span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; from mod import a, Foo
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; dir<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="s1">&#39;Foo&#39;</span>, <span class="s1">&#39;__annotations__&#39;</span>, <span class="s1">&#39;__builtins__&#39;</span>, <span class="s1">&#39;__doc__&#39;</span>, <span class="s1">&#39;__loader__&#39;</span>, <span class="s1">&#39;__name__&#39;</span>,
</span></span><span class="line"><span class="cl"><span class="s1">&#39;__package__&#39;</span>, <span class="s1">&#39;__spec__&#39;</span>, <span class="s1">&#39;a&#39;</span>, <span class="s1">&#39;mod&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; a
</span></span><span class="line"><span class="cl"><span class="o">[</span>100, 200, 300<span class="o">]</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; <span class="nv">x</span> <span class="o">=</span> Foo<span class="o">()</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; x
</span></span><span class="line"><span class="cl">&lt;mod.Foo object at 0x002EAD50&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; from mod import s as string
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; dir<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="s1">&#39;Foo&#39;</span>, <span class="s1">&#39;__annotations__&#39;</span>, <span class="s1">&#39;__builtins__&#39;</span>, <span class="s1">&#39;__doc__&#39;</span>, <span class="s1">&#39;__loader__&#39;</span>, <span class="s1">&#39;__name__&#39;</span>,
</span></span><span class="line"><span class="cl"><span class="s1">&#39;__package__&#39;</span>, <span class="s1">&#39;__spec__&#39;</span>, <span class="s1">&#39;a&#39;</span>, <span class="s1">&#39;mod&#39;</span>, <span class="s1">&#39;string&#39;</span>, <span class="s1">&#39;x&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; string
</span></span><span class="line"><span class="cl"><span class="s1">&#39;If Comrade Napoleon says it, it must be right.&#39;</span>
</span></span></code></pre></div><p>å½“ç»™å®šä¸€ä¸ªæ¨¡å—åç§°çš„å‚æ•°æ—¶ï¼Œ <code>dir()</code> åˆ—å‡ºæ¨¡å—ä¸­å®šä¹‰çš„åç§°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; import mod
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; dir<span class="o">(</span>mod<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="s1">&#39;Foo&#39;</span>, <span class="s1">&#39;__builtins__&#39;</span>, <span class="s1">&#39;__cached__&#39;</span>, <span class="s1">&#39;__doc__&#39;</span>, <span class="s1">&#39;__file__&#39;</span>, <span class="s1">&#39;__loader__&#39;</span>,
</span></span><span class="line"><span class="cl"><span class="s1">&#39;__name__&#39;</span>, <span class="s1">&#39;__package__&#39;</span>, <span class="s1">&#39;__spec__&#39;</span>, <span class="s1">&#39;a&#39;</span>, <span class="s1">&#39;foo&#39;</span>, <span class="s1">&#39;s&#39;</span><span class="o">]</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; dir<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="s1">&#39;__annotations__&#39;</span>, <span class="s1">&#39;__builtins__&#39;</span>, <span class="s1">&#39;__doc__&#39;</span>, <span class="s1">&#39;__loader__&#39;</span>, <span class="s1">&#39;__name__&#39;</span>,
</span></span><span class="line"><span class="cl"><span class="s1">&#39;__package__&#39;</span>, <span class="s1">&#39;__spec__&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; from mod import *
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; dir<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="s1">&#39;Foo&#39;</span>, <span class="s1">&#39;__annotations__&#39;</span>, <span class="s1">&#39;__builtins__&#39;</span>, <span class="s1">&#39;__doc__&#39;</span>, <span class="s1">&#39;__loader__&#39;</span>, <span class="s1">&#39;__name__&#39;</span>,
</span></span><span class="line"><span class="cl"><span class="s1">&#39;__package__&#39;</span>, <span class="s1">&#39;__spec__&#39;</span>, <span class="s1">&#39;a&#39;</span>, <span class="s1">&#39;foo&#39;</span>, <span class="s1">&#39;s&#39;</span><span class="o">]</span>
</span></span></code></pre></div><h2 id="ä»è„šæœ¬æ‰§è¡Œæ¨¡å—">ä»è„šæœ¬æ‰§è¡Œæ¨¡å—</h2>
<p>ä»»ä½•åŒ…å«æ¨¡å—çš„ <code>.py</code> æ–‡ä»¶æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ª Python è„šæœ¬ï¼Œå¹¶ä¸”æ²¡æœ‰ä»»ä½•ç†ç”±ä¸èƒ½åƒè„šæœ¬ä¸€æ ·æ‰§è¡Œã€‚</p>
<p>è¿™é‡Œåˆæ˜¯ä¸Šé¢å®šä¹‰çš„ <code>mod.py</code> ï¼š</p>
<p><em>mod.py</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">s</span> <span class="o">=</span> <span class="s2">&#34;If Comrade Napoleon says it, it must be right.&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;arg = </span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span></code></pre></div><p>è¿™å¯ä»¥ä½œä¸ºè„šæœ¬è¿è¡Œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">C:<span class="se">\U</span>sers<span class="se">\j</span>ohn<span class="se">\D</span>ocuments&gt;python mod.py
</span></span><span class="line"><span class="cl">C:<span class="se">\U</span>sers<span class="se">\j</span>ohn<span class="se">\D</span>ocuments&gt;
</span></span></code></pre></div><p>æ²¡æœ‰é”™è¯¯ï¼Œæ‰€ä»¥å®ƒæ˜¾ç„¶æœ‰æ•ˆã€‚å½“ç„¶ï¼Œè¿™å¹¶ä¸æ˜¯å¾ˆæœ‰è¶£ã€‚æ­£å¦‚å®ƒæ‰€å†™çš„ï¼Œå®ƒåªå®šä¹‰äº†å¯¹è±¡ã€‚å®ƒä¸ä¼šå¯¹å®ƒä»¬åšä»»ä½•äº‹æƒ…ï¼Œä¹Ÿä¸ä¼šç”Ÿæˆä»»ä½•è¾“å‡ºã€‚</p>
<p>è®©æˆ‘ä»¬ä¿®æ”¹ä¸Šé¢çš„ Python æ¨¡å—ï¼Œä»¥ä¾¿å®ƒåœ¨ä½œä¸ºè„šæœ¬è¿è¡Œæ—¶ç”Ÿæˆä¸€äº›è¾“å‡ºï¼š</p>
<p>mod.py</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">s</span> <span class="o">=</span> <span class="s2">&#34;If Comrade Napoleon says it, it must be right.&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;arg = </span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">foo</span><span class="p">(</span><span class="s1">&#39;quux&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span></code></pre></div><p>ç°åœ¨åº”è¯¥æ›´æœ‰è¶£äº†ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">C:<span class="se">\U</span>sers<span class="se">\j</span>ohn<span class="se">\D</span>ocuments&gt;python mod.py
</span></span><span class="line"><span class="cl">If Comrade Napoleon says it, it must be right.
</span></span><span class="line"><span class="cl"><span class="o">[</span>100, 200, 300<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">arg</span> <span class="o">=</span> quux
</span></span><span class="line"><span class="cl">&lt;__main__.Foo object at 0x02F101D0&gt;
</span></span></code></pre></div><p>ä¸å¹¸çš„æ˜¯ï¼Œç°åœ¨å®ƒåœ¨ä½œä¸ºæ¨¡å—å¯¼å…¥æ—¶ä¹Ÿä¼šç”Ÿæˆè¾“å‡ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; import mod
</span></span><span class="line"><span class="cl">If Comrade Napoleon says it, it must be right.
</span></span><span class="line"><span class="cl"><span class="o">[</span>100, 200, 300<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">arg</span> <span class="o">=</span> quux
</span></span><span class="line"><span class="cl">&lt;mod.Foo object at 0x0169AD50&gt;
</span></span></code></pre></div><p>è¿™å¯èƒ½ä¸æ˜¯æ‚¨æƒ³è¦çš„ã€‚æ¨¡å—åœ¨å¯¼å…¥æ—¶é€šå¸¸ä¸ä¼šç”Ÿæˆè¾“å‡ºã€‚</p>
<p>å¦‚æœæ‚¨èƒ½å¤ŸåŒºåˆ†æ–‡ä»¶ä½•æ—¶ä½œä¸ºæ¨¡å—åŠ è½½ä»¥åŠä½•æ—¶ä½œä¸ºç‹¬ç«‹è„šæœ¬è¿è¡Œï¼Œå²‚ä¸æ˜¯å¾ˆå¥½ï¼Ÿ</p>
<p>ç¥ˆæ±‚ï¼Œä½ ä»¬å°±ä¼šæ”¶åˆ°ã€‚</p>
<p>å½“ <code>.py</code> æ–‡ä»¶ä½œä¸ºæ¨¡å—å¯¼å…¥æ—¶ï¼ŒPython ä¼šå°†ç‰¹æ®Šçš„ dunder å˜é‡ <code>__name__</code> è®¾ç½®ä¸ºæ¨¡å—çš„åç§°ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ–‡ä»¶ä½œä¸ºç‹¬ç«‹è„šæœ¬è¿è¡Œï¼Œåˆ™ <code>__name__</code> ï¼ˆåˆ›é€ æ€§åœ°ï¼‰è®¾ç½®ä¸ºå­—ç¬¦ä¸² <code>'__main__'</code> ã€‚åˆ©ç”¨è¿™ä¸€äº‹å®ï¼Œæ‚¨å¯ä»¥è¾¨åˆ«è¿è¡Œæ—¶çš„æƒ…å†µå¹¶ç›¸åº”åœ°æ”¹å˜è¡Œä¸ºï¼š</p>
<p><em>mod.py</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">s</span> <span class="o">=</span> <span class="s2">&#34;If Comrade Napoleon says it, it must be right.&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;arg = </span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Executing as standalone script&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">foo</span><span class="p">(</span><span class="s1">&#39;quux&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span></code></pre></div><p>ç°åœ¨ï¼Œå¦‚æœæ‚¨ä½œä¸ºè„šæœ¬è¿è¡Œï¼Œæ‚¨å°†å¾—åˆ°è¾“å‡ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">C:<span class="se">\U</span>sers<span class="se">\j</span>ohn<span class="se">\D</span>ocuments&gt;python mod.py
</span></span><span class="line"><span class="cl">Executing as standalone script
</span></span><span class="line"><span class="cl">If Comrade Napoleon says it, it must be right.
</span></span><span class="line"><span class="cl"><span class="o">[</span>100, 200, 300<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">arg</span> <span class="o">=</span> quux
</span></span><span class="line"><span class="cl">&lt;__main__.Foo object at 0x03450690&gt;
</span></span></code></pre></div><p>ä½†å¦‚æœæ‚¨ä½œä¸ºæ¨¡å—å¯¼å…¥ï¼Œåˆ™ä¸ä¼šï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; import mod
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; mod.foo<span class="o">(</span><span class="s1">&#39;grault&#39;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">arg</span> <span class="o">=</span> grault
</span></span></code></pre></div><p>æ¨¡å—é€šå¸¸è®¾è®¡ä¸ºèƒ½å¤Ÿä½œä¸ºç‹¬ç«‹è„šæœ¬è¿è¡Œï¼Œä»¥æµ‹è¯•æ¨¡å—ä¸­åŒ…å«çš„åŠŸèƒ½ã€‚è¿™ç§°ä¸ºå•å…ƒæµ‹è¯•ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«é˜¶ä¹˜å‡½æ•°çš„æ¨¡å— <code>fact.py</code> ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>fact.py</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">fact</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">n</span> <span class="o">*</span> <span class="n">fact</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">fact</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
</span></span></code></pre></div><p>è¯¥æ–‡ä»¶å¯ä»¥è¢«è§†ä¸ºä¸€ä¸ªæ¨¡å—ï¼Œå¹¶å¯¼å…¥ <code>fact()</code> å‡½æ•°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; from fact import fact
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; fact<span class="o">(</span>6<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="m">720</span>
</span></span></code></pre></div><p>ä½†å®ƒä¹Ÿå¯ä»¥é€šè¿‡åœ¨å‘½ä»¤è¡Œä¸Šä¼ é€’æ•´æ•°å‚æ•°æ¥ç‹¬ç«‹è¿è¡Œä»¥è¿›è¡Œæµ‹è¯•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">C:<span class="se">\U</span>sers<span class="se">\j</span>ohn<span class="se">\D</span>ocuments&gt;python fact.py <span class="m">6</span>
</span></span><span class="line"><span class="cl"><span class="m">720</span>
</span></span></code></pre></div><h2 id="é‡æ–°åŠ è½½æ¨¡å—">é‡æ–°åŠ è½½æ¨¡å—</h2>
<p>å‡ºäºæ•ˆç‡åŸå› ï¼Œæ¯ä¸ªè§£é‡Šå™¨ä¼šè¯ä»…åŠ è½½ä¸€ä¸ªæ¨¡å—ä¸€æ¬¡ã€‚è¿™å¯¹äºå‡½æ•°å’Œç±»å®šä¹‰æ¥è¯´å¾ˆå¥½ï¼Œå®ƒä»¬é€šå¸¸æ„æˆäº†æ¨¡å—çš„å¤§éƒ¨åˆ†å†…å®¹ã€‚ä½†æ¨¡å—ä¹Ÿå¯ä»¥åŒ…å«å¯æ‰§è¡Œè¯­å¥ï¼Œé€šå¸¸ç”¨äºåˆå§‹åŒ–ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œè¿™äº›è¯­å¥ä»…åœ¨ç¬¬ä¸€æ¬¡å¯¼å…¥æ¨¡å—æ—¶æ‰§è¡Œã€‚</p>
<p>è€ƒè™‘ä»¥ä¸‹æ–‡ä»¶ <code>mod.py</code> ï¼š</p>
<p><em>mod.py</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a =&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; import mod
</span></span><span class="line"><span class="cl"><span class="nv">a</span> <span class="o">=</span> <span class="o">[</span>100, 200, 300<span class="o">]</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; import mod
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; import mod
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; mod.a
</span></span><span class="line"><span class="cl"><span class="o">[</span>100, 200, 300<span class="o">]</span>
</span></span></code></pre></div><p>åç»­å¯¼å…¥æ—¶ä¸ä¼šæ‰§è¡Œ <code>print()</code> è¯­å¥ã€‚ ï¼ˆå°±æ­¤è€Œè¨€ï¼Œèµ‹å€¼è¯­å¥ä¹Ÿä¸æ˜¯ï¼Œä½†æ­£å¦‚ <code>mod.a</code> å€¼çš„æœ€ç»ˆæ˜¾ç¤ºæ‰€ç¤ºï¼Œè¿™å¹¶ä¸é‡è¦ã€‚ä¸€æ—¦è¿›è¡Œèµ‹å€¼ï¼Œå®ƒå°±ä¼šä¿ç•™ã€‚ï¼‰</p>
<p>å¦‚æœæ‚¨å¯¹æ¨¡å—è¿›è¡Œæ›´æ”¹å¹¶éœ€è¦é‡æ–°åŠ è½½å®ƒï¼Œåˆ™éœ€è¦é‡æ–°å¯åŠ¨è§£é‡Šå™¨æˆ–ä½¿ç”¨æ¨¡å— <code>importlib</code> ä¸­åä¸º <code>reload()</code> çš„å‡½æ•°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; import mod
</span></span><span class="line"><span class="cl"><span class="nv">a</span> <span class="o">=</span> <span class="o">[</span>100, 200, 300<span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; import mod
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; import importlib
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; importlib.reload<span class="o">(</span>mod<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">a</span> <span class="o">=</span> <span class="o">[</span>100, 200, 300<span class="o">]</span>
</span></span><span class="line"><span class="cl">&lt;module <span class="s1">&#39;mod&#39;</span> from <span class="s1">&#39;C:\\Users\\john\\Documents\\Python\\doc\\mod.py&#39;</span>&gt;
</span></span></code></pre></div><h2 id="python-åŒ…">Python åŒ…</h2>
<p>å‡è®¾æ‚¨å¼€å‘äº†ä¸€ä¸ªéå¸¸å¤§çš„åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­åŒ…å«è®¸å¤šæ¨¡å—ã€‚éšç€æ¨¡å—æ•°é‡çš„å¢åŠ ï¼Œå¦‚æœå°†å®ƒä»¬è½¬å‚¨åˆ°ä¸€ä¸ªä½ç½®ï¼Œåˆ™å¾ˆéš¾è·Ÿè¸ªæ‰€æœ‰æ¨¡å—ã€‚å¦‚æœå®ƒä»¬å…·æœ‰ç›¸ä¼¼çš„åç§°æˆ–åŠŸèƒ½ï¼Œåˆ™å°¤å…¶å¦‚æ­¤ã€‚</p>
<p>æ‚¨å¯èƒ½å¸Œæœ›æœ‰ä¸€ç§å¯¹å®ƒä»¬è¿›è¡Œåˆ†ç»„å’Œç»„ç»‡çš„æ–¹æ³•ã€‚</p>
<p>åŒ…å…è®¸ä½¿ç”¨ç‚¹è¡¨ç¤ºæ³•å¯¹æ¨¡å—åç§°ç©ºé—´è¿›è¡Œåˆ†å±‚ç»“æ„ã€‚å°±åƒæ¨¡å—æœ‰åŠ©äºé¿å…å…¨å±€å˜é‡åç§°ä¹‹é—´çš„å†²çªä¸€æ ·ï¼ŒåŒ…ä¹Ÿæœ‰åŠ©äºé¿å…æ¨¡å—åç§°ä¹‹é—´çš„å†²çªã€‚</p>
<p>åˆ›å»ºåŒ…éå¸¸ç®€å•ï¼Œå› ä¸ºå®ƒåˆ©ç”¨äº†æ“ä½œç³»ç»Ÿå›ºæœ‰çš„åˆ†å±‚æ–‡ä»¶ç»“æ„ã€‚è€ƒè™‘ä»¥ä¸‹å®‰æ’ï¼š</p>
<p><img loading="lazy" src="https://files.realpython.com/media/pkg1.9af1c7aea48f.png" alt="Image of a Python package"  />
</p>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªåä¸º <code>pkg</code> çš„ç›®å½•ï¼Œå…¶ä¸­åŒ…å«ä¸¤ä¸ªæ¨¡å—ï¼š <code>mod1.py</code> å’Œ <code>mod2.py</code> ã€‚æ¨¡å—çš„å†…å®¹æ˜¯ï¼š</p>
<p><em>mod1.py</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[mod1] foo()&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span></code></pre></div><p><em>mod2.py</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">bar</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[mod2] bar()&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Bar</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span></code></pre></div><p>ç»™å®šæ­¤ç»“æ„ï¼Œå¦‚æœ <code>pkg</code> ç›®å½•ä½äºå¯ä»¥æ‰¾åˆ°å®ƒçš„ä½ç½®ï¼ˆ <code>sys.path</code> ä¸­åŒ…å«çš„ç›®å½•ä¹‹ä¸€ï¼‰ï¼Œåˆ™å¯ä»¥ç”¨ç‚¹ç¬¦å·å¼•ç”¨è¿™ä¸¤ä¸ªæ¨¡å—ï¼ˆ <code>pkg.mod1</code> ã€ <code>pkg.mod2</code> ) å¹¶ä½¿ç”¨æ‚¨å·²ç»ç†Ÿæ‚‰çš„è¯­æ³•å¯¼å…¥å®ƒä»¬ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="o">&lt;</span><span class="n">module_name</span><span class="o">&gt;</span><span class="p">[,</span> <span class="o">&lt;</span><span class="n">module_name</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; import pkg.mod1, pkg.mod2
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; pkg.mod1.foo<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>mod1<span class="o">]</span> foo<span class="o">()</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; <span class="nv">x</span> <span class="o">=</span> pkg.mod2.Bar<span class="o">()</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; x
</span></span><span class="line"><span class="cl">&lt;pkg.mod2.Bar object at 0x033F7290&gt;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="o">&lt;</span><span class="n">module_name</span><span class="o">&gt;</span> <span class="kn">import</span> <span class="o">&lt;</span><span class="n">name</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">&gt;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; from pkg.mod1 import foo
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; foo<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>mod1<span class="o">]</span> foo<span class="o">()</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="o">&lt;</span><span class="n">module_name</span><span class="o">&gt;</span> <span class="kn">import</span> <span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span> <span class="k">as</span> <span class="o">&lt;</span><span class="n">alt_name</span><span class="o">&gt;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; from pkg.mod2 import Bar as Qux
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; <span class="nv">x</span> <span class="o">=</span> Qux<span class="o">()</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; x
</span></span><span class="line"><span class="cl">&lt;pkg.mod2.Bar object at 0x036DFFD0&gt;
</span></span></code></pre></div><p>æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™äº›è¯­å¥å¯¼å…¥æ¨¡å—ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="o">&lt;</span><span class="n">package_name</span><span class="o">&gt;</span> <span class="kn">import</span> <span class="o">&lt;</span><span class="n">modules_name</span><span class="o">&gt;</span><span class="p">[,</span> <span class="o">&lt;</span><span class="n">module_name</span><span class="o">&gt;</span> <span class="o">...</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="o">&lt;</span><span class="n">package_name</span><span class="o">&gt;</span> <span class="kn">import</span> <span class="o">&lt;</span><span class="n">module_name</span><span class="o">&gt;</span> <span class="k">as</span> <span class="o">&lt;</span><span class="n">alt_name</span><span class="o">&gt;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; from pkg import mod1
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; mod1.foo<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>mod1<span class="o">]</span> foo<span class="o">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; from pkg import mod2 as quux
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; quux.bar<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>mod2<span class="o">]</span> bar<span class="o">()</span>
</span></span></code></pre></div><p>ä»æŠ€æœ¯ä¸Šè®²ï¼Œæ‚¨ä¹Ÿå¯ä»¥å¯¼å…¥è¯¥åŒ…ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; import pkg
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; pkg
</span></span><span class="line"><span class="cl">&lt;module <span class="s1">&#39;pkg&#39;</span> <span class="o">(</span>namespace<span class="o">)</span>&gt;
</span></span></code></pre></div><p>ä½†è¿™æ”¶æ•ˆç”šå¾®ã€‚è™½ç„¶ä¸¥æ ¼æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªè¯­æ³•æ­£ç¡®çš„ Python è¯­å¥ï¼Œä½†å®ƒå¹¶æ²¡æœ‰åšä»»ä½•æœ‰ç”¨çš„äº‹æƒ…ã€‚ç‰¹åˆ«æ˜¯ï¼Œå®ƒä¸ä¼šå°† <code>pkg</code> ä¸­çš„ä»»ä½•æ¨¡å—æ”¾å…¥æœ¬åœ°å‘½åç©ºé—´ä¸­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; pkg.mod1
</span></span><span class="line"><span class="cl">Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span></span><span class="line"><span class="cl">  File <span class="s2">&#34;&lt;pyshell#34&gt;&#34;</span>, line 1, in &lt;module&gt;
</span></span><span class="line"><span class="cl">    pkg.mod1
</span></span><span class="line"><span class="cl">AttributeError: module <span class="s1">&#39;pkg&#39;</span> has no attribute <span class="s1">&#39;mod1&#39;</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; pkg.mod1.foo<span class="o">()</span>
</span></span><span class="line"><span class="cl">Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span></span><span class="line"><span class="cl">  File <span class="s2">&#34;&lt;pyshell#35&gt;&#34;</span>, line 1, in &lt;module&gt;
</span></span><span class="line"><span class="cl">    pkg.mod1.foo<span class="o">()</span>
</span></span><span class="line"><span class="cl">AttributeError: module <span class="s1">&#39;pkg&#39;</span> has no attribute <span class="s1">&#39;mod1&#39;</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; pkg.mod2.Bar<span class="o">()</span>
</span></span><span class="line"><span class="cl">Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span></span><span class="line"><span class="cl">  File <span class="s2">&#34;&lt;pyshell#36&gt;&#34;</span>, line 1, in &lt;module&gt;
</span></span><span class="line"><span class="cl">    pkg.mod2.Bar<span class="o">()</span>
</span></span><span class="line"><span class="cl">AttributeError: module <span class="s1">&#39;pkg&#39;</span> has no attribute <span class="s1">&#39;mod2&#39;</span>
</span></span></code></pre></div><p>è¦å®é™…å¯¼å…¥æ¨¡å—æˆ–å…¶å†…å®¹ï¼Œæ‚¨éœ€è¦ä½¿ç”¨ä¸Šé¢æ˜¾ç¤ºçš„è¡¨å•ä¹‹ä¸€ã€‚</p>
<h2 id="åŒ…åˆå§‹åŒ–">åŒ…åˆå§‹åŒ–</h2>
<p>å¦‚æœåŒ…ç›®å½•ä¸­å­˜åœ¨åä¸º <code>__init__.py</code> çš„æ–‡ä»¶ï¼Œåˆ™åœ¨å¯¼å…¥åŒ…æˆ–åŒ…ä¸­çš„æ¨¡å—æ—¶ä¼šè°ƒç”¨è¯¥æ–‡ä»¶ã€‚è¿™å¯ç”¨äºæ‰§è¡ŒåŒ…åˆå§‹åŒ–ä»£ç ï¼Œä¾‹å¦‚åŒ…çº§æ•°æ®çš„åˆå§‹åŒ–ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè€ƒè™‘ä»¥ä¸‹ <code>__init__.py</code> æ–‡ä»¶ï¼š</p>
<p><em><strong><strong>init</strong>.py</strong></em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Invoking __init__.py for </span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">A</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;quux&#39;</span><span class="p">,</span> <span class="s1">&#39;corge&#39;</span><span class="p">,</span> <span class="s1">&#39;grault&#39;</span><span class="p">]</span>
</span></span></code></pre></div><p>æˆ‘ä»¬å°†æ­¤æ–‡ä»¶æ·»åŠ åˆ°ä¸Šé¢ç¤ºä¾‹ä¸­çš„ <code>pkg</code> ç›®å½•ä¸­ï¼š</p>
<p><img loading="lazy" src="https://files.realpython.com/media/pkg2.dab97c2f9c58.png" alt="Illustration of hierarchical file structure of Python packages"  />
</p>
<p>ç°åœ¨ï¼Œå½“å¯¼å…¥åŒ…æ—¶ï¼Œå…¨å±€åˆ—è¡¨ <code>A</code> è¢«åˆå§‹åŒ–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; import pkg
</span></span><span class="line"><span class="cl">Invoking __init__.py <span class="k">for</span> pkg
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; pkg.A
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="s1">&#39;quux&#39;</span>, <span class="s1">&#39;corge&#39;</span>, <span class="s1">&#39;grault&#39;</span><span class="o">]</span>
</span></span></code></pre></div><p>åŒ…ä¸­çš„æ¨¡å—å¯ä»¥é€šè¿‡ä¾æ¬¡å¯¼å…¥æ¥è®¿é—®å…¨å±€å˜é‡ï¼š</p>
<p><em>mod1.py</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="kn">from</span> <span class="nn">pkg</span> <span class="kn">import</span> <span class="n">A</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[mod1] foo() / A = &#39;</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; from pkg import mod1
</span></span><span class="line"><span class="cl">Invoking __init__.py <span class="k">for</span> pkg
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; mod1.foo<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>mod1<span class="o">]</span> foo<span class="o">()</span> / <span class="nv">A</span> <span class="o">=</span>  <span class="o">[</span><span class="s1">&#39;quux&#39;</span>, <span class="s1">&#39;corge&#39;</span>, <span class="s1">&#39;grault&#39;</span><span class="o">]</span>
</span></span></code></pre></div><p><code>__init__.py</code> è¿˜å¯ä»¥ç”¨äºå®ç°ä»åŒ…ä¸­è‡ªåŠ¨å¯¼å…¥æ¨¡å—ã€‚ä¾‹å¦‚ï¼Œä¹‹å‰æ‚¨çœ‹åˆ°è¯­å¥ <code>import pkg</code> ä»…å°†åç§° <code>pkg</code> æ”¾å…¥è°ƒç”¨è€…çš„æœ¬åœ°ç¬¦å·è¡¨ä¸­ï¼Œå¹¶ä¸”ä¸å¯¼å…¥ä»»ä½•æ¨¡å—ã€‚ä½†å¦‚æœ <code>pkg</code> ç›®å½•ä¸­çš„ <code>__init__.py</code> åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p>
<p><em><strong><strong>init</strong>.py</strong></em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Invoking __init__.py for </span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pkg.mod1</span><span class="o">,</span> <span class="nn">pkg.mod2</span>
</span></span></code></pre></div><p>ç„¶åå½“æ‚¨æ‰§è¡Œ <code>import pkg</code> æ—¶ï¼Œä¼šè‡ªåŠ¨å¯¼å…¥æ¨¡å— <code>mod1</code> å’Œ <code>mod2</code> ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; import pkg
</span></span><span class="line"><span class="cl">Invoking __init__.py <span class="k">for</span> pkg
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; pkg.mod1.foo<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>mod1<span class="o">]</span> foo<span class="o">()</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; pkg.mod2.bar<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>mod2<span class="o">]</span> bar<span class="o">()</span>
</span></span></code></pre></div><blockquote>
<p>æ³¨æ„ï¼šè®¸å¤š Python æ–‡æ¡£éƒ½æŒ‡å‡ºï¼Œåˆ›å»ºåŒ…æ—¶ï¼ŒåŒ…ç›®å½•ä¸­å¿…é¡»å­˜åœ¨ <code>__init__.py</code> æ–‡ä»¶ã€‚è¿™æ›¾ç»æ˜¯çœŸçš„ã€‚è¿‡å»ï¼Œ <code>__init__.py</code> çš„å­˜åœ¨å¯¹äº Python æ¥è¯´å°±æ„å‘³ç€æ­£åœ¨å®šä¹‰ä¸€ä¸ªåŒ…ã€‚è¯¥æ–‡ä»¶å¯ä»¥åŒ…å«åˆå§‹åŒ–ä»£ç ï¼Œç”šè‡³å¯ä»¥ä¸ºç©ºï¼Œä½†å®ƒå¿…é¡»å­˜åœ¨ã€‚</p>
<p>ä» Python 3.3 å¼€å§‹ï¼Œ<a href="https://www.python.org/dev/peps/pep-0420">å¼•å…¥äº†éšå¼å‘½åç©ºé—´åŒ…</a>ã€‚è¿™äº›å…è®¸åˆ›å»ºæ²¡æœ‰ä»»ä½• <code>__init__.py</code> æ–‡ä»¶çš„åŒ…ã€‚å½“ç„¶ï¼Œå¦‚æœéœ€è¦åŒ…åˆå§‹åŒ–ï¼Œå®ƒä»ç„¶å¯ä»¥å­˜åœ¨ã€‚ä½†ä¸å†éœ€è¦äº†ã€‚æŸ¥çœ‹<a href="https://realpython.com/python-namespace-package/">ä»€ä¹ˆæ˜¯ Python å‘½åç©ºé—´åŒ…ï¼Œå®ƒæœ‰ä»€ä¹ˆç”¨ï¼Ÿ</a>äº†è§£æ›´å¤šã€‚</p>
</blockquote>
<h2 id="ä»åŒ…ä¸­å¯¼å…¥-">ä»åŒ…ä¸­å¯¼å…¥ <code>*</code></h2>
<p>ä¸ºäº†ä»¥ä¸‹è®¨è®ºçš„ç›®çš„ï¼Œå…ˆå‰å®šä¹‰çš„åŒ…è¢«æ‰©å±•ä»¥åŒ…å«ä¸€äº›é™„åŠ æ¨¡å—ï¼š</p>
<p><img loading="lazy" src="https://files.realpython.com/media/pkg3.d2160908ae77.png" alt="Illustration of hierarchical file structure of Python packages"  />
</p>
<p>ç°åœ¨ <code>pkg</code> ç›®å½•ä¸­å®šä¹‰äº†å››ä¸ªæ¨¡å—ã€‚å®ƒä»¬çš„å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><em><strong>mod1.py</strong></em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[mod1] foo()&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span></code></pre></div><p><em><strong>mod2.py</strong></em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">bar</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[mod2] bar()&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Bar</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span></code></pre></div><p><em><strong>mod3.py</strong></em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">baz</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[mod3] baz()&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Baz</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span></code></pre></div><p><em><strong>mod4.py</strong></em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">qux</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[mod4] qux()&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Qux</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span></code></pre></div><p>é‚£æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; dir<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="s1">&#39;__annotations__&#39;</span>, <span class="s1">&#39;__builtins__&#39;</span>, <span class="s1">&#39;__doc__&#39;</span>, <span class="s1">&#39;__loader__&#39;</span>, <span class="s1">&#39;__name__&#39;</span>,
</span></span><span class="line"><span class="cl"><span class="s1">&#39;__package__&#39;</span>, <span class="s1">&#39;__spec__&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; from pkg import *
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; dir<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="s1">&#39;__annotations__&#39;</span>, <span class="s1">&#39;__builtins__&#39;</span>, <span class="s1">&#39;__doc__&#39;</span>, <span class="s1">&#39;__loader__&#39;</span>, <span class="s1">&#39;__name__&#39;</span>,
</span></span><span class="line"><span class="cl"><span class="s1">&#39;__package__&#39;</span>, <span class="s1">&#39;__spec__&#39;</span><span class="o">]</span>
</span></span></code></pre></div><p>å“¼ã€‚ä¸å¤šã€‚æ‚¨å¯èƒ½æœŸæœ›ï¼ˆå‡è®¾æ‚¨æœ‰ä»»ä½•æœŸæœ›ï¼‰Python ä¼šæ·±å…¥åˆ°åŒ…ç›®å½•ä¸­ï¼Œæ‰¾åˆ°å®ƒèƒ½æ‰¾åˆ°çš„æ‰€æœ‰æ¨¡å—ï¼Œå¹¶å°†å®ƒä»¬å…¨éƒ¨å¯¼å…¥ã€‚ä½†æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚</p>
<p>ç›¸åï¼ŒPython éµå¾ªæ­¤çº¦å®šï¼šå¦‚æœåŒ…ç›®å½•ä¸­çš„ <code>__init__.py</code> æ–‡ä»¶åŒ…å«åä¸º <code>__all__</code> çš„åˆ—è¡¨ï¼Œåˆ™åœ¨é‡åˆ°è¯­å¥ <code>from &lt;package_name&gt; import *</code> æ—¶ï¼Œå®ƒè¢«è§†ä¸ºåº”å¯¼å…¥çš„æ¨¡å—åˆ—è¡¨ã€‚</p>
<p>å¯¹äºæœ¬ç¤ºä¾‹ï¼Œå‡è®¾æ‚¨åœ¨ <code>pkg</code> ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª <code>__init__.py</code> ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><em><strong>pkg/<strong>init</strong>.py</strong></em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;mod1&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;mod2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;mod3&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;mod4&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span></code></pre></div><p>ç°åœ¨ <code>from pkg import *</code> å¯¼å…¥æ‰€æœ‰å››ä¸ªæ¨¡å—ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; dir<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="s1">&#39;__annotations__&#39;</span>, <span class="s1">&#39;__builtins__&#39;</span>, <span class="s1">&#39;__doc__&#39;</span>, <span class="s1">&#39;__loader__&#39;</span>, <span class="s1">&#39;__name__&#39;</span>,
</span></span><span class="line"><span class="cl"><span class="s1">&#39;__package__&#39;</span>, <span class="s1">&#39;__spec__&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; from pkg import *
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; dir<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="s1">&#39;__annotations__&#39;</span>, <span class="s1">&#39;__builtins__&#39;</span>, <span class="s1">&#39;__doc__&#39;</span>, <span class="s1">&#39;__loader__&#39;</span>, <span class="s1">&#39;__name__&#39;</span>,
</span></span><span class="line"><span class="cl"><span class="s1">&#39;__package__&#39;</span>, <span class="s1">&#39;__spec__&#39;</span>, <span class="s1">&#39;mod1&#39;</span>, <span class="s1">&#39;mod2&#39;</span>, <span class="s1">&#39;mod3&#39;</span>, <span class="s1">&#39;mod4&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; mod2.bar<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>mod2<span class="o">]</span> bar<span class="o">()</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; mod4.Qux
</span></span><span class="line"><span class="cl">&lt;class <span class="s1">&#39;pkg.mod4.Qux&#39;</span>&gt;
</span></span></code></pre></div><p>ä½¿ç”¨ <code>import *</code> ä»ç„¶ä¸è¢«è®¤ä¸ºæ˜¯ä¸€ç§å¾ˆå¥½çš„å½¢å¼ï¼Œå¯¹äºåŒ…æ¥è¯´æ¯”å¯¹äºæ¨¡å—æ¥è¯´æ›´æ˜¯å¦‚æ­¤ã€‚ä½†æ­¤åŠŸèƒ½è‡³å°‘ä½¿åŒ…çš„åˆ›å»ºè€…å¯ä»¥å¯¹æŒ‡å®š <code>import *</code> æ—¶å‘ç”Ÿçš„æƒ…å†µè¿›è¡Œä¸€äº›æ§åˆ¶ã€‚ ï¼ˆäº‹å®ä¸Šï¼Œå®ƒæä¾›äº†å®Œå…¨ç¦æ­¢å®ƒçš„åŠŸèƒ½ï¼Œåªéœ€å®Œå…¨æ‹’ç»å®šä¹‰ <code>__all__</code> å³å¯ã€‚æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼ŒåŒ…çš„é»˜è®¤è¡Œä¸ºæ˜¯ä¸å¯¼å…¥ä»»ä½•å†…å®¹ã€‚ï¼‰</p>
<p>é¡ºä¾¿è¯´ä¸€å¥ï¼Œ <code>__all__</code> ä¹Ÿå¯ä»¥åœ¨æ¨¡å—ä¸­å®šä¹‰ï¼Œå¹¶å…·æœ‰ç›¸åŒçš„ç›®çš„ï¼šæ§åˆ¶ä½¿ç”¨ <code>import *</code> å¯¼å…¥çš„å†…å®¹ã€‚ä¾‹å¦‚ï¼Œä¿®æ”¹ <code>mod1.py</code> å¦‚ä¸‹ï¼š</p>
<p><em><strong>pkg/mod1.py</strong></em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[mod1] foo()&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span></code></pre></div><p>ç°åœ¨ï¼Œæ¥è‡ª <code>pkg.mod1</code> çš„ <code>import *</code> è¯­å¥å°†ä»…å¯¼å…¥ <code>__all__</code> ä¸­åŒ…å«çš„å†…å®¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; dir<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="s1">&#39;__annotations__&#39;</span>, <span class="s1">&#39;__builtins__&#39;</span>, <span class="s1">&#39;__doc__&#39;</span>, <span class="s1">&#39;__loader__&#39;</span>, <span class="s1">&#39;__name__&#39;</span>,
</span></span><span class="line"><span class="cl"><span class="s1">&#39;__package__&#39;</span>, <span class="s1">&#39;__spec__&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; from pkg.mod1 import *
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; dir<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span><span class="s1">&#39;__annotations__&#39;</span>, <span class="s1">&#39;__builtins__&#39;</span>, <span class="s1">&#39;__doc__&#39;</span>, <span class="s1">&#39;__loader__&#39;</span>, <span class="s1">&#39;__name__&#39;</span>,
</span></span><span class="line"><span class="cl"><span class="s1">&#39;__package__&#39;</span>, <span class="s1">&#39;__spec__&#39;</span>, <span class="s1">&#39;foo&#39;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; foo<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>mod1<span class="o">]</span> foo<span class="o">()</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; Foo
</span></span><span class="line"><span class="cl">Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
</span></span><span class="line"><span class="cl">  File <span class="s2">&#34;&lt;pyshell#37&gt;&#34;</span>, line 1, in &lt;module&gt;
</span></span><span class="line"><span class="cl">    Foo
</span></span><span class="line"><span class="cl">NameError: name <span class="s1">&#39;Foo&#39;</span> is not defined
</span></span></code></pre></div><p><code>foo()</code> ï¼ˆå‡½æ•°ï¼‰ç°åœ¨å®šä¹‰åœ¨æœ¬åœ°å‘½åç©ºé—´ä¸­ï¼Œä½† <code>Foo</code> ï¼ˆç±»ï¼‰ä¸æ˜¯ï¼Œå› ä¸ºåè€…ä¸åœ¨ <code>__all__</code> ä¸­ã€‚</p>
<p>æ€»ä¹‹ï¼ŒåŒ…å’Œæ¨¡å—éƒ½ä½¿ç”¨ <code>__all__</code> æ¥æ§åˆ¶æŒ‡å®š <code>import *</code> æ—¶å¯¼å…¥çš„å†…å®¹ã€‚ä½†é»˜è®¤è¡Œä¸ºæœ‰æ‰€ä¸åŒï¼š</p>
<ul>
<li>å¯¹äºåŒ…æ¥è¯´ï¼Œå½“ <code>__all__</code> æœªå®šä¹‰æ—¶ï¼Œ <code>import *</code> ä¸ä¼šå¯¼å…¥ä»»ä½•å†…å®¹ã€‚</li>
<li>å¯¹äºæ¨¡å—ï¼Œå½“æœªå®šä¹‰ <code>__all__</code> æ—¶ï¼Œ <code>import *</code> ä¼šå¯¼å…¥æ‰€æœ‰å†…å®¹ï¼ˆé™¤äº†â€”â€”ä½ çŒœå¯¹äº†â€”â€”ä»¥ä¸‹åˆ’çº¿å¼€å¤´çš„åç§°ï¼‰ã€‚</li>
</ul>
<h2 id="å­åŒ…">å­åŒ…</h2>
<p>åŒ…å¯ä»¥åŒ…å«ä»»æ„æ·±åº¦çš„åµŒå¥—å­åŒ…ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯¹ç¤ºä¾‹åŒ…ç›®å½•å†åšä¸€ä¸ªä¿®æ”¹ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img loading="lazy" src="https://files.realpython.com/media/pkg4.a830d6e144bf.png" alt="Illustration of hierarchical file structure of Python packages"  />
</p>
<p>å››ä¸ªæ¨¡å—ï¼ˆ <code>mod1.py</code> ã€ <code>mod2.py</code> ã€ <code>mod3.py</code> å’Œ <code>mod4.py</code> ï¼‰çš„å®šä¹‰å¦‚å‰ã€‚ä½†ç°åœ¨ï¼Œå®ƒä»¬ä¸å†è¢«é›†ä¸­åˆ° <code>pkg</code> ç›®å½•ä¸­ï¼Œè€Œæ˜¯åˆ†æˆä¸¤ä¸ªå­åŒ…ç›®å½•ï¼š <code>sub_pkg1</code> å’Œ <code>sub_pkg2</code> ã€‚</p>
<p>å¯¼å…¥ä»ç„¶ä¸ä¹‹å‰æ‰€ç¤ºçš„ä¸€æ ·ã€‚è¯­æ³•ç±»ä¼¼ï¼Œä½†ä½¿ç”¨é¢å¤–çš„ç‚¹ç¬¦å·å°†åŒ…åç§°ä¸å­åŒ…åç§°åˆ†å¼€ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; import pkg.sub_pkg1.mod1
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; pkg.sub_pkg1.mod1.foo<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>mod1<span class="o">]</span> foo<span class="o">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; from pkg.sub_pkg1 import mod2
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; mod2.bar<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>mod2<span class="o">]</span> bar<span class="o">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; from pkg.sub_pkg2.mod3 import baz
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; baz<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>mod3<span class="o">]</span> baz<span class="o">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; from pkg.sub_pkg2.mod4 import qux as grault
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; grault<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>mod4<span class="o">]</span> qux<span class="o">()</span>
</span></span></code></pre></div><p>æ­¤å¤–ï¼Œä¸€ä¸ªå­åŒ…ä¸­çš„æ¨¡å—å¯ä»¥å¼•ç”¨åŒçº§å­åŒ…ä¸­çš„å¯¹è±¡ï¼ˆå¦‚æœåŒçº§å­åŒ…åŒ…å«æ‚¨éœ€è¦çš„æŸäº›åŠŸèƒ½ï¼‰ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æ‚¨æƒ³ä»æ¨¡å— <code>mod3</code> ä¸­å¯¼å…¥å¹¶æ‰§è¡Œå‡½æ•° <code>foo()</code> ï¼ˆåœ¨æ¨¡å— <code>mod1</code> ä¸­å®šä¹‰ï¼‰ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ç»å¯¹å¯¼å…¥ï¼š</p>
<p><em><strong>pkg/sub__pkg2/mod3.py</strong></em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">baz</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[mod3] baz()&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Baz</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pkg.sub_pkg1.mod1</span> <span class="kn">import</span> <span class="n">foo</span>
</span></span><span class="line"><span class="cl"><span class="n">foo</span><span class="p">()</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">&gt;&gt;&gt; from pkg.sub_pkg2 import mod3
</span></span><span class="line"><span class="cl"><span class="o">[</span>mod1<span class="o">]</span> foo<span class="o">()</span>
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; mod3.foo<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>mod1<span class="o">]</span> foo<span class="o">()</span>
</span></span></code></pre></div><p>æˆ–è€…æ‚¨å¯ä»¥ä½¿ç”¨ç›¸å¯¹å¯¼å…¥ï¼Œå…¶ä¸­ <code>..</code> æŒ‡çš„æ˜¯ä¸Šä¸€çº§çš„åŒ…ã€‚ä»å­åŒ… <code>sub_pkg2</code> ä¸­çš„ <code>mod3.py</code> ä¸­ï¼Œ</p>
<ul>
<li>
<p><code>..</code> è®¡ç®—çˆ¶åŒ… ( <code>pkg</code> )ï¼Œå¹¶ä¸”</p>
</li>
<li>
<p><code>..sub_pkg1</code> è®¡ç®—ä¸ºçˆ¶åŒ…çš„å­åŒ… <code>sub_pkg1</code> ã€‚</p>
</li>
</ul>
<p><em><strong>pkg/sub__pkg2/mod3.py</strong></em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">baz</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[mod3] baz()&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Baz</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">sub_pkg1</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">sub_pkg1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">..sub_pkg1.mod1</span> <span class="kn">import</span> <span class="n">foo</span>
</span></span><span class="line"><span class="cl"><span class="n">foo</span><span class="p">()</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">pkg.sub_pkg2</span> <span class="kn">import</span> <span class="n">mod3</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">module</span> <span class="s1">&#39;pkg.sub_pkg1&#39;</span> <span class="p">(</span><span class="n">namespace</span><span class="p">)</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="n">mod1</span><span class="p">]</span> <span class="n">foo</span><span class="p">()</span>
</span></span></code></pre></div><h2 id="ç»“è®º">ç»“è®º</h2>
<p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨æ¶µç›–äº†ä»¥ä¸‹ä¸»é¢˜ï¼š</p>
<ul>
<li>
<p>å¦‚ä½•åˆ›å»º Python æ¨¡å—</p>
</li>
<li>
<p>Python è§£é‡Šå™¨æœç´¢æ¨¡å—çš„ä½ç½®</p>
</li>
<li>
<p>å¦‚ä½•ä½¿ç”¨ <code>import</code> è¯­å¥è·å–å¯¹æ¨¡å—ä¸­å®šä¹‰çš„å¯¹è±¡çš„è®¿é—®æƒé™</p>
</li>
<li>
<p>å¦‚ä½•åˆ›å»ºå¯ä½œä¸ºç‹¬ç«‹è„šæœ¬æ‰§è¡Œçš„æ¨¡å—</p>
</li>
<li>
<p>å¦‚ä½•å°†æ¨¡å—ç»„ç»‡æˆåŒ…å’Œå­åŒ…</p>
</li>
<li>
<p>å¦‚ä½•æ§åˆ¶åŒ…åˆå§‹åŒ–</p>
</li>
</ul>
<p>è¿™æœ‰æœ›è®©æ‚¨æ›´å¥½åœ°äº†è§£å¦‚ä½•è®¿é—® Python ä¸­å¯ç”¨çš„è®¸å¤šç¬¬ä¸‰æ–¹å’Œå†…ç½®æ¨¡å—ä¸­å¯ç”¨çš„åŠŸèƒ½ã€‚</p>
<p>æ­¤å¤–ï¼Œå¦‚æœæ‚¨æ­£åœ¨å¼€å‘è‡ªå·±çš„åº”ç”¨ç¨‹åºï¼Œåˆ›å»ºè‡ªå·±çš„æ¨¡å—å’ŒåŒ…å°†å¸®åŠ©æ‚¨ç»„ç»‡å’Œæ¨¡å—åŒ–ä»£ç ï¼Œä»è€Œä½¿ç¼–ç ã€ç»´æŠ¤å’Œè°ƒè¯•æ›´åŠ å®¹æ˜“ã€‚</p>
<p>å¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ Python.org ä¸Šçš„ä»¥ä¸‹æ–‡æ¡£ï¼š</p>
<ul>
<li><a href="https://docs.python.org/3/reference/import.html">The import system</a></li>
<li><a href="https://docs.python.org/3/tutorial/modules.html">The Python tutorial: Modules</a></li>
</ul>
<p>å¿«ä¹çš„Pythonï¼</p>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://realpython.com/python-modules-packages">https://realpython.com/python-modules-packages</a></p>
]]></content:encoded>
    </item>
    
    <item>
      <title>Pythonå­¦ä¹ 5ï¼šå‡½æ•°</title>
      <link>https://blog.chensoul.com/posts/2023/06/25/python-function/</link>
      <pubDate>Sun, 25 Jun 2023 10:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/06/25/python-function/</guid>
      <description>å‡½æ•°çš„å®šä¹‰ åœ¨ Python ä¸­ï¼Œå‡½æ•°æ˜¯ä¸€æ®µå¯é‡å¤ä½¿ç”¨çš„ä»£ç å—ï¼Œå®ƒæ¥å—ä¸€äº›è¾“å…¥ï¼ˆä¹Ÿç§°ä¸ºå‚æ•°ï¼‰å¹¶äº§ç”Ÿä¸€äº›è¾“å‡ºã€‚å‡½æ•°å¯ä»¥é€šè¿‡ def å…³é”®å­—æ¥å®šä¹‰ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š def function_name(parameters): &amp;#34;&amp;#34;&amp;#34;This is a</description>
      <content:encoded><![CDATA[<h2 id="å‡½æ•°çš„å®šä¹‰">å‡½æ•°çš„å®šä¹‰</h2>
<p>åœ¨ Python ä¸­ï¼Œå‡½æ•°æ˜¯ä¸€æ®µå¯é‡å¤ä½¿ç”¨çš„ä»£ç å—ï¼Œå®ƒæ¥å—ä¸€äº›è¾“å…¥ï¼ˆä¹Ÿç§°ä¸ºå‚æ•°ï¼‰å¹¶äº§ç”Ÿä¸€äº›è¾“å‡ºã€‚å‡½æ•°å¯ä»¥é€šè¿‡ <code>def</code> å…³é”®å­—æ¥å®šä¹‰ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">function_name</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  	<span class="s2">&#34;&#34;&#34;This is a function&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># function body</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">value</span>
</span></span></code></pre></div><p>å…¶ä¸­ï¼Œ<code>function_name</code> æ˜¯å‡½æ•°çš„åç§°ï¼Œ<code>parameters</code> æ˜¯å‡½æ•°çš„å‚æ•°åˆ—è¡¨ï¼Œ<code>function body</code> æ˜¯å‡½æ•°çš„ä¸»ä½“éƒ¨åˆ†ï¼ŒåŒ…æ‹¬éœ€è¦æ‰§è¡Œçš„ä»£ç å’Œå¯èƒ½çš„è¿”å›è¯­å¥ï¼Œ<code>return value</code> æ˜¯å‡½æ•°çš„è¿”å›å€¼ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚</p>
<p>ä¸‹åˆ—ä»£ç åˆ›å»ºä¸€ä¸ªå¯ä»¥è¾“å‡ºé™å®šæ•°å€¼å†…çš„æ–æ³¢é‚£å¥‘æ•°åˆ—å‡½æ•°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>    <span class="c1"># write Fibonacci series up to n</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Print a Fibonacci series up to n.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">fib</span><span class="p">(</span><span class="mi">2000</span><span class="p">)</span> <span class="c1"># 0 1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 159</span>
</span></span></code></pre></div><p><em>å®šä¹‰</em> å‡½æ•°ä½¿ç”¨å…³é”®å­— <code>def</code>ï¼Œåè·Ÿå‡½æ•°åä¸æ‹¬å·å†…çš„å½¢å‚åˆ—è¡¨ã€‚å‡½æ•°è¯­å¥ä»ä¸‹ä¸€è¡Œå¼€å§‹ï¼Œå¹¶ä¸”å¿…é¡»ç¼©è¿›ã€‚</p>
<p>å‡½æ•°å†…çš„ç¬¬ä¸€æ¡è¯­å¥æ˜¯å­—ç¬¦ä¸²æ—¶ï¼Œè¯¥å­—ç¬¦ä¸²å°±æ˜¯æ–‡æ¡£å­—ç¬¦ä¸²ï¼Œä¹Ÿç§°ä¸º <em>docstring</em>ã€‚åˆ©ç”¨æ–‡æ¡£å­—ç¬¦ä¸²å¯ä»¥è‡ªåŠ¨ç”Ÿæˆåœ¨çº¿æ–‡æ¡£æˆ–æ‰“å°ç‰ˆæ–‡æ¡£ï¼Œè¿˜å¯ä»¥è®©å¼€å‘è€…åœ¨æµè§ˆä»£ç æ—¶ç›´æ¥æŸ¥é˜…æ–‡æ¡£ï¼›Python å¼€å‘è€…æœ€å¥½å…»æˆåœ¨ä»£ç ä¸­åŠ å…¥æ–‡æ¡£å­—ç¬¦ä¸²çš„å¥½ä¹ æƒ¯ã€‚</p>
<p>å‡½æ•°åœ¨ <em>æ‰§è¡Œ</em> æ—¶ä½¿ç”¨å‡½æ•°å±€éƒ¨å˜é‡ç¬¦å·è¡¨ï¼Œæ‰€æœ‰å‡½æ•°å˜é‡èµ‹å€¼éƒ½å­˜åœ¨å±€éƒ¨ç¬¦å·è¡¨ä¸­ï¼›å¼•ç”¨å˜é‡æ—¶ï¼Œé¦–å…ˆï¼Œåœ¨å±€éƒ¨ç¬¦å·è¡¨é‡ŒæŸ¥æ‰¾å˜é‡ï¼Œç„¶åï¼Œæ˜¯å¤–å±‚å‡½æ•°å±€éƒ¨ç¬¦å·è¡¨ï¼Œå†æ˜¯å…¨å±€ç¬¦å·è¡¨ï¼Œæœ€åæ˜¯å†…ç½®åç§°ç¬¦å·è¡¨ã€‚å› æ­¤ï¼Œå°½ç®¡å¯ä»¥å¼•ç”¨å…¨å±€å˜é‡å’Œå¤–å±‚å‡½æ•°çš„å˜é‡ï¼Œä½†æœ€å¥½ä¸è¦åœ¨å‡½æ•°å†…ç›´æ¥èµ‹å€¼ï¼ˆé™¤éæ˜¯ <code>global</code> è¯­å¥å®šä¹‰çš„å…¨å±€å˜é‡ï¼Œæˆ– <code>nonlocal</code> è¯­å¥å®šä¹‰çš„å¤–å±‚å‡½æ•°å˜é‡ï¼‰ã€‚</p>
<p>åœ¨è°ƒç”¨å‡½æ•°æ—¶ä¼šå°†å®é™…å‚æ•°ï¼ˆå®å‚ï¼‰å¼•å…¥åˆ°è¢«è°ƒç”¨å‡½æ•°çš„å±€éƒ¨ç¬¦å·è¡¨ä¸­ï¼›å› æ­¤ï¼Œå®å‚æ˜¯ä½¿ç”¨ <em>æŒ‰å€¼è°ƒç”¨</em> æ¥ä¼ é€’çš„ï¼ˆå…¶ä¸­çš„ <em>å€¼</em> å§‹ç»ˆæ˜¯å¯¹è±¡çš„ <em>å¼•ç”¨</em> è€Œä¸æ˜¯å¯¹è±¡çš„å€¼ï¼‰ã€‚ <a href="https://docs.python.org/zh-cn/3/tutorial/controlflow.html#id2">1</a> å½“ä¸€ä¸ªå‡½æ•°è°ƒç”¨å¦å¤–ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œä¼šä¸ºè¯¥è°ƒç”¨åˆ›å»ºä¸€ä¸ªæ–°çš„å±€éƒ¨ç¬¦å·è¡¨ã€‚</p>
<p>å‡½æ•°å®šä¹‰åœ¨å½“å‰ç¬¦å·è¡¨ä¸­æŠŠå‡½æ•°åä¸å‡½æ•°å¯¹è±¡å…³è”åœ¨ä¸€èµ·ã€‚è§£é‡Šå™¨æŠŠå‡½æ•°åæŒ‡å‘çš„å¯¹è±¡ä½œä¸ºç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ã€‚è¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–åç§°æŒ‡å‘åŒä¸€ä¸ªå‡½æ•°å¯¹è±¡ï¼Œå¹¶è®¿é—®è®¿è¯¥å‡½æ•°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">fib</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span> <span class="o">=</span> <span class="n">fib</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="c1"># 0 1 1 2 3 5 8 13 21 34 55 89</span>
</span></span></code></pre></div><p><code>fib</code> ä¸è¿”å›å€¼ï¼Œå› æ­¤ï¼Œå…¶ä»–è¯­è¨€ä¸æŠŠå®ƒå½“ä½œå‡½æ•°ï¼Œè€Œæ˜¯å½“ä½œè¿‡ç¨‹ã€‚äº‹å®ä¸Šï¼Œæ²¡æœ‰ <code>return</code> è¯­å¥çš„å‡½æ•°ä¹Ÿè¿”å›å€¼ï¼Œåªä¸è¿‡è¿™ä¸ªå€¼æ¯”è¾ƒæ˜¯ <code>None</code> ï¼ˆæ˜¯ä¸€ä¸ªå†…ç½®åç§°ï¼‰ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè§£é‡Šå™¨ä¸ä¼šè¾“å‡ºå•ç‹¬çš„è¿”å›å€¼ <code>None</code> ï¼Œå¦‚éœ€æŸ¥çœ‹è¯¥å€¼ï¼Œå¯ä»¥ä½¿ç”¨ <code>print()</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">fib</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">fib</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span></span></code></pre></div><h2 id="å‡½æ•°å‚æ•°">å‡½æ•°å‚æ•°</h2>
<h3 id="é»˜è®¤å€¼å‚æ•°">é»˜è®¤å€¼å‚æ•°</h3>
<p>åœ¨ Python ä¸­ï¼Œå‡½æ•°å‚æ•°å¯ä»¥å…·æœ‰é»˜è®¤å€¼ï¼Œè¿™æ„å‘³ç€å¦‚æœåœ¨å‡½æ•°è°ƒç”¨æœŸé—´æœªæä¾›è¯¥å‚æ•°çš„å€¼ï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼ã€‚å®šä¹‰å…·æœ‰é»˜è®¤å€¼çš„å‡½æ•°å‚æ•°çš„è¯­æ³•å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">function_name</span><span class="p">(</span><span class="n">param1</span><span class="p">,</span> <span class="n">param2</span><span class="o">=</span><span class="n">default_value</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># function body</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">value</span>
</span></span></code></pre></div><p>å…¶ä¸­ï¼Œparam1 æ˜¯å¿…éœ€çš„å‚æ•°ï¼Œå®ƒæ²¡æœ‰é»˜è®¤å€¼ï¼›param2 æ˜¯å¯é€‰å‚æ•°ï¼Œå¦‚æœæœªæä¾›ï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼ default_valueã€‚å¦‚æœè°ƒç”¨å‡½æ•°æ—¶æä¾›äº† param2 çš„å€¼ï¼Œåˆ™ä½¿ç”¨æä¾›çš„å€¼è¦†ç›–é»˜è®¤å€¼ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨é»˜è®¤å‚æ•°å€¼çš„ Python å‡½æ•°ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">greet</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">greeting</span><span class="o">=</span><span class="s2">&#34;Hello&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">greeting</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">greet</span><span class="p">(</span><span class="s2">&#34;Alice&#34;</span><span class="p">)</span>  <span class="c1"># output: Hello, Alice!</span>
</span></span><span class="line"><span class="cl"><span class="n">greet</span><span class="p">(</span><span class="s2">&#34;Bob&#34;</span><span class="p">,</span> <span class="s2">&#34;Hi&#34;</span><span class="p">)</span>  <span class="c1"># output: Hi, Bob!</span>
</span></span></code></pre></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“å‡½æ•°å‚æ•°å…·æœ‰é»˜è®¤å€¼æ—¶ï¼Œåº”è¯¥å°†å…·æœ‰é»˜è®¤å€¼çš„å‚æ•°æ”¾åœ¨å‚æ•°åˆ—è¡¨çš„æœ«å°¾ã€‚è¿™æ ·å¯ä»¥ä½¿å‡½æ•°æ›´åŠ æ˜“äºä½¿ç”¨ï¼Œå¹¶é¿å…åœ¨è°ƒç”¨å‡½æ•°æ—¶å‡ºç°æ··æ·†ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå…·æœ‰å¤šä¸ªé»˜è®¤å‚æ•°å€¼çš„ Python å‡½æ•°çš„ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">gender</span><span class="o">=</span><span class="s2">&#34;male&#34;</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">user</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&#34;age&#34;</span><span class="p">:</span> <span class="n">age</span><span class="p">,</span> <span class="s2">&#34;gender&#34;</span><span class="p">:</span> <span class="n">gender</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">email</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">user</span><span class="p">[</span><span class="s2">&#34;email&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">email</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">user</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">user1</span> <span class="o">=</span> <span class="n">create_user</span><span class="p">(</span><span class="s2">&#34;Alice&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">user2</span> <span class="o">=</span> <span class="n">create_user</span><span class="p">(</span><span class="s2">&#34;Bob&#34;</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">user3</span> <span class="o">=</span> <span class="n">create_user</span><span class="p">(</span><span class="s2">&#34;Charlie&#34;</span><span class="p">,</span> <span class="n">gender</span><span class="o">=</span><span class="s2">&#34;female&#34;</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="s2">&#34;charlie@example.com&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">user1</span><span class="p">)</span>  <span class="c1"># output: {&#39;name&#39;: &#39;Alice&#39;, &#39;age&#39;: 18, &#39;gender&#39;: &#39;male&#39;}</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">user2</span><span class="p">)</span>  <span class="c1"># output: {&#39;name&#39;: &#39;Bob&#39;, &#39;age&#39;: 20, &#39;gender&#39;: &#39;male&#39;}</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">user3</span><span class="p">)</span>  <span class="c1"># output: {&#39;name&#39;: &#39;Charlie&#39;, &#39;age&#39;: 18, &#39;gender&#39;: &#39;female&#39;, &#39;email&#39;: &#39;charlie@example.com&#39;}</span>
</span></span></code></pre></div><h3 id="å…³é”®å­—å‚æ•°">å…³é”®å­—å‚æ•°</h3>
<p><code>kwarg=value</code> å½¢å¼çš„å…³é”®å­—å‚æ•°ä¹Ÿå¯ä»¥ç”¨äºè°ƒç”¨å‡½æ•°ã€‚å‡½æ•°ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">parrot</span><span class="p">(</span><span class="n">voltage</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s1">&#39;a stiff&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;voom&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;Norwegian Blue&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;-- This parrot wouldn&#39;t&#34;</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;if you put&#34;</span><span class="p">,</span> <span class="n">voltage</span><span class="p">,</span> <span class="s2">&#34;volts through it.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;-- Lovely plumage, the&#34;</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;-- It&#39;s&#34;</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="s2">&#34;!&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>è¯¥å‡½æ•°æ¥å—ä¸€ä¸ªå¿…é€‰å‚æ•°ï¼ˆ<code>voltage</code>ï¼‰å’Œä¸‰ä¸ªå¯é€‰å‚æ•°ï¼ˆ<code>state</code>, <code>action</code> å’Œ <code>type</code>ï¼‰ã€‚è¯¥å‡½æ•°å¯ç”¨ä¸‹åˆ—æ–¹å¼è°ƒç”¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">parrot</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>                                          <span class="c1"># 1 positional argument</span>
</span></span><span class="line"><span class="cl"><span class="n">parrot</span><span class="p">(</span><span class="n">voltage</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>                                  <span class="c1"># 1 keyword argument</span>
</span></span><span class="line"><span class="cl"><span class="n">parrot</span><span class="p">(</span><span class="n">voltage</span><span class="o">=</span><span class="mi">1000000</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;VOOOOOM&#39;</span><span class="p">)</span>             <span class="c1"># 2 keyword arguments</span>
</span></span><span class="line"><span class="cl"><span class="n">parrot</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;VOOOOOM&#39;</span><span class="p">,</span> <span class="n">voltage</span><span class="o">=</span><span class="mi">1000000</span><span class="p">)</span>             <span class="c1"># 2 keyword arguments</span>
</span></span><span class="line"><span class="cl"><span class="n">parrot</span><span class="p">(</span><span class="s1">&#39;a million&#39;</span><span class="p">,</span> <span class="s1">&#39;bereft of life&#39;</span><span class="p">,</span> <span class="s1">&#39;jump&#39;</span><span class="p">)</span>         <span class="c1"># 3 positional arguments</span>
</span></span><span class="line"><span class="cl"><span class="n">parrot</span><span class="p">(</span><span class="s1">&#39;a thousand&#39;</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s1">&#39;pushing up the daisies&#39;</span><span class="p">)</span>  <span class="c1"># 1 positional, 1 keyword</span>
</span></span></code></pre></div><p>ä»¥ä¸‹è°ƒç”¨å‡½æ•°çš„æ–¹å¼éƒ½æ— æ•ˆï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">parrot</span><span class="p">()</span>                     <span class="c1"># required argument missing</span>
</span></span><span class="line"><span class="cl"><span class="n">parrot</span><span class="p">(</span><span class="n">voltage</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="s1">&#39;dead&#39;</span><span class="p">)</span>  <span class="c1"># non-keyword argument after a keyword argument</span>
</span></span><span class="line"><span class="cl"><span class="n">parrot</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span> <span class="n">voltage</span><span class="o">=</span><span class="mi">220</span><span class="p">)</span>     <span class="c1"># duplicate value for the same argument</span>
</span></span><span class="line"><span class="cl"><span class="n">parrot</span><span class="p">(</span><span class="n">actor</span><span class="o">=</span><span class="s1">&#39;John Cleese&#39;</span><span class="p">)</span>  <span class="c1"># unknown keyword argument</span>
</span></span></code></pre></div><p>å‡½æ•°è°ƒç”¨æ—¶ï¼Œå…³é”®å­—å‚æ•°å¿…é¡»è·Ÿåœ¨ä½ç½®å‚æ•°åé¢ã€‚æ‰€æœ‰ä¼ é€’çš„å…³é”®å­—å‚æ•°éƒ½å¿…é¡»åŒ¹é…ä¸€ä¸ªå‡½æ•°æ¥å—çš„å‚æ•°ï¼ˆæ¯”å¦‚ï¼Œ<code>actor</code> ä¸æ˜¯å‡½æ•° <code>parrot</code> çš„æœ‰æ•ˆå‚æ•°ï¼‰ï¼Œå…³é”®å­—å‚æ•°çš„é¡ºåºå¹¶ä¸é‡è¦ã€‚è¿™ä¹ŸåŒ…æ‹¬å¿…é€‰å‚æ•°ï¼Œï¼ˆæ¯”å¦‚ï¼Œ<code>parrot(voltage=1000)</code> ä¹Ÿæœ‰æ•ˆï¼‰ã€‚ä¸èƒ½å¯¹åŒä¸€ä¸ªå‚æ•°å¤šæ¬¡èµ‹å€¼ï¼Œä¸‹é¢å°±æ˜¯ä¸€ä¸ªå› æ­¤é™åˆ¶è€Œå¤±è´¥çš„ä¾‹å­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">     <span class="k">pass</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="n">function</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#Traceback (most recent call last):</span>
</span></span><span class="line"><span class="cl"><span class="c1">#  File &#34;&lt;stdin&gt;&#34;, line 1, in &lt;module&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#TypeError: function() got multiple values for argument &#39;a&#39;</span>
</span></span></code></pre></div><p>æœ€åä¸€ä¸ªå½¢å‚ä¸º <code>**name</code> å½¢å¼æ—¶ï¼Œæ¥æ”¶ä¸€ä¸ªå­—å…¸ï¼Œè¯¥å­—å…¸åŒ…å«ä¸å‡½æ•°ä¸­å·²å®šä¹‰å½¢å‚å¯¹åº”ä¹‹å¤–çš„æ‰€æœ‰å…³é”®å­—å‚æ•°ã€‚<code>**name</code> å½¢å‚å¯ä»¥ä¸ <code>*name</code> å½¢å‚ï¼ˆä¸‹ä¸€å°èŠ‚ä»‹ç»ï¼‰ç»„åˆä½¿ç”¨ï¼ˆ<code>*name</code> å¿…é¡»åœ¨ <code>**name</code> å‰é¢ï¼‰ï¼Œ <code>*name</code> å½¢å‚æ¥æ”¶ä¸€ä¸ªå…ƒç»„ï¼Œè¯¥å…ƒç»„åŒ…å«å½¢å‚åˆ—è¡¨ä¹‹å¤–çš„ä½ç½®å‚æ•°ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å®šä¹‰ä¸‹é¢è¿™æ ·çš„å‡½æ•°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">cheeseshop</span><span class="p">(</span><span class="n">kind</span><span class="p">,</span> <span class="o">*</span><span class="n">arguments</span><span class="p">,</span> <span class="o">**</span><span class="n">keywords</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;-- Do you have any&#34;</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="s2">&#34;?&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;-- I&#39;m sorry, we&#39;re all out of&#34;</span><span class="p">,</span> <span class="n">kind</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">arguments</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;-&#34;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">kw</span><span class="p">,</span> <span class="s2">&#34;:&#34;</span><span class="p">,</span> <span class="n">keywords</span><span class="p">[</span><span class="n">kw</span><span class="p">])</span>
</span></span></code></pre></div><p>è¯¥å‡½æ•°å¯ä»¥ç”¨å¦‚ä¸‹æ–¹å¼è°ƒç”¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">cheeseshop</span><span class="p">(</span><span class="s2">&#34;Limburger&#34;</span><span class="p">,</span> <span class="s2">&#34;It&#39;s very runny, sir.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="s2">&#34;It&#39;s really very, VERY runny, sir.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="n">shopkeeper</span><span class="o">=</span><span class="s2">&#34;Michael Palin&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="n">client</span><span class="o">=</span><span class="s2">&#34;John Cleese&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">           <span class="n">sketch</span><span class="o">=</span><span class="s2">&#34;Cheese Shop Sketch&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">-- Do you have any Limburger ?
</span></span><span class="line"><span class="cl">-- I<span class="s1">&#39;m sorry, we&#39;</span>re all out of Limburger
</span></span><span class="line"><span class="cl">It<span class="s1">&#39;s very runny, sir.
</span></span></span><span class="line"><span class="cl"><span class="s1">It&#39;</span>s really very, VERY runny, sir.
</span></span><span class="line"><span class="cl">----------------------------------------
</span></span><span class="line"><span class="cl">shopkeeper : Michael Palin
</span></span><span class="line"><span class="cl">client : John Cleese
</span></span><span class="line"><span class="cl">sketch : Cheese Shop Sketch
</span></span></code></pre></div><p>æ³¨æ„ï¼Œå…³é”®å­—å‚æ•°åœ¨è¾“å‡ºç»“æœä¸­çš„é¡ºåºä¸è°ƒç”¨å‡½æ•°æ—¶çš„é¡ºåºä¸€è‡´ã€‚</p>
<h3 id="ç‰¹æ®Šå‚æ•°">ç‰¹æ®Šå‚æ•°</h3>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå‚æ•°å¯ä»¥æŒ‰ä½ç½®æˆ–æ˜¾å¼å…³é”®å­—ä¼ é€’ç»™ Python å‡½æ•°ã€‚ä¸ºäº†è®©ä»£ç æ˜“è¯»ã€é«˜æ•ˆï¼Œæœ€å¥½é™åˆ¶å‚æ•°çš„ä¼ é€’æ–¹å¼ï¼Œè¿™æ ·ï¼Œå¼€å‘è€…åªéœ€æŸ¥çœ‹å‡½æ•°å®šä¹‰ï¼Œå³å¯ç¡®å®šå‚æ•°é¡¹æ˜¯ä»…æŒ‰ä½ç½®ã€æŒ‰ä½ç½®æˆ–å…³é”®å­—ï¼Œè¿˜æ˜¯ä»…æŒ‰å…³é”®å­—ä¼ é€’ã€‚</p>
<p>å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">pos_or_kwd</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">kwd1</span><span class="p">,</span> <span class="n">kwd2</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">      <span class="o">-----------</span>    <span class="o">----------</span>     <span class="o">----------</span>
</span></span><span class="line"><span class="cl">        <span class="o">|</span>             <span class="o">|</span>                  <span class="o">|</span>
</span></span><span class="line"><span class="cl">        <span class="o">|</span>        <span class="n">Positional</span> <span class="ow">or</span> <span class="n">keyword</span>   <span class="o">|</span>
</span></span><span class="line"><span class="cl">        <span class="o">|</span>                                <span class="o">-</span> <span class="n">Keyword</span> <span class="n">only</span>
</span></span><span class="line"><span class="cl">         <span class="o">--</span> <span class="n">Positional</span> <span class="n">only</span>
</span></span></code></pre></div><p><code>/</code> å’Œ <code>*</code> æ˜¯å¯é€‰çš„ã€‚è¿™äº›ç¬¦å·è¡¨æ˜å½¢å‚å¦‚ä½•æŠŠå‚æ•°å€¼ä¼ é€’ç»™å‡½æ•°ï¼šä½ç½®ã€ä½ç½®æˆ–å…³é”®å­—ã€å…³é”®å­—ã€‚å…³é”®å­—å½¢å‚ä¹Ÿå«ä½œå‘½åå½¢å‚ã€‚</p>
<ul>
<li>
<p>ä½ç½®æˆ–å…³é”®å­—å‚æ•°ã€‚å‡½æ•°å®šä¹‰ä¸­æœªä½¿ç”¨ <code>/</code> å’Œ <code>*</code> æ—¶ï¼Œå‚æ•°å¯ä»¥æŒ‰ä½ç½®æˆ–å…³é”®å­—ä¼ é€’ç»™å‡½æ•°ã€‚</p>
</li>
<li>
<p>ä»…ä½ç½®å‚æ•°ã€‚ç‰¹å®šå½¢å‚å¯ä»¥æ ‡è®°ä¸º <em>ä»…é™ä½ç½®</em>ã€‚<em>ä»…é™ä½ç½®</em> æ—¶ï¼Œå½¢å‚çš„é¡ºåºå¾ˆé‡è¦ï¼Œä¸”è¿™äº›å½¢å‚ä¸èƒ½ç”¨å…³é”®å­—ä¼ é€’ã€‚ä»…é™ä½ç½®å½¢å‚åº”æ”¾åœ¨ <code>/</code> ï¼ˆæ­£æ–œæ ï¼‰å‰ã€‚<code>/</code> ç”¨äºåœ¨é€»è¾‘ä¸Šåˆ†å‰²ä»…é™ä½ç½®å½¢å‚ä¸å…¶å®ƒå½¢å‚ã€‚å¦‚æœå‡½æ•°å®šä¹‰ä¸­æ²¡æœ‰ <code>/</code>ï¼Œåˆ™è¡¨ç¤ºæ²¡æœ‰ä»…é™ä½ç½®å½¢å‚ã€‚<code>/</code> åå¯ä»¥æ˜¯ <em>ä½ç½®æˆ–å…³é”®å­—</em> æˆ– <em>ä»…é™å…³é”®å­—</em> å½¢å‚ã€‚</p>
</li>
<li>
<p>ä»…é™å…³é”®å­—å‚æ•°ã€‚æŠŠå½¢å‚æ ‡è®°ä¸º <em>ä»…é™å…³é”®å­—</em>ï¼Œè¡¨æ˜å¿…é¡»ä»¥å…³é”®å­—å‚æ•°å½¢å¼ä¼ é€’è¯¥å½¢å‚ï¼Œåº”åœ¨å‚æ•°åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ª <em>ä»…é™å…³é”®å­—</em> å½¢å‚å‰æ·»åŠ  <code>*</code>ã€‚</p>
</li>
</ul>
<p>è¯·çœ‹ä¸‹é¢çš„å‡½æ•°å®šä¹‰ç¤ºä¾‹ï¼Œæ³¨æ„ <code>/</code> å’Œ <code>*</code> æ ‡è®°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">standard_arg</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">     <span class="nb">print</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">pos_only_arg</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="o">/</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">     <span class="nb">print</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">kwd_only_arg</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">     <span class="nb">print</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">combined_example</span><span class="p">(</span><span class="n">pos_only</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">standard</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">kwd_only</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">     <span class="nb">print</span><span class="p">(</span><span class="n">pos_only</span><span class="p">,</span> <span class="n">standard</span><span class="p">,</span> <span class="n">kwd_only</span><span class="p">)</span>
</span></span></code></pre></div><p>ç¬¬ä¸€ä¸ªå‡½æ•°å®šä¹‰ <code>standard_arg</code> æ˜¯æœ€å¸¸è§çš„å½¢å¼ï¼Œå¯¹è°ƒç”¨æ–¹å¼æ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œå¯ä»¥æŒ‰ä½ç½®ä¹Ÿå¯ä»¥æŒ‰å…³é”®å­—ä¼ é€’å‚æ•°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">standard_arg</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># 2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">standard_arg</span><span class="p">(</span><span class="n">arg</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># 2</span>
</span></span></code></pre></div><p>ç¬¬äºŒä¸ªå‡½æ•° <code>pos_only_arg</code> çš„å‡½æ•°å®šä¹‰ä¸­æœ‰ <code>/</code>ï¼Œä»…é™ä½¿ç”¨ä½ç½®å½¢å‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pos_only_arg</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># 1</span>
</span></span></code></pre></div><p>ç¬¬ä¸‰ä¸ªå‡½æ•° <code>kwd_only_args</code> çš„å‡½æ•°å®šä¹‰é€šè¿‡ <code>*</code> è¡¨æ˜ä»…é™å…³é”®å­—å‚æ•°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">kwd_only_arg</span><span class="p">(</span><span class="n">arg</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># 3</span>
</span></span></code></pre></div><p>æœ€åä¸€ä¸ªå‡½æ•°åœ¨åŒä¸€ä¸ªå‡½æ•°å®šä¹‰ä¸­ï¼Œä½¿ç”¨äº†å…¨éƒ¨ä¸‰ç§è°ƒç”¨æƒ¯ä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">combined_example</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">kwd_only</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># 1 2 3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">combined_example</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">standard</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">kwd_only</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="c1">#1 2 3</span>
</span></span></code></pre></div><p>ä¸‹é¢çš„å‡½æ•°å®šä¹‰ä¸­ï¼Œ<code>kwds</code> æŠŠ <code>name</code> å½“ä½œé”®ï¼Œå› æ­¤ï¼Œå¯èƒ½ä¸ä½ç½®å‚æ•° <code>name</code> äº§ç”Ÿæ½œåœ¨å†²çªï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">kwds</span>
</span></span></code></pre></div><p>è°ƒç”¨è¯¥å‡½æ•°ä¸å¯èƒ½è¿”å› <code>True</code>ï¼Œå› ä¸ºå…³é”®å­— <code>'name'</code> æ€»ä¸ç¬¬ä¸€ä¸ªå½¢å‚ç»‘å®šã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="c1">#Traceback (most recent call last):</span>
</span></span><span class="line"><span class="cl"><span class="c1">#  File &#34;&lt;stdin&gt;&#34;, line 1, in &lt;module&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#TypeError: foo() got multiple values for argument &#39;name&#39;</span>
</span></span></code></pre></div><p>åŠ ä¸Š <code>/</code> ï¼ˆä»…é™ä½ç½®å‚æ•°ï¼‰åï¼Œå°±å¯ä»¥äº†ã€‚æ­¤æ—¶ï¼Œå‡½æ•°å®šä¹‰æŠŠ <code>name</code> å½“ä½œä½ç½®å‚æ•°ï¼Œ<code>'name'</code> ä¹Ÿå¯ä»¥ä½œä¸ºå…³é”®å­—å‚æ•°çš„é”®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">     <span class="k">return</span> <span class="s1">&#39;name&#39;</span> <span class="ow">in</span> <span class="n">kwds</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span> <span class="c1"># True</span>
</span></span></code></pre></div><p>æ¢å¥è¯è¯´ï¼Œä»…é™ä½ç½®å½¢å‚çš„åç§°å¯ä»¥åœ¨ <code>**kwds</code> ä¸­ä½¿ç”¨ï¼Œè€Œä¸äº§ç”Ÿæ­§ä¹‰ã€‚</p>
<h2 id="ä»»æ„å®å‚åˆ—è¡¨">ä»»æ„å®å‚åˆ—è¡¨</h2>
<p>è°ƒç”¨å‡½æ•°æ—¶ï¼Œä½¿ç”¨ä»»æ„æ•°é‡çš„å®å‚æ˜¯æœ€å°‘è§çš„é€‰é¡¹ã€‚è¿™äº›å®å‚åŒ…å«åœ¨å…ƒç»„ä¸­ã€‚åœ¨å¯å˜æ•°é‡çš„å®å‚ä¹‹å‰ï¼Œå¯èƒ½æœ‰è‹¥å¹²ä¸ªæ™®é€šå‚æ•°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">write_multiple_items</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">separator</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">separator</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
</span></span></code></pre></div><p><em>variadic</em> å‚æ•°ç”¨äºé‡‡é›†ä¼ é€’ç»™å‡½æ•°çš„æ‰€æœ‰å‰©ä½™å‚æ•°ï¼Œå› æ­¤ï¼Œå®ƒä»¬é€šå¸¸åœ¨å½¢å‚åˆ—è¡¨çš„æœ«å°¾ã€‚<code>*args</code> å½¢å‚åçš„ä»»ä½•å½¢å¼å‚æ•°åªèƒ½æ˜¯ä»…é™å…³é”®å­—å‚æ•°ï¼Œå³åªèƒ½ç”¨ä½œå…³é”®å­—å‚æ•°ï¼Œä¸èƒ½ç”¨ä½œä½ç½®å‚æ•°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">concat</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&#34;/&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">concat</span><span class="p">(</span><span class="s2">&#34;earth&#34;</span><span class="p">,</span> <span class="s2">&#34;mars&#34;</span><span class="p">,</span> <span class="s2">&#34;venus&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">concat</span><span class="p">(</span><span class="s2">&#34;earth&#34;</span><span class="p">,</span> <span class="s2">&#34;mars&#34;</span><span class="p">,</span> <span class="s2">&#34;venus&#34;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&#34;.&#34;</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="è§£åŒ…å®å‚åˆ—è¡¨">è§£åŒ…å®å‚åˆ—è¡¨</h2>
<p>å‡½æ•°è°ƒç”¨è¦æ±‚ç‹¬ç«‹çš„ä½ç½®å‚æ•°ï¼Œä½†å®å‚åœ¨åˆ—è¡¨æˆ–å…ƒç»„é‡Œæ—¶ï¼Œè¦æ‰§è¡Œç›¸åçš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œå†…ç½®çš„ <code>range()</code> å‡½æ•°è¦æ±‚ç‹¬ç«‹çš„ <em>start</em> å’Œ <em>stop</em> å®å‚ã€‚å¦‚æœè¿™äº›å‚æ•°ä¸æ˜¯ç‹¬ç«‹çš„ï¼Œåˆ™è¦åœ¨è°ƒç”¨å‡½æ•°æ—¶ï¼Œç”¨ <code>*</code> æ“ä½œç¬¦æŠŠå®å‚ä»åˆ—è¡¨æˆ–å…ƒç»„è§£åŒ…å‡ºæ¥ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>            <span class="c1"># normal call with separate arguments</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">))</span>            <span class="c1"># call with arguments unpacked from a list</span>
</span></span></code></pre></div><p>åŒæ ·ï¼Œå­—å…¸å¯ä»¥ç”¨ <code>**</code> æ“ä½œç¬¦ä¼ é€’å…³é”®å­—å‚æ•°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">parrot</span><span class="p">(</span><span class="n">voltage</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="s1">&#39;a stiff&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;voom&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;-- This parrot wouldn&#39;t&#34;</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;if you put&#34;</span><span class="p">,</span> <span class="n">voltage</span><span class="p">,</span> <span class="s2">&#34;volts through it.&#34;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;E&#39;s&#34;</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="s2">&#34;!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;voltage&#34;</span><span class="p">:</span> <span class="s2">&#34;four million&#34;</span><span class="p">,</span> <span class="s2">&#34;state&#34;</span><span class="p">:</span> <span class="s2">&#34;bleedin&#39; demised&#34;</span><span class="p">,</span> <span class="s2">&#34;action&#34;</span><span class="p">:</span> <span class="s2">&#34;VOOM&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">parrot</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="lambda-å‡½æ•°">Lambda å‡½æ•°</h2>
<p>Python ä¸­è¿˜æœ‰ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ç§°ä¸º lambda å‡½æ•°ï¼Œå®ƒæ˜¯ä¸€ç§åŒ¿åå‡½æ•°ï¼Œç”¨äºåˆ›å»ºç®€çŸ­çš„å‡½æ•°ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ª lambda å‡½æ•°ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">add_numbers</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">add_numbers</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>lambda</code> å…³é”®å­—åˆ›å»ºäº†ä¸€ä¸ªåŒ¿åå‡½æ•° <code>add_numbers</code>ï¼Œå®ƒæ¥å—ä¸¤ä¸ªå‚æ•° <code>x</code> å’Œ <code>y</code>ï¼Œå¹¶è¿”å›å®ƒä»¬çš„å’Œã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>add_numbers(2, 3)</code> è°ƒç”¨è¿™ä¸ªåŒ¿åå‡½æ•°ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨å˜é‡ <code>result</code> ä¸­ã€‚</p>
<h2 id="å‡½æ•°æ³¨è§£">å‡½æ•°æ³¨è§£</h2>
<p>Python å‡½æ•°æ³¨è§£æ˜¯ä¸€ç§åœ¨å‡½æ•°å®šä¹‰ä¸­æ·»åŠ å…ƒæ•°æ®çš„åŠŸèƒ½ã€‚è¿™äº›æ³¨è§£å¯ä»¥ç”¨äºæŒ‡å®šå‡½æ•°å‚æ•°å’Œè¿”å›å€¼çš„ç±»å‹ã€å‚æ•°çš„é»˜è®¤å€¼ã€å‡½æ•°çš„æ–‡æ¡£å­—ç¬¦ä¸²ç­‰ä¿¡æ¯ã€‚è™½ç„¶æ³¨è§£å¹¶ä¸ä¼šå½±å“ Python å‡½æ•°çš„è¡Œä¸ºï¼Œä½†å®ƒä»¬å¯ä»¥æä¾›æœ‰ç”¨çš„ä¿¡æ¯ï¼Œä½¿ä»£ç æ›´åŠ æ¸…æ™°æ˜“è¯»ã€‚</p>
<p>Python å‡½æ•°æ³¨è§£ä½¿ç”¨çš„è¯­æ³•æ˜¯åœ¨å‡½æ•°å®šä¹‰çš„å‚æ•°åˆ—è¡¨åé¢æ·»åŠ å†’å·å’Œæ³¨è§£ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå‡½æ•°æ³¨è§£çš„ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">add_numbers</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ³¨è§£æŒ‡å®šäº†å‡½æ•° <code>add_numbers()</code> çš„ä¸¤ä¸ªå‚æ•° <code>x</code> å’Œ <code>y</code> çš„ç±»å‹ä¸º <code>int</code>ï¼Œå¹¶æŒ‡å®šå‡½æ•°è¿”å›å€¼çš„ç±»å‹ä¹Ÿä¸º <code>int</code>ã€‚åœ¨å‡½æ•°ä½“ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨åŠ æ³•è¿ç®—ç¬¦å°†è¿™ä¸¤ä¸ªå‚æ•°ç›¸åŠ ï¼Œå¹¶è¿”å›ç»“æœã€‚</p>
<p>å‡½æ•°æ³¨è§£è¿˜å¯ä»¥åŒ…å«å‚æ•°çš„é»˜è®¤å€¼ã€å‚æ•°çš„å¯å˜æ€§å’Œå‡½æ•°çš„æ–‡æ¡£å­—ç¬¦ä¸²ç­‰ä¿¡æ¯ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŒ…å«è¿™äº›ä¿¡æ¯çš„å‡½æ•°æ³¨è§£ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">greet</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&#34;World&#34;</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">times</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    Greet a person by name and optionally repeat the greeting multiple times.
</span></span></span><span class="line"><span class="cl"><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">    :param name: The name of the person to greet. Default is &#34;World&#34;.
</span></span></span><span class="line"><span class="cl"><span class="s2">    :param times: The number of times to repeat the greeting. Default is 1.
</span></span></span><span class="line"><span class="cl"><span class="s2">    :return: A string containing the greeting message.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">message</span> <span class="o">=</span> <span class="s2">&#34;Hello, &#34;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&#34;!</span><span class="se">\n</span><span class="s2">&#34;</span> <span class="o">*</span> <span class="n">times</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">message</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ³¨è§£æŒ‡å®šäº†å‡½æ•° <code>greet()</code> çš„å‚æ•° <code>name</code> å’Œ <code>times</code> çš„ç±»å‹ä¸º <code>str</code> å’Œ <code>int</code>ï¼Œå¹¶æŒ‡å®šäº†å‚æ•° <code>name</code> çš„é»˜è®¤å€¼ä¸º <code>&quot;World&quot;</code>ï¼Œå‚æ•° <code>times</code> çš„é»˜è®¤å€¼ä¸º <code>1</code>ã€‚æˆ‘ä»¬è¿˜ä½¿ç”¨äº†å‡½æ•°çš„æ–‡æ¡£å­—ç¬¦ä¸²æ¥æä¾›æ›´è¯¦ç»†çš„å‡½æ•°è¯´æ˜ã€‚</p>
<p><a href="https://docs.python.org/zh-cn/3/glossary.html#term-function-annotation">æ ‡æ³¨</a> ä»¥å­—å…¸çš„å½¢å¼å­˜æ”¾åœ¨å‡½æ•°çš„ <code>__annotations__</code> å±æ€§ä¸­ï¼Œå¹¶ä¸”ä¸ä¼šå½±å“å‡½æ•°çš„ä»»ä½•å…¶ä»–éƒ¨åˆ†ã€‚ å½¢å‚æ ‡æ³¨çš„å®šä¹‰æ–¹å¼æ˜¯åœ¨å½¢å‚åååŠ å†’å·ï¼Œåé¢è·Ÿä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¯¥è¡¨è¾¾å¼ä¼šè¢«æ±‚å€¼ä¸ºæ ‡æ³¨çš„å€¼ã€‚ è¿”å›å€¼æ ‡æ³¨çš„å®šä¹‰æ–¹å¼æ˜¯åŠ ç»„åˆç¬¦å· <code>-&gt;</code>ï¼Œåé¢è·Ÿä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¯¥æ ‡æ³¨ä½äºå½¢å‚åˆ—è¡¨å’Œè¡¨ç¤º <code>def</code> è¯­å¥ç»“æŸçš„å†’å·ä¹‹é—´ã€‚ ä¸‹é¢çš„ç¤ºä¾‹æœ‰ä¸€ä¸ªå¿…é¡»çš„å‚æ•°ï¼Œä¸€ä¸ªå¯é€‰çš„å…³é”®å­—å‚æ•°ä»¥åŠè¿”å›å€¼éƒ½å¸¦æœ‰ç›¸åº”çš„æ ‡æ³¨:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">ham</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">eggs</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;eggs&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Annotations:&#34;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="vm">__annotations__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Arguments:&#34;</span><span class="p">,</span> <span class="n">ham</span><span class="p">,</span> <span class="n">eggs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">ham</span> <span class="o">+</span> <span class="s1">&#39; and &#39;</span> <span class="o">+</span> <span class="n">eggs</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">f</span><span class="p">(</span><span class="s1">&#39;spam&#39;</span><span class="p">)</span>
</span></span></code></pre></div>]]></content:encoded>
    </item>
    
    <item>
      <title>[è¯‘]ç”¨ Bottle å¼€å‘</title>
      <link>https://blog.chensoul.com/posts/2023/06/25/developing-with-bottle/</link>
      <pubDate>Sun, 25 Jun 2023 09:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/06/25/developing-with-bottle/</guid>
      <description>æˆ‘å–œæ¬¢ bottleã€‚å®ƒæ˜¯ä¸€ä¸ªç®€å•ã€å¿«é€Ÿä¸”åŠŸèƒ½å¼ºå¤§çš„ Python å¾®æ¡†æ¶ï¼Œéå¸¸é€‚åˆå°å‹ Web åº”ç”¨ç¨‹åºå’Œå¿«é€ŸåŸå‹è®¾è®¡ã€‚å¯¹äºé‚£äº›åˆšåˆšå¼€å§‹ Web å¼€å‘çš„äººæ¥è¯´ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ª</description>
      <content:encoded><![CDATA[<p><img loading="lazy" src="https://files.realpython.com/media/bottle-logo.4c5ab3d2ae78.png" alt="Bottle logo"  />
</p>
<p>æˆ‘å–œæ¬¢ <a href="http://bottlepy.org/docs/stable/">bottle</a>ã€‚å®ƒæ˜¯ä¸€ä¸ªç®€å•ã€å¿«é€Ÿä¸”åŠŸèƒ½å¼ºå¤§çš„ Python å¾®æ¡†æ¶ï¼Œéå¸¸é€‚åˆå°å‹ Web åº”ç”¨ç¨‹åºå’Œå¿«é€ŸåŸå‹è®¾è®¡ã€‚å¯¹äºé‚£äº›åˆšåˆšå¼€å§‹ Web å¼€å‘çš„äººæ¥è¯´ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªå‡ºè‰²çš„å­¦ä¹ å·¥å…·ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šæœ¬æ•™ç¨‹å‡è®¾æ‚¨æ­£åœ¨è¿è¡ŒåŸºäº Unix çš„ç¯å¢ƒ - ä¾‹å¦‚ Mac OS Xã€Linux ç‰ˆæœ¬æˆ–é€šè¿‡è™šæ‹Ÿæœºæ”¯æŒçš„ Linux ç‰ˆæœ¬ã€‚</p>
</blockquote>
<p><strong>06/13/2015æ›´æ–°</strong>ï¼šæ›´æ–°äº†ä»£ç ç¤ºä¾‹å’Œè§£é‡Šã€‚</p>
<h2 id="å¯åŠ¨">å¯åŠ¨</h2>
<p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå·¥ä½œç›®å½•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ mkdir bottle <span class="o">&amp;&amp;</span> <span class="nb">cd</span> bottle
</span></span></code></pre></div><p>æ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦å®‰è£… <a href="https://realpython.com/what-is-pip/">pip</a>ã€virtualenv å’Œ gitã€‚</p>
<p><a href="https://pypi.python.org/pypi/virtualenv">virtualenv</a> æ˜¯ä¸€ä¸ª Python å·¥å…·ï¼Œå¯ä»¥<a href="https://realpython.com/python-virtual-environments-a-primer/">è½»æ¾ç®¡ç†ç‰¹å®šé¡¹ç›®æ‰€éœ€çš„PythonåŒ…</a>ï¼›å®ƒå¯ä»¥é˜²æ­¢ä¸€ä¸ªé¡¹ç›®ä¸­çš„åŒ…ä¸å…¶ä»–é¡¹ç›®ä¸­çš„åŒ…å‘ç”Ÿå†²çªã€‚åŒæ—¶ï¼Œpip æ˜¯ä¸€ä¸ªåŒ…ç®¡ç†å™¨ï¼Œç”¨äºç®¡ç† Python <a href="https://realpython.com/python-modules-packages/">åŒ…çš„å®‰è£…</a>ã€‚</p>
<p>å¦‚éœ€åœ¨ Unix ç¯å¢ƒä¸­å®‰è£… pipï¼ˆåŠå…¶ä¾èµ–é¡¹ï¼‰çš„å¸®åŠ©ï¼Œè¯·æŒ‰ç…§ <a href="https://gist.github.com/mjhea0/5692708">æ­¤ Gist</a> ä¸­çš„è¯´æ˜è¿›è¡Œæ“ä½œã€‚å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Windows ç¯å¢ƒï¼Œè¯·è§‚çœ‹æ­¤è§†é¢‘ä»¥è·å–å¸®åŠ©ã€‚</p>
<p>å®‰è£… <a href="https://realpython.com/courses/what-is-pip/">pip</a> åï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£… virtualenvï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ pip install <span class="nv">virtualenv</span><span class="o">==</span>12.0.7
</span></span></code></pre></div><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥è½»æ¾è®¾ç½®æœ¬åœ°ç¯å¢ƒï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ virtualenv venv
</span></span><span class="line"><span class="cl">$ <span class="nb">source</span> venv/bin/activate
</span></span></code></pre></div><p>å®‰è£… bottleï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ pip install <span class="nv">bottle</span><span class="o">==</span>0.12.8
</span></span><span class="line"><span class="cl">$ pip freeze &gt; requirements.txt
</span></span></code></pre></div><p>æœ€åï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ Git å°†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºç½®äºç‰ˆæœ¬æ§åˆ¶ä¹‹ä¸‹ã€‚æœ‰å…³ Git çš„æ›´å¤šä¿¡æ¯ï¼Œè¯· <a href="https://realpython.com/python-git-github-intro/">æŸ¥çœ‹æœ¬æ–‡</a>ï¼Œå…¶ä¸­è¿˜åŒ…æ‹¬å®‰è£…è¯´æ˜ã€‚</p>
<h2 id="ç¼–å†™ä½ çš„åº”ç”¨ç¨‹åº">ç¼–å†™ä½ çš„åº”ç”¨ç¨‹åº</h2>
<p>æˆ‘ä»¬å‡†å¤‡å¥½ç¼–å†™æˆ‘ä»¬çš„ç“¶å­åº”ç”¨ç¨‹åºäº†ã€‚æ‰“å¼€ Sublime Text 3 æˆ–æ‚¨é€‰æ‹©çš„æ–‡æœ¬ç¼–è¾‘å™¨ã€‚åˆ›å»ºæ‚¨çš„åº”ç”¨ç¨‹åºæ–‡ä»¶ app.pyï¼Œå®ƒå°†ä¿å­˜æˆ‘ä»¬ç¬¬ä¸€ä¸ªåº”ç”¨ç¨‹åºçš„å…¨éƒ¨å†…å®¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span><span class="p">,</span> <span class="n">run</span><span class="p">,</span> <span class="n">template</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">index_html</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;My first web app! By &lt;strong&gt;{{ author }}&lt;/strong&gt;.&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">template</span><span class="p">(</span><span class="n">index_html</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="s1">&#39;Real Python&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@route</span><span class="p">(</span><span class="s1">&#39;/name/&lt;name&gt;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">template</span><span class="p">(</span><span class="n">index_html</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PORT&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span></code></pre></div><p>ä¿å­˜æ–‡ä»¶ã€‚</p>
<p>ç°åœ¨æ‚¨å¯ä»¥åœ¨æœ¬åœ°è¿è¡Œæ‚¨çš„åº”ç”¨ç¨‹åºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python app.py
</span></span></code></pre></div><p>æ‚¨åº”è¯¥èƒ½å¤Ÿè¿æ¥åˆ° <a href="http://localhost:8080/">http://localhost:8080/</a> å¹¶çœ‹åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºæ­£åœ¨è¿è¡Œï¼</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">My first web app! By RealPython.
</span></span></code></pre></div><p>å› æ­¤ï¼Œ <code>@route</code> <a href="https://realpython.com/primer-on-python-decorators/">è£…é¥°å™¨</a>å°†ä¸€ä¸ªå‡½æ•°ç»‘å®šåˆ°è·¯ç”±ã€‚åœ¨ç¬¬ä¸€ä¸ªè·¯ç”± <code>/</code> ä¸­ï¼Œ <code>index()</code> å‡½æ•°ç»‘å®šåˆ°è¯¥è·¯ç”±ï¼Œè¯¥è·¯ç”±æ¸²æŸ“ <code>index_html</code> æ¨¡æ¿å¹¶ä¼ å…¥<a href="https://realpython.com/python-variables/">å˜é‡</a> <code>author</code> ä½œä¸ºå…³é”®å­—å‚æ•°ã€‚ç„¶åå¯ä»¥åœ¨æ¨¡æ¿ä¸­è®¿é—®è¯¥å˜é‡ã€‚</p>
<p>ç°åœ¨å¯¼èˆªåˆ°ä¸‹ä¸€æ¡è·¯ç”±ï¼Œç¡®ä¿åœ¨è·¯ç”±æœ«å°¾æ·»åŠ æ‚¨çš„åå­— - å³ http://localhost:8080/name/Michaelã€‚æ‚¨åº”è¯¥çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹å†…å®¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">My first web app! By Michael.
</span></span></code></pre></div><p><strong>è¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ</strong></p>
<ul>
<li>
<p>åŒæ ·ï¼Œ <code>@route</code> è£…é¥°å™¨å°†ä¸€ä¸ªå‡½æ•°ç»‘å®šåˆ°è·¯ç”±ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨åŒ…å«é€šé…ç¬¦ <code>&lt;name&gt;</code> çš„åŠ¨æ€è·¯ç”±ã€‚</p>
</li>
<li>
<p>ç„¶åï¼Œè¯¥é€šé…ç¬¦ä½œä¸ºå‚æ•°ä¼ é€’ç»™è§†å›¾å‡½æ•° - <code>def name(name)</code> ã€‚</p>
</li>
<li>
<p>ç„¶åæˆ‘ä»¬å°†å…¶ä½œä¸ºå…³é”®å­—å‚æ•°ä¼ é€’ç»™æ¨¡æ¿ - <code>author=name</code></p>
</li>
<li>
<p>ç„¶åæ¨¡æ¿æ¸²æŸ“ä½œè€…å˜é‡ - <code>{{ author }}</code> ã€‚</p>
</li>
</ul>
<h2 id="shell-è„šæœ¬">Shell è„šæœ¬</h2>
<p>æƒ³å¿«é€Ÿå…¥é—¨å—ï¼Ÿä½¿ç”¨æ­¤ Shell è„šæœ¬åœ¨å‡ ç§’é’Ÿå†…ç”Ÿæˆå…¥é—¨åº”ç”¨ç¨‹åºã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir bottle
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> bottle
</span></span><span class="line"><span class="cl">pip install <span class="nv">virtualenv</span><span class="o">==</span>12.0.7
</span></span><span class="line"><span class="cl">virtualenv venv
</span></span><span class="line"><span class="cl"><span class="nb">source</span> venv/bin/activate
</span></span><span class="line"><span class="cl">pip install <span class="nv">bottle</span><span class="o">==</span>0.12.8
</span></span><span class="line"><span class="cl">pip freeze &gt; requirements.txt
</span></span><span class="line"><span class="cl">git init
</span></span><span class="line"><span class="cl">git add .
</span></span><span class="line"><span class="cl">git commit -m <span class="s2">&#34;initial commit&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">cat &gt;app.py <span class="s">&lt;&lt;EOF
</span></span></span><span class="line"><span class="cl"><span class="s">import os
</span></span></span><span class="line"><span class="cl"><span class="s">from bottle import route, run, template
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">index_html = &#39;&#39;&#39;My first web app! By &lt;strong&gt;{{ author }}&lt;/strong&gt;.&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">@route(&#39;/&#39;)
</span></span></span><span class="line"><span class="cl"><span class="s">def index():
</span></span></span><span class="line"><span class="cl"><span class="s">    return template(index_html, author=&#39;Real Python&#39;)
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">@route(&#39;/name/&lt;name&gt;&#39;)
</span></span></span><span class="line"><span class="cl"><span class="s">def name(name):
</span></span></span><span class="line"><span class="cl"><span class="s">    return template(index_html, author=name)
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">if __name__ == &#39;__main__&#39;:
</span></span></span><span class="line"><span class="cl"><span class="s">    port = int(os.environ.get(&#39;PORT&#39;, 8080))
</span></span></span><span class="line"><span class="cl"><span class="s">    run(host=&#39;0.0.0.0&#39;, port=port, debug=True)
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">chmod a+x app.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">git init
</span></span><span class="line"><span class="cl">git add .
</span></span><span class="line"><span class="cl">git commit -m <span class="s2">&#34;Updated&#34;</span>
</span></span></code></pre></div><p>ä»<a href="https://gist.github.com/mjhea0/5784132">æ­¤è¦ç‚¹</a>ä¸‹è½½æ­¤è„šæœ¬ï¼Œç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œå®ƒï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ bash bottle.sh
</span></span></code></pre></div><h2 id="ä¸‹ä¸€æ­¥">ä¸‹ä¸€æ­¥</h2>
<p>ä»è¿™ä¸€ç‚¹æ¥çœ‹ï¼Œåˆ›å»ºæ–°é¡µé¢å°±åƒæ·»åŠ æ–°çš„ <code>@route</code> è£…é¥°å‡½æ•°ä¸€æ ·ç®€å•ã€‚</p>
<p>åˆ›å»º HTML å¾ˆç®€å•ï¼šåœ¨ä¸Šé¢çš„åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬åªæ˜¯å°† HTML å†…è”åˆ°æ–‡ä»¶æœ¬èº«ä¸­ã€‚ä¿®æ”¹å®ƒä»¥ä»æ–‡ä»¶åŠ è½½æ¨¡æ¿å¾ˆå®¹æ˜“ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nd">@route</span><span class="p">(</span><span class="s1">&#39;/main&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">template</span><span class="p">(</span><span class="s1">&#39;main_template&#39;</span><span class="p">)</span>
</span></span></code></pre></div><p>è¿™å°†åŠ è½½æ¨¡æ¿æ–‡ä»¶ <code>main_template.tpl</code> ï¼Œè¯¥æ–‡ä»¶å¿…é¡»æ”¾ç½®åœ¨é¡¹ç›®ç»“æ„ä¸­çš„ <code>views</code> æ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶å°†å…¶å‘ˆç°ç»™æœ€ç»ˆç”¨æˆ·ã€‚</p>
<p>æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… bottle <a href="http://bottlepy.org/docs/dev/">æ–‡æ¡£</a>ã€‚</p>
<h2 id="åŸºæœ¬è®¾ç½®">åŸºæœ¬è®¾ç½®</h2>
<p>é¦–å…ˆä»ç¬¬ 1 éƒ¨åˆ†ä¸‹è½½æ­¤ <a href="https://gist.github.com/mjhea0/5784132">Gist</a>ï¼Œç„¶åä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œå®ƒï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ bash bottle.sh
</span></span></code></pre></div><p>è¿™å°†åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„é¡¹ç›®ç»“æ„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">â”œâ”€â”€ app.py
</span></span><span class="line"><span class="cl">â”œâ”€â”€ requirements.txt
</span></span><span class="line"><span class="cl">â””â”€â”€ testenv
</span></span></code></pre></div><p>æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="nb">cd</span> bottle
</span></span><span class="line"><span class="cl">$ <span class="nb">source</span> testenv/bin/activate
</span></span></code></pre></div><p>å®‰è£…è¦æ±‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ pip install -r requirements.txt
</span></span></code></pre></div><p>å¯¼èˆªåˆ° <a href="https://www.plot.ly/api">https://www.plot.ly/api</a>ï¼Œæ³¨å†Œä¸€ä¸ªæ–°å¸æˆ·ï¼Œç™»å½•ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„ API å¯†é’¥ï¼š</p>
<p><img loading="lazy" src="https://files.realpython.com/media/plotly-api-credentials.03a477bfd4d1.png" alt="Plotly API credentials"  />
</p>
<p>å¤åˆ¶è¯¥å¯†é’¥ã€‚</p>
<p>å®‰è£…plot.lyï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ pip install <span class="nv">plotly</span><span class="o">==</span>1.2.6
</span></span></code></pre></div><p>æ¥ä¸‹æ¥æ›´æ–°app.pyä¸­çš„ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">run</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">get</span><span class="p">,</span> <span class="n">post</span><span class="p">,</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">plotly.plotly</span> <span class="k">as</span> <span class="nn">py</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">plotly.graph_objs</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># add your username and api key</span>
</span></span><span class="line"><span class="cl"><span class="n">py</span><span class="o">.</span><span class="n">sign_in</span><span class="p">(</span><span class="s2">&#34;realpython&#34;</span><span class="p">,</span> <span class="s2">&#34;lijlflx93&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@get</span><span class="p">(</span><span class="s1">&#39;/plot&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">form</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s1">&#39;&#39;&#39;&lt;h2&gt;Graph via Plot.ly&lt;/h2&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">              &lt;form method=&#34;POST&#34; action=&#34;https://blog.chensoul.com/plot&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">                Name: &lt;input name=&#34;name1&#34; type=&#34;text&#34; /&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">                Age: &lt;input name=&#34;age1&#34; type=&#34;text&#34; /&gt;&lt;br/&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">                Name: &lt;input name=&#34;name2&#34; type=&#34;text&#34; /&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">                Age: &lt;input name=&#34;age2&#34; type=&#34;text&#34; /&gt;&lt;br/&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">                Name: &lt;input name=&#34;name3&#34; type=&#34;text&#34; /&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">                Age: &lt;input name=&#34;age3&#34; type=&#34;text&#34; /&gt;&lt;br/&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">                &lt;input type=&#34;submit&#34; /&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">              &lt;/form&gt;&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@post</span><span class="p">(</span><span class="s1">&#39;/plot&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">submit</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># grab data from form</span>
</span></span><span class="line"><span class="cl">    <span class="n">name1</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">forms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">age1</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">forms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;age1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">name2</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">forms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name2&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">age2</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">forms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;age2&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">name3</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">forms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name3&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">age3</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">forms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;age3&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">Data</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">        <span class="n">Bar</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">name1</span><span class="p">,</span> <span class="n">name2</span><span class="p">,</span> <span class="n">name3</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">age1</span><span class="p">,</span> <span class="n">age2</span><span class="p">,</span> <span class="n">age3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># make api call</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span> <span class="o">=</span> <span class="n">py</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;basic-bar&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">response</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">template</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">            &lt;h1&gt;Congrats!&lt;/h1&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">            &lt;div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">              View your graph here: &lt;a href=&#34;{{response}}&#34;&lt;/a&gt;{{response}}
</span></span></span><span class="line"><span class="cl"><span class="s1">            &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">            &#39;&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">response</span><span class="o">=</span><span class="n">response</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PORT&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span></code></pre></div><p>è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</p>
<ul>
<li>ç¬¬ä¸€ä¸ªå‡½æ•° <code>form()</code> åˆ›å»ºä¸€ä¸ª HTML è¡¨å•ï¼Œç”¨äºæ•è·åˆ¶ä½œç®€å•æ¡å½¢å›¾æ‰€éœ€çš„æ•°æ®ã€‚</li>
<li>ä¸æ­¤åŒæ—¶ï¼Œç¬¬äºŒä¸ªå‡½æ•° <code>submit()</code> æŠ“å–è¡¨å•è¾“å…¥ï¼Œå°†å®ƒä»¬åˆ†é…ç»™å˜é‡ï¼Œç„¶åè°ƒç”¨plot.ly APIï¼Œä¼ é€’æˆ‘ä»¬çš„å‡­æ®å’Œæ•°æ®ï¼Œä»¥ç”Ÿæˆæ–°å›¾è¡¨ã€‚ç¡®ä¿å°†æˆ‘çš„ç”¨æˆ·åå’Œ API å¯†é’¥æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„å‡­æ®ã€‚ä¸è¦ä½¿ç”¨æˆ‘çš„ã€‚ä¸èµ·ä½œç”¨ã€‚</li>
</ul>
<h3 id="æµ‹è¯•">æµ‹è¯•</h3>
<p>åœ¨æœ¬åœ°è¿è¡Œæ‚¨çš„åº”ç”¨ç¨‹åºï¼Œ <code>python app.py</code> ï¼Œå¹¶å°†æµè§ˆå™¨æŒ‡å‘ <a href="http://localhost:8080/plot">http://localhost:8080/plot</a>ã€‚</p>
<p>è¾“å…¥ä¸‰ä¸ªäººçš„å§“ååŠå…¶å„è‡ªçš„å¹´é¾„ã€‚æŒ‰â€œæäº¤â€ï¼Œå¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä¸€æ¡ç¥è´ºæ¶ˆæ¯å’Œä¸€ä¸ª URLã€‚å•å‡» URL æŸ¥çœ‹æ‚¨çš„å›¾è¡¨ï¼š</p>
<p><img loading="lazy" src="https://files.realpython.com/media/plotly-ages-barplot.c0b4b77d41cf.png" alt="Plotly ages bar plot"  />
</p>
<p>å¦‚æœæ‚¨æ”¶åˆ°æ­¤æ¶ˆæ¯çš„ 500 é”™è¯¯ - <code>Aw, snap! Looks like you supplied the wrong API key. Want to try again? You can always view your key at https://plot.ly/api/key. When you display your key at https://plot.ly/api/key, make sure that you're logged in as realpython.</code> - æ‚¨éœ€è¦æ›´æ–°æ‚¨çš„ API å¯†é’¥ã€‚</p>
<blockquote>
<p>å¦å¤–ï¼Œå¦‚æœè¿™æ˜¯ä¸€ä¸ªçœŸæ­£çš„ã€é¢å‘å®¢æˆ·ç«¯çš„åº”ç”¨ç¨‹åºï¼Œæ‚¨ä¼šå¸Œæœ›æ¯”è¿™æ›´ä¼˜é›…åœ°å¤„ç†é”™è¯¯ã€‚ä»…ä¾›å‚è€ƒã€‚</p>
</blockquote>
<h2 id="ç¾¤ç»„åˆ†æ">ç¾¤ç»„åˆ†æ</h2>
<p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸ªæ›´å¤æ‚çš„ç¤ºä¾‹ï¼Œä¸ºä»¥ä¸‹é˜Ÿåˆ—åˆ†æç»Ÿè®¡æ•°æ®åˆ›å»ºå›¾è¡¨ï¼š</p>
<table>
<thead>
<tr>
<th>Cohort</th>
<th>2011</th>
<th>2012</th>
<th>2013</th>
<th>2014</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>310</td>
<td>348</td>
<td>228</td>
<td>250</td>
</tr>
<tr>
<td>1</td>
<td>55</td>
<td>157</td>
<td>73</td>
<td>34</td>
</tr>
<tr>
<td>2</td>
<td>18</td>
<td>37</td>
<td>33</td>
<td>34</td>
</tr>
<tr>
<td>3</td>
<td>2</td>
<td>4</td>
<td>4</td>
<td>3</td>
</tr>
</tbody>
</table>
<p>æˆ‘ä»¬å°†åŸºäºåŒä¸€ä¸ªåº”ç”¨ç¨‹åº - app.py è¿›è¡Œæ„å»ºï¼Œä½†åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼šæ‰“å¼€ app.pyï¼Œç„¶åâ€œå¦å­˜ä¸ºâ€cohort.pyã€‚</p>
<p>é¦–å…ˆå‡çº§åˆ°<a href="http://bottlepy.org/docs/dev/stpl.html">ç®€å•æ¨¡æ¿å¼•æ“</a>ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å°†æ ·å¼å’Œ Javascript æ–‡ä»¶æ·»åŠ åˆ°æˆ‘ä»¬çš„æ¨¡æ¿ä¸­ã€‚æ·»åŠ ä¸€ä¸ªåä¸ºâ€œviewsâ€çš„æ–°æ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨è¯¥ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸º template.tpl çš„æ–°æ–‡ä»¶ã€‚å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°è¯¥æ–‡ä»¶ä¸­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;utf-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>{{ title }}<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, initial-scale=1.0&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css&#34;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">media</span><span class="o">=</span><span class="s">&#34;screen&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">body</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">padding</span><span class="p">:</span> <span class="mi">60</span><span class="kt">px</span> <span class="mi">0</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;container&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Graph via Plot.ly<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">form</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;form&#34;</span> <span class="na">method</span><span class="o">=</span><span class="s">&#34;post&#34;</span> <span class="na">action</span><span class="o">=</span><span class="s">&#34;/plot&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>2011<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-group&#34;</span> <span class="err">&#34;</span><span class="na">col-md-2</span><span class="err">&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;Y01&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;Cohort 0&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;Y02&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;Cohort 1&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;Y03&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;Cohort 2&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;Y04&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;Cohort 3&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>2012<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-group&#34;</span> <span class="err">&#34;</span><span class="na">col-md-2</span><span class="err">&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;Y11&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;Cohort 0&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;Y12&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;Cohort 1&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;Y13&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;Cohort 2&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;Y44&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;Cohort 3&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>2013<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-group&#34;</span> <span class="err">&#34;</span><span class="na">col-md-2</span><span class="err">&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;Y21&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;Cohort 0&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;Y22&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;Cohort 1&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;Y23&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;Cohort 2&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;Y24&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;Cohort 3&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>2014<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-group&#34;</span> <span class="err">&#34;</span><span class="na">col-md-2</span><span class="err">&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;Y31&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;Cohort 0&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;Y32&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;Cohort 1&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;Y33&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;Cohort 2&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;number&#34;</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;Y34&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;Cohort 3&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;btn btn-default&#34;</span><span class="p">&gt;</span>Submit<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;http://code.jquery.com/jquery-1.10.2.min.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>æ‚¨å¯èƒ½çŸ¥é“ï¼Œè¿™çœ‹èµ·æ¥å°±åƒä¸€ä¸ª HTML æ–‡ä»¶ã€‚ä¸åŒä¹‹å¤„åœ¨äºæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯­æ³• - <code>{{ python_variable }}</code> å°† Python å˜é‡ä¼ é€’åˆ°æ–‡ä»¶ã€‚</p>
<p>åˆ›å»º data.json æ–‡ä»¶å¹¶æ·»åŠ æ‚¨çš„ Plot.ly ç”¨æˆ·åå’Œ API å¯†é’¥ã€‚æ‚¨å¯ä»¥åœ¨ <a href="https://github.com/mjhea0/bottle-plotly-python/blob/master/bottle/data_sample.json">æ­¤å¤„</a> æŸ¥çœ‹ç¤ºä¾‹æ–‡ä»¶ã€‚</p>
<p>å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ° cohort.py ä¸­ï¼Œä»¥ä¾¿åœ¨æˆ‘ä»¬è¿›è¡Œ API è°ƒç”¨æ—¶è®¿é—® data.json ä»¥ä½¿ç”¨å‡­æ®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">run</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">get</span><span class="p">,</span> <span class="n">post</span><span class="p">,</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">plotly.plotly</span> <span class="k">as</span> <span class="nn">py</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">plotly.graph_objs</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># grab username and key from config/data file</span>
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">config_file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">config_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">username</span> <span class="o">=</span> <span class="n">config_data</span><span class="p">[</span><span class="s2">&#34;user&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">key</span> <span class="o">=</span> <span class="n">config_data</span><span class="p">[</span><span class="s2">&#34;key&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">py</span><span class="o">.</span><span class="n">sign_in</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span></span></code></pre></div><p>ç°åœ¨æˆ‘ä»¬ä¸å¿…å°†æˆ‘ä»¬çš„å¯†é’¥æš´éœ²ç»™æ•´ä¸ªå®‡å®™ã€‚åªè¦ç¡®ä¿ä½¿å…¶ä¸å—ç‰ˆæœ¬æ§åˆ¶å³å¯ã€‚</p>
<p>æ¥ä¸‹æ¥æ›´æ–°åŠŸèƒ½ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">run</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">get</span><span class="p">,</span> <span class="n">post</span><span class="p">,</span> <span class="n">request</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">plotly.plotly</span> <span class="k">as</span> <span class="nn">py</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">plotly.graph_objs</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># grab username and key from config/data file</span>
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">config_file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">config_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">username</span> <span class="o">=</span> <span class="n">config_data</span><span class="p">[</span><span class="s2">&#34;user&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">key</span> <span class="o">=</span> <span class="n">config_data</span><span class="p">[</span><span class="s2">&#34;key&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">py</span><span class="o">.</span><span class="n">sign_in</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@get</span><span class="p">(</span><span class="s1">&#39;/plot&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">form</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">template</span><span class="p">(</span><span class="s1">&#39;template&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Plot.ly Graph&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@post</span><span class="p">(</span><span class="s1">&#39;/plot&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">submit</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># grab data from form</span>
</span></span><span class="line"><span class="cl">    <span class="n">Y01</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">forms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Y01&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Y02</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">forms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Y02&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Y03</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">forms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Y03&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Y04</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">forms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Y04&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Y11</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">forms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Y11&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Y12</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">forms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Y12&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Y13</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">forms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Y13&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Y14</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">forms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Y14&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Y21</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">forms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Y21&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Y22</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">forms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Y22&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Y23</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">forms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Y23&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Y24</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">forms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Y24&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Y31</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">forms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Y31&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Y32</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">forms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Y32&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Y33</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">forms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Y33&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Y34</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">forms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Y34&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">trace1</span> <span class="o">=</span> <span class="n">Scatter</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">Y01</span><span class="p">,</span> <span class="n">Y02</span><span class="p">,</span> <span class="n">Y03</span><span class="p">,</span> <span class="n">Y04</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">trace2</span> <span class="o">=</span> <span class="n">Scatter</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">Y11</span><span class="p">,</span> <span class="n">Y12</span><span class="p">,</span> <span class="n">Y13</span><span class="p">,</span> <span class="n">Y14</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">trace3</span> <span class="o">=</span> <span class="n">Scatter</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">Y21</span><span class="p">,</span> <span class="n">Y22</span><span class="p">,</span> <span class="n">Y23</span><span class="p">,</span> <span class="n">Y24</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">trace4</span> <span class="o">=</span> <span class="n">Scatter</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">Y31</span><span class="p">,</span> <span class="n">Y32</span><span class="p">,</span> <span class="n">Y33</span><span class="p">,</span> <span class="n">Y34</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="n">Data</span><span class="p">([</span><span class="n">trace1</span><span class="p">,</span> <span class="n">trace2</span><span class="p">,</span> <span class="n">trace3</span><span class="p">,</span> <span class="n">trace4</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># api call</span>
</span></span><span class="line"><span class="cl">    <span class="n">plot_url</span> <span class="o">=</span> <span class="n">py</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;basic-line&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">template</span><span class="p">(</span><span class="s1">&#39;template2&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Plot.ly Graph&#39;</span><span class="p">,</span> <span class="n">plot_url</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">plot_url</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PORT&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span></code></pre></div><p>è¯·æ³¨æ„ <code>return</code> å£°æ˜ã€‚æˆ‘ä»¬ä¼ å…¥æ¨¡æ¿çš„åç§°ä»¥åŠä»»ä½•å˜é‡ã€‚è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º template2.tpl çš„æ–°æ¨¡æ¿ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;utf-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>{{ title }}<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, initial-scale=1.0&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css&#34;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">media</span><span class="o">=</span><span class="s">&#34;screen&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">body</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">padding</span><span class="p">:</span> <span class="mi">60</span><span class="kt">px</span> <span class="mi">0</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;container&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Graph via Plot.ly<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;/plot&#34;</span><span class="p">&gt;&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;btn btn-default&#34;</span><span class="p">&gt;</span>Back<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">iframe</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;igraph&#34;</span> <span class="na">src</span><span class="o">=</span><span class="s">{{plot_url}}</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;900&#34;</span> <span class="na">height</span><span class="o">=</span><span class="s">&#34;450&#34;</span> <span class="na">seamless</span><span class="o">=</span><span class="s">&#34;seamless&#34;</span> <span class="na">scrolling</span><span class="o">=</span><span class="s">&#34;no&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">iframe</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;http://code.jquery.com/jquery-1.10.2.min.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>å› æ­¤ï¼Œiframe å…è®¸æˆ‘ä»¬æ›´æ–°è¡¨å•ï¼Œç„¶åæ˜¾ç¤ºå®é™…å†…å®¹/å›¾è¡¨ä»¥åŠæ›´æ–°åçš„æ›´æ”¹ã€‚æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬ä¸å¿…ç¦»å¼€ç«™ç‚¹å³å¯æŸ¥çœ‹å›¾è¡¨ã€‚</p>
<p>è¿è¡Œã€‚å°†å€¼æ·»åŠ åˆ°è¡¨å•ä¸­ã€‚ç„¶åæäº¤ã€‚æ‚¨çš„å›¾è¡¨ç°åœ¨åº”å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img loading="lazy" src="https://files.realpython.com/media/plotly-final-graph.4c43b1ac0563.png" alt="Plotly example final graph"  />
</p>
<h2 id="ç»“è®º">ç»“è®º</h2>
<p>æ‚¨å¯ä»¥ä»æ­¤<a href="https://github.com/mjhea0/bottle-plotly-python">å­˜å‚¨åº“</a>ä¸­è·å–æ‰€æœ‰æ–‡ä»¶ã€‚</p>
<p>ä¸‹æ¬¡è§ï¼</p>
<p>åŸæ–‡é“¾æ¥ï¼š</p>
<ul>
<li><a href="https://realpython.com/developing-with-bottle-part-1/">https://realpython.com/developing-with-bottle-part-1/</a></li>
<li><a href="https://realpython.com/developing-with-bottle-part-2-plot-ly-api">https://realpython.com/developing-with-bottle-part-2-plot-ly-api</a></li>
</ul>
]]></content:encoded>
    </item>
    
    <item>
      <title>å‘¨æŠ¥-24ï½œå¦‚æœæ²¡æœ‰ç–¼ç—›</title>
      <link>https://blog.chensoul.com/posts/2023/06/21/weekly_review_24/</link>
      <pubDate>Wed, 21 Jun 2023 17:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/06/21/weekly_review_24/</guid>
      <description>å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-06-12 åˆ° 2023-06-18 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚ è¯»ä¹¦ã€å¥èº«ã€æŠ•èµ„ã€å¸®æœ‹å‹ã€é™ªå®¶äººã€‚ è¯»ä¹¦ æœ¬å‘¨å°šæœªè¯»</description>
      <content:encoded><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p>æœ¬ç¯‡æ˜¯å¯¹ <code>2023-06-12</code> åˆ° <code>2023-06-18</code> è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº <a href="https://blog.chensoul.com/">åšå®¢</a>ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚</p>
<blockquote>
<p>è¯»ä¹¦ã€å¥èº«ã€æŠ•èµ„ã€å¸®æœ‹å‹ã€é™ªå®¶äººã€‚</p>
</blockquote>
<h2 id="è¯»ä¹¦">è¯»ä¹¦</h2>
<p>æœ¬å‘¨å°šæœªè¯»ä¹¦ã€‚</p>
<h2 id="å¥èº«">å¥èº«</h2>
<blockquote>
<p>æˆ‘è·‘è¿‡äº†ä¸€äº›åœ°æ–¹ï¼Œå¸Œæœ›éšç€æ—¶é—´æ¨ç§»ï¼Œåœ°å›¾ç‚¹äº®çš„åœ°æ–¹è¶Šæ¥è¶Šå¤šã€‚2 å¹´é‡Œæˆ‘è·‘è¿‡ 2ä¸ªçœä»½ 2ä¸ªåŸå¸‚ã€‚æ›´å¤šè·‘æ­¥æ•°æ®åœ¨æˆ‘çš„ <a href="https://run.chensoul.com/">è·‘æ­¥</a> ä¸»é¡µã€‚</p>
</blockquote>
<p>æœ¬å‘¨å°šæœªè·‘æ­¥ã€‚</p>
<h2 id="ç†è´¢">ç†è´¢</h2>
<p>è¿™å‘¨æ€»è®¡æ”¯å‡º 1264 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>6æœˆ18æ—¥ï¼š338å…ƒ</p>
</li>
<li>
<p>6æœˆ17æ—¥ï¼š508å…ƒ</p>
</li>
<li>
<p>6æœˆ16æ—¥ï¼š262å…ƒ</p>
</li>
<li>
<p>6æœˆ15æ—¥ï¼š27å…ƒ</p>
</li>
<li>
<p>6æœˆ14æ—¥ï¼š41å…ƒ</p>
</li>
<li>
<p>6æœˆ13æ—¥ï¼š40å…ƒ</p>
</li>
<li>
<p>6æœˆ12æ—¥ï¼š48å…ƒ</p>
</li>
</ul>
<h2 id="é™ªå®¶äºº">é™ªå®¶äºº</h2>
<p>æœ¬å‘¨å› ä¸ºè€çˆ¸å‡ºé™¢åéœ€è¦äººç…§æ–™ï¼Œæ‰€ä»¥æˆ‘æ¯å¤©æ—©æ™šå¾€è¿”äºå®¶ï¼ˆé˜³é€»ï¼‰å’Œå…¬å¸ï¼ˆå…‰è°·ï¼‰ä¹‹é—´ã€‚æ¯å¤©æ—©ä¸Šäº”ç‚¹å¤šå°±é†’äº†ï¼Œç„¶åç…®ç²¥ã€æ‹›å‘¼è€çˆ¸åƒé¥­å–è¯ï¼Œå…­ç‚¹åŠå‡ºé—¨å¼€è½¦èµ°ä¸‰ç¯å»ä¸Šç­ã€‚è¿™å‘¨è¯·å©¶å¨˜ç™½å¤©å¸®å¿™ç…§é¡¾è€çˆ¸ï¼Œä¸»è¦æ˜¯ä¸­åˆå’Œæ™šä¸Šè€çˆ¸è¦åƒé¥­å’Œå–è¯ã€‚æˆ‘æ—©ä¸Šå‡ºé—¨æ™šã€æ™šä¸Šä¸‹ç­å›æ¥å†ç…§é¡¾è€çˆ¸ã€‚è€çˆ¸èƒƒæºƒç–¡ï¼Œéœ€è¦ä¿®å…»ä¸€ä¸ªå¤šæœˆï¼Œå¦å¤–æœ€è¿‘ç—›é£å‘ä½œï¼Œèº«ä½“å¤šå¤„å…³èŠ‚ç–¼ç—›ã€‚å› ä¸ºåƒè¥¿è¯å’Œæ‰“é’ˆéƒ½ä¼šä¼¤èƒƒï¼Œæ‰€ä»¥åªèƒ½åƒä¸­è¯ã€‚ä¸­è¯è§æ•ˆæ…¢ï¼Œéœ€è¦æ—¶é—´ã€‚è€Œå©¶å¨˜èº«ä¸Šä¹Ÿæœ‰ç—…ï¼Œä¸èƒ½é•¿æœŸç…§é¡¾ï¼Œå¦‚æœè€çˆ¸è¿™å‘¨ç—›é£ä¸èƒ½æ¢å¤ï¼Œé‚£ä¸‹å‘¨åªèƒ½è€å©†æ”¾ä¸‹æ‰‹ä¸Šå·¥ä½œå›æ¥ç…§é¡¾è€çˆ¸ã€‚è€å©†å·¥ä½œä¹Ÿæ˜¯éå¸¸å¿™ç¢Œï¼Œä¹Ÿä¸èƒ½ç…§é¡¾å¤ªä¹…ï¼Œä¼°è®¡ä¹Ÿå°±ä¸€ä¸ªæ˜ŸæœŸã€‚å¦‚æœè¿‡äº†ä¸€ä¸ªæ˜ŸæœŸï¼Œè€çˆ¸è¿˜æ˜¯ä¸èƒ½æ¢å¤ã€ä¸èƒ½ç”Ÿæ´»è‡ªç†ï¼ŒçœŸä¸çŸ¥é“è¯¥æ€ä¹ˆåŠäº†ï¼å¾ˆä¹…ä¹‹å‰å°±æƒ³åˆ°è€çˆ¸å¯èƒ½ä¼šæˆä¸ºæˆ‘çš„è´Ÿæ‹…ï¼Œå½±å“æˆ‘çš„å·¥ä½œï¼Œæ²¡æœ‰æƒ³åˆ°ä¼šæ¥çš„è¿™ä¹ˆå¿«ã€‚æœ‰æ—¶å€™æƒ³æŠ±æ€¨ï¼Œä½†æŠ±æ€¨æœ‰ä»€ä¹ˆç”¨ï¼Ÿé¢å¯¹çœ¼å‰çš„è¿™ä¸€åˆ‡ï¼Œåªèƒ½è¿éš¾é¢å¯¹ã€‚é€ æˆçœ¼å‰è¿™æ ·çš„ç°çŠ¶ï¼Œæˆ‘è‡ªå·±æœ‰ä¸€éƒ¨åˆ†è´£ä»»ã€‚éƒ½åªæ€ªæˆ‘å¹³æ—¶æ²¡æœ‰å…³å¿ƒè€çˆ¸ï¼Œæ²¡æœ‰å®å˜±è€çˆ¸ä¸è¦å–é…’ï¼Œåœ¨è€çˆ¸èº«è¾¹é™ªä¼´çš„æ—¶é—´å¤ªå°‘äº†ã€‚</p>
<p>å‘¨å…­å»ç»™å²³çˆ¶å²³æ¯é€ç«¯åˆèŠ‚ï¼Œå‘¨æ—¥å›å»çœ‹æœ›ç™Œç—‡è½¬ç§»åˆ°å…¨èº«çš„å…­èˆ…ã€‚å…­èˆ…æ˜¯ä¹³è…ºç™Œï¼Œåœ¨ç»å†äº†å»å¹´æ–°å† ç–«æƒ…ä¹‹åï¼Œç™Œç»†èƒè½¬ç§»åˆ°è‚ºéƒ¨ã€‚å¹´åæ²¡æœ‰å¼•èµ·è¶³å¤Ÿçš„é‡è§†ï¼Œç›´åˆ°ç—›çš„ä¸è¡Œçš„æ—¶å€™æ‰å»åŒ»é™¢åšæ‰‹æœ¯ï¼Œé”™è¿‡äº†æœ€ä½³æ²»ç–—æ—¶æœºã€‚ä¸Šä¸€æ¬¡è§åˆ°å…­èˆ…è¿˜æ˜¯å››æœˆä»½çš„æ—¶å€™ï¼Œæˆ‘å¼€è½¦å¸¦è€å©†ä¸€èµ·å›å»çœ‹æœ›è€çˆ¸ã€‚é‚£æ—¶å€™å…­èˆ…è¿˜åœ¨èœå›­é‡Œé¢æœé»„åœŸèƒŒæœå¤©ï¼Œå…­èˆ…ç»™äº†æˆ‘ä¸€äº›è´ç¬‹ã€åŒ…èœï¼Œè€å©†ç»™å…­èˆ…3ç™¾å—é’±ï¼Œå…­èˆ…ç¡¬æ˜¯ä¸è¦ï¼Œæ‹‰æ‰¯äº†åŠå¤©ã€‚èµ°ä¹‹å‰ï¼Œå…­èˆ…è¿˜å«ä½•èˆ…å¡äº†20å¤šä¸ªé¸¡è›‹ç»™æˆ‘ä»¬ã€‚è¿™æ¬¡ï¼Œå†è§å…­èˆ…ï¼Œå…­èˆ…èººåœ¨åºŠä¸Šå…¨èº«ç–¼ç—›ï¼Œåªèƒ½åƒäº›æµé£Ÿï¼Œæ„è¯†æ¨¡ç³Šï¼ŒçŸ¥é“è°æ¥çœ‹æœ›å¥¹ï¼Œå´ä¸èƒ½è¯´è¯ã€‚æ¯æ¬¡å¼€è½¦ä¸Šä¸‹ç­çš„æ—¶å€™ï¼Œæƒ³èµ·å…­èˆ…è¿™æ ·å­ï¼Œå¿ƒé‡Œå°±å¾ˆéš¾å—ï¼Œçœ¼æ³ªç›´æ‰“è½¬ã€‚é¢å¯¹ç”Ÿè€ç—…æ­»ï¼Œæˆå¹´äººçš„å´©æºƒåªåœ¨ä¸€ç¬é—´ã€‚æ˜¨æ—¥è¿˜åœ¨ä½ é¢å‰æ··è¹¦ä¹±è·³çš„äººï¼Œæ˜å¤©å¯èƒ½å°±ä¸åœ¨äº†ã€‚ä¸ºäº†ä¸ç•™é—æ†¾ï¼Œè¦å–„å¾…èº«è¾¹çš„æ¯ä¸€ä½äº²äººï¼Œå¸¸å›å®¶çœ‹çœ‹ã€‚æ„Ÿè°¢è€å©†æ€»æ˜¯æé†’æˆ‘è¦å›å®¶çœ‹æœ›è€çˆ¸ï¼Œæ­£æ˜¯å› ä¸ºè¿™ä¸ªï¼Œæ¯æ¬¡å›å®¶çœ‹æœ›è€çˆ¸çš„æ—¶å€™ï¼Œæˆ‘éƒ½ä¼šå»çœ‹ä¸‹å…­èˆ…ã€‚</p>
<p>å¦‚æœæ²¡æœ‰ç–¼ç—›ï¼Œè€çˆ¸å’Œå…­èˆ…å°±ä¸ä¼šç—›è‹¦äº†ï¼Œèº«è¾¹çš„äººä¹Ÿå°±ä¸ä¼šå¿ƒç—›ã€‚</p>
<h2 id="å·¥ä½œ">å·¥ä½œ</h2>
<p>æœ€è¿‘åœ¨å­¦ä¹ çš„å†…å®¹æ¸…å•ï¼š</p>
<ul>
<li><a href="https://github.com/clxering/Effective-Java-3rd-edition-Chinese-English-bilingual/tree/dev">Effective Javaï¼ˆç¬¬ 3 ç‰ˆï¼‰</a></li>
<li><a href="https://java-design-patterns.com/zh/">Java Design Patterns (ä¸­æ–‡)</a></li>
<li><a href="https://realpython.com/">Real Python</a></li>
</ul>
<p>æœ¬å‘¨å®Œæˆå››ç¯‡åšå®¢ï¼š</p>
<ul>
<li>
<p><a href="/posts/2023/06/21/modern-css-explained-for-dinosaurs/">[è¯‘]ä¸ºæé¾™è§£é‡Šç°ä»£CSS</a></p>
</li>
<li>
<p><a href="/posts/2023/06/20/modern-html-explained-for-dinosaurs/">[è¯‘]ä¸ºæé¾™è§£é‡Šç°ä»£HTML</a></p>
</li>
<li>
<p><a href="/posts/2023/06/19/modern-javascript-explained-for-dinosaurs/">[è¯‘]ä¸ºæé¾™è§£é‡Šç°ä»£JavaScript</a></p>
</li>
<li>
<p><a href="/posts/2023/06/15/minimize-the-accessibility-of-classes-and-members/">ã€ŠEffective Java 3ã€‹ç¬”è®°15ï¼šå°½é‡å‡å°‘ç±»å’Œæˆå‘˜çš„å¯è®¿é—®æ€§</a></p>
</li>
</ul>
<h2 id="æœ¬å‘¨åˆ†äº«">æœ¬å‘¨åˆ†äº«</h2>
<p>å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€<a href="https://t.me/chensoul_share">ChenSoul Share</a>ã€Telegram é¢‘é“æˆ–è€…æˆ‘çš„ <a href="https://memos.chensoul.com/">Memos</a> ä¸­ã€‚æˆ‘å†™äº†ä¸€ä¸ª Python è„šæœ¬ä» Memos è¯»å–æœ€è¿‘ä¸€å‘¨å¸¦æœ‰ <code>#memos</code> æ ‡ç­¾çš„è®°å½•ï¼Œåˆ†äº«åˆ°è¿™é‡Œã€‚</p>
<ul>
<li>ğŸ“Œ<code>2023-06-14</code> ç°ä»£ JavaScript æ•™ç¨‹ï¼Œä»¥æœ€æ–°çš„ JavaScript æ ‡å‡†ä¸ºåŸºå‡†ã€‚é€šè¿‡ç®€å•ä½†è¶³å¤Ÿè¯¦ç»†çš„å†…å®¹ï¼Œä¸ºä½ è®²è§£ä»åŸºç¡€åˆ°é«˜é˜¶çš„ JavaScript ç›¸å…³çŸ¥è¯†ã€‚ <a href="https://zh.javascript.info/">https://zh.javascript.info/</a>  <code>#memos</code> <code>#javascript</code></li>
<li>ğŸ“Œ<code>2023-06-14</code> æ¨èå‡ ä¸ªè¿œç¨‹åŠå…¬æ‹›è˜ç½‘ç«™ï¼Œå›½å¤–çš„ <a href="https://nomadlist.com/">https://nomadlist.com/</a> <a href="https://remotive.com/">https://remotive.com/</a> <a href="https://remoteok.com/">https://remoteok.com/</a> <a href="https://www.huntsbot.com/">https://www.huntsbot.com/</a> <a href="https://www.freelancer.cn/jobs">https://www.freelancer.cn/jobs</a>  <code>#memos</code></li>
<li>ğŸ“Œ<code>2023-06-14</code> æ‹’ç» 996ï¼Œè°ˆè°ˆè¿œç¨‹åŠå…¬ä¸€å¹´å¤šçš„æ„Ÿå—  <a href="https://www.v2ex.com/t/947355">https://www.v2ex.com/t/947355</a>    <code>#memos</code></li>
<li>ğŸ“Œ<code>2023-06-14</code> æ–°æ‰‹å…¥é—¨Pythonè¯¥å¦‚ä½•å­¦ï¼Œå­¦ä»€ä¹ˆï¼Œå­¦å¤šä¹…ï¼Ÿçœ‹å®Œè¿™äº›ä½ å°±æ˜ç™½äº†<code>#memos</code> <code>#python</code> <a href="https://blog.csdn.net/libaiup/article/details/131083707">https://blog.csdn.net/libaiup/article/details/131083707</a></li>
</ul>
<p>ä»¥ä¸Šã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>[è¯‘]ä¸ºæé¾™è§£é‡Šç°ä»£CSS</title>
      <link>https://blog.chensoul.com/posts/2023/06/21/modern-css-explained-for-dinosaurs/</link>
      <pubDate>Wed, 21 Jun 2023 09:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/06/21/modern-css-explained-for-dinosaurs/</guid>
      <description>å¥‡æ€ªçš„æ˜¯ï¼ŒCSS è¢«è®¤ä¸ºæ˜¯ä½œä¸º Web å¼€å‘äººå‘˜æœ€å®¹æ˜“å­¦ä¹ å’Œæœ€éš¾å­¦ä¹ çš„è¯­è¨€ä¹‹ä¸€ã€‚å¼€å§‹ä½¿ç”¨å®ƒå½“ç„¶å¾ˆå®¹æ˜“ - æ‚¨å¯ä»¥å®šä¹‰æ ·å¼å±æ€§å’Œå€¼ä»¥åº”ç”¨äºç‰¹å®šå…ƒç´ ï¼Œç„¶å&amp;h</description>
      <content:encoded><![CDATA[<p><img loading="lazy" src="https://peterxjang.com/img/1__kXsiGLMHSS4jUx4W6yBOlw.png" alt="Dinosaur comic panel 1"  />
</p>
<p>å¥‡æ€ªçš„æ˜¯ï¼ŒCSS è¢«è®¤ä¸ºæ˜¯ä½œä¸º Web å¼€å‘äººå‘˜æœ€å®¹æ˜“å­¦ä¹ å’Œæœ€éš¾å­¦ä¹ çš„è¯­è¨€ä¹‹ä¸€ã€‚å¼€å§‹ä½¿ç”¨å®ƒå½“ç„¶å¾ˆå®¹æ˜“ - æ‚¨å¯ä»¥å®šä¹‰æ ·å¼å±æ€§å’Œå€¼ä»¥åº”ç”¨äºç‰¹å®šå…ƒç´ ï¼Œç„¶å&hellip;&hellip;è¿™å‡ ä¹å°±æ˜¯æ‚¨å¼€å§‹æ‰€éœ€çš„ä¸€åˆ‡ï¼ä½†æ˜¯ï¼Œå¯¹äºå¤§å‹é¡¹ç›®ï¼Œä»¥æœ‰æ„ä¹‰çš„æ–¹å¼ç»„ç»‡ CSS ä¼šå˜å¾—çº ç»“å’Œå¤æ‚ã€‚æ›´æ”¹ä»»ä½•ä¸€è¡Œ CSS ä»¥è®¾ç½®ä¸€ä¸ªé¡µé¢ä¸Šå…ƒç´ çš„æ ·å¼é€šå¸¸ä¼šå¯¼è‡´å…¶ä»–é¡µé¢ä¸Šçš„å…ƒç´ å‘ç”Ÿæ„å¤–æ›´æ”¹ã€‚</p>
<p>ä¸ºäº†å¤„ç† CSS å›ºæœ‰çš„å¤æ‚æ€§ï¼Œå·²ç»å»ºç«‹äº†å„ç§ä¸åŒçš„æœ€ä½³å®è·µã€‚é—®é¢˜åœ¨äºï¼Œå¯¹äºå“ªäº›æœ€ä½³å®è·µå®é™…ä¸Šæ˜¯æœ€å¥½çš„ï¼Œæ²¡æœ‰ä»»ä½•å¼ºçƒˆçš„å…±è¯†ï¼Œå…¶ä¸­è®¸å¤šä¼¼ä¹å®Œå…¨ç›¸äº’çŸ›ç›¾ã€‚å¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡å°è¯•å­¦ä¹  CSSï¼Œè‡³å°‘å¯ä»¥è¯´è¿™å¯èƒ½ä¼šè®©äººè¿·å¤±æ–¹å‘ã€‚</p>
<p>æœ¬æ–‡çš„ç›®çš„æ˜¯æä¾›ä¸€ä¸ªå†å²èƒŒæ™¯ï¼Œè¯´æ˜ CSS æ–¹æ³•å’Œå·¥å…·å¦‚ä½•åœ¨ 2018 å¹´å‘å±•åˆ°ä»Šå¤©çš„æ ·å­ã€‚é€šè¿‡äº†è§£è¿™æ®µå†å²ï¼Œå°†æ›´å®¹æ˜“ç†è§£æ¯ç§æ–¹æ³•ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒä»¬æ¥ä¸ºæ‚¨å¸¦æ¥å¥½å¤„ã€‚è®©æˆ‘ä»¬å¼€å§‹å§ï¼</p>
<blockquote>
<p>æ›´æ–°ï¼šæˆ‘åˆ¶ä½œäº†æœ¬æ–‡çš„æ–°è§†é¢‘è¯¾ç¨‹ç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬æ›´æ·±å…¥åœ°ä»‹ç»äº†ææ–™ï¼Œè¯·åœ¨æ­¤å¤„æŸ¥çœ‹ï¼š
<a href="https://firstclass.actualize.co/p/modern-css-explained-for-dinosaurs">https://firstclass.actualize.co/p/modern-css-explained-for-dinosaurs</a></p>
</blockquote>
<h3 id="ä½¿ç”¨-css-è¿›è¡ŒåŸºæœ¬æ ·å¼è®¾ç½®">ä½¿ç”¨ CSS è¿›è¡ŒåŸºæœ¬æ ·å¼è®¾ç½®</h3>
<p>è®©æˆ‘ä»¬ä»ä¸€ä¸ªåŸºæœ¬ç½‘ç«™å¼€å§‹ï¼Œä»…ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ <code>index.html</code> æ–‡ä»¶é“¾æ¥åˆ°ä¸€ä¸ªå•ç‹¬çš„ <code>index.css</code> æ–‡ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Modern CSS<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;index.css&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">header</span><span class="p">&gt;</span>This is the header.<span class="p">&lt;/</span><span class="nt">header</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">main</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>This is the main content.<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>...<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">main</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">nav</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">h4</span><span class="p">&gt;</span>This is the navigation section.<span class="p">&lt;/</span><span class="nt">h4</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>...<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">aside</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">h4</span><span class="p">&gt;</span>This is an aside section.<span class="p">&lt;/</span><span class="nt">h4</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>...<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">aside</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">footer</span><span class="p">&gt;</span>This is the footer.<span class="p">&lt;/</span><span class="nt">footer</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>ç°åœ¨æˆ‘ä»¬åœ¨ HTML ä¸­æ²¡æœ‰ä½¿ç”¨ä»»ä½•ç±»æˆ– IDï¼Œåªæ˜¯ <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element#Content_sectioning">è¯­ä¹‰æ ‡ç­¾</a>ã€‚æ²¡æœ‰ä»»ä½• CSSï¼Œç½‘ç«™çœ‹èµ·æ¥åƒè¿™æ ·ï¼ˆä½¿ç”¨å ä½ç¬¦æ–‡æœ¬ï¼‰ï¼š</p>
<p><img loading="lazy" src="https://peterxjang.com/img/1__MwOy9E5LacvhGEtIUb9pXQ.png" alt="Example webpage without styling"  />
</p>
<p>åŠŸèƒ½é½å…¨ï¼Œä½†ä¸æ˜¯å¾ˆæ¼‚äº®ã€‚æˆ‘ä»¬å¯ä»¥æ·»åŠ  CSS æ¥æ”¹è¿› <code>index.css</code> ä¸­çš„åŸºæœ¬æ’ç‰ˆï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-css" data-lang="css"><span class="line"><span class="cl"><span class="c">/* BASIC TYPOGRAPHY                       */</span>  
</span></span><span class="line"><span class="cl"><span class="c">/* from https://github.com/oxalorg/sakura */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">html</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">font-size</span><span class="p">:</span> <span class="mf">62.5</span><span class="kt">%</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">font-family</span><span class="p">:</span> <span class="kc">serif</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">body</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">font-size</span><span class="p">:</span> <span class="mf">1.8</span><span class="kt">rem</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">line-height</span><span class="p">:</span> <span class="mf">1.618</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">max-width</span><span class="p">:</span> <span class="mi">38</span><span class="kt">em</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">margin</span><span class="p">:</span> <span class="kc">auto</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">color</span><span class="p">:</span> <span class="mh">#4a4a4a</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">background-color</span><span class="p">:</span> <span class="mh">#f9f9f9</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">padding</span><span class="p">:</span> <span class="mi">13</span><span class="kt">px</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">@</span><span class="k">media</span> <span class="o">(</span><span class="nt">max-width</span><span class="o">:</span> <span class="nt">684px</span><span class="o">)</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">body</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="k">font-size</span><span class="p">:</span> <span class="mf">1.53</span><span class="kt">rem</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">}</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">@</span><span class="k">media</span> <span class="o">(</span><span class="nt">max-width</span><span class="o">:</span> <span class="nt">382px</span><span class="o">)</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">body</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="k">font-size</span><span class="p">:</span> <span class="mf">1.35</span><span class="kt">rem</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">}</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">h1</span><span class="o">,</span> <span class="nt">h2</span><span class="o">,</span> <span class="nt">h3</span><span class="o">,</span> <span class="nt">h4</span><span class="o">,</span> <span class="nt">h5</span><span class="o">,</span> <span class="nt">h6</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">line-height</span><span class="p">:</span> <span class="mf">1.1</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">font-family</span><span class="p">:</span> <span class="n">Verdana</span><span class="p">,</span> <span class="n">Geneva</span><span class="p">,</span> <span class="kc">sans-serif</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">font-weight</span><span class="p">:</span> <span class="mi">700</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">overflow-wrap</span><span class="p">:</span> <span class="kc">break-word</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">word-wrap</span><span class="p">:</span> <span class="kc">break-word</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="kp">-ms-</span><span class="k">word-break</span><span class="p">:</span> <span class="n">break-all</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">word-break</span><span class="p">:</span> <span class="kc">break-word</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="kp">-ms-</span><span class="k">hyphens</span><span class="p">:</span> <span class="kc">auto</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="kp">-moz-</span><span class="k">hyphens</span><span class="p">:</span> <span class="kc">auto</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="kp">-webkit-</span><span class="k">hyphens</span><span class="p">:</span> <span class="kc">auto</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">hyphens</span><span class="p">:</span> <span class="kc">auto</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">h1</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">font-size</span><span class="p">:</span> <span class="mf">2.35</span><span class="kt">em</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">h2</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">font-size</span><span class="p">:</span> <span class="mi">2</span><span class="kt">em</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">h3</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">font-size</span><span class="p">:</span> <span class="mf">1.75</span><span class="kt">em</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">h4</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">font-size</span><span class="p">:</span> <span class="mf">1.5</span><span class="kt">em</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">h5</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">font-size</span><span class="p">:</span> <span class="mf">1.25</span><span class="kt">em</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">h6</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">font-size</span><span class="p">:</span> <span class="mi">1</span><span class="kt">em</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>åœ¨è¿™é‡Œï¼Œå¤§å¤šæ•° CSS éƒ½æ˜¯æ ·å¼æ’ç‰ˆï¼ˆå…·æœ‰å¤§å°ï¼Œè¡Œé«˜ç­‰çš„å­—ä½“ï¼‰ï¼Œå¹¶å¸¦æœ‰ä¸€äº›é¢œè‰²æ ·å¼å’Œå±…ä¸­å¸ƒå±€ã€‚ä½ å¿…é¡»ç ”ç©¶è®¾è®¡æ‰èƒ½çŸ¥é“è¦ä¸ºæ¯ä¸ªå±æ€§é€‰æ‹©çš„å¥½å€¼ï¼ˆè¿™äº›æ ·å¼æ¥è‡ª <a href="https://github.com/oxalorg/sakura">sakura.css</a>ï¼‰ï¼Œä½†è¿™é‡Œåº”ç”¨çš„ CSS æœ¬èº«å¹¶ä¸å¤ªå¤æ‚ã€‚ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img loading="lazy" src="https://peterxjang.com/img/1____rykiEopx6MCsnOAAcT8MA.png" alt="Example webpage with basic typography styling"  />
</p>
<p>å¦‚æ­¤ä¸åŒï¼è¿™å°±æ˜¯ CSS çš„æ‰¿è¯º - ä¸€ç§å‘æ–‡æ¡£æ·»åŠ æ ·å¼çš„ç®€å•æ–¹æ³•ï¼Œæ— éœ€ç¼–ç¨‹æˆ–å¤æ‚çš„é€»è¾‘ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ CSS ä¸ä»…ä»…æ˜¯æ’ç‰ˆå’Œé¢œè‰²æ—¶ï¼Œäº‹æƒ…å¼€å§‹å˜å¾—æ›´åŠ æ¯›èŒ¸èŒ¸ï¼ˆæˆ‘ä»¬å°†åœ¨ä¸‹é¢è§£å†³ï¼‰ã€‚</p>
<h3 id="ä½¿ç”¨-css-è¿›è¡Œå¸ƒå±€">ä½¿ç”¨ CSS è¿›è¡Œå¸ƒå±€</h3>
<p>åœ¨ 1990 å¹´ä»£ï¼Œåœ¨ CSS è¢«å¹¿æ³›é‡‡ç”¨ä¹‹å‰ï¼Œåœ¨é¡µé¢ä¸Šå¸ƒå±€å†…å®¹çš„é€‰é¡¹å¹¶ä¸å¤šã€‚HTML æœ€åˆè¢«è®¾è®¡ä¸ºä¸€ç§åˆ›å»ºæ™®é€šæ–‡æ¡£çš„è¯­è¨€ï¼Œè€Œä¸æ˜¯å¸¦æœ‰ä¾§è¾¹æ ï¼Œåˆ—ç­‰çš„åŠ¨æ€ç½‘ç«™ã€‚åœ¨æ—©æœŸï¼Œå¸ƒå±€é€šå¸¸ä½¿ç”¨ HTML è¡¨æ ¼å®Œæˆâ€”â€”æ•´ä¸ªç½‘é¡µå°†ä½äºä¸€ä¸ªè¡¨æ ¼ä¸­ï¼Œå¯ç”¨äºåœ¨è¡Œå’Œåˆ—ä¸­ç»„ç»‡å†…å®¹ã€‚è¿™ç§æ–¹æ³•å¥æ•ˆäº†ï¼Œä½†ç¼ºç‚¹æ˜¯å†…å®¹å’Œå‘ˆç°çš„ç´§å¯†è€¦åˆâ€”â€”å¦‚æœä½ æƒ³æ”¹å˜ç½‘ç«™çš„å¸ƒå±€ï¼Œå°±éœ€è¦é‡å†™å¤§é‡çš„ HTMLã€‚</p>
<p>ä¸€æ—¦ CSS è¿›å…¥åœºæ™¯ï¼Œå°±å¼ºçƒˆæ¨åŠ¨å°†å†…å®¹ï¼ˆç”¨ HTML ç¼–å†™ï¼‰ä¸æ¼”ç¤ºï¼ˆç”¨ CSS ç¼–å†™ï¼‰åˆ†å¼€ã€‚å› æ­¤ï¼Œäººä»¬æ‰¾åˆ°äº†å°†æ‰€æœ‰å¸ƒå±€ä»£ç ä» HTMLï¼ˆä¸å†æœ‰è¡¨æ ¼ï¼‰ç§»åŠ¨åˆ° CSS ä¸­çš„æ–¹æ³•ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ HTML ä¸€æ ·ï¼ŒCSS ä¹Ÿä¸æ˜¯çœŸæ­£è®¾è®¡ä¸ºåœ¨é¡µé¢ä¸Šå¸ƒå±€å†…å®¹ï¼Œå› æ­¤æ—©æœŸå°è¯•è¿™ç§å…³æ³¨ç‚¹åˆ†ç¦»å¾ˆéš¾ä¼˜é›…åœ°å®ç°ã€‚</p>
<p>è®©æˆ‘ä»¬é€šè¿‡ä¸Šé¢çš„ä¾‹å­æ¥çœ‹çœ‹è¿™åœ¨å®è·µä¸­æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚åœ¨æˆ‘ä»¬å®šä¹‰ä»»ä½• CSS å¸ƒå±€ä¹‹å‰ï¼Œæˆ‘ä»¬å°†é¦–å…ˆé‡ç½®ä»»ä½•è¾¹è·å’Œå¡«å……ï¼ˆè¿™ä¼šå½±å“å¸ƒå±€è®¡ç®—ï¼‰ï¼Œå¹¶ä¸ºéƒ¨åˆ†æä¾›ä¸åŒçš„é¢œè‰²ï¼ˆä¸æ˜¯ä¸ºäº†è®©å®ƒæ¼‚äº®ï¼Œè€Œæ˜¯ä¸ºäº†è®©æ¯ä¸ªéƒ¨åˆ†åœ¨æµ‹è¯•ä¸åŒçš„å¸ƒå±€æ—¶åœ¨è§†è§‰ä¸Šè„±é¢–è€Œå‡ºï¼‰ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-css" data-lang="css"><span class="line"><span class="cl"><span class="c">/* RESET LAYOUT AND ADD COLORS */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">body</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">margin</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">max-width</span><span class="p">:</span> <span class="kc">inherit</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">background</span><span class="p">:</span> <span class="mh">#fff</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">color</span><span class="p">:</span> <span class="mh">#4a4a4a</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">header</span><span class="o">,</span> <span class="nt">footer</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">font-size</span><span class="p">:</span> <span class="kc">large</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">text-align</span><span class="p">:</span> <span class="kc">center</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">padding</span><span class="p">:</span> <span class="mf">0.3</span><span class="kt">em</span> <span class="mi">0</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">background-color</span><span class="p">:</span> <span class="mh">#4a4a4a</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">color</span><span class="p">:</span> <span class="mh">#f9f9f9</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">nav</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">background</span><span class="p">:</span> <span class="mh">#eee</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">main</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">background</span><span class="p">:</span> <span class="mh">#f9f9f9</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">aside</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">background</span><span class="p">:</span> <span class="mh">#eee</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>ç°åœ¨ç½‘ç«™æš‚æ—¶çœ‹èµ·æ¥åƒï¼š</p>
<p><img loading="lazy" src="https://peterxjang.com/img/1__Ii8mtqbLaS5GIB3VJTpqSw.png" alt="Example website with css reset"  />
</p>
<center>å•å‡»<a href='https://codepen.io/peterxjang/pen/jZWzEV?editors=1100'>æ­¤å¤„</a>æŸ¥çœ‹å®æ—¶ç¤ºä¾‹</center>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²å‡†å¤‡å¥½ä½¿ç”¨ CSS åœ¨é¡µé¢ä¸Šå¸ƒå±€å†…å®¹ã€‚æˆ‘ä»¬å°†æŒ‰æ—¶é—´é¡ºåºä»‹ç»ä¸‰ç§ä¸åŒçš„æ–¹æ³•ï¼Œä»ç»å…¸çš„åŸºäº float çš„å¸ƒå±€å¼€å§‹ã€‚</p>
<h4 id="åŸºäº-float-çš„å¸ƒå±€">åŸºäº float çš„å¸ƒå±€</h4>
<p>CSS float å±æ€§æœ€åˆæ˜¯ä¸ºäº†åœ¨å·¦ä¾§æˆ–å³ä¾§çš„æ–‡æœ¬åˆ—å†…æµ®åŠ¨å›¾åƒï¼ˆæ‚¨ç»å¸¸åœ¨æŠ¥çº¸ä¸Šçœ‹åˆ°çš„ï¼‰ã€‚2000 å¹´ä»£åˆæœŸçš„ Web å¼€å‘äººå‘˜åˆ©ç”¨äº†è¿™æ ·ä¸€ä¸ªäº‹å®ï¼Œå³æ‚¨ä¸ä»…å¯ä»¥æµ®åŠ¨å›¾åƒï¼Œè¿˜å¯ä»¥æµ®åŠ¨ä»»ä½•å…ƒç´ ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥é€šè¿‡æµ®åŠ¨æ•´ä¸ªå†…å®¹ div æ¥åˆ›å»ºè¡Œå’Œåˆ—çš„é”™è§‰ã€‚ä½†åŒæ ·ï¼Œæµ®åŠ¨ä¸æ˜¯ä¸ºæ­¤ç›®çš„è€Œè®¾è®¡çš„ï¼Œå› æ­¤å¾ˆéš¾ä»¥ä¸€è‡´çš„æ–¹å¼åˆ›é€ è¿™ç§é”™è§‰ã€‚</p>
<p>2006å¹´ï¼Œ<a href="https://alistapart.com/">A List Apart </a>å‘è¡¨äº†ä¸€ç¯‡å—æ¬¢è¿çš„æ–‡ç« ã€Š<a href="https://alistapart.com/article/holygrail">å¯»æ‰¾åœ£æ¯</a>ã€‹ï¼Œå…¶ä¸­æ¦‚è¿°äº†ä¸€ç§è¯¦ç»†è€Œå½»åº•çš„æ–¹æ³•æ¥åˆ›å»ºæ‰€è°“çš„åœ£æ¯å¸ƒå±€ - ä¸€ä¸ªé¡µçœ‰ï¼Œä¸‰åˆ—å’Œä¸€ä¸ªé¡µè„šã€‚è®¤ä¸ºå¬èµ·æ¥ç›¸å½“ç®€å•çš„å¸ƒå±€è¢«ç§°ä¸ºåœ£æ¯æ˜¯ç›¸å½“ç–¯ç‹‚çš„ï¼Œä½†è¿™ç¡®å®æ˜¯å½“æ—¶ä½¿ç”¨çº¯ CSS åˆ›å»ºä¸€è‡´çš„å¸ƒå±€æ˜¯å¤šä¹ˆå›°éš¾ã€‚</p>
<p>ä¸‹é¢æ˜¯åŸºäºè¯¥æ–‡ç« ä¸­æè¿°çš„æŠ€æœ¯çš„ç¤ºä¾‹çš„åŸºäº float çš„å¸ƒå±€ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-css" data-lang="css"><span class="line"><span class="cl"><span class="c">/* FLOAT-BASED LAYOUT */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">body</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">padding-left</span><span class="p">:</span> <span class="mi">200</span><span class="kt">px</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">padding-right</span><span class="p">:</span> <span class="mi">190</span><span class="kt">px</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">min-width</span><span class="p">:</span> <span class="mi">240</span><span class="kt">px</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">header</span><span class="o">,</span> <span class="nt">footer</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">margin-left</span><span class="p">:</span> <span class="mi">-200</span><span class="kt">px</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">margin-right</span><span class="p">:</span> <span class="mi">-190</span><span class="kt">px</span><span class="p">;</span>     
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">main</span><span class="o">,</span> <span class="nt">nav</span><span class="o">,</span> <span class="nt">aside</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">position</span><span class="p">:</span> <span class="kc">relative</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">float</span><span class="p">:</span> <span class="kc">left</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">main</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">20</span><span class="kt">px</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">width</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">nav</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">width</span><span class="p">:</span> <span class="mi">180</span><span class="kt">px</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">right</span><span class="p">:</span> <span class="mi">240</span><span class="kt">px</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">margin-left</span><span class="p">:</span> <span class="mi">-100</span><span class="kt">%</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">aside</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">width</span><span class="p">:</span> <span class="mi">130</span><span class="kt">px</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">margin-right</span><span class="p">:</span> <span class="mi">-100</span><span class="kt">%</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">footer</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">clear</span><span class="p">:</span> <span class="kc">both</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">*</span> <span class="nt">html</span> <span class="nt">nav</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">left</span><span class="p">:</span> <span class="mi">150</span><span class="kt">px</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>çœ‹çœ‹C SSï¼Œä½ å¯ä»¥çœ‹åˆ°æœ‰å¾ˆå¤šæŠ€å·§éœ€è¦è®©å®ƒå·¥ä½œï¼ˆè´Ÿè¾¹è·ï¼Œ <code>clear: both</code> å±æ€§ï¼Œç¡¬ç¼–ç å®½åº¦è®¡ç®—ç­‰ï¼‰â€”â€”è¿™ç¯‡ <a href="https://alistapart.com/article/holygrail">æ–‡ç« </a> å¾ˆå¥½åœ°è¯¦ç»†è§£é‡Šäº†æ¯ä¸ªåŸå› ã€‚ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img loading="lazy" src="https://peterxjang.com/img/1____2LrWDjxL8Q33fL6Ci4hIw.png" alt="Example website with float based layout"  />
</p>
<center>å•å‡»<a href='https://codepen.io/peterxjang/pen/VQeXYg?editors=1100'>æ­¤å¤„</a>æŸ¥çœ‹å®æ—¶ç¤ºä¾‹</center>
<p>è¿™å¾ˆå¥½ï¼Œä½†æ‚¨å¯ä»¥ä»é¢œè‰²ä¸­çœ‹åˆ°ä¸‰åˆ—çš„é«˜åº¦ä¸ç›¸ç­‰ï¼Œå¹¶ä¸”é¡µé¢æ²¡æœ‰å¡«æ»¡å±å¹•çš„é«˜åº¦ã€‚è¿™äº›é—®é¢˜æ˜¯åŸºäºæµ®åŠ¨çš„æ–¹æ³•æ‰€å›ºæœ‰çš„ã€‚æµ®åŠ¨æ‰€èƒ½åšçš„å°±æ˜¯å°†å†…å®¹æ”¾åœ¨ä¸€ä¸ªéƒ¨åˆ†çš„å·¦ä¾§æˆ–å³ä¾§â€”â€”CSS æ— æ³•æ¨æ–­å…¶ä»–éƒ¨åˆ†ä¸­å†…å®¹çš„é«˜åº¦ã€‚è¿™ä¸ªé—®é¢˜ç›´åˆ°å¤šå¹´åæ‰æœ‰äº†ç›´æ¥çš„è§£å†³æ–¹æ¡ˆï¼Œé‡‡ç”¨äº†åŸºäºå¼¹æ€§æ¡†çš„å¸ƒå±€ã€‚</p>
<h4 id="åŸºäºå¼¹æ€§æ¡†çš„å¸ƒå±€">åŸºäºå¼¹æ€§æ¡†çš„å¸ƒå±€</h4>
<p>flexbox CSS å±æ€§äº 2009 å¹´é¦–æ¬¡æå‡ºï¼Œä½†ç›´åˆ° 2015 å¹´å·¦å³æ‰è¢«å¹¿æ³›é‡‡ç”¨ã€‚Flexbox æ—¨åœ¨å®šä¹‰ç©ºé—´åœ¨å•ä¸ªåˆ—æˆ–è¡Œä¸­çš„åˆ†å¸ƒæ–¹å¼ï¼Œä¸ä½¿ç”¨æµ®åŠ¨ç›¸æ¯”ï¼Œè¿™ä½¿å…¶æˆä¸ºå®šä¹‰å¸ƒå±€çš„æ›´å¥½å€™é€‰é¡¹ã€‚è¿™æ„å‘³ç€åœ¨ä½¿ç”¨åŸºäºæµ®åŠ¨çš„å¸ƒå±€å¤§çº¦åå¹´ä¹‹åï¼ŒWebå¼€å‘äººå‘˜ç»ˆäºèƒ½å¤Ÿä½¿ç”¨ CSS è¿›è¡Œå¸ƒå±€ï¼Œè€Œæ— éœ€ä½¿ç”¨æµ®åŠ¨æ‰€éœ€çš„æŠ€å·§ã€‚</p>
<p>ä¸‹é¢æ˜¯åŸºäºå¼¹æ€§æ¡†çš„ç¤ºä¾‹å¸ƒå±€ï¼ŒåŸºäºç«™ç‚¹ä¸Šæè¿°çš„æŠ€æœ¯ <a href="https://philipwalton.github.io/solved-by-flexbox/demos/holy-grail/">ç”±å¼¹æ€§æ¡†è§£å†³</a> ï¼ˆä¸€ä¸ªå±•ç¤ºä¸åŒå¼¹æ€§æ¡†ç¤ºä¾‹çš„æµè¡Œèµ„æºï¼‰ã€‚è¯·æ³¨æ„ï¼Œä¸ºäº†ä½¿ flexbox å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦åœ¨ HTML ä¸­çš„ä¸‰åˆ—å‘¨å›´å¢åŠ ä¸€ä¸ªåŒ…è£…å™¨ divï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Modern CSS<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;index.css&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">header</span><span class="p">&gt;</span>This is the header.<span class="p">&lt;/</span><span class="nt">header</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;container&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">main</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>This is the main content.<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>...<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">main</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">nav</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">h4</span><span class="p">&gt;</span>This is the navigation section.<span class="p">&lt;/</span><span class="nt">h4</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>...<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">aside</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">h4</span><span class="p">&gt;</span>This is an aside section.<span class="p">&lt;/</span><span class="nt">h4</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>...<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">aside</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">footer</span><span class="p">&gt;</span>This is the footer.<span class="p">&lt;/</span><span class="nt">footer</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>è¿™æ˜¯ CSS ä¸­çš„å¼¹æ€§æ¡†ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-css" data-lang="css"><span class="line"><span class="cl"><span class="c">/* FLEXBOX-BASED LAYOUT */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">body</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">min-height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">vh</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">display</span><span class="p">:</span> <span class="kc">flex</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">flex-direction</span><span class="p">:</span> <span class="kc">column</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nc">container</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">display</span><span class="p">:</span> <span class="kc">flex</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">flex</span><span class="p">:</span> <span class="mi">1</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">main</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">flex</span><span class="p">:</span> <span class="mi">1</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">20</span><span class="kt">px</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">nav</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">flex</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">180</span><span class="kt">px</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">order</span><span class="p">:</span> <span class="mi">-1</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">aside</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">flex</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">130</span><span class="kt">px</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸åŸºäºæµ®åŠ¨çš„å¸ƒå±€æ–¹æ³•ç›¸æ¯”ï¼Œæ›´ç´§å‡‘ï¼flexbox çš„å±æ€§å’Œå€¼ä¹ä¸€çœ‹æœ‰ç‚¹ä»¤äººå›°æƒ‘ï¼Œä½†å®ƒæ¶ˆé™¤äº†å¯¹è®¸å¤šæŠ€å·§çš„éœ€æ±‚ï¼Œä¾‹å¦‚åŸºäºæµ®åŠ¨çš„å¸ƒå±€æ‰€å¿…éœ€çš„è´Ÿè¾¹è·â€”â€”è¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„èƒœåˆ©ã€‚ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img loading="lazy" src="https://peterxjang.com/img/1__I6qa6O31X__jlilGCrcSTsQ.png" alt="Example website with flexbox based layout"  />
</p>
<center>å•å‡»<a href='https://codepen.io/peterxjang/pen/xYZWGz?editors=1100'>æ­¤å¤„</a>æŸ¥çœ‹å®æ—¶ç¤ºä¾‹</center>
<p>å¥½å¤šäº†ï¼è¿™äº›åˆ—çš„é«˜åº¦éƒ½ç›¸ç­‰ï¼Œå¹¶å æ®é¡µé¢çš„æ•´ä¸ªé«˜åº¦ã€‚ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œè¿™ä¼¼ä¹æ˜¯å®Œç¾çš„ï¼Œä½†è¿™ç§æ–¹æ³•æœ‰å‡ ä¸ªå°ç¼ºç‚¹ã€‚ä¸€ä¸ªæ˜¯æµè§ˆå™¨æ”¯æŒ - ç›®å‰æ¯ä¸ªç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒf lexboxï¼Œä½†ä¸€äº›è¾ƒæ—§çš„æµè§ˆå™¨æ°¸è¿œä¸ä¼šã€‚å¹¸è¿çš„æ˜¯ï¼Œæµè§ˆå™¨ä¾›åº”å•†æ­£åœ¨åŠ å¤§åŠ›åº¦ç»ˆæ­¢å¯¹è¿™äº›æ—§æµè§ˆå™¨çš„æ”¯æŒï¼Œä¸ºç½‘é¡µè®¾è®¡å¸ˆæä¾›æ›´ä¸€è‡´çš„å¼€å‘ä½“éªŒã€‚å¦ä¸€ä¸ªç¼ºç‚¹æ˜¯æˆ‘ä»¬éœ€è¦å°† <code>&lt;div class=&quot;container&quot;&gt;</code> æ·»åŠ åˆ°æ ‡è®°ä¸­â€”â€”é¿å…å®ƒä¼šå¾ˆå¥½ã€‚åœ¨ç†æƒ³çš„ä¸–ç•Œä¸­ï¼Œä»»ä½• CSS å¸ƒå±€éƒ½æ ¹æœ¬ä¸éœ€è¦æ›´æ”¹ HTML æ ‡è®°ã€‚</p>
<p>æœ€å¤§çš„ç¼ºç‚¹æ˜¯ CSS æœ¬èº«çš„ä»£ç  - flexbox æ¶ˆé™¤äº†è®¸å¤šæµ®åŠ¨é»‘å®¢ï¼Œä½†ä»£ç å¹¶ä¸åƒå®šä¹‰å¸ƒå±€é‚£æ ·å¯Œæœ‰è¡¨ç°åŠ›ã€‚å¾ˆéš¾é˜…è¯» flexbox CSS å¹¶ç›´è§‚åœ°ç†è§£æ‰€æœ‰å…ƒç´ åœ¨é¡µé¢ä¸Šçš„å¸ƒå±€æ–¹å¼ã€‚è¿™ä¼šå¯¼è‡´åœ¨ç¼–å†™åŸºäº flexbox çš„å¸ƒå±€æ—¶è¿›è¡Œå¤§é‡çŒœæµ‹å’Œæ£€æŸ¥ã€‚</p>
<p>å†æ¬¡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œflexbox æ—¨åœ¨å°†å…ƒç´ é—´éš”åœ¨å•ä¸ªåˆ—æˆ–è¡Œå†… - å®ƒä¸æ˜¯ä¸ºæ•´ä¸ªé¡µé¢å¸ƒå±€è®¾è®¡çš„ï¼å°½ç®¡å®ƒåšäº†ä¸€ä¸ªæœ‰ç”¨çš„å·¥ä½œï¼ˆæ¯”åŸºäºæµ®åŠ¨çš„å¸ƒå±€å¥½å¾—å¤šï¼‰ï¼Œä½†ä¸“é—¨å¼€å‘äº†ä¸åŒçš„è§„èŒƒæ¥å¤„ç†å…·æœ‰å¤šè¡Œå’Œå¤šåˆ—çš„å¸ƒå±€ã€‚æ­¤è§„èŒƒç§°ä¸º CSS ç½‘æ ¼ã€‚</p>
<h4 id="åŸºäºç½‘æ ¼çš„å¸ƒå±€">åŸºäºç½‘æ ¼çš„å¸ƒå±€</h4>
<p>CSS ç½‘æ ¼äº 2011 å¹´é¦–æ¬¡æå‡ºï¼ˆåœ¨ flexbox ææ¡ˆä¹‹åä¸ä¹…ï¼‰ï¼Œä½†èŠ±äº†å¾ˆé•¿æ—¶é—´æ‰åœ¨æµè§ˆå™¨ä¸­å¾—åˆ°å¹¿æ³›é‡‡ç”¨ã€‚æˆªè‡³2018å¹´åˆï¼Œå¤§å¤šæ•°ç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒ CSS ç½‘æ ¼ï¼ˆç”šè‡³æ¯”ä¸€ä¸¤å¹´å‰æœ‰äº†å·¨å¤§çš„æ”¹è¿›ï¼‰ã€‚</p>
<p>ä¸‹é¢æ˜¯åŸºäºæ­¤ <a href="https://css-tricks.com/css-grid-one-layout-multiple-ways/">CSS æŠ€å·§æ–‡ç« </a> ä¸­çš„ç¬¬ä¸€ç§æ–¹æ³•çš„ç¤ºä¾‹çš„åŸºäºç½‘æ ¼çš„å¸ƒå±€ã€‚è¯·æ³¨æ„ï¼Œå¯¹äºæ­¤ç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥æ‘†è„±å¿…é¡»ä¸ºåŸºäº flexbox çš„å¸ƒå±€æ·»åŠ çš„ <code>&lt;div class=&quot;container&quot;&gt;</code> â€” æˆ‘ä»¬å¯ä»¥ç®€å•åœ°ä½¿ç”¨åŸå§‹ HTMLï¼Œè€Œæ— éœ€ä¿®æ”¹ã€‚ä»¥ä¸‹æ˜¯ CSS çš„å¤–è§‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-css" data-lang="css"><span class="line"><span class="cl"><span class="c">/* GRID-BASED LAYOUT */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">body</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">display</span><span class="p">:</span> <span class="k">grid</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">min-height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">vh</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">grid-template-columns</span><span class="p">:</span> <span class="mi">200</span><span class="kt">px</span> <span class="mi">1</span><span class="n">fr</span> <span class="mi">150</span><span class="kt">px</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">grid-template-rows</span><span class="p">:</span> <span class="n">min-content</span> <span class="mi">1</span><span class="n">fr</span> <span class="n">min-content</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">header</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">grid-row</span><span class="p">:</span> <span class="mi">1</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">grid-column</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">nav</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">grid-row</span><span class="p">:</span> <span class="mi">2</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">grid-column</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">main</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">grid-row</span><span class="p">:</span> <span class="mi">2</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">grid-column</span><span class="p">:</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">20</span><span class="kt">px</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">aside</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">grid-row</span><span class="p">:</span> <span class="mi">2</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">grid-column</span><span class="p">:</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">padding</span><span class="p">:</span> <span class="mi">0</span> <span class="mi">10</span><span class="kt">px</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">footer</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="k">grid-row</span><span class="p">:</span> <span class="mi">3</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="k">grid-column</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>ç»“æœåœ¨è§†è§‰ä¸Šä¸åŸºäºå¼¹æ€§æ¡†çš„å¸ƒå±€ç›¸åŒã€‚ä½†æ˜¯ï¼Œè¿™é‡Œçš„ CSS åœ¨æ¸…æ¥šåœ°è¡¨è¾¾æ‰€éœ€å¸ƒå±€çš„æ„ä¹‰ä¸Šå¾—åˆ°äº†å¾ˆå¤§çš„æ”¹è¿›ã€‚åˆ—å’Œè¡Œçš„å¤§å°å’Œå½¢çŠ¶åœ¨æ­£æ–‡é€‰æ‹©å™¨ä¸­å®šä¹‰ï¼Œç½‘æ ¼ä¸­çš„æ¯ä¸ªé¡¹ç›®éƒ½ç”±å…¶ä½ç½®ç›´æ¥å®šä¹‰ã€‚</p>
<p>å¯èƒ½ä»¤äººå›°æƒ‘çš„ä¸€ä»¶äº‹æ˜¯ <code>grid-column</code> å±æ€§ï¼Œå®ƒå®šä¹‰äº†åˆ—çš„èµ·ç‚¹/ç»ˆç‚¹ã€‚è¿™å¯èƒ½ä¼šä»¤äººå›°æƒ‘ï¼Œå› ä¸ºåœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæœ‰ 3 åˆ—ï¼Œä½†æ•°å­—èŒƒå›´ä» 1 åˆ° 4ã€‚å½“ä½ çœ‹ä¸‹é¢çš„å›¾ç‰‡æ—¶ï¼Œå®ƒä¼šå˜å¾—æ›´åŠ æ¸…æ™°ï¼š</p>
<p><img loading="lazy" src="https://peterxjang.com/img/1__GOJJrm9Mhp__Qr319Bc7V9Q.png" alt="Example website with grid based layout"  />
</p>
<center>å•å‡»<a href='https://codepen.io/peterxjang/pen/vdLROM?editors=1100'>æ­¤å¤„</a>æŸ¥çœ‹å®æ—¶ç¤ºä¾‹</center>
<p>ç¬¬ä¸€åˆ—ä» 1 å¼€å§‹ï¼Œåˆ° 2 ç»“æŸï¼Œç¬¬äºŒåˆ—ä» 2 å¼€å§‹ï¼Œåˆ° 3 ç»“æŸï¼Œç¬¬ä¸‰åˆ—ä» 3 å¼€å§‹ï¼Œåˆ° 4 ç»“æŸã€‚æ ‡é¢˜çš„ <code>grid-column</code> ä¸º <code>1 / 4</code> ä»¥è·¨è¶Šæ•´ä¸ªé¡µé¢ï¼Œå¯¼èˆªå…·æœ‰ <code>grid-column</code> of <code>1 / 2</code> ä»¥è·¨è¶Šç¬¬ä¸€åˆ—ï¼Œä¾æ­¤ç±»æ¨ã€‚</p>
<p>ä¸€æ—¦ä½ ä¹ æƒ¯äº†ç½‘æ ¼è¯­æ³•ï¼Œå®ƒæ˜¾ç„¶æˆä¸ºåœ¨ CSS ä¸­è¡¨è¾¾å¸ƒå±€çš„ç†æƒ³æ–¹å¼ã€‚åŸºäºç½‘æ ¼çš„å¸ƒå±€å”¯ä¸€çœŸæ­£çš„ç¼ºç‚¹æ˜¯æµè§ˆå™¨æ”¯æŒï¼Œåœ¨è¿‡å»ä¸€å¹´ä¸­å†æ¬¡æœ‰äº†å¾ˆå¤§çš„æ”¹è¿›ã€‚CSS ç½‘æ ¼ä½œä¸º CSS ä¸­ç¬¬ä¸€ä¸ªçœŸæ­£ä¸ºå¸ƒå±€è€Œè®¾è®¡çš„å·¥å…·çš„é‡è¦æ€§æ€ä¹ˆå¼ºè°ƒéƒ½ä¸ä¸ºè¿‡ã€‚ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œç½‘é¡µè®¾è®¡å¸ˆåœ¨åˆ¶ä½œåˆ›æ„å¸ƒå±€æ—¶æ€»æ˜¯å¿…é¡»éå¸¸ä¿å®ˆï¼Œå› ä¸ºåˆ°ç›®å‰ä¸ºæ­¢çš„å·¥å…·ä¸€ç›´å¾ˆè„†å¼±ï¼Œä½¿ç”¨å„ç§é»‘å®¢å’Œè§£å†³æ–¹æ³•ã€‚ç°åœ¨ CSS ç½‘æ ¼å·²ç»å­˜åœ¨ï¼Œæœ‰å¯èƒ½å‡ºç°ä»¥å‰ä»æœªæœ‰è¿‡çš„åˆ›æ„å¸ƒå±€è®¾è®¡çš„æ–°æµªæ½® - æ¿€åŠ¨äººå¿ƒçš„æ—¶ä»£ï¼</p>
<p><img loading="lazy" src="https://peterxjang.com/img/1__JGkKSd3Hs7Pq17Qt5xTEzw.png" alt="Dinosaur comic panel 2"  />
</p>
<h3 id="å°†-css-é¢„å¤„ç†å™¨ç”¨äºæ–°è¯­æ³•">å°† CSS é¢„å¤„ç†å™¨ç”¨äºæ–°è¯­æ³•</h3>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»ä»‹ç»äº†ä½¿ç”¨ CSS è¿›è¡ŒåŸºæœ¬æ ·å¼å’Œå¸ƒå±€ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¸ºå¸®åŠ©æ”¹å–„å°† CSS ä½œä¸ºè¯­è¨€æœ¬èº«ä½¿ç”¨çš„ä½“éªŒè€Œåˆ›å»ºçš„å·¥å…·ï¼Œä» CSS é¢„å¤„ç†å™¨å¼€å§‹ã€‚</p>
<p>CSS é¢„å¤„ç†å™¨å…è®¸æ‚¨ä½¿ç”¨ä¸åŒçš„è¯­è¨€ç¼–å†™æ ·å¼ï¼Œè¯¥è¯­è¨€è¢«è½¬æ¢ä¸ºæµè§ˆå™¨å¯ä»¥ç†è§£çš„ CSSã€‚è¿™åœ¨æµè§ˆå™¨å®ç°æ–°åŠŸèƒ½éå¸¸ç¼“æ…¢çš„æ—¶ä»£è‡³å…³é‡è¦ã€‚ç¬¬ä¸€ä¸ªä¸»è¦çš„ CSS é¢„å¤„ç†å™¨æ˜¯ <a href="http://sass-lang.com/">Sass</a>ï¼Œäº2006å¹´å‘å¸ƒã€‚å®ƒå…·æœ‰æ–°çš„ç®€æ´è¯­æ³•ï¼ˆç¼©è¿›è€Œä¸æ˜¯æ‹¬å·ï¼Œæ²¡æœ‰åˆ†å·ç­‰ï¼‰ï¼Œå¹¶æ·»åŠ äº† CSS ä¸­ç¼ºå°‘çš„é«˜çº§åŠŸèƒ½ï¼Œä¾‹å¦‚å˜é‡ï¼Œå¸®åŠ©ç¨‹åºå‡½æ•°å’Œè®¡ç®—ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬å‰é¢ç¤ºä¾‹çš„é¢œè‰²éƒ¨åˆ†ä½¿ç”¨å¸¦æœ‰å˜é‡çš„ Sass çš„æ ·å­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sass" data-lang="sass"><span class="line"><span class="cl"><span class="na">$dark-color</span><span class="o">:</span> <span class="mh">#4a4a4a</span>  
</span></span><span class="line"><span class="cl"><span class="na">$light-color</span><span class="o">:</span> <span class="mh">#f9f9f9</span>  
</span></span><span class="line"><span class="cl"><span class="na">$side-color</span><span class="o">:</span> <span class="mh">#eee</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">body</span>  
</span></span><span class="line"><span class="cl"><span class="err">  </span><span class="na">color</span><span class="o">:</span> <span class="nv">$dark-color</span>  
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="nt">header</span><span class="o">,</span> <span class="nt">footer</span>  
</span></span><span class="line"><span class="cl"><span class="err">  </span><span class="na">background-color</span><span class="o">:</span> <span class="nv">$dark-color</span>  
</span></span><span class="line"><span class="cl"><span class="err">  </span><span class="na">color</span><span class="o">:</span> <span class="nv">$light-color</span>  
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="nt">main</span>  
</span></span><span class="line"><span class="cl"><span class="err">  </span><span class="na">background</span><span class="o">:</span> <span class="nv">$light-color</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">nav</span><span class="o">,</span> <span class="nt">aside</span>  
</span></span><span class="line"><span class="cl"><span class="err">  </span><span class="na">background</span><span class="o">:</span> <span class="nv">$side-color</span>
</span></span></code></pre></div><p>è¯·æ³¨æ„å¦‚ä½•ä½¿ç”¨ <code>$</code> ç¬¦å·å®šä¹‰å¯é‡ç”¨å˜é‡ï¼Œå¹¶åˆ é™¤æ‹¬å·å’Œåˆ†å·ï¼Œä»è€Œä½¿è¯­æ³•çœ‹èµ·æ¥æ›´ç®€æ´ã€‚Sass ä¸­æ›´ç®€æ´çš„è¯­æ³•å¾ˆå¥½ï¼Œä½†æ˜¯åƒå˜é‡è¿™æ ·çš„åŠŸèƒ½åœ¨å½“æ—¶æ˜¯é©å‘½æ€§çš„ï¼Œå› ä¸ºå®ƒä»¬ä¸ºç¼–å†™å¹²å‡€å’Œå¯ç»´æŠ¤çš„ CSS å¼€è¾Ÿäº†æ–°çš„å¯èƒ½æ€§ã€‚</p>
<p>è¦ä½¿ç”¨ Sassï¼Œæ‚¨éœ€è¦ <a href="https://www.ruby-lang.org/en/documentation/installation/">å®‰è£… Ruby</a>ï¼Œè¿™æ˜¯ä¸€ç§ç”¨äºå°† Sass ä»£ç ç¼–è¯‘ä¸ºå¸¸è§„ CSS çš„ç¼–ç¨‹è¯­è¨€ã€‚ç„¶åï¼Œæ‚¨éœ€è¦å®‰è£… <a href="http://sass-lang.com/install">Sass gem</a>ï¼Œç„¶å<a href="http://sass-lang.com/guide#topic-1">åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œå‘½ä»¤</a>ä»¥å°† <code>.sass</code> æ–‡ä»¶è½¬æ¢ä¸º <code>.css</code> æ–‡ä»¶ã€‚ä¸‹é¢æ˜¯å‘½ä»¤çš„å¤–è§‚ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sass --watch index.sass index.css
</span></span></code></pre></div><p>æ­¤å‘½ä»¤ä¼šå°†ç¼–å†™åœ¨åä¸º <code>index.sass</code> çš„æ–‡ä»¶ä¸­çš„ Sass ä»£ç è½¬æ¢ä¸ºåä¸º <code>index.css</code> çš„æ–‡ä»¶ä¸­çš„å¸¸è§„ CSSï¼ˆ <code>--watch</code> å‚æ•°å‘Šè¯‰å®ƒåœ¨ä¿å­˜æ—¶è¾“å…¥æ›´æ”¹æ—¶éšæ—¶è¿è¡Œï¼Œè¿™å¾ˆæ–¹ä¾¿ï¼‰ã€‚</p>
<p>è¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºæ„å»ºæ­¥éª¤ï¼Œè¿™åœ¨ 2006 å¹´æ˜¯ä¸€ä¸ªç›¸å½“å¤§çš„è¿›å…¥éšœç¢ã€‚å¦‚æœæ‚¨ä¹ æƒ¯äº†åƒ Ruby è¿™æ ·çš„ç¼–ç¨‹è¯­è¨€ï¼Œé‚£ä¹ˆè¿™ä¸ªè¿‡ç¨‹éå¸¸ç®€å•ã€‚ä½†æ˜¯å½“æ—¶è®¸å¤šå‰ç«¯å¼€å‘äººå‘˜åªä½¿ç”¨ HTM Lå’Œ CSSï¼Œä¸éœ€è¦ä»»ä½•è¿™æ ·çš„å·¥å…·ã€‚å› æ­¤ï¼Œè®©æŸäººå­¦ä¹ æ•´ä¸ªç”Ÿæ€ç³»ç»Ÿä»¥è·å¾— CSS é¢„å¤„ç†å™¨æä¾›çš„åŠŸèƒ½æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„è¦æ±‚ã€‚</p>
<p>2009å¹´ï¼Œ<a href="http://lesscss.org/">Less</a> CSS é¢„å¤„ç†å™¨å‘å¸ƒã€‚å®ƒä¹Ÿæ˜¯ç”¨ Ruby ç¼–å†™çš„ï¼Œå¹¶æä¾›äº†ä¸ Sass ç±»ä¼¼çš„åŠŸèƒ½ã€‚å…³é”®çš„åŒºåˆ«åœ¨äºè¯­æ³•ï¼Œå®ƒè¢«è®¾è®¡ä¸ºå°½å¯èƒ½æ¥è¿‘ CSSã€‚è¿™æ„å‘³ç€ä»»ä½• CSS ä»£ç éƒ½æ˜¯æœ‰æ•ˆçš„ Less ä»£ç ã€‚ä¸‹é¢æ˜¯ä½¿ç”¨ Less è¯­æ³•ç¼–å†™çš„ç›¸åŒç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">@dark-color: #4a4a4a;  
</span></span><span class="line"><span class="cl">@light-color: #f9f9f9;  
</span></span><span class="line"><span class="cl">@side-color: #eee;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">body {  
</span></span><span class="line"><span class="cl">  color: @dark-color;  
</span></span><span class="line"><span class="cl">}  
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">header, footer {  
</span></span><span class="line"><span class="cl">  background-color: @dark-color;  
</span></span><span class="line"><span class="cl">  color: @light-color;  
</span></span><span class="line"><span class="cl">}  
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">main {  
</span></span><span class="line"><span class="cl">  background: @light-color;  
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">nav, aside {  
</span></span><span class="line"><span class="cl">  background: @side-color;  
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><p>å®ƒå‡ ä¹ç›¸åŒï¼ˆå˜é‡çš„å‰ç¼€ä¸º <code>@</code> è€Œä¸æ˜¯ <code>$</code> ï¼‰ï¼Œä½†ä¸åƒ Sass ç¤ºä¾‹é‚£æ ·æ¼‚äº®ï¼Œå…·æœ‰ä¸ CSS ç›¸åŒçš„å¤§æ‹¬å·å’Œåˆ†å·ã€‚ç„¶è€Œï¼Œå®ƒæ›´æ¥è¿‘ CSS çš„äº‹å®ä½¿å¼€å‘äººå‘˜æ›´å®¹æ˜“é‡‡ç”¨å®ƒã€‚2012å¹´ï¼ŒLess è¢«é‡å†™ä¸ºä½¿ç”¨ JavaScriptï¼ˆç‰¹åˆ«æ˜¯ <a href="https://nodejs.org/en/">Node.js</a>ï¼‰è€Œä¸æ˜¯ Ruby è¿›è¡Œç¼–è¯‘ã€‚è¿™ä½¿å¾— Less æ¯”å®ƒçš„ Ruby åŒè¡Œæ›´å¿«ï¼Œå¹¶ä¸”å¯¹å·²ç»åœ¨å·¥ä½œæµç¨‹ä¸­ä½¿ç”¨ Node.js çš„å¼€å‘äººå‘˜æ›´å…·å¸å¼•åŠ›ã€‚</p>
<p>è¦å°†æ­¤ä»£ç è½¬æ¢ä¸ºå¸¸è§„ CSSï¼Œæ‚¨é¦–å…ˆéœ€è¦ <a href="https://nodejs.org/en/download/">å®‰è£… Node.js</a>ï¼Œç„¶å <a href="http://lesscss.org/#using-less-installation">å®‰è£… Less</a>ï¼Œç„¶åè¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">lessc index.less index.css
</span></span></code></pre></div><p>æ­¤å‘½ä»¤ä¼šå°†åœ¨åä¸º <code>index.less</code> çš„æ–‡ä»¶ä¸­ç¼–å†™çš„è¾ƒå°‘ä»£ç è½¬æ¢ä¸ºåä¸º <code>index.css</code> çš„æ–‡ä»¶ä¸­çš„å¸¸è§„ CSSã€‚è¯·æ³¨æ„ï¼Œ <code>lessc</code> å‘½ä»¤æ²¡æœ‰ç›‘è§†æ–‡ä»¶æ›´æ”¹çš„æ–¹æ³•ï¼ˆä¸ <code>sass</code> å‘½ä»¤ä¸åŒï¼‰ï¼Œè¿™æ„å‘³ç€æ‚¨éœ€è¦å®‰è£…ä¸åŒçš„å·¥å…·æ¥è‡ªåŠ¨ç›‘è§†å’Œç¼–è¯‘ <code>.less</code> ä¸ªæ–‡ä»¶ï¼Œè¿™å¢åŠ äº†è¿‡ç¨‹çš„å¤æ‚æ€§ã€‚åŒæ ·ï¼Œå¯¹äºä¹ æƒ¯ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·çš„ç¨‹åºå‘˜æ¥è¯´ï¼Œè¿™å¹¶ä¸å›°éš¾ï¼Œä½†å¯¹äºåªæƒ³ä½¿ç”¨ CSS é¢„å¤„ç†å™¨çš„å…¶ä»–äººæ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªé‡è¦çš„è¿›å…¥éšœç¢ã€‚</p>
<p>éšç€ Less è·å¾—æ€æƒ³ä»½é¢ï¼ŒSass å¼€å‘äººå‘˜åœ¨ 2010 å¹´é€šè¿‡æ·»åŠ ä¸€ä¸ªåä¸º <a href="http://sass-lang.com/documentation/file.SASS_CHANGELOG.html#SCSS__Sassy_CSS_">SCSS</a> çš„æ–°è¯­æ³•ï¼ˆè¿™æ˜¯ä¸€ä¸ªç±»ä¼¼äº Less çš„ CSS è¶…é›†ï¼‰è¿›è¡Œäº†è°ƒæ•´ã€‚ä»–ä»¬è¿˜å‘å¸ƒäº† <a href="http://sass-lang.com/libsass">LibSass</a>ï¼Œè¿™æ˜¯ Ruby Sass å¼•æ“çš„ C/C++ ç«¯å£ï¼Œè¿™ä½¿å¾—å®ƒæ›´å¿«ï¼Œèƒ½å¤Ÿåœ¨å„ç§è¯­è¨€ä¸­ä½¿ç”¨ã€‚</p>
<p>å¦ä¸€ä¸ªæ›¿ä»£çš„ CSS é¢„å¤„ç†å™¨æ˜¯ <a href="http://stylus-lang.com/">Stylus</a>ï¼Œå®ƒäº2010å¹´é—®ä¸–ï¼Œç”¨ Node.js ç¼–å†™ï¼Œä¸ Sass or Less ç›¸æ¯”ï¼Œå®ƒä¸“æ³¨äºæ›´ç®€æ´çš„è¯­æ³•ã€‚é€šå¸¸å…³äº CSS é¢„å¤„ç†å™¨çš„è®¨è®ºé›†ä¸­åœ¨è¿™ä¸‰ç§æœ€æµè¡Œçš„ï¼ˆSassï¼ŒLess å’Œ Stylusï¼‰ä¸Šã€‚æœ€åï¼Œå®ƒä»¬åœ¨æä¾›çš„åŠŸèƒ½æ–¹é¢éƒ½éå¸¸ç›¸ä¼¼ï¼Œå› æ­¤é€‰æ‹©å®ƒä»¬ä¸­çš„ä»»ä½•ä¸€ä¸ªéƒ½ä¸ä¼šå‡ºé”™ã€‚</p>
<p>ç„¶è€Œï¼Œæœ‰äº›äººè®¤ä¸º CSS é¢„å¤„ç†å™¨å˜å¾—è¶Šæ¥è¶Šä¸å¿…è¦ï¼Œå› ä¸ºæµè§ˆå™¨ç»ˆäºå¼€å§‹å®ç°å®ƒä»¬çš„ä¸€äº›åŠŸèƒ½ï¼ˆå¦‚å˜é‡å’Œè®¡ç®—ï¼‰ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ç§ç§°ä¸º CSS åå¤„ç†çš„ä¸åŒæ–¹æ³•ï¼Œå®ƒæœ‰å¯èƒ½ä½¿ CSS é¢„å¤„ç†å™¨è¿‡æ—¶ï¼ˆæ˜¾ç„¶å¹¶éæ²¡æœ‰äº‰è®®ï¼‰ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°†è®¨è®ºã€‚</p>
<h3 id="å°†-css-åå¤„ç†å™¨ç”¨äºå˜é©æ€§åŠŸèƒ½">å°† CSS åå¤„ç†å™¨ç”¨äºå˜é©æ€§åŠŸèƒ½</h3>
<p>CSS åå¤„ç†å™¨ä½¿ç”¨ JavaScript æ¥åˆ†ææ‚¨çš„ CSS å¹¶å°†å…¶è½¬æ¢ä¸ºæœ‰æ•ˆçš„ CSSã€‚ä»è¿™ä¸ªæ„ä¹‰ä¸Šè¯´ï¼Œå®ƒä¸ CSS é¢„å¤„ç†å™¨éå¸¸ç›¸ä¼¼ - æ‚¨å¯ä»¥å°†å…¶è§†ä¸ºè§£å†³ç›¸åŒé—®é¢˜çš„ä¸åŒæ–¹æ³•ã€‚å…³é”®çš„åŒºåˆ«åœ¨äºï¼Œè™½ç„¶ CSS é¢„å¤„ç†å™¨ä½¿ç”¨ç‰¹æ®Šè¯­æ³•æ¥æ ‡è¯†éœ€è¦è½¬æ¢çš„å†…å®¹ï¼Œä½† CSS åå¤„ç†å™¨å¯ä»¥è§£æå¸¸è§„ CSS å¹¶è½¬æ¢å®ƒï¼Œè€Œæ— éœ€ä»»ä½•ç‰¹æ®Šè¯­æ³•ã€‚æœ€å¥½ç”¨ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜è¿™ä¸€ç‚¹ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æˆ‘ä»¬æœ€åˆåœ¨ä¸Šé¢å®šä¹‰çš„ç”¨äºè®¾ç½®æ ‡é¢˜æ ‡ç­¾æ ·å¼çš„ CSS çš„ä¸€éƒ¨åˆ†ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-css" data-lang="css"><span class="line"><span class="cl"><span class="nt">h1</span><span class="o">,</span> <span class="nt">h2</span><span class="o">,</span> <span class="nt">h3</span><span class="o">,</span> <span class="nt">h4</span><span class="o">,</span> <span class="nt">h5</span><span class="o">,</span> <span class="nt">h6</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="kp">-ms-</span><span class="k">hyphens</span><span class="p">:</span> <span class="kc">auto</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="kp">-moz-</span><span class="k">hyphens</span><span class="p">:</span> <span class="kc">auto</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">  <span class="kp">-webkit-</span><span class="k">hyphens</span><span class="p">:</span> <span class="kc">auto</span><span class="p">;</span>    
</span></span><span class="line"><span class="cl">  <span class="k">hyphens</span><span class="p">:</span> <span class="kc">auto</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>ç²—ä½“ä¸­çš„é¡¹ç›®ç§°ä¸ºä¾›åº”å•†å‰ç¼€ã€‚æµè§ˆå™¨åœ¨å®éªŒæ€§åœ°æ·»åŠ æ–°çš„ CSS åŠŸèƒ½æ—¶ä¼šä½¿ç”¨ä¾›åº”å•†å‰ç¼€ï¼Œä»è€Œä¸ºå¼€å‘äººå‘˜æä¾›äº†ä¸€ç§åœ¨æœ€ç»ˆå®ç°æ—¶ä½¿ç”¨è¿™äº›æ–° CSS å±æ€§çš„æ–¹æ³•ã€‚è¿™é‡Œçš„å‰ç¼€ <code>-ms</code> ä»£è¡¨ Microsoft Internet Explorerï¼Œ <code>-moz</code> å‰ç¼€ä»£è¡¨ Mozilla Firefoxï¼Œ <code>-webkit</code> å‰ç¼€ä»£è¡¨ä½¿ç”¨ webkit æ¸²æŸ“å¼•æ“çš„æµè§ˆå™¨ï¼ˆå¦‚ Google Chromeã€Safari å’Œè¾ƒæ–°ç‰ˆæœ¬çš„ Operaï¼‰ã€‚</p>
<p>è®°ä½è¾“å…¥æ‰€æœ‰è¿™äº›ä¸åŒçš„ä¾›åº”å•†å‰ç¼€æ¥ä½¿ç”¨è¿™äº› CSS å±æ€§æ˜¯éå¸¸çƒ¦äººçš„ã€‚æ‹¥æœ‰ä¸€ä¸ªå¯ä»¥æ ¹æ®éœ€è¦è‡ªåŠ¨æ”¾å…¥ä¾›åº”å•†å‰ç¼€çš„å·¥å…·ä¼šå¾ˆå¥½ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ CSS é¢„å¤„ç†å™¨æ¥å®ç°è¿™ä¸€ç‚¹ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ SCSS æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-scss" data-lang="scss"><span class="line"><span class="cl"><span class="k">@mixin</span><span class="nf"> hyphens</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="na">-ms-hyphens</span><span class="o">:</span> <span class="nv">$value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">-moz-hyphens</span><span class="o">:</span> <span class="nv">$value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">-webkit-hyphens</span><span class="o">:</span> <span class="nv">$value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="na">hyphens</span><span class="o">:</span> <span class="nv">$value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nt">h1</span><span class="o">,</span> <span class="nt">h2</span><span class="o">,</span> <span class="nt">h3</span><span class="o">,</span> <span class="nt">h4</span><span class="o">,</span> <span class="nt">h5</span><span class="o">,</span> <span class="nt">h6</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">@include</span><span class="nd"> hyphens</span><span class="p">(</span><span class="ni">auto</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ <a href="http://sass-lang.com/guide#topic-6">Sass çš„ mixin åŠŸèƒ½</a>ï¼Œå®ƒå…è®¸æ‚¨å®šä¹‰ä¸€æ¬¡ CSS å—å¹¶åœ¨å…¶ä»–ä»»ä½•åœ°æ–¹é‡ç”¨å®ƒã€‚å½“æ­¤æ–‡ä»¶ç¼–è¯‘ä¸ºå¸¸è§„ CSS æ—¶ï¼Œä»»ä½• <code>@include</code> è¯­å¥éƒ½å°†æ›¿æ¢ä¸ºåŒ¹é… <code>@mixin</code> çš„ CSSã€‚æ€»çš„æ¥è¯´ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªç³Ÿç³•çš„è§£å†³æ–¹æ¡ˆï¼Œä½†æ‚¨è´Ÿè´£åœ¨ç¬¬ä¸€æ¬¡ä¸ºä»»ä½•éœ€è¦ä¾›åº”å•†å‰ç¼€çš„ CSS å±æ€§å®šä¹‰æ¯ä¸ª mixinã€‚è¿™äº› mixin å®šä¹‰å°†éœ€è¦ç»´æŠ¤ï¼Œå› ä¸ºæ‚¨å¯èƒ½å¸Œæœ›åœ¨æµè§ˆå™¨æ›´æ–°å…¶ CSS å…¼å®¹æ€§æ—¶åˆ é™¤ä¸å†éœ€è¦çš„ç‰¹å®šä¾›åº”å•†å‰ç¼€ã€‚</p>
<p>ä¸å…¶ä½¿ç”¨ mixinsï¼Œä¸å¦‚ç®€å•åœ°ç¼–å†™æ™®é€šçš„ CSS å¹¶è®©å·¥å…·è‡ªåŠ¨è¯†åˆ«éœ€è¦å‰ç¼€çš„å±æ€§å¹¶ç›¸åº”åœ°æ·»åŠ å®ƒä»¬ã€‚CSS åå¤„ç†å™¨èƒ½å¤Ÿåšåˆ°è¿™ä¸€ç‚¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨å°† <a href="http://postcss.org/">PostCSS</a> ä¸ <a href="https://github.com/postcss/autoprefixer">è‡ªåŠ¨å‰ç¼€æ’ä»¶</a> ä¸€èµ·ä½¿ç”¨ï¼Œåˆ™å¯ä»¥ç¼–å†™å®Œå…¨æ­£å¸¸çš„ CSSï¼Œè€Œæ— éœ€ä»»ä½•ä¾›åº”å•†å‰ç¼€ï¼Œå¹¶è®©åå¤„ç†å™¨å®Œæˆå…¶ä½™çš„å·¥ä½œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-css" data-lang="css"><span class="line"><span class="cl"><span class="nt">h1</span><span class="o">,</span> <span class="nt">h2</span><span class="o">,</span> <span class="nt">h3</span><span class="o">,</span> <span class="nt">h4</span><span class="o">,</span> <span class="nt">h5</span><span class="o">,</span> <span class="nt">h6</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">  <span class="k">hyphens</span><span class="p">:</span> <span class="kc">auto</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>å½“æ‚¨åœ¨æ­¤ä»£ç ä¸Šè¿è¡Œ CSS åå¤„ç†å™¨æ—¶ï¼Œç»“æœæ˜¯ <code>hyphens: auto;</code> è¡Œè¢«æ›¿æ¢ä¸ºæ‰€æœ‰é€‚å½“çš„ä¾›åº”å•†å‰ç¼€ï¼ˆå¦‚è‡ªåŠ¨å‰ç¼€æ’ä»¶ä¸­å®šä¹‰çš„é‚£æ ·ï¼Œæ‚¨ä¸éœ€è¦ç›´æ¥ç®¡ç†ï¼‰ã€‚è¿™æ„å‘³ç€æ‚¨å¯ä»¥ç¼–å†™å¸¸è§„ CSSï¼Œè€Œä¸å¿…æ‹…å¿ƒä»»ä½•å…¼å®¹æ€§æˆ–ç‰¹æ®Šè¯­æ³•ï¼Œè¿™å¾ˆå¥½ï¼</p>
<p>é™¤äº† PostCSS çš„è‡ªåŠ¨å‰ç¼€ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›æ’ä»¶å¯ä»¥è®©ä½ åšéå¸¸é…·çš„äº‹æƒ…ã€‚<a href="http://cssnext.io/">cssnext</a> æ’ä»¶å…è®¸æ‚¨ä½¿ç”¨å®éªŒæ€§çš„ CSS åŠŸèƒ½ã€‚<a href="https://github.com/css-modules/css-modules">CSS æ¨¡å— </a>æ’ä»¶ä¼šè‡ªåŠ¨æ›´æ”¹ç±»ä»¥é¿å…åç§°å†²çªã€‚<a href="https://stylelint.io/">stylelint</a> æ’ä»¶å¯è¯†åˆ« CSS ä¸­çš„é”™è¯¯å’Œä¸ä¸€è‡´çš„çº¦å®šã€‚è¿™äº›å·¥å…·åœ¨è¿‡å»ä¸€ä¸¤å¹´æ‰çœŸæ­£å¼€å§‹èµ·é£ï¼Œå±•ç¤ºäº†ä»¥å‰ä»æœªæœ‰è¿‡çš„å¼€å‘äººå‘˜å·¥ä½œæµç¨‹ï¼</p>
<p>ç„¶è€Œï¼Œè¿™ä¸€è¿›å±•æ˜¯è¦ä»˜å‡ºä»£ä»·çš„ã€‚ä¸ä½¿ç”¨ CSS é¢„å¤„ç†å™¨ç›¸æ¯”ï¼Œå®‰è£…å’Œä½¿ç”¨ CSS åå¤„ç†å™¨ï¼ˆå¦‚ PostCSSï¼‰æ›´ä¸ºå¤æ‚ã€‚æ‚¨ä¸ä»…å¿…é¡»ä½¿ç”¨å‘½ä»¤è¡Œå®‰è£…å’Œè¿è¡Œå·¥å…·ï¼Œè¿˜éœ€è¦å®‰è£…å’Œé…ç½®å•ä¸ªæ’ä»¶å¹¶å®šä¹‰ä¸€ç»„æ›´å¤æ‚çš„è§„åˆ™ï¼ˆä¾‹å¦‚æ‚¨è¦é’ˆå¯¹çš„æµè§ˆå™¨ç­‰ï¼‰ã€‚è®¸å¤šå¼€å‘äººå‘˜ä¸æ˜¯ç›´æ¥ä»å‘½ä»¤è¡Œè¿è¡ŒPostCSSï¼Œè€Œæ˜¯å°†å…¶é›†æˆåˆ°å¯é…ç½®çš„æ„å»ºç³»ç»Ÿä¸­ï¼Œå¦‚ <a href="https://github.com/postcss/postcss#runners">Grunt</a>ï¼Œ<a href="https://github.com/postcss/postcss#gulp">Gulp</a> æˆ– <a href="https://github.com/postcss/postcss#webpack">webpack</a>ï¼Œè¿™æœ‰åŠ©äºç®¡ç†æ‚¨å¯èƒ½åœ¨å‰ç«¯å·¥ä½œæµç¨‹ä¸­ä½¿ç”¨çš„æ‰€æœ‰ä¸åŒæ„å»ºå·¥å…·ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå¦‚æœæ‚¨ä»¥å‰ä»æœªä½¿ç”¨è¿‡ç°ä»£å‰ç«¯æ„å»ºç³»ç»Ÿï¼Œé‚£ä¹ˆå­¦ä¹ ä½¿ç°ä»£å‰ç«¯æ„å»ºç³»ç»Ÿå·¥ä½œçš„æ‰€æœ‰å¿…è¦éƒ¨åˆ†å¯èƒ½ä¼šéå¸¸ä¸çŸ¥æ‰€æªã€‚å¦‚æœä½ æƒ³ä»å¤´å¼€å§‹ï¼Œè¯·æŸ¥çœ‹æˆ‘çš„æ–‡ç«  <a href="https://peterxjang.com/blog/modern-javascript-explained-for-dinosaurs.html">Modern JavaScript Explain For Dinosaurs</a>ï¼Œå…¶ä¸­ä»‹ç»äº†å‰ç«¯å¼€å‘äººå‘˜åˆ©ç”¨è¿™äº›ç°ä»£åŠŸèƒ½æ‰€éœ€çš„æ‰€æœ‰ JavaScript å·¥å…·ã€‚</p>
</blockquote>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå›´ç»• CSS åå¤„ç†å™¨å­˜åœ¨ä¸€äº›äº‰è®ºã€‚æœ‰äº›äººè®¤ä¸ºè¿™ä¸ªæœ¯è¯­ä»¤äººå›°æƒ‘ï¼ˆ<a href="https://css-tricks.com/the-trouble-with-preprocessing-based-on-future-specs/">ä¸€ç§è§‚ç‚¹</a>è®¤ä¸ºå®ƒä»¬éƒ½åº”è¯¥è¢«ç§°ä¸º CSS é¢„å¤„ç†å™¨ï¼Œ<a href="https://medium.com/@ddprrt/deconfusing-pre-and-post-processing-d68e3bd078a3">å¦ä¸€ç§è§‚ç‚¹</a>æ˜¯å®ƒä»¬åº”è¯¥ç®€å•åœ°ç§°ä¸º CSS å¤„ç†å™¨ç­‰ï¼‰ã€‚æœ‰äº›äººè®¤ä¸º CSS åå¤„ç†å™¨å®Œå…¨æ¶ˆé™¤äº†å¯¹ CSS é¢„å¤„ç†å™¨çš„éœ€æ±‚ï¼Œæœ‰äº›äººè®¤ä¸ºå®ƒä»¬åº”è¯¥ä¸€èµ·ä½¿ç”¨ã€‚æ— è®ºå¦‚ä½•ï¼Œå¾ˆæ˜æ˜¾ï¼Œå¦‚æœä½ æœ‰å…´è¶£æ¨åŠ¨ CSS çš„å¯èƒ½æ€§ï¼Œé‚£ä¹ˆå­¦ä¹ å¦‚ä½•ä½¿ç”¨ CSS åå¤„ç†å™¨æ˜¯å€¼å¾—çš„ã€‚</p>
<p><img loading="lazy" src="https://peterxjang.com/img/1__53X7__j093ePj9MOxrkA5sw.png" alt="Dinosaur comic panels 3 and 4"  />
</p>
<h3 id="ä½¿ç”¨-css-æ–¹æ³•å®ç°å¯ç»´æŠ¤æ€§">ä½¿ç”¨ CSS æ–¹æ³•å®ç°å¯ç»´æŠ¤æ€§</h3>
<p>åƒ CSS é¢„å¤„ç†å™¨å’Œ CSS åå¤„ç†å™¨è¿™æ ·çš„å·¥å…·åœ¨æ”¹å–„ CSS å¼€å‘ä½“éªŒæ–¹é¢å¤§æœ‰å¸®åŠ©ã€‚ä½†æ˜¯ä»…é è¿™äº›å·¥å…·ä¸è¶³ä»¥è§£å†³ç»´æŠ¤å¤§å‹ CSS ä»£ç åº“çš„é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œäººä»¬å¼€å§‹è®°å½•å…³äºå¦‚ä½•ç¼–å†™ CSS çš„ä¸åŒæŒ‡å—ï¼Œé€šå¸¸ç§°ä¸º CSS æ–¹æ³•ã€‚</p>
<p>åœ¨æˆ‘ä»¬æ·±å…¥ç ”ç©¶ä»»ä½•ç‰¹å®šçš„ CSS æ–¹æ³•ä¹‹å‰ï¼Œé‡è¦çš„æ˜¯è¦äº†è§£æ˜¯ä»€ä¹ˆè®© CSS éšç€æ—¶é—´çš„æ¨ç§»éš¾ä»¥ç»´æŠ¤ã€‚å…³é”®é—®é¢˜æ˜¯ CSS çš„å…¨å±€æ€§è´¨ â€” æ‚¨å®šä¹‰çš„æ¯ä¸ªæ ·å¼éƒ½å…¨å±€åº”ç”¨äºé¡µé¢çš„æ¯ä¸ªéƒ¨åˆ†ã€‚ä½ çš„å·¥ä½œæ˜¯æå‡ºä¸€ä¸ªè¯¦ç»†çš„å‘½åçº¦å®šæ¥ç»´æŠ¤å”¯ä¸€çš„ç±»åï¼Œæˆ–è€…ä¸ <a href="https://www.smashingmagazine.com/2007/07/css-specificity-things-you-should-know/">ç‰¹å¼‚æ€§è§„åˆ™</a> äº‰è®ºï¼Œä»¥ç¡®å®šåº”ç”¨å“ªç§æ ·å¼æ¥åº”ç”¨ä»»ä½•ç»™å®šçš„å…ƒç´ ã€‚CSS æ–¹æ³•æä¾›äº†ä¸€ç§æœ‰ç»„ç»‡çš„æ–¹å¼æ¥ç¼–å†™ CSSï¼Œä»¥é¿å…è¿™äº›å¸¦æœ‰å¤§å‹ä»£ç åº“çš„ç—›ç‚¹ã€‚è®©æˆ‘ä»¬æŒ‰æ—¶é—´é¡ºåºå¤§è‡´çœ‹ä¸€ä¸‹ä¸€äº›æµè¡Œçš„æ–¹æ³•ã€‚</p>
<h4 id="oocss">OOCSS</h4>
<p><a href="https://github.com/stubbornella/oocss/wiki">OOCSS</a>ï¼ˆé¢å‘å¯¹è±¡çš„CSSï¼‰äº2009å¹´é¦–æ¬¡æå‡ºï¼Œæ˜¯ä¸€ç§å›´ç»•ä¸¤ä¸ªä¸»è¦åŸåˆ™ç»„ç»‡çš„æ–¹æ³•è®ºã€‚ç¬¬ä¸€ä¸ªåŸåˆ™æ˜¯åˆ†ç¦»ç»“æ„å’Œçš®è‚¤ã€‚è¿™æ„å‘³ç€å®šä¹‰ç»“æ„ï¼ˆå¦‚å¸ƒå±€ï¼‰çš„ CSS ä¸åº”ä¸å®šä¹‰çš®è‚¤çš„ CSS ï¼ˆå¦‚é¢œè‰²ã€å­—ä½“ç­‰ï¼‰æ··åˆåœ¨ä¸€èµ·ã€‚è¿™æ ·å¯ä»¥æ›´è½»æ¾åœ°â€œé‡æ–°æ¢è‚¤â€åº”ç”¨ç¨‹åºã€‚ç¬¬äºŒä¸ªåŸåˆ™æ˜¯å•ç‹¬çš„å®¹å™¨å’Œå†…å®¹ã€‚è¿™æ„å‘³ç€å°†å…ƒç´ è§†ä¸ºå¯é‡ç”¨çš„å¯¹è±¡ï¼Œå…¶å…³é”®æ€æƒ³æ˜¯æ— è®ºå¯¹è±¡åœ¨é¡µé¢ä¸Šçš„ä½ç½®å¦‚ä½•ï¼Œå®ƒéƒ½åº”è¯¥çœ‹èµ·æ¥ç›¸åŒã€‚</p>
<p>OOCSS æä¾›äº†ç»è¿‡æ·±æ€ç†Ÿè™‘çš„æŒ‡å¯¼æ–¹é’ˆï¼Œä½†å¯¹æ–¹æ³•çš„ç»†èŠ‚ä¸æ˜¯å¾ˆè§„èŒƒã€‚åæ¥çš„æ–¹æ³•ï¼Œå¦‚ SMACSS é‡‡ç”¨äº†æ ¸å¿ƒæ¦‚å¿µï¼Œå¹¶æ·»åŠ äº†æ›´å¤šç»†èŠ‚ï¼Œä½¿å…¶æ›´å®¹æ˜“ä¸Šæ‰‹ã€‚</p>
<h4 id="smacss">SMACSS</h4>
<p><a href="https://smacss.com/">SMACSS</a>ï¼ˆCSS çš„å¯æ‰©å±•å’Œæ¨¡å—åŒ–æ¶æ„ï¼‰äº 2011 å¹´æ¨å‡ºï¼Œä½œä¸ºä¸€ç§åŸºäºåœ¨ 5 ä¸ªä¸åŒç±»åˆ«ä¸­ç¼–å†™ CSS çš„æ–¹æ³•â€”â€”åŸºæœ¬è§„åˆ™ã€å¸ƒå±€è§„åˆ™ã€æ¨¡å—ã€çŠ¶æ€è§„åˆ™å’Œä¸»é¢˜è§„åˆ™ã€‚SMACSS æ–¹æ³•è¿˜æ¨èäº†ä¸€äº›å‘½åçº¦å®šã€‚å¯¹äºå¸ƒå±€è§„åˆ™ï¼Œåº”åœ¨ç±»åå‰é¢åŠ ä¸Š <code>l-</code> æˆ– <code>layout-</code> ã€‚å¯¹äºçŠ¶æ€è§„åˆ™ï¼Œåº”åœ¨æè¿°çŠ¶æ€çš„ç±»åï¼ˆå¦‚ <code>is-hidden</code> æˆ– <code>is-collapsed</code> ï¼‰å‰é¢æ·»åŠ å‰ç¼€ã€‚</p>
<p>ä¸ OOCSS ç›¸æ¯”ï¼ŒSMACSS çš„æ–¹æ³•æœ‰æ›´å¤šçš„ç»†èŠ‚ï¼Œä½†åœ¨å†³å®šå“ªäº› CSS è§„åˆ™åº”è¯¥å½’å…¥å“ªä¸ªç±»åˆ«æ—¶ï¼Œå®ƒä»ç„¶éœ€è¦ä»”ç»†è€ƒè™‘ã€‚åæ¥åƒ BEM è¿™æ ·çš„æ–¹æ³•å–æ¶ˆäº†ä¸€äº›å†³ç­–ï¼Œä½¿å…¶æ›´å®¹æ˜“é‡‡ç”¨ã€‚</p>
<h4 id="bem">BEM</h4>
<p><a href="https://en.bem.info/">BEM</a>ï¼ˆå—ï¼Œå…ƒç´ ï¼Œä¿®é¥°ç¬¦ï¼‰äº2010å¹´æ¨å‡ºï¼Œä½œä¸ºä¸€ç§å›´ç»•å°†ç”¨æˆ·ç•Œé¢åˆ’åˆ†ä¸ºç‹¬ç«‹å—çš„æƒ³æ³•ç»„ç»‡çš„æ–¹æ³•ã€‚å—æ˜¯å¯é‡ç”¨çš„ç»„ä»¶ï¼ˆä¾‹å¦‚æœç´¢è¡¨å•ï¼Œå®šä¹‰ä¸º <code>&lt;form class=&quot;search-form&quot;&gt;&lt;/form&gt;</code> ï¼‰ã€‚å…ƒç´ æ˜¯å—çš„è¾ƒå°éƒ¨åˆ†ï¼Œä¸èƒ½å•ç‹¬é‡ç”¨ï¼ˆä¾‹å¦‚æœç´¢è¡¨å•ä¸­çš„æŒ‰é’®ï¼Œå®šä¹‰ä¸º <code>&lt;button class=&quot;search-form__button&quot;&gt;Search&lt;/button&gt;</code> ï¼‰ã€‚ä¿®é¥°ç¬¦æ˜¯å®šä¹‰å—æˆ–å…ƒç´ çš„å¤–è§‚ã€çŠ¶æ€æˆ–è¡Œä¸ºçš„å®ä½“ï¼ˆä¾‹å¦‚ï¼Œå®šä¹‰ä¸º <code>&lt;button class=&quot;search-form__button search-form__button--disabled&quot;&gt;Search&lt;/button&gt;</code> çš„ç¦ç”¨æœç´¢è¡¨å•æŒ‰é’®ï¼‰ã€‚</p>
<p>BEM æ–¹æ³•æ˜“äºç†è§£ï¼Œå…·æœ‰ç‰¹å®šçš„å‘½åçº¦å®šï¼Œå…è®¸æ–°æ‰‹åº”ç”¨å®ƒï¼Œè€Œæ— éœ€åšå‡ºå¤æ‚çš„å†³ç­–ã€‚æŸäº›äººçš„ç¼ºç‚¹æ˜¯ç±»åå¯èƒ½éå¸¸å†—é•¿ï¼Œå¹¶ä¸”ä¸éµå¾ª <a href="https://css-tricks.com/semantic-class-names/">ç¼–å†™è¯­ä¹‰ç±»å</a> çš„ä¼ ç»Ÿè§„åˆ™ã€‚åæ¥çš„æ–¹æ³•ï¼Œå¦‚ Atomic CSSï¼Œå°†æŠŠè¿™ç§éä¼ ç»Ÿçš„æ–¹æ³•å¸¦åˆ°ä¸€ä¸ªå…¨æ–°çš„å±‚æ¬¡ï¼</p>
<h4 id="atomic-css">Atomic CSS</h4>
<p><a href="https://www.smashingmagazine.com/2013/10/challenging-css-best-practices-atomic-approach/">Atomic CSS</a>ï¼ˆä¹Ÿç§°ä¸ºå‡½æ•°å¼ CSSï¼‰äº2014å¹´æ¨å‡ºï¼Œä½œä¸ºä¸€ç§å›´ç»•åˆ›å»ºå°å‹å•ä¸€ç”¨é€”ç±»ï¼ˆåç§°åŸºäºè§†è§‰åŠŸèƒ½ï¼‰çš„æƒ³æ³•è¿›è¡Œç»„ç»‡çš„æ–¹æ³•ã€‚è¿™ç§æ–¹æ³•ä¸ OOCSSï¼ŒSMACS Så’Œ BEM å®Œå…¨ç›¸å - Atomic CSS ä¸æ˜¯å°†é¡µé¢ä¸Šçš„å…ƒç´ è§†ä¸ºå¯é‡ç”¨çš„å¯¹è±¡ï¼Œè€Œæ˜¯å®Œå…¨å¿½ç•¥è¿™äº›å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨å¯é‡ç”¨çš„å•ä¸€ç”¨é€”å®ç”¨ç¨‹åºç±»æ¥è®¾ç½®æ¯ä¸ªå…ƒç´ çš„æ ·å¼ã€‚å› æ­¤ï¼Œæ‚¨å°†æ‹¥æœ‰ç±»ä¼¼ <code>&lt;button class=&quot;f6 br3 ph3 pv2 white bg-purple hover-bg-light-purple&quot;&gt;Search&lt;/button&gt;</code> çš„ä¸œè¥¿ï¼Œè€Œä¸æ˜¯ <code>&lt;button class=&quot;search-form__button&quot;&gt;Search&lt;/button&gt;</code> ä¹‹ç±»çš„ä¸œè¥¿ã€‚</p>
<p>å¦‚æœä½ å¯¹è¿™ä¸ªä¾‹å­çš„ç¬¬ä¸€ååº”æ˜¯æƒŠæåœ°é€€ç¼©ï¼Œä½ å¹¶ä¸å­¤å•â€”â€”è®¸å¤šäººè®¤ä¸ºè¿™ç§æ–¹æ³•å®Œå…¨è¿åäº†æ—¢å®šçš„ CSS æœ€ä½³å®è·µã€‚ä½†æ˜¯ï¼Œå›´ç»•è´¨ç–‘è¿™äº›æœ€ä½³å®è·µåœ¨ä¸åŒåœºæ™¯ä¸­çš„æœ‰æ•ˆæ€§çš„æƒ³æ³•ï¼Œå·²ç»æœ‰å¾ˆå¤šå¾ˆå¥½çš„è®¨è®ºã€‚æœ¬æ–‡å¾ˆå¥½åœ°å¼ºè°ƒäº†ä¼ ç»Ÿçš„å…³æ³¨ç‚¹åˆ†ç¦»æœ€ç»ˆå¦‚ä½•åˆ›å»ºä¾èµ–äº HTML çš„ CSSï¼ˆå³ä½¿ä½¿ç”¨ BEM ç­‰æ–¹æ³•ï¼‰ï¼Œè€ŒåŸå­æˆ–å‡½æ•°å¼æ–¹æ³•æ˜¯åˆ›å»ºä¾èµ–äº CSS çš„ HTMLã€‚ä¸¤è€…éƒ½æ²¡æœ‰é”™ï¼Œä½†ä»”ç»†æ£€æŸ¥åï¼Œæ‚¨ä¼šå‘ç° CSS å’Œ HTML ä¹‹é—´çš„çœŸæ­£å…³æ³¨ç‚¹åˆ†ç¦»æ°¸è¿œæ— æ³•å®Œå…¨å®ç°ï¼</p>
<p>å…¶ä»– CSS æ–¹æ³•è®ºï¼Œå¦‚ JSä¸­çš„CSS ï¼Œå®é™…ä¸Šæ¥å—äº† CSS å’Œ HTML å°†å§‹ç»ˆç›¸äº’ä¾èµ–çš„æ¦‚å¿µï¼Œå¯¼è‡´äº†è¿„ä»Šä¸ºæ­¢æœ€å…·äº‰è®®çš„æ–¹æ³•ä¹‹ä¸€ã€‚</p>
<h4 id="js-ä¸­çš„-css">JS ä¸­çš„ CSS</h4>
<p><a href="http://blog.vjeux.com/2014/javascript/react-css-in-js-nationjs.html">JSä¸­çš„CSS </a> äº2014å¹´å¼•å…¥ï¼Œä½œä¸ºä¸€ç§å›´ç»•å®šä¹‰ CSS æ ·å¼è€Œä¸æ˜¯åœ¨å•ç‹¬çš„æ ·å¼è¡¨ä¸­è€Œæ˜¯ç›´æ¥åœ¨æ¯ä¸ªç»„ä»¶æœ¬èº«ä¸­å®šä¹‰çš„æ–¹æ³•ã€‚å®ƒæ˜¯ä½œä¸º <a href="https://reactjs.org/">React JavaScript æ¡†æ¶</a> çš„ä¸€ç§æ–¹æ³•å¼•å…¥çš„ï¼ˆå®ƒå·²ç»é‡‡ç”¨äº†æœ‰äº‰è®®çš„æ–¹æ³•ï¼Œå³ç›´æ¥åœ¨ JavaScript ä¸­å®šä¹‰ç»„ä»¶çš„ HTMLï¼Œè€Œä¸æ˜¯å•ç‹¬çš„ HTML æ–‡ä»¶ï¼‰ã€‚æœ€åˆè¯¥æ–¹æ³•ä½¿ç”¨å†…è”æ ·å¼ï¼Œä½†åæ¥çš„å®ç°ä½¿ç”¨ JavaScript ç”Ÿæˆ CSSï¼ˆå…·æœ‰åŸºäºç»„ä»¶çš„å”¯ä¸€ç±»åï¼‰å¹¶å°†å…¶æ’å…¥åˆ°å¸¦æœ‰æ ·å¼æ ‡ç­¾çš„æ–‡æ¡£ä¸­ã€‚</p>
<p>JS æ–¹æ³•ä¸­çš„ CSS å†æ¬¡å®Œå…¨è¿èƒŒäº†æ—¢å®šçš„ CSS å…³æ³¨ç‚¹åˆ†ç¦»æœ€ä½³å®è·µã€‚è¿™æ˜¯å› ä¸ºéšç€æ—¶é—´çš„æ¨ç§»ï¼Œæˆ‘ä»¬ä½¿ç”¨ç½‘ç»œçš„æ–¹å¼å‘ç”Ÿäº†å·¨å¤§å˜åŒ–ã€‚æœ€åˆï¼Œ Web ä¸»è¦ç”±é™æ€ç½‘ç«™ç»„æˆ - åœ¨è¿™é‡Œï¼ŒHTML å†…å®¹ä¸ CSS è¡¨ç¤ºçš„åˆ†ç¦»å¾ˆæœ‰æ„ä¹‰ã€‚å¦‚ä»Šï¼ŒWeb ç”¨äºåˆ›å»ºåŠ¨æ€ Web åº”ç”¨ç¨‹åº - åœ¨è¿™é‡Œï¼Œé€šè¿‡å¯é‡ç”¨çš„ç»„ä»¶å°†äº‹ç‰©åˆ†ç¦»å‡ºæ¥æ˜¯æœ‰æ„ä¹‰çš„ã€‚</p>
<p>JS ä¸­çš„CSS çš„ç›®æ ‡æ˜¯èƒ½å¤Ÿå®šä¹‰å…·æœ‰ç¡¬è¾¹ç•Œçš„ç»„ä»¶ï¼Œè¿™äº›è¾¹ç•Œç”±å®ƒä»¬è‡ªå·±å°è£…çš„ HTML/CSS/JS ç»„æˆï¼Œè¿™æ ·ä¸€ä¸ªç»„ä»¶ä¸­çš„ CSS å°±æ²¡æœ‰æœºä¼šå½±å“ä»»ä½•å…¶ä»–ç»„ä»¶ã€‚React æ˜¯æœ€æ—©è¢«å¹¿æ³›é‡‡ç”¨çš„æ¡†æ¶ä¹‹ä¸€ï¼Œå®ƒæ¨åŠ¨äº†è¿™äº›å…·æœ‰ç¡¬è¾¹ç•Œçš„ç»„ä»¶ï¼Œå½±å“äº†å…¶ä»–ä¸»è¦æ¡†æ¶ï¼Œå¦‚ Angularã€Ember å’Œ Vue.js æ•ˆä»¿ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒJS æ–¹æ³•ä¸­çš„ CSS æ˜¯ç›¸å¯¹è¾ƒæ–°çš„ï¼Œåœ¨è¿™ä¸ªé¢†åŸŸæœ‰å¾ˆå¤šå®éªŒæ­£åœ¨è¿›è¡Œï¼Œå› ä¸ºå¼€å‘äººå‘˜è¯•å›¾åœ¨ Web åº”ç”¨ç¨‹åºç»„ä»¶æ—¶ä»£ä¸º CSS å»ºç«‹æ–°çš„æœ€ä½³å®è·µã€‚</p>
<p>å¾ˆå®¹æ˜“è¢«è®¸å¤šä¸åŒçš„ CSS æ–¹æ³•æ‰€æ·¹æ²¡ï¼Œä½†é‡è¦çš„æ˜¯è¦è®°ä½ï¼Œæ²¡æœ‰ä¸€ç§æ­£ç¡®çš„æ–¹æ³• - ä½ åº”è¯¥å°†å®ƒä»¬è§†ä¸ºä¸åŒçš„å¯èƒ½å·¥å…·ï¼Œå½“ä½ æœ‰ä¸€ä¸ªè¶³å¤Ÿå¤æ‚çš„ CSS ä»£ç åº“æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ã€‚æœ‰ä¸åŒçš„ç»è¿‡æ·±æ€ç†Ÿè™‘çš„é€‰é¡¹å¯ä¾›é€‰æ‹©ï¼Œä»é•¿è¿œæ¥çœ‹ï¼Œè¿™ä¸ªé¢†åŸŸå‘ç”Ÿçš„æ‰€æœ‰å®éªŒéƒ½ä¼šä½¿æ¯ä¸ªå¼€å‘äººå‘˜å—ç›Šï¼</p>
<h3 id="ç»“è®º">ç»“è®º</h3>
<p>ç®€è€Œè¨€ä¹‹ï¼Œè¿™å°±æ˜¯ç°ä»£ CSSã€‚æˆ‘ä»¬ä»‹ç»äº†ä½¿ç”¨ CSS è¿›è¡Œå…·æœ‰æ’ç‰ˆå±æ€§çš„åŸºæœ¬æ ·å¼ï¼Œä½¿ç”¨ CSS è¿›è¡Œå¸ƒå±€ï¼ˆä½¿ç”¨åŸºäºæµ®ç‚¹ã€å¼¹æ€§æ¡†å’Œç½‘æ ¼çš„æ–¹æ³•ï¼‰ï¼Œä½¿ç”¨ CSS é¢„å¤„ç†å™¨å¤„ç†æ–°è¯­æ³•ï¼ˆå¦‚å˜é‡å’Œ mixinsï¼‰ï¼Œä½¿ç”¨ CSS åå¤„ç†å™¨å®ç°å˜é©æ€§åŠŸèƒ½ï¼ˆå¦‚æ·»åŠ ä¾›åº”å•†å‰ç¼€ï¼‰ï¼Œä»¥åŠä½¿ç”¨ CSS æ–¹æ³•å®ç°å¯ç»´æŠ¤æ€§ä»¥å…‹æœ CSS æ ·å¼çš„å…¨å±€æ€§è´¨ã€‚æˆ‘ä»¬æ²¡æœ‰æœºä¼šæ·±å…¥ç ”ç©¶CSSæä¾›çš„è®¸å¤šå…¶ä»–åŠŸèƒ½ï¼Œä¾‹å¦‚é«˜çº§é€‰æ‹©å™¨ï¼Œè¿‡æ¸¡ï¼ŒåŠ¨ç”»ï¼Œå½¢çŠ¶ï¼ŒåŠ¨æ€å˜é‡ - åˆ—è¡¨ä¸èƒœæšä¸¾ã€‚CSS æœ‰å¾ˆå¤šå†…å®¹éœ€è¦æ¶µç›– - ä»»ä½•è¯´å®ƒå¾ˆå®¹æ˜“çš„äººå¯èƒ½éƒ½ä¸çŸ¥é“å®ƒçš„ä¸€åŠï¼</p>
<p>ç°ä»£ CSS çš„ä½¿ç”¨è‚¯å®šä¼šä»¤äººæ²®ä¸§ï¼Œå› ä¸ºå®ƒç»§ç»­å¿«é€Ÿå˜åŒ–å’Œå‘å±•ã€‚ä½†é‡è¦çš„æ˜¯è¦è®°ä½ Web å¦‚ä½•éšç€æ—¶é—´çš„æ¨ç§»è€Œå‘å±•çš„å†å²èƒŒæ™¯ï¼Œå¾ˆé«˜å…´çŸ¥é“æœ‰å¾ˆå¤šèªæ˜çš„äººæ„¿æ„æ„å»ºå…·ä½“çš„å·¥å…·å’Œæ–¹æ³•æ¥å¸®åŠ© CSS æœ€ä½³å®è·µä¸ Web ä¸€èµ·å‘å±•ã€‚ä½œä¸ºä¸€åå¼€å‘äººå‘˜ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¿€åŠ¨äººå¿ƒçš„æ—¶åˆ»ï¼Œæˆ‘å¸Œæœ›è¿™äº›ä¿¡æ¯å¯ä»¥ä½œä¸ºè·¯çº¿å›¾ï¼Œåœ¨æ‚¨çš„æ—…ç¨‹ä¸­ä¸ºæ‚¨æä¾›å¸®åŠ©ï¼</p>
<p><img loading="lazy" src="https://peterxjang.com/img/1__7Z__JtjrzLil6LFrM7lrNJQ.png" alt="Dinosaur comic panel 5"  />
</p>
<p>å†æ¬¡ç‰¹åˆ«æ„Ÿè°¢ <a href="https://twitter.com/ryanqnorth">@ryanqnorth</a> çš„ <a href="http://www.qwantz.com/">æé¾™æ¼«ç”»</a>ï¼Œè‡ª2003å¹´ä»¥æ¥ï¼ˆå½“æé¾™ç»Ÿæ²»ç½‘ç»œæ—¶ï¼‰ï¼Œå®ƒæä¾›äº†ä¸€äº›æœ€å¥½çš„è’è¯å¹½é»˜ã€‚</p>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://peterxjang.com/blog/modern-css-explained-for-dinosaurs.html">https://peterxjang.com/blog/modern-css-explained-for-dinosaurs.html</a></p>
]]></content:encoded>
    </item>
    
    <item>
      <title>[è¯‘]ä¸ºæé¾™è§£é‡Šç°ä»£HTML</title>
      <link>https://blog.chensoul.com/posts/2023/06/20/modern-html-explained-for-dinosaurs/</link>
      <pubDate>Tue, 20 Jun 2023 09:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/06/20/modern-html-explained-for-dinosaurs/</guid>
      <description>åœ¨ä¸‰ç§ä¸»è¦çš„å‰ç«¯æŠ€æœ¯ï¼ˆ HTMLï¼ŒCSS å’Œ JavaScript ï¼‰ä¸­ï¼ŒHTML ä»ç„¶æ˜¯æœ€ä¸€è‡´çš„ã€‚å¦‚æœæ‚¨å”¯ä¸€å…³å¿ƒçš„æ˜¯åˆ›å»ºå†…å®¹ï¼Œé‚£ä¹ˆ 1990 å¹´ä»£çš„ HTML æ–‡æ¡£çœ‹èµ·æ¥ä¸ 2018 å¹´åˆ›å»ºçš„æ–‡æ¡£</description>
      <content:encoded><![CDATA[<p><img loading="lazy" src="https://peterxjang.com/img/1__EEHKg3z__FAk0ipZDFuWKcw.png" alt="Dinosaur comic panel 1"  />
</p>
<p>åœ¨ä¸‰ç§ä¸»è¦çš„å‰ç«¯æŠ€æœ¯ï¼ˆ HTMLï¼ŒCSS å’Œ JavaScript ï¼‰ä¸­ï¼ŒHTML ä»ç„¶æ˜¯æœ€ä¸€è‡´çš„ã€‚å¦‚æœæ‚¨å”¯ä¸€å…³å¿ƒçš„æ˜¯åˆ›å»ºå†…å®¹ï¼Œé‚£ä¹ˆ 1990 å¹´ä»£çš„ HTML æ–‡æ¡£çœ‹èµ·æ¥ä¸ 2018 å¹´åˆ›å»ºçš„æ–‡æ¡£éå¸¸ç›¸ä¼¼ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;utf-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>My test page<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Hello there!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>ä½ æœ‰å¸¦æœ‰æ ‡ç­¾å’Œå†…å®¹çš„å…ƒç´ ï¼Œå¸¦æœ‰å±æ€§çš„æ ‡ç­¾â€”â€”é™¤äº†ç¬¬ä¸€è¡Œçš„ç®€åŒ–æ–‡æ¡£ç±»å‹å¤–ï¼Œæ²¡æœ‰å¤ªå¤§å˜åŒ–ï¼ç„¶è€Œï¼Œå¤šå¹´æ¥ï¼ŒWeb å¼€å‘å·²ç»å‘ç”Ÿäº†å·¨å¤§çš„è½¬å˜ï¼Œä»åˆ›å»ºé™æ€ç½‘ç«™ï¼ˆä¸“æ³¨äºå†…å®¹ï¼‰åˆ°åˆ›å»ºåŠ¨æ€ Web åº”ç”¨ç¨‹åºï¼ˆä¸“æ³¨äºäº¤äº’ï¼‰â€”â€”è¿™æ˜¯ Web æœ€åˆè®¾è®¡çš„ç›®çš„ã€‚åˆ›å»ºä»ç„¶è¯­ä¹‰å’Œå¯è®¿é—®çš„è‡ªå®šä¹‰ç”¨æˆ·ç•Œé¢ï¼Œä½¿ç”¨å±æ€§å’Œå·¥å…·æé«˜æ€§èƒ½ï¼Œç»„ç»‡ä»£ç ä»¥è¿›è¡Œé‡ç”¨å’Œå¯ç»´æŠ¤æ€§ - ç°åœ¨æœ‰ä¸€ç»„å…¨æ–°çš„é—®é¢˜åœ¨èµ·ä½œç”¨ã€‚</p>
<p>æœ¬æ–‡çš„ç›®çš„æ˜¯æä¾›ä¸€ä¸ªå†å²èƒŒæ™¯ï¼Œè¯´æ˜ HTML å¦‚ä½•åœ¨2018å¹´æ¼”å˜æˆä»Šå¤©çš„è¯­è¨€ã€‚æˆ‘ä»¬å°†ä»ç»“æ„è‰¯å¥½ä¸”æ˜“äºè®¿é—®çš„ HTML çš„åŸºç¡€çŸ¥è¯†å¼€å§‹ï¼Œå°±åƒå¤ä»£çš„æé¾™ä¸€æ ·ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¸åŒçš„æŠ€æœ¯æ¥æé«˜æ€§èƒ½ã€å“åº”èƒ½åŠ›å’Œå¯ç»´æŠ¤æ€§ã€‚CSS å’Œ JavaScript å°†ä¸å¯é¿å…åœ°è¿›å…¥è¿™ä¸ªå¯¹è¯ï¼›å‡ºäºæœ¬æ–‡çš„ç›®çš„ï¼Œå°†ä»å®ƒä»¬å¦‚ä½•å½±å“ HTML æœ¬èº«ç¼–å†™çš„è§’åº¦æ¥ä»‹ç»å®ƒä»¬ã€‚é€šè¿‡äº†è§£è¿™æ®µå†å²ï¼Œæ‚¨å°†èƒ½å¤Ÿå……åˆ†åˆ©ç”¨è¯¥è¯­è¨€ç»å¸¸è¢«å¿½è§†çš„æ–°æ—§åŠŸèƒ½ã€‚è®©æˆ‘ä»¬å¼€å§‹å§ï¼</p>
<h3 id="ä½¿ç”¨è¯­ä¹‰å…ƒç´ ç¼–å†™å†…å®¹">ä½¿ç”¨è¯­ä¹‰å…ƒç´ ç¼–å†™å†…å®¹</h3>
<p>è®©æˆ‘ä»¬å‘å‰é¢çš„ HTML ç¤ºä¾‹æ·»åŠ æ›´å¤šå†…å®¹ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªåŸºæœ¬ç½‘ç«™ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªå¸¦æœ‰é“¾æ¥å’Œæœç´¢è¾“å…¥çš„å¯¼èˆªéƒ¨åˆ†ï¼Œä¸€ä¸ªç”¨äºæ˜¾ç¤ºä¸€èˆ¬ç½‘ç«™ä¿¡æ¯çš„å¤§å‹å±•ç¤ºéƒ¨åˆ†ï¼ˆé€šå¸¸ç§°ä¸ºè‹±é›„éƒ¨åˆ†æˆ– <a href="https://en.wikipedia.org/wiki/Jumbotron">å·¨å‹å±å¹•</a> ï¼‰ï¼Œæ–‡ç« çš„ä¸‰åˆ—éƒ¨åˆ†å’Œä¸€ä¸ªç‰ˆæƒä¿¡æ¯çš„é¡µè„šéƒ¨åˆ†ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;utf-8&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>My test page<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;navbar&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span>Home<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span>Info<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span>About<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">form</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;Search&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span><span class="p">&gt;</span>Search<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;main&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;hero&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Hello there!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>General info about the page goes here<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span>Learn more<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;grid&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;column&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>First Heading<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Article content goes here<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span>View details<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;column&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Second Heading<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Article content goes here<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span>View details<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;column&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Third Heading<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Article content goes here<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span>View details<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;footer&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Copyright info goes here<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨å¸¦æœ‰ <code>&lt;div&gt;</code> ã€ <code>&lt;h1&gt;</code> ã€ <code>&lt;h2&gt;</code> ã€ <code>&lt;p&gt;</code> ç­‰æ ‡ç­¾çš„åŸºæœ¬å…ƒç´ æ¥æ ‡è®°å†…å®¹ã€‚è¿™é‡Œçš„ HTML æ˜¯æœ‰æ•ˆçš„ï¼Œä½†å®ƒä¸æ˜¯å®Œå…¨è¯­ä¹‰çš„â€”â€”ä¹Ÿå°±æ˜¯è¯´ï¼Œæ ‡ç­¾ä¸èƒ½å°½å¯èƒ½åœ°ä¼ è¾¾å†…å®¹çš„å«ä¹‰ã€‚</p>
<p>å½“ HTML5 åœ¨2008å¹´æ¨å‡ºæ—¶ï¼Œå®ƒæä¾›äº†æ–°çš„å…ƒç´ æ¥æ”¹è¿›æ–‡æ¡£è¯­ä¹‰ã€‚ä»¥ä¸‹æ˜¯ä½¿ HTML æ›´å…·è¯­ä¹‰æ€§çš„å°è¯•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;utf-8&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, initial-scale=1, shrink-to-fit=no&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;description&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;author&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>My test page<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="c">&lt;!--[if lt IE 9]&gt;  
</span></span></span><span class="line"><span class="cl"><span class="c">        &lt;script src=&#34;(https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js&#34;&gt;&lt;/script&gt;  
</span></span></span><span class="line"><span class="cl"><span class="c">      &lt;![endif]--&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">nav</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;navigation&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span>Home<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span>Info<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span>About<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">form</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;Search&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span><span class="p">&gt;</span>Search<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">main</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;main&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">section</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;hero&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Hello there!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>General info about the page goes here<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span>Learn more<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">section</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;grid&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">article</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;column&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>First Heading<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Article content goes here<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span>View details<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">article</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">article</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;column&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Second Heading<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Article content goes here<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span>View details<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">article</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">article</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;column&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>Third Heading<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Article content goes here<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span>View details<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">article</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">main</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">footer</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;contentinfo&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Copyright info goes here<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">footer</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹å…¶ä¸­çš„ä¸€äº›å˜åŒ–ï¼š</p>
<ul>
<li><code>&lt;html lang=&quot;en&quot;&gt;</code> æŒ‡å®šæ–‡æ¡£çš„è¯­è¨€ï¼Œè¿™æœ‰åŠ©äºæœç´¢å¼•æ“å’Œæµè§ˆå™¨è¯†åˆ«é€‚å½“çš„å†…å®¹ã€‚</li>
<li>é¢å¤–çš„ <code>&lt;meta&gt;</code> æ ‡è®°æä¾›æœ‰å…³æœç´¢å¼•æ“å’Œå…¶ä»–æœåŠ¡åœ¨é¡µé¢ä¸Šä¸ç›´æ¥å¯è§çš„ç½‘ç«™çš„ä¿¡æ¯ã€‚å®ƒä»¬è¿˜æä¾›æœ‰å…³å¦‚ä½•è°ƒæ•´ä¸åŒè®¾å¤‡ä¸Šçš„å†…å®¹å¤§å°çš„ä¿¡æ¯ã€‚</li>
<li><code>&lt;nav&gt;</code> ã€ <code>&lt;main&gt;</code> ã€ <code>&lt;section&gt;</code> ã€ <code>&lt;article&gt;</code> å’Œ <code>&lt;footer&gt;</code> æ ‡è®°ä¸º HTML æ–‡æ¡£æä¾›äº†æ›´æ˜“äºè®¿é—®çš„ç»“æ„ï¼ˆä¸é€šç”¨çš„ <code>&lt;div&gt;</code> æ ‡è®°ç›¸æ¯”ï¼‰ã€‚è¿™äº›æ ‡ç­¾æ˜¯åœ¨HTML5ä¸­å¼•å…¥çš„ã€‚</li>
<li><code>&lt;!-- [if lt IE 9]&gt;...--&gt;</code> æ³¨é‡Šæ·»åŠ äº†ä¸€ä¸ª JavaScript æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä»…é€‚ç”¨äºæ—§ç‰ˆæœ¬çš„ Internet Explorerï¼Œå› ä¸ºå®ƒä»¬ä¸æ”¯æŒä¸Šè¿° HTML5 æ ‡ç­¾ã€‚è¯·æ³¨æ„ï¼Œå¦‚ä»Šè®¸å¤šæœ€è¿‘çš„ç½‘ç«™éƒ½æ²¡æœ‰åŒ…å«è¯¥è¯„è®ºï¼Œå› ä¸ºæ”¯æŒè¿™äº›æµè§ˆå™¨çš„ç½‘ç«™è¶Šæ¥è¶Šå°‘ã€‚</li>
<li><code>role</code> å±æ€§è¿˜æä¾›è¾…åŠ©åŠŸèƒ½ä¿¡æ¯ã€‚è¯·æ³¨æ„ï¼Œä½¿ç”¨ <code>&lt;nav&gt;</code> æ ‡è®°é€šå¸¸è¶³ä»¥ç¡®ä¿å¯è®¿é—®æ€§ï¼Œå¦‚æœæ— æ³•è¯†åˆ« <code>&lt;nav&gt;</code> æ ‡è®°ï¼Œåˆ™ä½¿ç”¨é¢å¤–çš„ <code>role=&quot;navigation&quot;</code> ã€‚</li>
</ul>
<p>ç¼–å†™è¯­ä¹‰ HTML ä¼¼ä¹å¹¶ä¸é‡è¦ï¼Œå°¤å…¶æ˜¯å½“å®ƒä¸å½±å“ç½‘ç«™çš„è§†è§‰å¤–è§‚æ—¶ã€‚ä½†æ˜¯ï¼Œæ‚¨çš„ç½‘ç«™ä¸ä»…è¢«äººç±»æŸ¥çœ‹ - ç½‘ç»œæµè§ˆå™¨ï¼Œæœç´¢å¼•æ“ï¼Œå±å¹•é˜…è¯»å™¨éƒ½ä¾èµ–äºè¯­ä¹‰HTMLæ‰èƒ½æ­£å¸¸è¿è¡Œã€‚</p>
<h3 id="ä½¿ç”¨-wai-aria-å±æ€§æ”¹è¿›å¯è®¿é—®æ€§">ä½¿ç”¨ WAI-ARIA å±æ€§æ”¹è¿›å¯è®¿é—®æ€§</h3>
<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸Šé¢ç¤ºä¾‹ä¸­å¯¼èˆªæ ä¸­çš„æœç´¢è¾“å…¥ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">form</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;Search&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span><span class="p">&gt;</span>Search<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>æ­¤è¾“å…¥å…ƒç´ ä½¿ç”¨ <code>placeholder</code> å±æ€§è€Œä¸æ˜¯æ ‡ç­¾å…ƒç´ è®©ç”¨æˆ·çŸ¥é“å…¶ç”¨é€”ã€‚è¿™é€‚ç”¨äºäººç±»ï¼Œä½†å®ƒä¸æ˜¯æ­£ç¡®çš„è¯­ä¹‰ HTMLï¼Œå±å¹•é˜…è¯»å™¨å’Œå…¶ä»–æŠ€æœ¯å¯èƒ½ä¼šé”™è¿‡ã€‚ä½¿å…¶å¯è®¿é—®çš„æ–¹æ³•æ˜¯ä½¿ç”¨ <code>aria-label</code> å±æ€§ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">form</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;Search&#34;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;Search&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span><span class="p">&gt;</span>Search<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>WAI-ARIA ä»£è¡¨â€œWeb å¯è®¿é—®æ€§å€¡è®® â€” å¯è®¿é—®çš„å¯Œäº’è”ç½‘åº”ç”¨ç¨‹åºâ€ï¼ˆé€šå¸¸ç®€ç§°ä¸º ARIAï¼‰ï¼Œæ˜¯ä¸€ç»„å±æ€§ï¼Œå½“è¯­ä¹‰æ ‡è®°ä¸å¤Ÿæ—¶ï¼Œä½¿ HTML æ›´æ˜“äºè®¿é—®ã€‚ä¸Šä¸€èŠ‚ä¸­çœ‹åˆ°çš„ <code>role</code> å±æ€§æ˜¯ ARIA å±æ€§ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¿™äº›å±æ€§ä¼¼ä¹æ˜¯å¾ˆå°çš„å˜åŒ–ï¼Œä½†æ˜¯å½“æˆ‘ä»¬ä½¿ç”¨HTMLæ¥å¤„ç†åŸºæœ¬æ–‡æ¡£ä¹‹å¤–çš„äº‹æƒ…æ—¶ï¼Œå®ƒå˜å¾—æ›´åŠ é‡è¦ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªæ›´å¤æ‚çš„ä¾‹å­â€”â€”å‡è®¾æˆ‘ä»¬æƒ³åœ¨ HTML ä¸­æ·»åŠ ä¸€äº›é€‰é¡¹å¡å¼å†…å®¹ï¼Œä»¥æä¾›æœ‰å…³å¦‚ä½•åœ¨ Windowsï¼ŒMac å’Œ Linux ä¸Šå®‰è£…æŸäº›ç¨‹åºçš„è¯´æ˜ã€‚ç”±äºæ²¡æœ‰åœ¨ HTML ä¸­æ„å»ºé€‰é¡¹å¡çš„æœ¬æœºæ–¹æ³•ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»ä½¿ç”¨æ— åºåˆ—è¡¨ã€é“¾æ¥å’Œ div ä¹‹ç±»çš„ä¸œè¥¿æ¥æ„å»ºæˆ‘ä»¬è‡ªå·±çš„é€‰é¡¹å¡æ ‡è®°ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>role</code> ã€ <code>aria-controls</code> ã€ <code>aria-selected</code> å’Œ <code>aria-labelledby</code> ç­‰å¯è®¿é—®æ€§å±æ€§æ¥æ ‡è®° HTMLï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">ul</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;tablist&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;windows-tab&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#windows&#34;</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;tab&#34;</span> <span class="na">aria-controls</span><span class="o">=</span><span class="s">&#34;windows&#34;</span> <span class="na">aria-selected</span><span class="o">=</span><span class="s">&#34;true&#34;</span><span class="p">&gt;</span>Windows<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;mac-tab&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#mac&#34;</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;tab&#34;</span> <span class="na">aria-controls</span><span class="o">=</span><span class="s">&#34;mac&#34;</span> <span class="na">aria-selected</span><span class="o">=</span><span class="s">&#34;false&#34;</span><span class="p">&gt;</span>Mac<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;linux-tab&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#linux&#34;</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;tab&#34;</span> <span class="na">aria-controls</span><span class="o">=</span><span class="s">&#34;linux&#34;</span> <span class="na">aria-selected</span><span class="o">=</span><span class="s">&#34;false&#34;</span><span class="p">&gt;</span>Linux<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;windows&#34;</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;tabpanel&#34;</span> <span class="na">aria-labelledby</span><span class="o">=</span><span class="s">&#34;windows-tab&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;http://1000logos.net/wp-content/uploads/2017/04/Microsoft-Logo.png&#34;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&#34;microsoft logo&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    ...  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;mac&#34;</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;tabpanel&#34;</span> <span class="na">aria-labelledby</span><span class="o">=</span><span class="s">&#34;mac-tab&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://i.ytimg.com/vi/ipOzBWuYZvg/maxresdefault.jpg&#34;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&#34;apple logo&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    ...  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;linux&#34;</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;tabpanel&#34;</span> <span class="na">aria-labelledby</span><span class="o">=</span><span class="s">&#34;linux-tab&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://noware.tech/wp-content/uploads/sites/140/2018/04/linux-1024x565.jpg&#34;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&#34;linux logo&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    ...  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>å¦‚æœæ²¡æœ‰è¿™äº›è¾…åŠ©åŠŸèƒ½å±æ€§ï¼Œé€‰é¡¹å¡å¼å†…å®¹å°†ä¸é€‰é¡¹å¡æ§ä»¶æ²¡æœ‰å¯è¯†åˆ«çš„å…³ç³»ã€‚å…·æœ‰è¿™äº›å±æ€§æœ‰åŠ©äºå±å¹•é˜…è¯»å™¨è¯†åˆ«å†…å®¹ï¼Œå¯ç”¨å…·æœ‰æ­£ç¡®åˆ¶è¡¨ç¬¦çš„é”®ç›˜å¿«æ·é”®ç­‰ã€‚ä½¿ç”¨é€‚å½“çš„ ARIA å±æ€§æœ¬èº«å°±æ˜¯ä¸€é¡¹å®Œæ•´çš„ç ”ç©¶â€”â€”è¦æ›´æ·±å…¥åœ°äº†è§£ï¼Œè¯·æŸ¥çœ‹ <a href="https://www.w3.org/TR/wai-aria-practices-1.1/">å®˜æ–¹æŒ‡å—</a>ã€‚</p>
<p>æ‰€æœ‰è¿™äº›ä¼¼ä¹éƒ½æ˜¯ä¸ºäº†æé«˜ç½‘ç«™çš„å¯è®¿é—®æ€§è€Œåšå¾ˆå¤šå·¥ä½œã€‚é‡è¦çš„æ˜¯è¦æ‰¿è®¤å¯è®¿é—®æ€§æ˜¯ç½‘ç»œçš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†ï¼Œç½‘ç»œè¢«è®¾è®¡ä¸ºä¸€ä¸ªä¸æ¯ä¸ªäººè‡ªç”±å…±äº«ä¿¡æ¯çš„å¹³å°ï¼Œè€Œä¸ä»…ä»…æ˜¯å°‘æ•°äººã€‚ä½¿ç½‘ç«™å¯è®¿é—®å¯ä»¥æ”¹å–„æ¯ä¸ªè®¿é—®è€…çš„ä½“éªŒ - ä¾‹å¦‚ï¼Œå¯è®¿é—®çš„é”®ç›˜å¿«æ·é”®å¯ä»¥å¸®åŠ©é‚£äº›æ°¸è¿œæ— æ³•ä½¿ç”¨é¼ æ ‡çš„äººï¼Œé‚£äº›æš‚æ—¶æ— æ³•ä½¿ç”¨é¼ æ ‡çš„äººï¼Œä»¥åŠé‚£äº›ä¸å–œæ¬¢ä¸ä½¿ç”¨é¼ æ ‡çš„äººï¼ˆä¹Ÿå°±æ˜¯å¤§å¤šæ•°ç¨‹åºå‘˜ï¼‰ã€‚åœ¨å¤„ç†å…¶ä»–åŠŸèƒ½æ—¶ï¼Œå¯è®¿é—®æ€§å¾ˆå®¹æ˜“è¢«å¿½è§†ï¼Œä½†ä¸åº”å¿½è§†ã€‚</p>
<blockquote>
<p>å¦‚æœæ‚¨æœ‰å…´è¶£æ”¹å–„ç½‘ç«™çš„å¯è®¿é—®æ€§ï¼Œé‚£ä¹ˆæœ‰ <a href="https://a11yproject.com/">A11Yé¡¹ç›®</a> ä¸­çš„æ¸…å•ï¼Œè¿™æ˜¯ <a href="https://a11yproject.com/checklist">ä¸€ä¸ª</a> å¾ˆå¥½çš„èµ·ç‚¹ã€‚ç„¶è€Œï¼Œä½¿ç½‘ç«™å¯è®¿é—®ä¸ä»…ä»…æ˜¯æ£€æŸ¥é¡¹ç›®â€”â€”å®ƒæ€»æ˜¯å¯ä»¥æ”¹è¿›çš„ï¼Œå°±åƒç”¨æˆ·ä½“éªŒçš„ä»»ä½•æ–¹é¢ä¸€æ ·ã€‚ä½¿æ‚¨çš„ç½‘ç«™å¯è®¿é—®çš„æœ€ä½³æ–¹æ³•æ˜¯å®é™…ä½¿ç”¨æ‚¨çš„ç½‘ç«™ï¼Œå°±åƒå—ä¼—ä¸­çš„ä¸åŒäººä¸€æ · - ä½¿ç”¨å±å¹•é˜…è¯»å™¨è¿›è¡Œæµ‹è¯•ï¼Œå°è¯•ä»…ä½¿ç”¨é”®ç›˜è€Œä¸æ˜¯é¼ æ ‡ï¼Œä½¿ç”¨ <a href="https://www.toptal.com/designers/colorfilter">è‰²ç›²è¿‡æ»¤å™¨</a> æŸ¥çœ‹æ‚¨çš„ç½‘ç«™ç­‰ã€‚</p>
</blockquote>
<h3 id="ç”¨csså’Œjavascriptè®©å®ƒå˜å¾—æ¼‚äº®">ç”¨CSSå’ŒJavaScriptè®©å®ƒå˜å¾—æ¼‚äº®</h3>
<p>å¦‚æœæˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢çœ‹ä¸€ä¸‹ç½‘ç«™ï¼Œå®ƒçœ‹èµ·æ¥å°±åƒä½ æœŸæœ›çš„é‚£æ ·å…‰ç§ƒç§ƒçš„ï¼š</p>
<p><img loading="lazy" src="https://peterxjang.com/img/1__VCXY__h9ynSUJ__9piFx9ATA.png" alt="Example website without styling"  />
</p>
<p>ä¸ºäº†ç¾åŒ–å®ƒï¼Œæˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ª CSS æ–‡ä»¶æ¥åº”ç”¨æ ·å¼ã€‚ç°åœ¨ï¼Œå¦‚æœä½ ä¸æ˜¯ç‰¹åˆ«æ“…é•¿ CSSï¼Œå¯èƒ½éœ€è¦å¾ˆå¤šå¤©æ‰èƒ½ä½¿è¿™ä¸ªç½‘ç«™çœ‹èµ·æ¥å¾ˆæ¼‚äº®ã€‚ä¸å…¶ç¼–å†™è‡ªå·±çš„ CSSï¼Œä¸å¦‚å§‹ç»ˆä½¿ç”¨ CSS æ¡†æ¶ï¼Œè¯¥æ¡†æ¶æœ¬è´¨ä¸Šæ˜¯å…¶ä»–äººä»¥å¯é‡ç”¨çš„æ–¹å¼ç¼–å†™çš„ CSSã€‚</p>
<p>ä¸€ä¸ªæµè¡Œçš„ CSS æ¡†æ¶æ˜¯ Bootstrapï¼Œå®ƒäº2011å¹´é—®ä¸–ï¼Œå¹¶è¿…é€Ÿè¢« <a href="https://www.ostraining.com/blog/coding/bootstrap-popularity/">æ•°ç™¾ä¸‡ä¸ªç½‘ç«™</a> é‡‡ç”¨å’Œä½¿ç”¨ã€‚è®©æˆ‘ä»¬çœ‹çœ‹ä½¿ç”¨ Bootstrap çš„ä¸€äº›ä»£ç ä¼šæ˜¯ä»€ä¹ˆæ ·å­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;utf-8&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, initial-scale=1, shrink-to-fit=no&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;description&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;author&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>My test page<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css&#34;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&#34;sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO&#34;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&#34;anonymous&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--[if lt IE 9]&gt;  
</span></span></span><span class="line"><span class="cl"><span class="c">      &lt;script src=&#34;https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js&#34;&gt;&lt;/script&gt;  
</span></span></span><span class="line"><span class="cl"><span class="c">    &lt;![endif]--&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">nav</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;navbar navbar-expand-lg navbar-light bg-light&#34;</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;navigation&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;navbar-nav mr-auto&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;nav-item active&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;nav-link&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span>Home<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;nav-item&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;nav-link&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span>Info<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;nav-item&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;nav-link&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span>About<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">form</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-inline my-2 my-lg-0&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control mr-sm-2&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;Search&#34;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;Search&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;btn btn-outline-success my-2 my-sm-0&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span><span class="p">&gt;</span>Search<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">main</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;main&#34;</span><span class="p">&gt;</span> 
</span></span><span class="line"><span class="cl">      <span class="c">&lt;!-- ... --&gt;</span> 
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">main</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">footer</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;navbar navbar-dark bg-secondary&#34;</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;contentinfo&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Copyright info goes here<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">footer</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>æ‚¨å¯ä»¥åœ¨ <a href="https://codepen.io/peterxjang/pen/jOrEpYR?editors=1000">æ­¤å¤„</a> æŸ¥çœ‹å®Œæ•´çš„ä»£ç ç¤ºä¾‹ã€‚</p>
<p>è®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹è¿™äº›æ›´æ”¹ï¼š</p>
<ul>
<li>
<p><code>&lt;head&gt;</code> æ ‡ç­¾ä¸­çš„ <code>&lt;link&gt;</code> å°† Bootstrap CSS æ·»åŠ åˆ°æˆ‘ä»¬çš„ç½‘ç«™ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬é“¾æ¥åˆ°åœ¨çº¿æ‰˜ç®¡çš„æ–‡ä»¶ï¼Œè¿™å¯èƒ½ä¼šå¸¦æ¥ä¸€äº›å®‰å…¨é£é™© - <code>integrity</code> å’Œ <code>crossorigin</code> å±æ€§æœ‰åŠ©äºç¡®ä¿é“¾æ¥åˆ°çš„æ–‡ä»¶æ­£ç¡®æ— è¯¯ã€‚</p>
</li>
<li>
<p>æ·»åŠ çš„ç±»éƒ½æ˜¯ç‰¹å®šäº Bootstrap çš„ â€” æ·»åŠ çš„ Bootstrap CSS å…·æœ‰é’ˆå¯¹å…·æœ‰ç‰¹å®š HTML ç»“æ„çš„ç‰¹å®šç±»åçš„æ ·å¼ã€‚</p>
</li>
<li>
<p>åœ¨ä¸‰ç¯‡æ–‡ç« å‘¨å›´æ·»åŠ äº†ä¸€ä¸ªé¢å¤–çš„ <code>&lt;div class=&quot;row&quot;&gt;</code> ï¼Œä»¥åˆ©ç”¨ <a href="https://getbootstrap.com/docs/4.1/layout/grid/">Bootstrap çš„ç½‘æ ¼å¸ƒå±€</a>ç³»ç»Ÿï¼ˆå®ƒä½¿ç”¨è¿™ç§ç‰¹å®šçš„ HTML ç»“æ„ï¼‰ã€‚</p>
</li>
</ul>
<p>ä»¥ä¸‹æ˜¯è¯¥ç½‘ç«™ç°åœ¨çš„æ ·å­ï¼š</p>
<p><img loading="lazy" src="https://peterxjang.com/img/1__fO1wXfiWfdv8vY3__qeQv0A.png" alt="Example website with Bootstrap styling"  />
</p>
<p>ä¸é”™ï¼è¯·æ³¨æ„ï¼Œä¸ºäº†ä½¿ç”¨åƒ Bootstrap è¿™æ ·çš„ CSS æ¡†æ¶ï¼Œæ‚¨å®é™…ä¸Šæ ¹æœ¬ä¸éœ€è¦ç¼–å†™ä»»ä½• CSS å³å¯å¼€å§‹ä½¿ç”¨ â€” æ‚¨åªéœ€è¦åœ¨ HTML ä¸­æ·»åŠ é€‚å½“çš„ç±»å³å¯åˆ©ç”¨æ¡†æ¶é™„å¸¦çš„ CSSã€‚</p>
<p>è¿™é‡Œè¦æ³¨æ„çš„ä¸€ä»¶äº‹æ˜¯ï¼Œè™½ç„¶é€‰é¡¹å¡çš„æ ·å¼æ­£ç¡®ï¼ˆä»»ä½•æ—¶å€™åªæœ‰ä¸€ä¸ªé€‰é¡¹å¡å¯è§ï¼‰ï¼Œä½†å®ƒä»¬è¿˜æ²¡æœ‰æ­£å¸¸å·¥ä½œâ€”â€”å•å‡»é€‰é¡¹å¡ä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œã€‚è¿™æ˜¯å› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ç§ç±»å‹çš„è‡ªå®šä¹‰äº¤äº’ä¸æ˜¯ç”± CSS å¤„ç†çš„ï¼Œè€Œæ˜¯ç”± JavaScript å¤„ç†çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ <code>&lt;head&gt;</code> æ ‡ç­¾ä¸­æ·»åŠ  Bootstrap æ¡†æ¶é™„å¸¦çš„ JavaScript æ–‡ä»¶æ¥è®© Bootstrap é€‰é¡¹å¡å·¥ä½œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://code.jquery.com/jquery-3.3.1.slim.min.js&#34;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&#34;sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo&#34;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&#34;anonymous&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js&#34;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&#34;sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49&#34;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&#34;anonymous&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js&#34;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&#34;sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy&#34;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&#34;anonymous&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>æœ€åä¸€ä¸ªè„šæœ¬æ˜¯ Bootstrap çš„ JavaScriptã€‚å‰ä¸¤ä¸ªæ˜¯ Bootstrap ä½¿ç”¨çš„ä¾èµ–é¡¹ï¼ˆjQuery å’Œ Popperï¼‰ï¼Œåœ¨åŠ è½½ Bootstrap è„šæœ¬ä¹‹å‰å¿…é¡»å…ˆåŠ è½½å®ƒä»¬ã€‚å¦‚æœæ‚¨æŸ¥çœ‹ <a href="https://codepen.io/peterxjang/pen/WKYxWL?editors=1000#">æ­¤å®æ—¶ç¤ºä¾‹</a>ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°é€‰é¡¹å¡ç°åœ¨å¯ä»¥å·¥ä½œäº†ï¼</p>
<p>Bootstrap è¢«å¹¿æ³›ä½¿ç”¨ï¼Œå› ä¸ºå®ƒå¸®åŠ©è§£å†³äº†å½“æ—¶ CSS çš„ä¸»è¦ç—›ç‚¹ï¼Œä¾‹å¦‚æµè§ˆå™¨ä¸ä¸€è‡´å’Œç¼ºä¹é€‚å½“çš„ç½‘æ ¼ç³»ç»Ÿã€‚ä½¿ç”¨åƒ Bootstrap è¿™æ ·çš„ CSS æ¡†æ¶æœ‰ä¸€äº›ç¼ºç‚¹â€”â€”ç‰¹åˆ«æ˜¯ï¼Œä¸ä»å¤´å¼€å§‹ç¼–å†™ CSS ç›¸æ¯”ï¼Œå®ƒä»¬å¯èƒ½éš¾ä»¥å®šåˆ¶ï¼Œè¿™å¯èƒ½ä¼šä½¿æ‚¨çš„ç½‘ç«™ä¸å…¶ä»–ç½‘ç«™ç›¸æ¯”æ˜¾å¾—é€šç”¨ã€‚</p>
<p>æ­¤å¤–ï¼Œéšç€æ™ºèƒ½æ‰‹æœºå’Œç§»åŠ¨æµé‡çš„å¢åŠ ï¼Œå‡å°‘ CSS å’Œ JS æ–‡ä»¶å¤§å°å˜å¾—è¶Šæ¥è¶Šé‡è¦ - ä»»ä½•è¶…è¿‡å‡ åƒå­—èŠ‚çš„ä¸œè¥¿éƒ½ä¼šæ˜¾ç€å½±å“è¾ƒæ…¢çš„äº’è”ç½‘è¿æ¥çš„æ€§èƒ½ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ä½¿ç”¨ Bootstrap çš„æ–¹å¼ï¼Œæˆ‘ä»¬è¦æ±‚ç”¨æˆ·ä¸‹è½½æ•´ä¸ª Bootstrap æ¡†æ¶ä¸ç«™ç‚¹ä¸€èµ·ï¼Œå³ä½¿æˆ‘ä»¬åªä½¿ç”¨å‡ ç§æ ·å¼å’ŒåŠŸèƒ½ã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»å‡ ç§æœ‰åŠ©äºè§£å†³è¿™äº›æ€§èƒ½é—®é¢˜çš„æŠ€æœ¯ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå¯¹ CSS å’Œ JavaScript çš„æ‰å®æŒæ¡ä¸ä½¿ç”¨ HTML åˆ¶ä½œå¤æ‚çš„ç½‘ç«™æœ‰ç€å†…åœ¨çš„è”ç³»;ä½†æ˜¯ï¼Œæ·±å…¥ç ”ç©¶è¿™äº›è¯­è¨€è¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äº CSS å’Œ JavaScript çš„åŸºç¡€çŸ¥è¯†ï¼Œ<a href="https://developer.mozilla.org/en-US/">MDN Web Docs</a> æ€»æ˜¯ä¸€ä¸ªä¸é”™çš„èµ·ç‚¹ã€‚å¦‚æœä½ æƒ³æ›´å¥½åœ°äº†è§£ CSS çš„æ‰€æœ‰æ–°åŠŸèƒ½ï¼ˆflexboxï¼Œgridï¼ŒSASS ç­‰ï¼‰å¦‚ä½•ä¸æ‰€æ¶‰åŠçš„æ‰€æœ‰å·¥å…·å’ŒæŠ€æœ¯ç»“åˆåœ¨ä¸€èµ·ï¼Œè¯·æŸ¥çœ‹æˆ‘çš„æ–‡ç«  <a href="https://peterxjang.com/blog/modern-css-explained-for-dinosaurs.html">Modern CSS Explain For Dinosaurs</a>ã€‚</p>
</blockquote>
<h3 id="ä½¿ç”¨-html-å±æ€§æé«˜æ€§èƒ½">ä½¿ç”¨ HTML å±æ€§æé«˜æ€§èƒ½</h3>
<p>åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªç½‘ç«™ï¼Œå…·æœ‰ç›¸å½“å¥½çš„ç»„ç»‡ï¼Œè¯­ä¹‰ HTMLã€‚å¦‚æœè¿™å°±æ˜¯æˆ‘ä»¬æ­£åœ¨è€ƒè™‘çš„å…¨éƒ¨å†…å®¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ç½‘ç«™å°±ä¼šå®Œæˆï¼ç„¶è€Œï¼Œåœ¨æ€§èƒ½ï¼ˆç½‘ç«™ä¸ºç”¨æˆ·åŠ è½½çš„é€Ÿåº¦ï¼‰å’Œå¯ç»´æŠ¤æ€§ï¼ˆå¼€å‘äººå‘˜æ›´æ”¹ä»£ç çš„éš¾æ˜“ç¨‹åº¦ï¼‰æ–¹é¢ï¼Œç½‘ç«™æœ‰è®¸å¤šæ–¹é¢å¯ä»¥æ”¹è¿›ã€‚</p>
<h4 id="è„šæœ¬çš„-defer-å±æ€§">è„šæœ¬çš„ defer å±æ€§</h4>
<p>å¯¹äºæˆ‘ä»¬çš„ç½‘ç«™ï¼Œä¸€ä¸ªä¸»è¦çš„ä¼˜åŒ–æ˜¯è§£å†³æ ‡é¢˜ä¸­åŠ è½½çš„ JavaScript æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶è¶³å¤Ÿå¤§ï¼Œå®é™…ä¸Šä¼šå‡æ…¢ç½‘ç«™çš„é€Ÿåº¦ã€‚ä¸ºäº†å‘ˆç°é¡µé¢ï¼ŒWeb æµè§ˆå™¨è¯»å–ç»™å®šçš„ HTML å¹¶å°†å…¶è½¬æ¢ä¸ºå®ƒç†è§£çš„æ ¼å¼ - æ–‡æ¡£å¯¹è±¡æ¨¡å‹æˆ– DOMã€‚å¦‚æ‚¨æ‰€æ–™ï¼ŒWeb æµè§ˆå™¨ä» HTML æ–‡æ¡£çš„é¡¶éƒ¨å¼€å§‹ï¼Œç„¶åå‘ä¸‹å·¥ä½œã€‚è¿™æ„å‘³ç€å¦‚æœå®ƒçœ‹åˆ° <code>&lt;script&gt;</code> æ ‡è®°ï¼Œå®ƒå°†ä¸‹è½½å¹¶æ‰§è¡Œè„šæœ¬ï¼Œç„¶åå†è½¬åˆ°ä¸‹ä¸€è¡Œã€‚æ‚¨å¯ä»¥åœ¨æ­¤å¤„æŸ¥çœ‹æ­¤è¿‡ç¨‹çš„æ’å›¾ï¼š</p>
<p><img loading="lazy" src="https://peterxjang.com/img/1__qo7CQsQCd__QYJchbCXLj__w.png#medium" alt="Diagram of JavaScript normal loading order"  />
</p>
<center>æ¥è‡ª hacks.mozilla.org</center>
<p>ä¸€ä¸ªå¸¸è§çš„ä¼˜åŒ–æŠ€å·§æ˜¯å°†æ‰€æœ‰ JavaScript <code>&lt;script&gt;</code> æ ‡ç­¾ç§»å‡º <code>&lt;head&gt;</code> æ ‡ç­¾å¹¶ç§»åˆ° <code>&lt;body&gt;</code> æ ‡ç­¾çš„æœ«å°¾ã€‚ä½ å¯ä»¥åœ¨ Bootstrap è‡ªå·±çš„å…¥é—¨æ¨¡æ¿ä¸­çœ‹åˆ°è¿™ä¸€ç‚¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!doctype html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- Required meta tags --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;utf-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, initial-scale=1, shrink-to-fit=no&#34;</span><span class="p">&gt;</span>    <span class="c">&lt;!-- Bootstrap CSS --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css&#34;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&#34;sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO&#34;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&#34;anonymous&#34;</span><span class="p">&gt;</span>    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Hello, world!<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Hello, world!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>    <span class="c">&lt;!-- Optional JavaScript --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- jQuery first, then Popper.js, then Bootstrap JS --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://code.jquery.com/jquery-3.3.1.slim.min.js&#34;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&#34;sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo&#34;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&#34;anonymous&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js&#34;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&#34;sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49&#34;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&#34;anonymous&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js&#34;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&#34;sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy&#34;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&#34;anonymous&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œè¿™æ˜¯ä¸€ç§ä¼˜åŒ–ï¼Œå› ä¸ºè¿™ä¸æ˜¯ HTML çš„è®¾è®¡æ–¹å¼ - CSS å’Œ JavaScript æ–‡ä»¶åº”è¯¥åœ¨<code>æ ‡ç­¾ä¸­</code>å®šä¹‰ï¼Œå¦‚å‰æ‰€è¿°ã€‚ä½†æ˜¯ï¼Œå°†æ‰€æœ‰å†…å®¹ä¿ç•™åœ¨ <code>&lt;head&gt;</code> æ ‡è®°ä¸­ä¼šäº§ç”Ÿé™ä½é¡µé¢å‘ˆç°æ€§èƒ½çš„æ„å¤–å‰¯ä½œç”¨ã€‚å°†æ‰€æœ‰ <code>&lt;script&gt;</code> ä¸ªæ ‡è®°ç§»åŠ¨åˆ° <code>&lt;body&gt;</code> ä¸ªæ ‡è®°çš„åº•éƒ¨æ˜¯æé«˜æ€§èƒ½çš„ä¸€ç§æ–¹æ³•ã€‚</p>
<p>åœ¨2018å¹´ï¼Œè®¸å¤šç½‘ç«™ä»ç„¶ä½¿ç”¨è¿™ç§å°†æ‰€æœ‰ <code>&lt;script&gt;</code> æ ‡ç­¾ç§»åŠ¨åˆ° <code>&lt;body&gt;</code> æ ‡ç­¾åº•éƒ¨çš„æŠ€å·§ã€‚ç„¶è€Œï¼Œæµè§ˆå™¨å·²ç»æ”¯æŒäº†ä¸€ç§ä¸é‚£ä¹ˆé»‘å®¢çš„æ–¹æ³•è¿‘ 10 å¹´â€”â€” <code>defer</code> å±æ€§ã€‚é€šè¿‡å°†æ­¤å±æ€§æ·»åŠ åˆ° <code>&lt;script&gt;</code> æ ‡è®°ä¸­ï¼Œæµè§ˆå™¨å°†ä¸‹è½½å¤–éƒ¨æ–‡ä»¶è€Œä¸ä¼šé˜»æ­¢æ„å»º DOM çš„å…¶ä½™éƒ¨åˆ†ï¼Œå¹¶å°†åœ¨ DOM æ„å»ºå®Œæˆåæ‰§è¡Œè„šæœ¬ã€‚æ‚¨å¯ä»¥åœ¨æ­¤å¤„æŸ¥çœ‹æ­¤è¿‡ç¨‹çš„æ’å›¾ï¼š</p>
<p><img loading="lazy" src="https://peterxjang.com/img/1__GhpdG7JTaVJ6nbbaVLkSLg.png#medium" alt="Diagram of JavaScript with defer attribute loading order"  />
</p>
<p>åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œåœ¨ <code>&lt;head&gt;</code> ä¸­ä¿ç•™ <code>&lt;script&gt;</code> ä¸ªæ ‡ç­¾å’Œ <code>defer</code> å±æ€§å°†å¯¼è‡´æ›´å¿«çš„é¡µé¢åŠ è½½é€Ÿåº¦ï¼Œå› ä¸ºæ–‡ä»¶å¯ä»¥ä¸æ­£åœ¨æ„å»ºçš„ DOM å¹¶è¡Œä¸‹è½½ã€‚è¿™å°±æ˜¯ Bootstrap çš„åˆå­¦è€…æ¨¡æ¿ä½¿ç”¨ defer å±æ€§çš„æ ·å­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!doctype html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- Required meta tags --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;utf-8&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, initial-scale=1, shrink-to-fit=no&#34;</span><span class="p">&gt;</span>    <span class="c">&lt;!-- Bootstrap CSS --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css&#34;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&#34;sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO&#34;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&#34;anonymous&#34;</span><span class="p">&gt;</span>    <span class="c">&lt;!-- Optional JavaScript --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- jQuery first, then Popper.js, then Bootstrap JS --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">defer</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://code.jquery.com/jquery-3.3.1.slim.min.js&#34;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&#34;sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo&#34;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&#34;anonymous&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">defer</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js&#34;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&#34;sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49&#34;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&#34;anonymous&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">defer</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js&#34;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&#34;sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy&#34;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&#34;anonymous&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Hello, world!<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Hello, world!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>è¿™æ ·åšçš„å¥½å¤„æ˜¯ç½‘ç«™ä¼šæ¸²æŸ“å¾—æ›´å¿«ï¼Œå¹¶ä¸”å®ƒä¼šæŒ‰é¢„æœŸä½¿ç”¨ <code>&lt;head&gt;</code> æ ‡è®°ä¸­çš„è„šæœ¬ç»„ç»‡ HTMLã€‚ä¸ºäº†æ›´ç²¾ç»†åœ°æ§åˆ¶å“ªäº›æ–‡ä»¶ä»¥ä»€ä¹ˆé¡ºåºä¸‹è½½å’Œæ‰§è¡Œï¼Œè¿˜æœ‰ <code>async</code> å±æ€§ä»¥åŠ <code>&lt;link&gt;</code> ä¸ªæ ‡ç­¾çš„ <code>rel=&quot;preload&quot;</code> å±æ€§ï¼ˆæ‚¨å¯ä»¥åœ¨ <a href="https://hacks.mozilla.org/2017/09/building-the-dom-faster-speculative-parsing-async-defer-and-preload/">æ­¤å¤„</a> é˜…è¯»æ›´å¤šç›¸å…³ä¿¡æ¯ï¼‰ã€‚</p>
<h4 id="å›¾åƒçš„-srcset-å±æ€§">å›¾åƒçš„ srcset å±æ€§</h4>
<p>å¯¹äºæˆ‘ä»¬çš„ç½‘ç«™ï¼Œå¦ä¸€ä¸ªä¸»è¦çš„æ€§èƒ½ä¼˜åŒ–æ˜¯å›¾åƒã€‚ç°åœ¨ï¼Œè¿™äº›å›¾åƒæ­£åœ¨è¢«â€œçƒ­é“¾æ¥â€ï¼Œè¿™æ„å‘³ç€å®ƒä»¬è¢«ç›´æ¥é“¾æ¥åˆ°å…¶ä»–äººçš„ç½‘ç«™ä¸Šã€‚è¿™ä¸ä»…ä»ç»´æŠ¤çš„è§’åº¦æ¥çœ‹æ˜¯æœ‰é—®é¢˜çš„ï¼ˆå¦‚æœå…¶ä»–äººæ”¹å˜ä»–ä»¬çš„å½¢è±¡ï¼Œå°±ä¼šç ´åæˆ‘ä»¬çš„ç½‘ç«™ï¼‰ï¼Œä»æ€§èƒ½çš„è§’åº¦æ¥çœ‹ï¼Œå®ƒä¹Ÿå¯èƒ½æ˜¯æœ‰é—®é¢˜çš„ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä¸‹è½½æ–‡ä»¶å¹¶åœ¨æœ¬åœ°é“¾æ¥åˆ°å®ƒä»¬ï¼Œè€Œä¸æ˜¯ç›´æ¥é“¾æ¥æ–‡ä»¶ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†å›¾åƒæ–‡ä»¶å¤§å°è°ƒæ•´ä¸ºé€‚å½“çš„åˆ†è¾¨ç‡æ¥ä¼˜åŒ–å›¾åƒæ–‡ä»¶å¤§å°ã€‚è€Œä¸æ˜¯ç›´æ¥é“¾æ¥åˆ°å¦ä¸€ä¸ªç½‘ç«™ä¸Šçš„å•ä¸ªå›¾åƒçš„å›¾åƒæ ‡ç­¾ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">img</span> 
</span></span><span class="line"><span class="cl">  <span class="na">class</span><span class="o">=</span><span class="s">&#34;img-fluid&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="na">src</span><span class="o">=</span><span class="s">&#34;http://1000logos.net/wp-content/uploads/2017/04/Microsoft-Logo.png&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="na">alt</span><span class="o">=</span><span class="s">&#34;microsoft logo&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">&gt;</span>
</span></span></code></pre></div><p>æˆ‘ä»¬å¯ä»¥åœ¨æœ¬åœ°åˆ›å»ºå›¾åƒçš„å¤šä¸ªç‰ˆæœ¬ï¼Œå¹¶å“åº”å¼åœ°é“¾æ¥åˆ°å®ƒä»¬ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">img</span>
</span></span><span class="line"><span class="cl">  <span class="na">class</span><span class="o">=</span><span class="s">&#34;img-fluid&#34;</span>  
</span></span><span class="line"><span class="cl">  <span class="na">src</span><span class="o">=</span><span class="s">&#34;microsoft-logo-small.png&#34;</span>  
</span></span><span class="line"><span class="cl">  <span class="na">srcset</span><span class="o">=</span><span class="s">&#34;microsoft-logo-medium.png 1000w, microsoft-logo-large.png 2000w&#34;</span>  
</span></span><span class="line"><span class="cl">  <span class="na">alt</span><span class="o">=</span><span class="s">&#34;microsoft logo&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">&gt;</span>
</span></span></code></pre></div><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨å¾½æ ‡çš„å°å‹ã€ä¸­å‹å’Œå¤§å‹ç‰ˆæœ¬ã€‚ <code>srcset</code> å±æ€§å‘Šè¯‰æµè§ˆå™¨æ ¹æ®æµè§ˆå™¨å®½åº¦åŠ è½½é€‚å½“çš„ç‰ˆæœ¬ã€‚ <code>srcset</code> å±æ€§æ˜¯åœ¨ 2013 å¹´å·¦å³å¼•å…¥çš„ï¼Œä½†æµè§ˆå™¨èŠ±äº†å‡ å¹´æ—¶é—´æ‰å®Œå…¨æ”¯æŒå®ƒã€‚æˆªè‡³2018å¹´ï¼Œå®ƒå…·æœ‰ <a href="https://caniuse.com/#feat=srcset">ç›¸å½“ä¸é”™çš„æµè§ˆå™¨æ”¯æŒ</a> ï¼Œå› æ­¤ç»å¯¹å€¼å¾—å°†å…¶ä½œä¸ºå·¥ä½œæµç¨‹çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p>å¯¹äºè®¸å¤šç½‘ç«™æ¥è¯´ï¼Œä¼˜åŒ–å›¾åƒå¤§å°é€šå¸¸æ˜¯æœ€å¤§çš„æ€§èƒ½æå‡â€”â€”å›¾åƒä¸‹è½½å¤§å°é€šå¸¸æ¯”ä»»ä½• JavaScript å’Œ CSS æ–‡ä»¶å¤§å‡ ä¸ªæ•°é‡çº§ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ <code>&lt;picture&gt;</code> å…ƒç´ å¯¹å›¾åƒè¿›è¡Œæ›´ç²¾ç»†çš„æ§åˆ¶;ä½†æ˜¯ï¼Œå¯¹äºå¤§å¤šæ•°ç”¨ä¾‹æ¥è¯´ï¼Œä½¿ç”¨ç®€å•çš„ <code>srcset</code> å±æ€§ <a href="https://css-tricks.com/responsive-images-youre-just-changing-resolutions-use-srcset/">é€šå¸¸ç»°ç»°æœ‰ä½™</a>ã€‚</p>
<h4 id="å…¶ä»–-html-å±æ€§">å…¶ä»– HTML å±æ€§</h4>
<p>ä½œä¸ºä¸€ç§è¯­è¨€ï¼ŒHTML å…·æœ‰ <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Attributes">è®¸å¤šå±æ€§</a> ï¼Œå¹¶ç»§ç»­æ·»åŠ å¯ç”¨äºæé«˜æ€§èƒ½çš„æ–°å±æ€§ï¼ˆå¦‚ <code>importance</code> å’Œ <code>lazyload</code> ï¼‰ã€‚è™½ç„¶è¿™å¯èƒ½ä»¤äººç”Ÿç•ï¼Œä½†ä¸“æ³¨äºä¸‹è½½å¤§å°ï¼ˆå›¾åƒå’Œè„šæœ¬ï¼‰æ–¹é¢çš„æœ€å¤§èµ„æºï¼Œæ— è®ºå®ƒä»¬å¯èƒ½é€‚ç”¨äºæ‚¨çš„ç‰¹å®šç½‘ç«™ï¼Œé€šå¸¸æ˜¯æœ€å¥½çš„èµ·ç‚¹ã€‚</p>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œå°±åƒå¯è®¿é—®æ€§ä¸€æ ·ï¼Œæ²¡æœ‰ä¸€å¥—å…¨é¢çš„æ€§èƒ½è§„åˆ™å§‹ç»ˆé€‚ç”¨äºæ¯ä¸ªç½‘ç«™â€”â€”æ‚¨åº”è¯¥å¯¹æ‚¨çš„ç½‘ç«™è¿›è¡ŒåŸºå‡†æµ‹è¯•ä»¥ç¡®å®šæœ€æœ‰æ•ˆçš„æ–¹æ³•ï¼ˆChrome å’Œ Firefox ç­‰æµè§ˆå™¨æä¾›æ­¤ç±»å·¥å…·ï¼‰ã€‚åŒæ ·ï¼Œæœ€å¥½çš„æ–¹æ³•æ˜¯ç®€å•åœ°åœ¨æ…¢é€Ÿç½‘ç»œæ¡ä»¶ä¸‹ä½¿ç”¨æ‚¨çš„ç½‘ç«™ï¼ˆæµè§ˆå™¨çš„å¼€å‘å·¥å…·å¯ä»¥æ¨¡æ‹Ÿï¼‰â€”â€”å¦‚æœæ‚¨åœ¨æ…¢é€Ÿç½‘ç»œæ¡ä»¶ä¸‹ä½¿ç”¨è‡ªå·±çš„ç½‘ç«™å³ä½¿åªæ˜¯ä¸€å‘¨ï¼Œæ‚¨å¾ˆå¯èƒ½ä¼šæ‰¾åˆ°å¤§é‡æ€§èƒ½ä¿®å¤æ¥æ”¹å–„å…¶ä½“éªŒã€‚</p>
</blockquote>
<h3 id="ä½¿ç”¨å·¥å…·æé«˜æ€§èƒ½">ä½¿ç”¨å·¥å…·æé«˜æ€§èƒ½</h3>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨ä½¿ç”¨ HTML è¯­è¨€æä¾›çš„å·¥å…·æ¥ä¼˜åŒ–æ€§èƒ½ã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨å¤–éƒ¨å·¥å…·è·å¾—æ›´å¤šæ€§èƒ½ä¼˜åŠ¿ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹å‡ ç§å¸¸ç”¨çš„æ–¹æ³•ã€‚</p>
<h4 id="ä»£ç ç¼©å°">ä»£ç ç¼©å°</h4>
<p>ä¸€ä¸ªé‡è¦çš„æ€§èƒ½ä¼˜åŒ–æ˜¯ JavaScript å’Œ CSS ä»£ç çš„ç¼©å°ï¼ˆæœ‰æ—¶ç§°ä¸ºä¸‘åŒ–ï¼‰ã€‚è¿™æ¶‰åŠä½¿ç”¨ç¨‹åºæ¥åˆ†æå’Œåˆ é™¤ä»£ç ä¸­ä¸å¿…è¦æˆ–å†—ä½™çš„æ•°æ®ï¼Œä»ç®€å•çš„äº‹æƒ…ï¼ˆå¦‚åˆ é™¤ä¸éœ€è¦çš„ç©ºæ ¼ï¼‰åˆ°å¤æ‚çš„äº‹æƒ…ï¼Œå¦‚å°½å¯èƒ½å°†é•¿å˜é‡é‡å‘½åä¸ºå•ä¸ªå­—ç¬¦ã€‚ä¸‹é¢æ˜¯ Douglas Crockford åœ¨ <a href="http://www.crockford.com/javascript/jsmin.html">2003 å¹´å‘å¸ƒ</a> çš„ç¬¬ä¸€ä¸ª JavaScript ç¼©å‡å™¨çš„ç¤ºä¾‹ã€‚ç¤ºä¾‹æœªç¼©å°çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// is.js  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  
</span></span><span class="line"><span class="cl"><span class="c1">// (c) 2001 Douglas Crockford  
</span></span></span><span class="line"><span class="cl"><span class="c1">// 2001 June 3  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="c1">// is  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  
</span></span><span class="line"><span class="cl"><span class="c1">// The -is- object is used to identify the browser.  Every browser edition  
</span></span></span><span class="line"><span class="cl"><span class="c1">// identifies itself, but there is no standard way of doing it, and some of  
</span></span></span><span class="line"><span class="cl"><span class="c1">// the identification is deceptive. This is because the authors of web  
</span></span></span><span class="line"><span class="cl"><span class="c1">// browsers are liars. For example, Microsoft&#39;s IE browsers claim to be  
</span></span></span><span class="line"><span class="cl"><span class="c1">// Mozilla 4. Netscape 6 claims to be version 5.  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">is</span> <span class="o">=</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">ie</span><span class="o">:</span>      <span class="nx">navigator</span><span class="p">.</span><span class="nx">appName</span> <span class="o">==</span> <span class="s1">&#39;Microsoft Internet Explorer&#39;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">java</span><span class="o">:</span>    <span class="nx">navigator</span><span class="p">.</span><span class="nx">javaEnabled</span><span class="p">(),</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">ns</span><span class="o">:</span>      <span class="nx">navigator</span><span class="p">.</span><span class="nx">appName</span> <span class="o">==</span> <span class="s1">&#39;Netscape&#39;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">ua</span><span class="o">:</span>      <span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">(),</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">version</span><span class="o">:</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">appVersion</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">21</span><span class="p">))</span> <span class="o">||</span>  
</span></span><span class="line"><span class="cl">             <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">appVersion</span><span class="p">),</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">win</span><span class="o">:</span>     <span class="nx">navigator</span><span class="p">.</span><span class="nx">platform</span> <span class="o">==</span> <span class="s1">&#39;Win32&#39;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>  
</span></span><span class="line"><span class="cl"><span class="nx">is</span><span class="p">.</span><span class="nx">mac</span> <span class="o">=</span> <span class="nx">is</span><span class="p">.</span><span class="nx">ua</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;mac&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">is</span><span class="p">.</span><span class="nx">ua</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;opera&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">is</span><span class="p">.</span><span class="nx">ie</span> <span class="o">=</span> <span class="nx">is</span><span class="p">.</span><span class="nx">ns</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">is</span><span class="p">.</span><span class="nx">opera</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>  
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">is</span><span class="p">.</span><span class="nx">ua</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;gecko&#39;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">is</span><span class="p">.</span><span class="nx">ie</span> <span class="o">=</span> <span class="nx">is</span><span class="p">.</span><span class="nx">ns</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">is</span><span class="p">.</span><span class="nx">gecko</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>ç¼©å°åçš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">is</span><span class="o">=</span><span class="p">{</span><span class="nx">ie</span><span class="o">:</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">appName</span><span class="o">==</span><span class="s1">&#39;Microsoft Internet Explorer&#39;</span><span class="p">,</span><span class="nx">java</span><span class="o">:</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">javaEnabled</span><span class="p">(),</span><span class="nx">ns</span><span class="o">:</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">appName</span><span class="o">==</span><span class="s1">&#39;Netscape&#39;</span><span class="p">,</span><span class="nx">ua</span><span class="o">:</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">userAgent</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">(),</span><span class="nx">version</span><span class="o">:</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">appVersion</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">21</span><span class="p">))</span><span class="o">||</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">appVersion</span><span class="p">),</span><span class="nx">win</span><span class="o">:</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">platform</span><span class="o">==</span><span class="s1">&#39;Win32&#39;</span><span class="p">}</span>  
</span></span><span class="line"><span class="cl"><span class="nx">is</span><span class="p">.</span><span class="nx">mac</span><span class="o">=</span><span class="nx">is</span><span class="p">.</span><span class="nx">ua</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;mac&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">is</span><span class="p">.</span><span class="nx">ua</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;opera&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">){</span><span class="nx">is</span><span class="p">.</span><span class="nx">ie</span><span class="o">=</span><span class="nx">is</span><span class="p">.</span><span class="nx">ns</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span><span class="nx">is</span><span class="p">.</span><span class="nx">opera</span><span class="o">=</span><span class="kc">true</span><span class="p">;}</span>  
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="p">(</span><span class="nx">is</span><span class="p">.</span><span class="nx">ua</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;gecko&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">){</span><span class="nx">is</span><span class="p">.</span><span class="nx">ie</span><span class="o">=</span><span class="nx">is</span><span class="p">.</span><span class="nx">ns</span><span class="o">=</span><span class="kc">false</span><span class="p">;</span><span class="nx">is</span><span class="p">.</span><span class="nx">gecko</span><span class="o">=</span><span class="kc">true</span><span class="p">;}</span>
</span></span></code></pre></div><p>è¿™äº›æ›´æ”¹ç¡®å®åŠ èµ·æ¥ â€” ä»æˆ‘ä»¬ä¹‹å‰çš„ç¤ºä¾‹æ¥çœ‹ï¼Œæœªç¼©å°çš„ <code>bootstrap.js</code> çš„å¤§å°ä¸º 124 KBï¼Œè€Œç¼©å°çš„ <code>bootstrap.min.js</code> çš„å¤§å°ä¸º 51 KBã€‚è¿™è¿˜ä¸åˆ°åŸæ¥å°ºå¯¸çš„ä¸€åŠâ€”â€”ä½¿ç”¨<a href="https://www.youtube.com/watch?v=kgv7U3GYlDY">Grabtharâ€™s hammer</a>ï¼ŒçœŸæ˜¯çœé’±ï¼ä½†è¯´çœŸçš„ï¼Œå®ƒåœ¨ç½‘ç«™ä¸‹è½½å’Œæ˜¾ç¤ºçš„é€Ÿåº¦æ–¹é¢æœ‰å¾ˆå¤§çš„ä¸åŒï¼Œå°¤å…¶æ˜¯åœ¨äº’è”ç½‘è¿æ¥é€Ÿåº¦è¾ƒæ…¢çš„æƒ…å†µä¸‹ã€‚</p>
<p>æˆ‘ä»¬åœ¨å‰é¢çš„ä¾‹å­ä¸­ä½¿ç”¨çš„ Bootstrap CSS å’Œ JavaScript å·²ç»ç¼©å°äº†ï¼Œä½†å¦‚æœä½ æƒ³ç¼©å°è‡ªå·±çš„ä»£ç ï¼Œä½ å¯ä»¥ä½¿ç”¨ <a href="https://javascript-minifier.com/">JavaScript Minifier</a> æˆ– <a href="https://www.minifier.org/">Minify</a> ç­‰åœ¨çº¿å·¥å…·ï¼Œæœ‰å¾ˆå¤šå¯ä¾›é€‰æ‹©ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·ï¼Œè¯¥å·¥å…·å¯ä»¥èŠ‚çœå°†ä»£ç å¤åˆ¶åˆ°ç½‘ç«™çš„è¿‡ç¨‹ã€‚</p>
<h4 id="æ–‡ä»¶ä¸²è”">æ–‡ä»¶ä¸²è”</h4>
<p>å¦ä¸€ä¸ªç›¸å…³çš„æ€§èƒ½ä¼˜åŒ–æ˜¯ä¸²è”ï¼Œå®ƒå°†å¤šä¸ª JavaScript æ–‡ä»¶ï¼ˆæˆ– CSS æ–‡ä»¶ï¼‰è½¬æ¢ä¸ºå•ä¸ªæ–‡ä»¶ã€‚æµè§ˆå™¨ä¸‹è½½å•ä¸ªæ–‡ä»¶çš„é€Ÿåº¦æ¯”ä¸‹è½½å¤šä¸ªå°æ–‡ä»¶æ›´å¿«ï¼Œè¿™æ˜¯åŸºäºæµè§ˆå™¨è‡ª 1999 å¹´ä»¥æ¥ä½¿ç”¨çš„ HTTP/1.1 åè®®ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ–°ç‰ˆæœ¬çš„åè®® HTTP/2 äº 2015 å¹´å‘å¸ƒï¼Œå¯èƒ½ä¼šæ”¹å˜æ­¤ä¼˜åŒ–ã€‚HTTP / 2å…è®¸å¤šä¸ªåŒæ—¶è¿æ¥ï¼Œå› æ­¤ç†è®ºä¸Šæœ€å¥½æœ‰å¤šä¸ªå°æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå¤§çº§è”æ–‡ä»¶ã€‚ç„¶è€Œï¼Œåœ¨å®è·µä¸­ï¼Œå®ƒ <a href="http://engineering.khanacademy.org/posts/js-packaging-http2.htm">ä¼¼ä¹å¹¶ä¸é‚£ä¹ˆç®€å•</a>ï¼Œå› ä¸ºä¸²è”ä»ç„¶æœ‰é‡è¦çš„å¥½å¤„ã€‚æˆªè‡³2018å¹´ï¼Œè¿æ¥ JavaScript å’Œ CSS æ–‡ä»¶ä»ç„¶æ˜¯å¸¸è§çš„åšæ³•ã€‚</p>
<p>è¦è¿æ¥æ‚¨çš„æ–‡ä»¶ï¼Œç†è®ºä¸Šæ‚¨å¯ä»¥æ‰‹åŠ¨å®Œæˆ - å°†æ¯ä¸ª JavaScript æ–‡ä»¶çš„å†…å®¹å¤åˆ¶åˆ°å•ä¸ªæ–‡ä»¶ä¸­ï¼Œå¯¹ CSS æ–‡ä»¶é‡å¤æ­¤æ“ä½œï¼Œç­‰ç­‰ã€‚ç„¶åä¿®æ”¹ HTML ä»¥é“¾æ¥åˆ°å•ä¸ªä¸²è”çš„ JavaScript æ–‡ä»¶å’Œå•ä¸ªä¸²è”çš„ CSS æ–‡ä»¶ã€‚æ¯æ¬¡éƒ¨ç½²åº”ç”¨ç¨‹åºæ—¶éƒ½å¿…é¡»æ‰§è¡Œæ­¤æ“ä½œï¼Œç»´æŠ¤èµ·æ¥ä¼šéå¸¸ç—›è‹¦ - æœ€å¥½ä½¿ç”¨ä¸€äº›è‡ªåŠ¨åŒ–è¿‡ç¨‹ï¼ˆæ›´å¤šå†…å®¹è§ä¸‹æ–‡ï¼‰ã€‚</p>
<h4 id="å…³é”®-css">å…³é”® CSS</h4>
<p>è¿‘å¹´æ¥æµè¡Œçš„å¦ä¸€ä¸ªä¼˜åŒ–æ˜¯å†…è”é¡µé¢çš„å…³é”® CSSã€‚è¿™æ¶‰åŠä½¿ç”¨å·¥å…·æ¥è¯†åˆ«ç”¨æˆ·åœ¨è®¿é—®ç½‘é¡µæ—¶é¦–å…ˆçœ‹åˆ°çš„æ‰€æœ‰ HTML å…ƒç´ ï¼š</p>
<p><img loading="lazy" src="https://peterxjang.com/img/1__eqFRbhOchUMNGLj9lisEqQ.jpeg#medium" alt="Example website labelling critical portion"  />
</p>
<center>æ¥è‡ª https://www.smashingmagazine.com/2015/08/understanding-critical-css/</center>
<p>ä¸€æ—¦è¯†åˆ«å‡ºè¿™äº› HTMLå…ƒç´ ï¼Œè¯¥å·¥å…·å°†æ‰¾åˆ°å½±å“è¿™äº›å…ƒç´ çš„æ‰€æœ‰ CSSï¼Œå¹¶å°†å®ƒä»¬ç›´æ¥æ·»åŠ åˆ° HTML æ–‡ä»¶ä¸­ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæµè§ˆå™¨èƒ½å¤Ÿæ˜¾ç¤ºä¸€ä¸ªå®Œå…¨æ ·å¼çš„ç½‘ç«™ï¼Œè€Œæ— éœ€ç­‰å¾…å‰©ä½™çš„ CSS ä¸‹è½½ï¼</p>
<p>æœ‰ä¸åŒçš„å·¥å…·å¯ä»¥å¸®åŠ©æ‚¨è¯†åˆ« <a href="https://github.com/addyosmani/critical">å…³é”®</a> CSSï¼Œä» Addy Osmani çš„åŸºäºèŠ‚ç‚¹çš„å…³é”®åº“åˆ° Jonas Ohlsson Aden çš„åŸºäº <a href="https://jonassebastianohlsson.com/criticalpathcssgenerator/">Web çš„å…³é”®è·¯å¾„ CSS ç”Ÿæˆå™¨</a>ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬ä¹‹å‰ Bootstrap ç¤ºä¾‹ä¸­çš„ HTML <code>&lt;head&gt;</code> å…ƒç´ åœ¨é€šè¿‡<a href="https://github.com/addyosmani/critical">å…³é”®</a>å·¥å…·åˆ†æåçš„å¤–è§‚ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;utf-8&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, initial-scale=1, shrink-to-fit=no&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;description&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;author&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>My test page<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">:</span><span class="nd">root</span><span class="p">{</span><span class="nv">--blue</span><span class="p">:</span><span class="mh">#007bff</span><span class="p">;</span><span class="nv">--indigo</span><span class="p">:</span><span class="mh">#6610f2</span><span class="p">;</span><span class="nv">--purple</span><span class="p">:</span><span class="mh">#6f42c1</span><span class="p">;</span><span class="nv">--pink</span><span class="p">:</span><span class="mh">#e83e8c</span><span class="p">;</span><span class="nv">--red</span><span class="p">:</span><span class="mh">#dc3545</span><span class="p">;</span><span class="nv">--orange</span><span class="p">:</span><span class="mh">#fd7e14</span><span class="p">;</span><span class="nv">--yellow</span><span class="p">:</span><span class="mh">#ffc107</span><span class="p">;</span><span class="nv">--green</span><span class="p">:</span><span class="mh">#28a745</span><span class="p">;</span><span class="nv">--teal</span><span class="p">:</span><span class="mh">#20c997</span><span class="p">;</span><span class="nv">--cyan</span><span class="p">:</span><span class="mh">#17a2b8</span><span class="p">;</span><span class="nv">--white</span><span class="p">:</span><span class="mh">#fff</span><span class="p">;</span><span class="nv">--gray</span><span class="p">:</span><span class="mh">#6c757d</span><span class="p">;</span><span class="nv">--gray-dark</span><span class="p">:</span><span class="mh">#343a40</span><span class="p">;</span><span class="nv">--primary</span><span class="p">:</span><span class="mh">#007bff</span><span class="p">;</span><span class="nv">--secondary</span><span class="p">:</span><span class="mh">#6c757d</span><span class="p">;</span><span class="nv">--success</span><span class="p">:</span><span class="mh">#28a745</span><span class="p">;</span><span class="nv">--info</span><span class="p">:</span><span class="mh">#17a2b8</span><span class="p">;</span><span class="nv">--warning</span><span class="p">:</span><span class="mh">#ffc107</span><span class="p">;</span><span class="nv">--danger</span><span class="p">:</span><span class="mh">#dc3545</span><span class="p">;</span><span class="nv">--light</span><span class="p">:</span><span class="mh">#f8f9fa</span><span class="p">;</span><span class="nv">--dark</span><span class="p">:</span><span class="mh">#343a40</span><span class="p">;</span><span class="nv">--breakpoint-xs</span><span class="p">:</span><span class="mi">0</span><span class="p">;</span><span class="nv">--breakpoint-sm</span><span class="p">:</span><span class="mi">576</span><span class="kt">px</span><span class="p">;</span><span class="nv">--breakpoint-md</span><span class="p">:</span><span class="mi">768</span><span class="kt">px</span><span class="p">;</span><span class="nv">--breakpoint-lg</span><span class="p">:</span><span class="mi">992</span><span class="kt">px</span><span class="p">;</span><span class="nv">--breakpoint-xl</span><span class="p">:</span><span class="mi">1200</span><span class="kt">px</span><span class="p">;</span><span class="nv">--font-family-sans-serif</span><span class="p">:</span><span class="o">-</span><span class="n">apple-system</span><span class="p">,</span><span class="n">BlinkMacSystemFont</span><span class="p">,</span><span class="s2">&#34;Segoe UI&#34;</span><span class="p">,</span><span class="n">Roboto</span><span class="p">,</span><span class="s2">&#34;Helvetica Neue&#34;</span><span class="p">,</span><span class="n">Arial</span><span class="p">,</span><span class="kc">sans-serif</span><span class="p">,</span><span class="s2">&#34;Apple Color Emoji&#34;</span><span class="p">,</span><span class="s2">&#34;Segoe UI Emoji&#34;</span><span class="p">,</span><span class="s2">&#34;Segoe UI Symbol&#34;</span><span class="p">,</span><span class="s2">&#34;Noto Color Emoji&#34;</span><span class="p">;</span><span class="nv">--font-family-monospace</span><span class="p">:</span><span class="n">SFMono-Regular</span><span class="p">,</span><span class="n">Menlo</span><span class="p">,</span><span class="n">Monaco</span><span class="p">,</span><span class="n">Consolas</span><span class="p">,</span><span class="s2">&#34;Liberation Mono&#34;</span><span class="p">,</span><span class="s2">&#34;Courier New&#34;</span><span class="p">,</span><span class="kc">monospace</span><span class="p">}</span><span class="err">\</span><span class="o">*,</span><span class="p">::</span><span class="nd">after</span><span class="o">,</span><span class="p">::</span><span class="nd">before</span><span class="p">{</span><span class="k">box-sizing</span><span class="p">:</span><span class="kc">border-box</span><span class="p">}</span><span class="nt">html</span><span class="p">{</span><span class="k">font-family</span><span class="p">:</span><span class="kc">sans-serif</span><span class="p">;</span><span class="k">line-height</span><span class="p">:</span><span class="mf">1.15</span><span class="p">;</span><span class="kp">-webkit-</span><span class="n">text-size-adjust</span><span class="p">:</span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span><span class="kp">-ms-</span><span class="n">text-size-adjust</span><span class="p">:</span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span><span class="kp">-ms-</span><span class="k">overflow-style</span><span class="p">:</span><span class="n">scrollbar</span><span class="p">}@</span><span class="k">-ms-viewport</span><span class="p">{</span><span class="nt">width</span><span class="p">:</span><span class="nd">device-width</span><span class="p">}</span><span class="nt">article</span><span class="o">,</span><span class="nt">footer</span><span class="o">,</span><span class="nt">main</span><span class="o">,</span><span class="nt">nav</span><span class="o">,</span><span class="nt">section</span><span class="p">{</span><span class="k">display</span><span class="p">:</span><span class="kc">block</span><span class="p">}</span><span class="nt">body</span><span class="p">{</span><span class="k">margin</span><span class="p">:</span><span class="mi">0</span><span class="p">;</span><span class="k">font-family</span><span class="p">:</span><span class="o">-</span><span class="n">apple-system</span><span class="p">,</span><span class="n">BlinkMacSystemFont</span><span class="p">,</span><span class="s2">&#34;Segoe UI&#34;</span><span class="p">,</span><span class="n">Roboto</span><span class="p">,</span><span class="s2">&#34;Helvetica Neue&#34;</span><span class="p">,</span><span class="n">Arial</span><span class="p">,</span><span class="kc">sans-serif</span><span class="p">,</span><span class="s2">&#34;Apple Color Emoji&#34;</span><span class="p">,</span><span class="s2">&#34;Segoe UI Emoji&#34;</span><span class="p">,</span><span class="s2">&#34;Segoe UI Symbol&#34;</span><span class="p">,</span><span class="s2">&#34;Noto Color Emoji&#34;</span><span class="p">;</span><span class="k">font-size</span><span class="p">:</span><span class="mi">1</span><span class="kt">rem</span><span class="p">;</span><span class="k">font-weight</span><span class="p">:</span><span class="mi">400</span><span class="p">;</span><span class="k">line-height</span><span class="p">:</span><span class="mf">1.5</span><span class="p">;</span><span class="k">color</span><span class="p">:</span><span class="mh">#212529</span><span class="p">;</span><span class="k">text-align</span><span class="p">:</span><span class="kc">left</span><span class="p">;</span><span class="k">background-color</span><span class="p">:</span><span class="mh">#fff</span><span class="p">}</span><span class="nt">h1</span><span class="o">,</span><span class="nt">h2</span><span class="p">{</span><span class="k">margin-top</span><span class="p">:</span><span class="mi">0</span><span class="p">;</span><span class="k">margin-bottom</span><span class="p">:</span><span class="mf">.5</span><span class="kt">rem</span><span class="p">}</span><span class="nt">p</span><span class="p">{</span><span class="k">margin-top</span><span class="p">:</span><span class="mi">0</span><span class="p">;</span><span class="k">margin-bottom</span><span class="p">:</span><span class="mi">1</span><span class="kt">rem</span><span class="p">}</span><span class="nt">ul</span><span class="p">{</span><span class="k">margin-top</span><span class="p">:</span><span class="mi">0</span><span class="p">;</span><span class="k">margin-bottom</span><span class="p">:</span><span class="mi">1</span><span class="kt">rem</span><span class="p">}</span><span class="nt">a</span><span class="p">{</span><span class="k">color</span><span class="p">:</span><span class="mh">#007bff</span><span class="p">;</span><span class="k">text-decoration</span><span class="p">:</span><span class="kc">none</span><span class="p">;</span><span class="k">background-color</span><span class="p">:</span><span class="kc">transparent</span><span class="p">;</span><span class="kp">-webkit-</span><span class="k">text-decoration-skip</span><span class="p">:</span><span class="kc">objects</span><span class="p">}</span><span class="nt">img</span><span class="p">{</span><span class="k">vertical-align</span><span class="p">:</span><span class="kc">middle</span><span class="p">;</span><span class="k">border-style</span><span class="p">:</span><span class="kc">none</span><span class="p">}</span><span class="nt">button</span><span class="p">{</span><span class="k">border-radius</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span><span class="nt">button</span><span class="o">,</span><span class="nt">input</span><span class="p">{</span><span class="k">margin</span><span class="p">:</span><span class="mi">0</span><span class="p">;</span><span class="k">font-family</span><span class="p">:</span><span class="kc">inherit</span><span class="p">;</span><span class="k">font-size</span><span class="p">:</span><span class="kc">inherit</span><span class="p">;</span><span class="k">line-height</span><span class="p">:</span><span class="kc">inherit</span><span class="p">}</span><span class="nt">button</span><span class="o">,</span><span class="nt">input</span><span class="p">{</span><span class="k">overflow</span><span class="p">:</span><span class="kc">visible</span><span class="p">}</span><span class="nt">button</span><span class="p">{</span><span class="k">text-transform</span><span class="p">:</span><span class="kc">none</span><span class="p">}</span><span class="o">[</span><span class="nt">type</span><span class="o">=</span><span class="nt">submit</span><span class="o">],</span><span class="nt">button</span><span class="p">{</span><span class="kp">-webkit-</span><span class="k">appearance</span><span class="p">:</span><span class="n">button</span><span class="p">}</span><span class="o">[</span><span class="nt">type</span><span class="o">=</span><span class="nt">submit</span><span class="o">]</span><span class="p">::</span><span class="nd">-moz-focus-inner</span><span class="o">,</span><span class="nt">button</span><span class="p">::</span><span class="nd">-moz-focus-inner</span><span class="p">{</span><span class="k">padding</span><span class="p">:</span><span class="mi">0</span><span class="p">;</span><span class="k">border-style</span><span class="p">:</span><span class="kc">none</span><span class="p">}::</span><span class="nd">-webkit-file-upload-button</span><span class="p">{</span><span class="k">font</span><span class="p">:</span><span class="kc">inherit</span><span class="p">;</span><span class="kp">-webkit-</span><span class="k">appearance</span><span class="p">:</span><span class="n">button</span><span class="p">}</span><span class="nt">h1</span><span class="o">,</span><span class="nt">h2</span><span class="p">{</span><span class="k">margin-bottom</span><span class="p">:</span><span class="mf">.5</span><span class="kt">rem</span><span class="p">;</span><span class="k">font-family</span><span class="p">:</span><span class="kc">inherit</span><span class="p">;</span><span class="k">font-weight</span><span class="p">:</span><span class="mi">500</span><span class="p">;</span><span class="k">line-height</span><span class="p">:</span><span class="mf">1.2</span><span class="p">;</span><span class="k">color</span><span class="p">:</span><span class="kc">inherit</span><span class="p">}</span><span class="nt">h1</span><span class="p">{</span><span class="k">font-size</span><span class="p">:</span><span class="mf">2.5</span><span class="kt">rem</span><span class="p">}</span><span class="nt">h2</span><span class="p">{</span><span class="k">font-size</span><span class="p">:</span><span class="mi">2</span><span class="kt">rem</span><span class="p">}.</span><span class="nc">lead</span><span class="p">{</span><span class="k">font-size</span><span class="p">:</span><span class="mf">1.25</span><span class="kt">rem</span><span class="p">;</span><span class="k">font-weight</span><span class="p">:</span><span class="mi">300</span><span class="p">}.</span><span class="nc">display-4</span><span class="p">{</span><span class="k">font-size</span><span class="p">:</span><span class="mf">3.5</span><span class="kt">rem</span><span class="p">;</span><span class="k">font-weight</span><span class="p">:</span><span class="mi">300</span><span class="p">;</span><span class="k">line-height</span><span class="p">:</span><span class="mf">1.2</span><span class="p">}.</span><span class="nc">img-fluid</span><span class="p">{</span><span class="k">max-width</span><span class="p">:</span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span><span class="k">height</span><span class="p">:</span><span class="kc">auto</span><span class="p">}.</span><span class="nc">container</span><span class="p">{</span><span class="k">width</span><span class="p">:</span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span><span class="k">padding-right</span><span class="p">:</span><span class="mi">15</span><span class="kt">px</span><span class="p">;</span><span class="k">padding-left</span><span class="p">:</span><span class="mi">15</span><span class="kt">px</span><span class="p">;</span><span class="k">margin-right</span><span class="p">:</span><span class="kc">auto</span><span class="p">;</span><span class="k">margin-left</span><span class="p">:</span><span class="kc">auto</span><span class="p">}</span><span class="o">[</span><span class="p">@</span><span class="k">media</span><span class="o">](</span><span class="nt">http</span><span class="o">://</span><span class="nt">twitter</span><span class="p">.</span><span class="nc">com</span><span class="o">/</span><span class="nt">media</span> <span class="s2">&#34;Twitter profile for @media&#34;</span><span class="o">)</span> <span class="o">(</span><span class="nt">min-width</span><span class="p">:</span><span class="nd">576px</span><span class="o">)</span><span class="p">{.</span><span class="nc">container</span><span class="p">{</span><span class="k">max-width</span><span class="p">:</span><span class="mi">540</span><span class="kt">px</span><span class="p">}}</span><span class="o">[</span><span class="p">@</span><span class="k">media</span><span class="o">](</span><span class="nt">http</span><span class="o">://</span><span class="nt">twitter</span><span class="p">.</span><span class="nc">com</span><span class="o">/</span><span class="nt">media</span> <span class="s2">&#34;Twitter profile for @media&#34;</span><span class="o">)</span> <span class="o">(</span><span class="nt">min-width</span><span class="p">:</span><span class="nd">768px</span><span class="o">)</span><span class="p">{.</span><span class="nc">container</span><span class="p">{</span><span class="k">max-width</span><span class="p">:</span><span class="mi">720</span><span class="kt">px</span><span class="p">}}</span><span class="o">[</span><span class="p">@</span><span class="k">media</span><span class="o">](</span><span class="nt">http</span><span class="o">://</span><span class="nt">twitter</span><span class="p">.</span><span class="nc">com</span><span class="o">/</span><span class="nt">media</span> <span class="s2">&#34;Twitter profile for @media&#34;</span><span class="o">)</span> <span class="o">(</span><span class="nt">min-width</span><span class="p">:</span><span class="nd">992px</span><span class="o">)</span><span class="p">{.</span><span class="nc">container</span><span class="p">{</span><span class="k">max-width</span><span class="p">:</span><span class="mi">960</span><span class="kt">px</span><span class="p">}}</span><span class="o">[</span><span class="p">@</span><span class="k">media</span><span class="o">](</span><span class="nt">http</span><span class="o">://</span><span class="nt">twitter</span><span class="p">.</span><span class="nc">com</span><span class="o">/</span><span class="nt">media</span> <span class="s2">&#34;Twitter profile for @media&#34;</span><span class="o">)</span> <span class="o">(</span><span class="nt">min-width</span><span class="p">:</span><span class="nd">1200px</span><span class="o">)</span><span class="p">{.</span><span class="nc">container</span><span class="p">{</span><span class="k">max-width</span><span class="p">:</span><span class="mi">1140</span><span class="kt">px</span><span class="p">}}.</span><span class="nc">row</span><span class="p">{</span><span class="k">display</span><span class="p">:</span><span class="kp">-ms-</span><span class="n">flexbox</span><span class="p">;</span><span class="k">display</span><span class="p">:</span><span class="kc">flex</span><span class="p">;</span><span class="kp">-ms-</span><span class="k">flex-wrap</span><span class="p">:</span><span class="kc">wrap</span><span class="p">;</span><span class="k">flex-wrap</span><span class="p">:</span><span class="kc">wrap</span><span class="p">;</span><span class="k">margin-right</span><span class="p">:</span><span class="mi">-15</span><span class="kt">px</span><span class="p">;</span><span class="k">margin-left</span><span class="p">:</span><span class="mi">-15</span><span class="kt">px</span><span class="p">}.</span><span class="nc">col-4</span><span class="p">{</span><span class="k">position</span><span class="p">:</span><span class="kc">relative</span><span class="p">;</span><span class="k">width</span><span class="p">:</span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span><span class="k">min-height</span><span class="p">:</span><span class="mi">1</span><span class="kt">px</span><span class="p">;</span><span class="k">padding-right</span><span class="p">:</span><span class="mi">15</span><span class="kt">px</span><span class="p">;</span><span class="k">padding-left</span><span class="p">:</span><span class="mi">15</span><span class="kt">px</span><span class="p">}.</span><span class="nc">col-4</span><span class="p">{</span><span class="kp">-ms-</span><span class="k">flex</span><span class="p">:</span><span class="mi">0</span> <span class="mi">0</span> <span class="mf">33.333333</span><span class="kt">%</span><span class="p">;</span><span class="k">flex</span><span class="p">:</span><span class="mi">0</span> <span class="mi">0</span> <span class="mf">33.333333</span><span class="kt">%</span><span class="p">;</span><span class="k">max-width</span><span class="p">:</span><span class="mf">33.333333</span><span class="kt">%</span><span class="p">}.</span><span class="nc">form-control</span><span class="p">{</span><span class="k">display</span><span class="p">:</span><span class="kc">block</span><span class="p">;</span><span class="k">width</span><span class="p">:</span><span class="mi">100</span><span class="kt">%</span><span class="p">;</span><span class="k">height</span><span class="p">:</span><span class="nb">calc</span><span class="p">(</span><span class="mf">2.25</span><span class="kt">rem</span> <span class="o">+</span> <span class="mi">2</span><span class="kt">px</span><span class="p">);</span><span class="k">padding</span><span class="p">:</span><span class="mf">.375</span><span class="kt">rem</span> <span class="mf">.75</span><span class="kt">rem</span><span class="p">;</span><span class="k">font-size</span><span class="p">:</span><span class="mi">1</span><span class="kt">rem</span><span class="p">;</span><span class="k">line-height</span><span class="p">:</span><span class="mf">1.5</span><span class="p">;</span><span class="k">color</span><span class="p">:</span><span class="mh">#495057</span><span class="p">;</span><span class="k">background-color</span><span class="p">:</span><span class="mh">#fff</span><span class="p">;</span><span class="k">background-clip</span><span class="p">:</span><span class="kc">padding-box</span><span class="p">;</span><span class="k">border</span><span class="p">:</span><span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="mh">#ced4da</span><span class="p">;</span><span class="k">border-radius</span><span class="p">:</span><span class="mf">.25</span><span class="kt">rem</span><span class="p">}.</span><span class="nc">form-control</span><span class="p">::</span><span class="nd">-ms-expand</span><span class="p">{</span><span class="k">background-color</span><span class="p">:</span><span class="kc">transparent</span><span class="p">;</span><span class="k">border</span><span class="p">:</span><span class="mi">0</span><span class="p">}.</span><span class="nc">form-control</span><span class="p">::</span><span class="nd">-webkit-input-placeholder</span><span class="p">{</span><span class="k">color</span><span class="p">:</span><span class="mh">#6c757d</span><span class="p">;</span><span class="k">opacity</span><span class="p">:</span><span class="mi">1</span><span class="p">}.</span><span class="nc">form-control</span><span class="p">::</span><span class="nd">-moz-placeholder</span><span class="p">{</span><span class="k">color</span><span class="p">:</span><span class="mh">#6c757d</span><span class="p">;</span><span class="k">opacity</span><span class="p">:</span><span class="mi">1</span><span class="p">}.</span><span class="nc">form-control</span><span class="p">:</span><span class="nd">-ms-input-placeholder</span><span class="p">{</span><span class="k">color</span><span class="p">:</span><span class="mh">#6c757d</span><span class="p">;</span><span class="k">opacity</span><span class="p">:</span><span class="mi">1</span><span class="p">}.</span><span class="nc">form-control</span><span class="p">::</span><span class="nd">-ms-input-placeholder</span><span class="p">{</span><span class="k">color</span><span class="p">:</span><span class="mh">#6c757d</span><span class="p">;</span><span class="k">opacity</span><span class="p">:</span><span class="mi">1</span><span class="p">}.</span><span class="nc">form-inline</span><span class="p">{</span><span class="k">display</span><span class="p">:</span><span class="kp">-ms-</span><span class="n">flexbox</span><span class="p">;</span><span class="k">display</span><span class="p">:</span><span class="kc">flex</span><span class="p">;</span><span class="kp">-ms-</span><span class="k">flex-flow</span><span class="p">:</span><span class="kc">row</span> <span class="kc">wrap</span><span class="p">;</span><span class="k">flex-flow</span><span class="p">:</span><span class="kc">row</span> <span class="kc">wrap</span><span class="p">;</span><span class="kp">-ms-</span><span class="n">flex-align</span><span class="p">:</span><span class="kc">center</span><span class="p">;</span><span class="k">align-items</span><span class="p">:</span><span class="kc">center</span><span class="p">}</span><span class="o">[</span><span class="p">@</span><span class="k">media</span><span class="o">](</span><span class="nt">http</span><span class="o">://</span><span class="nt">twitter</span><span class="p">.</span><span class="nc">com</span><span class="o">/</span><span class="nt">media</span> <span class="s2">&#34;Twitter profile for @media&#34;</span><span class="o">)</span> <span class="o">(</span><span class="nt">min-width</span><span class="p">:</span><span class="nd">576px</span><span class="o">)</span><span class="p">{.</span><span class="nc">form-inline</span> <span class="p">.</span><span class="nc">form-control</span><span class="p">{</span><span class="k">display</span><span class="p">:</span><span class="kc">inline-block</span><span class="p">;</span><span class="k">width</span><span class="p">:</span><span class="kc">auto</span><span class="p">;</span><span class="k">vertical-align</span><span class="p">:</span><span class="kc">middle</span><span class="p">}}.</span><span class="nc">btn</span><span class="p">{</span><span class="k">display</span><span class="p">:</span><span class="kc">inline-block</span><span class="p">;</span><span class="k">font-weight</span><span class="p">:</span><span class="mi">400</span><span class="p">;</span><span class="k">text-align</span><span class="p">:</span><span class="kc">center</span><span class="p">;</span><span class="k">white-space</span><span class="p">:</span><span class="kc">nowrap</span><span class="p">;</span><span class="k">vertical-align</span><span class="p">:</span><span class="kc">middle</span><span class="p">;</span><span class="k">border</span><span class="p">:</span><span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="kc">transparent</span><span class="p">;</span><span class="k">padding</span><span class="p">:</span><span class="mf">.375</span><span class="kt">rem</span> <span class="mf">.75</span><span class="kt">rem</span><span class="p">;</span><span class="k">font-size</span><span class="p">:</span><span class="mi">1</span><span class="kt">rem</span><span class="p">;</span><span class="k">line-height</span><span class="p">:</span><span class="mf">1.5</span><span class="p">;</span><span class="k">border-radius</span><span class="p">:</span><span class="mf">.25</span><span class="kt">rem</span><span class="p">}.</span><span class="nc">btn-primary</span><span class="p">{</span><span class="k">color</span><span class="p">:</span><span class="mh">#fff</span><span class="p">;</span><span class="k">background-color</span><span class="p">:</span><span class="mh">#007bff</span><span class="p">;</span><span class="k">border-color</span><span class="p">:</span><span class="mh">#007bff</span><span class="p">}.</span><span class="nc">btn-outline-success</span><span class="p">{</span><span class="k">color</span><span class="p">:</span><span class="mh">#28a745</span><span class="p">;</span><span class="k">background-color</span><span class="p">:</span><span class="kc">transparent</span><span class="p">;</span><span class="k">background-image</span><span class="p">:</span><span class="kc">none</span><span class="p">;</span><span class="k">border-color</span><span class="p">:</span><span class="mh">#28a745</span><span class="p">}.</span><span class="nc">btn-lg</span><span class="p">{</span><span class="k">padding</span><span class="p">:</span><span class="mf">.5</span><span class="kt">rem</span> <span class="mi">1</span><span class="kt">rem</span><span class="p">;</span><span class="k">font-size</span><span class="p">:</span><span class="mf">1.25</span><span class="kt">rem</span><span class="p">;</span><span class="k">line-height</span><span class="p">:</span><span class="mf">1.5</span><span class="p">;</span><span class="k">border-radius</span><span class="p">:</span><span class="mf">.3</span><span class="kt">rem</span><span class="p">}.</span><span class="nc">fade</span><span class="p">:</span><span class="nd">not</span><span class="o">(</span><span class="p">.</span><span class="nc">show</span><span class="o">)</span><span class="p">{</span><span class="k">opacity</span><span class="p">:</span><span class="mi">0</span><span class="p">}.</span><span class="nc">nav</span><span class="p">{</span><span class="k">display</span><span class="p">:</span><span class="kp">-ms-</span><span class="n">flexbox</span><span class="p">;</span><span class="k">display</span><span class="p">:</span><span class="kc">flex</span><span class="p">;</span><span class="kp">-ms-</span><span class="k">flex-wrap</span><span class="p">:</span><span class="kc">wrap</span><span class="p">;</span><span class="k">flex-wrap</span><span class="p">:</span><span class="kc">wrap</span><span class="p">;</span><span class="k">padding-left</span><span class="p">:</span><span class="mi">0</span><span class="p">;</span><span class="k">margin-bottom</span><span class="p">:</span><span class="mi">0</span><span class="p">;</span><span class="k">list-style</span><span class="p">:</span><span class="kc">none</span><span class="p">}.</span><span class="nc">nav-link</span><span class="p">{</span><span class="k">display</span><span class="p">:</span><span class="kc">block</span><span class="p">;</span><span class="k">padding</span><span class="p">:</span><span class="mf">.5</span><span class="kt">rem</span> <span class="mi">1</span><span class="kt">rem</span><span class="p">}.</span><span class="nc">nav-tabs</span><span class="p">{</span><span class="k">border-bottom</span><span class="p">:</span><span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="mh">#dee2e6</span><span class="p">}.</span><span class="nc">nav-tabs</span> <span class="p">.</span><span class="nc">nav-item</span><span class="p">{</span><span class="k">margin-bottom</span><span class="p">:</span><span class="mi">-1</span><span class="kt">px</span><span class="p">}.</span><span class="nc">nav-tabs</span> <span class="p">.</span><span class="nc">nav-link</span><span class="p">{</span><span class="k">border</span><span class="p">:</span><span class="mi">1</span><span class="kt">px</span> <span class="kc">solid</span> <span class="kc">transparent</span><span class="p">;</span><span class="k">border-top-left-radius</span><span class="p">:</span><span class="mf">.25</span><span class="kt">rem</span><span class="p">;</span><span class="k">border-top-right-radius</span><span class="p">:</span><span class="mf">.25</span><span class="kt">rem</span><span class="p">}.</span><span class="nc">nav-tabs</span> <span class="p">.</span><span class="nc">nav-link</span><span class="p">.</span><span class="nc">active</span><span class="p">{</span><span class="k">color</span><span class="p">:</span><span class="mh">#495057</span><span class="p">;</span><span class="k">background-color</span><span class="p">:</span><span class="mh">#fff</span><span class="p">;</span><span class="k">border-color</span><span class="p">:</span><span class="mh">#dee2e6</span> <span class="mh">#dee2e6</span> <span class="mh">#fff</span><span class="p">}.</span><span class="nc">tab-content</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">tab-pane</span><span class="p">{</span><span class="k">display</span><span class="p">:</span><span class="kc">none</span><span class="p">}.</span><span class="nc">tab-content</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">active</span><span class="p">{</span><span class="k">display</span><span class="p">:</span><span class="kc">block</span><span class="p">}.</span><span class="nc">navbar</span><span class="p">{</span><span class="k">position</span><span class="p">:</span><span class="kc">relative</span><span class="p">;</span><span class="k">display</span><span class="p">:</span><span class="kp">-ms-</span><span class="n">flexbox</span><span class="p">;</span><span class="k">display</span><span class="p">:</span><span class="kc">flex</span><span class="p">;</span><span class="kp">-ms-</span><span class="k">flex-wrap</span><span class="p">:</span><span class="kc">wrap</span><span class="p">;</span><span class="k">flex-wrap</span><span class="p">:</span><span class="kc">wrap</span><span class="p">;</span><span class="kp">-ms-</span><span class="n">flex-align</span><span class="p">:</span><span class="kc">center</span><span class="p">;</span><span class="k">align-items</span><span class="p">:</span><span class="kc">center</span><span class="p">;</span><span class="kp">-ms-</span><span class="n">flex-pack</span><span class="p">:</span><span class="kc">justify</span><span class="p">;</span><span class="k">justify-content</span><span class="p">:</span><span class="kc">space-between</span><span class="p">;</span><span class="k">padding</span><span class="p">:</span><span class="mf">.5</span><span class="kt">rem</span> <span class="mi">1</span><span class="kt">rem</span><span class="p">}.</span><span class="nc">navbar-nav</span><span class="p">{</span><span class="k">display</span><span class="p">:</span><span class="kp">-ms-</span><span class="n">flexbox</span><span class="p">;</span><span class="k">display</span><span class="p">:</span><span class="kc">flex</span><span class="p">;</span><span class="kp">-ms-</span><span class="k">flex-direction</span><span class="p">:</span><span class="kc">column</span><span class="p">;</span><span class="k">flex-direction</span><span class="p">:</span><span class="kc">column</span><span class="p">;</span><span class="k">padding-left</span><span class="p">:</span><span class="mi">0</span><span class="p">;</span><span class="k">margin-bottom</span><span class="p">:</span><span class="mi">0</span><span class="p">;</span><span class="k">list-style</span><span class="p">:</span><span class="kc">none</span><span class="p">}.</span><span class="nc">navbar-nav</span> <span class="p">.</span><span class="nc">nav-link</span><span class="p">{</span><span class="k">padding-right</span><span class="p">:</span><span class="mi">0</span><span class="p">;</span><span class="k">padding-left</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span><span class="o">[</span><span class="p">@</span><span class="k">media</span><span class="o">](</span><span class="nt">http</span><span class="o">://</span><span class="nt">twitter</span><span class="p">.</span><span class="nc">com</span><span class="o">/</span><span class="nt">media</span> <span class="s2">&#34;Twitter profile for @media&#34;</span><span class="o">)</span> <span class="o">(</span><span class="nt">min-width</span><span class="p">:</span><span class="nd">992px</span><span class="o">)</span><span class="p">{.</span><span class="nc">navbar-expand-lg</span><span class="p">{</span><span class="kp">-ms-</span><span class="k">flex-flow</span><span class="p">:</span><span class="kc">row</span> <span class="kc">nowrap</span><span class="p">;</span><span class="k">flex-flow</span><span class="p">:</span><span class="kc">row</span> <span class="kc">nowrap</span><span class="p">;</span><span class="kp">-ms-</span><span class="n">flex-pack</span><span class="p">:</span><span class="kc">start</span><span class="p">;</span><span class="k">justify-content</span><span class="p">:</span><span class="kc">flex-start</span><span class="p">}.</span><span class="nc">navbar-expand-lg</span> <span class="p">.</span><span class="nc">navbar-nav</span><span class="p">{</span><span class="kp">-ms-</span><span class="k">flex-direction</span><span class="p">:</span><span class="kc">row</span><span class="p">;</span><span class="k">flex-direction</span><span class="p">:</span><span class="kc">row</span><span class="p">}.</span><span class="nc">navbar-expand-lg</span> <span class="p">.</span><span class="nc">navbar-nav</span> <span class="p">.</span><span class="nc">nav-link</span><span class="p">{</span><span class="k">padding-right</span><span class="p">:</span><span class="mf">.5</span><span class="kt">rem</span><span class="p">;</span><span class="k">padding-left</span><span class="p">:</span><span class="mf">.5</span><span class="kt">rem</span><span class="p">}}.</span><span class="nc">navbar-light</span> <span class="p">.</span><span class="nc">navbar-nav</span> <span class="p">.</span><span class="nc">nav-link</span><span class="p">{</span><span class="k">color</span><span class="p">:</span><span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">.5</span><span class="p">)}.</span><span class="nc">navbar-light</span> <span class="p">.</span><span class="nc">navbar-nav</span> <span class="p">.</span><span class="nc">active</span><span class="o">&gt;</span><span class="p">.</span><span class="nc">nav-link</span><span class="p">{</span><span class="k">color</span><span class="p">:</span><span class="nb">rgba</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mf">.9</span><span class="p">)}.</span><span class="nc">jumbotron</span><span class="p">{</span><span class="k">padding</span><span class="p">:</span><span class="mi">2</span><span class="kt">rem</span> <span class="mi">1</span><span class="kt">rem</span><span class="p">;</span><span class="k">margin-bottom</span><span class="p">:</span><span class="mi">2</span><span class="kt">rem</span><span class="p">;</span><span class="k">background-color</span><span class="p">:</span><span class="mh">#e9ecef</span><span class="p">;</span><span class="k">border-radius</span><span class="p">:</span><span class="mf">.3</span><span class="kt">rem</span><span class="p">}</span><span class="o">[</span><span class="p">@</span><span class="k">media</span><span class="o">](</span><span class="nt">http</span><span class="o">://</span><span class="nt">twitter</span><span class="p">.</span><span class="nc">com</span><span class="o">/</span><span class="nt">media</span> <span class="s2">&#34;Twitter profile for @media&#34;</span><span class="o">)</span> <span class="o">(</span><span class="nt">min-width</span><span class="p">:</span><span class="nd">576px</span><span class="o">)</span><span class="p">{.</span><span class="nc">jumbotron</span><span class="p">{</span><span class="k">padding</span><span class="p">:</span><span class="mi">4</span><span class="kt">rem</span> <span class="mi">2</span><span class="kt">rem</span><span class="p">}}.</span><span class="nc">bg-secondary</span><span class="p">{</span><span class="k">background-color</span><span class="p">:</span><span class="mh">#6c757d</span><span class="cp">!important</span><span class="p">}.</span><span class="nc">bg-light</span><span class="p">{</span><span class="k">background-color</span><span class="p">:</span><span class="mh">#f8f9fa</span><span class="cp">!important</span><span class="p">}.</span><span class="nc">my-2</span><span class="p">{</span><span class="k">margin-top</span><span class="p">:</span><span class="mf">.5</span><span class="kt">rem</span><span class="cp">!important</span><span class="p">}.</span><span class="nc">my-2</span><span class="p">{</span><span class="k">margin-bottom</span><span class="p">:</span><span class="mf">.5</span><span class="kt">rem</span><span class="cp">!important</span><span class="p">}.</span><span class="nc">mr-auto</span><span class="p">{</span><span class="k">margin-right</span><span class="p">:</span><span class="kc">auto</span><span class="cp">!important</span><span class="p">}</span><span class="o">[</span><span class="p">@</span><span class="k">media</span><span class="o">](</span><span class="nt">http</span><span class="o">://</span><span class="nt">twitter</span><span class="p">.</span><span class="nc">com</span><span class="o">/</span><span class="nt">media</span> <span class="s2">&#34;Twitter profile for @media&#34;</span><span class="o">)</span> <span class="o">(</span><span class="nt">min-width</span><span class="p">:</span><span class="nd">576px</span><span class="o">)</span><span class="p">{.</span><span class="nc">my-sm-0</span><span class="p">{</span><span class="k">margin-top</span><span class="p">:</span><span class="mi">0</span><span class="cp">!important</span><span class="p">}.</span><span class="nc">my-sm-0</span><span class="p">{</span><span class="k">margin-bottom</span><span class="p">:</span><span class="mi">0</span><span class="cp">!important</span><span class="p">}.</span><span class="nc">mr-sm-2</span><span class="p">{</span><span class="k">margin-right</span><span class="p">:</span><span class="mf">.5</span><span class="kt">rem</span><span class="cp">!important</span><span class="p">}}</span><span class="o">[</span><span class="p">@</span><span class="k">media</span><span class="o">](</span><span class="nt">http</span><span class="o">://</span><span class="nt">twitter</span><span class="p">.</span><span class="nc">com</span><span class="o">/</span><span class="nt">media</span> <span class="s2">&#34;Twitter profile for @media&#34;</span><span class="o">)</span> <span class="o">(</span><span class="nt">min-width</span><span class="p">:</span><span class="nd">992px</span><span class="o">)</span><span class="p">{.</span><span class="nc">my-lg-0</span><span class="p">{</span><span class="k">margin-top</span><span class="p">:</span><span class="mi">0</span><span class="cp">!important</span><span class="p">}.</span><span class="nc">my-lg-0</span><span class="p">{</span><span class="k">margin-bottom</span><span class="p">:</span><span class="mi">0</span><span class="cp">!important</span><span class="p">}}</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;preload&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;[https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css](https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css)&#34;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&#34;sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO&#34;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&#34;anonymous&#34;</span> <span class="na">as</span><span class="o">=</span><span class="s">&#34;style&#34;</span> <span class="na">onload</span><span class="o">=</span><span class="s">&#34;this.onload=null;this.rel=&#39;stylesheet&#39;&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">noscript</span><span class="p">&gt;&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;[https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css](https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css)&#34;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&#34;sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO&#34;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&#34;anonymous&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">noscript</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span><span class="o">!</span><span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">){</span><span class="s2">&#34;use strict&#34;</span><span class="p">;</span><span class="nx">n</span><span class="p">.</span><span class="nx">loadCSS</span><span class="o">||</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">loadCSS</span><span class="o">=</span><span class="kd">function</span><span class="p">(){});</span><span class="kd">var</span> <span class="nx">o</span><span class="o">=</span><span class="nx">loadCSS</span><span class="p">.</span><span class="nx">relpreload</span><span class="o">=</span><span class="p">{};</span><span class="k">if</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">support</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="kd">var</span> <span class="nx">e</span><span class="p">;</span><span class="k">try</span><span class="p">{</span><span class="nx">e</span><span class="o">=</span><span class="nx">n</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&#34;link&#34;</span><span class="p">).</span><span class="nx">relList</span><span class="p">.</span><span class="nx">supports</span><span class="p">(</span><span class="s2">&#34;preload&#34;</span><span class="p">)}</span><span class="k">catch</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="nx">e</span><span class="o">=!</span><span class="mi">1</span><span class="p">}</span><span class="k">return</span> <span class="kd">function</span><span class="p">(){</span><span class="k">return</span> <span class="nx">e</span><span class="p">}}(),</span><span class="nx">o</span><span class="p">.</span><span class="nx">bindMediaToggle</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span><span class="kd">var</span> <span class="nx">e</span><span class="o">=</span><span class="nx">t</span><span class="p">.</span><span class="nx">media</span><span class="o">||</span><span class="s2">&#34;all&#34;</span><span class="p">;</span><span class="kd">function</span> <span class="nx">a</span><span class="p">(){</span><span class="nx">t</span><span class="p">.</span><span class="nx">media</span><span class="o">=</span><span class="nx">e</span><span class="p">}</span><span class="nx">t</span><span class="p">.</span><span class="nx">addEventListener</span><span class="o">?</span><span class="nx">t</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;load&#34;</span><span class="p">,</span><span class="nx">a</span><span class="p">)</span><span class="o">:</span><span class="nx">t</span><span class="p">.</span><span class="nx">attachEvent</span><span class="o">&amp;&amp;</span><span class="nx">t</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">(</span><span class="s2">&#34;onload&#34;</span><span class="p">,</span><span class="nx">a</span><span class="p">),</span><span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nx">t</span><span class="p">.</span><span class="nx">rel</span><span class="o">=</span><span class="s2">&#34;stylesheet&#34;</span><span class="p">,</span><span class="nx">t</span><span class="p">.</span><span class="nx">media</span><span class="o">=</span><span class="s2">&#34;only x&#34;</span><span class="p">}),</span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="mf">3e3</span><span class="p">)},</span><span class="nx">o</span><span class="p">.</span><span class="nx">poly</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">o</span><span class="p">.</span><span class="nx">support</span><span class="p">())</span><span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">t</span><span class="o">=</span><span class="nx">n</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">&#34;link&#34;</span><span class="p">),</span><span class="nx">e</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">e</span><span class="o">&lt;</span><span class="nx">t</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">e</span><span class="o">++</span><span class="p">){</span><span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="nx">t</span><span class="p">[</span><span class="nx">e</span><span class="p">];</span><span class="s2">&#34;preload&#34;</span><span class="o">!==</span><span class="nx">a</span><span class="p">.</span><span class="nx">rel</span><span class="o">||</span><span class="s2">&#34;style&#34;</span><span class="o">!==</span><span class="nx">a</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s2">&#34;as&#34;</span><span class="p">)</span><span class="o">||</span><span class="nx">a</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s2">&#34;data-loadcss&#34;</span><span class="p">)</span><span class="o">||</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&#34;data-loadcss&#34;</span><span class="p">,</span><span class="o">!</span><span class="mi">0</span><span class="p">),</span><span class="nx">o</span><span class="p">.</span><span class="nx">bindMediaToggle</span><span class="p">(</span><span class="nx">a</span><span class="p">))}},</span><span class="o">!</span><span class="nx">o</span><span class="p">.</span><span class="nx">support</span><span class="p">()){</span><span class="nx">o</span><span class="p">.</span><span class="nx">poly</span><span class="p">();</span><span class="kd">var</span> <span class="nx">t</span><span class="o">=</span><span class="nx">n</span><span class="p">.</span><span class="nx">setInterval</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">poly</span><span class="p">,</span><span class="mi">500</span><span class="p">);</span><span class="nx">n</span><span class="p">.</span><span class="nx">addEventListener</span><span class="o">?</span><span class="nx">n</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;load&#34;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span><span class="nx">o</span><span class="p">.</span><span class="nx">poly</span><span class="p">(),</span><span class="nx">n</span><span class="p">.</span><span class="nx">clearInterval</span><span class="p">(</span><span class="nx">t</span><span class="p">)})</span><span class="o">:</span><span class="nx">n</span><span class="p">.</span><span class="nx">attachEvent</span><span class="o">&amp;&amp;</span><span class="nx">n</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">(</span><span class="s2">&#34;onload&#34;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span><span class="nx">o</span><span class="p">.</span><span class="nx">poly</span><span class="p">(),</span><span class="nx">n</span><span class="p">.</span><span class="nx">clearInterval</span><span class="p">(</span><span class="nx">t</span><span class="p">)})}</span><span class="s2">&#34;undefined&#34;</span><span class="o">!=</span><span class="k">typeof</span> <span class="nx">exports</span><span class="o">?</span><span class="nx">exports</span><span class="p">.</span><span class="nx">loadCSS</span><span class="o">=</span><span class="nx">loadCSS</span><span class="o">:</span><span class="nx">n</span><span class="p">.</span><span class="nx">loadCSS</span><span class="o">=</span><span class="nx">loadCSS</span><span class="p">}(</span><span class="s2">&#34;undefined&#34;</span><span class="o">!=</span><span class="k">typeof</span> <span class="nx">global</span><span class="o">?</span><span class="nx">global</span><span class="o">:</span><span class="k">this</span><span class="p">);&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">defer</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;[https://code.jquery.com/jquery-3.3.1.slim.min.js](https://code.jquery.com/jquery-3.3.1.slim.min.js)&#34;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&#34;sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo&#34;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&#34;anonymous&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">defer</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;[https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js](https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js)&#34;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&#34;sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49&#34;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&#34;anonymous&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">defer</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;[https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js](https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js)&#34;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&#34;sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy&#34;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&#34;anonymous&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--[if lt IE 9]&gt;  
</span></span></span><span class="line"><span class="cl"><span class="c">      &lt;script src=&#34;[https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js](https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js)&#34;&gt;&lt;/script&gt;  
</span></span></span><span class="line"><span class="cl"><span class="c">    &lt;![endif]--&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">     <span class="c">&lt;!-- ...  --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>å¦‚æ‚¨æ‰€è§ï¼Œè¯¥å·¥å…·æ·»åŠ äº†ä¸€ä¸ªå¸¦æœ‰å¤§é‡ CSS çš„å†…è” <code>&lt;style&gt;</code> å…ƒç´ ã€‚è¯·æ³¨æ„ï¼Œè¿™ä¸æ˜¯ Bootstrap çš„å…¨éƒ¨ CSSï¼Œåªæ˜¯è¯¥å·¥å…·åˆ†æçš„ CSS å¯¹äºæ­¤é¡µé¢çš„åˆå§‹è§†å›¾æ˜¯å¿…éœ€çš„ã€‚ä»… Bootstrap çš„ç¼©å° CSS å°±æœ‰ 51 KB;è¿™ä¸ªæ–°çš„HTMLæ–‡ä»¶åŒ…æ‹¬æ‰€æœ‰HTMLä»¥åŠæ–°å†…è”çš„CSSå’ŒJavaScriptï¼Œæ˜¯12 KBã€‚è¿™ç§å‡å°çš„å¤§å°æ¯”çœ‹èµ·æ¥æ›´é‡è¦ - å°†åˆå§‹ HTML/CSS/JS ç½®äº 14 KB ä»¥ä¸‹å¯ä»¥ä½¿æ‚¨çš„ç½‘ç«™åœ¨æŸäº›æœ€æ…¢çš„è¿æ¥ä¸Šä»¥æ¯«ç§’ä¸ºå•ä½å‘ˆç°ã€‚è¿™æ˜¯å› ä¸ºæµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ¯æ¬¡å¾€è¿”ä¸€æ¬¡å¯ä»¥å‘é€å¤§çº¦ 14 KB - é€šè¿‡å°†æ‰€æœ‰å†…å®¹æ”¾å…¥ä¸€æ¬¡å¾€è¿”ä¸­ï¼Œæ‚¨å¯ä»¥é¿å…é¢å¤–å¾€è¿”çš„å¼€é”€ï¼ˆ<a href="https://developers.google.com/speed/docs/insights/mobile">æ­¤å¤„</a>æä¾›æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼‰ã€‚</p>
<p>è¯¥å·¥å…·è¿˜åœ¨ CSS link å…ƒç´ ä¸Šæ·»åŠ äº† <code>rel=&quot;preload&quot;</code> å±æ€§ï¼Œ<a href="https://www.filamentgroup.com/lab/async-css.html">ä½¿ CSS æ–‡ä»¶èƒ½å¤Ÿå¼‚æ­¥åŠ è½½</a>ã€‚è¿™é€šå¸¸æ˜¯æ‚¨ä¸æƒ³åšçš„äº‹æƒ… - å°½ç®¡å®ƒä¼šåŠ å¿«ç½‘ç«™é€Ÿåº¦ï¼Œä½†ç”¨æˆ·ä¼šé¦–å…ˆçœ‹åˆ°æ— æ ·å¼çš„çº¯HTMLï¼Œç„¶ååœ¨åŠ è½½CSSæ–‡ä»¶æ—¶çœ‹åˆ°æ ·å¼æ­£ç¡®çš„ç½‘ç«™ã€‚ä½†æ˜¯ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œç”±äºæˆ‘ä»¬æ­£åœ¨å†…è”å…³é”®çš„ CSSï¼Œè¿™ä¸æ˜¯é—®é¢˜ï¼Œå› æ­¤å¼‚æ­¥åŠ è½½å‰©ä½™çš„ CSS å¯ä»¥å®Œç¾åœ°å·¥ä½œï¼</p>
<h4 id="å®ç°æ„å»ºæ­¥éª¤">å®ç°æ„å»ºæ­¥éª¤</h4>
<p>æ­¤æ—¶ï¼Œæ‚¨å¯ä»¥æ‰§è¡Œè¯¸å¦‚æ¯æ¬¡éƒ¨ç½²ç½‘ç«™æ—¶æ‰‹åŠ¨ç¼©å°å’Œè¿æ¥æ–‡ä»¶ä¹‹ç±»çš„æ“ä½œï¼Œä½†è¿™å°†æ˜¯ä¸€ä¸ªå·¨å¤§çš„ç—›è‹¦ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæ‚¨å°†ä½¿ç”¨å•ä¸ªå‘½ä»¤è‡ªåŠ¨æ‰§è¡Œè¿™ç»„ä»»åŠ¡ï¼Œè¿™ç§°ä¸ºç”Ÿæˆæ­¥éª¤ã€‚ç¼©å°å’Œä¸²è”åªæ˜¯ä¸¤ä¸ªå¯èƒ½çš„ä»»åŠ¡ - ä»»ä½•å¯ä»¥è‡ªåŠ¨åŒ–çš„é‡å¤æ€§ä»»åŠ¡ã€‚ä¸‹é¢æ˜¯ç”Ÿæˆæ­¥éª¤ä¸­çš„ä¸€äº›å…¸å‹ä»»åŠ¡ï¼š</p>
<ul>
<li>
<p>ç¼©å° HTMLã€CSS å’Œ JavaScript</p>
</li>
<li>
<p>è¿æ¥ JavaScript æ–‡ä»¶å’Œ CSS æ–‡ä»¶</p>
</li>
<li>
<p>ä¼˜åŒ–å›¾åƒï¼ˆé€šè¿‡è°ƒæ•´å¤§å°ã€åˆ é™¤æœªä½¿ç”¨çš„å…ƒæ•°æ®ç­‰ï¼‰</p>
</li>
<li>
<p>æ·»åŠ  CSS ä¾›åº”å•†å‰ç¼€ä»¥å®ç°æµè§ˆå™¨å…¼å®¹æ€§</p>
</li>
<li>
<p>è½¬è¯‘ä»£ç ï¼ˆä» SASS åˆ° CSSï¼Œæˆ–ä» CoffeeScript åˆ° JSï¼Œç­‰ç­‰ï¼‰</p>
</li>
<li>
<p>è¿è¡Œä»£ç æµ‹è¯•</p>
</li>
</ul>
<p>è¦å®ç°æ„å»ºæ­¥éª¤ï¼Œæ‚¨éœ€è¦é€‰æ‹©ä¸€ä¸ªå·¥å…·ï¼Œå¹¶ä¸”æœ‰å¾ˆå¤šå·¥å…·å¯ä¾›é€‰æ‹©ã€‚ä¸€ä¸ªæµè¡Œçš„é€‰æ‹©æ˜¯ Gruntï¼Œå®ƒäº2012å¹´å‘å¸ƒã€‚ç´§éšå…¶åçš„æ˜¯ Gulpï¼Œä»¥åŠBroccoli.jsï¼ŒBrunch å’Œ webpackã€‚æˆªè‡³ 2018 å¹´ï¼Œwebpack ä¼¼ä¹æ˜¯æœ€å—æ¬¢è¿çš„é€‰æ‹©ï¼Œä½†æœ€ç»ˆè¿™äº›å·¥å…·ä¸­çš„ä»»ä½•ä¸€ä¸ªéƒ½å°†ç”¨äºå¾ˆå¥½åœ°å®ç°æ„å»ºæ­¥éª¤çš„ç›®çš„ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šä»å¤´å¼€å§‹å­¦ä¹ ä½¿ç”¨å·¥å…·è¿›è¡Œæ„å»ºæ­¥éª¤å¯èƒ½éå¸¸ä»¤äººç”Ÿç•ã€‚å¤§å¤šæ•°å·¥å…·éƒ½è¦æ±‚æ‚¨ä½¿ç”¨å‘½ä»¤è¡Œ â€” å¦‚æœæ‚¨ä»¥å‰ä»æœªä½¿ç”¨è¿‡ï¼Œæ‚¨å¯ä»¥é˜…è¯»<a href="https://www.learnenough.com/command-line-tutorial">æœ¬æ•™ç¨‹</a>ä»¥è·å¾—å…¥é—¨çš„è‰¯å¥½æ¦‚è¿°ã€‚2018å¹´è®¸å¤šæµè¡Œçš„ Web                                                                                                                                                                                                                       å¼€å‘äººå‘˜æ„å»ºå·¥å…·éƒ½æ˜¯åŸºäº node.js çš„â€”â€”å¦‚æœä½ ä¸ç†Ÿæ‚‰ node.js ç”Ÿæ€ç³»ç»ŸåŠå…¶åœ¨å‰ç«¯å¼€å‘ä¸­çš„ä½¿ç”¨ï¼Œä½ å¯ä»¥é˜…è¯»æˆ‘çš„æ–‡ç«  <a href="https://medium.com/the-node-js-collection/modern-javascript-explained-for-dinosaurs-f695e9747b70">Modern JavaScript Explain For Dinosaurs</a>ï¼Œäº†è§£è¿™æ–¹é¢çš„æ¦‚è¿°ã€‚</p>
</blockquote>
<p><img loading="lazy" src="https://peterxjang.com/img/1__GbAw9ahi__dxD6LBA6Kh0__g.png" alt="Dinosaur comic panels 3 and 4"  />
</p>
<h3 id="æ¨¡æ¿å’Œç»„ä»¶æé«˜å¯ç»´æŠ¤æ€§">æ¨¡æ¿å’Œç»„ä»¶æé«˜å¯ç»´æŠ¤æ€§</h3>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªä¸é”™çš„ç½‘é¡µï¼Œæ—¢æœ‰ç›¸å½“çš„å¸å¼•åŠ›ï¼Œåˆæœ‰æ€§èƒ½ã€‚ç°åœ¨å®ƒçœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p>
<p><img loading="lazy" src="https://peterxjang.com/img/1__fO1wXfiWfdv8vY3__qeQv0A.png" alt="Example website with Bootstrap styling"  />
</p>
<p>åœ¨å¯¼èˆªæ ä¸­ï¼Œæœ‰ä¸€ä¸ªæŒ‡å‘â€œå…³äºâ€é¡µé¢çš„é“¾æ¥ï¼Œä½†å®ƒç›®å‰æ²¡æœ‰è½¬åˆ°ä»»ä½•åœ°æ–¹ã€‚å¦‚æœæˆ‘ä»¬æƒ³åˆ¶ä½œè¿™ä¸ªå…³äºé¡µé¢æ€ä¹ˆåŠï¼Ÿæœ€ç›´æ¥çš„ç­”æ¡ˆæ˜¯å¤åˆ¶åä¸º <code>about.html</code> çš„ <code>index.html</code> ï¼Œå¹¶ç›¸åº”åœ°æ›´æ–°å†…å®¹ã€‚å…·ä½“æ¥è¯´ï¼Œ <code>&lt;main&gt;</code> å…ƒç´ ä¸­çš„å†…å®¹å°†æ›´æ”¹ï¼ŒHTML çš„å…¶ä½™éƒ¨åˆ†å°†ä¿æŒä¸å˜ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ <code>about.html</code> é¡µé¢çš„æ ·å­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;utf-8&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, initial-scale=1, shrink-to-fit=no&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;description&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;author&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>My test page<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;[https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css](https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css)&#34;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&#34;sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO&#34;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&#34;anonymous&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">defer</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;[https://code.jquery.com/jquery-3.3.1.slim.min.js](https://code.jquery.com/jquery-3.3.1.slim.min.js)&#34;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&#34;sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo&#34;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&#34;anonymous&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">defer</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;[https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js](https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js)&#34;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&#34;sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49&#34;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&#34;anonymous&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">defer</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;[https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js](https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js)&#34;</span> <span class="na">integrity</span><span class="o">=</span><span class="s">&#34;sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy&#34;</span> <span class="na">crossorigin</span><span class="o">=</span><span class="s">&#34;anonymous&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!--[if lt IE 9]&gt;  
</span></span></span><span class="line"><span class="cl"><span class="c">      &lt;script src=&#34;[https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js](https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js)&#34;&gt;&lt;/script&gt;  
</span></span></span><span class="line"><span class="cl"><span class="c">    &lt;![endif]--&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">nav</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;navbar navbar-expand-lg navbar-light bg-light&#34;</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;navigation&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;navbar-nav mr-auto&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;nav-item active&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;nav-link&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span>Home<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;nav-item&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;nav-link&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span>Info<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">li</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;nav-item&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;nav-link&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span>About<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">form</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-inline my-2 my-lg-0&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;form-control mr-sm-2&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;Search&#34;</span> <span class="na">aria-label</span><span class="o">=</span><span class="s">&#34;Search&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;btn btn-outline-success my-2 my-sm-0&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span><span class="p">&gt;</span>Search<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">main</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;main&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>About<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Info about this site<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">main</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">footer</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;navbar navbar-dark bg-secondary&#34;</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;contentinfo&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Copyright info goes here<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">footer</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>è¯·æ³¨æ„ï¼Œé™¤äº†çªå‡ºæ˜¾ç¤ºçš„å†…å®¹å¤–ï¼Œ <code>about.html</code> ä¸­çš„æ‰€æœ‰å†…å®¹éƒ½ä¸ <code>index.html</code> ç›¸åŒã€‚è™½ç„¶è¿™æœ‰æ•ˆï¼Œä½†ä»ç»´æŠ¤çš„è§’åº¦æ¥çœ‹ï¼Œå®ƒå˜å¾—æœ‰é—®é¢˜ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨è¿™ç§æŠ€æœ¯åˆ¶ä½œ 7 ä¸ªä¸åŒçš„é¡µé¢ï¼Œé‚£å°†æ˜¯å¤§é‡é‡å¤çš„ä»£ç ã€‚å¦‚æœæˆ‘ä»¬ä»¥åæƒ³å¯¹å¯¼èˆªæ è¿›è¡Œæ›´æ”¹ï¼Œåˆ™å¿…é¡»å°†æ›´æ”¹å¤åˆ¶åˆ°æ‰€æœ‰ 7 ä¸ªæ–‡ä»¶ä¸­ã€‚è¿™è¿åäº†ä¼—æ‰€å‘¨çŸ¥çš„è½¯ä»¶åŸåˆ™ï¼Œç§°ä¸º <a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself">DRY</a>ï¼ˆä¸è¦é‡å¤è‡ªå·±ï¼‰ã€‚</p>
<h4 id="åœ¨æœåŠ¡å™¨ä¸Šæ„å»ºæ¨¡æ¿">åœ¨æœåŠ¡å™¨ä¸Šæ„å»ºæ¨¡æ¿</h4>
<p>æ­¤é—®é¢˜çš„ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨æ¨¡æ¿å¼•æ“ã€‚è¿™æ¶‰åŠåœ¨ HTML ä¸­ç¼–å†™éæ ‡å‡† HTMLï¼Œç„¶åå°†å…¶è¾“å…¥åˆ°ä¸€ä¸ªå•ç‹¬çš„ç¨‹åºä¸­ï¼Œè¯¥ç¨‹åºå°†ç”¨æ ‡å‡†HTMLæ›¿æ¢éæ ‡å‡† HTMLã€‚æœ€å¥½ç”¨ä¸€ä¸ªä¾‹å­æ¥è§£é‡Šè¿™ä¸€ç‚¹ã€‚</p>
<p>å‡è®¾ä½ æ­£åœ¨ä½¿ç”¨ PHPï¼Œè¿™æ˜¯æœ€æ—©è®¾è®¡ç”¨äºHTMLçš„è¯­è¨€ä¹‹ä¸€ï¼ˆä»Šå¤©ä»ç„¶è¢«è®¸å¤šå¤§å…¬å¸ä½¿ç”¨ï¼‰ã€‚æ‚¨å°†åˆ›å»ºä¸€ä¸ª <code>head.php</code> æ–‡ä»¶ï¼ˆåŒ…å« <code>&lt;head&gt;</code> å…ƒç´ ä¸­çš„å†…å®¹ï¼‰ã€ <code>header.php</code> æ–‡ä»¶ï¼ˆåŒ…å«å¯¼èˆªæ å…ƒç´ ï¼‰å’Œ <code>footer.php</code> ï¼ˆåŒ…å«é¡µè„šå…ƒç´ ï¼‰ã€‚</p>
<p>æ‹¥æœ‰è¿™äº›æ–‡ä»¶åï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ª <code>index.php</code> æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="cp">&lt;?php include(&#34;head.php&#34;);?&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="cp">&lt;?php include(&#34;header.php&#34;);?&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">main</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;main&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">section</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;jumbotron&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        ...  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">section</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;container&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        ...  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">main</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="cp">&lt;?php include(&#34;footer.php&#34;);?&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p><code>about.php</code> æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="cp">&lt;?php include(&#34;head.php&#34;);?&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="cp">&lt;?php include(&#34;header.php&#34;);?&gt;</span> 
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">main</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;main&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>About<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Info about this site<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">main</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="cp">&lt;?php include(&#34;footer.php&#34;);?&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>æ‰€ä»¥åœ¨è¿™é‡Œä½ å¯ä»¥çœ‹åˆ°å”¯ä¸€æ”¹å˜çš„éƒ¨åˆ†æ˜¯ä¸­é—´çš„å†…å®¹ã€‚å¦‚æœéœ€è¦æ›´æ–°é¡µçœ‰ã€é¡µè„šæˆ–å¤–éƒ¨ä¾èµ–é¡¹ï¼Œåˆ™åªéœ€æ›´æ”¹ä¸€æ¬¡ã€‚</p>
<p>ä¸Šé¢çš„ä»£ç æ˜¾ç„¶ä¸æ˜¯æœ‰æ•ˆçš„ HTML â€” æ‚¨éœ€è¦æŸç§æ„å»ºæ­¥éª¤æ¥å°† <code>include</code> è¯­å¥æ›¿æ¢ä¸ºå•ç‹¬æ–‡ä»¶ä¸­çš„ HTMLã€‚æˆ‘ä»¬å®é™…ä¸Šå¯ä»¥å°†å…¶åˆå¹¶åˆ°æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„æ„å»ºæ­¥éª¤ä¸­ï¼ˆç”¨äºä»£ç ç¼©å°ã€æ–‡ä»¶è¿æ¥ã€å…³é”® CSS ç­‰ï¼‰ã€‚ä½†æ˜¯ï¼Œä»æ¨¡æ¿ç”Ÿæˆ HTML çš„è¿™ä¸€æ­¥ä¼ ç»Ÿä¸Šæ˜¯åœ¨æœåŠ¡å™¨ä¸ŠåŠ¨æ€å®Œæˆçš„ã€‚</p>
<p><img loading="lazy" src="https://peterxjang.com/img/1__3fBZ27QgR7eDCoPTjam6nw.png#medium" alt="Diagram of client server model"  />
</p>
<center>æ¥è‡ª wikipedia.org </center>
<p>æœåŠ¡å™¨æ˜¯æ¥æ”¶ Web è¯·æ±‚å¹¶å°† HTML/CSS/JS ä½œä¸º Web å“åº”å‘é€å›çš„è®¡ç®—æœºï¼ˆä¸å®¢æˆ·ç«¯ç›¸åï¼Œå…·æœ‰å¯åŠ¨ Web è¯·æ±‚çš„ Web æµè§ˆå™¨çš„è®¡ç®—æœºï¼‰ã€‚æœåŠ¡å™¨é€šå¸¸è´Ÿè´£åŸºäºæ•°æ®åº“ä¸­çš„æ•°æ®åˆ›å»ºåŠ¨æ€ HTMLã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨åœ¨ <a href="https://www.google.com">www.google.com</a> ä¸Šæœç´¢â€œçº¢è‰²é¦™è•‰â€ï¼Œåˆ™ä¸ä¼šæœ‰ä¸€äº›å…³äºçº¢è‰²é¦™è•‰çš„å”¯ä¸€HTMLæ–‡ä»¶ä»æœåŠ¡å™¨å‘é€ç»™æ‚¨ã€‚ç›¸åï¼ŒæœåŠ¡å™¨è¿è¡Œä»£ç ä»¥æ ¹æ®æ‚¨çš„æœç´¢è¯åŠ¨æ€åˆ›å»º HTML å“åº”ã€‚æ‰€ä»¥åœ¨è¿™é‡Œä½ å¯ä»¥ç”¨ä¸€å—çŸ³å¤´æ€æ­»ä¸¤åªé¸Ÿâ€”â€”å› ä¸ºä½ å·²ç»æœ‰ä¸€ä¸ªæ­¥éª¤åœ¨æœåŠ¡å™¨ä¸Šç”ŸæˆåŠ¨æ€ HTMLï¼Œä½ å¯ä»¥ä½¿ç”¨æ¨¡æ¿æ¥å®šä¹‰ç”Ÿæˆçš„ HTML æ¥ä¿æŒä½ çš„ä»£ç å¹²ç‡¥ã€‚</p>
<p>åœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨æ¨¡æ¿æ„å»º HTML æ˜¯ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œåœ¨ç›¸å½“é•¿çš„ä¸€æ®µæ—¶é—´å†…ä¸€ç›´æ˜¯äº‹å®ä¸Šçš„æ ‡å‡†ã€‚é™¤äº† PHPï¼Œè¿˜æœ‰ <a href="https://rubyonrails.org/">Ruby on Rails</a> æ¡†æ¶çš„ <a href="https://en.wikipedia.org/wiki/ERuby">ERB</a>ï¼ŒPython çš„ <a href="https://www.djangoproject.com/">Django</a> æ¡†æ¶çš„ <a href="https://docs.djangoproject.com/en/1.7/topics/templates/">Djangoæ¨¡æ¿è¯­è¨€</a>ï¼ŒNode&rsquo;s <a href="https://expressjs.com/">Express</a> æ¡†æ¶çš„<a href="http://ejs.co/">EJS</a>ç­‰ã€‚è¿™ç§æ–¹æ³•å¯èƒ½éå¸¸ä»¤äººç”Ÿç•â€”â€”ä¸ºäº†åˆ©ç”¨æ¨¡æ¿å¼•æ“ç¼–å†™å¯ç»´æŠ¤çš„ä»£ç ï¼Œæ‚¨åŸºæœ¬ä¸Šé¦–å…ˆå¿…é¡»å­¦ä¹ æ•´ä¸ªç¼–ç¨‹è¯­è¨€å’Œ Web æ¡†æ¶ï¼å¦‚æœæ‚¨å·²ç»è®¡åˆ’ä½¿ç”¨æœåŠ¡å™¨å’Œæ•°æ®åº“ï¼Œé‚£ä¹ˆè¿™æ˜¯å¾ˆè‡ªç„¶çš„é€‰æ‹©ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨åªæ˜¯å¯¹åœ¨å‰ç«¯ç¼–å†™ HTML æ„Ÿå…´è¶£ï¼Œé‚£ä¹ˆè€å®è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„è¿›å…¥éšœç¢ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå¦‚æœæ‚¨çš„ç½‘ç«™ä¸éœ€è¦æ•°æ®åº“ï¼Œåˆ™å¯ä»¥æ”¹ç”¨é™æ€ç½‘ç«™ç”Ÿæˆå™¨ï¼Œè¯¥ç”Ÿæˆå™¨ä½¿ç”¨æ¨¡æ¿æ¥æ„å»ºé™æ€HTMLæ–‡ä»¶ï¼ˆJekyllï¼ŒHugoå’ŒGatsbyæ˜¯ä¸€äº›æµè¡Œçš„é€‰æ‹©ï¼‰ã€‚ä¸æœåŠ¡å™¨ç«¯ Web æ¡†æ¶ç›¸æ¯”ï¼Œé™æ€ç«™ç‚¹ç”Ÿæˆå™¨å¯èƒ½æ›´æ˜“äºä½¿ç”¨;ä½†æ˜¯ï¼Œæ‚¨ä»ç„¶éœ€è¦å­¦ä¹ å•ç‹¬çš„ç¼–ç¨‹è¯­è¨€æˆ–ç¯å¢ƒï¼Œå› æ­¤ä¸ç¼–å†™çº¯HTMLç›¸æ¯”ï¼Œè¿›å…¥ä»ç„¶å­˜åœ¨éšœç¢ã€‚</p>
</blockquote>
<h4 id="åœ¨å®¢æˆ·ç«¯ä¸Šä½¿ç”¨-web-ç»„ä»¶">åœ¨å®¢æˆ·ç«¯ä¸Šä½¿ç”¨ Web ç»„ä»¶</h4>
<p>Web ç»„ä»¶äº2011å¹´é¦–æ¬¡å¼•å…¥ï¼Œä½œä¸ºè§£å†³ HTML å¯ç»´æŠ¤æ€§é—®é¢˜çš„å®Œå…¨ä¸åŒçš„æ–¹æ³•ã€‚Web ç»„ä»¶æ˜¯åœ¨å®¢æˆ·ç«¯è€Œä¸æ˜¯æœåŠ¡å™¨ä¸Šæ„å»ºçš„ï¼Œè¿™æ¶ˆé™¤äº†å¿…é¡»å­¦ä¹ æœåŠ¡å™¨ç«¯ç¼–ç¨‹è¯­è¨€å’Œ Web æ¡†æ¶æ¥ç¼–å†™å¯ç»´æŠ¤çš„ HTML çš„éšœç¢ã€‚</p>
<p>Web ç»„ä»¶çš„æ€»ä½“ç›®æ ‡æ˜¯èƒ½å¤Ÿåˆ›å»ºå¯é‡ç”¨çš„å°éƒ¨ä»¶ã€‚å›é¡¾å‰é¢çš„ç¤ºä¾‹ï¼Œæ‚¨å¯ä»¥åˆ›å»ºå¯¼èˆªæ ç»„ä»¶ã€é¡µçœ‰ç»„ä»¶å’Œé¡µè„šç»„ä»¶ã€‚æ›´è¿›ä¸€æ­¥ï¼Œæ‚¨å¯ä»¥ä¸ºé¡µé¢ä¸­çš„å†…å®¹åˆ›å»ºä¸€ä¸ªå·¨å‹ç»„ä»¶å’Œä¸€ä¸ªæ–‡ç« ç»„ä»¶ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>index.html</code> ä¸­çš„ç»„ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">navbar-component</span><span class="p">&gt;&lt;/</span><span class="nt">navbar-component</span><span class="p">&gt;</span> 
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">main</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;main&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">jumbotron-component</span><span class="p">&gt;&lt;/</span><span class="nt">jumbotron-component</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">section</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;container&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">articles-component</span><span class="p">&gt;&lt;/</span><span class="nt">articles-component</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">section</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">main</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">footer-component</span><span class="p">&gt;&lt;/</span><span class="nt">footer-component</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>ä¸ºäº†ä½¿å…¶æ­£å¸¸å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºè‡ªå®šä¹‰å…ƒç´ ï¼Œå…¶ä¸­æˆ‘ä»¬åŸºæœ¬ä¸Šæ˜¯ä¸ºHTMLè¯­è¨€å®šä¹‰æ–°å…ƒç´ ï¼ˆä»…é€‚ç”¨äºæ­¤ç‰¹å®šç½‘ç«™ï¼‰ã€‚è¦åˆ›å»ºè‡ªå®šä¹‰å…ƒç´ ï¼Œæ‚¨å¿…é¡»ä½¿ç”¨ JavaScriptã€‚ä¸‹é¢æ˜¯åˆ›å»ºå¯¼èˆªæ è‡ªå®šä¹‰å…ƒç´ æ‰€éœ€çš„ JavaScript ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nb">window</span><span class="p">.</span><span class="nx">customElements</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span>  
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;navbar-component&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="kr">class</span> <span class="kr">extends</span> <span class="nx">HTMLElement</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">connectedCallback</span><span class="p">()</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="sb">`  
</span></span></span><span class="line"><span class="cl"><span class="sb">        &lt;nav class=&#34;navbar navbar-expand-lg navbar-light bg-light&#34; role=&#34;navigation&#34;&gt;  
</span></span></span><span class="line"><span class="cl"><span class="sb">          &lt;ul class=&#34;navbar-nav mr-auto&#34;&gt;  
</span></span></span><span class="line"><span class="cl"><span class="sb">            &lt;li class=&#34;nav-item active&#34;&gt;  
</span></span></span><span class="line"><span class="cl"><span class="sb">              &lt;a class=&#34;nav-link&#34; href=&#34;#&#34;&gt;Home&lt;/a&gt;  
</span></span></span><span class="line"><span class="cl"><span class="sb">            &lt;/li&gt;  
</span></span></span><span class="line"><span class="cl"><span class="sb">            &lt;li class=&#34;nav-item&#34;&gt;  
</span></span></span><span class="line"><span class="cl"><span class="sb">              &lt;a class=&#34;nav-link&#34; href=&#34;#&#34;&gt;Info&lt;/a&gt;  
</span></span></span><span class="line"><span class="cl"><span class="sb">            &lt;/li&gt;  
</span></span></span><span class="line"><span class="cl"><span class="sb">            &lt;li class=&#34;nav-item&#34;&gt;  
</span></span></span><span class="line"><span class="cl"><span class="sb">              &lt;a class=&#34;nav-link&#34; href=&#34;#&#34;&gt;About&lt;/a&gt;  
</span></span></span><span class="line"><span class="cl"><span class="sb">            &lt;/li&gt;  
</span></span></span><span class="line"><span class="cl"><span class="sb">          &lt;/ul&gt;  
</span></span></span><span class="line"><span class="cl"><span class="sb">          &lt;form class=&#34;form-inline my-2 my-lg-0&#34;&gt;  
</span></span></span><span class="line"><span class="cl"><span class="sb">            &lt;input class=&#34;form-control mr-sm-2&#34; type=&#34;text&#34; placeholder=&#34;Search&#34; aria-label=&#34;Search&#34;&gt;  
</span></span></span><span class="line"><span class="cl"><span class="sb">            &lt;button class=&#34;btn btn-outline-success my-2 my-sm-0&#34; type=&#34;submit&#34;&gt;Search&lt;/button&gt;  
</span></span></span><span class="line"><span class="cl"><span class="sb">          &lt;/form&gt;  
</span></span></span><span class="line"><span class="cl"><span class="sb">        &lt;/nav&gt;  
</span></span></span><span class="line"><span class="cl"><span class="sb">       `</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">}</span>  
</span></span><span class="line"><span class="cl">  <span class="p">}</span>  
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span></code></pre></div><p>JavaScript çœ‹èµ·æ¥æœ‰ç‚¹å¤æ‚ï¼ˆå®ƒä½¿ç”¨æ–°çš„ <a href="https://en.wikipedia.org/wiki/ECMAScript#6th_Edition_-_ECMAScript_2015">ES2015</a> è¯­è¨€åŠŸèƒ½ï¼‰ï¼Œä½†å®ƒåœ¨è¿™ä¸ªä¾‹å­ä¸­æ‰€åšçš„åªæ˜¯ä¸ºå¯¼èˆªæ å®šä¹‰ HTMLï¼ˆä¸Šé¢ä»¥ç²—ä½“æ˜¾ç¤ºï¼‰å¹¶å°†åç§° <code>navbar-component</code> æ³¨å†Œä¸ºè‡ªå®šä¹‰å…ƒç´ ã€‚è¯·æ³¨æ„ï¼ŒHTML æ˜¯ä½¿ç”¨<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals">æ¨¡æ¿æ–‡å­—</a>åœ¨ JavaScript æ–‡ä»¶ä¸­å®šä¹‰çš„ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå·¨å¤§çš„å­—ç¬¦ä¸²â€”â€”å¦‚æœä½ æ›´å–œæ¬¢å°†å…¶ç§»å›å¸¸è§„ HTML æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†éœ€è¦ä¸€ä¸ªä¸åŒçš„æœºåˆ¶ï¼Œæˆ‘ä»¬å°†åœ¨ç¨åè®¨è®ºã€‚å¦‚æœæ‚¨å°†æ­¤ JavaScript æ·»åŠ åˆ°é¡µé¢ï¼Œæ‚¨ç°åœ¨å¯ä»¥åœ¨æ™®é€š HTML å…ƒç´ ä¹‹å¤–åˆ›å»º <code>&lt;navbar-component&gt;</code> ä¸ªå…ƒç´ ã€‚</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œåœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ­¤æ–¹æ³•ä¸æœåŠ¡å™¨ç«¯æ¨¡æ¿æ–¹æ³•ç›¸æ¯”æ²¡æœ‰å¤ªå¤§ä¼˜åŠ¿ã€‚ä½†æ˜¯ï¼Œå½“æ‚¨å¼€å§‹å‘æ¯ä¸ªç»„ä»¶æ·»åŠ  JavaScript åŠŸèƒ½å’Œ CSS æ ·å¼æ—¶ï¼Œå¥½å¤„å˜å¾—æ›´åŠ æ˜æ˜¾ã€‚Web ç»„ä»¶æä¾›äº†éš”ç¦»åŠŸèƒ½å’Œæ ·å¼çš„åŠŸèƒ½ï¼Œä»¥ä¿ç•™åœ¨æ¯ä¸ªç»„ä»¶ä¸­ï¼Œä½¿å®ƒä»¬å¯é‡ç”¨ â€” ä¸ä»…ç”¨äºæ­¤ç«™ç‚¹ï¼Œè€Œä¸”ç†è®ºä¸Šå¯ä»¥åœ¨å¤šä¸ªé¡¹ç›®ä¸­é‡ç”¨ã€‚è¿™ä¸ªæ¦‚å¿µå¯ä»¥åœ¨ç°æœ‰çš„ HTML å…ƒç´ ï¼ˆå¦‚ <code>&lt;video&gt;</code> å…ƒç´ ï¼‰ä¸­çœ‹åˆ°ã€‚å¦‚æœä½ åƒè¿™æ ·å†™ HTMLï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">video</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;320&#34;</span> <span class="na">height</span><span class="o">=</span><span class="s">&#34;240&#34;</span> <span class="na">controls</span> <span class="na">loop</span> <span class="na">muted</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">source</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;movie.mp4&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;video/mp4&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">source</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;movie.ogg&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;video/ogg&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Your browser doesn&#39;t support HTML5 video. Here is  
</span></span><span class="line"><span class="cl">     a <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;movie.mp4&#34;</span><span class="p">&gt;</span>link to the video<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> instead.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">video</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>ä½ ä¼šå¾—åˆ°ä¸€ä¸ªçœ‹èµ·æ¥åƒè¿™æ ·çš„è§†é¢‘æ’­æ”¾å™¨ï¼š</p>
<p><img loading="lazy" src="https://peterxjang.com/img/1__3pRSQmwBda1IeFo1Smrg__A.png" alt="Example HTML video element"  />
</p>
<center>*ï¼ˆè¿™æ˜¯è§†é¢‘çš„å›¾ç‰‡ï¼Œä¸æ˜¯å®é™…çš„è§†é¢‘ï¼‰*</center>
<p>å…ƒç´ å¸¦æœ‰è‡ªå·±çš„ JavaScript äº¤äº’å¼æ§ä»¶å’Œ CSS æ ·å¼ï¼Œå®ƒä»¬ä¸é¡µé¢çš„å…¶ä½™éƒ¨åˆ†éš”ç¦»ã€‚è¿™æ„å‘³ç€å½“æ‚¨ä½¿ç”¨ <video> å…ƒç´ æ—¶ï¼Œæ‚¨ä¸å¿…æ‹…å¿ƒå®ƒä¼šå½±å“æ‚¨ç½‘ç«™çš„æ ·å¼æˆ–åŠŸèƒ½ï¼Œä¹Ÿä¸å¿…æ‹…å¿ƒæ¥è‡ªç½‘ç«™çš„ä»»ä½• CSS æˆ– JavaScript ä¼šç ´åè§†é¢‘ç»„ä»¶ã€‚</p>
<p>Web ç»„ä»¶çš„ç›®æ ‡æ˜¯ä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿåˆ›å»ºè‡ªå·±çš„è‡ªå®šä¹‰ç»„ä»¶ï¼Œç±»ä¼¼äº <code>&lt;video&gt;</code> å…ƒç´ ï¼Œå¹¶å…·æœ‰æ‰€æœ‰éš”ç¦»å’Œå¯é‡ç”¨æ€§ä¼˜åŠ¿ã€‚ä»¥ä¸‹æ˜¯ Web ç»„ä»¶è§„èŒƒçš„æ‰€æœ‰éƒ¨åˆ†å¦‚ä½•ååŒå·¥ä½œï¼š</p>
<ul>
<li>
<p>æ‚¨å¯ä»¥åœ¨ JavaScript ä¸­åˆ›å»º<a href="https://developer.mozilla.org/en-US/docs/Web/Web_Components/Using_custom_elements">è‡ªå®šä¹‰å…ƒç´ </a>ï¼Œå¦‚å‰æ‰€è¿°ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥åœ¨ JavaScript ä¸­å®šä¹‰è‡ªå®šä¹‰åŠŸèƒ½ï¼Œå¹¶å°†å±æ€§ä» HTML ä¼ é€’åˆ°è‡ªå®šä¹‰å…ƒç´ ä¸­ã€‚</p>
</li>
<li>
<p>æ‚¨å¯ä»¥ä½¿ç”¨<a href="https://developer.mozilla.org/en-US/docs/Web/Web_Components/Using_shadow_DOM">å½±å­ DOM</a> ä½¿ç”¨ CSS è®¾ç½®è‡ªå®šä¹‰å…ƒç´ çš„æ ·å¼ï¼Œè¯¥æ ·å¼ä»…é€‚ç”¨äºå…ƒç´ è€Œä¸æ˜¯æ•´ä¸ªæ–‡æ¡£ï¼ˆè§£å†³ CSS æœ€å›°éš¾çš„æ–¹é¢ä¹‹ä¸€ï¼‰ã€‚</p>
</li>
<li>
<p>å¦‚æœä½ ä¸æƒ³ç›´æ¥ç”¨ JavaScript ç¼–å†™æ‰€æœ‰çš„ HTMLï¼Œä½ å¯ä»¥ä½¿ç”¨ <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/template">HTML æ¨¡æ¿</a>ï¼Œåœ¨ <code>&lt;template&gt;</code> æ ‡è®°ä¸­å°†ç»„ä»¶çš„ HTML å†™å…¥æ™®é€š HTML æ–‡ä»¶ä¸­ï¼Œåœ¨è¢« JavaScript è°ƒç”¨ä¹‹å‰ä¸ä¼šå‘ˆç°ã€‚</p>
</li>
<li>
<p>è¦ç»„ç»‡ä»£ç ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <a href="https://developer.mozilla.org/en-US/docs/Web/Web_Components/HTML_Imports">HTML å¯¼å…¥</a>ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­å°†å®šä¹‰ç»„ä»¶æ‰€éœ€çš„æ‰€æœ‰ HTMLã€CSS å’Œ JavaScript æ”¾å…¥åä¸º <code>navbar-component.html</code> çš„æ–‡ä»¶ä¸­ï¼Œç„¶åå°†å…¶å¯¼å…¥ä¸» HTML æ–‡ä»¶ä¸­ï¼Œå°±åƒå¯¼å…¥å¤–éƒ¨ CSS æ–‡ä»¶ä¸€æ ·ï¼š<code>&lt;link rel=&quot;import&quot; href=&quot;navbar-component.html&quot;&gt;</code>.</p>
</li>
</ul>
<p>å½“ Web ç»„ä»¶åœ¨ 2011 å¹´é¦–æ¬¡å‘å¸ƒæ—¶ï¼Œè®¸å¤šå¼€å‘äººå‘˜å¯¹è¿™äº›å¯èƒ½æ€§æ„Ÿåˆ°å…´å¥‹ã€‚è™½ç„¶æœåŠ¡å™¨ç«¯æ¨¡æ¿åŒ–æ–¹æ³•æœ‰åŠ©äºè§£å†³ HTML çš„ä¸€äº›å¯ç»´æŠ¤æ€§é—®é¢˜ï¼Œä½† Web ç»„ä»¶æä¾›äº†å®Œå…¨ä¸åŒçš„ä¸œè¥¿ - æ‰©å±• HTML çš„æ‰¿è¯ºå°†å…·æœ‰å®Œæ•´çš„å¯é‡ç”¨å°éƒ¨ä»¶ã€‚è¿™æ˜¯ä½¿ Web å¹³å°æˆä¸ºå¯ä»¥å¼€å‘å¤æ‚åº”ç”¨ç¨‹åºçš„åœ°æ–¹æ‰€ç¼ºå°‘çš„éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯æœ€åˆè®¾è®¡çš„ç®€å•é™æ€å†…å®¹ç«™ç‚¹ã€‚</p>
<p>é‚£ä¹ˆå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿåœ¨æ¥ä¸‹æ¥çš„å‡ å¹´é‡Œï¼Œå¾ˆæ˜æ˜¾ï¼Œæµè§ˆå™¨å¹¶æ²¡æœ‰å°± Web ç»„ä»¶ä½œä¸ºæ ‡å‡†è¾¾æˆä¸€è‡´ã€‚æˆªè‡³2018å¹´ï¼Œå‡ ä¹æ²¡æœ‰æµè§ˆå™¨å®Œå…¨æ”¯æŒä¸Šè¿°Web ç»„ä»¶çš„å››ä¸ªä¸»è¦åŠŸèƒ½ï¼Œè¿™æ˜¯ç”±äºå®ç°æ€§èƒ½çš„æ½œåœ¨é—®é¢˜ï¼Œæ ‡å‡†å†²çªå’Œä¸åŒçš„å…¬å¸åˆ©ç›Šã€‚è¿™è®©å¼€å‘äººå‘˜å¤„äºä¸€ä¸ªæœ‰è¶£çš„ä½ç½® - å‡ ä¹æ¯ä¸ªäººéƒ½åŒæ„ç»„ä»¶æ ·å¼æ–¹æ³•æ˜¯å°† Web ä»é™æ€ç«™ç‚¹è½¬ç§»åˆ°å¤æ‚åº”ç”¨ç¨‹åºçš„å¿…è¦éƒ¨åˆ†ï¼Œä½†ç­‰å¾…æµè§ˆå™¨æ”¯æŒä¼¼ä¹æ˜¯å¾’åŠ³çš„ã€‚æ€ä¹ˆåŠï¼Ÿ</p>
<h4 id="åœ¨å®¢æˆ·ç«¯ä¸Šä½¿ç”¨-javascript-æ¡†æ¶">åœ¨å®¢æˆ·ç«¯ä¸Šä½¿ç”¨ JavaScript æ¡†æ¶</h4>
<p>å½“ HTML Web ç»„ä»¶è§„èŒƒä¸ä¼šå¾ˆå¿«å®ç°æ—¶ï¼ŒJavaScript å·²ç»æ˜¯ä¸€ç§è¶³å¤Ÿå¼ºå¤§çš„è¯­è¨€æ¥å¼¥è¡¥è¿™ä¸€ç¼ºé™·ã€‚å¼€å‘äººå‘˜ä¸€ç›´åœ¨ä½¿ç”¨ <a href="https://jquery.com/">jQuery</a> åº“ï¼ˆ2006å¹´å‘å¸ƒï¼‰åˆ¶ä½œå¤æ‚çš„åº”ç”¨ç¨‹åºï¼Œå°½ç®¡å¾ˆéš¾ä¸ºå¤§è§„æ¨¡åº”ç”¨ç¨‹åºç»„ç»‡ä»£ç ã€‚<a href="http://backbonejs.org/">Backbone.js</a>ï¼ˆ2010å¹´å‘å¸ƒï¼‰æ˜¯æœ€æ—©çš„æµè¡Œåº“ä¹‹ä¸€ï¼Œæ—¨åœ¨ä¸ºå¤§å‹å•é¡µåº”ç”¨ç¨‹åºæä¾›ç»„ç»‡ä»£ç çš„æ¡†æ¶ï¼Œå…¶æ¬¡æ˜¯ <a href="https://angularjs.org/">AngularJS</a>ï¼Œ<a href="https://www.emberjs.com/">Ember.js </a>ç­‰ã€‚</p>
<p>æ‰€æœ‰è¿™äº›æ¡†æ¶éƒ½ä¸ç°æœ‰çš„ JavaScript åŠŸèƒ½ä¸€èµ·å·¥ä½œ - å®ƒä»¬ä¸å¿…ä¾èµ–äºç­‰å¾…æµè§ˆå™¨æ¥å®ç°Webç»„ä»¶è§„èŒƒã€‚ä½†æ˜¯æ²¡æœ‰ä¸€ä¸ªæ¡†æ¶ä½¿ç”¨çœŸæ­£çš„å­¤ç«‹å’Œå¯é‡ç”¨çš„ç»„ä»¶ï¼›å¦‚æœæ²¡æœ‰ Web ç»„ä»¶è§„èŒƒçš„ 4 ä¸ªéƒ¨åˆ†ï¼ˆè‡ªå®šä¹‰å…ƒç´ ã€å½±å­ DOMã€HTML æ¨¡æ¿å’Œ HTML å¯¼å…¥ï¼‰ï¼Œè¿™ä¼¼ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚</p>
<p>2013 å¹´ï¼Œä¸€ä¸ªåä¸º <a href="https://reactjs.org/">React</a> çš„æ¡†æ¶å‘å¸ƒï¼Œå®ƒå¯¹è¿™ç§æƒ…å†µæœ‰ä¸€ä¸ªæœ‰è¶£çš„çœ‹æ³•ã€‚ä»–ä»¬èƒ½å¤Ÿä½¿ç”¨ä»¥ä¸‹æ–¹æ³•åœ¨æ²¡æœ‰ Web ç»„ä»¶è§„èŒƒçš„æƒ…å†µä¸‹åˆ¶ä½œä¸€ä¸ªçœŸæ­£çš„åŸºäºç»„ä»¶çš„æ¡†æ¶ï¼š</p>
<ul>
<li>React æ²¡æœ‰ä½¿ç”¨ Web ç»„ä»¶çš„è‡ªå®šä¹‰å…ƒç´ è§„èŒƒï¼Œè€Œæ˜¯é‡‡ç”¨äº†åœ¨ JavaScript ä¸­å®šä¹‰æ‰€æœ‰ HTML çš„æ–¹æ³•ã€‚ä»æœ¬è´¨ä¸Šè®²ï¼Œæ‚¨å°†å®šä¹‰JavaScriptå‡½æ•°ä»¥ä½¿ç”¨ç§°ä¸ºJSXçš„ç‰¹æ®Šè¯­æ³•è¾“å‡ºæ‰€éœ€çš„HTMLï¼ˆå®ƒçœ‹èµ·æ¥åƒHTMLï¼Œä½†ä½¿ç”¨æ„å»ºæ­¥éª¤è½¬æ¢ä¸ºJavaScriptå‡½æ•°ï¼‰ã€‚</li>
<li>React æ²¡æœ‰ä½¿ç”¨ Web ç»„ä»¶çš„ HTML æ¨¡æ¿è§„èŒƒï¼Œè€Œæ˜¯æ²¡æœ‰æä¾›åœ¨ JavaScript ä¹‹å¤–ç¼–å†™ HTML çš„æ–¹æ³•ã€‚</li>
<li>React æ²¡æœ‰ä½¿ç”¨ Web ç»„ä»¶çš„ HTML å¯¼å…¥è§„èŒƒï¼Œè€Œæ˜¯é‡‡ç”¨äº†å°† JavaScript å¯¼å…¥ JavaScript çš„æ–¹æ³•ã€‚è¿™åœ¨å½“æ—¶å®é™…ä¸Šå¹¶ä¸ç›´æ¥å¯è¡Œï¼Œä½†åƒ<a href="http://browserify.org/">Browserify</a> å’Œ <a href="https://webpack.js.org/">webpack</a>è¿™æ ·çš„å·¥å…·å…è®¸å¼€å‘äººå‘˜åœ¨ ä»–ä»¬çš„ JavaScript ä¸­ç¼–å†™ <code>require</code> æˆ– <code>import</code> è¯­å¥ï¼Œè¿™äº›è¯­å¥å°†åœ¨æ„å»ºæ—¶è½¬æ¢ä¸ºå•ä¸ªJavaScriptåŒ…ã€‚</li>
</ul>
<p>ä»æœ¬è´¨ä¸Šè®²ï¼Œè¿™é‡Œçš„è§è§£æ˜¯ï¼Œæ‚¨å¯ä»¥é€šè¿‡åœ¨ JavaScript ä¸­æ‰§è¡Œæ‰€æœ‰æ“ä½œæ¥ä½¿ç»„ä»¶å·¥ä½œã€‚è¯·æ³¨æ„ï¼Œè¿™é‡Œç¼ºå°‘ Web ç»„ä»¶è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œå³å½±å­ DOMâ€”â€”React åœ¨é¦–æ¬¡å‘å¸ƒæ—¶æ²¡æœ‰éš”ç¦»æ ·å¼çš„è§£å†³æ–¹æ¡ˆã€‚å°½ç®¡å¦‚æ­¤ï¼Œå®ƒè¶³ä»¥ä¸ºä»Šå¤©ä½¿ç”¨ç»„ä»¶æ„å»ºåº”ç”¨ç¨‹åºæä¾›ä¸€ä¸ªæ¡†æ¶ã€‚</p>
<p>è¿™å°±æ˜¯ JavaScript ä½¿ç”¨ React åˆ¶ä½œå¯¼èˆªæ ç»„ä»¶çš„æ ·å­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-jsx" data-lang="jsx"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">Component</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">Navbar</span> <span class="kr">extends</span> <span class="nx">Component</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">nav</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;navbar navbar-expand-lg navbar-light bg-light&#34;</span> <span class="na">role</span><span class="o">=</span><span class="s">&#34;navigation&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">ul</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;navbar-nav mr-auto&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">li</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;nav-item active&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;nav-link&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span><span class="nx">Home</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">li</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;nav-item&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;nav-link&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span><span class="nx">Info</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">li</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;nav-item&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">a</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;nav-link&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;#&#34;</span><span class="p">&gt;</span><span class="nx">About</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">form</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;form-inline my-2 my-lg-0&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">input</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;form-control mr-sm-2&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;text&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;Search&#34;</span> <span class="na">aria</span><span class="err">-</span><span class="na">label</span><span class="o">=</span><span class="s">&#34;Search&#34;</span><span class="p">/&gt;</span>  
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">button</span> <span class="na">className</span><span class="o">=</span><span class="s">&#34;btn btn-outline-success my-2 my-sm-0&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;submit&#34;</span><span class="p">&gt;</span><span class="nx">Search</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">nav</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">    <span class="p">);</span>  
</span></span><span class="line"><span class="cl">  <span class="p">}</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="nx">Navbar</span><span class="p">;</span>
</span></span></code></pre></div><p>è¿™ä¸å‰é¢æ˜¾ç¤ºçš„è‡ªå®šä¹‰å…ƒç´ ç¤ºä¾‹æ²¡æœ‰å¤ªå¤§åŒºåˆ«ï¼ˆå°½ç®¡ JSX è¯­æ³•åœ¨å¤§å¤šæ•°å¼€å‘äººå‘˜ç¬¬ä¸€æ¬¡çœ‹åˆ°å®ƒæ—¶éƒ½æ„Ÿåˆ°ä¸å®‰ï¼‰ã€‚React ä¸­çš„æƒ³æ³•æ˜¯å°†å…¶åˆ†è§£ä¸ºè¿›ä¸€æ­¥çš„å­ç»„ä»¶ï¼Œè¿™æ ·æ¯ä¸ªç»„ä»¶åªåšä¸€ä»¶äº‹ã€‚</p>
<p>å½“ React é¦–æ¬¡å‘å¸ƒæ—¶ï¼Œå®ƒé­åˆ°äº†å¾ˆå¤šæ‰¹è¯„ï¼Œç‰¹åˆ«æ˜¯å› ä¸ºå®ƒä¼¼ä¹ç¼ºä¹å…³æ³¨ç‚¹åˆ†ç¦»ï¼ˆå¼€å‘äººå‘˜è¢«æ•™å¯¼å°† HTMLã€CSS å’Œ JS å®Œå…¨åˆ†å¼€ä»¥å®ç°å¯ç»´æŠ¤æ€§ï¼‰ã€‚ç„¶è€Œï¼ŒReact æå‡ºäº†è¿™æ ·ä¸€ä¸ªè§‚ç‚¹ï¼Œå³å¯¹äºå¤æ‚çš„Webåº”ç”¨ç¨‹åºï¼Œå…³æ³¨ç‚¹çš„åˆ†ç¦»ä¸æ˜¯å…³äºæŠ€æœ¯ï¼ˆHTMLï¼ŒCSSå’ŒJSï¼‰ä¹‹é—´çš„è¾¹ç•Œï¼Œè€Œæ˜¯å…³äºåŠŸèƒ½å•å…ƒï¼ˆæ¢å¥è¯è¯´ï¼Œç»„ä»¶ï¼‰ä¹‹é—´çš„è¾¹ç•Œã€‚</p>
<p>é™¤äº†ä½œä¸ºä¸€ä¸ªåŸºäºç»„ä»¶çš„æ¡†æ¶ä¹‹å¤–ï¼ŒReact è¿˜å¸¦æ¥äº†å…³äºå¦‚ä½•ä½¿ç”¨å£°æ˜æ€§æ–¹æ³•ç®¡ç†åº”ç”¨ç¨‹åºä¸­æ•°æ®çš„å¼ºçƒˆæ„è§ã€‚è¿™æ„å‘³ç€ä½¿ç”¨ Reactï¼Œæ‚¨æ— éœ€ç¼–å†™ä»£ç å³å¯ç›´æ¥æ›´æ–°æ¥å£ã€‚ç›¸åï¼Œä½ å®šä¹‰æ¥å£åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­ï¼ˆä½¿ç”¨ JSXï¼‰ï¼Œç¼–å†™ä»£ç æ¥æ›´æ–°æ•°æ®ï¼Œç„¶åè®© React å¼„æ¸…æ¥šå¦‚ä½•ä½¿ç”¨å…¶è™šæ‹Ÿ DOM å®ç°æœ‰æ•ˆåœ°æ›´æ–°å’Œæ¸²æŸ“æ¥å£ï¼ˆä¸è¦ä¸å½±å­ DOM æ··æ·†ï¼‰ã€‚è¿™æ˜¯ Web æ¡†æ¶è®¾è®¡çš„ä¸€ä¸ªé‡å¤§è½¬å˜ï¼Œå½±å“åŠ›å¤§åˆ°æ¯ä¸ªä¸»è¦æ¡†æ¶éƒ½å…¬å¼€å€Ÿç”¨äº† React ä½¿ç”¨ <a href="https://reactjs.org/docs/faq-internals.html">è™šæ‹Ÿ DOM</a> å®ç°çš„å£°æ˜å¼æ–¹æ³• â€” Emberã€Angularã€Vue.jsï¼Œç­‰ç­‰ã€‚æˆªè‡³2018å¹´ï¼ŒWeb å¼€å‘ç¤¾åŒºå·²åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæ¥å—è¿™ç§èŒƒå¼ä½œä¸ºæ„å»ºç°ä»£ Web åº”ç”¨ç¨‹åºçš„æ–¹å¼ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œä»¥æ¸…æ™°ä¸”å¯ç»´æŠ¤çš„æ–¹å¼ç¼–å†™ HTML çš„æ„¿æœ›ä½¿æˆ‘ä»¬è¿›å…¥äº†ä¸€ä¸ªéœ€è¦å¤§é‡ç¼–ç¨‹çŸ¥è¯†çš„åœ°æ–¹;å‡ ä¹ä¸å¯èƒ½ç‰¹åˆ«é¿å… JavaScriptã€‚ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œè¿™æ‰“ç ´äº†HTMLçš„æ‰¿è¯ºï¼ŒHTML è¢«è®¾è®¡æˆä¸€ç§ä¸éœ€è¦ç†è§£ç¼–ç¨‹å°±å¯ä»¥æœ‰æ•ˆä½¿ç”¨çš„è¯­è¨€ã€‚æœªæ¥å¯èƒ½ä¼šæœ‰å¼€å‘äººå‘˜å¯ä»¥åœ¨çº¯ HTML ä¸­å…±äº«é¢„å…ˆæ„å»ºçš„ Web ç»„ä»¶ï¼Œä½†æœªæ¥å¯èƒ½éœ€è¦ç›¸å½“é•¿çš„æ—¶é—´æ‰èƒ½åˆ°æ¥ã€‚</p>
<blockquote>
<p>æœ¬èŠ‚ä»…ç®€è¦æ¦‚è¿°äº† React å’Œå…¶ä»–ç±»ä¼¼æ¡†æ¶é‡‡ç”¨çš„å‰ç«¯æ–¹æ³•ã€‚å¦‚æœä½ æƒ³è¦æ›´å®Œæ•´çš„è§£é‡Šå’Œæ•™ç¨‹ï¼Œå…³äºå¦‚ä½•ä½¿ç”¨å„ç§JavaScriptæ¡†æ¶å’Œæ–¹æ³•æ„å»ºä¸€ä¸ªå·¥ä½œçš„åº”ç”¨ç¨‹åºï¼Œè¯·æŸ¥çœ‹æˆ‘çš„ç³»åˆ—æ¯”è¾ƒå‰ç«¯æ–¹æ³•ï¼š<a href="https://medium.com/actualize-network/comparing-frontend-frameworks-part-1-introduction-6cf3d49e42cf">çœ‹çœ‹jQueryï¼ŒVue.jsï¼ŒReactå’ŒElm</a>ã€‚</p>
</blockquote>
<h3 id="ç»“è®º">ç»“è®º</h3>
<p>ç®€è€Œè¨€ä¹‹ï¼Œè¿™å°±æ˜¯ç°ä»£ HTMLã€‚æˆ‘ä»¬ä»‹ç»äº†ä½¿ç”¨é€‚å½“çš„æ ‡ç­¾å’Œ aria å±æ€§ç¼–å†™è¯­ä¹‰å’Œå¯è®¿é—®çš„å†…å®¹ï¼Œä½¿ç”¨ CSS å’Œ JavaScript æ·»åŠ æ ·å¼å’ŒåŠ¨æ€åŠŸèƒ½ï¼Œä½¿ç”¨ HTML å±æ€§å’Œå·¥å…·æé«˜æ€§èƒ½ï¼Œæœ€åä½¿ç”¨æ¨¡æ¿å’Œç»„ä»¶æ¥æé«˜å¯ç»´æŠ¤æ€§ã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¦å……åˆ†åˆ©ç”¨ç°ä»£ HTMLï¼Œå‡ ä¹ä¸å¯èƒ½é¿å…ä½¿ç”¨æ„å»ºè¿‡ç¨‹ä»¥åŠæŸç§å½¢å¼çš„ç‹¬ç«‹ç¼–ç¨‹è¯­è¨€ï¼Œå¯¹äºå¤§å¤šæ•°æ–¹æ³•æ¥è¯´ï¼Œè¿™é€šå¸¸æ˜¯ JavaScriptã€‚</p>
<p>ä»é«˜å±‚æ¬¡æ¥çœ‹å®ƒæœ‰æ—¶ä¼šä»¤äººæ²®ä¸§â€”â€”è¿‡å»æ˜¯ä¸€ä¸ªç®€å•æ˜“ç”¨çš„å·¥ä½œï¼ˆç”¨ HTML åˆ¶ä½œç½‘ç«™ï¼‰ç°åœ¨å˜å¾—å¤æ‚ä¸”ä¼¼ä¹éš¾ä»¥æ¥è¿‘ï¼ˆä½¿ç”¨JavaScriptå‰ç«¯æ¡†æ¶åˆ¶ä½œ Web åº”ç”¨ç¨‹åºï¼Œä½¿ç”¨å…·æœ‰æ•°åƒä¸ªæ½œåœ¨è„†å¼±ä¾èµ–é¡¹çš„æ„å»ºè¿‡ç¨‹ï¼‰ã€‚ç„¶è€Œï¼Œé‡è¦çš„æ˜¯è¦æ³¨æ„ï¼ŒWeb å¼€å‘ä½œä¸ºä¸€ä¸ªè¡Œä¸šåªå­˜åœ¨äº†å¤§çº¦30å¹´ - ä¸å…¶ä»–è¡Œä¸šï¼ˆä¾‹å¦‚å·²ç»å­˜åœ¨äº†è®¸å¤šä¸–çºªçš„å»ºç­‘ï¼‰ç›¸æ¯”ï¼Œè¿™åªæ˜¯å†å²çš„ä¸€å°éƒ¨åˆ†ã€‚å°±å¥½åƒ Web å¼€å‘äººå‘˜åˆšåˆšå­¦ä¼šäº†å¦‚ä½•ç”¨ç²˜åœŸå»ºé€ æˆ¿å±‹ï¼Œç°åœ¨è¢«è¦æ±‚ä½¿ç”¨ç›¸åŒçš„å·¥å…·æ¥å»ºé€ æ‘©å¤©å¤§æ¥¼ã€‚æˆ‘ä»¬çš„å·¥å…·å’Œæµç¨‹ä¸æ–­å‘å±•æ˜¯å¾ˆè‡ªç„¶çš„;æˆ‘ä»¬åªéœ€è¦ç¡®ä¿å®ƒä»¥ä¸€ç§<a href="https://www.vanityfair.com/news/2018/07/the-man-who-created-the-world-wide-web-has-some-regrets">åŒ…å®¹ç½‘ç»œä½œä¸ºæ°‘ä¸»å¹³å°</a>çš„æœ€åˆæ„¿æ™¯çš„æ–¹å¼å‘å±•ã€‚</p>
<p>ç°ä»£ HTML çš„ä½¿ç”¨è‚¯å®šä¼šä»¤äººæ²®ä¸§ï¼Œå› ä¸ºå®ƒç»§ç»­å¿«é€Ÿå˜åŒ–å’Œå‘å±•ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ç°åœ¨èƒ½å¤Ÿåšçš„æ¯”ä»¥å¾€ä»»ä½•æ—¶å€™éƒ½å¤šï¼Œè€Œä¸”æˆ‘ä»¬åŸºæœ¬ä¸Šéƒ½å¤„äºä¸€ä¸ªæ–°è¡Œä¸šçš„åº•å±‚ï¼Œæœ‰å¯èƒ½å°†å…¶å¡‘é€ æˆæˆ‘ä»¬å¸Œæœ›å®ƒæˆä¸ºçš„å¹³å°ã€‚ä½œä¸ºä¸€åå¼€å‘äººå‘˜ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¿€åŠ¨äººå¿ƒçš„æ—¶åˆ»ï¼Œæˆ‘å¸Œæœ›è¿™äº›ä¿¡æ¯å¯ä»¥ä½œä¸ºè·¯çº¿å›¾ï¼Œåœ¨æ‚¨çš„æ—…ç¨‹ä¸­ä¸ºæ‚¨æä¾›å¸®åŠ©ï¼</p>
<p><img loading="lazy" src="https://peterxjang.com/img/1__fHND__kRQTWkLMFlOwbZNrw.png" alt="Dinosaur comic panel 5"  />
</p>
<p>ç‰¹åˆ«æ„Ÿè°¢ <a href="https://twitter.com/ryanqnorth">@ryanqnorth</a> çš„ <a href="http://www.qwantz.com/">æé¾™æ¼«ç”»</a>ï¼Œè‡ª2003å¹´ä»¥æ¥ï¼ˆæé¾™ç»Ÿæ²»ç½‘ç»œï¼‰ä»¥æ¥ï¼Œå®ƒæä¾›äº†ä¸€äº›æœ€å¥½çš„è’è¯å¹½é»˜ã€‚</p>
<blockquote>
<p>å¯¹è¿™ç§å­¦ä¹ æ–¹å¼æ„Ÿå…´è¶£ï¼Ÿè¯·åŠ¡å¿…æŸ¥çœ‹ <a href="http://anyonecanlearntocode.com/">Actualize ç¼–ç è®­ç»ƒè¥</a>ï¼ˆæˆ‘æ˜¯æ•™å­¦ä¸»ä»»å’Œé¦–å¸­è®²å¸ˆï¼‰ã€‚æˆ‘ä»¬åœ¨èŠåŠ å“¥æä¾› <a href="http://anyonecanlearntocode.com/chicago-coding-bootcamp">é¢å¯¹é¢çš„è¯¾ç¨‹</a> ä»¥åŠ <a href="http://anyonecanlearntocode.com/online-coding-bootcamp">å®æ—¶åœ¨çº¿è¯¾ç¨‹</a>ï¼Œä»¥å¸®åŠ©äººä»¬è¿‡æ¸¡åˆ°ç°ä»£ç½‘ç»œå¼€å‘äººå‘˜çš„æ–°èŒä¸šï¼</p>
</blockquote>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://peterxjang.com/blog/modern-html-explained-for-dinosaurs.html">https://peterxjang.com/blog/modern-html-explained-for-dinosaurs.html</a></p>
]]></content:encoded>
    </item>
    
    <item>
      <title>[è¯‘]ä¸ºæé¾™è§£é‡Šç°ä»£JavaScript</title>
      <link>https://blog.chensoul.com/posts/2023/06/19/modern-javascript-explained-for-dinosaurs/</link>
      <pubDate>Mon, 19 Jun 2023 09:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/06/19/modern-javascript-explained-for-dinosaurs/</guid>
      <description>å›¾ç‰‡æ¥è‡ªRyan Northçš„Dinosaur Comicsã€‚ å¦‚æœä½ ä»ä¸€å¼€å§‹å°±æ²¡æœ‰å»è¿‡é‚£é‡Œï¼Œé‚£ä¹ˆå­¦ä¹ ç°ä»£ JavaScript æ˜¯å¾ˆå›°éš¾çš„ã€‚ç”Ÿæ€ç³»ç»Ÿçš„å‘å±•å’Œå˜åŒ–å¦‚æ­¤ä¹‹</description>
      <content:encoded><![CDATA[<p><img loading="lazy" src="https://peterxjang.com/img/1__H8PH__HaV43gZyBJz0mJHxA.png" alt="Images from Dinosaur Comics by Ryan North"  />
</p>
<center>å›¾ç‰‡æ¥è‡ªRyan Northçš„Dinosaur Comicsã€‚</center>
<p>å¦‚æœä½ ä»ä¸€å¼€å§‹å°±æ²¡æœ‰å»è¿‡é‚£é‡Œï¼Œé‚£ä¹ˆå­¦ä¹ ç°ä»£ JavaScript æ˜¯å¾ˆå›°éš¾çš„ã€‚ç”Ÿæ€ç³»ç»Ÿçš„å‘å±•å’Œå˜åŒ–å¦‚æ­¤ä¹‹å¿«ï¼Œä»¥è‡³äºå¾ˆéš¾ç†è§£ä¸åŒå·¥å…·è¯•å›¾è§£å†³çš„é—®é¢˜ã€‚æˆ‘ä» 1998 å¹´å¼€å§‹ç¼–ç¨‹ï¼Œä½†ç›´åˆ° 2014 å¹´æ‰å¼€å§‹è®¤çœŸå­¦ä¹  JavaScriptã€‚å½“æ—¶æˆ‘è®°å¾—é‡åˆ° <a href="http://browserify.org/">Browserify</a> å¹¶ç›¯ç€å®ƒçš„æ ‡è¯­ï¼š</p>
<blockquote>
<p>Browserify é€šè¿‡æ†ç»‘æ‰€æœ‰ä¾èµ–é¡¹ï¼Œè®©ä½ åœ¨æµè§ˆå™¨ä¸­å¯¼å…¥ï¼ˆ&lsquo;æ¨¡å—&rsquo;ï¼‰ã€‚</p>
</blockquote>
<p>æˆ‘å‡ ä¹å¬ä¸æ‡‚è¿™å¥è¯ä¸­çš„ä»»ä½•å•è¯ï¼Œå¹¶ä¸”åŠªåŠ›ç†è§£è¿™å¯¹æˆ‘ä½œä¸ºå¼€å‘äººå‘˜æœ‰ä»€ä¹ˆå¸®åŠ©ã€‚</p>
<p>æœ¬æ–‡çš„ç›®çš„æ˜¯æä¾›ä¸€ä¸ªå†å²èƒŒæ™¯ï¼Œè¯´æ˜ JavaScript å·¥å…·å¦‚ä½•åœ¨ 2017 å¹´å‘å±•åˆ°ä»Šå¤©çš„æ ·å­ã€‚æˆ‘ä»¬å°†ä»å¤´å¼€å§‹ï¼Œåƒæé¾™ä¸€æ ·æ„å»ºä¸€ä¸ªç¤ºä¾‹ç½‘ç«™ - æ²¡æœ‰å·¥å…·ï¼Œåªæœ‰æ™®é€šçš„ HTML å’Œ JavaScriptã€‚ç„¶åï¼Œæˆ‘ä»¬å°†é€æ­¥ä»‹ç»ä¸åŒçš„å·¥å…·ï¼Œä»¥æŸ¥çœ‹å®ƒä»¬ä¸€æ¬¡è§£å†³ä¸€ä¸ªé—®é¢˜ã€‚æœ‰äº†è¿™ä¸ªå†å²èƒŒæ™¯ï¼Œä½ å°†èƒ½å¤Ÿæ›´å¥½åœ°å­¦ä¹ å’Œé€‚åº”æœªæ¥ä¸æ–­å˜åŒ–çš„ JavaScript ç¯å¢ƒã€‚è®©æˆ‘ä»¬å¼€å§‹å§ï¼</p>
<blockquote>
<p>æ›´æ–°ï¼šæˆ‘åˆ¶ä½œäº†æœ¬æ–‡çš„è§†é¢‘è¯¾ç¨‹ç‰ˆæœ¬ï¼Œä¸ºäº†æ›´æ¸…æ™°ï¼Œæˆ‘é€æ­¥æµè§ˆäº†æ¯ä¸ªéƒ¨åˆ†ï¼Œè¯·åœ¨æ­¤å¤„æŸ¥çœ‹ï¼š
<a href="https://firstclass.actualize.co/p/modern-javascript-explained-for-dinosaurs">https://firstclass.actualize.co/p/modern-javascript-explained-for-dinosaurs</a></p>
</blockquote>
<h3 id="ä»¥è€æ´¾çš„æ–¹å¼ä½¿ç”¨-javascript">ä»¥&quot;è€æ´¾&quot;çš„æ–¹å¼ä½¿ç”¨ JavaScript</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="c">&lt;!-- index.html --&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>JavaScript Example<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  **<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;index.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>**  
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Hello from HTML!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>ç¬¬ <code>&lt;script src=&quot;index.js&quot;&gt;&lt;/script&gt;</code> è¡Œå¼•ç”¨åŒä¸€ç›®å½•ä¸­åä¸º <code>index.js</code> çš„å•ç‹¬ JavaScript æ–‡ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// index.js  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Hello from JavaScript!&#34;</span><span class="p">);</span>
</span></span></code></pre></div><p>è¿™å°±æ˜¯åˆ¶ä½œç½‘ç«™æ‰€éœ€çš„å…¨éƒ¨å†…å®¹ï¼ç°åœ¨ï¼Œå‡è®¾æ‚¨æƒ³æ·»åŠ ä¸€ä¸ªå…¶ä»–äººç¼–å†™çš„åº“ï¼Œä¾‹å¦‚ moment.jsï¼ˆä¸€ä¸ªå¯ä»¥å¸®åŠ©ä»¥äººç±»å¯è¯»çš„æ–¹å¼æ ¼å¼åŒ–æ—¥æœŸçš„åº“ï¼‰ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨ JavaScript ä¸­ä½¿ç”¨ <code>moment</code> å‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">moment</span><span class="p">().</span><span class="nx">startOf</span><span class="p">(</span><span class="s1">&#39;day&#39;</span><span class="p">).</span><span class="nx">fromNow</span><span class="p">();</span>        <span class="c1">// 20 hours ago
</span></span></span></code></pre></div><p>ä½†è¿™åªæ˜¯å‡è®¾æ‚¨åœ¨ç½‘ç«™ä¸ŠåŒ…å« moment.jsï¼åœ¨ <a href="http://momentjs.com/">moment.js ä¸»é¡µ</a> ä¸Šæ‚¨ä¼šçœ‹åˆ°ä»¥ä¸‹è¯´æ˜ï¼š</p>
<p><img loading="lazy" src="https://peterxjang.com/img/1__ef7OX37jr____Jc38ZxO97Iw.png" alt="Install instructions for moment.js"  />
</p>
<p>å—¯ï¼Œå³ä¾§çš„&quot;å®‰è£…&quot;éƒ¨åˆ†æœ‰å¾ˆå¤šå†…å®¹ã€‚ä½†æ˜¯ç°åœ¨è®©æˆ‘ä»¬å¿½ç•¥å®ƒ - æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨åŒä¸€ç›®å½•ä¸­ä¸‹è½½ <code>moment.min.js</code> æ–‡ä»¶å¹¶å°†å…¶åŒ…å«åœ¨æˆ‘ä»¬çš„ <code>index.html</code> æ–‡ä»¶ä¸­æ¥ä¸ºæˆ‘ä»¬çš„ç½‘ç«™æ·»åŠ  moment.jsã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="c">&lt;!-- index.html --&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Example<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;index.css&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;moment.min.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;index.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Hello from HTML!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>è¯·æ³¨æ„ï¼Œ <code>moment.min.js</code> åœ¨ <code>index.js</code> ä¹‹å‰åŠ è½½ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥åœ¨ <code>index.js</code> ä¸­ä½¿ç”¨ <code>moment</code> å‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// index.js  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Hello from JavaScript!&#34;</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">moment</span><span class="p">().</span><span class="nx">startOf</span><span class="p">(</span><span class="s1">&#39;day&#39;</span><span class="p">).</span><span class="nx">fromNow</span><span class="p">());</span>
</span></span></code></pre></div><p>è¿™å°±æ˜¯æˆ‘ä»¬è¿‡å»ä½¿ç”¨ JavaScript åº“åˆ¶ä½œç½‘ç«™çš„æ–¹å¼ï¼å¥½æ¶ˆæ¯æ˜¯å®ƒå¾ˆå®¹æ˜“ç†è§£ã€‚ä¸å¥½çš„æ˜¯ï¼Œæ¯æ¬¡æ›´æ–°æ—¶æŸ¥æ‰¾å’Œä¸‹è½½æ–°ç‰ˆæœ¬çš„åº“éƒ½å¾ˆçƒ¦äººã€‚</p>
<h3 id="ä½¿ç”¨-javascript-åŒ…ç®¡ç†å™¨-npm">ä½¿ç”¨ JavaScript åŒ…ç®¡ç†å™¨ ï¼ˆnpmï¼‰</h3>
<p>ä» 2010 å¹´å·¦å³å¼€å§‹ï¼Œå‡ºç°äº†å‡ ä¸ªç›¸äº’ç«äº‰çš„ JavaScript åŒ…ç®¡ç†å™¨ï¼Œä»¥å¸®åŠ©è‡ªåŠ¨åŒ–ä»ä¸­å¤®å­˜å‚¨åº“ä¸‹è½½å’Œå‡çº§åº“çš„è¿‡ç¨‹ã€‚<a href="https://bower.io/">Bower</a> å¯ä»¥è¯´æ˜¯2013å¹´æœ€å—æ¬¢è¿çš„ï¼Œä½†æœ€ç»ˆåœ¨2015å¹´å·¦å³è¢« <a href="https://www.npmjs.com/">npm</a> è¶…è¶Šã€‚ï¼ˆå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä» 2016 å¹´æœ«å¼€å§‹ï¼Œ<a href="https://yarnpkg.com/en/">yarn</a> ä½œä¸º npm æ¥å£çš„æ›¿ä»£å“è·å¾—äº†å¾ˆå¤§çš„å…³æ³¨ï¼Œä½†å®ƒä»ç„¶åœ¨å¼•æ“ç›–ä¸‹ä½¿ç”¨ npm åŒ…ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œnpm æœ€åˆæ˜¯ä¸“é—¨ä¸º node.js åˆ¶ä½œçš„åŒ…ç®¡ç†å™¨ï¼Œè¿™æ˜¯ä¸€ä¸ªæ—¨åœ¨åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œçš„ JavaScript è¿è¡Œæ—¶ï¼Œè€Œä¸æ˜¯å‰ç«¯ã€‚å› æ­¤ï¼Œå¯¹äºæ‰“ç®—åœ¨æµè§ˆå™¨ä¸­è¿è¡Œçš„åº“çš„å‰ç«¯ JavaScript åŒ…ç®¡ç†å™¨æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å¥‡æ€ªçš„é€‰æ‹©ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šä½¿ç”¨åŒ…ç®¡ç†å™¨é€šå¸¸æ¶‰åŠä½¿ç”¨å‘½ä»¤è¡Œï¼Œè¿‡å»å‰ç«¯å¼€å‘ä»ä¸éœ€è¦å‘½ä»¤è¡Œã€‚å¦‚æœæ‚¨ä»æœªä½¿ç”¨è¿‡ï¼Œå¯ä»¥é˜…è¯»<a href="https://www.learnenough.com/command-line-tutorial">æœ¬æ•™ç¨‹</a>ä»¥è·å–å…¥é—¨çš„è‰¯å¥½æ¦‚è¿°ã€‚æ— è®ºå¥½åï¼ŒçŸ¥é“å¦‚ä½•ä½¿ç”¨å‘½ä»¤è¡Œæ˜¯ç°ä»£JavaScriptçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼ˆå®ƒä¹Ÿä¸ºå…¶ä»–å¼€å‘é¢†åŸŸæ‰“å¼€äº†å¤§é—¨ï¼‰ã€‚</p>
</blockquote>
<p>è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ npm è‡ªåŠ¨å®‰è£… moment.js åŒ…ï¼Œè€Œä¸æ˜¯æ‰‹åŠ¨ä¸‹è½½å®ƒã€‚å¦‚æœæ‚¨å®‰è£…äº† node.jsï¼Œåˆ™æ‚¨å·²ç»å®‰è£…äº† npmï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥å°†å‘½ä»¤è¡Œå¯¼èˆªåˆ°åŒ…å« <code>index.html</code> æ–‡ä»¶çš„æ–‡ä»¶å¤¹å¹¶è¾“å…¥ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ npm init
</span></span></code></pre></div><p>è¿™å°†æç¤ºæ‚¨å‡ ä¸ªé—®é¢˜ï¼ˆé»˜è®¤å€¼å¾ˆå¥½ï¼Œæ‚¨å¯ä»¥ä¸ºæ¯ä¸ªé—®é¢˜ç‚¹å‡»â€œEnterâ€ï¼‰å¹¶ç”Ÿæˆä¸€ä¸ªåä¸º <code>package.json</code> çš„æ–°æ–‡ä»¶ã€‚è¿™æ˜¯ npm ç”¨æ¥ä¿å­˜æ‰€æœ‰é¡¹ç›®ä¿¡æ¯çš„é…ç½®æ–‡ä»¶ã€‚ä½¿ç”¨é»˜è®¤å€¼æ—¶ï¼Œ <code>package.json</code> çš„å†…å®¹åº”å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;your-project-name&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1.0.0&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;main&#34;</span><span class="p">:</span> <span class="s2">&#34;index.js&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;scripts&#34;</span><span class="p">:</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;test&#34;</span><span class="p">:</span> <span class="s2">&#34;echo \&#34;Error: no test specified\&#34; &amp;&amp; exit 1&#34;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">},</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;author&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;license&#34;</span><span class="p">:</span> <span class="s2">&#34;ISC&#34;</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>è¦å®‰è£… moment.js JavaScript åŒ…ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥é€šè¿‡åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥æŒ‰ç…§å…¶ä¸»é¡µä¸Šçš„ npm è¯´æ˜è¿›è¡Œæ“ä½œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ npm install moment --save
</span></span></code></pre></div><p>æ­¤å‘½ä»¤æ‰§è¡Œä¸¤ä»¶äº‹ â€” é¦–å…ˆï¼Œå®ƒä» <a href="https://unpkg.com/moment/">moment.js åŒ…</a> ä¸‹è½½æ‰€æœ‰ä»£ç åä¸º <code>node_modules</code> çš„æ–‡ä»¶å¤¹ä¸­ã€‚å…¶æ¬¡ï¼Œå®ƒä¼šè‡ªåŠ¨ä¿®æ”¹ <code>package.json</code> æ–‡ä»¶ä»¥è·Ÿè¸ª moment.js ä½œä¸ºé¡¹ç›®ä¾èµ–é¡¹ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;modern-javascript-example&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1.0.0&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;main&#34;</span><span class="p">:</span> <span class="s2">&#34;index.js&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;scripts&#34;</span><span class="p">:</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;test&#34;</span><span class="p">:</span> <span class="s2">&#34;echo \&#34;Error: no test specified\&#34; &amp;&amp; exit 1&#34;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">},</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;author&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;license&#34;</span><span class="p">:</span> <span class="s2">&#34;ISC&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;dependencies&#34;</span><span class="p">:</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;moment&#34;</span><span class="p">:</span> <span class="s2">&#34;^2.22.2&#34;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>è¿™åœ¨ä»¥åä¸ä»–äººå…±äº«é¡¹ç›®æ—¶å¾ˆæœ‰ç”¨ - è€Œä¸æ˜¯å…±äº« <code>node_modules</code> æ–‡ä»¶å¤¹ï¼ˆå¯èƒ½ä¼šå˜å¾—éå¸¸å¤§ï¼‰ï¼Œæ‚¨åªéœ€è¦å…±äº« <code>package.json</code> æ–‡ä»¶ï¼Œå…¶ä»–å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨å‘½ä»¤ <code>npm install</code> è‡ªåŠ¨å®‰è£…æ‰€éœ€çš„åŒ…ã€‚</p>
<p>æ‰€ä»¥ç°åœ¨æˆ‘ä»¬ä¸å†éœ€è¦ä»ç½‘ç«™ä¸Šæ‰‹åŠ¨ä¸‹è½½ momentjsï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ npm è‡ªåŠ¨ä¸‹è½½å’Œæ›´æ–°å®ƒã€‚æŸ¥çœ‹ <code>node_modules</code> æ–‡ä»¶å¤¹å†…éƒ¨ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>moment.min.js</code> ç›®å½•ä¸­çš„ <code>node_modules/moment/min</code> æ–‡ä»¶ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥é“¾æ¥åˆ° <code>index.html</code> æ–‡ä»¶ä¸­çš„ npm ä¸‹è½½ç‰ˆæœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="c">&lt;!-- index.html --&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>JavaScript Example<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;node_modules/moment/min/moment.min.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;index.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Hello from HTML!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>æ‰€ä»¥å¥½æ¶ˆæ¯æ˜¯æˆ‘ä»¬ç°åœ¨å¯ä»¥ä½¿ç”¨ npm é€šè¿‡å‘½ä»¤è¡Œä¸‹è½½å’Œæ›´æ–°æˆ‘ä»¬çš„åŒ…ã€‚ä¸å¥½çš„æ˜¯ï¼Œç°åœ¨æˆ‘ä»¬æ­£åœ¨æŒ–æ˜ <code>node_modules</code> æ–‡ä»¶å¤¹ä»¥æŸ¥æ‰¾æ¯ä¸ªåŒ…çš„ä½ç½®ï¼Œå¹¶æ‰‹åŠ¨å°†å…¶åŒ…å«åœ¨æˆ‘ä»¬çš„ HTML ä¸­ã€‚è¿™å¾ˆä¸æ–¹ä¾¿ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬å°†çœ‹çœ‹å¦‚ä½•è‡ªåŠ¨åŒ–è¯¥è¿‡ç¨‹ã€‚</p>
<p><img loading="lazy" src="https://peterxjang.com/img/1__GeEETvRqyG4o7SZdbU2Guw.png" alt="Dinosaur comic panel 2"  />
</p>
<h3 id="ä½¿ç”¨-javascript-æ¨¡å—æ†ç»‘å™¨webpack">ä½¿ç”¨ JavaScript æ¨¡å—æ†ç»‘å™¨ï¼ˆwebpack)ã€€</h3>
<p>å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€éƒ½æä¾›äº†ä¸€ç§å°†ä»£ç ä»ä¸€ä¸ªæ–‡ä»¶å¯¼å…¥å¦ä¸€ä¸ªæ–‡ä»¶çš„æ–¹æ³•ã€‚JavaScript æœ€åˆå¹¶ä¸æ˜¯ä½¿ç”¨æ­¤åŠŸèƒ½è®¾è®¡çš„ï¼Œå› ä¸º JavaScript è¢«è®¾è®¡ä¸ºä»…åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼Œæ— æ³•è®¿é—®å®¢æˆ·ç«¯è®¡ç®—æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼ˆå‡ºäºå®‰å…¨åŸå› ï¼‰ã€‚å› æ­¤ï¼Œåœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´å†…ï¼Œåœ¨å¤šä¸ªæ–‡ä»¶ä¸­ç»„ç»‡ JavaScript ä»£ç éœ€è¦æ‚¨ä½¿ç”¨å…¨å±€å…±äº«çš„å˜é‡åŠ è½½æ¯ä¸ªæ–‡ä»¶ã€‚</p>
<p>è¿™å®é™…ä¸Šæ˜¯æˆ‘ä»¬åœ¨ä¸Šé¢æ‰€åšçš„ moment.js ç¤ºä¾‹ â€” æ•´ä¸ª <code>moment.min.js</code> æ–‡ä»¶åŠ è½½åˆ° HTML ä¸­ï¼ŒHTML å®šä¹‰äº†ä¸€ä¸ªå…¨å±€å˜é‡ <code>moment</code> ï¼Œç„¶åå¯ç”¨äºåœ¨ <code>moment.min.js</code> ä¹‹ååŠ è½½çš„ä»»ä½•æ–‡ä»¶ï¼ˆæ— è®ºå®ƒæ˜¯å¦éœ€è¦è®¿é—®å®ƒï¼‰ã€‚</p>
<p>2009å¹´ï¼Œä¸€ä¸ªåä¸º CommonJS çš„é¡¹ç›®å¯åŠ¨ï¼Œç›®æ ‡æ˜¯åœ¨æµè§ˆå™¨ä¹‹å¤–ä¸º JavaScript æŒ‡å®šä¸€ä¸ªç”Ÿæ€ç³»ç»Ÿã€‚CommonJS çš„å¾ˆå¤§ä¸€éƒ¨åˆ†æ˜¯å®ƒçš„æ¨¡å—è§„èŒƒï¼Œå®ƒæœ€ç»ˆå…è®¸ JavaScript åƒå¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ä¸€æ ·è·¨æ–‡ä»¶å¯¼å…¥å’Œå¯¼å‡ºä»£ç ï¼Œè€Œæ— éœ€è¯‰è¯¸å…¨å±€å˜é‡ã€‚æœ€è‘—åçš„ CommonJS æ¨¡å—å®ç°æ˜¯ node.jsã€‚</p>
<p><img loading="lazy" src="https://peterxjang.com/img/1__xeF1flp1zDLLJ4j7rDQ6__Q.png#medium" alt="Node.js logo"  />
</p>
<p>å¦‚å‰æ‰€è¿°ï¼Œnode.js æ˜¯ä¸€ä¸ªè®¾è®¡ç”¨äºåœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œçš„ JavaScript è¿è¡Œæ—¶ã€‚ä¸‹é¢æ˜¯å‰é¢çš„ç¤ºä¾‹ä½¿ç”¨ node.js æ¨¡å—çš„æ ·å­ã€‚ä¸å…¶ä½¿ç”¨ HTML è„šæœ¬æ ‡è®°åŠ è½½æ‰€æœ‰ <code>moment.min.js</code> ï¼Œä¸å¦‚ç›´æ¥å°†å…¶åŠ è½½åˆ° JavaScript æ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// index.js  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">moment</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;moment&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Hello from JavaScript!&#34;</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">moment</span><span class="p">().</span><span class="nx">startOf</span><span class="p">(</span><span class="s1">&#39;day&#39;</span><span class="p">).</span><span class="nx">fromNow</span><span class="p">());</span>
</span></span></code></pre></div><p>åŒæ ·ï¼Œè¿™å°±æ˜¯æ¨¡å—åŠ è½½åœ¨ node.js ä¸­çš„å·¥ä½œæ–¹å¼ï¼Œç”±äº node.js æ˜¯ä¸€ç§å¯ä»¥è®¿é—®è®¡ç®—æœºæ–‡ä»¶ç³»ç»Ÿçš„æœåŠ¡å™¨ç«¯è¯­è¨€ï¼Œå› æ­¤æ•ˆæœå¾ˆå¥½ã€‚Node.js ä¹ŸçŸ¥é“æ¯ä¸ª npm æ¨¡å—è·¯å¾„çš„ä½ç½®ï¼Œæ‰€ä»¥ä½ ä¸å¿…å†™ <code>require('./node_modules/moment/min/moment.min.js)</code> ï¼Œä½ å¯ä»¥ç®€å•åœ°å†™ <code>require('moment')</code> â€” éå¸¸ç”œèœœã€‚</p>
<p>è¿™å¯¹äº node.js æ¥è¯´éƒ½å¾ˆæ£’ï¼Œä½†æ˜¯å¦‚æœæ‚¨å°è¯•åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ä¸Šè¿°ä»£ç ï¼Œåˆ™ä¼šæ”¶åˆ°ä¸€æ¡é”™è¯¯æ¶ˆæ¯ï¼ŒæŒ‡å‡ºæœªå®šä¹‰æµè§ˆå™¨æ— æ³•è®¿é—®æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™æ„å‘³ç€ä»¥è¿™ç§æ–¹å¼åŠ è½½æ¨¡å—éå¸¸æ£˜æ‰‹ - åŠ è½½æ–‡ä»¶å¿…é¡»åŠ¨æ€å®Œæˆï¼ŒåŒæ­¥ï¼ˆè¿™ä¼šå‡æ…¢æ‰§è¡Œé€Ÿåº¦ï¼‰æˆ–å¼‚æ­¥ï¼ˆå¯èƒ½å­˜åœ¨è®¡æ—¶é—®é¢˜ï¼‰ã€‚</p>
<p>è¿™å°±æ˜¯æ¨¡å—æ†ç»‘å™¨çš„ç”¨æ­¦ä¹‹åœ°ã€‚JavaScript æ¨¡å—æ†ç»‘å™¨æ˜¯ä¸€ç§å·¥å…·ï¼Œå®ƒé€šè¿‡æ„å»ºæ­¥éª¤ï¼ˆå¯ä»¥è®¿é—®æ–‡ä»¶ç³»ç»Ÿï¼‰æ¥è§£å†³é—®é¢˜ï¼Œä»¥åˆ›å»ºä¸æµè§ˆå™¨å…¼å®¹çš„æœ€ç»ˆè¾“å‡ºï¼ˆä¸éœ€è¦è®¿é—®æ–‡ä»¶ç³»ç»Ÿï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ¨¡å—æ†ç»‘å™¨æ¥æŸ¥æ‰¾æ‰€æœ‰ <code>require</code> è¯­å¥ï¼ˆè¿™æ˜¯æ— æ•ˆçš„æµè§ˆå™¨ JavaScript è¯­æ³•ï¼‰ï¼Œå¹¶å°†å®ƒä»¬æ›¿æ¢ä¸ºæ¯ä¸ªæ‰€éœ€æ–‡ä»¶çš„å®é™…å†…å®¹ã€‚æœ€ç»ˆç»“æœæ˜¯ä¸€ä¸ªæ†ç»‘çš„ JavaScript æ–‡ä»¶ï¼ˆæ²¡æœ‰ require è¯­å¥ï¼‰ï¼</p>
<p>æœ€æµè¡Œçš„æ¨¡å—æ†ç»‘å™¨æ˜¯ Browserifyï¼Œå®ƒäº 2011 å¹´å‘å¸ƒï¼Œç‡å…ˆåœ¨å‰ç«¯ä½¿ç”¨ node.js æ ·å¼çš„éœ€æ±‚è¯­å¥ï¼ˆè¿™æœ¬è´¨ä¸Šæ˜¯ä½¿ npm æˆä¸ºé¦–é€‰å‰ç«¯åŒ…ç®¡ç†å™¨çš„åŸå› ï¼‰ã€‚å¤§çº¦åœ¨ 2015 å¹´ï¼Œwebpack æœ€ç»ˆæˆä¸ºä½¿ç”¨æ›´å¹¿æ³›çš„æ¨¡å—æ†ç»‘å™¨ï¼ˆå—åˆ° React å‰ç«¯æ¡†æ¶çš„æ™®åŠçš„æ¨åŠ¨ï¼Œå®ƒå……åˆ†åˆ©ç”¨äº† webpack çš„å„ç§åŠŸèƒ½ï¼‰ã€‚</p>
<p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ webpack è®©ä¸Šé¢çš„ <code>require('moment')</code> ç¤ºä¾‹åœ¨æµè§ˆå™¨ä¸­å·¥ä½œã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å°† webpack å®‰è£…åˆ°é¡¹ç›®ä¸­ã€‚Webpack æœ¬èº«æ˜¯ä¸€ä¸ª npm åŒ…ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä»å‘½ä»¤è¡Œå®‰è£…å®ƒï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ npm install webpack webpack-cli --save-dev
</span></span></code></pre></div><p>è¯·æ³¨æ„ï¼Œæˆ‘ä»¬æ­£åœ¨å®‰è£…ä¸¤ä¸ªè½¯ä»¶åŒ… â€” webpack å’Œ webpack-cliï¼ˆå®ƒä½¿æ‚¨èƒ½å¤Ÿä»å‘½ä»¤è¡Œä½¿ç”¨ webpackï¼‰ã€‚å¦è¯·æ³¨æ„ <code>--save-dev</code> å‚æ•° â€” è¿™ä¼šå°†å…¶ä¿å­˜ä¸ºå¼€å‘ä¾èµ–é¡¹ï¼Œè¿™æ„å‘³ç€å®ƒæ˜¯å¼€å‘ç¯å¢ƒä¸­éœ€è¦çš„åŒ…ï¼Œè€Œä¸æ˜¯ç”Ÿäº§æœåŠ¡å™¨ä¸Šéœ€è¦çš„åŒ…ã€‚æ‚¨å¯ä»¥åœ¨è‡ªåŠ¨æ›´æ–°çš„ <code>package.json</code> æ–‡ä»¶ä¸­çœ‹åˆ°è¿™åæ˜ åœ¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;modern-javascript-example&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1.0.0&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;main&#34;</span><span class="p">:</span> <span class="s2">&#34;index.js&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;scripts&#34;</span><span class="p">:</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;test&#34;</span><span class="p">:</span> <span class="s2">&#34;echo \&#34;Error: no test specified\&#34; &amp;&amp; exit 1&#34;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">},</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;author&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;license&#34;</span><span class="p">:</span> <span class="s2">&#34;ISC&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;dependencies&#34;</span><span class="p">:</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;moment&#34;</span><span class="p">:</span> <span class="s2">&#34;^2.19.1&#34;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">},</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;devDependencies&#34;</span><span class="p">:</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;webpack&#34;</span><span class="p">:</span> <span class="s2">&#34;^4.17.1&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;webpack-cli&#34;</span><span class="p">:</span> <span class="s2">&#34;^3.1.0&#34;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>ç°åœ¨æˆ‘ä»¬å·²ç»å°† webpack å’Œ webpack-cli ä½œä¸ºåŒ…å®‰è£…åœ¨ <code>node_modules</code> æ–‡ä»¶å¤¹ä¸­ã€‚æ‚¨å¯ä»¥ä»å‘½ä»¤è¡Œä½¿ç”¨ webpack-cliï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ ./node_modules/.bin/webpack index.js --mode<span class="o">=</span>development
</span></span></code></pre></div><p>æ­¤å‘½ä»¤å°†è¿è¡Œå®‰è£…åœ¨ <code>node_modules</code> æ–‡ä»¶å¤¹ä¸­çš„ webpack å·¥å…·ï¼Œä» <code>index.js</code> æ–‡ä»¶å¼€å§‹ï¼Œæ‰¾åˆ°ä»»æ„ <code>require</code> è¯­å¥ï¼Œå¹¶å°†å®ƒä»¬æ›¿æ¢ä¸ºé€‚å½“çš„ä»£ç ä»¥åˆ›å»ºå•ä¸ªè¾“å‡ºæ–‡ä»¶ï¼ˆé»˜è®¤ä¸º <code>dist/main.js</code> ï¼‰ã€‚ <code>--mode=development</code> å‚æ•°æ˜¯ä¸ºäº†è®©å¼€å‘äººå‘˜ä¿æŒ JavaScript çš„å¯è¯»æ€§ï¼Œè€Œä¸æ˜¯å‚æ•° <code>--mode=production</code> çš„ç¼©å°è¾“å‡ºã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬æœ‰äº† webpack çš„ <code>dist/main.js</code> è¾“å‡ºï¼Œæˆ‘ä»¬å°†åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨å®ƒè€Œä¸æ˜¯ <code>index.js</code> ï¼Œå› ä¸ºå®ƒåŒ…å«æ— æ•ˆçš„ require è¯­å¥ã€‚è¿™å°†åæ˜ åœ¨ <code>index.html</code> æ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="c">&lt;!-- index.html --&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>JavaScript Example<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;dist/main.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Hello from HTML!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>  
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>å¦‚æœæ‚¨åˆ·æ–°æµè§ˆå™¨ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä¸€åˆ‡éƒ½åƒä»¥å‰ä¸€æ ·å·¥ä½œï¼</p>
<p>è¯·æ³¨æ„ï¼Œæ¯æ¬¡æ›´æ”¹ <code>index.js</code> æ—¶ï¼Œæˆ‘ä»¬éƒ½éœ€è¦è¿è¡Œ webpack å‘½ä»¤ã€‚è¿™å¾ˆä¹å‘³ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ webpack æ›´é«˜çº§çš„åŠŸèƒ½ï¼ˆä¾‹å¦‚ç”Ÿæˆæºæ˜ å°„ä»¥å¸®åŠ©ä»è½¬è¯‘çš„ä»£ç è°ƒè¯•åŸå§‹ä»£ç ï¼‰æ—¶ï¼Œè¿™å°†å˜å¾—æ›´åŠ ä¹å‘³ã€‚Webpack å¯ä»¥ä»åä¸º <code>webpack.config.js</code> çš„é¡¹ç›®æ ¹ç›®å½•ä¸­çš„é…ç½®æ–‡ä»¶ä¸­è¯»å–é€‰é¡¹ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå®ƒçœ‹èµ·æ¥åƒï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// webpack.config.js  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="nx">mode</span><span class="o">:</span> <span class="s1">&#39;development&#39;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nx">entry</span><span class="o">:</span> <span class="s1">&#39;./index.js&#39;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">filename</span><span class="o">:</span> <span class="s1">&#39;main.js&#39;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">publicPath</span><span class="o">:</span> <span class="s1">&#39;dist&#39;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">}</span>  
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>ç°åœ¨æ¯æ¬¡æˆ‘ä»¬æ›´æ”¹ <code>index.js</code> æ—¶ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œ webpackï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ ./node_modules/.bin/webpack
</span></span></code></pre></div><p>æˆ‘ä»¬ä¸å†éœ€è¦æŒ‡å®š <code>index.js</code> å’Œ <code>--mode=development</code> é€‰é¡¹ï¼Œå› ä¸º webpack æ­£åœ¨ä» <code>webpack.config.js</code> æ–‡ä»¶ä¸­åŠ è½½è¿™äº›é€‰é¡¹ã€‚è¿™æ›´å¥½ï¼Œä½†ä¸ºæ¯ä¸ªä»£ç æ›´æ”¹è¾“å…¥æ­¤å‘½ä»¤ä»ç„¶å¾ˆä¹å‘³ - æˆ‘ä»¬å°†ä½¿æ­¤è¿‡ç¨‹æ›´é¡ºç•…ã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼Œè¿™å¯èƒ½çœ‹èµ·æ¥ä¸å¤šï¼Œä½†è¿™ä¸ªå·¥ä½œæµç¨‹æœ‰ä¸€äº›å·¨å¤§çš„ä¼˜åŠ¿ã€‚æˆ‘ä»¬ä¸å†é€šè¿‡å…¨å±€å˜é‡åŠ è½½å¤–éƒ¨è„šæœ¬ã€‚ä»»ä½•æ–°çš„ JavaScript åº“éƒ½å°†åœ¨ JavaScript ä¸­ä½¿ç”¨ <code>require</code> è¯­å¥æ·»åŠ ï¼Œè€Œä¸æ˜¯åœ¨ HTML ä¸­æ·»åŠ æ–°çš„ <code>&lt;script&gt;</code> æ ‡ç­¾ã€‚æ‹¥æœ‰å•ä¸ª JavaScript æ†ç»‘åŒ…æ–‡ä»¶é€šå¸¸å¯¹æ€§èƒ½æ›´å¥½ã€‚ç°åœ¨æˆ‘ä»¬æ·»åŠ äº†æ„å»ºæ­¥éª¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶ä»–ä¸€äº›å¼ºå¤§çš„åŠŸèƒ½æ·»åŠ åˆ°æˆ‘ä»¬çš„å¼€å‘å·¥ä½œæµç¨‹ä¸­ï¼</p>
<p><img loading="lazy" src="https://peterxjang.com/img/1__ee__ivxNTKgIJTjmEMC4__dg.png" alt="Dinosaur comic panels 3 and 4"  />
</p>
<h3 id="ä¸ºæ–°çš„è¯­è¨€åŠŸèƒ½è½¬è¯‘ä»£ç -babel">ä¸ºæ–°çš„è¯­è¨€åŠŸèƒ½è½¬è¯‘ä»£ç  ï¼ˆbabelï¼‰</h3>
<p>è½¬è¯‘ä»£ç æ„å‘³ç€å°†ä¸€ç§è¯­è¨€çš„ä»£ç è½¬æ¢ä¸ºå¦ä¸€ç§ç±»ä¼¼è¯­è¨€çš„ä»£ç ã€‚è¿™æ˜¯å‰ç«¯å¼€å‘çš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†â€”â€”ç”±äºæµè§ˆå™¨æ·»åŠ æ–°åŠŸèƒ½çš„é€Ÿåº¦å¾ˆæ…¢ï¼Œå› æ­¤ä½¿ç”¨å®éªŒæ€§åŠŸèƒ½åˆ›å»ºäº†æ–°è¯­è¨€ï¼Œè¿™äº›åŠŸèƒ½å¯ä»¥è½¬æ¢ä¸ºæµè§ˆå™¨å…¼å®¹è¯­è¨€ã€‚</p>
<p>å¯¹äºCSSï¼Œæœ‰ <a href="http://sass-lang.com/">Sass</a>ï¼Œ<a href="http://lesscss.org/">Less </a>å’Œ <a href="http://stylus-lang.com/">Stylus</a>ï¼Œä»…ä¸¾å‡ ä¾‹ã€‚å¯¹äº JavaScriptï¼Œä¸€æ®µæ—¶é—´å†…æœ€æµè¡Œçš„è½¬è¯‘å™¨æ˜¯ <a href="http://coffeescript.org/">CoffeeScript</a>ï¼ˆ2010å¹´å·¦å³å‘å¸ƒï¼‰ï¼Œè€Œç°åœ¨å¤§å¤šæ•°äººä½¿ç”¨ <a href="https://babeljs.io/">babel  </a>æˆ– <a href="http://www.typescriptlang.org/">TypeScript</a>ã€‚CoffeeScript æ˜¯ä¸€ç§ä¸“æ³¨äºé€šè¿‡æ˜¾è‘—æ”¹å˜è¯­è¨€æ¥æ”¹è¿› JavaScript çš„è¯­è¨€â€”â€”å¯é€‰çš„æ‹¬å·ã€é‡è¦çš„ç©ºæ ¼ç­‰ã€‚Babel ä¸æ˜¯ä¸€é—¨æ–°è¯­è¨€ï¼Œè€Œæ˜¯ä¸€ç§è½¬è¯‘å™¨ï¼Œå®ƒå°†å°šæœªé€‚ç”¨äºæ‰€æœ‰æµè§ˆå™¨ï¼ˆ<a href="https://babeljs.io/learn-es2015/">ES2015</a> åŠæ›´é«˜ç‰ˆæœ¬ï¼‰çš„ä¸‹ä¸€ä»£ JavaScript è½¬è¯‘ä¸ºæ›´å…¼å®¹çš„æ—§ JavaScript ï¼ˆES5ï¼‰ã€‚Typescript æ˜¯ä¸€ç§ä¸ä¸‹ä¸€ä»£  JavaScript åŸºæœ¬ç›¸åŒçš„è¯­è¨€ï¼Œä½†ä¹Ÿæ·»åŠ äº†å¯é€‰çš„é™æ€ç±»å‹ã€‚è®¸å¤šäººé€‰æ‹©ä½¿ç”¨ babelï¼Œå› ä¸ºå®ƒæœ€æ¥è¿‘åŸç‰ˆ JavaScriptã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªå¦‚ä½•åœ¨æˆ‘ä»¬ç°æœ‰çš„ webpack æ„å»ºæ­¥éª¤ä¸­ä½¿ç”¨ babel çš„ç¤ºä¾‹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä»å‘½ä»¤è¡Œå°† babelï¼ˆè¿™æ˜¯ä¸€ä¸ª npm åŒ…ï¼‰å®‰è£…åˆ°é¡¹ç›®ä¸­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ npm install @babel/core @babel/preset-env babel-loader --save-dev
</span></span></code></pre></div><p>è¯·æ³¨æ„ï¼Œæˆ‘ä»¬æ­£åœ¨å®‰è£… 3 ä¸ªå•ç‹¬çš„åŒ…ä½œä¸ºå¼€å‘ä¾èµ–é¡¹ â€” <code>@babel/core</code> æ˜¯ babel çš„ä¸»è¦éƒ¨åˆ†ï¼Œ <code>@babel/preset-env</code> æ˜¯å®šä¹‰è¦è½¬è¯‘çš„æ–° JavaScript åŠŸèƒ½çš„é¢„è®¾ï¼Œ <code>babel-loader</code> æ˜¯ä½¿ babel èƒ½å¤Ÿä½¿ç”¨ webpack çš„åŒ…ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–è¾‘ <code>webpack.config.js</code> æ–‡ä»¶å°† webpack é…ç½®ä¸ºä½¿ç”¨ <code>babel-loader</code> ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// webpack.config.js  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="nx">mode</span><span class="o">:</span> <span class="s1">&#39;development&#39;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nx">entry</span><span class="o">:</span> <span class="s1">&#39;./index.js&#39;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">filename</span><span class="o">:</span> <span class="s1">&#39;main.js&#39;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">publicPath</span><span class="o">:</span> <span class="s1">&#39;dist&#39;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">},</span>  
</span></span><span class="line"><span class="cl">  <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>  
</span></span><span class="line"><span class="cl">      <span class="p">{</span>  
</span></span><span class="line"><span class="cl">        <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.js$/</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="nx">exclude</span><span class="o">:</span> <span class="sr">/node_modules/</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="nx">use</span><span class="o">:</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">          <span class="nx">loader</span><span class="o">:</span> <span class="s1">&#39;babel-loader&#39;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">          <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">            <span class="nx">presets</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;@babel/preset-env&#39;</span><span class="p">]</span>  
</span></span><span class="line"><span class="cl">          <span class="p">}</span>  
</span></span><span class="line"><span class="cl">        <span class="p">}</span>  
</span></span><span class="line"><span class="cl">      <span class="p">}</span>  
</span></span><span class="line"><span class="cl">    <span class="p">]</span>  
</span></span><span class="line"><span class="cl">  <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>è¿™ç§è¯­æ³•å¯èƒ½ä¼šä»¤äººå›°æƒ‘ï¼ˆå¹¸è¿çš„æ˜¯ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬ç»å¸¸ç¼–è¾‘çš„ä¸œè¥¿ï¼‰ã€‚åŸºæœ¬ä¸Šï¼Œæˆ‘ä»¬å‘Šè¯‰ webpack æŸ¥æ‰¾ä»»ä½• .js æ–‡ä»¶ï¼ˆä¸åŒ…æ‹¬ <code>node_modules</code> æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ï¼‰ï¼Œå¹¶ä½¿ç”¨ <code>babel-loader</code> å’Œ <code>@babel/preset-env</code> é¢„è®¾åº”ç”¨ babel è½¬è¯‘ã€‚æ‚¨å¯ä»¥åœ¨<a href="http://webpack.github.io/docs/configuration.html">æ­¤å¤„</a>é˜…è¯»æœ‰å…³ webpack é…ç½®è¯­æ³•çš„æ›´å¤šä¿¡æ¯ã€‚</p>
<p>ç°åœ¨ä¸€åˆ‡éƒ½è®¾ç½®å¥½äº†ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹ç”¨æˆ‘ä»¬çš„ JavaScript ç¼–å†™ ES2015 åŠŸèƒ½äº†ï¼ä¸‹é¢æ˜¯ <code>index.js</code> æ–‡ä»¶ä¸­çš„ <a href="https://babeljs.io/learn-es2015/#ecmascript-2015-features-template-strings">ES2015 æ¨¡æ¿å­—ç¬¦ä¸²</a>ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// index.js  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">moment</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;moment&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Hello from JavaScript!&#34;</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">moment</span><span class="p">().</span><span class="nx">startOf</span><span class="p">(</span><span class="s1">&#39;day&#39;</span><span class="p">).</span><span class="nx">fromNow</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="s2">&#34;Bob&#34;</span><span class="p">,</span> <span class="nx">time</span> <span class="o">=</span> <span class="s2">&#34;today&#34;</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Hello </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">, how are you </span><span class="si">${</span><span class="nx">time</span><span class="si">}</span><span class="sb">?`</span><span class="p">);</span>
</span></span></code></pre></div><p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ <a href="https://babeljs.io/learn-es2015/#ecmascript-2015-features-modules">ES2015 import è¯­å¥ </a>ä»£æ›¿ <code>require</code> æ¥åŠ è½½æ¨¡å—ï¼Œè¿™å°±æ˜¯æ‚¨ä»Šå¤©åœ¨å¾ˆå¤šä»£ç åº“ä¸­çœ‹åˆ°çš„å†…å®¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// index.js  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">import</span> <span class="nx">moment</span> <span class="nx">from</span> <span class="s1">&#39;moment&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Hello from JavaScript!&#34;</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">moment</span><span class="p">().</span><span class="nx">startOf</span><span class="p">(</span><span class="s1">&#39;day&#39;</span><span class="p">).</span><span class="nx">fromNow</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="s2">&#34;Bob&#34;</span><span class="p">,</span> <span class="nx">time</span> <span class="o">=</span> <span class="s2">&#34;today&#34;</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Hello </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">, how are you </span><span class="si">${</span><span class="nx">time</span><span class="si">}</span><span class="sb">?`</span><span class="p">);</span>
</span></span></code></pre></div><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ <code>import</code> è¯­æ³•ä¸ <code>require</code> è¯­æ³•æ²¡æœ‰å¤ªå¤§åŒºåˆ«ï¼Œä½† <code>import</code> å¯¹äºæ›´é«˜çº§çš„æƒ…å†µå…·æœ‰é¢å¤–çš„çµæ´»æ€§ã€‚ç”±äºæˆ‘ä»¬æ›´æ”¹äº† <code>index.js</code> ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å‘½ä»¤è¡Œä¸­å†æ¬¡è¿è¡Œ webpackï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ ./node_modules/.bin/webpack
</span></span></code></pre></div><p>ç°åœ¨æ‚¨å¯ä»¥åœ¨æµè§ˆå™¨ä¸­åˆ·æ–° <code>index.html</code> ã€‚åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œå¤§å¤šæ•°ç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒæ‰€æœ‰ ES2015 åŠŸèƒ½ï¼Œå› æ­¤å¾ˆéš¾åˆ¤æ–­ babel æ˜¯å¦å®Œæˆäº†å®ƒçš„å·¥ä½œã€‚æ‚¨å¯ä»¥åœ¨ IE9 ç­‰è¾ƒæ—§çš„æµè§ˆå™¨ä¸­å¯¹å…¶è¿›è¡Œæµ‹è¯•ï¼Œä¹Ÿå¯ä»¥åœ¨ <code>main.js</code> ä¸­æœç´¢ä»¥æŸ¥æ‰¾è½¬è¯‘çš„ä»£ç è¡Œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// main.js  
</span></span></span><span class="line"><span class="cl"><span class="c1">// ...  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Hello &#39;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;, how are you &#39;</span> <span class="o">+</span> <span class="nx">time</span> <span class="o">+</span> <span class="s1">&#39;?&#39;</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl"><span class="c1">// ...
</span></span></span></code></pre></div><p>åœ¨è¿™é‡Œä½ å¯ä»¥çœ‹åˆ° babel å°† ES2015 æ¨¡æ¿å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¸¸è§„çš„ JavaScript å­—ç¬¦ä¸²è¿æ¥ï¼Œä»¥ä¿æŒæµè§ˆå™¨å…¼å®¹æ€§ã€‚è™½ç„¶è¿™ä¸ªç‰¹æ®Šçš„ä¾‹å­å¯èƒ½ä¸å¤ªä»¤äººå…´å¥‹ï¼Œä½†è½¬è¯‘ä»£ç çš„èƒ½åŠ›æ˜¯éå¸¸å¼ºå¤§çš„ã€‚JavaScript ä¸­æœ‰ä¸€äº›ä»¤äººå…´å¥‹çš„è¯­è¨€åŠŸèƒ½ï¼Œå¦‚ <a href="async/await">async/await</a>ï¼Œä½ å¯ä»¥ç«‹å³å¼€å§‹ä½¿ç”¨å®ƒä»¬æ¥ç¼–å†™æ›´å¥½çš„ä»£ç ã€‚è™½ç„¶éŸ³è¯‘æœ‰æ—¶å¯èƒ½çœ‹èµ·æ¥ä¹å‘³å’Œç—›è‹¦ï¼Œä½†å®ƒåœ¨è¿‡å»å‡ å¹´ä¸­å¯¼è‡´äº†è¯­è¨€çš„å·¨å¤§æ”¹è¿›ï¼Œå› ä¸ºäººä»¬ä»Šå¤©æ­£åœ¨æµ‹è¯•æ˜å¤©çš„åŠŸèƒ½ã€‚</p>
<p>æˆ‘ä»¬å‡ ä¹å®Œæˆäº†ï¼Œä½†æˆ‘ä»¬çš„å·¥ä½œæµç¨‹ä¸­ä»æœ‰ä¸€äº›æœªæ‰“ç£¨çš„è¾¹ç¼˜ã€‚å¦‚æœæˆ‘ä»¬æ‹…å¿ƒæ€§èƒ½ï¼Œæˆ‘ä»¬åº”è¯¥<a href="https://en.wikipedia.org/wiki/Minification_%28programming%29">ç¼©å°</a>æ†ç»‘æ–‡ä»¶ï¼Œè¿™åº”è¯¥å¾ˆå®¹æ˜“ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»åˆå¹¶äº†ä¸€ä¸ªæ„å»ºæ­¥éª¤ã€‚æ¯æ¬¡æ›´æ”¹ JavaScript æ—¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦é‡æ–°è¿è¡Œ webpack å‘½ä»¤ï¼Œè¿™ä¼šå¾ˆå¿«å˜æ—§ã€‚å› æ­¤ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¦çœ‹çš„æ˜¯è§£å†³è¿™äº›é—®é¢˜çš„ä¸€äº›ä¾¿æ·å·¥å…·ã€‚</p>
<h3 id="ä½¿ç”¨ä»»åŠ¡è¿è¡Œç¨‹åºnpm-è„šæœ¬">ä½¿ç”¨ä»»åŠ¡è¿è¡Œç¨‹åºï¼ˆnpm è„šæœ¬ï¼‰</h3>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»æŠ•èµ„ä½¿ç”¨æ„å»ºæ­¥éª¤æ¥å¤„ç† JavaScript æ¨¡å—ï¼Œä½¿ç”¨ä»»åŠ¡è¿è¡Œå™¨æ˜¯æœ‰æ„ä¹‰çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªè‡ªåŠ¨æ‰§è¡Œæ„å»ºè¿‡ç¨‹ä¸åŒéƒ¨åˆ†çš„å·¥å…·ã€‚å¯¹äºå‰ç«¯å¼€å‘ï¼Œä»»åŠ¡åŒ…æ‹¬ç¼©å°ä»£ç ã€ä¼˜åŒ–å›¾åƒã€è¿è¡Œæµ‹è¯•ç­‰ã€‚</p>
<p>2013å¹´ï¼ŒGrunt æ˜¯æœ€å—æ¬¢è¿çš„å‰ç«¯ä»»åŠ¡è¿è¡Œè€…ï¼ŒGulp ç´§éšå…¶åã€‚ä¸¤è€…éƒ½ä¾èµ–äºåŒ…è£…å…¶ä»–å‘½ä»¤è¡Œå·¥å…·çš„æ’ä»¶ã€‚å¦‚ä»Šï¼Œæœ€æµè¡Œçš„é€‰æ‹©ä¼¼ä¹æ˜¯ä½¿ç”¨ npm åŒ…ç®¡ç†å™¨æœ¬èº«å†…ç½®çš„è„šæœ¬åŠŸèƒ½ï¼Œå®ƒä¸ä½¿ç”¨æ’ä»¶ï¼Œè€Œæ˜¯ç›´æ¥ä¸å…¶ä»–å‘½ä»¤è¡Œå·¥å…·ä¸€èµ·ä½¿ç”¨ã€‚</p>
<p>è®©æˆ‘ä»¬ç¼–å†™ä¸€äº› npm è„šæœ¬ï¼Œä»¥ä¾¿æ›´è½»æ¾åœ°ä½¿ç”¨ webpackã€‚è¿™æ¶‰åŠç®€å•åœ°æ›´æ”¹ <code>package.json</code> æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;modern-javascript-example&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1.0.0&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;main&#34;</span><span class="p">:</span> <span class="s2">&#34;index.js&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;scripts&#34;</span><span class="p">:</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;test&#34;</span><span class="p">:</span> <span class="s2">&#34;echo \&#34;Error: no test specified\&#34; &amp;&amp; exit 1&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;build&#34;</span><span class="p">:</span> <span class="s2">&#34;webpack --progress --mode=production&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;watch&#34;</span><span class="p">:</span> <span class="s2">&#34;webpack --progress --watch&#34;</span> 
</span></span><span class="line"><span class="cl">  <span class="p">},</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;author&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;license&#34;</span><span class="p">:</span> <span class="s2">&#34;ISC&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;dependencies&#34;</span><span class="p">:</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;moment&#34;</span><span class="p">:</span> <span class="s2">&#34;^2.22.2&#34;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">},</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;devDependencies&#34;</span><span class="p">:</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;@babel/core&#34;</span><span class="p">:</span> <span class="s2">&#34;^7.0.0&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;@babel/preset-env&#34;</span><span class="p">:</span> <span class="s2">&#34;^7.0.0&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;babel-loader&#34;</span><span class="p">:</span> <span class="s2">&#34;^8.0.2&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;webpack&#34;</span><span class="p">:</span> <span class="s2">&#34;^4.17.1&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;webpack-cli&#34;</span><span class="p">:</span> <span class="s2">&#34;^3.1.0&#34;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">}</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸¤ä¸ªæ–°è„šæœ¬ï¼Œ <code>build</code> å’Œ <code>watch</code> ã€‚è¦è¿è¡Œæ„å»ºè„šæœ¬ï¼Œæ‚¨å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ npm run build
</span></span></code></pre></div><p>è¿™å°†è¿è¡Œ webpackï¼ˆä½¿ç”¨æˆ‘ä»¬ä¹‹å‰æ‰€åšçš„ <code>webpack.config.js</code> ä¸­çš„é…ç½®ï¼‰ï¼Œå…¶ä¸­ <code>--progress</code> é€‰é¡¹æ˜¾ç¤ºè¿›åº¦ç™¾åˆ†æ¯”ï¼Œ <code>--mode=production</code> é€‰é¡¹æœ€å°åŒ–ç”Ÿäº§ä»£ç ã€‚è¦è¿è¡Œ <code>watch</code> è„šæœ¬ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ npm run watch
</span></span></code></pre></div><p>å®ƒä½¿ç”¨ <code>--watch</code> é€‰é¡¹ä»£æ›¿ï¼Œä»¥ä¾¿åœ¨æ¯æ¬¡ä»»ä½• JavaScript æ–‡ä»¶æ›´æ”¹æ—¶è‡ªåŠ¨é‡æ–°è¿è¡Œ webpackï¼Œè¿™å¯¹äºå¼€å‘éå¸¸æœ‰ç”¨ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œ <code>package.json</code> ä¸­çš„è„šæœ¬å¯ä»¥åœ¨ä¸å¿…æŒ‡å®šå®Œæ•´è·¯å¾„ <code>./node_modules/.bin/webpack</code> çš„æƒ…å†µä¸‹è¿è¡Œ webpackï¼Œå› ä¸º node.js çŸ¥é“æ¯ä¸ª npm æ¨¡å—è·¯å¾„çš„ä½ç½®ã€‚è¿™å¾ˆç”œï¼æˆ‘ä»¬å¯ä»¥é€šè¿‡å®‰è£… webpack-dev-server æ¥è®©äº‹æƒ…å˜å¾—æ›´åŠ ç”œèœœï¼Œè¿™æ˜¯ä¸€ä¸ªå•ç‹¬çš„å·¥å…·ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªç®€å•çš„ Web æœåŠ¡å™¨å’Œå®æ—¶é‡æ–°åŠ è½½ã€‚è¦å°†å…¶å®‰è£…ä¸ºå¼€å‘ä¾èµ–é¡¹ï¼Œè¯·è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ npm install webpack-dev-server --save-dev
</span></span></code></pre></div><p>ç„¶åå°†ä¸€ä¸ª npm è„šæœ¬æ·»åŠ åˆ° <code>package.json</code> ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;modern-javascript-example&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1.0.0&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;main&#34;</span><span class="p">:</span> <span class="s2">&#34;index.js&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;scripts&#34;</span><span class="p">:</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;test&#34;</span><span class="p">:</span> <span class="s2">&#34;echo \&#34;Error: no test specified\&#34; &amp;&amp; exit 1&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;build&#34;</span><span class="p">:</span> <span class="s2">&#34;webpack --progress -p&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;watch&#34;</span><span class="p">:</span> <span class="s2">&#34;webpack --progress --watch&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;serve&#34;</span><span class="p">:</span> <span class="s2">&#34;webpack-dev-server --open&#34;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">},</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;author&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;license&#34;</span><span class="p">:</span> <span class="s2">&#34;ISC&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;dependencies&#34;</span><span class="p">:</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;moment&#34;</span><span class="p">:</span> <span class="s2">&#34;^2.19.1&#34;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">},</span>  
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;devDependencies&#34;</span><span class="p">:</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;@babel/core&#34;</span><span class="p">:</span> <span class="s2">&#34;^7.0.0&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;@babel/preset-env&#34;</span><span class="p">:</span> <span class="s2">&#34;^7.0.0&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;babel-loader&#34;</span><span class="p">:</span> <span class="s2">&#34;^8.0.2&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;webpack&#34;</span><span class="p">:</span> <span class="s2">&#34;^3.7.1&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;webpack-dev-server&#34;</span><span class="p">:</span> <span class="s2">&#34;^3.1.6&#34;</span>  
</span></span><span class="line"><span class="cl">  <span class="p">}</span>  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>ç°åœ¨ï¼Œæ‚¨å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ npm run serve
</span></span></code></pre></div><p>è¿™å°†åœ¨æ‚¨çš„æµè§ˆå™¨ä¸­è‡ªåŠ¨æ‰“å¼€åœ°å€ä¸º <code>localhost:8080</code> çš„ <code>index.html</code> ç½‘ç«™ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼‰ã€‚æ¯å½“ä½ åœ¨ <code>index.js</code> ä¸­æ›´æ”¹ JavaScript æ—¶ï¼Œwebpack-dev-server éƒ½ä¼šé‡å»ºå®ƒè‡ªå·±çš„æ†ç»‘ JavaScript å¹¶è‡ªåŠ¨åˆ·æ–°æµè§ˆå™¨ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æ—¶é—´èŠ‚çœï¼Œå› ä¸ºå®ƒå…è®¸æ‚¨å°†æ³¨æ„åŠ›é›†ä¸­åœ¨ä»£ç ä¸Šï¼Œè€Œä¸å¿…åœ¨ä»£ç å’Œæµè§ˆå™¨ä¹‹é—´ä¸æ–­åˆ‡æ¢ä¸Šä¸‹æ–‡ä»¥æŸ¥çœ‹æ–°çš„æ›´æ”¹ã€‚</p>
<p>è¿™åªæ˜¯è¡¨é¢ï¼Œwebpack å’Œ webpack-dev-server è¿˜æœ‰æ›´å¤šé€‰é¡¹ï¼ˆä½ å¯ä»¥åœ¨<a href="https://webpack.js.org/guides/development/">è¿™é‡Œ</a>é˜…è¯»ï¼‰ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥åˆ¶ä½œ npm è„šæœ¬æ¥è¿è¡Œå…¶ä»–ä»»åŠ¡ï¼Œä¾‹å¦‚å°† Sass è½¬æ¢ä¸º CSSã€å‹ç¼©å›¾åƒã€è¿è¡Œæµ‹è¯• â€” ä»»ä½•å…·æœ‰å‘½ä»¤è¡Œå·¥å…·çš„ä¸œè¥¿éƒ½æ˜¯å…¬å¹³çš„æ¸¸æˆã€‚npm è„šæœ¬æœ¬èº«ä¹Ÿæœ‰ä¸€äº›å¾ˆæ£’çš„é«˜çº§é€‰é¡¹å’ŒæŠ€å·§â€”â€”<a href="https://twitter.com/k88hudson">Kate Hudson</a> çš„è¿™ä¸ªæ¼”è®²æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„èµ·ç‚¹ï¼š</p>
<p><a href="https://youtu.be/0RYETb9YVrk">https://youtu.be/0RYETb9YVrk</a></p>
<h3 id="ç»“è®º">ç»“è®º</h3>
<p>ç®€è€Œè¨€ä¹‹ï¼Œè¿™å°±æ˜¯ç°ä»£JavaScriptã€‚æˆ‘ä»¬ä»çº¯HTMLå’ŒJSè½¬å‘ä½¿ç”¨åŒ…ç®¡ç†å™¨è‡ªåŠ¨ä¸‹è½½ç¬¬ä¸‰æ–¹åŒ…ï¼Œä½¿ç”¨æ¨¡å—æ†ç»‘å™¨åˆ›å»ºå•ä¸ªè„šæœ¬æ–‡ä»¶ï¼Œä½¿ç”¨è½¬è¯‘å™¨ä½¿ç”¨æœªæ¥çš„JavaScriptåŠŸèƒ½ï¼Œä»¥åŠä»»åŠ¡è¿è¡Œå™¨æ¥è‡ªåŠ¨åŒ–æ„å»ºè¿‡ç¨‹çš„ä¸åŒéƒ¨åˆ†ã€‚è¿™é‡Œè‚¯å®šæœ‰å¾ˆå¤šç§»åŠ¨çš„éƒ¨åˆ†ï¼Œç‰¹åˆ«æ˜¯å¯¹äºåˆå­¦è€…ã€‚å¯¹äºåˆšæ¥è§¦ç¼–ç¨‹çš„äººæ¥è¯´ï¼ŒWeb å¼€å‘æ›¾ç»æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åˆ‡å…¥ç‚¹ï¼Œæ­£æ˜¯å› ä¸ºå®ƒå¾ˆå®¹æ˜“å¯åŠ¨å’Œè¿è¡Œ;å¦‚ä»Šï¼Œè¿™å¯èƒ½éå¸¸ä»¤äººç”Ÿç•ï¼Œç‰¹åˆ«æ˜¯å› ä¸ºå„ç§å·¥å…·å¾€å¾€ä¼šè¿…é€Ÿå˜åŒ–ã€‚</p>
<p>ä¸è¿‡ï¼Œå®ƒå¹¶ä¸åƒçœ‹èµ·æ¥é‚£ä¹ˆç³Ÿç³•ã€‚äº‹æƒ…æ­£åœ¨å®‰å®šä¸‹æ¥ï¼Œç‰¹åˆ«æ˜¯éšç€èŠ‚ç‚¹ç”Ÿæ€ç³»ç»Ÿä½œä¸ºä¸å‰ç«¯åˆä½œçš„å¯è¡Œæ–¹å¼çš„é‡‡ç”¨ã€‚ä½¿ç”¨ npm ä½œä¸ºåŒ…ç®¡ç†å™¨ï¼Œå°†èŠ‚ç‚¹ <code>require</code> æˆ– <code>import</code> è¯­å¥ç”¨äºæ¨¡å—ï¼Œä½¿ç”¨ npm è„šæœ¬æ¥è¿è¡Œä»»åŠ¡ï¼Œè¿™å¾ˆå¥½ä¸”ä¸€è‡´ã€‚ä¸ä¸€ä¸¤å¹´å‰ç›¸æ¯”ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤§å¤§ç®€åŒ–çš„å·¥ä½œæµç¨‹ï¼</p>
<p>å¯¹äºåˆå­¦è€…å’Œæœ‰ç»éªŒçš„å¼€å‘äººå‘˜æ¥è¯´ï¼Œæ›´å¥½çš„æ˜¯ï¼Œå¦‚ä»Šçš„æ¡†æ¶é€šå¸¸å¸¦æœ‰ä½¿è¯¥è¿‡ç¨‹æ›´å®¹æ˜“ä¸Šæ‰‹çš„å·¥å…·ã€‚Ember æœ‰ <a href="https://ember-cli.com/">ember-cli</a> ï¼Œè¿™å¯¹ Angular çš„ <a href="https://cli.angular.io/">angular-cli</a> ã€React çš„ <a href="https://github.com/facebookincubator/create-react-app"><code>create-react-app</code></a>ã€Vue çš„ <a href="https://github.com/vuejs/vue-cli">vue-cli</a> ç­‰äº§ç”Ÿäº†å·¨å¤§çš„å½±å“ã€‚æ‰€æœ‰è¿™äº›å·¥å…·éƒ½å°†è®¾ç½®ä¸€ä¸ªåŒ…å«æ‚¨éœ€è¦çš„æ‰€æœ‰é¡¹ç›®â€”â€”æ‚¨éœ€è¦åšçš„å°±æ˜¯å¼€å§‹ç¼–å†™ä»£ç ã€‚ç„¶è€Œï¼Œè¿™äº›å·¥å…·å¹¶ä¸ç¥å¥‡ï¼Œå®ƒä»¬åªæ˜¯ä»¥ä¸€ç§ä¸€è‡´å’Œå·¥ä½œçš„æ–¹å¼è®¾ç½®äº†æ‰€æœ‰å†…å®¹â€”â€”ä½ å¯èƒ½ç»å¸¸éœ€è¦å¯¹ webpackã€babel ç­‰è¿›è¡Œä¸€äº›é¢å¤–çš„é…ç½®ã€‚å› æ­¤ï¼Œäº†è§£æˆ‘ä»¬åœ¨æœ¬æ–‡ä¸­ä»‹ç»çš„æ¯ä¸ªéƒ¨åˆ†çš„ä½œç”¨ä»ç„¶éå¸¸å…³é”®ã€‚</p>
<p>ç°ä»£ JavaScript åœ¨ä½¿ç”¨æ—¶è‚¯å®šä¼šä»¤äººæ²®ä¸§ï¼Œå› ä¸ºå®ƒç»§ç»­å¿«é€Ÿå˜åŒ–å’Œå‘å±•ã€‚ä½†æ˜¯ï¼Œå°½ç®¡æœ‰æ—¶çœ‹èµ·æ¥åƒæ˜¯é‡æ–°å‘æ˜è½®å­ï¼Œä½†JavaScriptçš„å¿«é€Ÿå‘å±•æœ‰åŠ©äºæ¨åŠ¨è¯¸å¦‚çƒ­é‡è½½ï¼Œå®æ—¶lintingå’Œæ—¶é—´æ—…è¡Œè°ƒè¯•ç­‰åˆ›æ–°ã€‚ä½œä¸ºä¸€åå¼€å‘äººå‘˜ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¿€åŠ¨äººå¿ƒçš„æ—¶åˆ»ï¼Œæˆ‘å¸Œæœ›è¿™äº›ä¿¡æ¯å¯ä»¥ä½œä¸ºè·¯çº¿å›¾ï¼Œåœ¨æ‚¨çš„æ—…ç¨‹ä¸­ä¸ºæ‚¨æä¾›å¸®åŠ©ï¼</p>
<p><img loading="lazy" src="https://peterxjang.com/img/1__H6NN__RxZNeVyLYpCirsslg.png" alt="Dinosaur comic panel 5"  />
</p>
<p>ç‰¹åˆ«æ„Ÿè°¢<a href="https://twitter.com/ryanqnorth">@ryanqnorth</a>çš„<a href="http://www.qwantz.com/">æé¾™æ¼«ç”»</a>ï¼Œè‡ª2003å¹´ä»¥æ¥ï¼ˆæé¾™ç»Ÿæ²»ç½‘ç»œï¼‰ä»¥æ¥ï¼Œå®ƒæä¾›äº†ä¸€äº›æœ€å¥½çš„è’è¯å¹½é»˜ã€‚</p>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://peterxjang.com/blog/modern-javascript-explained-for-dinosaurs.html">https://peterxjang.com/blog/modern-javascript-explained-for-dinosaurs.html</a></p>
<blockquote>
<p>è¯‘è€…å¤‡æ³¨ï¼š</p>
<p>Github ä¸Šæœ‰ä¸€ä¸ªå…³äºè¿™ç¯‡æ–‡ç« æºä»£ç çš„ä»“åº“ï¼š<a href="https://github.com/scherler/Modern-JavaScript-Explained-For-Dinosaurs">https://github.com/scherler/Modern-JavaScript-Explained-For-Dinosaurs</a></p>
</blockquote>
]]></content:encoded>
    </item>
    
    <item>
      <title>ã€ŠEffective Java 3ã€‹ç¬”è®°15ï¼šå°½é‡å‡å°‘ç±»å’Œæˆå‘˜çš„å¯è®¿é—®æ€§</title>
      <link>https://blog.chensoul.com/posts/2023/06/15/minimize-the-accessibility-of-classes-and-members/</link>
      <pubDate>Thu, 15 Jun 2023 09:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/06/15/minimize-the-accessibility-of-classes-and-members/</guid>
      <description>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬å››ç« ã€Šç±»å’Œæ¥å£ã€‹çš„å­¦ä¹ ç¬”è®°ï¼šå°½é‡å‡å°‘ç±»å’Œæˆå‘˜çš„å¯è®¿é—®æ€§ã€‚ ç±»å’Œæ¥å£æ˜¯ Java ç¼–ç¨‹è¯­è¨€çš„æ ¸å¿ƒã€‚å®ƒä»¬æ˜¯æŠ½è±¡çš„åŸºæœ¬å•ä½ã€‚</description>
      <content:encoded><![CDATA[<p>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬å››ç« ã€Šç±»å’Œæ¥å£ã€‹çš„å­¦ä¹ ç¬”è®°ï¼šå°½é‡å‡å°‘ç±»å’Œæˆå‘˜çš„å¯è®¿é—®æ€§ã€‚</p>
<p>ç±»å’Œæ¥å£æ˜¯ Java ç¼–ç¨‹è¯­è¨€çš„æ ¸å¿ƒã€‚å®ƒä»¬æ˜¯æŠ½è±¡çš„åŸºæœ¬å•ä½ã€‚è¯¥è¯­è¨€æä¾›äº†è®¸å¤šå¼ºå¤§çš„å…ƒç´ ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥è®¾è®¡ç±»å’Œæ¥å£ã€‚</p>
<h2 id="ä»‹ç»">ä»‹ç»</h2>
<p>ã€ŠEffective Java, Third Editionã€‹è¿™æœ¬ä¹¦ä¸­çš„ç¬¬å››ç« ä¸»è¦è®²è¿°äº†å¦‚ä½•å°½é‡å‡å°‘ç±»å’Œæˆå‘˜çš„å¯è®¿é—®æ€§ï¼Œä»¥æé«˜ä»£ç çš„å°è£…æ€§ã€å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
<p>å°½é‡å‡å°‘ç±»å’Œæˆå‘˜çš„å¯è®¿é—®æ€§æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„ä¸€ä¸ªåŸºæœ¬åŸåˆ™ï¼Œä¹Ÿè¢«ç§°ä¸º &ldquo;æœ€å°åŒ–å¯è®¿é—®æ€§åŸåˆ™&rdquo;ã€‚è¿™ä¸ªåŸåˆ™çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œå°†ç±»å’Œæˆå‘˜çš„è®¿é—®çº§åˆ«é™åˆ¶åœ¨æœ€å°èŒƒå›´å†…ï¼Œä»è€Œæé«˜ä»£ç çš„å®‰å…¨æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯å¤ç”¨æ€§ã€‚</p>
<p>åœ¨ Java ä¸­ï¼Œç±»å’Œæˆå‘˜çš„è®¿é—®çº§åˆ«æœ‰å››ç§ï¼špublicã€protectedã€default å’Œ privateã€‚å…¶ä¸­ï¼Œpublic çº§åˆ«æ˜¯æœ€é«˜çš„ï¼Œå¯ä»¥è¢«ä»»ä½•ç±»è®¿é—®ï¼›private çº§åˆ«æ˜¯æœ€ä½çš„ï¼Œåªèƒ½è¢«åŒä¸€ä¸ªç±»å†…éƒ¨çš„æˆå‘˜è®¿é—®ã€‚åœ¨åº”ç”¨æœ€å°åŒ–å¯è®¿é—®æ€§åŸåˆ™æ—¶ï¼Œåº”è¯¥å°½å¯èƒ½åœ°å°†ç±»å’Œæˆå‘˜çš„è®¿é—®çº§åˆ«è®¾ç½®ä¸ºæœ€ä½çš„çº§åˆ«ï¼Œå³ private æˆ– default çº§åˆ«ã€‚</p>
<p>å°½é‡å‡å°‘ç±»å’Œæˆå‘˜çš„å¯è®¿é—®æ€§æ˜¯ä¸€ç§è‰¯å¥½çš„ç¼–ç¨‹å®è·µï¼Œå¯ä»¥æé«˜ä»£ç çš„å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å»ºè®®ï¼š</p>
<ol>
<li>
<p>å°†ç±»å’Œæˆå‘˜çš„å¯è§æ€§è®¾ç½®ä¸ºæœ€å°åŒ–çš„çº§åˆ«ï¼Œå³åªæœ‰å¿…è¦çš„ä»£ç å¯ä»¥è®¿é—®å®ƒä»¬ã€‚è¿™å°†å‡å°‘ä¸å¿…è¦çš„ä¾èµ–å…³ç³»ï¼Œå¹¶ä½¿ä»£ç æ›´åŠ æ¨¡å—åŒ–å’Œå¯é‡ç”¨ã€‚</p>
</li>
<li>
<p>ä½¿ç”¨è®¿é—®ä¿®é¥°ç¬¦ä»¥é™åˆ¶ç±»å’Œæˆå‘˜çš„å¯è§æ€§ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªæˆå‘˜åªèƒ½åœ¨ç±»å†…éƒ¨ä½¿ç”¨ï¼Œå¯ä»¥è€ƒè™‘å°†å…¶è½¬æ¢ä¸ºç§æœ‰é™æ€åµŒå¥—ç±»ã€‚å¦‚æœä¸€ä¸ªæˆå‘˜éœ€è¦åœ¨ç±»çš„å­ç±»ä¸­ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ protected ä¿®é¥°ç¬¦ã€‚</p>
<blockquote>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•å°†åŒ…çº§ç§æœ‰é¡¶çº§ç±»è½¬æ¢ä¸ºç§æœ‰é™æ€åµŒå¥—ç±»ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// åŒ…çº§ç§æœ‰é¡¶çº§ç±»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">class</span> <span class="nc">MyTopLevelClass</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyClass</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">MyPrivateNestedClass</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ä½¿ç”¨ MyTopLevelClass çš„ä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ä½¿ç”¨ MyPrivateNestedClass çš„ä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒMyTopLevelClass è¢«è½¬æ¢ä¸ºäº† MyPrivateNestedClassï¼Œå®ƒè¢«å£°æ˜ä¸º MyClass çš„ç§æœ‰é™æ€åµŒå¥—ç±»ã€‚è¿™æ ·ï¼ŒMyTopLevelClass å°±åªèƒ½è¢« MyPrivateNestedClass ä½¿ç”¨ï¼Œè€Œ MyPrivateNestedClass åªèƒ½è¢« MyClass ä½¿ç”¨ï¼Œè¾¾åˆ°äº†å®‰å…¨å’Œæ¸…æ™°çš„ç›®æ ‡ã€‚</p>
</blockquote>
</li>
<li>
<p>é¿å…ä½¿ç”¨å…¬å…±æˆå‘˜æˆ–å…¬å…±æ–¹æ³•ã€‚å…¬å…±æˆå‘˜å’Œæ–¹æ³•å¯ä»¥è¢«ä»»ä½•ä»£ç è®¿é—®ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´å®‰å…¨é—®é¢˜å’Œä¸å¿…è¦çš„ä»£ç è€¦åˆã€‚ç›¸åï¼Œåº”è¯¥ä½¿ç”¨å°è£…çš„æ–¹å¼æ¥éšè—ç±»çš„å®ç°ç»†èŠ‚ï¼Œå¹¶åœ¨éœ€è¦æ—¶æä¾›å…¬å…±æ¥å£ã€‚</p>
</li>
<li>
<p>åœ¨éœ€è¦ä½¿ç”¨å…¬å…±æ¥å£æ—¶ï¼Œä½¿ç”¨æ¥å£æˆ–æŠ½è±¡ç±»æ¥å®šä¹‰å…¬å…±å¥‘çº¦ã€‚è¿™æ ·å¯ä»¥ä½¿ä»£ç æ›´åŠ çµæ´»ï¼Œå¹¶ä½¿å®ç°ç»†èŠ‚èƒ½å¤Ÿç‹¬ç«‹äºå…¬å…±å¥‘çº¦è¿›è¡Œä¿®æ”¹ã€‚</p>
</li>
<li>
<p>ä½¿ç”¨ final å…³é”®å­—æ¥é™åˆ¶ç±»å’Œæˆå‘˜çš„å¯å˜æ€§ã€‚è¿™å¯ä»¥æé«˜ä»£ç çš„å®‰å…¨æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œå¹¶é¿å…åœ¨ä¸å¿…è¦çš„æƒ…å†µä¸‹ä¿®æ”¹ä»£ç ã€‚</p>
</li>
</ol>
<h2 id="æ‰©å±•">æ‰©å±•</h2>
<p>è®¾è®¡å…¬å…±æ¥å£éœ€è¦è€ƒè™‘æ¥å£çš„ç®€æ´æ€§ã€æ˜“ç”¨æ€§å’Œä¸€è‡´æ€§ï¼ŒåŒæ—¶é¿å…æš´éœ²è¿‡å¤šçš„åº•å±‚å®ç°ç»†èŠ‚ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•è®¾è®¡ä¸€ä¸ªå…¬å…±æ¥å£ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * This interface provides a simple way to perform arithmetic operations.
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @author chensoul
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @since 1.0.0
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Arithmetic</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * Adds two integers and returns the result.
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param a the first integer
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param b the second integer
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return the sum of a and b
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="nf">add</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * Subtracts two integers and returns the result.
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param a the first integer
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param b the second integer
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return the difference of a and b
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="nf">subtract</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * Multiplies two integers and returns the result.
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param a the first integer
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param b the second integer
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return the product of a and b
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="nf">multiply</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * Divides two integers and returns the result.
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param a the numerator
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param b the denominator
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return the quotient of a and b
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @throws ArithmeticException if b is zero
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="nf">divide</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ArithmeticException</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ªåä¸º Arithmetic çš„æ¥å£ï¼Œå®ƒæä¾›äº†å››ä¸ªåŸºæœ¬çš„ç®—æœ¯æ“ä½œï¼šåŠ æ³•ã€å‡æ³•ã€ä¹˜æ³•å’Œé™¤æ³•ã€‚æ¯ä¸ªæ–¹æ³•éƒ½æœ‰æ¸…æ™°çš„æ–‡æ¡£æ³¨é‡Šï¼Œæè¿°äº†æ–¹æ³•çš„ç”¨é€”ã€å‚æ•°å’Œè¿”å›å€¼ã€‚æ­¤å¤–ï¼Œé™¤æ³•æ–¹æ³•è¿˜å£°æ˜äº†ä¸€ä¸ªå¼‚å¸¸ï¼Œä»¥é˜²æ­¢é™¤ä»¥é›¶çš„æƒ…å†µã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›å…³äºå¦‚ä½•è®¾è®¡å…¬å…± API çš„æœ€ä½³å®è·µï¼š</p>
<ol>
<li>æœ€å°åŒ–å…¬å…± APIï¼šå°½å¯èƒ½åœ°å‡å°‘å…¬å…± API çš„è§„æ¨¡å’Œå¤æ‚åº¦ï¼Œåªæš´éœ²å¿…è¦çš„æ¥å£å’Œè¡Œä¸ºã€‚è¿™æ ·å¯ä»¥ä¿æŒ API çš„ç®€å•æ€§å’Œç¨³å®šæ€§ï¼Œé¿å…æ„å¤–çš„ä¾èµ–å’Œè€¦åˆã€‚</li>
<li>ä¿æŠ¤ä¸å¯å˜æ€§ï¼šå¯¹äºå…¬å…±é™æ€ final å­—æ®µå¼•ç”¨çš„å¯¹è±¡ï¼Œåº”è¯¥ç¡®ä¿å®ƒä»¬æ˜¯ä¸å¯å˜çš„ï¼Œä»¥é¿å…æ„å¤–ä¿®æ”¹å…¬å…±çŠ¶æ€ã€‚</li>
<li>ä½¿ç”¨æ¥å£å’ŒæŠ½è±¡ç±»ï¼šä½¿ç”¨æ¥å£å’ŒæŠ½è±¡ç±»æ¥å®šä¹‰å…¬å…± APIï¼Œä»è€Œä½¿å¾—å®ç°ç±»å¯ä»¥çµæ´»åœ°é€‰æ‹©è‡ªå·±çš„å®ç°æ–¹å¼ã€‚åŒæ—¶ï¼Œæ¥å£å’ŒæŠ½è±¡ç±»å¯ä»¥éšè—å®ç°ç»†èŠ‚ï¼Œä¿æŒ API çš„ç®€å•æ€§å’Œç¨³å®šæ€§ã€‚</li>
<li>ä½¿ç”¨æšä¸¾ç±»å‹ï¼šæšä¸¾ç±»å‹å¯ä»¥åœ¨å®šä¹‰ä¸€ç»„å¸¸é‡æ—¶æä¾›ç±»å‹å®‰å…¨æ€§ï¼Œå¹¶ä¸”å¯ä»¥é¿å…æ„å¤–çš„å®ä¾‹åŒ–å’Œä¿®æ”¹ã€‚</li>
<li>æ–‡æ¡£åŒ– APIï¼šæä¾›è¯¦ç»†çš„æ–‡æ¡£å’Œç¤ºä¾‹ä»£ç ï¼Œä»¥ä¾¿å¼€å‘äººå‘˜èƒ½å¤Ÿæ­£ç¡®åœ°ä½¿ç”¨å…¬å…± APIã€‚</li>
</ol>
<p>å½“è®¾è®¡ä¸€ä¸ªå…¬å…± API æ—¶ï¼Œæ–‡æ¡£åŒ–æ˜¯éå¸¸é‡è¦çš„ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å…³äºå¦‚ä½•æ–‡æ¡£åŒ– API çš„æœ€ä½³å®è·µï¼š</p>
<ol>
<li>æä¾› API æ–‡æ¡£ï¼šä¸º API æä¾›è¯¦ç»†çš„æ–‡æ¡£ï¼ŒåŒ…æ‹¬ API çš„ä½¿ç”¨æ–¹æ³•ã€æ¥å£ã€å‚æ•°ã€è¿”å›å€¼ã€å¼‚å¸¸å’Œç¤ºä¾‹ä»£ç ç­‰ã€‚API æ–‡æ¡£åº”è¯¥æ¸…æ™°ã€ç®€å•ã€æ˜“äºç†è§£ï¼Œå¹¶ä¸”åº”è¯¥æä¾›è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡å’Œè§£é‡Šã€‚</li>
<li>ä¸º API æä¾›ç¤ºä¾‹ä»£ç ï¼šä¸º API æä¾›è¯¦ç»†çš„ç¤ºä¾‹ä»£ç ï¼Œä»¥ä¾¿å¼€å‘äººå‘˜èƒ½å¤Ÿå¿«é€Ÿåœ°ç†è§£å’Œä½¿ç”¨ APIã€‚ç¤ºä¾‹ä»£ç åº”è¯¥æ¸…æ™°ã€ç®€å•ã€æ˜“äºç†è§£ï¼Œå¹¶ä¸”åº”è¯¥æä¾›è¶³å¤Ÿçš„æ³¨é‡Šå’Œè§£é‡Šã€‚</li>
<li>ä½¿ç”¨æ ‡å‡†æ³¨é‡Šï¼šä½¿ç”¨æ ‡å‡†æ³¨é‡Šæ ¼å¼ï¼Œä¾‹å¦‚ Javadoc æˆ–è€… Doxygenï¼Œä»¥ä¾¿ç”Ÿæˆ API æ–‡æ¡£ã€‚æ ‡å‡†æ³¨é‡Šæ ¼å¼å¯ä»¥æé«˜æ–‡æ¡£çš„ä¸€è‡´æ€§å’Œå¯è¯»æ€§ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨è‡ªåŠ¨åŒ–å·¥å…·æ¥ç”Ÿæˆ API æ–‡æ¡£ã€‚</li>
<li>ä¸º API æä¾›ç‰ˆæœ¬å·ï¼šä¸º API æä¾›ç‰ˆæœ¬å·ï¼Œä»¥ä¾¿å¼€å‘äººå‘˜å¯ä»¥è·Ÿè¸ª API çš„æ¼”å˜å’Œå˜åŒ–ã€‚ç‰ˆæœ¬å·åº”è¯¥æ¸…æ™°ã€ç®€å•ã€æ˜“äºç†è§£ï¼Œå¹¶ä¸”åº”è¯¥éµå¾ªä¸€å®šçš„å‘½åè§„åˆ™ã€‚</li>
<li>æä¾› API æ›´æ–°æ—¥å¿—ï¼šä¸º API æä¾›æ›´æ–°æ—¥å¿—ï¼Œä»¥ä¾¿å¼€å‘äººå‘˜å¯ä»¥äº†è§£ API çš„å˜åŒ–å’Œæ¼”å˜ã€‚æ›´æ–°æ—¥å¿—åº”è¯¥æ¸…æ™°ã€ç®€å•ã€æ˜“äºç†è§£ï¼Œå¹¶ä¸”åº”è¯¥æä¾›è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡å’Œè§£é‡Šã€‚</li>
<li>é¿å…ä½¿ç”¨è¿‡æ—¶çš„ APIï¼šé¿å…ä½¿ç”¨è¿‡æ—¶çš„ APIï¼Œä»¥é¿å…å‡ºç°ä¸å¿…è¦çš„é—®é¢˜å’Œé”™è¯¯ã€‚å¦‚æœå¿…é¡»ä½¿ç”¨è¿‡æ—¶çš„ APIï¼Œåº”è¯¥æä¾›è­¦å‘Šå’Œæ›¿ä»£æ–¹æ¡ˆï¼Œä»¥ä¾¿å¼€å‘äººå‘˜èƒ½å¤Ÿäº†è§£é£é™©å’Œæ›¿ä»£æ–¹æ¡ˆã€‚</li>
</ol>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ Javadoc æ³¨é‡Šæ ¼å¼ä¸º Java ç±»å’Œæ–¹æ³•æ–‡æ¡£åŒ–çš„ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * The BasicArithmetic class provides a basic implementation of the Arithmetic interface.
</span></span></span><span class="line"><span class="cl"><span class="cm"> * This implementation is not recommended for use in production code, and will be removed in a future release.
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @deprecated This class is for demonstration purposes only.
</span></span></span><span class="line"><span class="cl"><span class="cm"> *             Use {@link AdvancedArithmetic} for more advanced arithmetic operations.
</span></span></span><span class="line"><span class="cl"><span class="cm"> *             For basic arithmetic operations, use the {@link java.lang.Math} class instead.
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @see Arithmetic
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @see AdvancedArithmetic
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @see java.lang.Math
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @since 1.0.0
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Deprecated</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BasicArithmetic</span> <span class="kd">implements</span> <span class="n">Arithmetic</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * {@inheritDoc}
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param a the first integer to be added
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param b the second integer to be added
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return the sum of a and b
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">add</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * {@inheritDoc}
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param a the integer to be subtracted from
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param b the integer to subtract
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return the difference of a and b
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">subtract</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * {@inheritDoc}
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param a the first integer to be multiplied
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param b the second integer to be multiplied
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return the product of a and b
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">multiply</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * {@inheritDoc}
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param a the numerator to be divided
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param b the denominator to divide by
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return the quotient of a and b
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @throws ArithmeticException if b is zero
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">divide</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ArithmeticException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">b</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="n">ArithmeticException</span><span class="o">(</span><span class="s">&#34;Cannot divide by zero.&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><blockquote>
<p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†@authoã€@sinceã€@seeã€@link ã€@deprecated å’Œ @inheritDoc æ ‡è®°ã€‚</p>
<ul>
<li>
<p>@author æ ‡è®°æŒ‡å®šäº†ç±»çš„ä½œè€…ï¼Œå¯ä»¥æ˜¯å•ä¸ªäººæˆ–ç»„ç»‡ã€‚</p>
</li>
<li>
<p>@since æ ‡è®°æŒ‡å®šäº†ç±»æœ€åˆè¢«å¼•å…¥çš„ç‰ˆæœ¬ã€‚</p>
</li>
<li>
<p>@see æ ‡è®°æä¾›äº†ä¸€ä¸ªé“¾æ¥åˆ°å…¶ä»–ç›¸å…³çš„ç±»æˆ–æ¥å£ã€‚</p>
</li>
<li>
<p>@link æ ‡è®°æä¾›äº†ä¸€ä¸ªé“¾æ¥åˆ°å…¶ä»–ç›¸å…³çš„ç±»ã€æ–¹æ³•ã€å­—æ®µæˆ–åŒ…ã€‚</p>
</li>
<li>
<p>@deprecated æ ‡è®°æŒ‡ç¤ºè¯¥ç±»æˆ–æ–¹æ³•å·²è¿‡æ—¶ï¼Œä¸æ¨èä½¿ç”¨ï¼Œå¹¶ä¼šåœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­è¢«åˆ é™¤ã€‚</p>
</li>
<li>
<p>@inheritDoc ç»§æ‰¿çˆ¶ç±»çš„ Javadoc æ³¨é‡Šã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ@inheritDoc æ ‡è®°ä¸èƒ½ç»§æ‰¿ä»»ä½•å…¶ä»–çš„æ³¨é‡Šä¿¡æ¯ï¼Œå¦‚å‚æ•°ã€è¿”å›å€¼æˆ–å¼‚å¸¸ã€‚å¦‚æœå­ç±»æ–¹æ³•æœ‰è‡ªå·±çš„å‚æ•°ã€è¿”å›å€¼æˆ–å¼‚å¸¸ï¼Œåˆ™éœ€è¦åœ¨å­ç±»æ–¹æ³•ä¸­æ·»åŠ å¯¹åº”çš„ Javadoc æ³¨é‡Šã€‚</p>
</li>
</ul>
</blockquote>
]]></content:encoded>
    </item>
    
    <item>
      <title>ã€ŠEffective Java 3ã€‹ç¬”è®°16ï¼šåœ¨å…¬å…±ç±»ä¸­ï¼Œä½¿ç”¨è®¿é—®å™¨æ–¹æ³•ï¼Œè€Œä¸æ˜¯å…¬å…±å­—æ®µ</title>
      <link>https://blog.chensoul.com/posts/2023/06/15/minimize-the-accessibility-of-classes-and-members/</link>
      <pubDate>Thu, 15 Jun 2023 09:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/06/15/minimize-the-accessibility-of-classes-and-members/</guid>
      <description>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬å››ç« ã€Šç±»å’Œæ¥å£ã€‹çš„å­¦ä¹ ç¬”è®°ï¼šåœ¨å…¬å…±ç±»ä¸­ï¼Œä½¿ç”¨è®¿é—®å™¨æ–¹æ³•ï¼Œè€Œä¸æ˜¯å…¬å…±å­—æ®µã€‚</description>
      <content:encoded><![CDATA[<p>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬å››ç« ã€Šç±»å’Œæ¥å£ã€‹çš„å­¦ä¹ ç¬”è®°ï¼šåœ¨å…¬å…±ç±»ä¸­ï¼Œä½¿ç”¨è®¿é—®å™¨æ–¹æ³•ï¼Œè€Œä¸æ˜¯å…¬å…±å­—æ®µã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>å‘¨æŠ¥-23ï½œè¯»ä¹¦ã€å¥èº«ã€å®šæŠ•ã€å¸®æœ‹å‹ã€é™ªå®¶äºº</title>
      <link>https://blog.chensoul.com/posts/2023/06/14/weekly_review_23/</link>
      <pubDate>Wed, 14 Jun 2023 15:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/06/14/weekly_review_23/</guid>
      <description>å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-06-05 åˆ° 2023-06-11 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚ è¯»ä¹¦ã€å¥èº«ã€æŠ•èµ„ã€å¸®æœ‹å‹ã€é™ªå®¶äººã€‚ ä»¥åå‘¨æŠ¥çš„ä¸»é¢˜</description>
      <content:encoded><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p>æœ¬ç¯‡æ˜¯å¯¹ <code>2023-06-05</code> åˆ° <code>2023-06-11</code> è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº <a href="https://blog.chensoul.com/">åšå®¢</a>ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚</p>
<blockquote>
<p>è¯»ä¹¦ã€å¥èº«ã€æŠ•èµ„ã€å¸®æœ‹å‹ã€é™ªå®¶äººã€‚</p>
</blockquote>
<p>ä»¥åå‘¨æŠ¥çš„ä¸»é¢˜ï¼Œä¼šåŒ…æ‹¬è¿™å‡ ä¸ªéƒ¨åˆ†ï¼šè¯»ä¹¦ã€å¥èº«ã€æŠ•èµ„ã€å¸®æœ‹å‹ã€é™ªå®¶äººï¼Œå†åŠ ä¸Šå·¥ä½œå’Œæœ¬å‘¨åˆ†äº«ä¸¤å—å†…å®¹ã€‚</p>
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-23-03.png" alt="weekly-review-23-03" style="width:50%;" />
<h2 id="è¯»ä¹¦">è¯»ä¹¦</h2>
<p>æœ¬å‘¨é˜…è¯»ç»Ÿè®¡ï¼Œæ€»è®¡é˜…è¯»31åˆ†é’Ÿï¼š</p>
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-23-01.jpeg" alt="weekly-review-23-01" style="width:50%;" />
<p>æœ¬å‘¨é˜…è¯»æ‘˜æŠ„ï¼š</p>
<ul>
<li>äººæ˜¯å‘¨å›´6ä¸ªäººçš„å¹³å‡å€¼ï¼Œå¦‚æœä½ èº«è¾¹æ²¡æœ‰ç‰¹åˆ«å‡ºè‰²çš„å¹´è½»äººä¸ä½ ä¸ºä¼ï¼Œä½ å°±æ‰¾å…ˆè´¤ä»¬çš„ä¹¦ç±ï¼Œä»–ä»¬æŠŠä¸€ç”Ÿçš„æ‰€æœ‰æ€è€ƒã€æ™ºæ…§ã€ç»å†å’Œæƒ…æ„Ÿï¼Œéƒ½å€¾æ³¨åœ¨é‚£äº›ä¹¦é‡Œå¤´äº†ã€‚ å¦‚æœæœ‰ä¸€å¤©è·Ÿä½ å…±é¸£çš„ï¼Œå…¨éƒ½æ˜¯å¤å¾€ä»Šæ¥ã€å¤ä»Šä¸­å¤–é‚£äº›æœ€æ™ºæ…§ã€æœ€æ·±åˆ»ã€æœ€æ•é”ã€æœ€ä¸°å¯Œã€æœ€åšå­¦çš„å¤§è„‘ï¼Œä½ å¤§æ¦‚ç‡ä¸ä¼šå¤ªå·®ï¼Œä½ çš„ç²¾ç¥ä¸–ç•Œä¹Ÿå¤§æ¦‚ç‡ä¼šéå¸¸ä¸°å¯Œã€‚ â€œwe are all in the gutter ï¼Œbut some of us are looking at starsã€‚â€ è¿™å¥è¯æ¥è‡ªä¸€ä¸ªçˆ±å°”å…°çš„è¯—äººï¼Œå«åšå¥¥æ–¯å¡Â·ç‹å°”å¾·ï¼šâ€œæˆ‘ä»¬éƒ½èº«å¤„åœ¨é˜´æ²Ÿé‡Œï¼Œä½†æ€»æœ‰äººä»°æœ›æ˜Ÿç©ºã€‚â€</li>
<li>â€œ Three passions, simple but overwhelmingly strong, have governed my life: the longing for love, the search for knowledge, and unbearable pity for the suffering of mankind. â€  è¿™æ˜¯æ¥è‡ªäºç½—ç´ çš„ä¸€ä¸ªæ¼”è®²ï¼Œå«åšã€Šæˆ‘ä¸ºä»€ä¹ˆè€Œæ´»ç€ã€‹ï¼Œæ„æ€æ˜¯ï¼šå¯¹çŸ¥è¯†çš„æ¸´æœ›ï¼Œå¯¹çˆ±æƒ…çš„è¿½æ±‚ï¼Œå¯¹äººç±»è‹¦éš¾éš¾ä»¥éåˆ¶çš„åŒæƒ…å¿ƒï¼Œè¿™ä¸‰ç§ç®€å•è€Œå¼ºçƒˆçš„æ¿€æƒ…ï¼Œè‹¦è‹¦æ”¯é…æˆ‘çš„ä¸€ç”Ÿ</li>
</ul>
<h2 id="å¥èº«">å¥èº«</h2>
<blockquote>
<p>æˆ‘è·‘è¿‡äº†ä¸€äº›åœ°æ–¹ï¼Œå¸Œæœ›éšç€æ—¶é—´æ¨ç§»ï¼Œåœ°å›¾ç‚¹äº®çš„åœ°æ–¹è¶Šæ¥è¶Šå¤šã€‚2 å¹´é‡Œæˆ‘è·‘è¿‡ 2ä¸ªçœä»½ 2ä¸ªåŸå¸‚ã€‚æ›´å¤šè·‘æ­¥æ•°æ®åœ¨æˆ‘çš„ <a href="https://run.chensoul.com/">è·‘æ­¥</a> ä¸»é¡µã€‚</p>
</blockquote>
<p>è¿™å‘¨å› ä¸ºçˆ¶äº²ä½é™¢éœ€è¦ç…§é¡¾ä»–ï¼Œæ‰€ä»¥è·‘æ­¥æš‚åœã€‚</p>
<h2 id="ç†è´¢">ç†è´¢</h2>
<p>è¿™å‘¨æ€»è®¡æ”¯å‡º 5006 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>6æœˆ11æ—¥ï¼š4057å…ƒï¼Œçˆ¶äº²å‡ºé™¢æ”¯ä»˜3475å…ƒ</p>
</li>
<li>
<p>6æœˆ10æ—¥ï¼š108å…ƒ</p>
</li>
<li>
<p>6æœˆ9æ—¥ï¼š86å…ƒ</p>
</li>
<li>
<p>6æœˆ8æ—¥ï¼š367å…ƒ</p>
</li>
<li>
<p>6æœˆ7æ—¥ï¼š179å…ƒ</p>
</li>
<li>
<p>6æœˆ6æ—¥ï¼š117å…ƒ</p>
</li>
<li>
<p>6æœˆ5æ—¥ï¼š92å…ƒ</p>
</li>
</ul>
<h2 id="é™ªå®¶äºº">é™ªå®¶äºº</h2>
<p>æœ¬å‘¨çš„å·¥ä½œå’Œç”Ÿæ´»éƒ½å› ä¸ºè€çˆ¸ä½é™¢è€Œæ‰“ä¹±äº†åŸæ¥çš„èŠ‚å¥ã€‚èµ·å› æ˜¯è€çˆ¸å› ä¸ºç—›é£å…³èŠ‚ç–¼ç—›è€Œæœç”¨äº†åŒæ°¯èŠ¬é…¸é’ ç¼“é‡Šç‰‡å¯¼è‡´èƒƒæºƒç–¡å’Œå‡ºè¡€ï¼Œå¦å¤–æœ€è¿‘ä¸¤ä¸ªæœˆå¤§ä¾¿å‘ˆé»‘è‰²ã€è¡€æ¶²æµå¤±è¿‡å¤šï¼Œå¯¼è‡´ä¸¥é‡è´«è¡€ã€‚å‘¨å…­å…ˆæ˜¯å»æ­¦æ±‰ä¸­å¿ƒåŒ»é™¢åšèƒƒé•œæ£€æŸ¥ï¼ŒåŒ»ç”Ÿçœ‹åˆ°è€çˆ¸çš„è„¸è‰²è‹ç™½ï¼Œå»ºè®®åšä¸ªè¡€æ¶²æ£€æµ‹ã€‚æ£€æŸ¥ç»“æœå‡ºæ¥ä¹‹åï¼Œå¿ƒæœ‰ä½™æ‚¸ï¼Œå¦‚æœå†æ™šç‚¹å¸¦è€çˆ¸æ¥åŒ»é™¢åšæ£€æŸ¥ï¼Œä¸çŸ¥é“è€çˆ¸ä¼šå› è´«è¡€è€Œå‡ºç°æ€æ ·çš„äº‹æƒ…ã€‚æ ¹æ®æ£€æŸ¥ç»“æœï¼ŒåŒ»ç”Ÿå»ºè®®ç«‹å³ä½é™¢ã€‚åœ¨ç»è¿‡è€ƒè™‘ä¹‹åï¼Œå†³å®šå›é˜³é€»ä½é™¢ã€‚ä½é™¢æœŸé—´ï¼Œéœ€è¦äº²å±é™ªæŠ¤ï¼Œäºæ˜¯å‘¨ä¸€åˆ°å‘¨ä¸‰è¯·äº†ä¸‰å¤©å‡ï¼Œå‘¨å››å’Œå‘¨äº”æ¢è€å©†è¿‡æ¥ç…§é¡¾ã€‚</p>
<p>ä½é™¢æœŸé—´ï¼Œè€çˆ¸å¿ƒé‡Œçƒ¦ï¼Œå› ä¸ºç—›é£å‘ä½œï¼Œè…¿è„šèµ°è·¯æ²¡åŠ›æ°”ï¼Œå¤§å°ä¾¿ä¸æ–¹ä¾¿ã€‚ä½œä¸ºå„¿å­çš„æˆ‘ä¹Ÿåœ¨åæ€ï¼Œè€çˆ¸æˆè¿™æ ·ï¼Œéƒ½æ€ªæˆ‘å¹³æ—¶æ²¡æœ‰å…³å¿ƒä»–çš„å¥åº·å’Œç”Ÿæ´»ã€‚è€çˆ¸ä»Šå¤©è®©æˆ‘åƒçš„è‹¦éƒ½æ˜¯å› ä¸ºè¿‡å»åœ¨è€çˆ¸èº«ä¸Šçš„ä»˜å‡ºä¸å¤Ÿã€‚</p>
<h2 id="å·¥ä½œ">å·¥ä½œ</h2>
<p>æœ€è¿‘åœ¨å­¦ä¹ çš„å†…å®¹æ¸…å•ï¼š</p>
<ul>
<li><a href="https://github.com/clxering/Effective-Java-3rd-edition-Chinese-English-bilingual/tree/dev">Effective Javaï¼ˆç¬¬ 3 ç‰ˆï¼‰</a></li>
<li><a href="https://java-design-patterns.com/zh/">Java Design Patterns (ä¸­æ–‡)</a></li>
<li><a href="https://realpython.com/">Real Python</a></li>
</ul>
<p>æœ¬å‘¨å®Œæˆä¸‰ç¯‡åšå®¢ï¼š</p>
<ul>
<li><a href="/posts/2023/06/10/java-design-patterns-adapter/">Javaè®¾è®¡æ¨¡å¼ï¼šAdapter</a></li>
<li><a href="/posts/2023/06/10/python-data-type/">Pythonå­¦ä¹ 2ï¼šæ•°æ®ç±»å‹</a></li>
<li><a href="/posts/2023/06/11/python-operator-and-expression/">Pythonå­¦ä¹ 3ï¼šè¿ç®—ç¬¦å’Œè¡¨è¾¾å¼</a></li>
</ul>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-23-02.png" alt="weekly-review-23-02"  />
</p>
<h2 id="æœ¬å‘¨åˆ†äº«">æœ¬å‘¨åˆ†äº«</h2>
<p>å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€<a href="https://t.me/chensoul_share">ChenSoul Share</a>ã€Telegram é¢‘é“æˆ–è€…æˆ‘çš„ <a href="https://memos.chensoul.com/">Memos</a> ä¸­ã€‚æˆ‘å†™äº†ä¸€ä¸ª Python è„šæœ¬ä» Memos è¯»å–æœ€è¿‘ä¸€å‘¨å¸¦æœ‰ <code>#memos</code> æ ‡ç­¾çš„è®°å½•ï¼Œåˆ†äº«åˆ°è¿™é‡Œã€‚</p>
<ul>
<li>
<p>ğŸ“Œ<code>2023-06-10</code> å¦‚ä½•ç”¨ ChatGPT åŠ©åŠ›å¼€å‘: å·²ç»æœ‰ 15 ä¸‡äººçœ‹è¿‡çš„ç»éªŒåˆ†äº«<code>#memos</code> <a href="http://luolei.org/chatgpt-in-development/">http://luolei.org/chatgpt-in-development/</a></p>
</li>
<li>
<p>ğŸ“Œ<code>2023-06-09</code> Rustè¯­è¨€å®æˆ˜ï¼Œè§†é¢‘å’Œæ•™ç¨‹  <a href="https://www.youtube.com/watch?v=BpPEoZW5IiY">https://www.youtube.com/watch?v=BpPEoZW5IiY</a> <a href="https://zh.practice.rs/why-exercise.html">https://zh.practice.rs/why-exercise.html</a>  <code>#memos</code> <code>#rust</code></p>
</li>
<li>
<p>ğŸ“Œ<code>2023-06-09</code> åŸºäº Spring Cloud ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å®ç°åˆ†å¸ƒå¼ WebSocket. / åŸºäº RabbitMQ å¹¿æ’­å®ç°åˆ†å¸ƒå¼ WebSocket. <a href="https://lawrenceli.me/blog/websocket-cluster">https://lawrenceli.me/blog/websocket-cluster</a>    <code>#memos</code> <code>#java</code> <code>#skill</code></p>
</li>
<li>
<p>ğŸ“Œ<code>2023-06-09</code> REST å’Œ gRPC æ˜¯ API çš„ä¸¤ç§æœ€æµè¡Œçš„å®ç°æ–¹æ³•ï¼Œæœ¬æ–‡è¯¦ç»†æ¯”è¾ƒå®ƒä»¬çš„å·®å¼‚ã€‚ <a href="https://kreya.app/blog/rest-vs-grpc/">https://kreya.app/blog/rest-vs-grpc/</a> <code>#memos</code></p>
</li>
<li>
<p>ğŸ“Œ<code>2023-06-08</code> ç—›è‹¦æ˜¯å¯¹çš„ï¼Œç„¦è™‘ä¹Ÿæ˜¯å¯¹çš„ï¼Œç—›è‹¦çš„æœ¬è´¨æ¥æºäºä½ å¯¹ç°çŠ¶çš„ä¸æ»¡ï¼Œç„¶åç„¦è™‘çš„æœ¬è´¨æ¥æºäºä½ æˆé•¿é€Ÿåº¦å¤ªæ…¢ã€‚<code>#memos</code></p>
</li>
</ul>
<p>ä»¥ä¸Šã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>Pythonå­¦ä¹ 4ï¼šæµç¨‹æ§åˆ¶</title>
      <link>https://blog.chensoul.com/posts/2023/06/14/python-flow-control/</link>
      <pubDate>Wed, 14 Jun 2023 09:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/06/14/python-flow-control/</guid>
      <description>åœ¨ Python ä¸­ï¼Œæµç¨‹æ§åˆ¶è¯­å¥åŒ…æ‹¬æ¡ä»¶è¯­å¥ï¼ˆif-elif-elseï¼‰ã€å¾ªç¯è¯­å¥ï¼ˆfor å’Œ whileï¼‰ã€è·³è½¬è¯­å¥ï¼ˆbreakã€continue å’Œ ret</description>
      <content:encoded><![CDATA[<p>åœ¨ Python ä¸­ï¼Œæµç¨‹æ§åˆ¶è¯­å¥åŒ…æ‹¬æ¡ä»¶è¯­å¥ï¼ˆif-elif-elseï¼‰ã€å¾ªç¯è¯­å¥ï¼ˆfor å’Œ whileï¼‰ã€è·³è½¬è¯­å¥ï¼ˆbreakã€continue å’Œ returnï¼‰å’Œå¼‚å¸¸å¤„ç†è¯­å¥ã€‚</p>
<h2 id="æ¡ä»¶è¯­å¥">æ¡ä»¶è¯­å¥</h2>
<p>æ¡ä»¶è¯­å¥ç”¨äºåœ¨ä¸åŒçš„æ¡ä»¶ä¸‹æ‰§è¡Œä¸åŒçš„ä»£ç å—ã€‚Python ä¸­çš„æ¡ä»¶è¯­å¥æ˜¯ if-elif-else ç»“æ„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># æ¡ä»¶è¯­å¥ç¤ºä¾‹</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="mi">10</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;x is negative&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;x is zero&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;x is positive&#34;</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="å¾ªç¯è¯­å¥">å¾ªç¯è¯­å¥</h2>
<p>å¾ªç¯è¯­å¥ç”¨äºé‡å¤æ‰§è¡Œä¸€æ®µä»£ç ï¼Œç›´åˆ°æ»¡è¶³æŸä¸ªæ¡ä»¶æˆ–è¾¾åˆ°æŸä¸ªæ¡ä»¶æ¬¡æ•°ä¸ºæ­¢ã€‚Python ä¸­çš„å¾ªç¯è¯­å¥åŒ…æ‹¬ for å’Œ while ä¸¤ç§ç»“æ„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># for å¾ªç¯ç¤ºä¾‹</span>
</span></span><span class="line"><span class="cl"><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">my_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># while å¾ªç¯ç¤ºä¾‹</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="mi">10</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="o">-=</span> <span class="mi">1</span>
</span></span></code></pre></div><p>éå†é›†åˆæ—¶ä¿®æ”¹é›†åˆçš„å†…å®¹ï¼Œä¼šå¾ˆå®¹æ˜“ç”Ÿæˆé”™è¯¯çš„ç»“æœã€‚å› æ­¤ä¸èƒ½ç›´æ¥è¿›è¡Œå¾ªç¯ï¼Œè€Œæ˜¯åº”éå†è¯¥é›†åˆçš„å‰¯æœ¬æˆ–åˆ›å»ºæ–°çš„é›†åˆï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Create a sample collection</span>
</span></span><span class="line"><span class="cl"><span class="n">users</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Hans&#39;</span><span class="p">:</span> <span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;Ã‰lÃ©onore&#39;</span><span class="p">:</span> <span class="s1">&#39;inactive&#39;</span><span class="p">,</span> <span class="s1">&#39;æ™¯å¤ªéƒ&#39;</span><span class="p">:</span> <span class="s1">&#39;active&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Strategy:  Iterate over a copy</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">user</span><span class="p">,</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">users</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;inactive&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">del</span> <span class="n">users</span><span class="p">[</span><span class="n">user</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Strategy:  Create a new collection</span>
</span></span><span class="line"><span class="cl"><span class="n">active_users</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">user</span><span class="p">,</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">users</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;active&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">active_users</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="n">status</span>
</span></span></code></pre></div><h2 id="è·³è½¬è¯­å¥">è·³è½¬è¯­å¥</h2>
<p>è·³è½¬è¯­å¥ç”¨äºåœ¨å¾ªç¯æˆ–å‡½æ•°ä¸­è·³è¿‡ä¸€äº›ä»£ç æˆ–ç»ˆæ­¢å¾ªç¯ã€‚Python ä¸­çš„è·³è½¬è¯­å¥åŒ…æ‹¬ breakã€continue å’Œ returnã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># break ç¤ºä¾‹</span>
</span></span><span class="line"><span class="cl"><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">my_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># continue ç¤ºä¾‹</span>
</span></span><span class="line"><span class="cl"><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">my_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">continue</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="c1"># return ç¤ºä¾‹</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">my_function</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ break å…³é”®å­—æ¥ç»ˆæ­¢ä¸€ä¸ª for å¾ªç¯ï¼Œä½¿ç”¨ continue å…³é”®å­—æ¥è·³è¿‡ä¸€ä¸ªå¾ªç¯è¿­ä»£ï¼Œä½¿ç”¨ return å…³é”®å­—æ¥ä»å‡½æ•°ä¸­è¿”å›ä¸€ä¸ªå€¼ã€‚</p>
<h2 id="pass-è¯­å¥"><code>pass</code> è¯­å¥</h2>
<p><a href="https://docs.python.org/zh-cn/3/reference/simple_stmts.html#pass"><code>pass</code></a> è¯­å¥ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚è¯­æ³•ä¸Šéœ€è¦ä¸€ä¸ªè¯­å¥ï¼Œä½†ç¨‹åºä¸å®é™…æ‰§è¡Œä»»ä½•åŠ¨ä½œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¯¥è¯­å¥ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># pass è¯­å¥</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>  <span class="c1"># Busy-wait for keyboard interrupt (Ctrl+C)</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">function</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># to be implemented</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyEmptyClass</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">pass</span>
</span></span></code></pre></div><h2 id="match-è¯­å¥"><code>match</code> è¯­å¥</h2>
<p>match è¯­å¥æ¥å—ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå¹¶å°†å…¶å€¼ä¸ä¸€ä¸ªæˆ–å¤šä¸ªcaseå—ä¸­ç»™å®šçš„æ¨¡å¼è¿›è¡Œæ¯”è¾ƒã€‚è¿™åœ¨è¡¨é¢ä¸Šç±»ä¼¼äºCã€Javaæˆ–JavaScriptï¼ˆä»¥åŠè®¸å¤šå…¶ä»–è¯­è¨€ï¼‰ä¸­çš„switchè¯­å¥ï¼Œä½†å®ƒæ›´ç±»ä¼¼äºRustæˆ–Haskellç­‰è¯­è¨€ä¸­çš„æ¨¡å¼åŒ¹é…ã€‚åªæœ‰ç¬¬ä¸€ä¸ªåŒ¹é…çš„æ¨¡å¼ä¼šè¢«æ‰§è¡Œï¼Œå¹¶ä¸”å®ƒè¿˜å¯ä»¥ä»å€¼ä¸­æå–ç»„ä»¶ï¼ˆåºåˆ—å…ƒç´ æˆ–å¯¹è±¡å±æ€§ï¼‰åˆ°å˜é‡ä¸­ã€‚</p>
<p>æœ€ç®€å•çš„å½¢å¼æ˜¯å°†ä¸€ä¸ªç›®æ ‡å€¼ä¸ä¸€ä¸ªæˆ–å¤šä¸ªå­—é¢å€¼è¿›è¡Œæ¯”è¾ƒï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">http_error</span><span class="p">(</span><span class="n">status</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">match</span> <span class="n">status</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="mi">400</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s2">&#34;Bad request&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="mi">404</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s2">&#34;Not found&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="mi">418</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s2">&#34;I&#39;m a teapot&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="n">_</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s2">&#34;Something&#39;s wrong with the internet&#34;</span>
</span></span></code></pre></div><p>æ³¨æ„æœ€åä¸€ä¸ªä»£ç å—ï¼šâ€œå˜é‡åâ€ <code>_</code> è¢«ä½œä¸º <em>é€šé…ç¬¦</em> å¹¶å¿…å®šä¼šåŒ¹é…æˆåŠŸã€‚ å¦‚æœæ²¡æœ‰ case è¯­å¥åŒ¹é…æˆåŠŸï¼Œåˆ™ä¸ä¼šæ‰§è¡Œä»»ä½•åˆ†æ”¯ã€‚</p>
<p>ä½¿ç”¨ <code>|</code> ï¼ˆâ€œ or â€ï¼‰åœ¨ä¸€ä¸ªæ¨¡å¼ä¸­å¯ä»¥ç»„åˆå¤šä¸ªå­—é¢å€¼ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">case</span> <span class="mi">401</span> <span class="o">|</span> <span class="mi">403</span> <span class="o">|</span> <span class="mi">404</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34;Not allowed&#34;</span>
</span></span></code></pre></div><p>æ¨¡å¼çš„å½¢å¼ç±»ä¼¼è§£åŒ…èµ‹å€¼ï¼Œå¹¶å¯è¢«ç”¨äºç»‘å®šå˜é‡ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># point is an (x, y) tuple</span>
</span></span><span class="line"><span class="cl"><span class="k">match</span> <span class="n">point</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Origin&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Y=</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;X=</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;X=</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">, Y=</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="n">_</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&#34;Not a point&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>è¯·ä»”ç»†ç ”ç©¶æ­¤ä»£ç ï¼ ç¬¬ä¸€ä¸ªæ¨¡å¼æœ‰ä¸¤ä¸ªå­—é¢å€¼ï¼Œå¯ä»¥çœ‹ä½œæ˜¯ä¸Šé¢æ‰€ç¤ºå­—é¢å€¼æ¨¡å¼çš„æ‰©å±•ã€‚ä½†æ¥ä¸‹æ¥çš„ä¸¤ä¸ªæ¨¡å¼ç»“åˆäº†ä¸€ä¸ªå­—é¢å€¼å’Œä¸€ä¸ªå˜é‡ï¼Œè€Œå˜é‡ <strong>ç»‘å®š</strong> äº†ä¸€ä¸ªæ¥è‡ªç›®æ ‡çš„å€¼ï¼ˆ<code>point</code>ï¼‰ã€‚ç¬¬å››ä¸ªæ¨¡å¼æ•è·äº†ä¸¤ä¸ªå€¼ï¼Œè¿™ä½¿å¾—å®ƒåœ¨æ¦‚å¿µä¸Šç±»ä¼¼äºè§£åŒ…èµ‹å€¼ <code>(x, y) = point</code>ã€‚</p>
<p>å¦‚æœä½¿ç”¨ç±»å®ç°æ•°æ®ç»“æ„ï¼Œå¯åœ¨ç±»åååŠ ä¸€ä¸ªç±»ä¼¼äºæ„é€ å™¨çš„å‚æ•°åˆ—è¡¨ï¼Œè¿™æ ·åšå¯ä»¥æŠŠå±æ€§æ”¾åˆ°å˜é‡é‡Œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Point</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>
</span></span><span class="line"><span class="cl">    <span class="n">y</span><span class="p">:</span> <span class="nb">int</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">where_is</span><span class="p">(</span><span class="n">point</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">match</span> <span class="n">point</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Origin&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Y=</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;X=</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="n">Point</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Somewhere else&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="n">_</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Not a point&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>å¯åœ¨ dataclass ç­‰æ”¯æŒå±æ€§æ’åºçš„å†…ç½®ç±»ä¸­ä½¿ç”¨ä½ç½®å‚æ•°ã€‚è¿˜å¯åœ¨ç±»ä¸­è®¾ç½® <code>__match_args__</code> ç‰¹æ®Šå±æ€§ä¸ºæ¨¡å¼çš„å±æ€§å®šä¹‰æŒ‡å®šä½ç½®ã€‚å¦‚æœå®ƒè¢«è®¾ä¸º (&ldquo;x&rdquo;, &ldquo;y&rdquo;)ï¼Œåˆ™ä»¥ä¸‹æ¨¡å¼å‡ä¸ºç­‰ä»·çš„ï¼Œå¹¶ä¸”éƒ½æŠŠ <code>y</code> å±æ€§ç»‘å®šåˆ° <code>var</code> å˜é‡ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">Point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Point</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">var</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">var</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">Point</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">var</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span></code></pre></div><p>è¯»å–æ¨¡å¼çš„æ¨èæ–¹å¼æ˜¯å°†å®ƒä»¬çœ‹åšæ˜¯ä½ ä¼šåœ¨èµ‹å€¼æ“ä½œå·¦ä¾§æ”¾ç½®çš„å†…å®¹çš„æ‰©å±•å½¢å¼ï¼Œä»¥ä¾¿ç†è§£å„ä¸ªå˜é‡å°†ä¼šè¢«è®¾ç½®çš„å€¼ã€‚ åªæœ‰å•ç‹¬çš„åç§°ï¼ˆä¾‹å¦‚ä¸Šé¢çš„ <code>var</code>ï¼‰ä¼šè¢« match è¯­å¥æ‰€èµ‹å€¼ã€‚ å¸¦ç‚¹å·çš„åç§° (ä¾‹å¦‚ <code>foo.bar</code>)ã€å±æ€§åç§°ï¼ˆä¾‹å¦‚ä¸Šé¢çš„ <code>x=</code> å’Œ <code>y=</code>ï¼‰æˆ–ç±»åç§°ï¼ˆé€šè¿‡å…¶åçš„ &ldquo;(&hellip;)&rdquo; æ¥è¯†åˆ«ï¼Œä¾‹å¦‚ä¸Šé¢çš„ <code>Point</code>ï¼‰éƒ½ç»ä¸ä¼šè¢«èµ‹å€¼ã€‚</p>
<p>æ¨¡å¼å¯ä»¥ä»»æ„åœ°åµŒå¥—ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæœ‰ä¸€ä¸ªç”±ç‚¹ç»„æˆçš„çŸ­åˆ—è¡¨ï¼Œåˆ™å¯ä½¿ç”¨å¦‚ä¸‹æ–¹å¼è¿›è¡ŒåŒ¹é…ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">match</span> <span class="n">points</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="p">[]:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;No points&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;The origin&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)]:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Single point </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="p">[</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y2</span><span class="p">)]:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Two on the Y axis at </span><span class="si">{</span><span class="n">y1</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">y2</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="n">_</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Something else&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>ä¸ºæ¨¡å¼æ·»åŠ æˆä¸ºå®ˆæŠ¤é¡¹çš„ <code>if</code> å­å¥ã€‚å¦‚æœå®ˆæŠ¤é¡¹çš„å€¼ä¸ºå‡ï¼Œåˆ™ <code>match</code> ç»§ç»­åŒ¹é…ä¸‹ä¸€ä¸ª case è¯­å¥å—ã€‚æ³¨æ„ï¼Œå€¼çš„æ•è·å‘ç”Ÿåœ¨å®ˆæŠ¤é¡¹è¢«æ±‚å€¼ä¹‹å‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">match</span> <span class="n">point</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">y</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Y=X at </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Not on the diagonal&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>match è¯­å¥çš„å…¶ä»–ç‰¹æ€§ï¼š</p>
<ul>
<li>
<p>ä¸è§£åŒ…èµ‹å€¼ç±»ä¼¼ï¼Œå…ƒç»„å’Œåˆ—è¡¨æ¨¡å¼å…·æœ‰å®Œå…¨ç›¸åŒçš„å«ä¹‰ï¼Œå¹¶ä¸”å®é™…ä¸Šèƒ½åŒ¹é…ä»»æ„åºåˆ—ã€‚ ä½†å®ƒä»¬ä¸èƒ½åŒ¹é…è¿­ä»£å™¨æˆ–å­—ç¬¦ä¸²ã€‚</p>
</li>
<li>
<p>åºåˆ—æ¨¡å¼æ”¯æŒæ‰©å±•è§£åŒ…æ“ä½œï¼š<code>[x, y, *rest]</code> å’Œ <code>(x, y, *rest)</code> çš„ä½œç”¨ç±»ä¼¼äºè§£åŒ…èµ‹å€¼ã€‚ åœ¨ <code>*</code> ä¹‹åçš„åç§°ä¹Ÿå¯ä»¥ä¸º <code>_</code>ï¼Œå› æ­¤ï¼Œ<code>(x, y, *_)</code> å¯ä»¥åŒ¹é…åŒ…å«è‡³å°‘ä¸¤ä¸ªæ¡ç›®çš„åºåˆ—ï¼Œè€Œä¸å¿…ç»‘å®šå…¶ä½™çš„æ¡ç›®ã€‚</p>
</li>
<li>
<p>æ˜ å°„æ¨¡å¼ï¼š<code>{&quot;bandwidth&quot;: b, &quot;latency&quot;: l}</code> ä»å­—å…¸ä¸­æ•è· <code>&quot;bandwidth&quot;</code> å’Œ <code>&quot;latency&quot;</code> çš„å€¼ã€‚ä¸åºåˆ—æ¨¡å¼ä¸åŒï¼Œé¢å¤–çš„é”®ä¼šè¢«å¿½ç•¥ã€‚<code>**rest</code> ç­‰è§£åŒ…æ“ä½œä¹Ÿæ”¯æŒã€‚ä½† <code>**_</code> æ˜¯å†—ä½™çš„ï¼Œä¸å…è®¸ä½¿ç”¨ã€‚</p>
</li>
<li>
<p>ä½¿ç”¨ <code>as</code> å…³é”®å­—å¯ä»¥æ•è·å­æ¨¡å¼ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">case</span> <span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span> <span class="k">as</span> <span class="n">p2</span><span class="p">):</span> <span class="o">...</span>
</span></span></code></pre></div><p>å°†æŠŠè¾“å…¥çš„ç¬¬äºŒä¸ªå…ƒç´ æ•è·ä¸º <code>p2</code> (åªè¦è¾“å…¥æ˜¯åŒ…å«ä¸¤ä¸ªç‚¹çš„åºåˆ—)</p>
</li>
<li>
<p>å¤§å¤šæ•°å­—é¢å€¼æ˜¯æŒ‰ç›¸ç­‰æ€§æ¯”è¾ƒçš„ï¼Œä½†æ˜¯å•ä¾‹å¯¹è±¡ <code>True</code>, <code>False</code> å’Œ <code>None</code> åˆ™æ˜¯æŒ‰æ ‡è¯†å·æ¯”è¾ƒçš„ã€‚</p>
</li>
<li>
<p>æ¨¡å¼å¯ä»¥ä½¿ç”¨å‘½åå¸¸é‡ã€‚ è¿™äº›å‘½åå¸¸é‡å¿…é¡»ä¸ºå¸¦ç‚¹å·çš„åç§°ä»¥é˜²æ­¢å®ƒä»¬è¢«è§£è¯»ä¸ºæ•è·å˜é‡:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Color</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">RED</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">GREEN</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">BLUE</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">color</span> <span class="o">=</span> <span class="n">Color</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&#34;Enter your choice of &#39;red&#39;, &#39;blue&#39; or &#39;green&#39;: &#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">match</span> <span class="n">color</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;I see red!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="n">Color</span><span class="o">.</span><span class="n">GREEN</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Grass is green&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="n">Color</span><span class="o">.</span><span class="n">BLUE</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;I&#39;m feeling the blues :(&#34;</span><span class="p">)</span>
</span></span></code></pre></div></li>
</ul>
<h2 id="å¼‚å¸¸å¤„ç†è¯­å¥">å¼‚å¸¸å¤„ç†è¯­å¥</h2>
<p>å¼‚å¸¸å¤„ç†è¯­å¥ï¼šç”¨äºå¤„ç†ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°çš„å¼‚å¸¸æƒ…å†µï¼ŒPython ä¸­çš„å¼‚å¸¸å¤„ç†è¯­å¥åŒ…æ‹¬ tryã€exceptã€finally å’Œ raise è¯­å¥ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&#34;Please enter a number: &#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">/</span> <span class="n">x</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Invalid input&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Cannot divide by zero&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;No exception occurred&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">finally</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Execution completed&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># raise è¯­å¥</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&#34;x must be non-negative&#34;</span><span class="p">)</span>
</span></span></code></pre></div>]]></content:encoded>
    </item>
    
    <item>
      <title>Pythonå­¦ä¹ 3ï¼šè¿ç®—ç¬¦å’Œè¡¨è¾¾å¼</title>
      <link>https://blog.chensoul.com/posts/2023/06/11/python-operator-and-expression/</link>
      <pubDate>Sun, 11 Jun 2023 15:30:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/06/11/python-operator-and-expression/</guid>
      <description>åœ¨Pythonä¸­ï¼Œè¿ç®—ç¬¦æ˜¯ç”¨äºæ‰§è¡Œå„ç§æ“ä½œçš„ç¬¦å·æˆ–å…³é”®å­—ï¼›è¡¨è¾¾å¼æ˜¯ç”±æ“ä½œç¬¦ã€å˜é‡ã€å¸¸é‡å’Œå‡½æ•°è°ƒç”¨ç­‰ç»„æˆçš„ï¼Œå®ƒä»¬å¯ä»¥è¢«è®¡ç®—æ±‚å€¼å¹¶è¿”å›ä¸€ä¸ªç»“æœã€‚</description>
      <content:encoded><![CDATA[<p>åœ¨Pythonä¸­ï¼Œè¿ç®—ç¬¦æ˜¯ç”¨äºæ‰§è¡Œå„ç§æ“ä½œçš„ç¬¦å·æˆ–å…³é”®å­—ï¼›è¡¨è¾¾å¼æ˜¯ç”±æ“ä½œç¬¦ã€å˜é‡ã€å¸¸é‡å’Œå‡½æ•°è°ƒç”¨ç­‰ç»„æˆçš„ï¼Œå®ƒä»¬å¯ä»¥è¢«è®¡ç®—æ±‚å€¼å¹¶è¿”å›ä¸€ä¸ªç»“æœã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„è¿ç®—ç¬¦å’Œè¡¨è¾¾å¼ï¼š</p>
<h2 id="ç®—æœ¯è¿ç®—ç¬¦">ç®—æœ¯è¿ç®—ç¬¦</h2>
<p>Pythonä¸­çš„ç®—æœ¯è¿ç®—ç¬¦ç”¨äºæ‰§è¡ŒåŸºæœ¬çš„ç®—æœ¯è¿ç®—ï¼ŒåŒ…æ‹¬åŠ ã€å‡ã€ä¹˜ã€é™¤ã€å–æ¨¡å’Œå¹‚è¿ç®—ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„ç®—æœ¯è¿ç®—ç¬¦ï¼š</p>
<ul>
<li><code>+</code>ï¼šåŠ æ³•è¿ç®—</li>
<li><code>-</code>ï¼šå‡æ³•è¿ç®—</li>
<li><code>*</code>ï¼šä¹˜æ³•è¿ç®—</li>
<li><code>/</code>ï¼šé™¤æ³•è¿ç®—</li>
<li><code>%</code>ï¼šå–æ¨¡è¿ç®—ï¼Œè¿”å›ä¸¤ä¸ªæ•°ç›¸é™¤çš„ä½™æ•°</li>
<li><code>**</code>ï¼šå¹‚è¿ç®—ï¼Œè¿”å›ä¸€ä¸ªæ•°çš„æŒ‡å®šæ¬¡å¹‚</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">+</span> <span class="n">y</span>    <span class="c1"># åŠ æ³•</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">-</span> <span class="n">y</span>    <span class="c1"># å‡æ³•</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">*</span> <span class="n">y</span>    <span class="c1"># ä¹˜æ³•</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">/</span> <span class="n">y</span>    <span class="c1"># é™¤æ³•</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">%</span> <span class="n">y</span>    <span class="c1"># å–æ¨¡</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ç®—æœ¯è¿ç®—ç¬¦æ‰§è¡ŒåŸºæœ¬çš„ç®—æœ¯è¿ç®—ï¼Œä¾‹å¦‚å°†å˜é‡<code>x</code>å’Œ<code>y</code>ç›¸åŠ ã€ç›¸å‡ã€ç›¸ä¹˜ã€ç›¸é™¤å’Œå–æ¨¡ã€‚</p>
<h2 id="æ¯”è¾ƒè¿ç®—ç¬¦">æ¯”è¾ƒè¿ç®—ç¬¦</h2>
<p>Pythonä¸­çš„æ¯”è¾ƒè¿ç®—ç¬¦ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå€¼çš„å¤§å°å…³ç³»ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„æ¯”è¾ƒè¿ç®—ç¬¦ï¼š</p>
<ul>
<li><code>==</code>ï¼šç­‰äºè¿ç®—ç¬¦ï¼Œå¦‚æœä¸¤ä¸ªå€¼ç›¸ç­‰ï¼Œåˆ™è¿”å›<code>True</code>ï¼Œå¦åˆ™è¿”å›<code>False</code></li>
<li><code>!=</code>ï¼šä¸ç­‰äºè¿ç®—ç¬¦ï¼Œå¦‚æœä¸¤ä¸ªå€¼ä¸ç›¸ç­‰ï¼Œåˆ™è¿”å›<code>True</code>ï¼Œå¦åˆ™è¿”å›<code>False</code></li>
<li><code>&gt;</code>ï¼šå¤§äºè¿ç®—ç¬¦ï¼Œå¦‚æœå·¦è¾¹çš„å€¼å¤§äºå³è¾¹çš„å€¼ï¼Œåˆ™è¿”å›<code>True</code>ï¼Œå¦åˆ™è¿”å›<code>False</code></li>
<li><code>&lt;</code>ï¼šå°äºè¿ç®—ç¬¦ï¼Œå¦‚æœå·¦è¾¹çš„å€¼å°äºå³è¾¹çš„å€¼ï¼Œåˆ™è¿”å›<code>True</code>ï¼Œå¦åˆ™è¿”å›<code>False</code></li>
<li><code>&gt;=</code>ï¼šå¤§äºç­‰äºè¿ç®—ç¬¦ï¼Œå¦‚æœå·¦è¾¹çš„å€¼å¤§äºç­‰äºå³è¾¹çš„å€¼ï¼Œåˆ™è¿”å›<code>True</code>ï¼Œå¦åˆ™è¿”å›<code>False</code></li>
<li><code>&lt;=</code>ï¼šå°äºç­‰äºè¿ç®—ç¬¦ï¼Œå¦‚æœå·¦è¾¹çš„å€¼å°äºç­‰äºå³è¾¹çš„å€¼ï¼Œåˆ™è¿”å›<code>True</code>ï¼Œå¦åˆ™è¿”å›<code>False</code></li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">==</span> <span class="n">y</span>    <span class="c1"># ç­‰äº</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">!=</span> <span class="n">y</span>    <span class="c1"># ä¸ç­‰äº</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span>     <span class="c1"># å¤§äº</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span>     <span class="c1"># å°äº</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">y</span>    <span class="c1"># å¤§äºç­‰äº</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">y</span>    <span class="c1"># å°äºç­‰äº</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ¯”è¾ƒè¿ç®—ç¬¦æ¯”è¾ƒå˜é‡<code>x</code>å’Œ<code>y</code>çš„å¤§å°å…³ç³»ï¼Œä¾‹å¦‚åˆ¤æ–­<code>x</code>æ˜¯å¦ç­‰äº<code>y</code>ã€æ˜¯å¦å¤§äº<code>y</code>ç­‰ã€‚</p>
<h2 id="é€»è¾‘è¿ç®—ç¬¦">é€»è¾‘è¿ç®—ç¬¦</h2>
<p>Pythonä¸­çš„é€»è¾‘è¿ç®—ç¬¦ç”¨äºæ‰§è¡Œé€»è¾‘æ“ä½œï¼ŒåŒ…æ‹¬ä¸ã€æˆ–å’Œéè¿ç®—ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„é€»è¾‘è¿ç®—ç¬¦ï¼š</p>
<ul>
<li><code>and</code>ï¼šé€»è¾‘ä¸è¿ç®—ç¬¦ï¼Œå¦‚æœä¸¤ä¸ªæ“ä½œæ•°éƒ½ä¸º<code>True</code>ï¼Œåˆ™è¿”å›<code>True</code>ï¼Œå¦åˆ™è¿”å›<code>False</code></li>
<li><code>or</code>ï¼šé€»è¾‘æˆ–è¿ç®—ç¬¦ï¼Œå¦‚æœä¸¤ä¸ªæ“ä½œæ•°ä¸­è‡³å°‘æœ‰ä¸€ä¸ªä¸º<code>True</code>ï¼Œåˆ™è¿”å›<code>True</code>ï¼Œå¦åˆ™è¿”å›<code>False</code></li>
<li><code>not</code>ï¼šé€»è¾‘éè¿ç®—ç¬¦ï¼Œå¦‚æœæ“ä½œæ•°ä¸º<code>True</code>ï¼Œåˆ™è¿”å›<code>False</code>ï¼Œå¦åˆ™è¿”å›<code>True</code></li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">x</span> <span class="ow">and</span> <span class="n">y</span>    <span class="c1"># ä¸</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="ow">or</span> <span class="n">y</span>     <span class="c1"># æˆ–</span>
</span></span><span class="line"><span class="cl"><span class="ow">not</span> <span class="n">x</span>      <span class="c1"># é</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨é€»è¾‘è¿ç®—ç¬¦æ‰§è¡Œé€»è¾‘è¿ç®—ï¼Œä¾‹å¦‚åˆ¤æ–­å˜é‡<code>x</code>å’Œ<code>y</code>æ˜¯å¦éƒ½ä¸º<code>True</code>ã€åˆ¤æ–­å˜é‡<code>x</code>å’Œ<code>y</code>æ˜¯å¦è‡³å°‘ä¸€ä¸ªä¸º<code>True</code>ç­‰ã€‚</p>
<h2 id="èµ‹å€¼è¿ç®—ç¬¦">èµ‹å€¼è¿ç®—ç¬¦</h2>
<p>Pythonä¸­çš„èµ‹å€¼è¿ç®—ç¬¦ç”¨äºå°†ä¸€ä¸ªå€¼èµ‹ç»™ä¸€ä¸ªå˜é‡ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„èµ‹å€¼è¿ç®—ç¬¦ï¼š</p>
<ul>
<li><code>=</code>ï¼šç®€å•èµ‹å€¼è¿ç®—ç¬¦ï¼Œå°†å³è¾¹çš„å€¼èµ‹ç»™å·¦è¾¹çš„å˜é‡</li>
<li><code>+=</code>ï¼šåŠ ç­‰äºè¿ç®—ç¬¦ï¼Œå°†å³è¾¹çš„å€¼åŠ åˆ°å·¦è¾¹çš„å˜é‡ä¸Šï¼Œå¹¶å°†ç»“æœèµ‹ç»™å·¦è¾¹çš„å˜é‡</li>
<li><code>-=</code>ï¼šå‡ç­‰äºè¿ç®—ç¬¦ï¼Œå°†å³è¾¹çš„å€¼ä»å·¦è¾¹çš„å˜é‡ä¸Šå‡å»ï¼Œå¹¶å°†ç»“æœèµ‹ç»™å·¦è¾¹çš„å˜é‡</li>
<li><code>*=</code>ï¼šä¹˜ç­‰äºè¿ç®—ç¬¦ï¼Œå°†å·¦è¾¹çš„å˜é‡ä¹˜ä»¥å³è¾¹çš„å€¼ï¼Œå¹¶å°†ç»“æœèµ‹ç»™å·¦è¾¹çš„å˜é‡</li>
<li><code>/=</code>ï¼šé™¤ç­‰äºè¿ç®—ç¬¦ï¼Œå°†å·¦è¾¹çš„å˜é‡é™¤ä»¥å³è¾¹çš„å€¼ï¼Œå¹¶å°†ç»“æœèµ‹ç»™å·¦è¾¹çš„å˜é‡</li>
<li><code>%=</code>ï¼šå–æ¨¡ç­‰äºè¿ç®—ç¬¦ï¼Œå°†å·¦è¾¹çš„å˜é‡å–æ¨¡å³è¾¹çš„å€¼ï¼Œå¹¶å°†ç»“æœèµ‹ç»™å·¦è¾¹çš„å˜é‡</li>
<li><code>**=</code>ï¼šå¹‚ç­‰äºè¿ç®—ç¬¦ï¼Œå°†å·¦è¾¹çš„å˜é‡çš„å€¼çš„æŒ‡å®šæ¬¡å¹‚èµ‹ç»™å·¦è¾¹çš„å˜é‡</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="mi">10</span>    <span class="c1"># ç­‰äºå·</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">+=</span> <span class="mi">5</span>    <span class="c1"># åŠ ç­‰äº</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">-=</span> <span class="mi">5</span>    <span class="c1"># å‡ç­‰äº</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">*=</span> <span class="mi">2</span>    <span class="c1"># ä¹˜ç­‰äº</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">/=</span> <span class="mi">3</span>    <span class="c1"># é™¤ç­‰äº</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">%=</span> <span class="mi">2</span>    <span class="c1"># å–æ¨¡ç­‰äº</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨èµ‹å€¼è¿ç®—ç¬¦å°†ä¸€ä¸ªå€¼èµ‹ç»™å˜é‡<code>x</code>ï¼Œä»¥åŠä½¿ç”¨åŠ ç­‰äºã€å‡ç­‰äºã€ä¹˜ç­‰äºã€é™¤ç­‰äºå’Œå–æ¨¡ç­‰äºè¿ç®—ç¬¦å¯¹å˜é‡<code>x</code>è¿›è¡Œæ›´æ–°ã€‚</p>
<h2 id="ä½è¿ç®—ç¬¦">ä½è¿ç®—ç¬¦</h2>
<p>Pythonä¸­çš„ä½è¿ç®—ç¬¦ç”¨äºå¯¹æ•´æ•°è¿›è¡Œä½è¿ç®—ï¼ŒåŒ…æ‹¬æŒ‰ä½ä¸ã€æŒ‰ä½æˆ–ã€æŒ‰ä½å¼‚æˆ–ã€æŒ‰ä½å–åå’Œå·¦å³ç§»ä½è¿ç®—ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„ä½è¿ç®—ç¬¦ï¼š</p>
<ul>
<li><code>&amp;</code>ï¼šæŒ‰ä½ä¸è¿ç®—ç¬¦ï¼Œå¯¹ä¸¤ä¸ªæ“ä½œæ•°çš„æ¯ä¸ªä½æ‰§è¡Œé€»è¾‘ä¸æ“ä½œï¼Œè¿”å›ä¸€ä¸ªæ–°çš„æ•´æ•°</li>
<li><code>|</code>ï¼šæŒ‰ä½æˆ–è¿ç®—ç¬¦ï¼Œå¯¹ä¸¤ä¸ªæ“ä½œæ•°çš„æ¯ä¸ªä½æ‰§è¡Œé€»è¾‘æˆ–æ“ä½œï¼Œè¿”å›ä¸€ä¸ªæ–°çš„æ•´æ•°</li>
<li><code>^</code>ï¼šæŒ‰ä½å¼‚æˆ–è¿ç®—ç¬¦ï¼Œå¯¹ä¸¤ä¸ªæ“ä½œæ•°çš„æ¯ä¸ªä½æ‰§è¡Œé€»è¾‘å¼‚æˆ–æ“ä½œï¼Œè¿”å›ä¸€ä¸ªæ–°çš„æ•´æ•°</li>
<li><code>~</code>ï¼šæŒ‰ä½å–åè¿ç®—ç¬¦ï¼Œå¯¹æ“ä½œæ•°çš„æ¯ä¸ªä½æ‰§è¡Œé€»è¾‘å–åæ“ä½œï¼Œè¿”å›ä¸€ä¸ªæ–°çš„æ•´æ•°</li>
<li><code>&lt;&lt;</code>ï¼šå·¦ç§»ä½è¿ç®—ç¬¦ï¼Œå°†ä¸€ä¸ªæ•´æ•°çš„æ‰€æœ‰ä½å‘å·¦ç§»åŠ¨æŒ‡å®šçš„ä½æ•°ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„æ•´æ•°</li>
<li><code>&gt;&gt;</code>ï¼šå³ç§»ä½è¿ç®—ç¬¦ï¼Œå°†ä¸€ä¸ªæ•´æ•°çš„æ‰€æœ‰ä½å‘å³ç§»åŠ¨æŒ‡å®šçš„ä½æ•°ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„æ•´æ•°</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">&amp;</span> <span class="n">y</span>    <span class="c1"># æŒ‰ä½ä¸</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">|</span> <span class="n">y</span>    <span class="c1"># æŒ‰ä½æˆ–</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">^</span> <span class="n">y</span>    <span class="c1"># æŒ‰ä½å¼‚æˆ–</span>
</span></span><span class="line"><span class="cl"><span class="o">~</span><span class="n">x</span>       <span class="c1"># æŒ‰ä½å–å</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span>   <span class="c1"># å·¦ç§»2ä½</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span>   <span class="c1"># å³ç§»2ä½</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä½è¿ç®—ç¬¦å¯¹äºŒè¿›åˆ¶æ•°è¿›è¡Œä½æ“ä½œï¼Œä¾‹å¦‚å°†å˜é‡<code>x</code>å’Œ<code>y</code>è¿›è¡ŒæŒ‰ä½ä¸ã€æŒ‰ä½æˆ–ã€æŒ‰ä½å¼‚æˆ–ï¼Œä»¥åŠå¯¹å˜é‡<code>x</code>è¿›è¡ŒæŒ‰ä½å–åã€å·¦ç§»å’Œå³ç§»ã€‚</p>
<h2 id="ä¸‰å…ƒè¿ç®—ç¬¦">ä¸‰å…ƒè¿ç®—ç¬¦</h2>
<p>Pythonä¸­çš„ä¸‰å…ƒè¿ç®—ç¬¦å¯ä»¥ç”¨äºåœ¨ä¸€è¡Œä»£ç ä¸­å®ç°ç®€å•çš„æ¡ä»¶è¯­å¥ã€‚å®ƒçš„è¯­æ³•å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">value_if_true</span> <span class="k">if</span> <span class="n">condition</span> <span class="k">else</span> <span class="n">value_if_false</span>
</span></span></code></pre></div><p>å…¶ä¸­<code>condition</code>æ˜¯ä¸€ä¸ªå¸ƒå°”è¡¨è¾¾å¼ï¼Œå¦‚æœå®ƒçš„å€¼ä¸º<code>True</code>ï¼Œåˆ™è¿”å›<code>value_if_true</code>ï¼Œå¦åˆ™è¿”å›<code>value_if_false</code>ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="mi">10</span>
</span></span><span class="line"><span class="cl"><span class="n">max_value</span> <span class="o">=</span> <span class="n">x</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span> <span class="k">else</span> <span class="n">y</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">max_value</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºï¼š10</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸‰å…ƒè¿ç®—ç¬¦æ¥æ¯”è¾ƒ<code>x</code>å’Œ<code>y</code>çš„å€¼ï¼Œå¹¶å°†è¾ƒå¤§çš„å€¼èµ‹ç»™å˜é‡<code>max_value</code>ã€‚</p>
<h2 id="æˆå‘˜è¿ç®—ç¬¦">æˆå‘˜è¿ç®—ç¬¦</h2>
<p>Pythonä¸­çš„æˆå‘˜è¿ç®—ç¬¦ç”¨äºæ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦æ˜¯å¦ä¸€ä¸ªå€¼çš„æˆå‘˜ï¼ŒåŒ…æ‹¬<code>in</code>å’Œ<code>not in</code>è¿ç®—ç¬¦ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="mi">3</span> <span class="ow">in</span> <span class="n">my_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;3 is in my_list&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>in</code>è¿ç®—ç¬¦æ¥æ£€æŸ¥<code>3</code>æ˜¯å¦æ˜¯<code>my_list</code>ä¸­çš„æˆå‘˜ã€‚å¦‚æœæ˜¯ï¼Œåˆ™æ‰“å°å‡º<code>3 is in my_list</code>ã€‚</p>
<h2 id="èº«ä»½è¿ç®—ç¬¦">èº«ä»½è¿ç®—ç¬¦</h2>
<p>Pythonä¸­çš„èº«ä»½è¿ç®—ç¬¦ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å†…å­˜åœ°å€ï¼ŒåŒ…æ‹¬<code>is</code>å’Œ<code>is not</code>è¿ç®—ç¬¦ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="n">y</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;x and y have the same identity&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;x and y have different identities&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>is</code>è¿ç®—ç¬¦æ¥æ¯”è¾ƒ<code>x</code>å’Œ<code>y</code>çš„å†…å­˜åœ°å€ã€‚ç”±äº<code>x</code>å’Œ<code>y</code>æ˜¯ä¸¤ä¸ªä¸åŒçš„åˆ—è¡¨å¯¹è±¡ï¼Œæ‰€ä»¥å®ƒä»¬çš„å†…å­˜åœ°å€ä¸åŒï¼Œç¨‹åºä¼šæ‰“å°å‡º<code>x and y have different identities</code>ã€‚</p>
<h2 id="åˆ‡ç‰‡è¿ç®—ç¬¦">åˆ‡ç‰‡è¿ç®—ç¬¦</h2>
<p>Pythonä¸­çš„åˆ‡ç‰‡è¿ç®—ç¬¦ç”¨äºä»åºåˆ—ä¸­è·å–ä¸€ä¸ªå­åºåˆ—ï¼ŒåŒ…æ‹¬ä»å¼€å§‹ä½ç½®åˆ°ç»“æŸä½ç½®çš„åˆ‡ç‰‡å’Œæ­¥é•¿åˆ‡ç‰‡ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span>  <span class="c1"># è¾“å‡ºï¼š[2, 3, 4]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_list</span><span class="p">[::</span><span class="mi">2</span><span class="p">])</span>  <span class="c1"># è¾“å‡ºï¼š[1, 3, 5]</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨åˆ‡ç‰‡è¿ç®—ç¬¦ä»åˆ—è¡¨<code>my_list</code>ä¸­è·å–ä¸€ä¸ªå­åºåˆ—ã€‚ç¬¬ä¸€ä¸ªåˆ‡ç‰‡<code>my_list[1:4]</code>è¿”å›ä»ä¸‹æ ‡<code>1</code>åˆ°ä¸‹æ ‡<code>3</code>çš„å…ƒç´ ï¼Œç¬¬äºŒä¸ªåˆ‡ç‰‡<code>my_list[::2]</code>è¿”å›æ¯éš”ä¸€ä¸ªå…ƒç´ çš„å­åºåˆ—ã€‚</p>
<h2 id="æ ¼å¼åŒ–è¿ç®—ç¬¦">æ ¼å¼åŒ–è¿ç®—ç¬¦</h2>
<p>Pythonä¸­çš„æ ¼å¼åŒ–è¿ç®—ç¬¦ç”¨äºå°†ä¸€ä¸ªå€¼æ’å…¥åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ã€‚å®ƒçš„è¯­æ³•å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="s2">&#34;format string&#34;</span> <span class="o">%</span> <span class="n">values</span>
</span></span></code></pre></div><p>å…¶ä¸­<code>&quot;format string&quot;</code>æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒåŒ…å«æ ¼å¼åŒ–ä»£ç ï¼Œ<code>values</code>æ˜¯ä¸€ä¸ªå…ƒç»„ï¼ŒåŒ…å«è¦æ’å…¥çš„å€¼ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;Alice&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">age</span> <span class="o">=</span> <span class="mi">25</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;My name is </span><span class="si">%s</span><span class="s2">, and I am </span><span class="si">%d</span><span class="s2"> years old.&#34;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">))</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ ¼å¼åŒ–è¿ç®—ç¬¦å°†å˜é‡<code>name</code>å’Œ<code>age</code>æ’å…¥åˆ°å­—ç¬¦ä¸²ä¸­ï¼Œç”Ÿæˆä¸€æ¡åŒ…å«å˜é‡å€¼çš„æ¶ˆæ¯ã€‚</p>
<h2 id="æ‹¼æ¥è¿ç®—ç¬¦">æ‹¼æ¥è¿ç®—ç¬¦</h2>
<p>Pythonä¸­çš„æ‹¼æ¥è¿ç®—ç¬¦ç”¨äºå°†ä¸¤ä¸ªå­—ç¬¦ä¸²æˆ–åºåˆ—è¿æ¥èµ·æ¥ï¼ŒåŒ…æ‹¬<code>+</code>è¿ç®—ç¬¦å’Œ<code>*</code>è¿ç®—ç¬¦ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">str1</span> <span class="o">=</span> <span class="s2">&#34;Hello&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">str2</span> <span class="o">=</span> <span class="s2">&#34;world&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">str1</span> <span class="o">+</span> <span class="s2">&#34; &#34;</span> <span class="o">+</span> <span class="n">str2</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºï¼šHello world</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_list</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºï¼š[1, 2, 3, 1, 2, 3, 1, 2, 3]</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ‹¼æ¥è¿ç®—ç¬¦å°†ä¸¤ä¸ªå­—ç¬¦ä¸²è¿æ¥èµ·æ¥ï¼Œä»¥åŠå°†ä¸€ä¸ªåˆ—è¡¨å¤åˆ¶å¤šæ¬¡ç”Ÿæˆä¸€ä¸ªæ–°çš„åˆ—è¡¨ã€‚</p>
<h2 id="è§£åŒ…è¿ç®—ç¬¦">è§£åŒ…è¿ç®—ç¬¦</h2>
<p>Pythonä¸­çš„è§£åŒ…è¿ç®—ç¬¦åŒ…æ‹¬ä¸¤ç§ï¼š<code>*</code>å’Œ<code>**</code>ã€‚</p>
<h3 id="è§£åŒ…è¿ç®—ç¬¦-1"><code>*</code>è§£åŒ…è¿ç®—ç¬¦</h3>
<p><code>*</code>è§£åŒ…è¿ç®—ç¬¦ç”¨äºå°†å¯è¿­ä»£å¯¹è±¡ï¼ˆå¦‚åˆ—è¡¨ã€å…ƒç»„ã€é›†åˆç­‰ï¼‰è§£åŒ…æˆå•ç‹¬çš„å…ƒç´ ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="n">my_list</span><span class="p">)</span>   <span class="c1"># è¾“å‡º: 1 2 3 4 5</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>*</code>è§£åŒ…è¿ç®—ç¬¦å°†<code>my_list</code>åˆ—è¡¨è§£åŒ…æˆä¸€ä¸ªä¸ªå•ç‹¬çš„å…ƒç´ ï¼Œç„¶åé€šè¿‡<code>print</code>å‡½æ•°è¾“å‡ºã€‚</p>
<h3 id="è§£åŒ…è¿ç®—ç¬¦-2"><code>**</code>è§£åŒ…è¿ç®—ç¬¦</h3>
<p><code>**</code>è§£åŒ…è¿ç®—ç¬¦ç”¨äºå°†å­—å…¸è§£åŒ…æˆå…³é”®å­—å‚æ•°ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;x&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;y&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&#34;z&#34;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="o">**</span><span class="n">my_dict</span><span class="p">)</span>   <span class="c1"># è¾“å‡º: x=1 y=2 z=3</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>**</code>è§£åŒ…è¿ç®—ç¬¦å°†<code>my_dict</code>å­—å…¸è§£åŒ…æˆå…³é”®å­—å‚æ•°ï¼Œå¹¶é€šè¿‡<code>print</code>å‡½æ•°è¾“å‡ºã€‚</p>
<p>é™¤äº†ä¸Šé¢çš„ç”¨æ³•ï¼Œ<code>*</code>å’Œ<code>**</code>è§£åŒ…è¿ç®—ç¬¦è¿˜å¯ä»¥ç”¨äºå‡½æ•°å®šä¹‰å’Œè°ƒç”¨ä¸­ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">my_func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">my_func</span><span class="p">(</span><span class="o">*</span><span class="n">my_list</span><span class="p">)</span>   <span class="c1"># è¾“å‡º: 1 2 3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">my_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;a&#34;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;b&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&#34;c&#34;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">my_func</span><span class="p">(</span><span class="o">**</span><span class="n">my_dict</span><span class="p">)</span>   <span class="c1"># è¾“å‡º: 1 2 3</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°<code>my_func</code>ï¼Œç„¶åä½¿ç”¨<code>*</code>å’Œ<code>**</code>è§£åŒ…è¿ç®—ç¬¦å°†åˆ—è¡¨å’Œå­—å…¸ä¸­çš„å€¼ä½œä¸ºå‡½æ•°çš„å‚æ•°ä¼ é€’è¿›å»ã€‚</p>
<h2 id="è¿ç®—ç¬¦">@è¿ç®—ç¬¦</h2>
<p><code>@</code>è¿ç®—ç¬¦ç”¨äºæ‰§è¡ŒçŸ©é˜µä¹˜æ³•ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">]])</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">@</span> <span class="n">b</span>   <span class="c1"># çŸ©é˜µä¹˜æ³•</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>    <span class="c1"># è¾“å‡º: [[19 22] [43 50]]</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>@</code>è¿ç®—ç¬¦å¯¹ä¸¤ä¸ªçŸ©é˜µè¿›è¡Œä¹˜æ³•è¿ç®—ï¼Œå¹¶å°†ç»“æœä¿å­˜åœ¨å˜é‡<code>c</code>ä¸­ã€‚</p>
<h2 id="lambdaè¡¨è¾¾å¼">lambdaè¡¨è¾¾å¼</h2>
<p>Pythonä¸­çš„lambdaè¡¨è¾¾å¼å¯ä»¥ç”¨äºåˆ›å»ºåŒ¿åå‡½æ•°ã€‚å®ƒçš„è¯­æ³•å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">lambda</span> <span class="n">arguments</span> <span class="p">:</span> <span class="n">expression</span>
</span></span></code></pre></div><p>å…¶ä¸­<code>arguments</code>æ˜¯å‡½æ•°çš„å‚æ•°åˆ—è¡¨ï¼Œ<code>expression</code>æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¡¨ç¤ºå‡½æ•°çš„è¿”å›å€¼ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>  <span class="c1"># è¾“å‡ºï¼š5</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨lambdaè¡¨è¾¾å¼åˆ›å»ºäº†ä¸€ä¸ªå‡½æ•°<code>f</code>ï¼Œå®ƒæ¥å—ä¸¤ä¸ªå‚æ•°<code>x</code>å’Œ<code>y</code>ï¼Œå¹¶è¿”å›å®ƒä»¬çš„å’Œã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>Pythonå­¦ä¹ 2ï¼šæ•°æ®ç±»å‹</title>
      <link>https://blog.chensoul.com/posts/2023/06/10/python-data-type/</link>
      <pubDate>Sat, 10 Jun 2023 15:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/06/10/python-data-type/</guid>
      <description>Python ä¸­çš„æ•°æ®ç±»å‹åŒ…æ‹¬ï¼š æ•°å­—ç±»å‹ï¼šåŒ…æ‹¬æ•´å‹ã€æµ®ç‚¹å‹ã€å¤æ•°å‹å’Œå¸ƒå°”ç±»å‹ï¼šåªæœ‰ä¸¤ä¸ªå–å€¼ï¼ŒTrue å’Œ Falseï¼Œç”¨äºè¡¨ç¤ºé€»è¾‘å€¼ã€‚ å­—ç¬¦ä¸²ç±»å‹ï¼šç”±ä¸€ç³»åˆ—å­—</description>
      <content:encoded><![CDATA[<p>Python ä¸­çš„æ•°æ®ç±»å‹åŒ…æ‹¬ï¼š</p>
<ol>
<li>æ•°å­—ç±»å‹ï¼šåŒ…æ‹¬æ•´å‹ã€æµ®ç‚¹å‹ã€å¤æ•°å‹å’Œå¸ƒå°”ç±»å‹ï¼šåªæœ‰ä¸¤ä¸ªå–å€¼ï¼ŒTrue å’Œ Falseï¼Œç”¨äºè¡¨ç¤ºé€»è¾‘å€¼ã€‚</li>
<li>å­—ç¬¦ä¸²ç±»å‹ï¼šç”±ä¸€ç³»åˆ—å­—ç¬¦ç»„æˆï¼Œå¯ä»¥æ˜¯å•å¼•å·ã€åŒå¼•å·æˆ–ä¸‰å¼•å·æ‹¬èµ·æ¥çš„æ–‡æœ¬ã€‚</li>
<li>åˆ—è¡¨ç±»å‹ï¼šç”±ä¸€ç³»åˆ—æœ‰åºçš„å…ƒç´ ç»„æˆï¼Œå¯ä»¥åŒ…å«ä»»ä½•ç±»å‹çš„æ•°æ®ã€‚</li>
<li>å…ƒç»„ç±»å‹ï¼šä¸åˆ—è¡¨ç±»ä¼¼ï¼Œä½†æ˜¯<code>å…ƒç´ ä¸èƒ½è¢«ä¿®æ”¹</code>ã€‚</li>
<li>é›†åˆç±»å‹ï¼šç”±ä¸€ç»„å”¯ä¸€çš„å…ƒç´ ç»„æˆï¼Œæ”¯æŒé›†åˆçš„åŸºæœ¬æ“ä½œï¼Œå¦‚å¹¶é›†ã€äº¤é›†å’Œå·®é›†ç­‰ã€‚</li>
<li>å­—å…¸ç±»å‹ï¼šç”±ä¸€ç»„é”®å€¼å¯¹ç»„æˆï¼Œå…¶ä¸­é”®æ˜¯å”¯ä¸€çš„ï¼Œç”¨äºæŸ¥æ‰¾å’Œå­˜å‚¨å€¼ã€‚</li>
<li>None ç±»å‹ï¼šè¡¨ç¤ºç©ºå€¼æˆ–ç¼ºå¤±å€¼ã€‚</li>
</ol>
<h2 id="æ•°å­—">æ•°å­—</h2>
<p>åœ¨ Python ä¸­ï¼Œæ•°å­—ç±»å‹åŒ…æ‹¬æ•´æ•°ï¼ˆintï¼‰ã€æµ®ç‚¹æ•°ï¼ˆfloatï¼‰ã€å¤æ•°ï¼ˆcomplexï¼‰å’Œå¸ƒå°”å€¼ï¼ˆboolï¼‰ã€‚</p>
<ol>
<li>
<p>æ•´æ•°ï¼ˆintï¼‰æ˜¯ä¸å¸¦å°æ•°çš„æ•°å­—ï¼Œå¯ä»¥ä½¿ç”¨åè¿›åˆ¶ã€äºŒè¿›åˆ¶ã€å…«è¿›åˆ¶æˆ–åå…­è¿›åˆ¶è¡¨ç¤ºã€‚<strong>åœ¨ Python 3 ä¸­ï¼Œæ•´æ•°çš„é•¿åº¦ä¸å†å—é™äºæœºå™¨çš„ä½æ•°ï¼Œå¯ä»¥è¡¨ç¤ºä»»æ„å¤§çš„æ•´æ•°ã€‚</strong> ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="mi">123</span>       <span class="c1"># åè¿›åˆ¶æ•´æ•°</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="mb">0b1010</span>    <span class="c1"># äºŒè¿›åˆ¶æ•´æ•°ï¼Œç­‰äºåè¿›åˆ¶çš„ 10</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span> <span class="o">=</span> <span class="mo">0o12</span>      <span class="c1"># å…«è¿›åˆ¶æ•´æ•°ï¼Œç­‰äºåè¿›åˆ¶çš„ 10</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span> <span class="o">=</span> <span class="mh">0x0A</span>      <span class="c1"># åå…­è¿›åˆ¶æ•´æ•°ï¼Œç­‰äºåè¿›åˆ¶çš„ 10</span>
</span></span></code></pre></div></li>
<li>
<p>æµ®ç‚¹æ•°ï¼ˆfloatï¼‰æ˜¯å¸¦å°æ•°çš„æ•°å­—ï¼Œå¯ä»¥ä½¿ç”¨ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºã€‚åœ¨ Python ä¸­ï¼Œæµ®ç‚¹æ•°é‡‡ç”¨ IEEE 754 æ ‡å‡†è¡¨ç¤ºï¼Œå…·æœ‰åŒç²¾åº¦ï¼ˆ64 ä½ï¼‰å’Œå•ç²¾åº¦ï¼ˆ32 ä½ï¼‰ä¸¤ç§å½¢å¼ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="mf">3.14e-2</span>   <span class="c1"># ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºçš„æµ®ç‚¹æ•°ï¼Œç­‰äº 0.0314</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="mf">1.23</span>      <span class="c1"># æ™®é€šçš„æµ®ç‚¹æ•°</span>
</span></span></code></pre></div></li>
<li>
<p>å¤æ•°ï¼ˆcomplexï¼‰æ˜¯å…·æœ‰å®éƒ¨å’Œè™šéƒ¨çš„æ•°å­—ï¼Œå¯ä»¥ä½¿ç”¨ <code>a+bj</code> æˆ– <code>complex(a, b)</code> çš„å½¢å¼è¡¨ç¤ºï¼Œå…¶ä¸­ j è¡¨ç¤ºè™šæ•°å•ä½ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="mi">2</span><span class="n">j</span>      <span class="c1"># å¤æ•°</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="nb">complex</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>   <span class="c1"># å¤æ•°ï¼Œç­‰äº 3+4j</span>
</span></span></code></pre></div></li>
<li>
<p>å¸ƒå°”å€¼ï¼ˆboolï¼‰åªæœ‰ä¸¤ä¸ªå–å€¼ï¼Œ<code>True</code> å’Œ <code>False</code>ï¼Œç”¨äºè¡¨ç¤ºçœŸå’Œå‡ã€‚åœ¨ Python ä¸­ï¼Œå¸ƒå°”å€¼å¯ä»¥å’Œæ•°å€¼è¿›è¡Œè¿ç®—ï¼ŒTrue è½¬æ¢ä¸º 1ï¼ŒFalse è½¬æ¢ä¸º 0ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="kc">True</span>   <span class="c1"># c çš„å€¼ä¸º 2</span>
</span></span><span class="line"><span class="cl"><span class="n">d</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="kc">False</span>  <span class="c1"># d çš„å€¼ä¸º 0</span>
</span></span></code></pre></div></li>
</ol>
<p>æ•°å­—çš„æ“ä½œå’Œè¿ç®—ï¼š</p>
<ol>
<li>æ•´æ•°é™¤æ³•ã€å–æ¨¡ã€å¹‚è¿ç®—</li>
</ol>
<p>åœ¨ Python ä¸­ï¼Œä½¿ç”¨ <code>/</code> è¿ç®—ç¬¦è¿›è¡Œé™¤æ³•è¿ç®—å¾—åˆ°çš„ç»“æœæ˜¯æµ®ç‚¹æ•°ï¼Œå¦‚æœæƒ³è¦å¾—åˆ°æ•´æ•°ç»“æœï¼Œå¯ä»¥ä½¿ç”¨ <code>//</code> è¿ç®—ç¬¦è¿›è¡Œæ•´æ•°é™¤æ³•è¿ç®—ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="mi">7</span> <span class="o">/</span> <span class="mi">2</span>   <span class="c1"># a çš„å€¼ä¸º 3.5</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="mi">7</span> <span class="o">//</span> <span class="mi">2</span>  <span class="c1"># b çš„å€¼ä¸º 3</span>
</span></span></code></pre></div><p>åŒæ—¶ï¼Œä½¿ç”¨ <code>%</code> è¿ç®—ç¬¦å¯ä»¥è¿›è¡Œå–æ¨¡è¿ç®—ï¼Œå³è®¡ç®—é™¤æ³•çš„ä½™æ•°ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">c</span> <span class="o">=</span> <span class="mi">7</span> <span class="o">%</span> <span class="mi">2</span>   <span class="c1"># c çš„å€¼ä¸º 1</span>
</span></span></code></pre></div><p><code>**</code>æ˜¯ä¸€ç§è¿ç®—ç¬¦ï¼Œç§°ä¸ºâ€œåŒæ˜Ÿå·è¿ç®—ç¬¦â€æˆ–â€œå¹‚è¿ç®—ç¬¦â€ã€‚å®ƒå¯ä»¥ç”¨äºè®¡ç®—ä¸€ä¸ªæ•°çš„å¹‚ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">d</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">3</span>  <span class="c1"># è®¡ç®—2çš„3æ¬¡æ–¹ï¼Œç»“æœä¸º8</span>
</span></span></code></pre></div><ol start="2">
<li>æ•°å­—ç±»å‹çš„è½¬æ¢</li>
</ol>
<p>åœ¨ Python ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code> int()</code>ã€<code>float()</code> å’Œ <code>complex()</code> å‡½æ•°å°†å…¶ä»–ç±»å‹çš„æ•°æ®è½¬æ¢ä¸ºæ•´æ•°ã€æµ®ç‚¹æ•°å’Œå¤æ•°ç±»å‹ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s2">&#34;123&#34;</span><span class="p">)</span>  <span class="c1"># å°†å­—ç¬¦ä¸² &#34;123&#34; è½¬æ¢ä¸ºæ•´æ•°ç±»å‹</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&#34;3.14&#34;</span><span class="p">)</span>  <span class="c1"># å°†å­—ç¬¦ä¸² &#34;3.14&#34; è½¬æ¢ä¸ºæµ®ç‚¹æ•°ç±»å‹</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span> <span class="o">=</span> <span class="nb">complex</span><span class="p">(</span><span class="s2">&#34;1+2j&#34;</span><span class="p">)</span>  <span class="c1"># å°†å­—ç¬¦ä¸² &#34;1+2j&#34; è½¬æ¢ä¸ºå¤æ•°ç±»å‹</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="c1"># 123 3.14 (1+2j)</span>
</span></span></code></pre></div><p>åŒæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>str()</code>ã€<code>repr()</code> å’Œ <code>format()</code> å‡½æ•°å°†æ•°å­—è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>                     <span class="c1"># å°†æ•´æ•° 123 è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="mf">3.1415926</span><span class="p">)</span>              <span class="c1"># å°†æµ®ç‚¹æ•° 3.1415926 è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œä½¿ç”¨ repr() å‡½æ•°å¯ä»¥ä¿ç•™å°æ•°ç‚¹åçš„ç²¾åº¦</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span> <span class="o">=</span> <span class="s2">&#34;</span><span class="si">{:.2f}</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">3.1415926</span><span class="p">)</span>   <span class="c1"># å°†æµ®ç‚¹æ•° 3.1415926 è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œä¿ç•™å°æ•°ç‚¹åä¸¤ä½</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="c1"># 123 3.1415926 3.14</span>
</span></span></code></pre></div><ol start="3">
<li>éšæœºæ•°ç”Ÿæˆ</li>
</ol>
<p>åœ¨ Python ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ random æ¨¡å—ä¸­çš„å‡½æ•°ç”Ÿæˆéšæœºæ•°ã€‚å¸¸ç”¨çš„å‡½æ•°åŒ…æ‹¬ï¼š</p>
<ul>
<li><code>random.random()</code>ï¼šç”Ÿæˆä¸€ä¸ª 0 åˆ° 1 ä¹‹é—´çš„éšæœºæµ®ç‚¹æ•°ã€‚</li>
<li><code>random.randint(a, b)</code>ï¼šç”Ÿæˆä¸€ä¸ªåœ¨ a å’Œ b ä¹‹é—´ï¼ˆåŒ…æ‹¬ a å’Œ bï¼‰çš„éšæœºæ•´æ•°ã€‚</li>
<li><code>random.choice(seq)</code>ï¼šä»åºåˆ— seq ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªå…ƒç´ å¹¶è¿”å›ã€‚</li>
<li><code>random.shuffle(seq)</code>ï¼šå°†åºåˆ— seq ä¸­çš„å…ƒç´ éšæœºæ’åºã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ random æ¨¡å—ä¸­çš„ <code>randint()</code> å‡½æ•°ç”Ÿæˆä¸€ä¸ªéšæœºæ•´æ•°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">random</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>   <span class="c1"># ç”Ÿæˆä¸€ä¸ªåœ¨ 1 å’Œ 10 ä¹‹é—´çš„éšæœºæ•´æ•°</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="å­—ç¬¦ä¸²">å­—ç¬¦ä¸²</h2>
<p>åœ¨ Python ä¸­ï¼Œ<strong>å­—ç¬¦ä¸²æ˜¯ä¸€ç§ä¸å¯å˜åºåˆ—ç±»å‹</strong> ï¼Œç”¨äºè¡¨ç¤ºæ–‡æœ¬æ•°æ®ã€‚å­—ç¬¦ä¸²æ˜¯ç”±ä¸€ç³»åˆ— Unicode å­—ç¬¦ç»„æˆçš„ï¼Œå¯ä»¥åŒ…å«ä»»ä½•å­—ç¬¦ï¼ŒåŒ…æ‹¬å­—æ¯ã€æ•°å­—ã€æ ‡ç‚¹ç¬¦å·ã€ç©ºæ ¼ç­‰ã€‚</p>
<p>å®šä¹‰å­—ç¬¦ä¸²å¯ä»¥ä½¿ç”¨ <strong>å•å¼•å·ã€åŒå¼•å·æˆ–ä¸‰å¼•å·</strong>ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">str1</span> <span class="o">=</span> <span class="s1">&#39;Hello, world!&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">str2</span> <span class="o">=</span> <span class="s2">&#34;Hello, Python!&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">str3</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;This is a long string that
</span></span></span><span class="line"><span class="cl"><span class="s2">spans multiple lines.&#34;&#34;&#34;</span>
</span></span></code></pre></div><p>å­—ç¬¦ä¸²æ”¯æŒä¸€äº›å¸¸ç”¨çš„æ“ä½œï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>
<p>æ‹¼æ¥å­—ç¬¦ä¸²ï¼šä½¿ç”¨åŠ å·ï¼ˆ<code>+</code>ï¼‰è¿ç®—ç¬¦</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">str4</span> <span class="o">=</span> <span class="n">str1</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">str2</span>
</span></span><span class="line"><span class="cl"><span class="c1"># str4 = &#39;Hello, world! Hello, Python!&#39;</span>
</span></span></code></pre></div></li>
<li>
<p>è®¿é—®å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ï¼šä½¿ç”¨ <code>ä¸‹æ ‡ï¼ˆç´¢å¼•ï¼‰</code>è¿ç®—ç¬¦æˆ–åˆ‡ç‰‡è¿ç®—ç¬¦</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">ch</span> <span class="o">=</span> <span class="n">str1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>   <span class="c1"># ch = &#39;H&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">substr</span> <span class="o">=</span> <span class="n">str2</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">13</span><span class="p">]</span>  <span class="c1"># substr = &#39;Python&#39;</span>
</span></span></code></pre></div></li>
<li>
<p>è·å–å­—ç¬¦ä¸²çš„é•¿åº¦ï¼šä½¿ç”¨<code> len()</code> å‡½æ•°</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">str3</span><span class="p">)</span>   <span class="c1"># length = 45</span>
</span></span></code></pre></div></li>
<li>
<p>æŸ¥æ‰¾å­å­—ç¬¦ä¸²ï¼šä½¿ç”¨ <code>find()</code> æˆ– index() å‡½æ•°</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pos1</span> <span class="o">=</span> <span class="n">str1</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;world&#39;</span><span class="p">)</span>   <span class="c1"># pos1 = 7</span>
</span></span><span class="line"><span class="cl"><span class="n">pos2</span> <span class="o">=</span> <span class="n">str2</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Python&#39;</span><span class="p">)</span> <span class="c1"># pos2 = 7</span>
</span></span></code></pre></div></li>
<li>
<p>æ›¿æ¢å­å­—ç¬¦ä¸²ï¼šä½¿ç”¨ <code>replace()</code> å‡½æ•°</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">new_str</span> <span class="o">=</span> <span class="n">str1</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;world&#39;</span><span class="p">,</span> <span class="s1">&#39;Python&#39;</span><span class="p">)</span>   <span class="c1"># new_str = &#39;Hello, Python!&#39;</span>
</span></span></code></pre></div></li>
<li>
<p>åˆ†å‰²å­—ç¬¦ä¸²ï¼šä½¿ç”¨ <code>split()</code> å‡½æ•°</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">words</span> <span class="o">=</span> <span class="n">str3</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>   <span class="c1"># words = [&#39;This&#39;, &#39;is&#39;, &#39;a&#39;, &#39;long&#39;, &#39;string&#39;, &#39;that&#39;, &#39;spans&#39;, &#39;multiple&#39;, &#39;lines.&#39;]</span>
</span></span></code></pre></div></li>
<li>
<p>è¿æ¥å­—ç¬¦ä¸²åˆ—è¡¨ï¼šä½¿ç”¨ <code>join()</code> å‡½æ•°</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">new_str</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>   <span class="c1"># new_str = &#39;This-is-a-long-string-that-spans-multiple-lines.&#39;</span>
</span></span></code></pre></div></li>
<li>
<p>åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦åŒ…å«æŸä¸ªå­å­—ç¬¦ä¸²ï¼šä½¿ç”¨ <code>in</code> æˆ– <code>not in</code> è¿ç®—ç¬¦</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">flag1</span> <span class="o">=</span> <span class="s1">&#39;world&#39;</span> <span class="ow">in</span> <span class="n">str1</span>   <span class="c1"># flag1 = True</span>
</span></span><span class="line"><span class="cl"><span class="n">flag2</span> <span class="o">=</span> <span class="s1">&#39;Python&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">str2</span>   <span class="c1"># flag2 = False</span>
</span></span></code></pre></div></li>
<li>
<p>åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä»¥æŸä¸ªå­å­—ç¬¦ä¸²å¼€å¤´æˆ–ç»“å°¾ï¼šä½¿ç”¨ <code>startswith()</code> å’Œ <code>endswith()</code> æ–¹æ³•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">flag3</span> <span class="o">=</span> <span class="n">str1</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Hello&#39;</span><span class="p">)</span>   <span class="c1"># flag3 = True</span>
</span></span><span class="line"><span class="cl"><span class="n">flag4</span> <span class="o">=</span> <span class="n">str2</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">)</span>   <span class="c1"># flag4 = True</span>
</span></span></code></pre></div></li>
<li>
<p>å¤§å°å†™è½¬æ¢ï¼šä½¿ç”¨ <code>upper()</code> å’Œ <code>lower()</code> æ–¹æ³•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">upper_str</span> <span class="o">=</span> <span class="n">str1</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>   <span class="c1"># upper_str = &#39;HELLO, WORLD!&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">lower_str</span> <span class="o">=</span> <span class="n">str2</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>   <span class="c1"># lower_str = &#39;hello, python!&#39;</span>
</span></span></code></pre></div></li>
<li>
<p>å»é™¤å­—ç¬¦ä¸²ä¸¤ç«¯çš„ç©ºç™½å­—ç¬¦ï¼šä½¿ç”¨ <code>strip()</code>ã€<code>lstrip()</code> å’Œ <code>rstrip()</code> æ–¹æ³•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">str5</span> <span class="o">=</span> <span class="s1">&#39;  Hello, Python!  &#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">new_str1</span> <span class="o">=</span> <span class="n">str5</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>   <span class="c1"># new_str1 = &#39;Hello, Python!&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">new_str2</span> <span class="o">=</span> <span class="n">str5</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>   <span class="c1"># new_str2 = &#39;Hello, Python!  &#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">new_str3</span> <span class="o">=</span> <span class="n">str5</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>   <span class="c1"># new_str3 = &#39;  Hello, Python!&#39;</span>
</span></span></code></pre></div></li>
<li>
<p>å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—ç±»å‹ï¼šä½¿ç”¨ <code>int()</code>ã€<code>float()</code> æˆ– <code>complex()</code> å‡½æ•°</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">num1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s1">&#39;123&#39;</span><span class="p">)</span>   <span class="c1"># num1 = 123</span>
</span></span><span class="line"><span class="cl"><span class="n">num2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;3.14&#39;</span><span class="p">)</span>   <span class="c1"># num2 = 3.14</span>
</span></span><span class="line"><span class="cl"><span class="n">num3</span> <span class="o">=</span> <span class="nb">complex</span><span class="p">(</span><span class="s1">&#39;1+2j&#39;</span><span class="p">)</span>   <span class="c1"># num3 = (1+2j)</span>
</span></span></code></pre></div></li>
<li>
<p>åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦å…¨éƒ¨ç”±æ•°å­—ç»„æˆï¼šä½¿ç”¨ <code>isnumeric()</code> æ–¹æ³•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">str6</span> <span class="o">=</span> <span class="s1">&#39;123456&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">flag5</span> <span class="o">=</span> <span class="n">str6</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()</span>   <span class="c1"># flag5 = True</span>
</span></span></code></pre></div></li>
<li>
<p>åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦å…¨éƒ¨ç”±å­—æ¯ç»„æˆï¼šä½¿ç”¨ <code>isalpha()</code> æ–¹æ³•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">str7</span> <span class="o">=</span> <span class="s1">&#39;HelloWorld&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">flag6</span> <span class="o">=</span> <span class="n">str7</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()</span>   <span class="c1"># flag6 = True</span>
</span></span></code></pre></div></li>
<li>
<p>åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦å…¨éƒ¨ç”±å­—æ¯å’Œæ•°å­—ç»„æˆï¼šä½¿ç”¨ <code>isalnum()</code> æ–¹æ³•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">str8</span> <span class="o">=</span> <span class="s1">&#39;Hello123&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">flag7</span> <span class="o">=</span> <span class="n">str8</span><span class="o">.</span><span class="n">isalnum</span><span class="p">()</span>   <span class="c1"># flag7 = True</span>
</span></span></code></pre></div></li>
<li>
<p>è®¡ç®—å­—ç¬¦ä¸²ä¸­æŸä¸ªå­—ç¬¦å‡ºç°çš„æ¬¡æ•°ï¼šä½¿ç”¨ <code>count()</code> æ–¹æ³•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">str9</span> <span class="o">=</span> <span class="s1">&#39;Hello, Python!&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">count</span> <span class="o">=</span> <span class="n">str9</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>   <span class="c1"># count = 2</span>
</span></span></code></pre></div></li>
<li>
<p>å°†å­—ç¬¦ä¸²æŒ‰æŒ‡å®šçš„å®½åº¦è¿›è¡Œå¯¹é½ï¼šä½¿ç”¨ <code>ljust()</code>ã€<code>rjust()</code> å’Œ <code>center()</code> æ–¹</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">str10</span> <span class="o">=</span> <span class="s1">&#39;Hello&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">new_str4</span> <span class="o">=</span> <span class="n">str10</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>   <span class="c1"># new_str4 = &#39;Hello     &#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">new_str5</span> <span class="o">=</span> <span class="n">str10</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>   <span class="c1"># new_str5 = &#39;     Hello&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">new_str6</span> <span class="o">=</span> <span class="n">str10</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>   <span class="c1"># new_str6 = &#39;  Hello   &#39;</span>
</span></span></code></pre></div></li>
<li>
<p>å°†å­—ç¬¦ä¸²ä¸­çš„æŸä¸ªå­å­—ç¬¦ä¸²æ›¿æ¢ä¸ºå¦ä¸€ä¸ªå­—ç¬¦ä¸²ï¼šä½¿ç”¨ <code>translate()</code> æ–¹æ³•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">str11</span> <span class="o">=</span> <span class="s1">&#39;Hello, Python!&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">table</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">maketrans</span><span class="p">(</span><span class="s1">&#39;lo&#39;</span><span class="p">,</span> <span class="s1">&#39;12&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">new_str7</span> <span class="o">=</span> <span class="n">str11</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>   <span class="c1"># new_str7 = &#39;He22, Pyth2n!&#39;</span>
</span></span></code></pre></div><blockquote>
<p>è¿™æ®µä»£ç ä½¿ç”¨äº†å­—ç¬¦ä¸²çš„ translate() æ–¹æ³•ï¼Œç”¨äºå°†å­—ç¬¦ä¸²ä¸­çš„æŸä¸ªå­å­—ç¬¦ä¸²æ›¿æ¢ä¸ºå¦ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒçš„ä½œç”¨æ˜¯å°†å­—ç¬¦ä¸² str11 ä¸­çš„æ‰€æœ‰å­—ç¬¦ &rsquo;l&rsquo; æ›¿æ¢ä¸º &lsquo;1&rsquo;ï¼Œå°†æ‰€æœ‰å­—ç¬¦ &lsquo;o&rsquo; æ›¿æ¢ä¸º &lsquo;2&rsquo;ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸² new_str7ã€‚</p>
<p>è¿™é‡Œç”¨åˆ°äº† str.maketrans() æ–¹æ³•ï¼Œå®ƒç”¨äºç”Ÿæˆä¸€ä¸ªè½¬æ¢è¡¨ï¼Œå°†å­—ç¬¦ä¸²ä¸­çš„æŸäº›å­—ç¬¦è½¬æ¢ä¸ºå…¶ä»–å­—ç¬¦ã€‚è¿™ä¸ªæ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸¤ä¸ªå‚æ•°éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯éœ€è¦è¢«æ›¿æ¢çš„å­—ç¬¦ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ›¿æ¢ä¸ºçš„å­—ç¬¦ã€‚ç”Ÿæˆçš„è½¬æ¢è¡¨å¯ä»¥ç”¨äºå­—ç¬¦ä¸²çš„ translate() æ–¹æ³•ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼Œè¿™é‡Œçš„ä»£ç ä½¿ç”¨ str.maketrans(&rsquo;lo&rsquo;, &lsquo;12&rsquo;) ç”Ÿæˆäº†ä¸€ä¸ªè½¬æ¢è¡¨ï¼Œå°†å­—ç¬¦ &rsquo;l&rsquo; è½¬æ¢ä¸º &lsquo;1&rsquo;ï¼Œå°†å­—ç¬¦ &lsquo;o&rsquo; è½¬æ¢ä¸º &lsquo;2&rsquo;ã€‚ç„¶åä½¿ç”¨ translate() æ–¹æ³•å°†å­—ç¬¦ä¸² str11 ä¸­çš„å­—ç¬¦æŒ‰ç…§è½¬æ¢è¡¨è¿›è¡Œæ›¿æ¢ï¼Œç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸² new_str7ï¼Œå®ƒçš„å€¼ä¸º &lsquo;He22, Pyth2n!&rsquo;ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>è¿™ç§å­—ç¬¦ä¸²çš„æ›¿æ¢æ–¹å¼åªæ˜¯æŒ‰ç…§å­—ç¬¦è¿›è¡Œæ›¿æ¢ï¼Œä¸æ˜¯æŒ‰ç…§å­å­—ç¬¦ä¸²è¿›è¡Œæ›¿æ¢</strong>ã€‚å¦‚æœéœ€è¦æŒ‰ç…§å­å­—ç¬¦ä¸²è¿›è¡Œæ›¿æ¢ï¼Œå¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²çš„ replace() æ–¹æ³•ã€‚</p>
</blockquote>
</li>
<li>
<p>å°†å­—ç¬¦ä¸²ä»å·¦ä¾§æˆ–å³ä¾§å¡«å……æŒ‡å®šçš„å­—ç¬¦ï¼šä½¿ç”¨<code> lstrip()</code> å’Œ <code>rstrip() </code>æ–¹æ³•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">str12</span> <span class="o">=</span> <span class="s1">&#39;Hello&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">new_str8</span> <span class="o">=</span> <span class="n">str12</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>   <span class="c1"># new_str8 = &#39;ello&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">new_str9</span> <span class="o">=</span> <span class="n">str12</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>   <span class="c1"># new_str9 = &#39;Hell&#39;</span>
</span></span></code></pre></div></li>
</ul>
<p>Python ä¸­å­—ç¬¦ä¸²çš„çŸ¥è¯†ç‚¹è¿˜æœ‰å¾ˆå¤šï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š</p>
<ul>
<li>
<p>æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼šPython 3.6 ä»¥åçš„ç‰ˆæœ¬æ”¯æŒ <code>f-string</code>ï¼Œå¯ä»¥åœ¨å­—ç¬¦ä¸²ä¸­ç›´æ¥ä½¿ç”¨è¡¨è¾¾å¼å’Œå˜é‡ï¼Œéå¸¸æ–¹ä¾¿ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;John&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">age</span> <span class="o">=</span> <span class="mi">25</span>
</span></span><span class="line"><span class="cl"><span class="n">greeting</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;My name is </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">, and I am </span><span class="si">{</span><span class="n">age</span><span class="si">}</span><span class="s1"> years old.&#39;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># greeting = &#39;My name is John, and I am 25 years old.&#39;</span>
</span></span></code></pre></div></li>
<li>
<p>å­—ç¬¦ä¸²çš„æ ¼å¼åŒ–è¾“å‡ºï¼šPython ä¸­çš„ <code>format()</code> æ–¹æ³•å¯ä»¥å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ ¼å¼åŒ–è¾“å‡ºï¼Œæ”¯æŒå„ç§æ ¼å¼æ§åˆ¶ç¬¦å’Œå ä½ç¬¦ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pi</span> <span class="o">=</span> <span class="mf">3.141592653589793</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;pi = </span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pi</span><span class="p">))</span>   <span class="c1"># è¾“å‡º &#39;pi = 3.14&#39;</span>
</span></span></code></pre></div></li>
<li>
<p>æ­£åˆ™è¡¨è¾¾å¼ï¼šPython ä¸­å†…ç½®äº† <code>re</code> æ¨¡å—ï¼Œå¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œå­—ç¬¦ä¸²åŒ¹é…å’Œæ›¿æ¢æ“ä½œï¼Œéå¸¸å¼ºå¤§ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">str13</span> <span class="o">=</span> <span class="s1">&#39;Hello, world!&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;w\w+&#39;</span>
</span></span><span class="line"><span class="cl"><span class="k">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">str13</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="k">match</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="k">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>   <span class="c1"># è¾“å‡º &#39;world&#39;</span>
</span></span></code></pre></div></li>
<li>
<p>å­—ç¬¦ä¸²çš„ç¼–ç å’Œè§£ç ï¼šPython ä¸­çš„å­—ç¬¦ä¸²æ˜¯ <code>Unicode</code> å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä½¿ç”¨ <code>encode()</code> æ–¹æ³•å°†å­—ç¬¦ä¸²ç¼–ç æˆå­—èŠ‚ä¸²ï¼Œä½¿ç”¨ <code>decode()</code> æ–¹æ³•å°†å­—èŠ‚ä¸²è§£ç æˆå­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">str14</span> <span class="o">=</span> <span class="s1">&#39;ä½ å¥½ï¼Œä¸–ç•Œï¼&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">utf8_bytes</span> <span class="o">=</span> <span class="n">str14</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">gb2312_bytes</span> <span class="o">=</span> <span class="n">str14</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;gb2312&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">utf8_str</span> <span class="o">=</span> <span class="n">utf8_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">gb2312_str</span> <span class="o">=</span> <span class="n">gb2312_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;gb2312&#39;</span><span class="p">)</span>
</span></span></code></pre></div></li>
<li>
<p>å­—ç¬¦ä¸²çš„æ¯”è¾ƒå’Œæ’åºï¼šPython ä¸­çš„å­—ç¬¦ä¸²å¯ä»¥è¿›è¡Œæ¯”è¾ƒå’Œæ’åºæ“ä½œï¼Œä½¿ç”¨çš„æ˜¯æŒ‰ç…§ <code>Unicode</code> ç ç‚¹è¿›è¡Œæ¯”è¾ƒå’Œæ’åºçš„è§„åˆ™ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">str_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;world&#39;</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="s1">&#39;Python&#39;</span><span class="p">,</span> <span class="s1">&#39;java&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">str_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">str_list</span><span class="p">)</span>   <span class="c1"># è¾“å‡º [&#39;Python&#39;, &#39;hello&#39;, &#39;java&#39;, &#39;world&#39;]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¯¹åˆ—è¡¨è¿›è¡Œé™åºæ’åº</span>
</span></span><span class="line"><span class="cl"><span class="n">str_list</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">str_list</span><span class="p">)</span>   <span class="c1"># è¾“å‡º [&#39;world&#39;, &#39;java&#39;, &#39;hello&#39;, &#39;Python&#39;]</span>
</span></span></code></pre></div></li>
</ul>
<blockquote>
<p>è¿™æ®µä»£ç ç”¨äºå¯¹ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨è¿›è¡Œæ’åºï¼Œå®ƒä½¿ç”¨äº†åˆ—è¡¨çš„ <code>sort()</code> æ–¹æ³•ï¼Œå°†åˆ—è¡¨ä¸­çš„å…ƒç´ æŒ‰ç…§ä¸€å®šçš„è§„åˆ™è¿›è¡Œæ’åºã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒçš„ä½œç”¨æ˜¯å°†å­—ç¬¦ä¸²åˆ—è¡¨ <code>str_list</code> æŒ‰ç…§å­—å…¸åºè¿›è¡Œå‡åºæ’åºï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„æ’åºåçš„åˆ—è¡¨ã€‚</p>
<p>åœ¨ Python ä¸­ï¼Œå­—ç¬¦ä¸²æ˜¯å¯ä»¥è¿›è¡Œæ¯”è¾ƒæ“ä½œçš„ï¼Œæ¯”è¾ƒçš„è§„åˆ™æ˜¯æŒ‰ç…§ Unicode ç ç‚¹è¿›è¡Œæ¯”è¾ƒã€‚å› æ­¤ï¼Œå¯¹äºå­—ç¬¦ä¸²åˆ—è¡¨çš„æ’åºï¼Œå®é™…ä¸Šå°±æ˜¯æŒ‰ç…§å­—ç¬¦ä¸²çš„å­—å…¸åºè¿›è¡Œæ’åºã€‚å…·ä½“æ¥è¯´ï¼Œå¯¹äºä¸¤ä¸ªå­—ç¬¦ä¸² s1 å’Œ s2ï¼ŒæŒ‰ç…§å­—å…¸åºè¿›è¡Œæ¯”è¾ƒçš„è§„åˆ™æ˜¯ï¼š</p>
<ul>
<li>å¦‚æœ s1 åœ¨ s2 çš„å‰é¢ï¼Œåˆ™ s1 &lt; s2ï¼›</li>
<li>å¦‚æœ s1 åœ¨ s2 çš„åé¢ï¼Œåˆ™ s1 &gt; s2ï¼›</li>
<li>å¦‚æœ s1 å’Œ s2 ç›¸ç­‰ï¼Œåˆ™ s1 == s2ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œå¯¹äºè¿™æ®µä»£ç ä¸­çš„å­—ç¬¦ä¸²åˆ—è¡¨ str_listï¼Œå®ƒçš„æ’åºç»“æœä¸º [&lsquo;Python&rsquo;, &lsquo;hello&rsquo;, &lsquo;java&rsquo;, &lsquo;world&rsquo;]ï¼Œå…¶ä¸­ &lsquo;Python&rsquo; åœ¨å­—å…¸åºä¸­æ’åœ¨æœ€å‰é¢ï¼Œ&lsquo;world&rsquo; åœ¨å­—å…¸åºä¸­æ’åœ¨æœ€åé¢ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆ—è¡¨çš„ <code>sort()</code> æ–¹æ³•ä¼šç›´æ¥ä¿®æ”¹åŸæœ‰çš„åˆ—è¡¨ï¼Œå¦‚æœä¸æƒ³ä¿®æ”¹åŸæœ‰åˆ—è¡¨ï¼Œå¯ä»¥ä½¿ç”¨ <code>sorted() </code>å‡½æ•°ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">str_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;world&#39;</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="s1">&#39;Python&#39;</span><span class="p">,</span> <span class="s1">&#39;java&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">new_str_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">str_list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">new_str_list</span><span class="p">)</span>   <span class="c1"># è¾“å‡º [&#39;Python&#39;, &#39;hello&#39;, &#39;java&#39;, &#39;world&#39;]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¯¹åˆ—è¡¨ç”Ÿæˆå™¨è¿›è¡Œé™åºæ’åº</span>
</span></span><span class="line"><span class="cl"><span class="n">new_str_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">str_list</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">new_str_list</span><span class="p">)</span>   <span class="c1"># è¾“å‡º [&#39;world&#39;, &#39;java&#39;, &#39;hello&#39;, &#39;Python&#39;]</span>
</span></span></code></pre></div><p>è¿™æ ·åšå¯ä»¥ç”Ÿæˆä¸€ä¸ªæ–°çš„æ’åºåçš„åˆ—è¡¨ï¼Œä¸ä¼šä¿®æ”¹åŸæœ‰çš„åˆ—è¡¨ã€‚</p>
</blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>ç”±äºå­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼Œå› æ­¤å¯¹å­—ç¬¦ä¸²è¿›è¡Œä¿®æ”¹ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ã€‚</strong></p>
<h2 id="åˆ—è¡¨">åˆ—è¡¨</h2>
<p>åœ¨ Python ä¸­ï¼Œåˆ—è¡¨ï¼ˆlistï¼‰æ˜¯ä¸€ç§å¯å˜åºåˆ—ç±»å‹ï¼Œç”¨äºå­˜å‚¨ä¸€ç»„æœ‰åºçš„å…ƒç´ ã€‚åˆ—è¡¨ä¸­çš„å…ƒç´ å¯ä»¥æ˜¯ä»»æ„ç±»å‹çš„æ•°æ®ï¼ŒåŒ…æ‹¬æ•°å­—ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ã€åˆ—è¡¨ã€å…ƒç»„ã€å­—å…¸ç­‰ã€‚åˆ—è¡¨ä½¿ç”¨æ–¹æ‹¬å· [] è¡¨ç¤ºï¼Œå…ƒç´ ä¹‹é—´ä½¿ç”¨é€—å·åˆ†éš”ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&#34;hello&#34;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">{</span><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Alice&#34;</span><span class="p">,</span> <span class="s2">&#34;age&#34;</span><span class="p">:</span> <span class="mi">20</span><span class="p">}]</span>
</span></span></code></pre></div><p>åˆ—è¡¨ä¸­çš„å…ƒç´ å¯ä»¥é€šè¿‡ç´¢å¼•ï¼ˆä¸‹æ ‡ï¼‰è¿›è¡Œè®¿é—®å’Œä¿®æ”¹ã€‚åˆ—è¡¨çš„ç´¢å¼•ä» 0 å¼€å§‹ï¼Œå¯ä»¥ä½¿ç”¨æ­£æ•´æ•°å’Œè´Ÿæ•´æ•°æ¥è¡¨ç¤ºã€‚æ­£æ•´æ•°è¡¨ç¤ºä»å·¦å¾€å³æ•°çš„ç´¢å¼•ï¼Œè´Ÿæ•´æ•°è¡¨ç¤ºä»å³å¾€å·¦æ•°çš„ç´¢å¼•ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>     <span class="c1"># è¾“å‡º 1ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ä¸º 0</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>    <span class="c1"># è¾“å‡º 5ï¼Œæœ€åä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ä¸º -1</span>
</span></span></code></pre></div><p>å¯ä»¥ä½¿ç”¨åˆ‡ç‰‡è¿ç®—ç¬¦ <code>:</code> æ¥è·å–åˆ—è¡¨çš„å­åˆ—è¡¨ã€‚åˆ‡ç‰‡è¿ç®—ç¬¦è¡¨ç¤ºä»èµ·å§‹ç´¢å¼•åˆ°ç»ˆæ­¢ç´¢å¼•ä¹‹é—´çš„æ‰€æœ‰å…ƒç´ ï¼Œä¸åŒ…æ‹¬ç»ˆæ­¢ç´¢å¼•å¯¹åº”çš„å…ƒç´ ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_list</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>   <span class="c1"># è¾“å‡º [2, 3]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_list</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>    <span class="c1"># è¾“å‡º [1, 2, 3]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_list</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span>    <span class="c1"># è¾“å‡º [4, 5]</span>
</span></span></code></pre></div><p>åˆ—è¡¨æ˜¯ä¸€ç§å¯å˜ç±»å‹ï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•å’Œåˆ‡ç‰‡æ“ä½œæ¥ä¿®æ”¹åˆ—è¡¨ä¸­çš„å…ƒç´ ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨åˆ—è¡¨çš„æ–¹æ³•æ¥æ·»åŠ ã€åˆ é™¤å’Œä¿®æ”¹å…ƒç´ ã€‚å¸¸ç”¨çš„åˆ—è¡¨æ–¹æ³•åŒ…æ‹¬ï¼š</p>
<ul>
<li><code>append(x)</code>ï¼šåœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ å…ƒç´  xã€‚</li>
<li><code>insert(i, x)</code>ï¼šåœ¨åˆ—è¡¨çš„ç¬¬ i ä¸ªä½ç½®æ’å…¥å…ƒç´  xã€‚</li>
<li><code>extend(iterable)</code>ï¼šåœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ å¯è¿­ä»£å¯¹è±¡ <code>iterable</code> ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚</li>
<li><code>remove(x)</code>ï¼šåˆ é™¤åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªå€¼ä¸º x çš„å…ƒç´ ã€‚</li>
<li><code>pop([i])</code>ï¼šåˆ é™¤åˆ—è¡¨ä¸­ç´¢å¼•ä¸º i çš„å…ƒç´ ï¼Œå¹¶è¿”å›è¯¥å…ƒç´ çš„å€¼ã€‚å¦‚æœçœç•¥ iï¼Œåˆ™é»˜è®¤åˆ é™¤æœ€åä¸€ä¸ªå…ƒç´ ã€‚</li>
<li><code>clear()</code>ï¼šåˆ é™¤åˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚</li>
<li><code>index(x)</code>ï¼šè¿”å›åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªå€¼ä¸º x çš„å…ƒç´ çš„ç´¢å¼•ã€‚å¦‚æœåˆ—è¡¨ä¸­ä¸å­˜åœ¨å€¼ä¸º x çš„å…ƒç´ ï¼Œåˆ™æŠ›å‡º <code>ValueError</code> å¼‚å¸¸ã€‚</li>
<li><code>count(x)</code>ï¼šè¿”å›åˆ—è¡¨ä¸­å€¼ä¸º x çš„å…ƒç´ çš„ä¸ªæ•°ã€‚</li>
<li><code>sort()</code>ï¼šå¯¹åˆ—è¡¨ä¸­çš„å…ƒç´ è¿›è¡Œæ’åºã€‚é»˜è®¤æŒ‰ç…§å‡åºæ’åˆ—ï¼Œå¯ä»¥ä½¿ç”¨ <code>reverse=True</code> å‚æ•°è¿›è¡Œé™åºæ’åˆ—ã€‚</li>
<li><code>reverse()</code>ï¼šå°†åˆ—è¡¨ä¸­çš„å…ƒç´ åè½¬ã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ <code>append() </code>æ–¹æ³•å‘åˆ—è¡¨ä¸­æ·»åŠ å…ƒç´ ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">my_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_list</span><span class="p">)</span>   <span class="c1"># è¾“å‡º [1, 2, 3, 4]</span>
</span></span></code></pre></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆ—è¡¨æ˜¯ä¸€ç§å¯å˜ç±»å‹ï¼Œä¿®æ”¹ä¸€ä¸ªåˆ—è¡¨ä¼šå½±å“åˆ°æ‰€æœ‰å¼•ç”¨è¯¥åˆ—è¡¨çš„å˜é‡ã€‚å¦‚æœéœ€è¦å¤åˆ¶ä¸€ä¸ªåˆ—è¡¨å¹¶ç‹¬ç«‹ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ <code>copy() </code>æ–¹æ³•æˆ–åˆ‡ç‰‡è¿ç®—ç¬¦è¿›è¡Œå¤åˆ¶ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">new_list</span> <span class="o">=</span> <span class="n">my_list</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>   <span class="c1"># å¤åˆ¶ä¸€ä¸ªæ–°çš„åˆ—è¡¨</span>
</span></span><span class="line"><span class="cl"><span class="n">new_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_list</span><span class="p">)</span>   <span class="c1"># è¾“å‡º [1, 2, 3]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">new_list</span><span class="p">)</span>  <span class="c1"># è¾“å‡º [1, 2, 3, 4]</span>
</span></span></code></pre></div><p>é™¤äº†ä¸Šé¢æåˆ°çš„åŸºæœ¬æ“ä½œå’Œå¸¸ç”¨æ–¹æ³•ï¼ŒPython åˆ—è¡¨è¿˜æœ‰ä¸€äº›å…¶ä»–çš„ç‰¹æ€§å’Œç”¨æ³•ï¼Œå¦‚ä¸‹ï¼š</p>
<ol>
<li>åˆ—è¡¨æ¨å¯¼å¼</li>
</ol>
<p>åˆ—è¡¨æ¨å¯¼å¼ï¼ˆlist comprehensionï¼‰æ˜¯ä¸€ç§å¿«é€Ÿåˆ›å»ºåˆ—è¡¨çš„æ–¹å¼ã€‚åˆ—è¡¨æ¨å¯¼å¼ç”±ä¸€å¯¹æ–¹æ‹¬å·å’Œä¸€ä¸ªè¡¨è¾¾å¼æ„æˆï¼Œè¡¨è¾¾å¼å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå¾ªç¯å’Œæ¡ä»¶è¯­å¥ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„åˆ—è¡¨æ¨å¯¼å¼ç”Ÿæˆäº†ä¸€ä¸ªåŒ…å« 1 åˆ° 10 çš„å¹³æ–¹å€¼çš„åˆ—è¡¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">squares</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">squares</span><span class="p">)</span>   <span class="c1"># è¾“å‡º [1, 4, 9, 16, 25, 36, 49, 64, 81, 100]</span>
</span></span></code></pre></div><ol start="2">
<li><code>zip()</code> å‡½æ•°</li>
</ol>
<p><code>zip()</code> å‡½æ•°ç”¨äºå°†å¤šä¸ªåˆ—è¡¨ä¸­å¯¹åº”ä½ç½®çš„å…ƒç´ åˆå¹¶æˆå…ƒç»„ã€‚<code>zip()</code> å‡½æ•°è¿”å›ä¸€ä¸ª zip å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ <code>tuple()</code> å‡½æ•°å°†å…¶è½¬æ¢ä¸ºå…ƒç»„åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;Alice&#34;</span><span class="p">,</span> <span class="s2">&#34;Bob&#34;</span><span class="p">,</span> <span class="s2">&#34;Charlie&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">ages</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">zipped</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">ages</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">zipped</span><span class="p">))</span>   <span class="c1"># è¾“å‡º [(&#39;Alice&#39;, 20), (&#39;Bob&#39;, 25), (&#39;Charlie&#39;, 30)]</span>
</span></span></code></pre></div><ol start="3">
<li>åˆ—è¡¨çš„å¤åˆ¶å’Œæµ…æ‹·è´</li>
</ol>
<p>å½“ä½¿ç”¨èµ‹å€¼è¯­å¥å°†ä¸€ä¸ªåˆ—è¡¨èµ‹å€¼ç»™å¦ä¸€ä¸ªå˜é‡æ—¶ï¼Œå®é™…ä¸Šæ˜¯å°†è¯¥åˆ—è¡¨çš„å¼•ç”¨èµ‹å€¼ç»™äº†æ–°å˜é‡ï¼Œä¸¤ä¸ªå˜é‡æŒ‡å‘åŒä¸€ä¸ªåˆ—è¡¨å¯¹è±¡ã€‚å¦‚æœä¿®æ”¹å…¶ä¸­ä¸€ä¸ªå˜é‡å¯¹åº”çš„åˆ—è¡¨ï¼Œå¦ä¸€ä¸ªå˜é‡ä¹Ÿä¼šå—åˆ°å½±å“ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>   <span class="c1"># è¾“å‡º [1, 2, 3, 4]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>   <span class="c1"># è¾“å‡º [1, 2, 3, 4]</span>
</span></span></code></pre></div><p>ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ <code>copy()</code> æ–¹æ³•æˆ–åˆ‡ç‰‡è¿ç®—ç¬¦è¿›è¡Œå¤åˆ¶ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§å¤åˆ¶æ–¹å¼åªæ˜¯è¿›è¡Œäº†æµ…æ‹·è´ï¼Œå³åªå¤åˆ¶äº†åˆ—è¡¨ä¸­çš„å…ƒç´ çš„å¼•ç”¨ï¼Œè€Œä¸æ˜¯å…ƒç´ æœ¬èº«ã€‚å¦‚æœåˆ—è¡¨ä¸­çš„å…ƒç´ æ˜¯å¯å˜å¯¹è±¡ï¼ˆå¦‚åˆ—è¡¨ã€å­—å…¸ç­‰ï¼‰ï¼Œä¿®æ”¹å…¶ä¸­ä¸€ä¸ªå…ƒç´ çš„å€¼ä¼šå½±å“åˆ°æ‰€æœ‰å¼•ç”¨è¯¥å…ƒç´ çš„å˜é‡ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>   <span class="c1"># è¾“å‡º [[1, 2, 3], [3, 4]]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>   <span class="c1"># è¾“å‡º [[1, 2, 3], [3, 4]]</span>
</span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œä¿®æ”¹ b ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¹Ÿå½±å“åˆ°äº† a ä¸­çš„å…ƒç´ ã€‚å¦‚æœéœ€è¦å®Œå…¨ç‹¬ç«‹çš„å¤åˆ¶ä¸€ä¸ªåˆ—è¡¨ï¼Œéœ€è¦ä½¿ç”¨æ·±æ‹·è´ï¼ˆdeep copyï¼‰æ–¹å¼ï¼Œå¯ä»¥ä½¿ç”¨ copy æ¨¡å—ä¸­çš„ <code>deepcopy()</code> å‡½æ•°ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">copy</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>   <span class="c1"># è¾“å‡º [[1, 2], [3, 4]]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>   <span class="c1"># è¾“å‡º [[1, 2, 3], [3, 4]]</span>
</span></span></code></pre></div><ol start="4">
<li>åˆ—è¡¨è§£åŒ…</li>
</ol>
<p>åˆ—è¡¨è§£åŒ…ï¼ˆlist unpackingï¼‰æ˜¯ä¸€ç§å¿«é€Ÿå°†åˆ—è¡¨ä¸­çš„å…ƒç´ åˆ†åˆ«èµ‹å€¼ç»™å¤šä¸ªå˜é‡çš„æ–¹å¼ã€‚åˆ—è¡¨è§£åŒ…ä½¿ç”¨ä¸€å¯¹æ–¹æ‹¬å·å’Œå¤šä¸ªå˜é‡åæ„æˆï¼Œå˜é‡åä¹‹é—´ä½¿ç”¨é€—å·åˆ†éš”ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">my_list</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>   <span class="c1"># è¾“å‡º 1 2 3</span>
</span></span></code></pre></div><ol start="5">
<li>åˆ—è¡¨çš„åˆ¤æ–­å’Œæ¯”è¾ƒ</li>
</ol>
<p>å¯ä»¥ä½¿ç”¨ <code>in</code> å’Œ <code>not in</code> è¿ç®—ç¬¦åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨åˆ—è¡¨ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>==</code> å’Œ <code>!=</code> è¿ç®—ç¬¦æ¯”è¾ƒä¸¤ä¸ªåˆ—è¡¨æ˜¯å¦ç›¸ç­‰ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="mi">2</span> <span class="ow">in</span> <span class="n">my_list</span><span class="p">)</span>    <span class="c1"># è¾“å‡º True</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="mi">4</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">my_list</span><span class="p">)</span>   <span class="c1"># è¾“å‡º True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">other_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_list</span> <span class="o">==</span> <span class="n">other_list</span><span class="p">)</span>   <span class="c1"># è¾“å‡º True</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_list</span> <span class="ow">is</span> <span class="n">other_list</span><span class="p">)</span>   <span class="c1"># è¾“å‡º Falseï¼Œä¸¤ä¸ªåˆ—è¡¨ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡</span>
</span></span></code></pre></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆ—è¡¨çš„æ¯”è¾ƒæ˜¯æŒ‰ç…§å…ƒç´ çš„é¡ºåºå’Œå€¼è¿›è¡Œçš„ï¼Œå¦‚æœä¸¤ä¸ªåˆ—è¡¨åŒ…å«ç›¸åŒçš„å…ƒç´ ä½†é¡ºåºä¸åŒï¼Œåˆ™å®ƒä»¬ä¸ç›¸ç­‰ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">)</span>   <span class="c1"># è¾“å‡º False</span>
</span></span></code></pre></div><ol start="6">
<li>åˆ—è¡¨çš„è¿­ä»£å’Œç”Ÿæˆå™¨</li>
</ol>
<p>å¯ä»¥ä½¿ç”¨ <code>for</code> å¾ªç¯å¯¹åˆ—è¡¨è¿›è¡Œè¿­ä»£ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åˆ—è¡¨æ¨å¯¼å¼æˆ–ç”Ÿæˆå™¨è¡¨è¾¾å¼ç”Ÿæˆä¸€ä¸ªç”Ÿæˆå™¨ï¼ˆgeneratorï¼‰ã€‚ç”Ÿæˆå™¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¿­ä»£å™¨ï¼Œå¯ä»¥é€ä¸ªäº§ç”Ÿåˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½æ•´ä¸ªåˆ—è¡¨åˆ°å†…å­˜ä¸­ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># åˆ—è¡¨è¿­ä»£</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">my_list</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ç”Ÿæˆå™¨è¡¨è¾¾å¼</span>
</span></span><span class="line"><span class="cl"><span class="n">gen</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">my_list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">gen</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span></code></pre></div><ol start="7">
<li>åˆ—è¡¨çš„é«˜çº§æ’åº</li>
</ol>
<p>é™¤äº† <code>sort() </code>æ–¹æ³•ä¹‹å¤–ï¼ŒPython è¿˜æä¾›äº†ä¸€äº›é«˜çº§çš„æ’åºæ–¹æ³•ï¼Œå¦‚ <code>sorted()</code> å‡½æ•°å’Œ <code>sort() </code>æ–¹æ³•çš„ key å‚æ•°å’Œ cmp å‚æ•°ã€‚sorted() å‡½æ•°å¯ä»¥å¯¹ä»»æ„å¯è¿­ä»£å¯¹è±¡è¿›è¡Œæ’åºï¼Œè¿”å›ä¸€ä¸ªæ–°çš„æœ‰åºåˆ—è¡¨ã€‚key å‚æ•°æŒ‡å®šä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œæ’åºï¼Œcmp å‚æ•°å¯ä»¥æŒ‡å®šä¸€ä¸ªæ¯”è¾ƒå‡½æ•°ï¼Œç”¨äºæ¯”è¾ƒä¸¤ä¸ªå…ƒç´ ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;apple&#34;</span><span class="p">,</span> <span class="s2">&#34;banana&#34;</span><span class="p">,</span> <span class="s2">&#34;orange&#34;</span><span class="p">,</span> <span class="s2">&#34;grape&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æŒ‰ç…§å­—ç¬¦ä¸²é•¿åº¦æ’åº</span>
</span></span><span class="line"><span class="cl"><span class="n">sorted_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">my_list</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">sorted_list</span><span class="p">)</span>   <span class="c1"># è¾“å‡º [&#39;apple&#39;, &#39;grape&#39;, &#39;banana&#39;, &#39;orange&#39;]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æŒ‰ç…§å­—æ¯é¡ºåºæ’åº</span>
</span></span><span class="line"><span class="cl"><span class="n">my_list</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_list</span><span class="p">)</span>   <span class="c1"># è¾“å‡º [&#39;apple&#39;, &#39;banana&#39;, &#39;grape&#39;, &#39;orange&#39;]</span>
</span></span></code></pre></div><h2 id="å…ƒç»„">å…ƒç»„</h2>
<p>åœ¨ Python ä¸­ï¼Œå…ƒç»„ï¼ˆtupleï¼‰æ˜¯ä¸€ç§ä¸å¯å˜çš„åºåˆ—ç±»å‹ï¼Œç”¨äºå­˜å‚¨ä¸€ç»„æœ‰åºçš„å¯¹è±¡ã€‚å…ƒç»„ä¸åˆ—è¡¨ç±»ä¼¼ï¼Œä½†å…ƒç»„ä¸€æ—¦åˆ›å»ºå°±ä¸èƒ½è¢«ä¿®æ”¹ï¼Œä¹Ÿæ²¡æœ‰æ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹ç­‰æ“ä½œçš„æ–¹æ³•ï¼Œå› æ­¤å…ƒç»„æ›´åŠ è½»é‡çº§ï¼Œè€Œä¸”æ›´åŠ å®‰å…¨ã€‚å…ƒç»„ä½¿ç”¨ä¸€å¯¹åœ†æ‹¬å·å’Œé€—å·åˆ†éš”çš„å¯¹è±¡åˆ—è¡¨æ„æˆï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span></span></code></pre></div><p>å¯ä»¥ä½¿ç”¨ç´¢å¼•å’Œåˆ‡ç‰‡è¿ç®—ç¬¦å¯¹å…ƒç»„è¿›è¡Œè®¿é—®å’Œåˆ‡ç‰‡ã€‚å…ƒç»„æ”¯æŒæ‰€æœ‰çš„åºåˆ—æ“ä½œï¼Œå¦‚ len()ã€inã€+ã€* ç­‰ã€‚å…ƒç»„ä¹Ÿå¯ä»¥åŒ…å«ä»»æ„ç±»å‹çš„å¯¹è±¡ï¼ŒåŒ…æ‹¬å…¶ä»–å…ƒç»„ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">t1</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&#34;apple&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">t2</span> <span class="o">=</span> <span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="s2">&#34;banana&#34;</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span>   <span class="c1"># è¾“å‡º ((&#39;apple&#39;, 1, True), &#39;banana&#39;, 2.5)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">t2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>   <span class="c1"># è¾“å‡º 1</span>
</span></span></code></pre></div><p>å…ƒç»„çš„ä¸å¯å˜æ€§å¯ä»¥ä¿è¯å…ƒç»„ä¸­çš„å¯¹è±¡ä¸ä¼šè¢«ä¿®æ”¹ï¼Œä»è€Œå¢å¼ºç¨‹åºçš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ã€‚å…ƒç»„é€šå¸¸ç”¨äºè¡¨ç¤ºä¸€äº›ä¸å¯å˜çš„æ•°æ®ï¼Œå¦‚åæ ‡ã€æ—¥æœŸã€æ—¶é—´ç­‰ã€‚å…ƒç»„ä¹Ÿå¯ä»¥ç”¨äºå‡½æ•°çš„è¿”å›å€¼ï¼Œå°†å¤šä¸ªå€¼æ‰“åŒ…æˆä¸€ä¸ªå…ƒç»„è¿”å›ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_rectangle_area_and_perimeter</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">area</span> <span class="o">=</span> <span class="n">length</span> <span class="o">*</span> <span class="n">width</span>
</span></span><span class="line"><span class="cl">    <span class="n">perimeter</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">length</span> <span class="o">+</span> <span class="n">width</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">area</span><span class="p">,</span> <span class="n">perimeter</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">area</span><span class="p">,</span> <span class="n">perimeter</span> <span class="o">=</span> <span class="n">get_rectangle_area_and_perimeter</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="n">perimeter</span><span class="p">)</span>   <span class="c1"># è¾“å‡º 50 30</span>
</span></span></code></pre></div><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå…ƒç»„ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œéœ€è¦åœ¨å…ƒç´ åé¢åŠ ä¸Šé€—å·ï¼Œå¦åˆ™ä¼šè¢«è§£é‡Šä¸ºå…¶ä»–ç±»å‹ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>   <span class="c1"># åŒ…å«ä¸€ä¸ªå…ƒç´ çš„å…ƒç»„</span>
</span></span><span class="line"><span class="cl"><span class="n">not_a_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># ä¸€ä¸ªæ•´æ•°ï¼Œè€Œä¸æ˜¯å…ƒç»„</span>
</span></span></code></pre></div><p>ä¸‹é¢æ˜¯ Python å…ƒç»„çš„ä¸€äº›å…¶ä»–ç‰¹æ€§å’Œç”¨æ³•ï¼š</p>
<ol>
<li>å…ƒç»„è§£åŒ…</li>
</ol>
<p>å’Œåˆ—è¡¨è§£åŒ…ç±»ä¼¼ï¼Œå¯ä»¥ä½¿ç”¨å…ƒç»„è§£åŒ…ï¼ˆtuple unpackingï¼‰å°†å…ƒç»„ä¸­çš„å…ƒç´ ä¾æ¬¡èµ‹å€¼ç»™å¤šä¸ªå˜é‡ï¼Œå˜é‡åä¹‹é—´ä½¿ç”¨é€—å·åˆ†éš”ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">my_tuple</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>   <span class="c1"># è¾“å‡º 1 2 3</span>
</span></span></code></pre></div><ol start="2">
<li>å…ƒç»„çš„æ¯”è¾ƒå’Œæ’åº</li>
</ol>
<p>å’Œåˆ—è¡¨ä¸€æ ·ï¼Œå…ƒç»„ä¹Ÿæ”¯æŒæ¯”è¾ƒè¿ç®—ç¬¦ï¼ˆ==ã€!=ã€&lt;ã€&lt;=ã€&gt;ã€&gt;=ï¼‰å’Œæ’åºæ–¹æ³•ï¼ˆsorted()ã€sort()ï¼‰ã€‚å…ƒç»„çš„æ¯”è¾ƒæ˜¯æŒ‰ç…§å…ƒç´ çš„é¡ºåºå’Œå€¼è¿›è¡Œçš„ï¼Œå¦‚æœä¸¤ä¸ªå…ƒç»„åŒ…å«ç›¸åŒçš„å…ƒç´ ä½†é¡ºåºä¸åŒï¼Œåˆ™å®ƒä»¬ä¸ç›¸ç­‰ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">)</span>   <span class="c1"># è¾“å‡º False</span>
</span></span></code></pre></div><ol start="3">
<li>å…ƒç»„ä½œä¸ºä¸å¯å˜å­—å…¸çš„é”®</li>
</ol>
<p>ç”±äºå…ƒç»„æ˜¯ä¸å¯å˜çš„ï¼Œå¯ä»¥ç”¨ä½œå­—å…¸çš„é”®ã€‚å¦‚æœè¦ä½¿ç”¨åˆ—è¡¨ä½œä¸ºå­—å…¸çš„é”®ï¼Œåˆ™éœ€è¦å…ˆå°†åˆ—è¡¨è½¬æ¢ä¸ºå…ƒç»„ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_dict</span> <span class="o">=</span> <span class="p">{(</span><span class="s2">&#34;apple&#34;</span><span class="p">,</span> <span class="s2">&#34;banana&#34;</span><span class="p">):</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="s2">&#34;orange&#34;</span><span class="p">,</span> <span class="s2">&#34;grape&#34;</span><span class="p">):</span> <span class="mi">2</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_dict</span><span class="p">[(</span><span class="s2">&#34;apple&#34;</span><span class="p">,</span> <span class="s2">&#34;banana&#34;</span><span class="p">)])</span>   <span class="c1"># è¾“å‡º 1</span>
</span></span></code></pre></div><ol start="4">
<li><code>*</code> è¿ç®—ç¬¦</li>
</ol>
<p>å¯ä»¥ä½¿ç”¨ <code>*</code> è¿ç®—ç¬¦å°†å¤šä¸ªå…ƒç»„åˆå¹¶æˆä¸€ä¸ªå…ƒç»„ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">t1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">t2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">t3</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">t1</span><span class="p">,</span> <span class="o">*</span><span class="n">t2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">t3</span><span class="p">)</span>   <span class="c1"># è¾“å‡º (1, 2, 3, 4, 5, 6)</span>
</span></span></code></pre></div><ol start="5">
<li>å…ƒç»„çš„ç”Ÿæˆå™¨</li>
</ol>
<p>å’Œåˆ—è¡¨ä¸€æ ·ï¼Œå…ƒç»„ä¹Ÿå¯ä»¥ä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼ç”Ÿæˆä¸€ä¸ªç”Ÿæˆå™¨ï¼ˆgeneratorï¼‰ã€‚ç”Ÿæˆå™¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¿­ä»£å™¨ï¼Œå¯ä»¥é€ä¸ªäº§ç”Ÿå…ƒç»„ä¸­çš„å…ƒç´ ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½æ•´ä¸ªå…ƒç»„åˆ°å†…å­˜ä¸­ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ç”Ÿæˆå™¨è¡¨è¾¾å¼</span>
</span></span><span class="line"><span class="cl"><span class="n">gen</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">my_tuple</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">gen</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="é›†åˆ">é›†åˆ</h2>
<p>Pythonä¸­çš„é›†åˆç±»å‹æ˜¯setï¼ˆé›†åˆï¼‰å’Œfrozensetï¼ˆä¸å¯å˜é›†åˆï¼‰ã€‚</p>
<p>setæ˜¯ä¸€ç§æ— åºã€å¯å˜çš„é›†åˆç±»å‹ï¼Œå…¶ä¸­ä¸å…è®¸æœ‰é‡å¤å…ƒç´ ã€‚å¯ä»¥ä½¿ç”¨å¤§æ‹¬å·<code>{}</code>æˆ–<code>set()</code>å‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªé›†åˆã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_set</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_set</span><span class="p">)</span>   <span class="c1"># è¾“å‡º {1, 2, 3}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">my_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_set</span><span class="p">)</span>   <span class="c1"># è¾“å‡º {1, 2, 3}</span>
</span></span></code></pre></div><p>å¯ä»¥ä½¿ç”¨add()æ–¹æ³•å‘é›†åˆä¸­æ·»åŠ å…ƒç´ ï¼Œä½¿ç”¨<code>remove()</code>æ–¹æ³•åˆ é™¤å…ƒç´ ã€‚å¯ä»¥ä½¿ç”¨<code>in</code>å…³é”®å­—æ¥æ£€æŸ¥å…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_set</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">my_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_set</span><span class="p">)</span>   <span class="c1"># è¾“å‡º {1, 2, 3, 4}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">my_set</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_set</span><span class="p">)</span>   <span class="c1"># è¾“å‡º {1, 3, 4}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="mi">2</span> <span class="ow">in</span> <span class="n">my_set</span><span class="p">)</span>   <span class="c1"># è¾“å‡º False</span>
</span></span></code></pre></div><p>é›†åˆæ”¯æŒå„ç§é›†åˆè¿ç®—ï¼Œå¦‚å¹¶é›†ã€äº¤é›†ã€å·®é›†ç­‰ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">set1</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">set2</span> <span class="o">=</span> <span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¹¶é›†</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">set1</span> <span class="o">|</span> <span class="n">set2</span><span class="p">)</span>   <span class="c1"># è¾“å‡º {1, 2, 3, 4, 5}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># äº¤é›†</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">set1</span> <span class="o">&amp;</span> <span class="n">set2</span><span class="p">)</span>   <span class="c1"># è¾“å‡º {3}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å·®é›†</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">set1</span> <span class="o">-</span> <span class="n">set2</span><span class="p">)</span>   <span class="c1"># è¾“å‡º {1, 2}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¯¹ç§°å·®é›†</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">set1</span> <span class="o">^</span> <span class="n">set2</span><span class="p">)</span>   <span class="c1"># è¾“å‡º {1, 2, 4, 5}</span>
</span></span></code></pre></div><p>frozensetæ˜¯ä¸€ç§ä¸å¯å˜çš„é›†åˆç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨<code>frozenset()</code>å‡½æ•°æ¥åˆ›å»ºã€‚frozensetå’Œsetå…·æœ‰ç›¸ä¼¼çš„æ“ä½œï¼Œä½†æ˜¯ä¸æ”¯æŒæ·»åŠ ã€åˆ é™¤å…ƒç´ ç­‰æ“ä½œã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_fset</span> <span class="o">=</span> <span class="nb">frozenset</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_fset</span><span class="p">)</span>   <span class="c1"># è¾“å‡º frozenset({1, 2, 3})</span>
</span></span></code></pre></div><p>ä¸‹é¢æ˜¯Pythonä¸­é›†åˆç±»å‹çš„ä¸€äº›å…¶ä»–ç‰¹æ€§å’Œç”¨æ³•ï¼š</p>
<ol>
<li>åˆ—è¡¨ã€å…ƒç»„è½¬æ¢ä¸ºé›†åˆ</li>
</ol>
<p>å¯ä»¥ä½¿ç”¨<code>set()</code>å‡½æ•°å°†åˆ—è¡¨æˆ–å…ƒç»„è½¬æ¢ä¸ºé›†åˆã€‚é›†åˆä¼šè‡ªåŠ¨å»é™¤é‡å¤å…ƒç´ ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">my_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">my_list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_set</span><span class="p">)</span>   <span class="c1"># è¾“å‡º {1, 2, 3}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">my_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">my_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">my_tuple</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_set</span><span class="p">)</span>   <span class="c1"># è¾“å‡º {4, 5, 6}</span>
</span></span></code></pre></div><ol start="2">
<li>é›†åˆçš„é•¿åº¦</li>
</ol>
<p>å¯ä»¥ä½¿ç”¨<code>len()</code>å‡½æ•°è·å–é›†åˆçš„é•¿åº¦ï¼ˆå³é›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°ï¼‰ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_set</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">my_set</span><span class="p">))</span>   <span class="c1"># è¾“å‡º 3</span>
</span></span></code></pre></div><ol start="3">
<li>é›†åˆçš„è¿­ä»£</li>
</ol>
<p>å¯ä»¥ä½¿ç”¨<code>for</code>å¾ªç¯è¿­ä»£é›†åˆä¸­çš„å…ƒç´ ã€‚ç”±äºé›†åˆæ˜¯æ— åºçš„ï¼Œæ¯æ¬¡è¿­ä»£çš„é¡ºåºå¯èƒ½ä¸åŒã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_set</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">my_set</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span></code></pre></div><ol start="4">
<li>é›†åˆè§£æ</li>
</ol>
<p>å’Œåˆ—è¡¨è§£æç±»ä¼¼ï¼Œå¯ä»¥ä½¿ç”¨é›†åˆè§£æï¼ˆset comprehensionï¼‰å¿«é€Ÿç”Ÿæˆä¸€ä¸ªé›†åˆã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_set</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">)}</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_set</span><span class="p">)</span>   <span class="c1"># è¾“å‡º {1, 2, 3, 4, 5}</span>
</span></span></code></pre></div><ol start="5">
<li>frozensetä½œä¸ºå­—å…¸é”®</li>
</ol>
<p>ç”±äº<code>frozenset</code>æ˜¯ä¸å¯å˜çš„ï¼Œå¯ä»¥ä½œä¸ºå­—å…¸çš„é”®ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_dict</span> <span class="o">=</span> <span class="p">{</span><span class="nb">frozenset</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">}):</span> <span class="s2">&#34;A&#34;</span><span class="p">,</span> <span class="nb">frozenset</span><span class="p">({</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">}):</span> <span class="s2">&#34;B&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_dict</span><span class="p">[</span><span class="nb">frozenset</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">})])</span>   <span class="c1"># è¾“å‡º &#34;A&#34;</span>
</span></span></code></pre></div><ol start="6">
<li>é›†åˆçš„ç±»å‹</li>
</ol>
<p>å¯ä»¥ä½¿ç”¨<code>type()</code>å‡½æ•°æŸ¥çœ‹é›†åˆçš„ç±»å‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>isinstance()</code>å‡½æ•°åˆ¤æ–­é›†åˆæ˜¯å¦å±äºæŸç§ç±»å‹ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_set</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">my_set</span><span class="p">))</span>   <span class="c1"># è¾“å‡º &lt;class &#39;set&#39;&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">my_set</span><span class="p">,</span> <span class="nb">set</span><span class="p">))</span>   <span class="c1"># è¾“å‡º True</span>
</span></span></code></pre></div><ol start="7">
<li>é›†åˆçš„å¤åˆ¶</li>
</ol>
<p>é›†åˆå¯ä»¥ä½¿ç”¨<code>copy()</code>æ–¹æ³•è¿›è¡Œå¤åˆ¶ã€‚å¤åˆ¶åçš„é›†åˆå’ŒåŸé›†åˆå…·æœ‰ä¸åŒçš„å†…å­˜åœ°å€ï¼Œäº’ä¸å½±å“ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_set</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">new_set</span> <span class="o">=</span> <span class="n">my_set</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">new_set</span><span class="p">)</span>   <span class="c1"># è¾“å‡º {1, 2, 3}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">new_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">new_set</span><span class="p">)</span>   <span class="c1"># è¾“å‡º {1, 2, 3, 4}</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_set</span><span class="p">)</span>    <span class="c1"># è¾“å‡º {1, 2, 3}</span>
</span></span></code></pre></div><ol start="8">
<li>é›†åˆçš„æ›´æ–°</li>
</ol>
<p>å¯ä»¥ä½¿ç”¨<code>update()</code>æ–¹æ³•å°†ä¸€ä¸ªé›†åˆçš„å…ƒç´ æ·»åŠ åˆ°å¦ä¸€ä¸ªé›†åˆä¸­ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">set1</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">set2</span> <span class="o">=</span> <span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">set1</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">set2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">set1</span><span class="p">)</span>   <span class="c1"># è¾“å‡º {1, 2, 3, 4, 5}</span>
</span></span></code></pre></div><ol start="9">
<li>é›†åˆçš„åˆ é™¤</li>
</ol>
<p>å¯ä»¥ä½¿ç”¨<code>discard()</code>æ–¹æ³•æˆ–<code>remove()</code>æ–¹æ³•æ¥åˆ é™¤é›†åˆä¸­çš„å…ƒç´ ã€‚å¦‚æœè¦åˆ é™¤çš„å…ƒç´ ä¸å­˜åœ¨ï¼Œ<code>discard()</code>æ–¹æ³•ä¸ä¼šæŠ¥é”™ï¼Œè€Œ<code>remove()</code>æ–¹æ³•ä¼šæŠ›å‡ºKeyErrorå¼‚å¸¸ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_set</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">my_set</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_set</span><span class="p">)</span>   <span class="c1"># è¾“å‡º {1, 3}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">my_set</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_set</span><span class="p">)</span>   <span class="c1"># è¾“å‡º {1}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">my_set</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>   <span class="c1"># ä¸ä¼šæŠ¥é”™</span>
</span></span><span class="line"><span class="cl"><span class="n">my_set</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>    <span class="c1"># æŠ›å‡ºKeyErrorå¼‚å¸¸</span>
</span></span></code></pre></div><ol start="10">
<li>é›†åˆçš„æ¸…ç©º</li>
</ol>
<p>å¯ä»¥ä½¿ç”¨<code>clear()</code>æ–¹æ³•æ¸…ç©ºé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_set</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">my_set</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_set</span><span class="p">)</span>   <span class="c1"># è¾“å‡º set()</span>
</span></span></code></pre></div><h2 id="å­—å…¸">å­—å…¸</h2>
<p>åœ¨Pythonä¸­ï¼Œå­—å…¸æ˜¯ä¸€ç§å¯å˜çš„æ•°æ®ç±»å‹ï¼Œç”¨äºå­˜å‚¨é”®-å€¼å¯¹ã€‚å­—å…¸ç”¨å¤§æ‹¬å·{}è¡¨ç¤ºï¼Œæ¯ä¸ªé”®å€¼å¯¹ä¹‹é—´ç”¨é€—å·åˆ†éš”ã€‚å­—å…¸ä¸­çš„é”®å¿…é¡»æ˜¯ä¸å¯å˜çš„ï¼Œå¦‚æ•´æ•°ã€å­—ç¬¦ä¸²æˆ–å…ƒç»„ï¼Œè€Œå€¼å¯ä»¥æ˜¯ä»»æ„çš„Pythonå¯¹è±¡ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„å­—å…¸ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;city&#39;</span><span class="p">:</span> <span class="s1">&#39;New York&#39;</span><span class="p">}</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œé”®&rsquo;name&rsquo;ã€&lsquo;age&rsquo;å’Œ&rsquo;city&rsquo;åˆ†åˆ«ä¸å€¼&rsquo;John&rsquo;ã€30å’Œ&rsquo;New York&rsquo;ç›¸å…³è”ã€‚å¯ä»¥ä½¿ç”¨é”®æ¥è®¿é—®å­—å…¸ä¸­çš„å€¼ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_dict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>  <span class="c1"># è¾“å‡ºï¼šJohn</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_dict</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">])</span>  <span class="c1"># è¾“å‡ºï¼š30</span>
</span></span></code></pre></div><p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨<code>dict()</code>å‡½æ•°ä»å…¶ä»–åºåˆ—æˆ–æ˜ å°„åˆ›å»ºå­—å…¸ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_dict2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Mary&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;city&#39;</span><span class="p">,</span> <span class="s1">&#39;Los Angeles&#39;</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_dict2</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºï¼š{&#39;name&#39;: &#39;Mary&#39;, &#39;age&#39;: 25, &#39;city&#39;: &#39;Los Angeles&#39;}</span>
</span></span></code></pre></div><p>å­—å…¸æ”¯æŒè®¸å¤šæœ‰ç”¨çš„æ–¹æ³•ï¼Œå¦‚<code>keys()</code>ã€<code>values()</code>å’Œ<code>items()</code>ï¼Œè¿™äº›æ–¹æ³•è¿”å›å­—å…¸çš„é”®ã€å€¼å’Œé”®-å€¼å¯¹çš„è§†å›¾ã€‚å­—å…¸çš„è§†å›¾å¯ç”¨äºæŒ‰ç…§ç‰¹å®šçš„é¡ºåºè®¿é—®å­—å…¸ä¸­çš„å…ƒç´ ï¼Œæˆ–å¯¹å­—å…¸è¿›è¡Œè¿­ä»£æ“ä½œã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># è·å–å­—å…¸çš„é”®åˆ—è¡¨</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">my_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>  <span class="c1"># è¾“å‡ºï¼š[&#39;name&#39;, &#39;age&#39;, &#39;city&#39;]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è·å–å­—å…¸çš„å€¼åˆ—è¡¨</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">my_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>  <span class="c1"># è¾“å‡ºï¼š[&#39;John&#39;, 30, &#39;New York&#39;]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è·å–å­—å…¸çš„é”®-å€¼å¯¹åˆ—è¡¨</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">my_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>  <span class="c1"># è¾“å‡ºï¼š[(&#39;name&#39;, &#39;John&#39;), (&#39;age&#39;, 30), (&#39;city&#39;, &#39;New York&#39;)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ä½¿ç”¨forå¾ªç¯è¿­ä»£å­—å…¸çš„é”®å’Œå€¼</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">my_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span></span></code></pre></div><p>ä»¥ä¸‹æ˜¯ä¸€äº›è¿›é˜¶çš„å­—å…¸æ“ä½œï¼š</p>
<ol>
<li>å‘å­—å…¸ä¸­æ·»åŠ æˆ–æ›´æ–°é”®å€¼å¯¹</li>
</ol>
<p>å¯ä»¥ä½¿ç”¨<code>[key]</code>ç´¢å¼•æˆ–<code>update()</code>æ–¹æ³•å‘å­—å…¸ä¸­æ·»åŠ æˆ–æ›´æ–°é”®å€¼å¯¹ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># æ·»åŠ æ–°çš„é”®å€¼å¯¹</span>
</span></span><span class="line"><span class="cl"><span class="n">my_dict</span><span class="p">[</span><span class="s1">&#39;gender&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;male&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_dict</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºï¼š{&#39;name&#39;: &#39;John&#39;, &#39;age&#39;: 30, &#39;city&#39;: &#39;New York&#39;, &#39;gender&#39;: &#39;male&#39;}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ›´æ–°ç°æœ‰çš„é”®å€¼å¯¹</span>
</span></span><span class="line"><span class="cl"><span class="n">my_dict</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_dict</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºï¼š{&#39;name&#39;: &#39;John&#39;, &#39;age&#39;: 40, &#39;city&#39;: &#39;New York&#39;, &#39;gender&#39;: &#39;male&#39;}</span>
</span></span></code></pre></div><p>å¯ä»¥ä½¿ç”¨<code>update()</code>æ–¹æ³•å°†ä¸€ä¸ªå­—å…¸åˆå¹¶åˆ°å¦ä¸€ä¸ªå­—å…¸ä¸­ã€‚å¦‚æœé”®ç›¸åŒï¼Œåˆ™åä¸€ä¸ªå­—å…¸çš„å€¼å°†è¦†ç›–å‰ä¸€ä¸ªå­—å…¸çš„å€¼ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;city&#39;</span><span class="p">:</span> <span class="s1">&#39;New York&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">my_dict2</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gender&#39;</span><span class="p">:</span> <span class="s1">&#39;male&#39;</span><span class="p">,</span> <span class="s1">&#39;country&#39;</span><span class="p">:</span> <span class="s1">&#39;USA&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">my_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">my_dict2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_dict</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºï¼š{&#39;name&#39;: &#39;John&#39;, &#39;age&#39;: 30, &#39;city&#39;: &#39;New York&#39;, &#39;gender&#39;: &#39;male&#39;, &#39;country&#39;: &#39;USA&#39;}</span>
</span></span></code></pre></div><ol start="2">
<li>åˆ é™¤å­—å…¸ä¸­çš„é”®å€¼å¯¹</li>
</ol>
<p>å¯ä»¥ä½¿ç”¨<code>del</code>è¯­å¥æˆ–<code>pop()</code>æ–¹æ³•ä»å­—å…¸ä¸­åˆ é™¤é”®å€¼å¯¹ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># ä½¿ç”¨delåˆ é™¤é”®å€¼å¯¹</span>
</span></span><span class="line"><span class="cl"><span class="k">del</span> <span class="n">my_dict</span><span class="p">[</span><span class="s1">&#39;gender&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_dict</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºï¼š{&#39;name&#39;: &#39;John&#39;, &#39;age&#39;: 40, &#39;city&#39;: &#39;New York&#39;}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ä½¿ç”¨popåˆ é™¤é”®å€¼å¯¹</span>
</span></span><span class="line"><span class="cl"><span class="n">my_dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_dict</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºï¼š{&#39;name&#39;: &#39;John&#39;, &#39;city&#39;: &#39;New York&#39;}</span>
</span></span></code></pre></div><ol start="3">
<li>ä½¿ç”¨<code>items()</code>æ–¹æ³•éå†å­—å…¸çš„é”®å€¼å¯¹</li>
</ol>
<p>å¯ä»¥ä½¿ç”¨<code>items()</code>æ–¹æ³•éå†å­—å…¸çš„é”®å€¼å¯¹ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;city&#39;</span><span class="p">:</span> <span class="s1">&#39;New York&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">my_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>items()</code>æ–¹æ³•è¿”å›ä¸€ä¸ªç”±é”®å€¼å¯¹ç»„æˆçš„å…ƒç»„ï¼Œç„¶åä½¿ç”¨<code>for</code>å¾ªç¯éå†è¿™ä¸ªå…ƒç»„å¹¶æ‰“å°å‡ºæ¯ä¸ªé”®å€¼å¯¹ã€‚</p>
<ol start="3">
<li>ä½¿ç”¨å­—å…¸æ¨å¯¼å¼åˆ›å»ºå­—å…¸</li>
</ol>
<p>å¯ä»¥ä½¿ç”¨å­—å…¸æ¨å¯¼å¼ä»å…¶ä»–åºåˆ—æˆ–å­—å…¸åˆ›å»ºæ–°çš„å­—å…¸ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># ä»åˆ—è¡¨åˆ›å»ºå­—å…¸</span>
</span></span><span class="line"><span class="cl"><span class="n">my_list</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;John&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;city&#39;</span><span class="p">,</span> <span class="s1">&#39;New York&#39;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">my_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">my_list</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_dict</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºï¼š{&#39;name&#39;: &#39;John&#39;, &#39;age&#39;: 30, &#39;city&#39;: &#39;New York&#39;}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ä»å¦ä¸€ä¸ªå­—å…¸åˆ›å»ºå­—å…¸</span>
</span></span><span class="line"><span class="cl"><span class="n">my_dict2</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gender&#39;</span><span class="p">:</span> <span class="s1">&#39;male&#39;</span><span class="p">,</span> <span class="s1">&#39;country&#39;</span><span class="p">:</span> <span class="s1">&#39;USA&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">my_dict3</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">my_dict</span><span class="p">,</span> <span class="o">**</span><span class="n">my_dict2</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_dict3</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºï¼š{&#39;name&#39;: &#39;John&#39;, &#39;age&#39;: 30, &#39;city&#39;: &#39;New York&#39;, &#39;gender&#39;: &#39;male&#39;, &#39;country&#39;: &#39;USA&#39;}</span>
</span></span></code></pre></div><ol start="4">
<li>ä½¿ç”¨<code>defaultdict</code>åˆ›å»ºé»˜è®¤å€¼å­—å…¸</li>
</ol>
<p><code>defaultdict</code>æ˜¯ä¸€ä¸ªå­—å…¸å­ç±»ï¼Œå®ƒå…è®¸æ‚¨æŒ‡å®šä¸€ä¸ªé»˜è®¤å€¼ï¼Œä»¥ä¾¿åœ¨è®¿é—®ä¸å­˜åœ¨çš„é”®æ—¶è¿”å›è¯¥å€¼ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">my_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># é»˜è®¤å€¼ä¸º0</span>
</span></span><span class="line"><span class="cl"><span class="n">my_dict</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_dict</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºï¼š{&#39;age&#39;: 1}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">my_dict2</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>  <span class="c1"># é»˜è®¤å€¼ä¸º[]</span>
</span></span><span class="line"><span class="cl"><span class="n">my_dict2</span><span class="p">[</span><span class="s1">&#39;names&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;John&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_dict2</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºï¼š{&#39;names&#39;: [&#39;John&#39;]}</span>
</span></span></code></pre></div><ol start="5">
<li>ä½¿ç”¨<code>sorted()</code>å‡½æ•°æŒ‰ç…§é”®æˆ–å€¼æ’åºå­—å…¸</li>
</ol>
<p>å¯ä»¥ä½¿ç”¨<code>sorted()</code>å‡½æ•°æŒ‰ç…§å­—å…¸çš„é”®æˆ–å€¼å¯¹å­—å…¸è¿›è¡Œæ’åºã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># æŒ‰ç…§é”®æ’åºå­—å…¸</span>
</span></span><span class="line"><span class="cl"><span class="n">my_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;city&#39;</span><span class="p">:</span> <span class="s1">&#39;New York&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">sorted_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">my_dict</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">sorted_dict</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºï¼š{&#39;age&#39;: 30, &#39;city&#39;: &#39;New York&#39;, &#39;name&#39;: &#39;John&#39;}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æŒ‰ç…§å€¼æ’åºå­—å…¸</span>
</span></span><span class="line"><span class="cl"><span class="n">my_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;city&#39;</span><span class="p">:</span> <span class="s1">&#39;New York&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">sorted_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">my_dict</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">sorted_dict</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºï¼š{&#39;age&#39;: 30, &#39;name&#39;: &#39;John&#39;, &#39;city&#39;: &#39;New York&#39;}</span>
</span></span></code></pre></div><ol start="6">
<li>ä½¿ç”¨<code>zip()</code>å‡½æ•°å°†ä¸¤ä¸ªåºåˆ—åˆå¹¶ä¸ºå­—å…¸</li>
</ol>
<p>å¯ä»¥ä½¿ç”¨<code>zip()</code>å‡½æ•°å°†ä¸¤ä¸ªåºåˆ—åˆå¹¶ä¸ºä¸€ä¸ªå­—å…¸ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;city&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;New York&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">my_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">values</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_dict</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºï¼š{&#39;name&#39;: &#39;John&#39;, &#39;age&#39;: 30, &#39;city&#39;: &#39;New York&#39;}</span>
</span></span></code></pre></div><ol start="7">
<li>ä½¿ç”¨<code>json</code>æ¨¡å—å°†å­—å…¸è½¬æ¢ä¸ºJSONæ ¼å¼</li>
</ol>
<p>å¯ä»¥ä½¿ç”¨<code>json</code>æ¨¡å—å°†Pythonå­—å…¸è½¬æ¢ä¸ºJSONæ ¼å¼çš„å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">my_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;city&#39;</span><span class="p">:</span> <span class="s1">&#39;New York&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">json_str</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">my_dict</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">json_str</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºï¼š{&#34;name&#34;: &#34;John&#34;, &#34;age&#34;: 30, &#34;city&#34;: &#34;New York&#34;}</span>
</span></span></code></pre></div><ol start="8">
<li>ä½¿ç”¨<code>pprint</code>æ¨¡å—æ‰“å°å‡ºæ¼‚äº®çš„å­—å…¸è¾“å‡º</li>
</ol>
<p>å¯ä»¥ä½¿ç”¨<code>pprint</code>æ¨¡å—æ‰“å°å‡ºæ¼‚äº®çš„ã€æ˜“äºé˜…è¯»çš„å­—å…¸è¾“å‡ºã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">my_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;city&#39;</span><span class="p">:</span> <span class="s1">&#39;New York&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">pprint</span><span class="p">(</span><span class="n">my_dict</span><span class="p">)</span>
</span></span></code></pre></div><ol start="9">
<li>ä½¿ç”¨<code>copy()</code>æ–¹æ³•æˆ–<code>dict()</code>æ„é€ å‡½æ•°åˆ›å»ºå­—å…¸å‰¯æœ¬</li>
</ol>
<p>å¯ä»¥ä½¿ç”¨<code>copy()</code>æ–¹æ³•æˆ–<code>dict()</code>æ„é€ å‡½æ•°åˆ›å»ºå­—å…¸çš„å‰¯æœ¬ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;city&#39;</span><span class="p">:</span> <span class="s1">&#39;New York&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">my_dict_copy</span> <span class="o">=</span> <span class="n">my_dict</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># ä½¿ç”¨copy()æ–¹æ³•åˆ›å»ºå‰¯æœ¬</span>
</span></span><span class="line"><span class="cl"><span class="n">my_dict_copy</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_dict</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºï¼š{&#39;name&#39;: &#39;John&#39;, &#39;age&#39;: 30, &#39;city&#39;: &#39;New York&#39;}</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_dict_copy</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºï¼š{&#39;name&#39;: &#39;John&#39;, &#39;age&#39;: 40, &#39;city&#39;: &#39;New York&#39;}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">my_dict2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">my_dict</span><span class="p">)</span>  <span class="c1"># ä½¿ç”¨dict()æ„é€ å‡½æ•°åˆ›å»ºå‰¯æœ¬</span>
</span></span><span class="line"><span class="cl"><span class="n">my_dict2</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Mary&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_dict</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºï¼š{&#39;name&#39;: &#39;John&#39;, &#39;age&#39;: 30, &#39;city&#39;: &#39;New York&#39;}</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_dict2</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºï¼š{&#39;name&#39;: &#39;Mary&#39;, &#39;age&#39;: 30, &#39;city&#39;: &#39;New York&#39;}</span>
</span></span></code></pre></div><ol start="10">
<li>ä½¿ç”¨<code>setdefault()</code>æ–¹æ³•è·å–å­—å…¸çš„å€¼</li>
</ol>
<p>å¯ä»¥ä½¿ç”¨<code>setdefault()</code>æ–¹æ³•è·å–å­—å…¸çš„å€¼ã€‚å¦‚æœé”®å­˜åœ¨ï¼Œåˆ™è¿”å›é”®çš„å€¼ã€‚å¦‚æœé”®ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›é»˜è®¤å€¼å¹¶å°†å…¶æ·»åŠ åˆ°å­—å…¸ä¸­ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">my_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;city&#39;</span><span class="p">:</span> <span class="s1">&#39;New York&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">name</span> <span class="o">=</span> <span class="n">my_dict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">gender</span> <span class="o">=</span> <span class="n">my_dict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;gender&#39;</span><span class="p">,</span> <span class="s1">&#39;male&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºï¼šJohn</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">gender</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºï¼šmale</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_dict</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºï¼š{&#39;name&#39;: &#39;John&#39;, &#39;age&#39;: 30, &#39;city&#39;: &#39;New York&#39;, &#39;gender&#39;: &#39;male&#39;}</span>
</span></span></code></pre></div><ol start="11">
<li>å­—å…¸è§£åŒ…</li>
</ol>
<p>å­—å…¸è§£åŒ…æ˜¯ä¸€ç§å°†å­—å…¸è½¬æ¢ä¸ºå…³é”®å­—å‚æ•°çš„æŠ€æœ¯ã€‚å­—å…¸è§£åŒ…ä½¿ç”¨ä¸€ä¸ªæˆ–ä¸¤ä¸ªæ˜Ÿå·è¿ç®—ç¬¦ï¼ˆ<code>*</code>æˆ–<code>**</code>ï¼‰æ¥å®ç°ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼Œå½“ä½¿ç”¨å•ä¸ªæ˜Ÿå·è¿ç®—ç¬¦<code>*</code>å°†ä¸€ä¸ªå­—å…¸è§£åŒ…æ—¶ï¼Œå®ƒä¼šå°†å­—å…¸çš„é”®è§£åŒ…ä¸ºä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œå¯ä»¥åœ¨å‡½æ•°è°ƒç”¨ä¸­ä½œä¸ºä½ç½®å‚æ•°ä¼ é€’ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">print_info</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">city</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Name: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Age: </span><span class="si">{</span><span class="n">age</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;City: </span><span class="si">{</span><span class="n">city</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">my_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;city&#39;</span><span class="p">:</span> <span class="s1">&#39;New York&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">print_info</span><span class="p">(</span><span class="o">*</span><span class="n">my_dict</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºï¼šTypeError: print_info() takes 3 positional arguments but 6 were given</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”±äº<code>print_info()</code>å‡½æ•°éœ€è¦3ä¸ªå…³é”®å­—å‚æ•°<code>name</code>ã€<code>age</code>å’Œ<code>city</code>ï¼Œè€Œå­—å…¸<code>my_dict</code>ä¸­æœ‰3ä¸ªé”®<code>name</code>ã€<code>age</code>å’Œ<code>city</code>ï¼Œå› æ­¤å®ƒä»¬è¢«è§£åŒ…ä¸ºä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡<code>('name', 'age', 'city')</code>ï¼Œç„¶åä½œä¸ºä½ç½®å‚æ•°ä¼ é€’ç»™<code>print_info()</code>å‡½æ•°ã€‚ä½†æ˜¯ï¼Œç”±äº<code>print_info()</code>å‡½æ•°éœ€è¦çš„æ˜¯å…³é”®å­—å‚æ•°è€Œä¸æ˜¯ä½ç½®å‚æ•°ï¼Œå› æ­¤å‡ºç°äº†<code>TypeError</code>å¼‚å¸¸ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨åŒæ˜Ÿå·è¿ç®—ç¬¦<code>**</code>å°†å­—å…¸è§£åŒ…ä¸ºå…³é”®å­—å‚æ•°ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">print_info</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">city</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Name: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Age: </span><span class="si">{</span><span class="n">age</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;City: </span><span class="si">{</span><span class="n">city</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">my_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;city&#39;</span><span class="p">:</span> <span class="s1">&#39;New York&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">print_info</span><span class="p">(</span><span class="o">**</span><span class="n">my_dict</span><span class="p">)</span>  <span class="c1"># è¾“å‡ºï¼šName: John Age: 30 City: New York</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒåŒæ˜Ÿå·è¿ç®—ç¬¦<code>**</code>å°†å­—å…¸<code>my_dict</code>è§£åŒ…ä¸ºå…³é”®å­—å‚æ•°<code>name='John'</code>ã€<code>age=30</code>å’Œ<code>city='New York'</code>ï¼Œç„¶åå°†å®ƒä»¬ä½œä¸ºå…³é”®å­—å‚æ•°ä¼ é€’ç»™<code>print_info()</code>å‡½æ•°ï¼Œè¿™æ ·å°±èƒ½å¤ŸæˆåŠŸåœ°æ‰“å°å‡ºå­—å…¸ä¸­çš„å€¼äº†ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰åœ¨å‡½æ•°å®šä¹‰ä¸­æ˜ç¡®æŒ‡å®šäº†è¿™äº›å…³é”®å­—å‚æ•°æ—¶ï¼Œæ‰èƒ½ä½¿ç”¨å­—å…¸è§£åŒ…ã€‚å¦åˆ™ï¼Œå°†ä¼šå¼•å‘<code>TypeError</code>å¼‚å¸¸ã€‚</p>
<h2 id="none">None</h2>
<p>åœ¨Pythonä¸­ï¼Œ<code>None</code>æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡ï¼Œè¡¨ç¤ºä¸€ä¸ªç©ºå€¼æˆ–ç¼ºå¤±å€¼ã€‚<code>None</code>æ˜¯Pythonä¸­å”¯ä¸€çš„ç©ºå€¼å¯¹è±¡ï¼Œç”¨äºè¡¨ç¤ºæ²¡æœ‰å€¼çš„æƒ…å†µã€‚å®ƒæ˜¯ä¸€ä¸ªå•ä¾‹å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒPythonä¸­çš„æ‰€æœ‰<code>None</code>å¼•ç”¨éƒ½æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚</p>
<p><code>None</code>ç±»å‹å¯ä»¥ç”¨äºå¤šç§æƒ…å†µï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>è¡¨ç¤ºå‡½æ•°æ²¡æœ‰è¿”å›å€¼</li>
<li>è¡¨ç¤ºå˜é‡å°šæœªè¢«èµ‹å€¼</li>
<li>è¡¨ç¤ºä¸€ä¸ªå­—å…¸ä¸­æ²¡æœ‰æŒ‡å®šçš„é”®</li>
<li>è¡¨ç¤ºä¸€ä¸ªç±»çš„å±æ€§å°šæœªè¢«èµ‹å€¼</li>
</ul>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›ä½¿ç”¨<code>None</code>çš„ä¾‹å­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">print_hello</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Hello, world!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># å‡½æ•°æ²¡æœ‰è¿”å›å€¼ï¼Œæ‰€ä»¥å¯ä»¥ä¸å†™returnè¯­å¥</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;x is not defined&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">my_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">city</span> <span class="o">=</span> <span class="n">my_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;city&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">city</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;No city found in my_dict&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s2">&#34;John&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">age</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Age not specified&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>åœ¨è¿™äº›ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>None</code>è¢«ç”¨äºè¡¨ç¤ºå‡½æ•°æ²¡æœ‰è¿”å›å€¼ã€å˜é‡å°šæœªè¢«èµ‹å€¼ã€ä¸€ä¸ªå­—å…¸ä¸­æ²¡æœ‰æŒ‡å®šçš„é”®ä»¥åŠä¸€ä¸ªç±»çš„å±æ€§å°šæœªè¢«èµ‹å€¼ç­‰æƒ…å†µã€‚</p>
<p>Pythonä¸­<code>None</code>ç±»å‹çš„ä¸€äº›è¡¥å……è¯´æ˜ï¼š</p>
<ol>
<li>NoneType ç±»å‹</li>
</ol>
<p>åœ¨Pythonä¸­ï¼Œ<code>None</code>æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡ï¼Œå…¶ç±»å‹ä¸º<code>NoneType</code>ã€‚å¯ä»¥ä½¿ç”¨<code>type()</code>å‡½æ•°æ¥æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>  <span class="c1"># è¾“å‡ºï¼š&lt;class &#39;NoneType&#39;&gt;</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>type()</code>å‡½æ•°è¿”å›å˜é‡<code>x</code>çš„ç±»å‹ï¼Œå³<code>NoneType</code>ã€‚</p>
<ol start="2">
<li>é¿å…ä¸å…¶ä»–ç±»å‹æ··æ·†</li>
</ol>
<p>åœ¨Pythonä¸­ï¼Œ<code>None</code>ç±»å‹åªèƒ½ä¸è‡ªèº«è¿›è¡Œæ¯”è¾ƒï¼Œä¸èƒ½ä¸å…¶ä»–ç±»å‹è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœä¸å°å¿ƒå°†<code>None</code>ä¸å…¶ä»–ç±»å‹æ··æ·†ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›å¥‡æ€ªçš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;x is an empty string&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”±äº<code>==</code>æ“ä½œç¬¦å°†<code>None</code>ä¸ç©ºå­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒï¼Œæ‰€ä»¥ç¨‹åºä¸ä¼šæ‰“å°ä»»ä½•å†…å®¹ã€‚å¦‚æœæƒ³æ£€æŸ¥ä¸€ä¸ªå˜é‡æ˜¯å¦ä¸ºå­—ç¬¦ä¸²ï¼Œåº”è¯¥ä½¿ç”¨<code>isinstance()</code>å‡½æ•°ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;x is a string&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>isinstance()</code>å‡½æ•°æ£€æŸ¥å˜é‡<code>x</code>æ˜¯å¦ä¸ºå­—ç¬¦ä¸²ç±»å‹ã€‚</p>
<ol start="3">
<li>ä½¿ç”¨<code>is not None</code>æ£€æŸ¥å˜é‡æ˜¯å¦å­˜åœ¨</li>
</ol>
<p>åœ¨Pythonä¸­ï¼Œå¦‚æœæƒ³æ£€æŸ¥ä¸€ä¸ªå˜é‡æ˜¯å¦å­˜åœ¨ï¼Œåº”è¯¥ä½¿ç”¨<code>is not None</code>è¡¨è¾¾å¼ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;x is defined&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>is not None</code>è¡¨è¾¾å¼æ£€æŸ¥å˜é‡<code>x</code>æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™æ‰“å°å‡º<code>x is defined</code>ã€‚è¿™ç§å†™æ³•æ¯”ä½¿ç”¨<code>if x:</code>æ›´æ˜ç¡®ï¼Œå¯ä»¥é¿å…ä¸€äº›æ½œåœ¨çš„é—®é¢˜ã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>Javaè®¾è®¡æ¨¡å¼ï¼šAdapter</title>
      <link>https://blog.chensoul.com/posts/2023/06/10/java-design-patterns-adapter/</link>
      <pubDate>Sat, 10 Jun 2023 09:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/06/10/java-design-patterns-adapter/</guid>
      <description>æœ¬æ–‡ä¸»è¦ä»‹ç» Adapter æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚ Java Design Patterns æä¾›äº†å„ç§ Java è®¾è®¡æ¨¡</description>
      <content:encoded><![CDATA[<p>æœ¬æ–‡ä¸»è¦ä»‹ç» Adapter æ¨¡å¼ï¼Œåœ¨ <a href="https://java-design-patterns.com/">Java Design Patterns</a>  ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚</p>
<blockquote>
<p><a href="https://java-design-patterns.com/">Java Design Patterns</a> æä¾›äº†å„ç§ Java è®¾è®¡æ¨¡å¼çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ã€‚è¯¥ç½‘ç«™æ—¨åœ¨å¸®åŠ© Java å¼€å‘äººå‘˜äº†è§£å’Œåº”ç”¨å„ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p>
<p>Java Design Patterns ç½‘ç«™æä¾›äº†å¤šç§è®¾è®¡æ¨¡å¼åˆ†ç±»æ–¹å¼ï¼ŒåŒ…æ‹¬åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational Patternsï¼‰ã€ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternsï¼‰å’Œè¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰ï¼Œä»¥åŠå…¶ä»–ä¸€äº›å¸¸è§çš„æ¨¡å¼ã€‚</p>
<p>å¯¹äºæ¯ä¸ªè®¾è®¡æ¨¡å¼ï¼Œè¯¥ç½‘ç«™æä¾›äº†è¯¦ç»†çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ï¼Œå¹¶ä¸”æä¾›äº†ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ã€‚å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©é€‚åˆè‡ªå·±çš„è®¾è®¡æ¨¡å¼ï¼Œå¹¶ä¸”å¯ä»¥å‚è€ƒç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜æ¥ç†è§£å’Œåº”ç”¨è¯¥æ¨¡å¼ã€‚</p>
<p>æ­¤å¤–ï¼ŒJava Design Patterns ç½‘ç«™è¿˜æä¾›äº†ä¸€äº›å…¶ä»–èµ„æºï¼Œå¦‚è®¾è®¡æ¨¡å¼çš„ UML å›¾ã€è®¾è®¡æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ã€è®¾è®¡æ¨¡å¼çš„æ¯”è¾ƒç­‰ã€‚è¿™äº›èµ„æºå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨è®¾è®¡æ¨¡å¼ã€‚</p>
<p>ä¸­æ–‡ç½‘ç«™ï¼š<a href="https://java-design-patterns.com/zh/">https://java-design-patterns.com/zh/</a></p>
<p>Github ä¸Šæºç ä»“åº“ï¼ˆéå®˜æ–¹ï¼‰ï¼š<a href="https://github.com/iluwatar/java-design-patterns">https://github.com/iluwatar/java-design-patterns</a></p>
</blockquote>
<h2 id="ç›®çš„">ç›®çš„</h2>
<p>å°†ä¸€ä¸ªæ¥å£è½¬æ¢æˆå¦ä¸€ä¸ªå®¢æˆ·æ‰€æœŸæœ›çš„æ¥å£ã€‚é€‚é…å™¨è®©é‚£äº›æœ¬æ¥å› ä¸ºæ¥å£ä¸å…¼å®¹çš„ç±»å¯ä»¥åˆä½œæ— é—´ã€‚</p>
<blockquote>
<p>é€‚é…å™¨æ¨¡å¼(Adapter Pattern)æ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·ç«¯æ‰€æœŸæœ›çš„å¦ä¸€ç§æ¥å£ã€‚é€‚é…å™¨æ¨¡å¼é€šå¸¸ç”¨äºè¿æ¥ä¸¤ä¸ªä¸å…¼å®¹çš„æ¥å£æˆ–ç±»ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥ååŒå·¥ä½œã€‚</p>
</blockquote>
<h2 id="è§£é‡Š">è§£é‡Š</h2>
<p>ç°å®ä¸–ç•Œä¾‹å­</p>
<blockquote>
<p>è€ƒè™‘æœ‰è¿™ä¹ˆä¸€ç§æƒ…å†µï¼Œåœ¨ä½ çš„å­˜å‚¨å¡ä¸­æœ‰ä¸€äº›ç…§ç‰‡ï¼Œä½ æƒ³å°†å…¶ä¼ åˆ°ä½ çš„ç”µè„‘ä¸­ã€‚ä¸ºäº†ä¼ é€æ•°æ®ï¼Œä½ éœ€è¦æŸç§èƒ½å¤Ÿå…¼å®¹ä½ ç”µè„‘æ¥å£çš„é€‚é…å™¨ä»¥ä¾¿ä½ çš„å‚¨å­˜å¡èƒ½è¿ä¸Šä½ çš„ç”µè„‘ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯»å¡å™¨å°±æ˜¯ä¸€ä¸ªé€‚é…å™¨ã€‚ å¦ä¸€ä¸ªä¾‹å­å°±æ˜¯æ³¨æ˜çš„ç”µæºé€‚é…å™¨ï¼›ä¸‰è„šæ’å¤´ä¸èƒ½æ’åœ¨ä¸¤è„šæ’åº§ä¸Šï¼Œéœ€è¦ä¸€ä¸ªç”µæºé€‚é…å™¨æ¥ä½¿å…¶èƒ½å¤Ÿæ’åœ¨ä¸¤è„šæ’åº§ä¸Šã€‚ è¿˜æœ‰ä¸€ä¸ªä¾‹å­å°±æ˜¯ç¿»è¯‘å®˜ï¼Œä»–ç¿»è¯‘ä¸€ä¸ªäººå¯¹å¦ä¸€ä¸ªäººè¯´çš„è¯ã€‚</p>
</blockquote>
<p>ç”¨ç›´ç™½çš„è¯æ¥è¯´</p>
<blockquote>
<p>é€‚é…å™¨æ¨¡å¼è®©ä½ å¯ä»¥æŠŠä¸å…¼å®¹çš„å¯¹è±¡åŒ…åœ¨é€‚é…å™¨ä¸­ï¼Œä»¥è®©å…¶å…¼å®¹å…¶ä»–ç±»ã€‚</p>
</blockquote>
<p>ç»´åŸºç™¾ç§‘ä¸­è¯´</p>
<blockquote>
<p>åœ¨è½¯ä»¶å·¥ç¨‹ä¸­ï¼Œé€‚é…å™¨æ¨¡å¼æ˜¯ä¸€ç§å¯ä»¥è®©ç°æœ‰ç±»çš„æ¥å£æŠŠå…¶ä½œä¸ºå…¶ä»–æ¥å£æ¥ä½¿ç”¨çš„è®¾è®¡æ¨¡å¼ã€‚å®ƒç»å¸¸ç”¨æ¥ä½¿ç°æœ‰çš„ç±»å’Œå…¶ä»–ç±»èƒ½å¤Ÿå·¥ä½œå¹¶ä¸”ä¸ç”¨ä¿®æ”¹å…¶ä»–ç±»çš„æºä»£ç ã€‚</p>
</blockquote>
<p>é€‚é…å™¨æ¨¡å¼ç”±ä¸‰ä¸ªä¸»è¦è§’è‰²ç»„æˆï¼š</p>
<ol>
<li>
<p>ç›®æ ‡æ¥å£(Target Interface)ï¼šå®¢æˆ·ç«¯æ‰€æœŸæœ›çš„æ¥å£ã€‚é€‚é…å™¨æ¨¡å¼ä¼šåˆ›å»ºä¸€ä¸ªå®ç°ç›®æ ‡æ¥å£çš„æ–°ç±»ï¼Œä»¥ä¾¿å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è¯¥æ¥å£è°ƒç”¨å®ƒã€‚</p>
</li>
<li>
<p>é€‚é…å™¨(Adapter)ï¼šè¯¥ç±»å®ç°äº†ç›®æ ‡æ¥å£ï¼Œå¹¶å°†å®¢æˆ·ç«¯çš„è¯·æ±‚è½¬æ¢ä¸ºå¯¹é€‚é…è€…çš„è°ƒç”¨ã€‚é€‚é…å™¨é€šå¸¸ä¼šèšåˆä¸€ä¸ªé€‚é…è€…å¯¹è±¡ï¼Œä»¥ä¾¿å°†è¯·æ±‚å§”æ‰˜ç»™å®ƒã€‚</p>
</li>
<li>
<p>é€‚é…è€…(Adapteree)ï¼šé€‚é…å™¨æ¨¡å¼çš„å®é™…å·¥ä½œå†…å®¹ã€‚é€‚é…è€…æ˜¯å®¢æˆ·ç«¯æ‰€æœŸæœ›çš„æ¥å£ä¹‹å¤–çš„ç±»ï¼Œå®ƒå®ç°äº†å®¢æˆ·ç«¯éœ€è¦çš„åŠŸèƒ½ï¼Œä½†å…¶æ¥å£ä¸å®¢æˆ·ç«¯æ‰€æœŸæœ›çš„æ¥å£ä¸å…¼å®¹ã€‚</p>
</li>
</ol>
<p><strong>ç¼–ç¨‹æ ·ä¾‹(å¯¹è±¡é€‚é…å™¨)</strong></p>
<p>å‡å¦‚æœ‰ä¸€ä¸ªèˆ¹é•¿ä»–åªä¼šåˆ’èˆ¹ï¼Œä½†ä¸ä¼šèˆªè¡Œã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬æœ‰æ¥å£<code>RowingBoat</code>å’Œ<code>FishingBoat</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">RowingBoat</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">void</span> <span class="nf">row</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@Slf4j</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FishingBoat</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sail</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;The fishing boat is sailing&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>èˆ¹é•¿å¸Œæœ›æœ‰ä¸€ä¸ª<code>RowingBoat</code>æ¥å£çš„å®ç°ï¼Œè¿™æ ·å°±å¯ä»¥ç§»åŠ¨</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Captain</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="kd">final</span> <span class="n">RowingBoat</span> <span class="n">rowingBoat</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// default constructor and setter for rowingBoat
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kd">public</span> <span class="nf">Captain</span><span class="o">(</span><span class="n">RowingBoat</span> <span class="n">rowingBoat</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="o">.</span><span class="na">rowingBoat</span> <span class="o">=</span> <span class="n">rowingBoat</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">row</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">rowingBoat</span><span class="o">.</span><span class="na">row</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ç°åœ¨æµ·ç›—æ¥äº†ï¼Œæˆ‘ä»¬çš„èˆ¹é•¿éœ€è¦é€ƒè·‘ä½†æ˜¯åªæœ‰ä¸€ä¸ªæ¸”èˆ¹å¯ç”¨ã€‚æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå¯ä»¥è®©èˆ¹é•¿ä½¿ç”¨å…¶åˆ’èˆ¹æŠ€èƒ½æ¥æ“ä½œæ¸”èˆ¹çš„é€‚é…å™¨ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Slf4j</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FishingBoatAdapter</span> <span class="kd">implements</span> <span class="n">RowingBoat</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="kd">final</span> <span class="n">FishingBoat</span> <span class="n">boat</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="nf">FishingBoatAdapter</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">boat</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FishingBoat</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">row</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">boat</span><span class="o">.</span><span class="na">sail</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ç°åœ¨ <code>èˆ¹é•¿</code> å¯ä»¥ä½¿ç”¨<code>FishingBoat</code>æ¥å£æ¥é€ƒç¦»æµ·ç›—äº†ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">var</span> <span class="n">captain</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Captain</span><span class="o">(</span><span class="k">new</span> <span class="n">FishingBoatAdapter</span><span class="o">());</span>
</span></span><span class="line"><span class="cl"><span class="n">captain</span><span class="o">.</span><span class="na">row</span><span class="o">();</span>
</span></span></code></pre></div><h2 id="ç±»å›¾">ç±»å›¾</h2>
<p><img loading="lazy" src="https://java-design-patterns.com/assets/adapter.urm-beb4eb0d.png" alt="alt text"  />
</p>
<h2 id="ä¼˜ç¼ºç‚¹">ä¼˜ç¼ºç‚¹</h2>
<p>é€‚é…å™¨æ¨¡å¼çš„ä¸»è¦ä¼˜ç‚¹æ˜¯ï¼Œå®ƒå¯ä»¥å°†ä¸å…¼å®¹çš„ç±»å’Œæ¥å£è¿æ¥èµ·æ¥ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥ååŒå·¥ä½œã€‚é€‚é…å™¨æ¨¡å¼è¿˜å¯ä»¥å‡å°‘ä»£ç é‡å¤ï¼Œå› ä¸ºå®ƒå¯ä»¥å°†ç°æœ‰çš„ç±»é‡ç”¨åœ¨æ–°çš„ä¸Šä¸‹æ–‡ä¸­ã€‚æ­¤å¤–ï¼Œé€‚é…å™¨æ¨¡å¼å¯ä»¥å¸®åŠ©åº”å¯¹ä¸ç¨³å®šçš„æ¥å£ï¼Œå› ä¸ºå®ƒå¯ä»¥å°†æ¥å£å˜åŒ–éš”ç¦»åˆ°é€‚é…å™¨ä¸­ã€‚</p>
<p>é€‚é…å™¨æ¨¡å¼çš„ä¸»è¦ç¼ºç‚¹æ˜¯ï¼Œå®ƒå¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿè°ƒç”¨é“¾çš„å¢åŠ ï¼Œå› ä¸ºå®ƒéœ€è¦æ·»åŠ é¢å¤–çš„å¯¹è±¡æ¥è¿›è¡Œè½¬æ¢ã€‚æ­¤å¤–ï¼Œé€‚é…å™¨æ¨¡å¼å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ï¼Œå› ä¸ºå®ƒéœ€è¦æ‰§è¡Œé¢å¤–çš„å¤„ç†æ¥è¿›è¡Œè½¬æ¢ã€‚</p>
<h2 id="åº”ç”¨">åº”ç”¨</h2>
<p>é€‚é…å™¨æ¨¡å¼é€šå¸¸ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š</p>
<ol>
<li>å°†ç°æœ‰çš„ç±»æˆ–æ¥å£ä¸æ–°çš„ä»£ç é›†æˆï¼šé€‚é…å™¨å¯ä»¥å°†ç°æœ‰çš„ç±»æˆ–æ¥å£ä¸æ–°çš„ä»£ç é›†æˆï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥ååŒå·¥ä½œã€‚</li>
<li>ä¸ç¬¬ä¸‰æ–¹åº“æˆ–ç»„ä»¶é›†æˆï¼šé€‚é…å™¨å¯ä»¥å°†ç¬¬ä¸‰æ–¹åº“æˆ–ç»„ä»¶çš„æ¥å£ä¸åº”ç”¨ç¨‹åºçš„æ¥å£è¿›è¡Œè½¬æ¢ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥ååŒå·¥ä½œã€‚</li>
<li>åº”å¯¹ä¸ç¨³å®šçš„æ¥å£ï¼šé€‚é…å™¨å¯ä»¥å°†ä¸ç¨³å®šçš„æ¥å£å°è£…åœ¨ä¸€ä¸ªé€‚é…å™¨ä¸­ï¼Œä»¥ä¾¿å°†æ¥æ¥å£å˜åŒ–æ—¶åªéœ€è¦æ›´æ”¹é€‚é…å™¨å³å¯ã€‚</li>
<li>å®ç°å¤šä¸ªæ¥å£ï¼šé€‚é…å™¨å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼Œä»¥ä¾¿ä¸€ä¸ªå¯¹è±¡å¯ä»¥åŒæ—¶è¢«å¤šä¸ªç±»ä½¿ç”¨ã€‚</li>
<li>åœ¨æµ‹è¯•ä¸­ä½¿ç”¨ï¼šé€‚é…å™¨å¯ä»¥åœ¨æµ‹è¯•ä¸­æ¨¡æ‹Ÿæ¥å£çš„è¡Œä¸ºï¼Œä»¥ä¾¿æµ‹è¯•ç¨‹åºçš„å„ç§ç”¨ä¾‹ã€‚</li>
<li>å…¼å®¹ä¸åŒç‰ˆæœ¬ï¼šå¦‚æœåº”ç”¨ç¨‹åºéœ€è¦ä¸å¤šä¸ªç‰ˆæœ¬çš„åŒä¸€æ¥å£è¿›è¡Œäº¤äº’ï¼Œå¯ä»¥ä½¿ç”¨é€‚é…å™¨æ¨¡å¼æ¥å¤„ç†ä¸åŒç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚ã€‚</li>
<li>é‡ç”¨ç°æœ‰ä»£ç ï¼šå¦‚æœéœ€è¦é‡ç”¨ç°æœ‰çš„ä»£ç ï¼Œä½†å…¶æ¥å£ä¸æ‰€éœ€æ¥å£ä¸å…¼å®¹ï¼Œåˆ™å¯ä»¥ä½¿ç”¨é€‚é…å™¨æ¨¡å¼æ¥é‡ç”¨ä»£ç ã€‚</li>
<li>æ•°æ®åº“é©±åŠ¨ç¨‹åºï¼šæ•°æ®åº“é©±åŠ¨ç¨‹åºé€šå¸¸ä½¿ç”¨é€‚é…å™¨æ¨¡å¼ï¼Œä»¥ä¾¿å°†æ•°æ®åº“çš„ä¸åŒæ¥å£è½¬æ¢ä¸ºJava JDBCæ¥å£ã€‚</li>
<li>æ—¥å¿—è®°å½•ï¼šæ—¥å¿—è®°å½•åº“é€šå¸¸ä½¿ç”¨é€‚é…å™¨æ¨¡å¼ï¼Œä»¥ä¾¿å°†ä¸åŒçš„æ—¥å¿—è®°å½•æ¥å£è½¬æ¢ä¸ºé€šç”¨çš„æ¥å£ã€‚</li>
<li>æ‰©å±•ç°æœ‰åŠŸèƒ½ï¼šå¦‚æœéœ€è¦æ‰©å±•ç°æœ‰åŠŸèƒ½ï¼Œä½†å…¶æ¥å£ä¸æ‰€éœ€æ¥å£ä¸å…¼å®¹ï¼Œåˆ™å¯ä»¥ä½¿ç”¨é€‚é…å™¨æ¨¡å¼æ¥æ‰©å±•ç°æœ‰åŠŸèƒ½ã€‚</li>
</ol>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨é€‚é…å™¨æ¨¡å¼çš„æ—¥å¿—è®°å½•åº“çš„ç¤ºä¾‹ï¼š</p>
<ol>
<li>ç›®æ ‡æ¥å£ï¼šå®šä¹‰é€šç”¨çš„æ—¥å¿—è®°å½•å™¨æ¥å£ã€‚</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Logger</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">log</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><ol start="2">
<li>é€‚é…å™¨ï¼šå®šä¹‰ä¸€ä¸ªé€‚é…å™¨ç±»ï¼Œå®ç°ç›®æ ‡æ¥å£ï¼Œå¹¶èšåˆä¸åŒæ—¥å¿—æ¡†æ¶çš„å¯¹è±¡ã€‚</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LogAdapter</span> <span class="kd">implements</span> <span class="n">Logger</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Log4j</span> <span class="n">log</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">LogAdapter</span><span class="o">(</span><span class="n">Log4j</span> <span class="n">log</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">log</span> <span class="o">=</span> <span class="n">log</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">log</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">log</span><span class="o">.</span><span class="na">trace</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><ol start="3">
<li>é€‚é…è€…ï¼šå®šä¹‰ä¸€ä¸ªLog4jæ—¥å¿—æ¡†æ¶çš„ç±»ã€‚</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Log4j</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">trace</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ä½¿ç”¨Log4jè¿›è¡Œæ—¥å¿—è®°å½•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é€‚é…å™¨æ¥å°†ä¸åŒçš„æ—¥å¿—æ¡†æ¶è½¬æ¢ä¸ºé€šç”¨çš„Loggeræ¥å£ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Log4j</span> <span class="n">log4j</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Log4j</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LogAdapter</span><span class="o">(</span><span class="n">log4j</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">logger</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="s">&#34;This is a log message&#34;</span><span class="o">);</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œé€‚é…å™¨æ¨¡å¼å…è®¸æˆ‘ä»¬å°†Log4jæ¡†æ¶çš„æ¥å£è½¬æ¢ä¸ºé€šç”¨çš„Loggeræ¥å£ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Loggeræ¥å£è®°å½•æ—¥å¿—è€Œä¸å¿…å…³å¿ƒå…·ä½“ä½¿ç”¨çš„æ—¥å¿—æ¡†æ¶ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦åˆ‡æ¢åˆ°å…¶ä»–æ—¥å¿—æ¡†æ¶ï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„é€‚é…å™¨å³å¯ã€‚</p>
<p>é™¤äº†é€‚é…å™¨æ¨¡å¼çš„åº”ç”¨åœºæ™¯å’Œå¸¸è§å¼€æºæ¡†æ¶ä¸­çš„ä½¿ç”¨ç¤ºä¾‹å¤–ï¼Œé€‚é…å™¨è¿˜æœ‰å…¶ä»–ä¸€äº›ç›¸å…³çš„æ¦‚å¿µå’ŒæŠ€æœ¯ï¼š</p>
<ol>
<li>å¯¹è±¡é€‚é…å™¨å’Œç±»é€‚é…å™¨ï¼šé€‚é…å™¨æ¨¡å¼å¯ä»¥åˆ†ä¸ºå¯¹è±¡é€‚é…å™¨å’Œç±»é€‚é…å™¨ä¸¤ç§ã€‚å¯¹è±¡é€‚é…å™¨ä½¿ç”¨ç»„åˆçš„æ–¹å¼æ¥å®ç°é€‚é…å™¨æ¨¡å¼ï¼Œè€Œç±»é€‚é…å™¨ä½¿ç”¨ç»§æ‰¿çš„æ–¹å¼æ¥å®ç°é€‚é…å™¨æ¨¡å¼ã€‚</li>
<li>åŒå‘é€‚é…å™¨ï¼šåœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œéœ€è¦å°†ä¸¤ä¸ªä¸å…¼å®¹çš„æ¥å£äº’ç›¸é€‚é…ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨åŒå‘é€‚é…å™¨æ¨¡å¼æ¥å®ç°åŒå‘çš„é€‚é…ã€‚</li>
<li>æ¥å£é€‚é…å™¨ï¼šå½“ä¸€ä¸ªæ¥å£ä¸­æœ‰å¤ªå¤šçš„æ–¹æ³•ï¼Œè€Œå®ç°è¯¥æ¥å£çš„ç±»åªéœ€è¦å…¶ä¸­çš„ä¸€éƒ¨åˆ†æ–¹æ³•æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ¥å£é€‚é…å™¨æ¨¡å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æ¥å£é€‚é…å™¨æ¨¡å¼å°†ä¸€ä¸ªæ¥å£æ‹†åˆ†æˆå¤šä¸ªæ¥å£ï¼Œå¹¶æä¾›ä¸€ä¸ªé»˜è®¤çš„ç©ºå®ç°ï¼Œä½¿å¾—å®ç°è¯¥æ¥å£çš„ç±»å¯ä»¥åªå®ç°è‡ªå·±éœ€è¦çš„æ–¹æ³•ã€‚</li>
</ol>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªåŒå‘é€‚é…å™¨çš„ç¤ºä¾‹ï¼š</p>
<p>å‡è®¾æœ‰ä¸¤ä¸ªæ¥å£ï¼Œåˆ†åˆ«æ˜¯ <code>Shape</code> å’Œ <code>IRectangle</code>ï¼Œå…¶ä¸­ <code>Shape</code> è¡¨ç¤ºä¸€ä¸ªå½¢çŠ¶ï¼Œ<code>IRectangle</code> è¡¨ç¤ºä¸€ä¸ªçŸ©å½¢ã€‚<code>Shape</code> æ¥å£æœ‰ä¸¤ä¸ªæ–¹æ³• <code>draw()</code> å’Œ <code>resize()</code>ï¼Œè€Œ <code>IRectangle</code> æ¥å£æœ‰ä¸‰ä¸ªæ–¹æ³• <code>setOrigin()</code>, <code>setWidth()</code> å’Œ <code>setHeight()</code>ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™ä¸¤ä¸ªæ¥å£äº’ç›¸é€‚é…ã€‚æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªåŒå‘é€‚é…å™¨ <code>ShapeToRectangleAdapter</code>ï¼Œå®ƒå®ç°äº†è¿™ä¸¤ä¸ªæ¥å£ï¼Œå¹¶ä¸”å¯ä»¥å°†ä¸€ä¸ª <code>Shape</code> å¯¹è±¡é€‚é…åˆ°ä¸€ä¸ª <code>IRectangle</code> å¯¹è±¡ä¸­ï¼Œä¹Ÿå¯ä»¥å°†ä¸€ä¸ª <code>IRectangle</code> å¯¹è±¡é€‚é…åˆ°ä¸€ä¸ª <code>Shape</code> å¯¹è±¡ä¸­ã€‚å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Shape</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">draw</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">resize</span><span class="o">(</span><span class="kt">int</span> <span class="n">width</span><span class="o">,</span> <span class="kt">int</span> <span class="n">height</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  	<span class="kt">void</span> <span class="nf">move</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IRectangle</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">setOrigin</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">setWidth</span><span class="o">(</span><span class="kt">int</span> <span class="n">width</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">setHeight</span><span class="o">(</span><span class="kt">int</span> <span class="n">height</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">paint</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">stretch</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ShapeToRectangleAdapter</span> <span class="kd">implements</span> <span class="n">Shape</span><span class="o">,</span> <span class="n">IRectangle</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Shape</span> <span class="n">shape</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">IRectangle</span> <span class="n">rectangle</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">ShapeToRectangleAdapter</span><span class="o">(</span><span class="n">Shape</span> <span class="n">shape</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">shape</span> <span class="o">=</span> <span class="n">shape</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">ShapeToRectangleAdapter</span><span class="o">(</span><span class="n">IRectangle</span> <span class="n">rectangle</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">rectangle</span> <span class="o">=</span> <span class="n">rectangle</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// å°† Shape é€‚é…åˆ° IRectangle ä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setOrigin</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">shape</span><span class="o">.</span><span class="na">move</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setWidth</span><span class="o">(</span><span class="kt">int</span> <span class="n">width</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">shape</span><span class="o">.</span><span class="na">resize</span><span class="o">(</span><span class="n">width</span><span class="o">,</span> <span class="n">shape</span><span class="o">.</span><span class="na">getHeight</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setHeight</span><span class="o">(</span><span class="kt">int</span> <span class="n">height</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">shape</span><span class="o">.</span><span class="na">resize</span><span class="o">(</span><span class="n">shape</span><span class="o">.</span><span class="na">getWidth</span><span class="o">(),</span> <span class="n">height</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// å°† IRectangle é€‚é…åˆ° Shape ä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">rectangle</span><span class="o">.</span><span class="na">paint</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">resize</span><span class="o">(</span><span class="kt">int</span> <span class="n">width</span><span class="o">,</span> <span class="kt">int</span> <span class="n">height</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">rectangle</span><span class="o">.</span><span class="na">setWidth</span><span class="o">(</span><span class="n">width</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">rectangle</span><span class="o">.</span><span class="na">setHeight</span><span class="o">(</span><span class="n">height</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">move</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">rectangle</span><span class="o">.</span><span class="na">setOrigin</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getWidth</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">rectangle</span><span class="o">.</span><span class="na">getWidth</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getHeight</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">rectangle</span><span class="o">.</span><span class="na">getHeight</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">paint</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">shape</span><span class="o">.</span><span class="na">draw</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stretch</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">shape</span><span class="o">.</span><span class="na">resize</span><span class="o">(</span><span class="n">shape</span><span class="o">.</span><span class="na">getWidth</span><span class="o">()</span> <span class="o">*</span> <span class="n">2</span><span class="o">,</span> <span class="n">shape</span><span class="o">.</span><span class="na">getHeight</span><span class="o">()</span> <span class="o">*</span> <span class="n">2</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ<code>ShapeToRectangleAdapter</code> é€‚é…å™¨å®ç°äº† <code>Shape</code> å’Œ <code>IRectangle</code> æ¥å£ï¼Œå¹¶ä¸”åœ¨æ„é€ å‡½æ•°ä¸­æ¥æ”¶ä¸€ä¸ª <code>Shape</code> å¯¹è±¡æˆ– <code>IRectangle</code> å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œä»¥ä¾¿å°†å…¶é€‚é…åˆ°å¦ä¸€ä¸ªæ¥å£ä¸­ã€‚</p>
<p>å½“éœ€è¦å°†ä¸€ä¸ª <code>Shape</code> å¯¹è±¡é€‚é…åˆ°ä¸€ä¸ª <code>IRectangle</code> å¯¹è±¡ä¸­æ—¶ï¼Œé€‚é…å™¨å®ç°äº† <code>setOrigin()</code>ã€<code>setWidth()</code> å’Œ <code>setHeight()</code> æ–¹æ³•ï¼Œå°† <code>Shape</code> å¯¹è±¡çš„ä½ç½®å’Œå¤§å°é€‚é…åˆ° <code>IRectangle</code> å¯¹è±¡ä¸­ã€‚</p>
<p>å½“éœ€è¦å°†ä¸€ä¸ª <code>IRectangle</code> å¯¹è±¡é€‚é…åˆ°ä¸€ä¸ª <code>Shape</code> å¯¹è±¡ä¸­æ—¶ï¼Œé€‚é…å™¨å®ç°äº† <code>draw()</code> å’Œ <code>resize()</code> æ–¹æ³•ï¼Œå°† <code>IRectangle</code> å¯¹è±¡çš„ç»˜åˆ¶å’Œå¤§å°è°ƒæ•´é€‚é…åˆ° <code>Shape</code> å¯¹è±¡ä¸­ã€‚</p>
<p>è¿™æ ·ï¼Œé€šè¿‡åŒå‘é€‚é…å™¨ï¼Œæˆ‘ä»¬å¯ä»¥å°† <code>Shape</code> å’Œ <code>IRectangle</code> æ¥å£äº’ç›¸é€‚é…ï¼Œä½¿å¾—å®ƒä»¬å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™äº’ç›¸è°ƒç”¨ã€‚</p>
<h2 id="å¯¹æ¯”">å¯¹æ¯”</h2>
<p>é€‚é…å™¨æ¨¡å¼å’Œè£…é¥°å™¨æ¨¡å¼éƒ½æ˜¯å¸¸è§çš„ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒä»¬çš„ä½œç”¨éƒ½æ˜¯ä¸ºäº†å¢å¼ºç±»çš„åŠŸèƒ½ã€‚è™½ç„¶è¿™ä¸¤ç§æ¨¡å¼å…·æœ‰æŸäº›ç›¸ä¼¼ä¹‹å¤„ï¼Œä½†å®ƒä»¬ä¹‹é—´ä¹Ÿå­˜åœ¨ä¸€äº›é‡è¦çš„åŒºåˆ«ã€‚ä¸‹é¢æ˜¯é€‚é…å™¨æ¨¡å¼å’Œè£…é¥°å™¨æ¨¡å¼ä¹‹é—´çš„åŒºåˆ«ï¼š</p>
<ol>
<li>ç›®çš„ä¸åŒï¼šé€‚é…å™¨æ¨¡å¼çš„ç›®çš„æ˜¯å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢ä¸ºå¦ä¸€ä¸ªç±»çš„æ¥å£ï¼Œä»¥ä¾¿è¿™ä¸¤ä¸ªç±»å¯ä»¥ååŒå·¥ä½œã€‚è€Œè£…é¥°å™¨æ¨¡å¼çš„ç›®çš„æ˜¯ä¸ºä¸€ä¸ªå¯¹è±¡æ·»åŠ æ–°çš„åŠŸèƒ½ï¼ŒåŒæ—¶ä¸æ”¹å˜å…¶åŸæœ‰çš„æ¥å£å’Œå®ç°ã€‚</li>
<li>é€‚é…æ–¹å¼ä¸åŒï¼šé€‚é…å™¨æ¨¡å¼é€šå¸¸ä½¿ç”¨å¯¹è±¡é€‚é…å™¨æˆ–ç±»é€‚é…å™¨æ¥å®ç°ã€‚å¯¹è±¡é€‚é…å™¨ä½¿ç”¨ç»„åˆå…³ç³»å°†é€‚é…å™¨åŒ…è£…åœ¨å¦ä¸€ä¸ªå¯¹è±¡ä¸­ï¼Œè€Œç±»é€‚é…å™¨ä½¿ç”¨å¤šé‡ç»§æ‰¿æ¥å®ç°é€‚é…å™¨ã€‚è€Œè£…é¥°å™¨æ¨¡å¼å§‹ç»ˆä½¿ç”¨å¯¹è±¡ç»„åˆæ¥å®ç°ã€‚</li>
<li>ä½¿ç”¨åœºæ™¯ä¸åŒï¼šé€‚é…å™¨æ¨¡å¼é€šå¸¸ç”¨äºé›†æˆç¬¬ä¸‰æ–¹ç±»æˆ–æ¥å£ï¼Œæˆ–æ˜¯å°†ä¸å…¼å®¹çš„æ¥å£è½¬æ¢ä¸ºå…¼å®¹çš„æ¥å£ã€‚è€Œè£…é¥°å™¨æ¨¡å¼é€šå¸¸ç”¨äºåœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°ä¸ºä¸€ä¸ªå¯¹è±¡æ·»åŠ æ–°çš„åŠŸèƒ½ã€‚</li>
<li>å¯¹è±¡çš„å…³ç³»ä¸åŒï¼šé€‚é…å™¨æ¨¡å¼ä¸­ï¼Œé€‚é…å™¨ä¸è¢«é€‚é…è€…ä¹‹é—´æ˜¯ä¸€ç§é™æ€å…³ç³»ï¼Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»åœ¨ç¼–è¯‘æ—¶å°±å·²ç»ç¡®å®šã€‚è€Œè£…é¥°å™¨æ¨¡å¼ä¸­ï¼Œè£…é¥°å™¨ä¸è¢«è£…é¥°è€…ä¹‹é—´æ˜¯ä¸€ç§åŠ¨æ€å…³ç³»ï¼Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»åœ¨è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šã€‚</li>
</ol>
<p>é€‚é…å™¨æ¨¡å¼çš„åº”ç”¨åœºæ™¯ï¼š</p>
<ol>
<li>åœ¨é›†æˆç¬¬ä¸‰æ–¹ç±»æˆ–æ¥å£æ—¶ï¼Œå¯ä»¥ä½¿ç”¨é€‚é…å™¨æ¨¡å¼å°†å…¶æ¥å£è½¬æ¢ä¸ºåº”ç”¨ç¨‹åºæ‰€éœ€çš„æ¥å£ã€‚</li>
<li>å½“éœ€è¦ä½¿ç”¨æŸä¸ªç±»çš„æ–¹æ³•ï¼Œä½†è¯¥ç±»çš„æ¥å£ä¸åº”ç”¨ç¨‹åºçš„æ¥å£ä¸å…¼å®¹æ—¶ï¼Œå¯ä»¥ä½¿ç”¨é€‚é…å™¨æ¨¡å¼å°†è¯¥ç±»çš„æ¥å£è½¬æ¢ä¸ºåº”ç”¨ç¨‹åºæ‰€éœ€çš„æ¥å£ã€‚</li>
<li>å½“éœ€è¦å°†ä¸€ç§æ•°æ®æ ¼å¼è½¬æ¢ä¸ºå¦ä¸€ç§æ•°æ®æ ¼å¼æ—¶ï¼Œå¯ä»¥ä½¿ç”¨é€‚é…å™¨æ¨¡å¼å°†æ•°æ®æ ¼å¼è½¬æ¢ä¸ºåº”ç”¨ç¨‹åºæ‰€éœ€çš„æ ¼å¼ã€‚</li>
</ol>
<p>ä¾‹å¦‚ï¼Œå°†ä¸€ä¸ªç”µå™¨æ’å¤´æ’å…¥åˆ°å¢™ä¸Šçš„æ’åº§ä¸­ï¼Œè¿™ä¸¤ä¸ªæ¥å£æ˜¯ä¸å…¼å®¹çš„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ’å¤´é€‚é…å™¨ï¼Œå°†ç”µå™¨æ’å¤´çš„æ¥å£è½¬æ¢ä¸ºå¢™ä¸Šæ’åº§çš„æ¥å£ï¼Œä»¥ä¾¿ç”µå™¨å¯ä»¥ä¸å¢™ä¸Šçš„æ’åº§ååŒå·¥ä½œã€‚</p>
<p>è£…é¥°å™¨æ¨¡å¼çš„åº”ç”¨åœºæ™¯ï¼š</p>
<ol>
<li>å½“éœ€è¦ä¸ºä¸€ä¸ªå¯¹è±¡åŠ¨æ€åœ°æ·»åŠ æ–°çš„åŠŸèƒ½æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼ã€‚</li>
<li>å½“éœ€è¦ä¸ºä¸€ä¸ªå¯¹è±¡æ·»åŠ çš„å¤šä¸ªåŠŸèƒ½å…·æœ‰ä¸åŒçš„ç»„åˆæ–¹å¼æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼ã€‚</li>
</ol>
<p>ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªåœ¨çº¿å•†åº—ä¸­ï¼Œç”¨æˆ·å¯ä»¥è´­ä¹°å•†å“å¹¶è¿›è¡Œæ”¯ä»˜ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼æ¥ä¸ºè®¢å•å¯¹è±¡æ·»åŠ æ–°çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æ·»åŠ ä¼˜æƒ åˆ¸ã€æ·»åŠ ç¤¼å“åŒ…è£…ã€æ·»åŠ å¿«é€’ä¿é™©ç­‰ã€‚è¿™äº›åŠŸèƒ½å¯ä»¥æ ¹æ®ç”¨æˆ·çš„éœ€æ±‚è¿›è¡Œç»„åˆï¼Œå¹¶ä¸”å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°æ·»åŠ æˆ–åˆ é™¤ã€‚</p>
<p>æ€»ä¹‹ï¼Œé€‚é…å™¨æ¨¡å¼å’Œè£…é¥°å™¨æ¨¡å¼éƒ½æ˜¯ä¸ºäº†å¢å¼ºç±»çš„åŠŸèƒ½ï¼Œä½†å®ƒä»¬çš„ç›®çš„å’Œå®ç°æ–¹å¼ä¸åŒã€‚é€‚é…å™¨æ¨¡å¼æ˜¯ä¸ºäº†è§£å†³æ¥å£ä¸å…¼å®¹çš„é—®é¢˜ï¼Œè€Œè£…é¥°å™¨æ¨¡å¼æ˜¯ä¸ºäº†åŠ¨æ€åœ°ä¸ºä¸€ä¸ªå¯¹è±¡æ·»åŠ æ–°çš„åŠŸèƒ½ã€‚</p>
<h2 id="ä¸¾ä¾‹">ä¸¾ä¾‹</h2>
<p>ä»¥ä¸‹æ˜¯å¸¸è§å¼€æºæ¡†æ¶ä¸­ä½¿ç”¨é€‚é…å™¨æ¨¡å¼çš„ä¸€äº›ç¤ºä¾‹ï¼š</p>
<ol>
<li>Springæ¡†æ¶ï¼šSpringæ¡†æ¶ä¸­çš„ <code>HandlerAdapter</code> æ¥å£å°±æ˜¯ä¸€ä¸ªé€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚ä¸åŒçš„ <code>HandlerAdapter</code> å®ç°ç±»å¯ä»¥å°†ä¸åŒç±»å‹çš„æ§åˆ¶å™¨ï¼ˆå¦‚Servletã€Strutsã€JSFï¼‰é€‚é…åˆ° Spring MVC æ¡†æ¶ä¸­ã€‚</li>
<li>Hibernateæ¡†æ¶ï¼šHibernateæ¡†æ¶ä¸­çš„ <code>ConnectionProvider</code> æ¥å£ä¹Ÿæ˜¯ä¸€ä¸ªé€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚ä¸åŒçš„ <code>ConnectionProvider</code> å®ç°ç±»å¯ä»¥å°†ä¸åŒç±»å‹çš„æ•°æ®æºï¼ˆå¦‚JDBCã€JTAï¼‰é€‚é…åˆ° Hibernate æ¡†æ¶ä¸­ã€‚</li>
<li>Log4jæ¡†æ¶ï¼šLog4jæ¡†æ¶ä¸­çš„ <code>Appender</code> æ¥å£ä¹Ÿæ˜¯ä¸€ä¸ªé€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚ä¸åŒçš„ <code>Appender</code> å®ç°ç±»å¯ä»¥å°†ä¸åŒç±»å‹çš„æ—¥å¿—è¾“å‡ºé€‚é…åˆ° Log4j æ¡†æ¶ä¸­ã€‚</li>
<li>JUnitæ¡†æ¶ï¼šJUnitæ¡†æ¶ä¸­çš„ <code>Test</code> æ¥å£ä¹Ÿæ˜¯ä¸€ä¸ªé€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚ä¸åŒçš„ <code>Test</code> å®ç°ç±»å¯ä»¥å°†ä¸åŒç±»å‹çš„æµ‹è¯•ç”¨ä¾‹é€‚é…åˆ° JUnit æ¡†æ¶ä¸­ã€‚</li>
<li>Java Swingæ¡†æ¶ï¼šJava Swingæ¡†æ¶ä¸­çš„ <code>JList</code> ç»„ä»¶ä¹Ÿæ˜¯ä¸€ä¸ªé€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚<code>JList</code> ç»„ä»¶å¯ä»¥ä½¿ç”¨é€‚é…å™¨å°†ä¸åŒç±»å‹çš„æ•°æ®æºï¼ˆå¦‚æ•°ç»„ã€é›†åˆï¼‰é€‚é…åˆ° <code>JList</code> ç»„ä»¶ä¸­ã€‚</li>
<li>Apache Commonsæ¡†æ¶ï¼šApache Commonsæ¡†æ¶ä¸­çš„ <code>FileFilter</code> æ¥å£ä¹Ÿæ˜¯ä¸€ä¸ªé€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚ä¸åŒçš„ <code>FileFilter</code> å®ç°ç±»å¯ä»¥å°†ä¸åŒç±»å‹çš„æ–‡ä»¶è¿‡æ»¤å™¨é€‚é…åˆ° Apache Commons æ¡†æ¶ä¸­ã€‚</li>
<li>Apache Shiroæ¡†æ¶ï¼šApache Shiroæ¡†æ¶ä¸­çš„ <code>Realm</code> æ¥å£ä¹Ÿæ˜¯ä¸€ä¸ªé€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚ä¸åŒçš„ <code>Realm</code> å®ç°ç±»å¯ä»¥å°†ä¸åŒç±»å‹çš„èº«ä»½éªŒè¯å’Œæˆæƒæœºåˆ¶é€‚é…åˆ° Apache Shiro æ¡†æ¶ä¸­ã€‚</li>
<li>Apache Strutsæ¡†æ¶ï¼šApache Strutsæ¡†æ¶ä¸­çš„ <code>Action</code> æ¥å£ä¹Ÿæ˜¯ä¸€ä¸ªé€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚ä¸åŒçš„ <code>Action</code> å®ç°ç±»å¯ä»¥å°†ä¸åŒç±»å‹çš„è¯·æ±‚å¤„ç†é€‚é…åˆ° Apache Struts æ¡†æ¶ä¸­ã€‚</li>
<li>Androidæ¡†æ¶ï¼šAndroidæ¡†æ¶ä¸­çš„ <code>ArrayAdapter</code> ç±»ä¹Ÿæ˜¯ä¸€ä¸ªé€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚<code>ArrayAdapter</code> ç±»å¯ä»¥ä½¿ç”¨é€‚é…å™¨å°†ä¸åŒç±»å‹çš„æ•°æ®æºï¼ˆå¦‚æ•°ç»„ã€é›†åˆï¼‰é€‚é…åˆ° Android UI ç»„ä»¶ä¸­ã€‚</li>
<li>Spring Bootæ¡†æ¶ï¼šSpring Bootæ¡†æ¶ä¸­çš„ <code>CommandLineRunner</code> æ¥å£ä¹Ÿæ˜¯ä¸€ä¸ªé€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚ä¸åŒçš„ <code>CommandLineRunner</code> å®ç°ç±»å¯ä»¥å°†ä¸åŒç±»å‹çš„å‘½ä»¤è¡Œå‚æ•°é€‚é…åˆ° Spring Boot æ¡†æ¶ä¸­ã€‚</li>
<li>Apache Camelæ¡†æ¶ï¼šApache Camelæ¡†æ¶ä¸­çš„ <code>Component</code> æ¥å£ä¹Ÿæ˜¯ä¸€ä¸ªé€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚ä¸åŒçš„ <code>Component</code> å®ç°ç±»å¯ä»¥å°†ä¸åŒç±»å‹çš„æ¶ˆæ¯ä¼ è¾“åè®®ï¼ˆå¦‚HTTPã€FTPç­‰ï¼‰é€‚é…åˆ° Apache Camel æ¡†æ¶ä¸­ã€‚</li>
<li>Jerseyæ¡†æ¶ï¼šJerseyæ¡†æ¶ä¸­çš„ <code>MessageBodyReader</code> å’Œ <code>MessageBodyWriter</code> æ¥å£ä¹Ÿæ˜¯é€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚è¿™ä¸¤ä¸ªæ¥å£å¯ä»¥å°†ä¸åŒç±»å‹çš„è¯·æ±‚æˆ–å“åº”æ¶ˆæ¯é€‚é…åˆ° Jersey æ¡†æ¶ä¸­ã€‚</li>
<li>Retrofitæ¡†æ¶ï¼šRetrofitæ¡†æ¶ä¸­çš„ <code>Converter</code> æ¥å£ä¹Ÿæ˜¯ä¸€ä¸ªé€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚ä¸åŒçš„ <code>Converter</code> å®ç°ç±»å¯ä»¥å°†ä¸åŒç±»å‹çš„å“åº”æ¶ˆæ¯è½¬æ¢ä¸º Java å¯¹è±¡ï¼Œå¹¶é€‚é…åˆ° Retrofit æ¡†æ¶ä¸­ã€‚</li>
<li>Logbackæ¡†æ¶ï¼šLogbackæ¡†æ¶ä¸­çš„ <code>Appender</code> æ¥å£ä¹Ÿæ˜¯é€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚ä¸åŒçš„ <code>Appender</code> å®ç°ç±»å¯ä»¥å°†ä¸åŒç±»å‹çš„æ—¥å¿—è¾“å‡ºé€‚é…åˆ° Logback æ¡†æ¶ä¸­ã€‚</li>
<li>Apache Kafkaæ¡†æ¶ï¼šApache Kafkaæ¡†æ¶ä¸­çš„ <code>Consumer</code> å’Œ <code>Producer</code> æ¥å£ä¹Ÿæ˜¯é€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚ä¸åŒçš„ <code>Consumer</code> å’Œ <code>Producer</code> å®ç°ç±»å¯ä»¥å°†ä¸åŒç±»å‹çš„æ¶ˆæ¯ä¼ è¾“åè®®é€‚é…åˆ° Apache Kafka æ¡†æ¶ä¸­ã€‚</li>
</ol>
<p>ä»¥ä¸‹æ˜¯ jdk ä¸­ä½¿ç”¨é€‚é…å™¨æ¨¡å¼çš„ä¾‹å­ï¼š</p>
<ul>
<li><a href="http://docs.oracle.com/javase/8/docs/api/java/util/Arrays.html#asList(T...)">java.util.Arrays#asList()</a> è¯¥æ–¹æ³•å°†æ•°ç»„è½¬æ¢ä¸ºListé›†åˆã€‚ç”±äºæ•°ç»„å’ŒListé›†åˆçš„æ¥å£ä¸å…¼å®¹ï¼Œæ‰€ä»¥è¯¥æ–¹æ³•ä½¿ç”¨äº†é€‚é…å™¨æ¨¡å¼å°†æ•°ç»„è½¬æ¢ä¸ºListé›†åˆã€‚</li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collections.html#list-java.util.Enumeration-">java.util.Collections#list()</a> è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ª <code>Enumeration</code> å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå¹¶å°†è¯¥ <code>Enumeration</code> å¯¹è±¡è½¬æ¢ä¸ºä¸€ä¸ª <code>List</code>ã€‚</li>
<li><a href="https://docs.oracle.com/javase/8/docs/api/java/util/Collections.html#enumeration-java.util.Collection-">java.util.Collections#enumeration()</a> è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ª <code>Collection</code> å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå¹¶å°†è¯¥ <code>Collection</code> å¯¹è±¡è½¬æ¢ä¸ºä¸€ä¸ª <code>Enumeration</code> å¯¹è±¡ã€‚</li>
<li><a href="http://docs.oracle.com/javase/8/docs/api/javax/xml/bind/annotation/adapters/XmlAdapter.html#marshal-BoundType-">javax.xml.bind.annotation.adapters.XMLAdapter</a> è¯¥ç±»æ˜¯ç”¨äºXMLåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„é€‚é…å™¨ã€‚å®ƒå¯ä»¥å°†Javaå¯¹è±¡è½¬æ¢ä¸ºXMLå…ƒç´ ï¼Œå¹¶åœ¨ååºåˆ—åŒ–æ—¶å°†XMLå…ƒç´ è½¬æ¢å›Javaå¯¹è±¡ã€‚</li>
<li>java.io.InputStreamReaderå’Œjava.io.OutputStreamWriterç±»ï¼šè¿™ä¸¤ä¸ªç±»æ˜¯ç”¨äºè¯»å†™å­—ç¬¦æµçš„åŒ…è£…å™¨ç±»ã€‚å®ƒä»¬ä½¿ç”¨é€‚é…å™¨æ¨¡å¼å°†å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦æµï¼Œä»¥ä¾¿è¯»å†™å­—ç¬¦æ•°æ®ã€‚</li>
<li>javax.servlet.ServletRequestWrapperå’Œjavax.servlet.ServletResponseWrapperç±»ï¼šè¿™ä¸¤ä¸ªç±»æ˜¯ç”¨äºHTTPè¯·æ±‚å’Œå“åº”çš„åŒ…è£…å™¨ç±»ã€‚å®ƒä»¬ä½¿ç”¨é€‚é…å™¨æ¨¡å¼å°†HTTPè¯·æ±‚å’Œå“åº”è½¬æ¢ä¸ºServlet APIä¸­å®šä¹‰çš„æ¥å£ï¼Œä»¥ä¾¿åœ¨Servletä¸­ä½¿ç”¨ã€‚</li>
</ul>
]]></content:encoded>
    </item>
    
    <item>
      <title>å‘¨æŠ¥-22ï½œå¾®ä¿¡è¯»ä¹¦ç¬”è®°åŠ©æ‰‹</title>
      <link>https://blog.chensoul.com/posts/2023/06/09/weekly_review_22/</link>
      <pubDate>Fri, 09 Jun 2023 09:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/06/09/weekly_review_22/</guid>
      <description>å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-05-29 åˆ° 2023-06-04 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚ è¯»ä¹¦ã€å¥èº«ã€å®šæŠ•ã€å¸®æœ‹å‹ã€é™ªå®¶äººï¼Œæœ¬å‘¨å‘¨æŠ¥å¢åŠ ä¸€</description>
      <content:encoded><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p>æœ¬ç¯‡æ˜¯å¯¹ <code>2023-05-29</code> åˆ° <code>2023-06-04</code> è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº <a href="https://blog.chensoul.com/">åšå®¢</a>ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚</p>
<p>è¯»ä¹¦ã€å¥èº«ã€å®šæŠ•ã€å¸®æœ‹å‹ã€é™ªå®¶äººï¼Œæœ¬å‘¨å‘¨æŠ¥å¢åŠ ä¸€å—å†…å®¹ï¼šè¯»ä¹¦ï¼Œè®°å½•æ¯å‘¨è¯»ä¹¦çš„æ—¶é—´ã€‚</p>
<h2 id="å¾®ä¿¡è¯»ä¹¦ç¬”è®°åŠ©æ‰‹">å¾®ä¿¡è¯»ä¹¦ç¬”è®°åŠ©æ‰‹</h2>
<p>æœ€è¿‘æ³¨é”€äº†å¾®ä¿¡é˜…è¯»è´¦å·ï¼Œæ¸…ç©ºäº†å†å²æ•°æ®ã€‚æœ¬ç€å®ç¼ºæ¯‹æ»¥çš„åŸåˆ™ï¼Œä¹¦æ¶é‡æ–°æ·»åŠ äº†å‡ æœ¬ä¹¦ã€‚è®¡åˆ’æ˜¯é‡æ–°ä½¿ç”¨å¾®ä¿¡é˜…è¯»å…»æˆè¯»ä¹¦çš„ä¹ æƒ¯ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-22-03.png" alt="weekly-review-22-03"  />
</p>
<p>åœ¨chromeæµè§ˆå™¨æ·»åŠ äº†ä¸€ä¸ªæ’ä»¶ <a href="https://chrome.google.com/webstore/detail/%E5%BE%AE%E4%BF%A1%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E5%8A%A9%E6%89%8B/cmlenojlebcodibpdhmklglnbaghpdcg">å¾®ä¿¡è¯»ä¹¦ç¬”è®°åŠ©æ‰‹</a> ï¼Œå¯ä»¥å°†è¯»ä¹¦ç¬”è®°ä¸€é”®å¯¼å‡ºä¸º markdown æ ¼å¼ã€‚</p>
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-22-02.png" alt="weekly-review-22-02" style="width:50%;" />
<p>å¯¼å‡ºçš„å†…å®¹æ ‡æ³¨æ˜¯ä¸€ä¸ªæ ‡æ³¨ä¸€ä¸ªæ®µè½ï¼Œæ®µè½ä¹‹é—´æœ‰ä¸€ä¸ªæ¢è¡Œã€‚æ®µè½åé¢å¯ä»¥æ·»åŠ è‡ªå·±çš„æ€è€ƒï¼ˆæ¯”å¦‚ï¼Œç”¨çº¢è‰²æ ‡æ³¨é¢œè‰²ï¼‰ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-22-07.png" alt="weekly-review-22-07"  />
</p>
<h2 id="è¯»ä¹¦">è¯»ä¹¦</h2>
<p>æœ¬å‘¨é˜…è¯»ç»Ÿè®¡ï¼ˆå›¾ç‰‡æ¥è‡ªå¾®ä¿¡é˜…è¯» app åˆ†äº«ï¼‰ï¼š</p>
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-22-01.png" alt="weekly-review-22-01" style="width:50%;" />
<h2 id="ç†è´¢">ç†è´¢</h2>
<p>è¿™å‘¨æ€»è®¡æ”¯å‡º 2528 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š</p>
<ul>
<li>6æœˆ4æ—¥ï¼š138å…ƒ</li>
<li>6æœˆ3æ—¥ï¼š1650å…ƒï¼ŒåŒ»é™¢çœ‹ç—…1600</li>
<li>6æœˆ2æ—¥ï¼š61å…ƒ</li>
<li>6æœˆ1æ—¥ï¼š0å…ƒ</li>
<li>5æœˆ31æ—¥ï¼š108å…ƒ</li>
<li>5æœˆ30æ—¥ï¼š625å…ƒï¼Œå…¬å¸åœè½¦åœºè´¹ç”¨600</li>
<li>5æœˆ29æ—¥ï¼š41å…ƒ</li>
</ul>
<h2 id="å¥èº«">å¥èº«</h2>
<blockquote>
<p>æˆ‘è·‘è¿‡äº†ä¸€äº›åœ°æ–¹ï¼Œå¸Œæœ›éšç€æ—¶é—´æ¨ç§»ï¼Œåœ°å›¾ç‚¹äº®çš„åœ°æ–¹è¶Šæ¥è¶Šå¤šã€‚2 å¹´é‡Œæˆ‘è·‘è¿‡ 2ä¸ªçœä»½ 2ä¸ªåŸå¸‚ã€‚æ›´å¤šè·‘æ­¥æ•°æ®åœ¨æˆ‘çš„ <a href="https://run.chensoul.com/">è·‘æ­¥</a> ä¸»é¡µã€‚</p>
</blockquote>
<p>æœ¬å‘¨è·‘æ­¥ 42.66 å…¬é‡Œï¼Œæœ€é•¿è·‘æ­¥è·ç¦»ä¸º 9.2 å…¬é‡Œã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-22-04.png" alt="weekly-review-22-04"  />
</p>
<p>æ˜ç»†æ•°æ®å¦‚ä¸‹ï¼š</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-22-05.png" alt="weekly-review-22-05"  />
</p>
<p>åœ¨æœ‹å‹åœˆå‘äº†ä¸€ä¸ª5æœˆè·‘æ­¥500å…¬é‡ŒåŠ¨æ€ï¼Œä¸€ä¸ªé«˜ä¸­åŒå­¦å»ºè®®æˆ‘ä¸è¦è¿‡åº¦è·‘æ­¥ï¼Œæœ€å¥½æ˜¯è·‘æ­¥ä¸€å¤©ä¼‘æ¯ä¸€å¤©ï¼Œä»¥å…ä¼¤äº†è†ç›–ã€‚å—ä»–å½±å“ï¼Œå—ä»–å½±å“ï¼Œ6æœˆ1æ—¥æ²¡æœ‰è·‘æ­¥ï¼Œ6æœˆ3æ—¥å’Œ4æ—¥ï¼Œå¸¦è€çˆ¸å»åŒ»é™¢åšæ£€æŸ¥ï¼Œæ‰€ä»¥æ²¡æœ‰è·‘æ­¥ã€‚ç…§æ­¤çœ‹æ¥ï¼Œ6æœˆè¿ç»­è·‘æ­¥30å¤©ã€ç´¯è®¡200å…¬é‡Œçš„ç›®æ ‡é“å®šæ˜¯å®Œæˆä¸äº†ï¼Œæ‰€ä»¥åŠæ—¶è°ƒæ•´ç›®æ ‡å’Œè®¡åˆ’ï¼Œè¿˜æ˜¯ä»¥é•¿æœŸä¸»ä¹‰çš„æ€è·¯ä¿æŒè·‘æ­¥çš„ä¹ æƒ¯ï¼Œä¸æ±‚æ•°é‡ã€‚</p>
<h2 id="å·¥ä½œ">å·¥ä½œ</h2>
<p>æœ€è¿‘åœ¨å­¦ä¹ çš„å†…å®¹æ¸…å•ï¼š</p>
<ul>
<li><a href="https://github.com/clxering/Effective-Java-3rd-edition-Chinese-English-bilingual/tree/dev">Effective Javaï¼ˆç¬¬ 3 ç‰ˆï¼‰</a></li>
<li><a href="https://java-design-patterns.com/zh/">Java Design Patterns (ä¸­æ–‡)</a></li>
<li><a href="https://realpython.com/">Real Python</a></li>
</ul>
<p>æœ¬å‘¨å®Œæˆå››ç¯‡åšå®¢ï¼š</p>
<ul>
<li>
<p><a href="/posts/2023/06/02/java-design-patterns-visitor/">Javaè®¾è®¡æ¨¡å¼ï¼šVisitor</a></p>
</li>
<li>
<p><a href="/posts/2023/06/01/java-design-patterns-acyclic-visitor/">Javaè®¾è®¡æ¨¡å¼ï¼šAcyclic Visitor</a></p>
</li>
<li>
<p><a href="/posts/2023/06/01/what-is-pip/">[è¯‘]ä½¿ç”¨ Python çš„ pip ç®¡ç†é¡¹ç›®çš„ä¾èµ–å…³ç³»</a></p>
</li>
<li>
<p><a href="/posts/2023/06/01/python-wheels/">[è¯‘]ä»€ä¹ˆæ˜¯ Python Wheelsï¼Œä½ ä¸ºä»€ä¹ˆè¦å…³å¿ƒå®ƒï¼Ÿ</a></p>
</li>
</ul>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-22-06.png" alt="weekly-review-22-06"  />
</p>
<h2 id="æœ¬å‘¨åˆ†äº«">æœ¬å‘¨åˆ†äº«</h2>
<p>å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€<a href="https://t.me/chensoul_share">ChenSoul Share</a>ã€Telegram é¢‘é“æˆ–è€…æˆ‘çš„ <a href="https://memos.chensoul.com/">memos</a> ä¸­ã€‚æˆ‘å†™äº†ä¸€ä¸ª python è„šæœ¬ä» memosè¯»å–æœ€è¿‘ä¸€å‘¨çš„ memos è®°å½•ã€‚</p>
<ul>
<li>ğŸ“Œ<code>2023-05-31</code> çœ‹åˆ°ä¸€ä¸ªå¾ˆé€‚åˆæ–°æ‰‹å…¥é—¨ã€Œæ•°æ®ç»“æ„ä¸ç®—æ³•ã€çš„å¼€æºä¹¦ã€ŠHello ç®—æ³•ã€‹ï¼Œé€šè¿‡åŠ¨ç”»å›¾è§£ç»“æ„åŒ–åœ°è®²è§£æ•°æ®ç»“æ„å’Œç®—æ³•çŸ¥è¯†ï¼Œå†…å®¹æ¸…æ™°æ˜“æ‡‚ã€å­¦ä¹ æ›²çº¿æŒºå¹³æ»‘ï¼Œä»£ç ä¸Šæ”¯æŒ Java,C++, Python, Go, JS, TS, CSharp, Swift ä¸€é”®è¿è¡Œçœ‹æ•ˆæœï¼Œæ¯”å¸‚é¢ä¸Šå–çš„æ™®é€šä¹¦å¥½ä¸å°‘ã€‚ ğŸ¤– <a href="https://hello-algo.com">https://hello-algo.com</a> <code>#memos</code> <code>#skill</code></li>
<li>ğŸ“Œ<code>2023-05-31</code> ä»Šæ—¥é‡ç£…å¼€æºåº“æ¨è - Plane  <a href="https://github.com/makeplane/plane">https://github.com/makeplane/plane</a>  Jira çš„å¼€æºç‰ˆå¹³æ›¿ï¼Œæœ‰å¾ˆå¤šäººéƒ½è®¨åŒ Jiraï¼Œè§‰å¾—å®ƒå¤æ‚éš¾ç”¨ã€‚  Plane å®Œå…¨å¼€æºï¼Œè€Œä¸”ç•Œé¢è¦ç®€æ´èˆ’æœæ˜“ç”¨å¾ˆå¤šã€‚ éƒ¨ç½²æ–¹ä¾¿å¿«æ·, æ”¯æŒ Docker éƒ¨ç½²ã€‚ è¿˜å¾ˆè´´å¿ƒçš„æ”¯æŒä» Github ä»¥åŠ Jira ç›´æ¥å¯¼å…¥ã€‚  æƒ³å°è¯•æ–°çš„é¡¹ç›®ç®¡ç†å·¥å…·çš„æœ‹å‹å¯ä»¥å°è¯•ä¸€ä¸‹ã€‚<code>#memos</code> <code>#tool</code></li>
<li>ğŸ“Œ<code>2023-05-31</code> ã€ŒNext.js åº”ç”¨å¼€å‘å®è·µã€ <a href="https://nextjs-in-action-cn.taonan.lu/">https://nextjs-in-action-cn.taonan.lu/</a>   <code>#memos</code> <code>#web</code></li>
</ul>
<p>ä»¥ä¸Šã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>Javaè®¾è®¡æ¨¡å¼ï¼šVisitor</title>
      <link>https://blog.chensoul.com/posts/2023/06/02/java-design-patterns-visitor/</link>
      <pubDate>Fri, 02 Jun 2023 09:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/06/02/java-design-patterns-visitor/</guid>
      <description>æœ¬æ–‡ä¸»è¦ä»‹ç» Visitor æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚ Java Design Patterns æä¾›äº†å„ç§ Java è®¾è®¡æ¨¡</description>
      <content:encoded><![CDATA[<p>æœ¬æ–‡ä¸»è¦ä»‹ç» Visitor æ¨¡å¼ï¼Œåœ¨ <a href="https://java-design-patterns.com/">Java Design Patterns</a>  ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚</p>
<blockquote>
<p><a href="https://java-design-patterns.com/">Java Design Patterns</a> æä¾›äº†å„ç§ Java è®¾è®¡æ¨¡å¼çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ã€‚è¯¥ç½‘ç«™æ—¨åœ¨å¸®åŠ© Java å¼€å‘äººå‘˜äº†è§£å’Œåº”ç”¨å„ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p>
<p>Java Design Patterns ç½‘ç«™æä¾›äº†å¤šç§è®¾è®¡æ¨¡å¼åˆ†ç±»æ–¹å¼ï¼ŒåŒ…æ‹¬åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational Patternsï¼‰ã€ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternsï¼‰å’Œè¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰ï¼Œä»¥åŠå…¶ä»–ä¸€äº›å¸¸è§çš„æ¨¡å¼ã€‚</p>
<p>å¯¹äºæ¯ä¸ªè®¾è®¡æ¨¡å¼ï¼Œè¯¥ç½‘ç«™æä¾›äº†è¯¦ç»†çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ï¼Œå¹¶ä¸”æä¾›äº†ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ã€‚å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©é€‚åˆè‡ªå·±çš„è®¾è®¡æ¨¡å¼ï¼Œå¹¶ä¸”å¯ä»¥å‚è€ƒç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜æ¥ç†è§£å’Œåº”ç”¨è¯¥æ¨¡å¼ã€‚</p>
<p>æ­¤å¤–ï¼ŒJava Design Patterns ç½‘ç«™è¿˜æä¾›äº†ä¸€äº›å…¶ä»–èµ„æºï¼Œå¦‚è®¾è®¡æ¨¡å¼çš„ UML å›¾ã€è®¾è®¡æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ã€è®¾è®¡æ¨¡å¼çš„æ¯”è¾ƒç­‰ã€‚è¿™äº›èµ„æºå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨è®¾è®¡æ¨¡å¼ã€‚</p>
<p>ä¸­æ–‡ç½‘ç«™ï¼š<a href="https://java-design-patterns.com/zh/">https://java-design-patterns.com/zh/</a></p>
<p>Github ä¸Šæºç ä»“åº“ï¼ˆéå®˜æ–¹ï¼‰ï¼š<a href="https://github.com/iluwatar/java-design-patterns">https://github.com/iluwatar/java-design-patterns</a></p>
</blockquote>
<h2 id="ç›®çš„">ç›®çš„</h2>
<p>è¡¨ç¤ºè¦åœ¨å¯¹è±¡ç»“æ„çš„å…ƒç´ ä¸Šæ‰§è¡Œçš„æ“ä½œã€‚è®¿é—®è€…å¯è®©ä½ å®šä¹‰æ–°æ“ä½œï¼Œè€Œæ— éœ€æ›´æ”¹å…¶æ‰€æ“ä½œå…ƒç´ çš„ç±»ã€‚</p>
<blockquote>
<p>è®¿é—®è€…æ¨¡å¼çš„ä¸»è¦ç›®çš„æ˜¯åœ¨ä¸æ”¹å˜å¯¹è±¡ç»“æ„çš„å‰æä¸‹ï¼Œå¯¹å¯¹è±¡ç»“æ„ä¸­çš„å…ƒç´ è¿›è¡Œæ–°çš„æ“ä½œã€‚å®ƒé€šè¿‡å°†æ“ä½œä»å¯¹è±¡ç»“æ„ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œä½¿å¾—å¯ä»¥ç‹¬ç«‹åœ°æ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤å¯¹å…ƒç´ çš„æ“ä½œï¼Œè€Œä¸éœ€è¦ä¿®æ”¹å…ƒç´ ç±»æˆ–å¯¹è±¡ç»“æ„ã€‚</p>
<p>è®¿é—®è€…æ¨¡å¼çš„å¦ä¸€ä¸ªç›®çš„æ˜¯å°†å¯¹è±¡ç»“æ„ä¸æ“ä½œè§£è€¦ã€‚åœ¨è®¿é—®è€…æ¨¡å¼ä¸­ï¼Œå…ƒç´ å’Œæ“ä½œåˆ†åˆ«ç”±ä¸åŒçš„ç±»æ¥å®ç°ï¼Œå¹¶ä¸”å…ƒç´ åªæš´éœ²å‡ºæ¥å—è®¿é—®è€…å¯¹è±¡çš„æ¥å£ï¼Œè€Œä¸æ˜¯æš´éœ²å‡ºå…·ä½“çš„å®ç°ç»†èŠ‚ã€‚è¿™æ ·å¯ä»¥é¿å…åœ¨å…ƒç´ ç±»ä¸­æ·»åŠ è¿‡å¤šçš„è¡Œä¸ºï¼Œä»è€Œæé«˜ä»£ç çš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
<p>æœ€åï¼Œè®¿é—®è€…æ¨¡å¼è¿˜å¯ä»¥ç”¨äºå®ç°å¯¹å¤æ‚å¯¹è±¡ç»“æ„çš„éå†ã€‚é€šè¿‡è®¿é—®è€…å¯¹è±¡çš„é€’å½’è°ƒç”¨ï¼Œå¯ä»¥éå†æ•´ä¸ªå¯¹è±¡ç»“æ„ï¼Œå¹¶å¯¹æ¯ä¸ªå…ƒç´ æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚è¿™ç§éå†æ–¹å¼å¯ä»¥æ–¹ä¾¿åœ°å®ç°å¯¹å¤æ‚å¯¹è±¡ç»“æ„çš„åˆ†æå’Œå¤„ç†ã€‚</p>
</blockquote>
<h2 id="è§£é‡Š">è§£é‡Š</h2>
<p>çœŸå®ä¸–ç•Œä¾‹å­</p>
<blockquote>
<p>è€ƒè™‘æœ‰ä¸€ä¸ªå¸¦æœ‰å†›é˜Ÿå•ä½çš„æ ‘å½¢ç»“æ„ã€‚æŒ‡æŒ¥å®˜ä¸‹æœ‰ä¸¤åä¸­å£«ï¼Œæ¯åä¸­å£«ä¸‹æœ‰ä¸‰åå£«å…µã€‚åŸºäºè¿™ä¸ªå±‚çº§ç»“æ„å®ç°è®¿é—®è€…æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åˆ›å»ºä¸æŒ‡æŒ¥å®˜ï¼Œä¸­å£«ï¼Œå£«å…µæˆ–æ‰€æœ‰äººå‘˜äº’åŠ¨çš„æ–°å¯¹è±¡</p>
</blockquote>
<p>é€šä¿—çš„è¯´</p>
<blockquote>
<p>è®¿é—®è€…æ¨¡å¼å®šä¹‰å¯ä»¥åœ¨æ•°æ®ç»“æ„çš„èŠ‚ç‚¹ä¸Šæ‰§è¡Œçš„æ“ä½œã€‚</p>
</blockquote>
<p>ç»´åŸºç™¾ç§‘è¯´</p>
<blockquote>
<p>åœ¨é¢å‘å¯¹è±¡çš„ç¨‹åºè®¾è®¡å’Œè½¯ä»¶å·¥ç¨‹ä¸­ï¼Œè®¿é—®è€…è®¾è®¡æ¨¡å¼æ˜¯ä¸€ç§å°†ç®—æ³•ä¸æ“ä½œå¯¹è±¡çš„ç»“æ„åˆ†ç¦»çš„æ–¹æ³•ã€‚è¿™ç§åˆ†ç¦»çš„å®é™…ç»“æœæ˜¯èƒ½å¤Ÿåœ¨ä¸ä¿®æ”¹ç»“æ„çš„æƒ…å†µä¸‹å‘ç°æœ‰å¯¹è±¡ç»“æ„æ·»åŠ æ–°æ“ä½œã€‚</p>
</blockquote>
<p>è®¿é—®è€…æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸åœ¨ä¸æ”¹å˜å¯¹è±¡ç»“æ„çš„æƒ…å†µä¸‹å®šä¹‰æ–°çš„æ“ä½œã€‚è¯¥æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†æ“ä½œä»å¯¹è±¡ç»“æ„ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå¹¶åœ¨ç‹¬ç«‹çš„è®¿é—®è€…å¯¹è±¡ä¸­è¿›è¡Œå®ç°ã€‚</p>
<p>è®¿é—®è€…æ¨¡å¼ç”±ä»¥ä¸‹å‡ ä¸ªå…³é”®å…ƒç´ ç»„æˆï¼š</p>
<ol>
<li>æŠ½è±¡è®¿é—®è€…ï¼ˆVisitorï¼‰ï¼šå®šä¹‰å¯ä»¥è®¿é—®ä¸åŒç±»å‹å…ƒç´ çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„å‚æ•°ç±»å‹ä¸ºå…·ä½“å…ƒç´ ç±»å‹ã€‚</li>
<li>å…·ä½“è®¿é—®è€…ï¼ˆConcreteVisitorï¼‰ï¼šå®ç°æŠ½è±¡è®¿é—®è€…ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œä»¥å®ç°å¯¹å…ƒç´ çš„ä¸åŒæ“ä½œã€‚</li>
<li>æŠ½è±¡å…ƒç´ ï¼ˆElementï¼‰ï¼šå®šä¹‰æ¥å—è®¿é—®è€…å¯¹è±¡çš„æ–¹æ³•ã€‚</li>
<li>å…·ä½“å…ƒç´ ï¼ˆConcreteElementï¼‰ï¼šå®ç°æŠ½è±¡å…ƒç´ ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œä»¥ä¾¿å¯ä»¥æ¥å—è®¿é—®è€…å¯¹è±¡çš„è®¿é—®ã€‚</li>
<li>å¯¹è±¡ç»“æ„ï¼ˆObject Structureï¼‰ï¼šåŒ…å«ä¸€ç»„å…·ä½“å…ƒç´ ï¼Œå¯ä»¥è¢«è®¿é—®è€…å¯¹è±¡éå†ã€‚</li>
</ol>
<p><strong>ç¨‹åºç¤ºä¾‹</strong></p>
<p>ä½¿ç”¨ä¸Šé¢çš„å†›é˜Ÿå•å…ƒçš„ä¾‹å­ï¼Œæˆ‘ä»¬é¦–å…ˆç”±å•ä½å’Œå•ä½è®¿é—®å™¨ç±»å‹ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Unit</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Unit</span><span class="o">[]</span> <span class="n">children</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="nf">Unit</span><span class="o">(</span><span class="n">Unit</span><span class="o">...</span> <span class="n">children</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="o">.</span><span class="na">children</span> <span class="o">=</span> <span class="n">children</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="n">UnitVisitor</span> <span class="n">visitor</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Arrays</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">children</span><span class="o">).</span><span class="na">forEach</span><span class="o">(</span><span class="n">child</span> <span class="o">-&gt;</span> <span class="n">child</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">visitor</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UnitVisitor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kt">void</span> <span class="nf">visitSoldier</span><span class="o">(</span><span class="n">Soldier</span> <span class="n">soldier</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kt">void</span> <span class="nf">visitSergeant</span><span class="o">(</span><span class="n">Sergeant</span> <span class="n">sergeant</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kt">void</span> <span class="nf">visitCommander</span><span class="o">(</span><span class="n">Commander</span> <span class="n">commander</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ç„¶åæˆ‘ä»¬æœ‰å…·ä½“çš„å•å…ƒã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Commander</span> <span class="kd">extends</span> <span class="n">Unit</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="nf">Commander</span><span class="o">(</span><span class="n">Unit</span><span class="o">...</span> <span class="n">children</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">super</span><span class="o">(</span><span class="n">children</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="n">UnitVisitor</span> <span class="n">visitor</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">visitor</span><span class="o">.</span><span class="na">visitCommander</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">super</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">visitor</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s">&#34;commander&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Sergeant</span> <span class="kd">extends</span> <span class="n">Unit</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="nf">Sergeant</span><span class="o">(</span><span class="n">Unit</span><span class="o">...</span> <span class="n">children</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">super</span><span class="o">(</span><span class="n">children</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="n">UnitVisitor</span> <span class="n">visitor</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">visitor</span><span class="o">.</span><span class="na">visitSergeant</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">super</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">visitor</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s">&#34;sergeant&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Soldier</span> <span class="kd">extends</span> <span class="n">Unit</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="nf">Soldier</span><span class="o">(</span><span class="n">Unit</span><span class="o">...</span> <span class="n">children</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">super</span><span class="o">(</span><span class="n">children</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="n">UnitVisitor</span> <span class="n">visitor</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">visitor</span><span class="o">.</span><span class="na">visitSoldier</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">super</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">visitor</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s">&#34;soldier&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ç„¶åæœ‰ä¸€äº›å…·ä½“çš„è®¿é—®è€…ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CommanderVisitor</span> <span class="kd">implements</span> <span class="n">UnitVisitor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">LOGGER</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">CommanderVisitor</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">visitSoldier</span><span class="o">(</span><span class="n">Soldier</span> <span class="n">soldier</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Do nothing
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">visitSergeant</span><span class="o">(</span><span class="n">Sergeant</span> <span class="n">sergeant</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Do nothing
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">visitCommander</span><span class="o">(</span><span class="n">Commander</span> <span class="n">commander</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;Good to see you {}&#34;</span><span class="o">,</span> <span class="n">commander</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SergeantVisitor</span> <span class="kd">implements</span> <span class="n">UnitVisitor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">LOGGER</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">SergeantVisitor</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">visitSoldier</span><span class="o">(</span><span class="n">Soldier</span> <span class="n">soldier</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Do nothing
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">visitSergeant</span><span class="o">(</span><span class="n">Sergeant</span> <span class="n">sergeant</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;Hello {}&#34;</span><span class="o">,</span> <span class="n">sergeant</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">visitCommander</span><span class="o">(</span><span class="n">Commander</span> <span class="n">commander</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Do nothing
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SoldierVisitor</span> <span class="kd">implements</span> <span class="n">UnitVisitor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">LOGGER</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">SoldierVisitor</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">visitSoldier</span><span class="o">(</span><span class="n">Soldier</span> <span class="n">soldier</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;Greetings {}&#34;</span><span class="o">,</span> <span class="n">soldier</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">visitSergeant</span><span class="o">(</span><span class="n">Sergeant</span> <span class="n">sergeant</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Do nothing
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">visitCommander</span><span class="o">(</span><span class="n">Commander</span> <span class="n">commander</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Do nothing
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æœ€åï¼Œæ¥çœ‹çœ‹å®è·µä¸­è®¿é—®è€…æ¨¡å¼çš„åŠ›é‡ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">commander</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="k">new</span> <span class="n">SoldierVisitor</span><span class="o">());</span>
</span></span><span class="line"><span class="cl"><span class="n">commander</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="k">new</span> <span class="n">SergeantVisitor</span><span class="o">());</span>
</span></span><span class="line"><span class="cl"><span class="n">commander</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="k">new</span> <span class="n">CommanderVisitor</span><span class="o">());</span>
</span></span></code></pre></div><p>ç¨‹åºè¾“å‡º:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">Greetings soldier
</span></span><span class="line"><span class="cl">Greetings soldier
</span></span><span class="line"><span class="cl">Greetings soldier
</span></span><span class="line"><span class="cl">Greetings soldier
</span></span><span class="line"><span class="cl">Greetings soldier
</span></span><span class="line"><span class="cl">Greetings soldier
</span></span><span class="line"><span class="cl">Hello sergeant
</span></span><span class="line"><span class="cl">Hello sergeant
</span></span><span class="line"><span class="cl">Good to see you commander
</span></span></code></pre></div><h2 id="ç±»å›¾">ç±»å›¾</h2>
<p><img loading="lazy" src="https://java-design-patterns.com/assets/visitor_1-c6c51c6b.png" alt="alt text"  />
</p>
<h2 id="ä¼˜ç¼ºç‚¹">ä¼˜ç¼ºç‚¹</h2>
<p>è®¿é—®è€…æ¨¡å¼çš„ä¼˜ç‚¹ï¼š</p>
<ol>
<li>æ‰©å±•æ€§å¥½ï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥é€šè¿‡å¢åŠ æ–°çš„è®¿é—®è€…ç±»æ¥æ‰©å±•å¯¹å¯¹è±¡ç»“æ„çš„æ“ä½œï¼Œè€Œæ— éœ€ä¿®æ”¹å¯¹è±¡ç»“æ„æˆ–å…ƒç´ ç±»ã€‚</li>
<li>åˆ†ç¦»å…³æ³¨ç‚¹ï¼šè®¿é—®è€…æ¨¡å¼å°†å¯¹è±¡ç»“æ„å’Œå¯¹å¯¹è±¡ç»“æ„çš„æ“ä½œåˆ†ç¦»å¼€æ¥ï¼Œä½¿å¾—å¯¹è±¡ç»“æ„å’Œè®¿é—®è€…ç±»å¯ä»¥ç‹¬ç«‹å‘å±•ã€‚è¿™æ ·å¯ä»¥æé«˜ä»£ç çš„å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</li>
<li>çµæ´»æ€§é«˜ï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥æ”¯æŒä¸åŒçš„è®¿é—®è€…å¯¹è±¡å¯¹åŒä¸€å¯¹è±¡ç»“æ„è¿›è¡Œä¸åŒçš„éå†å’Œæ“ä½œï¼Œä»è€Œå¯ä»¥å®ç°å¤šç§ä¸åŒçš„å¤„ç†æ–¹å¼ã€‚</li>
<li>ç¬¦åˆå¼€é—­åŸåˆ™ï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥é€šè¿‡å¢åŠ æ–°çš„å…ƒç´ ç±»å’Œè®¿é—®è€…ç±»æ¥æ‰©å±•ç³»ç»Ÿçš„åŠŸèƒ½ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹ç°æœ‰çš„ä»£ç ã€‚</li>
</ol>
<p>è®¿é—®è€…æ¨¡å¼çš„ç¼ºç‚¹ï¼š</p>
<ol>
<li>å®ç°å¤æ‚ï¼šè®¿é—®è€…æ¨¡å¼çš„å®ç°æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦å®šä¹‰å¤šä¸ªæ¥å£å’Œç±»ï¼Œå¹¶ä¸”éœ€è¦å¯¹å¯¹è±¡ç»“æ„è¿›è¡Œé‡æ„ã€‚</li>
<li>è¿åå°è£…åŸåˆ™ï¼šè®¿é—®è€…æ¨¡å¼éœ€è¦å°†è®¿é—®è€…å¯¹è±¡æš´éœ²ç»™å…ƒç´ ç±»ï¼Œä»è€Œç ´åäº†å…ƒç´ ç±»çš„å°è£…æ€§ã€‚</li>
<li>å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼šè®¿é—®è€…æ¨¡å¼éœ€è¦å¯¹æ•´ä¸ªå¯¹è±¡ç»“æ„è¿›è¡Œéå†ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚</li>
<li>ä¸æ˜“ç†è§£ï¼šè®¿é—®è€…æ¨¡å¼çš„å®ç°æ¯”è¾ƒæŠ½è±¡ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§é™ä½ã€‚</li>
</ol>
<p>æ€»ä¹‹ï¼Œè®¿é—®è€…æ¨¡å¼å¯ä»¥æé«˜ç³»ç»Ÿçš„æ‰©å±•æ€§å’Œçµæ´»æ€§ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„å®ç°çš„å¤æ‚æ€§å’Œæ€§èƒ½é—®é¢˜ï¼Œå¹¶ä¸”éœ€è¦æƒè¡¡å°è£…æ€§å’Œå¯è¯»æ€§ä¹‹é—´çš„å…³ç³»ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œåº”è¯¥æ ¹æ®å…·ä½“çš„éœ€æ±‚å’Œåœºæ™¯æ¥é€‰æ‹©æ˜¯å¦ä½¿ç”¨è®¿é—®è€…æ¨¡å¼ã€‚</p>
<h2 id="å¯¹æ¯”">å¯¹æ¯”</h2>
<p>è®¿é—®è€…æ¨¡å¼å’Œ Acyclic Visitor è®¾è®¡æ¨¡å¼éƒ½æ˜¯ç”¨äºå¤„ç†å¯¹è±¡ç»“æ„ä¸­çš„å…ƒç´ ï¼Œä½†å®ƒä»¬çš„å®ç°æ–¹å¼å’Œåº”ç”¨åœºæ™¯æœ‰æ‰€ä¸åŒã€‚</p>
<p>è®¿é—®è€…æ¨¡å¼é€šè¿‡åœ¨å…ƒç´ ç±»ä¸­å®šä¹‰ä¸€ä¸ª accept æ–¹æ³•ï¼Œæ¥å—ä¸€ä¸ªè®¿é—®è€…å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œä»è€Œå°†å…ƒç´ çš„å¤„ç†å§”æ‰˜ç»™è®¿é—®è€…å¯¹è±¡æ¥å®Œæˆã€‚è®¿é—®è€…å¯¹è±¡é€šå¸¸å®šä¹‰äº†å¤šä¸ª visit æ–¹æ³•ï¼Œåˆ†åˆ«å¯¹åº”ä¸åŒç±»å‹çš„å…ƒç´ ï¼Œä»è€Œå¯ä»¥æ ¹æ®å…ƒç´ çš„ç±»å‹æ¥æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚</p>
<p>Acyclic Visitor è®¾è®¡æ¨¡å¼æ˜¯è®¿é—®è€…æ¨¡å¼çš„ä¸€ç§å˜ç§ï¼Œå®ƒé€šè¿‡åœ¨è®¿é—®è€…ç±»ä¸­å®šä¹‰æŠ½è±¡è®¿é—®è€…ç±»å’Œå…·ä½“è®¿é—®è€…ç±»æ¥å®ç°ã€‚æŠ½è±¡è®¿é—®è€…ç±»å®šä¹‰äº† visit æ–¹æ³•ï¼Œä½†ä¸åŒ…å«ä»»ä½•å…·ä½“çš„ visit æ–¹æ³•å®ç°ï¼Œè€Œå…·ä½“è®¿é—®è€…ç±»åˆ™å®ç°äº†å…·ä½“çš„ visit æ–¹æ³•ã€‚è¿™æ ·å¯ä»¥é¿å…è®¿é—®è€…å¯¹è±¡å¯¹å…ƒç´ ç±»çš„ä¾èµ–ï¼Œä»è€Œå®ç°æ¾è€¦åˆã€‚</p>
<p>Acyclic Visitor è®¾è®¡æ¨¡å¼é€šå¸¸ç”¨äºå¤„ç†å¤šç»§æ‰¿çš„å¯¹è±¡ç»“æ„ï¼Œå› ä¸ºå¤šç»§æ‰¿å¯èƒ½ä¼šå¯¼è‡´è®¿é—®è€…å¯¹è±¡å¯¹å…ƒç´ ç±»çš„ä¾èµ–ã€‚åœ¨å¤šç»§æ‰¿çš„æƒ…å†µä¸‹ï¼Œå…ƒç´ ç±»å¯èƒ½åŒæ—¶ç»§æ‰¿äº†å¤šä¸ªæ¥å£æˆ–çˆ¶ç±»ï¼Œè¿™æ ·è®¿é—®è€…å¯¹è±¡å°±éœ€è¦å¯¹æ¯ä¸ªæ¥å£æˆ–çˆ¶ç±»éƒ½å®šä¹‰ä¸€ä¸ª visit æ–¹æ³•ï¼Œä»è€Œå¯¼è‡´è®¿é—®è€…å¯¹è±¡å¯¹å…ƒç´ ç±»çš„ä¾èµ–æ€§å¢åŠ ã€‚</p>
<p>æ€»ä¹‹ï¼Œè®¿é—®è€…æ¨¡å¼å’Œ Acyclic Visitor è®¾è®¡æ¨¡å¼éƒ½æ˜¯ç”¨äºå¤„ç†å¯¹è±¡ç»“æ„ä¸­çš„å…ƒç´ ï¼Œä½†å®ƒä»¬çš„å®ç°æ–¹å¼å’Œåº”ç”¨åœºæ™¯æœ‰æ‰€ä¸åŒã€‚è®¿é—®è€…æ¨¡å¼é€‚ç”¨äºå¤„ç†å•ç»§æ‰¿çš„å¯¹è±¡ç»“æ„ï¼Œè€Œ Acyclic Visitor è®¾è®¡æ¨¡å¼é€‚ç”¨äºå¤„ç†å¤šç»§æ‰¿çš„å¯¹è±¡ç»“æ„ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œåº”è¯¥æ ¹æ®å…·ä½“çš„éœ€æ±‚å’Œåœºæ™¯æ¥é€‰æ‹©ä½¿ç”¨å“ªç§æ¨¡å¼ã€‚</p>
<h2 id="é€‚ç”¨åœºæ™¯">é€‚ç”¨åœºæ™¯</h2>
<p>è®¿é—®è€…æ¨¡å¼é€‚ç”¨äºä»¥ä¸‹æƒ…å†µï¼š</p>
<ol>
<li>å¯¹è±¡ç»“æ„å¤æ‚ï¼ŒåŒ…å«å¤šç§ç±»å‹çš„å…ƒç´ ï¼Œå¹¶ä¸”éœ€è¦å¯¹è¿™äº›å…ƒç´ è¿›è¡Œä¸åŒçš„æ“ä½œã€‚</li>
<li>éœ€è¦åœ¨ä¸æ”¹å˜å¯¹è±¡ç»“æ„çš„å‰æä¸‹ï¼Œå¢åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤å¯¹å…ƒç´ çš„æ“ä½œã€‚</li>
<li>å¯¹è±¡ç»“æ„ä¸­çš„å…ƒç´ ç±»ç»å¸¸å‘ç”Ÿå˜åŒ–ï¼Œè€Œè®¿é—®è€…ç±»çš„å˜åŒ–è¾ƒå°‘ã€‚</li>
<li>éœ€è¦å¯¹å¯¹è±¡ç»“æ„è¿›è¡Œå¤šç§ä¸åŒçš„éå†æ–¹å¼ï¼Œå¹¶ä¸”æ¯ç§éå†æ–¹å¼éœ€è¦æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚</li>
<li>å¯¹è±¡ç»“æ„ä¸­çš„å…ƒç´ ç±»ä¸å¸Œæœ›æš´éœ²å‡ºå¤ªå¤šçš„è¡Œä¸ºï¼Œè€Œæ˜¯å¸Œæœ›å°†è¡Œä¸ºå°è£…åœ¨è®¿é—®è€…ç±»ä¸­ã€‚</li>
</ol>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè®¿é—®è€…æ¨¡å¼çš„å®ç°æ¯”è¾ƒå¤æ‚ï¼Œå› æ­¤åªæœ‰åœ¨ç¡®å®éœ€è¦å¯¹å¯¹è±¡ç»“æ„è¿›è¡Œå¤æ‚æ“ä½œæ—¶æ‰åº”è¯¥è€ƒè™‘ä½¿ç”¨è¯¥æ¨¡å¼ã€‚å¦‚æœä»…éœ€è¦å¯¹å¯¹è±¡ç»“æ„è¿›è¡Œç®€å•çš„éå†æˆ–æ“ä½œï¼Œåˆ™å¯ä»¥è€ƒè™‘ä½¿ç”¨å…¶ä»–æ¨¡å¼ï¼Œå¦‚è¿­ä»£å™¨æ¨¡å¼æˆ–ç»„åˆæ¨¡å¼ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›è®¿é—®è€…æ¨¡å¼åœ¨å®é™…å¼€å‘ä¸­çš„åº”ç”¨åœºæ™¯ï¼š</p>
<ol>
<li>ç¼–è¯‘å™¨å’Œè§£é‡Šå™¨ï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥ç”¨äºå®ç°ç¼–è¯‘å™¨å’Œè§£é‡Šå™¨ã€‚ç¼–è¯‘å™¨å’Œè§£é‡Šå™¨éƒ½éœ€è¦å¯¹æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰è¿›è¡Œéå†ï¼Œå¹¶æ ¹æ®ä¸åŒçš„èŠ‚ç‚¹ç±»å‹æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚è®¿é—®è€…æ¨¡å¼å¯ä»¥å°†è¿™äº›æ“ä½œå°è£…åœ¨ä¸åŒçš„è®¿é—®è€…ç±»ä¸­ï¼Œä»è€Œå®ç°å¯¹ASTçš„éå†å’Œå¤„ç†ã€‚</li>
<li>æ•°æ®åº“æŸ¥è¯¢ï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥ç”¨äºå®ç°æ•°æ®åº“æŸ¥è¯¢ã€‚æ•°æ®åº“æŸ¥è¯¢éœ€è¦å¯¹æŸ¥è¯¢è¯­å¥è¿›è¡Œè§£æï¼Œå¹¶å°†æŸ¥è¯¢è½¬æ¢ä¸ºå¯¹æ•°æ®åº“ä¸­çš„è¡¨è¿›è¡Œæ“ä½œçš„è¯­å¥ã€‚è®¿é—®è€…æ¨¡å¼å¯ä»¥å°†æŸ¥è¯¢è§£æå’Œè½¬æ¢æ“ä½œå°è£…åœ¨ä¸åŒçš„è®¿é—®è€…ç±»ä¸­ï¼Œä»è€Œå®ç°å¯¹æŸ¥è¯¢è¯­å¥çš„å¤„ç†ã€‚</li>
<li>GUIæ¡†æ¶ï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥ç”¨äºå®ç°GUIæ¡†æ¶ã€‚GUIæ¡†æ¶éœ€è¦å¯¹å„ç§GUIç»„ä»¶è¿›è¡Œéå†ï¼Œå¹¶æ ¹æ®ä¸åŒçš„ç»„ä»¶ç±»å‹æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚è®¿é—®è€…æ¨¡å¼å¯ä»¥å°†è¿™äº›æ“ä½œå°è£…åœ¨ä¸åŒçš„è®¿é—®è€…ç±»ä¸­ï¼Œä»è€Œå®ç°å¯¹GUIç»„ä»¶çš„éå†å’Œå¤„ç†ã€‚</li>
<li>è®¢å•å¤„ç†ç³»ç»Ÿï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥ç”¨äºå®ç°è®¢å•å¤„ç†ç³»ç»Ÿã€‚è®¢å•å¤„ç†ç³»ç»Ÿéœ€è¦å¯¹è®¢å•ä¸­çš„å„ç§é¡¹è¿›è¡Œéå†ï¼Œå¹¶æ ¹æ®ä¸åŒçš„é¡¹ç±»å‹æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚è®¿é—®è€…æ¨¡å¼å¯ä»¥å°†è¿™äº›æ“ä½œå°è£…åœ¨ä¸åŒçš„è®¿é—®è€…ç±»ä¸­ï¼Œä»è€Œå®ç°å¯¹è®¢å•çš„éå†å’Œå¤„ç†ã€‚</li>
<li>æœºå™¨å­¦ä¹ ï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥ç”¨äºå®ç°æœºå™¨å­¦ä¹ ç®—æ³•ã€‚æœºå™¨å­¦ä¹ ç®—æ³•éœ€è¦å¯¹æ•°æ®é›†è¿›è¡Œéå†ï¼Œå¹¶æ ¹æ®ä¸åŒçš„æ•°æ®ç±»å‹æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚è®¿é—®è€…æ¨¡å¼å¯ä»¥å°†è¿™äº›æ“ä½œå°è£…åœ¨ä¸åŒçš„è®¿é—®è€…ç±»ä¸­ï¼Œä»è€Œå®ç°å¯¹æ•°æ®é›†çš„éå†å’Œå¤„ç†ã€‚</li>
<li>è™šæ‹Ÿæœºï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥ç”¨äºå®ç°è™šæ‹Ÿæœºã€‚è™šæ‹Ÿæœºéœ€è¦å¯¹å­—èŠ‚ç æˆ–ä¸­é—´ä»£ç è¿›è¡Œéå†ï¼Œå¹¶æ ¹æ®ä¸åŒçš„æŒ‡ä»¤ç±»å‹æ‰§è¡Œä¸åŒçš„æ“ä½œã€‚è®¿é—®è€…æ¨¡å¼å¯ä»¥å°†è¿™äº›æ“ä½œå°è£…åœ¨ä¸åŒçš„è®¿é—®è€…ç±»ä¸­ï¼Œä»è€Œå®ç°å¯¹å­—èŠ‚ç æˆ–ä¸­é—´ä»£ç çš„éå†å’Œå¤„ç†ã€‚</li>
<li>å¤šåª’ä½“ç¼–è§£ç å™¨ï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥ç”¨äºå®ç°å¤šåª’ä½“ç¼–è§£ç å™¨ã€‚å¤šåª’ä½“ç¼–è§£ç å™¨éœ€è¦å¯¹éŸ³è§†é¢‘æ•°æ®è¿›è¡Œéå†ï¼Œå¹¶æ ¹æ®ä¸åŒçš„æ•°æ®ç±»å‹æ‰§è¡Œä¸åŒçš„ç¼–è§£ç æ“ä½œã€‚è®¿é—®è€…æ¨¡å¼å¯ä»¥å°†è¿™äº›æ“ä½œå°è£…åœ¨ä¸åŒçš„è®¿é—®è€…ç±»ä¸­ï¼Œä»è€Œå®ç°å¯¹éŸ³è§†é¢‘æ•°æ®çš„éå†å’Œå¤„ç†ã€‚</li>
<li>å›¾åƒå¤„ç†è½¯ä»¶ï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥ç”¨äºå®ç°å›¾åƒå¤„ç†è½¯ä»¶ã€‚å›¾åƒå¤„ç†è½¯ä»¶éœ€è¦å¯¹å›¾åƒè¿›è¡Œéå†ï¼Œå¹¶æ ¹æ®ä¸åŒçš„åƒç´ ç±»å‹æ‰§è¡Œä¸åŒçš„å¤„ç†æ“ä½œã€‚è®¿é—®è€…æ¨¡å¼å¯ä»¥å°†è¿™äº›æ“ä½œå°è£…åœ¨ä¸åŒçš„è®¿é—®è€…ç±»ä¸­ï¼Œä»è€Œå®ç°å¯¹å›¾åƒçš„éå†å’Œå¤„ç†ã€‚</li>
<li>ç½‘ç»œåè®®è§£æå™¨ï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥ç”¨äºå®ç°ç½‘ç»œåè®®è§£æå™¨ã€‚ç½‘ç»œåè®®è§£æå™¨éœ€è¦å¯¹ç½‘ç»œæ•°æ®åŒ…è¿›è¡Œéå†ï¼Œå¹¶æ ¹æ®ä¸åŒçš„åè®®ç±»å‹æ‰§è¡Œä¸åŒçš„è§£ææ“ä½œã€‚è®¿é—®è€…æ¨¡å¼å¯ä»¥å°†è¿™äº›æ“ä½œå°è£…åœ¨ä¸åŒçš„è®¿é—®è€…ç±»ä¸­ï¼Œä»è€Œå®ç°å¯¹ç½‘ç»œæ•°æ®åŒ…çš„éå†å’Œå¤„ç†ã€‚</li>
<li>CADè½¯ä»¶ï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥ç”¨äºå®ç°CADè½¯ä»¶ã€‚CADè½¯ä»¶éœ€è¦å¯¹ç»˜å›¾å…ƒç´ è¿›è¡Œéå†ï¼Œå¹¶æ ¹æ®ä¸åŒçš„å…ƒç´ ç±»å‹æ‰§è¡Œä¸åŒçš„æ“ä½œï¼Œæ¯”å¦‚ç»˜åˆ¶çº¿æ¡ã€å¡«å……é¢œè‰²ç­‰ã€‚è®¿é—®è€…æ¨¡å¼å¯ä»¥å°†è¿™äº›æ“ä½œå°è£…åœ¨ä¸åŒçš„è®¿é—®è€…ç±»ä¸­ï¼Œä»è€Œå®ç°å¯¹ç»˜å›¾å…ƒç´ çš„éå†å’Œå¤„ç†ã€‚</li>
<li>ä»£ç ç”Ÿæˆå™¨ï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥ç”¨äºå®ç°ä»£ç ç”Ÿæˆå™¨ã€‚ä»£ç ç”Ÿæˆå™¨éœ€è¦å¯¹æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰è¿›è¡Œéå†ï¼Œå¹¶æ ¹æ®ä¸åŒçš„èŠ‚ç‚¹ç±»å‹ç”Ÿæˆä¸åŒçš„ä»£ç ã€‚è®¿é—®è€…æ¨¡å¼å¯ä»¥å°†ä»£ç ç”Ÿæˆæ“ä½œå°è£…åœ¨ä¸åŒçš„è®¿é—®è€…ç±»ä¸­ï¼Œä»è€Œå®ç°å¯¹ASTçš„éå†å’Œä»£ç ç”Ÿæˆã€‚</li>
<li>ç¯å¢ƒç›‘æµ‹ç³»ç»Ÿï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥ç”¨äºå®ç°ç¯å¢ƒç›‘æµ‹ç³»ç»Ÿã€‚ç¯å¢ƒç›‘æµ‹ç³»ç»Ÿéœ€è¦å¯¹å¤šä¸ªä¼ æ„Ÿå™¨é‡‡é›†çš„æ•°æ®è¿›è¡Œéå†ï¼Œå¹¶æ ¹æ®ä¸åŒçš„ä¼ æ„Ÿå™¨ç±»å‹æ‰§è¡Œä¸åŒçš„å¤„ç†æ“ä½œï¼Œæ¯”å¦‚æ¸©åº¦æ ¡å‡†ã€æ•°æ®å­˜å‚¨ç­‰ã€‚è®¿é—®è€…æ¨¡å¼å¯ä»¥å°†è¿™äº›æ“ä½œå°è£…åœ¨ä¸åŒçš„è®¿é—®è€…ç±»ä¸­ï¼Œä»è€Œå®ç°å¯¹ä¼ æ„Ÿå™¨æ•°æ®çš„éå†å’Œå¤„ç†ã€‚</li>
<li>æ•°å­—ä¿¡å·å¤„ç†ç³»ç»Ÿï¼šè®¿é—®è€…æ¨¡å¼å¯ä»¥ç”¨äºå®ç°æ•°å­—ä¿¡å·å¤„ç†ç³»ç»Ÿã€‚æ•°å­—ä¿¡å·å¤„ç†ç³»ç»Ÿéœ€è¦å¯¹æ•°å­—ä¿¡å·è¿›è¡Œéå†ï¼Œå¹¶æ ¹æ®ä¸åŒçš„ä¿¡å·ç±»å‹æ‰§è¡Œä¸åŒçš„å¤„ç†æ“ä½œï¼Œæ¯”å¦‚æ»¤æ³¢ã€é™å™ªç­‰ã€‚è®¿é—®è€…æ¨¡å¼å¯ä»¥å°†è¿™äº›æ“ä½œå°è£…åœ¨ä¸åŒçš„è®¿é—®è€…ç±»ä¸­ï¼Œä»è€Œå®ç°å¯¹æ•°å­—ä¿¡å·çš„éå†å’Œå¤„ç†ã€‚</li>
</ol>
<p>è®¿é—®è€…æ¨¡å¼åœ¨ JDK ä¸­æœ‰å¤šä¸ªåº”ç”¨ï¼Œä»¥ä¸‹æ˜¯å…¶ä¸­ä¸€äº›ä¾‹å­ï¼š</p>
<ol>
<li>Java ä¸­çš„ java.nio.file.FileVisitor æ¥å£å’Œ java.nio.file.Files#walkFileTree æ–¹æ³•ï¼Œå…¶ä¸­çš„ FileVisitor æ¥å£å®šä¹‰äº†å¤šä¸ª visit æ–¹æ³•ï¼Œç”¨äºè®¿é—®æ–‡ä»¶æ ‘ä¸­çš„å„ä¸ªèŠ‚ç‚¹å¯¹è±¡ã€‚Files#walkFileTree æ–¹æ³•å¯ä»¥é€šè¿‡è®¿é—®è€…æ¨¡å¼æ¥å®ç°éå†æ–‡ä»¶æ ‘å¹¶å¯¹æ¯ä¸ªæ–‡ä»¶è¿›è¡Œå¤„ç†ã€‚</li>
<li>javax.lang.model.element.AnnotationValueVisitor æ¥å£ï¼Œç”¨äºè®¿é—®æ³¨è§£å€¼çš„å„ç§ç±»å‹ï¼Œä¾‹å¦‚åŸºæœ¬ç±»å‹ã€å­—ç¬¦ä¸²ã€æšä¸¾ç±»å‹ã€æ•°ç»„ç±»å‹å’ŒåµŒå¥—æ³¨è§£ç±»å‹ç­‰ã€‚è¯¥æ¥å£ä¸­å®šä¹‰äº†å¤šä¸ª visit æ–¹æ³•ï¼Œç”¨äºå¤„ç†ä¸åŒç±»å‹çš„æ³¨è§£å€¼ã€‚</li>
<li>javax.lang.model.element.ElementVisitor æ¥å£ï¼Œç”¨äºè®¿é—®ç¨‹åºå…ƒç´ çš„å„ç§ç±»å‹ï¼Œä¾‹å¦‚åŒ…ã€ç±»ã€æ–¹æ³•ã€å­—æ®µã€æ³¨è§£å’Œæ³¨è§£å€¼ç­‰ã€‚è¯¥æ¥å£ä¸­å®šä¹‰äº†å¤šä¸ª visit æ–¹æ³•ï¼Œç”¨äºå¤„ç†ä¸åŒç±»å‹çš„ç¨‹åºå…ƒç´ ã€‚</li>
<li>javax.lang.model.type.TypeVisitor æ¥å£ï¼Œç”¨äºè®¿é—®ç±»å‹çš„å„ç§ç±»å‹ï¼Œä¾‹å¦‚åŸºæœ¬ç±»å‹ã€å¯¹è±¡ç±»å‹ã€æ•°ç»„ç±»å‹å’Œæ³›å‹ç±»å‹ç­‰ã€‚è¯¥æ¥å£ä¸­å®šä¹‰äº†å¤šä¸ª visit æ–¹æ³•ï¼Œç”¨äºå¤„ç†ä¸åŒç±»å‹çš„ç±»å‹ã€‚</li>
</ol>
<p>æ€»ä¹‹ï¼Œè®¿é—®è€…æ¨¡å¼å¯ä»¥é€‚ç”¨äºå„ç§ä¸åŒçš„é¢†åŸŸå’Œåœºæ™¯ï¼Œåªè¦éœ€è¦å¯¹å¯¹è±¡ç»“æ„è¿›è¡Œéå†å’Œå¤„ç†ï¼Œéƒ½å¯ä»¥è€ƒè™‘ä½¿ç”¨è¯¥æ¨¡å¼ã€‚</p>
<h2 id="ä¸¾ä¾‹">ä¸¾ä¾‹</h2>
<h3 id="è®¡ç®—å›¾å½¢é¢ç§¯å’Œå‘¨é•¿">è®¡ç®—å›¾å½¢é¢ç§¯å’Œå‘¨é•¿</h3>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå›¾å½¢ç±» Shapeï¼Œå®ƒæœ‰ä¸¤ä¸ªå­ç±» Circle å’Œ Rectangleï¼Œæˆ‘ä»¬éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œé¢ç§¯å’Œå‘¨é•¿çš„è®¡ç®—ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è®¿é—®è€…æ¨¡å¼æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚</p>
<p>æˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸ªæŠ½è±¡è®¿é—®è€…ç±» ShapeVisitorï¼Œå®ƒåŒ…å«äº†ä¸¤ä¸ªæŠ½è±¡æ–¹æ³• visitCircle å’Œ visitRectangleï¼Œåˆ†åˆ«ç”¨äºè®¿é—® Circle å’Œ Rectangle å¯¹è±¡ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// æŠ½è±¡è®¿é—®è€…ç±»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">interface</span> <span class="nc">ShapeVisitor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">visitCircle</span><span class="o">(</span><span class="n">Circle</span> <span class="n">circle</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">visitRectangle</span><span class="o">(</span><span class="n">Rectangle</span> <span class="n">rectangle</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ç„¶åæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæŠ½è±¡çš„å›¾å½¢ç±» Shapeï¼Œå®ƒåŒ…å«ä¸€ä¸ª accept æ–¹æ³•ï¼Œç”¨äºæ¥å—ä¸€ä¸ªè®¿é—®è€…å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// æŠ½è±¡å›¾å½¢ç±»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Shape</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="n">ShapeVisitor</span> <span class="n">visitor</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æ¥ç€æˆ‘ä»¬å®šä¹‰ä¸¤ä¸ªå…·ä½“çš„å›¾å½¢ç±» Circle å’Œ Rectangleï¼Œå®ƒä»¬å®ç°äº† accept æ–¹æ³•ï¼Œå¹¶åœ¨å…¶ä¸­è°ƒç”¨è®¿é—®è€…å¯¹è±¡çš„ visitCircle å’Œ visitRectangle æ–¹æ³•ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// å…·ä½“å›¾å½¢ç±» Circle
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">class</span> <span class="nc">Circle</span> <span class="kd">extends</span> <span class="n">Shape</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">double</span> <span class="n">radius</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Circle</span><span class="o">(</span><span class="kt">double</span> <span class="n">radius</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">radius</span> <span class="o">=</span> <span class="n">radius</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="nf">getRadius</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">radius</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="n">ShapeVisitor</span> <span class="n">visitor</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">visitor</span><span class="o">.</span><span class="na">visitCircle</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å…·ä½“å›¾å½¢ç±» Rectangle
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">class</span> <span class="nc">Rectangle</span> <span class="kd">extends</span> <span class="n">Shape</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">double</span> <span class="n">width</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">double</span> <span class="n">height</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Rectangle</span><span class="o">(</span><span class="kt">double</span> <span class="n">width</span><span class="o">,</span> <span class="kt">double</span> <span class="n">height</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">width</span> <span class="o">=</span> <span class="n">width</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">height</span> <span class="o">=</span> <span class="n">height</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="nf">getWidth</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">width</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="nf">getHeight</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">height</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="n">ShapeVisitor</span> <span class="n">visitor</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">visitor</span><span class="o">.</span><span class="na">visitRectangle</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æœ€åæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå…·ä½“çš„è®¿é—®è€…ç±» ShapeCalculatorï¼Œå®ƒå®ç°äº† ShapeVisitor æ¥å£ï¼Œå¹¶åœ¨å…¶ä¸­å®ç°äº† visitCircle å’Œ visitRectangle æ–¹æ³•ï¼Œç”¨äºè®¡ç®—å›¾å½¢çš„é¢ç§¯å’Œå‘¨é•¿ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// å…·ä½“è®¿é—®è€…ç±» ShapeCalculator
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">class</span> <span class="nc">ShapeCalculator</span> <span class="kd">implements</span> <span class="n">ShapeVisitor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">double</span> <span class="n">area</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">double</span> <span class="n">perimeter</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">visitCircle</span><span class="o">(</span><span class="n">Circle</span> <span class="n">circle</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">double</span> <span class="n">radius</span> <span class="o">=</span> <span class="n">circle</span><span class="o">.</span><span class="na">getRadius</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">area</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">PI</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">radius</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">perimeter</span> <span class="o">=</span> <span class="n">2</span> <span class="o">*</span> <span class="n">Math</span><span class="o">.</span><span class="na">PI</span> <span class="o">*</span> <span class="n">radius</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">visitRectangle</span><span class="o">(</span><span class="n">Rectangle</span> <span class="n">rectangle</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">double</span> <span class="n">width</span> <span class="o">=</span> <span class="n">rectangle</span><span class="o">.</span><span class="na">getWidth</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="kt">double</span> <span class="n">height</span> <span class="o">=</span> <span class="n">rectangle</span><span class="o">.</span><span class="na">getHeight</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">area</span> <span class="o">=</span> <span class="n">width</span> <span class="o">*</span> <span class="n">height</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">perimeter</span> <span class="o">=</span> <span class="n">2</span> <span class="o">*</span> <span class="o">(</span><span class="n">width</span> <span class="o">+</span> <span class="n">height</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="nf">getArea</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">area</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="nf">getPerimeter</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">perimeter</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è®¿é—®è€…æ¨¡å¼æ¥è®¡ç®—å›¾å½¢çš„é¢ç§¯å’Œå‘¨é•¿äº†ã€‚æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ª ShapeCalculator å¯¹è±¡ï¼Œç„¶ååˆ†åˆ«åˆ›å»ºä¸€ä¸ª Circle å¯¹è±¡å’Œä¸€ä¸ª Rectangle å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å®ƒä»¬çš„ accept æ–¹æ³•ï¼Œå°† ShapeCalculator ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ShapeCalculator</span> <span class="n">calculator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ShapeCalculator</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">Circle</span> <span class="n">circle</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Circle</span><span class="o">(</span><span class="n">5</span><span class="o">.</span><span class="na">0</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">circle</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">calculator</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Circle area: &#34;</span> <span class="o">+</span> <span class="n">calculator</span><span class="o">.</span><span class="na">getArea</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Circle perimeter: &#34;</span> <span class="o">+</span> <span class="n">calculator</span><span class="o">.</span><span class="na">getPerimeter</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">Rectangle</span> <span class="n">rectangle</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Rectangle</span><span class="o">(</span><span class="n">3</span><span class="o">.</span><span class="na">0</span><span class="o">,</span> <span class="n">4</span><span class="o">.</span><span class="na">0</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">rectangle</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">calculator</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Rectangle area: &#34;</span> <span class="o">+</span> <span class="n">calculator</span><span class="o">.</span><span class="na">getArea</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Rectangle perimeter: &#34;</span> <span class="o">+</span> <span class="n">calculator</span><span class="o">.</span><span class="na">getPerimeter</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">Circle area: 78.53981633974483
</span></span><span class="line"><span class="cl">Circle perimeter: 31.41592653589793
</span></span><span class="line"><span class="cl">Rectangle area: 12.0
</span></span><span class="line"><span class="cl">Rectangle perimeter: 14.0
</span></span></code></pre></div><p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨è®¿é—®è€…æ¨¡å¼æ¥è®¡ç®—å›¾å½¢çš„é¢ç§¯å’Œå‘¨é•¿ï¼Œæˆ‘ä»¬å°†è®¡ç®—çš„é€»è¾‘å°è£…åœ¨äº† ShapeCalculator ç±»ä¸­ï¼Œå¹¶é€šè¿‡è®¿é—®è€…æ¨¡å¼å°†å®ƒä»¬åº”ç”¨äºä¸åŒçš„å›¾å½¢å¯¹è±¡ã€‚è¿™æ ·å¯ä»¥å®ç°ä»£ç çš„é‡ç”¨å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
<h3 id="å®ç°ä»£ç ç”Ÿæˆå™¨">å®ç°ä»£ç ç”Ÿæˆå™¨</h3>
<p>è®¿é—®è€…æ¨¡å¼å¯ä»¥ç”¨äºå®ç°ä»£ç ç”Ÿæˆå™¨ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p>
<p>å‡è®¾æˆ‘ä»¬éœ€è¦æ ¹æ®ä¸€ä¸ªè¯­æ³•æ ‘ç”Ÿæˆç›¸åº”çš„ä»£ç ï¼Œè¯­æ³•æ ‘ä¸­åŒ…å«äº†ä¸åŒç±»å‹çš„èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªè¯­æ³•ç»“æ„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è®¿é—®è€…æ¨¡å¼æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œå°†è¯­æ³•æ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½ä½œä¸ºä¸€ä¸ªå…ƒç´ ï¼Œè®¿é—®è€…å¯¹è±¡åˆ™è´Ÿè´£ç”Ÿæˆç›¸åº”çš„ä»£ç ã€‚</p>
<p>æˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸ªæŠ½è±¡è®¿é—®è€…ç±» CodeGeneratorï¼Œå®ƒåŒ…å«äº†å¤šä¸ªæŠ½è±¡æ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•å¯¹åº”ä¸€ä¸ªèŠ‚ç‚¹ç±»å‹ï¼Œç”¨äºç”Ÿæˆç›¸åº”çš„ä»£ç ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// æŠ½è±¡è®¿é—®è€…ç±»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">interface</span> <span class="nc">CodeGenerator</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">generate</span><span class="o">(</span><span class="n">ProgramNode</span> <span class="n">node</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">generate</span><span class="o">(</span><span class="n">StatementNode</span> <span class="n">node</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">generate</span><span class="o">(</span><span class="n">ExpressionNode</span> <span class="n">node</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>ç„¶åæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæŠ½è±¡çš„èŠ‚ç‚¹ç±» Nodeï¼Œå®ƒåŒ…å«ä¸€ä¸ª accept æ–¹æ³•ï¼Œç”¨äºæ¥å—ä¸€ä¸ªè®¿é—®è€…å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// æŠ½è±¡èŠ‚ç‚¹ç±»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Node</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="n">CodeGenerator</span> <span class="n">generator</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æ¥ç€æˆ‘ä»¬å®šä¹‰å¤šä¸ªå…·ä½“çš„èŠ‚ç‚¹ç±» ProgramNodeã€StatementNode å’Œ ExpressionNodeï¼Œå®ƒä»¬å®ç°äº† accept æ–¹æ³•ï¼Œå¹¶åœ¨å…¶ä¸­è°ƒç”¨è®¿é—®è€…å¯¹è±¡çš„ç›¸åº”æ–¹æ³•ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// å…·ä½“èŠ‚ç‚¹ç±» ProgramNode
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">class</span> <span class="nc">ProgramNode</span> <span class="kd">extends</span> <span class="n">Node</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&gt;</span> <span class="n">children</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Node</span> <span class="n">node</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">children</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">node</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="n">CodeGenerator</span> <span class="n">generator</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">generator</span><span class="o">.</span><span class="na">generate</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="n">Node</span> <span class="n">child</span> <span class="o">:</span> <span class="n">children</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">child</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">generator</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å…·ä½“èŠ‚ç‚¹ç±» StatementNode
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">class</span> <span class="nc">StatementNode</span> <span class="kd">extends</span> <span class="n">Node</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">statement</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">StatementNode</span><span class="o">(</span><span class="n">String</span> <span class="n">statement</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">statement</span> <span class="o">=</span> <span class="n">statement</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="n">CodeGenerator</span> <span class="n">generator</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">generator</span><span class="o">.</span><span class="na">generate</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="nf">getStatement</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">statement</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å…·ä½“èŠ‚ç‚¹ç±» ExpressionNode
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">class</span> <span class="nc">ExpressionNode</span> <span class="kd">extends</span> <span class="n">Node</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">expression</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ExpressionNode</span><span class="o">(</span><span class="n">String</span> <span class="n">expression</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">expression</span> <span class="o">=</span> <span class="n">expression</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="n">CodeGenerator</span> <span class="n">generator</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">generator</span><span class="o">.</span><span class="na">generate</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="nf">getExpression</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">expression</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æœ€åæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå…·ä½“çš„è®¿é—®è€…ç±» JavaCodeGeneratorï¼Œå®ƒå®ç°äº† CodeGenerator æ¥å£ï¼Œå¹¶åœ¨å…¶ä¸­å®ç°äº†å„ä¸ªèŠ‚ç‚¹ç±»å‹çš„ç”Ÿæˆæ–¹æ³•ï¼Œç”¨äºç”Ÿæˆ Java ä»£ç ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// å…·ä½“è®¿é—®è€…ç±» JavaCodeGenerator
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">class</span> <span class="nc">JavaCodeGenerator</span> <span class="kd">implements</span> <span class="n">CodeGenerator</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">StringBuilder</span> <span class="n">codeBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">generate</span><span class="o">(</span><span class="n">ProgramNode</span> <span class="n">node</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">codeBuilder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&#34;public class Main {\n&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">generate</span><span class="o">(</span><span class="n">StatementNode</span> <span class="n">node</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">codeBuilder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&#34;    &#34;</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">getStatement</span><span class="o">()).</span><span class="na">append</span><span class="o">(</span><span class="s">&#34;;\n&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">generate</span><span class="o">(</span><span class="n">ExpressionNode</span> <span class="n">node</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">codeBuilder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&#34;    &#34;</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">getExpression</span><span class="o">()).</span><span class="na">append</span><span class="o">(</span><span class="s">&#34;;\n&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="nf">getCode</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">codeBuilder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&#34;}\n&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">codeBuilder</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è®¿é—®è€…æ¨¡å¼æ¥ç”Ÿæˆ Java ä»£ç äº†ã€‚æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ª ProgramNode å¯¹è±¡ï¼Œå¹¶å‘å…¶ä¸­æ·»åŠ å¤šä¸ª StatementNode å’Œ ExpressionNode å¯¹è±¡ï¼Œç„¶ååˆ›å»ºä¸€ä¸ª JavaCodeGenerator å¯¹è±¡ï¼Œè°ƒç”¨ ProgramNode çš„ accept æ–¹æ³•ï¼Œå¹¶å°† JavaCodeGenerator ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ProgramNode</span> <span class="n">programNode</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProgramNode</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">programNode</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">StatementNode</span><span class="o">(</span><span class="s">&#34;int a = 1&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">programNode</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">ExpressionNode</span><span class="o">(</span><span class="s">&#34;a++&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">programNode</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">StatementNode</span><span class="o">(</span><span class="s">&#34;System.out.println(a)&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">JavaCodeGenerator</span> <span class="n">codeGenerator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JavaCodeGenerator</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">programNode</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">codeGenerator</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">codeGenerator</span><span class="o">.</span><span class="na">getCode</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">a</span><span class="o">++;</span>
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">a</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨è®¿é—®è€…æ¨¡å¼æ¥ç”Ÿæˆ Java ä»£ç ï¼Œæˆ‘ä»¬å°†ç”Ÿæˆä»£ç çš„é€»è¾‘å°è£…åœ¨äº† JavaCodeGenerator ç±»ä¸­ï¼Œå¹¶é€šè¿‡è®¿é—®è€…æ¨¡å¼å°†å®ƒä»¬åº”ç”¨äºè¯­æ³•æ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ã€‚è¿™æ ·å¯ä»¥å®ç°ä»£ç çš„å¿«é€Ÿç”Ÿæˆå’Œå¯ç»´æŠ¤æ€§ã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>Javaè®¾è®¡æ¨¡å¼ï¼šAcyclic Visitor</title>
      <link>https://blog.chensoul.com/posts/2023/06/01/java-design-patterns-acyclic-visitor/</link>
      <pubDate>Thu, 01 Jun 2023 09:30:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/06/01/java-design-patterns-acyclic-visitor/</guid>
      <description>æœ¬æ–‡ä¸»è¦ä»‹ç» Acyclic Visitor æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚ Java Design Patterns æä¾›äº†å„ç§ Java è®¾è®¡</description>
      <content:encoded><![CDATA[<p>æœ¬æ–‡ä¸»è¦ä»‹ç» Acyclic Visitor æ¨¡å¼ï¼Œåœ¨ <a href="https://java-design-patterns.com/">Java Design Patterns</a>  ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚</p>
<blockquote>
<p><a href="https://java-design-patterns.com/">Java Design Patterns</a> æä¾›äº†å„ç§ Java è®¾è®¡æ¨¡å¼çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ã€‚è¯¥ç½‘ç«™æ—¨åœ¨å¸®åŠ© Java å¼€å‘äººå‘˜äº†è§£å’Œåº”ç”¨å„ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p>
<p>Java Design Patterns ç½‘ç«™æä¾›äº†å¤šç§è®¾è®¡æ¨¡å¼åˆ†ç±»æ–¹å¼ï¼ŒåŒ…æ‹¬åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational Patternsï¼‰ã€ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternsï¼‰å’Œè¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰ï¼Œä»¥åŠå…¶ä»–ä¸€äº›å¸¸è§çš„æ¨¡å¼ã€‚</p>
<p>å¯¹äºæ¯ä¸ªè®¾è®¡æ¨¡å¼ï¼Œè¯¥ç½‘ç«™æä¾›äº†è¯¦ç»†çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ï¼Œå¹¶ä¸”æä¾›äº†ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ã€‚å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©é€‚åˆè‡ªå·±çš„è®¾è®¡æ¨¡å¼ï¼Œå¹¶ä¸”å¯ä»¥å‚è€ƒç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜æ¥ç†è§£å’Œåº”ç”¨è¯¥æ¨¡å¼ã€‚</p>
<p>æ­¤å¤–ï¼ŒJava Design Patterns ç½‘ç«™è¿˜æä¾›äº†ä¸€äº›å…¶ä»–èµ„æºï¼Œå¦‚è®¾è®¡æ¨¡å¼çš„ UML å›¾ã€è®¾è®¡æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ã€è®¾è®¡æ¨¡å¼çš„æ¯”è¾ƒç­‰ã€‚è¿™äº›èµ„æºå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨è®¾è®¡æ¨¡å¼ã€‚</p>
<p>ä¸­æ–‡ç½‘ç«™ï¼š<a href="https://java-design-patterns.com/zh/">https://java-design-patterns.com/zh/</a></p>
<p>Github ä¸Šæºç ä»“åº“ï¼ˆéå®˜æ–¹ï¼‰ï¼š<a href="https://github.com/iluwatar/java-design-patterns">https://github.com/iluwatar/java-design-patterns</a></p>
</blockquote>
<h2 id="ç›®çš„">ç›®çš„</h2>
<p>å…è®¸å°†æ–°åŠŸèƒ½æ·»åŠ åˆ°ç°æœ‰çš„ç±»å±‚æ¬¡ç»“æ„ä¸­ï¼Œè€Œä¸ä¼šå½±å“è¿™äº›å±‚æ¬¡ç»“æ„ï¼Œä¹Ÿä¸ä¼šæœ‰å››äººå¸®è®¿å®¢æ¨¡å¼ä¸­é‚£æ ·å¾ªç¯ä¾èµ–çš„é—®é¢˜ã€‚</p>
<blockquote>
<p>åœ¨ Acyclic Visitor æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å¼•å…¥ä¸€ä¸ªå¯é€‰æ“ä½œæ¥å£æ¥å®ç°è¿™ä¸€ç‚¹ã€‚å½“æ•°æ®ç»“æ„ç±»éœ€è¦è®¿é—®è®¿é—®è€…ç±»çš„æŸäº›æ“ä½œæ—¶ï¼Œå®ƒå¯ä»¥é€šè¿‡è°ƒç”¨ visit æ–¹æ³•æ¥è®¿é—®å¯é€‰æ“ä½œæ¥å£ä¸­å®šä¹‰çš„æ“ä½œï¼Œè€Œä¸éœ€è¦ç›´æ¥ä¾èµ–äºè®¿é—®è€…ç±»ä¸­çš„æˆå‘˜å˜é‡ã€‚</p>
</blockquote>
<h2 id="è§£é‡Š">è§£é‡Š</h2>
<p>çœŸå®ä¸–ç•Œä¾‹å­</p>
<blockquote>
<p>æˆ‘ä»¬æœ‰ä¸€ä¸ªè°ƒåˆ¶è§£è°ƒå™¨ç±»çš„å±‚æ¬¡ç»“æ„ã€‚ éœ€è¦ä½¿ç”¨åŸºäºè¿‡æ»¤æ¡ä»¶çš„å¤–éƒ¨ç®—æ³•ï¼ˆæ˜¯Unixæˆ–DOSå…¼å®¹çš„è°ƒåˆ¶è§£è°ƒå™¨ï¼‰æ¥è®¿é—®æ­¤å±‚æ¬¡ç»“æ„ä¸­çš„è°ƒåˆ¶è§£è°ƒå™¨ã€‚</p>
</blockquote>
<p><strong>ç¨‹åºç¤ºä¾‹</strong></p>
<p>è¿™æ˜¯è°ƒåˆ¶è§£è°ƒå™¨çš„å±‚æ¬¡ç»“æ„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Modem</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="n">ModemVisitor</span> <span class="n">modemVisitor</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Hayes</span> <span class="kd">implements</span> <span class="n">Modem</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">	<span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="n">ModemVisitor</span> <span class="n">modemVisitor</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="o">(</span><span class="n">modemVisitor</span> <span class="k">instanceof</span> <span class="n">HayesVisitor</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="o">((</span><span class="n">HayesVisitor</span><span class="o">)</span> <span class="n">modemVisitor</span><span class="o">).</span><span class="na">visit</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Only HayesVisitor is allowed to visit Hayes modem&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Zoom</span> <span class="kd">implements</span> <span class="n">Modem</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">	<span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="n">ModemVisitor</span> <span class="n">modemVisitor</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="o">(</span><span class="n">modemVisitor</span> <span class="k">instanceof</span> <span class="n">ZoomVisitor</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="o">((</span><span class="n">ZoomVisitor</span><span class="o">)</span> <span class="n">modemVisitor</span><span class="o">).</span><span class="na">visit</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ä¸‹é¢æˆ‘ä»¬ä»‹ç»<code>è°ƒåˆ¶è§£è°ƒå™¨è®¿é—®è€…</code>ç±»ç»“æ„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ModemVisitor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">HayesVisitor</span> <span class="kd">extends</span> <span class="n">ModemVisitor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">void</span> <span class="nf">visit</span><span class="o">(</span><span class="n">Hayes</span> <span class="n">hayes</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ZoomVisitor</span> <span class="kd">extends</span> <span class="n">ModemVisitor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">void</span> <span class="nf">visit</span><span class="o">(</span><span class="n">Zoom</span> <span class="n">zoom</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AllModemVisitor</span> <span class="kd">extends</span> <span class="n">ZoomVisitor</span><span class="o">,</span> <span class="n">HayesVisitor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConfigureForDosVisitor</span> <span class="kd">implements</span> <span class="n">AllModemVisitor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">	<span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">visit</span><span class="o">(</span><span class="n">Hayes</span> <span class="n">hayes</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">hayes</span> <span class="o">+</span> <span class="s">&#34; used with Dos configurator.&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">visit</span><span class="o">(</span><span class="n">Zoom</span> <span class="n">zoom</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">zoom</span> <span class="o">+</span> <span class="s">&#34; used with Dos configurator.&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConfigureForUnixVisitor</span> <span class="kd">implements</span> <span class="n">ZoomVisitor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">	<span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">visit</span><span class="o">(</span><span class="n">Zoom</span> <span class="n">zoom</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">zoom</span> <span class="o">+</span> <span class="s">&#34; used with Unix configurator.&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æœ€åï¼Œè¿™é‡Œæ˜¯è®¿é—®è€…çš„å®è·µã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Modem</span><span class="o">[]</span> <span class="n">modems</span> <span class="o">=</span> <span class="o">{</span> <span class="k">new</span> <span class="n">Hayes</span><span class="o">(),</span> <span class="k">new</span> <span class="n">Zoom</span><span class="o">(),</span> <span class="k">new</span> <span class="n">Hayes</span><span class="o">()</span> <span class="o">};</span>
</span></span><span class="line"><span class="cl">        <span class="n">ModemVisitor</span> <span class="n">dosVisitor</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConfigureForDosVisitor</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">ModemVisitor</span> <span class="n">unixVisitor</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConfigureForUnixVisitor</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="n">Modem</span> <span class="n">modem</span> <span class="o">:</span> <span class="n">modems</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">modem</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">dosVisitor</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">modem</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">unixVisitor</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h2 id="ç±»å›¾">ç±»å›¾</h2>
<p><img loading="lazy" src="https://java-design-patterns.com/assets/acyclic-visitor-74cfcfba.png" alt="alt text"  />
</p>
<p>ä»¥ä¸‹æ˜¯å¯¹ Acyclic Visitor æ¨¡å¼çš„è§£é‡Šï¼š</p>
<ol>
<li>Elementï¼ˆå…ƒç´ ï¼‰ï¼šåœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼ŒModem æ¥å£è¡¨ç¤ºä¸€ä¸ªå…ƒç´ ï¼Œå®šä¹‰äº†ä¸€ä¸ª accept æ–¹æ³•ï¼Œç”¨äºæ¥å—è®¿é—®è€…çš„è®¿é—®ã€‚</li>
<li>ConcreteElementï¼ˆå…·ä½“å…ƒç´ ï¼‰ï¼šåœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼ŒHayes ç±»å’Œ Zoom ç±»è¡¨ç¤ºå…·ä½“çš„å…ƒç´ ï¼Œå®ç°äº† Modem æ¥å£ä¸­å®šä¹‰çš„ accept æ–¹æ³•ã€‚</li>
<li>Visitorï¼ˆè®¿é—®è€…ï¼‰ï¼šåœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼ŒModemVisitor æ¥å£è¡¨ç¤ºä¸€ä¸ªè®¿é—®è€…ï¼Œå®šä¹‰äº†ä¸€ä¸ªç©ºçš„æ¥å£ï¼Œç”¨äºæ‰©å±•å…·ä½“çš„è®¿é—®è€…æ¥å£ã€‚</li>
<li>ConcreteVisitorï¼ˆå…·ä½“è®¿é—®è€…ï¼‰ï¼šåœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼ŒConfigureForDosVisitor å’Œ ConfigureForUnixVisitor ç±»è¡¨ç¤ºå…·ä½“çš„è®¿é—®è€…ï¼Œå®ç°äº† HayesVisitor å’Œ ZoomVisitor æ¥å£ä¸­å®šä¹‰çš„ visit æ–¹æ³•ï¼Œç”¨äºè®¿é—®å…·ä½“çš„å…ƒç´ ã€‚</li>
<li>OptionalOperationsï¼ˆå¯é€‰æ“ä½œï¼‰ï¼šåœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼ŒAllModemVisitor æ¥å£è¡¨ç¤ºä¸€ä¸ªå¯é€‰æ“ä½œæ¥å£ï¼Œå®ƒç»§æ‰¿äº†æ‰€æœ‰å…·ä½“è®¿é—®è€…æ¥å£ï¼Œç”¨äºæ‰©å±•è®¿é—®è€…ç±»çš„æ“ä½œã€‚åœ¨ ConfigureForDosVisitor ç±»ä¸­ï¼Œå®ƒå®ç°äº† AllModemVisitor æ¥å£ï¼ŒåŒæ—¶å®ç°äº† visit æ–¹æ³•ï¼Œç”¨äºè®¿é—®æ‰€æœ‰å…·ä½“çš„å…ƒç´ ã€‚åœ¨ ConfigureForUnixVisitor ç±»ä¸­ï¼Œå®ƒå®ç°äº† ZoomVisitor æ¥å£ï¼ŒåŒæ—¶å®ç°äº† visit æ–¹æ³•ï¼Œç”¨äºè®¿é—® Zoom å…ƒç´ ã€‚</li>
</ol>
<p>åœ¨ Acyclic Visitor æ¨¡å¼ä¸­ï¼Œå…ƒç´ å’Œè®¿é—®è€…ä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå®ƒä»¬ä¹‹é—´æ²¡æœ‰ä»»ä½•ä¾èµ–å…³ç³»ã€‚åœ¨è®¿é—®å…ƒç´ æ—¶ï¼Œè®¿é—®è€…é€šè¿‡ accept æ–¹æ³•è®¿é—®å…ƒç´ ï¼Œå¹¶æ ¹æ®å…ƒç´ çš„ç±»å‹è‡ªåŠ¨è°ƒç”¨å¯¹åº”çš„ visit æ–¹æ³•ã€‚ç”±äºè®¿é—®è€…å¹¶æ²¡æœ‰ç›´æ¥ä¾èµ–äºå…ƒç´ ï¼Œè€Œæ˜¯é€šè¿‡è®¿é—®è€…æ¥å£å’Œå¯é€‰æ“ä½œæ¥å£æ¥è®¿é—®å…ƒç´ ï¼Œå› æ­¤å¯ä»¥é¿å…å¾ªç¯ä¾èµ–çš„é—®é¢˜ã€‚åŒæ—¶ï¼Œç”±äºå¯é€‰æ“ä½œæ˜¯ä¸€ä¸ªæ¥å£ï¼Œè®¿é—®è€…å¯ä»¥æ ¹æ®éœ€è¦å®ç°å…¶ä¸­çš„éƒ¨åˆ†æ“ä½œï¼Œä»è€ŒåŠ¨æ€åœ°æ·»åŠ æ–°çš„æ“ä½œï¼Œè€Œä¸ä¼šå½±å“ç°æœ‰çš„ç±»å±‚æ¬¡ç»“æ„ã€‚è¿™æ ·ï¼ŒAcyclic Visitor æ¨¡å¼å¯ä»¥ä½¿ä»£ç æ›´åŠ çµæ´»å’Œå¯æ‰©å±•ï¼ŒåŒæ—¶ä¹Ÿæé«˜äº†ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p>
<h2 id="é€‚ç”¨æ€§">é€‚ç”¨æ€§</h2>
<p>ä»¥ä¸‹æƒ…å†µå¯ä»¥ä½¿ç”¨æ­¤æ¨¡å¼ï¼š</p>
<ul>
<li>éœ€è¦åœ¨ç°æœ‰å±‚æ¬¡ç»“æ„ä¸­æ·»åŠ æ–°åŠŸèƒ½è€Œæ— éœ€æ›´æ”¹æˆ–å½±å“è¯¥å±‚æ¬¡ç»“æ„æ—¶ã€‚</li>
<li>å½“æŸäº›åŠŸèƒ½åœ¨å±‚æ¬¡ç»“æ„ä¸Šè¿è¡Œï¼Œä½†ä¸å±äºå±‚æ¬¡ç»“æ„æœ¬èº«æ—¶ã€‚ ä¾‹å¦‚ ConfigureForDOS / ConfigureForUnix / ConfigureForXé—®é¢˜ã€‚</li>
<li>å½“æ‚¨éœ€è¦æ ¹æ®å¯¹è±¡çš„ç±»å‹å¯¹å¯¹è±¡æ‰§è¡Œéå¸¸ä¸åŒçš„æ“ä½œæ—¶ã€‚</li>
<li>å½“è®¿é—®çš„ç±»å±‚æ¬¡ç»“æ„å°†ç»å¸¸ä½¿ç”¨å…ƒç´ ç±»çš„æ–°æ´¾ç”Ÿè¿›è¡Œæ‰©å±•æ—¶ã€‚åœ¨ Acyclic Visitor æ¨¡å¼ä¸­ï¼Œæ–°çš„å…ƒç´ ç±»å¯ä»¥é€šè¿‡ç»§æ‰¿ç°æœ‰çš„ Element ç±»æ¥å®ç°ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹è®¿é—®è€…ç±»çš„ä»£ç ã€‚è¿™æ ·ï¼Œå¯ä»¥é¿å…å› æ·»åŠ æ–°å…ƒç´ è€Œå¯¼è‡´çš„è®¿é—®è€…ç±»çš„ä¿®æ”¹å’Œé‡æ–°ç¼–è¯‘ã€‚</li>
<li>å½“é‡æ–°ç¼–è¯‘ï¼Œé‡æ–°é“¾æ¥ï¼Œé‡æ–°æµ‹è¯•æˆ–é‡æ–°åˆ†å‘æ´¾ç”Ÿå…ƒç´ éå¸¸æ˜‚è´µæ—¶ã€‚</li>
</ul>
<h2 id="å¯¹æ¯”">å¯¹æ¯”</h2>
<p>Acyclic Visitor æ¨¡å¼æ˜¯ Visitor æ¨¡å¼çš„ä¸€ä¸ªå˜ä½“ï¼Œå®ƒè§£å†³äº† Visitor æ¨¡å¼å¯èƒ½å¯¼è‡´çš„å¾ªç¯ä¾èµ–é—®é¢˜ã€‚ä¸‹é¢æ˜¯ Acyclic Visitor æ¨¡å¼å’Œ Visitor æ¨¡å¼çš„ä¸€äº›å¯¹æ¯”ï¼š</p>
<ol>
<li>ç›®çš„ä¸åŒ</li>
</ol>
<p>Visitor æ¨¡å¼çš„ä¸»è¦ç›®çš„æ˜¯å°†æ•°æ®ç»“æ„å’Œæ“ä½œåˆ†ç¦»å¼€æ¥ï¼Œå¹¶å°†æ“ä½œå°è£…åœ¨è®¿é—®è€…ç±»ä¸­ã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨ä¸ä¿®æ”¹æ•°æ®ç»“æ„ä»£ç çš„æƒ…å†µä¸‹æ·»åŠ æ–°çš„æ“ä½œã€‚è€Œ Acyclic Visitor æ¨¡å¼åˆ™æ›´æ³¨é‡è§£å†³ Visitor æ¨¡å¼ä¸­å¯èƒ½å‡ºç°çš„å¾ªç¯ä¾èµ–é—®é¢˜ã€‚</p>
<ol start="2">
<li>å®ç°æ–¹å¼ä¸åŒ</li>
</ol>
<p>åœ¨ Visitor æ¨¡å¼ä¸­ï¼Œè®¿é—®è€…ç±»é€šå¸¸ä¼šç»´æŠ¤ä¸€ä¸ªæ•°æ®ç»“æ„ç±»çš„å¼•ç”¨ï¼Œä»¥ä¾¿åœ¨ visit æ–¹æ³•ä¸­è®¿é—®æ•°æ®ç»“æ„ç±»çš„æˆå‘˜ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´å¾ªç¯ä¾èµ–é—®é¢˜ã€‚è€Œåœ¨ Acyclic Visitor æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ªé¢å¤–çš„æ¥å£ï¼Œå³å¯é€‰æ“ä½œæ¥å£ï¼Œå®ƒåŒ…å«æ•°æ®ç»“æ„ç±»å¯èƒ½éœ€è¦è°ƒç”¨çš„æ–¹æ³•ã€‚è¿™æ ·ï¼Œæ•°æ®ç»“æ„ç±»å°±å¯ä»¥é€šè¿‡è°ƒç”¨ visit æ–¹æ³•æ¥è®¿é—®è®¿é—®è€…ç±»ä¸­çš„éƒ¨åˆ†æ“ä½œï¼Œè€Œä¸å¿…ç›´æ¥ä¾èµ–äºè®¿é—®è€…ç±»ä¸­çš„æˆå‘˜ï¼Œä»è€Œé¿å…äº†å¾ªç¯ä¾èµ–é—®é¢˜ã€‚</p>
<ol start="3">
<li>å¯æ‰©å±•æ€§ä¸åŒ</li>
</ol>
<p>ç”±äº Visitor æ¨¡å¼ä¸­æ•°æ®ç»“æ„ç±»å’Œè®¿é—®è€…ç±»ä¹‹é—´å­˜åœ¨å¼ºè€¦åˆå…³ç³»ï¼Œå› æ­¤æ·»åŠ æ–°çš„æ•°æ®ç»“æ„ç±»æˆ–è®¿é—®è€…ç±»å¯èƒ½ä¼šå¯¼è‡´ä»£ç ä¿®æ”¹ã€‚è€Œ Acyclic Visitor æ¨¡å¼é€šè¿‡å¼•å…¥å¯é€‰æ“ä½œæ¥å£ï¼Œä½¿å¾—æ•°æ®ç»“æ„ç±»å’Œè®¿é—®è€…ç±»ä¹‹é—´çš„è€¦åˆå…³ç³»æ›´åŠ çµæ´»ï¼Œä»è€Œæé«˜äº†ä»£ç çš„å¯æ‰©å±•æ€§ã€‚</p>
<ol start="4">
<li>å®ç°å¤æ‚åº¦ä¸åŒ</li>
</ol>
<p>Acyclic Visitor æ¨¡å¼ç›¸æ¯” Visitor æ¨¡å¼ï¼Œå¢åŠ äº†ä¸€ä¸ªå¯é€‰æ“ä½œæ¥å£ï¼Œå› æ­¤å®ç°ä¸Šå¯èƒ½ä¼šæ›´åŠ å¤æ‚ã€‚ä½†æ˜¯ï¼Œè¿™ä¹Ÿä½¿å¾— Acyclic Visitor æ¨¡å¼æ›´åŠ çµæ´»å’Œå¯æ‰©å±•ã€‚</p>
<h2 id="ä¼˜ç¼ºç‚¹">ä¼˜ç¼ºç‚¹</h2>
<p>ä¸‹é¢æ˜¯ Acyclic Visitor æ¨¡å¼çš„ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼š</p>
<p>ä¼˜ç‚¹ï¼š</p>
<ol>
<li>è§£å†³äº† Visitor æ¨¡å¼å¯èƒ½å‡ºç°çš„å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½¿å¾—ä»£ç æ›´åŠ å¥å£®å’Œå¯ç»´æŠ¤ã€‚</li>
<li>å¯é€‰æ“ä½œæ¥å£ä½¿å¾—è®¿é—®è€…ç±»çš„æ‰©å±•æ›´åŠ çµæ´»ï¼Œå¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚é€‰æ‹©å®ç°ä¸åŒçš„æ“ä½œã€‚</li>
<li>å°†<strong>æ•°æ®ç»“æ„å’Œæ“ä½œåˆ†ç¦»å¼€æ¥</strong>ï¼Œæé«˜äº†ä»£ç çš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</li>
<li>åœ¨éœ€è¦æ·»åŠ æ–°çš„æ•°æ®ç»“æ„ç±»æˆ–è®¿é—®è€…ç±»æ—¶ï¼Œå¯ä»¥é¿å…å¯¹ç°æœ‰ä»£ç è¿›è¡Œä¿®æ”¹ï¼Œç¬¦åˆå¼€é—­åŸåˆ™ã€‚</li>
</ol>
<p>ç¼ºç‚¹ï¼š</p>
<ol>
<li>ç›¸å¯¹äº Visitor æ¨¡å¼ï¼ŒAcyclic Visitor æ¨¡å¼çš„å®ç°ä¼šæ›´åŠ å¤æ‚ï¼Œå› ä¸ºéœ€è¦å¼•å…¥ä¸€ä¸ªå¯é€‰æ“ä½œæ¥å£ã€‚</li>
<li>ç”±äº Acyclic Visitor æ¨¡å¼åœ¨å®ç°ä¸Šæ›´åŠ å¤æ‚ï¼Œå¯èƒ½ä¼šé™ä½ä»£ç çš„å¯è¯»æ€§å’Œå¯ç†è§£æ€§ã€‚</li>
<li>å¦‚æœæ•°æ®ç»“æ„ç±»éœ€è¦è®¿é—®è®¿é—®è€…ç±»çš„æˆå‘˜ï¼ŒAcyclic Visitor æ¨¡å¼å¹¶ä¸èƒ½å¾ˆå¥½åœ°è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦è€ƒè™‘å…¶ä»–è®¾è®¡æ¨¡å¼çš„ä½¿ç”¨ã€‚</li>
</ol>
<h2 id="ä½¿ç”¨åœºæ™¯">ä½¿ç”¨åœºæ™¯</h2>
<p>Acyclic Visitor æ¨¡å¼é€šå¸¸ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š</p>
<ol>
<li>ç±»å±‚æ¬¡ç»“æ„ä¸­å­˜åœ¨å¤šç§ç±»å‹çš„å¯¹è±¡ï¼Œå¹¶ä¸”éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œä¸åŒçš„æ“ä½œï¼Œä½†ä¸æƒ³åœ¨ç±»å±‚æ¬¡ç»“æ„ä¸­æ·»åŠ æ–°çš„æ–¹æ³•æˆ–ä¿®æ”¹ç°æœ‰æ–¹æ³•ã€‚</li>
<li>ä¸åŒçš„æ“ä½œéœ€è¦è®¿é—®å¯¹è±¡çš„ä¸åŒéƒ¨åˆ†ï¼Œè€Œä¸æ˜¯æ•´ä¸ªå¯¹è±¡æœ¬èº«ã€‚</li>
<li>ç±»å±‚æ¬¡ç»“æ„ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œä½†ä¸å¸Œæœ›å¼•å…¥å¾ªç¯ä¾èµ–é—®é¢˜ã€‚</li>
<li>éœ€è¦åœ¨ç±»å±‚æ¬¡ç»“æ„ä¸­æ·»åŠ æ–°çš„æ“ä½œï¼Œè€Œä¸å½±å“ç°æœ‰çš„ç±»ã€‚</li>
<li>éœ€è¦æ”¯æŒå¤šä¸ªè®¿é—®è€…ï¼Œä¸”è®¿é—®è€…ä¹‹é—´å¯èƒ½å­˜åœ¨ä¾èµ–å…³ç³»ã€‚</li>
<li>éœ€è¦é¿å…åœ¨è®¿é—®è€…ä¸­ä½¿ç”¨ instanceof è¿ç®—ç¬¦æ¥æ£€æŸ¥å…ƒç´ çš„ç±»å‹ã€‚</li>
</ol>
<p>å…·ä½“çš„ä½¿ç”¨åœºæ™¯å¦‚ä¸‹ï¼š</p>
<ol>
<li>è§£æå™¨ï¼ˆParserï¼‰ï¼šåœ¨è§£æå™¨ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°ä¸åŒç±»å‹çš„èŠ‚ç‚¹çš„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°è¯­æ³•æ ‘çš„éå†ï¼Œä»¥å®ç°è¯­æ³•åˆ†æã€ç±»å‹æ£€æŸ¥ç­‰åŠŸèƒ½ã€‚</li>
<li>ç¼–è¯‘å™¨ï¼ˆCompilerï¼‰ï¼šåœ¨ç¼–è¯‘å™¨ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°ä¸åŒé˜¶æ®µçš„åˆ†æã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°è¯æ³•åˆ†æå™¨ã€è¯­æ³•åˆ†æå™¨ã€ç±»å‹æ£€æŸ¥å™¨ã€ä»£ç ç”Ÿæˆå™¨ç­‰ã€‚</li>
<li>å›¾å½¢ç”¨æˆ·ç•Œé¢ï¼ˆGUIï¼‰ï¼šåœ¨å›¾å½¢ç”¨æˆ·ç•Œé¢ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°ä¸åŒç±»å‹çš„æ§ä»¶çš„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°çª—å£ã€æŒ‰é’®ã€èœå•ç­‰æ§ä»¶çš„äº‹ä»¶å¤„ç†é€»è¾‘ã€‚</li>
<li>æ•°æ®åº“è®¿é—®ï¼ˆDatabase Accessï¼‰ï¼šåœ¨æ•°æ®åº“è®¿é—®ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°ä¸åŒç±»å‹çš„å¯¹è±¡çš„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°å¯¹å…³ç³»å‹æ•°æ®åº“ä¸­çš„è¡¨ã€è§†å›¾ã€å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ç­‰å¯¹è±¡çš„è®¿é—®ã€‚</li>
<li>æ¸¸æˆå¼€å‘ï¼ˆGame Developmentï¼‰ï¼šåœ¨æ¸¸æˆå¼€å‘ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°ä¸åŒç±»å‹çš„æ¸¸æˆå¯¹è±¡çš„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°å¯¹è§’è‰²ã€é“å…·ã€æ€ªç‰©ç­‰æ¸¸æˆå¯¹è±¡çš„è®¿é—®ã€‚</li>
<li>æ‰“å°æœºé©±åŠ¨ç¨‹åºï¼ˆPrinter Driverï¼‰ï¼šåœ¨æ‰“å°æœºé©±åŠ¨ç¨‹åºä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°ä¸åŒç±»å‹çš„æ‰“å°ä½œä¸šçš„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°å¯¹æ–‡æœ¬ã€å›¾ç‰‡ã€è¡¨æ ¼ç­‰æ‰“å°ä½œä¸šçš„è®¿é—®ã€‚</li>
<li>éŸ³é¢‘å¤„ç†ï¼ˆAudio Processingï¼‰ï¼šåœ¨éŸ³é¢‘å¤„ç†ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°ä¸åŒç±»å‹çš„éŸ³é¢‘æ–‡ä»¶çš„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°å¯¹ MP3ã€WAVã€FLAC ç­‰éŸ³é¢‘æ–‡ä»¶çš„è®¿é—®ã€‚</li>
<li>ç½‘ç»œåè®®ï¼ˆNetwork Protocolï¼‰ï¼šåœ¨ç½‘ç»œåè®®ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°ä¸åŒç±»å‹çš„åè®®æ•°æ®åŒ…çš„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°å¯¹ TCPã€UDPã€HTTPã€SMTP ç­‰åè®®æ•°æ®åŒ…çš„è®¿é—®ã€‚</li>
<li>æœºå™¨äººæ§åˆ¶ï¼ˆRobot Controlï¼‰ï¼šåœ¨æœºå™¨äººæ§åˆ¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°ä¸åŒç±»å‹çš„æœºå™¨äººåŠ¨ä½œçš„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°å¯¹ç§»åŠ¨ã€è½¬å‘ã€æŠ“å–ã€æ”¾ç½®ç­‰æœºå™¨äººåŠ¨ä½œçš„è®¿é—®ã€‚</li>
<li>ç³»ç»Ÿç›‘æ§ï¼ˆSystem Monitoringï¼‰ï¼šåœ¨ç³»ç»Ÿç›‘æ§ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°ä¸åŒç±»å‹çš„ç›‘æµ‹æ•°æ®çš„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°å¯¹ CPU å ç”¨ç‡ã€å†…å­˜ä½¿ç”¨é‡ã€ç½‘ç»œæµé‡ç­‰ç›‘æµ‹æ•°æ®çš„è®¿é—®ã€‚</li>
<li>æœºå™¨å­¦ä¹ ï¼ˆMachine Learningï¼‰ï¼šåœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°ä¸åŒç±»å‹çš„è®­ç»ƒæ•°æ®çš„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°å¯¹å›¾åƒã€å£°éŸ³ã€æ–‡æœ¬ç­‰è®­ç»ƒæ•°æ®çš„è®¿é—®ã€‚</li>
<li>é‡‘èäº¤æ˜“ï¼ˆFinancial Tradingï¼‰ï¼šåœ¨é‡‘èäº¤æ˜“ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°ä¸åŒç±»å‹çš„äº¤æ˜“æ•°æ®çš„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°å¯¹è‚¡ç¥¨ã€æœŸè´§ã€å¤–æ±‡ç­‰äº¤æ˜“æ•°æ®çš„è®¿é—®ã€‚</li>
<li>ç”µå­å•†åŠ¡ï¼ˆE-commerceï¼‰ï¼šåœ¨ç”µå­å•†åŠ¡ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°ä¸åŒç±»å‹çš„å•†å“æ•°æ®çš„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitoræ¨¡å¼æ¥å®ç°å¯¹äº§å“ã€è®¢å•ã€å®¢æˆ·ç­‰å•†å“æ•°æ®çš„è®¿é—®ã€‚</li>
<li>ç¡¬ä»¶æ§åˆ¶ï¼ˆHardware Controlï¼‰ï¼šåœ¨ç¡¬ä»¶æ§åˆ¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°ä¸åŒç±»å‹çš„ç¡¬ä»¶è®¾å¤‡çš„è®¿é—®ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°å¯¹ä¼ æ„Ÿå™¨ã€ç”µæœºã€æ‰§è¡Œå™¨ç­‰ç¡¬ä»¶è®¾å¤‡çš„è®¿é—®ã€‚</li>
</ol>
<p>ä¸€ä¸ªæ›´å…·ä½“çš„ä¾‹å­æ˜¯ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°å›¾åƒå¤„ç†åŠŸèƒ½ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå›¾åƒå¤„ç†ç¨‹åºï¼Œå®ƒå¯ä»¥å¤„ç†å¤šç§ç±»å‹çš„å›¾åƒï¼Œå¦‚ JPEGã€PNGã€BMP ç­‰ã€‚æˆ‘ä»¬éœ€è¦ä¸ºè¯¥ç¨‹åºæ·»åŠ ä¸€ä¸ªæ–°çš„åŠŸèƒ½ï¼Œå³å°†å›¾åƒè½¬æ¢ä¸ºé»‘ç™½å›¾åƒã€‚</p>
<p>ä¸ºå®ç°è¿™ä¸€åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥è®¾è®¡å›¾åƒå¤„ç†ç±»å±‚æ¬¡ç»“æ„ã€‚ç±»å±‚æ¬¡ç»“æ„åŒ…æ‹¬å¤šç§ç±»å‹çš„å›¾åƒï¼Œå¦‚ JPEGImageã€PNGImageã€BMPImage ç­‰ã€‚å¯¹äºæ¯ç§ç±»å‹çš„å›¾åƒï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç›¸åº”çš„å›¾åƒå¤„ç†å™¨ç±»ï¼Œå¦‚ JPEGImageHandlerã€PNGImageHandlerã€BMPImageHandler ç­‰ã€‚æ¯ä¸ªå›¾åƒå¤„ç†å™¨ç±»éƒ½å®ç°ä¸€ä¸ª Visitor æ¥å£çš„å­æ¥å£ï¼Œå¦‚ JPEGImageVisitorã€PNGImageVisitorã€BMPImageVisitorï¼Œè¯¥å­æ¥å£å®šä¹‰äº†ä¸€äº› visit æ–¹æ³•ï¼Œç”¨äºå¤„ç†å›¾åƒä¸­çš„åƒç´ æ•°æ®ã€‚</p>
<p>å®šä¹‰ Visitor æ¥å£åŠå…¶å­æ¥å£ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Visitor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">JPEGImageVisitor</span> <span class="kd">extends</span> <span class="n">Visitor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">visit</span><span class="o">(</span><span class="n">JPEGImage</span> <span class="n">image</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PNGImageVisitor</span> <span class="kd">extends</span> <span class="n">Visitor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">visit</span><span class="o">(</span><span class="n">PNGImage</span> <span class="n">image</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">BMPImageVisitor</span> <span class="kd">extends</span> <span class="n">Visitor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">visit</span><span class="o">(</span><span class="n">BMPImage</span> <span class="n">image</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>å®šä¹‰å›¾åƒç±»åŠå…¶å­ç±»ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Image</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="n">Visitor</span> <span class="n">visitor</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JPEGImage</span> <span class="kd">implements</span> <span class="n">Image</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="nf">JPEGImage</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="o">.</span><span class="na">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">getData</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">data</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="n">Visitor</span> <span class="n">visitor</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="o">(</span><span class="n">visitor</span> <span class="k">instanceof</span> <span class="n">JPEGImageVisitor</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">          <span class="o">((</span><span class="n">JPEGImageVisitor</span><span class="o">)</span> <span class="n">visitor</span><span class="o">).</span><span class="na">visit</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PNGImage</span> <span class="kd">implements</span> <span class="n">Image</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="nf">PNGImage</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="o">.</span><span class="na">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">getData</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">data</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="n">Visitor</span> <span class="n">visitor</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="o">(</span><span class="n">visitor</span> <span class="k">instanceof</span> <span class="n">PNGImageVisitor</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">          <span class="o">((</span><span class="n">PNGImageVisitor</span><span class="o">)</span> <span class="n">visitor</span><span class="o">).</span><span class="na">visit</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BMPImage</span> <span class="kd">implements</span> <span class="n">Image</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="nf">BMPImage</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="o">.</span><span class="na">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">getData</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">data</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="n">Visitor</span> <span class="n">visitor</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="o">(</span><span class="n">visitor</span> <span class="k">instanceof</span> <span class="n">BMPImageVisitor</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">          <span class="o">((</span><span class="n">BMPImageVisitor</span><span class="o">)</span> <span class="n">visitor</span><span class="o">).</span><span class="na">visit</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>  
</span></span></code></pre></div><p>å®šä¹‰é»‘ç™½å›¾åƒå¤„ç†å™¨ç±»ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BlackWhiteImageProcessor</span> <span class="kd">implements</span> <span class="n">JPEGImageVisitor</span><span class="o">,</span> <span class="n">PNGImageVisitor</span><span class="o">,</span><span class="n">BMPImageVisitor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">visit</span><span class="o">(</span><span class="n">JPEGImage</span> <span class="n">image</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// å°† JPEG å›¾åƒè½¬æ¢ä¸ºé»‘ç™½å›¾åƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">// å¤„ç†åƒç´ æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="na">getData</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">visit</span><span class="o">(</span><span class="n">PNGImage</span> <span class="n">image</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// å°† PNG å›¾åƒè½¬æ¢ä¸ºé»‘ç™½å›¾åƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">// å¤„ç†åƒç´ æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="na">getData</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">visit</span><span class="o">(</span><span class="n">BMPImage</span> <span class="n">image</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// å°† BMP å›¾åƒè½¬æ¢ä¸ºé»‘ç™½å›¾åƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">// å¤„ç†åƒç´ æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="na">getData</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>  
</span></span></code></pre></div><p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°å›¾åƒå¤„ç†åŠŸèƒ½ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">List</span><span class="o">&lt;</span><span class="n">Image</span><span class="o">&gt;</span> <span class="n">images</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">        <span class="n">images</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">JPEGImage</span><span class="o">(</span><span class="n">jpegData</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">images</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">PNGImage</span><span class="o">(</span><span class="n">pngData</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="n">images</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">BMPImage</span><span class="o">(</span><span class="n">bmpData</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">BlackWhiteImageProcessor</span> <span class="n">processor</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BlackWhiteImageProcessor</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="n">Image</span> <span class="n">image</span> <span class="o">:</span> <span class="n">images</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">image</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">processor</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒAcyclic Visitor æ¨¡å¼ä½¿æˆ‘ä»¬èƒ½å¤Ÿå®ç°å¯¹å¤šç§ç±»å‹çš„å›¾åƒè¿›è¡Œä¸åŒçš„å¤„ç†ï¼ŒåŒæ—¶ä¿æŒä»£ç çš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°æ·»åŠ æ–°çš„å›¾åƒå¤„ç†å™¨ç±»ï¼Œå¦‚ SepiaImageProcessorã€BlurImageProcessor ã€RotateImageProcessor ç­‰ï¼Œè€Œæ— éœ€ä¿®æ”¹å›¾åƒç±»å±‚æ¬¡ç»“æ„çš„ä»£ç ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é¿å…åœ¨å›¾åƒç±»å±‚æ¬¡ç»“æ„ä¸­æ·»åŠ å¤„ç†æ–¹æ³•ï¼Œè€Œæ˜¯å°†å¤„ç†é€»è¾‘å°è£…åœ¨è®¿é—®è€…ç±»ä¸­ï¼Œä»è€Œæé«˜ä»£ç çš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
<p>ä¸‹é¢æˆ‘ç»™å‡ºä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ä»£ç æ¥æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ Acyclic Visitor æ¨¡å¼æ¥å®ç°å¯¹ CPU å ç”¨ç‡ã€å†…å­˜ä½¿ç”¨é‡ã€ç½‘ç»œæµé‡ç­‰ç›‘æµ‹æ•°æ®çš„è®¿é—®ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª Visitor æ¥å£åŠå…¶å­æ¥å£ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Visitor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">CPUUsageVisitor</span> <span class="kd">extends</span> <span class="n">Visitor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">visit</span><span class="o">(</span><span class="n">CPUUsage</span> <span class="n">cpuUsage</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MemoryUsageVisitor</span> <span class="kd">extends</span> <span class="n">Visitor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">visit</span><span class="o">(</span><span class="n">MemoryUsage</span> <span class="n">memoryUsage</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">NetworkTrafficVisitor</span> <span class="kd">extends</span> <span class="n">Visitor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">visit</span><span class="o">(</span><span class="n">NetworkTraffic</span> <span class="n">networkTraffic</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ç„¶åï¼Œæˆ‘ä»¬å®šä¹‰ä¸‰ä¸ªç›‘æµ‹æ•°æ®ç±»ï¼šCPUUsageã€MemoryUsage å’Œ NetworkTrafficã€‚è¿™äº›ç±»å®ç°äº† Visitor æ¥å£ï¼Œå¹¶ä¸”å®šä¹‰äº†ä¸€ä¸ª accept æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ª Visitor å¯¹è±¡ï¼Œå¹¶è°ƒç”¨ Visitor å¯¹è±¡çš„ visit æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Usages</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="n">Visitor</span> <span class="n">visitor</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CPUUsage</span> <span class="kd">implements</span> <span class="n">Usages</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">double</span> <span class="n">usage</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">CPUUsage</span><span class="o">(</span><span class="kt">double</span> <span class="n">usage</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">usage</span> <span class="o">=</span> <span class="n">usage</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">double</span> <span class="nf">getUsage</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">usage</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="n">Visitor</span> <span class="n">visitor</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">visitor</span> <span class="k">instanceof</span> <span class="n">CPUUsageVisitor</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="o">((</span><span class="n">CPUUsageVisitor</span><span class="o">)</span> <span class="n">visitor</span><span class="o">).</span><span class="na">visit</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemoryUsage</span> <span class="kd">implements</span> <span class="n">Visitor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">long</span> <span class="n">used</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">long</span> <span class="n">total</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">MemoryUsage</span><span class="o">(</span><span class="kt">long</span> <span class="n">used</span><span class="o">,</span> <span class="kt">long</span> <span class="n">total</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">used</span> <span class="o">=</span> <span class="n">used</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">total</span> <span class="o">=</span> <span class="n">total</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getUsed</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">used</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getTotal</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">total</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="n">Visitor</span> <span class="n">visitor</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">visitor</span> <span class="k">instanceof</span> <span class="n">MemoryUsageVisitor</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="o">((</span><span class="n">MemoryUsageVisitor</span><span class="o">)</span> <span class="n">visitor</span><span class="o">).</span><span class="na">visit</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NetworkTraffic</span> <span class="kd">implements</span> <span class="n">Visitor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">long</span> <span class="n">sent</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">long</span> <span class="n">received</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">NetworkTraffic</span><span class="o">(</span><span class="kt">long</span> <span class="n">sent</span><span class="o">,</span> <span class="kt">long</span> <span class="n">received</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">sent</span> <span class="o">=</span> <span class="n">sent</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">received</span> <span class="o">=</span> <span class="n">received</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getSent</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">sent</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getReceived</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">received</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="n">Visitor</span> <span class="n">visitor</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">visitor</span> <span class="k">instanceof</span> <span class="n">NetworkTrafficVisitor</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="o">((</span><span class="n">NetworkTrafficVisitor</span><span class="o">)</span> <span class="n">visitor</span><span class="o">).</span><span class="na">visit</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰ä¸‰ä¸ª Visitor å®ç°ç±»ï¼šCPUUsageLoggerVistorã€MemoryUsageLoggerVistor å’Œ NetworkTrafficLoggerVistorã€‚è¿™äº›ç±»å®ç°äº† CPUUsageVisitorã€MemoryUsageVisitor å’Œ NetworkTrafficVisitor æ¥å£ï¼Œå¹¶å®ç°äº† visit æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç”¨äºè®°å½•ç›‘æµ‹æ•°æ®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CPUUsageLoggerVistor</span> <span class="kd">implements</span> <span class="n">CPUUsageVisitor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">visit</span><span class="o">(</span><span class="n">CPUUsage</span> <span class="n">cpuUsage</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">double</span> <span class="n">usage</span> <span class="o">=</span> <span class="n">cpuUsage</span><span class="o">.</span><span class="na">getUsage</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;CPU Usage: &#34;</span> <span class="o">+</span> <span class="n">usage</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MemoryUsageLoggerVistor</span> <span class="kd">implements</span> <span class="n">MemoryUsageVisitor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">visit</span><span class="o">(</span><span class="n">MemoryUsage</span> <span class="n">memoryUsage</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">long</span> <span class="n">used</span> <span class="o">=</span> <span class="n">memoryUsage</span><span class="o">.</span><span class="na">getUsed</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="kt">long</span> <span class="n">total</span> <span class="o">=</span> <span class="n">memoryUsage</span><span class="o">.</span><span class="na">getTotal</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="kt">double</span> <span class="n">usage</span> <span class="o">=</span> <span class="o">(</span><span class="kt">double</span><span class="o">)</span> <span class="n">used</span> <span class="o">/</span> <span class="n">total</span> <span class="o">*</span> <span class="n">100</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Memory Usage: &#34;</span> <span class="o">+</span> <span class="n">usage</span> <span class="o">+</span> <span class="s">&#34;%&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NetworkTrafficLoggerVistor</span> <span class="kd">implements</span> <span class="n">NetworkTrafficVisitor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">visit</span><span class="o">(</span><span class="n">NetworkTraffic</span> <span class="n">networkTraffic</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">long</span> <span class="n">sent</span> <span class="o">=</span> <span class="n">networkTraffic</span><span class="o">.</span><span class="na">getSent</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="kt">long</span> <span class="n">received</span> <span class="o">=</span> <span class="n">networkTraffic</span><span class="o">.</span><span class="na">getReceived</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Network Traffic: Sent=&#34;</span> <span class="o">+</span> <span class="n">sent</span> <span class="o">+</span> <span class="s">&#34; bytes, Received=&#34;</span> <span class="o">+</span> <span class="n">received</span> <span class="o">+</span> <span class="s">&#34; bytes&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æœ€åï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç›‘æµ‹æ•°æ®æºç±»ï¼šSystemMonitorã€‚è¯¥ç±»ç»´æŠ¤ä¸‰ä¸ªç›‘æµ‹æ•°æ®ï¼šCPUUsageã€MemoryUsage å’Œ NetworkTrafficï¼Œå¹¶æä¾›ç›¸åº”çš„æ–¹æ³•ç”¨äºæ›´æ–°ç›‘æµ‹æ•°æ®ã€‚è¯¥ç±»è¿˜æä¾›ä¸€ä¸ª accept æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥å—ä¸€ä¸ª Visitor å¯¹è±¡ï¼Œå¹¶å°†è¯¥ Visitor å¯¹è±¡ä¼ é€’ç»™å„ä¸ªç›‘æµ‹æ•°æ®å¯¹è±¡ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SystemMonitor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">CPUUsage</span> <span class="n">cpuUsage</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">MemoryUsage</span> <span class="n">memoryUsage</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">NetworkTraffic</span> <span class="n">networkTraffic</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateCPUUsage</span><span class="o">(</span><span class="kt">double</span> <span class="n">usage</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">cpuUsage</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CPUUsage</span><span class="o">(</span><span class="n">usage</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateMemoryUsage</span><span class="o">(</span><span class="kt">long</span> <span class="n">used</span><span class="o">,</span> <span class="kt">long</span> <span class="n">total</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">memoryUsage</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MemoryUsage</span><span class="o">(</span><span class="n">used</span><span class="o">,</span> <span class="n">total</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateNetworkTraffic</span><span class="o">(</span><span class="kt">long</span> <span class="n">sent</span><span class="o">,</span><span class="kt">long</span> <span class="n">received</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">networkTraffic</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NetworkTraffic</span><span class="o">(</span><span class="n">sent</span><span class="o">,</span> <span class="n">received</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="n">Visitor</span> <span class="n">visitor</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">cpuUsage</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">cpuUsage</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">visitor</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">memoryUsage</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">memoryUsage</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">visitor</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">networkTraffic</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">networkTraffic</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">visitor</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸Šè¿°ç±»æ¥å®ç°å¯¹ CPU å ç”¨ç‡ã€å†…å­˜ä½¿ç”¨é‡ã€ç½‘ç»œæµé‡ç­‰ç›‘æµ‹æ•°æ®çš„è®¿é—®ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª SystemMonitor å¯¹è±¡ï¼Œå¹¶æ›´æ–°ç›‘æµ‹æ•°æ®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">SystemMonitor</span> <span class="n">monitor</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SystemMonitor</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">monitor</span><span class="o">.</span><span class="na">updateCPUUsage</span><span class="o">(</span><span class="n">0</span><span class="o">.</span><span class="na">75</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">monitor</span><span class="o">.</span><span class="na">updateMemoryUsage</span><span class="o">(</span><span class="n">1024</span><span class="o">,</span> <span class="n">2048</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">monitor</span><span class="o">.</span><span class="na">updateNetworkTraffic</span><span class="o">(</span><span class="n">1024</span><span class="o">,</span> <span class="n">2048</span><span class="o">);</span>
</span></span></code></pre></div><p>ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸‰ä¸ª Visitor å¯¹è±¡ï¼šCPUUsageLoggerVistorã€MemoryUsageLoggerVistor å’Œ NetworkTrafficLoggerVistorï¼Œç”¨äºè®°å½•ç›‘æµ‹æ•°æ®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">CPUUsageLoggerVistor</span> <span class="n">cpuUsageLogger</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CPUUsageLoggerVistor</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">MemoryUsageLoggerVistor</span> <span class="n">memoryUsageLogger</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MemoryUsageLoggerVistor</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">NetworkTrafficLoggerVistor</span> <span class="n">networkTrafficLogger</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NetworkTrafficLoggerVistor</span><span class="o">();</span>
</span></span></code></pre></div><p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº› Visitor å¯¹è±¡ä¼ é€’ç»™ SystemMonitor å¯¹è±¡ï¼Œå¹¶è°ƒç”¨ accept æ–¹æ³•æ¥è®¿é—®ç›‘æµ‹æ•°æ®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">monitor</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">cpuUsageLogger</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">monitor</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">memoryUsageLogger</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">monitor</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">networkTrafficLogger</span><span class="o">);</span>
</span></span></code></pre></div><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ Acyclic Visitor æ¨¡å¼æ¥å®ç°å¯¹ CPU å ç”¨ç‡ã€å†…å­˜ä½¿ç”¨é‡ã€ç½‘ç»œæµé‡ç­‰ç›‘æµ‹æ•°æ®çš„è®¿é—®ã€‚</p>
<h2 id="å‚è€ƒæ–‡ç« ">å‚è€ƒæ–‡ç« </h2>
<ul>
<li>
<p><a href="http://condor.depaul.edu/dmumaugh/OOT/Design-Principles/acv.pdf">Acyclic Visitor by Robert C. Martin</a></p>
</li>
<li>
<p><a href="https://wiki.c2.com/?AcyclicVisitor">Acyclic Visitor in WikiWikiWeb</a></p>
</li>
</ul>
]]></content:encoded>
    </item>
    
    <item>
      <title>[è¯‘]ä»€ä¹ˆæ˜¯ Python Wheelsï¼Œä½ ä¸ºä»€ä¹ˆè¦å…³å¿ƒå®ƒï¼Ÿ</title>
      <link>https://blog.chensoul.com/posts/2023/06/01/python-wheels/</link>
      <pubDate>Thu, 01 Jun 2023 09:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/06/01/python-wheels/</guid>
      <description>Python .whl æ–‡ä»¶æˆ– wheels æ˜¯ Python ä¸­å¾ˆå°‘è¢«è®¨è®ºçš„éƒ¨åˆ†ï¼Œä½†å®ƒä»¬å¯¹ Python åŒ…çš„å®‰è£…è¿‡ç¨‹å¤§æœ‰è£¨ç›Šã€‚å¦‚æœæ‚¨ä½¿ç”¨ pip å®‰è£…äº† Python åŒ…ï¼Œé‚£ä¹ˆ Wheels å¾ˆå¯èƒ½ä½¿å®‰è£…æ›´å¿«ã€æ›´é«˜æ•ˆã€‚ Wheels æ˜¯ Python ç”Ÿæ€ç³»ç»Ÿçš„</description>
      <content:encoded><![CDATA[<p><img loading="lazy" src="https://files.realpython.com/media/What-are-Python-Wheels-and-Why-Should-You-Care_Watermarked.22246cad13be.jpg" alt="What Are Python Wheels and Why Should You Care?"  />
</p>
<p>Python <code>.whl</code> æ–‡ä»¶æˆ– <a href="https://packaging.python.org/glossary/#term-wheel">wheels</a> æ˜¯ Python ä¸­å¾ˆå°‘è¢«è®¨è®ºçš„éƒ¨åˆ†ï¼Œä½†å®ƒä»¬å¯¹ <a href="https://realpython.com/python-modules-packages/">Python åŒ…</a>çš„å®‰è£…è¿‡ç¨‹å¤§æœ‰è£¨ç›Šã€‚å¦‚æœæ‚¨ä½¿ç”¨ <a href="https://realpython.com/what-is-pip/">pip</a> å®‰è£…äº† Python åŒ…ï¼Œé‚£ä¹ˆ Wheels å¾ˆå¯èƒ½ä½¿å®‰è£…æ›´å¿«ã€æ›´é«˜æ•ˆã€‚</p>
<p>Wheels æ˜¯ Python ç”Ÿæ€ç³»ç»Ÿçš„ä¸€ä¸ªç»„ä»¶ï¼Œæœ‰åŠ©äºä½¿åŒ…å®‰è£…æ­£å¸¸å·¥ä½œã€‚å®ƒä»¬å…è®¸æ›´å¿«çš„å®‰è£…å’Œæ›´ç¨³å®šçš„åŒ…åˆ†å‘è¿‡ç¨‹ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†æ·±å…¥äº†è§£ Wheels æ˜¯ä»€ä¹ˆï¼Œå®ƒä»¬æœ‰ä»€ä¹ˆå¥½å¤„ï¼Œä»¥åŠå®ƒä»¬å¦‚ä½•è·å¾—ç‰µå¼•åŠ›å¹¶ä½¿ Python ä½¿ç”¨èµ·æ¥æ›´åŠ æ„‰å¿«ã€‚</p>
<p><strong>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†å­¦ä¹ ï¼š</strong></p>
<ul>
<li>ä»€ä¹ˆæ˜¯ Wheels ä»¥åŠå®ƒä»¬ä¸æºä»£ç åˆ†å‘çš„æ¯”è¾ƒ</li>
<li>å¦‚ä½•ä½¿ç”¨ Wheels æ¥æ§åˆ¶åŒ…å®‰è£…è¿‡ç¨‹</li>
<li>å¦‚ä½•ä¸ºæ‚¨è‡ªå·±çš„ Python åŒ…åˆ›å»ºå’Œåˆ†å‘ Wheels</li>
</ul>
<p>æ‚¨å°†ä»ç”¨æˆ·å’Œå¼€å‘äººå‘˜çš„è§’åº¦çœ‹åˆ°ä½¿ç”¨æµè¡Œçš„å¼€æº Python åŒ…çš„ç¤ºä¾‹ã€‚</p>
<blockquote>
<p>å…è´¹èµ å“ï¼šå•å‡»<a href="https://realpython.com/python-wheels/">æ­¤å¤„</a>è·å– Python å¤‡å¿˜å•å¹¶å­¦ä¹  Python 3 çš„åŸºç¡€çŸ¥è¯†ï¼Œä¾‹å¦‚ä½¿ç”¨æ•°æ®ç±»å‹ã€å­—å…¸ã€åˆ—è¡¨å’Œ Python å‡½æ•°ã€‚</p>
</blockquote>
<h2 id="å®‰è£…">å®‰è£…</h2>
<p>æ¥ä¸‹æ¥ï¼Œæ¿€æ´»è™šæ‹Ÿç¯å¢ƒå¹¶ç¡®ä¿å®‰è£…äº†æœ€æ–°ç‰ˆæœ¬çš„ <code>pip</code> ã€ <code>wheel</code> å’Œ <code>setuptools</code> ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python -m venv env <span class="o">&amp;&amp;</span> <span class="nb">source</span> ./env/bin/activate
</span></span><span class="line"><span class="cl">$ python -m pip install -U pip wheel setuptools
</span></span><span class="line"><span class="cl">Successfully installed pip 20.1 setuptools-46.1.3 wheel-0.34.2
</span></span></code></pre></div><p>è¿™å°±æ˜¯æ‚¨å°è¯•å®‰è£…å’Œæ„å»º Wheels æ‰€éœ€çš„å…¨éƒ¨å†…å®¹ï¼</p>
<h2 id="python-æ‰“åŒ…å˜å¾—æ›´å¥½python-wheels-ç®€ä»‹">Python æ‰“åŒ…å˜å¾—æ›´å¥½ï¼šPython Wheels ç®€ä»‹</h2>
<p>åœ¨å­¦ä¹ å¦‚ä½•å°†é¡¹ç›®æ‰“åŒ…åˆ° wheel ä¹‹å‰ï¼Œä»ç”¨æˆ·çš„è§’åº¦äº†è§£ä½¿ç”¨ wheel çš„æ ·å­ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚è¿™å¬èµ·æ¥å¯èƒ½æœ‰ç‚¹è½åï¼Œä½†äº†è§£ Wheels å¦‚ä½•å·¥ä½œçš„ä¸€ä¸ªå¥½æ–¹æ³•æ˜¯ä»å®‰è£…ä¸€ä¸ªä¸æ˜¯ Wheels çš„ä¸œè¥¿å¼€å§‹ã€‚</p>
<p>æ‚¨å¯ä»¥åƒå¾€å¸¸ä¸€æ ·ï¼Œé€šè¿‡å°† Python åŒ…å®‰è£…åˆ°æ‚¨çš„ç¯å¢ƒä¸­æ¥å¼€å§‹è¿™ä¸ªå®éªŒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®‰è£… <a href="https://github.com/unbit/uwsgi">uWSGI</a> ç‰ˆæœ¬ 2.0.xï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python -m pip install <span class="s1">&#39;uwsgi==2.0.*&#39;</span>
</span></span><span class="line"><span class="cl">Collecting <span class="nv">uwsgi</span><span class="o">==</span>2.0.*
</span></span><span class="line"><span class="cl">  Downloading uwsgi-2.0.18.tar.gz <span class="o">(</span><span class="m">801</span> kB<span class="o">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">|</span>â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ<span class="p">|</span> <span class="m">801</span> kB 1.1 MB/s
</span></span><span class="line"><span class="cl">Building wheels <span class="k">for</span> collected packages: uwsgi
</span></span><span class="line"><span class="cl">  Building wheel <span class="k">for</span> uwsgi <span class="o">(</span>setup.py<span class="o">)</span> ... <span class="k">done</span>
</span></span><span class="line"><span class="cl">  Created wheel <span class="k">for</span> uwsgi ... uWSGI-2.0.18-cp38-cp38-macosx_10_15_x86_64.whl
</span></span><span class="line"><span class="cl">  Stored in directory: /private/var/folders/jc/8_hqsz0x1tdbp05 ...
</span></span><span class="line"><span class="cl">Successfully built uwsgi
</span></span><span class="line"><span class="cl">Installing collected packages: uwsgi
</span></span><span class="line"><span class="cl">Successfully installed uwsgi-2.0.18
</span></span></code></pre></div><p>ä¸ºäº†å®Œå…¨å®‰è£… uWSGIï¼Œ <code>pip</code> é€šè¿‡å‡ ä¸ªä¸åŒçš„æ­¥éª¤è¿›è¡Œï¼š</p>
<ul>
<li>
<p>åœ¨ç¬¬ 3 è¡Œï¼Œå®ƒä¸‹è½½äº†ä¸€ä¸ªåä¸º <code>uwsgi-2.0.18.tar.gz</code> çš„ TAR æ–‡ä»¶ (tarball)ï¼Œè¯¥æ–‡ä»¶å·²ä½¿ç”¨ <a href="https://www.gnu.org/software/gzip/manual/gzip.html">gzip</a> å‹ç¼©ã€‚</p>
</li>
<li>
<p>åœ¨ç¬¬ 6 è¡Œï¼Œå®ƒè·å– tarball å¹¶é€šè¿‡è°ƒç”¨ <code>setup.py</code> æ„å»ºä¸€ä¸ª <code>.whl</code> æ–‡ä»¶ã€‚</p>
</li>
<li>
<p>åœ¨ç¬¬ 7 è¡Œï¼Œå®ƒå°† wheel æ ‡è®°ä¸º <code>uWSGI-2.0.18-cp38-cp38-macosx_10_15_x86_64.whl</code> ã€‚</p>
</li>
<li>
<p>åœ¨ç¬¬ 10 è¡Œï¼Œå®ƒåœ¨æ„å»º wheel åå®‰è£…å®é™…çš„åŒ…ã€‚</p>
</li>
</ul>
<p><code>pip</code> æ£€ç´¢åˆ°çš„ <code>tar.gz</code> tarball æ˜¯æºä»£ç åˆ†å‘ç‰ˆæˆ– <code>sdist</code> ï¼Œè€Œä¸æ˜¯ wheelã€‚åœ¨æŸäº›æ–¹é¢ï¼Œ <code>sdist</code> ä¸wheelç›¸åã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå¦‚æœæ‚¨çœ‹åˆ° uWSGI å®‰è£…é”™è¯¯ï¼Œæ‚¨å¯èƒ½éœ€è¦<a href="https://uwsgi-docs.readthedocs.io/en/latest/Install.html#installing-from-source">å®‰è£… Python å¼€å‘å¤´æ–‡ä»¶</a>ã€‚</p>
</blockquote>
<p><a href="https://packaging.python.org/glossary/#term-source-distribution-or-sdist">æºä»£ç åˆ†å‘</a>åŒ…å«æºä»£ç ã€‚è¿™ä¸ä»…åŒ…æ‹¬ Python ä»£ç ï¼Œè¿˜åŒ…æ‹¬ä¸åŒ…æ†ç»‘åœ¨ä¸€èµ·çš„ä»»ä½•æ‰©å±•æ¨¡å—ï¼ˆé€šå¸¸æ˜¯ C æˆ– C++ï¼‰çš„æºä»£ç ã€‚å¯¹äºæºä»£ç åˆ†å‘ï¼Œæ‰©å±•æ¨¡å—æ˜¯åœ¨ç”¨æˆ·ç«¯è€Œä¸æ˜¯å¼€å‘äººå‘˜ç«¯ç¼–è¯‘çš„ã€‚</p>
<p>æºåˆ†å‘ç‰ˆè¿˜åŒ…å«ä¸€ç»„å…ƒæ•°æ®ï¼Œä½äºåä¸º <code>&lt;package-name&gt;.egg-info</code> çš„ç›®å½•ä¸­ã€‚æ­¤å…ƒæ•°æ®æœ‰åŠ©äºæ„å»ºå’Œå®‰è£…åŒ…ï¼Œä½†ç”¨æˆ·å®é™…ä¸Šä¸éœ€è¦å¯¹å…¶æ‰§è¡Œä»»ä½•æ“ä½œã€‚</p>
<p>ä»å¼€å‘äººå‘˜çš„è§’åº¦æ¥çœ‹ï¼Œæºä»£ç åˆ†å‘æ˜¯åœ¨æ‚¨è¿è¡Œä»¥ä¸‹å‘½ä»¤æ—¶åˆ›å»ºçš„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python setup.py sdist
</span></span></code></pre></div><p>ç°åœ¨å°è¯•å®‰è£…ä¸åŒçš„åŒ… <a href="https://github.com/chardet/chardet/blob/master/docs/index.rst">chardet</a>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python -m pip install <span class="s1">&#39;chardet==3.*&#39;</span>
</span></span><span class="line"><span class="cl">Collecting chardet
</span></span><span class="line"><span class="cl">  Downloading chardet-3.0.4-py2.py3-none-any.whl <span class="o">(</span><span class="m">133</span> kB<span class="o">)</span>
</span></span><span class="line"><span class="cl">     <span class="p">|</span>â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ<span class="p">|</span> <span class="m">133</span> kB 1.5 MB/s
</span></span><span class="line"><span class="cl">Installing collected packages: chardet
</span></span><span class="line"><span class="cl">Successfully installed chardet-3.0.4
</span></span></code></pre></div><p>æ‚¨å¯ä»¥çœ‹åˆ°ä¸ uWSGI å®‰è£…æ˜æ˜¾ä¸åŒçš„è¾“å‡ºã€‚</p>
<p>å®‰è£… chardet ä¼šç›´æ¥ä» PyPI ä¸‹è½½ä¸€ä¸ª <code>.whl</code> æ–‡ä»¶ã€‚ Wheels åç§° <code>chardet-3.0.4-py2.py3-none-any.whl</code> éµå¾ªæ‚¨ç¨åå°†çœ‹åˆ°çš„ç‰¹å®šå‘½åçº¦å®šã€‚ä»ç”¨æˆ·çš„è§’åº¦æ¥çœ‹ï¼Œæ›´é‡è¦çš„æ˜¯å½“ <code>pip</code> åœ¨ PyPI ä¸Šæ‰¾åˆ°å…¼å®¹çš„ wheel æ—¶ï¼Œæ²¡æœ‰æ„å»ºé˜¶æ®µã€‚</p>
<p>ä»å¼€å‘äººå‘˜çš„è§’åº¦æ¥çœ‹ï¼Œwheel æ˜¯è¿è¡Œä»¥ä¸‹å‘½ä»¤çš„ç»“æœï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python setup.py bdist_wheel
</span></span></code></pre></div><p>ä¸ºä»€ä¹ˆ uWSGI ç»™ä½ ä¸€ä¸ªæºä»£ç åˆ†å‘è€Œ chardet æä¾›ä¸€ä¸ª wheelï¼Ÿæ‚¨å¯ä»¥é€šè¿‡æŸ¥çœ‹ PyPI ä¸Šæ¯ä¸ªé¡¹ç›®çš„é¡µé¢å¹¶å¯¼èˆªåˆ°ä¸‹è½½æ–‡ä»¶åŒºåŸŸæ¥äº†è§£å…¶åŸå› ã€‚æœ¬èŠ‚å°†å‘æ‚¨å±•ç¤º <code>pip</code> åœ¨ PyPI ç´¢å¼•æœåŠ¡å™¨ä¸Šå®é™…çœ‹åˆ°çš„å†…å®¹ï¼š</p>
<ul>
<li>
<p>å‡ºäºä¸é¡¹ç›®å¤æ‚æ€§ç›¸å…³çš„åŸå› ï¼ŒuWSGI ä»…æä¾›äº†ä¸€ä¸ª<a href="https://pypi.org/project/uWSGI/2.0.18/#files">æºä»£ç åˆ†å‘</a>ï¼ˆ <code>uwsgi-2.0.18.tar.gz</code> ï¼‰ã€‚</p>
</li>
<li>
<p>chardet æä¾›äº† <a href="https://pypi.org/project/chardet/3.0.4/#files">wheel å’Œæºä»£ç åˆ†å‘</a>ï¼Œä½†å¦‚æœå®ƒä¸æ‚¨çš„ç³»ç»Ÿå…¼å®¹ï¼Œ <code>pip</code> ä¼šæ›´å–œæ¬¢ wheelã€‚ç¨åæ‚¨å°†çœ‹åˆ°å¦‚ä½•ç¡®å®šå…¼å®¹æ€§ã€‚</p>
</li>
</ul>
<p>ç”¨äº wheel å®‰è£…çš„å…¼å®¹æ€§æ£€æŸ¥çš„å¦ä¸€ä¸ªç¤ºä¾‹æ˜¯ <code>psycopg2</code> ï¼Œå®ƒä¸º Windows æä¾›äº†å¹¿æ³›çš„ wheelsï¼Œä½†ä¸ä¸º Linux æˆ– macOS å®¢æˆ·ç«¯æä¾›ä»»ä½• wheelsã€‚è¿™æ„å‘³ç€ <code>pip install psycopg2</code> å¯ä»¥æ ¹æ®æ‚¨çš„ç‰¹å®šè®¾ç½®è·å– Wheels æˆ–æºä»£ç åˆ†å‘ã€‚</p>
<p>ä¸ºäº†é¿å…è¿™äº›ç±»å‹çš„å…¼å®¹æ€§é—®é¢˜ï¼Œä¸€äº›åŒ…æä¾›äº†å¤šä¸ª wheelsï¼Œæ¯ä¸ª wheels éƒ½é’ˆå¯¹ç‰¹å®šçš„ Python å®ç°å’Œåº•å±‚æ“ä½œç³»ç»Ÿã€‚</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ‚¨å·²ç»çœ‹åˆ°äº† wheel å’Œ <code>sdist</code> ä¹‹é—´çš„ä¸€äº›æ˜æ˜¾åŒºåˆ«ï¼Œä½†æ›´é‡è¦çš„æ˜¯è¿™äº›å·®å¼‚å¯¹å®‰è£…è¿‡ç¨‹çš„å½±å“ã€‚</p>
<h3 id="wheels-è®©äº‹æƒ…å˜å¾—å¿«é€Ÿ">Wheels è®©äº‹æƒ…å˜å¾—å¿«é€Ÿ</h3>
<p>åœ¨ä¸Šé¢ï¼Œæ‚¨çœ‹åˆ°äº†è·å–é¢„åˆ¶ wheels çš„å®‰è£…ä¸ä¸‹è½½ <code>sdist</code> çš„å®‰è£…çš„æ¯”è¾ƒã€‚ Wheels ä½¿ Python åŒ…çš„ç«¯åˆ°ç«¯å®‰è£…æ›´å¿«ï¼ŒåŸå› æœ‰äºŒï¼š</p>
<ul>
<li>åœ¨å…¶ä»–æ¡ä»¶ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œwheels çš„å°ºå¯¸é€šå¸¸æ¯”æºåˆ†å‘å°ï¼Œè¿™æ„å‘³ç€å®ƒä»¬å¯ä»¥åœ¨ç½‘ç»œä¸­æ›´å¿«åœ°ç§»åŠ¨ã€‚</li>
<li>ç›´æ¥ä» wheels å®‰è£…é¿å…äº†ä»æºåˆ†å‘æ„å»ºåŒ…çš„ä¸­é—´æ­¥éª¤ã€‚</li>
</ul>
<p>å‡ ä¹å¯ä»¥ä¿è¯ chardet å®‰è£…åªç”¨äº† uWSGI æ‰€éœ€æ—¶é—´çš„ä¸€å°éƒ¨åˆ†ã€‚ç„¶è€Œï¼Œè¿™å¯ä»¥è¯´æ˜¯ä¸€ä¸ªä¸å…¬å¹³çš„è‹¹æœä¸æ©˜å­çš„æ¯”è¾ƒï¼Œå› ä¸º chardet æ˜¯ä¸€ä¸ªå°å¾—å¤šä¸”ä¸é‚£ä¹ˆå¤æ‚çš„åŒ…ã€‚</p>
<p>ä½¿ç”¨ä¸åŒçš„å‘½ä»¤ï¼Œæ‚¨å¯ä»¥åˆ›å»ºæ›´ç›´æ¥çš„æ¯”è¾ƒï¼Œä»¥è¯æ˜ wheels çš„å·®å¼‚æœ‰å¤šå¤§ã€‚</p>
<p>æ‚¨å¯ä»¥é€šè¿‡ä¼ é€’ <code>--no-binary</code> é€‰é¡¹è®© <code>pip</code> å¿½ç•¥å®ƒå¯¹ wheels çš„å€¾æ–œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="nb">time</span> python -m pip install <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      --no-cache-dir <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      --force-reinstall <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      --no-binary<span class="o">=</span>:all: <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      cryptography
</span></span></code></pre></div><p>æ­¤å‘½ä»¤è®¡æ—¶ <a href="https://pypi.org/project/cryptography/">cryptography</a> åŒ…çš„å®‰è£…ï¼Œå‘Šè¯‰ <code>pip</code> ä½¿ç”¨æºä»£ç åˆ†å‘ï¼Œå³ä½¿æœ‰åˆé€‚çš„ Wheels å¯ç”¨ã€‚åŒ…å« <code>:all:</code> ä¼šä½¿è§„åˆ™é€‚ç”¨äº <code>cryptography</code> åŠå…¶æ‰€æœ‰<a href="https://realpython.com/courses/managing-python-dependencies/">ä¾èµ–é¡¹</a>ã€‚</p>
<p>åœ¨æˆ‘çš„æœºå™¨ä¸Šï¼Œè¿™ä»å¼€å§‹åˆ°ç»“æŸå¤§çº¦éœ€è¦ 32 ç§’ã€‚ä¸ä»…å®‰è£…éœ€è¦å¾ˆé•¿æ—¶é—´ï¼Œè€Œä¸”æ„å»º <code>cryptography</code> è¿˜éœ€è¦æ‚¨æ‹¥æœ‰ OpenSSL å¼€å‘æ ‡å¤´å¹¶å¯ä¾› Python ä½¿ç”¨ã€‚</p>
<p>æ³¨æ„ï¼šå¯¹äº <code>--no-binary</code> ï¼Œæ‚¨å¾ˆå¯èƒ½ä¼šçœ‹åˆ°æœ‰å…³ç¼ºå°‘ <code>cryptography</code> å®‰è£…æ‰€éœ€çš„å¤´æ–‡ä»¶çš„é”™è¯¯ï¼Œè¿™æ˜¯ä½¿ç”¨æºä»£ç åˆ†å‘ä»¤äººæ²®ä¸§çš„éƒ¨åˆ†åŸå› ã€‚å¦‚æœæ˜¯è¿™æ ·ï¼Œ <code>cryptography</code> æ–‡æ¡£çš„<a href="https://cryptography.io/en/latest/installation/#building-cryptography-on-linux">å®‰è£…éƒ¨åˆ†</a>ä¼šå°±ç‰¹å®šæ“ä½œç³»ç»Ÿéœ€è¦å“ªäº›åº“å’Œå¤´æ–‡ä»¶æä¾›å»ºè®®ã€‚</p>
<p>ç°åœ¨æ‚¨å¯ä»¥é‡æ–°å®‰è£… <code>cryptography</code> ï¼Œä½†è¿™æ¬¡è¦ç¡®ä¿ <code>pip</code> ä½¿ç”¨ PyPI çš„ Wheels ã€‚å› ä¸º <code>pip</code> æ›´å–œæ¬¢ Wheels ï¼Œè¿™ç±»ä¼¼äºä¸å¸¦ä»»ä½•å‚æ•°è°ƒç”¨ <code>pip install</code> ã€‚ä½†åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥é€šè¿‡è¦æ±‚å¸¦æœ‰ <code>--only-binary</code> çš„ Wheels æ¥æ˜ç¡®æ„å›¾ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="nb">time</span> python -m pip install <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      --no-cache-dir <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      --force-reinstall <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      --only-binary<span class="o">=</span>cryptography <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      cryptography
</span></span></code></pre></div><p>æ­¤é€‰é¡¹åªéœ€è¦å››ç§’å¤šä¸€ç‚¹ï¼Œæˆ–è€…æ˜¯ä»…ä½¿ç”¨ <code>cryptography</code> åŠå…¶ä¾èµ–é¡¹çš„æºä»£ç åˆ†å‘æ—¶æ‰€ç”¨æ—¶é—´çš„å…«åˆ†ä¹‹ä¸€ã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯-python-wheel">ä»€ä¹ˆæ˜¯ Python Wheelï¼Ÿ</h3>
<p>Python <code>.whl</code> æ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª ZIP ( <code>.zip</code> ) å­˜æ¡£ï¼Œå¸¦æœ‰ç‰¹åˆ¶çš„æ–‡ä»¶åï¼Œå‘Šè¯‰å®‰è£…è€… Wheels å°†æ”¯æŒå“ªäº› Python ç‰ˆæœ¬å’Œå¹³å°ã€‚</p>
<p>Wheels æ˜¯ä¸€ç§<a href="https://packaging.python.org/glossary/#term-built-distribution">å†…ç½®åˆ†å‘</a>ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œbuilt æ„å‘³ç€ wheel ä»¥å¯ç«‹å³å®‰è£…çš„æ ¼å¼å‡ºç°ï¼Œå¹¶å…è®¸æ‚¨è·³è¿‡æºä»£ç åˆ†å‘æ‰€éœ€çš„æ„å»ºé˜¶æ®µã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå€¼å¾—ä¸€æçš„æ˜¯ï¼Œå°½ç®¡ä½¿ç”¨äº†æœ¯è¯­æ„å»ºï¼Œä½† Wheels ä¸åŒ…å« <code>.pyc</code> æ–‡ä»¶æˆ–ç¼–è¯‘çš„ Python å­—èŠ‚ç ã€‚</p>
</blockquote>
<p>wheel æ–‡ä»¶åè¢«åˆ†æˆç”±è¿å­—ç¬¦åˆ†éš”çš„éƒ¨åˆ†ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">{</span>dist<span class="o">}</span>-<span class="o">{</span>version<span class="o">}(</span>-<span class="o">{</span>build<span class="o">})</span>?-<span class="o">{</span>python<span class="o">}</span>-<span class="o">{</span>abi<span class="o">}</span>-<span class="o">{</span>platform<span class="o">}</span>.whl
</span></span></code></pre></div><p><code>{brackets}</code> ä¸­çš„æ¯ä¸ªéƒ¨åˆ†éƒ½æ˜¯ä¸€ä¸ªæ ‡ç­¾ï¼Œæˆ–è€…æ˜¯ wheel åç§°çš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†ï¼Œå®ƒå¸¦æœ‰ä¸€äº›å…³äº wheel åŒ…å«çš„å†…å®¹ä»¥åŠ wheel å°†åœ¨ä½•å¤„å·¥ä½œæˆ–ä¸å·¥ä½œçš„å«ä¹‰ã€‚</p>
<p>è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ <code>cryptography</code>  Wheels çš„è¯´æ˜æ€§ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cryptography-2.9.2-cp35-abi3-macosx_10_9_x86_64.whl
</span></span></code></pre></div><p><code>cryptography</code> åˆ†é…å¤šä¸ª Wheels ã€‚æ¯ä¸ª Wheels éƒ½æ˜¯ä¸€ä¸ªå¹³å° Wheels ï¼Œè¿™æ„å‘³ç€å®ƒä»…æ”¯æŒ Python ç‰ˆæœ¬ã€Python ABIã€æ“ä½œç³»ç»Ÿå’Œæœºå™¨æ¶æ„çš„ç‰¹å®šç»„åˆã€‚æ‚¨å¯ä»¥å°†å‘½åçº¦å®šåˆ†è§£ä¸ºå¤šä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li><code>cryptography</code> æ˜¯åŒ…åã€‚</li>
<li><code>2.9.2</code> æ˜¯ <code>cryptography</code> çš„åŒ…ç‰ˆæœ¬ã€‚ç‰ˆæœ¬æ˜¯ç¬¦åˆ PEP 440 çš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ <code>2.9.2</code> ã€ <code>3.4</code> æˆ– <code>3.9.0.a3</code> ã€‚</li>
<li><code>cp35</code> æ˜¯ <a href="https://www.python.org/dev/peps/pep-0425/#python-tag">Python æ ‡ç­¾</a>ï¼Œè¡¨ç¤º Wheels éœ€è¦çš„ Python å®ç°å’Œç‰ˆæœ¬ã€‚ <code>cp</code> ä»£è¡¨ <a href="https://realpython.com/cpython-source-code-guide/">CPython</a>ï¼ŒPython çš„å‚è€ƒå®ç°ï¼Œè€Œ <code>35</code> ä»£è¡¨ Python <a href="https://docs.python.org/3/whatsnew/3.5.html">3.5</a>ã€‚ä¾‹å¦‚ï¼Œè¿™ä¸ª Wheels ä¸ <a href="https://www.jython.org/">Jython</a> ä¸å…¼å®¹ã€‚</li>
<li><code>abi3</code> æ˜¯ ABI æ ‡ç­¾ã€‚ ABI ä»£è¡¨<a href="https://docs.python.org/3/c-api/stable.html">åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£</a>ã€‚ä½ çœŸçš„ä¸éœ€è¦æ‹…å¿ƒå®ƒéœ€è¦ä»€ä¹ˆï¼Œä½†æ˜¯ <code>abi3</code> æ˜¯ä¸€ä¸ªå•ç‹¬çš„ç‰ˆæœ¬ï¼Œç”¨äº Python C API çš„äºŒè¿›åˆ¶å…¼å®¹æ€§ã€‚</li>
<li><code>macosx_10_9_x86_64</code> æ˜¯å¹³å°æ ‡ç­¾ï¼Œæ­£å¥½æ¯”è¾ƒå•°å—¦ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒå¯ä»¥è¿›ä¸€æ­¥ç»†åˆ†ä¸ºå­éƒ¨åˆ†ï¼š
<ul>
<li><code>macosx</code> æ˜¯ macOS æ“ä½œç³»ç»Ÿã€‚</li>
<li><code>10_9</code> æ˜¯ç”¨äºç¼–è¯‘ Python çš„ macOS å¼€å‘äººå‘˜å·¥å…· SDK ç‰ˆæœ¬ï¼Œè€Œ Python åˆæ„å»ºäº†è¿™ä¸ª Wheels ã€‚</li>
<li><code>x86_64</code> æ˜¯å¯¹ x86-64 æŒ‡ä»¤é›†æ¶æ„çš„å¼•ç”¨ã€‚</li>
</ul>
</li>
</ul>
<p>æœ€åä¸€ä¸ªç»„ä»¶åœ¨æŠ€æœ¯ä¸Šä¸æ˜¯æ ‡ç­¾ï¼Œè€Œæ˜¯æ ‡å‡†çš„ <code>.whl</code> æ–‡ä»¶æ‰©å±•åã€‚ç»„åˆèµ·æ¥ï¼Œä¸Šè¿°ç»„ä»¶è¡¨æ˜æ­¤ <code>cryptography</code>  Wheels è®¾è®¡çš„ç›®æ ‡æœºå™¨ã€‚</p>
<p>ç°åœ¨è®©æˆ‘ä»¬è½¬å‘å¦ä¸€ä¸ªä¾‹å­ã€‚ä»¥ä¸‹æ˜¯æ‚¨åœ¨ä¸Šè¿° chardet æ¡ˆä¾‹ä¸­çœ‹åˆ°çš„å†…å®¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">chardet-3.0.4-py2.py3-none-any.whl
</span></span></code></pre></div><p>æ‚¨å¯ä»¥å°†å…¶åˆ†è§£ä¸ºæ ‡ç­¾ï¼š</p>
<ul>
<li><code>chardet</code> æ˜¯åŒ…åã€‚</li>
<li><code>3.0.4</code> æ˜¯ chardet çš„åŒ…ç‰ˆæœ¬ã€‚</li>
<li><code>py2.py3</code> æ˜¯ Python æ ‡ç­¾ï¼Œè¿™æ„å‘³ç€ Wheels æ”¯æŒ Python 2 å’Œ 3 ä»¥åŠä»»ä½• Python å®ç°ã€‚</li>
<li><code>none</code> æ˜¯ ABI æ ‡ç­¾ï¼Œæ„å‘³ç€ ABI ä¸æ˜¯ä¸€ä¸ªå› ç´ ã€‚</li>
<li><code>any</code> æ˜¯å¹³å°ã€‚è¿™ä¸ª Wheels å‡ ä¹å¯ä»¥åœ¨ä»»ä½•å¹³å°ä¸Šè¿è¡Œã€‚</li>
</ul>
<p>Wheels åç§°çš„ <code>py2.py3-none-any.whl</code> æ®µå¾ˆå¸¸è§ã€‚è¿™æ˜¯ä¸€ä¸ªä¸‡èƒ½  Wheels ï¼Œå¯ä»¥åœ¨å…·æœ‰ä»»ä½• <a href="https://stackoverflow.com/a/2456882/7954504">ABI</a> çš„ä»»ä½•å¹³å°ä¸Šä¸ Python 2 æˆ– 3 ä¸€èµ·å®‰è£…ã€‚å¦‚æœ Wheels ä»¥ <code>none-any.whl</code> ç»“å°¾ï¼Œé‚£ä¹ˆå®ƒå¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªä¸å…³å¿ƒç‰¹å®š Python ABI æˆ– CPU æ¶æ„çš„çº¯ Python åŒ…ã€‚</p>
<p>å¦ä¸€ä¸ªä¾‹å­æ˜¯ <code>jinja2</code> æ¨¡æ¿å¼•æ“ã€‚å¦‚æœæ‚¨å¯¼èˆªåˆ° Jinja 3.x alpha ç‰ˆæœ¬çš„<a href="https://pypi.org/project/Jinja2/3.0.0a1/#files">ä¸‹è½½é¡µé¢</a>ï¼Œæ‚¨å°†çœ‹åˆ°ä»¥ä¸‹ Wheels ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">Jinja2-3.0.0a1-py3-none-any.whl
</span></span></code></pre></div><p>æ³¨æ„è¿™é‡Œç¼ºå°‘ <code>py2</code> ã€‚è¿™æ˜¯ä¸€ä¸ªçº¯ Python é¡¹ç›®ï¼Œå¯ä»¥åœ¨ä»»ä½• Python 3.x ç‰ˆæœ¬ä¸Šè¿è¡Œï¼Œä½†å®ƒä¸æ˜¯ä¸‡èƒ½  Wheels ï¼Œå› ä¸ºå®ƒä¸æ”¯æŒ Python 2ã€‚ç›¸åï¼Œå®ƒè¢«ç§°ä¸ºçº¯ Python   Wheels ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šåœ¨ 2020 å¹´ï¼Œè®¸å¤šé¡¹ç›®ä¹Ÿæ”¾å¼ƒäº†å¯¹ Python 2 çš„æ”¯æŒï¼ŒPython 2 äº 2020 å¹´ 1 æœˆ 1 æ—¥è¾¾åˆ°ç”Ÿå‘½å‘¨æœŸç»“æŸ (EOL)ã€‚Jinja ç‰ˆæœ¬ 3.x äº 2020 å¹´ 2 æœˆæ”¾å¼ƒäº†å¯¹ Python 2 çš„æ”¯æŒã€‚</p>
</blockquote>
<p>ä»¥ä¸‹æ˜¯ä¸ºä¸€äº›æµè¡Œçš„å¼€æºåŒ…åˆ†å‘çš„ <code>.whl</code> åç§°çš„æ›´å¤šç¤ºä¾‹ï¼š</p>
<table>
<thead>
<tr>
<th>Wheel</th>
<th>What It Is è¿™æ˜¯ä»€ä¹ˆ</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>PyYAML-5.3.1-cp38-cp38-win_amd64.whl</code></td>
<td><a href="https://pypi.org/project/PyYAML/5.3.1/#files">PyYAML</a> for CPython 3.8 on Windows with AMD64 (x86-64) architecture</td>
</tr>
<tr>
<td><code>numpy-1.18.4-cp38-cp38-win32.whl</code></td>
<td><a href="https://pypi.org/project/numpy/1.18.4/#files">NumPy</a> for CPython 3.8 on Windows 32-bit</td>
</tr>
<tr>
<td><code>scipy-1.4.1-cp36-cp36m-macosx_10_6_intel.whl</code></td>
<td><a href="https://pypi.org/project/scipy/1.4.1/#files">SciPy</a> for CPython 3.6 on macOS 10.6 SDK with fat binary (multiple instruction sets)</td>
</tr>
</tbody>
</table>
<p>ç°åœ¨æ‚¨å·²ç»å½»åº•äº†è§£ä»€ä¹ˆæ˜¯ Wheels ï¼Œæ˜¯æ—¶å€™è°ˆè°ˆå®ƒä»¬æœ‰ä»€ä¹ˆå¥½å¤„äº†ã€‚</p>
<h3 id="wheels-çš„ä¼˜åŠ¿">Wheels çš„ä¼˜åŠ¿</h3>
<p>è¿™æ˜¯æ¥è‡ª <a href="https://www.pypa.io/en/latest/">Python Packaging Authority</a> (PyPA) çš„ wheels è¯æ˜ï¼š</p>
<blockquote>
<p>å¹¶éæ‰€æœ‰å¼€å‘äººå‘˜éƒ½æœ‰æ­£ç¡®çš„å·¥å…·æˆ–ç»éªŒæ¥æ„å»ºè¿™äº›ç”¨è¿™äº›ç¼–è¯‘è¯­è¨€ç¼–å†™çš„ç»„ä»¶ï¼Œå› æ­¤ Python åˆ›é€ äº† wheelï¼Œè¿™æ˜¯ä¸€ç§æ—¨åœ¨è¿é€å¸¦æœ‰ç¼–è¯‘å·¥ä»¶çš„åº“çš„åŒ…æ ¼å¼ã€‚äº‹å®ä¸Šï¼ŒPython çš„åŒ…å®‰è£…ç¨‹åº <code>pip</code> æ€»æ˜¯æ›´å–œæ¬¢ wheelï¼Œå› ä¸ºå®‰è£…æ€»æ˜¯æ›´å¿«ï¼Œæ‰€ä»¥å³ä½¿æ˜¯çº¯ Python åŒ…ä¹Ÿèƒ½æ›´å¥½åœ°ä½¿ç”¨ wheelã€‚ ï¼ˆ <a href="https://packaging.python.org/overview/#python-binary-distributions">æ¥æº</a>ï¼‰</p>
</blockquote>
<p>æ›´å®Œæ•´çš„æè¿°æ˜¯ï¼Œwheels åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ä½¿ <a href="https://pythonwheels.com/#advantages">Python åŒ…çš„ç”¨æˆ·å’Œç»´æŠ¤è€…</a>éƒ½å—ç›Šï¼š</p>
<ul>
<li>å¯¹äºçº¯ Python åŒ…å’Œ<a href="https://realpython.com/build-python-c-extension-module/">æ‰©å±•æ¨¡å—</a>ï¼ŒWheels çš„å®‰è£…é€Ÿåº¦æ¯”æºä»£ç åˆ†å‘å¿«ã€‚</li>
<li>Wheels æ¯”æºåˆ†å¸ƒå°ã€‚ä¾‹å¦‚ï¼Œ <a href="https://pypi.org/project/six/#files">six</a>    Wheels å¤§çº¦æ˜¯ç›¸åº”æºåˆ†å¸ƒ<a href="https://pypi.org/project/six/#files">å¤§å°çš„ä¸‰åˆ†ä¹‹ä¸€</a>ã€‚å½“æ‚¨è€ƒè™‘åˆ°å•ä¸ªåŒ…çš„ <code>pip install</code> å®é™…ä¸Šå¯èƒ½ä¼šå¼€å§‹ä¸‹è½½ä¾èµ–é¡¹é“¾æ—¶ï¼Œè¿™ç§å·®å¼‚å˜å¾—æ›´åŠ é‡è¦ã€‚</li>
<li>Wheels å°† <code>setup.py</code> æ‰§è¡Œæ’é™¤åœ¨å¤–ã€‚ä»æºåˆ†å‘ç‰ˆå®‰è£…ä¼šè¿è¡Œè¯¥é¡¹ç›®çš„ <code>setup.py</code> ä¸­åŒ…å«çš„ä»»ä½•å†…å®¹ã€‚æ­£å¦‚ <a href="https://www.python.org/dev/peps/pep-0427/#rationale">PEP 427</a> æ‰€æŒ‡å‡ºçš„ï¼Œè¿™ç›¸å½“äºä»»æ„ä»£ç æ‰§è¡Œã€‚ Wheels å®Œå…¨é¿å…äº†è¿™ç§æƒ…å†µã€‚</li>
<li>ç¼–è¯‘å™¨ä¸éœ€è¦å®‰è£…åŒ…å«å·²ç¼–è¯‘æ‰©å±•æ¨¡å—çš„ Wheels ã€‚æ‰©å±•æ¨¡å—åŒ…å«åœ¨é’ˆå¯¹ç‰¹å®šå¹³å°å’Œ Python ç‰ˆæœ¬çš„ wheel ä¸­ã€‚</li>
<li><code>pip</code> è‡ªåŠ¨åœ¨ wheel ä¸­ç”Ÿæˆä¸æ­£ç¡®çš„ Python è§£é‡Šå™¨åŒ¹é…çš„ <code>.pyc</code> æ–‡ä»¶ã€‚</li>
<li>Wheels é€šè¿‡å‡å°‘å®‰è£…è½¯ä»¶åŒ…æ—¶æ¶‰åŠçš„è®¸å¤šå˜é‡æ¥æä¾›ä¸€è‡´æ€§ã€‚</li>
</ul>
<p>æ‚¨å¯ä»¥ä½¿ç”¨ PyPI ä¸Šé¡¹ç›®çš„ä¸‹è½½æ–‡ä»¶é€‰é¡¹å¡æ¥æŸ¥çœ‹å¯ç”¨çš„ä¸åŒå‘è¡Œç‰ˆã€‚ä¾‹å¦‚ï¼Œ<a href="https://pypi.org/project/pandas/#files">pandas</a> åˆ†å‘äº†å„ç§å„æ ·çš„ Wheels ã€‚</p>
<h3 id="å‘Šè¯‰-pip-è¦ä¸‹è½½ä»€ä¹ˆ">å‘Šè¯‰ <code>pip</code> è¦ä¸‹è½½ä»€ä¹ˆ</h3>
<p>å¯ä»¥å¯¹ <code>pip</code> è¿›è¡Œç»†ç²’åº¦æ§åˆ¶å¹¶å‘Šè¯‰å®ƒé¦–é€‰æˆ–é¿å…å“ªç§æ ¼å¼ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ <code>--only-binary</code> å’Œ <code>--no-binary</code> é€‰é¡¹æ¥æ‰§è¡Œæ­¤æ“ä½œã€‚æ‚¨åœ¨å‰é¢æœ‰å…³å®‰è£… <code>cryptography</code> åŒ…çš„éƒ¨åˆ†ä¸­çœ‹åˆ°äº†å®ƒä»¬çš„ä½¿ç”¨ï¼Œä½†å€¼å¾—ä»”ç»†ç ”ç©¶ä¸€ä¸‹å®ƒä»¬çš„ä½œç”¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="nb">pushd</span> <span class="s2">&#34;</span><span class="k">$(</span>mktemp -d<span class="k">)</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">$ python -m pip download --only-binary :all: --dest . --no-cache six
</span></span><span class="line"><span class="cl">Collecting six
</span></span><span class="line"><span class="cl">  Downloading six-1.14.0-py2.py3-none-any.whl <span class="o">(</span><span class="m">10</span> kB<span class="o">)</span>
</span></span><span class="line"><span class="cl">  Saved ./six-1.14.0-py2.py3-none-any.whl
</span></span><span class="line"><span class="cl">Successfully downloaded six
</span></span></code></pre></div><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ‚¨æ›´æ”¹ä¸ºä¸€ä¸ªä¸´æ—¶ç›®å½•ä»¥å­˜å‚¨å¸¦æœ‰ <code>pushd &quot;$(mktemp -d)&quot;</code> çš„ä¸‹è½½ã€‚æ‚¨ä½¿ç”¨ <code>pip download</code> è€Œä¸æ˜¯ <code>pip install</code> ä»¥ä¾¿æ‚¨å¯ä»¥æ£€æŸ¥ç”Ÿæˆçš„ Wheels ï¼Œä½†æ‚¨å¯ä»¥å°† <code>download</code> æ›¿æ¢ä¸º <code>install</code> åŒæ—¶ä¿æŒç›¸åŒçš„é€‰é¡¹é›†ã€‚</p>
<p>æ‚¨ä¸‹è½½å¸¦æœ‰å‡ ä¸ªæ ‡å¿—çš„ <code>six</code> æ¨¡å—ï¼š</p>
<ul>
<li><code>--only-binary :all:</code> å‘Šè¯‰ <code>pip</code> é™åˆ¶è‡ªå·±ä½¿ç”¨ Wheels å¹¶å¿½ç•¥æºä»£ç åˆ†å‘ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªé€‰é¡¹ï¼Œ <code>pip</code> åªä¼šæ›´å–œæ¬¢ Wheels ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ä¼šé€€å›åˆ°æºä»£ç åˆ†å‘ã€‚</li>
<li><code>--dest .</code> å‘Šè¯‰ <code>pip</code> å°† <code>six</code> ä¸‹è½½åˆ°å½“å‰ç›®å½•ã€‚</li>
<li><code>--no-cache</code> å‘Šè¯‰ <code>pip</code> ä¸è¦æŸ¥çœ‹å…¶æœ¬åœ°ä¸‹è½½ç¼“å­˜ã€‚ä½ ä½¿ç”¨è¿™ä¸ªé€‰é¡¹åªæ˜¯ä¸ºäº†è¯´æ˜ä» PyPI çš„å®æ—¶ä¸‹è½½ï¼Œå› ä¸ºä½ å¯èƒ½åœ¨æŸå¤„æœ‰ä¸€ä¸ª <code>six</code> ç¼“å­˜ã€‚</li>
</ul>
<p>æˆ‘ä¹‹å‰æåˆ°è¿‡ï¼Œwheel æ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª <code>.zip</code> å­˜æ¡£ã€‚ä½ å¯ä»¥ä»å­—é¢ä¸Šç†è§£è¿™ä¸ªé™ˆè¿°ï¼Œå¹¶è¿™æ ·å¯¹å¾… Wheels ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³æŸ¥çœ‹ä¸€ä¸ª Wheels çš„å†…å®¹ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>unzip</code> ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ unzip -l six*.whl
</span></span><span class="line"><span class="cl">Archive:  six-1.14.0-py2.py3-none-any.whl
</span></span><span class="line"><span class="cl">  Length      Date    Time    Name
</span></span><span class="line"><span class="cl">---------  ---------- -----   ----
</span></span><span class="line"><span class="cl">    <span class="m">34074</span>  01-15-2020 18:10   six.py
</span></span><span class="line"><span class="cl">     <span class="m">1066</span>  01-15-2020 18:10   six-1.14.0.dist-info/LICENSE
</span></span><span class="line"><span class="cl">     <span class="m">1795</span>  01-15-2020 18:10   six-1.14.0.dist-info/METADATA
</span></span><span class="line"><span class="cl">      <span class="m">110</span>  01-15-2020 18:10   six-1.14.0.dist-info/WHEEL
</span></span><span class="line"><span class="cl">        <span class="m">4</span>  01-15-2020 18:10   six-1.14.0.dist-info/top_level.txt
</span></span><span class="line"><span class="cl">      <span class="m">435</span>  01-15-2020 18:10   six-1.14.0.dist-info/RECORD
</span></span><span class="line"><span class="cl">---------                     -------
</span></span><span class="line"><span class="cl">    <span class="m">37484</span>                     <span class="m">6</span> files
</span></span></code></pre></div><p><code>six</code> æ˜¯ä¸€ä¸ªç‰¹ä¾‹ï¼šå®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªå•ç‹¬çš„ Python æ¨¡å—ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„åŒ…ã€‚ Wheel æ–‡ä»¶ä¹Ÿå¯ä»¥å¤æ‚å¾—å¤šï¼Œç¨åæ‚¨å°†çœ‹åˆ°ã€‚</p>
<p>ä¸ <code>--only-binary</code> ç›¸åï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>--no-binary</code> æ¥åšç›¸åçš„äº‹æƒ…ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python -m pip download --no-binary :all: --dest . --no-cache six
</span></span><span class="line"><span class="cl">Collecting six
</span></span><span class="line"><span class="cl">  Downloading six-1.14.0.tar.gz <span class="o">(</span><span class="m">33</span> kB<span class="o">)</span>
</span></span><span class="line"><span class="cl">  Saved ./six-1.14.0.tar.gz
</span></span><span class="line"><span class="cl">Successfully downloaded six
</span></span><span class="line"><span class="cl">$ <span class="nb">popd</span>
</span></span></code></pre></div><p>æ­¤ç¤ºä¾‹ä¸­çš„å”¯ä¸€æ›´æ”¹æ˜¯åˆ‡æ¢åˆ° <code>--no-binary :all:</code> ã€‚è¿™å‘Šè¯‰ <code>pip</code> å¿½ç•¥ Wheels ï¼Œå³ä½¿å®ƒä»¬å¯ç”¨ï¼Œè€Œæ˜¯ä¸‹è½½æºåˆ†å‘ã€‚</p>
<p><code>--no-binary</code> ä»€ä¹ˆæ—¶å€™æœ‰ç”¨ï¼Ÿä»¥ä¸‹æ˜¯å‡ ä¸ªæ¡ˆä¾‹ï¼š</p>
<ul>
<li>å¯¹åº”çš„ Wheels åäº†ã€‚è¿™æ˜¯å¯¹ Wheels çš„è®½åˆºã€‚å®ƒä»¬æ—¨åœ¨å‡å°‘æ•…éšœçš„å‘ç”Ÿï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œ Wheels å¯èƒ½ä¼šé…ç½®é”™è¯¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ºè‡ªå·±ä¸‹è½½å’Œæ„å»ºæºä»£ç åˆ†å‘å¯èƒ½æ˜¯ä¸€ä¸ªå¯è¡Œçš„é€‰æ‹©ã€‚</li>
<li>æ‚¨æƒ³è¦å¯¹é¡¹ç›®åº”ç”¨ä¸€ä¸ªå°çš„æ›´æ”¹æˆ–<a href="https://en.wikipedia.org/wiki/Patch_%28Unix%29">è¡¥ä¸æ–‡ä»¶</a>ï¼Œç„¶åå®‰è£…å®ƒã€‚è¿™æ˜¯ä»<a href="https://realpython.com/python-git-github-intro/#version-control">ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ</a> URL å…‹éš†é¡¹ç›®çš„æ›¿ä»£æ–¹æ³•ã€‚</li>
</ul>
<p>æ‚¨è¿˜å¯ä»¥å°†ä¸Šè¿°æ ‡å¿—ä¸ <code>pip install</code> ä¸€èµ·ä½¿ç”¨ã€‚æ­¤å¤–ï¼Œä¸ <code>:all:</code> ä¸åŒï¼Œ <code>--only-binary</code> è§„åˆ™ä¸ä»…é€‚ç”¨äºæ‚¨æ­£åœ¨å®‰è£…çš„åŒ…ï¼Œè¿˜é€‚ç”¨äºå®ƒçš„æ‰€æœ‰ä¾èµ–é¡¹ï¼Œæ‚¨å¯ä»¥ä¼ é€’ç‰¹å®šåŒ…çš„åˆ—è¡¨ <code>--only-binary</code> å’Œ <code>--no-binary</code> æ¥åº”ç”¨è¯¥è§„åˆ™è§„åˆ™åˆ°ã€‚</p>
<p>ä¸‹é¢æ˜¯å‡ ä¸ªå®‰è£…URLåº“ <a href="https://github.com/aio-libs/yarl/">yarl</a> çš„ä¾‹å­ã€‚å®ƒåŒ…å« Cython ä»£ç å¹¶ä¾èµ–äº <a href="https://github.com/aio-libs/multidict">multidict</a> ï¼Œå…¶ä¸­åŒ…å«çº¯ C ä»£ç ã€‚æœ‰å‡ ä¸ªé€‰é¡¹å¯ä»¥ä¸¥æ ¼ä½¿ç”¨æˆ–ä¸¥æ ¼å¿½ç•¥ <code>yarl</code> åŠå…¶ä¾èµ–é¡¹çš„ Wheels ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="c1"># Install `yarl` and use only wheels for yarl and all dependencies</span>
</span></span><span class="line"><span class="cl">$ python -m pip install --only-binary :all: yarl
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ <span class="c1"># Install `yarl` and use wheels only for the `multidict` dependency</span>
</span></span><span class="line"><span class="cl">$ python -m pip install --only-binary multidict yarl
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ <span class="c1"># Install `yarl` and don&#39;t use wheels for yarl or any dependencies</span>
</span></span><span class="line"><span class="cl">$ python -m pip install --no-binary :all: yarl
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ <span class="c1"># Install `yarl` and don&#39;t use wheels for the `multidict` dependency</span>
</span></span><span class="line"><span class="cl">$ python -m pip install --no-binary multidict yarl
</span></span></code></pre></div><p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæ‚¨å¤§è‡´äº†è§£äº†å¦‚ä½•å¾®è°ƒ <code>pip install</code> å°†ä½¿ç”¨çš„åˆ†å‘ç±»å‹ã€‚è™½ç„¶å¸¸è§„çš„ <code>pip install</code> åº”è¯¥æ²¡æœ‰ä»»ä½•é€‰é¡¹ï¼Œä½†äº†è§£è¿™äº›ç”¨äºç‰¹æ®Šæƒ…å†µçš„é€‰é¡¹ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚</p>
<h3 id="wheel-manylinux-æ ‡ç­¾">Wheel manylinux æ ‡ç­¾</h3>
<p>Linux æœ‰è®¸å¤šå˜ä½“å’Œé£æ ¼ï¼Œä¾‹å¦‚ Debianã€CentOSã€Fedora å’Œ Pacmanã€‚å…¶ä¸­æ¯ä¸€ä¸ªéƒ½å¯èƒ½åœ¨å…±äº«åº“ï¼ˆä¾‹å¦‚ <code>libncurses</code> ï¼‰å’Œæ ¸å¿ƒ C åº“ï¼ˆä¾‹å¦‚ <code>glibc</code> ï¼‰ä¸­ä½¿ç”¨ç»†å¾®çš„å˜åŒ–ã€‚</p>
<p>å¦‚æœæ‚¨æ­£åœ¨ç¼–å†™ C/C++ æ‰©å±•ï¼Œé‚£ä¹ˆè¿™å¯èƒ½ä¼šäº§ç”Ÿé—®é¢˜ã€‚ç”¨ C ç¼–å†™å¹¶åœ¨ Ubuntu Linux ä¸Šç¼–è¯‘çš„æºæ–‡ä»¶ä¸èƒ½ä¿è¯åœ¨ CentOS æœºå™¨æˆ– Arch Linux å‘è¡Œç‰ˆä¸Šå¯æ‰§è¡Œã€‚</p>
<p>æ‚¨æ˜¯å¦éœ€è¦ä¸ºæ¯ä¸ª Linux å˜ä½“æ„å»ºä¸€ä¸ªå•ç‹¬çš„ Wheels ï¼Ÿ</p>
<p>å¹¸è¿çš„æ˜¯ï¼Œç­”æ¡ˆæ˜¯å¦å®šçš„ï¼Œè¿™è¦å½’åŠŸäºä¸€ç»„ä¸“é—¨è®¾è®¡çš„æ ‡ç­¾ï¼Œç§°ä¸º <code>manylinux</code> å¹³å°æ ‡ç­¾ç³»åˆ—ã€‚ç›®å‰æœ‰ä»¥ä¸‹ä¸‰ç§å˜ä½“ï¼š</p>
<ol>
<li><code>manylinux1</code> æ˜¯ <a href="https://www.python.org/dev/peps/pep-0513/">PEP 513</a> ä¸­æŒ‡å®šçš„åŸå§‹æ ¼å¼ã€‚</li>
<li><code>manylinux2010</code> æ˜¯ <a href="https://www.python.org/dev/peps/pep-0571/">PEP 571</a> ä¸­æŒ‡å®šçš„æ›´æ–°ï¼Œå®ƒå‡çº§åˆ° CentOS 6 ä½œä¸º Docker é•œåƒæ‰€åŸºäºçš„åº•å±‚æ“ä½œç³»ç»Ÿã€‚ç†ç”±æ˜¯ CentOS 5.11ï¼Œå³ <code>manylinux1</code> ä¸­å…è®¸çš„åº“åˆ—è¡¨çš„æ¥æºï¼Œäº 2017 å¹´ 3 æœˆè¾¾åˆ° EOL å¹¶åœæ­¢æ¥æ”¶å®‰å…¨è¡¥ä¸å’Œé”™è¯¯ä¿®å¤ã€‚</li>
<li><code>manylinux2014</code> æ˜¯ <a href="https://www.python.org/dev/peps/pep-0599/">PEP 599</a> ä¸­æŒ‡å®šçš„å‡çº§åˆ° CentOS 7 çš„æ›´æ–°ï¼Œå› ä¸º CentOS 6 è®¡åˆ’äº 2020 å¹´ 11 æœˆè¾¾åˆ° EOLã€‚</li>
</ol>
<p>æ‚¨å¯ä»¥åœ¨ pandas é¡¹ç›®ä¸­æ‰¾åˆ° <code>manylinux</code> åˆ†å¸ƒçš„ç¤ºä¾‹ã€‚ä»¥ä¸‹æ˜¯ PyPI çš„å¯ç”¨ pandas ä¸‹è½½åˆ—è¡¨ä¸­çš„ä¸¤ä¸ªï¼ˆæœ€å¤šçš„ï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">pandas-1.0.3-cp37-cp37m-manylinux1_x86_64.whl
</span></span><span class="line"><span class="cl">pandas-1.0.3-cp37-cp37m-manylinux1_i686.whl
</span></span></code></pre></div><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œpandas ä¸ºæ”¯æŒ x86-64 å’Œ <a href="https://en.wikipedia.org/wiki/P6_(microarchitecture)">i686</a> æ¶æ„çš„ CPython 3.7 æ„å»ºäº† <code>manylinux1</code> wheelsã€‚</p>
<p><code>manylinux</code> çš„æ ¸å¿ƒæ˜¯åŸºäºç‰¹å®šç‰ˆæœ¬çš„ CentOS æ“ä½œç³»ç»Ÿæ„å»ºçš„ Docker é•œåƒã€‚å®ƒæ†ç»‘äº†ä¸€ä¸ªç¼–è¯‘å™¨å¥—ä»¶ã€å¤šä¸ªç‰ˆæœ¬çš„ Python å’Œ <code>pip</code> ï¼Œä»¥åŠä¸€ç»„å…è®¸çš„å…±äº«åº“ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šæœ¯è¯­ allowed è¡¨ç¤º<a href="https://www.python.org/dev/peps/pep-0513/#rationale">é»˜è®¤æƒ…å†µä¸‹å‡å®šå­˜åœ¨</a>äºå‡ ä¹æ‰€æœ‰ Linux ç³»ç»Ÿä¸Šçš„ä½çº§åº“ã€‚è¿™ä¸ªæƒ³æ³•æ˜¯ï¼Œä¾èµ–é¡¹åº”è¯¥å­˜åœ¨äºåŸºæœ¬æ“ä½œç³»ç»Ÿä¸Šï¼Œè€Œä¸éœ€è¦é¢å¤–å®‰è£…ã€‚</p>
</blockquote>
<p>æˆªè‡³ 2020 å¹´å¹´ä¸­ï¼Œ <code>manylinux1</code> ä»ç„¶æ˜¯ä¸»è¦çš„ <code>manylinux</code> æ ‡ç­¾ã€‚åŸå› ä¹‹ä¸€å¯èƒ½åªæ˜¯ä¹ æƒ¯ã€‚å¦ä¸€ä¸ªå¯èƒ½æ˜¯å®¢æˆ·ç«¯ï¼ˆç”¨æˆ·ï¼‰ç«¯å¯¹ <code>manylinux2010</code> åŠæ›´é«˜ç‰ˆæœ¬çš„æ”¯æŒä»…é™äºæ›´æ–°ç‰ˆæœ¬çš„ <code>pip</code> ï¼š</p>
<table>
<thead>
<tr>
<th>Tag</th>
<th>Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>manylinux1</code></td>
<td><code>pip</code> 8.1.0 æˆ–æ›´é«˜ç‰ˆæœ¬</td>
</tr>
<tr>
<td><code>manylinux2010</code></td>
<td><code>pip</code> 19.0 æˆ–æ›´é«˜ç‰ˆæœ¬</td>
</tr>
<tr>
<td><code>manylinux2014</code></td>
<td><code>pip</code> 19.3 æˆ–æ›´é«˜ç‰ˆæœ¬</td>
</tr>
</tbody>
</table>
<p>æ¢å¥è¯è¯´ï¼Œå¦‚æœæ‚¨æ˜¯æ„å»º <code>manylinux2010</code> wheels çš„åŒ…å¼€å‘äººå‘˜ï¼Œé‚£ä¹ˆä½¿ç”¨æ‚¨çš„åŒ…çš„äººå°†éœ€è¦ <code>pip</code> 19.0ï¼ˆ2019 å¹´ 1 æœˆå‘å¸ƒï¼‰æˆ–æ›´é«˜ç‰ˆæœ¬æ‰èƒ½è®© <code>pip</code> ä» PyPI æ‰¾åˆ°å¹¶å®‰è£… <code>manylinux2010</code> wheels .</p>
<p>å¹¸è¿çš„æ˜¯ï¼Œè™šæ‹Ÿç¯å¢ƒå˜å¾—è¶Šæ¥è¶Šæ™®éï¼Œè¿™æ„å‘³ç€å¼€å‘äººå‘˜å¯ä»¥åœ¨ä¸æ¥è§¦ç³»ç»Ÿ <code>pip</code> çš„æƒ…å†µä¸‹æ›´æ–°è™šæ‹Ÿç¯å¢ƒçš„ <code>pip</code> ã€‚ç„¶è€Œï¼Œæƒ…å†µå¹¶éæ€»æ˜¯å¦‚æ­¤ï¼Œä¸€äº› Linux å‘è¡Œç‰ˆä»ç„¶é™„å¸¦ <code>pip</code> çš„è¿‡æ—¶ç‰ˆæœ¬ã€‚</p>
<p>è¿™å°±æ˜¯è¯´ï¼Œå¦‚æœæ‚¨è¦åœ¨ Linux ä¸»æœºä¸Šå®‰è£… Python åŒ…ï¼Œé‚£ä¹ˆå¦‚æœåŒ…ç»´æŠ¤è€…ä¸é—ä½™åŠ›åœ°åˆ›å»º <code>manylinux</code>  Wheels ï¼Œæ‚¨å°±è®¤ä¸ºè‡ªå·±å¾ˆå¹¸è¿ã€‚è¿™å‡ ä¹å¯ä»¥ä¿è¯æ— è®ºæ‚¨çš„ç‰¹å®š Linux å˜ä½“æˆ–ç‰ˆæœ¬å¦‚ä½•ï¼Œéƒ½å¯ä»¥è½»æ¾å®‰è£…è½¯ä»¶åŒ…ã€‚</p>
<blockquote>
<p>è­¦å‘Šï¼šè¯·æ³¨æ„ <a href="https://pythonspeed.com/articles/alpine-docker-python/">PyPI wheels ä¸èƒ½åœ¨ Alpine Linux</a>ï¼ˆæˆ– <a href="https://hub.docker.com/_/busybox/">BusyBox</a>ï¼‰ä¸Šè¿è¡Œã€‚è¿™æ˜¯å› ä¸º Alpine ä½¿ç”¨ <a href="https://wiki.musl-libc.org/">musl</a> ä»£æ›¿æ ‡å‡†çš„ <a href="https://www.gnu.org/software/libc/libc.html">glibc</a> ã€‚ <code>musl libc</code> åº“è‡ªç§°æ˜¯â€œä¸€ä¸ªæ–°çš„ <code>libc</code> ï¼ŒåŠ›æ±‚å¿«é€Ÿã€ç®€å•ã€è½»é‡çº§ã€å…è´¹å’Œæ­£ç¡®â€ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¯´åˆ° Wheels ï¼Œ <code>glibc</code> ä¸æ˜¯ã€‚</p>
</blockquote>
<h3 id="å¹³å°-wheels-çš„å®‰å…¨æ³¨æ„äº‹é¡¹">å¹³å° Wheels çš„å®‰å…¨æ³¨æ„äº‹é¡¹</h3>
<p>ä»ç”¨æˆ·å®‰å…¨çš„è§’åº¦æ¥çœ‹ï¼Œwheels çš„ä¸€ä¸ªå€¼å¾—è€ƒè™‘çš„ç‰¹æ€§æ˜¯ wheels <a href="https://github.com/asottile/no-manylinux#what-why">å¯èƒ½ä¼šå—åˆ°ç‰ˆæœ¬è…çƒ‚</a>çš„å½±å“ï¼Œå› ä¸ºå®ƒä»¬æ†ç»‘äº†äºŒè¿›åˆ¶ä¾èµ–é¡¹ï¼Œè€Œä¸æ˜¯å…è®¸ç³»ç»ŸåŒ…ç®¡ç†å™¨æ›´æ–°è¯¥ä¾èµ–é¡¹ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ª wheel åˆå¹¶äº† <code>libfortran</code> å…±äº«åº“ï¼Œé‚£ä¹ˆå³ä½¿æ‚¨ä½¿ç”¨åŒ…ç®¡ç†å™¨ï¼ˆå¦‚ @ 3#ã€ <code>yum</code> æˆ– <code>brew</code> ã€‚</p>
<p>å¦‚æœæ‚¨åœ¨å®‰å…¨é˜²èŒƒæªæ–½å¾—åˆ°åŠ å¼ºçš„ç¯å¢ƒä¸­è¿›è¡Œå¼€å‘ï¼Œåˆ™éœ€è¦æ³¨æ„æŸäº›å¹³å°  Wheels çš„è¿™ä¸€ç‰¹æ€§ã€‚</p>
<h2 id="å¬é›†æ‰€æœ‰å¼€å‘äººå‘˜æ„å»ºæ‚¨çš„-wheels">å¬é›†æ‰€æœ‰å¼€å‘äººå‘˜ï¼šæ„å»ºæ‚¨çš„ Wheels</h2>
<p>æœ¬æ•™ç¨‹çš„æ ‡é¢˜æ˜¯â€œä½ ä¸ºä»€ä¹ˆè¦å…³å¿ƒï¼Ÿâ€ä½œä¸ºä¸€åå¼€å‘äººå‘˜ï¼Œå¦‚æœæ‚¨æ‰“ç®—å‘ç¤¾åŒºåˆ†å‘ Python åŒ…ï¼Œé‚£ä¹ˆæ‚¨åº”è¯¥éå¸¸å…³å¿ƒä¸ºæ‚¨çš„é¡¹ç›®åˆ†å‘ Wheels ï¼Œå› ä¸ºå®ƒä»¬ä½¿æœ€ç»ˆç”¨æˆ·çš„å®‰è£…è¿‡ç¨‹æ›´ç®€æ´ã€æ›´ç®€å•ã€‚</p>
<p>æ‚¨å¯ä»¥ä½¿ç”¨å…¼å®¹çš„ Wheels æ”¯æŒçš„ç›®æ ‡å¹³å°è¶Šå¤šï¼Œæ‚¨çœ‹åˆ°çš„æ ‡é¢˜ä¸ºâ€œå®‰è£…åœ¨ XYZ å¹³å°ä¸ŠæŸåâ€ä¹‹ç±»çš„ GitHub é—®é¢˜å°±è¶Šå°‘ã€‚ä¸ºæ‚¨çš„ Python åŒ…åˆ†å‘ wheel å®¢è§‚ä¸Šé™ä½äº†åŒ…çš„ç”¨æˆ·åœ¨å®‰è£…è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜çš„å¯èƒ½æ€§ã€‚</p>
<p>è¦åœ¨æœ¬åœ°æ„å»º Wheels ï¼Œæ‚¨éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯å®‰è£… <code>wheel</code> ã€‚ç¡®ä¿ <code>setuptools</code> ä¹Ÿæ˜¯æœ€æ–°çš„ä¹Ÿæ²¡ä»€ä¹ˆåå¤„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python -m pip install -U wheel setuptools
</span></span></code></pre></div><p>æ¥ä¸‹æ¥çš„å‡ èŠ‚å°†å¼•å¯¼æ‚¨å®Œæˆä¸ºå„ç§ä¸åŒåœºæ™¯æ„å»º Wheels çš„è¿‡ç¨‹ã€‚</p>
<h3 id="ä¸åŒç±»å‹çš„-wheels">ä¸åŒç±»å‹çš„ Wheels</h3>
<p>æ­£å¦‚æœ¬æ•™ç¨‹ä¸­æåˆ°çš„ï¼Œ Wheels æœ‰å‡ ç§ä¸åŒçš„å˜ä½“ï¼Œ Wheels çš„ç±»å‹åæ˜ åœ¨å®ƒçš„æ–‡ä»¶åä¸­ï¼š</p>
<ul>
<li>ä¸‡å‘  Wheels åŒ…å« <code>py2.py3-none-any.whl</code> ã€‚å®ƒåœ¨ä»»ä½•æ“ä½œç³»ç»Ÿå’Œå¹³å°ä¸Šéƒ½æ”¯æŒ Python 2 å’Œ Python 3ã€‚ Python Wheels ç½‘ç«™ä¸Šåˆ—å‡ºçš„å¤§å¤šæ•° Wheels éƒ½æ˜¯é€šç”¨ Wheels ã€‚</li>
<li>çº¯ Python   Wheels åŒ…å« <code>py3-none-any.whl</code> æˆ– <code>py2.none-any.whl</code> ã€‚å®ƒæ”¯æŒ Python 3 æˆ– Python 2ï¼Œä½†ä¸æ”¯æŒä¸¤è€…ã€‚å®ƒåœ¨å…¶ä»–æ–¹é¢ä¸ä¸‡å‘  Wheels ç›¸åŒï¼Œä½†å®ƒä¼šæ ‡æœ‰ <code>py2</code> æˆ– <code>py3</code> è€Œä¸æ˜¯ <code>py2.py3</code> æ ‡ç­¾ã€‚</li>
<li>å¹³å°  Wheels æ”¯æŒç‰¹å®šçš„ Python ç‰ˆæœ¬å’Œå¹³å°ã€‚å®ƒåŒ…å«æŒ‡ç¤ºç‰¹å®š Python ç‰ˆæœ¬ã€ABIã€æ“ä½œç³»ç»Ÿæˆ–ä½“ç³»ç»“æ„çš„æ®µã€‚</li>
</ul>
<p>wheel ç±»å‹ä¹‹é—´çš„å·®å¼‚å–å†³äºå®ƒä»¬æ”¯æŒçš„ Python ç‰ˆæœ¬ä»¥åŠå®ƒä»¬æ˜¯å¦é’ˆå¯¹ç‰¹å®šå¹³å°ã€‚ä»¥ä¸‹æ˜¯ Wheels å˜ä½“ä¹‹é—´å·®å¼‚çš„ç®€è¦æ€»ç»“ï¼š</p>
<table>
<thead>
<tr>
<th>Wheel Type</th>
<th>æ”¯æŒ Python 2 å’Œ 3</th>
<th>æ”¯æŒæ¯ä¸ª ABIã€æ“ä½œç³»ç»Ÿå’Œå¹³å°</th>
</tr>
</thead>
<tbody>
<tr>
<td>Universal</td>
<td>âœ“</td>
<td>âœ“</td>
</tr>
<tr>
<td>Pure-Python</td>
<td></td>
<td>âœ“</td>
</tr>
<tr>
<td>Platform</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>æ­£å¦‚æ‚¨æ¥ä¸‹æ¥å°†çœ‹åˆ°çš„ï¼Œæ‚¨å¯ä»¥é€šè¿‡ç›¸å¯¹è¾ƒå°‘çš„è®¾ç½®æ„å»ºé€šç”¨ Wheels å’Œçº¯ Python  Wheels ï¼Œä½†å¹³å° Wheels å¯èƒ½éœ€è¦ä¸€äº›é¢å¤–çš„æ­¥éª¤ã€‚</p>
<h3 id="æ„å»ºä¸€ä¸ªçº¯-python--wheels">æ„å»ºä¸€ä¸ªçº¯ Python  Wheels</h3>
<p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>setuptools</code> ä¸ºä»»ä½•é¡¹ç›®æ„å»ºçº¯ Python   Wheels æˆ–é€šç”¨  Wheels ï¼Œåªéœ€ä¸€ä¸ªå‘½ä»¤ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python setup.py sdist bdist_wheel
</span></span></code></pre></div><p>è¿™å°†åˆ›å»ºä¸€ä¸ªæºä»£ç åˆ†å‘ ( <code>sdist</code> ) å’Œä¸€ä¸ª Wheels  ( <code>bdist_wheel</code> )ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸¤è€…éƒ½ä¼šæ”¾åœ¨å½“å‰ç›®å½•ä¸‹çš„ <code>dist/</code> ä¸­ã€‚è¦äº²çœ¼çœ‹çœ‹ï¼Œæ‚¨å¯ä»¥ä¸º <a href="https://github.com/jakubroztocil/httpie">HTTPie</a> æ„å»ºä¸€ä¸ª Wheels ï¼Œä¸€ä¸ªç”¨ Python ç¼–å†™çš„å‘½ä»¤è¡Œ HTTP å®¢æˆ·ç«¯ï¼Œä»¥åŠä¸€ä¸ª <code>sdist</code> ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸º HTTPie åŒ…æ„å»ºä¸¤ç§ç±»å‹çš„å‘è¡Œç‰ˆçš„ç»“æœï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ git clone -q git@github.com:jakubroztocil/httpie.git
</span></span><span class="line"><span class="cl">$ <span class="nb">cd</span> httpie
</span></span><span class="line"><span class="cl">$ python setup.py -q sdist bdist_wheel
</span></span><span class="line"><span class="cl">$ ls -1 dist/
</span></span><span class="line"><span class="cl">httpie-2.2.0.dev0-py3-none-any.whl
</span></span><span class="line"><span class="cl">httpie-2.2.0.dev0.tar.gz
</span></span></code></pre></div><p>ä»…æ­¤è€Œå·²ã€‚æ‚¨å…‹éš†è¯¥é¡¹ç›®ï¼Œç§»è‡³å…¶æ ¹ç›®å½•ï¼Œç„¶åè°ƒç”¨ <code>python setup.py sdist bdist_wheel</code> ã€‚æ‚¨å¯ä»¥çœ‹åˆ° <code>dist/</code> åŒ…å«ä¸€ä¸ª Wheels å’Œä¸€ä¸ªæºä»£ç åˆ†å‘ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œç”Ÿæˆçš„åˆ†å¸ƒæ”¾åœ¨ <code>dist/</code> ä¸­ï¼Œä½†æ‚¨å¯ä»¥ä½¿ç”¨ <code>-d</code> / <code>--dist-dir</code> é€‰é¡¹æ›´æ”¹å®ƒã€‚æ‚¨å¯ä»¥å°†å®ƒä»¬æ”¾åœ¨ä¸€ä¸ªä¸´æ—¶ç›®å½•ä¸­ï¼Œè€Œä¸æ˜¯ç”¨äºæ„å»ºéš”ç¦»ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="nv">tempdir</span><span class="o">=</span><span class="s2">&#34;</span><span class="k">$(</span>mktemp -d<span class="k">)</span><span class="s2">&#34;</span>  <span class="c1"># Create a temporary directory</span>
</span></span><span class="line"><span class="cl">$ file <span class="s2">&#34;</span><span class="nv">$tempdir</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">/var/folders/jc/8_kd8uusys7ak09_lpmn30rw0000gk/T/tmp.GIXy7XKV: directory
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ python setup.py sdist -d <span class="s2">&#34;</span><span class="nv">$tempdir</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">$ python setup.py bdist_wheel --dist-dir <span class="s2">&#34;</span><span class="nv">$tempdir</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">$ ls -1 <span class="s2">&#34;</span><span class="nv">$tempdir</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">httpie-2.2.0.dev0-py3-none-any.whl
</span></span><span class="line"><span class="cl">httpie-2.2.0.dev0.tar.gz
</span></span></code></pre></div><p>æ‚¨å¯ä»¥å°† <code>sdist</code> å’Œ <code>bdist_wheel</code> æ­¥éª¤åˆäºŒä¸ºä¸€ï¼Œå› ä¸º <code>setup.py</code> å¯ä»¥é‡‡ç”¨å¤šä¸ªå­å‘½ä»¤ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python setup.py sdist -d <span class="s2">&#34;</span><span class="nv">$tempdir</span><span class="s2">&#34;</span> bdist_wheel -d <span class="s2">&#34;</span><span class="nv">$tempdir</span><span class="s2">&#34;</span>
</span></span></code></pre></div><p>å¦‚æ­¤å¤„æ‰€ç¤ºï¼Œæ‚¨éœ€è¦å°† <code>-d</code> ç­‰é€‰é¡¹ä¼ é€’ç»™æ¯ä¸ªå­å‘½ä»¤ã€‚</p>
<h3 id="æŒ‡å®šé€šç”¨-wheel">æŒ‡å®šé€šç”¨ Wheel</h3>
<p>é€šç”¨ Wheels æ˜¯ç”¨äºåŒæ—¶æ”¯æŒ Python 2 å’Œ 3 çš„çº¯ Python é¡¹ç›®çš„ Wheels ã€‚æœ‰å¤šç§æ–¹æ³•å¯ä»¥å‘Šè¯‰ <code>setuptools</code> å’Œ <code>distutils</code>  Wheels åº”è¯¥æ˜¯é€šç”¨çš„ã€‚</p>
<p>é€‰é¡¹ 1 æ˜¯åœ¨é¡¹ç›®çš„ <a href="https://docs.python.org/3/distutils/configfile.html">setup.cfg</a> æ–‡ä»¶ä¸­æŒ‡å®šé€‰é¡¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-toml" data-lang="toml"><span class="line"><span class="cl"><span class="p">[</span><span class="nx">bdist_wheel</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">universal</span> <span class="p">=</span> <span class="mi">1</span>
</span></span></code></pre></div><p>é€‰é¡¹ 2 æ˜¯åœ¨å‘½ä»¤è¡Œä¼ é€’æ°å½“å‘½åçš„ <code>--universal</code> æ ‡å¿—ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python setup.py bdist_wheel --universal
</span></span></code></pre></div><p>é€‰é¡¹ 3 æ˜¯ä½¿ç”¨å…¶ <code>options</code> å‚æ•°å‘Šè¯‰ <code>setup()</code> æœ¬èº«æœ‰å…³è¯¥æ ‡å¿—çš„ä¿¡æ¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># setup.py</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">setup</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ....</span>
</span></span><span class="line"><span class="cl">    <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;bdist_wheel&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;universal&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}}</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ....</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></div><p>è™½ç„¶è¿™ä¸‰ä¸ªé€‰é¡¹ä¸­çš„ä»»ä½•ä¸€ä¸ªéƒ½åº”è¯¥æœ‰æ•ˆï¼Œä½†å‰ä¸¤ä¸ªé€‰é¡¹æœ€å¸¸ç”¨ã€‚æ‚¨å¯ä»¥åœ¨ <a href="https://github.com/chardet/chardet/blob/master/setup.cfg">chardet è®¾ç½®é…ç½®</a>ä¸­çœ‹åˆ°è¿™æ ·çš„ç¤ºä¾‹ã€‚ä¹‹åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>bdist_wheel</code> å‘½ä»¤ï¼Œå¦‚å‰æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python setup.py sdist bdist_wheel
</span></span></code></pre></div><p>æ— è®ºæ‚¨é€‰æ‹©å“ªä¸ªé€‰é¡¹ï¼Œç”Ÿæˆçš„ Wheels éƒ½æ˜¯ç­‰æ•ˆçš„ã€‚é€‰æ‹©åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºå¼€å‘äººå‘˜çš„åå¥½ä»¥åŠæœ€é€‚åˆæ‚¨çš„å·¥ä½œæµç¨‹ã€‚</p>
<h3 id="æ„å»ºå¹³å°-wheels-macos-å’Œ-windows">æ„å»ºå¹³å° Wheels ï¼ˆmacOS å’Œ Windowsï¼‰</h3>
<p>äºŒè¿›åˆ¶å‘è¡Œç‰ˆæ˜¯åŒ…å«å·²ç¼–è¯‘æ‰©å±•çš„æ„å»ºå‘è¡Œç‰ˆçš„å­é›†ã€‚æ‰©å±•æ˜¯é Python ä¾èµ–é¡¹æˆ– Python åŒ…çš„ç»„ä»¶ã€‚</p>
<p>é€šå¸¸ï¼Œè¿™æ„å‘³ç€æ‚¨çš„åŒ…åŒ…å«æ‰©å±•æ¨¡å—æˆ–ä¾èµ–äºç”¨é™æ€ç±»å‹è¯­è¨€ï¼ˆä¾‹å¦‚ Cã€C++ã€Fortranï¼Œç”šè‡³ Rust æˆ– Goï¼‰ç¼–å†™çš„åº“ã€‚å¹³å° Wheels çš„å­˜åœ¨ä¸»è¦æ˜¯å› ä¸ºå®ƒä»¬åŒ…å«æˆ–ä¾èµ–äºæ‰©å±•æ¨¡å—ã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œæ˜¯æ—¶å€™æ„å»ºå¹³å° Wheels äº†ï¼</p>
<p>æ ¹æ®æ‚¨ç°æœ‰çš„å¼€å‘ç¯å¢ƒï¼Œæ‚¨å¯èƒ½éœ€è¦å®Œæˆä¸€ä¸ªæˆ–ä¸¤ä¸ªé¢å¤–çš„å…ˆå†³æ¡ä»¶æ­¥éª¤æ¥æ„å»ºå¹³å° Wheels ã€‚ä¸‹é¢çš„æ­¥éª¤å°†å¸®åŠ©æ‚¨è®¾ç½®æ„å»º C å’Œ C++ æ‰©å±•æ¨¡å—ï¼Œè¿™æ˜¯è¿„ä»Šä¸ºæ­¢æœ€å¸¸è§çš„ç±»å‹ã€‚</p>
<p>åœ¨ macOS ä¸Šï¼Œæ‚¨éœ€è¦é€šè¿‡ <a href="https://www.unix.com/man-page/OSX/1/xcode-select/">xcode</a> è·å¾—çš„å‘½ä»¤è¡Œå¼€å‘äººå‘˜å·¥å…·ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ xcode-select --install
</span></span></code></pre></div><p>åœ¨ Windows ä¸Šï¼Œæ‚¨éœ€è¦å®‰è£… <a href="https://docs.microsoft.com/en-us/cpp/?view=vs-2019">Microsoft Visual C++</a>ï¼š</p>
<ul>
<li>åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ Visual Studio ä¸‹è½½é¡µé¢ã€‚</li>
<li>é€‰æ‹© Visual Studio å·¥å…· â†’ Visual Studio æ„å»ºå·¥å…· â†’ ä¸‹è½½ã€‚</li>
<li>è¿è¡Œç”Ÿæˆçš„ <code>.exe</code> å®‰è£…ç¨‹åºã€‚</li>
<li>åœ¨å®‰è£…ç¨‹åºä¸­ï¼Œé€‰æ‹© C++ Build Tools â†’ Installã€‚</li>
<li>é‡æ–°å¯åŠ¨æœºå™¨ã€‚</li>
</ul>
<p>åœ¨ Linux ä¸Šï¼Œæ‚¨éœ€è¦ä¸€ä¸ªç¼–è¯‘å™¨ï¼Œä¾‹å¦‚ <code>gcc</code> æˆ– <code>g++</code> / <code>c++</code> ã€‚</p>
<p>æœ‰äº†è¿™äº›ï¼Œæ‚¨å°±å¯ä»¥ä¸º UltraJSON ( <code>ujson</code> ) æ„å»ºä¸€ä¸ªå¹³å°  Wheels ï¼ŒUltraJSON æ˜¯ä¸€ä¸ªç”¨çº¯ C è¯­è¨€ç¼–å†™å¹¶å¸¦æœ‰ Python 3 ç»‘å®šçš„ <a href="https://realpython.com/python-json/">JSON</a> ç¼–ç å™¨å’Œè§£ç å™¨ã€‚ä½¿ç”¨ <code>ujson</code> æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç©å…·ç¤ºä¾‹ï¼Œå› ä¸ºå®ƒæ¶µç›–äº†å‡ ä¸ªåŸºç¡€ï¼š</p>
<ul>
<li>å®ƒåŒ…å«ä¸€ä¸ªæ‰©å±•æ¨¡å—ï¼Œ <a href="https://github.com/ultrajson/ultrajson/blob/master/python/ujson.c">ujson</a> ã€‚</li>
<li>å®ƒä¾èµ–äº Python å¼€å‘æ ‡å¤´è¿›è¡Œç¼–è¯‘ ( <code>#include &lt;Python.h&gt;</code> )ï¼Œä½†å¹¶ä¸è¿‡åˆ†å¤æ‚ã€‚ <code>ujson</code> æ—¨åœ¨åšä¸€ä»¶äº‹å¹¶ä¸”åšå¥½ï¼Œå°±æ˜¯è¯»å†™JSONï¼</li>
</ul>
<p>æ‚¨å¯ä»¥ä» GitHub å…‹éš†è¯¥é¡¹ç›®ï¼Œå¯¼èˆªåˆ°å…¶ç›®å½•å¹¶æ„å»ºå®ƒï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ git clone -q --branch 2.0.3 git@github.com:ultrajson/ultrajson.git
</span></span><span class="line"><span class="cl">$ <span class="nb">cd</span> ultrajson
</span></span><span class="line"><span class="cl">$ python setup.py bdist_wheel
</span></span></code></pre></div><p>æ‚¨åº”è¯¥ä¼šçœ‹åˆ°å¤§é‡è¾“å‡ºã€‚è¿™æ˜¯ macOS ä¸Šçš„ç²¾ç®€ç‰ˆï¼Œå…¶ä¸­ä½¿ç”¨äº† Clang ç¼–è¯‘å™¨é©±åŠ¨ç¨‹åºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">clang -Wno-unused-result -Wsign-compare -Wunreachable-code -DNDEBUG -g ...
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">creating <span class="s1">&#39;dist/ujson-2.0.3-cp38-cp38-macosx_10_15_x86_64.whl&#39;</span>
</span></span><span class="line"><span class="cl">adding <span class="s1">&#39;ujson.cpython-38-darwin.so&#39;</span>
</span></span></code></pre></div><p>ä»¥ <code>clang</code> å¼€å¤´çš„è¡Œæ˜¾ç¤ºäº†å¯¹ç¼–è¯‘å™¨çš„å®é™…è°ƒç”¨ï¼Œå…¶ä¸­åŒ…å«å¤§é‡ç¼–è¯‘æ ‡å¿—ã€‚æ‚¨å¯èƒ½è¿˜ä¼šçœ‹åˆ°è¯¸å¦‚ <code>MSVC</code> (Windows) æˆ– <code>gcc</code> (Linux) ä¹‹ç±»çš„å·¥å…·ï¼Œå…·ä½“å–å†³äºæ“ä½œç³»ç»Ÿã€‚</p>
<p>å¦‚æœåœ¨æ‰§è¡Œä¸Šè¿°ä»£ç åé‡åˆ° <code>fatal error</code> ï¼Œè¯·ä¸è¦æ‹…å¿ƒã€‚æ‚¨å¯ä»¥å±•å¼€ä¸‹é¢çš„æ¡†ä»¥äº†è§£å¦‚ä½•å¤„ç†æ­¤é—®é¢˜ã€‚</p>
<blockquote>
<p><code>setup.py bdist_wheel</code> å¯¹ <code>ujson</code> çš„è°ƒç”¨éœ€è¦ Python å¼€å‘å¤´æ–‡ä»¶ï¼Œå› ä¸º <code>ujson.c</code> å¼•å…¥äº† <code>&lt;Python.h&gt;</code> ã€‚å¦‚æœæ‚¨æ²¡æœ‰å°†å®ƒä»¬æ”¾åœ¨å¯æœç´¢çš„ä½ç½®ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½ä¼šçœ‹åˆ°å¦‚ä¸‹é”™è¯¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">fatal error: <span class="s1">&#39;Python.h&#39;</span> file not found
</span></span><span class="line"><span class="cl"><span class="c1">#include &lt;Python.h&gt;</span>
</span></span></code></pre></div><p>è¦ç¼–è¯‘æ‰©å±•æ¨¡å—ï¼Œæ‚¨éœ€è¦å°†å¼€å‘æ ‡å¤´ä¿å­˜åœ¨ç¼–è¯‘å™¨å¯ä»¥æ‰¾åˆ°çš„åœ°æ–¹ã€‚</p>
<p>å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯æœ€æ–°ç‰ˆæœ¬çš„ Python 3 å’Œè™šæ‹Ÿç¯å¢ƒå·¥å…·ï¼ˆå¦‚ <code>venv</code> ï¼‰ï¼Œåˆ™ Python å¼€å‘æ ‡å¤´å¯èƒ½ä¼šé»˜è®¤åŒ…å«åœ¨ç¼–è¯‘å’Œé“¾æ¥ä¸­ã€‚</p>
<p>å¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½ä¼šçœ‹åˆ°ä¸€ä¸ªé”™è¯¯ï¼Œè¡¨æ˜æ‰¾ä¸åˆ°å¤´æ–‡ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">fatal error: <span class="s1">&#39;Python.h&#39;</span> file not found
</span></span><span class="line"><span class="cl"><span class="c1">#include &lt;Python.h&gt;</span>
</span></span></code></pre></div><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥é€šè¿‡è®¾ç½® <code>CFLAGS</code> æ¥å‘Šè¯‰ <code>setup.py</code> è¿˜å¯ä»¥åœ¨å“ªé‡ŒæŸ¥æ‰¾å¤´æ–‡ä»¶ã€‚è¦æŸ¥æ‰¾å¤´æ–‡ä»¶æœ¬èº«ï¼Œå¯ä»¥ä½¿ç”¨ <code>python3-config</code> ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python3-config --include
</span></span><span class="line"><span class="cl">-I/Users/&lt;username&gt;/.pyenv/versions/3.8.2/include/python3.8
</span></span></code></pre></div><p>è¿™å‘Šè¯‰æ‚¨ Python å¼€å‘æ ‡å¤´ä½äºæ˜¾ç¤ºçš„ç›®å½•ä¸­ï¼Œæ‚¨ç°åœ¨å¯ä»¥å°†å…¶ä¸ <code>python setup.py bdist_wheel</code> ä¸€èµ·ä½¿ç”¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="nv">CFLAGS</span><span class="o">=</span><span class="s2">&#34;</span><span class="k">$(</span>python3-config --include<span class="k">)</span><span class="s2">&#34;</span> python setup.py bdist_wheel
</span></span></code></pre></div><p>æ›´ä¸€èˆ¬åœ°è¯´ï¼Œæ‚¨å¯ä»¥ä¼ é€’æ‚¨éœ€è¦çš„ä»»ä½•è·¯å¾„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="nv">CFLAGS</span><span class="o">=</span><span class="s1">&#39;-I/path/to/include&#39;</span> python setup.py bdist_wheel
</span></span></code></pre></div><p>åœ¨ Linux ä¸Šï¼Œæ‚¨å¯èƒ½è¿˜éœ€è¦å•ç‹¬å®‰è£…å¤´æ–‡ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ apt-get install -y python3-dev  <span class="c1"># Debian, Ubuntu</span>
</span></span><span class="line"><span class="cl">$ yum install -y python3-devel  <span class="c1"># CentOS, Fedora, RHEL</span>
</span></span></code></pre></div></blockquote>
<p>å¦‚æœä½ æ£€æŸ¥ UltraJSON çš„ <a href="https://github.com/ultrajson/ultrajson/blob/master/setup.py">setup.py</a> ï¼Œä½ ä¼šçœ‹åˆ°å®ƒè‡ªå®šä¹‰äº†ä¸€äº›ç¼–è¯‘å™¨æ ‡å¿—ï¼Œä¾‹å¦‚ <code>-D_GNU_SOURCE</code> ã€‚é€šè¿‡ <code>setup.py</code> æ§åˆ¶ç¼–è¯‘è¿‡ç¨‹çš„å¤æ‚æ€§è¶…å‡ºäº†æœ¬æ•™ç¨‹çš„èŒƒå›´ï¼Œä½†æ‚¨åº”è¯¥çŸ¥é“å¯ä»¥<a href="https://pythonextensionpatterns.readthedocs.io/en/latest/compiler_flags.html#setting-flags-automatically-in-setup-py">å¯¹ç¼–è¯‘å’Œé“¾æ¥çš„å‘ç”Ÿæ–¹å¼è¿›è¡Œç»†ç²’åº¦æ§åˆ¶</a>ã€‚</p>
<p>å¦‚æœæ‚¨æŸ¥çœ‹ <code>dist</code> ï¼Œé‚£ä¹ˆæ‚¨åº”è¯¥ä¼šçœ‹åˆ°åˆ›å»ºçš„ Wheels ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ ls dist/
</span></span><span class="line"><span class="cl">ujson-2.0.3-cp38-cp38-macosx_10_15_x86_64.whl
</span></span></code></pre></div><p>è¯·æ³¨æ„ï¼Œåç§°å¯èƒ½å› æ‚¨çš„å¹³å°è€Œå¼‚ã€‚ä¾‹å¦‚ï¼Œæ‚¨ä¼šåœ¨ 64 ä½ Windows ä¸Šçœ‹åˆ° <code>win_amd64.whl</code> ã€‚</p>
<p>æ‚¨å¯ä»¥æŸ¥çœ‹ wheel æ–‡ä»¶å¹¶çœ‹åˆ°å®ƒåŒ…å«å·²ç¼–è¯‘çš„æ‰©å±•åï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ unzip -l dist/ujson-*.whl
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">  Length      Date    Time    Name
</span></span><span class="line"><span class="cl">---------  ---------- -----   ----
</span></span><span class="line"><span class="cl">   <span class="m">105812</span>  05-10-2020 19:47   ujson.cpython-38-darwin.so
</span></span><span class="line"><span class="cl">   ...
</span></span></code></pre></div><p>æ­¤ç¤ºä¾‹æ˜¾ç¤º macOS çš„è¾“å‡ºï¼Œ <code>ujson.cpython-38-darwin.so</code> ï¼Œè¿™æ˜¯ä¸€ä¸ªå…±äº«å¯¹è±¡ ( <code>.so</code> ) æ–‡ä»¶ï¼Œä¹Ÿç§°ä¸ºåŠ¨æ€åº“ã€‚</p>
<h3 id="æ„å»º-manylinux--wheels">æ„å»º <code>manylinux</code>  Wheels</h3>
<p>ä½œä¸ºè½¯ä»¶åŒ…å¼€å‘äººå‘˜ï¼Œæ‚¨å¾ˆå°‘ä¼šå¸Œæœ›ä¸ºå•ä¸ª Linux å˜ä½“æ„å»º Wheels ã€‚ Linux wheels éœ€è¦ä¸€å¥—ä¸“é—¨çš„çº¦å®šå’Œå·¥å…·ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥è·¨ä¸åŒçš„ Linux ç¯å¢ƒå·¥ä½œã€‚</p>
<p>ä¸ macOS å’Œ Windows çš„ wheel ä¸åŒï¼Œæ„å»ºåœ¨ä¸€ä¸ª Linux å˜ä½“ä¸Šçš„ wheel ä¸èƒ½ä¿è¯åœ¨å¦ä¸€ä¸ª Linux å˜ä½“ä¸Šå·¥ä½œï¼Œå³ä½¿æ˜¯å…·æœ‰ç›¸åŒæœºå™¨æ¶æ„çš„ Linux å˜ä½“ã€‚</p>
<p>äº‹å®ä¸Šï¼Œå¦‚æœæ‚¨åœ¨å¼€ç®±å³ç”¨çš„ Linux å®¹å™¨ä¸Šæ„å»ºä¸€ä¸ª Wheels ï¼Œé‚£ä¹ˆå¦‚æœæ‚¨å°è¯•ä¸Šä¼ å®ƒï¼ŒPyPI ç”šè‡³ä¸ä¼šæ¥å—è¯¥ Wheels ï¼</p>
<p>å¦‚æœæ‚¨å¸Œæœ›æ‚¨çš„åŒ…åœ¨ä¸€ç³»åˆ— Linux å®¢æˆ·ç«¯ä¸Šå¯ç”¨ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦ä¸€ä¸ª <code>manylinux</code>  Wheels ã€‚ <code>manylinux</code> wheel æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„å¹³å° wheelï¼Œè¢«å¤§å¤šæ•° Linux å˜ä½“æ¥å—ã€‚å®ƒå¿…é¡»åœ¨ç‰¹å®šç¯å¢ƒä¸­æ„å»ºï¼Œå¹¶ä¸”éœ€è¦ä¸€ä¸ªåä¸º <code>auditwheel</code> çš„å·¥å…·æ¥é‡å‘½å wheel æ–‡ä»¶ä»¥è¡¨æ˜å®ƒæ˜¯ä¸€ä¸ª <code>manylinux</code> wheelã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå³ä½¿æ‚¨æ˜¯ä»å¼€å‘äººå‘˜è€Œä¸æ˜¯ç”¨æˆ·çš„è§’åº¦æ¥å­¦ä¹ æœ¬æ•™ç¨‹ï¼Œè¯·ç¡®ä¿æ‚¨åœ¨ç»§ç»­æœ¬èŠ‚ä¹‹å‰å·²é˜…è¯»æœ‰å…³ <code>manylinux</code> wheel æ ‡ç­¾çš„éƒ¨åˆ†ã€‚</p>
</blockquote>
<p>æ„å»ºä¸€ä¸ª <code>manylinux</code>  Wheels å¯ä»¥è®©ä½ ç„å‡†æ›´å¹¿æ³›çš„ç”¨æˆ·å¹³å°ã€‚ PEP 513 æŒ‡å®šäº†ä¸€ä¸ªç‰¹å®šçš„ï¼ˆå’Œå¤è€çš„ï¼‰CentOS ç‰ˆæœ¬ï¼Œå…¶ä¸­åŒ…å«ä¸€ç³»åˆ—å¯ç”¨çš„ Python ç‰ˆæœ¬ã€‚ CentOS å’Œ Ubuntu æˆ–ä»»ä½•å…¶ä»–å‘è¡Œç‰ˆä¹‹é—´çš„é€‰æ‹©æ²¡æœ‰ä»»ä½•ç‰¹æ®ŠåŒºåˆ«ã€‚</p>
<p>é‡ç‚¹æ˜¯æ„å»ºç¯å¢ƒç”±ä¸€ä¸ªæ™®é€šçš„ Linux æ“ä½œç³»ç»Ÿå’Œä¸€ç»„æœ‰é™çš„å¤–éƒ¨å…±äº«åº“ç»„æˆï¼Œè¿™äº›å…±äº«åº“å¯¹äºä¸åŒçš„ Linux å˜ä½“æ˜¯é€šç”¨çš„ã€‚</p>
<p>å€¼å¾—åº†å¹¸çš„æ˜¯ï¼Œæ‚¨ä¸å¿…è‡ªå·±æ‰§è¡Œæ­¤æ“ä½œã€‚ PyPA æä¾›äº†ä¸€ç»„ <a href="https://github.com/pypa/manylinux">Docker é•œåƒ</a>ï¼Œåªéœ€å•å‡»å‡ ä¸‹é¼ æ ‡å³å¯ä¸ºæ‚¨æä¾›æ­¤ç¯å¢ƒï¼š</p>
<ul>
<li>é€‰é¡¹ 1 æ˜¯ä»æ‚¨çš„å¼€å‘æœºå™¨è¿è¡Œ <code>docker</code> å¹¶ä½¿ç”¨ Docker å·æŒ‚è½½æ‚¨çš„é¡¹ç›®ï¼Œä»¥ä¾¿å®ƒå¯ä»¥åœ¨å®¹å™¨æ–‡ä»¶ç³»ç»Ÿä¸­è®¿é—®ã€‚</li>
<li>é€‰é¡¹ 2 æ˜¯ä½¿ç”¨ CI/CD è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚ CircleCIã€GitHub Actionsã€Azure DevOps æˆ– Travis-CIï¼Œè¿™å°†æ‹‰å–æ‚¨çš„é¡¹ç›®å¹¶åœ¨æ¨é€æˆ–æ ‡è®°ç­‰æ“ä½œä¸Šè¿è¡Œæ„å»ºã€‚</li>
</ul>
<p>ä¸ºä¸åŒçš„ <code>manylinux</code> é£æ ¼æä¾›äº† Docker é•œåƒï¼š</p>
<table>
<thead>
<tr>
<th><code>manylinux</code> Tag</th>
<th>Architecture</th>
<th>Docker Image</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>manylinux1</code></td>
<td>x86-64</td>
<td><a href="https://quay.io/pypa/manylinux1_x86_64">quay.io/pypa/manylinux1_x86_64</a></td>
</tr>
<tr>
<td><code>manylinux1</code></td>
<td>i686</td>
<td><a href="https://quay.io/pypa/manylinux1_i686">quay.io/pypa/manylinux1_i686</a></td>
</tr>
<tr>
<td><code>manylinux2010</code></td>
<td>x86-64</td>
<td><a href="https://quay.io/pypa/manylinux2010_x86_64">quay.io/pypa/manylinux2010_x86_64</a></td>
</tr>
<tr>
<td><code>manylinux2010</code></td>
<td>i686</td>
<td><a href="https://quay.io/pypa/manylinux2010_i686">quay.io/pypa/manylinux2010_i686</a></td>
</tr>
<tr>
<td><code>manylinux2014</code></td>
<td>x86-64</td>
<td><a href="https://quay.io/pypa/manylinux2014_x86_64">quay.io/pypa/manylinux2014_x86_64</a></td>
</tr>
<tr>
<td><code>manylinux2014</code></td>
<td>i686</td>
<td><a href="https://quay.io/pypa/manylinux2014_i686">quay.io/pypa/manylinux2014_i686</a></td>
</tr>
<tr>
<td><code>manylinux2014</code></td>
<td>aarch64</td>
<td><a href="https://quay.io/pypa/manylinux2014_aarch64">quay.io/pypa/manylinux2014_aarch64</a></td>
</tr>
<tr>
<td><code>manylinux2014</code></td>
<td>ppc64le</td>
<td><a href="https://quay.io/pypa/manylinux2014_ppc64le">quay.io/pypa/manylinux2014_ppc64le</a></td>
</tr>
<tr>
<td><code>manylinux2014</code></td>
<td>s390x</td>
<td><a href="https://quay.io/pypa/manylinux2014_s390x">quay.io/pypa/manylinux2014_s390x</a></td>
</tr>
</tbody>
</table>
<p>é¦–å…ˆï¼ŒPyPA è¿˜æä¾›äº†ä¸€ä¸ªç¤ºä¾‹å­˜å‚¨åº“ <a href="https://github.com/pypa/python-manylinux-demo">python-manylinux-demo</a>ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºä¸ Travis-CI ä¸€èµ·æ„å»º <code>manylinux</code> wheels çš„æ¼”ç¤ºé¡¹ç›®ã€‚</p>
<p>è™½ç„¶æ„å»º wheels ä½œä¸ºè¿œç¨‹æ‰˜ç®¡ CI è§£å†³æ–¹æ¡ˆçš„ä¸€éƒ¨åˆ†å¾ˆå¸¸è§ï¼Œä½†æ‚¨ä¹Ÿå¯ä»¥åœ¨æœ¬åœ°æ„å»º <code>manylinux</code> wheelsã€‚ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦å®‰è£… Dockerã€‚ Docker Desktop é€‚ç”¨äº macOSã€Windows å’Œ Linuxã€‚</p>
<p>é¦–å…ˆï¼Œå…‹éš†æ¼”ç¤ºé¡¹ç›®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ git clone -q git@github.com:pypa/python-manylinux-demo.git
</span></span><span class="line"><span class="cl">$ <span class="nb">cd</span> python-manylinux-demo
</span></span></code></pre></div><p>æ¥ä¸‹æ¥ï¼Œåˆ†åˆ«ä¸º <code>manylinux1</code> Docker é•œåƒå’Œå¹³å°å®šä¹‰å‡ ä¸ª shell å˜é‡ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="nv">DOCKER_IMAGE</span><span class="o">=</span><span class="s1">&#39;quay.io/pypa/manylinux1_x86_64&#39;</span>
</span></span><span class="line"><span class="cl">$ <span class="nv">PLAT</span><span class="o">=</span><span class="s1">&#39;manylinux1_x86_64&#39;</span>
</span></span></code></pre></div><p><code>DOCKER_IMAGE</code> å˜é‡æ˜¯ç”± PyPA ç»´æŠ¤çš„ç”¨äºæ„å»º <code>manylinux</code>  Wheels çš„å›¾åƒï¼Œæ‰˜ç®¡åœ¨ <a href="https://quay.io/">Quay.io</a>ã€‚å¹³å° ( <code>PLAT</code> ) æ˜¯æä¾›ç»™ <code>auditwheel</code> çš„å¿…è¦ä¿¡æ¯ï¼Œè®©å®ƒçŸ¥é“è¦åº”ç”¨å“ªä¸ªå¹³å°æ ‡ç­¾ã€‚</p>
<p>ç°åœ¨æ‚¨å¯ä»¥æ‹‰å– Docker é•œåƒå¹¶åœ¨å®¹å™¨ä¸­è¿è¡Œ wheel-builder è„šæœ¬ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker pull <span class="s2">&#34;</span><span class="nv">$DOCKER_IMAGE</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">$ docker container run -t --rm <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      -e <span class="nv">PLAT</span><span class="o">=</span><span class="nv">$PLAT</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      -v <span class="s2">&#34;</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">&#34;</span>:/io <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      <span class="s2">&#34;</span><span class="nv">$DOCKER_IMAGE</span><span class="s2">&#34;</span> /io/travis/build-wheels.sh
</span></span></code></pre></div><p>è¿™å‘Šè¯‰ Docker åœ¨ <code>manylinux1_x86_64</code> Docker å®¹å™¨å†…è¿è¡Œ <code>build-wheels.sh</code> shell è„šæœ¬ï¼Œå°† <code>PLAT</code> ä½œä¸ºå®¹å™¨ä¸­å¯ç”¨çš„ç¯å¢ƒå˜é‡ä¼ é€’ã€‚ç”±äºæ‚¨ä½¿ç”¨ <code>-v</code> ï¼ˆæˆ– <code>--volume</code> ï¼‰ç»‘å®šæŒ‚è½½å·ï¼Œå› æ­¤å®¹å™¨ä¸­ç”Ÿæˆçš„ Wheels ç°åœ¨å¯ä»¥åœ¨ä¸»æœºä¸Šçš„ <code>wheelhouse</code> ç›®å½•ä¸­è®¿é—®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ ls -1 wheelhouse
</span></span><span class="line"><span class="cl">python_manylinux_demo-1.0-cp27-cp27m-manylinux1_x86_64.whl
</span></span><span class="line"><span class="cl">python_manylinux_demo-1.0-cp27-cp27mu-manylinux1_x86_64.whl
</span></span><span class="line"><span class="cl">python_manylinux_demo-1.0-cp35-cp35m-manylinux1_x86_64.whl
</span></span><span class="line"><span class="cl">python_manylinux_demo-1.0-cp36-cp36m-manylinux1_x86_64.whl
</span></span><span class="line"><span class="cl">python_manylinux_demo-1.0-cp37-cp37m-manylinux1_x86_64.whl
</span></span><span class="line"><span class="cl">python_manylinux_demo-1.0-cp38-cp38-manylinux1_x86_64.whl
</span></span></code></pre></div><p>åœ¨å‡ ä¸ªç®€çŸ­çš„å‘½ä»¤ä¸­ï¼Œæ‚¨æ‹¥æœ‰ä¸€ç»„é€‚ç”¨äº CPython 2.7 åˆ° 3.8 çš„ <code>manylinux1</code>  Wheels ã€‚ä¸€ç§å¸¸è§çš„åšæ³•æ˜¯è¿­ä»£ä¸åŒçš„æ¶æ„ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å¯¹ <code>quay.io/pypa/manylinux1_i686</code> Docker æ˜ åƒé‡å¤æ­¤è¿‡ç¨‹ã€‚è¿™å°†æ„å»ºé’ˆå¯¹ 32 ä½ (i686) æ¶æ„çš„ <code>manylinux1</code>  Wheels ã€‚</p>
<p>å¦‚æœæ‚¨æƒ³æ›´æ·±å…¥åœ°ç ”ç©¶é€  Wheels ï¼Œé‚£ä¹ˆä¸‹ä¸€æ­¥å°±æ˜¯å‘æœ€å¥½çš„äººå­¦ä¹ ã€‚ä» Python Wheels é¡µé¢å¼€å§‹ï¼Œé€‰æ‹©ä¸€ä¸ªé¡¹ç›®ï¼Œå¯¼èˆªåˆ°å®ƒçš„æºä»£ç ï¼ˆåœ¨ GitHubã€GitLab æˆ– Bitbucket ç­‰åœ°æ–¹ï¼‰ï¼Œç„¶åäº²çœ¼çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•æ„å»º Wheels çš„ã€‚</p>
<p>Python Wheels é¡µé¢ä¸Šçš„è®¸å¤šé¡¹ç›®éƒ½æ˜¯çº¯ Python é¡¹ç›®å¹¶åˆ†å‘é€šç”¨ Wheels ã€‚å¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾æ›´å¤æ‚çš„æ¡ˆä¾‹ï¼Œè¯·ç•™æ„ä½¿ç”¨æ‰©å±•æ¨¡å—çš„åŒ…ã€‚è¿™é‡Œæœ‰ä¸¤ä¸ªä¾‹å­å¯ä»¥æ¿€å‘ä½ çš„èƒƒå£ï¼š</p>
<ul>
<li><code>lxml</code> ä½¿ç”¨ä» <code>manylinux1</code> Docker å®¹å™¨ä¸­è°ƒç”¨çš„å•ç‹¬æ„å»ºè„šæœ¬ã€‚</li>
<li><code>ultrajson</code> åšåŒæ ·çš„äº‹æƒ…å¹¶ä½¿ç”¨ GitHub Actions è°ƒç”¨æ„å»ºè„šæœ¬ã€‚</li>
</ul>
<p>å¦‚æœæ‚¨æœ‰å…´è¶£æ„å»º <code>manylinux</code>  Wheels ï¼Œè¿™ä¸¤ä¸ªéƒ½æ˜¯è‘—åçš„é¡¹ç›®ï¼Œå®ƒä»¬æä¾›äº†å¾ˆå¥½çš„ç¤ºä¾‹ä¾›æ‚¨å­¦ä¹ ã€‚</p>
<h3 id="æ†ç»‘å…±äº«åº“">æ†ç»‘å…±äº«åº“</h3>
<p>å¦ä¸€ä¸ªæŒ‘æˆ˜æ˜¯ä¸ºä¾èµ–äºå¤–éƒ¨å…±äº«åº“çš„åŒ…æ„å»º Wheels ã€‚ <code>manylinux</code> å›¾åƒåŒ…å«ä¸€ç»„é¢„ç­›é€‰çš„åº“ï¼Œä¾‹å¦‚ <code>libpthread.so.0</code> å’Œ <code>libc.so.6</code> ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨ä¾èµ–è¯¥åˆ—è¡¨ä¹‹å¤–çš„ä¸œè¥¿æ€ä¹ˆåŠï¼Œä¾‹å¦‚ ATLAS æˆ– GFortranï¼Ÿ</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ‰å‡ ç§è§£å†³æ–¹æ¡ˆå¯ä»¥è§£å†³é—®é¢˜ï¼š</p>
<ul>
<li><code>auditwheel</code> ä¼šå°†å¤–éƒ¨åº“æ†ç»‘åˆ°ä¸€ä¸ªå·²ç»æ„å»ºå¥½çš„ Wheels ä¸­ã€‚</li>
<li><code>delocate</code> åœ¨ macOS ä¸ŠåšåŒæ ·çš„äº‹æƒ…ã€‚</li>
</ul>
<p>æ–¹ä¾¿çš„æ˜¯ï¼Œ <code>auditwheel</code> å‡ºç°åœ¨ <code>manylinux</code> Docker é•œåƒä¸Šã€‚ä½¿ç”¨ <code>auditwheel</code> å’Œ <code>delocate</code> åªéœ€ä¸€ä¸ªå‘½ä»¤ã€‚åªéœ€å‘Šè¯‰ä»–ä»¬æœ‰å…³ wheel æ–‡ä»¶çš„ä¿¡æ¯ï¼Œä»–ä»¬å°±ä¼šå®Œæˆå‰©ä¸‹çš„å·¥ä½œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ auditwheel repair &lt;path-to-wheel.whl&gt;  <span class="c1"># For manylinux</span>
</span></span><span class="line"><span class="cl">$ delocate-wheel &lt;path-to-wheel.whl&gt;  <span class="c1"># For macOS</span>
</span></span></code></pre></div><p>è¿™å°†é€šè¿‡é¡¹ç›®çš„ <code>setup.py</code> æ£€æµ‹æ‰€éœ€çš„å¤–éƒ¨åº“ï¼Œå¹¶å°†å®ƒä»¬æ†ç»‘åˆ° wheel ä¸­ï¼Œå°±å¥½åƒå®ƒä»¬æ˜¯é¡¹ç›®çš„ä¸€éƒ¨åˆ†ä¸€æ ·ã€‚</p>
<p>åˆ©ç”¨ <code>auditwheel</code> å’Œ <code>delocate</code> çš„é¡¹ç›®ç¤ºä¾‹æ˜¯ <code>pycld3</code> ï¼Œå®ƒä¸ºCompact Language Detector v3 (CLD3) æä¾›Python ç»‘å®šã€‚</p>
<p><code>pycld3</code> åŒ…ä¾èµ–äº <code>libprotobuf</code> ï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªé€šå¸¸å®‰è£…çš„åº“ã€‚å¦‚æœä½ æŸ¥çœ‹ <code>pycld3</code> macOS  Wheels å†…éƒ¨ï¼Œä½ ä¼šçœ‹åˆ° <code>libprotobuf.22.dylib</code> åŒ…å«åœ¨é‚£é‡Œã€‚è¿™æ˜¯ä¸€ä¸ªæ†ç»‘åˆ° Wheels ä¸­çš„åŠ¨æ€é“¾æ¥å…±äº«åº“ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ unzip -l pycld3-0.20-cp38-cp38-macosx_10_15_x86_64.whl
</span></span><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl">       <span class="m">51</span>  04-10-2020 11:46   cld3/__init__.py
</span></span><span class="line"><span class="cl">   <span class="m">939984</span>  04-10-2020 07:50   cld3/_cld3.cpython-38-darwin.so
</span></span><span class="line"><span class="cl">  <span class="m">2375836</span>  04-10-2020 07:50   cld3/.dylibs/libprotobuf.22.dylib
</span></span><span class="line"><span class="cl">---------                     -------
</span></span><span class="line"><span class="cl">  <span class="m">3339279</span>                     <span class="m">8</span> files
</span></span></code></pre></div><p>Wheels é¢„åŒ…è£…æœ‰ <code>libprotobuf</code> ã€‚ <code>.dylib</code> ç±»ä¼¼äº Unix <code>.so</code> æ–‡ä»¶æˆ– Windows <code>.dll</code> æ–‡ä»¶ï¼Œä½†æˆ‘æ‰¿è®¤æˆ‘ä¸çŸ¥é“é™¤æ­¤ä¹‹å¤–çš„å…·ä½“åŒºåˆ«ã€‚</p>
<p><code>auditwheel</code> å’Œ <code>delocate</code> çŸ¥é“åŒ…å« <code>libprotobuf</code> å› ä¸º <code>setup.py</code> é€šè¿‡ <code>libraries</code> å‚æ•°å‘Šè¯‰ä»–ä»¬ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">setup</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ...</span>
</span></span><span class="line"><span class="cl">    <span class="n">libraries</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;protobuf&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></div><p>è¿™æ„å‘³ç€ <code>auditwheel</code> å’Œ <code>delocate</code> ä¸ºç”¨æˆ·çœå»äº†å®‰è£… <code>protobuf</code> çš„éº»çƒ¦ï¼Œåªè¦ä»–ä»¬ä»å…·æœ‰åŒ¹é… Wheels çš„å¹³å°å’Œ Python ç»„åˆè¿›è¡Œå®‰è£…å³å¯ã€‚</p>
<p>å¦‚æœæ‚¨è¦åˆ†å‘çš„åŒ…å…·æœ‰è¿™æ ·çš„å¤–éƒ¨ä¾èµ–é¡¹ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>auditwheel</code> æˆ– <code>delocate</code> æ¥å¸®æ‚¨çš„ç”¨æˆ·ä¸€ä¸ªå¿™ï¼Œè®©ä»–ä»¬çœå»è‡ªå·±å®‰è£…ä¾èµ–é¡¹çš„é¢å¤–æ­¥éª¤ã€‚</p>
<h3 id="åœ¨æŒç»­é›†æˆä¸­æ„å»º-wheels">åœ¨æŒç»­é›†æˆä¸­æ„å»º Wheels</h3>
<p>åœ¨æœ¬åœ°æœºå™¨ä¸Šæ„å»º Wheels çš„æ›¿ä»£æ–¹æ³•æ˜¯åœ¨é¡¹ç›®çš„ <a href="https://realpython.com/python-continuous-integration/">CI ç®¡é“</a>ä¸­è‡ªåŠ¨æ„å»ºå®ƒä»¬ã€‚</p>
<p>æœ‰æ— æ•°ä¸ä¸»è¦ä»£ç æ‰˜ç®¡æœåŠ¡é›†æˆçš„ CI è§£å†³æ–¹æ¡ˆã€‚å…¶ä¸­åŒ…æ‹¬ <a href="https://www.appveyor.com/">Appveyor</a>ã€<a href="https://azure.microsoft.com/en-us/services/devops/">Azure DevOps</a>ã€<a href="https://bitbucket.org/product/features/pipelines">BitBucket Pipelines</a>ã€<a href="https://circleci.com/">Circle CI</a>ã€<a href="https://about.gitlab.com/stages-devops-lifecycle/continuous-integration/">GitLab</a>ã€<a href="https://github.com/features/actions">GitHub Actions</a>ã€<a href="https://www.jenkins.io/">Jenkins</a> å’Œ <a href="https://travis-ci.org/">Travis CI</a>ï¼Œä»…ä¸¾å‡ ä¾‹ã€‚</p>
<p>æœ¬æ•™ç¨‹çš„ç›®çš„ä¸æ˜¯è¦åˆ¤æ–­å“ªç§ CI æœåŠ¡æœ€é€‚åˆæ„å»º Wheels ï¼Œä»¥åŠè€ƒè™‘åˆ° CI æ”¯æŒçš„å‘å±•é€Ÿåº¦ï¼Œä»»ä½•æ”¯æŒå“ªäº›å®¹å™¨çš„ CI æœåŠ¡åˆ—è¡¨å¾ˆå¿«å°±ä¼šè¿‡æ—¶ã€‚</p>
<p>ä½†æ˜¯ï¼Œæœ¬èŠ‚å¯ä»¥å¸®åŠ©æ‚¨å…¥é—¨ã€‚</p>
<p>å¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªçº¯ Python åŒ…ï¼Œ <code>bdist_wheel</code> ä¸€æ­¥æ˜¯ä¸€ä¸ªå¹¸ç¦çš„å•è¡Œï¼šå®ƒåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šä¸ä½ åœ¨å“ªä¸ªå®¹å™¨æ“ä½œç³»ç»Ÿå’Œå¹³å°ä¸Šæ„å»º Wheels æ— å…³ã€‚å‡ ä¹æ‰€æœ‰ä¸»è¦çš„ CI æœåŠ¡éƒ½åº”è¯¥ä½¿æ‚¨èƒ½å¤Ÿé€šè¿‡åœ¨é¡¹ç›®å†…çš„ç‰¹æ®Š YAML æ–‡ä»¶ä¸­å®šä¹‰æ­¥éª¤æ¥ä»¥ç®€æ´çš„æ–¹å¼æ‰§è¡Œæ­¤æ“ä½œã€‚</p>
<p>ä¾‹å¦‚ï¼Œè¿™æ˜¯æ‚¨å¯ä»¥ç”¨äº GitHub Actions çš„è¯­æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Python wheels</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">release</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">types</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">created</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">jobs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">wheels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">actions/checkout@v2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Set up Python 3.x</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">actions/setup-python@v2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;3.x&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Install dependencies</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l">python -m pip install --upgrade setuptools wheel</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Build wheels</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l">python setup.py bdist_wheel</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">actions/upload-artifact@v2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">dist</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">dist</span><span class="w">
</span></span></span></code></pre></div><p>åœ¨æ­¤é…ç½®æ–‡ä»¶ä¸­ï¼Œæ‚¨ä½¿ç”¨ä»¥ä¸‹æ­¥éª¤æ„å»ºä¸€ä¸ª Wheels ï¼š</p>
<ul>
<li>åœ¨ç¬¬ 8 è¡Œï¼Œæ‚¨æŒ‡å®šè¯¥ä½œä¸šåº”åœ¨ Ubuntu æœºå™¨ä¸Šè¿è¡Œã€‚</li>
<li>åœ¨ç¬¬ 10 è¡Œä¸­ï¼Œæ‚¨ä½¿ç”¨ <code>checkout</code> æ“ä½œæ¥è®¾ç½®æ‚¨çš„é¡¹ç›®å­˜å‚¨åº“ã€‚</li>
<li>åœ¨ç¬¬ 14 è¡Œï¼Œæ‚¨å‘Šè¯‰ CI è¿è¡Œå™¨ä½¿ç”¨æœ€æ–°ç¨³å®šç‰ˆæœ¬çš„ Python 3ã€‚</li>
<li>åœ¨ç¬¬ 21 è¡Œä¸­ï¼Œæ‚¨è¯·æ±‚å°†ç”Ÿæˆçš„ Wheels ä½œä¸ºå·¥ä»¶æä¾›ï¼Œæ‚¨å¯ä»¥åœ¨ä½œä¸šå®Œæˆåä» UI ä¸‹è½½è¯¥å·¥ä»¶ã€‚</li>
</ul>
<p>ä½†æ˜¯ï¼Œå¦‚æœæ‚¨æœ‰ä¸€ä¸ªå¤æ‚çš„é¡¹ç›®ï¼ˆå¯èƒ½æ˜¯ä¸€ä¸ªå¸¦æœ‰ C æ‰©å±•æˆ– Cython ä»£ç çš„é¡¹ç›®ï¼‰å¹¶ä¸”æ‚¨æ­£åœ¨åŠªåŠ›æ„å»ºä¸€ä¸ª CI/CD ç®¡é“ä»¥è‡ªåŠ¨æ„å»º Wheels ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šæ¶‰åŠé¢å¤–çš„æ­¥éª¤ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æ‚¨å¯ä»¥é€šè¿‡ç¤ºä¾‹å­¦ä¹ çš„é¡¹ç›®ï¼š</p>
<ul>
<li><a href="https://github.com/aio-libs/yarl"><code>yarl</code></a></li>
<li><a href="https://github.com/msgpack/msgpack-python"><code>msgpack</code></a></li>
<li><a href="https://github.com/pallets/markupsafe"><code>markupsafe</code></a></li>
<li><a href="https://github.com/pyca/cryptography"><code>cryptography</code></a></li>
</ul>
<p>è®¸å¤šé¡¹ç›®æ¨å‡ºäº†è‡ªå·±çš„ CI é…ç½®ã€‚ç„¶è€Œï¼Œä¸€äº›è§£å†³æ–¹æ¡ˆå·²ç»å‡ºç°ï¼Œç”¨äºå‡å°‘é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„ä»£ç é‡æ¥æ„å»º Wheels ã€‚æ‚¨å¯ä»¥ç›´æ¥åœ¨ CI æœåŠ¡å™¨ä¸Šä½¿ç”¨ <a href="https://github.com/joerick/cibuildwheel">cibuildwheel</a> å·¥å…·æ¥å‡å°‘æ„å»ºå¤šä¸ªå¹³å° Wheels æ‰€éœ€çš„ä»£ç è¡Œå’Œé…ç½®ã€‚è¿˜æœ‰ <a href="https://github.com/matthew-brett/multibuild">multibuild</a>ï¼Œå®ƒæä¾›äº†ä¸€ç»„ shell è„šæœ¬ï¼Œç”¨äºååŠ©åœ¨ Travis CI å’Œ AppVeyor ä¸Šæ„å»º Wheels ã€‚</p>
<h3 id="ç¡®ä¿ä½ çš„-wheels-æ—‹è½¬æ­£ç¡®">ç¡®ä¿ä½ çš„ Wheels æ—‹è½¬æ­£ç¡®</h3>
<p>æ„å»ºç»“æ„æ­£ç¡®çš„ Wheels å¯èƒ½æ˜¯ä¸€é¡¹ç²¾ç»†çš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„ Python åŒ…ä½¿ç”¨ <code>src</code> å¸ƒå±€è€Œæ‚¨å¿˜è®°åœ¨ <code>setup.py</code> ä¸­æ­£ç¡®æŒ‡å®šå®ƒï¼Œé‚£ä¹ˆç”Ÿæˆçš„ Wheels å¯èƒ½åŒ…å«é”™è¯¯ä½ç½®çš„ç›®å½•ã€‚</p>
<p>æ‚¨å¯ä»¥åœ¨ <code>bdist_wheel</code> ä¹‹åä½¿ç”¨çš„ä¸€é¡¹æ£€æŸ¥æ˜¯ <code>check-wheel-contents</code> å·¥å…·ã€‚å®ƒæŸ¥æ‰¾å¸¸è§é—®é¢˜ï¼Œä¾‹å¦‚åŒ…ç›®å½•ç»“æ„å¼‚å¸¸æˆ–å­˜åœ¨é‡å¤æ–‡ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ check-wheel-contents dist/*.whl
</span></span><span class="line"><span class="cl">dist/ujson-2.0.3-cp38-cp38-macosx_10_15_x86_64.whl: OK
</span></span></code></pre></div><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œ <code>check-wheel-contents</code> è¡¨ç¤ºå¸¦ <code>ujson</code>   Wheels çš„æ‰€æœ‰å†…å®¹éƒ½å·²æ£€å‡ºã€‚å¦‚æœä¸æ˜¯ï¼Œ <code>stdout</code> å°†æ˜¾ç¤ºå¯èƒ½é—®é¢˜çš„æ‘˜è¦ï¼Œå°±åƒ <code>flake8</code> ä¹‹ç±»çš„ linterã€‚</p>
<p>å¦ä¸€ç§ç¡®è®¤æ‚¨æ„å»ºçš„ Wheels æ˜¯å¦æ­£ç¡®çš„æ–¹æ³•æ˜¯ä½¿ç”¨ TestPyPIã€‚é¦–å…ˆï¼Œæ‚¨å¯ä»¥åœ¨é‚£é‡Œä¸Šä¼ åŒ…ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python -m twine upload <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      --repository-url https://test.pypi.org/legacy/ <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      dist/*
</span></span></code></pre></div><p>ç„¶åï¼Œæ‚¨å¯ä»¥ä¸‹è½½ç›¸åŒçš„åŒ…è¿›è¡Œæµ‹è¯•ï¼Œå°±å¥½åƒå®ƒæ˜¯çœŸå®çš„ä¸€æ ·ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python -m pip install <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      --index-url https://test.pypi.org/simple/ <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      &lt;pkg-name&gt;
</span></span></code></pre></div><p>è¿™å…è®¸æ‚¨é€šè¿‡ä¸Šä¼ ç„¶åä¸‹è½½æ‚¨è‡ªå·±çš„é¡¹ç›®æ¥æµ‹è¯•æ‚¨çš„ Wheels ã€‚</p>
<h3 id="å°†-python-wheels-ä¸Šä¼ åˆ°-pypi">å°† Python Wheels ä¸Šä¼ åˆ° PyPI</h3>
<p>ç°åœ¨æ˜¯æ—¶å€™ä¸Šä¼ ä½ çš„ Python åŒ…äº†ã€‚ç”±äº <code>sdist</code> å’Œ wheel é»˜è®¤æƒ…å†µä¸‹éƒ½æ”¾åœ¨ <code>dist/</code> ç›®å½•ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>twine</code> å·¥å…·ä¸Šä¼ å®ƒä»¬ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºå°†åŒ…å‘å¸ƒåˆ° PyPI çš„å®ç”¨ç¨‹åºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python -m pip install -U twine
</span></span><span class="line"><span class="cl">$ python -m twine upload dist/*
</span></span></code></pre></div><p>ç”±äºé»˜è®¤æƒ…å†µä¸‹ <code>sdist</code> å’Œ <code>bdist_wheel</code> éƒ½è¾“å‡ºåˆ° <code>dist/</code> ï¼Œæ‚¨å¯ä»¥å®‰å…¨åœ°å‘Šè¯‰ <code>twine</code> ä½¿ç”¨shell é€šé…ç¬¦( <code>dist/*</code> ) ä¸Šä¼  <code>dist/</code> ä¸‹çš„æ‰€æœ‰å†…å®¹ã€‚</p>
<h2 id="ç»“è®º">ç»“è®º</h2>
<p>äº†è§£ Wheels åœ¨ Python ç”Ÿæ€ç³»ç»Ÿä¸­æ‰®æ¼”çš„å…³é”®è§’è‰²å¯ä»¥è®©æ‚¨ä½œä¸º Python åŒ…çš„ç”¨æˆ·å’Œå¼€å‘äººå‘˜çš„ç”Ÿæ´»æ›´è½»æ¾ã€‚</p>
<p>æ­¤å¤–ï¼Œåœ¨ Wheels æ–¹é¢æé«˜ä½ çš„ Python ç´ å…»å°†å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å®‰è£…åŒ…æ—¶å‘ç”Ÿäº†ä»€ä¹ˆï¼Œä»¥åŠåœ¨è¶Šæ¥è¶Šç½•è§çš„æƒ…å†µä¸‹ï¼Œè¯¥æ“ä½œä½•æ—¶å‡ºé”™ã€‚</p>
<p><strong>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å­¦ä¹ äº†ï¼š</strong></p>
<ul>
<li>ä»€ä¹ˆæ˜¯ Wheels ä»¥åŠå®ƒä»¬ä¸æºä»£ç åˆ†å¸ƒçš„æ¯”è¾ƒ</li>
<li>å¦‚ä½•ä½¿ç”¨ Wheels æ¥æ§åˆ¶åŒ…å®‰è£…è¿‡ç¨‹</li>
<li>é€šç”¨ Wheels ã€çº¯ Python  Wheels å’Œå¹³å° Wheels ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«</li>
<li>å¦‚ä½•ä¸ºæ‚¨è‡ªå·±çš„ Python åŒ…åˆ›å»ºå’Œåˆ†å‘ Wheels</li>
</ul>
<p>æ‚¨ç°åœ¨å·²ç»ä»ç”¨æˆ·å’Œå¼€å‘äººå‘˜çš„è§’åº¦å¯¹ Wheels æœ‰äº†æ·±å…¥çš„äº†è§£ã€‚æ‚¨å®Œå…¨æœ‰èƒ½åŠ›æ„å»ºè‡ªå·±çš„ Wheels ï¼Œå¹¶ä½¿é¡¹ç›®çš„å®‰è£…è¿‡ç¨‹å¿«é€Ÿã€æ–¹ä¾¿å’Œç¨³å®šã€‚</p>
<p>è¯·å‚é˜…ä¸‹é¢çš„éƒ¨åˆ†ä»¥è·å–ä¸€äº›é¢å¤–çš„é˜…è¯»ææ–™ï¼Œä»¥æ›´æ·±å…¥åœ°äº†è§£å¿«é€Ÿæ‰©å±•çš„ wheel ç”Ÿæ€ç³»ç»Ÿã€‚</p>
<h2 id="èµ„æº">èµ„æº</h2>
<p><a href="https://pythonwheels.com/">Python Wheels</a>é¡µé¢ä¸“é—¨è·Ÿè¸ª PyPI ä¸Šä¸‹è½½æ¬¡æ•°æœ€å¤šçš„ 360 ä¸ªåŒ…ä¸­å¯¹ wheels çš„æ”¯æŒã€‚åœ¨ç¼–å†™æœ¬æ•™ç¨‹æ—¶ï¼Œé‡‡ç”¨ç‡éå¸¸å¯è§‚ï¼Œä¸º 360 åˆ†ä¹‹ 331ï¼Œå³ 91% å·¦å³ã€‚</p>
<p>å·²ç»æœ‰è®¸å¤š Python å¢å¼ºææ¡ˆ (PEP) å¸®åŠ©äº† wheel æ ¼å¼çš„è§„èŒƒå’Œå‘å±•ï¼š</p>
<ul>
<li><a href="https://www.python.org/dev/peps/pep-0425/">PEP 425 - Compatibility Tags for Built Distributions</a></li>
<li><a href="https://www.python.org/dev/peps/pep-0427/">PEP 427 - The Wheel Binary Package Format 1.0</a></li>
<li><a href="https://www.python.org/dev/peps/pep-0491/">PEP 491 - The Wheel Binary Package Format 1.9</a></li>
<li><a href="https://www.python.org/dev/peps/pep-0513/">PEP 513 - A Platform Tag for Portable Linux Built Distributions</a></li>
<li><a href="https://www.python.org/dev/peps/pep-0571/">PEP 571 - The manylinux2010 Platform Tag</a></li>
<li><a href="https://www.python.org/dev/peps/pep-0599/">PEP 599 - The manylinux2014 Platform Tag</a></li>
</ul>
<p>ä»¥ä¸‹æ˜¯æœ¬æ•™ç¨‹ä¸­æåˆ°çš„å„ç§ wheel æ‰“åŒ…å·¥å…·çš„å€™é€‰æ¸…å•ï¼š</p>
<ul>
<li><a href="https://github.com/pypa/wheel">pypa/wheel</a></li>
<li><a href="https://github.com/pypa/auditwheel">pypa/auditwheel</a></li>
<li><a href="https://github.com/pypa/manylinux">pypa/manylinux</a></li>
<li><a href="https://github.com/pypa/python-manylinux-demo">pypa/python-manylinux-demo</a></li>
<li><a href="https://github.com/jwodder/check-wheel-contents">jwodder/check-wheel-contents</a></li>
<li><a href="https://github.com/matthew-brett/delocate">matthew-brett/delocate</a></li>
<li><a href="https://github.com/matthew-brett/multibuild">matthew-brett/multibuild</a></li>
<li><a href="https://github.com/joerick/cibuildwheel">joerick/cibuildwheel</a></li>
</ul>
<p>Python æ–‡æ¡£æœ‰å‡ ç¯‡æ–‡ç« æ¶µç›–äº† Wheels å’Œæºä»£ç åˆ†å‘ï¼š</p>
<ul>
<li><a href="https://packaging.python.org/tutorials/packaging-projects/#generating-distribution-archives">Generating Distribution Archives</a></li>
<li><a href="https://docs.python.org/3/distutils/sourcedist.html">Creating a Source Distribution</a></li>
</ul>
<p>æœ€åï¼Œè¿™é‡Œæœ‰ä¸€äº›æ¥è‡ª PyPA çš„æ›´æœ‰ç”¨çš„é“¾æ¥ï¼š</p>
<ul>
<li><a href="https://packaging.python.org/guides/distributing-packages-using-setuptools/#packaging-your-project">Packaging your Project</a></li>
<li><a href="https://packaging.python.org/overview/">An Overview of Packaging for Python</a></li>
</ul>
<p>åŸæ–‡åœ°å€ï¼š<a href="https://realpython.com/python-wheels/">https://realpython.com/python-wheels/</a></p>
]]></content:encoded>
    </item>
    
    <item>
      <title>[è¯‘]ä½¿ç”¨ Python çš„ pip ç®¡ç†é¡¹ç›®çš„ä¾èµ–å…³ç³»</title>
      <link>https://blog.chensoul.com/posts/2023/06/01/what-is-pip/</link>
      <pubDate>Thu, 01 Jun 2023 09:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/06/01/what-is-pip/</guid>
      <description>Python çš„æ ‡å‡†åŒ…ç®¡ç†å™¨æ˜¯ pip ã€‚å®ƒå…è®¸æ‚¨å®‰è£…å’Œç®¡ç†ä¸å±äº Python æ ‡å‡†åº“çš„åŒ…ã€‚å¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾ pip çš„ä»‹ç»ï¼Œé‚£ä¹ˆæ‚¨æ¥å¯¹åœ°æ–¹äº†ï¼ åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•ï¼š åœ¨æ‚¨çš„å·¥ä½œç¯</description>
      <content:encoded><![CDATA[<p><img loading="lazy" src="https://files.realpython.com/media/What-is-PIP_Watermarked.4944e95d83ad.jpg" alt="Using Python&amp;rsquo;s pip to Manage Your Projects&amp;rsquo; Dependencies"  />
</p>
<p><a href="https://www.python.org/">Python</a> çš„æ ‡å‡†åŒ…ç®¡ç†å™¨æ˜¯ <a href="https://pip.pypa.io/en/stable/">pip</a> ã€‚å®ƒå…è®¸æ‚¨å®‰è£…å’Œç®¡ç†ä¸å±äº Python <a href="https://docs.python.org/3/py-modindex.html">æ ‡å‡†åº“</a>çš„åŒ…ã€‚å¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾ <code>pip</code> çš„ä»‹ç»ï¼Œé‚£ä¹ˆæ‚¨æ¥å¯¹åœ°æ–¹äº†ï¼</p>
<p><strong>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•ï¼š</strong></p>
<ul>
<li>åœ¨æ‚¨çš„å·¥ä½œç¯å¢ƒä¸­è®¾ç½® <code>pip</code></li>
<li>ä¿®å¤ä¸ä½¿ç”¨ <code>pip</code> ç›¸å…³çš„å¸¸è§é”™è¯¯</li>
<li>ä½¿ç”¨ <code>pip</code> å®‰è£…å’Œå¸è½½åŒ…</li>
<li>ä½¿ç”¨éœ€æ±‚æ–‡ä»¶ç®¡ç†é¡¹ç›®çš„ä¾èµ–å…³ç³»</li>
</ul>
<p><code>pip</code> å¯ä»¥åšå¾ˆå¤šäº‹æƒ…ï¼Œä½†æ˜¯ Python ç¤¾åŒºéå¸¸æ´»è·ƒï¼Œå·²ç»åˆ›å»ºäº†ä¸€äº› <code>pip</code> çš„å·§å¦™æ›¿ä»£å“ã€‚æ‚¨å°†åœ¨æœ¬æ•™ç¨‹çš„åé¢éƒ¨åˆ†äº†è§£è¿™äº›å†…å®¹ã€‚</p>
<h2 id="ä»-pip-å¼€å§‹">ä» <code>pip</code> å¼€å§‹</h2>
<p>é‚£ä¹ˆï¼Œ<code>pip</code> å…·ä½“æ˜¯åšä»€ä¹ˆçš„å‘¢ï¼Ÿ <a href="https://pip.pypa.io/en/stable/">pip</a> æ˜¯ Python çš„åŒ…ç®¡ç†å™¨ã€‚è¿™æ„å‘³ç€å®ƒæ˜¯ä¸€ä¸ªå…è®¸æ‚¨å®‰è£…å’Œç®¡ç†æœªä½œä¸ºæ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†åˆ†å‘çš„åº“å’Œä¾èµ–é¡¹çš„å·¥å…·ã€‚ pip è¿™ä¸ªåå­—æ˜¯ç”± Ian Bicking åœ¨ 2008 å¹´å¼•å…¥çš„ï¼š</p>
<blockquote>
<p>æˆ‘å·²ç»å°† pyinstall é‡å‘½åä¸ºæ–°åç§°ï¼špipã€‚pip æ˜¯ pip install package é¦–å­—æ¯ç¼©å†™ã€‚ ï¼ˆ <a href="https://www.ianbicking.org/blog/2008/10/pyinstall-is-dead-long-live-pip.html">æ¥æº</a>ï¼‰</p>
</blockquote>
<p>åŒ…ç®¡ç†éå¸¸é‡è¦ï¼ŒPython çš„å®‰è£…ç¨‹åºä» 3.4 ç‰ˆå’Œ 2.7.9 ç‰ˆå¼€å§‹åˆ†åˆ«ä¸º Python 3 å’Œ Python 2 åŒ…å«äº† <code>pip</code> ã€‚è®¸å¤š Python é¡¹ç›®éƒ½ä½¿ç”¨ <code>pip</code> ï¼Œè¿™ä½¿å®ƒæˆä¸ºæ¯ä¸ª Pythonista çš„å¿…å¤‡å·¥å…·ã€‚</p>
<p>å¦‚æœæ‚¨æ¥è‡ªå¦ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œæ‚¨å¯èƒ½ä¼šç†Ÿæ‚‰åŒ…ç®¡ç†å™¨çš„æ¦‚å¿µã€‚ <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript">JavaScript</a> ä½¿ç”¨ <a href="https://www.npmjs.com/">npm</a> è¿›è¡ŒåŒ…ç®¡ç†ï¼Œ<a href="https://www.ruby-lang.org/en/">Ruby</a> ä½¿ç”¨ <a href="https://rubygems.org/">gem</a>ï¼Œ<a href="https://dotnet.microsoft.com/languages">.NET å¹³å°</a>ä½¿ç”¨ <a href="https://www.nuget.org/">NuGet</a>ã€‚åœ¨ Python ä¸­ï¼Œ <code>pip</code> å·²æˆä¸ºæ ‡å‡†åŒ…ç®¡ç†å™¨ã€‚</p>
<h3 id="åœ¨æ‚¨çš„ç³»ç»Ÿä¸ŠæŸ¥æ‰¾-pip">åœ¨æ‚¨çš„ç³»ç»Ÿä¸ŠæŸ¥æ‰¾ pip</h3>
<p>Python 3 å®‰è£…ç¨‹åºä¸ºæ‚¨æä¾›äº†åœ¨ç³»ç»Ÿä¸Šå®‰è£… Python æ—¶å®‰è£… <code>pip</code> çš„é€‰é¡¹ã€‚äº‹å®ä¸Šï¼Œ <code>pip</code> ä¸Pythonä¸€èµ·å®‰è£…çš„é€‰é¡¹é»˜è®¤æ˜¯å‹¾é€‰çš„ï¼Œæ‰€ä»¥ <code>pip</code> åº”è¯¥åœ¨å®‰è£…å®ŒPythonä¹‹åå°±å¯ä»¥ä½¿ç”¨äº†ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šåœ¨æŸäº› Linux (Unix) ç³»ç»Ÿï¼ˆå¦‚ Ubuntuï¼‰ä¸Šï¼Œ <code>pip</code> ä½äºä¸€ä¸ªåä¸º <code>python3-pip</code> çš„å•ç‹¬åŒ…ä¸­ï¼Œæ‚¨éœ€è¦ä½¿ç”¨ <code>sudo apt install python3-pip</code> å®‰è£…å®ƒã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¸ä¼šéšè§£é‡Šå™¨ä¸€èµ·å®‰è£…ã€‚</p>
</blockquote>
<p>æ‚¨å¯ä»¥é€šè¿‡åœ¨æ‚¨çš„ç³»ç»Ÿä¸ŠæŸ¥æ‰¾ <code>pip3</code> å¯æ‰§è¡Œæ–‡ä»¶æ¥éªŒè¯ <code>pip</code> æ˜¯å¦å¯ç”¨ã€‚åœ¨ä¸‹é¢é€‰æ‹©æ‚¨çš„æ“ä½œç³»ç»Ÿå¹¶ç›¸åº”åœ°ä½¿ç”¨æ‚¨çš„å¹³å°ç‰¹å®šå‘½ä»¤ï¼š</p>
<p>Windowsï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">C:<span class="se">\&gt;</span> where pip3
</span></span></code></pre></div><p>Linux + macOSï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ which pip3
</span></span></code></pre></div><p>Linux ç³»ç»Ÿå’Œ macOS ä¸Šçš„ <code>which</code> å‘½ä»¤æ˜¾ç¤º <code>pip3</code> äºŒè¿›åˆ¶æ–‡ä»¶æ‰€åœ¨çš„ä½ç½®ã€‚</p>
<p>åœ¨ Windows å’Œ Unix ç³»ç»Ÿä¸Šï¼Œ <code>pip3</code> å¯èƒ½ä½äºå¤šä¸ªä½ç½®ã€‚å½“æ‚¨å®‰è£…äº†å¤šä¸ª Python ç‰ˆæœ¬æ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚å¦‚æœæ‚¨åœ¨ç³»ç»Ÿçš„ä»»ä½•ä½ç½®éƒ½æ‰¾ä¸åˆ° <code>pip</code> ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥è€ƒè™‘é‡æ–°å®‰è£… pipã€‚</p>
<p>é™¤äº†ç›´æ¥è¿è¡Œæ‚¨çš„ç³»ç»Ÿ <code>pip</code> ï¼Œæ‚¨è¿˜å¯ä»¥å°†å…¶ä½œä¸º Python æ¨¡å—è¿è¡Œã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæ‚¨å°†äº†è§£å¦‚ä½•æ“ä½œã€‚</p>
<h3 id="ä½œä¸ºæ¨¡å—è¿è¡Œ-pip">ä½œä¸ºæ¨¡å—è¿è¡Œ pip</h3>
<p>å½“æ‚¨ç›´æ¥è¿è¡Œç³»ç»Ÿ <code>pip</code> æ—¶ï¼Œå‘½ä»¤æœ¬èº«ä¸ä¼šæ˜¾ç¤º <code>pip</code> å±äºå“ªä¸ª Python ç‰ˆæœ¬ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥åœ¨ä¸æ³¨æ„çš„æƒ…å†µä¸‹ä½¿ç”¨ <code>pip</code> å°†åŒ…å®‰è£…åˆ°æ—§ Python ç‰ˆæœ¬çš„ç«™ç‚¹åŒ…ä¸­ã€‚ä¸ºé˜²æ­¢è¿™ç§æƒ…å†µå‘ç”Ÿï¼Œæ‚¨å¯ä»¥å°† <code>pip</code> ä½œä¸º Python æ¨¡å—è¿è¡Œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python3 -m pip
</span></span></code></pre></div><p>è¯·æ³¨æ„ï¼Œæ‚¨ä½¿ç”¨ <code>python3 -m</code> æ¥è¿è¡Œ <code>pip</code> ã€‚ <code>-m</code> å¼€å…³å‘Šè¯‰ Python å°†æ¨¡å—ä½œä¸º <code>python3</code> è§£é‡Šå™¨çš„å¯æ‰§è¡Œæ–‡ä»¶è¿è¡Œã€‚è¿™æ ·ï¼Œæ‚¨å¯ä»¥ç¡®ä¿ç³»ç»Ÿé»˜è®¤çš„ Python 3 ç‰ˆæœ¬è¿è¡Œ <code>pip</code> å‘½ä»¤ã€‚å¦‚æœæ‚¨æƒ³äº†è§£æ›´å¤šå…³äºè¿™ç§è¿è¡Œ <code>pip</code> çš„æ–¹å¼ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥é˜…è¯» Brett Cannon å…³äº<a href="https://snarky.ca/why-you-should-use-python-m-pip/">ä½¿ç”¨ python3 -m pip çš„ä¼˜åŠ¿</a>çš„æœ‰è§åœ°çš„æ–‡ç« ã€‚</p>
<p>æœ‰æ—¶æ‚¨å¯èƒ½å¸Œæœ›æ›´åŠ æ˜ç¡®å¹¶å°†åŒ…é™åˆ¶åˆ°ç‰¹å®šé¡¹ç›®ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨åº”è¯¥åœ¨è™šæ‹Ÿç¯å¢ƒä¸­è¿è¡Œ <code>pip</code> ã€‚</p>
<h3 id="åœ¨-python-è™šæ‹Ÿç¯å¢ƒä¸­ä½¿ç”¨-pip">åœ¨ Python è™šæ‹Ÿç¯å¢ƒä¸­ä½¿ç”¨ pip</h3>
<p>ä¸ºé¿å…å°†åŒ…ç›´æ¥å®‰è£…åˆ°ç³»ç»Ÿ Python å®‰è£…ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<a href="https://realpython.com/python-virtual-environments-a-primer/">è™šæ‹Ÿç¯å¢ƒ</a>ã€‚è™šæ‹Ÿç¯å¢ƒä¸ºæ‚¨çš„é¡¹ç›®æä¾›ç‹¬ç«‹çš„ Python è§£é‡Šå™¨ã€‚æ‚¨åœ¨æ­¤ç¯å¢ƒä¸­ä½¿ç”¨çš„ä»»ä½•åŒ…éƒ½å°†ç‹¬ç«‹äºæ‚¨çš„ç³»ç»Ÿè§£é‡Šå™¨ã€‚</p>
<p>è¿™æ„å‘³ç€æ‚¨å¯ä»¥å°†é¡¹ç›®çš„ä¾èµ–é¡¹ä¸å…¶ä»–é¡¹ç›®å’Œæ•´ä¸ªç³»ç»Ÿåˆ†å¼€ã€‚</p>
<p>åœ¨è™šæ‹Ÿç¯å¢ƒä¸­ä½¿ç”¨ <code>pip</code> å…·æœ‰ä¸‰ä¸ªä¸»è¦ä¼˜ç‚¹ã€‚ä½ å¯ä»¥ï¼š</p>
<ul>
<li>ç¡®ä¿æ‚¨ä¸ºæ‰‹å¤´çš„é¡¹ç›®ä½¿ç”¨æ­£ç¡®çš„ Python ç‰ˆæœ¬</li>
<li>ç¡®ä¿åœ¨è¿è¡Œ <code>pip</code> æˆ– <code>pip3</code> æ—¶å¼•ç”¨çš„æ˜¯æ­£ç¡®çš„ <code>pip</code> å®ä¾‹</li>
<li>åœ¨ä¸å½±å“å…¶ä»–é¡¹ç›®çš„æƒ…å†µä¸‹ä¸ºæ‚¨çš„é¡¹ç›®ä½¿ç”¨ç‰¹å®šçš„åŒ…ç‰ˆæœ¬</li>
</ul>
<p>Python 3 å…·æœ‰ç”¨äºåˆ›å»ºè™šæ‹Ÿç¯å¢ƒçš„å†…ç½® <code>venv</code> æ¨¡å—ã€‚æ­¤æ¨¡å—å¯å¸®åŠ©æ‚¨ä½¿ç”¨ç‹¬ç«‹çš„ Python å®‰è£…åˆ›å»ºè™šæ‹Ÿç¯å¢ƒã€‚ä¸€æ—¦ä½ æ¿€æ´»äº†è™šæ‹Ÿç¯å¢ƒï¼Œä½ å°±å¯ä»¥å°†åŒ…å®‰è£…åˆ°è¿™ä¸ªç¯å¢ƒä¸­ã€‚</p>
<p>æ‚¨å®‰è£…åˆ°ä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒä¸­çš„è½¯ä»¶åŒ…ä¸ç³»ç»Ÿä¸Šçš„æ‰€æœ‰å…¶ä»–ç¯å¢ƒéš”ç¦»å¼€æ¥ã€‚</p>
<p>æ‚¨å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå¹¶éªŒè¯æ‚¨æ˜¯å¦åœ¨æ–°åˆ›å»ºçš„ç¯å¢ƒä¸­ä½¿ç”¨ <code>pip</code> æ¨¡å—ï¼š</p>
<p>Windowsï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">C:<span class="se">\&gt;</span> python -m venv venv
</span></span><span class="line"><span class="cl">C:<span class="se">\&gt;</span> venv<span class="se">\S</span>cripts<span class="se">\a</span>ctivate.bat
</span></span><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> C:<span class="se">\&gt;</span>  pip3 --version
</span></span><span class="line"><span class="cl">pip 21.2.3 from ...<span class="se">\l</span>ib<span class="se">\s</span>ite-packages<span class="se">\p</span>ip <span class="o">(</span>python 3.10<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> C:<span class="se">\&gt;</span>  pip --version
</span></span><span class="line"><span class="cl">pip 21.2.3 from ...<span class="se">\l</span>ib<span class="se">\s</span>ite-packages<span class="se">\p</span>ip <span class="o">(</span>python 3.10<span class="o">)</span>
</span></span></code></pre></div><p>Linux + macOSï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python3 -m venv venv
</span></span><span class="line"><span class="cl">$ <span class="nb">source</span> venv/bin/activate
</span></span><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> $ pip3 --version
</span></span><span class="line"><span class="cl">pip 21.2.3 from .../python3.10/site-packages/pip <span class="o">(</span>python 3.10<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> $ pip --version
</span></span><span class="line"><span class="cl">pip 21.2.3 from .../python3.10/site-packages/pip <span class="o">(</span>python 3.10<span class="o">)</span>
</span></span></code></pre></div><p>åœ¨è¿™é‡Œï¼Œæ‚¨ä½¿ç”¨ Python çš„å†…ç½® <code>venv</code> æ¨¡å—åˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>venv</code> çš„è™šæ‹Ÿç¯å¢ƒã€‚ç„¶åä½¿ç”¨ <code>source</code> å‘½ä»¤æ¿€æ´»å®ƒã€‚ <code>venv</code> åç§°å‘¨å›´çš„æ‹¬å· ( <code>()</code> ) è¡¨ç¤ºæ‚¨å·²æˆåŠŸæ¿€æ´»è™šæ‹Ÿç¯å¢ƒã€‚</p>
<p>æœ€åï¼Œæ‚¨æ£€æŸ¥æ¿€æ´»çš„è™šæ‹Ÿç¯å¢ƒä¸­ <code>pip3</code> å’Œ <code>pip</code> å¯æ‰§è¡Œæ–‡ä»¶çš„ç‰ˆæœ¬ã€‚ä¸¤è€…éƒ½æŒ‡å‘ç›¸åŒçš„ <code>pip</code> æ¨¡å—ï¼Œå› æ­¤ä¸€æ—¦æ‚¨çš„è™šæ‹Ÿç¯å¢ƒè¢«æ¿€æ´»ï¼Œæ‚¨å°±å¯ä»¥ä½¿ç”¨ <code>pip</code> æˆ– <code>pip3</code> ã€‚</p>
<h3 id="å‡ºç°é”™è¯¯æ—¶é‡æ–°å®‰è£…-pip">å‡ºç°é”™è¯¯æ—¶é‡æ–°å®‰è£… pip</h3>
<p>å½“æ‚¨è¿è¡Œ <code>pip</code> å‘½ä»¤æ—¶ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹æ‚¨å¯èƒ½ä¼šé‡åˆ°é”™è¯¯ã€‚æ‚¨çš„ç‰¹å®šé”™è¯¯æ¶ˆæ¯å°†å–å†³äºæ‚¨çš„æ“ä½œç³»ç»Ÿï¼š</p>
<table>
<thead>
<tr>
<th>Operating System</th>
<th>Error Message</th>
</tr>
</thead>
<tbody>
<tr>
<td>Windows</td>
<td><code>'pip' is not recognized as an internal or external command,</code> <code>operable program or batch file.</code></td>
</tr>
<tr>
<td>Linux</td>
<td><code>bash: pip: command not found</code></td>
</tr>
<tr>
<td>macOS</td>
<td><code>zsh: command not found: pip</code></td>
</tr>
</tbody>
</table>
<blockquote>
<p>æ³¨æ„ï¼šåœ¨ <code>pip</code> å‘½ä»¤ä¸èµ·ä½œç”¨æ—¶å¼€å§‹ä»»ä½•æ•…éšœæ’é™¤ä¹‹å‰ï¼Œæ‚¨å¯ä»¥å°è¯•ä½¿ç”¨æœ€åå¸¦æœ‰ 3 çš„ <code>pip3</code> å‘½ä»¤ã€‚</p>
</blockquote>
<p>å‡ºç°å¦‚ä¸Šæ‰€ç¤ºçš„é”™è¯¯å¯èƒ½ä¼šä»¤äººæ²®ä¸§ï¼Œå› ä¸º <code>pip</code> å¯¹äºå®‰è£…å’Œç®¡ç†å¤–éƒ¨åŒ…è‡³å…³é‡è¦ã€‚ <code>pip</code> çš„ä¸€äº›å¸¸è§é—®é¢˜ä¸æ­¤å·¥å…·åœ¨æ‚¨çš„ç³»ç»Ÿä¸Šçš„å®‰è£…æ–¹å¼æœ‰å…³ã€‚</p>
<p>å°½ç®¡å„ç§ç³»ç»Ÿçš„é”™è¯¯æ¶ˆæ¯ä¸åŒï¼Œä½†å®ƒä»¬éƒ½æŒ‡å‘åŒä¸€ä¸ªé—®é¢˜ï¼šæ‚¨çš„ç³»ç»Ÿæ— æ³•åœ¨æ‚¨çš„ <code>PATH</code> å˜é‡ä¸­åˆ—å‡ºçš„ä½ç½®æ‰¾åˆ° <code>pip</code> ã€‚åœ¨ Windows ä¸Šï¼Œ <code>PATH</code> æ˜¯ç³»ç»Ÿå˜é‡çš„ä¸€éƒ¨åˆ†ã€‚åœ¨ macOS å’Œ Linux ä¸Šï¼Œ <code>PATH</code> æ˜¯ç¯å¢ƒå˜é‡çš„ä¸€éƒ¨åˆ†ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ <code>PATH</code> å˜é‡çš„å†…å®¹ï¼š</p>
<p>Windowsï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">C:<span class="se">\&gt;</span> <span class="nb">echo</span> %PATH%
</span></span></code></pre></div><p>Linux + macOSï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="nb">echo</span> <span class="nv">$PATH</span>
</span></span></code></pre></div><p>æ­¤å‘½ä»¤çš„è¾“å‡ºå°†æ˜¾ç¤ºç£ç›˜ä¸Šæ“ä½œç³»ç»ŸæŸ¥æ‰¾å¯æ‰§è¡Œç¨‹åºçš„ä½ç½®ï¼ˆç›®å½•ï¼‰åˆ—è¡¨ã€‚æ ¹æ®æ‚¨çš„ç³»ç»Ÿï¼Œä½ç½®å¯ä»¥ç”¨å†’å· ( <code>:</code> ) æˆ–åˆ†å· ( <code>;</code> ) åˆ†éš”ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨å®‰è£… Python æˆ–åˆ›å»ºè™šæ‹Ÿç¯å¢ƒåï¼ŒåŒ…å« <code>pip</code> å¯æ‰§è¡Œæ–‡ä»¶çš„ç›®å½•åº”è¯¥å‡ºç°åœ¨ <code>PATH</code> ä¸­ã€‚ä½†æ˜¯ï¼Œç¼ºå°‘ <code>pip</code> æ˜¯ä¸€ä¸ªå¸¸è§é—®é¢˜ã€‚ä¸¤ç§æ”¯æŒçš„æ–¹æ³•å¯ä»¥å¸®åŠ©æ‚¨å†æ¬¡å®‰è£… <code>pip</code> å¹¶å°†å…¶æ·»åŠ åˆ°æ‚¨çš„ <code>PATH</code> ï¼š</p>
<ul>
<li><a href="https://docs.python.org/3/library/ensurepip.html#module-ensurepip">ensurepip</a> æ¨¡å—</li>
<li><a href="https://github.com/pypa/get-pip">get-pip.py</a> è„šæœ¬</li>
</ul>
<p><code>ensurepip</code> æ¨¡å—ä» Python 3.4 å¼€å§‹å°±æ˜¯æ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†ã€‚æ·»åŠ å®ƒæ˜¯ä¸ºäº†æä¾›ä¸€ç§ç›´æ¥çš„æ–¹å¼è®©æ‚¨é‡æ–°å®‰è£… <code>pip</code> ï¼Œä¾‹å¦‚ï¼Œå¦‚æœæ‚¨åœ¨å®‰è£… Python æ—¶è·³è¿‡å®ƒæˆ–åœ¨æŸä¸ªæ—¶å€™å¸è½½äº† <code>pip</code> ã€‚åœ¨ä¸‹é¢é€‰æ‹©æ‚¨çš„æ“ä½œç³»ç»Ÿå¹¶ç›¸åº”åœ°è¿è¡Œ <code>ensurepip</code> ï¼š</p>
<p>Windowsï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">C:<span class="se">\&gt;</span> python -m ensurepip --upgrade
</span></span></code></pre></div><p>Linux + macOSï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python3 -m ensurepip --upgrade
</span></span></code></pre></div><p>å¦‚æœå°šæœªå®‰è£… <code>pip</code> ï¼Œåˆ™æ­¤å‘½ä»¤ä¼šå°†å…¶å®‰è£…åœ¨æ‚¨å½“å‰çš„ Python ç¯å¢ƒä¸­ã€‚å¦‚æœæ‚¨å¤„äºæ´»åŠ¨çš„è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œåˆ™è¯¥å‘½ä»¤ä¼šå°† <code>pip</code> å®‰è£…åˆ°è¯¥ç¯å¢ƒä¸­ã€‚å¦åˆ™ï¼Œå®ƒä¼šåœ¨æ‚¨çš„ç³»ç»Ÿä¸Šå…¨å±€å®‰è£… <code>pip</code> ã€‚ <code>--upgrade</code> é€‰é¡¹ç¡®ä¿ <code>pip</code> ç‰ˆæœ¬ä¸ <code>ensurepip</code> ä¸­å£°æ˜çš„ç‰ˆæœ¬ç›¸åŒã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼š <code>ensurepip</code> æ¨¡å—ä¸è®¿é—®äº’è”ç½‘ã€‚ <code>ensurepip</code> å¯ä»¥å®‰è£…çš„æœ€æ–°ç‰ˆæœ¬çš„ <code>pip</code> æ˜¯æ†ç»‘åœ¨æ‚¨ç¯å¢ƒçš„ Python å®‰è£…ä¸­çš„ç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ Python 3.10.0 è¿è¡Œ <code>ensurepip</code> å°†å®‰è£… <code>pip</code> 21.2.3ã€‚å¦‚æœä½ æƒ³è¦æ›´æ–°çš„ <code>pip</code> ç‰ˆæœ¬ï¼Œé‚£ä¹ˆä½ éœ€è¦å…ˆè¿è¡Œ <code>ensurepip</code> ã€‚ä¹‹åï¼Œæ‚¨å¯ä»¥æ‰‹åŠ¨å°† <code>pip</code> æ›´æ–°åˆ°å…¶æœ€æ–°ç‰ˆæœ¬ã€‚</p>
</blockquote>
<p>ä¿®å¤ <code>pip</code> å®‰è£…çš„å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ <code>get-pip.py</code> è„šæœ¬ã€‚ <code>get-pip.py</code> æ–‡ä»¶åŒ…å«ä½œä¸ºç¼–ç  <a href="https://realpython.com/python-zip-import/">ZIP æ–‡ä»¶</a>çš„ <code>pip</code> çš„å®Œæ•´å‰¯æœ¬ã€‚æ‚¨å¯ä»¥ç›´æ¥ä» PyPA å¼•å¯¼é¡µé¢ä¸‹è½½ <code>get-pip.py</code> ã€‚ä¸€æ—¦ä½ çš„æœºå™¨ä¸Šæœ‰äº†è„šæœ¬ï¼Œä½ å°±å¯ä»¥åƒè¿™æ ·<a href="https://realpython.com/run-python-scripts/">è¿è¡Œ Python è„šæœ¬</a>ï¼š</p>
<p>Windowsï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">C:<span class="se">\&gt;</span> python get-pip.py
</span></span></code></pre></div><p>Linux + macOSï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python3 get-pip.py
</span></span></code></pre></div><p>æ­¤è„šæœ¬å°†åœ¨æ‚¨å½“å‰çš„ Python ç¯å¢ƒä¸­å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ <code>pip</code> ã€ <code>setuptools</code> å’Œ <code>wheel</code> ã€‚å¦‚æœåªæƒ³å®‰è£… <code>pip</code> ï¼Œåˆ™å¯ä»¥å°† <code>--no-setuptools</code> å’Œ <code>--no-wheel</code> é€‰é¡¹æ·»åŠ åˆ°å‘½ä»¤ä¸­ã€‚</p>
<p>å¦‚æœä¸Šè¿°æ–¹æ³•éƒ½ä¸èµ·ä½œç”¨ï¼Œé‚£ä¹ˆå¯èƒ½å€¼å¾—å°è¯•ä¸ºæ‚¨å½“å‰çš„å¹³å°ä¸‹è½½æœ€æ–°çš„ Python ç‰ˆæœ¬ã€‚æ‚¨å¯ä»¥æŒ‰ç…§ <a href="https://realpython.com/installing-python/">Python 3 å®‰è£…å’Œè®¾ç½®æŒ‡å—</a>æ¥ç¡®ä¿ <code>pip</code> å·²æ­£ç¡®å®‰è£…å¹¶ä¸”å¯ä»¥æ­£å¸¸å·¥ä½œã€‚</p>
<h2 id="ä½¿ç”¨-pip-å®‰è£…åŒ…">ä½¿ç”¨ pip å®‰è£…åŒ…</h2>
<p>Python è¢«è®¤ä¸ºæ˜¯ä¸€ç§<a href="https://www.python.org/dev/peps/pep-0206/#id3">åŒ…å«ç”µæ± </a>çš„è¯­è¨€ã€‚è¿™æ„å‘³ç€ Python æ ‡å‡†åº“åŒ…å«ä¸€ç»„å¹¿æ³›çš„åŒ…å’Œæ¨¡å—æ¥å¸®åŠ©å¼€å‘äººå‘˜å®Œæˆä»–ä»¬çš„ç¼–ç é¡¹ç›®ã€‚</p>
<p>åŒæ—¶ï¼ŒPython æœ‰ä¸€ä¸ªæ´»è·ƒçš„ç¤¾åŒºï¼Œå®ƒè´¡çŒ®äº†æ›´å¹¿æ³›çš„åŒ…é›†ï¼Œå¯ä»¥å¸®åŠ©æ‚¨æ»¡è¶³æ‚¨çš„å¼€å‘éœ€æ±‚ã€‚è¿™äº›åŒ…å‘å¸ƒåˆ° Python åŒ…ç´¢å¼•ï¼Œä¹Ÿç§°ä¸º PyPIï¼ˆå‘éŸ³ä¸º Pie Pea Eyeï¼‰ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå½“ä½ å®‰è£…ç¬¬ä¸‰æ–¹åŒ…æ—¶ï¼Œä½ å¿…é¡»å°å¿ƒã€‚æŸ¥çœ‹å¦‚ä½•è¯„ä¼° Python åŒ…çš„è´¨é‡ä»¥è·å¾—ç¡®ä¿æ‚¨çš„åŒ…å€¼å¾—ä¿¡èµ–çš„å®Œæ•´æŒ‡å—ã€‚</p>
</blockquote>
<p>PyPI æ‹¥æœ‰å¹¿æ³›çš„åŒ…é›†åˆï¼ŒåŒ…æ‹¬å¼€å‘æ¡†æ¶ã€å·¥å…·å’Œåº“ã€‚å…¶ä¸­è®¸å¤šåŒ…éƒ½ä¸º Python æ ‡å‡†åº“çš„åŠŸèƒ½æä¾›äº†å‹å¥½çš„æ¥å£ã€‚</p>
<h3 id="ä½¿ç”¨-python-åŒ…ç´¢å¼•-pypi">ä½¿ç”¨ Python åŒ…ç´¢å¼• (PyPI)</h3>
<p>PyPI æ‰˜ç®¡çš„ä¼—å¤šåŒ…ä¹‹ä¸€ç§°ä¸º <code>requests</code> ã€‚ <code>requests</code> åº“é€šè¿‡æŠ½è±¡åŒ– HTTP è¯·æ±‚çš„å¤æ‚æ€§æ¥å¸®åŠ©æ‚¨ä¸ Web æœåŠ¡äº¤äº’ã€‚æ‚¨å¯ä»¥åœ¨å…¶å®˜æ–¹æ–‡æ¡£ç«™ç‚¹ä¸Šäº†è§£æœ‰å…³ <code>requests</code> çš„æ‰€æœ‰ä¿¡æ¯ã€‚</p>
<p>å½“ä½ æƒ³åœ¨ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨ <code>requests</code> åŒ…æ—¶ï¼Œä½ å¿…é¡»å…ˆå°†å®ƒå®‰è£…åˆ°ä½ çš„ç¯å¢ƒä¸­ã€‚å¦‚æœä½ ä¸æƒ³æŠŠå®ƒå®‰è£…åœ¨ä½ çš„ç³»ç»Ÿ Python site-packages ä¸­ï¼Œé‚£ä¹ˆä½ å¯ä»¥å…ˆåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒï¼Œå¦‚ä¸Šæ‰€ç¤ºã€‚</p>
<p>åˆ›å»ºè™šæ‹Ÿç¯å¢ƒå¹¶æ¿€æ´»å®ƒåï¼Œå‘½ä»¤è¡Œæç¤ºç¬¦ä¼šåœ¨æ‹¬å·å†…æ˜¾ç¤ºè™šæ‹Ÿç¯å¢ƒçš„åç§°ã€‚æ‚¨ä»ç°åœ¨å¼€å§‹æ‰§è¡Œçš„ä»»ä½• <code>pip</code> å‘½ä»¤éƒ½å°†åœ¨æ‚¨çš„è™šæ‹Ÿç¯å¢ƒä¸­æ‰§è¡Œã€‚</p>
<p>è¦å®‰è£…åŒ…ï¼Œ <code>pip</code> æä¾›äº†ä¸€ä¸ª <code>install</code> å‘½ä»¤ã€‚æ‚¨å¯ä»¥è¿è¡Œå®ƒæ¥å®‰è£… <code>requests</code> åŒ…ï¼š</p>
<p>Windowsï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> C:<span class="se">\&gt;</span> python -m pip install requests
</span></span></code></pre></div><p>Linux + macOSï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> $ python3 -m pip install requests
</span></span></code></pre></div><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ‚¨è¿è¡Œ <code>pip</code> å’Œ <code>install</code> å‘½ä»¤ï¼Œåè·Ÿè¦å®‰è£…çš„åŒ…çš„åç§°ã€‚ <code>pip</code> å‘½ä»¤åœ¨ PyPI ä¸­æŸ¥æ‰¾åŒ…ï¼Œè§£æå…¶ä¾èµ–å…³ç³»ï¼Œå¹¶åœ¨å½“å‰ Python ç¯å¢ƒä¸­å®‰è£…æ‰€æœ‰å†…å®¹ï¼Œä»¥ç¡®ä¿ <code>requests</code> èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚</p>
<p><code>pip install &lt;package&gt;</code> å‘½ä»¤æ€»æ˜¯å¯»æ‰¾æœ€æ–°ç‰ˆæœ¬çš„åŒ…å¹¶å®‰è£…å®ƒã€‚å®ƒè¿˜æœç´¢åŒ…å…ƒæ•°æ®ä¸­åˆ—å‡ºçš„ä¾èµ–é¡¹å¹¶å®‰è£…å®ƒä»¬ä»¥ç¡®ä¿åŒ…å…·æœ‰æ‰€éœ€çš„æ‰€æœ‰è¦æ±‚ã€‚</p>
<p>ä¹Ÿå¯ä»¥åœ¨ä¸€ä¸ªå‘½ä»¤ä¸­å®‰è£…å¤šä¸ªåŒ…ï¼š</p>
<p>Windowsï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> C:<span class="se">\&gt;</span> python -m pip install rptree codetiming
</span></span></code></pre></div><p>Linux + macOSï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> $ python3 -m pip install rptree codetiming
</span></span></code></pre></div><p>é€šè¿‡åœ¨ <code>pip install</code> å‘½ä»¤ä¸­é“¾æ¥åŒ… <code>rptree</code> å’Œ <code>codetiming</code> ï¼Œæ‚¨å¯ä»¥åŒæ—¶å®‰è£…è¿™ä¸¤ä¸ªåŒ…ã€‚æ‚¨å¯ä»¥å‘ <code>pip install</code> å‘½ä»¤æ·»åŠ ä»»æ„æ•°é‡çš„åŒ…ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ <code>requirements.txt</code> æ–‡ä»¶å¯ä»¥æ´¾ä¸Šç”¨åœºã€‚åœ¨æœ¬æ•™ç¨‹çš„åé¢ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ <code>requirements.txt</code> æ–‡ä»¶ä¸€æ¬¡å®‰è£…å¤šä¸ªåŒ…ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šé™¤éåŒ…çš„ç‰¹å®šç‰ˆæœ¬å·ä¸æœ¬æ•™ç¨‹ç›¸å…³ï¼Œå¦åˆ™æ‚¨ä¼šæ³¨æ„åˆ°ç‰ˆæœ¬å­—ç¬¦ä¸²é‡‡ç”¨é€šç”¨å½¢å¼ <code>x.y.z</code> ã€‚è¿™æ˜¯ä¸€ç§å ä½ç¬¦æ ¼å¼ï¼Œå¯ä»¥ä»£è¡¨ <code>3.1.4</code> ã€ <code>2.9</code> æˆ–ä»»ä½•å…¶ä»–ç‰ˆæœ¬å·ã€‚å½“æ‚¨ç»§ç»­æ“ä½œæ—¶ï¼Œç»ˆç«¯ä¸­çš„è¾“å‡ºå°†æ˜¾ç¤ºæ‚¨çš„å®é™…åŒ…ç‰ˆæœ¬å·ã€‚</p>
</blockquote>
<p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>list</code> å‘½ä»¤æ˜¾ç¤ºç¯å¢ƒä¸­å®‰è£…çš„åŒ…åŠå…¶ç‰ˆæœ¬å·ï¼š</p>
<p>Windowsï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> C:<span class="se">\&gt;</span> python -m pip list
</span></span><span class="line"><span class="cl">Package            Version
</span></span><span class="line"><span class="cl">------------------ ---------
</span></span><span class="line"><span class="cl">certifi            x.y.z
</span></span><span class="line"><span class="cl">charset-normalizer x.y.z
</span></span><span class="line"><span class="cl">codetiming         x.y.z
</span></span><span class="line"><span class="cl">idna               x.y.z
</span></span><span class="line"><span class="cl">pip                x.y.z
</span></span><span class="line"><span class="cl">requests           x.y.z
</span></span><span class="line"><span class="cl">rptree             x.y.z
</span></span><span class="line"><span class="cl">setuptools         x.y.z
</span></span><span class="line"><span class="cl">urllib3            x.y.z
</span></span></code></pre></div><p>Linux + macOSï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> $ python3 -m pip list
</span></span><span class="line"><span class="cl">Package            Version
</span></span><span class="line"><span class="cl">------------------ ---------
</span></span><span class="line"><span class="cl">certifi            x.y.z
</span></span><span class="line"><span class="cl">charset-normalizer x.y.z
</span></span><span class="line"><span class="cl">idna               x.y.z
</span></span><span class="line"><span class="cl">pip                x.y.z
</span></span><span class="line"><span class="cl">requests           x.y.z
</span></span><span class="line"><span class="cl">setuptools         x.y.z
</span></span><span class="line"><span class="cl">urllib3            x.y.z
</span></span></code></pre></div><p><code>pip list</code> å‘½ä»¤å‘ˆç°ä¸€ä¸ªè¡¨æ ¼ï¼Œæ˜¾ç¤ºå½“å‰ç¯å¢ƒä¸­æ‰€æœ‰å·²å®‰è£…çš„åŒ…ã€‚ä¸Šé¢çš„è¾“å‡ºæ˜¾ç¤ºäº†ä½¿ç”¨ <code>x.y.z</code> å ä½ç¬¦æ ¼å¼çš„åŒ…çš„ç‰ˆæœ¬ã€‚å½“æ‚¨åœ¨æ‚¨çš„ç¯å¢ƒä¸­è¿è¡Œ <code>pip list</code> å‘½ä»¤æ—¶ï¼Œ <code>pip</code> ä¼šæ˜¾ç¤ºæ‚¨ä¸ºæ¯ä¸ªåŒ…å®‰è£…çš„ç‰¹å®šç‰ˆæœ¬å·ã€‚</p>
<p>ç°åœ¨æ‚¨å·²ç»å®‰è£…äº† <code>requests</code> åŠå…¶ä¾èµ–é¡¹ï¼Œæ‚¨å¯ä»¥åƒå¯¼å…¥ Python ä»£ç ä¸­çš„ä»»ä½•å…¶ä»–å¸¸è§„åŒ…ä¸€æ ·å¯¼å…¥å®ƒã€‚å¯åŠ¨äº¤äº’å¼ Python è§£é‡Šå™¨å¹¶å¯¼å…¥ <code>requests</code> åŒ…ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">requests</span><span class="o">.</span><span class="n">__version__</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;x.y.z&#34;</span>
</span></span></code></pre></div><p>å¯åŠ¨äº¤äº’å¼ Python è§£é‡Šå™¨åï¼Œæ‚¨å¯¼å…¥äº† <code>requests</code> æ¨¡å—ã€‚é€šè¿‡è°ƒç”¨ <code>requests.__version__</code> ï¼Œæ‚¨éªŒè¯äº†æ‚¨åœ¨è™šæ‹Ÿç¯å¢ƒä¸­ä½¿ç”¨äº† <code>requests</code> æ¨¡å—ã€‚</p>
<h3 id="ä½¿ç”¨è‡ªå®šä¹‰åŒ…ç´¢å¼•">ä½¿ç”¨è‡ªå®šä¹‰åŒ…ç´¢å¼•</h3>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ <code>pip</code> ä½¿ç”¨ PyPI æ¥æŸ¥æ‰¾åŒ…ã€‚ä½† <code>pip</code> è¿˜ä¸ºæ‚¨æä¾›äº†å®šä¹‰è‡ªå®šä¹‰åŒ…ç´¢å¼•çš„é€‰é¡¹ã€‚</p>
<p>å½“ PyPI åŸŸåœ¨æ‚¨çš„ç½‘ç»œä¸Šè¢«é˜»æ­¢æˆ–è€…å¦‚æœæ‚¨æƒ³è¦ä½¿ç”¨éå…¬å¼€å¯ç”¨çš„åŒ…æ—¶ï¼Œå°† <code>pip</code> ä¸è‡ªå®šä¹‰ç´¢å¼•ä¸€èµ·ä½¿ç”¨ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚</p>
<p>æœ‰æ—¶ç³»ç»Ÿç®¡ç†å‘˜è¿˜åˆ›å»ºè‡ªå·±çš„å†…éƒ¨åŒ…ç´¢å¼•ï¼Œä»¥æ›´å¥½åœ°æ§åˆ¶å“ªäº›åŒ…ç‰ˆæœ¬å¯ä¾›å…¬å¸ç½‘ç»œä¸Šçš„ <code>pip</code> ç”¨æˆ·ä½¿ç”¨ã€‚</p>
<p>è‡ªå®šä¹‰åŒ…ç´¢å¼•å¿…é¡»ç¬¦åˆ <a href="https://www.python.org/dev/peps/pep-0503/">PEP 503 â€“ ç®€å•å­˜å‚¨åº“ API</a> æ‰èƒ½ä¸ <code>pip</code> ä¸€èµ·ä½¿ç”¨ã€‚æ‚¨å¯ä»¥é€šè¿‡è®¿é—® <a href="https://pypi.org/simple/">PyPI ç®€å•ç´¢å¼•</a>äº†è§£è¿™æ ·ä¸€ä¸ª <a href="https://en.wikipedia.org/wiki/API">APIï¼ˆåº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼‰</a>çš„å¤–è§‚â€”â€”ä½†è¯·æ³¨æ„ï¼Œè¿™æ˜¯ä¸€ä¸ªåŒ…å«å¤§é‡éš¾ä»¥è§£æå†…å®¹çš„å¤§é¡µé¢ã€‚ä»»ä½•éµå¾ªç›¸åŒ API çš„è‡ªå®šä¹‰ç´¢å¼•éƒ½å¯ä»¥ä½¿ç”¨ <code>--index-url</code> é€‰é¡¹ä½œä¸ºç›®æ ‡ã€‚é™¤äº†è¾“å…¥ <code>--index-url</code> ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨ <code>-i</code> é€Ÿè®°ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè¦ä» TestPyPI åŒ…ç´¢å¼•å®‰è£… <code>rptree</code> å·¥å…·ï¼Œæ‚¨å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
<p>Windowsï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> C:<span class="se">\&gt;</span> python -m pip install -i https://test.pypi.org/simple/ rptree
</span></span></code></pre></div><p>Linux + macOSï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> $ python3 -m pip install -i https://test.pypi.org/simple/ rptree
</span></span></code></pre></div><p>ä½¿ç”¨ <code>-i</code> é€‰é¡¹ï¼Œæ‚¨å‘Šè¯‰ <code>pip</code> æŸ¥çœ‹ä¸åŒçš„åŒ…ç´¢å¼•è€Œä¸æ˜¯é»˜è®¤çš„ PyPIã€‚åœ¨è¿™é‡Œï¼Œæ‚¨ä» TestPyPI è€Œä¸æ˜¯ PyPI å®‰è£… <code>rptree</code> ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ TestPyPI å¾®è°ƒ Python åŒ…çš„å‘å¸ƒè¿‡ç¨‹ï¼Œè€Œä¸ä¼šå¼„ä¹± PyPI ä¸Šçš„ç”Ÿäº§åŒ…ç´¢å¼•ã€‚</p>
<p>å¦‚æœéœ€è¦æ°¸ä¹…ä½¿ç”¨æ›¿ä»£ç´¢å¼•ï¼Œåˆ™å¯ä»¥åœ¨ <code>pip</code> <a href="https://pip.pypa.io/en/stable/topics/configuration/">é…ç½®æ–‡ä»¶</a>ä¸­è®¾ç½® <code>index-url</code> é€‰é¡¹ã€‚è¯¥æ–‡ä»¶åä¸º <code>pip.conf</code> ï¼Œæ‚¨å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ‰¾åˆ°å®ƒçš„ä½ç½®ï¼š</p>
<p>Windowsï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> C:<span class="se">\&gt;</span> python -m pip config list -vv
</span></span></code></pre></div><p>Linux + macOSï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> $ python3 -m pip config list -vv
</span></span></code></pre></div><p>ä½¿ç”¨ <code>pip config list</code> å‘½ä»¤ï¼Œæ‚¨å¯ä»¥åˆ—å‡ºæ´»åŠ¨é…ç½®ã€‚å½“æ‚¨è®¾ç½®äº†è‡ªå®šä¹‰é…ç½®æ—¶ï¼Œæ­¤å‘½ä»¤ä»…è¾“å‡ºä¸€äº›å†…å®¹ã€‚å¦åˆ™ï¼Œè¾“å‡ºä¸ºç©ºã€‚è¿™å°±æ˜¯åŠ æ³• <code>--verbose</code> æˆ– <code>-vv</code> é€‰é¡¹ä¼šæœ‰æ‰€å¸®åŠ©çš„æ—¶å€™ã€‚æ·»åŠ  <code>-vv</code> æ—¶ï¼Œ <code>pip</code> ä¼šå‘æ‚¨æ˜¾ç¤ºå®ƒåœ¨ä½•å¤„æŸ¥æ‰¾ä¸åŒçš„é…ç½®çº§åˆ«ã€‚</p>
<p>å¦‚æœè¦æ·»åŠ  <code>pip.conf</code> æ–‡ä»¶ï¼Œåˆ™å¯ä»¥é€‰æ‹© <code>pip config list -vv</code> åˆ—å‡ºçš„ä½ç½®ä¹‹ä¸€ã€‚å¸¦æœ‰è‡ªå®šä¹‰åŒ…ç´¢å¼•çš„ <code>pip.conf</code> æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-toml" data-lang="toml"><span class="line"><span class="cl"><span class="c"># pip.conf</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="nx">global</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">index-url</span> <span class="p">=</span> <span class="nx">https</span><span class="err">://</span><span class="nx">test</span><span class="p">.</span><span class="nx">pypi</span><span class="p">.</span><span class="nx">org</span><span class="err">/</span><span class="nx">simple</span><span class="err">/</span>
</span></span></code></pre></div><p>å½“ä½ æœ‰ä¸€ä¸ªè¿™æ ·çš„ <code>pip.conf</code> æ–‡ä»¶æ—¶ï¼Œ <code>pip</code> å°†ä½¿ç”¨å®šä¹‰çš„ <code>index-url</code> æ¥æŸ¥æ‰¾åŒ…ã€‚ä½¿ç”¨æ­¤é…ç½®ï¼Œæ‚¨æ— éœ€åœ¨ <code>pip install</code> å‘½ä»¤ä¸­ä½¿ç”¨ <code>--index-url</code> é€‰é¡¹æ¥æŒ‡å®šæ‚¨åªéœ€è¦å¯ä»¥åœ¨ TestPyPI çš„<a href="https://test.pypi.org/simple/">ç®€å• API</a> ä¸­æ‰¾åˆ°çš„åŒ…ã€‚</p>
<h3 id="ä»-github-å­˜å‚¨åº“å®‰è£…åŒ…">ä» GitHub å­˜å‚¨åº“å®‰è£…åŒ…</h3>
<p>æ‚¨ä¸é™äºæ‰˜ç®¡åœ¨ PyPI æˆ–å…¶ä»–åŒ…ç´¢å¼•ä¸Šçš„åŒ…ã€‚ <code>pip</code> è¿˜æä¾›äº†ä» <a href="https://realpython.com/python-git-github-intro/">GitHub å­˜å‚¨åº“</a>å®‰è£…åŒ…çš„é€‰é¡¹ã€‚ä½†å³ä½¿åŒ…æ‰˜ç®¡åœ¨ PyPI ä¸Šï¼Œå¦‚ <a href="https://pypi.org/project/rptree/">Real Python ç›®å½•æ ‘ç”Ÿæˆå™¨</a>ï¼Œæ‚¨ä¹Ÿå¯ä»¥é€‰æ‹©ä»å…¶ Git å­˜å‚¨åº“å®‰è£…å®ƒï¼š</p>
<p>Windowsï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> C:<span class="se">\&gt;</span> python -m pip install git+https://github.com/realpython/rptree
</span></span></code></pre></div><p>Linux + macOSï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> $ python3 -m pip install git+https://github.com/realpython/rptree
</span></span></code></pre></div><p>ä½¿ç”¨ <code>git+https</code> æ–¹æ¡ˆï¼Œæ‚¨å¯ä»¥æŒ‡å‘åŒ…å«å¯å®‰è£…åŒ…çš„ Git å­˜å‚¨åº“ã€‚æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œäº¤äº’å¼ Python è§£é‡Šå™¨å¹¶å¯¼å…¥ <code>rptree</code> æ¥éªŒè¯æ‚¨æ˜¯å¦æ­£ç¡®å®‰è£…äº†åŒ…ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">rptree</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">rptree</span><span class="o">.</span><span class="n">__version__</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;x.y.z&#34;</span>
</span></span></code></pre></div><p>å¯åŠ¨äº¤äº’å¼ Python è§£é‡Šå™¨åï¼Œå¯¼å…¥ <code>rptree</code> æ¨¡å—ã€‚é€šè¿‡è°ƒç”¨ <code>rptree.__version__</code> ï¼Œæ‚¨å¯ä»¥éªŒè¯æ‚¨æ­£åœ¨ä½¿ç”¨åŸºäºè™šæ‹Ÿç¯å¢ƒçš„ <code>rptree</code> æ¨¡å—ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Git ä»¥å¤–çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ (VCS)ï¼Œ <code>pip</code> å¯ä»¥æ»¡è¶³æ‚¨çš„è¦æ±‚ã€‚è¦äº†è§£å¦‚ä½•å°† <code>pip</code> ä¸ Mercurialã€Subversion æˆ– Bazaar ä¸€èµ·ä½¿ç”¨ï¼Œè¯·æŸ¥çœ‹ <code>pip</code> æ–‡æ¡£çš„ VCS æ”¯æŒç« èŠ‚ã€‚</p>
</blockquote>
<p>å¦‚æœåŒ…æœªæ‰˜ç®¡åœ¨ PyPI ä¸Šä½†å…·æœ‰è¿œç¨‹ Git å­˜å‚¨åº“ï¼Œåˆ™ä» Git å­˜å‚¨åº“å®‰è£…åŒ…ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚æ‚¨æŒ‡å‘ <code>pip</code> çš„è¿œç¨‹å­˜å‚¨åº“ç”šè‡³å¯ä»¥æ‰˜ç®¡åœ¨æ‚¨å…¬å¸å†…éƒ¨ç½‘ä¸Šçš„å†…éƒ¨ Git æœåŠ¡å™¨ä¸Šã€‚å½“æ‚¨ä½äºé˜²ç«å¢™åé¢æˆ–å¯¹æ‚¨çš„ Python é¡¹ç›®æœ‰å…¶ä»–é™åˆ¶æ—¶ï¼Œè¿™ä¼šå¾ˆæœ‰ç”¨ã€‚</p>
<h3 id="ä»¥å¯ç¼–è¾‘æ¨¡å¼å®‰è£…åŒ…ä»¥ç®€åŒ–å¼€å‘">ä»¥å¯ç¼–è¾‘æ¨¡å¼å®‰è£…åŒ…ä»¥ç®€åŒ–å¼€å‘</h3>
<p>åœ¨æ‚¨è‡ªå·±çš„åŒ…ä¸Šå·¥ä½œæ—¶ï¼Œä»¥å¯ç¼–è¾‘æ¨¡å¼å®‰è£…å®ƒæ˜¯æœ‰æ„ä¹‰çš„ã€‚é€šè¿‡è¿™æ ·åšï¼Œæ‚¨å¯ä»¥åƒåœ¨ä»»ä½•å…¶ä»–åŒ…ä¸­ä¸€æ ·ä½¿ç”¨å‘½ä»¤è¡Œæ¥å¤„ç†æºä»£ç ã€‚å…¸å‹çš„å·¥ä½œæµç¨‹æ˜¯é¦–å…ˆå…‹éš†å­˜å‚¨åº“ï¼Œç„¶åä½¿ç”¨ <code>pip</code> å°†å…¶ä½œä¸ºå¯ç¼–è¾‘åŒ…å®‰è£…åœ¨æ‚¨çš„ç¯å¢ƒä¸­ï¼š</p>
<p>Windowsï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">C:<span class="se">\&gt;</span> git clone https://github.com/realpython/rptree
</span></span><span class="line"><span class="cl">C:<span class="se">\&gt;</span> <span class="nb">cd</span> rptree
</span></span><span class="line"><span class="cl">C:<span class="se">\r</span>ptree&gt; python3 -m venv venv
</span></span><span class="line"><span class="cl">C:<span class="se">\r</span>ptree&gt; venv<span class="se">\S</span>cripts<span class="se">\a</span>ctivate.bat
</span></span><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> C:<span class="se">\r</span>ptree&gt; python -m pip install -e .
</span></span></code></pre></div><p>Linux + macOSï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ git clone https://github.com/realpython/rptree
</span></span><span class="line"><span class="cl">$ <span class="nb">cd</span> rptree
</span></span><span class="line"><span class="cl">$ python3 -m venv venv
</span></span><span class="line"><span class="cl">$ <span class="nb">source</span> venv/bin/activate
</span></span><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> $ python3 -m pip install -e .
</span></span></code></pre></div><p>ä½¿ç”¨ä¸Šé¢çš„å‘½ä»¤ï¼Œæ‚¨å°† <code>rptree</code> åŒ…å®‰è£…ä¸ºå¯ç¼–è¾‘æ¨¡å—ã€‚ä»¥ä¸‹æ˜¯æ‚¨åˆšåˆšæ‰§è¡Œçš„æ“ä½œçš„é€æ­¥ç»†åˆ†ï¼š</p>
<ul>
<li>
<p>ç¬¬ 1 è¡Œå…‹éš†äº† <code>rptree</code> åŒ…çš„ Git å­˜å‚¨åº“ã€‚</p>
</li>
<li>
<p>ç¬¬ 2 è¡Œå°†å·¥ä½œç›®å½•æ›´æ”¹ä¸º <code>rptree/</code> ã€‚</p>
</li>
<li>
<p>ç¬¬ 3 è¡Œå’Œç¬¬ 4 è¡Œåˆ›å»ºå¹¶æ¿€æ´»äº†ä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒã€‚</p>
</li>
<li>
<p>ç¬¬ 5 è¡Œå°†å½“å‰ç›®å½•çš„å†…å®¹å®‰è£…ä¸ºä¸€ä¸ªå¯ç¼–è¾‘çš„åŒ…ã€‚</p>
</li>
</ul>
<p><code>-e</code> é€‰é¡¹æ˜¯ <code>--editable</code> é€‰é¡¹çš„ç®€å†™ã€‚å½“æ‚¨å°† <code>-e</code> é€‰é¡¹ä¸ <code>pip install</code> ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œæ‚¨å‘Šè¯‰ <code>pip</code> æ‚¨æƒ³è¦ä»¥å¯ç¼–è¾‘æ¨¡å¼å®‰è£…åŒ…ã€‚æ‚¨ä¸ä½¿ç”¨åŒ…åç§°ï¼Œè€Œæ˜¯ä½¿ç”¨ç‚¹ ( <code>.</code> ) å°† <code>pip</code> æŒ‡å‘å½“å‰ç›®å½•ã€‚</p>
<p>å¦‚æœæ‚¨æ²¡æœ‰ä½¿ç”¨ <code>-e</code> æ ‡å¿—ï¼Œ <code>pip</code> ä¼šæ­£å¸¸å°†åŒ…å®‰è£…åˆ°æ‚¨ç¯å¢ƒçš„ <code>site-packages/</code> æ–‡ä»¶å¤¹ä¸­ã€‚å½“æ‚¨ä»¥å¯ç¼–è¾‘æ¨¡å¼å®‰è£…åŒ…æ—¶ï¼Œæ‚¨å°†åœ¨ç«™ç‚¹åŒ…ä¸­åˆ›å»ºä¸€ä¸ªæŒ‡å‘æœ¬åœ°é¡¹ç›®è·¯å¾„çš„é“¾æ¥ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"> ~/rptree/venv/lib/python3.10/site-packages/rptree.egg-link
</span></span></code></pre></div><p>ä½¿ç”¨å¸¦æœ‰ <code>-e</code> æ ‡å¿—çš„ <code>pip install</code> å‘½ä»¤åªæ˜¯ <code>pip install</code> æä¾›çš„ä¼—å¤šé€‰é¡¹ä¹‹ä¸€ã€‚æ‚¨å¯ä»¥æŸ¥çœ‹ <code>pip</code> æ–‡æ¡£ä¸­çš„ <a href="https://pip.pypa.io/en/stable/cli/pip_install/#examples">pip install ç¤ºä¾‹</a>ã€‚åœ¨é‚£é‡Œï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•å®‰è£…åŒ…çš„ç‰¹å®šç‰ˆæœ¬æˆ–å°† <code>pip</code> æŒ‡å‘é PyPI çš„ä¸åŒç´¢å¼•ã€‚</p>
<p>åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæ‚¨å°†äº†è§£éœ€æ±‚æ–‡ä»¶å¦‚ä½•å¸®åŠ©æ‚¨å®Œæˆ <code>pip</code> å·¥ä½œæµã€‚</p>
<h2 id="ä½¿ç”¨éœ€æ±‚æ–‡ä»¶">ä½¿ç”¨éœ€æ±‚æ–‡ä»¶</h2>
<p><code>pip install</code> å‘½ä»¤å§‹ç»ˆå®‰è£…åŒ…çš„æœ€æ–°å‘å¸ƒç‰ˆæœ¬ï¼Œä½†æœ‰æ—¶æ‚¨çš„ä»£ç éœ€è¦ç‰¹å®šçš„åŒ…ç‰ˆæœ¬æ‰èƒ½æ­£å¸¸å·¥ä½œã€‚</p>
<p>æ‚¨æƒ³è¦åˆ›å»ºç”¨äºå¼€å‘å’Œæµ‹è¯•åº”ç”¨ç¨‹åºçš„ä¾èµ–é¡¹å’Œç‰ˆæœ¬çš„è§„èŒƒï¼Œä»¥ä¾¿åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨è¯¥åº”ç”¨ç¨‹åºæ—¶ä¸ä¼šå‡ºç°æ„å¤–ã€‚</p>
<h3 id="å›ºå®šéœ€æ±‚">å›ºå®šéœ€æ±‚</h3>
<p>å½“æ‚¨ä¸å…¶ä»–å¼€å‘äººå‘˜å…±äº«æ‚¨çš„ Python é¡¹ç›®æ—¶ï¼Œæ‚¨å¯èƒ½å¸Œæœ›ä»–ä»¬ä½¿ç”¨æ‚¨æ­£åœ¨ä½¿ç”¨çš„ç›¸åŒç‰ˆæœ¬çš„å¤–éƒ¨åŒ…ã€‚</p>
<p>ä¹Ÿè®¸æŸä¸ªç‰¹å®šç‰ˆæœ¬çš„è½¯ä»¶åŒ…åŒ…å«æ‚¨æ‰€ä¾èµ–çš„æ–°åŠŸèƒ½ï¼Œæˆ–è€…æ‚¨æ­£åœ¨ä½¿ç”¨çš„è½¯ä»¶åŒ…ç‰ˆæœ¬ä¸ä»¥å‰çš„ç‰ˆæœ¬ä¸å…¼å®¹ã€‚</p>
<p>è¿™äº›å¤–éƒ¨ä¾èµ–é¡¹ä¹Ÿç§°ä¸ºéœ€æ±‚ã€‚æ‚¨ç»å¸¸ä¼šå‘ç° Python é¡¹ç›®å°†å…¶éœ€æ±‚å›ºå®šåœ¨åä¸º <code>requirements.txt</code> æˆ–ç±»ä¼¼æ–‡ä»¶çš„æ–‡ä»¶ä¸­ã€‚<a href="https://pip.pypa.io/en/stable/reference/requirements-file-format/">éœ€æ±‚æ–‡ä»¶æ ¼å¼</a>å…è®¸æ‚¨ç²¾ç¡®æŒ‡å®šåº”å®‰è£…å“ªäº›åŒ…å’Œç‰ˆæœ¬ã€‚</p>
<p>è¿è¡Œ <code>pip help</code> æ˜¾ç¤ºæœ‰ä¸€ä¸ª <code>freeze</code> å‘½ä»¤ä»¥éœ€æ±‚æ ¼å¼è¾“å‡ºå·²å®‰è£…çš„åŒ…ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ­¤å‘½ä»¤ï¼Œå°†è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶ä»¥ç”Ÿæˆéœ€æ±‚æ–‡ä»¶ï¼š</p>
<p>Windowsï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> C:<span class="se">\&gt;</span> python -m pip freeze &gt; requirements.txt
</span></span></code></pre></div><p>Linux + macOSï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> $ python3 -m pip freeze &gt; requirements.txt
</span></span></code></pre></div><p>æ­¤å‘½ä»¤åœ¨æ‚¨çš„å·¥ä½œç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª <code>requirements.txt</code> æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">certifi</span><span class="o">==</span>x.y.z
</span></span><span class="line"><span class="cl">charset-normalizer<span class="o">==</span>x.y.z
</span></span><span class="line"><span class="cl"><span class="nv">idna</span><span class="o">==</span>x.y.z
</span></span><span class="line"><span class="cl"><span class="nv">requests</span><span class="o">==</span>x.y.z
</span></span><span class="line"><span class="cl"><span class="nv">urllib3</span><span class="o">==</span>x.y.z
</span></span></code></pre></div><p>è¯·è®°ä½ï¼Œä¸Šé¢æ˜¾ç¤ºçš„ <code>x.y.z</code> æ˜¯åŒ…ç‰ˆæœ¬çš„å ä½ç¬¦æ ¼å¼ã€‚æ‚¨çš„ <code>requirements.txt</code> æ–‡ä»¶å°†åŒ…å«çœŸå®çš„ç‰ˆæœ¬å·ã€‚</p>
<p><code>freeze</code> å‘½ä»¤å°†å½“å‰å®‰è£…çš„åŒ…çš„åç§°å’Œç‰ˆæœ¬è½¬å‚¨åˆ°æ ‡å‡†è¾“å‡ºã€‚æ‚¨å¯ä»¥å°†è¾“å‡ºé‡å®šå‘åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œç¨åæ‚¨å¯ä»¥ä½¿ç”¨è¯¥æ–‡ä»¶å°†æ‚¨çš„ç¡®åˆ‡è¦æ±‚å®‰è£…åˆ°å¦ä¸€ä¸ªç³»ç»Ÿä¸­ã€‚æ‚¨å¯ä»¥éšæ„å‘½åéœ€æ±‚æ–‡ä»¶ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¹¿æ³›é‡‡ç”¨çš„çº¦å®šæ˜¯å°†å…¶å‘½åä¸º <code>requirements.txt</code> ã€‚</p>
<p>å½“ä½ æƒ³åœ¨å¦ä¸€ä¸ªç³»ç»Ÿä¸­å¤åˆ¶ç¯å¢ƒæ—¶ï¼Œä½ å¯ä»¥è¿è¡Œ <code>pip install</code> ï¼Œä½¿ç”¨ <code>-r</code> å¼€å…³æ¥æŒ‡å®šéœ€æ±‚æ–‡ä»¶ï¼š</p>
<p>Windowsï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> C:<span class="se">\&gt;</span> python -m pip install -r requirements.txt
</span></span></code></pre></div><p>Linux + macOSï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">(venv) $ python3 -m pip install -r requirements.txt
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„å‘½ä»¤ä¸­ï¼Œæ‚¨å‘Šè¯‰ <code>pip</code> å°† <code>requirements.txt</code> ä¸­åˆ—å‡ºçš„åŒ…å®‰è£…åˆ°æ‚¨å½“å‰çš„ç¯å¢ƒä¸­ã€‚åŒ…ç‰ˆæœ¬å°†åŒ¹é… <code>requirements.txt</code> æ–‡ä»¶åŒ…å«çš„ç‰ˆæœ¬çº¦æŸã€‚æ‚¨å¯ä»¥è¿è¡Œ <code>pip list</code> æ¥æ˜¾ç¤ºæ‚¨åˆšåˆšå®‰è£…çš„åŒ…åŠå…¶ç‰ˆæœ¬å·ï¼š</p>
<p>Windowsï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> C:<span class="se">\&gt;</span> python -m pip list
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Package            Version
</span></span><span class="line"><span class="cl">------------------ ---------
</span></span><span class="line"><span class="cl">certifi            x.y.z
</span></span><span class="line"><span class="cl">charset-normalizer x.y.z
</span></span><span class="line"><span class="cl">idna               x.y.z
</span></span><span class="line"><span class="cl">pip                x.y.z
</span></span><span class="line"><span class="cl">requests           x.y.z
</span></span><span class="line"><span class="cl">setuptools         x.y.z
</span></span><span class="line"><span class="cl">urllib3            x.y.z
</span></span></code></pre></div><p>Linux + macOSï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> $ python3 -m pip list
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Package            Version
</span></span><span class="line"><span class="cl">------------------ ---------
</span></span><span class="line"><span class="cl">certifi            x.y.z
</span></span><span class="line"><span class="cl">charset-normalizer x.y.z
</span></span><span class="line"><span class="cl">idna               x.y.z
</span></span><span class="line"><span class="cl">pip                x.y.z
</span></span><span class="line"><span class="cl">requests           x.y.z
</span></span><span class="line"><span class="cl">setuptools         x.y.z
</span></span><span class="line"><span class="cl">urllib3            x.y.z
</span></span></code></pre></div><p>ç°åœ¨æ‚¨å¯ä»¥åˆ†äº«æ‚¨çš„é¡¹ç›®äº†ï¼æ‚¨å¯ä»¥å°† <code>requirements.txt</code> æäº¤åˆ°åƒ Git è¿™æ ·çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­ï¼Œå¹¶ä½¿ç”¨å®ƒåœ¨å…¶ä»–æœºå™¨ä¸Šå¤åˆ¶ç›¸åŒçš„ç¯å¢ƒã€‚ä½†æ˜¯ç­‰ç­‰ï¼Œå¦‚æœä¸ºè¿™äº›è½¯ä»¶åŒ…å‘å¸ƒæ–°çš„æ›´æ–°ä¼šæ€æ ·ï¼Ÿ</p>
<h3 id="å¾®è°ƒéœ€æ±‚">å¾®è°ƒéœ€æ±‚</h3>
<p>å¯¹åŒ…çš„ç‰ˆæœ¬å’Œä¾èµ–é¡¹è¿›è¡Œç¡¬ç¼–ç çš„é—®é¢˜åœ¨äºï¼ŒåŒ…ä¼šç»å¸¸æ›´æ–°é”™è¯¯å’Œå®‰å…¨ä¿®å¤ç¨‹åºã€‚æ‚¨å¯èƒ½å¸Œæœ›åœ¨æ›´æ–°å‘å¸ƒåç«‹å³åˆ©ç”¨è¿™äº›æ›´æ–°ã€‚</p>
<p>éœ€æ±‚æ–‡ä»¶æ ¼å¼å…è®¸æ‚¨ä½¿ç”¨æ¯”è¾ƒè¿ç®—ç¬¦æŒ‡å®šä¾èµ–é¡¹ç‰ˆæœ¬ï¼Œè¿™ä¸ºæ‚¨æä¾›äº†ä¸€äº›çµæ´»æ€§ï¼Œä»¥ç¡®ä¿æ›´æ–°åŒ…ï¼ŒåŒæ—¶ä»ç„¶å®šä¹‰åŒ…çš„åŸºæœ¬ç‰ˆæœ¬ã€‚</p>
<p>åœ¨æ‚¨å–œæ¬¢çš„ç¼–è¾‘å™¨ä¸­æ‰“å¼€ <code>requirements.txt</code> ï¼Œå¹¶å°†ç›¸ç­‰è¿ç®—ç¬¦ ( <code>==</code> ) è½¬æ¢ä¸ºå¤§äºæˆ–ç­‰äºè¿ç®—ç¬¦ ( <code>&gt;=</code> )ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># requirements.txt</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">certifi&gt;<span class="o">=</span>x.y.z
</span></span><span class="line"><span class="cl">charset-normalizer&gt;<span class="o">=</span>x.y.z
</span></span><span class="line"><span class="cl">idna&gt;<span class="o">=</span>x.y.z
</span></span><span class="line"><span class="cl">requests&gt;<span class="o">=</span>x.y.z
</span></span><span class="line"><span class="cl">urllib3&gt;<span class="o">=</span>x.y.z
</span></span></code></pre></div><p>æ‚¨å¯ä»¥å°†æ¯”è¾ƒè¿ç®—ç¬¦æ›´æ”¹ä¸º <code>&gt;=</code> ä»¥å‘ŠçŸ¥ <code>pip</code> å®‰è£…å·²å‘å¸ƒçš„ç²¾ç¡®æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚å½“æ‚¨ä½¿ç”¨ <code>requirements.txt</code> æ–‡ä»¶è®¾ç½®æ–°ç¯å¢ƒæ—¶ï¼Œ <code>pip</code> ä¼šæŸ¥æ‰¾æ»¡è¶³è¦æ±‚çš„æœ€æ–°ç‰ˆæœ¬å¹¶è¿›è¡Œå®‰è£…ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæ‚¨å¯ä»¥é€šè¿‡è¿è¡Œå¸¦æœ‰ <code>--upgrade</code> å¼€å…³æˆ– <code>-U</code> ç®€å†™çš„ <code>install</code> å‘½ä»¤æ¥å‡çº§éœ€æ±‚æ–‡ä»¶ä¸­çš„åŒ…ï¼š</p>
<p>Windowsï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> C:<span class="se">\&gt;</span> python -m pip install -U -r requirements.txt
</span></span></code></pre></div><p>Linux + macOSï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> $ python3 -m pip install -U -r requirements.txt
</span></span></code></pre></div><p>å¦‚æœåˆ—å‡ºçš„è½¯ä»¶åŒ…æœ‰æ–°ç‰ˆæœ¬å¯ç”¨ï¼Œåˆ™è¯¥è½¯ä»¶åŒ…å°†è¢«å‡çº§ã€‚</p>
<p>åœ¨ç†æƒ³çš„ä¸–ç•Œä¸­ï¼Œæ–°ç‰ˆæœ¬çš„åŒ…å°†å‘åå…¼å®¹å¹¶ä¸”æ°¸è¿œä¸ä¼šå¼•å…¥æ–°çš„é”™è¯¯ã€‚ä¸å¹¸çš„æ˜¯ï¼Œæ–°ç‰ˆæœ¬å¯èƒ½ä¼šå¼•å…¥ä¼šç ´åæ‚¨çš„åº”ç”¨ç¨‹åºçš„æ›´æ”¹ã€‚ä¸ºäº†å¾®è°ƒæ‚¨çš„éœ€æ±‚ï¼Œéœ€æ±‚æ–‡ä»¶è¯­æ³•æ”¯æŒé¢å¤–çš„<a href="https://www.python.org/dev/peps/pep-0440/#version-specifiers">ç‰ˆæœ¬è¯´æ˜ç¬¦</a>ã€‚</p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œ <code>requests</code> çš„æ–°ç‰ˆæœ¬ <code>3.0</code> å·²å‘å¸ƒï¼Œä½†å¼•å…¥äº†ç ´ååº”ç”¨ç¨‹åºçš„ä¸å…¼å®¹æ›´æ”¹ã€‚æ‚¨å¯ä»¥ä¿®æ”¹éœ€æ±‚æ–‡ä»¶ä»¥é˜²æ­¢å®‰è£… <code>3.0</code> æˆ–æ›´é«˜ç‰ˆæœ¬ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># requirements.txt</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">certifi</span><span class="o">==</span>x.y.z
</span></span><span class="line"><span class="cl">charset-normalizer<span class="o">==</span>x.y.z
</span></span><span class="line"><span class="cl"><span class="nv">idna</span><span class="o">==</span>x.y.z
</span></span><span class="line"><span class="cl">requests&gt;<span class="o">=</span>x.y.z, &lt;3.0
</span></span><span class="line"><span class="cl"><span class="nv">urllib3</span><span class="o">==</span>x.y.z
</span></span></code></pre></div><p>æ›´æ”¹ <code>requests</code> åŒ…çš„ç‰ˆæœ¬è¯´æ˜ç¬¦å¯ç¡®ä¿ä¸ä¼šå®‰è£…ä»»ä½•å¤§äºæˆ–ç­‰äº <code>3.0</code> çš„ç‰ˆæœ¬ã€‚ <code>pip</code> æ–‡æ¡£æä¾›äº†æœ‰å…³<a href="https://pip.pypa.io/en/stable/reference/requirements-file-format/">éœ€æ±‚æ–‡ä»¶æ ¼å¼</a>çš„å¤§é‡ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥æŸ¥é˜…å®ƒä»¥äº†è§£æ›´å¤šä¿¡æ¯ã€‚</p>
<h3 id="åˆ†ç¦»ç”Ÿäº§å’Œå¼€å‘ä¾èµ–">åˆ†ç¦»ç”Ÿäº§å’Œå¼€å‘ä¾èµ–</h3>
<p>å¹¶éæ‚¨åœ¨åº”ç”¨ç¨‹åºå¼€å‘æœŸé—´å®‰è£…çš„æ‰€æœ‰åŒ…éƒ½æ˜¯ç”Ÿäº§ä¾èµ–é¡¹ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½æƒ³è¦æµ‹è¯•æ‚¨çš„åº”ç”¨ç¨‹åºï¼Œå› æ­¤æ‚¨éœ€è¦ä¸€ä¸ªæµ‹è¯•æ¡†æ¶ã€‚ä¸€ä¸ªæµè¡Œçš„æµ‹è¯•æ¡†æ¶æ˜¯ <code>pytest</code> ã€‚ä½ æƒ³åœ¨å¼€å‘ç¯å¢ƒä¸­å®‰è£…å®ƒï¼Œä½†ä¸æƒ³åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å®‰è£…å®ƒï¼Œå› ä¸ºå®ƒä¸æ˜¯ç”Ÿäº§ä¾èµ–é¡¹ã€‚</p>
<p>æ‚¨åˆ›å»ºç¬¬äºŒä¸ªéœ€æ±‚æ–‡ä»¶ <code>requirements_dev.txt</code> ï¼Œä»¥åˆ—å‡ºç”¨äºè®¾ç½®å¼€å‘ç¯å¢ƒçš„å…¶ä»–å·¥å…·ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># requirements_dev.txt</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">pytest&gt;<span class="o">=</span>x.y.z
</span></span></code></pre></div><p>æ‹¥æœ‰ä¸¤ä¸ªéœ€æ±‚æ–‡ä»¶å°†è¦æ±‚æ‚¨ä½¿ç”¨ <code>pip</code> æ¥å®‰è£…å®ƒä»¬ï¼Œ <code>requirements.txt</code> å’Œ <code>requirements_dev.txt</code> ã€‚å¹¸è¿çš„æ˜¯ï¼Œ <code>pip</code> å…è®¸æ‚¨åœ¨éœ€æ±‚æ–‡ä»¶ä¸­æŒ‡å®šå…¶ä»–å‚æ•°ï¼Œå› æ­¤æ‚¨å¯ä»¥ä¿®æ”¹ <code>requirements_dev.txt</code> ä»¥åŒæ—¶å®‰è£…æ¥è‡ªç”Ÿäº§ç¯å¢ƒçš„ <code>requirements.txt</code> æ–‡ä»¶ä¸­çš„éœ€æ±‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># requirements_dev.txt</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-r requirements.txt
</span></span><span class="line"><span class="cl">pytest&gt;<span class="o">=</span>x.y.z
</span></span></code></pre></div><p>è¯·æ³¨æ„ï¼Œæ‚¨ä½¿ç”¨ç›¸åŒçš„ <code>-r</code> å¼€å…³æ¥å®‰è£…ç”Ÿäº§ <code>requirements.txt</code> æ–‡ä»¶ã€‚ç°åœ¨ï¼Œåœ¨æ‚¨çš„å¼€å‘ç¯å¢ƒä¸­ï¼Œæ‚¨åªéœ€è¿è¡Œè¿™æ¡å‘½ä»¤å³å¯å®‰è£…æ‰€æœ‰è¦æ±‚ï¼š</p>
<p>Windowsï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> C:<span class="se">\&gt;</span> python -m pip install -r requirements_dev.txt
</span></span></code></pre></div><p>Linux + macOSï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> $ python3 -m pip install -r requirements_dev.txt
</span></span></code></pre></div><p>å› ä¸º <code>requirements_dev.txt</code> åŒ…å« <code>-r requirements.txt</code> è¡Œï¼Œæ‰€ä»¥æ‚¨ä¸ä»…è¦å®‰è£… <code>pytest</code> ï¼Œè¿˜è¦å®‰è£… <code>requirements.txt</code> çš„å›ºå®šè¦æ±‚ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä»…å®‰è£…ç”Ÿäº§è¦æ±‚å°±è¶³å¤Ÿäº†ï¼š</p>
<p>Windowsï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> C:<span class="se">\&gt;</span> python -m pip install -r requirements.txt
</span></span></code></pre></div><p>Linux + macOSï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> $ python3 -m pip install -r requirements.txt
</span></span></code></pre></div><p>ä½¿ç”¨æ­¤å‘½ä»¤ï¼Œæ‚¨å¯ä»¥å®‰è£… <code>requirements.txt</code> ä¸­åˆ—å‡ºçš„è¦æ±‚ã€‚ä¸æ‚¨çš„å¼€å‘ç¯å¢ƒç›¸æ¯”ï¼Œæ‚¨çš„ç”Ÿäº§ç¯å¢ƒä¸ä¼šå®‰è£… <code>pytest</code> ã€‚</p>
<h3 id="ä¸ºç”Ÿäº§ç¯å¢ƒå†·å†»éœ€æ±‚">ä¸ºç”Ÿäº§ç¯å¢ƒå†·å†»éœ€æ±‚</h3>
<p>æ‚¨åˆ›å»ºäº†ç”Ÿäº§å’Œå¼€å‘éœ€æ±‚æ–‡ä»¶å¹¶å°†å®ƒä»¬æ·»åŠ åˆ°æºä»£ç ç®¡ç†ä¸­ã€‚è¿™äº›æ–‡ä»¶ä½¿ç”¨çµæ´»çš„ç‰ˆæœ¬è¯´æ˜ç¬¦æ¥ç¡®ä¿æ‚¨åˆ©ç”¨ä¾èµ–é¡¹å‘å¸ƒçš„é”™è¯¯ä¿®å¤ã€‚</p>
<p>æ‚¨è¿˜æµ‹è¯•äº†æ‚¨çš„åº”ç”¨ç¨‹åºï¼Œç°åœ¨å¯ä»¥å°†å…¶éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­äº†ã€‚</p>
<p>æ‚¨çŸ¥é“æ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡äº†å¹¶ä¸”åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨æ‚¨åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨çš„ä¾èµ–é¡¹ï¼Œå› æ­¤æ‚¨å¯èƒ½å¸Œæœ›ç¡®ä¿å°†ç›¸åŒç‰ˆæœ¬çš„ä¾èµ–é¡¹éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ã€‚</p>
<p>å½“å‰çš„ç‰ˆæœ¬è¯´æ˜ç¬¦ä¸èƒ½ä¿è¯å°†ç›¸åŒçš„ç‰ˆæœ¬éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå› æ­¤æ‚¨å¸Œæœ›åœ¨å‘å¸ƒé¡¹ç›®ä¹‹å‰å†»ç»“ç”Ÿäº§éœ€æ±‚ã€‚</p>
<p>æ ¹æ®å½“å‰éœ€æ±‚å®Œæˆå¼€å‘åï¼Œåˆ›å»ºå½“å‰é¡¹ç›®æ–°ç‰ˆæœ¬çš„å·¥ä½œæµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<table>
<thead>
<tr>
<th>Step</th>
<th>Command</th>
<th>Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><code>pytest</code></td>
<td>è¿è¡Œæ‚¨çš„æµ‹è¯•å¹¶éªŒè¯æ‚¨çš„ä»£ç æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚</td>
</tr>
<tr>
<td>2</td>
<td><code>pip install -U -r requirements.txt</code></td>
<td>å°†æ‚¨çš„è¦æ±‚å‡çº§åˆ°ä¸ <code>requirements.txt</code> æ–‡ä»¶ä¸­çš„çº¦æŸç›¸åŒ¹é…çš„ç‰ˆæœ¬ã€‚</td>
</tr>
<tr>
<td>3</td>
<td><code>pytest</code></td>
<td>è¿è¡Œæ‚¨çš„æµ‹è¯•å¹¶è€ƒè™‘é™çº§ä»»ä½•å‘æ‚¨çš„ä»£ç å¼•å…¥é”™è¯¯çš„ä¾èµ–é¡¹ã€‚</td>
</tr>
<tr>
<td>4</td>
<td><code>pip freeze &gt; requirements_lock.txt</code></td>
<td>é¡¹ç›®æ­£å¸¸è¿è¡Œåï¼Œå°†ä¾èµ–é¡¹å†»ç»“åˆ° <code>requirements_lock.txt</code> æ–‡ä»¶ä¸­ã€‚</td>
</tr>
</tbody>
</table>
<p>ä½¿ç”¨è¿™æ ·çš„å·¥ä½œæµç¨‹ï¼Œ <code>requirements_lock.txt</code> æ–‡ä»¶å°†åŒ…å«å‡†ç¡®çš„ç‰ˆæœ¬è¯´æ˜ç¬¦ï¼Œå¯ç”¨äºå¤åˆ¶æ‚¨çš„ç¯å¢ƒã€‚æ‚¨å·²ç¡®ä¿å½“æ‚¨çš„ç”¨æˆ·å°† <code>requirements_lock.txt</code> ä¸­åˆ—å‡ºçš„è½¯ä»¶åŒ…å®‰è£…åˆ°ä»–ä»¬è‡ªå·±çš„ç¯å¢ƒä¸­æ—¶ï¼Œä»–ä»¬å°†ä½¿ç”¨æ‚¨å¸Œæœ›ä»–ä»¬ä½¿ç”¨çš„ç‰ˆæœ¬ã€‚</p>
<p>å†»ç»“æ‚¨çš„éœ€æ±‚æ˜¯ç¡®ä¿æ‚¨çš„ Python é¡¹ç›®åœ¨æ‚¨çš„ç”¨æˆ·ç¯å¢ƒä¸­ä»¥ä¸åœ¨æ‚¨çš„ç¯å¢ƒä¸­ç›¸åŒçš„æ–¹å¼å·¥ä½œçš„é‡è¦æ­¥éª¤ã€‚</p>
<h2 id="ä½¿ç”¨-pip-å¸è½½è½¯ä»¶åŒ…">ä½¿ç”¨ pip å¸è½½è½¯ä»¶åŒ…</h2>
<p>æœ‰æ—¶ï¼Œæ‚¨å¿…é¡»å¸è½½ä¸€ä¸ªåŒ…ã€‚è¦ä¹ˆä½ æ‰¾åˆ°äº†ä¸€ä¸ªæ›´å¥½çš„åº“æ¥æ›¿æ¢å®ƒï¼Œè¦ä¹ˆå®ƒæ˜¯ä½ ä¸éœ€è¦çš„ä¸œè¥¿ã€‚å¸è½½è½¯ä»¶åŒ…å¯èƒ½æœ‰ç‚¹æ£˜æ‰‹ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œå½“æ‚¨å®‰è£… <code>requests</code> æ—¶ï¼Œæ‚¨ä¹Ÿè·å¾—äº† <code>pip</code> æ¥å®‰è£…å…¶ä»–ä¾èµ–é¡¹ã€‚å®‰è£…çš„åŒ…è¶Šå¤šï¼Œå¤šä¸ªåŒ…ä¾èµ–ç›¸åŒä¾èµ–é¡¹çš„å¯èƒ½æ€§å°±è¶Šå¤§ã€‚è¿™å°±æ˜¯ <code>pip</code> ä¸­çš„ <code>show</code> å‘½ä»¤æ´¾ä¸Šç”¨åœºçš„åœ°æ–¹ã€‚</p>
<p>åœ¨å¸è½½åŒ…ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä¸ºè¯¥åŒ…è¿è¡Œ <code>show</code> å‘½ä»¤ï¼š</p>
<p>Windowsï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> C:<span class="se">\&gt;</span> python -m pip show requests
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Name: requests
</span></span><span class="line"><span class="cl">Version: 2.26.0
</span></span><span class="line"><span class="cl">Summary: Python HTTP <span class="k">for</span> Humans.
</span></span><span class="line"><span class="cl">Home-page: https://requests.readthedocs.io
</span></span><span class="line"><span class="cl">Author: Kenneth Reitz
</span></span><span class="line"><span class="cl">Author-email: me@kennethreitz.org
</span></span><span class="line"><span class="cl">License: Apache 2.0
</span></span><span class="line"><span class="cl">Location: .../python3.9/site-packages
</span></span><span class="line"><span class="cl">Requires: certifi, idna, charset-normalizer, urllib3
</span></span><span class="line"><span class="cl">Required-by:
</span></span></code></pre></div><p>Linux + macOSï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> $ python3 -m pip show requests
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Name: requests
</span></span><span class="line"><span class="cl">Version: 2.26.0
</span></span><span class="line"><span class="cl">Summary: Python HTTP <span class="k">for</span> Humans.
</span></span><span class="line"><span class="cl">Home-page: https://requests.readthedocs.io
</span></span><span class="line"><span class="cl">Author: Kenneth Reitz
</span></span><span class="line"><span class="cl">Author-email: me@kennethreitz.org
</span></span><span class="line"><span class="cl">License: Apache 2.0
</span></span><span class="line"><span class="cl">Location: .../python3.9/site-packages
</span></span><span class="line"><span class="cl">Requires: certifi, idna, charset-normalizer, urllib3
</span></span><span class="line"><span class="cl">Required-by:
</span></span></code></pre></div><p>æ³¨æ„æœ€åä¸¤ä¸ªå­—æ®µï¼Œ <code>Requires</code> å’Œ <code>Required-by</code> ã€‚ <code>show</code> å‘½ä»¤å‘Šè¯‰æ‚¨ <code>requests</code> éœ€è¦ <code>certifi</code> ã€ <code>idna</code> ã€ <code>charset-normalizer</code> å’Œ <code>urllib3</code> ã€‚æ‚¨å¯èƒ½ä¹Ÿæƒ³å¸è½½å®ƒä»¬ã€‚è¯·æ³¨æ„ï¼Œ <code>requests</code> ä¸æ˜¯ä»»ä½•å…¶ä»–åŒ…æ‰€å¿…éœ€çš„ã€‚æ‰€ä»¥å¸è½½å®ƒæ˜¯å®‰å…¨çš„ã€‚</p>
<p>æ‚¨åº”è¯¥é’ˆå¯¹æ‰€æœ‰ <code>requests</code> ä¾èµ–é¡¹è¿è¡Œ <code>show</code> å‘½ä»¤ï¼Œä»¥ç¡®ä¿æ²¡æœ‰å…¶ä»–åº“ä¹Ÿä¾èµ–äºå®ƒä»¬ã€‚ä¸€æ—¦äº†è§£äº†è¦å¸è½½çš„åŒ…çš„ä¾èµ–é¡ºåºï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>uninstall</code> å‘½ä»¤åˆ é™¤å®ƒä»¬ï¼š</p>
<p>Windowsï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> C:<span class="se">\&gt;</span> python -m pip uninstall certifi
</span></span></code></pre></div><p>Linux + macOSï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> $ python3 -m pip uninstall certifi
</span></span></code></pre></div><p><code>uninstall</code> å‘½ä»¤æ˜¾ç¤ºå°†è¦åˆ é™¤çš„æ–‡ä»¶å¹¶è¦æ±‚ç¡®è®¤ã€‚å¦‚æœæ‚¨ç¡®å®šè¦åˆ é™¤è¯¥åŒ…ï¼Œå› ä¸ºæ‚¨å·²ç»æ£€æŸ¥äº†å®ƒçš„ä¾èµ–å…³ç³»å¹¶ä¸”çŸ¥é“æ²¡æœ‰å…¶ä»–ä¸œè¥¿åœ¨ä½¿ç”¨å®ƒï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥ä¼ é€’ä¸€ä¸ª <code>-y</code> å¼€å…³æ¥æŠ‘åˆ¶æ–‡ä»¶åˆ—è¡¨å’Œç¡®è®¤å¯¹è¯æ¡†ï¼š</p>
<p>Windowsï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> C:<span class="se">\&gt;</span> python -m pip uninstall certifi -y
</span></span></code></pre></div><p>Linux + macOSï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> $ python3 -m pip uninstall certifi -y
</span></span></code></pre></div><p>è¿™é‡Œå¸è½½ <code>urllib3</code> ã€‚ä½¿ç”¨ <code>-y</code> å¼€å…³ï¼Œæ‚¨å¯ä»¥å–æ¶ˆè¯¢é—®æ‚¨æ˜¯å¦è¦å¸è½½æ­¤åŒ…çš„ç¡®è®¤å¯¹è¯æ¡†ã€‚</p>
<p>åœ¨ä¸€æ¬¡è°ƒç”¨ä¸­ï¼Œæ‚¨å¯ä»¥æŒ‡å®šè¦å¸è½½çš„æ‰€æœ‰åŒ…ï¼š</p>
<p>Windowsï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> C:<span class="se">\&gt;</span> python -m pip uninstall -y charset-normalizer idna requests
</span></span></code></pre></div><p>Linux + macOSï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> $ python3 -m pip uninstall -y charset-normalizer idna requests
</span></span></code></pre></div><p>æ‚¨å¯ä»¥å°†å¤šä¸ªåŒ…ä¼ é€’ç»™ <code>pip uninstall</code> å‘½ä»¤ã€‚å¦‚æœæ‚¨æ²¡æœ‰æ·»åŠ ä»»ä½•é¢å¤–çš„å¼€å…³ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦ç¡®è®¤å¸è½½æ¯ä¸ªåŒ…ã€‚é€šè¿‡ <code>-y</code> å¼€å…³ï¼Œæ‚¨å¯ä»¥åœ¨æ²¡æœ‰ä»»ä½•ç¡®è®¤å¯¹è¯æ¡†çš„æƒ…å†µä¸‹å°†å®ƒä»¬å…¨éƒ¨å¸è½½ã€‚</p>
<p>æ‚¨è¿˜å¯ä»¥é€šè¿‡æä¾› <code>-r &lt;requirements file&gt;</code> é€‰é¡¹æ¥å¸è½½éœ€æ±‚æ–‡ä»¶ä¸­åˆ—å‡ºçš„æ‰€æœ‰åŒ…ã€‚æ­¤å‘½ä»¤å°†æç¤ºå¯¹æ¯ä¸ªåŒ…çš„ç¡®è®¤è¯·æ±‚ï¼Œä½†æ‚¨å¯ä»¥ä½¿ç”¨ <code>-y</code> å¼€å…³æŠ‘åˆ¶å®ƒï¼š</p>
<p>Windowsï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> C:<span class="se">\&gt;</span> python -m pip uninstall -r requirements.txt -y
</span></span></code></pre></div><p>Linux + macOSï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>venv<span class="o">)</span> $ python3 -m pip uninstall -r requirements.txt -y
</span></span></code></pre></div><p>è¯·è®°ä½å§‹ç»ˆæ£€æŸ¥è¦å¸è½½çš„è½¯ä»¶åŒ…çš„ä¾èµ–é¡¹ã€‚æ‚¨å¯èƒ½æƒ³å¸è½½æ‰€æœ‰ä¾èµ–é¡¹ï¼Œä½†å¸è½½å…¶ä»–äººä½¿ç”¨çš„åŒ…ä¼šç ´åæ‚¨çš„å·¥ä½œç¯å¢ƒã€‚å› æ­¤ï¼Œæ‚¨çš„é¡¹ç›®å¯èƒ½æ— æ³•å†æ­£å¸¸å·¥ä½œã€‚</p>
<p>å¦‚æœæ‚¨åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å·¥ä½œï¼Œé‚£ä¹ˆåˆ›å»ºä¸€ä¸ªæ–°çš„è™šæ‹Ÿç¯å¢ƒå¯èƒ½ä¼šæ›´çœåŠ›ã€‚ç„¶åä½ å¯ä»¥å®‰è£…ä½ éœ€è¦çš„åŒ…è€Œä¸æ˜¯å°è¯•å¸è½½ä½ ä¸éœ€è¦çš„åŒ…ã€‚ä½†æ˜¯ï¼Œå½“æ‚¨éœ€è¦ä»ç³»ç»Ÿ Python å®‰è£…ä¸­å¸è½½åŒ…æ—¶ï¼Œ <code>pip uninstall</code> ä¼šéå¸¸æœ‰ç”¨ã€‚å¦‚æœæ‚¨ä¸å°å¿ƒåœ¨ç³»ç»ŸèŒƒå›´å†…å®‰è£…äº†è½¯ä»¶åŒ…ï¼Œä½¿ç”¨ <code>pip uninstall</code> æ˜¯æ•´ç†ç³»ç»Ÿçš„å¥½æ–¹æ³•ã€‚</p>
<h2 id="æ¢ç´¢-pip-çš„æ›¿ä»£å“">æ¢ç´¢ pip çš„æ›¿ä»£å“</h2>
<p>Python ç¤¾åŒºæä¾›äº†å‡ºè‰²çš„å·¥å…·å’Œåº“ï¼Œä¾›æ‚¨åœ¨ <code>pip</code> ä¹‹å¤–ä½¿ç”¨ã€‚è¿™äº›åŒ…æ‹¬å°è¯•ç®€åŒ–å’Œæ”¹è¿›åŒ…ç®¡ç†çš„ <code>pip</code> çš„æ›¿ä»£æ–¹æ¡ˆã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›å¯ç”¨äº Python çš„å…¶ä»–åŒ…ç®¡ç†å·¥å…·ï¼š</p>
<table>
<thead>
<tr>
<th>Tool</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://conda.io/en/latest/">Conda</a></td>
<td>Conda æ˜¯è®¸å¤šè¯­è¨€ï¼ˆåŒ…æ‹¬ Pythonï¼‰çš„åŒ…ã€ä¾èµ–é¡¹å’Œç¯å¢ƒç®¡ç†å™¨ã€‚å®ƒæ¥è‡ª Anacondaï¼ŒAnaconda æœ€åˆæ˜¯ Python çš„æ•°æ®ç§‘å­¦åŒ…ã€‚å› æ­¤ï¼Œå®ƒè¢«å¹¿æ³›ç”¨äºæ•°æ®ç§‘å­¦å’Œæœºå™¨å­¦ä¹ åº”ç”¨ç¨‹åºã€‚ Conda è¿è¡Œè‡ªå·±çš„ç´¢å¼•æ¥æ‰˜ç®¡å…¼å®¹åŒ…ã€‚</td>
</tr>
<tr>
<td><a href="https://python-poetry.org/">Poetry</a></td>
<td>å¦‚æœæ‚¨æ¥è‡ª JavaScript å’Œ npmï¼ŒPoetry å¯¹æ‚¨æ¥è¯´ä¼šéå¸¸ç†Ÿæ‚‰ã€‚ Poetry è¶…è¶Šäº†åŒ…ç®¡ç†ï¼Œå¸®åŠ©æ‚¨ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºå’Œåº“æ„å»ºåˆ†å‘å¹¶å°†å®ƒä»¬éƒ¨ç½²åˆ° PyPIã€‚</td>
</tr>
<tr>
<td><a href="https://github.com/pypa/pipenv">Pipenv</a></td>
<td>Pipenv æ˜¯å¦ä¸€ä¸ªåŒ…ç®¡ç†å·¥å…·ï¼Œå®ƒå°†è™šæ‹Ÿç¯å¢ƒå’ŒåŒ…ç®¡ç†åˆå¹¶åˆ°ä¸€ä¸ªå·¥å…·ä¸­ã€‚ <a href="https://realpython.com/pipenv-guide/">Pipenvï¼šæ–° Python æ‰“åŒ…å·¥å…·æŒ‡å—</a>æ˜¯å¼€å§‹å­¦ä¹  Pipenv åŠå…¶åŒ…ç®¡ç†æ–¹æ³•çš„å¥½åœ°æ–¹ã€‚</td>
</tr>
</tbody>
</table>
<p>åªæœ‰ <code>pip</code> æ†ç»‘åœ¨æ ‡å‡† Python å®‰è£…ä¸­ã€‚å¦‚æœæ‚¨æƒ³ä½¿ç”¨ä¸Šé¢åˆ—å‡ºçš„ä»»ä½•æ›¿ä»£æ–¹æ¡ˆï¼Œåˆ™å¿…é¡»æŒ‰ç…§å…¶æ–‡æ¡£ä¸­çš„å®‰è£…æŒ‡å—è¿›è¡Œæ“ä½œã€‚æœ‰è¿™ä¹ˆå¤šé€‰é¡¹ï¼Œæ‚¨ä¸€å®šä¼šæ‰¾åˆ°é€‚åˆæ‚¨çš„ç¼–ç¨‹ä¹‹æ—…çš„å·¥å…·ï¼</p>
<h2 id="ç»“è®º">ç»“è®º</h2>
<p>è®¸å¤š Python é¡¹ç›®ä½¿ç”¨ <code>pip</code> åŒ…ç®¡ç†å™¨æ¥ç®¡ç†å®ƒä»¬çš„ä¾èµ–é¡¹ã€‚å®ƒåŒ…å«åœ¨ Python å®‰è£…ç¨‹åºä¸­ï¼Œæ˜¯ Python ä¸­ä¾èµ–ç®¡ç†çš„é‡è¦å·¥å…·ã€‚</p>
<p><strong>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å­¦ä¹ äº†å¦‚ä½•ï¼š</strong></p>
<ul>
<li>åœ¨æ‚¨çš„å·¥ä½œç¯å¢ƒä¸­è®¾ç½®å¹¶è¿è¡Œ <code>pip</code></li>
<li>ä¿®å¤ä¸ä½¿ç”¨ <code>pip</code> ç›¸å…³çš„å¸¸è§é”™è¯¯</li>
<li>ä½¿ç”¨ <code>pip</code> å®‰è£…å’Œå¸è½½åŒ…</li>
<li>å®šä¹‰é¡¹ç›®å’Œåº”ç”¨ç¨‹åºçš„è¦æ±‚</li>
<li>åœ¨éœ€æ±‚æ–‡ä»¶ä¸­å›ºå®šä¾èµ–é¡¹</li>
</ul>
<p>æ­¤å¤–ï¼Œæ‚¨è¿˜äº†è§£äº†ä½¿ä¾èµ–é¡¹ä¿æŒæœ€æ–°çš„é‡è¦æ€§ä»¥åŠå¯ä»¥å¸®åŠ©æ‚¨ç®¡ç†è¿™äº›ä¾èµ–é¡¹çš„ <code>pip</code> çš„æ›¿ä»£æ–¹æ³•ã€‚</p>
<p>é€šè¿‡ä»”ç»†æŸ¥çœ‹ <code>pip</code> ï¼Œæ‚¨å·²ç»æ¢ç´¢äº† Python å¼€å‘å·¥ä½œæµä¸­çš„ä¸€ä¸ªåŸºæœ¬å·¥å…·ã€‚ä½¿ç”¨ <code>pip</code> ï¼Œæ‚¨å¯ä»¥å®‰è£…å’Œç®¡ç†æ‚¨åœ¨ <a href="https://pypi.org/">PyPI</a> ä¸Šæ‰¾åˆ°çš„ä»»ä½•å…¶ä»–åŒ…ã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ¥è‡ªå…¶ä»–å¼€å‘äººå‘˜çš„å¤–éƒ¨åŒ…ä½œä¸ºéœ€æ±‚ï¼Œå¹¶ä¸“æ³¨äºä½¿æ‚¨çš„é¡¹ç›®ç‹¬ä¸€æ— äºŒçš„ä»£ç ã€‚</p>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://realpython.com/what-is-pip">https://realpython.com/what-is-pip</a></p>
]]></content:encoded>
    </item>
    
    <item>
      <title>å‘¨æŠ¥-21ï½œPythonä¹‹ç¦…ã€äº§å“ç»ç†è¢«ä¼˜åŒ–ã€ç«¯åˆèŠ‚é€èŠ‚</title>
      <link>https://blog.chensoul.com/posts/2023/05/31/weekly_review_21/</link>
      <pubDate>Wed, 31 May 2023 09:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/05/31/weekly_review_21/</guid>
      <description>å‰è¨€ å…¬å¸ä»·å€¼è§‚ æœ¬ç¯‡æ˜¯å¯¹ 2023-05-22 åˆ° 2023-05-28 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚ å‘¨ä¸€ï¼Œä¼‘äº§å‡çš„äº§å“ç»ç†å›æ¥ä¸Šç­ï¼Œå¾—çŸ¥å¥¹</description>
      <content:encoded><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-21-00.jpg" alt="weekly-review-21-00"  />
</p>
<p>
  <center><i>å…¬å¸ä»·å€¼è§‚</i></center>
</p>
<p>æœ¬ç¯‡æ˜¯å¯¹ <code>2023-05-22</code> åˆ° <code>2023-05-28</code> è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº <a href="https://blog.chensoul.com/">åšå®¢</a>ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚</p>
<p>å‘¨ä¸€ï¼Œä¼‘äº§å‡çš„äº§å“ç»ç†å›æ¥ä¸Šç­ï¼Œå¾—çŸ¥å¥¹è¢«ä¼˜åŒ–ä¹‹åï¼Œå†…å¿ƒæœ‰äº›ä¸èˆå’Œä¼¤æ„Ÿã€‚ä¸­åˆï¼Œç»„é•¿è¯·å¤§å®¶ä¸€èµ·åƒäº†é¥­ã€‚æ™šä¸Šï¼Œäº§å“ç»ç†äº¤å‰²å®ŒåŠå…¬ç”¨æˆ·ä¹‹åï¼Œå°±æ²¡æ¥ä¸Šç­äº†ã€‚è‡ªæ­¤ï¼Œè¿‡å®Œå¹´åï¼Œå…¬å¸è‡³å°‘æœ‰ä¸‰ä½å¥³åŒäº‹ä¿®å®Œäº§å‡ä¹‹åå°±ç¦»èŒäº†ï¼Œæœ‰çš„æ˜¯ä¸»åŠ¨ï¼Œæ›´å¤šçš„åº”è¯¥æ˜¯è¢«åŠ¨ã€‚è™½ç„¶æœ‰N+1èµ”å¿ï¼Œä½†æ˜¯ï¼Œè¿™ä¸ªç¤¾ä¼šå¯¹å¥³æ€§è¿˜æ˜¯ä¸å¤Ÿå…¬å¹³ã€‚</p>
<p>è¿˜æœ‰3ä¸ªæœˆå°±è¦åˆ°ç«¯åˆèŠ‚ï¼Œè€å©†ä¹°äº†ç²½å¶åŒ…ç²½å­ï¼Œæˆ‘ä¹ŸåŠ¨æ‰‹åŒ…äº†ä¸€éƒ¨åˆ†ã€‚è™½ç„¶åŒ…çš„ä¸å¥½çœ‹ï¼Œä½†å¿ƒé‡Œè¿˜æ˜¯å¾ˆæ»¡è¶³çš„ã€‚è‡ªå·±åŒ…çš„ç²½å­é€èŠ‚ï¼Œæ˜¾ç„¶æ›´æœ‰æ„ä¹‰ã€‚ç»“å©šä¹‹åçš„ç¬¬ä¸€ä¸ªç«¯åˆèŠ‚ï¼Œå‘¨æœ«å¼€è½¦å»ç»™é•¿è¾ˆé€äº†ç«¯åˆèŠ‚ã€‚çœ‹ç€é•¿è¾ˆä»¬çš„å¤´å‘æ—¥æ¸æ–‘ç™½ï¼Œä¸ç¦æ„Ÿå¹å²æœˆæ— æƒ…ã€‚è¶ç€å¹´è½»çš„æ—¶å€™ï¼Œè¦å¯¹èº«è¾¹çš„äº²äººå¥½ä¸€äº›ã€‚ä¸è¦ç­‰åˆ°æ¥ä¸åŠäº†æ‰çŸ¥é“åæ‚”ã€‚</p>
<p>è¿™å‘¨åœ¨ docker é‡Œéƒ¨ç½²äº† Plausible ï¼Œä½¿ç”¨è¿‡ç¨‹ä¸­å‘ç° Plausible æ¶æ„è¿‡äºå¤æ‚ï¼Œä½¿ç”¨äº† postgres å’Œ clickhouse æ•°æ®åº“ï¼Œdocker-compose å¯åŠ¨äº†4ä¸ªå®¹å™¨ï¼Œæ‰€ä»¥æœ€åè¿˜æ˜¯æ”¾å¼ƒäº†ä½¿ç”¨ Plausibleã€‚umami çš„ postgres æ•°æ®åº“åªåŒ…æ‹¬å‡ å¼ è¡¨ï¼Œæ“ä½œèµ·æ¥æ¯”è¾ƒå®¹æ˜“ï¼Œæ¯”å¦‚ï¼šæ—¶ä¸æ—¶åœ°ï¼Œæˆ‘ä¼šæŠŠæ¥è‡ª localhost çš„è®¿é—®è®°å½•åˆ é™¤æ‰ï¼Œè¿™æ ·ç»Ÿè®¡æ•°æ®æ›´åŠ çœŸå®å‡†ç¡®ã€‚</p>
<h2 id="pythonä¹‹ç¦…">Pythonä¹‹ç¦…</h2>
<p>è¿™æ˜¯æœ€è¿‘çš„ä¸€ä¸ª PyTricksï¼šåœ¨ python REPL é‡Œé¢è¾“å…¥ <code>import this</code> ä¼šè¾“å‡º <code>The Zen of Python, by Tim Peters</code>ï¼š</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-21-03.png" alt="weekly-review-21-03"  />
</p>
<p>è‹±æ–‡ï¼š</p>
<blockquote>
<p>The Zen of Python, by Tim Peters</p>
<p>Beautiful is better than ugly.</p>
<p>Explicit is better than implicit.</p>
<p>Simple is better than complex.</p>
<p>Complex is better than complicated.</p>
<p>Flat is better than nested.</p>
<p>Sparse is better than dense.</p>
<p>Readability counts.</p>
<p>Special cases aren&rsquo;t special enough to break the rules.</p>
<p>Although practicality beats purity.</p>
<p>Errors should never pass silently.</p>
<p>Unless explicitly silenced.</p>
<p>In the face of ambiguity, refuse the temptation to guess.</p>
<p>There should be one&ndash; and preferably only one &ndash;obvious way to do it.</p>
<p>Although that way may not be obvious at first unless you&rsquo;re Dutch.</p>
<p>Now is better than never.</p>
<p>Although never is often better than <em>right</em> now.</p>
<p>If the implementation is hard to explain, it&rsquo;s a bad idea.</p>
<p>If the implementation is easy to explain, it may be a good idea.</p>
<p>Namespaces are one honking great idea &ndash; let&rsquo;s do more of those!</p>
</blockquote>
<p>ä¸­æ–‡ï¼š</p>
<blockquote>
<p>Pythonä¹‹ç¦…ï¼Œä½œè€…ä¸ºTim Peters</p>
<p>ç¾ä¸½èƒœäºä¸‘é™‹ã€‚</p>
<p>æ˜ç¡®èƒœäºå«è“„ã€‚</p>
<p>ç®€å•èƒœäºå¤æ‚ã€‚</p>
<p>å¤æ‚èƒœäºç¹çã€‚</p>
<p>æ‰å¹³èƒœäºåµŒå¥—ã€‚</p>
<p>å®½æ¾èƒœäºç´§å‡‘ã€‚</p>
<p>å¯è¯»æ€§å¾ˆé‡è¦ã€‚</p>
<p>ç‰¹ä¾‹å¹¶ä¸è¶³ä»¥æ‰“ç ´è§„åˆ™ã€‚</p>
<p>è™½ç„¶å®ç”¨æ€§ä¼˜å…ˆäºçº¯ç²¹æ€§ã€‚</p>
<p>é”™è¯¯ç»ä¸èƒ½æ‚„æ‚„åœ°é€šè¿‡ã€‚</p>
<p>é™¤éæ˜ç¡®åœ°æ²‰é»˜ã€‚</p>
<p>é¢å¯¹æ¨¡æ£±ä¸¤å¯ï¼Œæ‹’ç»çŒœæµ‹ã€‚</p>
<p>åº”è¯¥æœ‰ä¸€ç§&ndash; æœ€å¥½åªæœ‰ä¸€ç§ &ndash;æ˜¾è€Œæ˜“è§çš„æ–¹æ³•æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚</p>
<p>è™½ç„¶è¿™ç§æ–¹æ³•å¯èƒ½ä¸€å¼€å§‹å¹¶ä¸æ˜æ˜¾ï¼Œé™¤éä½ æ˜¯è·å…°äººã€‚</p>
<p>ç°åœ¨æ¯”æ°¸è¿œå¥½ã€‚</p>
<p>è™½ç„¶æ°¸è¿œä¸å¦‚ <em>ç°åœ¨å°±åš</em> å¥½ã€‚</p>
<p>å¦‚æœå®ç°å¾ˆéš¾è§£é‡Šï¼Œé‚£è¿™æ˜¯ä¸ªåä¸»æ„ã€‚</p>
<p>å¦‚æœå®ç°å®¹æ˜“è§£é‡Šï¼Œé‚£å¯èƒ½æ˜¯ä¸ªå¥½ä¸»æ„ã€‚</p>
<p>åç§°ç©ºé—´æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„æƒ³æ³• &ndash; è®©æˆ‘ä»¬åšæ›´å¤šçš„è¿™æ ·çš„äº‹æƒ…ï¼</p>
</blockquote>
<p>Pythonä¹‹ç¦…æ˜¯ä¸€ç»„ç¼–å†™Pythonè¯­è¨€ç¨‹åºçš„æŒ‡å¯¼åŸåˆ™ï¼Œç”±è‘—åPythonå¼€å‘è€…Tim Petersæ’°å†™è€Œæˆï¼Œè¿™äº›æ ¼è¨€åæ˜ äº†Pythonç¤¾åŒºçš„å“²å­¦ã€‚</p>
<p>ç¬¬ä¸€åŸåˆ™â€œç¾ä¸½èƒœäºä¸‘é™‹â€å¼ºè°ƒç¼–å†™ç¾å­¦ä¸Šä»¤äººæ„‰æ‚¦ä¸”æ˜“äºé˜…è¯»çš„ä»£ç çš„é‡è¦æ€§ï¼ŒåŒ…æ‹¬ä½¿ç”¨é€‚å½“çš„ç¼©è¿›ã€å‘½åè§„èŒƒå’Œæ ¼å¼åŒ–ã€‚</p>
<p>ç¬¬äºŒåŸåˆ™â€œæ˜ç¡®èƒœäºå«è“„â€å¼ºè°ƒåœ¨ä»£ç ä¸­è¦æ¸…æ™°æ˜ç¡®ï¼Œé¿å…æ·å¾„å¹¶å°½å¯èƒ½å…·ä½“åœ°å®šä¹‰ä»£ç ã€‚</p>
<p>ç¬¬ä¸‰åŸåˆ™â€œç®€å•èƒœäºå¤æ‚â€å¼ºè°ƒç¼–å†™æ˜“äºç†è§£å’Œç»´æŠ¤çš„ä»£ç çš„é‡è¦æ€§ï¼ŒåŒ…æ‹¬é¿å…ä¸å¿…è¦çš„å¤æ‚æ€§å¹¶å°½å¯èƒ½ä½¿ç”¨ç®€å•çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>ç¬¬å››åŸåˆ™â€œå¤æ‚èƒœäºç¹çâ€å¼ºè°ƒåœ¨å¿…è¦æ—¶ä½¿ç”¨å¤æ‚çš„è§£å†³æ–¹æ¡ˆï¼Œä½†é¿å…è¿‡åº¦å¤æ‚ã€‚</p>
<p>ç¬¬äº”åŸåˆ™â€œæ‰å¹³èƒœäºåµŒå¥—â€å¼ºè°ƒä¿æŒä»£ç ç®€å•ï¼Œé¿å…æ·±åº¦åµŒå¥—ç»“æ„ã€‚</p>
<p>ç¬¬å…­åŸåˆ™â€œå®½æ¾èƒœäºç´§å‡‘â€å¼ºè°ƒä½¿ç”¨ç©ºæ ¼å’Œæ ¼å¼åŒ–ä½¿ä»£ç æ›´æ˜“è¯»ã€‚</p>
<p>ç¬¬ä¸ƒåŸåˆ™â€œå¯è¯»æ€§å¾ˆé‡è¦â€å¼ºè°ƒç¼–å†™æ˜“äºé˜…è¯»å’Œç†è§£çš„ä»£ç çš„é‡è¦æ€§ã€‚</p>
<p>ç¬¬å…«åŸåˆ™â€œç‰¹ä¾‹å¹¶ä¸è¶³ä»¥æ‰“ç ´è§„åˆ™â€å¼ºè°ƒå³ä½¿åœ¨å¯èƒ½ä¼šåç¦»è§„åˆ™çš„æƒ…å†µä¸‹ï¼Œä¹Ÿè¦éµå¾ªæœ€ä½³å®è·µå’Œå·²æœ‰çº¦å®šã€‚</p>
<p>ç¬¬ä¹åŸåˆ™â€œè™½ç„¶å®ç”¨æ€§ä¼˜å…ˆäºçº¯ç²¹æ€§â€å¼ºè°ƒå¹³è¡¡å®ç”¨è€ƒè™‘ä¸å¯¹ä¼˜é›…å’Œçº¯ç²¹ä»£ç çš„æ¸´æœ›ã€‚</p>
<p>ç¬¬ååŸåˆ™â€œé”™è¯¯ç»ä¸èƒ½æ‚„æ‚„åœ°é€šè¿‡â€å¼ºè°ƒæ•æ‰å’Œå¤„ç†ä»£ç ä¸­çš„é”™è¯¯ï¼Œè€Œä¸æ˜¯å¿½ç•¥å®ƒä»¬ã€‚</p>
<p>ç¬¬åä¸€åŸåˆ™â€œé™¤éæ˜ç¡®åœ°æ²‰é»˜â€å¼ºè°ƒåœ¨é€‚å½“æƒ…å†µä¸‹å…è®¸æœ‰æ„åœ°æ¶ˆé™¤é”™è¯¯ä¿¡æ¯ã€‚</p>
<p>ç¬¬åäºŒåŸåˆ™â€œé¢å¯¹æ¨¡æ£±ä¸¤å¯ï¼Œæ‹’ç»çŒœæµ‹â€å¼ºè°ƒè¦åœ¨ä»£ç ä¸­æ¸…æ™°æ˜ç¡®ï¼Œå³ä½¿åœ¨å­˜åœ¨æ­§ä¹‰æˆ–ä¸ç¡®å®šæ€§çš„æƒ…å†µä¸‹ä¹Ÿè¦å¦‚æ­¤ã€‚</p>
<p>ç¬¬åä¸‰åŸåˆ™â€œåº”è¯¥æœ‰ä¸€ç§&ndash; æœ€å¥½åªæœ‰ä¸€ç§ &ndash;æ˜¾è€Œæ˜“è§çš„æ–¹æ³•æ¥åšåˆ°è¿™ä¸€ç‚¹â€å¼ºè°ƒéµå¾ªå·²æœ‰çš„çº¦å®šå’Œè§„èŒƒï¼Œé¿å…ä¸å¿…è¦çš„å¤æ‚æˆ–æ›²æŠ˜çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>ç¬¬åå››åŸåˆ™â€œè™½ç„¶è¿™ç§æ–¹æ³•å¯èƒ½ä¸€å¼€å§‹å¹¶ä¸æ˜æ˜¾ï¼Œé™¤éä½ æ˜¯è·å…°äººâ€æ˜¯å¯¹Pythonçš„åˆ›å»ºè€…Guido van Rossumæ˜¯è·å…°äººè¿™ä¸€äº‹å®çš„ç©å‘³æ€§è‡´æ•¬ã€‚</p>
<p>ç¬¬åäº”åŸåˆ™â€œç°åœ¨æ¯”æ°¸è¿œå¥½â€å¼ºè°ƒé‡‡å–è¡ŒåŠ¨å¹¶æ¨è¿›ä½ çš„ä»£ç ï¼Œè€Œä¸æ˜¯æ‹–å»¶æˆ–æ‹–æ²“ã€‚</p>
<p>ç¬¬åå…­åŸåˆ™â€œè™½ç„¶æ°¸è¿œä¸å¦‚ <em>ç°åœ¨å°±åš</em> å¥½â€å¼ºè°ƒè¦èŠ±æ—¶é—´ä»”ç»†è€ƒè™‘ä½ çš„ä»£ç ï¼Œé¿å…åŒ†å¿™è§£å†³å¯èƒ½ä¸æ˜¯æœ€ä¼˜è§£çš„é—®é¢˜ã€‚</p>
<p>ç¬¬åä¸ƒåŸåˆ™â€œå¦‚æœå®ç°å¾ˆéš¾è§£é‡Šï¼Œé‚£è¿™æ˜¯ä¸ªåä¸»æ„â€å¼ºè°ƒç¼–å†™æ˜“äºç†è§£å’Œè§£é‡Šç»™ä»–äººçš„ä»£ç çš„é‡è¦æ€§ã€‚</p>
<p>ç¬¬åå…«åŸåˆ™â€œå¦‚æœå®ç°å®¹æ˜“è§£é‡Šï¼Œé‚£å¯èƒ½æ˜¯ä¸ªå¥½ä¸»æ„â€å¼ºè°ƒç¼–å†™ç®€å•æ˜äº†ã€æ˜“äºè§£é‡Šçš„ä»£ç çš„é‡è¦æ€§ã€‚</p>
<p>ç¬¬åä¹åŸåˆ™â€œåç§°ç©ºé—´æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„æƒ³æ³• &ndash; è®©æˆ‘ä»¬åšæ›´å¤šçš„è¿™æ ·çš„äº‹æƒ…ï¼â€å¼ºè°ƒä½¿ç”¨åç§°ç©ºé—´ä»¥æ¸…æ™°æ˜“æ‡‚çš„æ–¹å¼ç»„ç»‡å’Œç»“æ„åŒ–ä½ çš„ä»£ç ã€‚åç§°ç©ºé—´æœ‰åŠ©äºé¿å…å‘½åå†²çªï¼Œå¹¶ä½¿æŸ¥æ‰¾å’Œé‡ç”¨ä»£ç æ›´å®¹æ˜“ã€‚</p>
<h2 id="ç†è´¢">ç†è´¢</h2>
<p>è¿™å‘¨æ€»è®¡æ”¯å‡º 1939 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š</p>
<ul>
<li>5æœˆ28æ—¥ï¼š1064å…ƒï¼ŒåŠ æ²¹å……å€¼1000å…ƒ</li>
<li>5æœˆ27æ—¥ï¼š642å…ƒï¼Œç«¯åˆèŠ‚é€èŠ‚ä¹°é…’540å…ƒ</li>
<li>5æœˆ26æ—¥ï¼š173å…ƒ</li>
<li>5æœˆ25æ—¥ï¼š17å…ƒ</li>
<li>5æœˆ24æ—¥ï¼š7å…ƒ</li>
<li>5æœˆ23æ—¥ï¼š20å…ƒ</li>
<li>5æœˆ22æ—¥ï¼š16å…ƒ</li>
</ul>
<h2 id="å¥èº«">å¥èº«</h2>
<blockquote>
<p>æˆ‘è·‘è¿‡äº†ä¸€äº›åœ°æ–¹ï¼Œå¸Œæœ›éšç€æ—¶é—´æ¨ç§»ï¼Œåœ°å›¾ç‚¹äº®çš„åœ°æ–¹è¶Šæ¥è¶Šå¤šã€‚2 å¹´é‡Œæˆ‘è·‘è¿‡ 2ä¸ªçœä»½ 2ä¸ªåŸå¸‚ã€‚æ›´å¤šè·‘æ­¥æ•°æ®åœ¨<a href="https://run.chensoul.com/">è·‘æ­¥</a>ä¸»é¡µã€‚</p>
</blockquote>
<p>æœ¬å‘¨è·‘æ­¥ 39 å…¬é‡Œï¼Œæœ€é•¿è·‘æ­¥è·ç¦»ä¸º 6 å…¬é‡Œã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-21-05.png" alt="weekly-review-21-05"  />
</p>
<p>æ˜ç»†æ•°æ®å¦‚ä¸‹ï¼š</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-21-06.png" alt="weekly-review-21-06"  />
</p>
<p>5æœˆä»½å³å°†ç»“æŸï¼Œç›®å‰è¿™ä¸ªæœˆè·‘äº† 24å¤©ï¼Œç´¯è®¡ 178 å…¬é‡Œï¼Œæ¯” 4æœˆçš„125å…¬é‡Œå¤šäº† 53 å…¬é‡Œã€‚å†è·‘ä¸ª12å…¬é‡Œï¼Œè¿™ä¸ªæœˆè·‘æ­¥é‡Œç¨‹å°±å¯ä»¥è¾¾åˆ°190å…¬é‡Œäº†ï¼Œç»™è‡ªå·±åŠ æ²¹ï¼æœ€é•¿è¿ç»­è·‘æ­¥æ—¶é—´ä¸º 7 å¤©ï¼Œæ¯æ¬¡éƒ½æ˜¯åˆ°äº†å‘¨æœ«å°±ä¸­æ–­äº†ï¼Œæœ‰ç‚¹é—æ†¾ã€‚å›è¿‡å¤´æ¥æƒ³æƒ³ï¼Œè·‘æ­¥æ˜¯ä¸€ä¸ªé•¿æœŸçš„äº‹æƒ…ï¼Œæ¯”èµ·è·‘çš„è¿œï¼Œæ›´é‡è¦çš„æ˜¯è·‘çš„ä¹…ã€‚äº‰å–æ¯å¤©éƒ½è·‘ï¼Œä¸ç®¡è·‘å‡ å…¬é‡Œï¼Œåªè¦åšæŒä¸‹å»å°±æ˜¯æˆåŠŸã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-21-04.png" alt="weekly-review-21-04"  />
</p>
<h2 id="å·¥ä½œ">å·¥ä½œ</h2>
<p>æœ€è¿‘åœ¨å­¦ä¹ çš„å†…å®¹æ¸…å•ï¼š</p>
<ul>
<li><a href="https://github.com/clxering/Effective-Java-3rd-edition-Chinese-English-bilingual/tree/dev">Effective Javaï¼ˆç¬¬ 3 ç‰ˆï¼‰</a></li>
<li><a href="https://java-design-patterns.com/zh/">Java Design Patterns (ä¸­æ–‡)</a></li>
<li><a href="https://realpython.com/">Real Python</a></li>
</ul>
<p>æœ¬å‘¨å®Œæˆå››ç¯‡åšå®¢ï¼š</p>
<ul>
<li><a href="/posts/2023/05/26/always-override-tostring/">ã€ŠEffective Java 3ã€‹ç¬”è®°12ï¼šå½“è¦†ç›– equals æ–¹æ³•æ—¶ï¼Œæ€»è¦è¦†ç›– hashCode æ–¹æ³•</a></li>
<li><a href="/posts/2023/05/26/override-clone-judiciously/">ã€ŠEffective Java 3ã€‹ç¬”è®°13ï¼šæ˜æ™ºåœ°è¦†ç›– clone æ–¹æ³•</a></li>
<li><a href="/posts/2023/05/26/consider-implementing-comparable/">ã€ŠEffective Java 3ã€‹ç¬”è®°14ï¼šè€ƒè™‘å®ç° Comparable æ¥å£</a></li>
<li><a href="/posts/2023/05/26/java-design-patterns-active-object/">Javaè®¾è®¡æ¨¡å¼ï¼šActive Object</a></li>
</ul>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-21-07.png" alt="weekly-review-21-07"  />
</p>
<p>è‡³æ­¤ï¼Œã€ŠEffective Java 3ã€‹ç¬¬ä¸‰ç« å­¦ä¹ å®Œäº†ã€‚ç¬¬ä¸‰ç« ä»‹ç»äº†Javaä¸­å¯¹è±¡çš„åˆ›å»ºå’Œé”€æ¯ï¼Œå…¶ä¸­ç¬¬ä¸‰ç« è®²è¿°äº†æ‰€æœ‰å¯¹è±¡é€šç”¨çš„æ–¹æ³•ï¼Œä¸»è¦å†…å®¹å¦‚ä¸‹ï¼š</p>
<ol>
<li>equalsæ–¹æ³•ï¼šç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼Œéœ€è¦éµå¾ªä¸€äº›é€šç”¨çº¦å®šï¼ŒåŒ…æ‹¬è‡ªåæ€§ã€å¯¹ç§°æ€§ã€ä¼ é€’æ€§ã€ä¸€è‡´æ€§å’Œéç©ºæ€§ç­‰ã€‚</li>
<li>hashCodeæ–¹æ³•ï¼šç”¨äºè¿”å›å¯¹è±¡çš„å“ˆå¸Œç ï¼Œéœ€è¦ä¸equalsæ–¹æ³•ä¸€èµ·å®ç°ï¼Œä¿è¯ç›¸ç­‰çš„å¯¹è±¡å…·æœ‰ç›¸ç­‰çš„å“ˆå¸Œç ã€‚</li>
<li>toStringæ–¹æ³•ï¼šç”¨äºè¿”å›å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ï¼Œæ–¹ä¾¿è°ƒè¯•å’Œæ—¥å¿—è®°å½•ç­‰ã€‚</li>
<li>cloneæ–¹æ³•ï¼šç”¨äºå¤åˆ¶å¯¹è±¡ï¼Œéœ€è¦å®ç°Cloneableæ¥å£ï¼Œå¹¶è¦†ç›–Objectç±»ä¸­çš„cloneæ–¹æ³•ã€‚</li>
<li>finalizeæ–¹æ³•ï¼šç”¨äºåœ¨å¯¹è±¡è¢«åƒåœ¾å›æ”¶å‰æ‰§è¡Œä¸€äº›æ¸…ç†æ“ä½œï¼Œä½†æ˜¯è¯¥æ–¹æ³•çš„ä½¿ç”¨éå¸¸å±é™©ï¼Œåº”è¯¥å°½é‡é¿å…ä½¿ç”¨ã€‚</li>
</ol>
<p>æœ¬ç« é‡ç‚¹ä»‹ç»äº†æ‰€æœ‰å¯¹è±¡é€šç”¨çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•åœ¨Javaä¸­éå¸¸é‡è¦ï¼Œéœ€è¦ç¨‹åºå‘˜æŒæ¡ã€‚equalså’ŒhashCodeæ–¹æ³•æ˜¯ä¸€å¯¹é‡è¦çš„æ–¹æ³•ï¼Œéœ€è¦åŒæ—¶å®ç°ï¼Œä¿è¯å¯¹è±¡çš„ç›¸ç­‰å’Œå“ˆå¸Œç çš„æ­£ç¡®æ€§ã€‚toStringæ–¹æ³•å¯ä»¥æ–¹ä¾¿åœ°è¾“å‡ºå¯¹è±¡çš„ä¿¡æ¯ï¼Œæ–¹ä¾¿è°ƒè¯•å’Œæ—¥å¿—è®°å½•ç­‰ã€‚cloneæ–¹æ³•å¯ä»¥ç”¨äºå¤åˆ¶å¯¹è±¡ï¼Œä½†éœ€è¦æ³¨æ„å®ç°Cloneableæ¥å£ï¼Œå¹¶è¦†ç›–Objectç±»ä¸­çš„cloneæ–¹æ³•ã€‚æœ€åï¼Œfinalizeæ–¹æ³•è™½ç„¶å¯ä»¥ç”¨äºå¯¹è±¡æ¸…ç†ï¼Œä½†æ˜¯ä½¿ç”¨éå¸¸å±é™©ï¼Œåº”è¯¥å°½é‡é¿å…ä½¿ç”¨ã€‚</p>
<h2 id="æœ¬å‘¨åˆ†äº«">æœ¬å‘¨åˆ†äº«</h2>
<p>å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€<a href="https://t.me/chensoul_share">ChenSoul Share</a>ã€Telegram é¢‘é“æˆ–è€…æˆ‘çš„ <a href="https://memos.chensoul.com/">memos</a> ä¸­ã€‚æˆ‘å†™äº†ä¸€ä¸ª python è„šæœ¬ä» memosè¯»å–æœ€è¿‘ä¸€å‘¨çš„ memos è®°å½•ã€‚</p>
<ul>
<li>ğŸ“Œ<code>2023-05-27</code> 365èµ„è®¯ç®€æŠ¥ï¼Œæ¯å¤©ç²¾é€‰15æ¡çƒ­ç‚¹æ–°é—»ç®€æŠ¥1æ¡å¾®è¯­ï¼Œæ¯å¤©ä¸€åˆ†é’Ÿï¼ŒçŸ¥æ™“å¤©ä¸‹äº‹ï¼  2023å¹´5æœˆ26æ—¥ æ˜ŸæœŸäº” å†œå†å››æœˆåˆå…«  1ã€å·¥ä¿¡éƒ¨ç­‰åå››éƒ¨é—¨ï¼šéƒ¨ç½²æ¨è¿›æ–°ä¸€è½®ç”µä¿¡åŸºç¡€è®¾æ–½å…±å»ºå…±äº«å·¥ä½œã€‚  2ã€ä¸¤é«˜ä¸¤éƒ¨ï¼šå¯¹åœ¨æ ¡å›­ç­‰åœºæ‰€å¯¹æœªæˆå¹´äººå®æ–½çŒ¥äºµç­‰çŠ¯ç½ªçš„ï¼ŒåŠ é‡å¤„ç½šã€‚  3ã€å›½å®¶ç–¾æ§å±€ï¼š4æœˆå…¨å›½æŠ¥å‘Šæ³•å®šä¼ æŸ“ç—…è¶…210ä¸‡ä¾‹ã€‚  4ã€é›†ä½“å©šç¤¼èµ°çº¢ï¼Œæ°‘æ”¿éƒ¨æ¨è¡Œå©šä¿—æ”¹é©ï¼Œé«˜ä»·å½©ç¤¼å¾—åˆ°æœ‰æ•ˆéåˆ¶ã€‚  5ã€å¹¿ä¸œå‡ºå°åŠæ³•ï¼šå¤±ä¿¡è”åˆæƒ©æˆ’å¯¹è±¡ä¸å¾—æŠ¥åå‚åŠ äº‹ä¸šå•ä½æ‹›è˜ã€‚  6ã€åŒ—äº¬ï¼šæ–°å† è¿ç»­4å‘¨åˆ—ä¼ æŸ“ç—…æ¦œé¦–ï¼Œä¸Šå‘¨æŠ¥å‘Šå‘ç—…æ•°æ˜¯4æœˆåº•çš„è¿‘4å€ã€‚  7ã€å¤©æ´¥ï¼šåœ¨æ´¥æ— æˆ¿å®¶åº­é¦–æ¬¡å…¬ç§¯é‡‘è´·æ¬¾è¿˜æ¸…åï¼Œä»å¯æŒ‰é¦–å¥—æˆ¿è´·æ¬¾ã€‚  8ã€ä¸Šæµ·éƒ¨åˆ†ç¤¾åŒºå¼€æ‰“mRNAæ–°å† ç–«è‹—ï¼Œå¯é€šè¿‡â€œå¥åº·äº‘â€é¢„çº¦ã€‚  9ã€17çº§è¶…å¼ºå°é£&quot;ç›å¨ƒ&quot;å·²æˆä»Šå¹´ä»¥æ¥å…¨çƒé£ç‹ï¼Œä¸‹å‘¨å°†å½±å“æˆ‘å›½å—æ–¹ã€‚  10ã€é•¿åŸæ±½è½¦å…¬å¼€ä¸¾æŠ¥æ¯”äºšè¿ªï¼šä¸¤æ¬¾è½¦å‹æ±¡æŸ“ç‰©æ’æ”¾ä¸è¾¾æ ‡ï¼Œæ¯”äºšè¿ªå›åº”ï¼šæ£€æµ‹æŠ¥å‘Šæ— æ•ˆï¼Œåå¯¹ä»»ä½•å½¢å¼ä¸æ­£å½“ç«äº‰ã€‚  11ã€å¾®ä¿¡ç”µè„‘ç‰ˆæ–°å¢é”å®šåŠŸèƒ½ï¼Œåªèƒ½é€šè¿‡æ‰‹æœºç«¯è§£é”ã€‚  12ã€éŸ©è‡ªç ”è¿è½½ç«ç®­â€œä¸–ç•Œâ€å·è½½æ˜Ÿå‘å°„æˆåŠŸã€‚  13ã€é€ å‡æ•°é‡è¶…2äº¿ä»¶ï¼æœ€é•¿å¯è¿½æº¯40å¹´å‰ï¼æœ¬ç”°åˆèµ„é›¶éƒ¨ä»¶å‚å•†æ‰¿è®¤é€ å‡ã€‚  14ã€æ™®äº¬ï¼šä¿„ç½—æ–¯æ­£å‡å°‘ä¸å‹å¥½å›½å®¶è´§å¸åœ¨è´¸æ˜“ç»“ç®—ä¸­çš„ä»½é¢ã€‚  15ã€ç¾æƒ…æŠ¥æŠ«éœ²ï¼šå…‹å®«é­æ— äººæœºè¢­å‡»å¹•åé»‘æ‰‹ä¸ºä¹Œå…‹å…°ã€‚  ã€å¾®è¯­ã€‘çœŸæ­£çš„è´«ç©·ï¼Œä¸æ˜¯é‡‘é’±ä¸Šçš„åŒ®ä¹ï¼Œè€Œæ˜¯è®¤çŸ¥ä¸Šçš„è´«ç˜ ã€‚  æ–°é—»æ¥æºï¼š<a href="https://www.163.com/dy/article/I5L6PQL30534QBVQ.html?spss=dy_author">https://www.163.com/dy/article/I5L6PQL30534QBVQ.html?spss=dy_author</a>  <code>#æ¯æ—¥æ—©æŠ¥</code> <code>#memos</code></li>
<li>ğŸ“Œ<code>2023-05-26</code> 365èµ„è®¯ç®€æŠ¥ï¼Œæ¯å¤©ç²¾é€‰15æ¡çƒ­ç‚¹æ–°é—»ç®€æŠ¥1æ¡å¾®è¯­ï¼Œæ¯å¤©ä¸€åˆ†é’Ÿï¼ŒçŸ¥æ™“å¤©ä¸‹äº‹ï¼  2023å¹´5æœˆ25æ—¥ æ˜ŸæœŸå›› å†œå†å››æœˆåˆä¸ƒ  1ã€æ•™è‚²éƒ¨ï¼š2023å¹´ä¸ºä¸­è¥¿éƒ¨ä¹¡é•‡å®šå‘å…è´¹åŸ¹å…»æœ¬ç§‘åŒ»å­¦ç”Ÿ6150äººã€‚  2ã€ä¸­å›½äº’è”ç½‘åä¼šï¼šè­¦æƒ•AIæ¢è„¸æ–°éª—å±€ï¼Œè¿œç¨‹è½¬è´¦åŠ¡å¿…å¤šé‡éªŒè¯ã€‚  3ã€äº¤é€šè¿è¾“éƒ¨åœ¨å—æ²™ç¾¤å²›ç«è‰¾ç¤ã€ç‰›è½­ç¤å’Œå—è–°ç¤é™„è¿‘æµ·åŸŸå¸ƒè®¾3åº§ç¯æµ®æ ‡ã€‚  4ã€æ•°æ®æ˜¾ç¤ºï¼šä»Šå¹´ä»¥æ¥å…¨å›½å·²æœ‰è¶…40åŸè°ƒæ•´é¦–å¥—æˆ¿è´·åˆ©ç‡ä¸‹é™è‡³4%ä»¥ä¸‹ã€‚  5ã€è´¢æ”¿éƒ¨ï¼š4æœˆä»½å…¨å›½å…±é”€å”®å½©ç¥¨503.26äº¿å…ƒï¼ŒåŒæ¯”å¢é•¿62.0%ã€‚  6ã€å‰æ—çœå°å‘å…¬åŠ¡æ¥å¾…æ–°åŠæ³•ï¼šä¸å¾—å®‰æ’ç¾¤ä¼—è¿é€ï¼Œå…¬åŠ¡æ¥å¾…å·¥ä½œé¤æ¯äººä¸è¶…120å…ƒã€‚  7ã€é¦™æ¸¯ï¼šè°ƒæ•´ç­¾è¯åŠè¿›å…¥è®¸å¯ç”³è¯·æµç¨‹ï¼Œå¤–ä½£åŠå­¦ç”Ÿç­‰é¡»ç”³æŠ¥åˆ‘äº‹è®°å½•ã€‚  8ã€å¹¿ä¸œæµ·ç ï¼šä¸¾æŠ¥ç”µåŠ¨è½¦è¿›å‡ºç§Ÿå±‹å……ç”µç­‰ï¼Œæœ€é«˜å¥–åŠ±1ä¸‡å…ƒã€‚  9ã€éŸ©å›½ä¸‰å¤§è¿è¥å•†å¤¸å¤§5Gç½‘é€Ÿè¢«ç½š336äº¿éŸ©å…ƒï¼šå·ç§°20Gå®é™…800Mã€‚  10ã€51å²é©¬æ–¯å…‹å…¬å¼€å›åº”ï¼šå·²ç¡®å®šç‰¹æ–¯æ‹‰æ¥ç­äººï¼Œè‹¥æˆ‘å‡ºç°æ„å¤–ï¼Œå¯ä»¥ç¡®ä¿å…¬å¸ç»§ç»­è¿è¥ä¸‹å»ã€‚  11ã€å¾®è½¯å‘å¸ƒé‡ç£…æ›´æ–°ï¼šWindowsç³»ç»Ÿå…¨é¢æ¥å…¥AIåŠ©æ‰‹ï¼ŒChatGPTå†…ç½®å¿…åº”æœç´¢æœ€æ–°ç­”æ¡ˆã€‚  12ã€å²¸ç”°æ–‡é›„ç§°æ—¥æœ¬æ­£è€ƒè™‘è®¾ç«‹åŒ—çº¦è”ç»œå¤„ä½†ä¸ä¼šåŠ å…¥åŒ—çº¦ï¼Œä¸­æ–¹å›åº”ï¼šä¸æ¬¢è¿å†›äº‹é›†å›¢ã€‚  13ã€ä¿„ç½—æ–¯ï¼šä¿„ä¸­ä¹‹é—´70ï¼…çš„è·¨å¢ƒç»“ç®—å·²ç”¨æœ¬å¸å®Œæˆã€‚  14ã€è‹±å›½é¦–ç›¸è‹çº³å…‹æ‹’ç»åœç«å‘¼åï¼Œç§°ä¹Œå…‹å…°åº”è¯¥ç»§ç»­æˆ˜æ–—ã€‚  15ã€ä¿„åª’ï¼šä¹Œå…‹å…°æœ€é«˜å°†é¢†åœ¨ä¿„å†›æ”»å‡»ä¸­å—é‡ä¼¤ï¼Œå¯èƒ½å°†æ— æ³•ç»§ç»­æŒ‡æŒ¥ã€‚  ã€å¾®è¯­ã€‘æ”¾å¼ƒä¸éš¾ï¼Œä½†åšæŒä¸€å®šå¾ˆé…·ã€‚æ’‘ä½ï¼Œæ‰æœ‰åæ¥çš„ä¸€åˆ‡ã€‚  æ–°é—»æ¥æºï¼š<a href="https://www.163.com/dy/article/I5IJEHQK0534QBVQ.html?spss=dy_author">https://www.163.com/dy/article/I5IJEHQK0534QBVQ.html?spss=dy_author</a>  <code>#æ¯æ—¥æ—©æŠ¥</code> <code>#memos</code></li>
<li>ğŸ“Œ<code>2023-05-25</code> 365èµ„è®¯ç®€æŠ¥ï¼Œæ¯å¤©ç²¾é€‰15æ¡çƒ­ç‚¹æ–°é—»ç®€æŠ¥1æ¡å¾®è¯­ï¼Œæ¯å¤©ä¸€åˆ†é’Ÿï¼ŒçŸ¥æ™“å¤©ä¸‹äº‹ï¼  2023å¹´5æœˆ25æ—¥ æ˜ŸæœŸå›› å†œå†å››æœˆåˆä¸ƒ  1ã€æ•™è‚²éƒ¨ï¼š2023å¹´ä¸ºä¸­è¥¿éƒ¨ä¹¡é•‡å®šå‘å…è´¹åŸ¹å…»æœ¬ç§‘åŒ»å­¦ç”Ÿ6150äººã€‚  2ã€ä¸­å›½äº’è”ç½‘åä¼šï¼šè­¦æƒ•AIæ¢è„¸æ–°éª—å±€ï¼Œè¿œç¨‹è½¬è´¦åŠ¡å¿…å¤šé‡éªŒè¯ã€‚  3ã€äº¤é€šè¿è¾“éƒ¨åœ¨å—æ²™ç¾¤å²›ç«è‰¾ç¤ã€ç‰›è½­ç¤å’Œå—è–°ç¤é™„è¿‘æµ·åŸŸå¸ƒè®¾3åº§ç¯æµ®æ ‡ã€‚  4ã€æ•°æ®æ˜¾ç¤ºï¼šä»Šå¹´ä»¥æ¥å…¨å›½å·²æœ‰è¶…40åŸè°ƒæ•´é¦–å¥—æˆ¿è´·åˆ©ç‡ä¸‹é™è‡³4%ä»¥ä¸‹ã€‚  5ã€è´¢æ”¿éƒ¨ï¼š4æœˆä»½å…¨å›½å…±é”€å”®å½©ç¥¨503.26äº¿å…ƒï¼ŒåŒæ¯”å¢é•¿62.0%ã€‚  6ã€å‰æ—çœå°å‘å…¬åŠ¡æ¥å¾…æ–°åŠæ³•ï¼šä¸å¾—å®‰æ’ç¾¤ä¼—è¿é€ï¼Œå…¬åŠ¡æ¥å¾…å·¥ä½œé¤æ¯äººä¸è¶…120å…ƒã€‚  7ã€é¦™æ¸¯ï¼šè°ƒæ•´ç­¾è¯åŠè¿›å…¥è®¸å¯ç”³è¯·æµç¨‹ï¼Œå¤–ä½£åŠå­¦ç”Ÿç­‰é¡»ç”³æŠ¥åˆ‘äº‹è®°å½•ã€‚  8ã€å¹¿ä¸œæµ·ç ï¼šä¸¾æŠ¥ç”µåŠ¨è½¦è¿›å‡ºç§Ÿå±‹å……ç”µç­‰ï¼Œæœ€é«˜å¥–åŠ±1ä¸‡å…ƒã€‚  9ã€éŸ©å›½ä¸‰å¤§è¿è¥å•†å¤¸å¤§5Gç½‘é€Ÿè¢«ç½š336äº¿éŸ©å…ƒï¼šå·ç§°20Gå®é™…800Mã€‚  10ã€51å²é©¬æ–¯å…‹å…¬å¼€å›åº”ï¼šå·²ç¡®å®šç‰¹æ–¯æ‹‰æ¥ç­äººï¼Œè‹¥æˆ‘å‡ºç°æ„å¤–ï¼Œå¯ä»¥ç¡®ä¿å…¬å¸ç»§ç»­è¿è¥ä¸‹å»ã€‚  11ã€å¾®è½¯å‘å¸ƒé‡ç£…æ›´æ–°ï¼šWindowsç³»ç»Ÿå…¨é¢æ¥å…¥AIåŠ©æ‰‹ï¼ŒChatGPTå†…ç½®å¿…åº”æœç´¢æœ€æ–°ç­”æ¡ˆã€‚  12ã€å²¸ç”°æ–‡é›„ç§°æ—¥æœ¬æ­£è€ƒè™‘è®¾ç«‹åŒ—çº¦è”ç»œå¤„ä½†ä¸ä¼šåŠ å…¥åŒ—çº¦ï¼Œä¸­æ–¹å›åº”ï¼šä¸æ¬¢è¿å†›äº‹é›†å›¢ã€‚  13ã€ä¿„ç½—æ–¯ï¼šä¿„ä¸­ä¹‹é—´70ï¼…çš„è·¨å¢ƒç»“ç®—å·²ç”¨æœ¬å¸å®Œæˆã€‚  14ã€è‹±å›½é¦–ç›¸è‹çº³å…‹æ‹’ç»åœç«å‘¼åï¼Œç§°ä¹Œå…‹å…°åº”è¯¥ç»§ç»­æˆ˜æ–—ã€‚  15ã€ä¿„åª’ï¼šä¹Œå…‹å…°æœ€é«˜å°†é¢†åœ¨ä¿„å†›æ”»å‡»ä¸­å—é‡ä¼¤ï¼Œå¯èƒ½å°†æ— æ³•ç»§ç»­æŒ‡æŒ¥ã€‚  ã€å¾®è¯­ã€‘æ”¾å¼ƒä¸éš¾ï¼Œä½†åšæŒä¸€å®šå¾ˆé…·ã€‚æ’‘ä½ï¼Œæ‰æœ‰åæ¥çš„ä¸€åˆ‡ã€‚  æ–°é—»æ¥æºï¼š<a href="https://www.163.com/dy/article/I5IJEHQK0534QBVQ.html?spss=dy_author">https://www.163.com/dy/article/I5IJEHQK0534QBVQ.html?spss=dy_author</a>  <code>#æ¯æ—¥æ—©æŠ¥</code> <code>#memos</code></li>
<li>ğŸ“Œ<code>2023-05-25</code>  å‰åç«¯å‡åŸºäº vercel çš„æ¯æ—¥æ—©æŠ¥é¡¹ç›® <a href="https://icodeq.com/2022/5fe2010403bb/">https://icodeq.com/2022/5fe2010403bb/</a>  <code>#memos</code></li>
<li>ğŸ“Œ<code>2023-05-24</code> GitHub - resumejob/awesome-resume: Resumeï¼ŒResume Templatesï¼Œç¨‹åºå‘˜ç®€å†ä¾‹å¥ï¼Œç®€å†æ¨¡ç‰ˆ<code>#memos</code> <a href="https://github.com/resumejob/awesome-resume">https://github.com/resumejob/awesome-resume</a></li>
</ul>
<p>ä»¥ä¸Šã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>Javaè®¾è®¡æ¨¡å¼ï¼šActive Object</title>
      <link>https://blog.chensoul.com/posts/2023/05/26/java-design-patterns-active-object/</link>
      <pubDate>Fri, 26 May 2023 10:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/05/26/java-design-patterns-active-object/</guid>
      <description>æœ¬æ–‡ä¸»è¦ä»‹ç» Active Object æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚ Java Design Patterns æä¾›äº†å„ç§ Java è®¾è®¡</description>
      <content:encoded><![CDATA[<p>æœ¬æ–‡ä¸»è¦ä»‹ç»  Active Object æ¨¡å¼ï¼Œåœ¨ <a href="https://java-design-patterns.com/">Java Design Patterns</a>  ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚</p>
<blockquote>
<p><a href="https://java-design-patterns.com/">Java Design Patterns</a> æä¾›äº†å„ç§ Java è®¾è®¡æ¨¡å¼çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ã€‚è¯¥ç½‘ç«™æ—¨åœ¨å¸®åŠ© Java å¼€å‘äººå‘˜äº†è§£å’Œåº”ç”¨å„ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p>
<p>Java Design Patterns ç½‘ç«™æä¾›äº†å¤šç§è®¾è®¡æ¨¡å¼åˆ†ç±»æ–¹å¼ï¼ŒåŒ…æ‹¬åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational Patternsï¼‰ã€ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternsï¼‰å’Œè¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰ï¼Œä»¥åŠå…¶ä»–ä¸€äº›å¸¸è§çš„æ¨¡å¼ã€‚</p>
<p>å¯¹äºæ¯ä¸ªè®¾è®¡æ¨¡å¼ï¼Œè¯¥ç½‘ç«™æä¾›äº†è¯¦ç»†çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ï¼Œå¹¶ä¸”æä¾›äº†ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ã€‚å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©é€‚åˆè‡ªå·±çš„è®¾è®¡æ¨¡å¼ï¼Œå¹¶ä¸”å¯ä»¥å‚è€ƒç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜æ¥ç†è§£å’Œåº”ç”¨è¯¥æ¨¡å¼ã€‚</p>
<p>æ­¤å¤–ï¼ŒJava Design Patterns ç½‘ç«™è¿˜æä¾›äº†ä¸€äº›å…¶ä»–èµ„æºï¼Œå¦‚è®¾è®¡æ¨¡å¼çš„ UML å›¾ã€è®¾è®¡æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ã€è®¾è®¡æ¨¡å¼çš„æ¯”è¾ƒç­‰ã€‚è¿™äº›èµ„æºå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨è®¾è®¡æ¨¡å¼ã€‚</p>
<p>ä¸­æ–‡ç½‘ç«™ï¼š<a href="https://java-design-patterns.com/zh/">https://java-design-patterns.com/zh/</a></p>
<p>Github ä¸Šæºç ä»“åº“ï¼ˆéå®˜æ–¹ï¼‰ï¼š<a href="https://github.com/iluwatar/java-design-patterns">https://github.com/iluwatar/java-design-patterns</a></p>
</blockquote>
<h2 id="ç›®çš„">ç›®çš„</h2>
<p>æ´»åŠ¨å¯¹è±¡ï¼ˆActive Objectï¼‰æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯å°†å¹¶å‘å’Œå¼‚æ­¥å¤„ç†çš„é—®é¢˜ä»å®¢æˆ·ç«¯ä»£ç ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½ã€å¯é æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚æ´»åŠ¨å¯¹è±¡æ¨¡å¼æ˜¯ä¸€ç§èƒ½å¤Ÿå¸®åŠ©å¼€å‘äººå‘˜å¤„ç†å¤šçº¿ç¨‹ã€å¼‚æ­¥å’Œå¹¶å‘é—®é¢˜çš„è®¾è®¡æ¨¡å¼ã€‚</p>
<p>åœ¨ä¼ ç»Ÿçš„å¹¶å‘ç¼–ç¨‹æ¨¡å‹ä¸­ï¼Œå®¢æˆ·ç«¯ä»£ç éœ€è¦ç›´æ¥ç®¡ç†çº¿ç¨‹å’Œé”ç­‰ç»†èŠ‚ï¼Œè¿™æ ·ä¼šå¯¼è‡´ä»£ç å¤æ‚åº¦å’Œç»´æŠ¤æˆæœ¬çš„å¢åŠ ï¼ŒåŒæ—¶ä¹Ÿå®¹æ˜“å‡ºç°å„ç§é—®é¢˜ï¼Œå¦‚æ­»é”ã€ç«æ€æ¡ä»¶ç­‰ã€‚æ´»åŠ¨å¯¹è±¡æ¨¡å¼é€šè¿‡å¼•å…¥æ´»åŠ¨å¯¹è±¡æ¥è§£å†³è¿™äº›é—®é¢˜ï¼Œæ´»åŠ¨å¯¹è±¡å°†å®¢æˆ·ç«¯ä»£ç å‘é€çš„æ¶ˆæ¯æ·»åŠ åˆ°å†…éƒ¨çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå¹¶ä½¿ç”¨å•ç‹¬çš„çº¿ç¨‹å¼‚æ­¥å¤„ç†è¿™äº›æ¶ˆæ¯ã€‚è¿™ç§æ¨¡å¼å¯ä»¥æé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§ï¼ŒåŒæ—¶ä½¿å¾—å®¢æˆ·ç«¯ä»£ç æ›´åŠ ç®€å•å’Œæ˜“äºç»´æŠ¤ã€‚</p>
<p>æ´»åŠ¨å¯¹è±¡æ¨¡å¼çš„ç›®çš„åŒ…æ‹¬ï¼š</p>
<ol>
<li>å°†å¹¶å‘å’Œå¼‚æ­¥å¤„ç†çš„é—®é¢˜ä»å®¢æˆ·ç«¯ä»£ç ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œä»è€Œä½¿å¾—å®¢æˆ·ç«¯ä»£ç æ›´åŠ ç®€å•å’Œæ˜“äºç»´æŠ¤ã€‚å®¢æˆ·ç«¯ä»£ç åªéœ€è¦å‘é€æ¶ˆæ¯å³å¯ï¼Œä¸éœ€è¦å…³å¿ƒå¼‚æ­¥å¤„ç†çš„ç»†èŠ‚ï¼Œæ´»åŠ¨å¯¹è±¡å°†å¹¶å‘å’Œå¼‚æ­¥å¤„ç†çš„é—®é¢˜å°è£…èµ·æ¥ï¼Œæä¾›ç®€å•çš„æ¥å£ä¾›å®¢æˆ·ç«¯ä½¿ç”¨ã€‚</li>
<li>æé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§ã€‚æ´»åŠ¨å¯¹è±¡ä½¿ç”¨å•ç‹¬çš„çº¿ç¨‹æ± å¼‚æ­¥å¤„ç†æ¶ˆæ¯ï¼Œå¯ä»¥æ›´å¥½åœ°åˆ©ç”¨ç³»ç»Ÿèµ„æºï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§ã€‚</li>
<li>æé«˜ç³»ç»Ÿçš„å¯é æ€§å’Œå¥å£®æ€§ã€‚æ´»åŠ¨å¯¹è±¡å°†æ¶ˆæ¯æ·»åŠ åˆ°å†…éƒ¨çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œé¿å…äº†ç«æ€æ¡ä»¶å’Œæ­»é”ç­‰é—®é¢˜ï¼Œä»è€Œæé«˜äº†ç³»ç»Ÿçš„å¯é æ€§å’Œå¥å£®æ€§ã€‚</li>
<li>å°†å¤šçº¿ç¨‹å’Œå¼‚æ­¥å¤„ç†çš„ç»†èŠ‚å°è£…èµ·æ¥ï¼Œä½¿å¾—å®¢æˆ·ç«¯ä»£ç æ›´åŠ æŠ½è±¡å’Œé€šç”¨ã€‚å®¢æˆ·ç«¯ä»£ç å¯ä»¥ä½¿ç”¨ç›¸åŒçš„æ¥å£æ¥è®¿é—®ä¸åŒçš„æœåŠ¡ï¼Œä»è€Œæé«˜ä»£ç çš„å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</li>
</ol>
<h2 id="è§£é‡Š">è§£é‡Š</h2>
<p>æ´»åŠ¨å¯¹è±¡æ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†å¹¶å‘å’Œå¼‚æ­¥å¤„ç†çš„é—®é¢˜ä»å®¢æˆ·ç«¯ä»£ç ä¸­åˆ†ç¦»å‡ºæ¥ã€‚å…·ä½“æ¥è¯´ï¼Œæ´»åŠ¨å¯¹è±¡æ¨¡å¼åŒ…å«ä»¥ä¸‹å‡ ä¸ªå…³é”®ç»„ä»¶ï¼š</p>
<ol>
<li>æ´»åŠ¨å¯¹è±¡ï¼ˆActive Objectï¼‰ï¼šæ´»åŠ¨å¯¹è±¡æ˜¯ä¸€ä¸ªå°è£…äº†æŸç§æœåŠ¡çš„å¯¹è±¡ï¼Œå®ƒå°†å®¢æˆ·ç«¯ä»£ç å‘é€çš„æ¶ˆæ¯æ·»åŠ åˆ°å†…éƒ¨çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå¹¶ä½¿ç”¨å•ç‹¬çš„çº¿ç¨‹å¼‚æ­¥å¤„ç†è¿™äº›æ¶ˆæ¯ã€‚æ´»åŠ¨å¯¹è±¡é€šå¸¸åŒ…å«ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—å’Œä¸€ä¸ªçº¿ç¨‹æ± ï¼Œç”¨äºå¼‚æ­¥å¤„ç†æ¶ˆæ¯ã€‚</li>
<li>æ–¹æ³•è°ƒç”¨è¯·æ±‚ï¼ˆMethod Invocation Requestï¼‰ï¼šå®¢æˆ·ç«¯ä»£ç å‘æ´»åŠ¨å¯¹è±¡å‘é€æ–¹æ³•è°ƒç”¨è¯·æ±‚ï¼ŒåŒ…æ‹¬æ–¹æ³•åå’Œå‚æ•°åˆ—è¡¨ç­‰ä¿¡æ¯ã€‚æ´»åŠ¨å¯¹è±¡å°†æ–¹æ³•è°ƒç”¨è¯·æ±‚å°è£…ä¸ºä¸€ä¸ªæ¶ˆæ¯å¯¹è±¡ï¼Œå¹¶æ·»åŠ åˆ°å†…éƒ¨çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­ã€‚</li>
<li>æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessage Queueï¼‰ï¼šæ¶ˆæ¯é˜Ÿåˆ—æ˜¯æ´»åŠ¨å¯¹è±¡å†…éƒ¨ç”¨äºå­˜å‚¨æ–¹æ³•è°ƒç”¨è¯·æ±‚çš„é˜Ÿåˆ—ã€‚æ´»åŠ¨å¯¹è±¡å°†å®¢æˆ·ç«¯ä»£ç å‘é€çš„æ¶ˆæ¯æ·»åŠ åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå¹¶ä½¿ç”¨å•ç‹¬çš„çº¿ç¨‹å¼‚æ­¥å¤„ç†è¿™äº›æ¶ˆæ¯ã€‚</li>
<li>çº¿ç¨‹æ± ï¼ˆThread Poolï¼‰ï¼šçº¿ç¨‹æ± æ˜¯æ´»åŠ¨å¯¹è±¡ç”¨äºå¼‚æ­¥å¤„ç†æ¶ˆæ¯çš„çº¿ç¨‹æ± ã€‚æ´»åŠ¨å¯¹è±¡ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯ï¼Œå¹¶ä½¿ç”¨çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¼‚æ­¥å¤„ç†è¿™äº›æ¶ˆæ¯ã€‚</li>
</ol>
<p><strong>ç¨‹åºç¤ºä¾‹</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">ActiveCreature</span><span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">ActiveCreature</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;</span> <span class="n">requests</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="n">Thread</span> <span class="n">thread</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="nf">ActiveCreature</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="o">.</span><span class="na">requests</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedBlockingQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;();</span>
</span></span><span class="line"><span class="cl">    <span class="n">thread</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">              <span class="n">requests</span><span class="o">.</span><span class="na">take</span><span class="o">().</span><span class="na">run</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span> 
</span></span><span class="line"><span class="cl">              <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">          <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">thread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">eat</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">requests</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span> 
</span></span><span class="line"><span class="cl">          <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;{} is eating!&#34;</span><span class="o">,</span><span class="n">name</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">          <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;{} has finished eating!&#34;</span><span class="o">,</span><span class="n">name</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">roam</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">InterruptedException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">requests</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span> 
</span></span><span class="line"><span class="cl">          <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;{} has started to roam and the wastelands.&#34;</span><span class="o">,</span><span class="n">name</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">String</span> <span class="nf">name</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¯¥ç¤ºä¾‹ä»£ç ä¸­ï¼Œ<code>ActiveCreature</code> ç±»å°è£…äº†ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œç”¨äºå¼‚æ­¥å¤„ç†å®¢æˆ·ç«¯ä»£ç å‘é€çš„æ¶ˆæ¯ã€‚å…·ä½“æ¥è¯´ï¼Œè¯¥ç¤ºä¾‹ä»£ç åŒ…å«ä»¥ä¸‹å‡ ä¸ªå…³é”®ç»„ä»¶ï¼š</p>
<ol>
<li><code>BlockingQueue&lt;Runnable&gt;</code> ç±»å‹çš„ <code>requests</code> å±æ€§ï¼šè¯¥å±æ€§è¡¨ç¤ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œç”¨äºå­˜å‚¨å®¢æˆ·ç«¯ä»£ç å‘é€çš„æ¶ˆæ¯ã€‚å®¢æˆ·ç«¯ä»£ç å¯ä»¥é€šè¿‡ <code>eat()</code> å’Œ <code>roam()</code> æ–¹æ³•å‘æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ·»åŠ æ¶ˆæ¯ã€‚</li>
<li><code>Thread</code> ç±»å‹çš„ <code>thread</code> å±æ€§ï¼šè¯¥å±æ€§è¡¨ç¤ºæ´»åŠ¨å¯¹è±¡çš„çº¿ç¨‹ï¼Œç”¨äºå¼‚æ­¥å¤„ç†æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚</li>
<li><code>String</code> ç±»å‹çš„ <code>name</code> å±æ€§ï¼šè¯¥å±æ€§è¡¨ç¤ºæ´»åŠ¨å¯¹è±¡çš„åç§°ã€‚</li>
<li><code>ActiveCreature(String name)</code> æ„é€ æ–¹æ³•ï¼šè¯¥æ–¹æ³•ç”¨äºåˆ›å»ºä¸€ä¸ªæ´»åŠ¨å¯¹è±¡ï¼Œåˆå§‹åŒ–æ¶ˆæ¯é˜Ÿåˆ—å’Œçº¿ç¨‹ç­‰å±æ€§ã€‚åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œå¹¶ä½¿ç”¨ <code>requests.take().run()</code> ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯å¹¶å¼‚æ­¥å¤„ç†ã€‚</li>
<li><code>eat()</code> å’Œ <code>roam()</code> æ–¹æ³•ï¼šè¿™ä¸¤ä¸ªæ–¹æ³•ç”¨äºå‘æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ·»åŠ æ¶ˆæ¯ï¼Œè¡¨ç¤ºæ´»åŠ¨å¯¹è±¡æ­£åœ¨åƒå’Œæ¼«æ¸¸ã€‚åœ¨è¿™ä¸¤ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å°†ä¸€ä¸ª <code>Runnable</code> å¯¹è±¡æ·»åŠ åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå¹¶åœ¨å…¶ <code>run()</code> æ–¹æ³•ä¸­æ‰§è¡Œç›¸åº”çš„æ“ä½œï¼Œå¦‚è¾“å‡ºæ—¥å¿—ç­‰ã€‚</li>
<li><code>name()</code> æ–¹æ³•ï¼šè¯¥æ–¹æ³•ç”¨äºè·å–æ´»åŠ¨å¯¹è±¡çš„åç§°ã€‚</li>
</ol>
<p>åœ¨æ€»ä½“ä¸Šï¼Œè¯¥ç¤ºä¾‹ä»£ç å®ç°äº†æ´»åŠ¨å¯¹è±¡æ¨¡å¼çš„åŸºæœ¬åŠŸèƒ½ï¼Œå°†å¹¶å‘å’Œå¼‚æ­¥å¤„ç†çš„é—®é¢˜ä»å®¢æˆ·ç«¯ä»£ç ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå¹¶æä¾›äº†ç®€å•çš„æ¥å£ä¾›å®¢æˆ·ç«¯è°ƒç”¨ã€‚å®¢æˆ·ç«¯ä»£ç åªéœ€è¦è°ƒç”¨ <code>eat()</code> å’Œ <code>roam()</code> æ–¹æ³•å³å¯ï¼Œä¸éœ€è¦å…³å¿ƒå¼‚æ­¥å¤„ç†çš„ç»†èŠ‚ï¼Œæ´»åŠ¨å¯¹è±¡å°†å¹¶å‘å’Œå¼‚æ­¥å¤„ç†çš„é—®é¢˜å°è£…èµ·æ¥ï¼Œæä¾›ç®€å•çš„æ¥å£ä¾›å®¢æˆ·ç«¯ä½¿ç”¨ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¯¥ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†é˜»å¡é˜Ÿåˆ— <code>BlockingQueue&lt;Runnable&gt;</code> æ¥å®ç°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—æä¾›äº†çº¿ç¨‹å®‰å…¨çš„æ·»åŠ å’Œç§»é™¤æ“ä½œï¼Œä¿è¯äº†æ¶ˆæ¯çš„æœ‰åºæ€§å’Œæ­£ç¡®æ€§ã€‚åŒæ—¶ï¼Œåœ¨æ´»åŠ¨å¯¹è±¡çš„çº¿ç¨‹ä¸­ä½¿ç”¨äº† <code>requests.take().run()</code> æ“ä½œæ¥ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯å¹¶å¼‚æ­¥å¤„ç†ï¼Œè¿™ç§æ–¹å¼å¯ä»¥ä¿è¯æ¶ˆæ¯çš„æœ‰åºæ€§å’Œæ­£ç¡®æ€§ï¼Œå¹¶é¿å…äº†ç«æ€æ¡ä»¶å’Œæ­»é”ç­‰é—®é¢˜ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä»»ä½•å°†æ‰©å±•ActiveCreatureçš„ç±»éƒ½å°†å…·æœ‰è‡ªå·±çš„æ§åˆ¶çº¿ç¨‹æ¥æ‰§è¡Œå’Œè°ƒç”¨æ–¹æ³•ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå…½äººç±»ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Orc</span> <span class="kd">extends</span> <span class="n">ActiveCreature</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="nf">Orc</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">super</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºå¤šä¸ªç”Ÿç‰©ï¼Œä¾‹å¦‚å…½äººï¼Œå‘Šè¯‰ä»–ä»¬åƒä¸œè¥¿å’Œæ•£æ­¥ï¼Œç„¶åä»–ä»¬å°†åœ¨è‡ªå·±çš„æ§åˆ¶çº¿ç¨‹ä¸Šæ‰§è¡Œå®ƒï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>  
</span></span><span class="line"><span class="cl">    <span class="n">var</span> <span class="n">app</span> <span class="o">=</span> <span class="k">new</span> <span class="n">App</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">ActiveCreature</span> <span class="n">creature</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">creatures</span><span class="o">;</span><span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">creature</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Orc</span><span class="o">(</span><span class="n">Orc</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">().</span><span class="na">toString</span><span class="o">()</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">creature</span><span class="o">.</span><span class="na">eat</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">creature</span><span class="o">.</span><span class="na">roam</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span>
</span></span><span class="line"><span class="cl">      <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">1000</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">logger</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">exit</span><span class="o">(</span><span class="n">1</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span></code></pre></div><h2 id="ç±»å›¾">ç±»å›¾</h2>
<p><img loading="lazy" src="https://java-design-patterns.com/assets/active-object.urm-0bce814e.png" alt="alt text"  />
</p>
<h2 id="ä¸¾ä¾‹">ä¸¾ä¾‹</h2>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„æ´»åŠ¨å¯¹è±¡ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.concurrent.ExecutorService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.concurrent.Executors</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.concurrent.Future</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ActiveObject</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">ExecutorService</span> <span class="n">executor</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newSingleThreadExecutor</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Future</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">process</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// åˆ›å»ºä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œå¹¶å°†å…¶æäº¤åˆ°çº¿ç¨‹æ± ä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="n">executor</span><span class="o">.</span><span class="na">submit</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// æ¨¡æ‹Ÿå¤æ‚çš„å¤„ç†é€»è¾‘
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">1000</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// è¿”å›å¤„ç†ç»“æœ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">return</span> <span class="s">&#34;Processed message: &#34;</span> <span class="o">+</span> <span class="n">message</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">});</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">shutdown</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// å…³é—­çº¿ç¨‹æ± 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">executor</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œ<code>ActiveObject</code> ç±»å°è£…äº†ä¸€ä¸ªå¼‚æ­¥å¤„ç†æœåŠ¡ï¼Œå®¢æˆ·ç«¯ä»£ç å¯ä»¥ä½¿ç”¨è¯¥æœåŠ¡å¼‚æ­¥å¤„ç†æ¶ˆæ¯ã€‚<code>ActiveObject</code> ç±»ä¸­çš„ <code>process()</code> æ–¹æ³•æ¥æ”¶ä¸€ä¸ªæ¶ˆæ¯ï¼Œå¹¶å°†å…¶å°è£…ä¸ºä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œç„¶åæäº¤åˆ°çº¿ç¨‹æ± ä¸­å¼‚æ­¥å¤„ç†ã€‚<code>process()</code> æ–¹æ³•è¿”å›ä¸€ä¸ª <code>Future</code> å¯¹è±¡ï¼Œå¯ä»¥ç”¨äºè·å–å¼‚æ­¥å¤„ç†çš„ç»“æœã€‚åœ¨è¯¥ç¤ºä¾‹ä»£ç ä¸­ï¼Œå¼‚æ­¥ä»»åŠ¡åªæ˜¯ç®€å•åœ°æ¨¡æ‹Ÿäº†å¤„ç†é€»è¾‘ï¼Œå®é™…ä¸Šå¯ä»¥æ ¹æ®éœ€è¦ç¼–å†™æ›´åŠ å¤æ‚çš„å¼‚æ­¥å¤„ç†é€»è¾‘ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ <code>ActiveObject</code> ç±»çš„ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.concurrent.ExecutionException</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.concurrent.Future</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">InterruptedException</span><span class="o">,</span> <span class="n">ExecutionException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ActiveObject</span> <span class="n">activeObject</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ActiveObject</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// å‘é€æ¶ˆæ¯åˆ°æ´»åŠ¨å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">Future</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">future</span> <span class="o">=</span> <span class="n">activeObject</span><span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="s">&#34;Hello, world!&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// ç­‰å¾…å¼‚æ­¥å¤„ç†å®Œæˆï¼Œå¹¶è·å–å¤„ç†ç»“æœ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// å…³é—­æ´»åŠ¨å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">activeObject</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œå®¢æˆ·ç«¯ä»£ç ä½¿ç”¨ <code>ActiveObject</code> ç±»å¼‚æ­¥å¤„ç†äº†ä¸€æ¡æ¶ˆæ¯ï¼Œå¹¶ç­‰å¾…å¼‚æ­¥å¤„ç†å®Œæˆåè·å–å¤„ç†ç»“æœã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä½¿ç”¨ <code>ActiveObject</code> ç±»æ—¶ï¼Œå®¢æˆ·ç«¯ä»£ç åªéœ€è¦å‘é€æ¶ˆæ¯å³å¯ï¼Œä¸éœ€è¦å…³å¿ƒå¼‚æ­¥å¤„ç†çš„ç»†èŠ‚ï¼Œä»è€Œä½¿å¾—å®¢æˆ·ç«¯ä»£ç æ›´åŠ ç®€å•å’Œæ˜“äºç»´æŠ¤ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªå¤æ‚çš„æ´»åŠ¨å¯¹è±¡ç¤ºä¾‹ä»£ç ï¼Œè¯¥ä»£ç æ¨¡æ‹Ÿäº†ä¸€ä¸ªé“¶è¡Œè´¦æˆ·ç³»ç»Ÿï¼Œæ”¯æŒå­˜æ¬¾ã€å–æ¬¾å’ŒæŸ¥è¯¢ä½™é¢ç­‰æ“ä½œã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.concurrent.CompletableFuture</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.concurrent.ExecutorService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.concurrent.Executors</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BankAccount</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">ExecutorService</span> <span class="n">executor</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newSingleThreadExecutor</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">double</span> <span class="n">balance</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">BankAccount</span><span class="o">(</span><span class="kt">double</span> <span class="n">initialBalance</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">balance</span> <span class="o">=</span> <span class="n">initialBalance</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span> <span class="nf">deposit</span><span class="o">(</span><span class="kt">double</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span> <span class="n">future</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CompletableFuture</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">        <span class="n">executor</span><span class="o">.</span><span class="na">submit</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">balance</span> <span class="o">+=</span> <span class="n">amount</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">future</span><span class="o">.</span><span class="na">complete</span><span class="o">(</span><span class="n">balance</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">});</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">future</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span> <span class="nf">withdraw</span><span class="o">(</span><span class="kt">double</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span> <span class="n">future</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CompletableFuture</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">        <span class="n">executor</span><span class="o">.</span><span class="na">submit</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">balance</span> <span class="o">&gt;=</span> <span class="n">amount</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">balance</span> <span class="o">-=</span> <span class="n">amount</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="n">future</span><span class="o">.</span><span class="na">complete</span><span class="o">(</span><span class="n">balance</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">future</span><span class="o">.</span><span class="na">completeExceptionally</span><span class="o">(</span><span class="k">new</span> <span class="n">InsufficientFundsException</span><span class="o">(</span><span class="s">&#34;Insufficient funds&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">});</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">future</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span> <span class="nf">getBalance</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span> <span class="n">future</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CompletableFuture</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">        <span class="n">executor</span><span class="o">.</span><span class="na">submit</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">future</span><span class="o">.</span><span class="na">complete</span><span class="o">(</span><span class="n">balance</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">});</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">future</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">shutdown</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">executor</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">InsufficientFundsException</span> <span class="kd">extends</span> <span class="n">RuntimeException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">InsufficientFundsException</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">super</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">   <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>   
</span></span></code></pre></div><h2 id="ç¼ºç‚¹">ç¼ºç‚¹</h2>
<p>è™½ç„¶æ´»åŠ¨å¯¹è±¡æ¨¡å¼å…·æœ‰è®¸å¤šä¼˜ç‚¹ï¼Œä½†ä¹Ÿå­˜åœ¨ä¸€äº›ç¼ºç‚¹ï¼Œå¦‚ä¸‹æ‰€è¿°ï¼š</p>
<ol>
<li>å¤æ‚æ€§ï¼šæ´»åŠ¨å¯¹è±¡æ¨¡å¼éœ€è¦ä½¿ç”¨å¼‚æ­¥å¤„ç†å’Œäº‹ä»¶é©±åŠ¨æœºåˆ¶ï¼Œè¿™å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚åœ¨è®¾è®¡ã€å®ç°å’Œæµ‹è¯•æ—¶ï¼Œéœ€è¦è€ƒè™‘è®¸å¤šå› ç´ ï¼Œå¦‚å¹¶å‘æ§åˆ¶ã€é”å®šã€æ­»é”ã€çº¿ç¨‹æ± å¤§å°ã€ä»»åŠ¡é˜Ÿåˆ—å¤§å°ç­‰ã€‚</li>
<li>æ€§èƒ½ä¸‹é™ï¼šåœ¨å¤„ç†å¤§é‡è¯·æ±‚æ—¶ï¼Œæ´»åŠ¨å¯¹è±¡æ¨¡å¼å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚è¿™æ˜¯å› ä¸ºæ´»åŠ¨å¯¹è±¡æ¨¡å¼éœ€è¦åˆ›å»ºè®¸å¤šçº¿ç¨‹å’Œä»»åŠ¡ï¼Œè¿™ä¼šå¢åŠ ç³»ç»Ÿçš„è´Ÿè½½å’Œå¼€é”€ã€‚æ­¤å¤–ï¼Œå¦‚æœä»»åŠ¡é˜Ÿåˆ—æˆ–çº¿ç¨‹æ± è¿‡å¤§ï¼Œä¼šå¯¼è‡´å†…å­˜å’ŒCPUèµ„æºçš„æµªè´¹ã€‚</li>
<li>è°ƒè¯•éš¾åº¦ï¼šç”±äºæ´»åŠ¨å¯¹è±¡æ¨¡å¼ä½¿ç”¨å¼‚æ­¥å¤„ç†å’Œäº‹ä»¶é©±åŠ¨æœºåˆ¶ï¼Œå› æ­¤åœ¨è°ƒè¯•æ—¶å¯èƒ½ä¼šå‡ºç°éš¾ä»¥é¢„æµ‹çš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œå¤šä¸ªçº¿ç¨‹å¯èƒ½ä¼šåŒæ—¶è®¿é—®å…±äº«èµ„æºï¼Œå¯¼è‡´æ­»é”æˆ–ç«æ€æ¡ä»¶ï¼Œä»è€Œå¯¼è‡´åº”ç”¨ç¨‹åºå´©æºƒæˆ–å‡ºç°å…¶ä»–é—®é¢˜ã€‚</li>
<li>çŠ¶æ€ç®¡ç†ï¼šç”±äºæ´»åŠ¨å¯¹è±¡æ¨¡å¼ä½¿ç”¨å¼‚æ­¥å¤„ç†å’Œäº‹ä»¶é©±åŠ¨æœºåˆ¶ï¼Œå› æ­¤åœ¨å¤„ç†è¯·æ±‚æ—¶éœ€è¦ç®¡ç†å¯¹è±¡çš„çŠ¶æ€ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´çŠ¶æ€åŒæ­¥å’ŒçŠ¶æ€ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œä»è€Œå½±å“ç³»ç»Ÿçš„æ­£ç¡®æ€§å’Œå¯é æ€§ã€‚</li>
<li>ç¼ºä¹æ ‡å‡†åŒ–ï¼šæ´»åŠ¨å¯¹è±¡æ¨¡å¼æ²¡æœ‰æ ‡å‡†åŒ–çš„å®ç°æ–¹å¼ï¼Œå› æ­¤åœ¨ä¸åŒçš„åº”ç”¨ç¨‹åºå’Œæ¡†æ¶ä¸­å¯èƒ½ä¼šæœ‰ä¸åŒçš„å®ç°æ–¹å¼å’Œé™åˆ¶ã€‚è¿™ä½¿å¾—æ´»åŠ¨å¯¹è±¡æ¨¡å¼åœ¨ä¸åŒçš„ç¯å¢ƒä¸­éš¾ä»¥ç§»æ¤å’Œé‡ç”¨ã€‚</li>
</ol>
<p>æ€»çš„æ¥è¯´ï¼Œæ´»åŠ¨å¯¹è±¡æ¨¡å¼æ˜¯ä¸€ç§å¼ºå¤§çš„è®¾è®¡æ¨¡å¼ï¼Œå¯ä»¥ç”¨äºå®ç°å¼‚æ­¥å¤„ç†ã€äº‹ä»¶é©±åŠ¨ã€é«˜æ€§èƒ½ã€å¯ä¼¸ç¼©å’Œå¯é çš„åº”ç”¨ç¨‹åºã€‚ä½†æ˜¯ï¼Œå®ƒä¹Ÿå­˜åœ¨ä¸€äº›ç¼ºç‚¹ï¼Œéœ€è¦ä»”ç»†è€ƒè™‘å’Œæƒè¡¡ã€‚åœ¨ä½¿ç”¨æ´»åŠ¨å¯¹è±¡æ¨¡å¼æ—¶ï¼Œéœ€è¦å…³æ³¨ç³»ç»Ÿçš„å¤æ‚æ€§ã€æ€§èƒ½ã€è°ƒè¯•éš¾åº¦ã€çŠ¶æ€ç®¡ç†å’Œæ ‡å‡†åŒ–ç­‰é—®é¢˜ã€‚</p>
<h2 id="åº”ç”¨">åº”ç”¨</h2>
<h3 id="åœ¨å¼€æºæ¡†æ¶ä¸­çš„åº”ç”¨">åœ¨å¼€æºæ¡†æ¶ä¸­çš„åº”ç”¨</h3>
<p>æ´»åŠ¨å¯¹è±¡è®¾è®¡æ¨¡å¼åœ¨è®¸å¤šå¼€æºæ¡†æ¶ä¸­éƒ½å¾—åˆ°äº†å¹¿æ³›åº”ç”¨ï¼Œä»¥ä¸‹æ˜¯å‡ ä¸ªå¸¸è§çš„ä¾‹å­ï¼š</p>
<ol>
<li>Akkaæ¡†æ¶ï¼šAkkaæ˜¯ä¸€ä¸ªè½»é‡çº§çš„Actoræ¨¡å‹æ¡†æ¶ï¼Œé€šè¿‡å°†å¹¶å‘å’Œå¼‚æ­¥å¤„ç†çš„é—®é¢˜ä»å®¢æˆ·ç«¯ä»£ç ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œæé«˜äº†ç³»ç»Ÿçš„æ€§èƒ½ã€å¯é æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚åœ¨Akkaä¸­ï¼Œæ¯ä¸ªActoréƒ½æ˜¯ä¸€ä¸ªæ´»åŠ¨å¯¹è±¡ï¼Œé€šè¿‡æ¶ˆæ¯ä¼ é€’çš„æ–¹å¼è¿›è¡Œé€šä¿¡å’Œåä½œã€‚Akkaæä¾›äº†ä¸°å¯Œçš„APIå’Œå·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿åœ°åˆ›å»ºå’Œç®¡ç†Actorï¼Œå®ç°é«˜æ€§èƒ½å’Œå¯æ‰©å±•çš„ç³»ç»Ÿã€‚</li>
<li>Vert.xæ¡†æ¶ï¼šVert.xæ˜¯ä¸€ä¸ªåŸºäºäº‹ä»¶é©±åŠ¨çš„å¼‚æ­¥æ¡†æ¶ï¼Œæä¾›äº†å¤šç§è¯­è¨€çš„APIå’Œå·¥å…·ï¼Œæ”¯æŒæ„å»ºé«˜æ€§èƒ½å’Œå¯æ‰©å±•çš„åº”ç”¨ç¨‹åºã€‚åœ¨Vert.xä¸­ï¼Œæ¯ä¸ªç»„ä»¶éƒ½æ˜¯ä¸€ä¸ªæ´»åŠ¨å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡Vert.xçš„äº‹ä»¶æ€»çº¿è¿›è¡Œé€šä¿¡å’Œåä½œã€‚Vert.xæä¾›äº†ä¸°å¯Œçš„å¼‚æ­¥APIå’Œå·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å¤„ç†å¹¶å‘å’Œå¼‚æ­¥é—®é¢˜ã€‚</li>
<li>RxJavaæ¡†æ¶ï¼šRxJavaæ˜¯ä¸€ä¸ªåŸºäºå“åº”å¼ç¼–ç¨‹çš„å¼‚æ­¥æ¡†æ¶ï¼Œæä¾›äº†ä¸°å¯Œçš„æ“ä½œç¬¦å’Œå·¥å…·ï¼Œæ”¯æŒæ„å»ºé«˜æ€§èƒ½å’Œå¯ç»´æŠ¤çš„åº”ç”¨ç¨‹åºã€‚åœ¨RxJavaä¸­ï¼Œæ¯ä¸ªObservableéƒ½æ˜¯ä¸€ä¸ªæ´»åŠ¨å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡å¼‚æ­¥æµçš„æ–¹å¼è¿›è¡Œé€šä¿¡å’Œåä½œã€‚RxJavaæä¾›äº†ä¸°å¯Œçš„æ“ä½œç¬¦å’Œå·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å¤„ç†å¹¶å‘å’Œå¼‚æ­¥é—®é¢˜ï¼Œå¹¶æ”¯æŒå“åº”å¼ç¼–ç¨‹çš„å¤šç§ç‰¹æ€§ï¼Œå¦‚å“åº”å¼æµã€èƒŒå‹æ§åˆ¶ç­‰ã€‚</li>
<li>Nettyæ¡†æ¶ï¼šNettyæ˜¯ä¸€ä¸ªåŸºäºäº‹ä»¶é©±åŠ¨çš„å¼‚æ­¥ç½‘ç»œé€šä¿¡æ¡†æ¶ï¼Œæä¾›äº†ä¸°å¯Œçš„APIå’Œå·¥å…·ï¼Œæ”¯æŒæ„å»ºé«˜æ€§èƒ½å’Œå¯æ‰©å±•çš„ç½‘ç»œåº”ç”¨ç¨‹åºã€‚åœ¨Nettyä¸­ï¼Œæ¯ä¸ªChanneléƒ½æ˜¯ä¸€ä¸ªæ´»åŠ¨å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡äº‹ä»¶çš„æ–¹å¼è¿›è¡Œé€šä¿¡å’Œåä½œã€‚Nettyæä¾›äº†ä¸°å¯Œçš„å¼‚æ­¥APIå’Œå·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å¤„ç†ç½‘ç»œé€šä¿¡å’Œå¼‚æ­¥é—®é¢˜ï¼Œå¹¶æ”¯æŒå¤šç§åè®®å’Œç¼–è§£ç å™¨ã€‚</li>
<li>Springæ¡†æ¶ï¼šSpringæ˜¯ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„ä¼ä¸šçº§Javaæ¡†æ¶ï¼Œæä¾›äº†ä¸°å¯Œçš„APIå’Œå·¥å…·ï¼Œæ”¯æŒæ„å»ºé«˜æ€§èƒ½å’Œå¯ç»´æŠ¤çš„åº”ç”¨ç¨‹åºã€‚åœ¨Springä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¼‚æ­¥å¤„ç†ã€å“åº”å¼ç¼–ç¨‹å’Œäº‹ä»¶é©±åŠ¨ç­‰æ–¹å¼å®ç°æ´»åŠ¨å¯¹è±¡æ¨¡å¼ã€‚Springæä¾›äº†ä¸°å¯Œçš„å¼‚æ­¥APIå’Œå·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å¤„ç†å¼‚æ­¥å’Œå¹¶å‘é—®é¢˜ã€‚</li>
<li>JMSæ¡†æ¶ï¼šJMSæ˜¯Javaæ¶ˆæ¯æœåŠ¡çš„æ ‡å‡†ï¼Œæä¾›äº†å¼‚æ­¥æ¶ˆæ¯ä¼ é€’çš„æ–¹å¼ï¼Œæ”¯æŒæ„å»ºå¯é ã€é«˜æ€§èƒ½å’Œå¯æ‰©å±•çš„æ¶ˆæ¯ç³»ç»Ÿã€‚åœ¨JMSä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ´»åŠ¨å¯¹è±¡æ¨¡å¼å®ç°å¼‚æ­¥æ¶ˆæ¯çš„å¤„ç†å’Œåˆ†å‘ã€‚JMSæä¾›äº†ä¸°å¯Œçš„APIå’Œå·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å¤„ç†å¼‚æ­¥æ¶ˆæ¯çš„ç”Ÿäº§å’Œæ¶ˆè´¹ã€‚</li>
<li>Apache Camelæ¡†æ¶ï¼šApache Camelæ˜¯ä¸€ä¸ªåŸºäºä¼ä¸šçº§é›†æˆæ¨¡å¼çš„å¼€æºæ¡†æ¶ï¼Œæä¾›äº†ä¸°å¯Œçš„ç»„ä»¶å’Œå·¥å…·ï¼Œæ”¯æŒæ„å»ºå¯æ‰©å±•ã€é«˜æ€§èƒ½å’Œå¯é çš„åº”ç”¨ç¨‹åºã€‚åœ¨Camelä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ´»åŠ¨å¯¹è±¡æ¨¡å¼å®ç°å¼‚æ­¥æ¶ˆæ¯çš„å¤„ç†å’Œè·¯ç”±ã€‚Camelæä¾›äº†ä¸°å¯Œçš„ç»„ä»¶å’Œå·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å¤„ç†å¼‚æ­¥æ¶ˆæ¯çš„è·¯ç”±å’Œè½¬æ¢ã€‚</li>
</ol>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨Springå¼‚æ­¥å¤„ç†å’Œäº‹ä»¶é©±åŠ¨æœºåˆ¶å®ç°æ´»åŠ¨å¯¹è±¡æ¨¡å¼çš„ç¤ºä¾‹ä»£ç ï¼Œè¯¥ç¤ºä¾‹ä»£ç ä½¿ç”¨äº†Spring Bootæ¡†æ¶å’ŒSpring Reactoråº“ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Bean</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.context.annotation.Configuration</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">reactor.core.publisher.Flux</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">reactor.core.publisher.Mono</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">reactor.core.scheduler.Schedulers</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@Configuration</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppConfig</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">MessageHandler</span> <span class="nf">messageHandler</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">MessageHandler</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@Component</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MessageHandler</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Autowired</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">MessageRepository</span> <span class="n">messageRepository</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Mono</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span> <span class="nf">handleMessage</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Mono</span><span class="o">.</span><span class="na">fromCallable</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// å¤„ç†æ¶ˆæ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Received message: &#34;</span> <span class="o">+</span> <span class="n">message</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">messageRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="n">Message</span><span class="o">(</span><span class="n">message</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}).</span><span class="na">subscribeOn</span><span class="o">(</span><span class="n">Schedulers</span><span class="o">.</span><span class="na">boundedElastic</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Flux</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">&gt;</span> <span class="nf">getAllMessages</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Flux</span><span class="o">.</span><span class="na">defer</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="n">Flux</span><span class="o">.</span><span class="na">fromIterable</span><span class="o">(</span><span class="n">messageRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">()))</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">subscribeOn</span><span class="o">(</span><span class="n">Schedulers</span><span class="o">.</span><span class="na">boundedElastic</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@Entity</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Message</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Id</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">content</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">Message</span><span class="o">()</span> <span class="o">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">Message</span><span class="o">(</span><span class="n">String</span> <span class="n">content</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>   
</span></span></code></pre></div><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª <code>MessageHandler</code> ç±»ä½œä¸ºæ´»åŠ¨å¯¹è±¡ï¼Œç”¨äºå¼‚æ­¥å¤„ç†æ¶ˆæ¯çš„æ¥æ”¶å’Œå­˜å‚¨ã€‚è¯¥ç±»ä½¿ç”¨äº†Springå¼‚æ­¥å¤„ç†å’Œäº‹ä»¶é©±åŠ¨æœºåˆ¶æ¥å®ç°æ´»åŠ¨å¯¹è±¡æ¨¡å¼ï¼Œå®¢æˆ·ç«¯ä»£ç åªéœ€è¦è°ƒç”¨ç›¸åº”çš„æ–¹æ³•å³å¯ï¼Œä¸éœ€è¦å…³å¿ƒå¼‚æ­¥å¤„ç†çš„ç»†èŠ‚ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼Œè¯¥ç¤ºä¾‹ä»£ç åŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p>
<ol>
<li>
<p><code>AppConfig</code> é…ç½®ç±»ï¼šè¯¥ç±»ç”¨äºé…ç½®Spring Beanï¼Œå®šä¹‰äº†ä¸€ä¸ª <code>messageHandler()</code> æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ª <code>MessageHandler</code> å¯¹è±¡ã€‚</p>
</li>
<li>
<p><code>MessageHandler</code> æ´»åŠ¨å¯¹è±¡ç±»ï¼šè¯¥ç±»åŒ…å«äº†ä¸¤ä¸ªæ–¹æ³•ï¼š<code>handleMessage()</code> å’Œ <code>getAllMessages()</code>ã€‚<code>handleMessage()</code> æ–¹æ³•ç”¨äºå¤„ç†æ¶ˆæ¯ï¼Œå°†æ¶ˆæ¯å­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼›<code>getAllMessages()</code> æ–¹æ³•ç”¨äºè·å–æ‰€æœ‰çš„æ¶ˆæ¯ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½ä½¿ç”¨äº†Springçš„å¼‚æ­¥å¤„ç†æœºåˆ¶å’Œäº‹ä»¶é©±åŠ¨æœºåˆ¶ï¼Œä½¿ç”¨äº† Reactor åº“ä¸­çš„ <code>Mono</code> å’Œ <code>Flux</code> ç±»ã€‚</p>
</li>
<li>
<p><code>Message</code> JPAå®ä½“ç±»ï¼šè¯¥ç±»ç”¨äºè¡¨ç¤ºæ¶ˆæ¯å¯¹è±¡ï¼Œä½¿ç”¨äº†JPAæ³¨è§£ã€‚</p>
</li>
</ol>
<p>åœ¨ <code>handleMessage()</code> æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <code>Mono.fromCallable()</code> æ–¹æ³•æ¥å¼‚æ­¥å¤„ç†æ¶ˆæ¯çš„æ¥æ”¶å’Œå­˜å‚¨ï¼Œå°†å¤„ç†æ“ä½œæäº¤åˆ°çº¿ç¨‹æ± ä¸­æ‰§è¡Œï¼Œç„¶åè¿”å› <code>Mono&lt;Void&gt;</code> å¯¹è±¡ï¼Œä»¥ä¾¿å®¢æˆ·ç«¯ä»£ç å¯ä»¥ç­‰å¾…å¤„ç†æ“ä½œå®Œæˆã€‚æˆ‘ä»¬è¿˜ä½¿ç”¨äº† <code>subscribeOn()</code> æ–¹æ³•æ¥æŒ‡å®šå¼‚æ­¥å¤„ç†çš„çº¿ç¨‹æ± ï¼Œä»¥æé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§ã€‚</p>
<p>åœ¨ <code>getAllMessages()</code> æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <code>Flux.defer()</code> æ–¹æ³•æ¥å¼‚æ­¥è·å–æ‰€æœ‰çš„æ¶ˆæ¯ï¼Œå°†è·å–æ“ä½œæäº¤åˆ°çº¿ç¨‹æ± ä¸­æ‰§è¡Œï¼Œç„¶åè¿”å› <code>Flux&lt;Message&gt;</code> å¯¹è±¡ï¼Œä»¥ä¾¿å®¢æˆ·ç«¯ä»£ç å¯ä»¥å¼‚æ­¥è·å–æ¶ˆæ¯ã€‚æˆ‘ä»¬åŒæ ·ä½¿ç”¨äº† <code>subscribeOn()</code> æ–¹æ³•æ¥æŒ‡å®šå¼‚æ­¥å¤„ç†çš„çº¿ç¨‹æ± ã€‚</p>
<p>é€šè¿‡ä½¿ç”¨Springå¼‚æ­¥å¤„ç†å’Œäº‹ä»¶é©±åŠ¨æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°é«˜æ€§èƒ½ã€å¯é å’Œå¯æ‰©å±•çš„æ´»åŠ¨å¯¹è±¡æ¨¡å¼ï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨æ´»åŠ¨å¯¹è±¡æ¨¡å¼å®ç°å¼‚æ­¥æ¶ˆæ¯å¤„ç†å’Œåˆ†å‘çš„JMSç¤ºä¾‹ä»£ç ï¼Œè¯¥ç¤ºä¾‹ä»£ç ä½¿ç”¨äº†ActiveMQä½œä¸ºJMSæ¶ˆæ¯ä¸­é—´ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">javax.jms.*</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.apache.activemq.ActiveMQConnectionFactory</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.concurrent.CompletableFuture</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.concurrent.ExecutorService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.concurrent.Executors</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JMSMessageHandler</span> <span class="kd">implements</span> <span class="n">MessageListener</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">ExecutorService</span> <span class="n">executor</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newSingleThreadExecutor</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Connection</span> <span class="n">connection</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Session</span> <span class="n">session</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Destination</span> <span class="n">destination</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">JMSMessageHandler</span><span class="o">(</span><span class="n">String</span> <span class="n">brokerUrl</span><span class="o">,</span> <span class="n">String</span> <span class="n">destinationName</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">JMSException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ConnectionFactory</span> <span class="n">connectionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ActiveMQConnectionFactory</span><span class="o">(</span><span class="n">brokerUrl</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">connection</span> <span class="o">=</span> <span class="n">connectionFactory</span><span class="o">.</span><span class="na">createConnection</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">connection</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">session</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">createSession</span><span class="o">(</span><span class="kc">false</span><span class="o">,</span> <span class="n">Session</span><span class="o">.</span><span class="na">AUTO_ACKNOWLEDGE</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">destination</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createQueue</span><span class="o">(</span><span class="n">destinationName</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">MessageConsumer</span> <span class="n">consumer</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createConsumer</span><span class="o">(</span><span class="n">destination</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">consumer</span><span class="o">.</span><span class="na">setMessageListener</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span> <span class="nf">send</span><span class="o">(</span><span class="n">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span> <span class="n">future</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CompletableFuture</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">        <span class="n">executor</span><span class="o">.</span><span class="na">submit</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">TextMessage</span> <span class="n">textMessage</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createTextMessage</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">MessageProducer</span> <span class="n">producer</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">createProducer</span><span class="o">(</span><span class="n">destination</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">producer</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">textMessage</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">future</span><span class="o">.</span><span class="na">complete</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">JMSException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">future</span><span class="o">.</span><span class="na">completeExceptionally</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">});</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">future</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onMessage</span><span class="o">(</span><span class="n">Messagemessage</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">CompletableFuture</span><span class="o">.</span><span class="na">runAsync</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">message</span> <span class="k">instanceof</span> <span class="n">TextMessage</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">TextMessage</span> <span class="n">textMessage</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextMessage</span><span class="o">)</span> <span class="n">message</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                    <span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="n">textMessage</span><span class="o">.</span><span class="na">getText</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                    <span class="c1">// å¤„ç†æ¶ˆæ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Received message: &#34;</span> <span class="o">+</span> <span class="n">text</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">JMSException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">});</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">JMSException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">connection</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">executor</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä»£ç ä¸­ï¼Œ<code>JMSMessageHandler</code> ç±»è¡¨ç¤ºä¸€ä¸ªJMSæ¶ˆæ¯å¤„ç†å™¨ï¼Œå¯ä»¥å¼‚æ­¥å¤„ç†æ¥è‡ªJMSé˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œå¹¶å°†å¤„ç†ç»“æœå‘é€å›JMSé˜Ÿåˆ—ã€‚è¯¥ç±»ä½¿ç”¨äº†æ´»åŠ¨å¯¹è±¡æ¨¡å¼æ¥å®ç°å¼‚æ­¥æ¶ˆæ¯çš„å¤„ç†å’Œåˆ†å‘ï¼Œå®¢æˆ·ç«¯ä»£ç åªéœ€è¦å‘é€æ¶ˆæ¯å³å¯ï¼Œä¸éœ€è¦å…³å¿ƒå¼‚æ­¥å¤„ç†çš„ç»†èŠ‚ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼Œè¯¥ç±»åŒ…å«ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•ï¼š</p>
<ol>
<li>
<p><code>JMSMessageHandler(String brokerUrl, String destinationName)</code> æ„é€ æ–¹æ³•ï¼šè¯¥æ–¹æ³•ç”¨äºåˆ›å»ºä¸€ä¸ªJMSæ¶ˆæ¯å¤„ç†å™¨å¯¹è±¡ï¼Œè¿æ¥åˆ°æŒ‡å®šçš„JMSæ¶ˆæ¯ä¸­é—´ä»¶å¹¶è®¢é˜…æŒ‡å®šçš„é˜Ÿåˆ—ã€‚</p>
</li>
<li>
<p><code>send(String message)</code> æ–¹æ³•ï¼šè¯¥æ–¹æ³•ç”¨äºå‘é€æ¶ˆæ¯åˆ°JMSé˜Ÿåˆ—ä¸­ï¼Œå®¢æˆ·ç«¯ä»£ç å¯ä»¥è°ƒç”¨è¯¥æ–¹æ³•å°†æ¶ˆæ¯å‘é€åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ã€‚</p>
</li>
<li>
<p><code>onMessage(Message message)</code> æ–¹æ³•ï¼šè¯¥æ–¹æ³•æ˜¯ <code>MessageListener</code> æ¥å£çš„å›è°ƒæ–¹æ³•ï¼Œç”¨äºå¼‚æ­¥å¤„ç†é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œå¹¶å°†å¤„ç†ç»“æœå‘é€å›JMSé˜Ÿåˆ—ã€‚</p>
</li>
<li>
<p><code>close()</code> æ–¹æ³•ï¼šè¯¥æ–¹æ³•ç”¨äºå…³é—­JMSè¿æ¥å’Œçº¿ç¨‹æ± ï¼Œé‡Šæ”¾èµ„æºã€‚</p>
</li>
</ol>
<p>åœ¨ <code>send()</code> æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <code>CompletableFuture</code> å¯¹è±¡æ¥å¼‚æ­¥å¤„ç†æ¶ˆæ¯çš„å‘é€ï¼Œå°†å‘é€æ“ä½œæäº¤åˆ°çº¿ç¨‹æ± ä¸­æ‰§è¡Œï¼Œç„¶åè¿”å› <code>CompletableFuture</code> å¯¹è±¡ï¼Œä»¥ä¾¿å®¢æˆ·ç«¯ä»£ç å¯ä»¥ç­‰å¾…å‘é€æ“ä½œå®Œæˆã€‚</p>
<p>åœ¨ <code>onMessage()</code> æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† <code>CompletableFuture.runAsync()</code> æ–¹æ³•æ¥å¼‚æ­¥å¤„ç†æ¶ˆæ¯çš„å¤„ç†ï¼Œå°†å¤„ç†æ“ä½œæäº¤åˆ°çº¿ç¨‹æ± ä¸­æ‰§è¡Œï¼Œç„¶åè¿”å› <code>CompletableFuture</code> å¯¹è±¡ï¼Œä»¥ä¾¿å®¢æˆ·ç«¯ä»£ç å¯ä»¥ç­‰å¾…å¤„ç†æ“ä½œå®Œæˆã€‚</p>
<p>é€šè¿‡ä½¿ç”¨æ´»åŠ¨å¯¹è±¡æ¨¡å¼å’Œå¼‚æ­¥å¤„ç†æŠ€æœ¯ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°é«˜æ€§èƒ½ã€å¯é å’Œå¯æ‰©å±•çš„JMSæ¶ˆæ¯å¤„ç†å™¨ï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
<h3 id="åœ¨é¡¹ç›®ä¸­çš„ä½¿ç”¨">åœ¨é¡¹ç›®ä¸­çš„ä½¿ç”¨</h3>
<p>åœ¨å…¬å¸çš„é¡¹ç›®ä¸­ï¼Œç”¨åˆ°è¿‡æ´»åŠ¨å¯¹è±¡è¿™ä¸ªè®¾è®¡æ¨¡å¼ï¼Œåªæ˜¯ä¹‹å‰å¹¶ä¸æ¸…æ¥šè¿™ä¸ªæ¨¡å¼ã€‚ä½¿ç”¨åœºæ™¯æ˜¯ï¼Œå‘é€é£ä¹¦é€šçŸ¥å’Œæ‹¨æ‰“è¯­éŸ³ç”µè¯æ—¶ï¼Œå°†è¯·æ±‚æ·»åŠ åˆ°ä¸€ä¸ªå†…éƒ¨é˜»å¡é˜Ÿåˆ—ï¼Œç„¶åå•ç‹¬å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹å»æ¶ˆè´¹è¿™ä¸ªé˜Ÿåˆ—ã€‚</p>
<p>ä»¥ä¸‹æ˜¯æ‹¨æ‰“è¯­éŸ³ç”µè¯çš„ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Tencent Cloud Vms SendTtsVoice
</span></span></span><span class="line"><span class="cl"><span class="cm"> * https://cloud.tencent.com/document/product/1128/51558
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Slf4j</span>
</span></span><span class="line"><span class="cl"><span class="nd">@AllArgsConstructor</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">VmsServiceImpl</span> <span class="kd">implements</span> <span class="n">VmsService</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">PREFIX_PHONE</span> <span class="o">=</span> <span class="s">&#34;86&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">VoiceSenderRequest</span><span class="o">&gt;</span> <span class="n">queue</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedBlockingQueue</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="n">TtsVoiceSender</span> <span class="n">ttsVoiceSender</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="kd">final</span> <span class="n">AsyncVmsThread</span> <span class="n">asyncVmsThread</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AsyncVmsThread</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nd">@PostConstruct</span>
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">asyncVmsThread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nd">@PreDestroy</span>
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">asyncVmsThread</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">sendAsync</span><span class="o">(</span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">NoticeTarget</span><span class="o">&gt;</span> <span class="n">noticeUsers</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">templateId</span><span class="o">,</span> <span class="n">String</span><span class="o">[]</span> <span class="n">params</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="o">(</span><span class="n">templateId</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">CollectionUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">noticeUsers</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="o">(</span><span class="n">NoticeTarget</span> <span class="n">noticeUser</span> <span class="o">:</span> <span class="n">noticeUsers</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="o">(!</span><span class="n">noticeUser</span><span class="o">.</span><span class="na">getType</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">NoticeTargetTypeEnum</span><span class="o">.</span><span class="na">PHONE</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="k">continue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">			<span class="o">}</span>
</span></span><span class="line"><span class="cl">			<span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="n">queue</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="k">new</span> <span class="n">VoiceSenderRequest</span><span class="o">().</span><span class="na">setNoticeUser</span><span class="o">(</span><span class="n">noticeUser</span><span class="o">).</span><span class="na">setTemplateId</span><span class="o">(</span><span class="n">templateId</span><span class="o">).</span><span class="na">setParams</span><span class="o">(</span><span class="n">params</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">			<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="k">throw</span> <span class="k">new</span> <span class="n">BusinessException</span><span class="o">(</span><span class="s">&#34;çº¿ç¨‹è¢«ä¸­æ–­&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">			<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="n">Boolean</span> <span class="nf">send</span><span class="o">(</span><span class="n">String</span> <span class="n">phone</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">templateId</span><span class="o">,</span> <span class="n">String</span><span class="o">[]</span> <span class="n">params</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="o">(</span><span class="n">templateId</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">phone</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">throw</span> <span class="k">new</span> <span class="n">BusinessException</span><span class="o">(</span><span class="s">&#34;å‚æ•°ä¸èƒ½ä¸ºç©º&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="n">TtsVoiceSenderResult</span> <span class="n">ttsVoiceSenderResult</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">ttsVoiceSenderResult</span> <span class="o">=</span> <span class="n">ttsVoiceSender</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="n">PREFIX_PHONE</span><span class="o">,</span> <span class="n">phone</span><span class="o">,</span> <span class="n">templateId</span><span class="o">,</span> <span class="n">params</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="s">&#34;&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="o">(</span><span class="n">ttsVoiceSenderResult</span><span class="o">.</span><span class="na">result</span> <span class="o">!=</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">throw</span> <span class="k">new</span> <span class="n">BusinessException</span><span class="o">(</span><span class="n">ttsVoiceSenderResult</span><span class="o">.</span><span class="na">errMsg</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">ttsVoiceSenderResult</span><span class="o">.</span><span class="na">result</span> <span class="o">==</span> <span class="n">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AsyncVmsThread</span> <span class="kd">extends</span> <span class="n">Thread</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">AtomicBoolean</span> <span class="n">isRunning</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicBoolean</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="kd">public</span> <span class="nf">AsyncVmsThread</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="kd">super</span><span class="o">(</span><span class="s">&#34;vmsSender&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">		<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">while</span> <span class="o">(</span><span class="n">isRunning</span><span class="o">.</span><span class="na">get</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="n">ThreadUtil</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">2000L</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">				<span class="n">VoiceSenderRequest</span> <span class="n">voiceSenderRequest</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">				<span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">					<span class="n">voiceSenderRequest</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="na">take</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">					<span class="n">send</span><span class="o">(</span><span class="n">voiceSenderRequest</span><span class="o">.</span><span class="na">getNoticeUser</span><span class="o">().</span><span class="na">getId</span><span class="o">(),</span> <span class="n">voiceSenderRequest</span><span class="o">.</span><span class="na">getTemplateId</span><span class="o">(),</span> <span class="n">voiceSenderRequest</span><span class="o">.</span><span class="na">getParams</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">				<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">					<span class="n">log</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">&#34;{}&#34;</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&#34;å‘é€è¯­éŸ³ç”µè¯ç»™[%s]å‡ºç°å¼‚å¸¸: %s&#34;</span><span class="o">,</span> <span class="n">voiceSenderRequest</span><span class="o">.</span><span class="na">getNoticeUser</span><span class="o">(),</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">()),</span> <span class="n">e</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">				<span class="o">}</span>
</span></span><span class="line"><span class="cl">			<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="kd">public</span> <span class="kt">void</span> <span class="nf">shutdown</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">isRunning</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nd">@Data</span>
</span></span><span class="line"><span class="cl">	<span class="nd">@Accessors</span><span class="o">(</span><span class="n">chain</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="kd">class</span> <span class="nc">VoiceSenderRequest</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="kd">private</span> <span class="n">NoticeTarget</span> <span class="n">noticeUser</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">		<span class="kd">private</span> <span class="n">Integer</span> <span class="n">templateId</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">		<span class="kd">private</span> <span class="n">String</span><span class="o">[]</span> <span class="n">params</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ä¼˜åŒ–ä¹‹åçš„ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Slf4j</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">ActiveObject</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;</span> <span class="n">requests</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="n">Thread</span> <span class="n">thread</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="kd">volatile</span> <span class="kt">boolean</span> <span class="n">isAcceptingRequests</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="kd">volatile</span> <span class="kt">boolean</span> <span class="n">isProcessingRequests</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="nf">ActiveObject</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">this</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">16</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="nf">ActiveObject</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">queueSize</span><span class="o">,</span> <span class="n">Long</span> <span class="n">sleepMillis</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">this</span><span class="o">.</span><span class="na">requests</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedBlockingQueue</span><span class="o">&lt;&gt;(</span><span class="n">queueSize</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">thread</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">while</span> <span class="o">(</span><span class="n">isProcessingRequests</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">					<span class="n">processRequest</span><span class="o">(</span><span class="n">requests</span><span class="o">.</span><span class="na">take</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">					<span class="k">if</span> <span class="o">(</span><span class="n">sleepMillis</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">						<span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">sleepMillis</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">					<span class="o">}</span>
</span></span><span class="line"><span class="cl">				<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">					<span class="n">log</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">&#34;Active Object thread interrupted, reason: {}&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">				<span class="o">}</span>
</span></span><span class="line"><span class="cl">			<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="o">},</span> <span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">thread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="kt">void</span> <span class="nf">processRequest</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">task</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">task</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;Error processing request: {}&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// å‘é€å‘Šè­¦ä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="o">}</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">shutdown</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">isAcceptingRequests</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">while</span> <span class="o">(!</span><span class="n">requests</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">100</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">			<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="c1">// Ignore exception
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="n">isProcessingRequests</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">thread</span><span class="o">.</span><span class="na">interrupt</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">runnable</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="o">(</span><span class="n">isAcceptingRequests</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">requests</span><span class="o">.</span><span class="na">offer</span><span class="o">(</span><span class="n">runnable</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalStateException</span><span class="o">(</span><span class="s">&#34;Active object is no longer accepting requests&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="n">String</span> <span class="nf">name</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>è¯¥ç±»å…·æœ‰æ„é€ å‡½æ•°ï¼Œç”¨äºåˆ›å»ºå…·æœ‰ç»™å®šåç§°å’ŒæŒ‡å®šå¤§å°é˜»å¡è¯·æ±‚é˜Ÿåˆ—çš„Active Objectã€‚Active Objectåœ¨åå°çš„å•ç‹¬çº¿ç¨‹ä¸Šè¿è¡Œï¼Œè¯¥çº¿ç¨‹åœ¨å¾ªç¯ä¸­æ‰§è¡Œï¼Œç›´åˆ°è¢«ä¸­æ–­ã€‚å®ƒä½¿ç”¨<code>run</code>æ–¹æ³•æ‰§è¡Œæ·»åŠ åˆ°è¯·æ±‚é˜Ÿåˆ—ä¸­çš„è¯·æ±‚ã€‚<code>run</code>æ–¹æ³•æ¥å—ä¸€ä¸ª<code>Runnable</code>å¯¹è±¡ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°è¯·æ±‚é˜Ÿåˆ—ä¸­ã€‚å¦‚æœActive Objectä¸å†æ¥å—è¯·æ±‚ï¼Œåˆ™æŠ›å‡º<code>IllegalStateException</code>ã€‚</p>
<p><code>shutdown</code>æ–¹æ³•ç”¨äºåœæ­¢Active Objectã€‚å®ƒé¦–å…ˆå°†<code>isAcceptingRequests</code>æ ‡å¿—è®¾ç½®ä¸ºfalseï¼Œè¿™å°†é˜²æ­¢å°†ä»»ä½•è¿›ä¸€æ­¥çš„è¯·æ±‚æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ã€‚ç„¶åç­‰å¾…é˜Ÿåˆ—å˜ä¸ºç©ºï¼Œç„¶åå°†<code>isProcessingRequests</code>æ ‡å¿—è®¾ç½®ä¸ºfalseï¼Œå¹¶ä¸­æ–­Active Objectçš„çº¿ç¨‹ã€‚</p>
<p>è¿™ä¸ªç±»æœ¬èº«å·²ç»æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„Active Objectæ¨¡å¼çš„å®ç°äº†ï¼Œä½†æ˜¯å¦‚æœéœ€è¦æ›´é«˜çš„æ€§èƒ½æˆ–æ›´å¥½çš„æ‰©å±•æ€§ï¼Œè¿˜å¯ä»¥è¿›è¡Œä¸€äº›ä¼˜åŒ–ï¼š</p>
<ol>
<li>
<p>ä½¿ç”¨çº¿ç¨‹æ± ï¼šå½“å‰çš„å®ç°ä¸­ï¼Œæ¯ä¸ªActive Objectéƒ½æœ‰ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹æ¥å¤„ç†è¯·æ±‚ã€‚å¦‚æœéœ€è¦å¤„ç†å¤§é‡çš„Active Objectï¼Œè¿™å°†ä¼šäº§ç”Ÿå¾ˆå¤šçº¿ç¨‹ï¼Œä»è€Œå½±å“ç³»ç»Ÿçš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚å¯ä»¥ä½¿ç”¨çº¿ç¨‹æ± æ¥ç®¡ç†çº¿ç¨‹ï¼Œä»è€Œæ›´å¥½åœ°æ§åˆ¶çº¿ç¨‹çš„æ•°é‡å’Œèµ„æºçš„ä½¿ç”¨ã€‚</p>
<blockquote>
<p>å¦‚æœåœ¨ä½¿ç”¨ActiveObjectæ—¶è¦æ‰§è¡Œè€—æ—¶çš„ä»»åŠ¡ï¼Œå¯ä»¥å°†ä»»åŠ¡æ”¾åˆ°ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹æ± ä¸­æ‰§è¡Œï¼Œä»¥é¿å…é˜»å¡ActiveObjectå®ä¾‹çš„è¯·æ±‚å¤„ç†çº¿ç¨‹ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Slf4j</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">ActiveObject</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;</span> <span class="n">requests</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="n">ExecutorService</span> <span class="n">executorService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="n">Thread</span> <span class="n">thread</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="kd">volatile</span> <span class="kt">boolean</span> <span class="n">isAcceptingRequests</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="kd">volatile</span> <span class="kt">boolean</span> <span class="n">isProcessingRequests</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="nf">ActiveObject</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">this</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">16</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="nf">ActiveObject</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">queueSize</span><span class="o">,</span> <span class="n">Long</span> <span class="n">sleepMillis</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">this</span><span class="o">.</span><span class="na">requests</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedBlockingQueue</span><span class="o">&lt;&gt;(</span><span class="n">queueSize</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">this</span><span class="o">.</span><span class="na">executorService</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="n">5</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">thread</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">while</span> <span class="o">(</span><span class="n">isProcessingRequests</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">					<span class="n">processRequest</span><span class="o">(</span><span class="n">requests</span><span class="o">.</span><span class="na">take</span><span class="o">(),</span> <span class="n">executorService</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">					<span class="k">if</span> <span class="o">(</span><span class="n">sleepMillis</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">						<span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">sleepMillis</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">					<span class="o">}</span>
</span></span><span class="line"><span class="cl">				<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">					<span class="n">log</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">&#34;Active Object thread interrupted, reason: {}&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">				<span class="o">}</span>
</span></span><span class="line"><span class="cl">			<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="o">},</span> <span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">thread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="kt">void</span> <span class="nf">processRequest</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">task</span><span class="o">,</span> <span class="n">ExecutorService</span> <span class="n">executorService</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">executorService</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span><span class="n">task</span><span class="o">).</span><span class="na">get</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;Error processing request: {}&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// å‘é€å‘Šè­¦ä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="o">}</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">shutdown</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">isAcceptingRequests</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">while</span> <span class="o">(!</span><span class="n">requests</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">100</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">			<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="c1">// Ignore exception
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="n">isProcessingRequests</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">executorService</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">		<span class="n">thread</span><span class="o">.</span><span class="na">interrupt</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">runnable</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="o">(</span><span class="n">isAcceptingRequests</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">requests</span><span class="o">.</span><span class="na">offer</span><span class="o">(</span><span class="n">runnable</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalStateException</span><span class="o">(</span><span class="s">&#34;Active object is no longer accepting requests&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="n">String</span> <span class="nf">name</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨ä¿®æ”¹åçš„ä»£ç ä¸­ï¼Œæ·»åŠ äº†ä¸€ä¸ªç§æœ‰å˜é‡executorServiceï¼Œç”¨äºå­˜å‚¨ä¸€ä¸ªçº¿ç¨‹æ± å¯¹è±¡ï¼Œå…¶ä¸­çº¿ç¨‹æ± çš„å¤§å°ä¸º5ã€‚åœ¨æ„é€ æ–¹æ³•ä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„FixedThreadPoolExecutorå®ä¾‹ï¼Œå¹¶å°†å…¶ä½œä¸ºexecutorServiceçš„å€¼ã€‚è¯¥çº¿ç¨‹æ± ä¼šåœ¨ActiveObjectå®ä¾‹ä¸­å¤„ç†è€—æ—¶ä»»åŠ¡ï¼Œé¿å…é˜»å¡è¯·æ±‚é˜Ÿåˆ—çš„å¤„ç†ã€‚</p>
<p>åœ¨processRequestæ–¹æ³•ä¸­ï¼Œä½¿ç”¨executorService.submit(task).get()æ¥æäº¤å¹¶æ‰§è¡Œä»»åŠ¡ã€‚åœ¨æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œä½¿ç”¨äº†get()æ–¹æ³•æ¥åŒæ­¥è·å–ä»»åŠ¡çš„æ‰§è¡Œç»“æœï¼Œä»¥ç¡®ä¿ä»»åŠ¡æ‰§è¡Œå®Œæˆåå†å¤„ç†ä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚</p>
<p>åœ¨shutdownæ–¹æ³•ä¸­ï¼Œæ·»åŠ äº†executorService.shutdown()æ¥å…³é—­çº¿ç¨‹æ± ã€‚è¯¥æ–¹æ³•ä¼šç­‰å¾…æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæˆåå…³é—­çº¿ç¨‹æ± ï¼Œå¹¶é˜²æ­¢æ–°ä»»åŠ¡è¢«æäº¤ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿æ‰€æœ‰ä»»åŠ¡éƒ½è¢«å¤„ç†å®Œæ¯•åæ‰å…³é—­ActiveObjectå®ä¾‹ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä½¿ç”¨çº¿ç¨‹æ± æ—¶ï¼Œè¦æ ¹æ®å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚å’Œç³»ç»Ÿèµ„æºæƒ…å†µé€‰æ‹©åˆé€‚çš„çº¿ç¨‹æ± å¤§å°å’Œç±»å‹ï¼Œé¿å…çº¿ç¨‹æ± è¿‡å¤§æˆ–è¿‡å°ï¼Œä»è€Œå½±å“ç³»ç»Ÿæ€§èƒ½æˆ–å¯¼è‡´çº¿ç¨‹æ± æ‹¥å µã€‚</p>
</blockquote>
</li>
<li>
<p>ä¼˜åŒ–è¯·æ±‚çš„å¤„ç†ï¼šå½“å‰å®ç°ä¸­ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½ä¼šåœ¨æ‰§è¡Œå®Œæ¯•åç­‰å¾…100æ¯«ç§’ã€‚å¦‚æœè¯·æ±‚å¤„ç†è¾ƒå¿«ï¼Œè¿™å°†æµªè´¹å¾ˆå¤šæ—¶é—´ã€‚å¯ä»¥æ ¹æ®å®é™…æƒ…å†µä¼˜åŒ–è¯·æ±‚çš„å¤„ç†æ–¹å¼ï¼Œä¾‹å¦‚è®¾ç½®ä¸€ä¸ªæœ€å°æ‰§è¡Œæ—¶é—´ï¼Œæˆ–è€…ä½¿ç”¨æ›´é«˜æ•ˆçš„æ•°æ®ç»“æ„æ¥ç®¡ç†è¯·æ±‚é˜Ÿåˆ—ã€‚</p>
<blockquote>
<p>åœ¨å½“å‰çš„å®ç°ä¸­ï¼Œä½¿ç”¨äº†ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—LinkedBlockingQueueæ¥ç®¡ç†è¯·æ±‚é˜Ÿåˆ—ã€‚è¿™ç§æ•°æ®ç»“æ„çš„ä¼˜ç‚¹æ˜¯å¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä½†æ˜¯åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹å¯èƒ½ä¼šæˆä¸ºç“¶é¢ˆï¼Œå› ä¸ºå®ƒæ˜¯åŸºäºé“¾è¡¨å®ç°çš„ï¼Œæ¯æ¬¡æ·»åŠ æˆ–åˆ é™¤å…ƒç´ æ—¶éƒ½éœ€è¦è¿›è¡ŒåŒæ­¥æ“ä½œï¼Œå¯èƒ½ä¼šå½±å“æ€§èƒ½ã€‚</p>
<p>å¦‚æœéœ€è¦æ›´é«˜æ•ˆçš„è¯·æ±‚é˜Ÿåˆ—ç®¡ç†æ–¹å¼ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æ— é”çš„å¹¶å‘é˜Ÿåˆ—ï¼Œä¾‹å¦‚Disruptoræˆ–ConcurrentLinkedQueueã€‚è¿™äº›æ•°æ®ç»“æ„å¯ä»¥åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹æä¾›æ›´å¥½çš„æ€§èƒ½å’Œå¯æ‰©å±•æ€§ï¼Œä½†æ˜¯éœ€è¦æ›´åŠ å¤æ‚çš„å®ç°å’Œä½¿ç”¨æ–¹æ³•ï¼Œéœ€è¦æ ¹æ®å…·ä½“çš„åœºæ™¯è¿›è¡Œæƒè¡¡å’Œé€‰æ‹©ã€‚å¦‚æœä½¿ç”¨Disruptorï¼Œéœ€è¦è¿›è¡Œæ›´åŠ ç»†è‡´çš„é…ç½®å’Œè°ƒä¼˜ï¼Œä»¥ä¾¿å‘æŒ¥æœ€å¤§çš„æ€§èƒ½ä¼˜åŠ¿ã€‚å¦‚æœä½¿ç”¨ConcurrentLinkedQueueï¼Œéœ€è¦è€ƒè™‘å¹¶å‘é—®é¢˜ï¼Œä¾‹å¦‚ä½¿ç”¨CASæ“ä½œæ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p>
<p>å¦‚æœä½¿ç”¨ConcurrentLinkedQueueæ¥ç®¡ç†è¯·æ±‚é˜Ÿåˆ—ï¼Œéœ€è¦è€ƒè™‘å¹¶å‘é—®é¢˜ï¼Œå› ä¸ºè¯¥æ•°æ®ç»“æ„æ˜¯éé˜»å¡çš„ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶å¯¹å…¶è¿›è¡Œæ“ä½œï¼Œå¯èƒ½ä¼šå¯¼è‡´å¹¶å‘é—®é¢˜ï¼Œä¾‹å¦‚ç«æ€æ¡ä»¶å’Œå†…å­˜ä¸€è‡´æ€§é—®é¢˜ã€‚</p>
<p>ä¸ºäº†ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥ä½¿ç”¨CASï¼ˆCompare and Swapï¼‰æ“ä½œæ¥å®ç°åŸå­æ€§çš„å…ƒç´ æ’å…¥å’Œåˆ é™¤ã€‚CASæ“ä½œå¯ä»¥ä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤ŸæˆåŠŸä¿®æ”¹å…±äº«å˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹éœ€è¦é‡è¯•æˆ–è€…ç­‰å¾…ã€‚</p>
<p>ä¾‹å¦‚ï¼Œåœ¨ActiveObjectç±»ä¸­ï¼Œå¯ä»¥å°†è¯·æ±‚é˜Ÿåˆ—å£°æ˜ä¸ºConcurrentLinkedQueueç±»å‹ï¼Œå¹¶ä½¿ç”¨CASæ“ä½œæ¥å®ç°å…ƒç´ çš„æ’å…¥å’Œåˆ é™¤ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">ActiveObject</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">ConcurrentLinkedQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;</span> <span class="n">requests</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">ActiveObject</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">queueSize</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">requests</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentLinkedQueue</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">thread</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">while</span> <span class="o">(</span><span class="n">isProcessingRequests</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">Runnable</span> <span class="n">task</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="na">poll</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">task</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">task</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">100</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">log</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">&#34;Active Object thread interrupted, reason: {}&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">},</span> <span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">thread</span><span class="o">.</span><span class="na">start</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>  
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä½¿ç”¨äº†ConcurrentLinkedQueueæ¥æ›¿æ¢äº†åŸæœ‰çš„é˜»å¡é˜Ÿåˆ—LinkedBlockingQueueï¼Œå¹¶ä½¿ç”¨äº†pollæ–¹æ³•æ¥è·å–é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œè€Œä¸æ˜¯takeæ–¹æ³•ï¼Œè¿™æ ·å¯ä»¥é¿å…çº¿ç¨‹é˜»å¡ã€‚ç„¶åä½¿ç”¨CASæ“ä½œæ¥å®ç°å…ƒç´ çš„æ·»åŠ ï¼Œä½¿ç”¨äº†offeræ–¹æ³•ï¼Œå¹¶æ£€æŸ¥è¿”å›å€¼æ˜¯å¦ä¸ºtrueï¼Œå¦‚æœä¸ºfalseåˆ™è¡¨ç¤ºCASæ“ä½œå¤±è´¥ï¼Œéœ€è¦é‡è¯•æˆ–è€…ç­‰å¾…ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒConcurrentLinkedQueueå¹¶ä¸èƒ½ä¿è¯å…ƒç´ çš„é¡ºåºï¼Œå› æ­¤åœ¨å¤„ç†è¯·æ±‚æ—¶éœ€è¦æ³¨æ„é¡ºåºé—®é¢˜ï¼Œä¸èƒ½ä¿è¯å…ˆè¿›å…ˆå‡ºçš„é¡ºåºã€‚å¦‚æœéœ€è¦ä¿è¯é¡ºåºï¼Œå¯ä»¥ä½¿ç”¨å…¶ä»–çš„æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚BlockingQueueã€‚</p>
</blockquote>
</li>
</ol>
<p>ä¸Šé¢çš„ä»£ç å·²ç»å¾ˆä¸é”™äº†ï¼Œä½†è¿˜æœ‰ä¸€äº›å¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹ï¼š</p>
<ol>
<li>ä½¿ç”¨å·¥å‚æ–¹æ³•æ¥åˆ›å»ºActiveObjectå®ä¾‹</li>
</ol>
<p>å¯ä»¥å°†ActiveObjectç±»ä¸­çš„æ„é€ æ–¹æ³•æ”¹ä¸ºç§æœ‰çš„ï¼Œç„¶åæä¾›ä¸€ä¸ªå·¥å‚æ–¹æ³•æ¥åˆ›å»ºActiveObjectå®ä¾‹ã€‚è¿™æ ·å¯ä»¥å°†ActiveObjectçš„åˆ›å»ºé€»è¾‘ä¸å®¢æˆ·ç«¯ä»£ç åˆ†ç¦»ï¼Œä½¿å¾—å®¢æˆ·ç«¯ä»£ç æ›´åŠ ç®€æ´å’Œæ˜“äºç»´æŠ¤ã€‚</p>
<ol start="2">
<li>å°†æ—¥å¿—è®°å½•å™¨ä½œä¸ºé™æ€å˜é‡</li>
</ol>
<p>å¯ä»¥å°†æ—¥å¿—è®°å½•å™¨ä½œä¸ºé™æ€å˜é‡ï¼Œä»¥ä¾¿åœ¨æ•´ä¸ªç±»ä¸­å…±äº«ã€‚è¿™æ ·å¯ä»¥é¿å…åœ¨æ¯ä¸ªæ–¹æ³•ä¸­éƒ½åˆ›å»ºä¸€ä¸ªæ—¥å¿—è®°å½•å™¨ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§å’Œæ€§èƒ½ã€‚</p>
<ol start="3">
<li>ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼</li>
</ol>
<p>å¯ä»¥ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼æ¥ç¡®ä¿ActiveObjectå®ä¾‹çš„å”¯ä¸€æ€§ã€‚è¿™æ ·å¯ä»¥é¿å…åœ¨å¤šä¸ªåœ°æ–¹åˆ›å»ºå¤šä¸ªActiveObjectå®ä¾‹ï¼Œä»è€Œå¯¼è‡´ç³»ç»Ÿèµ„æºæµªè´¹æˆ–æ•°æ®ä¸ä¸€è‡´ã€‚</p>
<p>ä¿®æ”¹åçš„ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">ActiveObject</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">ActiveObject</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">ActiveObject</span><span class="o">&gt;</span> <span class="n">INSTANCES</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;</span> <span class="n">requests</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="n">ExecutorService</span> <span class="n">executorService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="n">Thread</span> <span class="n">thread</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="kd">volatile</span> <span class="kt">boolean</span> <span class="n">isAcceptingRequests</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="kd">volatile</span> <span class="kt">boolean</span> <span class="n">isProcessingRequests</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="nf">ActiveObject</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">queueSize</span><span class="o">,</span> <span class="n">Long</span> <span class="n">sleepMillis</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">this</span><span class="o">.</span><span class="na">requests</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedBlockingQueue</span><span class="o">&lt;&gt;(</span><span class="n">queueSize</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">this</span><span class="o">.</span><span class="na">executorService</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="n">5</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">thread</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">while</span> <span class="o">(</span><span class="n">isProcessingRequests</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">					<span class="n">processRequest</span><span class="o">(</span><span class="n">requests</span><span class="o">.</span><span class="na">take</span><span class="o">(),</span> <span class="n">executorService</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">					<span class="k">if</span> <span class="o">(</span><span class="n">sleepMillis</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">						<span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">sleepMillis</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">					<span class="o">}</span>
</span></span><span class="line"><span class="cl">				<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">					<span class="n">log</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">&#34;Active Object thread interrupted, reason: {}&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">				<span class="o">}</span>
</span></span><span class="line"><span class="cl">			<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="o">},</span> <span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">thread</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="kt">void</span> <span class="nf">processRequest</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">task</span><span class="o">,</span> <span class="n">ExecutorService</span> <span class="n">executorService</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">executorService</span><span class="o">.</span><span class="na">submit</span><span class="o">(</span><span class="n">task</span><span class="o">).</span><span class="na">get</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;Error processing request: {}&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// å‘é€å‘Šè­¦ä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="o">}</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">synchronized</span> <span class="n">ActiveObject</span> <span class="nf">getInstance</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">getInstance</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">16</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">publicvoid</span> <span class="nf">submit</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">task</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="o">(</span><span class="n">isAcceptingRequests</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="n">requests</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">task</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">			<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;Error submitting request: {}&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">				<span class="c1">// å‘é€å‘Šè­¦ä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">log</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">&#34;Active Object is not accepting requests&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// å‘é€å‘Šè­¦ä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="o">}</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">synchronized</span> <span class="n">ActiveObject</span> <span class="nf">getInstance</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">queueSize</span><span class="o">,</span> <span class="n">Long</span> <span class="n">sleepMillis</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">ActiveObject</span> <span class="n">instance</span> <span class="o">=</span> <span class="n">INSTANCES</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ActiveObject</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">queueSize</span><span class="o">,</span> <span class="n">sleepMillis</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">			<span class="n">INSTANCES</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">instance</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">shutdown</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">isAcceptingRequests</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">while</span> <span class="o">(!</span><span class="n">requests</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">100</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">			<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="c1">// Ignore exception
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="n">isProcessingRequests</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">executorService</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">		<span class="n">thread</span><span class="o">.</span><span class="na">interrupt</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ä¸Šé¢çš„ä»£ç å·²ç»å¾ˆä¸é”™äº†ï¼Œä½†è¿˜æœ‰ä¸€äº›å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–çš„åœ°æ–¹ï¼š</p>
<ol>
<li>ä½¿ç”¨çº¿ç¨‹æ± æ¥ç®¡ç†çº¿ç¨‹ï¼Œè€Œä¸æ˜¯æ¯æ¬¡åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ã€‚è¿™æ ·å¯ä»¥å‡å°‘çº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯çš„å¼€é”€ï¼Œæé«˜ä»£ç çš„æ€§èƒ½ã€‚</li>
</ol>
<ol start="2">
<li>
<p>ä½¿ç”¨Lambdaè¡¨è¾¾å¼ç®€åŒ–ä»£ç ï¼Œä½¿ä»£ç æ›´åŠ ç®€æ´å’Œæ˜“äºç†è§£ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å°†çº¿ç¨‹ä¸­çš„whileå¾ªç¯æ”¹ä¸ºLambdaè¡¨è¾¾å¼ï¼Œç®€åŒ–ä»£ç ã€‚</p>
</li>
<li>
<p>ä½¿ç”¨CompletableFutureæ¥å®ç°å¼‚æ­¥å¤„ç†ï¼Œå°†è¯·æ±‚çš„å¤„ç†è¿‡ç¨‹å’Œç»“æœçš„è¿”å›åˆ†ç¦»å¼€æ¥ã€‚è¿™æ ·å¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥æé«˜ä»£ç çš„æ€§èƒ½ã€‚</p>
</li>
<li>
<p>ä½¿ç”¨ThreadFactoryæ¥å‘½åçº¿ç¨‹ï¼Œä»¥ä¾¿æ›´å¥½åœ°è·Ÿè¸ªçº¿ç¨‹çš„æ‰§è¡Œæƒ…å†µä»¥åŠæ’æŸ¥é—®é¢˜ã€‚</p>
</li>
<li>
<p>ä½¿ç”¨CompletableFutureçš„exceptionallyæ–¹æ³•å¤„ç†å¼‚å¸¸ï¼Œä»¥é¿å…åœ¨å¤„ç†è¯·æ±‚æ—¶å‡ºç°å¼‚å¸¸è€Œå¯¼è‡´æ•´ä¸ªçº¿ç¨‹åœæ­¢ã€‚</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ActiveObject</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">ActiveObject</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">ActiveObject</span><span class="o">&gt;</span> <span class="n">INSTANCES</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">THREAD_POOL_SIZE</span> <span class="o">=</span> <span class="n">5</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">Runnable</span><span class="o">&gt;</span> <span class="n">requests</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="n">ExecutorService</span> <span class="n">executorService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span> <span class="n">processingFuture</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="kd">volatile</span> <span class="kt">boolean</span> <span class="n">isAcceptingRequests</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="nf">ActiveObject</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">queueSize</span><span class="o">,</span> <span class="n">Long</span> <span class="n">sleepMillis</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">this</span><span class="o">.</span><span class="na">requests</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedBlockingQueue</span><span class="o">&lt;&gt;(</span><span class="n">queueSize</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">this</span><span class="o">.</span><span class="na">executorService</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="n">THREAD_POOL_SIZE</span><span class="o">,</span> <span class="k">new</span> <span class="n">ThreadFactory</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="kd">private</span> <span class="n">AtomicInteger</span> <span class="n">count</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicInteger</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="kd">public</span> <span class="n">Thread</span> <span class="nf">newThread</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span> <span class="k">new</span> <span class="n">Thread</span><span class="o">(</span><span class="n">r</span><span class="o">,</span> <span class="s">&#34;ActiveObject-&#34;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#34;-&#34;</span> <span class="o">+</span> <span class="n">count</span><span class="o">.</span><span class="na">getAndIncrement</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">			<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="o">});</span>
</span></span><span class="line"><span class="cl">		<span class="n">processingFuture</span> <span class="o">=</span> <span class="n">CompletableFuture</span><span class="o">.</span><span class="na">runAsync</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">while</span> <span class="o">(</span><span class="n">isAcceptingRequests</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">				<span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">					<span class="n">executorService</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">requests</span><span class="o">.</span><span class="na">take</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">					<span class="k">if</span> <span class="o">(</span><span class="n">sleepMillis</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">						<span class="n">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">sleepMillis</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">					<span class="o">}</span>
</span></span><span class="line"><span class="cl">				<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">					<span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">interrupt</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">					<span class="n">log</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">&#34;Active Object thread interrupted, reason: {}&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">				<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">					<span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;Error processing request: {}&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">					<span class="c1">// å‘é€å‘Šè­¦ä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="o">}</span>
</span></span><span class="line"><span class="cl">			<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="o">}).</span><span class="na">exceptionally</span><span class="o">(</span><span class="n">e</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">&#34;Exception occurred in ActiveObject thread: {}&#34;</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">		<span class="o">});</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">submit</span><span class="o">(</span><span class="n">Runnable</span> <span class="n">task</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">requests</span><span class="o">.</span><span class="na">offer</span><span class="o">(</span><span class="n">task</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">stop</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">isAcceptingRequests</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">processingFuture</span><span class="o">.</span><span class="na">cancel</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">executorService</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">synchronized</span> <span class="n">ActiveObject</span> <span class="nf">getInstance</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">getInstance</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">16</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="kd">static</span> <span class="kd">synchronized</span> <span class="n">ActiveObject</span> <span class="nf">getInstance</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">queueSize</span><span class="o">,</span> <span class="n">Long</span> <span class="n">sleepMillis</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">ActiveObject</span> <span class="n">instance</span> <span class="o">=</span> <span class="n">INSTANCES</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ActiveObject</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">queueSize</span><span class="o">,</span> <span class="n">sleepMillis</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">			<span class="n">INSTANCES</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">instance</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>æ´»åŠ¨å¯¹è±¡æ¨¡å¼æ˜¯ä¸€ç§æ”¯æŒå¼‚æ­¥å¤„ç†å’Œäº‹ä»¶é©±åŠ¨çš„è®¾è®¡æ¨¡å¼ï¼Œé€‚ç”¨äºä¸€äº›éœ€è¦é«˜æ€§èƒ½ã€å¯ä¼¸ç¼©å’Œå¯é çš„åº”ç”¨åœºæ™¯ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªé€‚ç”¨äºæ´»åŠ¨å¯¹è±¡æ¨¡å¼çš„ä½¿ç”¨åœºæ™¯ï¼š</p>
<ol>
<li>å¤§è§„æ¨¡å¹¶å‘å¤„ç†ï¼šåœ¨å¤§è§„æ¨¡å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ä¼ ç»Ÿçš„åŒæ­¥å¤„ç†æ–¹å¼ä¼šå¯¼è‡´ç³»ç»Ÿæ€§èƒ½ä¸‹é™å’Œå“åº”æ—¶é—´å»¶é•¿ã€‚ä½¿ç”¨æ´»åŠ¨å¯¹è±¡æ¨¡å¼å¯ä»¥å°†å¹¶å‘è¯·æ±‚è½¬æ¢æˆå¼‚æ­¥äº‹ä»¶ï¼Œé€šè¿‡äº‹ä»¶é©±åŠ¨æœºåˆ¶å®ç°é«˜æ€§èƒ½å’Œå¯ä¼¸ç¼©ã€‚</li>
<li>é«˜ååé‡æ•°æ®å¤„ç†ï¼šåœ¨éœ€è¦å¤„ç†å¤§é‡æ•°æ®çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ´»åŠ¨å¯¹è±¡æ¨¡å¼å¯ä»¥åˆ©ç”¨å¤šæ ¸CPUå’Œå¼‚æ­¥å¤„ç†æŠ€æœ¯ï¼Œæé«˜ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›å’Œååé‡ã€‚</li>
<li>å¼‚æ­¥æ¶ˆæ¯ä¼ é€’ï¼šåœ¨éœ€è¦å¼‚æ­¥å¤„ç†æ¶ˆæ¯çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ´»åŠ¨å¯¹è±¡æ¨¡å¼å¯ä»¥å®ç°å¼‚æ­¥æ¶ˆæ¯çš„å¤„ç†å’Œåˆ†å‘ï¼Œæé«˜ç³»ç»Ÿçš„å¯é æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</li>
<li>åˆ†å¸ƒå¼ç³»ç»Ÿï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä½¿ç”¨æ´»åŠ¨å¯¹è±¡æ¨¡å¼å¯ä»¥å®ç°å¼‚æ­¥æ¶ˆæ¯ä¼ é€’å’Œäº‹ä»¶é©±åŠ¨ï¼Œæé«˜ç³»ç»Ÿçš„å¯é æ€§å’Œå¯ä¼¸ç¼©æ€§ã€‚åŒæ—¶ï¼Œæ´»åŠ¨å¯¹è±¡æ¨¡å¼è¿˜å¯ä»¥é€šè¿‡åˆ†å¸ƒå¼é”å’Œåˆ†å¸ƒå¼è®¡ç®—ç­‰æŠ€æœ¯å®ç°åˆ†å¸ƒå¼å¹¶å‘æ§åˆ¶å’Œè®¡ç®—ï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå¯é æ€§ã€‚</li>
<li>UIå’Œåå°é€»è¾‘åˆ†ç¦»ï¼šåœ¨éœ€è¦å°†UIå’Œåå°é€»è¾‘åˆ†ç¦»çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ´»åŠ¨å¯¹è±¡æ¨¡å¼å¯ä»¥å®ç°UIå’Œåå°é€»è¾‘çš„è§£è€¦å’Œå¼‚æ­¥å¤„ç†ï¼Œæé«˜ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚</li>
<li>å¼‚æ­¥IOæ“ä½œï¼šåœ¨éœ€è¦è¿›è¡Œå¼‚æ­¥IOæ“ä½œçš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ´»åŠ¨å¯¹è±¡æ¨¡å¼å¯ä»¥å®ç°éé˜»å¡IOå’Œå¼‚æ­¥äº‹ä»¶å¤„ç†ï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå“åº”æ—¶é—´ã€‚</li>
</ol>
<p>æ€»çš„æ¥è¯´ï¼Œæ´»åŠ¨å¯¹è±¡æ¨¡å¼é€‚ç”¨äºä¸€äº›éœ€è¦å¼‚æ­¥å¤„ç†ã€äº‹ä»¶é©±åŠ¨ã€é«˜æ€§èƒ½ã€å¯ä¼¸ç¼©å’Œå¯é çš„åº”ç”¨åœºæ™¯ã€‚é€šè¿‡ä½¿ç”¨æ´»åŠ¨å¯¹è±¡æ¨¡å¼ï¼Œå¯ä»¥æé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§ï¼ŒåŒæ—¶é™ä½ç³»ç»Ÿçš„å¤æ‚åº¦å’Œæˆæœ¬ã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>ã€ŠEffective Java 3ã€‹ç¬”è®°14ï¼šè€ƒè™‘å®ç° Comparable æ¥å£</title>
      <link>https://blog.chensoul.com/posts/2023/05/26/consider-implementing-comparable/</link>
      <pubDate>Fri, 26 May 2023 09:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/05/26/consider-implementing-comparable/</guid>
      <description>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬ä¸‰ç« ã€Šå¯¹è±¡çš„é€šç”¨æ–¹æ³•ã€‹çš„å­¦ä¹ ç¬”è®°ï¼šè€ƒè™‘å®ç° Comparable æ¥å£ã€‚ ä»‹ç» ä¸æœ¬ç« è®¨è®ºçš„å…¶ä»–æ–¹æ³•ä¸åŒï¼ŒcompareTo æ–¹æ³•ä¸æ˜¯</description>
      <content:encoded><![CDATA[<p>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬ä¸‰ç« ã€Šå¯¹è±¡çš„é€šç”¨æ–¹æ³•ã€‹çš„å­¦ä¹ ç¬”è®°ï¼šè€ƒè™‘å®ç° Comparable æ¥å£ã€‚</p>
<h2 id="ä»‹ç»">ä»‹ç»</h2>
<p>ä¸æœ¬ç« è®¨è®ºçš„å…¶ä»–æ–¹æ³•ä¸åŒï¼ŒcompareTo æ–¹æ³•ä¸æ˜¯åœ¨ Object ä¸­å£°æ˜çš„ã€‚ç›¸åï¼Œå®ƒæ˜¯ Comparable æ¥å£ä¸­çš„å”¯ä¸€æ–¹æ³•ã€‚å®ƒåœ¨æ€§è´¨ä¸Šç±»ä¼¼äº Object çš„ equals æ–¹æ³•ï¼Œé™¤äº†ç®€å•çš„ç›¸ç­‰æ¯”è¾ƒä¹‹å¤–ï¼Œå®ƒè¿˜å…è®¸é¡ºåºæ¯”è¾ƒï¼Œè€Œä¸”å®ƒæ˜¯é€šç”¨çš„ã€‚ä¸€ä¸ªç±»å®ç° Comparableï¼Œè¡¨æ˜å®ä¾‹å…·æœ‰è‡ªç„¶é¡ºåºã€‚å¯¹å®ç° Comparable çš„å¯¹è±¡æ•°ç»„è¿›è¡Œæ’åºéå¸¸ç®€å•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Arrays</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">a</span><span class="o">);</span>
</span></span></code></pre></div><p>ç±»ä¼¼åœ°ï¼Œæœç´¢ã€è®¡ç®—æå€¼å’Œç»´æŠ¤ Comparable å¯¹è±¡çš„è‡ªåŠ¨æ’åºé›†åˆä¹Ÿå¾ˆå®¹æ˜“ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ç¨‹åºä¾èµ–äº String å®ç° Comparable è¿™ä¸€äº‹å®ï¼Œå°†å‘½ä»¤è¡Œå‚æ•°åˆ—è¡¨æŒ‰å­—æ¯é¡ºåºæ‰“å°å‡ºæ¥ï¼Œå¹¶æ¶ˆé™¤é‡å¤ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">WordList</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeSet</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">        <span class="n">Collections</span><span class="o">.</span><span class="na">addAll</span><span class="o">(</span><span class="n">s</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>é€šè¿‡è®©ç±»å®ç° Comparableï¼Œå°±å¯ä¸ä¾èµ–äºæ­¤æ¥å£çš„æ‰€æœ‰é€šç”¨ç®—æ³•å’Œé›†åˆå®ç°è¿›è¡Œäº’æ“ä½œã€‚ä½ åªéœ€ä»˜å‡ºä¸€ç‚¹ç‚¹åŠªåŠ›å°±èƒ½è·å¾—å¼ºå¤§çš„åŠŸèƒ½ã€‚å®é™…ä¸Šï¼ŒJava åº“ä¸­çš„æ‰€æœ‰å€¼ç±»ä»¥åŠæ‰€æœ‰æšä¸¾ç±»å‹éƒ½å®ç°äº† Comparableã€‚å¦‚æœç¼–å†™çš„å€¼ç±»å…·æœ‰æ˜æ˜¾çš„è‡ªç„¶é¡ºåºï¼Œå¦‚å­—æ¯é¡ºåºã€æ•°å­—é¡ºåºæˆ–æ—¶é—´é¡ºåºï¼Œåˆ™åº”å®ç° Comparable æ¥å£ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Comparable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="n">T</span> <span class="n">t</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>compareTo æ–¹æ³•çš„ä¸€èˆ¬çº¦å®šç±»ä¼¼äº equals æ–¹æ³•ï¼š</p>
<p>å°†ä¸€ä¸ªå¯¹è±¡ä¸æŒ‡å®šçš„å¯¹è±¡è¿›è¡Œé¡ºåºæ¯”è¾ƒã€‚å½“è¯¥å¯¹è±¡å°äºã€ç­‰äºæˆ–å¤§äºæŒ‡å®šå¯¹è±¡æ—¶ï¼Œå¯¹åº”è¿”å›ä¸€ä¸ªè´Ÿæ•´æ•°ã€é›¶æˆ–æ­£æ•´æ•°ã€‚å¦‚æœæŒ‡å®šå¯¹è±¡çš„ç±»å‹é˜»æ­¢å®ƒä¸è¯¥å¯¹è±¡è¿›è¡Œæ¯”è¾ƒï¼Œåˆ™æŠ›å‡º ClassCastExceptionã€‚</p>
<p>åœ¨ä¸‹é¢çš„æè¿°ä¸­ï¼Œ<code>sgn(expression)</code> è¡¨ç¤ºæ•°å­¦ä¸­çš„ç¬¦å·å‡½æ•°ï¼Œå®ƒè¢«å®šä¹‰ä¸ºï¼šæ ¹æ®ä¼ å…¥è¡¨è¾¾å¼çš„å€¼æ˜¯è´Ÿæ•°ã€é›¶æˆ–æ­£æ•°ï¼Œå¯¹åº”è¿”å› -1ã€0 æˆ– 1ã€‚</p>
<ul>
<li>å®ç°è€…å¿…é¡»ç¡®ä¿æ‰€æœ‰ x å’Œ y æ»¡è¶³ <code>sgn(x.compareTo(y)) == -sgn(y.compareTo(x))</code>ï¼ˆè¿™æ„å‘³ç€ <code>x.compareTo(y)</code> å½“ä¸”ä»…å½“ <code>y.compareTo(x)</code> æŠ›å‡ºå¼‚å¸¸æ—¶æ‰æŠ›å‡ºå¼‚å¸¸ï¼‰ã€‚</li>
<li>å®ç°è€…è¿˜å¿…é¡»ç¡®ä¿å…³ç³»æ˜¯å¯ä¼ é€’çš„ï¼š<code>(x.compareTo(y) &gt; 0 &amp;&amp; y.compareTo(z) &gt; 0)</code> æ„å‘³ç€ <code>x.compareTo(z) &gt; 0</code>ã€‚</li>
<li>æœ€åï¼Œå®ç°è€…å¿…é¡»ç¡®ä¿ <code>x.compareTo(y) == 0</code> æ—¶ï¼Œæ‰€æœ‰çš„ z æ»¡è¶³ <code>sgn(x.compareTo(z)) == sgn(y.compareTo(z))</code>ã€‚</li>
<li>å¼ºçƒˆå»ºè®® <code>(x.compareTo(y)== 0) == (x.equals(y))</code> æˆç«‹ï¼Œä½†ä¸æ˜¯å¿…éœ€çš„ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä»»ä½•å®ç° Comparable æ¥å£å¹¶è¿åæ­¤æ¡ä»¶çš„ç±»éƒ½åº”è¯¥æ¸…æ¥šåœ°æ³¨æ˜è¿™ä¸€äº‹å®ã€‚æ¨èä½¿ç”¨çš„è¡¨è¿°æ˜¯ã€Œæ³¨æ„ï¼šè¯¥ç±»çš„è‡ªç„¶é¡ºåºä¸ equals ä¸ä¸€è‡´ã€‚ã€</li>
</ul>
<p>ä¸è¦è¢«è¿™äº›çº¦å®šçš„æ•°å­¦æ€§è´¨æ‰€å½±å“ã€‚å°±åƒ equals çº¦å®šä¸€æ ·ï¼Œè¿™ä¸ªçº¦å®šå¹¶ä¸åƒçœ‹èµ·æ¥é‚£ä¹ˆå¤æ‚ã€‚ä¸ equals æ–¹æ³•ä¸åŒï¼Œequals æ–¹æ³•å¯¹æ‰€æœ‰å¯¹è±¡éƒ½æ–½åŠ äº†å…¨å±€ç­‰ä»·å…³ç³»ï¼ŒcompareTo ä¸éœ€è¦è·¨è¶Šä¸åŒç±»å‹çš„å¯¹è±¡å·¥ä½œï¼šå½“é‡åˆ°ä¸åŒç±»å‹çš„å¯¹è±¡æ—¶ï¼ŒcompareTo å…è®¸æŠ›å‡º ClassCastExceptionã€‚é€šå¸¸ï¼Œå®ƒå°±æ˜¯è¿™ä¹ˆåšçš„ã€‚è¯¥çº¦å®šç¡®å®å…è®¸ç±»å‹é—´æ¯”è¾ƒï¼Œè¿™ç§æ¯”è¾ƒé€šå¸¸åœ¨è¢«æ¯”è¾ƒå¯¹è±¡å®ç°çš„æ¥å£ä¸­å®šä¹‰ã€‚</p>
<p>å°±åƒè¿å hashCode çº¦å®šçš„ç±»å¯ä»¥ç ´åä¾èµ– hash çš„å…¶ä»–ç±»ä¸€æ ·ï¼Œè¿å compareTo çº¦å®šçš„ç±»ä¹Ÿå¯ä»¥ç ´åä¾èµ– Comparable çš„å…¶ä»–ç±»ã€‚ä¾èµ– Comparable çš„ç±»åŒ…æ‹¬æ’åºé›†åˆ TreeSet å’Œ TreeMapï¼Œä»¥åŠå®ç”¨å·¥å…·ç±» Collections å’Œ Arraysï¼Œå®ƒä»¬éƒ½åŒ…å«æœç´¢å’Œæ’åºç®—æ³•ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ compareTo çº¦å®šçš„ç»†èŠ‚ã€‚ç¬¬ä¸€ä¸ªè§„å®šæŒ‡å‡ºï¼Œå¦‚æœä½ é¢ å€’ä¸¤ä¸ªå¯¹è±¡å¼•ç”¨ä¹‹é—´çš„æ¯”è¾ƒçš„æ–¹å‘ï¼Œå°±åº”å½“å‘ç”Ÿè¿™æ ·çš„æƒ…å†µï¼šå¦‚æœç¬¬ä¸€ä¸ªå¯¹è±¡å°äºç¬¬äºŒä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªå¯¹è±¡å¿…é¡»å¤§äºç¬¬ä¸€ä¸ªï¼›å¦‚æœç¬¬ä¸€ä¸ªå¯¹è±¡ç­‰äºç¬¬äºŒä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªå¯¹è±¡ä¸€å®šç­‰äºç¬¬ä¸€ä¸ªå¯¹è±¡ï¼›å¦‚æœç¬¬ä¸€ä¸ªå¯¹è±¡å¤§äºç¬¬äºŒä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªå¯¹è±¡ä¸€å®šå°äºç¬¬ä¸€ä¸ªå¯¹è±¡ã€‚ç¬¬äºŒä¸ªè§„å®šæŒ‡å‡ºï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡å¤§äºç¬¬äºŒä¸ªï¼Œç¬¬äºŒä¸ªå¤§äºç¬¬ä¸‰ä¸ªï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªå¯¹è±¡ä¸€å®šå¤§äºç¬¬ä¸‰ä¸ªå¯¹è±¡ã€‚æœ€åä¸€ä¸ªè§„å®šæŒ‡å‡ºï¼Œæ‰€æœ‰ compareTo ç»“æœä¸ºç›¸ç­‰çš„å¯¹è±¡åˆ†åˆ«ä¸ä»»ä½•å…¶ä»–å¯¹è±¡ç›¸æ¯”ï¼Œå¿…é¡»äº§ç”Ÿç›¸åŒçš„ç»“æœã€‚</p>
<p>è¿™ä¸‰ç§è§„å®šçš„ä¸€ä¸ªç»“æœæ˜¯ï¼Œç”± compareTo æ–¹æ³•è¿›è¡Œçš„ç›¸ç­‰æ€§æ£€éªŒå¿…é¡»éµå®ˆç”± equals çº¦å®šè¿›è¡Œçš„ç›¸åŒçš„é™åˆ¶ï¼šåèº«æ€§ã€å¯¹ç§°æ€§å’Œä¼ é€’æ€§ã€‚å› æ­¤ï¼ŒåŒæ ·çš„è­¦å‘Šä¹Ÿé€‚ç”¨äºæ­¤ï¼šé™¤éä½ æ„¿æ„æ”¾å¼ƒé¢å‘å¯¹è±¡çš„æŠ½è±¡ä¼˜ç‚¹ï¼Œå¦åˆ™æ— æ³•åœ¨ä¿ç•™ compareTo çº¦å®šçš„åŒæ—¶ä½¿ç”¨æ–°å€¼ç»„ä»¶æ‰©å±•å¯å®ä¾‹åŒ–ç±»ã€‚åŒæ ·çš„è§£å†³æ–¹æ¡ˆä¹Ÿé€‚ç”¨ã€‚å¦‚æœè¦å‘å®ç° Comparable çš„ç±»ä¸­æ·»åŠ å€¼ç»„ä»¶ï¼Œä¸è¦ç»§æ‰¿å®ƒï¼›ç¼–å†™ä¸€ä¸ªä¸ç›¸å…³çš„ç±»ï¼Œå…¶ä¸­åŒ…å«ç¬¬ä¸€ä¸ªç±»çš„å®ä¾‹ã€‚ç„¶åæä¾›è¿”å›æ‰€åŒ…å«å®ä¾‹çš„ã€Œè§†å›¾ã€æ–¹æ³•ã€‚è¿™ä½¿ä½ å¯ä»¥è‡ªç”±åœ°åœ¨åŒ…å«ç±»ä¸Šå®ç°ä½ å–œæ¬¢çš„ä»»ä½• compareTo æ–¹æ³•ï¼ŒåŒæ—¶å…è®¸å®ƒçš„å®¢æˆ·ç«¯åœ¨éœ€è¦æ—¶å°†åŒ…å«ç±»çš„å®ä¾‹è§†ä¸ºåŒ…å«ç±»çš„å®ä¾‹ã€‚</p>
<p>compareTo çº¦å®šçš„æœ€åä¸€æ®µæ˜¯ä¸€ä¸ªå¼ºçƒˆçš„å»ºè®®ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„è¦æ±‚ï¼Œå®ƒåªæ˜¯ç®€å•åœ°è¯´æ˜äº† compareTo æ–¹æ³•æ‰€æ–½åŠ çš„åŒç­‰æ€§æ£€éªŒé€šå¸¸åº”è¯¥ä¸ equals æ–¹æ³•è¿”å›ç›¸åŒçš„ç»“æœã€‚å¦‚æœéµå®ˆäº†è¿™ä¸€è§„å®šï¼Œåˆ™ compareTo æ–¹æ³•æ‰€æ–½åŠ çš„æ’åºä¸ equals æ–¹æ³•ä¸€è‡´ã€‚å¦‚æœè¿åè¿™æ¡å»ºè®®ï¼Œé‚£ä¹ˆå®ƒçš„é¡ºåºå°±ä¸ equals ä¸ä¸€è‡´ã€‚å¦‚æœä¸€ä¸ªç±»çš„ compareTo æ–¹æ³•å¼ºåŠ äº†ä¸€ä¸ªä¸ equals ä¸ä¸€è‡´çš„é¡ºåºï¼Œé‚£ä¹ˆè¿™ä¸ªç±»ä»ç„¶å¯ä»¥å·¥ä½œï¼Œä½†æ˜¯åŒ…å«è¯¥ç±»å…ƒç´ çš„æœ‰åºé›†åˆå¯èƒ½æ— æ³•éµå®ˆé›†åˆæ¥å£ï¼ˆCollectionã€Set æˆ– Mapï¼‰çš„ä¸€èˆ¬çº¦å®šã€‚è¿™æ˜¯å› ä¸ºè¿™äº›æ¥å£çš„ä¸€èˆ¬çº¦å®šæ˜¯æ ¹æ® equals æ–¹æ³•å®šä¹‰çš„ï¼Œä½†æ˜¯æœ‰åºé›†åˆä½¿ç”¨ compareTo ä»£æ›¿äº† equals å®æ–½åŒç­‰æ€§æ£€éªŒã€‚å¦‚æœå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œè¿™ä¸æ˜¯ä¸€åœºç¾éš¾ï¼Œä½†è¿™æ˜¯éœ€è¦æ³¨æ„çš„ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè€ƒè™‘ BigDecimal ç±»ï¼Œå®ƒçš„ compareTo æ–¹æ³•ä¸ equals ä¸ä¸€è‡´ã€‚å¦‚æœä½ åˆ›å»ºä¸€ä¸ªç©ºçš„ HashSet å®ä¾‹ï¼Œç„¶åæ·»åŠ  <code>new BigDecimal(&quot;1.0&quot;)</code> å’Œ <code>new BigDecimal(&quot;1.00&quot;)</code>ï¼Œé‚£ä¹ˆè¯¥ HashSet å°†åŒ…å«ä¸¤ä¸ªå…ƒç´ ï¼Œå› ä¸ºæ·»åŠ åˆ°è¯¥é›†åˆçš„ä¸¤ä¸ª BigDecimal å®ä¾‹åœ¨ä½¿ç”¨ equals æ–¹æ³•è¿›è¡Œæ¯”è¾ƒæ—¶ç»“æœæ˜¯ä¸ç›¸ç­‰çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ ä½¿ç”¨ TreeSet è€Œä¸æ˜¯ HashSet æ‰§è¡Œç›¸åŒçš„è¿‡ç¨‹ï¼Œé‚£ä¹ˆè¯¥é›†åˆå°†åªåŒ…å«ä¸€ä¸ªå…ƒç´ ï¼Œå› ä¸ºä½¿ç”¨ compareTo æ–¹æ³•æ¯”è¾ƒä¸¤ä¸ª BigDecimal å®ä¾‹æ—¶ç»“æœæ˜¯ç›¸ç­‰çš„ã€‚ï¼ˆæœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… BigDecimal æ–‡æ¡£ã€‚ï¼‰</p>
<p>ç¼–å†™ compareTo æ–¹æ³•ç±»ä¼¼äºç¼–å†™ equals æ–¹æ³•ï¼Œä½†æ˜¯æœ‰ä¸€äº›å…³é”®çš„åŒºåˆ«ã€‚å› ä¸º Comparable æ¥å£æ˜¯å‚æ•°åŒ–çš„ï¼ŒcompareTo æ–¹æ³•æ˜¯é™æ€ç±»å‹çš„ï¼Œæ‰€ä»¥ä¸éœ€è¦è¿›è¡Œç±»å‹æ£€æŸ¥æˆ–å¼ºåˆ¶è½¬æ¢å®ƒçš„å‚æ•°ã€‚å¦‚æœå‚æ•°ç±»å‹é”™è¯¯ï¼Œåˆ™è¯¥è°ƒç”¨å°†ä¸èƒ½ç¼–è¯‘ã€‚å¦‚æœå‚æ•°ä¸º nullï¼Œåˆ™è°ƒç”¨åº”è¯¥æŠ›å‡º NullPointerExceptionï¼Œå¹¶ä¸”åœ¨æ–¹æ³•å°è¯•è®¿é—®å…¶æˆå‘˜æ—¶æŠ›å‡ºè¯¥å¼‚å¸¸ã€‚</p>
<p>åœ¨ compareTo æ–¹æ³•ä¸­ï¼Œå­—æ®µæ˜¯æŒ‰é¡ºåºè€Œä¸æ˜¯æŒ‰åŒç­‰æ€§æ¥æ¯”è¾ƒçš„ã€‚è¦æ¯”è¾ƒå¯¹è±¡å¼•ç”¨å­—æ®µï¼Œè¦é€’å½’è°ƒç”¨ compareTo æ–¹æ³•ã€‚å¦‚æœä¸€ä¸ªå­—æ®µæ²¡æœ‰å®ç° Comparableï¼Œæˆ–è€…éœ€è¦ä¸€ä¸ªéæ ‡å‡†çš„æ’åºï¼Œé‚£ä¹ˆåº”ä½¿ç”¨ Comparatorã€‚å¯ä»¥ç¼–å†™è‡ªå®šä¹‰çš„æ¯”è¾ƒå™¨ï¼Œæˆ–ä½¿ç”¨ç°æœ‰çš„æ¯”è¾ƒå™¨ï¼Œå¦‚ CaseInsensitiveString çš„ compareTo æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Single-field Comparable with object reference field
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">CaseInsensitiveString</span> <span class="kd">implements</span> <span class="n">Comparable</span><span class="o">&lt;</span><span class="n">CaseInsensitiveString</span><span class="o">&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="n">CaseInsensitiveString</span> <span class="n">cis</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">CASE_INSENSITIVE_ORDER</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="n">s</span><span class="o">,</span> <span class="n">cis</span><span class="o">.</span><span class="na">s</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="o">...</span> <span class="c1">// Remainder omitted
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>æ³¨æ„ CaseInsensitiveString å®ç°äº† <code>Comparable&lt;CaseInsensitiveString&gt;</code>ã€‚è¿™æ„å‘³ç€ CaseInsensitiveString å¼•ç”¨åªèƒ½ä¸å¦ä¸€ä¸ª CaseInsensitiveString å¼•ç”¨è¿›è¡Œæ¯”è¾ƒã€‚è¿™æ˜¯åœ¨å£°æ˜å®ç° Comparable çš„ç±»æ—¶è¦éµå¾ªçš„å¸¸è§„æ¨¡å¼ã€‚</p>
<p>æœ¬ä¹¦çš„æ—§ç‰ˆæœ¬å»ºè®® compareTo æ–¹æ³•ä½¿ç”¨å…³ç³»è¿ç®—ç¬¦ &lt; å’Œ &gt; æ¥æ¯”è¾ƒæ•´æ•°åŸºæœ¬ç±»å‹å­—æ®µï¼Œä½¿ç”¨é™æ€æ–¹æ³• <code>Double.compare</code> å’Œ <code>Float.compare</code> æ¥æ¯”è¾ƒæµ®ç‚¹åŸºæœ¬ç±»å‹å­—æ®µã€‚åœ¨ Java 7 ä¸­ï¼Œé™æ€æ¯”è¾ƒæ–¹æ³•è¢«æ·»åŠ åˆ°æ‰€æœ‰ Java çš„åŒ…è£…ç±»ä¸­ã€‚<strong>åœ¨ compareTo æ–¹æ³•ä¸­ä½¿ç”¨å…³ç³»è¿ç®—ç¬¦ &lt; å’Œ &gt; å†—é•¿ä¸”å®¹æ˜“å‡ºé”™ï¼Œå› æ­¤ä¸å†æ¨èä½¿ç”¨ã€‚</strong></p>
<p>å¦‚æœä¸€ä¸ªç±»æœ‰å¤šä¸ªé‡è¦å­—æ®µï¼Œé‚£ä¹ˆæ¯”è¾ƒå®ƒä»¬çš„é¡ºåºéå¸¸å…³é”®ã€‚ä»æœ€é‡è¦çš„å­—æ®µå¼€å§‹ï¼Œä¸€æ­¥æ­¥å¾€ä¸‹ã€‚å¦‚æœæ¯”è¾ƒçš„ç»“æœä¸æ˜¯ 0ï¼ˆç”¨ 0 è¡¨ç¤ºç›¸ç­‰ï¼‰ï¼Œé‚£ä¹ˆå°±å®Œæˆäº†ï¼›ç›´æ¥è¿”å›ç»“æœã€‚å¦‚æœæœ€é‡è¦çš„å­—æ®µæ˜¯ç›¸ç­‰çš„ï¼Œå°±æ¯”è¾ƒä¸‹ä¸€ä¸ªæœ€é‡è¦çš„å­—æ®µï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªä¸ç›¸ç­‰çš„å­—æ®µæˆ–æ¯”è¾ƒåˆ°æœ€ä¸é‡è¦çš„å­—æ®µä¸ºæ­¢ã€‚ä¸‹é¢æ˜¯ PhoneNumber ç±»çš„ compareTo æ–¹æ³•ï¼Œæ¼”ç¤ºäº†è¿™ç§æŠ€æœ¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Multiple-field Comparable with primitive fields
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="n">PhoneNumber</span> <span class="n">pn</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">Short</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="n">areaCode</span><span class="o">,</span> <span class="n">pn</span><span class="o">.</span><span class="na">areaCode</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">result</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="n">Short</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="n">prefix</span><span class="o">,</span> <span class="n">pn</span><span class="o">.</span><span class="na">prefix</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">result</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span> <span class="o">=</span> <span class="n">Short</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="n">lineNum</span><span class="o">,</span> <span class="n">pn</span><span class="o">.</span><span class="na">lineNum</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨ Java 8 ä¸­ï¼ŒComparator æ¥å£é…å¤‡äº†ä¸€ç»„æ¯”è¾ƒå™¨æ„é€ æ–¹æ³•ï¼Œå¯ä»¥æµç•…åœ°æ„é€ æ¯”è¾ƒå™¨ã€‚ç„¶åå¯ä»¥ä½¿ç”¨è¿™äº›æ¯”è¾ƒå™¨æ¥å®ç° Comparator æ¥å£æ‰€è¦æ±‚çš„ compareTo æ–¹æ³•ã€‚è®¸å¤šç¨‹åºå‘˜æ›´å–œæ¬¢è¿™ç§æ–¹æ³•çš„ç®€æ˜ï¼Œå°½ç®¡å®ƒå­˜åœ¨ä¸€äº›æ€§èƒ½æˆæœ¬ï¼šåœ¨æˆ‘çš„æœºå™¨ä¸Šï¼ŒPhoneNumber å®ä¾‹çš„æ•°ç»„æ’åºè¦æ…¢ 10% å·¦å³ã€‚åœ¨ä½¿ç”¨è¿™ç§æ–¹æ³•æ—¶ï¼Œè¯·è€ƒè™‘ä½¿ç”¨ Java çš„é™æ€å¯¼å…¥åŠŸèƒ½ï¼Œè¿™æ ·ä½ å°±å¯ä»¥é€šè¿‡é™æ€æ¯”è¾ƒå™¨æ„é€ æ–¹æ³•çš„ç®€å•åç§°æ¥å¼•ç”¨å®ƒä»¬ï¼Œä»¥è·å¾—æ¸…æ™°å’Œç®€æ´ã€‚ä¸‹é¢æ˜¯ PhoneNumber ç±»çš„ compareTo æ–¹æ³•æ”¹è¿›åçš„æ ·å­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Comparable with comparator construction methods
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">PhoneNumber</span><span class="o">&gt;</span> <span class="n">COMPARATOR</span> <span class="o">=</span> <span class="n">comparingInt</span><span class="o">((</span><span class="n">PhoneNumber</span> <span class="n">pn</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">pn</span><span class="o">.</span><span class="na">areaCode</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">thenComparingInt</span><span class="o">(</span><span class="n">pn</span> <span class="o">-&gt;</span> <span class="n">pn</span><span class="o">.</span><span class="na">prefix</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">thenComparingInt</span><span class="o">(</span><span class="n">pn</span> <span class="o">-&gt;</span> <span class="n">pn</span><span class="o">.</span><span class="na">lineNum</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="n">PhoneNumber</span> <span class="n">pn</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">COMPARATOR</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">pn</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>è¿™ä¸ªå®ç°åœ¨ç±»åˆå§‹åŒ–æ—¶ä½¿ç”¨ä¸¤ä¸ªæ¯”è¾ƒå™¨æ„é€ æ–¹æ³•æ„å»ºä¸€ä¸ªæ¯”è¾ƒå™¨ã€‚ç¬¬ä¸€ä¸ªæ˜¯ comparingIntã€‚å®ƒæ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œæ¥å—ä¸€ä¸ª key æå–å™¨å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†å¯¹è±¡å¼•ç”¨æ˜ å°„åˆ° int ç±»å‹çš„ key ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ¯”è¾ƒå™¨ï¼Œæ¯”è¾ƒå™¨æ ¹æ®è¯¥ key å¯¹å®ä¾‹è¿›è¡Œæ’åºã€‚åœ¨ä¸Šè¿°çš„ç¤ºä¾‹ä¸­ï¼ŒcomparingInt ä½¿ç”¨ lambda è¡¨è¾¾å¼ä» PhoneNumber ä¸­æå– areaCodeï¼Œå¹¶è¿”å› <code>Comparator&lt;PhoneNumber&gt;</code>ï¼ŒæŒ‰åŒºå·æ¥æ’åºç”µè¯å·ç ã€‚æ³¨æ„ï¼Œlambda è¡¨è¾¾å¼æ˜¾å¼åœ°æŒ‡å®šå…¶è¾“å…¥å‚æ•°çš„ç±»å‹ä¸º PhoneNumberã€‚äº‹å®è¯æ˜ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒJava çš„ç±»å‹æ¨æ–­å¹¶æ²¡æœ‰å¼ºå¤§åˆ°è¶³ä»¥è‡ªå·±åˆ¤æ–­ç±»å‹ï¼Œå› æ­¤æˆ‘ä»¬ä¸å¾—ä¸å¸®åŠ©å®ƒæ¥ç¼–è¯‘ç¨‹åºã€‚</p>
<p>å¦‚æœä¸¤ä¸ªç”µè¯å·ç æœ‰ç›¸åŒçš„åŒºå·ï¼Œæˆ‘ä»¬éœ€è¦è¿›ä¸€æ­¥æ”¹è¿›æ¯”è¾ƒï¼Œè¿™æ­£æ˜¯ç¬¬äºŒä¸ª comparator æ„é€ æ–¹æ³• thenComparingInt æ‰€åšçš„ã€‚å®ƒæ˜¯ Comparator ä¸Šçš„ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼Œå®ƒæ¥å—ä¸€ä¸ª int ç±»å‹çš„ key æå–å‡½æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ¯”è¾ƒå™¨ï¼Œè¯¥æ¯”è¾ƒå™¨é¦–å…ˆåº”ç”¨åŸå§‹æ¯”è¾ƒå™¨ï¼Œç„¶åä½¿ç”¨æå–çš„ key æ¥æ–­å¼€è¿æ¥ã€‚ä½ å¯ä»¥ä»»æ„å †å å¯¹ thenComparingInt çš„è°ƒç”¨ï¼Œä»è€Œå½¢æˆå­—å…¸é¡ºåºã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†ä¸¤ä¸ªå¯¹ thenComparingInt çš„è°ƒç”¨å åŠ èµ·æ¥ï¼Œå¾—åˆ°ä¸€ä¸ªæ’åºï¼Œå®ƒçš„ç¬¬äºŒä¸ª key æ˜¯ prefixï¼Œè€Œç¬¬ä¸‰ä¸ª key æ˜¯ lineNumã€‚æ³¨æ„ï¼Œæˆ‘ä»¬ä¸å¿…æŒ‡å®šä¼ é€’ç»™ä¸¤ä¸ªè°ƒç”¨ thenComparingInt çš„ key æå–å™¨å‡½æ•°çš„å‚æ•°ç±»å‹ï¼šJava çš„ç±»å‹æ¨æ–­è¶³å¤Ÿæ™ºèƒ½ï¼Œå¯ä»¥è‡ªè¡Œè§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>Comparator ç±»å…·æœ‰å®Œæ•´çš„æ„é€ æ–¹æ³•ã€‚å¯¹äº long å’Œ double çš„åŸºæœ¬ç±»å‹ï¼Œæœ‰ç±»ä¼¼ comparingInt å’Œ thenComparingInt çš„æ–¹æ³•ã€‚int ç‰ˆæœ¬è¿˜å¯ä»¥ç”¨äºèŒƒå›´æ›´å°çš„æ•´æ•°ç±»å‹ï¼Œå¦‚ PhoneNumber ç¤ºä¾‹ä¸­çš„ shortã€‚double ç‰ˆæœ¬ä¹Ÿå¯ä»¥ç”¨äº floatã€‚Comparator ç±»æä¾›çš„æ„é€ æ–¹æ³•è¦†ç›–äº†æ‰€æœ‰ Java æ•°å€¼åŸºæœ¬ç±»å‹ã€‚</p>
<p>ä¹Ÿæœ‰å¯¹è±¡å¼•ç”¨ç±»å‹çš„æ¯”è¾ƒå™¨æ„é€ æ–¹æ³•ã€‚é™æ€æ–¹æ³•åä¸º compareï¼Œå®ƒæœ‰ä¸¤ä¸ªé‡è½½ã€‚ä¸€ä¸ªæ˜¯ä½¿ç”¨ key æå–å™¨å¹¶ä½¿ç”¨ key çš„è‡ªç„¶é¡ºåºã€‚ç¬¬äºŒç§æ–¹æ³•åŒæ—¶ä½¿ç”¨ key æå–å™¨å’Œæ¯”è¾ƒå™¨å¯¹æå–çš„ key è¿›è¡Œæ¯”è¾ƒã€‚å®ä¾‹æ–¹æ³•æœ‰ä¸‰ç§é‡è½½ï¼Œç§°ä¸º thenComparingã€‚ä¸€ä¸ªé‡è½½åªéœ€è¦ä¸€ä¸ªæ¯”è¾ƒå™¨å¹¶ä½¿ç”¨å®ƒæ¥æä¾›ä¸€ä¸ªäºŒçº§é¡ºåºã€‚ç¬¬äºŒä¸ªé‡è½½åªæ¥å—ä¸€ä¸ª key æå–å™¨ï¼Œå¹¶å°† key çš„è‡ªç„¶é¡ºåºç”¨ä½œäºŒçº§é¡ºåºã€‚æœ€åçš„é‡è½½éœ€è¦ä¸€ä¸ª key æå–å™¨å’Œä¸€ä¸ªæ¯”è¾ƒå™¨æ¥å¯¹æå–çš„ key è¿›è¡Œæ¯”è¾ƒã€‚</p>
<p>æœ‰æ—¶å€™ï¼Œä½ å¯èƒ½ä¼šçœ‹åˆ° compareTo æˆ– compare æ–¹æ³•ï¼Œå®ƒä»¬ä¾èµ–äºä»¥ä¸‹äº‹å®ï¼šå¦‚æœç¬¬ä¸€ä¸ªå€¼å°äºç¬¬äºŒä¸ªå€¼ï¼Œåˆ™ä¸¤ä¸ªå€¼ä¹‹é—´çš„å·®ä¸ºè´Ÿï¼›å¦‚æœä¸¤ä¸ªå€¼ç›¸ç­‰ï¼Œåˆ™ä¸ºé›¶ï¼›å¦‚æœç¬¬ä¸€ä¸ªå€¼å¤§äºé›¶ï¼Œåˆ™ä¸ºæ­£ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// BROKEN difference-based comparator - violates transitivity!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">static</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">hashCodeOrder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Comparator</span><span class="o">&lt;&gt;()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="n">Object</span> <span class="n">o1</span><span class="o">,</span> <span class="n">Object</span> <span class="n">o2</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">o1</span><span class="o">.</span><span class="na">hashCode</span><span class="o">()</span> <span class="o">-</span> <span class="n">o2</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">};</span>
</span></span></code></pre></div><p>ä¸è¦ä½¿ç”¨è¿™ç§æŠ€æœ¯ã€‚å®ƒå……æ»¡äº†æ¥è‡ªæ•´æ•°æº¢å‡ºå’Œ IEEE 754 æµ®ç‚¹è¿ç®—æ„ä»¶çš„å±é™© [JLS 15.20.1, 15.21.1]ã€‚æ­¤å¤–ï¼Œç”Ÿæˆçš„æ–¹æ³•ä¸å¤ªå¯èƒ½æ¯”ä½¿ç”¨æœ¬é¡¹ç›®ä¸­æè¿°çš„æŠ€æœ¯ç¼–å†™çš„æ–¹æ³•å¿«å¾—å¤šã€‚åº”ä½¿ç”¨é™æ€æ¯”è¾ƒæ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Comparator based on static compare method
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">static</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">hashCodeOrder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Comparator</span><span class="o">&lt;&gt;()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="n">Object</span> <span class="n">o1</span><span class="o">,</span> <span class="n">Object</span> <span class="n">o2</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="n">o1</span><span class="o">.</span><span class="na">hashCode</span><span class="o">(),</span> <span class="n">o2</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">};</span>
</span></span></code></pre></div><p>æˆ–æ¯”è¾ƒå™¨æ„é€ æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Comparator based on Comparator construction method
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">static</span> <span class="n">Comparator</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">hashCodeOrder</span> <span class="o">=</span> <span class="n">Comparator</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">comparingInt</span><span class="o">(</span><span class="n">o</span> <span class="o">-&gt;</span> <span class="n">o</span><span class="o">.</span><span class="na">hashCode</span><span class="o">());</span>
</span></span></code></pre></div><p>æ€»ä¹‹ï¼Œæ— è®ºä½•æ—¶å®ç°å…·æœ‰æ’åºæ€§è´¨çš„å€¼ç±»ï¼Œéƒ½åº”è¯¥è®©ç±»å®ç° Comparable æ¥å£ï¼Œè¿™æ ·å°±å¯ä»¥è½»æ¾åœ°å¯¹å®ä¾‹è¿›è¡Œæ’åºã€æœç´¢ï¼Œå¹¶ä¸ä¾èµ–äºæ­¤æ¥å£çš„é›†åˆå®ç°è¿›è¡Œäº’æ“ä½œã€‚åœ¨ compareTo æ–¹æ³•çš„å®ç°ä¸­æ¯”è¾ƒå­—æ®µå€¼æ—¶ï¼Œé¿å…ä½¿ç”¨ &lt; å’Œ &gt; æ“ä½œç¬¦ï¼Œåº”ä½¿ç”¨åŒ…è£…ç±»ä¸­çš„é™æ€æ¯”è¾ƒæ–¹æ³•æˆ– Comparator æ¥å£ä¸­çš„ comparator æ„é€ æ–¹æ³•ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>å»ºè®®åœ¨å®ç°æ¯”è¾ƒåŠŸèƒ½æ—¶ï¼Œåº”è¯¥è€ƒè™‘å®ç° <code>Comparable</code> æ¥å£ã€‚<code>Comparable</code> æ¥å£æ˜¯ä¸€ä¸ªæ³›å‹æ¥å£ï¼Œå…¶ä¸­åªåŒ…å«ä¸€ä¸ªæ–¹æ³• <code>compareTo(T o)</code>ï¼Œç”¨äºæ¯”è¾ƒå½“å‰å¯¹è±¡å’Œå¦ä¸€ä¸ªå¯¹è±¡çš„å¤§å°å…³ç³»ã€‚å®ç° <code>Comparable</code> æ¥å£å¯ä»¥ä½¿å¾—ä¸€ä¸ªç±»å…·æœ‰å¯æ¯”æ€§ï¼Œä»è€Œå¯ä»¥è¿›è¡Œæ’åºç­‰æ“ä½œã€‚</p>
<p>ä»¥ä¸‹æ˜¯åœ¨å®ç° <code>Comparable</code> æ¥å£æ—¶éœ€è¦æ³¨æ„çš„ä¸€äº›é—®é¢˜ï¼š</p>
<ol>
<li>é¦–å…ˆï¼Œéœ€è¦ç¡®ä¿ç±»å®ç°äº† <code>Comparable</code> æ¥å£ï¼Œå¹¶å®ç°äº† <code>compareTo</code> æ–¹æ³•ã€‚åœ¨å®ç° <code>compareTo</code> æ–¹æ³•æ—¶ï¼Œéœ€è¦è€ƒè™‘åˆ°å¯¹è±¡çš„æ¯”è¾ƒé¡ºåºï¼Œå¹¶è¿”å›ä¸€ä¸ªæ•´æ•°å€¼è¡¨ç¤ºä¸¤ä¸ªå¯¹è±¡ä¹‹é—´çš„å¤§å°å…³ç³»ã€‚</li>
<li>åœ¨å®ç° <code>compareTo</code> æ–¹æ³•æ—¶ï¼Œéœ€è¦ç¡®ä¿æ¯”è¾ƒç»“æœçš„ä¸€è‡´æ€§ã€å¯¹ç§°æ€§å’Œä¼ é€’æ€§ã€‚å…·ä½“æ¥è¯´ï¼Œå¦‚æœ <code>a.compareTo(b)</code> è¿”å›æ­£æ•´æ•°ï¼Œé‚£ä¹ˆ <code>b.compareTo(a)</code> åº”è¯¥è¿”å›è´Ÿæ•´æ•°ï¼›å¦‚æœ <code>a.compareTo(b)</code> å’Œ <code>b.compareTo(c)</code> çš„è¿”å›å€¼éƒ½æ˜¯æ­£æ•´æ•°ï¼Œé‚£ä¹ˆ <code>a.compareTo(c)</code> çš„è¿”å›å€¼ä¹Ÿåº”è¯¥æ˜¯æ­£æ•´æ•°ã€‚</li>
<li>å¦‚æœä¸€ä¸ªç±»æœ‰å¤šä¸ªå¯ä»¥æ¯”è¾ƒçš„å±æ€§ï¼Œé‚£ä¹ˆåœ¨å®ç° <code>compareTo</code> æ–¹æ³•æ—¶éœ€è¦æŒ‰ç…§æ¯”è¾ƒçš„ä¼˜å…ˆçº§è¿›è¡Œæ¯”è¾ƒã€‚é€šå¸¸ï¼Œå¯ä»¥å…ˆæ¯”è¾ƒç¬¬ä¸€ä¸ªå±æ€§ï¼Œå¦‚æœç›¸ç­‰å†æ¯”è¾ƒç¬¬äºŒä¸ªå±æ€§ï¼Œä»¥æ­¤ç±»æ¨ã€‚</li>
<li>å¦‚æœä¸€ä¸ªç±»å®ç°äº† <code>Comparable</code> æ¥å£ï¼Œé‚£ä¹ˆé€šå¸¸ä¹Ÿåº”è¯¥åŒæ—¶å®ç° <code>equals</code> å’Œ <code>hashCode</code> æ–¹æ³•ã€‚åœ¨å®ç° <code>equals</code> æ–¹æ³•æ—¶ï¼Œéœ€è¦è€ƒè™‘åˆ°æ¯”è¾ƒçš„å¯¹è±¡æ˜¯å¦ä¸º nullã€å¯¹è±¡ç±»å‹æ˜¯å¦ç›¸åŒç­‰å› ç´ ã€‚åœ¨å®ç° <code>hashCode</code> æ–¹æ³•æ—¶ï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨ç±»ä¸­å¯æ¯”è¾ƒå±æ€§çš„å“ˆå¸Œå€¼ï¼Œä»¥ç¡®ä¿å“ˆå¸Œè¡¨ç­‰æ•°æ®ç»“æ„èƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†è¯¥ç±»çš„å¯¹è±¡ã€‚</li>
<li>å¦‚æœä¸€ä¸ªç±»éœ€è¦æ”¯æŒå¤šç§æ¯”è¾ƒæ–¹å¼ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘ä½¿ç”¨ç­–ç•¥æ¨¡å¼æˆ–è€…æ¯”è¾ƒå™¨ï¼ˆComparatorï¼‰æ¥å£æ¥å®ç°ã€‚ä½¿ç”¨æ¯”è¾ƒå™¨æ¥å£å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°æŒ‡å®šæ¯”è¾ƒæ–¹å¼ï¼Œä»è€Œæ›´åŠ çµæ´»ã€‚</li>
</ol>
<p>å®ç° <code>Comparable</code> æ¥å£çš„ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="kd">implements</span> <span class="n">Comparable</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">Person</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span><span class="kt">int</span> <span class="n">age</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// å®ç° compareTo æ–¹æ³•ï¼ŒæŒ‰ç…§å¹´é¾„å‡åºæ’åº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="n">Person</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Integer</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">age</span><span class="o">,</span> <span class="n">o</span><span class="o">.</span><span class="na">age</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// å®ç° equals æ–¹æ³•å’Œ hashCode æ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">obj</span> <span class="o">==</span> <span class="k">this</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(!(</span><span class="n">obj</span> <span class="k">instanceof</span> <span class="n">Person</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">Person</span> <span class="n">other</span> <span class="o">=</span> <span class="o">(</span><span class="n">Person</span><span class="o">)</span> <span class="n">obj</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">name</span><span class="o">,</span> <span class="n">other</span><span class="o">.</span><span class="na">name</span><span class="o">)</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">                <span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="na">age</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">name</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">age</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œ<code>Person</code> ç±»å®ç°äº† <code>Comparable</code> æ¥å£ï¼Œå¹¶å®ç°äº† <code>compareTo</code> æ–¹æ³•ã€‚åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æŒ‰ç…§å¯¹è±¡çš„å¹´é¾„å‡åºæ’åºã€‚ä¸ºäº†ç¡®ä¿ <code>equals</code> æ–¹æ³•å’Œ <code>hashCode</code> æ–¹æ³•çš„æ­£ç¡®æ€§ï¼Œæˆ‘ä»¬ä¹Ÿå®ç°äº†è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œä»¥ç¡®ä¿ <code>Person</code> å¯¹è±¡åœ¨ä½¿ç”¨å“ˆå¸Œè¡¨ç­‰æ•°æ®ç»“æ„æ—¶èƒ½å¤Ÿæ­£å¸¸å·¥ä½œã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>ã€ŠEffective Java 3ã€‹ç¬”è®°13ï¼šæ˜æ™ºåœ°è¦†ç›– clone æ–¹æ³•</title>
      <link>https://blog.chensoul.com/posts/2023/05/26/override-clone-judiciously/</link>
      <pubDate>Fri, 26 May 2023 08:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/05/26/override-clone-judiciously/</guid>
      <description>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬ä¸‰ç« ã€Šå¯¹è±¡çš„é€šç”¨æ–¹æ³•ã€‹çš„å­¦ä¹ ç¬”è®°ï¼šæ˜æ™ºåœ°è¦†ç›– clone æ–¹æ³•ã€‚ ä»‹ç» Cloneable æ¥å£çš„ç›®çš„æ˜¯ä½œä¸º mixin æ¥å£ï¼Œç”¨äºè®©ç±»æ¥å®£ç§°å®ƒä»¬å…è®¸å…‹</description>
      <content:encoded><![CDATA[<p>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬ä¸‰ç« ã€Šå¯¹è±¡çš„é€šç”¨æ–¹æ³•ã€‹çš„å­¦ä¹ ç¬”è®°ï¼šæ˜æ™ºåœ°è¦†ç›– clone æ–¹æ³•ã€‚</p>
<h2 id="ä»‹ç»">ä»‹ç»</h2>
<p>Cloneable æ¥å£çš„ç›®çš„æ˜¯ä½œä¸º mixin æ¥å£ï¼Œç”¨äºè®©ç±»æ¥å®£ç§°å®ƒä»¬å…è®¸å…‹éš†ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå®ƒæ²¡æœ‰è¾¾åˆ°è¿™ä¸ªç›®çš„ã€‚å®ƒçš„ä¸»è¦ç¼ºç‚¹æ˜¯ç¼ºå°‘ clone æ–¹æ³•ï¼Œå¹¶ä¸” Object ç±»çš„ clone æ–¹æ³•æ˜¯å—ä¿æŠ¤çš„ã€‚å¦‚æœä¸æ±‚åŠ©äºåå°„ï¼Œå°±ä¸èƒ½ä»…ä»…å› ä¸ºå¯¹è±¡å®ç°äº† Cloneable æ¥å£å°±èƒ½è°ƒç”¨ clone æ–¹æ³•ã€‚å³ä½¿åå°„è°ƒç”¨ä¹Ÿå¯èƒ½å¤±è´¥ï¼Œå› ä¸ºä¸èƒ½ä¿è¯å¯¹è±¡å…·æœ‰å¯è®¿é—®çš„ clone æ–¹æ³•ã€‚å°½ç®¡å­˜åœ¨å¤šç§ç¼ºé™·ï¼Œä½†è¯¥æœºåˆ¶çš„ä½¿ç”¨èŒƒå›´ç›¸å½“å¹¿æ³›ï¼Œå› æ­¤ç†è§£å®ƒæ˜¯å€¼å¾—çš„ã€‚æœ¬æ¡ç›®å°†å‘Šè¯‰ä½ å¦‚ä½•å®ç°è¡Œä¸ºè‰¯å¥½çš„ clone æ–¹æ³•ï¼Œè®¨è®ºä»€ä¹ˆæ—¶å€™åº”è¯¥è¿™æ ·åšï¼Œå¹¶æä¾›æ›¿ä»£æ–¹æ¡ˆã€‚</p>
<p>æ—¢ç„¶ Cloneable æ¥å£ä¸åŒ…å«ä»»ä½•æ–¹æ³•ï¼Œç”¨å®ƒæ¥åšä»€ä¹ˆå‘¢ï¼Ÿå®ƒå†³å®šäº† Object ç±»å—ä¿æŠ¤çš„ clone å®ç°çš„è¡Œä¸ºï¼šå¦‚æœä¸€ä¸ªç±»å®ç°äº† Cloneable æ¥å£ï¼ŒObject ç±»çš„ clone æ–¹æ³•åˆ™è¿”å›è¯¥ç±»å®ä¾‹çš„é€å­—æ®µæ‹·è´ï¼›å¦åˆ™å®ƒä¼šæŠ›å‡º CloneNotSupportedExceptionã€‚è¿™æ˜¯æ¥å£éå¸¸ä¸å…¸å‹çš„ä¸€ç§ä½¿ç”¨æ–¹å¼ï¼Œä¸åº”è¯¥æ•ˆä»¿ã€‚é€šå¸¸ï¼Œç±»å®ç°æ¥å£å¯ä»¥è¡¨æ˜ç±»èƒ½å¤Ÿä¸ºå…¶å®¢æˆ·ç«¯åšäº›ä»€ä¹ˆã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå®ƒä¿®æ”¹äº†è¶…ç±»ä¸Šå—ä¿æŠ¤çš„æ–¹æ³•çš„è¡Œä¸ºã€‚</p>
<p>è™½ç„¶è§„èŒƒæ²¡æœ‰è¯´æ˜ï¼Œä½†æ˜¯åœ¨å®è·µä¸­ï¼Œå®ç° Cloneable æ¥å£çš„ç±»åº”è¯¥æä¾›ä¸€ä¸ªåŠŸèƒ½æ­£å¸¸çš„å…¬å…± clone æ–¹æ³•ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œç±»åŠå…¶æ‰€æœ‰è¶…ç±»å¿…é¡»éµå®ˆå¤æ‚çš„ã€ä¸å¯å¼ºåˆ¶æ‰§è¡Œçš„ã€æ–‡æ¡£å¾ˆå°‘çš„åè®®ã€‚äº§ç”Ÿçš„æœºåˆ¶æ˜¯è„†å¼±çš„ã€å±é™©çš„å’Œéè¯­è¨€çš„ï¼šå³å®ƒåˆ›å»ºå¯¹è±¡è€Œä¸è°ƒç”¨æ„é€ å‡½æ•°ã€‚</p>
<p>clone æ–¹æ³•çš„ä¸€èˆ¬çº¦å®šå¾ˆè–„å¼±ã€‚ä¸‹é¢çš„å†…å®¹æ˜¯ä» Object è§„èŒƒå¤åˆ¶è¿‡æ¥çš„ï¼š</p>
<p>åˆ›å»ºå¹¶è¿”å›æ­¤å¯¹è±¡çš„å‰¯æœ¬ã€‚&ldquo;å‰¯æœ¬&rdquo; çš„ç¡®åˆ‡å«ä¹‰å¯èƒ½å–å†³äºå¯¹è±¡çš„ç±»ã€‚é€šå¸¸çš„æ„å›¾æ˜¯ï¼Œå¯¹äºä»»ä½•å¯¹è±¡ xï¼Œè¡¨è¾¾å¼</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">x</span><span class="o">.</span><span class="na">clone</span><span class="o">()</span> <span class="o">!=</span> <span class="n">x</span>
</span></span></code></pre></div><p>å°†ä¸º trueï¼Œå¹¶ä¸”è¡¨è¾¾å¼</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">x</span><span class="o">.</span><span class="na">clone</span><span class="o">().</span><span class="na">getClass</span><span class="o">()</span> <span class="o">==</span> <span class="n">x</span><span class="o">.</span><span class="na">getClass</span><span class="o">()</span>
</span></span></code></pre></div><p>å°†ä¸º trueï¼Œä½†è¿™å¹¶ä¸æ˜¯ç»å¯¹è¦æ±‚ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¯¹äºä»»ä½•å¯¹è±¡ x å’Œ yï¼Œå¦‚æœå®ƒä»¬çš„ equals æ–¹æ³•è¿”å› trueï¼Œåˆ™è¡¨è¾¾å¼</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">x</span><span class="o">.</span><span class="na">clone</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">x</span><span class="o">)</span>
</span></span></code></pre></div><p>ä¹Ÿåº”è¿”å› trueã€‚</p>
<p>clone æ–¹æ³•åˆ›å»ºå¹¶è¿”å›å¯¹è±¡çš„å‰¯æœ¬ã€‚ã€Œå‰¯æœ¬ã€çš„ç¡®åˆ‡å«ä¹‰å¯èƒ½å–å†³äºå¯¹è±¡çš„ç±»åˆ«ã€‚é€šå¸¸ï¼Œå¯¹äºä»»ä½•å¯¹è±¡ xï¼Œè¡¨è¾¾å¼ <code>x.clone() != x</code>ã€<code>x.clone().getClass() == x.getClass()</code> ä»¥åŠ <code>x.clone().equals(x)</code> çš„å€¼éƒ½å°†ä¸º trueï¼Œä½†éƒ½ä¸æ˜¯ç»å¯¹çš„ã€‚</p>
<p>æŒ‰ç…§æƒ¯ä¾‹ï¼Œæ­¤æ–¹æ³•è¿”å›çš„å¯¹è±¡åº”é€šè¿‡è°ƒç”¨ super.clone() æ¥è·å–ã€‚å¦‚æœä¸€ä¸ªç±»åŠå…¶æ‰€æœ‰çˆ¶ç±»ï¼ˆé™¤äº† Objectï¼‰éƒ½éµå¾ªè¿™ä¸ªæƒ¯ä¾‹ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰ä»¥ä¸‹æƒ…å†µï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">x</span><span class="o">.</span><span class="na">clone</span><span class="o">().</span><span class="na">getClass</span><span class="o">()</span> <span class="o">==</span> <span class="n">x</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span>
</span></span></code></pre></div><p>æŒ‰ç…§çº¦å®šï¼Œclone æ–¹æ³•è¿”å›çš„å¯¹è±¡åº”è¯¥é€šè¿‡è°ƒç”¨ super.clone() æ¥è·å¾—ã€‚å¦‚æœä¸€ä¸ªç±»å’Œå®ƒçš„æ‰€æœ‰è¶…ç±»ï¼ˆObject ç±»é™¤å¤–ï¼‰éƒ½éµå®ˆè¿™ä¸ªçº¦å®šï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¡¨è¾¾å¼ <code>x.clone().getClass() == x.getClass()</code> åˆ™ä¸º trueã€‚</p>
<p>æŒ‰ç…§çº¦å®šï¼Œè¿”å›çš„å¯¹è±¡åº”è¯¥ç‹¬ç«‹äºè¢«å…‹éš†çš„å¯¹è±¡ã€‚ä¸ºäº†å®ç°è¿™ç§ç‹¬ç«‹æ€§ï¼Œå¯èƒ½éœ€è¦åœ¨ super.clone() è¿”å›å‰ï¼Œä¿®æ”¹å¯¹è±¡çš„ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µã€‚</p>
<p>è¿™ç§æœºåˆ¶æœ‰ç‚¹ç±»ä¼¼äºæ„é€ æ–¹æ³•é“¾ï¼Œåªæ˜¯æ²¡æœ‰å¼ºåˆ¶æ‰§è¡Œï¼š</p>
<ul>
<li>ï¼ˆ1ï¼‰å¦‚æœä¸€ä¸ªç±»çš„ clone æ–¹æ³•è¿”å›çš„å®ä¾‹ä¸æ˜¯é€šè¿‡è°ƒç”¨ super.clone() è€Œæ˜¯é€šè¿‡è°ƒç”¨æ„é€ å‡½æ•°è·å¾—çš„ï¼Œç¼–è¯‘å™¨ä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯å¦‚æœè¿™ä¸ªç±»çš„ä¸€ä¸ªå­ç±»è°ƒç”¨ super.clone()ï¼Œç”±æ­¤äº§ç”Ÿçš„å¯¹è±¡ç±»å‹å°†æ˜¯é”™è¯¯çš„ï¼Œå½±å“å­ç±» clone æ–¹æ³•æ­£å¸¸å·¥ä½œã€‚</li>
<li>ï¼ˆ2ï¼‰å¦‚æœè¦†ç›– clone æ–¹æ³•çš„ç±»æ˜¯ final ä¿®é¥°çš„ï¼Œé‚£ä¹ˆå¯ä»¥å®‰å…¨åœ°å¿½ç•¥è¿™ä¸ªçº¦å®šï¼Œå› ä¸ºæ²¡æœ‰å­ç±»éœ€è¦æ‹…å¿ƒã€‚</li>
<li>ï¼ˆ3ï¼‰å¦‚æœä¸€ä¸ª final ä¿®é¥°çš„ç±»ä¸è°ƒç”¨ super.clone() çš„ clone æ–¹æ³•ã€‚ç±»æ²¡æœ‰ç†ç”±å®ç° Cloneable æ¥å£ï¼Œå› ä¸ºå®ƒä¸ä¾èµ–äº Object ç±»çš„ clone å®ç°çš„è¡Œä¸ºã€‚</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">Base</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span> <span class="kd">protected</span> <span class="n">Object</span> <span class="nf">clone</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">CloneNotSupportedException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">Base</span><span class="o">();</span> <span class="c1">// â‘ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">BasePro</span> <span class="kd">extends</span> <span class="n">Base</span> <span class="kd">implements</span> <span class="n">Cloneable</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span> <span class="kd">protected</span> <span class="n">Object</span> <span class="nf">clone</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">CloneNotSupportedException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">clone</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">BasePro</span> <span class="n">basePro</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BasePro</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">basePro</span><span class="o">.</span><span class="na">clone</span><span class="o">().</span><span class="na">getClass</span><span class="o">());</span> <span class="c1">// è¾“å‡º class com.example.demo.Base
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">basePro</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span> <span class="c1">// è¾“å‡º class com.example.demo.BasePro
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>å¯é‡‡ç”¨ä¸¤ç§æ–¹å¼ä¿®å¤</p>
<ul>
<li>â‘  å¤„æ”¹ç”¨ super.clone()</li>
<li>ç§»é™¤ Base ç±»æ•´ä¸ª clone() å®ç°</li>
</ul>
<p>å‡è®¾æ‚¨æƒ³åœ¨ä¸€ä¸ªç±»ä¸­å®ç° Cloneable æ¥å£ï¼Œè€Œå…¶è¶…ç±»æä¾›äº†ä¸€ä¸ªè‰¯å¥½çš„ clone æ–¹æ³•ã€‚é¦–å…ˆè°ƒç”¨ super.clone() æ–¹æ³•ã€‚æ‚¨å¾—åˆ°çš„å¯¹è±¡å°†æ˜¯åŸå§‹å¯¹è±¡çš„ä¸€ä¸ªå®Œå…¨åŠŸèƒ½çš„å‰¯æœ¬ã€‚åœ¨æ‚¨çš„ç±»ä¸­å£°æ˜çš„ä»»ä½•å­—æ®µéƒ½å°†å…·æœ‰ä¸åŸå§‹å¯¹è±¡ç›¸åŒçš„å€¼ã€‚å¦‚æœæ¯ä¸ªå­—æ®µéƒ½åŒ…å«ä¸€ä¸ªåŸºæœ¬ç±»å‹çš„å€¼æˆ–ä¸€ä¸ªä¸å¯å˜å¯¹è±¡çš„å¼•ç”¨ï¼Œåˆ™è¿”å›çš„å¯¹è±¡å¯èƒ½æ­£æ˜¯æ‚¨æ‰€éœ€è¦çš„ï¼Œæ­¤æ—¶ä¸éœ€è¦è¿›ä¸€æ­¥å¤„ç†ã€‚ä¾‹å¦‚ï¼Œå¯¹äº PhoneNumber ç±»ï¼Œå°±æ˜¯è¿™ç§æƒ…å†µï¼Œä½†è¯·æ³¨æ„ï¼Œä¸å¯å˜ç±»ä¸åº”æä¾› clone æ–¹æ³•ï¼Œå› ä¸ºè¿™åªä¼šé¼“åŠ±æµªè´¹æ€§çš„å¤åˆ¶ã€‚åœ¨è¿™ä¸ªå‰æä¸‹ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ª PhoneNumber çš„ clone æ–¹æ³•çš„å®ç°ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Clone method for class with no references to mutable state
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Override</span> <span class="kd">public</span> <span class="n">PhoneNumber</span> <span class="nf">clone</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="o">(</span><span class="n">PhoneNumber</span><span class="o">)</span> <span class="kd">super</span><span class="o">.</span><span class="na">clone</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">CloneNotSupportedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">throw</span> <span class="k">new</span> <span class="n">AssertionError</span><span class="o">();</span> <span class="c1">// Can&#39;t happen
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ä¸ºäº†è®©è¿™ä¸ªæ–¹æ³•å·¥ä½œï¼Œå¿…é¡»ä¿®æ”¹ PhoneNumber ç±»çš„å£°æ˜ï¼Œä½¿ä¹‹å®ç° Cloneable æ¥å£ã€‚è™½ç„¶ Object çš„ clone æ–¹æ³•è¿”å› Object ç±»å‹ï¼Œä½†æ˜¯è¿™ä¸ª clone æ–¹æ³•è¿”å› PhoneNumber ç±»å‹ã€‚è¿™æ ·åšæ˜¯åˆæ³•çš„ï¼Œä¹Ÿæ˜¯å¯å–çš„ï¼Œå› ä¸º Java çš„è¿”å›å€¼ç±»å‹æ”¯æŒåå˜ã€‚æ¢å¥è¯è¯´ï¼Œè¦†ç›–æ–¹æ³•çš„è¿”å›ç±»å‹å¯ä»¥æ˜¯è¢«è¦†ç›–æ–¹æ³•çš„è¿”å›ç±»å‹çš„å­ç±»ã€‚è¿™æ ·å°±ä¸éœ€è¦åœ¨å®¢æˆ·ç«¯ä¸­è¿›è¡Œå¼ºåˆ¶è½¬æ¢ã€‚æˆ‘ä»¬å¿…é¡»æŠŠæºè‡ª Object ç±»çš„ super.clone() æ–¹æ³•åœ¨è¿”å›å‰å°†ç»“æœè½¬æ¢ä¸º PhoneNumber ç±»å‹ï¼Œè¿™ç±»å¼ºåˆ¶è½¬æ¢è‚¯å®šä¼šæˆåŠŸã€‚</p>
<p>å°† super.clone() åŒ…å«åœ¨ try-catch å—ä¸­ã€‚è¿™æ˜¯å› ä¸º Object ç±»å£°æ˜çš„ clone æ–¹æ³•ä¼šæŠ›å‡º CloneNotSupportedExceptionï¼Œè¿™æ˜¯ä¸€ç§ checked exceptionã€‚å› ä¸º PhoneNumber ç±»å®ç°äº† Cloneable æ¥å£ï¼Œæ‰€ä»¥æˆ‘ä»¬çŸ¥é“å¯¹ super.clone() çš„è°ƒç”¨å°†ä¼šæˆåŠŸã€‚è¿™ä¸ªæ ·æ¿æ–‡ä»¶çš„éœ€æ±‚è¡¨æ˜ CloneNotSupportedException åº”è¯¥æ˜¯ unchecked exceptionã€‚</p>
<p>å¦‚æœå¯¹è±¡çš„å­—æ®µåŒ…å«å¯å˜å¯¹è±¡çš„å¼•ç”¨ï¼Œå‰é¢æ‰€ç¤º clone æ–¹æ³•çš„è¿™ç§ç®€æ˜“å®ç°å¯èƒ½å¼•å‘ç¾éš¾ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ Stack ç±»ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Stack</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Object</span><span class="o">[]</span> <span class="n">elements</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">DEFAULT_INITIAL_CAPACITY</span> <span class="o">=</span> <span class="n">16</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">Stack</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="o">.</span><span class="na">elements</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[</span><span class="n">DEFAULT_INITIAL_CAPACITY</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">push</span><span class="o">(</span><span class="n">Object</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ensureCapacity</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">elements</span><span class="o">[</span><span class="n">size</span><span class="o">++]</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">pop</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">size</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="n">EmptyStackException</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">Object</span> <span class="n">result</span> <span class="o">=</span> <span class="n">elements</span><span class="o">[--</span><span class="n">size</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">        <span class="n">elements</span><span class="o">[</span><span class="n">size</span><span class="o">]</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// Eliminate obsolete reference
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Ensure space for at least one more element.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">ensureCapacity</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">elements</span><span class="o">.</span><span class="na">length</span> <span class="o">==</span> <span class="n">size</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">elements</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">copyOf</span><span class="o">(</span><span class="n">elements</span><span class="o">,</span> <span class="n">2</span> <span class="o">*</span> <span class="n">size</span> <span class="o">+</span> <span class="n">1</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>å‡è®¾ä½ æƒ³è®©è¿™ä¸ªç±»å¯å…‹éš†ã€‚å¦‚æœ clone æ–¹æ³•åªè¿”å› super.clone()ï¼Œå¾—åˆ°çš„ Stack å®ä¾‹åœ¨å…¶ size å­—æ®µä¸­ä¼šæœ‰æ­£ç¡®çš„å€¼ï¼Œä½†å…¶ elements å­—æ®µå°†å¼•ç”¨ä¸åŸå§‹ Stack å®ä¾‹ç›¸åŒçš„æ•°ç»„ã€‚ä¿®æ”¹åˆå§‹å€¼å°†ç ´åå…‹éš†çš„ä¸å˜æ€§ï¼Œåä¹‹äº¦ç„¶ã€‚ä½ å°†å¾ˆå¿«å‘ç°ä½ çš„ç¨‹åºäº§ç”Ÿäº†æ— æ„ä¹‰çš„ç»“æœæˆ–æŠ›å‡º NullPointerExceptionã€‚</p>
<p>è°ƒç”¨ Stack ç±»ä¸­å”¯ä¸€æ„é€ å‡½æ•°çš„æƒ…å†µæ°¸è¿œä¸ä¼šå‘ç”Ÿã€‚å®é™…ä¸Šï¼Œclone æ–¹æ³•å°†å……å½“æ„é€ å‡½æ•°ï¼›ä½ å¿…é¡»ç¡®ä¿å®ƒä¸ä¼šå¯¹åŸå§‹å¯¹è±¡é€ æˆä¼¤å®³ï¼Œå¹¶ä¸” clone æ–¹æ³•æ­£ç¡®åœ°å®ç°äº†ä¸å˜æ€§ã€‚ä¸ºäº†ä½¿ Stack ç±»ä¸Šçš„ clone æ–¹æ³•æ­£å¸¸å·¥ä½œï¼Œå®ƒå¿…é¡»å¤åˆ¶ Stack ç±»å®ä¾‹çš„å†…éƒ¨ã€‚æœ€ç®€å•çš„åšæ³•æ˜¯åœ¨ elements å­—æ®µå¯¹åº”çš„æ•°ç»„é€’å½’è°ƒç”¨ clone æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Clone method for class with references to mutable state
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">Stack</span> <span class="nf">clone</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Stack</span> <span class="n">result</span> <span class="o">=</span> <span class="o">(</span><span class="n">Stack</span><span class="o">)</span> <span class="kd">super</span><span class="o">.</span><span class="na">clone</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span><span class="o">.</span><span class="na">elements</span> <span class="o">=</span> <span class="n">elements</span><span class="o">.</span><span class="na">clone</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">CloneNotSupportedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">throw</span> <span class="k">new</span> <span class="n">AssertionError</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æ³¨æ„ï¼Œæˆ‘ä»¬ä¸éœ€è¦å°† <code>elements.clone</code> çš„ç»“æœå¼ºåˆ¶è½¬æ¢åˆ° <code>Object[]</code>ã€‚åœ¨æ•°ç»„ä¸Šè°ƒç”¨ clone æ–¹æ³•å°†è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œè¯¥æ•°ç»„çš„è¿è¡Œæ—¶å’Œç¼–è¯‘æ—¶ç±»å‹ä¸è¢«å…‹éš†çš„æ•°ç»„ç›¸åŒã€‚è¿™æ˜¯å¤åˆ¶æ•°ç»„çš„é¦–é€‰ä¹ æƒ¯ç”¨æ³•ã€‚å®é™…ä¸Šï¼Œå¤åˆ¶æ•°ç»„æ˜¯ clone æœºåˆ¶å”¯ä¸€ä»¤äººä¿¡æœçš„ä½¿ç”¨åœºæ™¯ã€‚</p>
<p>è¿˜è¦æ³¨æ„ï¼Œå¦‚æœ elements å­—æ®µæ˜¯ final ä¿®é¥°çš„ï¼Œä¸Šè¿°è§£å†³æ–¹æ¡ˆå°±æ— æ³•å·¥ä½œï¼Œå› ä¸º clone æ–¹æ³•å°†è¢«ç¦æ­¢ä¸ºå­—æ®µåˆ†é…æ–°å€¼ã€‚è¿™æ˜¯ä¸€ä¸ªåŸºç¡€é—®é¢˜ï¼šä¸åºåˆ—åŒ–ä¸€æ ·ï¼Œå¯å…‹éš†ä½“ç³»ç»“æ„ä¸ä½¿ç”¨ final ä¿®é¥°å¯å˜å¯¹è±¡å¼•ç”¨çš„å¸¸ç”¨æ–¹å¼ä¸å…¼å®¹ï¼Œé™¤éåœ¨å¯¹è±¡ä¸å…¶å…‹éš†å¯¹è±¡ä¹‹é—´å¯ä»¥å®‰å…¨åœ°å…±äº«å¯å˜å¯¹è±¡ã€‚ä¸ºäº†ä½¿ç±»å¯å…‹éš†ï¼Œå¯èƒ½éœ€è¦ä»æŸäº›å­—æ®µä¸­åˆ é™¤ final ä¿®é¥°ç¬¦ã€‚</p>
<p>ä»…ä»…é€’å½’è°ƒç”¨ clone æ–¹æ³•å¹¶ä¸æ€»æ˜¯è¶³å¤Ÿçš„ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ æ­£åœ¨ä¸º HashTable ç¼–å†™ä¸€ä¸ª clone æ–¹æ³•ï¼ŒHashTable çš„å†…éƒ¨ç”±ä¸€ç»„ bucket ç»„æˆï¼Œæ¯ä¸ª bucket å¼•ç”¨é”®-å€¼å¯¹é“¾è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªæ¡ç›®ã€‚ä¸ºäº†æé«˜æ€§èƒ½ï¼Œç±»å®ç°äº†è‡ªå·±çš„è½»é‡çº§å•é“¾è¡¨ï¼Œè€Œä¸æ˜¯åœ¨å†…éƒ¨ä½¿ç”¨ <code>java.util.LinkedList</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HashTable</span> <span class="kd">implements</span> <span class="n">Cloneable</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Entry</span><span class="o">[]</span> <span class="n">buckets</span> <span class="o">=</span> <span class="o">...;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Entry</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">final</span> <span class="n">Object</span> <span class="n">key</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">Object</span> <span class="n">value</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">Entry</span> <span class="n">next</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">Entry</span><span class="o">(</span><span class="n">Object</span> <span class="n">key</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">,</span> <span class="n">Entry</span> <span class="n">next</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="n">next</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="o">...</span> <span class="c1">// Remainder omitted
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>å‡è®¾ä½ åªæ˜¯åƒå¯¹ Stack æ‰€åšçš„é‚£æ ·ï¼Œé€’å½’å…‹éš† bucket æ•°ç»„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Broken clone method - results in shared mutable state!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">HashTable</span> <span class="nf">clone</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">HashTable</span> <span class="n">result</span> <span class="o">=</span> <span class="o">(</span><span class="n">HashTable</span><span class="o">)</span> <span class="kd">super</span><span class="o">.</span><span class="na">clone</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span><span class="o">.</span><span class="na">buckets</span> <span class="o">=</span> <span class="n">buckets</span><span class="o">.</span><span class="na">clone</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">CloneNotSupportedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">throw</span> <span class="k">new</span> <span class="n">AssertionError</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>å°½ç®¡ clone æ–¹æ³•æœ‰è‡ªå·±çš„ bucket æ•°ç»„ï¼Œä½†è¯¥æ•°ç»„å¼•ç”¨çš„é“¾æ¥åˆ—è¡¨ä¸åŸå§‹é“¾è¡¨ç›¸åŒï¼Œè¿™å¾ˆå®¹æ˜“å¯¼è‡´å…‹éš†å’ŒåŸå§‹çš„ä¸ç¡®å®šæ€§è¡Œä¸ºã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½ å¿…é¡»å¤åˆ¶åŒ…å«æ¯ä¸ª bucket çš„é“¾è¡¨ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªå¸¸è§çš„æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Recursive clone method for class with complex mutable state
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HashTable</span> <span class="kd">implements</span> <span class="n">Cloneable</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Entry</span><span class="o">[]</span> <span class="n">buckets</span> <span class="o">=</span> <span class="o">...;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Entry</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">final</span> <span class="n">Object</span> <span class="n">key</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">Object</span> <span class="n">value</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">Entry</span> <span class="n">next</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">Entry</span><span class="o">(</span><span class="n">Object</span> <span class="n">key</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">,</span> <span class="n">Entry</span> <span class="n">next</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="n">next</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Recursively copy the linked list headed by this Entry
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">Entry</span> <span class="nf">deepCopy</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">new</span> <span class="n">Entry</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span><span class="n">next</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">next</span><span class="o">.</span><span class="na">deepCopy</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">HashTable</span> <span class="nf">clone</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">HashTable</span> <span class="n">result</span> <span class="o">=</span> <span class="o">(</span><span class="n">HashTable</span><span class="o">)</span> <span class="kd">super</span><span class="o">.</span><span class="na">clone</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="n">result</span><span class="o">.</span><span class="na">buckets</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Entry</span><span class="o">[</span><span class="n">buckets</span><span class="o">.</span><span class="na">length</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">buckets</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">buckets</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">result</span><span class="o">.</span><span class="na">buckets</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">buckets</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">deepCopy</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">CloneNotSupportedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="n">AssertionError</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="o">...</span> <span class="c1">// Remainder omitted
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>ç§æœ‰å†…éƒ¨ç±» HashTable.Entry å·²ç»è¢«å¢å¼ºï¼Œå®ƒæä¾›äº†è¿›è¡Œã€Œæ·±æ‹·è´ã€çš„æ–¹æ³•ã€‚HashTable ä¸Šçš„ clone æ–¹æ³•åˆ†é…ä¸€ä¸ªå¤§å°åˆé€‚çš„æ–° buckets æ•°ç»„ï¼Œå¹¶éå†åŸå§‹ buckets æ•°ç»„ï¼Œå¯¹æ¯ä¸ªéç©º buckets å…ƒç´ è¿›è¡Œæ·±æ‹·è´ã€‚Entry ç±»çš„ deepCopy() æ–¹æ³•ä¼šè¢«é€’å½’è°ƒç”¨ç›´è‡³å¤åˆ¶å®Œæ•´ä¸ªé“¾è¡¨ï¼ˆè¯¥é“¾è¡¨ä»¥ Entry ç±»çš„å®ä¾‹ä½œä¸ºå¤´èŠ‚ç‚¹ï¼‰ã€‚è¿™ç§æ–¹æ³•è™½ç„¶å¾ˆçµæ´»ï¼Œè€Œä¸”åœ¨ buckets ä¸å¤ªé•¿çš„æƒ…å†µä¸‹å¯ä»¥å¾ˆå¥½åœ°å·¥ä½œï¼Œä½†æ˜¯å…‹éš†é“¾è¡¨å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½æ–¹æ³•ï¼Œå› ä¸ºå®ƒä¸ºé“¾è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ æ¶ˆè€—ä¸€ä¸ªå †æ ˆå¸§ã€‚å¦‚æœåˆ—è¡¨å¾ˆé•¿ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´å †æ ˆæº¢å‡ºã€‚ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œä½ å¯ä»¥ç”¨è¿­ä»£æ›¿æ¢ deepCopy() æ–¹æ³•çš„é€’å½’è°ƒç”¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Iteratively copy the linked list headed by this Entry
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Entry</span> <span class="nf">deepCopy</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Entry</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Entry</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="n">next</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="o">(</span><span class="n">Entry</span> <span class="n">p</span> <span class="o">=</span> <span class="n">result</span><span class="o">;</span> <span class="n">p</span><span class="o">.</span><span class="na">next</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span> <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="na">next</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">p</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Entry</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">next</span><span class="o">.</span><span class="na">key</span><span class="o">,</span> <span class="n">p</span><span class="o">.</span><span class="na">next</span><span class="o">.</span><span class="na">value</span><span class="o">,</span> <span class="n">p</span><span class="o">.</span><span class="na">next</span><span class="o">.</span><span class="na">next</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>å…‹éš†å¤æ‚å¯å˜å¯¹è±¡çš„æœ€åä¸€ç§æ–¹æ³•æ˜¯è°ƒç”¨ super.clone()ï¼Œå°†ç»“æœå¯¹è±¡ä¸­çš„æ‰€æœ‰å­—æ®µè®¾ç½®ä¸ºåˆå§‹çŠ¶æ€ï¼Œç„¶åè°ƒç”¨æ›´é«˜çº§åˆ«çš„æ–¹æ³•é‡æ–°ç”ŸæˆåŸå§‹å¯¹è±¡çš„çŠ¶æ€ã€‚åœ¨æˆ‘ä»¬çš„ HashTable ç¤ºä¾‹ä¸­ï¼Œbuckets å­—æ®µå°†åˆå§‹åŒ–ä¸ºä¸€ä¸ªæ–°çš„ bucket æ•°ç»„ï¼Œå¹¶ä¸”å¯¹äºå…‹éš†çš„ hash è¡¨ä¸­çš„æ¯ä¸ªé”®å€¼æ˜ å°„å°†è°ƒç”¨ put(key, value) æ–¹æ³•ï¼ˆæœªæ˜¾ç¤ºï¼‰ã€‚è¿™ç§æ–¹æ³•é€šå¸¸äº§ç”Ÿä¸€ä¸ªç®€å•ã€ç›¸å½“ä¼˜é›…çš„ clone æ–¹æ³•ï¼Œå®ƒçš„è¿è¡Œé€Ÿåº¦ä¸å¦‚ç›´æ¥æ“ä½œå…‹éš†çš„å†…éƒ¨çš„æ–¹æ³•å¿«ã€‚è™½ç„¶è¿™ç§æ–¹æ³•å¾ˆç®€æ´ï¼Œä½†å®ƒä¸æ•´ä¸ªå¯å…‹éš†ä½“ç³»ç»“æ„æ˜¯å¯¹ç«‹çš„ï¼Œå› ä¸ºå®ƒç›²ç›®åœ°è¦†ç›–äº†æ„æˆä½“ç³»ç»“æ„åŸºç¡€çš„é€å­—æ®µå¯¹è±¡å‰¯æœ¬ã€‚</p>
<p>ä¸æ„é€ å‡½æ•°ä¸€æ ·ï¼Œclone æ–¹æ³•ç»ä¸èƒ½åœ¨æ­£åœ¨æ„å»ºçš„å…‹éš†ä¸Šè°ƒç”¨å¯è¦†ç›–æ–¹æ³•ã€‚å¦‚æœ clone è°ƒç”¨ä¸€ä¸ªåœ¨å­ç±»ä¸­è¢«é‡å†™çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°†åœ¨å­ç±»æœ‰æœºä¼šä¿®å¤å…¶åœ¨å…‹éš†ä¸­çš„çŠ¶æ€ä¹‹å‰æ‰§è¡Œï¼Œå¾ˆå¯èƒ½å¯¼è‡´å…‹éš†å’ŒåŸå§‹çš„ç ´åã€‚å› æ­¤ï¼Œå‰ä¸€æ®µä¸­è®¨è®ºçš„ put(key, value) æ–¹æ³•åº”è¯¥æ˜¯ final ä¿®é¥°æˆ– private ä¿®é¥°çš„æ–¹æ³•ã€‚ï¼ˆå¦‚æœå®ƒæ˜¯ç§æœ‰çš„ï¼Œé‚£ä¹ˆå®ƒå¯èƒ½æ˜¯æ²¡æœ‰ final ä¿®é¥°çš„å…¬å…±ã€ŒåŠ©æ‰‹æ–¹æ³•ã€ã€‚)</p>
<p>å¯¹è±¡çš„ clone æ–¹æ³•è¢«å£°æ˜ä¸ºæŠ›å‡º CloneNotSupportedExceptionï¼Œä½†æ˜¯é‡å†™æ–¹æ³•ä¸éœ€è¦ã€‚<strong>å…¬å…±å…‹éš†æ–¹æ³•åº”è¯¥çœç•¥ throw å­å¥ï¼Œ</strong> ä½œä¸ºä¸æŠ›å‡ºå—æ§å¼‚å¸¸çš„æ–¹æ³•æ›´å®¹æ˜“ä½¿ç”¨ã€‚</p>
<p>ç”¨ç»§æ‰¿æ–¹å¼è®¾è®¡ä¸€ä¸ªç±»æ—¶ï¼Œä½ æœ‰ä¸¤ç§é€‰æ‹©ï¼Œä½†æ˜¯æ— è®ºä½ é€‰æ‹©å“ªä¸€ç§ï¼Œéƒ½ä¸åº”è¯¥å®ç° Cloneable æ¥å£ã€‚ä½ å¯ä»¥é€‰æ‹©é€šè¿‡å®ç°ä¸€ä¸ªåŠŸèƒ½æ­£å¸¸çš„å—ä¿æŠ¤å…‹éš†æ–¹æ³•æ¥æ¨¡æ‹Ÿ Object çš„è¡Œä¸ºï¼Œè¯¥æ–¹æ³•å£°æ˜ä¸ºæŠ›å‡º CloneNotSupportedExceptionã€‚è¿™ç»™å­ç±»å®ç° Cloneable æˆ–ä¸å®ç° Cloneable çš„è‡ªç”±ï¼Œå°±åƒå®ƒä»¬ç›´æ¥æ‰©å±•å¯¹è±¡ä¸€æ ·ã€‚æˆ–è€…ï¼Œä½ å¯ä»¥é€‰æ‹©ä¸å®ç°ä¸€ä¸ªæœ‰æ•ˆçš„å…‹éš†æ–¹æ³•ï¼Œå¹¶é€šè¿‡æä¾›ä»¥ä¸‹é€€åŒ–çš„å…‹éš†å®ç°æ¥é˜²æ­¢å­ç±»å®ç°å®ƒï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// clone method for extendable class not supporting Cloneable
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">protected</span> <span class="kd">final</span> <span class="n">Object</span> <span class="nf">clone</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">CloneNotSupportedException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">throw</span> <span class="k">new</span> <span class="n">CloneNotSupportedException</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>è¿˜æœ‰ä¸€ä¸ªç»†èŠ‚éœ€è¦æ³¨æ„ã€‚å¦‚æœä½ ç¼–å†™äº†ä¸€ä¸ªå®ç°äº† Cloneable æ¥å£çš„çº¿ç¨‹å®‰å…¨ç±»ï¼Œè¯·è®°ä½å®ƒçš„ clone æ–¹æ³•å¿…é¡»æ­£ç¡®åŒæ­¥ï¼Œå°±åƒå…¶ä»–ä»»ä½•æ–¹æ³•ä¸€æ ·ã€‚Object ç±»çš„ clone æ–¹æ³•ä¸æ˜¯åŒæ­¥çš„ï¼Œå› æ­¤å³ä½¿å®ƒçš„å®ç°åœ¨å…¶ä»–æ–¹é¢æ˜¯ä»¤äººæ»¡æ„çš„ï¼Œä½ ä¹Ÿå¯èƒ½éœ€è¦ç¼–å†™ä¸€ä¸ªè¿”å› super.clone() çš„åŒæ­¥ clone æ–¹æ³•ã€‚</p>
<p>å›é¡¾ä¸€ä¸‹ï¼Œæ‰€æœ‰å®ç° Cloneable æ¥å£çš„ç±»éƒ½åº”è¯¥ä½¿ç”¨ä¸€ä¸ªè¿”å›ç±»å‹ä¸ºç±»æœ¬èº«çš„å…¬å…±æ–¹æ³•è¦†ç›– cloneã€‚è¿™ä¸ªæ–¹æ³•åº”è¯¥é¦–å…ˆè°ƒç”¨ super.clone()ï¼Œç„¶åã€Œä¿®å¤ã€ä»»ä½•éœ€è¦ã€Œä¿®å¤ã€çš„å­—æ®µã€‚é€šå¸¸ï¼Œè¿™æ„å‘³ç€å¤åˆ¶ä»»ä½•åŒ…å«å¯¹è±¡å†…éƒ¨ã€Œæ·±å±‚ç»“æ„ã€çš„å¯å˜å¯¹è±¡ï¼Œå¹¶å°†å…‹éš†å¯¹è±¡å¯¹è¿™äº›å¯¹è±¡çš„å¼•ç”¨æ›¿æ¢ä¸ºå¯¹å…¶å‰¯æœ¬çš„å¼•ç”¨ã€‚è™½ç„¶è¿™äº›å†…éƒ¨å‰¯æœ¬é€šå¸¸å¯ä»¥é€šè¿‡é€’å½’è°ƒç”¨ clone æ¥å®ç°ï¼Œä½†è¿™å¹¶ä¸æ€»æ˜¯æœ€å¥½çš„æ–¹æ³•ã€‚å¦‚æœç±»åªåŒ…å«åŸºæœ¬æ•°æ®ç±»å‹çš„å­—æ®µæˆ–å¯¹ä¸å¯å˜å¯¹è±¡çš„å¼•ç”¨ï¼Œé‚£ä¹ˆå¾ˆå¯èƒ½ä¸éœ€è¦ä¿®å¤ä»»ä½•å­—æ®µã€‚è¿™æ¡è§„åˆ™ä¹Ÿæœ‰ä¾‹å¤–ã€‚ä¾‹å¦‚ï¼Œè¡¨ç¤ºåºåˆ—å·æˆ–å…¶ä»–å”¯ä¸€ ID çš„å­—æ®µéœ€è¦ä¿®å¤ï¼Œå³ä½¿å®ƒæ˜¯åŸºæœ¬æ•°æ®ç±»å‹æˆ–ä¸å¯å˜çš„ã€‚</p>
<p>æè¿™ä¹ˆå¤æ‚çœŸçš„æœ‰å¿…è¦å—ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚å¦‚æœä½ æ‰©å±•äº†ä¸€ä¸ªå·²ç»å®ç°äº† Cloneable æ¥å£çš„ç±»ï¼Œé‚£ä¹ˆé™¤äº†å®ç°è¡Œä¸ºè‰¯å¥½çš„ clone æ–¹æ³•ä¹‹å¤–ï¼Œä½ åˆ«æ— é€‰æ‹©ã€‚å¦åˆ™ï¼Œæœ€å¥½æä¾›å¯¹è±¡å¤åˆ¶çš„æ›¿ä»£æ–¹æ³•ã€‚ä¸€ä¸ªæ›´å¥½çš„å¯¹è±¡å¤åˆ¶æ–¹æ³•æ˜¯æä¾›ä¸€ä¸ªå¤åˆ¶æ„é€ å‡½æ•°æˆ–å¤åˆ¶å·¥å‚ã€‚å¤åˆ¶æ„é€ å‡½æ•°æ˜¯ä¸€ä¸ªç®€å•çš„æ„é€ å‡½æ•°ï¼Œå®ƒæ¥å—å•ä¸ªå‚æ•°ï¼Œå…¶ç±»å‹æ˜¯åŒ…å«æ„é€ å‡½æ•°çš„ç±»ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Copy constructor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="nf">Yum</span><span class="o">(</span><span class="n">Yum</span> <span class="n">yum</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">};</span>
</span></span></code></pre></div><p>å¤åˆ¶å·¥å‚ä¸å¤åˆ¶æ„é€ å‡½æ•°çš„é™æ€å·¥å‚ç±»ä¼¼ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Copy factory
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">static</span> <span class="n">Yum</span> <span class="nf">newInstance</span><span class="o">(</span><span class="n">Yum</span> <span class="n">yum</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">};</span>
</span></span></code></pre></div><p>å¤åˆ¶æ„é€ å‡½æ•°æ–¹æ³•åŠå…¶é™æ€å·¥å‚å˜ä½“ä¸å…‹éš†/å…‹éš†ç›¸æ¯”æœ‰è®¸å¤šä¼˜ç‚¹ï¼šå®ƒä»¬ä¸ä¾èµ–äºæ˜“å‘ç”Ÿé£é™©çš„è¯­è¨€å¤–å¯¹è±¡åˆ›å»ºæœºåˆ¶ï¼›ä»–ä»¬ä¸è¦æ±‚æ— æ³•å¼ºåˆ¶æ‰§è¡Œçš„çº¦å®šï¼›å®ƒä»¬ä¸æœ€ç»ˆå­—æ®µçš„æ­£ç¡®ä½¿ç”¨ä¸å†²çªï¼›å®ƒä»¬ä¸ä¼šæŠ›å‡ºä¸å¿…è¦çš„æ£€æŸ¥å¼‚å¸¸ï¼›è€Œä¸”ä¸éœ€è¦å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚</p>
<p>æ­¤å¤–ï¼Œå¤åˆ¶æ„é€ å‡½æ•°æˆ–å·¥å‚å¯ä»¥æ¥å—ç±»å‹ä¸ºç±»å®ç°çš„æ¥å£çš„å‚æ•°ã€‚ä¾‹å¦‚ï¼ŒæŒ‰ç…§çº¦å®šï¼Œæ‰€æœ‰é€šç”¨é›†åˆå®ç°éƒ½æä¾›ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå…¶å‚æ•°ä¸º collection æˆ– Map ç±»å‹ã€‚åŸºäºæ¥å£çš„å¤åˆ¶æ„é€ å‡½æ•°å’Œå·¥å‚ï¼ˆæ›´ç¡®åˆ‡åœ°ç§°ä¸ºè½¬æ¢æ„é€ å‡½æ•°å’Œè½¬æ¢å·¥å‚ï¼‰å…è®¸å®¢æˆ·ç«¯é€‰æ‹©å‰¯æœ¬çš„å®ç°ç±»å‹ï¼Œè€Œä¸æ˜¯å¼ºè¿«å®¢æˆ·ç«¯æ¥å—åŸå§‹çš„å®ç°ç±»å‹ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ª HashSet sï¼Œå¹¶ä¸”å¸Œæœ›å°†å®ƒå¤åˆ¶ä¸º TreeSetã€‚å…‹éš†æ–¹æ³•ä¸èƒ½æä¾›è¿™ç§åŠŸèƒ½ï¼Œä½†æ˜¯ä½¿ç”¨è½¬æ¢æ„é€ å‡½æ•°å¾ˆå®¹æ˜“ï¼šnew TreeSet&lt;&gt;(s)ã€‚</p>
<p>è€ƒè™‘åˆ°ä¸ Cloneable ç›¸å…³çš„æ‰€æœ‰é—®é¢˜ï¼Œæ–°çš„æ¥å£ä¸åº”è¯¥æ‰©å±•å®ƒï¼Œæ–°çš„å¯æ‰©å±•ç±»ä¸åº”è¯¥å®ç°å®ƒã€‚è™½ç„¶ final ç±»å®ç° Cloneable æ¥å£çš„å±å®³è¦å°ä¸€äº›ï¼Œä½†è¿™åº”è¯¥è¢«è§†ä¸ºä¸€ç§æ€§èƒ½ä¼˜åŒ–ï¼Œä»…åœ¨æå°‘æ•°æƒ…å†µä¸‹æ˜¯åˆç†çš„ã€‚é€šå¸¸ï¼Œå¤åˆ¶åŠŸèƒ½æœ€å¥½ç”±æ„é€ å‡½æ•°æˆ–å·¥å‚æä¾›ã€‚è¿™ä¸ªè§„åˆ™çš„ä¸€ä¸ªæ˜æ˜¾çš„ä¾‹å¤–æ˜¯æ•°ç»„ï¼Œæœ€å¥½ä½¿ç”¨ clone æ–¹æ³•æ¥å¤åˆ¶æ•°ç»„ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>å»ºè®®æ…é‡è¦†ç›– <code>clone()</code> æ–¹æ³•ã€‚<code>clone()</code> æ–¹æ³•æ˜¯ä¸€ä¸ªç”¨äºå¯¹è±¡å¤åˆ¶çš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¹¶å°†åŸå§‹å¯¹è±¡çš„çŠ¶æ€å¤åˆ¶åˆ°æ–°çš„å¯¹è±¡ä¸­ã€‚ä½†æ˜¯ï¼Œåœ¨å®ç° <code>clone()</code> æ–¹æ³•æ—¶ï¼Œéœ€è¦æ³¨æ„ä¸€äº›é—®é¢˜ï¼Œå¦åˆ™ä½¿ç”¨ <code>clone()</code> æ–¹æ³•å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›æ½œåœ¨çš„é—®é¢˜ã€‚</p>
<p>ä»¥ä¸‹æ˜¯åœ¨å®ç° <code>clone()</code> æ–¹æ³•æ—¶éœ€è¦æ³¨æ„çš„ä¸€äº›é—®é¢˜ï¼š</p>
<ol>
<li>é¦–å…ˆï¼Œéœ€è¦ç¡®ä¿ç±»å®ç°äº† <code>Cloneable</code> æ¥å£ã€‚è¿™ä¸ªæ¥å£æ˜¯ä¸€ä¸ªæ ‡è®°æ¥å£ï¼Œæ²¡æœ‰ä»»ä½•æ–¹æ³•ï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ªç±»æ²¡æœ‰å®ç° <code>Cloneable</code> æ¥å£ï¼Œè°ƒç”¨å…¶ <code>clone()</code> æ–¹æ³•ä¼šæŠ›å‡º <code>CloneNotSupportedException</code> å¼‚å¸¸ã€‚</li>
<li>åœ¨å®ç° <code>clone()</code> æ–¹æ³•æ—¶ï¼Œéœ€è¦è°ƒç”¨ <code>super.clone()</code> æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¹¶å°†åŸå§‹å¯¹è±¡çš„çŠ¶æ€å¤åˆ¶åˆ°æ–°çš„å¯¹è±¡ä¸­ã€‚</li>
<li>å¦‚æœç±»çš„æˆå‘˜å˜é‡åŒ…å«å¯å˜å¯¹è±¡ï¼Œé‚£ä¹ˆéœ€è¦å¯¹è¿™äº›æˆå‘˜å˜é‡è¿›è¡Œæ·±åº¦å¤åˆ¶ï¼Œä»¥ç¡®ä¿æ–°å¯¹è±¡ä¸åŸå§‹å¯¹è±¡å…·æœ‰ä¸åŒçš„çŠ¶æ€ã€‚</li>
<li><code>clone()</code> æ–¹æ³•è¿”å›çš„å¯¹è±¡ç±»å‹æ˜¯ <code>Object</code>ï¼Œéœ€è¦è¿›è¡Œç±»å‹è½¬æ¢ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›ç±»å‹å®‰å…¨é—®é¢˜ã€‚å› æ­¤ï¼Œå»ºè®®åœ¨è¦†ç›– <code>clone()</code> æ–¹æ³•æ—¶ï¼Œå°†è¿”å›ç±»å‹å£°æ˜ä¸ºç±»æœ¬èº«çš„ç±»å‹ï¼Œå¹¶åœ¨æ–¹æ³•ä¸­è¿›è¡Œç±»å‹è½¬æ¢ã€‚</li>
<li>åœ¨å®ç° <code>clone()</code> æ–¹æ³•æ—¶ï¼Œéœ€è¦æ³¨æ„å¯¹å¼‚å¸¸çš„å¤„ç†ã€‚å¦‚æœä¸€ä¸ªç±»æ²¡æœ‰å®ç° <code>Cloneable</code> æ¥å£ï¼Œè°ƒç”¨å…¶ <code>clone()</code> æ–¹æ³•ä¼šæŠ›å‡º <code>CloneNotSupportedException</code> å¼‚å¸¸ã€‚åœ¨å®ç° <code>clone()</code> æ–¹æ³•æ—¶ï¼Œéœ€è¦è€ƒè™‘è¿™ä¸ªå¼‚å¸¸ï¼Œå¹¶åœ¨æ–¹æ³•ä¸­è¿›è¡Œé€‚å½“çš„å¤„ç†ã€‚</li>
</ol>
<p>æ€»ä¹‹ï¼Œåœ¨è¦†ç›– <code>clone()</code> æ–¹æ³•æ—¶ï¼Œéœ€è¦è€ƒè™‘åˆ°ä¸Šè¿°é—®é¢˜ï¼Œå¹¶æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œå¤„ç†ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦é‡‡ç”¨å…¶ä»–çš„å¤åˆ¶æ–¹å¼ï¼Œä¾‹å¦‚åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚å› æ­¤ï¼Œåœ¨è¦†ç›– <code>clone()</code> æ–¹æ³•ä¹‹å‰ï¼Œéœ€è¦ä»”ç»†è€ƒè™‘æ˜¯å¦çœŸæ­£éœ€è¦ä½¿ç”¨è¯¥æ–¹æ³•ï¼Œå¹¶æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©æœ€åˆé€‚çš„å¤åˆ¶æ–¹å¼ã€‚</p>
<h2 id="æ‰©å±•">æ‰©å±•</h2>
<h3 id="1æ·±åº¦æ‹·è´å’Œæµ…åº¦æ‹·è´">1ã€æ·±åº¦æ‹·è´å’Œæµ…åº¦æ‹·è´</h3>
<p>æ·±åº¦æ‹·è´å’Œæµ…åº¦æ‹·è´æ˜¯æŒ‡åœ¨è¿›è¡Œå¯¹è±¡å¤åˆ¶æ—¶ï¼Œå¯¹äºå¯¹è±¡ä¸­åŒ…å«çš„æˆå‘˜å˜é‡ï¼Œå¦‚ä½•è¿›è¡Œå¤åˆ¶çš„é—®é¢˜ã€‚</p>
<p>æµ…åº¦æ‹·è´æ˜¯æŒ‡åªå¤åˆ¶å¯¹è±¡ä¸­çš„åŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨ç±»å‹çš„åœ°å€ï¼Œè€Œä¸æ˜¯å¼•ç”¨ç±»å‹æ‰€æŒ‡å‘çš„å¯¹è±¡æœ¬èº«ã€‚è¿™å°±æ„å‘³ç€ï¼Œåœ¨è¿›è¡Œæµ…åº¦æ‹·è´æ—¶ï¼ŒåŸå§‹å¯¹è±¡å’Œå¤åˆ¶å¯¹è±¡ä¸­çš„å¼•ç”¨ç±»å‹æˆå‘˜å˜é‡å°†æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›æ½œåœ¨çš„é—®é¢˜ï¼Œä¾‹å¦‚ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€çš„æ”¹å˜ä¼šå½±å“åˆ°å¦ä¸€ä¸ªå¯¹è±¡ã€‚</p>
<p>æ·±åº¦æ‹·è´æ˜¯æŒ‡å°†å¯¹è±¡ä¸­çš„åŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨ç±»å‹æ‰€æŒ‡å‘çš„å¯¹è±¡éƒ½è¿›è¡Œå¤åˆ¶ã€‚è¿™å°±æ„å‘³ç€ï¼Œåœ¨è¿›è¡Œæ·±åº¦æ‹·è´æ—¶ï¼ŒåŸå§‹å¯¹è±¡å’Œå¤åˆ¶å¯¹è±¡ä¸­çš„å¼•ç”¨ç±»å‹æˆå‘˜å˜é‡å°†æŒ‡å‘ä¸åŒçš„å¯¹è±¡ï¼Œè¿™å¯ä»¥é¿å…ä¸Šè¿°é—®é¢˜ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸ªåŒ…å«ä¸€ä¸ªå¼•ç”¨ç±»å‹æˆå‘˜å˜é‡çš„ç±» <code>Person</code>ï¼Œå…¶ä¸­å¼•ç”¨ç±»å‹æˆå‘˜å˜é‡æ˜¯ä¸€ä¸ª <code>Address</code> å¯¹è±¡ã€‚å¦‚æœè¿›è¡Œæµ…åº¦æ‹·è´ï¼Œé‚£ä¹ˆå¤åˆ¶å¯¹è±¡ä¸­çš„ <code>address</code>æˆå‘˜å˜é‡å°†æŒ‡å‘åŸå§‹å¯¹è±¡ä¸­çš„ <code>address</code> æˆå‘˜å˜é‡æŒ‡å‘çš„åŒä¸€ä¸ª <code>Address</code> å¯¹è±¡ã€‚è¿™å°±æ„å‘³ç€ï¼Œå¦‚æœä¿®æ”¹å¤åˆ¶å¯¹è±¡ä¸­çš„ <code>address</code> æˆå‘˜å˜é‡ï¼ŒåŸå§‹å¯¹è±¡ä¸­çš„ <code>address</code> æˆå‘˜å˜é‡ä¹Ÿä¼šå‘ç”Ÿæ”¹å˜ã€‚</p>
<p>å¦‚æœè¿›è¡Œæ·±åº¦æ‹·è´ï¼Œé‚£ä¹ˆå¤åˆ¶å¯¹è±¡ä¸­çš„ <code>address</code> æˆå‘˜å˜é‡å°†æŒ‡å‘ä¸€ä¸ªæ–°çš„ <code>Address</code> å¯¹è±¡ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡å¯¹å¦ä¸€ä¸ªå¯¹è±¡é€ æˆçš„å½±å“ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿›è¡Œæ·±åº¦æ‹·è´å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œå› ä¸ºéœ€è¦é€’å½’åœ°å¤åˆ¶å¯¹è±¡ä¸­çš„æ‰€æœ‰æˆå‘˜å˜é‡å’Œå¼•ç”¨ç±»å‹æ‰€æŒ‡å‘çš„å¯¹è±¡ã€‚å› æ­¤ï¼Œåœ¨è¿›è¡Œå¯¹è±¡å¤åˆ¶æ—¶ï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©é€‚å½“çš„å¤åˆ¶æ–¹å¼ï¼Œä»¥æƒè¡¡æ€§èƒ½å’Œæ­£ç¡®æ€§ã€‚</p>
<p>åœ¨ Java ä¸­ï¼Œé€šè¿‡å®ç° <code>Cloneable</code> æ¥å£å’Œè¦†ç›– <code>clone()</code> æ–¹æ³•ï¼Œå¯ä»¥å®ç°å¯¹è±¡çš„æµ…åº¦æ‹·è´ã€‚å¦‚æœéœ€è¦è¿›è¡Œæ·±åº¦æ‹·è´ï¼Œå¯ä»¥é€šè¿‡åºåˆ—åŒ–å’Œååºåˆ—åŒ–å®ç°ï¼Œæˆ–è€…ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“è¿›è¡Œå¯¹è±¡å¤åˆ¶ã€‚</p>
<h3 id="2è¯·é—®åœ¨-java-ä¸­å¦‚ä½•å®ç°æ·±åº¦æ‹·è´">2ã€è¯·é—®åœ¨ Java ä¸­å¦‚ä½•å®ç°æ·±åº¦æ‹·è´ï¼Ÿ</h3>
<p>åœ¨ Java ä¸­ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼å®ç°æ·±åº¦æ‹·è´ï¼š</p>
<ol>
<li>
<p>é€šè¿‡å®ç° <code>Serializable</code> æ¥å£å®ç°æ·±åº¦æ‹·è´ï¼šåœ¨éœ€è¦è¿›è¡Œæ·±åº¦æ‹·è´çš„ç±»ä¸­å®ç° <code>Serializable</code> æ¥å£ï¼Œå¹¶é€šè¿‡åºåˆ—åŒ–å’Œååºåˆ—åŒ–å®ç°æ·±åº¦æ‹·è´ã€‚å…·ä½“æ¥è¯´ï¼Œå¯ä»¥å°†å¯¹è±¡åºåˆ—åŒ–ä¸ºå­—èŠ‚æ•°ç»„ï¼Œç„¶åå†å°†å­—èŠ‚æ•°ç»„ååºåˆ—åŒ–ä¸ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹è±¡ä¸­çš„æ‰€æœ‰æˆå‘˜å˜é‡éƒ½å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œå¦åˆ™å°†ä¼šæŠ›å‡º <code>NotSerializableException</code> å¼‚å¸¸ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªé€šè¿‡å®ç° <code>Serializable</code> æ¥å£å®ç°æ·±åº¦æ‹·è´çš„ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Address</span> <span class="n">address</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// æ„é€ æ–¹æ³•å’Œ getter/setter æ–¹æ³•çœç•¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Person</span> <span class="nf">deepCopy</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ClassNotFoundException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// å°†å¯¹è±¡åºåˆ—åŒ–ä¸ºå­—èŠ‚æ•°ç»„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">ByteArrayOutputStream</span> <span class="n">bos</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteArrayOutputStream</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">ObjectOutputStream</span> <span class="n">oos</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ObjectOutputStream</span><span class="o">(</span><span class="n">bos</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">oos</span><span class="o">.</span><span class="na">writeObject</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">oos</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// å°†å­—èŠ‚æ•°ç»„ååºåˆ—åŒ–ä¸ºä¸€ä¸ªæ–°çš„å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">ByteArrayInputStream</span> <span class="n">bis</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteArrayInputStream</span><span class="o">(</span><span class="n">bos</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="n">ObjectInputStream</span> <span class="n">ois</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ObjectInputStream</span><span class="o">(</span><span class="n">bis</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="o">(</span><span class="n">Person</span><span class="o">)</span> <span class="n">ois</span><span class="o">.</span><span class="na">readObject</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œé€šè¿‡å®ç° <code>Serializable</code> æ¥å£ï¼Œå¹¶åœ¨ <code>deepCopy()</code> æ–¹æ³•ä¸­å°†å¯¹è±¡åºåˆ—åŒ–ä¸ºå­—èŠ‚æ•°ç»„ï¼Œç„¶åå†å°†å­—èŠ‚æ•°ç»„ååºåˆ—åŒ–ä¸ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œä»è€Œå®ç°äº†æ·±åº¦æ‹·è´ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹è±¡ä¸­çš„æ‰€æœ‰æˆå‘˜å˜é‡éƒ½å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œå¦åˆ™å°†ä¼šæŠ›å‡º <code>NotSerializableException</code> å¼‚å¸¸ã€‚</p>
</li>
<li>
<p>é€šè¿‡å®ç°è‡ªå®šä¹‰æ·±åº¦æ‹·è´æ–¹æ³•å®ç°æ·±åº¦æ‹·è´ï¼šåœ¨éœ€è¦è¿›è¡Œæ·±åº¦æ‹·è´çš„ç±»ä¸­å®ç°è‡ªå®šä¹‰çš„æ·±åº¦æ‹·è´æ–¹æ³•ï¼Œé€’å½’åœ°å¤åˆ¶å¯¹è±¡ä¸­çš„æ‰€æœ‰æˆå‘˜å˜é‡å’Œå¼•ç”¨ç±»å‹æ‰€æŒ‡å‘çš„å¯¹è±¡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå¯¹è±¡ä¸­çš„æˆå‘˜å˜é‡åŒ…å«å¾ªç¯å¼•ç”¨ï¼Œé‚£ä¹ˆéœ€è¦å¯¹å¾ªç¯å¼•ç”¨è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œä»¥é¿å…æ— é™é€’å½’ã€‚</p>
</li>
<li>
<p>ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“å®ç°æ·±åº¦æ‹·è´ï¼šJava ä¸­æœ‰è®¸å¤šç¬¬ä¸‰æ–¹åº“å¯ä»¥ç”¨äºå®ç°æ·±åº¦æ‹·è´ï¼Œä¾‹å¦‚ Apache Commons çš„ <code>SerializationUtils</code>ã€Google çš„ <code>Gson</code>ã€Jackson ç­‰ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ Jackson åº“å®ç°æ·±åº¦æ‹·è´çš„ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.fasterxml.jackson.databind.ObjectMapper</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Address</span> <span class="n">address</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// æ„é€ æ–¹æ³•å’Œ getter/setter æ–¹æ³•çœç•¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Person</span> <span class="nf">deepCopy</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ObjectMapper</span> <span class="n">objectMapper</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ObjectMapper</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">String</span> <span class="n">json</span> <span class="o">=</span> <span class="n">objectMapper</span><span class="o">.</span><span class="na">writeValueAsString</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">objectMapper</span><span class="o">.</span><span class="na">readValue</span><span class="o">(</span><span class="n">json</span><span class="o">,</span> <span class="n">Person</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œé€šè¿‡ä½¿ç”¨ Jackson åº“å°†å¯¹è±¡è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²ï¼Œç„¶åå†å°† JSON å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ–°çš„å¯¹è±¡ï¼Œä»è€Œå®ç°äº†æ·±åº¦æ‹·è´ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå¯¹è±¡ä¸­çš„æˆå‘˜å˜é‡åŒ…å«å¾ªç¯å¼•ç”¨ï¼Œé‚£ä¹ˆéœ€è¦å¯¹å¾ªç¯å¼•ç”¨è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œä»¥é¿å…æ— é™é€’å½’ã€‚</p>
</li>
<li>
<p>ä½¿ç”¨æµå¼ APIï¼šJava 8 å¼•å…¥äº†æµå¼ APIï¼Œå¯ä»¥ä½¿ç”¨æµå¼ API æ¥å®ç°å¯¹è±¡çš„æ·±åº¦æ‹·è´ã€‚å…·ä½“æ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨ <code>map()</code> æ–¹æ³•å°†å¯¹è±¡æµä¸­çš„æ¯ä¸ªå…ƒç´ å¤åˆ¶ä¸ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œç„¶åä½¿ç”¨ <code>collect()</code> æ–¹æ³•å°†æ–°å¯¹è±¡æ”¶é›†åˆ°ä¸€ä¸ªé›†åˆä¸­ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå¯¹è±¡ä¸­çš„æˆå‘˜å˜é‡åŒ…å«å¾ªç¯å¼•ç”¨ï¼Œé‚£ä¹ˆéœ€è¦å¯¹å¾ªç¯å¼•ç”¨è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œä»¥é¿å…æ— é™é€’å½’ã€‚</p>
<p>å½“ä½¿ç”¨æµå¼ API å®ç°æ·±åº¦æ‹·è´æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>map()</code> æ–¹æ³•å°†å¯¹è±¡æµä¸­çš„æ¯ä¸ªå…ƒç´ å¤åˆ¶ä¸ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œç„¶åä½¿ç”¨ <code>collect()</code> æ–¹æ³•å°†æ–°å¯¹è±¡æ”¶é›†åˆ°ä¸€ä¸ªé›†åˆä¸­ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå¯¹è±¡ä¸­çš„æˆå‘˜å˜é‡åŒ…å«å¾ªç¯å¼•ç”¨ï¼Œé‚£ä¹ˆéœ€è¦å¯¹å¾ªç¯å¼•ç”¨è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œä»¥é¿å…æ— é™é€’å½’ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨æµå¼ API å®ç°æ·±åº¦æ‹·è´çš„ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.stream.Collectors</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Address</span> <span class="n">address</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// æ„é€ æ–¹æ³•å’Œ getter/setter æ–¹æ³•çœç•¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Person</span> <span class="nf">deepCopy</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">List</span><span class="o">&lt;</span><span class="n">Address</span><span class="o">&gt;</span> <span class="n">addresses</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">addresses</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">          <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">Address</span><span class="o">::</span><span class="n">deepCopy</span><span class="o">)</span> <span class="c1">// ä½¿ç”¨ map() æ–¹æ³•å°†æ¯ä¸ª Address å¯¹è±¡å¤åˆ¶ä¸ºä¸€ä¸ªæ–°çš„å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span> <span class="c1">// ä½¿ç”¨ collect() æ–¹æ³•å°†æ–°å¯¹è±¡æ”¶é›†åˆ°ä¸€ä¸ªé›†åˆä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="k">new</span> <span class="n">Person</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">name</span><span class="o">,</span> <span class="n">addresses</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Address</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">street</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">city</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// æ„é€ æ–¹æ³•å’Œ getter/setter æ–¹æ³•çœç•¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Address</span> <span class="nf">deepCopy</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">Address</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">street</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">city</span><span class="o">);</span> 
</span></span><span class="line"><span class="cl">      <span class="c1">// ç›´æ¥å¤åˆ¶ Address å¯¹è±¡å³å¯ï¼Œå› ä¸º Address ç±»ä¸­æ²¡æœ‰å¼•ç”¨ç±»å‹çš„æˆå‘˜å˜é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œé€šè¿‡ä½¿ç”¨æµå¼ API å°† <code>addresses</code> é›†åˆä¸­çš„æ¯ä¸ª <code>Address</code> å¯¹è±¡å¤åˆ¶ä¸ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¹¶å°†æ–°å¯¹è±¡æ”¶é›†åˆ°ä¸€ä¸ªé›†åˆä¸­ï¼Œä»è€Œå®ç°äº† <code>Person</code> å¯¹è±¡çš„æ·±åº¦æ‹·è´ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å®ç° <code>Address</code> çš„ <code>deepCopy()</code> æ–¹æ³•æ—¶ï¼Œå› ä¸º <code>Address</code> ç±»ä¸­æ²¡æœ‰å¼•ç”¨ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œå› æ­¤å¯ä»¥ç›´æ¥å¤åˆ¶ä¸€ä¸ªæ–°çš„ <code>Address</code> å¯¹è±¡å³å¯ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå¯¹è±¡ä¸­çš„æˆå‘˜å˜é‡åŒ…å«å¾ªç¯å¼•ç”¨ï¼Œé‚£ä¹ˆéœ€è¦è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œä»¥é¿å…æ— é™é€’å½’ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œå¦‚æœ <code>Person</code> ç±»ä¸­åŒ…å«ä¸€ä¸ª <code>List&lt;Person&gt;</code> ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œé‚£ä¹ˆåœ¨è¿›è¡Œæ·±åº¦æ‹·è´æ—¶å°±éœ€è¦å¯¹ <code>List&lt;Person&gt;</code> è¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚</p>
</li>
</ol>
]]></content:encoded>
    </item>
    
    <item>
      <title>ã€ŠEffective Java 3ã€‹ç¬”è®°12ï¼šå½“è¦†ç›– equals æ–¹æ³•æ—¶ï¼Œæ€»è¦è¦†ç›– hashCode æ–¹æ³•</title>
      <link>https://blog.chensoul.com/posts/2023/05/26/always-override-tostring/</link>
      <pubDate>Fri, 26 May 2023 07:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/05/26/always-override-tostring/</guid>
      <description>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬ä¸‰ç« ã€Šå¯¹è±¡çš„é€šç”¨æ–¹æ³•ã€‹çš„å­¦ä¹ ç¬”è®°ï¼šå§‹ç»ˆè¦†ç›– toString æ–¹æ³•ã€‚ ä»‹ç» è™½ç„¶ Object æä¾› toString æ–¹æ³•çš„å®ç°ï¼Œä½†å®ƒè¿”å›çš„å­—ç¬¦ä¸²é€šå¸¸ä¸æ˜¯ç±»çš„</description>
      <content:encoded><![CDATA[<p>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬ä¸‰ç« ã€Šå¯¹è±¡çš„é€šç”¨æ–¹æ³•ã€‹çš„å­¦ä¹ ç¬”è®°ï¼šå§‹ç»ˆè¦†ç›– toString æ–¹æ³•ã€‚</p>
<h2 id="ä»‹ç»">ä»‹ç»</h2>
<p>è™½ç„¶ Object æä¾› toString æ–¹æ³•çš„å®ç°ï¼Œä½†å®ƒè¿”å›çš„å­—ç¬¦ä¸²é€šå¸¸ä¸æ˜¯ç±»çš„ç”¨æˆ·å¸Œæœ›çœ‹åˆ°çš„ã€‚å®ƒç”±åè·Ÿã€Œatã€ç¬¦å·ï¼ˆ@ï¼‰çš„ç±»åå’Œ hash ä»£ç çš„æ— ç¬¦å·åå…­è¿›åˆ¶è¡¨ç¤ºï¼ˆä¾‹å¦‚ <code>PhoneNumber@163b91</code>ï¼‰ç»„æˆã€‚toString çš„é€šç”¨çº¦å®šæ˜¯è¿™ä¹ˆæè¿°çš„ï¼Œè¿”å›çš„å­—ç¬¦ä¸²åº”è¯¥æ˜¯ã€Œç®€æ´ä½†ä¿¡æ¯ä¸°å¯Œçš„è¡¨ç¤ºï¼Œæ˜“äºé˜…è¯»ã€ã€‚è™½ç„¶æœ‰äººè®¤ä¸º <code>PhoneNumber@163b91</code> ç®€æ´æ˜“æ‡‚ï¼Œä½†ä¸ <code>707-867-5309</code> ç›¸æ¯”ï¼Œå®ƒçš„ä¿¡æ¯é‡å¹¶ä¸å¤§ã€‚toString çº¦å®šæ¥ç€æè¿°ï¼Œã€Œå»ºè®®æ‰€æœ‰å­ç±»è¦†ç›–æ­¤æ–¹æ³•ã€‚ã€å¥½å»ºè®®ï¼Œç¡®å®ï¼</p>
<p>è™½ç„¶å®ƒä¸å¦‚éµå®ˆ equals å’Œ hashCode çº¦å®šé‚£ä¹ˆé‡è¦ï¼Œä½†æ˜¯ <strong>æä¾›ä¸€ä¸ªå¥½çš„ toString å®ç°ï¼ˆèƒ½ï¼‰ä½¿ç±»æ›´æ˜“äºä½¿ç”¨ï¼Œä½¿ç”¨è¯¥ç±»çš„ç³»ç»Ÿï¼ˆä¹Ÿï¼‰æ›´æ˜“äºè°ƒè¯•ã€‚</strong> å½“å¯¹è±¡è¢«ä¼ é€’ç»™ printlnã€printfã€å­—ç¬¦ä¸²è¿æ¥æ“ä½œç¬¦æˆ–æ–­è¨€æˆ–ç”±è°ƒè¯•å™¨æ‰“å°æ—¶ï¼Œå°†è‡ªåŠ¨è°ƒç”¨ toString æ–¹æ³•ã€‚å³ä½¿ä½ ä»æ¥æ²¡æœ‰è°ƒç”¨ toString å¯¹è±¡ï¼Œå…¶ä»–äººä¹Ÿå¯èƒ½ï¼ˆä½¿ç”¨ï¼‰ã€‚ä¾‹å¦‚ï¼Œæœ‰å¯¹è±¡å¼•ç”¨çš„ç»„ä»¶å¯ä»¥åœ¨æ—¥å¿—é”™è¯¯æ¶ˆæ¯ä¸­åŒ…å«å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚å¦‚æœä½ æœªèƒ½è¦†ç›– toStringï¼Œåˆ™è¯¥æ¶ˆæ¯å¯èƒ½å®Œå…¨æ— ç”¨ã€‚</p>
<p>å¦‚æœä½ å·²ç»ä¸º PhoneNumber æä¾›äº†ä¸€ä¸ªå¥½çš„ toString æ–¹æ³•ï¼Œé‚£ä¹ˆç”Ÿæˆä¸€ä¸ªæœ‰ç”¨çš„è¯Šæ–­æ¶ˆæ¯å°±åƒè¿™æ ·ç®€å•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Failed to connect to &#34;</span> <span class="o">+</span> <span class="n">phoneNumber</span><span class="o">);</span>
</span></span></code></pre></div><p>æ— è®ºä½ æ˜¯å¦è¦†ç›– toStringï¼Œç¨‹åºå‘˜éƒ½ä¼šä»¥è¿™ç§æ–¹å¼ç”Ÿæˆè¯Šæ–­æ¶ˆæ¯ï¼Œä½†æ˜¯é™¤éä½ ï¼ˆè¦†ç›– toStringï¼‰ï¼Œå¦åˆ™è¿™äº›æ¶ˆæ¯ä¸ä¼šæœ‰ç”¨ã€‚æä¾›å¥½çš„ toString æ–¹æ³•çš„å¥½å¤„ä¸ä»…ä»…æ˜¯å°†ç±»çš„å®ä¾‹æ‰©å±•åˆ°åŒ…å«å¯¹è¿™äº›å®ä¾‹çš„å¼•ç”¨çš„å¯¹è±¡ï¼Œç‰¹åˆ«æ˜¯é›†åˆã€‚åœ¨æ‰“å° map æ—¶ï¼Œä½ æ›´æ„¿æ„çœ‹åˆ°å“ªä¸ªï¼Œ<code>{Jenny=PhoneNumber@163b91}</code> è¿˜æ˜¯ <code>{Jenny=707-867-5309}</code>ï¼Ÿ</p>
<p><strong>å½“å®é™…ä½¿ç”¨æ—¶ï¼ŒtoString æ–¹æ³•åº”è¯¥è¿”å›å¯¹è±¡ä¸­åŒ…å«çš„æ‰€æœ‰æœ‰è¶£ä¿¡æ¯ï¼Œ</strong> å¦‚ç”µè¯å·ç ç¤ºä¾‹æ‰€ç¤ºã€‚å¦‚æœå¯¹è±¡å¾ˆå¤§ï¼Œæˆ–è€…åŒ…å«ä¸åˆ©äºå­—ç¬¦ä¸²è¡¨ç¤ºçš„çŠ¶æ€ï¼Œé‚£ä¹ˆè¿™ç§æ–¹æ³•æ˜¯ä¸åˆ‡å®é™…çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒtoString åº”è¯¥è¿”å›ä¸€ä¸ªæ‘˜è¦ï¼Œä¾‹å¦‚æ›¼å“ˆé¡¿ä½å®…ç”µè¯ç›®å½•ï¼ˆ1487536 å·æ¸…å•ï¼‰æˆ– <code>Thread[main,5,main]</code>ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œå­—ç¬¦ä¸²åº”è¯¥æ˜¯ä¸è¨€è‡ªæ˜çš„ã€‚ï¼ˆçº¿ç¨‹ç¤ºä¾‹æœªèƒ½é€šè¿‡æ­¤æµ‹è¯•ã€‚ï¼‰å¦‚æœæ²¡æœ‰åœ¨å­—ç¬¦ä¸²è¡¨ç¤ºä¸­åŒ…å«æ‰€æœ‰å¯¹è±¡çš„æœ‰è¶£ä¿¡æ¯ï¼Œé‚£ä¹ˆä¸€ä¸ªç‰¹åˆ«æ¼äººçš„æƒ©ç½šå°±æ˜¯æµ‹è¯•å¤±è´¥æŠ¥å‘Šï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Assertion</span> <span class="n">failure</span><span class="o">:</span> <span class="n">expected</span> <span class="o">{</span><span class="n">abc</span><span class="o">,</span> <span class="n">123</span><span class="o">},</span> <span class="n">but</span> <span class="n">was</span> <span class="o">{</span><span class="n">abc</span><span class="o">,</span> <span class="n">123</span><span class="o">}.</span>
</span></span></code></pre></div><p>åœ¨å®ç° toString æ–¹æ³•æ—¶ï¼Œä½ å¿…é¡»åšçš„ä¸€ä¸ªé‡è¦å†³å®šæ˜¯æ˜¯å¦åœ¨æ–‡æ¡£ä¸­æŒ‡å®šè¿”å›å€¼çš„æ ¼å¼ã€‚å»ºè®®ä½ é’ˆå¯¹å€¼ç±»ï¼ˆå¦‚ç”µè¯å·ç æˆ–çŸ©é˜µï¼‰è¿™æ ·åšã€‚æŒ‡å®šæ ¼å¼çš„ä¼˜ç‚¹æ˜¯ï¼Œå®ƒå¯ä»¥ä½œä¸ºå¯¹è±¡çš„æ ‡å‡†çš„ã€æ˜ç¡®çš„ã€äººç±»å¯è¯»çš„è¡¨ç¤ºã€‚è¿™ç§è¡¨ç¤ºå¯ä»¥ç”¨äºè¾“å…¥å’Œè¾“å‡ºï¼Œä¹Ÿå¯ä»¥ç”¨äºæŒä¹…çš„äººç±»å¯è¯»æ•°æ®å¯¹è±¡ï¼Œæ¯”å¦‚ CSV æ–‡ä»¶ã€‚å¦‚æœæŒ‡å®šäº†æ ¼å¼ï¼Œæä¾›ä¸€ä¸ªåŒ¹é…çš„é™æ€å·¥å‚æˆ–æ„é€ å‡½æ•°é€šå¸¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œè¿™æ ·ç¨‹åºå‘˜å°±å¯ä»¥è½»æ¾åœ°åœ¨å¯¹è±¡åŠå…¶å­—ç¬¦ä¸²è¡¨ç¤ºä¹‹é—´æ¥å›è½¬æ¢ã€‚Java åº“ä¸­çš„è®¸å¤šå€¼ç±»éƒ½é‡‡ç”¨è¿™ç§æ–¹æ³•ï¼ŒåŒ…æ‹¬ BigIntegerã€BigDecimal å’Œå¤§å¤šæ•°åŒ…è£…ç±»ã€‚</p>
<p>æŒ‡å®š toString è¿”å›å€¼çš„æ ¼å¼çš„ç¼ºç‚¹æ˜¯ï¼Œä¸€æ—¦æŒ‡å®šäº†å®ƒï¼Œå°±ä¼šç»ˆç”Ÿä½¿ç”¨å®ƒï¼Œå‡è®¾ä½ çš„ç±»è¢«å¹¿æ³›ä½¿ç”¨ã€‚ç¨‹åºå‘˜å°†ç¼–å†™ä»£ç æ¥è§£æè¡¨ç¤ºã€ç”Ÿæˆè¡¨ç¤ºå¹¶å°†å…¶åµŒå…¥æŒä¹…æ•°æ®ä¸­ã€‚å¦‚æœä½ åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­æ›´æ”¹äº†è¡¨ç¤ºå½¢å¼ï¼Œä½ å°†ç ´åå®ƒä»¬çš„ä»£ç å’Œæ•°æ®ï¼Œå®ƒä»¬å°†å‘å‡ºå¤§é‡çš„æ¶ˆæ¯ã€‚é€šè¿‡é€‰æ‹©ä¸æŒ‡å®šæ ¼å¼ï¼Œä½ å¯ä»¥ä¿ç•™åœ¨åç»­ç‰ˆæœ¬ä¸­æ·»åŠ ä¿¡æ¯æˆ–æ”¹è¿›æ ¼å¼çš„çµæ´»æ€§ã€‚</p>
<p><strong>æ— è®ºä½ æ˜¯å¦å†³å®šæŒ‡å®šæ ¼å¼ï¼Œä½ éƒ½åº”è¯¥æ¸…æ¥šåœ°è®°å½•ä½ çš„æ„å›¾ã€‚</strong> å¦‚æœæŒ‡å®šäº†æ ¼å¼ï¼Œåˆ™åº”è¯¥ç²¾ç¡®åœ°æŒ‡å®šæ ¼å¼ã€‚ä¾‹å¦‚ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ª toString æ–¹æ³•ç”¨äºPhoneNumber ç±»ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">* Returns the string representation of this phone number.
</span></span></span><span class="line"><span class="cl"><span class="cm">* The string consists of twelve characters whose format is
</span></span></span><span class="line"><span class="cl"><span class="cm">* &#34;XXX-YYY-ZZZZ&#34;, where XXX is the area code, YYY is the
</span></span></span><span class="line"><span class="cl"><span class="cm">* prefix, and ZZZZ is the line number. Each of the capital
</span></span></span><span class="line"><span class="cl"><span class="cm">* letters represents a single decimal digit.
</span></span></span><span class="line"><span class="cl"><span class="cm">**
</span></span></span><span class="line"><span class="cl"><span class="cm">If any of the three parts of this phone number is too small
</span></span></span><span class="line"><span class="cl"><span class="cm">* to fill up its field, the field is padded with leading zeros.
</span></span></span><span class="line"><span class="cl"><span class="cm">* For example, if the value of the line number is 123, the last
</span></span></span><span class="line"><span class="cl"><span class="cm">* four characters of the string representation will be &#34;0123&#34;.
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&#34;%03d-%03d-%04d&#34;</span><span class="o">,</span> <span class="n">areaCode</span><span class="o">,</span> <span class="n">prefix</span><span class="o">,</span> <span class="n">lineNum</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>å¦‚æœä½ å†³å®šä¸æŒ‡å®šä¸€ç§æ ¼å¼ï¼Œæ–‡æ¡£æ³¨é‡Šåº”è¯¥å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">* Returns a brief description of this potion. The exact details
</span></span></span><span class="line"><span class="cl"><span class="cm">* of the representation are unspecified and subject to change,
</span></span></span><span class="line"><span class="cl"><span class="cm">* but the following may be regarded as typical:
</span></span></span><span class="line"><span class="cl"><span class="cm">**
</span></span></span><span class="line"><span class="cl"><span class="cm">&#34;[Potion #9: type=love, smell=turpentine, look=india ink]&#34;
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
</span></span></code></pre></div><p>åœ¨é˜…è¯»äº†è¿™ç¯‡æ–‡æ¡£æ³¨é‡Šä¹‹åï¼Œå½“æ ¼å¼è¢«æ›´æ”¹æ—¶ï¼Œç”Ÿæˆä¾èµ–äºæ ¼å¼ç»†èŠ‚çš„ä»£ç æˆ–æŒä¹…æ•°æ®çš„ç¨‹åºå‘˜å°†åªèƒ½æ€ªä»–ä»¬è‡ªå·±ã€‚</p>
<p>æ— è®ºä½ æ˜¯å¦æŒ‡å®šäº†æ ¼å¼ï¼Œéƒ½è¦ <strong>æä¾›å¯¹ toString è¿”å›å€¼ä¸­åŒ…å«çš„ä¿¡æ¯çš„ç¨‹åºæ€§è®¿é—®ã€‚</strong> ä¾‹å¦‚ï¼ŒPhoneNumber ç±»åº”è¯¥åŒ…å«åŒºåŸŸä»£ç ã€å‰ç¼€å’Œè¡Œå·çš„è®¿é—®å™¨ã€‚å¦‚æœåšä¸åˆ°è¿™ä¸€ç‚¹ï¼Œå°±ä¼šè¿«ä½¿éœ€è¦è¿™äº›ä¿¡æ¯çš„ç¨‹åºå‘˜è§£æå­—ç¬¦ä¸²ã€‚é™¤äº†é™ä½æ€§èƒ½å’Œä½¿ç¨‹åºå‘˜ä¸å¿…è¦çš„å·¥ä½œä¹‹å¤–ï¼Œè¿™ä¸ªè¿‡ç¨‹å¾ˆå®¹æ˜“å‡ºé”™ï¼Œå¹¶ä¸”ä¼šå¯¼è‡´è„†å¼±çš„ç³»ç»Ÿåœ¨ä½ æ›´æ”¹æ ¼å¼æ—¶å´©æºƒã€‚ç”±äºæ²¡æœ‰æä¾›è®¿é—®å™¨ï¼Œä½ å¯ä»¥å°†å­—ç¬¦ä¸²æ ¼å¼è½¬æ¢ä¸ºäº‹å®ä¸Šçš„ APIï¼Œå³ä½¿ä½ å·²ç»æŒ‡å®šäº†å®ƒå¯èƒ½ä¼šå‘ç”Ÿæ›´æ”¹ã€‚</p>
<p>åœ¨é™æ€å®ç”¨ç¨‹åºç±»ä¸­ç¼–å†™ toString æ–¹æ³•æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œåœ¨å¤§å¤šæ•° enum ç±»å‹ä¸­ä¹Ÿä¸åº”è¯¥ç¼–å†™ toString æ–¹æ³•ï¼Œå› ä¸º Java ä¸ºä½ æä¾›äº†ä¸€ä¸ªéå¸¸å¥½çš„æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œä½ åº”è¯¥åœ¨ä»»ä½•æŠ½è±¡ç±»ä¸­ç¼–å†™ toString æ–¹æ³•ï¼Œè¯¥ç±»çš„å­ç±»å…±äº«å…¬å…±çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ã€‚ä¾‹å¦‚ï¼Œå¤§å¤šæ•°é›†åˆå®ç°ä¸Šçš„ toString æ–¹æ³•éƒ½ç»§æ‰¿è‡ªæŠ½è±¡é›†åˆç±»ã€‚</p>
<p>è°·æ­Œçš„å¼€æ”¾æºç è‡ªåŠ¨å€¼å·¥å…·å°†ä¸ºä½ ç”Ÿæˆ toString æ–¹æ³•ï¼Œå¤§å¤šæ•° IDE ä¹Ÿæ˜¯å¦‚æ­¤ã€‚è¿™äº›æ–¹æ³•å¯ä»¥å¾ˆå¥½åœ°å‘Šè¯‰ä½ æ¯ä¸ªå­—æ®µçš„å†…å®¹ï¼Œä½†å¹¶ä¸ä¸“é—¨é’ˆå¯¹ç±»çš„å«ä¹‰ã€‚å› æ­¤ï¼Œä¾‹å¦‚ï¼Œå¯¹äº PhoneNumber ç±»ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆçš„ toString æ–¹æ³•æ˜¯ä¸åˆé€‚çš„ï¼ˆå› ä¸ºç”µè¯å·ç å…·æœ‰æ ‡å‡†çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ï¼‰ï¼Œä½†æ˜¯å¯¹äº Potion ç±»æ¥è¯´å®ƒæ˜¯å®Œå…¨å¯ä»¥æ¥å—çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªè‡ªåŠ¨ç”Ÿæˆçš„ toString æ–¹æ³•è¦æ¯”ä»å¯¹è±¡ç»§æ‰¿çš„æ–¹æ³•å¥½å¾—å¤šï¼Œå¯¹è±¡ç»§æ‰¿çš„æ–¹æ³•ä¸ä¼šå‘Šè¯‰ä½ å¯¹è±¡çš„å€¼ã€‚</p>
<p>å›é¡¾ä¸€ä¸‹ï¼Œåœ¨ä½ ç¼–å†™çš„æ¯ä¸ªå®ä¾‹åŒ–ç±»ä¸­è¦†ç›–å¯¹è±¡çš„ toString å®ç°ï¼Œé™¤éè¶…ç±»å·²ç»è¿™æ ·åšäº†ã€‚å®ƒä½¿ç±»æ›´æ˜“äºä½¿ç”¨ï¼Œå¹¶æœ‰åŠ©äºè°ƒè¯•ã€‚toString æ–¹æ³•åº”è¯¥ä»¥ç¾è§‚çš„æ ¼å¼è¿”å›å¯¹è±¡çš„ç®€æ˜ã€æœ‰ç”¨çš„æè¿°ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>å»ºè®®å§‹ç»ˆè¦†ç›– <code>toString()</code> æ–¹æ³•ã€‚è¿™æ˜¯å› ä¸º <code>toString()</code> æ–¹æ³•æ˜¯ Java ä¸­æœ€å¸¸ç”¨çš„æ–¹æ³•ä¹‹ä¸€ï¼Œå®ƒå¯ä»¥å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ–¹ä¾¿è¾“å‡ºå’Œæ—¥å¿—è®°å½•ç­‰æ“ä½œã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä¸€ä¸ªç±»æ²¡æœ‰è¦†ç›– <code>toString()</code> æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒå°†ç»§æ‰¿è‡ª <code>Object</code> ç±»çš„å®ç°ï¼Œè¯¥å®ç°è¿”å›ä¸€ä¸ªåŒ…å«å¯¹è±¡ç±»åå’Œæ•£åˆ—ç çš„å­—ç¬¦ä¸²ã€‚è¿™ä¸ªé»˜è®¤çš„å®ç°å¯èƒ½å¯¹äºè°ƒè¯•å’Œå¼€å‘è¿‡ç¨‹ä¸­çš„ä¸€äº›æ“ä½œæ˜¯æœ‰ç”¨çš„ï¼Œä½†é€šå¸¸ä¸ä¼šæä¾›æœ‰å…³å¯¹è±¡çš„æœ‰ç”¨ä¿¡æ¯ã€‚</p>
<p>å› æ­¤ï¼Œå»ºè®®åœ¨æ¯ä¸ªç±»ä¸­éƒ½è¦†ç›– <code>toString()</code> æ–¹æ³•ï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶æä¾›æœ‰ç”¨çš„ä¿¡æ¯ã€‚åœ¨å®ç° <code>toString()</code> æ–¹æ³•æ—¶ï¼Œå¯ä»¥è¿”å›ä¸€ä¸ªåŒ…å«æœ‰å…³å¯¹è±¡çŠ¶æ€çš„å­—ç¬¦ä¸²ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨è°ƒè¯•å’Œå…¶ä»–æ“ä½œä¸­ä½¿ç”¨è¯¥å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªç±»è¡¨ç¤ºä¸€ä¸ªäººï¼Œé‚£ä¹ˆå®ƒçš„ <code>toString()</code> æ–¹æ³•å¯ä»¥è¿”å›è¯¥äººçš„å§“åå’Œå¹´é¾„ï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶æ›´å¥½åœ°ç†è§£è¯¥å¯¹è±¡ã€‚</p>
<p>å¦å¤–ï¼Œåœ¨é‡å†™ <code>toString()</code> æ–¹æ³•æ—¶ï¼Œä¹Ÿåº”è¯¥éµå¾ªä¸€äº›çº¦å®šï¼Œä»¥ç¡®ä¿è¯¥æ–¹æ³•çš„å®ç°æ­£ç¡®ã€é«˜æ•ˆå’Œæ˜“äºä½¿ç”¨ã€‚å…¶ä¸­ä¸€äº›çº¦å®šåŒ…æ‹¬ï¼š</p>
<ol>
<li>è¿”å›çš„å­—ç¬¦ä¸²åº”è¯¥ä»¥å¯¹è±¡çš„ç±»åä½œä¸ºå¼€å¤´ï¼Œåé¢è·Ÿç€å¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š<code>Person{name='John', age=30}</code>ã€‚</li>
<li>è¿”å›çš„å­—ç¬¦ä¸²åº”è¯¥æ˜¯å¯è¯»çš„ï¼Œå¹¶ä¸”åº”è¯¥åŒ…å«æœ‰å…³å¯¹è±¡çŠ¶æ€çš„æ‰€æœ‰ä¿¡æ¯ï¼Œä»¥ä¾¿åœ¨éœ€è¦æ—¶æ›´å¥½åœ°ç†è§£è¯¥å¯¹è±¡ã€‚</li>
<li>è¿”å›çš„å­—ç¬¦ä¸²åº”è¯¥æ˜¯ä¸å¯å˜çš„ï¼Œå³ä¸èƒ½åœ¨è¿”å›å­—ç¬¦ä¸²åæ›´æ”¹å¯¹è±¡çŠ¶æ€ä»¥æ›´æ”¹è¿”å›å€¼ã€‚</li>
<li>è¿”å›çš„å­—ç¬¦ä¸²åº”è¯¥æ˜¯ç¬¦åˆè¯­è¨€ä¹ æƒ¯çš„ï¼Œå¹¶ä¸”åº”è¯¥é€‚åˆäºå›½é™…åŒ–å’Œæœ¬åœ°åŒ–ã€‚</li>
</ol>
<p>æ€»ä¹‹ï¼Œè¦†ç›– <code>toString()</code> æ–¹æ³•å¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œå› ä¸ºå®ƒæä¾›äº†æœ‰å…³å¯¹è±¡çŠ¶æ€çš„æœ‰ç”¨ä¿¡æ¯ï¼ŒåŒæ—¶ä¹Ÿç¬¦åˆ Java è¯­è¨€çš„ä¹ æƒ¯å’Œè§„èŒƒã€‚</p>
<p>Java ä¸­æœ‰å¾ˆå¤šå¯ä»¥è‡ªåŠ¨ç”Ÿæˆ <code>toString()</code> æ–¹æ³•çš„å¼€æºæ¡†æ¶ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„æ¡†æ¶ï¼š</p>
<ol>
<li>Apache Commons Lang - <code>ToStringBuilder</code>: Apache Commons Lang æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„å¼€æº Java å·¥å…·åº“ï¼Œå…¶ä¸­çš„ <code>ToStringBuilder</code> ç±»å¯ä»¥å¸®åŠ©å¼€å‘è€…è‡ªåŠ¨ç”Ÿæˆ <code>toString()</code> æ–¹æ³•ã€‚ä½¿ç”¨è¯¥ç±»éœ€è¦åœ¨éœ€è¦è‡ªåŠ¨ç”Ÿæˆ <code>toString()</code> æ–¹æ³•çš„ç±»ä¸­æ·»åŠ å¯¹åº”çš„æˆå‘˜å˜é‡ï¼Œå¹¶è°ƒç”¨ <code>ToStringBuilder</code> çš„ <code>reflectionToString()</code> æ–¹æ³•ã€‚</li>
<li>Guava - <code>MoreObjects.toStringHelper()</code>: Guava æ˜¯ Google å¼€æºçš„ä¸€ä¸ª Java å·¥å…·åº“ï¼Œå…¶ä¸­çš„ <code>MoreObjects</code> ç±»å¯ä»¥å¸®åŠ©å¼€å‘è€…è‡ªåŠ¨ç”Ÿæˆ <code>toString()</code> æ–¹æ³•ã€‚ä½¿ç”¨è¯¥ç±»éœ€è¦åœ¨éœ€è¦è‡ªåŠ¨ç”Ÿæˆ <code>toString()</code> æ–¹æ³•çš„ç±»ä¸­æ·»åŠ å¯¹åº”çš„æˆå‘˜å˜é‡ï¼Œå¹¶è°ƒç”¨ <code>MoreObjects</code> çš„ <code>toStringHelper()</code> æ–¹æ³•ã€‚</li>
<li>Lombok - <code>@ToString</code>: Lombok æ˜¯ä¸€ä¸ª Java åº“ï¼Œå®ƒå¯ä»¥é€šè¿‡æ³¨è§£æ¥ç®€åŒ– Java ä»£ç ã€‚å…¶ä¸­çš„ <code>@ToString</code> æ³¨è§£å¯ä»¥å¸®åŠ©å¼€å‘è€…è‡ªåŠ¨ç”Ÿæˆ <code>toString()</code> æ–¹æ³•ã€‚ä½¿ç”¨è¯¥æ³¨è§£åªéœ€è¦åœ¨éœ€è¦è‡ªåŠ¨ç”Ÿæˆ <code>toString()</code> æ–¹æ³•çš„ç±»ä¸Šæ·»åŠ  <code>@ToString</code> æ³¨è§£å³å¯ï¼ŒLombok ä¼šè‡ªåŠ¨ä¸ºè¯¥ç±»ç”Ÿæˆå¯¹åº”çš„ <code>toString()</code> æ–¹æ³•4. Eclipse Collections - <code>ToString</code>: Eclipse Collections æ˜¯ä¸€ä¸ªåŸºäº Java çš„é›†åˆæ¡†æ¶ï¼Œå…¶ä¸­çš„ <code>ToString</code> ç±»å¯ä»¥å¸®åŠ©å¼€å‘è€…è‡ªåŠ¨ç”Ÿæˆ <code>toString()</code> æ–¹æ³•ã€‚ä½¿ç”¨è¯¥ç±»éœ€è¦åœ¨éœ€è¦è‡ªåŠ¨ç”Ÿæˆ <code>toString()</code> æ–¹æ³•çš„ç±»ä¸­æ·»åŠ å¯¹åº”çš„æˆå‘˜å˜é‡ï¼Œå¹¶è°ƒç”¨ <code>ToString</code> çš„ <code>includeFields()</code> æ–¹æ³•ã€‚</li>
<li>Apache Commons BeanUtils - <code>ReflectionToStringBuilder</code>: Apache Commons BeanUtils æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„ Java Bean æ“ä½œå·¥å…·åº“ï¼Œå…¶ä¸­çš„ <code>ReflectionToStringBuilder</code> ç±»å¯ä»¥å¸®åŠ©å¼€å‘è€…è‡ªåŠ¨ç”Ÿæˆ <code>toString()</code> æ–¹æ³•ã€‚ä½¿ç”¨è¯¥ç±»éœ€è¦åœ¨éœ€è¦è‡ªåŠ¨ç”Ÿæˆ <code>toString()</code> æ–¹æ³•çš„ç±»ä¸­æ·»åŠ å¯¹åº”çš„æˆå‘˜å˜é‡ï¼Œå¹¶è°ƒç”¨ <code>ReflectionToStringBuilder</code> çš„ <code>toString()</code> æ–¹æ³•ã€‚</li>
</ol>
]]></content:encoded>
    </item>
    
    <item>
      <title>å‘¨æŠ¥-20ï½œè‡ªåŠ¨ç”Ÿæˆæ¯æ—¥æ—©æŠ¥ã€å‘¨æœ«å›¢å»º</title>
      <link>https://blog.chensoul.com/posts/2023/05/25/weekly_review_20/</link>
      <pubDate>Thu, 25 May 2023 17:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/05/25/weekly_review_20/</guid>
      <description>å‰è¨€ ä¹å†œæ¹–ç•”ç”Ÿæ€å›­ æœ¬ç¯‡æ˜¯å¯¹ 2023-05-15 åˆ° 2023-05-21 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚ ä¸çŸ¥ä¸è§‰ï¼Œè¿™å·²ç»æ˜¯ç¬¬20ç¯‡å‘¨æŠ¥äº†ã€‚</description>
      <content:encoded><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-20-00.jpeg" alt="weekly-review-20-00"  />
</p>
<center><i>ä¹å†œæ¹–ç•”ç”Ÿæ€å›­</i></center>
<br/>
<p>æœ¬ç¯‡æ˜¯å¯¹ <code>2023-05-15</code> åˆ° <code>2023-05-21</code> è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº <a href="https://blog.chensoul.com/">åšå®¢</a>ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚</p>
<p>ä¸çŸ¥ä¸è§‰ï¼Œè¿™å·²ç»æ˜¯ç¬¬20ç¯‡å‘¨æŠ¥äº†ã€‚è¿™å‘¨ä¾æ—§æ˜¯å¥èº«ã€ç†è´¢ã€å­¦ä¹ å’Œå†™åšå®¢ã€‚</p>
<h2 id="è‡ªåŠ¨ç”Ÿæˆæ¯æ—¥æ—©æŠ¥">è‡ªåŠ¨ç”Ÿæˆæ¯æ—¥æ—©æŠ¥</h2>
<p>æœ€è¿‘åœ¨æœ‹å‹åœˆçœ‹åˆ°è¿™æ ·ä¸€ä¸ªæ—©æŠ¥ï¼Œå°±åœ¨æƒ³èƒ½å¦é€šè¿‡ä»£ç è‡ªåŠ¨æŠ“å–æ–°é—»å¹¶ç”Ÿæˆè¿™æ ·ä¸€ä¸ªæ—©æŠ¥å›¾ç‰‡ï¼Ÿ</p>
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-20-04.jpeg" alt="weekly-review-20-04" style="width:50%;" />
<p>äºæ˜¯ï¼Œåœ¨ç½‘ä¸Šæ‰¾åˆ°ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://icodeq.com/2022/5fe2010403bb/">å‰åç«¯å‡åŸºäº vercel çš„æ¯æ—¥æ—©æŠ¥é¡¹ç›®</a></p>
<p>å‚è€ƒæºä»£ç ï¼Œåšäº†ä¸€äº›ä¿®æ”¹ï¼Œä»£ç è§ï¼š<a href="https://github.com/chensoul/chensoul/blob/main/fetch_news.py">fetch_news.py</a>ã€‚ä¿®æ”¹åçš„é€»è¾‘æ˜¯å°†æŠ“å–çš„æ–°é—»å‘é€åˆ° memosï¼Œä¾‹å¦‚ï¼š<a href="https://memos.chensoul.com/m/349">https://memos.chensoul.com/m/349</a> ã€‚å¯ä»¥åœ¨ github action è®¾ç½®æ¯å¤©æ—©ä¸Š7ç‚¹è‡ªåŠ¨å‘é€åˆ° memosï¼Œç„¶åå†é€šè¿‡ n8n åŒæ­¥åˆ° ã€<a href="https://t.me/chensoul_share">ChenSoul Share</a>ã€Telegram é¢‘é“ã€‚</p>
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-20-01.png" alt="weekly-review-20-01" style="width: 50%;" />
<p>åœ¨memosä¸­å¯¼å‡ºçš„å›¾ç‰‡å¦‚ä¸‹ï¼š</p>
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-20-05.png" alt="weekly-review-20-05" style="width:50%;" />
<p>å¦‚æœèƒ½å¤Ÿé€šè¿‡ python è‡ªåŠ¨ç”Ÿæˆå›¾ç‰‡ï¼Œé‚£å°±æ›´å¥½äº†ã€‚è®°å½•ä¸€ä¸‹ï¼Œå¾…ä»¥åå®ç°ã€‚</p>
<h2 id="å›¢å»º">å›¢å»º</h2>
<p>å…¬å¸å›¢å»ºé€‰æ‹©åœ¨å‘¨å…­ï¼Œè€Œä¸”è¿˜æ˜¯520è¿™ä¸€å¤©ï¼ŒçœŸæ˜¯ä¼šæŒ‘æ—¥å­ã€‚å¾ˆå¤šäººè¯·å‡ï¼Œæœ€ååªæœ‰13äººå‚åŠ å›¢å»ºï¼Œå…¶ä¸­æœ‰8äººæ˜¯æˆ‘ä»¬å¼€å‘ç»„çš„ğŸ¤£ã€‚æŒ‘ä¸¤å¼ ç…§ç‰‡å‘åˆ°è¿™é‡Œï½</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-20-03.jpeg" alt="weekly-review-20-03"  />
</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-20-02.jpeg" alt="weekly-review-20-02"  />
</p>
<h2 id="ç†è´¢">ç†è´¢</h2>
<p>è¿™å‘¨æ€»è®¡æ”¯å‡º 1861 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š</p>
<ul>
<li>5æœˆ15æ—¥ï¼š1027å…ƒï¼Œæ­¦åŠŸå±±æ—…æ¸¸ï¼ŒåŠ æ²¹327</li>
<li>5æœˆ16æ—¥ï¼š42å…ƒ</li>
<li>5æœˆ17æ—¥ï¼š12å…ƒ</li>
<li>5æœˆ18æ—¥ï¼š16å…ƒ</li>
<li>5æœˆ19æ—¥ï¼š25å…ƒ</li>
<li>5æœˆ20æ—¥ï¼š562å…ƒï¼Œçœ‹æœ›å…­èˆ…</li>
<li>5æœˆ21æ—¥ï¼š177å…ƒ</li>
</ul>
<h2 id="å¥èº«">å¥èº«</h2>
<p>æœ¬å‘¨è·‘æ­¥ 36 å…¬é‡Œï¼Œæœ€é•¿è·‘æ­¥è·ç¦»ä¸º 10 å…¬é‡Œã€‚æ˜ç»†æ•°æ®å¦‚ä¸‹ï¼š</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-20-08.png" alt="weekly-review-20-08"  />
</p>
<p>æˆ‘è·‘è¿‡äº†ä¸€äº›åœ°æ–¹ï¼Œå¸Œæœ›éšç€æ—¶é—´æ¨ç§»ï¼Œåœ°å›¾ç‚¹äº®çš„åœ°æ–¹è¶Šæ¥è¶Šå¤šã€‚2 å¹´é‡Œæˆ‘è·‘è¿‡ 2ä¸ªçœä»½ 2ä¸ªåŸå¸‚ã€‚æ›´å¤šè·‘æ­¥æ•°æ®åœ¨<a href="https://run.chensoul.com/">è·‘æ­¥</a>ä¸»é¡µã€‚</p>
<h2 id="å·¥ä½œ">å·¥ä½œ</h2>
<h4 id="åšå®¢">åšå®¢</h4>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-20-07.png" alt="weekly-review-20-07"  />
</p>
<p>æœ¬å‘¨å®Œæˆäº”ç¯‡åšå®¢ï¼š</p>
<ul>
<li>
<p><a href="/posts/2023/05/22/java-design-patterns-abstract-document/">Javaè®¾è®¡æ¨¡å¼ï¼šAbstract Document</a></p>
</li>
<li>
<p><a href="/posts/2023/05/22/java-design-patterns-abstract-factory/">Javaè®¾è®¡æ¨¡å¼ï¼šAbstract Factory</a></p>
</li>
<li>
<p><a href="/posts/2023/05/23/always-override-hashcode-when-you-override-equals/">ã€ŠEffective Java 3ã€‹ç¬”è®°11ï¼šå½“è¦†ç›– equals æ–¹æ³•æ—¶ï¼Œæ€»è¦è¦†ç›– hashCode æ–¹æ³•</a></p>
</li>
<li>
<p><a href="/posts/2023/05/22/docker-continuous-integration/">[è¯‘]Build Robust Continuous Integration With Docker and Friends</a></p>
</li>
<li>
<p><a href="/posts/2023/05/23/python-comment-and-variable/">Pythonå­¦ä¹ 1ï¼šæ³¨é‡Šã€å˜é‡å’Œå¸¸é‡</a></p>
</li>
</ul>
<h2 id="æœ¬å‘¨åˆ†äº«">æœ¬å‘¨åˆ†äº«</h2>
<p>å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€<a href="https://t.me/chensoul_share">ChenSoul Share</a>ã€Telegram é¢‘é“æˆ–è€…æˆ‘çš„ <a href="https://memos.chensoul.com/">memos</a> ä¸­ã€‚æˆ‘å†™äº†ä¸€ä¸ª python è„šæœ¬ä» memosè¯»å–æœ€è¿‘ä¸€å‘¨çš„ memos è®°å½•ã€‚</p>
<ul>
<li><strong>2023-05-19</strong> é™ˆçš“ï¼ˆå·¦è€³æœµè€—å­ï¼‰å‰å¹´åšè¿‡ä¸€æ¬¡ç›´æ’­è®¿è°ˆï¼Œè°ˆåˆ°äº†æŠ€æœ¯ã€è¡Œä¸šã€åˆ›ä¸šçš„å„ä¸ªæ–¹é¢ã€‚æœ¬æ–‡æ˜¯è®¿è°ˆå†…å®¹çš„æ–‡å­—æ•´ç†ï¼Œä»¥æ­¤çºªå¿µä»–ã€‚  <a href="https://mp.weixin.qq.com/s/bOnW8gDJ-dXp4KbAjhDw9A">https://mp.weixin.qq.com/s/bOnW8gDJ-dXp4KbAjhDw9A</a>  <code>#memos</code> <code>#skill</code> <code>#tool</code></li>
<li><strong>2023-05-17</strong> ç”¨ Material for MkDocs æ¥ç”Ÿæˆä¸“ä¸šçš„æŠ€æœ¯æ–‡æ¡£ <a href="https://vra.github.io/2023/05/17/mkdocs-material-tutorial/">https://vra.github.io/2023/05/17/mkdocs-material-tutorial/</a>  <code>#memos</code> <code>#tool</code></li>
<li><strong>2023-05-17</strong> åŸºäº  Popsy åˆ›å»ºè‡ªå·±çš„ä¸ªäººä¸»é¡µ <a href="https://popsy.co/">https://popsy.co/</a> <code>#memos</code> <code>#tool</code></li>
<li><strong>2023-05-17</strong> Hellonextæ˜¯ä¸€ç§åé¦ˆç®¡ç†å¹³å°ï¼Œå®ƒå¯ä»¥å¸®åŠ©ç»„ç»‡ã€ä¼ä¸šå’Œå¼€å‘å›¢é˜Ÿæ›´å¥½åœ°ç®¡ç†ç”¨æˆ·åé¦ˆå’Œéœ€æ±‚ã€‚å®ƒæä¾›äº†ä¸€ä¸ªç”¨æˆ·å‹å¥½çš„ç•Œé¢ï¼Œä½¿ç”¨æˆ·å¯ä»¥è½»æ¾åœ°æäº¤åé¦ˆå’Œå»ºè®®ï¼Œè€Œç®¡ç†äººå‘˜å¯ä»¥ä½¿ç”¨è¯¥å¹³å°æ¥è·Ÿè¸ªå’Œç»„ç»‡è¿™äº›åé¦ˆï¼Œå¹¶ç¡®å®šå“ªäº›åé¦ˆåº”è¯¥ä¼˜å…ˆè€ƒè™‘å®ç°ã€‚Hellonextè¿˜æä¾›äº†æ•°æ®åˆ†æå’ŒæŠ¥å‘ŠåŠŸèƒ½ï¼Œå¸®åŠ©ç®¡ç†äººå‘˜äº†è§£ç”¨æˆ·åé¦ˆçš„è¶‹åŠ¿å’Œä¼˜å…ˆçº§ï¼Œä»¥ä¾¿æ›´å¥½åœ°æ»¡è¶³ç”¨æˆ·éœ€æ±‚ã€‚ <a href="https://hellonext.co/">https://hellonext.co/</a> <code>#memos</code> <code>#tool</code></li>
<li><strong>2023-05-17</strong> Dify æ˜¯ä¸€ä¸ªç®€å•ä¸”èƒ½åŠ›ä¸°å¯Œçš„è‡ªç„¶è¯­è¨€ç¼–ç¨‹å·¥å…·ã€‚ä½ å¯ä»¥ç”¨å®ƒæ­å»ºå•†ç”¨çº§åº”ç”¨ï¼Œä¸ªäººåŠ©ç†ã€‚å¦‚æœä½ æƒ³è‡ªå·±å¼€å‘åº”ç”¨ï¼ŒDify ä¹Ÿèƒ½ä¸ºä½ çœä¸‹æ¥å…¥ OpenAI çš„åç«¯å·¥ä½œï¼Œä½†ä½¿ç”¨æˆ‘ä»¬é€æ­¥æä¾›é«˜çš„å¯è§†åŒ–è¿è¥èƒ½åŠ›ï¼Œä½ å¯ä»¥æŒç»­çš„æ”¹è¿›å’Œè®­ç»ƒä½ çš„ GPT æ¨¡å‹ã€‚ <a href="https://docs.dify.ai/v/zh-hans/getting-started/intro-to-dify">https://docs.dify.ai/v/zh-hans/getting-started/intro-to-dify</a> <code>#tool</code> <code>#memos</code></li>
<li><strong>2023-05-17</strong> ç”¨200è¡Œpythonä»£ç å®ç°dnsæœåŠ¡å™¨çš„æ•™ç¨‹ <a href="https://implement-dns.wizardzines.com/">https://implement-dns.wizardzines.com/</a>  <code>#memos</code> <code>#tool</code></li>
<li><strong>2023-05-17</strong> postman æ¨å‡ºäº†postbotï¼Œä½¿ç”¨äººå·¥æ™ºèƒ½å¸®åŠ©æ‚¨è°ƒè¯•å’Œç†è§£ APIã€æ›´å¿«åœ°ç¼–å†™æµ‹è¯•  <a href="https://blog.postman.com/introducing-postbot-postmans-new-ai-assistant/">https://blog.postman.com/introducing-postbot-postmans-new-ai-assistant/</a>  <code>#tool</code> <code>#memos</code></li>
<li><strong>2023-05-17</strong> <a href="https://imgg.gg/">https://imgg.gg/</a> æ˜¯ä¸€ä¸ªå¯ä»¥å°†ä»»æ„ sms å†…å®¹è½¬æ¢æˆä¸ºå›¾ç‰‡çš„å·¥å…·ï¼Œä¸ç”¨æ‹…å¿ƒåœ¨ APP ä¸Šæˆªå›¾ä¼šæ³„æ¼éšç§ã€‚ç”Ÿæˆçš„å›¾ç‰‡çš„æ ·å¼å¾ˆåƒ <a href="https://poet.so/">https://poet.so/</a> ï¼Œä¸è¿‡Poet.so åªèƒ½ç”Ÿæˆæ¨ç‰¹ã€linkedinã€shopify çš„åˆ†äº«å›¾ã€‚ <code>#tool</code> <code>#memos</code></li>
<li><strong>2023-05-17</strong> éƒ½çŸ¥é“ ffmpeg æ˜¯åª’ä½“æ–‡ä»¶å¤„ç†çš„ç‘å£«å†›åˆ€ï¼Œä½†å‘½ä»¤è¡Œçš„æ“ä½œå¯¹å¤§éƒ¨åˆ†äººæ¥è¯´ç¡®å®ä¼šé¢ä¸´è¿·èŒ«å’Œç¹çã€‚FFmpeg.guide å°±æ˜¯ä¸€ä¸ªå›¾å½¢åŒ–ç”Ÿæˆ ffmpeg å‘½ä»¤çš„å·¥å…·ã€‚  ç½‘ç«™åœ°å€ï¼š<a href="https://ffmpeg.guide/">https://ffmpeg.guide/</a> <code>#tool</code> <code>#memos</code></li>
</ul>
<p>ä»¥ä¸Šã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>Pythonå­¦ä¹ 1ï¼šæ³¨é‡Šã€å˜é‡å’Œå¸¸é‡</title>
      <link>https://blog.chensoul.com/posts/2023/05/23/python-comment-and-variable/</link>
      <pubDate>Tue, 23 May 2023 18:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/05/23/python-comment-and-variable/</guid>
      <description>Python æ³¨é‡Šã€å˜é‡å’Œå¸¸é‡æ˜¯ç¼–å†™ Python ä»£ç æ—¶éå¸¸é‡è¦çš„æ¦‚å¿µï¼Œä¸‹é¢åˆ†åˆ«ä»‹ç»å®ƒä»¬çš„åŸºæœ¬ç”¨æ³•å’Œè¯­æ³•ã€‚ Hello World åˆ›å»ºä¸€ä¸ª 00_helloworld.py æ–‡ä»¶ï¼Œæ‰“å° hello worldï¼š print(&amp;#34</description>
      <content:encoded><![CDATA[<p>Python æ³¨é‡Šã€å˜é‡å’Œå¸¸é‡æ˜¯ç¼–å†™ Python ä»£ç æ—¶éå¸¸é‡è¦çš„æ¦‚å¿µï¼Œä¸‹é¢åˆ†åˆ«ä»‹ç»å®ƒä»¬çš„åŸºæœ¬ç”¨æ³•å’Œè¯­æ³•ã€‚</p>
<h2 id="hello-world">Hello World</h2>
<p>åˆ›å»ºä¸€ä¸ª 00_helloworld.py æ–‡ä»¶ï¼Œæ‰“å° hello worldï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Helloï¼ŒWorld!&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>æ‰§è¡Œè¯¥æ–‡ä»¶ï¼Œä¼šè¾“å‡ºç»“æœï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python 00_helloworld.py
</span></span><span class="line"><span class="cl">Helloï¼ŒWorld!
</span></span></code></pre></div><p>ä¸€èˆ¬åœ¨pythonæ–‡ä»¶çš„å¼€å¤´ç¬¬ä¸€è¡Œï¼Œæˆ‘ä»¬éƒ½ä¼šçœ‹åˆ°ä¸‹é¢çš„ä»£ç è¡Œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># python2</span>
</span></span><span class="line"><span class="cl"><span class="c1">#!/usr/bin/env python</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æˆ–è€…</span>
</span></span><span class="line"><span class="cl"><span class="c1">#!/usr/bin/python</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># python3</span>
</span></span><span class="line"><span class="cl"><span class="c1">#!/usr/bin/env python3</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æˆ–è€…</span>
</span></span><span class="line"><span class="cl"><span class="c1">#!/usr/bin/python3</span>
</span></span></code></pre></div><p>è¿™è¡Œä»£ç ç”¨æ¥æŒ‡å®šæœ¬è„šæœ¬ç”¨ä»€ä¹ˆè§£é‡Šå™¨æ¥æ‰§è¡Œã€‚</p>
<p><code>#!/usr/bin/python</code> æ˜¯å‘Šè¯‰æ“ä½œç³»ç»Ÿæ‰§è¡Œè¿™ä¸ªè„šæœ¬çš„æ—¶å€™ï¼Œè°ƒç”¨ /usr/bin ä¸‹çš„ python è§£é‡Šå™¨ã€‚</p>
<p><code>#!/usr/bin/env python</code> è¿™ç§ç”¨æ³•æ˜¯ä¸ºäº†é˜²æ­¢æ“ä½œç³»ç»Ÿç”¨æˆ·æ²¡æœ‰å°† python è£…åœ¨é»˜è®¤çš„ /usr/bin è·¯å¾„é‡Œã€‚å½“ç³»ç»Ÿçœ‹åˆ°è¿™ä¸€è¡Œçš„æ—¶å€™ï¼Œé¦–å…ˆä¼šåˆ° env è®¾ç½®é‡ŒæŸ¥æ‰¾ python çš„å®‰è£…è·¯å¾„ï¼Œå†è°ƒç”¨å¯¹åº”è·¯å¾„ä¸‹çš„è§£é‡Šå™¨ç¨‹åºå®Œæˆæ“ä½œã€‚ä¸ºäº†å¢å¼ºä»£ç çš„å¯ç§»æ¤æ€§ï¼Œ<strong>æ¨èè¿™ç§å†™æ³•</strong>ã€‚</p>
<p>åœ¨ 00_helloworld.py æ·»åŠ è¿™è¡Œä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/env python</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Helloï¼ŒWorld!&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>ç„¶åï¼Œä¿®æ”¹è¯¥æ–‡ä»¶ä¸ºå¯æ‰§è¡Œå±æ€§ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">chmod +x 00_helloworld.py
</span></span></code></pre></div><p>å°±å¯ä»¥è¿™æ ·æ‰§è¡Œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">. 00_helloworld.py
</span></span></code></pre></div><h2 id="ç¼–ç æ ¼å¼">ç¼–ç æ ¼å¼</h2>
<p>Python3 é»˜è®¤çš„ç¼–ç æ ¼å¼æ˜¯UTF-8ï¼ˆUnicode Transformation Format - 8 bitï¼‰ã€‚è¿™æ˜¯ä¸€ç§é€šç”¨çš„å­—ç¬¦ç¼–ç ï¼Œæ”¯æŒå‡ ä¹æ‰€æœ‰çš„å­—ç¬¦é›†ï¼ŒåŒ…æ‹¬ ASCIIã€Latinã€ä¸­æ–‡ã€æ—¥æ–‡ã€éŸ©æ–‡ç­‰ã€‚</p>
<p>åœ¨ Python 3.x ä¸­ï¼Œæ‰€æœ‰çš„å­—ç¬¦ä¸²éƒ½æ˜¯ä»¥ Unicode ç¼–ç å­˜å‚¨çš„ã€‚å½“ä½ åœ¨ Python ä¸­åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»»ä½• Unicode å­—ç¬¦ï¼Œè€Œä¸å¿…æ‹…å¿ƒç¼–ç é—®é¢˜ã€‚</p>
<p>å½“ä½ æ‰“å¼€ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶æ—¶ï¼ŒPython ä¼šè‡ªåŠ¨å°è¯•ä½¿ç”¨ UTF-8 ç¼–ç æ¥è§£ææ–‡ä»¶å†…å®¹ã€‚å¦‚æœæ–‡ä»¶ä½¿ç”¨å…¶ä»–ç¼–ç æ ¼å¼ï¼Œä½ éœ€è¦ä½¿ç”¨ç›¸åº”çš„ç¼–ç æ ¼å¼æ¥æ‰“å¼€æ–‡ä»¶ï¼Œæˆ–è€…åœ¨è¯»å–æ–‡ä»¶å†…å®¹åå°†å…¶è§£ç ä¸º Unicodeã€‚</p>
<p>åœ¨ Python ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ç¼–ç å£°æ˜ï¼ˆcoding declarationï¼‰æ¥æŒ‡å®šæ–‡ä»¶çš„ç¼–ç æ ¼å¼ã€‚ç¼–ç å£°æ˜æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ³¨é‡Šï¼Œå‡ºç°åœ¨ Python æ–‡ä»¶çš„ç¬¬ä¸€è¡Œæˆ–ç¬¬äºŒè¡Œï¼ˆå¦‚æœæ–‡ä»¶çš„ç¬¬ä¸€è¡Œæ˜¯ shebangï¼Œåˆ™ç¼–ç å£°æ˜å¿…é¡»å‡ºç°åœ¨ç¬¬äºŒè¡Œï¼‰ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># -*- coding: encoding -*-</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æˆ–è€…</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># coding=utf-8</span>
</span></span></code></pre></div><p>å…¶ä¸­ï¼Œ<code>encoding</code> æ˜¯æ–‡ä»¶çš„ç¼–ç æ ¼å¼ï¼Œå¯ä»¥æ˜¯ UTF-8ã€ISO-8859-1 æˆ–å…¶ä»–ç¼–ç æ ¼å¼çš„åç§°ã€‚ç¼–ç å£°æ˜å‘Šè¯‰ Python è§£é‡Šå™¨åº”è¯¥ä½¿ç”¨æŒ‡å®šçš„ç¼–ç æ ¼å¼æ¥è§£æè¯¥æ–‡ä»¶ä¸­çš„æ–‡æœ¬å†…å®¹ã€‚å¦‚æœæ²¡æœ‰ç¼–ç å£°æ˜ï¼ŒPython3 é»˜è®¤ä½¿ç”¨ UTF-8 ç¼–ç æ¥è§£ææ–‡ä»¶å†…å®¹ã€‚</p>
<p>Python 2.x çš„é»˜è®¤ç¼–ç æ ¼å¼æ˜¯ ASCIIï¼Œè¿™æ˜¯ä¸€ç§ 7-bit çš„å­—ç¬¦ç¼–ç ï¼Œåªèƒ½è¡¨ç¤ºæœ€åŸºæœ¬çš„ ASCII å­—ç¬¦é›†ï¼Œæ— æ³•æ”¯æŒå¤šè¯­è¨€å’Œ Unicode å­—ç¬¦ã€‚</p>
<p>åœ¨ Python 2.x ä¸­ï¼Œå¦‚æœä½ éœ€è¦ä½¿ç”¨ Unicode å­—ç¬¦ï¼Œä½ éœ€è¦åœ¨å­—ç¬¦ä¸²å‰é¢æ·»åŠ ä¸€ä¸ª <code>u</code> å­—ç¬¦ï¼Œä»¥è¡¨ç¤ºè¯¥å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ª Unicode å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># -*- coding: utf-8 -*-</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;ä½ å¥½ï¼Œä¸–ç•Œï¼&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span> <span class="n">s</span>
</span></span></code></pre></div><p>åœ¨ Python 2.x ä¸­ï¼Œå¦‚æœä½ éœ€è¦æ‰“å¼€ä¸€ä¸ªé ASCII ç¼–ç çš„æ–‡æœ¬æ–‡ä»¶ï¼Œä½ éœ€è¦åœ¨æ‰“å¼€æ–‡ä»¶æ—¶æŒ‡å®šæ–‡ä»¶çš„ç¼–ç æ ¼å¼ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;filename.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">s</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;gbk&#39;</span><span class="p">)</span>  <span class="c1"># è¯»å–å¹¶è§£ç æ–‡ä»¶å†…å®¹</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span></code></pre></div><p>åœ¨ Python 2.x ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ç¼–ç å£°æ˜æ¥æŒ‡å®šæ–‡ä»¶çš„ç¼–ç æ ¼å¼ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># -*- coding: encoding -*-</span>
</span></span></code></pre></div><p>å…¶ä¸­ï¼Œ<code>encoding</code> æ˜¯æ–‡ä»¶çš„ç¼–ç æ ¼å¼ï¼Œå¯ä»¥æ˜¯ UTF-8ã€GBKã€ISO-8859-1 æˆ–å…¶ä»–ç¼–ç æ ¼å¼çš„åç§°ã€‚ç¼–ç å£°æ˜å‘Šè¯‰ Python è§£é‡Šå™¨åº”è¯¥ä½¿ç”¨æŒ‡å®šçš„ç¼–ç æ ¼å¼æ¥è§£æè¯¥æ–‡ä»¶ä¸­çš„æ–‡æœ¬å†…å®¹ã€‚å¦‚æœæ²¡æœ‰ç¼–ç å£°æ˜ï¼ŒPython 2.x é»˜è®¤ä½¿ç”¨ ASCII ç¼–ç æ¥è§£ææ–‡ä»¶å†…å®¹ã€‚</p>
<p>åœ¨ç»ˆç«¯è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹ç¼–ç æ ¼å¼ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ python
</span></span><span class="line"><span class="cl">Python 3.11.3 <span class="o">(</span>main, Apr  <span class="m">7</span> 2023, 20:13:31<span class="o">)</span> <span class="o">[</span>Clang 14.0.0 <span class="o">(</span>clang-1400.0.29.202<span class="o">)]</span> on darwin
</span></span><span class="line"><span class="cl">Type <span class="s2">&#34;help&#34;</span>, <span class="s2">&#34;copyright&#34;</span>, <span class="s2">&#34;credits&#34;</span> or <span class="s2">&#34;license&#34;</span> <span class="k">for</span> more information.
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; import sys
</span></span><span class="line"><span class="cl">&gt;&gt;&gt; sys.getdefaultencoding<span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="s1">&#39;utf-8&#39;</span>
</span></span></code></pre></div><h2 id="æ³¨é‡Š">æ³¨é‡Š</h2>
<p>åœ¨ Python ä¸­ï¼Œæ³¨é‡Šç”¨äºåœ¨ä»£ç ä¸­æ·»åŠ æ³¨é‡Šã€è§£é‡Šæˆ–è¯´æ˜ã€‚æ³¨é‡Šé€šå¸¸ç”¨äºæé«˜ä»£ç çš„å¯è¯»æ€§ï¼Œå¸®åŠ©å…¶ä»–äººç†è§£ä½ çš„ä»£ç ã€‚</p>
<p>Python æ”¯æŒä¸¤ç§ç±»å‹çš„æ³¨é‡Šï¼šå•è¡Œæ³¨é‡Šå’Œå¤šè¡Œæ³¨é‡Šã€‚</p>
<h3 id="å•è¡Œæ³¨é‡Š">å•è¡Œæ³¨é‡Š</h3>
<p>åœ¨ Python ä¸­ï¼Œå•è¡Œæ³¨é‡Šä»¥äº•å·(<code>#</code>)å¼€å¤´ï¼Œç”¨äºåœ¨ä»£ç è¡Œçš„æœ«å°¾æˆ–è€…ç‹¬ç«‹ä¸€è¡Œä¸­æ·»åŠ æ³¨é‡Šã€‚ä»»ä½•ç´§éšäº•å·åçš„æ–‡æœ¬éƒ½å°†è¢«è§£é‡Šå™¨å¿½ç•¥ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># è¿™æ˜¯ä¸€ä¸ªå•è¡Œæ³¨é‡Š</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Hello, World!&#34;</span><span class="p">)</span>  <span class="c1"># è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå•è¡Œæ³¨é‡Š</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">text</span> <span class="o">=</span> <span class="s2">&#34;# This is not a comment because it&#39;s inside quotes.&#34;</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç¬¬ä¸€è¡Œæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å•è¡Œæ³¨é‡Šï¼Œç¬¬äºŒè¡Œåˆ™æ˜¯åœ¨ä»£ç è¡Œçš„æœ«å°¾æ·»åŠ çš„å•è¡Œæ³¨é‡Šã€‚è¿™äº›æ³¨é‡Šä¸ä¼šå½±å“ç¨‹åºçš„æ‰§è¡Œï¼Œä½†æ˜¯å¯ä»¥å¸®åŠ©å…¶ä»–äººç†è§£ä½ çš„ä»£ç ã€‚</p>
<h3 id="å¤šè¡Œæ³¨é‡Š">å¤šè¡Œæ³¨é‡Š</h3>
<p>Pythonä¸­ä½¿ç”¨ä»¥ä¸‰ä¸ªå•å¼•å·æˆ–è€…ä¸‰ä¸ªåŒå¼•å·æ‹¬èµ·æ¥çš„æ³¨é‡Šè¢«è§†ä¸ºå¤šè¡Œæ³¨é‡Šã€‚å¤šè¡Œæ³¨é‡Šé€šå¸¸ç”¨äºæ³¨é‡Šå‡½æ•°ã€ç±»ã€æ¨¡å—ç­‰ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">è¿™æ˜¯ä¸€ä¸ªå¤šè¡Œæ³¨é‡Šï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="s1">å®ƒå¯ä»¥ç”¨äºæè¿°å‡½æ•°ã€ç±»æˆ–æ¨¡å—çš„åŠŸèƒ½å’Œä½¿ç”¨æ–¹æ³•ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">add_numbers</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">    è¿™æ˜¯ä¸€ä¸ªç”¨äºè®¡ç®—ä¸¤ä¸ªæ•°å­—ä¹‹å’Œçš„å‡½æ•°ã€‚
</span></span></span><span class="line"><span class="cl"><span class="s2">    å‚æ•°ï¼š
</span></span></span><span class="line"><span class="cl"><span class="s2">    a -- ç¬¬ä¸€ä¸ªæ•°å­—
</span></span></span><span class="line"><span class="cl"><span class="s2">    b -- ç¬¬äºŒä¸ªæ•°å­—
</span></span></span><span class="line"><span class="cl"><span class="s2">    è¿”å›å€¼ï¼š
</span></span></span><span class="line"><span class="cl"><span class="s2">    ä¸¤ä¸ªæ•°å­—çš„å’Œ
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</span></span></code></pre></div><blockquote>
<p>æ³¨æ„ï¼š</p>
<p>Pythonçš„å¤šè¡Œæ³¨é‡Šå®é™…ä¸Šæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å­—é¢å€¼ï¼Œå› æ­¤å¦‚æœä¸è¢«èµ‹å€¼ç»™ä»»ä½•å˜é‡ï¼Œå®ƒä»¬å°†ä¸ä¼šå¯¹ç¨‹åºäº§ç”Ÿä»»ä½•å½±å“ã€‚</p>
</blockquote>
<h2 id="å˜é‡">å˜é‡</h2>
<p>åœ¨ Python ä¸­ï¼Œå˜é‡æ˜¯ç”¨æ¥å­˜å‚¨æ•°æ®çš„æ ‡è¯†ç¬¦ã€‚å®ƒä»¬æ˜¯ç¨‹åºä¸­çš„ä¸€ç§åŸºæœ¬å…ƒç´ ï¼Œç”¨äºæ“ä½œæ•°æ®å¹¶åœ¨ç¨‹åºä¸­å¼•ç”¨å®ƒä»¬ã€‚</p>
<p>Python ä¸­çš„å˜é‡å¯ä»¥å­˜å‚¨å„ç§æ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬æ•°å­—ã€å­—ç¬¦ä¸²ã€åˆ—è¡¨ã€å…ƒç»„ã€å­—å…¸ç­‰ã€‚å˜é‡çš„å€¼å¯ä»¥éšæ—¶æ›´æ”¹ï¼Œå› æ­¤å®ƒä»¬æ˜¯åŠ¨æ€çš„ã€‚</p>
<p>å˜é‡çš„å‘½åè§„åˆ™å¦‚ä¸‹ï¼š</p>
<ul>
<li>å˜é‡åå¿…é¡»ä»¥å­—æ¯æˆ–ä¸‹åˆ’çº¿å¼€å¤´ã€‚</li>
<li>å˜é‡åå¯ä»¥åŒ…å«å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ã€‚</li>
<li>å˜é‡ååŒºåˆ†å¤§å°å†™ã€‚</li>
<li>å˜é‡åä¸èƒ½ä¸ Python çš„å…³é”®å­—ç›¸åŒã€‚</li>
</ul>
<blockquote>
<p>ä»¥ä¸‹æ˜¯ Python 3.x ç‰ˆæœ¬ä¸­çš„æ‰€æœ‰å…³é”®å­—ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">False  class   finally is      <span class="k">return</span>
</span></span><span class="line"><span class="cl">None   <span class="k">continue</span>    <span class="k">for</span>     lambda  try
</span></span><span class="line"><span class="cl">True   def     from    nonlocal    <span class="k">while</span>
</span></span><span class="line"><span class="cl">and    del     global  not     with
</span></span><span class="line"><span class="cl">as     <span class="k">elif</span>    <span class="k">if</span>      or      yield
</span></span><span class="line"><span class="cl">assert <span class="k">else</span>    import  pass    
</span></span><span class="line"><span class="cl"><span class="nb">break</span>  except  in      raise   
</span></span></code></pre></div><p>åœ¨ Python 2.x ä¸­ï¼Œè¿˜æœ‰ä¸¤ä¸ªé¢å¤–çš„å…³é”®å­— <code>exec</code> å’Œ <code>print</code>ï¼Œä½†å®ƒä»¬åœ¨ Python 3.x ä¸­å·²ç»è¢«ç§»é™¤ã€‚</p>
<p>å¦‚æœä½ ä¸ç¡®å®šæŸä¸ªæ ‡è¯†ç¬¦æ˜¯å¦æ˜¯å…³é”®å­—ï¼Œä½ å¯ä»¥ä½¿ç”¨ Python çš„ <code>keyword</code> æ¨¡å—æ¥æ£€æŸ¥ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">keyword</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
</span></span></code></pre></div></blockquote>
<h3 id="å˜é‡å®šä¹‰å’Œä½¿ç”¨">å˜é‡å®šä¹‰å’Œä½¿ç”¨</h3>
<p>åœ¨ Python ä¸­ï¼Œå¯ä»¥ä½¿ç”¨èµ‹å€¼è¯­å¥æ¥åˆ›å»ºå˜é‡ã€‚èµ‹å€¼è¯­å¥ä½¿ç”¨ç­‰å·(<code>=</code>)å°†å˜é‡åå’Œè¦å­˜å‚¨åœ¨å˜é‡ä¸­çš„å€¼åˆ†å¼€ã€‚</p>
<p>Pythonæ˜¯åŠ¨æ€ç±»å‹çš„è¯­è¨€ï¼Œæ— é¡»å£°æ˜å˜é‡ç±»å‹ï¼Œç›´æ¥å¯¹å˜é‡èµ‹å€¼å³å¯ä½¿ç”¨ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># åˆ›å»ºä¸€ä¸ªæ•´å‹å˜é‡ x</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="c1"># åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å˜é‡ name</span>
</span></span><span class="line"><span class="cl"><span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;John&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># åˆ›å»ºä¸€ä¸ªåˆ—è¡¨å˜é‡ my_list</span>
</span></span><span class="line"><span class="cl"><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å¼•ç”¨å˜é‡ x çš„å€¼</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># è¾“å‡º 5</span>
</span></span><span class="line"><span class="cl"><span class="c1"># å¼•ç”¨å˜é‡ name çš„å€¼</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;My name is&#34;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>  <span class="c1"># è¾“å‡º My name is John</span>
</span></span><span class="line"><span class="cl"><span class="c1"># å¼•ç”¨å˜é‡ my_list çš„å€¼</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_list</span><span class="p">)</span>  <span class="c1"># è¾“å‡º [1, 2, 3]</span>
</span></span></code></pre></div><p>åœ¨ Python ä¸­ï¼Œå˜é‡æ˜¯åŠ¨æ€ç±»å‹çš„ã€‚è¿™æ„å‘³ç€å˜é‡çš„ç±»å‹å¯ä»¥éšæ—¶æ›´æ”¹ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå˜é‡å¯ä»¥åœ¨ä¸€ä¸ªæ—¶åˆ»å­˜å‚¨ä¸€ä¸ªæ•´æ•°ï¼Œè€Œåœ¨ä¸‹ä¸€ä¸ªæ—¶åˆ»å­˜å‚¨ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># åŠ¨æ€ç±»å‹ç¤ºä¾‹</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># x æ˜¯ä¸€ä¸ªæ•´æ•°</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># è¾“å‡º 5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="s2">&#34;Hello, world!&#34;</span>  <span class="c1"># x æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># è¾“å‡º Hello, world!</span>
</span></span></code></pre></div><blockquote>
<p>åœ¨ Python ä¸­ï¼Œå˜é‡æ˜¯å¯¹è±¡çš„å¼•ç”¨ã€‚å½“ä¸€ä¸ªå˜é‡è¢«èµ‹å€¼ä¸ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå®ƒå®é™…ä¸Šæ˜¯å°†è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨å­˜å‚¨åˆ°å˜é‡ä¸­ã€‚Python çš„å†…å­˜ç®¡ç†å™¨ä¼šè‡ªåŠ¨è·Ÿè¸ªå’Œå›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡ã€‚</p>
</blockquote>
<h3 id="ä¸€è¡Œå®šä¹‰å¤šä¸ªå˜é‡">ä¸€è¡Œå®šä¹‰å¤šä¸ªå˜é‡</h3>
<p>åœ¨ Python ä¸­å¯ä»¥ä¸€è¡Œå®šä¹‰å¤šä¸ªå˜é‡ã€‚å¯ä»¥ä½¿ç”¨é€—å·å°†å¤šä¸ªå˜é‡ååˆ†å¼€ï¼Œå¹¶ä½¿ç”¨ç­‰å·å°†å®ƒä»¬ä¸ç›¸åº”çš„å€¼åˆ†å¼€ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># åœ¨ Python ä¸­å¯ä»¥ä¸€è¡Œå®šä¹‰å¤šä¸ªå˜é‡ã€‚å¯ä»¥ä½¿ç”¨é€—å·å°†å¤šä¸ªå˜é‡ååˆ†å¼€ï¼Œå¹¶ä½¿ç”¨ç­‰å·å°†å®ƒä»¬ä¸ç›¸åº”çš„å€¼åˆ†å¼€ã€‚</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&#34;John&#34;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¾“å‡ºå˜é‡å€¼</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># è¾“å‡º 5</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>  <span class="c1"># è¾“å‡º John</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>  <span class="c1"># è¾“å‡º [1, 2, 3]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ä¸€è¡Œå®šä¹‰å¤šä¸ªå˜é‡ï¼Œä½¿ç”¨ç›¸åŒçš„å€¼</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span> <span class="o">=</span> <span class="n">b</span> <span class="o">=</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¾“å‡ºå˜é‡å€¼</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>  <span class="c1"># è¾“å‡º 0</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>  <span class="c1"># è¾“å‡º 0</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>  <span class="c1"># è¾“å‡º 0</span>
</span></span></code></pre></div><h3 id="å˜é‡çš„ä½œç”¨åŸŸ">å˜é‡çš„ä½œç”¨åŸŸ</h3>
<p>åœ¨ Python ä¸­ï¼Œå˜é‡çš„ä½œç”¨åŸŸæ˜¯æŒ‡å˜é‡åœ¨ç¨‹åºä¸­å¯è§å’Œå¯è®¿é—®çš„èŒƒå›´ã€‚Python ä¸­æœ‰å››ç§ä½œç”¨åŸŸï¼š</p>
<ul>
<li>å±€éƒ¨ä½œç”¨åŸŸï¼šå˜é‡åœ¨å‡½æ•°å†…éƒ¨å®šä¹‰ï¼Œåªèƒ½åœ¨å‡½æ•°å†…éƒ¨è®¿é—®ã€‚</li>
<li>åµŒå¥—ä½œç”¨åŸŸï¼šå˜é‡åœ¨åµŒå¥—å‡½æ•°å†…éƒ¨å®šä¹‰ï¼Œå¯ä»¥åœ¨åµŒå¥—å‡½æ•°å†…éƒ¨å’Œå¤–éƒ¨å‡½æ•°å†…éƒ¨è®¿é—®ã€‚</li>
<li>å…¨å±€ä½œç”¨åŸŸï¼šå˜é‡åœ¨æ¨¡å—å†…éƒ¨å®šä¹‰ï¼Œå¯ä»¥åœ¨æ¨¡å—å†…çš„ä»»ä½•å‡½æ•°æˆ–ç±»ä¸­è®¿é—®ã€‚</li>
<li>å†…ç½®ä½œç”¨åŸŸï¼šå˜é‡æ˜¯ Python å†…ç½®çš„å‡½æ•°å’Œå¯¹è±¡ï¼Œå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è®¿é—®ã€‚</li>
</ul>
<p>å¦‚æœåœ¨å‡½æ•°å†…éƒ¨è®¿é—®å…¨å±€å˜é‡ï¼Œä½ éœ€è¦ä½¿ç”¨ <code>global</code> å…³é”®å­—æ¥æŒ‡ç¤ºå˜é‡çš„ä½œç”¨åŸŸã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># å…¨å±€å˜é‡</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">my_func</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">global</span> <span class="n">x</span>  <span class="c1"># ä½¿ç”¨ global å…³é”®å­—æŒ‡ç¤ºå˜é‡çš„ä½œç”¨åŸŸ</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="o">=</span> <span class="mi">20</span>   <span class="c1"># å°†å…¨å±€å˜é‡ x çš„å€¼ä¿®æ”¹ä¸º 20</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">my_func</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># è¾“å‡º 20</span>
</span></span></code></pre></div><h3 id="å˜é‡è§£åŒ…">å˜é‡è§£åŒ…</h3>
<p>åœ¨ Python ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å˜é‡è§£åŒ…ï¼ˆunpackingï¼‰è¯­æ³•å°†ä¸€ä¸ªåºåˆ—æˆ–å…ƒç»„ä¸­çš„å€¼åˆ†é…ç»™å¤šä¸ªå˜é‡ã€‚å˜é‡è§£åŒ…è¯­æ³•ä½¿ç”¨ç­‰å·(<code>=</code>)å°†å˜é‡åä¸åºåˆ—æˆ–å…ƒç»„ä¸­çš„å€¼åˆ†å¼€ï¼Œå¹¶ä½¿ç”¨é€—å·å°†å˜é‡ååˆ†å¼€ã€‚</p>
<p>å¯¹å…ƒç»„è§£åŒ…</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># å®šä¹‰ä¸€ä¸ªå…ƒç»„</span>
</span></span><span class="line"><span class="cl"><span class="n">my_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># æ³¨æ„ï¼šå·¦ä¾§å˜é‡çš„ä¸ªæ•°å¿…é¡»å’Œå¾…å±•å¼€çš„åˆ—è¡¨é•¿åº¦ç›¸ç­‰ï¼Œå¦åˆ™ä¼šæŠ¥é”™</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å˜é‡è§£åŒ…ï¼Œå°†å…ƒç»„ä¸­çš„å€¼åˆ†é…ç»™å¤šä¸ªå˜é‡</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">my_tuple</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¾“å‡ºå˜é‡å€¼</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># è¾“å‡º 1</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>  <span class="c1"># è¾“å‡º 2</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>  <span class="c1"># è¾“å‡º 3</span>
</span></span></code></pre></div><p>å¯ä»¥å°†å˜é‡è§£åŒ…è¯­æ³•ä¸å…¶ä»– Python çš„è¯­è¨€ç‰¹æ€§ç»“åˆä½¿ç”¨ï¼Œä¾‹å¦‚å‡½æ•°è¿”å›å€¼å’Œåˆ—è¡¨æ¨å¯¼å¼ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›ä¸¤ä¸ªå€¼</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_name_and_age</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34;John&#34;</span><span class="p">,</span> <span class="mi">30</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å˜é‡è§£åŒ…ï¼Œå°†å‡½æ•°è¿”å›çš„å€¼åˆ†é…ç»™å¤šä¸ªå˜é‡</span>
</span></span><span class="line"><span class="cl"><span class="n">name</span><span class="p">,</span> <span class="n">age</span> <span class="o">=</span> <span class="n">get_name_and_age</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¾“å‡ºå˜é‡å€¼</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>  <span class="c1"># è¾“å‡º John</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">age</span><span class="p">)</span>   <span class="c1"># è¾“å‡º 30</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ä½¿ç”¨åˆ—è¡¨æ¨å¯¼å¼åˆ›å»ºä¸€ä¸ªåˆ—è¡¨ï¼Œç„¶åè¿›è¡Œå˜é‡è§£åŒ…</span>
</span></span><span class="line"><span class="cl"><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">my_list</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¾“å‡ºå˜é‡å€¼</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>  <span class="c1"># è¾“å‡º 2</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>  <span class="c1"># è¾“å‡º 4</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>  <span class="c1"># è¾“å‡º 6</span>
</span></span></code></pre></div><p>å˜é‡è§£åŒ…è¯­æ³•å¯ä»¥ç”¨äºåµŒå¥—çš„åºåˆ—æˆ–å…ƒç»„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># å®šä¹‰ä¸€ä¸ªåµŒå¥—å…ƒç»„</span>
</span></span><span class="line"><span class="cl"><span class="n">my_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å˜é‡è§£åŒ…ï¼Œå°†å…ƒç»„ä¸­çš„å€¼åˆ†é…ç»™å¤šä¸ªå˜é‡</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="n">my_tuple</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¾“å‡ºå˜é‡å€¼</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># è¾“å‡º 1</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>  <span class="c1"># è¾“å‡º 2</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>  <span class="c1"># è¾“å‡º 3</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>  <span class="c1"># è¾“å‡º 4</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å®šä¹‰ä¸€ä¸ªåµŒå¥—åˆ—è¡¨</span>
</span></span><span class="line"><span class="cl"><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å˜é‡è§£åŒ…ï¼Œå°†åˆ—è¡¨ä¸­çš„å€¼åˆ†é…ç»™å¤šä¸ªå˜é‡</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="p">[</span><span class="n">z</span><span class="p">,</span> <span class="n">w</span><span class="p">]</span> <span class="o">=</span> <span class="n">my_list</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¾“å‡ºå˜é‡å€¼</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># è¾“å‡º 1</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>  <span class="c1"># è¾“å‡º 2</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>  <span class="c1"># è¾“å‡º 3</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>  <span class="c1"># è¾“å‡º 4</span>
</span></span></code></pre></div><p>ä½¿ç”¨å˜é‡è§£åŒ…è¯­æ³•è¿›è¡ŒåŠ¨æ€è§£åŒ…ã€‚åŠ¨æ€è§£åŒ…æ˜¯æŒ‡åœ¨è¿è¡Œæ—¶ç¡®å®šè¦è§£åŒ…çš„åºåˆ—æˆ–å…ƒç»„ï¼Œå¹¶å°†å…¶åˆ†é…ç»™å¤šä¸ªå˜é‡ã€‚</p>
<p>è¿™é€šå¸¸æ¶‰åŠåˆ°ä½¿ç”¨å‡½æ•°æˆ–æ–¹æ³•è¿”å›çš„åºåˆ—æˆ–å…ƒç»„ï¼Œä»¥åŠä¸ç¡®å®šåºåˆ—æˆ–å…ƒç»„çš„é•¿åº¦çš„æƒ…å†µã€‚</p>
<p>ä½¿ç”¨ä¸€ä¸ªæ˜Ÿå·(<code>*</code>)ä½œä¸ºå˜é‡åç§°çš„å‰ç¼€å¯ä»¥æŒ‡å®šä¸€ä¸ªå˜é‡æ¥æ¥æ”¶é™¤äº†å·²åˆ†é…å˜é‡ä¹‹å¤–çš„æ‰€æœ‰å€¼ã€‚è¿™ä¸ªå˜é‡å°†æ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># å®šä¹‰ä¸€ä¸ªå…ƒç»„</span>
</span></span><span class="line"><span class="cl"><span class="n">my_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ä½¿ç”¨åŠ¨æ€è§£åŒ…ï¼Œå°†å…ƒç»„å‰ä¸¤ä¸ªå€¼åˆ†é…ç»™å˜é‡ x å’Œ yï¼Œåä¸¤ä¸ªå€¼åˆ†é…ç»™å˜é‡ a å’Œ bï¼Œå…¶ä»–å€¼åˆ†é…ç»™å˜é‡ rest</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="n">rest</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">my_tuple</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¾“å‡ºå˜é‡å€¼</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>     <span class="c1"># è¾“å‡º 1</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>     <span class="c1"># è¾“å‡º 2</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">rest</span><span class="p">)</span>  <span class="c1"># è¾“å‡º [3, 4]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>     <span class="c1"># è¾“å‡º 5</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>     <span class="c1"># è¾“å‡º 6</span>
</span></span></code></pre></div><h3 id="å•ä¸‹åˆ’çº¿å˜é‡å">å•ä¸‹åˆ’çº¿å˜é‡å</h3>
<p>åœ¨ Python ä¸­ï¼Œä»¥å•ä¸ªä¸‹åˆ’çº¿(<code>_</code>)å¼€å¤´çš„å˜é‡åé€šå¸¸è¡¨ç¤ºä¸€ä¸ªç§æœ‰å˜é‡æˆ–å ä½ç¬¦å˜é‡ã€‚</p>
<ol>
<li>
<p>ç§æœ‰å˜é‡ï¼šåœ¨ Python ä¸­ï¼Œæ²¡æœ‰çœŸæ­£çš„ç§æœ‰å˜é‡ï¼Œä½†æ˜¯ä»¥å•ä¸ªä¸‹åˆ’çº¿å¼€å¤´çš„å˜é‡åé€šå¸¸è¢«è§†ä¸ºç§æœ‰å˜é‡ã€‚è¿™æ„å‘³ç€è¿™äº›å˜é‡ä¸åº”è¯¥åœ¨æ¨¡å—æˆ–ç±»çš„å¤–éƒ¨ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–æˆ–ä¸å†å­˜åœ¨ã€‚ä½†æ˜¯ï¼Œå®ƒä»¬ä»ç„¶å¯ä»¥åœ¨æ¨¡å—æˆ–ç±»çš„å†…éƒ¨ä½¿ç”¨ã€‚</p>
</li>
<li>
<p>å ä½ç¬¦å˜é‡ï¼šæœ‰æ—¶å€™ï¼Œåœ¨ç¼–å†™ä»£ç æ—¶ï¼Œéœ€è¦ä½¿ç”¨ä¸€ä¸ªå˜é‡æ¥å æ®ä¸€ä¸ªä½ç½®ï¼Œä½†æ˜¯ä¸éœ€è¦å¼•ç”¨å˜é‡çš„å€¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ä»¥å•ä¸ªä¸‹åˆ’çº¿å¼€å¤´çš„å˜é‡åæ¥è¡¨ç¤ºä¸€ä¸ªå ä½ç¬¦å˜é‡ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># å¿½ç•¥å±•å¼€æ—¶çš„ç¬¬äºŒä¸ªå˜é‡</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span>  <span class="c1"># è¾“å‡º 1 2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ä½¿ç”¨å ä½ç¬¦å˜é‡</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">_</span><span class="p">)</span>
</span></span></code></pre></div></li>
</ol>
<h3 id="å¯å˜å’Œä¸å¯å˜å¯¹è±¡">å¯å˜å’Œä¸å¯å˜å¯¹è±¡</h3>
<p>åœ¨ Python ä¸­ï¼Œæœ‰äº›å¯¹è±¡æ˜¯å¯å˜çš„ï¼Œæœ‰äº›å¯¹è±¡æ˜¯ä¸å¯å˜çš„ã€‚å¯å˜å¯¹è±¡æ˜¯å¯ä»¥ä¿®æ”¹çš„ï¼Œè€Œä¸å¯å˜å¯¹è±¡æ˜¯ä¸èƒ½ä¿®æ”¹çš„ã€‚ä¾‹å¦‚ï¼Œæ•°å­—ã€å­—ç¬¦ä¸²å’Œå…ƒç»„æ˜¯ä¸å¯å˜çš„ï¼Œè€Œåˆ—è¡¨å’Œå­—å…¸æ˜¯å¯å˜çš„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># å¯å˜å¯¹è±¡ç¤ºä¾‹</span>
</span></span><span class="line"><span class="cl"><span class="n">my_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">my_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_list</span><span class="p">)</span>  <span class="c1"># è¾“å‡º [1, 2, 3, 4]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ä¸å¯å˜å¯¹è±¡ç¤ºä¾‹</span>
</span></span><span class="line"><span class="cl"><span class="n">my_string</span> <span class="o">=</span> <span class="s2">&#34;Hello&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">my_string</span> <span class="o">+=</span> <span class="s2">&#34;, world!&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">my_string</span><span class="p">)</span>  <span class="c1"># è¾“å‡º Hello, world!</span>
</span></span></code></pre></div><h2 id="å¸¸é‡">å¸¸é‡</h2>
<p>åœ¨ Python ä¸­ï¼Œå¸¸é‡æ˜¯æŒ‡åœ¨ç¨‹åºä¸­å®šä¹‰çš„ä¸å¯å˜çš„å€¼ã€‚å¸¸é‡é€šå¸¸ç”¨å¤§å†™å­—æ¯è¡¨ç¤ºï¼Œä»¥ä¾¿ä¸å˜é‡åŒºåˆ†å¼€æ¥ã€‚Python ä¸­æ²¡æœ‰å†…ç½®çš„å¸¸é‡ç±»å‹ï¼Œä½†æ˜¯ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼å®šä¹‰å¸¸é‡ï¼š</p>
<ol>
<li>ä½¿ç”¨æ™®é€šå˜é‡è¡¨ç¤ºå¸¸é‡ã€‚ä¾‹å¦‚ï¼š</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">PI</span> <span class="o">=</span> <span class="mf">3.14159265358979323846</span>
</span></span></code></pre></div><p>åœ¨ç¨‹åºä¸­ä½¿ç”¨ <code>PI</code> æ¥è¡¨ç¤ºåœ†å‘¨ç‡ï¼Œè¿™ä¸ªå€¼ä¸ä¼šè¢«ä¿®æ”¹ã€‚</p>
<ol start="2">
<li>ä½¿ç”¨æšä¸¾ç±»ï¼ˆEnumï¼‰è¡¨ç¤ºå¸¸é‡ã€‚æšä¸¾ç±»æ˜¯ Python ä¸­çš„ä¸€ç§ç‰¹æ®Šç±»å‹ï¼Œç”¨äºå®šä¹‰ä¸€ç»„æœ‰é™çš„å¸¸é‡ã€‚ä¾‹å¦‚ï¼š</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Color</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">RED</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="n">GREEN</span> <span class="o">=</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">    <span class="n">BLUE</span> <span class="o">=</span> <span class="mi">3</span>
</span></span></code></pre></div><p>åœ¨ç¨‹åºä¸­ä½¿ç”¨ <code>Color.RED</code>ã€<code>Color.GREEN</code> å’Œ <code>Color.BLUE</code> æ¥è¡¨ç¤ºä¸‰ç§é¢œè‰²ï¼Œè¿™äº›å€¼ä¸ä¼šè¢«ä¿®æ”¹ã€‚</p>
<p>å¸¸é‡æ˜¯ç¼–å†™å¯è¯»æ€§å¥½ã€æ˜“äºç†è§£å’Œç»´æŠ¤çš„ä»£ç çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚åœ¨ç¼–å†™ä»£ç æ—¶ï¼Œåº”è¯¥å°†å¸¸é‡å®šä¹‰ä¸ºä¸å¯å˜çš„å€¼ï¼Œå¹¶å°½å¯èƒ½ä½¿ç”¨å¸¸é‡æ¥è¡¨ç¤ºä¸å˜çš„æ•°æ®ã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>ã€ŠEffective Java 3ã€‹ç¬”è®°11ï¼šå½“è¦†ç›– equals æ–¹æ³•æ—¶ï¼Œæ€»è¦è¦†ç›– hashCode æ–¹æ³•</title>
      <link>https://blog.chensoul.com/posts/2023/05/23/always-override-hashcode-when-you-override-equals/</link>
      <pubDate>Tue, 23 May 2023 10:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/05/23/always-override-hashcode-when-you-override-equals/</guid>
      <description>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬ä¸‰ç« ã€Šå¯¹è±¡çš„é€šç”¨æ–¹æ³•ã€‹çš„å­¦ä¹ ç¬”è®°ï¼šå½“è¦†ç›– equals æ–¹æ³•æ—¶ï¼Œæ€»è¦è¦†ç›– hashCode æ–¹æ³•ã€‚ ä»‹ç» åœ¨è¦†ç›–äº† equals æ–¹æ³•çš„ç±»ä¸­ï¼Œå¿…é¡»è¦†ç›– hashCode æ–¹æ³•</description>
      <content:encoded><![CDATA[<p>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬ä¸‰ç« ã€Šå¯¹è±¡çš„é€šç”¨æ–¹æ³•ã€‹çš„å­¦ä¹ ç¬”è®°ï¼šå½“è¦†ç›– equals æ–¹æ³•æ—¶ï¼Œæ€»è¦è¦†ç›– hashCode æ–¹æ³•ã€‚</p>
<h2 id="ä»‹ç»">ä»‹ç»</h2>
<p><strong>åœ¨è¦†ç›–äº† equals æ–¹æ³•çš„ç±»ä¸­ï¼Œå¿…é¡»è¦†ç›– hashCode æ–¹æ³•ã€‚</strong> å¦‚æœä½ æ²¡æœ‰è¿™æ ·åšï¼Œè¯¥ç±»å°†è¿å hashCode æ–¹æ³•çš„ä¸€èˆ¬çº¦å®šï¼Œè¿™å°†é˜»æ­¢è¯¥ç±»åœ¨ HashMap å’Œ HashSet ç­‰é›†åˆä¸­æ­£å¸¸è¿è¡Œã€‚ä»¥ä¸‹æ˜¯æ ¹æ® Object è§„èŒƒä¿®æ”¹çš„çº¦å®šï¼š</p>
<ul>
<li>åº”ç”¨ç¨‹åºæ‰§è¡ŒæœŸé—´å¯¹å¯¹è±¡é‡å¤è°ƒç”¨ hashCode æ–¹æ³•æ—¶ï¼Œå®ƒå¿…é¡»ä¸€è‡´åœ°è¿”å›ç›¸åŒçš„å€¼ï¼Œå‰ææ˜¯ä¸å¯¹ equals æ–¹æ³•ä¸­ç”¨äºæ¯”è¾ƒçš„ä¿¡æ¯è¿›è¡Œä¿®æ”¹ã€‚è¿™ä¸ªå€¼ä¸éœ€è¦åœ¨åº”ç”¨ç¨‹åºçš„ä¸åŒæ‰§è¡Œä¹‹é—´ä¿æŒä¸€è‡´ã€‚</li>
<li>å¦‚æœæ ¹æ® <code>equals(Object)</code> æ–¹æ³•åˆ¤æ–­å‡ºä¸¤ä¸ªå¯¹è±¡æ˜¯ç›¸ç­‰çš„ï¼Œé‚£ä¹ˆåœ¨ä¸¤ä¸ªå¯¹è±¡ä¸Šè°ƒç”¨ hashCode æ–¹æ³•å¿…é¡»äº§ç”Ÿç›¸åŒçš„æ•´æ•°ç»“æœã€‚</li>
</ul>
<p>å¦‚æœæ ¹æ® <code>equals(Object)</code> æ–¹æ³•åˆ¤æ–­å‡ºä¸¤ä¸ªå¯¹è±¡ä¸ç›¸ç­‰ï¼Œåˆ™ä¸éœ€è¦åœ¨æ¯ä¸ªå¯¹è±¡ä¸Šè°ƒç”¨ hashCode æ–¹æ³•æ—¶å¿…é¡»äº§ç”Ÿä¸åŒçš„ç»“æœã€‚ä½†æ˜¯ï¼Œç¨‹åºå‘˜åº”è¯¥çŸ¥é“ï¼Œä¸ºä¸ç›¸ç­‰çš„å¯¹è±¡ç”Ÿæˆä¸åŒçš„ç»“æœå¯èƒ½ä¼šæé«˜æ•£åˆ—è¡¨çš„æ€§èƒ½ã€‚</p>
<p><strong>å½“ä½ æ— æ³•è¦†ç›– hashCode æ–¹æ³•æ—¶ï¼Œå°†è¿åç¬¬äºŒä¸ªå…³é”®æ¡æ¬¾ï¼šç›¸ç­‰çš„å¯¹è±¡å¿…é¡»å…·æœ‰ç›¸ç­‰çš„æ•£åˆ—ç ã€‚</strong> æ ¹æ®ç±»çš„ equals æ–¹æ³•ï¼Œä¸¤ä¸ªä¸åŒçš„å®ä¾‹åœ¨é€»è¾‘ä¸Šå¯èƒ½æ˜¯ç›¸ç­‰çš„ï¼Œä½†æ˜¯å¯¹äºå¯¹è±¡çš„ hashCode æ–¹æ³•æ¥è¯´ï¼Œå®ƒä»¬åªæ˜¯ä¸¤ä¸ªæ²¡æœ‰å…±åŒä¹‹å¤„çš„å¯¹è±¡ã€‚å› æ­¤ï¼ŒObject çš„ hashCode æ–¹æ³•è¿”å›ä¸¤ä¸ªçœ‹ä¼¼éšæœºçš„æ•°å­—ï¼Œè€Œä¸æ˜¯çº¦å®šè¦æ±‚çš„ä¸¤ä¸ªç›¸ç­‰çš„æ•°å­—ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Map</span><span class="o">&lt;</span><span class="n">PhoneNumber</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl"><span class="n">m</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="k">new</span> <span class="n">PhoneNumber</span><span class="o">(</span><span class="n">707</span><span class="o">,</span> <span class="n">867</span><span class="o">,</span> <span class="n">5309</span><span class="o">),</span> <span class="s">&#34;Jenny&#34;</span><span class="o">);</span>
</span></span></code></pre></div><p>æ­¤æ—¶ï¼Œä½ å¯èƒ½æœŸæœ› <code>m.get(new PhoneNumber(707, 867,5309))</code> è¿”å›ã€ŒJennyã€ï¼Œä½†æ˜¯å®ƒè¿”å› nullã€‚æ³¨æ„ï¼Œè¿™é‡Œæ¶‰åŠåˆ°ä¸¤ä¸ª PhoneNumber å®ä¾‹ï¼šä¸€ä¸ªç”¨äºæ’å…¥åˆ° HashMap ä¸­ï¼Œå¦ä¸€ä¸ªç›¸ç­‰çš„å®ä¾‹ï¼ˆè¢«è¯•å›¾ï¼‰ç”¨äºæ£€ç´¢ã€‚ç”±äº PhoneNumber ç±»æœªèƒ½è¦†ç›– hashCode æ–¹æ³•ï¼Œå¯¼è‡´ä¸¤ä¸ªç›¸ç­‰çš„å®ä¾‹å…·æœ‰ä¸ç›¸ç­‰çš„æ•£åˆ—ç ï¼Œè¿™è¿åäº† hashCode æ–¹æ³•çº¦å®šã€‚å› æ­¤ï¼Œget æ–¹æ³•æŸ¥æ‰¾ç”µè¯å·ç çš„æ•£åˆ—æ¡¶å¯èƒ½ä¼šä¸ put æ–¹æ³•å­˜å‚¨ç”µè¯å·ç çš„æ•£åˆ—æ¡¶ä¸åŒã€‚å³ä½¿è¿™ä¸¤ä¸ªå®ä¾‹ç¢°å·§åˆ†é…åœ¨åŒä¸€ä¸ªæ•£åˆ—æ¡¶ä¸Šï¼Œget æ–¹æ³•å‡ ä¹è‚¯å®šä¼šè¿”å› nullï¼Œå› ä¸º HashMap æœ‰ä¸€ä¸ªä¼˜åŒ–ï¼Œå®ƒç¼“å­˜æ¯ä¸ªæ¡ç›®ç›¸å…³è”çš„æ•£åˆ—ç ï¼Œå¦‚æœæ•£åˆ—ç ä¸åŒ¹é…ï¼Œå°±ä¸ä¼šæ£€æŸ¥å¯¹è±¡æ˜¯å¦ç›¸ç­‰ã€‚</p>
<p>è§£å†³è¿™ä¸ªé—®é¢˜å°±åƒä¸º PhoneNumber ç¼–å†™ä¸€ä¸ªæ­£ç¡®çš„ hashCode æ–¹æ³•ä¸€æ ·ç®€å•ã€‚é‚£ä¹ˆ hashCode æ–¹æ³•åº”è¯¥æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿå†™ä¸€ä¸ªåé¢ä¾‹å­å¾ˆå®¹æ˜“ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹æ–¹æ³•æ˜¯åˆæ³•çš„ï¼Œä½†æ˜¯ä¸åº”è¯¥è¢«ä½¿ç”¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// The worst possible legal hashCode implementation - never use!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">42</span><span class="o">;</span> <span class="o">}</span>
</span></span></code></pre></div><p>å®ƒæ˜¯åˆæ³•çš„ï¼Œå› ä¸ºå®ƒç¡®ä¿äº†ç›¸ç­‰çš„å¯¹è±¡å…·æœ‰ç›¸åŒçš„æ•£åˆ—ç ã€‚åŒæ—¶å®ƒä¹Ÿå¾ˆç³Ÿç³•ï¼Œå› ä¸ºå®ƒä½¿æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ç›¸åŒçš„æ•£åˆ—ç ã€‚å› æ­¤ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½åˆ†é…åˆ°åŒä¸€ä¸ªæ¡¶ä¸­ï¼Œæ•£åˆ—è¡¨é€€åŒ–ä¸ºé“¾è¡¨ã€‚è¿™æ ·ï¼ŒåŸæœ¬åº”è¯¥åœ¨çº¿æ€§é˜¶ <code>O(n)</code> è¿è¡Œçš„ç¨‹åºå°†åœ¨å¹³æ–¹é˜¶ <code>O(n^2)</code> è¿è¡Œã€‚å¯¹äºå¤§å‹æ•£åˆ—è¡¨ï¼Œè¿™æ˜¯å·¥ä½œå’Œä¸å·¥ä½œçš„åŒºåˆ«ã€‚</p>
<p>ä¸€ä¸ªå¥½çš„æ•£åˆ—ç®—æ³•å€¾å‘äºä¸ºä¸ç›¸ç­‰çš„å®ä¾‹ç”Ÿæˆä¸ç›¸ç­‰çš„æ•£åˆ—ç ã€‚è¿™æ­£æ˜¯ hashCode æ–¹æ³•çº¦å®šç¬¬ä¸‰éƒ¨åˆ†çš„å«ä¹‰ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæ•£åˆ—ç®—æ³•åº”è¯¥åœ¨æ‰€æœ‰ int å€¼ä¸Šå‡åŒ€åˆç†åˆ†å¸ƒæ‰€æœ‰ä¸ç›¸ç­‰å®ä¾‹é›†åˆã€‚å®ç°è¿™ä¸ªç†æƒ³æ˜¯å¾ˆå›°éš¾çš„ã€‚å¹¸è¿çš„æ˜¯ï¼Œå®ç°ä¸€ä¸ªç±»ä¼¼çš„å¹¶ä¸å¤ªéš¾ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªç®€å•çš„æ–¹å¼ï¼š</p>
<ul>
<li>
<p>1ã€å£°æ˜ä¸€ä¸ªåä¸º result çš„ int å˜é‡ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºå¯¹è±¡ä¸­ç¬¬ä¸€ä¸ªé‡è¦å­—æ®µçš„æ•£åˆ—ç  cï¼Œå¦‚æ­¥éª¤ 2.a ä¸­è®¡ç®—çš„é‚£æ ·ã€‚ï¼ˆå›æƒ³ä¸€ä¸‹ <a href="https://github.com/clxering/Effective-Java-3rd-edition-Chinese-English-bilingual/blob/dev/Chapter-3/Chapter-3-Item-10-Obey-the-general-contract-when-overriding-equals.md">Item-10</a> ä¸­çš„é‡è¦å­—æ®µä¼šå¯¹æ¯”è¾ƒäº§ç”Ÿå½±å“ï¼‰</p>
</li>
<li>
<p>2ã€å¯¹è±¡ä¸­å‰©ä½™çš„é‡è¦å­—æ®µ fï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ul>
<li>
<p>ä¸ºå­—æ®µè®¡ç®—ä¸€ä¸ªæ•´æ•°æ•£åˆ—ç  cï¼š</p>
<ul>
<li>å¦‚æœå­—æ®µæ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œè®¡ç®— <code>Type.hashCode(f)</code>ï¼Œå…¶ä¸­ type æ˜¯ä¸ f ç±»å‹å¯¹åº”çš„åŒ…è£…ç±»ã€‚</li>
<li>å¦‚æœå­—æ®µæ˜¯å¯¹è±¡å¼•ç”¨ï¼Œå¹¶ä¸”è¯¥ç±»çš„ equals æ–¹æ³•é€šè¿‡é€’å½’è°ƒç”¨ equals æ–¹æ³•æ¥æ¯”è¾ƒå­—æ®µï¼Œåˆ™é€’å½’è°ƒç”¨å­—æ®µä¸Šçš„ hashCode æ–¹æ³•ã€‚å¦‚æœéœ€è¦æ›´å¤æ‚çš„æ¯”è¾ƒï¼Œåˆ™ä¸ºè¯¥å­—æ®µè®¡ç®—ä¸€ä¸ªã€Œcanonical representationã€ï¼Œå¹¶åœ¨ canonical representation ä¸Šè°ƒç”¨ hashCode æ–¹æ³•ã€‚å¦‚æœå­—æ®µçš„å€¼ä¸ºç©ºï¼Œåˆ™ä½¿ç”¨ 0ï¼ˆæˆ–å…¶ä»–å¸¸æ•°ï¼Œä½† 0 æ˜¯æƒ¯ç”¨çš„ï¼‰ã€‚</li>
<li>å¦‚æœå­—æ®µæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œåˆ™å°†å…¶æ¯ä¸ªé‡è¦å…ƒç´ éƒ½è§†ä¸ºä¸€ä¸ªå•ç‹¬çš„å­—æ®µã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡é€’å½’åœ°åº”ç”¨è¿™äº›è§„åˆ™è®¡ç®—æ¯ä¸ªé‡è¦å…ƒç´ çš„æ•£åˆ—ç ï¼Œå¹¶å°†æ¯ä¸ªæ­¥éª¤ 2.b çš„å€¼ç»„åˆèµ·æ¥ã€‚å¦‚æœæ•°ç»„ä¸­æ²¡æœ‰é‡è¦å…ƒç´ ï¼Œåˆ™ä½¿ç”¨å¸¸é‡ï¼Œæœ€å¥½ä¸æ˜¯ 0ã€‚å¦‚æœæ‰€æœ‰å…ƒç´ éƒ½å¾ˆé‡è¦ï¼Œé‚£ä¹ˆä½¿ç”¨ <code>Arrays.hashCode</code>ã€‚</li>
</ul>
</li>
<li>
<p>å°†æ­¥éª¤ 2.a ä¸­è®¡ç®—çš„æ•£åˆ—ç  c åˆå¹¶åˆ° result å˜é‡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="n">31</span> <span class="o">*</span> <span class="n">result</span> <span class="o">+</span> <span class="n">c</span><span class="o">;</span>
</span></span></code></pre></div></li>
</ul>
</li>
<li>
<p>3ã€è¿”å› result å˜é‡ã€‚</p>
</li>
</ul>
<p>å½“ä½ å®Œæˆäº† hashCode æ–¹æ³•çš„ç¼–å†™ä¹‹åï¼Œé—®é—®è‡ªå·±ç°åœ¨ç›¸åŒçš„å®ä¾‹æ˜¯å¦å…·æœ‰ç›¸åŒçš„æ•£åˆ—ç ã€‚ç¼–å†™å•å…ƒæµ‹è¯•æ¥éªŒè¯ä½ çš„ç›´è§‰ï¼ˆé™¤éä½ ä½¿ç”¨ AutoValue ç”Ÿæˆä½ çš„ equals æ–¹æ³•å’Œ hashCode æ–¹æ³•ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä½ å¯ä»¥å®‰å…¨åœ°çœç•¥è¿™äº›æµ‹è¯•ï¼‰ã€‚å¦‚æœç›¸åŒçš„å®ä¾‹æœ‰ä¸ç›¸ç­‰çš„æ•£åˆ—ç ï¼Œæ‰¾å‡ºåŸå› å¹¶ä¿®å¤é—®é¢˜ã€‚</p>
<p>å¯ä»¥ä»æ•£åˆ—ç è®¡ç®—ä¸­æ’é™¤æ´¾ç”Ÿå­—æ®µã€‚æ¢å¥è¯è¯´ï¼Œä½ å¯ä»¥å¿½ç•¥ä»»ä½•å¯ä»¥ä»åŒ…å«çš„å­—æ®µè®¡ç®—å…¶å€¼çš„å­—æ®µã€‚ä½ å¿…é¡»æ’é™¤ä¸ç”¨ <code>equals</code> æ¯”è¾ƒçš„ä»»ä½•å­—æ®µï¼Œå¦åˆ™ä½ å¯èƒ½ä¼šè¿å hashCode æ–¹æ³•çº¦å®šçš„ç¬¬äºŒä¸ªæ¡æ¬¾ã€‚</p>
<p>åœ¨æ­¥éª¤ 2.b ä¸­ä½¿ç”¨çš„ä¹˜æ³•å°†ä½¿ç»“æœå–å†³äºå­—æ®µçš„é¡ºåºï¼Œå¦‚æœç±»æœ‰å¤šä¸ªç›¸ä¼¼çš„å­—æ®µï¼Œåˆ™ä¼šäº§ç”Ÿä¸€ä¸ªæ›´å¥½çš„æ•£åˆ—ç®—æ³•ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå­—ç¬¦ä¸²æ•£åˆ—ç®—æ³•ä¸­çœç•¥äº†ä¹˜æ³•ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„å­—æ¯é¡ºåºéƒ½æœ‰ç›¸åŒçš„æ•£åˆ—ç ã€‚é€‰æ‹© 31 æ˜¯å› ä¸ºå®ƒæ˜¯å¥‡ç´ æ•°ã€‚å¦‚æœæ˜¯å¶æ•°ï¼Œä¹˜æ³•è¿ç®—å°±ä¼šæº¢å‡ºï¼Œä¿¡æ¯å°±ä¼šä¸¢å¤±ï¼Œå› ä¸ºä¹˜æ³•è¿ç®—ç­‰åŒäºç§»ä½ã€‚ä½¿ç”¨ç´ æ•°çš„å¥½å¤„ä¸å¤ªæ˜æ˜¾ï¼Œä½†å®ƒæ˜¯ä¼ ç»Ÿç”¨æ³•ã€‚31 æœ‰ä¸€ä¸ªå¾ˆå¥½çš„ç‰¹æ€§ï¼Œå¯ä»¥ç”¨ç§»ä½å’Œå‡æ³•æ¥ä»£æ›¿ä¹˜æ³•ï¼Œä»è€Œåœ¨æŸäº›ä½“ç³»ç»“æ„ä¸Šè·å¾—æ›´å¥½çš„æ€§èƒ½ï¼š<code>31 * i == (i &lt;&lt;5) â€“ i</code>ã€‚ç°ä»£è™šæ‹Ÿæœºè‡ªåŠ¨è¿›è¡Œè¿™ç§ä¼˜åŒ–ã€‚</p>
<p>è®©æˆ‘ä»¬å°†å‰é¢çš„æ–¹æ³•åº”ç”¨åˆ° PhoneNumber ç±»ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Typical hashCode method
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">Short</span><span class="o">.</span><span class="na">hashCode</span><span class="o">(</span><span class="n">areaCode</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="n">31</span> <span class="o">*</span> <span class="n">result</span> <span class="o">+</span> <span class="n">Short</span><span class="o">.</span><span class="na">hashCode</span><span class="o">(</span><span class="n">prefix</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="n">31</span> <span class="o">*</span> <span class="n">result</span> <span class="o">+</span> <span class="n">Short</span><span class="o">.</span><span class="na">hashCode</span><span class="o">(</span><span class="n">lineNum</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>å› ä¸ºè¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªç®€å•çš„ç¡®å®šçš„è®¡ç®—ç»“æœï¼Œå®ƒçš„å”¯ä¸€è¾“å…¥æ˜¯ PhoneNumber å®ä¾‹ä¸­çš„ä¸‰ä¸ªé‡è¦å­—æ®µï¼Œæ‰€ä»¥å¾ˆæ˜æ˜¾ï¼Œç›¸ç­‰çš„ PhoneNumber å®ä¾‹å…·æœ‰ç›¸ç­‰çš„æ•£åˆ—ç ã€‚å®é™…ä¸Šï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ PhoneNumber çš„ä¸€ä¸ªéå¸¸å¥½çš„ hashCode æ–¹æ³•å®ç°ï¼Œä¸ Java åº“ä¸­çš„ hashCode æ–¹æ³•å®ç°ç›¸å½“ã€‚å®ƒå¾ˆç®€å•ï¼Œé€Ÿåº¦ä¹Ÿç›¸å½“å¿«ï¼Œå¹¶ä¸”åˆç†åœ°å°†ä¸ç›¸ç­‰çš„ç”µè¯å·ç åˆ†æ•£åˆ°ä¸åŒçš„æ•£åˆ—æ¡¶ä¸­ã€‚</p>
<p>è™½ç„¶æœ¬æ¡ç›®ä¸­çš„æ–¹æ³•äº§ç”Ÿäº†ç›¸å½“ä¸é”™çš„æ•£åˆ—ç®—æ³•ï¼Œä½†å®ƒä»¬å¹¶ä¸æ˜¯æœ€å…ˆè¿›çš„ã€‚å®ƒä»¬çš„è´¨é‡å¯ä¸ Java åº“çš„å€¼ç±»å‹ä¸­çš„æ•£åˆ—ç®—æ³•ç›¸åª²ç¾ï¼Œå¯¹äºå¤§å¤šæ•°ç”¨é€”æ¥è¯´éƒ½æ˜¯è¶³å¤Ÿçš„ã€‚å¦‚æœä½ ç¡®å®éœ€è¦ä¸å¤ªå¯èƒ½äº§ç”Ÿå†²çªçš„æ•£åˆ—ç®—æ³•ï¼Œè¯·å‚é˜… Guava çš„ com.google.common.hash.Hashing [Guava]ã€‚</p>
<p>Objects ç±»æœ‰ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œå®ƒæ¥å—ä»»æ„æ•°é‡çš„å¯¹è±¡å¹¶è¿”å›å®ƒä»¬çš„æ•£åˆ—ç ã€‚è¿™ä¸ªåä¸º <code>hash</code> çš„æ–¹æ³•å…è®¸ä½ ç¼–å†™åªæœ‰ä¸€è¡Œä»£ç çš„ hashCode æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•çš„è´¨é‡å¯ä»¥ä¸æœ¬æ¡ç›®ä¸­æä¾›çš„ç¼–å†™æ–¹æ³•åª²ç¾ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå®ƒä»¬è¿è¡Œå¾—æ›´æ…¢ï¼Œå› ä¸ºå®ƒä»¬éœ€è¦åˆ›å»ºæ•°ç»„æ¥ä¼ é€’å¯å˜æ•°é‡çš„å‚æ•°ï¼Œå¦‚æœä»»ä½•å‚æ•°æ˜¯åŸå§‹ç±»å‹çš„ï¼Œåˆ™éœ€è¦è¿›è¡Œè£…ç®±å’Œæ‹†ç®±ã€‚æ¨èåªåœ¨æ€§èƒ½ä¸é‡è¦çš„æƒ…å†µä¸‹ä½¿ç”¨è¿™ç§æ•£åˆ—ç®—æ³•ã€‚ä¸‹é¢æ˜¯ä½¿ç”¨è¿™ç§æŠ€æœ¯ç¼–å†™çš„ PhoneNumber çš„æ•£åˆ—ç®—æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// One-line hashCode method - mediocre performance
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">lineNum</span><span class="o">,</span> <span class="n">prefix</span><span class="o">,</span> <span class="n">areaCode</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>å¦‚æœä¸€ä¸ªç±»æ˜¯ä¸å¯å˜çš„ï¼Œå¹¶ä¸”è®¡ç®—æ•£åˆ—ç çš„æˆæœ¬éå¸¸é«˜ï¼Œé‚£ä¹ˆä½ å¯ä»¥è€ƒè™‘åœ¨å¯¹è±¡ä¸­ç¼“å­˜æ•£åˆ—ç ï¼Œè€Œä¸æ˜¯åœ¨æ¯æ¬¡è¯·æ±‚æ—¶é‡æ–°è®¡ç®—å®ƒã€‚å¦‚æœä½ è®¤ä¸ºè¿™ç§ç±»å‹çš„å¤§å¤šæ•°å¯¹è±¡éƒ½å°†ç”¨ä½œæ•£åˆ—é”®ï¼Œé‚£ä¹ˆä½ åº”è¯¥åœ¨åˆ›å»ºå®ä¾‹æ—¶è®¡ç®—æ•£åˆ—ç ã€‚å¦åˆ™ï¼Œä½ å¯ä»¥é€‰æ‹©åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨ hashCode æ–¹æ³•æ—¶å»¶è¿Ÿåˆå§‹åŒ–æ•£åˆ—ç ã€‚åœ¨ä¸€ä¸ªå»¶è¿Ÿåˆå§‹åŒ–çš„å­—æ®µçš„æƒ…å†µä¸‹ï¼Œéœ€è¦æ³¨æ„ä»¥ç¡®ä¿è¯¥ç±»ä»ç„¶æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚æˆ‘ä»¬çš„ PhoneNumber ç±»ä¸å€¼å¾—è¿›è¡Œè¿™ç§å¤„ç†ï¼Œä½†åªæ˜¯ä¸ºäº†å‘ä½ å±•ç¤ºå®ƒæ˜¯å¦‚ä½•å®ç°çš„ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚æ³¨æ„ï¼Œæ•£åˆ—å­—æ®µçš„åˆå§‹å€¼ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º 0ï¼‰ä¸åº”è¯¥æ˜¯é€šå¸¸åˆ›å»ºçš„å®ä¾‹çš„æ•£åˆ—ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// hashCode method with lazily initialized cached hash code
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">private</span> <span class="kt">int</span> <span class="n">hashCode</span><span class="o">;</span> <span class="c1">// Automatically initialized to 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">hashCode</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">result</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="n">Short</span><span class="o">.</span><span class="na">hashCode</span><span class="o">(</span><span class="n">areaCode</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="n">31</span> <span class="o">*</span> <span class="n">result</span> <span class="o">+</span> <span class="n">Short</span><span class="o">.</span><span class="na">hashCode</span><span class="o">(</span><span class="n">prefix</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="n">31</span> <span class="o">*</span> <span class="n">result</span> <span class="o">+</span> <span class="n">Short</span><span class="o">.</span><span class="na">hashCode</span><span class="o">(</span><span class="n">lineNum</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">hashCode</span> <span class="o">=</span> <span class="n">result</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p><strong>ä¸è¦è¯•å›¾ä»æ•£åˆ—ç è®¡ç®—ä¸­æ’é™¤é‡è¦å­—æ®µï¼Œä»¥æé«˜æ€§èƒ½ã€‚</strong> è™½ç„¶å¾—åˆ°çš„æ•£åˆ—ç®—æ³•å¯èƒ½è¿è¡Œå¾—æ›´å¿«ï¼Œä½†å…¶ç³Ÿç³•çš„è´¨é‡å¯èƒ½ä¼šå°†æ•£åˆ—è¡¨çš„æ€§èƒ½é™ä½åˆ°æ— æ³•ä½¿ç”¨çš„ç¨‹åº¦ã€‚ç‰¹åˆ«æ˜¯ï¼Œæ•£åˆ—ç®—æ³•å¯èƒ½ä¼šé‡åˆ°å¤§é‡å®ä¾‹ï¼Œè¿™äº›å®ä¾‹åœ¨ä½ é€‰æ‹©å¿½ç•¥çš„ä¸åŒåŒºåŸŸã€‚å¦‚æœå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œæ•£åˆ—ç®—æ³•å°†æŠŠæ‰€æœ‰è¿™äº›å®ä¾‹æ˜ å°„å¾ˆå°‘ä¸€éƒ¨åˆ†æ•£åˆ—ç ï¼Œä½¿å¾—åŸæœ¬åº”è¯¥åœ¨çº¿æ€§é˜¶ <code>O(n)</code> è¿è¡Œçš„ç¨‹åºå°†åœ¨å¹³æ–¹é˜¶ <code>O(n^2)</code> è¿è¡Œã€‚</p>
<p>è¿™ä¸ä»…ä»…æ˜¯ä¸€ä¸ªç†è®ºé—®é¢˜ã€‚åœ¨ Java 2 ä¹‹å‰ï¼Œå­—ç¬¦ä¸²æ•£åˆ—ç®—æ³•åœ¨å­—ç¬¦ä¸²ä¸­ï¼Œä»¥ç¬¬ä¸€ä¸ªå­—ç¬¦å¼€å§‹ï¼Œæœ€å¤šä½¿ç”¨ 16 ä¸ªå­—ç¬¦ã€‚å¯¹äºå¤§é‡ä¸”åˆ†å±‚æ¬¡çš„é›†åˆï¼ˆå¦‚ urlï¼‰ï¼Œè¯¥å‡½æ•°å®Œå…¨å±•ç¤ºäº†å‰é¢æè¿°çš„ç—…æ€è¡Œä¸ºã€‚</p>
<p><strong>ä¸è¦ä¸º hashCode è¿”å›çš„å€¼æä¾›è¯¦ç»†çš„è§„èŒƒï¼Œè¿™æ ·å®¢æˆ·ç«¯å°±ä¸èƒ½ç†æ‰€åº”å½“çš„ä¾èµ–å®ƒã€‚è¿™ï¼ˆä¹Ÿï¼‰ç»™äº†ä½ æ›´æ”¹å®ƒçš„ä½™åœ°ã€‚</strong> Java åº“ä¸­çš„è®¸å¤šç±»ï¼Œä¾‹å¦‚ String å’Œ Integerï¼Œéƒ½å°† hashCode æ–¹æ³•è¿”å›çš„ç¡®åˆ‡å€¼æŒ‡å®šä¸ºå®ä¾‹å€¼çš„å‡½æ•°ã€‚è¿™ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œè€Œæ˜¯ä¸€ä¸ªæˆ‘ä»¬ä¸å¾—ä¸é¢å¯¹çš„é”™è¯¯ï¼šå®ƒé˜»ç¢äº†åœ¨æœªæ¥ç‰ˆæœ¬ä¸­æé«˜æ•£åˆ—ç®—æ³•çš„èƒ½åŠ›ã€‚å¦‚æœä½ ä¿ç•™äº†æœªæŒ‡å®šçš„ç»†èŠ‚ï¼Œå¹¶ä¸”åœ¨æ•£åˆ—ç®—æ³•ä¸­å‘ç°äº†ç¼ºé™·ï¼Œæˆ–è€…å‘ç°äº†æ›´å¥½çš„æ•£åˆ—ç®—æ³•ï¼Œé‚£ä¹ˆä½ å¯ä»¥åœ¨åç»­ç‰ˆæœ¬ä¸­æ›´æ”¹å®ƒã€‚</p>
<p>æ€»ä¹‹ï¼Œæ¯æ¬¡è¦†ç›– equals æ–¹æ³•æ—¶éƒ½å¿…é¡»è¦†ç›– hashCode æ–¹æ³•ï¼Œå¦åˆ™ç¨‹åºå°†æ— æ³•æ­£ç¡®è¿è¡Œã€‚ä½ çš„ hashCode æ–¹æ³•å¿…é¡»éµå®ˆ Object ä¸­æŒ‡å®šçš„é€šç”¨çº¦å®šï¼Œå¹¶ä¸”å¿…é¡»åˆç†åœ°å°†ä¸ç›¸ç­‰çš„æ•£åˆ—ç åˆ†é…ç»™ä¸ç›¸ç­‰çš„å®ä¾‹ã€‚è¿™å¾ˆå®¹æ˜“å®ç°ï¼Œå¦‚æœæœ‰ç‚¹æ¯ç‡¥ï¼Œå¯ä½¿ç”¨ç¬¬ 51 é¡µçš„æ–¹æ³•ã€‚AutoValue æ¡†æ¶æä¾›äº†ä¸€ç§èƒ½å¾ˆå¥½çš„æ›¿ä»£æ‰‹åŠ¨ç¼–å†™ equals æ–¹æ³•å’Œ hashCode æ–¹æ³•çš„åŠŸèƒ½ï¼ŒIDE ä¹Ÿæä¾›äº†è¿™ç§åŠŸèƒ½ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>åœ¨ã€ŠEffective Java 3ã€‹ç¬¬ä¸‰ç« ã€Šå¯¹è±¡çš„é€šç”¨æ–¹æ³•ã€‹ä¸­ï¼Œç¡®å®æåˆ°äº†ä¸€ä¸ªé‡è¦çš„åŸåˆ™ï¼Œå³åœ¨è¦†ç›–equalsæ–¹æ³•æ—¶ï¼Œæ€»è¦è¦†ç›–hashCodeæ–¹æ³•ã€‚</p>
<p>è¿™æ˜¯å› ä¸ºï¼Œå¦‚æœä¸¤ä¸ªå¯¹è±¡åœ¨equalsæ–¹æ³•ä¸­è¢«è®¤ä¸ºæ˜¯ç›¸ç­‰çš„ï¼Œé‚£ä¹ˆå®ƒä»¬çš„hashCodeæ–¹æ³•ä¹Ÿå¿…é¡»è¿”å›ç›¸åŒçš„å€¼ã€‚è¿™æ˜¯å› ä¸ºåœ¨Javaä¸­ï¼Œå¦‚æœä¸¤ä¸ªå¯¹è±¡çš„hashCodeä¸åŒï¼Œåˆ™å®ƒä»¬å°†è¢«è®¤ä¸ºæ˜¯ä¸åŒçš„å¯¹è±¡ï¼Œå³ä½¿å®ƒä»¬åœ¨equalsæ–¹æ³•ä¸­è¢«è®¤ä¸ºæ˜¯ç›¸ç­‰çš„ã€‚</p>
<p>å› æ­¤ï¼Œå¦‚æœä¸è¦†ç›–hashCodeæ–¹æ³•ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå¯¼è‡´åœ¨ä½¿ç”¨å“ˆå¸Œè¡¨ã€å“ˆå¸Œé›†åˆæˆ–å“ˆå¸Œæ˜ å°„ç­‰æ•°æ®ç»“æ„æ—¶å‡ºç°é—®é¢˜ã€‚è¿™äº›æ•°æ®ç»“æ„é€šå¸¸ä½¿ç”¨hashCodeæ–¹æ³•æ¥ç¡®å®šå¯¹è±¡åœ¨æ•°æ®ç»“æ„ä¸­çš„ä½ç½®ï¼Œå¦‚æœhashCodeæ–¹æ³•æ²¡æœ‰æ­£ç¡®å®ç°ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå¯¼è‡´å¯¹è±¡æ— æ³•æ­£ç¡®æ·»åŠ ã€åˆ é™¤æˆ–æŸ¥æ‰¾ã€‚</p>
<p>å› æ­¤ï¼Œå½“è¦†ç›–equalsæ–¹æ³•æ—¶ï¼Œæ€»è¦è¦†ç›–hashCodeæ–¹æ³•ï¼Œå¹¶ç¡®ä¿hashCodeæ–¹æ³•çš„å®ç°ä¸equalsæ–¹æ³•çš„å®ç°ä¸€è‡´ã€‚åœ¨å®ç°hashCodeæ–¹æ³•æ—¶ï¼Œé€šå¸¸éœ€è¦è€ƒè™‘å¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼Œå¹¶æ ¹æ®å±æ€§çš„å€¼è®¡ç®—ä¸€ä¸ªå“ˆå¸Œç ï¼Œä»¥ä¿è¯ä¸åŒçš„å¯¹è±¡å…·æœ‰ä¸åŒçš„å“ˆå¸Œç ï¼Œç›¸åŒçš„å¯¹è±¡å…·æœ‰ç›¸åŒçš„å“ˆå¸Œç ã€‚</p>
<p>åœ¨Javaä¸­ï¼Œå¯ä»¥ä½¿ç”¨Objectsç±»çš„hashæ–¹æ³•æ¥è®¡ç®—å¯¹è±¡çš„å“ˆå¸Œç ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Objects</span><span class="o">.</span><span class="na">hash</span><span class="o">(</span><span class="n">property1</span><span class="o">,</span> <span class="n">property2</span><span class="o">,</span> <span class="o">...);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>å…¶ä¸­ï¼Œproperty1ã€property2ç­‰ä¸ºå¯¹è±¡çš„å±æ€§ï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´ã€‚</p>
<p>æ€»ä¹‹ï¼Œåœ¨è¦†ç›–equalsæ–¹æ³•æ—¶ï¼Œæ€»è¦è¦†ç›–hashCodeæ–¹æ³•ï¼Œå¹¶ç¡®ä¿hashCodeæ–¹æ³•çš„å®ç°ä¸equalsæ–¹æ³•çš„å®ç°ä¸€è‡´ã€‚è¿™æ˜¯Javaç¼–ç¨‹ä¸­ä¸€ä¸ªé‡è¦çš„åŸåˆ™ï¼Œåº”è¯¥åœ¨å®é™…ç¼–ç¨‹ä¸­åŠ ä»¥æ³¨æ„ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›åœ¨Javaä¸­å®ç°hashCodeæ—¶éœ€è¦é¿å…çš„å¸¸è§é”™è¯¯ï¼š</p>
<ol>
<li>ä¸è€ƒè™‘æ‰€æœ‰ç›¸å…³å­—æ®µï¼šåœ¨å®ç°hashCodeæ—¶ï¼Œéœ€è¦è€ƒè™‘æ‰€æœ‰ç›¸å…³å­—æ®µï¼Œè¿™äº›å­—æ®µå¯¹äºå¯¹è±¡çš„æ ‡è¯†è‡³å…³é‡è¦ã€‚å¦‚æœçœç•¥äº†ä¸€ä¸ªå­—æ®µï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå¯¼è‡´ç›¸ç­‰çš„å¯¹è±¡å…·æœ‰ä¸åŒçš„å“ˆå¸Œç ï¼Œè¿™å¯èƒ½ä¼šåœ¨ä½¿ç”¨å“ˆå¸Œè¡¨æˆ–å“ˆå¸Œé›†åˆç­‰æ•°æ®ç»“æ„æ—¶å‡ºç°é—®é¢˜ã€‚</li>
<li>ä½¿ç”¨å¯å˜å­—æ®µï¼šå¦‚æœå¯¹è±¡å…·æœ‰å¯å˜å­—æ®µï¼Œåˆ™ä¸åº”å°†å®ƒä»¬åŒ…å«åœ¨hashCodeè®¡ç®—ä¸­ã€‚è¿™æ˜¯å› ä¸ºå¯¹è±¡çš„å“ˆå¸Œç åº”è¯¥åœ¨å…¶ç”Ÿå‘½å‘¨æœŸå†…ä¿æŒä¸å˜ï¼ŒåŒ…å«å¯å˜å­—æ®µå¯èƒ½ä¼šå¯¼è‡´å“ˆå¸Œç å‘ç”Ÿå˜åŒ–ï¼Œå³ä½¿å¯¹è±¡çš„æ ‡è¯†ä¿æŒä¸å˜ã€‚</li>
<li>åˆ†å¸ƒä¸å‡åŒ€ï¼šè‰¯å¥½çš„hashCodeå®ç°åº”è¯¥ç”Ÿæˆåœ¨å“ˆå¸Œè¡¨ä¸­å‡åŒ€åˆ†å¸ƒçš„å“ˆå¸Œç ã€‚å¦‚æœå“ˆå¸Œç ä¸å‡åŒ€åˆ†å¸ƒï¼Œå¯èƒ½ä¼šå¯¼è‡´å“ˆå¸Œè¡¨æ€§èƒ½ä¸‹é™æˆ–å†²çªã€‚</li>
<li>ä¸ä½¿ç”¨è´¨æ•°ï¼šåœ¨è®¡ç®—hashCodeæ—¶ï¼Œå¸¸å¸¸ä½¿ç”¨è´¨æ•°æ¥é¿å…å†²çªã€‚å¦‚æœä¸ä½¿ç”¨è´¨æ•°ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ›´å¤šçš„å†²çªå’Œè¾ƒå·®çš„æ€§èƒ½ã€‚</li>
<li>ä½¿ç”¨é»˜è®¤å®ç°ï¼šå¦‚æœä¸é‡å†™hashCodeï¼Œå°†ä½¿ç”¨Objectç±»æä¾›çš„é»˜è®¤å®ç°ï¼Œè¯¥å®ç°åªè¿”å›å¯¹è±¡çš„å†…å­˜åœ°å€ã€‚è¿™å¯èƒ½å¯¹æŸäº›æƒ…å†µè¶³å¤Ÿï¼Œä½†ä¸èƒ½ä¿è¯ç”Ÿæˆå”¯ä¸€çš„å“ˆå¸Œç ï¼Œå¯èƒ½ä¼šåœ¨ä½¿ç”¨å“ˆå¸Œè¡¨æˆ–å“ˆå¸Œé›†åˆç­‰æ•°æ®ç»“æ„æ—¶å‡ºç°é—®é¢˜ã€‚</li>
<li>ä¸equalsä¸ä¸€è‡´ï¼šhashCodeå®ç°åº”è¯¥ä¸equalså®ç°ä¿æŒä¸€è‡´ï¼Œè¿™æ„å‘³ç€å¦‚æœæ ¹æ®equalså®ç°ï¼Œä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼Œåˆ™å®ƒä»¬åº”è¯¥å…·æœ‰ç›¸åŒçš„hashCodeã€‚å¦‚æœæœªç¡®ä¿ä¸€è‡´æ€§ï¼Œå¯èƒ½ä¼šåœ¨ä½¿ç”¨å“ˆå¸Œè¡¨æˆ–å“ˆå¸Œé›†åˆç­‰æ•°æ®ç»“æ„æ—¶å‡ºç°é—®é¢˜ã€‚</li>
<li>ä¸ç¼“å­˜å“ˆå¸Œç ï¼šè®¡ç®—å¯¹è±¡çš„å“ˆå¸Œç å¯èƒ½æ˜¯ä¸€ä¸ªæ˜‚è´µçš„æ“ä½œï¼Œå› æ­¤é€šå¸¸éœ€è¦åœ¨è®¡ç®—å‡ºå“ˆå¸Œç åç¼“å­˜å®ƒã€‚å¦‚æœä¸ç¼“å­˜å“ˆå¸Œç ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨å“ˆå¸Œè¡¨æˆ–å“ˆå¸Œé›†åˆç­‰æ•°æ®ç»“æ„æ—¶ã€‚</li>
</ol>
<p>è¦ç¡®ä¿hashCodeåˆ†å¸ƒå‡åŒ€ï¼Œå¯ä»¥é‡‡ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<ol>
<li>ä½¿ç”¨æ‰€æœ‰ç›¸å…³å­—æ®µï¼šåœ¨è®¡ç®—hashCodeæ—¶ï¼Œéœ€è¦ä½¿ç”¨æ‰€æœ‰ç›¸å…³å­—æ®µï¼Œä»¥ç¡®ä¿æ‰€æœ‰å­—æ®µéƒ½å¯¹ç”Ÿæˆçš„å“ˆå¸Œç æœ‰è´¡çŒ®ã€‚å¦‚æœçœç•¥å­—æ®µï¼Œåˆ™å¯èƒ½ä¼šå¯¼è‡´ç›¸ç­‰çš„å¯¹è±¡å…·æœ‰ä¸åŒçš„å“ˆå¸Œç ï¼Œä»è€Œå½±å“å“ˆå¸Œè¡¨æˆ–å“ˆå¸Œé›†åˆç­‰æ•°æ®ç»“æ„çš„æ€§èƒ½ã€‚</li>
<li>é€‰æ‹©é€‚å½“çš„å“ˆå¸Œå‡½æ•°ï¼šé€‰æ‹©é€‚å½“çš„å“ˆå¸Œå‡½æ•°å¯ä»¥ç¡®ä¿ç”Ÿæˆçš„å“ˆå¸Œç åˆ†å¸ƒå‡åŒ€ã€‚ä¾‹å¦‚ï¼ŒJavaä¸­çš„Objectsç±»æä¾›äº†ä¸€äº›å“ˆå¸Œå‡½æ•°ï¼Œä¾‹å¦‚hashã€hashCombineç­‰ï¼Œå¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©é€‚å½“çš„å“ˆå¸Œå‡½æ•°ã€‚</li>
<li>ä½¿ç”¨è´¨æ•°ï¼šä½¿ç”¨è´¨æ•°å¯ä»¥é¿å…å“ˆå¸Œå†²çªã€‚åœ¨è®¡ç®—hashCodeæ—¶ï¼Œå¯ä»¥ä½¿ç”¨è´¨æ•°æ¥è®¡ç®—ä¸åŒå­—æ®µçš„å“ˆå¸Œç ï¼Œç„¶åå°†å®ƒä»¬ç»„åˆèµ·æ¥ä»¥ç”Ÿæˆæœ€ç»ˆçš„å“ˆå¸Œç ã€‚</li>
<li>å‹ç¼©å“ˆå¸Œç ï¼šåœ¨ç”Ÿæˆå“ˆå¸Œç åï¼Œå¯ä»¥å°†å…¶å‹ç¼©åˆ°å“ˆå¸Œè¡¨çš„åˆæ³•èŒƒå›´å†…ï¼Œä»¥ç¡®ä¿å“ˆå¸Œç åˆ†å¸ƒå‡åŒ€ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå“ˆå¸Œè¡¨å¤§å°ä¸º2çš„næ¬¡æ–¹ï¼Œå¯ä»¥é€šè¿‡å°†å“ˆå¸Œç ä¸2çš„næ¬¡æ–¹-1è¿›è¡ŒæŒ‰ä½ä¸è¿ç®—æ¥å‹ç¼©å“ˆå¸Œç ï¼Œä»¥ç¡®ä¿å“ˆå¸Œç åœ¨0åˆ°2çš„næ¬¡æ–¹-1ä¹‹é—´å‡åŒ€åˆ†å¸ƒã€‚</li>
<li>ä½¿ç”¨å“ˆå¸Œç éšæœºåŒ–ï¼šåœ¨ç”Ÿæˆå“ˆå¸Œç åï¼Œå¯ä»¥å¯¹å…¶è¿›è¡ŒéšæœºåŒ–ï¼Œä»¥é¿å…æ•Œæ‰‹æ”»å‡»å’Œå“ˆå¸Œå†²çªã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªéšæœºæ•°ï¼Œå°†å…¶ä¸å“ˆå¸Œç æ··åˆï¼Œä»¥ç”Ÿæˆæœ€ç»ˆçš„å“ˆå¸Œç ã€‚</li>
</ol>
<p>å“ˆå¸Œå†²çªæ˜¯æŒ‡ä¸åŒçš„é”®ï¼ˆkeyï¼‰åœ¨å“ˆå¸Œè¡¨ä¸­æ˜ å°„åˆ°ç›¸åŒçš„ä½ç½®ï¼ˆç´¢å¼•ï¼‰çš„æƒ…å†µã€‚ä¸ºäº†å¤„ç†å“ˆå¸Œå†²çªï¼Œå¯ä»¥é‡‡ç”¨ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š</p>
<ol>
<li>å¼€æ”¾åœ°å€æ³•ï¼šå¼€æ”¾åœ°å€æ³•æ˜¯ä¸€ç§å¸¸ç”¨çš„å¤„ç†å“ˆå¸Œå†²çªçš„æ–¹æ³•ï¼Œå®ƒçš„æ€æƒ³æ˜¯åœ¨å“ˆå¸Œè¡¨ä¸­å¯»æ‰¾ä¸€ä¸ªç©ºæ§½ï¼Œå°†å†²çªçš„é”®æ”¾å…¥è¯¥æ§½ä¸­ã€‚å¸¸ç”¨çš„å¼€æ”¾åœ°å€æ³•åŒ…æ‹¬çº¿æ€§æ¢æµ‹ã€äºŒæ¬¡æ¢æµ‹å’ŒåŒé‡æ•£åˆ—ç­‰ã€‚</li>
<li>é“¾åœ°å€æ³•ï¼šé“¾åœ°å€æ³•æ˜¯å¦ä¸€ç§å¸¸ç”¨çš„å¤„ç†å“ˆå¸Œå†²çªçš„æ–¹æ³•ï¼Œå®ƒçš„æ€æƒ³æ˜¯å°†å“ˆå¸Œè¡¨ä¸­åŒä¸€ä¸ªä½ç½®çš„æ‰€æœ‰é”®æ”¾åœ¨ä¸€ä¸ªé“¾è¡¨ä¸­ã€‚å½“å‘ç”Ÿå“ˆå¸Œå†²çªæ—¶ï¼Œåªéœ€è¦å°†å†²çªçš„é”®æ·»åŠ åˆ°é“¾è¡¨çš„æœ«å°¾å³å¯ã€‚é“¾åœ°å€æ³•é€‚ç”¨äºå­˜å‚¨å¤§é‡æ•°æ®çš„å“ˆå¸Œè¡¨ã€‚</li>
<li>å†å“ˆå¸Œæ³•ï¼šå†å“ˆå¸Œæ³•æ˜¯ä¸€ç§å¤„ç†å“ˆå¸Œå†²çªçš„æ–¹æ³•ï¼Œå®ƒçš„æ€æƒ³æ˜¯ä½¿ç”¨å¦ä¸€ä¸ªå“ˆå¸Œå‡½æ•°æ¥è®¡ç®—å†²çªé”®çš„å“ˆå¸Œå€¼ã€‚å½“å‘ç”Ÿå“ˆå¸Œå†²çªæ—¶ï¼Œä½¿ç”¨å¦ä¸€ä¸ªå“ˆå¸Œå‡½æ•°é‡æ–°è®¡ç®—å“ˆå¸Œå€¼ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªç©ºæ§½æ’å…¥é”®ä¸ºæ­¢ã€‚</li>
<li>å»ºç«‹å…¬å…±æº¢å‡ºåŒºï¼šå»ºç«‹å…¬å…±æº¢å‡ºåŒºæ˜¯ä¸€ç§å¤„ç†å“ˆå¸Œå†²çªçš„æ–¹æ³•ï¼Œå®ƒçš„æ€æƒ³æ˜¯åœ¨å“ˆå¸Œè¡¨ä¸­ä¿ç•™ä¸€äº›ä½ç½®ï¼Œç”¨äºå­˜å‚¨å“ˆå¸Œå†²çªçš„é”®ã€‚å½“å‘ç”Ÿå“ˆå¸Œå†²çªæ—¶ï¼Œå°†å†²çªçš„é”®æ”¾å…¥å…¬å…±æº¢å‡ºåŒºä¸­ï¼Œè€Œä¸æ˜¯åœ¨å“ˆå¸Œè¡¨çš„å…¶ä»–ä½ç½®ä¸­ã€‚</li>
</ol>
<p>æ— è®ºé‡‡ç”¨å“ªç§æ–¹æ³•ï¼Œå¤„ç†å“ˆå¸Œå†²çªæ—¶éœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<ol>
<li>æ•ˆç‡ï¼šå¤„ç†å“ˆå¸Œå†²çªçš„æ–¹æ³•åº”è¯¥å…·æœ‰é«˜æ•ˆæ€§ï¼Œèƒ½å¤Ÿåœ¨ä¸å½±å“æ€§èƒ½çš„æƒ…å†µä¸‹è§£å†³å“ˆå¸Œå†²çªã€‚</li>
<li>å†²çªè§£å†³åº¦ï¼šå¤„ç†å“ˆå¸Œå†²çªçš„æ–¹æ³•åº”è¯¥å…·æœ‰è‰¯å¥½çš„å†²çªè§£å†³åº¦ï¼Œèƒ½å¤Ÿå°½å¯èƒ½åœ°å‡å°‘å“ˆå¸Œå†²çªçš„å‘ç”Ÿã€‚</li>
<li>å®ç°å¤æ‚åº¦ï¼šå¤„ç†å“ˆå¸Œå†²çªçš„æ–¹æ³•åº”è¯¥æ˜“äºå®ç°å’Œç»´æŠ¤ã€‚</li>
</ol>
]]></content:encoded>
    </item>
    
    <item>
      <title>[è¯‘]Build Robust Continuous Integration With Docker and Friends</title>
      <link>https://blog.chensoul.com/posts/2023/05/22/docker-continuous-integration/</link>
      <pubDate>Mon, 22 May 2023 15:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/05/22/docker-continuous-integration/</guid>
      <description>æŒç»­é›†æˆ (CI) å·²æˆä¸ºè½¯ä»¶å¼€å‘çš„å…³é”®ï¼Œå®ƒå…è®¸å›¢é˜Ÿé¢‘ç¹åˆå¹¶ä»£ç æ›´æ”¹å¹¶åŠæ—©å‘ç°é”™è¯¯ã€‚ Docker å®¹å™¨é€šè¿‡æä¾›ä¸€è‡´çš„ç¯å¢ƒå¸®åŠ©ä¿ƒè¿›æŒç»­é›†æˆè¿‡ç¨‹ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æµ‹è¯•å’Œå‘</description>
      <content:encoded><![CDATA[<p><img loading="lazy" src="https://files.realpython.com/media/UPDATE-Docker-in-Action-Fitter-Happier-More-Productive_Watermarked.479cfb791c17.jpg" alt="Build Robust Continuous Integration With Docker and Friends"  />
</p>
<p>æŒç»­é›†æˆ (CI) å·²æˆä¸ºè½¯ä»¶å¼€å‘çš„å…³é”®ï¼Œå®ƒå…è®¸å›¢é˜Ÿé¢‘ç¹åˆå¹¶ä»£ç æ›´æ”¹å¹¶åŠæ—©å‘ç°é”™è¯¯ã€‚</p>
<p>Docker å®¹å™¨é€šè¿‡æä¾›ä¸€è‡´çš„ç¯å¢ƒå¸®åŠ©ä¿ƒè¿›æŒç»­é›†æˆè¿‡ç¨‹ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æµ‹è¯•å’Œå‘é€æ¯æ¬¡æäº¤çš„ä»£ç ã€‚</p>
<p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Docker ä¸º Flask Web åº”ç”¨ç¨‹åºåˆ›å»ºå¼ºå¤§çš„æŒç»­é›†æˆç®¡é“ã€‚</p>
<p>æ‚¨å°†å®Œæˆåœ¨æœ¬åœ°å¼€å‘å’Œæµ‹è¯•åº”ç”¨ç¨‹åºã€å°†å…¶å®¹å™¨åŒ–ã€ä½¿ç”¨ Docker Compose ç¼–æ’å®¹å™¨ä»¥åŠä½¿ç”¨ GitHub Actions å®šä¹‰ CI ç®¡é“çš„æ­¥éª¤ã€‚</p>
<p>åœ¨æœ¬æ•™ç¨‹ç»“æŸæ—¶ï¼Œæ‚¨å°†èƒ½å¤Ÿä¸ºæ‚¨çš„ Web åº”ç”¨ç¨‹åºåˆ›å»ºä¸€ä¸ªå®Œå…¨è‡ªåŠ¨åŒ–çš„ CI ç®¡é“ã€‚</p>
<p><strong>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†</strong>ï¼š</p>
<ul>
<li>åœ¨ Docker å®¹å™¨ä¸­æœ¬åœ°è¿è¡Œ Redis æœåŠ¡å™¨</li>
<li>ç”¨ Docker ç¼–æ’ Flask ç¼–å†™çš„ Python Web åº”ç”¨ç¨‹åº</li>
<li>æ„å»º Docker é•œåƒå¹¶å°†å®ƒä»¬æ¨é€åˆ° Docker Hub ä»“åº“</li>
<li>ä½¿ç”¨ Docker Compose ç¼–æ’å¤šå®¹å™¨åº”ç”¨ç¨‹åº</li>
<li>åœ¨ä»»ä½•åœ°æ–¹å¤åˆ¶ç±»ä¼¼ç”Ÿäº§çš„åŸºç¡€è®¾æ–½</li>
<li>ä½¿ç”¨ GitHub Actions å®šä¹‰æŒç»­é›†æˆå·¥ä½œæµ</li>
</ul>
<p>ç†æƒ³æƒ…å†µä¸‹ï¼Œæ‚¨åº”è¯¥å…·æœ‰ä½¿ç”¨ Python è¿›è¡Œ <a href="https://realpython.com/learning-paths/become-python-web-developer/">Web å¼€å‘</a>ã€<a href="https://realpython.com/learning-paths/test-your-python-apps/">æµ‹è¯•è‡ªåŠ¨åŒ–</a>ã€å°† <a href="https://realpython.com/python-redis/">Redis ä¸ Python ç»“åˆä½¿ç”¨</a>ä»¥åŠ<a href="https://realpython.com/python-git-github-intro/">ä½¿ç”¨ Git å’Œ GitHub è¿›è¡Œæºä»£ç ç‰ˆæœ¬æ§åˆ¶</a>çš„ç»éªŒã€‚ä»¥å‰æ¥è§¦è¿‡ <a href="https://realpython.com/python-versions-docker/">Docker</a> ä¼šæ›´å¥½ï¼Œä½†ä¸æ˜¯å¿…éœ€çš„ã€‚æ‚¨è¿˜åº”è¯¥æ‹¥æœ‰ä¸€ä¸ª Git å®¢æˆ·ç«¯å’Œä¸€ä¸ª GitHub å¸æˆ·ï¼Œä»¥ä¾¿è·Ÿéšå¹¶å¤åˆ¶æœ¬æ•™ç¨‹çš„æ­¥éª¤ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šæœ¬æ•™ç¨‹å¤§è‡´åŸºäºåä¸º Docker in Action - Fitter, Happier, More Productive çš„æ—§æ•™ç¨‹ï¼Œè¯¥æ•™ç¨‹ç”± Michael Herman ç¼–å†™ï¼Œä»–äº 2015 å¹´ 2 æœˆ 8 æ—¥åœ¨ PyTennessee å±•ç¤ºäº†ä»–çš„ CI å·¥ä½œæµç¨‹ã€‚å¦‚æœä½ æœ‰å…´è¶£ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å±•ç¤ºçš„ç›¸åº”å¹»ç¯ç‰‡åœ¨ä¼šè®®ä¸Šã€‚</p>
<p>ä¸å¹¸çš„æ˜¯ï¼ŒåŸå§‹æ•™ç¨‹ä¸­æè¿°çš„è®¸å¤šå·¥å…·ä¸å†å—æ”¯æŒæˆ–å…è´¹æä¾›ã€‚åœ¨æ­¤æ›´æ–°çš„æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†ä½¿ç”¨æœ€æ–°çš„å·¥å…·å’ŒæŠ€æœ¯ï¼Œä¾‹å¦‚ GitHub Actionsã€‚</p>
</blockquote>
<p>å¦‚æœæ‚¨æƒ³è·³è¿‡åœ¨è®¡ç®—æœºä¸Šè®¾ç½® Docker å’Œæ„å»ºç¤ºä¾‹ Web åº”ç”¨ç¨‹åºçš„åˆå§‹æ­¥éª¤ï¼Œé‚£ä¹ˆç›´æ¥è·³åˆ°å®šä¹‰æŒç»­é›†æˆç®¡é“ã€‚æ— è®ºå“ªç§æ–¹å¼ï¼Œæ‚¨éƒ½éœ€è¦ä¸‹è½½æ”¯æŒææ–™ï¼Œå®ƒä»¬ä¸å®Œæˆçš„ Flask Web åº”ç”¨ç¨‹åºå’Œç›¸å…³èµ„æºä¸€èµ·æä¾›ï¼Œå®ƒä»¬å°†å¸®åŠ©æ‚¨å­¦ä¹ æœ¬æ•™ç¨‹ï¼š</p>
<blockquote>
<p>å…è´¹ä¸‹è½½ï¼šå•å‡»<a href="https://realpython.com/bonus/docker-continuous-integration-code/">æ­¤å¤„</a>ä¸‹è½½æ‚¨çš„ Flask åº”ç”¨ç¨‹åºå’Œç›¸å…³èµ„æºï¼Œä»¥ä¾¿æ‚¨å¯ä»¥ä½¿ç”¨ Docker å®šä¹‰æŒç»­é›†æˆç®¡é“ã€‚</p>
</blockquote>
<h2 id="é¡¹ç›®æ¶æ„æ¦‚è§ˆ">é¡¹ç›®æ¶æ„æ¦‚è§ˆ</h2>
<p>åœ¨æœ¬æ•™ç¨‹ç»“æŸæ—¶ï¼Œæ‚¨å°†æ‹¥æœ‰ä¸€ä¸ª Flask Web åº”ç”¨ç¨‹åºï¼Œç”¨äºè·Ÿè¸ªæŒä¹…å­˜å‚¨åœ¨ Redis æ•°æ®å­˜å‚¨ä¸­çš„é¡µé¢è§†å›¾ã€‚</p>
<p>å®ƒå°†æ˜¯ä¸€ä¸ªç”± Docker Compose ç¼–æ’çš„å¤šå®¹å™¨åº”ç”¨ç¨‹åºï¼Œæ‚¨å°†èƒ½å¤Ÿåœ¨æœ¬åœ°å’Œäº‘ç«¯æ„å»ºå’Œæµ‹è¯•ï¼Œä¸ºæŒç»­é›†æˆé“ºå¹³é“è·¯ï¼š</p>
<p><img loading="lazy" src="https://files.realpython.com/media/page_tracker_architecture.drawio_2.1c8cf20462ae.png" alt="The Architecture of the Page Tracker Application"  />
</p>
<p>è¯¥åº”ç”¨ç¨‹åºç”±ä¸¤ä¸ª Docker å®¹å™¨ç»„æˆã€‚ç¬¬ä¸€ä¸ªå®¹å™¨å°†åœ¨ Gunicorn ä¹‹ä¸Šè¿è¡Œä¸€ä¸ª Flask åº”ç”¨ç¨‹åºï¼Œå“åº” HTTP è¯·æ±‚å¹¶æ›´æ–°é¡µé¢æµè§ˆé‡ã€‚</p>
<p>ç¬¬äºŒä¸ªå®¹å™¨å°†è¿è¡Œä¸€ä¸ª Redis å®ä¾‹ï¼Œç”¨äºå°†é¡µé¢è§†å›¾æ•°æ®æŒä¹…å­˜å‚¨åœ¨ä¸»æœºä¸Šçš„æœ¬åœ°å·ä¸­ã€‚</p>
<p>Docker æ˜¯è¿è¡Œæ­¤åº”ç”¨ç¨‹åºæ‰€éœ€çš„å…¨éƒ¨ï¼Œæ‚¨ç°åœ¨å°†å¯¹å…¶è¿›è¡Œè®¾ç½®ã€‚</p>
<h2 id="åœ¨æ‚¨çš„è®¡ç®—æœºä¸Šè®¾ç½®-docker">åœ¨æ‚¨çš„è®¡ç®—æœºä¸Šè®¾ç½® Docker</h2>
<p>Docker æ˜¯ä¸€ä¸ªæ€»ç§°ï¼Œæ ¹æ®ä¸Šä¸‹æ–‡ï¼Œå®ƒå¯¹ä¸åŒçš„äººæœ‰ä¸åŒçš„å«ä¹‰ã€‚ä¾‹å¦‚ï¼Œå½“æœ‰äººæåˆ° docker æ—¶ï¼Œä»–ä»¬å¯èƒ½æŒ‡ä»¥ä¸‹ä¹‹ä¸€ï¼š</p>
<ul>
<li>Docker, Inc.ï¼šå¹³å°å’Œç›¸å…³å·¥å…·èƒŒåçš„å…¬å¸</li>
<li>Dockerï¼šå¼€æºå®¹å™¨å¹³å°</li>
<li>Docker CLIï¼š <code>docker</code> å®¢æˆ·ç«¯å‘½ä»¤è¡Œç¨‹åº</li>
<li><code>dockerd</code> : ç®¡ç†å®¹å™¨çš„ Docker å®ˆæŠ¤è¿›ç¨‹</li>
</ul>
<p>è¿˜æœ‰ä¸€äº›ä¸ Docker å¹³å°ç›¸å…³çš„å·¥å…·å’Œé¡¹ç›®ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>Docker Compose</li>
<li>Docker Desktop</li>
<li>Docker Engine</li>
<li>Docker Hub</li>
<li>Docker Swarm Mode Docker é›†ç¾¤æ¨¡å¼</li>
</ul>
<p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†ä½¿ç”¨ä¸Šé¢åˆ—è¡¨ä¸­é™¤æœ€åä¸€ä¸ªä¹‹å¤–çš„æ‰€æœ‰å†…å®¹ã€‚é¡ºä¾¿è¯´ä¸€å¥ï¼Œä¸è¦å°†é—ç•™çš„ <a href="https://github.com/docker-archive/classicswarm">Docker Classic Swarm</a> ä¸ 1.12 ç‰ˆä»¥æ¥å†…ç½®äº Docker å¼•æ“ä¸­çš„ Docker Swarm Mode æ··æ·†ï¼Œåè€…æ˜¯ä¸€ä¸ªå¤–éƒ¨å·¥å…·ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šæ‚¨å¯èƒ½å¬è¯´è¿‡ Docker Machine å’Œ Docker Toolboxã€‚è¿™äº›æ˜¯ä¸å†ç»´æŠ¤çš„æ—§å·¥å…·ã€‚</p>
</blockquote>
<p>Docker è§£å†³çš„ä¸»è¦é—®é¢˜æ˜¯èƒ½å¤Ÿåœ¨å‡ ä¹æ²¡æœ‰æˆ–æ²¡æœ‰é…ç½®çš„æƒ…å†µä¸‹åœ¨ä¸€è‡´ä¸”å¯é‡ç°çš„ç¯å¢ƒä¸­çš„ä»»ä½•åœ°æ–¹è¿è¡Œåº”ç”¨ç¨‹åºã€‚å®ƒå¯ä»¥å°†æ‚¨çš„åº”ç”¨ç¨‹åºä»£ç ã€äºŒè¿›åˆ¶æ–‡ä»¶å’Œä¾èµ–é¡¹ï¼ˆä¾‹å¦‚è¯­è¨€è¿è¡Œæ—¶å’Œåº“ï¼‰æ‰“åŒ…åˆ°ä¸€ä¸ªå·¥ä»¶ä¸­ã€‚æ‚¨å°†åœ¨å¼€å‘æœŸé—´å’ŒæŒç»­é›†æˆæœåŠ¡å™¨ä¸Šä½¿ç”¨ Docker åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šæ¨¡æ‹Ÿå‡è®¾çš„ç”Ÿäº§ç¯å¢ƒã€‚</p>
<p>å®‰è£… Docker æœ‰ä¸¤ç§é€‰æ‹©ï¼š</p>
<ol>
<li><a href="https://docs.docker.com/engine/">Docker Engine</a></li>
<li><a href="https://docs.docker.com/desktop/">Docker Desktop</a></li>
</ol>
<p>å¦‚æœæ‚¨ç†Ÿæ‚‰ç»ˆç«¯å¹¶å–œæ¬¢é¢å¤–çš„æ§åˆ¶çº§åˆ«ï¼Œé‚£ä¹ˆå¼€æº Docker å¼•æ“å°±æ˜¯æ‚¨çš„æœ€ä½³é€‰æ‹©ï¼Œå®ƒæä¾›æ ¸å¿ƒè¿è¡Œæ—¶å’Œç”¨äºç®¡ç†å®¹å™¨çš„å‘½ä»¤è¡Œç•Œé¢ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæ‚¨æ›´å–œæ¬¢å…·æœ‰ç›´è§‚å›¾å½¢ç”¨æˆ·ç•Œé¢çš„ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆï¼Œé‚£ä¹ˆæ‚¨åº”è¯¥è€ƒè™‘ä½¿ç”¨ Docker Desktopã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå¼€ç®±å³ç”¨çš„æ¡Œé¢åº”ç”¨ç¨‹åºé™„å¸¦ <a href="https://docs.docker.com/compose/">Docker Compose</a>ï¼Œç¨ååœ¨<a href="https://realpython.com/docker-continuous-integration/#orchestrate-containers-using-docker-compose">ç¼–æ’å®¹å™¨</a>ä»¥è¿›è¡ŒæŒç»­é›†æˆæ—¶å°†éœ€è¦å®ƒã€‚</p>
</blockquote>
<p>å½“æ‚¨æµè§ˆ <a href="https://docs.docker.com/">Docker å®˜æ–¹æ–‡æ¡£</a>æ—¶ï¼Œæ‚¨å¯èƒ½ä¼šè§‰å¾— Docker Desktop å æ®äº†èšå…‰ç¯ä¸‹ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸æ£’çš„å·¥å…·ï¼Œä½†æ‚¨å¿…é¡»è®°ä½ï¼ŒDocker Desktop ä»ç„¶å…è´¹ä¾›ä¸ªäººä½¿ç”¨ã€‚è‡ª 2021 å¹´ 8 æœˆèµ·ï¼Œæ‚¨éœ€è¦<a href="https://www.docker.com/pricing/">ä»˜è´¹è®¢é˜…</a>æ‰èƒ½åœ¨å•†ä¸šé¡¹ç›®ä¸­ä½¿ç”¨å®ƒã€‚</p>
<p>è™½ç„¶åœ¨æŠ€æœ¯ä¸Šå¯ä»¥å¹¶æ’å®‰è£…è¿™ä¸¤ç§å·¥å…·ï¼Œä½†æ‚¨é€šå¸¸åº”è¯¥é¿å…åŒæ—¶ä½¿ç”¨å®ƒä»¬ï¼Œä»¥å°½é‡å‡å°‘è™šæ‹Ÿç½‘ç»œæˆ–ç«¯å£ç»‘å®šä¹‹é—´ä»»ä½•æ½œåœ¨å¹²æ‰°çš„é£é™©ã€‚æ‚¨å¯ä»¥é€šè¿‡åœæ­¢å…¶ä¸­ä¹‹ä¸€å¹¶åœ¨ Docker Engine å’Œ Docker Desktop ä¹‹é—´<a href="https://docs.docker.com/desktop/faqs/linuxfaqs/#context">åˆ‡æ¢ä¸Šä¸‹æ–‡</a>æ¥å®ç°ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šDocker Desktop è¿‡å»åªèƒ½åœ¨ Windows å’Œ macOS ä¸Šä½¿ç”¨ï¼Œä½†ç°åœ¨æƒ…å†µå‘ç”Ÿäº†å˜åŒ–ï¼Œæ‚¨ç°åœ¨ä¹Ÿå¯ä»¥åœ¨æŸäº› Linux å‘è¡Œç‰ˆä¸Šå®‰è£…å®ƒï¼ŒåŒ…æ‹¬ <a href="https://docs.docker.com/desktop/install/ubuntu/">Ubuntu</a>ã€<a href="https://docs.docker.com/desktop/install/debian/">Debian</a> å’Œ <a href="https://docs.docker.com/desktop/install/fedora/">Fedora</a>ã€‚ä½†æ˜¯ï¼ŒLinux ç‰ˆæœ¬çš„ Docker Desktop è¿è¡Œåœ¨<a href="https://docs.docker.com/desktop/faqs/linuxfaqs/#why-does-docker-desktop-for-linux-run-a-vm">è™šæ‹Ÿæœº</a>ä¹‹ä¸Šï¼Œä»¥æ¨¡ä»¿åœ¨å…¶ä»–æ“ä½œç³»ç»Ÿä¸Šä½¿ç”¨å®ƒçš„ç”¨æˆ·ä½“éªŒã€‚</p>
</blockquote>
<p>è¦éªŒè¯æ‚¨æ˜¯å¦å·²åœ¨ç³»ç»Ÿä¸ŠæˆåŠŸå®‰è£… Dockerï¼ˆä½œä¸º Docker Engine æˆ– Docker Desktop åŒ…è£…å™¨åº”ç”¨ç¨‹åºï¼‰ï¼Œè¯·æ‰“å¼€ç»ˆç«¯å¹¶é”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker --version
</span></span><span class="line"><span class="cl">Docker version 23.0.4, build f480fb1
</span></span></code></pre></div><p>æ‚¨åº”è¯¥ä¼šçœ‹åˆ°æ‚¨çš„ Docker ç‰ˆæœ¬ä»¥åŠå†…éƒ¨ç‰ˆæœ¬å·ã€‚å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Linuxï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½å¸Œæœ›æŒ‰ç…§<a href="https://docs.docker.com/engine/install/linux-postinstall/">å®‰è£…åçš„æ­¥éª¤</a>ä½¿ç”¨ <code>docker</code> å‘½ä»¤ï¼Œè€Œæ— éœ€åœ¨å…¶å‰é¢åŠ ä¸Š <code>sudo</code> ä»¥è·å¾—ç®¡ç†æƒé™ã€‚</p>
<p>åœ¨å¼€å§‹ä½¿ç”¨ Docker æ¥å¸®åŠ©è¿›è¡ŒæŒç»­é›†æˆä¹‹å‰ï¼Œæ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„ Web åº”ç”¨ç¨‹åºã€‚</p>
<h2 id="åœ¨-flask-ä¸­å¼€å‘é¡µé¢è§†å›¾è·Ÿè¸ªå™¨">åœ¨ Flask ä¸­å¼€å‘é¡µé¢è§†å›¾è·Ÿè¸ªå™¨</h2>
<p>åœ¨æ¥ä¸‹æ¥çš„å‡ èŠ‚ä¸­ï¼Œæ‚¨å°†ä½¿ç”¨ <a href="https://realpython.com/tutorials/flask/">Flask</a> æ¡†æ¶å®ç°ä¸€ä¸ªåŸºæœ¬çš„ Web åº”ç”¨ç¨‹åºã€‚æ‚¨çš„åº”ç”¨ç¨‹åºå°†è·Ÿè¸ªé¡µé¢æµè§ˆæ€»æ•°ï¼Œå¹¶åœ¨æ¯æ¬¡è¯·æ±‚æ—¶å‘ç”¨æˆ·æ˜¾ç¤ºè¯¥æ•°å­—ï¼š</p>
<p><img loading="lazy" src="https://files.realpython.com/media/screenshot-browser.5036973f0aae.png" alt="A web application for tracking page views"  />
</p>
<p>åº”ç”¨ç¨‹åºçš„å½“å‰çŠ¶æ€å°†ä¿å­˜åœ¨ <a href="https://redis.io/">Redis</a> æ•°æ®å­˜å‚¨ä¸­ï¼Œè¯¥å­˜å‚¨é€šå¸¸ç”¨äºç¼“å­˜å’Œå…¶ä»–ç±»å‹çš„æ•°æ®æŒä¹…åŒ–ã€‚è¿™æ ·ï¼Œåœæ­¢æ‚¨çš„ç½‘ç»œæœåŠ¡å™¨ä¸ä¼šé‡ç½®è§‚çœ‹æ¬¡æ•°ã€‚æ‚¨å¯ä»¥å°† Redis è§†ä¸ºä¸€ç§æ•°æ®åº“ã€‚</p>
<p>å¦‚æœæ‚¨å¯¹ä»å¤´å¼€å§‹æ„å»ºæ­¤åº”ç”¨ç¨‹åºä¸æ„Ÿå…´è¶£ï¼Œè¯·éšæ—¶é€šè¿‡å•å‡»ä¸‹é¢çš„é“¾æ¥ä¸‹è½½å…¶å®Œæ•´æºä»£ç ï¼Œç„¶åè·³åˆ°å¯¹æ‚¨çš„ Flask Web åº”ç”¨ç¨‹åº<a href="https://realpython.com/docker-continuous-integration/#dockerize-your-flask-web-application">è¿›è¡Œ docker åŒ–</a>ï¼š</p>
<p>å³ä½¿æ‚¨æ‰“ç®—è‡ªå·±ç¼–å†™ä»£ç ï¼Œä¸‹è½½å®Œæˆçš„é¡¹ç›®å¹¶å°†å…¶ç”¨ä½œå‚è€ƒä¸æ‚¨çš„å®ç°è¿›è¡Œæ¯”è¾ƒä»ç„¶æ˜¯ä¸ªå¥½ä¸»æ„ï¼Œä»¥é˜²æ‚¨é‡åˆ°å›°éš¾ã€‚</p>
<blockquote>
<p>å…è´¹ä¸‹è½½ï¼šå•å‡»<a href="https://realpython.com/bonus/docker-continuous-integration-code/">æ­¤å¤„</a>ä¸‹è½½æ‚¨çš„ Flask åº”ç”¨ç¨‹åºå’Œç›¸å…³èµ„æºï¼Œä»¥ä¾¿æ‚¨å¯ä»¥ä½¿ç”¨ Docker å®šä¹‰æŒç»­é›†æˆç®¡é“ã€‚</p>
</blockquote>
<p>åœ¨å¼€å§‹å¼€å‘åº”ç”¨ç¨‹åºä¹‹å‰ï¼Œæ‚¨éœ€è¦è®¾ç½®å·¥ä½œç¯å¢ƒã€‚</p>
<h3 id="å‡†å¤‡ç¯å¢ƒ">å‡†å¤‡ç¯å¢ƒ</h3>
<p>ä¸æ¯ä¸ª <a href="https://realpython.com/tutorials/projects/">Python é¡¹ç›®</a>ä¸€æ ·ï¼Œæ‚¨åœ¨å¼€å§‹æ—¶åº”è¯¥éµå¾ªå¤§è‡´ç›¸åŒçš„æ­¥éª¤ï¼ŒåŒ…æ‹¬åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•ï¼Œç„¶åä¸ºæ‚¨çš„é¡¹ç›®åˆ›å»ºå¹¶æ¿€æ´»ä¸€ä¸ªéš”ç¦»çš„<a href="https://realpython.com/python-virtual-environments-a-primer/">è™šæ‹Ÿç¯å¢ƒ</a>ã€‚æ‚¨å¯ä»¥ç›´æ¥ä»æ‚¨æœ€å–œæ¬¢çš„<a href="https://realpython.com/python-ides-code-editors-guide/">ä»£ç ç¼–è¾‘å™¨</a>ï¼ˆå¦‚ <a href="https://realpython.com/python-development-visual-studio-code/">Visual Studio Code</a>ï¼‰æˆ–åŠŸèƒ½é½å…¨çš„ IDEï¼ˆå¦‚ <a href="https://realpython.com/pycharm-guide/">PyCharm</a>ï¼‰æ‰§è¡Œæ­¤æ“ä½œï¼Œæˆ–è€…æ‚¨å¯ä»¥åœ¨ç»ˆç«¯ä¸­é”®å…¥ä¸€äº›å‘½ä»¤ï¼š</p>
<p>Windowsï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">PS&gt; mkdir page-tracker
</span></span><span class="line"><span class="cl">PS&gt; <span class="nb">cd</span> page-tracker
</span></span><span class="line"><span class="cl">PS&gt; python -m venv venv --prompt page-tracker
</span></span><span class="line"><span class="cl">PS&gt; venv<span class="se">\S</span>cripts<span class="se">\a</span>ctivate
</span></span><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> PS&gt; python -m pip install --upgrade pip
</span></span></code></pre></div><p>Linux + MacOSï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ mkdir page-tracker/
</span></span><span class="line"><span class="cl">$ <span class="nb">cd</span> page-tracker/
</span></span><span class="line"><span class="cl">$ python3 -m venv venv/ --prompt page-tracker
</span></span><span class="line"><span class="cl">$ <span class="nb">source</span> venv/bin/activate
</span></span><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ python -m pip install --upgrade pip
</span></span></code></pre></div><p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªåä¸º <code>page-tracker/</code> çš„æ–°ç›®å½•ï¼Œç„¶ååœ¨å…¶ä¸­åˆ›å»ºä¸€ä¸ªåä¸º <code>venv/</code> çš„Python è™šæ‹Ÿç¯å¢ƒã€‚ä¸ºè™šæ‹Ÿç¯å¢ƒæä¾›æè¿°æ€§æç¤ºï¼Œä½¿å…¶æ˜“äºè¯†åˆ«ã€‚æœ€åï¼Œæ¿€æ´»æ–°å»ºçš„è™šæ‹Ÿç¯å¢ƒåï¼Œå°† <a href="https://realpython.com/what-is-pip/"><code>pip</code></a> å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œä»¥å…ä»¥åå®‰è£…<a href="https://realpython.com/python-modules-packages/">PythonåŒ…</a>æ—¶å‡ºç°é—®é¢˜ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šåœ¨ Windows ä¸Šï¼Œæ‚¨å¯èƒ½éœ€è¦å…ˆä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ <a href="https://realpython.com/python-coding-setup-windows/#discovering-the-windows-terminal">Windows Terminal</a> å¹¶åœ¨åˆ›å»ºè™šæ‹Ÿç¯å¢ƒä¹‹å‰<a href="https://realpython.com/python-coding-setup-windows/#loosening-your-execution-policy">æ”¾å®½è„šæœ¬æ‰§è¡Œç­–ç•¥</a>ã€‚</p>
</blockquote>
<p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†ä½¿ç”¨ç°ä»£æ–¹å¼é€šè¿‡ <a href="https://realpython.com/courses/packaging-with-pyproject-toml/">pyproject.toml</a> é…ç½®æ–‡ä»¶å’Œ <a href="https://setuptools.pypa.io/en/latest/">setuptools</a> æŒ‡å®šé¡¹ç›®çš„ä¾èµ–é¡¹å’Œå…ƒæ•°æ®<a href="https://peps.python.org/pep-0517/">ä½œä¸ºæ„å»ºåç«¯</a>ã€‚æ­¤å¤–ï¼Œæ‚¨å°†éµå¾ª <a href="https://packaging.python.org/en/latest/discussions/src-layout-vs-flat-layout/">src å¸ƒå±€</a>ï¼Œå°†åº”ç”¨ç¨‹åºçš„æºä»£ç æ”¾åœ¨å•ç‹¬çš„ <code>src/</code> å­ç›®å½•ä¸­ï¼Œä»¥æ›´å¥½åœ°ç»„ç»‡é¡¹ç›®ä¸­çš„æ–‡ä»¶ã€‚è¿™å°†ä½¿æ‚¨å¯ä»¥ç›´æ¥æ‰“åŒ…ä»£ç ï¼Œè€Œæ— éœ€ç¨åæ·»åŠ çš„è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚</p>
<p>ç»§ç»­ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ„å»ºæ‚¨çš„ Python é¡¹ç›®å ä½ç¬¦ï¼š</p>
<p>Windowsï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> PS&gt; mkdir src<span class="se">\p</span>age_tracker
</span></span><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> PS&gt; ni src<span class="se">\p</span>age_tracker<span class="se">\_</span>_init__.py
</span></span><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> PS&gt; ni src<span class="se">\p</span>age_tracker<span class="se">\a</span>pp.py
</span></span><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> PS&gt; ni constraints.txt
</span></span><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> PS&gt; ni pyproject.toml
</span></span></code></pre></div><p>Linux + MacOSï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ mkdir -p src/page_tracker
</span></span><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ touch src/page_tracker/__init__.py
</span></span><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ touch src/page_tracker/app.py
</span></span><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ touch constraints.txt
</span></span><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ touch pyproject.toml
</span></span></code></pre></div><p>å®Œæˆåï¼Œæ‚¨åº”è¯¥å…·æœ‰ä»¥ä¸‹ç›®å½•ç»“æ„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">page-tracker/
</span></span><span class="line"><span class="cl">â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€ src/
</span></span><span class="line"><span class="cl">â”‚   â””â”€â”€ page_tracker/
</span></span><span class="line"><span class="cl">â”‚       â”œâ”€â”€ __init__.py
</span></span><span class="line"><span class="cl">â”‚       â””â”€â”€ app.py
</span></span><span class="line"><span class="cl">â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€ venv/
</span></span><span class="line"><span class="cl">â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€ constraints.txt
</span></span><span class="line"><span class="cl">â””â”€â”€ pyproject.toml
</span></span></code></pre></div><p>å¦‚æ‚¨æ‰€è§ï¼Œæ‚¨å°†åªæœ‰ä¸€ä¸ª Python æ¨¡å—ï¼Œ <code>app</code> ï¼Œå®šä¹‰åœ¨ä¸€ä¸ªåä¸º <code>page_tracker</code> çš„åŒ…ä¸­ï¼Œä½äº <code>src/</code> ç›®å½•ä¸­ã€‚ <code>constraints.txt</code> æ–‡ä»¶å°†æŒ‡å®šé¡¹ç›®ä¾èµ–é¡¹çš„å›ºå®šç‰ˆæœ¬ï¼Œä»¥å®ç°å¯<a href="https://pip.pypa.io/en/stable/topics/repeatable-installs/">é‡å¤å®‰è£…</a>ã€‚</p>
<p>è¯¥é¡¹ç›®å°†ä¾èµ–äºä¸¤ä¸ªå¤–éƒ¨åº“ï¼Œ <a href="https://pypi.org/project/Flask/">Flask</a> å’Œ <a href="https://pypi.org/project/redis/">Redis</a> ï¼Œæ‚¨å¯ä»¥åœ¨ <code>pyproject.toml</code> æ–‡ä»¶ä¸­å£°æ˜å®ƒä»¬ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-toml" data-lang="toml"><span class="line"><span class="cl"><span class="c"># pyproject.toml</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="nx">build-system</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">requires</span> <span class="p">=</span> <span class="p">[</span><span class="s2">&#34;setuptools&gt;=67.0.0&#34;</span><span class="p">,</span> <span class="s2">&#34;wheel&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">build-backend</span> <span class="p">=</span> <span class="s2">&#34;setuptools.build_meta&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="nx">project</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">name</span> <span class="p">=</span> <span class="s2">&#34;page-tracker&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">version</span> <span class="p">=</span> <span class="s2">&#34;1.0.0&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">dependencies</span> <span class="p">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Flask&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;redis&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><p>è¯·æ³¨æ„ï¼Œæ‚¨é€šå¸¸ä¸ä¼šåœ¨æ­¤å¤„æŒ‡å®šä¾èµ–é¡¹ç‰ˆæœ¬ã€‚ç›¸åï¼Œæ‚¨å¯ä»¥å°†å®ƒä»¬ä¸<a href="https://pip.pypa.io/en/stable/user_guide/#requirements-files">éœ€æ±‚</a>æˆ–<a href="https://pip.pypa.io/en/stable/user_guide/#constraints-files">çº¦æŸæ–‡ä»¶</a>ä¸­çš„ä»»ä½•<a href="https://en.wikipedia.org/wiki/Transitive_dependency">ä¼ é€’ä¾èµ–é¡¹</a>ä¸€èµ·<a href="https://pip.pypa.io/en/stable/cli/pip_freeze/#pip-freeze">å†»ç»“</a>ã€‚ç¬¬ä¸€ä¸ªå‘Šè¯‰ <code>pip</code> è¦å®‰è£…ä»€ä¹ˆåŒ…ï¼Œåè€…å¼ºåˆ¶æ‰§è¡Œä¼ é€’ä¾èµ–é¡¹çš„ç‰¹å®šåŒ…ç‰ˆæœ¬ï¼Œç±»ä¼¼äº <a href="https://realpython.com/pipenv-guide/">Pipenv</a> æˆ– <a href="https://realpython.com/dependency-management-python-poetry/">Poetry</a> é”å®šæ–‡ä»¶ã€‚</p>
<p>è¦ç”Ÿæˆçº¦æŸæ–‡ä»¶ï¼Œæ‚¨å¿…é¡»é¦–å…ˆå°†æ‚¨çš„ <code>page-tracker</code> é¡¹ç›®å®‰è£…åˆ°æ´»åŠ¨çš„è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œè¿™å°†ä» <a href="https://pypi.org/">Python åŒ…ç´¢å¼• (PyPI)</a> ä¸­è·å–æ‰€éœ€çš„å¤–éƒ¨åº“ã€‚ç¡®ä¿æ‚¨å·²ç»åˆ›å»ºäº†æ‰€éœ€çš„æ–‡ä»¶å¤¹ç»“æ„ï¼Œç„¶åå‘å‡ºä»¥ä¸‹å‘½ä»¤ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ python -m pip install --editable .
</span></span><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ python -m pip freeze --exclude-editable &gt; constraints.txt
</span></span></code></pre></div><p>å³ä½¿æ‚¨è¿˜æ²¡æœ‰è¾“å…¥ä¸€è¡Œä»£ç ï¼ŒPython ä¹Ÿä¼šè¯†åˆ«å¹¶å®‰è£…æ‚¨çš„åŒ…å ä½ç¬¦ã€‚å› ä¸ºæ‚¨çš„åŒ…éµå¾ª <code>src</code> å¸ƒå±€ï¼Œæ‰€ä»¥åœ¨å¼€å‘æœŸé—´ä»¥<a href="https://setuptools.pypa.io/en/latest/userguide/development_mode.html">å¯ç¼–è¾‘æ¨¡å¼</a>å®‰è£…å®ƒå¾ˆæ–¹ä¾¿ã€‚è¿™å°†å…è®¸æ‚¨æ›´æ”¹æºä»£ç å¹¶ç«‹å³å°†å®ƒä»¬åæ˜ åœ¨è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œè€Œæ— éœ€é‡æ–°å®‰è£…ã€‚ä½†æ˜¯ï¼Œæ‚¨æƒ³ä»çº¦æŸæ–‡ä»¶ä¸­æ’é™¤å¯ç¼–è¾‘åŒ…ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå¦‚æœæ‚¨æ‰“ç®—å…±äº«æ‚¨çš„é¡¹ç›®ï¼Œç”Ÿæˆçš„çº¦æŸæ–‡ä»¶éå¸¸æœ‰ä»·å€¼ã€‚è¿™æ„å‘³ç€å…¶ä»–äººå¯ä»¥åœ¨ä»–ä»¬çš„ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥é‡ç°ä¸æ‚¨ç›¸åŒçš„ç¯å¢ƒï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ python -m pip install -c constraints.txt .
</span></span></code></pre></div><p>å› ä¸ºæ‚¨é€šè¿‡ <code>-c</code> é€‰é¡¹æä¾›äº†ä¸€ä¸ªçº¦æŸæ–‡ä»¶ï¼Œ <code>pip</code> å®‰è£…äº†å›ºå®šçš„ä¾èµ–é¡¹è€Œä¸æ˜¯æœ€æ–°çš„å¯ç”¨ä¾èµ–é¡¹ã€‚è¿™æ„å‘³ç€æ‚¨æœ‰å¯é‡å¤çš„å®‰è£…ã€‚ç¨åæ‚¨å°†ä½¿ç”¨ç±»ä¼¼çš„å‘½ä»¤æ¥æ„å»º Docker é•œåƒã€‚</p>
</blockquote>
<p>å¥½çš„ã€‚æ‚¨å‡ ä¹å·²ç»å‡†å¤‡å¥½å¼€å§‹ç¼–å†™æ‚¨çš„ Flask Web åº”ç”¨ç¨‹åºäº†ã€‚åœ¨æ‰§è¡Œæ­¤æ“ä½œä¹‹å‰ï¼Œæ‚¨å°†åˆ‡æ¢ä¸€ä¸‹æ–¹å¼å¹¶å‡†å¤‡ä¸€ä¸ªæœ¬åœ° Redis æœåŠ¡å™¨ä»¥é€šè¿‡ç½‘ç»œè¿æ¥ã€‚</p>
<h3 id="é€šè¿‡-docker-è¿è¡Œ-redis-æœåŠ¡å™¨">é€šè¿‡ Docker è¿è¡Œ Redis æœåŠ¡å™¨</h3>
<p>Redis è¿™ä¸ªåå­—æ˜¯å•è¯è¿œç¨‹å­—å…¸æœåŠ¡å™¨çš„åˆæˆè¯ï¼Œå®ƒéå¸¸å‡†ç¡®åœ°è¡¨è¾¾äº†å®ƒä½œä¸ºè¿œç¨‹å†…å­˜æ•°æ®ç»“æ„å­˜å‚¨çš„ç›®çš„ã€‚ä½œä¸ºä¸€ä¸ªé”®å€¼å­˜å‚¨ï¼ŒRedis å°±åƒä¸€ä¸ªè¿œç¨‹ <a href="https://realpython.com/python-dicts/">Python å­—å…¸</a>ï¼Œæ‚¨å¯ä»¥ä»ä»»ä½•åœ°æ–¹è¿æ¥åˆ°å®ƒã€‚å®ƒä¹Ÿè¢«è®¤ä¸ºæ˜¯åœ¨è®¸å¤šä¸åŒç¯å¢ƒä¸­ä½¿ç”¨çš„æœ€æµè¡Œçš„ NoSQL æ•°æ®åº“ä¹‹ä¸€ã€‚é€šå¸¸ï¼Œå®ƒç”¨äºå…³ç³»æ•°æ®åº“ä¹‹ä¸Šçš„<a href="https://realpython.com/caching-in-django-with-redis/">ç¼“å­˜</a>ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šè™½ç„¶ Redis å°†å…¶æ‰€æœ‰æ•°æ®ä¿å­˜åœ¨æ˜“å¤±æ€§å†…å­˜ä¸­ï¼Œè¿™ä½¿å…¶é€Ÿåº¦æå¿«ï¼Œä½†è¯¥æœåŠ¡å™¨å…·æœ‰å¤šç§æŒä¹…æ€§é€‰é¡¹ã€‚åœ¨æ–­ç”µæˆ–é‡å¯çš„æƒ…å†µä¸‹ï¼Œå®ƒä»¬å¯ä»¥ç¡®ä¿ä¸åŒçº§åˆ«çš„æ•°æ®æŒä¹…æ€§ã€‚ç„¶è€Œï¼Œæ­£ç¡®é…ç½® Redis é€šå¸¸å¾ˆå›°éš¾ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆè®¸å¤šå›¢é˜Ÿå†³å®šä½¿ç”¨å¤–åŒ…ç»™äº‘æä¾›å•†çš„æ‰˜ç®¡æœåŠ¡çš„åŸå› ã€‚</p>
</blockquote>
<p>åœ¨æ‚¨çš„è®¡ç®—æœºä¸Šå®‰è£… Redis éå¸¸ç®€å•ï¼Œä½†å‡è®¾æ‚¨ä¹‹å‰å·²ç»å®‰è£…å’Œé…ç½®äº† Dockerï¼Œé€šè¿‡ Docker è¿è¡Œå®ƒä¼šæ›´åŠ ç®€å•å’Œä¼˜é›…ã€‚å½“æ‚¨åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œè¯¸å¦‚ Redis ä¹‹ç±»çš„æœåŠ¡æ—¶ï¼Œå®ƒä¼šä¸ç³»ç»Ÿçš„å…¶ä½™éƒ¨åˆ†ä¿æŒéš”ç¦»ï¼Œè€Œä¸ä¼šé€ æˆæ··ä¹±æˆ–å ç”¨æœ‰é™çš„ç½‘ç»œç«¯å£å·ç­‰ç³»ç»Ÿèµ„æºã€‚</p>
<p>è¦åœ¨ä¸å°† Redis å®‰è£…åœ¨ä¸»æœºä¸Šçš„æƒ…å†µä¸‹è¿è¡Œ Redisï¼Œæ‚¨å¯ä»¥é€šè¿‡è°ƒç”¨ä»¥ä¸‹å‘½ä»¤ä»<a href="https://hub.docker.com/_/redis">å®˜æ–¹ Redis é•œåƒ</a>è¿è¡Œæ–°çš„ Docker å®¹å™¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker run -d --name redis-server redis
</span></span><span class="line"><span class="cl">Unable to find image <span class="s1">&#39;redis:latest&#39;</span> locally
</span></span><span class="line"><span class="cl">latest: Pulling from library/redis
</span></span><span class="line"><span class="cl">26c5c85e47da: Pull <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">39f79586dcf2: Pull <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">79c71d0520e5: Pull <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">60e988668ca1: Pull <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">873c3fc9fdc6: Pull <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">50ce7f9bf183: Pull <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">Digest: sha256:f50031a49f41e493087fb95f96fdb3523bb25dcf6a3f0b07c588ad3cdb...
</span></span><span class="line"><span class="cl">Status: Downloaded newer image <span class="k">for</span> redis:latest
</span></span><span class="line"><span class="cl">09b9842463c78a2e9135add810aba6c4573fb9e2155652a15310009632c40ea8
</span></span></code></pre></div><p>è¿™å°†åŸºäºæœ€æ–°ç‰ˆæœ¬çš„ <code>redis</code> é•œåƒåˆ›å»ºä¸€ä¸ªæ–°çš„ Docker å®¹å™¨ï¼Œè‡ªå®šä¹‰åç§°ä¸º <code>redis-server</code> ï¼Œç¨åæ‚¨å°†å¼•ç”¨å®ƒã€‚å®¹å™¨ä»¥åˆ†ç¦»æ¨¡å¼ ( <code>-d</code> ) åœ¨åå°è¿è¡Œã€‚å½“æ‚¨ç¬¬ä¸€æ¬¡è¿è¡Œæ­¤å‘½ä»¤æ—¶ï¼ŒDocker ä¼šä» Docker Hub ä¸­æ‹‰å–ç›¸åº”çš„ Docker é•œåƒï¼Œè¿™æ˜¯ Docker é•œåƒçš„å®˜æ–¹å­˜å‚¨åº“ï¼Œç±»ä¼¼äº PyPIã€‚</p>
<p>åªè¦ä¸€åˆ‡æŒ‰è®¡åˆ’è¿›è¡Œï¼Œæ‚¨çš„ Redis æœåŠ¡å™¨å°±åº”è¯¥å¯åŠ¨å¹¶è¿è¡Œã€‚å› ä¸ºæ‚¨ä»¥åˆ†ç¦»æ¨¡å¼ ( <code>-d</code> ) å¯åŠ¨äº†å®¹å™¨ï¼Œæ‰€ä»¥å®ƒå°†åœ¨åå°ä¿æŒæ´»åŠ¨çŠ¶æ€ã€‚è¦éªŒè¯è¿™ä¸€ç‚¹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>docker container ls</code> å‘½ä»¤æˆ–ç­‰æ•ˆçš„ <code>docker ps</code> åˆ«ååˆ—å‡ºæ‚¨çš„ Docker å®¹å™¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker ps
</span></span><span class="line"><span class="cl">CONTAINER ID   IMAGE   ...   STATUS              PORTS      NAMES
</span></span><span class="line"><span class="cl">09b9842463c7   redis   ...   Up About a minute   6379/tcp   redis-server
</span></span></code></pre></div><p>åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ä¸€ä¸ª ID å‰ç¼€ä¸æ‚¨åœ¨è¿è¡Œ <code>docker run</code> å‘½ä»¤æ—¶è·å¾—çš„ ID å‰ç¼€åŒ¹é…çš„å®¹å™¨ä»å¤§çº¦ä¸€åˆ†é’Ÿå‰å¼€å§‹å¯åŠ¨ã€‚è¯¥å®¹å™¨åŸºäº <code>redis</code> é•œåƒï¼Œå·²å‘½åä¸º <code>redis-server</code> ï¼Œå¹¶ä½¿ç”¨TCP ç«¯å£å· <code>6379</code> ï¼Œè¿™æ˜¯Redis çš„é»˜è®¤ç«¯å£ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæ‚¨å°†å°è¯•ä»¥å„ç§æ–¹å¼è¿æ¥åˆ°è¯¥ Redis æœåŠ¡å™¨ã€‚</p>
<h3 id="æµ‹è¯•ä¸-redis-çš„è¿æ¥">æµ‹è¯•ä¸ Redis çš„è¿æ¥</h3>
<p>åœ¨ Docker Hub ä¸Šå®˜æ–¹ Redis é•œåƒçš„æ¦‚è¿°é¡µé¢ä¸Šï¼Œæ‚¨å°†æ‰¾åˆ°æœ‰å…³å¦‚ä½•è¿æ¥åˆ°åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œçš„ Redis æœåŠ¡å™¨çš„è¯´æ˜ã€‚å…·ä½“è€Œè¨€ï¼Œæ­¤é¡µé¢è®¨è®ºäº†å¦‚ä½•ä½¿ç”¨ Docker é•œåƒé™„å¸¦çš„ä¸“ç”¨äº¤äº’å¼å‘½ä»¤è¡Œç•Œé¢ Redis CLI ã€‚</p>
<p>æ‚¨å¯ä»¥ä»åŒä¸€ä¸ª <code>redis</code> é•œåƒå¯åŠ¨å¦ä¸€ä¸ª Docker å®¹å™¨ï¼Œä½†è¿™ä¸€æ¬¡ï¼Œå°†å®¹å™¨çš„å…¥å£ç‚¹è®¾ç½®ä¸º <code>redis-cli</code> å‘½ä»¤è€Œä¸æ˜¯é»˜è®¤çš„ Redis æœåŠ¡å™¨äºŒè¿›åˆ¶æ–‡ä»¶ã€‚å½“æ‚¨è®¾ç½®å¤šä¸ªå®¹å™¨ä¸€èµ·å·¥ä½œæ—¶ï¼Œæ‚¨åº”è¯¥ä½¿ç”¨ Docker ç½‘ç»œï¼Œè¿™éœ€è¦ä¸€äº›é¢å¤–çš„é…ç½®æ­¥éª¤ã€‚</p>
<p>é¦–å…ˆï¼Œæ–°å»ºä¸€ä¸ªä»¥ä½ çš„é¡¹ç›®å‘½åçš„è‡ªå®šä¹‰æ¡¥æ¥ç½‘ç»œï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker network create page-tracker-network
</span></span><span class="line"><span class="cl">c942131265bf097da294edbd2ac375cd5410d6f0d87e250041827c68a3197684
</span></span></code></pre></div><p>é€šè¿‡å®šä¹‰è¿™æ ·çš„è™šæ‹Ÿç½‘ç»œï¼Œæ‚¨å¯ä»¥è¿æ¥ä»»æ„æ•°é‡çš„ Docker å®¹å™¨ï¼Œå¹¶è®©å®ƒä»¬é€šè¿‡æè¿°æ€§åç§°ç›¸äº’å‘ç°ã€‚æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆ—å‡ºæ‚¨åˆ›å»ºçš„ç½‘ç»œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker network ls
</span></span><span class="line"><span class="cl">NETWORK ID     NAME                   DRIVER    SCOPE
</span></span><span class="line"><span class="cl">1bf8d998500e   bridge                 bridge    <span class="nb">local</span>
</span></span><span class="line"><span class="cl">d5cffd6ea76f   host                   host      <span class="nb">local</span>
</span></span><span class="line"><span class="cl">a85d88fc3abe   none                   null      <span class="nb">local</span>
</span></span><span class="line"><span class="cl">c942131265bf   page-tracker-network   bridge    <span class="nb">local</span>
</span></span></code></pre></div><p>æ¥ä¸‹æ¥ï¼Œå°†ç°æœ‰çš„ <code>redis-server</code> å®¹å™¨è¿æ¥åˆ°è¿™ä¸ªæ–°çš„è™šæ‹Ÿç½‘ç»œï¼Œå¹¶åœ¨å¯åŠ¨ç›¸åº”å®¹å™¨æ—¶ä¸º Redis CLI æŒ‡å®šç›¸åŒçš„ç½‘ç»œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker network connect page-tracker-network redis-server
</span></span><span class="line"><span class="cl">$ docker run --rm -it <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>             --name redis-client <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>             --network page-tracker-network <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>             redis redis-cli -h redis-server
</span></span></code></pre></div><p><code>--rm</code> æ ‡å¿—å‘Šè¯‰ Docker åœ¨æ‚¨ç»ˆæ­¢å®ƒåç«‹å³åˆ é™¤åˆ›å»ºçš„å®¹å™¨ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªæ‚¨ä¸éœ€è¦å†æ¬¡å¯åŠ¨çš„ä¸´æ—¶æˆ–ä¸´æ—¶å®¹å™¨ã€‚ <code>-i</code> å’Œ <code>-t</code> æ ‡å¿—ï¼Œç¼©å†™ä¸º <code>-it</code> ï¼Œä»¥äº¤äº’æ–¹å¼è¿è¡Œå®¹å™¨ï¼Œè®©æ‚¨é€šè¿‡è¿æ¥åˆ°ç»ˆç«¯çš„æ ‡å‡†æµæ¥é”®å…¥å‘½ä»¤ã€‚ä½¿ç”¨ <code>--name</code> é€‰é¡¹ï¼Œæ‚¨å¯ä»¥ä¸ºæ–°å®¹å™¨æŒ‡å®šä¸€ä¸ªæè¿°æ€§åç§°ã€‚</p>
<p><code>--network</code> é€‰é¡¹å°†ä½ çš„æ–° <code>redis-client</code> å®¹å™¨è¿æ¥åˆ°ä¹‹å‰åˆ›å»ºçš„è™šæ‹Ÿç½‘ç»œï¼Œå…è®¸å®ƒä¸ <code>redis-server</code> å®¹å™¨é€šä¿¡ã€‚è¿™æ ·ï¼Œä¸¤ä¸ªå®¹å™¨éƒ½å°†æ”¶åˆ°ä¸ <code>--name</code> é€‰é¡¹ç»™å®šçš„åç§°ç›¸å¯¹åº”çš„ä¸»æœºåã€‚è¯·æ³¨æ„ï¼Œé€šè¿‡ä½¿ç”¨ <code>-h</code> å‚æ•°ï¼Œæ‚¨å‘Šè¯‰ Redis CLI è¿æ¥åˆ°ç”±å…¶å®¹å™¨åç§°æ ‡è¯†çš„ Redis æœåŠ¡å™¨ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šæœ‰ä¸€ç§æ›´å¿«çš„æ–¹æ³•å¯ä»¥é€šè¿‡è™šæ‹Ÿç½‘ç»œè¿æ¥ä¸¤ä¸ªå®¹å™¨ï¼Œè€Œæ— éœ€æ˜¾å¼åˆ›å»ºå®¹å™¨ã€‚æ‚¨å¯ä»¥åœ¨è¿è¡Œæ–°å®¹å™¨æ—¶æŒ‡å®š <code>--link</code> é€‰é¡¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker run --rm -it <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>             --name redis-client <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>             --link redis-server:redis-client <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>             redis redis-cli -h redis-server
</span></span></code></pre></div><p>ä½†æ˜¯ï¼Œæ­¤é€‰é¡¹å·²è¢«å¼ƒç”¨ï¼Œå¹¶ä¸”å¯èƒ½ä¼šåœ¨æŸä¸ªæ—¶å€™ä» Docker ä¸­åˆ é™¤ã€‚</p>
</blockquote>
<p>å½“æ‚¨çš„æ–° Docker å®¹å™¨å¯åŠ¨æ—¶ï¼Œæ‚¨å°†è¿›å…¥ä¸€ä¸ªäº¤äº’å¼ Redis CLIï¼Œå®ƒç±»ä¼¼äºå¸¦æœ‰ä»¥ä¸‹æç¤ºçš„ Python REPLï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">redis-server:6379&gt; SET pi 3.14
</span></span><span class="line"><span class="cl">OK
</span></span><span class="line"><span class="cl">redis-server:6379&gt; GET pi
</span></span><span class="line"><span class="cl"><span class="s2">&#34;3.14&#34;</span>
</span></span><span class="line"><span class="cl">redis-server:6379&gt; DEL pi
</span></span><span class="line"><span class="cl"><span class="o">(</span>integer<span class="o">)</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">redis-server:6379&gt; KEYS *
</span></span><span class="line"><span class="cl"><span class="o">(</span>empty array<span class="o">)</span>
</span></span></code></pre></div><p>åœ¨é‚£é‡Œï¼Œæ‚¨å¯ä»¥æµ‹è¯•ä¸€äº› Redis å‘½ä»¤ï¼Œä¾‹å¦‚ï¼Œè®¾ç½®é”®å€¼å¯¹ã€è·å–ç›¸åº”é”®çš„å€¼ã€åˆ é™¤è¯¥é”®å€¼å¯¹æˆ–æ£€ç´¢å½“å‰å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸­çš„æ‰€æœ‰é”®çš„åˆ—è¡¨ã€‚è¦é€€å‡ºäº¤äº’å¼ Redis CLIï¼Œè¯·æŒ‰é”®ç›˜ä¸Šçš„ Ctrl+Cã€‚</p>
<blockquote>
<p>å¦‚æœæ‚¨å®‰è£…äº† Docker Desktopï¼Œé‚£ä¹ˆåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®ƒä¸ä¼šå°†æµé‡ä»æ‚¨çš„ä¸»æœºè·¯ç”±åˆ°å®¹å™¨ã€‚ä½ çš„æœ¬åœ°ç½‘ç»œå’Œé»˜è®¤çš„ Docker ç½‘ç»œä¹‹é—´æ²¡æœ‰è¿æ¥ï¼š</p>
<ul>
<li>
<p>Docker Desktop for Mac æ— æ³•å°†æµé‡è·¯ç”±åˆ°å®¹å™¨ã€‚</p>
</li>
<li>
<p>é€‚ç”¨äº Windows çš„ Docker Desktop æ— æ³•å°†æµé‡è·¯ç”±åˆ° Linux å®¹å™¨ã€‚ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥å¯¹ Windows å®¹å™¨æ‰§è¡Œ ping æ“ä½œã€‚</p>
</li>
</ul>
<p>Linux ä¸Šçš„ Docker Desktop ä¹Ÿæ˜¯å¦‚æ­¤ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ Docker å¼•æ“æˆ–åœ¨ Windows ä¸»æœºä¸Šè¿è¡Œ Windows å®¹å™¨ï¼Œé‚£ä¹ˆæ‚¨å°†èƒ½å¤Ÿé€šè¿‡å®ƒä»¬çš„ IP åœ°å€è®¿é—®è¿™äº›å®¹å™¨ã€‚</p>
<p>å› æ­¤ï¼Œæœ‰æ—¶æ‚¨å¯ä»¥ç›´æ¥ä»ä¸»æœºä¸ Redis æœåŠ¡å™¨é€šä¿¡ã€‚é¦–å…ˆï¼Œæ‰¾å‡ºå¯¹åº”çš„Dockerå®¹å™¨çš„IPåœ°å€ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker inspect redis-server <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -f <span class="s1">&#39;{{range .NetworkSettings.Networks}}{{.IPAddress}}{{println}}{{end}}&#39;</span>
</span></span><span class="line"><span class="cl">172.17.0.2
</span></span><span class="line"><span class="cl">172.18.0.2
</span></span></code></pre></div><p>å¦‚æœæ‚¨çœ‹åˆ°å¤šä¸ª IP åœ°å€ï¼Œåˆ™è¡¨ç¤ºæ‚¨çš„å®¹å™¨è¿æ¥åˆ°å¤šä¸ªç½‘ç»œã€‚å½“æ‚¨å¯åŠ¨å®¹å™¨æ—¶ï¼Œå®¹å™¨ä¼šè‡ªåŠ¨è¿æ¥åˆ°é»˜è®¤çš„ Docker ç½‘ç»œã€‚</p>
<p>è®°ä¸‹å…¶ä¸­ä¸€ä¸ªåœ°å€ï¼Œæ‚¨å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚ç°åœ¨ï¼Œæ‚¨å¯ä»¥å°†æ­¤ IP åœ°å€ç”¨ä½œ <code>-h</code> å‚æ•°çš„å€¼ï¼Œè€Œä¸æ˜¯ <code>redis-cli</code> ä¸­çš„é“¾æ¥å®¹å™¨åç§°ã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨æ­¤ IP åœ°å€é€šè¿‡ <code>netcat</code> æˆ– Telnet å®¢æˆ·ç«¯è¿æ¥åˆ° Redisï¼Œä¾‹å¦‚ PuTTY æˆ– <code>telnet</code> å‘½ä»¤ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ telnet 172.17.0.2 <span class="m">6379</span>
</span></span><span class="line"><span class="cl">Trying 172.17.0.2...
</span></span><span class="line"><span class="cl">Connected to 172.17.0.2.
</span></span><span class="line"><span class="cl">Escape character is <span class="s1">&#39;^]&#39;</span>.
</span></span><span class="line"><span class="cl">SET pi 3.14
</span></span><span class="line"><span class="cl">+OK
</span></span><span class="line"><span class="cl">GET pi
</span></span><span class="line"><span class="cl"><span class="nv">$4</span>
</span></span><span class="line"><span class="cl">3.14
</span></span><span class="line"><span class="cl">DEL pi
</span></span><span class="line"><span class="cl">:1
</span></span><span class="line"><span class="cl">KEYS *
</span></span><span class="line"><span class="cl">*0
</span></span><span class="line"><span class="cl">^<span class="o">]</span>
</span></span><span class="line"><span class="cl">telnet&gt; Connection closed.
</span></span></code></pre></div><p>è¯·è®°ä½æä¾›é»˜è®¤ä¸º <code>6379</code> çš„ç«¯å£å·ï¼ŒRedis ä¼šåœ¨è¯¥ç«¯å£ä¸Šä¾¦å¬ä¼ å…¥è¿æ¥ã€‚æ‚¨å¯ä»¥åœ¨æ­¤å¤„ä»¥æ˜æ–‡å½¢å¼é”®å…¥ Redis å‘½ä»¤ï¼Œå› ä¸ºæœåŠ¡å™¨ä½¿ç”¨æœªåŠ å¯†çš„åè®®ï¼Œé™¤éæ‚¨åœ¨é…ç½®ä¸­æ˜ç¡®å¯ç”¨ TLS æ”¯æŒã€‚</p>
</blockquote>
<p>æœ€åï¼Œæ‚¨å¯ä»¥åˆ©ç”¨ç«¯å£æ˜ å°„ä½¿ Redis åœ¨ Docker å®¹å™¨ä¹‹å¤–å¯ç”¨ã€‚åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ‚¨å°†å¸Œæœ›ç›´æ¥è¿æ¥åˆ° Redisï¼Œè€Œä¸æ˜¯é€šè¿‡æ¥è‡ªå¦ä¸€ä¸ªå®¹å™¨çš„è™šæ‹Ÿç½‘ç»œï¼Œå› æ­¤æ‚¨ä¸å¿…å°†å®ƒè¿æ¥åˆ°ä»»ä½•ç½‘ç»œã€‚</p>
<p>è¦ä½¿ç”¨ç«¯å£æ˜ å°„ï¼Œè¯·åœæ­¢å¹¶åˆ é™¤ç°æœ‰çš„ <code>redis-server</code> ï¼Œç„¶åä½¿ç”¨å®šä¹‰å¦‚ä¸‹çš„ <code>-p</code> é€‰é¡¹è¿è¡Œä¸€ä¸ªæ–°å®¹å™¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker stop redis-server
</span></span><span class="line"><span class="cl">$ docker rm redis-server
</span></span><span class="line"><span class="cl">$ docker run -d --name redis-server -p 6379:6379 redis
</span></span></code></pre></div><p>å†’å·å·¦è¾¹çš„æ•°å­—ï¼ˆ <code>:</code> ï¼‰ä»£è¡¨ä¸»æœºæˆ–ä½ ç”µè„‘ä¸Šçš„ç«¯å£å·ï¼Œè€Œå³è¾¹çš„æ•°å­—ä»£è¡¨å³å°†è¿è¡Œçš„Dockerå®¹å™¨å†…çš„æ˜ å°„ç«¯å£ã€‚</p>
<p>åœ¨ä¸¤ä¾§ä½¿ç”¨ç›¸åŒçš„ç«¯å£å·å¯ä»¥æœ‰æ•ˆåœ°è½¬å‘å®ƒï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥è¿æ¥åˆ° Redisï¼Œå°±åƒå®ƒåœ¨æ‚¨çš„è®¡ç®—æœºä¸Šæœ¬åœ°è¿è¡Œä¸€æ ·ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ telnet localhost <span class="m">6379</span>
</span></span><span class="line"><span class="cl">Trying 127.0.0.1...
</span></span><span class="line"><span class="cl">Connected to localhost.
</span></span><span class="line"><span class="cl">Escape character is <span class="s1">&#39;^]&#39;</span>.
</span></span><span class="line"><span class="cl">INCR page_views
</span></span><span class="line"><span class="cl">:1
</span></span><span class="line"><span class="cl">INCR page_views
</span></span><span class="line"><span class="cl">:2
</span></span><span class="line"><span class="cl">INCR page_views
</span></span><span class="line"><span class="cl">:3
</span></span><span class="line"><span class="cl">^<span class="o">]</span>
</span></span><span class="line"><span class="cl">telnet&gt; Connection closed.
</span></span></code></pre></div><p>è¿æ¥åˆ°ç°åœ¨åœ¨æœ¬åœ°ä¸»æœºå’Œé»˜è®¤ç«¯å£ä¸Šå¯è§çš„ Redis åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>INCR</code> å‘½ä»¤å¢åŠ é¡µé¢æµè§ˆé‡ã€‚å¦‚æœåº•å±‚é”®å°šä¸å­˜åœ¨ï¼Œåˆ™ Redis å°†ä½¿ç”¨å€¼ <code>1</code> å¯¹å…¶è¿›è¡Œåˆå§‹åŒ–ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå¦‚æœæ‚¨åœ¨æœ¬åœ°å®‰è£…äº† Redisï¼Œæˆ–è€…æŸäº›ç³»ç»Ÿè¿›ç¨‹ä¹Ÿåœ¨æ‚¨çš„ä¸»æœºä¸Šä½¿ç”¨ç«¯å£ <code>6379</code> ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦ä½¿ç”¨æœªå ç”¨çš„ç«¯å£ä»¥ä¸åŒæ–¹å¼æ˜ å°„æ‚¨çš„ç«¯å£å·ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker run -d --name redis-server -p 9736:6379 redis
</span></span></code></pre></div><p>è¿™å°†å…è®¸æ‚¨è¿æ¥åˆ°ç«¯å£ <code>9736</code> ä¸Šçš„æœ¬åœ°ä¸»æœºï¼ˆå¦‚æœè¯¥ç«¯å£å°šæœªè¢«å…¶ä»–æœåŠ¡å ç”¨ï¼‰ã€‚åªè¦å¯ç”¨ï¼Œä½¿ç”¨å“ªä¸ªç«¯å£å¹¶ä¸é‡è¦ã€‚</p>
</blockquote>
<p>ç°åœ¨æ‚¨å·²ç»çŸ¥é“å¦‚ä½•ä»å‘½ä»¤è¡Œè¿æ¥åˆ° Redisï¼Œæ‚¨å¯ä»¥ç»§ç»­çœ‹çœ‹å¦‚ä½•é€šè¿‡ Python ç¨‹åºæ‰§è¡Œç›¸åŒçš„æ“ä½œã€‚</p>
<h3 id="ä»-python-è¿æ¥åˆ°-redis">ä» Python è¿æ¥åˆ° Redis</h3>
<p>æ­¤æ—¶ï¼Œæ‚¨æœ‰ä¸€ä¸ªåœ¨ Docker å®¹å™¨ä¸­è¿è¡Œçš„ Redis æœåŠ¡å™¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Redis çš„é»˜è®¤ç«¯å£å·åœ¨æœ¬åœ°ä¸»æœºä¸Šè®¿é—®å®ƒã€‚</p>
<p>å¦‚æœæ‚¨æƒ³äº†è§£æœ‰å…³æ‚¨çš„å®¹å™¨æˆ–ä»»ä½•å…¶ä»– Docker èµ„æºçš„æ›´å¤šä¿¡æ¯ï¼Œé‚£ä¹ˆæ‚¨å§‹ç»ˆå¯ä»¥é€šè¿‡æ£€æŸ¥æ‰‹å¤´çš„å¯¹è±¡æ¥æ£€ç´¢æœ‰ä»·å€¼çš„ä¿¡æ¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker inspect redis-server
</span></span><span class="line"><span class="cl"><span class="o">[</span>
</span></span><span class="line"><span class="cl">    <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Id&#34;</span>: <span class="s2">&#34;09b9842463c78a2e9135add810aba6...2a15310009632c40ea8&#34;</span>,
</span></span><span class="line"><span class="cl">        â‹®
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;NetworkSettings&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">            â‹®
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Ports&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;6379/tcp&#34;</span>: null
</span></span><span class="line"><span class="cl">            <span class="o">}</span>,
</span></span><span class="line"><span class="cl">            â‹®
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;IPAddress&#34;</span>: <span class="s2">&#34;172.17.0.2&#34;</span>,
</span></span><span class="line"><span class="cl">            â‹®
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">]</span>
</span></span></code></pre></div><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨è¦è¯¢é—®æœ‰å…³ <code>redis-server</code> å®¹å™¨çš„ä¿¡æ¯ï¼Œå…¶ä¸­åŒ…æ‹¬å¤§é‡è¯¦ç»†ä¿¡æ¯ï¼Œä¾‹å¦‚å®¹å™¨çš„ç½‘ç»œé…ç½®ã€‚ <code>docker inspect</code> å‘½ä»¤é»˜è®¤è¿”å› JSON æ ¼å¼çš„æ•°æ®ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Go æ¨¡æ¿è¿›ä¸€æ­¥è¿‡æ»¤ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæ‰“å¼€ç»ˆç«¯ï¼Œæ¿€æ´»é¡¹ç›®çš„è™šæ‹Ÿç¯å¢ƒï¼Œå¹¶å¯åŠ¨ä¸€ä¸ªæ–°çš„ Python REPLï¼š</p>
<p>Windowsï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">PS&gt; venv<span class="se">\S</span>cripts<span class="se">\a</span>ctivate
</span></span><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> PS&gt; python
</span></span></code></pre></div><p>Linux + MacOSï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="nb">source</span> venv/bin/activate
</span></span><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ python
</span></span></code></pre></div><p>å‡è®¾æ‚¨ä¹‹å‰åœ¨æ­¤è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…äº† <code>redis</code> åŒ…ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿå¯¼å…¥ Python çš„ Redis å®¢æˆ·ç«¯å¹¶è°ƒç”¨å…¶ä¸­ä¸€ç§æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">redis</span> <span class="kn">import</span> <span class="n">Redis</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">redis</span> <span class="o">=</span> <span class="n">Redis</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">redis</span><span class="o">.</span><span class="n">incr</span><span class="p">(</span><span class="s2">&#34;page_views&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">redis</span><span class="o">.</span><span class="n">incr</span><span class="p">(</span><span class="s2">&#34;page_views&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">5</span>
</span></span></code></pre></div><p>å½“æ‚¨åœ¨ä¸æŒ‡å®šä»»ä½•å‚æ•°çš„æƒ…å†µä¸‹åˆ›å»ºæ–°çš„ <code>Redis</code> å®ä¾‹æ—¶ï¼Œå®ƒå°†å°è¯•è¿æ¥åˆ°åœ¨æœ¬åœ°ä¸»æœºå’Œé»˜è®¤ç«¯å£ <code>6379</code> ä¸Šè¿è¡Œçš„ Redis æœåŠ¡å™¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè°ƒç”¨ <code>.incr()</code> ç¡®è®¤æ‚¨å·²æˆåŠŸä¸ä½äº Docker å®¹å™¨ä¸­çš„ Redis å»ºç«‹è¿æ¥ï¼Œå› ä¸ºå®ƒè®°ä½äº† <code>page_views</code> é”®çš„æœ€åä¸€ä¸ªå€¼ã€‚</p>
<p>å¦‚æœæ‚¨éœ€è¦è¿æ¥åˆ°ä½äºè¿œç¨‹è®¡ç®—æœºä¸Šçš„ Redisï¼Œè¯·æä¾›è‡ªå®šä¹‰ä¸»æœºå’Œç«¯å£å·ä½œä¸ºå‚æ•°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">redis</span> <span class="kn">import</span> <span class="n">Redis</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">redis</span> <span class="o">=</span> <span class="n">Redis</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&#34;127.0.0.1&#34;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">redis</span><span class="o">.</span><span class="n">incr</span><span class="p">(</span><span class="s2">&#34;page_views&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">6</span>
</span></span></code></pre></div><p>è¯·æ³¨æ„ï¼Œæ‚¨åº”è¯¥å°†ç«¯å£å·ä½œä¸ºæ•´æ•°ä¼ é€’ï¼Œä½†å¦‚æœæ‚¨ä¼ é€’ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåº“ä¹Ÿä¸ä¼šæŠ±æ€¨ã€‚</p>
<p>è¿æ¥åˆ° Redis çš„å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ç‰¹æ®Šæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œå®ƒä»£è¡¨ä¸€ä¸ª URLï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">redis</span> <span class="kn">import</span> <span class="n">Redis</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">redis</span> <span class="o">=</span> <span class="n">Redis</span><span class="o">.</span><span class="n">from_url</span><span class="p">(</span><span class="s2">&#34;redis://localhost:6379/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">redis</span><span class="o">.</span><span class="n">incr</span><span class="p">(</span><span class="s2">&#34;page_views&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">7</span>
</span></span></code></pre></div><p>å¦‚æœæ‚¨æƒ³å°† Redis é…ç½®å­˜å‚¨åœ¨æ–‡ä»¶æˆ–ç¯å¢ƒå˜é‡ä¸­ï¼Œè¿™ä¼šç‰¹åˆ«æ–¹ä¾¿ã€‚</p>
<p>å¥½æäº†ï¼æ‚¨å¯ä»¥è·å–è¿™äº›ä»£ç ç‰‡æ®µä¹‹ä¸€å¹¶å°†å…¶ä¸æ‚¨çš„ Flask Web åº”ç”¨ç¨‹åºé›†æˆã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæ‚¨å°†çœ‹åˆ°å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ã€‚</p>
<h3 id="åœ¨æœ¬åœ°å®ç°å¹¶è¿è¡Œ-flask-åº”ç”¨ç¨‹åº">åœ¨æœ¬åœ°å®ç°å¹¶è¿è¡Œ Flask åº”ç”¨ç¨‹åº</h3>
<p>è¿”å›ä»£ç ç¼–è¾‘å™¨ï¼Œæ‰“å¼€ <code>page-tracker</code> é¡¹ç›®ä¸­çš„ <code>app</code> æ¨¡å—ï¼Œå¹¶ç¼–å†™ä»¥ä¸‹å‡ è¡Œ Python ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># src/page_tracker/app.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">redis</span> <span class="kn">import</span> <span class="n">Redis</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">redis</span> <span class="o">=</span> <span class="n">Redis</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.get</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">page_views</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">incr</span><span class="p">(</span><span class="s2">&#34;page_views&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="sa">f</span><span class="s2">&#34;This page has been seen </span><span class="si">{</span><span class="n">page_views</span><span class="si">}</span><span class="s2"> times.&#34;</span>
</span></span></code></pre></div><p>æ‚¨é¦–å…ˆä»é¡¹ç›®å„è‡ªåˆ—ä¸ºä¾èµ–é¡¹çš„ç¬¬ä¸‰æ–¹åº“ä¸­å¯¼å…¥ <code>Flask</code> å’Œ <code>Redis</code> ã€‚æ¥ä¸‹æ¥ï¼Œæ‚¨ä½¿ç”¨é»˜è®¤å‚æ•°å®ä¾‹åŒ– Flask åº”ç”¨ç¨‹åºå’Œ Redis å®¢æˆ·ç«¯ï¼Œè¿™æ„å‘³ç€å®¢æˆ·ç«¯å°†å°è¯•è¿æ¥åˆ°æœ¬åœ° Redis æœåŠ¡å™¨ã€‚</p>
<p>æœ€åï¼Œæ‚¨å®šä¹‰ä¸€ä¸ªæ§åˆ¶å™¨å‡½æ•°æ¥å¤„ç†åˆ°è¾¾ Web æœåŠ¡å™¨æ ¹åœ°å€ ( <code>/</code> ) çš„ HTTP GET è¯·æ±‚ã€‚</p>
<p>æ‚¨çš„ç«¯ç‚¹ä¼šå¢åŠ  Redis ä¸­çš„é¡µé¢æµè§ˆé‡ï¼Œå¹¶åœ¨å®¢æˆ·ç«¯çš„ Web æµè§ˆå™¨ä¸­æ˜¾ç¤ºåˆé€‚çš„æ¶ˆæ¯ã€‚å°±æ˜¯è¿™æ ·ï¼æ‚¨æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„ Web åº”ç”¨ç¨‹åºï¼Œå®ƒå¯ä»¥ä½¿ç”¨ä¸åˆ°åè¡Œçš„ä»£ç å¤„ç† HTTP æµé‡å¹¶å°†çŠ¶æ€æŒä¹…ä¿å­˜åœ¨è¿œç¨‹æ•°æ®å­˜å‚¨ä¸­ã€‚</p>
<p>è¦éªŒè¯æ‚¨çš„ Flask åº”ç”¨ç¨‹åºæ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œï¼Œè¯·åœ¨ç»ˆç«¯ä¸­å‘å‡ºä»¥ä¸‹å‘½ä»¤ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ flask --app page_tracker.app run
</span></span><span class="line"><span class="cl"> * Serving Flask app <span class="s1">&#39;page_tracker.app&#39;</span>
</span></span><span class="line"><span class="cl"> * Debug mode: off
</span></span><span class="line"><span class="cl">WARNING: This is a development server. Do not use it in a production
</span></span><span class="line"><span class="cl">â®‘ deployment. Use a production WSGI server instead.
</span></span><span class="line"><span class="cl"> * Running on http://127.0.0.1:5000
</span></span><span class="line"><span class="cl">Press CTRL+C to quit
</span></span></code></pre></div><p>ä½ å¯ä»¥åœ¨ä½ çš„æ–‡ä»¶ç³»ç»Ÿçš„ä»»ä½•åœ°æ–¹è¿è¡Œè¿™ä¸ªå‘½ä»¤ï¼Œåªè¦ä½ å·²ç»æ¿€æ´»äº†æ­£ç¡®çš„è™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…äº†ä½ çš„ <code>page-tracker</code> åŒ…ã€‚è¿™åº”è¯¥åœ¨ç¦ç”¨è°ƒè¯•æ¨¡å¼çš„æƒ…å†µä¸‹åœ¨æœ¬åœ°ä¸»æœºå’Œç«¯å£ <code>5000</code> ä¸Šè¿è¡Œ Flask å¼€å‘æœåŠ¡å™¨ã€‚</p>
<p>å¦‚æœä½ æƒ³ä»åŒä¸€ç½‘ç»œä¸Šçš„å¦ä¸€å°è®¡ç®—æœºè®¿é—®ä½ çš„æœåŠ¡å™¨ï¼Œé‚£ä¹ˆä½ å¿…é¡»ä½¿ç”¨ç‰¹æ®Šåœ°å€ <code>0.0.0.0</code> è€Œä¸æ˜¯é»˜è®¤çš„ localhost å°†å®ƒç»‘å®šåˆ°æ‰€æœ‰ç½‘ç»œæ¥å£ï¼Œå®ƒä»£è¡¨ç¯å›æ¥å£ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ flask --app page_tracker.app run --host<span class="o">=</span>0.0.0.0 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                                                  --port<span class="o">=</span><span class="m">8080</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                                                  --debug
</span></span><span class="line"><span class="cl"> * Serving Flask app <span class="s1">&#39;page_tracker.app&#39;</span>
</span></span><span class="line"><span class="cl"> * Debug mode: on
</span></span><span class="line"><span class="cl">WARNING: This is a development server. Do not use it in a production
</span></span><span class="line"><span class="cl">â®‘ deployment. Use a production WSGI server instead.
</span></span><span class="line"><span class="cl"> * Running on all addresses <span class="o">(</span>0.0.0.0<span class="o">)</span>
</span></span><span class="line"><span class="cl"> * Running on http://127.0.0.1:8080
</span></span><span class="line"><span class="cl"> * Running on http://192.168.0.115:8080
</span></span><span class="line"><span class="cl">Press CTRL+C to quit
</span></span><span class="line"><span class="cl"> * Restarting with stat
</span></span><span class="line"><span class="cl"> * Debugger is active!
</span></span><span class="line"><span class="cl"> * Debugger PIN: 123-167-546
</span></span></code></pre></div><p>å¦‚æœéœ€è¦ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨é€‚å½“çš„å‘½ä»¤è¡Œé€‰é¡¹æˆ–æ ‡å¿—æ›´æ”¹ç«¯å£å·å¹¶å¯ç”¨è°ƒè¯•æ¨¡å¼ã€‚</p>
<p>å¯åŠ¨æœåŠ¡å™¨åï¼Œæ‚¨å¯ä»¥ç‚¹å‡»ç»ˆç«¯ä¸­æ˜¾ç¤ºçš„é“¾æ¥ï¼Œå¹¶åœ¨æ‚¨çš„ç½‘ç»œæµè§ˆå™¨ä¸­æŸ¥çœ‹åŒ…å«æµè§ˆé‡çš„é¡µé¢ã€‚æ¯æ¬¡åˆ·æ–°æ­¤é¡µé¢æ—¶ï¼Œè®¡æ•°å™¨åº”åŠ ä¸€ï¼š</p>
<p>åšå¾—å¾ˆå¥½ï¼æ‚¨å·²ç»æˆåŠŸåˆ›å»ºäº†ä¸€ä¸ªåŸºæœ¬çš„ Flask åº”ç”¨ç¨‹åºï¼Œå®ƒä½¿ç”¨ Redis è·Ÿè¸ªé¡µé¢æµè§ˆé‡ã€‚æ¥ä¸‹æ¥ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•æµ‹è¯•å’Œä¿æŠ¤æ‚¨çš„ Web åº”ç”¨ç¨‹åºã€‚</p>
<h2 id="æµ‹è¯•å’Œä¿æŠ¤æ‚¨çš„-web-åº”ç”¨ç¨‹åº">æµ‹è¯•å’Œä¿æŠ¤æ‚¨çš„ Web åº”ç”¨ç¨‹åº</h2>
<p>åœ¨å°†ä»»ä½•é¡¹ç›®æ‰“åŒ…å¹¶éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¹‹å‰ï¼Œæ‚¨åº”è¯¥å½»åº•æµ‹è¯•ã€æ£€æŸ¥å’Œä¿æŠ¤åº•å±‚æºä»£ç ã€‚åœ¨æœ¬æ•™ç¨‹çš„è¿™ä¸€éƒ¨åˆ†ï¼Œæ‚¨å°†ç»ƒä¹ å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•å’Œç«¯åˆ°ç«¯æµ‹è¯•ã€‚æ‚¨è¿˜å°†æ‰§è¡Œé™æ€ä»£ç åˆ†æå’Œå®‰å…¨æ‰«æï¼Œä»¥åœ¨ä¿®å¤æˆæœ¬ä»ç„¶ä½å»‰çš„æƒ…å†µä¸‹è¯†åˆ«æ½œåœ¨çš„é—®é¢˜å’Œæ¼æ´ã€‚</p>
<h3 id="ç”¨å•å…ƒæµ‹è¯•è¦†ç›–æºä»£ç ">ç”¨å•å…ƒæµ‹è¯•è¦†ç›–æºä»£ç </h3>
<p>å•å…ƒæµ‹è¯•æ¶‰åŠæµ‹è¯•ç¨‹åºçš„å„ä¸ªå•å…ƒæˆ–ç»„ä»¶ï¼Œä»¥ç¡®ä¿å®ƒä»¬æŒ‰é¢„æœŸå·¥ä½œã€‚å¦‚ä»Šï¼Œå®ƒå·²æˆä¸ºè½¯ä»¶å¼€å‘çš„å¿…è¦ç»„æˆéƒ¨åˆ†ã€‚è®¸å¤šå·¥ç¨‹å¸ˆç”šè‡³æ›´è¿›ä¸€æ­¥ï¼Œä¸¥æ ¼éµå¾ª<a href="https://realpython.com/python-hash-table/#take-a-crash-course-in-test-driven-development">æµ‹è¯•é©±åŠ¨å¼€å‘</a>æ–¹æ³•ï¼Œé¦–å…ˆç¼–å†™å•å…ƒæµ‹è¯•æ¥é©±åŠ¨ä»£ç è®¾è®¡ã€‚</p>
<p>åœ¨ç¼–å†™å•å…ƒæµ‹è¯•æ—¶ï¼ŒPython ç¤¾åŒºä¸­çš„äººä»¬é€‰æ‹© <a href="https://realpython.com/pytest-python-testing/">pytest</a> è€Œä¸æ˜¯æ ‡å‡†åº“çš„ <code>unittest</code> æ¨¡å—æ˜¯å¾ˆå¸¸è§çš„ã€‚ç”±äº <code>pytest</code> ç›¸å¯¹ç®€å•ï¼Œè¿™ä¸ªæµ‹è¯•æ¡†æ¶ä¸Šæ‰‹å¾ˆå¿«ã€‚ç»§ç»­å¹¶å°† <code>pytest</code> æ·»åŠ ä¸ºé¡¹ç›®çš„å¯é€‰ä¾èµ–é¡¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-toml" data-lang="toml"><span class="line"><span class="cl"><span class="c"># pyproject.toml</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="nx">build-system</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">requires</span> <span class="p">=</span> <span class="p">[</span><span class="s2">&#34;setuptools&gt;=67.0.0&#34;</span><span class="p">,</span> <span class="s2">&#34;wheel&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">build-backend</span> <span class="p">=</span> <span class="s2">&#34;setuptools.build_meta&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="nx">project</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">name</span> <span class="p">=</span> <span class="s2">&#34;page-tracker&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">version</span> <span class="p">=</span> <span class="s2">&#34;1.0.0&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">dependencies</span> <span class="p">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Flask&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;redis&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="nx">project</span><span class="p">.</span><span class="nx">optional-dependencies</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">dev</span> <span class="p">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;pytest&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><p>æ‚¨å¯ä»¥å°†ä»¥æŸç§æ–¹å¼ç›¸å…³çš„å¯é€‰ä¾èµ–é¡¹åˆ†ç»„åœ¨ä¸€ä¸ªé€šç”¨åç§°ä¸‹ã€‚ä¾‹å¦‚ï¼Œåœ¨è¿™é‡Œï¼Œæ‚¨åˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>dev</code> çš„ç»„æ¥æ”¶é›†æ‚¨å°†åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨çš„å·¥å…·å’Œåº“ã€‚é€šè¿‡å°† <code>pytest</code> ä¸ä¸»è¦ä¾èµ–é¡¹åˆ†å¼€ï¼Œæ‚¨å°†èƒ½å¤Ÿä»…åœ¨éœ€è¦æ—¶æŒ‰éœ€å®‰è£…å®ƒã€‚æ¯•ç«Ÿï¼Œå°†æ‚¨çš„æµ‹è¯•æˆ–ç›¸å…³çš„æµ‹è¯•æ¡†æ¶ä¸æ„å»ºçš„åˆ†å‘åŒ…æ†ç»‘åœ¨ä¸€èµ·æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚</p>
<p>ä¸è¦å¿˜è®°é‡æ–°å®‰è£…å¸¦æœ‰å¯é€‰ä¾èµ–é¡¹çš„ Python åŒ…ï¼Œä»¥ä½¿ <code>pytest</code> è¿›å…¥é¡¹ç›®çš„è™šæ‹Ÿç¯å¢ƒï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ python -m pip install --editable <span class="s2">&#34;.[dev]&#34;</span>
</span></span></code></pre></div><p>æ‚¨å¯ä»¥ä½¿ç”¨æ–¹æ‹¬å·åˆ—å‡ºåœ¨æ‚¨çš„ <code>pyproject.toml</code> æ–‡ä»¶ä¸­å®šä¹‰çš„å¯é€‰ä¾èµ–ç»„çš„åç§°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨è¦æ±‚å®‰è£…ç”¨äºå¼€å‘ç›®çš„çš„ä¾èµ–é¡¹ï¼ŒåŒ…æ‹¬æµ‹è¯•æ¡†æ¶ã€‚è¯·æ³¨æ„ï¼Œå»ºè®®åœ¨æ–¹æ‹¬å·å‘¨å›´ä½¿ç”¨å¼•å· ( <code>&quot;&quot;</code> ) ä»¥é˜²æ­¢ shell ä¸­æ½œåœ¨çš„æ–‡ä»¶åæ‰©å±•ã€‚</p>
<p>å› ä¸ºæ‚¨åœ¨é¡¹ç›®ä¸­éµå¾ªäº† <code>src</code> å¸ƒå±€ï¼Œæ‰€ä»¥æ‚¨ä¸å¿…å°†æµ‹è¯•æ¨¡å—ä¿å­˜åœ¨ä¸è¢«æµ‹ä»£ç ç›¸åŒçš„æ–‡ä»¶å¤¹æˆ–ç›¸åŒçš„å‘½åç©ºé—´åŒ…ä¸­ã€‚æ‚¨å¯ä»¥ä¸ºæµ‹è¯•åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„ç›®å½•åˆ†æ”¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">page-tracker/
</span></span><span class="line"><span class="cl">â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€ src/
</span></span><span class="line"><span class="cl">â”‚   â””â”€â”€ page_tracker/
</span></span><span class="line"><span class="cl">â”‚       â”œâ”€â”€ __init__.py
</span></span><span class="line"><span class="cl">â”‚       â””â”€â”€ app.py
</span></span><span class="line"><span class="cl">â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€ test/
</span></span><span class="line"><span class="cl">â”‚   â””â”€â”€ unit/
</span></span><span class="line"><span class="cl">â”‚       â””â”€â”€ test_app.py
</span></span><span class="line"><span class="cl">â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€ venv/
</span></span><span class="line"><span class="cl">â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€ constraints.txt
</span></span><span class="line"><span class="cl">â””â”€â”€ pyproject.toml
</span></span></code></pre></div><p>æ‚¨å·²å°†æµ‹è¯•æ¨¡å—æ”¾åœ¨ <code>test/unit/</code> æ–‡ä»¶å¤¹ä¸­ä»¥ä¿æŒäº•äº•æœ‰æ¡ã€‚ <code>pytest</code> æ¡†æ¶å°†åœ¨æ‚¨ä¸ºæµ‹è¯•æ·»åŠ å‰ç¼€ <code>test</code> æ—¶å‘ç°æ‚¨çš„æµ‹è¯•ã€‚è™½ç„¶æ‚¨å¯ä»¥æ›´æ”¹å®ƒï¼Œä½†é€šå¸¸åœ¨ä½¿ç”¨ç›¸åº”çš„æµ‹è¯•æ¨¡å—é•œåƒæ¯ä¸ª Python æ¨¡å—æ—¶ä¿æŒé»˜è®¤çº¦å®šã€‚ä¾‹å¦‚ï¼Œæ‚¨å°†åœ¨ <code>test/unit/</code> æ–‡ä»¶å¤¹ä¸­ç”¨ <code>test_app</code> è¦†ç›– <code>app</code> æ¨¡å—ã€‚</p>
<p>æ‚¨å°†ä»æµ‹è¯• Web åº”ç”¨ç¨‹åºçš„æˆåŠŸè·¯å¾„å¼€å§‹ï¼Œè¿™é€šå¸¸æ„å‘³ç€å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚æ¯ä¸ª Flask åº”ç”¨ç¨‹åºéƒ½å¸¦æœ‰ä¸€ä¸ªæ–¹ä¾¿çš„æµ‹è¯•å®¢æˆ·ç«¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥å‘å‡ºæ¨¡æ‹Ÿçš„ HTTP è¯·æ±‚ã€‚å› ä¸ºæµ‹è¯•å®¢æˆ·ç«¯ä¸éœ€è¦è¿è¡Œå®æ—¶æœåŠ¡å™¨ï¼Œæ‰€ä»¥ä½ çš„å•å…ƒæµ‹è¯•æ‰§è¡Œå¾—æ›´å¿«å¹¶ä¸”ä¼šå˜å¾—æ›´åŠ å­¤ç«‹ã€‚</p>
<p>æ‚¨å¯ä»¥è·å¾—æµ‹è¯•å®¢æˆ·ç«¯å¹¶å°†å…¶æ–¹ä¾¿åœ°åŒ…è£…åœ¨æµ‹è¯•è£…ç½®ä¸­ï¼Œä»¥ä½¿å…¶å¯ç”¨äºæ‚¨çš„æµ‹è¯•åŠŸèƒ½ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># test/unit/test_app.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pytest</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">page_tracker.app</span> <span class="kn">import</span> <span class="n">app</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@pytest.fixture</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">http_client</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span>
</span></span></code></pre></div><p>é¦–å…ˆï¼Œæ‚¨å¯¼å…¥ <code>pytest</code> åŒ…ä»¥é’ˆå¯¹æ‚¨çš„è‡ªå®šä¹‰å‡½æ•°åˆ©ç”¨å…¶ <code>@fixture</code> è£…é¥°å™¨ã€‚ä»”ç»†é€‰æ‹©æ‚¨çš„å‡½æ•°åç§°ï¼Œå› ä¸ºå®ƒä¹Ÿä¼šæˆä¸ºæ‚¨å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™å„ä¸ªæµ‹è¯•å‡½æ•°çš„å¤¹å…·çš„åç§°ã€‚æ‚¨è¿˜å¯ä»¥ä» <code>page_tracker</code> åŒ…ä¸­å¯¼å…¥ Flask åº”ç”¨ç¨‹åºä»¥è·å–ç›¸åº”çš„æµ‹è¯•å®¢æˆ·ç«¯å®ä¾‹ã€‚</p>
<p>å½“æ‚¨æ‰“ç®—ç¼–å†™å•å…ƒæµ‹è¯•æ—¶ï¼Œæ‚¨å¿…é¡»å§‹ç»ˆé€šè¿‡æ¶ˆé™¤ä»£ç å•å…ƒå¯èƒ½å…·æœ‰çš„ä»»ä½•ä¾èµ–å…³ç³»æ¥éš”ç¦»å®ƒã€‚è¿™æ„å‘³ç€æ‚¨åº”è¯¥æ¨¡æ‹Ÿæˆ–å­˜æ ¹æ‚¨çš„ä»£ç æ‰€ä¾èµ–çš„ä»»ä½•å¤–éƒ¨æœåŠ¡ã€æ•°æ®åº“æˆ–åº“ã€‚åœ¨æ‚¨çš„æƒ…å†µä¸‹ï¼ŒRedis æœåŠ¡å™¨å°±æ˜¯è¿™æ ·çš„ä¾èµ–é¡¹ã€‚</p>
<p>ä¸å¹¸çš„æ˜¯ï¼Œæ‚¨çš„ä»£ç ç›®å‰ä½¿ç”¨ç¡¬ç¼–ç çš„ Redis å®¢æˆ·ç«¯ï¼Œè¿™ä¼šé˜»æ­¢æ¨¡æ‹Ÿã€‚è¿™æ˜¯ä»ä¸€å¼€å§‹å°±éµå¾ªæµ‹è¯•é©±åŠ¨å¼€å‘çš„ä¸€ä¸ªå¾ˆå¥½çš„è®ºæ®ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€æ‚¨å¿…é¡»è¿”å›å¹¶é‡æ–°å¼€å§‹ã€‚ç›¸åï¼Œæ‚¨å°†é€šè¿‡å®æ–½ä¾èµ–æ³¨å…¥è®¾è®¡æ¨¡å¼æ¥<a href="https://realpython.com/python-refactoring/">é‡æ„</a>æ‚¨çš„ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl"># src/page_tracker/app.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gi">+from functools import cache
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>
</span></span><span class="line"><span class="cl"> from flask import Flask
</span></span><span class="line"><span class="cl"> from redis import Redis
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> app = Flask(__name__)
</span></span><span class="line"><span class="cl"><span class="gd">-redis = Redis()
</span></span></span><span class="line"><span class="cl"><span class="gd"></span>
</span></span><span class="line"><span class="cl"> @app.get(&#34;/&#34;)
</span></span><span class="line"><span class="cl"> def index():
</span></span><span class="line"><span class="cl"><span class="gd">-    page_views = redis.incr(&#34;page_views&#34;)
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+    page_views = redis().incr(&#34;page_views&#34;)
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>     return f&#34;This page has been seen {page_views} times.&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gi">+@cache
</span></span></span><span class="line"><span class="cl"><span class="gi">+def redis():
</span></span></span><span class="line"><span class="cl"><span class="gi">+    return Redis()
</span></span></span></code></pre></div><p>æœ¬è´¨ä¸Šï¼Œæ‚¨å°† Redis å®¢æˆ·ç«¯åˆ›å»ºä»£ç ä»<a href="https://realpython.com/python-scope-legb-rule/#modules-the-global-scope">å…¨å±€èŒƒå›´</a>ç§»åŠ¨åˆ°ä¸€ä¸ªæ–°çš„ <code>redis()</code> å‡½æ•°ï¼Œæ‚¨çš„æ§åˆ¶å™¨å‡½æ•°ä¼šåœ¨è¿è¡Œæ—¶é’ˆå¯¹æ¯ä¸ªä¼ å…¥è¯·æ±‚è°ƒç”¨è¯¥å‡½æ•°ã€‚è¿™å°†å…è®¸æ‚¨çš„æµ‹è¯•ç”¨ä¾‹åœ¨æ­£ç¡®çš„æ—¶é—´ç”¨æ¨¡æ‹Ÿå¯¹åº”ç‰©æ›¿æ¢è¿”å›çš„ Redis å®ä¾‹ã€‚ä½†æ˜¯ï¼Œä¸ºäº†ç¡®ä¿å†…å­˜ä¸­åªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯å®ä¾‹ï¼Œæœ‰æ•ˆåœ°ä½¿å…¶æˆä¸ºä¸€ä¸ªå•ä¾‹ï¼Œæ‚¨è¿˜<a href="https://realpython.com/lru-cache-python/">ç¼“å­˜</a>äº†æ–°å‡½æ•°çš„ç»“æœã€‚</p>
<p>ç°åœ¨å›åˆ°æ‚¨çš„æµ‹è¯•æ¨¡å—å¹¶å®æ–½ä»¥ä¸‹å•å…ƒæµ‹è¯•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># test/unit/test_app.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">unittest.mock</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pytest</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">page_tracker.app</span> <span class="kn">import</span> <span class="n">app</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@pytest.fixture</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">http_client</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@unittest.mock.patch</span><span class="p">(</span><span class="s2">&#34;page_tracker.app.redis&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">test_should_call_redis_incr</span><span class="p">(</span><span class="n">mock_redis</span><span class="p">,</span> <span class="n">http_client</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Given</span>
</span></span><span class="line"><span class="cl">    <span class="n">mock_redis</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">incr</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="mi">5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># When</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span> <span class="o">=</span> <span class="n">http_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Then</span>
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s2">&#34;This page has been seen 5 times.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">mock_redis</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">incr</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s2">&#34;page_views&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>æ‚¨ä½¿ç”¨ Python çš„ <code>@patch</code> è£…é¥°å™¨åŒ…è£…æ‚¨çš„æµ‹è¯•å‡½æ•°ï¼Œä»¥å°†æ¨¡æ‹Ÿçš„ Redis å®¢æˆ·ç«¯ä½œä¸ºå‚æ•°æ³¨å…¥å…¶ä¸­ã€‚æ‚¨è¿˜å‘Šè¯‰ <code>pytest</code> å°†æ‚¨çš„ HTTP æµ‹è¯•å®¢æˆ·ç«¯è£…ç½®ä½œä¸ºå¦ä¸€ä¸ªå‚æ•°æ³¨å…¥ã€‚æµ‹è¯•å‡½æ•°æœ‰ä¸€ä¸ªæè¿°æ€§åç§°ï¼Œä»¥åŠ¨è¯ should å¼€å¤´å¹¶éµå¾ª Given-When-Then æ¨¡å¼ã€‚è¿™ä¸¤ä¸ªå¸¸ç”¨äºè¡Œä¸ºé©±åŠ¨å¼€å‘çš„çº¦å®šï¼Œä½¿æ‚¨çš„æµ‹è¯•è¢«è§£è¯»ä¸ºè¡Œä¸ºè§„èŒƒã€‚</p>
<p>åœ¨æ‚¨çš„æµ‹è¯•ç”¨ä¾‹ä¸­ï¼Œæ‚¨é¦–å…ˆå°†æ¨¡æ‹Ÿ Redis å®¢æˆ·ç«¯è®¾ç½®ä¸ºåœ¨å…¶ <code>.incr()</code> æ–¹æ³•è¢«è°ƒç”¨æ—¶å§‹ç»ˆè¿”å› <code>5</code> ã€‚ç„¶åï¼Œæ‚¨å‘æ ¹ç«¯ç‚¹ ( <code>/</code> ) å‘å‡ºä¼ªé€ çš„ HTTP è¯·æ±‚å¹¶æ£€æŸ¥æœåŠ¡å™¨çš„å“åº”çŠ¶æ€å’Œæ­£æ–‡ã€‚å› ä¸ºæ¨¡æ‹Ÿå¯ä»¥å¸®åŠ©æ‚¨æµ‹è¯•å•å…ƒçš„è¡Œä¸ºï¼Œæ‰€ä»¥æ‚¨åªéœ€éªŒè¯æœåŠ¡å™¨æ˜¯å¦ä½¿ç”¨é¢„æœŸå‚æ•°è°ƒç”¨äº†æ­£ç¡®çš„æ–¹æ³•ï¼Œå¹¶ç›¸ä¿¡ Redis å®¢æˆ·ç«¯åº“å¯ä»¥æ­£å¸¸å·¥ä½œã€‚</p>
<p>è¦æ‰§è¡Œå•å…ƒæµ‹è¯•ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»£ç ç¼–è¾‘å™¨ä¸­é›†æˆçš„æµ‹è¯•è¿è¡Œå™¨ï¼Œä¹Ÿå¯ä»¥åœ¨ç»ˆç«¯ä¸­é”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ python -m pytest -v test/unit/
</span></span></code></pre></div><p>æ‚¨ä»è™šæ‹Ÿç¯å¢ƒä¸­å°† <code>pytest</code> ä½œä¸º Python æ¨¡å—è¿è¡Œï¼ŒæŒ‡ç¤ºå®ƒæ‰«æ <code>test/unit/</code> ç›®å½•ä»¥ä¾¿åœ¨é‚£é‡ŒæŸ¥æ‰¾æµ‹è¯•æ¨¡å—ã€‚ <code>-v</code> å¼€å…³å¢åŠ äº†æµ‹è¯•æŠ¥å‘Šçš„è¯¦ç»†ç¨‹åº¦ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥çœ‹åˆ°æœ‰å…³å„ä¸ªæµ‹è¯•ç”¨ä¾‹çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚</p>
<p>åœ¨æ‰€æœ‰å•å…ƒæµ‹è¯•éƒ½é€šè¿‡åç›¯ç€ç»¿è‰²æŠ¥å‘Šä¼šæ„Ÿåˆ°æ»¡è¶³ã€‚å®ƒä½¿æ‚¨å¯¹ä»£ç æœ‰ä¸€å®šç¨‹åº¦çš„ä¿¡å¿ƒï¼Œä½†ä¸è¶³ä»¥åšå‡ºä»»ä½•å½¢å¼çš„ä¿è¯ã€‚è®¸å¤šæ¨¡å› è¯´æ˜äº†å³ä½¿åœ¨å•å…ƒæµ‹è¯•é€šè¿‡åè¿è¡Œé›†æˆæµ‹è¯•çš„é‡è¦æ€§ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå…¶ä¸­ä¸€ä¸ªç»å…¸æ¨¡å› æ˜¾ç¤ºæœ‰ä¸¤ä¸ªæŠ½å±‰ï¼Œä½†ä¸€æ¬¡åªèƒ½æ‰“å¼€ä¸€ä¸ªã€‚è™½ç„¶æ¯ä¸ªå•ç‹¬çš„æŠ½å±‰æˆ–å•å…ƒéƒ½ç»è¿‡æµ‹è¯•å¹¶ç‹¬ç«‹å·¥ä½œï¼Œä½†å½“æ‚¨å°è¯•å°†å®ƒä»¬é›†æˆåˆ°ä¸€ä»¶å®¶å…·ä¸­æ—¶ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ã€‚æ¥ä¸‹æ¥ï¼Œæ‚¨å°†å‘æ‚¨çš„é¡¹ç›®æ·»åŠ ä¸€ä¸ªåŸºæœ¬çš„é›†æˆæµ‹è¯•ã€‚</p>
<h3 id="é€šè¿‡é›†æˆæµ‹è¯•æ£€æŸ¥ç»„ä»¶äº¤äº’">é€šè¿‡é›†æˆæµ‹è¯•æ£€æŸ¥ç»„ä»¶äº¤äº’</h3>
<p>é›†æˆæµ‹è¯•åº”è¯¥æ˜¯è¿è¡Œå•å…ƒæµ‹è¯•åçš„ä¸‹ä¸€ä¸ªé˜¶æ®µã€‚é›†æˆæµ‹è¯•çš„ç›®æ ‡æ˜¯æ£€æŸ¥æ‚¨çš„ç»„ä»¶ä½œä¸ºæ›´å¤§ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†å¦‚ä½•ç›¸äº’äº¤äº’ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæ‚¨çš„é¡µé¢è·Ÿè¸ªå™¨ Web åº”ç”¨ç¨‹åºå¯èƒ½å…·æœ‰é›†æˆæµ‹è¯•ï¼Œç”¨äºæ£€æŸ¥ä¸çœŸæ­£çš„ Redis æœåŠ¡å™¨è€Œä¸æ˜¯æ¨¡æ‹ŸæœåŠ¡å™¨çš„é€šä¿¡ã€‚</p>
<p>æ‚¨å¯ä»¥é‡å¤ä½¿ç”¨ <code>pytest</code> æ¥å®æ–½å’Œè¿è¡Œé›†æˆæµ‹è¯•ã€‚ä½†æ˜¯ï¼Œæ‚¨å°†å®‰è£…ä¸€ä¸ªé¢å¤–çš„ <code>pytest-timeout</code> æ’ä»¶ï¼Œä»¥å…è®¸æ‚¨å¼ºåˆ¶è¿è¡Œæ—¶é—´è¿‡é•¿çš„æµ‹è¯•ç”¨ä¾‹å¤±è´¥ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-toml" data-lang="toml"><span class="line"><span class="cl"><span class="c"># pyproject.toml</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="nx">build-system</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">requires</span> <span class="p">=</span> <span class="p">[</span><span class="s2">&#34;setuptools&gt;=67.0.0&#34;</span><span class="p">,</span> <span class="s2">&#34;wheel&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">build-backend</span> <span class="p">=</span> <span class="s2">&#34;setuptools.build_meta&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="nx">project</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">name</span> <span class="p">=</span> <span class="s2">&#34;page-tracker&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">version</span> <span class="p">=</span> <span class="s2">&#34;1.0.0&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">dependencies</span> <span class="p">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Flask&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;redis&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="nx">project</span><span class="p">.</span><span class="nx">optional-dependencies</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">dev</span> <span class="p">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;pytest&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;pytest-timeout&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><p>ç†æƒ³æƒ…å†µä¸‹ï¼Œæ‚¨ä¸å¿…æ‹…å¿ƒå•å…ƒæµ‹è¯•è¶…æ—¶ï¼Œå› ä¸ºå®ƒä»¬åº”è¯¥é’ˆå¯¹é€Ÿåº¦è¿›è¡Œä¼˜åŒ–ã€‚å¦ä¸€æ–¹é¢ï¼Œé›†æˆæµ‹è¯•å°†éœ€è¦æ›´é•¿çš„æ—¶é—´æ¥è¿è¡Œï¼Œå¹¶ä¸”å¯èƒ½ä¼šåœ¨åœæ»çš„ç½‘ç»œè¿æ¥ä¸Šæ— é™æŒ‚èµ·ï¼Œä»è€Œé˜»æ­¢æ‚¨çš„æµ‹è¯•å¥—ä»¶å®Œæˆã€‚å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æœ‰åŠæ³•ä¸­æ­¢å®ƒä»¬å¾ˆé‡è¦ã€‚</p>
<p>è¯·è®°ä½å†æ¬¡é‡æ–°å®‰è£…å¸¦æœ‰å¯é€‰ä¾èµ–é¡¹çš„åŒ…ï¼Œä»¥ä½¿ <code>pytest-timeout</code> æ’ä»¶å¯ç”¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ python -m pip install --editable <span class="s2">&#34;.[dev]&#34;</span>
</span></span></code></pre></div><p>åœ¨ç»§ç»­ä¹‹å‰ï¼Œä¸ºæ‚¨çš„é›†æˆæµ‹è¯•æ·»åŠ å¦ä¸€ä¸ªå­æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨æ‚¨çš„ <code>test/</code> æ–‡ä»¶å¤¹ä¸­å®šä¹‰ä¸€ä¸ª <code>conftest.py</code> æ–‡ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">page-tracker/
</span></span><span class="line"><span class="cl">â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€ src/
</span></span><span class="line"><span class="cl">â”‚   â””â”€â”€ page_tracker/
</span></span><span class="line"><span class="cl">â”‚       â”œâ”€â”€ __init__.py
</span></span><span class="line"><span class="cl">â”‚       â””â”€â”€ app.py
</span></span><span class="line"><span class="cl">â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€ test/
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ integration/
</span></span><span class="line"><span class="cl">â”‚   â”‚   â””â”€â”€ test_app_redis.py
</span></span><span class="line"><span class="cl">â”‚   â”‚
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ unit/
</span></span><span class="line"><span class="cl">â”‚   â”‚   â””â”€â”€ test_app.py
</span></span><span class="line"><span class="cl">â”‚   â”‚
</span></span><span class="line"><span class="cl">â”‚   â””â”€â”€ conftest.py
</span></span><span class="line"><span class="cl">â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€ venv/
</span></span><span class="line"><span class="cl">â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€ constraints.txt
</span></span><span class="line"><span class="cl">â””â”€â”€ pyproject.toml
</span></span></code></pre></div><p>æ‚¨å°†åœ¨ <code>conftest.py</code> ä¸­æ”¾ç½®å…¬å…±è£…ç½®ï¼Œä¸åŒç±»å‹çš„æµ‹è¯•å°†å…±äº«è¿™äº›è£…ç½®ã€‚</p>
<p>è™½ç„¶æ‚¨çš„ Web åº”ç”¨ç¨‹åºåªæœ‰ä¸€ä¸ªç»„ä»¶ï¼Œä½†æ‚¨å¯ä»¥å°† Redis è§†ä¸º Flask éœ€è¦ä½¿ç”¨çš„å¦ä¸€ä¸ªç»„ä»¶ã€‚å› æ­¤ï¼Œé›†æˆæµ‹è¯•å¯èƒ½çœ‹èµ·æ¥ä¸æ‚¨çš„å•å…ƒæµ‹è¯•ç±»ä¼¼ï¼Œåªæ˜¯ä¸å†æ¨¡æ‹Ÿ Redis å®¢æˆ·ç«¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># test/integration/test_app_redis.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pytest</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@pytest.mark.timeout</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">test_should_update_redis</span><span class="p">(</span><span class="n">redis_client</span><span class="p">,</span> <span class="n">http_client</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Given</span>
</span></span><span class="line"><span class="cl">    <span class="n">redis_client</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&#34;page_views&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># When</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span> <span class="o">=</span> <span class="n">http_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Then</span>
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s2">&#34;This page has been seen 5 times.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="n">redis_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;page_views&#34;</span><span class="p">)</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&#34;5&#34;</span>
</span></span></code></pre></div><p>ä»æ¦‚å¿µä¸Šè®²ï¼Œæ‚¨çš„æ–°æµ‹è¯•ç”¨ä¾‹åŒ…å«ä¸ä»¥å‰ç›¸åŒçš„æ­¥éª¤ï¼Œä½†å®ƒä¸çœŸæ­£çš„ Redis æœåŠ¡å™¨äº¤äº’ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ ç»™æµ‹è¯•æœ€å¤š <code>1.5</code> ç§’æ¥å®Œæˆä½¿ç”¨ <code>@pytest.mark.timeout</code> è£…é¥°å™¨ã€‚æµ‹è¯•å‡½æ•°å°†ä¸¤ä¸ªå¤¹å…·ä½œä¸ºå‚æ•°ï¼š</p>
<ul>
<li>è¿æ¥åˆ°æœ¬åœ°æ•°æ®å­˜å‚¨çš„ Redis å®¢æˆ·ç«¯</li>
<li>Flask çš„æµ‹è¯•å®¢æˆ·ç«¯è¿æ¥åˆ°æ‚¨çš„ Web åº”ç”¨ç¨‹åº</li>
</ul>
<p>ä¸ºäº†ä½¿ç¬¬äºŒä¸ªåœ¨æ‚¨çš„é›†æˆæµ‹è¯•ä¸­ä¹Ÿå¯ç”¨ï¼Œæ‚¨å¿…é¡»å°† <code>http_client()</code> å¤¹å…·ä» <code>test_app</code> æ¨¡å—ç§»åŠ¨åˆ° <code>conftest.py</code> æ–‡ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># test/conftest.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pytest</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">redis</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">page_tracker.app</span> <span class="kn">import</span> <span class="n">app</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@pytest.fixture</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">http_client</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@pytest.fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">&#34;module&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">redis_client</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">()</span>
</span></span></code></pre></div><p>ç”±äºæ­¤æ–‡ä»¶ä½äºæ–‡ä»¶å¤¹å±‚æ¬¡ç»“æ„çš„ä¸Šä¸€å±‚ï¼Œ <code>pytest</code> å°†é€‰å–å…¶ä¸­å®šä¹‰çš„æ‰€æœ‰ç¯å…·ï¼Œå¹¶ä½¿å®ƒä»¬åœ¨æ•´ä¸ªåµŒå¥—æ–‡ä»¶å¤¹ä¸­å¯è§ã€‚é™¤äº†æ‚¨ä»å¦ä¸€ä¸ª Python æ¨¡å—ç§»åŠ¨çš„ç†Ÿæ‚‰çš„ <code>http_client()</code> å¤¹å…·ä¹‹å¤–ï¼Œæ‚¨è¿˜å®šä¹‰äº†ä¸€ä¸ªè¿”å›é»˜è®¤ Redis å®¢æˆ·ç«¯çš„æ–°å¤¹å…·ã€‚è¯·æ³¨æ„ï¼Œæ‚¨ä¸ºå®ƒæŒ‡å®šäº† <code>module</code> èŒƒå›´ï¼Œä»¥ä¾¿ä¸ºæµ‹è¯•æ¨¡å—ä¸­çš„æ‰€æœ‰å‡½æ•°é‡ç”¨ç›¸åŒçš„ Redis å®¢æˆ·ç«¯å®ä¾‹ã€‚</p>
<p>è¦æ‰§è¡Œé›†æˆæµ‹è¯•ï¼Œæ‚¨å¿…é¡»ä»”ç»†æ£€æŸ¥ Redis æœåŠ¡å™¨æ˜¯å¦åœ¨æœ¬åœ°é»˜è®¤ç«¯å£ <code>6379</code> ä¸Šè¿è¡Œï¼Œç„¶ååƒä»¥å‰ä¸€æ ·å¯åŠ¨ <code>pytest</code> ï¼Œä½†å°†å…¶æŒ‡å‘åŒ…å«é›†æˆæµ‹è¯•çš„æ–‡ä»¶å¤¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ python -m pytest -v test/integration/
</span></span></code></pre></div><p>å› ä¸ºæ‚¨çš„é›†æˆæµ‹è¯•è¿æ¥åˆ°å®é™…çš„ Redis æœåŠ¡å™¨ï¼Œæ‰€ä»¥å®ƒä¼šè¦†ç›–æ‚¨ä¹‹å‰å¯èƒ½å­˜å‚¨åœ¨ <code>page_views</code> é”®ä¸‹çš„å€¼ã€‚ä½†æ˜¯ï¼Œå¦‚æœåœ¨æ‰§è¡Œé›†æˆæµ‹è¯•æ—¶ Redis æœåŠ¡å™¨æœªè¿è¡Œï¼Œæˆ–è€…å¦‚æœ Redis åœ¨å…¶ä»–åœ°æ–¹è¿è¡Œï¼Œé‚£ä¹ˆæ‚¨çš„æµ‹è¯•å°†å¤±è´¥ã€‚è¿™ç§å¤±è´¥å¯èƒ½æ˜¯å‡ºäºé”™è¯¯çš„åŸå› ï¼Œä½¿ç»“æœæˆä¸ºå‡é˜´æ€§é”™è¯¯ï¼Œå› ä¸ºæ‚¨çš„ä»£ç å®é™…ä¸Šå¯èƒ½æŒ‰é¢„æœŸå·¥ä½œã€‚</p>
<p>è¦è§‚å¯Ÿæ­¤é—®é¢˜ï¼Œè¯·ç«‹å³åœæ­¢ Redis å¹¶é‡æ–°è¿è¡Œé›†æˆæµ‹è¯•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ docker stop redis-server
</span></span><span class="line"><span class="cl">redis-server
</span></span><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ python -m pytest -v test/integration/
</span></span><span class="line"><span class="cl">â‹®
</span></span><span class="line"><span class="cl"><span class="o">=========================</span> short <span class="nb">test</span> summary <span class="nv">info</span> <span class="o">==========================</span>
</span></span><span class="line"><span class="cl">FAILED test/integration/test_app_redis.py::test_should_update_redis -
</span></span><span class="line"><span class="cl">â®‘redis.exceptions.ConnectionError: Error <span class="m">111</span> connecting to localhost:6379.
</span></span><span class="line"><span class="cl">â®‘Connection <span class="nv">refused</span>
</span></span><span class="line"><span class="cl"><span class="o">============================</span> <span class="m">1</span> failed in 0.19s <span class="o">=============================</span>
</span></span></code></pre></div><p>è¿™æ­ç¤ºäº†æ‚¨çš„ä»£ç ä¸­çš„ä¸€ä¸ªé—®é¢˜ï¼Œè¯¥é—®é¢˜ç›®å‰æ— æ³•å¦¥å–„å¤„ç† Redis è¿æ¥é”™è¯¯ã€‚æœ¬ç€æµ‹è¯•é©±åŠ¨å¼€å‘çš„ç²¾ç¥ï¼Œæ‚¨å¯ä»¥é¦–å…ˆç¼–å†™ä¸€ä¸ªé‡ç°è¯¥é—®é¢˜çš„æµ‹è¯•ç”¨ä¾‹ï¼Œç„¶åä¿®å¤å®ƒã€‚åˆ‡æ¢ä¸€ä¸‹ï¼Œä½¿ç”¨æ¨¡æ‹Ÿçš„ Redis å®¢æˆ·ç«¯åœ¨ <code>test_app</code> æ¨¡å—ä¸­æ·»åŠ ä»¥ä¸‹å•å…ƒæµ‹è¯•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># test/unit/test_app.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">unittest.mock</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">redis</span> <span class="kn">import</span> <span class="ne">ConnectionError</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@unittest.mock.patch</span><span class="p">(</span><span class="s2">&#34;page_tracker.app.redis&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">test_should_handle_redis_connection_error</span><span class="p">(</span><span class="n">mock_redis</span><span class="p">,</span> <span class="n">http_client</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Given</span>
</span></span><span class="line"><span class="cl">    <span class="n">mock_redis</span><span class="o">.</span><span class="n">return_value</span><span class="o">.</span><span class="n">incr</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="ne">ConnectionError</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># When</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span> <span class="o">=</span> <span class="n">http_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Then</span>
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">500</span>
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s2">&#34;Sorry, something went wrong </span><span class="se">\N{pensive face}</span><span class="s2">&#34;</span>
</span></span></code></pre></div><p>æ‚¨è®¾ç½®æ¨¡æ‹Ÿçš„ <code>.incr()</code> æ–¹æ³•çš„å‰¯ä½œç”¨ï¼Œä»¥ä¾¿è°ƒç”¨è¯¥æ–¹æ³•å°†å¼•å‘ <code>redis.ConnectionError</code> å¼‚å¸¸ï¼Œè¿™æ˜¯æ‚¨åœ¨é›†æˆæµ‹è¯•å¤±è´¥æ—¶è§‚å¯Ÿåˆ°çš„ã€‚æ‚¨çš„æ–°å•å…ƒæµ‹è¯•æ˜¯è´Ÿé¢æµ‹è¯•çš„ä¸€ä¸ªç¤ºä¾‹ï¼Œå®ƒæœŸæœ› Flask ä»¥ HTTP çŠ¶æ€ä»£ç  500 å’Œæè¿°æ€§æ¶ˆæ¯è¿›è¡Œå“åº”ã€‚ä»¥ä¸‹æ˜¯æ»¡è¶³è¯¥å•å…ƒæµ‹è¯•çš„æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># src/page_tracker/app.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">cache</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">redis</span> <span class="kn">import</span> <span class="n">Redis</span><span class="p">,</span> <span class="n">RedisError</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.get</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">page_views</span> <span class="o">=</span> <span class="n">redis</span><span class="p">()</span><span class="o">.</span><span class="n">incr</span><span class="p">(</span><span class="s2">&#34;page_views&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="n">RedisError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&#34;Redis error&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;Sorry, something went wrong </span><span class="se">\N{pensive face}</span><span class="s2">&#34;</span><span class="p">,</span> <span class="mi">500</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&#34;This page has been seen </span><span class="si">{</span><span class="n">page_views</span><span class="si">}</span><span class="s2"> times.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@cache</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">redis</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Redis</span><span class="p">()</span>
</span></span></code></pre></div><p>æ‚¨æ‹¦æˆªé¡¶çº§å¼‚å¸¸ç±» <code>redis.RedisError</code> ï¼Œå®ƒæ˜¯ Redis å®¢æˆ·ç«¯å¼•å‘çš„æ‰€æœ‰å¼‚å¸¸ç±»å‹çš„ç¥–å…ˆã€‚å¦‚æœå‡ºç°ä»»ä½•é—®é¢˜ï¼Œæ‚¨å°†è¿”å›é¢„æœŸçš„ HTTP çŠ¶æ€ä»£ç å’Œä¸€æ¡æ¶ˆæ¯ã€‚ä¸ºæ–¹ä¾¿èµ·è§ï¼Œæ‚¨è¿˜ä½¿ç”¨ Flask å†…ç½®çš„<a href="https://realpython.com/python-logging/">è®°å½•</a>å™¨è®°å½•å¼‚å¸¸ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šè™½ç„¶çˆ¶ç±»æ˜¯å­ç±»ç›´æ¥æ‰©å±•çš„ç›´æ¥åŸºç±»ï¼Œä½†ç¥–å…ˆç±»å¯ä»¥ä½äº<a href="https://realpython.com/python-classes/#using-inheritance-and-building-class-hierarchies">ç»§æ‰¿</a>å±‚æ¬¡ç»“æ„ä¸­æ›´ä¸Šå±‚çš„ä»»ä½•ä½ç½®ã€‚</p>
</blockquote>
<p>å¥½æäº†ï¼ç”±äºæµ‹è¯•ï¼Œæ‚¨ä¿®æ”¹äº†å•å…ƒæµ‹è¯•ï¼Œå®æ–½äº†é›†æˆæµ‹è¯•ï¼Œå¹¶åœ¨å‘ç°ä»£ç ä¸­çš„ç¼ºé™·åä¿®å¤äº†å®ƒã€‚</p>
<p>å°½ç®¡å¦‚æ­¤ï¼Œå½“æ‚¨å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°è¿œç¨‹ç¯å¢ƒæ—¶ï¼Œæ‚¨å¦‚ä½•çŸ¥é“æ‰€æœ‰éƒ¨åˆ†éƒ½ç»„åˆåœ¨ä¸€èµ·å¹¶ä¸”ä¸€åˆ‡éƒ½æŒ‰é¢„æœŸå·¥ä½œï¼Ÿ</p>
<p>åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæ‚¨å°†é€šè¿‡å¯¹å®é™… Flask æœåŠ¡å™¨è€Œä¸æ˜¯æµ‹è¯•å®¢æˆ·ç«¯æ‰§è¡Œç«¯åˆ°ç«¯æµ‹è¯•æ¥æ¨¡æ‹ŸçœŸå®åœºæ™¯ã€‚</p>
<h3 id="æµ‹è¯•çœŸå®åœºæ™¯ç«¯åˆ°ç«¯">æµ‹è¯•çœŸå®åœºæ™¯ç«¯åˆ°ç«¯</h3>
<p>ç«¯åˆ°ç«¯æµ‹è¯•ï¼Œä¹Ÿç§°ä¸ºå¹¿æ³›å †æ ˆæµ‹è¯•ï¼ŒåŒ…å«å¤šç§æµ‹è¯•ï¼Œå¯ä»¥å¸®åŠ©æ‚¨éªŒè¯æ•´ä¸ªç³»ç»Ÿã€‚ä»–ä»¬é€šè¿‡æ¨¡æ‹Ÿå®é™…ç”¨æˆ·é€šè¿‡åº”ç”¨ç¨‹åºçš„æµç¨‹æ¥æµ‹è¯•å®Œæ•´çš„è½¯ä»¶å †æ ˆã€‚å› æ­¤ï¼Œç«¯åˆ°ç«¯æµ‹è¯•éœ€è¦ä¸€ä¸ªå°½å¯èƒ½æ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒçš„éƒ¨ç½²ç¯å¢ƒã€‚é€šå¸¸è¿˜éœ€è¦ä¸“é—¨çš„æµ‹è¯•å·¥ç¨‹å¸ˆå›¢é˜Ÿã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šç”±äºç«¯åˆ°ç«¯æµ‹è¯•çš„ç»´æŠ¤æˆæœ¬å¾ˆé«˜ï¼Œè€Œä¸”å¾€å¾€éœ€è¦èŠ±è´¹å¤§é‡æ—¶é—´æ¥è®¾ç½®å’Œè¿è¡Œï¼Œå› æ­¤å®ƒä»¬ä½äº Google æµ‹è¯•é‡‘å­—å¡”çš„é¡¶ç«¯ã€‚æ¢å¥è¯è¯´ï¼Œæ‚¨çš„ç›®æ ‡åº”è¯¥æ˜¯è¿›è¡Œæ›´å¤šçš„é›†æˆæµ‹è¯•ï¼Œç”šè‡³åœ¨æ‚¨çš„é¡¹ç›®ä¸­è¿›è¡Œæ›´å¤šçš„å•å…ƒæµ‹è¯•ã€‚</p>
</blockquote>
<p>ç”±äºæ‚¨æœ€ç»ˆå¸Œæœ›ä¸ºæ‚¨çš„ Docker åº”ç”¨ç¨‹åºæ„å»ºä¸€ä¸ªæˆç†Ÿçš„æŒç»­é›†æˆç®¡é“ï¼Œå› æ­¤è¿›è¡Œä¸€äº›ç«¯åˆ°ç«¯æµ‹è¯•å°†å˜å¾—è‡³å…³é‡è¦ã€‚é¦–å…ˆä¸ºæ‚¨çš„ E2E æµ‹è¯•æ·»åŠ å¦ä¸€ä¸ªå­æ–‡ä»¶å¤¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">page-tracker/
</span></span><span class="line"><span class="cl">â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€ src/
</span></span><span class="line"><span class="cl">â”‚   â””â”€â”€ page_tracker/
</span></span><span class="line"><span class="cl">â”‚       â”œâ”€â”€ __init__.py
</span></span><span class="line"><span class="cl">â”‚       â””â”€â”€ app.py
</span></span><span class="line"><span class="cl">â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€ test/
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ e2e/
</span></span><span class="line"><span class="cl">â”‚   â”‚   â””â”€â”€ test_app_redis_http.py
</span></span><span class="line"><span class="cl">â”‚   â”‚
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ integration/
</span></span><span class="line"><span class="cl">â”‚   â”‚   â””â”€â”€ test_app_redis.py
</span></span><span class="line"><span class="cl">â”‚   â”‚
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ unit/
</span></span><span class="line"><span class="cl">â”‚   â”‚   â””â”€â”€ test_app.py
</span></span><span class="line"><span class="cl">â”‚   â”‚
</span></span><span class="line"><span class="cl">â”‚   â””â”€â”€ conftest.py
</span></span><span class="line"><span class="cl">â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€ venv/
</span></span><span class="line"><span class="cl">â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€ constraints.txt
</span></span><span class="line"><span class="cl">â””â”€â”€ pyproject.toml
</span></span></code></pre></div><p>æ‚¨å°†è¦å®æ–½çš„æµ‹è¯•åœºæ™¯å°†ç±»ä¼¼äºæ‚¨çš„é›†æˆæµ‹è¯•ã€‚ä¸è¿‡ï¼Œä¸»è¦åŒºåˆ«åœ¨äºæ‚¨å°†é€šè¿‡ç½‘ç»œå°†å®é™…çš„ HTTP è¯·æ±‚å‘é€åˆ°å®æ—¶ Web æœåŠ¡å™¨ï¼Œè€Œä¸æ˜¯ä¾èµ– Flask çš„æµ‹è¯•å®¢æˆ·ç«¯ã€‚</p>
<p>ä¸ºæ­¤ï¼Œæ‚¨å°†ä½¿ç”¨ç¬¬ä¸‰æ–¹ <a href="https://realpython.com/python-requests/">requests</a> åº“ï¼Œæ‚¨å¿…é¡»é¦–å…ˆåœ¨ <code>pyproject.toml</code> æ–‡ä»¶ä¸­å°†å…¶æŒ‡å®šä¸ºå¦ä¸€ä¸ªå¯é€‰ä¾èµ–é¡¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-toml" data-lang="toml"><span class="line"><span class="cl"><span class="c"># pyproject.toml</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="nx">build-system</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">requires</span> <span class="p">=</span> <span class="p">[</span><span class="s2">&#34;setuptools&gt;=67.0.0&#34;</span><span class="p">,</span> <span class="s2">&#34;wheel&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">build-backend</span> <span class="p">=</span> <span class="s2">&#34;setuptools.build_meta&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="nx">project</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">name</span> <span class="p">=</span> <span class="s2">&#34;page-tracker&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">version</span> <span class="p">=</span> <span class="s2">&#34;1.0.0&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">dependencies</span> <span class="p">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Flask&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;redis&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="nx">project</span><span class="p">.</span><span class="nx">optional-dependencies</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">dev</span> <span class="p">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;pytest&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;pytest-timeout&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;requests&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><p>æ‚¨ä¸ä¼šä½¿ç”¨ <code>requests</code> åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡ŒæœåŠ¡å™¨ï¼Œå› æ­¤æ— éœ€å°†å…¶ä½œä¸ºå¸¸è§„ä¾èµ–é¡¹ã€‚åŒæ ·ï¼Œä½¿ç”¨å¯ç¼–è¾‘æ¨¡å¼é‡æ–°å®‰è£…å¸¦æœ‰å¯é€‰ä¾èµ–é¡¹çš„ Python åŒ…ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ python -m pip install --editable <span class="s2">&#34;.[dev]&#34;</span>
</span></span></code></pre></div><p>æ‚¨ç°åœ¨å¯ä»¥åœ¨ç«¯åˆ°ç«¯æµ‹è¯•ä¸­ä½¿ç”¨å·²å®‰è£…çš„ <code>requests</code> åº“ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"> <span class="c1"># test/e2e/test_app_redis_http.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pytest</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@pytest.mark.timeout</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">test_should_update_redis</span><span class="p">(</span><span class="n">redis_client</span><span class="p">,</span> <span class="n">flask_url</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Given</span>
</span></span><span class="line"><span class="cl">    <span class="n">redis_client</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&#34;page_views&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># When</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">flask_url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Then</span>
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s2">&#34;This page has been seen 5 times.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="n">redis_client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;page_views&#34;</span><span class="p">)</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&#34;5&#34;</span>
</span></span></code></pre></div><p>é™¤äº†è´Ÿè´£å‘é€ HTTP GET è¯·æ±‚çš„ç¬¬ 12 è¡Œä¹‹å¤–ï¼Œæ­¤ä»£ç ä¸æ‚¨çš„é›†æˆæµ‹è¯•å‡ ä¹ç›¸åŒã€‚ä¹‹å‰ï¼Œæ‚¨å°†è¯¥è¯·æ±‚å‘é€åˆ°æµ‹è¯•å®¢æˆ·ç«¯çš„æ ¹åœ°å€ï¼Œç”¨æ–œæ å­—ç¬¦ ( <code>/</code> ) è¡¨ç¤ºã€‚ç°åœ¨ï¼Œæ‚¨ä¸çŸ¥é“å¯èƒ½åœ¨è¿œç¨‹ä¸»æœºä¸Šè¿è¡Œçš„ Flask æœåŠ¡å™¨çš„ç¡®åˆ‡åŸŸæˆ– IP åœ°å€ã€‚å› æ­¤ï¼Œæ‚¨çš„å‡½æ•°æ¥æ”¶ä¸€ä¸ª Flask URL ä½œä¸ºå‚æ•°ï¼Œ <code>pytest</code> å°†å…¶ä½œä¸ºå›ºå®šè£…ç½®æ³¨å…¥ã€‚</p>
<p>æ‚¨å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæä¾›ç‰¹å®šçš„ç½‘ç»œæœåŠ¡å™¨åœ°å€ã€‚åŒæ ·ï¼Œæ‚¨çš„ Redis æœåŠ¡å™¨å¯èƒ½åœ¨ä¸åŒçš„ä¸»æœºä¸Šè¿è¡Œï¼Œå› æ­¤æ‚¨ä¹Ÿéœ€è¦æä¾›å…¶åœ°å€ä½œä¸ºå‘½ä»¤è¡Œå‚æ•°ã€‚å¯æ˜¯ç­‰ç­‰ï¼æ‚¨çš„ Flask åº”ç”¨ç¨‹åºå½“å‰æœŸæœ› Redis å§‹ç»ˆåœ¨æœ¬åœ°ä¸»æœºä¸Šè¿è¡Œã€‚ç»§ç»­å¹¶æ›´æ–°æ‚¨çš„ä»£ç ä»¥ä½¿å…¶å¯é…ç½®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># src/page_tracker/app.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">cache</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">redis</span> <span class="kn">import</span> <span class="n">Redis</span><span class="p">,</span> <span class="n">RedisError</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.get</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">page_views</span> <span class="o">=</span> <span class="n">redis</span><span class="p">()</span><span class="o">.</span><span class="n">incr</span><span class="p">(</span><span class="s2">&#34;page_views&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="n">RedisError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&#34;Redis error&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;Sorry, something went wrong </span><span class="se">\N{pensive face}</span><span class="s2">&#34;</span><span class="p">,</span> <span class="mi">500</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&#34;This page has been seen </span><span class="si">{</span><span class="n">page_views</span><span class="si">}</span><span class="s2"> times.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@cache</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">redis</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Redis</span><span class="o">.</span><span class="n">from_url</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&#34;REDIS_URL&#34;</span><span class="p">,</span> <span class="s2">&#34;redis://localhost:6379&#34;</span><span class="p">))</span>
</span></span></code></pre></div><p>é€šå¸¸ä½¿ç”¨ç¯å¢ƒå˜é‡æ¥è®¾ç½®æ•æ„Ÿæ•°æ®ï¼Œä¾‹å¦‚æ•°æ®åº“ URLï¼Œå› ä¸ºå®ƒæä¾›äº†é¢å¤–çº§åˆ«çš„å®‰å…¨æ€§å’Œçµæ´»æ€§ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨çš„ç¨‹åºéœ€è¦ä¸€ä¸ªè‡ªå®šä¹‰çš„ <code>REDIS_URL</code> å˜é‡ã€‚å¦‚æœåœ¨ç»™å®šç¯å¢ƒä¸­æœªæŒ‡å®šè¯¥å˜é‡ï¼Œåˆ™æ‚¨å°†å›é€€åˆ°é»˜è®¤ä¸»æœºå’Œç«¯å£ã€‚</p>
<p>è¦ä½¿ç”¨è‡ªå®šä¹‰å‘½ä»¤è¡Œå‚æ•°æ‰©å±• <code>pytest</code> ï¼Œæ‚¨å¿…é¡»ç¼–è¾‘ <code>conftest.py</code> å¹¶æŒ‰ä»¥ä¸‹æ–¹å¼è¿æ¥åˆ°æ¡†æ¶çš„å‚æ•°è§£æå™¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># test/conftest.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pytest</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">redis</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">page_tracker.app</span> <span class="kn">import</span> <span class="n">app</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">pytest_addoption</span><span class="p">(</span><span class="n">parser</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">parser</span><span class="o">.</span><span class="n">addoption</span><span class="p">(</span><span class="s2">&#34;--flask-url&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">parser</span><span class="o">.</span><span class="n">addoption</span><span class="p">(</span><span class="s2">&#34;--redis-url&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@pytest.fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">&#34;session&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">flask_url</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getoption</span><span class="p">(</span><span class="s2">&#34;--flask-url&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@pytest.fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">&#34;session&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">redis_url</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">request</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">getoption</span><span class="p">(</span><span class="s2">&#34;--redis-url&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@pytest.fixture</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">http_client</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@pytest.fixture</span><span class="p">(</span><span class="n">scope</span><span class="o">=</span><span class="s2">&#34;module&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">redis_client</span><span class="p">(</span><span class="n">redis_url</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">redis_url</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="o">.</span><span class="n">from_url</span><span class="p">(</span><span class="n">redis_url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">()</span>
</span></span></code></pre></div><p>æ‚¨ä½¿ç”¨ç±»ä¼¼äº Python çš„ <code>argparse</code> æ¨¡å—çš„è¯­æ³•å®šä¹‰ä¸¤ä¸ªå¯é€‰å‚æ•°ï¼Œ <code>--flask-url</code> å’Œ <code>--redis-url</code> ã€‚ç„¶åï¼Œæ‚¨å°†è¿™äº›å‚æ•°åŒ…è£…åœ¨ä¼šè¯èŒƒå›´çš„å›ºå®šè£…ç½®ä¸­ï¼Œæ‚¨å°†èƒ½å¤Ÿå°†å…¶æ³¨å…¥åˆ°æ‚¨çš„æµ‹è¯•å‡½æ•°å’Œå…¶ä»–å›ºå®šè£…ç½®ä¸­ã€‚å…·ä½“æ¥è¯´ï¼Œæ‚¨ç°æœ‰çš„ <code>redis_client()</code> fixture ç°åœ¨å¯ä»¥åˆ©ç”¨å¯é€‰çš„ Redis URLã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå› ä¸ºæ‚¨çš„ç«¯åˆ°ç«¯æµ‹è¯•å’Œé›†æˆæµ‹è¯•ä¾èµ–äºç›¸åŒçš„ <code>redis_client()</code> fixtureï¼Œæ‰€ä»¥æ‚¨å¯ä»¥é€šè¿‡åœ¨ä¸¤ç§ç±»å‹çš„æµ‹è¯•ä¸­æŒ‡å®š <code>--redis-url</code> é€‰é¡¹æ¥è¿æ¥åˆ°è¿œç¨‹ Redis æœåŠ¡å™¨ã€‚</p>
</blockquote>
<p>è¿™æ˜¯é€šè¿‡æŒ‡å®š Flask Web æœåŠ¡å™¨å’Œç›¸åº”çš„ Redis æœåŠ¡å™¨çš„ URL æ¥ä½¿ç”¨ <code>pytest</code> è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•çš„æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ python -m pytest -v test/e2e/ <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --flask-url http://127.0.0.1:5000 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --redis-url redis://127.0.0.1:6379
</span></span></code></pre></div><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥é€šè¿‡æœ¬åœ°ä¸»æœº ( <code>127.0.0.1</code> ) è®¿é—® Flask å’Œ Redisï¼Œä½†æ‚¨çš„åº”ç”¨ç¨‹åºå¯èƒ½ä¼šéƒ¨ç½²åˆ°ç”±å¤šå°è¿œç¨‹è®¡ç®—æœºç»„æˆçš„åœ°ç†åˆ†å¸ƒå¼ç¯å¢ƒä¸­ã€‚å½“ä½ åœ¨æœ¬åœ°æ‰§è¡Œæ­¤å‘½ä»¤æ—¶ï¼Œç¡®ä¿ Redis æ­£åœ¨è¿è¡Œå¹¶é¦–å…ˆå•ç‹¬å¯åŠ¨ä½ çš„ Flask æœåŠ¡å™¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ docker start redis-server
</span></span><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ flask --app page_tracker.app run
</span></span></code></pre></div><p>ä¸ºäº†æé«˜ä»£ç è´¨é‡ï¼Œå¦‚æœæ‚¨æœ‰èƒ½åŠ›ï¼Œå¯ä»¥ä¸æ–­å‘æ‚¨çš„åº”ç”¨ç¨‹åºæ·»åŠ æ›´å¤šç±»å‹çš„æµ‹è¯•ã€‚ä¸è¿‡ï¼Œè¿™é€šå¸¸éœ€è¦ä¸€ä¸ªå…¨èŒè½¯ä»¶è´¨é‡ä¿è¯å·¥ç¨‹å¸ˆå›¢é˜Ÿã€‚å¦ä¸€æ–¹é¢ï¼Œæ‰§è¡Œä»£ç å®¡æŸ¥æˆ–å…¶ä»–ç±»å‹çš„é™æ€ä»£ç åˆ†ææ˜¯ç›¸å½“å®¹æ˜“å®ç°çš„ï¼Œå¯ä»¥å‘ç°è®¸å¤šä»¤äººæƒŠè®¶çš„é—®é¢˜ã€‚æ‚¨ç°åœ¨å°†æŸ¥çœ‹æ­¤è¿‡ç¨‹ã€‚</p>
<h3 id="æ‰§è¡Œé™æ€ä»£ç åˆ†æå’Œå®‰å…¨æ‰«æ">æ‰§è¡Œé™æ€ä»£ç åˆ†æå’Œå®‰å…¨æ‰«æ</h3>
<p>ç°åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºå·²æŒ‰é¢„æœŸè¿è¡Œï¼Œæ˜¯æ—¶å€™åœ¨ä¸æ‰§è¡Œåº•å±‚ä»£ç çš„æƒ…å†µä¸‹æ‰§è¡Œé™æ€ä»£ç åˆ†æäº†ã€‚è¿™æ˜¯è½¯ä»¶å¼€å‘è¡Œä¸šçš„ä¸€ç§å¸¸è§åšæ³•ï¼Œå¯å¸®åŠ©å¼€å‘äººå‘˜è¯†åˆ«å…¶ä»£ç ä¸­çš„æ½œåœ¨è½¯ä»¶ç¼ºé™·å’Œå®‰å…¨é£é™©ã€‚</p>
<p>è™½ç„¶é™æ€åˆ†æçš„æŸäº›æ­¥éª¤å¯ä»¥è‡ªåŠ¨å®Œæˆï¼Œä½†å…¶ä»–æ­¥éª¤é€šå¸¸éœ€è¦æ‰‹åŠ¨å®Œæˆï¼Œä¾‹å¦‚åŒè¡Œè¯„å®¡ã€‚</p>
<p>æ‚¨å°†ä½¿ç”¨ä»¥ä¸‹è‡ªåŠ¨åŒ–å·¥å…·ï¼Œå› æ­¤è¯·å°†å®ƒä»¬ä½œä¸ºå¯é€‰ä¾èµ–é¡¹æ·»åŠ åˆ°æ‚¨çš„ <code>pyproject.toml</code> æ–‡ä»¶ä¸­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-toml" data-lang="toml"><span class="line"><span class="cl"><span class="c"># pyproject.toml</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="nx">build-system</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">requires</span> <span class="p">=</span> <span class="p">[</span><span class="s2">&#34;setuptools&gt;=67.0.0&#34;</span><span class="p">,</span> <span class="s2">&#34;wheel&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">build-backend</span> <span class="p">=</span> <span class="s2">&#34;setuptools.build_meta&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="nx">project</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">name</span> <span class="p">=</span> <span class="s2">&#34;page-tracker&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">version</span> <span class="p">=</span> <span class="s2">&#34;1.0.0&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">dependencies</span> <span class="p">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Flask&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;redis&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="nx">project</span><span class="p">.</span><span class="nx">optional-dependencies</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">dev</span> <span class="p">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;bandit&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;black&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;flake8&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;isort&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;pylint&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;pytest&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;pytest-timeout&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;requests&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><p>ä¹‹åä¸è¦å¿˜è®°é‡æ–°å®‰è£…å¹¶å›ºå®šæ‚¨çš„ä¾èµ–é¡¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ python -m pip install --editable <span class="s2">&#34;.[dev]&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ python -m pip freeze --exclude-editable &gt; constraints.txt
</span></span></code></pre></div><p>è¿™ä¼šå°†ä¸€äº›å‘½ä»¤è¡Œå®ç”¨å·¥å…·å¸¦å…¥æ‚¨çš„è™šæ‹Ÿç¯å¢ƒã€‚é¦–å…ˆï¼Œæ‚¨åº”è¯¥é€šè¿‡ä¸€è‡´åœ°æ ¼å¼åŒ–ä»£ç ã€å¯¹ <code>import</code> è¯­å¥è¿›è¡Œæ’åºå¹¶æ£€æŸ¥ PEP 8 åˆè§„æ€§æ¥æ¸…ç†ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ python -m black src/ --check
</span></span><span class="line"><span class="cl">would reformat /home/realpython/page-tracker/src/page_tracker/app.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Oh no! ğŸ’¥ ğŸ’” ğŸ’¥
</span></span><span class="line"><span class="cl"><span class="m">1</span> file would be reformatted, <span class="m">1</span> file would be left unchanged.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ python -m isort src/ --check
</span></span><span class="line"><span class="cl">ERROR: /home/.../app.py Imports are incorrectly sorted and/or formatted.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ python -m flake8 src/
</span></span><span class="line"><span class="cl">src/page_tracker/app.py:23:1: E302 expected <span class="m">2</span> blank lines, found <span class="m">1</span>
</span></span></code></pre></div><p>æ‚¨ä½¿ç”¨ <code>black</code> æ ‡è®°ä»£ç ä¸­çš„ä»»ä½•æ ¼å¼ä¸ä¸€è‡´ï¼Œä½¿ç”¨ <code>isort</code> ç¡®ä¿æ‚¨çš„ <code>import</code> è¯­å¥æ ¹æ®å®˜æ–¹å»ºè®®ä¿æŒç»„ç»‡ï¼Œä½¿ç”¨ <code>flake8</code> æ£€æŸ¥ä»»ä½•å…¶ä»– PEP 8 æ ·å¼è¿è§„ã€‚</p>
<p>å¦‚æœæ‚¨åœ¨è¿è¡Œè¿™äº›å·¥å…·åæ²¡æœ‰çœ‹åˆ°ä»»ä½•è¾“å‡ºï¼Œåˆ™æ„å‘³ç€æ²¡æœ‰ä»€ä¹ˆå¯ä»¥ä¿®å¤çš„ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœå‡ºç°è­¦å‘Šæˆ–é”™è¯¯ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥æ‰‹åŠ¨æ›´æ­£ä»»ä½•æŠ¥å‘Šçš„é—®é¢˜ï¼Œæˆ–è€…è®©è¿™äº›å·¥å…·åœ¨æ‚¨åˆ é™¤ <code>--check</code> æ ‡å¿—æ—¶è‡ªåŠ¨æ‰§è¡Œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ python -m black src/
</span></span><span class="line"><span class="cl">reformatted /home/realpython/page-tracker/src/page_tracker/app.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">All <span class="k">done</span>! âœ¨ ğŸ° âœ¨
</span></span><span class="line"><span class="cl"><span class="m">1</span> file reformatted, <span class="m">1</span> file left unchanged.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ python -m isort src/
</span></span><span class="line"><span class="cl">Fixing /home/realpython/page-tracker/src/page_tracker/app.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ python -m flake8 src/
</span></span></code></pre></div><p>å¦‚æœæ²¡æœ‰ <code>--check</code> æ ‡å¿—ï¼Œ <code>black</code> å’Œ <code>isort</code> éƒ½ä¼šç»§ç»­å¹¶åœ¨ä¸è¯¢é—®çš„æƒ…å†µä¸‹é‡æ–°æ ¼å¼åŒ–å—å½±å“çš„æ–‡ä»¶ã€‚è¿è¡Œè¿™ä¸¤ä¸ªå‘½ä»¤è¿˜è§£å†³äº† PEP 8 åˆè§„æ€§é—®é¢˜ï¼Œå› ä¸º <code>flake8</code> ä¸å†è¿”å›ä»»ä½•æ ·å¼è¿è§„ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šéµå¾ªæ•´ä¸ªå›¢é˜Ÿçš„é€šç”¨ä»£ç é£æ ¼çº¦å®šæœ‰åŠ©äºä¿æŒä»£ç æ•´æ´ã€‚è¿™æ ·ï¼Œå½“ä¸€ä¸ªäººæ›´æ–°æºæ–‡ä»¶æ—¶ï¼Œå›¢é˜Ÿæˆå‘˜å°±ä¸å¿…å¯¹ä¸ç›¸å…³ä»£ç éƒ¨åˆ†ï¼ˆä¾‹å¦‚ç©ºæ ¼ï¼‰çš„æ›´æ”¹è¿›è¡Œåˆ†ç±»ã€‚</p>
</blockquote>
<p>ä¸€æ—¦ä¸€åˆ‡éƒ½å¹²å‡€äº†ï¼Œæ‚¨å°±å¯ä»¥å¯¹ä»£ç è¿›è¡Œ lint ä»¥æŸ¥æ‰¾æ½œåœ¨çš„ä»£ç å¼‚å‘³æˆ–æ”¹è¿›å®ƒçš„æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ python -m pylint src/
</span></span></code></pre></div><p>å½“æ‚¨é’ˆå¯¹ Web åº”ç”¨ç¨‹åºçš„æºä»£ç è¿è¡Œ <code>pylint</code> æ—¶ï¼Œå®ƒå¯èƒ½ä¼šå¼€å§‹æŠ±æ€¨æˆ–å¤šæˆ–å°‘æœ‰ç”¨çš„ä¸œè¥¿ã€‚å®ƒé€šå¸¸å‘å‡ºå±äºå‡ ä¸ªç±»åˆ«çš„æ¶ˆæ¯ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>E:</strong> Errors</li>
<li><strong>W:</strong> Warnings</li>
<li><strong>C:</strong> è¿åå…¬çº¦</li>
<li><strong>R:</strong> é‡æ„å»ºè®®</li>
</ul>
<p>æ¯æ¡è¯„è®ºéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œä¾‹å¦‚ <code>C0116</code> ï¼Œå¦‚æœæ‚¨è§‰å¾—å®ƒæ²¡æœ‰å¸®åŠ©ï¼Œæ‚¨å¯ä»¥å°†å…¶éšè—ã€‚æ‚¨å¯ä»¥åœ¨å…¨å±€é…ç½®æ–‡ä»¶ä¸­åŒ…å«æŠ‘åˆ¶çš„æ ‡è¯†ç¬¦ä»¥è·å¾—æ°¸ä¹…æ•ˆæœï¼Œæˆ–è€…ä½¿ç”¨å‘½ä»¤è¡Œå¼€å…³å¿½ç•¥ç»™å®šè¿è¡Œä¸­çš„æŸäº›é”™è¯¯ã€‚</p>
<p>æ‚¨è¿˜å¯ä»¥åœ¨ç»™å®šè¡Œä¸Šæ·»åŠ ç‰¹æ®Šæ ¼å¼çš„ Python æ³¨é‡Šä»¥è¯´æ˜ç‰¹æ®Šæƒ…å†µï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># src/page_tracker/app.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">cache</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">redis</span> <span class="kn">import</span> <span class="n">Redis</span><span class="p">,</span> <span class="n">RedisError</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.get</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">page_views</span> <span class="o">=</span> <span class="n">redis</span><span class="p">()</span><span class="o">.</span><span class="n">incr</span><span class="p">(</span><span class="s2">&#34;page_views&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="n">RedisError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">app</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&#34;Redis error&#34;</span><span class="p">)</span>  <span class="c1"># pylint: disable=E1101</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;Sorry, something went wrong </span><span class="se">\N{pensive face}</span><span class="s2">&#34;</span><span class="p">,</span> <span class="mi">500</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&#34;This page has been seen </span><span class="si">{</span><span class="n">page_views</span><span class="si">}</span><span class="s2"> times.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@cache</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">redis</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Redis</span><span class="o">.</span><span class="n">from_url</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&#34;REDIS_URL&#34;</span><span class="p">,</span> <span class="s2">&#34;redis://localhost:6379&#34;</span><span class="p">))</span>
</span></span></code></pre></div><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å‘Šè¯‰ <code>pylint</code> å¿½ç•¥é”™è¯¯ E1101 çš„ç‰¹å®šå®ä¾‹ï¼Œè€Œä¸æ˜¯å®Œå…¨æŠ‘åˆ¶å®ƒã€‚è¿™æ˜¯ä¸€ä¸ªè¯¯æŠ¥ï¼Œå› ä¸º <code>.logger</code> æ˜¯ Flask åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„åŠ¨æ€å±æ€§ï¼Œåœ¨é™æ€åˆ†æè¿‡ç¨‹ä¸­ä¸å¯ç”¨ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå¦‚æœæ‚¨æ‰“ç®—ä½¿ç”¨ <code>pylint</code> ä½œä¸ºè‡ªåŠ¨åŒ–æŒç»­é›†æˆç®¡é“çš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½éœ€è¦æŒ‡å®šå®ƒä½•æ—¶åº”è¯¥é€€å‡ºå¹¶æ˜¾ç¤ºé”™è¯¯ä»£ç ï¼Œè¿™é€šå¸¸ä¼šåœæ­¢ç®¡é“çš„åç»­æ­¥éª¤ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å°†å…¶é…ç½®ä¸ºå§‹ç»ˆè¿”å›ä¸­æ€§é€€å‡ºä»£ç é›¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ python -m pylint src/ --exit-zero
</span></span></code></pre></div><p>è¿™æ°¸è¿œä¸ä¼šåœæ­¢ç®¡é“è¿è¡Œï¼Œå³ä½¿ <code>pylint</code> åœ¨ä»£ç ä¸­å‘ç°ä¸€äº›é—®é¢˜ã€‚æˆ–è€…ï¼Œä½¿ç”¨ <code>--fail-under</code> ï¼Œæ‚¨å¯ä»¥æŒ‡å®šä»»æ„åˆ†æ•°é˜ˆå€¼ï¼Œ <code>pylint</code> å°†åœ¨è¯¥é˜ˆå€¼æ—¶é€€å‡ºå¹¶æ˜¾ç¤ºé”™è¯¯ä»£ç ã€‚</p>
</blockquote>
<p>æ‚¨ä¼šæ³¨æ„åˆ° <code>pylint</code> ä¸ºæ‚¨çš„ä»£ç æ‰“åˆ†å¹¶å¯¹å…¶è¿›è¡Œè·Ÿè¸ªã€‚å½“æ‚¨ä»¥æŸç§æ–¹å¼è§£å†³é—®é¢˜å¹¶å†æ¬¡è¿è¡Œè¯¥å·¥å…·æ—¶ï¼Œå®ƒä¼šæŠ¥å‘Šä¸€ä¸ªæ–°åˆ†æ•°å¹¶å‘Šè¯‰æ‚¨å®ƒæ”¹å–„æˆ–æ¶åŒ–äº†å¤šå°‘ã€‚ä½¿ç”¨æ‚¨çš„æœ€ä½³åˆ¤æ–­æ¥å†³å®š <code>pylint</code> æŠ¥å‘Šçš„é—®é¢˜æ˜¯å¦å€¼å¾—ä¿®å¤ã€‚</p>
<p>æœ€åï¼Œæ— æ„ä¸­é€šè¿‡æºä»£ç æ³„éœ²æ•æ„Ÿæ•°æ®æˆ–æš´éœ²å…¶ä»–å®‰å…¨æ¼æ´çš„æƒ…å†µéå¸¸æ™®éã€‚å®ƒç”šè‡³å‘ç”Ÿåœ¨æœ€å¥½çš„è½¯ä»¶å·¥ç¨‹å¸ˆèº«ä¸Šã€‚æœ€è¿‘ï¼ŒGitHub åœ¨ä¸€ä¸ªå…¬å…±å­˜å‚¨åº“ä¸­<a href="https://github.blog/2023-03-23-we-updated-our-rsa-ssh-host-key/#what-happened-and-what-actions-have-we-taken">æš´éœ²äº†å®ƒçš„ç§é’¥</a>ï¼Œè¿™å¯èƒ½è®©æ”»å‡»è€…å†’å……è¿™ä¸ªå·¨å¤´ã€‚ä¸ºäº†é™ä½æ­¤ç±»äº‹ä»¶çš„é£é™©ï¼Œæ‚¨åº”è¯¥åœ¨å°†æºä»£ç éƒ¨ç½²åˆ°ä»»ä½•åœ°æ–¹ä¹‹å‰å¯¹å…¶è¿›è¡Œå®‰å…¨æˆ–æ¼æ´æ‰«æã€‚</p>
<p>è¦æ‰«ææ‚¨çš„ä»£ç ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <a href="https://bandit.readthedocs.io/en/latest/">bandit</a> ï¼Œå®ƒæ˜¯æ‚¨ä¹‹å‰ä½œä¸ºå¯é€‰ä¾èµ–é¡¹å®‰è£…çš„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ python -m bandit -r src/
</span></span></code></pre></div><p>å½“æ‚¨æŒ‡å®šæ–‡ä»¶å¤¹è·¯å¾„è€Œä¸æ˜¯æ–‡ä»¶è·¯å¾„æ—¶ï¼Œè¿˜å¿…é¡»åŒ…å« <code>-r</code> æ ‡å¿—ä»¥é€’å½’æ‰«æå®ƒã€‚æ­¤æ—¶ï¼Œ <code>bandit</code> åº”è¯¥ä¸ä¼šåœ¨æ‚¨çš„ä»£ç ä¸­å‘ç°ä»»ä½•é—®é¢˜ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨åœ¨ Flask åº”ç”¨ç¨‹åºåº•éƒ¨æ·»åŠ ä»¥ä¸‹ä¸¤è¡Œåå†æ¬¡è¿è¡Œå®ƒï¼Œé‚£ä¹ˆè¯¥å·¥å…·å°†æŠ¥å‘Šä¸åŒä¸¥é‡çº§åˆ«çš„é—®é¢˜ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># src/page_tracker/app.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&#34;0.0.0.0&#34;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span></code></pre></div><p>è¿™ç§ <a href="https://realpython.com/if-name-main-python/">name-main æƒ¯ç”¨è¯­</a>æ˜¯è®¸å¤š Flask åº”ç”¨ç¨‹åºä¸­å¸¸è§çš„æ¨¡å¼ï¼Œå› ä¸ºå®ƒä½¿å¼€å‘æ›´æ–¹ä¾¿ï¼Œè®©æ‚¨ç›´æ¥è¿è¡Œ Python æ¨¡å—ã€‚å¦ä¸€æ–¹é¢ï¼Œå®ƒæš´éœ²äº† Flask çš„è°ƒè¯•å™¨ï¼Œå…è®¸æ‰§è¡Œä»»æ„ä»£ç ï¼Œå¹¶é€šè¿‡åœ°å€ <code>0.0.0.0</code> ç»‘å®šåˆ°æ‰€æœ‰ç½‘ç»œæ¥å£ï¼Œä¸ºå…¬å…±æµé‡æ‰“å¼€æ‚¨çš„æœåŠ¡ã€‚</p>
<p>å› æ­¤ï¼Œä¸ºäº†ç¡®ä¿æ‚¨çš„ Flask åº”ç”¨ç¨‹åºæ˜¯å®‰å…¨çš„ï¼Œæ‚¨åº”è¯¥å§‹ç»ˆåœ¨å°†ä»£ç éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¹‹å‰è¿è¡Œ <code>bandit</code> æˆ–ç±»ä¼¼å·¥å…·ã€‚</p>
<p>å¥½çš„ã€‚æ‚¨çš„ Web åº”ç”¨ç¨‹åºåŒ…å«å•å…ƒã€é›†æˆå’Œç«¯åˆ°ç«¯æµ‹è¯•ã€‚è¿™æ„å‘³ç€è®¸å¤šè‡ªåŠ¨åŒ–å·¥å…·å·²ç»é™æ€åˆ†æå’Œä¿®æ”¹äº†å®ƒçš„æºä»£ç ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæ‚¨å°†ç»§ç»­é€šè¿‡å°†åº”ç”¨ç¨‹åºåŒ…è£…åœ¨ Docker å®¹å™¨ä¸­æ¥å®ç°æŒç»­é›†æˆï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥å°†æ•´ä¸ªé¡¹ç›®éƒ¨ç½²åˆ°è¿œç¨‹ç¯å¢ƒæˆ–å¿ å®åœ°å°†å…¶å¤åˆ¶åˆ°æœ¬åœ°è®¡ç®—æœºä¸Šã€‚</p>
<h2 id="å°†æ‚¨çš„-flask-web-åº”ç”¨ç¨‹åº-docker-åŒ–">å°†æ‚¨çš„ Flask Web åº”ç”¨ç¨‹åº Docker åŒ–</h2>
<p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæ‚¨å°†ä»¥ Docker å®¹å™¨çš„å½¢å¼è¿è¡Œæ‚¨çš„é¡µé¢è·Ÿè¸ªå™¨ Web åº”ç”¨ç¨‹åºï¼Œè¯¥å®¹å™¨å¯ä»¥ä¸åœ¨å¦ä¸€ä¸ªå®¹å™¨ä¸­è¿è¡Œçš„ Redis é€šä¿¡ã€‚è¿™æ ·çš„è®¾ç½®å¯¹äºå¼€å‘å’Œæµ‹è¯•ä»¥åŠå°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°è¿œç¨‹ç¯å¢ƒå¾ˆæœ‰ç”¨ã€‚</p>
<p>å³ä½¿æ‚¨çš„è®¡ç®—æœºä¸Šæ²¡æœ‰å®‰è£… Python æˆ– Redisï¼Œæ‚¨ä»ç„¶å¯ä»¥é€šè¿‡ Docker è¿è¡Œæ‚¨çš„é¡¹ç›®ã€‚</p>
<h3 id="ç†è§£-docker-æœ¯è¯­">ç†è§£ Docker æœ¯è¯­</h3>
<p>å¯¹åº”ç”¨ç¨‹åºè¿›è¡Œ Docker åŒ–æ¶‰åŠåˆ›å»º Dockerfileï¼Œå®ƒæ˜¯å¯¹ç¯å¢ƒæ‰€éœ€çŠ¶æ€çš„å£°æ˜æ€§æè¿°ã€‚å®ƒä¸ºè¿è¡Œæ—¶ç¯å¢ƒã€é…ç½®ä»¥åŠè¿è¡Œåº”ç”¨ç¨‹åºæ‰€éœ€çš„æ‰€æœ‰ä¾èµ–é¡¹å’Œåº“æä¾›æ¨¡æ¿ã€‚</p>
<p>è¦ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºæ³¨å…¥æ´»åŠ›ï¼Œæ‚¨å¿…é¡»æ ¹æ®è¯¥æè¿°æ„å»ºä¸€ä¸ª Docker é•œåƒã€‚æ‚¨å¯ä»¥å°† Docker é•œåƒè§†ä¸ºæ“ä½œç³»ç»Ÿåœ¨ç»™å®šæ—¶é—´çš„å¿«ç…§ã€‚å½“æ‚¨ä¸ä¸–ç•Œæˆ–å…¬å¸å†…éƒ¨å…±äº«æ‚¨çš„ Docker é•œåƒæ—¶ï¼Œå…¶ä»–äººå¯ä»¥é‡ç°ä¸æ‚¨å®Œå…¨ç›¸åŒçš„ç¯å¢ƒå¹¶è¿è¡Œç›¸åŒçš„åº”ç”¨ç¨‹åºã€‚</p>
<p>è¿™å›é¿äº†ç»å…¸ï¼Œä½†å®ƒé€‚ç”¨äºæˆ‘çš„æœºå™¨é—®é¢˜ã€‚</p>
<p>Docker é•œåƒæ˜¯ Docker å®¹å™¨çš„è“å›¾ã€‚æ¯ä¸ª Docker å®¹å™¨éƒ½æ˜¯ Docker é•œåƒçš„ä¸€ä¸ªå®ä¾‹ã€‚ä¸€ä¸ªå®¹å™¨æœ‰ç‹¬ç«‹çš„çŠ¶æ€å’Œèµ„æºï¼ŒåŒ…æ‹¬å®ƒè‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿã€ç¯å¢ƒå˜é‡å’Œç½‘ç»œæ¥å£ã€‚å•ä¸ª Docker å®¹å™¨é€šå¸¸è¿è¡Œå•ä¸ªè¿›ç¨‹ï¼Œä½¿å…¶æˆä¸ºæ‰˜ç®¡ç‰¹å®š<a href="https://realpython.com/python-microservices-grpc/">å¾®æœåŠ¡</a>çš„ç†æƒ³é€‰æ‹©ã€‚</p>
<p>é€šè¿‡æ·»åŠ æ›´å¤šå®¹å™¨ï¼Œæ‚¨å¯ä»¥ä¸´æ—¶æ‰©å±•ä¸€ä¸ªæˆ–å¤šä¸ªå¾®æœåŠ¡ä»¥å¤„ç†æµé‡é«˜å³°ï¼Œä¾‹å¦‚ï¼Œè¿™åœ¨å‡æœŸæœŸé—´å¯èƒ½å¾ˆå¸¸è§ã€‚ä½†æ˜¯ï¼Œæ‚¨çš„å¾®æœåŠ¡å¿…é¡»æ¶æ„è‰¯å¥½å¹¶ä¿æŒæ— çŠ¶æ€æ‰èƒ½ä½¿å…¶æœ‰æ•ˆã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šDocker å®¹å™¨ç±»ä¼¼äº Vagrant æˆ– VirtualBox ç­‰è™šæ‹Ÿæœºï¼Œä½†æ›´è½»å·§ä¸”å¯åŠ¨é€Ÿåº¦æ›´å¿«ã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥åŒæ—¶åœ¨ä¸»æœºä¸Šè¿è¡Œæ¯”è™šæ‹Ÿæœºæ›´å¤šçš„å®¹å™¨ã€‚</p>
<p>è¿™æ ·åšçš„åŸå› æ˜¯å®¹å™¨çš„å¼€é”€è¾ƒå°ï¼Œå› ä¸ºå®ƒä»¬å…±äº«æ“ä½œç³»ç»Ÿçš„å†…æ ¸ï¼Œè€Œè™šæ‹Ÿæœºè¿è¡Œåœ¨æ¨¡æ‹Ÿå®Œæ•´ç¡¬ä»¶å †æ ˆçš„ç®¡ç†ç¨‹åºä¸Šã€‚å¦ä¸€æ–¹é¢ï¼Œå®¹å™¨ä¸é‚£ä¹ˆå®‰å…¨ï¼Œå®ƒä»¬ä¹Ÿä¸æä¾›ä¸è™šæ‹Ÿæœºç›¸åŒçº§åˆ«çš„éš”ç¦»ã€‚</p>
</blockquote>
<p>å…¸å‹çš„åº”ç”¨ç¨‹åºåŒ…æ‹¬åœ¨éš”ç¦»çš„ Docker å®¹å™¨ä¸­è¿è¡Œçš„å¤šä¸ªæœåŠ¡ï¼Œè¿™äº›å®¹å™¨å¯ä»¥ç›¸äº’é€šä¿¡ã€‚æ‚¨çš„é¡µé¢è·Ÿè¸ªå™¨åº”ç”¨ç¨‹åºæœ‰ä»¥ä¸‹ä¸¤ä¸ªï¼š</p>
<ol>
<li>Web service</li>
<li>Redis service</li>
</ol>
<p>æ‚¨å·²ç»çŸ¥é“å¦‚ä½•é€šè¿‡ Docker è¿è¡Œ Redisã€‚ç°åœ¨ï¼Œæ˜¯æ—¶å€™å°†æ‚¨çš„ Flask Web åº”ç”¨ç¨‹åºæ²™ç›’åŒ–åˆ° Docker å®¹å™¨ä¸­ï¼Œä»¥ç®€åŒ–è¿™ä¸¤ç§æœåŠ¡çš„å¼€å‘å’Œéƒ¨ç½²è¿‡ç¨‹ã€‚</p>
<h3 id="äº†è§£-dockerfile-çš„å‰–æ">äº†è§£ Dockerfile çš„å‰–æ</h3>
<p>é¦–å…ˆï¼Œæ‚¨å°†å®šä¹‰ä¸€ä¸ªé€‚ç”¨äºå¼€å‘é˜¶æ®µçš„ç›¸å¯¹è¾ƒçŸ­çš„ Dockerfileã€‚åœ¨é¡¹ç›®æ ¹æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º <code>Dockerfile</code> çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸æ–‡ä»¶å±‚æ¬¡ç»“æ„ä¸­çš„ <code>src/</code> å­æ–‡ä»¶å¤¹å’Œ <code>pyproject.toml</code> é…ç½®æ–‡ä»¶å¤„äºåŒä¸€çº§åˆ«ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">page-tracker/
</span></span><span class="line"><span class="cl">â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€ src/
</span></span><span class="line"><span class="cl">â”‚   â””â”€â”€ page_tracker/
</span></span><span class="line"><span class="cl">â”‚       â”œâ”€â”€ __init__.py
</span></span><span class="line"><span class="cl">â”‚       â””â”€â”€ app.py
</span></span><span class="line"><span class="cl">â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€ test/
</span></span><span class="line"><span class="cl">â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€ venv/
</span></span><span class="line"><span class="cl">â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€ constraints.txt
</span></span><span class="line"><span class="cl">â”œâ”€â”€ Dockerfile
</span></span><span class="line"><span class="cl">â””â”€â”€ pyproject.toml
</span></span></code></pre></div><p>æ‚¨å¯ä»¥éšæ„å‘½åæ­¤æ–‡ä»¶ï¼Œä½†åšæŒé»˜è®¤å‘½åçº¦å®šå°†ä½¿æ‚¨ä¸å¿…åœ¨æ¯æ¬¡æ„å»ºé•œåƒæ—¶éƒ½æŒ‡å®šæ–‡ä»¶åã€‚ Docker æœŸæœ›çš„é»˜è®¤æ–‡ä»¶åæ˜¯ <code>Dockerfile</code> ï¼Œæ²¡æœ‰æ–‡ä»¶æ‰©å±•åã€‚è¯·æ³¨æ„ï¼Œå®ƒä»¥å¤§å†™å­—æ¯ <code>D</code> å¼€å¤´ã€‚</p>
<p>Dockerfile æ˜¯ä¸€ä¸ªçº¯æ–‡æœ¬æ–‡æ¡£ï¼Œå…¶ä¸­åˆ—å‡ºäº†ç»„è£…é•œåƒæ‰€éœ€çš„æ­¥éª¤ã€‚å®ƒéµå¾ªç‰¹å®šæ ¼å¼ï¼Œå®šä¹‰äº†ä¸€å¥—å›ºå®šçš„è¯´æ˜ä¾›æ‚¨ä½¿ç”¨ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šæ‚¨å¿…é¡»å°† Dockerfile ä¸­çš„æ¯æ¡æŒ‡ä»¤æ”¾åœ¨å•ç‹¬çš„ä¸€è¡Œä¸­ï¼Œä½†çœ‹åˆ°éå¸¸é•¿çš„è¡Œè¢«è¡Œè¿ç»­å­—ç¬¦ ( <code>\</code> ) å¤šæ¬¡æ‰“æ–­çš„æƒ…å†µå¹¶ä¸å°‘è§ã€‚äº‹å®ä¸Šï¼Œé€šå¸¸éœ€è¦åœ¨ä¸€è¡Œä¸­å¡å…¥å¤šä¸ªæ“ä½œï¼Œä»¥åˆ©ç”¨æ‚¨ç°åœ¨å°†è¦äº†è§£çš„ç¼“å­˜æœºåˆ¶ã€‚</p>
</blockquote>
<p>å½“æ‚¨ä» Dockerfile æ„å»ºé•œåƒæ—¶ï¼Œæ‚¨ä¾èµ–äºä¸€ç³»åˆ—å±‚ã€‚æ¯æ¡æŒ‡ä»¤éƒ½ä¼šåœ¨å‰ä¸€å±‚ä¹‹ä¸Šåˆ›å»ºä¸€ä¸ªåªè¯»å±‚ï¼Œå°è£…å¯¹é•œåƒåº•å±‚æ–‡ä»¶ç³»ç»Ÿçš„ä¸€äº›ä¿®æ”¹ã€‚å›¾å±‚å…·æœ‰å…¨å±€å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œè¿™å…è®¸ Docker å°†å›¾å±‚å­˜å‚¨åœ¨ç¼“å­˜ä¸­ã€‚è¿™æœ‰ä¸¤ä¸ªä¸»è¦ä¼˜ç‚¹ï¼š</p>
<ul>
<li>é€Ÿåº¦ï¼šDocker å¯ä»¥è·³è¿‡è‡ªä¸Šæ¬¡æ„å»ºä»¥æ¥æœªæ›´æ”¹çš„å±‚ï¼Œè€Œæ˜¯ä»ç¼“å­˜ä¸­åŠ è½½å®ƒä»¬ï¼Œä»è€Œæ˜¾ç€åŠ å¿«é•œåƒæ„å»ºé€Ÿåº¦ã€‚</li>
<li>å¤§å°ï¼šå¤šä¸ªé•œåƒå¯ä»¥å…±äº«å…¬å…±å›¾å±‚ï¼Œä»è€Œå‡å°å®ƒä»¬å„è‡ªçš„å¤§å°ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå±‚æ•°è¶Šå°‘ï¼Œé•œåƒå°ºå¯¸è¶Šå°ã€‚</li>
</ul>
<p>ç°åœ¨æ‚¨å·²ç»äº†è§£äº† Dockerfile çš„è¿™ç§åˆ†å±‚ç»“æ„ï¼Œæ‚¨å¯ä»¥å¼€å§‹å‘å…¶ä¸­æ·»åŠ æŒ‡ä»¤ï¼ŒåŒæ—¶äº†è§£åˆ›å»ºé«˜æ•ˆ Docker é•œåƒçš„æœ€ä½³å®è·µã€‚</p>
<h3 id="é€‰æ‹©åŸºç¡€-docker-é•œåƒ">é€‰æ‹©åŸºç¡€ Docker é•œåƒ</h3>
<p>æ¯ä¸ª Dockerfile ä¸­çš„ç¬¬ä¸€æ¡æŒ‡ä»¤ <code>FROM</code> å¿…é¡»å§‹ç»ˆå®šä¹‰ç”¨äºæ„å»ºæ–°é•œåƒçš„åŸºç¡€é•œåƒã€‚è¿™æ„å‘³ç€æ‚¨ä¸å¿…ä»å¤´å¼€å§‹ï¼Œè€Œæ˜¯å¯ä»¥é€‰æ‹©ä¸€ä¸ªå·²ç»æ„å»ºçš„åˆé€‚é•œåƒã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Python è§£é‡Šå™¨é™„å¸¦çš„é•œåƒï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># Dockerfile</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> python:3.11.2-slim-bullseye</span><span class="err">
</span></span></span></code></pre></div><p>åœ¨è¿™é‡Œï¼Œæ‚¨ä½¿ç”¨åä¸º <code>python</code> çš„å®˜æ–¹ Python é•œåƒï¼Œå®ƒæ‰˜ç®¡åœ¨ Docker Hub ä¸Šã€‚å®˜æ–¹é•œåƒç”±ç›¸åº”è¯­è¨€æˆ–æŠ€æœ¯çš„å®˜æ–¹ç»´æŠ¤è€…æ„å»ºå’Œç»´æŠ¤ã€‚å®ƒä»¬ä¸å±äº Docker Hub ä¸Šçš„ä»»ä½•ç‰¹å®šç”¨æˆ·æˆ–å›¢é˜Ÿï¼Œä½†åœ¨å…¨å±€å‘½åç©ºé—´ä¸­å¯ç”¨ï¼Œéšå¼ç§°ä¸º <code>library/</code> ï¼Œè€Œä¸æ˜¯æ›´ä¸“ä¸šçš„å˜ä½“ï¼Œå¦‚ <code>circleci/python</code> ã€‚</p>
<p>æ‚¨è¿˜å¯ä»¥åœ¨å†’å· ( <code>:</code> ) åæŒ‡å®šä¸€ä¸ªå¯é€‰çš„æ ‡ç­¾æˆ–æ ‡ç­¾åç§°ï¼Œä»¥ç¼©å°åŸºæœ¬é•œåƒçš„ç‰¹å®šç‰ˆæœ¬ã€‚æ‚¨å¯ä»¥é€šè¿‡å•å‡»ç›¸åº” Docker Hub é¡µé¢ä¸Šçš„â€œæ ‡ç­¾â€é€‰é¡¹å¡æ¥æµè§ˆç»™å®š Docker é•œåƒçš„æ‰€æœ‰å¯ç”¨æ ‡ç­¾ã€‚</p>
<p>æ³¨æ„ï¼šæ ‡ç­¾ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œä½†å°†å®ƒä»¬åŒ…å«åœ¨ <code>FROM</code> æŒ‡ä»¤ä¸­è¢«è®¤ä¸ºæ˜¯æœ€ä½³å®è·µã€‚æ‚¨åº”è¯¥å°½å¯èƒ½å…·ä½“ï¼Œä»¥é¿å…ä¸å¿…è¦çš„æ„å¤–ã€‚å¦‚æœæ‚¨çœç•¥è¯¥æ ‡è®°ï¼Œé‚£ä¹ˆ Docker å°†æ‹‰å–ä¸€ä¸ªæ ‡è®°ä¸º <code>latest</code> çš„é•œåƒï¼Œå…¶ä¸­å¯èƒ½åŒ…å«ä¸åˆé€‚çš„æ“ä½œç³»ç»Ÿæˆ–å½±å“æ‚¨çš„åº”ç”¨ç¨‹åºçš„è¿è¡Œæ—¶æ„å¤–æ›´æ”¹ã€‚</p>
<p>æ ‡ç­¾ <code>3.11.2-slim-bullseye</code> è¡¨ç¤ºæ‚¨çš„åŸºç¡€é•œåƒå°†æ˜¯ Debian Bullseye çš„ç²¾ç®€å˜ä½“ï¼Œä»…åŒ…å«åŸºæœ¬è¦ç´ ï¼Œè®©æ‚¨ç¨åå¯ä»¥æ ¹æ®éœ€è¦å®‰è£…ä»»ä½•å…¶ä»–è½¯ä»¶åŒ…ã€‚è¿™å‡å°äº†é•œåƒçš„å¤§å°å¹¶åŠ å¿«äº†ä¸‹è½½æ—¶é—´ã€‚æ­¤é•œåƒçš„å¸¸è§„å˜ä½“å’Œè¶…è–„å˜ä½“ä¹‹é—´çš„å¤§å°å·®å¼‚é«˜è¾¾å…«ç™¾å…†å­—èŠ‚ï¼</p>
<p>è¯¥æ ‡è®°è¿˜è¡¨æ˜æ‚¨çš„åŸºç¡€é•œåƒå°†éšå·²å®‰è£…çš„ Python 3.11.2 ä¸€èµ·æä¾›ï¼Œå› æ­¤æ‚¨å¯ä»¥ç«‹å³å¼€å§‹ä½¿ç”¨å®ƒã€‚</p>
<p>åœ¨æ‹‰å–åŸºç¡€é•œåƒåï¼Œæ‚¨å¯èƒ½æƒ³è¦ç«‹å³æ‰§è¡Œçš„ä¸‹ä¸€ä¸ªä»»åŠ¡æ˜¯ä½¿ç”¨æœ€æ–°çš„å®‰å…¨æ›´æ–°å’Œé”™è¯¯ä¿®å¤å¯¹å…¶è¿›è¡Œä¿®è¡¥ï¼Œè¿™äº›æ›´æ–°å’Œé”™è¯¯ä¿®å¤å¯èƒ½æ˜¯è‡ªé•œåƒåœ¨ Docker Hub ä¸Šå‘å¸ƒä»¥æ¥å‘å¸ƒçš„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># Dockerfile</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> python:3.11.2-slim-bullseye</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apt-get upgrade --yes<span class="err">
</span></span></span></code></pre></div><p>åœ¨ Debian ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>apt-get</code> å‘½ä»¤è·å–æœ€æ–°çš„è½¯ä»¶åŒ…åˆ—è¡¨å¹¶å‡çº§ä»»ä½•æœ‰å¯ç”¨æ›´æ–°çš„è½¯ä»¶åŒ…ã€‚è¯·æ³¨æ„ï¼Œè¿™ä¸¤ä¸ªå‘½ä»¤éƒ½ä½œä¸ºä¸€ä¸ª <code>RUN</code> æŒ‡ä»¤çš„ä¸€éƒ¨åˆ†æ‰§è¡Œï¼Œä»¥æœ€å¤§é™åº¦åœ°å‡å°‘æ–‡ä»¶ç³»ç»Ÿä¸­çš„å±‚æ•°ï¼Œä»è€Œé¿å…å ç”¨è¿‡å¤šçš„ç£ç›˜ç©ºé—´ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šDockerfile ä¸­æŒ‡ä»¤çš„é¡ºåºå¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒä¼šå½±å“æ„å»ºé•œåƒæ‰€éœ€çš„æ—¶é—´ã€‚</p>
<p>ç‰¹åˆ«æ˜¯ï¼Œæ‚¨åº”è¯¥å°†å…¶å±‚ç»å¸¸æ›´æ”¹çš„æŒ‡ä»¤æ”¾åœ¨ Dockerfile çš„åº•éƒ¨ï¼Œå› ä¸ºå®ƒä»¬æœ€æœ‰å¯èƒ½ä½¿ç¼“å­˜ä¸­çš„æ‰€æœ‰åç»­å±‚æ— æ•ˆã€‚</p>
</blockquote>
<p>å¥½çš„ã€‚æ‚¨å·²ç»é€‰æ‹©äº†åŸºæœ¬é•œåƒå¹¶å®‰è£…äº†æœ€æ–°çš„å®‰å…¨æ›´æ–°ã€‚æ‚¨å‡ ä¹å·²ç»å‡†å¤‡å¥½è®¾ç½®æ‚¨çš„ Flask åº”ç”¨ç¨‹åºï¼Œä½†è¿˜æœ‰å‡ ä¸ªæ­¥éª¤ã€‚</p>
<h3 id="éš”ç¦»ä½ çš„-docker-é•œåƒ">éš”ç¦»ä½ çš„ Docker é•œåƒ</h3>
<p>ä½¿ç”¨ Dockerfiles æ—¶çš„å¦ä¸€ä¸ªå¥½ä¹ æƒ¯æ˜¯ï¼Œä¸€æ—¦ä¸å†éœ€è¦å®ƒä»¬ï¼Œå°±åˆ›å»ºå¹¶åˆ‡æ¢åˆ°æ²¡æœ‰ç®¡ç†æƒé™çš„æ™®é€šç”¨æˆ·ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒDocker ä»¥è¶…çº§ç”¨æˆ·èº«ä»½è¿è¡Œæ‚¨çš„å‘½ä»¤ï¼Œæ¶æ„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒæ¥ä¸å—é™åˆ¶åœ°è®¿é—®æ‚¨çš„ä¸»æœºç³»ç»Ÿã€‚æ˜¯çš„ï¼ŒDocker æä¾›äº†å¯¹å®¹å™¨å’Œä¸»æœºçš„æ ¹çº§è®¿é—®æƒé™ï¼</p>
<p>ä»¥ä¸‹æ˜¯é¿å…è¿™ç§æ½œåœ¨å®‰å…¨é£é™©çš„æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Dockerfile</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">FROM</span> <span class="n">python</span><span class="p">:</span><span class="mf">3.11.2</span><span class="o">-</span><span class="n">slim</span><span class="o">-</span><span class="n">bullseye</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">RUN</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">update</span> <span class="o">&amp;&amp;</span> \
</span></span><span class="line"><span class="cl">    <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">upgrade</span> <span class="o">--</span><span class="n">yes</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">RUN</span> <span class="n">useradd</span> <span class="o">--</span><span class="n">create</span><span class="o">-</span><span class="n">home</span> <span class="n">realpython</span>
</span></span><span class="line"><span class="cl"><span class="n">USER</span> <span class="n">realpython</span>
</span></span><span class="line"><span class="cl"><span class="n">WORKDIR</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">realpython</span>
</span></span></code></pre></div><p>æ‚¨åˆ›å»ºä¸€ä¸ªåä¸º <code>realpython</code> çš„æ–°ç”¨æˆ·ï¼Œå¹¶å‘Šè¯‰ Docker ä»ç°åœ¨èµ·åœ¨ Dockerfile ä¸­ä½¿ç”¨è¯¥ç”¨æˆ·ã€‚æ‚¨è¿˜å°†å½“å‰å·¥ä½œç›®å½•è®¾ç½®ä¸ºæ­¤ç”¨æˆ·çš„ä¸»ç›®å½•ï¼Œè¿™æ ·æ‚¨å°±ä¸å¿…åœ¨åé¢çš„å‘½ä»¤ä¸­æ˜ç¡®æŒ‡å®šå®Œæ•´çš„æ–‡ä»¶è·¯å¾„ã€‚</p>
<p>å³ä½¿æ‚¨çš„ Docker å®¹å™¨å°†è¿è¡Œå•ä¸ª Flask åº”ç”¨ç¨‹åºï¼Œä¹Ÿè¯·è€ƒè™‘åœ¨å®¹å™¨æœ¬èº«å†…éƒ¨è®¾ç½®ä¸€ä¸ªä¸“ç”¨çš„è™šæ‹Ÿç¯å¢ƒã€‚è™½ç„¶æ‚¨æ— éœ€æ‹…å¿ƒå°†å¤šä¸ª Python é¡¹ç›®å½¼æ­¤éš”ç¦»ï¼Œå¹¶ä¸” Docker ä¸ºæ‚¨çš„ä¸»æœºæä¾›äº†ä¸€ä¸ªåˆç†çš„éš”ç¦»å±‚ï¼Œä½†æ‚¨ä»ç„¶å­˜åœ¨å¹²æ‰°å®¹å™¨è‡ªèº«ç³»ç»Ÿå·¥å…·çš„é£é™©ã€‚</p>
<p>ä¸å¹¸çš„æ˜¯ï¼Œè®¸å¤š Linux å‘è¡Œç‰ˆéƒ½ä¾èµ–äºå…¨å±€ Python å®‰è£…æ‰èƒ½é¡ºåˆ©è¿è¡Œã€‚å¦‚æœæ‚¨å¼€å§‹å°†åŒ…ç›´æ¥å®‰è£…åˆ°å…¨å±€ Python ç¯å¢ƒä¸­ï¼Œé‚£ä¹ˆæ‚¨å°±ä¸ºæ½œåœ¨çš„ç‰ˆæœ¬å†²çªæ‰“å¼€äº†å¤§é—¨ã€‚è¿™ç”šè‡³å¯èƒ½å¯¼è‡´ç ´åæ‚¨çš„ç³»ç»Ÿã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå¦‚æœæ‚¨ä»ç„¶ä¸ç›¸ä¿¡åœ¨ Docker å®¹å™¨å†…åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œé‚£ä¹ˆè¿™æ¡è­¦å‘Šæ¶ˆæ¯å¯èƒ½ä¼šæ”¹å˜æ‚¨çš„æƒ³æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">WARNING: Running pip as the <span class="s1">&#39;root&#39;</span> user can result in broken permissions
</span></span><span class="line"><span class="cl">and conflicting behaviour with the system package manager. It is
</span></span><span class="line"><span class="cl">â®‘recommended to use a virtual environment instead:
</span></span><span class="line"><span class="cl">â®‘https://pip.pypa.io/warnings/venv
</span></span></code></pre></div><p>åœ¨ Debian æˆ– Ubuntu ç­‰è¡ç”Ÿå‘è¡Œç‰ˆä¸Šå°è¯•ä½¿ç”¨ç³»ç»Ÿçš„å…¨å±€ <code>pip</code> å‘½ä»¤å®‰è£… Python åŒ…åï¼Œæ‚¨å¯èƒ½ä¼šçœ‹åˆ°è¿™ä¸€ç‚¹ã€‚</p>
</blockquote>
<p>åœ¨ Docker é•œåƒä¸­åˆ›å»ºå’Œæ¿€æ´»è™šæ‹Ÿç¯å¢ƒçš„æœ€å¯é æ–¹æ³•æ˜¯ç›´æ¥ä¿®æ”¹å…¶ <code>PATH</code> ç¯å¢ƒå˜é‡ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># Dockerfile</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> python:3.11.2-slim-bullseye</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apt-get upgrade --yes<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> useradd --create-home realpython<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">USER</span><span class="s"> realpython</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /home/realpython</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> <span class="nv">VIRTUALENV</span><span class="o">=</span>/home/realpython/venv<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> python3 -m venv <span class="nv">$VIRTUALENV</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$VIRTUALENV</span><span class="s2">/bin:</span><span class="nv">$PATH</span><span class="s2">&#34;</span><span class="err">
</span></span></span></code></pre></div><p>é¦–å…ˆï¼Œå®šä¹‰ä¸€ä¸ªè¾…åŠ©å˜é‡ <code>VIRTUALENV</code> ï¼Œå…¶ä¸­åŒ…å«é¡¹ç›®è™šæ‹Ÿç¯å¢ƒçš„è·¯å¾„ï¼Œç„¶åä½¿ç”¨ Python çš„ <code>venv</code> æ¨¡å—åœ¨é‚£é‡Œåˆ›å»ºè¯¥ç¯å¢ƒã€‚ä½†æ˜¯ï¼Œä¸æ˜¯ä½¿ç”¨ shell è„šæœ¬æ¿€æ´»æ–°ç¯å¢ƒï¼Œè€Œæ˜¯é€šè¿‡è¦†ç›– <code>python</code> å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„æ¥æ›´æ–° <code>PATH</code> å˜é‡ã€‚</p>
<p>ä¸ºä»€ä¹ˆï¼Ÿè¿™æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºä»¥é€šå¸¸çš„æ–¹å¼æ¿€æ´»æ‚¨çš„ç¯å¢ƒåªæ˜¯æš‚æ—¶çš„ï¼Œä¸ä¼šå½±å“ä»æ‚¨çš„é•œåƒæ´¾ç”Ÿçš„ Docker å®¹å™¨ã€‚æ­¤å¤–ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ Dockerfile çš„ <code>RUN</code> æŒ‡ä»¤æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼Œé‚£ä¹ˆå®ƒåªä¼šæŒç»­åˆ° Dockerfile ä¸­çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œå› ä¸ºæ¯æ¡æŒ‡ä»¤éƒ½ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„ shell ä¼šè¯ã€‚</p>
<p>ä¸€æ—¦ä½ æœ‰äº†é¡¹ç›®çš„è™šæ‹Ÿç¯å¢ƒï¼Œä½ å°±å¯ä»¥å®‰è£…å¿…è¦çš„ä¾èµ–é¡¹ã€‚</p>
<h3 id="ç¼“å­˜ä½ çš„é¡¹ç›®ä¾èµ–">ç¼“å­˜ä½ çš„é¡¹ç›®ä¾èµ–</h3>
<p>ä¸åœ¨ä¸»æœºæœ¬åœ°å·¥ä½œç›¸æ¯”ï¼Œåœ¨ Dockerfile ä¸­å®‰è£…ä¾èµ–é¡¹çœ‹èµ·æ¥ç•¥æœ‰ä¸åŒã€‚é€šå¸¸ï¼Œæ‚¨ä¼šå®‰è£…ä¾èµ–é¡¹ï¼Œç„¶åç«‹å³å®‰è£… Python åŒ…ã€‚</p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œå½“æ‚¨æ„å»º Docker é•œåƒæ—¶ï¼Œå€¼å¾—å°†è¯¥è¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ä»¥åˆ©ç”¨å±‚ç¼“å­˜ï¼Œä»è€Œå‡å°‘æ„å»ºé•œåƒæ‰€éœ€çš„æ€»æ—¶é—´ã€‚</p>
<p>é¦–å…ˆï¼Œ <code>COPY</code> å°†å¸¦æœ‰é¡¹ç›®å…ƒæ•°æ®çš„ä¸¤ä¸ªæ–‡ä»¶ä»æ‚¨çš„ä¸»æœºå¯¼å…¥åˆ° Docker é•œåƒä¸­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># Dockerfile</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> python:3.11.2-slim-bullseye</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apt-get upgrade --yes<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> useradd --create-home realpython<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">USER</span><span class="s"> realpython</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /home/realpython</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> <span class="nv">VIRTUALENV</span><span class="o">=</span>/home/realpython/venv<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> python3 -m venv <span class="nv">$VIRTUALENV</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$VIRTUALENV</span><span class="s2">/bin:</span><span class="nv">$PATH</span><span class="s2">&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> --chown<span class="o">=</span>realpython pyproject.toml constraints.txt ./<span class="err">
</span></span></span></code></pre></div><p>æ‚¨åªéœ€å°†åŒ…å«æœ‰å…³é¡¹ç›®ä¾èµ–é¡¹ä¿¡æ¯çš„ <code>pyproject.toml</code> å’Œ <code>constraints.txt</code> æ–‡ä»¶å¤åˆ¶åˆ° Docker é•œåƒä¸­ <code>realpython</code> ç”¨æˆ·çš„ä¸»ç›®å½•ä¸­ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ–‡ä»¶å½’è¶…çº§ç”¨æˆ·æ‰€æœ‰ï¼Œå› æ­¤æ‚¨å¯èƒ½å¸Œæœ›ä½¿ç”¨ <code>--chown</code> å°†å…¶æ‰€æœ‰è€…æ›´æ”¹ä¸ºæ‚¨ä¹‹å‰åˆ›å»ºçš„æ™®é€šç”¨æˆ·ã€‚ <code>--chown</code> é€‰é¡¹ç±»ä¼¼äº <code>chown</code> å‘½ä»¤ï¼Œå®ƒä»£è¡¨æ›´æ”¹æ‰€æœ‰è€…ã€‚</p>
<p>æ‚¨å¯ä»¥åœ¨ç½‘ä¸Šæ‰¾åˆ°çš„è®¸å¤š Dockerfile ç¤ºä¾‹ä¼šä¸€æ¬¡æ€§å¤åˆ¶æ‰€æœ‰å†…å®¹ï¼Œä½†é‚£å¾ˆæµªè´¹ï¼</p>
<p>å¯èƒ½æœ‰å¤§é‡é¢å¤–æ–‡ä»¶ï¼Œä¾‹å¦‚åŒ…å«é¡¹ç›®æ•´ä¸ªå†å²çš„æœ¬åœ° Git å­˜å‚¨åº“ã€ä»£ç ç¼–è¾‘å™¨è®¾ç½®æˆ–é¡¹ç›®æ ¹æ–‡ä»¶å¤¹ä¸­çš„å…¶ä»–ä¸´æ—¶æ–‡ä»¶ã€‚</p>
<p>å®ƒä»¬ä¸ä»…ä¼šä½¿ç”Ÿæˆçš„é•œåƒè†¨èƒ€ï¼Œè€Œä¸”è¿˜ä¼šå¢åŠ è¿‡æ—©ä½¿ Docker å±‚ç¼“å­˜å¤±æ•ˆçš„å¯èƒ½æ€§ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šæ‚¨åº”è¯¥åªå¤åˆ¶æ‚¨ç›®å‰éœ€è¦çš„å•ä¸ªæ–‡ä»¶åˆ°æ‚¨çš„ Dockerfile ä¸­ã€‚å¦åˆ™ï¼Œå³ä½¿æ˜¯ä¸ç›¸å…³æ–‡ä»¶ä¸­çš„æœ€ç»†å¾®å˜åŒ–ä¹Ÿä¼šå¯¼è‡´å‰©ä½™å›¾å±‚é‡å»ºã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥å®šä¹‰ä¸€ä¸ª <code>.dockerignore</code> æ–‡ä»¶ï¼Œå…¶å·¥ä½œæ–¹å¼ä¸ <code>.gitignore</code> å‰¯æœ¬ç±»ä¼¼ï¼Œä½†æ˜ç¡®è¯´æ˜è¦å¤åˆ¶çš„å†…å®¹æ›´å®‰å…¨ã€‚</p>
</blockquote>
<p>å¦ä¸€ä¸ªå®¹æ˜“é—æ¼çš„éš¾é¢˜æ˜¯å½“æ‚¨åœ¨å°è¯•å®‰è£…é¡¹ç›®ä¾èµ–é¡¹ä¹‹å‰å¿˜è®°å‡çº§ <code>pip</code> æœ¬èº«ã€‚åœ¨æå°‘æ•°æƒ…å†µä¸‹ï¼Œ <code>pip</code> çš„æ—§ç‰ˆæœ¬å®é™…ä¸Šå¯ä»¥é˜»æ­¢å®‰è£…å…¶ä»–è½¯ä»¶åŒ…çš„æœ€æ–°ç‰ˆæœ¬ï¼åœ¨æ‚¨çš„æƒ…å†µä¸‹ï¼Œè¿˜å€¼å¾—å‡çº§ <code>setuptools</code> ï¼Œæ‚¨å°†å…¶ç”¨ä½œæ„å»ºåç«¯ï¼Œä»¥è·å–æœ€æ–°çš„å®‰å…¨è¡¥ä¸ã€‚</p>
<p>æ‚¨å¯ä»¥å°†ä»¥ä¸‹ä¸¤ä¸ªå‘½ä»¤ç»„åˆåœ¨ä¸€æ¡ <code>RUN</code> æŒ‡ä»¤ä¸­ä»¥å®‰è£…æ‚¨çš„ä¾èµ–é¡¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># Dockerfile</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> python:3.11.2-slim-bullseye</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apt-get upgrade --yes<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> useradd --create-home realpython<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">USER</span><span class="s"> realpython</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /home/realpython</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> <span class="nv">VIRTUALENV</span><span class="o">=</span>/home/realpython/venv<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> python3 -m venv <span class="nv">$VIRTUALENV</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$VIRTUALENV</span><span class="s2">/bin:</span><span class="nv">$PATH</span><span class="s2">&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> --chown<span class="o">=</span>realpython pyproject.toml constraints.txt ./<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> python -m pip install --upgrade pip setuptools <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    python -m pip install --no-cache-dir -c constraints.txt <span class="s2">&#34;.[dev]&#34;</span><span class="err">
</span></span></span></code></pre></div><p>æ‚¨å°† <code>pip</code> å’Œ <code>setuptools</code> å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚ç„¶åï¼Œå®‰è£…é¡¹ç›®æ‰€éœ€çš„ç¬¬ä¸‰æ–¹åº“ï¼ŒåŒ…æ‹¬ç”¨äºå¼€å‘çš„å¯é€‰ä¾èµ–é¡¹ã€‚æ‚¨é™åˆ¶å®ƒä»¬çš„ç‰ˆæœ¬ä»¥ç¡®ä¿ä¸€è‡´çš„ç¯å¢ƒï¼Œå¹¶å‘Šè¯‰ <code>pip</code> ä½¿ç”¨ <code>--no-cache-dir</code> ç¦ç”¨ç¼“å­˜ã€‚æ‚¨åœ¨è™šæ‹Ÿç¯å¢ƒä¹‹å¤–ä¸éœ€è¦è¿™äº›åŒ…ï¼Œå› æ­¤æ— éœ€ç¼“å­˜å®ƒä»¬ã€‚è¿™æ ·ï¼Œæ‚¨å°±å¯ä»¥ä½¿ Docker é•œåƒæ›´å°ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå› ä¸ºæ‚¨å®‰è£…äº†ä¾èµ–é¡¹è€Œæ²¡æœ‰åœ¨ Docker é•œåƒä¸­å®‰è£… <code>page-tracker</code> åŒ…ï¼Œæ‰€ä»¥å®ƒä»¬å°†ä¿ç•™åœ¨ç¼“å­˜å±‚ä¸­ã€‚å› æ­¤ï¼Œå¯¹æºä»£ç çš„ä»»ä½•æ›´æ”¹éƒ½ä¸éœ€è¦é‡æ–°å®‰è£…è¿™äº›ä¾èµ–é¡¹ã€‚</p>
</blockquote>
<p>æ‚¨çš„ Dockerfile æ­£åœ¨å¢é•¿å¹¶å˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œä½†è¯·ä¸è¦æ‹…å¿ƒã€‚åªéœ€è¦å®Œæˆå‡ ä¸ªæ­¥éª¤ï¼Œå°±å¿«å®Œæˆäº†ã€‚</p>
<h3 id="ä½œä¸ºæ„å»ºè¿‡ç¨‹çš„ä¸€éƒ¨åˆ†è¿è¡Œæµ‹è¯•">ä½œä¸ºæ„å»ºè¿‡ç¨‹çš„ä¸€éƒ¨åˆ†è¿è¡Œæµ‹è¯•</h3>
<p>æœ€åï¼Œæ˜¯æ—¶å€™å°†æ‚¨çš„æºä»£ç å¤åˆ¶åˆ° Docker é•œåƒä¸­ï¼Œå¹¶ä¸ linters å’Œå…¶ä»–é™æ€åˆ†æå·¥å…·ä¸€èµ·è¿è¡Œæ‚¨çš„æµ‹è¯•äº†ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># Dockerfile</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> python:3.11.2-slim-bullseye</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apt-get upgrade --yes<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> useradd --create-home realpython<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">USER</span><span class="s"> realpython</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /home/realpython</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> <span class="nv">VIRTUALENV</span><span class="o">=</span>/home/realpython/venv<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> python3 -m venv <span class="nv">$VIRTUALENV</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$VIRTUALENV</span><span class="s2">/bin:</span><span class="nv">$PATH</span><span class="s2">&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> --chown<span class="o">=</span>realpython pyproject.toml constraints.txt ./<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> python -m pip install --upgrade pip setuptools <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    python -m pip install --no-cache-dir -c constraints.txt <span class="s2">&#34;.[dev]&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> --chown<span class="o">=</span>realpython src/ src/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> --chown<span class="o">=</span>realpython test/ test/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> python -m pip install . -c constraints.txt <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    python -m pytest test/unit/ <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    python -m flake8 src/ <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    python -m isort src/ --check <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    python -m black src/ --check --quiet <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    python -m pylint src/ --disable<span class="o">=</span>C0114,C0116,R1705 <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    python -m bandit -r src/ --quiet<span class="err">
</span></span></span></code></pre></div><p>ä»ä¸»æœºå¤åˆ¶ <code>src/</code> å’Œ <code>test/</code> æ–‡ä»¶å¤¹åï¼Œå°† <code>page-tracker</code> åŒ…å®‰è£…åˆ°è™šæ‹Ÿç¯å¢ƒä¸­ã€‚é€šè¿‡å°†è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·èå…¥æ„å»ºè¿‡ç¨‹ï¼Œæ‚¨å¯ä»¥ç¡®ä¿å¦‚æœå…¶ä¸­ä»»ä½•ä¸€ä¸ªå·¥å…·è¿”å›éé›¶é€€å‡ºçŠ¶æ€ä»£ç ï¼Œåˆ™æ„å»ºæ‚¨çš„ Docker é•œåƒå°†å¤±è´¥ã€‚è¿™æ­£æ˜¯æ‚¨åœ¨å®æ–½æŒç»­é›†æˆç®¡é“æ—¶æƒ³è¦çš„ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œæ‚¨å¿…é¡»ç¦ç”¨ä¸¥é‡æ€§ä½çš„ <code>pylint</code> é—®é¢˜ C0114 ã€ C0116 å’Œ R1705 ï¼Œå®ƒä»¬ç°åœ¨å¹¶ä¸é‡è¦ã€‚å¦åˆ™ï¼Œå®ƒä»¬ä¼šé˜»æ­¢æ‚¨çš„ Docker é•œåƒæˆåŠŸæ„å»ºã€‚</p>
<p>å°†å„ä¸ªå‘½ä»¤ç»„åˆåœ¨ä¸€ä¸ª <code>RUN</code> æŒ‡ä»¤ä¸­çš„åŸå› æ˜¯ä¸ºäº†å‡å°‘è¦ç¼“å­˜çš„å±‚æ•°ã€‚è¯·è®°ä½ï¼Œæ‚¨æ‹¥æœ‰çš„å±‚è¶Šå¤šï¼Œç”Ÿæˆçš„ Docker é•œåƒå°±è¶Šå¤§ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šæ­¤æ—¶ï¼Œæ‚¨æ— æ³•æ‰§è¡Œéœ€è¦ Redis çš„é›†æˆæˆ–ç«¯åˆ°ç«¯æµ‹è¯•ï¼Œå› ä¸ºæ‚¨çš„ Docker é•œåƒåªæ¶‰åŠ Flask åº”ç”¨ç¨‹åºã€‚åœ¨å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°æŸä¸ªç¯å¢ƒåï¼Œæ‚¨å°†èƒ½å¤Ÿæ‰§è¡Œå®ƒä»¬ã€‚</p>
</blockquote>
<p>å½“æ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡å¹¶ä¸”æ²¡æœ‰ä»»ä½•é™æ€åˆ†æå·¥å…·æŠ¥å‘Šä»»ä½•é—®é¢˜æ—¶ï¼Œæ‚¨çš„ Docker é•œåƒå°±å·®ä¸å¤šå®Œæˆäº†ã€‚ä½†æ˜¯ï¼Œå½“æ‚¨ä»é•œåƒåˆ›å»ºæ–°å®¹å™¨æ—¶ï¼Œæ‚¨ä»ç„¶éœ€è¦å‘Šè¯‰ Docker è¦è¿è¡Œä»€ä¹ˆå‘½ä»¤ã€‚</p>
<h3 id="æŒ‡å®šè¦åœ¨-docker-å®¹å™¨ä¸­è¿è¡Œçš„å‘½ä»¤">æŒ‡å®šè¦åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œçš„å‘½ä»¤</h3>
<p>æœ€åä¸€æ­¥æ˜¯æŒ‡å®šè¦åœ¨ä» Docker é•œåƒæ´¾ç”Ÿçš„æ¯ä¸ªæ–° Docker å®¹å™¨ä¸­æ‰§è¡Œçš„å‘½ä»¤ã€‚åœ¨æ­¤é˜¶æ®µï¼Œæ‚¨å¯ä»¥åœ¨ Flask çš„å†…ç½®å¼€å‘æœåŠ¡å™¨ä¸Šå¯åŠ¨æ‚¨çš„ Web åº”ç”¨ç¨‹åºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># Dockerfile</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> python:3.11.2-slim-bullseye</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apt-get upgrade --yes<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> useradd --create-home realpython<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">USER</span><span class="s"> realpython</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /home/realpython</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> <span class="nv">VIRTUALENV</span><span class="o">=</span>/home/realpython/venv<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> python3 -m venv <span class="nv">$VIRTUALENV</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$VIRTUALENV</span><span class="s2">/bin:</span><span class="nv">$PATH</span><span class="s2">&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> --chown<span class="o">=</span>realpython pyproject.toml constraints.txt ./<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> python -m pip install --upgrade pip setuptools <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    python -m pip install --no-cache-dir -c constraints.txt <span class="s2">&#34;.[dev]&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> --chown<span class="o">=</span>realpython src/ src/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> --chown<span class="o">=</span>realpython test/ test/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> python -m pip install . -c constraints.txt <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    python -m pytest test/unit/ <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    python -m flake8 src/ <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    python -m isort src/ --check <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    python -m black src/ --check --quiet <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    python -m pylint src/ --disable<span class="o">=</span>C0114,C0116,R1705 <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    python -m bandit -r src/ --quiet<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="o">[</span><span class="s2">&#34;flask&#34;</span>, <span class="s2">&#34;--app&#34;</span>, <span class="s2">&#34;page_tracker.app&#34;</span>, <span class="s2">&#34;run&#34;</span>, <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>     <span class="s2">&#34;--host&#34;</span>, <span class="s2">&#34;0.0.0.0&#34;</span>, <span class="s2">&#34;--port&#34;</span>, <span class="s2">&#34;5000&#34;</span><span class="o">]</span><span class="err">
</span></span></span></code></pre></div><p>åœ¨è¿™é‡Œï¼Œæ‚¨ä½¿ç”¨ <code>CMD</code> æŒ‡ä»¤çš„ä¸‰ç§å½¢å¼ä¹‹ä¸€ï¼Œå®ƒç±»ä¼¼äº Python çš„ <code>subprocess.run()</code> å‡½æ•°çš„è¯­æ³•ã€‚è¯·æ³¨æ„ï¼Œæ‚¨å¿…é¡»å°†ä¸»æœºç»‘å®šåˆ° <code>0.0.0.0</code> åœ°å€ï¼Œä»¥ä¾¿ä» Docker å®¹å™¨å¤–éƒ¨è®¿é—®æ‚¨çš„åº”ç”¨ç¨‹åºã€‚</p>
<p>æ‚¨ç°åœ¨å¯ä»¥åŸºäºç°æœ‰çš„ Dockerfile æ„å»º Docker é•œåƒï¼Œå¹¶å¼€å§‹è¿è¡Œä»ä¸­æ´¾ç”Ÿçš„ Docker å®¹å™¨ã€‚ä»¥ä¸‹å‘½ä»¤ä¼šå°†æ‚¨çš„ Dockerfile è½¬æ¢ä¸ºåä¸º <code>page-tracker</code> çš„ Docker é•œåƒï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker build -t page-tracker .
</span></span></code></pre></div><p>å®ƒå°†åœ¨å½“å‰å·¥ä½œç›®å½•ä¸­æŸ¥æ‰¾ Dockerfileï¼Œç”¨ç‚¹ ( <code>.</code> ) è¡¨ç¤ºï¼Œå¹¶ä½¿ç”¨é»˜è®¤æ ‡ç­¾ <code>latest</code> æ ‡è®°ç”Ÿæˆçš„é•œåƒã€‚å› æ­¤ï¼Œå®Œæ•´çš„é•œåƒåç§°å°†æ˜¯ <code>page-tracker:latest</code> ã€‚</p>
<p>ä¸å¹¸çš„æ˜¯ï¼Œæ‚¨çš„é•œåƒç›®å‰åŒ…å«å¾ˆå¤šæ‚ç‰©ï¼Œä¾‹å¦‚æ‚¨åœ¨ç”Ÿäº§ä¸­æ°¸è¿œä¸éœ€è¦çš„æºä»£ç ã€æµ‹è¯•å’Œ linterã€‚</p>
<p>å®ƒä»¬ä¼šå¢åŠ é•œåƒçš„å¤§å°ï¼Œä½¿ä¸‹è½½å’Œéƒ¨ç½²é€Ÿåº¦å˜æ…¢ï¼Œå¦‚æœæ‚¨æ²¡æœ‰æ­£ç¡®ç»´æŠ¤å®ƒä»¬ï¼Œå®ƒä»¬è¿˜ä¼šå¯¼è‡´å®‰å…¨æ¼æ´ã€‚æ­¤å¤–ï¼Œè¿™äº›é¢å¤–çš„ç»„ä»¶å¯èƒ½ä¼šåœ¨æ’é™¤é”™è¯¯æ—¶å¼•èµ·é—®é¢˜ã€‚</p>
<p>å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ç§æ›´å¥½çš„æ–¹æ³•æ¥ç»„ç»‡æ‚¨çš„ Dockerfileï¼Œå…è®¸æ‚¨åˆ†å¤šä¸ªé˜¶æ®µæ„å»ºä¸€ä¸ªé•œåƒï¼Œæ‚¨ç°åœ¨å°†æ¢ç´¢å®ƒã€‚</p>
<h3 id="ä¸ºå¤šé˜¶æ®µæ„å»ºé‡æ–°ç»„ç»‡-dockerfile">ä¸ºå¤šé˜¶æ®µæ„å»ºé‡æ–°ç»„ç»‡ Dockerfile</h3>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ‚¨åˆ›å»ºçš„ Dockerfile ç›¸å½“ç®€å•ï¼Œåº”è¯¥é€‚åˆå¼€å‘ã€‚ä¿ç•™å®ƒï¼Œå› ä¸ºç¨åæ‚¨å°†éœ€è¦å®ƒæ¥ä½¿ç”¨ Docker Compose è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•ã€‚æ‚¨ç°åœ¨å¯ä»¥å¤åˆ¶æ­¤æ–‡ä»¶å¹¶ä¸ºå…¶æŒ‡å®šä¸€ä¸ªä¸åŒçš„åç§°ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å°† <code>.dev</code> åç¼€é™„åŠ åˆ°ä¸¤ä¸ªå‰¯æœ¬ä¹‹ä¸€ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">page-tracker/
</span></span><span class="line"><span class="cl">â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€ src/
</span></span><span class="line"><span class="cl">â”‚   â””â”€â”€ page_tracker/
</span></span><span class="line"><span class="cl">â”‚       â”œâ”€â”€ __init__.py
</span></span><span class="line"><span class="cl">â”‚       â””â”€â”€ app.py
</span></span><span class="line"><span class="cl">â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€ test/
</span></span><span class="line"><span class="cl">â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€ venv/
</span></span><span class="line"><span class="cl">â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€ constraints.txt
</span></span><span class="line"><span class="cl">â”œâ”€â”€ Dockerfile
</span></span><span class="line"><span class="cl">â”œâ”€â”€ Dockerfile.dev
</span></span><span class="line"><span class="cl">â””â”€â”€ pyproject.toml
</span></span></code></pre></div><p>ç°åœ¨ï¼Œç¼–è¾‘åä¸º <code>Dockerfile</code> çš„æ–‡ä»¶å¹¶åœ¨å°†æ„å»ºè¿‡ç¨‹åˆ†è§£ä¸ºå¤šä¸ªé˜¶æ®µæ—¶ä¿æŒæ‰“å¼€çŠ¶æ€ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šè¦åœ¨æ„å»ºé•œåƒæ—¶æŒ‡å®šè‡ªå®šä¹‰æ–‡ä»¶åè€Œä¸æ˜¯é»˜è®¤çš„ <code>Dockerfile</code> ï¼Œè¯·ä½¿ç”¨ <code>-f</code> æˆ– <code>--file</code> é€‰é¡¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker build -f Dockerfile.dev -t page-tracker .
</span></span></code></pre></div><p>è¿™ä¸ªæ–‡ä»¶åå¯ä»¥æ˜¯ä»»ä½•ä½ æƒ³è¦çš„ã€‚åªéœ€ç¡®ä¿åœ¨ <code>docker build</code> å‘½ä»¤ä¸­æ­£ç¡®å¼•ç”¨å®ƒå³å¯ã€‚</p>
</blockquote>
<p>å¤šé˜¶æ®µæ„å»ºèƒŒåçš„æƒ³æ³•æ˜¯å°† Dockerfile åˆ’åˆ†ä¸ºå¤šä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µéƒ½å¯ä»¥åŸºäºå®Œå…¨ä¸åŒçš„é•œåƒã€‚å½“æ‚¨çš„åº”ç”¨ç¨‹åºçš„å¼€å‘ç¯å¢ƒå’Œè¿è¡Œæ—¶ç¯å¢ƒä¸åŒæ—¶ï¼Œè¿™å°¤å…¶æœ‰ç”¨ã€‚</p>
<p>ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨ä»…ç”¨äºæ„å»ºå’Œæµ‹è¯•åº”ç”¨ç¨‹åºçš„ä¸´æ—¶é•œåƒä¸­å®‰è£…å¿…è¦çš„æ„å»ºå·¥å…·ï¼Œç„¶åå°†ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶å¤åˆ¶åˆ°æœ€ç»ˆé•œåƒä¸­ã€‚</p>
<p>å¤šé˜¶æ®µæ„å»ºå¯ä»¥ä½¿æ‚¨çš„é•œåƒæ›´å°ã€æ›´é«˜æ•ˆã€‚è¿™æ˜¯ä½¿ç”¨å½“å‰ Dockerfile æ„å»ºçš„åŒä¸€é•œåƒä¸æ‚¨å°†è¦ç¼–å†™çš„é•œåƒçš„æ¯”è¾ƒï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker images
</span></span><span class="line"><span class="cl">REPOSITORY     TAG       IMAGE ID       CREATED          SIZE
</span></span><span class="line"><span class="cl">page-tracker   prod      9cb2e3233522   <span class="m">5</span> minutes ago    204MB
</span></span><span class="line"><span class="cl">page-tracker   dev       f9918cb213dc   <span class="m">5</span> minutes ago    244MB
</span></span><span class="line"><span class="cl"><span class="o">(</span>...<span class="o">)</span>
</span></span></code></pre></div><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¤§å°å·®å¼‚å¹¶ä¸æ˜¾ç€ï¼Œä½†å½“æ‚¨æœ‰å¤šä¸ªé•œåƒè¦ç®¡ç†å’Œç§»åŠ¨æ—¶ï¼Œå®ƒä¼šè¿…é€Ÿå¢åŠ ã€‚</p>
<p>Dockerfile ä¸­çš„æ¯ä¸ªé˜¶æ®µéƒ½ä»¥å…¶è‡ªå·±çš„ <code>FROM</code> æŒ‡ä»¤å¼€å§‹ï¼Œå› æ­¤æ‚¨å°†æœ‰ä¸¤ä¸ªã€‚ç¬¬ä¸€ä¸ªé˜¶æ®µçœ‹èµ·æ¥ä¸æ‚¨å½“å‰çš„ Dockerfile å‡ ä¹å®Œå…¨ç›¸åŒï¼Œé™¤äº†æ‚¨å°†ä¸ºè¿™ä¸ªé˜¶æ®µå‘½å <code>builder</code> ï¼Œæ‚¨å¯ä»¥ç¨åå‚è€ƒï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl"># Dockerfile
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gd">-FROM python:3.11.2-slim-bullseye
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+FROM python:3.11.2-slim-bullseye AS builder
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>
</span></span><span class="line"><span class="cl"> RUN apt-get update &amp;&amp; \
</span></span><span class="line"><span class="cl">     apt-get upgrade --yes
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> RUN useradd --create-home realpython
</span></span><span class="line"><span class="cl"> USER realpython
</span></span><span class="line"><span class="cl"> WORKDIR /home/realpython
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> ENV VIRTUALENV=/home/realpython/venv
</span></span><span class="line"><span class="cl"> RUN python3 -m venv $VIRTUALENV
</span></span><span class="line"><span class="cl"> ENV PATH=&#34;$VIRTUALENV/bin:$PATH&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> COPY --chown=realpython pyproject.toml constraints.txt ./
</span></span><span class="line"><span class="cl"> RUN python -m pip install --upgrade pip setuptools &amp;&amp; \
</span></span><span class="line"><span class="cl">     python -m pip install --no-cache-dir -c constraints.txt &#34;.[dev]&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> COPY --chown=realpython src/ src/
</span></span><span class="line"><span class="cl"> COPY --chown=realpython test/ test/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> RUN python -m pip install . -c constraints.txt &amp;&amp; \
</span></span><span class="line"><span class="cl">     python -m pytest test/unit/ &amp;&amp; \
</span></span><span class="line"><span class="cl">     python -m flake8 src/ &amp;&amp; \
</span></span><span class="line"><span class="cl">     python -m isort src/ --check &amp;&amp; \
</span></span><span class="line"><span class="cl">     python -m black src/ --check --quiet &amp;&amp; \
</span></span><span class="line"><span class="cl">     python -m pylint src/ --disable=C0114,C0116,R1705 &amp;&amp; \
</span></span><span class="line"><span class="cl"><span class="gd">-    python -m bandit -r src/ --quiet
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+    python -m bandit -r src/ --quiet &amp;&amp; \
</span></span></span><span class="line"><span class="cl"><span class="gi">+    python -m pip wheel --wheel-dir dist/ . -c constraints.txt
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>
</span></span><span class="line"><span class="cl"><span class="gd">-CMD [&#34;flask&#34;, &#34;--app&#34;, &#34;page_tracker.app&#34;, &#34;run&#34;, \
</span></span></span><span class="line"><span class="cl"><span class="gd">-     &#34;--host&#34;, &#34;0.0.0.0&#34;, &#34;--port&#34;, &#34;5000&#34;]
</span></span></span></code></pre></div><p>å› ä¸ºæ‚¨è¦å°†æ‰“åŒ…çš„é¡µé¢è·Ÿè¸ªå™¨åº”ç”¨ç¨‹åºä»ä¸€ä¸ªé•œåƒä¼ è¾“åˆ°å¦ä¸€ä¸ªé•œåƒï¼Œæ‰€ä»¥æ‚¨å¿…é¡»æ·»åŠ ä½¿ç”¨ Python wheel æ ¼å¼æ„å»ºåˆ†å‘åŒ…çš„é¢å¤–æ­¥éª¤ã€‚ <code>pip wheel</code> å‘½ä»¤å°†åœ¨ <code>dist/</code> å­æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º <code>page_tracker-1.0.0-py3-none-any.whl</code> çš„æ–‡ä»¶ã€‚æ‚¨è¿˜å¯ä»¥ä»æ­¤é˜¶æ®µåˆ é™¤ <code>CMD</code> æŒ‡ä»¤ï¼Œå› ä¸ºå®ƒå°†æˆä¸ºä¸‹ä¸€é˜¶æ®µçš„ä¸€éƒ¨åˆ†ã€‚</p>
<p>ç¬¬äºŒä¸ªä¹Ÿæ˜¯æœ€åä¸€ä¸ªé˜¶æ®µï¼Œéšå¼å‘½åä¸º <code>stage-1</code> ï¼Œçœ‹èµ·æ¥æœ‰ç‚¹é‡å¤ï¼Œå› ä¸ºå®ƒåŸºäºç›¸åŒçš„é•œåƒï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># Dockerfile</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> python:3.11.2-slim-bullseye AS builder</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># ...</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> python:3.11.2-slim-bullseye</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apt-get upgrade --yes<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> useradd --create-home realpython<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">USER</span><span class="s"> realpython</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">WORKDIR</span><span class="s"> /home/realpython</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> <span class="nv">VIRTUALENV</span><span class="o">=</span>/home/realpython/venv<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> python3 -m venv <span class="nv">$VIRTUALENV</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ENV</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$VIRTUALENV</span><span class="s2">/bin:</span><span class="nv">$PATH</span><span class="s2">&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> --from<span class="o">=</span>builder /home/realpython/dist/page_tracker*.whl /home/realpython<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> python -m pip install --upgrade pip setuptools <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    python -m pip install --no-cache-dir page_tracker*.whl<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="o">[</span><span class="s2">&#34;flask&#34;</span>, <span class="s2">&#34;--app&#34;</span>, <span class="s2">&#34;page_tracker.app&#34;</span>, <span class="s2">&#34;run&#34;</span>, <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>     <span class="s2">&#34;--host&#34;</span>, <span class="s2">&#34;0.0.0.0&#34;</span>, <span class="s2">&#34;--port&#34;</span>, <span class="s2">&#34;5000&#34;</span><span class="o">]</span><span class="err">
</span></span></span></code></pre></div><p>æ‚¨é¦–å…ˆæŒ‰ç…§ç†Ÿæ‚‰çš„æ­¥éª¤å‡çº§ç³»ç»ŸåŒ…ã€åˆ›å»ºç”¨æˆ·å’Œåˆ›å»ºè™šæ‹Ÿç¯å¢ƒã€‚ç„¶åï¼Œçªå‡ºæ˜¾ç¤ºçš„è¡Œè´Ÿè´£ä» <code>builder</code> é˜¶æ®µå¤åˆ¶ wheel æ–‡ä»¶ã€‚ä½ åƒä»¥å‰ä¸€æ ·ç”¨ <code>pip</code> å®‰è£…å®ƒã€‚æœ€åï¼Œæ‚¨æ·»åŠ  <code>CMD</code> æŒ‡ä»¤ä»¥ä½¿ç”¨ Flask å¯åŠ¨æ‚¨çš„ Web åº”ç”¨ç¨‹åºã€‚</p>
<p>å½“æ‚¨ä½¿ç”¨è¿™æ ·çš„å¤šé˜¶æ®µ Dockerfile æ„å»ºé•œåƒæ—¶ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°ç¬¬ä¸€é˜¶æ®µéœ€è¦æ›´é•¿çš„æ—¶é—´æ‰èƒ½å®Œæˆï¼Œå› ä¸ºå®ƒå¿…é¡»å®‰è£…æ‰€æœ‰ä¾èµ–é¡¹ã€è¿è¡Œæµ‹è¯•å¹¶åˆ›å»º wheel æ–‡ä»¶ã€‚</p>
<p>ä½†æ˜¯ï¼Œæ„å»ºç¬¬äºŒé˜¶æ®µä¼šå¿«å¾ˆå¤šï¼Œå› ä¸ºå®ƒåªéœ€è¦å¤åˆ¶å¹¶å®‰è£…å®Œæˆçš„ wheel æ–‡ä»¶ã€‚å¦å¤–è¯·æ³¨æ„ï¼Œ <code>builder</code> é˜¶æ®µæ˜¯ä¸´æ—¶çš„ï¼Œå› æ­¤ä¹‹åä¸ä¼šåœ¨æ‚¨çš„ Docker é•œåƒä¸­ç•™ä¸‹ä»»ä½•ç—•è¿¹ã€‚</p>
<p>å¥½çš„ã€‚ä½ ç»ˆäºå‡†å¤‡å¥½æ„å»ºä½ çš„å¤šé˜¶æ®µ Docker é•œåƒäº†ï¼</p>
<h3 id="æ„å»ºå’Œç‰ˆæœ¬æ§åˆ¶ä½ çš„-docker-é•œåƒ">æ„å»ºå’Œç‰ˆæœ¬æ§åˆ¶ä½ çš„ Docker é•œåƒ</h3>
<p>åœ¨æ„å»ºé•œåƒä¹‹å‰ï¼Œå¼ºçƒˆå»ºè®®æ‚¨ä¸º Docker é•œåƒé€‰æ‹©ä¸€ä¸ªç‰ˆæœ¬æ§åˆ¶æ–¹æ¡ˆï¼Œå¹¶å§‹ç»ˆä½¿ç”¨å”¯ä¸€æ ‡ç­¾å¯¹å…¶è¿›è¡Œæ ‡è®°ã€‚è¿™æ ·ï¼Œæ‚¨å°±ä¼šçŸ¥é“åœ¨ä»»ä½•ç»™å®šç¯å¢ƒä¸­éƒ¨ç½²äº†ä»€ä¹ˆï¼Œå¹¶èƒ½å¤Ÿåœ¨éœ€è¦æ—¶å›æ»šåˆ°ä¹‹å‰çš„ç¨³å®šç‰ˆæœ¬ã€‚</p>
<p>å¯¹ Docker é•œåƒè¿›è¡Œç‰ˆæœ¬æ§åˆ¶æœ‰å‡ ç§ä¸åŒçš„ç­–ç•¥ã€‚ä¾‹å¦‚ï¼Œä¸€äº›æµè¡Œçš„åŒ…æ‹¬ï¼š</p>
<ul>
<li>è¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶ä½¿ç”¨ä»¥ç‚¹åˆ†éš”çš„ä¸‰ä¸ªæ•°å­—æ¥æŒ‡ç¤ºä¸»è¦ç‰ˆæœ¬ã€æ¬¡è¦ç‰ˆæœ¬å’Œè¡¥ä¸ç‰ˆæœ¬ã€‚</li>
<li>Git æäº¤å“ˆå¸Œä½¿ç”¨ç»‘å®šåˆ°é•œåƒä¸­æºä»£ç çš„ Git æäº¤çš„ SHA-1 å“ˆå¸Œã€‚</li>
<li>æ—¶é—´æˆ³ä½¿ç”¨æ—¶é—´ä¿¡æ¯ï¼ˆä¾‹å¦‚ Unix æ—¶é—´ï¼‰æ¥æŒ‡ç¤ºé•œåƒçš„æ„å»ºæ—¶é—´ã€‚</li>
</ul>
<p>æ²¡æœ‰ä»€ä¹ˆèƒ½é˜»æ­¢æ‚¨ç»“åˆå…¶ä¸­çš„ä¸€äº›ç­–ç•¥æ¥åˆ›å»ºä¸€ä¸ªæœ‰æ•ˆçš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿå°†å¸®åŠ©æ‚¨è·Ÿè¸ªé•œåƒä¸­çš„æ›´æ”¹ã€‚</p>
<p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†åšæŒä½¿ç”¨ Git æäº¤å“ˆå¸Œæ–¹æ³•ï¼Œå› ä¸ºå®ƒå¯ä»¥ç¡®ä¿æ‚¨çš„ Docker é•œåƒçš„æ ‡ç­¾æ˜¯å”¯ä¸€ä¸”ä¸å¯å˜çš„ã€‚èŠ±ç‚¹æ—¶é—´åœ¨æ‚¨çš„ <code>page-tracker/</code> æ–‡ä»¶å¤¹ä¸­åˆå§‹åŒ–ä¸€ä¸ªæœ¬åœ° Git å­˜å‚¨åº“ï¼Œå¹¶ä½¿ç”¨ä¸æ‚¨çš„å·¥ä½œç¯å¢ƒç›¸å…³çš„æ–‡ä»¶æ¨¡å¼å®šä¹‰ä¸€ä¸ª <code>.gitignore</code> ã€‚æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>pwd</code> å‘½ä»¤æ‰“å°æ‚¨çš„å·¥ä½œç›®å½•æ¥ä»”ç»†æ£€æŸ¥æ‚¨æ˜¯å¦åœ¨æ­£ç¡®çš„æ–‡ä»¶å¤¹ä¸­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="nb">pwd</span>
</span></span><span class="line"><span class="cl">/home/realpython/page-tracker
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ git init
</span></span><span class="line"><span class="cl">Initialized empty Git repository in /home/realpython/page-tracker/.git/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ curl -sL https://www.gitignore.io/api/python,pycharm+all &gt; .gitignore
</span></span></code></pre></div><p>åœ¨è¿™é‡Œï¼Œæ‚¨ä½¿ç”¨ <code>curl</code> ä» gitignore.io ä¸‹è½½å†…å®¹ï¼Œè¯·æ±‚ Git ä»è·Ÿè¸ªä¸­æ’é™¤ Python å’Œ PyCharm ç›¸å…³çš„æ–‡ä»¶æ¨¡å¼ã€‚ <code>-L</code> æ ‡å¿—æ˜¯è·Ÿéšé‡å®šå‘æ‰€å¿…éœ€çš„ï¼Œå› ä¸ºè¯¥ç½‘ç«™æœ€è¿‘ç§»åŠ¨åˆ°å…·æœ‰æ›´é•¿åŸŸçš„ä¸åŒåœ°å€ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä» GitHub çš„ <code>gitignore</code> å­˜å‚¨åº“ä¸­è·å–å…¶ä¸­ä¸€ä¸ªæ¨¡æ¿ï¼ŒæŸäº›ä»£ç ç¼–è¾‘å™¨ä¼šä½¿ç”¨è¯¥æ¨¡æ¿ã€‚</p>
<p>åˆå§‹åŒ–æœ¬åœ° Git å­˜å‚¨åº“åï¼Œæ‚¨å¯ä»¥è¿›è¡Œç¬¬ä¸€æ¬¡æäº¤å¹¶è·å–ç›¸åº”çš„å“ˆå¸Œå€¼ï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨ <code>git rev-parse</code> å‘½ä»¤ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ git add .
</span></span><span class="line"><span class="cl">$ git commit -m <span class="s2">&#34;Initial commit&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>master <span class="o">(</span>root-commit<span class="o">)</span> dde1dc9<span class="o">]</span> Initial commit
</span></span><span class="line"><span class="cl"> <span class="m">11</span> files changed, <span class="m">535</span> insertions<span class="o">(</span>+<span class="o">)</span>
</span></span><span class="line"><span class="cl"> create mode <span class="m">100644</span> .gitignore
</span></span><span class="line"><span class="cl"> create mode <span class="m">100644</span> Dockerfile
</span></span><span class="line"><span class="cl"> create mode <span class="m">100644</span> Dockerfile.dev
</span></span><span class="line"><span class="cl"> create mode <span class="m">100644</span> constraints.txt
</span></span><span class="line"><span class="cl"> create mode <span class="m">100644</span> pyproject.toml
</span></span><span class="line"><span class="cl"> create mode <span class="m">100644</span> src/page_tracker/__init__.py
</span></span><span class="line"><span class="cl"> create mode <span class="m">100644</span> src/page_tracker/app.py
</span></span><span class="line"><span class="cl"> create mode <span class="m">100644</span> test/conftest.py
</span></span><span class="line"><span class="cl"> create mode <span class="m">100644</span> test/e2e/test_app_redis_http.py
</span></span><span class="line"><span class="cl"> create mode <span class="m">100644</span> test/integration/test_app_redis.py
</span></span><span class="line"><span class="cl"> create mode <span class="m">100644</span> test/unit/test_app.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ git rev-parse HEAD
</span></span><span class="line"><span class="cl">dde1dc9303a2a9f414d470d501572bdac29e4075
</span></span></code></pre></div><p>å¦‚æœä½ ä¸å–œæ¬¢é•¿è¾“å‡ºï¼Œé‚£ä¹ˆä½ å¯ä»¥åœ¨å‘½ä»¤ä¸­æ·»åŠ  <code>--short</code> æ ‡å¿—ï¼Œè¿™å°†ä¸ºä½ æä¾›ç›¸åŒæäº¤å“ˆå¸Œçš„ç¼©å†™ç‰ˆæœ¬ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ git rev-parse --short HEAD
</span></span><span class="line"><span class="cl">dde1dc9
</span></span></code></pre></div><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå°†è¿”å›å¯ä»¥å”¯ä¸€æ ‡è¯†è¯¥ç‰¹å®šæäº¤è€Œä¸ä¼šäº§ç”Ÿæ­§ä¹‰çš„æœ€çŸ­å‰ç¼€ã€‚</p>
<p>ç°åœ¨æ‚¨å·²ç»æœ‰äº† Git æäº¤å“ˆå¸Œï¼Œæ‚¨å¯ä»¥å°†å®ƒç”¨ä½œ Docker é•œåƒçš„æ ‡ç­¾ã€‚è¦æ„å»ºé•œåƒï¼Œè¯·åœ¨æŒ‡å®š <code>-t</code> æˆ– <code>--tag</code> é€‰é¡¹çš„åŒæ—¶è¿è¡Œ <code>docker build</code> å‘½ä»¤ï¼Œä»¥ä¾¿ä¸ºæ–°é•œåƒæ·»åŠ æ ‡ç­¾ã€‚å°¾éšç‚¹è¡¨ç¤ºæ‚¨å½“å‰çš„å·¥ä½œç›®å½•æ˜¯æŸ¥æ‰¾ Dockerfile çš„ä½ç½®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker build -t page-tracker:<span class="k">$(</span>git rev-parse --short HEAD<span class="k">)</span> .
</span></span></code></pre></div><p>å†’å·ä¹‹å‰çš„ç¬¬ä¸€éƒ¨åˆ† <code>page-tracker</code> æ˜¯æ‚¨çš„ Docker é•œåƒçš„åŠ©è®°åç§°ã€‚è¯·æ³¨æ„ï¼Œåœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œæ‚¨å¯èƒ½ä¼šé™„åŠ æŸç§åç¼€æ¥ä¼ è¾¾æ­¤æœåŠ¡çš„è§’è‰²ã€‚ä¾‹å¦‚ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ª Flask ç½‘ç»œåº”ç”¨ç¨‹åºï¼Œæ‚¨å¯ä»¥å°†é•œåƒå‘½åä¸º <code>page-tracker-web</code> æˆ–ç±»ä¼¼çš„åç§°ã€‚å†’å·åé¢çš„æ˜¯å®é™…æ ‡è®°ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œå®ƒæ˜¯å½“å‰æäº¤çš„ Git æäº¤å“ˆå¸Œã€‚</p>
<p>å¦‚æœæ‚¨ä¹‹å‰æ„å»º Docker é•œåƒæ—¶æ²¡æœ‰ç»™å®ƒæ˜ç¡®çš„æ ‡ç­¾ï¼Œæˆ–è€…å¦‚æœæ‚¨ä»¥å…¶ä»–æ–¹å¼æ ‡è®°å®ƒï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°ç°åœ¨æ„å»ºå®ƒåªéœ€è¦å‡ åˆ†ä¹‹ä¸€ç§’ï¼</p>
<p>é‚£æ˜¯å› ä¸º Docker ç¼“å­˜äº†æ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿå±‚ï¼Œåªè¦é¡¹ç›®ä¸­çš„é‡è¦æ–‡ä»¶æ²¡æœ‰æ›´æ”¹ï¼Œå°±ä¸éœ€è¦é‡å»ºè¿™äº›å±‚ã€‚</p>
<p>å¦ä¸€ç‚¹å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¡¨é¢ä¹‹ä¸‹ï¼ŒDocker ä»…å­˜å‚¨æ‚¨çš„é•œåƒçš„ä¸€ä¸ªå‰¯æœ¬ã€‚å®ƒæœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œä¾‹å¦‚ <code>9cb2e3233522</code> ï¼Œå¤šä¸ªæ ‡ç­¾å¯ä»¥å¼•ç”¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker images
</span></span><span class="line"><span class="cl">REPOSITORY     TAG                    IMAGE ID       CREATED       SIZE
</span></span><span class="line"><span class="cl">page-tracker   dde1dc9                9cb2e3233522   <span class="m">1</span> hour ago    204MB
</span></span><span class="line"><span class="cl">page-tracker   prod                   9cb2e3233522   <span class="m">1</span> hour ago    204MB
</span></span><span class="line"><span class="cl">page-tracker   dev                    f9918cb213dc   <span class="m">1</span> hour ago    244MB
</span></span><span class="line"><span class="cl"><span class="o">(</span>...<span class="o">)</span>
</span></span></code></pre></div><p>è¿™å°±æ˜¯æ ‡è®° Docker é•œåƒçš„åŠ›é‡ã€‚å®ƒå…è®¸æ‚¨ä½¿ç”¨ä¸åŒçš„æ ‡ç­¾å¼•ç”¨åŒä¸€é•œåƒï¼Œä¾‹å¦‚ <code>page-tracker:prod</code> æˆ– <code>page-tracker:dde1dc9</code> ï¼ŒåŒæ—¶ä¿ç•™å”¯ä¸€æ ‡è¯†ã€‚æ¯ä¸ªæ ‡ç­¾éƒ½åŒ…å«å­˜å‚¨åº“åç§°ï¼ˆæ‚¨å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­äº†è§£ï¼‰å’Œä¸€ä¸ªç‰¹å®šçš„æ ‡ç­¾åç§°ã€‚</p>
<p>æ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨æ‚¨ä» Dockerfile æ„å»ºçš„é—ªäº®çš„æ–° Docker é•œåƒæ¥å¯åŠ¨ä¸€ä¸ªæˆç†Ÿçš„ Docker å®¹å™¨ã€‚å…·ä½“æ¥è¯´ï¼Œæ‚¨å¯ä»¥åœ¨ç¬”è®°æœ¬ç”µè„‘æˆ–æ”¯æŒ Docker çš„è¿œç¨‹åŸºäºäº‘çš„æœåŠ¡å™¨ä¸Šæœ¬åœ°è¿è¡Œå®¹å™¨ã€‚</p>
<p>è¿™å¯èƒ½æ˜¯æ‚¨è¿›è¡Œç«¯åˆ°ç«¯æµ‹è¯•çš„å”¯ä¸€æ–¹æ³•ã€‚</p>
<p>ä½†æ˜¯å¦‚ä½•å°†å®¹å™¨æ”¾åˆ°è¿œç¨‹ç¯å¢ƒä¸­å‘¢ï¼Ÿä½ ä¼šåœ¨ä¸‹ä¸€èŠ‚ä¸­æ‰¾åˆ°ç­”æ¡ˆã€‚</p>
<h3 id="å°†é•œåƒæ¨é€åˆ°-docker-registry">å°†é•œåƒæ¨é€åˆ° Docker Registry</h3>
<p>å½“æ‚¨ä¸ä»–äººåä½œå¤„ç†ä¸€æ®µä»£ç æ—¶ï¼Œæ‚¨é€šå¸¸ä¼šä½¿ç”¨ Git ç­‰ç‰ˆæœ¬æ§åˆ¶æ¥è·Ÿè¸ªæ‰€æœ‰ç›¸å…³äººå‘˜æ‰€åšçš„æ‰€æœ‰æ›´æ”¹ã€‚è™½ç„¶ Git æœ¬èº«æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œå…è®¸æ‚¨é›†æˆä»»ä½•ä¸¤ä¸ªäººä¹‹é—´çš„è´¡çŒ®ï¼Œä½†å®ƒç¼ºä¹é›†ä¸­æ‰˜ç®¡æœåŠ¡æ¥ä¿ƒè¿›å¤šæ–¹ä¹‹é—´çš„åŒæ—¶åä½œã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¤§å¤šæ•°äººé€‰æ‹© GitHub æˆ–ç«äº‰å¯¹æ‰‹çš„åŸå› ã€‚</p>
<p>GitHub æ˜¯æ‚¨é€šå¸¸ä¸Šä¼ æºä»£ç çš„åœ°æ–¹ï¼Œè€Œ Docker Registry æ˜¯å­˜å‚¨æ„å»ºçš„ Docker é•œåƒçš„å¸¸ç”¨ä½ç½®ã€‚ä»äº‹å•†ä¸šäº§å“çš„å…¬å¸å°†å¸Œæœ›åœ¨ç§æœ‰äº‘æˆ–æœ¬åœ°å»ºç«‹è‡ªå·±çš„ Docker Registryï¼Œä»¥è·å¾—é¢å¤–çº§åˆ«çš„æ§åˆ¶å’Œå®‰å…¨æ€§ã€‚è®¸å¤šæµè¡Œçš„äº‘æä¾›å•†ä»¥æ‰˜ç®¡æœåŠ¡çš„å½¢å¼æä¾›é«˜åº¦å®‰å…¨çš„ Docker æ³¨å†Œè¡¨ã€‚</p>
<p>æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ç§æœ‰æ³¨å†Œè¡¨ï¼Œä¾‹å¦‚ï¼Œé€šè¿‡ Docker è¿è¡Œå¼€æºåˆ†å‘å®¹å™¨ã€‚</p>
<p>æˆ–è€…ï¼Œå¦‚æœè¿™å¤ªéº»çƒ¦ï¼Œé‚£ä¹ˆæ‚¨ä¼šå¾ˆé«˜å…´å¾—çŸ¥ Docker Hub æä¾›äº†ä¸€ä¸ªå®‰å…¨çš„æ‰˜ç®¡æ³¨å†Œè¡¨ï¼Œæ‚¨å¯ä»¥å¼€å§‹å…è´¹ä½¿ç”¨å®ƒã€‚è™½ç„¶å…è´¹å±‚ä¸ºæ‚¨æä¾›äº†æ— é™æ•°é‡çš„å…¬å…±å­˜å‚¨åº“ï¼Œä½†æ‚¨å°†åªæœ‰ä¸€ä¸ªç§æœ‰å­˜å‚¨åº“ï¼Œå¹¶ä¸”å¯¹å¤–ç•Œä¸å¯è§ã€‚è€ƒè™‘åˆ°æ‚¨ä¸å¿…æ”¯ä»˜ä¸€åˆ†é’±ï¼Œè¿™å¯¹äºä¸ªäººæˆ–ä¸šä½™çˆ±å¥½é¡¹ç›®æ¥è¯´æ˜¯ä¸€ç¬”ä¸é”™çš„äº¤æ˜“ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šæ‚¨çš„ Docker Hub å¸æˆ·ä¸Šçš„å­˜å‚¨åº“æ˜¯ç”¨æˆ·å¯ä»¥ä¸Šä¼ æˆ–ä¸‹è½½çš„ Docker é•œåƒçš„é›†åˆã€‚æ¯ä¸ªå­˜å‚¨åº“å¯ä»¥åŒ…å«åŒä¸€é•œåƒçš„å¤šä¸ªæ ‡è®°ç‰ˆæœ¬ã€‚</p>
<p>åœ¨è¿™æ–¹é¢ï¼ŒDocker Hub å­˜å‚¨åº“ç±»ä¼¼äº GitHub å­˜å‚¨åº“ï¼Œä½†ä¸“é—¨ç”¨äº Docker é•œåƒè€Œä¸æ˜¯ä»£ç ã€‚ç§æœ‰å­˜å‚¨åº“å…è®¸æ‚¨ä»…å…è®¸æˆæƒç”¨æˆ·è®¿é—®ï¼Œè€Œå…¬å…±å­˜å‚¨åº“å¯ä¾›æ‰€æœ‰äººä½¿ç”¨ã€‚</p>
</blockquote>
<p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Docker Registryï¼Ÿ</p>
<p>å¥½å§ï¼Œæ‚¨ä¸å¿…è¿™æ ·åšï¼Œä½†å®ƒæœ‰åŠ©äºåœ¨æ•´ä¸ªç»„ç»‡å†…å…±äº« Docker é•œåƒæˆ–è®¾ç½®æŒç»­é›†æˆç®¡é“ã€‚ä¾‹å¦‚ï¼Œå°†æäº¤æ¨é€åˆ° GitHub æˆ–å…¶ä»–æºä»£ç ä¿®è®¢ç³»ç»Ÿå¯ä»¥é€šè¿‡è‡ªåŠ¨æ„å»ºåŠŸèƒ½å¯åŠ¨æ„å»ºè¿‡ç¨‹ã€‚åè¿‡æ¥ï¼Œæ³¨å†Œä¸­å¿ƒä¼šå®£å¸ƒæ–°çš„ Docker é•œåƒå·²æˆåŠŸæ„å»ºæˆ–ä½¿ç”¨ webhook å¼€å§‹éƒ¨ç½²åˆ°è¿œç¨‹ç¯å¢ƒä»¥è¿›è¡Œè¿›ä¸€æ­¥æµ‹è¯•ã€‚</p>
<p>å¦‚æœè¿˜æ²¡æœ‰ï¼Œè¯·ç«‹å³åœ¨ Docker Hub ä¸Šæ³¨å†Œä¸€ä¸ªå¸æˆ·ã€‚è¯·æ³¨æ„ï¼Œé™¤äº†ç”µå­é‚®ä»¶åœ°å€å’Œå¯†ç å¤–ï¼Œæ‚¨è¿˜éœ€è¦æä¾›å”¯ä¸€çš„ç”¨æˆ·åï¼Œå°±åƒåœ¨ GitHub ä¸Šä¸€æ ·ï¼š</p>
<p><img loading="lazy" src="https://files.realpython.com/media/docker_hub.912fd6ac373d.png" alt="img"  />
</p>
<p>é€‰æ‹©ä¸€ä¸ªå¥½è®°çš„ç”¨æˆ·åè‡³å…³é‡è¦ï¼Œå› ä¸ºå®ƒå°†æˆä¸ºæ‚¨åœ¨ Docker Hub ä¸Šçš„ç‹¬ç‰¹å¥æŸ„ã€‚ä¸ºäº†é¿å…ä¸åŒç”¨æˆ·æ‹¥æœ‰çš„é•œåƒä¹‹é—´çš„åç§°å†²çªï¼ŒDocker Hub é€šè¿‡ç”¨æˆ·åå’Œå­˜å‚¨åº“åç§°çš„ç»„åˆæ¥è¯†åˆ«æ¯ä¸ªå­˜å‚¨åº“ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„ç”¨æˆ·åæ˜¯ <code>realpython</code> ï¼Œé‚£ä¹ˆæ‚¨çš„ä¸€ä¸ªå­˜å‚¨åº“å¯ä»¥ç”±å­—ç¬¦ä¸² <code>realpython/page-tracker</code> æ ‡è¯†ï¼Œå®ƒç±»ä¼¼äº GitHub ä¸Šå­˜å‚¨åº“çš„åç§°ã€‚</p>
<p>åœ¨ Web æµè§ˆå™¨ä¸­æ³¨å†Œå¹¶ç™»å½•åˆ°æ‚¨çš„æ–° Docker Hub å¸æˆ·åï¼Œæ‚¨åº”è¯¥åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯ä¸ºæ‚¨çš„é•œåƒåˆ›å»ºä¸€ä¸ªå­˜å‚¨åº“ã€‚å•å‡»â€œåˆ›å»ºå­˜å‚¨åº“â€ç£è´´æˆ–è½¬åˆ°é¡¶éƒ¨å¯¼èˆªæ ä¸­çš„â€œå­˜å‚¨åº“â€é€‰é¡¹å¡ï¼Œç„¶åå•å‡»â€œåˆ›å»ºå­˜å‚¨åº“â€æŒ‰é’®ã€‚ç„¶åï¼Œå°†æ‚¨çš„å­˜å‚¨åº“å‘½åä¸º <code>page-tracker</code> ï¼Œå¦‚æœéœ€è¦ï¼Œè¯·ä¸ºå…¶æä¾›æœ‰æ„ä¹‰çš„æè¿°ï¼Œç„¶åé€‰æ‹© Private é€‰é¡¹ä»¥ä½¿å…¶ä»…å¯¹æ‚¨å¯è§ï¼š</p>
<p><img loading="lazy" src="https://files.realpython.com/media/docker_hub2.359dd2359251.png" alt="img"  />
</p>
<p>ä¹‹åï¼Œæ‚¨å°†çœ‹åˆ°å¸¦æœ‰ç»ˆç«¯å‘½ä»¤çš„è¯´æ˜ï¼Œè¿™äº›å‘½ä»¤å°†å…è®¸æ‚¨å°† Docker é•œåƒæ¨é€åˆ°æ‚¨çš„å­˜å‚¨åº“ã€‚ä½†é¦–å…ˆï¼Œæ‚¨å¿…é¡»ä»å‘½ä»¤è¡Œç™»å½• Docker Hubï¼Œæä¾›æ‚¨çš„ç”¨æˆ·åå’Œå¯†ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker login -u realpython
</span></span><span class="line"><span class="cl">Password:
</span></span></code></pre></div><p>å³ä½¿æ‚¨æ‰“ç®—ä»…ä½¿ç”¨å…¬å…±å­˜å‚¨åº“ï¼Œä¹Ÿéœ€è¦ä½¿ç”¨ <code>docker login</code> è¿›è¡Œèº«ä»½éªŒè¯ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå¦‚æœæ‚¨åœ¨ Docker Hub å¸æˆ·çš„å®‰å…¨è®¾ç½®ä¸­å¯ç”¨äº†åŒå› ç´ èº«ä»½éªŒè¯ï¼Œé‚£ä¹ˆæ‚¨å°†éœ€è¦ç”Ÿæˆä¸€ä¸ªå…·æœ‰é€‚å½“æƒé™çš„è®¿é—®ä»¤ç‰Œï¼Œä»¥ä¾¿åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ <code>docker</code> ç™»å½•ã€‚å½“å®ƒè¦æ±‚æ‚¨è¾“å…¥å¯†ç æ—¶ï¼Œåªéœ€æä¾›æ‚¨çš„ä»¤ç‰Œå³å¯ã€‚</p>
<p>å¦åˆ™ï¼Œå¦‚æœæ‚¨æ²¡æœ‰é…ç½®åŒå› ç´ èº«ä»½éªŒè¯ï¼Œé‚£ä¹ˆæ‚¨å°†èƒ½å¤Ÿä½¿ç”¨æ‚¨çš„ Docker Hub å¯†ç ç™»å½•ã€‚å°½ç®¡å¦‚æ­¤ï¼Œå¦‚æ–‡æ¡£æ‰€è¿°ï¼Œä»ç„¶å€¼å¾—ç”Ÿæˆä¸€ä¸ªä»¤ç‰Œä»¥è·å¾—æ›´å¥½çš„å®‰å…¨æ€§ã€‚</p>
</blockquote>
<p>å½“ä½ ä½¿ç”¨ Git å°†ä»£ç æ¨é€åˆ°è¿œç¨‹å­˜å‚¨åº“æ—¶ï¼Œä½ å¿…é¡»é¦–å…ˆä»æŸä¸ªåœ°æ–¹å…‹éš†å®ƒæˆ–æ‰‹åŠ¨è®¾ç½®é»˜è®¤æºï¼Œå®ƒé…ç½®æœ¬åœ°å­˜å‚¨åº“çš„å…ƒæ•°æ®ã€‚</p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œä½¿ç”¨ Docker Hub æˆ–ä»»ä½•å…¶ä»– Docker æ³¨å†Œè¡¨ï¼Œå°†æœ¬åœ°é•œåƒæ˜ å°„åˆ°è¿œç¨‹é•œåƒçš„è¿‡ç¨‹æœ‰ç‚¹ä¸åŒâ€”â€”æ‚¨ä½¿ç”¨æ ‡è®°ã€‚å…·ä½“æ¥è¯´ï¼Œæ‚¨ä½¿ç”¨ Docker Hub çš„ç”¨æˆ·åå’Œå­˜å‚¨åº“åç§°ä½œä¸ºå‰ç¼€æ¥æ ‡è®°æ„å»ºçš„é•œåƒã€‚</p>
<p>é¦–å…ˆï¼Œæ‚¨å¿…é¡»æä¾›è¦å‘å¸ƒçš„æœ¬åœ° Docker é•œåƒçš„æºæ ‡ç­¾ï¼Œä¾‹å¦‚ <code>page-tracker:dde1dc9</code> ã€‚è¦æ‰¾åˆ°æ‚¨åˆšåˆšæ„å»ºçš„ <code>page-tracker</code> é•œåƒçš„ç¡®åˆ‡æ ‡ç­¾ï¼Œè¯·æ£€æŸ¥æ‚¨å½“å‰çš„ Git æäº¤å“ˆå¸Œæˆ–åˆ—å‡ºæ‚¨ç°æœ‰çš„ <code>docker images</code> ã€‚</p>
<p>ä¸€æ—¦çŸ¥é“å¦‚ä½•æ ‡è®°é•œåƒï¼Œå°±å¯ä»¥ä½¿ç”¨ç›¸åŒçš„æäº¤å“ˆå¸Œæ¥æ„å»ºç›®æ ‡æ ‡ç­¾ï¼Œè¯¥æ ‡ç­¾å°†åœ¨ Docker æ³¨å†Œè¡¨ä¸­æ ‡è¯†æ‚¨çš„å­˜å‚¨åº“ã€‚è¯·è®°ä½åœ¨åˆ›å»ºæ–°æ ‡ç­¾ä¹‹å‰å°† <code>realpython</code> æ›¿æ¢ä¸ºæ‚¨è‡ªå·±çš„ Docker Hub ç”¨æˆ·åï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker tag page-tracker:dde1dc9 realpython/page-tracker:dde1dc9
</span></span></code></pre></div><p>è¿™ä¼šå°†æ–°æ ‡ç­¾ <code>realpython/page-tracker:dde1dc9</code> æ·»åŠ åˆ°æ ‡è®°ä¸º <code>page-tracker:dde1dc9</code> çš„æœ¬åœ°é•œåƒã€‚ç›®æ ‡æ ‡ç­¾çš„å®Œæ•´å½¢å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">registry/username/repository:tag
</span></span></code></pre></div><p>å½“ä½ æƒ³æ¨é€åˆ°é»˜è®¤çš„ Docker Hub æ—¶ï¼Œå¯ä»¥çœç•¥æ³¨å†Œè¡¨éƒ¨åˆ†ã€‚å¦åˆ™ï¼Œå®ƒå¯ä»¥æ˜¯åŸŸåœ°å€ï¼Œä¾‹å¦‚ <code>docker.io</code> ï¼Œæˆ–å¸¦æœ‰ç§æœ‰æ³¨å†Œè¡¨å®ä¾‹çš„å¯é€‰ç«¯å£å·çš„ IP åœ°å€ã€‚ç”¨æˆ·åå’Œå­˜å‚¨åº“å¿…é¡»ä¸æ‚¨åœ¨ Docker Hub æˆ–æ‚¨ä½¿ç”¨çš„ä»»ä½•æ³¨å†Œè¡¨ä¸Šåˆ›å»ºçš„ç”¨æˆ·åå’Œå­˜å‚¨åº“ç›¸å¯¹åº”ã€‚å¦‚æœæ‚¨ä¸æä¾›æ ‡ç­¾ï¼Œé‚£ä¹ˆ Docker å°†éšå¼åº”ç”¨æ ‡ç­¾ <code>latest</code> ï¼Œè¿™å¯èƒ½æ˜¯æœªå®šä¹‰çš„ã€‚</p>
<p>æ‚¨å¯ä»¥ä½¿ç”¨å¤šä¸ªæ ‡ç­¾æ¥æ ‡è®°åŒä¸€é•œåƒï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker tag page-tracker:dde1dc9 realpython/page-tracker:latest
</span></span></code></pre></div><p>æ­£ç¡®æ ‡è®°é•œåƒåï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>docker push</code> å°†å®ƒä»¬å‘é€åˆ°æ‰€éœ€çš„æ³¨å†Œè¡¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker push realpython/page-tracker:dde1dc9
</span></span><span class="line"><span class="cl">$ docker push realpython/page-tracker:latest
</span></span></code></pre></div><p>ä¸è¦æ‹…å¿ƒå‘é€ç›¸åŒçš„é•œåƒä¸¤æ¬¡ã€‚ Docker è¶³å¤Ÿèªæ˜ï¼Œå¯ä»¥çŸ¥é“æ‚¨ä¹‹å‰ä½•æ—¶æ¨é€è¿‡é•œåƒï¼Œå¦‚æœå®ƒåœ¨æ³¨å†Œè¡¨ä¸­æ£€æµ‹åˆ°è¯¥é•œåƒï¼Œåˆ™åªä¼šä¼ è¾“å¿…è¦çš„å…ƒæ•°æ®ã€‚</p>
<p>å½“æ‚¨åœ¨ Docker Hub ä¸Šåˆ·æ–°æ‚¨çš„é…ç½®æ–‡ä»¶æ—¶ï¼Œå®ƒåº”è¯¥åæ˜ æ‚¨åˆšåˆšæ¨é€åˆ°å­˜å‚¨åº“ä¸­çš„ä¸¤ä¸ªæ ‡ç­¾ï¼š</p>
<p><img loading="lazy" src="https://files.realpython.com/media/docker_hub3.69a099d38e54.png" alt="Tagged Docker Images on Docker Hub"  />
</p>
<p>ç°åœ¨ï¼Œå½“æ‚¨å°†åä½œè€…æ·»åŠ åˆ°æ‚¨çš„ç§æœ‰å­˜å‚¨åº“æ—¶ï¼Œä»–ä»¬å°†èƒ½å¤Ÿæ¨é€æˆ–æ‹‰å–é•œåƒã€‚è¯·è®°ä½ï¼Œè¿™éœ€è¦åœ¨ Docker Hub ä¸Šå‡çº§è®¢é˜…è®¡åˆ’ã€‚</p>
<p>å¦ä¸€ç§æ–¹æ³•æ˜¯ç”Ÿæˆä¸€ä¸ªå¯¹æ‰€æœ‰å­˜å‚¨åº“å…·æœ‰åªè¯»æƒé™çš„è®¿é—®ä»¤ç‰Œï¼Œæˆ–è€…åˆ›å»ºä¸€ä¸ªå…¬å…±å­˜å‚¨åº“ã€‚</p>
<p>å¥½çš„ã€‚ç»ˆäºåˆ°äº†é€šè¿‡åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œæ‚¨çš„ dockerized Flask web åº”ç”¨ç¨‹åºçš„æœºä¼šäº†ã€‚</p>
<h3 id="è¿è¡Œä¸€ä¸ª-docker-å®¹å™¨">è¿è¡Œä¸€ä¸ª Docker å®¹å™¨</h3>
<p>å¦‚æœä½ ä»ä¸€ä¸ªå¹²å‡€çš„ Docker ç¯å¢ƒå¼€å§‹ï¼Œä¹Ÿè®¸åœ¨å¦ä¸€å°è®¡ç®—æœºä¸Šï¼Œé‚£ä¹ˆä½ å¯ä»¥é€šè¿‡ä» Docker Hub æ‹‰å–å®ƒæ¥ä¸‹è½½ä½ çš„é•œåƒï¼Œåªè¦ä½ æœ‰è¯»å–è¯¥å­˜å‚¨åº“çš„æƒé™ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker pull realpython/page-tracker
</span></span><span class="line"><span class="cl">Using default tag: latest
</span></span><span class="line"><span class="cl">latest: Pulling from realpython/page-tracker
</span></span><span class="line"><span class="cl">f1f26f570256: Pull <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">2d2b01660885: Pull <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">e4e8e4c0b0e1: Pull <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">1ba60f086308: Pull <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">3c2fccf90be1: Pull <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">15e9066b1610: Pull <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">e8271c9a01cc: Pull <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">4f4fb700ef54: Pull <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">bb211d339643: Pull <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">8690f9a37c37: Pull <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">7404f1e120d1: Pull <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">Digest: sha256:cc6fe40a1ac73e6378d0660bf386a1599880a30e422dc061680769bc4d501164
</span></span><span class="line"><span class="cl">Status: Downloaded newer image <span class="k">for</span> realpython/page-tracker:latest
</span></span><span class="line"><span class="cl">docker.io/realpython/page-tracker:latest
</span></span></code></pre></div><p>ç”±äºæ‚¨æ²¡æœ‰ä¸ºé•œåƒæŒ‡å®šä»»ä½•æ ‡ç­¾ï¼Œå› æ­¤ Docker ä¼šæ‹‰å–æ ‡è®°ä¸º <code>latest</code> çš„æ ‡ç­¾ã€‚è¯·æ³¨æ„ï¼Œè¾“å‡ºè¿˜åŒ…æ‹¬é•œåƒå„ä¸ªå±‚çš„æ ‡è¯†ç¬¦ï¼Œå¯¹åº”äºç”¨äºæ„å»ºè¯¥é•œåƒçš„åŸå§‹ Dockerfile ä¸­çš„ 11 æ¡æŒ‡ä»¤ã€‚</p>
<p>ä¸è¿‡ï¼Œæ‚¨ä¸å¿…æ‰‹åŠ¨æ‹‰å–é•œåƒï¼Œå› ä¸º Docker ä¼šåœ¨æ‚¨ç¬¬ä¸€æ¬¡å°è¯•è¿è¡Œå®ƒä»¬æ—¶ä¸ºæ‚¨å®Œæˆã€‚å¦‚æœæŒ‡å®šçš„é•œåƒå·²ç»åœ¨ç¼“å­˜ä¸­ï¼Œé‚£ä¹ˆä¸€ä¸ªæ–°çš„å®¹å™¨å°†ç«‹å³å¯åŠ¨ï¼Œè€Œä¸ä¼šç­‰åˆ°ä¸‹è½½å®Œæˆã€‚</p>
<p>ä¸‹é¢æ˜¯åŸºäºæ–°é•œåƒè¿è¡Œæ–° Docker å®¹å™¨çš„å‘½ä»¤ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker run -p 80:5000 --name web-service realpython/page-tracker
</span></span><span class="line"><span class="cl"> * Serving Flask app <span class="s1">&#39;page_tracker.app&#39;</span>
</span></span><span class="line"><span class="cl"> * Debug mode: off
</span></span><span class="line"><span class="cl">WARNING: This is a development server. Do not use it in a production
</span></span><span class="line"><span class="cl">â®‘ deployment. Use a production WSGI server instead.
</span></span><span class="line"><span class="cl"> * Running on all addresses <span class="o">(</span>0.0.0.0<span class="o">)</span>
</span></span><span class="line"><span class="cl"> * Running on http://127.0.0.1:5000
</span></span><span class="line"><span class="cl"> * Running on http://172.17.0.3:5000
</span></span><span class="line"><span class="cl">Press CTRL+C to quit
</span></span></code></pre></div><p>å½“æ‚¨åœ¨æœ¬åœ°å¼€å‘é¡¹ç›®æ—¶ï¼Œä½¿ç”¨ç«¯å£è½¬å‘é€šè¿‡ä¸»æœºçš„ localhost è®¿é—® Web æœåŠ¡å™¨é€šå¸¸å¾ˆæ–¹ä¾¿ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ <code>-p</code> é€‰é¡¹å¯è®©æ‚¨å¯¼èˆªåˆ°åœ°å€ <code>http://localhost:80</code> æˆ–åªæ˜¯ <code>http://localhost</code> ï¼Œè€Œæ— éœ€çŸ¥é“æ­£åœ¨è¿è¡Œçš„ Docker å®¹å™¨çš„ç¡®åˆ‡ IP åœ°å€ã€‚ç«¯å£ <code>80</code> æ˜¯ HTTP åè®®çš„é»˜è®¤ç«¯å£ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥åœ¨ Web æµè§ˆå™¨ä¸­é”®å…¥åœ°å€æ—¶çœç•¥å®ƒã€‚</p>
<p>æ­¤å¤–ï¼Œæ­¤ç«¯å£æ˜ å°„å°†ç¡®ä¿åœ¨ <code>http://localhost:5000</code> å¤„æ²¡æœ‰ç½‘ç»œç«¯å£å†²çªï¼Œä»¥é˜²æ‚¨æ²¡æœ‰åœæ­¢æœ¬åœ° Flask å®ä¾‹ã€‚è¯·è®°ä½ï¼Œæ‚¨ä¹‹å‰å¯åŠ¨äº†ä¸€ä¸ªæ¥æ‰§è¡Œç«¯åˆ°ç«¯æµ‹è¯•ã€‚å¦‚æœè¿›ç¨‹ä»åœ¨åå°æŸå¤„è¿è¡Œï¼Œå®ƒå°†å ç”¨ Flask çš„é»˜è®¤ç«¯å£ <code>5000</code> ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šä¸ºæ‚¨çš„ Docker å®¹å™¨æä¾›ä¸€ä¸ªæè¿°æ€§åç§°ä¹Ÿå¾ˆæœ‰ç”¨ï¼Œä¾‹å¦‚ <code>web-service</code> ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥é€šè¿‡åç§°é‡æ–°å¯åŠ¨æˆ–åˆ é™¤å®ƒï¼Œè€Œæ— éœ€æŸ¥æ‰¾ç›¸åº”çš„å®¹å™¨æ ‡è¯†ç¬¦ã€‚å¦‚æœä½ ä¸è¿™æ ·åšï¼Œé‚£ä¹ˆ Docker ä¼šç»™ä½ çš„å®¹å™¨ä¸€ä¸ªæ„šè ¢çš„åå­—ï¼Œæ¯”å¦‚éšæœºé€‰æ‹©çš„ <code>admiring_jang</code> æˆ– <code>frosty_almeida</code> ã€‚</p>
<p>å¦‚æœæ‚¨ä¸æƒ³æ‰‹åŠ¨æ“ä½œï¼Œè¯·è€ƒè™‘æ·»åŠ  <code>--rm</code> æ ‡å¿—ä»¥åœ¨å®¹å™¨åœæ­¢æ—¶è‡ªåŠ¨åˆ é™¤å®ƒã€‚</p>
</blockquote>
<p>æ­£å¦‚æ‚¨åœ¨ä¸Šé¢çš„è¾“å‡ºä¸­çœ‹åˆ°çš„ï¼ŒFlask æœåŠ¡å™¨æ­£åœ¨å…¶å®¹å™¨å†…çš„æ‰€æœ‰ç½‘ç»œæ¥å£ ( <code>0.0.0.0</code> ) ä¸Šè¿è¡Œï¼Œæ­£å¦‚æ‚¨åœ¨ Dockerfile çš„ <code>CMD</code> å±‚ä¸­æŒ‡ç¤ºçš„é‚£æ ·ã€‚</p>
<p>ç»§ç»­å¹¶åœ¨æ‚¨çš„ Web æµè§ˆå™¨ä¸­è®¿é—®åœ°å€ <code>http://localhost</code> æˆ–ä½¿ç”¨ <code>curl</code> ä¹‹ç±»çš„å‘½ä»¤è¡Œå·¥å…·æ¥è®¿é—® dockerized é¡µé¢è·Ÿè¸ªå™¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ curl http://localhost
</span></span><span class="line"><span class="cl">Sorry, something went wrong ğŸ˜”
</span></span></code></pre></div><p>ç”±äº Redis è¿æ¥å¤±è´¥ï¼Œæ‚¨å°†çœ‹åˆ°é¢„æœŸçš„é”™è¯¯æ¶ˆæ¯ï¼Œä½†è‡³å°‘æ‚¨å¯ä»¥è®¿é—®åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œçš„ Flask åº”ç”¨ç¨‹åºã€‚è¦ä¿®å¤é”™è¯¯ï¼Œæ‚¨éœ€è¦é€šè¿‡ä¼ é€’ç»™ <code>web-service</code> å®¹å™¨çš„ç¯å¢ƒå˜é‡æŒ‡å®šæ­£ç¡®çš„ Redis URLã€‚</p>
<p>ç°åœ¨é€šè¿‡æŒ‰é”®ç›˜ä¸Šçš„ Ctrl+C æˆ– Cmd+C åœæ­¢è¯¥å®¹å™¨ã€‚ç„¶åï¼Œæ‰¾åˆ°å®¹å™¨çš„æ ‡è¯†ç¬¦å¹¶åˆ é™¤å…³è”çš„å®¹å™¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker ps -a
</span></span><span class="line"><span class="cl">CONTAINER ID   IMAGE                     COMMAND                  CREATED
</span></span><span class="line"><span class="cl">dd446a1b72a7   realpython/page-tracker   <span class="s2">&#34;flask --app page_trâ€¦&#34;</span>   <span class="m">1</span> minute ago
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ docker rm dd446a1b72a7
</span></span></code></pre></div><p><code>-a</code> æ ‡å¿—ç¡®ä¿æ˜¾ç¤ºæ‰€æœ‰å®¹å™¨ï¼ŒåŒ…æ‹¬å·²åœæ­¢çš„å®¹å™¨ã€‚å¦åˆ™ï¼Œä½ ä¸ä¼šçœ‹åˆ°ä½ çš„ã€‚</p>
<p>é€šè¿‡ Docker å°† Flask Web åº”ç”¨ç¨‹åºè¿æ¥åˆ° Redis çš„æ­£ç¡®æ–¹æ³•æ˜¯åˆ›å»ºä¸“ç”¨è™šæ‹Ÿç½‘ç»œã€‚é¦–å…ˆï¼Œåˆ—å‡ºå¯ç”¨ç½‘ç»œä»¥æ£€æŸ¥æ‚¨æ˜¯å¦å·²ç»åˆ›å»ºäº† <code>page-tracker-network</code> ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker network ls
</span></span><span class="line"><span class="cl">NETWORK ID     NAME                   DRIVER    SCOPE
</span></span><span class="line"><span class="cl">46e9ff2ec568   bridge                 bridge    <span class="nb">local</span>
</span></span><span class="line"><span class="cl">4795b850cb58   host                   host      <span class="nb">local</span>
</span></span><span class="line"><span class="cl">f8f99d305c5e   none                   null      <span class="nb">local</span>
</span></span><span class="line"><span class="cl">84b134794660   page-tracker-network   bridge    <span class="nb">local</span>
</span></span></code></pre></div><p>å¦‚æœå®ƒä¸å­˜åœ¨ï¼Œé‚£ä¹ˆæ‚¨ç°åœ¨å¯ä»¥é€šè¿‡å‘å‡ºä»¥ä¸‹å‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker network create page-tracker-network
</span></span></code></pre></div><p>ä»¥ç±»ä¼¼çš„æ–¹å¼ï¼Œæ‚¨å¯ä»¥ä¸º Redis æœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªå·ï¼Œä»¥å°†å…¶æ•°æ®æŒä¹…å­˜å‚¨åœ¨æ‚¨çš„ä¸»æœºä¸Šã€‚è¿™æ ·ï¼Œæ‚¨å¯ä»¥é‡æ–°å¯åŠ¨ç”šè‡³åˆ é™¤å¹¶ä»å¤´å¼€å§‹åˆ›å»ºä¸€ä¸ªæ–°å®¹å™¨ï¼ŒRedis å°†å¯ä»¥è®¿é—®å…¶ä¹‹å‰çš„çŠ¶æ€ã€‚è¿™æ˜¯ä½¿ç”¨ Docker åˆ›å»ºå‘½åå·çš„æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker volume create redis-volume
</span></span></code></pre></div><p>æ¥ä¸‹æ¥ï¼Œåœæ­¢å¹¶ç§»é™¤ä»»ä½•å¯èƒ½æŒ‚èµ·çš„ Redis å®¹å™¨ï¼Œç„¶åå¯åŠ¨ä¸€ä¸ªæ–°å®¹å™¨ã€‚è¿™ä¸€æ¬¡ï¼Œæ‚¨å°†å®¹å™¨è¿æ¥åˆ° <code>page-tracker-network</code> å¹¶å°†å…¶ <code>/data</code> æ–‡ä»¶å¤¹ç»‘å®šåˆ°æ‚¨åˆšåˆšåˆ›å»ºçš„åä¸º <code>redis-volume</code> çš„å·ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker run -d <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>             -v redis-volume:/data <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>             --network page-tracker-network <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>             --name redis-service <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>             redis:7.0.10-bullseye
</span></span></code></pre></div><p>å½“æ‚¨åœ¨ GitHub ä¸ŠæŸ¥çœ‹ Redis çš„å®˜æ–¹ Docker é•œåƒæ—¶ï¼Œæ‚¨ä¼šçœ‹åˆ°ä¸€ä¸ªåœ¨ <code>/data</code> æ–‡ä»¶å¤¹ä¸­å®šä¹‰æŒ‚è½½ç‚¹çš„å±‚ã€‚ Redis ä¼šä¸æ—¶åœ°å°†å…¶çŠ¶æ€è½¬å‚¨åˆ°è¯¥æ–‡ä»¶å¤¹ä¸­ã€‚é€šè¿‡å°†ç›®å½•ä»æ‚¨çš„ä¸»æœºæŒ‚è½½åˆ°æ­¤æŒ‚è½½ç‚¹ï¼Œå³ä½¿å®¹å™¨é‡æ–°å¯åŠ¨ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä¿æŒçŠ¶æ€ã€‚</p>
<p>é€šè¿‡ç»™ä½ çš„å®¹å™¨ä¸€ä¸ªæè¿°æ€§çš„åç§°ï¼Œ <code>redis-service</code> ï¼Œä½ å°†èƒ½å¤Ÿä»åŒä¸€ç½‘ç»œä¸Šçš„å¦ä¸€ä¸ªå®¹å™¨è¿æ¥åˆ°å®ƒã€‚å°±æ˜¯è¿™æ ·ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker run -d <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>             -p 80:5000 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>             -e <span class="nv">REDIS_URL</span><span class="o">=</span>redis://redis-service:6379 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>             --network page-tracker-network <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>             --name web-service <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>             realpython/page-tracker
</span></span></code></pre></div><p>æ‚¨å¯åŠ¨ä¸€ä¸ªä» <code>page-tracker</code> é•œåƒæ´¾ç”Ÿçš„æ–°å®¹å™¨ï¼Œå…¶ä¸­åŒ…å«ç›¸å½“å¤šçš„å‚æ•°ã€‚ä»¥ä¸‹æ˜¯ä¸Šè¿° <code>docker run</code> å‘½ä»¤ä¸­å„ä¸ªæ ‡å¿—å’Œé€‰é¡¹çš„å¿«é€Ÿç»†åˆ†ï¼š</p>
<ul>
<li><code>-d</code> ï¼šåœ¨åå°è¿è¡Œå®¹å™¨ï¼Œä¸ç»ˆç«¯åˆ†ç¦»ã€‚è¿™æ„å‘³ç€æ‚¨å°†çœ‹ä¸åˆ° Flask æœåŠ¡å™¨çš„ä»»ä½•è¾“å‡ºï¼Œå¹¶ä¸”æ‚¨å°†æ— æ³•å†ä½¿ç”¨ Ctrl+C æˆ– Cmd+C åœæ­¢å®¹å™¨ã€‚</li>
<li><code>-p 80:5000</code> ï¼šå°†å®¹å™¨çš„ç«¯å£ <code>5000</code> æš´éœ²åœ¨ä¸»æœºçš„ç«¯å£ <code>80</code> ä¸Šï¼Œè¿™æ ·ä½ å°±å¯ä»¥é€šè¿‡æœ¬åœ°ä¸»æœºè®¿é—®ä½ çš„webåº”ç”¨ç¨‹åºã€‚</li>
<li><code>-e REDIS_URL=...</code> : å°†å®¹å™¨çš„ç¯å¢ƒå˜é‡è®¾ç½®ä¸ºåœ¨åŒä¸€ç½‘ç»œä¸Šçš„å¦ä¸€ä¸ªå®¹å™¨ä¸­è¿è¡Œçš„ Redis æœåŠ¡å™¨çš„åœ°å€ã€‚</li>
<li><code>--network page-tracker-network</code> : æŒ‡å®šå®¹å™¨ä½¿ç”¨çš„è™šæ‹Ÿç½‘ç»œã€‚è¿™å°†å…è®¸åŒä¸€ç½‘ç»œä¸Šçš„å…¶ä»–å®¹å™¨é€šè¿‡æŠ½è±¡åç§°è€Œä¸æ˜¯ IP åœ°å€ä¸è¯¥å®¹å™¨é€šä¿¡ã€‚</li>
<li><code>--name web-service</code> : ä¸ºå®¹å™¨åˆ†é…ä¸€ä¸ªæœ‰æ„ä¹‰çš„åç§°ï¼Œè¿™æ ·æ›´å®¹æ˜“ä» Docker å‘½ä»¤ä¸­å¼•ç”¨å®¹å™¨ã€‚</li>
</ul>
<p>ç°åœ¨ï¼Œå½“æ‚¨åœ¨ Web æµè§ˆå™¨æˆ–ç»ˆç«¯ä¸­è®¿é—® Flask Web åº”ç”¨ç¨‹åºæ—¶ï¼Œæ‚¨åº”è¯¥è§‚å¯Ÿåˆ°æ­£ç¡®çš„è¡Œä¸ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ curl http://localhost
</span></span><span class="line"><span class="cl">This page has been seen <span class="m">1</span> times.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ curl http://localhost
</span></span><span class="line"><span class="cl">This page has been seen <span class="m">2</span> times.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ curl http://localhost
</span></span><span class="line"><span class="cl">This page has been seen <span class="m">3</span> times.
</span></span></code></pre></div><p>æ¯æ¬¡å‘é€è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨éƒ½ä¼šä»¥ä¸åŒæ•°é‡çš„é¡µé¢æµè§ˆé‡è¿›è¡Œå“åº”ã€‚è¯·æ³¨æ„ï¼Œæ‚¨æ­£åœ¨é€šè¿‡æœ¬åœ°ä¸»æœºè®¿é—®æœåŠ¡å™¨ã€‚å¦‚æœæ‚¨åœ¨ <code>web-service</code> ä¹‹å‰å¯åŠ¨äº† <code>redis-service</code> ï¼Œé‚£ä¹ˆå®¹å™¨çš„ IP åœ°å€å¯èƒ½å·²æ›´æ”¹ã€‚</p>
<p>å“‡ï¼å…‰æ˜¯å¯åŠ¨å’Œè¿è¡Œä¸¤é¡¹æœåŠ¡å°±éœ€è¦åšå¤§é‡å·¥ä½œã€‚å¦‚æ‚¨æ‰€è§ï¼Œæ‰‹åŠ¨ç®¡ç† Docker é•œåƒã€å®¹å™¨ã€å·ã€ç½‘ç»œã€ç«¯å£å’Œç¯å¢ƒå˜é‡ä¼šè®©äººæ„Ÿåˆ°ä¸çŸ¥æ‰€æªã€‚è€Œè¿™åªæ˜¯è¡¨é¢ç°è±¡ï¼</p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œç®¡ç†ä¸€ä¸ªåŒ…å«æ•°åç§æœåŠ¡çš„å¤æ‚åº”ç”¨ç¨‹åºéœ€è¦ä»˜å‡ºå¤šå°‘åŠªåŠ›ï¼Œå…¶ä¸­åŒ…æ‹¬ç”Ÿäº§å°±ç»ªç›‘æ§ã€è´Ÿè½½å¹³è¡¡ã€è‡ªåŠ¨ç¼©æ”¾ç­‰ã€‚</p>
<p>å¹¸è¿çš„æ˜¯ï¼Œæœ‰æ›´å¥½çš„æ–¹æ³•å¯ä»¥è¾¾åˆ°åŒæ ·çš„æ•ˆæœã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæ‚¨å°†ç ”ç©¶ Docker ä¹‹ä¸Šçš„ä¸€ä¸ªæ–¹ä¾¿çš„æŠ½è±¡å±‚ï¼Œè®©æ‚¨åœ¨å®šä¹‰æŒç»­é›†æˆç®¡é“ä¹‹å‰ä½¿ç”¨å•ä¸ªå‘½ä»¤ç¼–æ’è¿™ä¸¤ç§æœåŠ¡ã€‚</p>
<h2 id="ä½¿ç”¨-docker-compose-ç¼–æ’å®¹å™¨">ä½¿ç”¨ Docker Compose ç¼–æ’å®¹å™¨</h2>
<p>å¤§å¤šæ•°ç°å®ä¸–ç•Œçš„åº”ç”¨ç¨‹åºç”±å¤šä¸ªç»„ä»¶ç»„æˆï¼Œè¿™äº›ç»„ä»¶è‡ªç„¶ä¼šè½¬åŒ–ä¸º Docker å®¹å™¨ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªæ¶‰åŠæ›´å¤šçš„ Web åº”ç”¨ç¨‹åºå¯èƒ½å…·æœ‰ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li><strong>Back end:</strong> <a href="https://realpython.com/learning-paths/django-web-development/">Django</a>, <a href="https://realpython.com/fastapi-python-web-apis/">FastAPI</a>, <a href="https://realpython.com/learning-paths/flask-by-example/">Flask</a></li>
<li><strong>Front end:</strong> <a href="https://realpython.com/flask-by-example-integrating-flask-and-angularjs/">Angular</a>, <a href="https://realpython.com/the-ultimate-flask-front-end/#react-explained">React</a>, <a href="https://realpython.com/python-django-blog/#step-5-set-up-vuejs">Vue</a></li>
<li><strong>Cache:</strong> Couchbase, <a href="https://realpython.com/python-memcache-efficient-caching/">Memcached</a>, <a href="https://realpython.com/python-redis/">Redis</a></li>
<li><strong>Queue:</strong> ActiveMQ, <a href="https://realpython.com/queue-in-python/#apache-kafka-kafka-python3">Kafka</a>, <a href="https://realpython.com/queue-in-python/#rabbitmq-pika">RabbitMQ</a></li>
<li><strong>Database:</strong> <a href="https://realpython.com/python-mysql/">MySQL</a>, <a href="https://realpython.com/python-sql-libraries/#postgresql">PostgreSQL</a>, <a href="https://realpython.com/python-sqlite-sqlalchemy/">SQLite</a></li>
</ul>
<p>æ›´å¤§çš„åº”ç”¨ç¨‹åºå¯èƒ½ä¼šé€‰æ‹©å°†å…¶åç«¯æˆ–å‰ç«¯ç»„ä»¶ç»†åˆ†ä¸ºæ›´å¤šçš„å¾®æœåŠ¡ï¼Œè´Ÿè´£èº«ä»½éªŒè¯ã€ç”¨æˆ·ç®¡ç†ã€è®¢å•å¤„ç†ã€æ”¯ä»˜æˆ–æ¶ˆæ¯ä¼ é€’ç­‰ã€‚</p>
<p>ä¸ºäº†å¸®åŠ©ç®¡ç†å¹¶åœ¨æŸç§ç¨‹åº¦ä¸Šç¼–æ’æ­¤ç±»åº”ç”¨ç¨‹åºçš„å¤šä¸ª Docker å®¹å™¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Docker Composeã€‚å®ƒæ˜¯ä¸€ç§åœ¨ Docker ä¹‹ä¸Šè¿è¡Œçš„å·¥å…·ï¼Œå¯ç®€åŒ–è¿è¡Œå¤šå®¹å™¨ Docker åº”ç”¨ç¨‹åºã€‚ Docker Compose å…è®¸æ‚¨æ ¹æ®ç›¸äº’ä¾èµ–çš„æœåŠ¡åŠå…¶é…ç½®å’Œè¦æ±‚æ¥å®šä¹‰æ‚¨çš„åº”ç”¨ç¨‹åºã€‚ç„¶åå®ƒå°†åè°ƒå®ƒä»¬å¹¶å°†å®ƒä»¬ä½œä¸ºä¸€ä¸ªè¿è´¯çš„åº”ç”¨ç¨‹åºè¿è¡Œã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå®¹å™¨ç¼–æ’è‡ªåŠ¨åŒ–åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºçš„éƒ¨ç½²ã€æ‰©å±•å’Œé…ç½®ç®¡ç†ã€‚è™½ç„¶ Docker Compose å¯ä»¥å¸®åŠ©è¿›è¡ŒåŸºæœ¬å½¢å¼çš„ç¼–æ’ï¼Œä½†æ‚¨æœ€å¥½åœ¨æ›´å¤æ‚çš„å¤§å‹ç³»ç»Ÿä¸­ä½¿ç”¨ Kubernetes ç­‰å·¥å…·ã€‚</p>
</blockquote>
<p>æ‚¨å°†ä½¿ç”¨ Docker Compose ä»¥å£°æ˜æ–¹å¼æè¿°æ‚¨çš„å¤šå®¹å™¨é¡µé¢è·Ÿè¸ªå™¨åº”ç”¨ç¨‹åºï¼Œä»¥åŠå®ƒçš„æœåŠ¡ã€ç½‘ç»œå’Œå·ï¼Œä½¿ç”¨å•ä¸ªé…ç½®æ–‡ä»¶ã€‚é€šè¿‡è¿™æ ·åšï¼Œæ‚¨å°†èƒ½å¤Ÿè·Ÿè¸ªæ›´æ”¹å¹¶å°†æ‚¨çš„åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°ä»»ä½•ç¯å¢ƒã€‚</p>
<p>ä¸è¿‡ï¼Œåœ¨æ·±å…¥ç ”ç©¶ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„è®¡ç®—æœºä¸Šå®‰è£…äº† Docker Composeã€‚</p>
<h3 id="åœ¨æ‚¨çš„è®¡ç®—æœºä¸Šè®¾ç½®-docker-compose">åœ¨æ‚¨çš„è®¡ç®—æœºä¸Šè®¾ç½® Docker Compose</h3>
<p>å¦‚æœæ‚¨æŒ‰ç…§æœ‰å…³è®¾ç½® Docker Desktop çš„è¯´æ˜è¿›è¡Œæ“ä½œï¼Œé‚£ä¹ˆæ‚¨åº”è¯¥å·²ç»å®‰è£…äº† Docker Composeã€‚åœ¨æ‚¨çš„ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥ç¡®è®¤è¿™ä¸€ç‚¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker compose version
</span></span><span class="line"><span class="cl">Docker Compose version v2.17.2
</span></span></code></pre></div><p>ä½¿ç”¨æ†ç»‘äº† Docker Compose å’Œä¸€äº›å…¶ä»–ç»„ä»¶çš„ Docker Desktopï¼Œç›®å‰æ˜¯åœ¨ macOS å’Œ Windows ä¸Šè·å– Docker Compose çš„æ¨èæ–¹å¼ã€‚å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ Linuxï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥å°è¯•é€šè¿‡æ‰‹åŠ¨å®‰è£… Compose æ’ä»¶æˆ–ä»æ‚¨çš„å‘è¡Œç‰ˆçš„è½¯ä»¶åŒ…å­˜å‚¨åº“å®‰è£…æ›¿ä»£è·¯å¾„ã€‚ä¸å¹¸çš„æ˜¯ï¼Œæ­¤æ–¹æ³•å¯èƒ½ä¸é€‚ç”¨äºæœ€æ–°å’Œæ¨èçš„ Docker Compose ç‰ˆæœ¬ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šåœ¨è¿‡å»ï¼ŒDocker Compose æ˜¯ä¸€ä¸ªç‹¬ç«‹äº Docker å•ç‹¬ç»´æŠ¤çš„é¡¹ç›®ã€‚å®ƒæœ€åˆæ˜¯ä½œä¸º Python è„šæœ¬å®ç°çš„ï¼Œæœ€ç»ˆè¢«é‡å†™ä¸º Goã€‚</p>
<p>è¦ä½¿ç”¨ Docker Composeï¼Œæ‚¨å¿…é¡»åœ¨å‘½ä»¤è¡Œä¸­è°ƒç”¨ <code>docker-compose</code> ï¼ˆå¸¦è¿å­—ç¬¦ï¼‰å¯æ‰§è¡Œæ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œå®ƒç°åœ¨å·²é›†æˆåˆ° Docker å¹³å°ä¸­ï¼Œå› æ­¤æ‚¨å¯ä»¥å°† Docker Compose ä½œä¸º <code>docker compose</code> æ’ä»¶è°ƒç”¨ã€‚è¿™ä¸¤ä¸ªå‘½ä»¤çš„å·¥ä½œåŸç†åº”è¯¥ç›¸åŒï¼Œå› ä¸ºè¯¥æ’ä»¶æ˜¯ä¸€ç§ç›´æ¥æ›¿ä»£å“ã€‚</p>
</blockquote>
<p>ä¸€æ—¦æ‚¨ç¡®è®¤ Docker Compose åœ¨æ‚¨çš„ç»ˆç«¯ä¸­å¯ç”¨ï¼Œæ‚¨å°±å¯ä»¥å¼€å§‹äº†ï¼</p>
<h3 id="å®šä¹‰å¤šå®¹å™¨-docker-åº”ç”¨ç¨‹åº">å®šä¹‰å¤šå®¹å™¨ Docker åº”ç”¨ç¨‹åº</h3>
<p>ç”±äºæ‚¨å°†å®šä¹‰ä¸€ä¸ªå¤šå®¹å™¨ Docker åº”ç”¨ç¨‹åºï¼Œè¯¥åº”ç”¨ç¨‹åºå¯èƒ½ä¼šåœ¨æœªæ¥å¢é•¿ä»¥åŒ…å«æ›´å¤šæœåŠ¡ï¼Œå› æ­¤æœ‰å¿…è¦é‡æ–°å®‰æ’é¡¹ç›®ä¸­çš„æ–‡ä»¶å¤¹ç»“æ„ã€‚åœ¨é¡¹ç›®æ ¹æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º <code>web/</code> çš„æ–°å­æ–‡ä»¶å¤¹ï¼Œæ‚¨å°†åœ¨å…¶ä¸­å­˜å‚¨ä¸ Flask Web æœåŠ¡ç›¸å…³çš„æ‰€æœ‰æ–‡ä»¶ã€‚</p>
<p>æ‚¨çš„è™šæ‹Ÿç¯å¢ƒä¹Ÿå±äºè¿™ä¸ªæ–°çš„å­æ–‡ä»¶å¤¹ï¼Œå› ä¸ºå…¶ä»–æœåŠ¡å¯èƒ½æ˜¯ç”¨å®Œå…¨å¤–å›½çš„ç¼–ç¨‹è¯­è¨€ï¼ˆå¦‚ C++ æˆ– Javaï¼‰å®ç°çš„ã€‚ä¸å¹¸çš„æ˜¯ï¼Œç§»åŠ¨ <code>venv/</code> æ–‡ä»¶å¤¹å¯èƒ½ä¼šç ´åç›¸åº”æ¿€æ´»è„šæœ¬ä¸­ç¡¬ç¼–ç çš„ç»å¯¹è·¯å¾„ã€‚å› æ­¤ï¼Œç§»é™¤æ—§çš„è™šæ‹Ÿç¯å¢ƒå¹¶åœ¨ <code>web/</code> å­æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„è™šæ‹Ÿç¯å¢ƒä»¥ç¡®ä¿å®‰å…¨ï¼š</p>
<p>Windowsï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> PS&gt; deactivate
</span></span><span class="line"><span class="cl">PS&gt; <span class="nb">cd</span> page-tracker<span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>PS&gt; rmdir venv<span class="se">\ </span>/s
</span></span><span class="line"><span class="cl">PS&gt; python -m venv web<span class="se">\v</span>env<span class="se">\ </span>--prompt page-tracker
</span></span><span class="line"><span class="cl">PS&gt; web<span class="se">\v</span>env<span class="se">\S</span>cripts<span class="se">\a</span>ctivate
</span></span><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> PS&gt; python -m pip install --upgrade pip
</span></span></code></pre></div><p>Linux + MacOSï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ deactivate
</span></span><span class="line"><span class="cl">$ <span class="nb">cd</span> page-tracker/
</span></span><span class="line"><span class="cl">$ rm -rf venv/
</span></span><span class="line"><span class="cl">$ python3 -m venv web/venv/ --prompt page-tracker
</span></span><span class="line"><span class="cl">$ <span class="nb">source</span> web/venv/bin/activate
</span></span><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ python -m pip install --upgrade pip
</span></span></code></pre></div><p>ç„¶åï¼Œå°† Flask åº”ç”¨ç¨‹åºç§»åŠ¨åˆ°æ–°çš„ <code>web/</code> å­æ–‡ä»¶å¤¹ï¼Œåªç•™ä¸‹ <code>.git/</code> æ–‡ä»¶å¤¹ã€ <code>.gitignore</code> å’Œä»»ä½•å…¶ä»–ä¸ç¼–è¾‘å™¨ç›¸å…³çš„é…ç½®æ–‡ä»¶ã€‚æ‚¨å¯ä»¥å°†å®ƒä»¬ä¿å­˜åœ¨é¡¹ç›®æ ¹æ–‡ä»¶å¤¹ä¸­ï¼Œå› ä¸ºå®ƒä»¬å¯¹é¡¹ç›®ä¸­æ‰€æœ‰å¯èƒ½çš„æœåŠ¡éƒ½æ˜¯é€šç”¨çš„ã€‚ä¹‹åï¼Œæ‚¨çš„é¡¹ç›®ç»“æ„åº”å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">page-tracker/
</span></span><span class="line"><span class="cl">â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€ web/
</span></span><span class="line"><span class="cl">â”‚   â”‚
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ src/
</span></span><span class="line"><span class="cl">â”‚   â”‚   â””â”€â”€ page_tracker/
</span></span><span class="line"><span class="cl">â”‚   â”‚       â”œâ”€â”€ __init__.py
</span></span><span class="line"><span class="cl">â”‚   â”‚       â””â”€â”€ app.py
</span></span><span class="line"><span class="cl">â”‚   â”‚
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ test/
</span></span><span class="line"><span class="cl">â”‚   â”‚   â”œâ”€â”€ e2e/
</span></span><span class="line"><span class="cl">â”‚   â”‚   â”‚   â””â”€â”€ test_app_redis_http.py
</span></span><span class="line"><span class="cl">â”‚   â”‚   â”‚
</span></span><span class="line"><span class="cl">â”‚   â”‚   â”œâ”€â”€ integration/
</span></span><span class="line"><span class="cl">â”‚   â”‚   â”‚   â””â”€â”€ test_app_redis.py
</span></span><span class="line"><span class="cl">â”‚   â”‚   â”‚
</span></span><span class="line"><span class="cl">â”‚   â”‚   â”œâ”€â”€ unit/
</span></span><span class="line"><span class="cl">â”‚   â”‚   â”‚   â””â”€â”€ test_app.py
</span></span><span class="line"><span class="cl">â”‚   â”‚   â”‚
</span></span><span class="line"><span class="cl">â”‚   â”‚   â””â”€â”€ conftest.py
</span></span><span class="line"><span class="cl">â”‚   â”‚
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ venv/
</span></span><span class="line"><span class="cl">â”‚   â”‚
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ constraints.txt
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ Dockerfile
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ Dockerfile.dev
</span></span><span class="line"><span class="cl">â”‚   â””â”€â”€ pyproject.toml
</span></span><span class="line"><span class="cl">â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€ .git/
</span></span><span class="line"><span class="cl">â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€ .gitignore
</span></span><span class="line"><span class="cl">â””â”€â”€ docker-compose.yml
</span></span></code></pre></div><p>ä¸Šé¢æ–‡ä»¶æ ‘çš„ä¸€ä¸ªæ–°æ·»åŠ æ˜¯ä½äºé¡¶å±‚çš„ <code>docker-compose.yml</code> æ–‡ä»¶ï¼Œæ‚¨ç°åœ¨å°†ç¼–å†™è¯¥æ–‡ä»¶ã€‚</p>
<p>Docker Compose ä½¿ç”¨ YAML æ ¼å¼ä»¥å£°æ˜æ–¹å¼æè¿°åº”ç”¨ç¨‹åºçš„æœåŠ¡ï¼Œè¿™äº›æœåŠ¡å°†æˆä¸º Docker å®¹å™¨ã€å®ƒä»¬çš„ç½‘ç»œã€å·ã€ç«¯å£æ˜ å°„ã€ç¯å¢ƒå˜é‡ç­‰ã€‚</p>
<p>ä»¥å‰ï¼Œæ‚¨å¿…é¡»æ‰‹åŠ¨å®šä¹‰åº”ç”¨ç¨‹åºæ¶æ„çš„æ¯ä¸€éƒ¨åˆ†ï¼Œä½†ä½¿ç”¨ Docker Composeï¼Œæ‚¨å¯ä»¥åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å®šä¹‰æ‰€æœ‰å†…å®¹ã€‚è¯¥å·¥å…·ç”šè‡³å¯ä»¥ä¸ºæ‚¨æ‹‰å–æˆ–æ„å»ºé•œåƒï¼</p>
<blockquote>
<p>æ³¨æ„ï¼šå¦‚æœæ‚¨ä»¥å‰ä»æœªä½¿ç”¨è¿‡ YAMLï¼Œä½†ç†Ÿæ‚‰ JSONï¼Œé‚£ä¹ˆå®ƒçš„è¯­æ³•åº”è¯¥å¾ˆç†Ÿæ‚‰ï¼Œå› ä¸º YAML æ˜¯ JSON çš„è¶…é›†ã€‚æŸ¥çœ‹ YAMLï¼šPython ä¸­ä¸¢å¤±çš„ç”µæ± äº†è§£æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚</p>
</blockquote>
<p>Docker Compose æ–‡ä»¶æ˜¯æ‚¨å®šä¹‰æœåŠ¡ã€ç½‘ç»œå’Œå·çš„åœ°æ–¹ã€‚è¿™æ˜¯å®Œæ•´çš„ <code>docker-compose.yml</code> æ–‡ä»¶ï¼Œå®ƒåæ˜ äº†æ‚¨åœ¨å‰é¢éƒ¨åˆ†ä¸­ä¸ºé¡µé¢è·Ÿè¸ªå™¨åº”ç”¨ç¨‹åºæ‰‹åŠ¨å®šä¹‰çš„æ‰€æœ‰å†…å®¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># docker-compose.yml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">redis-service</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;redis:7.0.10-bullseye&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">backend-network</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;redis-volume:/data&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">web-service</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w"> </span><span class="l">./web</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;80:5000&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">REDIS_URL</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;redis://redis-service:6379&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">backend-network</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">redis-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">backend-network</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">redis-volume</span><span class="p">:</span><span class="w">
</span></span></span></code></pre></div><p>ä½ ç°åœ¨è¦é€è¡Œå‰–æå®ƒï¼š</p>
<ul>
<li>ç¬¬ 3 è¡Œæ ‡å¿—ç€ä¸¤ä¸ªæœåŠ¡ <code>redis-service</code> å’Œ <code>web-service</code> å£°æ˜çš„å¼€å§‹ï¼Œå®ƒä»¬åŒ…å«ä¸€ä¸ªå¤šå®¹å™¨ Docker åº”ç”¨ç¨‹åºã€‚è¯·æ³¨æ„ï¼Œæ‚¨å¯ä»¥æ‰©å±•æ¯ä¸ªæœåŠ¡ï¼Œå› æ­¤ Docker å®¹å™¨çš„å®é™…æ•°é‡å¯èƒ½å¤§äºæ­¤å¤„å£°æ˜çš„æœåŠ¡æ•°é‡ã€‚</li>
<li>ç¬¬ 4 è¡Œåˆ°ç¬¬ 9 è¡Œå®šä¹‰äº† <code>redis-service</code> çš„é…ç½®ï¼ŒåŒ…æ‹¬è¦è¿è¡Œçš„ Docker é•œåƒã€è¦è¿æ¥çš„ç½‘ç»œä»¥åŠè¦æŒ‚è½½çš„å·ã€‚</li>
<li>ç¬¬ 10 åˆ° 19 è¡Œé€šè¿‡æŒ‡å®šåŒ…å«è¦æ„å»ºçš„ Dockerfile çš„æ–‡ä»¶å¤¹ã€è¦å…¬å¼€çš„ç«¯å£ã€è¦è®¾ç½®çš„ç¯å¢ƒå˜é‡ä»¥åŠè¦è¿æ¥çš„ç½‘ç»œæ¥é…ç½® <code>web-service</code> ã€‚ <code>depends_on</code> è¯­å¥è¦æ±‚ <code>redis-service</code> åœ¨ <code>web-service</code> å¼€å§‹ä¹‹å‰å¯ç”¨ã€‚</li>
<li>ç¬¬ 21 å’Œ 22 è¡Œä¸ºæ‚¨çš„ä¸¤ä¸ªæœåŠ¡å®šä¹‰äº†ä¸€ä¸ªè™šæ‹Ÿç½‘ç»œã€‚æ­¤å£°æ˜å¹¶éç»å¯¹å¿…è¦ï¼Œå› ä¸º Docker Compose ä¼šè‡ªåŠ¨åˆ›å»ºå®¹å™¨å¹¶å°†å…¶è¿æ¥åˆ°æ–°ç½‘ç»œã€‚ä½†æ˜¯ï¼Œå¦‚æœéœ€è¦ï¼Œæ˜¾å¼ç½‘ç»œå£°æ˜å¯ä»¥è®©æ‚¨æ›´å¥½åœ°æ§åˆ¶å…¶è®¾ç½®å’Œåœ°å€èŒƒå›´ã€‚</li>
<li>ç¬¬ 24 å’Œ 25 è¡Œä¸ºæ‚¨çš„ Redis æœåŠ¡å™¨å®šä¹‰äº†ä¸€ä¸ªæŒä¹…å·ã€‚</li>
</ul>
<p>ä¸Šé¢é…ç½®æ–‡ä»¶ä¸­çš„ä¸€äº›å€¼è¢«å¼•ç”¨ï¼Œè€Œå¦ä¸€äº›åˆ™æ²¡æœ‰ã€‚è¿™æ˜¯é’ˆå¯¹æ—§ YAML æ ¼å¼è§„èŒƒä¸­å·²çŸ¥æ€ªç™–çš„é¢„é˜²æªæ–½ï¼Œè¯¥è§„èŒƒå°†æŸäº›å­—ç¬¦è§†ä¸ºç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚æœå®ƒä»¬å‡ºç°åœ¨æœªåŠ å¼•å·çš„å­—ç¬¦ä¸²ä¸­ã€‚ä¾‹å¦‚ï¼Œå†’å· ( <code>:</code> ) å¯ä»¥ä½¿ä¸€äº› YAML è§£æå™¨å°†æ–‡å­—è§£é‡Šä¸ºå…­åè¿›åˆ¶æ•°å­—è€Œä¸æ˜¯å­—ç¬¦ä¸²ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šæ­¤æ–‡ä»¶ç¬¦åˆæœ€æ–°å’Œæ¨èçš„ Compose è§„èŒƒï¼Œè¯¥è§„èŒƒä¸å†éœ€è¦é¡¶çº§ <code>version</code> å­—æ®µï¼Œè€Œæ—©æœŸçš„æ¨¡å¼ç‰ˆæœ¬éœ€è¦ã€‚é˜…è¯»å®˜æ–¹æ–‡æ¡£ä¸­çš„ Compose æ–‡ä»¶ç‰ˆæœ¬æ§åˆ¶ä»¥äº†è§£æ›´å¤šä¿¡æ¯ã€‚</p>
</blockquote>
<p>åœæ­¢ä»»ä½•å¯èƒ½ä»åœ¨è¿è¡Œçš„ä¸æ‚¨çš„é¡¹ç›®ç›¸å…³çš„ Docker å®¹å™¨ï¼Œå¹¶ç«‹å³åˆ é™¤å®ƒä»¬çš„å…³è”èµ„æºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker stop -t <span class="m">0</span> web-service redis-service
</span></span><span class="line"><span class="cl">$ docker container rm web-service redis-service
</span></span><span class="line"><span class="cl">$ docker network rm page-tracker-network
</span></span><span class="line"><span class="cl">$ docker volume rm redis-volume
</span></span></code></pre></div><p>è¿™å°†åˆ é™¤æ‚¨ä¹‹å‰åˆ›å»ºçš„ä¸¤ä¸ªå®¹å™¨ã€ä¸€ä¸ªç½‘ç»œå’Œä¸€ä¸ªå·ã€‚è¯·æ³¨æ„ï¼Œæ‚¨å¯ä»¥å°† <code>docker container rm</code> å‘½ä»¤ç¼©å†™ä¸ºæ›´çŸ­çš„ <code>docker rm</code> åˆ«åã€‚</p>
<p>è¦ä¼˜é›…åœ°åˆ é™¤å®¹å™¨ï¼Œæ‚¨åº”è¯¥é¦–å…ˆåœæ­¢å®ƒã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ <code>docker stop</code> å‘½ä»¤å°†åœ¨ç»ˆæ­¢å®¹å™¨ä¹‹å‰ç­‰å¾…åç§’é’Ÿï¼Œä½¿å…¶æœ‰è¶³å¤Ÿçš„æ—¶é—´åœ¨é€€å‡ºä¹‹å‰æ‰§è¡Œä»»ä½•å¿…è¦çš„æ¸…ç†æ“ä½œã€‚å› ä¸ºæ‚¨çš„ Flask åº”ç”¨ç¨‹åºåœ¨åœæ­¢è¿è¡Œåä¸éœ€è¦åšä»»ä½•äº‹æƒ…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>-t</code> é€‰é¡¹å°†æ­¤è¶…æ—¶è®¾ç½®ä¸ºé›¶ç§’ï¼Œè¿™å°†ç«‹å³ç»ˆæ­¢åˆ—å‡ºçš„å®¹å™¨ã€‚</p>
<p>è¦åˆ é™¤æ‰€æœ‰å…³è”çš„ Docker é•œåƒæ ‡ç­¾ï¼Œæ‚¨å¿…é¡»é¦–å…ˆæ‰¾åˆ°å®ƒä»¬çš„å…¬å…±æ ‡è¯†ç¬¦ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker images
</span></span><span class="line"><span class="cl">REPOSITORY                TAG              IMAGE ID       CREATED      SIZE
</span></span><span class="line"><span class="cl">page-tracker              dde1dc9          9cb2e3233522   <span class="m">1</span> hour ago   204MB
</span></span><span class="line"><span class="cl">page-tracker              latest           9cb2e3233522   <span class="m">1</span> hour ago   204MB
</span></span><span class="line"><span class="cl">realpython/page-tracker   dde1dc9          9cb2e3233522   <span class="m">1</span> hour ago   204MB
</span></span><span class="line"><span class="cl">realpython/page-tracker   latest           9cb2e3233522   <span class="m">1</span> hour ago   204MB
</span></span><span class="line"><span class="cl"><span class="o">(</span>...<span class="o">)</span>
</span></span></code></pre></div><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ <code>page-tracker</code> é•œåƒçš„æ‰€æœ‰æ ‡ç­¾å…±æœ‰çš„çŸ­ ID ç­‰äº <code>9cb2e3233522</code> ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥å–æ¶ˆæ ‡è®°å’Œåˆ é™¤åº•å±‚ Docker é•œåƒï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker rmi -f 9cb2e3233522
</span></span><span class="line"><span class="cl">Untagged: page-tracker:dde1dc9
</span></span><span class="line"><span class="cl">Untagged: page-tracker:latest
</span></span><span class="line"><span class="cl">Untagged: realpython/page-tracker:dde1dc9
</span></span><span class="line"><span class="cl">Untagged: realpython/page-tracker:latest
</span></span><span class="line"><span class="cl">Deleted: sha256:9cb2e3233522e020c366880867980232d747c4c99a1f60a61b9bece40...
</span></span></code></pre></div><p><code>docker rmi</code> å‘½ä»¤æ˜¯ <code>docker image rm</code> å’Œ <code>docker image remove</code> çš„åˆ«åã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå¦‚æœä½ æƒ³ä»å¤´å¼€å§‹ä½¿ç”¨å…¨æ–°çš„ Docker ç¯å¢ƒï¼Œå¹¶ä¸”ä¸ä»‹æ„ä¸¢å¤±æ•°æ®ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¿®å‰ªæ‰€æœ‰ç³»ç»Ÿèµ„æºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker system prune --all --volumes
</span></span></code></pre></div><p>è­¦å‘Šï¼è¿™å°†åˆ é™¤æ‚¨åˆ°ç›®å‰ä¸ºæ­¢ä½¿ç”¨ Docker åˆ›å»ºçš„æ‰€æœ‰å†…å®¹ï¼ŒåŒ…æ‹¬å¯èƒ½åœ¨æœ¬æ•™ç¨‹ä¹‹å¤–åˆ›å»ºçš„èµ„æºï¼Œå› æ­¤è¯·è°¨æ…æ“ä½œã€‚</p>
</blockquote>
<p>ç¡®è®¤åˆ é™¤ Docker èµ„æºåï¼Œæ‚¨å¯ä»¥é€šè¿‡ä¸€æ¡æŒ‡ä»¤ç«‹å³æ¢å¤æ‚¨çš„é¡µé¢è·Ÿè¸ªå™¨åº”ç”¨ç¨‹åºã€‚åœ¨ä¸ <code>docker-comopse.yml</code> æ–‡ä»¶ç›¸åŒçš„æ–‡ä»¶å¤¹ä¸­å‘å‡ºä»¥ä¸‹å‘½ä»¤ä»¥é¿å…æŒ‡å®šå…¶è·¯å¾„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker compose up -d
</span></span><span class="line"><span class="cl"><span class="o">(</span>...<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Running 4/4
</span></span><span class="line"><span class="cl"> â ¿ Network page-tracker_backend-network    Created                      0.1s
</span></span><span class="line"><span class="cl"> â ¿ Volume <span class="s2">&#34;page-tracker_redis-volume&#34;</span>      Created                      0.0s
</span></span><span class="line"><span class="cl"> â ¿ Container page-tracker-redis-service-1  Started                      1.0s
</span></span><span class="line"><span class="cl"> â ¿ Container page-tracker-web-service-1    Started                      1.3s
</span></span></code></pre></div><p>ç¬¬ä¸€æ¬¡è¿è¡Œæ­¤å‘½ä»¤æ—¶ï¼Œå¯èƒ½éœ€è¦æ›´é•¿çš„æ—¶é—´ï¼Œå› ä¸º Docker Compose å¿…é¡»ä» Docker Hub ä¸‹è½½ Redis é•œåƒå¹¶å†æ¬¡ä» Dockerfile æ„å»ºå¦ä¸€ä¸ªé•œåƒã€‚ä½†åœ¨é‚£ä¹‹åï¼Œå®ƒåº”è¯¥æ„Ÿè§‰å‡ ä¹æ˜¯ç¬é—´çš„ã€‚</p>
<p>æ‚¨å¯ä»¥åœ¨ä¸Šé¢çš„è¾“å‡ºä¸­çœ‹åˆ° Docker Compose åˆ›å»ºäº†è¯·æ±‚çš„ç½‘ç»œã€å·å’Œä¸¤ä¸ªå®¹å™¨ã€‚è¯·æ³¨æ„ï¼Œå®ƒå§‹ç»ˆåœ¨æ­¤ç±»èµ„æºåç§°å‰åŠ ä¸Šæ‚¨çš„ Docker Compose é¡¹ç›®åç§°å‰ç¼€ï¼Œè¯¥åç§°é»˜è®¤ä¸ºåŒ…å«æ‚¨çš„ <code>docker-compose.yml</code> æ–‡ä»¶çš„æ–‡ä»¶å¤¹åç§°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé¡¹ç›®åç§°æ˜¯ <code>page-tracker</code> ã€‚æ­¤åŠŸèƒ½æœ‰åŠ©äºé˜²æ­¢ä¸åŒ Docker Compose é¡¹ç›®çš„èµ„æºåç§°å‘ç”Ÿå†²çªã€‚</p>
<p>æ­¤å¤–ï¼Œå¦‚æœæ‚¨æƒ³å¯åŠ¨åŒä¸€æœåŠ¡çš„å¤šä¸ªå‰¯æœ¬ï¼ŒDocker Compose ä¼šå°†è¿ç»­çš„æ•°å­—é™„åŠ åˆ°æ‚¨çš„å®¹å™¨åç§°ä¸­ã€‚</p>
<p>Docker Compose æ’ä»¶æä¾›äº†å‡ ä¸ªæœ‰ç”¨çš„å‘½ä»¤æ¥ç®¡ç†æ‚¨çš„å¤šå®¹å™¨åº”ç”¨ç¨‹åºã€‚è¿™é‡Œåªæ˜¯å…¶ä¸­çš„å‡ ä¸ªï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker compose ps
</span></span><span class="line"><span class="cl">NAME                           COMMAND                  SERVICE        ...
</span></span><span class="line"><span class="cl">page-tracker-redis-service-1   <span class="s2">&#34;docker-entrypoint.sâ€¦&#34;</span>   redis-service  ...
</span></span><span class="line"><span class="cl">page-tracker-web-service-1     <span class="s2">&#34;flask --app page_trâ€¦&#34;</span>   web-service    ...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ docker compose logs --follow
</span></span><span class="line"><span class="cl"><span class="o">(</span>...<span class="o">)</span>
</span></span><span class="line"><span class="cl">page-tracker-web-service-1    <span class="p">|</span>  * Running on all addresses <span class="o">(</span>0.0.0.0<span class="o">)</span>
</span></span><span class="line"><span class="cl">page-tracker-web-service-1    <span class="p">|</span>  * Running on http://127.0.0.1:5000
</span></span><span class="line"><span class="cl">page-tracker-web-service-1    <span class="p">|</span>  * Running on http://172.20.0.3:5000
</span></span><span class="line"><span class="cl">page-tracker-web-service-1    <span class="p">|</span> Press CTRL+C to quit
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ docker compose stop
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Running 2/2
</span></span><span class="line"><span class="cl"> â ¿ Container page-tracker-web-service-1    Stopped                     10.3s
</span></span><span class="line"><span class="cl"> â ¿ Container page-tracker-redis-service-1  Stopped                      0.4s
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ docker compose restart
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Running 2/2
</span></span><span class="line"><span class="cl"> â ¿ Container page-tracker-redis-service-1  Started                      0.4s
</span></span><span class="line"><span class="cl"> â ¿ Container page-tracker-web-service-1    Started                      0.5s
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ docker compose down --volumes
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Running 4/4
</span></span><span class="line"><span class="cl"> â ¿ Container page-tracker-web-service-1    Removed                      6.0s
</span></span><span class="line"><span class="cl"> â ¿ Container page-tracker-redis-service-1  Removed                      0.4s
</span></span><span class="line"><span class="cl"> â ¿ Volume page-tracker_redis-volume        Removed                      0.0s
</span></span><span class="line"><span class="cl"> â ¿ Network page-tracker_backend-network    Removed                      0.1s
</span></span></code></pre></div><p>ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åˆ—å‡º Docker Compose é¡¹ç›®ä¸­çš„å®¹å™¨è€Œä¸æ˜¾ç¤ºä»»ä½•å…¶ä»–å®¹å™¨ã€‚ä½¿ç”¨ç›¸å…³å‘½ä»¤ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å®ƒä»¬çš„å®æ—¶è¾“å‡ºã€åœæ­¢ã€å¯åŠ¨å’Œé‡æ–°å¯åŠ¨å®ƒä»¬ã€‚</p>
<p>å®Œæˆé¡¹ç›®åï¼Œæ‚¨å¯ä»¥å°†å…¶æ‹†é™¤ï¼ŒDocker Compose å°†åˆ é™¤å…³è”çš„å®¹å™¨å’Œç½‘ç»œã€‚ä½†æ˜¯ï¼Œå®ƒä¸ä¼šè§¦åŠæŒä¹…æ•°æ®å­˜å‚¨ï¼Œé™¤éæ‚¨ä½¿ç”¨ <code>--volumes</code> æ ‡å¿—æ˜ç¡®è¯·æ±‚ã€‚</p>
<p>æ‚¨å¯èƒ½å·²ç»åœ¨æ—¥å¿—ä¸­æ³¨æ„åˆ°ä¸€ä»¶äº‹ï¼ŒFlask å·²ç»æŠ±æ€¨äº†å¾ˆé•¿æ—¶é—´ï¼Œé‚£å°±æ˜¯ä½¿ç”¨å…¶ä¸å®‰å…¨ã€ä½æ•ˆä¸”ä¸ç¨³å®šçš„å¼€å‘ Web æœåŠ¡å™¨æ¥è¿è¡Œæ‚¨çš„åº”ç”¨ç¨‹åºã€‚æ‚¨ç°åœ¨å°†ä½¿ç”¨ Docker Compose æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<h3 id="å°†-flask-çš„å¼€å‘-web-æœåŠ¡å™¨æ›¿æ¢ä¸º-gunicorn">å°† Flask çš„å¼€å‘ Web æœåŠ¡å™¨æ›¿æ¢ä¸º Gunicorn</h3>
<p>Docker å…è®¸æ‚¨åœ¨è¿è¡Œæ–°å®¹å™¨æ—¶è¦†ç›– Dockerfile ä¸­åˆ—å‡ºçš„é»˜è®¤å‘½ä»¤æˆ–å…¥å£ç‚¹ã€‚ä¾‹å¦‚ï¼Œ <code>redis</code> é•œåƒä¸­çš„é»˜è®¤å‘½ä»¤å¯åŠ¨ Redis æœåŠ¡å™¨ã€‚ä½†æ˜¯ï¼Œæ‚¨ä¹‹å‰ä½¿ç”¨ç›¸åŒçš„é•œåƒåœ¨å¦ä¸€ä¸ªå®¹å™¨ä¸­å¯åŠ¨ <code>redis-cli</code> ã€‚åŒæ ·ï¼Œæ‚¨å¯ä»¥åœ¨ <code>docker-compose.yml</code> æ–‡ä»¶ä¸­ä¸ºæ‚¨çš„ Docker é•œåƒæŒ‡å®šè‡ªå®šä¹‰å‘½ä»¤ã€‚æ‚¨å°†ä½¿ç”¨æ­¤åŠŸèƒ½é€šè¿‡ç”Ÿäº§çº§ Web æœåŠ¡å™¨è¿è¡Œ Flaskã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šæœ‰æ—¶ï¼Œæ‚¨æƒ³è¦è°ƒæŸ¥ç°æœ‰å®¹å™¨ã€‚è¦åœ¨æ­£åœ¨è¿è¡Œçš„å®¹å™¨ä¸­è¿è¡Œå‘½ä»¤è€Œä¸æ˜¯å¯åŠ¨æ–°å®¹å™¨ï¼Œå¯ä»¥ä½¿ç”¨ <code>docker exec</code> å‘½ä»¤ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker <span class="nb">exec</span> -it -u root page-tracker-web-service-1 /bin/bash
</span></span><span class="line"><span class="cl">root@6e23f154a5b9:/home/realpython#
</span></span></code></pre></div><p>é€šè¿‡è¿è¡Œ Bash å¯æ‰§è¡Œæ–‡ä»¶ <code>/bin/bash</code> å¹¶ä½¿ç”¨ <code>-u</code> é€‰é¡¹æŒ‡å®šç”¨æˆ·ï¼Œæ‚¨å¯ä»¥æœ‰æ•ˆåœ°è®¿é—®å®¹å™¨ï¼Œå°±åƒé€šè¿‡ SSH ç™»å½•è¿œç¨‹æœåŠ¡å™¨ä¸€æ ·ã€‚ <code>-it</code> æ ‡å¿—æ˜¯è¿è¡Œäº¤äº’å¼ç»ˆç«¯ä¼šè¯æ‰€å¿…éœ€çš„ã€‚å¦åˆ™ï¼Œè¯¥å‘½ä»¤å°†ç«‹å³é€€å‡ºã€‚</p>
</blockquote>
<p>æœ‰å‡ ä¸ªé€‰é¡¹å¯ä»¥æ›¿æ¢ Flask çš„å†…ç½®å¼€å‘ Web æœåŠ¡å™¨ï¼Œå®˜æ–¹æ–‡æ¡£åœ¨éƒ¨ç½²åˆ°ç”Ÿäº§æ—¶æ¨èä½¿ç”¨è¿™äº›é€‰é¡¹ã€‚æœ€å—æ¬¢è¿çš„é€‰æ‹©ä¹‹ä¸€æ˜¯ Gunicorn (Green Unicorn)ï¼Œå®ƒæ˜¯ Web æœåŠ¡å™¨ç½‘å…³æ¥å£ (WSGI) åè®®çš„çº¯ Python å®ç°ã€‚è¦å¼€å§‹ä½¿ç”¨å®ƒï¼Œæ‚¨å¿…é¡»å°† <code>gunicorn</code> åŒ…æ·»åŠ ä¸ºé¡¹ç›®ä¸­çš„å¦ä¸€ä¸ªä¾èµ–é¡¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-toml" data-lang="toml"><span class="line"><span class="cl"><span class="c"># web/pyproject.toml</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="nx">build-system</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">requires</span> <span class="p">=</span> <span class="p">[</span><span class="s2">&#34;setuptools&gt;=67.0.0&#34;</span><span class="p">,</span> <span class="s2">&#34;wheel&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">build-backend</span> <span class="p">=</span> <span class="s2">&#34;setuptools.build_meta&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="nx">project</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">name</span> <span class="p">=</span> <span class="s2">&#34;page-tracker&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">version</span> <span class="p">=</span> <span class="s2">&#34;1.0.0&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nx">dependencies</span> <span class="p">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Flask&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;gunicorn&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;redis&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="nx">project</span><span class="p">.</span><span class="nx">optional-dependencies</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">dev</span> <span class="p">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;bandit&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;black&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;flake8&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;isort&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;pylint&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;pytest&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;pytest-timeout&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;requests&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><p>è¯·æ³¨æ„ï¼Œæ‚¨å°† <code>gunicorn</code> æ·»åŠ åˆ°å¸¸è§„ä¾èµ–é¡¹åˆ—è¡¨ä¸­ï¼Œå› ä¸ºå®ƒå°†æˆä¸ºæ‚¨åº”ç”¨ç¨‹åºä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ã€‚æ‚¨å¸Œæœ›åœ¨æ„å»ºæœ€ç»ˆ Docker é•œåƒåå®ƒå¯ç”¨ã€‚</p>
<p>åƒå¾€å¸¸ä¸€æ ·ï¼Œåœ¨æœ¬åœ°é‡æ–°å®‰è£…æ‚¨çš„ <code>page-tracker</code> åŒ…å¹¶å°†å…¶ä¾èµ–é¡¹å›ºå®šåœ¨çº¦æŸæ–‡ä»¶ä¸­ã€‚è¯·è®°ä½ï¼Œæ‚¨å¯èƒ½éœ€è¦å…ˆæ¿€æ´»æ‚¨çš„è™šæ‹Ÿç¯å¢ƒï¼Œå› ä¸ºæ‚¨ä¹‹å‰åœ¨ <code>web/</code> å­æ–‡ä»¶å¤¹ä¸­é‡æ–°åˆ›å»ºäº†å®ƒï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ python -m pip install --editable <span class="s2">&#34;web/[dev]&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ python -m pip freeze --exclude-editable &gt; web/constraints.txt
</span></span></code></pre></div><p>è¯·æ³¨æ„ï¼Œå½“æ‚¨ä»é¡¹ç›®çš„æ ¹æ–‡ä»¶å¤¹ä¸­æ‰§è¡Œè¿™äº›å‘½ä»¤æ—¶ï¼Œå®ƒä»¬çœ‹èµ·æ¥ä¼šç•¥æœ‰ä¸åŒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¿…é¡»å°†æŒ‡ç¤ºå½“å‰å·¥ä½œç›®å½•çš„ç‚¹ ( <code>.</code> ) æ›¿æ¢ä¸ºæ‚¨çš„ <code>web/</code> å­æ–‡ä»¶å¤¹çš„è·¯å¾„ã€‚</p>
<p>ç°åœ¨æ‚¨å·²ç»å®‰è£…äº† Gunicornï¼Œæ‚¨å¯ä»¥å¼€å§‹ä½¿ç”¨å®ƒäº†ã€‚é€šè¿‡åœ¨ <code>web-service</code> é”®ä¸‹æ·»åŠ æ–°çš„ <code>command</code> å±æ€§æ¥ä¿®æ”¹ <code>docker-compose.yml</code> ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># docker-compose.yml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">redis-service</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;redis:7.0.10-bullseye&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">backend-network</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;redis-volume:/data&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">web-service</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w"> </span><span class="l">./web</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;80:8000&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">REDIS_URL</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;redis://redis-service:6379&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">backend-network</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">redis-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;gunicorn page_tracker.app:app --bind 0.0.0.0:8000&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">backend-network</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">redis-volume</span><span class="p">:</span><span class="w">
</span></span></span></code></pre></div><p>æ­¤å‘½ä»¤å°†ä¼˜å…ˆäº Dockerfile çš„é»˜è®¤å‘½ä»¤ï¼Œåè€…ä¾èµ–äº Flask çš„å¼€å‘æœåŠ¡å™¨ã€‚ä»ç°åœ¨å¼€å§‹ï¼ŒDocker Compose å°†æ”¹ä¸ºä½¿ç”¨ Gunicorn è¿è¡Œæ‚¨çš„ Web åº”ç”¨ç¨‹åºã€‚ä¸ºäº†æ˜¾ç¤ºå·®å¼‚ï¼Œæ‚¨å°†åœ¨ç«¯å£ <code>8000</code> è€Œä¸æ˜¯ <code>5000</code> ä¸Šè¿è¡ŒæœåŠ¡å™¨ï¼Œå› æ­¤æ‚¨è¿˜æ›´æ”¹äº†ç«¯å£æ˜ å°„ã€‚</p>
<p>é€šè¿‡åœ¨ä¸»æœºä¸Šå…¬å¼€ç«¯å£ <code>80</code> ï¼Œæ‚¨ä»ç„¶å¯ä»¥åœ¨ä¸æŒ‡å®šç«¯å£å·çš„æƒ…å†µä¸‹è®¿é—® <code>http://localhost</code> ä¸Šçš„åº”ç”¨ç¨‹åºã€‚</p>
<p>ä¸è¦å¿˜è®°æäº¤æ›´æ”¹ä»¥å°†æ‚¨çš„å·¥ä½œä¿å­˜åœ¨æœ¬åœ° Git å­˜å‚¨åº“ä¸­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ git add .
</span></span><span class="line"><span class="cl">$ git commit -m <span class="s2">&#34;Refactor folders and add Docker Compose&#34;</span>
</span></span></code></pre></div><p>è¿›è¡Œå°è€Œé¢‘ç¹çš„æäº¤æ€»æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥éšç€æ—¶é—´çš„æ¨ç§»è·Ÿè¸ªå¢é‡æ›´æ”¹å¹¶æ›´å¥½åœ°äº†è§£æ‚¨çš„å·¥ä½œå†å²ã€‚å¦‚æœæ‚¨ä¸ç¡®å®šå¦‚ä½•æè¿°æ‚¨çš„æäº¤ï¼Œè¯·å°è¯•è§£é‡Šä¸ºä»€ä¹ˆæ‚¨è¿›è¡Œäº†ç‰¹å®šæ›´æ”¹ï¼Œå› ä¸º Git å·²ç»è·Ÿè¸ªæ›´æ”¹çš„å†…å®¹ã€‚</p>
<p>å¥½çš„ã€‚å¦‚æœæ‚¨ç°åœ¨å°è¯•é‡æ–°å¯åŠ¨ Docker Compose åº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆå®ƒå°†å¤±è´¥ï¼Œå› ä¸º Docker åœ¨å®¹å™¨å¯åŠ¨æœŸé—´æ‰¾ä¸åˆ°è¯·æ±‚çš„ <code>gunicorn</code> å¯æ‰§è¡Œæ–‡ä»¶ã€‚æ‚¨å·²ç»æ·»åŠ äº†æ‚¨ä¹‹å‰æ„å»ºçš„ Docker é•œåƒä¸­ç¼ºå°‘çš„é¢å¤–ä¾èµ–é¡¹ã€‚å› æ­¤ï¼Œä½ å¿…é¡»å‘Šè¯‰ Docker Compose é‡å»ºä½ çš„é•œåƒã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»»ä¸€å‘½ä»¤æ‰§è¡Œæ­¤æ“ä½œï¼š</p>
<ul>
<li>docker compose build</li>
<li>docker compose up &ndash;build</li>
</ul>
<p>åœ¨ç¬¬ä¸€ç§æƒ…å†µä¸‹ï¼Œæ‚¨ä¼šæ˜ç¡®å‘Šè¯‰ Docker é¢„å…ˆæ„å»ºé•œåƒã€‚æ¯å½“æ‚¨æ›´æ”¹é¡¹ç›®ä¾èµ–é¡¹æˆ– Dockerfile æ—¶ï¼Œæ‚¨éƒ½å¿…é¡»å†æ¬¡è¿è¡Œ <code>docker compose build</code> ä»¥åº”ç”¨è¿™äº›æ›´æ”¹ã€‚</p>
<p>åœ¨ç¬¬äºŒç§æƒ…å†µä¸‹ï¼Œ <code>docker compose up --build</code> å°†æŒ‡ç¤º Docker åœ¨æ¯æ¬¡å¯åŠ¨å®¹å™¨æ—¶å³æ—¶æ„å»ºé•œåƒã€‚å¦‚æœæ‚¨è¯•å›¾å¿«é€Ÿè¿­ä»£å¯¹æºä»£ç æˆ– Dockerfile çš„æ›´æ”¹ï¼Œè¿™å°†ç‰¹åˆ«æœ‰ç”¨ã€‚</p>
<p>æ— è®ºå“ªç§æ–¹å¼ï¼Œè¿™ä¸¤ä¸ªå‘½ä»¤éƒ½åº”è¯¥åœ¨å¯åŠ¨ç›¸åº”å®¹å™¨ä¹‹å‰åœ¨ä»»ä½•å—å½±å“çš„ Docker é•œåƒä¸­æˆåŠŸæ„å»ºä¿®æ”¹åçš„å±‚ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥æ”¾å¿ƒï¼Œå½“æ‚¨çš„ Docker Compose åº”ç”¨ç¨‹åºå†æ¬¡å¯åŠ¨æ—¶ï¼Œæ‰€æœ‰ä¾èµ–é¡¹éƒ½å°†å¯ç”¨ã€‚</p>
<p>ç»§ç»­å¹¶ç«‹å³è¿è¡Œè¿™äº›å‘½ä»¤ä¹‹ä¸€ã€‚</p>
<p>å› ä¸ºæ‚¨äº†è§£å¦‚ä½•ä½¿ç”¨ Docker Compose æ¥ç®¡ç†åº”ç”¨ç¨‹åºçš„æœåŠ¡ï¼Œæ‰€ä»¥æ‚¨ç°åœ¨å¯ä»¥äº†è§£å¦‚ä½•åœ¨æ¥è¿‘ç”Ÿäº§çš„ç¯å¢ƒä¸­è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•ã€‚</p>
<h3 id="é’ˆå¯¹æœåŠ¡è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•">é’ˆå¯¹æœåŠ¡è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•</h3>
<p>åœ¨ç¬¬ä¸€æ¬¡å°è¯•ä¸­ï¼Œæ‚¨å°†ä»ä¸»æœºæœ¬åœ°æ‰§è¡Œç«¯åˆ°ç«¯æµ‹è¯•ã€‚è¯·æ³¨æ„ï¼Œå¿…é¡»å¯ä»¥ä»æ‚¨çš„æœ¬åœ°ç½‘ç»œè®¿é—®æ‰€æœ‰å¿…è¦çš„æœåŠ¡æ‰èƒ½ä½¿å…¶æ­£å¸¸å·¥ä½œã€‚</p>
<p>è™½ç„¶è¿™å¹¶ä¸ç†æƒ³ï¼Œå› ä¸ºæ‚¨ä¸æƒ³å‘å…¬ä¼—å…¬å¼€ä»»ä½•æ•æ„ŸæœåŠ¡ï¼ˆå¦‚æ•°æ®åº“ï¼‰ï¼Œä½†ç¨åæ‚¨å°†äº†è§£æ›´å¥½çš„æ–¹æ³•ã€‚åŒæ—¶ï¼Œæ‚¨å¯ä»¥æ›´æ–°æ‚¨çš„ <code>docker-compose.yml</code> é…ç½®ä»¥è½¬å‘ Redis ç«¯å£ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># docker-compose.yml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">redis-service</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;redis:7.0.10-bullseye&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;6379:6379&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">backend-network</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;redis-volume:/data&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">web-service</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w"> </span><span class="l">./web</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;80:8000&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">REDIS_URL</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;redis://redis-service:6379&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">backend-network</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">redis-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;gunicorn page_tracker.app:app --bind 0.0.0.0:8000&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">backend-network</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">redis-volume</span><span class="p">:</span><span class="w">
</span></span></span></code></pre></div><p>å¦‚æœæ‚¨æœ‰ä¸€ä¸ªç”¨äº <code>redis-service</code> çš„ç°æœ‰ Docker å®¹å™¨ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦å…ˆåˆ é™¤è¯¥å®¹å™¨ï¼Œå³ä½¿å®ƒå½“å‰å·²åœæ­¢ï¼Œä»¥åæ˜ æ–°çš„ç«¯å£è½¬å‘è§„åˆ™ã€‚å¹¸è¿çš„æ˜¯ï¼ŒDocker Compose ä¼šè‡ªåŠ¨æ£€æµ‹ <code>docker-compose.yml</code> æ–‡ä»¶ä¸­çš„æ›´æ”¹ï¼Œå¹¶åœ¨æ‚¨å‘å‡º <code>docker compose up</code> å‘½ä»¤æ—¶æ ¹æ®éœ€è¦é‡æ–°åˆ›å»ºå®¹å™¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker compose up -d
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Running 2/2
</span></span><span class="line"><span class="cl"> â ¿ Container page-tracker-redis-service-1  Started                      1.0s
</span></span><span class="line"><span class="cl"> â ¿ Container page-tracker-web-service-1    Started                      1.2s
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ docker compose ps
</span></span><span class="line"><span class="cl">NAME                           ...   PORTS
</span></span><span class="line"><span class="cl">page-tracker-redis-service-1   ...   0.0.0.0:6379-&gt;6379/tcp
</span></span><span class="line"><span class="cl">page-tracker-web-service-1     ...   0.0.0.0:80-&gt;8000/tcp
</span></span></code></pre></div><p>åˆ—å‡ºæ–°å®¹å™¨åï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ° Redis å®¹å™¨ä¸Šçš„ç«¯å£ <code>6379</code> è¢«è½¬å‘åˆ°ä¸»æœºã€‚æœ‰äº†è¿™ä¸ªï¼Œæ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨å®‰è£…åœ¨å¼€å‘æœºå™¨ä¸Šçš„è™šæ‹Ÿç¯å¢ƒä¸­çš„ <code>pytest</code> è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span>page-tracker<span class="o">)</span> $ python -m pytest web/test/e2e/ <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --flask-url http://localhost <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --redis-url redis://localhost:6379
</span></span></code></pre></div><p>ç”±äºç«¯å£æ˜ å°„ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ localhost è¿æ¥åˆ°å®¹å™¨ï¼Œè€Œæ— éœ€çŸ¥é“å®ƒä»¬å„è‡ªçš„ IP åœ°å€ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå¦‚æœæ‚¨çš„æµ‹è¯•æˆåŠŸï¼Œé‚£ä¹ˆå®ƒå°†è¦†ç›– Redis ä¸­çš„é¡µé¢æµè§ˆé‡ã€‚æ ¹æ®ç»éªŒï¼Œæ‚¨æ°¸è¿œä¸åº”è¯¥åœ¨å¸¦æœ‰å®¢æˆ·æ•°æ®çš„å®æ—¶ç¯å¢ƒä¸­è¿è¡Œæµ‹è¯•ï¼Œä»¥é¿å…ç ´åå®ƒã€‚é€šå¸¸å»ºè®®ä½¿ç”¨å¸¦æœ‰è™šå‡æˆ–åŒ¿åæ•°æ®çš„æš‚å­˜æˆ–è®¤è¯ç¯å¢ƒæ¥å®‰å…¨åœ°æ‰§è¡Œå…¨é¢çš„ç«¯åˆ°ç«¯æµ‹è¯•ã€‚</p>
</blockquote>
<p>è¦æ¨¡æ‹Ÿæ•…éšœï¼Œæ‚¨å¯ä»¥åœ¨æµ‹è¯•æ‰§è¡ŒæœŸé—´æš‚æ—¶æš‚åœå®¹å™¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker compose pause
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Running 2/0
</span></span><span class="line"><span class="cl"> â ¿ Container page-tracker-web-service-1    Paused                       0.0s
</span></span><span class="line"><span class="cl"> â ¿ Container page-tracker-redis-service-1  Paused                       0.0s
</span></span></code></pre></div><p>è¿™å°†ä½¿ Redis å’Œæ‚¨çš„ Flask åº”ç”¨ç¨‹åºæ— æ³•å†è®¿é—®ã€‚ä¸åœæ­¢å®¹å™¨ä¸åŒï¼Œæš‚åœå®ƒä¸ä¼šç»ˆæ­¢åº•å±‚è¿›ç¨‹ï¼Œå› æ­¤æš‚åœä¼šä¿æŒå®¹å™¨çš„çŠ¶æ€å¹¶å¯¼è‡´æ›´å¿«çš„æ¢å¤ã€‚</p>
<p>ä¹‹åä¸è¦å¿˜è®°å–æ¶ˆæš‚åœå®¹å™¨ä»¥é¿å…ä»¥åå‡ºç°é”™è¯¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker compose unpause
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Running 2/0
</span></span><span class="line"><span class="cl"> â ¿ Container page-tracker-web-service-1    Unpaused                     0.0s
</span></span><span class="line"><span class="cl"> â ¿ Container page-tracker-redis-service-1  Unpaused                     0.0s
</span></span></code></pre></div><p>æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä»åŒä¸€ç½‘ç»œä¸Šçš„å¦ä¸€ä¸ªå®¹å™¨è¿è¡Œå®ƒï¼Œè€Œä¸æ˜¯åœ¨æœ¬åœ°é’ˆå¯¹å…¬å¼€æœåŠ¡è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•ã€‚æ‚¨å¯ä»¥æ‰‹åŠ¨åˆ¶ä½œè¿™æ ·çš„å®¹å™¨ã€‚</p>
<p>ç„¶è€Œï¼Œæœ€è¿‘ç‰ˆæœ¬çš„ Docker Compose æä¾›äº†ä¸€ä¸ªæ›´ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼Œå®ƒå…è®¸æ‚¨æœ‰æ¡ä»¶åœ°è¿è¡ŒæœåŠ¡çš„å­é›†ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥å°†æ‰€éœ€çš„æœåŠ¡åˆ†é…ç»™å¯æŒ‰éœ€æ¿€æ´»çš„è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ã€‚</p>
<p>é¦–å…ˆï¼Œæ‰“å¼€ä½ çš„ <code>docker-compose.yml</code> æ–‡ä»¶å¹¶ä» Redis ä¸­åˆ é™¤ç«¯å£è½¬å‘ï¼Œå› ä¸ºä½ ä¸æƒ³å†å°†å®ƒæš´éœ²ç»™å¤–ç•Œã€‚ç„¶åï¼ŒåŸºäºæ‚¨çš„æ—§ <code>Dockerfile.dev</code> æ·»åŠ ä¸€ä¸ªæ–°æœåŠ¡ï¼Œå®ƒæ†ç»‘äº†æµ‹è¯•æ¡†æ¶ã€æµ‹è¯•è£…ç½®å’Œæ‚¨çš„æµ‹è¯•ä»£ç ã€‚æ‚¨å°†ä½¿ç”¨ç›¸åº”çš„ Docker é•œåƒæ¥æ‰§è¡Œç«¯åˆ°ç«¯æµ‹è¯•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w"> </span><span class="c"># docker-compose.yml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">redis-service</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;redis:7.0.10-bullseye&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">backend-network</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;redis-volume:/data&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">web-service</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w"> </span><span class="l">./web</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;80:8000&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">REDIS_URL</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;redis://redis-service:6379&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">backend-network</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">redis-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;gunicorn page_tracker.app:app --bind 0.0.0.0:8000&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">test-service</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">profiles</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">testing</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l">./web</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">dockerfile</span><span class="p">:</span><span class="w"> </span><span class="l">Dockerfile.dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">REDIS_URL</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;redis://redis-service:6379&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">FLASK_URL</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;http://web-service:8000&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">backend-network</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">redis-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">web-service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p">&gt;</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">      sh -c &#39;python -m pytest test/e2e/ -vv
</span></span></span><span class="line"><span class="cl"><span class="sd">      --redis-url $$REDIS_URL
</span></span></span><span class="line"><span class="cl"><span class="sd">      --flask-url $$FLASK_URL&#39;</span><span class="w">      
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">backend-network</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">redis-volume</span><span class="p">:</span><span class="w">
</span></span></span></code></pre></div><p><code>docker-compose.yml</code> æ–‡ä»¶çš„å¤§éƒ¨åˆ†å†…å®¹ä¿æŒä¸å˜ï¼Œå› æ­¤æ‚¨å¯ä»¥å°†æ³¨æ„åŠ›é›†ä¸­åœ¨çªå‡ºæ˜¾ç¤ºçš„è¡Œä¸Šï¼š</p>
<ul>
<li>
<p>ç¬¬ 22 è¡Œå®šä¹‰äº†æ‚¨çš„æ–°æœåŠ¡å°†å±äºçš„é…ç½®æ–‡ä»¶åˆ—è¡¨ã€‚åªæœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œç§°ä¸º <code>testing</code> ï¼Œæ‚¨å°†å¯ç”¨å®ƒæ¥è¿è¡Œæµ‹è¯•ã€‚</p>
</li>
<li>
<p>ç¬¬ 24 åˆ° 26 è¡ŒæŒ‡å®šåŒ…å«è¦æ„å»ºçš„ Dockerfile çš„ç›®å½•çš„è·¯å¾„ã€‚ç”±äºè¯¥æ–‡ä»¶æœ‰ä¸€ä¸ªéæ ‡å‡†åç§°ï¼Œæ‚¨éœ€è¦æ˜ç¡®æä¾›å®ƒã€‚</p>
</li>
<li>
<p>ç¬¬ 27 åˆ° 29 è¡Œå®šä¹‰äº†ä¸¤ä¸ªç¯å¢ƒå˜é‡ï¼Œæ‚¨çš„æµ‹è¯•å°†ä½¿ç”¨å®ƒä»¬è¿æ¥åˆ°åœ¨ Gunicorn æœåŠ¡å™¨åé¢è¿è¡Œçš„ Redis å’Œ Flaskã€‚è¯·æ³¨æ„ï¼Œæ‚¨ä½¿ç”¨ Docker Compose æœåŠ¡åç§°ä½œä¸ºä¸»æœºåã€‚</p>
</li>
<li>
<p>ç¬¬ 30 å’Œ 31 è¡Œå°†æœåŠ¡è¿æ¥åˆ°ä¸å…¶ä»–ä¸¤ä¸ªæœåŠ¡ç›¸åŒçš„ç½‘ç»œã€‚</p>
</li>
<li>
<p>ç¬¬ 32 åˆ° 34 è¡Œç¡®ä¿ Redis å’Œ Flask åœ¨ç«¯åˆ°ç«¯æµ‹è¯•ä¹‹å‰å¯åŠ¨ã€‚</p>
</li>
<li>
<p>ç¬¬ 35 åˆ° 38 è¡Œå®šä¹‰äº†åœ¨æœåŠ¡å¯åŠ¨æ—¶è¿è¡Œçš„å‘½ä»¤ã€‚è¯·æ³¨æ„ï¼Œæ‚¨ä½¿ç”¨ YAML çš„å¤šè¡Œæ–‡å­—æŠ˜å  ( <code>&gt;</code> ) ä»¥æ›´å…·å¯è¯»æ€§çš„æ–¹å¼æ ¼å¼åŒ–é•¿ shell å‘½ä»¤ã€‚</p>
</li>
</ul>
<p>å› ä¸º Docker Compose å¯ä»¥è®¿é—®æ‚¨ä¸»æœºçš„ shellï¼Œæ‰€ä»¥å®ƒä¼šå°è¯•æ’å…¥å¯¹ç¯å¢ƒå˜é‡çš„ä»»ä½•å¼•ç”¨ï¼Œä¾‹å¦‚ <code>$REDIS_URL</code> æˆ– <code>$FLASK_URL</code> ï¼Œä¸€æ—¦æ–‡ä»¶è¢«è§£æï¼Œå°±ä¼šå‡ºç°åœ¨æ‚¨çš„ <code>docker-compose.yml</code> ä¸­ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™äº›å˜é‡å¾ˆå¯èƒ½å°šæœªå®šä¹‰ã€‚æ‚¨é€šè¿‡æœåŠ¡çš„ <code>environment</code> éƒ¨åˆ†æŒ‡å®šå®ƒä»¬ï¼Œè¿™æ„å‘³ç€æ‚¨çš„å®¹å™¨ç¨åå°†è·å–è¿™äº›å˜é‡ã€‚</p>
<p>è¦ç¦ç”¨ Docker Compose è¿‡æ—©æ›¿æ¢ç¯å¢ƒå˜é‡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªç¾å…ƒç¬¦å· ( <code>$$</code> ) è½¬ä¹‰ç¾å…ƒç¬¦å·ã€‚è¿™åè¿‡æ¥ä¼šåœ¨å°†åœ¨ç”Ÿæˆçš„å®¹å™¨ä¸­æ‰§è¡Œçš„å‘½ä»¤ä¸­ç”Ÿæˆæ–‡å­—å­—ç¬¦ä¸² <code>$REDIS_URL</code> å’Œ <code>$FLASK_URL</code> ã€‚è¦åœ¨å®¹å™¨å¯åŠ¨æ—¶æ’å…¥è¿™äº›å˜é‡ï¼Œæ‚¨å¿…é¡»å°†æ•´ä¸ªå‘½ä»¤ç”¨å•å¼•å· ( <code>'</code> ) æ‹¬èµ·æ¥ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™ shell ( <code>sh</code> )ã€‚</p>
<p>å½“æ‚¨ä½¿ç”¨ Docker Compose å¯åŠ¨å¤šå®¹å™¨åº”ç”¨ç¨‹åºæ—¶ï¼Œåªæœ‰ä¸å±äºä»»ä½•é…ç½®æ–‡ä»¶çš„æ ¸å¿ƒæœåŠ¡ä¼šå¯åŠ¨ã€‚å¦‚æœæ‚¨è¿˜å¸Œæœ›å¯åŠ¨åˆ†é…ç»™ä¸€ä¸ªæˆ–å¤šä¸ªé…ç½®æ–‡ä»¶çš„æœåŠ¡ï¼Œåˆ™å¿…é¡»ä½¿ç”¨ <code>--profile</code> é€‰é¡¹åˆ—å‡ºè¿™äº›é…ç½®æ–‡ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker compose --profile testing up -d
</span></span><span class="line"><span class="cl"><span class="o">[</span>+<span class="o">]</span> Running 3/3
</span></span><span class="line"><span class="cl"> â ¿ Container page-tracker-redis-service-1  Running                      0.0s
</span></span><span class="line"><span class="cl"> â ¿ Container page-tracker-web-service-1    Running                      0.0s
</span></span><span class="line"><span class="cl"> â ¿ Container page-tracker-test-service-1   Started                      0.6s
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ docker compose ps -a
</span></span><span class="line"><span class="cl">NAME                           ...   SERVICE             STATUS       ...
</span></span><span class="line"><span class="cl">page-tracker-redis-service-1   ...   redis-service       running      ...
</span></span><span class="line"><span class="cl">page-tracker-test-service-1    ...   test-service        exited <span class="o">(</span>0<span class="o">)</span>   ...
</span></span><span class="line"><span class="cl">page-tracker-web-service-1     ...   web-service         running      ...
</span></span></code></pre></div><p>è¯·æ³¨æ„ï¼Œè¿™æ˜¯ <code>docker compose</code> å‘½ä»¤çš„ä¸€ä¸ªé€‰é¡¹ï¼Œè€Œä¸æ˜¯å®ƒçš„ <code>up</code> å­å‘½ä»¤ï¼Œå› æ­¤è¯·æ³¨æ„å‚æ•°é¡ºåºã€‚è¾“å‡ºæ˜¾ç¤ºå¯åŠ¨äº†ä¸€ä¸ªé¢å¤–çš„æœåŠ¡ï¼Œä½†æ˜¯å½“æ‚¨è°ƒæŸ¥å®ƒæ—¶ï¼Œæ‚¨ä¼šæ³¨æ„åˆ° <code>test-service</code> ä»¥æˆåŠŸçŠ¶æ€é›¶å¿«é€Ÿé€€å‡ºã€‚</p>
<p>è¦æ˜¾ç¤ºæœ‰å…³æ­¤æœåŠ¡çš„æ›´å¤šä¿¡æ¯ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹å…¶æ—¥å¿—ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ docker compose logs test-service
</span></span><span class="line"><span class="cl"><span class="o">=============================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">==========================</span>
</span></span><span class="line"><span class="cl">platform linux -- Python 3.11.2, pytest-7.2.2, pluggy-1.0.0 -- /home/realp..
</span></span><span class="line"><span class="cl">cachedir: .pytest_cache
</span></span><span class="line"><span class="cl">rootdir: /home/realpython
</span></span><span class="line"><span class="cl">plugins: timeout-2.1.0
</span></span><span class="line"><span class="cl">collecting ... collected <span class="m">1</span> item
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">test/e2e/test_app_redis_http.py::test_should_update_redis ... PASSED <span class="o">[</span>100%<span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">==============================</span> <span class="m">1</span> passed in 0.10s <span class="o">===========================</span>
</span></span></code></pre></div><p>è¿™å°†å‘æ‚¨æ˜¾ç¤ºæœ‰å…³è¯¥æœåŠ¡çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ <code>pytest</code> æŠ¥å‘Šå½¢å¼çš„æµ‹è¯•ç»“æœï¼Œä»¥åŠå¯èƒ½å‘ç”Ÿçš„ä»»ä½•é”™è¯¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæµ‹è¯•æˆåŠŸé€šè¿‡ã€‚è¯·æ³¨æ„ï¼Œä¸ºç®€æ´èµ·è§ï¼Œå¯¹ä¸Šé¢çš„è¾“å‡ºè¿›è¡Œäº†ç¼–è¾‘ã€‚</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ‚¨å·²ç»ä½¿ç”¨ Git å¯¹æºä»£ç è¿›è¡Œäº†ç‰ˆæœ¬æ§åˆ¶ã€‚æ‚¨è‡ªåŠ¨åŒ–äº†å„ç§çº§åˆ«çš„æµ‹è¯•å¹¶ä½¿ç”¨ Docker æ„å»ºäº†æ‚¨çš„åº”ç”¨ç¨‹åºã€‚æœ€åï¼Œæ‚¨ä½¿ç”¨ Docker Compose ç¼–æ’äº†å¤šä¸ªå®¹å™¨ã€‚</p>
<p>æ­¤æ—¶ï¼Œæ‚¨å·²å‡†å¤‡å¥½ç»§ç»­ä¸‹ä¸€æ­¥ï¼Œå³ä½¿ç”¨ Docker æ„å»ºæŒç»­é›†æˆç®¡é“ã€‚</p>
<h2 id="å®šä¹‰ä¸€ä¸ªåŸºäº-docker-çš„æŒç»­é›†æˆç®¡é“">å®šä¹‰ä¸€ä¸ªåŸºäº Docker çš„æŒç»­é›†æˆç®¡é“</h2>
<p>æŒç»­é›†æˆ (CI) çš„ç›®æ ‡æ˜¯é€šè¿‡å°½å¯èƒ½é¢‘ç¹åœ°é›†æˆå›¢é˜Ÿä¸­å¤šä¸ªå¼€å‘äººå‘˜çš„ä»£ç æ›´æ”¹æ¥å®ç°æ›´å¿«ã€æ›´å¯é¢„æµ‹çš„è½¯ä»¶å‘å¸ƒã€‚</p>
<p>åœ¨è¿‡å»ï¼Œé›†æˆæ˜¯ä¸€é¡¹é‡å¤§ä»»åŠ¡ï¼Œé€šå¸¸éœ€è¦æ•°å‘¨ç”šè‡³æ•°æœˆæ‰èƒ½å®Œæˆï¼Œæœ‰æ—¶è¿˜éœ€è¦ä¸“é—¨çš„é›†æˆå·¥ç¨‹å¸ˆå›¢é˜Ÿã€‚</p>
<p>è¿™ç§æ–¹æ³•çš„é—®é¢˜æ˜¯å›¢é˜Ÿä¸­çš„æ¯ä¸ªäººéƒ½åœ¨è‡ªå·±çš„é¡¹ç›®å‰¯æœ¬ä¸Šå·¥ä½œã€‚é›†æˆé˜¶æ®µå»¶è¿Ÿçš„æ—¶é—´è¶Šé•¿ï¼Œé¡¹ç›®çš„ä¸åŒç‰ˆæœ¬å°±è¶Šæœ‰å¯èƒ½å‡ºç°åˆ†æ­§ï¼Œä»è€Œéš¾ä»¥å°†å®ƒä»¬ç»“åˆèµ·æ¥ã€‚</p>
<p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œé›†æˆå¯èƒ½æ¯”é¡¹ç›®çš„å®é™…å¼€å‘èŠ±è´¹æ›´å¤šçš„æ—¶é—´ï¼</p>
<p>è¿ç»­è¿™ä¸ªè¯æ„å‘³ç€é›†æˆåº”è¯¥ç»å¸¸è¿›è¡Œï¼Œä»¥æœ€å°åŒ–æ›´æ”¹çš„èŒƒå›´å¹¶é™ä½å°†ç¼ºé™·å¼•å…¥ä»£ç åº“çš„é£é™©ã€‚å›¢é˜Ÿæ¯å¤©è‡³å°‘æ•´åˆä¸€æ¬¡å¼€å‘äººå‘˜çš„å·¥ä½œï¼Œæœ€å¥½æ˜¯ä¸€å¤©å¤šæ¬¡ï¼Œè¿™å·²æˆä¸ºæ ‡å‡†åšæ³•ã€‚</p>
<p>ä¸ºäº†ä½¿è¿™æˆä¸ºå¯èƒ½ï¼ŒæŒç»­é›†æˆéœ€è¦æ„å»ºå’Œæµ‹è¯•è‡ªåŠ¨åŒ–ä»¥åŠå…·æœ‰ç›¸å¯¹è¾ƒå°åŠŸèƒ½çš„çŸ­æœŸä»£ç åˆ†æ”¯æ¥å®ç°ã€‚åŠŸèƒ½åˆ‡æ¢å¯ä»¥å¸®åŠ©å®ç°éœ€è¦æ›´é•¿æ—¶é—´å¼€å‘çš„æ›´å¤§åŠŸèƒ½ã€‚æ­¤å¤–ï¼Œåœ¨å°è¯•é›†æˆæ›´æ”¹å¤±è´¥åä¿®å¤å¤±è´¥çš„æ„å»ºåº”è¯¥æ˜¯å›¢é˜Ÿçš„ä¼˜å…ˆäº‹é¡¹ï¼Œä»¥ä¿æŒæµç¨‹çœŸæ­£è¿ç»­ã€‚</p>
<p>è¦åœ¨æ‚¨çš„é¡¹ç›®ä¸­å¼•å…¥æŒç»­é›†æˆï¼Œæ‚¨éœ€è¦ä»¥ä¸‹å…ƒç´ ï¼š</p>
<ul>
<li>ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ</li>
<li>åˆ†æ”¯ç­–ç•¥</li>
<li>è‡ªåŠ¨æ„å»º</li>
<li>è‡ªåŠ¨åŒ–æµ‹è¯•</li>
<li>æŒç»­é›†æˆæœåŠ¡å™¨</li>
<li>é¢‘ç¹é›†æˆ</li>
</ul>
<p>åƒ Git è¿™æ ·çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿå…è®¸å¤šäººåŒæ—¶å¤„ç†åŒä¸€æ®µä»£ç ã€‚æ ¹æ®æ‚¨çš„å›¢é˜Ÿç»“æ„ã€ç»éªŒå’Œå…¶ä»–å› ç´ ï¼Œæ‚¨å¯ä»¥é€‰æ‹©ä¸åŒçš„æºä»£ç æ§åˆ¶åˆ†æ”¯æ¨¡å‹ï¼Œä¹Ÿç§°ä¸ºå·¥ä½œæµã€‚ä¸€äº›æœ€å—æ¬¢è¿çš„åŒ…æ‹¬ï¼š</p>
<ul>
<li><a href="https://trunkbaseddevelopment.com/">Trunk-Based Development</a></li>
<li><a href="https://docs.github.com/en/get-started/quickstart/github-flow">GitHub Flow</a></li>
<li><a href="https://www.atlassian.com/git/tutorials/comparing-workflows/forking-workflow">Forking Workflow</a></li>
<li><a href="https://martinfowler.com/articles/branching-patterns.html#release-branch">Release Branching</a></li>
<li><a href="https://nvie.com/posts/a-successful-git-branching-model/">Git Flow</a></li>
</ul>
<p>å„æœ‰åˆ©å¼Šï¼Œé€‚ç”¨äºä¸åŒçš„åœºæ™¯ã€‚ä¾‹å¦‚ï¼Œåˆ†å‰ç­–ç•¥åœ¨å¼€æºé¡¹ç›®ä¸­è¿ä½œè‰¯å¥½ï¼Œå› ä¸ºå®ƒå…è®¸ä»»ä½•äººåœ¨æ²¡æœ‰ç‰¹åˆ«è®¸å¯çš„æƒ…å†µä¸‹åšå‡ºè´¡çŒ®ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†ä½¿ç”¨ç§°ä¸º GitHub Flow çš„æµè¡ŒåŠŸèƒ½åˆ†æ”¯å·¥ä½œæµç¨‹ã€‚å®ƒåªæœ‰ä¸€ä¸ªé•¿æœŸå­˜åœ¨çš„ä¸»çº¿æˆ–ä¸»å¹²ï¼Œä¼ ç»Ÿä¸Šç§°ä¸º master åˆ†æ”¯ï¼Œæ‚¨å¯ä»¥ä»ä¸­åˆ†æ”¯å‡ºå‡ ä¸ªçŸ­æœŸå­˜åœ¨çš„åŠŸèƒ½åˆ†æ”¯ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå°½ç®¡ä½¿ç”¨æœ¯è¯­ <code>master</code> æ¥æŒ‡ä»£ä¸»åˆ†æ”¯çš„ä¼ ç»Ÿç”±æ¥å·²ä¹…ï¼Œä½† GitHub æœ€è¿‘å®£å¸ƒå°†å…¶é»˜è®¤åˆ†æ”¯åç§°æ›´æ”¹ä¸º <code>main</code> ä»¥æ›´å¥½åœ°åæ˜ å…¶ç›®çš„å¹¶é¿å…å†’çŠ¯æ€§è¯­è¨€ã€‚</p>
<p>åŒæ—¶ï¼Œå½“æ‚¨åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„å­˜å‚¨åº“æ—¶ï¼ŒGit ä¼šç»§ç»­ä½¿ç”¨ <code>master</code> ï¼Œè¿™åœ¨æ‚¨å°è¯•åŒæ­¥æœ¬åœ°å’Œè¿œç¨‹å­˜å‚¨åº“æ—¶å¶å°”ä¼šå‡ºç°é—®é¢˜ã€‚å› æ­¤ï¼Œæ‚¨å°†åšæŒåœ¨æœ¬æ•™ç¨‹ä¸­ä½¿ç”¨ <code>master</code> æ¥ä¿æŒç®€å•ï¼Œä½†å¦‚æœæ‚¨æƒ³æ›´æ”¹é»˜è®¤åˆ†æ”¯åç§°ï¼Œè¯·éšæ—¶é‡‡å–é¢å¤–çš„æ­¥éª¤ã€‚æ‚¨å¯ä»¥åœ¨ GitHub å­˜å‚¨åº“è®¾ç½®ä¸­è°ƒæ•´é»˜è®¤åˆ†æ”¯åç§°ã€‚</p>
</blockquote>
<p>è™½ç„¶æ‚¨ä¼šå‘ç°å‡ ç§ä¸åŒçš„æ–¹æ³•æ¥å®ç°ä¸ GitHub Flow çš„æŒç»­é›†æˆï¼Œä½†è¿™äº›æ˜¯æ‚¨å°†é’ˆå¯¹ Docker åº”ç”¨ç¨‹åºéµå¾ªçš„æ­¥éª¤ï¼š</p>
<ul>
<li>å°†æœ€æ–°ç‰ˆæœ¬çš„ä¸»çº¿è·å–åˆ°æ‚¨çš„è®¡ç®—æœºã€‚</li>
<li>ä»ä¸»çº¿åˆ›å»ºä¸€ä¸ªåŠŸèƒ½åˆ†æ”¯ã€‚</li>
<li>æ‰“å¼€æ‹‰å–è¯·æ±‚ä»¥ä»å…¶ä»–äººé‚£é‡Œè·å¾—æ—©æœŸåé¦ˆã€‚</li>
<li>ç»§ç»­åœ¨ä½ çš„åŠŸèƒ½åˆ†æ”¯ä¸Šå·¥ä½œã€‚</li>
<li>ç»å¸¸è·å–ä¸»çº¿ï¼Œå°†å…¶åˆå¹¶åˆ°æ‚¨çš„åŠŸèƒ½åˆ†æ”¯å¹¶åœ¨æœ¬åœ°è§£å†³ä»»ä½•æ½œåœ¨çš„å†²çªã€‚</li>
<li>åœ¨æœ¬åœ°åˆ†æ”¯ä¸Šæ„å»ºã€lint å’Œæµ‹è¯•ä»£ç ã€‚</li>
<li>åªè¦æœ¬åœ°æ„å»ºå’Œæµ‹è¯•æˆåŠŸï¼Œå°±æ¨é€æ‚¨çš„æ›´æ”¹ã€‚</li>
<li>æ¯æ¬¡æ¨é€æ—¶ï¼Œæ£€æŸ¥é’ˆå¯¹æ‚¨çš„åŠŸèƒ½åˆ†æ”¯åœ¨ CI æœåŠ¡å™¨ä¸Šè¿è¡Œçš„è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚</li>
<li>åœ¨å†æ¬¡æ¨é€ä»£ç ä¹‹å‰ï¼Œåœ¨æœ¬åœ°é‡ç°å¹¶ä¿®å¤ä»»ä½•å·²è¯†åˆ«çš„é—®é¢˜ã€‚</li>
<li>å®Œæˆå¹¶é€šè¿‡æ‰€æœ‰æµ‹è¯•åï¼Œè¯·æ±‚ä¸€åæˆ–å¤šååŒäº‹å®¡æŸ¥æ‚¨çš„æ›´æ”¹ã€‚</li>
<li>åº”ç”¨ä»–ä»¬çš„åé¦ˆï¼Œç›´åˆ°å®¡é˜…è€…æ‰¹å‡†æ‚¨çš„æ›´æ–°å¹¶ä¸”æ‰€æœ‰æµ‹è¯•åœ¨æ¨é€æ‚¨çš„æœ€æ–°æ›´æ”¹åé€šè¿‡ CI æœåŠ¡å™¨ã€‚</li>
<li>é€šè¿‡å°†åŠŸèƒ½åˆ†æ”¯åˆå¹¶åˆ°ä¸»çº¿æ¥å…³é—­æ‹‰å–è¯·æ±‚ã€‚</li>
<li>å¯¹ç…§ä¸»çº¿æ£€æŸ¥ CI æœåŠ¡å™¨ä¸Šè¿è¡Œçš„è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå¹¶é›†æˆåŠŸèƒ½åˆ†æ”¯çš„æ›´æ”¹ã€‚</li>
<li>è°ƒæŸ¥å¹¶ä¿®å¤å¯èƒ½å‘ç°çš„ä»»ä½•é—®é¢˜ï¼Œä¾‹å¦‚ï¼Œç”±äºåœ¨æ‚¨ä¸Šæ¬¡æ¨é€å’Œåˆå¹¶ä¹‹é—´å…¶ä»–äººå‘ä¸»çº¿å¼•å…¥äº†æ–°æ›´æ–°ã€‚</li>
</ul>
<p>æ­¤åˆ—è¡¨éå¸¸å…¨é¢ï¼Œä½†æ²¡æœ‰é€‚åˆæ‰€æœ‰äººçš„å•ä¸€æŒç»­é›†æˆæµç¨‹ã€‚æ‚¨ç”šè‡³å¯ä»¥æ¯”è¿™æ›´å½»åº•ï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨ Terraform æˆ– GitHub Codespaces æä¾›ä¸“ç”¨çš„æš‚å­˜ç¯å¢ƒï¼Œå¹¶å°†æ‚¨çš„åŠŸèƒ½åˆ†æ”¯éƒ¨ç½²åˆ°äº‘ä¸­ï¼Œä»¥ä¾¿åœ¨å…³é—­æ‹‰å–è¯·æ±‚ä¹‹å‰è¿›è¡Œé¢å¤–çš„æ‰‹åŠ¨æµ‹è¯•ã€‚ä½†æ˜¯ï¼Œä¸ºæ¯ä¸ªæ‹‰å–è¯·æ±‚å¯åŠ¨ä¸€ä¸ªæ–°ç¯å¢ƒå¯èƒ½ä¸ç¬¦åˆæˆæœ¬æ•ˆç›Šã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šè½¯ä»¶å·¥ç¨‹å›¢é˜Ÿé€šå¸¸å°†æŒç»­é›†æˆä¸æŒç»­äº¤ä»˜ç»“åˆèµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªç§°ä¸º CI/CD çš„æµç¨‹ã€‚æŒç»­äº¤ä»˜æ˜¯æŒç»­é›†æˆçš„æ‰©å±•ï¼Œå®ƒå¢åŠ äº†é¢å¤–çš„æ­¥éª¤æ¥å°†ç»è¿‡éªŒè¯å’Œé›†æˆçš„æ„å»ºéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚</p>
<p>è™½ç„¶æŒç»­äº¤ä»˜æä¾›äº†å°†æ„å»ºè‡ªåŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒçš„æŠ€æœ¯æ‰‹æ®µï¼Œä½†å®ƒä»ç„¶éœ€è¦ä¸šåŠ¡å†³ç­–å’Œæ‰‹åŠ¨è§¦å‘ã€‚</p>
<p>ä¸è¦æ··æ·†æŒç»­äº¤ä»˜å’ŒæŒç»­éƒ¨ç½²ï¼Œåè€…æ˜¯ä¸€ä¸ªå®Œå…¨è‡ªåŠ¨åŒ–çš„è¿‡ç¨‹ï¼Œæ— éœ€äººå·¥å¹²é¢„å³å¯å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚åœ¨æŒç»­éƒ¨ç½²ä¸­ï¼Œä¸€æ—¦ä½ æ¨é€ä»£ç ï¼Œå®ƒå°±ä¼šè¢«æµ‹è¯•å¹¶é›†æˆåˆ°ä¸»çº¿ä¸­ï¼Œç„¶åæœ€ç»ˆè¿›å…¥ç”Ÿäº§ç¯å¢ƒã€‚</p>
<p>ä½†æ˜¯ï¼Œè¦æˆåŠŸåšåˆ°è¿™ä¸€ç‚¹ï¼Œæ‚¨éœ€è¦å¹¿æ³›çš„æµ‹è¯•èŒƒå›´å’Œå¯¹è‡ªåŠ¨åŒ–è¿‡ç¨‹çš„ä¿¡ä»»ã€‚</p>
</blockquote>
<p>å€¼å¾—å¼ºè°ƒçš„é‡è¦ä¸€ç‚¹æ˜¯æ¶‰åŠçš„æµ‹è¯•é‡ã€‚æ‚¨åº”è¯¥åœ¨æœ¬åœ°å’ŒæŒç»­é›†æˆæœåŠ¡å™¨ä¸Šæµ‹è¯•æ‚¨çš„åŠŸèƒ½åˆ†æ”¯ï¼Œç„¶åé’ˆå¯¹é›†æˆä¸»çº¿å†æ¬¡è¿è¡Œæµ‹è¯•ã€‚</p>
<p>è¿™æ˜¯ä¸ºäº†ç¡®ä¿æ‚¨çš„åŠŸèƒ½æ­£å¸¸å·¥ä½œå¹¶ä¸”ä¸ä¼šç ´åä¸»çº¿ã€‚</p>
<p>æ‚¨æœ‰è®¸å¤šé€‰é¡¹å¯ä»¥ä¸ºæ‚¨çš„ Docker åº”ç”¨ç¨‹åºè®¾ç½®æŒç»­é›†æˆæœåŠ¡å™¨ï¼ŒåŒ…æ‹¬åœ¨çº¿å’Œè‡ªæ‰˜ç®¡ã€‚æµè¡Œçš„é€‰æ‹©åŒ…æ‹¬ CircleCIã€Jenkins å’Œ Travisã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†ä½¿ç”¨ GitHub Actionsï¼Œè¿™æ˜¯ GitHub æä¾›çš„å…è´¹ CI è§£å†³æ–¹æ¡ˆã€‚</p>
<h3 id="å°†ä»£ç æ¨é€åˆ°-github-å­˜å‚¨åº“">å°†ä»£ç æ¨é€åˆ° GitHub å­˜å‚¨åº“</h3>
<p>è¦åˆ©ç”¨ GitHub Actionsï¼Œæ‚¨å¿…é¡»é¦–å…ˆåœ¨ GitHub ä¸Šåˆ›å»ºä¸€ä¸ªå­˜å‚¨åº“ã€‚å¦‚æœæ‚¨è¿˜æ²¡æœ‰å¸æˆ·ï¼Œè¯·æ³¨å†Œï¼Œç„¶åç™»å½•å¹¶åˆ›å»ºä¸€ä¸ªåä¸º <code>page-tracker</code> çš„æ–°å­˜å‚¨åº“ã€‚</p>
<p>å…¬å…±å­˜å‚¨åº“å¯ä»¥æ— é™åˆ¶åœ°ä½¿ç”¨ GitHub Actionsï¼Œè€Œç§æœ‰å­˜å‚¨åº“æ¯æœˆå¯åœ¨å…è´¹å±‚è·å¾— 2000 åˆ†é’Ÿå’Œ 500 å…†å­—èŠ‚çš„å­˜å‚¨ç©ºé—´ã€‚</p>
<p>ä½†æ˜¯ï¼Œåœ¨ Windows ä¸Šè¿è¡Œçš„ä½œä¸šå°†æ¶ˆè€—æ¯”åœ¨ Linux ä¸Šå¤šä¸€å€çš„åˆ†é’Ÿæ•°ï¼Œè€Œåœ¨ macOS ä¸Šè¿è¡Œçš„ä½œä¸šå°†æ¶ˆè€—åå€çš„åˆ†é’Ÿæ•°ï¼æ‚¨å¯ä»¥åœ¨å®˜æ–¹æ–‡æ¡£ä¸­æ‰¾åˆ°æœ‰å…³ GitHub Actions è®¡è´¹çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚</p>
<p>ç¨åï¼Œæ‚¨å°†å¯ç”¨åˆ†æ”¯ä¿æŠ¤è§„åˆ™ï¼Œè¯¥è§„åˆ™ç›®å‰ä»…é€‚ç”¨äºå…è´¹å±‚çš„å…¬å…±å­˜å‚¨åº“ï¼Œå› æ­¤æœ€å¥½ç°åœ¨å°±åˆ›å»ºä¸€ä¸ªå…¬å…±å­˜å‚¨åº“ã€‚</p>
<p>ä¿ç•™å»ºè®®çš„é»˜è®¤å€¼è€Œä¸ä½¿ç”¨ GitHub çš„å ä½ç¬¦æ–‡ä»¶åˆå§‹åŒ–æ–°å­˜å‚¨åº“ï¼Œå› ä¸ºæ‚¨å°†æ¨é€ç°æœ‰é¡¹ç›®ã€‚æ¥ä¸‹æ¥ï¼Œè½¬åˆ°ç»ˆç«¯å¹¶å°†å·¥ä½œç›®å½•æ›´æ”¹ä¸ºæ‚¨çš„ <code>page-tracker</code> é¡¹ç›®æ‰€åœ¨çš„ä½ç½®ã€‚å®ƒåº”è¯¥å·²ç»åˆå§‹åŒ–äº†ä¸€ä¸ªæœ¬åœ° Git å­˜å‚¨åº“ï¼Œç¨åæ‚¨å°†è¿æ¥åˆ° GitHubã€‚ä½†é¦–å…ˆï¼Œå°†æ‰€æœ‰æœªå†³æ›´æ”¹æäº¤åˆ°æœ¬åœ°å­˜å‚¨åº“ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ git status
</span></span><span class="line"><span class="cl">On branch master
</span></span><span class="line"><span class="cl">Changes not staged <span class="k">for</span> commit:
</span></span><span class="line"><span class="cl">  <span class="o">(</span>use <span class="s2">&#34;git add &lt;file&gt;...&#34;</span> to update what will be committed<span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">(</span>use <span class="s2">&#34;git restore &lt;file&gt;...&#34;</span> to discard changes in working directory<span class="o">)</span>
</span></span><span class="line"><span class="cl">        modified:   docker-compose.yml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">no changes added to commit <span class="o">(</span>use <span class="s2">&#34;git add&#34;</span> and/or <span class="s2">&#34;git commit -a&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ git commit -am <span class="s2">&#34;Add a test-service to Docker Compose&#34;</span>
</span></span></code></pre></div><p>åœ¨æäº¤ä»»ä½•æ›´æ”¹ä¹‹å‰æ£€æŸ¥å­˜å‚¨åº“çš„çŠ¶æ€å§‹ç»ˆæ˜¯ä¸ªå¥½ä¸»æ„ã€‚æ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ä¸ªå‘½ä»¤å°†æœ¬åœ°å­˜å‚¨åº“è¿æ¥åˆ° GitHubï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ git remote add origin git@github.com:realpython/page-tracker.git
</span></span><span class="line"><span class="cl">$ git push -u origin master
</span></span></code></pre></div><p>ç¡®ä¿å°† <code>realpython</code> æ›¿æ¢ä¸ºæ‚¨çš„ GitHub ç”¨æˆ·åã€‚ç¬¬ä¸€ä¸ªå‘½ä»¤ä¼šå°†æ‚¨åˆšåˆšåˆ›å»ºçš„ GitHub ä¸Šçš„è¿œç¨‹å­˜å‚¨åº“æ·»åŠ åˆ°æ‚¨åœ¨ <code>origin</code> åˆ«åä¸‹çš„æœ¬åœ°å‰¯æœ¬ã€‚ç¬¬äºŒä¸ªå‘½ä»¤ä¼šå°†æœ¬åœ°å­˜å‚¨åº“çš„å†…å®¹æ¨é€åˆ° GitHubã€‚</p>
<p>ä¹‹åæ‚¨å¯ä»¥ä½¿ç”¨æ‚¨çš„ GitHub å­˜å‚¨åº“åˆ·æ–°ç½‘é¡µä»¥ç¡®è®¤æ‚¨çš„æ–‡ä»¶å·²æˆåŠŸå‘é€ã€‚å½“æ‚¨è¿™æ ·åšæ—¶ï¼Œæ‚¨å°†å‡†å¤‡å¥½ä½¿ç”¨ GitHub Actions ä¸ºæ‚¨çš„ Docker åº”ç”¨ç¨‹åºæ„å»ºæŒç»­é›†æˆå·¥ä½œæµç¨‹ï¼</p>
<h3 id="å­¦ä¹ -github-actions">å­¦ä¹  GitHub Actions</h3>
<p>é¦–å…ˆï¼Œç†Ÿæ‚‰ä¸€äº›æ–°æœ¯è¯­ä¼šæœ‰æ‰€å¸®åŠ©ã€‚ GitHub Actions å…è®¸æ‚¨æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªç”±ç‰¹å®šäº‹ä»¶è§¦å‘çš„å·¥ä½œæµç¨‹ï¼Œä¾‹å¦‚å°†ä»£ç æ¨é€åˆ°åˆ†æ”¯æˆ–æ‰“å¼€æ–°çš„æ‹‰å–è¯·æ±‚ã€‚æ¯ä¸ªå·¥ä½œæµéƒ½å¯ä»¥å®šä¹‰è®¸å¤šç”±æ­¥éª¤ç»„æˆçš„ä½œä¸šï¼Œè¿™äº›ä½œä¸šå°†åœ¨è¿è¡Œå™¨ä¸Šæ‰§è¡Œã€‚æœ‰ä¸¤ç§ç±»å‹çš„è·‘æ­¥è€…ï¼š</p>
<ul>
<li>GitHub æ‰˜ç®¡çš„è¿è¡Œå™¨ï¼šUbuntu Linuxã€Windowsã€macOS</li>
<li>è‡ªæ‰˜ç®¡è¿è¡Œå™¨ï¼šæ‚¨æ‹¥æœ‰å’Œç»´æŠ¤çš„æœ¬åœ°æœåŠ¡å™¨</li>
</ul>
<p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†åªä½¿ç”¨ GitHub æä¾›çš„æœ€æ–° Ubuntu Linux è¿è¡Œå™¨ã€‚è¯·æ³¨æ„ï¼Œå¯ä»¥åœ¨å¤šä¸ªè¿è¡Œå™¨ä¸Šæ‰§è¡Œç›¸åŒçš„ä½œä¸šï¼Œä¾‹å¦‚æ£€æŸ¥è·¨å¹³å°å…¼å®¹æ€§ã€‚</p>
<p>é™¤éæ‚¨å¦æœ‰è¯´æ˜ï¼Œå¦åˆ™ä¸€ä¸ªå·¥ä½œæµç¨‹ä¸­çš„ä½œä¸šå°†åœ¨ä¸åŒçš„è¿è¡Œå™¨ä¸Šå¹¶è¡Œè¿è¡Œï¼Œè¿™å¯¹äºåŠ å¿«æ„å»ºé€Ÿåº¦å¾ˆæœ‰ç”¨ã€‚åŒæ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ä¸€é¡¹å·¥ä½œä¾èµ–äºå…¶ä»–å·¥ä½œã€‚</p>
<p>ä½¿ç”¨ GitHub Actions å‡å°‘æ„å»ºæ—¶é—´çš„å¦ä¸€ç§æ–¹æ³•æ˜¯å¯ç”¨å·¥ä½œæµä¾èµ–ç¼“å­˜ã€‚</p>
<p>ä½œä¸šçš„æ¯ä¸ªæ­¥éª¤éƒ½ç”±ä¸€ä¸ªåŠ¨ä½œå®ç°ï¼Œè¯¥åŠ¨ä½œå¯ä»¥æ˜¯ï¼š</p>
<ul>
<li>è‡ªå®šä¹‰ shell å‘½ä»¤æˆ–è„šæœ¬</li>
<li>åœ¨å¦ä¸€ä¸ª GitHub å­˜å‚¨åº“ä¸­å®šä¹‰çš„ GitHub æ“ä½œ</li>
</ul>
<p>æœ‰è®¸å¤šé¢„å®šä¹‰çš„ GitHub æ“ä½œï¼Œæ‚¨å¯ä»¥åœ¨ GitHub Marketplace ä¸Šæµè§ˆå’ŒæŸ¥æ‰¾ã€‚ç¤¾åŒºæä¾›å¹¶ç»´æŠ¤å®ƒä»¬ã€‚ä¾‹å¦‚ï¼Œæœ‰ä¸€ä¸ªç”¨äºåœ¨ GitHub ä¸Šæ„å»ºå’Œæ¨é€ Docker ç»„ç»‡æ‹¥æœ‰çš„ Docker é•œåƒã€‚ç”±äºæœ‰è®¸å¤šç›¸äº’ç«äº‰çš„æ’ä»¶ï¼Œæœ‰æ—¶æœ‰ä¸æ­¢ä¸€ç§æ–¹æ³•å¯ä»¥ä½¿ç”¨ GitHub Actions è¾¾åˆ°é¢„æœŸçš„ç»“æœã€‚</p>
<p>ä¸å¦‚ä»Šä¸ DevOps ç›¸å…³çš„è®¸å¤šå·¥å…·ä¸€æ ·ï¼ŒGitHub ä½¿ç”¨ YAML æ ¼å¼æ¥é…ç½®å·¥ä½œæµã€‚å®ƒä¼šåœ¨æ‚¨çš„å­˜å‚¨åº“çš„æ ¹æ–‡ä»¶å¤¹ä¸­å¯»æ‰¾ä¸€ä¸ªç‰¹æ®Šçš„ <code>.github/workflows/</code> æ–‡ä»¶å¤¹ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æ”¾ç½®å¤šä¸ª YAML æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶å¯¹åº”ä¸€ä¸ªä¸åŒçš„å·¥ä½œæµç¨‹ã€‚æ­¤å¤–ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­åŒ…å«å…¶ä»–æ–‡ä»¶ï¼Œä¾‹å¦‚è¦åœ¨è¿è¡Œå™¨ä¸Šæ‰§è¡Œçš„é…ç½®æ–‡ä»¶æˆ–è‡ªå®šä¹‰è„šæœ¬ã€‚</p>
<p>æ‚¨åªä¼šä¸ºæŒç»­é›†æˆå®šä¹‰ä¸€ä¸ªå·¥ä½œæµç¨‹ï¼Œå› æ­¤è¯·ç»§ç»­åˆ›å»ºå¿…è¦çš„æ–‡ä»¶å¤¹ç»“æ„ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªåä¸º <code>ci.yml</code> çš„æ–‡ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">page-tracker/
</span></span><span class="line"><span class="cl">â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€ web/
</span></span><span class="line"><span class="cl">â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€ .git/
</span></span><span class="line"><span class="cl">â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€ .github/
</span></span><span class="line"><span class="cl">â”‚   â””â”€â”€ workflows/
</span></span><span class="line"><span class="cl">â”‚       â””â”€â”€ ci.yml
</span></span><span class="line"><span class="cl">â”‚
</span></span><span class="line"><span class="cl">â”œâ”€â”€ .gitignore
</span></span><span class="line"><span class="cl">â””â”€â”€ docker-compose.yml
</span></span></code></pre></div><p>å°½ç®¡æ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½•æ‚¨å–œæ¬¢çš„ä»£ç ç¼–è¾‘å™¨ä¸º GitHub Actions ç¼–å†™å·¥ä½œæµæ–‡ä»¶ï¼Œä½†åœ¨è¿™ç§æƒ…å†µä¸‹è¯·è€ƒè™‘ä½¿ç”¨ GitHub çš„åŸºäº Web çš„ç¼–è¾‘å™¨ã€‚å®ƒä¸ä»…æä¾›é€šç”¨çš„ YAML è¯­æ³•çªå‡ºæ˜¾ç¤ºï¼Œè¿˜æä¾›æ¶æ„éªŒè¯å’Œå¯¹å¯ç”¨ GitHub Actions å±æ€§çš„æ™ºèƒ½å»ºè®®ã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥å…ˆå°†ä»£ç æ¨é€åˆ° GitHubï¼Œç„¶åä½¿ç”¨å†…ç½®ç¼–è¾‘å™¨ç›´æ¥åœ¨é‚£é‡Œç¼–è¾‘æ‚¨çš„ <code>ci.yml</code> æ–‡ä»¶ã€‚</p>
<p>è¦æ‰“å¼€ GitHub å†…ç½®çš„ç¼–è¾‘å™¨ï¼Œè¯·å°† Web æµè§ˆå™¨å¯¼èˆªåˆ° <code>ci.yml</code> æ–‡ä»¶ï¼Œç„¶åæŒ‰ E æˆ–å•å‡»é“…ç¬”å›¾æ ‡ã€‚æ‚¨ç°åœ¨å¯ä»¥å¼€å§‹ç¼–å†™ GitHub Actions å·¥ä½œæµæ–‡ä»¶ã€‚</p>
<h3 id="ä½¿ç”¨-github-actions-åˆ›å»ºå·¥ä½œæµ">ä½¿ç”¨ GitHub Actions åˆ›å»ºå·¥ä½œæµ</h3>
<p>åœ¨ç¼–è¾‘ <code>ci.yml</code> æ–‡ä»¶æ—¶ï¼Œä¸ºæ–°å·¥ä½œæµæŒ‡å®šä¸€ä¸ªæè¿°æ€§åç§°å¹¶å®šä¹‰åº”è§¦å‘å®ƒçš„äº‹ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># .github/workflows/ci.yml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Continuous Integration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">master</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">push</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">master</span><span class="w">
</span></span></span></code></pre></div><p>å°†è§¦å‘æ­¤å·¥ä½œæµçš„ä¸¤ä¸ªäº‹ä»¶æ˜¯ï¼š</p>
<ol>
<li>æ‰“å¼€æˆ–æ›´æ”¹é’ˆå¯¹ <code>master</code> åˆ†æ”¯çš„æ‹‰å–è¯·æ±‚</li>
<li>æ¨é€ä»£ç æˆ–å°†åˆ†æ”¯åˆå¹¶åˆ° <code>master</code> åˆ†æ”¯</li>
</ol>
<p>é™¤äº†åˆ†æ”¯åç§°ä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥ä¸ºæ¯ä¸ªäº‹ä»¶æ·»åŠ æ›´å¤šå±æ€§ä»¥ç¼©å°è§¦å‘æ¡ä»¶ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æä¾›å……å½“æ­£è¿‡æ»¤å™¨çš„æ–‡ä»¶è·¯å¾„æ¨¡å¼ï¼Œè¯¥æ¨¡å¼ä»…åœ¨æŸäº›æ–‡ä»¶å‘ç”Ÿæ›´æ”¹æ—¶æ‰è¿è¡Œå·¥ä½œæµã€‚</p>
<p>æ¯•ç«Ÿï¼Œæ‚¨å¯èƒ½ä¸æƒ³åœ¨ç¼–è¾‘ README æ–‡ä»¶æˆ–æ›´æ–°æ–‡æ¡£åè¿è¡Œæ•´ä¸ªæŒç»­é›†æˆå·¥ä½œæµç¨‹ã€‚ä¸ç®¡æ€æ ·ï¼Œä½ ç°åœ¨ä¼šè®©äº‹æƒ…ä¿æŒç®€å•ã€‚</p>
<p>æ‚¨çš„æŒç»­é›†æˆå·¥ä½œæµç¨‹çš„å·¥ä½œæ˜¯æ„å»º Docker é•œåƒï¼Œä½¿ç”¨ Docker Compose è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•ï¼Œå¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œå°†æ„å»ºçš„é•œåƒæ¨é€åˆ° Docker Hubã€‚</p>
<p>æ„Ÿè°¢æ‚¨å…¨é¢çš„ Dockerfileï¼Œå°†å•å…ƒæµ‹è¯•ã€å„ç§é™æ€ä»£ç åˆ†æå·¥å…·å’Œå®‰å…¨æ‰«æé›†æˆåˆ°ä¸€ä¸ªå‘½ä»¤ä¸­ã€‚å› æ­¤ï¼Œæ‚¨æ— éœ€ä¸º CI å·¥ä½œæµç¨‹ç¼–å†™å¤§é‡ YAMLã€‚</p>
<p>GitHub Action å·¥ä½œæµä¸­çš„å‡ ä¹æ¯é¡¹å·¥ä½œéƒ½æ˜¯ä»ä» GitHub å­˜å‚¨åº“ä¸­æ£€å‡ºä»£ç å¼€å§‹çš„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># .github/workflows/ci.yml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Continuous Integration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">master</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">push</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">master</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">jobs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">build</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Build Docker image and run end-to-end tests</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Checkout code from GitHub</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">actions/checkout@v3</span><span class="w">
</span></span></span></code></pre></div><p>æ‚¨æŒ‡å®šä¸€ä¸ªæ ‡è¯†ä¸º <code>build</code> çš„ä½œä¸šï¼Œå®ƒå°†åœ¨ GitHub æä¾›çš„æœ€æ–° Ubuntu è¿è¡Œå™¨ä¸Šè¿è¡Œã€‚å®ƒçš„ç¬¬ä¸€æ­¥æ˜¯ä½¿ç”¨ <code>actions/checkout</code> GitHub æ“ä½œæ£€æŸ¥è§¦å‘å·¥ä½œæµçš„å•ä¸ªæäº¤ã€‚å› ä¸º GitHub Actions å®é™…ä¸Šæ˜¯ä¼ªè£…çš„ GitHub å­˜å‚¨åº“ï¼Œæ‰€ä»¥æ‚¨å¯ä»¥åœ¨ at ç¬¦å· ( <code>@</code> ) åæä¾› Git æ ‡è®°æˆ–æäº¤å“ˆå¸Œä»¥é€‰æ‹©ç‰¹å®šç‰ˆæœ¬çš„æ“ä½œã€‚</p>
<p>ä½œä¸ºæŒç»­é›†æˆç®¡é“çš„ä¸‹ä¸€æ­¥ï¼Œæ‚¨å¸Œæœ›åœ¨é€šè¿‡ Docker Compose æ‰§è¡Œç«¯åˆ°ç«¯æµ‹è¯•ä¹‹å‰ä¸ºæ‚¨çš„ Web å’Œæµ‹è¯•æœåŠ¡æ„å»º Docker é•œåƒã€‚è¿™æ¬¡æ‚¨å°†åœ¨è¿è¡Œå™¨ä¸Šè¿è¡Œä¸€ä¸ª shell å‘½ä»¤ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç°æœ‰çš„æ“ä½œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># .github/workflows/ci.yml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Continuous Integration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">master</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">push</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">master</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">jobs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">build</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Build Docker image and run end-to-end tests</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Checkout code from GitHub</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">actions/checkout@v3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Run end-to-end tests</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p">&gt;</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">          docker compose --profile testing up
</span></span></span><span class="line"><span class="cl"><span class="sd">          --build
</span></span></span><span class="line"><span class="cl"><span class="sd">          --exit-code-from test-service</span><span class="w">          
</span></span></span></code></pre></div><p>è¿™ä¸¤ä¸ªæ­¥éª¤å°†å§‹ç»ˆè¿è¡Œä»¥å“åº”æ–‡ä»¶é¡¶éƒ¨åˆ—å‡ºçš„äº‹ä»¶ï¼Œå³æ‰“å¼€æ‹‰å–è¯·æ±‚æˆ–å°†åŠŸèƒ½åˆ†æ”¯åˆå¹¶åˆ°ä¸»çº¿ä¸­ã€‚</p>
<p>æ­¤å¤–ï¼Œåœ¨æˆåŠŸå°†åˆ†æ”¯åˆå¹¶åˆ°ä¸»çº¿åï¼Œå½“æ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡æ—¶ï¼Œæ‚¨éœ€è¦å°†æ–°çš„ Docker é•œåƒæ¨é€åˆ° Docker Hubã€‚å› æ­¤ï¼Œåªæœ‰å½“ <code>push</code> äº‹ä»¶è§¦å‘æ‚¨çš„å·¥ä½œæµç¨‹æ—¶ï¼Œæ‚¨æ‰ä¼šæœ‰æ¡ä»¶åœ°è¿è¡Œåç»­æ­¥éª¤ã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚ä½•ä½¿ç”¨ GitHub Actions å®‰å…¨è®¿é—® Docker Hub è€Œä¸ä¼šæ³„éœ²æ‚¨çš„ç§˜å¯†ï¼Ÿä½ ç°åœ¨å°±ä¼šçŸ¥é“äº†ã€‚</p>
<h3 id="é€šè¿‡-github-actions-secrets-è®¿é—®-docker-hub">é€šè¿‡ GitHub Actions Secrets è®¿é—® Docker Hub</h3>
<p>æ—©äº›æ—¶å€™ï¼Œå½“æ‚¨å°†å…¶ä¸­ä¸€ä¸ª Docker é•œåƒä»ç»ˆç«¯æ¨é€åˆ° Docker Registry æ—¶ï¼Œæ‚¨å¿…é¡»é€šè¿‡è°ƒç”¨ <code>docker login</code> å¹¶æä¾›æ‚¨çš„ç”¨æˆ·åå’Œå¯†ç æ¥ç™»å½• Docker Hubã€‚æ­¤å¤–ï¼Œå¦‚æœå¯ç”¨åŒå› ç´ èº«ä»½éªŒè¯ï¼Œåˆ™å¿…é¡»ç”Ÿæˆå…·æœ‰è¶³å¤Ÿæƒé™çš„ä¸ªäººè®¿é—®ä»¤ç‰Œå¹¶æä¾›å®ƒè€Œä¸æ˜¯å¯†ç ã€‚</p>
<p>ä»è‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹æ¨é€é•œåƒçš„æ­¥éª¤ç›¸ä¼¼ï¼Œå› æ­¤æ‚¨å¿…é¡»å…ˆè¿›è¡Œèº«ä»½éªŒè¯ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ shell å‘½ä»¤æˆ–é¢„å®šä¹‰çš„ GitHub æ“ä½œæ¥æ‰§è¡Œæ­¤æ“ä½œï¼Œä¾‹å¦‚ <code>docker/login-action</code> ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># .github/workflows/ci.yml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Continuous Integration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">master</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">push</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">master</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">jobs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">build</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Build Docker image and run end-to-end tests</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Checkout code from GitHub</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">actions/checkout@v3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Run end-to-end tests</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p">&gt;</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">          docker compose --profile testing up
</span></span></span><span class="line"><span class="cl"><span class="sd">          --build
</span></span></span><span class="line"><span class="cl"><span class="sd">          --exit-code-from test-service</span><span class="w">          
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Login to Docker Hub</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">docker/login-action@v2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l">${{ github.event_name == &#39;push&#39; }}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l">${{ secrets.DOCKERHUB_USERNAME }}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l">${{ secrets.DOCKERHUB_TOKEN }}</span><span class="w">
</span></span></span></code></pre></div><p>æ‚¨æœ‰æ¡ä»¶åœ°è¿è¡Œæ­¤æ­¥éª¤ï¼Œæ–¹æ³•æ˜¯ä½¿ç”¨åŒ…å«åœ¨ç¾å…ƒç¬¦å·å’ŒåŒå¤§æ‹¬å·ä¸­çš„ JavaScript è¡¨è¾¾å¼ä» <code>github</code> ä¸Šä¸‹æ–‡è·å–äº‹ä»¶ç±»å‹ã€‚ç„¶åï¼Œæ‚¨é€šè¿‡å¦ä¸€ä¸ªé¢„å®šä¹‰çš„ <code>secrets</code> ä¸Šä¸‹æ–‡å’Œæ‚¨ç°åœ¨å°†è¦å®šä¹‰çš„ä¸¤ä¸ªè‡ªå®šä¹‰å¸¸é‡æä¾›æ‚¨çš„ç§˜å¯† Docker Hub å‡­æ®ã€‚</p>
<p>é€šè¿‡å•å‡»é¡¶éƒ¨å·¥å…·æ ä¸­å¸¦æœ‰é½¿è½®å›¾æ ‡çš„é€‰é¡¹å¡æ‰“å¼€ GitHub å­˜å‚¨åº“çš„è®¾ç½®ï¼Œæ‰¾åˆ°å¹¶å±•å¼€å®‰å…¨éƒ¨åˆ†ä¸‹çš„ç§˜å¯†å’Œå˜é‡ï¼Œç„¶åå•å‡»æ“ä½œã€‚è¿™å°†å¸¦æ‚¨è¿›å…¥ä¸€ä¸ªé¢æ¿ï¼Œæ‚¨å¯ä»¥åœ¨è¯¥é¢æ¿ä¸­ä¸º GitHub Actions è¿è¡Œå™¨å®šä¹‰ç¯å¢ƒå˜é‡å’ŒåŠ å¯†æœºå¯†ã€‚ç°åœ¨ï¼ŒæŒ‡å®šæ‚¨çš„ <code>DOCKERHUB_USERNAME</code> å’Œ <code>DOCKERHUB_TOKEN</code> æœºå¯†ï¼š</p>
<p><img loading="lazy" src="https://files.realpython.com/media/secrets.b7e62f0e5830.png" alt="GitHub Actions Repository Secrets"  />
</p>
<p>è¯·æ³¨æ„ï¼Œè¿™äº›ç§˜å¯†æ˜¯åŠ å¯†çš„ï¼ŒGitHub ä¸ä¼šå†æ¬¡å‘æ‚¨æ˜¾ç¤ºå®ƒä»¬ï¼Œå› æ­¤è¯·ç¡®ä¿å°†å®ƒä»¬ä¿å­˜åœ¨å®‰å…¨çš„åœ°æ–¹ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨è¶³å¤ŸåŠªåŠ›ï¼Œé‚£ä¹ˆæ‚¨å°†èƒ½å¤Ÿæ¢å¤å®ƒä»¬â€”â€”ä¾‹å¦‚ï¼Œé€šè¿‡æ‚¨å·¥ä½œæµç¨‹ä¸­çš„ shell å‘½ä»¤ã€‚</p>
<p>å½“æ‚¨å°†åŠŸèƒ½åˆ†æ”¯åˆå¹¶åˆ°ä¸»çº¿æ—¶ï¼Œæ­¤æ“ä½œä¹Ÿä¼šæœ‰æ¡ä»¶åœ°è¿è¡Œã€‚åœ¨ <code>with</code> éƒ¨åˆ†ï¼Œæ‚¨æŒ‡å®š Dockerfile çš„è·¯å¾„ï¼Œè¯·æ±‚æ¨é€é•œåƒçš„æ“ä½œï¼Œå¹¶åˆ—å‡ºé•œåƒçš„æ ‡ç­¾ã€‚è¯·æ³¨æ„ï¼Œæ‚¨å†æ¬¡ä½¿ç”¨ <code>github</code> ä¸Šä¸‹æ–‡æ¥è·å–å½“å‰æäº¤çš„å“ˆå¸Œå€¼ï¼Œå°½ç®¡æ˜¯é•¿æ ¼å¼ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šGitHub Packages æ˜¯é›†æˆåˆ° GitHub ä¸­çš„å¦ä¸€é¡¹æœåŠ¡ã€‚å®ƒå¯ä»¥ä½œä¸º Docker Hub çš„æ›¿ä»£å“ã€‚å®ƒæ”¯æŒå„ç§åŒ…ç±»å‹ï¼ŒåŒ…æ‹¬ Docker é•œåƒï¼Œè®©æ‚¨å¯ä»¥å°†æºä»£ç å’ŒäºŒè¿›åˆ¶åŒ…å­˜å‚¨åœ¨ä¸€ä¸ªåœ°æ–¹ã€‚ <code>docker/build-push-action</code> å¯ä»¥åˆ©ç”¨æ‚¨çš„ GitHub ä»¤ç‰Œæ¨é€åˆ° GitHub Packagesã€‚</p>
</blockquote>
<p>æ­¤æ—¶ï¼Œæ‚¨çš„æŒç»­é›†æˆå·¥ä½œæµå·²é…ç½®å®Œæ¯•å¹¶å‡†å¤‡å°±ç»ªã€‚å¦‚æœæ‚¨è¿˜æ²¡æœ‰ä½¿ç”¨ GitHub å†…ç½®çš„ä»£ç ç¼–è¾‘å™¨ï¼Œé‚£ä¹ˆè¯·è®°ä½æäº¤å¹¶æ¨é€æ‚¨çš„æœ¬åœ°å­˜å‚¨åº“ä»¥ä½¿æ›´æ”¹ç”Ÿæ•ˆï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ git status
</span></span><span class="line"><span class="cl">On branch master
</span></span><span class="line"><span class="cl">Untracked files:
</span></span><span class="line"><span class="cl">  <span class="o">(</span>use <span class="s2">&#34;git add &lt;file&gt;...&#34;</span> to include in what will be committed<span class="o">)</span>
</span></span><span class="line"><span class="cl">        .github/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">nothing added to commit but untracked files present <span class="o">(</span>use <span class="s2">&#34;git add&#34;</span> to track<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ git add .github/
</span></span><span class="line"><span class="cl">$ git commit -m <span class="s2">&#34;Add a continuous integration workflow&#34;</span>
</span></span><span class="line"><span class="cl">$ git push
</span></span></code></pre></div><p>åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œæ‚¨å°†å¯ç”¨ä¸€äº›åˆ†æ”¯ä¿æŠ¤è§„åˆ™ä»¥é˜²æ­¢ä»»ä½•äººå°†ä»–ä»¬çš„ä»£ç ç›´æ¥æ¨é€åˆ° <code>master</code> åˆ†æ”¯ã€‚å› æ­¤ï¼Œå·¥ä½œæµä¸­çš„ <code>push</code> äº‹ä»¶å°†ä»…é€‚ç”¨äºé€šè¿‡æ‹‰å–è¯·æ±‚å°†åŠŸèƒ½åˆ†æ”¯åˆå¹¶åˆ°ä¸»çº¿ä¸­ã€‚</p>
<h3 id="å¯ç”¨åˆ†æ”¯ä¿æŠ¤è§„åˆ™">å¯ç”¨åˆ†æ”¯ä¿æŠ¤è§„åˆ™</h3>
<p>å†æ¬¡è½¬åˆ°å­˜å‚¨åº“çš„è®¾ç½®ï¼Œå•å‡»ä»£ç å’Œè‡ªåŠ¨åŒ–éƒ¨åˆ†ä¸‹çš„åˆ†æ”¯ï¼Œç„¶åå•å‡»æ ‡è®°ä¸ºæ·»åŠ åˆ†æ”¯ä¿æŠ¤è§„åˆ™çš„æŒ‰é’®ã€‚ç„¶åï¼Œåœ¨ Branch name pattern å­—æ®µä¸­è¾“å…¥æ‚¨çš„ä¸»çº¿åç§°ã€‚å¦‚æœæ‚¨éµå¾ªæœ¬æ•™ç¨‹ä¸­ä½¿ç”¨çš„å‘½åçº¦å®šï¼Œåˆ™åº”åœ¨è¾“å…¥å­—æ®µä¸­é”®å…¥ <code>master</code> ï¼š</p>
<p><img loading="lazy" src="https://files.realpython.com/media/rule_master.8167b2b061aa.png" alt="GitHub Repository&amp;rsquo;s Protected Branch"  />
</p>
<p>æ¥ä¸‹æ¥ï¼Œå¯ç”¨å…¶æ­£ä¸‹æ–¹çš„ä¸€ä¸ªé€‰é¡¹ï¼Œè¯¥é€‰é¡¹æ˜¾ç¤º Require a pull request before mergingã€‚è¿™å°†è‡ªåŠ¨éœ€è¦è‡³å°‘ä¸€ä½å®¡é˜…è€…çš„æ‰¹å‡†ã€‚å¦‚æœæ‚¨åœ¨ GitHub ä¸Šæ²¡æœ‰å…¶ä»–å¸æˆ·ï¼Œæ‚¨å¯ä»¥æš‚æ—¶å–æ¶ˆé€‰ä¸­æ­¤é€‰é¡¹ã€‚å¦åˆ™ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–äººæ‰¹å‡†ï¼Œæ‚¨å°†æ— æ³•åˆå¹¶æ‚¨çš„æ‹‰å–è¯·æ±‚ï¼š<img loading="lazy" src="https://files.realpython.com/media/rule_approvals.4cc8505f0715.png" alt="Require a Pull Request Before Merging"  />
</p>
<p>å‘ä¸‹æ»šåŠ¨ä¸€ç‚¹åï¼Œæ‚¨ä¼šçœ‹åˆ°ä¸€ä¸ªé€‰é¡¹ï¼Œä¸Šé¢å†™ç€ Require status checks to pass before mergingã€‚é€‰æ‹©å®ƒä»¥æ˜¾ç¤ºæ›´å¤šé€‰é¡¹ã€‚å½“ä½ è¿™æ ·åšæ—¶ï¼Œæ£€æŸ¥å¦ä¸€ä¸ªé€‰é¡¹ Require branches to be update before mergingï¼Œè¿™å°†é˜²æ­¢åœ¨ä½ çš„ <code>master</code> åˆ†æ”¯æœ‰æ–°æäº¤æ—¶å…³é—­æ‹‰å–è¯·æ±‚ã€‚æœ€åï¼Œåœ¨ä¸‹é¢çš„æœç´¢æ¡†ä¸­è¾“å…¥æ‚¨çš„å·¥ä½œåç§° <code>build</code> ï¼š</p>
<p><img loading="lazy" src="https://files.realpython.com/media/rule_status_check.6e4a5e464e77.png" alt="Require Status Checks to Pass Before Merging"  />
</p>
<p>ç°åœ¨ï¼Œæ¯ä¸ªæ‹‰å–è¯·æ±‚éƒ½éœ€è¦åœ¨å…è®¸åˆå¹¶ä¹‹å‰é€šè¿‡ç«¯åˆ°ç«¯æµ‹è¯•ã€‚</p>
<p>è¦åœ¨ä¸å…è®¸ç®¡ç†å‘˜å’Œå…¶ä»–å…·æœ‰æå‡æƒé™çš„ç”¨æˆ·ç»•è¿‡è¿™äº›è§„åˆ™çš„æƒ…å†µä¸‹å¼ºåˆ¶æ‰§è¡Œè¿™äº›è§„åˆ™ï¼Œæ‚¨å¯ä»¥åœ¨åº•éƒ¨é€‰æ‹©ä¸€ä¸ªæ ‡è®°ä¸ºä¸å…è®¸ç»•è¿‡ä¸Šè¿°è®¾ç½®çš„é€‰é¡¹ï¼š</p>
<p><img loading="lazy" src="https://files.realpython.com/media/rule_dont_allow.3a38d146c315.png" alt="Don&amp;rsquo;t Allow Bypassing the Above Settings"  />
</p>
<p>å¥½çš„ã€‚ä¸€åˆ‡å°±ç»ªï¼å¦‚ä½•ä½¿ç”¨æ‚¨çš„ Docker åº”ç”¨ç¨‹åºæ¥æµ‹è¯•æ‚¨çš„æŒç»­é›†æˆå·¥ä½œæµç¨‹ï¼Ÿ</p>
<h3 id="é›†æˆæ¥è‡ªåŠŸèƒ½åˆ†æ”¯çš„æ›´æ”¹">é›†æˆæ¥è‡ªåŠŸèƒ½åˆ†æ”¯çš„æ›´æ”¹</h3>
<p>éµå¾ªæœ¬æ•™ç¨‹å‰é¢æ¦‚è¿°çš„åŸºäº Docker çš„æŒç»­é›†æˆç®¡é“ã€‚é¦–å…ˆåˆ›å»ºä¸€ä¸ªå•ç‹¬çš„åŠŸèƒ½åˆ†æ”¯ï¼Œä»¥ç ´åæµ‹è¯•çš„æ–¹å¼ä¿®æ”¹ä»£ç ï¼Œæäº¤æ›´æ”¹å¹¶å°†å®ƒä»¬æ¨é€åˆ° GitHubï¼š</p>
<p>Windowsï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">PS&gt; git checkout -b feature/replace-emoji-face
</span></span><span class="line"><span class="cl">Switched to a new branch <span class="s1">&#39;feature/replace-emoji-face&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">PS&gt; <span class="nb">cd</span> web<span class="se">\s</span>rc<span class="se">\p</span>age_tracker
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">PS&gt; <span class="o">(</span>Get-Content app.py<span class="o">)</span>.replace<span class="o">(</span><span class="s1">&#39;pensive&#39;</span>, <span class="s1">&#39;thinking&#39;</span><span class="o">)</span> <span class="p">|</span> Set-Content app.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">PS&gt; git commit -am <span class="s2">&#34;Replace the emoji in an error message&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>feature/replace-emoji-face 9225d18<span class="o">]</span> Replace the emoji in an error message
</span></span><span class="line"><span class="cl"> <span class="m">1</span> file changed, <span class="m">1</span> insertion<span class="o">(</span>+<span class="o">)</span>, <span class="m">1</span> deletion<span class="o">(</span>-<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">PS&gt; git push --set-upstream origin feature/replace-emoji-face
</span></span><span class="line"><span class="cl">â‹®
</span></span><span class="line"><span class="cl">remote: Create a pull request <span class="k">for</span> <span class="s1">&#39;feature/replace-emoji-face&#39;</span> on GitHub...
</span></span><span class="line"><span class="cl">remote:      https://github.com/realpython/page-tracker/pull/new/feature...
</span></span></code></pre></div><p>Linx + MacOSï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ git checkout -b feature/replace-emoji-face
</span></span><span class="line"><span class="cl">Switched to a new branch <span class="s1">&#39;feature/replace-emoji-face&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ sed -i <span class="s1">&#39;s/pensive/thinking/g&#39;</span> web/src/page_tracker/app.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ git commit -am <span class="s2">&#34;Replace the emoji in an error message&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>feature/replace-emoji-face 9225d18<span class="o">]</span> Replace the emoji in an error message
</span></span><span class="line"><span class="cl"> <span class="m">1</span> file changed, <span class="m">1</span> insertion<span class="o">(</span>+<span class="o">)</span>, <span class="m">1</span> deletion<span class="o">(</span>-<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ git push --set-upstream origin feature/replace-emoji-face
</span></span><span class="line"><span class="cl">â‹®
</span></span><span class="line"><span class="cl">remote: Create a pull request <span class="k">for</span> <span class="s1">&#39;feature/replace-emoji-face&#39;</span> on GitHub...
</span></span><span class="line"><span class="cl">remote:      https://github.com/realpython/page-tracker/pull/new/feature...
</span></span><span class="line"><span class="cl">â‹®
</span></span></code></pre></div><p>æ‚¨åˆ›å»ºå¹¶åˆ‡æ¢åˆ°ä¸€ä¸ªåä¸º <code>feature/replace-emoji-face</code> çš„æ–°æœ¬åœ°åˆ†æ”¯ï¼Œç„¶åå°†é”™è¯¯æ¶ˆæ¯ä¸­çš„è¡¨æƒ…ç¬¦å·ä»æ²‰æ€è„¸æ›´æ”¹ä¸ºæ€è€ƒè„¸ï¼Œè€Œä¸æ›´æ–°ç›¸åº”çš„å•å…ƒæµ‹è¯•ã€‚å°†åˆ†æ”¯æäº¤å¹¶æ¨é€åˆ° GitHub åï¼Œæ‚¨å¯ä»¥é€šè¿‡çªå‡ºæ˜¾ç¤ºè¡Œä¸­çš„é“¾æ¥ä»æ‚¨çš„åŠŸèƒ½åˆ†æ”¯æ‰“å¼€ä¸€ä¸ªæ–°çš„æ‹‰å–è¯·æ±‚åˆ° <code>master</code> ã€‚åªè¦æ‚¨è¿™æ ·åšï¼Œæ‚¨çš„æŒç»­é›†æˆå·¥ä½œæµç¨‹å°±ä¼šå¯åŠ¨ã€‚</p>
<p>å½“ GitHub Actions è¿è¡Œå™¨å®Œæˆå…¶å·¥ä½œæ—¶ï¼Œç”±äºæ£€æŸ¥å¤±è´¥ï¼Œæ‚¨å°†æ— æ³•åˆå¹¶æ‚¨çš„åˆ†æ”¯ï¼š</p>
<p><img loading="lazy" src="https://files.realpython.com/media/failed_pr2.e4e611e3f3cf.png" alt="GitHub Status Check Failed With a Conflict"  />
</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨åªæœ‰ä¸€ä¸ªæ£€æŸ¥å¯¹åº”äºå·¥ä½œæµä¸­çš„ <code>build</code> ä½œä¸šï¼Œæ‚¨åœ¨ä¸Šä¸€èŠ‚ä¸­å°†å…¶é…ç½®ä¸ºåˆ†æ”¯ä¿æŠ¤è§„åˆ™ä¹‹ä¸€ã€‚æ‚¨å¯ä»¥å•å‡»å³ä¾§çš„ Details é“¾æ¥æ¥è°ƒæŸ¥å¤±è´¥æ£€æŸ¥çš„æ—¥å¿—ï¼Œå¹¶ä¸”æ‚¨å¯ä»¥é€‰æ‹©ä»¥è°ƒè¯•æ¨¡å¼é‡æ–°è¿è¡Œç›¸åº”çš„ä½œä¸šä»¥æ”¶é›†æ›´å¤šæ•°æ®ã€‚</p>
<p>æ­¤å¤–ï¼Œä¸Šé¢çš„å±å¹•æˆªå›¾æè¿°äº†æ‚¨çš„åŠŸèƒ½åˆ†æ”¯å’Œç›®æ ‡ä¸»çº¿ä¹‹é—´çš„å‡è®¾å†²çªã€‚è¿™è¡¨æ˜å…¶ä»–äººä¿®æ”¹äº†ä¸æ‚¨ç›¸åŒçš„æ–‡ä»¶ï¼Œå¹¶ä¸”ä»–ä»¬åœ¨æ‚¨ä¿®æ”¹è¡¨æƒ…ç¬¦å·æ—¶æˆåŠŸåœ°å°†ä»–ä»¬çš„æ›´æ”¹ä¸ <code>master</code> åˆ†æ”¯é›†æˆã€‚</p>
<p>æ²¡æœ‰è‡ªåŠ¨è§£å†³æ­¤ç±»å†²çªçš„æ–¹æ³•ï¼Œå› ä¸ºå®ƒæ¶‰åŠç†è§£ä»£ç çš„é€»è¾‘å¹¶åšå‡ºå…³äºä¿ç•™å“ªäº›æ›´æ”¹ä»¥åŠä¸¢å¼ƒå“ªäº›æ›´æ”¹çš„ä¸»è§‚å†³å®šã€‚</p>
<p>è§£å†³æ­¤å†²çªçš„å”¯ä¸€æ–¹æ³•æ˜¯å°†æ›´æ–°åçš„ä¸»çº¿åˆå¹¶åˆ°æ‚¨æœ¬åœ°çš„åŠŸèƒ½åˆ†æ”¯ä¸­ï¼Œå¹¶æ‰‹åŠ¨æ•´åˆå†²çªçš„æ›´æ”¹ã€‚</p>
<p>å³ä½¿æ²¡æœ‰ä»»ä½•å†²çªï¼Œå¦‚æœä¸»çº¿åœ¨æ‚¨çš„åŠŸèƒ½åˆ†æ”¯ä¹‹å‰æœ‰å‡ ä¸ªæäº¤ï¼Œé‚£ä¹ˆæ— è®ºæµ‹è¯•ç»“æœå¦‚ä½•ï¼Œæ‚¨ä»ç„¶å¿…é¡»å°† <code>master</code> ä¸­çš„æœ€æ–°æ›´æ”¹åˆå¹¶åˆ°æ‚¨çš„åˆ†æ”¯ä¸­ã€‚è¿™æ˜¯å› ä¸ºæ‚¨ä¹‹å‰åˆ¶å®šçš„å¦ä¸€ä¸ªåˆ†æ”¯ä¿æŠ¤è§„åˆ™ï¼š</p>
<p><img loading="lazy" src="https://files.realpython.com/media/pr_update2.f48575db3caa.png" alt="GitHub Status Check Passed With an Outdated Branch"  />
</p>
<p>åˆå¹¶æ‹‰å–è¯·æ±‚æŒ‰é’®å°†ä¿æŒç°è‰²å’Œç¦ç”¨çŠ¶æ€ï¼Œç›´åˆ°æ‚¨é‡‡å–æªæ–½è§£å†³æ‰€æœ‰è¿™äº›é—®é¢˜ã€‚</p>
<p>åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œæ‚¨ç°åœ¨åº”è¯¥è·å–æœ€æ–°çš„ <code>master</code> å¹¶å°†å…¶åˆå¹¶åˆ°æ‚¨çš„åŠŸèƒ½åˆ†æ”¯ï¼Œå¿…è¦æ—¶è§£å†³ä»»ä½•å†²çªã€‚ç„¶åï¼Œæ‚¨å°†æ›´æ–°ä»£ç ä»¥ä½¿æ‰€æœ‰æµ‹è¯•å†æ¬¡é€šè¿‡ã€‚è¿”å›ä»£ç ç¼–è¾‘å™¨å¹¶ä½¿ç”¨é¢„æœŸçš„è¡¨æƒ…ç¬¦å·ä¿®å¤å¤±è´¥çš„å•å…ƒæµ‹è¯•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl"> # web/test/unit/test_app.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> # ...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> @unittest.mock.patch(&#34;page_tracker.app.redis&#34;)
</span></span><span class="line"><span class="cl"> def test_should_handle_redis_connection_error(mock_redis, http_client):
</span></span><span class="line"><span class="cl">     # Given
</span></span><span class="line"><span class="cl">     mock_redis.return_value.incr.side_effect = ConnectionError
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     # When
</span></span><span class="line"><span class="cl">     response = http_client.get(&#34;/&#34;)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     # Then
</span></span><span class="line"><span class="cl">     assert response.status_code == 500
</span></span><span class="line"><span class="cl"><span class="gd">-    assert response.text == &#34;Sorry, something went wrong \N{pensive face}&#34;
</span></span></span><span class="line"><span class="cl"><span class="gd"></span><span class="gi">+    assert response.text == &#34;Sorry, something went wrong \N{thinking face}&#34;
</span></span></span></code></pre></div><p>åœ¨æœ¬åœ°è¿è¡Œæµ‹è¯•å¹¶å¯¹ä»£ç çš„æ­£ç¡®æ€§è·å¾—ä¿¡å¿ƒåï¼Œåœ¨åŒä¸€åˆ†æ”¯ä¸Šå†æ¬¡æäº¤å¹¶å°†å…¶æ¨é€åˆ° GitHubã€‚åœ¨è¿™æ ·åšä¹‹å‰ï¼Œå€¼å¾—ä»”ç»†æ£€æŸ¥å½“å‰åˆ†æ”¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ git branch
</span></span><span class="line"><span class="cl">* feature/replace-emoji-face
</span></span><span class="line"><span class="cl">  master
</span></span><span class="line"><span class="cl">$ git add web/test/unit/test_app.py
</span></span><span class="line"><span class="cl">$ git commit -m <span class="s2">&#34;Fix the failing unit test&#34;</span>
</span></span><span class="line"><span class="cl">$ git push
</span></span></code></pre></div><p>æ‹‰å–è¯·æ±‚åº”è¯¥æ¥å—æ‚¨çš„æ›´æ”¹å¹¶å¼€å§‹å¦ä¸€ä¸ª CI æ„å»ºã€‚ä¸€æ—¦æ»¡è¶³æ‰€æœ‰ä¿æŠ¤è§„åˆ™ï¼Œæ‚¨æœ€ç»ˆå¯ä»¥é€šè¿‡å•å‡»ç»¿è‰²æŒ‰é’®å°†æ‚¨çš„åŠŸèƒ½åˆ†æ”¯åˆå¹¶åˆ°å—ä¿æŠ¤çš„ä¸»çº¿ä¸­ï¼š</p>
<p><img loading="lazy" src="https://files.realpython.com/media/pr_success.0d326c26e9ad.png" alt="GitHub Status Checks Passed"  />
</p>
<p>è¯·æ³¨æ„ï¼Œåˆå¹¶å°†è§¦å‘é’ˆå¯¹ <code>master</code> åˆ†æ”¯çš„å¦ä¸€ä¸ª CI æ„å»ºï¼Œä»¥æµ‹è¯•æ‚¨çš„æ›´æ”¹æ˜¯å¦ä¸ä»£ç åº“çš„å…¶ä½™éƒ¨åˆ†å¾ˆå¥½åœ°é›†æˆã€‚äº‹æƒ…æ€»æ˜¯æœ‰å¯èƒ½å‡ºé”™ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœ CI æ„å»ºæˆåŠŸï¼Œåˆ™å·¥ä½œæµå°†æ ‡è®°å¹¶å°†é•œåƒæ¨é€åˆ°æ‚¨çš„ Docker Hub å­˜å‚¨åº“ï¼š</p>
<p><img loading="lazy" src="https://files.realpython.com/media/docker_hub_push.93959f48b437.png" alt="Docker Image Tagged and Pushed By a GitHub Action"  />
</p>
<p>æ¯æ¬¡ CI å·¥ä½œæµæˆåŠŸæ—¶ï¼Œæ¨é€çš„ Docker é•œåƒéƒ½ä¼šè¢«æ ‡è®°ä¸ºå½“å‰ Git æäº¤å“ˆå¸Œå’Œæ ‡ç­¾ <code>latest</code> ã€‚</p>
<p>æ­å–œï¼å…³äºä½¿ç”¨ Docker å’Œæœ‹å‹æ„å»ºæŒç»­é›†æˆç®¡é“çš„æ•´ä¸ªæ•™ç¨‹åˆ°æ­¤ç»“æŸã€‚ç»™è‡ªå·±å½“ä¹‹æ— æ„§çš„è¡¨æ‰¬ï¼Œå› ä¸ºè¿™ç»éæ˜“äº‹ï¼</p>
<h2 id="åç»­æ­¥éª¤">åç»­æ­¥éª¤</h2>
<p>æ‚¨æ€»æ˜¯å¯ä»¥åšå¾ˆå¤šäº‹æƒ…æ¥æ”¹è¿›å’Œå¾®è°ƒç°æœ‰çš„æŒç»­é›†æˆæµç¨‹ã€‚å°½ç®¡è¿™æ˜¯å…³äºæ„å»ºå¼ºå¤§çš„ CI ç®¡é“çš„è¯¦å°½ä¸”å®ç”¨çš„æ•™ç¨‹ï¼Œä½†æ‚¨åªæ˜¯è§¦åŠäº†çš®æ¯›ï¼</p>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›ä¾›æ‚¨è€ƒè™‘çš„æƒ³æ³•ï¼š</p>
<ul>
<li>
<p>è‡ªåŠ¨éƒ¨ç½²åˆ°äº‘ä»¥å®ç°æŒç»­äº¤ä»˜ã€‚</p>
</li>
<li>
<p>é€šè¿‡å…¨æµç¨‹è‡ªåŠ¨åŒ–è½¬å‘æŒç»­éƒ¨ç½²ã€‚</p>
</li>
<li>
<p>å¼•å…¥è´Ÿè½½å‡è¡¡å™¨å’ŒæœåŠ¡å‰¯æœ¬ä»¥è·å¾—æ›´å¥½çš„å¯æ‰©å±•æ€§ã€‚</p>
</li>
<li>
<p>ä½¿ç”¨èº«ä»½éªŒè¯ä»¤ç‰Œä¿æŠ¤æ•æ„Ÿæ•°æ®å­˜å‚¨ã€‚</p>
</li>
<li>
<p>é…ç½®æœåŠ¡çš„æŒä¹…æ—¥å¿—è®°å½•å’Œç›‘æ§ã€‚</p>
</li>
<li>
<p>å®æ–½è“ç»¿éƒ¨ç½²ä»¥å®ç°é›¶åœæœºã€‚</p>
</li>
<li>
<p>æ·»åŠ åŠŸèƒ½åˆ‡æ¢ä»¥è¯•éªŒé‡‘ä¸é›€å‘å¸ƒå’Œ A/B æµ‹è¯•ã€‚</p>
</li>
</ul>
<p>é€šè¿‡æœ¬æ•™ç¨‹ï¼Œæ‚¨å·²ç»ä¸ºå…¥é—¨æ‰“ä¸‹äº†è‰¯å¥½çš„åŸºç¡€ã€‚æ‚¨å½“ç„¶å¯ä»¥ä»è¿™é‡Œå¼€å§‹æ„å»ºä¸€ä¸ªå……åˆ†è‡ªåŠ¨åŒ–å’Œç”Ÿäº§å°±ç»ªçš„æŒç»­é›†æˆç³»ç»Ÿï¼Œåˆ©ç”¨ Docker å’Œæœ‹å‹çš„åŠ›é‡ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>æ‚¨ç°åœ¨å¯¹å¦‚ä½•åœ¨å®¹å™¨åŒ–ç¯å¢ƒä¸­æ„å»ºã€éƒ¨ç½²å’Œç®¡ç†å¤šå®¹å™¨ Web åº”ç”¨ç¨‹åºæœ‰äº†æ·±å…¥çš„äº†è§£ã€‚æ‚¨ä»‹ç»äº†æŒ‚æ¥åˆ° Redis æœåŠ¡å™¨çš„ Flask Web åº”ç”¨ç¨‹åºçš„å¼€å‘ã€æµ‹è¯•ã€ä¿æŠ¤ã€ç å¤´åŒ–å’Œç¼–æ’ã€‚</p>
<p>æ‚¨è¿˜äº†è§£äº†å¦‚ä½•ä½¿ç”¨ Dockerã€GitHub Actions å’Œå„ç§å…¶ä»–å·¥å…·å®šä¹‰æŒç»­é›†æˆç®¡é“ã€‚</p>
<p><strong>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å·²ç»ï¼š</strong></p>
<ul>
<li>åœ¨ Docker å®¹å™¨ä¸­æœ¬åœ°è¿è¡Œ Redis æœåŠ¡å™¨</li>
<li>Dockerç¼–æ’ ä¸€ä¸ªç”¨ Flask ç¼–å†™çš„ Python Web åº”ç”¨ç¨‹åº</li>
<li>æ„å»º Docker é•œåƒå¹¶å°†å®ƒä»¬æ¨é€åˆ° Docker Hub æ³¨å†Œè¡¨</li>
<li>ä½¿ç”¨ Docker Compose ç¼–æ’å¤šå®¹å™¨åº”ç”¨ç¨‹åº</li>
<li>åœ¨ä»»ä½•åœ°æ–¹å¤åˆ¶ç±»ä¼¼ç”Ÿäº§çš„åŸºç¡€è®¾æ–½</li>
<li>ä½¿ç”¨ GitHub Actions å®šä¹‰æŒç»­é›†æˆå·¥ä½œæµç¨‹</li>
</ul>
<p>æ‚¨å‡†å¤‡å¥½æ„å»ºè‡ªå·±çš„æŒç»­é›†æˆç®¡é“äº†å—ï¼Ÿåœ¨è¯„è®ºä¸­è®©å¤§å®¶çŸ¥é“ï¼</p>
<blockquote>
<p>å…è´¹ä¸‹è½½ï¼šå•å‡»<a href="https://realpython.com/bonus/docker-continuous-integration-code/">æ­¤å¤„</a>ä¸‹è½½æ‚¨çš„ Flask åº”ç”¨ç¨‹åºå’Œç›¸å…³èµ„æºï¼Œä»¥ä¾¿æ‚¨å¯ä»¥ä½¿ç”¨ Docker å®šä¹‰æŒç»­é›†æˆç®¡é“ã€‚</p>
</blockquote>
<p>åŸæ–‡é“¾æ¥ï¼š<a href="https://realpython.com/docker-continuous-integration/">Build Robust Continuous Integration With Docker and Friends </a></p>
]]></content:encoded>
    </item>
    
    <item>
      <title>Javaè®¾è®¡æ¨¡å¼ï¼šAbstract Document</title>
      <link>https://blog.chensoul.com/posts/2023/05/22/java-design-patterns-abstract-document/</link>
      <pubDate>Mon, 22 May 2023 14:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/05/22/java-design-patterns-abstract-document/</guid>
      <description>æœ¬æ–‡ä¸»è¦ä»‹ç» Abstract Document æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚ Java Design Patterns æä¾›äº†å„ç§ Java è®¾è®¡</description>
      <content:encoded><![CDATA[<p>æœ¬æ–‡ä¸»è¦ä»‹ç»  Abstract Document æ¨¡å¼ï¼Œåœ¨ <a href="https://java-design-patterns.com/">Java Design Patterns</a>  ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚</p>
<blockquote>
<p><a href="https://java-design-patterns.com/">Java Design Patterns</a> æä¾›äº†å„ç§ Java è®¾è®¡æ¨¡å¼çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ã€‚è¯¥ç½‘ç«™æ—¨åœ¨å¸®åŠ© Java å¼€å‘äººå‘˜äº†è§£å’Œåº”ç”¨å„ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p>
<p>Java Design Patterns ç½‘ç«™æä¾›äº†å¤šç§è®¾è®¡æ¨¡å¼åˆ†ç±»æ–¹å¼ï¼ŒåŒ…æ‹¬åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational Patternsï¼‰ã€ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternsï¼‰å’Œè¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰ï¼Œä»¥åŠå…¶ä»–ä¸€äº›å¸¸è§çš„æ¨¡å¼ã€‚</p>
<p>å¯¹äºæ¯ä¸ªè®¾è®¡æ¨¡å¼ï¼Œè¯¥ç½‘ç«™æä¾›äº†è¯¦ç»†çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ï¼Œå¹¶ä¸”æä¾›äº†ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ã€‚å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©é€‚åˆè‡ªå·±çš„è®¾è®¡æ¨¡å¼ï¼Œå¹¶ä¸”å¯ä»¥å‚è€ƒç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜æ¥ç†è§£å’Œåº”ç”¨è¯¥æ¨¡å¼ã€‚</p>
<p>æ­¤å¤–ï¼ŒJava Design Patterns ç½‘ç«™è¿˜æä¾›äº†ä¸€äº›å…¶ä»–èµ„æºï¼Œå¦‚è®¾è®¡æ¨¡å¼çš„ UML å›¾ã€è®¾è®¡æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ã€è®¾è®¡æ¨¡å¼çš„æ¯”è¾ƒç­‰ã€‚è¿™äº›èµ„æºå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨è®¾è®¡æ¨¡å¼ã€‚</p>
<p>ä¸­æ–‡ç½‘ç«™ï¼š<a href="https://java-design-patterns.com/zh/">https://java-design-patterns.com/zh/</a></p>
<p>Github ä¸Šæºç ä»“åº“ï¼ˆéå®˜æ–¹ï¼‰ï¼š<a href="https://github.com/iluwatar/java-design-patterns">https://github.com/iluwatar/java-design-patterns</a></p>
</blockquote>
<h2 id="ç›®çš„">ç›®çš„</h2>
<p>ä½¿ç”¨åŠ¨æ€å±æ€§ï¼Œå¹¶åœ¨ä¿æŒç±»å‹å®‰å…¨çš„åŒæ—¶å®ç°éç±»å‹åŒ–è¯­è¨€çš„çµæ´»æ€§ã€‚</p>
<blockquote>
<p>æŠ½è±¡æ–‡æ¡£æ¨¡å¼ä¸­çš„å±æ€§å¯¹è±¡å¯ä»¥åŠ¨æ€æ·»åŠ å’Œåˆ é™¤å±æ€§ï¼Œå¹¶ä¸”å±æ€§ç±»å‹æ˜¯åœ¨è¿è¡Œæ—¶ç¡®å®šçš„ï¼Œè¿™ä½¿å¾—æŠ½è±¡æ–‡æ¡£æ¨¡å¼å…·æœ‰ä¸€å®šçš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p>
<p>åœ¨æŠ½è±¡æ–‡æ¡£æ¨¡å¼ä¸­ï¼Œå±æ€§å¯¹è±¡é€šå¸¸ä½¿ç”¨ Map æˆ–è€… List ç­‰æ•°æ®ç»“æ„æ¥å®ç°ã€‚åŠ¨æ€å±æ€§çš„æ·»åŠ å’Œåˆ é™¤å¯ä»¥é€šè¿‡ Map çš„ put å’Œ remove æ–¹æ³•å®ç°ï¼Œè€Œå±æ€§çš„ç±»å‹å¯ä»¥é€šè¿‡æ³›å‹æ¥ç¡®å®šã€‚</p>
</blockquote>
<h2 id="è§£é‡Š">è§£é‡Š</h2>
<p>æŠ½è±¡æ–‡æ¡£æ¨¡å¼ä½¿æ‚¨èƒ½å¤Ÿå¤„ç†å…¶ä»–éé™æ€å±æ€§ã€‚ æ­¤æ¨¡å¼ä½¿ç”¨ç‰¹å¾çš„æ¦‚å¿µæ¥å®ç°ç±»å‹å®‰å…¨ï¼Œå¹¶å°†ä¸åŒç±»çš„å±æ€§åˆ†ç¦»ä¸ºä¸€ç»„æ¥å£ã€‚</p>
<p>çœŸå®ä¸–ç•Œä¾‹å­</p>
<blockquote>
<p>è€ƒè™‘ç”±å¤šä¸ªéƒ¨åˆ†ç»„æˆçš„æ±½è½¦ã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸çŸ¥é“ç‰¹å®šæ±½è½¦æ˜¯å¦çœŸçš„æ‹¥æœ‰æ‰€æœ‰é›¶ä»¶ï¼Œæˆ–è€…ä»…ä»…æ˜¯é›¶ä»¶ä¸­çš„ä¸€éƒ¨åˆ†ã€‚ æˆ‘ä»¬çš„æ±½è½¦æ˜¯åŠ¨æ€è€Œä¸”éå¸¸çµæ´»çš„ã€‚</p>
</blockquote>
<p>é€šä¿—çš„è¯´</p>
<blockquote>
<p>æŠ½è±¡æ–‡æ¡£æ¨¡å¼å…è®¸åœ¨å¯¹è±¡ä¸çŸ¥é“çš„æƒ…å†µä¸‹å°†å±æ€§é™„åŠ åˆ°å¯¹è±¡ã€‚</p>
</blockquote>
<p>ç»´åŸºç™¾ç§‘è¯´</p>
<blockquote>
<p>é¢å‘å¯¹è±¡çš„ç»“æ„è®¾è®¡æ¨¡å¼ï¼Œç”¨äºç»„ç»‡æ¾æ•£ç±»å‹çš„é”®å€¼å­˜å‚¨ä¸­çš„å¯¹è±¡å¹¶ä½¿ç”¨ç±»å‹åŒ–çš„è§†å›¾å…¬å¼€æ•°æ®ã€‚ è¯¥æ¨¡å¼çš„ç›®çš„æ˜¯åœ¨å¼ºç±»å‹è¯­è¨€ä¸­å®ç°ç»„ä»¶ä¹‹é—´çš„é«˜åº¦çµæ´»æ€§ï¼Œåœ¨è¿™ç§è¯­è¨€ä¸­ï¼Œå¯ä»¥åœ¨ä¸ä¸¢å¤±ç±»å‹å®‰å…¨æ”¯æŒçš„æƒ…å†µä¸‹ï¼Œå°†æ–°å±æ€§åŠ¨æ€åœ°æ·»åŠ åˆ°å¯¹è±¡æ ‘ä¸­ã€‚ è¯¥æ¨¡å¼åˆ©ç”¨ç‰¹å¾å°†ç±»çš„ä¸åŒå±æ€§åˆ†æˆä¸åŒçš„æ¥å£ã€‚</p>
</blockquote>
<p><strong>ç¨‹åºç¤ºä¾‹</strong></p>
<p>è®©æˆ‘ä»¬é¦–å…ˆå®šä¹‰åŸºç±»<code>Document</code>å’Œ<code>AbstractDocument</code>ã€‚ å®ƒä»¬åŸºæœ¬ä¸Šä½¿å¯¹è±¡æ‹¥æœ‰å±æ€§æ˜ å°„å’Œä»»æ„æ•°é‡çš„å­å¯¹è±¡ã€‚</p>
<blockquote>
<p>ä»¥ä¸‹ä»£ç åœ¨ java 8 ä¸­ç¼–è¯‘æ­£å¸¸ã€‚</p>
</blockquote>
<p>Document æ¥å£ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Document</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">Void</span> <span class="nf">put</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">Object</span> <span class="nf">get</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">Stream</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">children</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">constructor</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><blockquote>
<p>ä»¥ä¸‹æ¥å£ä¸ä½¿ç”¨ Java 8çš„Stream APIï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Document</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">Object</span> <span class="nf">get</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="kt">void</span> <span class="nf">put</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">List</span><span class="o">&lt;</span><span class="n">Document</span><span class="o">&gt;</span> <span class="nf">children</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div></blockquote>
<p>AbstractDocument æŠ½è±¡ç±»ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">AbstractDocument</span> <span class="kd">implements</span> <span class="n">Document</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">properties</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">protected</span> <span class="nf">AbstractDocument</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">properties</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">properties</span><span class="o">,</span> <span class="s">&#34;properties map is required&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">this</span><span class="o">.</span><span class="na">properties</span> <span class="o">=</span> <span class="n">properties</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="n">Void</span> <span class="nf">put</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">properties</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="n">Object</span> <span class="nf">get</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">properties</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">Stream</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">children</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">Function</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;,</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">constructor</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// java 9
</span></span></span><span class="line"><span class="cl"><span class="c1">//		return Stream.ofNullable(get(key))
</span></span></span><span class="line"><span class="cl"><span class="c1">//			.filter(Objects::nonNull)
</span></span></span><span class="line"><span class="cl"><span class="c1">//			.map(el -&gt; (List&lt;Map&lt;String, Object&gt;&gt;) el)
</span></span></span><span class="line"><span class="cl"><span class="c1">//			.findAny()
</span></span></span><span class="line"><span class="cl"><span class="c1">//			.stream()
</span></span></span><span class="line"><span class="cl"><span class="c1">//			.flatMap(Collection::stream)
</span></span></span><span class="line"><span class="cl"><span class="c1">//			.map(constructor);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="c1">// java 8
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">return</span> <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="n">get</span><span class="o">(</span><span class="n">key</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">			<span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">el</span> <span class="o">-&gt;</span> <span class="n">el</span> <span class="k">instanceof</span> <span class="n">List</span><span class="o">&lt;?&gt;)</span>
</span></span><span class="line"><span class="cl">			<span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">el</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;&gt;)</span> <span class="n">el</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">			<span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">List</span><span class="o">::</span><span class="n">stream</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">			<span class="o">.</span><span class="na">orElseGet</span><span class="o">(</span><span class="n">Stream</span><span class="o">::</span><span class="n">empty</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">			<span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">constructor</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">properties</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæšä¸¾â€œå±æ€§â€å’Œä¸€ç»„ç±»å‹ï¼Œä»·æ ¼ï¼Œæ¨¡å‹å’Œé›¶ä»¶çš„æ¥å£ã€‚ è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿä¸ºCarç±»åˆ›å»ºé™æ€å¤–è§‚çš„ç•Œé¢ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">enum</span> <span class="n">Property</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">PARTS</span><span class="o">,</span> <span class="n">TYPE</span><span class="o">,</span> <span class="n">PRICE</span><span class="o">,</span> <span class="n">MODEL</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">HasType</span> <span class="kd">extends</span> <span class="n">Document</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">default</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getType</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">((</span><span class="n">String</span><span class="o">)</span> <span class="n">get</span><span class="o">(</span><span class="n">Property</span><span class="o">.</span><span class="na">TYPE</span><span class="o">.</span><span class="na">toString</span><span class="o">()));</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">HasPrice</span> <span class="kd">extends</span> <span class="n">Document</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">default</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">Number</span><span class="o">&gt;</span> <span class="nf">getPrice</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">((</span><span class="n">Number</span><span class="o">)</span> <span class="n">get</span><span class="o">(</span><span class="n">Property</span><span class="o">.</span><span class="na">PRICE</span><span class="o">.</span><span class="na">toString</span><span class="o">()));</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">HasModel</span> <span class="kd">extends</span> <span class="n">Document</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">default</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getModel</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">((</span><span class="n">String</span><span class="o">)</span> <span class="n">get</span><span class="o">(</span><span class="n">Property</span><span class="o">.</span><span class="na">MODEL</span><span class="o">.</span><span class="na">toString</span><span class="o">()));</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">HasParts</span> <span class="kd">extends</span> <span class="n">Document</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">default</span> <span class="n">Stream</span><span class="o">&lt;</span><span class="n">Part</span><span class="o">&gt;</span> <span class="nf">getParts</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">children</span><span class="o">(</span><span class="n">Property</span><span class="o">.</span><span class="na">PARTS</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span> <span class="n">Part</span><span class="o">::</span><span class="k">new</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Part</span> <span class="kd">extends</span> <span class="n">AbstractDocument</span> <span class="kd">implements</span> <span class="n">HasType</span><span class="o">,</span> <span class="n">HasModel</span><span class="o">,</span> <span class="n">HasPrice</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="nf">Part</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">properties</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">super</span><span class="o">(</span><span class="n">properties</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ç°åœ¨æˆ‘ä»¬å‡†å¤‡ä»‹ç» <code>Car</code>ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Car</span> <span class="kd">extends</span> <span class="n">AbstractDocument</span> <span class="kd">implements</span> <span class="n">HasModel</span><span class="o">,</span> <span class="n">HasPrice</span><span class="o">,</span> <span class="n">HasParts</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="nf">Car</span><span class="o">(</span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">properties</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">super</span><span class="o">(</span><span class="n">properties</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æœ€åæ˜¯å®Œæ•´ç¤ºä¾‹ä¸­çš„<code>Car</code>æ„é€ å’Œä½¿ç”¨æ–¹å¼ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Slf4j</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">	<span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">	 * Program entry point.
</span></span></span><span class="line"><span class="cl"><span class="cm">	 *
</span></span></span><span class="line"><span class="cl"><span class="cm">	 * @param args command line args
</span></span></span><span class="line"><span class="cl"><span class="cm">	 */</span>
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;Constructing parts and car&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">wheelProperties</span> <span class="o">=</span> <span class="n">ImmutableMap</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">			<span class="n">Property</span><span class="o">.</span><span class="na">TYPE</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span> <span class="s">&#34;wheel&#34;</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">			<span class="n">Property</span><span class="o">.</span><span class="na">MODEL</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span> <span class="s">&#34;15C&#34;</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">			<span class="n">Property</span><span class="o">.</span><span class="na">PRICE</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span> <span class="n">100L</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">doorProperties</span> <span class="o">=</span> <span class="n">ImmutableMap</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">			<span class="n">Property</span><span class="o">.</span><span class="na">TYPE</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span> <span class="s">&#34;door&#34;</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">			<span class="n">Property</span><span class="o">.</span><span class="na">MODEL</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span> <span class="s">&#34;Lambo&#34;</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">			<span class="n">Property</span><span class="o">.</span><span class="na">PRICE</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span> <span class="n">300L</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">carProperties</span> <span class="o">=</span> <span class="n">ImmutableMap</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">			<span class="n">Property</span><span class="o">.</span><span class="na">MODEL</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span> <span class="s">&#34;300SL&#34;</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">			<span class="n">Property</span><span class="o">.</span><span class="na">PRICE</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span> <span class="n">10000L</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">			<span class="n">Property</span><span class="o">.</span><span class="na">PARTS</span><span class="o">.</span><span class="na">toString</span><span class="o">(),</span> <span class="n">ImmutableList</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">wheelProperties</span><span class="o">,</span> <span class="n">doorProperties</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">Car</span> <span class="n">car</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Car</span><span class="o">(</span><span class="n">carProperties</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;Here is our car:&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;-&gt; model: {}&#34;</span><span class="o">,</span> <span class="n">car</span><span class="o">.</span><span class="na">getModel</span><span class="o">().</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">		<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;-&gt; price: {}&#34;</span><span class="o">,</span> <span class="n">car</span><span class="o">.</span><span class="na">getPrice</span><span class="o">().</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">		<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;-&gt; parts: &#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">car</span><span class="o">.</span><span class="na">getParts</span><span class="o">().</span><span class="na">forEach</span><span class="o">(</span><span class="n">p</span> <span class="o">-&gt;</span> <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;\t{}/{}/{}&#34;</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">			<span class="n">p</span><span class="o">.</span><span class="na">getType</span><span class="o">().</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">			<span class="n">p</span><span class="o">.</span><span class="na">getModel</span><span class="o">().</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">			<span class="n">p</span><span class="o">.</span><span class="na">getPrice</span><span class="o">().</span><span class="na">orElse</span><span class="o">(</span><span class="kc">null</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">		<span class="o">);</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>å†æ¥ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="kd">extends</span> <span class="n">AbstractDocument</span><span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="nf">Person</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">super</span><span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;name&#34;</span><span class="o">,</span> <span class="s">&#34;John Doe&#34;</span><span class="o">,</span>  
</span></span><span class="line"><span class="cl">      <span class="s">&#34;age&#34;</span><span class="o">,</span> <span class="n">30</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">      <span class="s">&#34;hobbies&#34;</span><span class="o">,</span> <span class="n">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">&#34;Sports&#34;</span><span class="o">,</span> <span class="s">&#34;Music&#34;</span><span class="o">));</span>     
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">          
</span></span><span class="line"><span class="cl">          
</span></span><span class="line"><span class="cl"><span class="nd">@Slf4j</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PersonApp</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">Person</span> <span class="n">person</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Person</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">		<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;name: {}&#34;</span><span class="o">,</span> <span class="n">person</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">		<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;age: {}&#34;</span><span class="o">,</span> <span class="n">person</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;age&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">		<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;hobbies: {}&#34;</span><span class="o">,</span> <span class="n">person</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;hobbies&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h2 id="ç±»å›¾">ç±»å›¾</h2>
<p><img loading="lazy" src="https://java-design-patterns.com/assets/abstract-document-9f6a2e8d.png" alt="alt text"  />
</p>
<h2 id="é€‚ç”¨æ€§">é€‚ç”¨æ€§</h2>
<p>ä½¿ç”¨æŠ½è±¡æ–‡æ¡£æ¨¡å¼ï¼Œå½“</p>
<ul>
<li>éœ€è¦å³æ—¶æ·»åŠ æ–°å±æ€§</li>
<li>ä½ æƒ³è¦ä¸€ç§çµæ´»çš„æ–¹å¼æ¥ä»¥æ ‘çŠ¶ç»“æ„ç»„ç»‡åŸŸ</li>
<li>ä½ æƒ³è¦æ›´å®½æ¾çš„è€¦åˆç³»ç»Ÿ</li>
</ul>
<p>ä¸‹é¢æ˜¯æŠ½è±¡æ–‡æ¡£æ¨¡å¼çš„ä¸€äº›å®é™…åº”ç”¨ï¼š</p>
<h3 id="1xml-å’Œ-json-è§£æ">1ã€XML å’Œ JSON è§£æ</h3>
<p>æŠ½è±¡æ–‡æ¡£æ¨¡å¼å¯ä»¥ç”¨äºè§£æ XML å’Œ JSON æ•°æ®ã€‚ç”±äº XML å’Œ JSON æ•°æ®é€šå¸¸åŒ…å«åŠ¨æ€å±æ€§ï¼Œå› æ­¤æŠ½è±¡æ–‡æ¡£æ¨¡å¼å¯ä»¥æä¾›ä¸€ç§çµæ´»çš„æ–¹å¼æ¥å¤„ç†è¿™äº›æ•°æ®ã€‚é€šè¿‡å°† XML æˆ– JSON æ•°æ®æ˜ å°„åˆ°æ–‡æ¡£å’Œå±æ€§å¯¹è±¡ï¼Œå¯ä»¥è½»æ¾åœ°è®¿é—®å’Œä¿®æ”¹è¿™äº›æ•°æ®ã€‚</p>
<h4 id="xmlè§£æ">XMLè§£æ</h4>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„XMLæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;bookstore&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;book</span> <span class="na">category=</span><span class="s">&#34;cooking&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;title</span> <span class="na">lang=</span><span class="s">&#34;en&#34;</span><span class="nt">&gt;</span>Everyday Italian<span class="nt">&lt;/title&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;author&gt;</span>Giada De Laurentiis<span class="nt">&lt;/author&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;year&gt;</span>2005<span class="nt">&lt;/year&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;price&gt;</span>30.00<span class="nt">&lt;/price&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/book&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;book</span> <span class="na">category=</span><span class="s">&#34;children&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;title</span> <span class="na">lang=</span><span class="s">&#34;en&#34;</span><span class="nt">&gt;</span>Harry Potter<span class="nt">&lt;/title&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;author&gt;</span>J.K. Rowling<span class="nt">&lt;/author&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;year&gt;</span>2003<span class="nt">&lt;/year&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;price&gt;</span>29.99<span class="nt">&lt;/price&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/book&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/bookstore&gt;</span>
</span></span></code></pre></div><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æŠ½è±¡æ–‡æ¡£æ¨¡å¼æ¥è§£æè¿™ä¸ªXMLæ–‡ä»¶ï¼Œé¦–å…ˆå®šä¹‰ä¸€ä¸ª<code>Document</code>æ¥å£ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Document</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">Object</span> <span class="nf">get</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="kt">void</span> <span class="nf">put</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">List</span><span class="o">&lt;</span><span class="n">Document</span><span class="o">&gt;</span> <span class="nf">children</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ç„¶åå®šä¹‰ä¸€ä¸ªå…·ä½“çš„XMLæ–‡æ¡£ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">XmlDocument</span> <span class="kd">implements</span> <span class="n">Document</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Element</span> <span class="n">element</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="nf">XmlDocument</span><span class="o">(</span><span class="n">Element</span> <span class="n">element</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="o">.</span><span class="na">element</span> <span class="o">=</span> <span class="n">element</span><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">Object</span> <span class="nf">get</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">element</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">put</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">element</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Document</span><span class="o">&gt;</span> <span class="nf">children</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">NodeList</span> <span class="n">nodes</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="na">getElementsByTagName</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">List</span><span class="o">&lt;</span><span class="n">Document</span><span class="o">&gt;</span> <span class="n">children</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nodes</span><span class="o">.</span><span class="na">getLength</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">children</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">XmlDocument</span><span class="o">((</span><span class="n">Element</span><span class="o">)</span> <span class="n">nodes</span><span class="o">.</span><span class="na">item</span><span class="o">(</span><span class="n">i</span><span class="o">)));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">children</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªå…·ä½“çš„XMLæ–‡æ¡£ç±»ä¸­ï¼Œæˆ‘ä»¬å®ç°äº†<code>Document</code>æ¥å£çš„ä¸‰ä¸ªæ–¹æ³•ï¼Œå…¶ä¸­<code>children</code>æ–¹æ³•ä½¿ç”¨äº†DOM APIæ¥è·å–å­å…ƒç´ åˆ—è¡¨ï¼Œå¹¶å°†æ¯ä¸ªå­å…ƒç´ åŒ…è£…æˆä¸€ä¸ªæ–°çš„<code>XmlDocument</code>å¯¹è±¡ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªå…·ä½“çš„XMLæ–‡æ¡£ç±»æ¥è§£æXMLæ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">DocumentBuilderFactory</span> <span class="n">dbFactory</span> <span class="o">=</span> <span class="n">DocumentBuilderFactory</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">DocumentBuilder</span> <span class="n">dBuilder</span> <span class="o">=</span> <span class="n">dbFactory</span><span class="o">.</span><span class="na">newDocumentBuilder</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">Document</span> <span class="n">doc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XmlDocument</span><span class="o">(</span><span class="n">dBuilder</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&#34;books.xml&#34;</span><span class="o">)).</span><span class="na">getDocumentElement</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// è·å–æ ¹å…ƒç´ çš„å±æ€§å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">String</span> <span class="n">bookstoreCategory</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">doc</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;category&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// è·å–æ‰€æœ‰ä¹¦çš„ä¿¡æ¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Document</span><span class="o">&gt;</span> <span class="n">books</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="na">children</span><span class="o">(</span><span class="s">&#34;book&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="o">(</span><span class="n">Document</span> <span class="n">book</span> <span class="o">:</span> <span class="n">books</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">String</span> <span class="n">category</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span><span class="n">doc</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;category&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">String</span> <span class="n">title</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">book</span><span class="o">.</span><span class="na">children</span><span class="o">(</span><span class="s">&#34;title&#34;</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="n">0</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">String</span> <span class="n">author</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">book</span><span class="o">.</span><span class="na">children</span><span class="o">(</span><span class="s">&#34;author&#34;</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="n">0</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="kt">int</span> <span class="n">year</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">book</span><span class="o">.</span><span class="na">children</span><span class="o">(</span><span class="s">&#34;year&#34;</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="n">0</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="kt">double</span> <span class="n">price</span> <span class="o">=</span> <span class="o">(</span><span class="kt">double</span><span class="o">)</span> <span class="n">book</span><span class="o">.</span><span class="na">children</span><span class="o">(</span><span class="s">&#34;price&#34;</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="n">0</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Category: &#34;</span> <span class="o">+</span> <span class="n">category</span> <span class="o">+</span> <span class="s">&#34;, Title: &#34;</span> <span class="o">+</span> <span class="n">title</span> <span class="o">+</span> <span class="s">&#34;, Author: &#34;</span> <span class="o">+</span> <span class="n">author</span> <span class="o">+</span> <span class="s">&#34;, Year: &#34;</span> <span class="o">+</span> <span class="n">year</span> <span class="o">+</span> <span class="s">&#34;, Price: &#34;</span> <span class="o">+</span> <span class="n">price</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h4 id="jsonè§£æ">JSONè§£æ</h4>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„JSONæ–‡ä»¶ï¼Œä»¥ä¸‹æ˜¯<code>example.json</code>æ–‡ä»¶çš„å†…å®¹ï¼šï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;John Smith&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;age&#34;</span><span class="p">:</span> <span class="mi">35</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;address&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;street&#34;</span><span class="p">:</span> <span class="s2">&#34;123 Main St&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;city&#34;</span><span class="p">:</span> <span class="s2">&#34;Anytown&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;state&#34;</span><span class="p">:</span> <span class="s2">&#34;CA&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;zip&#34;</span><span class="p">:</span> <span class="s2">&#34;12345&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;phone&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;home&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;number&#34;</span><span class="p">:</span> <span class="s2">&#34;555-1234&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;work&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;number&#34;</span><span class="p">:</span> <span class="s2">&#34;555-5678&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æŠ½è±¡æ–‡æ¡£æ¨¡å¼æ¥è§£æè¿™ä¸ªJSONæ–‡ä»¶ï¼Œé¦–å…ˆå®šä¹‰ä¸€ä¸ª<code>Document</code>æ¥å£ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Document</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">Object</span> <span class="nf">get</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="kt">void</span> <span class="nf">put</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">List</span><span class="o">&lt;</span><span class="n">Document</span><span class="o">&gt;</span> <span class="nf">children</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ç„¶åå®šä¹‰ä¸€ä¸ªå…·ä½“çš„JSONæ–‡æ¡£ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.google.gson.*</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JsonDocument</span> <span class="kd">implements</span> <span class="n">Document</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">JsonObject</span> <span class="n">object</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">JsonDocument</span><span class="o">(</span><span class="n">JsonObject</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">object</span> <span class="o">=</span> <span class="n">object</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">get</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">JsonElement</span> <span class="n">element</span> <span class="o">=</span> <span class="n">object</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">element</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">element</span><span class="o">.</span><span class="na">isJsonPrimitive</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">JsonPrimitive</span> <span class="n">primitive</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="na">getAsJsonPrimitive</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">primitive</span><span class="o">.</span><span class="na">isNumber</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">primitive</span><span class="o">.</span><span class="na">getAsNumber</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">primitive</span><span class="o">.</span><span class="na">isBoolean</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">primitive</span><span class="o">.</span><span class="na">getAsBoolean</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">primitive</span><span class="o">.</span><span class="na">getAsString</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">element</span><span class="o">.</span><span class="na">isJsonObject</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">new</span> <span class="n">JsonDocument</span><span class="o">(</span><span class="n">element</span><span class="o">.</span><span class="na">getAsJsonObject</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">element</span><span class="o">.</span><span class="na">isJsonArray</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">JsonArray</span> <span class="n">array</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="na">getAsJsonArray</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="n">List</span><span class="o">&lt;</span><span class="n">Document</span><span class="o">&gt;</span> <span class="n">children</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="o">(</span><span class="n">JsonElement</span> <span class="n">child</span> <span class="o">:</span> <span class="n">array</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">children</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">JsonDocument</span><span class="o">(</span><span class="n">child</span><span class="o">.</span><span class="na">getAsJsonObject</span><span class="o">()));</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">children</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">put</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="k">instanceof</span> <span class="n">String</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">object</span><span class="o">.</span><span class="na">addProperty</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">value</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="k">instanceof</span> <span class="n">Number</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">object</span><span class="o">.</span><span class="na">addProperty</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="o">(</span><span class="n">Number</span><span class="o">)</span> <span class="n">value</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="k">instanceof</span> <span class="n">Boolean</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">object</span><span class="o">.</span><span class="na">addProperty</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="o">(</span><span class="n">Boolean</span><span class="o">)</span> <span class="n">value</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="k">instanceof</span> <span class="n">Document</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">JsonDocument</span> <span class="n">jsonDocument</span> <span class="o">=</span> <span class="o">(</span><span class="n">JsonDocument</span><span class="o">)</span> <span class="n">value</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">object</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">jsonDocument</span><span class="o">.</span><span class="na">object</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="k">instanceof</span> <span class="n">List</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">List</span><span class="o">&lt;</span><span class="n">Document</span><span class="o">&gt;</span> <span class="n">children</span> <span class="o">=</span> <span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Document</span><span class="o">&gt;)</span> <span class="n">value</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">JsonArray</span> <span class="n">array</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JsonArray</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="o">(</span><span class="n">Document</span> <span class="n">child</span> <span class="o">:</span> <span class="n">children</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">JsonDocument</span> <span class="n">jsonChild</span> <span class="o">=</span> <span class="o">(</span><span class="n">JsonDocument</span><span class="o">)</span> <span class="n">child</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="n">array</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">jsonChild</span><span class="o">.</span><span class="na">object</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">object</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">array</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Document</span><span class="o">&gt;</span> <span class="nf">children</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">JsonElement</span> <span class="n">element</span> <span class="o">=</span> <span class="n">object</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">List</span><span class="o">&lt;</span><span class="n">Document</span><span class="o">&gt;</span> <span class="n">children</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">element</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">element</span><span class="o">.</span><span class="na">isJsonArray</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">JsonArray</span> <span class="n">array</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="na">getAsJsonArray</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="o">(</span><span class="n">JsonElement</span> <span class="n">child</span> <span class="o">:</span> <span class="n">array</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">children</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">JsonDocument</span><span class="o">(</span><span class="n">child</span><span class="o">.</span><span class="na">getAsJsonObject</span><span class="o">()));</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">children</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªå…·ä½“çš„JSONæ–‡æ¡£ç±»æ¥è§£æJSONæ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JsonParsingExample</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// è¯»å–JSONæ–‡ä»¶å¹¶è§£æ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">Gson</span> <span class="n">gson</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Gson</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="n">JsonElement</span> <span class="n">jsonElement</span> <span class="o">=</span> <span class="n">gson</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="s">&#34;example.json&#34;</span><span class="o">),</span> <span class="n">JsonElement</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">JsonDocument</span> <span class="n">doc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JsonDocument</span><span class="o">(</span><span class="n">jsonElement</span><span class="o">.</span><span class="na">getAsJsonObject</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// è·å–æ ¹å…ƒç´ çš„å±æ€§å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">String</span> <span class="n">name</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">doc</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="kt">int</span> <span class="n">age</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">doc</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;age&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// è·å–åœ°å€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">JsonDocument</span> <span class="n">address</span> <span class="o">=</span> <span class="o">(</span><span class="n">JsonDocument</span><span class="o">)</span> <span class="n">doc</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;address&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">String</span> <span class="n">street</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">address</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;street&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">String</span> <span class="n">city</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">address</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;city&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">String</span> <span class="n">state</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">address</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;state&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">String</span> <span class="n">zip</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">address</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;zip&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// è·å–ç”µè¯å·ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">List</span><span class="o">&lt;</span><span class="n">Document</span><span class="o">&gt;</span> <span class="n">phoneList</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="na">children</span><span class="o">(</span><span class="s">&#34;phone&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="o">(</span><span class="n">Document</span> <span class="n">phone</span> <span class="o">:</span> <span class="n">phoneList</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">String</span> <span class="n">type</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">phone</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;type&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">String</span> <span class="n">number</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">phone</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;number&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">type</span> <span class="o">+</span> <span class="s">&#34;: &#34;</span> <span class="o">+</span> <span class="n">number</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h3 id="2åŠ¨æ€é…ç½®">2ã€åŠ¨æ€é…ç½®</h3>
<p>æŠ½è±¡æ–‡æ¡£æ¨¡å¼å¯ä»¥ç”¨äºåŠ¨æ€é…ç½®ã€‚é€šè¿‡å°†é…ç½®æ•°æ®æ˜ å°„åˆ°æ–‡æ¡£å’Œå±æ€§å¯¹è±¡ï¼Œå¯ä»¥è½»æ¾åœ°è®¿é—®å’Œä¿®æ”¹é…ç½®æ•°æ®ã€‚æ­¤å¤–ï¼Œç”±äºæŠ½è±¡æ–‡æ¡£æ¨¡å¼æ”¯æŒåŠ¨æ€å±æ€§ï¼Œå› æ­¤å¯ä»¥åœ¨è¿è¡Œæ—¶æ·»åŠ æˆ–åˆ é™¤å±æ€§ï¼Œä»è€Œä½¿é…ç½®æ›´åŠ çµæ´»ã€‚</p>
<p>å‡è®¾æœ‰ä¸€ä¸ªå­¦ç”Ÿä¿¡æ¯ç®¡ç†ç³»ç»Ÿï¼Œéœ€è¦å­˜å‚¨å’Œæ£€ç´¢å­¦ç”Ÿä¿¡æ¯ã€‚å­¦ç”Ÿä¿¡æ¯åŒ…æ‹¬å­¦ç”Ÿå§“åã€å­¦ç”Ÿå¹´é¾„ã€å­¦ç”Ÿæ€§åˆ«ã€å­¦ç”Ÿå®¶åº­åœ°å€ç­‰å±æ€§ã€‚ç”±äºå­¦ç”Ÿå±æ€§å¯èƒ½ä¼šéšæ—¶å˜åŒ–ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ä¸€ç§çµæ´»çš„æ–¹å¼æ¥å¤„ç†è¿™äº›å±æ€§ï¼Œå¹¶ä¸”éœ€è¦è½»æ¾åœ°è®¿é—®å’Œä¿®æ”¹è¿™äº›å±æ€§ã€‚</p>
<p>ä¸ºäº†å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨æŠ½è±¡æ–‡æ¡£æ¨¡å¼ã€‚å®šä¹‰ä¸€ä¸ªå­¦ç”Ÿæ–‡æ¡£ç±»ï¼ˆStudentDocumentï¼‰ï¼Œè¯¥ç±»åŒ…å«å­¦ç”Ÿå±æ€§çš„è®¿é—®å™¨å’Œä¿®æ”¹å™¨æ–¹æ³•ï¼Œå¹¶ä¸”æ”¯æŒåŠ¨æ€å±æ€§ã€‚ç„¶åï¼Œå®šä¹‰ä¸€ä¸ªå­¦ç”Ÿå±æ€§ç±»ï¼ˆPropertyï¼‰ï¼Œè¯¥ç±»åŒ…å«å±æ€§åç§°ã€å±æ€§ç±»å‹å’Œå±æ€§å€¼ç­‰å±æ€§ï¼Œå¹¶ä¸”æ”¯æŒåŠ¨æ€å±æ€§ã€‚æœ€åï¼Œä½¿ç”¨ä¸€ä¸ªæ„å»ºå™¨ï¼ˆBuilderï¼‰ç±»æ¥åˆ›å»ºå…·ä½“çš„å­¦ç”Ÿæ–‡æ¡£å¯¹è±¡ï¼Œå¹¶å°†å­¦ç”Ÿå±æ€§æ·»åŠ åˆ°æ–‡æ¡£ä¸­ã€‚</p>
<p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Property</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Object</span> <span class="n">value</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">Property</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">getValue</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setValue</span><span class="o">(</span><span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Document</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Property</span><span class="o">&gt;</span> <span class="n">properties</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">getProperty</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="n">Property</span> <span class="n">property</span> <span class="o">:</span> <span class="n">properties</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">property</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">name</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">property</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setProperty</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="n">Property</span> <span class="n">property</span> <span class="o">:</span> <span class="n">properties</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">property</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">name</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">property</span><span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">properties</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Property</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">value</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">StudentDocument</span> <span class="kd">extends</span> <span class="n">Document</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">getProperty</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">setProperty</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getAge</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">getProperty</span><span class="o">(</span><span class="s">&#34;age&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAge</span><span class="o">(</span><span class="kt">int</span> <span class="n">age</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">setProperty</span><span class="o">(</span><span class="s">&#34;age&#34;</span><span class="o">,</span> <span class="n">age</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getGender</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">getProperty</span><span class="o">(</span><span class="s">&#34;gender&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setGender</span><span class="o">(</span><span class="n">String</span> <span class="n">gender</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">setProperty</span><span class="o">(</span><span class="s">&#34;gender&#34;</span><span class="o">,</span> <span class="n">gender</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getAddress</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">getProperty</span><span class="o">(</span><span class="s">&#34;address&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAddress</span><span class="o">(</span><span class="n">Stringaddress</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">setProperty</span><span class="o">(</span><span class="s">&#34;address&#34;</span><span class="o">,</span> <span class="n">address</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">StudentBuilder</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">StudentDocument</span> <span class="n">student</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StudentDocument</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">student</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAge</span><span class="o">(</span><span class="kt">int</span> <span class="n">age</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">student</span><span class="o">.</span><span class="na">setAge</span><span class="o">(</span><span class="n">age</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setGender</span><span class="o">(</span><span class="n">String</span> <span class="n">gender</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">student</span><span class="o">.</span><span class="na">setGender</span><span class="o">(</span><span class="n">gender</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAddress</span><span class="o">(</span><span class="n">String</span> <span class="n">address</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">student</span><span class="o">.</span><span class="na">setAddress</span><span class="o">(</span><span class="n">address</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">StudentDocument</span> <span class="nf">build</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">student</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ä½¿ç”¨æŠ½è±¡æ–‡æ¡£æ¨¡å¼ï¼Œå¯ä»¥è½»æ¾åœ°è®¿é—®å’Œä¿®æ”¹å­¦ç”Ÿå±æ€§ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">StudentBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StudentBuilder</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">builder</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&#34;Tom&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">builder</span><span class="o">.</span><span class="na">setAge</span><span class="o">(</span><span class="n">18</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">builder</span><span class="o">.</span><span class="na">setGender</span><span class="o">(</span><span class="s">&#34;Male&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">builder</span><span class="o">.</span><span class="na">setAddress</span><span class="o">(</span><span class="s">&#34;Beijing&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">StudentDocument</span> <span class="n">student</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">student</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span> <span class="c1">// è¾“å‡ºï¼šTom
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">student</span><span class="o">.</span><span class="na">setAddress</span><span class="o">(</span><span class="s">&#34;Shanghai&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">student</span><span class="o">.</span><span class="na">getAddress</span><span class="o">());</span> <span class="c1">// è¾“å‡ºï¼šShanghai
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">student</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s">&#34;phoneNumber&#34;</span><span class="o">,</span> <span class="s">&#34;1234567890&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">student</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">&#34;phoneNumber&#34;</span><span class="o">));</span> <span class="c1">// è¾“å‡ºï¼š1234567890
</span></span></span></code></pre></div><h3 id="3ä¸šåŠ¡è§„åˆ™å¼•æ“">3ã€ä¸šåŠ¡è§„åˆ™å¼•æ“</h3>
<p>æŠ½è±¡æ–‡æ¡£æ¨¡å¼å¯ä»¥ç”¨äºå®ç°ä¸šåŠ¡è§„åˆ™å¼•æ“ã€‚é€šè¿‡å°†è§„åˆ™æ•°æ®æ˜ å°„åˆ°æ–‡æ¡£å’Œå±æ€§å¯¹è±¡ï¼Œå¯ä»¥è½»æ¾åœ°è®¿é—®å’Œä¿®æ”¹è§„åˆ™æ•°æ®ã€‚æ­¤å¤–ï¼Œç”±äºæŠ½è±¡æ–‡æ¡£æ¨¡å¼æ”¯æŒåŠ¨æ€å±æ€§ï¼Œå› æ­¤å¯ä»¥åœ¨è¿è¡Œæ—¶æ·»åŠ æˆ–åˆ é™¤è§„åˆ™ï¼Œä»è€Œä½¿è§„åˆ™å¼•æ“æ›´åŠ çµæ´»ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„ä¸šåŠ¡è§„åˆ™ï¼Œç”¨äºç¡®å®šç”¨æˆ·æ˜¯å¦æœ‰èµ„æ ¼è·å¾—æŸé¡¹å¥–åŠ±ã€‚è¿™ä¸ªè§„åˆ™å¯èƒ½æ¶‰åŠåˆ°å¤šä¸ªæ¡ä»¶ï¼Œä¾‹å¦‚ç”¨æˆ·çš„å¹´é¾„ã€æ‰€åœ¨åœ°åŒºä»¥åŠè´­ç‰©é‡‘é¢ç­‰ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªè§„åˆ™è¡¨ç¤ºä¸ºä¸€ä¸ªæ–‡æ¡£ï¼Œä¾‹å¦‚ä¸€ä¸ªJSONæ–‡æ¡£ï¼Œå…¶ä¸­æ¯ä¸ªå±æ€§å¯¹åº”ä¸€ä¸ªè§„åˆ™æ¡ä»¶ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;age&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;operator&#34;</span><span class="p">:</span> <span class="s2">&#34;&gt;=&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;value&#34;</span><span class="p">:</span> <span class="mi">18</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;region&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;operator&#34;</span><span class="p">:</span> <span class="s2">&#34;in&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;value&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;east&#34;</span><span class="p">,</span> <span class="s2">&#34;south&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;amount&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;operator&#34;</span><span class="p">:</span> <span class="s2">&#34;&gt;=&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;value&#34;</span><span class="p">:</span> <span class="mi">1000</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æŠ½è±¡æ–‡æ¡£æ¨¡å¼æ¥è§£æè¿™ä¸ªæ–‡æ¡£ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªè§„åˆ™å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸º<code>Rule</code>çš„ç±»ï¼Œå®ƒåŒ…å«ä¸‰ä¸ªå±æ€§ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Rule</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">key</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">operator</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Object</span> <span class="n">value</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Object</span> <span class="n">secondValue</span><span class="o">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">Rule</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">String</span> <span class="n">operator</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">operator</span><span class="o">,</span> <span class="n">value</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">Rule</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">String</span> <span class="n">operator</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">,</span> <span class="n">Object</span> <span class="n">secondValue</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">operator</span> <span class="o">=</span> <span class="n">operator</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">secondValue</span> <span class="o">=</span> <span class="n">secondValue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">evaluate</span><span class="o">(</span><span class="n">Document</span> <span class="n">document</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Object</span> <span class="n">documentValue</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">documentValue</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">switch</span> <span class="o">(</span><span class="n">operator</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">case</span> <span class="s">&#34;&gt;=&#34;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">compare</span><span class="o">(</span><span class="n">documentValue</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span> <span class="o">&gt;=</span> <span class="n">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">case</span> <span class="s">&#34;&lt;=&#34;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">compare</span><span class="o">(</span><span class="n">documentValue</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span> <span class="o">&lt;=</span> <span class="n">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">case</span> <span class="s">&#34;&gt;&#34;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">compare</span><span class="o">(</span><span class="n">documentValue</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">case</span> <span class="s">&#34;&lt;&#34;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">compare</span><span class="o">(</span><span class="n">documentValue</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span> <span class="o">&lt;</span> <span class="n">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">case</span> <span class="s">&#34;==&#34;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">compare</span><span class="o">(</span><span class="n">documentValue</span><span class="o">,</span><span class="n">value</span><span class="o">)</span> <span class="o">==</span> <span class="n">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">case</span> <span class="s">&#34;!=&#34;</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">compare</span><span class="o">(</span><span class="n">documentValue</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span> <span class="o">!=</span> <span class="n">0</span><span class="o">;</span>  
</span></span><span class="line"><span class="cl">          	<span class="k">case</span> <span class="s">&#34;in&#34;</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="k">instanceof</span> <span class="n">List</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">List</span><span class="o">&lt;?&gt;</span> <span class="n">listValue</span> <span class="o">=</span> <span class="o">(</span><span class="n">List</span><span class="o">&lt;?&gt;)</span> <span class="n">value</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                    <span class="k">for</span> <span class="o">(</span><span class="n">Object</span> <span class="n">item</span> <span class="o">:</span> <span class="n">listValue</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                        <span class="k">if</span> <span class="o">(</span><span class="n">compare</span><span class="o">(</span><span class="n">documentValue</span><span class="o">,</span> <span class="n">item</span><span class="o">)</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                        <span class="o">}</span>
</span></span><span class="line"><span class="cl">                    <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">case</span> <span class="s">&#34;not in&#34;</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">            		<span class="kt">boolean</span> <span class="n">found</span><span class="o">=</span><span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="k">instanceof</span> <span class="n">List</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">List</span><span class="o">&lt;?&gt;</span> <span class="n">listValue</span> <span class="o">=</span> <span class="o">(</span><span class="n">List</span><span class="o">&lt;?&gt;)</span> <span class="n">value</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                    <span class="k">for</span> <span class="o">(</span><span class="n">Object</span> <span class="n">item</span> <span class="o">:</span> <span class="n">listValue</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                        <span class="k">if</span> <span class="o">(</span><span class="n">compare</span><span class="o">(</span><span class="n">documentValue</span><span class="o">,</span> <span class="n">item</span><span class="o">)</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                            <span class="n">found</span><span class="o">=</span><span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                          	<span class="k">break</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                        <span class="o">}</span>
</span></span><span class="line"><span class="cl">                    <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="o">!</span><span class="n">found</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">          	<span class="k">case</span> <span class="s">&#34;between&#34;</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">secondValue</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="kt">int</span> <span class="n">cmp1</span> <span class="o">=</span> <span class="n">compare</span><span class="o">(</span><span class="n">documentValue</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="kt">int</span> <span class="n">cmp2</span> <span class="o">=</span> <span class="n">compare</span><span class="o">(</span><span class="n">documentValue</span><span class="o">,</span> <span class="n">secondValue</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">cmp1</span> <span class="o">&gt;=</span> <span class="n">0</span> <span class="o">&amp;&amp;</span> <span class="n">cmp2</span> <span class="o">&lt;=</span> <span class="n">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">case</span> <span class="s">&#34;not between&#34;</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">secondValue</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="kt">int</span> <span class="n">cmp1</span> <span class="o">=</span> <span class="n">compare</span><span class="o">(</span><span class="n">documentValue</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="kt">int</span> <span class="n">cmp2</span> <span class="o">=</span> <span class="n">compare</span><span class="o">(</span><span class="n">documentValue</span><span class="o">,</span> <span class="n">secondValue</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">cmp1</span> <span class="o">&lt;</span> <span class="n">0</span> <span class="o">||</span> <span class="n">cmp2</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">          	<span class="k">case</span> <span class="s">&#34;regex&#34;</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">documentValue</span> <span class="k">instanceof</span> <span class="n">String</span> <span class="o">&amp;&amp;</span> <span class="n">value</span> <span class="k">instanceof</span> <span class="n">String</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">String</span> <span class="n">strValue</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">value</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                    <span class="n">String</span> <span class="n">strDocumentValue</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">documentValue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="n">strDocumentValue</span><span class="o">.</span><span class="na">matches</span><span class="o">(</span><span class="n">strValue</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">case</span> <span class="s">&#34;startswith&#34;</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">                <span class="k">if</span><span class="o">(</span><span class="n">documentValue</span> <span class="k">instanceof</span> <span class="n">String</span> <span class="o">&amp;&amp;</span> <span class="n">value</span> <span class="k">instanceof</span> <span class="n">String</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">String</span> <span class="n">strValue</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">value</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                    <span class="n">String</span> <span class="n">strDocumentValue</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">documentValue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="n">strDocumentValue</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="n">strValue</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">case</span> <span class="s">&#34;endswith&#34;</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">documentValue</span> <span class="k">instanceof</span> <span class="n">String</span> <span class="o">&amp;&amp;</span> <span class="n">value</span> <span class="k">instanceof</span> <span class="n">String</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">String</span> <span class="n">strValue</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">value</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                    <span class="n">String</span> <span class="n">strDocumentValue</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">documentValue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="n">strDocumentValue</span><span class="o">.</span><span class="na">endsWith</span><span class="o">(</span><span class="n">strValue</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">case</span> <span class="s">&#34;like&#34;</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">documentValue</span> <span class="k">instanceof</span> <span class="n">String</span> <span class="o">&amp;&amp;</span> <span class="n">value</span> <span class="k">instanceof</span> <span class="n">String</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">String</span> <span class="n">strValue</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">value</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                    <span class="n">String</span> <span class="n">strDocumentValue</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">documentValue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="n">strDocumentValue</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">strValue</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">          	<span class="k">case</span> <span class="s">&#34;not like&#34;</span><span class="o">:</span> 
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">documentValue</span> <span class="k">instanceof</span> <span class="n">String</span> <span class="o">&amp;&amp;</span> <span class="n">value</span> <span class="k">instanceof</span> <span class="n">String</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">String</span> <span class="n">strValue</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">value</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                    <span class="n">String</span> <span class="n">strDocumentValue</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">documentValue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="o">!</span><span class="n">strDocumentValue</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">strValue</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">           	<span class="k">default</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="n">Object</span> <span class="n">a</span><span class="o">,</span> <span class="n">Object</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">a</span> <span class="k">instanceof</span> <span class="n">Number</span> <span class="o">&amp;&amp;</span> <span class="n">b</span> <span class="k">instanceof</span> <span class="n">Number</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Double</span><span class="o">.</span><span class="na">compare</span><span class="o">(((</span><span class="n">Number</span><span class="o">)</span> <span class="n">a</span><span class="o">).</span><span class="na">doubleValue</span><span class="o">(),</span> <span class="o">((</span><span class="n">Number</span><span class="o">)</span> <span class="n">b</span><span class="o">).</span><span class="na">doubleValue</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">a</span> <span class="k">instanceof</span> <span class="n">String</span> <span class="o">&amp;&amp;</span> <span class="n">b</span> <span class="k">instanceof</span> <span class="n">String</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="o">((</span><span class="n">String</span><span class="o">)</span> <span class="n">a</span><span class="o">).</span><span class="na">compareTo</span><span class="o">((</span><span class="n">String</span><span class="o">)</span> <span class="n">b</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="na">toString</span><span class="o">().</span><span class="na">compareTo</span><span class="o">(</span><span class="n">b</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p><code>Rule</code>ç±»æœ‰ä¸€ä¸ª<code>evaluate</code>æ–¹æ³•ï¼Œå®ƒæ¥å—ä¸€ä¸ª<code>Document</code>å¯¹è±¡ï¼Œå¹¶æ ¹æ®è§„åˆ™æ¡ä»¶å¯¹æ–‡æ¡£è¿›è¡Œè¯„ä¼°ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸Šé¢çš„è§„åˆ™æ–‡æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸‰ä¸ª<code>Rule</code>å¯¹è±¡ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Rule</span> <span class="n">ageRule</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Rule</span><span class="o">(</span><span class="s">&#34;age&#34;</span><span class="o">,</span> <span class="s">&#34;between&#34;</span><span class="o">,</span> <span class="n">18</span><span class="o">,</span> <span class="n">30</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">Rule</span> <span class="n">regionRule</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Rule</span><span class="o">(</span><span class="s">&#34;region&#34;</span><span class="o">,</span> <span class="s">&#34;in&#34;</span><span class="o">,</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;east&#34;</span><span class="o">,</span> <span class="s">&#34;south&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl"><span class="n">Rule</span> <span class="n">amountRule</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Rule</span><span class="o">(</span><span class="s">&#34;amount&#34;</span><span class="o">,</span> <span class="s">&#34;&gt;=&#34;</span><span class="o">,</span> <span class="n">1000</span><span class="o">);</span>
</span></span></code></pre></div><p>ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›è§„åˆ™åº”ç”¨äºç”¨æˆ·æ•°æ®ï¼Œä¾‹å¦‚ä¸€ä¸ªå­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„ç”¨æˆ·è®°å½•ã€‚æˆ‘ä»¬å¯ä»¥å°†ç”¨æˆ·æ•°æ®è¡¨ç¤ºä¸ºä¸€ä¸ªæ–‡æ¡£ï¼Œä¾‹å¦‚ä¸€ä¸ªXMLæ–‡æ¡£ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;user&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;name&gt;</span>John Doe<span class="nt">&lt;/name&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;age&gt;</span>25<span class="nt">&lt;/age&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;region&gt;</span>east<span class="nt">&lt;/region&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;amount&gt;</span>1200<span class="nt">&lt;/amount&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/user&gt;</span>
</span></span></code></pre></div><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æŠ½è±¡æ–‡æ¡£æ¨¡å¼è§£æè¯¥æ–‡æ¡£å¹¶å°†å…¶è½¬æ¢ä¸º<code>Document</code>å¯¹è±¡ã€‚ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>Rule</code>å¯¹è±¡å’Œ<code>Document</code>å¯¹è±¡æ¥è¯„ä¼°ç”¨æˆ·æ˜¯å¦æœ‰èµ„æ ¼è·å¾—å¥–åŠ±ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Document</span> <span class="n">userDocument</span> <span class="o">=</span> <span class="o">...</span> <span class="c1">// è§£æç”¨æˆ·æ•°æ®ä¸ºä¸€ä¸ªDocumentå¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">boolean</span> <span class="n">isEligible</span> <span class="o">=</span> <span class="n">ageRule</span><span class="o">.</span><span class="na">evaluate</span><span class="o">(</span><span class="n">userDocument</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">regionRule</span><span class="o">.</span><span class="na">evaluate</span><span class="o">(</span><span class="n">userDocument</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">amountRule</span><span class="o">.</span><span class="na">evaluate</span><span class="o">(</span><span class="n">userDocument</span><span class="o">);</span>
</span></span></code></pre></div><h3 id="4æ•°æ®åº“æ˜ å°„">4ã€æ•°æ®åº“æ˜ å°„</h3>
<p>æŠ½è±¡æ–‡æ¡£æ¨¡å¼å¯ä»¥ç”¨äºå°†æ•°æ®åº“æ•°æ®æ˜ å°„åˆ°æ–‡æ¡£å’Œå±æ€§å¯¹è±¡ä¸Šã€‚é€šè¿‡å°†æ•°æ®åº“è¡¨æ˜ å°„åˆ°æ–‡æ¡£å¯¹è±¡ï¼Œå°†è¡¨çš„åˆ—æ˜ å°„åˆ°å±æ€§å¯¹è±¡ï¼Œå¯ä»¥è½»æ¾åœ°è®¿é—®å’Œä¿®æ”¹æ•°æ®åº“æ•°æ®ã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>Javaè®¾è®¡æ¨¡å¼ï¼šAbstract Factory</title>
      <link>https://blog.chensoul.com/posts/2023/05/22/java-design-patterns-abstract-factory/</link>
      <pubDate>Mon, 22 May 2023 14:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/05/22/java-design-patterns-abstract-factory/</guid>
      <description>æœ¬æ–‡ä¸»è¦ä»‹ç» Abstract Factory æ¨¡å¼ï¼Œåœ¨ Java Design Patterns ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚ Java Design Patterns æä¾›äº†å„ç§ Java è®¾è®¡</description>
      <content:encoded><![CDATA[<p>æœ¬æ–‡ä¸»è¦ä»‹ç»  Abstract Factory æ¨¡å¼ï¼Œåœ¨ <a href="https://java-design-patterns.com/">Java Design Patterns</a>  ç½‘ç«™ä¸Šæœ‰å¯¹è¯¥æ¨¡å¼è¿›è¡Œä»‹ç»ã€‚è¿™é‡Œä¸»è¦æ˜¯åšä¸ªç¬”è®°ï¼Œå¹¶æ·»åŠ ä¸€äº›æ‰©å±•ï¼Œä»¥åŠ æ·±å¯¹è¯¥è®¾è®¡æ¨¡å¼çš„ç†è§£ã€‚</p>
<blockquote>
<p><a href="https://java-design-patterns.com/">Java Design Patterns</a> æä¾›äº†å„ç§ Java è®¾è®¡æ¨¡å¼çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ã€‚è¯¥ç½‘ç«™æ—¨åœ¨å¸®åŠ© Java å¼€å‘äººå‘˜äº†è§£å’Œåº”ç”¨å„ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p>
<p>Java Design Patterns ç½‘ç«™æä¾›äº†å¤šç§è®¾è®¡æ¨¡å¼åˆ†ç±»æ–¹å¼ï¼ŒåŒ…æ‹¬åˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational Patternsï¼‰ã€ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternsï¼‰å’Œè¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰ï¼Œä»¥åŠå…¶ä»–ä¸€äº›å¸¸è§çš„æ¨¡å¼ã€‚</p>
<p>å¯¹äºæ¯ä¸ªè®¾è®¡æ¨¡å¼ï¼Œè¯¥ç½‘ç«™æä¾›äº†è¯¦ç»†çš„ä»‹ç»ã€ç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜ï¼Œå¹¶ä¸”æä¾›äº†ä¸€äº›å¸¸è§çš„ä½¿ç”¨åœºæ™¯å’Œæ³¨æ„äº‹é¡¹ã€‚å¼€å‘äººå‘˜å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©é€‚åˆè‡ªå·±çš„è®¾è®¡æ¨¡å¼ï¼Œå¹¶ä¸”å¯ä»¥å‚è€ƒç¤ºä¾‹ä»£ç å’Œç”¨ä¾‹è¯´æ˜æ¥ç†è§£å’Œåº”ç”¨è¯¥æ¨¡å¼ã€‚</p>
<p>æ­¤å¤–ï¼ŒJava Design Patterns ç½‘ç«™è¿˜æä¾›äº†ä¸€äº›å…¶ä»–èµ„æºï¼Œå¦‚è®¾è®¡æ¨¡å¼çš„ UML å›¾ã€è®¾è®¡æ¨¡å¼çš„ä¼˜ç¼ºç‚¹ã€è®¾è®¡æ¨¡å¼çš„æ¯”è¾ƒç­‰ã€‚è¿™äº›èµ„æºå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´å¥½åœ°ç†è§£å’Œåº”ç”¨è®¾è®¡æ¨¡å¼ã€‚</p>
<p>ä¸­æ–‡ç½‘ç«™ï¼š<a href="https://java-design-patterns.com/zh/">https://java-design-patterns.com/zh/</a></p>
<p>Github ä¸Šæºç ä»“åº“ï¼ˆéå®˜æ–¹ï¼‰ï¼š<a href="https://github.com/iluwatar/java-design-patterns">https://github.com/iluwatar/java-design-patterns</a></p>
</blockquote>
<h2 id="ç›®çš„">ç›®çš„</h2>
<p>æŠ½è±¡å·¥å‚ï¼ˆAbstract Factoryï¼‰æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§æ–¹å¼æ¥åˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–ä¾èµ–å¯¹è±¡çš„å®¶æ—ï¼Œè€Œæ— éœ€æŒ‡å®šå®ƒä»¬å…·ä½“çš„ç±»ã€‚</p>
<p>æŠ½è±¡å·¥å‚æ¨¡å¼ä½¿ç”¨ä¸€ä¸ªæŠ½è±¡å·¥å‚æ¥å£æ¥å®šä¹‰ä¸€ç»„ç›¸å…³çš„å·¥å‚æ–¹æ³•ï¼Œæ¯ä¸ªå·¥å‚æ–¹æ³•éƒ½èƒ½å¤Ÿåˆ›å»ºä¸€ç»„ç›¸å…³çš„äº§å“ã€‚å…·ä½“çš„å·¥å‚å®ç°äº†è¿™ä¸ªæ¥å£ï¼Œå¹¶èƒ½å¤Ÿåˆ›å»ºå…·ä½“çš„äº§å“ã€‚å®¢æˆ·ç«¯ä»£ç åªéœ€è¦ä½¿ç”¨æŠ½è±¡å·¥å‚æ¥å£æ¥åˆ›å»ºäº§å“ï¼Œè€Œä¸éœ€è¦å…³å¿ƒå…·ä½“çš„äº§å“å®ç°ã€‚</p>
<h2 id="è§£é‡Š">è§£é‡Š</h2>
<p>çœŸå®ä¸–ç•Œä¾‹å­</p>
<blockquote>
<p>è¦åˆ›å»ºä¸€ä¸ªç‹å›½ï¼Œæˆ‘ä»¬éœ€è¦å…·æœ‰å…±åŒä¸»é¢˜çš„å¯¹è±¡ã€‚ç²¾çµç‹å›½éœ€è¦ç²¾çµå›½ç‹ã€ç²¾çµåŸå ¡å’Œç²¾çµå†›é˜Ÿï¼Œè€Œå…½äººç‹å›½éœ€è¦å…½äººå›½ç‹ã€å…½äººåŸå ¡å’Œå…½äººå†›é˜Ÿã€‚ç‹å›½ä¸­çš„å¯¹è±¡ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»ã€‚</p>
</blockquote>
<p>é€šä¿—çš„è¯´</p>
<blockquote>
<p>å·¥å‚çš„å·¥å‚ï¼› ä¸€ä¸ªå°†å•ä¸ªä½†ç›¸å…³/ä»å±çš„å·¥å‚åˆ†ç»„åœ¨ä¸€èµ·è€Œæ²¡æœ‰æŒ‡å®šå…¶å…·ä½“ç±»åˆ«çš„å·¥å‚ã€‚</p>
</blockquote>
<p>ç»´åŸºç™¾ç§‘ä¸Šè¯´</p>
<blockquote>
<p>æŠ½è±¡å·¥å‚æ¨¡å¼æä¾›äº†ä¸€ç§å°è£…ä¸€ç»„å…·æœ‰å…±åŒä¸»é¢˜çš„å•ä¸ªå·¥å‚è€Œæ— éœ€æŒ‡å®šå…¶å…·ä½“ç±»çš„æ–¹æ³•</p>
</blockquote>
<p><strong>ç¨‹åºç¤ºä¾‹</strong></p>
<p>ç¿»è¯‘ä¸Šé¢çš„ç‹å›½ç¤ºä¾‹ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬ä¸ºç‹å›½ä¸­çš„å¯¹è±¡æä¾›äº†ä¸€äº›æ¥å£å’Œå®ç°ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Castle</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">String</span> <span class="nf">getDescription</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">King</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">String</span> <span class="nf">getDescription</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Army</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">String</span> <span class="nf">getDescription</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Elven implementations -&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ElfCastle</span> <span class="kd">implements</span> <span class="n">Castle</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DESCRIPTION</span> <span class="o">=</span> <span class="s">&#34;This is the Elven castle!&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getDescription</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">DESCRIPTION</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ElfKing</span> <span class="kd">implements</span> <span class="n">King</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DESCRIPTION</span> <span class="o">=</span> <span class="s">&#34;This is the Elven king!&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getDescription</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">DESCRIPTION</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ElfArmy</span> <span class="kd">implements</span> <span class="n">Army</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DESCRIPTION</span> <span class="o">=</span> <span class="s">&#34;This is the Elven Army!&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getDescription</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">DESCRIPTION</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Orcish implementations similarly -&gt; ...
</span></span></span></code></pre></div><p>ç„¶åæˆ‘ä»¬æœ‰äº†ç‹å›½å·¥å‚çš„æŠ½è±¡å’Œå®ç°</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">KingdomFactory</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">Castle</span> <span class="nf">createCastle</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">  <span class="n">King</span> <span class="nf">createKing</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">  <span class="n">Army</span> <span class="nf">createArmy</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ElfKingdomFactory</span> <span class="kd">implements</span> <span class="n">KingdomFactory</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">Castle</span> <span class="nf">createCastle</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">new</span> <span class="n">ElfCastle</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">King</span> <span class="nf">createKing</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">new</span> <span class="n">ElfKing</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">Army</span> <span class="nf">createArmy</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">new</span> <span class="n">ElfArmy</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrcKingdomFactory</span> <span class="kd">implements</span> <span class="n">KingdomFactory</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">Castle</span> <span class="nf">createCastle</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">new</span> <span class="n">OrcCastle</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">King</span> <span class="nf">createKing</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">new</span> <span class="n">OrcKing</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">Army</span> <span class="nf">createArmy</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">new</span> <span class="n">OrcArmy</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ç°åœ¨æˆ‘ä»¬æœ‰äº†æŠ½è±¡å·¥å‚ï¼Œä½¿æˆ‘ä»¬å¯ä»¥åˆ¶ä½œç›¸å…³å¯¹è±¡çš„ç³»åˆ—ï¼Œå³ç²¾çµç‹å›½å·¥å‚åˆ›å»ºäº†ç²¾çµåŸå ¡ï¼Œå›½ç‹å’Œå†›é˜Ÿç­‰ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">KingdomFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ElfKingdomFactory</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">Castle</span> <span class="n">castle</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">createCastle</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">King</span> <span class="n">king</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">createKing</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">Army</span> <span class="n">army</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">createArmy</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">castle</span><span class="o">.</span><span class="na">getDescription</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">king</span><span class="o">.</span><span class="na">getDescription</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">army</span><span class="o">.</span><span class="na">getDescription</span><span class="o">();</span>
</span></span></code></pre></div><p>ç¨‹åºè¾“å‡º:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">This</span> <span class="n">is</span> <span class="n">the</span> <span class="n">Elven</span> <span class="n">castle</span><span class="o">!</span>
</span></span><span class="line"><span class="cl"><span class="n">This</span> <span class="n">is</span> <span class="n">the</span> <span class="n">Elven</span> <span class="n">king</span><span class="o">!</span>
</span></span><span class="line"><span class="cl"><span class="n">This</span> <span class="n">is</span> <span class="n">the</span> <span class="n">Elven</span> <span class="n">Army</span><span class="o">!</span>
</span></span></code></pre></div><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºä¸åŒçš„ç‹å›½å·¥å‚è®¾è®¡å·¥å‚ã€‚ åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†FactoryMakerï¼Œè´Ÿè´£è¿”å›ElfKingdomFactoryæˆ–OrcKingdomFactoryçš„å®ä¾‹ã€‚ å®¢æˆ·å¯ä»¥ä½¿ç”¨FactoryMakeræ¥åˆ›å»ºæ‰€éœ€çš„å…·ä½“å·¥å‚ï¼Œè¯¥å·¥å‚éšåå°†ç”Ÿäº§ä¸åŒçš„å…·ä½“å¯¹è±¡ï¼ˆå†›é˜Ÿï¼Œå›½ç‹ï¼ŒåŸå ¡ï¼‰ã€‚ åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬è¿˜ä½¿ç”¨äº†ä¸€ä¸ªæšä¸¾æ¥å‚æ•°åŒ–å®¢æˆ·è¦æ±‚çš„ç‹å›½å·¥å‚ç±»å‹ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">FactoryMaker</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">enum</span> <span class="n">KingdomType</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ELF</span><span class="o">,</span> <span class="n">ORC</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">KingdomFactory</span> <span class="nf">makeFactory</span><span class="o">(</span><span class="n">KingdomType</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">switch</span> <span class="o">(</span><span class="n">type</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">case</span> <span class="n">ELF</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">ElfKingdomFactory</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">case</span> <span class="n">ORC</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">OrcKingdomFactory</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">default</span> <span class="o">-&gt;</span> <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="s">&#34;KingdomType not supported.&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">};</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@Slf4j</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span><span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="kd">final</span> <span class="n">Kingdom</span> <span class="n">kingdom</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Kingdom</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="n">Kingdom</span> <span class="nf">getKingdom</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">kingdom</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">App</span> <span class="n">app</span> <span class="o">=</span> <span class="k">new</span> <span class="n">App</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;elf kingdom&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">createKingdom</span><span class="o">(</span><span class="n">KingdomType</span><span class="o">.</span><span class="na">ELF</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="n">kingdom</span><span class="o">.</span><span class="na">getArmy</span><span class="o">().</span><span class="na">getDescription</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="n">kingdom</span><span class="o">.</span><span class="na">getCastle</span><span class="o">().</span><span class="na">getDescription</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="n">kingdom</span><span class="o">.</span><span class="na">getKing</span><span class="o">().</span><span class="na">getDescription</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;orc kingdom&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">createKingdom</span><span class="o">(</span><span class="n">KingdomType</span><span class="o">.</span><span class="na">ORC</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="n">kingdom</span><span class="o">.</span><span class="na">getArmy</span><span class="o">().</span><span class="na">getDescription</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="n">kingdom</span><span class="o">.</span><span class="na">getCastle</span><span class="o">().</span><span class="na">getDescription</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="n">LOGGER</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="n">kingdom</span><span class="o">.</span><span class="na">getKing</span><span class="o">().</span><span class="na">getDescription</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h2 id="ç±»å›¾">ç±»å›¾</h2>
<p><img loading="lazy" src="https://java-design-patterns.com/assets/abstract-factory.urm-fe0340de.png" alt="alt text"  />
</p>
<h2 id="ä¼˜ç¼ºç‚¹">ä¼˜ç¼ºç‚¹</h2>
<p>ä¼˜ç‚¹åŒ…æ‹¬ï¼š</p>
<ol>
<li>æŠ½è±¡å·¥å‚æ¨¡å¼èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬åˆ›å»ºå…·æœ‰é«˜å†…èšæ€§çš„å¯¹è±¡å®¶æ—ï¼Œè¿™äº›å¯¹è±¡å®¶æ—ä¹‹é—´ç›¸äº’åä½œï¼Œä»è€Œæ„æˆä¸€ä¸ªå®Œæ•´çš„ç³»ç»Ÿã€‚</li>
<li>æŠ½è±¡å·¥å‚æ¨¡å¼èƒ½å¤Ÿä¿è¯å®¢æˆ·ç«¯ä»£ç ä¸å…·ä½“äº§å“å®ç°ä¹‹é—´çš„è§£è€¦ï¼Œä»è€Œè®©ç³»ç»Ÿæ›´åŠ çµæ´»å’Œå¯æ‰©å±•ã€‚</li>
<li>æŠ½è±¡å·¥å‚æ¨¡å¼èƒ½å¤Ÿéšè—äº§å“çš„å…·ä½“å®ç°ç»†èŠ‚ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ã€‚</li>
</ol>
<p>è€Œç¼ºç‚¹åˆ™åŒ…æ‹¬ï¼š</p>
<ol>
<li>æŠ½è±¡å·¥å‚æ¨¡å¼æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦å®šä¹‰è®¸å¤šæ¥å£å’ŒæŠ½è±¡ç±»ï¼Œè¿™ä¼šå¢åŠ ç³»ç»Ÿçš„å¤æ‚æ€§å’Œå¼€å‘æˆæœ¬ã€‚</li>
<li>å¦‚æœéœ€è¦æ·»åŠ æ–°çš„äº§å“æ—ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¿®æ”¹æŠ½è±¡å·¥å‚æ¥å£ä»¥åŠæ‰€æœ‰çš„å…·ä½“å·¥å‚å®ç°ï¼Œè¿™ä¼šå¸¦æ¥ä¸€å®šçš„é£é™©å’Œä¸ä¾¿ã€‚</li>
<li>æŠ½è±¡å·¥å‚æ¨¡å¼å¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿçš„æ‰©å±•æ€§å—é™ï¼Œå› ä¸ºä¸€æ—¦å®šä¹‰äº†æŠ½è±¡å·¥å‚æ¥å£ï¼Œå°±ä¸èƒ½å¤Ÿè½»æ˜“åœ°ä¿®æ”¹å®ƒã€‚</li>
</ol>
<p>åœ¨ã€ŠEffective Javaã€‹ä¸­ï¼Œä½œè€…è¿˜æåˆ°äº†ä¸€ä¸ªå…³äºæŠ½è±¡å·¥å‚æ¨¡å¼çš„å»ºè®®ï¼šåœ¨è®¾è®¡æŠ½è±¡å·¥å‚æ¥å£æ—¶ï¼Œè¦è€ƒè™‘åˆ°æœªæ¥å¯èƒ½çš„å˜åŒ–ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬é¢„è®¡å°†æ¥å¯èƒ½ä¼šæ·»åŠ æ–°çš„äº§å“æ—ï¼Œé‚£ä¹ˆå°±åº”è¯¥å°½é‡è®¾è®¡ä¸€ä¸ªçµæ´»çš„æŠ½è±¡å·¥å‚æ¥å£ï¼Œä»¥ä¾¿åœ¨ä¸ä¿®æ”¹ç°æœ‰ä»£ç çš„æƒ…å†µä¸‹æ·»åŠ æ–°çš„äº§å“æ—ã€‚</p>
<p>ä¸¾ä¾‹ï¼š<a href="https://www.digitalocean.com/community/tutorials/abstract-factory-design-pattern-in-java">Abstract Factory Design Pattern in Java</a></p>
<p>Computer.javaï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"> <span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Computer</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">abstract</span> <span class="n">String</span> <span class="nf">getRAM</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">abstract</span> <span class="n">String</span> <span class="nf">getHDD</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">abstract</span> <span class="n">String</span> <span class="nf">getCPU</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">     
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;RAM= &#34;</span><span class="o">+</span><span class="k">this</span><span class="o">.</span><span class="na">getRAM</span><span class="o">()+</span><span class="s">&#34;, HDD=&#34;</span><span class="o">+</span><span class="k">this</span><span class="o">.</span><span class="na">getHDD</span><span class="o">()+</span><span class="s">&#34;, CPU=&#34;</span><span class="o">+</span><span class="k">this</span><span class="o">.</span><span class="na">getCPU</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>PC.javaï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PC</span> <span class="kd">extends</span> <span class="n">Computer</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">ram</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">hdd</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">cpu</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">     
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">PC</span><span class="o">(</span><span class="n">String</span> <span class="n">ram</span><span class="o">,</span> <span class="n">String</span> <span class="n">hdd</span><span class="o">,</span> <span class="n">String</span> <span class="n">cpu</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">ram</span><span class="o">=</span><span class="n">ram</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">hdd</span><span class="o">=</span><span class="n">hdd</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">cpu</span><span class="o">=</span><span class="n">cpu</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getRAM</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">ram</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getHDD</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">hdd</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getCPU</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">cpu</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>Server.javaï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Server</span> <span class="kd">extends</span> <span class="n">Computer</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">ram</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">hdd</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">cpu</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">     
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">Server</span><span class="o">(</span><span class="n">String</span> <span class="n">ram</span><span class="o">,</span> <span class="n">String</span> <span class="n">hdd</span><span class="o">,</span> <span class="n">String</span> <span class="n">cpu</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">ram</span><span class="o">=</span><span class="n">ram</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">hdd</span><span class="o">=</span><span class="n">hdd</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">cpu</span><span class="o">=</span><span class="n">cpu</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getRAM</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">ram</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getHDD</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">hdd</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getCPU</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">cpu</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æŠ½è±¡å·¥å‚æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ComputerAbstractFactory</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="n">Computer</span> <span class="nf">createComputer</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PCFactory</span> <span class="kd">implements</span> <span class="n">ComputerAbstractFactory</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="n">String</span> <span class="n">ram</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="n">String</span> <span class="n">hdd</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="n">String</span> <span class="n">cpu</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="nf">PCFactory</span><span class="o">(</span><span class="n">String</span> <span class="n">ram</span><span class="o">,</span> <span class="n">String</span> <span class="n">hdd</span><span class="o">,</span> <span class="n">String</span> <span class="n">cpu</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">		<span class="k">this</span><span class="o">.</span><span class="na">ram</span><span class="o">=</span><span class="n">ram</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">this</span><span class="o">.</span><span class="na">hdd</span><span class="o">=</span><span class="n">hdd</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">this</span><span class="o">.</span><span class="na">cpu</span><span class="o">=</span><span class="n">cpu</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">	<span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="n">Computer</span> <span class="nf">createComputer</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="k">new</span> <span class="n">PC</span><span class="o">(</span><span class="n">ram</span><span class="o">,</span><span class="n">hdd</span><span class="o">,</span><span class="n">cpu</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServerFactory</span> <span class="kd">implements</span> <span class="n">ComputerAbstractFactory</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="n">String</span> <span class="n">ram</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="n">String</span> <span class="n">hdd</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="n">String</span> <span class="n">cpu</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="nf">ServerFactory</span><span class="o">(</span><span class="n">String</span> <span class="n">ram</span><span class="o">,</span> <span class="n">String</span> <span class="n">hdd</span><span class="o">,</span> <span class="n">String</span> <span class="n">cpu</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">		<span class="k">this</span><span class="o">.</span><span class="na">ram</span><span class="o">=</span><span class="n">ram</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">this</span><span class="o">.</span><span class="na">hdd</span><span class="o">=</span><span class="n">hdd</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">this</span><span class="o">.</span><span class="na">cpu</span><span class="o">=</span><span class="n">cpu</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="n">Computer</span> <span class="nf">createComputer</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="k">new</span> <span class="n">Server</span><span class="o">(</span><span class="n">ram</span><span class="o">,</span><span class="n">hdd</span><span class="o">,</span><span class="n">cpu</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>å·¥å‚ç±»ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ComputerFactory</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="kd">static</span> <span class="n">Computer</span> <span class="nf">getComputer</span><span class="o">(</span><span class="n">ComputerAbstractFactory</span> <span class="n">factory</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">factory</span><span class="o">.</span><span class="na">createComputer</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æµ‹è¯•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestDesignPatterns</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">testAbstractFactory</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">testAbstractFactory</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">Computer</span> <span class="n">pc</span> <span class="o">=</span> <span class="n">ComputerFactory</span><span class="o">.</span><span class="na">getComputer</span><span class="o">(</span><span class="k">new</span> <span class="n">PCFactory</span><span class="o">(</span><span class="s">&#34;2 GB&#34;</span><span class="o">,</span><span class="s">&#34;500 GB&#34;</span><span class="o">,</span><span class="s">&#34;2.4 GHz&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">		<span class="n">Computer</span> <span class="n">server</span> <span class="o">=</span> <span class="n">ComputerFactory</span><span class="o">.</span><span class="na">getComputer</span><span class="o">(</span><span class="k">new</span> <span class="n">ServerFactory</span><span class="o">(</span><span class="s">&#34;16 GB&#34;</span><span class="o">,</span><span class="s">&#34;1 TB&#34;</span><span class="o">,</span><span class="s">&#34;2.9 GHz&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;AbstractFactory PC Config::&#34;</span><span class="o">+</span><span class="n">pc</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;AbstractFactory Server Config::&#34;</span><span class="o">+</span><span class="n">server</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>è¾“å‡ºç»“æœï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">AbstractFactory PC Config::RAM<span class="o">=</span> <span class="m">2</span> GB, <span class="nv">HDD</span><span class="o">=</span><span class="m">500</span> GB, <span class="nv">CPU</span><span class="o">=</span>2.4 GHz
</span></span><span class="line"><span class="cl">AbstractFactory Server Config::RAM<span class="o">=</span> <span class="m">16</span> GB, <span class="nv">HDD</span><span class="o">=</span><span class="m">1</span> TB, <span class="nv">CPU</span><span class="o">=</span>2.9 GHz
</span></span></code></pre></div><p>ç±»å›¾ï¼š<img loading="lazy" src="../../../../../../../Downloads/Abstract-Factory-Pattern-ComputerFactory.png" alt="Abstract-Factory-Pattern-ComputerFactory"  />
</p>
<h2 id="é€‚ç”¨æ€§">é€‚ç”¨æ€§</h2>
<p>åœ¨ä»¥ä¸‹æƒ…å†µä¸‹ä½¿ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼</p>
<ul>
<li>è¯¥ç³»ç»Ÿåº”ç‹¬ç«‹äºå…¶äº§å“çš„åˆ›å»ºï¼Œç»„æˆå’Œè¡¨ç¤ºæ–¹å¼</li>
<li>ç³»ç»Ÿåº”é…ç½®æœ‰å¤šä¸ªäº§å“ç³»åˆ—ä¹‹ä¸€</li>
<li>ç›¸å…³äº§å“å¯¹è±¡ç³»åˆ—æ—¨åœ¨ä¸€èµ·ä½¿ç”¨ï¼Œä½ éœ€è¦å¼ºåˆ¶æ‰§è¡Œæ­¤çº¦æŸ</li>
<li>ä½ æƒ³æä¾›äº§å“çš„ç±»åº“ï¼Œå¹¶ä¸”åªæƒ³æš´éœ²å®ƒä»¬çš„æ¥å£ï¼Œè€Œä¸æ˜¯å®ƒä»¬çš„å®ç°ã€‚</li>
<li>ä»æ¦‚å¿µä¸Šè®²ï¼Œä¾èµ–é¡¹çš„ç”Ÿå­˜æœŸæ¯”ä½¿ç”¨è€…çš„ç”Ÿå­˜æœŸçŸ­ã€‚</li>
<li>ä½ éœ€è¦ä¸€ä¸ªè¿è¡Œæ—¶å€¼æ¥æ„å»ºç‰¹å®šçš„ä¾èµ–å…³ç³»</li>
<li>ä½ æƒ³å†³å®šåœ¨è¿è¡Œæ—¶ä»ç³»åˆ—ä¸­è°ƒç”¨å“ªç§äº§å“ã€‚</li>
<li>ä½ éœ€è¦æä¾›ä¸€ä¸ªæˆ–æ›´å¤šä»…åœ¨è¿è¡Œæ—¶æ‰çŸ¥é“çš„å‚æ•°ï¼Œç„¶åæ‰èƒ½è§£å†³ä¾èµ–å…³ç³»ã€‚</li>
<li>å½“ä½ éœ€è¦äº§å“ä¹‹é—´çš„ä¸€è‡´æ€§æ—¶</li>
<li>åœ¨å‘ç¨‹åºæ·»åŠ æ–°äº§å“æˆ–äº§å“ç³»åˆ—æ—¶ï¼Œæ‚¨ä¸æƒ³æ›´æ”¹ç°æœ‰ä»£ç ã€‚</li>
</ul>
<h2 id="ç›¸å…³æ¨¡å¼">ç›¸å…³æ¨¡å¼</h2>
<ul>
<li><a href="https://java-design-patterns.com/patterns/factory-method/">Factory Methodopen</a></li>
<li><a href="https://java-design-patterns.com/patterns/factory-kit/">Factory Kit</a></li>
</ul>
<h2 id="ä½¿ç”¨">ä½¿ç”¨</h2>
<p>jdkä¸­ä»¥ä¸‹ç±»ä½¿ç”¨äº†æŠ½è±¡å·¥å‚æ¨¡å¼ï¼š</p>
<ul>
<li><a href="http://docs.oracle.com/javase/8/docs/api/javax/xml/parsers/DocumentBuilderFactory.html">javax.xml.parsers.DocumentBuilderFactoryopen</a></li>
<li><a href="http://docs.oracle.com/javase/8/docs/api/javax/xml/transform/TransformerFactory.html#newInstance--">javax.xml.transform.TransformerFactoryopen</a></li>
<li><a href="http://docs.oracle.com/javase/8/docs/api/javax/xml/xpath/XPathFactory.html#newInstance--">javax.xml.xpath.XPathFactoryopen</a></li>
</ul>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„å¼€æºæ¡†æ¶å’Œåº“ï¼š</p>
<ol>
<li>Spring Frameworkï¼šSpring Framework æ˜¯ä¸€ä¸ªæµè¡Œçš„ Java åº”ç”¨ç¨‹åºæ¡†æ¶ï¼Œå®ƒä½¿ç”¨äº†æŠ½è±¡å·¥å‚æ¨¡å¼æ¥åˆ›å»ºä¸åŒç±»å‹çš„å¯¹è±¡ï¼Œä¾‹å¦‚æ•°æ®æºã€äº‹åŠ¡ç®¡ç†å™¨å’Œæ¶ˆæ¯é˜Ÿåˆ—ç­‰ã€‚</li>
<li>Hibernate ORMï¼šHibernate ORM æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†å¯¹è±¡å…³ç³»æ˜ å°„ï¼ˆORMï¼‰çš„æ¡†æ¶ï¼Œå®ƒä½¿ç”¨äº†æŠ½è±¡å·¥å‚æ¨¡å¼æ¥åˆ›å»ºæ•°æ®åº“è¿æ¥ã€äº‹åŠ¡ç®¡ç†å™¨å’ŒæŸ¥è¯¢è¯­å¥ç­‰å¯¹è±¡ã€‚</li>
<li>Apache Commonsï¼šApache Commons æ˜¯ä¸€ä¸ªå¼€æºçš„ Java å·¥å…·åº“ï¼Œå®ƒåŒ…å«äº†è®¸å¤šå¸¸ç”¨çš„å·¥å…·ç±»å’Œå‡½æ•°ã€‚å…¶ä¸­ï¼Œä¸€äº›æ¨¡å—ï¼ˆä¾‹å¦‚ Commons Codec å’Œ Commons Poolï¼‰ä½¿ç”¨äº†æŠ½è±¡å·¥å‚æ¨¡å¼æ¥åˆ›å»ºä¸åŒç±»å‹çš„å¯¹è±¡ã€‚</li>
<li>Apache Strutsï¼šApache Struts æ˜¯ä¸€ä¸ªåŸºäº MVCï¼ˆæ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ï¼‰æ¨¡å¼çš„ Web åº”ç”¨ç¨‹åºæ¡†æ¶ï¼Œå®ƒä½¿ç”¨äº†æŠ½è±¡å·¥å‚æ¨¡å¼æ¥åˆ›å»ºä¸åŒç±»å‹çš„ Action ç±»å’Œç»“æœç±»å‹ã€‚</li>
<li>Apache CXFï¼šApache CXF æ˜¯ä¸€ä¸ªç”¨äºæ„å»º Web æœåŠ¡çš„æ¡†æ¶ï¼Œå®ƒä½¿ç”¨äº†æŠ½è±¡å·¥å‚æ¨¡å¼æ¥åˆ›å»ºä¸åŒç±»å‹çš„ Web æœåŠ¡ç«¯ç‚¹å’Œå®¢æˆ·ç«¯ã€‚</li>
<li>Apache Axisï¼šApache Axis æ˜¯ä¸€ä¸ªç”¨äºæ„å»º Web æœåŠ¡çš„æ¡†æ¶ï¼Œå®ƒä½¿ç”¨äº†æŠ½è±¡å·¥å‚æ¨¡å¼æ¥åˆ›å»ºä¸åŒç±»å‹çš„ Web æœåŠ¡ç«¯ç‚¹å’Œå®¢æˆ·ç«¯ã€‚</li>
<li>Apache Log4jï¼šApache Log4j æ˜¯ä¸€ä¸ªæµè¡Œçš„ Java æ—¥å¿—æ¡†æ¶ï¼Œå®ƒä½¿ç”¨äº†æŠ½è±¡å·¥å‚æ¨¡å¼æ¥åˆ›å»ºä¸åŒç±»å‹çš„æ—¥å¿—è®°å½•å™¨å’Œ Appenderï¼ˆæ—¥å¿—è¾“å‡ºå™¨ï¼‰ã€‚</li>
<li>Apache Commons Configurationï¼šApache Commons Configuration æ˜¯ä¸€ä¸ªç”¨äºè¯»å–å’Œå†™å…¥é…ç½®æ–‡ä»¶çš„åº“ï¼Œå®ƒä½¿ç”¨äº†æŠ½è±¡å·¥å‚æ¨¡å¼æ¥åˆ›å»ºä¸åŒç±»å‹çš„é…ç½®å¯¹è±¡ï¼Œä¾‹å¦‚ XMLConfiguration å’Œ PropertiesConfiguration ç­‰ã€‚</li>
</ol>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè®¸å¤šå…¶ä»–çš„å¼€æºæ¡†æ¶å’Œåº“ä¹Ÿä½¿ç”¨äº†æŠ½è±¡å·¥å‚æ¨¡å¼ï¼Œä¾‹å¦‚ Hibernateã€MyBatisã€JDBCã€JPAã€JUnit ç­‰ã€‚è¿™äº›æ¡†æ¶å’Œåº“ä½¿ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼çš„åŸå› æ˜¯å®ƒèƒ½å¤Ÿå¸®åŠ©åˆ›å»ºå…·æœ‰é«˜å†…èšæ€§çš„å¯¹è±¡å®¶æ—ï¼Œå¹¶ä¸”èƒ½å¤Ÿä¿è¯å®¢æˆ·ç«¯ä»£ç ä¸å…·ä½“äº§å“å®ç°ä¹‹é—´çš„è§£è€¦ã€‚åŒæ—¶ï¼ŒæŠ½è±¡å·¥å‚æ¨¡å¼ä¹Ÿèƒ½å¤Ÿéšè—äº§å“çš„å…·ä½“å®ç°ç»†èŠ‚ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„å®‰å…¨æ€§å’Œç¨³å®šæ€§ã€‚è¿™äº›ä¼˜ç‚¹è®©æŠ½è±¡å·¥å‚æ¨¡å¼æˆä¸ºäº†è¿™äº›æ¡†æ¶å’Œåº“ä¸­å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>å‘¨æŠ¥-19ï½œæ­¦åŠŸå±±çœ‹æ—¥å‡ºã€Pythonåˆå­¦å»ºè®®</title>
      <link>https://blog.chensoul.com/posts/2023/05/18/weekly_review_19/</link>
      <pubDate>Thu, 18 May 2023 18:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/05/18/weekly_review_19/</guid>
      <description>å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-05-08 åˆ° 2023-05-14 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚ æœ¬å‘¨ç»§ç»­å­¦ä¹  pythonï¼Œå‘ç°ä¸€ä¸ªè´¨é‡éå¸¸é«˜çš„ python</description>
      <content:encoded><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-19-00.png" alt="weekly-review-19-00"  />
</p>
<p>æœ¬ç¯‡æ˜¯å¯¹ <code>2023-05-08</code> åˆ° <code>2023-05-14</code> è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº <a href="https://blog.chensoul.com/">åšå®¢</a>ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚</p>
<p>æœ¬å‘¨ç»§ç»­å­¦ä¹  pythonï¼Œå‘ç°ä¸€ä¸ªè´¨é‡éå¸¸é«˜çš„ python å­¦ä¹ ç½‘ç«™ <a href="https://realpython.com/">Real Python</a>ï¼Œè¯¥ç½‘ç«™æœ‰å­¦ä¹  python çš„ä¸€äº›æ•™ç¨‹ï¼Œæ˜¯æ”¶è´¹çš„ï¼Œéƒ¨åˆ†ç« èŠ‚æ˜¯å¯ä»¥å…è´¹è§‚çœ‹çš„ã€‚</p>
<p>å¦å¤–ï¼Œå‘¨äº”æ™šä¸Šè€å©†ä¸´æ—¶èµ·æ„æƒ³å»æ­¦åŠŸå±±çœ‹æ—¥å‡ºï¼Œäºæ˜¯ç«‹å³è§„åˆ’è¡Œç¨‹å¹¶è´­ä¹°ç«è½¦ç¥¨ã€‚å› ä¸ºä¸€å¹´åŠä¹‹å‰ï¼Œæˆ‘å»è¿‡ä¸€æ¬¡ï¼Œæ‰€ä»¥è§„åˆ’èµ·æ¥è¿˜æ˜¯å¾ˆè½»æ¾çš„ã€‚ä¸Šä¸€æ¬¡å»æ˜¯å›½åº†èŠ‚ç¢°åˆ°ä¸‹é›¨ï¼Œæ²¡æœ‰çœ‹åˆ°æ—¥å‡ºã€‚å¹¸è¿çš„æ˜¯ï¼Œè¿™æ¬¡æ˜¯æ™´å¤©ï¼Œä¸ä»…çœ‹åˆ°äº†æ—¥è½è¿˜çœ‹åˆ°äº†æ—¥å‡ºã€‚è¿™ä¸€æ¬¡æ²¡æœ‰é€‰æ‹©ä½å¸ç¯·ï¼Œè€Œæ˜¯ä½åœ¨äº†äº‘ä¸­é›¾å®¢æ ˆï¼Œæ²¡æƒ³åˆ°è¿™ä¸ªå®¢æ ˆç¦»é‡‘é¡¶éœ€è¦40åˆ†é’Ÿå·¦å³çš„è·¯ç¨‹ï¼Œè€Œä¸”æœ‰æ®µè·¯ç¨‹æ˜¯å‘å‘æ´¼æ´¼ã€‚</p>
<p>å»æ­¦åŠŸå±±ä¹‹å‰ï¼Œå…ˆå»äº†é•¿æ²™ï¼Œå†æ¬¡æ¸¸äº†æ©˜å­æ´²å¤´ï¼Œå¹¶ç¬¬ä¸€æ¬¡åœ¨é•¿æ²™è·‘æ­¥æ‰“å¡ã€‚æœ¬æƒ³åœ¨èä¹¡ä¹Ÿè·‘æ­¥æ‰“å¡ï¼Œå¥ˆä½•æ²¡æœ‰å¾—é€ã€‚</p>
<p>è¿™æ¬¡å»äº†é•¿æ²™å’Œæ­¦åŠŸå±±ï¼Œä¸‹æ¬¡åŸºæœ¬ä¸Šæ˜¯å†ä¹Ÿä¸ä¼šå»çˆ¬æ­¦åŠŸå±±äº†ã€‚é•¿æ²™è¿˜ä¼šå»ï¼Œå› ä¸ºä»æ­¦åŠŸå±±å›æ¥è·¯ä¸Šï¼Œå°±å’Œè€å©†è§„åˆ’ç€ä»€ä¹ˆæ—¶å€™å»å¼ å®¶ç•Œã€‚</p>
<h2 id="æ­¦åŠŸå±±çœ‹æ—¥å‡º">æ­¦åŠŸå±±çœ‹æ—¥å‡º</h2>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-19-01.png" alt="weekly-review-19-01"  />
</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-19-02.png" alt="weekly-review-19-02"  />
</p>
<h2 id="ç†è´¢">ç†è´¢</h2>
<p>è¿™å‘¨æ€»è®¡æ”¯å‡º 1784 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š</p>
<ul>
<li>5æœˆ8æ—¥ï¼š12å…ƒ</li>
<li>5æœˆ9æ—¥ï¼š18å…ƒ</li>
<li>5æœˆ10æ—¥ï¼š200å…ƒ</li>
<li>5æœˆ11æ—¥ï¼š12å…ƒ</li>
<li>5æœˆ12æ—¥ï¼š445å…ƒ</li>
<li>5æœˆ13æ—¥ï¼š662å…ƒ</li>
<li>5æœˆ14æ—¥ï¼š435å…ƒ</li>
</ul>
<p>å› ä¸ºå‘¨æœ«å‡ºå»æ—…æ¸¸ï¼Œæ‰€ä»¥æœ¬å‘¨æ”¯å‡ºæœ‰æ‰€å¢å¤šã€‚</p>
<h2 id="å¥èº«">å¥èº«</h2>
<p>æœ¬å‘¨è·‘æ­¥ 56 å…¬é‡Œï¼Œæœ€é•¿è·‘æ­¥è·ç¦»ä¸º 13 å…¬é‡Œã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-19-05.png" alt="weekly-review-19-05"  />
</p>
<p>æ˜ç»†æ•°æ®å¦‚ä¸‹ï¼š</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-19-04.png" alt="weekly-review-19-04"  />
</p>
<p>å‘¨æœ«å‡ºå»æ—…æ¸¸ï¼Œè·¯è¿‡é•¿æ²™ï¼Œåœ¨é•¿æ²™è·‘äº†ä¸¤å¤©ï¼Œç´¯è®¡è·‘äº†6å…¬é‡Œã€‚è¿™æ ·ï¼Œæˆ‘çš„<a href="https://run.chensoul.com/">è·‘æ­¥æ•°æ®</a> ä» <code>2 å¹´é‡Œæˆ‘è·‘è¿‡ 1 ä¸ªçœä»½ 1 ä¸ªåŸå¸‚</code> å˜æˆäº†<code> 2 å¹´é‡Œæˆ‘è·‘è¿‡ 2 ä¸ªçœä»½ 2 ä¸ªåŸå¸‚</code>ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-19-03.png" alt="."  />
</p>
<h2 id="å·¥ä½œ">å·¥ä½œ</h2>
<h3 id="java">Java</h3>
<h4 id="åšå®¢">åšå®¢</h4>
<p>æœ¬å‘¨å®Œæˆä¸¤ç¯‡åšå®¢</p>
<ul>
<li><a href="/posts/2023/05/17/obey-the-general-contract-when-overriding-equals/">ã€ŠEffective Java 3ã€‹ç¬”è®°10ï¼šè¦†ç›–equalsæ–¹æ³•æ—¶åº”éµå®ˆçš„çº¦å®š</a></li>
<li><a href="/posts/2023/05/18/jsr-166/">JSR 166è§„èŒƒ</a></li>
</ul>
<h3 id="python">Python</h3>
<h4 id="pythonåˆå­¦å»ºè®®">Pythonåˆå­¦å»ºè®®</h4>
<p><strong>1ã€æ–°æ‰‹å¦‚ä½•å­¦ä¹  pythonï¼Ÿ</strong></p>
<p>æ¨èå‡ ç¯‡æ–‡ç« ï¼š</p>
<ul>
<li>
<p><a href="http://cpython.org/">cPython - ç»™å¤§å­¦ç”Ÿçš„å…¥é—¨æ•™ç¨‹</a></p>
</li>
<li>
<p><a href="https://www.kawabangga.com/how-to-learn-python">å¦‚ä½•å­¦Pythonï¼Ÿ</a></p>
</li>
</ul>
<p><strong>2ã€å­¦ä¹  python ç¼–ç¨‹çš„11ä¸ªå»ºè®®</strong></p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-19-06.webp" alt="weekly-review-19-06"  />
</p>
<p>åŸæ–‡ï¼š<a href="https://realpython.com/python-beginner-tips/">11 Beginner Tips for Learning Python Programming</a>ï¼Œæ€»ç»“å‡ºä»¥ä¸‹11æ¡æ–°æ‰‹ç¼–ç¨‹å»ºè®®ï¼š</p>
<ul>
<li>æç¤º #1ï¼šæ¯å¤©ç¼–å†™ä»£ç </li>
<li>æç¤º#2ï¼šå†™å‡ºæ¥</li>
<li>æç¤º#3ï¼šäº’åŠ¨</li>
<li>æç¤º#4ï¼šä¼‘æ¯</li>
<li>æç¤º#5ï¼šæˆä¸ºæ¼æ´èµé‡‘çŒäºº</li>
<li>æç¤º#6ï¼šä¸æ­£åœ¨å­¦ä¹ çš„å…¶ä»–äººåœ¨ä¸€èµ·</li>
<li>æŠ€å·§#7ï¼šæ•™å¯¼</li>
<li>æŠ€å·§#8ï¼šç»“å¯¹ç¼–ç¨‹</li>
<li>æç¤º#9ï¼šæå‡ºâ€œå¥½çš„â€é—®é¢˜</li>
<li>æŠ€å·§#10ï¼šæ„å»ºä¸€äº›ä¸œè¥¿</li>
<li>æŠ€å·§#11ï¼šä¸ºå¼€æºåšè´¡çŒ®</li>
</ul>
<p><strong>3ã€Pyhtonæ’­å®¢ï¼š</strong> <a href="https://pythonhunter.org/episodes/1">Ep 01. æ–°äººåˆ°åº•éœ€è¦ä»€ä¹ˆ</a></p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-19-07.png" alt="weekly-review-19-07"  />
</p>
<p>æ’­å®¢ä¸­æåˆ°çš„å†…å®¹ï¼š</p>
<ul>
<li><a href="https://www.youtube.com/channel/UC4xKdmAXFh4ACyhpiQ_3qBw">Tech lead</a></li>
<li><a href="https://github.com/encode/starlette">starlette</a></li>
<li><a href="https://rhettinger.wordpress.com/2011/05/26/super-considered-super/">Pythonâ€™s super() considered super!</a></li>
<li><a href="https://github.com/coleifer/huey">huey</a></li>
<li><a href="https://github.com/agronholm/apscheduler">apscheduler</a></li>
<li><a href="https://www.youtube.com/watch?v=Aj3KMefwOqI">Python 3: ten years later - PyCon 2018</a></li>
<li><a href="https://www.youtube.com/watch?v=MCs5OvhV9S4">David Beazley - Python Concurrency From the Ground Up: LIVE! - PyCon 2015</a></li>
<li><a href="https://github.com/uber/pyflame">pyflame</a></li>
<li><a href="https://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way/blob/master/README-zh_CN.md">æé—®çš„æ™ºæ…§</a></li>
<li><a href="http://xyproblem.info/">XYé—®é¢˜</a></li>
<li><a href="https://docs.python.org/3/library/logging.html">Python Logger</a></li>
<li><a href="https://docs.python.org/3/library/pdb.html">pdb</a></li>
<li><a href="https://www.jetbrains.com/pycharm/">PyCharm</a></li>
<li><a href="https://jupyter.org/">Jupyter notebook</a></li>
<li><a href="http://www.letmegooglethat.com/">Let me google that</a>, <a href="https://lmgtfy.com/">let me google that for you</a></li>
<li><a href="https://www.zhihu.com/question/27871198">å­¦ä¹ æ“ä½œç³»ç»Ÿçš„çŸ¥è¯†ï¼Œçœ‹å“ªæœ¬ä¹¦å¥½ï¼Ÿ</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/27288770">PHPé»‘ç³»åˆ—ä¹‹äºŒï¼šPHP ä¸ºä»€ä¹ˆå‡½æ•°å‘½åæ˜¯å¦‚æ­¤ä¸ä¸€è‡´ï¼Ÿ</a></li>
<li><a href="https://en.wikipedia.org/wiki/Scheme_(programming_language)">Scheme</a></li>
<li><a href="https://7chan.org/pr/src/The_Little_Schemer_4th_2.pdf">The Little Schemer</a></li>
<li><a href="https://en.wikipedia.org/wiki/Structure_and_Interpretation_of_Computer_Programs">SICP</a></li>
<li><a href="https://cs61a.org/">CS 61A: Structure and Interpretation of Computer Programs</a></li>
</ul>
<h4 id="python--tips">Python  Tips</h4>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-19-08.png" alt="weekly-review-19-08"  />
</p>
<p>æœ¬å‘¨è®¢é˜…äº† <a href="https://realpython.com/"><strong>Real Python</strong></a> çš„ Python Tricksï¼Œæ”¶åˆ°ä¸¤å°é‚®ä»¶ï¼Œåˆ†äº«å¦‚ä¸‹ï¼š</p>
<p><strong>1ã€å¦‚ä½•ä¸€è¡Œä»£ç åˆå¹¶ä¸¤ä¸ªå­—å…¸</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># How to merge two dictionaries</span>
</span></span><span class="line"><span class="cl"><span class="c1"># in Python 3.5+</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">y</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">z</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">y</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">z</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># In Python 2.x you could</span>
</span></span><span class="line"><span class="cl"><span class="c1"># use this:</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">z</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;&gt;&gt;</span> <span class="n">z</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># In these examples, Python merges dictionary keys</span>
</span></span><span class="line"><span class="cl"><span class="c1"># in the order listed in the expression, overwriting </span>
</span></span><span class="line"><span class="cl"><span class="c1"># duplicates from left to right.</span>
</span></span><span class="line"><span class="cl"><span class="c1">#</span>
</span></span><span class="line"><span class="cl"><span class="c1"># See: https://www.youtube.com/watch?v=Duexw08KaC8</span>
</span></span></code></pre></div><blockquote>
<p><strong>è¯´æ˜ï¼š</strong></p>
<p>è¿™æ®µä»£ç ç”¨äºå°†ä¸¤ä¸ªå­—å…¸ <code>x</code> å’Œ <code>y</code> åˆå¹¶æˆä¸€ä¸ªæ–°å­—å…¸ <code>z</code>ï¼Œå…¶ä¸­ <code>**</code> æ˜¯ Python ä¸­çš„è§£åŒ…è¿ç®—ç¬¦ï¼Œå¯ä»¥å°†ä¸€ä¸ªå­—å…¸æ‹†åˆ†æˆå¤šä¸ªé”®å€¼å¯¹ï¼Œç„¶åå°†è¿™äº›é”®å€¼å¯¹ä½œä¸ºå‚æ•°ä¼ é€’ç»™ä¸€ä¸ªå‡½æ•°æˆ–ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„å­—å…¸ã€‚</p>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>{**x, **y}</code> è¡¨ç¤ºå°†å­—å…¸ <code>x</code> å’Œ <code>y</code> æ‹†åˆ†æˆå¤šä¸ªé”®å€¼å¯¹ï¼Œç„¶åå°†è¿™äº›é”®å€¼å¯¹åˆå¹¶æˆä¸€ä¸ªæ–°å­—å…¸ã€‚ç”±äºå­—å…¸ <code>y</code> ä¸­çš„é”® <code>b</code> ä¸å­—å…¸ <code>x</code> ä¸­çš„é”® <code>b</code> ç›¸åŒï¼Œå› æ­¤åœ¨åˆå¹¶åçš„å­—å…¸ä¸­ï¼Œé”® <code>b</code> å¯¹åº”çš„å€¼å°†è¢«æ›´æ–°ä¸ºå­—å…¸ <code>y</code> ä¸­çš„å€¼ï¼ˆå³ <code>3</code>ï¼‰ã€‚</p>
</blockquote>
<p>é™¤äº†ä¸Šé¢çš„æ–¹æ³•ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ <code>update()</code> æ–¹æ³•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">y</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="n">z</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">z</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</span></span></code></pre></div><blockquote>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œé¦–å…ˆå°†å­—å…¸ <code>x</code> å¤åˆ¶ä¸€ä»½åˆ° <code>z</code> ä¸­ï¼Œç„¶åä½¿ç”¨ <code>update()</code> æ–¹æ³•å°†å­—å…¸ <code>y</code> åˆå¹¶åˆ° <code>z</code> ä¸­ã€‚å¦‚æœå­—å…¸ <code>y</code> ä¸­çš„é”®åœ¨å­—å…¸ <code>x</code> ä¸­å·²ç»å­˜åœ¨ï¼Œåˆ™ä¼šä½¿ç”¨å­—å…¸ <code>y</code> ä¸­çš„å€¼æ¥æ›´æ–°å­—å…¸ <code>z</code> ä¸­çš„å€¼ã€‚æœ€ç»ˆå¾—åˆ°ä¸€ä¸ªæ–°å­—å…¸ <code>z</code>ï¼Œå®ƒåŒ…å«äº†å­—å…¸ <code>x</code> å’Œ <code>y</code> ä¸­çš„æ‰€æœ‰é”®å€¼å¯¹ã€‚</p>
</blockquote>
<p><strong>2ã€åœ¨ Python ä¸­ä¸€æ¬¡æµ‹è¯•å¤šä¸ªæ ‡å¿—çš„ä¸åŒæ–¹æ³•</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Different ways to test multiple</span>
</span></span><span class="line"><span class="cl"><span class="c1"># flags at once in Python</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">z</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;passed&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="mi">1</span> <span class="ow">in</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;passed&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># These only test for truthiness:</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">x</span> <span class="ow">or</span> <span class="n">y</span> <span class="ow">or</span> <span class="n">z</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;passed&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nb">any</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;passed&#39;</span><span class="p">)</span>
</span></span></code></pre></div><p>é™¤äº†å‰é¢æåˆ°çš„å››ç§æ–¹æ³•å¤–ï¼Œè¿˜æœ‰å…¶ä»–å‡ ç§æ–¹å¼æ¥æµ‹è¯•å¤šä¸ªå˜é‡æ˜¯å¦è‡³å°‘æœ‰ä¸€ä¸ªç­‰äºæŸä¸ªå€¼ï¼š</p>
<ol>
<li><strong>ä½¿ç”¨åˆ—è¡¨è§£æå¼</strong></li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)]):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;passed&#39;</span><span class="p">)</span>
</span></span></code></pre></div><blockquote>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä½¿ç”¨åˆ—è¡¨è§£æå¼ç”Ÿæˆä¸€ä¸ªæ–°åˆ—è¡¨ï¼Œå…¶ä¸­åŒ…å«å˜é‡ <code>x</code>ã€<code>y</code>ã€<code>z</code> ä¸­æ¯ä¸ªå˜é‡æ˜¯å¦ç­‰äº 1 çš„å¸ƒå°”å€¼ã€‚ç„¶åï¼Œä½¿ç”¨ <code>any()</code> å‡½æ•°æ¥æµ‹è¯•æ–°åˆ—è¡¨ä¸­æ˜¯å¦å­˜åœ¨è‡³å°‘ä¸€ä¸ªä¸ºçœŸçš„å…ƒç´ ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™æ¡ä»¶ä¸ºçœŸï¼Œæ‰§è¡Œ <code>print()</code> è¯­å¥ã€‚</p>
</blockquote>
<ol start="2">
<li><strong>ä½¿ç”¨ <code>sum()</code> å‡½æ•°</strong></li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nb">sum</span><span class="p">((</span><span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;passed&#39;</span><span class="p">)</span>
</span></span></code></pre></div><blockquote>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼ç”Ÿæˆä¸€ä¸ªæ–°çš„è¿­ä»£å™¨å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«å˜é‡ <code>x</code>ã€<code>y</code>ã€<code>z</code> ä¸­æ¯ä¸ªå˜é‡æ˜¯å¦ç­‰äº 1 çš„å¸ƒå°”å€¼ã€‚ç„¶åï¼Œå°†è¿­ä»£å™¨å¯¹è±¡ä¼ é€’ç»™ <code>sum()</code> å‡½æ•°ï¼Œå®ƒä¼šå°†æ‰€æœ‰ä¸ºçœŸçš„å…ƒç´ åŠ èµ·æ¥å¹¶è¿”å›ä¸€ä¸ªæ•´æ•°ã€‚å¦‚æœè¿”å›çš„æ•´æ•°å¤§äº 0ï¼Œåˆ™æ¡ä»¶ä¸ºçœŸï¼Œæ‰§è¡Œ <code>print()</code> è¯­å¥ã€‚</p>
</blockquote>
<ol start="3">
<li><strong>ä½¿ç”¨ <code>map()</code> å‡½æ•°å’Œ <code>any()</code> å‡½æ•°</strong></li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;passed&#39;</span><span class="p">)</span>
</span></span></code></pre></div><blockquote>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä½¿ç”¨ <code>map()</code> å‡½æ•°å°†ä¸€ä¸ªåŒ¿åå‡½æ•° <code>lambda i: i == 1</code> åº”ç”¨äºå˜é‡ <code>x</code>ã€<code>y</code>ã€<code>z</code> ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå®ƒä¼šå°†æ¯ä¸ªå…ƒç´ ä¸ 1 è¿›è¡Œæ¯”è¾ƒå¹¶è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚ç„¶åï¼Œä½¿ç”¨ <code>any()</code> å‡½æ•°æ¥æµ‹è¯•è¿”å›çš„å¸ƒå°”å€¼åºåˆ—ä¸­æ˜¯å¦å­˜åœ¨è‡³å°‘ä¸€ä¸ªä¸ºçœŸçš„å…ƒç´ ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™æ¡ä»¶ä¸ºçœŸï¼Œæ‰§è¡Œ <code>print()</code> è¯­å¥ã€‚</p>
</blockquote>
<ol start="4">
<li><strong>ä½¿ç”¨ <code>reduce()</code> æ–¹æ³•</strong></li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">reduce</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="ow">or</span> <span class="n">b</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">))):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;passed&#39;</span><span class="p">)</span>
</span></span></code></pre></div><blockquote>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä½¿ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼ç”Ÿæˆä¸€ä¸ªæ–°çš„è¿­ä»£å™¨å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«å˜é‡ <code>x</code>ã€<code>y</code>ã€<code>z</code> ä¸­æ¯ä¸ªå˜é‡æ˜¯å¦ç­‰äº 1 çš„å¸ƒå°”å€¼ã€‚ç„¶åï¼Œä½¿ç”¨ <code>reduce()</code> å‡½æ•°å°†ä¸€ä¸ªåŒ¿åå‡½æ•° <code>lambda a, b: a or b</code> åº”ç”¨äºè¿­ä»£å™¨å¯¹è±¡ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œå®ƒä¼šå°†æ‰€æœ‰å…ƒç´ æŒ‰ç…§å¸ƒå°”é€»è¾‘ <code>or</code> è¿›è¡Œèšåˆï¼Œå¹¶è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚å¦‚æœè¿”å›çš„å¸ƒå°”å€¼ä¸ºçœŸï¼Œåˆ™æ¡ä»¶ä¸ºçœŸï¼Œæ‰§è¡Œ <code>print()</code> è¯­å¥ã€‚</p>
</blockquote>
<h2 id="æœ¬å‘¨åˆ†äº«">æœ¬å‘¨åˆ†äº«</h2>
<p>å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€<a href="https://t.me/chensoul_share">ChenSoul Share</a>ã€Telegram é¢‘é“æˆ–è€…æˆ‘çš„ <a href="https://memos.chensoul.com/">memos</a> ä¸­ã€‚æˆ‘å†™äº†ä¸€ä¸ª python è„šæœ¬ä» memosè¯»å–æœ€è¿‘ä¸€å‘¨çš„ memos è®°å½•ã€‚</p>
<ul>
<li><strong>2023-05-10</strong> ä¸€äº›éå¸¸æœ‰è¶£çš„pythonçˆ¬è™«ä¾‹å­,å¯¹æ–°æ‰‹æ¯”è¾ƒå‹å¥½,ä¸»è¦çˆ¬å–æ·˜å®ã€å¤©çŒ«ã€å¾®ä¿¡ã€å¾®ä¿¡è¯»ä¹¦ã€è±†ç“£ã€QQç­‰ç½‘ç«™ã€‚<a href="https://github.com/shengqiangzhang/examples-of-web-crawlers">æŸ¥çœ‹é“¾æ¥</a>  <code>#memos</code> <code>#python</code> <code>#tool</code></li>
<li><strong>2023-05-08</strong> è¿™ä¸ªç½‘ç«™æ•´ç†äº†å¼€å‘è€…çš„å­¦ä¹ æˆé•¿è·¯çº¿å›¾ï¼Œæœ‰æ¯”è¾ƒè¯¦ç»†çš„æŠ€èƒ½æ ‘ï¼Œæ¨èå­¦ä¹ å†…å®¹ç­‰ç­‰ï¼Œåå‘å¼€å‘è€…ã€‚ <a href="https://roadmap.sh/python">æŸ¥çœ‹é“¾æ¥</a>  <code>#memos</code> <code>#tool</code></li>
</ul>
<p>ä»¥ä¸Šã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>JSR 166è§„èŒƒ</title>
      <link>https://blog.chensoul.com/posts/2023/05/18/jsr-166/</link>
      <pubDate>Thu, 18 May 2023 16:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/05/18/jsr-166/</guid>
      <description>JSR ä»‹ç» JSRï¼Œå…¨ç§° Java Specification Requestsï¼Œ å³Javaè§„èŒƒææ¡ˆï¼Œ ä¸»è¦æ˜¯ç”¨äºå‘ JCP(Java Community Process) æå‡ºæ–°å¢æ ‡å‡†åŒ–æŠ€æœ¯è§„èŒƒçš„æ­£å¼è¯·æ±‚ã€‚æ¯æ¬¡ JAVA ç‰ˆæœ¬æ›´æ–°éƒ½ä¼šæœ‰å¯¹åº”çš„ JSR</description>
      <content:encoded><![CDATA[<h2 id="jsr-ä»‹ç»">JSR ä»‹ç»</h2>
<p>JSRï¼Œå…¨ç§° Java Specification Requestsï¼Œ å³Javaè§„èŒƒææ¡ˆï¼Œ ä¸»è¦æ˜¯ç”¨äºå‘ JCP(Java Community Process) æå‡ºæ–°å¢æ ‡å‡†åŒ–æŠ€æœ¯è§„èŒƒçš„æ­£å¼è¯·æ±‚ã€‚æ¯æ¬¡ JAVA ç‰ˆæœ¬æ›´æ–°éƒ½ä¼šæœ‰å¯¹åº”çš„ JSR æ›´æ–°ï¼Œæ¯”å¦‚åœ¨ Java 8 ç‰ˆæœ¬ä¸­ï¼Œå…¶æ–°ç‰¹æ€§ Lambda è¡¨è¾¾å¼å¯¹åº”çš„æ˜¯ <a href="http://jcp.org/en/jsr/detail?id=335">JSR 335</a>ï¼Œæ–°çš„æ—¥æœŸå’Œæ—¶é—´APIå¯¹åº”çš„æ˜¯ <a href="http://jcp.org/en/jsr/detail?id=310">JSR 310</a>ã€‚</p>
<p><a href="https://jcp.org/en/jsr/detail?id=166">JSR 166</a> æ˜¯ Doug Lea æå‡ºçš„ä¸€ä¸ªå…³äº Java å¹¶å‘ç¼–ç¨‹çš„è§„èŒƒææ¡ˆã€‚JDK1.5 ä¹‹å‰ï¼Œæˆ‘ä»¬æ§åˆ¶ç¨‹åºå¹¶å‘è®¿é—®åŒæ­¥ä»£ç åªèƒ½ä½¿ç”¨ synchronizedï¼Œé‚£ä¸ªæ—¶å€™ synchronized çš„æ€§èƒ½è¿˜æ²¡ä¼˜åŒ–å¥½ï¼Œæ€§èƒ½å¹¶ä¸å¥½ï¼Œæ§åˆ¶çº¿ç¨‹ä¹Ÿåªèƒ½ä½¿ç”¨ Object çš„ wait å’Œ notify æ–¹æ³•ã€‚è¿™ä¸ªæ—¶å€™ Doug Lea ç»™ JCP æäº¤äº† JSR-166 çš„ææ¡ˆï¼Œåœ¨æäº¤ JSR-166 ä¹‹å‰ï¼ŒDoug Lea å·²ç»ä½¿ç”¨äº†ç±»ä¼¼ J.U.C åŒ…åŠŸèƒ½çš„ä»£ç å·²ç»ä¸‰å¹´å¤šäº†ï¼Œè¿™äº›ä»£ç å°±æ˜¯ J.U.C çš„åŸå‹ã€‚</p>
<p>J.U.Cï¼Œå³ <code>java.util.concurrent</code> çš„ç¼©å†™ï¼Œè¯¥åŒ…å‚è€ƒè‡ªEDU.oswego.cs.dl.util.concurrentï¼Œæ˜¯JSR 166æ ‡å‡†è§„èŒƒçš„ä¸€ä¸ªå®ç°ã€‚</p>
<ul>
<li>Doug Lea ä¸»é¡µï¼š<a href="https://gee.cs.oswego.edu/">Doug Lea&rsquo;s Home Page</a></li>
<li>JSR-166ï¼š<a href="https://gee.cs.oswego.edu/dl/concurrency-interest/index.html">Concurrency JSR-166 Interest Site</a></li>
<li>JSR 166 Sliderï¼š<a href="https://gee.cs.oswego.edu/dl/concurrency-interest/jsr166-slides.pdf">JSR-166: Concurrency Utilities</a></li>
<li>java.util.concurrent JavaDoc: <a href="https://docs.oracle.com/javase/1.5.0/docs/api/java/util/concurrent/package-summary.html">JDK 1.5 </a>ã€ <a href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/package-summary.html">JDK 7 </a>ã€ <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/package-summary.html">JDK 8 </a>ã€ <a href="https://docs.oracle.com/javase/9/docs/api/java/util/concurrent/package-summary.html">JDK 9 </a></li>
</ul>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/jsr-166-concurrency-utilities.png" alt="jsr-166-concurrency-utilities"  />
</p>
<p>JSR-166 åŒ…æ‹¬å¤šä¸ªè§„èŒƒï¼Œæ¯ä¸ªè§„èŒƒéƒ½å¼•å…¥äº†ä¸€äº›æ–°çš„æ¥å£å’Œç±»ï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†æè¿°ï¼š</p>
<ol>
<li><code>JSR-166ï¼ˆJava SE 5ï¼‰</code>ï¼šå®šä¹‰äº†Javaå¹¶å‘åŒ…çš„æ ¸å¿ƒæ¥å£å’Œç±»ï¼ŒåŒ…æ‹¬ Executors æ¡†æ¶ã€Queuesã€Timingã€Synchronizersã€Concurrent Collectionsã€Memory Consistency Propertiesã€Atomicã€Locks ç­‰ã€‚è¿™äº›æ¥å£å’Œç±»æä¾›äº†ä¸€ç§æ–¹ä¾¿ã€é«˜æ•ˆã€å¯æ‰©å±•çš„æ–¹å¼æ¥å¤„ç†å¼‚æ­¥ä»»åŠ¡å’Œå¹¶å‘ç¼–ç¨‹ã€‚</li>
<li><code>JSR-166xï¼ˆJava SE 7ï¼‰</code>ï¼šå®šä¹‰äº†Javaå¹¶å‘åŒ…ä¸­çš„ä¸€äº›æ–°ç‰¹æ€§ï¼ŒåŒ…æ‹¬ Phaserã€TransferQueueã€Exchangerã€LinkedTransferQueue ç­‰æ¥å£å’Œç±»ã€‚å…¶ä¸­ Phaser æ”¯æŒåˆ†é˜¶æ®µæ‰§è¡Œä»»åŠ¡ï¼ŒTransferQueue å’Œ LinkedTransferQueue å®ç°äº†é«˜æ•ˆçš„ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼ŒExchanger æ”¯æŒä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´äº¤æ¢æ•°æ®ã€‚</li>
<li><code>JSR-166yï¼ˆJava SE 8ï¼‰</code>ï¼šå®šä¹‰äº†Javaå¹¶å‘åŒ…ä¸­çš„ä¸€äº›æ–°ç‰¹æ€§ï¼ŒåŒ…æ‹¬ StampedLockã€CompletableFutureã€LongAdder ç­‰æ¥å£å’Œç±»ã€‚å…¶ä¸­ StampedLock æ˜¯ä¸€ç§ä¹è§‚é”ï¼Œæ”¯æŒè¯»å†™åˆ†ç¦»ï¼ŒCompletableFuture æ”¯æŒå¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå’Œç»“æœå¤„ç†ï¼ŒLongAdder æ˜¯ä¸€ç§é«˜æ•ˆçš„è®¡æ•°å™¨ã€‚</li>
<li><code>JSR-166zï¼ˆJava SE 9ï¼‰</code>ï¼šå®šä¹‰äº† Java å¹¶å‘åŒ…ä¸­çš„ä¸€äº›æ–°ç‰¹æ€§ï¼ŒåŒ…æ‹¬ VarHandleã€Fences ç­‰æ¥å£å’Œç±»ã€‚å…¶ä¸­ VarHandle æä¾›äº†ä¸€ç§æ›´åŠ çµæ´»çš„åŸå­æ“ä½œæ–¹å¼ï¼ŒFences æä¾›äº†ä¸€äº›æ–¹æ³•ç”¨äºæ§åˆ¶å†…å­˜å±éšœã€‚</li>
</ol>
<h2 id="juc">JUC</h2>
<p>java.util.concurrent åŒ…ä¸‹çš„ç±»ä»¥åŠå¼•å…¥ç‰ˆæœ¬ï¼ˆæ²¡æœ‰æ ‡æ³¨ç‰ˆæœ¬å·çš„ä¸º <code>1.5</code> ï¼‰ï¼š</p>
<ul>
<li>java.util.concurrent
<ul>
<li>java.util.concurrent.locks
<ul>
<li>AbstractOwnableSynchronizer <code>1.6</code></li>
<li>AbstractQueuedLongSynchronizer <code>1.6</code></li>
<li>AbstractQueuedSynchronizer</li>
<li>Condition</li>
<li>Lock</li>
<li>LockSupport</li>
<li>ReadWriteLock</li>
<li>ReentrantLock</li>
<li>ReentrantReadWriteLock</li>
<li>StampedLock  <code>1.8</code></li>
</ul>
</li>
<li>java.util.concurrent.atomic
<ul>
<li>AtomicBoolean</li>
<li>AtomicInteger</li>
<li>AtomicIntegerArray</li>
<li>AtomicIntegerFieldUpdater</li>
<li>AtomicLong</li>
<li>AtomicLongArray</li>
<li>AtomicLongFieldUpdater</li>
<li>AtomicMarkableReference</li>
<li>AtomicReference</li>
<li>AtomicReferenceArray</li>
<li>AtomicReferenceFieldUpdater</li>
<li>AtomicStampedReference</li>
<li>DoubleAccumulator <code>1.8</code></li>
<li>DoubleAdder <code>1.8</code></li>
<li>LongAccumulator <code>1.8</code></li>
<li>LongAdder <code>1.8</code></li>
</ul>
</li>
<li>AbstractExecutorService</li>
<li>ArrayBlockingQueue</li>
<li>BlockingDeque <code>1.6</code></li>
<li>BlockingQueue</li>
<li>BrokenBarrierException</li>
<li>Callable</li>
<li>CancellationException</li>
<li>CompletableFuture  <code>1.8</code></li>
<li>CompletionException <code>1.8</code></li>
<li>CompletionService</li>
<li>CompletionStage <code>1.8</code></li>
<li>ConcurrentHashMap</li>
<li>ConcurrentLinkedDeque <code>1.7</code></li>
<li>ConcurrentLinkedQueue</li>
<li>ConcurrentMap</li>
<li>ConcurrentNavigableMap <code>1.6</code></li>
<li>ConcurrentSkipListMap <code>1.6</code></li>
<li>ConcurrentSkipListSet <code>1.6</code></li>
<li>CopyOnWriteArrayList</li>
<li>CopyOnWriteArraySet</li>
<li>CountDownLatch</li>
<li>CountedCompleter  <code>1.8</code></li>
<li>CyclicBarrier</li>
<li>Delayed</li>
<li>DelayQueue</li>
<li>Exchanger</li>
<li>ExecutionException</li>
<li>Executor</li>
<li>ExecutorCompletionService</li>
<li>Executors</li>
<li>ExecutorService</li>
<li>Flow <code>1.9</code></li>
<li>ForkJoinPool <code>1.7</code></li>
<li>ForkJoinTask <code>1.7</code></li>
<li>ForkJoinWorkerThread <code>1.7</code></li>
<li>Future</li>
<li>FutureTask</li>
<li>LinkedBlockingDeque <code>1.6</code></li>
<li>LinkedBlockingQueue</li>
<li>LinkedTransferQueue <code>1.7</code></li>
<li>Phaser <code>1.7</code></li>
<li>PriorityBlockingQueue</li>
<li>RecursiveAction <code>1.7</code></li>
<li>RecursiveTask <code>1.7</code></li>
<li>RejectedExecutionException</li>
<li>RejectedExecutionHandler</li>
<li>RunnableFuture</li>
<li>RunnableScheduledFuture</li>
<li>ScheduledExecutorService</li>
<li>ScheduledFuture</li>
<li>ScheduledThreadPoolExecutor</li>
<li>Semaphore</li>
<li>SubmissionPublisher <code>1.9</code></li>
<li>SynchronousQueue</li>
<li>ThreadFactory</li>
<li>ThreadLocalRandom <code>1.7</code></li>
<li>ThreadPoolExecutor</li>
<li>TimeoutException</li>
<li>TimeUnit</li>
<li>TransferQueue <code>1.7</code></li>
</ul>
</li>
</ul>
<p>å¤§è‡´å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š</p>
<ul>
<li>åŸå­æ›´æ–°</li>
<li>é”å’Œæ¡ä»¶</li>
<li>çº¿ç¨‹æ± </li>
<li>å¹¶å‘å®¹å™¨</li>
<li>åŒæ­¥å™¨</li>
</ul>
<p>åœ¨å­¦ä¹  <code>JUC</code> ä¹‹å‰æˆ‘ä»¬éœ€è¦äº†è§£ <code>CAS</code>ï¼Œ<code>AQS</code> å’Œ <code>Unsafe</code>ã€‚</p>
<ul>
<li>CASï¼š</li>
<li>AQSï¼š</li>
<li>Unsafeï¼š</li>
</ul>
<h2 id="cas">CAS</h2>
<p>CASï¼ˆ<code>Compare and Swap</code>ï¼‰æ˜¯ä¸€ç§åŸºäºåŸå­æ€§æ“ä½œçš„å¹¶å‘ç¼–ç¨‹æŠ€æœ¯ï¼Œå¸¸ç”¨äºå®ç°çº¿ç¨‹å®‰å…¨çš„æ•°æ®ç»“æ„å’Œç®—æ³•ã€‚CASæ“ä½œç”±ä¸‰ä¸ªå‚æ•°ç»„æˆï¼šå†…å­˜ä½ç½®Vã€æœŸæœ›å€¼Aã€æ–°å€¼Bã€‚å½“ä¸”ä»…å½“Vçš„å€¼ç­‰äºAæ—¶ï¼ŒCASæ“ä½œæ‰ä¼šå°†Vçš„å€¼è®¾ç½®ä¸ºBï¼Œå¦åˆ™ä¸åšä»»ä½•æ“ä½œã€‚å®ƒçš„å®ç°åŸç†å¯ä»¥ç®€å•æ¦‚æ‹¬ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>è¯»å–å†…å­˜ä½ç½®Vçš„å€¼ï¼ŒåŒæ—¶è®°å½•ä¸‹è¯¥å€¼çš„ç‰ˆæœ¬å·æˆ–æ ‡è®°ä½ã€‚</li>
<li>æ£€æŸ¥å†…å­˜ä½ç½®Vçš„å€¼æ˜¯å¦ç­‰äºæœŸæœ›å€¼Aã€‚å¦‚æœç›¸ç­‰ï¼Œåˆ™æ‰§è¡Œç¬¬3æ­¥ï¼›å¦åˆ™ï¼Œæ“ä½œå¤±è´¥ã€‚</li>
<li>å°†æ–°å€¼Bå†™å…¥å†…å­˜ä½ç½®Vï¼Œå¹¶æ›´æ–°å…¶ç‰ˆæœ¬å·æˆ–æ ‡è®°ä½ã€‚</li>
<li>è¿”å›æ“ä½œç»“æœã€‚</li>
</ol>
<p>CASæ“ä½œæ˜¯ä¸€ç§<code>ä¹è§‚é”</code>æœºåˆ¶ï¼Œå®ƒä¸éœ€è¦é”å®šæ•´ä¸ªå…±äº«èµ„æºï¼Œè€Œæ˜¯åªé’ˆå¯¹éœ€è¦ä¿®æ”¹çš„å€¼è¿›è¡ŒåŸå­æ€§æ“ä½œï¼Œä»è€Œé¿å…äº†é”çš„ç«äº‰å’Œå¼€é”€ã€‚åœ¨æ‰§è¡ŒCASæ“ä½œæ—¶ï¼Œçº¿ç¨‹ä¼šå¯¹å†…å­˜ä½ç½®è¿›è¡Œè¯»å–å’Œå†™å…¥ï¼Œä½†åŒæ—¶ä¹Ÿä¼šæ£€æŸ¥å†…å­˜ä½ç½®çš„ç‰ˆæœ¬å·æˆ–æ ‡è®°ä½ï¼Œä»¥ä¿è¯æ“ä½œçš„åŸå­æ€§å’Œä¸€è‡´æ€§ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡ŒCASæ“ä½œï¼Œå¯èƒ½ä¼šå‡ºç°ABAé—®é¢˜ã€‚ä¾‹å¦‚ï¼Œçº¿ç¨‹Aè¯»å–å†…å­˜ä½ç½®Vçš„å€¼ä¸ºAï¼Œç„¶åçº¿ç¨‹Bå°†Vçš„å€¼ä¿®æ”¹ä¸ºBï¼Œæœ€åçº¿ç¨‹Båˆå°†Vçš„å€¼ä¿®æ”¹ä¸ºAã€‚æ­¤æ—¶ï¼Œçº¿ç¨‹Aæ‰§è¡ŒCASæ“ä½œæ—¶ï¼Œä¼šå‘ç°å†…å­˜ä½ç½®Vçš„å€¼è¿˜æ˜¯Aï¼Œè™½ç„¶è¿™ä¸ªAçš„ç‰ˆæœ¬å·æˆ–æ ‡è®°ä½ä¸ä¹‹å‰ä¸åŒï¼Œä½†çº¿ç¨‹Aå¹¶ä¸çŸ¥é“Vçš„å€¼æ›¾ç»è¢«ä¿®æ”¹è¿‡ï¼Œå› æ­¤ä¼šå°†æ–°å€¼å†™å…¥å†…å­˜ä½ç½®Vï¼Œä»è€Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚ä¸ºäº†è§£å†³ABAé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨å¸¦æœ‰ç‰ˆæœ¬å·æˆ–æ ‡è®°ä½çš„CASæ“ä½œï¼Œæˆ–è€…ä½¿ç”¨å…¶ä»–çš„å¹¶å‘ç¼–ç¨‹æŠ€æœ¯ï¼Œä¾‹å¦‚é”æˆ–è¯»å†™é”ã€‚</p>
<p>Javaä¸­çš„<code>AtomicXXX</code>ç±»å®ç°äº†CASæ“ä½œï¼Œä¾‹å¦‚AtomicIntegerã€AtomicLongç­‰ã€‚è¿™äº›ç±»æä¾›äº†ä¸€ç»„åŸå­æ€§æ“ä½œæ–¹æ³•ï¼Œä¾‹å¦‚get()ã€set()ã€addAndGet()ã€compareAndSet()ç­‰ï¼Œå®ƒä»¬å¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹å®‰å…¨åœ°ä½¿ç”¨ã€‚</p>
<p>CASæ“ä½œè™½ç„¶å…å»äº†é”çš„å¼€é”€ï¼Œä½†ä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ã€‚é¦–å…ˆï¼ŒCASæ“ä½œéœ€è¦è¿›è¡Œå¤šæ¬¡å°è¯•ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚å¦‚æœå¹¶å‘ç¨‹åº¦è¾ƒé«˜ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡ŒCASæ“ä½œï¼Œå¯èƒ½ä¼šå¯¼è‡´å¤§é‡çš„CASæ“ä½œå¤±è´¥ï¼Œä»è€Œé™ä½æ€§èƒ½ã€‚å…¶æ¬¡ï¼ŒCASæ“ä½œåªèƒ½ä¿è¯å•ä¸ªå˜é‡çš„åŸå­æ€§æ“ä½œï¼Œæ— æ³•ä¿è¯å¤šä¸ªå˜é‡ä¹‹é—´çš„æ“ä½œçš„åŸå­æ€§ï¼Œå› æ­¤éœ€è¦é¢å¤–çš„æªæ–½æ¥ä¿è¯å¤šä¸ªå˜é‡ä¹‹é—´çš„ä¸€è‡´æ€§ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨AtomicIntegerå®ç°ç®€å•è®¡æ•°å™¨çš„ä¾‹å­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.concurrent.atomic.AtomicInteger</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Counter</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">AtomicInteger</span> <span class="n">value</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicInteger</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">increment</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">oldValue</span><span class="o">,</span> <span class="n">newValue</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">do</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">oldValue</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="n">newValue</span> <span class="o">=</span> <span class="n">oldValue</span> <span class="o">+</span> <span class="n">1</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">while</span> <span class="o">(!</span><span class="n">value</span><span class="o">.</span><span class="na">compareAndSet</span><span class="o">(</span><span class="n">oldValue</span><span class="o">,</span> <span class="n">newValue</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getValue</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>increment()</code> æ–¹æ³•ä½¿ç”¨do-whileå¾ªç¯å’Œ<code>compareAndSet()</code>æ–¹æ³•æ‰§è¡ŒCASæ“ä½œæ¥å¢åŠ è®¡æ•°å™¨çš„å€¼ã€‚è¯¥æ–¹æ³•é‡å¤ä½¿ç”¨<code>get()</code>æ–¹æ³•è¯»å–è®¡æ•°å™¨çš„å½“å‰å€¼ï¼Œè®¡ç®—æ–°å€¼ï¼Œç„¶åå°è¯•ä½¿ç”¨<code>compareAndSet()</code>æ–¹æ³•æ›´æ–°è®¡æ•°å™¨ã€‚å¾ªç¯å°†ç»§ç»­ï¼Œç›´åˆ°CASæ“ä½œæˆåŠŸå¹¶ä¸”è®¡æ•°å™¨æˆåŠŸæ›´æ–°ã€‚</p>
<p><code>getValue()</code> æ–¹æ³•ä½¿ç”¨<code>get()</code>æ–¹æ³•ç®€å•åœ°è¿”å›è®¡æ•°å™¨çš„å½“å‰å€¼ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä½¿ç”¨CASæ“ä½œæ—¶ï¼Œéœ€è¦å°å¿ƒå¤„ç†æ½œåœ¨çš„ABAé—®é¢˜ï¼Œå…¶ä¸­å…±äº«å˜é‡çš„å€¼å¯èƒ½åœ¨åˆå§‹è¯»å–å’Œæ›´æ–°å°è¯•ä¹‹é—´å¤šæ¬¡æ›´æ”¹ã€‚ä¸€ç§å¤„ç†æ–¹æ³•æ˜¯åœ¨å…±äº«å˜é‡ä¸­ä½¿ç”¨ç‰ˆæœ¬å·æˆ–æ—¶é—´æˆ³ï¼Œä»¥ç¡®ä¿æ›´æ–°ä»…åœ¨å€¼æœªæ›´æ”¹çš„æƒ…å†µä¸‹æˆåŠŸã€‚</p>
<p>ABAé—®é¢˜æ˜¯åœ¨ä½¿ç”¨CASï¼ˆ<code>Compare-and-Swap</code>ï¼‰æ“ä½œè¿›è¡Œå¹¶å‘ç¼–ç¨‹æ—¶ç»å¸¸é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜ã€‚å®ƒå‘ç”Ÿåœ¨ä¸€ä¸ªçº¿ç¨‹ä»å…±äº«å†…å­˜ä½ç½®è¯»å–ä¸€ä¸ªå€¼ï¼Œç„¶åå¦ä¸€ä¸ªçº¿ç¨‹å°†è¯¥å€¼æ›´æ”¹ä¸ºå¦ä¸€ä¸ªå€¼ï¼Œæœ€ååˆå°†å…¶æ›´æ”¹å›åŸå§‹å€¼ï¼Œä»è€Œä½¿ç¬¬ä¸€ä¸ªçº¿ç¨‹çš„æ“ä½œæ„å¤–æˆåŠŸã€‚</p>
<p>ä¸ºäº†å¤„ç†ABAé—®é¢˜ï¼Œå¸¸ç”¨çš„æ–¹æ³•æ˜¯åœ¨å…±äº«å†…å­˜ä½ç½®ä¸­æ·»åŠ ä¸€ä¸ªç‰ˆæœ¬å·æˆ–æ—¶é—´æˆ³ã€‚ç‰ˆæœ¬å·æˆ–æ—¶é—´æˆ³å¯ä»¥åœ¨æ¯æ¬¡ä¿®æ”¹å†…å­˜ä½ç½®æ—¶è¿›è¡Œé€’å¢æˆ–æ›´æ–°ã€‚è¿™å¯ä»¥ç¡®ä¿CASæ“ä½œä¸ä»…æ£€æŸ¥å€¼ï¼Œè¿˜æ£€æŸ¥å†…å­˜ä½ç½®çš„ç‰ˆæœ¬å·æˆ–æ—¶é—´æˆ³ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ç‰ˆæœ¬å·å¤„ç†ABAé—®é¢˜çš„ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.concurrent.atomic.AtomicStampedReference</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConcurrentStack</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">AtomicStampedReference</span><span class="o">&lt;</span><span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">top</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicStampedReference</span><span class="o">&lt;&gt;(</span><span class="kc">null</span><span class="o">,</span> <span class="n">0</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">push</span><span class="o">(</span><span class="n">T</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">newHead</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Node</span><span class="o">&lt;&gt;(</span><span class="n">value</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span><span class="o">[]</span> <span class="n">stampHolder</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">1</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">        <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">oldHead</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">do</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">oldHead</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">stampHolder</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">newHead</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="n">oldHead</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">stampHolder</span><span class="o">[</span><span class="n">0</span><span class="o">]++;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">while</span> <span class="o">(!</span><span class="n">top</span><span class="o">.</span><span class="na">compareAndSet</span><span class="o">(</span><span class="n">oldHead</span><span class="o">,</span> <span class="n">newHead</span><span class="o">,</span> <span class="n">stampHolder</span><span class="o">[</span><span class="n">0</span><span class="o">]</span> <span class="o">-</span> <span class="n">1</span><span class="o">,</span> <span class="n">stampHolder</span><span class="o">[</span><span class="n">0</span><span class="o">]));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">T</span> <span class="nf">pop</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">oldHead</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span><span class="o">[]</span> <span class="n">stampHolder</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">1</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">        <span class="k">do</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">oldHead</span> <span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">stampHolder</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">oldHead</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">while</span> <span class="o">(!</span><span class="n">top</span><span class="o">.</span><span class="na">compareAndSet</span><span class="o">(</span><span class="n">oldHead</span><span class="o">,</span> <span class="n">oldHead</span><span class="o">.</span><span class="na">next</span><span class="o">,</span> <span class="n">stampHolder</span><span class="o">[</span><span class="n">0</span><span class="o">],</span> <span class="n">stampHolder</span><span class="o">[</span><span class="n">0</span><span class="o">]</span> <span class="o">+</span> <span class="n">1</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">oldHead</span><span class="o">.</span><span class="na">value</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="kd">final</span> <span class="n">T</span> <span class="n">value</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">next</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="nf">Node</span><span class="o">(</span><span class="n">T</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>ConcurrentStack</code> ç±»ä½¿ç”¨ <code>AtomicStampedReference</code> å­˜å‚¨æ ˆé¡¶èŠ‚ç‚¹ã€‚<code>AtomicStampedReference</code> ç±»å­˜å‚¨å€¼çš„å¼•ç”¨å’Œç‰ˆæœ¬å·ï¼Œç‰ˆæœ¬å·åœ¨å¼•ç”¨æ›´æ”¹æ—¶è¿›è¡Œæ›´æ–°ã€‚</p>
<p><code>push()</code> æ–¹æ³•ä½¿ç”¨æ–°å€¼åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>Node</code>ï¼Œç„¶åå°è¯•ä½¿ç”¨CASæ“ä½œå°†å…¶æ¨å…¥æ ˆä¸­ã€‚å¾ªç¯å°†ç»§ç»­ï¼Œç›´åˆ°CASæ“ä½œæˆåŠŸï¼ŒèŠ‚ç‚¹æˆåŠŸæ¨å…¥æ ˆä¸­ã€‚</p>
<p><code>pop()</code> æ–¹æ³•å°è¯•ä½¿ç”¨CASæ“ä½œä»æ ˆä¸­å¼¹å‡ºé¡¶éƒ¨èŠ‚ç‚¹ã€‚å¾ªç¯å°†ç»§ç»­ï¼Œç›´åˆ°é¡¶éƒ¨èŠ‚ç‚¹æˆåŠŸå¼¹å‡ºæˆ–æ ˆä¸ºç©ºä¸ºæ­¢ã€‚</p>
<p>é€šè¿‡ä½¿ç”¨å…·æœ‰ç‰ˆæœ¬å·çš„ <code>AtomicStampedReference</code>ï¼Œ<code>ConcurrentStack</code> ç±»å¯ä»¥å¤„ç†åœ¨å¹¶å‘æ“ä½œä¸­å¯èƒ½å‘ç”Ÿçš„ABAé—®é¢˜ã€‚</p>
<h2 id="aqs">AQS</h2>
<p>AQSï¼ˆ<code>AbstractQueuedSynchronizer</code>ï¼‰æ˜¯Javaä¸­ç”¨äºå®ç°åŒæ­¥å™¨ï¼ˆå¦‚é”ï¼Œä¿¡å·é‡ç­‰ï¼‰çš„æ¡†æ¶ï¼Œå®ƒæä¾›äº†ä¸€äº›åŸºæœ¬çš„åŒæ­¥æ“ä½œï¼Œä¾‹å¦‚<code>è·å–é”</code>ã€<code>é‡Šæ”¾é”</code>ã€<code>ç­‰å¾…æ¡ä»¶</code>ã€<code>å”¤é†’çº¿ç¨‹</code>ç­‰ã€‚</p>
<p>AQSçš„å®ç°åŸç†åŸºäºä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œç”¨äºç»´æŠ¤ç­‰å¾…çº¿ç¨‹çš„é˜Ÿåˆ—ã€‚å½“ä¸€ä¸ªçº¿ç¨‹éœ€è¦è·å–åŒæ­¥å™¨æ—¶ï¼Œå®ƒä¼šé¦–å…ˆå°è¯•ä½¿ç”¨CASæ“ä½œæ¥è·å–åŒæ­¥å™¨ï¼Œå¦‚æœè·å–æˆåŠŸï¼Œåˆ™ç»§ç»­æ‰§è¡Œï¼›å¦‚æœè·å–å¤±è´¥ï¼Œåˆ™å°†çº¿ç¨‹åŠ å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œå¹¶å°†å…¶æŒ‚èµ·ã€‚å½“åŒæ­¥å™¨é‡Šæ”¾æ—¶ï¼Œå®ƒä¼šå”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ï¼Œå¹¶å°†å®ƒä»¬ä»ç­‰å¾…é˜Ÿåˆ—ä¸­ç§»é™¤ï¼Œä½¿å®ƒä»¬å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚</p>
<p>AQSçš„ç­‰å¾…é˜Ÿåˆ—æ˜¯é€šè¿‡ä¸€ä¸ªåŒå‘é“¾è¡¨æ¥å®ç°çš„ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ï¼ŒèŠ‚ç‚¹ä¸­åŒ…å«äº†çº¿ç¨‹çš„çŠ¶æ€ä»¥åŠç­‰å¾…æ¡ä»¶ç­‰ä¿¡æ¯ã€‚ç­‰å¾…é˜Ÿåˆ—ä¸­çš„èŠ‚ç‚¹æ˜¯æŒ‰ç…§ç­‰å¾…æ—¶é—´çš„å…ˆåé¡ºåºæ’åˆ—çš„ï¼Œå…ˆç­‰å¾…çš„çº¿ç¨‹æ’åœ¨å‰é¢ï¼Œåç­‰å¾…çš„çº¿ç¨‹æ’åœ¨åé¢ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è¢«å”¤é†’æ—¶ï¼Œå®ƒä¼šé‡æ–°å°è¯•è·å–åŒæ­¥å™¨ï¼Œå¦‚æœè·å–æˆåŠŸï¼Œåˆ™ç»§ç»­æ‰§è¡Œï¼›å¦‚æœè·å–å¤±è´¥ï¼Œåˆ™å®ƒä¼šå†æ¬¡åŠ å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œå¹¶å°†è‡ªå·±æŒ‚èµ·ã€‚</p>
<p>AQSçš„å…·ä½“å®ç°æ˜¯é€šè¿‡é‡å†™å…¶å†…éƒ¨çš„ä¸€äº›æ–¹æ³•æ¥å®ç°çš„ã€‚ä¾‹å¦‚ï¼Œ<code>tryAcquire()</code> æ–¹æ³•ç”¨äºå®ç°è·å–åŒæ­¥å™¨çš„é€»è¾‘ï¼Œå®ƒä¼šé¦–å…ˆå°è¯•ä½¿ç”¨CASæ“ä½œæ¥è·å–åŒæ­¥å™¨ï¼Œå¦‚æœè·å–æˆåŠŸï¼Œåˆ™è¿”å› trueï¼›å¦åˆ™è¿”å› falseã€‚<code>tryRelease()</code> æ–¹æ³•ç”¨äºå®ç°é‡Šæ”¾åŒæ­¥å™¨çš„é€»è¾‘ï¼Œå®ƒä¼šé‡Šæ”¾åŒæ­¥å™¨ï¼Œå¹¶å”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ã€‚<code>tryAcquireShared()</code> å’Œ <code>tryReleaseShared()</code> æ–¹æ³•åˆ™ç”¨äºå®ç°å…±äº«å¼åŒæ­¥å™¨çš„é€»è¾‘ï¼Œå®ƒä»¬ç±»ä¼¼äº <code>tryAcquire()</code> å’Œ <code>tryRelease()</code> æ–¹æ³•ï¼Œä½†æ˜¯å¯ä»¥æ”¯æŒå¤šä¸ªçº¿ç¨‹åŒæ—¶è·å–æˆ–é‡Šæ”¾åŒæ­¥å™¨ã€‚</p>
<h2 id="unsafe">Unsafe</h2>
<p>Unsafeç±»æ˜¯Javaä¸­ä¸€ä¸ªéå¸¸ç‰¹æ®Šä¸”å¼ºå¤§çš„ç±»ï¼Œå®ƒæä¾›äº†ä¸€äº›ä¸å®‰å…¨çš„æ“ä½œï¼Œä¾‹å¦‚ç›´æ¥æ“ä½œå†…å­˜ã€çº¿ç¨‹æŒ‚èµ·å’Œæ¢å¤ç­‰ã€‚Unsafeç±»æ˜¯Javaä¸­å°‘æ•°å‡ ä¸ªä¸è¢«å…¬å¼€æ”¯æŒçš„ç±»ä¹‹ä¸€ï¼Œå®ƒä¸»è¦è¢«ç”¨äºJavaæ ¸å¿ƒåº“å’Œå…¶ä»–ä¸€äº›é«˜çº§æ¡†æ¶ä¸­ï¼Œå¦‚Nettyã€Hadoopå’ŒKafkaç­‰ã€‚</p>
<p>ç”±äºUnsafeç±»æä¾›äº†ä¸€äº›ä¸å®‰å…¨çš„æ“ä½œï¼Œå› æ­¤å®ƒçš„ä½¿ç”¨éœ€è¦éå¸¸å°å¿ƒã€‚å¦‚æœä¸æ­£ç¡®åœ°ä½¿ç”¨Unsafeç±»ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç¨‹åºå´©æºƒæˆ–å®‰å…¨æ¼æ´ã€‚å› æ­¤ï¼ŒJavaå®˜æ–¹å¹¶ä¸å»ºè®®å¼€å‘äººå‘˜ä½¿ç”¨Unsafeç±»ï¼Œè€Œæ˜¯å»ºè®®å¼€å‘äººå‘˜ä½¿ç”¨æ›´åŠ å®‰å…¨å’Œæ ‡å‡†çš„Java APIã€‚</p>
<p>Unsafeç±»ä¸­ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•åŒ…æ‹¬ï¼š</p>
<ol>
<li><code>allocateMemory(long size)</code>ï¼šåˆ†é…ä¸€æ®µæŒ‡å®šå¤§å°çš„å†…å­˜ç©ºé—´ã€‚</li>
<li><code>freeMemory(long address)</code>ï¼šé‡Šæ”¾æŒ‡å®šåœ°å€çš„å†…å­˜ç©ºé—´ã€‚</li>
<li><code>putXXX(Object target, long offset, XXX value)</code>ï¼šå°†æŒ‡å®šç±»å‹çš„å€¼å†™å…¥ç›®æ ‡å¯¹è±¡çš„æŒ‡å®šåç§»é‡å¤„ã€‚</li>
<li><code>getXXX(Object target, long offset)</code>ï¼šä»ç›®æ ‡å¯¹è±¡çš„æŒ‡å®šåç§»é‡å¤„è¯»å–æŒ‡å®šç±»å‹çš„å€¼ã€‚</li>
<li><code>park(boolean isAbsolute, long time)</code>ï¼šæŒ‚èµ·å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°è¢«å…¶ä»–çº¿ç¨‹å”¤é†’æˆ–æŒ‡å®šçš„æ—¶é—´åˆ°æœŸã€‚</li>
<li><code>unpark(Thread thread)</code>ï¼šæ¢å¤æŒ‡å®šçº¿ç¨‹çš„è¿è¡Œã€‚</li>
</ol>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒUnsafeç±»ä¸­çš„å¤§éƒ¨åˆ†æ–¹æ³•éƒ½æ˜¯nativeæ–¹æ³•ï¼Œå®ç°æ–¹å¼ä¾èµ–äºåº•å±‚æ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶å¹³å°ã€‚è¿™æ„å‘³ç€Unsafeç±»ä¸­çš„æ–¹æ³•åœ¨ä¸åŒçš„å¹³å°ä¸Šå¯èƒ½ä¼šæœ‰ä¸åŒçš„è¡Œä¸ºï¼Œå› æ­¤éœ€è¦é’ˆå¯¹ä¸åŒçš„å¹³å°è¿›è¡Œæµ‹è¯•å’ŒéªŒè¯ã€‚</p>
<p>Java 9ä¸­å®˜æ–¹æå‡ºäº†ç§»é™¤Sun.misc.Unsafeç±»ï¼Œå¹¶åœ¨è¯¥ç‰ˆæœ¬ä¸­å°†è¯¥ç±»æ ‡è®°ä¸ºä¸æ¨èä½¿ç”¨ã€‚ç„¶è€Œï¼Œç”±äºUnsafeç±»åœ¨Javaè¯­è¨€ç”Ÿæ€ä¸­çš„åº”ç”¨éå¸¸å¹¿æ³›ï¼Œè®¸å¤šæ¡†æ¶å’Œåº“éƒ½ä¾èµ–äºUnsafeç±»æ¥å®ç°é«˜æ€§èƒ½å’Œä½å±‚æ¬¡çš„æ“ä½œã€‚å› æ­¤ï¼Œåœ¨Java 9ä¸­ï¼Œå®˜æ–¹å¼•å…¥äº†jdk.internal.misc.Unsafeç±»æ¥æ›¿ä»£Sun.misc.Unsafeç±»çš„åŠŸèƒ½ï¼Œä»¥ä¿æŒå¯¹Javaç”Ÿæ€ä¸­ä½¿ç”¨Unsafeç±»çš„æ”¯æŒã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>ã€ŠEffective Java 3ã€‹ç¬”è®°10ï¼šè¦†ç›–equalsæ–¹æ³•æ—¶åº”éµå®ˆçš„çº¦å®š</title>
      <link>https://blog.chensoul.com/posts/2023/05/17/obey-the-general-contract-when-overriding-equals/</link>
      <pubDate>Wed, 17 May 2023 10:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/05/17/obey-the-general-contract-when-overriding-equals/</guid>
      <description>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬ä¸‰ç« ã€Šå¯¹è±¡çš„é€šç”¨æ–¹æ³•ã€‹çš„å­¦ä¹ ç¬”è®°ï¼šè¦†ç›– equals æ–¹æ³•æ—¶åº”éµå®ˆçš„çº¦å®šã€‚ ä»‹ç» è¦†ç›– equals æ–¹æ³•ä¼¼ä¹å¾ˆç®€å•ï¼Œä½†æ˜¯æœ‰å¾ˆå¤šè¦†ç›–çš„æ–¹å¼</description>
      <content:encoded><![CDATA[<p>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬ä¸‰ç« ã€Šå¯¹è±¡çš„é€šç”¨æ–¹æ³•ã€‹çš„å­¦ä¹ ç¬”è®°ï¼šè¦†ç›– equals æ–¹æ³•æ—¶åº”éµå®ˆçš„çº¦å®šã€‚</p>
<h2 id="ä»‹ç»">ä»‹ç»</h2>
<p>è¦†ç›– equals æ–¹æ³•ä¼¼ä¹å¾ˆç®€å•ï¼Œä½†æ˜¯æœ‰å¾ˆå¤šè¦†ç›–çš„æ–¹å¼ä¼šå¯¼è‡´å‡ºé”™ï¼Œè€Œä¸”åæœå¯èƒ½éå¸¸ä¸¥é‡ã€‚é¿å…é—®é¢˜çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä¸è¦†ç›– equals æ–¹æ³•ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç±»çš„æ¯ä¸ªå®ä¾‹éƒ½åªç­‰äºå®ƒè‡ªå·±ã€‚å¦‚æœç¬¦åˆä¸‹åˆ—ä»»ä½•æ¡ä»¶ï¼Œå°±æ˜¯æ­£ç¡®çš„åšæ³•ï¼š</p>
<ul>
<li>
<p><strong>ç±»çš„æ¯ä¸ªå®ä¾‹æœ¬è´¨ä¸Šéƒ½æ˜¯å”¯ä¸€çš„ã€‚</strong> å¯¹äºåƒ Thread è¿™æ ·è¡¨ç¤ºæ´»åŠ¨å®ä½“ç±»è€Œä¸æ˜¯å€¼ç±»æ¥è¯´ä¹Ÿæ˜¯å¦‚æ­¤ã€‚Object æä¾›çš„ equals å®ç°å¯¹äºè¿™äº›ç±»å…·æœ‰å®Œå…¨æ­£ç¡®çš„è¡Œä¸ºã€‚</p>
</li>
<li>
<p><strong>è¯¥ç±»ä¸éœ€è¦æä¾›ã€Œé€»è¾‘ç›¸ç­‰ã€æµ‹è¯•ã€‚</strong> ä¾‹å¦‚ï¼Œ<code>java.util.regex.Pattern</code> å¯ä»¥è¦†ç›– equals æ¥æ£€æŸ¥ä¸¤ä¸ª Pattern å®ä¾‹æ˜¯å¦è¡¨ç¤ºå®Œå…¨ç›¸åŒçš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œä½†è®¾è®¡äººå‘˜è®¤ä¸ºå®¢æˆ·ç«¯ä¸éœ€è¦æˆ–ä¸éœ€è¦è¿™ä¸ªåŠŸèƒ½ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä» Object ç»§æ‰¿çš„ equals å®ç°æ˜¯ç†æƒ³çš„ã€‚</p>
</li>
<li>
<p><strong>è¶…ç±»å·²ç»è¦†ç›–äº† equalsï¼Œè¶…ç±»è¡Œä¸ºé€‚åˆäºè¿™ä¸ªç±»ã€‚</strong> ä¾‹å¦‚ï¼Œå¤§å¤šæ•° Set çš„å®ç°ä» AbstractSet ç»§æ‰¿å…¶å¯¹ç­‰å®ç°ï¼ŒList ä» AbstractList ç»§æ‰¿å®ç°ï¼ŒMap ä» AbstractMap ç»§æ‰¿å®ç°ã€‚</p>
</li>
<li>
<p><strong>ç±»æ˜¯ç§æœ‰çš„æˆ–åŒ…ç§æœ‰çš„ï¼Œå¹¶ä¸”ä½ ç¡®ä¿¡å®ƒçš„ equals æ–¹æ³•æ°¸è¿œä¸ä¼šè¢«è°ƒç”¨ã€‚</strong> å¦‚æœä½ éå¸¸åŒæ¶é£é™©ï¼Œä½ å¯ä»¥è¦†ç›– equals æ–¹æ³•ï¼Œä»¥ç¡®ä¿å®ƒä¸ä¼šæ„å¤–è°ƒç”¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">throw</span> <span class="k">new</span> <span class="n">AssertionError</span><span class="o">();</span> <span class="c1">// Method is never called
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div></li>
</ul>
<p>ä»€ä¹ˆæ—¶å€™è¦†ç›– equals æ–¹æ³•æ˜¯åˆé€‚çš„ï¼Ÿå½“ä¸€ä¸ªç±»æœ‰ä¸€ä¸ªé€»è¾‘ç›¸ç­‰çš„æ¦‚å¿µï¼Œè€Œè¿™ä¸ªæ¦‚å¿µä¸åŒäºä»…åˆ¤æ–­å¯¹è±¡çš„åŒä¸€æ€§ï¼ˆç›¸åŒå¯¹è±¡çš„å¼•ç”¨ï¼‰ï¼Œå¹¶ä¸”è¶…ç±»è¿˜æ²¡æœ‰è¦†ç›– equalsã€‚å¯¹äºå€¼ç±»é€šå¸¸æ˜¯è¿™æ ·ã€‚å€¼ç±»åªæ˜¯è¡¨ç¤ºå€¼çš„ç±»ï¼Œä¾‹å¦‚ Integer æˆ– Stringã€‚ä½¿ç”¨ equals æ–¹æ³•æ¯”è¾ƒå¼•ç”¨å’Œå€¼å¯¹è±¡çš„ç¨‹åºå‘˜å¸Œæœ›å‘ç°å®ƒä»¬åœ¨é€»è¾‘ä¸Šæ˜¯å¦ç­‰ä»·ï¼Œè€Œä¸æ˜¯å®ƒä»¬æ˜¯å¦å¼•ç”¨ç›¸åŒçš„å¯¹è±¡ã€‚è¦†ç›– equals æ–¹æ³•ä¸ä»…æ˜¯ä¸ºäº†æ»¡è¶³ç¨‹åºå‘˜çš„æœŸæœ›ï¼Œå®ƒè¿˜ä½¿å®ä¾‹èƒ½å¤Ÿä½œä¸º Map çš„é”®æˆ– Set å…ƒç´ æ—¶ï¼Œå…·æœ‰å¯é¢„æµ‹çš„ã€ç†æƒ³çš„è¡Œä¸ºã€‚</p>
<p><strong>æœ‰ä¸€ä¸ªè¡¨ç¤ºçŠ¶æ€çš„å†…éƒ¨ç±»ã€‚æ²¡æœ‰è¦†ç›– equals æ–¹æ³•æ—¶ï¼Œequals çš„ç»“æœä¸ s1==s2 ç›¸åŒï¼Œä¸º falseï¼Œå³ä¸¤è€…å¹¶ä¸æ˜¯ç›¸åŒå¯¹è±¡çš„å¼•ç”¨ã€‚</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">class</span> <span class="nc">Status</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">String</span> <span class="n">status</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Status</span> <span class="n">s1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Status</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">Status</span> <span class="n">s2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Status</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s1</span><span class="o">==</span><span class="n">s2</span><span class="o">);</span> <span class="c1">// false
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s1</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">s2</span><span class="o">));</span> <span class="c1">// false
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p><strong>è¦†ç›– equals æ–¹æ³•åï¼Œä»¥ä¸šåŠ¡é€»è¾‘æ¥åˆ¤æ–­æ˜¯å¦ç›¸åŒï¼Œå…·å¤‡ç›¸åŒ status å­—æ®µå³ä¸ºç›¸åŒã€‚åœ¨ä½¿ç”¨å»é‡åŠŸèƒ½æ—¶ï¼Œä¹Ÿä»¥æ­¤ä½œä¸ºåˆ¤æ–­ä¾æ®ã€‚</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">class</span> <span class="nc">Status</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">String</span> <span class="n">status</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">Objects</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">status</span><span class="o">,</span> <span class="o">((</span><span class="n">Status</span><span class="o">)</span> <span class="n">o</span><span class="o">).</span><span class="na">status</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Status</span> <span class="n">s1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Status</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">Status</span> <span class="n">s2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Status</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s1</span><span class="o">==</span><span class="n">s2</span><span class="o">);</span> <span class="c1">// false
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s1</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">s2</span><span class="o">));</span> <span class="c1">// true
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>ä¸éœ€è¦è¦†ç›– equals æ–¹æ³•çš„ä¸€ç§å€¼ç±»æ˜¯ä½¿ç”¨å®ä¾‹æ§ä»¶æ¥ç¡®ä¿æ¯ä¸ªå€¼æœ€å¤šåªå­˜åœ¨ä¸€ä¸ªå¯¹è±¡çš„ç±»ã€‚æšä¸¾ç±»å‹å±äºè¿™ä¸€ç±»ã€‚å¯¹äºè¿™äº›ç±»ï¼Œé€»è¾‘ç›¸ç­‰ä¸å¯¹è±¡æ ‡è¯†ç›¸åŒï¼Œå› æ­¤å¯¹è±¡çš„ equals æ–¹æ³•å‡½æ•°ä¸é€»è¾‘ equals æ–¹æ³•ç›¸åŒã€‚</p>
<p>å½“ä½ è¦†ç›– equals æ–¹æ³•æ—¶ï¼Œä½ å¿…é¡»éµå®ˆå®ƒçš„é€šç”¨çº¦å®šã€‚ä»¥ä¸‹æ˜¯å…·ä½“å†…å®¹ï¼Œæ¥è‡ª Object è§„èŒƒï¼šequals æ–¹æ³•å®ç°äº†ç­‰ä»·å…³ç³»ã€‚å®ƒåº”æœ‰è¿™äº›å±æ€§ï¼š</p>
<ul>
<li>åå°„æ€§ï¼šå¯¹äºä»»ä½•éç©ºçš„å‚è€ƒå€¼ xï¼Œ<code>x.equals(x)</code> å¿…é¡»è¿”å› trueã€‚</li>
<li>å¯¹ç§°æ€§ï¼šå¯¹äºä»»ä½•éç©ºå‚è€ƒå€¼ x å’Œ yï¼Œ<code>x.equals(y)</code> å¿…é¡»åœ¨ä¸”ä»…å½“ <code>y.equals(x)</code> è¿”å› true æ—¶è¿”å› trueã€‚</li>
<li>ä¼ é€’æ€§ï¼šå¯¹äºä»»ä½•éç©ºçš„å¼•ç”¨å€¼ x, y, zï¼Œå¦‚æœ <code>x.equals(y)</code> è¿”å› trueï¼Œ<code>y.equals(z)</code> è¿”å› trueï¼Œé‚£ä¹ˆ <code>x.equals(z)</code> å¿…é¡»è¿”å› trueã€‚</li>
<li>ä¸€è‡´æ€§ï¼šå¯¹äºä»»ä½•éç©ºçš„å¼•ç”¨å€¼ x å’Œ y, <code>x.equals(y)</code> çš„å¤šæ¬¡è°ƒç”¨å¿…é¡»ä¸€è‡´åœ°è¿”å› true æˆ–ä¸€è‡´åœ°è¿”å› falseï¼Œå‰ææ˜¯ä¸ä¿®æ”¹ equals ä¸­ä½¿ç”¨çš„ä¿¡æ¯ã€‚</li>
<li>å¯¹äºä»»ä½•éç©ºå¼•ç”¨å€¼ xï¼Œ<code>x.equals(null)</code> å¿…é¡»è¿”å› falseã€‚</li>
</ul>
<p>é™¤éä½ æœ‰æ•°å­¦æ–¹é¢çš„å€¾å‘ï¼Œå¦åˆ™è¿™äº›èµ·æ¥æœ‰ç‚¹å¯æ€•ï¼Œä½†ä¸è¦å¿½ç•¥å®ƒï¼å¦‚æœä½ è¿åäº†å®ƒï¼Œä½ çš„ç¨‹åºå¾ˆå¯èƒ½ä¼šå‡ºç°è¡Œä¸ºå¼‚å¸¸æˆ–å´©æºƒï¼Œå¹¶ä¸”å¾ˆéš¾ç¡®å®šå¤±è´¥çš„æ ¹æºã€‚ç”¨ John Donne çš„è¯æ¥è¯´ï¼Œæ²¡æœ‰ä¸€ä¸ªç±»æ˜¯å­¤ç«‹çš„ã€‚ä¸€ä¸ªç±»çš„å®ä¾‹ç»å¸¸è¢«ä¼ é€’ç»™å¦ä¸€ä¸ªç±»ã€‚è®¸å¤šç±»ï¼ˆåŒ…æ‹¬æ‰€æœ‰é›†åˆç±»ï¼‰ä¾èµ–äºä¼ é€’ç»™å®ƒä»¬çš„å¯¹è±¡éµå®ˆ equals çº¦å®šã€‚</p>
<p>æ—¢ç„¶ä½ å·²ç»æ„è¯†åˆ°äº†è¿å equals çº¦å®šçš„å±é™©ï¼Œè®©æˆ‘ä»¬è¯¦ç»†è®¨è®ºä¸€ä¸‹ã€‚å¥½æ¶ˆæ¯æ˜¯ï¼Œå°½ç®¡è¡¨é¢ä¸Šçœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œä½†å…¶å®å¹¶ä¸å¤æ‚ã€‚ä¸€æ—¦ä½ æ˜ç™½äº†ï¼Œå°±ä¸éš¾åšæŒä¸‹å»äº†ã€‚</p>
<p>ä»€ä¹ˆæ˜¯ç­‰ä»·å…³ç³»ï¼Ÿç®€å•åœ°è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ“ä½œç¬¦ï¼Œå®ƒå°†ä¸€ç»„å…ƒç´ åˆ’åˆ†ä¸ºå­é›†ï¼Œå­é›†çš„å…ƒç´ è¢«è®¤ä¸ºæ˜¯å½¼æ­¤ç›¸ç­‰çš„ã€‚è¿™äº›å­é›†è¢«ç§°ä¸ºç­‰ä»·ç±»ã€‚ä¸ºäº†ä½¿ equals æ–¹æ³•æœ‰ç”¨ï¼Œä»ç”¨æˆ·çš„è§’åº¦æ¥çœ‹ï¼Œæ¯ä¸ªç­‰ä»·ç±»ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½å¿…é¡»æ˜¯å¯äº’æ¢çš„ã€‚ç°åœ¨è®©æˆ‘ä»¬ä¾æ¬¡æ£€æŸ¥ä»¥ä¸‹äº”ä¸ªéœ€æ±‚ï¼š</p>
<ul>
<li>
<p><strong>åå°„æ€§</strong> ï¼Œç¬¬ä¸€ä¸ªè¦æ±‚ä»…ä»…æ˜¯è¯´ä¸€ä¸ªå¯¹è±¡å¿…é¡»ç­‰äºå®ƒè‡ªå·±ã€‚å¾ˆéš¾æƒ³è±¡ä¼šæ— æ„ä¸­è¿åäº†è¿™æ¡è§„åˆ™ã€‚å¦‚æœä½ è¿åäº†å®ƒï¼Œç„¶åå°†ç±»çš„ä¸€ä¸ªå®ä¾‹æ·»åŠ åˆ°é›†åˆä¸­ï¼Œcontains æ–¹æ³•å¾ˆå¯èƒ½ä¼šè¯´è¯¥é›†åˆä¸åŒ…å«ä½ åˆšæ‰æ·»åŠ çš„å®ä¾‹ã€‚</p>
</li>
<li>
<p><strong>å¯¹ç§°æ€§</strong> ï¼Œç¬¬äºŒä¸ªè¦æ±‚æ˜¯ä»»ä½•ä¸¤ä¸ªå¯¹è±¡å¿…é¡»åœ¨æ˜¯å¦ç›¸ç­‰çš„é—®é¢˜ä¸Šè¾¾æˆä¸€è‡´ã€‚ä¸ç¬¬ä¸€ä¸ªè¦æ±‚ä¸åŒï¼Œæ— æ„ä¸­è¿åäº†è¿™ä¸ªè¦æ±‚çš„æƒ…å†µä¸éš¾æƒ³è±¡ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸‹é¢çš„ç±»ï¼Œå®ƒå®ç°äº†ä¸åŒºåˆ†å¤§å°å†™çš„å­—ç¬¦ä¸²ã€‚å­—ç¬¦ä¸²çš„æƒ…å†µæ˜¯ä¿ç•™çš„ toStringï¼Œä½†å¿½ç•¥åœ¨ equals çš„æ¯”è¾ƒï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Broken - violates symmetry!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">CaseInsensitiveString</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">s</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">CaseInsensitiveString</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">s</span> <span class="o">=</span> <span class="n">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Broken - violates symmetry!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">CaseInsensitiveString</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(((</span><span class="n">CaseInsensitiveString</span><span class="o">)</span> <span class="n">o</span><span class="o">).</span><span class="na">s</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">String</span><span class="o">)</span> <span class="c1">// One-way interoperability!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">((</span><span class="n">String</span><span class="o">)</span> <span class="n">o</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="o">...</span> <span class="c1">// Remainder omitted
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>è¿™ä¸ªç±»ä¸­çš„ equals æ–¹æ³•å¤©çœŸåœ°å°è¯•ä¸æ™®é€šå­—ç¬¦ä¸²è¿›è¡Œäº’æ“ä½œã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªä¸åŒºåˆ†å¤§å°å†™çš„å­—ç¬¦ä¸²å’Œä¸€ä¸ªæ™®é€šå­—ç¬¦ä¸²ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">CaseInsensitiveString</span> <span class="n">cis</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CaseInsensitiveString</span><span class="o">(</span><span class="s">&#34;Polish&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">String</span> <span class="n">s</span> <span class="o">=</span> <span class="s">&#34;polish&#34;</span><span class="o">;</span>
</span></span></code></pre></div><p>æ­£å¦‚é¢„æœŸçš„é‚£æ ·ï¼Œ<code>cis.equals(s)</code> è¿”å› trueã€‚é—®é¢˜æ˜¯ï¼Œè™½ç„¶ CaseInsensitiveString ä¸­çš„ equals æ–¹æ³•çŸ¥é“æ™®é€šå­—ç¬¦ä¸²ï¼Œä½†æ˜¯ String ä¸­çš„ equals æ–¹æ³•å¯¹ä¸åŒºåˆ†å¤§å°å†™çš„å­—ç¬¦ä¸²ä¸çŸ¥æƒ…ã€‚å› æ­¤ï¼Œ<code>s.equals(cis)</code> è¿”å› falseï¼Œè¿™æ˜æ˜¾è¿åäº†å¯¹ç§°æ€§ã€‚å‡è®¾ä½ å°†ä¸åŒºåˆ†å¤§å°å†™çš„å­—ç¬¦ä¸²æ”¾å…¥é›†åˆä¸­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">CaseInsensitiveString</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl"><span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">cis</span><span class="o">);</span>
</span></span></code></pre></div><p>æ­¤æ—¶ <code>list.contains(s)</code> è¿”å›ä»€ä¹ˆï¼Ÿè°çŸ¥é“å‘¢ï¼Ÿåœ¨å½“å‰çš„ OpenJDK å®ç°ä¸­ï¼Œå®ƒç¢°å·§è¿”å› falseï¼Œä½†è¿™åªæ˜¯ä¸€ä¸ªå®ç°æ¡ˆä¾‹ã€‚åœ¨å¦ä¸€ä¸ªå®ç°ä¸­ï¼Œå®ƒå¯ä»¥å¾ˆå®¹æ˜“åœ°è¿”å› true æˆ–æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸ã€‚ä¸€æ—¦ä½ è¿åäº† equals çº¦å®šï¼Œå°±ä¸çŸ¥é“å½“å…¶ä»–å¯¹è±¡é¢å¯¹ä½ çš„å¯¹è±¡æ—¶ï¼Œä¼šå¦‚ä½•è¡¨ç°ã€‚</p>
<blockquote>
<p><strong>contains æ–¹æ³•åœ¨ ArrayList ä¸­çš„å®ç°æºç å¦‚ä¸‹</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ArrayList çš„å¤§å°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ä¿å­˜ ArrayList å…ƒç´ çš„å®¹å™¨ï¼Œä¸€ä¸ª Object æ•°ç»„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">transient</span> <span class="n">Object</span><span class="o">[]</span> <span class="n">elementData</span><span class="o">;</span> <span class="c1">// non-private to simplify nested class access
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">contains</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">indexOf</span><span class="o">(</span><span class="n">o</span><span class="o">)</span> <span class="o">&gt;=</span> <span class="n">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">int</span> <span class="nf">indexOf</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">indexOfRange</span><span class="o">(</span><span class="n">o</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">size</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">indexOfRange</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">,</span> <span class="kt">int</span> <span class="n">start</span><span class="o">,</span> <span class="kt">int</span> <span class="n">end</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Object</span><span class="o">[]</span> <span class="n">es</span> <span class="o">=</span> <span class="n">elementData</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">start</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">end</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">es</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">i</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">start</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">end</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">o</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">es</span><span class="o">[</span><span class="n">i</span><span class="o">]))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">i</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">-</span><span class="n">1</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div></blockquote>
</li>
</ul>
<p>â€‹		ä¸ºäº†æ¶ˆé™¤è¿™ä¸ªé—®é¢˜ï¼Œåªéœ€ä» equals æ–¹æ³•ä¸­åˆ é™¤ä¸ String äº’æ“ä½œçš„é”™è¯¯å°è¯•ã€‚ä¸€æ—¦ä½ è¿™æ ·åšäº†ï¼Œä½ å¯ä»¥é‡æ„æ–¹æ³•ä¸ºä¸€ä¸ªå•ä¸€çš„è¿”å›è¯­å¥ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">o</span> <span class="k">instanceof</span> <span class="n">CaseInsensitiveString</span> <span class="o">&amp;&amp;</span> <span class="o">((</span><span class="n">CaseInsensitiveString</span><span class="o">)</span> <span class="n">o</span><span class="o">).</span><span class="na">s</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><ul>
<li>
<p><strong>ä¼ é€’æ€§</strong> ï¼Œequals çº¦å®šçš„ç¬¬ä¸‰ä¸ªè¦æ±‚æ˜¯ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡ç­‰äºç¬¬äºŒä¸ªå¯¹è±¡ï¼Œè€Œç¬¬äºŒä¸ªå¯¹è±¡ç­‰äºç¬¬ä¸‰ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªå¯¹è±¡å¿…é¡»ç­‰äºç¬¬ä¸‰ä¸ªå¯¹è±¡ã€‚åŒæ ·ï¼Œæ— æ„ä¸­è¿åäº†è¿™ä¸ªè¦æ±‚çš„æƒ…å†µä¸éš¾æƒ³è±¡ã€‚è€ƒè™‘å‘è¶…ç±»æ·»åŠ æ–°çš„å€¼ç»„ä»¶æ—¶ï¼Œå­ç±»çš„æƒ…å†µã€‚æ¢å¥è¯è¯´ï¼Œå­ç±»æ·»åŠ äº†ä¸€æ¡å½±å“ equals æ¯”è¾ƒçš„ä¿¡æ¯ã€‚è®©æˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„ä¸å¯å˜äºŒç»´æ•´æ•°ç‚¹ç±»å¼€å§‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Point</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">x</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">y</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">Point</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">Point</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">Point</span> <span class="n">p</span> <span class="o">=</span> <span class="o">(</span><span class="n">Point</span><span class="o">)</span><span class="n">o</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="na">x</span> <span class="o">==</span> <span class="n">x</span> <span class="o">&amp;&amp;</span> <span class="n">p</span><span class="o">.</span><span class="na">y</span> <span class="o">==</span> <span class="n">y</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span> <span class="c1">// Remainder omitted
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>å‡è®¾ä½ æƒ³ç»§æ‰¿è¿™ä¸ªç±»ï¼Œå¯¹ä¸€ä¸ªç‚¹æ·»åŠ é¢œè‰²çš„æ¦‚å¿µï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ColorPoint</span> <span class="kd">extends</span> <span class="n">Point</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Color</span> <span class="n">color</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">ColorPoint</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">,</span> <span class="n">Color</span> <span class="n">color</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">super</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">color</span> <span class="o">=</span> <span class="n">color</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span> <span class="c1">// Remainder omitted
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>equals æ–¹æ³•åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿå¦‚æœä½ å®Œå…¨å¿½ç•¥å®ƒï¼Œåˆ™å®ç°å°†ä» Point ç±»ç»§æ‰¿è€Œæ¥ï¼Œåœ¨ equals æ¯”è¾ƒä¸­é¢œè‰²ä¿¡æ¯å°†è¢«å¿½ç•¥ã€‚è™½ç„¶è¿™å¹¶ä¸è¿å equals çº¦å®šï¼Œä½†æ˜¾ç„¶æ˜¯ä¸å¯æ¥å—çš„ã€‚å‡è®¾ä½ å†™äº†ä¸€ä¸ª equals æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åªæœ‰å½“å®ƒçš„å‚æ•°æ˜¯å¦ä¸€ä¸ªé¢œè‰²ç‚¹ï¼Œä¸”ä½ç½®å’Œé¢œè‰²ç›¸åŒæ—¶æ‰è¿”å› trueï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Broken - violates symmetry!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">ColorPoint</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">o</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">((</span><span class="n">ColorPoint</span><span class="o">)</span> <span class="n">o</span><span class="o">).</span><span class="na">color</span> <span class="o">==</span> <span class="n">color</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>è¿™ç§æ–¹æ³•çš„é—®é¢˜æ˜¯ï¼Œå½“ä½ æ¯”è¾ƒä¸€ä¸ªç‚¹å’Œä¸€ä¸ªé¢œè‰²ç‚¹æ—¶ï¼Œä½ å¯èƒ½ä¼šå¾—åˆ°ä¸åŒçš„ç»“æœï¼Œåä¹‹äº¦ç„¶ã€‚å‰è€…æ¯”è¾ƒå¿½ç•¥é¢œè‰²ï¼Œè€Œåè€…æ¯”è¾ƒæ€»æ˜¯è¿”å› falseï¼Œå› ä¸ºå‚æ•°çš„ç±»å‹æ˜¯ä¸æ­£ç¡®çš„ã€‚ä¸ºäº†ä½¿é—®é¢˜æ›´å…·ä½“ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç‚¹å’Œä¸€ä¸ªé¢œè‰²ç‚¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Point</span> <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="n">2</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ColorPoint</span> <span class="n">cp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ColorPoint</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="n">Color</span><span class="o">.</span><span class="na">RED</span><span class="o">);</span>
</span></span></code></pre></div><p>ç„¶åï¼Œ<code>p.equals(cp)</code> è¿”å› trueï¼Œè€Œ <code>cp.equals(p)</code> è¿”å› falseã€‚å½“ä½ åšã€Œæ··åˆæ¯”è¾ƒã€çš„æ—¶å€™ï¼Œä½ å¯ä»¥é€šè¿‡è®© <code>ColorPoint.equals</code> å¿½ç•¥é¢œè‰²æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Broken - violates transitivity!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">Point</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// If o is a normal Point, do a color-blind comparison
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">ColorPoint</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">o</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// o is a ColorPoint; do a full comparison
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">o</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">((</span><span class="n">ColorPoint</span><span class="o">)</span> <span class="n">o</span><span class="o">).</span><span class="na">color</span> <span class="o">==</span> <span class="n">color</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>è¿™ç§æ–¹æ³•ç¡®å®æä¾›äº†å¯¹ç§°æ€§ï¼Œä½†ç‰ºç‰²äº†ä¼ é€’æ€§ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ColorPoint</span> <span class="n">p1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ColorPoint</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="n">Color</span><span class="o">.</span><span class="na">RED</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">Point</span> <span class="n">p2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="n">2</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ColorPoint</span> <span class="n">p3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ColorPoint</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="n">Color</span><span class="o">.</span><span class="na">BLUE</span><span class="o">);</span>
</span></span></code></pre></div><p>ç°åœ¨ï¼Œ<code>p1.equals(p2)</code> å’Œ <code>p2.equals(p3)</code> è¿”å› trueï¼Œè€Œ <code>p1.equals(p3)</code> è¿”å› falseï¼Œè¿™æ˜æ˜¾è¿åäº†ä¼ é€’æ€§ã€‚å‰ä¸¤ä¸ªæ¯”è¾ƒæ˜¯ã€Œè‰²ç›²ã€ï¼Œè€Œç¬¬ä¸‰ä¸ªæ¯”è¾ƒè€ƒè™‘äº†é¢œè‰²ã€‚</p>
<p>åŒæ ·ï¼Œè¿™ç§æ–¹æ³•ä¼šå¯¼è‡´æ— é™çš„é€’å½’ï¼šå‡è®¾æœ‰ä¸¤ä¸ªç‚¹çš„å­ç±»ï¼Œæ¯”å¦‚ ColorPoint å’Œ SmellPointï¼Œæ¯ä¸ªéƒ½ä½¿ç”¨è¿™ç§ equals æ–¹æ³•ã€‚ç„¶åè°ƒç”¨ <code>myColorPoint.equals(mySmellPoint)</code> ä¼šæŠ›å‡º StackOverflowErrorã€‚</p>
<p>é‚£ä¹ˆè§£å†³æ–¹æ¡ˆæ˜¯ä»€ä¹ˆï¼Ÿè¿™æ˜¯é¢å‘å¯¹è±¡è¯­è¨€ä¸­ç­‰ä»·å…³ç³»çš„ä¸€ä¸ªåŸºæœ¬é—®é¢˜ã€‚<strong>é™¤éä½ æ„¿æ„æ”¾å¼ƒé¢å‘å¯¹è±¡çš„æŠ½è±¡ä¼˜ç‚¹ï¼Œå¦åˆ™æ— æ³•ç»§æ‰¿ä¸€ä¸ªå¯å®ä¾‹åŒ–çš„ç±»å¹¶æ·»åŠ ä¸€ä¸ªå€¼ç»„ä»¶ï¼ŒåŒæ—¶ä¿ç•™ equals çº¦å®šã€‚</strong></p>
<p>ä½ å¯èƒ½ä¼šå¬åˆ°å®ƒè¯´ä½ å¯ä»¥ç»§æ‰¿ä¸€ä¸ªå®ä¾‹åŒ–çš„ç±»å¹¶æ·»åŠ ä¸€ä¸ªå€¼ç»„ä»¶ï¼ŒåŒæ—¶é€šè¿‡åœ¨ equals æ–¹æ³•ä¸­ä½¿ç”¨ getClass æµ‹è¯•æ¥ä»£æ›¿ instanceof æµ‹è¯•æ¥ä¿æŒ equals çº¦å®šï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Broken - violates Liskov substitution principle (page 43)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">getClass</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Point</span> <span class="n">p</span> <span class="o">=</span> <span class="o">(</span><span class="n">Point</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="na">x</span> <span class="o">==</span> <span class="n">x</span> <span class="o">&amp;&amp;</span> <span class="n">p</span><span class="o">.</span><span class="na">y</span> <span class="o">==</span> <span class="n">y</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åªæœ‰å½“å¯¹è±¡å…·æœ‰ç›¸åŒçš„å®ç°ç±»æ—¶ï¼Œæ‰ä¼šäº§ç”Ÿç›¸ç­‰çš„æ•ˆæœã€‚è¿™å¯èƒ½çœ‹èµ·æ¥ä¸æ˜¯å¾ˆç³Ÿç³•ï¼Œä½†å…¶åæœæ˜¯ä¸å¯æ¥å—çš„ï¼šPoint çš„å­ç±»çš„å®ä¾‹ä»ç„¶æ˜¯ä¸€ä¸ª Pointï¼Œå¹¶ä¸”å®ƒä»ç„¶éœ€è¦ä½œä¸ºä¸€ä¸ªå‡½æ•°æ¥å·¥ä½œï¼Œä½†æ˜¯å¦‚æœé‡‡ç”¨è¿™ç§æ–¹æ³•ï¼Œå®ƒå°±ä¸ä¼šè¿™æ ·åšï¼å‡è®¾æˆ‘ä»¬è¦å†™ä¸€ä¸ªæ–¹æ³•æ¥åˆ¤æ–­ä¸€ä¸ªç‚¹æ˜¯å¦åœ¨å•ä½åœ†ä¸Šã€‚æˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Initialize unitCircle to contain all Points on the unit circle
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span> <span class="n">unitCircle</span> <span class="o">=</span> <span class="n">Set</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="k">new</span> <span class="n">Point</span><span class="o">(</span> <span class="n">1</span><span class="o">,</span> <span class="n">0</span><span class="o">),</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span> <span class="n">0</span><span class="o">,</span> <span class="n">1</span><span class="o">),</span>
</span></span><span class="line"><span class="cl">        <span class="k">new</span> <span class="n">Point</span><span class="o">(-</span><span class="n">1</span><span class="o">,</span> <span class="n">0</span><span class="o">),</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span> <span class="n">0</span><span class="o">,</span> <span class="o">-</span><span class="n">1</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">onUnitCircle</span><span class="o">(</span><span class="n">Point</span> <span class="n">p</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">unitCircle</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">p</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>è™½ç„¶è¿™å¯èƒ½ä¸æ˜¯å®ç°åŠŸèƒ½çš„æœ€å¿«æ–¹æ³•ï¼Œä½†å®ƒå·¥ä½œå¾—å¾ˆå¥½ã€‚å‡è®¾ä½ ä»¥ä¸€ç§ä¸æ·»åŠ å€¼ç»„ä»¶çš„ç®€å•æ–¹å¼ç»§æ‰¿ Pointï¼Œä¾‹å¦‚ï¼Œè®©å®ƒçš„æ„é€ å‡½æ•°è·Ÿè¸ªåˆ›å»ºäº†å¤šå°‘å®ä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CounterPoint</span> <span class="kd">extends</span> <span class="n">Point</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">AtomicInteger</span> <span class="n">counter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicInteger</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">CounterPoint</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">super</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">counter</span><span class="o">.</span><span class="na">incrementAndGet</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">numberCreated</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">counter</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>Liskov æ›¿æ¢åŸåˆ™æŒ‡å‡ºï¼Œç±»å‹çš„ä»»ä½•é‡è¦å±æ€§éƒ½åº”è¯¥é€‚ç”¨äºæ‰€æœ‰å­ç±»å‹ï¼Œå› æ­¤ä¸ºç±»å‹ç¼–å†™çš„ä»»ä½•æ–¹æ³•éƒ½åº”è¯¥åœ¨å…¶å­ç±»å‹ä¸ŠåŒæ ·æœ‰æ•ˆã€‚è¿™æ˜¯æˆ‘ä»¬å…ˆå‰åšçš„æ­£å¼å£°æ˜ï¼Œå³ç‚¹çš„å­ç±»ï¼ˆå¦‚ CounterPointï¼‰ä»ç„¶æ˜¯ä¸€ä¸ª Pointï¼Œå¹¶ä¸”å¿…é¡»ä½œä¸ºä¸€ä¸ª Pointã€‚ä½†å‡è®¾æˆ‘ä»¬ä¼ é€’äº†ä¸€ä¸ª CounterPoint ç»™ onUnitCircle æ–¹æ³•ã€‚å¦‚æœ Point ç±»ä½¿ç”¨åŸºäº getclass çš„ equals æ–¹æ³•ï¼Œé‚£ä¹ˆä¸ç®¡ CounterPoint å®ä¾‹çš„ x å’Œ y åæ ‡å¦‚ä½•ï¼ŒonUnitCircle æ–¹æ³•éƒ½ä¼šè¿”å› falseã€‚è¿™æ˜¯å› ä¸ºå¤§å¤šæ•°é›†åˆï¼ŒåŒ…æ‹¬ onUnitCircle æ–¹æ³•ä½¿ç”¨çš„ HashSetï¼Œéƒ½ä½¿ç”¨ equals æ–¹æ³•æ¥æµ‹è¯•åŒ…å«æ€§ï¼Œæ²¡æœ‰ä¸€ä¸ª CounterPoint å®ä¾‹ç­‰äºä»»ä½•ä¸€ä¸ªç‚¹ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ åœ¨ Point ä¸Šä½¿ç”¨äº†æ­£ç¡®çš„åŸºäºå®ä¾‹çš„ equals æ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨æä¾›å¯¹ä½å®ä¾‹æ—¶ï¼Œç›¸åŒçš„ onUnitCircle æ–¹æ³•å°±å¯ä»¥å¾ˆå¥½åœ°å·¥ä½œã€‚</p>
<blockquote>
<p><strong>é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLiskov Substitution Principleï¼ŒLSPï¼‰é¢å‘å¯¹è±¡è®¾è®¡çš„åŸºæœ¬åŸåˆ™ä¹‹ä¸€ã€‚é‡Œæ°æ›¿æ¢åŸåˆ™æŒ‡å‡ºï¼šä»»ä½•çˆ¶ç±»å¯ä»¥å‡ºç°çš„åœ°æ–¹ï¼Œå­ç±»ä¸€å®šå¯ä»¥å‡ºç°ã€‚LSP æ˜¯ç»§æ‰¿å¤ç”¨çš„åŸºçŸ³ï¼Œåªæœ‰å½“è¡ç”Ÿç±»å¯ä»¥æ›¿æ¢æ‰çˆ¶ç±»ï¼Œè½¯ä»¶å•ä½çš„åŠŸèƒ½ä¸å—åˆ°å½±å“æ—¶ï¼Œçˆ¶ç±»æ‰èƒ½çœŸæ­£è¢«å¤ç”¨ï¼Œè€Œè¡ç”Ÿç±»ä¹Ÿèƒ½å¤Ÿåœ¨çˆ¶ç±»çš„åŸºç¡€ä¸Šå¢åŠ æ–°çš„è¡Œä¸ºã€‚</strong></p>
</blockquote>
</li>
</ul>
<p>è™½ç„¶æ²¡æœ‰ä»¤äººæ»¡æ„çš„æ–¹æ³•æ¥ç»§æ‰¿ä¸€ä¸ªå¯å®ä¾‹åŒ–çš„ç±»å¹¶æ·»åŠ ä¸€ä¸ªå€¼ç»„ä»¶ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼šéµå¾ªçš„å»ºè®®ï¼Œã€ŒFavor composition over inheritance.ã€ã€‚ç»™ ColorPoint ä¸€ä¸ªç§æœ‰çš„ Point å­—æ®µå’Œä¸€ä¸ª public è§†å›¾æ–¹æ³•ï¼Œè€Œä¸æ˜¯è®© ColorPoint ç»§æ‰¿ Pointï¼Œè¯¥æ–¹æ³•è¿”å›ä¸è¿™ä¸ªé¢œè‰²ç‚¹ç›¸åŒä½ç½®çš„ç‚¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Adds a value component without violating the equals contract
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ColorPoint</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Point</span> <span class="n">point</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Color</span> <span class="n">color</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">ColorPoint</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">,</span> <span class="n">Color</span> <span class="n">color</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">point</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">color</span> <span class="o">=</span> <span class="n">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">color</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">    * Returns the point-view of this color point.
</span></span></span><span class="line"><span class="cl"><span class="cm">    */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Point</span> <span class="nf">asPoint</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">point</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">ColorPoint</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">ColorPoint</span> <span class="n">cp</span> <span class="o">=</span> <span class="o">(</span><span class="n">ColorPoint</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">cp</span><span class="o">.</span><span class="na">point</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">point</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">cp</span><span class="o">.</span><span class="na">color</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">color</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span> <span class="c1">// Remainder omitted
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>Java åº“ä¸­æœ‰ä¸€äº›ç±»ç¡®å®ç»§æ‰¿äº†ä¸€ä¸ªå¯å®ä¾‹åŒ–çš„ç±»å¹¶æ·»åŠ äº†ä¸€ä¸ªå€¼ç»„ä»¶ã€‚ä¾‹å¦‚ï¼Œ<code>java.sql.Timestamp</code> ç»§æ‰¿ <code>java.util.Date</code> å¹¶æ·»åŠ äº†çº³ç§’å­—æ®µã€‚å¦‚æœåœ¨åŒä¸€ä¸ªé›†åˆä¸­ä½¿ç”¨æ—¶é—´æˆ³å’Œæ—¥æœŸå¯¹è±¡ï¼Œæˆ–è€…ä»¥å…¶ä»–æ–¹å¼æ··åˆä½¿ç”¨æ—¶é—´æˆ³å’Œæ—¥æœŸå¯¹è±¡ï¼Œé‚£ä¹ˆæ—¶é—´æˆ³çš„ equals å®ç°ç¡®å®è¿åäº†å¯¹ç§°æ€§ï¼Œå¹¶ä¸”å¯èƒ½å¯¼è‡´ä¸ç¨³å®šçš„è¡Œä¸ºã€‚Timestamp ç±»æœ‰ä¸€ä¸ªå…è´£å£°æ˜ï¼Œè­¦å‘Šç¨‹åºå‘˜ä¸è¦æ··åˆä½¿ç”¨æ—¥æœŸå’Œæ—¶é—´æˆ³ã€‚è™½ç„¶åªè¦å°†å®ƒä»¬åˆ†å¼€ï¼Œå°±ä¸ä¼šé‡åˆ°éº»çƒ¦ï¼Œä½†æ˜¯æ²¡æœ‰ä»€ä¹ˆå¯ä»¥é˜»æ­¢ä½ å°†å®ƒä»¬æ··åˆåœ¨ä¸€èµ·ï¼Œå› æ­¤äº§ç”Ÿçš„é”™è¯¯å¯èƒ½å¾ˆéš¾è°ƒè¯•ã€‚æ—¶é—´æˆ³ç±»çš„è¿™ç§è¡Œä¸ºæ˜¯é”™è¯¯çš„ï¼Œä¸åº”è¯¥æ•ˆä»¿ã€‚</p>
<p>æ³¨æ„ï¼Œä½ å¯ä»¥å‘æŠ½è±¡ç±»çš„å­ç±»æ·»åŠ ä¸€ä¸ªå€¼ç»„ä»¶ï¼Œè€Œä¸è¿å equals çº¦å®šã€‚è¿™å¯¹äºéµå¾ªä¸­çš„å»ºè®®è€Œå¾—åˆ°çš„ç±»å±‚æ¬¡ç»“æ„å¾ˆé‡è¦ï¼Œã€ŒPrefer class hierarchies to tagged classes.ã€ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æœ‰ä¸€ä¸ªæ²¡æœ‰å€¼ç»„ä»¶çš„æŠ½è±¡ç±»å½¢çŠ¶ã€ä¸€ä¸ªæ·»åŠ åŠå¾„å­—æ®µçš„å­ç±»åœ†å’Œä¸€ä¸ªæ·»åŠ é•¿åº¦å’Œå®½åº¦å­—æ®µçš„å­ç±»çŸ©å½¢ã€‚åªè¦ä¸å¯èƒ½ç›´æ¥åˆ›å»ºè¶…ç±»å®ä¾‹ï¼Œå‰é¢æ˜¾ç¤ºçš„é‚£ç§é—®é¢˜å°±ä¸ä¼šå‘ç”Ÿã€‚</p>
<ul>
<li>
<p><strong>éæ— æ•ˆæ€§</strong> ï¼Œæœ€åçš„è¦æ±‚æ²¡æœ‰ä¸€ä¸ªæ­£å¼çš„åç§°ï¼Œæ‰€ä»¥æˆ‘å†’æ˜§åœ°ç§°ä¹‹ä¸ºã€Œéæ— æ•ˆæ€§ã€ã€‚å®ƒè¯´æ‰€æœ‰å¯¹è±¡éƒ½ä¸ç­‰äº nullã€‚è™½ç„¶å¾ˆéš¾æƒ³è±¡åœ¨å“åº”è°ƒç”¨ <code>o.equals(null)</code> æ—¶æ„å¤–åœ°è¿”å› trueï¼Œä½†ä¸éš¾æƒ³è±¡æ„å¤–åœ°æŠ›å‡º NullPointerExceptionã€‚ä¸€èˆ¬çº¦å®šä¸­ç¦æ­¢è¿™æ ·åšã€‚è®¸å¤šç±»éƒ½æœ‰ç›¸ç­‰çš„æ–¹æ³•ï¼Œé€šè¿‡æ˜¾å¼çš„ null æµ‹è¯•æ¥é˜²æ­¢å®ƒï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>è¿™ä¸ªæµ‹è¯•æ˜¯ä¸å¿…è¦çš„ã€‚è¦æµ‹è¯•å…¶å‚æ•°æ˜¯å¦ç›¸ç­‰ï¼Œequals æ–¹æ³•å¿…é¡»é¦–å…ˆå°†å…¶å‚æ•°è½¬æ¢ä¸ºé€‚å½“çš„ç±»å‹ï¼Œä»¥ä¾¿èƒ½å¤Ÿè°ƒç”¨å…¶è®¿é—®å™¨æˆ–è®¿é—®å…¶å­—æ®µã€‚åœ¨æ‰§è¡Œè½¬æ¢ä¹‹å‰ï¼Œæ–¹æ³•å¿…é¡»ä½¿ç”¨ instanceof è¿ç®—ç¬¦æ¥æ£€æŸ¥å…¶å‚æ•°çš„ç±»å‹æ˜¯å¦æ­£ç¡®ï¼š</p>
<p>å¦‚æœç¼ºå°‘è¿™ä¸ªç±»å‹æ£€æŸ¥ï¼Œå¹¶ä¸” equals æ–¹æ³•ä¼ é€’äº†ä¸€ä¸ªé”™è¯¯ç±»å‹çš„å‚æ•°ï¼Œequals æ–¹æ³•å°†æŠ›å‡º ClassCastExceptionï¼Œè¿™è¿åäº† equals çº¦å®šã€‚ä½†æ˜¯ï¼Œå¦‚æœ instanceof æ“ä½œç¬¦çš„ç¬¬ä¸€ä¸ªæ“ä½œæ•°ä¸ºç©ºï¼Œåˆ™æŒ‡å®šè¯¥æ“ä½œç¬¦è¿”å› falseï¼Œè€Œä¸ç®¡ç¬¬äºŒä¸ªæ“ä½œæ•°ä¸­å‡ºç°çš„æ˜¯ä»€ä¹ˆç±»å‹ã€‚å› æ­¤ï¼Œå¦‚æœä¼ å…¥ nullï¼Œç±»å‹æ£€æŸ¥å°†è¿”å› falseï¼Œå› æ­¤ä¸éœ€è¦æ˜¾å¼çš„ null æ£€æŸ¥ã€‚</p>
</li>
</ul>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªé«˜è´¨é‡æ„å»º equals æ–¹æ³•çš„ç§˜è¯€ï¼š</p>
<p>1ã€<strong>ä½¿ç”¨ == è¿ç®—ç¬¦æ£€æŸ¥å‚æ•°æ˜¯å¦æ˜¯å¯¹è¯¥å¯¹è±¡çš„å¼•ç”¨ã€‚</strong> å¦‚æœæ˜¯ï¼Œè¿”å› trueã€‚è¿™åªæ˜¯ä¸€ç§æ€§èƒ½ä¼˜åŒ–ï¼Œä½†å¦‚æœæ¯”è¾ƒçš„ä»£ä»·å¯èƒ½å¾ˆé«˜ï¼Œé‚£ä¹ˆè¿™ç§ä¼˜åŒ–æ˜¯å€¼å¾—çš„ã€‚</p>
<p>2ã€<strong>ä½¿ç”¨ instanceof è¿ç®—ç¬¦æ£€æŸ¥å‚æ•°æ˜¯å¦å…·æœ‰æ­£ç¡®çš„ç±»å‹ã€‚</strong> å¦‚æœä¸æ˜¯ï¼Œè¿”å› falseã€‚é€šå¸¸ï¼Œæ­£ç¡®çš„ç±»å‹æ˜¯æ–¹æ³•å‘ç”Ÿçš„ç±»ã€‚æœ‰æ—¶å€™ï¼Œå®ƒæ˜¯ç”±è¿™ä¸ªç±»å®ç°çš„æŸä¸ªæ¥å£ã€‚å¦‚æœç±»å®ç°äº†ä¸€ä¸ªæ¥å£ï¼Œè¯¥æ¥å£å¯¹ equals çº¦å®šè¿›è¡Œäº†æ”¹è¿›ï¼Œä»¥å…è®¸è·¨å®ç°è¯¥æ¥å£çš„ç±»è¿›è¡Œæ¯”è¾ƒï¼Œåˆ™ä½¿ç”¨è¯¥æ¥å£ã€‚é›†åˆæ¥å£ï¼Œå¦‚ Setã€Listã€Map å’Œ Map.Entry å…·æœ‰æ­¤å±æ€§ã€‚</p>
<p>3ã€<strong>å°†å‚æ•°è½¬æ¢ä¸ºæ­£ç¡®çš„ç±»å‹ã€‚</strong> å› ä¸ºåœ¨è¿™ä¸ªå¼ºåˆ¶ç±»å‹è½¬æ¢ä¹‹å‰æœ‰ä¸€ä¸ªå®ä¾‹æµ‹è¯•ï¼Œæ‰€ä»¥å®ƒè‚¯å®šä¼šæˆåŠŸã€‚</p>
<p>4ã€<strong>å¯¹äºç±»ä¸­çš„æ¯ä¸ªã€Œé‡è¦ã€å­—æ®µï¼Œæ£€æŸ¥å‚æ•°çš„å­—æ®µæ˜¯å¦ä¸è¯¥å¯¹è±¡çš„ç›¸åº”å­—æ®µåŒ¹é…ã€‚</strong> å¦‚æœæ‰€æœ‰è¿™äº›æµ‹è¯•éƒ½æˆåŠŸï¼Œè¿”å› trueï¼›å¦åˆ™è¿”å› falseã€‚å¦‚æœç¬¬ 2 æ­¥ä¸­çš„ç±»å‹æ˜¯æ¥å£ï¼Œåˆ™å¿…é¡»é€šè¿‡æ¥å£æ–¹æ³•è®¿é—®å‚æ•°çš„å­—æ®µï¼›å¦‚æœæ˜¯ç±»ï¼Œä½ å¯ä»¥æ ¹æ®å­—æ®µçš„å¯è®¿é—®æ€§ç›´æ¥è®¿é—®å®ƒä»¬ã€‚</p>
<p>å¯¹äºç±»å‹ä¸æ˜¯ float æˆ– double çš„åŸºæœ¬ç±»å‹å­—æ®µï¼Œä½¿ç”¨ == è¿ç®—ç¬¦è¿›è¡Œæ¯”è¾ƒï¼›å¯¹äºå¯¹è±¡å¼•ç”¨å­—æ®µï¼Œé€’å½’è°ƒç”¨ equals æ–¹æ³•ï¼›å¯¹äº float å­—æ®µï¼Œä½¿ç”¨ <code>static Float.compare(float,float)</code> æ–¹æ³•ï¼›å¯¹äº double å­—æ®µï¼Œä½¿ç”¨ <code>Double.compare(double, double)</code>ã€‚float å’Œ double å­—æ®µçš„ç‰¹æ®Šå¤„ç†æ˜¯ç”±äº <code>Float.NaN</code>ã€-0.0f å’Œç±»ä¼¼çš„åŒé‡å€¼çš„å­˜åœ¨è€Œå¿…é¡»çš„ï¼›è¯·å‚é˜… Float.equals<code>æ–‡æ¡£ã€‚è™½ç„¶ä½ å¯ä»¥å°† float å’Œ double å­—æ®µä¸é™æ€æ–¹æ³• Float.equals å’Œ Double.equals è¿›è¡Œæ¯”è¾ƒï¼Œè¿™å°†éœ€è¦åœ¨æ¯ä¸ªæ¯”è¾ƒä¸Šè¿›è¡Œè‡ªåŠ¨è£…ç®±ï¼Œè¿™å°†æœ‰è¾ƒå·®çš„æ€§èƒ½ã€‚å¯¹äºæ•°ç»„å­—æ®µï¼Œå°†è¿™äº›æŒ‡å¯¼åŸåˆ™åº”ç”¨äºæ¯ä¸ªå…ƒç´ ã€‚å¦‚æœæ•°ç»„å­—æ®µä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½å¾ˆé‡è¦ï¼Œé‚£ä¹ˆä½¿ç”¨</code>Arrays.equals` æ–¹æ³•ä¹‹ä¸€ã€‚</p>
<p>ä¸€äº›å¯¹è±¡å¼•ç”¨å­—æ®µå¯èƒ½åˆæ³•åœ°åŒ…å« nullã€‚ä¸ºäº†é¿å…å¯èƒ½å‡ºç° NullPointerExceptionï¼Œè¯·ä½¿ç”¨é™æ€æ–¹æ³• <code>Objects.equals(Object, Object)</code> æ£€æŸ¥è¿™äº›å­—æ®µæ˜¯å¦ç›¸ç­‰ã€‚</p>
<p>å¯¹äºæŸäº›ç±»ï¼Œä¾‹å¦‚ä¸Šé¢çš„ CaseInsensitiveStringï¼Œå­—æ®µæ¯”è¾ƒæ¯”ç®€å•çš„ equal æµ‹è¯•æ›´å¤æ‚ã€‚å¦‚æœæ˜¯è¿™æ ·ï¼Œä½ å¯èƒ½å¸Œæœ›å­˜å‚¨å­—æ®µçš„è§„èŒƒå½¢å¼ï¼Œä»¥ä¾¿ equals æ–¹æ³•å¯ä»¥å¯¹è§„èŒƒå½¢å¼è¿›è¡Œå»‰ä»·çš„ç²¾ç¡®æ¯”è¾ƒï¼Œè€Œä¸æ˜¯æ›´æ˜‚è´µçš„éæ ‡å‡†æ¯”è¾ƒã€‚è¿™ç§æŠ€æœ¯æœ€é€‚åˆäºä¸å¯å˜ç±»ï¼›å¦‚æœå¯¹è±¡å¯ä»¥æ›´æ”¹ï¼Œåˆ™å¿…é¡»ä½¿è§„èŒƒå½¢å¼ä¿æŒæœ€æ–°ã€‚</p>
<p>equals æ–¹æ³•çš„æ€§èƒ½å¯èƒ½ä¼šå—åˆ°å­—æ®µæ¯”è¾ƒé¡ºåºçš„å½±å“ã€‚ä¸ºäº†è·å¾—æœ€ä½³æ€§èƒ½ï¼Œä½ åº”è¯¥é¦–å…ˆæ¯”è¾ƒé‚£äº›æ›´å¯èƒ½ä¸åŒã€æ¯”è¾ƒæˆæœ¬æ›´ä½çš„å­—æ®µï¼Œæˆ–è€…ç†æƒ³æƒ…å†µä¸‹ä¸¤è€…éƒ½æ¯”è¾ƒã€‚ä¸èƒ½æ¯”è¾ƒä¸å±äºå¯¹è±¡é€»è¾‘çŠ¶æ€çš„å­—æ®µï¼Œä¾‹å¦‚ç”¨äºåŒæ­¥æ“ä½œçš„é”å­—æ®µã€‚ä½ ä¸éœ€è¦æ¯”è¾ƒæ´¾ç”Ÿå­—æ®µï¼ˆå¯ä»¥ä»ã€Œé‡è¦å­—æ®µã€è®¡ç®—ï¼‰ï¼Œä½†æ˜¯è¿™æ ·åšå¯èƒ½ä¼šæé«˜ equals æ–¹æ³•çš„æ€§èƒ½ã€‚å¦‚æœæ´¾ç”Ÿå­—æ®µç›¸å½“äºæ•´ä¸ªå¯¹è±¡çš„æ‘˜è¦æè¿°ï¼Œé‚£ä¹ˆå¦‚æœæ¯”è¾ƒå¤±è´¥ï¼Œæ¯”è¾ƒè¯¥å­—æ®µå°†èŠ‚çœæ¯”è¾ƒå®é™…æ•°æ®çš„å¼€é”€ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ªå¤šè¾¹å½¢ç±»ï¼Œä½ ç¼“å­˜è¿™ä¸ªåŒºåŸŸã€‚å¦‚æœä¸¤ä¸ªå¤šè¾¹å½¢çš„é¢ç§¯ä¸ç›¸ç­‰ï¼Œä½ ä¸éœ€è¦æ¯”è¾ƒå®ƒä»¬çš„è¾¹å’Œé¡¶ç‚¹ã€‚</p>
<p><strong>å†™å®Œ equals æ–¹æ³•åï¼Œé—®è‡ªå·±ä¸‰ä¸ªé—®é¢˜ï¼šå®ƒå…·å¤‡å¯¹ç§°æ€§å—ï¼Ÿå…·å¤‡ä¼ é€’æ€§å—ï¼Ÿå…·å¤‡ä¸€è‡´æ€§å—ï¼Ÿ</strong> ä¸è¦åªé—®è‡ªå·±ï¼Œè¦ç¼–å†™å•å…ƒæµ‹è¯•æ¥æ£€æŸ¥ï¼Œé™¤éä½¿ç”¨ AutoValueï¼ˆç¬¬ 49 é¡µï¼‰æ¥ç”Ÿæˆ equals æ–¹æ³•ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥å®‰å…¨åœ°çœç•¥æµ‹è¯•ã€‚å¦‚æœå±æ€§ä¸èƒ½ä¿æŒï¼Œè¯·æ‰¾å‡ºåŸå› ï¼Œå¹¶ç›¸åº”åœ°ä¿®æ”¹ equals æ–¹æ³•ã€‚å½“ç„¶ï¼Œequals æ–¹æ³•è¿˜å¿…é¡»æ»¡è¶³å…¶ä»–ä¸¤ä¸ªå±æ€§ï¼ˆåå°„æ€§å’Œéæ— æ•ˆæ€§ï¼‰ï¼Œä½†è¿™ä¸¤ä¸ªé€šå¸¸ä¼šè‡ªå·±å¤„ç†ã€‚</p>
<p>åœ¨è¿™ä¸ªç®€å•çš„ PhoneNumber ç±»ä¸­ï¼Œæ ¹æ®å‰é¢çš„æ–¹æ³•æ„é€ äº†ä¸€ä¸ª equals æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Class with a typical equals method
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">PhoneNumber</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">short</span> <span class="n">areaCode</span><span class="o">,</span> <span class="n">prefix</span><span class="o">,</span> <span class="n">lineNum</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">PhoneNumber</span><span class="o">(</span><span class="kt">int</span> <span class="n">areaCode</span><span class="o">,</span> <span class="kt">int</span> <span class="n">prefix</span><span class="o">,</span> <span class="kt">int</span> <span class="n">lineNum</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">areaCode</span> <span class="o">=</span> <span class="n">rangeCheck</span><span class="o">(</span><span class="n">areaCode</span><span class="o">,</span> <span class="n">999</span><span class="o">,</span> <span class="s">&#34;area code&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">prefix</span> <span class="o">=</span> <span class="n">rangeCheck</span><span class="o">(</span><span class="n">prefix</span><span class="o">,</span> <span class="n">999</span><span class="o">,</span> <span class="s">&#34;prefix&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">lineNum</span> <span class="o">=</span> <span class="n">rangeCheck</span><span class="o">(</span><span class="n">lineNum</span><span class="o">,</span> <span class="n">9999</span><span class="o">,</span> <span class="s">&#34;line num&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">short</span> <span class="nf">rangeCheck</span><span class="o">(</span><span class="kt">int</span> <span class="n">val</span><span class="o">,</span> <span class="kt">int</span> <span class="n">max</span><span class="o">,</span> <span class="n">String</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">val</span> <span class="o">&lt;</span> <span class="n">0</span> <span class="o">||</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="n">max</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span><span class="n">arg</span> <span class="o">+</span> <span class="s">&#34;: &#34;</span> <span class="o">+</span> <span class="n">val</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="o">(</span><span class="kt">short</span><span class="o">)</span> <span class="n">val</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="k">this</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="n">PhoneNumber</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">PhoneNumber</span> <span class="n">pn</span> <span class="o">=</span> <span class="o">(</span><span class="n">PhoneNumber</span><span class="o">)</span><span class="n">o</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">pn</span><span class="o">.</span><span class="na">lineNum</span> <span class="o">==</span> <span class="n">lineNum</span> <span class="o">&amp;&amp;</span> <span class="n">pn</span><span class="o">.</span><span class="na">prefix</span> <span class="o">==</span> <span class="n">prefix</span> <span class="o">&amp;&amp;</span> <span class="n">pn</span><span class="o">.</span><span class="na">areaCode</span> <span class="o">==</span> <span class="n">areaCode</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="o">...</span> <span class="c1">// Remainder omitted
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>ä»¥ä¸‹æ˜¯ä¸€äº›æœ€åçš„è­¦å‘Šï¼š</p>
<ul>
<li>
<p><strong>å½“ä½ è¦†ç›– equals æ—¶ï¼Œä¹Ÿè¦†ç›– hashCodeã€‚</strong></p>
</li>
<li>
<p><strong>ä¸è¦è‡ªä½œèªæ˜ã€‚</strong> å¦‚æœä½ åªæ˜¯ä¸ºäº†åˆ¤æ–­ç›¸ç­‰æ€§è€Œæµ‹è¯•å­—æ®µï¼Œé‚£ä¹ˆéµå¾ª equals çº¦å®šå¹¶ä¸å›°éš¾ã€‚å¦‚æœä½ åœ¨å¯»æ±‚å¯¹ç­‰æ–¹é¢è¿‡äºæ¿€è¿›ï¼Œå¾ˆå®¹æ˜“é™·å…¥éº»çƒ¦ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè€ƒè™‘åˆ°ä»»ä½•å½¢å¼çš„æ··å éƒ½ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚ä¾‹å¦‚ï¼ŒFile ç±»ä¸åº”è¯¥å°è¯•å°†å¼•ç”¨åŒä¸€æ–‡ä»¶çš„ç¬¦å·é“¾æ¥ç­‰åŒèµ·æ¥ã€‚å€¼å¾—åº†å¹¸çš„æ˜¯ï¼Œå®ƒä¸æ˜¯ã€‚</p>
</li>
<li>
<p><strong>ä¸è¦ç”¨å¦ä¸€ç§ç±»å‹æ›¿æ¢ equals å£°æ˜ä¸­çš„å¯¹è±¡ã€‚</strong> å¯¹äºç¨‹åºå‘˜æ¥è¯´ï¼Œç¼–å†™ä¸€ä¸ªç±»ä¼¼äºè¿™æ ·çš„ equals æ–¹æ³•ï¼Œç„¶åèŠ±ä¸Šå‡ ä¸ªå°æ—¶æ€è€ƒä¸ºä»€ä¹ˆå®ƒä¸èƒ½æ­£å¸¸å·¥ä½œæ˜¯å¾ˆå¸¸è§çš„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Broken - parameter type must be Object!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">MyClass</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>è¿™é‡Œçš„é—®é¢˜æ˜¯ï¼Œè¿™ä¸ªæ–¹æ³•æ²¡æœ‰è¦†ç›–å…¶å‚æ•°ç±»å‹ä¸º Object çš„ Object.equalsï¼Œè€Œæ˜¯é‡è½½äº†å®ƒã€‚å³ä½¿æ˜¯æ™®é€šçš„æ–¹æ³•ï¼Œæä¾›è¿™æ ·ä¸€ä¸ªã€Œå¼ºç±»å‹çš„ã€equals æ–¹æ³•æ˜¯ä¸å¯æ¥å—çš„ï¼Œå› ä¸ºå®ƒä¼šå¯¼è‡´å­ç±»ä¸­çš„é‡å†™æ³¨é‡Šäº§ç”Ÿè¯¯æŠ¥å¹¶æä¾›é”™è¯¯çš„å®‰å…¨æ€§ã€‚</p>
<p>å¦‚æœ¬æ¡ç›®æ‰€ç¤ºï¼Œä¸€è‡´ä½¿ç”¨ Override æ³¨é‡Šå°†é˜²æ­¢ä½ çŠ¯æ­¤é”™è¯¯ã€‚è¿™ä¸ª equals æ–¹æ³•ä¸ä¼šç¼–è¯‘ï¼Œé”™è¯¯æ¶ˆæ¯ä¼šå‘Šè¯‰ä½ ä»€ä¹ˆæ˜¯é”™è¯¯çš„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Still broken, but wonâ€™t compile
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Override</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">MyClass</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ç¼–å†™å’Œæµ‹è¯• equals ï¼ˆå’Œ hashCodeï¼‰æ–¹æ³•å¾ˆä¹å‘³ï¼Œç”Ÿæˆçš„ä»£ç ä¹Ÿå¾ˆå•è°ƒã€‚æ‰‹åŠ¨ç¼–å†™å’Œæµ‹è¯•è¿™äº›æ–¹æ³•çš„ä¸€ä¸ªå¾ˆå¥½çš„æ›¿ä»£æ–¹æ³•æ˜¯ä½¿ç”¨è°·æ­Œçš„å¼€æº AutoValue æ¡†æ¶ï¼Œå®ƒä¼šè‡ªåŠ¨ä¸ºä½ ç”Ÿæˆè¿™äº›æ–¹æ³•ï¼Œç”±ç±»ä¸Šçš„ä¸€ä¸ªæ³¨é‡Šè§¦å‘ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒAutoValue ç”Ÿæˆçš„æ–¹æ³•ä¸ä½ è‡ªå·±ç¼–å†™çš„æ–¹æ³•åŸºæœ¬ç›¸åŒã€‚</p>
<p>IDE ä¹Ÿæœ‰ç”Ÿæˆ equals å’Œ hashCode æ–¹æ³•çš„åŠŸèƒ½ï¼Œä½†æ˜¯ç”Ÿæˆçš„æºä»£ç æ¯”ä½¿ç”¨ AutoValue çš„ä»£ç æ›´å†—é•¿ï¼Œå¯è¯»æ€§æ›´å·®ï¼Œä¸ä¼šè‡ªåŠ¨è·Ÿè¸ªç±»ä¸­çš„å˜åŒ–ï¼Œå› æ­¤éœ€è¦è¿›è¡Œæµ‹è¯•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè®© IDE ç”Ÿæˆ equalsï¼ˆå’Œ hashCodeï¼‰æ–¹æ³•é€šå¸¸æ¯”æ‰‹åŠ¨å®ç°æ›´å¯å–ï¼Œå› ä¸º IDE ä¸ä¼šå‡ºç°ç²—å¿ƒçš„é”™è¯¯ï¼Œè€Œäººä¼šã€‚</p>
<p>æ€»ä¹‹ï¼Œé™¤éå¿…é¡»ï¼Œå¦åˆ™ä¸è¦è¦†ç›– equals æ–¹æ³•ï¼šåœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œä» Object ç»§æ‰¿è€Œæ¥çš„å®ç°æ­£æ˜¯ä½ æƒ³è¦çš„ã€‚å¦‚æœä½ ç¡®å®è¦†ç›–äº† equalsï¼Œé‚£ä¹ˆä¸€å®šè¦æ¯”è¾ƒç±»çš„æ‰€æœ‰é‡è¦å­—æ®µï¼Œå¹¶ä»¥ä¿ç•™ equals çº¦å®šçš„æ‰€æœ‰ 5 é¡¹è§„å®šçš„æ–¹å¼è¿›è¡Œæ¯”è¾ƒã€‚</p>
</li>
</ul>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>ã€ŠEffective Javaã€‹ç¬¬ä¸‰ç‰ˆçš„ç¬¬10æ¡å†…å®¹è®²è§£äº†åœ¨é‡å†™Javaä¸­çš„<code>equals</code>æ–¹æ³•æ—¶ï¼Œéµå¾ªé€šç”¨åå®šçš„é‡è¦æ€§ã€‚<code>equals</code>æ–¹æ³•ç”¨äºç¡®å®šä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ã€‚</p>
<p>é€šç”¨åå®šå®šä¹‰äº†<code>equals</code>æ–¹æ³•å¿…é¡»å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p>
<ol>
<li>åå°„æ€§ï¼šå¯¹äºä»»ä½•éç©ºçš„<code>x</code>ï¼Œ<code>x.equals(x)</code>å¿…é¡»è¿”å›<code>true</code>ã€‚</li>
<li>å¯¹ç§°æ€§ï¼šå¯¹äºä»»ä½•éç©ºå¼•ç”¨<code>x</code>å’Œ<code>y</code>ï¼Œå¦‚æœ<code>x.equals(y)</code>è¿”å›<code>true</code>ï¼Œåˆ™<code>y.equals(x)</code>å¿…é¡»è¿”å›<code>true</code>ã€‚</li>
<li>ä¼ é€’æ€§ï¼šå¯¹äºä»»ä½•éç©ºå¼•ç”¨<code>x</code>ã€<code>y</code>å’Œ<code>z</code>ï¼Œå¦‚æœ<code>x.equals(y)</code>è¿”å›<code>true</code>å¹¶ä¸”<code>y.equals(z)</code>è¿”å›<code>true</code>ï¼Œåˆ™<code>x.equals(z)</code>å¿…é¡»è¿”å›<code>true</code>ã€‚</li>
<li>ä¸€è‡´æ€§ï¼šå¯¹äºä»»ä½•éç©ºå¼•ç”¨<code>x</code>å’Œ<code>y</code>ï¼Œå¤šæ¬¡è°ƒç”¨<code>x.equals(y)</code>å¿…é¡»å§‹ç»ˆè¿”å›<code>true</code>æˆ–å§‹ç»ˆè¿”å›<code>false</code>ï¼Œå‰ææ˜¯åœ¨equalsæ¯”è¾ƒä¸­ä½¿ç”¨çš„ä¿¡æ¯æœªè¢«ä¿®æ”¹ã€‚</li>
<li>å¯ç©ºæ€§ï¼šå¯¹äºä»»ä½•éç©ºå¼•ç”¨<code>x</code>ï¼Œ<code>x.equals(null)</code>å¿…é¡»è¿”å›<code>false</code>ã€‚</li>
</ol>
<p>åœ¨é‡å†™<code>equals</code>æ–¹æ³•æ—¶ï¼Œé‡è¦çš„æ˜¯è¦ç¡®ä¿æ»¡è¶³è¿™äº›ç‰¹æ€§ã€‚æ­¤å¤–ï¼Œå»ºè®®éµå¾ªä¸€äº›æœ€ä½³å®è·µï¼Œä¾‹å¦‚ï¼š</p>
<ol>
<li>
<p>æ¯”è¾ƒå‰æ£€æŸ¥å¼•ç”¨æ˜¯å¦ç›¸åŒï¼šå¦‚æœä¸¤ä¸ªå¯¹è±¡å¼•ç”¨ç›¸åŒï¼Œå³å®ƒä»¬æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒä»¬ä¸€å®šç›¸ç­‰ã€‚åœ¨æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡ä¹‹å‰ï¼Œé¦–å…ˆä½¿ç”¨<code>==</code>è¿ç®—ç¬¦æ£€æŸ¥å®ƒä»¬çš„å¼•ç”¨æ˜¯å¦ç›¸åŒï¼Œä»¥æé«˜æ•ˆç‡ã€‚</p>
</li>
<li>
<p>æ¯”è¾ƒå¯¹è±¡ç±»å‹ï¼šåœ¨æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡ä¹‹å‰ï¼Œé¦–å…ˆä½¿ç”¨<code>instanceof</code>è¿ç®—ç¬¦æ£€æŸ¥å®ƒä»¬æ˜¯å¦å±äºåŒä¸€ä¸ªç±»ã€‚å¦‚æœä¸æ˜¯ï¼Œé‚£ä¹ˆå®ƒä»¬ä¸å¯èƒ½ç›¸ç­‰ã€‚è¿™æ ·å¯ä»¥é¿å…åœ¨ç»§æ‰¿å±‚æ¬¡ç»“æ„ä¸­å‡ºç°é—®é¢˜ã€‚</p>
</li>
<li>
<p>æ¯”è¾ƒæ¯ä¸ªé‡è¦å­—æ®µï¼šåœ¨æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ—¶ï¼Œéœ€è¦æ¯”è¾ƒå®ƒä»¬çš„æ¯ä¸ªé‡è¦å­—æ®µã€‚å¯¹äºåŸºæœ¬ç±»å‹å­—æ®µï¼Œä½¿ç”¨<code>==</code>è¿ç®—ç¬¦è¿›è¡Œæ¯”è¾ƒï¼›å¯¹äºå¯¹è±¡å¼•ç”¨å­—æ®µï¼Œé€’å½’è°ƒç”¨<code>Objects.equals()</code>æ–¹æ³•æ¯”è¾ƒï¼›å¯¹äº<code>float</code>å’Œ<code>double</code>ç±»å‹çš„å­—æ®µï¼Œä½¿ç”¨<code>Float.compare</code>å’Œ<code>Double.compare</code>æ–¹æ³•è¿›è¡Œæ¯”è¾ƒï¼›å¯¹äºæ•°ç»„å­—æ®µï¼Œä½¿ç”¨<code>Arrays.equals</code>æ–¹æ³•è¿›è¡Œæ¯”è¾ƒã€‚</p>
</li>
<li>
<p>è¦†ç›–<code>hashCode</code>æ–¹æ³•ï¼šæ ¹æ®é€šç”¨åå®šï¼Œå¦‚æœä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼Œå®ƒä»¬çš„<code>hashCode</code>å€¼ä¹Ÿå¿…é¡»ç›¸ç­‰ã€‚å› æ­¤ï¼Œåœ¨é‡å†™<code>equals</code>æ–¹æ³•æ—¶ï¼Œé€šå¸¸ä¹Ÿéœ€è¦é‡å†™<code>hashCode</code>æ–¹æ³•ï¼Œä»¥ç¡®ä¿å¯¹è±¡çš„ç›¸ç­‰æ€§è¢«æ­£ç¡®åœ°åˆ¤æ–­ï¼Œå¹¶ä¸”é¿å…æ•£åˆ—è¡¨ä¸­å‡ºç°å“ˆå¸Œå†²çªã€‚</p>
</li>
<li>
<p>è€ƒè™‘ä½¿ç”¨<code>@Override</code>æ³¨é‡ŠæŒ‡ç¤ºæ‚¨æ­£åœ¨è¦†ç›–<code>equals</code>æ–¹æ³•ã€‚</p>
</li>
<li>
<p>ä¸å°†<code>equals</code>æ–¹æ³•å®šä¹‰ä¸ºåªæ¥å—ç‰¹å®šç±»å‹çš„å‚æ•°ï¼š<code>equals</code>æ–¹æ³•çš„å‚æ•°ç±»å‹åº”è¯¥æ˜¯<code>Object</code>ç±»å‹ï¼Œè€Œä¸æ˜¯å…·ä½“çš„ç±»æˆ–æ¥å£ç±»å‹ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿<code>equals</code>æ–¹æ³•å¯ä»¥æ¯”è¾ƒä»»ä½•ç±»å‹çš„å¯¹è±¡ï¼Œè€Œä¸ä»…ä»…æ˜¯ç‰¹å®šç±»å‹çš„å¯¹è±¡ã€‚</p>
</li>
<li>
<p>ä¸ä½¿ç”¨<code>getClass</code>æ–¹æ³•æ¯”è¾ƒå¯¹è±¡ç±»å‹ï¼šåœ¨æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„ç±»å‹æ—¶ï¼Œä¸åº”è¯¥ä½¿ç”¨<code>getClass</code>æ–¹æ³•ï¼Œè€Œåº”è¯¥ä½¿ç”¨<code>instanceof</code>è¿ç®—ç¬¦ã€‚è¿™æ˜¯å› ä¸º<code>getClass</code>æ–¹æ³•å¯èƒ½ä¼šè¢«å­ç±»é‡å†™ï¼Œå¹¶è¿”å›ä¸åŒçš„ç»“æœï¼Œä»è€Œå¯¼è‡´æ¯”è¾ƒç»“æœå‡ºç°é—®é¢˜ã€‚</p>
</li>
<li>
<p>ä¸å°†<code>equals</code>æ–¹æ³•ä¸<code>==</code>è¿ç®—ç¬¦æ··æ·†ï¼š<code>equals</code>æ–¹æ³•ç”¨äºæ¯”è¾ƒå¯¹è±¡çš„å†…å®¹ï¼Œè€Œ<code>==</code>è¿ç®—ç¬¦ç”¨äºæ¯”è¾ƒå¯¹è±¡çš„å¼•ç”¨ã€‚åœ¨æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ—¶ï¼Œåº”è¯¥ä½¿ç”¨<code>equals</code>æ–¹æ³•è€Œä¸æ˜¯<code>==</code>è¿ç®—ç¬¦ã€‚</p>
</li>
<li>
<p>ä¸å°†<code>equals</code>æ–¹æ³•ä¸<code>compareTo</code>æ–¹æ³•æ··æ·†ï¼š<code>equals</code>æ–¹æ³•ç”¨äºæ¯”è¾ƒå¯¹è±¡çš„å†…å®¹ï¼Œè€Œ<code>compareTo</code>æ–¹æ³•ç”¨äºæ¯”è¾ƒå¯¹è±¡çš„é¡ºåºã€‚åœ¨æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ—¶ï¼Œåº”è¯¥ä½¿ç”¨é€‚å½“çš„æ–¹æ³•ï¼Œé¿å…æ··æ·†å®ƒä»¬çš„ä½œç”¨ã€‚</p>
</li>
</ol>
]]></content:encoded>
    </item>
    
    <item>
      <title>Git Flowåˆ†æ”¯æ¨¡å‹å’Œä½¿ç”¨</title>
      <link>https://blog.chensoul.com/posts/2023/05/11/git-flow-model-and-usage/</link>
      <pubDate>Thu, 11 May 2023 14:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/05/11/git-flow-model-and-usage/</guid>
      <description>ä»‹ç» Git Flow æ˜¯ç”±Vincent Driessenåœ¨2010å¹´æå‡ºçš„ä¸€ç§Gitå·¥ä½œæµã€‚åœ¨è¿™ä¹‹å‰ï¼ŒGitæ²¡æœ‰ä¸€ä¸ªæ˜ç¡®çš„æ ‡å‡†å·¥ä½œæµï¼Œå¯¼è‡´å›¢é˜Ÿåœ¨ä½¿ç”¨Git</description>
      <content:encoded><![CDATA[<h2 id="ä»‹ç»">ä»‹ç»</h2>
<p><a href="https://nvie.com/posts/a-successful-git-branching-model/">Git Flow</a> æ˜¯ç”±Vincent Driessenåœ¨2010å¹´æå‡ºçš„ä¸€ç§Gitå·¥ä½œæµã€‚åœ¨è¿™ä¹‹å‰ï¼ŒGitæ²¡æœ‰ä¸€ä¸ªæ˜ç¡®çš„æ ‡å‡†å·¥ä½œæµï¼Œå¯¼è‡´å›¢é˜Ÿåœ¨ä½¿ç”¨Gitæ—¶å¾€å¾€ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ï¼Œå¦‚åˆ†æ”¯ç®¡ç†ã€ç‰ˆæœ¬æ§åˆ¶ç­‰ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼ŒVincent Driessenæå‡ºäº†Git Flowåˆ†æ”¯æ¨¡å‹ï¼Œæˆä¸ºäº†Gitåœ¨å®é™…åº”ç”¨ä¸­çš„ä¸€ç§æ ‡å‡†å·¥ä½œæµã€‚</p>
<p>éšç€æ—¶é—´çš„æ¨ç§»ï¼ŒGit Flowä¹Ÿåœ¨ä¸æ–­å‘å±•å’Œå®Œå–„ã€‚åœ¨2011å¹´ï¼ŒAtlassianå‘å¸ƒäº†SourceTreeï¼Œè¿™æ˜¯ä¸€æ¬¾å›¾å½¢åŒ–çš„Gitå®¢æˆ·ç«¯ï¼Œæ”¯æŒGit Flowåˆ†æ”¯æ¨¡å‹ã€‚åœ¨2013å¹´ï¼ŒGit Flowçš„ä¸€äº›å¼€å‘è€…å‘å¸ƒäº†Git Flow AVH Editionï¼Œè¿™æ˜¯Git Flowçš„ä¸€ä¸ªå¢å¼ºç‰ˆæœ¬ï¼Œæä¾›äº†æ›´å¤šçš„åŠŸèƒ½å’Œé€‰é¡¹ã€‚æ­¤å¤–ï¼ŒGit Flowè¿˜å¾—åˆ°äº†å…¶ä»–å¼€æºå·¥å…·å’Œå¹³å°çš„æ”¯æŒï¼Œå¦‚GitHubã€GitLabç­‰ã€‚</p>
<h2 id="git-flow-åˆ†æ”¯æ¨¡å‹">Git Flow åˆ†æ”¯æ¨¡å‹</h2>
<p>Git Flowåˆ†æ”¯æ¨¡å‹å®šä¹‰äº†ä¸€ç§æ ‡å‡†çš„Gitåˆ†æ”¯æ¨¡å‹ï¼Œå®ƒå°†ä»£ç åˆ†ä¸ºä¸¤ä¸ªé•¿æœŸåˆ†æ”¯ï¼ˆmasterå’Œdevelopï¼‰å’Œä¸‰ä¸ªçŸ­æœŸåˆ†æ”¯ï¼ˆfeatureã€releaseå’Œhotfixï¼‰ï¼Œä½¿å¾—å›¢é˜Ÿå¯ä»¥æ›´å¥½åœ°ç®¡ç†ä»£ç çš„ç‰ˆæœ¬å’Œå‘å¸ƒã€‚</p>
<p>ä»¥ä¸‹æ˜¯Git Flowåˆ†æ”¯æ¨¡å‹çš„è¯¦ç»†ä»‹ç»ï¼š</p>
<ol>
<li>masteråˆ†æ”¯
masteråˆ†æ”¯æ˜¯ä»£ç åº“çš„ä¸»åˆ†æ”¯ï¼Œå®ƒåŒ…å«äº†æ‰€æœ‰å·²å‘å¸ƒçš„ä»£ç å’Œç‰ˆæœ¬ã€‚æ‰€æœ‰ä»£ç éƒ½åº”è¯¥åœ¨è¯¥åˆ†æ”¯ä¸Šè¿›è¡Œæµ‹è¯•å’ŒéªŒè¯ï¼Œä»¥ç¡®ä¿ä»£ç çš„è´¨é‡å’Œç¨³å®šæ€§ã€‚<code>masteråˆ†æ”¯åªèƒ½é€šè¿‡åˆå¹¶releaseæˆ–hotfixåˆ†æ”¯æ¥æ›´æ–°</code>ã€‚</li>
<li>developåˆ†æ”¯
developåˆ†æ”¯æ˜¯ä»£ç åº“çš„å¼€å‘åˆ†æ”¯ï¼Œå®ƒåŒ…å«äº†æ‰€æœ‰å¼€å‘ä¸­çš„ä»£ç å’ŒåŠŸèƒ½ã€‚æ‰€æœ‰æ–°çš„ä»£ç éƒ½åº”è¯¥åœ¨è¯¥åˆ†æ”¯ä¸Šè¿›è¡Œå¼€å‘å’Œæµ‹è¯•ï¼Œä»¥ç¡®ä¿ä»£ç çš„å¯é æ€§å’Œç¨³å®šæ€§ã€‚<code>developåˆ†æ”¯åªèƒ½é€šè¿‡åˆå¹¶featureåˆ†æ”¯æ¥æ›´æ–°</code>ã€‚</li>
<li>featureåˆ†æ”¯
featureåˆ†æ”¯æ˜¯ä¸ºå¼€å‘æ–°çš„åŠŸèƒ½æˆ–ä¿®å¤bugè€Œåˆ›å»ºçš„ä¸´æ—¶åˆ†æ”¯ã€‚<code>æ¯ä¸ªfeatureåˆ†æ”¯éƒ½æ˜¯ä»developåˆ†æ”¯åˆ†ç¦»å‡ºæ¥çš„ï¼Œå¼€å‘å®Œæˆåä¼šåˆå¹¶å›developåˆ†æ”¯</code>ã€‚featureåˆ†æ”¯çš„å‘½ååº”è¯¥æ¸…æ™°æ˜ç¡®ï¼Œä»¥åæ˜ è¯¥åˆ†æ”¯æ‰€æ¶‰åŠçš„åŠŸèƒ½æˆ–é—®é¢˜ã€‚</li>
<li>releaseåˆ†æ”¯
releaseåˆ†æ”¯æ˜¯ä¸ºå‘å¸ƒæ–°ç‰ˆæœ¬è€Œåˆ›å»ºçš„ä¸´æ—¶åˆ†æ”¯ã€‚<code>æ¯ä¸ªreleaseåˆ†æ”¯éƒ½æ˜¯ä»developåˆ†æ”¯åˆ†ç¦»å‡ºæ¥çš„ï¼Œå‘å¸ƒå®Œæˆåä¼šåˆå¹¶å›developåˆ†æ”¯å’Œmasteråˆ†æ”¯</code>ã€‚åœ¨releaseåˆ†æ”¯ä¸Šå¯ä»¥è¿›è¡Œä¸€äº›å°çš„ä¿®å¤å’Œè°ƒæ•´ï¼Œä»¥ç¡®ä¿å‘å¸ƒçš„ä»£ç çš„è´¨é‡å’Œç¨³å®šæ€§ã€‚</li>
<li>hotfixåˆ†æ”¯
hotfixåˆ†æ”¯æ˜¯ä¸ºå¿«é€Ÿä¿®å¤ç”Ÿäº§ç¯å¢ƒä¸­çš„é—®é¢˜è€Œåˆ›å»ºçš„ä¸´æ—¶åˆ†æ”¯ã€‚æ¯ä¸ªhotfixåˆ†æ”¯éƒ½æ˜¯ä»masteråˆ†æ”¯åˆ†ç¦»å‡ºæ¥çš„ï¼Œä¿®å¤å®Œæˆåä¼šåˆå¹¶å›developåˆ†æ”¯å’Œmasteråˆ†æ”¯ã€‚<code>hotfixåˆ†æ”¯çš„ä¼˜å…ˆçº§æ¯”å…¶ä»–åˆ†æ”¯æ›´é«˜ï¼Œå› ä¸ºå®ƒä»¬éœ€è¦å°½å¿«ä¿®å¤ç”Ÿäº§ç¯å¢ƒä¸­çš„é—®é¢˜ã€‚</code></li>
</ol>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/git-model@2x.png" alt="img"  />
</p>
<p>æ ¹æ®ä¸Šé¢çš„ç†è®ºï¼Œæˆ‘ä»¬æ¥å®é™…æ“ä½œä¸€éã€‚é¦–å…ˆï¼Œæ˜¯ develop åˆ†æ”¯åˆ›å»ºä¸€ä¸ª feature åˆ†æ”¯ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ git checkout -b feature-test develop
</span></span><span class="line"><span class="cl">Switched to a new branch <span class="s2">&#34;feature-test&#34;</span>
</span></span></code></pre></div><p>å°† feature åˆ†æ”¯çš„ä¿®æ”¹åˆå¹¶åˆ° develop åˆ†æ”¯ï¼Œç„¶ååˆ é™¤ feature åˆ†æ”¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ git checkout develop
</span></span><span class="line"><span class="cl">Switched to branch <span class="s1">&#39;develop&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ git merge --no-ff feature-test
</span></span><span class="line"><span class="cl">Updating ea1b82a..05e9557
</span></span><span class="line"><span class="cl"><span class="o">(</span>Summary of changes<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ git branch -d feature-test
</span></span><span class="line"><span class="cl">Deleted branch feature-test <span class="o">(</span>was 05e9557<span class="o">)</span>.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ git push origin develop
</span></span></code></pre></div><p>åˆå¹¶åˆ†æ”¯æ—¶ï¼Œæ·»åŠ <code>--no-ff</code> å‚æ•°å’Œä¸æ·»åŠ çš„åŒºåˆ«ï¼š</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/merge-without-ff@2x.png" alt="img"  />
</p>
<p>ä» develop åˆ†æ”¯åˆ›å»ºä¸€ä¸ª release åˆ†æ”¯ï¼Œå¹¶å°†ç‰ˆæœ¬å·æ”¹ä¸º 1.2 ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ git checkout -b release-1.2 develop
</span></span><span class="line"><span class="cl">Switched to a new branch <span class="s2">&#34;release-1.2&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ ./bump-version.sh 1.2
</span></span><span class="line"><span class="cl">Files modified successfully, version bumped to 1.2.
</span></span><span class="line"><span class="cl">$ git commit -a -m <span class="s2">&#34;Bumped version number to 1.2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>release-1.2 74d9424<span class="o">]</span> Bumped version number to 1.2
</span></span><span class="line"><span class="cl"><span class="m">1</span> files changed, <span class="m">1</span> insertions<span class="o">(</span>+<span class="o">)</span>, <span class="m">1</span> deletions<span class="o">(</span>-<span class="o">)</span>
</span></span></code></pre></div><p>release åˆ†æ”¯å®Œæˆå¼€å‘ä¹‹åï¼Œå°† release åˆ†æ”¯åˆå¹¶åˆ° master åˆ†æ”¯ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ ‡ç­¾ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ git checkout master
</span></span><span class="line"><span class="cl">Switched to branch <span class="s1">&#39;master&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ git merge --no-ff release-1.2
</span></span><span class="line"><span class="cl">Merge made by recursive.
</span></span><span class="line"><span class="cl"><span class="o">(</span>Summary of changes<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ git tag -a 1.2
</span></span></code></pre></div><p>å°† release åˆ†æ”¯åˆå¹¶åˆ° develop åˆ†æ”¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ git checkout develop
</span></span><span class="line"><span class="cl">Switched to branch <span class="s1">&#39;develop&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ git merge --no-ff release-1.2
</span></span><span class="line"><span class="cl">Merge made by recursive.
</span></span><span class="line"><span class="cl"><span class="o">(</span>Summary of changes<span class="o">)</span>
</span></span></code></pre></div><p>æœ€ååˆ é™¤ release åˆ†æ”¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ git branch -d release-1.2
</span></span><span class="line"><span class="cl">Deleted branch release-1.2 <span class="o">(</span>was ff452fe<span class="o">)</span>.
</span></span></code></pre></div><p>å¯¹äº hoftfix åˆ†æ”¯ï¼Œæ“ä½œæ­¥éª¤å’Œ release åˆ†æ”¯ç±»ä¼¼ï¼Œæ•…ä¸åœ¨èµ˜è¿°ã€‚</p>
<h2 id="git-flow-å·¥å…·">git-flow å·¥å…·</h2>
<p>git-flow å·¥å…·å¯ä»¥ç®€åŒ–ä¸Šé¢çš„æ“ä½œæ­¥éª¤ï¼Œå…³äº git-flowçš„ä»‹ç»å¯ä»¥å‚è€ƒæ–‡ç« ï¼š<a href="https://jeffkreeftmeijer.com/git-flow/">Using git-flow to automate your git branching workflow</a>ã€‚</p>
<p>macos ä¸Šå®‰è£… git-flowï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">brew install git-flow
</span></span></code></pre></div><p>git-flow é¦–å…ˆéœ€è¦åˆå§‹åŒ–ï¼Œå¦‚æœä¸å­˜åœ¨ develop åˆ†æ”¯ï¼Œåˆ™ä¼šæ–°å»ºä¸€ä¸ª develop åˆ†æ”¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git flow init
</span></span><span class="line"><span class="cl">No branches exist yet. Base branches must be created now.
</span></span><span class="line"><span class="cl">Branch name <span class="k">for</span> production releases: <span class="o">[</span>master<span class="o">]</span>
</span></span><span class="line"><span class="cl">Branch name <span class="k">for</span> <span class="s2">&#34;next release&#34;</span> development: <span class="o">[</span>develop<span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">How to name your supporting branch prefixes?
</span></span><span class="line"><span class="cl">Feature branches? <span class="o">[</span>feature-<span class="o">]</span>
</span></span><span class="line"><span class="cl">Release branches? <span class="o">[</span>release-<span class="o">]</span>
</span></span><span class="line"><span class="cl">Hotfix branches? <span class="o">[</span>hotfix/<span class="o">]</span>
</span></span><span class="line"><span class="cl">Support branches? <span class="o">[</span>support/<span class="o">]</span>
</span></span><span class="line"><span class="cl">Version tag prefix? <span class="o">[]</span>
</span></span></code></pre></div><h3 id="feature-åˆ†æ”¯">feature åˆ†æ”¯</h3>
<p>å¼€å‘ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œåˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯ foo</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="err">$</span> <span class="nx">git</span> <span class="nx">flow</span> <span class="nx">feature</span> <span class="nx">start</span> <span class="nx">foo</span>
</span></span></code></pre></div><p>ç­‰ä»·äº</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#åˆ‡æ¢åˆ°developåˆ†æ”¯,ç¡®ä¿æ–°çš„ feature åˆ†æ”¯æ˜¯åŸºäºæœ€æ–°çš„ develop åˆ†æ”¯åˆ›å»ºçš„ã€‚</span>
</span></span><span class="line"><span class="cl">$ git checkout -b feature-foo develop
</span></span></code></pre></div><p>å–æ¶ˆæ­£åœ¨è¿›è¡Œä¸­çš„åŠŸèƒ½åˆ†æ”¯ï¼Œå¹¶ä¸”ä¼šå°†åˆ†æ”¯åˆ é™¤</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ git flow feature delete foo
</span></span></code></pre></div><p>ç­‰ä»·äº</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ git branch -D feature-foo
</span></span></code></pre></div><p>foo åŠŸèƒ½è‡ªæµ‹é€šè¿‡åï¼Œåˆå¹¶åˆ° develop</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ git flow feature finish foo
</span></span></code></pre></div><p>ç­‰ä»·äº</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">//åˆ‡æ¢åˆ° develop åˆ†æ”¯
</span></span><span class="line"><span class="cl">$ git checkout develop
</span></span><span class="line"><span class="cl">//å°† feature-foo åˆ†æ”¯ä¸­çš„æ›´æ”¹åˆå¹¶åˆ° develop åˆ†æ”¯ã€‚ --no-ff å‚æ•°å°†ä¿ç•™ foo åˆ†æ”¯çš„commitè®°å½•ã€‚
</span></span><span class="line"><span class="cl">$ git merge --no-ff feature-foo
</span></span><span class="line"><span class="cl">//åˆ é™¤å·²å®Œæˆçš„åˆ†æ”¯
</span></span><span class="line"><span class="cl">$ git branch -d feature-foo
</span></span></code></pre></div><h3 id="release-åˆ†æ”¯">release åˆ†æ”¯</h3>
<p>å½“æ‰€æœ‰æ–°çš„åŠŸèƒ½å’Œå¿…è¦çš„ä¿®å¤å·²ç»è¢«å½»åº•çš„æµ‹è¯•è¿‡äº†ï¼Œé‚£å°±å¼€å§‹ç”Ÿæˆä¸€ä¸ªæ–°çš„ release , åœ¨æ­¤ä¹‹åä¸èƒ½æ·»åŠ æ–°åŠŸèƒ½ï¼Œåªæœ‰é”™è¯¯ä¿®å¤ã€æ–‡æ¡£ç”Ÿæˆå’Œå…¶ä»–é¢å‘å‘å¸ƒçš„ä»»åŠ¡åº”è¯¥åœ¨è¯¥åˆ†æ”¯ä¸­è¿›è¡Œã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 1.0.0 æ˜¯ç‰ˆæœ¬å·</span>
</span></span><span class="line"><span class="cl">$ git flow release start 1.0.0
</span></span></code></pre></div><p>ç­‰ä»·äº</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># ä» develop åˆ†æ”¯ åˆ›å»ºreleaseåˆ†æ”¯</span>
</span></span><span class="line"><span class="cl">$ git checkout -b release-1.0.0 develop
</span></span></code></pre></div><p>å–æ¶ˆæ­£åœ¨è¿›è¡Œä¸­çš„å‘å¸ƒåˆ†æ”¯ï¼Œå¹¶ä¸”ä¼šå°†åˆ†æ”¯åˆ é™¤ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ git flow release delete 1.0.0
</span></span></code></pre></div><p>ç­‰ä»·äº</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git branch -D release-1.0.0
</span></span></code></pre></div><p>æ·»åŠ å®Œå‘å¸ƒæ–‡æ¡£ä¹‹åï¼Œå®Œæˆ release</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ git flow release finish 1.0.0
</span></span></code></pre></div><p>ç­‰ä»·äº</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#åˆ‡æ¢åˆ° develop åˆ†æ”¯ã€‚</span>
</span></span><span class="line"><span class="cl">$ git checkout develop
</span></span><span class="line"><span class="cl"><span class="c1">#å°† release-1.0.0 åˆ†æ”¯åˆå¹¶åˆ° develop åˆ†æ”¯ï¼Œ--no-ff é€‰é¡¹ä»¥ä¿ç•™ feature åˆ†æ”¯çš„ commit è®°å½•</span>
</span></span><span class="line"><span class="cl">$ git merge --no-ff release-1.0.0
</span></span><span class="line"><span class="cl"><span class="c1">#åˆ›å»ºä¸€ä¸ªåä¸º 1.0.0 çš„æ ‡ç­¾</span>
</span></span><span class="line"><span class="cl">$ git tag -a 1.0.0 -m <span class="s2">&#34;Release 1.0.0&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#åˆ‡æ¢åˆ° master åˆ†æ”¯ã€‚</span>
</span></span><span class="line"><span class="cl">$ git checkout master
</span></span><span class="line"><span class="cl"><span class="c1">#å°† release-1.0.0 åˆ†æ”¯åˆå¹¶åˆ° master åˆ†æ”¯ï¼Œ--no-ff é€‰é¡¹ä»¥ä¿ç•™ feature åˆ†æ”¯çš„ commit è®°å½•</span>
</span></span><span class="line"><span class="cl">$ git merge --no-ff release-1.0.0
</span></span><span class="line"><span class="cl"><span class="c1">#åˆ é™¤ release-1.0.0 åˆ†æ”¯ã€‚</span>
</span></span><span class="line"><span class="cl">$ git branch -d release-1.0.0
</span></span></code></pre></div><h3 id="hotfixes-åˆ†æ”¯">Hotfixes åˆ†æ”¯</h3>
<p>çº¿ä¸Šå‘ç”Ÿé—®é¢˜çš„æ—¶å€™ï¼Œå…ˆå›æ»šåˆ°ä¹‹å‰çš„ç¨³å®šç‰ˆæœ¬ï¼Œç¨³å®šå±€åŠ¿
ç„¶ååˆ›å»ºçƒ­ä¿®å¤åˆ†æ”¯å¼€å§‹æ”¹ BUG</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ git flow hotfix start 1.0.1
</span></span></code></pre></div><p>ç­‰ä»·äº</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#ä»masteråˆ†æ”¯ åˆ›å»ºä¸€ä¸ªhotfix/1.0.1åˆ†æ”¯</span>
</span></span><span class="line"><span class="cl">$ git checkout -b hotfix/1.0.1 foo master
</span></span></code></pre></div><p>ç´§æ€¥ä¿®å¤å®Œæ¯•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ git flow hotfix finish 1.0.1
</span></span></code></pre></div><p>ç­‰ä»·äº</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#åˆ‡æ¢ master åˆ†æ”¯</span>
</span></span><span class="line"><span class="cl">$ git checkout master
</span></span><span class="line"><span class="cl"><span class="c1">#åˆå¹¶çƒ­ä¿®å¤åˆ†æ”¯åˆ°master,--no-ff é€‰é¡¹ä»¥ä¿ç•™ feature åˆ†æ”¯çš„ commit è®°å½•</span>
</span></span><span class="line"><span class="cl">$ git merge --no-ff hotfix/ohno
</span></span><span class="line"><span class="cl"><span class="c1">#åˆ›å»ºä¸€ä¸ªåä¸º 1.0.1 çš„æ ‡ç­¾</span>
</span></span><span class="line"><span class="cl">$ git tag 1.0.1
</span></span><span class="line"><span class="cl"><span class="c1">#åˆ‡æ¢åˆ° develop åˆ†æ”¯</span>
</span></span><span class="line"><span class="cl">$ git checkout develop
</span></span><span class="line"><span class="cl"><span class="c1">#åˆå¹¶çƒ­ä¿®å¤åˆ†æ”¯åˆ° develop ,--no-ff é€‰é¡¹ä»¥ä¿ç•™ feature åˆ†æ”¯çš„ commit è®°å½•</span>
</span></span><span class="line"><span class="cl">$ git merge --no-ff hotfix/1.0.1
</span></span><span class="line"><span class="cl"><span class="c1">#åˆ é™¤çƒ­ä¿®å¤åˆ†æ”¯</span>
</span></span><span class="line"><span class="cl">$ git branch -d hotfix/1.0.1
</span></span></code></pre></div><h2 id="git-flow-avh-edition">git-flow (AVH Edition)</h2>
<p>Git-flow (AVH Edition)æ˜¯Git Flowçš„ä¸€ä¸ªå¢å¼ºç‰ˆæœ¬ï¼Œç”±ä¸€äº›Git Flowçš„å¼€å‘è€…å¼€å‘å’Œç»´æŠ¤ã€‚Git-flow (AVH Edition)åœ¨ä¿ç•™Git FlowåŸºæœ¬æ€æƒ³çš„å‰æä¸‹ï¼Œå¢åŠ äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œé€‰é¡¹ï¼Œä½¿å¾—Git Flowæ›´åŠ çµæ´»å’Œé€‚ç”¨äºä¸åŒçš„å›¢é˜Ÿå’Œé¡¹ç›®ã€‚</p>
<p>Git-flow (AVH Edition)çš„ä¸»è¦å¢å¼ºåŠŸèƒ½åŒ…æ‹¬ï¼š</p>
<ol>
<li>æ”¯æŒgit-flow initå‘½ä»¤ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªæ–°çš„Gitä»“åº“ä¸­å¿«é€Ÿåˆå§‹åŒ–Git Flowã€‚</li>
<li>æ”¯æŒgit flow feature pullå‘½ä»¤ï¼Œå¯ä»¥æ‹‰å–å…¶ä»–å›¢é˜Ÿæˆå‘˜çš„featureåˆ†æ”¯ã€‚</li>
<li>æ”¯æŒgit flow feature publishå‘½ä»¤ï¼Œå¯ä»¥å°†featureåˆ†æ”¯å‘å¸ƒåˆ°è¿œç¨‹ä»“åº“ã€‚</li>
<li>æ”¯æŒgit flow hotfix finishå‘½ä»¤ï¼Œå¯ä»¥åœ¨ä¿®å¤ç”Ÿäº§ç¯å¢ƒé—®é¢˜æ—¶è‡ªåŠ¨åˆå¹¶åˆ°developåˆ†æ”¯å’Œmasteråˆ†æ”¯å¹¶å‘å¸ƒæ–°ç‰ˆæœ¬ã€‚</li>
<li>æ”¯æŒgit flow supportåˆ†æ”¯ï¼Œå¯ä»¥ä¸ºæ—§ç‰ˆæœ¬æä¾›é•¿æœŸæ”¯æŒã€‚</li>
<li>å…è®¸ä½¿ç”¨Hooks and Filtersæ¥æ‰©å±•å’Œè‡ªå®šä¹‰Git Flowçš„è¡Œä¸ºã€‚</li>
</ol>
<p>é™¤äº†ä»¥ä¸ŠåŠŸèƒ½ä¹‹å¤–ï¼ŒGit-flow (AVH Edition)è¿˜æä¾›äº†æ›´å¤šçš„é€‰é¡¹å’Œé…ç½®ï¼Œä½¿å¾—å›¢é˜Ÿå¯ä»¥æ ¹æ®ä¸åŒçš„éœ€æ±‚å’Œæƒ…å†µæ¥è‡ªå®šä¹‰Git Flowçš„åˆ†æ”¯æ¨¡å‹å’Œå·¥ä½œæµç¨‹ã€‚</p>
<h3 id="åˆå§‹åŒ–">åˆå§‹åŒ–</h3>
<p>ä½¿ç”¨ä¸‹é¢å‘½ä»¤åˆå§‹åŒ– git fowï¼Œ<code>-d</code> æ˜¯å¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºä½¿ç”¨é»˜è®¤å‚æ•°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git flow init <span class="o">[</span>-d<span class="o">]</span>
</span></span></code></pre></div><h3 id="åˆ›å»º-featurereleasehotfixsupport--åˆ†æ”¯">åˆ›å»º feature/release/hotfix/support  åˆ†æ”¯</h3>
<p>æŸ¥çœ‹ã€å¼€å§‹ã€å®Œæˆã€åˆ é™¤ feature åˆ†æ”¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git flow feature
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># &lt;base&gt; å‚æ•°å¿…é¡»æ˜¯åˆ†æ”¯åç§°ï¼Œç¼ºå¤±æ—¶ï¼Œé»˜è®¤ä¸º develop åˆ†æ”¯</span>
</span></span><span class="line"><span class="cl">git flow feature start &lt;name&gt; <span class="o">[</span>&lt;base&gt;<span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">git flow feature finish &lt;name&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">git flow feature delete &lt;name&gt;
</span></span></code></pre></div><p>å‘å¸ƒæˆ–è€…è·Ÿè¸ª feature åˆ†æ”¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#å¦‚æœå½“å‰åœ¨ feature/name åˆ†æ”¯ï¼Œåˆ™å¯ä»¥çœç•¥ &lt;name&gt; å‚æ•°</span>
</span></span><span class="line"><span class="cl">git flow feature publish &lt;name&gt;
</span></span><span class="line"><span class="cl">git flow feature track &lt;name&gt;
</span></span></code></pre></div><p>å½“ feature åˆ†æ”¯å‘å¸ƒä¹‹åï¼Œå…¶ä»–äººå¯ä»¥æ‹‰å–è¯¥åˆ†æ”¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git pull
</span></span><span class="line"><span class="cl">git checkout feature/&lt;name&gt;
</span></span></code></pre></div><p>ç±»ä¼¼åœ°ï¼ŒæŸ¥çœ‹ã€å¼€å§‹ã€å®Œæˆã€åˆ é™¤ release åˆ†æ”¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git flow release
</span></span><span class="line"><span class="cl">git flow release start &lt;name&gt; <span class="o">[</span>&lt;base&gt;<span class="o">]</span>
</span></span><span class="line"><span class="cl">git flow release finish &lt;name&gt;
</span></span><span class="line"><span class="cl">git flow release delete &lt;name&gt;
</span></span></code></pre></div><p>ç±»ä¼¼åœ°ï¼ŒæŸ¥çœ‹ã€å¼€å§‹ã€å®Œæˆã€åˆ é™¤ hotfix åˆ†æ”¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">git flow hotfix
</span></span><span class="line"><span class="cl">git flow hotfix start &lt;name&gt; [&lt;base&gt;]
</span></span><span class="line"><span class="cl">git flow hotfix finish &lt;name&gt;
</span></span><span class="line"><span class="cl">git flow hotfix delete &lt;name&gt;
</span></span></code></pre></div><p>æŸ¥çœ‹ã€å¼€å§‹ support åˆ†æ”¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git flow support
</span></span><span class="line"><span class="cl">git flow support start &lt;name&gt; &lt;base&gt;
</span></span></code></pre></div><h3 id="hooks-å’Œ-filters">Hooks å’Œ Filters</h3>
<p>Git-flow (AVH Edition)å…è®¸ä½¿ç”¨Hooks and Filtersæ¥æ‰©å±•å’Œè‡ªå®šä¹‰Git Flowçš„è¡Œä¸ºã€‚Hookså’ŒFiltersæ˜¯Git Flowä¸­çš„ä¸¤ä¸ªå…³é”®æ¦‚å¿µï¼Œå®ƒä»¬å¯ä»¥åœ¨Git Flowçš„ä¸åŒé˜¶æ®µæ‰§è¡Œè‡ªå®šä¹‰è„šæœ¬æˆ–å‘½ä»¤ï¼Œä»è€Œå®ç°Git Flowçš„é«˜åº¦å®šåˆ¶åŒ–ã€‚</p>
<p>Hooksæ˜¯ä¸€äº›è„šæœ¬æˆ–å‘½ä»¤ï¼Œå®ƒä»¬ä¼šåœ¨Git Flowçš„ä¸åŒé˜¶æ®µè¢«è°ƒç”¨ã€‚Git Flow (AVH Edition)æ”¯æŒä»¥ä¸‹Hooksï¼š</p>
<ol>
<li>git-flow-init: è¯¥Hookä¼šåœ¨git-flow initå‘½ä»¤æ‰§è¡Œæ—¶è¢«è°ƒç”¨ã€‚</li>
<li>git-flow-feature-start: è¯¥Hookä¼šåœ¨åˆ›å»ºæ–°çš„featureåˆ†æ”¯æ—¶è¢«è°ƒç”¨ã€‚</li>
<li>git-flow-feature-finish: è¯¥Hookä¼šåœ¨å®Œæˆfeatureåˆ†æ”¯æ—¶è¢«è°ƒç”¨ã€‚</li>
<li>git-flow-release-start: è¯¥Hookä¼šåœ¨åˆ›å»ºæ–°çš„releaseåˆ†æ”¯æ—¶è¢«è°ƒç”¨ã€‚</li>
<li>git-flow-release-finish: è¯¥Hookä¼šåœ¨å®Œæˆreleaseåˆ†æ”¯æ—¶è¢«è°ƒç”¨ã€‚</li>
<li>git-flow-hotfix-start: è¯¥Hookä¼šåœ¨åˆ›å»ºæ–°çš„hotfixåˆ†æ”¯æ—¶è¢«è°ƒç”¨ã€‚</li>
<li>git-flow-hotfix-finish: è¯¥Hookä¼šåœ¨å®Œæˆhotfixåˆ†æ”¯æ—¶è¢«è°ƒç”¨ã€‚</li>
</ol>
<p>Filtersæ˜¯ä¸€äº›å‘½ä»¤æˆ–å‚æ•°ï¼Œå®ƒä»¬ä¼šåœ¨Git Flowçš„ä¸åŒé˜¶æ®µè¢«è¿‡æ»¤æˆ–ä¿®æ”¹ã€‚Git Flow (AVH Edition)æ”¯æŒä»¥ä¸‹Filtersï¼š</p>
<ol>
<li>git-flow-feature-start-message: å¯ä»¥ç”¨äºä¿®æ”¹featureåˆ†æ”¯åˆ›å»ºæ—¶çš„æäº¤ä¿¡æ¯ã€‚</li>
<li>git-flow-feature-finish-message: å¯ä»¥ç”¨äºä¿®æ”¹featureåˆ†æ”¯å®Œæˆæ—¶çš„æäº¤ä¿¡æ¯ã€‚</li>
<li>git-flow-release-start-message: å¯ä»¥ç”¨äºä¿®æ”¹releaseåˆ†æ”¯åˆ›å»ºæ—¶çš„æäº¤ä¿¡æ¯ã€‚</li>
<li>git-flow-release-finish-message: å¯ä»¥ç”¨äºä¿®æ”¹releaseåˆ†æ”¯å®Œæˆæ—¶çš„æäº¤ä¿¡æ¯ã€‚</li>
<li>git-flow-hotfix-start-message: å¯ä»¥ç”¨äºä¿®æ”¹hotfixåˆ†æ”¯åˆ›å»ºæ—¶çš„æäº¤ä¿¡æ¯ã€‚</li>
<li>git-flow-hotfix-finish-message: å¯ä»¥ç”¨äºä¿®æ”¹hotfixåˆ†æ”¯å®Œæˆæ—¶çš„æäº¤ä¿¡æ¯ã€‚</li>
</ol>
<p>ä¸‹é¢æ˜¯ä¸€äº›ä½¿ç”¨Hookså’ŒFiltersçš„ä¾‹å­ï¼š</p>
<ol>
<li>ä½¿ç”¨git-flow-init Hook</li>
</ol>
<p>å¦‚æœéœ€è¦åœ¨æ‰§è¡Œgit-flow initå‘½ä»¤æ—¶æ‰§è¡Œä¸€äº›è‡ªå®šä¹‰è„šæœ¬ï¼Œå¯ä»¥ä½¿ç”¨git-flow-init Hookã€‚å‡è®¾æˆ‘ä»¬æƒ³åœ¨git-flow initå‘½ä»¤æ‰§è¡Œæ—¶è¾“å‡ºä¸€äº›ä¿¡æ¯ï¼Œå¯ä»¥åœ¨<code>.git/hooks/git-flow-init</code>æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;Executing git-flow-init Hook&#34;</span>
</span></span></code></pre></div><ol start="2">
<li>ä½¿ç”¨git-flow-feature-start Hook</li>
</ol>
<p>å¦‚æœéœ€è¦åœ¨åˆ›å»ºæ–°çš„featureåˆ†æ”¯æ—¶æ‰§è¡Œä¸€äº›è‡ªå®šä¹‰è„šæœ¬ï¼Œå¯ä»¥ä½¿ç”¨git-flow-feature-start Hookã€‚å‡è®¾æˆ‘ä»¬æƒ³åœ¨åˆ›å»ºæ–°çš„featureåˆ†æ”¯æ—¶è‡ªåŠ¨ä¸ºè¯¥åˆ†æ”¯è®¾ç½®ä¸€äº›é»˜è®¤å€¼ï¼Œå¯ä»¥åœ¨<code>.git/hooks/git-flow-feature-start</code>æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1"># Set default values for feature branch</span>
</span></span><span class="line"><span class="cl">git config branch.<span class="nv">$GIT_BRANCH_NAME</span>.some_config_value <span class="s2">&#34;default_value&#34;</span>
</span></span></code></pre></div><ol start="3">
<li>ä½¿ç”¨git-flow-feature-finish-message Filter</li>
</ol>
<p>å¦‚æœéœ€è¦ä¿®æ”¹featureåˆ†æ”¯å®Œæˆæ—¶çš„æäº¤ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨git-flow-feature-finish-message Filterã€‚å‡è®¾æˆ‘ä»¬æƒ³åœ¨featureåˆ†æ”¯å®Œæˆæ—¶å¼ºåˆ¶è¦æ±‚å¡«å†™æäº¤ä¿¡æ¯ï¼Œå¯ä»¥åœ¨<code>.git/config</code>æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-toml" data-lang="toml"><span class="line"><span class="cl"><span class="p">[</span><span class="nx">gitflow</span> <span class="s2">&#34;feature&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nx">finishmessage</span> <span class="p">=</span> <span class="nx">Please</span> <span class="nx">provide</span> <span class="nx">a</span> <span class="nx">meaningful</span> <span class="nx">commit</span> <span class="nx">message</span> <span class="nx">for</span> <span class="nx">the</span> <span class="nx">feature</span> <span class="nx">branch</span>
</span></span></code></pre></div><ol start="4">
<li>ä½¿ç”¨ git-flow-hotfix-start Hook</li>
</ol>
<p>å¦‚æœéœ€è¦åœ¨åˆ›å»ºæ–°çš„hotfixåˆ†æ”¯æ—¶æ‰§è¡Œä¸€äº›è‡ªå®šä¹‰è„šæœ¬ï¼Œå¯ä»¥ä½¿ç”¨git-flow-hotfix-start Hookã€‚å‡è®¾æˆ‘ä»¬æƒ³åœ¨åˆ›å»ºæ–°çš„hotfixåˆ†æ”¯æ—¶è‡ªåŠ¨ä¸ºè¯¥åˆ†æ”¯è®¾ç½®ä¸€äº›é»˜è®¤å€¼ï¼Œå¯ä»¥åœ¨<code>.git/hooks/git-flow-hotfix-start</code>æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1"># Set default values for hotfix branch</span>
</span></span><span class="line"><span class="cl">git config branch.<span class="nv">$GIT_BRANCH_NAME</span>.some_config_value <span class="s2">&#34;default_value&#34;</span>
</span></span></code></pre></div><ol start="5">
<li>ä½¿ç”¨  git-flow-hotfix-finish Hook</li>
</ol>
<p>åœ¨<code>.git/hooks/git-flow-hotfix-finish</code>æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1"># Update version number in package.json</span>
</span></span><span class="line"><span class="cl"><span class="nv">VERSION</span><span class="o">=</span><span class="k">$(</span>cat package.json <span class="p">|</span> jq -r <span class="s1">&#39;.version&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">NEW_VERSION</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$VERSION</span> <span class="p">|</span> awk -F. <span class="s1">&#39;{$NF++;print}&#39;</span> <span class="p">|</span> sed <span class="s1">&#39;s/ /./g&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">sed -i <span class="s1">&#39;&#39;</span> <span class="s2">&#34;s/\&#34;version\&#34;: \&#34;</span><span class="nv">$VERSION</span><span class="s2">\&#34;/\&#34;version\&#34;: \&#34;</span><span class="nv">$NEW_VERSION</span><span class="s2">\&#34;/g&#34;</span> package.json
</span></span></code></pre></div><blockquote>
<p>è¯¥è„šæœ¬ç”¨äºä¿®æ”¹å‰ç«¯é¡¹ç›®ä¸­çš„ç‰ˆæœ¬å·ã€‚</p>
</blockquote>
<h2 id="github-flow-æ¨¡å‹">GitHub Flow æ¨¡å‹</h2>
<p>GitHub Flowæ˜¯ä¸€ç§åŸºäºGitHubçš„åˆ†æ”¯æ¨¡å‹å’Œä»£ç å¼€å‘å·¥ä½œæµç¨‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªç®€å•è€Œçµæ´»çš„æ¨¡å‹ï¼Œåœ¨æ•æ·å¼€å‘å’ŒæŒç»­äº¤ä»˜æ–¹é¢å…·æœ‰å¾ˆé«˜çš„æ•ˆç‡ã€‚ç›¸æ¯”äºGit Flowï¼ŒGitHub Flowæ›´åŠ é€‚åˆå›¢é˜Ÿå’Œå¼€å‘è€…è¿›è¡Œå¿«é€Ÿè¿­ä»£å’Œå¿«é€Ÿä¸Šçº¿ã€‚</p>
<p>GitHub Flowçš„åˆ†æ”¯æ¨¡å‹éå¸¸ç®€å•ï¼šåªæœ‰ä¸€ä¸ªä¸»åˆ†æ”¯ï¼ˆé€šå¸¸æ˜¯masteråˆ†æ”¯ï¼‰å’Œå¤šä¸ªç‰¹æ€§åˆ†æ”¯ã€‚ä¸»åˆ†æ”¯å§‹ç»ˆå¤„äºç¨³å®šçŠ¶æ€å¹¶ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚æ¯ä¸ªç‰¹æ€§åˆ†æ”¯ç”¨äºå¼€å‘æ–°åŠŸèƒ½æˆ–ä¿®å¤bugï¼Œå¹¶åœ¨å¼€å‘äººå‘˜å®Œæˆç›¸åº”çš„å¼€å‘å’Œæµ‹è¯•å·¥ä½œååˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¸­ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/github-flow.png" alt="github flow"  />
</p>
<p>GitHub Flow éµå¾ªä»¥ä¸‹ 6 æ¡åŸåˆ™ï¼š</p>
<ol>
<li><code>master</code> åˆ†æ”¯æ°¸è¿œæ˜¯éšæ—¶å¯éƒ¨ç½²å‘å¸ƒçš„</li>
<li>éœ€æ±‚æ–°å¢åŸºäº <code>master</code> åˆ†æ”¯ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªè¯­ä¹‰åŒ–åˆ†æ”¯</li>
<li>å®šæœŸæ¨é€æœ¬åœ°åˆ†æ”¯åˆ°è¿œç«¯</li>
<li>åˆå¹¶åˆ° <code>master</code> éœ€è¦æ <code>PR</code></li>
<li><code>PR</code> ä¸€æ—¦ç»è¿‡ <code>code review</code> æ— è¯¯åå³å¯åˆå¹¶åˆ° <code>master</code></li>
<li><code>master</code> ä¸€æ—¦æ¥æ”¶åˆ°åˆå¹¶è¯·æ±‚ï¼Œå³å¯ç«‹å³éƒ¨ç½²å‘å¸ƒ</li>
</ol>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/github-flow-whole.png" alt="github-flow-whole"  />
</p>
<p>GitHub Flowçš„ä»£ç å¼€å‘å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>åˆ›å»ºç‰¹æ€§åˆ†æ”¯ï¼šä»ä¸»åˆ†æ”¯ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ç‰¹æ€§åˆ†æ”¯ï¼Œç”¨äºå¼€å‘æ–°åŠŸèƒ½æˆ–ä¿®å¤bugã€‚</li>
<li>å¼€å‘å’Œæµ‹è¯•ï¼šåœ¨ç‰¹æ€§åˆ†æ”¯ä¸Šè¿›è¡Œå¼€å‘å’Œæµ‹è¯•ï¼Œç¡®ä¿ä»£ç ç¬¦åˆè´¨é‡æ ‡å‡†ï¼Œå¹¶é€šè¿‡è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚</li>
<li>å‘èµ·åˆå¹¶è¯·æ±‚ï¼šå°†ç‰¹æ€§åˆ†æ”¯åˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¸­ï¼Œå‘èµ·ä¸€ä¸ªåˆå¹¶è¯·æ±‚ï¼ˆpull requestï¼‰ï¼Œå¹¶é‚€è¯·å…¶ä»–å¼€å‘è€…è¿›è¡Œä»£ç å®¡æŸ¥å’Œè®¨è®ºã€‚</li>
<li>ä»£ç å®¡æŸ¥ï¼šå…¶ä»–å¼€å‘è€…å¯¹ä»£ç è¿›è¡Œå®¡æŸ¥å’Œè®¨è®ºï¼Œæå‡ºæ„è§å’Œå»ºè®®ï¼Œå¹¶ç¡®ä¿ä»£ç ç¬¦åˆè´¨é‡æ ‡å‡†å’Œæœ€ä½³å®è·µã€‚</li>
<li>åˆå¹¶ä»£ç ï¼šåœ¨ç»è¿‡å®¡æŸ¥å’Œè®¨è®ºåï¼Œå°†ç‰¹æ€§åˆ†æ”¯åˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¸­ï¼Œå¹¶å°†ä»£ç éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚</li>
<li>éƒ¨ç½²ä»£ç ï¼šåœ¨åˆå¹¶åˆ°ä¸»åˆ†æ”¯åï¼Œä½¿ç”¨è‡ªåŠ¨åŒ–éƒ¨ç½²å·¥å…·å°†ä»£ç éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚</li>
</ol>
<h2 id="gitlab-flow-æ¨¡å‹">Gitlab flow æ¨¡å‹</h2>
<p>GitLab Flowæ˜¯ä¸€ä¸ªåŸºäºGitLabçš„åˆ†æ”¯æ¨¡å‹å’Œå¼€å‘å·¥ä½œæµç¨‹ï¼Œæ—¨åœ¨æ”¯æŒæ•æ·å¼€å‘å’ŒæŒç»­äº¤ä»˜ã€‚</p>
<p><code>GitLab</code> åœ¨ 2014 å¹´æå‡º <code>11</code> æ¡æœ€ä½³å®è·µï¼Œæ›´å¤šè¯·ç‚¹å‡»<a href="https://about.gitlab.com/topics/version-control/what-are-gitlab-flow-best-practices/">è¿™é‡Œ</a>ï¼Œå…¶ç›¸å¯¹ <code>GitHub</code> å¢åŠ äº†ç¯å¢ƒåˆ†æ”¯ï¼Œä¸”ä»£ç å¿…é¡»ç”±<code>ä¸Šæ¸¸</code>ï¼ˆ<code>master</code>ï¼‰å‘<code>ä¸‹æ¸¸</code>ï¼ˆ<code>staging</code>ï¼‰å‘å±•ï¼Œå¹¶ä¸”é’ˆå¯¹æŒç»­å‘å¸ƒå’Œç‰ˆæœ¬å‘å¸ƒéƒ½æå‡ºäº†ç›¸åº”çš„å‡†åˆ™ï¼Œä¸‹é¢æ˜¯å…¶å¤§è‡´æµç¨‹å›¾ï¼š</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/gilab-flow-cidi.png" alt="img"  />
</p>
<p>GitLab Flowçš„ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š</p>
<ol>
<li>ç®€å•çš„åˆ†æ”¯æ¨¡å‹ï¼šGitLab Flowä½¿ç”¨ä¸€ä¸ªç®€å•çš„åˆ†æ”¯æ¨¡å‹ï¼ŒåŒ…æ‹¬ä¸€ä¸ªä¸»åˆ†æ”¯ï¼ˆé€šå¸¸å‘½åä¸ºâ€œmasterâ€æˆ–â€œproductionâ€ï¼‰å’Œä¸€ä¸ªå¼€å‘åˆ†æ”¯ï¼ˆé€šå¸¸å‘½åä¸ºâ€œdevelopâ€æˆ–â€œstagingâ€ï¼‰ã€‚ç‰¹æ€§åˆ†æ”¯ä»å¼€å‘åˆ†æ”¯åˆ›å»ºï¼Œå¹¶åœ¨ç‰¹æ€§æˆ–é”™è¯¯ä¿®å¤å®Œæˆå¹¶é€šè¿‡æµ‹è¯•ååˆå¹¶å›å¼€å‘åˆ†æ”¯ä¸­ã€‚</li>
<li>æŒç»­é›†æˆå’Œäº¤ä»˜ï¼šGitLab Flowå¼ºè°ƒæŒç»­é›†æˆå’Œäº¤ä»˜ï¼ˆCI/CDï¼‰ï¼Œè¿™æ„å‘³ç€æ¯æ¬¡å¯¹ä»£ç çš„æ›´æ”¹éƒ½ä¼šè‡ªåŠ¨æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒæˆ–ç”Ÿäº§ç¯å¢ƒï¼ˆå¦‚æœæµ‹è¯•é€šè¿‡ï¼‰ã€‚</li>
<li>ä»£ç å®¡æŸ¥ï¼šGitLab Flowé¼“åŠ±è¿›è¡Œä»£ç å®¡æŸ¥ï¼Œè¿™æ„å‘³ç€æ¯æ¬¡å¯¹ä»£ç çš„æ›´æ”¹éƒ½ä¼šç”±è‡³å°‘ä¸€ä¸ªå…¶ä»–å¼€å‘äººå‘˜è¿›è¡Œå®¡æŸ¥ï¼Œä»¥ç¡®ä¿å…¶ç¬¦åˆè´¨é‡æ ‡å‡†å¹¶ä¸ä¼šå¼•å…¥ä»»ä½•å®‰å…¨æ¼æ´ã€‚</li>
<li>åˆå¹¶è¯·æ±‚ï¼šGitLab Flowä½¿ç”¨åˆå¹¶è¯·æ±‚æ¥ç®¡ç†å°†ä»£ç æ›´æ”¹åˆå¹¶åˆ°ä¸»åˆ†æ”¯çš„è¿‡ç¨‹ã€‚åˆå¹¶è¯·æ±‚å…è®¸å¼€å‘äººå‘˜åœ¨å°†æ›´æ”¹åˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¹‹å‰å¯¹å…¶è¿›è¡Œå®¡æŸ¥å’Œè®¨è®ºã€‚</li>
<li>ç¯å¢ƒç®¡ç†ï¼šGitLab Flowæä¾›é«˜çº§çš„ç¯å¢ƒç®¡ç†åŠŸèƒ½ï¼Œå…è®¸å›¢é˜Ÿåˆ›å»ºå’Œç®¡ç†ä¸åŒçš„å¼€å‘ã€æµ‹è¯•ã€æš‚å­˜å’Œç”Ÿäº§ç¯å¢ƒã€‚</li>
</ol>
<blockquote>
<p>GitLab Flowæä¾›äº†é«˜çº§çš„ç¯å¢ƒç®¡ç†åŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©å›¢é˜Ÿæ›´å¥½åœ°ç®¡ç†ä¸åŒçš„å¼€å‘ã€æµ‹è¯•ã€æš‚å­˜å’Œç”Ÿäº§ç¯å¢ƒã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨GitLab Flowè¿›è¡Œç¯å¢ƒç®¡ç†çš„ä¸€äº›æ–¹æ³•ï¼š</p>
<ol>
<li>åˆ›å»ºä¸åŒçš„ç¯å¢ƒåˆ†æ”¯ï¼šåœ¨GitLab Flowä¸­ï¼Œå¯ä»¥ä¸ºä¸åŒçš„ç¯å¢ƒåˆ›å»ºåˆ†æ”¯ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸ºâ€œdevelopâ€çš„å¼€å‘åˆ†æ”¯ï¼Œä¸€ä¸ªåä¸ºâ€œstagingâ€çš„æš‚å­˜åˆ†æ”¯ï¼Œå’Œä¸€ä¸ªåä¸ºâ€œproductionâ€çš„ç”Ÿäº§åˆ†æ”¯ã€‚è¿™äº›åˆ†æ”¯å¯ä»¥å¸®åŠ©å›¢é˜Ÿæ›´å¥½åœ°ç®¡ç†ä¸åŒç¯å¢ƒçš„ä»£ç ï¼Œç¡®ä¿æ¯ä¸ªç¯å¢ƒéƒ½æœ‰è‡ªå·±çš„ä»£ç ç‰ˆæœ¬ã€‚</li>
<li>é…ç½®ç¯å¢ƒå˜é‡ï¼šåœ¨GitLabä¸­ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªç¯å¢ƒè®¾ç½®ä¸åŒçš„ç¯å¢ƒå˜é‡ã€‚è¿™äº›ç¯å¢ƒå˜é‡å¯ä»¥ç”¨äºé…ç½®ä¸åŒç¯å¢ƒä¸­çš„åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ï¼Œä¾‹å¦‚æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ã€APIå¯†é’¥ç­‰ã€‚é€šè¿‡è®¾ç½®æ­£ç¡®çš„ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥ç¡®ä¿åº”ç”¨ç¨‹åºåœ¨ä¸åŒç¯å¢ƒä¸­æ­£ç¡®è¿è¡Œã€‚</li>
<li>è‡ªåŠ¨åŒ–éƒ¨ç½²å’Œæµ‹è¯•ï¼šGitLab Flowæ”¯æŒè‡ªåŠ¨åŒ–éƒ¨ç½²å’Œæµ‹è¯•ï¼Œå¯ä»¥å¸®åŠ©å›¢é˜Ÿæ›´å¿«åœ°éƒ¨ç½²ä»£ç åˆ°ä¸åŒç¯å¢ƒä¸­ã€‚å¯ä»¥ä½¿ç”¨GitLabçš„CI/CDç®¡é“æ¥è‡ªåŠ¨åŒ–æµ‹è¯•å’Œéƒ¨ç½²è¿‡ç¨‹ï¼Œå¹¶å°†ä»£ç æ¨é€åˆ°æ­£ç¡®çš„ç¯å¢ƒåˆ†æ”¯ä¸­ã€‚</li>
<li>ç¯å¢ƒç›‘æ§å’ŒæŠ¥å‘Šï¼šGitLab Flowè¿˜æ”¯æŒç¯å¢ƒç›‘æ§å’ŒæŠ¥å‘ŠåŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©å›¢é˜Ÿæ›´å¥½åœ°äº†è§£ä¸åŒç¯å¢ƒçš„è¿è¡ŒçŠ¶å†µå’Œæ€§èƒ½ã€‚å¯ä»¥ä½¿ç”¨GitLabçš„ç›‘æ§å’ŒæŠ¥å‘Šå·¥å…·æ¥ç›‘è§†ä¸åŒç¯å¢ƒçš„æ€§èƒ½æŒ‡æ ‡ã€é”™è¯¯ç‡ç­‰ï¼Œå¹¶åŠæ—¶å‘ç°å’Œè§£å†³é—®é¢˜ã€‚</li>
</ol>
</blockquote>
<p>GitLab Flowçš„åˆ†æ”¯æ¨¡å‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>ä¸»åˆ†æ”¯ï¼šä¸»åˆ†æ”¯å§‹ç»ˆå¤„äºç¨³å®šçŠ¶æ€ï¼Œå¹¶ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚åœ¨GitLab Flowä¸­ï¼Œä¸»åˆ†æ”¯é€šå¸¸æ˜¯masteråˆ†æ”¯æˆ–productionåˆ†æ”¯ã€‚</li>
<li>ç‰¹æ€§åˆ†æ”¯ï¼šç‰¹æ€§åˆ†æ”¯ç”¨äºå¼€å‘æ–°åŠŸèƒ½æˆ–ä¿®å¤bugï¼Œå¹¶ä»ä¸»åˆ†æ”¯ä¸­åˆ›å»ºã€‚åœ¨GitLab Flowä¸­ï¼Œç‰¹æ€§åˆ†æ”¯é€šå¸¸ä»¥feature/æˆ–fix/ä¸ºå‰ç¼€ã€‚</li>
<li>é›†æˆåˆ†æ”¯ï¼šé›†æˆåˆ†æ”¯ç”¨äºå°†ç‰¹æ€§åˆ†æ”¯é›†æˆåˆ°ä¸»åˆ†æ”¯ä¸­ï¼Œå¹¶è¿›è¡Œæµ‹è¯•å’Œéƒ¨ç½²ã€‚åœ¨GitLab Flowä¸­ï¼Œé›†æˆåˆ†æ”¯é€šå¸¸æ˜¯developåˆ†æ”¯æˆ–stagingåˆ†æ”¯ã€‚</li>
<li>å‘å¸ƒåˆ†æ”¯ï¼šå‘å¸ƒåˆ†æ”¯ç”¨äºå°†ç‰¹æ€§åˆ†æ”¯å’Œé›†æˆåˆ†æ”¯çš„ä»£ç å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒä¸­ã€‚åœ¨GitLab Flowä¸­ï¼Œå‘å¸ƒåˆ†æ”¯é€šå¸¸æ˜¯release/ä¸ºå‰ç¼€çš„åˆ†æ”¯ã€‚</li>
</ol>
<p>GitLab Flowçš„å¼€å‘å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>åˆ›å»ºç‰¹æ€§åˆ†æ”¯ï¼šä»ä¸»åˆ†æ”¯ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„ç‰¹æ€§åˆ†æ”¯ï¼Œç”¨äºå¼€å‘æ–°åŠŸèƒ½æˆ–ä¿®å¤bugã€‚</li>
<li>å¼€å‘å’Œæµ‹è¯•ï¼šåœ¨ç‰¹æ€§åˆ†æ”¯ä¸Šè¿›è¡Œå¼€å‘å’Œæµ‹è¯•ï¼Œç¡®ä¿ä»£ç ç¬¦åˆè´¨é‡æ ‡å‡†ï¼Œå¹¶é€šè¿‡è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚</li>
<li>åˆå¹¶åˆ°é›†æˆåˆ†æ”¯ï¼šå°†ç‰¹æ€§åˆ†æ”¯åˆå¹¶åˆ°é›†æˆåˆ†æ”¯ä¸­ï¼Œå¹¶è¿›è¡Œé›†æˆæµ‹è¯•å’Œè‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚</li>
<li>å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒï¼šå°†é›†æˆåˆ†æ”¯çš„ä»£ç å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¹¶è¿›è¡Œæœ€ç»ˆæµ‹è¯•å’Œéƒ¨ç½²ã€‚</li>
<li>åˆå¹¶åˆ°ä¸»åˆ†æ”¯ï¼šåœ¨å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒåï¼Œå°†é›†æˆåˆ†æ”¯åˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¸­ï¼Œå¹¶å°†ä»£ç éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚</li>
</ol>
<p>GitLab Flowå¼ºè°ƒCI/CDé›†æˆå’Œæµ‹è¯•è‡ªåŠ¨åŒ–ï¼Œä»¥ç¡®ä¿ä»£ç è´¨é‡å’Œå¿«é€Ÿè¿­ä»£ã€‚å®ƒè¿˜æ”¯æŒè‡ªåŠ¨åŒ–éƒ¨ç½²å’Œç¯å¢ƒç®¡ç†ï¼Œä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´è½»æ¾åœ°ç®¡ç†ä¸åŒç¯å¢ƒå’Œéƒ¨ç½²ä»£ç ã€‚GitLab Flowæ˜¯ä¸€ä¸ªçµæ´»å’Œå¼ºå¤§çš„å¼€å‘å·¥ä½œæµç¨‹ï¼Œé€‚ç”¨äºå„ç§ç±»å‹çš„é¡¹ç›®å’Œå›¢é˜Ÿã€‚</p>
<h2 id="gitlab-flowgit-flowå’Œgithub-flow">GitLab Flowã€Git Flowå’ŒGitHub Flow</h2>
<p>GitLab Flowã€Git Flowå’ŒGitHub Flowéƒ½æ˜¯ä¸‰ç§å¸¸è§çš„åŸºäºGitçš„å·¥ä½œæµç¨‹ã€‚ä¸‹é¢æ˜¯GitLab Flowä¸å…¶ä»–å·¥ä½œæµç¨‹çš„ä¸»è¦åŒºåˆ«ï¼š</p>
<ol>
<li>GitLab Flowä¸Git Flowçš„æ¯”è¾ƒï¼š</li>
</ol>
<ul>
<li>
<p>GitLab Flowæ¯”Git Flowæ›´ç®€å•å’Œæ›´çµæ´»ã€‚Git Flowæœ‰ä¸€ä¸ªæ›´å¤æ‚çš„åˆ†æ”¯æ¨¡å‹ï¼ŒåŒ…å«å¤šä¸ªé•¿æœŸå­˜åœ¨çš„åˆ†æ”¯ï¼Œè€ŒGitLab Flowåªä½¿ç”¨å‡ ä¸ªä¸»è¦åˆ†æ”¯å’Œç‰¹æ€§åˆ†æ”¯ã€‚</p>
</li>
<li>
<p>GitLab Flowå¼ºè°ƒæŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²ï¼ˆCI/CDï¼‰ï¼Œé¼“åŠ±é¢‘ç¹åˆå¹¶åˆ°ä¸»è¦åˆ†æ”¯ã€‚Git Flowæ›´æ³¨é‡ç‰ˆæœ¬æ§åˆ¶å’Œå‘å¸ƒç®¡ç†ã€‚</p>
</li>
<li>
<p>GitLab Flowä¸GitLabå†…ç½®çš„CI/CDç®¡é“æ›´ç´§å¯†åœ°é›†æˆåœ¨ä¸€èµ·ï¼Œæ›´å®¹æ˜“è‡ªåŠ¨åŒ–å¼€å‘å·¥ä½œæµç¨‹ã€‚</p>
</li>
</ul>
<ol start="2">
<li>GitLab Flowä¸GitHub Flowçš„æ¯”è¾ƒï¼š</li>
</ol>
<ul>
<li>GitLab Flowå’ŒGitHub Flowæœ‰è®¸å¤šç›¸ä¼¼ä¹‹å¤„ï¼Œä¾‹å¦‚å®ƒä»¬éƒ½ä»¥GitHubæˆ–GitLabä½œä¸ºä¸­å¤®ä»“åº“ï¼Œä½¿ç”¨ç‰¹æ€§åˆ†æ”¯è¿›è¡Œå¼€å‘ã€‚</li>
<li>GitLab Flowå¼ºè°ƒCI/CDé›†æˆå’Œæµ‹è¯•è‡ªåŠ¨åŒ–ï¼Œè€ŒGitHub Flowæ›´æ³¨é‡ä»£ç å®¡æŸ¥å’Œåä½œã€‚</li>
<li>GitLab Flowè¿˜æä¾›æ›´é«˜çº§çš„ç¯å¢ƒç®¡ç†ã€éƒ¨ç½²å’Œç›‘æ§åŠŸèƒ½ï¼Œæ›´é€‚åˆäºå¤§å‹ã€å¤æ‚çš„é¡¹ç›®ã€‚</li>
</ul>
<p>æ€»ä½“è€Œè¨€ï¼ŒGitLab Flowæ¯”Git Flowæ›´ç®€å•å’Œæ›´çµæ´»ï¼Œå¼ºè°ƒCI/CDé›†æˆå’Œè‡ªåŠ¨åŒ–ã€‚ä¸GitHub Flowç›¸æ¯”ï¼ŒGitLab Flowæä¾›æ›´é«˜çº§çš„ç¯å¢ƒç®¡ç†å’Œéƒ¨ç½²åŠŸèƒ½ï¼Œæ›´é€‚åˆäºå¤§å‹ã€å¤æ‚çš„é¡¹ç›®ã€‚é€‰æ‹©å“ªç§å·¥ä½œæµç¨‹æœ€ç»ˆå–å†³äºé¡¹ç›®å’Œå¼€å‘å›¢é˜Ÿçš„å…·ä½“éœ€æ±‚å’Œè¦æ±‚ã€‚</p>
<h2 id="å…¶ä»–-flow">å…¶ä»– flow</h2>
<ul>
<li>TrunkBased</li>
<li>OneFlow</li>
<li>AoneFlow</li>
</ul>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>ç›®å‰å…¬å¸ä»£ç éƒ¨ç½²åœ¨è‡ªå»ºçš„ gitlab ä¸Šé¢ï¼Œå¯¹äºå…¬å¸çš„é¡¹ç›®ï¼Œä¸ªäººå€¾å‘äºä½¿ç”¨ git-flow åˆ†æ”¯æ¨¡å‹ï¼Œå¹¶ä¸”ä½¿ç”¨ git-flow (AVH Edition) æ¥ç®€åŒ–æ“ä½œã€‚</p>
<p>ç›®å‰ï¼Œæˆ‘å‚ä¸çš„å¤§å¤šæ•°é¡¹ç›®éƒ½æ˜¯ java é¡¹ç›®å¹¶ä¸”ä½¿ç”¨ maven è¿›è¡Œæ„å»ºã€‚</p>
<p>åœ¨Mavené¡¹ç›®ä¸­ï¼Œå¯ä»¥ä½¿ç”¨Mavenç‰ˆæœ¬æ§åˆ¶å™¨æ¥åŒºåˆ†releaseç‰ˆæœ¬å’Œsnapshotç‰ˆæœ¬ã€‚</p>
<ul>
<li>
<p><strong>Releaseç‰ˆæœ¬</strong></p>
<p>å¯¹äºGit Flowä¸­çš„releaseåˆ†æ”¯ï¼Œé€šå¸¸ç”¨äºä¸ºç”Ÿäº§ç¯å¢ƒå‡†å¤‡ä»£ç ã€‚</p>
<p>åœ¨Mavené¡¹ç›®ä¸­ï¼Œå¯ä»¥ä½¿ç”¨Maven Releaseæ’ä»¶æ¥è‡ªåŠ¨åŒ–åˆ›å»ºå’Œå‘å¸ƒreleaseç‰ˆæœ¬ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mvn release:prepare
</span></span><span class="line"><span class="cl">mvn release:perform
</span></span></code></pre></div><p>ä½¿ç”¨è¿™äº›å‘½ä»¤ï¼ŒMaven Releaseæ’ä»¶ä¼šè‡ªåŠ¨æ›´æ–°é¡¹ç›®ç‰ˆæœ¬å·ã€åˆ›å»ºtagã€æ„å»ºreleaseç‰ˆæœ¬ï¼Œå¹¶å‘å¸ƒåˆ°Mavenä»“åº“ä¸­ã€‚å‘å¸ƒçš„ç‰ˆæœ¬å·ä¸åŒ…å« <code>-SNAPSHOT</code> åç¼€ã€‚</p>
<p>æˆ–è€…ï¼Œä½¿ç”¨ <code>mvn versions</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mvn versions:set -DnewVersion<span class="o">=</span>1.0.0-SNAPSHOT
</span></span><span class="line"><span class="cl">mvn versions:commit
</span></span></code></pre></div></li>
<li>
<p><strong>Snapshotç‰ˆæœ¬</strong></p>
<p>å¯¹äºGit Flowä¸­çš„featureå’Œdevelopåˆ†æ”¯ï¼Œé€šå¸¸ç”¨äºå¼€å‘å’Œæµ‹è¯•æ–°åŠŸèƒ½æˆ–bugä¿®å¤ï¼Œè¿™äº›åˆ†æ”¯ä½¿ç”¨snapshotç‰ˆæœ¬ã€‚åœ¨Mavenä¸­ï¼Œsnapshotç‰ˆæœ¬çš„ç‰ˆæœ¬å·åŒ…å« <code>-SNAPSHOT</code> åç¼€ï¼Œè¡¨ç¤ºå½“å‰ç‰ˆæœ¬æ˜¯æ­£åœ¨å¼€å‘çš„ç‰ˆæœ¬ã€‚</p>
</li>
</ul>
<p>å¯¹äºè¿™äº›é¡¹ç›®ï¼Œgit-flow æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<p>1ã€åˆå§‹åŒ–</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git flow init -d
</span></span></code></pre></div><p>2ã€å¼€å§‹ feature åˆ†æ”¯</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git flow feature start <span class="nb">test</span>
</span></span></code></pre></div><p>è®¾ç½®mavené¡¹ç›®ä¸­ç‰ˆæœ¬ä¸º snapshotç‰ˆæœ¬ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mvn versions:set -DnewVersion<span class="o">=</span>1.0.0-SNAPSHOT
</span></span><span class="line"><span class="cl">mvn versions:commit
</span></span></code></pre></div><p>å¯¹äºmavenå¤šæ¨¡å—é¡¹ç›®ï¼Œå¦‚æœä½¿ç”¨ revision æ¥ç»Ÿä¸€å®šä¹‰ç‰ˆæœ¬å·ï¼Œåˆ™ä½¿ç”¨ä¸‹é¢å‘½ä»¤ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mvn versions:set-property -Dproperty<span class="o">=</span>revision -DnewVersion<span class="o">=</span>1.0.0-SNAPSHOT
</span></span><span class="line"><span class="cl">mvn versions:commit
</span></span></code></pre></div><p>3ã€æœ¬åœ°åœ¨ feature åˆ†æ”¯ä¸Šå®Œæˆä¸€äº›å¼€å‘ä¹‹åï¼Œå®Œæˆ feature åˆ†æ”¯</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git flow feature finish <span class="nb">test</span>
</span></span></code></pre></div><p>4ã€å¼€å§‹ release åˆ†æ”¯</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git flow release start 1.0.0
</span></span></code></pre></div><p>5ã€æœ¬åœ°åœ¨ release åˆ†æ”¯ä¸Šå®Œæˆä¸€äº›å¼€å‘ä¹‹åï¼Œå®Œæˆ feature åˆ†æ”¯</p>
<p>è®¾ç½®mavené¡¹ç›®ä¸­ç‰ˆæœ¬ä¸º release ç‰ˆæœ¬ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mvn versions:set -DnewVersion<span class="o">=</span>1.0.0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">mvn versions:commit
</span></span></code></pre></div><p>å¯¹äºmavenå¤šæ¨¡å—é¡¹ç›®ï¼Œå¦‚æœä½¿ç”¨ revision æ¥ç»Ÿä¸€å®šä¹‰ç‰ˆæœ¬å·ï¼Œåˆ™ä½¿ç”¨ä¸‹é¢å‘½ä»¤ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mvn versions:set-property -Dproperty<span class="o">=</span>revision -DnewVersion<span class="o">=</span>1.0.0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">mvn versions:commit
</span></span></code></pre></div><p>å¦å¤–ï¼Œå¯¹äºå¤šæ¨¡å—é¡¹ç›®ï¼Œéœ€è¦åœ¨æ¯ä¸ªæ¨¡å—æ‰§è¡Œä¸‹é¢å‘½ä»¤å°† jar æ¨é€åˆ° maven ä¸­å¤®ä»“åº“ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mvn deploy -DskipTests
</span></span></code></pre></div><p>ç„¶åå®Œæˆåˆ†æ”¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git flow release finish 1.0.0
</span></span></code></pre></div><p>6ã€æ¨é€ä¸»åˆ†æ”¯å’Œå¼€å‘åˆ†æ”¯</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git push origin develop
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">git checkout main
</span></span><span class="line"><span class="cl">git push origin main
</span></span></code></pre></div><p>ä»¥ä¸Šã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>å‘¨æŠ¥-18ï½œå¯¼å‡ºè±†ç“£æ•°æ®ã€Effective Java 3ç¬¬äºŒç« æ€»ç»“</title>
      <link>https://blog.chensoul.com/posts/2023/05/10/weekly_review_18/</link>
      <pubDate>Wed, 10 May 2023 10:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/05/10/weekly_review_18/</guid>
      <description>å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-05-01 åˆ° 2023-05-07 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚ ç»§ä¸Šå‘¨å®ç°å¯¼å‡ºè‹¹æœæ¥å£æ•°æ®ä¹‹åï¼Œè¿™å‘¨åˆå®ç°äº†è‡ªåŠ¨</description>
      <content:encoded><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p>æœ¬ç¯‡æ˜¯å¯¹ <code>2023-05-01</code> åˆ° <code>2023-05-07</code> è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº <a href="https://blog.chensoul.com/">åšå®¢</a>ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚</p>
<p>ç»§ä¸Šå‘¨å®ç°å¯¼å‡ºè‹¹æœæ¥å£æ•°æ®ä¹‹åï¼Œè¿™å‘¨åˆå®ç°äº†è‡ªåŠ¨å¯¼å‡ºè±†ç“£æ•°æ®ã€‚æ­¤å¤–ï¼Œè¿˜èŒç”Ÿäº†å¯¼å‡ºæ¯å¤©é˜…è¯»çš„æ•°æ®çš„æƒ³æ³•ã€‚å¥ˆä½•ç°åœ¨é˜…è¯» app éƒ½éœ€è¦æ”¶è´¹ï¼Œåªèƒ½æš‚ä¸”æç½®è¿™ä¸ªæƒ³æ³•ã€‚</p>
<p>æœ€è¿‘åœ¨å­¦ä¹  Pythonï¼Œäºæ˜¯å°†å­¦ä¹ ä¸­åšçš„ç¬”è®°å‘å¸ƒåˆ°äº†åšå®¢ï¼Œè¿™å‘¨å‘å¸ƒäº†ä¸¤ç¯‡æ–‡ç« ï¼Œå¸Œæœ›é€šè¿‡è¾“å‡ºæ¥å€’é€¼è¾“å…¥ï¼Œä»¥æ­¤æ¥å¿«é€ŸæŒæ¡ python ç¼–ç¨‹å¹¶èƒ½å¼€å‘ä¸€äº›é¡¹ç›®ã€‚å¦å¤–ï¼Œè®¡åˆ’åœ¨å­¦å®Œä¹‹åï¼Œç»§ç»­å­¦ä¹  Rust å’Œ Goï¼Œç”šè‡³å¼€å§‹å­¦ä¹ å‰ç«¯å¼€å‘ã€‚</p>
<p>æœ€è¿‘åˆä¸€æ¬¡æ›´æ¢äº†åšå®¢ä¸»é¢˜ï¼Œä¸»è¦å‡ºå‘ç‚¹æ˜¯æƒ³æ‰¾ä¸€ä¸ªç®€æ´çš„ä¸»é¢˜ï¼Œå‡å°‘ä¸å¿…è¦çš„ä¿¡æ¯å¹²æ‰°ï¼Œä¹Ÿä¸æƒ³èŠ±æ—¶é—´åœ¨ä¿®æ”¹ä¸»é¢˜ä¸Šé¢ã€‚å‡å°‘äº†èœå•é“¾æ¥ï¼Œé¡ºæ‰‹ä¹Ÿä¿®æ”¹äº† <a href="/about/">å…³äº</a> é¡µé¢çš„å†…å®¹ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-18-01.png" alt="weekly-review-18-01"  />
</p>
<h2 id="å¯¼å‡ºè±†ç“£æ•°æ®">å¯¼å‡ºè±†ç“£æ•°æ®</h2>
<p>æœ€è¿‘é˜…è¯»äº†ä¸€ç¯‡æ–‡ç«  <a href="https://conge.livingwithfcs.org/2023/05/05/leaving-douban/">å¾ˆè®¤çœŸçš„åœ¨è€ƒè™‘ä¸å†ä½¿ç”¨è±†ç“£è¿™ä»¶äº‹</a> ï¼Œäºæ˜¯ä½¿ç”¨<a href="https://github.com/lizheming/doumark-action"> lizheming/doumark-action</a> å¯¼å‡ºè±†ç“£æ•°æ®ã€‚</p>
<p>åœ¨æˆ‘çš„ github ä¸»é¡µ <a href="https://github.com/chensoul/chensoul">https://github.com/chensoul/chensoul</a> åˆ›å»ºä¸€ä¸ª workflow <a href="https://github.com/chensoul/chensoul/blob/main/.github/workflows/douban.yml">douban.yml</a> ï¼Œæ¯éš”ä¸€ä¸ªå°æ—¶åŒæ­¥ä¸€æ¬¡è±†ç“£æ•°æ®ï¼ˆè¯»ä¹¦ã€ç”µå½±ã€éŸ³ä¹ï¼‰åˆ° <a href="https://github.com/chensoul/chensoul/tree/main/data">csv æ–‡ä»¶</a>ã€‚æ‹¿åˆ°è¿™äº›æ–‡ä»¶ä¹‹åï¼Œå°±å¯ä»¥é€šè¿‡ html + css æ¸²æŸ“å‡ºæ¥ï¼Œç±»ä¼¼è¿™ä¸ªé¡µé¢ <a href="https://conge.livingwithfcs.org/books/">ä¹¦å½±éŸ³</a>ã€‚ç­‰è±†ç“£æ•°æ®å¢å¤šä¹‹åï¼Œå†è€ƒè™‘å®ç°è¿™ä¸ªã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œä¹‹å‰è¿˜å®ç°äº†é€šè¿‡ n8n å®æ—¶åŒæ­¥è±†ç“£æ•°æ®åˆ° memos å’Œ telegramï¼š</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-18-05.png" alt="weekly-review-18-05"  />
</p>
<p>é€šè¿‡ <a href="https://github.com/chensoul/chensoul/blob/main/build_readme.py">python è„šæœ¬ </a>è·å–æœ€è¿‘10æ¡è®°å½•ï¼Œæ˜¾ç¤ºåˆ° <a href="https://github.com/chensoul">æˆ‘çš„ github ä¸»é¡µ</a>ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-18-06.png" alt="weekly-review-18-06"  />
</p>
<h2 id="ç†è´¢">ç†è´¢</h2>
<p>è¿™å‘¨æ€»è®¡æ”¯å‡º 816 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š</p>
<ul>
<li>5æœˆ1æ—¥ï¼š55å…ƒ</li>
<li>5æœˆ2æ—¥ï¼š79å…ƒ</li>
<li>5æœˆ3æ—¥ï¼š370å…ƒï¼Œå…¶ä¸­270å…ƒåŠ æ²¹</li>
<li>5æœˆ4æ—¥ï¼š136å…ƒï¼Œå…¶ä¸­ææ¬¾50å…ƒ</li>
<li>5æœˆ5æ—¥ï¼š12å…ƒ</li>
<li>5æœˆ6æ—¥ï¼š100å…ƒï¼Œæ‰‹æœºè¯è´¹å……å€¼</li>
<li>5æœˆ7æ—¥ï¼š64å…ƒ</li>
</ul>
<p>æœ€è¿‘ä¸€ç›´æƒ³ç»Ÿè®¡ä¸€ä¸‹å·¥ä½œå’Œç”Ÿæ´»ä¸­çš„å›ºå®šæ”¯å‡ºè´¹ç”¨ï¼Œäºæ˜¯ä»Šå¤©èŠ±äº†ç‚¹æ—¶é—´åšäº†ç»Ÿè®¡ã€‚æ²¡æƒ³åˆ°æ¯å¹´å·¥ä½œå’Œç”Ÿæ´»ä¸­å›ºå®šæ”¯å‡ºè´¹ç”¨ç«Ÿç„¶è¾¾åˆ°äº†1529+6180=7709å…ƒã€‚å…¶ä¸­å¤§å—å¤´æ˜¯æ‰‹æœºè¯è´¹å’Œåœè½¦ä½è´¹ç”¨ï¼Œæ‰‹æœºè¯è´¹æ˜¯å› ä¸ºåŠç†ä¸€ä¸ªç”µä¿¡å¥—é¤é€å®½å¸¦å’Œä¸€éƒ¨æ‰‹æœºï¼›åœè½¦ä½è´¹ç”¨æ˜¯å› ä¸ºä»Šå¹´ä¹°äº†è½¦ã€‚</p>
<p>å¹´è´¹ï¼Œæ€»è®¡ï¼š1529å…ƒ</p>
<ul>
<li>Typoraï¼š89å…ƒ</li>
<li>ç™¾åº¦ç¡¬ç›˜ï¼š178å…ƒï¼Œ2024-01-28åˆ°æœŸ</li>
<li>å¿«è¿VPNï¼š374å…ƒï¼Œ2024-01-16åˆ°æœŸ</li>
<li>æ¬ç“¦å·¥VPSï¼š640å…ƒï¼Œ2024-01-14åˆ°æœŸ</li>
<li>1Passwordï¼š248å…ƒï¼Œ2023-08-17åˆ°æœŸ</li>
</ul>
<p>æœˆè´¹ï¼Œæ€»è®¡ï¼š515*12=6180å…ƒ</p>
<ul>
<li>
<p>æ‰‹æœºè¯è´¹ï¼š189å…ƒ</p>
</li>
<li>
<p>åœè½¦ä½ï¼š320å…ƒ</p>
</li>
<li>
<p>iCloudï¼š6å…ƒ</p>
</li>
</ul>
<h2 id="å¥èº«">å¥èº«</h2>
<p>æœ¬å‘¨ <a href="https://run.chensoul.com/">è·‘æ­¥</a> è®°å½•å¦‚ä¸‹ï¼Œæ€»è®¡è·‘æ­¥34.37å…¬é‡Œï¼Œå…¶ä¸­å‘¨å…­ç¬¬ä¸€æ¬¡è·‘äº†12å…¬é‡Œï¼Œæ¯”ä¹‹å‰æœ‰æ‰€è¿›æ­¥ã€‚é—æ†¾çš„æ˜¯ï¼Œæœ‰ä¸¤å¤©æ²¡æœ‰è·‘æ­¥ï¼Œå¯¼è‡´è¿ç»­è·‘æ­¥å¤©æ•°æœ‰ä¸­æ–­ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-18-04.png" alt="weekly-review-18-04"  />
</p>
<p>ä»3æœˆä»½å¼€å§‹è·‘æ­¥åˆ°5æœˆï¼Œç›®å‰æ€»å…±è·‘æ­¥è·ç¦»è¾¾åˆ°äº†230å…¬é‡Œã€‚</p>
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-18-03.png" alt="weekly-review-18-03" style="width:50%;" />
<h2 id="å·¥ä½œ">å·¥ä½œ</h2>
<h3 id="effective-java-3-ç¬”è®°">Effective Java 3 ç¬”è®°</h3>
<p>æœ¬å‘¨å†™äº†ä¸¤ç¯‡ã€ŠEffective Java 3ã€‹çš„å­¦ä¹ ç¬”è®°ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li><a href="/posts/2023/05/08/avoid-finalizers-and-cleaners/">ã€ŠEffective Java 3ã€‹ç¬”è®°8ï¼šé¿å…ä½¿ç”¨ç»ˆç»“å™¨å’Œæ¸…é™¤å™¨</a></li>
<li><a href="/posts/2023/05/08/prefer-try-with-resources-to-try-finally/">ã€ŠEffective Java 3ã€‹ç¬”è®°9ï¼šä½¿ç”¨ try-with-resources ä¼˜äº try-finally</a></li>
</ul>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-18-02.png" alt="weekly-review-18-02"  />
</p>
<p>è‡³æ­¤ï¼Œã€ŠEffective Java 3ã€‹ç¬¬äºŒç« å­¦ä¹ å®Œäº†ï¼Œç°åœ¨æ€»ç»“å¦‚ä¸‹ï¼š</p>
<p>1ã€é™æ€å·¥å‚æ–¹æ³•ä»£æ›¿æ„é€ å‡½æ•°</p>
<p>é™æ€å·¥å‚æ–¹æ³•æ˜¯ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ï¼Œå®ƒä»¬ä¸æ„é€ å™¨ä¸åŒï¼Œå…·æœ‰æ˜ç¡®çš„åç§°ï¼Œå¹¶ä¸”å¯ä»¥è¿”å›ä»»æ„ç±»å‹çš„å¯¹è±¡ã€‚é™æ€å·¥å‚æ–¹æ³•çš„ä¼˜ç‚¹åŒ…æ‹¬ï¼š</p>
<ul>
<li>
<p>åç§°å¯ä»¥æè¿°å¯¹è±¡çš„å«ä¹‰ï¼Œä½¿å¾—ä»£ç æ›´åŠ æ¸…æ™°æ˜“è¯»ï¼›</p>
</li>
<li>
<p>é™æ€å·¥å‚æ–¹æ³•å¯ä»¥æ§åˆ¶åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ï¼Œæé«˜çµæ´»æ€§ï¼›</p>
</li>
<li>
<p>é™æ€å·¥å‚æ–¹æ³•å¯ä»¥ç¼“å­˜å·²åˆ›å»ºçš„å¯¹è±¡ï¼Œé¿å…åˆ›å»ºé‡å¤å¯¹è±¡ï¼Œæé«˜æ€§èƒ½ï¼›</p>
</li>
<li>
<p>é™æ€å·¥å‚æ–¹æ³•å¯ä»¥è¿”å›ä»»æ„ç±»å‹çš„å¯¹è±¡ï¼Œè€Œä¸ä»…ä»…æ˜¯è¯¥ç±»æˆ–è€…å…¶å­ç±»çš„å®ä¾‹ã€‚</p>
</li>
</ul>
<p>2ã€ä½¿ç”¨æ„é€ å™¨ä»£æ›¿æ„é€ æ–¹æ³•</p>
<p>å½“ä¸€ä¸ªç±»éœ€è¦å¤šä¸ªå‚æ•°æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ„å»ºå™¨ï¼Œå°†å‚æ•°é€ä¸ªè®¾ç½®ï¼Œæœ€åè°ƒç”¨buildæ–¹æ³•æ„å»ºå¯¹è±¡ã€‚æ„å»ºå™¨çš„ä¼˜ç‚¹åŒ…æ‹¬ï¼š</p>
<ul>
<li>
<p>å¯ä»¥é¿å…é•¿å‚æ•°åˆ—è¡¨ï¼Œä½¿å¾—ä»£ç æ›´åŠ æ¸…æ™°æ˜“è¯»ï¼›</p>
</li>
<li>
<p>æ„å»ºå™¨å¯ä»¥å¼ºåˆ¶è¦æ±‚å¿…éœ€çš„å‚æ•°ï¼Œæé«˜ä»£ç çš„å®‰å…¨æ€§ï¼›</p>
</li>
<li>
<p>æ„å»ºå™¨å¯ä»¥è¿”å›ä¸å¯å˜å¯¹è±¡ï¼Œæé«˜ä»£ç çš„çº¿ç¨‹å®‰å…¨æ€§ã€‚</p>
</li>
</ul>
<p>3ã€ä½¿ç”¨ç§æœ‰æ„é€ å‡½æ•°æˆ–æšä¸¾ç±»å‹åˆ›å»ºå•ä¾‹</p>
<p>é€šè¿‡ç§æœ‰æ„é€ å™¨æˆ–è€…æšä¸¾ç±»å‹æ¥å®ç°Singletonï¼Œå®ƒä»¬çš„ä¼˜ç‚¹åŒ…æ‹¬ï¼š</p>
<ul>
<li>
<p>å¯ä»¥ç¡®ä¿åªæœ‰ä¸€ä¸ªå®ä¾‹å­˜åœ¨ï¼Œæé«˜ä»£ç çš„å®‰å…¨æ€§ï¼›</p>
</li>
<li>
<p>å¯ä»¥ç¼©å°ç±»çš„å¯è®¿é—®æ€§ï¼Œæé«˜ä»£ç çš„å°è£…æ€§ï¼›</p>
</li>
<li>
<p>å¯ä»¥è®©ä»£ç æ›´åŠ è‡ªç„¶ï¼Œé¿å…ä½¿ç”¨é™æ€æ–¹æ³•å’Œé™æ€å˜é‡çš„é™åˆ¶ã€‚</p>
</li>
</ul>
<p>4ã€ç”¨ç§æœ‰æ„é€ å‡½æ•°ä½¿ç±»ä¸å¯å®ä¾‹åŒ–</p>
<p>ä½¿ç”¨ç§æœ‰æ„é€ å‡½æ•°å¼ºåˆ¶å®ç°ä¸å¯å®ä¾‹åŒ–çš„ä¸»è¦åŸå› æ˜¯é˜²æ­¢ç±»è¢«æ„å¤–åœ°å®ä¾‹åŒ–ï¼Œä»¥ä½¿ä»£ç æ›´åŠ å¥å£®å’Œå¯é ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ç±»ä¸­çš„é™æ€æ–¹æ³•å’Œé™æ€å­—æ®µï¼Œè€Œä¸éœ€è¦åˆ›å»ºè¯¥ç±»çš„å®ä¾‹ã€‚</p>
<p>5ã€ä¾èµ–æ³¨å…¥ä¼˜äºç¡¬ç¼–ç èµ„æº</p>
<p>ä½¿ç”¨ä¾èµ–æ³¨å…¥æ¯”ç¡¬ç¼–ç èµ„æºçš„ä¼˜ç‚¹ï¼š</p>
<ol>
<li>å¯æµ‹è¯•æ€§ï¼šä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼Œå¾ˆå®¹æ˜“åˆ›å»ºå’Œæ³¨å…¥æ¨¡æ‹Ÿå¯¹è±¡è¿›è¡Œæµ‹è¯•ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ­£åœ¨æµ‹è¯•çš„ç»„ä»¶éš”ç¦»å¼€æ¥ï¼Œå¹¶ä¸“æ³¨äºæµ‹è¯•å…¶è¡Œä¸ºï¼Œè€Œä¸å¿…æ‹…å¿ƒå…¶ä¾èµ–é¡¹çš„è¡Œä¸ºã€‚</li>
<li>çµæ´»æ€§ï¼šä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°ç”¨ä¸åŒå®ç°æ›¿æ¢ä¾èµ–é¡¹ã€‚è¿™åœ¨éœ€è¦æ›´æ”¹ç»„ä»¶çš„è¡Œä¸ºè€Œä¸æ›´æ”¹å…¶ä»£ç æ—¶éå¸¸æœ‰ç”¨ã€‚</li>
<li>è§£è€¦ï¼šä¾èµ–æ³¨å…¥æœ‰åŠ©äºå°†ç»„ä»¶ä¸å…¶ä¾èµ–é¡¹è§£è€¦ï¼Œä½¿ä»£ç æ›´åŠ æ¨¡å—åŒ–å¹¶æ˜“äºç»´æŠ¤ã€‚</li>
<li>å…³æ³¨ç‚¹åˆ†ç¦»ï¼šä¾èµ–æ³¨å…¥å°†ä¾èµ–é¡¹çš„åˆ›å»ºå’Œç®¡ç†ä¸ç»„ä»¶æœ¬èº«åˆ†ç¦»ï¼Œå…è®¸æ›´æ¸…æ™°åœ°åˆ†ç¦»å…³æ³¨ç‚¹ã€‚</li>
</ol>
<p>6ã€é¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡</p>
<p>7ã€æ’é™¤è¿‡æ—¶çš„å¯¹è±¡å¼•ç”¨</p>
<p>åœ¨ä»£ç ä¸­åŠæ—¶æ¸…ç†ä¸å†ä½¿ç”¨çš„å¯¹è±¡å¼•ç”¨ï¼Œä»¥é¿å…å†…å­˜æ³„æ¼å’Œæ€§èƒ½é—®é¢˜ã€‚å½“ä¸€ä¸ªå¯¹è±¡ä¸å†éœ€è¦æ—¶ï¼Œåº”è¯¥å°½å¿«å°†å…¶å¼•ç”¨è®¾ç½®ä¸ºnullï¼Œè¿™æ ·JVMå¯ä»¥åŠæ—¶å›æ”¶å®ƒæ‰€å ç”¨çš„å†…å­˜ã€‚</p>
<p>8ã€é¿å…ä½¿ç”¨ç»ˆç»“å™¨å’Œæ¸…é™¤å™¨</p>
<p>ç»ˆç»“æ–¹æ³•å’Œæ¸…é™¤æ–¹æ³•æ˜¯ä¸€ç§é‡Šæ”¾èµ„æºçš„æ–¹å¼ï¼Œä½†æ˜¯å®ƒä»¬å¹¶ä¸å¯é ï¼Œä¸åº”è¯¥ä¾èµ–äºå®ƒä»¬æ¥é‡Šæ”¾èµ„æºã€‚åº”è¯¥ä½¿ç”¨try-with-resourcesç»“æ„æˆ–è€…æ˜¾å¼çš„è°ƒç”¨closeæ–¹æ³•æ¥é‡Šæ”¾èµ„æºã€‚</p>
<p>9ã€ä½¿ç”¨ try-with-resources ä¼˜äº try-finally</p>
<p><code>try-with-resources</code> è¯­å¥æ˜¯ Java 7 ä¸­å¼•å…¥çš„ä¸€ç§æ–°è¯­æ³•ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†ç®€åŒ–èµ„æºç®¡ç†çš„ä»£ç ï¼Œå¹¶ç¡®ä¿èµ„æºè¢«æ­£ç¡®åœ°å…³é—­ï¼Œé¿å…äº†èµ„æºæ³„æ¼å’Œå¼‚å¸¸å¤„ç†çš„é—®é¢˜ã€‚</p>
<h3 id="python">Python</h3>
<ul>
<li><a href="/posts/2023/05/09/python-install-build-publish-run/">Pythonå®‰è£…ã€æ„å»ºã€å‘å¸ƒã€ä¸‹è½½å’Œè¿è¡Œ</a></li>
<li><a href="/posts/2023/05/09/python-package-and-env-management/">PythonåŒ…å’Œç¯å¢ƒç®¡ç†</a></li>
</ul>
<h2 id="æœ¬å‘¨åˆ†äº«">æœ¬å‘¨åˆ†äº«</h2>
<p>å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€<a href="https://t.me/chensoul_share">ChenSoul Share</a>ã€Telegram é¢‘é“æˆ–è€…æˆ‘çš„ <a href="https://memos.chensoul.com/">memos</a> ä¸­ã€‚æˆ‘å†™äº†ä¸€ä¸ª python è„šæœ¬ä» memosè¯»å–æœ€è¿‘ä¸€å‘¨çš„ memos è®°å½•ã€‚</p>
<ul>
<li><strong>2023-05-06</strong> git flow æ¨¡å‹çš„æå‡ºï¼š<a href="https://nvie.com/posts/a-successful-git-branching-model/">æŸ¥çœ‹é“¾æ¥</a>  gitflow-avh æ˜¯ä¸€ä¸ªå¢å¼ºå·¥å…·ï¼š<a href="https://github.com/petervanderdoes/gitflow-avh">æŸ¥çœ‹é“¾æ¥</a>  <code>#git</code> <code>#tool</code> <code>#memos</code></li>
<li><strong>2023-05-06</strong> åˆæœ‰å“ªå®¶é˜…è¯»ç®¡ç†ç½‘ç«™å¯å–ä»£è±†ç“£è¯»ä¹¦ <a href="https://glennwoo.com/2022/07/29/about-reading-tracker-websites/">æŸ¥çœ‹é“¾æ¥</a>  <code>#douban</code> <code>#memos</code></li>
<li><strong>2023-05-05</strong> åˆ†äº«ä¸€äº›é˜…äººç»éªŒï¼š  1. å˜´å·´å¤ªå¿«çš„äººï¼Œå¾€å¾€æ²¡ä»€ä¹ˆåŸåºœã€‚å˜´å·´å¤ªç”œçš„äººï¼Œä¸å¯ä»¥æ·±äº¤ã€‚ 2. è¯å°‘çš„äººå¾€å¾€æ˜¯ä¸¤ä¸ªæç«¯ï¼Œè¦ä¹ˆçœŸçš„ç®€å•ï¼Œè¦ä¹ˆæ·±ä¸å¯æµ‹ã€‚ 3. æ€§æ ¼å†™åœ¨è„¸ä¸Šçš„äººï¼Œäººå“ä¸ä¼šå¤ªå·®ã€‚èƒ½å¤Ÿæ§åˆ¶æƒ…ç»ªçš„äººï¼Œå¾€å¾€ä¸æ˜¯ä¸€èˆ¬äººã€‚ 4. å¼€å£å°±è¯´â€œæˆ‘æœ‰ä¸€ä¸ªæœ‹å‹æ€æ ·æ€æ ·â€çš„äººï¼Œå¾€å¾€å•çº¯æ²¡å•¥çœŸæœ¬äº‹ã€‚ 5. ä¸å–œæ¬¢éº»çƒ¦åˆ«äººçš„äººï¼Œé€šå¸¸ä¹Ÿä¸å–œæ¬¢è¢«åˆ«äººéº»çƒ¦ã€‚ä¸€ä¸ªä¸æ‡‚æ‹’ç»çš„äººï¼Œä¹Ÿæ˜¯ä¸€ä¸ªä¸æ‡‚åº”é…¬çš„äººã€‚ 6. å¦‚æœä¸€ä¸ªäººå¯ä»¥åšåˆ°æ½‡æ´’è€Œä¸åˆç¾¤ï¼Œè¿™äººå¤šåŠæ˜¯ä¸ªè€æ±Ÿæ¹–ã€‚å¦‚æœä¸€ä¸ªäººå› ä¸åˆç¾¤ç‰¹åˆ«ä¸è‡ªåœ¨ï¼Œè¿™äººå¤šåŠæ˜¯ç¤¾ä¼šå°ç™½ã€‚ 7. çœ‹åœ°ä½é«˜çš„å¤§ä½¬æ¨èä»€ä¹ˆäººã€ç”¨ä»€ä¹ˆäººï¼Œé‚£è¿™ä¸ªå¤§ä½¬å°±æ˜¯ä»€ä¹ˆæ ·çš„äººã€‚ 8. è¶Šæ˜¯åšäº‹å°å¿ƒç¿¼ç¿¼çš„äººï¼Œè¶Šå®¹æ˜“å¾—ç½ªäººã€‚åè€Œéœ¸æ°”ç‚¹çš„äººï¼Œå¾€å¾€éƒ½ä¼šæœ‰ä¸‰åˆ†è–„é¢ã€‚ 9. å–„äºå·´ç»“è®¨å¥½åˆ«äººçš„äººï¼Œæœ€å¥½ä¸è¦ä¸ä¹‹æ·±äº¤ï¼Œå¦åˆ™å¿…å—å…¶ç´¯ã€‚ 10. çœ‹èµ·æ¥ä¸€æœ¬æ­£ç»ã€ä¸è‹Ÿè¨€ç¬‘ã€æ–¯æ–¯æ–‡æ–‡çš„äººï¼Œå¾€å¾€éƒ½æ¯”è¾ƒé—·éªšã€‚ 11. èƒ½åœ¨ä¸€å®šä½ç½®ä¸Šçš„äººï¼Œæ— è®ºä½ å¤šä¹ˆè®¨åŒä»–ï¼Œä¸€å®šæœ‰ä»–æŸäº›è¿‡äººä¹‹å¤„ã€‚ 12. èƒ½å¤Ÿåœ¨ä¸€æ®µæ„Ÿæƒ…å¤±è´¥åï¼Œå¾ˆå¿«èµ°å‡ºæ¥çš„äººï¼Œè¦ä¹ˆæ²¡æœ‰çœŸå¿ƒä»˜å‡ºï¼Œè¦ä¹ˆç†æ€§å¾—å¯æ€•ã€‚ 13. æƒ³çŸ¥é“ä¸€ä¸ªäººå“è¡Œå¦‚ä½•ï¼Œå¯ä»¥è§‚å¯Ÿä¸€ä¸‹ä»–åŸ¹å…»å‡ºæ¥çš„å­©å­ã€‚ 14. é«˜åº¦è‡ªå¾‹çš„äººï¼Œå¾€å¾€å¯¹åˆ«äººçš„è¦æ±‚ä¹Ÿå¾ˆé«˜ã€‚ 15. å¹´å°‘å¾—å¿—ï¼Œå¤ªå®¹æ˜“è·å¾—æˆåŠŸçš„äººï¼Œå¾€å¾€å®¹æ˜“æ ½è·Ÿå¤´ã€‚å¦‚æœèƒ½æ‰›è¿‡å»å¹¶å¸å–æ•™è®­ï¼Œå°†æ¥çš„æˆå°±ä¼šæ›´å¤§ï¼Œå¦åˆ™å®¹æ˜“æ‰å…¥æ·±æ¸Šã€‚ 16. é¢å¯¹æ­ç»´æˆ–ç¾è¾±éƒ½ä¸åŠ¨å£°è‰²çš„äººï¼Œè‚¯å®šæ˜¯åŸåºœææ·±çš„ç‹ è§’è‰²ã€‚è¿™ç§äººåƒä¸‡åˆ«ä¹±å¾—ç½ªï¼Œå¦åˆ™å—åˆ°çš„åå‡»ä¼šå¾ˆçªç„¶å¾ˆçŒ›çƒˆï¼Œä¸‹åœºä¼šå¾ˆæƒ¨ã€‚ <code>#æ‘˜å½•</code> <code>#memos</code></li>
<li><strong>2023-05-05</strong>  WoodpeckerCI æ˜¯ä¸€ä¸ªç”±ç¤¾åŒºç»´æŠ¤çš„ DroneCI åˆ†æ”¯ï¼Œä½¿ç”¨ Apache License 2.0 è®¸å¯è¯å‘å¸ƒã€‚ç¤¾åŒºç‰ˆè¿›ä¸€æ­¥æ‰©å±•äº† pipeline çš„åŠŸèƒ½ç‰¹æ€§ã€æ”¯æŒå¯¹æ–‡ä»¶è·¯å¾„è®¾ç½® pipeline æ‰§è¡Œæ¡ä»¶ï¼Œå¹¶ä¸”å¯ä»¥ä¸ Gitea å®ç°ç´§å¯†é›†æˆã€‚ä¸åŒçš„æ˜¯ï¼ŒDroneCI çš„é…ç½®æ–‡ä»¶æ˜¯ .drone.ymlï¼ŒWoodpeckerCI é‡å‘½åä¸ºäº† .woodpecker.ymlã€‚å¥½åœ¨ WoodpeckerCI ä¹Ÿå…¼å®¹ DroneCI çš„é…ç½®æ–‡ä»¶ï¼Œè¿ç§»èµ·æ¥å¹¶ä¸ä¼šå¤ªéº»çƒ¦ã€‚   <a href="https://github.com/woodpecker-ci/woodpecker">æŸ¥çœ‹é“¾æ¥</a>  <code>#memos</code> <code>#tool</code></li>
<li><strong>2023-05-04</strong> git-flow[å®æˆ˜ç³»åˆ—]  <a href="https://blog.p2hp.com/archives/10929">æŸ¥çœ‹é“¾æ¥</a>  <code>#memos</code> <code>#git</code> <code>#tool</code></li>
<li><strong>2023-05-04</strong> åœ¨ Node.js ç”Ÿæ€ç³»ç»Ÿä¸­æŸ¥æ‰¾ç§¯æç»´æŠ¤å’Œæµè¡Œçš„åº“ <a href="https://nodejstoolbox.com/">æŸ¥çœ‹é“¾æ¥</a>  <code>#web</code> <code>#nodejs</code> <code>#memos</code></li>
<li><strong>2023-05-04</strong> å¯ä»¥ç”¨æ¥å–ä»£UUID, æ•ˆç‡æ›´é«˜, æ”¯æŒè‡ªå®šä¹‰å­—ç¬¦é›† <a href="https://github.com/ai/nanoid">æŸ¥çœ‹é“¾æ¥</a>  <code>#memos</code> <code>#tool</code></li>
<li><strong>2023-05-04</strong> unDraw: ä¸€ä¸ªå¯ä»¥å…è´¹ä½¿ç”¨çš„æ’å›¾åº“, ä¼˜åŠ¿: å¯å…è´¹å•†ç”¨/æ”¯æŒç›´æ¥æ”¹è‰² <a href="https://undraw.co/illustrations">æŸ¥çœ‹é“¾æ¥</a>  <code>#memos</code> <code>#tool</code></li>
<li><strong>2023-05-04</strong> ä¸´æ—¶æ–‡ä»¶ä¸Šä¼ æœåŠ¡  æ–‡ä»¶ä¼ è¾“å·¥å…·ï¼Œä¸Šä¼ çš„æ–‡ä»¶åªä¿ç•™48å°æ—¶ï¼Œè¿‡æœŸè‡ªåŠ¨åˆ é™¤ <a href="https://sendfiles.online/">æŸ¥çœ‹é“¾æ¥</a>  Pixeldrain å…è´¹æ–‡ä»¶åˆ†äº«ï¼Œå…è´¹æ¯ä¸ªæ–‡ä»¶æœ€å¤§20 GB per fileï¼Œæ— å¹¿å‘Šã€‚ <a href="https://pixeldrain.com/">æŸ¥çœ‹é“¾æ¥</a>  TEMPORARY FILE HOSTING All uploaded files are automatically deleted after 60 minutes. <a href="https://tmpfiles.org/">æŸ¥çœ‹é“¾æ¥</a>  Super simple file sharing! Upload as many files as you like up to 2 GB and get a link to share.ï¼ˆä¸€æ¬¡ä¸‹è½½åï¼Œé“¾æ¥å³è¿‡æœŸï¼‰ <a href="https://www.file.io/">æŸ¥çœ‹é“¾æ¥</a>  Upload And Share (MP4, WEBM) Temporary Videos <a href="https://tempclip.com/">æŸ¥çœ‹é“¾æ¥</a>  <code>#memos</code> <code>#tool</code></li>
<li><strong>2023-05-04</strong> é€‚åˆç¼–ç¨‹æ—¶å¬çš„éŸ³ä¹  <a href="https://coderadio.freecodecamp.org/">æŸ¥çœ‹é“¾æ¥</a>  <a href="https://www.programmersmusic.com/">æŸ¥çœ‹é“¾æ¥</a>  <code>#memos</code> <code>#music</code></li>
</ul>
<p>ä»¥ä¸Šã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>PythonåŒ…å’Œç¯å¢ƒç®¡ç†</title>
      <link>https://blog.chensoul.com/posts/2023/05/09/python-package-and-env-management/</link>
      <pubDate>Tue, 09 May 2023 10:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/05/09/python-package-and-env-management/</guid>
      <description>å‘å±•å†å² Python åŒ…ç®¡ç†å·¥å…·æ˜¯ Python ç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå®ƒä»¬ä¸º Python å¼€å‘è€…æä¾›äº†æ–¹ä¾¿ã€å¿«æ·çš„åŒ…ç®¡ç†æ–¹å¼ã€‚ä»¥ä¸‹æ˜¯ Python åŒ…ç®¡ç†å·¥å…·çš„å‘å±•å†å²æ¦‚è¿°ï¼š 1991 å¹´ï¼šP</description>
      <content:encoded><![CDATA[<h2 id="å‘å±•å†å²">å‘å±•å†å²</h2>
<p>Python åŒ…ç®¡ç†å·¥å…·æ˜¯ Python ç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå®ƒä»¬ä¸º Python å¼€å‘è€…æä¾›äº†æ–¹ä¾¿ã€å¿«æ·çš„åŒ…ç®¡ç†æ–¹å¼ã€‚ä»¥ä¸‹æ˜¯ Python åŒ…ç®¡ç†å·¥å…·çš„å‘å±•å†å²æ¦‚è¿°ï¼š</p>
<ul>
<li>1991 å¹´ï¼šPython è¯­è¨€é¦–æ¬¡å‘å¸ƒï¼ŒPython åŒ…ç®¡ç†å·¥å…·è¿˜æœªå‡ºç°ã€‚</li>
<li>1998 å¹´ï¼šPython Distutils å·¥å…·å‘å¸ƒï¼Œå®ƒæ˜¯ Python çš„ç¬¬ä¸€ä¸ªåŒ…ç®¡ç†å·¥å…·ï¼Œå¯ä»¥ç”¨äºæ‰“åŒ…ã€å®‰è£…å’Œåˆ†å‘ Python åŒ…ã€‚</li>
<li>2004 å¹´ï¼šeasy_install å·¥å…·å‘å¸ƒï¼Œå®ƒæ˜¯ä¸€ç§ç”¨äºå®‰è£…ã€å‡çº§å’Œå¸è½½ Python åŒ…çš„å·¥å…·ï¼Œå¯ä»¥è‡ªåŠ¨è§£æä¾èµ–å…³ç³»å¹¶å®‰è£…æ‰€éœ€çš„å…¶ä»–åŒ…ã€‚</li>
<li>2007 å¹´ï¼špip å·¥å…·å‘å¸ƒï¼Œå®ƒæ˜¯ easy_install çš„ä¸€ä¸ªæ›¿ä»£å“ï¼Œæä¾›äº†æ›´å¥½çš„ä¾èµ–é¡¹è§£æã€å‡çº§å’Œå¸è½½åŠŸèƒ½ï¼Œä»¥åŠæ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚</li>
<li>2012 å¹´ï¼šPython è½¯ä»¶åŸºé‡‘ä¼šå®£å¸ƒï¼Œpip å°†æˆä¸º Python åŒ…ç®¡ç†ç”Ÿæ€ç³»ç»Ÿä¸­çš„æ ‡å‡†å·¥å…·ï¼Œå–ä»£ easy_installã€‚</li>
<li>2013 å¹´ï¼šWheel æ ¼å¼å‘å¸ƒï¼Œå®ƒæ˜¯ä¸€ç§ç”¨äºæ‰“åŒ…å’Œåˆ†å‘ Python åŒ…çš„æ ¼å¼ï¼Œå¯ä»¥åŒ…å« C æ‰©å±•æ¨¡å—ï¼Œå¹¶ä¸”æ”¯æŒå¤šå¹³å°å®‰è£…ã€‚</li>
<li>2018 å¹´ï¼šPEP 517 å’Œ 518 å‘å¸ƒï¼Œå®ƒä»¬æä¾›äº†ä¸€ç§æ–°çš„ Python åŒ…æ„å»ºå’Œåˆ†å‘æ ‡å‡†ï¼Œå¯ä»¥ä½¿åŒ…æ„å»ºå’Œåˆ†å‘å˜å¾—æ›´åŠ ç®€å•å’Œå¯é ã€‚</li>
<li>2018 å¹´ï¼šflit å·¥å…·å‘å¸ƒï¼Œå®ƒæ˜¯ä¸€ç§ç®€å•çš„ Python åŒ…æ„å»ºå’Œåˆ†å‘å·¥å…·ï¼Œå¯ä»¥é€šè¿‡ pyproject.toml æ–‡ä»¶æ¥é…ç½®åŒ…çš„å…ƒæ•°æ®å’Œä¾èµ–é¡¹ã€‚</li>
<li>2019 å¹´ï¼špoetry å·¥å…·å‘å¸ƒï¼Œå®ƒæ˜¯ä¸€ç§ä¸“æ³¨äºä¾èµ–ç®¡ç†å’Œé¡¹ç›®æ„å»ºçš„ Python åŒ…ç®¡ç†å·¥å…·ï¼Œå¯ä»¥è‡ªåŠ¨è§£æä¾èµ–å…³ç³»ã€æ„å»ºé¡¹ç›®ã€ç”Ÿæˆ lock æ–‡ä»¶ç­‰ã€‚</li>
<li>2020 å¹´ï¼šPEP 621 å‘å¸ƒï¼Œå®ƒæ˜¯ä¸€ç§æ–°çš„ Python åŒ…å…ƒæ•°æ®æ ‡å‡†ï¼Œå¯ä»¥ç”¨äºå®šä¹‰ Python åŒ…çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¦‚åç§°ã€ç‰ˆæœ¬ã€ä½œè€…ã€è®¸å¯è¯ç­‰ã€‚</li>
<li>2020 å¹´ï¼šPEP 636 å‘å¸ƒï¼Œå®ƒæ˜¯ä¸€ç§æ–°çš„ CPython æ‰©å±•æ¨¡å—å…ƒæ•°æ®æ ‡å‡†ï¼Œå¯ä»¥ç”¨äºå®šä¹‰ CPython æ‰©å±•æ¨¡å—çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¦‚åç§°ã€ç‰ˆæœ¬ã€ä½œè€…ã€è®¸å¯è¯ç­‰ã€‚</li>
<li>2021 å¹´ï¼šflit 3 å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ PEP 621 å’Œ PEP 636 çš„æ”¯æŒï¼Œå¯ä»¥ä½¿ç”¨ pyproject.toml æ–‡ä»¶æ¥å®šä¹‰ Python åŒ…å’Œ CPython æ‰©å±•æ¨¡å—çš„å…ƒæ•°æ®ä¿¡æ¯ã€‚</li>
</ul>
<p>PyPA æ˜¯ Python Packaging Authority çš„ç¼©å†™ï¼Œå³ Python åŒ…ç®¡ç†æƒå¨ç»„ç»‡ã€‚PyPA çš„ç›®æ ‡æ˜¯ä¸º Python ç¤¾åŒºæä¾›ä¸€ä¸ªæ ‡å‡†çš„ã€æ˜“äºä½¿ç”¨çš„åŒ…ç®¡ç†å·¥å…·å’Œç›¸å…³å·¥å…·çš„ç”Ÿæ€ç³»ç»Ÿï¼Œå¹¶æä¾›ç›¸å…³çš„æ–‡æ¡£å’Œè§„èŒƒã€‚</p>
<p>PyPA ç»„ç»‡æˆç«‹äº 2013 å¹´ï¼Œç”±ä¸€äº› Python åŒ…ç®¡ç†å·¥å…·çš„æ ¸å¿ƒå¼€å‘è€…ç»„æˆã€‚ç›®å‰ï¼ŒPyPA ç»„ç»‡ç»´æŠ¤äº†ä¸€äº› Python åŒ…ç®¡ç†å·¥å…·å’Œç›¸å…³å·¥å…·çš„é¡¹ç›®ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li><code>pip</code>: Python åŒ…ç®¡ç†å·¥å…·ï¼Œç”¨äºå®‰è£…å’Œç®¡ç† Python åŒ…ã€‚</li>
<li><code>setuptools</code>: Python åŒ…æ„å»ºå’Œåˆ†å‘å·¥å…·ï¼Œç”¨äºæ‰“åŒ…å’Œåˆ†å‘ Python åŒ…ã€‚</li>
<li><code>wheel</code>: Python åŒ…äºŒè¿›åˆ¶åˆ†å‘æ ¼å¼ï¼Œç”¨äºåŠ å¿« Python åŒ…çš„å®‰è£…é€Ÿåº¦ã€‚</li>
<li><code>twine</code>: Python åŒ…ä¸Šä¼ å·¥å…·ï¼Œç”¨äºå°† Python åŒ…ä¸Šä¼ åˆ° PyPI æˆ–å…¶ä»–åŒ…ä»“åº“ã€‚</li>
<li><code>virtualenv</code>: Python è™šæ‹Ÿç¯å¢ƒå·¥å…·ï¼Œç”¨äºåˆ›å»ºå’Œç®¡ç† Python è™šæ‹Ÿç¯å¢ƒã€‚</li>
</ul>
<p>æ­¤å¤–ï¼ŒPyPA è¿˜åˆ¶å®šäº†ä¸€äº›åŒ…ç®¡ç†çš„æ ‡å‡†å’Œè§„èŒƒï¼Œå¦‚ï¼š</p>
<ul>
<li><code>PEP 517</code> å’Œ <code>PEP 518</code>: å®šä¹‰äº† Python åŒ…çš„æ„å»ºè§„èŒƒå’Œæ„å»ºå·¥å…·çš„æ¥å£è§„èŒƒã€‚</li>
<li><code>PEP 440</code>: å®šä¹‰äº† Python åŒ…ç‰ˆæœ¬å·çš„è¯­ä¹‰åŒ–è§„èŒƒã€‚</li>
<li><code>PEP 503</code>: å®šä¹‰äº† Python åŒ…ä»“åº“çš„ URL å‘½åè§„èŒƒã€‚</li>
<li><code>PEP 621</code>: å®šä¹‰äº† Python åŒ…å…ƒæ•°æ®çš„æ ‡å‡†æ ¼å¼ã€‚</li>
</ul>
<p>PyPA çš„å·¥ä½œå¯¹ Python ç¤¾åŒºçš„åŒ…ç®¡ç†ç”Ÿæ€ç³»ç»Ÿäº§ç”Ÿäº†é‡è¦çš„å½±å“ï¼Œä½¿å¾— Python åŒ…çš„æ„å»ºã€åˆ†å‘ã€å®‰è£…å’Œç®¡ç†æ›´åŠ ç»Ÿä¸€å’Œè§„èŒƒã€‚åœ¨ä½¿ç”¨ Python åŒ…æ—¶ï¼Œå¯ä»¥å‚è€ƒ PyPA çš„ç›¸å…³å·¥å…·å’Œè§„èŒƒï¼Œä»¥ä¾¿æ›´å¥½åœ°ç®¡ç†å’Œä½¿ç”¨ Python åŒ…ã€‚</p>
<h3 id="distutils-å‘å±•å†å²">Distutils å‘å±•å†å²</h3>
<p>Distutils æ˜¯ Python ç”Ÿæ€ç³»ç»Ÿä¸­çš„ç¬¬ä¸€ä¸ªåŒ…ç®¡ç†å·¥å…·ï¼Œå®ƒä¸º Python å¼€å‘è€…æä¾›äº†ä¸€ç§æ–¹ä¾¿ã€å¿«æ·çš„åŒ…ç®¡ç†æ–¹å¼ã€‚ä»¥ä¸‹æ˜¯ Distutils çš„å‘å±•å†å²æ¦‚è¿°ï¼š</p>
<ul>
<li>1998 å¹´ï¼šPython 1.5.2 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒæˆä¸ºç¬¬ä¸€ä¸ªå…·å¤‡æ¨¡å—æ‰“åŒ…åŠŸèƒ½çš„ Python ç‰ˆæœ¬ï¼Œä½†æ‰“åŒ…åŠŸèƒ½è¿˜æ¯”è¾ƒç®€å•ã€‚</li>
<li>1999 å¹´ï¼šDistutils å·¥å…·å‘å¸ƒï¼Œå®ƒæ˜¯ Python 1.6 ç‰ˆæœ¬ä¸­çš„ä¸€ä¸ªæ ‡å‡†åº“ï¼Œå¯ä»¥ç”¨äºæ‰“åŒ…ã€å®‰è£…å’Œåˆ†å‘ Python åŒ…ã€‚</li>
<li>2000 å¹´ï¼šDistutils 0.9.1 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Windows å¹³å°çš„æ”¯æŒï¼Œä»¥åŠå¯¹ Python 2.0 ç‰ˆæœ¬çš„æ”¯æŒã€‚</li>
<li>2002 å¹´ï¼šDistutils 1.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 2.2 ç‰ˆæœ¬çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒ C æ‰©å±•æ¨¡å—ã€æ”¯æŒè‡ªå®šä¹‰å‘½ä»¤ã€æ”¯æŒæ‰“åŒ…å¤šä¸ªæ¨¡å—ç­‰ã€‚</li>
<li>2007 å¹´ï¼šsetuptools å·¥å…·å‘å¸ƒï¼Œå®ƒæ˜¯ Distutils çš„ä¸€ä¸ªæ‰©å±•ï¼Œæä¾›äº†æ›´å¥½çš„ä¾èµ–é¡¹è§£æã€å‡çº§å’Œå¸è½½åŠŸèƒ½ï¼Œä»¥åŠæ›´å¥½çš„æ’ä»¶æœºåˆ¶å’Œæ‰©å±•æ€§ã€‚</li>
<li>2013 å¹´ï¼šDistutils é¡¹ç›®åœæ­¢ç»´æŠ¤ï¼Œå®ƒçš„ä»£ç è¢«åˆå¹¶åˆ° Python æ ‡å‡†åº“ä¸­ï¼Œæˆä¸º Python æ‰“åŒ…å’Œåˆ†å‘çš„æ ‡å‡†å·¥å…·ã€‚</li>
</ul>
<p>æ€»çš„æ¥è¯´ï¼ŒDistutils æ˜¯ Python ç”Ÿæ€ç³»ç»Ÿä¸­ç¬¬ä¸€ä¸ªåŒ…ç®¡ç†å·¥å…·ï¼Œå®ƒä¸º Python åŒ…çš„æ„å»ºã€æ‰“åŒ…ã€å®‰è£…å’Œåˆ†å‘æä¾›äº†å¾ˆå¤šæ–¹ä¾¿å’Œæ”¯æŒã€‚åœ¨å…¶å‘å±•å†å²ä¸­ï¼ŒDistutils ä¸æ–­æ›´æ–°è¿­ä»£ï¼Œå¢åŠ äº†è®¸å¤šæ–°ç‰¹æ€§å’ŒåŠŸèƒ½ï¼Œä»¥é€‚åº” Python ç”Ÿæ€ç³»ç»Ÿçš„å˜åŒ–å’Œéœ€æ±‚ã€‚å°½ç®¡ç°åœ¨ Distutils ä¸å†ä¸»åŠ¨ç»´æŠ¤ï¼Œä½†å®ƒçš„ä»£ç è¢«é›†æˆåˆ° Python æ ‡å‡†åº“ä¸­ï¼Œä»ç„¶ä¸º Python åŒ…ç®¡ç†æä¾›åŸºç¡€æ”¯æŒã€‚</p>
<h3 id="easy_install-å‘å±•å†å²">easy_install å‘å±•å†å²</h3>
<p>easy_install æ˜¯ Python åŒ…ç®¡ç†å·¥å…·ä¹‹ä¸€ï¼Œå®ƒçš„å‘å±•å†å²å¯ä»¥è¿½æº¯åˆ° 2004 å¹´ï¼Œä»¥ä¸‹æ˜¯ easy_install çš„å‘å±•å†å²æ¦‚è¿°ï¼š</p>
<ul>
<li>2004 å¹´ï¼šeasy_install é¦–æ¬¡å‘å¸ƒï¼Œå®ƒæ˜¯ä¸€ç§ç”¨äºå®‰è£…ã€å‡çº§å’Œå¸è½½ Python åŒ…çš„å·¥å…·ï¼Œå¯ä»¥è‡ªåŠ¨è§£æä¾èµ–å…³ç³»å¹¶å®‰è£…æ‰€éœ€çš„å…¶ä»–åŒ…ã€‚</li>
<li>2005 å¹´ï¼šeasy_install è¢«çº³å…¥åˆ° setuptools ä¸­ï¼Œæˆä¸º setuptools çš„ä¸€éƒ¨åˆ†ã€‚æ­¤æ—¶ï¼Œeasy_install å·²ç»æˆä¸º Python åŒ…ç®¡ç†ç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¸€ä¸ªæ ¸å¿ƒå·¥å…·ã€‚</li>
<li>2007 å¹´ï¼šeasy_install 0.6b1 å‘å¸ƒï¼Œå®ƒå¼•å…¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œå¦‚å¯¹æºç åˆ†å‘çš„æ”¯æŒã€å¯¹ egg æ ¼å¼çš„æ”¯æŒç­‰ã€‚</li>
<li>2008 å¹´ï¼špip å·¥å…·å‘å¸ƒï¼Œå®ƒæ˜¯ easy_install çš„ä¸€ä¸ªæ›¿ä»£å“ï¼Œæä¾›äº†æ›´å¥½çš„ä¾èµ–é¡¹è§£æã€å‡çº§å’Œå¸è½½åŠŸèƒ½ï¼Œä»¥åŠæ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚</li>
<li>2012 å¹´ï¼šPython è½¯ä»¶åŸºé‡‘ä¼šå®£å¸ƒï¼Œpip å°†æˆä¸º Python åŒ…ç®¡ç†ç”Ÿæ€ç³»ç»Ÿä¸­çš„æ ‡å‡†å·¥å…·ï¼Œå–ä»£ easy_installã€‚</li>
</ul>
<p>æ€»çš„æ¥è¯´ï¼Œeasy_install æ˜¯ Python åŒ…ç®¡ç†ç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦å·¥å…·ï¼Œå®ƒä¸º Python å¼€å‘è€…æä¾›äº†ä¸€ç§ç®€å•ã€æ–¹ä¾¿çš„åŒ…ç®¡ç†æ–¹å¼ã€‚å°½ç®¡ easy_install çš„åŠŸèƒ½å’Œæ€§èƒ½åœ¨æŸäº›æ–¹é¢å·²ç»è¢« pip å’Œå…¶ä»–å·¥å…·å–ä»£ï¼Œä½†å®ƒä»ç„¶æ˜¯ Python åŒ…ç®¡ç†å†å²ä¸Šçš„ä¸€ä¸ªé‡è¦é‡Œç¨‹ç¢‘ï¼Œå¯¹ Python åŒ…ç®¡ç†å·¥å…·çš„å‘å±•äº§ç”Ÿäº†ç§¯æçš„å½±å“ã€‚</p>
<h3 id="setuptools-å‘å±•å†å²">Setuptools å‘å±•å†å²</h3>
<p>setuptools æ˜¯ç”± Phillip J. Eby å¼€å‘çš„ï¼Œå®ƒæ˜¯ Python çš„ä¸€ä¸ªåŒ…ç®¡ç†å·¥å…·ï¼Œç”¨äºæ„å»ºã€åˆ†å‘å’Œå®‰è£… Python åŒ…ã€‚</p>
<p>Phillip J. Eby æ˜¯ä¸€ä½çŸ¥åçš„ Python ç¤¾åŒºæˆå‘˜å’Œå¼€æºè½¯ä»¶è´¡çŒ®è€…ï¼Œä»–ä¹Ÿæ˜¯ Python Packaging Authority çš„æˆå‘˜ä¹‹ä¸€ã€‚åœ¨ 2004 å¹´ï¼Œä»–å¼€å§‹å¼€å‘ setuptoolsï¼Œè¿™ä¸ªé¡¹ç›®çš„ç›®æ ‡æ˜¯ä¸º Python å¼€å‘è€…æä¾›ä¸€ä¸ªæ›´å¥½ã€æ›´æ–¹ä¾¿çš„åŒ…ç®¡ç†å·¥å…·ï¼Œä»¥æ›¿ä»£åŸæœ‰çš„ distutils å·¥å…·ã€‚</p>
<p>setuptools å’Œ distutils çš„ä¸»è¦åŒºåˆ«åœ¨äº setuptools æä¾›äº†ä¸€äº›é¢å¤–çš„åŠŸèƒ½ï¼Œå¦‚è‡ªåŠ¨å‘ç°ä¾èµ–å…³ç³»ã€æ”¯æŒå‘½ä»¤æ‰©å±•ã€æ”¯æŒ egg åŒ…ç­‰ã€‚è¿™äº›åŠŸèƒ½ä½¿å¾— Python åŒ…çš„æ„å»ºã€åˆ†å‘å’Œå®‰è£…å˜å¾—æ›´åŠ çµæ´»å’Œé«˜æ•ˆã€‚</p>
<p>setuptools ä»ä¸€å¼€å§‹å°±å—åˆ°äº† Python ç¤¾åŒºçš„æ¬¢è¿å’Œæ”¯æŒï¼Œå®ƒçš„ä»£ç æ‰˜ç®¡åœ¨ GitHub ä¸Šï¼Œå¹¶é€æ¸å‘å±•æˆä¸º Python ç”Ÿæ€ç³»ç»Ÿä¸­ä½¿ç”¨æœ€å¹¿æ³›çš„åŒ…ç®¡ç†å·¥å…·ä¹‹ä¸€ã€‚setuptools ä¹Ÿæ˜¯è®¸å¤šå…¶ä»– Python å·¥å…·å’Œæ¡†æ¶çš„åŸºç¡€ï¼Œå¦‚ Flaskã€Djangoã€numpy ç­‰ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ Setuptools çš„å‘å±•å†å²æ¦‚è¿°ï¼š</p>
<ul>
<li>1994å¹´ï¼šPython 1.0ç‰ˆæœ¬ä¸­æ²¡æœ‰ <code>setup.py</code>ï¼Œå®‰è£… Python åŒ…éœ€è¦æ‰‹åŠ¨å¤åˆ¶æ–‡ä»¶ã€‚éšç€ Python çš„å‘å±•ï¼Œç”¨æˆ·éœ€è¦æ›´æ–¹ä¾¿çš„æ–¹æ³•æ¥å®‰è£…å’Œç®¡ç†åŒ…ï¼Œå› æ­¤å¼€å§‹å‡ºç°äº†ä¸€äº›ç®€å•çš„è‡ªåŠ¨åŒ–å®‰è£…å·¥å…·ã€‚</li>
<li>2000å¹´ï¼šDistutils æ˜¯ Python1.6 å®˜æ–¹çš„åŒ…ç®¡ç†å·¥å…·ï¼Œå®ƒæä¾›äº†ä¸€ç»„ç”¨äºæ‰“åŒ…ã€æ„å»ºå’Œåˆ†å‘ Python åŒ…çš„å·¥å…·å’Œå‘½ä»¤ã€‚å…¶ä¸­ï¼Œ<code>setup.py</code> æ˜¯ Distutils çš„æ ¸å¿ƒç»„ä»¶ï¼Œç”¨äºå®šä¹‰å’Œé…ç½®åŒ…çš„å…ƒæ•°æ®ã€ä¾èµ–é¡¹å’Œå…¥å£ç‚¹ç­‰ä¿¡æ¯ã€‚</li>
<li>2004 å¹´ï¼šSetuptools é¦–æ¬¡å‘å¸ƒï¼Œå®ƒæ˜¯ Distutils çš„ä¸€ä¸ªæ‰©å±•ï¼Œæä¾›äº†ä¸€äº›é¢å¤–çš„åŠŸèƒ½å’Œæ‰©å±•ï¼Œå¦‚å¯¹ egg æ ¼å¼çš„æ”¯æŒã€å¯¹ä¾èµ–é¡¹çš„ç®¡ç†ã€å¯¹å‘½ä»¤æ‰©å±•çš„æ”¯æŒç­‰ã€‚</li>
<li>2008 å¹´ï¼šSetuptools 0.6 å‘å¸ƒï¼Œå®ƒå¼•å…¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œå¦‚å¯¹ Python 2.6 å’Œ 3.0 çš„æ”¯æŒã€å¯¹ namespace packages çš„æ”¯æŒç­‰ã€‚</li>
<li>2010 å¹´ï¼šDistribute å‘å¸ƒï¼Œå®ƒæ˜¯ Setuptools çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œæ—¨åœ¨æä¾›æ›´å¥½çš„å…¼å®¹æ€§å’Œæ˜“ç”¨æ€§ã€‚Distribute ç§»é™¤äº†ä¸€äº›è¿‡æ—¶çš„åŠŸèƒ½å’Œé€‰é¡¹ï¼Œå¹¶æ·»åŠ äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ‰©å±•ã€‚</li>
<li>2013 å¹´ï¼šSetuptools 0.7 å‘å¸ƒï¼Œå®ƒå€Ÿé‰´äº† Distribute çš„ä¸€äº›è®¾è®¡å’ŒåŠŸèƒ½ï¼Œå¹¶ç§»é™¤äº†ä¸€äº›è¿‡æ—¶çš„åŠŸèƒ½å’Œé€‰é¡¹ã€‚Setuptools 0.7 çš„è¯­æ³•ä¸ Distribute çš„è¯­æ³•ç›¸åŒã€‚</li>
<li>2018 å¹´ï¼šSetuptools 40.0 å‘å¸ƒï¼Œå®ƒå¼•å…¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œå¹¶ç§»é™¤äº†ä¸€äº›è¿‡æ—¶çš„åŠŸèƒ½å’Œé€‰é¡¹ã€‚Setuptools 40.0 çš„è¯­æ³•ä¸ Setuptools 0.7 ç›¸åŒã€‚</li>
<li>2020 å¹´ï¼šSetuptools 49.0 å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.9 çš„æ”¯æŒï¼Œå¹¶å¼•å…¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œå¦‚å¯¹ GitLab çš„æ”¯æŒã€å¯¹ç¯å¢ƒå˜é‡çš„æ”¯æŒç­‰ã€‚</li>
</ul>
<h3 id="setupcfg-å‘å±•å†å²">setup.cfg å‘å±•å†å²</h3>
<p><code>setup.cfg</code> æ–‡ä»¶æ˜¯ Python é¡¹ç›®çš„å…ƒæ•°æ®å’Œæ„å»ºé€‰é¡¹çš„é…ç½®æ–‡ä»¶ï¼Œå®ƒå¯ä»¥æ›¿ä»£ <code>setup.py</code> è„šæœ¬æ¥å®šä¹‰ Python é¡¹ç›®çš„å…ƒæ•°æ®å’Œæ„å»ºé€‰é¡¹ã€‚ä»¥ä¸‹æ˜¯ <code>setup.cfg</code> çš„ä¸»è¦å‘å±•å†å²ï¼š</p>
<ul>
<li>Python 2.5ï¼š<code>setuptools</code> æ‰©å±•æ¨¡å—å‘å¸ƒï¼Œå¼•å…¥äº† <code>setup.cfg</code> æ–‡ä»¶æ¥å®šä¹‰é¡¹ç›®çš„å…ƒæ•°æ®å’Œæ„å»ºé€‰é¡¹ã€‚</li>
<li>Python 3.1ï¼š<code>distutils2</code> é¡¹ç›®å‘å¸ƒï¼Œæ—¨åœ¨æ”¹è¿› <code>distutils</code> æ¨¡å—çš„è®¾è®¡å’Œå®ç°ï¼Œå¼•å…¥äº† <code>setup.cfg</code> æ–‡ä»¶ä½œä¸ºå®šä¹‰é¡¹ç›®å…ƒæ•°æ®å’Œæ„å»ºé€‰é¡¹çš„é¦–é€‰æ–¹å¼ã€‚</li>
<li>Python 3.4ï¼š<code>setuptools</code> æ‰©å±•æ¨¡å—è¢«æ·»åŠ åˆ° Python æ ‡å‡†åº“ä¸­ï¼Œæˆä¸º <code>distutils</code> çš„ä¸€éƒ¨åˆ†ï¼Œ<code>setup.cfg</code> æ–‡ä»¶æˆä¸ºæ ‡å‡†çš„é…ç½®æ–‡ä»¶æ ¼å¼ã€‚</li>
</ul>
<p>éšç€ Python çš„å‘å±•ï¼Œ<code>setup.cfg</code> æ–‡ä»¶é€æ¸æˆä¸º Python é¡¹ç›®çš„æ ‡å‡†é…ç½®æ–‡ä»¶æ ¼å¼ã€‚å®ƒæä¾›äº†æ¯” <code>setup.py</code> è„šæœ¬æ›´ç®€æ´ã€æ›´æ˜“äºé˜…è¯»å’Œç»´æŠ¤çš„é…ç½®æ–¹å¼ï¼ŒåŒæ—¶ä¹Ÿæ›´å®¹æ˜“ä¸å…¶ä»–å·¥å…·é›†æˆã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>setup.cfg</code> æ–‡ä»¶å¹¶ä¸æ˜¯å¿…éœ€çš„ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šè¯¥æ–‡ä»¶ï¼Œåˆ™ <code>setuptools</code> å°†é»˜è®¤ä½¿ç”¨ <code>setup.py</code> è„šæœ¬æ¥å®šä¹‰é¡¹ç›®çš„å…ƒæ•°æ®å’Œæ„å»ºé€‰é¡¹</p>
<h3 id="pyprojecttoml-å‘å±•å†å²">pyproject.toml å‘å±•å†å²</h3>
<p><code>pyproject.toml</code> æ˜¯ä¸€ä¸ª TOML æ ¼å¼çš„æ–‡ä»¶ï¼Œç”¨äºå®šä¹‰ Python é¡¹ç›®çš„å…ƒæ•°æ®å’Œæ„å»ºé€‰é¡¹ã€‚å®ƒæ˜¯ Python ä¸­çš„ä¸€ä¸ªæ–°çš„æ ‡å‡†æ–‡ä»¶ï¼Œç”¨äºæ›¿ä»£ <code>setup.py</code> è„šæœ¬å’Œ <code>setup.cfg</code> æ–‡ä»¶æ¥å®šä¹‰å’Œæ„å»º Python é¡¹ç›®ã€‚ä»¥ä¸‹æ˜¯ <code>pyproject.toml</code> çš„ä¸»è¦å‘å±•å†å²ï¼š</p>
<ul>
<li>PEP 517ï¼šè¯¥ PEP æå‡ºäº†ä¸€ä¸ªæ–°çš„æ„å»ºç³»ç»Ÿæ¥å£ï¼Œç”¨äºæ›¿ä»£ <code>setup.py</code> å’Œ <code>setup.cfg</code>ï¼Œå¹¶å¼•å…¥äº† <code>pyproject.toml</code> æ–‡ä»¶ä½œä¸ºå®šä¹‰ Python é¡¹ç›®çš„å…ƒæ•°æ®å’Œæ„å»ºé€‰é¡¹çš„æ ‡å‡†æ–‡ä»¶æ ¼å¼ã€‚</li>
<li>PEP 518ï¼šè¯¥ PEP æå‡ºäº†ä¸€ç§æ–°çš„æ–¹å¼æ¥å®šä¹‰é¡¹ç›®çš„ä¾èµ–å…³ç³»ï¼Œå¹¶å¼•å…¥äº† <code>pyproject.toml</code> æ–‡ä»¶ä½œä¸ºæ ‡å‡†çš„é¡¹ç›®å…ƒæ•°æ®æ–‡ä»¶æ ¼å¼ã€‚</li>
</ul>
<p>éšç€ PEP 517 å’Œ PEP 518 çš„å‘å¸ƒï¼Œ<code>pyproject.toml</code> æ–‡ä»¶é€æ¸æˆä¸º Python é¡¹ç›®çš„æ ‡å‡†å…ƒæ•°æ®æ–‡ä»¶æ ¼å¼ã€‚å®ƒæä¾›äº†æ¯” <code>setup.py</code> è„šæœ¬å’Œ <code>setup.cfg</code> æ–‡ä»¶æ›´çµæ´»ã€æ›´æ˜“äºé…ç½®å’Œæ‰©å±•çš„æ–¹å¼ï¼ŒåŒæ—¶ä¹Ÿæ›´å®¹æ˜“ä¸æ„å»ºå·¥å…·å’Œä¾èµ–ç®¡ç†å™¨é›†æˆã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>pyproject.toml</code> æ–‡ä»¶åªåœ¨ä½¿ç”¨ PEP 517 å’Œ PEP 518 è§„èŒƒçš„æ„å»ºå·¥å…·ä¸­æ‰ä¼šè¢«è¯†åˆ«å’Œä½¿ç”¨ã€‚</p>
<p>æ€»ä¹‹ï¼Œ<code>pyproject.toml</code> æ–‡ä»¶æ˜¯ Python é¡¹ç›®çš„æ ‡å‡†å…ƒæ•°æ®å’Œæ„å»ºé€‰é¡¹çš„é…ç½®æ–‡ä»¶ï¼Œå®ƒæä¾›äº†æ¯” <code>setup.py</code> è„šæœ¬å’Œ <code>setup.cfg</code> æ–‡ä»¶æ›´çµæ´»ã€æ›´æ˜“äºé…ç½®å’Œæ‰©å±•çš„æ–¹å¼ï¼Œæˆä¸ºäº† Python é¡¹ç›®çš„æ ‡å‡†å…ƒæ•°æ®æ–‡ä»¶æ ¼å¼ã€‚</p>
<h3 id="pip-å‘å±•å†å²">Pip å‘å±•å†å²</h3>
<p>åœ¨ Python ä¸­ï¼Œpip å’Œ setuptools æ˜¯ä¸¤ä¸ªå¸¸ç”¨çš„åŒ…ç®¡ç†å·¥å…·ï¼Œå®ƒä»¬åœ¨å®‰è£…å’Œç®¡ç† Python åŒ…æ–¹é¢å‘æŒ¥ç€é‡è¦ä½œç”¨ã€‚</p>
<p>pip æ˜¯ç”± Ian Bicking å’Œå…¶ä»– Python ç¤¾åŒºæˆå‘˜å¼€å‘çš„ï¼Œå®ƒæ˜¯ Python çš„åŒ…ç®¡ç†å™¨ä¹‹ä¸€ï¼Œç”¨äºåœ¨ Python ç¨‹åºä¸­å®‰è£…å’Œç®¡ç†è½¯ä»¶åŒ…ã€‚</p>
<p>Ian Bicking æ˜¯ä¸€ä½ Python ç¨‹åºå‘˜å’Œå¼€æºè½¯ä»¶è´¡çŒ®è€…ï¼Œä»–è¿˜æ˜¯ Pylons å’Œ Paste ç­‰æ¡†æ¶çš„åˆ›å§‹äººä¹‹ä¸€ã€‚åœ¨ 2008 å¹´ï¼Œä»–å¼€å§‹å¼€å‘ pipï¼Œè¿™ä¸ªé¡¹ç›®çš„ç›®æ ‡æ˜¯ä¸º Python ç¤¾åŒºæä¾›ä¸€ä¸ªæ›´å¥½ã€æ›´æ˜“ç”¨çš„åŒ…ç®¡ç†å™¨ï¼Œä»¥æ›¿ä»£åŸæœ‰çš„ easy_install å·¥å…·ã€‚</p>
<p>pip ä»ä¸€å¼€å§‹å°±å—åˆ°äº† Python ç¤¾åŒºçš„æ¬¢è¿å’Œæ”¯æŒï¼Œå®ƒçš„ä»£ç æ‰˜ç®¡åœ¨ GitHub ä¸Šï¼Œå¹¶é€æ¸å‘å±•æˆä¸º Python ç”Ÿæ€ç³»ç»Ÿä¸­ä½¿ç”¨æœ€å¹¿æ³›çš„åŒ…ç®¡ç†å™¨ä¹‹ä¸€ã€‚pip æ”¯æŒä» PyPIï¼ˆPython Package Indexï¼‰ç­‰æºä¸­ä¸‹è½½å’Œå®‰è£… Python åŒ…ï¼Œå¹¶è‡ªåŠ¨å¤„ç†åŒ…ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œä½¿å¾— Python åŒ…çš„ç®¡ç†å˜å¾—æ›´åŠ ç®€å•å’Œé«˜æ•ˆã€‚</p>
<p>ç›®å‰ï¼Œpip å·²ç»æˆä¸ºäº† Python å®˜æ–¹æ¨èçš„åŒ…ç®¡ç†å™¨ï¼Œå¹¶ä¸”å·²ç»é›†æˆåˆ° Python 2.7.9 å’Œ Python 3.4 ä»¥åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€é¢å¤–å®‰è£…ã€‚</p>
<p>pip ä¸ setuptools æœ‰å¯†åˆ‡çš„å…³ç³»ï¼Œå› ä¸ºå®ƒä½¿ç”¨ setuptools æ¥æ„å»ºå’Œå®‰è£… Python åŒ…ã€‚</p>
<p>setuptools æ˜¯ä¸€ä¸ª Python åŒ…çš„æ„å»ºå’Œåˆ†å‘å·¥å…·ï¼Œå®ƒæä¾›äº†ä¸€ç»„ API æ¥å®šä¹‰ã€æ„å»ºå’Œæ‰“åŒ… Python åŒ…ã€‚setuptools å¯ä»¥è‡ªåŠ¨ç”Ÿæˆ setup.py æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æè¿°äº† Python åŒ…çš„å…ƒæ•°æ®å’Œä¾èµ–å…³ç³»ï¼Œä»¥ä¾¿ pip å’Œå…¶ä»–å·¥å…·å¯ä»¥ä½¿ç”¨å®ƒæ¥å®‰è£…å’Œç®¡ç†åŒ…ã€‚</p>
<p>åœ¨å®‰è£…å’Œç®¡ç† Python åŒ…æ—¶ï¼Œpip ä¼šä½¿ç”¨ setuptools æ¥è§£å†³ä¾èµ–å…³ç³»ã€æ„å»ºå’Œå®‰è£…åŒ…ã€‚pip ä¼šåœ¨ä¸‹è½½åŒ…ä¹‹å‰æ£€æŸ¥åŒ…çš„ä¾èµ–å…³ç³»ï¼Œå¹¶ä½¿ç”¨ setuptools æ¥å®‰è£…è¿™äº›ä¾èµ–é¡¹ã€‚å¦‚æœåŒ…éœ€è¦è¿›è¡Œæ„å»ºï¼Œpip ä¹Ÿä¼šä½¿ç”¨ setuptools æ¥æ„å»ºå®ƒä»¬</p>
<p>ä»¥ä¸‹æ˜¯ pip çš„å‘å±•å†å²æ¦‚è¿°ï¼š</p>
<ul>
<li>2008 å¹´ï¼špip é¦–æ¬¡å‘å¸ƒï¼Œå®ƒæ˜¯ easy_install çš„ä¸€ä¸ªæ›¿ä»£å“ï¼Œæä¾›äº†æ›´å¥½çš„ä¾èµ–é¡¹è§£æã€å‡çº§å’Œå¸è½½åŠŸèƒ½ï¼Œä»¥åŠæ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚</li>
<li>2011 å¹´ï¼špip æ­£å¼æˆä¸º Python åŒ…ç®¡ç†çš„æ ‡å‡†å·¥å…·ä¹‹ä¸€ï¼Œå¹¶è¢«çº³å…¥åˆ° Python 2.7 å’Œ Python 3.2 ä¸­ã€‚</li>
<li>2013 å¹´ï¼špip 1.4 å‘å¸ƒï¼Œå®ƒå¼•å…¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œå¦‚å¯¹ wheel æ ¼å¼çš„æ”¯æŒã€å¯¹å®‰è£…æºçš„ä¼˜åŒ–ç­‰ã€‚</li>
<li>2016 å¹´ï¼špip 8.0 å‘å¸ƒï¼Œå®ƒå¼•å…¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œå¦‚å¯¹ hash æ ¡éªŒçš„æ”¯æŒã€å¯¹æºç´¢å¼•çš„ä¼˜åŒ–ç­‰ã€‚</li>
<li>2018 å¹´ï¼špip 18.0 å‘å¸ƒï¼Œå®ƒå¼•å…¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œå¦‚å¯¹ Python 3.7 çš„æ”¯æŒã€å¯¹æºç´¢å¼•çš„æ”¹è¿›ç­‰ã€‚</li>
<li>2020 å¹´ï¼špip 20.0 å‘å¸ƒï¼Œå®ƒå¼•å…¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œå¦‚å¯¹ Python 3.8 çš„æ”¯æŒã€å¯¹æºç´¢å¼•çš„ä¼˜åŒ–ç­‰ã€‚</li>
</ul>
<h3 id="wheel-å‘å±•å†å²">Wheel å‘å±•å†å²</h3>
<p>Wheel æ˜¯ Python åŒ…åˆ†å‘çš„ä¸€ç§æ ¼å¼ï¼Œå®ƒçš„å‘å±•å†å²å¯ä»¥è¿½æº¯åˆ° 2012 å¹´ï¼Œä»¥ä¸‹æ˜¯ Wheel çš„å‘å±•å†å²æ¦‚è¿°ï¼š</p>
<ul>
<li>
<p>2012 å¹´ï¼šWheel é¦–æ¬¡æå‡ºï¼Œå®ƒçš„ç›®æ ‡æ˜¯æä¾›ä¸€ç§æ›´å¿«ã€æ›´å¯é ã€æ›´ç®€å•çš„ Python åŒ…åˆ†å‘æ ¼å¼ï¼Œä»¥å–ä»£æ—§çš„ egg æ ¼å¼ã€‚</p>
</li>
<li>
<p>2013 å¹´ï¼šWheel 1.0 å‘å¸ƒï¼Œå®ƒå¼•å…¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œå¦‚å¯¹ namespace packages çš„æ”¯æŒã€å¯¹å¤šå¹³å°æ”¯æŒçš„æ”¹è¿›ç­‰ã€‚</p>
</li>
<li>
<p>2014 å¹´ï¼šWheel 0.24 å‘å¸ƒï¼Œå®ƒå¼•å…¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œå¦‚å¯¹ Python 3.4 çš„æ”¯æŒã€å¯¹æºç åˆ†å‘çš„æ”¹è¿›ç­‰ã€‚</p>
</li>
<li>
<p>2016 å¹´ï¼šWheel 0.29 å‘å¸ƒï¼Œå®ƒå¼•å…¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œå¦‚å¯¹ Python 3.6 çš„æ”¯æŒã€å¯¹æºç åˆ†å‘çš„æ”¹è¿›ç­‰ã€‚</p>
</li>
<li>
<p>2018 å¹´ï¼šWheel 0.31 å‘å¸ƒï¼Œå®ƒå¼•å…¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œå¦‚å¯¹ Python 3.7 çš„æ”¯æŒã€å¯¹æºç åˆ†å‘çš„æ”¹è¿›ç­‰ã€‚</p>
</li>
<li>
<p>2020 å¹´ï¼šWheel 0.35 å‘å¸ƒï¼Œå®ƒå¼•å…¥äº†ä¸€äº›æ–°çš„åŠŸèƒ½å’Œæ”¹è¿›ï¼Œå¦‚å¯¹ Python 3.9 çš„æ”¯æŒã€å¯¹æºç åˆ†å‘çš„æ”¹è¿›ç­‰ã€‚</p>
</li>
</ul>
<p>Egg æ˜¯ Python åŒ…åˆ†å‘æ ¼å¼ä¹‹ä¸€ï¼Œå®ƒçš„å…¨ç§°æ˜¯ Easy Install Packageï¼Œæ˜¯ç”± setuptools æä¾›çš„ä¸€ç§æ‰“åŒ…å’Œå®‰è£… Python åŒ…çš„æ ¼å¼ã€‚Egg æ ¼å¼æ—©æœŸæ˜¯ä½œä¸º Python åŒ…ç®¡ç†å·¥å…· easy_install çš„é»˜è®¤æ ¼å¼è€Œå‡ºç°çš„ï¼Œä½†ç°åœ¨å·²é€æ¸è¢« Wheel æ ¼å¼å–ä»£ã€‚</p>
<p>Egg æ ¼å¼çš„æ–‡ä»¶æ‰©å±•åä¸º .eggï¼Œå®ƒæ˜¯ä¸€ä¸ªå‹ç¼©æ–‡ä»¶ï¼Œå¯ä»¥åŒ…å« Python æ¨¡å—ã€èµ„æºæ–‡ä»¶ã€æ–‡æ¡£ç­‰ã€‚ä¸å…¶ä»– Python åŒ…åˆ†å‘æ ¼å¼ç›¸æ¯”ï¼ŒEgg æ ¼å¼å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li>Egg æ ¼å¼çš„æ–‡ä»¶å¯ä»¥è¢« easy_install ç›´æ¥å®‰è£…ï¼Œæ— éœ€è§£åŒ…ã€‚</li>
<li>Egg æ ¼å¼æ”¯æŒ Python 2.x å’Œ Python 3.x çš„è·¨ç‰ˆæœ¬å®‰è£…ã€‚</li>
<li>Egg æ ¼å¼æ”¯æŒå¤šç‰ˆæœ¬å®‰è£…ï¼Œå¯ä»¥åœ¨åŒä¸€å°æœºå™¨ä¸ŠåŒæ—¶å®‰è£…å¤šä¸ªç‰ˆæœ¬çš„åŒä¸€ Python åŒ…ã€‚</li>
</ul>
<p>è™½ç„¶ Egg æ ¼å¼æ›¾ç»æ˜¯ Python åŒ…åˆ†å‘ç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä½†æ˜¯éšç€ setuptools çš„å‘å±•å’Œ Wheel æ ¼å¼çš„å‡ºç°ï¼ŒEgg æ ¼å¼å·²ç»é€æ¸è¢«å–ä»£ã€‚ç°åœ¨å¤§éƒ¨åˆ† Python åŒ…éƒ½å·²ç»ä½¿ç”¨ Wheel æ ¼å¼è¿›è¡Œåˆ†å‘ï¼Œå› ä¸ºå®ƒæ¯” Egg æ ¼å¼æ›´å¿«ã€æ›´å¯é ã€æ›´çµæ´»ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ”¯æŒæ›´å¤šçš„ Python ç‰ˆæœ¬å’Œå¹³å°ã€‚</p>
<p>Wheel æ˜¯ Python åŒ…åˆ†å‘æ ¼å¼ä¹‹ä¸€ï¼Œå®ƒçš„å…¨ç§°æ˜¯ Python Wheel Packageï¼Œæ˜¯ç”± Python ç¤¾åŒºæä¾›çš„ä¸€ç§æ‰“åŒ…å’Œå®‰è£… Python åŒ…çš„æ ¼å¼ã€‚ä¸å…¶ä»– Python åŒ…åˆ†å‘æ ¼å¼ç›¸æ¯”ï¼ŒWheel æ ¼å¼å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li>Wheel æ ¼å¼çš„æ–‡ä»¶æ‰©å±•åä¸º .whlï¼Œå®ƒæ˜¯ä¸€ä¸ªå‹ç¼©æ–‡ä»¶ï¼Œå¯ä»¥åŒ…å« Python æ¨¡å—ã€èµ„æºæ–‡ä»¶ã€æ–‡æ¡£ç­‰ã€‚</li>
<li>Wheel æ ¼å¼æ”¯æŒ Python 2.x å’Œ Python 3.x çš„è·¨ç‰ˆæœ¬å®‰è£…ã€‚</li>
<li>Wheel æ ¼å¼å¯ä»¥åŒ…å« C æ‰©å±•æ¨¡å—ï¼Œå› æ­¤å¯ä»¥åœ¨å®‰è£…æ—¶ç›´æ¥ç¼–è¯‘å’Œå®‰è£… C æ‰©å±•æ¨¡å—ï¼Œè€Œä¸éœ€è¦ä½¿ç”¨å…¶ä»–å·¥å…·ã€‚</li>
<li>Wheel æ ¼å¼æ”¯æŒå¤šå¹³å°å®‰è£…ï¼Œå³å¯ä»¥åœ¨ Windowsã€Linuxã€macOS ç­‰ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šå®‰è£…åŒä¸€ä¸ª Wheel åŒ…ã€‚</li>
<li>Wheel æ ¼å¼çš„å®‰è£…é€Ÿåº¦æ¯” Egg æ ¼å¼å¿«ï¼Œå› ä¸ºå®ƒä½¿ç”¨äº†æ›´ç®€å•ã€æ›´å¿«é€Ÿçš„ç®—æ³•ã€‚</li>
<li>Wheel æ ¼å¼å¯ä»¥é€šè¿‡ pip å·¥å…·ç›´æ¥å®‰è£…ï¼Œæ— éœ€ä½¿ç”¨å…¶ä»– Python åŒ…ç®¡ç†å·¥å…·ã€‚</li>
</ul>
<h2 id="twine-å‘å±•å†å²">Twine å‘å±•å†å²</h2>
<p>Twine æ˜¯ Python ç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¸€ä¸ªåŒ…ç®¡ç†å·¥å…·ï¼Œå®ƒä¸»è¦ç”¨äºå°†æ‰“åŒ…å¥½çš„ Python åŒ…ä¸Šä¼ åˆ° PyPIï¼ˆPython Package Indexï¼‰ç­‰åŒ…ä»“åº“ä¸­ã€‚ä»¥ä¸‹æ˜¯ Twine çš„å‘å±•å†å²æ¦‚è¿°ï¼š</p>
<ul>
<li>2015 å¹´ï¼šTwine å·¥å…·å‘å¸ƒï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨äºä¸Šä¼  Python åŒ…åˆ° PyPI çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæ”¯æŒ GPG ç­¾åå’Œ HTTPS ä¼ è¾“ã€‚</li>
<li>2016 å¹´ï¼šTwine 1.4 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Wheel åŒ…æ ¼å¼çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒå¤šä¸ª PyPI ä»“åº“ã€æ”¯æŒæ£€æŸ¥åŒ…é‡å¤ä¸Šä¼ ç­‰ã€‚</li>
<li>2017 å¹´ï¼šTwine 1.8 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ PEP 517 å’Œ PEP 518 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒæºç å®‰è£…ã€æ”¯æŒä¸Šä¼ å¤šä¸ªåŒ…æ–‡ä»¶ç­‰ã€‚</li>
<li>2018 å¹´ï¼šTwine 1.12 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.7 å’Œ PyPI çš„æ–°ç‰¹æ€§çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ç¯å¢ƒå˜é‡é…ç½® PyPI ä»“åº“ã€æ”¯æŒä½¿ç”¨ .pypirc æ–‡ä»¶é…ç½®è®¤è¯ä¿¡æ¯ç­‰ã€‚</li>
<li>2020 å¹´ï¼šTwine 3.2 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒç§»é™¤äº† Python 2 çš„æ”¯æŒï¼Œå¢åŠ äº†å¯¹ Python 3.9 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ twine check å‘½ä»¤æ£€æŸ¥åŒ…æ˜¯å¦ç¬¦åˆ PyPI æ ‡å‡†ã€æ”¯æŒä½¿ç”¨ twine register å‘½ä»¤åœ¨ PyPI ä¸­æ³¨å†Œé¡¹ç›®ç­‰ã€‚</li>
</ul>
<h2 id="virtualenv-å‘å±•å†å²">virtualenv å‘å±•å†å²</h2>
<p>Virtualenv æ˜¯ Python ç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦å·¥å…·ï¼Œå®ƒæä¾›äº†ä¸€ç§åœ¨å•ä¸ªç³»ç»Ÿä¸­è¿è¡Œå¤šä¸ªç‹¬ç«‹ Python ç¯å¢ƒçš„æ–¹å¼ã€‚</p>
<p>Virtualenv æ˜¯ç”± Ian Bicking å¼€å‘çš„ï¼Œå®ƒæ˜¯ä¸€ä¸ª Python è™šæ‹Ÿç¯å¢ƒç®¡ç†å·¥å…·ã€‚Ian Bicking æ˜¯ä¸€ä½ Python ç¨‹åºå‘˜å’Œå¼€æºè½¯ä»¶è´¡çŒ®è€…ï¼Œä»–è¿˜æ˜¯ Pylons å’Œ Paste ç­‰æ¡†æ¶çš„åˆ›å§‹äººä¹‹ä¸€ã€‚</p>
<p>Virtualenv çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬äº 2007 å¹´å‘å¸ƒï¼Œå®ƒçš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è§£å†³ Python åŒ…ä¾èµ–æ€§çš„é—®é¢˜ã€‚åœ¨ Python ä¸­ï¼Œä¸åŒçš„é¡¹ç›®å¯èƒ½éœ€è¦ä¸åŒçš„ Python ç‰ˆæœ¬å’Œä¾èµ–åŒ…ï¼Œè€Œè¿™äº›ä¾èµ–åŒ…å¯èƒ½ä¼šç›¸äº’å†²çªã€‚Virtualenv å¯ä»¥åˆ›å»ºä¸€ä¸ªéš”ç¦»çš„ Python ç¯å¢ƒï¼Œä½¿å¾—æ¯ä¸ªé¡¹ç›®éƒ½å¯ä»¥ç‹¬ç«‹åœ°å®‰è£…å’Œä½¿ç”¨å…¶æ‰€éœ€çš„ Python ç‰ˆæœ¬å’Œä¾èµ–åŒ…ï¼Œä»è€Œé¿å…äº†å†²çªé—®é¢˜ã€‚</p>
<p>åœ¨ Virtualenv å‘å¸ƒä¹‹åï¼Œå®ƒå¾ˆå¿«æˆä¸ºäº† Python å¼€å‘ç¤¾åŒºä¸­çš„ä¸€ä¸ªé‡è¦å·¥å…·ï¼Œå—åˆ°äº†å¹¿æ³›çš„å…³æ³¨å’Œä½¿ç”¨ã€‚Virtualenv åæ¥ä¹Ÿè¢«é›†æˆåˆ°äº† Python å®˜æ–¹çš„æ–‡æ¡£ä¸­ï¼Œå¹¶ä¸”æœ‰è®¸å¤šå…¶ä»–çš„è™šæ‹Ÿç¯å¢ƒç®¡ç†å·¥å…·ï¼Œå¦‚ Pyenv å’Œ Condaï¼Œä¹Ÿæ˜¯åŸºäº Virtualenv çš„æ€æƒ³å’Œå®ç°æ–¹å¼å¼€å‘çš„ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ Virtualenv çš„å‘å±•å†å²æ¦‚è¿°ï¼š</p>
<ul>
<li>2007 å¹´ï¼šVirtualenv å·¥å…·å‘å¸ƒï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨äºåˆ›å»ºç‹¬ç«‹ Python ç¯å¢ƒçš„å·¥å…·ï¼Œå¯ä»¥é¿å…ä¸åŒé¡¹ç›®ä¹‹é—´çš„ä¾èµ–å†²çªã€‚</li>
<li>2009 å¹´ï¼šVirtualenvwrapper å·¥å…·å‘å¸ƒï¼Œå®ƒæ˜¯ Virtualenv çš„ä¸€ä¸ªæ‰©å±•ï¼Œæä¾›äº†æ›´å¥½çš„è™šæ‹Ÿç¯å¢ƒç®¡ç†æ–¹å¼ï¼Œå¦‚åˆ›å»ºã€åˆ‡æ¢ã€åˆ é™¤è™šæ‹Ÿç¯å¢ƒç­‰ã€‚</li>
<li>2010 å¹´ï¼šVirtualenv 1.5 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ requirements.txt æ–‡ä»¶å®‰è£…ä¾èµ–ã€æ”¯æŒä½¿ç”¨ pip å®‰è£…åŒ…ç­‰ã€‚</li>
<li>2011 å¹´ï¼šVirtualenv 1.6 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.2 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ -p é€‰é¡¹æŒ‡å®š Python è§£é‡Šå™¨ã€æ”¯æŒä½¿ç”¨ &ndash;system-site-packages é€‰é¡¹å…±äº«ç³»ç»Ÿ Python åŒ…ç­‰ã€‚</li>
<li>2013 å¹´ï¼šVirtualenv 1.10 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.3 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ &ndash;always-copy é€‰é¡¹å¤åˆ¶ä¾èµ–åŒ…ã€æ”¯æŒä½¿ç”¨ &ndash;clear é€‰é¡¹æ¸…ç©ºè™šæ‹Ÿç¯å¢ƒç­‰ã€‚</li>
<li>2017 å¹´ï¼šVirtualenv 16.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.6 å’Œ pip 10 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ &ndash;upgrade é€‰é¡¹æ›´æ–°åŒ…ã€æ”¯æŒä½¿ç”¨ &ndash;prompt é€‰é¡¹è®¾ç½®è™šæ‹Ÿç¯å¢ƒæç¤ºç¬¦ç­‰ã€‚</li>
<li>2018 å¹´ï¼šVirtualenv 16.1 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.7 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ &ndash;creator é€‰é¡¹æŒ‡å®šåˆ›å»ºè™šæ‹Ÿç¯å¢ƒçš„æ–¹å¼ã€æ”¯æŒä½¿ç”¨ &ndash;verbose é€‰é¡¹æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ç­‰ã€‚</li>
<li>2019 å¹´ï¼šVirtualenv 16.7.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.8 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ &ndash;system-site-packages é€‰é¡¹å…±äº«ç³»ç»Ÿ Python åŒ…ã€æ”¯æŒä½¿ç”¨ &ndash;copies é€‰é¡¹å¤åˆ¶ä¾èµ–åŒ…ç­‰ã€‚</li>
<li>2020 å¹´ï¼šVirtualenv 20.0.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.9 å’Œ pip 20 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ &ndash;prompt-cmd é€‰é¡¹è®¾ç½®è™šæ‹Ÿç¯å¢ƒæç¤ºç¬¦ã€æ”¯æŒä½¿ç”¨ &ndash;no-pip é€‰é¡¹åˆ›å»ºä¸åŒ…å« pip çš„è™šæ‹Ÿç¯å¢ƒç­‰ã€‚</li>
<li>2021 å¹´ï¼šVirtualenv 20.8.1 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.10 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ &ndash;download é€‰é¡¹ä»æŒ‡å®š URL ä¸‹è½½ Python è§£é‡Šå™¨ã€æ”¯æŒä½¿ç”¨ &ndash;clear é€‰é¡¹æ¸…ç©ºè™šæ‹Ÿç¯å¢ƒç­‰ã€‚</li>
</ul>
<p>æ€»çš„æ¥è¯´ï¼ŒVirtualenv æ˜¯ Python ç”Ÿæ€ç³»ç»Ÿä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„å·¥å…·ï¼Œå®ƒæä¾›äº†ä¸€ç§æ–¹ä¾¿ã€å¿«æ·çš„è™šæ‹Ÿç¯å¢ƒç®¡ç†æ–¹å¼ï¼Œä¸º Python å¼€å‘è€…æä¾›äº†å¾ˆå¤šä¾¿åˆ©ã€‚åœ¨å…¶å‘å±•å†å²ä¸­ï¼ŒVirtualenv ä¸æ–­æ›´æ–°è¿­ä»£ï¼Œå¢åŠ äº†è®¸å¤šæ–°ç‰¹æ€§å’ŒåŠŸèƒ½ï¼Œä»¥é€‚åº” Python ç”Ÿæ€ç³»ç»Ÿçš„å˜åŒ–å’Œéœ€æ±‚ã€‚è™½ç„¶ç°åœ¨ Virtualenv å·²ç»ä¸å†ä¸»åŠ¨ç»´æŠ¤ï¼Œä½†å®ƒçš„ä»£ç è¢«é›†æˆåˆ°å…¶ä»–å·¥å…·ä¸­ï¼Œå¦‚ venv å’Œ pipenvï¼Œä»ç„¶ä¸º Python å¼€å‘è€…æä¾›åŸºç¡€æ”¯æŒã€‚</p>
<h2 id="venv-å‘å±•å†å²">venv å‘å±•å†å²</h2>
<p>venv æ˜¯ç”± Python å®˜æ–¹å¼€å‘å›¢é˜Ÿå¼€å‘çš„ï¼Œå®ƒæ˜¯ Python 3.3 ç‰ˆæœ¬å¼•å…¥çš„æ ‡å‡†åº“æ¨¡å—ï¼Œç”¨äºåˆ›å»º Python è™šæ‹Ÿç¯å¢ƒã€‚</p>
<p>Python çš„å®˜æ–¹æ–‡æ¡£ä¸­å¯¹ venv çš„ä»‹ç»å¦‚ä¸‹ï¼š</p>
<p>&ldquo;venv æ¨¡å—æä¾›äº† Python 3 ä¸­çš„è™šæ‹Ÿç¯å¢ƒæ”¯æŒã€‚è™šæ‹Ÿç¯å¢ƒæ˜¯ Python ç¯å¢ƒçš„éš”ç¦»å‰¯æœ¬ï¼ŒåŒ…æ‹¬ Python è§£é‡Šå™¨å’Œä¸€ä¸ªç‹¬ç«‹çš„åº“å‰¯æœ¬ã€‚è™šæ‹Ÿç¯å¢ƒé€šå¸¸ç”¨äºä¸ºä¸åŒçš„é¡¹ç›®åˆ›å»ºç‹¬ç«‹çš„ç¯å¢ƒï¼Œä»¥é¿å…é¡¹ç›®ä¹‹é—´çš„ä¾èµ–å†²çªã€‚&rdquo;</p>
<p>ä¸ Virtualenv å’Œå…¶ä»–è™šæ‹Ÿç¯å¢ƒç®¡ç†å·¥å…·ä¸åŒï¼Œvenv æ˜¯ Python å®˜æ–¹æä¾›çš„æ ‡å‡†åº“æ¨¡å—ï¼Œå› æ­¤å®ƒçš„åŠŸèƒ½å’Œç”¨æ³•éƒ½ä¸ Python è§£é‡Šå™¨å¯†åˆ‡ç›¸å…³ï¼Œå¹¶ä¸”åœ¨ Python å®‰è£…æ—¶å·²ç»é¢„è£…äº† venv æ¨¡å—ï¼Œå› æ­¤ä¸éœ€è¦é¢å¤–å®‰è£…ã€‚</p>
<p>åœ¨ä½¿ç”¨ venv åˆ›å»ºè™šæ‹Ÿç¯å¢ƒæ—¶ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨ç³»ç»Ÿä¸­å·²ç»å®‰è£…çš„ Python è§£é‡Šå™¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ venv æ¨¡å—è‡ªåŠ¨å®‰è£…ä¸€ä¸ªæ–°çš„ Python è§£é‡Šå™¨ã€‚åˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒå’Œå®ƒæ‰€ä¾èµ–çš„ Python åŒ…éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¼šä¸ç³»ç»Ÿä¸­çš„ Python ç¯å¢ƒå’Œå…¶ä»–è™šæ‹Ÿç¯å¢ƒäº§ç”Ÿå†²çªã€‚</p>
<p>ä»¥ä¸‹æ˜¯ venv çš„å‘å±•å†å²æ¦‚è¿°ï¼š</p>
<ul>
<li>
<p>2012 å¹´ï¼šPython 3.3 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¼•å…¥äº† venv æ ‡å‡†åº“ï¼Œç”¨äºåˆ›å»ºç‹¬ç«‹çš„ Python ç¯å¢ƒï¼Œå–ä»£äº† Python 2 ä¸­çš„ virtualenv å·¥å…·ã€‚</p>
</li>
<li>
<p>2013 å¹´ï¼švenv 1.1 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.4 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ &ndash;system-site-packages é€‰é¡¹å…±äº«ç³»ç»Ÿ Python åŒ…ã€æ”¯æŒä½¿ç”¨ &ndash;copies é€‰é¡¹å¤åˆ¶ä¾èµ–åŒ…ç­‰ã€‚</p>
</li>
<li>
<p>2014 å¹´ï¼švenv 1.2 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.5 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ &ndash;clear é€‰é¡¹æ¸…ç©ºè™šæ‹Ÿç¯å¢ƒã€æ”¯æŒä½¿ç”¨ &ndash;upgrade é€‰é¡¹æ›´æ–°åŒ…ç­‰ã€‚</p>
</li>
<li>
<p>2015 å¹´ï¼švenv 1.3 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.6 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ &ndash;prompt é€‰é¡¹è®¾ç½®è™šæ‹Ÿç¯å¢ƒæç¤ºç¬¦ã€æ”¯æŒä½¿ç”¨ &ndash;without-pip é€‰é¡¹åˆ›å»ºä¸åŒ…å« pip çš„è™šæ‹Ÿç¯å¢ƒç­‰ã€‚</p>
</li>
<li>
<p>2017 å¹´ï¼švenv 3.6.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.6 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ activate.csh å’Œ activate.fish è„šæœ¬ã€æ”¯æŒä½¿ç”¨ bin/python3 å‘½ä»¤å¯åŠ¨ Python è§£é‡Šå™¨ç­‰ã€‚</p>
</li>
<li>
<p>2018 å¹´ï¼švenv 3.7.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.7 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ venv æ¨¡å—åˆ›å»ºè™šæ‹Ÿç¯å¢ƒã€æ”¯æŒä½¿ç”¨ ensurepip æ¨¡å—å®‰è£… pip ç­‰ã€‚</p>
</li>
<li>
<p>2019 å¹´ï¼švenv 3.8.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.8 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ &ndash;symlinks é€‰é¡¹åˆ›å»ºç¬¦å·é“¾æ¥è€Œéå¤åˆ¶æ–‡ä»¶ã€æ”¯æŒä½¿ç”¨ &ndash;upgrade-deps é€‰é¡¹æ›´æ–°ä¾èµ–åŒ…ç­‰ã€‚</p>
</li>
<li>
<p>2020 å¹´ï¼švenv 3.9.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.9 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ &ndash;list é€‰é¡¹åˆ—å‡ºè™šæ‹Ÿç¯å¢ƒä¸­å·²å®‰è£…çš„åŒ…ã€æ”¯æŒä½¿ç”¨ &ndash;upgrade é€‰é¡¹æ›´æ–° pip ç­‰ã€‚</p>
</li>
<li>
<p>2021 å¹´ï¼švenv 3.10.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.10 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ &ndash;symlink-to é€‰é¡¹æŒ‡å®šç¬¦å·é“¾æ¥ç›®å½•ã€æ”¯æŒä½¿ç”¨ &ndash;prompt-cmd é€‰é¡¹è®¾ç½®è™šæ‹Ÿç¯å¢ƒæç¤ºç¬¦ç­‰ã€‚</p>
</li>
</ul>
<h2 id="pyenvå‘å±•å†å²">Pyenvå‘å±•å†å²</h2>
<p>Pyenv æ˜¯ä¸€ä¸ª Python ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Œå¯ä»¥ç”¨äºåœ¨åŒä¸€ç³»ç»Ÿä¸­ç®¡ç†å¤šä¸ª Python ç‰ˆæœ¬ã€‚ä»¥ä¸‹æ˜¯ Pyenv çš„å‘å±•å†å²æ¦‚è¿°ï¼š</p>
<ul>
<li>2011 å¹´ï¼šPyenv 0.1.0 ç‰ˆæœ¬å‘å¸ƒï¼Œæœ€åˆç”± Yasuhiro Matsumoto å¼€å‘ã€‚è¿™ä¸ªç‰ˆæœ¬åªæ”¯æŒåœ¨ Bash shell ä¸­ä½¿ç”¨ã€‚</li>
<li>2012 å¹´ï¼šPyenv 0.2.0 ç‰ˆæœ¬å‘å¸ƒï¼Œæ”¯æŒåœ¨å…¶ä»– shell ä¸­ä½¿ç”¨ï¼Œå¦‚ Zsh å’Œ Fishã€‚</li>
<li>2013 å¹´ï¼šPyenv 0.4.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå¢åŠ äº†å¯¹ Python 3 çš„æ”¯æŒã€‚</li>
<li>2014 å¹´ï¼šPyenv 0.4.1 ç‰ˆæœ¬å‘å¸ƒï¼Œå¢åŠ äº†å¯¹ Jython å’Œ Stackless Python çš„æ”¯æŒã€‚</li>
<li>2015 å¹´ï¼šPyenv 1.0.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python çš„è§£é‡Šå™¨å’Œæ ‡å‡†åº“çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚å¢åŠ äº† pyenv virtualenv å‘½ä»¤æ¥ç®¡ç†è™šæ‹Ÿç¯å¢ƒã€å¢åŠ äº† pyenv whence å‘½ä»¤æ¥æŸ¥æ‰¾å¯æ‰§è¡Œæ–‡ä»¶çš„ä½ç½®ç­‰ã€‚</li>
<li>2018 å¹´ï¼šPyenv 1.2.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå¢åŠ äº†å¯¹ PyPy3 çš„æ”¯æŒï¼Œå¹¶ä¿®å¤äº†ä¸€äº› bugã€‚</li>
<li>2020 å¹´ï¼šPyenv 1.2.21 ç‰ˆæœ¬å‘å¸ƒï¼Œå¢åŠ äº†å¯¹ Python 3.9.0 çš„æ”¯æŒï¼Œå¹¶ä¿®å¤äº†ä¸€äº› bugã€‚</li>
</ul>
<p>Pyenv çš„å‘å±•å†å²æ˜¾ç¤ºå‡ºå®ƒçš„é•¿æœŸç¨³å®šæ€§å’Œä¸æ–­æ”¹è¿›çš„è¶‹åŠ¿ï¼Œä»¥é€‚åº”ä¸æ–­å˜åŒ–çš„ Python ç”Ÿæ€ç³»ç»Ÿå’Œå¼€å‘è€…éœ€æ±‚ã€‚Pyenv çš„ä¸»è¦ç‰¹ç‚¹æ˜¯å¯ä»¥åœ¨åŒä¸€ç³»ç»Ÿä¸­ç®¡ç†å¤šä¸ª Python ç‰ˆæœ¬ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°åˆ‡æ¢ç‰ˆæœ¬ï¼Œä¹Ÿæ”¯æŒä½¿ç”¨è™šæ‹Ÿç¯å¢ƒæ¥éš”ç¦»ä¸åŒé¡¹ç›®çš„ä¾èµ–ã€‚Pyenv åœ¨ Python å¼€å‘è€…ç¤¾åŒºä¸­å¹¿å—æ¬¢è¿ï¼Œæ˜¯ä¸€ä¸ªä¸å¯æˆ–ç¼ºçš„å·¥å…·ä¹‹ä¸€ã€‚</p>
<h2 id="pipenvå‘å±•å†å²">Pipenvå‘å±•å†å²</h2>
<p>Pipenv æ˜¯åœ¨ 2017 å¹´ç”± Kenneth Reitz å¼€å‘çš„ Python é¡¹ç›®ä¾èµ–ç®¡ç†å·¥å…·ã€‚ä»¥ä¸‹æ˜¯ Pipenv çš„å‘å±•å†å²æ¦‚è¿°ï¼š</p>
<ul>
<li>2017 å¹´ï¼šPipenv 1.0.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒæ˜¯ç¬¬ä¸€ä¸ªç¨³å®šç‰ˆæœ¬ã€‚Pipenv ç»“åˆäº† pip å’Œ virtualenv çš„åŠŸèƒ½ï¼Œæä¾›äº†ä¸€ä¸ªæ›´ç®€å•çš„æ–¹å¼æ¥ç®¡ç† Python é¡¹ç›®ä¾èµ–ã€‚å®ƒè‡ªåŠ¨ä¸ºæ¯ä¸ªé¡¹ç›®åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼Œå¹¶ä½¿ç”¨ Pipfile å’Œ Pipfile.lock æ–‡ä»¶æ¥ç®¡ç†é¡¹ç›®ä¾èµ–ã€‚</li>
<li>2018 å¹´ï¼šPipenv 2018.5.18 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†è®¸å¤šæ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ &ndash;skip-lock é€‰é¡¹è·³è¿‡ç”Ÿæˆ Pipfile.lock æ–‡ä»¶ã€æ”¯æŒä½¿ç”¨ &ndash;deploy é€‰é¡¹å®‰è£… Pipfile.lock æ–‡ä»¶ä¸­çš„ä¾èµ–ã€æ”¯æŒä½¿ç”¨ &ndash;update é€‰é¡¹æ›´æ–°ä¾èµ–ç­‰ã€‚</li>
<li>2019 å¹´ï¼šPipenv 2019.6.3 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.8 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ &ndash;use-feature é€‰é¡¹å®‰è£…ä¾èµ–ã€æ”¯æŒä½¿ç”¨ &ndash;outdated é€‰é¡¹æ˜¾ç¤ºè¿‡æœŸçš„ä¾èµ–ç­‰ã€‚</li>
<li>2020 å¹´ï¼šPipenv 2020.6.2 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†æ”¯æŒä½¿ç”¨ &ndash;python é€‰é¡¹æŒ‡å®š Python è§£é‡Šå™¨ç‰ˆæœ¬ã€æ”¯æŒä½¿ç”¨ &ndash;pre é€‰é¡¹å®‰è£…é¢„è§ˆç‰ˆä¾èµ–ã€æ”¯æŒä½¿ç”¨ &ndash;keep-outdated é€‰é¡¹ä¿ç•™è¿‡æœŸçš„ä¾èµ–ç­‰ã€‚</li>
<li>2021 å¹´ï¼šPipenv 2021.5.29 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.10 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ &ndash;platform é€‰é¡¹æŒ‡å®šå®‰è£…ä¾èµ–çš„å¹³å°ã€æ”¯æŒä½¿ç”¨ &ndash;bundle é€‰é¡¹ç”Ÿæˆä¾èµ–åŒ…å‹ç¼©æ–‡ä»¶ç­‰ã€‚</li>
</ul>
<h2 id="poetry-å‘å±•å†å²">Poetry å‘å±•å†å²</h2>
<p>Poetry æ˜¯ä¸€ä¸ªè¾ƒæ–°çš„ Python é¡¹ç›®ä¾èµ–ç®¡ç†å·¥å…·ï¼Œåœ¨ 2018 å¹´ç”± SÃ©bastien Eustace å¼€å‘ã€‚ä»¥ä¸‹æ˜¯ Poetry çš„å‘å±•å†å²æ¦‚è¿°ï¼š</p>
<ul>
<li>2018 å¹´ï¼šPoetry 0.1.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒæ˜¯ç¬¬ä¸€ä¸ªå…¬å¼€å‘å¸ƒçš„ç‰ˆæœ¬ã€‚Poetry é€šè¿‡ pyproject.toml æ–‡ä»¶æ¥ç®¡ç†é¡¹ç›®ä¾èµ–ï¼Œå¹¶ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒæ¥éš”ç¦»é¡¹ç›®ä¾èµ–ã€‚</li>
<li>2019 å¹´ï¼šPoetry 0.12.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.8 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ &ndash;lock é€‰é¡¹ç”Ÿæˆé”æ–‡ä»¶ã€æ”¯æŒä½¿ç”¨ &ndash;develop é€‰é¡¹å®‰è£…å¼€å‘ä¾èµ–ç­‰ã€‚</li>
<li>2020 å¹´ï¼šPoetry 1.0.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.9 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ &ndash;experimental é€‰é¡¹å¯ç”¨å®éªŒæ€§åŠŸèƒ½ã€æ”¯æŒä½¿ç”¨ &ndash;remove-untracked é€‰é¡¹åˆ é™¤æœªè·Ÿè¸ªçš„ä¾èµ–ç­‰ã€‚</li>
<li>2021 å¹´ï¼šPoetry 1.2.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.10 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ &ndash;workspace é€‰é¡¹ç®¡ç†å¤šä¸ªç›¸å…³é¡¹ç›®ã€æ”¯æŒä½¿ç”¨ &ndash;source é€‰é¡¹æŒ‡å®šä¾èµ–æºç­‰ã€‚</li>
</ul>
<p>Poetry çš„å‘å±•å†å²æ˜¾ç¤ºå‡ºå®ƒçš„å¿«é€Ÿå‘å±•å’Œä¸æ–­æ”¹è¿›çš„è¶‹åŠ¿ï¼Œä»¥é€‚åº”ä¸æ–­å˜åŒ–çš„ Python ç”Ÿæ€ç³»ç»Ÿå’Œå¼€å‘è€…éœ€æ±‚ã€‚Poetry ç›¸è¾ƒäº pipenv å’Œ virtualenv ç­‰å·¥å…·ï¼Œå®ƒæœ‰ç€æ›´åŠ ç®€æ´çš„é…ç½®æ–‡ä»¶å’Œæ›´åŠ æ˜“äºä½¿ç”¨çš„å‘½ä»¤è¡Œæ¥å£ï¼Œå› æ­¤åœ¨ Python å¼€å‘è€…ä¸­è¶Šæ¥è¶Šå—æ¬¢è¿ã€‚</p>
<h2 id="pdmå‘å±•å†å²">Pdmå‘å±•å†å²</h2>
<p>PDM æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ–°çš„ Python é¡¹ç›®ä¾èµ–ç®¡ç†å·¥å…·ï¼Œç”±æè¾‰å¼€å‘ï¼Œå®ƒäº 2020 å¹´é¦–æ¬¡å‘å¸ƒã€‚ä»¥ä¸‹æ˜¯ PDM çš„å‘å±•å†å²æ¦‚è¿°ï¼š</p>
<ul>
<li>2020 å¹´ï¼šPDM 0.1.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒæ˜¯ç¬¬ä¸€ä¸ªå…¬å¼€å‘å¸ƒçš„ç‰ˆæœ¬ã€‚PDM ä½¿ç”¨ pyproject.toml æ–‡ä»¶æ¥ç®¡ç†é¡¹ç›®ä¾èµ–ï¼Œå¹¶ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒæ¥éš”ç¦»é¡¹ç›®ä¾èµ–ã€‚ä¸å…¶ä»–ä¾èµ–ç®¡ç†å·¥å…·ä¸åŒï¼ŒPDM å¯ä»¥ä½¿ç”¨å¤šä¸ªä¾èµ–æºï¼Œä»¥ä¾¿ä»ä¸åŒçš„æºå®‰è£…ä¾èµ–ã€‚</li>
<li>2021 å¹´ï¼šPDM 1.0.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.10 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ &ndash;edit é€‰é¡¹ç¼–è¾‘ä¾èµ–æ–‡ä»¶ã€æ”¯æŒä½¿ç”¨ &ndash;update-prereleases é€‰é¡¹æ›´æ–°é¢„è§ˆç‰ˆä¾èµ–ç­‰ã€‚</li>
<li>2022 å¹´ï¼šPDM 2.0.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3.11 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ &ndash;lockfile é€‰é¡¹æŒ‡å®šé”å®šæ–‡ä»¶ã€æ”¯æŒä½¿ç”¨ &ndash;find-links é€‰é¡¹æŒ‡å®šä¾èµ–çš„æœ¬åœ°è·¯å¾„æˆ– URL ç­‰ã€‚</li>
</ul>
<p>PDM çš„å‘å±•å†å²æ˜¾ç¤ºå‡ºå®ƒçš„å¿«é€Ÿå‘å±•å’Œä¸æ–­æ”¹è¿›çš„è¶‹åŠ¿ï¼Œä»¥é€‚åº”ä¸æ–­å˜åŒ–çš„ Python ç”Ÿæ€ç³»ç»Ÿå’Œå¼€å‘è€…éœ€æ±‚ã€‚PDM å…·æœ‰ç±»ä¼¼ Poetry çš„ç®€æ´é…ç½®æ–‡ä»¶å’Œæ˜“äºä½¿ç”¨çš„å‘½ä»¤è¡Œæ¥å£ï¼Œä½† PDM çš„å¤šæºæ”¯æŒå’Œä¾èµ–å¿«ç…§åŠŸèƒ½åˆ™æ˜¯å®ƒçš„ç‹¬ç‰¹ç‰¹ç‚¹ï¼Œè¿™äº›åŠŸèƒ½ä½¿å¾— PDM åœ¨ä¸€äº›ç‰¹å®šåœºæ™¯ä¸‹æ›´åŠ é€‚ç”¨ã€‚</p>
<h2 id="pyflow-å‘å±•å†å²">Pyflow å‘å±•å†å²</h2>
<p>Pyflow æ˜¯å¦ä¸€ä¸ª Python é¡¹ç›®ä¾èµ–ç®¡ç†å·¥å…·ï¼Œäº 2016 å¹´é¦–æ¬¡å‘å¸ƒã€‚ä»¥ä¸‹æ˜¯ Pyflow çš„å‘å±•å†å²æ¦‚è¿°ï¼š</p>
<ul>
<li>2016 å¹´ï¼šPyflow 0.1.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒæ˜¯ç¬¬ä¸€ä¸ªå…¬å¼€å‘å¸ƒçš„ç‰ˆæœ¬ã€‚Pyflow ä½¿ç”¨ requirements.txt æ–‡ä»¶æ¥ç®¡ç†é¡¹ç›®ä¾èµ–ï¼Œå¹¶ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒæ¥éš”ç¦»é¡¹ç›®ä¾èµ–ã€‚ä¸å…¶ä»–ä¾èµ–ç®¡ç†å·¥å…·ä¸åŒï¼ŒPyflow æ”¯æŒè‡ªåŠ¨åŒ–çš„ä¾èµ–è§£å†³æ–¹æ¡ˆï¼Œä»¥ä¾¿æ›´è½»æ¾åœ°å®‰è£…å’Œæ›´æ–°ä¾èµ–ã€‚</li>
<li>2017 å¹´ï¼šPyflow 0.3.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†è®¸å¤šæ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ &ndash;editable é€‰é¡¹å®‰è£…å¯ç¼–è¾‘ä¾èµ–ã€æ”¯æŒä½¿ç”¨ &ndash;pre é€‰é¡¹å®‰è£…é¢„è§ˆç‰ˆä¾èµ–ç­‰ã€‚</li>
<li>2018 å¹´ï¼šPyflow 2.0.0 ç‰ˆæœ¬å‘å¸ƒï¼Œå®ƒå¢åŠ äº†å¯¹ Python 3 çš„æ”¯æŒï¼Œä»¥åŠä¸€äº›æ–°ç‰¹æ€§å’Œæ”¹è¿›ï¼Œå¦‚æ”¯æŒä½¿ç”¨ Pipfile.lock æ–‡ä»¶ç®¡ç†ä¾èµ–ã€æ”¯æŒåœ¨ Pipfile ä¸­ä½¿ç”¨å¤šä¸ªä¾èµ–æºç­‰ã€‚</li>
</ul>
<p>å°½ç®¡ Pyflow çš„å¼€å‘å·²ç»åœæ­¢ï¼Œä½†æ˜¯å®ƒçš„ä¸€äº›æ€æƒ³å’Œç‰¹æ€§è¢«å…¶ä»–ä¾èµ–ç®¡ç†å·¥å…·æ‰€é‡‡çº³ï¼Œä¾‹å¦‚ Pipenv å’Œ Poetryã€‚Pyflow åœ¨å…¶æ—¶ä»£å†…æ›¾ç»æ˜¯ä¸€ä¸ªæœ‰å½±å“åŠ›çš„ä¾èµ–ç®¡ç†å·¥å…·ï¼Œå®ƒçš„è‡ªåŠ¨åŒ–ä¾èµ–è§£å†³æ–¹æ¡ˆã€è™šæ‹Ÿç¯å¢ƒåŠŸèƒ½å’Œå¤šä¸ªä¾èµ–æºç­‰ç‰¹æ€§ä¸ºåæ¥çš„ä¾èµ–ç®¡ç†å·¥å…·æä¾›äº†å¯ç¤ºã€‚</p>
<h2 id="conda-å‘å±•å†å²">Conda å‘å±•å†å²</h2>
<p>Conda æ˜¯ä¸€ä¸ªå¼€æºçš„åŒ…ç®¡ç†ç³»ç»Ÿå’Œç¯å¢ƒç®¡ç†ç³»ç»Ÿï¼Œç”¨äºç®¡ç† Python åŒ…å’Œå…¶ä»–ç§‘å­¦è®¡ç®—ç›¸å…³çš„è½¯ä»¶åŒ…ã€‚ä»¥ä¸‹æ˜¯ Conda çš„å‘å±•å†å²ï¼š</p>
<ol>
<li>
<p>2012 å¹´ï¼ŒContinuum Analytics å…¬å¸å‘å¸ƒäº†ç¬¬ä¸€ä¸ªç‰ˆæœ¬çš„ Condaï¼Œç”¨äºç®¡ç† Python ç¯å¢ƒå’Œè½¯ä»¶åŒ…ã€‚</p>
</li>
<li>
<p>2015 å¹´ï¼ŒConda å‘å¸ƒäº† 4.0 ç‰ˆæœ¬ï¼Œå¼•å…¥äº†è™šæ‹Ÿç¯å¢ƒå’Œäº¤å‰å¹³å°æ”¯æŒï¼Œæ”¯æŒ Pythonã€R å’Œå…¶ä»–è¯­è¨€çš„åŒ…ç®¡ç†ã€‚</p>
</li>
<li>
<p>2016 å¹´ï¼ŒConda å‘å¸ƒäº† 4.2 ç‰ˆæœ¬ï¼Œå¼•å…¥äº† Conda Forgeï¼Œä¸€ä¸ªç¤¾åŒºé©±åŠ¨çš„è½¯ä»¶åŒ…ä»“åº“ï¼Œæä¾›äº†æ›´ä¸°å¯Œçš„è½¯ä»¶åŒ…å’Œæ›´å¿«çš„æ›´æ–°å‘¨æœŸã€‚</p>
</li>
<li>
<p>2018 å¹´ï¼ŒConda å‘å¸ƒäº† 4.5 ç‰ˆæœ¬ï¼Œå¼•å…¥äº†å‘½ä»¤è¡Œç•Œé¢çš„æ”¹è¿›å’Œæ–°åŠŸèƒ½ï¼Œå¦‚ç¯å¢ƒå¿«é€Ÿå¤åˆ¶å’ŒåŒ…ä¾èµ–å…³ç³»çš„å¯è§†åŒ–ã€‚</p>
</li>
<li>
<p>2019 å¹´ï¼ŒConda å‘å¸ƒäº† 4.6 ç‰ˆæœ¬ï¼Œå¼•å…¥äº†ç¯å¢ƒé”å®šå’Œè‡ªåŠ¨ç¯å¢ƒæ¿€æ´»åŠŸèƒ½ï¼Œæé«˜äº†ç¯å¢ƒç®¡ç†çš„æ•ˆç‡å’Œå¯é æ€§ã€‚</p>
</li>
<li>
<p>2020 å¹´ï¼ŒAnaconda Inc. æ”¶è´­äº† Quansight å…¬å¸ï¼Œå¹¶å°†å…¶æ——ä¸‹çš„ Mamba åŒ…ç®¡ç†å™¨ä¸ Conda è¿›è¡Œæ•´åˆï¼Œæé«˜äº†åŒ…ç®¡ç†çš„é€Ÿåº¦å’Œç¨³å®šæ€§ã€‚</p>
</li>
<li>
<p>2021 å¹´ï¼ŒConda å‘å¸ƒäº† 4.10 ç‰ˆæœ¬ï¼Œå¼•å…¥äº† Conda å¸‚åœºï¼Œä¸€ä¸ªç”¨æˆ·ç•Œé¢å‹å¥½çš„è½¯ä»¶åŒ…æœç´¢å’Œå®‰è£…å·¥å…·ï¼Œæä¾›äº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒå’Œç¤¾åŒºæ”¯æŒã€‚</p>
</li>
</ol>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>é¡¹ç›®ä¾èµ–ç®¡ç†å·¥å…·ï¼ˆè™šæ‹Ÿç¯å¢ƒï¼‰ï¼š</p>
<ul>
<li>å®˜æ–¹çš„ï¼š
<ul>
<li>venv</li>
</ul>
</li>
<li>ä¸‰æ–¹çš„ï¼š
<ul>
<li>virtualenv</li>
<li>pyenv</li>
<li>pipenv</li>
<li>pyflow</li>
<li>poetry</li>
<li>pdm</li>
<li>Conda</li>
</ul>
</li>
</ul>
<p>åŒ…ç®¡ç†å·¥å…·ï¼š</p>
<ul>
<li>setuptoolsï¼šåŒ…æ„å»º</li>
<li>twineï¼šåŒ…ä¸Šä¼ å’Œå‘å¸ƒ</li>
<li>pipï¼šåŒ…å®‰è£…å·¥å…·</li>
<li>pypa/buildï¼šåŒ…æ„å»ºï¼Œç”¨äºæ›¿ä»£ setuptools</li>
</ul>
<p>ä¸‹é¢æ˜¯ pdmã€poetryã€pipenvã€venvã€virtualenvã€conda çš„ç®€è¦å¯¹æ¯”ï¼š</p>
<p>1ã€pdmï¼š</p>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>æ”¯æŒ Pipfile.lock ç®¡ç†ä¾èµ–é¡¹ï¼Œå¯ä»¥ä¿è¯ä¾èµ–é¡¹çš„ç‰ˆæœ¬å’Œç¯å¢ƒçš„ä¸€è‡´æ€§ã€‚</li>
<li>è‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†è™šæ‹Ÿç¯å¢ƒï¼Œå¯ä»¥é¿å…ç¯å¢ƒå†²çªå’Œç‰ˆæœ¬é—®é¢˜ã€‚</li>
<li>è‡ªåŠ¨å®‰è£…ç¼ºå¤±çš„ç³»ç»Ÿä¾èµ–é¡¹ï¼Œå¯ä»¥é¿å…å‡ºç°ç¼ºå°‘ç³»ç»Ÿåº“å¯¼è‡´çš„é—®é¢˜ã€‚</li>
<li>è‡ªåŠ¨å®¡æŸ¥å®‰å…¨æ¼æ´ï¼Œå¯ä»¥é¿å…ä½¿ç”¨æœ‰å®‰å…¨æ¼æ´çš„ä¾èµ–é¡¹ã€‚</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>è¿˜æ¯”è¾ƒæ–°ï¼Œç”Ÿæ€ä¸å¤Ÿå®Œå–„ã€‚</li>
<li>æ²¡æœ‰åƒ poetry å’Œ pipenv é‚£æ ·æ”¯æŒå‘å¸ƒåŒ…åˆ° PyPIã€‚</li>
</ul>
<p>2ã€poetryï¼š</p>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>æ”¯æŒ pyproject.toml ç®¡ç†ä¾èµ–é¡¹ï¼Œå¯ä»¥ä¿è¯ä¾èµ–é¡¹çš„ç‰ˆæœ¬å’Œç¯å¢ƒçš„ä¸€è‡´æ€§ã€‚</li>
<li>è‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†è™šæ‹Ÿç¯å¢ƒï¼Œå¯ä»¥é¿å…ç¯å¢ƒå†²çªå’Œç‰ˆæœ¬é—®é¢˜ã€‚</li>
<li>è‡ªåŠ¨å®‰è£…ç¼ºå¤±çš„ç³»ç»Ÿä¾èµ–é¡¹ï¼Œå¯ä»¥é¿å…å‡ºç°ç¼ºå°‘ç³»ç»Ÿåº“å¯¼è‡´çš„é—®é¢˜ã€‚</li>
<li>è‡ªåŠ¨å®¡æŸ¥å®‰å…¨æ¼æ´ï¼Œå¯ä»¥é¿å…ä½¿ç”¨æœ‰å®‰å…¨æ¼æ´çš„ä¾èµ–é¡¹ã€‚</li>
<li>æ”¯æŒå‘å¸ƒåŒ…åˆ° PyPIã€‚</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>æœ‰äº›äººè§‰å¾—é…ç½®æ¯”è¾ƒå¤æ‚ï¼Œå­¦ä¹ æ›²çº¿æ¯”è¾ƒé™¡å³­ã€‚</li>
</ul>
<p>3ã€pipenvï¼š</p>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>æ”¯æŒ Pipfile å’Œ Pipfile.lock ç®¡ç†ä¾èµ–é¡¹ï¼Œå¯ä»¥ä¿è¯ä¾èµ–é¡¹çš„ç‰ˆæœ¬å’Œç¯å¢ƒçš„ä¸€è‡´æ€§ã€‚</li>
<li>è‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†è™šæ‹Ÿç¯å¢ƒï¼Œå¯ä»¥é¿å…ç¯å¢ƒå†²çªå’Œç‰ˆæœ¬é—®é¢˜ã€‚</li>
<li>è‡ªåŠ¨å®‰è£…ç¼ºå¤±çš„ç³»ç»Ÿä¾èµ–é¡¹ï¼Œå¯ä»¥é¿å…å‡ºç°ç¼ºå°‘ç³»ç»Ÿåº“å¯¼è‡´çš„é—®é¢˜ã€‚</li>
<li>è‡ªåŠ¨å®¡æŸ¥å®‰å…¨æ¼æ´ï¼Œå¯ä»¥é¿å…ä½¿ç”¨æœ‰å®‰å…¨æ¼æ´çš„ä¾èµ–é¡¹ã€‚</li>
<li>æ”¯æŒå‘å¸ƒåŒ…åˆ° PyPIã€‚</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>æœ‰äº›äººè§‰å¾—é€Ÿåº¦æ¯”è¾ƒæ…¢ã€‚</li>
<li>æœ‰äº›äººè§‰å¾—é…ç½®æ¯”è¾ƒå¤æ‚ï¼Œå­¦ä¹ æ›²çº¿æ¯”è¾ƒé™¡å³­ã€‚</li>
</ul>
<p>4ã€venvï¼š</p>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>è‡ªå¸¦ Pythonï¼Œæ— éœ€å®‰è£…é¢å¤–çš„ä¾èµ–ã€‚</li>
<li>ç®€å•æ˜“ç”¨ï¼Œå‘½ä»¤è¡Œæ“ä½œæ–¹ä¾¿ã€‚</li>
<li>Python 3.3+ åè‡ªå¸¦ï¼Œä¸éœ€è¦å®‰è£…é¢å¤–çš„åº“ã€‚</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>åªæ”¯æŒ Python 3.3+ã€‚</li>
<li>éœ€è¦æ‰‹åŠ¨å®‰è£…ä¾èµ–é¡¹ã€‚</li>
</ul>
<p>5ã€virtualenvï¼š</p>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>æ”¯æŒ Python 2 å’Œ Python 3ã€‚</li>
<li>å¯ä»¥åœ¨åŒä¸€å°æœºå™¨ä¸Šåˆ›å»ºå¤šä¸ªè™šæ‹Ÿç¯å¢ƒï¼Œå¯ä»¥é¿å…ç¯å¢ƒå†²çªå’Œç‰ˆæœ¬é—®é¢˜ã€‚</li>
<li>å¯ä»¥åœ¨ä¸åŒçš„ Python ç‰ˆæœ¬ä¹‹é—´åˆ‡æ¢ã€‚</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>éœ€è¦æ‰‹åŠ¨å®‰è£…ä¾èµ–é¡¹ã€‚</li>
</ul>
<p>6ã€condaï¼š</p>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>æ”¯æŒå¤šä¸ªæ“ä½œç³»ç»Ÿå’Œå¤šä¸ª Python ç‰ˆæœ¬ã€‚</li>
<li>å¯ä»¥ç®¡ç† Python ç¯å¢ƒå’Œé Python ç¯å¢ƒã€‚</li>
<li>å¯ä»¥ç®¡ç†ä¾èµ–é¡¹å’Œå®‰è£…åŒ…ã€‚</li>
<li>å¯ä»¥åˆ›å»ºå’Œç®¡ç†è™šæ‹Ÿç¯å¢ƒã€‚</li>
<li>æ”¯æŒå‘å¸ƒåŒ…åˆ° Anaconda Cloudã€‚</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>å®‰è£…åŒ…å¯èƒ½æ¯”è¾ƒå¤§ã€‚</li>
<li>æœ‰äº›äººè§‰å¾—é…ç½®æ¯”è¾ƒå¤æ‚ï¼Œå­¦ä¹ æ›²çº¿æ¯”è¾ƒé™¡å³­ã€‚</li>
</ul>
<p>æ€»çš„æ¥è¯´ï¼Œè¿™äº›å·¥å…·éƒ½æœ‰å„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚å’Œä½¿ç”¨ä¹ æƒ¯é€‰æ‹©æœ€é€‚åˆè‡ªå·±çš„å·¥å…·ã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>Pythonå®‰è£…ã€æ„å»ºã€å‘å¸ƒã€ä¸‹è½½å’Œè¿è¡Œ</title>
      <link>https://blog.chensoul.com/posts/2023/05/09/python-install-build-publish-run/</link>
      <pubDate>Tue, 09 May 2023 09:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/05/09/python-install-build-publish-run/</guid>
      <description>æœ€è¿‘å¼€å§‹å­¦ä¹  pythonï¼Œè¿™ç¯‡æ–‡ç« è®°å½•å¦‚ä½•å®‰è£… pythonã€æ­å»º python å¼€å‘ç¯å¢ƒï¼Œä»¥åŠå¦‚ä½•æ„å»ºã€å‘å¸ƒ python åŒ…ã€‚æˆ‘ä½¿ç”¨çš„æ˜¯ macos ç³»ç»Ÿï¼Œæ‰€ä»¥æœ¬ç¯‡æ–‡ç« ä¸­çš„ä¸€äº›å‘½</description>
      <content:encoded><![CDATA[<p>æœ€è¿‘å¼€å§‹å­¦ä¹  pythonï¼Œè¿™ç¯‡æ–‡ç« è®°å½•å¦‚ä½•å®‰è£… pythonã€æ­å»º python å¼€å‘ç¯å¢ƒï¼Œä»¥åŠå¦‚ä½•æ„å»ºã€å‘å¸ƒ python åŒ…ã€‚æˆ‘ä½¿ç”¨çš„æ˜¯ macos ç³»ç»Ÿï¼Œæ‰€ä»¥æœ¬ç¯‡æ–‡ç« ä¸­çš„ä¸€äº›å‘½ä»¤æ˜¯åŸºäº macos ï¼Œç‰¹æ­¤è¯´æ˜ã€‚</p>
<h2 id="1å®‰è£…">1ã€å®‰è£…</h2>
<p>MacOS ä¸Šé€šè¿‡ brew å®‰è£… Python3ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">brew install python3
</span></span></code></pre></div><p>æŸ¥çœ‹ python3 å®‰è£…è·¯å¾„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ which python3
</span></span><span class="line"><span class="cl">/opt/homebrew/bin/python3
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ <span class="nb">type</span> python3
</span></span><span class="line"><span class="cl">python3 is /opt/homebrew/bin/python3
</span></span></code></pre></div><p>æŸ¥çœ‹ç‰ˆæœ¬ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">python --version
</span></span></code></pre></div><p>è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ zshï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹ ~/.zshrcï¼Œæ·»åŠ ä¸‹é¢ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PYTHON_HOME</span><span class="o">=</span>/opt/homebrew/opt/python@3.11
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PYTHON_HOME</span>/bin:<span class="nv">$PATH</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">alias</span> <span class="nv">python</span><span class="o">=</span>python3
</span></span><span class="line"><span class="cl"><span class="nb">alias</span> <span class="nv">pip</span><span class="o">=</span>pip3
</span></span></code></pre></div><p>ä½¿é…ç½®ç”Ÿæ•ˆï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">source</span> ~/.zshrc
</span></span></code></pre></div><h2 id="2åˆ›å»ºé¡¹ç›®">2ã€åˆ›å»ºé¡¹ç›®</h2>
<p>åˆ›å»ºä¸€ä¸ªç›®å½• chensoul_helloï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir chensoul_hello
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> chensoul_hello
</span></span></code></pre></div><p>åˆ›å»ºä¸€ä¸ª main.py ï¼Œæ‰“å° helloworldï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;hello world&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>è¯•è¯•è¿è¡Œ main.pyï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">python main.py
</span></span></code></pre></div><h2 id="3åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ">3ã€åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ</h2>
<p>ä½¿ç”¨ python venv æ¨¡å—åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ .venvï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">python -m venv .venv
</span></span></code></pre></div><p>ä½¿ç”¨ . å¼€å¤´çš„ç›®å½•æˆ–è€…æ–‡ä»¶ä¸ºéšè—æ–‡ä»¶ã€‚<code>å¦‚æœä½¿ç”¨ git ç®¡ç†é¡¹ç›®ï¼Œåˆ™éœ€è¦å°† .venv æ·»åŠ åˆ° .gitignore</code>ã€‚</p>
<p>æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">source</span> .venv/bin/activate
</span></span></code></pre></div><h2 id="4ä½¿ç”¨-setuptools-ç®¡ç†é¡¹ç›®">4ã€ä½¿ç”¨ setuptools ç®¡ç†é¡¹ç›®</h2>
<p>setuptools æ˜¯ Python çš„ä¸€ä¸ªåŒ…ç®¡ç†å·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´æ–¹ä¾¿åœ°æ‰“åŒ…å’Œå‘å¸ƒ Python ä»£ç ã€‚setuptools æä¾›äº†ä¸€äº›å‘½ä»¤è¡Œå·¥å…·ï¼Œä¾‹å¦‚ easy_install å’Œ setup.pyã€‚</p>
<p><code>setup.py</code> æ–‡ä»¶æ˜¯ setuptools ç”¨äºæ„å»ºã€æ‰“åŒ…å’Œå‘å¸ƒ Python åŒ…çš„æ ¸å¿ƒæ–‡ä»¶ä¹‹ä¸€ã€‚é€šè¿‡ <code>setup.py</code> æ–‡ä»¶ï¼Œå¼€å‘äººå‘˜å¯ä»¥æŒ‡å®šåŒ…çš„å…ƒæ•°æ®ã€ä¾èµ–å…³ç³»ã€å®‰è£…è„šæœ¬ç­‰ä¿¡æ¯ï¼Œä»è€Œå®ç°åŒ…çš„å®‰è£…ã€å‡çº§å’Œå¸è½½ç­‰æ“ä½œã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼Œ<code>setup.py</code> æ–‡ä»¶é€šå¸¸åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>åŒ…çš„å…ƒæ•°æ®ï¼Œä¾‹å¦‚åŒ…çš„åç§°ã€ç‰ˆæœ¬å·ã€ä½œè€…ã€è®¸å¯è¯ç­‰ä¿¡æ¯ã€‚</li>
<li>åŒ…çš„ä¾èµ–å…³ç³»ï¼Œä¾‹å¦‚éœ€è¦ä¾èµ–å“ªäº›å…¶ä»– Python åŒ…ã€‚</li>
<li>åŒ…çš„å®‰è£…è„šæœ¬ï¼Œä¾‹å¦‚éœ€è¦å®‰è£…å“ªäº›æ–‡ä»¶ã€è„šæœ¬ç­‰ã€‚</li>
<li>å…¶ä»–è‡ªå®šä¹‰çš„æ„å»ºå’Œå‘å¸ƒé€‰é¡¹ï¼Œä¾‹å¦‚æ–‡æ¡£ç”Ÿæˆã€å‘½ä»¤è¡Œå·¥å…·çš„ç”Ÿæˆç­‰ã€‚</li>
</ul>
<p>é€šè¿‡è¿è¡Œ <code>python setup.py</code> å‘½ä»¤ï¼Œå¯ä»¥æ‰§è¡Œä¸€ç³»åˆ—æ“ä½œï¼Œä¾‹å¦‚å°†åŒ…æ„å»ºä¸ºæºä»£ç æˆ–äºŒè¿›åˆ¶åˆ†å‘åŒ…ã€å°†å…¶ä¸Šä¼ åˆ° PyPI æˆ–å…¶ä»–åŒ…ä»“åº“ã€å®‰è£…åŒ…åˆ°æœ¬åœ°ç³»ç»Ÿç­‰ã€‚åŒæ—¶ï¼Œsetuptools è¿˜æä¾›äº†ä¸€äº›åŠŸèƒ½ï¼Œä¾‹å¦‚è‡ªåŠ¨åŒ–ä¾èµ–å…³ç³»ç®¡ç†ã€ç‰ˆæœ¬æ§åˆ¶ã€å‘½ä»¤è¡Œå·¥å…·çš„ç”Ÿæˆå’Œæ–‡æ¡£çš„ç”Ÿæˆç­‰ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´åŠ é«˜æ•ˆåœ°è¿›è¡Œ Python å¼€å‘ã€‚</p>
<p>1ã€å®‰è£… setuptools</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">pip install setuptools
</span></span></code></pre></div><p>2ã€åˆ›å»º setup.py æ–‡ä»¶</p>
<p>åœ¨ä½¿ç”¨ setuptools æ—¶ï¼Œé€šå¸¸éœ€è¦åˆ›å»ºä¸€ä¸ª setup.py æ–‡ä»¶ï¼Œç”¨æ¥æè¿°åŒ…çš„ä¿¡æ¯ã€ä¾èµ–å…³ç³»å’Œå®‰è£…æ–¹å¼ç­‰ã€‚setup.py æ–‡ä»¶é€šå¸¸åŒ…å«ä¸€ä¸ª setup() å‡½æ•°ï¼Œç”¨æ¥å®šä¹‰åŒ…çš„å…ƒæ•°æ®å’Œä¾èµ–å…³ç³»ç­‰ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">setuptools</span> <span class="kn">import</span> <span class="n">setup</span><span class="p">,</span> <span class="n">find_packages</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">setup</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;chensoul_hello&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">version</span><span class="o">=</span><span class="s1">&#39;1.0.0&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">author</span><span class="o">=</span><span class="s1">&#39;chensoul&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">author_email</span><span class="o">=</span><span class="s1">&#39;chensoul@chensoul.com&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;A simple Python package&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">packages</span><span class="o">=</span><span class="n">find_packages</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="n">install_requires</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;numpy&gt;=1.16.0&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;pandas&gt;=0.23.4&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="n">entry_points</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;console_scripts&#39;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;hello_command=chensoul_hello.cli:main&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></div><p>è¿™ä¸ª <code>setup.py</code> æ–‡ä»¶å®šä¹‰äº†ä¸€ä¸ªåä¸º <code>chensoul_hello</code> çš„ Python åŒ…ï¼ŒæŒ‡å®šäº†åŒ…çš„å…ƒæ•°æ®ã€ä¾èµ–å…³ç³»ç­‰ä¿¡æ¯ã€‚</p>
<ul>
<li><code>name</code>ï¼šåŒ…çš„åç§°ã€‚</li>
<li><code>version</code>ï¼šåŒ…çš„ç‰ˆæœ¬å·ã€‚</li>
<li><code>author</code>ï¼šåŒ…çš„ä½œè€…ã€‚</li>
<li><code>author_email</code>ï¼šä½œè€…çš„ç”µå­é‚®ä»¶åœ°å€ã€‚</li>
<li><code>description</code>ï¼šåŒ…çš„ç®€è¦æè¿°ã€‚</li>
<li><code>packages</code>ï¼šåŒ…å«éœ€è¦æ‰“åŒ…çš„ Python åŒ…çš„åˆ—è¡¨ï¼Œä½¿ç”¨ <code>find_packages()</code> å‡½æ•°å¯ä»¥è‡ªåŠ¨æŸ¥æ‰¾æ‰€æœ‰åŒ…ã€‚</li>
<li><code>install_requires</code>ï¼šåŒ…ä¾èµ–çš„å…¶ä»– Python åŒ…ã€‚</li>
<li><code>console_scripts</code>ï¼š æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œç”¨äºå®šä¹‰åŒ…ä¸­çš„å‘½ä»¤è¡Œå·¥å…·ã€‚å®ƒæ˜¯ä¸€ä¸ªå­—å…¸ï¼Œé”®æ˜¯å‘½ä»¤çš„åç§°ï¼Œå€¼æ˜¯å‘½ä»¤å¯¹åº”çš„å…¥å£ç‚¹ï¼ˆentry pointï¼‰ã€‚å…¥å£ç‚¹æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé€šå¸¸æ˜¯æ¨¡å—åå’Œå‡½æ•°åçš„ç»„åˆï¼Œä¾‹å¦‚ &ldquo;chensoul_hello.cli:main&rdquo;ï¼Œè¡¨ç¤ºè°ƒç”¨ chensoul_hello åŒ…ä¸­çš„ cli æ¨¡å—çš„ main å‡½æ•°ã€‚å½“ä½¿ç”¨ setuptools å®‰è£…åŒ…æ—¶ï¼Œconsole_scripts ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶å°†å…¥å£ç‚¹æŒ‡å‘è¯¥æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶é€šå¸¸è¢«æ”¾åœ¨ Python çš„ bin ç›®å½•ä¸‹ï¼Œä¾‹å¦‚ /usr/local/binã€‚</li>
</ul>
<p>å¯¹äºä¸Šé¢çš„ä¾‹å­ï¼Œå¦‚æœæƒ³è¦åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ hello_command å‘½ä»¤ï¼Œéœ€è¦åˆ›å»ºåä¸º &ldquo;chensoul_hello&rdquo; çš„ Python åŒ…ï¼š</p>
<ul>
<li>
<p>åˆ›å»ºä¸€ä¸ªåä¸º &ldquo;chensoul_hello&rdquo; çš„æ–‡ä»¶å¤¹ï¼Œå¹¶è¿›å…¥è¯¥æ–‡ä»¶å¤¹ã€‚</p>
</li>
<li>
<p>åœ¨ &ldquo;chensoul_hello&rdquo; æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º <code>__init__.py</code> çš„ç©ºæ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶ç”¨äºæŒ‡ç¤º Python è§£é‡Šå™¨è¯¥æ–‡ä»¶å¤¹æ˜¯ä¸€ä¸ª Python åŒ…ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir chensoul_hello
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> chensoul_hello
</span></span><span class="line"><span class="cl">touch __init__.py
</span></span></code></pre></div></li>
<li>
<p>åœ¨ &ldquo;chensoul_hello&rdquo; æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º <code>cli.py</code> çš„æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶ç”¨äºå®šä¹‰å‘½ä»¤è¡Œè„šæœ¬çš„å…¥å£å‡½æ•°ã€‚åœ¨ <code>cli.py</code> æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Hello, world!&#34;</span><span class="p">)</span>
</span></span></code></pre></div></li>
</ul>
<h2 id="5ä½¿ç”¨-setuptools-æ„å»ºåŒ…">5ã€ä½¿ç”¨ setuptools æ„å»ºåŒ…</h2>
<p>åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æ„å»ºæºç åˆ†å‘åŒ…ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">python setup.py sdist
</span></span></code></pre></div><p>æˆ–è€…ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æ„å»ºäºŒè¿›åˆ¶ wheel åŒ…ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">python setup.py bdist_wheel
</span></span></code></pre></div><p>åœ¨æ‰§è¡Œä¸Šé¢ä¸¤ä¸ªå‘½ä»¤ä¹‹å‰ï¼Œéœ€è¦ç¡®ä¿å·²ç»å®‰è£…äº† setuptools å’Œ wheelã€‚å¦‚æœæ²¡æœ‰å®‰è£…ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">pip install setuptools wheel
</span></span></code></pre></div><p>ä¹Ÿå¯ä»¥ä¸€èµ·æ‰§è¡Œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">python setup.py sdist bdist_wheel
</span></span></code></pre></div><p>æ‰§è¡Œå®Œæˆåï¼Œä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆ dist ç›®å½•ï¼Œå¹¶åœ¨å…¶ä¸­ç”Ÿæˆä¸¤ä¸ªåŒ…æ–‡ä»¶ï¼šä¸€ä¸ªæºä»£ç åŒ…å’Œä¸€ä¸ªäºŒè¿›åˆ¶åŒ…ã€‚è¿™ä¸¤ä¸ªåŒ…æ–‡ä»¶å¯ä»¥é€šè¿‡ pip å®‰è£…ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å°†å®ƒä»¬æ‹·è´åˆ°å…¶ä»–æœºå™¨ä¸Šä½¿ç”¨ã€‚</p>
<h2 id="6ä½¿ç”¨-twine-å‘å¸ƒåŒ…">6ã€ä½¿ç”¨ twine å‘å¸ƒåŒ…</h2>
<p>twine æ˜¯ä¸€ä¸ª Python åŒ…ï¼Œç”¨äºå°† Python åŒ…ä¸Šä¼ åˆ° PyPI æˆ–å…¶ä»–ç±»ä¼¼çš„åŒ…ä»“åº“ã€‚å®ƒå¯ä»¥å¸®åŠ©ä½ å°†æ‰“åŒ…å¥½çš„ Python åŒ…ä¸Šä¼ åˆ° PyPI æœåŠ¡å™¨æˆ–å…¶ä»–ç±»ä¼¼çš„æœåŠ¡å™¨ã€‚</p>
<ol>
<li>å®‰è£… twine</li>
</ol>
<p>åœ¨ç»ˆç«¯æˆ–å‘½ä»¤è¡Œä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£… twineï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">pip install twine
</span></span></code></pre></div><ol start="2">
<li>æ‰“åŒ… Python åŒ…</li>
</ol>
<p>å¦‚æœä½ å·²ç»ä½¿ç”¨ setuptools æ„å»ºäº†æºç åˆ†å‘åŒ…æˆ–äºŒè¿›åˆ¶ wheel åŒ…ï¼Œå¯ä»¥ä½¿ç”¨ <code>wheel</code> å·¥å…·æ¥å°†å…¶è½¬æ¢ä¸º wheel åŒ…æˆ–ä¸Šä¼ åˆ° PyPI æˆ–å…¶ä»–æ”¯æŒçš„åŒ…ä»“åº“ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†æºç åˆ†å‘åŒ…è½¬æ¢ä¸º wheel åŒ…ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">pip wheel dist/chensoul_hello-1.0.0.tar.gz
</span></span></code></pre></div><ol start="3">
<li>æ³¨å†Œè´¦å·</li>
</ol>
<p>åœ¨ä¸Šä¼ åŒ…ä¹‹å‰ï¼Œä½ éœ€è¦æ³¨å†Œä¸€ä¸ª PyPI è´¦å·ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰æ³¨å†Œï¼Œè¯·è®¿é—® PyPI ç½‘ç«™ï¼ˆhttps://pypi.org/account/register/ï¼‰è¿›è¡Œæ³¨å†Œã€‚</p>
<p>åœ¨ä½¿ç”¨ <code>twine</code> å·¥å…·ä¸Šä¼ åŒ…æ—¶ï¼Œéœ€è¦å…ˆåœ¨ PyPI ç½‘ç«™ä¸Šæ³¨å†Œè´¦å·å¹¶è·å–ä¸Šä¼ å‡­è¯ï¼ˆä¾‹å¦‚ API å¯†é’¥æˆ–ç”¨æˆ·åå¯†ç ï¼‰ï¼Œç„¶åå°†å‡­è¯ä¿å­˜åœ¨æœ¬åœ°çš„ <code>$HOME/.pypirc</code> æ–‡ä»¶ä¸­ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-toml" data-lang="toml"><span class="line"><span class="cl"><span class="p">[</span><span class="nx">pypi</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="nx">username</span> <span class="p">=</span> <span class="nx">__token__</span>
</span></span><span class="line"><span class="cl">  <span class="nx">password</span> <span class="p">=</span> <span class="nx">pypi-XXXXXX</span>
</span></span></code></pre></div><ol start="4">
<li>ä¸Šä¼  Python åŒ…</li>
</ol>
<p><code>twine</code> å·¥å…·æ”¯æŒä¸Šä¼ åˆ°ä»¥ä¸‹åŒ…ä»“åº“ï¼š</p>
<ul>
<li>
<p>PyPIï¼ˆPython Package Indexï¼‰ï¼šPyPI æ˜¯ Python ç¤¾åŒºçš„å®˜æ–¹åŒ…ä»“åº“ï¼Œæä¾›äº†å¤§é‡çš„ Python åŒ…ä¾›ç”¨æˆ·ä¸‹è½½å’Œä½¿ç”¨ã€‚PyPI ä½¿ç”¨ <a href="https://pypi.org/">https://pypi.org/</a> ä½œä¸ºå®˜æ–¹ç½‘ç«™ï¼Œå¯ä»¥ä½¿ç”¨ <code>twine</code> å·¥å…·å°†åŒ…ä¸Šä¼ åˆ° PyPIã€‚</p>
</li>
<li>
<p>Test PyPIï¼šTest PyPI æ˜¯ PyPI çš„ä¸€ä¸ªæµ‹è¯•ç¯å¢ƒï¼Œç”¨äºæµ‹è¯•å’ŒéªŒè¯åŒ…çš„ä¸Šä¼ å’Œåˆ†å‘è¿‡ç¨‹ã€‚Test PyPI ä½¿ç”¨ <a href="https://test.pypi.org/">https://test.pypi.org/</a> ä½œä¸ºå®˜æ–¹ç½‘ç«™ï¼Œå¯ä»¥ä½¿ç”¨ <code>twine</code> å·¥å…·å°†åŒ…ä¸Šä¼ åˆ° Test PyPIã€‚</p>
</li>
<li>
<p>ä»»ä½•æ”¯æŒ twine æ ¼å¼çš„åŒ…ä»“åº“ï¼š<code>twine</code> å·¥å…·æ”¯æŒå°†åŒ…ä¸Šä¼ åˆ°ä»»ä½•æ”¯æŒ twine æ ¼å¼çš„åŒ…ä»“åº“ï¼Œåªéœ€è¦æŒ‡å®šåŒ…ä»“åº“çš„ URL å’Œå‡­è¯å³å¯ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ <code>twine</code> å·¥å…·å°†åŒ…ä¸Šä¼ åˆ°è‡ªå·±çš„ç§æœ‰åŒ…ä»“åº“æˆ–ç¬¬ä¸‰æ–¹åŒ…ä»“åº“ã€‚</p>
</li>
</ul>
<p>ä¾‹å¦‚ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†ä¸€ä¸ª wheel åŒ…ä¸Šä¼ åˆ° PyPIï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ twine upload dist/chensoul_hello-1.0.0-py3-none-any.whl
</span></span><span class="line"><span class="cl">Enter your username: __token__
</span></span><span class="line"><span class="cl">Enter your password:
</span></span></code></pre></div><p>æˆ–è€…ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†ä¸€ä¸ªæºç åˆ†å‘åŒ…ä¸Šä¼ åˆ° PyPIï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">twine upload dist/chensoul_hello-1.0.0.tar.gz
</span></span></code></pre></div><p>åŒæ—¶ä¸Šä¼ wheel åŒ…å’Œæºç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">twine upload dist/*
</span></span></code></pre></div><p>è¿™ä¸ªå‘½ä»¤å°†ä¼šä¸Šä¼  <code>dist</code> ç›®å½•ä¸‹çš„æ‰€æœ‰åŒ…åˆ° Test PyPIã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šä¼ åˆ°ä¸åŒçš„åŒ…ä»“åº“å¯èƒ½éœ€è¦ä¸åŒçš„å‘½ä»¤å’Œå‚æ•°ï¼Œå…·ä½“å¯ä»¥å‚è€ƒåŒ…ä»“åº“çš„æ–‡æ¡£æˆ–å¸®åŠ©ä¿¡æ¯ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">twine upload --repository-url https://test.pypi.org/legacy/ dist/*
</span></span></code></pre></div><p>å¦‚æœä¸Šä¼ æ—¶æç¤ºé”™è¯¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">Uploading distributions to https://upload.pypi.org/legacy/
</span></span><span class="line"><span class="cl">Uploading chensoul_hello-1.0.0-py3-none-any.whl
</span></span><span class="line"><span class="cl">100% â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 4.5/4.5 kB â€¢ 00:00 â€¢ ?
</span></span><span class="line"><span class="cl">WARNING  Error during upload. Retry with the --verbose option <span class="k">for</span> more details.
</span></span><span class="line"><span class="cl">ERROR    HTTPError: <span class="m">403</span> Forbidden from https://upload.pypi.org/legacy/
</span></span><span class="line"><span class="cl">        The user <span class="s1">&#39;chensoul&#39;</span> isn<span class="s1">&#39;t allowed to upload to project &#39;</span>my-package<span class="err">&#39;</span>. See https://pypi.org/help/#project-name <span class="k">for</span> more information.
</span></span></code></pre></div><p>åŸå› æ˜¯é¡¹ç›®åç§° my-package ä¸åˆæ³•æˆ–è€…å·²å­˜åœ¨ï¼Œéœ€è¦ä¿®æ”¹åŒ…åç§°ã€‚</p>
<p>å¦‚æœé¡¹ç›®å·²ç»å­˜åœ¨ï¼Œåˆ™å¯ä»¥æ·»åŠ å‚æ•°è¦†ç›–å·²ç»å­˜åœ¨çš„é¡¹ç›®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">twine upload dist/* --skip-existing
</span></span></code></pre></div><h2 id="7ä½¿ç”¨-pip-å®‰è£…åŒ…">7ã€ä½¿ç”¨ pip å®‰è£…åŒ…</h2>
<p>å¦‚æœä½ æƒ³å®‰è£…ã€å‡çº§æˆ–åˆ é™¤ Python åŒ…ï¼Œå¯ä»¥ä½¿ç”¨ <code>pip</code> å·¥å…·æ¥è¿›è¡Œæ“ä½œã€‚</p>
<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…æœ¬åœ°çš„åŒ…ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">pip install dist/chensoul_hello-1.0.0.tar.gz
</span></span></code></pre></div><p>æˆ–è€…å®‰è£…æœ¬åœ°çš„ wheel åŒ…ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">pip install dist/chensoul_hello-1.0.0-py3-none-any.whl
</span></span></code></pre></div><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥ä»ä»“åº“ä¸­å®‰è£…ä¸€ä¸ªåŒ…åŠå…¶ä¾èµ–é¡¹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">pip install chensoul_hello
</span></span></code></pre></div><p>æŸ¥çœ‹æœ¬åœ°ä¸‹è½½çš„å®‰è£…åŒ…ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ pip list<span class="p">|</span>grep chensoul-hello
</span></span><span class="line"><span class="cl">chensoul-hello     1.0.0
</span></span></code></pre></div><blockquote>
<p>åœ¨ä½¿ç”¨ setuptools æ„å»º Python åŒ…æ—¶ï¼ŒåŒ…ååº”è¯¥ç¬¦åˆ Python åŒ…å‘½åè§„èŒƒã€‚å…·ä½“æ¥è¯´ï¼ŒåŒ…ååº”è¯¥åªåŒ…å«å°å†™å­—æ¯ã€æ•°å­—å’ŒçŸ­æ¨ªçº¿ <code>-</code>ï¼Œä¸èƒ½åŒ…å«å…¶ä»–å­—ç¬¦ï¼ŒåŒ…ååº”è¯¥ä»¥å­—æ¯å¼€å¤´ï¼Œå¹¶ä¸”ä¸èƒ½è¶…è¿‡ 32 ä¸ªå­—ç¬¦ã€‚</p>
<p>å¦å¤–ï¼Œå¦‚æœä½ åœ¨åŒ…åä¸­ä½¿ç”¨äº†çŸ­æ¨ªçº¿ <code>-</code>ï¼Œåœ¨å¼•ç”¨åŒ…æ—¶éœ€è¦å°†å…¶æ›¿æ¢æˆä¸‹åˆ’çº¿ <code>_</code>ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„åŒ…åä¸º <code>chensoul-hello</code>ï¼Œåœ¨å¼•ç”¨åŒ…æ—¶åº”è¯¥ä½¿ç”¨ <code>import chensoul_hello</code>ã€‚</p>
<p>æ€»ä¹‹ï¼Œåœ¨ä½¿ç”¨ setuptools æ„å»º Python åŒ…æ—¶ï¼ŒåŒ…ååº”è¯¥ç¬¦åˆ Python åŒ…å‘½åè§„èŒƒï¼Œå¹¶ä¸”å¦‚æœåŒ…åä¸­åŒ…å«çŸ­æ¨ªçº¿ <code>-</code>ï¼Œåœ¨å¼•ç”¨åŒ…æ—¶åº”è¯¥ä½¿ç”¨ä¸‹åˆ’çº¿ <code>_</code>ã€‚</p>
</blockquote>
<p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯¼å‡ºå½“å‰ç¯å¢ƒä¸­çš„æ‰€æœ‰ä¾èµ–é¡¹åˆ—è¡¨åˆ° requirements.txt æ–‡ä»¶ä¸­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">pip freeze &gt; requirements.txt
</span></span></code></pre></div><p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ ¹æ® requirements.txt æ–‡ä»¶ä¸­çš„ä¾èµ–é¡¹åˆ—è¡¨å®‰è£…åŒ…ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">pip install -r requirements.txt
</span></span></code></pre></div><h2 id="8è¿è¡Œå‘½ä»¤">8ã€è¿è¡Œå‘½ä»¤</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ hello_command
</span></span><span class="line"><span class="cl">Hello, world!
</span></span></code></pre></div><h2 id="9ä½¿ç”¨-pypabuild-æ„å»ºåŒ…">9ã€ä½¿ç”¨ pypa/build æ„å»ºåŒ…</h2>
<p>æ‰§è¡Œä¸‹é¢å‘½ä»¤æ—¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">python setup.py bdist_wheel
</span></span></code></pre></div><p>å‡ºç°ä¸€ä¸ªè­¦å‘Šï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">        ********************************************************************************
</span></span><span class="line"><span class="cl">        Please avoid running <span class="sb">``</span>setup.py<span class="sb">``</span> directly.
</span></span><span class="line"><span class="cl">        Instead, use pypa/build, pypa/installer, pypa/build or
</span></span><span class="line"><span class="cl">        other standards-based tools.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        See https://blog.ganssle.io/articles/2021/10/setup-py-deprecated.html <span class="k">for</span> details.
</span></span><span class="line"><span class="cl">        ********************************************************************************
</span></span></code></pre></div><p>pypa/build å’Œ pypa/installer æ˜¯ Python Packaging Authorityï¼ˆPyPAï¼‰ç»´æŠ¤çš„ä¸¤ä¸ªå·¥å…·ï¼Œåˆ†åˆ«ç”¨äºæ„å»ºå’Œå®‰è£… Python åŒ…ã€‚pypa/build å°±æ˜¯ build æ¨¡å—ï¼Œè€Œ pypa/installer å°±æ˜¯pipã€‚</p>
<p>ä¸‹é¢æ˜¯å®ƒä»¬çš„ä½¿ç”¨æ–¹æ³•ï¼š</p>
<ol>
<li>
<p>å®‰è£… pypa/build å·¥å…·ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">pip install build
</span></span></code></pre></div></li>
<li>
<p>è¿è¡Œä»¥ä¸‹å‘½ä»¤æ„å»ºåŒ…ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">python -m build
</span></span></code></pre></div><p><code>python -m build</code> æ˜¯ä¸€ä¸ªç”¨äºæ„å»º Python åŒ…çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå®ƒæ˜¯ Python 3.10 ä¸­æ–°å¢çš„æ ‡å‡†åº“æ¨¡å— <code>build</code> çš„å…¥å£ç‚¹ã€‚ä½¿ç”¨ <code>python -m build</code> å¯ä»¥æ–¹ä¾¿åœ°æ„å»ºæºä»£ç å‘è¡ŒåŒ…å’ŒäºŒè¿›åˆ¶å‘è¡ŒåŒ…ï¼Œæ”¯æŒå¤šç§æ ¼å¼ï¼ŒåŒ…æ‹¬ <code>sdist</code>ã€<code>wheel</code>ã€<code>zip</code>ã€<code>tar</code> ç­‰ã€‚</p>
<p>åœ¨ä½¿ç”¨ <code>python -m build</code> æ„å»º Python åŒ…ä¹‹å‰ï¼Œéœ€è¦ç¡®ä¿ä½ çš„é¡¹ç›®ç¬¦åˆ Python åŒ…çš„æ ‡å‡†ã€‚å…·ä½“æ¥è¯´ï¼Œä½ éœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª <code>setup.cfg</code> æ–‡ä»¶å’Œä¸€ä¸ª <code>setup.py</code> æ–‡ä»¶ï¼Œå…¶ä¸­ <code>setup.cfg</code> æ–‡ä»¶åŒ…å«é¡¹ç›®å…ƒæ•°æ®å’Œæ„å»ºé€‰é¡¹ï¼Œ<code>setup.py</code> æ–‡ä»¶åŒ…å«æ„å»ºå’Œæ‰“åŒ…çš„å…·ä½“å®ç°ã€‚</p>
</li>
<li>
<p>å¦‚æœéœ€è¦å‘å¸ƒåŒ…åˆ° PyPI æˆ–å…¶ä»–åŒ…ä»“åº“ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">twine upload dist/*
</span></span></code></pre></div></li>
</ol>
<h2 id="10é™„å½•">10ã€é™„å½•</h2>
<h3 id="pypabuild-å’Œ-setuptools-å¯¹æ¯”">pypa/build å’Œ setuptools å¯¹æ¯”</h3>
<p><code>python -m build</code> å’Œ <code>python setup.py sdist bdist_wheel</code> éƒ½æ˜¯ç”¨äºæ„å»º Python åŒ…çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œä½†å®ƒä»¬æœ‰ä¸€äº›åŒºåˆ«ã€‚</p>
<ul>
<li><code>python -m build</code> æ˜¯ Python 3.10 ä¸­æ–°å¢çš„æ ‡å‡†åº“æ¨¡å— <code>build</code> çš„å…¥å£ç‚¹ï¼Œæ”¯æŒå¤šç§æ„å»ºæ ¼å¼ï¼ŒåŒ…æ‹¬ <code>sdist</code>ã€<code>wheel</code>ã€<code>zip</code>ã€<code>tar</code> ç­‰ã€‚å®ƒå¯ä»¥è‡ªåŠ¨æ„å»ºæºä»£ç å‘è¡ŒåŒ…å’ŒäºŒè¿›åˆ¶å‘è¡ŒåŒ…ï¼Œå¹¶æ”¯æŒå¤šç§å¹³å°å’Œ Python ç‰ˆæœ¬ã€‚<code>python -m build</code> çš„ä½¿ç”¨æ–¹å¼æ¯”è¾ƒç®€å•ï¼Œéœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª <code>setup.py</code> æ–‡ä»¶æˆ–è€… <code>pyproject.toml</code> æ–‡ä»¶ï¼Œç„¶ååœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œ <code>python -m build</code> å‘½ä»¤å³å¯ã€‚</li>
<li><code>python setup.py sdist bdist_wheel</code> æ˜¯ä¼ ç»Ÿçš„ Python åŒ…æ„å»ºæ–¹å¼ï¼Œéœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª <code>setup.py</code> æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ„å»ºå’Œæ‰“åŒ…çš„å…·ä½“å®ç°ã€‚å®ƒæ”¯æŒçš„æ„å»ºæ ¼å¼æ¯”è¾ƒæœ‰é™ï¼ŒåªåŒ…æ‹¬ <code>sdist</code> å’Œ <code>bdist_wheel</code> ä¸¤ç§æ ¼å¼ã€‚<code>python setup.py sdist bdist_wheel</code> çš„ä½¿ç”¨æ–¹å¼ç›¸å¯¹è¾ƒä¸ºç¹çï¼Œéœ€è¦æ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼Œå¹¶æŒ‡å®šç›¸åº”çš„å‚æ•°å’Œé€‰é¡¹ã€‚</li>
</ul>
<p>æ€»ä¹‹ï¼Œ<code>python -m build</code> æ˜¯ Python 3.10 ä¸­æ–°å¢çš„æ ‡å‡†åº“æ¨¡å— <code>build</code> çš„å…¥å£ç‚¹ï¼Œæ”¯æŒå¤šç§æ„å»ºæ ¼å¼ï¼Œä½¿ç”¨èµ·æ¥æ¯”è¾ƒç®€å•ã€‚è€Œ <code>python setup.py sdist bdist_wheel</code> æ˜¯ä¼ ç»Ÿçš„ Python åŒ…æ„å»ºæ–¹å¼ï¼Œä½¿ç”¨èµ·æ¥ç›¸å¯¹è¾ƒä¸ºç¹çï¼Œä½†ä»ç„¶æ˜¯ä¸€ç§å¸¸è§çš„æ„å»ºæ–¹å¼ã€‚éœ€è¦æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µé€‰æ‹©é€‚åˆçš„æ„å»ºå·¥å…·ã€‚</p>
<p>ç›¸å¯¹äºä½¿ç”¨ <code>python setup.py sdist bdist_wheel</code> å‘½ä»¤ï¼Œä½¿ç”¨ <code>python -m build</code> å‘½ä»¤æœ‰ä»¥ä¸‹å‡ ä¸ªä¼˜ç‚¹ï¼š</p>
<ol>
<li>æ›´ç®€å•çš„å‘½ä»¤ï¼š<code>python -m build</code> å‘½ä»¤æ¯” <code>python setup.py sdist bdist_wheel</code> å‘½ä»¤æ›´åŠ ç®€å•æ˜“ç”¨ï¼Œå› ä¸ºå®ƒä¸éœ€è¦ä½ ç¼–å†™ <code>setup.py</code> æ–‡ä»¶ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>pyproject.toml</code> æ–‡ä»¶æ¥ä»£æ›¿ï¼Œè¿™æ ·ä¼šæ›´ç®€å•å’Œç°ä»£åŒ–ã€‚</li>
<li>æ›´å¥½çš„é…ç½®ï¼š<code>build</code> æ¨¡å—ä½¿ç”¨ <code>pyproject.toml</code> æ–‡ä»¶æ¥é…ç½®åŒ…çš„æ„å»ºï¼Œè¿™æ˜¯ä¸€ç§æ›´ç°ä»£å’Œæ ‡å‡†åŒ–çš„é…ç½®æ–¹å¼ã€‚è¯¥æ–‡ä»¶å¯ä»¥æŒ‡å®šæ„å»ºä¾èµ–é¡¹ã€åŒ…å«åœ¨è½¯ä»¶åŒ…ä¸­çš„å…¶ä»–æ–‡ä»¶ä»¥åŠå…¶ä»–å…ƒæ•°æ®ã€‚</li>
<li>æ›´å¤šçš„è¾“å‡ºæ ¼å¼ï¼š<code>python -m build</code> æ”¯æŒæ¯” <code>python setup.py sdist bdist_wheel</code> æ›´å¤šçš„è¾“å‡ºæ ¼å¼ï¼ŒåŒ…æ‹¬ <code>wheel</code>ã€<code>sdist</code>ã€<code>zip</code>ã€<code>tar</code> ç­‰ç­‰ã€‚</li>
<li>æ›´å¥½çš„æ€§èƒ½ï¼šç›¸å¯¹äº <code>python setup.py sdist bdist_wheel</code> å‘½ä»¤ï¼Œ<code>python -m build</code> å‘½ä»¤é€šå¸¸æ›´å¿«ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå…·æœ‰è®¸å¤šä¾èµ–é¡¹çš„å¤§å‹é¡¹ç›®è€Œè¨€ã€‚è¿™æ˜¯å› ä¸º <code>build</code> å¯ä»¥å¹¶è¡Œå¤„ç†æŸäº›ä»»åŠ¡ï¼Œä¾‹å¦‚æ„å»ºäºŒè¿›åˆ¶è½¯ä»¶åŒ…ã€‚</li>
<li>æ›´å¥½çš„å…¼å®¹æ€§ï¼š<code>python -m build</code> è®¾è®¡ä¸ºä¸å¤šä¸ª Python ç‰ˆæœ¬å’Œå¹³å°å…¼å®¹ï¼Œè€Œ <code>python setup.py sdist bdist_wheel</code> å‘½ä»¤é€šå¸¸ç‰¹å®šäºç‰¹å®šç‰ˆæœ¬æˆ–å¹³å°ã€‚</li>
</ol>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œç›¸å¯¹äº <code>python setup.py sdist bdist_wheel</code> å‘½ä»¤ï¼Œ<code>python -m build</code> æä¾›äº†ä¸€ç§æ›´ç®€å•ã€æ›´ç°ä»£ã€æ›´çµæ´»çš„æ„å»º Python åŒ…çš„æ–¹å¼ï¼Œå…·æœ‰æ›´å¥½çš„æ€§èƒ½å’Œå…¼å®¹æ€§ã€‚ä¸è¿‡ï¼Œ<code>python setup.py sdist bdist_wheel</code> å‘½ä»¤ä»ç„¶æ˜¯æ„å»ºè½¯ä»¶åŒ…çš„å¸¸ç”¨å’Œå¾—åˆ°å¹¿æ³›æ”¯æŒçš„æ–¹æ³•ï¼Œç‰¹åˆ«æ˜¯å¯¹äºè¾ƒè€çš„é¡¹ç›®æˆ–å…·æœ‰æ›´å¤æ‚è¦æ±‚çš„é¡¹ç›®è€Œè¨€ã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>ã€ŠEffective Java 3ã€‹ç¬”è®°9ï¼šä½¿ç”¨ try-with-resources ä¼˜äº try-finally</title>
      <link>https://blog.chensoul.com/posts/2023/05/08/prefer-try-with-resources-to-try-finally/</link>
      <pubDate>Mon, 08 May 2023 10:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/05/08/prefer-try-with-resources-to-try-finally/</guid>
      <description>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼šä½¿ç”¨ try-with-resources ä¼˜äº try-finallyã€‚ ä»‹ç» Java åº“åŒ…å«è®¸å¤šå¿…é¡»é€šè¿‡è°ƒç”¨ close æ–¹æ³•æ‰‹åŠ¨å…³é—­çš„èµ„æºã€‚å¸¸è§çš„</description>
      <content:encoded><![CDATA[<p>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼šä½¿ç”¨ try-with-resources ä¼˜äº try-finallyã€‚</p>
<h2 id="ä»‹ç»">ä»‹ç»</h2>
<p>Java åº“åŒ…å«è®¸å¤šå¿…é¡»é€šè¿‡è°ƒç”¨ close æ–¹æ³•æ‰‹åŠ¨å…³é—­çš„èµ„æºã€‚å¸¸è§çš„æœ‰ InputStreamã€OutputStream å’Œ java.sql.Connectionã€‚å…³é—­èµ„æºå¸¸å¸¸ä¼šè¢«å®¢æˆ·ç«¯å¿½ç•¥ï¼Œè¿™ä¼šå¯¼è‡´å¯æ€•çš„æ€§èƒ½åæœã€‚è™½ç„¶è¿™äº›èµ„æºä¸­çš„è®¸å¤šéƒ½ä½¿ç”¨ç»ˆç»“å™¨ä½œä¸ºå®‰å…¨ç½‘ï¼Œä½†ç»ˆç»“å™¨å¹¶ä¸èƒ½å¾ˆå¥½åœ°å·¥ä½œã€‚</p>
<p>ä»å†å²ä¸Šçœ‹ï¼Œtry-finally è¯­å¥æ˜¯ç¡®ä¿æ­£ç¡®å…³é—­èµ„æºçš„æœ€ä½³æ–¹æ³•ï¼Œå³ä½¿åœ¨å‡ºç°å¼‚å¸¸æˆ–è¿”å›æ—¶ä¹Ÿæ˜¯å¦‚æ­¤ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// try-finally - No longer the best way to close resources!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">static</span> <span class="n">String</span> <span class="nf">firstLineOfFile</span><span class="o">(</span><span class="n">String</span> <span class="n">path</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">BufferedReader</span> <span class="n">br</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="n">path</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">br</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>è¿™å¯èƒ½çœ‹èµ·æ¥ä¸åï¼Œä½†æ·»åŠ ç¬¬äºŒä¸ªèµ„æºæ—¶ï¼Œæƒ…å†µä¼šå˜å¾—æ›´ç³Ÿï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// try-finally is ugly when used with more than one resource!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">static</span> <span class="kt">void</span> <span class="nf">copy</span><span class="o">(</span><span class="n">String</span> <span class="n">src</span><span class="o">,</span> <span class="n">String</span> <span class="n">dst</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">InputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="n">src</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">OutputStream</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileOutputStream</span><span class="o">(</span><span class="n">dst</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="kt">byte</span><span class="o">[]</span> <span class="n">buf</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">BUFFER_SIZE</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">            <span class="kt">int</span> <span class="n">n</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">while</span> <span class="o">((</span><span class="n">n</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">buf</span><span class="o">))</span> <span class="o">&gt;=</span> <span class="n">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">buf</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">n</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">out</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">finally</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">in</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ä½¿ç”¨ try-finally è¯­å¥å…³é—­èµ„æºçš„æ­£ç¡®ä»£ç ï¼ˆå¦‚å‰ä¸¤ä¸ªä»£ç ç¤ºä¾‹æ‰€ç¤ºï¼‰ä¹Ÿæœ‰ä¸€ä¸ªç»†å¾®çš„ç¼ºé™·ã€‚try å—å’Œ finally å—ä¸­çš„ä»£ç éƒ½èƒ½å¤ŸæŠ›å‡ºå¼‚å¸¸ã€‚ä¾‹å¦‚ï¼Œåœ¨ firstLineOfFile æ–¹æ³•ä¸­ï¼Œç”±äºåº•å±‚ç‰©ç†è®¾å¤‡å‘ç”Ÿæ•…éšœï¼Œå¯¹ readLine çš„è°ƒç”¨å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œå…³é—­çš„è°ƒç”¨ä¹Ÿå¯èƒ½å‡ºäºåŒæ ·çš„åŸå› è€Œå¤±è´¥ã€‚<code>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¬¬äºŒä¸ªå¼‚å¸¸å°†å®Œå…¨è¦†ç›–ç¬¬ä¸€ä¸ªå¼‚å¸¸</code>ã€‚å¼‚å¸¸å †æ ˆè·Ÿè¸ªä¸­æ²¡æœ‰ç¬¬ä¸€ä¸ªå¼‚å¸¸çš„è®°å½•ï¼Œè¿™å¯èƒ½ä¼šä½¿å®é™…ç³»ç»Ÿä¸­çš„è°ƒè¯•å˜å¾—éå¸¸å¤æ‚ï¼ˆè€Œè¿™å¯èƒ½æ˜¯å¸Œæœ›å‡ºç°çš„ç¬¬ä¸€ä¸ªå¼‚å¸¸ï¼Œä»¥ä¾¿è¯Šæ–­é—®é¢˜ï¼‰ã€‚è™½ç„¶å¯ä»¥é€šè¿‡ç¼–å†™ä»£ç æ¥æŠ‘åˆ¶ç¬¬äºŒä¸ªå¼‚å¸¸è€Œæ”¯æŒç¬¬ä¸€ä¸ªå¼‚å¸¸ï¼Œä½†å®é™…ä¸Šæ²¡æœ‰äººè¿™æ ·åšï¼Œå› ä¸ºå®ƒå¤ªè¿‡å†—é•¿ã€‚</p>
<p>å½“ Java 7 å¼•å…¥ try-with-resources è¯­å¥æ—¶ï¼Œæ‰€æœ‰è¿™äº›é—®é¢˜éƒ½ä¸€æ¬¡æ€§è§£å†³äº†ã€‚è¦ä½¿ç”¨è¿™ä¸ªç»“æ„ï¼Œèµ„æºå¿…é¡»å®ç° AutoCloseable æ¥å£ï¼Œå®ƒç”±ä¸€ä¸ªå•ç‹¬çš„ void-return close æ–¹æ³•ç»„æˆã€‚Java åº“å’Œç¬¬ä¸‰æ–¹åº“ä¸­çš„è®¸å¤šç±»å’Œæ¥å£ç°åœ¨éƒ½å®ç°æˆ–æ‰©å±•äº† AutoCloseableã€‚å¦‚æœä½ ç¼–å†™çš„ç±»å­˜åœ¨å¿…é¡»å…³é—­çš„èµ„æºï¼Œé‚£ä¹ˆä¹Ÿåº”è¯¥å®ç° AutoCloseableã€‚</p>
<p>ä¸‹é¢æ˜¯ä½¿ç”¨ try-with-resources çš„ç¬¬ä¸€ä¸ªç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// try-with-resources - the the best way to close resources!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">static</span> <span class="n">String</span> <span class="nf">firstLineOfFile</span><span class="o">(</span><span class="n">String</span> <span class="n">path</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="o">(</span><span class="n">BufferedReader</span> <span class="n">br</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="n">path</span><span class="o">)))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ä¸‹é¢æ˜¯ä½¿ç”¨ try-with-resources çš„ç¬¬äºŒä¸ªç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// try-with-resources on multiple resources - short and sweet
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">static</span> <span class="kt">void</span> <span class="nf">copy</span><span class="o">(</span><span class="n">String</span> <span class="n">src</span><span class="o">,</span> <span class="n">String</span> <span class="n">dst</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="o">(</span><span class="n">InputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="n">src</span><span class="o">);</span><span class="n">OutputStream</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileOutputStream</span><span class="o">(</span><span class="n">dst</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">byte</span><span class="o">[]</span> <span class="n">buf</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">BUFFER_SIZE</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">n</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="o">((</span><span class="n">n</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">buf</span><span class="o">))</span> <span class="o">&gt;=</span> <span class="n">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">buf</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">n</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>å’Œä½¿ç”¨ try-finally çš„åŸç‰ˆä»£ç ç›¸æ¯”ï¼Œtry-with-resources ä¸ºå¼€å‘è€…æä¾›äº†æ›´å¥½çš„è¯Šæ–­æ–¹å¼ã€‚è€ƒè™‘ firstLineOfFile æ–¹æ³•ã€‚å¦‚æœå¼‚å¸¸æ˜¯ç”± readLine è°ƒç”¨å’Œä¸å¯è§çš„ close æŠ›å‡ºçš„ï¼Œåˆ™åä¸€ä¸ªå¼‚å¸¸å°†è¢«æŠ‘åˆ¶ï¼Œä»¥æ”¯æŒå‰ä¸€ä¸ªå¼‚å¸¸ã€‚å®é™…ä¸Šï¼Œè¿˜å¯èƒ½ä¼šæŠ‘åˆ¶å¤šä¸ªå¼‚å¸¸ï¼Œä»¥ä¿ç•™å®é™…å¸Œæœ›çœ‹åˆ°çš„å¼‚å¸¸ã€‚è¿™äº›è¢«æŠ‘åˆ¶çš„å¼‚å¸¸ä¸ä¼šä»…ä»…è¢«æŠ›å¼ƒï¼›å®ƒä»¬ä¼šè¢«æ‰“å°åœ¨å †æ ˆè·Ÿè¸ªä¸­ï¼Œå¹¶æ ‡è®°å®ƒä»¬è¢«æŠ‘åˆ¶ã€‚å¯ä»¥é€šè¿‡ç¼–ç¨‹æ–¹å¼ä½¿ç”¨ getSuppressed æ–¹æ³•è®¿é—®åˆ°å®ƒä»¬ï¼Œè¯¥æ–¹æ³•æ˜¯åœ¨ Java 7 ä¸­æ·»åŠ åˆ° Throwable ä¸­çš„ã€‚</p>
<p>å¯ä»¥åœ¨å¸¦æœ‰èµ„æºçš„ try-with-resources è¯­å¥ä¸­æ”¾ç½® catch å­å¥ï¼Œå°±åƒåœ¨å¸¸è§„çš„ try-finally è¯­å¥ä¸Šä¸€æ ·ã€‚è¿™å…è®¸å¤„ç†å¼‚å¸¸æ—¶ä¸å¿…ç”¨å¦ä¸€å±‚åµŒå¥—æ¥å½±å“ä»£ç ã€‚ä½œä¸ºä¸€ä¸ªç‰¹æŒ‡çš„ç¤ºä¾‹ï¼Œä¸‹é¢æ˜¯æˆ‘ä»¬çš„ firstLineOfFile æ–¹æ³•çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒä¸æŠ›å‡ºå¼‚å¸¸ï¼Œä½†å¦‚æœæ— æ³•æ‰“å¼€æ–‡ä»¶æˆ–ä»ä¸­è¯»å–æ–‡ä»¶ï¼Œåˆ™è¿”å›ä¸€ä¸ªé»˜è®¤å€¼ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// try-with-resources with a catch clause
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">static</span> <span class="n">String</span> <span class="nf">firstLineOfFile</span><span class="o">(</span><span class="n">String</span> <span class="n">path</span><span class="o">,</span> <span class="n">String</span> <span class="n">defaultVal</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span> <span class="o">(</span><span class="n">BufferedReader</span> <span class="n">br</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">FileReader</span><span class="o">(</span><span class="n">path</span><span class="o">)))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">defaultVal</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h2 id="æ‰©å±•">æ‰©å±•</h2>
<p><code>try-with-resources</code> è¯­å¥æ˜¯ Java 7 ä¸­å¼•å…¥çš„ä¸€ç§æ–°è¯­æ³•ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†ç®€åŒ–èµ„æºç®¡ç†çš„ä»£ç ï¼Œå¹¶ç¡®ä¿èµ„æºè¢«æ­£ç¡®åœ°å…³é—­ï¼Œé¿å…äº†èµ„æºæ³„æ¼å’Œå¼‚å¸¸å¤„ç†çš„é—®é¢˜ã€‚</p>
<p>åœ¨ Java ä¸­ï¼Œå½“ä½¿ç”¨ä¸€äº›éœ€è¦æ‰‹åŠ¨é‡Šæ”¾èµ„æºçš„ç±»æ—¶ï¼Œä¾‹å¦‚ I/O æµã€æ•°æ®åº“è¿æ¥ç­‰ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä»£ç ä¸­æ˜¾å¼åœ°è°ƒç”¨ <code>close()</code> æ–¹æ³•æ¥é‡Šæ”¾èµ„æºã€‚è¿™ç§æ–¹å¼å¯èƒ½ä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚ï¼š</p>
<ol>
<li>å¿˜è®°å…³é—­èµ„æºï¼šå¦‚æœå¼€å‘äººå‘˜å¿˜è®°å…³é—­èµ„æºï¼Œå¯èƒ½ä¼šå¯¼è‡´èµ„æºæ³„æ¼ï¼Œå ç”¨ç³»ç»Ÿèµ„æºï¼Œé™ä½ç³»ç»Ÿæ€§èƒ½ã€‚</li>
<li>å¼‚å¸¸å¤„ç†é—®é¢˜ï¼šå¦‚æœåœ¨å…³é—­èµ„æºä¹‹å‰å‘ç”Ÿå¼‚å¸¸ï¼Œå¯èƒ½ä¼šå¯¼è‡´èµ„æºæœªèƒ½æ­£ç¡®å…³é—­ï¼Œè¿›ä¸€æ­¥å¯¼è‡´èµ„æºæ³„æ¼å’Œå…¶ä»–é—®é¢˜ã€‚</li>
</ol>
<p>ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼ŒJava 7 å¼•å…¥äº† <code>try-with-resources</code> è¯­å¥ã€‚å®ƒæä¾›äº†ä¸€ç§æ›´ç®€æ´ã€æ›´å®‰å…¨ã€æ›´æ˜“è¯»çš„æ–¹å¼æ¥ç®¡ç†èµ„æºçš„å…³é—­ï¼Œé¿å…äº†å¼€å‘äººå‘˜æ‰‹åŠ¨é‡Šæ”¾èµ„æºçš„é—®é¢˜ï¼Œå¹¶ä¸”å¯ä»¥ç¡®ä¿èµ„æºè¢«æ­£ç¡®åœ°å…³é—­ã€‚</p>
<p>ä½¿ç”¨ <code>try-with-resources</code> è¯­å¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†èµ„æºçš„åˆ›å»ºå’Œåˆå§‹åŒ–æ”¾åœ¨ <code>try</code> è¯­å¥çš„æ‹¬å·å†…ï¼Œå®ƒä»¬åœ¨ <code>try</code> å—æ‰§è¡Œç»“æŸåï¼Œä¼šè‡ªåŠ¨å…³é—­èµ„æºã€‚å¦‚æœåœ¨å…³é—­èµ„æºæ—¶å‘ç”Ÿå¼‚å¸¸ï¼Œ<code>try-with-resources</code> è¯­å¥ä¼šè‡ªåŠ¨å¤„ç†å¼‚å¸¸ï¼Œç¡®ä¿æ‰€æœ‰èµ„æºéƒ½è¢«æ­£ç¡®åœ°å…³é—­ã€‚</p>
<p><code>try-with-resources</code> è¯­å¥ä½¿ç”¨ä»¥ä¸‹è¯­æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">try</span> <span class="o">(</span><span class="n">Resource1</span> <span class="n">r1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Resource1</span><span class="o">();</span> <span class="n">Resource2</span> <span class="n">r2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Resource2</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// use r1 and r2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// handle the exception
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>Resource1</code> å’Œ <code>Resource2</code> æ˜¯éœ€è¦åœ¨ä½¿ç”¨åå…³é—­çš„èµ„æºï¼Œå®ƒä»¬å°†åœ¨ <code>try</code> å—ç»“æŸåè‡ªåŠ¨å…³é—­ã€‚å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œ<code>catch</code> å—å°†å¤„ç†å®ƒã€‚</p>
<p><code>Resource1</code> å’Œ <code>Resource2</code> å¿…é¡»å®ç° <code>AutoCloseable</code> æ¥å£ï¼Œè¯¥æ¥å£å®šä¹‰äº† <code>close()</code> æ–¹æ³•ï¼Œç”¨äºå…³é—­èµ„æºã€‚å½“ <code>try</code> å—ç»“æŸæ—¶ï¼Œ<code>close()</code> æ–¹æ³•å°†è‡ªåŠ¨è¢«è°ƒç”¨ï¼Œä»¥ä¾¿å…³é—­èµ„æºã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>try-with-resources</code> è¯­å¥å¯ä»¥åŒæ—¶ç®¡ç†å¤šä¸ªèµ„æºï¼Œèµ„æºçš„åˆ›å»ºå’Œåˆå§‹åŒ–åº”è¯¥åœ¨ <code>try</code> è¯­å¥çš„æ‹¬å·å†…å®Œæˆã€‚</p>
<p><code>try-with-resources</code> è¯­å¥æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p>
<ol>
<li>ç®€æ´æ€§ï¼š<code>try-with-resources</code> è¯­å¥å¯ä»¥è®©ä»£ç æ›´ç®€æ´ï¼Œä¸éœ€è¦æ˜¾å¼åœ°è°ƒç”¨ <code>close()</code> æ–¹æ³•ã€‚</li>
<li>å®‰å…¨æ€§ï¼š<code>try-with-resources</code> è¯­å¥å¯ä»¥ç¡®ä¿èµ„æºè¢«æ­£ç¡®åœ°å…³é—­ï¼Œé¿å…äº†èµ„æºæ³„æ¼å’Œå¼‚å¸¸å¤„ç†çš„é—®é¢˜ã€‚</li>
<li>å¯è¯»æ€§ï¼š<code>try-with-resources</code> è¯­å¥å¯ä»¥è®©ä»£ç æ›´æ˜“è¯»ï¼Œæ›´å®¹æ˜“ç†è§£èµ„æºçš„ä½¿ç”¨å’Œç®¡ç†ã€‚</li>
</ol>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>try-with-resources</code> è¯­å¥åªèƒ½ç”¨äºç®¡ç†å®ç°äº† <code>AutoCloseable</code> æ¥å£çš„èµ„æºï¼Œå¹¶ä¸”åªæœ‰åœ¨ Java 7 åŠä»¥ä¸Šç‰ˆæœ¬æ‰æ”¯æŒè¯¥è¯­æ³•ã€‚</p>
<p>é™¤äº† I/O æµå’Œæ•°æ®åº“è¿æ¥ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›ç±»éœ€è¦æ‰‹åŠ¨é‡Šæ”¾èµ„æºï¼Œä¾‹å¦‚ï¼š</p>
<ol>
<li>å›¾å½¢ç•Œé¢ç»„ä»¶ï¼šåœ¨ä½¿ç”¨å›¾å½¢ç•Œé¢ç»„ä»¶æ—¶ï¼Œä¾‹å¦‚çª—å£ã€å¯¹è¯æ¡†ã€é¢æ¿ç­‰ï¼Œéœ€è¦æ‰‹åŠ¨é‡Šæ”¾èµ„æºï¼Œä¾‹å¦‚å…³é—­çª—å£ã€é‡Šæ”¾å›¾å½¢èµ„æºç­‰ã€‚</li>
<li>çº¿ç¨‹ï¼šåœ¨ä½¿ç”¨çº¿ç¨‹æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨åœæ­¢çº¿ç¨‹ï¼Œé‡Šæ”¾çº¿ç¨‹å ç”¨çš„ç³»ç»Ÿèµ„æºã€‚</li>
<li>Socket å’Œ ServerSocketï¼šåœ¨ä½¿ç”¨ Socket å’Œ ServerSocket æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨å…³é—­å®ƒä»¬ï¼Œä»¥ä¾¿é‡Šæ”¾ç½‘ç»œèµ„æºã€‚</li>
<li>æ–‡ä»¶å¥æŸ„ï¼šåœ¨ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿæ—¶ï¼Œéœ€è¦æ‰‹åŠ¨å…³é—­æ–‡ä»¶å¥æŸ„ï¼Œä»¥ä¾¿é‡Šæ”¾ç³»ç»Ÿèµ„æºã€‚</li>
<li>JDBC Statement å’Œ ResultSetï¼šåœ¨ä½¿ç”¨ JDBC æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨å…³é—­ Statement å’Œ ResultSet å¯¹è±¡ï¼Œä»¥ä¾¿é‡Šæ”¾æ•°æ®åº“èµ„æºã€‚</li>
<li>JNI èµ„æºï¼šåœ¨ä½¿ç”¨ JNI è°ƒç”¨æœ¬åœ°æ–¹æ³•æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨é‡Šæ”¾ JNI èµ„æºï¼Œä¾‹å¦‚ C/C++ ä¸­çš„å†…å­˜å’Œæ–‡ä»¶å¥æŸ„ç­‰ã€‚</li>
</ol>
]]></content:encoded>
    </item>
    
    <item>
      <title>ã€ŠEffective Java 3ã€‹ç¬”è®°8ï¼šé¿å…ä½¿ç”¨ç»ˆç»“å™¨å’Œæ¸…é™¤å™¨</title>
      <link>https://blog.chensoul.com/posts/2023/05/08/avoid-finalizers-and-cleaners/</link>
      <pubDate>Mon, 08 May 2023 09:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/05/08/avoid-finalizers-and-cleaners/</guid>
      <description>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼šé¿å…ä½¿ç”¨ç»ˆç»“å™¨å’Œæ¸…é™¤å™¨ã€‚ ä»‹ç» ç»ˆç»“å™¨æ˜¯ä¸å¯é¢„æµ‹çš„ã€å¸¸å¸¸æ˜¯å±é™©çš„ï¼Œé€šå¸¸ä¹Ÿæ˜¯ä¸å¿…è¦çš„ã€‚ å®ƒä»¬çš„ä½¿ç”¨</description>
      <content:encoded><![CDATA[<p>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼šé¿å…ä½¿ç”¨ç»ˆç»“å™¨å’Œæ¸…é™¤å™¨ã€‚</p>
<h2 id="ä»‹ç»">ä»‹ç»</h2>
<p><strong>ç»ˆç»“å™¨æ˜¯ä¸å¯é¢„æµ‹çš„ã€å¸¸å¸¸æ˜¯å±é™©çš„ï¼Œé€šå¸¸ä¹Ÿæ˜¯ä¸å¿…è¦çš„ã€‚</strong> å®ƒä»¬çš„ä½¿ç”¨å¯èƒ½å¯¼è‡´ä¸ç¨³å®šçš„è¡Œä¸ºã€ä½æ•ˆç‡å’Œå¯ç§»æ¤æ€§é—®é¢˜ã€‚ç»ˆç»“å™¨æœ‰ä¸€äº›æœ‰æ•ˆçš„ç”¨é€”ï¼Œæˆ‘ä»¬ç¨åä¼šä»‹ç»ï¼Œä½†é€šå¸¸æƒ…å†µä¸‹åº”è¯¥é¿å…ä½¿ç”¨å®ƒä»¬ã€‚ä» Java 9 å¼€å§‹ï¼Œç»ˆç»“å™¨å·²ç»è¢«å¼ƒç”¨ï¼Œä½†å®ƒä»¬ä»ç„¶è¢« Java åº“ä½¿ç”¨ã€‚Java 9 ä¸­ç»ˆç»“å™¨çš„æ›¿ä»£å“æ˜¯æ¸…é™¤å™¨ã€‚ <strong>æ¸…é™¤å™¨çš„å±é™©æ¯”ç»ˆç»“å™¨å°ï¼Œä½†ä»ç„¶ä¸å¯é¢„æµ‹ã€ç¼“æ…¢ï¼Œè€Œä¸”é€šå¸¸æ˜¯ä¸å¿…è¦çš„ã€‚</strong></p>
<blockquote>
<p>ç»ˆç»“å™¨æ˜¯é€šè¿‡åœ¨å¯¹è±¡ä¸Šå®ç° <code>finalize()</code> æ–¹æ³•æ¥å®ç°çš„ï¼Œè€Œæ¸…é™¤å™¨æ˜¯é€šè¿‡ä½¿ç”¨ <code>Cleaner</code> ç±»æ¥å®ç°çš„ã€‚å®ƒä»¬çš„å·¥ä½œæ–¹å¼æœ‰æ‰€ä¸åŒï¼š</p>
<ul>
<li>
<p>ç»ˆç»“å™¨æ˜¯ç”±åƒåœ¾å›æ”¶å™¨è‡ªåŠ¨æ‰§è¡Œçš„ï¼Œæ— æ³•é¢„æµ‹ä½•æ—¶æ‰§è¡Œï¼Œä¹Ÿæ— æ³•ä¿è¯ä¸€å®šä¼šæ‰§è¡Œã€‚å½“åƒåœ¾å›æ”¶å™¨å†³å®šå°†å¯¹è±¡å›æ”¶æ—¶ï¼Œå®ƒä¼šè°ƒç”¨å¯¹è±¡çš„ <code>finalize()</code> æ–¹æ³•ï¼Œä»¥ä¾¿å¯¹è±¡åœ¨è¢«é”€æ¯ä¹‹å‰æ‰§è¡Œä¸€äº›æ¸…ç†æ“ä½œã€‚</p>
</li>
<li>
<p>æ¸…é™¤å™¨æ˜¯ç”± Java 9 è™šæ‹Ÿæœºé€šè¿‡å¼•ç”¨é˜Ÿåˆ—å’Œ <code>Cleaner</code> å¯¹è±¡æ‰§è¡Œçš„ï¼Œå¯ä»¥åœ¨å¯¹è±¡è¢«å›æ”¶ä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œã€‚åœ¨å¯¹è±¡è¢«åƒåœ¾å›æ”¶ä¹‹å‰ï¼ŒJava è™šæ‹Ÿæœºä¼šå°†è¯¥å¯¹è±¡çš„å¼•ç”¨æ·»åŠ åˆ°ä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œç„¶ååœ¨æŸäº›æ—¶åˆ»ï¼ŒJava è™šæ‹Ÿæœºä¼šåˆ›å»ºä¸€ä¸ª <code>Cleaner</code> å¯¹è±¡ï¼Œå¹¶å°†è¯¥å¼•ç”¨é˜Ÿåˆ—ä¸ <code>Cleaner</code> å¯¹è±¡å…³è”èµ·æ¥ã€‚å½“è¯¥å¯¹è±¡è¢«åƒåœ¾å›æ”¶æ—¶ï¼Œå®ƒçš„å¼•ç”¨å°†è¢«æ·»åŠ åˆ°ä¸ <code>Cleaner</code> å¯¹è±¡å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œ<code>Cleaner</code> å¯¹è±¡ä¼šåœ¨æŸäº›æ—¶åˆ»è‡ªåŠ¨æ‰§è¡Œï¼Œä»¥ä¾¿å¯¹è±¡åœ¨è¢«é”€æ¯ä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œä¸€äº›æ¸…ç†æ“ä½œã€‚</p>
</li>
<li>
<p>åœ¨ Java 9 ä¸­ï¼Œå¼•å…¥äº† <code>java.lang.ref.Cleaner</code> ç±»ï¼Œä½œä¸ºç»ˆç»“å™¨çš„æ›¿ä»£å“ï¼Œç”¨äºæ‰§è¡Œå¯¹è±¡æ¸…ç†æ“ä½œã€‚ç›¸æ¯”ç»ˆç»“å™¨ï¼ŒCleaner å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p>
<ol>
<li>æ˜¾å¼ç®¡ç†ï¼šCleaner ä½¿ç”¨æ˜ç¡®çš„ä»£ç è·¯å¾„æ¥ç®¡ç†æ¸…ç†æ“ä½œï¼Œè€Œä¸æ˜¯ä½¿ç”¨éšå¼çš„ç»ˆç»“å™¨æœºåˆ¶ã€‚</li>
<li>å¯æ§æ€§ï¼šCleaner å…è®¸å¼€å‘äººå‘˜æ§åˆ¶ä½•æ—¶æ‰§è¡Œæ¸…ç†æ“ä½œï¼Œè€Œä¸æ˜¯å®Œå…¨ä¾èµ–äºåƒåœ¾å›æ”¶å™¨çš„è¡Œä¸ºã€‚</li>
<li>å®‰å…¨æ€§ï¼šCleaner æ‰§è¡Œæ¸…ç†æ“ä½œæ—¶ï¼Œä¼šç¡®ä¿ç±»åŠ è½½å™¨å·²å‡†å¤‡å¥½ï¼Œå› æ­¤å¯ä»¥å®‰å…¨åœ°æ‰§è¡Œæœ¬åœ°æ¸…ç†æ“ä½œã€‚</li>
</ol>
<p>Cleaner é€šè¿‡æ³¨å†Œä¸€ä¸ªä»»åŠ¡æ¥æ‰§è¡Œæ¸…ç†æ“ä½œã€‚è¯¥ä»»åŠ¡å¯ä»¥æ˜¯ Runnable æˆ–è€…ç»§æ‰¿è‡ª PhantomReference ç±»çš„å­ç±»å¯¹è±¡ã€‚å½“å¯¹è±¡è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶æ—¶ï¼ŒCleaner å°†è‡ªåŠ¨æ‰§è¡Œæ³¨å†Œçš„ä»»åŠ¡ã€‚</p>
</li>
</ul>
</blockquote>
<p>ç»ˆç»“å™¨å’Œæ¸…é™¤å™¨çš„ä½¿ç”¨åœºæ™¯éå¸¸æœ‰é™ï¼Œå› ä¸ºå®ƒä»¬çš„æ‰§è¡Œæ—¶é—´ä¸å¯é¢„æµ‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚æ€§èƒ½é—®é¢˜ã€ä¸ç¨³å®šçš„è¡Œä¸ºã€ä½æ•ˆç‡å’Œå¯ç§»æ¤æ€§é—®é¢˜ã€‚</p>
<p>ç»ˆç»“å™¨å’Œæ¸…é™¤å™¨çš„ä¸»è¦é—®é¢˜æ˜¯ï¼š</p>
<ul>
<li>
<p>å®ƒä»¬æ— æ³•å¯é åœ°åŠæ—¶æ‰§è¡Œï¼Œç”šè‡³å¯èƒ½æ ¹æœ¬ä¸ä¼šæ‰§è¡Œã€‚å½“å¯¹è±¡å˜å¾—ä¸å¯è®¿é—®ï¼Œç»ˆç»“å™¨æˆ–æ¸…é™¤å™¨å¯¹å®ƒè¿›è¡Œæ“ä½œçš„æ—¶é—´æ˜¯ä¸ç¡®å®šçš„ã€‚è¿™æ„å‘³ç€æ°¸è¿œä¸åº”è¯¥åœ¨ç»ˆç»“å™¨æˆ–æ¸…é™¤å™¨ä¸­æ‰§è¡Œä»»ä½•å¯¹æ—¶é—´è¦æ±‚å¾ˆä¸¥æ ¼çš„æ“ä½œã€‚ä¾‹å¦‚ï¼Œä¾èµ–ç»ˆç»“å™¨æˆ–æ¸…é™¤å™¨å…³é—­æ–‡ä»¶å°±æ˜¯ä¸€ä¸ªä¸¥é‡é”™è¯¯ï¼Œå› ä¸ºæ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ˜¯æœ‰é™çš„èµ„æºã€‚å¦‚æœç”±äºç³»ç»Ÿåœ¨è¿è¡Œç»ˆç»“å™¨æˆ–æ¸…é™¤å™¨çš„å»¶è¿Ÿå¯¼è‡´è®¸å¤šæ–‡ä»¶å¤„äºæ‰“å¼€çŠ¶æ€ï¼Œç¨‹åºå¯èƒ½ä¼šè¿è¡Œå¤±è´¥ï¼Œå› ä¸ºå®ƒä¸èƒ½å†æ‰“å¼€å…¶ä»–æ–‡ä»¶ã€‚</p>
<p>ç»ˆç»“å™¨çš„å¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œåœ¨ç»ˆç»“æœŸé—´æŠ›å‡ºçš„æœªæ•è·å¼‚å¸¸è¢«å¿½ç•¥ï¼Œè¯¥å¯¹è±¡çš„ç»ˆç»“ç»ˆæ­¢ã€‚æœªæ•è·çš„å¼‚å¸¸å¯èƒ½ä¼šä½¿å…¶ä»–å¯¹è±¡å¤„äºæŸåçŠ¶æ€ã€‚å¦‚æœå¦ä¸€ä¸ªçº¿ç¨‹è¯•å›¾ä½¿ç”¨è¿™æ ·ä¸€ä¸ªæŸåçš„å¯¹è±¡ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä»»æ„çš„ä¸ç¡®å®šæ€§è¡Œä¸ºã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œæœªæ•è·çš„å¼‚å¸¸å°†ç»ˆæ­¢çº¿ç¨‹å¹¶æ‰“å°å †æ ˆè·Ÿè¸ªï¼Œä½†å¦‚æœåœ¨ç»ˆç»“å™¨ä¸­å‡ºç°ï¼Œåˆ™ä¸ä¼šæ‰“å°è­¦å‘Šã€‚æ¸…é™¤å™¨æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºä½¿ç”¨æ¸…é™¤å™¨çš„åº“å¯ä»¥æ§åˆ¶å®ƒçš„çº¿ç¨‹ã€‚</p>
</li>
<li>
<p>å®ƒä»¬å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚ç»ˆç»“å™¨ç”±åƒåœ¾å›æ”¶å™¨æ‰§è¡Œï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­çš„å»¶è¿Ÿã€‚å¦ä¸€æ–¹é¢ï¼Œæ¸…é™¤å™¨ä½¿ç”¨å•ç‹¬çš„çº¿ç¨‹æ‰§è¡Œï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´é¢å¤–çš„å¼€é”€å’ŒåŒæ­¥é—®é¢˜ã€‚</p>
</li>
</ul>
<p>ã€ŠEffective Javaã€‹ç¬¬ä¸‰ç‰ˆå»ºè®®ä½¿ç”¨æ˜¾å¼ç»ˆæ­¢æ–¹æ³•ï¼Œä¾‹å¦‚ <code>close()</code>ï¼Œé‡Šæ”¾ç³»ç»Ÿèµ„æºã€‚å½“åº”ç”¨ç¨‹åºå®Œæˆå¯¹èµ„æºçš„ä½¿ç”¨æ—¶ï¼Œå¯ä»¥æ˜¾å¼è°ƒç”¨è¿™äº›æ–¹æ³•ï¼Œè€Œä¸ä¾èµ–äºåƒåœ¾å›æ”¶å™¨æ¥æ‰§è¡Œå®ƒä»¬ã€‚</p>
<p>å¦‚æœå¿…é¡»ä½¿ç”¨ç»ˆç»“å™¨æˆ–æ¸…é™¤å™¨ï¼Œ ã€ŠEffective Javaã€‹ç¬¬ä¸‰ç‰ˆå»ºè®®ä½¿ç”¨é˜²å¾¡æ€§ç¼–ç¨‹å®ç°å®ƒä»¬ï¼Œå³ä½¿ç”¨ try-finally å—ç¡®ä¿æ‰§è¡Œå…³é”®çš„æ¸…ç†æ“ä½œï¼Œå¹¶é¿å…å¼•ç”¨å…¶ä»–å¯èƒ½å·²è¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡æˆ–èµ„æºã€‚</p>
<h2 id="æ‰©å±•">æ‰©å±•</h2>
<h3 id="systemgc">System.gc()</h3>
<p><code>System.gc()</code> æ–¹æ³•æ˜¯ Java ä¸­çš„ä¸€ç§åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå®ƒå¯ä»¥åœ¨è¯·æ±‚åƒåœ¾å›æ”¶å™¨è¿è¡Œæ—¶å¼ºåˆ¶è¿›è¡Œä¸€æ¬¡åƒåœ¾å›æ”¶ã€‚</p>
<p><code>System.gc()</code> æ–¹æ³•ä¸æ˜¯å¼ºåˆ¶åƒåœ¾å›æ”¶çš„æ–¹æ³•ï¼Œå› ä¸º Java è™šæ‹Ÿæœºå¯ä»¥å¿½ç•¥å®ƒã€‚Java ç¼–ç¨‹è¯­è¨€è§„èŒƒè¦æ±‚ <code>System.gc()</code> æ–¹æ³•åªæ˜¯ä¸€ä¸ªå»ºè®®ï¼Œä¸èƒ½ä¿è¯å®ƒä¸€å®šä¼šå¯¼è‡´åƒåœ¾å›æ”¶å™¨è¿è¡Œã€‚å› æ­¤ï¼Œå®ƒä¸åº”è¯¥è¢«é¢‘ç¹åœ°è°ƒç”¨ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚</p>
<p><code>System.gc()</code> æ–¹æ³•çš„ä½¿ç”¨åœºæ™¯éå¸¸æœ‰é™ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œåº”è¯¥è®©åƒåœ¾å›æ”¶å™¨è‡ªè¡Œç®¡ç†å†…å­˜ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ <code>System.gc()</code> æ–¹æ³•æ¥å¼ºåˆ¶è¿›è¡Œåƒåœ¾å›æ”¶ã€‚å¦‚æœéœ€è¦ç¡®ä¿æŸäº›å¯¹è±¡åœ¨åƒåœ¾å›æ”¶ä¹‹å‰è¢«é‡Šæ”¾ï¼Œå¯ä»¥ä½¿ç”¨å¼±å¼•ç”¨æˆ–è½¯å¼•ç”¨æ¥ç®¡ç†è¿™äº›å¯¹è±¡ï¼Œæˆ–ä½¿ç”¨æ˜¾å¼ç»ˆæ­¢æ–¹æ³•æ¥é‡Šæ”¾ç³»ç»Ÿèµ„æºã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>System.gc()</code> æ–¹æ³•å¯èƒ½ä¼šè€—è´¹è¾ƒé•¿æ—¶é—´ï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šå¼ºåˆ¶å›æ”¶æ‰€æœ‰æœªä½¿ç”¨çš„å¯¹è±¡ã€‚å› æ­¤ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œåº”è¯¥è°¨æ…ä½¿ç”¨ <code>System.gc()</code> æ–¹æ³•ï¼Œå¹¶ä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨å®ƒã€‚</p>
<h3 id="systemrunfinalization">System.runFinalization()</h3>
<p><code>System.runFinalization()</code> æ–¹æ³•æ˜¯åœ¨ Java 1.2 ç‰ˆæœ¬ä¸­å¼•å…¥çš„ã€‚åœ¨ Java 1.2 ä¸­ï¼Œå¼•å…¥äº†åƒåœ¾å›æ”¶å™¨çš„æ”¹è¿›ï¼ŒåŒ…æ‹¬ä½¿ç”¨å¼•ç”¨ç±»å‹ã€ç»ˆç»“å™¨å’Œåƒåœ¾å›æ”¶å™¨æ€§èƒ½çš„æå‡ã€‚<code>System.runFinalization()</code> æ–¹æ³•ä½œä¸ºç»ˆç»“å™¨æœºåˆ¶çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºç¡®ä¿æ‰€æœ‰å¯¹è±¡çš„<code>finalize()</code> æ–¹æ³•è¢«æ‰§è¡Œã€‚åœ¨åƒåœ¾å›æ”¶å™¨å°†å¯¹è±¡ä»å†…å­˜ä¸­é‡Šæ”¾ä¹‹å‰ï¼Œå¦‚æœè¯¥å¯¹è±¡å…·æœ‰ç»ˆç»“å™¨ï¼Œåˆ™åƒåœ¾å›æ”¶å™¨ä¼šè°ƒç”¨å¯¹è±¡çš„ <code>finalize()</code> æ–¹æ³•ï¼Œä»¥ä¾¿åœ¨å¯¹è±¡è¢«é”€æ¯ä¹‹å‰æ‰§è¡Œä¸€äº›æ¸…ç†æ“ä½œã€‚<code>System.runFinalization()</code> æ–¹æ³•å¯ä»¥ç¡®ä¿æ‰€æœ‰å¯¹è±¡çš„ <code>finalize()</code> æ–¹æ³•è¢«æ‰§è¡Œã€‚</p>
<p><code>System.runFinalization()</code> æ–¹æ³•ä¸æ˜¯å¼ºåˆ¶ç»ˆç»“å™¨æ‰§è¡Œçš„æ–¹æ³•ï¼Œå› ä¸º Java è™šæ‹Ÿæœºå¯ä»¥å¿½ç•¥å®ƒã€‚Java ç¼–ç¨‹è¯­è¨€è§„èŒƒè¦æ±‚ <code>System.runFinalization()</code> æ–¹æ³•åªæ˜¯ä¸€ä¸ªå»ºè®®ï¼Œä¸èƒ½ä¿è¯å®ƒä¸€å®šä¼šå¯¼è‡´ç»ˆç»“å™¨æ‰§è¡Œã€‚å› æ­¤ï¼Œå®ƒä¸åº”è¯¥è¢«é¢‘ç¹åœ°è°ƒç”¨ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚</p>
<p><code>System.runFinalization()</code> æ–¹æ³•çš„ä½¿ç”¨åœºæ™¯éå¸¸æœ‰é™ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œåº”è¯¥é¿å…ä½¿ç”¨ç»ˆç»“å™¨æ¥æ‰§è¡Œæ¸…ç†æ“ä½œï¼Œå› ä¸ºç»ˆç»“å™¨çš„æ‰§è¡Œæ—¶é—´ä¸å¯é¢„æµ‹ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚æ€§èƒ½é—®é¢˜ã€ä¸ç¨³å®šçš„è¡Œä¸ºã€ä½æ•ˆç‡å’Œå¯ç§»æ¤æ€§é—®é¢˜ã€‚ç›¸åï¼Œåº”è¯¥ä½¿ç”¨æ˜¾å¼ç»ˆæ­¢æ–¹æ³•æ¥é‡Šæ”¾ç³»ç»Ÿèµ„æºã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>System.runFinalization()</code> æ–¹æ³•å¯èƒ½ä¼šè€—è´¹è¾ƒé•¿æ—¶é—´ï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šæ‰§è¡Œæ‰€æœ‰å¯¹è±¡çš„ç»ˆç»“å™¨ã€‚å› æ­¤ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œåº”è¯¥è°¨æ…ä½¿ç”¨ <code>System.runFinalization()</code> æ–¹æ³•ï¼Œå¹¶ä»…åœ¨å¿…è¦æ—¶ä½¿ç”¨å®ƒ</p>
<h3 id="æ¸…é™¤å™¨å’Œç»ˆç»“å™¨ä½¿ç”¨åœºæ™¯">æ¸…é™¤å™¨å’Œç»ˆç»“å™¨ä½¿ç”¨åœºæ™¯</h3>
<p>ä½¿ç”¨æ¸…é™¤å™¨å’Œç»ˆç»“å™¨çš„ä¾‹å­å¹¶ä¸å¸¸è§ï¼Œå› ä¸ºå®ƒä»¬çš„ä½¿ç”¨åœºæ™¯éå¸¸æœ‰é™ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½éœ€è¦ä½¿ç”¨æ¸…é™¤å™¨å’Œç»ˆç»“å™¨çš„åœºæ™¯ï¼š</p>
<ul>
<li>åœ¨ Java 8 åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œ<code>java.sql.Connection</code> ç±»ä¸­çš„ <code>finalize()</code> æ–¹æ³•è¢«ç”¨äºå…³é—­æ•°æ®åº“è¿æ¥ã€‚åœ¨ Java 9 ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•è¢«å¼ƒç”¨ï¼Œå› ä¸ºç»ˆç»“å™¨çš„ä½¿ç”¨ä¸å¯é å’Œå±é™©ã€‚ç›¸åï¼Œ<code>Connection</code> æ¥å£ä¸­æ·»åŠ äº†ä¸€ä¸ª <code>close()</code> æ–¹æ³•ï¼Œåº”è¯¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ¥é‡Šæ”¾æ•°æ®åº“è¿æ¥ã€‚</li>
<li>åœ¨ Java 9 ä¸­ï¼Œ<code>java.lang.ref.Cleaner</code> ç±»è¢«å¼•å…¥ä½œä¸ºç»ˆç»“å™¨çš„æ›¿ä»£å“ï¼Œå¯ä»¥ç”¨äºæ‰§è¡Œå¯¹è±¡æ¸…ç†æ“ä½œã€‚ä¾‹å¦‚ï¼Œå¦‚æœéœ€è¦åœ¨å¯¹è±¡è¢«åƒåœ¾å›æ”¶ä¹‹å‰æ‰§è¡Œä¸€äº›æ¸…ç†æ“ä½œï¼ˆä¾‹å¦‚é‡Šæ”¾æœ¬åœ°å†…å­˜æˆ–å…³é—­æ–‡ä»¶å¥æŸ„ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ <code>Cleaner</code> ç±»æ¥å®ç°ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ <code>Cleaner</code> ç±»çš„ç®€å•ç¤ºä¾‹ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Resource</span> <span class="kd">implements</span> <span class="n">AutoCloseable</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Cleaner</span> <span class="n">cleaner</span> <span class="o">=</span> <span class="n">Cleaner</span><span class="o">.</span><span class="na">create</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">File</span> <span class="n">file</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">Resource</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">file</span> <span class="o">=</span> <span class="n">file</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">cleaner</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="k">new</span> <span class="n">CleanupTask</span><span class="o">(</span><span class="n">file</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">close</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// release any resources held by this object
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">CleanupTask</span> <span class="kd">implements</span> <span class="n">Runnable</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="kd">final</span> <span class="n">File</span> <span class="n">file</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="nf">CleanupTask</span><span class="o">(</span><span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">file</span> <span class="o">=</span> <span class="n">file</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// clean up the resource associated with the given file
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>Resource</code> ç±»æŒæœ‰ä¸€ä¸ª <code>File</code> å¯¹è±¡ï¼Œå¹¶åœ¨åˆ›å»ºå¯¹è±¡æ—¶ä½¿ç”¨ <code>Cleaner</code> ç±»æ³¨å†Œäº†ä¸€ä¸ª <code>CleanupTask</code> å¯¹è±¡ã€‚å½“ <code>Resource</code> å¯¹è±¡è¢«åƒåœ¾å›æ”¶æ—¶ï¼Œ<code>Cleaner</code> å¯¹è±¡å°†è‡ªåŠ¨è°ƒç”¨ <code>CleanupTask</code> å¯¹è±¡çš„ <code>run()</code> æ–¹æ³•ï¼Œä»¥ä¾¿æ‰§è¡Œ <code>File</code> å¯¹è±¡çš„æ¸…ç†æ“ä½œï¼ˆä¾‹å¦‚å…³é—­æ–‡ä»¶å¥æŸ„ï¼‰ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä»…æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå®é™…ä½¿ç”¨ä¸­éœ€è¦è°¨æ…ä½¿ç”¨å’Œè€ƒè™‘æ¸…é™¤å™¨å’Œç»ˆç»“å™¨çš„å±€é™æ€§ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥é¿å…ä½¿ç”¨å®ƒä»¬ï¼Œä½¿ç”¨æ˜¾å¼ç»ˆæ­¢æ–¹æ³•æ¥é‡Šæ”¾ç³»ç»Ÿèµ„æºã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›ä½¿ç”¨æ˜¾å¼ç»ˆæ­¢æ–¹æ³•çš„ä¾‹å­ï¼š</p>
<ol>
<li>Java I/O ç±»ã€‚Java I/O ç±»é€šå¸¸éœ€è¦ä½¿ç”¨æ˜¾å¼ç»ˆæ­¢æ–¹æ³•æ¥é‡Šæ”¾ç³»ç»Ÿèµ„æºï¼Œä¾‹å¦‚å…³é—­æ–‡ä»¶å¥æŸ„æˆ–ç½‘ç»œè¿æ¥ã€‚ä¾‹å¦‚ï¼Œ<code>java.io.FileInputStream</code> ç±»ä¸­çš„ <code>close()</code> æ–¹æ³•ç”¨äºå…³é—­æ‰“å¼€çš„æ–‡ä»¶ã€‚</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">try</span> <span class="o">(</span><span class="n">FileInputStream</span> <span class="n">fis</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="s">&#34;example.txt&#34;</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// read from the file
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// handle the exception
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½¿ç”¨ <code>try-with-resources</code> è¯­å¥æ¥åˆ›å»º <code>FileInputStream</code> å¯¹è±¡ï¼Œè¿™å°†è‡ªåŠ¨è°ƒç”¨ <code>close()</code> æ–¹æ³•ï¼Œä»¥ä¾¿é‡Šæ”¾æ–‡ä»¶å¥æŸ„ã€‚</p>
<ol start="2">
<li>æ•°æ®åº“è¿æ¥ã€‚æ•°æ®åº“è¿æ¥é€šå¸¸éœ€è¦ä½¿ç”¨æ˜¾å¼ç»ˆæ­¢æ–¹æ³•æ¥é‡Šæ”¾è¿æ¥ã€‚ä¾‹å¦‚ï¼Œ<code>java.sql.Connection</code> æ¥å£ä¸­çš„ <code>close()</code> æ–¹æ³•ç”¨äºå…³é—­æ•°æ®åº“è¿æ¥ã€‚</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">try</span> <span class="o">(</span><span class="n">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="n">user</span><span class="o">,</span> <span class="n">password</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// use the database connection
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// handle the exception
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½¿ç”¨ <code>try-with-resources</code> è¯­å¥æ¥åˆ›å»º <code>Connection</code> å¯¹è±¡ï¼Œè¿™å°†è‡ªåŠ¨è°ƒç”¨ <code>close()</code> æ–¹æ³•ï¼Œä»¥ä¾¿é‡Šæ”¾æ•°æ®åº“è¿æ¥ã€‚</p>
<ol start="3">
<li>çº¿ç¨‹æ± ã€‚çº¿ç¨‹æ± é€šå¸¸éœ€è¦ä½¿ç”¨æ˜¾å¼ç»ˆæ­¢æ–¹æ³•æ¥å…³é—­çº¿ç¨‹æ± ï¼Œä»¥ä¾¿é‡Šæ”¾çº¿ç¨‹èµ„æºã€‚ä¾‹å¦‚ï¼Œ<code>java.util.concurrent.ExecutorService</code> æ¥å£ä¸­çš„ <code>shutdown()</code> æ–¹æ³•ç”¨äºå…³é—­çº¿ç¨‹æ± ã€‚</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ExecutorService</span> <span class="n">executor</span> <span class="o">=</span> <span class="n">Executors</span><span class="o">.</span><span class="na">newFixedThreadPool</span><span class="o">(</span><span class="n">10</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// submit tasks to the executor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">executor</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½¿ç”¨ <code>finally</code> å—æ¥ç¡®ä¿åœ¨æ‰§è¡Œå®Œä»»åŠ¡åå…³é—­çº¿ç¨‹æ± ï¼Œä»¥ä¾¿é‡Šæ”¾çº¿ç¨‹èµ„æºã€‚</p>
<h3 id="å¦‚ä½•é¿å…èµ„æºæ³„æ¼">å¦‚ä½•é¿å…èµ„æºæ³„æ¼ï¼Ÿ</h3>
<p>èµ„æºæ³„æ¼æ˜¯æŒ‡åœ¨ä½¿ç”¨èµ„æºï¼ˆå¦‚æ–‡ä»¶å¥æŸ„ã€ç½‘ç»œè¿æ¥ã€æ•°æ®åº“è¿æ¥ã€çº¿ç¨‹ç­‰ï¼‰æ—¶ï¼Œæ²¡æœ‰æ­£ç¡®åœ°é‡Šæ”¾æˆ–å…³é—­å®ƒä»¬ï¼Œå¯¼è‡´èµ„æºé•¿æ—¶é—´å ç”¨ï¼Œæœ€ç»ˆå¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒæˆ–ç³»ç»Ÿæ€§èƒ½ä¸‹é™ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›é¿å…èµ„æºæ³„æ¼çš„æ–¹æ³•ï¼š</p>
<ol>
<li>ä½¿ç”¨ <code>try-with-resources</code> è¯­å¥ã€‚<code>try-with-resources</code> è¯­å¥æ˜¯ä¸€ç§è‡ªåŠ¨å…³é—­èµ„æºçš„æœºåˆ¶ï¼Œå¯ä»¥ç¡®ä¿åœ¨ä½¿ç”¨å®Œèµ„æºåè‡ªåŠ¨å…³é—­å®ƒä»¬ã€‚ä¾‹å¦‚ï¼š</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">try</span> <span class="o">(</span><span class="n">FileInputStream</span> <span class="n">fis</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="s">&#34;example.txt&#34;</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// read from the file
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// handle the exception
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>FileInputStream</code> å¯¹è±¡å°†åœ¨ <code>try</code> å—ç»“æŸåè‡ªåŠ¨å…³é—­ã€‚</p>
<ol start="2">
<li>
<p>æ˜¾å¼å…³é—­èµ„æºã€‚å¦‚æœä¸èƒ½ä½¿ç”¨ <code>try-with-resources</code> è¯­å¥ï¼Œåº”è¯¥ä½¿ç”¨æ˜¾å¼å…³é—­èµ„æºçš„æ–¹æ³•æ¥é‡Šæ”¾èµ„æºã€‚ä¾‹å¦‚ï¼Œåœ¨ä½¿ç”¨å®Œæ•°æ®åº“è¿æ¥åï¼Œåº”è¯¥è°ƒç”¨ <code>Connection</code> æ¥å£ä¸­çš„ <code>close()</code> æ–¹æ³•æ¥é‡Šæ”¾è¿æ¥ã€‚</p>
</li>
<li>
<p>ä½¿ç”¨é˜²å¾¡æ€§ç¼–ç¨‹ã€‚åœ¨ä½¿ç”¨èµ„æºæ—¶ï¼Œåº”è¯¥ä½¿ç”¨é˜²å¾¡æ€§ç¼–ç¨‹ï¼Œç¡®ä¿åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½èƒ½æ­£ç¡®åœ°é‡Šæ”¾èµ„æºã€‚ä¾‹å¦‚ï¼Œåœ¨ä½¿ç”¨æ–‡ä»¶å¥æŸ„æ—¶ï¼Œåº”è¯¥ç¡®ä¿åœ¨è¯»å–æˆ–å†™å…¥æ–‡ä»¶æ—¶ï¼Œä½¿ç”¨ <code>try-finally</code> å—æ¥ç¡®ä¿åœ¨å‘ç”Ÿå¼‚å¸¸æ—¶å…³é—­æ–‡ä»¶å¥æŸ„ã€‚</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">FileInputStream fis = null;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">try {
</span></span><span class="line"><span class="cl">    fis = new FileInputStream(&#34;example.txt&#34;);
</span></span><span class="line"><span class="cl">    // read from the file
</span></span><span class="line"><span class="cl">} catch (IOException e) {
</span></span><span class="line"><span class="cl">    // handle the exception
</span></span><span class="line"><span class="cl">} finally {
</span></span><span class="line"><span class="cl">    if (fis != null) {
</span></span><span class="line"><span class="cl">        try {
</span></span><span class="line"><span class="cl">            fis.close();
</span></span><span class="line"><span class="cl">        } catch (IOException e) {
</span></span><span class="line"><span class="cl">            // handle the exception
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½¿ç”¨ <code>try-finally</code> å—æ¥ç¡®ä¿åœ¨å‘ç”Ÿå¼‚å¸¸æ—¶å…³é—­æ–‡ä»¶å¥æŸ„ã€‚</p>
<ol start="4">
<li>ä½¿ç”¨èµ„æºç®¡ç†æ¡†æ¶ã€‚ä¸€äº›èµ„æºç®¡ç†æ¡†æ¶ï¼Œä¾‹å¦‚ Apache Commons IO å’Œ Google Guavaï¼Œæä¾›äº†ä¸€äº›å®ç”¨å·¥å…·ç±»å’Œæ–¹æ³•ï¼Œå¯ä»¥å¸®åŠ©é¿å…èµ„æºæ³„æ¼ã€‚</li>
</ol>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>ç»ˆç»“å™¨å’Œæ¸…é™¤å™¨éƒ½æ˜¯ Java ä¸­ç”¨äºå¯¹è±¡æ¸…ç†çš„æœºåˆ¶ï¼Œå®ƒä»¬å„æœ‰ä¼˜ç¼ºç‚¹ã€‚</p>
<p>ç»ˆç»“å™¨çš„ä¼˜ç‚¹ï¼š</p>
<ol>
<li>æ— éœ€æ˜¾å¼è°ƒç”¨ï¼šç»ˆç»“å™¨æ˜¯ä¸€ç§è‡ªåŠ¨çš„æœºåˆ¶ï¼Œæ— éœ€æ˜¾å¼è°ƒç”¨ï¼Œå¯ä»¥åœ¨å¯¹è±¡è¢«åƒåœ¾å›æ”¶æ—¶è‡ªåŠ¨æ‰§è¡Œã€‚</li>
<li>çµæ´»æ€§ï¼šç»ˆç»“å™¨å…è®¸å¼€å‘äººå‘˜ç¼–å†™ä»»æ„çš„æ¸…ç†ä»£ç ï¼Œæ— éœ€è€ƒè™‘æ¸…ç†æ“ä½œçš„æ‰§è¡Œæ—¶é—´æˆ–é¡ºåºã€‚</li>
</ol>
<p>ç»ˆç»“å™¨çš„ç¼ºç‚¹ï¼š</p>
<ol>
<li>ä¸å¯æ§æ€§ï¼šç»ˆç»“å™¨çš„æ‰§è¡Œæ—¶é—´å’Œé¡ºåºæ˜¯ä¸å¯é¢„æµ‹çš„ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é—®é¢˜ï¼Œä¾‹å¦‚æ€§èƒ½é—®é¢˜ã€ä¸ç¨³å®šçš„è¡Œä¸ºã€ä½æ•ˆç‡å’Œå¯ç§»æ¤æ€§é—®é¢˜ã€‚</li>
<li>å®‰å…¨æ€§é—®é¢˜ï¼šç»ˆç»“å™¨å¯èƒ½ä¼šå¼•èµ·ä¸€äº›å®‰å…¨æ€§é—®é¢˜ï¼Œä¾‹å¦‚åœ¨ <code>finalize()</code> æ–¹æ³•ä¸­é‡æ–°å¯åŠ¨çº¿ç¨‹æˆ–æ‰“å¼€æ–‡ä»¶ç­‰ã€‚</li>
</ol>
<p>æ¸…é™¤å™¨çš„ä¼˜ç‚¹ï¼š</p>
<ol>
<li>æ˜ç¡®çš„ä»£ç è·¯å¾„ï¼šæ¸…é™¤å™¨ä½¿ç”¨æ˜ç¡®çš„ä»£ç è·¯å¾„æ¥æ‰§è¡Œæ¸…ç†æ“ä½œï¼Œç›¸æ¯”ç»ˆç»“å™¨ï¼Œå®ƒæ›´åŠ å¯æ§å’Œå®‰å…¨ã€‚</li>
<li>å¯æ§æ€§ï¼šæ¸…é™¤å™¨å…è®¸å¼€å‘äººå‘˜æ§åˆ¶ä½•æ—¶æ‰§è¡Œæ¸…ç†æ“ä½œï¼Œè€Œä¸æ˜¯å®Œå…¨ä¾èµ–äºåƒåœ¾å›æ”¶å™¨çš„è¡Œä¸ºã€‚</li>
<li>å®‰å…¨æ€§ï¼šæ¸…é™¤å™¨æ‰§è¡Œæ¸…ç†æ“ä½œæ—¶ï¼Œä¼šç¡®ä¿ç±»åŠ è½½å™¨å·²å‡†å¤‡å¥½ï¼Œå› æ­¤å¯ä»¥å®‰å…¨åœ°æ‰§è¡Œæœ¬åœ°æ¸…ç†æ“ä½œã€‚</li>
</ol>
<p>æ¸…é™¤å™¨çš„ç¼ºç‚¹ï¼š</p>
<ol>
<li>æ˜¾å¼è°ƒç”¨ï¼šæ¸…é™¤å™¨éœ€è¦æ˜¾å¼è°ƒç”¨ï¼Œå¼€å‘äººå‘˜éœ€è¦ä¸ºæ¯ä¸ªéœ€è¦æ¸…ç†çš„å¯¹è±¡æ³¨å†Œä¸€ä¸ªæ¸…ç†å™¨ï¼Œè¿™å¯èƒ½ä¼šå¢åŠ ä»£ç çš„å¤æ‚æ€§ã€‚</li>
<li>é™åˆ¶æ€§ï¼šæ¸…é™¤å™¨åªèƒ½ç”¨äºæ‰§è¡Œä¸€äº›æ¸…ç†æ“ä½œï¼Œä¸èƒ½ç”¨äºæ‰§è¡Œå…¶ä»–ç±»å‹çš„æ“ä½œã€‚</li>
</ol>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œç»ˆç»“å™¨å’Œæ¸…é™¤å™¨å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œåº”è¯¥æ ¹æ®å®é™…éœ€æ±‚å’Œåœºæ™¯é€‰æ‹©é€‚å½“çš„æœºåˆ¶æ¥ç®¡ç†å¯¹è±¡æ¸…ç†ã€‚<code>ä¸€èˆ¬æ¥è¯´ï¼Œåº”è¯¥ä¼˜å…ˆä½¿ç”¨æ˜¾å¼ç»ˆæ­¢æ–¹æ³•æ¥é‡Šæ”¾ç³»ç»Ÿèµ„æºï¼Œåªæœ‰åœ¨å¿…è¦æ—¶æ‰è€ƒè™‘ä½¿ç”¨ç»ˆç»“å™¨æˆ–æ¸…é™¤å™¨ã€‚</code></p>
]]></content:encoded>
    </item>
    
    <item>
      <title>å‘¨æŠ¥-17ï½œå¯¼å‡ºè‹¹æœå¥åº·æ•°æ®ã€è‡ªåŠ¨åŒ–æ”¶é›†ä¸ªäººæ•°æ®ã€FlexyPoolåŠ¨æ€è¿æ¥æ± </title>
      <link>https://blog.chensoul.com/posts/2023/05/06/weekly_review_17/</link>
      <pubDate>Sat, 06 May 2023 10:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/05/06/weekly_review_17/</guid>
      <description>å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-04-24 åˆ° 2023-04-30 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚ æœ¬å‘¨äºŒæ—©ä¸Šè·‘æ­¥å³å°è…¿æŠ½ç­‹ï¼Œè·‘æ­¥æš‚åœäº†ä¸¤å¤©ï¼Œæ‰€ä»¥æœ‰</description>
      <content:encoded><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p>æœ¬ç¯‡æ˜¯å¯¹ <code>2023-04-24</code> åˆ° <code>2023-04-30</code> è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº <a href="https://blog.chensoul.com/">åšå®¢</a>ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚</p>
<p>æœ¬å‘¨äºŒæ—©ä¸Šè·‘æ­¥å³å°è…¿æŠ½ç­‹ï¼Œè·‘æ­¥æš‚åœäº†ä¸¤å¤©ï¼Œæ‰€ä»¥æœ‰ä¸¤å¤©èµ°è·¯æ²¡æœ‰åˆ°ä¸€ä¸‡æ­¥ã€‚åœ¨å°è…¿æ¢å¤ä¹‹åï¼Œç»§ç»­è·‘æ­¥ï¼ŒæŸ¥çœ‹ strava ä¸Šçš„ç»Ÿè®¡ï¼Œè¿™å‘¨æ€»å…±è·‘äº†27å…¬é‡Œï¼Œæ¯”ä¸Šå‘¨41å…¬é‡Œå°‘äº†14å…¬é‡Œã€‚</p>
<p>è¿™å‘¨ç©ºé—²æ—¶é—´å°±åœ¨æƒ³ï¼Œèƒ½ä¸èƒ½æ¯å¤©è‡ªåŠ¨æ”¶é›†ä¸ªäººçš„ä¸€äº›æ•°æ®ï¼Œæ¯”å¦‚ï¼Œç›®å‰æˆ‘èƒ½æƒ³åˆ°çš„æ•°æ®åŒ…æ‹¬è·‘æ­¥ã€èµ°è·¯ã€ä½“é‡ã€ç¼–ç ã€æ—©èµ·ç­‰ç­‰ã€‚</p>
<p>ç›®å‰æ˜¯ä½¿ç”¨ strava app è®°å½•è·‘æ­¥æ•°æ®ï¼Œé€šè¿‡ <a href="https://github.com/chensoul/running_page">running_page</a> å¯ä»¥å®æ—¶æ”¶é›†æˆ‘çš„æ¯å¤© <a href="https://github.com/chensoul/running_page/blob/master/assets/running.csv">è·‘æ­¥æ•°æ®</a>ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-17-01.png" alt="weekly-review-17-01"  />
</p>
<p>èµ°è·¯ã€ä½“é‡æ•°æ®å¯ä»¥ä»è‹¹æœå¥åº·æ•°æ®è·å–ï¼š</p>
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-17-06.png" alt="weekly-review-17-06" style="width:50%;" />
<p>ç¼–ç æ•°æ®å¯ä»¥ä» wakatime è·å–ï¼š</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-17-02.png" alt="weekly-review-17-02"  />
</p>
<p>æ—©èµ·çš„æ•°æ®ï¼Œæˆ‘ç›®å‰æ˜¯é€šè¿‡ ios workflow è‡ªåŠ¨åŒ–æ¥å®ç°çš„ã€‚å½“æ—©èµ·é—¹é’Ÿå“èµ·æ—¶ï¼Œå¾€ memos å†™å…¥ä¸€æ¡è®°å½•ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-17-08.png" alt="weekly-review-17-08"  />
</p>
<p>å¦‚æœå¯ä»¥è·å–åˆ°è‹¹æœå±å¹•ä½¿ç”¨æ—¶é—´æ•°æ®ï¼Œåˆ™å¯ä»¥ä»è‹¹æœæ‰‹æœºè·å–æ¯æ—¥ç¬¬ä¸€æ¬¡æ‹¿èµ·æ‰‹æœºçš„æ—¶é—´ä½œä¸ºæ—©èµ·æ—¶é—´ï¼ˆå¾…ç ”ç©¶ï¼‰ã€‚</p>
<h2 id="å¯¼å‡ºè‹¹æœå¥åº·æ•°æ®">å¯¼å‡ºè‹¹æœå¥åº·æ•°æ®</h2>
<p>å¦‚ä½•å¯¼å‡ºè‹¹æœå¥åº·æ•°æ®ï¼Ÿå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç«  <a href="https://sspai.com/post/42135">æƒ³è¦åˆ†ææˆ–å¤‡ä»½ iPhone ã€Œå¥åº·ã€åº”ç”¨æ•°æ®ï¼Ÿæ•™ä½  3 ç§æ–¹æ³•å°†å…¶å¯¼å‡º</a> ã€‚è¿™ç¯‡æ–‡ç« æåˆ°çš„ Health Export  å·¥å…·å’Œ python è„šæœ¬æˆ‘éƒ½è¯•è¿‡ï¼ŒQS Access åœ¨æ‰‹æœºä¸Šæ²¡æœ‰æ‰¾åˆ°ã€‚</p>
<h3 id="1-health-export-åœ¨çº¿è§£æ">1. Health Export åœ¨çº¿è§£æ</h3>
<p><a href="https://sspai.com/link?target=http%3A%2F%2Fericwolter.com%2Fprojects%2Fhealth-export.html">Health Export</a> æ˜¯å›½å¤–ä¸€åç‹¬ç«‹å¼€å‘è€…å†™çš„åœ¨çº¿è§£æå·¥å…·ï¼Œå®ƒä¸“é—¨ç”¨äºå°†å¥åº·åº”ç”¨å¯¼å‡ºçš„ XML æ–‡ä»¶è½¬æ¢ä¸º CSV æ–‡ä»¶ã€‚</p>
<p>Health Export æä¾›äº†ä¸€ä¸ª <a href="https://www.ericwolter.com/projects/apple-health-export/">web ç½‘ç«™</a> å¯ä»¥è§£æä¼ è‹¹æœæ‰‹æœºå¯¼å‡ºçš„å¥åº·æ•°æ®ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-17-03.png" alt="weekly-review-17-03"  />
</p>
<p>å¦‚ä½•ä» IPhone æ‰‹æœºå¯¼å‡ºè‹¹æœå¥åº·æ•°æ®å‘¢ï¼Ÿæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤å¯¼å‡ºè¿™äº›æ•°æ®ï¼š</p>
<ol>
<li>æ‰“å¼€â€œå¥åº·â€åº”ç”¨ç¨‹åºã€‚</li>
<li>ç‚¹å‡»å±å¹•å³ä¸Šè§’çš„â€œä¸ªäººèµ„æ–™â€å›¾æ ‡ã€‚</li>
<li>æ»šåŠ¨åˆ°é¡µé¢åº•éƒ¨ï¼Œæ‰¾åˆ°â€œå¯¼å‡ºå¥åº·æ•°æ®â€é€‰é¡¹ï¼Œå¹¶ç‚¹å‡»å®ƒã€‚</li>
<li>åœ¨å¼¹å‡ºçª—å£ä¸­é€‰æ‹©è¦å¯¼å‡ºçš„æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚æ­¥æ•°ã€å¿ƒç‡ç­‰ã€‚</li>
<li>ç‚¹å‡»â€œä¸‹ä¸€æ­¥â€æŒ‰é’®ã€‚</li>
<li>åœ¨ä¸‹ä¸€ä¸ªé¡µé¢ä¸­ï¼Œæ‚¨å¯ä»¥é€‰æ‹©è¦å¯¼å‡ºçš„æ—¶é—´èŒƒå›´ã€‚æ‚¨å¯ä»¥é€‰æ‹©â€œå…¨éƒ¨æ•°æ®â€æˆ–æŒ‡å®šæ—¥æœŸèŒƒå›´ã€‚</li>
<li>ç‚¹å‡»â€œè¯·æ±‚å¯¼å‡ºâ€æŒ‰é’®ã€‚</li>
<li>æ‚¨å°†è¢«è¦æ±‚è¾“å…¥ä¸€ä¸ªå¯†ç ä»¥ä¿æŠ¤æ‚¨çš„æ•°æ®ã€‚è¾“å…¥å¯†ç åï¼Œç‚¹å‡»â€œä¸‹ä¸€æ­¥â€æŒ‰é’®ã€‚</li>
<li>åœ¨å¼¹å‡ºçª—å£ä¸­ï¼Œæ‚¨å¯ä»¥é€‰æ‹©å°†æ•°æ®å‘é€åˆ°æ‚¨çš„ç”µå­é‚®ä»¶åœ°å€æˆ–å…¶ä»–åº”ç”¨ç¨‹åºã€‚</li>
<li>ç‚¹å‡»â€œå¯¼å‡ºâ€æŒ‰é’®ã€‚</li>
</ol>
<p>å®Œæˆè¿™äº›æ­¥éª¤åï¼Œæ‚¨çš„å¥åº·æ•°æ®å°†è¢«å¯¼å‡ºä¸ºä¸€ä¸ªå¯ä¸‹è½½çš„ zip æ–‡ä»¶ã€‚æ‚¨å¯ä»¥å°†å…¶ä¿å­˜åˆ°æ‚¨çš„è®¾å¤‡ä¸Šæˆ–å‘é€åˆ°å…¶ä»–åº”ç”¨ç¨‹åºæˆ–äº‘å­˜å‚¨æœåŠ¡ã€‚</p>
<p>å°†å¯¼å‡ºçš„æ–‡ä»¶ export.xml ä¸Šä¼ åˆ°  <a href="https://www.ericwolter.com/projects/apple-health-export/">web ç½‘ç«™</a> ï¼Œç¨ç­‰ç‰‡åˆ»å¯ä»¥å¯¼å‡ºç»“æœã€‚å¯¼å‡ºçš„å¥åº·æ•°æ®æ˜¯ä¸€ä¸ªæŒ‡æ ‡ä¸€ä¸ª csv æ–‡ä»¶ï¼Œå¦‚æœæƒ³åˆå¹¶æ•°æ®ï¼Œéœ€è¦åšè¿›ä¸€æ­¥å¤„ç†ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-17-04.png" alt="weekly-review-17-04"  />
</p>
<p>å¦å¤–ï¼ŒHealth Export ä¹Ÿæä¾›äº†IOS APPï¼ŒåŠŸèƒ½å¥½ç”¨ï¼Œæ”¯æŒé€‰æ‹©æŒ‡å®šæŒ‡æ ‡æ•°æ®æŒ‰æ—¥æœŸèšåˆå¯¼å‡ºä¸ºä¸€ä¸ª csvï¼Œè¿˜æœ‰å®šæ—¶å¯¼å‡ºçš„åŠŸèƒ½ï¼Œé—æ†¾çš„æ˜¯éœ€è¦æ”¶è´¹ã€‚</p>
<h3 id="2ä½¿ç”¨-python-è„šæœ¬">2ã€ä½¿ç”¨ python è„šæœ¬</h3>
<p>è¿™é‡Œä½¿ç”¨äº† <a href="https://sspai.com/link?target=https%3A%2F%2Fgithub.com%2Ftdda%2Fapplehealthdata">@Radcliffe</a> æä¾›çš„å¼€æºä»£ç ã€‚ç›®å‰ï¼ŒGithub å¯ä»¥åœ¨å›½å†…è‡ªç”±è®¿é—®ï¼Œæ‰€ä»¥ç›´æ¥é€šè¿‡<a href="https://sspai.com/link?target=https%3A%2F%2Fgithub.com%2Ftdda%2Fapplehealthdata%2Fraw%2Fmaster%2Fapplehealthdata.py">æ­¤é“¾æ¥</a>ä¸‹è½½åç§°ä¸º <code>applehealthdata.py</code> çš„è„šæœ¬æ–‡ä»¶ã€‚</p>
<p>ç„¶åï¼Œå°†ä¹‹å‰ä¸‹è½½å¥½çš„ <code>å¯¼å‡º.xml</code> ä¸è¯¥è„šæœ¬æ–‡ä»¶æ”¾ç½®åœ¨<strong>åŒä¸€ç›®å½•</strong>ä¸‹æ–¹ã€‚ä¸ºäº†é˜²æ­¢æŠ¥é”™ï¼Œè¿™é‡Œéœ€è¦å°† <code>å¯¼å‡º.xml</code> æ›´åä¸º <code>export.xml</code>ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œåœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹æ‰“å¼€ç»ˆç«¯ï¼ˆmacOS &amp; Linuxï¼‰æˆ–è€…å‘½ä»¤è¡Œå·¥å…·ï¼ˆWindowsï¼‰ï¼Œä½¿ç”¨ Python 2 æ‰§è¡Œè¯¥è„šæœ¬ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">python applehealthdata.py export.xml
</span></span></code></pre></div><p>ç¨ç­‰ç‰‡åˆ»ï¼ŒXML æ–‡ä»¶å°±ä¼šè¢«è§£æä¸ºæ•°ä¸ª CSV æ–‡ä»¶äº†ã€‚</p>
<p>è¿™é‡Œï¼Œæˆ‘å¯¹ applehealthdata.py è¿™ä¸ªæ–‡ä»¶åšäº†ä¸€ç‚¹ä¿®æ”¹ï¼Œåªå¯¼å‡ºæŒ‡å®šçš„æŒ‡æ ‡çš„æŒ‡å®šåˆ—çš„æ•°æ®ï¼Œä¿®æ”¹åçš„è„šæœ¬åœ¨ <a href="https://github.com/chensoul/chensoul/blob/main/applehealthdata.py">applehealthdata.py</a>ã€‚ç›®å‰ï¼Œæˆ‘åªå…³æ³¨ä»¥ä¸‹6ä¸ªæŒ‡æ ‡ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">RECORDS</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;BodyFatPercentage&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;BodyMass&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;BodyMassIndex&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;DistanceWalkingRunning&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;LeanBodyMass&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;StepCount&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><p>è¿™ 6 ä¸ªæŒ‡æ ‡ä¸­æ–‡å«ä¹‰åˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>BodyFatPercentageï¼šè„‚è‚ªç‡</li>
<li>BodyMassï¼šä½“é‡</li>
<li>BodyMassIndexï¼šBMI æŒ‡æ•°</li>
<li>LeanBodyMassï¼šå‡€ä½“é‡</li>
<li>DistanceWalkingRunningï¼šèµ°è·¯è·‘æ­¥è·ç¦»</li>
<li>StepCountï¼šèµ°è·¯æ­¥æ•°</li>
</ul>
<p>å¯¼å‡ºçš„åˆ—åªéœ€è¦ typeã€startDateã€value è¿™ 3 ä¸ªï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">RECORD_FIELDS</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">((</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># (&#39;sourceName&#39;, &#39;s&#39;),</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># (&#39;sourceVersion&#39;, &#39;s&#39;),</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># (&#39;device&#39;, &#39;s&#39;),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># (&#39;unit&#39;, &#39;s&#39;),</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># (&#39;creationDate&#39;, &#39;d&#39;),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s1">&#39;startDate&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># (&#39;endDate&#39;, &#39;d&#39;),</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">))</span>
</span></span></code></pre></div><p>è¿™æ ·å¯¼å‡ºäº†è¿™ 6 ä¸ª csv æ–‡ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">BodyMass.csv               
</span></span><span class="line"><span class="cl">DistanceWalkingRunning.csv 
</span></span><span class="line"><span class="cl">StepCount.csv
</span></span><span class="line"><span class="cl">BodyFatPercentage.csv      
</span></span><span class="line"><span class="cl">BodyMassIndex.csv          
</span></span><span class="line"><span class="cl">LeanBodyMass.csv
</span></span></code></pre></div><p>æ¥ä¸‹æ¥ï¼ŒæŠŠè¿™6ä¸ªæ–‡ä»¶å¯¼å…¥æ•°æ®åº“ï¼Œå¹¶è¿›è¡Œåˆå¹¶å¤„ç†ã€‚æ•°æ®åº“æˆ‘é€‰æ‹©çš„æ˜¯ postgresï¼Œä»¥ä¸Š 6 ä¸ªæ–‡ä»¶å¯¹äº 6 ä¸ªå»ºè¡¨è¯­å¥ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="n">SEQUENCE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">health_id_seq</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="s2">&#34;public&#34;</span><span class="p">.</span><span class="s2">&#34;BodyFatPercentage&#34;</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;id&#34;</span><span class="w"> </span><span class="n">int4</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;health_id_seq&#39;</span><span class="p">::</span><span class="n">regclass</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;type&#34;</span><span class="w"> </span><span class="nb">varchar</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;start_date&#34;</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;value&#34;</span><span class="w"> </span><span class="n">float8</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="s2">&#34;id&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="s2">&#34;public&#34;</span><span class="p">.</span><span class="s2">&#34;BodyMass&#34;</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;id&#34;</span><span class="w"> </span><span class="n">int4</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;health_id_seq&#39;</span><span class="p">::</span><span class="n">regclass</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;type&#34;</span><span class="w"> </span><span class="nb">varchar</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;start_date&#34;</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;value&#34;</span><span class="w"> </span><span class="n">float8</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="s2">&#34;id&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="s2">&#34;public&#34;</span><span class="p">.</span><span class="s2">&#34;BodyMassIndex&#34;</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;id&#34;</span><span class="w"> </span><span class="n">int4</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;health_id_seq&#39;</span><span class="p">::</span><span class="n">regclass</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;type&#34;</span><span class="w"> </span><span class="nb">varchar</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;start_date&#34;</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;value&#34;</span><span class="w"> </span><span class="n">float8</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="s2">&#34;id&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="s2">&#34;public&#34;</span><span class="p">.</span><span class="s2">&#34;DistanceWalkingRunning&#34;</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;id&#34;</span><span class="w"> </span><span class="n">int4</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;health_id_seq&#39;</span><span class="p">::</span><span class="n">regclass</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;type&#34;</span><span class="w"> </span><span class="nb">varchar</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;start_date&#34;</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;value&#34;</span><span class="w"> </span><span class="n">float8</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="s2">&#34;id&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="s2">&#34;public&#34;</span><span class="p">.</span><span class="s2">&#34;LeanBodyMass&#34;</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;id&#34;</span><span class="w"> </span><span class="n">int4</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;health_id_seq&#39;</span><span class="p">::</span><span class="n">regclass</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;type&#34;</span><span class="w"> </span><span class="nb">varchar</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;start_date&#34;</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;value&#34;</span><span class="w"> </span><span class="n">float8</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="s2">&#34;id&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="s2">&#34;public&#34;</span><span class="p">.</span><span class="s2">&#34;StepCount&#34;</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;id&#34;</span><span class="w"> </span><span class="n">int4</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">nextval</span><span class="p">(</span><span class="s1">&#39;health_id_seq&#39;</span><span class="p">::</span><span class="n">regclass</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;type&#34;</span><span class="w"> </span><span class="nb">varchar</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;start_date&#34;</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;value&#34;</span><span class="w"> </span><span class="n">float8</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="s2">&#34;id&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p>æˆ‘æƒ³æŠŠè¿™6ä¸ªæ–‡ä»¶æŒ‰ç…§æ—¥æœŸåˆå¹¶åˆ°ä¸€ä¸ªè¡¨ä¸­ï¼Œäºæ˜¯åˆ›å»º health è¡¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="s2">&#34;public&#34;</span><span class="p">.</span><span class="s2">&#34;health&#34;</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;day&#34;</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;fat_pct&#34;</span><span class="w"> </span><span class="n">float8</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;bmi&#34;</span><span class="w"> </span><span class="n">float8</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;lean_weight&#34;</span><span class="w"> </span><span class="n">float8</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;step_count&#34;</span><span class="w"> </span><span class="n">float8</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;step_distance&#34;</span><span class="w"> </span><span class="nb">numeric</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s2">&#34;weight&#34;</span><span class="w"> </span><span class="n">float8</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="s2">&#34;day&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p>æ¥ä¸‹æ¥ï¼Œé€šè¿‡ sql åˆå¹¶æ•°æ®æ’å…¥åˆ° health è¡¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">health</span><span class="w">  
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="k">day</span><span class="p">,</span><span class="n">t</span><span class="p">.</span><span class="n">fat_pct</span><span class="p">,</span><span class="n">t</span><span class="p">.</span><span class="n">bmi</span><span class="p">,</span><span class="n">t</span><span class="p">.</span><span class="n">lean_weight</span><span class="p">,</span><span class="n">f</span><span class="p">.</span><span class="n">step_count</span><span class="p">,</span><span class="k">g</span><span class="p">.</span><span class="n">step_distance</span><span class="p">,</span><span class="n">t</span><span class="p">.</span><span class="n">weight</span><span class="w"> </span><span class="k">from</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">select</span><span class="w"> </span><span class="n">to_char</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;YYYY-MM-DD&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">day</span><span class="p">,</span><span class="k">sum</span><span class="p">(</span><span class="s2">&#34;value&#34;</span><span class="p">)</span><span class="w"> </span><span class="n">step_count</span><span class="w">  </span><span class="k">from</span><span class="w"> </span><span class="s2">&#34;StepCount&#34;</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">to_char</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;YYYY-MM-DD&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">f</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">outer</span><span class="w"> </span><span class="k">join</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">select</span><span class="w"> </span><span class="n">to_char</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;YYYY-MM-DD&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">day</span><span class="p">,</span><span class="n">round</span><span class="p">(</span><span class="k">cast</span><span class="p">(</span><span class="k">sum</span><span class="p">(</span><span class="s2">&#34;value&#34;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">numeric</span><span class="p">)</span><span class="w"> </span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">step_distance</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="s2">&#34;DistanceWalkingRunning&#34;</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">to_char</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;YYYY-MM-DD&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="k">g</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="k">day</span><span class="o">=</span><span class="k">g</span><span class="p">.</span><span class="k">day</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">left</span><span class="w"> </span><span class="k">outer</span><span class="w"> </span><span class="k">join</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">select</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="k">day</span><span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">weight</span><span class="p">,</span><span class="n">e</span><span class="p">.</span><span class="s2">&#34;value&#34;</span><span class="w"> </span><span class="s2">&#34;lean_weight&#34;</span><span class="p">,</span><span class="k">cast</span><span class="p">(</span><span class="k">c</span><span class="p">.</span><span class="s2">&#34;value&#34;</span><span class="o">*</span><span class="mi">100</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">numeric</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="s2">&#34;fat_pct&#34;</span><span class="p">,</span><span class="n">d</span><span class="p">.</span><span class="s2">&#34;value&#34;</span><span class="w"> </span><span class="s2">&#34;bmi&#34;</span><span class="w"> </span><span class="k">from</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="k">select</span><span class="w"> </span><span class="n">to_char</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;YYYY-MM-DD&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="k">day</span><span class="p">,</span><span class="k">min</span><span class="p">(</span><span class="n">start_date</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">min_start_date</span><span class="p">,</span><span class="k">min</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">weight</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="s2">&#34;BodyMass&#34;</span><span class="w"> </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="k">day</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">)</span><span class="w"> </span><span class="n">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">left</span><span class="w"> </span><span class="k">outer</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="s2">&#34;BodyFatPercentage&#34;</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">min_start_date</span><span class="o">=</span><span class="k">c</span><span class="p">.</span><span class="n">start_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">left</span><span class="w"> </span><span class="k">outer</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="s2">&#34;BodyMassIndex&#34;</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">min_start_date</span><span class="o">=</span><span class="n">d</span><span class="p">.</span><span class="n">start_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">left</span><span class="w"> </span><span class="k">outer</span><span class="w"> </span><span class="k">join</span><span class="w"> </span><span class="s2">&#34;LeanBodyMass&#34;</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">min_start_date</span><span class="o">=</span><span class="n">e</span><span class="p">.</span><span class="n">start_date</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="k">day</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="k">day</span><span class="o">=</span><span class="n">f</span><span class="p">.</span><span class="k">day</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="k">day</span><span class="w"> </span><span class="k">asc</span><span class="w">
</span></span></span></code></pre></div><p>æœ€åçš„æ•°æ®å¦‚ä¸‹ï¼š</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-17-05.png" alt="weekly-review-17-05"  />
</p>
<p>å®Œæ•´çš„ csv æ–‡ä»¶ä¿å­˜åœ¨ <a href="https://github.com/chensoul/chensoul/blob/main/data/health.csv">health.csv</a> ã€‚æœ‰äº›è®°å½•ä¸­ä½“é‡ç›¸å…³çš„æ•°æ®ä¸ºç©ºï¼Œè¿™æ˜¯å› ä¸ºä½“é‡ç›¸å…³æ•°æ®æ˜¯é€šè¿‡å…¶ä»–å’Œç”µå­ç§¤å…³è”çš„ app å†™è¿›å»çš„ã€‚<code>è¦æƒ³æ¯å¤©éƒ½æœ‰ä½“é‡ç›¸å…³çš„æ•°æ®ï¼Œåˆ™éœ€è¦æ¯å¤©ä½¿ç”¨ç”µå­ç§°æµ‹é‡ä½“é‡ã€‚</code></p>
<p>å¾—åˆ°è¿™ä»½æ•°æ®ä¹‹åï¼Œå°±å¯ä»¥è¿›è¡Œç»Ÿè®¡äº†ï¼Œæ¯”å¦‚ç»Ÿè®¡ä½“é‡çš„å˜åŒ–ã€æ¯å¤©èµ°è·¯çš„æ­¥æ•°ç­‰ç­‰ã€‚</p>
<h2 id="ç†è´¢">ç†è´¢</h2>
<p>è¿™å‘¨æ€»è®¡æ”¯å‡º 732 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š</p>
<ul>
<li>4æœˆ25æ—¥ï¼š117å…ƒï¼Œ100å…ƒåŠ æ²¹</li>
<li>4æœˆ26æ—¥ï¼š59å…ƒï¼Œä¹°è¯</li>
<li>4æœˆ28æ—¥ï¼š419å…ƒï¼ŒåŠ æ²¹360å…ƒ</li>
<li>4æœˆ29æ—¥ï¼š21å…ƒ</li>
<li>4æœˆ30æ—¥ï¼š116å…ƒ</li>
</ul>
<p>4 æœˆç´¯è®¡æ”¯å‡ºå…± 3048 å…ƒï¼Œæ¯” 3 æœˆæ”¯å‡º 3520 å…ƒå°‘äº† 472 å…ƒã€‚ä¸»è¦æ”¯å‡ºæ¥è‡ªè¿™å‡ ä¸ªï¼š</p>
<ul>
<li>äº¤é€šï¼š1177å…ƒï¼Œå…¶ä¸­300å…ƒæ˜¯ç¼´çº³ ETC æŠ¼é‡‘</li>
<li>é¤é¥®ï¼š827å…ƒ</li>
<li>è´­ç‰©ï¼š751å…ƒ</li>
<li>å¨±ä¹ï¼š216å…ƒï¼Œçœ‹ç”µå½±</li>
</ul>
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-17-07.png" alt="weekly-review-17-07" style="width:50%;" />
<h2 id="å¥èº«">å¥èº«</h2>
<p>å››æœˆè·‘æ­¥è®°å½•å¦‚ä¸‹ï¼Œæ€»è®¡è·‘äº†16å°æ—¶ã€125å…¬é‡Œã€‚æ›´è¯¦ç»†æ•°æ®ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„ <a href="https://run.chensoul.com/">è·‘æ­¥ä¸»é¡µ</a>ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-17-09.png" alt="weekly-review-17-09"  />
</p>
<h2 id="å·¥ä½œ">å·¥ä½œ</h2>
<h3 id="effective-java-3-ç¬”è®°">Effective Java 3 ç¬”è®°</h3>
<p>è¯·å‚è€ƒ <a href="/posts/2023/05/05/enforce-noninstantiability-with-a-private-constructor/">ã€ŠEffective Java 3ã€‹ç¬”è®°4ï¼šç”¨ç§æœ‰æ„é€ å‡½æ•°ä½¿ç±»ä¸å¯å®ä¾‹åŒ–</a> å’Œ ã€ŠEffective Java 3ã€‹ç¬”è®°7ï¼š<a href="/posts/2023/05/05/eliminate-obsolete-object-references/">æ’é™¤è¿‡æ—¶çš„å¯¹è±¡å¼•ç”¨</a>ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-17-10.png" alt="weekly-review-17-10"  />
</p>
<h3 id="flexypool">FlexyPool</h3>
<p>FlexyPool æ˜¯ä¸€ä¸ªç”¨äºç›‘æ§æ•°æ®åº“è¿æ¥æ± çš„å¼€æºå·¥å…·ã€‚å®ƒæ”¯æŒç›‘æ§å’ŒæŠ¥å‘Šè¿æ¥æ± çš„ä½¿ç”¨æƒ…å†µã€æ€§èƒ½å’Œç“¶é¢ˆï¼Œä»¥åŠè‡ªåŠ¨è°ƒæ•´è¿æ¥æ± çš„å¤§å°å’Œè¡Œä¸ºã€‚FlexyPool æ”¯æŒå¤šç§æµè¡Œçš„ Java æ•°æ®åº“è¿æ¥æ± ï¼Œä¾‹å¦‚ HikariCPã€Tomcat JDBC Poolã€C3P0ã€BoneCP ç­‰ç­‰ã€‚</p>
<p>FlexyPool ä¸»è¦æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<ol>
<li>ç›‘æ§è¿æ¥æ± çš„ä½¿ç”¨æƒ…å†µï¼ŒåŒ…æ‹¬è¿æ¥æ•°ã€è¯·æ±‚æ•°ã€ç­‰å¾…æ—¶é—´ã€æ‰§è¡Œæ—¶é—´ç­‰ç­‰ã€‚</li>
<li>æŠ¥å‘Šè¿æ¥æ± çš„æ€§èƒ½å’Œç“¶é¢ˆï¼Œä¾‹å¦‚æœ€æ…¢çš„æŸ¥è¯¢ã€æœ€é¢‘ç¹çš„é”™è¯¯ã€æœ€çŸ­çš„è¿æ¥æ—¶é—´ç­‰ç­‰ã€‚</li>
<li>è‡ªåŠ¨è°ƒæ•´è¿æ¥æ± çš„å¤§å°å’Œè¡Œä¸ºï¼Œä»¥æé«˜æ€§èƒ½å’Œå‡å°‘èµ„æºæ¶ˆè€—ã€‚</li>
<li>é›†æˆåˆ°å¸¸è§çš„ç›‘æ§å·¥å…·ä¸­ï¼Œä¾‹å¦‚ Prometheusã€Grafanaã€InfluxDB ç­‰ç­‰ã€‚</li>
</ol>
<p>FlexyPool çš„ä½¿ç”¨ç›¸å¯¹ç®€å•ï¼Œåªéœ€è¦å°†å…¶æ·»åŠ åˆ°åº”ç”¨ç¨‹åºçš„ä¾èµ–ä¸­ï¼Œç„¶åé…ç½®è¿æ¥æ± å’Œ FlexyPool çš„å‚æ•°å³å¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨ HikariCP è¿æ¥æ± ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤é…ç½® FlexyPoolï¼š</p>
<p>1ã€æ·»åŠ  FlexyPool çš„ä¾èµ–åˆ°åº”ç”¨ç¨‹åºçš„ pom.xml æ–‡ä»¶ä¸­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;groupId&gt;</span>com.vladmihalcea.flexypool<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;artifactId&gt;</span>flexy-pool-core<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;version&gt;</span>2.0.2<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>2ã€åœ¨åº”ç”¨ç¨‹åºçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½®è¿æ¥æ± å’Œ FlexyPool çš„å‚æ•°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-properties" data-lang="properties"><span class="line"><span class="cl"><span class="c1"># HikariCP æ•°æ®åº“è¿æ¥æ± é…ç½®</span>
</span></span><span class="line"><span class="cl"><span class="na">hikari.dataSourceClassName</span><span class="o">=</span><span class="s">com.mysql.jdbc.jdbc2.optional.MysqlDataSource</span>
</span></span><span class="line"><span class="cl"><span class="na">hikari.dataSource.url</span><span class="o">=</span><span class="s">jdbc:mysql://localhost:3306/mydb</span>
</span></span><span class="line"><span class="cl"><span class="na">hikari.dataSource.user</span><span class="o">=</span><span class="s">root</span>
</span></span><span class="line"><span class="cl"><span class="na">hikari.dataSource.password</span><span class="o">=</span><span class="s">secret</span>
</span></span><span class="line"><span class="cl"><span class="na">hikari.minimumIdle</span><span class="o">=</span><span class="s">10</span>
</span></span><span class="line"><span class="cl"><span class="na">hikari.maximumPoolSize</span><span class="o">=</span><span class="s">20</span>
</span></span><span class="line"><span class="cl"><span class="na">hikari.idleTimeout</span><span class="o">=</span><span class="s">30000</span>
</span></span><span class="line"><span class="cl"><span class="na">hikari.poolName</span><span class="o">=</span><span class="s">hikariPool</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># FlexyPool é…ç½®</span>
</span></span><span class="line"><span class="cl"><span class="na">flexyPool.metricsFactory</span><span class="o">=</span><span class="s">histogram</span>
</span></span><span class="line"><span class="cl"><span class="na">flexyPool.metric.log.enabled</span><span class="o">=</span><span class="s">true</span>
</span></span><span class="line"><span class="cl"><span class="na">flexyPool.metric.log.level</span><span class="o">=</span><span class="s">info</span>
</span></span><span class="line"><span class="cl"><span class="na">flexyPool.metric.log.interval</span><span class="o">=</span><span class="s">10</span>
</span></span><span class="line"><span class="cl"><span class="na">flexyPool.metric.prometheus.enabled</span><span class="o">=</span><span class="s">true</span>
</span></span><span class="line"><span class="cl"><span class="na">flexyPool.metric.prometheus.port</span><span class="o">=</span><span class="s">9090</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªé…ç½®ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆé…ç½®äº† HikariCP è¿æ¥æ± çš„å‚æ•°ï¼Œç„¶åé…ç½®äº† FlexyPool çš„å‚æ•°ã€‚è¿™äº›å‚æ•°åŒ…æ‹¬åº¦é‡å·¥å‚ã€æ—¥å¿—å’Œåº¦é‡è®°å½•çš„çº§åˆ«ã€åº¦é‡è®°å½•çš„é—´éš”ã€æ˜¯å¦å¯ç”¨ Prometheus é›†æˆç­‰ç­‰ã€‚</p>
<p>3ã€åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œå°† FlexyPool çš„ä»£ç†å¯¹è±¡æ·»åŠ åˆ°è¿æ¥æ± ä¸­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">DataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="o">...;</span> <span class="c1">// è·å–è¿æ¥æ± å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">FlexyPoolDataSource</span> <span class="n">flexyPoolDataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FlexyPoolDataSource</span><span class="o">&lt;&gt;(</span><span class="n">dataSource</span><span class="o">);</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆè·å– HikariCP è¿æ¥æ± å¯¹è±¡ï¼Œç„¶åå°†å…¶åŒ…è£…æˆ FlexyPool çš„ä»£ç†å¯¹è±¡ã€‚è¿™æ ·ï¼Œæ‰€æœ‰çš„æ•°æ®åº“æ“ä½œéƒ½å°†é€šè¿‡ FlexyPool è¿›è¡Œä»£ç†å’Œç›‘æ§ã€‚</p>
<p>Baeldung ç½‘ç«™ä¸Šæœ‰ä¸€ç¯‡ä»‹ç» Spring Boot ä¸­å¦‚ä½•ä½¿ç”¨ FlexyPool è¿æ¥æ± ç›‘æ§å·¥å…·çš„æ•™ç¨‹ï¼Œåä¸º <a href="https://www.baeldung.com/spring-flexypool-guide">A Guide to FlexyPool in Spring Boot</a>ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« é¦–å…ˆä»‹ç»äº† FlexyPool å·¥å…·çš„ä½œç”¨ï¼Œä»¥åŠå¦‚ä½•å°†å…¶é›†æˆåˆ° Spring Boot åº”ç”¨ç¨‹åºä¸­ã€‚FlexyPool å¯ä»¥ç›‘æ§å’ŒæŠ¥å‘Šè¿æ¥æ± çš„ä½¿ç”¨æƒ…å†µã€æ€§èƒ½å’Œç“¶é¢ˆï¼Œä»¥åŠè‡ªåŠ¨è°ƒæ•´è¿æ¥æ± çš„å¤§å°å’Œè¡Œä¸ºï¼Œä»¥æé«˜æ€§èƒ½å’Œå‡å°‘èµ„æºæ¶ˆè€—ã€‚</p>
<p>ç„¶åï¼Œæ–‡ç« ä»‹ç»äº†å¦‚ä½•åœ¨ Spring Boot åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ FlexyPoolã€‚å…·ä½“æ­¥éª¤åŒ…æ‹¬ï¼š</p>
<ol>
<li>æ·»åŠ  FlexyPool çš„ä¾èµ–åˆ°åº”ç”¨ç¨‹åºçš„ pom.xml æ–‡ä»¶ä¸­ã€‚</li>
<li>é…ç½®è¿æ¥æ± å’Œ FlexyPool çš„å‚æ•°ï¼Œä¾‹å¦‚ HikariCP è¿æ¥æ± çš„å‚æ•°ã€FlexyPool çš„åº¦é‡å·¥å‚ã€æ—¥å¿—å’Œåº¦é‡è®°å½•çš„çº§åˆ«ã€åº¦é‡è®°å½•çš„é—´éš”ã€æ˜¯å¦å¯ç”¨ Prometheus é›†æˆç­‰ç­‰ã€‚</li>
<li>åˆ›å»º FlexyPoolDataSource å¯¹è±¡ï¼Œä½œä¸ºè¿æ¥æ± çš„ä»£ç†å¯¹è±¡ã€‚è¯¥å¯¹è±¡å°†è‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†è¿æ¥æ± ï¼Œå¹¶ä½¿ç”¨ FlexyPool å·¥å…·è¿›è¡Œç›‘æ§å’Œè°ƒæ•´ã€‚</li>
<li>åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨è¿æ¥æ± ï¼Œä¾‹å¦‚è·å–è¿æ¥ã€æ‰§è¡Œ SQL è¯­å¥ã€å…³é—­è¿æ¥ç­‰ç­‰ã€‚</li>
</ol>
<p>æœ€åï¼Œæ–‡ç« æ€»ç»“äº†ä¸€äº›è¿æ¥æ± ç›‘æ§å’Œä¼˜åŒ–çš„æœ€ä½³å®è·µï¼Œä¾‹å¦‚ï¼š</p>
<ol>
<li>ä½¿ç”¨ FlexyPool å·¥å…·ç›‘æ§è¿æ¥æ± çš„ä½¿ç”¨æƒ…å†µå’Œæ€§èƒ½ç“¶é¢ˆï¼Œä»¥åŠè°ƒæ•´è¿æ¥æ± çš„å¤§å°å’Œè¡Œä¸ºï¼Œä»¥æé«˜æ€§èƒ½å’Œå‡å°‘èµ„æºæ¶ˆè€—ã€‚</li>
<li>é…ç½®è¿æ¥æ± å’Œ FlexyPool çš„å‚æ•°ï¼Œä»¥é€‚åº”åº”ç”¨ç¨‹åºçš„è´Ÿè½½å’Œæ€§èƒ½è¦æ±‚ã€‚</li>
<li>é¿å…è¿æ¥æ± æ³„æ¼å’Œæ­»é”ç­‰é—®é¢˜ï¼Œä¾‹å¦‚åŠæ—¶å…³é—­è¿æ¥ã€è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ç­‰ç­‰ã€‚</li>
</ol>
<h2 id="æœ¬å‘¨åˆ†äº«">æœ¬å‘¨åˆ†äº«</h2>
<p>å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€<a href="https://t.me/chensoul_share">ChenSoul Share</a>ã€Telegram é¢‘é“æˆ–è€…æˆ‘çš„ <a href="https://memos.chensoul.com/">memos</a> ä¸­ã€‚æˆ‘å†™äº†ä¸€ä¸ª python è„šæœ¬ä» memosè¯»å–æœ€è¿‘ä¸€å‘¨çš„ memos è®°å½•ã€‚</p>
<ul>
<li><strong>2023-04-28 09:01:43</strong> 4ä¸ªæ–‡ç”Ÿå›¾AIå·¥å…· <a href="https://xugaoxiang.com/2023/04/27/4-text-to-image-ai-tools/">æŸ¥çœ‹é“¾æ¥</a>  <code>#memos</code></li>
<li><strong>2023-04-27 13:29:50</strong> è¿™æ˜¯ Jony Ive çš„ LoveFrom å›¢é˜Ÿå‡ºå“çš„ä¸€æœ¬å…³äºä¹”å¸ƒæ–¯çš„ä¹¦ï¼Œä¹¦ä¸­å‡ ä¹å…¨éƒ¨å¼•ç”¨ä¹”å¸ƒæ–¯è‡ªå·±çš„è¯ï¼Œæ²¡æœ‰è§£è¯»ï¼Œæ›´åŠ ã€ŒåŸæ±åŸå‘³ã€ï¼ŒåŒæ—¶ä¹Ÿæ”¶å½•äº†ä¸€äº›çè´µçš„ç…§ç‰‡ã€‚ <a href="https://stevejobsarchive.com/book">æŸ¥çœ‹é“¾æ¥</a>  <a href="https://limboy.me/books/make-something-wonderful/">æŸ¥çœ‹é“¾æ¥</a>  <code>#memos</code></li>
<li><strong>2023-04-27 09:52:58</strong> Alpine, Tailwind, Deno, SQLite æˆ‘çš„æœ¬åœ°æœåŠ¡å››ä»¶å¥— <a href="https://limboy.me/posts/local-services-tools/">æŸ¥çœ‹é“¾æ¥</a>  Update: ç”¨ Remix æ›¿ä»£äº† Alpine å’Œ Denoï¼Œç¡®å®æ–¹ä¾¿ã€‚  <code>#web</code> <code>#memos</code></li>
<li><strong>2023-04-27 08:32:37</strong> FlexyPool æ˜¯ä¸€ä¸ªç”¨äºç›‘æ§æ•°æ®åº“è¿æ¥æ± çš„å¼€æºå·¥å…·ã€‚å®ƒæ”¯æŒç›‘æ§å’ŒæŠ¥å‘Šè¿æ¥æ± çš„ä½¿ç”¨æƒ…å†µã€æ€§èƒ½å’Œç“¶é¢ˆï¼Œä»¥åŠè‡ªåŠ¨è°ƒæ•´è¿æ¥æ± çš„å¤§å°å’Œè¡Œä¸ºã€‚FlexyPool æ”¯æŒå¤šç§æµè¡Œçš„ Java æ•°æ®åº“è¿æ¥æ± ï¼Œä¾‹å¦‚ HikariCPã€Tomcat JDBC Poolã€C3P0ã€BoneCP ç­‰ç­‰ã€‚  FlexyPool ä¸»è¦æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š  ç›‘æ§è¿æ¥æ± çš„ä½¿ç”¨æƒ…å†µï¼ŒåŒ…æ‹¬è¿æ¥æ•°ã€è¯·æ±‚æ•°ã€ç­‰å¾…æ—¶é—´ã€æ‰§è¡Œæ—¶é—´ç­‰ç­‰ã€‚  æŠ¥å‘Šè¿æ¥æ± çš„æ€§èƒ½å’Œç“¶é¢ˆï¼Œä¾‹å¦‚æœ€æ…¢çš„æŸ¥è¯¢ã€æœ€é¢‘ç¹çš„é”™è¯¯ã€æœ€çŸ­çš„è¿æ¥æ—¶é—´ç­‰ç­‰ã€‚  è‡ªåŠ¨è°ƒæ•´è¿æ¥æ± çš„å¤§å°å’Œè¡Œä¸ºï¼Œä»¥æé«˜æ€§èƒ½å’Œå‡å°‘èµ„æºæ¶ˆè€—ã€‚  é›†æˆåˆ°å¸¸è§çš„ç›‘æ§å·¥å…·ä¸­ï¼Œä¾‹å¦‚ Prometheusã€Grafanaã€InfluxDB ç­‰ç­‰ã€‚  <a href="https://www.baeldung.com/spring-flexypool-guide">æŸ¥çœ‹é“¾æ¥</a>  <code>#java</code> <code>#memos</code></li>
<li><strong>2023-04-27 07:24:03</strong> äººä¸€ç”Ÿä¸­æœ€é‡è¦çš„ä¸¤å¤©å°±æ˜¯å‡ºç”Ÿé‚£å¤©å’Œå‘ç°äººç”Ÿç›®æ ‡çš„é‚£å¤©ã€‚   &mdash;&mdash;é©¬å…‹åæ¸©  <code>#æ‘˜å½•</code></li>
<li><strong>2023-04-25 20:07:58</strong> å— <a href="https://github.com/yihong0618/2023/blob/main/get_up.py">æŸ¥çœ‹é“¾æ¥</a> å¯å‘ï¼Œåœ¨ iPhoneä¸Šï¼Œåˆ›å»ºäº†ä¸€ä¸ªè‡ªåŠ¨åŒ–æ·å¾„ã€‚å½“æ—©èµ·é—¹é“ƒå“èµ·æ—¶ï¼Œå¾€memoså‘é€ä¸€æ¡æ—©èµ·è®°å½•ï¼Œå†…å®¹å¦‚ä¸‹ï¼š  æ—©èµ·æ—¶é—´ï¼š2023å¹´4æœˆ25æ—¥ 20:02  ä»Šæ—¥è¯­å½•ï¼š æœ‰äº›äº‹æƒ…æœ¬èº«æˆ‘ä»¬æ— æ³•æ§åˆ¶ï¼Œåªå¥½æ§åˆ¶è‡ªå·±ã€‚  èµ·åºŠå•¦ï¼Œå–æ¯å’–å•¡ï¼Œå»è·‘æ­¥ï¼Œæ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹ã€‚  <code>#memos</code></li>
<li><strong>2023-04-25 08:57:03</strong> ã€æ€æ ·ç§æ—¶é—´çš„ç§å­ï¼Ÿã€‘  æ—¶é—´ä¸å¤Ÿç”¨ï¼Œå¦‚ä½•ç§æ—¶é—´çš„ç§å­ï¼Ÿ 1.èµ°ç”µæ¢¯æ—¶è€å¿ƒç­‰å€™è‡ªåŠ¨å…³é—¨ï¼Œè®©æ›´å¤šçš„äººè¿›æ¥ï¼ŒèŠ‚çº¦äº†ä»–ä»¬çš„æ—¶é—´ã€‚ï¼ˆè¿™è¿˜æ˜¯ä¸€é¢—ç©ºé—´ã€æˆ¿å­çš„ç§å­ï¼‰ 2.å¸®çˆ¶æ¯å®Œæˆå¥¹çš„å¿ƒæ„¿æˆ–è€…äº‹åŠ¡æ€§å·¥ä½œã€‚ 3.æ•™ä¼šå®¶é‡Œçš„å°å­©å­å¦‚ä½•èŠ‚çº¦çˆ¶æ¯çš„æ—¶é—´ï¼Œè¿™ä¸ªå°±éå¸¸é«˜çº§äº†ã€‚ 4.è·¯ä¸Šéšæ‰‹æ¡èµ°åƒåœ¾ã€ä¸ä¹±æ‰”åƒåœ¾ï¼Œè®©æ¸…æ´å·¥äººæœ‰æ›´å¤šçš„æ—¶é—´ã€‚ 5.å¸®åŠ©è€å¸ˆæˆ–è€…æœ‰æ›´å¤šèƒ½é‡çš„å¹³å°åšäº‹æƒ…ã€‚ 6.ç»å¸¸æ€§çš„åšä¹‰å·¥ã€‚ 7.æ‰“ç”µè¯é•¿è¯çŸ­è¯´ï¼Œç®€æ´æ˜äº†èŠ‚çº¦å¯¹æ–¹çš„æ—¶é—´ã€‚ 8.å¾®ä¿¡å°½å¯èƒ½ç”¨æ‰“å­—ï¼Œè®©å¯¹æ–¹å¿«é€Ÿç®€å•åœ°çŸ¥é“äº‹æƒ…ã€‚ 9.å¼€ä¼šæå‰åˆ°ï¼Œè‡³å°‘å‡†æ—¶åˆ°ï¼Œåƒä¸‡ä¸èƒ½è¿Ÿåˆ°ï¼Œä¼šè®®è¿Ÿåˆ°ï¼Œé‚£ç§ä¸‹çš„éƒ½æ˜¯å·¨å¤§çš„ç§å­ã€‚ 10.å¼€è½¦è®©äººï¼Œè…¾å‡ºæ—¶é—´ç»™åˆ«äººã€‚ 11.å¼€å¿ƒæ”¶æ‹¾å®¶åŠ¡ï¼Œè®©å®¶äººæ›´åŠ å®¹æ˜“æ‰¾åˆ°ä¸œè¥¿ã€‚ 12.ä¸»åŠ¨æ”¶æ‹¾å…¬å…±åŠå…¬åŒºåŸŸï¼Œè®©åŒäº‹å¿«é€Ÿæœ‰æ•ˆå·¥ä½œã€‚ 13.ä¸é—²èŠå…«å¦æµªè´¹åˆ«äººæ—¶é—´ï¼ˆè¿™é¢—é—²èŠå…«å¦çš„åç§å­ï¼Œè¿˜ä¼šè®©ä½ åœ¨å·¥ä½œä¸­æ²¡æœ‰äººå¬ä»ä½ çš„å¥½æ„è§ï¼Œç¼ºä¹é¢†å¯¼åŠ›ï¼‰ 14.å‚åŠ ä»»ä½•ä¼šè®®æå‰å‡†å¤‡ï¼Œç§¯æå›åº”ã€‚ 15.ä¸åˆ«äººåˆ†äº«æ—¶é—´çš„ç®¡ç†å·¥å…·ï¼Œåˆ†äº«è·å¾—å¯Œè£•æ—¶é—´çš„å¥½ç§å­ï¼Œè¿™å¯ä¹Ÿæ˜¯æ³•å¸ƒæ–½çš„å¥½ç§å­ã€‚ 16.æé†’ã€å¸®åŠ©æˆ–è€…å…³æ³¨æ‹–å»¶ç—‡çš„æœ‹å‹ã€‚ 17.ä¸çˆ½çº¦çˆ¶æ¯å®‰æ’çš„èšé¤åƒé¥­ï¼Œä¸å›å®¶åƒé¥­æå‰è¯´ã€‚ï¼ˆæ©ç”°çš„å¤§ç§å­ï¼‰ 18.é¼“åŠ±åˆ«äººçš„æ¢¦æƒ³ï¼ŒçœŸè¯šç”±å¿ƒåœ°èµç¾åˆ«äººã€‚  <code>#é‡‘åˆšæ™ºæ…§</code></li>
<li><strong>2023-04-24 19:21:02</strong> æœ‰ä¸€ä¸ªæƒ³æ³•ï¼Œå¯ä»¥å†™ä¸€æ®µè„šæœ¬ä» telegram æˆ–è€… memos è¯»å–ä¸Šå‘¨çš„åˆ†äº«è®°å½•ï¼Œç„¶åï¼Œè½¬æ¢ä¸º markdown æ ¼å¼å‘å¸ƒåœ¨å‘¨æŠ¥ä¸­ã€‚è¿™æ ·ï¼Œå‘¨æŠ¥å°±å¯ä»¥å˜æˆåŠè‡ªåŠ¨åŒ–äº†ã€‚ äºæ˜¯ï¼Œå†™äº†ä¸€ä¸ª python è„šæœ¬å®ç°äº†ä» memos è¯»å–è®°å½•ã€‚ğŸ˜  <code>#skill</code></li>
<li><strong>2023-04-24 17:26:52</strong> æ™šå”æå•†éšçš„ã€Šé”¦ç‘Ÿã€‹  é”¦ç‘Ÿæ— ç«¯äº”åå¼¦ï¼Œä¸€å¼¦ä¸€æŸ±æ€åå¹´ã€‚ åº„ç”Ÿæ™“æ¢¦è¿·è´è¶ï¼Œæœ›å¸æ˜¥å¿ƒæ‰˜æœé¹ƒã€‚ æ²§æµ·æœˆæ˜ç æœ‰æ³ªï¼Œè“ç”°æ—¥æš–ç‰ç”ŸçƒŸã€‚ æ­¤æƒ…å¯å¾…æˆè¿½å¿†ï¼Œåªæ˜¯å½“æ—¶å·²æƒ˜ç„¶ã€‚  <code>#è¯—è¯</code></li>
<li><strong>2023-04-24 14:07:04</strong> ä½¿ç”¨ä¸€è¡Œä»£ç ä¸ºç½‘ç«™çš„è¾“å…¥æ¡†å¢åŠ ä¸Š AI èƒ½åŠ›ã€‚ <a href="https://www.enhanceai.dev/">æŸ¥çœ‹é“¾æ¥</a>  <code>#skill</code></li>
<li><strong>2023-04-24 14:04:23</strong> å¹³å¸¸æ˜¯ç³Šé‡Œç³Šæ¶‚çš„ï¼Œç°åœ¨å˜å¾—å‡ºäººæ„å¤–çš„å°å¿ƒè°¨æ…ï¼Œè¿™æ­£æ˜¯ç”±äºæŠ¥å¤çš„æ¬²æœ›ï¼Œè€Œè¿™ç§æ¬²æœ›å¤šä¹ˆèƒ½å¤Ÿé”»ç‚¼äººï¼  â€”â€” å¤§ä»²é©¬   <code>#æ‘˜å½•</code></li>
<li><strong>2023-04-24 14:03:59</strong> ä½¿äººç–²ä¹çš„ä¸æ˜¯è¿œæ–¹çš„æ·±è°·ï¼Œè€Œæ˜¯é‹å­é‡Œçš„ä¸€ç²’æ²™å­ã€‚  â€”â€” ä¼å°”æ³° <code>#æ‘˜å½•</code></li>
<li><strong>2023-04-24 11:00:30</strong> ğŸ“ ã€ŠEffective Java 3ã€‹ç¬”è®°ï¼šé¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ <code>#blog</code>   <a href="https://blog.chensoul.com/posts/2023/04/24/avoid-creating-unnecessary-objects/">æŸ¥çœ‹é“¾æ¥</a></li>
<li><strong>2023-04-24 08:20:31</strong> ä½¿ç”¨ Python å®ç° RSS è½¬ Newsletter.   <a href="https://www.skyue.com/23042217.html">æŸ¥çœ‹é“¾æ¥</a>  <code>#python</code></li>
</ul>
<p>ä»¥ä¸Šã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>ã€ŠEffective Java 3ã€‹ç¬”è®°7ï¼šæ’é™¤è¿‡æ—¶çš„å¯¹è±¡å¼•ç”¨</title>
      <link>https://blog.chensoul.com/posts/2023/05/05/eliminate-obsolete-object-references/</link>
      <pubDate>Fri, 05 May 2023 09:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/05/05/eliminate-obsolete-object-references/</guid>
      <description>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼šæ’é™¤è¿‡æ—¶çš„å¯¹è±¡å¼•ç”¨ã€‚ ä»‹ç» &amp;ldquo;Eliminate obsolete object references&amp;rdquo; æ˜¯ä¸€æ¡Javaç¼–ç¨‹æœ€ä½³å®è·µçš„åŸåˆ™ï¼ŒæŒ‡çš„æ˜¯åœ¨ä»£ç ä¸­åŠæ—¶æ¸…ç†ä¸</description>
      <content:encoded><![CDATA[<p>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼šæ’é™¤è¿‡æ—¶çš„å¯¹è±¡å¼•ç”¨ã€‚</p>
<h2 id="ä»‹ç»">ä»‹ç»</h2>
<p>&ldquo;Eliminate obsolete object references&rdquo; æ˜¯ä¸€æ¡Javaç¼–ç¨‹æœ€ä½³å®è·µçš„åŸåˆ™ï¼ŒæŒ‡çš„æ˜¯åœ¨ä»£ç ä¸­åŠæ—¶æ¸…ç†ä¸å†ä½¿ç”¨çš„å¯¹è±¡å¼•ç”¨ï¼Œä»¥é¿å…å†…å­˜æ³„æ¼å’Œæ€§èƒ½é—®é¢˜ã€‚å½“ä¸€ä¸ªå¯¹è±¡ä¸å†éœ€è¦æ—¶ï¼Œåº”è¯¥å°½å¿«å°†å…¶å¼•ç”¨è®¾ç½®ä¸ºnullï¼Œè¿™æ ·JVMå¯ä»¥åŠæ—¶å›æ”¶å®ƒæ‰€å ç”¨çš„å†…å­˜ã€‚</p>
<p>è€ƒè™‘ä»¥ä¸‹ç®€å•çš„å †æ ˆå®ç°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.EmptyStackException</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Can you spot the &#34;memory leak&#34;?
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Stack</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Object</span><span class="o">[]</span> <span class="n">elements</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">DEFAULT_INITIAL_CAPACITY</span> <span class="o">=</span> <span class="n">16</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">Stack</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">elements</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">[</span><span class="n">DEFAULT_INITIAL_CAPACITY</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">push</span><span class="o">(</span><span class="n">Object</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ensureCapacity</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">elements</span><span class="o">[</span><span class="n">size</span><span class="o">++]</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">pop</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">size</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">throw</span> <span class="k">new</span> <span class="n">EmptyStackException</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">elements</span><span class="o">[--</span><span class="n">size</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * Ensure space for at least one more element, roughly
</span></span></span><span class="line"><span class="cl"><span class="cm">     * doubling the capacity each time the array needs to grow.
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">ensureCapacity</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">elements</span><span class="o">.</span><span class="na">length</span> <span class="o">==</span> <span class="n">size</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">elements</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">copyOf</span><span class="o">(</span><span class="n">elements</span><span class="o">,</span> <span class="n">2</span> <span class="o">*</span> <span class="n">size</span> <span class="o">+</span> <span class="n">1</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>è¿™ä¸ªç¨‹åºæ²¡æœ‰æ˜æ˜¾çš„é”™è¯¯ã€‚ä½ å¯ä»¥å¯¹å®ƒè¿›è¡Œè¯¦å°½çš„æµ‹è¯•ï¼Œå®ƒä¼šä»¥ä¼˜å¼‚çš„æˆç»©é€šè¿‡æ‰€æœ‰çš„æµ‹è¯•ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªæ½œåœ¨çš„é—®é¢˜ã€‚ç®€å•åœ°è¯´ï¼Œè¯¥ç¨‹åºæœ‰ä¸€ä¸ªã€Œå†…å­˜æ³„æ¼ã€é—®é¢˜ï¼Œç”±äºåƒåœ¾æ”¶é›†å™¨æ´»åŠ¨çš„å¢åŠ æˆ–å†…å­˜å ç”¨çš„å¢åŠ ï¼Œå®ƒå¯ä»¥æ‚„æ— å£°æ¯åœ°è¡¨ç°ä¸ºæ€§èƒ½çš„é™ä½ã€‚åœ¨æç«¯æƒ…å†µä¸‹ï¼Œè¿™ç§å†…å­˜æ³„æ¼å¯èƒ½å¯¼è‡´ç£ç›˜åˆ†é¡µï¼Œç”šè‡³å‡ºç° OutOfMemoryError ç¨‹åºæ•…éšœï¼Œä½†è¿™ç§æ•…éšœç›¸å¯¹å°‘è§ã€‚</p>
<p>é‚£ä¹ˆå†…å­˜æ³„æ¼åœ¨å“ªé‡Œå‘¢ï¼Ÿå¦‚æœå †æ ˆå¢é•¿ï¼Œç„¶åæ”¶ç¼©ï¼Œé‚£ä¹ˆä»å †æ ˆä¸­å¼¹å‡ºçš„å¯¹è±¡å°†ä¸ä¼šè¢«åƒåœ¾æ”¶é›†ï¼Œå³ä½¿ä½¿ç”¨å †æ ˆçš„ç¨‹åºä¸å†å¼•ç”¨å®ƒä»¬ã€‚è¿™æ˜¯å› ä¸ºæ ˆä¿ç•™äº†è¿™äº›å¯¹è±¡çš„æ—§å¼•ç”¨ã€‚ä¸€ä¸ªè¿‡æ—¶çš„å¼•ç”¨ï¼Œæ˜¯æŒ‡æ°¸è¿œä¸ä¼šè¢«å–æ¶ˆçš„å¼•ç”¨ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå…ƒç´ æ•°ç»„çš„ã€Œæ´»åŠ¨éƒ¨åˆ†ã€ä¹‹å¤–çš„ä»»ä½•å¼•ç”¨éƒ½å·²è¿‡æ—¶ã€‚æ´»åŠ¨éƒ¨åˆ†ç”±ç´¢å¼•å°äºå¤§å°çš„å…ƒç´ ç»„æˆã€‚</p>
<p>åƒåœ¾æ”¶é›†è¯­è¨€ä¸­çš„å†…å­˜æ³„æ¼ï¼ˆæ›´ç¡®åˆ‡åœ°è¯´æ˜¯æ— æ„çš„å¯¹è±¡ä¿ç•™ï¼‰æ˜¯æš—è—çš„é£é™©ã€‚å¦‚æœæ— æ„ä¸­ä¿ç•™äº†å¯¹è±¡å¼•ç”¨ï¼Œé‚£ä¹ˆå¯¹è±¡ä¸ä»…è¢«æ’é™¤åœ¨åƒåœ¾æ”¶é›†ä¹‹å¤–ï¼Œè¯¥å¯¹è±¡å¼•ç”¨çš„ä»»ä½•å¯¹è±¡ä¹Ÿè¢«æ’é™¤åœ¨å¤–ï¼Œä¾æ­¤ç±»æ¨ã€‚å³ä½¿åªæ˜¯æ— æ„ä¸­ä¿ç•™äº†ä¸€äº›å¯¹è±¡å¼•ç”¨ï¼Œè®¸å¤šè®¸å¤šçš„å¯¹è±¡ä¹Ÿå¯èƒ½è¢«é˜»æ­¢è¢«åƒåœ¾æ”¶é›†ï¼Œä»è€Œå¯¹æ€§èƒ½äº§ç”Ÿæ½œåœ¨çš„å·¨å¤§å½±å“ã€‚</p>
<p>è§£å†³è¿™ç±»é—®é¢˜çš„æ–¹æ³•å¾ˆç®€å•ï¼šä¸€æ—¦å¼•ç”¨è¿‡æ—¶ï¼Œå°±å°†ç½®ç©ºã€‚åœ¨æˆ‘ä»¬çš„ Stack ç±»ä¸­ï¼Œå¯¹æŸä¸ªé¡¹çš„å¼•ç”¨ä¸€æ—¦ä»å †æ ˆä¸­å¼¹å‡ºå°±ä¼šè¿‡æ—¶ã€‚pop æ–¹æ³•çš„æ­£ç¡®ç‰ˆæœ¬å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">Object</span> <span class="nf">pop</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">size</span> <span class="o">==</span> <span class="n">0</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">throw</span> <span class="k">new</span> <span class="n">EmptyStackException</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">Object</span> <span class="n">result</span> <span class="o">=</span> <span class="n">elements</span><span class="o">[--</span><span class="n">size</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">elements</span><span class="o">[</span><span class="n">size</span><span class="o">]</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// Eliminate obsolete reference
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ç”¨ null å¤„ç†è¿‡æ—¶å¼•ç”¨çš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œå¦‚æœå®ƒä»¬éšåè¢«é”™è¯¯åœ°å…³è”å¼•ç”¨ï¼Œç¨‹åºå°†ç«‹å³å¤±è´¥ï¼Œå‡ºç° NullPointerExceptionï¼Œè€Œä¸æ˜¯æ‚„æ‚„åœ°åšé”™è¯¯çš„äº‹æƒ…ã€‚å°½å¯èƒ½å¿«åœ°æ£€æµ‹ç¼–ç¨‹é”™è¯¯æ€»æ˜¯æœ‰ç›Šçš„ã€‚</p>
<p>é‚£ä¹ˆï¼Œä»€ä¹ˆæ—¶å€™åº”è¯¥å–æ¶ˆå¼•ç”¨å‘¢ï¼ŸStack ç±»çš„å“ªäº›æ–¹é¢å®¹æ˜“å¯¼è‡´å†…å­˜æ³„æ¼ï¼Ÿç®€å•åœ°è¯´ï¼Œå®ƒç®¡ç†è‡ªå·±çš„å†…å­˜ã€‚å­˜å‚¨æ± åŒ…å«å…ƒç´ æ•°ç»„çš„å…ƒç´ ï¼ˆå¯¹è±¡å¼•ç”¨å•å…ƒï¼Œè€Œä¸æ˜¯å¯¹è±¡æœ¬èº«ï¼‰æ•°ç»„çš„æ´»åŠ¨éƒ¨åˆ†ï¼ˆå¦‚å‰é¢æ‰€å®šä¹‰çš„ï¼‰ä¸­çš„å…ƒç´ è¢«åˆ†é…ï¼Œè€Œæ•°ç»„å…¶ä½™éƒ¨åˆ†ä¸­çš„å…ƒç´ æ˜¯ç©ºé—²çš„ã€‚åƒåœ¾æ”¶é›†å™¨æ²¡æœ‰åŠæ³•çŸ¥é“è¿™ä¸€ç‚¹ï¼›å¯¹äºåƒåœ¾æ”¶é›†å™¨ï¼Œå…ƒç´ æ•°ç»„ä¸­çš„æ‰€æœ‰å¯¹è±¡å¼•ç”¨éƒ½åŒæ ·æœ‰æ•ˆã€‚åªæœ‰ç¨‹åºå‘˜çŸ¥é“æ•°ç»„çš„éæ´»åŠ¨éƒ¨åˆ†ä¸é‡è¦ã€‚åªè¦æ•°ç»„å…ƒç´ æˆä¸ºéæ´»åŠ¨éƒ¨åˆ†çš„ä¸€éƒ¨åˆ†ï¼Œç¨‹åºå‘˜å°±å¯ä»¥é€šè¿‡æ‰‹åŠ¨æ¸…ç©ºæ•°ç»„å…ƒç´ ï¼Œæœ‰æ•ˆåœ°å°†è¿™ä¸ªäº‹å®ä¼ é€’ç»™åƒåœ¾æ”¶é›†å™¨ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªç±»ç®¡ç†å®ƒè‡ªå·±çš„å†…å­˜æ—¶ï¼Œç¨‹åºå‘˜åº”è¯¥è­¦æƒ•å†…å­˜æ³„æ¼ã€‚å½“é‡Šæ”¾ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œè¯¥å…ƒç´ ä¸­åŒ…å«çš„ä»»ä½•å¯¹è±¡å¼•ç”¨éƒ½åº”è¯¥è¢«ç½®ä¸º nullã€‚</p>
<p><strong>å¦ä¸€ä¸ªå¸¸è§çš„å†…å­˜æ³„æ¼æºæ˜¯ç¼“å­˜ã€‚</strong> ä¸€æ—¦å°†å¯¹è±¡å¼•ç”¨æ”¾å…¥ç¼“å­˜ä¸­ï¼Œå°±å¾ˆå®¹æ˜“å¿˜è®°å®ƒå°±åœ¨é‚£é‡Œï¼Œå¹¶ä¸”åœ¨å®ƒå˜å¾—æ— å…³ç´§è¦ä¹‹åå¾ˆä¹…ä»å°†å®ƒç•™åœ¨ç¼“å­˜ä¸­ã€‚æœ‰å‡ ä¸ªè§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³•ã€‚å¦‚æœä½ éå¸¸å¹¸è¿åœ°å®ç°äº†ä¸€ä¸ªç¼“å­˜ï¼Œåªè¦ç¼“å­˜å¤–æœ‰å¯¹å…¶é”®çš„å¼•ç”¨ï¼Œé‚£ä¹ˆå°±å°†ç¼“å­˜è¡¨ç¤ºä¸º WeakHashMapï¼›å½“æ¡ç›®è¿‡æ—¶åï¼Œæ¡ç›®å°†è¢«è‡ªåŠ¨åˆ é™¤ã€‚è®°ä½ï¼ŒWeakHashMap åªæœ‰åœ¨ç¼“å­˜æ¡ç›®çš„é¢„æœŸç”Ÿå­˜æœŸç”±é”®çš„å¤–éƒ¨å¼•ç”¨ï¼ˆè€Œä¸æ˜¯å€¼ï¼‰å†³å®šæ—¶æ‰æœ‰ç”¨ã€‚</p>
<p>æ›´å¸¸è§çš„æƒ…å†µæ˜¯ï¼Œç¼“å­˜æ¡ç›®çš„æœ‰æ•ˆç”Ÿå­˜æœŸå®šä¹‰ä¸å¤ªå¥½ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œæ¡ç›®çš„ä»·å€¼ä¼šè¶Šæ¥è¶Šä½ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¼“å­˜å¶å°”åº”è¯¥æ¸…ç†é‚£äº›å·²ç»åœç”¨çš„æ¡ç›®ã€‚è¿™å¯ä»¥é€šè¿‡åå°çº¿ç¨‹ï¼ˆå¯èƒ½æ˜¯ <code>ScheduledThreadPoolExecutor</code>ï¼‰æˆ–å‘ç¼“å­˜æ·»åŠ æ–°æ¡ç›®æ—¶é¡ºä¾¿å®Œæˆã€‚LinkedHashMap ç±»é€šè¿‡å…¶ <code>removeEldestEntry</code> æ–¹æ³•ç®€åŒ–äº†åä¸€ç§æ–¹æ³•ã€‚å¯¹äºæ›´å¤æ‚çš„ç¼“å­˜ï¼Œä½ å¯èƒ½éœ€è¦ç›´æ¥ä½¿ç”¨ <code>java.lang.ref</code>ã€‚</p>
<p><strong>å†…å­˜æ³„æ¼çš„ç¬¬ä¸‰ä¸ªå¸¸è§æ¥æºæ˜¯ä¾¦å¬å™¨å’Œå…¶ä»–å›è°ƒã€‚</strong> å¦‚æœä½ å®ç°äº†ä¸€ä¸ª APIï¼Œå…¶ä¸­å®¢æˆ·ç«¯æ³¨å†Œå›è°ƒï¼Œä½†ä¸æ˜¾å¼å–æ¶ˆå®ƒä»¬ï¼Œé™¤éä½ é‡‡å–ä¸€äº›è¡ŒåŠ¨ï¼Œå¦åˆ™å®ƒä»¬å°†ç´¯ç§¯ã€‚ç¡®ä¿å›è°ƒè¢«åŠæ—¶åœ°åƒåœ¾æ”¶é›†çš„ä¸€ç§æ–¹æ³•æ˜¯ä»…å­˜å‚¨å¯¹å®ƒä»¬çš„å¼±å¼•ç”¨ï¼Œä¾‹å¦‚ï¼Œå°†å®ƒä»¬ä½œä¸ºé”®å­˜å‚¨åœ¨ WeakHashMap ä¸­ã€‚</p>
<h3 id="å¦‚ä½•æ’é™¤è¿‡æ—¶å¯¹è±¡å¼•ç”¨">å¦‚ä½•æ’é™¤è¿‡æ—¶å¯¹è±¡å¼•ç”¨</h3>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨Javaè¯­è¨€ä¸­çš„ä¸€äº›æŠ€æœ¯æ¥æ’é™¤è¿‡æ—¶çš„å¯¹è±¡å¼•ç”¨ã€‚</p>
<ol>
<li>åœ¨å¾ªç¯ä¸­ä½¿ç”¨å±€éƒ¨å˜é‡</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">list</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// do something with str
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å±€éƒ¨å˜é‡<code>str</code>æ¥å¼•ç”¨åˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œè€Œä¸æ˜¯é‡å¤åœ°ä½¿ç”¨<code>list.get(i)</code>ã€‚è¿™æ ·ï¼Œå½“å¾ªç¯ç»“æŸæ—¶ï¼Œ<code>str</code>çš„å¼•ç”¨å°†è¢«è‡ªåŠ¨æ¸…é™¤ï¼Œé¿å…äº†è¿‡æ—¶çš„å¯¹è±¡å¼•ç”¨ã€‚</p>
<ol start="2">
<li>åœ¨ä½¿ç”¨å®Œå¯¹è±¡ååŠæ—¶æ¸…é™¤å¼•ç”¨</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">SomeObject</span> <span class="n">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SomeObject</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="c1">// do something with obj
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="n">obj</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// clear the reference to obj
</span></span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨å®Œå¯¹è±¡åç«‹å³å°†å…¶å¼•ç”¨è®¾ç½®ä¸ºnullï¼Œä»¥ä¾¿JVMå¯ä»¥åŠæ—¶å›æ”¶å®ƒæ‰€å ç”¨çš„å†…å­˜ã€‚å¦‚æœä¸æ¸…é™¤å¼•ç”¨ï¼Œå¯¹è±¡å°†ä¸€ç›´å­˜åœ¨äºå†…å­˜ä¸­ï¼Œç›´åˆ°JVMè¿›è¡Œåƒåœ¾å›æ”¶ã€‚</p>
<ol start="3">
<li>ä½¿ç”¨å¼±å¼•ç”¨</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">WeakReference</span><span class="o">&lt;</span><span class="n">SomeObject</span><span class="o">&gt;</span> <span class="n">ref</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WeakReference</span><span class="o">&lt;&gt;(</span><span class="k">new</span> <span class="n">SomeObject</span><span class="o">());</span>
</span></span><span class="line"><span class="cl"><span class="n">SomeObject</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">ref</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// do something with obj
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="n">obj</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// clear the reference to obj
</span></span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªå¼±å¼•ç”¨æ¥å¼•ç”¨å¯¹è±¡ï¼Œä»¥ä¾¿åœ¨å¯¹è±¡ä¸å†è¢«å¼ºå¼•ç”¨æ—¶å¯ä»¥è¢«åŠæ—¶å›æ”¶ã€‚å½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨å¯¹è±¡æ—¶ï¼Œå¯ä»¥é€šè¿‡å¼±å¼•ç”¨è·å–å¯¹è±¡çš„å¼•ç”¨ï¼Œä½¿ç”¨å®ŒååŠæ—¶å°†å…¶å¼•ç”¨è®¾ç½®ä¸ºnullã€‚</p>
<ol start="4">
<li>ä½¿ç”¨try-with-resourcesè¯­å¥</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="k">try</span> <span class="o">(</span><span class="n">InputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="s">&#34;file.txt&#34;</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// do something with in
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†try-with-resourcesè¯­å¥æ¥æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æµï¼Œå¹¶åœ¨ä½¿ç”¨å®Œåè‡ªåŠ¨å…³é—­å®ƒã€‚è¿™æ ·å¯ä»¥ç¡®ä¿åœ¨ä¸å†éœ€è¦æ–‡ä»¶æµæ—¶ï¼Œå®ƒçš„å¼•ç”¨å°†è¢«æ¸…é™¤ï¼Œé¿å…äº†è¿‡æ—¶çš„å¯¹è±¡å¼•ç”¨ã€‚</p>
<ol start="5">
<li>ä½¿ç”¨è½¯å¼•ç”¨</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">SoftReference</span><span class="o">&lt;</span><span class="n">SomeObject</span><span class="o">&gt;</span> <span class="n">ref</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SoftReference</span><span class="o">&lt;&gt;(</span><span class="k">new</span> <span class="n">SomeObject</span><span class="o">());</span>
</span></span><span class="line"><span class="cl"><span class="n">SomeObject</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">ref</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// do something with obj
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="n">obj</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// clear the reference to obj
</span></span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªè½¯å¼•ç”¨æ¥å¼•ç”¨å¯¹è±¡ï¼Œä»¥ä¾¿åœ¨JVMéœ€è¦å›æ”¶å†…å­˜æ—¶å¯ä»¥å›æ”¶å¯¹è±¡ã€‚è½¯å¼•ç”¨åœ¨å†…å­˜ä¸è¶³æ—¶é€šå¸¸ä¼šè¢«å›æ”¶ï¼Œä½†åœ¨å†…å­˜å……è¶³æ—¶å¯ä»¥ä¿ç•™å¯¹è±¡ï¼Œé¿å…äº†è¿‡æ—¶çš„å¯¹è±¡å¼•ç”¨ã€‚</p>
<ol start="6">
<li>ä½¿ç”¨è™šå¼•ç”¨</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ReferenceQueue</span><span class="o">&lt;</span><span class="n">SomeObject</span><span class="o">&gt;</span> <span class="n">queue</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ReferenceQueue</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl"><span class="n">PhantomReference</span><span class="o">&lt;</span><span class="n">SomeObject</span><span class="o">&gt;</span> <span class="n">ref</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PhantomReference</span><span class="o">&lt;&gt;(</span><span class="k">new</span> <span class="n">SomeObject</span><span class="o">(),</span> <span class="n">queue</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// do something
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="n">ref</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span> <span class="c1">// clear the reference to obj
</span></span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªè™šå¼•ç”¨æ¥å¼•ç”¨å¯¹è±¡ï¼Œä»¥ä¾¿åœ¨JVMå›æ”¶å¯¹è±¡ä¹‹å‰å¯ä»¥è¿›è¡Œä¸€äº›å¿…è¦çš„æ¸…ç†å·¥ä½œã€‚è™šå¼•ç”¨åœ¨JVMå›æ”¶å¯¹è±¡æ—¶ä¼šè¢«æ·»åŠ åˆ°ä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨å¯¹è±¡è¢«å›æ”¶ä¹‹å‰æ‰§è¡Œå¿…è¦çš„æ¸…ç†å·¥ä½œã€‚</p>
<ol start="7">
<li>ä½¿ç”¨å¯¹è±¡æ± </li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">ObjectPool</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">objects</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="n">T</span> <span class="nf">getObject</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">T</span> <span class="n">obj</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">objects</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">obj</span> <span class="o">=</span> <span class="n">createObject</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">obj</span> <span class="o">=</span> <span class="n">objects</span><span class="o">.</span><span class="na">iterator</span><span class="o">().</span><span class="na">next</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="n">objects</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">obj</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">obj</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">returnObject</span><span class="o">(</span><span class="n">T</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">objects</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">obj</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">T</span> <span class="nf">createObject</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// create a new object
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªå¯¹è±¡æ± æ¥ç®¡ç†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚å½“éœ€è¦ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬ä»å¯¹è±¡æ± ä¸­è·å–ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚å½“ä¸å†éœ€è¦å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬å°†å…¶è¿”å›åˆ°å¯¹è±¡æ± ä¸­ï¼Œä»¥ä¾¿å…¶ä»–å¯¹è±¡å¯ä»¥é‡å¤ä½¿ç”¨ã€‚å¯¹è±¡æ± å¯ä»¥é¿å…è¿‡æ—¶çš„å¯¹è±¡å¼•ç”¨ï¼Œå¹¶æé«˜ä»£ç çš„æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§ã€‚</p>
<ol start="8">
<li>ä½¿ç”¨å¼±æ•£åˆ—æ˜ å°„</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Map</span><span class="o">&lt;</span><span class="n">SomeObject</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WeakHashMap</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">SomeObject</span> <span class="n">key</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SomeObject</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">Object</span> <span class="n">value</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// do something
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="n">key</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span> <span class="c1">// clear the reference to key
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// do something
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// the entry in the map may be removed if key is not strongly referenced elsewhere
</span></span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªå¼±æ•£åˆ—æ˜ å°„æ¥å­˜å‚¨å¯¹è±¡å¼•ç”¨å’Œç›¸åº”çš„å€¼ã€‚å½“å¯¹è±¡ä¸å†è¢«å¼ºå¼•ç”¨æ—¶ï¼Œå®ƒçš„å¼•ç”¨å¯èƒ½è¢«ä»æ˜ å°„ä¸­åˆ é™¤ï¼Œä»è€Œé¿å…äº†è¿‡æ—¶çš„å¯¹è±¡å¼•ç”¨ã€‚å¼±æ•£åˆ—æ˜ å°„é€šå¸¸ç”¨äºç¼“å­˜å’Œäº‹ä»¶å¤„ç†ç­‰åœºæ™¯ã€‚</p>
<ol start="9">
<li>ä½¿ç”¨ç¼“å­˜</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">SomeObjectCache</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">MAX_SIZE</span> <span class="o">=</span> <span class="n">100</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">SomeObject</span><span class="o">&gt;</span> <span class="n">cache</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedHashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">SomeObject</span><span class="o">&gt;(</span><span class="n">MAX_SIZE</span><span class="o">,</span> <span class="n">0</span><span class="o">.</span><span class="na">75f</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">protected</span> <span class="kt">boolean</span> <span class="nf">removeEldestEntry</span><span class="o">(</span><span class="n">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">SomeObject</span><span class="o">&gt;</span> <span class="n">eldest</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">MAX_SIZE</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kd">static</span> <span class="n">SomeObject</span> <span class="nf">get</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">cache</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">synchronized</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">put</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">,</span> <span class="n">SomeObject</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">cache</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªç¼“å­˜æ¥å­˜å‚¨å¯¹è±¡å¼•ç”¨å’Œç›¸åº”çš„å€¼ã€‚å½“ç¼“å­˜è¾¾åˆ°æœ€å¤§å¤§å°æ—¶ï¼Œæœ€æ—§çš„æ¡ç›®å°†è¢«è‡ªåŠ¨åˆ é™¤ï¼Œä»è€Œé¿å…äº†è¿‡æ—¶çš„å¯¹è±¡å¼•ç”¨ã€‚ç¼“å­˜é€šå¸¸ç”¨äºé¢‘ç¹è®¿é—®çš„æ•°æ®å’Œè®¡ç®—ç»“æœï¼Œå¯ä»¥æé«˜ä»£ç çš„æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§ã€‚</p>
<ol start="10">
<li>ä½¿ç”¨å¯¹è±¡æ± æ¡†æ¶</li>
</ol>
<p>å¯¹è±¡æ± æ¡†æ¶æ˜¯ä¸€ç§ç”¨äºç®¡ç†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„é€šç”¨æ¡†æ¶ï¼Œå¯ä»¥é¿å…è¿‡æ—¶çš„å¯¹è±¡å¼•ç”¨å’Œæé«˜ä»£ç çš„æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§ã€‚ä¸€äº›æµè¡Œçš„å¯¹è±¡æ± æ¡†æ¶åŒ…æ‹¬Apache Commons Poolå’ŒGoogle Guava Cacheã€‚</p>
<h2 id="æ‰©å±•">æ‰©å±•</h2>
<h3 id="å¼±å¼•ç”¨è½¯å¼•ç”¨å’Œè™šå¼•ç”¨åŒºåˆ«">å¼±å¼•ç”¨ã€è½¯å¼•ç”¨å’Œè™šå¼•ç”¨åŒºåˆ«</h3>
<p>å¼±å¼•ç”¨ã€è½¯å¼•ç”¨å’Œè™šå¼•ç”¨æ˜¯Javaä¸­ä¸‰ç§ä¸åŒç±»å‹çš„å¼•ç”¨ï¼Œå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p>
<h4 id="å¼±å¼•ç”¨weakreference">å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰</h4>
<p>å¼±å¼•ç”¨æ˜¯ä¸€ç§è¾ƒå¼±çš„å¼•ç”¨ç±»å‹ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åªè¢«å¼±å¼•ç”¨æ‰€å¼•ç”¨æ—¶ï¼Œå®ƒåœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ—¶ä¼šè¢«å›æ”¶ã€‚</p>
<p>å¼±å¼•ç”¨é€šå¸¸ç”¨äºéœ€è¦ç¼“å­˜å¤§é‡å¯¹è±¡çš„åº”ç”¨åœºæ™¯ï¼Œä¾‹å¦‚ç¼“å­˜å’Œé«˜é€Ÿç¼“å­˜ç­‰ã€‚åœ¨è¿™äº›åœºæ™¯ä¸­ï¼Œä½¿ç”¨å¼±å¼•ç”¨å¯ä»¥é¿å…å ç”¨è¿‡å¤šçš„å†…å­˜ï¼ŒåŒæ—¶åˆå¯ä»¥å¿«é€Ÿè®¿é—®ç¼“å­˜ä¸­çš„å¯¹è±¡ã€‚</p>
<p>åº”è¯¥ä½¿ç”¨å¼±å¼•ç”¨çš„æƒ…å†µåŒ…æ‹¬ï¼š</p>
<ol>
<li>
<p>éœ€è¦ç¼“å­˜å¤§é‡å¯¹è±¡ï¼šä½¿ç”¨å¼±å¼•ç”¨å¯ä»¥é¿å…å ç”¨è¿‡å¤šçš„å†…å­˜ç©ºé—´ï¼Œä»è€Œå¯ä»¥ç¼“å­˜æ›´å¤šçš„å¯¹è±¡ã€‚</p>
</li>
<li>
<p>ä¸éœ€è¦å¿«é€Ÿè®¿é—®ç¼“å­˜ä¸­çš„å¯¹è±¡ï¼šç”±äºå¼±å¼•ç”¨åªæœ‰åœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å›æ”¶ï¼Œå› æ­¤å¯èƒ½ä¼šå¯¼è‡´è¾ƒé•¿çš„è®¿é—®å»¶è¿Ÿã€‚å¦‚æœåº”ç”¨ç¨‹åºå¯ä»¥å®¹å¿è¿™ç§æƒ…å†µï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å¼±å¼•ç”¨ã€‚</p>
</li>
<li>
<p>éœ€è¦é¢‘ç¹çš„åƒåœ¾å›æ”¶ï¼šç”±äºå¼±å¼•ç”¨åªæœ‰åœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å›æ”¶ï¼Œå› æ­¤å¯èƒ½ä¼šå¯¼è‡´é¢‘ç¹çš„åƒåœ¾å›æ”¶ã€‚å¦‚æœåº”ç”¨ç¨‹åºå¯ä»¥å®¹å¿è¿™ç§æƒ…å†µï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å¼±å¼•ç”¨ã€‚</p>
</li>
</ol>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¼±å¼•ç”¨æ¥å®ç°ä¸€ä¸ªç¼“å­˜ï¼Œå½“å†…å­˜ä¸è¶³æ—¶ï¼ŒJVMä¼šè‡ªåŠ¨å›æ”¶å¼±å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡ï¼Œä»è€Œé¿å…å†…å­˜æ³„æ¼å’ŒOOMé”™è¯¯ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">WeakReference</span><span class="o">&lt;</span><span class="n">SomeObject</span><span class="o">&gt;&gt;</span> <span class="n">cache</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">SomeObject</span> <span class="nf">getObject</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">SomeObject</span> <span class="n">obj</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">WeakReference</span><span class="o">&lt;</span><span class="n">SomeObject</span><span class="o">&gt;</span> <span class="n">reference</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">reference</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">obj</span> <span class="o">=</span> <span class="n">reference</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">obj</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">obj</span> <span class="o">=</span> <span class="n">createObject</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">obj</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">cache</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="k">new</span> <span class="n">WeakReference</span><span class="o">&lt;&gt;(</span><span class="n">obj</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">obj</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å¼±å¼•ç”¨æ¥ç¼“å­˜å¯¹è±¡ï¼Œå½“å†…å­˜ä¸è¶³æ—¶ï¼ŒJVMä¼šè‡ªåŠ¨å›æ”¶å¼±å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡ã€‚è¿™æ ·å¯ä»¥é¿å…å ç”¨è¿‡å¤šçš„å†…å­˜ï¼ŒåŒæ—¶åˆå¯ä»¥å¿«é€Ÿè®¿é—®ç¼“å­˜ä¸­çš„å¯¹è±¡ã€‚</p>
<h4 id="è½¯å¼•ç”¨softreference">è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰</h4>
<p>è½¯å¼•ç”¨æ˜¯ä¸€ç§è¾ƒå¼ºçš„å¼•ç”¨ç±»å‹ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åªè¢«è½¯å¼•ç”¨æ‰€å¼•ç”¨æ—¶ï¼Œåªæœ‰åœ¨å†…å­˜ä¸è¶³æ—¶æ‰ä¼šè¢«å›æ”¶ã€‚</p>
<p>è½¯å¼•ç”¨é€šå¸¸ç”¨äºéœ€è¦ç¼“å­˜å¤§é‡å¯¹è±¡çš„åº”ç”¨åœºæ™¯ï¼Œä¾‹å¦‚å›¾ç‰‡ç¼“å­˜ã€æ•°æ®ç¼“å­˜ç­‰ã€‚åœ¨è¿™äº›åœºæ™¯ä¸­ï¼Œä½¿ç”¨è½¯å¼•ç”¨å¯ä»¥é¿å…å ç”¨è¿‡å¤šçš„å†…å­˜ï¼ŒåŒæ—¶åˆå¯ä»¥å¿«é€Ÿè®¿é—®ç¼“å­˜ä¸­çš„å¯¹è±¡ã€‚</p>
<p>åº”è¯¥ä½¿ç”¨è½¯å¼•ç”¨çš„æƒ…å†µåŒ…æ‹¬ï¼š</p>
<ol>
<li>
<p>éœ€è¦ç¼“å­˜å¤§é‡å¯¹è±¡ï¼šä½¿ç”¨è½¯å¼•ç”¨å¯ä»¥é¿å…å ç”¨è¿‡å¤šçš„å†…å­˜ç©ºé—´ï¼Œä»è€Œå¯ä»¥ç¼“å­˜æ›´å¤šçš„å¯¹è±¡ã€‚</p>
</li>
<li>
<p>éœ€è¦å¿«é€Ÿè®¿é—®ç¼“å­˜ä¸­çš„å¯¹è±¡ï¼šä½¿ç”¨è½¯å¼•ç”¨å¯ä»¥å¿«é€Ÿè®¿é—®ç¼“å­˜ä¸­çš„å¯¹è±¡ï¼Œé¿å…é¢‘ç¹åœ°åŠ è½½å’Œè®¡ç®—ã€‚</p>
</li>
<li>
<p>å¯ä»¥å®¹å¿å¶å°”çš„åƒåœ¾å›æ”¶ï¼šç”±äºè½¯å¼•ç”¨åªæœ‰åœ¨å†…å­˜ä¸è¶³æ—¶æ‰ä¼šè¢«å›æ”¶ï¼Œå› æ­¤å¯èƒ½ä¼šå¯¼è‡´å¶å°”çš„åƒåœ¾å›æ”¶ã€‚å¦‚æœåº”ç”¨ç¨‹åºå¯ä»¥å®¹å¿è¿™ç§æƒ…å†µï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨è½¯å¼•ç”¨ã€‚</p>
</li>
</ol>
<p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è½¯å¼•ç”¨æ¥å®ç°ä¸€ä¸ªå›¾ç‰‡ç¼“å­˜ï¼Œå½“å†…å­˜ä¸è¶³æ—¶ï¼ŒJVMä¼šè‡ªåŠ¨å›æ”¶è½¯å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡ï¼Œä»è€Œé¿å…å†…å­˜æ³„æ¼å’ŒOOMé”™è¯¯ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">SoftReference</span><span class="o">&lt;</span><span class="n">Bitmap</span><span class="o">&gt;&gt;</span> <span class="n">imageCache</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">Bitmap</span> <span class="nf">loadImage</span><span class="o">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Bitmap</span> <span class="n">bitmap</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">SoftReference</span><span class="o">&lt;</span><span class="n">Bitmap</span><span class="o">&gt;</span> <span class="n">reference</span> <span class="o">=</span> <span class="n">imageCache</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">reference</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">bitmap</span> <span class="o">=</span> <span class="n">reference</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">bitmap</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">bitmap</span> <span class="o">=</span> <span class="n">downloadImage</span><span class="o">(</span><span class="n">url</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">bitmap</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">imageCache</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="k">new</span> <span class="n">SoftReference</span><span class="o">&lt;&gt;(</span><span class="n">bitmap</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">bitmap</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨è½¯å¼•ç”¨æ¥ç¼“å­˜å›¾ç‰‡ï¼Œå½“å†…å­˜ä¸è¶³æ—¶ï¼ŒJVMä¼šè‡ªåŠ¨å›æ”¶è½¯å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡ã€‚è¿™æ ·å¯ä»¥é¿å…å ç”¨è¿‡å¤šçš„å†…å­˜ï¼ŒåŒæ—¶åˆå¯ä»¥å¿«é€Ÿè®¿é—®ç¼“å­˜ä¸­çš„å›¾ç‰‡ã€‚</p>
<h4 id="è™šå¼•ç”¨phantomreference">è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰</h4>
<p>è™šå¼•ç”¨æ˜¯Javaä¸­å››ç§å¼•ç”¨ç±»å‹ä¸­æœ€å¼±çš„ä¸€ç§ï¼Œå®ƒä¸»è¦ç”¨äºè·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶çš„çŠ¶æ€ã€‚è™šå¼•ç”¨æœ¬èº«å¹¶ä¸ä¼šå¯¹å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸäº§ç”Ÿå½±å“ï¼Œä½†å¯ä»¥åœ¨å¯¹è±¡è¢«åƒåœ¾å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªé€šçŸ¥ï¼Œä»è€Œè¿›è¡Œä¸€äº›æ¸…ç†æˆ–å…¶ä»–æ“ä½œã€‚</p>
<p>è™šå¼•ç”¨çš„ä½¿ç”¨åœºæ™¯æ¯”è¾ƒå°‘ï¼Œä¸€èˆ¬ç”¨äºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<ol>
<li><strong>å¯¹è±¡çš„finalize()æ–¹æ³•ï¼š</strong> è™šå¼•ç”¨å¯ä»¥ç”¨äºå®ç°å¯¹è±¡çš„finalize()æ–¹æ³•ï¼Œå½“å¯¹è±¡è¢«åƒåœ¾å›æ”¶æ—¶ï¼Œè™šå¼•ç”¨ä¼šæ”¶åˆ°ä¸€ä¸ªé€šçŸ¥ï¼Œä»è€Œè§¦å‘å¯¹è±¡çš„finalize()æ–¹æ³•ã€‚</li>
<li><strong>NIO DirectByteBufferå¯¹è±¡çš„é‡Šæ”¾ï¼š</strong> åœ¨ä½¿ç”¨NIOç¼–ç¨‹æ—¶ï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤§é‡çš„DirectByteBufferå¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡å¯èƒ½ä¼šå ç”¨å¤§é‡çš„å†…å­˜ç©ºé—´ã€‚å½“è¿™äº›å¯¹è±¡ä¸å†ä½¿ç”¨æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨è°ƒç”¨System.gc()æ–¹æ³•è§¦å‘ä¸€æ¬¡åƒåœ¾å›æ”¶ï¼Œæ‰èƒ½é‡Šæ”¾è¿™äº›å¯¹è±¡çš„å†…å­˜ã€‚ä½¿ç”¨è™šå¼•ç”¨å¯ä»¥é¿å…æ‰‹åŠ¨è°ƒç”¨System.gc()æ–¹æ³•ï¼Œå½“è¿™äº›å¯¹è±¡è¢«åƒåœ¾å›æ”¶æ—¶ï¼Œè™šå¼•ç”¨ä¼šæ”¶åˆ°ä¸€ä¸ªé€šçŸ¥ï¼Œä»è€Œé‡Šæ”¾è¿™äº›å¯¹è±¡çš„å†…å­˜ã€‚</li>
<li><strong>å¯¹è±¡æ± çš„ç®¡ç†ï¼š</strong> åœ¨ä¸€äº›éœ€è¦é¢‘ç¹åˆ›å»ºå’Œé”€æ¯å¯¹è±¡çš„åº”ç”¨åœºæ™¯ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¯¹è±¡æ± æ¥æé«˜æ€§èƒ½ã€‚å½“å¯¹è±¡ä¸å†ä½¿ç”¨æ—¶ï¼Œå¯ä»¥å°†å¯¹è±¡æ”¾å…¥è™šå¼•ç”¨ä¸­ï¼Œå½“å¯¹è±¡è¢«åƒåœ¾å›æ”¶æ—¶ï¼Œè™šå¼•ç”¨ä¼šæ”¶åˆ°ä¸€ä¸ªé€šçŸ¥ï¼Œä»è€Œå°†å¯¹è±¡ä»å¯¹è±¡æ± ä¸­ç§»é™¤ã€‚</li>
</ol>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™šå¼•ç”¨ä¸é€‚ç”¨äºç¼“å­˜æˆ–å…¶ä»–éœ€è¦å¿«é€Ÿè®¿é—®å¯¹è±¡çš„åº”ç”¨åœºæ™¯ï¼Œå› ä¸ºè™šå¼•ç”¨æœ¬èº«å¹¶ä¸ä¿è¯å¯¹è±¡çš„å¯ç”¨æ€§å’Œå¯è®¿é—®æ€§ã€‚</p>
<blockquote>
<p>å› æ­¤ï¼Œè½¯å¼•ç”¨å’Œå¼±å¼•ç”¨çš„ä¸»è¦åŒºåˆ«åœ¨äºå®ƒä»¬çš„å¼ºåº¦å’Œåƒåœ¾å›æ”¶çš„æ—¶æœºã€‚è½¯å¼•ç”¨æ¯”å¼±å¼•ç”¨æ›´å¼ºï¼Œåªæœ‰åœ¨å†…å­˜ä¸è¶³æ—¶æ‰ä¼šè¢«å›æ”¶ï¼Œè€Œå¼±å¼•ç”¨åˆ™æ›´å¼±ï¼Œåªæœ‰åœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å›æ”¶ã€‚åŒæ—¶ï¼Œä½¿ç”¨è½¯å¼•ç”¨å¯èƒ½ä¼šå¯¼è‡´æ›´å°‘çš„åƒåœ¾å›æ”¶ï¼Œä½†å¯èƒ½ä¼šå ç”¨æ›´å¤šçš„å†…å­˜ç©ºé—´ï¼Œè€Œä½¿ç”¨å¼±å¼•ç”¨å¯èƒ½ä¼šå¯¼è‡´æ›´é¢‘ç¹çš„åƒåœ¾å›æ”¶ï¼Œä½†å¯ä»¥æ›´å¿«åœ°é‡Šæ”¾å†…å­˜ç©ºé—´ã€‚</p>
</blockquote>
<h3 id="å¼±å¼•ç”¨æ˜¯å¦ä¼šå½±å“ç¨‹åºçš„æ€§èƒ½">å¼±å¼•ç”¨æ˜¯å¦ä¼šå½±å“ç¨‹åºçš„æ€§èƒ½ï¼Ÿ</h3>
<p><code>å¼±å¼•ç”¨å¯èƒ½ä¼šå½±å“ç¨‹åºçš„æ€§èƒ½ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ä¼šå¯¼è‡´é¢‘ç¹çš„åƒåœ¾å›æ”¶ã€‚</code>ç”±äºå¼±å¼•ç”¨<code>åªæœ‰åœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å›æ”¶</code>ï¼Œå› æ­¤å½“ä½¿ç”¨å¤§é‡çš„å¼±å¼•ç”¨æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ›´é¢‘ç¹çš„åƒåœ¾å›æ”¶ï¼Œä»è€Œé™ä½ç¨‹åºçš„æ€§èƒ½ã€‚</p>
<p>å½“ä¸€ä¸ªå¯¹è±¡åªè¢«å¼±å¼•ç”¨æ‰€å¼•ç”¨æ—¶ï¼Œåœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ—¶å®ƒä¼šè¢«å›æ”¶ã€‚å¦‚æœåº”ç”¨ç¨‹åºä¸­å­˜åœ¨å¤§é‡çš„å¼±å¼•ç”¨å¯¹è±¡ï¼Œæ¯æ¬¡åƒåœ¾å›æ”¶éƒ½éœ€è¦æ‰«æè¿™äº›å¯¹è±¡ï¼Œä»è€Œå¢åŠ äº†åƒåœ¾å›æ”¶çš„æ—¶é—´å’Œå¼€é”€ã€‚</p>
<p>å› æ­¤ï¼Œåœ¨ä½¿ç”¨å¼±å¼•ç”¨æ—¶éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li>ä¸è¦è¿‡åº¦ä½¿ç”¨å¼±å¼•ç”¨ï¼šå¦‚æœåº”ç”¨ç¨‹åºä¸­å­˜åœ¨å¤§é‡çš„å¼±å¼•ç”¨å¯¹è±¡ï¼Œå¯èƒ½ä¼šå¯¼è‡´é¢‘ç¹çš„åƒåœ¾å›æ”¶ï¼Œä»è€Œå½±å“ç¨‹åºçš„æ€§èƒ½ã€‚å› æ­¤ï¼Œåº”è¯¥é¿å…è¿‡åº¦ä½¿ç”¨å¼±å¼•ç”¨ï¼Œå°½å¯èƒ½å‡å°‘å¼±å¼•ç”¨å¯¹è±¡çš„æ•°é‡ã€‚</li>
<li>æ³¨æ„åƒåœ¾å›æ”¶çš„æ—¶æœºï¼šå¼±å¼•ç”¨åªåœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å›æ”¶ï¼Œå› æ­¤å¯èƒ½ä¼šå¯¼è‡´è¾ƒé•¿çš„è®¿é—®å»¶è¿Ÿã€‚åœ¨ä½¿ç”¨å¼±å¼•ç”¨æ—¶éœ€è¦æ³¨æ„åƒåœ¾å›æ”¶çš„æ—¶æœºï¼Œå¦‚æœåº”ç”¨ç¨‹åºéœ€è¦å¿«é€Ÿè®¿é—®ç¼“å­˜ä¸­çš„å¯¹è±¡ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨å…¶ä»–ç±»å‹çš„å¼•ç”¨ã€‚</li>
<li>æ£€æŸ¥å¼±å¼•ç”¨æ˜¯å¦è¢«å›æ”¶ï¼šå½“ä¸€ä¸ªå¯¹è±¡åªè¢«å¼±å¼•ç”¨æ‰€å¼•ç”¨æ—¶ï¼Œå®ƒåœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ—¶ä¼šè¢«å›æ”¶ã€‚åœ¨ä½¿ç”¨å¼±å¼•ç”¨æ—¶éœ€è¦æ³¨æ„æ£€æŸ¥å¼±å¼•ç”¨å¯¹è±¡æ˜¯å¦è¢«å›æ”¶ï¼Œé¿å…å¼•ç”¨æ— æ•ˆçš„å¯¹è±¡ã€‚</li>
</ol>
<h3 id="å¦‚ä½•æ£€æŸ¥å¼±å¼•ç”¨å¯¹è±¡æ˜¯å¦è¢«å›æ”¶">å¦‚ä½•æ£€æŸ¥å¼±å¼•ç”¨å¯¹è±¡æ˜¯å¦è¢«å›æ”¶ï¼Ÿ</h3>
<p>åœ¨Javaä¸­ï¼Œå¯ä»¥é€šè¿‡è·å–å¼±å¼•ç”¨å¯¹è±¡çš„get()æ–¹æ³•è¿”å›çš„å¯¹è±¡æ¥æ£€æŸ¥å¼•ç”¨å¯¹è±¡æ˜¯å¦è¢«å›æ”¶ã€‚å½“ä¸€ä¸ªå¼±å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«å›æ”¶åï¼Œget()æ–¹æ³•è¿”å›çš„å¯¹è±¡å°†ä¸ºnullã€‚</p>
<p>ä¾‹å¦‚ï¼Œä»¥ä¸‹ç¤ºä¾‹ä»£ç æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨å¼±å¼•ç”¨æ£€æŸ¥å¯¹è±¡æ˜¯å¦è¢«å›æ”¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">WeakReference</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">weakRef</span> <span class="o">=</span> <span class="k">new</span> <span class="n">WeakReference</span><span class="o">&lt;&gt;(</span><span class="n">obj</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ£€æŸ¥å¯¹è±¡æ˜¯å¦è¢«å›æ”¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="o">(</span><span class="n">weakRef</span><span class="o">.</span><span class="na">get</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å¯¹è±¡æœªè¢«å›æ”¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Object is alive&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å¯¹è±¡å·²è¢«å›æ”¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Object has been collected&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä½¿ç”¨å¼±å¼•ç”¨æ¥å¼•ç”¨å®ƒã€‚ç„¶åï¼Œæˆ‘ä»¬é€šè¿‡æ£€æŸ¥å¼±å¼•ç”¨å¯¹è±¡çš„get()æ–¹æ³•è¿”å›çš„å¯¹è±¡æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦è¢«å›æ”¶ã€‚</p>
<p>å½“å¯¹è±¡æœªè¢«å›æ”¶æ—¶ï¼Œget()æ–¹æ³•è¿”å›çš„å¯¹è±¡ä¸ä¸ºnullï¼Œè¡¨ç¤ºå¯¹è±¡ä»ç„¶å­˜æ´»ã€‚å½“å¯¹è±¡è¢«å›æ”¶æ—¶ï¼Œget()æ–¹æ³•è¿”å›çš„å¯¹è±¡ä¸ºnullï¼Œè¡¨ç¤ºå¯¹è±¡å·²ç»è¢«å›æ”¶ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºå¼±å¼•ç”¨åªåœ¨ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶æ—¶æ‰ä¼šè¢«å›æ”¶ï¼Œå› æ­¤åœ¨ä½¿ç”¨å¼±å¼•ç”¨æ£€æŸ¥å¯¹è±¡æ˜¯å¦è¢«å›æ”¶æ—¶ï¼Œéœ€è¦æ³¨æ„åƒåœ¾å›æ”¶çš„æ—¶æœºã€‚å¦‚æœåº”ç”¨ç¨‹åºéœ€è¦ç«‹å³æ£€æŸ¥å¯¹è±¡æ˜¯å¦è¢«å›æ”¶ï¼Œå¯ä»¥æ‰‹åŠ¨è§¦å‘ä¸€æ¬¡åƒåœ¾å›æ”¶ï¼Œä¾‹å¦‚é€šè¿‡<code>System.gc()</code>æ–¹æ³•æ¥è§¦å‘ã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>ã€ŠEffective Java 3ã€‹ç¬”è®°4ï¼šç”¨ç§æœ‰æ„é€ å‡½æ•°ä½¿ç±»ä¸å¯å®ä¾‹åŒ–</title>
      <link>https://blog.chensoul.com/posts/2023/05/05/enforce-noninstantiability-with-a-private-constructor/</link>
      <pubDate>Fri, 05 May 2023 08:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/05/05/enforce-noninstantiability-with-a-private-constructor/</guid>
      <description>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼šç”¨ç§æœ‰æ„é€ å‡½æ•°ä½¿ç±»ä¸å¯å®ä¾‹åŒ–ã€‚ ä»‹ç» ä½¿ç”¨ç§æœ‰æ„é€ å‡½æ•°å¼ºåˆ¶å®ç°ä¸å¯å®ä¾‹åŒ–çš„ä¸»è¦åŸå› æ˜¯é˜²æ­¢ç±»è¢«æ„</description>
      <content:encoded><![CDATA[<p>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼šç”¨ç§æœ‰æ„é€ å‡½æ•°ä½¿ç±»ä¸å¯å®ä¾‹åŒ–ã€‚</p>
<h2 id="ä»‹ç»">ä»‹ç»</h2>
<p>ä½¿ç”¨ç§æœ‰æ„é€ å‡½æ•°å¼ºåˆ¶å®ç°ä¸å¯å®ä¾‹åŒ–çš„ä¸»è¦åŸå› æ˜¯é˜²æ­¢ç±»è¢«æ„å¤–åœ°å®ä¾‹åŒ–ï¼Œä»¥ä½¿ä»£ç æ›´åŠ å¥å£®å’Œå¯é ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ç±»ä¸­çš„é™æ€æ–¹æ³•å’Œé™æ€å­—æ®µï¼Œè€Œä¸éœ€è¦åˆ›å»ºè¯¥ç±»çš„å®ä¾‹ã€‚å¦‚æœç±»ä¸­æ²¡æœ‰æ˜¾å¼åœ°å®šä¹‰ç§æœ‰æ„é€ å‡½æ•°ï¼ŒJavaç¼–è¯‘å™¨å°†ä¼šè‡ªåŠ¨ä¸ºè¯¥ç±»ç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„å…¬å…±æ„é€ å‡½æ•°ï¼Œè¿™æ„å‘³ç€è¯¥ç±»å¯ä»¥åœ¨å…¶ä»–ç±»ä¸­è¢«å®ä¾‹åŒ–ã€‚å¦‚æœè¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œä¸ºäº†é˜²æ­¢å…¶ä»–äººæ„å¤–åœ°å®ä¾‹åŒ–æˆ‘ä»¬çš„ç±»ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ„é€ å‡½æ•°è®¾ç½®ä¸ºç§æœ‰ã€‚</p>
<p>æ­¤å¤–ï¼Œä½¿ç”¨ç§æœ‰æ„é€ å‡½æ•°å¼ºåˆ¶å®ç°ä¸å¯å®ä¾‹åŒ–è¿˜æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š</p>
<ol>
<li>æ˜ç¡®è¡¨æ˜è¯¥ç±»ä¸å¯è¢«å®ä¾‹åŒ–ï¼Œæé«˜äº†ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</li>
<li>é˜²æ­¢ç±»è¢«å­ç±»åŒ–ï¼Œä»è€Œé¿å…äº†ç»§æ‰¿æ‰€å¸¦æ¥çš„å‰¯ä½œç”¨å’Œä¸å¿…è¦çš„å¤æ‚æ€§ã€‚</li>
<li>æé«˜äº†ä»£ç çš„å®‰å…¨æ€§ï¼Œé˜²æ­¢å…¶ä»–ç±»åœ¨ä¸åˆé€‚çš„æƒ…å†µä¸‹å®ä¾‹åŒ–è¯¥ç±»ã€‚</li>
</ol>
<p>è¿™æ˜¯ä¸€ä¸ªå®ç°äº†ç§æœ‰æ„é€ å‡½æ•°å¼ºåˆ¶å®ç°ä¸å¯å®ä¾‹åŒ–çš„ç±»çš„ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UtilityClass</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ç¦æ­¢é»˜è®¤æ„é€ å‡½æ•°é˜²æ­¢å®ä¾‹åŒ–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">private</span> <span class="nf">UtilityClass</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">throw</span> <span class="k">new</span> <span class="n">AssertionError</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// å…¶ä»–é™æ€æ–¹æ³•å’Œå­—æ®µ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>è¿™ä¸ªç±»ä¸­çš„ç§æœ‰æ„é€ å‡½æ•°ä¼šåœ¨è¢«è°ƒç”¨æ—¶æŠ›å‡º<code>AssertionError</code>ã€‚è¿™æ ·åšå¯ä»¥ç¡®ä¿æ„é€ å‡½æ•°æ°¸è¿œä¸ä¼šä»ç±»å†…éƒ¨æˆ–å¤–éƒ¨è°ƒç”¨ã€‚</p>
<p>é€šè¿‡å°†æ„é€ å‡½æ•°è®¾ç½®ä¸ºç§æœ‰ï¼Œè¿™ä¸ªç±»å°±ä¸èƒ½ä»å¤–éƒ¨è¢«å®ä¾‹åŒ–ã€‚è¿™ä¸ªä¹ æƒ¯ç”¨æ³•ä¹Ÿé˜²æ­¢äº†ç±»è¢«å­ç±»åŒ–ã€‚å¦‚æœä¸€ä¸ªç±»çš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ï¼Œé‚£ä¹ˆå®ƒä¸èƒ½è¢«å­ç±»è°ƒç”¨ï¼Œå› ä¸ºå­ç±»å¿…é¡»è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°æ¥å®Œæˆåˆå§‹åŒ–ã€‚å› æ­¤ï¼Œå¦‚æœä¸€ä¸ªç±»çš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ï¼Œå®ƒå°±ä¸èƒ½è¢«å­ç±»åŒ–ï¼Œå› ä¸ºå­ç±»ä¸èƒ½è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°æ¥å®Œæˆåˆå§‹åŒ–ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ç§æœ‰æ„é€ å‡½æ•°é˜²æ­¢ç±»è¢«å­ç±»åŒ–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">FinalClass</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">FinalClass</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// private constructor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// do something
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>FinalClass</code>è¢«å£°æ˜ä¸º<code>final</code>ï¼Œå› æ­¤ä¸èƒ½è¢«å­ç±»åŒ–ã€‚æ­¤å¤–ï¼Œå®ƒçš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ï¼Œå› æ­¤ä¸èƒ½ä»å­ç±»ä¸­è¢«è°ƒç”¨ã€‚ç”±äºè¯¥ç±»ä¸èƒ½è¢«å­ç±»åŒ–ï¼Œå› æ­¤å®ƒçš„è¡Œä¸ºä¸ä¼šå—åˆ°å­ç±»çš„å½±å“ï¼Œä»è€Œé¿å…äº†ç»§æ‰¿æ‰€å¸¦æ¥çš„å‰¯ä½œç”¨å’Œä¸å¿…è¦çš„å¤æ‚æ€§ã€‚</p>
<p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå°†ç±»è®¾ç½®ä¸ºä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œä½†å¯ä»¥è¢«å­ç±»åŒ–æ˜¯æœ‰ç”¨çš„ã€‚è¿™é€šå¸¸æ˜¯å› ä¸ºæˆ‘ä»¬å¸Œæœ›å­ç±»åŒ–çš„ç±»èƒ½å¤Ÿç»§æ‰¿çˆ¶ç±»çš„è¡Œä¸ºå’Œå±æ€§ï¼ŒåŒæ—¶åˆä¸å¸Œæœ›å¤–éƒ¨èƒ½å¤Ÿå®ä¾‹åŒ–è¯¥ç±»ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Animal</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="nf">Animal</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">makeSound</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Dog</span> <span class="kd">extends</span> <span class="n">Animal</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">Dog</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">super</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">makeSound</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Woof!&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>Animal</code>ç±»è¢«è®¾ç½®ä¸ºæŠ½è±¡ç±»ï¼Œå®ƒçš„æ„é€ å‡½æ•°è¢«è®¾ç½®ä¸º<code>protected</code>ï¼Œè¿™æ„å‘³ç€è¯¥ç±»ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œä½†å¯ä»¥è¢«å­ç±»åŒ–ã€‚<code>Dog</code>ç±»ç»§æ‰¿äº†<code>Animal</code>ç±»ï¼Œå¹¶å®ç°äº†<code>makeSound()</code>æ–¹æ³•ã€‚ç”±äº<code>Animal</code>ç±»çš„æ„é€ å‡½æ•°è¢«è®¾ç½®ä¸º<code>protected</code>ï¼Œæ‰€ä»¥<code>Dog</code>ç±»å¯ä»¥è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°æ¥è¿›è¡Œåˆå§‹åŒ–ã€‚</p>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›<code>Animal</code>ç±»èƒ½å¤Ÿæä¾›ä¸€äº›é€šç”¨çš„è¡Œä¸ºå’Œå±æ€§ï¼ŒåŒæ—¶åˆä¸å¸Œæœ›å¤–éƒ¨èƒ½å¤Ÿå®ä¾‹åŒ–è¯¥ç±»ï¼Œå› ä¸º<code>Animal</code>ç±»æœ¬èº«å¹¶ä¸æ˜¯ä¸€ç§å…·ä½“çš„åŠ¨ç‰©ã€‚è€Œ<code>Dog</code>ç±»ä½œä¸º<code>Animal</code>ç±»çš„å­ç±»ï¼Œå¯ä»¥ç»§æ‰¿<code>Animal</code>ç±»çš„è¡Œä¸ºå’Œå±æ€§ï¼Œå¹¶å®ç°è‡ªå·±çš„ç‰¹å®šè¡Œä¸ºï¼Œä»¥å®ç°å…·ä½“çš„åŠŸèƒ½ã€‚</p>
<h2 id="ç”¨é€”">ç”¨é€”</h2>
<p>ç§æœ‰æ„é€ å‡½æ•°è¿˜æœ‰å…¶ä»–ä¸€äº›ç”¨é€”ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ç”¨é€”ï¼š</p>
<ol>
<li>
<p>é˜²æ­¢å®ä¾‹åŒ–ï¼šç§æœ‰æ„é€ å‡½æ•°å¯ä»¥é˜²æ­¢ç±»è¢«å®ä¾‹åŒ–ï¼Œè¿™å¯¹äºåªåŒ…å«é™æ€æ–¹æ³•å’Œé™æ€å­—æ®µçš„å®ç”¨å·¥å…·ç±»éå¸¸æœ‰ç”¨ã€‚è¿™äº›ç±»å¯ä»¥é€šè¿‡å°†æ„é€ å‡½æ•°è®¾ç½®ä¸ºç§æœ‰æ¥é˜²æ­¢å®ƒä»¬è¢«å®ä¾‹åŒ–ï¼Œä»è€Œé¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»ºå’Œèµ„æºæµªè´¹ã€‚</p>
</li>
<li>
<p>å¼ºåˆ¶å®ç°å•ä¾‹ï¼šå•ä¾‹æ¨¡å¼æ˜¯ä¸€ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒè¦æ±‚ä¸€ä¸ªç±»æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ã€‚ç§æœ‰æ„é€ å‡½æ•°å¯ä»¥å¼ºåˆ¶å®ç°å•ä¾‹æ¨¡å¼ï¼Œå› ä¸ºå®ƒå¯ä»¥é˜²æ­¢ç±»è¢«å®ä¾‹åŒ–ï¼Œé™¤éç±»çš„å†…éƒ¨å®šä¹‰äº†ä¸€ä¸ªé™æ€å®ä¾‹å¹¶æä¾›äº†ä¸€ä¸ªå…¬å…±çš„é™æ€è®¿é—®æ–¹æ³•ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Singleton</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Singleton</span> <span class="n">instance</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">Singleton</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// private constructor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Singleton</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Singleton</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>Singleton</code>ç±»çš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ï¼Œå› æ­¤å®ƒä¸èƒ½è¢«å…¶ä»–ç±»å®ä¾‹åŒ–ã€‚<code>getInstance()</code>æ–¹æ³•æä¾›äº†ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ï¼Œå¹¶åœ¨éœ€è¦æ—¶åˆ›å»ºäº†ä¸€ä¸ªé™æ€å®ä¾‹ã€‚ç”±äºæ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ï¼Œå› æ­¤åªæœ‰<code>Singleton</code>ç±»çš„å†…éƒ¨æ‰èƒ½åˆ›å»ºå®ä¾‹ï¼Œä»è€Œå®ç°äº†å•ä¾‹æ¨¡å¼ã€‚</p>
</li>
<li>
<p>é˜²æ­¢å­ç±»åŒ–ï¼šç§æœ‰æ„é€ å‡½æ•°å¯ä»¥é˜²æ­¢ç±»è¢«å­ç±»åŒ–ï¼Œä»è€Œé¿å…äº†ç»§æ‰¿æ‰€å¸¦æ¥çš„å‰¯ä½œç”¨å’Œä¸å¿…è¦çš„å¤æ‚æ€§ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">FinalClass</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">FinalClass</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// private constructor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// do something
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>FinalClass</code>ç±»è¢«å£°æ˜ä¸º<code>final</code>ï¼Œå®ƒçš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ï¼Œå› æ­¤å®ƒä¸èƒ½è¢«å­ç±»åŒ–ã€‚è¯¥ç±»æä¾›äº†ä¸€äº›é™æ€æ–¹æ³•ï¼Œå¯ä»¥åœ¨å…¶ä»–ç±»ä¸­è°ƒç”¨ï¼Œä½†æ˜¯ä¸èƒ½è¢«å­ç±»åŒ–ã€‚</p>
</li>
<li>
<p>é™åˆ¶ç»§æ‰¿ï¼šå¦‚æœä¸€ä¸ªç±»çš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ï¼Œé‚£ä¹ˆå®ƒä¸èƒ½è¢«ç»§æ‰¿ï¼Œè¿™å¯ä»¥ç”¨æ¥é™åˆ¶ç±»çš„ç»§æ‰¿ã€‚</p>
</li>
<li>
<p>å®ç°å·¥å‚æ–¹æ³•ï¼šå·¥å‚æ–¹æ³•æ˜¯ä¸€ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œä½†æ˜¯å°†å…·ä½“çš„å¯¹è±¡åˆ›å»ºè¿‡ç¨‹ç•™ç»™äº†å­ç±»æˆ–å…·ä½“çš„å®ç°ç±»ã€‚ç§æœ‰æ„é€ å‡½æ•°å¯ä»¥ä¸å·¥å‚æ–¹æ³•ä¸€èµ·ä½¿ç”¨ï¼Œä»¥ç¡®ä¿åªæœ‰å·¥å‚æ–¹æ³•èƒ½å¤Ÿåˆ›å»ºå¯¹è±¡ï¼Œä»è€Œä½¿å¯¹è±¡åˆ›å»ºè¿‡ç¨‹æ›´åŠ å¯æ§å’Œå®‰å…¨ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Shape</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">Shape</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// private constructor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Shape</span> <span class="nf">createRectangle</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">Rectangle</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Shape</span> <span class="nf">createCircle</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">Circle</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">Rectangle</span> <span class="kd">extends</span> <span class="n">Shape</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">Rectangle</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// constructor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">Circle</span> <span class="kd">extends</span> <span class="n">Shape</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">Circle</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// constructor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>Shape</code>ç±»çš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ï¼Œå› æ­¤å®ƒä¸èƒ½è¢«å®ä¾‹åŒ–ã€‚<code>Shape</code>ç±»æä¾›äº†ä¸¤ä¸ªé™æ€å·¥å‚æ–¹æ³•ï¼Œ<code>createRectangle()</code>å’Œ<code>createCircle()</code>ï¼Œç”¨äºåˆ›å»ºä¸åŒçš„å½¢çŠ¶ã€‚<code>Rectangle</code>å’Œ<code>Circle</code>ç±»ç»§æ‰¿è‡ª<code>Shape</code>ç±»ï¼Œå¹¶å®ç°äº†è‡ªå·±çš„æ„é€ å‡½æ•°ã€‚</p>
</li>
</ol>
]]></content:encoded>
    </item>
    
    <item>
      <title>å‘¨æŠ¥-16ï½œã€ŠçŒç¯®é«˜æ‰‹ã€‹ç”µå½±ã€ã€Šæ˜¥å±±å¦‚ç¬‘ã€‹è¯å‰§</title>
      <link>https://blog.chensoul.com/posts/2023/04/25/weekly_review_16/</link>
      <pubDate>Tue, 25 Apr 2023 08:30:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/04/25/weekly_review_16/</guid>
      <description>å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-04-17 åˆ° 2023-04-23 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚ è¿™å‘¨çš„å·¥ä½œï¼Œæ‰‹ä¸Šç´¯ç§¯äº†ä¸‰ä¸ªè¿­ä»£ç‰ˆæœ¬ï¼Œå› ä¸ºä¸´è¿‘äº”ä¸€</description>
      <content:encoded><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-16-01.png" alt="weekly-review-16-01"  />
</p>
<p>æœ¬ç¯‡æ˜¯å¯¹ <code>2023-04-17</code> åˆ° <code>2023-04-23</code> è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº <a href="https://blog.chensoul.com/">åšå®¢</a>ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚</p>
<p>è¿™å‘¨çš„å·¥ä½œï¼Œæ‰‹ä¸Šç´¯ç§¯äº†ä¸‰ä¸ªè¿­ä»£ç‰ˆæœ¬ï¼Œå› ä¸ºä¸´è¿‘äº”ä¸€åŠå…¶ä»–åŸå› ï¼ŒçŸ­æœŸå†…æ— æ³•å‘å¸ƒä¸Šçº¿ã€‚å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæƒ³ç€è¿™äº›ç‰ˆæœ¬éƒ½ä¼šä¸€ä¸ªä¸ªä¸Šçº¿ï¼Œæ‰€ä»¥ä¸‰ä¸ªç‰ˆæœ¬ä¹‹é—´åˆå¹¶äº†ä»£ç ï¼Œå­˜åœ¨äº†ä¾èµ–å…³ç³»ã€‚ä»¥åï¼Œè¿˜æ˜¯éœ€è¦å°ç‰ˆæœ¬è¿­ä»£ã€ä¸Šä¸€ä¸ªç‰ˆæœ¬å‘å¸ƒä¹‹åå†ä» main åˆ†æ”¯åˆå¹¶ä»£ç ã€‚</p>
<p>è¿™å‘¨å…ˆåçœ‹äº†ã€ŠçŒç¯®é«˜æ‰‹ã€‹ç”µå½±ã€ã€Šæ˜¥å±±å¦‚ç¬‘ã€‹è¯å‰§ï¼Œä½“éªŒäº†ä¸¤ç§è‰ºæœ¯è¡¨ç°å½¢å¼ï¼Œéƒ½è®©äººå¤±æœ›ã€‚</p>
<p>åˆ©ç”¨ç©ºä½™æ—¶é—´ï¼Œå°† n8n è¿›è¡Œäº†è°ƒæ•´ï¼Œåªå°†æˆ‘åœ¨è±†ç“£ã€githubã€spotifyã€blogã€stravaä¸Šçš„æ´»åŠ¨åŒæ­¥åˆ°telegramï¼Œè€Œç›´æ¥ä¸åŒæ­¥åˆ° memosï¼Œå•ç‹¬åˆ›å»ºä¸€ä¸ª workflow å°† telegram åŒæ­¥åˆ° memosã€‚è¿™æ · telegram æ˜¯ä¸€ä¸ªå¯¹å¤–åˆ†äº«çš„é¢‘é“ï¼Œè€Œ memos å¯ä»¥åˆ†äº«ä¸€äº›ä¸ªäººçš„å¿ƒæƒ…æˆ–è€…è¯´è¯´ã€‚å¦å¤–ï¼Œä¸ºäº†å‡å°‘å¯¹å¤§å®¶çš„å¹²æ‰°ï¼Œä¸å†å°† rss è®¢é˜…å†…å®¹åŒæ­¥åˆ°æˆ‘çš„ <a href="https://t.me/chensoul_share">telegram é¢‘é“</a>ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-16-16.png" alt="weekly-review-16-16"  />
</p>
<h2 id="çŒç¯®é«˜æ‰‹">çŒç¯®é«˜æ‰‹</h2>
<p>4æœˆ20æ—¥ï¼ŒçŒç¯®é«˜æ‰‹å›½å†…ä¸Šæ˜ ï¼ŒæŠ½æ—¶é—´ä¸‹ç­å’Œè€å©†å»çœ‹äº†è¿™åœºç”µå½±ã€‚çœ‹å®Œä¹‹åå‘äº†ä¸€ä¸ªæœ‹å‹åœˆï¼š</p>
<blockquote>
<p>ä¸¤ä¸ªå°æ—¶çš„ç”µå½±ï¼Œä¸€åœºç¯®çƒæ¯”èµ›ï¼Œå°½æ˜¯å›å¿†ï¼Œç•™ä¸‹çš„æ˜¯åŠäº©è‰¯ç”°åŠäº©å·®è¯„</p>
</blockquote>
<p>è¿™å°±æ˜¯æˆ‘å¯¹è¿™ä¸ªç”µå½±çš„è¯„ä»·ã€‚å› ä¸ºæƒ…æ€€è€Œå»çœ‹äº†è¿™éƒ¨ç”µå½±ï¼Œå´è¢«æƒ…æ€€å‡ºå–äº†ï¼Œè¿™å¹´å¤´æƒ…æ€€ä¸å€¼é’±äº†ä¹ˆï¼Ÿæ•´éƒ¨ç”µå½±ä»¥å®«åŸè‰¯ç”°ä¸ºè§†è§’ï¼Œä¸åœçš„å›å¿†ï¼Œå››ååˆ†é’Ÿçš„æ¯”èµ›èŠ‚å¥ä¸åœçš„ä¸­æ–­ã€‚å¾ˆå¤šç‰‡æ®µéƒ½æ˜¯åŠ¨ç”»é‡Œçš„å†…å®¹ï¼Œæ²¡æœ‰å¤šå°‘æ–°å†…å®¹ã€‚æµå·æ«çš„åˆ»ç”»å¤ªå°‘ã€æ¨±æœ¨èŠ±é“è¿˜æ˜¯é‚£æ ·å‹‡çŒ›ã€æ™´å­å°±æ²¡å‡ºç°å‡ æ¬¡ã€‚ã€‚ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-16-11.jpeg" alt="weekly-review-16-11"  />
</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-16-12.jpeg" alt="weekly-review-16-12"  />
</p>
<h2 id="çœ‹è¯å‰§">çœ‹è¯å‰§</h2>
<p>å‘¨å…­å»ä¸­å—å‰§åœºçœ‹äº†ä¸€ä¸ªè¯å‰§ã€Šæ˜¥å±±å¦‚ç¬‘ã€‹ï¼Œè¿™æ˜¯ç¬¬ä¸€æ¬¡çœ‹è¯å‰§ï¼Œç¬¬ä¸€æ¬¡æ¥è§¦è¯å‰§è¿™ä¸ªè‰ºæœ¯è¡¨ç°å½¢å¼ã€‚ç›¸æ¯”è¾ƒäºç”µå½±ï¼Œæˆ‘è¿˜æ˜¯æ›´å–œæ¬¢çœ‹ç”µå½±ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-16-13.jpeg" alt="weekly-review-16-13"  />
</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-16-14.jpeg" alt="weekly-review-16-14"  />
</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-16-15.jpeg" alt="weekly-review-16-15"  />
</p>
<h2 id="ç†è´¢">ç†è´¢</h2>
<p>è¿™å‘¨æ€»è®¡æ”¯å‡º 292.5 å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š</p>
<ul>
<li>4æœˆ21æ—¥ï¼š59å…ƒï¼Œå’ŒåŒäº‹ä¸€èµ·åƒé¥­</li>
<li>4æœˆ22æ—¥ï¼š232å…ƒï¼Œå‘¨æœ«ä¹°èœåšé¥­ï¼Œä¹°æ°´æœ</li>
<li>4æœˆ24æ—¥ï¼š1.5å…ƒï¼Œè·‘æ­¥å°è…¿æŠ½ç­‹ï¼Œéª‘å…±äº«å•è½¦å›å…¬å¸</li>
</ul>
<p>å››æœˆç´¯è®¡æ”¯å‡ºå…± 2417 å…ƒï¼Œå…¶ä¸­é¤é¥®å’Œè´­ç‰©å äº†ä¸€åŠã€‚</p>
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-16-09.jpeg" alt="weekly-review-16-09" style="width:50%;" />
<h2 id="å¥èº«">å¥èº«</h2>
<p>æ¯å¤©èµ°ä¸€ä¸‡æ­¥ï¼Œè¿™å‘¨å®Œæˆäº†ç›®æ ‡ã€‚ä»¥åæ¯å¤©è·‘æ­¥çš„è¯ï¼Œè¿™ä¸ªç›®æ ‡å°±å¾ˆå®¹æ˜“è¾¾æˆäº†ï¼Œç”šè‡³è¿™ä¸ªç›®æ ‡ä¼šæ¢æˆæ¯å¤©è·‘æ­¥ã€‚</p>
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-16-10.jpeg" alt="weekly-review-16-10" style="width:50%;" />
<p>ä» strava çš„è®­ç»ƒæ—¥å¿—ï¼Œå¯ä»¥çœ‹åˆ°æœ¬å‘¨è¿åŠ¨è®°å½•å¦‚ä¸‹ï¼š</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-16-07.png" alt="weekly-review-16-07"  />
</p>
<p>ä» strava çš„è®­ç»ƒæ—¥å†ï¼Œå¯ä»¥çœ‹åˆ°æˆªè‡³24æ—¥ï¼Œæœ¬æœˆè¿åŠ¨äº†20å¤©ï¼Œ23æ¬¡ï¼Œä¸€å…±è·‘æ­¥äº†100å…¬é‡Œã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-16-08.png" alt="weekly-review-16-08"  />
</p>
<h2 id="å·¥ä½œ">å·¥ä½œ</h2>
<h3 id="effective-java-3-ç¬”è®°">Effective Java 3 ç¬”è®°</h3>
<p>è¯·å‚è€ƒã€Š<a href="https://blog.chensoul.com/posts/2023/04/24/avoid-creating-unnecessary-objects/">ã€ŠEffective Java 3ã€‹ç¬”è®°ï¼šé¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡</a>ã€‹ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-16-02.png" alt="weekly-review-16-02"  />
</p>
<p>ä¸Šé¢è¿™ä¸ªå›¾æ˜¯ä½¿ç”¨ <a href="https://shots.so/">Shots</a>  åˆ¶ä½œçš„ï¼Œå®ƒæ˜¯å…è´¹çš„ï¼Œå¯ä»¥åˆ¶ä½œå¥½çœ‹çš„å›¾ç‰‡ï¼Œå¼ºçƒˆæ¨èä½¿ç”¨ã€‚</p>
<h2 id="æœ¬å‘¨åˆ†äº«">æœ¬å‘¨åˆ†äº«</h2>
<p>è™½ç„¶å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€<a href="https://t.me/chensoul_share">ChenSoul Share</a>ã€Telegram é¢‘é“ï¼Œä¸è¿‡è¿˜æ˜¯æŒ‘é€‰ä¸€éƒ¨åˆ†åœ¨è¿™é‡Œåˆ—ä¸¾ä¸€ä¸‹ï¼Œæ„Ÿè§‰æ›´åƒä¸€ä¸ª newsletter äº†ã€‚</p>
<h3 id="ä¸€äº›æ–‡ç« ">ä¸€äº›æ–‡ç« </h3>
<ul>
<li><a href="https://www.skyue.com/23042217.html">ä½¿ç”¨ Python å®ç° RSS è½¬ Newsletter</a></li>
<li><a href="https://www.bilibili.com/read/cv23249529">5ç§å¾®æœåŠ¡æ³¨å†Œä¸­å¿ƒè¯¥å¦‚ä½•é€‰å‹ï¼Ÿ</a></li>
<li><a href="https://allisonseboldt.com/5-years-of-indie-hacking/">5 Years of Indie Hacking</a></li>
<li><a href="https://feizhaojun.com/?p=3832">ä¸€ä¸ªæŠ€æœ¯ç²¾è‡´çš„ç½‘ç«™ï¼šæ¥å£è®¾è®¡å’Œå›¾ç‰‡åŠ è½½</a></li>
<li><a href="https://newzone.top/posts/2022-11-03-ffmpeg_screen_recording.html">æŠ›å¼ƒåˆè´µåˆéš¾ç”¨çš„å½•å±è½¯ä»¶ï¼Œ3 åˆ†é’Ÿå…¥é—¨ FFmpeg</a></li>
<li><a href="http://weishu.me/2021/09/26/start-to-use-Rust/">å¼€å§‹å­¦ä¹ å’Œä½¿ç”¨ Rust</a></li>
</ul>
<h3 id="ä¸€äº›å·¥å…·">ä¸€äº›å·¥å…·</h3>
<ul>
<li>
<p><a href="https://www.enhanceai.dev/">EnhanceAI</a> ä½¿ç”¨ä¸€è¡Œä»£ç ä¸ºç½‘ç«™çš„è¾“å…¥æ¡†å¢åŠ ä¸Š AI èƒ½åŠ›ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-16-03.png" alt="weekly-review-16-03"  />
</p>
</li>
<li>
<p><a href="https://avatarmaker.com/">Avatar Maker</a> ä¸€æ¬¾åœ¨çº¿ 2D åŠ¨æ¼«å¤´åƒç”Ÿæˆå™¨ï¼Œæ•ˆæœæ¯”è¾ƒåç¾æ¼«é£æ ¼ã€‚é’ˆå¯¹äºåŠèº«å¤´åƒçš„ä¸€äº›ç‰¹å¾ï¼Œæä¾›äº†ä¸°å¯Œçš„é€‰é¡¹ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-16-04.png" alt="weekly-review-16-04"  />
</p>
</li>
<li>
<p><a href="https://markflow.app/">Markflow</a> ç½‘é¡µå…ƒç´ å¿«é€Ÿæ‹·è´çš„å·¥å…·ï¼Œæ”¯æŒå¤åˆ¶ç²˜è´´åˆ° Figmaï¼ŒReactï¼ŒHtml é‡Œã€‚è¿™ä¸ªç½‘é¡µä¸­å¯ä»¥è¯•ç”¨ï¼ŒInspector çš„æ•ˆæœè¿˜æ˜¯å¾ˆä¸é”™çš„ã€‚å°±æ˜¯ Free Plan æ¯ä¸ªæœˆåªèƒ½æ‹·è´ 5 ä¸ª elements æœ‰ç‚¹è¿‡äºæ²¡è¯šæ„ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-16-05.png" alt="weekly-review-16-05"  />
</p>
</li>
<li>
<p><a href="https://shots.so/">Shots</a> ä¸€æ¬¾åœ¨çº¿ Mockup å·¥å…·ï¼Œèƒ½éå¸¸å¿«é€Ÿçš„åšå‡ºå¥—å£³çš„æ•ˆæœå›¾ï¼Œå†…ç½®çš„æ¨¡ç‰ˆå¾ˆå¤šï¼Œæ ·å¼è°ƒæ•´çš„é¢—ç²’åº¦ä¹Ÿå¾ˆç»†ã€‚é€‚åˆç‹¬ç«‹å¼€å‘å¿«é€Ÿå‡ºå›¾ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-16-06.png" alt="weekly-review-16-06"  />
</p>
</li>
</ul>
<h3 id="æœ¬å‘¨å˜€å’•">æœ¬å‘¨å˜€å’•</h3>
<p>å…¶å®ï¼Œå¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€<a href="https://t.me/chensoul_share">ChenSoul Share</a>ã€Telegram é¢‘é“æˆ–è€…æˆ‘çš„ <a href="https://memos.chensoul.com/">memos</a> ä¸­ï¼Œå¦‚æœæœ‰ä¸€ä¸ªè„šæœ¬å¯ä»¥è¯»å– Telegram æˆ–è€… memos æ¥å£è·å–ä¸Šå‘¨çš„åˆ†äº«è®°å½•ï¼Œåˆ™å¯ä»¥è‡ªåŠ¨åŒ–ç”Ÿæˆåˆ†äº«å†…å®¹äº†ã€‚äºæ˜¯ï¼ŒèŠ±äº†ä¸€ç‚¹æ—¶é—´å†™äº†ä¸€ä¸ª python è„šæœ¬ <a href="https://github.com/chensoul/chensoul.github.io/blob/main/fetch_memos.py">fetch_memos.py</a> æ¥è¯»å– memos æ¥å£ã€‚</p>
<p>è·å–åˆ°çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>2023-04-21 08:31:23</strong> ğŸ“º çœ‹è¿‡çŒç¯®é«˜æ‰‹ <code>#douban</code> <code>#watched</code>   <a href="http://movie.douban.com/subject/35315950/">æŸ¥çœ‹é“¾æ¥</a></li>
<li><strong>2023-04-18 20:33:47</strong> ğŸ“º çœ‹è¿‡é¾™é©¬ç²¾ç¥ <code>#douban</code> <code>#watched</code>  <a href="http://movie.douban.com/subject/35595615/">æŸ¥çœ‹é“¾æ¥</a></li>
<li><strong>2023-04-18 20:33:47</strong> ğŸ“– æœ€è¿‘åœ¨è¯»Rustæƒå¨æŒ‡å— <code>#douban</code> <code>#reading</code>  <a href="https://book.douban.com/subject/35081743/">æŸ¥çœ‹é“¾æ¥</a></li>
<li><strong>2023-04-18 20:33:47</strong> ğŸ“– æœ€è¿‘åœ¨è¯»Pythonç¼–ç¨‹ <code>#douban</code> <code>#reading</code>  <a href="https://book.douban.com/subject/35196328/">æŸ¥çœ‹é“¾æ¥</a></li>
<li><strong>2023-04-18 20:33:47</strong> ğŸ“– æœ€è¿‘åœ¨è¯»Pythonå·¥åŒ  <code>#douban</code> <code>#reading</code>  <a href="https://book.douban.com/subject/35723705/">æŸ¥çœ‹é“¾æ¥</a></li>
<li><strong>2023-04-18 18:40:50</strong> ğŸ“ å‘¨æŠ¥-15ï½œUmamiå‡çº§åˆ°2.0ã€æ±‰è¡—èœ¡åƒé¦†ã€ä½¿ç”¨Stravaè·‘æ­¥ <code>#blog</code>   <a href="https://blog.chensoul.com/posts/2023/04/18/weekly_review_15/">æŸ¥çœ‹é“¾æ¥</a></li>
<li><strong>2023-04-17 17:48:43</strong> ğŸŒŸ chensoul starred chensoul/chensoul.github.io <code>#github</code> <code>#star</code>  <a href="https://github.com/chensoul/chensoul.github.io">æŸ¥çœ‹é“¾æ¥</a></li>
<li><strong>2023-04-17 17:10:45</strong> ğŸ“ ã€ŠEffective Java 3ã€‹ç¬”è®°ï¼šä½¿ç”¨ç§æœ‰æ„é€ å‡½æ•°æˆ–æšä¸¾ç±»å‹åˆ›å»ºå•ä¾‹ <code>#blog</code>   <a href="https://blog.chensoul.com/posts/2023/04/17/prefer-dependency-injection-to-hardwiring-resources/">æŸ¥çœ‹é“¾æ¥</a></li>
</ul>
<p>åç»­çš„æƒ³æ³•ï¼šå¯¹ä¸Šé¢å†…å®¹è¿›è¡Œåˆ†ç±»ï¼Œæ¯”å¦‚ï¼Œå°†å¸¦æœ‰è±†ç“£ã€Githubã€Stravaã€Spotfyã€Blogæ ‡ç­¾çš„å†…å®¹ï¼Œå½’çº³ä¸ºæˆ‘æœ€è¿‘çš„æ´»åŠ¨ï¼›å°†å¸¦æœ‰ toolã€skill ç­‰æ ‡ç­¾å…¶ä»–å†…å®¹å½’çº³ä¸ºæˆ‘çš„åˆ†äº«ï¼ˆæŠ€æœ¯ç›¸å…³ï¼‰ï¼›å°†å…¶ä»–å†…å®¹å½’çº³ä¸ºæˆ‘å‘è¡¨çš„è¯´è¯´ã€‚</p>
<p>ä»¥ä¸Šã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>ã€ŠEffective Java 3ã€‹ç¬”è®°6ï¼šé¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡</title>
      <link>https://blog.chensoul.com/posts/2023/04/24/avoid-creating-unnecessary-objects/</link>
      <pubDate>Mon, 24 Apr 2023 09:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/04/24/avoid-creating-unnecessary-objects/</guid>
      <description>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼šé¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ã€‚ ä»‹ç» åˆ›å»ºå¯¹è±¡æ—¶ï¼Œç»å¸¸ä¼šå¤ç”¨å¯¹è±¡ã€‚å¦‚æœå¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œé‚£ä¹ˆå®ƒæ€»æ˜¯å¯ä»¥è¢«</description>
      <content:encoded><![CDATA[<p>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼šé¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ã€‚</p>
<h2 id="ä»‹ç»">ä»‹ç»</h2>
<p>åˆ›å»ºå¯¹è±¡æ—¶ï¼Œç»å¸¸ä¼šå¤ç”¨å¯¹è±¡ã€‚å¦‚æœå¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œé‚£ä¹ˆå®ƒæ€»æ˜¯å¯ä»¥è¢«å¤ç”¨çš„ã€‚</p>
<p>ä¸‹é¢ä¸€ä¸ªä¾‹å­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">String</span> <span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="s">&#34;bikini&#34;</span><span class="o">);</span> <span class="c1">// DON&#39;T DO THIS!
</span></span></span></code></pre></div><p>è¯¥è¯­å¥æ¯æ¬¡æ‰§è¡Œæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ String å®ä¾‹ï¼Œè€Œè¿™äº›å¯¹è±¡åˆ›å»ºéƒ½ä¸æ˜¯å¿…éœ€çš„ã€‚String æ„é€ å‡½æ•°çš„å‚æ•° <code>(&quot;bikini&quot;)</code> æœ¬èº«å°±æ˜¯ä¸€ä¸ª String å®ä¾‹ï¼Œåœ¨åŠŸèƒ½ä¸Šä¸æ„é€ å‡½æ•°åˆ›å»ºçš„æ‰€æœ‰å¯¹è±¡ç›¸åŒã€‚å¦‚æœè¿™ç§ç”¨æ³•å‘ç”Ÿåœ¨å¾ªç¯æˆ–é¢‘ç¹è°ƒç”¨çš„æ–¹æ³•ä¸­ï¼Œåˆ›å»ºå¤§é‡ String å®ä¾‹æ˜¯ä¸å¿…è¦çš„ã€‚</p>
<p>æ”¹è¿›åçš„ç‰ˆæœ¬å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">String</span> <span class="n">s</span> <span class="o">=</span> <span class="s">&#34;bikini&#34;</span><span class="o">;</span>
</span></span></code></pre></div><p>è¿™ä¸ªç‰ˆæœ¬ä½¿ç”¨å•ä¸ª String å®ä¾‹ï¼Œè€Œä¸æ˜¯æ¯æ¬¡æ‰§è¡Œæ—¶éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚æ­¤å¤–ï¼Œå¯ä»¥ä¿è¯åœ¨åŒä¸€è™šæ‹Ÿæœºä¸­è¿è¡Œçš„å…¶ä»–ä»£ç éƒ½å¯ä»¥å¤ç”¨è¯¥å¯¹è±¡ï¼Œåªè¦æ°å¥½åŒ…å«ç›¸åŒçš„å­—ç¬¦ä¸²å­—é¢é‡ã€‚</p>
<p>é€šå¸¸å¯ä»¥é€šè¿‡ä½¿ç”¨é™æ€å·¥å‚æ–¹æ³•æ¥é¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯åœ¨æä¾›è¿™ä¸¤ç§æ–¹æ³•çš„ä¸å¯å˜ç±»ä¸Šä½¿ç”¨æ„é€ å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œå·¥å‚æ–¹æ³• <code>Boolean.valueOf(String)</code> æ¯”æ„é€ å‡½æ•° <del>Boolean(String)</del> æ›´å¯å–ï¼Œåè€…åœ¨ Java 9 ä¸­è¢«å¼ƒç”¨äº†ã€‚æ„é€ å‡½æ•°æ¯æ¬¡è°ƒç”¨æ—¶éƒ½å¿…é¡»åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè€Œå·¥å‚æ–¹æ³•ä»æ¥ä¸éœ€è¦è¿™æ ·åšï¼Œåœ¨å®é™…åº”ç”¨ä¸­ä¹Ÿä¸ä¼šè¿™æ ·åšã€‚é™¤äº†å¤ç”¨ä¸å¯å˜å¯¹è±¡ä¹‹å¤–ï¼Œå¦‚æœçŸ¥é“å¯å˜å¯¹è±¡ä¸ä¼šè¢«ä¿®æ”¹ï¼Œä¹Ÿå¯ä»¥å¤ç”¨å®ƒä»¬ã€‚</p>
<p>æœ‰äº›å¯¹è±¡çš„åˆ›å»ºçš„ä»£ä»·ç›¸æ¯”è€Œè¨€è¦æ˜‚è´µå¾—å¤šã€‚å¦‚æœä½ éœ€è¦é‡å¤åœ°ä½¿ç”¨è¿™æ ·ä¸€ä¸ªã€Œæ˜‚è´µçš„å¯¹è±¡ã€ï¼Œé‚£ä¹ˆæœ€å¥½å°†å…¶ç¼“å­˜ä»¥ä¾›å¤ç”¨ã€‚</p>
<p>ä¸‹é¢æ˜¯ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æœ€ç®€å•çš„æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Performance can be greatly improved!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">isRomanNumeral</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="na">matches</span><span class="o">(</span><span class="s">&#34;^(?=.)M*(C[MD]|D?C{0,3})&#34;</span> <span class="o">+</span> <span class="s">&#34;(X[CL]|L?X{0,3})(I[XV]|V?I{0,3})$&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>è¿™ä¸ªå®ç°çš„é—®é¢˜æ˜¯å®ƒä¾èµ–äº <code>String.matches</code> æ–¹æ³•ã€‚<strong>è™½ç„¶ String.matches æ˜¯æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„æœ€ç®€å•æ–¹æ³•ï¼Œä½†å®ƒä¸é€‚åˆåœ¨æ€§èƒ½å…³é”®çš„æƒ…å†µä¸‹é‡å¤ä½¿ç”¨ã€‚</strong> é—®é¢˜åœ¨äºï¼Œå®ƒåœ¨å†…éƒ¨ä¸ºæ­£åˆ™è¡¨è¾¾å¼åˆ›å»ºäº†ä¸€ä¸ª Pattern å®ä¾‹ï¼Œå¹¶ä¸”åªä½¿ç”¨ä¸€æ¬¡ï¼Œä¹‹åå°±è¿›è¡Œåƒåœ¾æ”¶é›†äº†ã€‚åˆ›å»ºä¸€ä¸ª Pattern å®ä¾‹æ˜¯å¾ˆæ˜‚è´µçš„ï¼Œå› ä¸ºå®ƒéœ€è¦å°†æ­£åˆ™è¡¨è¾¾å¼ç¼–è¯‘æˆæœ‰é™çš„çŠ¶æ€æœºã€‚</p>
<p>ä¸ºäº†æé«˜æ€§èƒ½ï¼Œå°†æ­£åˆ™è¡¨è¾¾å¼æ˜¾å¼ç¼–è¯‘ä¸º Pattern å®ä¾‹ï¼ˆå®ƒæ˜¯ä¸å¯å˜çš„ï¼‰ï¼Œä½œä¸ºç±»åˆå§‹åŒ–çš„ä¸€éƒ¨åˆ†ï¼Œç¼“å­˜å®ƒï¼Œå¹¶åœ¨æ¯æ¬¡è°ƒç”¨ isRomanNumeral æ–¹æ³•æ—¶å¤ç”¨åŒä¸€ä¸ªå®ä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Reusing expensive object for improved performance
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">RomanNumerals</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Pattern</span> <span class="n">ROMAN</span> <span class="o">=</span> <span class="n">Pattern</span><span class="o">.</span><span class="na">compile</span><span class="o">(</span><span class="s">&#34;^(?=.)M*(C[MD]|D?C{0,3})&#34;</span> <span class="o">+</span> <span class="s">&#34;(X[CL]|L?X{0,3})(I[XV]|V?I{0,3})$&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">isRomanNumeral</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">ROMAN</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">s</span><span class="o">).</span><span class="na">matches</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>å¦‚æœé¢‘ç¹è°ƒç”¨ isRomanNumeralï¼Œæ”¹è¿›ç‰ˆæœ¬å°†æä¾›æ˜¾è‘—çš„æ€§èƒ½æå‡ã€‚ä¸ä»…æ€§èƒ½å¾—åˆ°äº†æ”¹å–„ï¼Œæ¸…æ™°åº¦ä¹Ÿå¾—åˆ°äº†æé«˜ã€‚ä¸ºä¸å¯è§çš„ Pattern å®ä¾‹åˆ›å»ºä¸€ä¸ªé™æ€ç»ˆæ€å­—æ®µå…è®¸æˆ‘ä»¬ä¸ºå®ƒå‘½åï¼Œè¿™æ¯”æ­£åˆ™è¡¨è¾¾å¼æœ¬èº«æ›´å®¹æ˜“é˜…è¯»ã€‚</p>
<p>å¦‚æœåŠ è½½åŒ…å«æ”¹è¿›ç‰ˆ isRomanNumeral æ–¹æ³•çš„ç±»æ—¶ï¼Œè¯¥æ–¹æ³•ä»æœªè¢«è°ƒç”¨è¿‡ï¼Œé‚£ä¹ˆåˆå§‹åŒ–å­—æ®µ ROMAN æ˜¯ä¸å¿…è¦çš„ã€‚å› æ­¤ï¼Œå¯ä»¥ç”¨å»¶è¿Ÿåˆå§‹åŒ–å­—æ®µçš„æ–¹å¼åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨ isRomanNumeral æ–¹æ³•æ—¶æ‰åˆå§‹åŒ–å­—æ®µï¼Œè€Œä¸æ˜¯åœ¨ç±»åŠ è½½æ—¶åˆå§‹åŒ–ï¼Œ<strong>ä½†ä¸å»ºè®®è¿™æ ·åš</strong>ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œ<strong>å»¶è¿Ÿåˆå§‹åŒ–ä¼šä½¿å®ç°å¤æ‚åŒ–ï¼Œè€Œæ²¡æœ‰æ˜æ˜¾çš„æ€§èƒ½æ”¹å–„</strong>ã€‚</p>
<p>å½“ä¸€ä¸ªå¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œå¾ˆæ˜æ˜¾ï¼Œå®ƒå¯ä»¥å®‰å…¨åœ°å¤ç”¨ï¼Œä½†åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œå®ƒè¿œä¸é‚£ä¹ˆæ˜æ˜¾ï¼Œç”šè‡³è¿åç›´è§‰ã€‚è€ƒè™‘é€‚é…å™¨çš„æƒ…å†µï¼Œä¹Ÿç§°ä¸ºè§†å›¾ã€‚é€‚é…å™¨æ˜¯å§”æ‰˜ç»™æ”¯æŒå¯¹è±¡çš„å¯¹è±¡ï¼Œæä¾›äº†ä¸€ä¸ªæ›¿ä»£æ¥å£ã€‚å› ä¸ºé€‚é…å™¨çš„çŠ¶æ€ä¸è¶…è¿‡å…¶æ”¯æŒå¯¹è±¡çš„çŠ¶æ€ï¼Œæ‰€ä»¥ä¸éœ€è¦ä¸ºç»™å®šå¯¹è±¡åˆ›å»ºä¸€ä¸ªç»™å®šé€‚é…å™¨çš„å¤šä¸ªå®ä¾‹ã€‚</p>
<p>ä¾‹å¦‚ï¼ŒMap æ¥å£çš„ keySet æ–¹æ³•è¿”å› Map å¯¹è±¡çš„ Set è§†å›¾ï¼Œå…¶ä¸­åŒ…å« Map ä¸­çš„æ‰€æœ‰é”®ã€‚äº‹å®ä¸Šï¼Œè¿”å›çš„ Set å®ä¾‹é€šå¸¸æ˜¯å¯å˜çš„ï¼Œä½†æ‰€æœ‰è¿”å›çš„å¯¹è±¡åœ¨åŠŸèƒ½ä¸Šéƒ½æ˜¯ç›¸åŒçš„ï¼Œå› ä¸ºå®ƒä»¬éƒ½ç”±ç›¸åŒçš„ Map å®ä¾‹æ”¯æŒã€‚å› æ­¤ï¼Œå¯¹ç»™å®š Map å¯¹è±¡ä¸Šçš„ keySet çš„æ¯æ¬¡è°ƒç”¨éƒ½å¯èƒ½è¿”å›ç›¸åŒçš„ Set å®ä¾‹ã€‚</p>
<p>ç”±äºè¿”å›çš„ Set å®ä¾‹åœ¨åŠŸèƒ½ä¸Šæ˜¯ç›¸åŒçš„ï¼Œå› æ­¤åˆ›å»º keySet è§†å›¾å¯¹è±¡çš„å¤šä¸ªå®ä¾‹æ˜¯ä¸å¿…è¦çš„ï¼Œä¹Ÿæ²¡æœ‰å¥½å¤„ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨ keySet è§†å›¾çš„æ—¶å€™ï¼Œæˆ‘ä»¬åº”è¯¥å°½å¯èƒ½åœ°é‡ç”¨åŒä¸€ä¸ª Set å®ä¾‹ï¼Œè€Œä¸æ˜¯æ¯æ¬¡è°ƒç”¨ keySet æ–¹æ³•éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„ Set å®ä¾‹ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•é‡ç”¨ keySet è§†å›¾çš„ Set å®ä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.Set</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestKeySetReuse</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="s">&#34;one&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">2</span><span class="o">,</span> <span class="s">&#34;two&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">3</span><span class="o">,</span> <span class="s">&#34;three&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">Set</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">keySet1</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">Set</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">keySet2</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">keySet</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">keySet1</span> <span class="o">==</span> <span class="n">keySet2</span><span class="o">);</span> <span class="c1">// trueï¼Œè¯´æ˜æ˜¯åŒä¸€ä¸ªå®ä¾‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="n">keySet1</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">1</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">);</span> <span class="c1">// {2=two, 3=three}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">keySet2</span><span class="o">);</span> <span class="c1">// [2, 3]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª HashMap å¯¹è±¡ï¼Œå¹¶å‘å…¶ä¸­æ·»åŠ äº†ä¸€äº›é”®å€¼å¯¹ã€‚ç„¶åï¼Œæˆ‘ä»¬ä¸¤æ¬¡è°ƒç”¨ keySet æ–¹æ³•ï¼Œåˆ†åˆ«å°†è¿”å›çš„ Set å®ä¾‹ä¿å­˜åˆ° keySet1 å’Œ keySet2 å˜é‡ä¸­ã€‚</p>
<p>ç”±äº keySet1 å’Œ keySet2 æ˜¯ç”±ç›¸åŒçš„ Map å®ä¾‹æ”¯æŒçš„ï¼Œå› æ­¤å®ƒä»¬æ˜¯ç›¸ç­‰çš„ï¼Œå³ <code>keySet1 == keySet2</code> è¿”å› trueã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå®é™…ä¸Šå®ƒä»¬æ˜¯åŒä¸€ä¸ª Set å®ä¾‹ã€‚</p>
<p>ç„¶åï¼Œæˆ‘ä»¬ä» keySet1 ä¸­åˆ é™¤ä¸€ä¸ªé”®ï¼Œå¹¶æ‰“å°å‡º Map å’Œ keySet2 çš„å†…å®¹ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬ä¿®æ”¹äº† keySet1 ä¸­çš„å†…å®¹æ—¶ï¼ŒkeySet2 ä¹Ÿè¢«ä¿®æ”¹äº†ï¼Œå› ä¸ºå®ƒä»¬æ˜¯åŒä¸€ä¸ª Set å®ä¾‹ã€‚</p>
<p>å› æ­¤ï¼Œåœ¨ä½¿ç”¨ Map çš„ keySet æ–¹æ³•æ—¶ï¼Œåº”è¯¥å°½å¯èƒ½åœ°é‡ç”¨åŒä¸€ä¸ª Set å®ä¾‹ï¼Œä»¥é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»ºå’Œä¸å¿…è¦çš„è¡Œä¸ºã€‚</p>
<p>å¦ä¸€ç§åˆ›å»ºä¸å¿…è¦å¯¹è±¡çš„æ–¹æ³•æ˜¯è‡ªåŠ¨è£…ç®±ï¼Œå®ƒå…è®¸ç¨‹åºå‘˜æ··åˆåŸºæœ¬ç±»å‹å’ŒåŒ…è£…ç±»å‹ï¼Œæ ¹æ®éœ€è¦è‡ªåŠ¨è£…ç®±å’Œæ‹†ç®±ã€‚<strong>è‡ªåŠ¨è£…ç®±æ¨¡ç³Šäº†åŸºæœ¬ç±»å‹å’ŒåŒ…è£…ç±»å‹ä¹‹é—´çš„åŒºåˆ«ï¼Œ</strong> ä¸¤è€…æœ‰ç»†å¾®çš„è¯­ä¹‰å·®åˆ«å’Œä¸æ˜æ˜¾çš„æ€§èƒ½å·®åˆ«ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Hideously slow! Can you spot the object creation?
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">private</span> <span class="kd">static</span> <span class="kt">long</span> <span class="nf">sum</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Long</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">0L</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="o">(</span><span class="kt">long</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
</span></span><span class="line"><span class="cl">        <span class="n">sum</span> <span class="o">+=</span> <span class="n">i</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">sum</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>è¿™ä¸ªç¨‹åºå¾—åˆ°äº†æ­£ç¡®çš„ç­”æ¡ˆï¼Œä½†æ˜¯ç”±äºä¸€ä¸ªå­—ç¬¦çš„å°åˆ·é”™è¯¯ï¼Œå®ƒçš„é€Ÿåº¦æ¯”å®é™…è¦æ…¢å¾—å¤šã€‚å˜é‡ sum è¢«å£°æ˜ä¸º Long è€Œä¸æ˜¯ longï¼Œè¿™æ„å‘³ç€ç¨‹åºå°†æ„é€ å¤§çº¦ 231 ä¸ªä¸å¿…è¦çš„ Long å®ä¾‹ï¼ˆå¤§çº¦æ¯æ¬¡å°† Long i æ·»åŠ åˆ° Long sum æ—¶éƒ½æœ‰ä¸€ä¸ªå®ä¾‹ï¼‰ã€‚å°† sum çš„å£°æ˜ä» Long æ›´æ”¹ä¸º longï¼Œæœºå™¨ä¸Šçš„è¿è¡Œæ—¶é—´å°†ä» 6.3 ç§’å‡å°‘åˆ° 0.59 ç§’ã€‚æ•™è®­å¾ˆæ¸…æ¥šï¼š<strong>åŸºæœ¬ç±»å‹ä¼˜äºåŒ…è£…ç±»ï¼Œè¿˜åº”æé˜²æ„å¤–çš„è‡ªåŠ¨è£…ç®±ã€‚</strong></p>
<p>æœ¬æ¡ç›®ä¸åº”è¯¥è¢«æ›²è§£ä¸ºæ˜¯åœ¨æš—ç¤ºåˆ›å»ºå¯¹è±¡æ˜¯æˆæœ¬æ˜‚è´µçš„ï¼Œåº”è¯¥é¿å…ã€‚ç›¸åï¼Œåˆ›å»ºå’Œå›æ”¶è¿™äº›å°å¯¹è±¡çš„æ„é€ å‡½æ•°æˆæœ¬æ˜¯å¾ˆä½å»‰çš„ï¼Œå°¤å…¶æ˜¯åœ¨ç°ä»£ JVM å®ç°ä¸Šã€‚<strong>åˆ›å»ºé¢å¤–çš„å¯¹è±¡æ¥å¢å¼ºç¨‹åºçš„æ¸…æ™°æ€§ã€ç®€å•æ€§æˆ–åŠŸèƒ½é€šå¸¸æ˜¯ä»¶å¥½äº‹ã€‚</strong></p>
<p>ç›¸åï¼Œé€šè¿‡ç»´æŠ¤è‡ªå·±çš„å¯¹è±¡æ± æ¥é¿å…åˆ›å»ºå¯¹è±¡ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œé™¤éæ± ä¸­çš„å¯¹è±¡éå¸¸é‡é‡çº§ã€‚è¯æ˜å¯¹è±¡æ± æ˜¯åˆç†çš„å¯¹è±¡çš„å…¸å‹ä¾‹å­æ˜¯æ•°æ®åº“è¿æ¥ã€‚å»ºç«‹è¿æ¥çš„æˆæœ¬éå¸¸é«˜ï¼Œå› æ­¤å¤ç”¨è¿™äº›å¯¹è±¡æ˜¯æœ‰æ„ä¹‰çš„ã€‚ç„¶è€Œï¼Œä¸€èˆ¬æ¥è¯´ï¼Œç»´æŠ¤è‡ªå·±çš„å¯¹è±¡æ± ä¼šä½¿ä»£ç æ··ä¹±ï¼Œå¢åŠ å†…å­˜å ç”¨ï¼Œå¹¶æŸå®³æ€§èƒ½ã€‚ç°ä»£ JVM å®ç°å…·æœ‰é«˜åº¦ä¼˜åŒ–çš„åƒåœ¾æ”¶é›†å™¨ï¼Œåœ¨è½»é‡çº§å¯¹è±¡ä¸Šå¾ˆå®¹æ˜“èƒœè¿‡è¿™æ ·çš„å¯¹è±¡æ± ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<ol>
<li>
<p>é¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡å¯ä»¥æé«˜æ€§èƒ½å’Œå‡å°‘å†…å­˜å ç”¨ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ä¸æ¨èçš„å†™æ³•ï¼Œä¼šåˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Integer</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">1000000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">sum</span> <span class="o">+=</span> <span class="n">i</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ¨èçš„å†™æ³•ï¼Œä½¿ç”¨åŸºæœ¬ç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">1000000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">sum</span> <span class="o">+=</span> <span class="n">i</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div></li>
<li>
<p>å¦‚æœä¸€ä¸ªå¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œå¯ä»¥å°†å…¶ç¼“å­˜èµ·æ¥å¹¶é‡å¤ä½¿ç”¨ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éœ€è¦æ—¶éƒ½åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ä¸å¯å˜å¯¹è±¡å’Œå®ƒä»¬çš„ç¼“å­˜å®ç°ï¼š</p>
<ul>
<li><strong>å­—ç¬¦ä¸²å¸¸é‡æ± </strong></li>
</ul>
<p>Java è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„ï¼Œå› æ­¤å­—ç¬¦ä¸²å¸¸é‡å¯ä»¥è¢«ç¼“å­˜èµ·æ¥å¹¶é‡å¤ä½¿ç”¨ã€‚Java è™šæ‹Ÿæœºç»´æŠ¤äº†ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡æ± ï¼Œå®ƒç¼“å­˜äº†æ‰€æœ‰çš„å­—ç¬¦ä¸²å¸¸é‡ï¼Œå¹¶ç¡®ä¿ç›¸åŒçš„å­—ç¬¦ä¸²åªè¢«åˆ›å»ºä¸€æ¬¡ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">String</span> <span class="n">s1</span> <span class="o">=</span> <span class="s">&#34;Hello&#34;</span><span class="o">;</span> <span class="c1">// ä»å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­è·å–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">String</span> <span class="n">s2</span> <span class="o">=</span> <span class="s">&#34;Hello&#34;</span><span class="o">;</span> <span class="c1">// ä»å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­è·å–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">String</span> <span class="n">s3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="s">&#34;Hello&#34;</span><span class="o">);</span> <span class="c1">// åˆ›å»ºæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s1</span> <span class="o">==</span> <span class="n">s2</span><span class="o">);</span> <span class="c1">// true
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s1</span> <span class="o">==</span> <span class="n">s3</span><span class="o">);</span> <span class="c1">// false
</span></span></span></code></pre></div><ul>
<li><strong>æ•°å­—å¸¸é‡æ± </strong></li>
</ul>
<p>Java è¯­è¨€ä¸­çš„æ•´æ•°ã€æµ®ç‚¹æ•°å’Œå­—ç¬¦ç­‰åŸºæœ¬æ•°æ®ç±»å‹çš„å€¼ä¹Ÿå¯ä»¥è¢«ç¼“å­˜èµ·æ¥å¹¶é‡å¤ä½¿ç”¨ã€‚Java è™šæ‹Ÿæœºç»´æŠ¤äº†ä¸€ä¸ªæ•°å­—å¸¸é‡æ± ï¼Œå®ƒç¼“å­˜äº†ä¸€å®šèŒƒå›´å†…çš„æ•´æ•°ã€æµ®ç‚¹æ•°å’Œå­—ç¬¦ç­‰åŸºæœ¬æ•°æ®ç±»å‹çš„å€¼ï¼Œå¹¶ç¡®ä¿ç›¸åŒçš„å€¼åªè¢«åˆ›å»ºä¸€æ¬¡ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Integer</span> <span class="n">i1</span> <span class="o">=</span> <span class="n">100</span><span class="o">;</span> <span class="c1">// ä»æ•°å­—å¸¸é‡æ± ä¸­è·å–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Integer</span> <span class="n">i2</span> <span class="o">=</span> <span class="n">100</span><span class="o">;</span> <span class="c1">// ä»æ•°å­—å¸¸é‡æ± ä¸­è·å–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Integer</span> <span class="n">i3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Integer</span><span class="o">(</span><span class="n">100</span><span class="o">);</span> <span class="c1">// åˆ›å»ºæ–°çš„ Integer å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">i1</span> <span class="o">==</span> <span class="n">i2</span><span class="o">);</span> <span class="c1">// true
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">i1</span> <span class="o">==</span> <span class="n">i3</span><span class="o">);</span> <span class="c1">// false
</span></span></span></code></pre></div><p>æ³¨æ„ï¼šæ•°å­—å¸¸é‡æ± çš„èŒƒå›´å¯ä»¥é€šè¿‡ JVM å‚æ•° <code>-XX:AutoBoxCacheMax=&lt;size&gt;</code> æ¥è°ƒæ•´ï¼Œå…¶ä¸­ <code>&lt;size&gt;</code> æ˜¯å¸¸é‡æ± çš„å¤§å°ã€‚</p>
<ul>
<li><strong>æšä¸¾å¸¸é‡</strong></li>
</ul>
<p>Java è¯­è¨€ä¸­çš„æšä¸¾å¸¸é‡æ˜¯ä¸å¯å˜çš„ï¼Œå®ƒä»¬åœ¨æšä¸¾ç±»å‹è¢«åŠ è½½æ—¶å°±è¢«åˆ›å»ºå¹¶ç¼“å­˜èµ·æ¥ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éœ€è¦æ—¶éƒ½åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">enum</span> <span class="n">Color</span> <span class="o">{</span> <span class="n">RED</span><span class="o">,</span> <span class="n">GREEN</span><span class="o">,</span> <span class="n">BLUE</span> <span class="o">};</span>
</span></span><span class="line"><span class="cl"><span class="n">Color</span> <span class="n">c1</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="na">RED</span><span class="o">;</span> <span class="c1">// è·å–æšä¸¾å¸¸é‡ RED
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Color</span> <span class="n">c2</span> <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="na">GREEN</span><span class="o">;</span> <span class="c1">// è·å–æšä¸¾å¸¸é‡ GREEN
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Color</span> <span class="n">c3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="s">&#34;YELLOW&#34;</span><span class="o">);</span> <span class="c1">// åˆ›å»ºæ–°çš„æšä¸¾å¸¸é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">c1</span> <span class="o">==</span> <span class="n">c2</span><span class="o">);</span> <span class="c1">// false
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">c1</span> <span class="o">==</span> <span class="n">Color</span><span class="o">.</span><span class="na">RED</span><span class="o">);</span> <span class="c1">// true
</span></span></span></code></pre></div><ul>
<li><strong>LocalDateã€LocalTimeã€LocalDateTime</strong></li>
</ul>
<p>Java 8 å¼•å…¥çš„æ—¥æœŸæ—¶é—´ API ä¸­çš„ LocalDateã€LocalTimeã€LocalDateTime ç±»å‹éƒ½æ˜¯ä¸å¯å˜çš„ã€‚è¿™äº›ç±»å‹çš„å¯¹è±¡å¯ä»¥è¢«ç¼“å­˜èµ·æ¥å¹¶é‡å¤ä½¿ç”¨ï¼Œä»¥æé«˜ç¨‹åºçš„æ€§èƒ½ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">LocalDate</span> <span class="n">today</span> <span class="o">=</span> <span class="n">LocalDate</span><span class="o">.</span><span class="na">now</span><span class="o">();</span> <span class="c1">// è·å–å½“å‰æ—¥æœŸ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">LocalDate</span> <span class="n">tomorrow</span> <span class="o">=</span> <span class="n">today</span><span class="o">.</span><span class="na">plusDays</span><span class="o">(</span><span class="n">1</span><span class="o">);</span> <span class="c1">// è®¡ç®—æ˜å¤©çš„æ—¥æœŸ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">LocalDate</span> <span class="n">yesterday</span> <span class="o">=</span> <span class="n">today</span><span class="o">.</span><span class="na">minusDays</span><span class="o">(</span><span class="n">1</span><span class="o">);</span> <span class="c1">// è®¡ç®—æ˜¨å¤©çš„æ—¥æœŸ
</span></span></span></code></pre></div><p>å¯ä»¥ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„ ConcurrentHashMap æ¥å®ç° LocalDate çš„ç¼“å­˜ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ConcurrentHashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">LocalDate</span><span class="o">&gt;</span> <span class="n">cache</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl"><span class="n">LocalDate</span> <span class="n">date</span> <span class="o">=</span> <span class="n">cache</span><span class="o">.</span><span class="na">computeIfAbsent</span><span class="o">(</span><span class="s">&#34;2023-04-24&#34;</span><span class="o">,</span> <span class="n">LocalDate</span><span class="o">::</span><span class="n">parse</span><span class="o">);</span>
</span></span></code></pre></div><ul>
<li><strong>BigDecimal</strong></li>
</ul>
<p>Java ä¸­çš„ BigDecimal ç±»å‹ä¹Ÿæ˜¯ä¸å¯å˜çš„ï¼Œå®ƒä»¬çš„å€¼åœ¨åˆ›å»ºåä¸ä¼šæ”¹å˜ã€‚å› æ­¤ï¼Œå¯ä»¥å°† BigDecimal å¯¹è±¡ç¼“å­˜èµ·æ¥å¹¶é‡å¤ä½¿ç”¨ï¼Œä»¥é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»ºã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">BigDecimal</span> <span class="n">zero</span> <span class="o">=</span> <span class="n">BigDecimal</span><span class="o">.</span><span class="na">ZERO</span><span class="o">;</span> <span class="c1">// ç¼“å­˜ 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">BigDecimal</span> <span class="n">one</span> <span class="o">=</span> <span class="n">BigDecimal</span><span class="o">.</span><span class="na">ONE</span><span class="o">;</span> <span class="c1">// ç¼“å­˜ 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">BigDecimal</span> <span class="n">ten</span> <span class="o">=</span> <span class="n">BigDecimal</span><span class="o">.</span><span class="na">TEN</span><span class="o">;</span> <span class="c1">// ç¼“å­˜ 10
</span></span></span></code></pre></div><p>å¯ä»¥ä½¿ç”¨é™æ€ final å¸¸é‡æ¥å®ç° BigDecimal çš„ç¼“å­˜ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Constants</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">BigDecimal</span> <span class="n">ZERO</span> <span class="o">=</span> <span class="n">BigDecimal</span><span class="o">.</span><span class="na">ZERO</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">BigDecimal</span> <span class="n">ONE</span> <span class="o">=</span> <span class="n">BigDecimal</span><span class="o">.</span><span class="na">ONE</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">BigDecimal</span> <span class="n">TEN</span> <span class="o">=</span> <span class="n">BigDecimal</span><span class="o">.</span><span class="na">TEN</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><ul>
<li><strong>Immutable Collections</strong></li>
</ul>
<p>Guava å’Œ Java 9+ ä¸­éƒ½æä¾›äº†ä¸å¯å˜é›†åˆç±»ï¼Œå¦‚ ImmutableListã€ImmutableSetã€ImmutableMap ç­‰ã€‚è¿™äº›ä¸å¯å˜é›†åˆç±»çš„å¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œå› æ­¤å¯ä»¥è¢«ç¼“å­˜èµ·æ¥å¹¶é‡å¤ä½¿ç”¨ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ImmutableList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">ImmutableList</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">&#34;a&#34;</span><span class="o">,</span> <span class="s">&#34;b&#34;</span><span class="o">,</span> <span class="s">&#34;c&#34;</span><span class="o">);</span> <span class="c1">// åˆ›å»ºä¸å¯å˜åˆ—è¡¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">ImmutableSet</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">set</span> <span class="o">=</span> <span class="n">ImmutableSet</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="n">3</span><span class="o">);</span> <span class="c1">// åˆ›å»ºä¸å¯å˜é›†åˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">ImmutableMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="n">ImmutableMap</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">&#34;a&#34;</span><span class="o">,</span> <span class="n">1</span><span class="o">,</span> <span class="s">&#34;b&#34;</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="s">&#34;c&#34;</span><span class="o">,</span> <span class="n">3</span><span class="o">);</span> <span class="c1">// åˆ›å»ºä¸å¯å˜æ˜ å°„
</span></span></span></code></pre></div><p>å¯ä»¥ä½¿ç”¨é™æ€ final å¸¸é‡æ¥å®ç°ä¸å¯å˜é›†åˆçš„ç¼“å­˜ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Constants</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">ImmutableList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">LIST</span> <span class="o">=</span> <span class="n">ImmutableList</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">&#34;a&#34;</span><span class="o">,</span> <span class="s">&#34;b&#34;</span><span class="o">,</span> <span class="s">&#34;c&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">ImmutableSet</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">SET</span> <span class="o">=</span> <span class="n">ImmutableSet</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="n">3</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">ImmutableMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">MAP</span> <span class="o">=</span> <span class="n">ImmutableMap</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">&#34;a&#34;</span><span class="o">,</span> <span class="n">1</span><span class="o">,</span> <span class="s">&#34;b&#34;</span><span class="o">,</span> <span class="n">2</span><span class="o">,</span> <span class="s">&#34;c&#34;</span><span class="o">,</span> <span class="n">3</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div></li>
<li>
<p>é¿å…ä½¿ç”¨è£…ç®±ç±»å‹ï¼Œå¦‚ Integerã€Boolean ç­‰ï¼Œå› ä¸ºå®ƒä»¬åœ¨è‡ªåŠ¨è£…ç®±å’Œæ‹†ç®±æ—¶ä¼šåˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ã€‚å¯ä»¥ä½¿ç”¨åŸºæœ¬ç±»å‹å’Œå¯¹è±¡åŒ…è£…ç±»å‹ä¹‹é—´çš„ç›¸äº’è½¬æ¢æ–¹æ³•æ¥é¿å…è¿™ç§æƒ…å†µã€‚</p>
</li>
<li>
<p>å¯¹äºå¤§é‡çš„çŸ­å­—ç¬¦ä¸²ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å­—ç¬¦ä¸²æ± æˆ–è€…ä½¿ç”¨ String.intern() æ–¹æ³•ï¼Œä»¥é¿å…åˆ›å»ºå¤§é‡çš„ String å¯¹è±¡ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ä¸æ¨èçš„å†™æ³•ï¼Œä¼šåˆ›å»ºå¤§é‡çš„ String å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="s">&#34;&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">1000000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">str</span> <span class="o">+=</span> <span class="s">&#34;a&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ¨èçš„å†™æ³•ï¼Œä½¿ç”¨ StringBuilder å’Œå­—ç¬¦ä¸²æ± 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">StringBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">1000000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">&#34;a&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="n">String</span> <span class="n">str</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">().</span><span class="na">intern</span><span class="o">();</span>
</span></span></code></pre></div><blockquote>
<p><strong>String.intern() æ–¹æ³•</strong></p>
<p>String.intern() æ–¹æ³•æ˜¯ä¸€ä¸ª native æ–¹æ³•ï¼Œå®ƒçš„ä½œç”¨æ˜¯è¿”å›å­—ç¬¦ä¸²å¯¹è±¡çš„è§„èŒƒåŒ–è¡¨ç¤ºå½¢å¼ï¼Œå³è¿”å›å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ä¸è¯¥å­—ç¬¦ä¸²ç›¸ç­‰çš„å¯¹è±¡çš„å¼•ç”¨ï¼ˆå¦‚æœå¸¸é‡æ± ä¸­å·²ç»å­˜åœ¨è¯¥å­—ç¬¦ä¸²ï¼Œåˆ™ç›´æ¥è¿”å›å¸¸é‡æ± ä¸­çš„å¯¹è±¡ï¼›å¦åˆ™ï¼Œå°†è¯¥å­—ç¬¦ä¸²æ·»åŠ åˆ°å¸¸é‡æ± ä¸­ï¼Œå¹¶è¿”å›è¯¥å­—ç¬¦ä¸²çš„å¼•ç”¨ï¼‰ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰å¦‚ä¸‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">String</span> <span class="n">s1</span> <span class="o">=</span> <span class="s">&#34;hello&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="n">String</span> <span class="n">s2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="s">&#34;hello&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">String</span> <span class="n">s3</span> <span class="o">=</span> <span class="n">s2</span><span class="o">.</span><span class="na">intern</span><span class="o">();</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ s1ï¼Œå®ƒæ˜¯å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„ä¸€ä¸ªå¯¹è±¡ã€‚ç„¶åï¼Œæˆ‘ä»¬é€šè¿‡ new å…³é”®å­—åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ s2ï¼Œå®ƒä¸ s1 çš„å†…å®¹ç›¸åŒï¼Œä½†æ˜¯å®ƒåœ¨å †å†…å­˜ä¸­åˆ›å»ºã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è°ƒç”¨ s2 çš„ intern() æ–¹æ³•ï¼Œå°† s2 æ”¾å…¥å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œå¹¶è¿”å›å¸¸é‡æ± ä¸­çš„å¯¹è±¡å¼•ç”¨ã€‚å› æ­¤ï¼Œs3 æŒ‡å‘çš„æ˜¯å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å¯¹è±¡ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡æ˜¯å”¯ä¸€çš„ï¼Œå› æ­¤ä½¿ç”¨ intern() æ–¹æ³•å¯ä»¥èŠ‚çœå†…å­˜ç©ºé—´ã€‚ä½†æ˜¯ï¼Œç”±äºå­—ç¬¦ä¸²å¸¸é‡æ± çš„ç©ºé—´æ˜¯æœ‰é™çš„ï¼Œå¦‚æœç¨‹åºä¸­å¤§é‡ä½¿ç”¨ intern() æ–¹æ³•ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¸¸é‡æ± æº¢å‡ºçš„é—®é¢˜ã€‚å› æ­¤ï¼Œå¦‚æœä¸æ˜¯å¿…é¡»ä½¿ç”¨ intern() æ–¹æ³•ï¼Œæœ€å¥½ä¸è¦ä½¿ç”¨å®ƒã€‚</p>
<p>å¦å¤–ï¼Œ<strong>ç”±äº intern() æ–¹æ³•æ˜¯ä¸€ä¸ª native æ–¹æ³•ï¼Œå®ƒçš„æ€§èƒ½å¯èƒ½ä¼šæ¯”è¾ƒä½ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œåº”è¯¥æ ¹æ®å…·ä½“æƒ…å†µè¿›è¡Œé€‰æ‹©ï¼Œé¿å…æ»¥ç”¨ intern() æ–¹æ³•</strong>ã€‚</p>
</blockquote>
</li>
<li>
<p>å°½é‡ä½¿ç”¨é™æ€å·¥å‚æ–¹æ³•è€Œä¸æ˜¯æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼Œå› ä¸ºé™æ€å·¥å‚æ–¹æ³•å¯ä»¥é‡å¤ä½¿ç”¨å·²ç»åˆ›å»ºçš„å¯¹è±¡ï¼Œä»è€Œé¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ä¸æ¨èçš„å†™æ³•ï¼Œæ¯æ¬¡éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Date</span> <span class="n">now</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ¨èçš„å†™æ³•ï¼Œä½¿ç”¨é™æ€å·¥å‚æ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Date</span> <span class="n">now</span> <span class="o">=</span> <span class="n">Date</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">Instant</span><span class="o">.</span><span class="na">now</span><span class="o">());</span>
</span></span></code></pre></div></li>
<li>
<p>é¿å…åˆ›å»ºä¸å¿…è¦çš„æ•°ç»„ï¼Œå¯ä»¥ä½¿ç”¨ Listã€Setã€Map ç­‰é›†åˆç±»å‹æ¥ä»£æ›¿æ•°ç»„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ä¸æ¨èçš„å†™æ³•ï¼Œä¼šåˆ›å»ºä¸å¿…è¦çš„æ•°ç»„å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">String</span><span class="o">[]</span> <span class="n">arr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&#34;a&#34;</span><span class="o">,</span> <span class="s">&#34;b&#34;</span><span class="o">,</span> <span class="s">&#34;c&#34;</span><span class="o">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ¨èçš„å†™æ³•ï¼Œä½¿ç”¨ List
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;a&#34;</span><span class="o">,</span> <span class="s">&#34;b&#34;</span><span class="o">,</span> <span class="s">&#34;c&#34;</span><span class="o">);</span>
</span></span></code></pre></div></li>
<li>
<p>å¦‚æœå¿…é¡»åˆ›å»ºä¸å¯å˜çš„æ•°ç»„ï¼Œå¯ä»¥ä½¿ç”¨é™æ€å·¥å‚æ–¹æ³• Arrays.asList() æ¥åˆ›å»º Listï¼Œä»è€Œé¿å…åˆ›å»ºé¢å¤–çš„æ•°ç»„å¯¹è±¡ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ä¸æ¨èçš„å†™æ³•ï¼Œä¼šåˆ›å»ºä¸å¿…è¦çš„æ•°ç»„å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">String</span><span class="o">[]</span> <span class="n">arr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&#34;a&#34;</span><span class="o">,</span> <span class="s">&#34;b&#34;</span><span class="o">,</span> <span class="s">&#34;c&#34;</span><span class="o">};</span>
</span></span><span class="line"><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;(</span><span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">arr</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ¨èçš„å†™æ³•ï¼Œä½¿ç”¨ Arrays.asList()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&#34;a&#34;</span><span class="o">,</span> <span class="s">&#34;b&#34;</span><span class="o">,</span> <span class="s">&#34;c&#34;</span><span class="o">);</span>
</span></span></code></pre></div></li>
<li>
<p>é¿å…åˆ›å»ºè¿‡å¤šçš„ä¸´æ—¶å¯¹è±¡ï¼Œå¦‚åœ¨å¾ªç¯ä¸­åˆ›å»ºçš„å¯¹è±¡ã€‚å¯ä»¥é‡å¤ä½¿ç”¨å·²ç»åˆ›å»ºçš„å¯¹è±¡ï¼Œæˆ–è€…ä½¿ç”¨å¯é‡ç”¨çš„å¯¹è±¡æ± æ¥å‡å°‘å¯¹è±¡çš„åˆ›å»ºå’Œåƒåœ¾å›æ”¶ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ä¸æ¨èçš„å†™æ³•ï¼Œä¼šåˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ¨èçš„å†™æ³•ï¼Œä½¿ç”¨å¯é‡ç”¨çš„å¯¹è±¡æ± 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl"><span class="n">StringBuffer</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">sb</span><span class="o">.</span><span class="na">setLength</span><span class="o">(</span><span class="n">0</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div></li>
<li>
<p>é¿å…åœ¨ç±»çš„æ„é€ æ–¹æ³•ä¸­åˆ›å»ºå¤§é‡çš„å¯¹è±¡ã€‚å¦‚æœåœ¨æ„é€ æ–¹æ³•ä¸­åˆ›å»ºå¤§é‡çš„å¯¹è±¡ï¼Œä¼šå¯¼è‡´å†…å­˜å ç”¨è¿‡å¤§ï¼Œä»è€Œå½±å“ç¨‹åºçš„æ€§èƒ½ã€‚å¯ä»¥å°†å¯¹è±¡çš„åˆ›å»ºæ”¾åœ¨éœ€è¦ä½¿ç”¨çš„æ–¹æ³•ä¸­ï¼Œæˆ–è€…ä½¿ç”¨æ‡’åŠ è½½çš„æ–¹å¼æ¥å»¶è¿Ÿå¯¹è±¡çš„åˆ›å»ºã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ä¸æ¨èçš„å†™æ³•ï¼Œä¼šåœ¨æ„é€ æ–¹æ³•ä¸­åˆ›å»ºå¤§é‡çš„å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyClass</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">MyClass</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ¨èçš„å†™æ³•ï¼Œå°†å¯¹è±¡çš„åˆ›å»ºæ”¾åœ¨éœ€è¦ä½¿ç”¨çš„æ–¹æ³•ä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyClass</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">MyClass</span><span class="o">()</span> <span class="o">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">getList</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">list</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">10000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div></li>
<li>
<p>é¿å…åœ¨é€’å½’æ–¹æ³•ä¸­åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ã€‚å¦‚æœåœ¨é€’å½’æ–¹æ³•ä¸­åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ï¼Œä¼šå¯¼è‡´å†…å­˜å ç”¨è¿‡å¤§ï¼Œä»è€Œå¯¼è‡´æ ˆæº¢å‡ºç­‰é—®é¢˜ã€‚å¯ä»¥ä½¿ç”¨å¯é‡ç”¨çš„å¯¹è±¡æ± æ¥å‡å°‘å¯¹è±¡çš„åˆ›å»ºå’Œåƒåœ¾å›æ”¶ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// ä¸æ¨èçš„å†™æ³•ï¼Œä¼šåœ¨é€’å½’æ–¹æ³•ä¸­åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">fibonacci</span><span class="o">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="n">1</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">n</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">fibonacci</span><span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">1</span><span class="o">)</span> <span class="o">+</span> <span class="n">fibonacci</span><span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">2</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ¨èçš„å†™æ³•ï¼Œä½¿ç”¨å¯é‡ç”¨çš„å¯¹è±¡æ± 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">fibonacci</span><span class="o">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">cache</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="n">1</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">n</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">cache</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">n</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">cache</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">n</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">fibonacci</span><span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">1</span><span class="o">,</span> <span class="n">cache</span><span class="o">)</span> <span class="o">+</span> <span class="n">fibonacci</span><span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">2</span><span class="o">,</span> <span class="n">cache</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">cache</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">n</span><span class="o">,</span> <span class="n">result</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div></li>
</ol>
<h2 id="é€‚é…å™¨æ¨¡å¼">é€‚é…å™¨æ¨¡å¼</h2>
<p>é€‚é…å™¨æ¨¡å¼æ˜¯ä¸€ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬å°†ä¸€ä¸ªå¯¹è±¡çš„æ¥å£é€‚é…æˆå¦ä¸€ä¸ªå¯¹è±¡çš„æ¥å£ã€‚é€‚é…å™¨æ¨¡å¼é€šå¸¸ç”¨äºä»¥ä¸‹æƒ…å†µï¼š</p>
<ol>
<li>å½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€ä¸ªå·²æœ‰çš„ç±»ï¼Œä½†æ˜¯å®ƒçš„æ¥å£ä¸æˆ‘ä»¬æœŸæœ›çš„ä¸å…¼å®¹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é€‚é…å™¨æ¨¡å¼æ¥å°†å…¶æ¥å£é€‚é…æˆæˆ‘ä»¬éœ€è¦çš„æ¥å£ã€‚</li>
<li>å½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨å¤šä¸ªä¸å…¼å®¹çš„ç±»æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é€‚é…å™¨æ¨¡å¼æ¥å°†å®ƒä»¬çš„æ¥å£é€‚é…æˆä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ã€‚</li>
</ol>
<p>åœ¨é€‚é…å™¨æ¨¡å¼ä¸­ï¼Œé€‚é…å™¨å¯¹è±¡é€šå¸¸æ˜¯ä¸å¯å˜çš„ï¼Œå› ä¸ºå®ƒä»¬çš„çŠ¶æ€ä¸è¶…è¿‡æ”¯æŒå¯¹è±¡çš„çŠ¶æ€ã€‚å› æ­¤ï¼Œå¯ä»¥å®‰å…¨åœ°å¤ç”¨é€‚é…å™¨å¯¹è±¡ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸ªæ”¯æŒè‹±å›½æ’å¤´çš„è®¾å¤‡ï¼Œä½†æˆ‘ä»¬éœ€è¦å°†å…¶æ’å…¥åˆ°ä¸€ä¸ªç¾å›½æ’åº§ä¸Šã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªé€‚é…å™¨æ¥é€‚é…è‹±å›½æ’å¤´åˆ°ç¾å›½æ’åº§ã€‚é€‚é…å™¨çš„çŠ¶æ€ä¸è¶…è¿‡è‹±å›½æ’å¤´çš„çŠ¶æ€ï¼Œå› æ­¤å¯ä»¥å®‰å…¨åœ°å¤ç”¨é€‚é…å™¨å¯¹è±¡ï¼Œè€Œä¸å¿…ä¸ºæ¯ä¸ªè®¾å¤‡åˆ›å»ºä¸€ä¸ªæ–°çš„é€‚é…å™¨å¯¹è±¡ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„é€‚é…å™¨ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// æ”¯æŒè‹±å›½æ’å¤´çš„è®¾å¤‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BritishDevice</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">plugIn</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Plugged in British device&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ç¾å›½æ’åº§æ¥å£
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">USPlug</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">plug</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// è‹±å›½åˆ°ç¾å›½çš„é€‚é…å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BritishToUSAdapter</span> <span class="kd">implements</span> <span class="n">USPlug</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">BritishDevice</span> <span class="n">device</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">BritishToUSAdapter</span><span class="o">(</span><span class="n">BritishDevice</span> <span class="n">device</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">device</span> <span class="o">=</span> <span class="n">device</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">plug</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">device</span><span class="o">.</span><span class="na">plugIn</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ç¾å›½æ’åº§
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">USOutlet</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">plugIn</span><span class="o">(</span><span class="n">USPlug</span> <span class="n">plug</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">plug</span><span class="o">.</span><span class="na">plug</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æµ‹è¯•é€‚é…å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestAdapter</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">BritishDevice</span> <span class="n">device</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BritishDevice</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">BritishToUSAdapter</span> <span class="n">adapter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BritishToUSAdapter</span><span class="o">(</span><span class="n">device</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">USOutlet</span> <span class="n">outlet</span> <span class="o">=</span> <span class="k">new</span> <span class="n">USOutlet</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">outlet</span><span class="o">.</span><span class="na">plugIn</span><span class="o">(</span><span class="n">adapter</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª BritishDevice ç±»æ¥æ¨¡æ‹Ÿä¸€ä¸ªæ”¯æŒè‹±å›½æ’å¤´çš„è®¾å¤‡ã€‚æˆ‘ä»¬è¿˜å®šä¹‰äº†ä¸€ä¸ª USPlug æ¥å£æ¥è¡¨ç¤ºä¸€ä¸ªç¾å›½æ’å¤´ï¼Œä»¥åŠä¸€ä¸ª USOutlet ç±»æ¥è¡¨ç¤ºä¸€ä¸ªç¾å›½æ’åº§ã€‚</p>
<p>æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªé€‚é…å™¨ç±» BritishToUSAdapter æ¥é€‚é… BritishDevice åˆ° USPlug æ¥å£ã€‚é€‚é…å™¨ç±»çš„æ„é€ å‡½æ•°æ¥æ”¶ä¸€ä¸ª BritishDevice å¯¹è±¡ï¼Œå¹¶å°†å…¶ä¿å­˜åœ¨ä¸€ä¸ªæˆå‘˜å˜é‡ä¸­ã€‚é€‚é…å™¨å®ç°äº† USPlug æ¥å£ï¼Œå¹¶å°† plug æ–¹æ³•å§”æ‰˜ç»™ BritishDevice å¯¹è±¡çš„ plugIn æ–¹æ³•ã€‚</p>
<p>åœ¨æµ‹è¯•é€‚é…å™¨æ—¶ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª BritishDevice å¯¹è±¡å’Œä¸€ä¸ªé€‚é…å™¨å¯¹è±¡ï¼Œå¹¶å°†é€‚é…å™¨å¯¹è±¡ä¼ é€’ç»™ USOutlet çš„ plugIn æ–¹æ³•ã€‚USOutlet å¯¹è±¡ä½¿ç”¨é€‚é…å™¨å¯¹è±¡æ¥å°† BritishDevice å¯¹è±¡é€‚é…åˆ° USPlug æ¥å£ï¼Œä»è€Œå°†å…¶æ’å…¥åˆ°ç¾å›½æ’åº§ä¸­ã€‚</p>
<p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<strong>é€‚é…å™¨å¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œå› ä¸ºå®ƒçš„çŠ¶æ€ä¸è¶…è¿‡æ”¯æŒå¯¹è±¡çš„çŠ¶æ€ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å®‰å…¨åœ°å¤ç”¨é€‚é…å™¨å¯¹è±¡ï¼Œè€Œä¸å¿…ä¸ºæ¯ä¸ªè®¾å¤‡åˆ›å»ºä¸€ä¸ªæ–°çš„é€‚é…å™¨å¯¹è±¡ã€‚</strong></p>
<h2 id="æ‰©å±•">æ‰©å±•</h2>
<h3 id="java-8-çš„-stream-api--é¿å…åˆ›å»ºä¸å¿…è¦å¯¹è±¡">Java 8 çš„ Stream API  é¿å…åˆ›å»ºä¸å¿…è¦å¯¹è±¡</h3>
<p>ä¸‹é¢è¿™æ®µä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kt">long</span> <span class="n">sum</span> <span class="o">=</span> <span class="n">categoryStatistics</span><span class="o">.</span><span class="na">getData</span><span class="o">().</span><span class="na">stream</span><span class="o">().</span><span class="na">mapToLong</span><span class="o">(</span><span class="n">t</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="na">getValue</span><span class="o">()).</span><span class="na">sum</span><span class="o">();</span>
</span></span></code></pre></div><p>åœ¨ä½¿ç”¨ <code>list.stream().mapToLong(t -&gt; t.getValue()).sum()</code> å¯¹é›†åˆä¸­çš„å…ƒç´ è¿›è¡Œæ±‚å’Œæ—¶ï¼Œç¡®å®å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥é¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼Œ<code>mapToLong()</code> æ–¹æ³•ä¼šå°†é›†åˆä¸­çš„å…ƒç´ æ˜ å°„ä¸ºä¸€ä¸ª LongStream å¯¹è±¡ï¼Œè€Œ LongStream å¯¹è±¡æ˜¯ä¸€ä¸ª<code>åŸå§‹ç±»å‹æµ</code>ï¼Œå®ƒåœ¨å†…å­˜ä¸­çš„å ç”¨ç©ºé—´æ¯”è¾ƒå°ã€‚å› æ­¤ï¼Œä½¿ç”¨ <code>mapToLong() </code>æ–¹æ³•å¯ä»¥é¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ï¼Œä»è€Œæé«˜ç¨‹åºçš„æ€§èƒ½ã€‚</p>
<p>å¦å¤–ï¼Œsum() æ–¹æ³•æ˜¯ä¸€ä¸ªç»ˆç«¯æ“ä½œï¼Œå®ƒä¼šå¯¹æµä¸­çš„æ‰€æœ‰å…ƒç´ è¿›è¡Œæ±‚å’Œï¼Œå¹¶è¿”å›æœ€ç»ˆçš„ç»“æœã€‚ç”±äº sum() æ–¹æ³•æ˜¯ä¸€ä¸ªç»ˆç«¯æ“ä½œï¼Œå®ƒä¼šç›´æ¥å¯¹æµä¸­çš„å…ƒç´ è¿›è¡Œæ±‚å’Œï¼Œè€Œä¸ä¼šåˆ›å»ºæ–°çš„å¯¹è±¡ã€‚å› æ­¤ï¼Œä½¿ç”¨ sum() æ–¹æ³•å¯ä»¥è¿›ä¸€æ­¥é¿å…åˆ›å»ºä¸å¿…è¦çš„å¯¹è±¡ï¼Œä»è€Œæé«˜ç¨‹åºçš„æ€§èƒ½ã€‚</p>
<blockquote>
<p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ<code>list.stream().mapToLong(t -&gt; t.getValue()).sum()</code> çš„æ€§èƒ½ä¼šæ¯” <code>list.stream().mapToLong(t -&gt; t.getValue()).reduce(0L, (a, b) -&gt; a + b)</code> æ›´å¥½ã€‚</p>
<p>åŸå› æ˜¯ï¼Œ<code>sum()</code> æ–¹æ³•æ˜¯ä¸€ä¸ªç»ˆç«¯æ“ä½œï¼Œå®ƒä¼šå¯¹æµä¸­çš„æ‰€æœ‰å…ƒç´ è¿›è¡Œæ±‚å’Œï¼Œå¹¶è¿”å›æœ€ç»ˆçš„ç»“æœã€‚<strong><code>sum()</code> æ–¹æ³•åº•å±‚ä½¿ç”¨äº†ä¸€äº›ä¼˜åŒ–æŠ€æœ¯ï¼Œä¾‹å¦‚ä½¿ç”¨å¾ªç¯å±•å¼€ã€ä½¿ç”¨ SIMD æŒ‡ä»¤ç­‰ï¼Œä»è€Œå……åˆ†åˆ©ç”¨ CPU çš„æ€§èƒ½ä¼˜åŠ¿ï¼Œæé«˜è®¡ç®—é€Ÿåº¦</strong>ã€‚</p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œ<code>reduce()</code> æ–¹æ³•æ˜¯ä¸€ä¸ªå½’çº¦æ“ä½œï¼Œå®ƒå°†å¯¹æµä¸­çš„å…ƒç´ è¿›è¡Œç´¯è®¡è®¡ç®—ï¼Œå¹¶è¿”å›æœ€ç»ˆçš„ç»“æœã€‚ç”±äº <code>reduce() </code>æ–¹æ³•éœ€è¦å¯¹å…ƒç´ è¿›è¡ŒäºŒå…ƒæ“ä½œï¼Œå› æ­¤å®ƒæ¯” <code>sum()</code> æ–¹æ³•æ›´åŠ å¤æ‚ï¼Œå¯èƒ½ä¼šå¸¦æ¥ä¸€äº›é¢å¤–çš„å¼€é”€ã€‚æ­¤å¤–ï¼Œ<code>reduce()</code> æ–¹æ³•è¿˜éœ€è¦æŒ‡å®šä¸€ä¸ªåˆå§‹å€¼ï¼Œå¦‚æœåˆå§‹å€¼ä¸å½“ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç»“æœé”™è¯¯æˆ–è€…æ€§èƒ½ä¸‹é™ã€‚</p>
<p>ä¸è¿‡ï¼Œå¯¹äºæŸäº›ç‰¹æ®Šæƒ…å†µï¼Œ<code>reduce()</code> æ–¹æ³•å¯èƒ½ä¼šæ¯” <code>sum()</code> æ–¹æ³•æ›´åŠ é€‚ç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å¯¹æµä¸­çš„å…ƒç´ è¿›è¡Œè‡ªå®šä¹‰çš„ç´¯è®¡è®¡ç®—ï¼Œå°±éœ€è¦ä½¿ç”¨ <code>reduce() </code>æ–¹æ³•ã€‚æ­¤å¤–ï¼Œ<code>reduce()</code>æ–¹æ³•è¿˜æ”¯æŒå¹¶è¡Œè®¡ç®—ï¼Œå¯ä»¥å……åˆ†åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨çš„æ€§èƒ½ä¼˜åŠ¿ï¼Œæé«˜è®¡ç®—é€Ÿåº¦ã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬åº”è¯¥æ ¹æ®å…·ä½“æƒ…å†µé€‰æ‹©ä½¿ç”¨ <code>sum()</code> æ–¹æ³•è¿˜æ˜¯ <code>reduce()</code> æ–¹æ³•ã€‚<strong>å¯¹äºå¤§å¤šæ•°æƒ…å†µä¸‹çš„æ±‚å’Œæ“ä½œï¼Œ<code>sum()</code> æ–¹æ³•æ˜¯ä¸€ä¸ªæ›´å¥½çš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒæ¯”<code> reduce()</code> æ–¹æ³•æ›´åŠ é«˜æ•ˆã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œ<code>reduce()</code> æ–¹æ³•å¯èƒ½ä¼šæ›´åŠ é€‚ç”¨</strong>ã€‚</p>
</blockquote>
<p>ä»¥ä¸Šã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>å‘¨æŠ¥-15ï½œUmamiå‡çº§åˆ°2.0ã€æ±‰è¡—èœ¡åƒé¦†ã€ä½¿ç”¨Stravaè·‘æ­¥</title>
      <link>https://blog.chensoul.com/posts/2023/04/18/weekly_review_15/</link>
      <pubDate>Tue, 18 Apr 2023 17:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/04/18/weekly_review_15/</guid>
      <description>å‰è¨€ â€‹ é¢˜å›¾ï¼šæ¥šæ²³æ±‰è¡—èœ¡åƒé¦† æœ¬ç¯‡æ˜¯å¯¹ 2023-04-10 åˆ° 2023-04-16 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚ è¿™å‘¨çš„å·¥ä½œä¸ç®—å¿™ç¢Œï¼Œç»§ç»­å­¦</description>
      <content:encoded><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-15-01.png" alt="weekly-review-15-01"  />
</p>
<p>â€‹														<em>é¢˜å›¾ï¼šæ¥šæ²³æ±‰è¡—èœ¡åƒé¦†</em></p>
<p>æœ¬ç¯‡æ˜¯å¯¹ <code>2023-04-10</code> åˆ° <code>2023-04-16</code> è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº <a href="https://blog.chensoul.com/">åšå®¢</a>ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚</p>
<p>è¿™å‘¨çš„å·¥ä½œä¸ç®—å¿™ç¢Œï¼Œç»§ç»­å­¦ä¹ ã€ŠEffective Java 3ã€‹è¿™æœ¬ä¹¦ï¼Œå¹¶èŠ±äº†ä¸€äº›æ—¶é—´å­¦ä¹  Rustã€Python çš„åŸºç¡€è¯­æ³•ã€‚</p>
<p>è¿™ä¸ªæœˆå·²ç»è¿‡äº†ä¸€åŠï¼Œå‡è‚¥ä¹Ÿè¿›è¡Œäº†ä¸¤å‘¨ï¼Œä½“é‡ä»72å…¬æ–¤å‡åˆ°äº†ç°åœ¨çš„68.4å…¬æ–¤ã€‚åœ¨ä¹‹å‰æ¯å¤©èµ°è·¯1ä¸‡æ­¥çš„åŸºç¡€ä¸Šï¼Œæ‰“ç®—å¼€å§‹æ¯å¤©è·‘æ­¥ï¼Œæ¯”è®°å½•è·‘æ­¥æ•°æ®ã€‚</p>
<p>è¿™å‘¨æ€»è®¡æ”¯å‡º916å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š</p>
<ul>
<li>4æœˆ12æ—¥ï¼š329å…ƒï¼Œå¼€é€šETCé¢„å­˜300å…ƒ</li>
<li>4æœˆ15æ—¥ï¼š116å…ƒï¼Œå‘¨æœ«ä¹°èœåšé¥­</li>
<li>4æœˆ16æ—¥ï¼š471å…ƒï¼Œè€å©†è¿‡ç”Ÿï¼Œåƒé¥­å’Œçœ‹ç”µå½±</li>
</ul>
<p>å››æœˆç´¯è®¡æ”¯å‡ºå…± 2025 å…ƒï¼Œå…¶ä¸­é¤é¥®å’Œè´­ç‰©å äº†ä¸€åŠã€‚</p>
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-15-05.jpeg" alt="weekly-review-15-05" style="width:50%;" />
<h2 id="å¥èº«">å¥èº«</h2>
<p>è¿™å‘¨æ¯å¤©èµ°è·¯æ­¥æ•°å¦‚ä¸‹ï¼Œå…¶ä¸­æœ‰ä¸€å¤©å› ä¸ºåŠ ç­è€Œæ²¡æœ‰å®Œæˆä¸€ä¸‡æ­¥çš„ç›®æ ‡ã€‚</p>
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-15-06.png" alt="weekly-review-15-06" style="width:50%;" />
<p>å— <a href="https://conge.livingwithfcs.org/">@Conge</a> åšå®¢å½±å“ï¼Œå¼€å§‹è®°å½•æ¯å¤©çš„è·‘æ­¥æ•°æ®ã€‚é¦–å…ˆæ˜¯æ³¨å†Œäº† strava è´¦å·ï¼Œç„¶åå‚è€ƒ <a href="https://github.com/yihong0618/running_page">running_page</a> éƒ¨ç½²äº†ä¸€ä¸ªæˆ‘çš„è·‘æ­¥ä¸»é¡µ <a href="https://run.chensoul.com/">run.chensoul.com</a>ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-15-02.png" alt="weekly-review-15-02"  />
</p>
<p>å› ä¸ºæˆ‘ä¹‹å‰æ˜¯ä½¿ç”¨æ‚¦è·‘åœˆ APP è®°å½•è·‘æ­¥ï¼Œæ‰€ä»¥åˆå‚è€ƒ<a href="https://github.com/yihong0618/running_page/blob/master/README-CN.md#joyrun%E6%82%A6%E8%B7%91%E5%9C%88">è¿™ç¯‡æ–‡ç« </a>å¯¼å‡º gpx æ•°æ®ï¼Œç„¶å<a href="https://github.com/yihong0618/running_page/blob/master/README-CN.md#gpx_to_strava">åŒæ­¥</a>åˆ° Stravaã€‚æœ€åï¼Œå¯ä»¥æŠŠæ‚¦è·‘åœˆ APP å¸è½½äº†ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-15-03.png" alt="weekly-review-15-03"  />
</p>
<p>ä¸Šå‘¨è·‘æ­¥æ•°æ®å¦‚ä¸‹ï¼Œæ€»è®¡28.64å…¬é‡Œï¼Œæ¯”ä¸Šå‘¨çš„19.05å…¬é‡Œå¤šäº†9.6å…¬é‡Œã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-15-04.png" alt="weekly-review-15-04"  />
</p>
<p>ä¸Šé¢æå®šäº†ä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨ Strava æ¥è·‘æ­¥äº†ã€‚ä¸ºäº†å¢åŠ ç¤¾äº¤ä¹è¶£æ€§ï¼Œæˆ‘åœ¨ n8n é‡Œé¢åˆ›å»ºäº†ä¸€ä¸ª workflowï¼Œå°† Strava æ´»åŠ¨å‘é€åˆ°æˆ‘çš„ã€<a href="https://t.me/chensoul_share">ChenSoul Share</a>ã€Telegram é¢‘é“ï¼Œæ•ˆæœå¦‚ä¸‹ã€‚</p>
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-15-07.png" alt="weekly-review-15-07" style="width:50%;" />
<h2 id="umamiå‡çº§åˆ°20">Umamiå‡çº§åˆ°2.0</h2>
<p>1ã€é¦–å…ˆå¤‡ä»½æ•°æ®åº“</p>
<p>2ã€å‡çº§æ•°æ®åº“</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git clone https://github.com/umami-software/migrate-v1-v2.git
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> migrate-v1-v2
</span></span><span class="line"><span class="cl">yarn install
</span></span><span class="line"><span class="cl">yarn build
</span></span></code></pre></div><p>åˆ›å»º .env æ–‡ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-properties" data-lang="properties"><span class="line"><span class="cl"><span class="c1">#ä¿®æ”¹ä¸ºä½ çš„æ•°æ®åº“åœ°å€</span>
</span></span><span class="line"><span class="cl"><span class="na">DATABASE_URL</span><span class="o">=</span><span class="s">postgresql://umami:xxxxx@postgres.chensoul.com:5432/umami</span>
</span></span></code></pre></div><p>è¿è¡Œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">yarn start
</span></span></code></pre></div><p>3ã€é‡æ–°éƒ¨ç½²é™æ€é¡µé¢</p>
<p>æ—¥å¿—æç¤ºæŠ¥é”™ï¼š</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-15-16.png" alt="weekly-review-15-16"  />
</p>
<p>è§£å†³åŠæ³•æ˜¯ä¿®æ”¹ scripts/check-db.jsï¼š</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-15-17.png" alt="weekly-review-15-17"  />
</p>
<p>4ã€ä¿®æ”¹è·Ÿè¸ªè„šæœ¬ï¼ŒæŠŠç«™ç‚¹ä¸­æ‰€æœ‰è¿½è¸ªè„šæœ¬åå­—<code>umami.js</code>æ”¹ä¸º<code>script.js</code>ã€‚</p>
<p>5ã€æœ€åæŸ¥çœ‹å®æ—¶ä»ªè¡¨ç›˜ã€‚æˆ‘çš„ umami å®æ—¶ <a href="https://umami.chensoul.com/realtime/f110cfa0-b737-4690-a032-2b9073a57fc3">è®¿é—®åœ°å€</a></p>
<h2 id="å·¥ä½œ">å·¥ä½œ</h2>
<h3 id="effective-java-3-ç¬”è®°">Effective Java 3 ç¬”è®°</h3>
<p>è¯·å‚è€ƒã€Š<a href="/posts/2023/04/17/prefer-dependency-injection-to-hardwiring-resources">Effective Java 3 ç¬”è®°ï¼šä¾èµ–æ³¨å…¥ä¼˜äºç¡¬ç¼–ç èµ„æº</a>ã€‹ã€‚</p>
<h2 id="æ±‰è¡—èœ¡åƒé¦†">æ±‰è¡—èœ¡åƒé¦†</h2>
<p>å‘¨æœ«è¶æ­¦æ±‰æ—…æ¸¸å¤§å¹´å¡è¿˜æ²¡è¿‡æœŸï¼Œè·‘åˆ°æ¥šæ²³æ±‰è¡—èœ¡åƒé¦†å»æºœè¾¾äº†ä¸€åœˆã€‚å› ä¸ºæœ‰å¹´å¡ï¼Œçœå»äº†150å…ƒçš„é—¨ç¥¨ã€‚</p>
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-15-08.png" alt="weekly-review-15-08" style="width:67%;" />
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-15-09.png" alt="weekly-review-15-09" style="width:67%;" />
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-15-10.png" alt="weekly-review-15-10" style="width:67%;" />
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-15-11.png" alt="weekly-review-15-11" style="width:67%;" />
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-15-12.png" alt="weekly-review-15-12" style="width:67%;" />
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-15-13.png" alt="weekly-review-15-13" style="width:67%;" />
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-15-14.png" alt="weekly-review-15-14" style="width:67%;" />
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-15-15.png" alt="weekly-review-15-15" style="width:67%;" />
<h2 id="å¥½ç‰©åˆ†äº«">å¥½ç‰©åˆ†äº«</h2>
<p>è™½ç„¶å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€<a href="https://t.me/chensoul_share">ChenSoul Share</a>ã€Telegram é¢‘é“ï¼Œä¸è¿‡è¿˜æ˜¯æŒ‘é€‰ä¸€éƒ¨åˆ†åœ¨è¿™é‡Œåˆ—ä¸¾ä¸€ä¸‹ï¼Œæ„Ÿè§‰æ›´åƒä¸€ä¸ª newsletter äº†ã€‚</p>
<h3 id="ä¸€äº›æ–‡ç« ">ä¸€äº›æ–‡ç« </h3>
<p>1ã€<a href="https://www3.ntu.edu.sg/home/ehchua/programming/index.html">Java ç¼–ç¨‹æ•™ç¨‹</a></p>
<p><img loading="lazy" src="https://cdn.beekka.com/blogimg/asset/202301/bg2023011504.webp" alt="img"  />
</p>
<p>è¿™ä¸ªç½‘ç«™æ˜¯æ–°åŠ å¡å—æ´‹ç†å·¥å¤§å­¦çš„ä¸€ä½è€å¸ˆçš„æ•™æ¡ˆï¼ˆè‹±æ–‡ï¼‰ï¼Œä¸»è¦å†…å®¹ä¸ºæ–°ç”Ÿçš„ Java ç¼–ç¨‹</p>
<p>2ã€<a href="https://offsec.tools/">offsec.tools</a></p>
<p><img loading="lazy" src="https://cdn.beekka.com/blogimg/asset/202301/bg2023012101.webp" alt="img"  />
</p>
<p>è¿™ä¸ªç½‘ç«™æ”¶é›†å„ç§å®‰å…¨ç›¸å…³çš„è½¯ä»¶å·¥å…·ï¼Œç›®å‰å…±æœ‰600å¤šä¸ªã€‚</p>
<p>3ã€<a href="https://juemuren4449.com/archives/habit-formation-plan">æˆ‘çš„ä¹ æƒ¯å…»æˆè®¡åˆ’ï¼šäº”åˆ†é’Ÿè§„åˆ™+æ‰“å¡</a></p>
<p>4ã€<a href="https://www.jitao.tech/posts/my-guiding-principles-after-20-years-of-programming/">æˆ‘ç¼–ç¨‹ 20 å¹´çš„æŒ‡å¯¼åŸåˆ™</a></p>
<p>5ã€<a href="https://lenciel.com/2022/10/renaming-with-zmv/">ç”¨ zmv æ‰¹é‡é‡å‘½åæ–‡ä»¶</a></p>
<h3 id="ä¸€äº›å·¥å…·">ä¸€äº›å·¥å…·</h3>
<ul>
<li><a href="https://webperformancereport.com/">WebPerformance Report</a> è¿™ä¸ªç½‘ç«™å¯ä»¥ç”¨é‚®ç®±è®¢é˜…ä½ çš„ç½‘ç«™æ€§èƒ½çš„ä¸ªæ€§åŒ–æŠ¥å‘Šã€‚å®ƒä¼šç›‘æ§æŒ‡å®šç½‘ç«™çš„æ€§èƒ½ï¼Œæ¯å‘¨ä¼šå‘é€ä¸€å°æŠ¥å‘Šé‚®ä»¶ç»™ä½ ã€‚</li>
</ul>
]]></content:encoded>
    </item>
    
    <item>
      <title>ã€ŠEffective Java 3ã€‹ç¬”è®°5ï¼šä¾èµ–æ³¨å…¥ä¼˜äºç¡¬ç¼–ç èµ„æº</title>
      <link>https://blog.chensoul.com/posts/2023/04/17/prefer-dependency-injection-to-hardwiring-resources/</link>
      <pubDate>Mon, 17 Apr 2023 17:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/04/17/prefer-dependency-injection-to-hardwiring-resources/</guid>
      <description>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼Œåœ¨æ•´ç†ç¬”è®°è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ chatgpt çš„å¸®åŠ©åšäº†ä¸€äº›æ‰©å±•ã€‚ ä»‹ç» ä¾èµ–æ³¨å…¥æ˜¯è½¯ä»¶å·¥ç¨‹ä¸­ä½¿ç”¨çš„ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œç”¨</description>
      <content:encoded><![CDATA[<p>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼Œåœ¨æ•´ç†ç¬”è®°è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ chatgpt çš„å¸®åŠ©åšäº†ä¸€äº›æ‰©å±•ã€‚</p>
<h2 id="ä»‹ç»">ä»‹ç»</h2>
<p>ä¾èµ–æ³¨å…¥æ˜¯è½¯ä»¶å·¥ç¨‹ä¸­ä½¿ç”¨çš„ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œç”¨äºå°†ç»„ä»¶å’Œä¾èµ–é¡¹ç›¸äº’è§£è€¦ã€‚è€Œä¸æ˜¯åœ¨ç»„ä»¶å†…éƒ¨åˆ›å»ºå’Œç®¡ç†ä¾èµ–é¡¹ï¼Œæˆ‘ä»¬ä»å¤–éƒ¨ä¼ é€’å®ƒä»¬ã€‚è¿™ç§æ–¹æ³•å¯ä»¥å¸®åŠ©åˆ›å»ºæ›´æ¨¡å—åŒ–å’Œçµæ´»çš„ä»£ç ã€‚</p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œç¡¬ç¼–ç èµ„æºæ¶‰åŠåœ¨ç»„ä»¶å†…éƒ¨ç›´æ¥åˆ›å»ºå’Œç®¡ç†ä¾èµ–é¡¹ã€‚è¿™ç§æ–¹æ³•å¯èƒ½ä¼šä½¿ä»£ç ä¸å¤ªçµæ´»ï¼Œéš¾ä»¥ç»´æŠ¤ã€‚</p>
<h2 id="ä¸¾ä¾‹">ä¸¾ä¾‹</h2>
<p>è®¸å¤šç±»ä¾èµ–äºä¸€ä¸ªæˆ–å¤šä¸ªåº•å±‚èµ„æºã€‚ä¾‹å¦‚ï¼Œæ‹¼å†™æ£€æŸ¥ç¨‹åºä¾èµ–äºå­—å…¸ã€‚å¸¸è§åšæ³•æ˜¯ï¼Œå°†è¿™ç§ç±»å®ç°ä¸ºé™æ€å®ç”¨å·¥å…·ç±»ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Inappropriate use of static utility - inflexible &amp; untestable!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpellChecker</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Lexicon</span> <span class="n">dictionary</span> <span class="o">=</span> <span class="o">...;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">SpellChecker</span><span class="o">()</span> <span class="o">{}</span> <span class="c1">// Noninstantiable
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">isValid</span><span class="o">(</span><span class="n">String</span> <span class="n">word</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">suggestions</span><span class="o">(</span><span class="n">String</span> <span class="n">typo</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬ä¹Ÿç»å¸¸çœ‹åˆ°å®ƒä»¬çš„å•ä¾‹å®ç°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Inappropriate use of singleton - inflexible &amp; untestable!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpellChecker</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SpellChecker</span><span class="o">(...);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Lexicon</span> <span class="n">dictionary</span> <span class="o">=</span> <span class="o">...;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">SpellChecker</span><span class="o">(...)</span> <span class="o">{}</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isValid</span><span class="o">(</span><span class="n">String</span> <span class="n">word</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">suggestions</span><span class="o">(</span><span class="n">String</span> <span class="n">typo</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>è¿™ä¸¤ç§æ–¹æ³•éƒ½ä¸ä»¤äººæ»¡æ„ï¼Œå› ä¸ºå®ƒä»¬å‡è®¾åªä½¿ç”¨ä¸€ä¸ªå­—å…¸ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ¯ç§è¯­è¨€éƒ½æœ‰è‡ªå·±çš„å­—å…¸ï¼Œç‰¹æ®Šçš„å­—å…¸ç”¨äºç‰¹æ®Šçš„è¯æ±‡è¡¨ã€‚å¦å¤–ï¼Œæœ€å¥½ä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„å­—å…¸è¿›è¡Œæµ‹è¯•ã€‚</p>
<p>ä½ å¯ä»¥å°è¯•è®© SpellChecker æ”¯æŒå¤šä¸ªå­—å…¸ï¼šé¦–å…ˆå–æ¶ˆ dictionary å­—æ®µçš„ final ä¿®é¥°ï¼Œå¹¶åœ¨ç°æœ‰çš„æ‹¼å†™æ£€æŸ¥å™¨ä¸­æ·»åŠ æ›´æ”¹ dictionary çš„æ–¹æ³•ã€‚ä½†æ˜¯åœ¨å¹¶å‘ç¯å¢ƒä¸­è¿™ç§åšæ³•æ˜¯ç¬¨æ‹™çš„ã€å®¹æ˜“å‡ºé”™çš„å’Œä¸å¯è¡Œçš„ã€‚<strong>é™æ€å®ç”¨å·¥å…·ç±»å’Œå•ä¾‹ä¸é€‚ç”¨äºç”±åº•å±‚èµ„æºå‚æ•°åŒ–çš„ç±»ã€‚</strong></p>
<p>æ‰€éœ€è¦çš„æ˜¯æ”¯æŒç±»çš„å¤šä¸ªå®ä¾‹çš„èƒ½åŠ›ï¼ˆåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­æ˜¯ SpellCheckerï¼‰ï¼Œæ¯ä¸ªå®ä¾‹éƒ½ä½¿ç”¨å®¢æˆ·ç«¯éœ€è¦çš„èµ„æºï¼ˆåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­æ˜¯ dictionaryï¼‰ã€‚æ»¡è¶³æ­¤è¦æ±‚çš„ä¸€ä¸ªç®€å•æ¨¡å¼æ˜¯åœ¨<strong>åˆ›å»ºæ–°å®ä¾‹æ—¶å°†èµ„æºä¼ é€’ç»™æ„é€ å‡½æ•°ã€‚</strong> è¿™æ˜¯ä¾èµ–æ³¨å…¥çš„ä¸€ç§å½¢å¼ï¼šå­—å…¸æ˜¯æ‹¼å†™æ£€æŸ¥å™¨çš„ä¾èµ–é¡¹ï¼Œåœ¨åˆ›å»ºå®ƒæ—¶è¢«æ³¨å…¥åˆ°æ‹¼å†™æ£€æŸ¥å™¨ä¸­ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Dependency injection provides flexibility and testability
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpellChecker</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Lexicon</span> <span class="n">dictionary</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">SpellChecker</span><span class="o">(</span><span class="n">Lexicon</span> <span class="n">dictionary</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">dictionary</span> <span class="o">=</span> <span class="n">Objects</span><span class="o">.</span><span class="na">requireNonNull</span><span class="o">(</span><span class="n">dictionary</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isValid</span><span class="o">(</span><span class="n">String</span> <span class="n">word</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="nf">suggestions</span><span class="o">(</span><span class="n">String</span> <span class="n">typo</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ä¾èµ–æ³¨å…¥æ¨¡å¼éå¸¸ç®€å•ï¼Œè®¸å¤šç¨‹åºå‘˜åœ¨ä¸çŸ¥é“å…¶åç§°çš„æƒ…å†µä¸‹ä½¿ç”¨äº†å¤šå¹´ã€‚è™½ç„¶æ‹¼å†™æ£€æŸ¥å™¨ç¤ºä¾‹åªæœ‰ä¸€ä¸ªèµ„æºï¼ˆå­—å…¸ï¼‰ï¼Œä½†æ˜¯ä¾èµ–æ³¨å…¥å¯ä»¥å¤„ç†ä»»æ„æ•°é‡çš„èµ„æºå’Œä»»æ„ä¾èµ–è·¯å¾„ã€‚å®ƒä¿æŒäº†ä¸å¯å˜æ€§ï¼Œå› æ­¤å¤šä¸ªå®¢æˆ·ç«¯å¯ä»¥å…±äº«ä¾èµ–å¯¹è±¡ï¼ˆå‡è®¾å®¢æˆ·ç«¯éœ€è¦ç›¸åŒçš„åº•å±‚èµ„æºï¼‰ã€‚<strong>ä¾èµ–æ³¨å…¥åŒæ ·é€‚ç”¨äºæ„é€ å‡½æ•°ã€é™æ€å·¥å‚å’Œæ„å»ºå™¨</strong>ã€‚</p>
<p>ä»¥ä¸‹æ˜¯è¿™äº›æƒ…å†µçš„ç¤ºä¾‹ï¼š</p>
<h3 id="æ„é€ å‡½æ•°">æ„é€ å‡½æ•°</h3>
<p>åœ¨æ„é€ å‡½æ•°ä¸­ä½¿ç”¨ä¾èµ–æ³¨å…¥æ˜¯æœ€å¸¸è§çš„æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º<code>UserService</code>çš„ç±»ï¼Œå®ƒéœ€è¦ä¸€ä¸ªèƒ½å¤ŸéªŒè¯ç”¨æˆ·çš„<code>UserValidator</code>æ¥å£ä½œä¸ºä¾èµ–é¡¹ã€‚æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·åœ¨æ„é€ å‡½æ•°ä¸­æ³¨å…¥<code>UserValidator</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserService</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">UserValidator</span> <span class="n">userValidator</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">UserService</span><span class="o">(</span><span class="n">UserValidator</span> <span class="n">userValidator</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">userValidator</span> <span class="o">=</span> <span class="n">userValidator</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><h3 id="é™æ€å·¥å‚">é™æ€å·¥å‚</h3>
<p>é™æ€å·¥å‚æ˜¯ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ï¼Œå®ƒå°†åˆ›å»ºå¯¹è±¡çš„é€»è¾‘å°è£…åœ¨ä¸€ä¸ªé™æ€æ–¹æ³•ä¸­ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º<code>UserServiceFactory</code>çš„ç±»ï¼Œå®ƒè´Ÿè´£åˆ›å»º<code>UserService</code>å®ä¾‹ã€‚æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·åœ¨é™æ€å·¥å‚æ–¹æ³•ä¸­æ³¨å…¥<code>UserValidator</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserServiceFactory</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">UserService</span> <span class="nf">createUserService</span><span class="o">(</span><span class="n">UserValidator</span> <span class="n">userValidator</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">UserService</span><span class="o">(</span><span class="n">userValidator</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h3 id="æ„å»ºå™¨">æ„å»ºå™¨</h3>
<p>æ„å»ºå™¨æ˜¯ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ï¼Œå®ƒå°†åˆ›å»ºå¯¹è±¡çš„é€»è¾‘å°è£…åœ¨ä¸€ä¸ªæ„å»ºå™¨ç±»ä¸­ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º<code>UserServiceBuilder</code>çš„ç±»ï¼Œå®ƒè´Ÿè´£åˆ›å»º<code>UserService</code>å®ä¾‹ã€‚æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·åœ¨æ„å»ºå™¨ç±»ä¸­æ³¨å…¥<code>UserValidator</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserServiceBuilder</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">UserValidator</span> <span class="n">userValidator</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">UserServiceBuilder</span> <span class="nf">withUserValidator</span><span class="o">(</span><span class="n">UserValidator</span> <span class="n">userValidator</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">userValidator</span> <span class="o">=</span> <span class="n">userValidator</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">UserService</span> <span class="nf">build</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">UserService</span><span class="o">(</span><span class="n">userValidator</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ„å»ºå™¨æ¥åˆ›å»º<code>UserService</code>å®ä¾‹ï¼Œå¹¶åœ¨æ„å»ºå™¨ä¸­æ³¨å…¥<code>UserValidator</code>ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">UserValidator</span> <span class="n">userValidator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CustomUserValidator</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">UserService</span> <span class="n">userService</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UserServiceBuilder</span><span class="o">().</span><span class="na">withUserValidator</span><span class="o">(</span><span class="n">userValidator</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
</span></span></code></pre></div><p>è¿™ç§æ¨¡å¼çš„ä¸€ä¸ªæœ‰ç”¨å˜ä½“æ˜¯å°†èµ„æºå·¥å‚ä¼ é€’ç»™æ„é€ å‡½æ•°ã€‚èµ„æºå·¥å‚æ˜¯ä¸€ç§åˆ›å»ºå’Œæä¾›å¯¹è±¡çš„æ–¹å¼ï¼Œå®ƒå¯ä»¥åœ¨éœ€è¦æ—¶åŠ¨æ€åœ°åˆ›å»ºå’Œè¿”å›èµ„æºã€‚åœ¨å°†èµ„æºå·¥å‚ä¼ é€’ç»™æ„é€ å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¯¹è±¡çš„åˆ›å»ºå’Œé…ç½®é€»è¾‘ä»ç±»ä¸­ç§»é™¤ï¼Œä»è€Œå®ç°æ›´å¥½çš„å¯æµ‹è¯•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨èµ„æºå·¥å‚ä¼ é€’ç»™æ„é€ å‡½æ•°çš„ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserService</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">UserValidator</span> <span class="n">userValidator</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">UserService</span><span class="o">(</span><span class="n">ResourceFactory</span> <span class="n">resourceFactory</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">userValidator</span> <span class="o">=</span> <span class="n">resourceFactory</span><span class="o">.</span><span class="na">createUserValidator</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">dataSource</span> <span class="o">=</span> <span class="n">resourceFactory</span><span class="o">.</span><span class="na">createDataSource</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">authenticate</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">,</span> <span class="n">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// perform authentication using userValidator and dataSource
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>UserService</code>ç±»éœ€è¦ä¸€ä¸ªèƒ½å¤ŸéªŒè¯ç”¨æˆ·çš„<code>UserValidator</code>å®ä¾‹å’Œä¸€ä¸ª<code>DataSource</code>å®ä¾‹ã€‚è¿™ä¸¤ä¸ªä¾èµ–é¡¹éƒ½æ˜¯é€šè¿‡èµ„æºå·¥å‚æ¥åˆ›å»ºçš„ã€‚é€šè¿‡å°†èµ„æºå·¥å‚ä¼ é€’ç»™æ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¯¹è±¡çš„åˆ›å»ºå’Œé…ç½®é€»è¾‘ä»ç±»ä¸­ç§»é™¤ï¼Œå¹¶ä½¿å…¶æ›´åŠ çµæ´»å’Œå¯ç»´æŠ¤ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º<code>MySqlResourceFactory</code>çš„ç±»ï¼Œå®ƒå®ç°äº†<code>ResourceFactory</code>æ¥å£ï¼Œå¹¶ç”¨äºåˆ›å»º<code>UserValidator</code>å’Œ<code>DataSource</code>å®ä¾‹ã€‚æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·ä½¿ç”¨å®ƒæ¥åˆ›å»º<code>UserService</code>å®ä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ResourceFactory</span> <span class="n">resourceFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MySqlResourceFactory</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">UserService</span> <span class="n">userService</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UserService</span><span class="o">(</span><span class="n">resourceFactory</span><span class="o">);</span>
</span></span></code></pre></div><p>ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å°†<code>UserService</code>ç±»ä¸å…·ä½“çš„èµ„æºå®ç°è§£è€¦ï¼Œå¹¶ä½¿å…¶æ›´åŠ çµæ´»å’Œå¯ç»´æŠ¤ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°æ¨¡æ‹Ÿå’Œæµ‹è¯•<code>UserService</code>ç±»ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥åœ¨æµ‹è¯•ä¸­ä¼ é€’ä¸åŒçš„èµ„æºå·¥å‚å®ç°ï¼Œè€Œä¸éœ€è¦ä¾èµ–äºå¤–éƒ¨èµ„æºã€‚</p>
<h3 id="å‡½æ•°å¼æ¥å£">å‡½æ•°å¼æ¥å£</h3>
<p>åœ¨Java 8ä¸­ï¼Œ<code>Supplier&lt;T&gt;</code>æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œç”¨äºè¡¨ç¤ºä¸€ä¸ªæ— å‚æ•°å‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›ç±»å‹ä¸º<code>T</code>ã€‚ç”±äºå…¶å‡½æ•°å¼ç‰¹æ€§ï¼Œ<code>Supplier&lt;T&gt;</code>éå¸¸é€‚åˆè¡¨ç¤ºå·¥å‚ï¼Œå› ä¸ºå®ƒå¯ä»¥æä¾›ä¸€ç§é€šç”¨çš„æ–¹å¼æ¥åˆ›å»ºå¯¹è±¡ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨<code>Supplier&lt;T&gt;</code>è¡¨ç¤ºå·¥å‚çš„ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserService</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">UserValidator</span> <span class="n">userValidator</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">UserService</span><span class="o">(</span><span class="n">Supplier</span><span class="o">&lt;</span><span class="n">UserValidator</span><span class="o">&gt;</span> <span class="n">userValidatorFactory</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">userValidator</span> <span class="o">=</span> <span class="n">userValidatorFactory</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">authenticate</span><span class="o">(</span><span class="n">String</span> <span class="n">username</span><span class="o">,</span> <span class="n">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// perform authentication using userValidator
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>UserService</code>ç±»çš„æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ª<code>Supplier&lt;UserValidator&gt;</code>ä½œä¸ºå‚æ•°ã€‚è¿™ä¸ª<code>Supplier</code>å¯ä»¥åœ¨éœ€è¦æ—¶åŠ¨æ€åœ°åˆ›å»º<code>UserValidator</code>å®ä¾‹ã€‚åœ¨<code>UserService</code>ç±»ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨<code>userValidatorFactory.get()</code>æ¥è·å–<code>UserValidator</code>å®ä¾‹ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º<code>CustomUserValidator</code>çš„ç±»ï¼Œå®ƒå®ç°äº†<code>UserValidator</code>æ¥å£ï¼Œå¹¶ç”¨äºéªŒè¯ç”¨æˆ·ã€‚æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·ä½¿ç”¨<code>UserService</code>ç±»å’Œ<code>Supplier&lt;T&gt;</code>æ¥åˆ›å»º<code>UserService</code>å®ä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Supplier</span><span class="o">&lt;</span><span class="n">UserValidator</span><span class="o">&gt;</span> <span class="n">userValidatorFactory</span> <span class="o">=</span> <span class="n">CustomUserValidator</span><span class="o">::</span><span class="k">new</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="n">UserService</span> <span class="n">userService</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UserService</span><span class="o">(</span><span class="n">userValidatorFactory</span><span class="o">);</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>userValidatorFactory</code>æ˜¯ä¸€ä¸ª<code>Supplier&lt;UserValidator&gt;</code>å®ä¾‹ï¼Œå®ƒä½¿ç”¨<code>CustomUserValidator::new</code>æ„é€ å‡½æ•°å¼•ç”¨æ¥åˆ›å»º<code>UserValidator</code>å®ä¾‹ã€‚é€šè¿‡å°†è¿™ä¸ª<code>Supplier</code>ä¼ é€’ç»™<code>UserService</code>ç±»çš„æ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»º<code>UserService</code>å®ä¾‹ï¼Œè€Œæ— éœ€æ˜¾å¼åœ°åˆ›å»º<code>UserValidator</code>å®ä¾‹ã€‚</p>
<p>ä½¿ç”¨<code>Supplier&lt;T&gt;</code>è¡¨ç¤ºå·¥å‚å¯ä»¥ä½¿æˆ‘ä»¬çš„ä»£ç æ›´åŠ ç®€æ´å’Œçµæ´»ã€‚å®ƒå¯ä»¥ä½¿å¯¹è±¡çš„åˆ›å»ºæ›´åŠ é€šç”¨ï¼Œå¹¶å…è®¸æˆ‘ä»¬åœ¨éœ€è¦æ—¶åŠ¨æ€åœ°åˆ›å»ºå¯¹è±¡ã€‚åŒæ—¶ï¼Œç”±äº<code>Supplier&lt;T&gt;</code>æ˜¯ä¸€ä¸ªå‡½æ•°å¼æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨lambdaè¡¨è¾¾å¼å’Œæ–¹æ³•å¼•ç”¨æ¥åˆ›å»ºå·¥å‚ï¼Œä½¿ä»£ç æ›´åŠ ç®€æ´å’Œæ˜“äºç†è§£ã€‚</p>
<h2 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h2>
<p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ä¾èµ–æ³¨å…¥æ¯”ç¡¬ç¼–ç èµ„æºçš„ä¼˜ç‚¹ï¼š</p>
<ol>
<li>å¯æµ‹è¯•æ€§ï¼šä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼Œå¾ˆå®¹æ˜“åˆ›å»ºå’Œæ³¨å…¥æ¨¡æ‹Ÿå¯¹è±¡è¿›è¡Œæµ‹è¯•ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ­£åœ¨æµ‹è¯•çš„ç»„ä»¶éš”ç¦»å¼€æ¥ï¼Œå¹¶ä¸“æ³¨äºæµ‹è¯•å…¶è¡Œä¸ºï¼Œè€Œä¸å¿…æ‹…å¿ƒå…¶ä¾èµ–é¡¹çš„è¡Œä¸ºã€‚</li>
<li>çµæ´»æ€§ï¼šä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°ç”¨ä¸åŒå®ç°æ›¿æ¢ä¾èµ–é¡¹ã€‚è¿™åœ¨éœ€è¦æ›´æ”¹ç»„ä»¶çš„è¡Œä¸ºè€Œä¸æ›´æ”¹å…¶ä»£ç æ—¶éå¸¸æœ‰ç”¨ã€‚</li>
<li>è§£è€¦ï¼šä¾èµ–æ³¨å…¥æœ‰åŠ©äºå°†ç»„ä»¶ä¸å…¶ä¾èµ–é¡¹è§£è€¦ï¼Œä½¿ä»£ç æ›´åŠ æ¨¡å—åŒ–å¹¶æ˜“äºç»´æŠ¤ã€‚</li>
<li>å…³æ³¨ç‚¹åˆ†ç¦»ï¼šä¾èµ–æ³¨å…¥å°†ä¾èµ–é¡¹çš„åˆ›å»ºå’Œç®¡ç†ä¸ç»„ä»¶æœ¬èº«åˆ†ç¦»ï¼Œå…è®¸æ›´æ¸…æ™°åœ°åˆ†ç¦»å…³æ³¨ç‚¹ã€‚</li>
</ol>
<h2 id="è¿ç”¨">è¿ç”¨</h2>
<p>ä¾èµ–æ³¨å…¥æ˜¯ä¸€ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œè¢«å¹¿æ³›åº”ç”¨äºè®¸å¤šå¼€æºæ¡†æ¶ä¸­ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„å¼€æºæ¡†æ¶å’Œåº“ï¼Œå®ƒä»¬ä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç†å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼š</p>
<ol>
<li>Spring Frameworkï¼šSpringæ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„Javaæ¡†æ¶ï¼Œå®ƒä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç†åº”ç”¨ç¨‹åºä¸­çš„å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚Springé€šè¿‡<code>@Autowired</code>æ³¨è§£å’ŒXMLé…ç½®æ–‡ä»¶æ¥å®ç°ä¾èµ–æ³¨å…¥ã€‚</li>
<li>Google Guiceï¼šGuiceæ˜¯ä¸€ä¸ªè½»é‡çº§çš„ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œå®ƒä½¿ç”¨Javaæ³¨è§£æ¥å®ç°ä¾èµ–æ³¨å…¥ã€‚Guiceæä¾›äº†ä¸€ä¸ª<code>Binder</code>æ¥å£ï¼Œä½¿ç”¨æˆ·å¯ä»¥é…ç½®æ³¨å…¥è§„åˆ™ã€‚</li>
<li>Daggerï¼šDaggeræ˜¯ä¸€ä¸ªåŸºäºJavaå’ŒAndroidå¹³å°çš„ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œå®ƒä½¿ç”¨Javaæ³¨è§£å’Œä»£ç ç”ŸæˆæŠ€æœ¯æ¥å®ç°ä¾èµ–æ³¨å…¥ã€‚Daggeræä¾›äº†ä¸€ä¸ª<code>Component</code>æ¥å£ï¼Œç”¨äºè¡¨ç¤ºåº”ç”¨ç¨‹åºå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</li>
<li>CDIï¼šCDIæ˜¯Java EE 6ä¸­å¼•å…¥çš„ä¸€ç§ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œå®ƒä½¿ç”¨Javaæ³¨è§£å’ŒXMLé…ç½®æ–‡ä»¶æ¥å®ç°ä¾èµ–æ³¨å…¥ã€‚CDIæä¾›äº†ä¸€ä¸ª<code>BeanManager</code>æ¥å£ï¼Œä½¿ç”¨æˆ·å¯ä»¥é…ç½®å’Œç®¡ç†åº”ç”¨ç¨‹åºå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</li>
<li>Micronautï¼šMicronautæ˜¯ä¸€ä¸ªè½»é‡çº§çš„ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œå®ƒä½¿ç”¨Javaæ³¨è§£å’Œå­—èŠ‚ç ç”ŸæˆæŠ€æœ¯æ¥å®ç°ä¾èµ–æ³¨å…¥ã€‚Micronautæä¾›äº†ä¸€ä¸ª<code>@Inject</code>æ³¨è§£ï¼Œç”¨äºæ ‡è®°éœ€è¦æ³¨å…¥çš„ä¾èµ–é¡¹ã€‚</li>
<li>Weldï¼šWeldæ˜¯ä¸€ä¸ªJava SEå’ŒJava EEçš„ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œå®ƒä½¿ç”¨Javaæ³¨è§£å’ŒXMLé…ç½®æ–‡ä»¶æ¥å®ç°ä¾èµ–æ³¨å…¥ã€‚Weldæä¾›äº†ä¸€ä¸ª<code>BeanManager</code>æ¥å£ï¼Œç”¨äºé…ç½®å’Œç®¡ç†åº”ç”¨ç¨‹åºå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</li>
<li>PicoContainerï¼šPicoContaineræ˜¯ä¸€ä¸ªè½»é‡çº§çš„ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œå®ƒä½¿ç”¨Javaæ³¨è§£å’Œä»£ç ç”ŸæˆæŠ€æœ¯æ¥å®ç°ä¾èµ–æ³¨å…¥ã€‚PicoContaineræä¾›äº†ä¸€ä¸ª<code>Container</code>æ¥å£ï¼Œç”¨äºè¡¨ç¤ºåº”ç”¨ç¨‹åºå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</li>
<li>HK2ï¼šHK2æ˜¯Java EE 8å’ŒJakarta EE 9çš„ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œå®ƒä½¿ç”¨Javaæ³¨è§£å’ŒXMLé…ç½®æ–‡ä»¶æ¥å®ç°ä¾èµ–æ³¨å…¥ã€‚HK2æä¾›äº†ä¸€ä¸ª<code>ServiceLocator</code>æ¥å£ï¼Œç”¨äºé…ç½®å’Œç®¡ç†åº”ç”¨ç¨‹åºå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</li>
<li>Micrometerï¼šMicrometeræ˜¯ä¸€ä¸ªç”¨äºåº¦é‡åº”ç”¨ç¨‹åºæ€§èƒ½çš„åº“ï¼Œå®ƒä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç†åº¦é‡è®°å½•å™¨ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚Micrometeræ”¯æŒå¤šç§ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼ŒåŒ…æ‹¬Springå’ŒGuiceã€‚</li>
<li>Google Dagger Hiltï¼šDagger Hiltæ˜¯ä¸€ä¸ªåŸºäºDagger 2çš„ä¾èµ–æ³¨å…¥åº“ï¼Œå®ƒä½¿ç”¨æ³¨è§£æ¥ç®¡ç†å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å®ƒæä¾›äº†ä¸€äº›é™„åŠ åŠŸèƒ½ï¼Œä¾‹å¦‚ä½¿ç”¨<code>@ViewModelInject</code>æ³¨è§£æ¥æ³¨å…¥ViewModelä¾èµ–é¡¹ã€‚</li>
<li>Quarkusï¼šQuarkusæ˜¯ä¸€ä¸ªç”¨äºæ„å»ºå¯æ‰©å±•çš„Javaåº”ç”¨ç¨‹åºçš„æ¡†æ¶ï¼Œå®ƒä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç†åº”ç”¨ç¨‹åºå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å®ƒæ”¯æŒå¤šç§ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼ŒåŒ…æ‹¬CDIã€Springå’ŒGuiceã€‚</li>
<li>Micronaut Dataï¼šMicronaut Dataæ˜¯ä¸€ä¸ªç”¨äºç®¡ç†æ•°æ®åº“è®¿é—®çš„åº“ï¼Œå®ƒä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç†æ•°æ®è®¿é—®å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å®ƒæ”¯æŒå¤šç§ORMæ¡†æ¶ï¼ŒåŒ…æ‹¬Hibernateå’ŒJDBCã€‚</li>
<li>Akkaï¼šAkkaæ˜¯ä¸€ä¸ªç”¨äºæ„å»ºäº‹ä»¶é©±åŠ¨åº”ç”¨ç¨‹åºçš„åº“ï¼Œå®ƒä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç†Actorä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å®ƒæä¾›äº†ä¸€ä¸ª<code>@Inject</code>æ³¨è§£ï¼Œç”¨äºæ ‡è®°éœ€è¦æ³¨å…¥çš„ä¾èµ–é¡¹ã€‚</li>
<li>JHipsterï¼šJHipsteræ˜¯ä¸€ä¸ªç”¨äºç”Ÿæˆç°ä»£Webåº”ç”¨ç¨‹åºçš„æ¡†æ¶ï¼Œå®ƒä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç†åº”ç”¨ç¨‹åºå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å®ƒæ”¯æŒå¤šç§ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼ŒåŒ…æ‹¬Springå’ŒGuiceã€‚</li>
<li>Vert.xï¼šVert.xæ˜¯ä¸€ä¸ªåŸºäºäº‹ä»¶é©±åŠ¨çš„åº”ç”¨ç¨‹åºæ¡†æ¶ï¼Œå®ƒä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç†åº”ç”¨ç¨‹åºå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å®ƒæ”¯æŒå¤šç§ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼ŒåŒ…æ‹¬CDIå’ŒGuiceã€‚</li>
<li>Quarkus Reactiveï¼šQuarkus Reactiveæ˜¯ä¸€ä¸ªç”¨äºæ„å»ºååº”å¼åº”ç”¨ç¨‹åºçš„æ¡†æ¶ï¼Œå®ƒä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç†åº”ç”¨ç¨‹åºå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å®ƒæ”¯æŒå¤šç§ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼ŒåŒ…æ‹¬CDIå’ŒSpringã€‚</li>
<li>Micronaut Securityï¼šMicronaut Securityæ˜¯ä¸€ä¸ªç”¨äºç®¡ç†Webåº”ç”¨ç¨‹åºå®‰å…¨çš„åº“ï¼Œå®ƒä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç†å®‰å…¨æœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å®ƒæ”¯æŒå¤šç§å®‰å…¨æ¡†æ¶ï¼ŒåŒ…æ‹¬Spring Securityå’ŒApache Shiroã€‚</li>
<li>Eclipse MicroProfileï¼šEclipse MicroProfileæ˜¯ä¸€ä¸ªç”¨äºæ„å»ºå¾®æœåŠ¡çš„æ¡†æ¶ï¼Œå®ƒä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç†å¾®æœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å®ƒæ”¯æŒå¤šç§ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼ŒåŒ…æ‹¬CDIå’ŒGuiceã€‚</li>
<li>Kotlin Koinï¼šKoinæ˜¯ä¸€ä¸ªç”¨äºKotlinåº”ç”¨ç¨‹åºçš„ä¾èµ–æ³¨å…¥åº“ï¼Œå®ƒä½¿ç”¨DSLè¯­æ³•æ¥ç®¡ç†åº”ç”¨ç¨‹åºå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å®ƒæ”¯æŒå•ä¾‹ã€å·¥å‚å’Œæ‡’åŠ è½½ç­‰ä¸åŒçš„æ³¨å…¥æ¨¡å¼ã€‚</li>
<li>Spring Cloudï¼šSpring Cloudæ˜¯ä¸€ä¸ªç”¨äºæ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„æ¡†æ¶ï¼Œå®ƒä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç†åˆ†å¸ƒå¼ç³»ç»Ÿä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å®ƒæ”¯æŒå¤šç§ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼ŒåŒ…æ‹¬Springå’ŒGuiceã€‚</li>
<li>Micronaut HTTP Clientï¼šMicronaut HTTP Clientæ˜¯ä¸€ä¸ªç”¨äºç®¡ç†HTTPå®¢æˆ·ç«¯çš„åº“ï¼Œå®ƒä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç†HTTPå®¢æˆ·ç«¯ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å®ƒæ”¯æŒå¤šç§HTTPå®¢æˆ·ç«¯å®ç°ï¼ŒåŒ…æ‹¬Apache HttpClientå’ŒNettyã€‚</li>
<li>Quarkus Securityï¼šQuarkus Securityæ˜¯ä¸€ä¸ªç”¨äºç®¡ç†Webåº”ç”¨ç¨‹åºå®‰å…¨çš„åº“ï¼Œå®ƒä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç†å®‰å…¨æœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å®ƒæ”¯æŒå¤šç§å®‰å…¨æ¡†æ¶ï¼ŒåŒ…æ‹¬Spring Securityå’ŒApache Shiroã€‚</li>
</ol>
<p>è¿™äº›æ¡†æ¶å’Œåº“éƒ½ä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç†å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œä½¿ä»£ç æ›´åŠ çµæ´»ã€å¯ç»´æŠ¤å’Œå¯æµ‹è¯•ã€‚å®ƒä»¬æä¾›äº†ä¸€äº›ä¸åŒçš„æ³¨å…¥æŠ€æœ¯å’ŒAPIï¼Œä»¥é€‚åº”ä¸åŒçš„åº”ç”¨åœºæ™¯å’Œéœ€æ±‚ã€‚</p>
<h3 id="springä¾èµ–æ³¨å…¥">Springä¾èµ–æ³¨å…¥</h3>
<p>åœ¨Springæ¡†æ¶ä¸­ï¼Œä¾èµ–æ³¨å…¥æ˜¯æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€ã€‚Springä½¿ç”¨ä¾èµ–æ³¨å…¥æ¥ç®¡ç†åº”ç”¨ç¨‹åºå¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œä»¥å®ç°æ¾è€¦åˆã€å¯æµ‹è¯•å’Œå¯æ‰©å±•çš„ä»£ç ã€‚ä»¥ä¸‹æ˜¯Springä¸­ä½¿ç”¨ä¾èµ–æ³¨å…¥çš„æ–¹æ³•ï¼š</p>
<ol>
<li>æ³¨è§£ï¼šSpringä½¿ç”¨æ³¨è§£å°†ä¾èµ–é¡¹æ³¨å…¥åˆ°å¯¹è±¡ä¸­ã€‚å¸¸ç”¨çš„æ³¨è§£åŒ…æ‹¬<code>@Autowired</code>ã€<code>@Qualifier</code>å’Œ<code>@Value</code>ã€‚å…¶ä¸­ï¼Œ<code>@Autowired</code>æ³¨è§£ç”¨äºè‡ªåŠ¨è£…é…ä¾èµ–é¡¹ï¼Œ<code>@Qualifier</code>æ³¨è§£ç”¨äºæŒ‡å®šä¾èµ–é¡¹çš„åç§°æˆ–é™å®šç¬¦ï¼Œ<code>@Value</code>æ³¨è§£ç”¨äºä»å±æ€§æ–‡ä»¶æˆ–ç¯å¢ƒå˜é‡ä¸­æ³¨å…¥å€¼ã€‚</li>
<li>XMLé…ç½®æ–‡ä»¶ï¼šSpringä¹Ÿæ”¯æŒä½¿ç”¨XMLé…ç½®æ–‡ä»¶æ¥å®šä¹‰å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚åœ¨XMLé…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>&lt;bean&gt;</code>å…ƒç´ å®šä¹‰å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨<code>&lt;property&gt;</code>å…ƒç´ è®¾ç½®å¯¹è±¡çš„å±æ€§å’Œä¾èµ–é¡¹ã€‚</li>
<li>Javaé…ç½®ç±»ï¼šSpringè¿˜æ”¯æŒä½¿ç”¨Javaé…ç½®ç±»æ¥å®šä¹‰å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚åœ¨Javaé…ç½®ç±»ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>@Configuration</code>æ³¨è§£å®šä¹‰é…ç½®ç±»ï¼Œå¹¶ä½¿ç”¨<code>@Bean</code>æ³¨è§£å®šä¹‰å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨<code>@Autowired</code>æ³¨è§£æ³¨å…¥ä¾èµ–é¡¹ã€‚</li>
</ol>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›åœ¨Springä¸­ä½¿ç”¨ä¾èµ–æ³¨å…¥çš„ä¾‹å­ï¼š</p>
<p><strong>1ã€è‡ªåŠ¨è£…é…ç¤ºä¾‹ï¼š</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Component</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyService</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">   <span class="kd">private</span> <span class="kd">final</span> <span class="n">MyRepository</span> <span class="n">myRepository</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="nd">@Autowired</span>
</span></span><span class="line"><span class="cl">   <span class="kd">public</span> <span class="nf">MyService</span><span class="o">(</span><span class="n">MyRepository</span> <span class="n">myRepository</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">       <span class="k">this</span><span class="o">.</span><span class="na">myRepository</span> <span class="o">=</span> <span class="n">myRepository</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">   <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>MyService</code>ç±»é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥äº†<code>MyRepository</code>ä¾èµ–ã€‚åœ¨<code>MyService</code>å¯¹è±¡åˆ›å»ºæ—¶ï¼ŒSpringæ¡†æ¶è‡ªåŠ¨è£…é…å¹¶æ³¨å…¥äº†<code>MyRepository</code>å¯¹è±¡ã€‚</p>
<p><strong>2ã€XMLé…ç½®ç¤ºä¾‹ï¼š</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;myService&#34;</span> <span class="na">class=</span><span class="s">&#34;com.example.MyService&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&lt;constructor-arg</span> <span class="na">ref=</span><span class="s">&#34;myRepository&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/bean&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;myRepository&#34;</span> <span class="na">class=</span><span class="s">&#34;com.example.MyRepository&#34;</span><span class="nt">/&gt;</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>MyService</code>ç±»å’Œ<code>MyRepository</code>ç±»è¢«å®šä¹‰ä¸ºSpringçš„beanï¼Œå¹¶åœ¨XMLé…ç½®æ–‡ä»¶ä¸­æŒ‡å®šå®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚åœ¨<code>MyService</code>å¯¹è±¡åˆ›å»ºæ—¶ï¼ŒSpringæ¡†æ¶è‡ªåŠ¨åˆ›å»ºå¹¶æ³¨å…¥äº†<code>MyRepository</code>å¯¹è±¡ã€‚</p>
<p><strong>3ã€Javaé…ç½®ç¤ºä¾‹ï¼š</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppConfig</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">   <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">   <span class="kd">public</span> <span class="n">MyService</span> <span class="nf">myService</span><span class="o">(</span><span class="n">MyRepository</span> <span class="n">myRepository</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">       <span class="k">return</span> <span class="k">new</span> <span class="n">MyService</span><span class="o">(</span><span class="n">myRepository</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">   <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">   <span class="kd">public</span> <span class="n">MyRepository</span> <span class="nf">myRepository</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">       <span class="k">return</span> <span class="k">new</span> <span class="n">MyRepository</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">   <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>AppConfig</code>ç±»é€šè¿‡<code>@Bean</code>æ³¨è§£å®šä¹‰äº†<code>MyService</code>å¯¹è±¡å’Œ<code>MyRepository</code>å¯¹è±¡ï¼Œå¹¶é€šè¿‡æ–¹æ³•å‚æ•°çš„æ–¹å¼æ³¨å…¥äº†<code>MyRepository</code>ä¾èµ–ã€‚åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼ŒSpringæ¡†æ¶ä¼šè‡ªåŠ¨åˆ›å»ºå¹¶æ³¨å…¥è¿™äº›å¯¹è±¡ã€‚</p>
<h4 id="springä¾èµ–æ³¨å…¥æ„äº‹é¡¹">Springä¾èµ–æ³¨å…¥æ„äº‹é¡¹</h4>
<p>åœ¨ä½¿ç”¨Springä¸­çš„ä¾èµ–æ³¨å…¥æ—¶ï¼Œæœ‰ä¸€äº›æ³¨æ„äº‹é¡¹éœ€è¦æ³¨æ„ï¼Œä»¥ç¡®ä¿ä»£ç çš„æ­£ç¡®æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
<ol>
<li>ä¾èµ–é¡¹æ³¨å…¥çš„é¡ºåºï¼šå¦‚æœä¸€ä¸ªç±»ä¾èµ–äºå¤šä¸ªå…¶ä»–ç±»ï¼Œé‚£ä¹ˆè¿™äº›ä¾èµ–é¡¹çš„æ³¨å…¥é¡ºåºå¯èƒ½ä¼šå½±å“åˆ°ä»£ç çš„æ­£ç¡®æ€§ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨<code>@DependsOn</code>æ³¨è§£æŒ‡å®šä¾èµ–é¡¹ä¹‹é—´çš„é¡ºåºã€‚</li>
<li>å¾ªç¯ä¾èµ–ï¼šå¦‚æœä¸¤ä¸ªæˆ–å¤šä¸ªç±»ä¹‹é—´å‡ºç°å¾ªç¯ä¾èµ–ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´å¯¹è±¡æ— æ³•æ­£ç¡®åˆ›å»ºã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…¥æˆ–setteræ³¨å…¥æ¥è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ã€‚</li>
<li>ä½œç”¨åŸŸï¼šSpringæä¾›äº†å¤šç§ä½œç”¨åŸŸï¼ŒåŒ…æ‹¬å•ä¾‹ã€åŸå‹å’Œè¯·æ±‚ä½œç”¨åŸŸç­‰ã€‚åœ¨ä½¿ç”¨ä¾èµ–æ³¨å…¥æ—¶ï¼Œéœ€è¦äº†è§£æ¯ç§ä½œç”¨åŸŸçš„åŒºåˆ«å’Œé€‚ç”¨åœºæ™¯ï¼Œå¹¶é€‰æ‹©åˆé€‚çš„ä½œç”¨åŸŸã€‚</li>
<li>é…ç½®æ–‡ä»¶ç®¡ç†ï¼šåœ¨ä½¿ç”¨XMLé…ç½®æ–‡ä»¶æˆ–Javaé…ç½®ç±»æ—¶ï¼Œéœ€è¦æ³¨æ„é…ç½®æ–‡ä»¶æˆ–ç±»çš„ç®¡ç†å’Œç»´æŠ¤ã€‚å¯ä»¥ä½¿ç”¨Springçš„ProfileåŠŸèƒ½æ¥ç®¡ç†ä¸åŒçš„é…ç½®æ–‡ä»¶æˆ–ç±»ï¼Œå¹¶æ ¹æ®ä¸åŒçš„ç¯å¢ƒæˆ–éœ€æ±‚æ¥é€‰æ‹©åˆé€‚çš„é…ç½®ã€‚</li>
<li>ä¾èµ–æ³¨å…¥ç±»å‹é€‰æ‹©ï¼šSpringæ”¯æŒå¤šç§ä¾èµ–æ³¨å…¥ç±»å‹ï¼ŒåŒ…æ‹¬æ„é€ å‡½æ•°æ³¨å…¥ã€setteræ³¨å…¥å’Œå­—æ®µæ³¨å…¥ç­‰ã€‚éœ€è¦æ ¹æ®æƒ…å†µé€‰æ‹©åˆé€‚çš„ä¾èµ–æ³¨å…¥ç±»å‹ï¼Œå¹¶è€ƒè™‘åˆ°ä»£ç çš„å¯æµ‹è¯•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</li>
</ol>
<h4 id="å¦‚ä½•é¿å…å¾ªç¯ä¾èµ–é—®é¢˜">å¦‚ä½•é¿å…å¾ªç¯ä¾èµ–é—®é¢˜</h4>
<p>å¾ªç¯ä¾èµ–æ˜¯æŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªç±»ä¹‹é—´ç›¸äº’ä¾èµ–è€Œå¯¼è‡´æ— æ³•æ­£ç¡®åˆ›å»ºå¯¹è±¡çš„æƒ…å†µã€‚åœ¨Springä¸­ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼æ¥é¿å…å¾ªç¯ä¾èµ–é—®é¢˜ï¼š</p>
<ol>
<li>ä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…¥ï¼šæ„é€ å‡½æ•°æ³¨å…¥æ˜¯æŒ‡ä¾èµ–é¡¹é€šè¿‡æ„é€ å‡½æ•°çš„æ–¹å¼è¿›è¡Œæ³¨å…¥ã€‚è¿™ç§æ–¹å¼å¯ä»¥é¿å…å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œå› ä¸ºå¯¹è±¡çš„åˆ›å»ºé¡ºåºæ˜¯ç¡®å®šçš„ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½å¿…é¡»å…ˆåˆ›å»ºå…¶ä¾èµ–é¡¹ï¼Œç„¶åæ‰èƒ½åˆ›å»ºè‡ªèº«ã€‚</li>
<li>ä½¿ç”¨setteræ³¨å…¥ï¼šsetteræ³¨å…¥æ˜¯æŒ‡ä¾èµ–é¡¹é€šè¿‡setteræ–¹æ³•è¿›è¡Œæ³¨å…¥ã€‚è¿™ç§æ–¹å¼å¯ä»¥é¿å…å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œå› ä¸ºå¯¹è±¡çš„åˆ›å»ºé¡ºåºæ˜¯ä¸ç¡®å®šçš„ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥å…ˆåˆ›å»ºè‡ªèº«ï¼Œç„¶åå†é€šè¿‡setteræ–¹æ³•æ³¨å…¥å…¶ä¾èµ–é¡¹ã€‚</li>
<li>ä½¿ç”¨<code>@Lazy</code>æ³¨è§£ï¼š<code>@Lazy</code>æ³¨è§£å¯ä»¥å»¶è¿Ÿä¾èµ–é¡¹çš„æ³¨å…¥ï¼Œç›´åˆ°å¯¹è±¡ç¬¬ä¸€æ¬¡ä½¿ç”¨è¯¥ä¾èµ–é¡¹æ—¶æ‰è¿›è¡Œæ³¨å…¥ã€‚è¿™ç§æ–¹å¼å¯ä»¥é¿å…å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œå› ä¸ºå¯¹è±¡çš„åˆ›å»ºé¡ºåºæ˜¯ä¸ç¡®å®šçš„ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥å…ˆåˆ›å»ºè‡ªèº«ï¼Œç„¶åå†ç­‰å¾…å…¶ä¾èµ–é¡¹è¢«æ³¨å…¥ã€‚</li>
<li>ä¼˜åŒ–ä¾èµ–å…³ç³»ï¼šå¦‚æœå‡ºç°å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ä¼˜åŒ–ä¾èµ–å…³ç³»æ¥è§£å†³ã€‚ä¾‹å¦‚ï¼Œå°†ä¾èµ–é¡¹æŠ½è±¡æˆæ¥å£æˆ–æŠ½è±¡ç±»ï¼Œç„¶åé€šè¿‡ä¸åŒçš„å®ç°ç±»æ¥è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ã€‚</li>
</ol>
<h4 id="springå¤šç§ä¾èµ–æ³¨å…¥ç±»çš„ä¼˜ç¼ºç‚¹">Springå¤šç§ä¾èµ–æ³¨å…¥ç±»çš„ä¼˜ç¼ºç‚¹</h4>
<p>Springæ”¯æŒå¤šç§ä¾èµ–æ³¨å…¥ç±»å‹ï¼ŒåŒ…æ‹¬æ„é€ å‡½æ•°æ³¨å…¥ã€setteræ³¨å…¥å’Œå­—æ®µæ³¨å…¥ç­‰ã€‚å„ç§ä¾èµ–æ³¨å…¥ç±»å‹çš„ä¼˜ç¼ºç‚¹å¦‚ä¸‹ï¼š</p>
<p><strong>1ã€æ„é€ å‡½æ•°æ³¨å…¥</strong></p>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>å¯¹è±¡åˆ›å»ºæ—¶ä¾èµ–é¡¹å·²ç»ç¡®å®šï¼Œå¯ä»¥ä¿è¯ä¾èµ–é¡¹çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§ã€‚</li>
<li>ä¾èµ–é¡¹æ˜¯åªè¯»çš„ï¼Œå¯ä»¥ä¿è¯å¯¹è±¡çš„ä¸å˜æ€§ã€‚</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>æ„é€ å‡½æ•°æ³¨å…¥æ¯”è¾ƒç¹çï¼Œéœ€è¦åœ¨æ¯ä¸ªç±»ä¸­æ·»åŠ æ„é€ å‡½æ•°å’Œä¾èµ–é¡¹å‚æ•°ã€‚</li>
</ul>
<p><strong>2ã€setteræ³¨å…¥</strong></p>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>setteræ³¨å…¥æ¯”è¾ƒçµæ´»ï¼Œå¯ä»¥éšæ—¶æ³¨å…¥æˆ–æ›´æ”¹ä¾èµ–é¡¹ã€‚</li>
<li>å¯ä»¥ä½¿ç”¨é»˜è®¤æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡ï¼Œç®€åŒ–ä»£ç ã€‚</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>å¯¹è±¡åˆ›å»ºæ—¶ä¾èµ–é¡¹å¯èƒ½è¿˜æœªæ³¨å…¥ï¼Œéœ€è¦è¿›è¡Œnullæ£€æŸ¥ã€‚</li>
<li>setteræ–¹æ³•æ˜¯å…¬å…±çš„ï¼Œå¯èƒ½ä¼šå½±å“å¯¹è±¡çš„ä¸å˜æ€§ã€‚</li>
</ul>
<p><strong>3ã€å­—æ®µæ³¨å…¥</strong></p>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>ç®€å•æ–¹ä¾¿ï¼Œä¸éœ€è¦æ‰‹åŠ¨ç¼–å†™æ„é€ å‡½æ•°æˆ–setteræ–¹æ³•ã€‚</li>
<li>å¯ä»¥ä½¿ç”¨é»˜è®¤æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡ï¼Œç®€åŒ–ä»£ç ã€‚</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>ä¾èµ–é¡¹æ˜¯å…¬å…±çš„ï¼Œå¯èƒ½ä¼šå½±å“å¯¹è±¡çš„ä¸å˜æ€§ã€‚</li>
<li>å¯¹è±¡åˆ›å»ºæ—¶ä¾èµ–é¡¹å¯èƒ½è¿˜æœªæ³¨å…¥ï¼Œéœ€è¦è¿›è¡Œnullæ£€æŸ¥ã€‚</li>
</ul>
<p>æ€»çš„æ¥è¯´ï¼Œ**æ„é€ å‡½æ•°æ³¨å…¥æ˜¯æœ€æ¨èçš„ä¾èµ–æ³¨å…¥æ–¹å¼ï¼Œå› ä¸ºå®ƒå¯ä»¥ä¿è¯å¯¹è±¡çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§ã€‚**setteræ³¨å…¥å’Œå­—æ®µæ³¨å…¥åˆ™æ¯”è¾ƒçµæ´»ï¼Œä½†éœ€è¦æ³¨æ„ä¾èµ–é¡¹çš„æ³¨å…¥æ—¶æœºå’Œå¯èƒ½å¯¹å¯¹è±¡ä¸å˜æ€§çš„å½±å“ã€‚æ ¹æ®å…·ä½“çš„æƒ…å†µå’Œéœ€æ±‚ï¼Œå¯ä»¥é€‰æ‹©åˆé€‚çš„ä¾èµ–æ³¨å…¥æ–¹å¼ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>æ€»ä¹‹ï¼Œä¸è¦ä½¿ç”¨å•ä¾‹æˆ–é™æ€å®ç”¨å·¥å…·ç±»æ¥å®ç°ä¾èµ–äºä¸€ä¸ªæˆ–å¤šä¸ªåº•å±‚èµ„æºçš„ç±»ï¼Œè¿™äº›èµ„æºçš„è¡Œä¸ºä¼šå½±å“ç±»çš„è¡Œä¸ºï¼Œä¹Ÿä¸è¦è®©ç±»ç›´æ¥åˆ›å»ºè¿™äº›èµ„æºã€‚ç›¸åï¼Œå°†åˆ›å»ºå®ƒä»¬çš„èµ„æºæˆ–å·¥å‚ä¼ é€’ç»™æ„é€ å‡½æ•°ï¼ˆæˆ–é™æ€å·¥å‚æˆ–æ„å»ºå™¨ï¼‰ã€‚è¿™ç§æ“ä½œç§°ä¸ºä¾èµ–æ³¨å…¥ï¼Œå®ƒå°†å¤§å¤§å¢å¼ºç±»çš„çµæ´»æ€§ã€å¯å¤ç”¨æ€§å’Œå¯æµ‹è¯•æ€§ã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>å‘¨æŠ¥-14ï½œå¦‚ä½•å­¦ä¹ ä¸€é—¨ç¼–ç¨‹è¯­è¨€</title>
      <link>https://blog.chensoul.com/posts/2023/04/13/weekly_review_14/</link>
      <pubDate>Thu, 13 Apr 2023 09:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/04/13/weekly_review_14/</guid>
      <description>å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-04-03 åˆ° 2023-04-09 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚ è¿™å‘¨è¿˜æ˜¯å’Œä»¥å‰ä¸€æ ·æ¯å¤©è¿åŠ¨ï¼Œå¹¶å¼€å§‹æ–½è¡Œæ–­é£Ÿã€‚å› ä¸º</description>
      <content:encoded><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekl-review-14-01.jpg" alt="weekl-review-14-01"  />
</p>
<p>æœ¬ç¯‡æ˜¯å¯¹ <code>2023-04-03</code> åˆ° <code>2023-04-09</code> è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº <a href="https://blog.chensoul.com/">åšå®¢</a>ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚</p>
<p>è¿™å‘¨è¿˜æ˜¯å’Œä»¥å‰ä¸€æ ·æ¯å¤©è¿åŠ¨ï¼Œå¹¶å¼€å§‹æ–½è¡Œæ–­é£Ÿã€‚å› ä¸ºæ˜¯åˆšå¼€å§‹æ–­é£Ÿï¼Œæœ‰æ—¶å€™å¿ä¸ä½é¥¥é¥¿æ„Ÿè€Œåƒäº†ä¸€äº›ä¸œè¥¿ã€‚</p>
<p>æœ¬å‘¨å·¥ä½œä¸»è¦æ˜¯å‘å¸ƒäº†ä¸€ä¸ªç‰ˆæœ¬ï¼Œå…¶ä½™æ—¶é—´ç”¨æ¥å­¦ä¹  Rust å’Œ Pythonï¼Œåˆå­¦è¿™ä¸¤ç§è¯­è¨€ï¼Œä»–ä»¬è¯­æ³•ä¸Šæœ‰å¾ˆå¤šç›¸ä¼¼ä¹‹å¤„ã€‚å¦‚ä½•å­¦ä¹ ä¸€é—¨ç¼–ç¨‹è¯­è¨€ï¼Ÿæ•´ç†äº†ä¸€äº›æ­¥éª¤ã€‚å°è¯•äº†ä¸€ä¸‹ç”¨å¤šç§è¯­è¨€ç¼–å†™çŒœæ•°æ¸¸æˆï¼Œè¿™äº›è¯­è¨€åŒ…æ‹¬ Rustã€Ptyhonã€Goã€NodeJsã€JavaScriptã€Kotlinã€Bashï¼Œé™¤äº† Javaã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„äº‹æƒ…ï¼Œå¦‚æœèƒ½å¤ŸæŠŠè¿™äº›è¯­è¨€éƒ½ç†Ÿç»ƒæŒæ¡ï¼Œé‚£å°±æ›´å¥½äº†ã€‚</p>
<h2 id="å…³äºå¥èº«">å…³äºå¥èº«</h2>
<p>å®Œæˆäº†æ¯å¤©ä¸€ä¸‡æ­¥çš„è®¡åˆ’ï¼Œå¹¶ä¸”å…±è·‘æ­¥ 5 æ¬¡ï¼Œä¸€å…± 18.6 å…¬é‡Œï¼Œå¹³å‡é…é€Ÿ 7 åˆ†é’Ÿ4 9 ç§’ï¼Œæ¯å¤©è·³ç»³ 500+ã€‚</p>
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekl-review-14-03.jpg" alt="weekl-review-14-03" style="width:67%;" />
<h2 id="å…³äºè®°è´¦">å…³äºè®°è´¦</h2>
<p>æœ¬å‘¨ç»§ç»­ä½¿ç”¨å¾®ä¿¡è®°è´¦æœ¬è®°å½•æ¯å¤©æ”¯å‡ºã€‚ç´¯è®¡æ¶ˆè´¹835å…ƒï¼Œæ˜ç»†å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>4æœˆ3æ—¥ï¼Œå‘¨ä¸€ï¼šæ”¯å‡º 59 å…ƒï¼Œé¤é¥®</p>
</li>
<li>
<p>4æœˆ4æ—¥ï¼Œå‘¨äºŒï¼šæ”¯å‡º 0 å…ƒï¼Œ</p>
</li>
<li>
<p>4æœˆ5æ—¥ï¼Œå‘¨ä¸‰ï¼šæ”¯å‡º 228 å…ƒï¼Œè¶…å¸‚è´­ç‰©</p>
</li>
<li>
<p>4æœˆ6æ—¥ï¼Œå‘¨å››ï¼šæ”¯å‡º 15 å…ƒï¼Œåœè½¦è´¹</p>
</li>
<li>
<p>4æœˆ7æ—¥ï¼Œå‘¨äº”ï¼šæ”¯å‡º 12 å…ƒ</p>
</li>
<li>
<p>4æœˆ8æ—¥ï¼Œå‘¨å…­ï¼šæ”¯å‡º 415 å…ƒï¼ŒåŠ æ²¹+é¤é¥®</p>
</li>
<li>
<p>4æœˆ8æ—¥ï¼Œå‘¨æ—¥ï¼šæ”¯å‡º 106 å…ƒï¼Œé¤é¥®</p>
</li>
</ul>
<h2 id="å¦‚ä½•å­¦ä¹ ä¸€é—¨ç¼–ç¨‹è¯­è¨€">å¦‚ä½•å­¦ä¹ ä¸€é—¨ç¼–ç¨‹è¯­è¨€</h2>
<p>å­¦ä¹ ä¸€é—¨ç¼–ç¨‹è¯­è¨€çš„åŸºç¡€è¯­æ³•å¯¹äºåˆå­¦è€…æ¥è¯´éå¸¸é‡è¦ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›è¯¦ç»†çš„æ­¥éª¤ï¼š</p>
<ol>
<li>äº†è§£ç¼–ç¨‹è¯­è¨€çš„åŸºç¡€æ¦‚å¿µï¼šåœ¨å­¦ä¹ ç¼–ç¨‹è¯­è¨€ä¹‹å‰ï¼Œäº†è§£ç¼–ç¨‹çš„åŸºç¡€æ¦‚å¿µæ˜¯éå¸¸é‡è¦çš„ã€‚ä¾‹å¦‚ï¼Œå˜é‡ã€æ•°æ®ç±»å‹ã€æ¡ä»¶è¯­å¥ã€å¾ªç¯ã€å‡½æ•°ç­‰ç­‰ã€‚</li>
<li>å¯»æ‰¾å­¦ä¹ èµ„æºï¼šå­¦ä¹ ç¼–ç¨‹è¯­è¨€çš„åŸºç¡€è¯­æ³•å¯ä»¥é€šè¿‡å„ç§å­¦ä¹ èµ„æºæ¥å®ç°ï¼Œå¦‚ä¹¦ç±ã€æ•™ç¨‹ã€åœ¨çº¿è§†é¢‘å’Œäº¤äº’å¼å­¦ä¹ å¹³å°ç­‰ã€‚é€‰æ‹©é€‚åˆè‡ªå·±çš„å­¦ä¹ èµ„æºæ˜¯éå¸¸é‡è¦çš„ã€‚</li>
<li>å­¦ä¹ å˜é‡å’Œæ•°æ®ç±»å‹ï¼šåœ¨å­¦ä¹ ç¼–ç¨‹è¯­è¨€ä¹‹å‰ï¼Œå­¦ä¹ å˜é‡å’Œæ•°æ®ç±»å‹æ˜¯å¿…é¡»çš„ã€‚äº†è§£å¦‚ä½•å®šä¹‰å˜é‡ã€èµ‹å€¼å’Œä½¿ç”¨ä¸åŒçš„æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚å­—ç¬¦ä¸²ã€æ•´æ•°ã€æµ®ç‚¹æ•°ã€å¸ƒå°”å€¼ç­‰ç­‰ã€‚</li>
<li>å­¦ä¹ æ¡ä»¶è¯­å¥ï¼šæ¡ä»¶è¯­å¥æ˜¯ç¼–ç¨‹è¯­è¨€ä¸­çš„é‡è¦æ¦‚å¿µä¹‹ä¸€ã€‚ä¾‹å¦‚ï¼Œå­¦ä¹ å¦‚ä½•ä½¿ç”¨ifè¯­å¥å’Œelseè¯­å¥ï¼Œä½¿ç¨‹åºåœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ‰§è¡Œä¸åŒçš„ä»£ç å—ã€‚</li>
<li>å­¦ä¹ å¾ªç¯ï¼šå¾ªç¯æ˜¯ç¼–ç¨‹è¯­è¨€ä¸­çš„å¦ä¸€ä¸ªé‡è¦æ¦‚å¿µã€‚ä¾‹å¦‚ï¼Œå­¦ä¹ å¦‚ä½•ä½¿ç”¨whileå¾ªç¯å’Œforå¾ªç¯ï¼Œä½¿ç¨‹åºåœ¨ç‰¹å®šæ¡ä»¶ä¸‹é‡å¤æ‰§è¡Œä»£ç å—ã€‚</li>
<li>å­¦ä¹ å‡½æ•°ï¼šå‡½æ•°æ˜¯ç¼–ç¨‹è¯­è¨€ä¸­çš„é‡è¦æ¦‚å¿µä¹‹ä¸€ã€‚å­¦ä¹ å¦‚ä½•å®šä¹‰å’Œä½¿ç”¨å‡½æ•°ï¼Œä»¥å°†ä»£ç ç»“æ„åŒ–å¹¶é‡ç”¨ã€‚</li>
<li>ç»ƒä¹ ç¼–å†™ä»£ç ï¼šç»ƒä¹ ç¼–å†™ä»£ç æ˜¯å­¦ä¹ ç¼–ç¨‹è¯­è¨€åŸºç¡€è¯­æ³•çš„é‡è¦æ–¹å¼ã€‚ç¼–å†™å°ç¨‹åºæˆ–é¡¹ç›®ï¼Œä¾‹å¦‚æ‰“å°&quot;Hello World&quot;ã€è®¡ç®—å™¨æˆ–çŒœæ•°å­—æ¸¸æˆç­‰ã€‚</li>
<li>å­¦ä¹ è°ƒè¯•å’Œé”™è¯¯å¤„ç†ï¼šå­¦ä¹ å¦‚ä½•è°ƒè¯•ä»£ç å’Œå¤„ç†å¸¸è§é”™è¯¯ï¼Œä¾‹å¦‚è¯­æ³•é”™è¯¯ã€é€»è¾‘é”™è¯¯å’Œè¿è¡Œæ—¶é”™è¯¯ç­‰ã€‚</li>
</ol>
<p>æ€»ç»“ä¸€ä¸‹ï¼Œå­¦ä¹ ä¸€é—¨ç¼–ç¨‹è¯­è¨€çš„æ­¥éª¤ï¼š</p>
<ul>
<li>
<p>å®‰è£…</p>
</li>
<li>
<p>Hello World</p>
<ul>
<li>æ³¨é‡Š</li>
<li>æ ¼å¼åŒ–è¾“å‡º</li>
</ul>
</li>
<li>
<p>å˜é‡å’Œå¸¸é‡</p>
</li>
<li>
<p>æ•°æ®ç±»å‹</p>
<ul>
<li>åŸºæœ¬ç±»å‹
<ul>
<li>è¿ç®—</li>
<li>ç±»å‹è½¬æ¢</li>
</ul>
</li>
<li>å¤æ‚ç±»å‹</li>
</ul>
</li>
<li>
<p>è¡¨è¾¾å¼å’Œè¯­å¥</p>
<ul>
<li>æ¡ä»¶</li>
<li>å¾ªç¯</li>
<li>æ–­è¨€</li>
</ul>
</li>
<li>
<p>å‡½æ•°</p>
</li>
<li>
<p>ç±»å’Œå¯¹è±¡</p>
</li>
<li>
<p>åŒ…å’Œæ¨¡å—</p>
</li>
<li>
<p>å¼‚å¸¸å¤„ç†</p>
</li>
<li>
<p>æ ‡å‡†åº“</p>
<ul>
<li>IO</li>
<li>ç½‘ç»œ</li>
<li>å¤šçº¿ç¨‹</li>
</ul>
</li>
<li>
<p>å•å…ƒæµ‹è¯•</p>
</li>
</ul>
<p>æ¥ä¸‹æ¥ï¼Œæ‰“ç®—æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤æ¥å­¦ä¹  Rustã€Pythonã€Goï¼Œä¹Ÿè®¸è¿˜ä¼šæœ‰ NodeJs å’Œ Kotlinï¼Œå¹¶æ•´ç†ç›¸å…³ç¬”è®°ã€‚</p>
<h2 id="å·¥ä½œ">å·¥ä½œ</h2>
<h3 id="effective-java-3-ç¬”è®°">Effective Java 3 ç¬”è®°</h3>
<p>è¯·å‚è€ƒ <a href="/posts/2023/04/11/enforce-the-singleton-property-with-a-private-constructor-or-an-enum-type/">ã€ŠEffective Java 3ã€‹ç¬”è®°ï¼šä½¿ç”¨ç§æœ‰æ„é€ å‡½æ•°æˆ–æšä¸¾ç±»å‹åˆ›å»ºå•ä¾‹</a></p>
<h3 id="rust">Rust</h3>
<p>å› ä¸ºå¯¹ <a href="https://tauri.app/">Tauri</a> è¿™ä¸ª GUI æ¡†æ¶æŒºæ„Ÿå…´è¶£ï¼Œæ‰€ä»¥æˆ‘å¼€å§‹å­¦ä¹  Rust äº†ï¼Œç›®å‰åœ¨å‚è€ƒ <a href="https://rustwiki.org/">https://rustwiki.org/</a> ä¸Šçš„ <a href="https://rustwiki.org/zh-CN/rust-by-example/">é€šè¿‡ä¾‹å­å­¦ Rust</a> å’Œ ã€ŠRustæƒå¨æŒ‡å—ã€‹ å­¦ä¹  Rustã€‚</p>
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekl-review-14-02.jpg" alt="weekl-review-14-02" style="width:50%;" />
<h2 id="å¥½ç‰©åˆ†äº«">å¥½ç‰©åˆ†äº«</h2>
<p>è™½ç„¶å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€<a href="https://t.me/chensoul_share">ChenSoul Share</a>ã€Telegram é¢‘é“ï¼Œä¸è¿‡è¿˜æ˜¯æŒ‘é€‰ä¸€éƒ¨åˆ†åœ¨è¿™é‡Œåˆ—ä¸¾ä¸€ä¸‹ï¼Œæ„Ÿè§‰æ›´åƒä¸€ä¸ª newsletter äº†ã€‚</p>
<h3 id="ä¸€äº›æ–‡ç« ">ä¸€äº›æ–‡ç« </h3>
<ul>
<li><a href="http://ebookconverter.blogspot.com/2013/11/where-to-find-epub-file-in-ibooks-for.html">Where to find the EPUB file in iBooks for Mac under OS X 10.9 Mavericks</a></li>
<li><a href="https://roy.wang/umami-js-quicken/">ä½¿ç”¨ CDN åŠ é€Ÿ Umami é™æ€èµ„æº</a></li>
<li><a href="https://blog.alswl.com/2023/04/web-api-guidelines/">å®ç”¨ Web API è§„èŒƒ</a></li>
<li><a href="https://utgd.net/article/9367">ä¸€æ¬¡æœ¬åœ°å…è´¹è¿‡æ»¤ RSS çš„å°è¯•ï¼šNetNewsWire</a></li>
<li><a href="https://catcoding.me/p/redis-antriez/">ä¸æƒ³å½“ä½œå®¶çš„ç¨‹åºå‘˜å†™ä¸å‡º Redis</a></li>
<li><a href="https://www.lijiaocn.com/%E7%BC%96%E7%A8%8B/2023/03/30/kotlin-syntax.html">Kotlin è¯­æ³•ä¸€ç«™å¼æ‰‹å†Œ</a></li>
</ul>
<h3 id="ä¸€äº›å·¥å…·">ä¸€äº›å·¥å…·</h3>
<ul>
<li><a href="https://listmonk.app/">Listmonk</a> ä¸€æ¬¾è‡ªä¸»æ‰˜ç®¡çš„ç”µå­é‚®ä»¶åˆ—è¡¨ç®¡ç†å·¥å…·ã€‚å®ƒå…è®¸æ‚¨å°†é‚®ä»¶åˆ—è¡¨å¯¼å…¥åˆ°è‡ªå·±çš„æœåŠ¡å™¨ä¸­ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥ç®¡ç†æ‚¨çš„é‚®ä»¶åˆ—è¡¨å’Œå‘é€ç”µå­é‚®ä»¶ã€‚Listmonkå…·æœ‰è‰¯å¥½çš„å¯æ‰©å±•æ€§å’Œè‡ªå®šä¹‰æ€§ï¼Œå¯é€šè¿‡REST APIè¿›è¡Œæ“ä½œï¼Œå¹¶æ”¯æŒé«˜çº§åŠŸèƒ½ï¼Œä¾‹å¦‚è‡ªå®šä¹‰å­—æ®µã€æ¨¡æ¿å’Œè‡ªåŠ¨åŒ–å·¥ä½œæµç¨‹ï¼Œä»è€Œä½¿å…¶æˆä¸ºä¸€ä¸ªéå¸¸æœ‰ç”¨å’Œçµæ´»çš„ç”µå­é‚®ä»¶åˆ—è¡¨ç®¡ç†å·¥å…·ã€‚ä¸å…¶ä»–åœ¨çº¿é‚®ä»¶åˆ—è¡¨æœåŠ¡ç›¸æ¯”ï¼ŒListmonkçš„ä¼˜åŠ¿ä¹‹ä¸€æ˜¯æ‚¨å®Œå…¨æŒæ§è‡ªå·±çš„æ•°æ®å’ŒæœåŠ¡å™¨ï¼Œå› æ­¤æ‚¨ä¸å¿…æ‹…å¿ƒç¬¬ä¸‰æ–¹å…¬å¸çš„æ•°æ®éšç§é—®é¢˜ã€‚</li>
<li><a href="https://ricks-apps.com/osx/sitesucker/index.html">SiteSucker</a> SiteSuckeræ˜¯ä¸€æ¬¾MacOSå¹³å°ä¸Šçš„å…è´¹å·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ©ç”¨æˆ·å°†æ•´ä¸ªç½‘ç«™ä¸‹è½½åˆ°æœ¬åœ°ç”µè„‘ä¸­ã€‚ä½¿ç”¨SiteSuckerï¼Œç”¨æˆ·åªéœ€è¦è¾“å…¥ç›®æ ‡ç½‘ç«™çš„URLï¼Œå®ƒå°±ä¼šè‡ªåŠ¨ä¸‹è½½è¯¥ç½‘ç«™çš„æ‰€æœ‰é¡µé¢ã€å›¾åƒã€è§†é¢‘å’Œå…¶ä»–èµ„æºï¼Œå¹¶å°†å®ƒä»¬ä¿å­˜åœ¨æœ¬åœ°ç¡¬ç›˜ä¸Šï¼Œä»¥ä¾¿ç”¨æˆ·ç¦»çº¿æµè§ˆæˆ–å¤‡ä»½ã€‚SiteSuckeræ”¯æŒå¤šçº¿ç¨‹ä¸‹è½½å’Œæ–­ç‚¹ç»­ä¼ ï¼Œå¯ä»¥åœ¨ä¸ä¸­æ–­ä¸‹è½½çš„æƒ…å†µä¸‹æš‚åœå’Œæ¢å¤ä¸‹è½½ä»»åŠ¡ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜å¯ä»¥è¿‡æ»¤URLï¼Œä»¥ä¾¿ç”¨æˆ·åªä¸‹è½½ç‰¹å®šç±»å‹çš„æ–‡ä»¶ï¼Œä¾‹å¦‚HTMLã€å›¾åƒæˆ–è§†é¢‘æ–‡ä»¶ã€‚æ€»ä¹‹ï¼ŒSiteSuckeræ˜¯ä¸€æ¬¾éå¸¸å®ç”¨çš„å·¥å…·ï¼Œé€‚ç”¨äºéœ€è¦ç¦»çº¿æµè§ˆç½‘ç«™ã€å¤‡ä»½ç½‘ç«™æˆ–è¿›è¡Œç½‘ç«™æŠ“å–çš„ç”¨æˆ·ã€‚</li>
<li><a href="https://montaigne.io/">Montaigne</a> ç”¨è‹¹æœç¬”è®°æ¥åˆ›å»ºç½‘ç«™ã€åšå®¢æˆ–ä½œå“é›†</li>
<li><a href="https://github.com/BlueMatthew/WechatExporter">WechatExporter</a> èŠå¤©è®°å½•å¯¼å‡º</li>
<li><a href="https://paw.cloud/">RapidAPI</a> ä¸€æ¬¾MacOSå¹³å°ä¸Šçš„APIå¼€å‘å·¥å…·ï¼Œå®ƒæ—¨åœ¨å¸®åŠ©å¼€å‘äººå‘˜æ›´è½»æ¾åœ°è®¾è®¡ã€æµ‹è¯•å’Œè°ƒè¯•APIã€‚Pawæä¾›äº†ä¸€ä¸ªç›´è§‚çš„ç”¨æˆ·ç•Œé¢ï¼Œå¯ä»¥è®©ç”¨æˆ·è½»æ¾åœ°æ„å»ºå’Œè°ƒè¯•APIè¯·æ±‚ï¼Œå¹¶æŸ¥çœ‹æœåŠ¡å™¨å“åº”ã€‚Pawæ”¯æŒå¤šç§APIåè®®å’Œæ ¼å¼ï¼Œä¾‹å¦‚RESTã€SOAPã€GraphQLã€JSONå’ŒXMLç­‰ï¼Œå¯ä»¥ä¸å¤šç§æœåŠ¡å™¨ç«¯ç‚¹å’Œèº«ä»½éªŒè¯æ–¹å¼è¿›è¡Œé›†æˆã€‚æ­¤å¤–ï¼ŒPawè¿˜å…·æœ‰å¼ºå¤§çš„è‡ªåŠ¨åŒ–å’Œè„šæœ¬åŒ–åŠŸèƒ½ï¼Œå…è®¸ç”¨æˆ·ä½¿ç”¨JavaScriptæˆ–Pythonç¼–å†™è‡ªå®šä¹‰è„šæœ¬ï¼Œä»¥è‡ªåŠ¨åŒ–APIæµ‹è¯•å’Œé›†æˆå·¥ä½œæµç¨‹ã€‚</li>
<li><a href="https://gist.github.com/VincentSit/a682f4162b998c7f24d08ab34bf233da">å¸è½½MacOSå¾®ä¿¡é”®ç›˜</a></li>
</ul>
<p>ä»¥ä¸Šã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>ã€ŠEffective Java 3ã€‹ç¬”è®°3ï¼šä½¿ç”¨ç§æœ‰æ„é€ å‡½æ•°æˆ–æšä¸¾ç±»å‹åˆ›å»ºå•ä¾‹</title>
      <link>https://blog.chensoul.com/posts/2023/04/11/enforce-the-singleton-property-with-a-private-constructor-or-an-enum-type/</link>
      <pubDate>Tue, 11 Apr 2023 08:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/04/11/enforce-the-singleton-property-with-a-private-constructor-or-an-enum-type/</guid>
      <description>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼Œåœ¨æ•´ç†ç¬”è®°è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ chatgpt çš„å¸®åŠ©åšäº†ä¸€äº›æ‰©å±•ã€‚ ä»‹ç» å•ä¾‹æ˜¯ä¸€ä¸ªåªå®ä¾‹åŒ–ä¸€æ¬¡çš„ç±»ã€‚å•ä¾‹é€šå¸¸è¡¨ç¤ºæ— </description>
      <content:encoded><![CDATA[<p>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼Œåœ¨æ•´ç†ç¬”è®°è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ chatgpt çš„å¸®åŠ©åšäº†ä¸€äº›æ‰©å±•ã€‚</p>
<h2 id="ä»‹ç»">ä»‹ç»</h2>
<p>å•ä¾‹æ˜¯ä¸€ä¸ªåªå®ä¾‹åŒ–ä¸€æ¬¡çš„ç±»ã€‚å•ä¾‹é€šå¸¸è¡¨ç¤ºæ— çŠ¶æ€å¯¹è±¡ï¼Œæ¯”å¦‚å‡½æ•°æˆ–ç³»ç»Ÿç»„ä»¶ï¼Œå®ƒä»¬åœ¨æœ¬è´¨ä¸Šæ˜¯å”¯ä¸€çš„ã€‚<strong>å°†ä¸€ä¸ªç±»è®¾è®¡ä¸ºå•ä¾‹ä¼šä½¿å®ƒçš„å®¢æˆ·ç«¯æµ‹è¯•æ—¶å˜å¾—å›°éš¾ï¼Œ</strong> é™¤éå®ƒå®ç°äº†ä½œä¸ºå…¶ç±»å‹çš„æ¥å£ï¼Œå¦åˆ™æ— æ³•ç”¨æ¨¡æ‹Ÿå®ç°æ¥ä»£æ›¿å•ä¾‹ã€‚</p>
<h2 id="å®ç°">å®ç°</h2>
<p>å®ç°å•ä¾‹æœ‰ä¸¤ç§å¸¸è§çš„æ–¹æ³•ã€‚ä¸¤è€…éƒ½åŸºäºä¿æŒæ„é€ å‡½æ•°ç§æœ‰å’Œå¯¼å‡ºå…¬å…±é™æ€æˆå‘˜ä»¥æä¾›å¯¹å”¯ä¸€å®ä¾‹çš„è®¿é—®ã€‚</p>
<p>åœ¨ç¬¬ä¸€ç§æ–¹æ³•ä¸­ï¼Œæˆå‘˜æ˜¯ä¸€ä¸ª final å­—æ®µï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Singleton with public final field
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Elvis</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Elvis</span> <span class="n">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Elvis</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">Elvis</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">leaveTheBuilding</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ç§æœ‰æ„é€ å‡½æ•°åªè°ƒç”¨ä¸€æ¬¡ï¼Œç”¨äºåˆå§‹åŒ– <code>public static final </code>ä¿®é¥°çš„ Elvis ç±»å‹å­—æ®µ <code>INSTANCE</code>ã€‚ä¸ä½¿ç”¨ <code>public</code> æˆ– <code>protected</code> çš„æ„é€ å‡½æ•°ä¿è¯äº†ã€Œç‹¬ä¸€æ— äºŒã€çš„ç©ºé—´ï¼šä¸€æ—¦åˆå§‹åŒ–äº† Elvis ç±»ï¼Œå°±åªä¼šå­˜åœ¨ä¸€ä¸ª Elvis å®ä¾‹ï¼Œä¸å¤šä¹Ÿä¸å°‘ã€‚å®¢æˆ·ç«¯æ‰€åšçš„ä»»ä½•äº‹æƒ…éƒ½ä¸èƒ½æ”¹å˜è¿™ä¸€ç‚¹ï¼Œä½†æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼šæ‹¥æœ‰ç‰¹æ®Šæƒé™çš„å®¢æˆ·ç«¯å¯ä»¥å€ŸåŠ© <code>AccessibleObject.setAccessible</code> æ–¹æ³•åˆ©ç”¨åå°„è°ƒç”¨ç§æœ‰æ„é€ å‡½æ•°ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Constructor</span><span class="o">&lt;?&gt;[]</span> <span class="n">constructors</span> <span class="o">=</span> <span class="n">Elvis</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getDeclaredConstructors</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">AccessibleObject</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="n">constructors</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Arrays</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">constructors</span><span class="o">).</span><span class="na">forEach</span><span class="o">(</span><span class="n">name</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="n">name</span><span class="o">.</span><span class="na">toString</span><span class="o">().</span><span class="na">contains</span><span class="o">(</span><span class="s">&#34;Elvis&#34;</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Elvis</span> <span class="n">instance</span> <span class="o">=</span> <span class="o">(</span><span class="n">Elvis</span><span class="o">)</span> <span class="n">name</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">instance</span><span class="o">.</span><span class="na">leaveTheBuilding</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">});</span>
</span></span></code></pre></div><p>å¦‚æœéœ€è¦é˜²èŒƒè¿™ç§æ”»å‡»ï¼Œè¯·ä¿®æ”¹æ„é€ å‡½æ•°ï¼Œä½¿å…¶åœ¨è¯·æ±‚åˆ›å»ºç¬¬äºŒä¸ªå®ä¾‹æ—¶æŠ›å‡ºå¼‚å¸¸ã€‚</p>
<p>åœ¨å®ç°å•ä¾‹çš„ç¬¬äºŒç§æ–¹æ³•ä¸­ï¼Œå…¬å…±æˆå‘˜æ˜¯ä¸€ç§é™æ€å·¥å‚æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Singleton with static factory
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Elvis</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Elvis</span> <span class="n">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Elvis</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">Elvis</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Elvis</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">INSTANCE</span><span class="o">;</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">leaveTheBuilding</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>æ‰€æœ‰å¯¹ <code>getInstance()</code> æ–¹æ³•çš„è°ƒç”¨éƒ½è¿”å›ç›¸åŒçš„å¯¹è±¡å¼•ç”¨ï¼Œå¹¶ä¸”ä¸ä¼šåˆ›å»ºå…¶ä»– Elvis å®ä¾‹ã€‚</p>
<p>å…¬å…±å­—æ®µæ–¹æ³•çš„ä¸»è¦ä¼˜ç‚¹æ˜¯ API æ˜ç¡®äº†ç±»æ˜¯å•ä¾‹çš„ï¼špublic static ä¿®é¥°çš„å­—æ®µæ˜¯ final çš„ï¼Œå› æ­¤å®ƒæ€»æ˜¯åŒ…å«ç›¸åŒçš„å¯¹è±¡å¼•ç”¨ã€‚ç¬¬äºŒä¸ªä¼˜ç‚¹æ˜¯æ›´ç®€å•ã€‚</p>
<p>é™æ€å·¥å‚æ–¹æ³•çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯ï¼Œå®ƒå¯ä»¥åœ¨ä¸æ›´æ”¹ API çš„æƒ…å†µä¸‹å†³å®šç±»æ˜¯å¦æ˜¯å•ä¾‹ã€‚å·¥å‚æ–¹æ³•è¿”å›å”¯ä¸€çš„å®ä¾‹ï¼Œä½†æ˜¯å¯ä»¥å¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œä¸ºè°ƒç”¨å®ƒçš„æ¯ä¸ªçº¿ç¨‹è¿”å›ä¸€ä¸ªå•ç‹¬çš„å®ä¾‹ã€‚ç¬¬äºŒä¸ªä¼˜ç‚¹æ˜¯ï¼Œå¦‚æœåº”ç”¨ç¨‹åºéœ€è¦çš„è¯ï¼Œå¯ä»¥ç¼–å†™æ³›å‹çš„å•ä¾‹å·¥å‚ã€‚ä½¿ç”¨é™æ€å·¥å‚çš„æœ€åä¸€ä¸ªä¼˜ç‚¹æ˜¯æ–¹æ³•å¼•ç”¨èƒ½å¤Ÿä½œä¸ºä¸€ä¸ªæä¾›è€…ï¼Œä¾‹å¦‚ <code>Elvis::getInstance</code> æ˜¯ <code>Supplier&lt;Elvis&gt;</code> çš„æä¾›è€…ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Supplier</span><span class="o">&lt;</span><span class="n">Elvis</span><span class="o">&gt;</span> <span class="n">sup</span> <span class="o">=</span> <span class="n">Elvis</span><span class="o">::</span><span class="n">getInstance</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Elvis</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">sup</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">obj</span><span class="o">.</span><span class="na">leaveTheBuilding</span><span class="o">();</span>
</span></span></code></pre></div><p>é™¤éèƒ½å¤Ÿä¸è¿™äº›ä¼˜ç‚¹æ²¾è¾¹ï¼Œå¦åˆ™ä½¿ç”¨ public å­—æ®µçš„æ–¹å¼æ›´å¯å–ã€‚</p>
<p>è¦ä½¿å•ä¾‹ç±»ä½¿ç”¨è¿™ä¸¤ç§æ–¹æ³•ä¸­çš„ä»»ä½•ä¸€ç§å®ç°å¯åºåˆ—åŒ–ï¼Œä»…ä»…åœ¨å…¶å£°æ˜ä¸­æ·»åŠ å®ç° <code>serializable</code> æ˜¯ä¸å¤Ÿçš„ã€‚è¦ç»´æŠ¤å•ä¾‹ä¿è¯ï¼Œåº”å£°æ˜æ‰€æœ‰å®ä¾‹å­—æ®µä¸º <code>transient</code>ï¼Œå¹¶æä¾› <code>readResolve</code> æ–¹æ³•ã€‚å¦åˆ™ï¼Œæ¯æ¬¡ååºåˆ—åŒ–å®ä¾‹æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹ï¼Œåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œè¿™ä¼šå¯¼è‡´å‡ºç°è™šå‡çš„ Elvisã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// readResolve method to preserve singleton property
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">private</span> <span class="n">Object</span> <span class="nf">readResolve</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Return the one true Elvis and let the garbage collector
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// take care of the Elvis impersonator.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="n">INSTANCE</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>å®ç°å•ä¾‹çš„ç¬¬ä¸‰ç§æ–¹æ³•æ˜¯å£°æ˜ä¸€ä¸ªå•å…ƒç´ æšä¸¾ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">// Enum singleton - the preferred approach
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">enum</span> <span class="n">Elvis</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">INSTANCE</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">leaveTheBuilding</span><span class="o">()</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>è¿™ç§æ–¹æ³•ç±»ä¼¼äº <code>public</code> å­—æ®µæ–¹æ³•ï¼Œä½†æ˜¯å®ƒæ›´ç®€æ´ï¼Œé»˜è®¤æä¾›äº†åºåˆ—åŒ–æœºåˆ¶ï¼Œæä¾›äº†å¯¹å¤šä¸ªå®ä¾‹åŒ–çš„ä¸¥æ ¼ä¿è¯ï¼Œå³ä½¿é¢å¯¹å¤æ‚çš„åºåˆ—åŒ–æˆ–åå°„æ”»å‡»ä¹Ÿæ˜¯å¦‚æ­¤ã€‚è¿™ç§æ–¹æ³•å¯èƒ½æœ‰ç‚¹ä¸è‡ªç„¶ï¼Œä½†æ˜¯<strong>å•å…ƒç´ æšä¸¾ç±»å‹é€šå¸¸æ˜¯å®ç°å•ä¾‹çš„æœ€ä½³æ–¹æ³•ã€‚</strong> æ³¨æ„ï¼Œå¦‚æœä½ çš„å•ä¾‹å¿…é¡»æ‰©å±•ä¸€ä¸ªè¶…ç±»è€Œä¸æ˜¯ <code>Enum</code>ï¼ˆå°½ç®¡ä½ å¯ä»¥å£°æ˜ä¸€ä¸ª Enum æ¥å®ç°æ¥å£ï¼‰ï¼Œä½ å°±ä¸èƒ½ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚</p>
<h2 id="æ‰©å±•">æ‰©å±•</h2>
<p>å•ä¾‹æ¨¡å¼æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹æ¥è®¿é—®è¯¥å®ä¾‹ã€‚åœ¨Javaè¯­è¨€ä¸­ï¼Œå•ä¾‹æ¨¡å¼ä¸€èˆ¬æœ‰ä»¥ä¸‹å‡ ç§å®ç°æ–¹å¼ï¼š</p>
<h3 id="é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼">é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼</h3>
<p>åœ¨ç±»åŠ è½½æ—¶å°±åˆ›å»ºå•ä¾‹å®ä¾‹ï¼Œå› æ­¤ä¹Ÿç§°ä¸ºé™æ€åˆå§‹åŒ–å•ä¾‹ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">EagerSingleton</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">EagerSingleton</span> <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EagerSingleton</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">EagerSingleton</span><span class="o">()</span> <span class="o">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">EagerSingleton</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h3 id="æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼">æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼</h3>
<p>åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨<code>getInstance()</code>æ–¹æ³•æ—¶æ‰åˆ›å»ºå•ä¾‹å®ä¾‹ï¼Œä¹Ÿç§°ä¸ºå»¶è¿Ÿåˆå§‹åŒ–å•ä¾‹ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LazySingleton</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="n">LazySingleton</span> <span class="n">instance</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">LazySingleton</span><span class="o">()</span> <span class="o">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">synchronized</span> <span class="n">LazySingleton</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LazySingleton</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†<code>synchronized</code>å…³é”®å­—æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼ä¼šå½±å“æ€§èƒ½ï¼Œå› ä¸ºæ¯æ¬¡è°ƒç”¨<code>getInstance()</code>æ–¹æ³•éƒ½ä¼šè¿›è¡ŒåŒæ­¥ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒé‡æ£€æŸ¥é”å®šæ¥æé«˜æ€§èƒ½ã€‚</p>
<h3 id="åŒé‡æ£€æŸ¥é”å®šå•ä¾‹æ¨¡å¼">åŒé‡æ£€æŸ¥é”å®šå•ä¾‹æ¨¡å¼</h3>
<p>åœ¨æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼çš„åŸºç¡€ä¸Šï¼Œä½¿ç”¨åŒé‡æ£€æŸ¥é”å®šæ¥ä¿è¯çº¿ç¨‹å®‰å…¨å’Œæ€§èƒ½ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LazySingleton</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">volatile</span> <span class="n">LazySingleton</span> <span class="n">instance</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">LazySingleton</span><span class="o">()</span> <span class="o">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">LazySingleton</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="kd">synchronized</span> <span class="o">(</span><span class="n">LazySingleton</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LazySingleton</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨ä¸Šè¿°å®ç°ä¸­ï¼Œ<code>instance</code> å­—æ®µä½¿ç”¨ <code>volatile</code> å…³é”®å­—ä¿®é¥°ï¼Œå¯ä»¥ç¡®ä¿å¤šä¸ªçº¿ç¨‹éƒ½èƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†è¯¥å˜é‡ã€‚</p>
<p>åœ¨ <code>getInstance()</code> æ–¹æ³•ä¸­ï¼Œé¦–å…ˆæ£€æŸ¥å®ä¾‹æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åˆ™ç›´æ¥è¿”å›å®ä¾‹å¼•ç”¨ã€‚å¦åˆ™ï¼Œè·å–ç±»å¯¹è±¡çš„é”ï¼Œå†æ¬¡æ£€æŸ¥å®ä¾‹æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœå®ä¾‹ä»ç„¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºå®ä¾‹ã€‚ç”±äº <code>synchronized</code> å…³é”®å­—å¯ä»¥ç¡®ä¿åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è¿›å…¥ä¸´ç•ŒåŒºï¼Œå› æ­¤å¯ä»¥é¿å…å¤šä¸ªçº¿ç¨‹åŒæ—¶åˆ›å»ºå®ä¾‹çš„æƒ…å†µã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä½¿ç”¨åŒé‡é”æ£€æµ‹æ—¶ï¼Œéœ€è¦ä½¿ç”¨ <code>volatile</code> å…³é”®å­—æ¥ä¿è¯å¤šä¸ªçº¿ç¨‹éƒ½èƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†å…±äº«å˜é‡ã€‚åŒæ—¶ï¼Œä¸ºäº†ä¿è¯æ‰€æœ‰çº¿ç¨‹éƒ½çœ‹åˆ°åŒä¸€ä¸ªå®ä¾‹ï¼Œéœ€è¦ä½¿ç”¨é™æ€å­—æ®µæ¥å­˜å‚¨å•ä¾‹å®ä¾‹ã€‚</p>
<blockquote>
<p><strong>å…³äº  <code>volatile</code> å…³é”®å­—ä¿®é¥°</strong></p>
<p>åœ¨ Java ä¸­ï¼Œå½“ä¸€ä¸ªå˜é‡è¢«å¤šä¸ªçº¿ç¨‹å…±äº«æ—¶ï¼Œå¦‚æœæ²¡æœ‰é‡‡å–ç‰¹æ®Šçš„æªæ–½ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å˜é‡å€¼ï¼Œä½†å…¶ä»–çº¿ç¨‹å¹¶æ²¡æœ‰çœ‹åˆ°è¯¥å˜é‡çš„å˜åŒ–çš„æƒ…å†µã€‚è¿™æ˜¯å› ä¸ºæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ CPU ç¼“å­˜ï¼Œè¯¥å˜é‡çš„å€¼å¯èƒ½å­˜åœ¨äºæŸä¸ªçº¿ç¨‹çš„ CPU ç¼“å­˜ä¸­ï¼Œä½†å…¶ä»–çº¿ç¨‹å¹¶æ²¡æœ‰åŠæ—¶æ›´æ–°ç¼“å­˜ä¸­çš„å€¼ã€‚</p>
<p><code>volatile</code> æ˜¯ä¸€ç§ Java å…³é”®å­—ï¼Œå®ƒå¯ä»¥ç¡®ä¿å¤šä¸ªçº¿ç¨‹éƒ½èƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†è¯¥å˜é‡ã€‚å½“ä¸€ä¸ªå˜é‡è¢«å£°æ˜ä¸º <code>volatile</code> æ—¶ï¼Œå®ƒä¼šå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p>
<ol>
<li>å¯è§æ€§ï¼šå½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº† <code>volatile</code> å˜é‡çš„å€¼æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥ç«‹å³çœ‹åˆ°è¯¥å˜åŒ–ã€‚</li>
<li>ç¦æ­¢æŒ‡ä»¤é‡æ’ï¼šç¼–è¯‘å™¨å’Œ CPU ä¼šå¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’ä»¥æé«˜æ‰§è¡Œæ•ˆç‡ï¼Œä½†æœ‰æ—¶è¿™ç§é‡æ’å¯èƒ½ä¼šå¯¼è‡´å¤šçº¿ç¨‹ç¨‹åºå‡ºç°é—®é¢˜ã€‚<code>volatile</code> å˜é‡çš„å†™æ“ä½œä¼šåœ¨è¯»æ“ä½œä¹‹å‰ï¼Œç¡®ä¿å˜é‡çš„ä¿®æ”¹å¯¹å…¶ä»–çº¿ç¨‹ç«‹å³å¯è§ï¼Œä»è€Œç¦æ­¢æŒ‡ä»¤é‡æ’ã€‚</li>
</ol>
<p>åœ¨ä¸Šè¿°å•ä¾‹æ¨¡å¼å®ç°ä¸­ï¼Œ<code>instance</code> å­—æ®µè¢«å£°æ˜ä¸º <code>volatile</code>ï¼Œè¿™æ˜¯ä¸ºäº†ç¡®ä¿å¤šä¸ªçº¿ç¨‹éƒ½èƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†è¯¥å˜é‡ã€‚å¦‚æœæ²¡æœ‰ä½¿ç”¨ <code>volatile</code>ï¼Œå¯èƒ½ä¼šå‡ºç°æŸä¸ªçº¿ç¨‹åˆ›å»ºäº†å®ä¾‹ï¼Œä½†å…¶ä»–çº¿ç¨‹å¹¶æ²¡æœ‰çœ‹åˆ°è¯¥å˜åŒ–çš„æƒ…å†µã€‚ä½¿ç”¨ <code>volatile</code> å¯ä»¥ç¡®ä¿å¤šä¸ªçº¿ç¨‹éƒ½èƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç† <code>instance</code> å˜é‡ï¼Œä»è€Œé¿å…å‡ºç°å¤šä¸ªå®ä¾‹çš„æƒ…å†µã€‚</p>
</blockquote>
<h3 id="æšä¸¾å•ä¾‹æ¨¡å¼">æšä¸¾å•ä¾‹æ¨¡å¼</h3>
<p>ä½¿ç”¨æšä¸¾ç±»å‹æ¥å®šä¹‰å•ä¾‹ï¼Œå®ƒä¿è¯äº†çº¿ç¨‹å®‰å…¨å’Œåºåˆ—åŒ–å®‰å…¨ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">enum</span> <span class="n">EnumSingleton</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">INSTANCE</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doSomething</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// do something
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><blockquote>
<p><strong>å…³äºæšä¸¾</strong></p>
<p>åœ¨ Java ä¸­ï¼Œæšä¸¾æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç±»ï¼Œå®ƒå¯ä»¥ç”¨äºå®šä¹‰ä¸€ç»„å¸¸é‡ã€‚æšä¸¾å¸¸é‡æ˜¯åœ¨æšä¸¾ç±»è¢«åŠ è½½æ—¶åˆ›å»ºçš„ï¼Œä¸”åªä¼šè¢«åˆ›å»ºä¸€æ¬¡ã€‚å› æ­¤ï¼Œæšä¸¾å¤©ç„¶å…·æœ‰å•ä¾‹æ¨¡å¼çš„ç‰¹æ€§ã€‚</p>
<p>åœ¨ Java ä¸­ï¼Œå•ä¾‹æ¨¡å¼æ˜¯ä¸€ç§å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒå¯ä»¥ç¡®ä¿æŸä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›å…¨å±€è®¿é—®ç‚¹ã€‚å•ä¾‹æ¨¡å¼çš„å®ç°æ–¹å¼æœ‰å¤šç§ï¼ŒåŒ…æ‹¬æ‡’æ±‰å¼ã€é¥¿æ±‰å¼ã€åŒé‡æ£€æŸ¥é”ç­‰ã€‚ä½†æ˜¯ï¼Œè¿™äº›å®ç°æ–¹å¼éƒ½éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨å’Œåºåˆ—åŒ–ç­‰é—®é¢˜ï¼Œè€Œæšä¸¾å¤©ç„¶å…·æœ‰çº¿ç¨‹å®‰å…¨å’Œåºåˆ—åŒ–çš„ç‰¹æ€§ã€‚</p>
<p>æšä¸¾ç±»æ˜¯åœ¨ Java 1.5 ç‰ˆæœ¬ä¸­å¼•å…¥çš„ï¼Œå®ƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç±»ï¼Œå¯ä»¥ç”¨äºå®šä¹‰ä¸€ç»„å¸¸é‡ã€‚æšä¸¾å¸¸é‡æ˜¯åœ¨æšä¸¾ç±»è¢«åŠ è½½æ—¶åˆ›å»ºçš„ï¼Œä¸”åªä¼šè¢«åˆ›å»ºä¸€æ¬¡ã€‚å› æ­¤ï¼Œæšä¸¾å¤©ç„¶å…·æœ‰å•ä¾‹æ¨¡å¼çš„ç‰¹æ€§ï¼Œè€Œä¸”æšä¸¾ç±»çš„å®ç°æ–¹å¼éå¸¸ç®€å•ï¼Œæ— éœ€è€ƒè™‘çº¿ç¨‹å®‰å…¨å’Œåºåˆ—åŒ–ç­‰é—®é¢˜ã€‚å› æ­¤ï¼Œä½¿ç”¨æšä¸¾å®ç°å•ä¾‹æ¨¡å¼æ˜¯ä¸€ç§ç®€å•ã€å®‰å…¨ã€é«˜æ•ˆçš„æ–¹å¼ã€‚</p>
</blockquote>
<p>ä¸€ä¸ªå®é™…ä¸­ä½¿ç”¨çš„ä¾‹å­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@AllArgsConstructor</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Getter</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">enum</span> <span class="n">ChannelType</span> <span class="kd">implements</span> <span class="n">CodeAware</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">VMS</span><span class="o">(</span><span class="n">2</span><span class="o">,</span> <span class="s">&#34;è¯­éŸ³ç”µè¯&#34;</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">AbstractNotificationStrategy</span> <span class="nf">strategy</span><span class="o">(</span><span class="n">Properties</span> <span class="n">properties</span><span class="o">,</span> <span class="n">NotificationTemplate</span> <span class="n">notificationTemplate</span><span class="o">,</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">NotificationUser</span><span class="o">&gt;</span> <span class="n">users</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">new</span> <span class="n">VmsNotificationStrategy</span><span class="o">(</span><span class="k">new</span> <span class="n">VmsNotificationChannel</span><span class="o">(</span><span class="n">properties</span><span class="o">),</span> <span class="n">notificationTemplate</span><span class="o">,</span> <span class="n">users</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">NotificationTemplate</span> <span class="nf">template</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">,</span> <span class="n">String</span> <span class="n">template</span><span class="o">,</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">imageUrls</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">new</span> <span class="n">VmsNotificationTemplate</span><span class="o">(</span><span class="n">title</span><span class="o">,</span> <span class="n">template</span><span class="o">,</span> <span class="n">imageUrls</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">},</span>
</span></span><span class="line"><span class="cl">    <span class="n">FEISHU</span><span class="o">(</span><span class="n">3</span><span class="o">,</span> <span class="s">&#34;é£ä¹¦&#34;</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">AbstractNotificationStrategy</span> <span class="nf">strategy</span><span class="o">(</span><span class="n">Properties</span> <span class="n">properties</span><span class="o">,</span> <span class="n">NotificationTemplate</span> <span class="n">notificationTemplate</span><span class="o">,</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">NotificationUser</span><span class="o">&gt;</span> <span class="n">users</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">new</span> <span class="n">FeishuNotificationStrategy</span><span class="o">(</span><span class="k">new</span> <span class="n">FeishuNotificationChannel</span><span class="o">(</span><span class="n">properties</span><span class="o">),</span> <span class="n">notificationTemplate</span><span class="o">,</span> <span class="n">users</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">NotificationTemplate</span> <span class="nf">template</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">,</span> <span class="n">String</span> <span class="n">template</span><span class="o">,</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">imageUrls</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">new</span> <span class="n">FeishuNotificationTemplate</span><span class="o">(</span><span class="n">title</span><span class="o">,</span> <span class="n">template</span><span class="o">,</span> <span class="n">imageUrls</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">code</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">abstract</span> <span class="n">AbstractNotificationStrategy</span> <span class="nf">strategy</span><span class="o">(</span><span class="n">Properties</span> <span class="n">properties</span><span class="o">,</span> <span class="n">NotificationTemplate</span> <span class="n">notificationTemplate</span><span class="o">,</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">NotificationUser</span><span class="o">&gt;</span> <span class="n">users</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">abstract</span> <span class="n">NotificationTemplate</span> <span class="nf">template</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">,</span> <span class="n">String</span> <span class="n">template</span><span class="o">,</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">imageUrls</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h3 id="é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼">é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼</h3>
<p>é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼æ˜¯ä¸€ç§å¸¸ç”¨çš„å®ç°å•ä¾‹æ¨¡å¼çš„æ–¹å¼ï¼Œå®ƒå¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨ä¸”å®ç°ç®€å•ã€‚åœ¨è¯¥æ¨¡å¼ä¸­ï¼Œå•ä¾‹å®ä¾‹æ˜¯é€šè¿‡é™æ€å†…éƒ¨ç±»æ¥å®ç°çš„ã€‚</p>
<blockquote>
<p>åœ¨ Java ä¸­ï¼Œé™æ€å†…éƒ¨ç±»æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç±»ï¼Œå®ƒæ˜¯åœ¨å¦ä¸€ä¸ªç±»å†…éƒ¨å®šä¹‰çš„é™æ€ç±»ã€‚é™æ€å†…éƒ¨ç±»å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„é™æ€å­—æ®µå’Œæ–¹æ³•ï¼Œä½†ä¸èƒ½è®¿é—®å¤–éƒ¨ç±»çš„éé™æ€å­—æ®µå’Œæ–¹æ³•ã€‚</p>
</blockquote>
<p>ä½¿ç”¨é™æ€å†…éƒ¨ç±»å®ç°å•ä¾‹æ¨¡å¼çš„æ–¹å¼å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">StaticInnerClassSingleton</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">StaticInnerClassSingleton</span><span class="o">()</span> <span class="o">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">SingletonHolder</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">StaticInnerClassSingleton</span> <span class="n">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StaticInnerClassSingleton</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">StaticInnerClassSingleton</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">SingletonHolder</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ<code>SingletonHolder</code> æ˜¯é™æ€å†…éƒ¨ç±»ï¼Œå®ƒåŒ…å«ä¸€ä¸ªé™æ€å¸¸é‡ <code>INSTANCE</code>ï¼Œè¯¥å¸¸é‡æ˜¯åœ¨é™æ€å†…éƒ¨ç±»è¢«åŠ è½½æ—¶åˆ›å»ºçš„ï¼Œä¸”åªä¼šè¢«åˆ›å»ºä¸€æ¬¡ã€‚ç”±äºé™æ€å†…éƒ¨ç±»çš„åŠ è½½æ˜¯åœ¨éœ€è¦æ—¶æ‰è¿›è¡Œçš„ï¼Œå› æ­¤å¯ä»¥å®ç°æ‡’åŠ è½½çš„æ•ˆæœã€‚åœ¨ <code>getInstance</code> æ–¹æ³•ä¸­ï¼Œç›´æ¥è¿”å› <code>SingletonHolder.INSTANCE</code> å³å¯è·å–å•ä¾‹å®ä¾‹ã€‚</p>
<p>åœ¨é™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼ä¸­ï¼Œç”±äºé™æ€å†…éƒ¨ç±»çš„åŠ è½½æ˜¯åœ¨éœ€è¦æ—¶æ‰è¿›è¡Œçš„ï¼Œä¸”åªä¼šè¢«åŠ è½½ä¸€æ¬¡ï¼Œå› æ­¤å¯ä»¥ä¿è¯å•ä¾‹å®ä¾‹çš„çº¿ç¨‹å®‰å…¨ã€‚åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨ <code>getInstance</code> æ–¹æ³•æ—¶ï¼Œç”±äºé™æ€å†…éƒ¨ç±»çš„åŠ è½½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤å¯ä»¥ä¿è¯åªæœ‰ä¸€ä¸ªå•ä¾‹å®ä¾‹è¢«åˆ›å»ºã€‚</p>
<p>æ­¤å¤–ï¼Œé™æ€å†…éƒ¨ç±»å•ä¾‹æ¨¡å¼çš„å®ç°æ–¹å¼ç®€å•ä¸”æ˜“äºç†è§£ï¼Œè€Œä¸”ä¸éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨å’Œåºåˆ—åŒ–ç­‰é—®é¢˜ï¼Œå› æ­¤æ˜¯ä¸€ç§å¸¸ç”¨çš„å®ç°å•ä¾‹æ¨¡å¼çš„æ–¹å¼ã€‚</p>
<h3 id="æ³¨å†Œå¼å•ä¾‹æ¨¡å¼">æ³¨å†Œå¼å•ä¾‹æ¨¡å¼</h3>
<p>ä½¿ç”¨å®¹å™¨æ¥å­˜å‚¨å•ä¾‹å®ä¾‹ï¼Œé€šè¿‡å”¯ä¸€çš„æ ‡è¯†ç¬¦æ¥è®¿é—®å•ä¾‹å®ä¾‹ã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼Œæ¯ç§å®ç°æ–¹å¼éƒ½æœ‰å…¶é€‚ç”¨çš„åœºæ™¯å’Œä¼˜ç¼ºç‚¹ï¼Œå¼€å‘è€…éœ€è¦æ ¹æ®å…·ä½“çš„éœ€æ±‚æ¥é€‰æ‹©åˆé€‚çš„å®ç°æ–¹å¼ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SingletonRegistry</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">registry</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">SingletonRegistry</span><span class="o">()</span> <span class="o">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">synchronized</span> <span class="kt">void</span> <span class="nf">register</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">registry</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">obj</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">synchronized</span> <span class="n">Object</span> <span class="nf">getSingleton</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">registry</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬åœ¨<code>register()</code>æ–¹æ³•å’Œ<code>getSingleton()</code>æ–¹æ³•ä¸Šéƒ½åŠ äº†<code>synchronized</code>å…³é”®å­—ï¼Œç¡®ä¿äº†å¤šçº¿ç¨‹æƒ…å†µä¸‹çš„çº¿ç¨‹å®‰å…¨ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼ä¼šå½±å“æ€§èƒ½ï¼Œå› ä¸ºæ¯æ¬¡è°ƒç”¨<code>getSingleton()</code>æ–¹æ³•éƒ½ä¼šè¿›è¡ŒåŒæ­¥ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä½¿ç”¨å¹¶å‘å®¹å™¨å®ç°çº¿ç¨‹å®‰å…¨çš„ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SingletonRegistry</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="n">ConcurrentMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">registry</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">SingletonRegistry</span><span class="o">()</span> <span class="o">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">register</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">registry</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">obj</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Object</span> <span class="nf">getSingleton</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">registry</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ä½¿ç”¨<code>ConcurrentMap</code>çš„<code>computeIfAbsent</code>æ–¹æ³•å¯ä»¥æ›´åŠ ç®€æ´åœ°å®ç°çº¿ç¨‹å®‰å…¨çš„æ³¨å†Œå¼å•ä¾‹æ¨¡å¼ï¼Œå®ƒå¯ä»¥ç¡®ä¿å¤šçº¿ç¨‹æƒ…å†µä¸‹çš„çº¿ç¨‹å®‰å…¨ï¼Œå¹¶ä¸”é¿å…äº†ä½¿ç”¨<code>synchronized</code>å…³é”®å­—å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä½¿ç”¨<code>ConcurrentMap</code>çš„<code>computeIfAbsent</code>æ–¹æ³•å®ç°çº¿ç¨‹å®‰å…¨çš„ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SingletonRegistry</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="n">ConcurrentMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">registry</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">SingletonRegistry</span><span class="o">()</span> <span class="o">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">register</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">registry</span><span class="o">.</span><span class="na">putIfAbsent</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">obj</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Object</span> <span class="nf">getSingleton</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">registry</span><span class="o">.</span><span class="na">computeIfAbsent</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">key</span> <span class="o">-&gt;</span> <span class="n">createSingleton</span><span class="o">(</span><span class="n">key</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Object</span> <span class="nf">createSingleton</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// create singleton object
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="k">new</span> <span class="n">Object</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>ConcurrentHashMap</code>æ¥å­˜å‚¨æ³¨å†Œä¿¡æ¯ï¼Œå¹¶ä¸”ä½¿ç”¨äº†<code>putIfAbsent</code>æ–¹æ³•æ¥é¿å…é‡å¤æ·»åŠ å…ƒç´ ã€‚åœ¨<code>getSingleton</code>æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†<code>computeIfAbsent</code>æ–¹æ³•æ¥è·å–å•ä¾‹å®ä¾‹ï¼Œå¦‚æœå®ä¾‹ä¸å­˜åœ¨ï¼Œåˆ™è°ƒç”¨<code>createSingleton</code>æ–¹æ³•åˆ›å»ºå®ä¾‹ã€‚ç”±äº<code>ConcurrentHashMap</code>çš„å¹¶å‘æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› æ­¤ä½¿ç”¨<code>computeIfAbsent</code>æ–¹æ³•å¯ä»¥ç¡®ä¿å¤šçº¿ç¨‹æƒ…å†µä¸‹çš„çº¿ç¨‹å®‰å…¨ã€‚</p>
<h2 id="è¿ç”¨">è¿ç”¨</h2>
<p>ä»¥ä¸‹ï¼Œæ•´ç†äº†å¸¸è§çš„å¼€æºæ¡†æ¶ä¸­å•ä¾‹æ¨¡å¼è¿ç”¨ã€‚</p>
<h3 id="log4j">Log4j</h3>
<p>Log4j æ˜¯ä¸€ä¸ªç”¨äºè®°å½•æ—¥å¿—çš„å¼€æºæ¡†æ¶ï¼Œå®ƒä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥ç®¡ç† Logger çš„å®ä¾‹ã€‚Logger æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œç”¨äºè®°å½•åº”ç”¨ç¨‹åºçš„æ—¥å¿—ä¿¡æ¯ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ Log4j çš„å•ä¾‹æ¨¡å¼å®ç°ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Logger</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Logger</span><span class="o">&gt;</span> <span class="n">instances</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">Logger</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// private constructor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Logger</span> <span class="nf">getLogger</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Logger</span> <span class="n">instance</span> <span class="o">=</span> <span class="n">instances</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="kd">synchronized</span> <span class="o">(</span><span class="n">instances</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">instance</span> <span class="o">=</span> <span class="n">instances</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Logger</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                    <span class="n">instances</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">instance</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// other methods
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒLogger ä½¿ç”¨ä¸€ä¸ª Map æ¥ç¼“å­˜æ‰€æœ‰çš„ Logger å®ä¾‹ï¼Œå¹¶åœ¨éœ€è¦è·å– Logger å®ä¾‹æ—¶ä½¿ç”¨åŒé‡æ£€æŸ¥é”å®šæœºåˆ¶æ¥ç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åˆ›å»ºå®ä¾‹ã€‚</p>
<h3 id="jedis">Jedis</h3>
<p>Jedis æ˜¯ä¸€ä¸ªç”¨äºè¿æ¥ Redis æ•°æ®åº“çš„å¼€æºæ¡†æ¶ï¼Œå®ƒä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥ç®¡ç† JedisPool çš„å®ä¾‹ã€‚JedisPool æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œç”¨äºç®¡ç†å¯é‡ç”¨çš„ Jedis å®ä¾‹ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ Jedis çš„å•ä¾‹æ¨¡å¼å®ç°ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JedisPool</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">JedisPool</span><span class="o">&gt;</span> <span class="n">INSTANCES</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">JedisPool</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// private constructor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">synchronized</span> <span class="n">JedisPool</span> <span class="nf">getInstance</span><span class="o">(</span><span class="n">String</span> <span class="n">host</span><span class="o">,</span> <span class="kt">int</span> <span class="n">port</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">String</span> <span class="n">key</span> <span class="o">=</span> <span class="n">host</span> <span class="o">+</span> <span class="s">&#34;:&#34;</span> <span class="o">+</span> <span class="n">port</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">JedisPool</span> <span class="n">instance</span> <span class="o">=</span> <span class="n">INSTANCES</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JedisPool</span><span class="o">(</span><span class="n">host</span><span class="o">,</span> <span class="n">port</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">INSTANCES</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">instance</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// other methods
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒJedis ä½¿ç”¨ä¸€ä¸ª ConcurrentHashMap æ¥ç¼“å­˜æ‰€æœ‰çš„ JedisPool å®ä¾‹ï¼Œå¹¶åœ¨éœ€è¦è·å– JedisPool å®ä¾‹æ—¶ä½¿ç”¨ synchronized æ–¹æ³•æ¥ç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åˆ›å»ºå®ä¾‹ã€‚</p>
<h3 id="retrofit">Retrofit</h3>
<p>Retrofit æ˜¯ä¸€ä¸ªç”¨äºç®€åŒ– HTTP è¯·æ±‚çš„å¼€æºæ¡†æ¶ï¼Œå®ƒä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥ç®¡ç† Retrofit çš„å®ä¾‹ã€‚Retrofit æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œç”¨äºåˆ›å»º HTTP è¯·æ±‚ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ Retrofit çš„å•ä¾‹æ¨¡å¼å®ç°ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Retrofit</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Retrofit</span> <span class="n">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Retrofit</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">Retrofit</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// private constructor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Retrofit</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">INSTANCE</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">create</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">service</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// create HTTP request using service interface
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// other methods
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒRetrofit ä½¿ç”¨é™æ€å˜é‡å’Œé™æ€æ–¹æ³•æ¥è·å–å•ä¾‹å®ä¾‹ï¼Œå¹¶åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å…±äº«ä½¿ç”¨ã€‚</p>
<h3 id="gson">Gson</h3>
<p>Gson æ˜¯ä¸€ä¸ªç”¨äºå°† JSON å­—ç¬¦ä¸²è½¬æ¢ä¸º Java å¯¹è±¡çš„å¼€æºæ¡†æ¶ï¼Œå®ƒä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥ç®¡ç† Gson çš„å®ä¾‹ã€‚Gson æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œç”¨äºå¤„ç† JSON æ•°æ®ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ Gson çš„å•ä¾‹æ¨¡å¼å®ç°ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Gson</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Gson</span> <span class="n">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Gson</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">Gson</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// private constructor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Gson</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">INSTANCE</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">fromJson</span><span class="o">(</span><span class="n">String</span> <span class="n">json</span><span class="o">,</span> <span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">classOfT</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// convert JSON string to Java object
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// other methods
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒGson ä½¿ç”¨é™æ€å˜é‡å’Œé™æ€æ–¹æ³•æ¥è·å–å•ä¾‹å®ä¾‹ï¼Œå¹¶åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å…±äº«ä½¿ç”¨ã€‚</p>
<h3 id="spring-framework">Spring Framework</h3>
<p>Spring Framework æ˜¯ä¸€ä¸ªç”¨äºæ„å»ºä¼ä¸šçº§ Java åº”ç”¨ç¨‹åºçš„å¼€æºæ¡†æ¶ï¼Œå®ƒä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥ç®¡ç† Bean çš„å®ä¾‹ã€‚Bean æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œç”¨äºå®ç°åº”ç”¨ç¨‹åºçš„ä¸šåŠ¡é€»è¾‘ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ Spring Framework çš„å•ä¾‹æ¨¡å¼å®ç°ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DefaultListableBeanFactory</span> <span class="kd">implements</span> <span class="n">BeanFactory</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">singletonObjects</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;(</span><span class="n">256</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">getBean</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">BeansException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Object</span> <span class="n">bean</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">singletonObjects</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">bean</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="kd">synchronized</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">singletonObjects</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">bean</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">singletonObjects</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">bean</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">bean</span> <span class="o">=</span> <span class="n">createBean</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                    <span class="k">this</span><span class="o">.</span><span class="na">singletonObjects</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">bean</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">bean</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Object</span> <span class="nf">createBean</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// create Bean instance
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// other methods
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒSpring Framework ä½¿ç”¨ä¸€ä¸ª ConcurrentHashMap æ¥ç¼“å­˜æ‰€æœ‰çš„ Bean å®ä¾‹ï¼Œå¹¶åœ¨éœ€è¦è·å– Bean å®ä¾‹æ—¶ä½¿ç”¨åŒé‡æ£€æŸ¥é”å®šæœºåˆ¶æ¥ç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åˆ›å»ºå®ä¾‹ã€‚</p>
<h3 id="hibernate">Hibernate</h3>
<p>Hibernate æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†å…³ç³»æ•°æ®åº“çš„å¼€æºæ¡†æ¶ï¼Œå®ƒä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥ç®¡ç† SessionFactory çš„å®ä¾‹ã€‚SessionFactory æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œç”¨äºåˆ›å»ºå’Œç®¡ç† Session å¯¹è±¡ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ Hibernate çš„å•ä¾‹æ¨¡å¼å®ç°ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SessionFactory</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">SessionFactory</span> <span class="n">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SessionFactory</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">SessionFactory</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// private constructor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">SessionFactory</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">INSTANCE</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Session</span> <span class="nf">openSession</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// create and return new Session object
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// other methods
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒHibernate ä½¿ç”¨é™æ€å˜é‡å’Œé™æ€æ–¹æ³•æ¥è·å–å•ä¾‹å®ä¾‹ï¼Œå¹¶åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­å…±äº«ä½¿ç”¨ã€‚</p>
<h3 id="junit">JUnit</h3>
<p>JUnit æ˜¯ä¸€ä¸ªç”¨äºç¼–å†™å•å…ƒæµ‹è¯•çš„å¼€æºæ¡†æ¶ï¼Œå®ƒä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥ç®¡ç† TestSuite çš„å®ä¾‹ã€‚TestSuite æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œç”¨äºç®¡ç†æµ‹è¯•ç”¨ä¾‹çš„é›†åˆã€‚</p>
<p>ä»¥ä¸‹æ˜¯ JUnit çš„å•ä¾‹æ¨¡å¼å®ç°ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestSuite</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">TestSuite</span> <span class="n">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TestSuite</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">TestCase</span><span class="o">&gt;</span> <span class="n">testCases</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">TestSuite</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// private constructor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">TestSuite</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">INSTANCE</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addTestCase</span><span class="o">(</span><span class="n">TestCase</span> <span class="n">testCase</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">testCases</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">testCase</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="n">TestResult</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="n">TestCase</span> <span class="n">testCase</span> <span class="o">:</span> <span class="n">testCases</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">testCase</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// other methods
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒJUnit ä½¿ç”¨é™æ€å˜é‡å’Œé™æ€æ–¹æ³•æ¥è·å– TestSuite çš„å•ä¾‹å®ä¾‹ï¼Œå¹¶åœ¨æ•´ä¸ªæµ‹è¯•åº”ç”¨ç¨‹åºä¸­å…±äº«ä½¿ç”¨ã€‚</p>
<h3 id="apache-commons-lang">Apache Commons Lang</h3>
<p>Apache Commons Lang æ˜¯ä¸€ä¸ªç”¨äºæä¾›å¸¸ç”¨ Java å·¥å…·ç±»çš„å¼€æºåº“ï¼Œå®ƒä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥ç®¡ç† CharSet çš„å®ä¾‹ã€‚CharSet æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œç”¨äºç®¡ç†å­—ç¬¦é›†ç¼–ç ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ Apache Commons Lang çš„å•ä¾‹æ¨¡å¼å®ç°ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CharSet</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">CharSet</span><span class="o">&gt;</span> <span class="n">INSTANCES</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">CharSet</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// private constructor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">CharSet</span> <span class="nf">getInstance</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">CharSet</span> <span class="n">instance</span> <span class="o">=</span> <span class="n">INSTANCES</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="kd">synchronized</span> <span class="o">(</span><span class="n">CharSet</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">instance</span> <span class="o">=</span> <span class="n">INSTANCES</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CharSet</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                    <span class="n">INSTANCES</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">instance</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// other methods
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒApache Commons Lang ä½¿ç”¨ä¸€ä¸ª ConcurrentHashMap æ¥ç¼“å­˜æ‰€æœ‰çš„ CharSet å®ä¾‹ï¼Œå¹¶åœ¨éœ€è¦è·å– CharSet å®ä¾‹æ—¶ä½¿ç”¨åŒé‡æ£€æŸ¥é”å®šæœºåˆ¶æ¥ç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åˆ›å»ºå®ä¾‹ã€‚</p>
<h3 id="apache-commons-pool">Apache Commons Pool</h3>
<p>Apache Commons Pool æ˜¯ä¸€ä¸ªç”¨äºç®¡ç†å¯¹è±¡æ± çš„å¼€æºåº“ï¼Œå®ƒä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥ç®¡ç† ObjectPool çš„å®ä¾‹ã€‚ObjectPool æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œç”¨äºç®¡ç†å¯é‡ç”¨å¯¹è±¡çš„æ± ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ Apache Commons Pool çš„å•ä¾‹æ¨¡å¼å®ç°ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GenericObjectPool</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">ObjectPool</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">ObjectPool</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">INSTANCES</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">GenericObjectPool</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// private constructor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">synchronized</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">ObjectPool</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">getInstance</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">PooledObjectFactory</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">factory</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ObjectPool</span><span class="o">&lt;?&gt;</span> <span class="n">instance</span> <span class="o">=</span> <span class="n">INSTANCES</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GenericObjectPool</span><span class="o">&lt;&gt;(</span><span class="n">factory</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">INSTANCES</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">instance</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="o">(</span><span class="n">ObjectPool</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;)</span> <span class="n">instance</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// other methods
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒApache Commons Pool ä½¿ç”¨ä¸€ä¸ª ConcurrentHashMap æ¥ç¼“å­˜æ‰€æœ‰çš„ ObjectPool å®ä¾‹ï¼Œå¹¶åœ¨éœ€è¦è·å– ObjectPool å®ä¾‹æ—¶ä½¿ç”¨ synchronized æ–¹æ³•æ¥ç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åˆ›å»ºå®ä¾‹ã€‚</p>
<h3 id="tomcat">Tomcat</h3>
<p>Tomcat æ˜¯ä¸€ä¸ªç”¨äºè¿è¡Œ Java Web åº”ç”¨ç¨‹åºçš„å¼€æºæœåŠ¡å™¨ï¼Œå®ƒä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥ç®¡ç† ServletContext çš„å®ä¾‹ã€‚ServletContext æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œç”¨äºç®¡ç† Web åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ Tomcat çš„å•ä¾‹æ¨¡å¼å®ç°ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ApplicationContext</span> <span class="kd">extends</span> <span class="n">StandardContext</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">ApplicationContext</span><span class="o">&gt;</span> <span class="n">INSTANCES</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">ApplicationContext</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// private constructor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">ApplicationContext</span> <span class="nf">getInstance</span><span class="o">(</span><span class="n">String</span> <span class="n">contextPath</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ApplicationContext</span> <span class="n">instance</span> <span class="o">=</span> <span class="n">INSTANCES</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">contextPath</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="kd">synchronized</span> <span class="o">(</span><span class="n">ApplicationContext</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">instance</span> <span class="o">=</span> <span class="n">INSTANCES</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">contextPath</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ApplicationContext</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                    <span class="n">instance</span><span class="o">.</span><span class="na">setPath</span><span class="o">(</span><span class="n">contextPath</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                    <span class="n">INSTANCES</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">contextPath</span><span class="o">,</span> <span class="n">instance</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// other methods
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒTomcat ä½¿ç”¨ä¸€ä¸ª ConcurrentHashMap æ¥ç¼“å­˜æ‰€æœ‰çš„ ServletContext å®ä¾‹ï¼Œå¹¶åœ¨éœ€è¦è·å– ServletContext å®ä¾‹æ—¶ä½¿ç”¨åŒé‡æ£€æŸ¥é”å®šæœºåˆ¶æ¥ç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åˆ›å»ºå®ä¾‹ã€‚</p>
<h3 id="okhttp">OkHttp</h3>
<p>OkHttp æ˜¯ä¸€ä¸ªç”¨äºè¿›è¡Œç½‘ç»œè¯·æ±‚çš„å¼€æºæ¡†æ¶ï¼Œå®ƒä½¿ç”¨å•ä¾‹æ¨¡å¼æ¥ç®¡ç† OkHttpClient çš„å®ä¾‹ã€‚OkHttpClient æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»ï¼Œç”¨äºç®¡ç†ç½‘ç»œè¯·æ±‚çš„é…ç½®å’Œæ‰§è¡Œã€‚</p>
<p>ä»¥ä¸‹æ˜¯ OkHttp çš„å•ä¾‹æ¨¡å¼å®ç°ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OkHttpClient</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">OkHttpClient</span><span class="o">&gt;</span> <span class="n">INSTANCES</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">OkHttpClient</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// private constructor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">synchronized</span> <span class="n">OkHttpClient</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">String</span> <span class="n">key</span> <span class="o">=</span> <span class="s">&#34;default&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">OkHttpClient</span> <span class="n">instance</span> <span class="o">=</span> <span class="n">INSTANCES</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OkHttpClient</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">                    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="n">INSTANCES</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">instance</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// other methods
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼ŒOkHttp ä½¿ç”¨ä¸€ä¸ª ConcurrentHashMap æ¥ç¼“å­˜æ‰€æœ‰çš„ OkHttpClient å®ä¾‹ï¼Œå¹¶åœ¨éœ€è¦è·å– OkHttpClient å®ä¾‹æ—¶ä½¿ç”¨ synchronized æ–¹æ³•æ¥ç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥åˆ›å»ºå®ä¾‹ã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>å‘¨æŠ¥-13ï½œå¥èº«ã€è®°è´¦ã€æ›´æ–°SSLè¯ä¹¦ã€ä»£ç æäº¤ç™¾åº¦ç«™ç‚¹æ”¶å½•</title>
      <link>https://blog.chensoul.com/posts/2023/04/04/weekly_review_13/</link>
      <pubDate>Tue, 04 Apr 2023 15:40:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/04/04/weekly_review_13/</guid>
      <description>å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-03-27 åˆ° 2023-04-02 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚ æœ¬å‘¨æ˜¯ä¸‰æœˆçš„æœ€åä¸€å‘¨ï¼Œæƒ³åˆ°è¿™ï¼Œå°±æƒ³å¯¹éšä¾¿å¯¹ä¸‰æœˆä»½</description>
      <content:encoded><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-13-01.jpeg" alt="weekly-review-13-01"  />
</p>
<p>æœ¬ç¯‡æ˜¯å¯¹ <code>2023-03-27</code> åˆ° <code>2023-04-02</code> è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº <a href="https://blog.chensoul.com/">åšå®¢</a>ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚</p>
<p>æœ¬å‘¨æ˜¯ä¸‰æœˆçš„æœ€åä¸€å‘¨ï¼Œæƒ³åˆ°è¿™ï¼Œå°±æƒ³å¯¹éšä¾¿å¯¹ä¸‰æœˆä»½åšä¸ªæ€»ç»“ã€‚æ€»ç»“çš„æ–¹é¢ï¼Œå¤§æ¦‚åŒ…æ‹¬å·¥ä½œã€ç”Ÿæ´»ã€å­¦ä¹ ã€å¥èº«ã€è´¢åŠ¡ã€å¨±ä¹å‡ ä¸ªæ–¹é¢ã€‚ä¸‡äº‹å¼€å¤´éš¾ï¼Œä¸çŸ¥é“èƒ½è€…å¤šå°‘ï¼Œä½†æ˜¯ï¼Œç›¸ä¿¡ä¸ç®¡å†™å¤šå°‘ï¼Œéƒ½æ˜¯æœ‰æ„ä¹‰çš„ã€‚</p>
<p>å…ˆæ¥è¯´è¯´æœ€è¿‘ä¸€å‘¨åšäº†ä»€ä¹ˆã€‚æŸ¥çœ‹ä¸€ä¸‹ gitlab ä¸Šæ ‡ç­¾æäº¤è®°å½•ï¼Œè¿™å‘¨å‘å¸ƒäº†ä¸€ä¸ªç‰ˆæœ¬ï¼Œå…¶ä½™æ—¶é—´æ˜¯è¿›è¡Œæµ‹è¯•ï¼Œä¸ºä¸‹å‘¨å‘å¸ƒåšå‡†å¤‡ã€‚åœ¨å·¥ä½œä¹‹ä½™ï¼Œå¼€å§‹å­¦ä¹ ã€ŠEffective Java 3ã€‹ï¼Œå¹¶ç”¨ chatgpt ä½œä¸ºè¾…åŠ©å·¥ä½œï¼ŒåŠ æ·±å¯¹æŠ€æœ¯çš„ç†è§£ã€‚å¦å¤–ï¼Œæœ‰äº†æƒ³å­¦ä¹  Reactã€Rustã€Goã€Pyhon çš„æƒ³æ³•ã€‚æƒ³å­¦çš„ä¸œè¥¿æœ‰ç‚¹å¤šï¼Œåªèƒ½ä¸€æ­¥æ­¥æ¥ã€‚äº‰å–æ¯å¤©åˆ©ç”¨ä¸‹ç­ä¹‹åçš„ä¸€ä¸ªå°æ—¶è¿›è¡Œç¢ç‰‡åŒ–çš„å­¦ä¹ ï¼Œå¹¶ä¸”åšå¥½ç›¸å…³ç¬”è®°ï¼Œå¦‚æœ‰å¯èƒ½å‘å¸ƒåœ¨è¿™ä¸ªåšå®¢ä¸Šé¢ã€‚åŠ æ²¹ï¼</p>
<p>è¿™å‘¨å®Œæˆäº†æ¯å¤©ä¸€ä¸‡æ­¥çš„è®¡åˆ’ï¼Œå…¶ä¸­å‘¨æœ«èµ°äº† 3 ä¸‡å¤šæ­¥ï¼Œå¹¶ä¸”è¿˜å¼€å§‹äº†è·‘æ­¥ã€‚</p>
<h2 id="å…³äºå¥èº«">å…³äºå¥èº«</h2>
<p>å®Œæˆäº†æ¯å¤©ä¸€ä¸‡æ­¥çš„è®¡åˆ’ï¼Œå¹¶ä¸”å…±è·‘æ­¥ 8 æ¬¡ï¼Œä¸€å…± 26 å…¬é‡Œï¼Œæœ€é«˜å¹³å‡é…é€Ÿ 7 åˆ†é’Ÿï¼Œè¿˜è·³ç»³ä¸€æ¬¡ï¼ˆ550 ä¸‹ï¼‰ã€‚</p>
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-13-03.jpeg" alt="weekly-review-13-03" style="width:50%;" />
<p>è·‘æ­¥çš„ç›®çš„ä¸æ˜¯å¿«ï¼Œè€Œæ˜¯ä¹æ­¤ä¸ç–²ã€‚æ¯å¤©è·‘æ­¥ 5 å…¬é‡Œï¼Œæ¯æ¬¡æ¶ˆè€— 300 å¡è·¯é‡Œçš„çƒ­é‡ï¼Œå¤§æ¦‚éœ€è¦ 10 å‘¨æ‰èƒ½ç˜¦ 10 æ–¤ã€‚</p>
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-13-02.jpeg" alt="weekly-review-13-02" style="width:50%;" />
<p>å…‰é èµ°è·¯å’Œè·‘æ­¥ï¼Œæƒ³åœ¨ 4 æœˆå®Œæˆç˜¦ 10 æ–¤çš„ç›®æ ‡ï¼Œåº”è¯¥æ˜¯ä¸å¯èƒ½çš„ï¼Œæ‰“ç®—è¾…åŠ©é—´æ­‡æ€§æ–­é£Ÿï¼Œçœ‹ä¸‹æ•ˆæœã€‚</p>
<blockquote>
<p>è·‘æ­¥æ˜¯ä¸€ç§æœ‰æ°§è¿åŠ¨ï¼Œå¯ä»¥ä¿ƒè¿›èº«ä½“ä»£è°¢ï¼Œæ¶ˆè€—ä½“å†…çš„è„‚è‚ªå’Œçƒ­é‡ï¼Œè¾¾åˆ°å‡è‚¥çš„æ•ˆæœã€‚ä½†æ˜¯å‡è‚¥çš„æ•ˆæœå—åˆ°å¾ˆå¤šå› ç´ çš„å½±å“ï¼Œå¦‚ä¸ªäººçš„ä½“é‡ã€èº«é«˜ã€å¹´é¾„ã€æ€§åˆ«ã€é¥®é£Ÿä¹ æƒ¯ã€è·‘æ­¥å¼ºåº¦ã€é¢‘ç‡å’Œæ—¶é•¿ç­‰ã€‚</p>
<p>é€šå¸¸æ¥è¯´ï¼Œå‡è‚¥çš„åŸºæœ¬åŸç†æ˜¯æ¶ˆè€—æ›´å¤šçš„çƒ­é‡ï¼Œä»è€Œè¾¾åˆ°ä½“é‡å‡è½»çš„æ•ˆæœã€‚æ¯å¤©è·‘æ­¥ 5 å…¬é‡Œçš„è¿åŠ¨é‡ç›¸å¯¹è¾ƒå°ï¼Œä¸€èˆ¬åœ¨ä¸€ä¸ªå°æ—¶å·¦å³å¯ä»¥å®Œæˆã€‚å¦‚æœæ¯å¤©åšæŒè·‘æ­¥ï¼ŒåŒæ—¶æ³¨æ„é¥®é£Ÿæ§åˆ¶ï¼Œå¢åŠ å…¶ä»–æœ‰æ°§è¿åŠ¨å’Œåˆç†çš„ä¼‘æ¯ï¼Œå¯èƒ½ä¼šåœ¨å‡ ä¸ªæœˆå†…çœ‹åˆ°ä¸€å®šçš„å‡è‚¥æ•ˆæœã€‚</p>
<p>æ ¹æ®ä¸€èˆ¬çš„å‡è‚¥ç»éªŒï¼Œæ¯æ¶ˆè€— 3500 å¡è·¯é‡Œçš„çƒ­é‡å°±å¯ä»¥å‡å°‘ä¸€æ–¤ä½“é‡ã€‚å‡è®¾æ¯æ¬¡è·‘æ­¥æ¶ˆè€— 300 å¡è·¯é‡Œçš„çƒ­é‡ï¼Œé‚£ä¹ˆæ¯å¤©è·‘æ­¥ 5 å…¬é‡Œçº¦æ¶ˆè€— 300 ~ 400 å¡è·¯é‡Œçš„çƒ­é‡ã€‚å¦‚æœæ¯å¤©åšæŒè·‘æ­¥ï¼Œå¹¶ä¸”ä¿æŒæ¯å¤©æ¶ˆè€— 300 ~ 400 å¡è·¯é‡Œçš„çƒ­é‡ï¼Œé‚£ä¹ˆå¤§çº¦éœ€è¦ 10 å‘¨æ—¶é—´æ‰èƒ½å‡å°‘ 10 æ–¤ä½“é‡ã€‚</p>
</blockquote>
<h2 id="å…³äºè®°è´¦">å…³äºè®°è´¦</h2>
<p>ä¸Šå‘¨å¼€å§‹ï¼Œåœ¨å¯»æ‰¾ä¸€ä¸ªè®°è´¦çš„ APPï¼Œæƒ³å¼€å§‹è®°å½•æ¯å¤©çš„æ”¶å…¥ä¸æ”¯å‡ºã€‚å½“ç„¶ï¼Œæ›´å¤šçš„åº”è¯¥æ˜¯æ”¯å‡ºäº†ã€‚ç°åœ¨ï¼Œå¤§ç¯å¢ƒä¸è¡Œï¼Œå…¬å¸è£å‘˜ä¸åœï¼Œå¿…é¡»è¦å¼€æºèŠ‚æµï¼Œæ‰‹ä¸Šå‚¨å¤‡è¶³å¤Ÿçš„ç°é‡‘ã€‚</p>
<p>æ‰¾æ¥æ‰¾å»ï¼Œå‘ç°å¾®ä¿¡é‡Œæ²¡æœ‰æœ‰ä¸ªã€å¾®ä¿¡è®°è´¦æœ¬ã€å°ç¨‹åºå°±å¯ä»¥åœ¨å¾®ä¿¡é‡Œè‡ªåŠ¨è®°è´¦ï¼Œä¹Ÿæ”¯æŒæ‰‹åŠ¨è®°è´¦ã€‚äºæ˜¯ï¼Œè¿™å‘¨è¯•äº†ä¸€ä¸‹è¿™ä¸ªå°ç¨‹åºï¼Œå¹¶æœ‰æ„çš„æ§åˆ¶è‡ªå·±æ¯å¤©çš„è¾“å‡ºã€‚å› ä¸ºæ¯å¤©éƒ½æœ‰å¸¦é¥­ï¼Œè¿™æ ·ä¸­é¥­å°±ä¸ç”¨èŠ±é’±äº†ï¼›æ—©é¤å‘¢ï¼Œæ˜¯æ³¡ä¹‹å‰ä¹°çš„é»‘èŠéº»ç³Šå–ï¼Œçœå»äº†æ—©é¤è´¹ç”¨ã€‚ç»“æœæ˜¯ï¼Œè¿™å‘¨çš„æ”¯å‡ºåªæœ‰ 4.5 å…ƒã€‚ä¸€æ¬¡æ˜¯æ—©ä¸Šä¹°äº†ä¸€æœ¬è±†æµ†ï¼Œä¸€æ¬¡æ˜¯æ—©ä¸Šè·‘æ­¥æ€•è¿Ÿåˆ°å°±éª‘äº†ä¸€æ¬¡åŠ¨æ„Ÿå•è½¦ã€‚</p>
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-13-05.jpeg" alt="weekly-review-13-05" style="width:50%;" />
<p>æ­£å¥½ä¸‰æœˆç»“æŸäº†ï¼ŒæŸ¥çœ‹äº†ä¸€ä¸‹ä¸‰æœˆçš„æ”¯å‡ºæŠ¥è¡¨ã€‚æ€»çš„æ¥è¯´ï¼Œä¸‰æœˆæ”¯å‡ºçš„æœ‰ç‚¹å¤šï¼Œè¶…ä¹äº†æˆ‘çš„æƒ³è±¡ã€‚å¦‚æœæ¯ä¸ªæœˆéƒ½æ˜¯æ”¯å‡ºè¿™ä¹ˆå¤šï¼Œé‚£ä»¥åçš„é›¶èŠ±é’±å°±ä¸å¤Ÿç”¨äº†ã€‚è¿˜æ˜¯è¦å‹’ç´§è£¤è…°å¸¦è¿‡æ—¥å­å•Šã€‚</p>
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-13-04.jpeg" alt="weekly-review-13-04" style="width:50%;" />
<h2 id="æ›´æ–°-ssl-è¯ä¹¦">æ›´æ–° SSL è¯ä¹¦</h2>
<p>å®‰è£… acme.sh</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl https://get.acme.sh <span class="p">|</span> sh -s <span class="nv">email</span><span class="o">=</span>chensoul.eth@gmail.com
</span></span></code></pre></div><p><strong>æˆ‘çš„åŸŸåæ‰˜ç®¡åœ¨cloudflare</strong>ï¼Œæ•…éœ€è¦è·å– <a href="https://dash.cloudflare.com/profile/api-tokens">cloudflare API key</a>ï¼Œåœ¨ <code>API ä»¤ç‰Œ</code> é¡µé¢ï¼Œç‚¹å‡»æŸ¥çœ‹ <code>Global API Key</code>ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-13-06.png" alt="weekly-review-13-06"  />
</p>
<p>ä¿å­˜ <code>CF_Key</code> å’Œ <code>CF_Email</code>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CF_Key</span><span class="o">=</span><span class="s2">&#34;cloudflare ä¸­æŸ¥çœ‹ä½ çš„ key&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CF_Email</span><span class="o">=</span><span class="s2">&#34;chensoul.eth@gmail.com&#34;</span>
</span></span></code></pre></div><p>ç”Ÿæˆè¯ä¹¦ï¼Œå¹¶é‡å¯ nginxï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">acme.sh --issue -d <span class="s2">&#34;chensoul.com&#34;</span> -d <span class="s2">&#34;*.chensoul.com&#34;</span> --dns dns_cf <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>--cert-file      /usr/local/nginx/ssl/chensoul.com.cer  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>--key-file       /usr/local/nginx/ssl/chensoul.com.key  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>--fullchain-file /usr/local/nginx/ssl/fullchain.cer <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>--reloadcmd <span class="s2">&#34;nginx -s reload&#34;</span>
</span></span></code></pre></div><p>ç§»é™¤åŸŸåè¯ä¹¦è‡ªåŠ¨æ›´æ–°</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">acme.sh --remove -d chensoul.com -d <span class="s2">&#34;*.chensoul.com&#34;</span>
</span></span></code></pre></div><h2 id="ç™¾åº¦ç«™ç‚¹æ”¶å½•">ç™¾åº¦ç«™ç‚¹æ”¶å½•</h2>
<p>å‚è€ƒ <a href="https://ifttl.com/push-urls-to-baidu/">å‘ç™¾åº¦ä¸»åŠ¨æ¨é€ç½‘ç«™é“¾æ¥</a> ä½¿ç”¨è„šæœ¬å®šæ—¶æ¨é€ç½‘ç«™é“¾æ¥åˆ°ç™¾åº¦ç«™ç‚¹ã€‚å¯¹ <code>push_to_baidu.sh</code> è„šæœ¬çš„  parse æ–¹æ³•åšäº†å¦‚ä¸‹ä¿®æ”¹ï¼Œä»¥è§£å†³ <code>xmllint è§£æå¸¦æœ‰å‘½åç©ºé—´çš„ xml æ–‡ä»¶æŠ¥é”™</code> çš„é—®é¢˜ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="k">function</span> parse <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">local</span> <span class="nv">file</span><span class="o">=</span><span class="nv">$1</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="nv">$file</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$XMLLINT</span> --format --xpath <span class="s2">&#34;//*[local-name()=&#39;loc&#39; and namespace-uri()=&#39;http://www.sitemaps.org/schemas/sitemap/0.9&#39;]/text()&#34;</span> <span class="s2">&#34;</span><span class="nv">$file</span><span class="s2">&#34;</span> <span class="p">|</span> sed -e <span class="s1">&#39;s/https/\nhttps/g&#39;</span> &gt; <span class="s2">&#34;</span><span class="nv">$URL_TEMP</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="nv">$URL_TEMP</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h2 id="å·¥ä½œ">å·¥ä½œ</h2>
<h3 id="effective-java-3-ç¬”è®°">Effective Java 3 ç¬”è®°</h3>
<p>è¯·å‚è€ƒ <a href="/posts/2023/04/03/builder-instead-of-constructors/">ã€ŠEffective Java 3ã€‹ç¬”è®°ï¼šä½¿ç”¨æ„é€ å™¨ä»£æ›¿æ„é€ å‡½æ•°</a></p>
<h3 id="rust">Rust</h3>
<p>å› ä¸ºå¯¹ <a href="https://tauri.app/">Tauri</a> è¿™ä¸ª GUI æ¡†æ¶æŒºæ„Ÿå…´è¶£ï¼Œæ‰€ä»¥æˆ‘å¼€å§‹å­¦ä¹  Rust äº†ï¼Œç›®å‰åœ¨å‚è€ƒ <a href="https://rustwiki.org/">https://rustwiki.org/</a> ä¸Šçš„ <a href="https://rustwiki.org/zh-CN/rust-by-example/">é€šè¿‡ä¾‹å­å­¦ Rust</a> å’Œ <a href="https://rustwiki.org/zh-CN/book/">Rust ç¨‹åºè®¾è®¡è¯­è¨€</a> å­¦ä¹  Rustã€‚</p>
<h2 id="å¥½ç‰©åˆ†äº«">å¥½ç‰©åˆ†äº«</h2>
<p>è™½ç„¶å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€<a href="https://t.me/chensoul_share">ChenSoul Share</a>ã€Telegram é¢‘é“ï¼Œä¸è¿‡è¿˜æ˜¯æŒ‘é€‰ä¸€éƒ¨åˆ†åœ¨è¿™é‡Œåˆ—ä¸¾ä¸€ä¸‹ï¼Œæ„Ÿè§‰æ›´åƒä¸€ä¸ª newsletter äº†ã€‚</p>
<h3 id="ä¸€äº›æ–‡ç« ">ä¸€äº›æ–‡ç« </h3>
<ul>
<li>
<p><a href="https://www.lijiaocn.com/%E7%BC%96%E7%A8%8B/2023/03/28/go-wasm-usage.html">Go wasm ä½¿ç”¨ï¼šGo ä»£ç ç¼–è¯‘æˆ WebAssembly åŠè°ƒç”¨</a></p>
</li>
<li>
<p><a href="https://ourai.ws/posts/what-i-have-done-in-2023-q1/">å¤±ä¸šä¸‰ä¸ªæœˆï¼Œæˆ‘éƒ½å¹²äº†å•¥ï¼Ÿ</a></p>
</li>
<li>
<p><a href="https://www.bboy.app/2023/04/04/%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8Bgitea%E7%9A%84action/">ä»‹ç»ä¸€ä¸‹giteaçš„action</a></p>
</li>
<li>
<p><a href="https://blog.p2hp.com/archives/10711">ä½œä¸ºç»å¯¹åˆå­¦è€…å­¦ä¹  Web å¼€å‘</a></p>
</li>
</ul>
<h3 id="ä¸€äº›å·¥å…·">ä¸€äº›å·¥å…·</h3>
<ul>
<li>
<p>æ•°æ®ç»Ÿè®¡åˆ†æï¼š<a href="https://usefathom.com/">https://usefathom.com</a></p>
</li>
<li>
<p>Cloudflare å›¾åºŠï¼š<a href="https://www.cloudflare.com/zh-cn/products/cloudflare-images/">Cloudflare Images</a></p>
</li>
<li>
<p>Java å•å…ƒæµ‹è¯•æ’ä»¶ï¼š<a href="https://squaretest.com/">Squaretest for IntelliJ IDEA</a></p>
</li>
<li>
<p>åŸºäºæ ‡è®°çš„ç§‘å­¦æ’ç‰ˆç³»ç»Ÿï¼š<a href="https://typst.app/">Typst</a>ã€‚å¯ä»¥ååŒå·¥ä½œï¼Œä¸”ç•Œé¢æ›´å‹å¥½ã€‚æ—¨åœ¨æˆä¸º LaTeXã€Word å’Œ Google Docs ç­‰çš„æ›¿ä»£å“ã€‚</p>
</li>
<li>
<p>æ•°æ®å¯è§†åŒ–èµ„æºåº“ï¼š<a href="https://vis.zone/lib/">https://vis.zone/lib/</a>ã€‚ç½‘ç«™æä¾›éå¸¸å…¨é¢çš„å¯è§†åŒ–å›¾è¡¨ç±»å‹ä¾›å‚è€ƒï¼Œè¿˜æ”¶é›†äº†å¾ˆå¤šå®ç°å¯è§†åŒ–çš„ä»£ç ã€å·¥å…·ã€è¯¾ç¨‹ã€ä¹¦ç±ã€‚</p>
</li>
<li>
<p>ä¸€ä¸ªå…è´¹çš„ chatgpt åœ¨çº¿ webï¼šhttps://chatbot.theb.ai/#/chat/1002</p>
</li>
</ul>
<h3 id="ä¸€äº›è§†é¢‘">ä¸€äº›è§†é¢‘</h3>
<p>ä»¥ä¸‹æ˜¯æœ€è¿‘åœ¨çœ‹çš„ç”µè§†ã€åŠ¨ç”»ç‰‡</p>
<p>-ã€Šé£šé€Ÿå®…ç”·ã€‹ç¬¬äº”å­£ã€‚ä¸€ç¾¤é«˜ä¸­ç”Ÿéª‘è‡ªè¡Œè½¦çš„çƒ­è¡€æ•…äº‹ã€‚</p>
<p>-ã€Šæ½˜å¤šæ‹‰ä¼ªé€ çš„ä¹å›­ã€‹ã€‚æ­¤å‰§è®²è¿°äº†ä¸€åæ‹¥æœ‰ä»¤äººç§°ç¾¡ç”Ÿæ´»çš„å¥³å­åœ¨æ¢å¤è¿‡å¾€çš„è®°å¿†åï¼Œä¸ºä¿æŠ¤è‡ªå·±å’Œå®¶äººå¯¹éšæ„æ“çºµè‡ªå·±å‘½è¿çš„äººå±•å¼€æŠ¥å¤çš„æ•…äº‹</p>
<p>ä»¥ä¸Šã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>ã€ŠEffective Java 3ã€‹ç¬”è®°2ï¼šä½¿ç”¨æ„é€ å™¨ä»£æ›¿æ„é€ æ–¹æ³•</title>
      <link>https://blog.chensoul.com/posts/2023/04/03/builder-instead-of-constructors/</link>
      <pubDate>Mon, 03 Apr 2023 16:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/04/03/builder-instead-of-constructors/</guid>
      <description>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼Œåœ¨æ•´ç†ç¬”è®°è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ chatgpt çš„å¸®åŠ©åšäº†ä¸€äº›æ‰©å±•ã€‚ ä»‹ç» å½“ä¸€ä¸ªç±»éœ€è¦å¤šä¸ªæ„é€ å‡½æ•°å‚æ•°æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿</description>
      <content:encoded><![CDATA[<p>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼Œåœ¨æ•´ç†ç¬”è®°è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ chatgpt çš„å¸®åŠ©åšäº†ä¸€äº›æ‰©å±•ã€‚</p>
<h2 id="ä»‹ç»">ä»‹ç»</h2>
<p>å½“ä¸€ä¸ªç±»éœ€è¦å¤šä¸ªæ„é€ å‡½æ•°å‚æ•°æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨<strong>æ„å»ºå™¨æ¨¡å¼</strong>æ¥åˆ›å»ºå¯¹è±¡ã€‚æ„å»ºå™¨æ¨¡å¼æ˜¯ä¸€ç§åˆ›å»ºå¯¹è±¡çš„è®¾è®¡æ¨¡å¼ï¼Œå®ƒå¯ä»¥é€šè¿‡é“¾å¼è°ƒç”¨æ–¹æ³•çš„æ–¹å¼æ¥è®¾ç½®å¯¹è±¡çš„æ„é€ å‚æ•°ï¼Œå¹¶æœ€ç»ˆè¿”å›ä¸€ä¸ªæ„é€ å®Œæ•´çš„å¯¹è±¡ã€‚</p>
<h2 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h2>
<p>ä½¿ç”¨æ„å»ºå™¨æ¨¡å¼çš„åŸå› æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li>é¿å…æ„é€ å‡½æ•°å‚æ•°è¿‡å¤šçš„é—®é¢˜ï¼šå½“ä¸€ä¸ªç±»éœ€è¦å¤šä¸ªæ„é€ å‡½æ•°å‚æ•°æ—¶ï¼Œæ„é€ å‡½æ•°çš„å‚æ•°åˆ—è¡¨å¯èƒ½ä¼šå˜å¾—å¾ˆé•¿ï¼Œè¿™ä¼šå¯¼è‡´ä»£ç éš¾ä»¥ç†è§£å’Œç»´æŠ¤ã€‚ä½¿ç”¨æ„å»ºå™¨æ¨¡å¼å¯ä»¥å°†æ„é€ å‡½æ•°å‚æ•°æ‹†åˆ†æˆå¤šä¸ªæ–¹æ³•ï¼Œä»è€Œä½¿ä»£ç æ›´åŠ æ¸…æ™°æ˜“æ‡‚ã€‚</li>
<li>æé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼šä½¿ç”¨æ„å»ºå™¨æ¨¡å¼å¯ä»¥ä½¿ä»£ç æ›´åŠ æ˜“æ‡‚å’Œæ˜“ç»´æŠ¤ï¼Œå› ä¸ºå¯ä»¥é€šè¿‡æ–¹æ³•åæ¥æ¸…æ™°åœ°è¡¨è¾¾æ¯ä¸ªå‚æ•°çš„å«ä¹‰ã€‚</li>
<li>æä¾›æ›´å¤šçš„çµæ´»æ€§å’Œå¯å®šåˆ¶æ€§ï¼šæ„å»ºå™¨æ¨¡å¼å¯ä»¥æä¾›æ›´å¤šçš„çµæ´»æ€§å’Œå¯å®šåˆ¶æ€§ï¼Œå› ä¸ºå¯ä»¥åœ¨æ„é€ å¯¹è±¡æ—¶è¿›è¡Œæ›´å¤šçš„é€»è¾‘å¤„ç†å’Œåˆ¤æ–­ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨æ„å»ºå™¨ä¸­æ·»åŠ éªŒè¯é€»è¾‘ï¼Œä»¥ç¡®ä¿å‚æ•°çš„æœ‰æ•ˆæ€§ã€‚</li>
<li>æ”¯æŒå¤šçº¿ç¨‹ç¯å¢ƒï¼šæ„å»ºå™¨æ¨¡å¼å¯ä»¥æ”¯æŒå¤šçº¿ç¨‹ç¯å¢ƒï¼Œå› ä¸ºæ¯ä¸ªæ„å»ºå™¨éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¼šå—åˆ°å…¶ä»–çº¿ç¨‹çš„å½±å“ã€‚</li>
</ol>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NutritionFacts</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">servingSize</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">servings</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">calories</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">fat</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">sodium</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">carbohydrate</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">NutritionFacts</span><span class="o">(</span><span class="n">Builder</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">servingSize</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">servingSize</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">servings</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">servings</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">calories</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">calories</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">fat</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">fat</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">sodium</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">sodium</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">carbohydrate</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">carbohydrate</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//çœç•¥ get set
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Builder</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Required parameters
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">servingSize</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">servings</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// Optional parameters - initialized to default values
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kd">private</span> <span class="kt">int</span> <span class="n">calories</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="kt">int</span> <span class="n">fat</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="kt">int</span> <span class="n">sodium</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="kt">int</span> <span class="n">carbohydrate</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="nf">Builder</span><span class="o">(</span><span class="kt">int</span> <span class="n">servingSize</span><span class="o">,</span> <span class="kt">int</span> <span class="n">servings</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">servingSize</span> <span class="o">=</span> <span class="n">servingSize</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">servings</span> <span class="o">=</span> <span class="n">servings</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">Builder</span> <span class="nf">calories</span><span class="o">(</span><span class="kt">int</span> <span class="n">calories</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">calories</span> <span class="o">=</span> <span class="n">calories</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">Builder</span> <span class="nf">fat</span><span class="o">(</span><span class="kt">int</span> <span class="n">fat</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">fat</span> <span class="o">=</span> <span class="n">fat</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">Builder</span> <span class="nf">sodium</span><span class="o">(</span><span class="kt">int</span> <span class="n">sodium</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">sodium</span> <span class="o">=</span> <span class="n">sodium</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">Builder</span> <span class="nf">carbohydrate</span><span class="o">(</span><span class="kt">int</span> <span class="n">carbohydrate</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">carbohydrate</span> <span class="o">=</span> <span class="n">carbohydrate</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">NutritionFacts</span> <span class="nf">build</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">new</span> <span class="n">NutritionFacts</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸º NutritionFacts çš„ç±»ï¼Œå®ƒåŒ…å«äº†ä¸€äº›è¥å…»æˆåˆ†çš„ä¿¡æ¯ï¼Œä¾‹å¦‚æ¯ä»½çš„å¤§å°ã€æ€»ä»½æ•°ã€å¡è·¯é‡Œã€è„‚è‚ªã€é’ å’Œç¢³æ°´åŒ–åˆç‰©ç­‰æˆå‘˜å˜é‡ã€‚æˆ‘ä»¬è¿˜å®šä¹‰äº†ä¸€ä¸ªåä¸º Builder çš„é™æ€å†…éƒ¨ç±»ï¼Œç”¨äºæ„å»º NutritionFacts å¯¹è±¡ã€‚</p>
<p>åœ¨ Builder ç±»ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå¸¦æœ‰ä¸¤ä¸ªå‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œå¹¶åœ¨å…¶ä¸­åˆå§‹åŒ–äº†å¿…éœ€çš„æˆå‘˜å˜é‡ servingSize å’Œ servingsã€‚æˆ‘ä»¬è¿˜å®šä¹‰äº†ä¸€äº›å¯é€‰çš„æ–¹æ³•ï¼Œç”¨äºè®¾ç½® NutritionFacts å¯¹è±¡çš„å¡è·¯é‡Œã€è„‚è‚ªã€é’ å’Œç¢³æ°´åŒ–åˆç‰©ç­‰æˆå‘˜å˜é‡ã€‚è¿™äº›æ–¹æ³•éƒ½æ”¯æŒé“¾å¼è°ƒç”¨ï¼Œå¹¶è¿”å› Builder å¯¹è±¡æœ¬èº«ï¼Œä»¥ä¾¿è¿›è¡Œå¤šæ¬¡æ–¹æ³•è°ƒç”¨ã€‚</p>
<p>åœ¨ Builder ç±»ä¸­ï¼Œæˆ‘ä»¬æœ€ç»ˆå®šä¹‰äº†ä¸€ä¸ª build() æ–¹æ³•ï¼Œç”¨äºåˆ›å»º NutritionFacts å¯¹è±¡å¹¶è¿”å›ã€‚åœ¨ build() æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨ NutritionFacts çš„ç§æœ‰æ„é€ å™¨å¹¶å°† Builder å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’è¿›å»ï¼Œä»è€Œåˆ›å»º NutritionFacts å¯¹è±¡å¹¶åˆå§‹åŒ–å…¶æˆå‘˜å˜é‡ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ NutritionFacts.Builder ç±»æ¥åˆ›å»º NutritionFacts å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨é“¾å¼è°ƒç”¨æ¥è®¾ç½® NutritionFacts å¯¹è±¡çš„æˆå‘˜å˜é‡ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç æ¥åˆ›å»ºä¸€ä¸ªæ¯ä»½å¤§å°ä¸º 240mlã€æ€»å…±æœ‰ 8 ä»½ã€å¡è·¯é‡Œä¸º 100ã€è„‚è‚ªä¸º 2ã€é’ ä¸º 35ã€ç¢³æ°´åŒ–åˆç‰©ä¸º 27 çš„ NutritionFacts å¯¹è±¡ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">NutritionFacts</span> <span class="n">cocaCola</span> <span class="o">=</span> <span class="k">new</span> <span class="n">NutritionFacts</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">240</span><span class="o">,</span> <span class="n">8</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">calories</span><span class="o">(</span><span class="n">100</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">fat</span><span class="o">(</span><span class="n">2</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">sodium</span><span class="o">(</span><span class="n">35</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">carbohydrate</span><span class="o">(</span><span class="n">27</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span></code></pre></div><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª NutritionFacts.Builder å¯¹è±¡ï¼Œå¹¶åœ¨æ„é€ å‡½æ•°ä¸­ä¼ é€’äº†æ¯ä»½å¤§å°å’Œæ€»ä»½æ•°ç­‰å‚æ•°ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨é“¾å¼è°ƒç”¨æ¥è®¾ç½®å¡è·¯é‡Œã€è„‚è‚ªã€é’ å’Œç¢³æ°´åŒ–åˆç‰©ç­‰æˆå‘˜å˜é‡ï¼Œå¹¶æœ€ç»ˆè°ƒç”¨ build() æ–¹æ³•æ¥åˆ›å»º NutritionFacts å¯¹è±¡ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨ lombok æ³¨è§£æ¥ç®€åŒ–ä»£ç ï¼Œä½†æ˜¯ï¼Œ<strong>æ— æ³•åœ¨æ„é€ å™¨çš„æ„é€ æ–¹æ³•é‡Œè®¾ç½®å¿…è¦å‚æ•°ã€‚</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">lombok.Builder</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@Builder</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NutritionFacts</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">servingSize</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">servings</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">calories</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">fat</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">sodium</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">carbohydrate</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h2 id="ç¼ºç‚¹">ç¼ºç‚¹</h2>
<p>è™½ç„¶æ„å»ºå™¨æ¨¡å¼å¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€å¯ç»´æŠ¤æ€§ä»¥åŠæä¾›æ›´å¤šçš„çµæ´»æ€§å’Œå¯å®šåˆ¶æ€§ï¼Œä½†å®ƒä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ï¼ŒåŒ…æ‹¬ï¼š</p>
<ol>
<li>å¢åŠ ä»£ç å¤æ‚åº¦ï¼šä½¿ç”¨æ„å»ºå™¨æ¨¡å¼ä¼šå¢åŠ ä»£ç çš„å¤æ‚åº¦ï¼Œå› ä¸ºéœ€è¦åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„æ„å»ºå™¨ç±»ï¼Œå¹¶ä¸”éœ€è¦åœ¨æ„å»ºå™¨ç±»ä¸­å®šä¹‰å¤šä¸ªæ–¹æ³•æ¥è®¾ç½®å¯¹è±¡çš„å±æ€§ã€‚è¿™ä¼šå¢åŠ ä»£ç é‡å¹¶ä¸”éœ€è¦æ›´å¤šçš„æ—¶é—´æ¥ç¼–å†™å’Œç»´æŠ¤ä»£ç ã€‚</li>
<li>å¢åŠ å†…å­˜å¼€é”€ï¼šä½¿ç”¨æ„å»ºå™¨æ¨¡å¼éœ€è¦åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„æ„å»ºå™¨å¯¹è±¡ï¼Œå¹¶ä¸”éœ€è¦åœ¨æ„å»ºå™¨å¯¹è±¡ä¸­ä¿å­˜å¯¹è±¡çš„å±æ€§ã€‚è¿™ä¼šå¢åŠ å†…å­˜å¼€é”€ï¼Œå¹¶ä¸”åœ¨åˆ›å»ºå¯¹è±¡æ—¶éœ€è¦æ›´å¤šçš„æ—¶é—´å’Œèµ„æºã€‚</li>
<li>å¯¹äºç®€å•å¯¹è±¡ä¸é€‚ç”¨ï¼šæ„å»ºå™¨æ¨¡å¼æ›´é€‚ç”¨äºæ„é€ å¤æ‚å¯¹è±¡ï¼Œå¯¹äºç®€å•å¯¹è±¡æ¥è¯´ï¼Œä½¿ç”¨æ„å»ºå™¨æ¨¡å¼å¯èƒ½ä¼šå¢åŠ ä»£ç çš„å¤æ‚åº¦å’Œå¼€é”€ã€‚</li>
<li>éœ€è¦é¢å¤–çš„ä»£ç ï¼šä½¿ç”¨æ„å»ºå™¨æ¨¡å¼éœ€è¦ç¼–å†™é¢å¤–çš„ä»£ç æ¥åˆ›å»ºæ„å»ºå™¨ç±»å’Œå®šä¹‰æ–¹æ³•ã€‚å¦‚æœåªéœ€è¦æ„é€ ä¸€ä¸ªç®€å•çš„å¯¹è±¡ï¼Œä½¿ç”¨æ„å»ºå™¨æ¨¡å¼å¯èƒ½ä¼šæµªè´¹æ—¶é—´å’Œèµ„æºã€‚</li>
</ol>
<h2 id="å±‚æ¬¡æ„å»ºå™¨">å±‚æ¬¡æ„å»ºå™¨</h2>
<p>å±‚æ¬¡æ„å»ºå™¨ï¼ˆHierarchical Builderï¼‰æ˜¯ä¸€ç§æ„å»ºå™¨æ¨¡å¼çš„æ‰©å±•ï¼Œå®ƒå…è®¸åˆ›å»ºå±‚æ¬¡ç»“æ„çš„å¯¹è±¡ï¼Œå¹¶æ”¯æŒåœ¨çˆ¶å¯¹è±¡ä¸­åµŒå¥—å­å¯¹è±¡ã€‚å®ƒé€šå¸¸ç”±ä¸€ä¸ªæŠ½è±¡çš„æ„å»ºå™¨æ¥å£ï¼Œå¤šä¸ªå…·ä½“çš„æ„å»ºå™¨å®ç°å’Œä¸€ä¸ªæŒ‡å¯¼è€…ï¼ˆDirectorï¼‰ç»„æˆã€‚</p>
<p>åœ¨å±‚æ¬¡æ„å»ºå™¨ä¸­ï¼Œæ¯ä¸ªæ„å»ºå™¨éƒ½è´Ÿè´£åˆ›å»ºç‰¹å®šç±»å‹çš„å¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥åœ¨å…¶æ„å»ºæ–¹æ³•ä¸­è°ƒç”¨å…¶ä»–æ„å»ºå™¨çš„æ„å»ºæ–¹æ³•æ¥åˆ›å»ºåµŒå¥—çš„å­å¯¹è±¡ã€‚æŒ‡å¯¼è€…è´Ÿè´£åè°ƒæ„å»ºå™¨çš„é¡ºåºå’Œè°ƒç”¨æ„å»ºå™¨çš„æ–¹æ³•æ¥æ„å»ºå¯¹è±¡å±‚æ¬¡ç»“æ„ã€‚</p>
<p>å±‚æ¬¡æ„å»ºå™¨æ¨¡å¼çš„ä¼˜ç‚¹åŒ…æ‹¬ï¼š</p>
<ol>
<li>æ”¯æŒåˆ›å»ºå¤æ‚çš„å¯¹è±¡å±‚æ¬¡ç»“æ„ï¼Œèƒ½å¤Ÿæ„å»ºåŒ…å«å¤šä¸ªå±‚æ¬¡å’ŒåµŒå¥—å­å¯¹è±¡çš„å¯¹è±¡ã€‚</li>
<li>æä¾›äº†æ›´å¥½çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œå› ä¸ºæ¯ä¸ªæ„å»ºå™¨éƒ½åªéœ€è¦å…³æ³¨ä¸€ä¸ªç‰¹å®šç±»å‹çš„å¯¹è±¡ï¼Œè€Œä¸”å¯ä»¥é€šè¿‡æ–¹æ³•åæ¥æ¸…æ™°åœ°è¡¨è¾¾æ¯ä¸ªå‚æ•°çš„å«ä¹‰ã€‚</li>
<li>æä¾›äº†æ›´å¤šçš„çµæ´»æ€§å’Œå¯å®šåˆ¶æ€§ï¼Œå› ä¸ºå¯ä»¥åœ¨æ„å»ºå™¨ä¸­æ·»åŠ éªŒè¯é€»è¾‘ï¼Œä»¥ç¡®ä¿å‚æ•°çš„æœ‰æ•ˆæ€§ï¼Œå¹¶ä¸”å¯ä»¥åŠ¨æ€åœ°ç»„åˆæ„å»ºå™¨æ¥åˆ›å»ºä¸åŒç±»å‹çš„å¯¹è±¡ã€‚</li>
</ol>
<p>å±‚æ¬¡æ„å»ºå™¨æ¨¡å¼çš„ç¼ºç‚¹åŒ…æ‹¬ï¼š</p>
<ol>
<li>
<p>ä»£ç é‡ï¼šç”±äºå±‚æ¬¡æ„å»ºå™¨æ¨¡å¼éœ€è¦å®šä¹‰å¤šä¸ªæ„å»ºå™¨ç±»ï¼Œå› æ­¤ä»£ç é‡ä¼šæ¯”è¾ƒå¤§ï¼Œå°¤å…¶æ˜¯åœ¨æ„å»ºå¤æ‚å¯¹è±¡æ—¶ã€‚</p>
</li>
<li>
<p>åµŒå¥—å±‚æ¬¡ï¼šå±‚æ¬¡æ„å»ºå™¨æ¨¡å¼ä¸­çš„å¯¹è±¡å±‚æ¬¡ç»“æ„æ˜¯é€šè¿‡åµŒå¥—å¤šä¸ªæ„å»ºå™¨å®ç°çš„ï¼Œè¿™ä¼šå¯¼è‡´ä»£ç çš„åµŒå¥—å±‚æ¬¡è¾ƒæ·±ï¼Œå¯èƒ½ä¼šå½±å“ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
</li>
<li>
<p>å¯èƒ½ä¼šå¢åŠ å†…å­˜å¼€é”€ï¼šå› ä¸ºæ¯ä¸ªæ„å»ºå™¨éƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„å¯¹è±¡ï¼Œå¹¶ä¸”éœ€è¦åœ¨æ„å»ºå™¨å¯¹è±¡ä¸­ä¿å­˜å¯¹è±¡çš„å±æ€§ã€‚å¯¹äºå¤§å‹å¯¹è±¡å’Œå¤šçº§åµŒå¥—ç»“æ„ï¼Œå¼€é”€å¯èƒ½ä¼šå¾ˆå¤§ã€‚</p>
</li>
<li>
<p>ä¸é€‚åˆç®€å•å¯¹è±¡çš„æ„å»ºï¼šå±‚æ¬¡æ„å»ºå™¨æ¨¡å¼é€‚ç”¨äºæ„å»ºå¤æ‚å¯¹è±¡å±‚æ¬¡ç»“æ„ï¼Œä½†å¯¹äºç®€å•çš„å¯¹è±¡æ„å»ºï¼Œä½¿ç”¨å±‚æ¬¡æ„å»ºå™¨æ¨¡å¼å¯èƒ½ä¼šæ˜¾å¾—è¿‡äºç¹çå’Œä¸å¿…è¦ã€‚</p>
</li>
</ol>
<h3 id="ä½¿ç”¨">ä½¿ç”¨</h3>
<h4 id="ä¸¾ä¾‹-1">ä¸¾ä¾‹ 1</h4>
<p>1ã€å®šä¹‰æŠ½è±¡çš„æ„å»ºå™¨æ¥å£ï¼Œç”¨äºåˆ›å»ºä¸åŒç±»å‹çš„å¯¹è±¡å’Œæ·»åŠ å­å¯¹è±¡ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ComputerBuilder</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">buildCPU</span><span class="o">(</span><span class="n">String</span> <span class="n">model</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">buildGPU</span><span class="o">(</span><span class="n">String</span> <span class="n">model</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">buildMemory</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">addStorage</span><span class="o">(</span><span class="n">String</span> <span class="n">type</span><span class="o">,</span> <span class="kt">int</span> <span class="n">size</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">addPeripheral</span><span class="o">(</span><span class="n">String</span> <span class="n">type</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Computer</span> <span class="nf">getResult</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>2ã€åˆ›å»ºå…·ä½“çš„æ„å»ºå™¨å®ç°ï¼Œç”¨äºæ„å»ºä¸åŒç±»å‹çš„å¯¹è±¡å’Œæ·»åŠ å­å¯¹è±¡ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DesktopBuilder</span> <span class="kd">implements</span> <span class="n">ComputerBuilder</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Desktop</span> <span class="n">computer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Desktop</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">buildCPU</span><span class="o">(</span><span class="n">String</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">computer</span><span class="o">.</span><span class="na">setCPU</span><span class="o">(</span><span class="k">new</span> <span class="n">CPU</span><span class="o">(</span><span class="n">model</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">buildGPU</span><span class="o">(</span><span class="n">String</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">computer</span><span class="o">.</span><span class="na">setGPU</span><span class="o">(</span><span class="k">new</span> <span class="n">GPU</span><span class="o">(</span><span class="n">model</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">buildMemory</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">computer</span><span class="o">.</span><span class="na">setMemory</span><span class="o">(</span><span class="k">new</span> <span class="n">Memory</span><span class="o">(</span><span class="n">size</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addStorage</span><span class="o">(</span><span class="n">String</span> <span class="n">type</span><span class="o">,</span> <span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">computer</span><span class="o">.</span><span class="na">addStorage</span><span class="o">(</span><span class="k">new</span> <span class="n">Storage</span><span class="o">(</span><span class="n">type</span><span class="o">,</span> <span class="n">size</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addPeripheral</span><span class="o">(</span><span class="n">String</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">computer</span><span class="o">.</span><span class="na">addPeripheral</span><span class="o">(</span><span class="k">new</span> <span class="n">Peripheral</span><span class="o">(</span><span class="n">type</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Computer</span> <span class="nf">getResult</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">computer</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LaptopBuilder</span> <span class="kd">implements</span> <span class="n">ComputerBuilder</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Laptop</span> <span class="n">computer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Laptop</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">buildCPU</span><span class="o">(</span><span class="n">String</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">computer</span><span class="o">.</span><span class="na">setCPU</span><span class="o">(</span><span class="k">new</span> <span class="n">CPU</span><span class="o">(</span><span class="n">model</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">buildGPU</span><span class="o">(</span><span class="n">String</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">computer</span><span class="o">.</span><span class="na">setGPU</span><span class="o">(</span><span class="k">new</span> <span class="n">GPU</span><span class="o">(</span><span class="n">model</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">buildMemory</span><span class="o">(</span><span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">computer</span><span class="o">.</span><span class="na">setMemory</span><span class="o">(</span><span class="k">new</span> <span class="n">Memory</span><span class="o">(</span><span class="n">size</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addStorage</span><span class="o">(</span><span class="n">String</span> <span class="n">type</span><span class="o">,</span> <span class="kt">int</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">computer</span><span class="o">.</span><span class="na">addStorage</span><span class="o">(</span><span class="k">new</span> <span class="n">Storage</span><span class="o">(</span><span class="n">type</span><span class="o">,</span> <span class="n">size</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addPeripheral</span><span class="o">(</span><span class="n">String</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">computer</span><span class="o">.</span><span class="na">addPeripheral</span><span class="o">(</span><span class="k">new</span> <span class="n">Peripheral</span><span class="o">(</span><span class="n">type</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Computer</span> <span class="nf">getResult</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">computer</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>3ã€åˆ›å»ºæŒ‡å¯¼è€…ç±»ï¼Œç”¨äºåè°ƒæ„å»ºå™¨çš„é¡ºåºå’Œè°ƒç”¨æ„å»ºå™¨çš„æ–¹æ³•æ¥æ„å»ºå¯¹è±¡å±‚æ¬¡ç»“æ„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ComputerDirector</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">ComputerBuilder</span> <span class="n">builder</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">ComputerDirector</span><span class="o">(</span><span class="n">ComputerBuilder</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">builder</span> <span class="o">=</span> <span class="n">builder</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">construct</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">builder</span><span class="o">.</span><span class="na">buildCPU</span><span class="o">(</span><span class="s">&#34;Intel Core i7&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">builder</span><span class="o">.</span><span class="na">buildGPU</span><span class="o">(</span><span class="s">&#34;Nvidia GeForce RTX 3080&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">builder</span><span class="o">.</span><span class="na">buildMemory</span><span class="o">(</span><span class="n">16</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">builder</span><span class="o">.</span><span class="na">addStorage</span><span class="o">(</span><span class="s">&#34;SSD&#34;</span><span class="o">,</span> <span class="n">512</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">builder</span><span class="o">.</span><span class="na">addPeripheral</span><span class="o">(</span><span class="s">&#34;Keyboard&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">builder</span><span class="o">.</span><span class="na">addPeripheral</span><span class="o">(</span><span class="s">&#34;Mouse&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>4ã€ä½¿ç”¨å±‚æ¬¡æ„å»ºå™¨æ¨¡å¼åˆ›å»ºè®¡ç®—æœºç³»ç»Ÿå¯¹è±¡ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ComputerBuilder</span> <span class="n">desktopBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DesktopBuilder</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">ComputerBuilder</span> <span class="n">laptopBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LaptopBuilder</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ComputerDirector</span> <span class="n">director</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ComputerDirector</span><span class="o">(</span><span class="n">desktopBuilder</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">director</span><span class="o">.</span><span class="na">construct</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">Computer</span> <span class="n">desktop</span> <span class="o">=</span> <span class="n">desktopBuilder</span><span class="o">.</span><span class="na">getResult</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">director</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ComputerDirector</span><span class="o">(</span><span class="n">laptopBuilder</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">director</span><span class="o">.</span><span class="na">construct</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">Computer</span> <span class="n">laptop</span> <span class="o">=</span> <span class="n">laptopBuilder</span><span class="o">.</span><span class="na">getResult</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å°†ä¸¤ä¸ªè®¡ç®—æœºç³»ç»Ÿå¯¹è±¡ç»„åˆæˆä¸€ä¸ªæ›´å¤§çš„è®¡ç®—æœºç³»ç»Ÿå¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">ComputerSystem</span> <span class="n">system</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ComputerSystem</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span><span class="o">.</span><span class="na">addComputer</span><span class="o">(</span><span class="n">desktop</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span><span class="o">.</span><span class="na">addComputer</span><span class="o">(</span><span class="n">laptop</span><span class="o">);</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒDesktopBuilderå’ŒLaptopBuilderåˆ†åˆ«æ˜¯å…·ä½“çš„æ„å»ºå™¨å®ç°ï¼Œç”¨äºåˆ›å»ºæ¡Œé¢è®¡ç®—æœºå’Œç¬”è®°æœ¬ç”µè„‘å¯¹è±¡ã€‚ComputerDirectoræ˜¯æŒ‡å¯¼è€…ç±»ï¼Œç”¨äºåè°ƒæ„å»ºå™¨çš„é¡ºåºå’Œè°ƒç”¨æ„å»ºå™¨çš„æ–¹æ³•æ¥æ„å»ºå¯¹è±¡å±‚æ¬¡ç»“æ„ã€‚ä½¿ç”¨ComputerDirectoræ„å»ºè®¡ç®—æœºç³»ç»Ÿå¯¹è±¡æ—¶ï¼Œå¯ä»¥å…ˆä½¿ç”¨DesktopBuilderæ„å»ºæ¡Œé¢è®¡ç®—æœºå¯¹è±¡ï¼Œå†ä½¿ç”¨LaptopBuilderæ„å»ºç¬”è®°æœ¬ç”µè„‘å¯¹è±¡ï¼Œæœ€åå°†ä¸¤ä¸ªè®¡ç®—æœºç³»ç»Ÿå¯¹è±¡ç»„åˆæˆä¸€ä¸ªæ›´å¤§çš„è®¡ç®—æœºç³»ç»Ÿå¯¹è±¡ã€‚</p>
<p>ä¸‹é¢æ˜¯å¦ä¸€ä¸ªä½¿ç”¨å±‚æ¬¡æ„å»ºå™¨æ¨¡å¼åˆ›å»ºå±‚æ¬¡ç»“æ„å¯¹è±¡çš„ä¾‹å­ï¼Œå‡è®¾éœ€è¦åˆ›å»ºä¸€ä¸ªç»„ç»‡ç»“æ„çš„å±‚æ¬¡ç»“æ„å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«å¤šä¸ªéƒ¨é—¨å’ŒåµŒå¥—å­éƒ¨é—¨ï¼š</p>
<p>1ã€å®šä¹‰æŠ½è±¡çš„æ„å»ºå™¨æ¥å£ï¼Œç”¨äºåˆ›å»ºä¸åŒç±»å‹çš„å¯¹è±¡å’Œæ·»åŠ å­å¯¹è±¡ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">DepartmentBuilder</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">buildName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">buildManager</span><span class="o">(</span><span class="n">String</span> <span class="n">manager</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">addSubDepartment</span><span class="o">(</span><span class="n">Department</span> <span class="n">subDepartment</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Department</span> <span class="nf">getResult</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">DepartmentImpl</span> <span class="kd">implements</span> <span class="n">Department</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="n">String</span> <span class="n">manager</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Department</span><span class="o">&gt;</span> <span class="n">subDepartments</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setManager</span><span class="o">(</span><span class="n">String</span> <span class="n">manager</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">manager</span> <span class="o">=</span> <span class="n">manager</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addSubDepartment</span><span class="o">(</span><span class="n">Department</span> <span class="n">subDepartment</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">subDepartments</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">subDepartment</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeSubDepartment</span><span class="o">(</span><span class="n">Department</span> <span class="n">subDepartment</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">subDepartments</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">subDepartment</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Department</span><span class="o">&gt;</span> <span class="nf">getSubDepartments</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">subDepartments</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getManager</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">manager</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DevelopmentDepartment</span> <span class="kd">extends</span> <span class="n">DepartmentImpl</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// æ·»åŠ ç‰¹å®šäºå¼€å‘éƒ¨é—¨çš„å±æ€§å’Œæ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SalesDepartment</span> <span class="kd">extends</span> <span class="n">DepartmentImpl</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// æ·»åŠ ç‰¹å®šäºé”€å”®éƒ¨é—¨çš„å±æ€§å’Œæ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span>
</span></span></code></pre></div><p>2ã€åˆ›å»ºå…·ä½“çš„æ„å»ºå™¨å®ç°ï¼Œç”¨äºæ„å»ºä¸åŒç±»å‹çš„å¯¹è±¡å’Œæ·»åŠ å­å¯¹è±¡ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SalesDepartmentBuilder</span> <span class="kd">implements</span> <span class="n">DepartmentBuilder</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">SalesDepartment</span> <span class="n">department</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SalesDepartment</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">buildName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">department</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">buildManager</span><span class="o">(</span><span class="n">String</span> <span class="n">manager</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">department</span><span class="o">.</span><span class="na">setManager</span><span class="o">(</span><span class="n">manager</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addSubDepartment</span><span class="o">(</span><span class="n">Department</span> <span class="n">subDepartment</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">department</span><span class="o">.</span><span class="na">addSubDepartment</span><span class="o">(</span><span class="n">subDepartment</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Department</span> <span class="nf">getResult</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">department</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DevelopmentDepartmentBuilder</span> <span class="kd">implements</span> <span class="n">DepartmentBuilder</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">DevelopmentDepartment</span> <span class="n">department</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DevelopmentDepartment</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">buildName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">department</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">buildManager</span><span class="o">(</span><span class="n">String</span> <span class="n">manager</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">department</span><span class="o">.</span><span class="na">setManager</span><span class="o">(</span><span class="n">manager</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addSubDepartment</span><span class="o">(</span><span class="n">Department</span> <span class="n">subDepartment</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">department</span><span class="o">.</span><span class="na">addSubDepartment</span><span class="o">(</span><span class="n">subDepartment</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Department</span> <span class="nf">getResult</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">department</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>3ã€åˆ›å»ºæŒ‡å¯¼è€…ç±»ï¼Œç”¨äºåè°ƒæ„å»ºå™¨çš„é¡ºåºå’Œè°ƒç”¨æ„å»ºå™¨çš„æ–¹æ³•æ¥æ„å»ºå¯¹è±¡å±‚æ¬¡ç»“æ„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrganizationDirector</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">DepartmentBuilder</span> <span class="n">builder</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">OrganizationDirector</span><span class="o">(</span><span class="n">DepartmentBuilder</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">builder</span> <span class="o">=</span> <span class="n">builder</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">construct</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">builder</span><span class="o">.</span><span class="na">buildName</span><span class="o">(</span><span class="s">&#34;Organization&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">builder</span><span class="o">.</span><span class="na">buildManager</span><span class="o">(</span><span class="s">&#34;CEO&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">Department</span> <span class="n">salesDept</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SalesDepartment</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">salesDept</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&#34;Sales Department&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">salesDept</span><span class="o">.</span><span class="na">setManager</span><span class="o">(</span><span class="s">&#34;Sales Manager&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">builder</span><span class="o">.</span><span class="na">addSubDepartment</span><span class="o">(</span><span class="n">salesDept</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">Department</span> <span class="n">devDept</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DevelopmentDepartment</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">devDept</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&#34;Development Department&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">devDept</span><span class="o">.</span><span class="na">setManager</span><span class="o">(</span><span class="s">&#34;Development Manager&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">Department</span> <span class="n">frontendDevDept</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DevelopmentDepartment</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">frontendDevDept</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&#34;Front-end Development Department&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">frontendDevDept</span><span class="o">.</span><span class="na">setManager</span><span class="o">(</span><span class="s">&#34;Front-end Development Manager&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">devDept</span><span class="o">.</span><span class="na">addSubDepartment</span><span class="o">(</span><span class="n">frontendDevDept</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">Department</span> <span class="n">backendDevDept</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DevelopmentDepartment</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">backendDevDept</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&#34;Back-end Development Department&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">backendDevDept</span><span class="o">.</span><span class="na">setManager</span><span class="o">(</span><span class="s">&#34;Back-end Development Manager&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">devDept</span><span class="o">.</span><span class="na">addSubDepartment</span><span class="o">(</span><span class="n">backendDevDept</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">builder</span><span class="o">.</span><span class="na">addSubDepartment</span><span class="o">(</span><span class="n">devDept</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>4ã€ä½¿ç”¨å±‚æ¬¡æ„å»ºå™¨æ¨¡å¼åˆ›å»ºç»„ç»‡ç»“æ„å¯¹è±¡ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">DepartmentBuilder</span> <span class="n">salesDeptBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SalesDepartmentBuilder</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">DepartmentBuilder</span> <span class="n">devDeptBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DevelopmentDepartmentBuilder</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">OrganizationDirector</span> <span class="n">director</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrganizationDirector</span><span class="o">(</span><span class="n">salesDeptBuilder</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">director</span><span class="o">.</span><span class="na">construct</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">Department</span> <span class="n">salesDept</span> <span class="o">=</span> <span class="n">salesDeptBuilder</span><span class="o">.</span><span class="na">getResult</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">director</span> <span class="o">=</span> <span class="k">new</span> <span class="n">OrganizationDirector</span><span class="o">(</span><span class="n">devDeptBuilder</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">director</span><span class="o">.</span><span class="na">construct</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">Department</span> <span class="n">devDept</span> <span class="o">=</span> <span class="n">devDeptBuilder</span><span class="o">.</span><span class="na">getResult</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å°†ä¸¤ä¸ªéƒ¨é—¨å¯¹è±¡ç»„åˆæˆä¸€ä¸ªæ›´å¤§çš„ç»„ç»‡ç»“æ„å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Organization</span> <span class="n">organization</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Organization</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">organization</span><span class="o">.</span><span class="na">addDepartment</span><span class="o">(</span><span class="n">salesDept</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">organization</span><span class="o">.</span><span class="na">addDepartment</span><span class="o">(</span><span class="n">devDept</span><span class="o">);</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒSalesDepartmentBuilderå’ŒDevelopmentDepartmentBuilderåˆ†åˆ«æ˜¯å…·ä½“çš„æ„å»ºå™¨å®ç°ï¼Œç”¨äºåˆ›å»ºé”€å”®éƒ¨é—¨å’Œå¼€å‘éƒ¨é—¨å¯¹è±¡ã€‚OrganizationDirectoræ˜¯æŒ‡å¯¼è€…ç±»ï¼Œç”¨äºåè°ƒæ„å»ºå™¨çš„é¡ºåºå’Œè°ƒç”¨æ„å»ºå™¨çš„æ–¹æ³•æ¥æ„å»ºå¯¹è±¡å±‚æ¬¡ç»“æ„ã€‚ä½¿ç”¨OrganizationDirectoræ„å»ºç»„ç»‡ç»“æ„å¯¹è±¡æ—¶ï¼Œå¯ä»¥å…ˆä½¿ç”¨SalesDepartmentBuilderæ„å»ºé”€å”®éƒ¨é—¨å¯¹è±¡ï¼Œå†ä½¿ç”¨DevelopmentDepartmentBuilderæ„å»ºå¼€å‘éƒ¨é—¨å¯¹è±¡ï¼Œæœ€åå°†ä¸¤ä¸ªéƒ¨é—¨å¯¹è±¡ç»„åˆæˆä¸€ä¸ªæ›´å¤§çš„ç»„ç»‡ç»“æ„å¯¹è±¡ã€‚</p>
<h4 id="ä¸¾ä¾‹-2">ä¸¾ä¾‹ 2</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">ComputerComponent</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">manufacturer</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">model</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="nf">ComputerComponent</span><span class="o">(</span><span class="n">Builder</span><span class="o">&lt;?&gt;</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">manufacturer</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">manufacturer</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">model</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getManufacturer</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">manufacturer</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getModel</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">model</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Builder</span><span class="o">&lt;</span><span class="n">T</span> <span class="kd">extends</span> <span class="n">Builder</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="n">String</span> <span class="n">manufacturer</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="n">String</span> <span class="n">model</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">T</span> <span class="nf">setManufacturer</span><span class="o">(</span><span class="n">String</span> <span class="n">manufacturer</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">manufacturer</span> <span class="o">=</span> <span class="n">manufacturer</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">self</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">T</span> <span class="nf">setModel</span><span class="o">(</span><span class="n">String</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">self</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">protected</span> <span class="kd">abstract</span> <span class="n">T</span> <span class="nf">self</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="kd">abstract</span> <span class="n">ComputerComponent</span> <span class="nf">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Motherboard</span> <span class="kd">extends</span> <span class="n">ComputerComponent</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">socketType</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="nf">Motherboard</span><span class="o">(</span><span class="n">Builder</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">super</span><span class="o">(</span><span class="n">builder</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">socketType</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">socketType</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getSocketType</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">socketType</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Builder</span> <span class="kd">extends</span> <span class="n">ComputerComponent</span><span class="o">.</span><span class="na">Builder</span><span class="o">&lt;</span><span class="n">Builder</span><span class="o">&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="n">String</span> <span class="n">socketType</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">Builder</span> <span class="nf">setSocketType</span><span class="o">(</span><span class="n">String</span> <span class="n">socketType</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">socketType</span> <span class="o">=</span> <span class="n">socketType</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">protected</span> <span class="n">Builder</span> <span class="nf">self</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">Motherboard</span> <span class="nf">build</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">new</span> <span class="n">Motherboard</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CPU</span> <span class="kd">extends</span> <span class="n">ComputerComponent</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">coreCount</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="nf">CPU</span><span class="o">(</span><span class="n">Builder</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">super</span><span class="o">(</span><span class="n">builder</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">coreCount</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">coreCount</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getCoreCount</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">coreCount</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Builder</span> <span class="kd">extends</span> <span class="n">ComputerComponent</span><span class="o">.</span><span class="na">Builder</span><span class="o">&lt;</span><span class="n">Builder</span><span class="o">&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="kt">int</span> <span class="n">coreCount</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">Builder</span> <span class="nf">setCoreCount</span><span class="o">(</span><span class="kt">int</span> <span class="n">coreCount</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">coreCount</span> <span class="o">=</span> <span class="n">coreCount</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">protected</span> <span class="n">Builder</span> <span class="nf">self</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">CPU</span> <span class="nf">build</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">new</span> <span class="n">CPU</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Computer</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Motherboard</span> <span class="n">motherboard</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">CPU</span> <span class="n">cpu</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="nf">Computer</span><span class="o">(</span><span class="n">Builder</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">motherboard</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">motherboard</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">cpu</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">cpu</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Motherboard</span> <span class="nf">getMotherboard</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">motherboard</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">CPU</span> <span class="nf">getCpu</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">cpu</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Builder</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="n">Motherboard</span> <span class="n">motherboard</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="n">CPU</span> <span class="n">cpu</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">Builder</span> <span class="nf">setMotherboard</span><span class="o">(</span><span class="n">Motherboard</span> <span class="n">motherboard</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">motherboard</span> <span class="o">=</span> <span class="n">motherboard</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">Builder</span> <span class="nf">setCpu</span><span class="o">(</span><span class="n">CPU</span> <span class="n">cpu</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">cpu</span> <span class="o">=</span> <span class="n">cpu</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">Computer</span> <span class="nf">build</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">new</span> <span class="n">Computer</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Motherboard</span><span class="o">.</span><span class="na">Builder</span> <span class="n">motherboardBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Motherboard</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">setManufacturer</span><span class="o">(</span><span class="s">&#34;ASUS&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">setModel</span><span class="o">(</span><span class="s">&#34;ROG Strix Z590-E Gaming&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">setSocketType</span><span class="o">(</span><span class="s">&#34;LGA 1200&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="n">CPU</span><span class="o">.</span><span class="na">Builder</span> <span class="n">cpuBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CPU</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">setManufacturer</span><span class="o">(</span><span class="s">&#34;Intel&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">setModel</span><span class="o">(</span><span class="s">&#34;Core i9-11900K&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">setCoreCount</span><span class="o">(</span><span class="n">8</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="n">Computer</span><span class="o">.</span><span class="na">Builder</span> <span class="n">computerBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Computer</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">setMotherboard</span><span class="o">(</span><span class="n">motherboardBuilder</span><span class="o">.</span><span class="na">build</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">setCpu</span><span class="o">(</span><span class="n">cpuBuilder</span><span class="o">.</span><span class="na">build</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="n">Computer</span> <span class="n">computer</span> <span class="o">=</span> <span class="n">computerBuilder</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>ComputerComponent</code> ç±»æ˜¯ä¸€ä¸ªæŠ½è±¡åŸºç±»ï¼Œå®šä¹‰äº†è®¡ç®—æœºç»„ä»¶çš„åŸºæœ¬å±æ€§å’Œæ–¹æ³•ã€‚å®ƒè¿˜å®šä¹‰äº†ä¸€ä¸ªæŠ½è±¡çš„æ„å»ºå™¨ç±»ï¼Œç”¨äºæ„å»ºå®ƒçš„å­ç±»çš„å®ä¾‹ã€‚</p>
<p>æ¯ä¸ª <code>ComputerComponent</code> çš„å…·ä½“å­ç±»éƒ½æœ‰è‡ªå·±çš„å…·ä½“æ„å»ºå™¨ç±»ï¼Œè¯¥ç±»æ‰©å±•äº†æŠ½è±¡æ„å»ºå™¨ç±»ã€‚å…·ä½“æ„å»ºå™¨æä¾›äº†è®¾ç½®ç›¸åº”ç»„ä»¶å±æ€§çš„æ–¹æ³•ï¼Œä¾‹å¦‚ä¸»æ¿çš„åˆ¶é€ å•†ã€å‹å·å’Œæ’åº§ç±»å‹ï¼Œå¤„ç†å™¨çš„æ—¶é’Ÿé€Ÿåº¦å’Œå†…å­˜çš„å®¹é‡ã€‚</p>
<p><code>Computer</code> ç±»ä»£è¡¨ä¸€ä¸ªå®Œæ•´çš„è®¡ç®—æœºç³»ç»Ÿï¼Œå¹¶å…·æœ‰ç”¨äºæ„å»º <code>Computer</code> ç±»çš„å®ä¾‹çš„æ„å»ºå™¨ç±»ã€‚<code>Computer.Builder</code> ç±»æä¾›äº†è®¾ç½®æ¯ä¸ªç»„ä»¶å±æ€§çš„æ–¹æ³•ï¼Œä½¿ç”¨ <code>Consumer</code> å‡½æ•°æ¥å£æ¥æ¥å—é…ç½®ç›¸åº”æ„å»ºå™¨çš„ lambda è¡¨è¾¾å¼ã€‚</p>
<h2 id="ä½¿ç”¨-1">ä½¿ç”¨</h2>
<p>ä»¥ä¸‹æ˜¯å‡ ä¸ªå¸¸è§å¼€æºæ¡†æ¶ä¸­ä½¿ç”¨å»ºé€ è€…æ¨¡å¼çš„ä¾‹å­ï¼š</p>
<h3 id="retrofit">Retrofit</h3>
<p>Retrofitæ˜¯ä¸€ä¸ªAndroidå’ŒJavaå¹³å°ä¸Šçš„RESTful APIåº“ï¼Œå®ƒä½¿ç”¨å»ºé€ è€…æ¨¡å¼æ¥åˆ›å»ºRestAdapterå¯¹è±¡ã€‚RestAdapter.Builderç±»æ˜¯ä¸€ä¸ªå»ºé€ è€…ç±»ï¼Œå®ƒåŒ…å«äº†ä¸€ç³»åˆ—çš„æ–¹æ³•ï¼Œç”¨äºè®¾ç½®Retrofitçš„é…ç½®é€‰é¡¹ï¼Œå¦‚è®¾ç½®APIçš„base URLã€è®¾ç½®HTTP Clientã€è®¾ç½®Converterç­‰ã€‚</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">RestAdapter</span> <span class="n">restAdapter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RestAdapter</span><span class="o">.</span><span class="na">Builder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">setEndpoint</span><span class="o">(</span><span class="s">&#34;https://api.github.com&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">setClient</span><span class="o">(</span><span class="k">new</span> <span class="n">OkClient</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">setLogLevel</span><span class="o">(</span><span class="n">RestAdapter</span><span class="o">.</span><span class="na">LogLevel</span><span class="o">.</span><span class="na">FULL</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span></code></pre></div><h3 id="gson">Gson</h3>
<p>Gsonæ˜¯ä¸€ä¸ªç”¨äºåœ¨Javaå¯¹è±¡å’ŒJSONæ•°æ®ä¹‹é—´è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„åº“ã€‚å®ƒä½¿ç”¨å»ºé€ è€…æ¨¡å¼æ¥åˆ›å»ºGsonå¯¹è±¡ã€‚GsonBuilderç±»æ˜¯ä¸€ä¸ªå»ºé€ è€…ç±»ï¼Œå®ƒåŒ…å«äº†ä¸€ç³»åˆ—çš„æ–¹æ³•ï¼Œç”¨äºé…ç½®Gsonçš„è¡Œä¸ºï¼Œå¦‚è®¾ç½®æ—¥æœŸæ ¼å¼ã€è®¾ç½®å­—æ®µçš„å‘½åç­–ç•¥ç­‰ã€‚</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Gson</span> <span class="n">gson</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GsonBuilder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">setDateFormat</span><span class="o">(</span><span class="s">&#34;yyyy-MM-dd&#39;T&#39;HH:mm:ssZ&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">setFieldNamingPolicy</span><span class="o">(</span><span class="n">FieldNamingPolicy</span><span class="o">.</span><span class="na">LOWER_CASE_WITH_UNDERSCORES</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">create</span><span class="o">();</span>
</span></span></code></pre></div><h3 id="apache-httpclient">Apache HttpClient</h3>
<p>Apache HttpClientæ˜¯ä¸€ä¸ªç”¨äºåˆ›å»ºHTTPå®¢æˆ·ç«¯çš„åº“ï¼Œå®ƒä½¿ç”¨å»ºé€ è€…æ¨¡å¼æ¥åˆ›å»ºHttpClientå¯¹è±¡ã€‚HttpClientBuilderç±»æ˜¯ä¸€ä¸ªå»ºé€ è€…ç±»ï¼Œå®ƒåŒ…å«äº†ä¸€ç³»åˆ—çš„æ–¹æ³•ï¼Œç”¨äºé…ç½®HttpClientçš„è¡Œä¸ºï¼Œå¦‚è®¾ç½®è¿æ¥æ± ã€è®¾ç½®ä»£ç†ã€è®¾ç½®Cookieç®¡ç†å™¨ç­‰ã€‚</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">HttpClient</span> <span class="n">httpClient</span> <span class="o">=</span> <span class="n">HttpClientBuilder</span><span class="o">.</span><span class="na">create</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">setMaxConnTotal</span><span class="o">(</span><span class="n">100</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">setMaxConnPerRoute</span><span class="o">(</span><span class="n">10</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">setProxy</span><span class="o">(</span><span class="k">new</span> <span class="n">HttpHost</span><span class="o">(</span><span class="s">&#34;localhost&#34;</span><span class="o">,</span> <span class="n">8080</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">setDefaultCookieStore</span><span class="o">(</span><span class="k">new</span> <span class="n">BasicCookieStore</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span></code></pre></div><h3 id="apache-kafka">Apache Kafka</h3>
<p>Apache Kafkaæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼Œå®ƒä½¿ç”¨å»ºé€ è€…æ¨¡å¼æ¥åˆ›å»ºProducerå’ŒConsumerå¯¹è±¡ã€‚ProducerConfigå’ŒConsumerConfigç±»æ˜¯å»ºé€ è€…ç±»ï¼Œå®ƒä»¬åŒ…å«äº†ä¸€ç³»åˆ—çš„æ–¹æ³•ï¼Œç”¨äºé…ç½®Producerå’ŒConsumerçš„è¡Œä¸ºï¼Œå¦‚è®¾ç½®brokeråœ°å€ã€è®¾ç½®åºåˆ—åŒ–å™¨ç­‰ã€‚</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Properties</span> <span class="n">producerProps</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">producerProps</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">ProducerConfig</span><span class="o">.</span><span class="na">BOOTSTRAP_SERVERS_CONFIG</span><span class="o">,</span> <span class="s">&#34;localhost:9092&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">producerProps</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">ProducerConfig</span><span class="o">.</span><span class="na">KEY_SERIALIZER_CLASS_CONFIG</span><span class="o">,</span> <span class="n">StringSerializer</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
</span></span><span class="line"><span class="cl"><span class="n">producerProps</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">ProducerConfig</span><span class="o">.</span><span class="na">VALUE_SERIALIZER_CLASS_CONFIG</span><span class="o">,</span> <span class="n">StringSerializer</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Producer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">producer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">KafkaProducer</span><span class="o">&lt;&gt;(</span><span class="n">producerProps</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Properties</span> <span class="n">consumerProps</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">consumerProps</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">ConsumerConfig</span><span class="o">.</span><span class="na">BOOTSTRAP_SERVERS_CONFIG</span><span class="o">,</span> <span class="s">&#34;localhost:9092&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">consumerProps</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">ConsumerConfig</span><span class="o">.</span><span class="na">KEY_DESERIALIZER_CLASS_CONFIG</span><span class="o">,</span> <span class="n">StringDeserializer</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
</span></span><span class="line"><span class="cl"><span class="n">consumerProps</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">ConsumerConfig</span><span class="o">.</span><span class="na">VALUE_DESERIALIZER_CLASS_CONFIG</span><span class="o">,</span> <span class="n">StringDeserializer</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
</span></span><span class="line"><span class="cl"><span class="n">consumerProps</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">ConsumerConfig</span><span class="o">.</span><span class="na">GROUP_ID_CONFIG</span><span class="o">,</span> <span class="s">&#34;my-group&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Consumer</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">consumer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">KafkaConsumer</span><span class="o">&lt;&gt;(</span><span class="n">consumerProps</span><span class="o">);</span>
</span></span></code></pre></div><h3 id="apache-commons-configuration">Apache Commons Configuration</h3>
<p>Apache Commons Configurationæ˜¯ä¸€ä¸ªç”¨äºè¯»å–å’Œå†™å…¥å„ç§é…ç½®æ–‡ä»¶çš„åº“ï¼Œå®ƒä½¿ç”¨å»ºé€ è€…æ¨¡å¼æ¥åˆ›å»ºConfigurationå¯¹è±¡ã€‚ConfigurationBuilderç±»æ˜¯ä¸€ä¸ªå»ºé€ è€…ç±»ï¼Œå®ƒåŒ…å«äº†ä¸€ç³»åˆ—çš„æ–¹æ³•ï¼Œç”¨äºé…ç½®Configurationçš„è¡Œä¸ºï¼Œå¦‚è®¾ç½®é…ç½®æ–‡ä»¶ç±»å‹ã€è®¾ç½®å±æ€§çš„åˆ†éš”ç¬¦ç­‰ã€‚</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Configuration</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConfigurationBuilder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">setDelimiterParsingDisabled</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">setFile</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&#34;config.properties&#34;</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">setListDelimiterHandler</span><span class="o">(</span><span class="k">new</span> <span class="n">DefaultListDelimiterHandler</span><span class="o">(</span><span class="sc">&#39;,&#39;</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span></code></pre></div><h3 id="guava">Guava</h3>
<p>Guavaæ˜¯ä¸€ä¸ªGoogleå¼€å‘çš„Javaåº“ï¼Œå®ƒåŒ…å«äº†è®¸å¤šå®ç”¨çš„å·¥å…·ç±»å’Œæ•°æ®ç»“æ„ï¼Œå…¶ä¸­åŒ…æ‹¬ä½¿ç”¨å»ºé€ è€…æ¨¡å¼æ¥åˆ›å»ºçš„ImmutableListã€ImmutableMapå’ŒImmutableSetç­‰ä¸å¯å˜é›†åˆç±»ã€‚</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">ImmutableList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">ImmutableList</span><span class="o">.&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="n">builder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;foo&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;bar&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;baz&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ImmutableMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="n">ImmutableMap</span><span class="o">.&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span><span class="n">builder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;foo&#34;</span><span class="o">,</span> <span class="n">1</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;bar&#34;</span><span class="o">,</span> <span class="n">2</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&#34;baz&#34;</span><span class="o">,</span> <span class="n">3</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ImmutableSet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">set</span> <span class="o">=</span> <span class="n">ImmutableSet</span><span class="o">.&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="n">builder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;foo&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;bar&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&#34;baz&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span></code></pre></div><h3 id="jpa">JPA</h3>
<p>Java Persistence APIï¼ˆJPAï¼‰æ˜¯Java EEå¹³å°çš„ä¸€ä¸ªORMæ¡†æ¶ï¼Œå®ƒä½¿ç”¨å»ºé€ è€…æ¨¡å¼æ¥åˆ›å»ºEntityManagerFactoryå¯¹è±¡ã€‚EntityManagerFactoryBuilderç±»æ˜¯ä¸€ä¸ªå»ºé€ è€…ç±»ï¼Œå®ƒåŒ…å«äº†ä¸€ç³»åˆ—çš„æ–¹æ³•ï¼Œç”¨äºé…ç½®EntityManagerFactoryçš„è¡Œä¸ºï¼Œå¦‚è®¾ç½®æ•°æ®æºã€è®¾ç½®JPAçš„å±æ€§ç­‰ã€‚</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">EntityManagerFactory</span> <span class="n">entityManagerFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EntityManagerFactoryBuilder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">dataSource</span><span class="o">(</span><span class="n">myDataSource</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">persistenceUnit</span><span class="o">(</span><span class="s">&#34;myPersistenceUnit&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">properties</span><span class="o">(</span><span class="n">myProperties</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span></code></pre></div><h3 id="spring-framework">Spring Framework</h3>
<p>Spring Frameworkæ˜¯ä¸€ä¸ªJavaå¹³å°ä¸Šçš„å¼€æºåº”ç”¨ç¨‹åºæ¡†æ¶ï¼Œå®ƒä½¿ç”¨å»ºé€ è€…æ¨¡å¼æ¥åˆ›å»ºRestTemplateå’ŒHttpHeaderså¯¹è±¡ã€‚RestTemplateBuilderå’ŒHttpHeadersBuilderç±»æ˜¯å»ºé€ è€…ç±»ï¼Œå®ƒä»¬åŒ…å«äº†ä¸€ç³»åˆ—çš„æ–¹æ³•ï¼Œç”¨äºé…ç½®RestTemplateå’ŒHttpHeadersçš„è¡Œä¸ºï¼Œå¦‚è®¾ç½®è¿æ¥è¶…æ—¶ã€è®¾ç½®è¯·æ±‚å¤´ç­‰ã€‚</p>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">RestTemplate</span> <span class="n">restTemplate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RestTemplateBuilder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">setConnectTimeout</span><span class="o">(</span><span class="n">Duration</span><span class="o">.</span><span class="na">ofSeconds</span><span class="o">(</span><span class="n">10</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">setReadTimeout</span><span class="o">(</span><span class="n">Duration</span><span class="o">.</span><span class="na">ofSeconds</span><span class="o">(</span><span class="n">10</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">HttpHeaders</span> <span class="n">headers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpHeadersBuilder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</span></span></code></pre></div><h2 id="ä¼˜åŒ–">ä¼˜åŒ–</h2>
<p>å»ºé€ è€…æ¨¡å¼çš„ä¼˜åŒ–ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<h3 id="ä½¿ç”¨é™æ€å†…éƒ¨ç±»ä¼˜åŒ–å»ºé€ è€…æ¨¡å¼">ä½¿ç”¨é™æ€å†…éƒ¨ç±»ä¼˜åŒ–å»ºé€ è€…æ¨¡å¼</h3>
<p>å»ºé€ è€…æ¨¡å¼é€šå¸¸ä½¿ç”¨ä¸€ä¸ªBuilderç±»æ¥æ„å»ºå¤æ‚å¯¹è±¡ï¼Œä¸ºäº†é¿å…Builderç±»å˜å¾—è¿‡äºè‡ƒè‚¿ï¼Œå¯ä»¥å°†å…¶è®¾è®¡ä¸ºé™æ€å†…éƒ¨ç±»ï¼Œè¿™æ ·å¯ä»¥ä½¿ä»£ç æ›´åŠ æ¸…æ™°ï¼ŒåŒæ—¶ä¹Ÿèƒ½å¤Ÿä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p>
<h3 id="ä½¿ç”¨æµå¼æ¥å£ä¼˜åŒ–å»ºé€ è€…æ¨¡å¼">ä½¿ç”¨æµå¼æ¥å£ä¼˜åŒ–å»ºé€ è€…æ¨¡å¼</h3>
<p>æµå¼æ¥å£æ˜¯ä¸€ç§é“¾å¼è°ƒç”¨çš„æ–¹å¼ï¼Œå®ƒå¯ä»¥å°†å¤šä¸ªæ–¹æ³•è°ƒç”¨è¿æ¥èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªé“¾å¼ç»“æ„ï¼Œä½¿å¾—ä»£ç æ›´åŠ ç®€æ´æ˜“è¯»ã€‚åœ¨å»ºé€ è€…æ¨¡å¼ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æµå¼æ¥å£æ¥ä¼˜åŒ–Builderç±»ï¼Œä½¿å¾—å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡é“¾å¼è°ƒç”¨çš„æ–¹å¼æ¥åˆ›å»ºå¤æ‚å¯¹è±¡ï¼Œä»è€Œç®€åŒ–ä»£ç ã€‚</p>
<h3 id="ä½¿ç”¨é»˜è®¤å€¼ä¼˜åŒ–å»ºé€ è€…æ¨¡å¼">ä½¿ç”¨é»˜è®¤å€¼ä¼˜åŒ–å»ºé€ è€…æ¨¡å¼</h3>
<p>åœ¨å»ºé€ è€…æ¨¡å¼ä¸­ï¼Œæœ‰äº›å±æ€§æ˜¯å¿…é¡»çš„ï¼Œè€Œæœ‰äº›å±æ€§æ˜¯å¯é€‰çš„ï¼Œå¯ä»¥ä½¿ç”¨é»˜è®¤å€¼æ¥ä¸ºå¯é€‰å±æ€§è®¾ç½®é»˜è®¤å€¼ï¼Œä»è€Œé¿å…å®¢æˆ·ç«¯å¿…é¡»ä¸ºæ¯ä¸ªå¯é€‰å±æ€§éƒ½æä¾›å€¼çš„æƒ…å†µï¼ŒåŒæ—¶ä¹Ÿèƒ½å¤Ÿç®€åŒ–å®¢æˆ·ç«¯ä»£ç ã€‚</p>
<h3 id="ä½¿ç”¨java-8ä¸­çš„optionalç±»ä¼˜åŒ–å»ºé€ è€…æ¨¡å¼">ä½¿ç”¨Java 8ä¸­çš„Optionalç±»ä¼˜åŒ–å»ºé€ è€…æ¨¡å¼</h3>
<p>Java 8ä¸­å¼•å…¥äº†Optionalç±»ï¼Œè¯¥ç±»å¯ä»¥ç”¨äºå¤„ç†å¯èƒ½ä¸ºnullçš„å€¼ï¼Œå¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–å»ºé€ è€…æ¨¡å¼ä¸­çš„ä»£ç ã€‚</p>
<p>åœ¨å»ºé€ è€…æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦è®¾ç½®å¤šä¸ªå±æ€§ï¼Œå…¶ä¸­æœ‰äº›å±æ€§å¯èƒ½æ˜¯å¯é€‰çš„ï¼Œå¦‚æœç›´æ¥ä½¿ç”¨nullæ¥è¡¨ç¤ºå¯é€‰å±æ€§çš„å€¼ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä»£ç å‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œè€Œä½¿ç”¨Optionalç±»å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨Optionalç±»ä¼˜åŒ–å»ºé€ è€…æ¨¡å¼çš„ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.Optional</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Computer</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">cpu</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">memory</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">hardDisk</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">graphicsCard</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">Computer</span><span class="o">(</span><span class="n">ComputerBuilder</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">cpu</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">cpu</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">memory</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">memory</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">hardDisk</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">hardDisk</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">graphicsCard</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">graphicsCard</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// çœç•¥getteræ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ComputerBuilder</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="n">String</span> <span class="n">cpu</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="n">String</span> <span class="n">memory</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="n">String</span> <span class="n">hardDisk</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">graphicsCard</span> <span class="o">=</span> <span class="n">Optional</span><span class="o">.</span><span class="na">empty</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">ComputerBuilder</span> <span class="nf">setCpu</span><span class="o">(</span><span class="n">String</span> <span class="n">cpu</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">cpu</span> <span class="o">=</span> <span class="n">cpu</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">ComputerBuilder</span> <span class="nf">setMemory</span><span class="o">(</span><span class="n">String</span> <span class="n">memory</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">memory</span> <span class="o">=</span> <span class="n">memory</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">ComputerBuilder</span> <span class="nf">setHardDisk</span><span class="o">(</span><span class="n">String</span> <span class="n">hardDisk</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">hardDisk</span> <span class="o">=</span> <span class="n">hardDisk</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">ComputerBuilder</span> <span class="nf">setGraphicsCard</span><span class="o">(</span><span class="n">String</span> <span class="n">graphicsCard</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">graphicsCard</span> <span class="o">=</span> <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="n">graphicsCard</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">Computer</span> <span class="nf">build</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">new</span> <span class="n">Computer</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>Optional</code> ç±»æ¥è¡¨ç¤ºå¯é€‰å±æ€§çš„å€¼ï¼Œå°†graphicsCardå±æ€§çš„ç±»å‹æ”¹ä¸º<code>Optional&lt;String&gt;</code>ã€‚åœ¨ ComputerBuilder ç±»ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>Optional.ofNullable </code>æ–¹æ³•æ¥å°†å¯é€‰å±æ€§çš„å€¼è½¬æ¢ä¸º Optional å¯¹è±¡ï¼Œå¹¶åœ¨è°ƒç”¨ build æ–¹æ³•æ—¶ï¼Œå°† Optional å¯¹è±¡è½¬æ¢ä¸ºæ™®é€šçš„å­—ç¬¦ä¸²ç±»å‹ã€‚</p>
<h3 id="ä½¿ç”¨-lambdaè¡¨è¾¾å¼ä¼˜åŒ–å»ºé€ è€…æ¨¡å¼">ä½¿ç”¨ Lambdaè¡¨è¾¾å¼ä¼˜åŒ–å»ºé€ è€…æ¨¡å¼</h3>
<p>Lambdaè¡¨è¾¾å¼æ˜¯Java 8ä¸­å¼•å…¥çš„ä¸€ç§æ–°çš„è¯­è¨€ç‰¹æ€§ï¼Œå¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–å»ºé€ è€…æ¨¡å¼ä¸­çš„ä»£ç ï¼Œä½¿å¾—ä»£ç æ›´åŠ ç®€æ´æ˜“è¯»ã€‚</p>
<p>åœ¨å»ºé€ è€…æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦å®šä¹‰å¤šä¸ªå±æ€§ï¼Œå¹¶åœ¨æ„é€ æ–¹æ³•ä¸­è¿›è¡Œåˆå§‹åŒ–ã€‚ä½¿ç”¨Lambdaè¡¨è¾¾å¼å¯ä»¥é¿å…å®šä¹‰å¤šä¸ªå±æ€§çš„é—®é¢˜ï¼Œå°†å±æ€§çš„èµ‹å€¼æ“ä½œé€šè¿‡Lambdaè¡¨è¾¾å¼ä¼ é€’ç»™æ„é€ æ–¹æ³•ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨Lambdaè¡¨è¾¾å¼ä¼˜åŒ–å»ºé€ è€…æ¨¡å¼çš„ç¤ºä¾‹ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.Optional</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.function.Consumer</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Computer</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">cpu</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">memory</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">hardDisk</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">graphicsCard</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">Computer</span><span class="o">(</span><span class="n">Consumer</span><span class="o">&lt;</span><span class="n">ComputerBuilder</span><span class="o">&gt;</span> <span class="n">builder</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ComputerBuilder</span> <span class="n">computerBuilder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ComputerBuilder</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">builder</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">computerBuilder</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">cpu</span> <span class="o">=</span> <span class="n">computerBuilder</span><span class="o">.</span><span class="na">cpu</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">memory</span> <span class="o">=</span> <span class="n">computerBuilder</span><span class="o">.</span><span class="na">memory</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">hardDisk</span> <span class="o">=</span> <span class="n">computerBuilder</span><span class="o">.</span><span class="na">hardDisk</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">graphicsCard</span> <span class="o">=</span> <span class="n">computerBuilder</span><span class="o">.</span><span class="na">graphicsCard</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// çœç•¥getteræ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">ComputerBuilder</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="n">String</span> <span class="n">cpu</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="n">String</span> <span class="n">memory</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="n">String</span> <span class="n">hardDisk</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">private</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">graphicsCard</span> <span class="o">=</span> <span class="n">Optional</span><span class="o">.</span><span class="na">empty</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">ComputerBuilder</span> <span class="nf">setCpu</span><span class="o">(</span><span class="n">String</span> <span class="n">cpu</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">cpu</span> <span class="o">=</span> <span class="n">cpu</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">ComputerBuilder</span> <span class="nf">setMemory</span><span class="o">(</span><span class="n">String</span> <span class="n">memory</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">memory</span> <span class="o">=</span> <span class="n">memory</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">ComputerBuilder</span> <span class="nf">setHardDisk</span><span class="o">(</span><span class="n">String</span> <span class="n">hardDisk</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">hardDisk</span> <span class="o">=</span> <span class="n">hardDisk</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kd">public</span> <span class="n">ComputerBuilder</span> <span class="nf">setGraphicsCard</span><span class="o">(</span><span class="n">String</span> <span class="n">graphicsCard</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="o">.</span><span class="na">graphicsCard</span> <span class="o">=</span> <span class="n">Optional</span><span class="o">.</span><span class="na">ofNullable</span><span class="o">(</span><span class="n">graphicsCard</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Computer</span> <span class="n">computer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Computer</span><span class="o">(</span><span class="n">builder</span> <span class="o">-&gt;</span> <span class="n">builder</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">setCpu</span><span class="o">(</span><span class="s">&#34;Intel i7&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">setMemory</span><span class="o">(</span><span class="s">&#34;16GB&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">setHardDisk</span><span class="o">(</span><span class="s">&#34;512GB SSD&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">setGraphicsCard</span><span class="o">(</span><span class="s">&#34;NVIDIA GTX 1660&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬å°† Computer ç±»çš„æ„é€ æ–¹æ³•æ”¹ä¸ºæ¥æ”¶ä¸€ä¸ª <code>Consumer&lt;ComputerBuilder&gt; </code>ç±»å‹çš„å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°è¡¨ç¤ºä¸€ä¸ªåŒ…å«å±æ€§èµ‹å€¼æ“ä½œçš„ Lambda è¡¨è¾¾å¼ã€‚åœ¨æ„é€ æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªComputerBuilder å¯¹è±¡ï¼Œç„¶åé€šè¿‡ Lambda è¡¨è¾¾å¼è°ƒç”¨ ComputerBuilder å¯¹è±¡çš„æ–¹æ³•æ¥è®¾ç½®å±æ€§å€¼ï¼Œå¹¶æœ€ç»ˆé€šè¿‡ ComputerBuilder å¯¹è±¡åˆ›å»º Computer å¯¹è±¡ã€‚</p>
<h3 id="ä½¿ç”¨æ³›å‹å’Œåå°„ä¼˜åŒ–">ä½¿ç”¨æ³›å‹å’Œåå°„ä¼˜åŒ–</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">EntityCreator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">classInstance</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">T</span> <span class="n">entityObj</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">EntityCreator</span><span class="o">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">classInstance</span><span class="o">,</span> <span class="n">Object</span><span class="o">...</span> <span class="n">initParams</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">classInstance</span> <span class="o">=</span> <span class="n">classInstance</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">Class</span><span class="o">&lt;?&gt;[]</span> <span class="n">paramTypes</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Class</span><span class="o">&lt;?&gt;[</span><span class="n">initParams</span><span class="o">.</span><span class="na">length</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">0</span><span class="o">,</span> <span class="n">length</span> <span class="o">=</span> <span class="n">initParams</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">length</span><span class="o">;</span> <span class="n">index</span><span class="o">++)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">String</span> <span class="n">checkStr</span> <span class="o">=</span> <span class="n">initParams</span><span class="o">[</span><span class="n">index</span><span class="o">].</span><span class="na">getClass</span><span class="o">().</span><span class="na">getSimpleName</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">checkStr</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">&#34;Integer&#34;</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">paramTypes</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">=</span> <span class="kt">int</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">checkStr</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">&#34;Double&#34;</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">paramTypes</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">=</span> <span class="kt">double</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">checkStr</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">&#34;Boolean&#34;</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">paramTypes</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">=</span> <span class="kt">boolean</span><span class="o">.</span><span class="na">class</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">checkStr</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">&#34;String&#34;</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">paramTypes</span><span class="o">[</span><span class="n">index</span><span class="o">]</span> <span class="o">=</span> <span class="n">initParams</span><span class="o">[</span><span class="n">index</span><span class="o">].</span><span class="na">getClass</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">Constructor</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">constructor</span> <span class="o">=</span> <span class="n">classInstance</span><span class="o">.</span><span class="na">getDeclaredConstructor</span><span class="o">(</span><span class="n">paramTypes</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">constructor</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">entityObj</span> <span class="o">=</span> <span class="n">constructor</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">initParams</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">EntityCreator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">setValue</span><span class="o">(</span><span class="n">String</span> <span class="n">paramName</span><span class="o">,</span> <span class="n">Object</span> <span class="n">paramValue</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Field</span> <span class="n">field</span> <span class="o">=</span> <span class="n">classInstance</span><span class="o">.</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="n">paramName</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">field</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">field</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">entityObj</span><span class="o">,</span> <span class="n">paramValue</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">this</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">T</span> <span class="nf">build</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">entityObj</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>â€‹		å¦‚æ­¤ï¼Œå¯ç§»é™¤æ•´ä¸ªå†…éƒ¨ Builder ç±»ï¼ŒNutritionFacts ç±»ç§æœ‰æ„é€ çš„å‚æ•°ä»…åŒ…æ‹¬ä¸¤ä¸ªå¿…å¡«çš„ servingSizeã€servings å­—æ®µï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NutritionFacts</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Required parameters
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">servingSize</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">servings</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Optional parameters - initialized to default values
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">private</span> <span class="kt">int</span> <span class="n">calories</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">int</span> <span class="n">fat</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">int</span> <span class="n">sodium</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">int</span> <span class="n">carbohydrate</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">NutritionFacts</span><span class="o">(</span><span class="kt">int</span> <span class="n">servingSize</span><span class="o">,</span> <span class="kt">int</span> <span class="n">servings</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">servingSize</span> <span class="o">=</span> <span class="n">servingSize</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">servings</span> <span class="o">=</span> <span class="n">servings</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>è¯¥æ¡ˆä¾‹çš„å®¢æˆ·ç«¯ä»£ç æ”¹ä¸ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">NutritionFacts</span> <span class="n">cocaCola</span> <span class="o">=</span> <span class="k">new</span> <span class="n">EntityCreator</span><span class="o">&lt;&gt;(</span><span class="n">NutritionFacts</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">240</span><span class="o">,</span> <span class="n">8</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="s">&#34;calories&#34;</span><span class="o">,</span> <span class="n">100</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="s">&#34;sodium&#34;</span><span class="o">,</span> <span class="n">35</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">.</span><span class="na">setValue</span><span class="o">(</span><span class="s">&#34;carbohydrate&#34;</span><span class="o">,</span> <span class="n">27</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
</span></span></code></pre></div>]]></content:encoded>
    </item>
    
    <item>
      <title>ã€ŠEffective Java 3ã€‹ç¬”è®°1ï¼šé™æ€å·¥å‚æ–¹æ³•ä»£æ›¿æ„é€ å‡½æ•°</title>
      <link>https://blog.chensoul.com/posts/2023/04/03/static-factory-methods-instead-of-constructors/</link>
      <pubDate>Mon, 03 Apr 2023 12:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/04/03/static-factory-methods-instead-of-constructors/</guid>
      <description>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼Œåœ¨æ•´ç†ç¬”è®°è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ chatgpt çš„å¸®åŠ©åšäº†ä¸€äº›æ‰©å±•ã€‚ ä»‹ç» é™æ€å·¥å‚æ–¹æ³•æ˜¯æŒ‡åœ¨ç±»ä¸­å®šä¹‰ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œç”¨</description>
      <content:encoded><![CDATA[<p>æœ¬æ–‡æ˜¯ ã€ŠEffective Java 3ã€‹ç¬¬äºŒç« çš„å­¦ä¹ ç¬”è®°ï¼Œåœ¨æ•´ç†ç¬”è®°è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ chatgpt çš„å¸®åŠ©åšäº†ä¸€äº›æ‰©å±•ã€‚</p>
<h2 id="ä»‹ç»">ä»‹ç»</h2>
<p>é™æ€å·¥å‚æ–¹æ³•æ˜¯æŒ‡åœ¨ç±»ä¸­å®šä¹‰ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºè¯¥ç±»çš„å®ä¾‹ã€‚ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">static</span> <span class="n">Boolean</span> <span class="nf">valueOf</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">b</span> <span class="o">?</span> <span class="n">Boolean</span><span class="o">.</span><span class="na">TRUE</span> <span class="o">:</span> <span class="n">Boolean</span><span class="o">.</span><span class="na">FALSE</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>ä¸æ„é€ å‡½æ•°ä¸åŒçš„æ˜¯ï¼Œé™æ€å·¥å‚æ–¹æ³•å¯ä»¥æœ‰è‡ªå·±çš„åç§°ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®å‚æ•°çš„ä¸åŒè¿”å›ä¸åŒçš„å¯¹è±¡å®ä¾‹ã€‚</p>
<h2 id="ä¼˜ç‚¹">ä¼˜ç‚¹</h2>
<p>è¿™æœ¬ä¹¦ä¸­æåˆ°äº†ä¸€äº›é™æ€å·¥å‚æ–¹æ³•çš„ä¼˜ç‚¹ï¼ŒåŒ…æ‹¬ï¼š</p>
<ol>
<li>
<p>é™æ€å·¥å‚æ–¹æ³•å¯ä»¥æœ‰æ„ä¹‰çš„åç§°ï¼šä¸æ„é€ å‡½æ•°ä¸åŒï¼Œé™æ€å·¥å‚æ–¹æ³•å¯ä»¥æœ‰è‡ªå·±çš„åç§°ï¼Œè¿™ä½¿å¾—ä»£ç æ›´å…·æœ‰å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
<blockquote>
<p>ä¾‹å¦‚ï¼ŒBigInteger ç±»æä¾›äº†ä¸€ä¸ªè¿”å›ç´ æ•°çš„é™æ€å·¥å‚æ–¹æ³• <code>BigInteger.probablePrime</code> ã€‚</p>
</blockquote>
</li>
<li>
<p>é™æ€å·¥å‚æ–¹æ³•å¯ä»¥éšè—å®ç°ç»†èŠ‚ï¼šé™æ€å·¥å‚æ–¹æ³•å¯ä»¥éšè—å¯¹è±¡çš„åˆ›å»ºå’Œåˆå§‹åŒ–è¿‡ç¨‹ï¼Œä½¿å®¢æˆ·ç«¯ä»£ç æ›´åŠ ç®€æ´å’Œæ˜“äºç»´æŠ¤ã€‚</p>
<blockquote>
<p>è¿™æ˜¯æœåŠ¡æä¾›è€…æ¡†æ¶çš„åŸºç¡€ã€‚</p>
<p>æœåŠ¡æä¾›è€…æ¡†æ¶ä¸­æœ‰ä¸‰ä¸ªåŸºæœ¬ç»„ä»¶ï¼šæœåŠ¡æ¥å£ï¼Œä»£è¡¨è¦å®ç°çš„æœåŠ¡ï¼›æä¾›è€…æ³¨å†Œ APIï¼Œæä¾›è€…ä½¿ç”¨å®ƒæ¥æ³¨å†Œå®ç°ï¼Œä»¥åŠæœåŠ¡è®¿é—®
APIï¼Œå®¢æˆ·ç«¯ä½¿ç”¨å®ƒæ¥è·å–æœåŠ¡çš„å®ä¾‹ã€‚æœåŠ¡è®¿é—® API å…è®¸å®¢æˆ·ç«¯æŒ‡å®šé€‰æ‹©å®ç°çš„æ ‡å‡†ã€‚åœ¨æ²¡æœ‰è¿™äº›æ¡ä»¶çš„æƒ…å†µä¸‹ï¼ŒAPI
è¿”å›ä¸€ä¸ªé»˜è®¤å®ç°çš„å®ä¾‹ï¼Œæˆ–è€…å…è®¸å®¢æˆ·ç«¯å¾ªç¯ä½¿ç”¨æ‰€æœ‰å¯ç”¨çš„å®ç°ã€‚æœåŠ¡è®¿é—® API æ˜¯çµæ´»çš„é™æ€å·¥å‚ï¼Œå®ƒæ„æˆäº†æœåŠ¡æä¾›è€…æ¡†æ¶çš„åŸºç¡€ã€‚</p>
<p>æœåŠ¡æä¾›è€…æ¡†æ¶çš„ç¬¬å››ä¸ªå¯é€‰ç»„ä»¶æ˜¯æœåŠ¡æä¾›è€…æ¥å£ï¼Œå®ƒæè¿°äº†äº§ç”ŸæœåŠ¡æ¥å£å®ä¾‹çš„å·¥å‚å¯¹è±¡ã€‚åœ¨æ²¡æœ‰æœåŠ¡æä¾›è€…æ¥å£çš„æƒ…å†µä¸‹ï¼Œå¿…é¡»ä»¥åå°„çš„æ–¹å¼å®ä¾‹åŒ–å®ç°ã€‚</p>
<p>åœ¨ JDBC ä¸­ï¼Œ<code>Connection</code> æ‰®æ¼”æœåŠ¡æ¥å£çš„è§’è‰²ã€‚<code>DriverManager.registerDriver</code> æ˜¯æä¾›è€…æ³¨å†Œçš„
APIï¼Œ<code>DriverManager.getConnection</code> æ˜¯æœåŠ¡è®¿é—® APIï¼Œ<code>Driver</code> æ˜¯æœåŠ¡æä¾›è€…æ¥å£ã€‚</p>
<p>æœåŠ¡æä¾›è€…æ¡†æ¶æ¨¡å¼æœ‰è®¸å¤šå˜ä½“ã€‚ä¾‹å¦‚ï¼ŒæœåŠ¡è®¿é—® API å¯ä»¥å‘å®¢æˆ·ç«¯è¿”å›æ¯”æä¾›è€…æä¾›çš„æ›´ä¸°å¯Œçš„æœåŠ¡æ¥å£ï¼Œè¿™æ˜¯æ¡¥æ¥æ¨¡å¼ã€‚ä¾èµ–æ³¨å…¥æ¡†æ¶å¯ä»¥çœ‹ä½œæ˜¯å¼ºå¤§çš„æœåŠ¡æä¾›è€…ã€‚ç”±äºæ˜¯
Java 6ï¼Œè¯¥å¹³å°åŒ…æ‹¬ä¸€ä¸ªé€šç”¨æœåŠ¡æä¾›è€…æ¡†æ¶ <code>Java.util.ServiceLoader</code>ï¼Œæ‰€ä»¥ä½ ä¸éœ€è¦ï¼Œé€šå¸¸ä¹Ÿä¸åº”è¯¥è‡ªå·±å†™ã€‚JDBC ä¸ä½¿ç”¨
ServiceLoaderï¼Œå› ä¸ºå‰è€…æ¯”åè€…è¦æ—©ã€‚</p>
</blockquote>
</li>
<li>
<p>é™æ€å·¥å‚æ–¹æ³•å¯ä»¥è¿”å›ç¼“å­˜çš„å¯¹è±¡ï¼šé™æ€å·¥å‚æ–¹æ³•å¯ä»¥è¿”å›ç¼“å­˜çš„å¯¹è±¡ï¼Œè¿™é¿å…äº†åˆ›å»ºæ–°å¯¹è±¡çš„å¼€é”€ï¼Œæé«˜äº†æ€§èƒ½ã€‚</p>
<blockquote>
<p>è¿™ç§æŠ€æœ¯ç±»ä¼¼äºäº«å…ƒæ¨¡å¼ã€‚å¦‚æœç»å¸¸è¯·æ±‚ç›¸åŒçš„å¯¹è±¡ï¼Œç‰¹åˆ«æ˜¯åœ¨åˆ›å»ºå¯¹è±¡çš„ä»£ä»·å¾ˆé«˜æ—¶ï¼Œå®ƒå¯ä»¥æå¤§åœ°æé«˜æ€§èƒ½ã€‚</p>
</blockquote>
<p><strong>ä¸¾ä¾‹ 1ï¼šä½¿ç”¨ ConcurrentHashMap</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThreadSafeCache</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">ThreadSafeCache</span><span class="o">&gt;</span> <span class="n">instances</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">ThreadSafeCache</span><span class="o">()</span> <span class="o">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">ThreadSafeCache</span> <span class="nf">getInstance</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">instances</span><span class="o">.</span><span class="na">computeIfAbsent</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">k</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="n">ThreadSafeCache</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>computeIfAbsent</code> æ–¹æ³•ç”¨äºè®¡ç®—ç¼“å­˜å¯¹è±¡ã€‚å¦‚æœ <code>key</code> åœ¨ <code>instances</code> ä¸­ä¸å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨ lambda
è¡¨è¾¾å¼ <code>k -&gt; new ThreadSafeCache()</code> åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>ThreadSafeCache</code> å¯¹è±¡ï¼Œå¹¶å°†è¯¥å¯¹è±¡ä¸ <code>key</code> å…³è”ã€‚å¦‚æœ <code>key</code>
å·²ç»å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›ä¸ä¹‹å…³è”çš„ <code>ThreadSafeCache</code> å¯¹è±¡ã€‚</p>
<p>ä½¿ç”¨ <code>computeIfAbsent</code> æ–¹æ³•å¯ä»¥æ›´ç®€æ´åœ°å®ç°çº¿ç¨‹å®‰å…¨çš„ç¼“å­˜ç±»ï¼Œå¹¶ä¸”å¯ä»¥ç¡®ä¿åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„çº¿ç¨‹å®‰å…¨æ€§ã€‚</p>
</li>
</ol>
<p><strong>ä¸¾ä¾‹ 2ï¼šä½¿ç”¨ synchronized å…³é”®å­—</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ThreadSafeCache</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">ThreadSafeCache</span><span class="o">&gt;</span> <span class="n">instances</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">ThreadSafeCache</span><span class="o">()</span> <span class="o">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">synchronized</span> <span class="n">ThreadSafeCache</span> <span class="nf">getInstance</span><span class="o">(</span><span class="n">String</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(!</span><span class="n">instances</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">key</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">instances</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="k">new</span> <span class="n">ThreadSafeCache</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">instances</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><ol start="4">
<li>
<p>é™æ€å·¥å‚æ–¹æ³•å¯ä»¥è¿”å›å­ç±»å¯¹è±¡ï¼šé™æ€å·¥å‚æ–¹æ³•å¯ä»¥è¿”å›å®ç°äº†æŸä¸ªæ¥å£æˆ–ç»§æ‰¿äº†æŸä¸ªç±»çš„å­ç±»å¯¹è±¡ï¼Œè¿™æé«˜äº†ä»£ç çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚</p>
<blockquote>
<p>ä¾‹å¦‚ï¼ŒJava çš„ Collections æ¡†æ¶æœ‰ 45
ä¸ªæ¥å£å®ç”¨å·¥å…·å®ç°ï¼Œæä¾›äº†ä¸å¯ä¿®æ”¹çš„é›†åˆã€åŒæ­¥é›†åˆç­‰ã€‚å‡ ä¹æ‰€æœ‰è¿™äº›å®ç°éƒ½æ˜¯é€šè¿‡ä¸€ä¸ªéå®ä¾‹åŒ–ç±»ï¼ˆ<code>java.util.Collections</code>
ï¼‰ä¸­çš„é™æ€å·¥å‚æ–¹æ³•å¯¼å‡ºçš„ã€‚è¿”å›å¯¹è±¡çš„ç±»éƒ½æ˜¯ç§æœ‰çš„å­ç±»ã€‚</p>
</blockquote>
<p><strong>ä¸¾ä¾‹ï¼š</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Shape</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">draw</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Circle</span> <span class="kd">implements</span> <span class="n">Shape</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Drawing Circle&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Square</span> <span class="kd">implements</span> <span class="n">Shape</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Drawing Square&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ShapeFactory</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Shape</span> <span class="nf">getShape</span><span class="o">(</span><span class="n">String</span> <span class="n">shapeType</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">shapeType</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">shapeType</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">&#34;CIRCLE&#34;</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">new</span> <span class="n">Circle</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">shapeType</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">&#34;SQUARE&#34;</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="k">new</span> <span class="n">Square</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>ShapeFactory</code> ç±»ä½¿ç”¨é™æ€å·¥å‚æ–¹æ³• <code>getShape</code> æ¥åˆ›å»º <code>Shape</code> å¯¹è±¡ã€‚å¦‚æœ <code>shapeType</code> å‚æ•°ä¸º <code>CIRCLE</code>
ï¼Œåˆ™åˆ›å»º <code>Circle</code> å¯¹è±¡å¹¶è¿”å›ï¼Œå¦‚æœå‚æ•°ä¸º <code>SQUARE</code>ï¼Œåˆ™åˆ›å»º <code>Square</code> å¯¹è±¡å¹¶è¿”å›ã€‚</p>
</li>
<li>
<p>é™æ€å·¥å‚æ–¹æ³•å¯ä»¥è¿”å›ä¸å¯å˜å¯¹è±¡ï¼šé™æ€å·¥å‚æ–¹æ³•å¯ä»¥è¿”å›ä¸å¯å˜å¯¹è±¡ï¼Œè¿™ç¡®ä¿äº†å¯¹è±¡çš„å®‰å…¨æ€§å’Œçº¿ç¨‹å®‰å…¨æ€§ã€‚</p>
<p><strong>ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">ThreadSafeImmutableClass</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="nf">ThreadSafeImmutableClass</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="n">ThreadSafeImmutableClass</span> <span class="nf">getInstance</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">ThreadSafeImmutableClass</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>ThreadSafeImmutableClass</code> ç±»ä½¿ç”¨é™æ€å·¥å‚æ–¹æ³• <code>getInstance</code>
æ¥åˆ›å»ºä¸å¯å˜å¯¹è±¡ã€‚ç”±äºè¯¥ç±»çš„å±æ€§éƒ½æ˜¯ <code>final</code> çš„ï¼Œå› æ­¤è¯¥å¯¹è±¡æ˜¯ä¸å¯å˜çš„ã€‚ç”±äºæ²¡æœ‰ä»»ä½•çŠ¶æ€å¯ä»¥ä¿®æ”¹ï¼Œå› æ­¤è¯¥å¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
</li>
</ol>
<h2 id="ç¼ºç‚¹">ç¼ºç‚¹</h2>
<p>ä½¿ç”¨é™æ€å·¥å‚æ–¹æ³•ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ï¼Œä¾‹å¦‚ï¼š</p>
<ol>
<li>é™æ€å·¥å‚æ–¹æ³•å¯èƒ½ä¼šå¯¼è‡´ä»£ç çš„å¯æµ‹è¯•æ€§å˜å·®ï¼Œå› ä¸ºå®ƒä»¬å¾€å¾€æ˜¯é™æ€çš„ï¼Œéš¾ä»¥è¿›è¡Œæ¨¡æ‹Ÿå’Œæ›¿æ¢ã€‚</li>
<li>é™æ€å·¥å‚æ–¹æ³•å¯èƒ½ä¼šä½¿ä»£ç çš„æ‰©å±•æ€§å˜å·®ï¼Œå› ä¸ºå®ƒä»¬é€šå¸¸æ˜¯é™æ€çš„ï¼Œéš¾ä»¥æ‰©å±•å’Œä¿®æ”¹ã€‚</li>
<li>é™æ€å·¥å‚æ–¹æ³•å¯èƒ½ä¼šä½¿ä»£ç çš„å¯è¯»æ€§å˜å·®ï¼Œå› ä¸ºå®ƒä»¬å¾€å¾€æ˜¯è‡ªå®šä¹‰çš„ï¼Œéš¾ä»¥ç†è§£å’Œç»´æŠ¤ã€‚</li>
</ol>
<p>ä»…æä¾›é™æ€å·¥å‚æ–¹æ³•ä¹Ÿå­˜åœ¨ä¸€äº›å±€é™ï¼š</p>
<ol>
<li>ä¸å¯ç»§æ‰¿ï¼šé™æ€å·¥å‚æ–¹æ³•æ˜¯é€šè¿‡ç±»åç›´æ¥è°ƒç”¨çš„ï¼Œå› æ­¤æ— æ³•é€šè¿‡ç»§æ‰¿æ¥åˆ›å»ºå¯¹è±¡çš„å˜ä½“æˆ–å­ç±»å¯¹è±¡ã€‚</li>
<li>å¯èƒ½éš¾ä»¥æ‰©å±•ï¼šå¦‚æœåœ¨å®ç°é™æ€å·¥å‚æ–¹æ³•æ—¶æ²¡æœ‰è€ƒè™‘åˆ°æ‰€æœ‰å¯èƒ½çš„ç”¨ä¾‹ï¼Œé‚£ä¹ˆåœ¨éœ€è¦æ·»åŠ æ–°åŠŸèƒ½æˆ–å¯¹è±¡ç±»å‹æ—¶å¯èƒ½ä¼šå¾ˆéš¾æ‰©å±•ã€‚</li>
<li>å¯èƒ½éš¾ä»¥æµ‹è¯•ï¼šå¦‚æœé™æ€å·¥å‚æ–¹æ³•ä¸­åŒ…å«å¤æ‚çš„é€»è¾‘æˆ–ä¾èµ–å¤–éƒ¨èµ„æºï¼Œé‚£ä¹ˆåœ¨æµ‹è¯•æ—¶å¯èƒ½ä¼šå¾ˆéš¾æ¨¡æ‹Ÿæˆ–æ›¿æ¢è¿™äº›ä¾èµ–é¡¹ã€‚</li>
<li>å¯èƒ½ä¼šå¼•èµ·æ··æ·†ï¼šå¦‚æœåœ¨åŒä¸€ä¸ªç±»ä¸­å®šä¹‰å¤šä¸ªé™æ€å·¥å‚æ–¹æ³•ï¼Œå®ƒä»¬å¯èƒ½å…·æœ‰ç›¸ä¼¼çš„åç§°æˆ–å‚æ•°ç±»å‹ï¼Œä»è€Œå¯èƒ½ä¼šå¯¼è‡´æ··æ·†æˆ–è¯¯ç”¨ã€‚</li>
<li>å¯¹è±¡åˆ›å»ºå¯èƒ½è¾ƒæ…¢ï¼šå¦‚æœåˆ›å»ºå¯¹è±¡éœ€è¦è¿›è¡Œå¤æ‚çš„è®¡ç®—æˆ–ä¾èµ–å¤§é‡çš„å¤–éƒ¨èµ„æºï¼Œé‚£ä¹ˆé™æ€å·¥å‚æ–¹æ³•å¯èƒ½ä¼šå¯¼è‡´å¯¹è±¡åˆ›å»ºçš„æ€§èƒ½é—®é¢˜ã€‚</li>
</ol>
<p>æ‰€ä»¥ï¼Œåœ¨é€‰æ‹©ä¸åŒçš„é™æ€å·¥å‚æ–¹æ³•æ—¶ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªå› ç´ ï¼š</p>
<ol>
<li>ç›®çš„ï¼šè€ƒè™‘æ¯ä¸ªå·¥å‚æ–¹æ³•çš„ç›®çš„ï¼Œä»¥åŠå®ƒæ˜¯å¦ç¬¦åˆæ‚¨çš„éœ€æ±‚ã€‚ä¸åŒçš„å·¥å‚æ–¹æ³•å¯èƒ½æœ‰ä¸åŒçš„ç›®çš„ï¼Œä¾‹å¦‚åˆ›å»ºæ–°å¯¹è±¡ã€è¿”å›å…±äº«å®ä¾‹æˆ–ä»ä¸€ç§ç±»å‹è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹ã€‚</li>
<li>çµæ´»æ€§ï¼šè€ƒè™‘æ¯ä¸ªå·¥å‚æ–¹æ³•çš„çµæ´»æ€§ã€‚æŸäº›å·¥å‚æ–¹æ³•å¯èƒ½æ¯”å…¶ä»–å·¥å‚æ–¹æ³•æ›´çµæ´»ï¼Œå…è®¸æ›´å¤šçš„è‡ªå®šä¹‰æˆ–é…ç½®é€‰é¡¹ã€‚</li>
<li>å¯è¯»æ€§ï¼šè€ƒè™‘å·¥å‚æ–¹æ³•çš„å¯è¯»æ€§ã€‚å¥½çš„å·¥å‚æ–¹æ³•åº”è¯¥æ˜“äºé˜…è¯»å’Œç†è§£ï¼Œå…·æœ‰æ¸…æ™°çš„åç§°å’Œæ˜ç¡®çš„å‚æ•°ã€‚</li>
<li>æ€§èƒ½ï¼šè€ƒè™‘æ¯ä¸ªå·¥å‚æ–¹æ³•çš„æ€§èƒ½å½±å“ã€‚æ ¹æ®å…·ä½“çš„ç”¨ä¾‹ï¼ŒæŸäº›å·¥å‚æ–¹æ³•å¯èƒ½æ¯”å…¶ä»–å·¥å‚æ–¹æ³•æ›´é«˜æ•ˆæˆ–æ›´å¿«ã€‚</li>
<li>å…¼å®¹æ€§ï¼šè€ƒè™‘å·¥å‚æ–¹æ³•æ˜¯å¦ä¸æ‚¨ç°æœ‰çš„ä»£ç åº“å’Œç¬¬ä¸‰æ–¹åº“å…¼å®¹ã€‚æ ¹æ®å…·ä½“çš„æŠ€æœ¯å’Œæ¡†æ¶ï¼ŒæŸäº›å·¥å‚æ–¹æ³•å¯èƒ½æ¯”å…¶ä»–å·¥å‚æ–¹æ³•æ›´å…¼å®¹ã€‚</li>
<li>ç»´æŠ¤ï¼šè€ƒè™‘æ¯ä¸ªå·¥å‚æ–¹æ³•çš„ç»´æŠ¤å½±å“ã€‚æ ¹æ®å®ç°çš„å¤æ‚æ€§ä»¥åŠæ–‡æ¡£å’Œæ”¯æŒçš„å¯ç”¨æ€§ï¼ŒæŸäº›å·¥å‚æ–¹æ³•å¯èƒ½æ¯”å…¶ä»–å·¥å‚æ–¹æ³•æ›´æ˜“äºç»´æŠ¤ã€‚</li>
</ol>
<h2 id="ä½¿ç”¨">ä½¿ç”¨</h2>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§é™æ€å·¥å‚æ–¹æ³•çš„åç§°ï¼š</p>
<ul>
<li>
<p><code>from</code>ï¼Œç”¨äºä»å…¶ä»–ç±»å‹çš„å¯¹è±¡æˆ–æ•°æ®æºä¸­åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œä¾‹å¦‚ <code>Date.from</code> å’Œ <code>Duration.from</code>ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Date</span> <span class="n">d</span> <span class="o">=</span> <span class="n">Date</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">instant</span><span class="o">);</span>
</span></span></code></pre></div></li>
<li>
<p><code>of</code>ï¼Œä¸€ä¸ªèšåˆæ–¹æ³•ï¼Œå®ƒæ¥å—å¤šä¸ªå‚æ•°å¹¶è¿”å›ä¸€ä¸ªåŒ…å«è¿™äº›å‚æ•°çš„å®ä¾‹ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Set</span><span class="o">&lt;</span><span class="n">Rank</span><span class="o">&gt;</span> <span class="n">faceCards</span> <span class="o">=</span> <span class="n">EnumSet</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">JACK</span><span class="o">,</span> <span class="n">QUEEN</span><span class="o">,</span> <span class="n">KING</span><span class="o">);</span>
</span></span></code></pre></div></li>
<li>
<p><code>valueOf</code>ï¼Œä¸€ç§æ›¿ä»£ <code>from</code> å’Œ <code>of</code> ä½†æ›´å†—é•¿çš„æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">BigInteger</span> <span class="n">prime</span> <span class="o">=</span> <span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">);</span>
</span></span></code></pre></div></li>
<li>
<p><code>instance</code> æˆ– <code>getInstance</code>ï¼Œè¿”å›ä¸€ä¸ªå®ä¾‹ï¼Œè¯¥å®ä¾‹ç”±å…¶å‚æ•°ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰æè¿°ï¼Œä½†ä¸å…·æœ‰ç›¸åŒçš„å€¼ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">StackWalker</span> <span class="n">luke</span> <span class="o">=</span> <span class="n">StackWalker</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">options</span><span class="o">);</span>
</span></span></code></pre></div></li>
<li>
<p><code>create</code> æˆ– <code>newInstance</code>ï¼Œä¸ <code>instance</code> æˆ– <code>getInstance</code> ç±»ä¼¼ï¼Œåªæ˜¯è¯¥æ–¹æ³•ä¿è¯æ¯ä¸ªè°ƒç”¨éƒ½è¿”å›ä¸€ä¸ªæ–°å®ä¾‹ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Object</span> <span class="n">newArray</span> <span class="o">=</span> <span class="n">Array</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">classObject</span><span class="o">,</span> <span class="n">arrayLen</span><span class="o">);</span>
</span></span></code></pre></div></li>
<li>
<p><code>getType</code>ï¼Œç±»ä¼¼äº <code>getInstance</code>ï¼Œä½†å¦‚æœå·¥å‚æ–¹æ³•ä½äºä¸åŒçš„ç±»ä¸­ï¼Œåˆ™ä½¿ç”¨æ­¤æ–¹æ³•ã€‚å…¶ç±»å‹æ˜¯å·¥å‚æ–¹æ³•è¿”å›çš„å¯¹è±¡ç±»å‹ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">FileStore</span> <span class="n">fs</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">getFileStore</span><span class="o">(</span><span class="n">path</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Runtime</span> <span class="n">runtime</span> <span class="o">=</span> <span class="n">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">();</span>
</span></span></code></pre></div></li>
<li>
<p><code>newType</code>ï¼Œä¸ <code>newInstance</code> ç±»ä¼¼ï¼Œä½†æ˜¯å¦‚æœå·¥å‚æ–¹æ³•åœ¨ä¸åŒçš„ç±»ä¸­ä½¿ç”¨ã€‚ç±»å‹æ˜¯å·¥å‚æ–¹æ³•è¿”å›çš„å¯¹è±¡ç±»å‹ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">BufferedReader</span> <span class="n">br</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">newBufferedReader</span><span class="o">(</span><span class="n">path</span><span class="o">);</span>
</span></span></code></pre></div></li>
<li>
<p><code>type</code>ï¼Œä¸€ä¸ªç”¨æ¥æ›¿ä»£ <code>getType</code> å’Œ <code>newType</code> çš„æ¯”è¾ƒç®€å•çš„æ–¹å¼ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">Complaint</span><span class="o">&gt;</span> <span class="n">litany</span> <span class="o">=</span> <span class="n">Collections</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="n">legacyLitany</span><span class="o">);</span>
</span></span></code></pre></div></li>
<li>
<p><code>parse</code>ï¼šç”¨äºä»å­—ç¬¦ä¸²æˆ–å…¶ä»–æ ¼å¼ä¸­è§£æå‡ºä¸€ä¸ªå¯¹è±¡ï¼Œä¾‹å¦‚ <code>LocalDate.parse</code> å’Œ <code>NumberFormat.parse</code>ã€‚</p>
</li>
<li>
<p><code>build</code>ï¼šç”¨äºæ„å»ºä¸€ä¸ªå¯¹è±¡ï¼Œä¾‹å¦‚ <code>RequestBuilder.build</code> å’Œ <code>ResponseBuilder.build</code>ã€‚</p>
</li>
</ul>
<p>è¿˜æœ‰ä¸€äº›å¸¸ç”¨çš„é™æ€å·¥å‚æ–¹æ³•åç§°ï¼š</p>
<ol>
<li><code>asXxx</code>ï¼šç”¨äºå°†è¯¥ç±»çš„å¯¹è±¡è½¬æ¢ä¸ºå…¶ä»–ç±»å‹çš„å¯¹è±¡ï¼Œä¾‹å¦‚ <code>ByteBuffer.asCharBuffer</code> å’Œ <code>FileChannel.asIntBuffer</code>ã€‚</li>
<li><code>toXxx</code>ï¼šç”¨äºå°†è¯¥ç±»çš„å¯¹è±¡è½¬æ¢ä¸ºå…¶ä»–ç±»å‹çš„å¯¹è±¡ï¼Œä¾‹å¦‚ <code>BigInteger.toByteArray</code> å’Œ <code>String.toCharArray</code>ã€‚</li>
<li><code>getXXX</code>ï¼šç”¨äºè·å–æŸä¸ªå¯¹è±¡ï¼Œä¾‹å¦‚ <code>TimeZone.getDefault</code>ã€‚</li>
<li><code>newXxx</code>ï¼šç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œä¾‹å¦‚ <code>File.newFile</code> å’Œ <code>Thread.newThread</code>ã€‚</li>
<li><code>withXxx</code>ï¼šç”¨äºåˆ›å»ºä¸€ä¸ªä¿®æ”¹äº†æŒ‡å®šå±æ€§çš„å¯¹è±¡çš„å‰¯æœ¬ï¼Œä¾‹å¦‚ <code>LocalDate.withYear</code> å’Œ <code>HttpHeaders.withAccept</code>ã€‚</li>
<li><code>forXxx</code>ï¼šç”¨äºåˆ›å»ºä¸€ä¸ªä¸æŒ‡å®šå‚æ•°ç›¸å…³çš„å¯¹è±¡ï¼Œä¾‹å¦‚ <code>Charset.forName</code> å’Œ <code>ThreadLocalRandom.forWeb</code>ã€‚</li>
</ol>
]]></content:encoded>
    </item>
    
    <item>
      <title>å‘¨æŠ¥-12ï½œè½¦è¾†è¢«å µã€å¼€è½¦æ€»ç»“ã€Effective Java3ç¬”è®°</title>
      <link>https://blog.chensoul.com/posts/2023/03/28/weekly_review_12/</link>
      <pubDate>Tue, 28 Mar 2023 09:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/03/28/weekly_review_12/</guid>
      <description>å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-03-20 åˆ° 2023-03-26 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚ ä¸Šå‘¨å»åŒæµåŒ»é™¢æ£€æŸ¥é¼¾ç—‡ï¼Œæ£€æŸ¥ç»“æœæ˜¯è½»åº¦ç—‡çŠ¶ï¼ŒåŒ»ç”Ÿ</description>
      <content:encoded><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-12-01.jpeg" alt="weekly-review-12-01"  />
</p>
<p>æœ¬ç¯‡æ˜¯å¯¹ <code>2023-03-20</code> åˆ° <code>2023-03-26</code> è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº <a href="https://blog.chensoul.com/">åšå®¢</a>ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚</p>
<p>ä¸Šå‘¨å»åŒæµåŒ»é™¢æ£€æŸ¥é¼¾ç—‡ï¼Œæ£€æŸ¥ç»“æœæ˜¯è½»åº¦ç—‡çŠ¶ï¼ŒåŒ»ç”Ÿå»ºè®®å¤šè¿åŠ¨å‡è‚¥ã€‚è¿™å‘¨æ¯å¤©èµ°è·¯ 1 ä¸‡æ­¥çš„ç›®æ ‡å·²è¾¾æˆã€‚</p>
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-12-02.png" alt="weekly-review-12-02" style="width:50%;" />
<p>å·¥ä½œä¸Šå‘å¸ƒäº†ä¸€ä¸ªç‰ˆæœ¬ï¼Œå¦å¤–ä¸¤ä¸ªè¿­ä»£æ­£åœ¨è¿›è¡Œä¸­ï¼Œé¢„è®¡è¿™å‘¨å†å‘å¸ƒä¸€ä¸ªç‰ˆæœ¬ã€‚ä»é£ä¹¦é€šè®¯å½•çœ‹åˆ°åˆæœ‰ä¸‰ä¸ªéæŠ€æœ¯ç±»åŒäº‹è¢«è£ï¼Œè¿™å‘¨å‘¨ä¼šï¼Œéƒ¨é—¨é¢†å¯¼è¯´æœ€è¿‘åˆæœ‰ä¸€ä¸ªåšå•†åŠ¡çš„åŒäº‹è¢«ä¼˜åŒ–äº†ã€‚</p>
<p>ä¸Šå‘¨æœ‰ä¸€å¤©æ—©ä¸Šï¼Œè½¦å­åœåœ¨å°åŒºé‡Œé¢ï¼Œè¢«ä¸¤ä¸ªè½¦å­æŒ¡ä½äº†å‰åé“è·¯ï¼Œè”ç³»ä¸ä¸Šè½¦ä¸»ï¼Œåªå¥½ååœ°é“ä¸Šç­ã€‚è¯è¯´ï¼Œè‡ªä»å¼€è½¦ä¸Šç­ä¹‹åï¼Œä½¿ç”¨æ‰‹æœºçš„é¢‘ç‡æ˜æ˜¾é™ä½äº†å¾ˆå¤šã€‚</p>
<p>ä¸Šå‘¨æœ«é˜³å…‰æ­£å¥½ï¼Œäºæ˜¯å›å®¶å»ç»™å·²æ•…çš„äº²äººæ‰«å¢“ã€‚å‘¨å…­å›è€å®¶ï¼Œå‘¨æ—¥å›è€å©†å®¶ã€‚é€è€…å·²é€ï¼Œæ´»ç€çš„äººè¦å–„å¾…è‡ªå·±ï¼Œå¥½å¥½åƒé¥­ï¼Œå¥½å¥½ç¡è§‰ï¼Œå¥½å¥½å·¥ä½œï¼Œå¥½å¥½è¿åŠ¨ã€‚</p>
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-12-03.jpeg" alt="weekly-review-12-03" style="width:50%;" />
<h2 id="å·¥ä½œ">å·¥ä½œ</h2>
<h3 id="effective-java-3-ç¬”è®°">Effective Java 3 ç¬”è®°</h3>
<p>è¯·å‚è€ƒ <a href="/posts/2023/04/03/static-factory-methods-instead-of-constructors/">ã€ŠEffective Java 3ã€‹ç¬”è®°ï¼šé™æ€å·¥å‚æ–¹æ³•ä»£æ›¿æ„é€ å‡½æ•°</a>ã€‚</p>
<h3 id="machine-learning-with-go">Machine-Learning-With-Go</h3>
<p>Bç«™è§†é¢‘ï¼š<a href="https://www.bilibili.com/video/BV1iW411w7ev">ã€Œè¯¾ç¨‹ã€ä½¿ç”¨Goåšæœºå™¨å­¦ä¹ </a></p>
<p>æºä»£ç ï¼š<a href="https://github.com/PacktPublishing/Machine-Learning-With-Go">Machine-Learning-With-Go</a></p>
<h2 id="ç”Ÿæ´»">ç”Ÿæ´»</h2>
<h3 id="è½¦è¾†è¢«å µ">è½¦è¾†è¢«å µ</h3>
<p>æ—©ä¸Šå‡†å¤‡å¼€è½¦ä¸Šç­ï¼Œå‘ç°è½¦å­å‰åé“è·¯éƒ½è¢«è½¦è¾†å é“äº†ã€‚å‰é¢è½¦è¾†å é“ï¼Œæ˜¨å¤©æ™šä¸Šä¸‹ç­å›æ¥å°±å‘ç°äº†ï¼Œä¹Ÿç¡®è®¤äº†è¿™ä¸ªè½¦è¾†æ²¡æœ‰ç•™æŒªè½¦ç”µè¯ã€‚å½“æ—¶å°±éšéšæ‹…å¿§ä»Šå¤©æ—©ä¸Šä¼šè¢«æŒ¡ä½å‰åé“è·¯ã€‚æ²¡æœ‰æƒ³åˆ°ï¼ŒçœŸçš„è¢«æŒ¡äº†ã€‚åé¢çš„è½¦è¾†ç•™äº†æŒªè½¦ç”µè¯ã€‚å…­ç‚¹åŠå¼€å§‹ï¼Œæˆ‘å°±ç»™åé¢è½¦çš„è½¦ä¸»æ‰“ç”µè¯å‘çŸ­ä¿¡ï¼Œå¯¹æ–¹ä¸€ç›´æ²¡æ¥ç”µè¯ï¼Œä¼°è®¡æ‰‹æœºè°ƒé™éŸ³è¿˜åœ¨ç¡è§‰å§ã€‚æ²¡æœ‰æƒ³åˆ°çš„æ˜¯ï¼Œæˆªæ­¢åˆ°ç°åœ¨æ—¶é—´å…«ç‚¹ï¼Œä»–è¿˜æ²¡æœ‰ç»™æˆ‘å›ç”µè¯ï¼Œè¿™å“¥ä»¬ç¡å¾—é‚£æ˜¯çœŸé¦™å•Šã€‚</p>
<p>åœ¨é“è·¯è¢«å ç”¨ä¹‹åï¼Œæˆ‘åšäº†ä»€ä¹ˆï¼Ÿé™¤äº†ç»™ç•™äº†å·ç çš„é‚£ä¸ªè½¦ä¸»æ‰“ç”µè¯ä¹‹å¤–ï¼Œæˆ‘è¿˜æƒ³åˆ°äº¤ç®¡ 12123 APP ä¸Šé¢æœ‰ä¸€ä¸ªä¸€é”®æŒªè½¦åŠŸèƒ½ã€‚äºæ˜¯ï¼Œè¯•äº†ä¸€ä¸‹è¿™ä¸ªåŠŸèƒ½ã€‚åŸä»¥ä¸ºè¿™ä¸ªåŠŸèƒ½å¯ä»¥ç”µè¯é€šçŸ¥åˆ°å¯¹æ–¹æŒªè½¦ã€‚å®é™…æƒ…å†µå´åªæ˜¯æäº¤äº†ä¸€ä¸ªå·¥å•è€Œå·²ï¼ŒçœŸæ˜¯ä¸€ä¸ªé¸¡è‚‹çš„åŠŸèƒ½ã€‚ç”¨æˆ·ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Œæ˜¯å¸Œæœ›åŠæ—¶è”ç³»åˆ°è½¦ä¸»è¿‡æ¥æŒªè½¦ï¼Œè€Œä¸æ˜¯æäº¤ä¸€ä¸ªå·¥å•ä¹‹åï¼Œå‚»å‚»çš„ç­‰å¾…ã€‚å¦å¤–ï¼Œè¿™ä¸ªåŠŸèƒ½ä¹Ÿä¸èƒ½å«ä¸€é”®æŒªè½¦ï¼Œå› ä¸ºç‚¹å‡»äº†è¿™ä¸ªåŠŸèƒ½ä¹‹åï¼Œè¿˜è¦è¾“å…¥è½¦ç‰Œå·ã€ä¸Šä¼ ç…§ç‰‡ã€‚æ›´å¥½çš„ä½“éªŒåº”è¯¥æ˜¯åªç”¨ä¸Šä¼ å ç”¨é“è·¯çš„è½¦è¾†ç…§ç‰‡ï¼Œç”±ç³»ç»Ÿè¯†åˆ«å‡ºè½¦ç‰Œå·ï¼Œç„¶ååå°æ‰¾åˆ°è½¦ä¸»çš„æ‰‹æœºå·ï¼Œç”Ÿæˆä¸€ä¸ªä¸´æ—¶å·ç å¹¶è°ƒç”¨æ‰‹æœºçš„æ‹¨å·åŠŸèƒ½ã€‚</p>
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-12-04.jpeg" alt="weekly-review-12-04" style="width:50%;" />
<p>åœ¨é“è·¯è¢«å ç”¨ä¹‹åï¼Œæˆ‘çš„å¿ƒæ€æ˜¯æ€æ ·çš„ï¼Ÿåˆšå¼€å§‹æƒ³ç”Ÿæ°”æ„¤æ€’ï¼Œåæ¥æƒ³äº†æƒ³ï¼Œäº‹å·²è‡³æ­¤ï¼Œæ²¡æœ‰å¿…è¦ç”Ÿæ°”ï¼Œç”Ÿæ°”åªèƒ½å½±å“è‡ªå·±ä¸€å¤©çš„å¿ƒæƒ…å’Œå¥½è¿ã€‚å¹¶å°è¯•æŠŠè¿™ç§å¯¹è‡ªå·±ä¸åˆ©çš„ä¸€é¢è½¬åŒ–ä¸ºå¯¹è‡ªå·±æœ‰åˆ©çš„ä¸€é¢ã€‚åŸæƒ³å…­ç‚¹åŠå¼€è½¦ä¸Šç­ï¼Œé“è·¯è¢«å ä¹‹åï¼Œå°±å¯ä»¥ä½“éªŒä¸€ä¸‹ä¸ƒç‚¹å¤šç”šè‡³å…«ç‚¹å¤šå¼€è½¦ä¸Šç­éœ€è¦å¤šé•¿æ—¶é—´ä»¥åŠæ˜¯å¦å µè½¦ã€‚</p>
<p>å¦‚æœæ˜¯æˆ‘æŠŠé“è·¯å ç”¨äº†ï¼Œæˆ‘è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿé¦–å…ˆï¼Œæ˜¯è½¦ä¸Šç•™ä¸€ä¸ªæ‰‹æœºå·ç ï¼›å…¶æ¬¡ï¼Œæ˜¯ç¬¬äºŒå¤©æ—©ä¸Šä¿è¯æ‰‹æœºä¸å…³æœºå¹¶ä¸”æ²¡æœ‰é™éŸ³ã€‚</p>
<p>å¦‚ä½•é¿å…å†æ¬¡å‡ºç°è¿™æ ·çš„æƒ…å†µå‘¢ï¼Ÿä¸€æ˜¯é€šè¿‡ç”µè¯æˆ–è€…ä¾¿æ¡çš„å½¢å¼æé†’è½¦ä¸»è¦åœ¨è½¦ä¸Šç•™ä¸€ä¸ªæŒªè½¦ç”µè¯å¹¶ä¿è¯ç”µè¯ç•…é€šï¼ŒäºŒæ˜¯åé¦ˆç»™ç‰©ä¸šè®©ç‰©ä¸šæ¥æé†’å°åŒºé‡Œçš„è½¦ä¸»ä¸è¦éšæ„å ç”¨è½¦é“ã€‚</p>
<h3 id="å¼€è½¦æ€»ç»“">å¼€è½¦æ€»ç»“</h3>
<p>å­¦åˆ°äº†æ–°çŸ¥è¯†ï¼š</p>
<ul>
<li>å­¦ä¼šäº†å¦‚ä½•è°ƒèŠ‚å‰ç¯çš„é«˜åº¦ã€‚æ•°å­—è¶Šå¤§ï¼Œç¯å…‰ç…§å°„çš„è¶Šè¿‘ã€‚</li>
</ul>
<p>å¼€è½¦éœ€è¦æ”¹è¿›çš„åœ°æ–¹ï¼š</p>
<ul>
<li>1ã€ä»Šå¤©åœ¨èœåœºç‚¹ç«çš„æ—¶å€™ï¼Œé”™æŠŠæ²¹é—¨å½“åˆ¹è½¦</li>
<li>2ã€å‡†å¤‡åŠ é€Ÿè¶…è¿‡å·¦è¾¹è´§è½¦çš„æ—¶å€™ï¼Œè´§è½¦æ‰“äº†å³å‰ç¯ï¼Œä¸‹æ„è¯†åœ°æŠŠæ–¹å‘ç›˜å‘å³æ‰“äº†ä¸€ç‚¹</li>
<li>3ã€é‡åˆ°çº¢ç»¿ç¯å˜é»„ç¯æ—¶ï¼Œåˆ¹è½¦å¤ªæ€¥ã€‚æƒ³å†²è¿‡å»ï¼Œä½†çŠ¹è±«äº†ã€‚è¿™æ ·åšå¤ªå±é™©ï¼Œä¸èƒ½å­˜åœ¨ä¾¥å¹¸å¿ƒç†ã€‚ä¸‹æ¬¡é‡åˆ°è¿™ç§æƒ…å†µï¼Œå®å¯æå‰åˆ¹è½¦ï¼Œç­‰çº¢ç¯è¿‡äº†ï¼Œå†å‘å‰è¡Œé©¶ã€‚</li>
</ul>
<h2 id="å¥½ç‰©åˆ†äº«">å¥½ç‰©åˆ†äº«</h2>
<p>è™½ç„¶å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€<a href="https://t.me/chensoul_share">ChenSoul Share</a>ã€Telegram é¢‘é“ï¼Œä¸è¿‡è¿˜æ˜¯æŒ‘é€‰ä¸€éƒ¨åˆ†åœ¨è¿™é‡Œåˆ—ä¸¾ä¸€ä¸‹ï¼Œæ„Ÿè§‰æ›´åƒä¸€ä¸ª newsletter äº†ã€‚</p>
<h3 id="ä¸€äº›æ–‡ç« ">ä¸€äº›æ–‡ç« </h3>
<ul>
<li>
<p><a href="https://lutaonan.com/blog/things-i-learnt-after-6-years-as-software-engineer/">åšäº† 6 å¹´ç¨‹åºå‘˜ï¼Œæˆ‘å­¦åˆ°çš„ 10 æ¡ç»éªŒ</a></p>
</li>
<li>
<p><a href="https://mritd.com/2021/06/06/jetbrains-plugins/">JetBrains å¸¸ç”¨æ’ä»¶</a></p>
</li>
<li>
<p><a href="https://blog.skyju.cc/post/v2ray-warp-go-unlock-new-bing/">v2ray + warp-go éå…¨å±€ä½¿ç”¨Cloudflare WARPè§£é”New Bingç­‰æœåŠ¡</a></p>
</li>
<li>
<p><a href="https://blog.17lai.site/posts/8f152670/">å¦‚ä½•åˆ›å»ºå±äºè‡ªå·±çš„ç§äººèµ„æ–™åº“ä¸ç§äººæœç´¢å¼•æ“ _</a></p>
</li>
<li>
<p><a href="https://1byte.io/google-large-scale-dev/">å¦‚ä½•é«˜æ•ˆåœ°åä½œå¼€å‘ï¼šä¸€äº› Google çš„å®è·µ</a></p>
</li>
<li>
<p><a href="https://jasonkayzk.github.io/2023/03/28/Java%E9%AB%98%E6%80%A7%E8%83%BD%E7%BC%93%E5%AD%98%E5%BA%93Caffeine/">Javaé«˜æ€§èƒ½ç¼“å­˜åº“Caffeine</a></p>
</li>
</ul>
<h3 id="ä¸€äº›å·¥å…·">ä¸€äº›å·¥å…·</h3>
<ul>
<li>
<p><a href="https://hao.uisdc.com/">ä¼˜è®¾å¯¼èˆªå®˜ç½‘</a>ï¼šè®¾è®¡å¯¼èˆª2013å¹´ä¸Šçº¿è‡³ä»Šï¼Œæ˜¯ä¼˜è®¾ç½‘æ——ä¸‹æœ€ä¸“ä¸šå¥½ç”¨çš„è®¾è®¡å¸ˆå¯¼èˆªç½‘ç«™ï¼è®¾è®¡å¯¼èˆªä¸ºè®¾è®¡å¸ˆæä¾›UIè®¾è®¡ã€è®¾è®¡æ•™ç¨‹ã€ç´ æä¸‹è½½ã€é«˜æ¸…å›¾åº“ã€é…è‰²æ–¹æ¡ˆã€Appè®¾è®¡ã€ç½‘é¡µè®¾è®¡ç­‰è®¾è®¡ç½‘ç«™å¯¼èˆªæŒ‡å¼•ã€‚è®¾è®¡å¯¼èˆªæ¯å‘¨æ›´æ–°ï¼Œè®¾è®¡é£å‘æ ‡å°±çœ‹ä¼˜è®¾ç½‘ï¼</p>
</li>
<li>
<p><a href="https://dusays.com/567/">Zeabur å±äºå›½äººçš„å…è´¹æ‰˜ç®¡å¹³å°</a></p>
</li>
<li>
<p><a href="https://luyuhuang.tech/2023/03/21/nvim.html">Neovim ä½¿ç”¨ä½“éªŒ</a></p>
</li>
<li>
<p><a href="https://www.domon.cn/github-copilotmian-fei-ping-ti-codeium/">Github Copilotå…è´¹å¹³æ›¿ - Codeium</a></p>
</li>
<li>
<p><a href="https://chatdoc.com/">Chat with documents</a></p>
</li>
<li>
<p><a href="https://codeium.com/">Codeium</a>ï¼šä¸€æ¬¾å…è´¹çš„ç±» Github Copilot çš„ AI ä»£ç è¾…åŠ©äº§å“ï¼Œå¯ä»¥ä¾¿æ·çš„å’Œ AI è¿›è¡Œç»“å¯¹ç¼–ç¨‹ã€‚åˆæ­¥ä½¿ç”¨ä¸‹æ¥å’Œä¸»æµçš„ IDE çš„é›†æˆå¾ˆå¥½ï¼Œæ„Ÿå…´è¶£çš„æœ‹å‹å¯ä»¥å…ˆåˆ°<a href="https://codeium.com/playground">æµè§ˆå™¨é‡Œåœ¨çº¿å°è¯•ä¸€ç•ª</a>ã€‚</p>
</li>
</ul>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-12-05.jpeg" alt="codeium"  />
</p>
<h3 id="ä¸€äº›è§†é¢‘">ä¸€äº›è§†é¢‘</h3>
<ul>
<li>é£šé€Ÿå®…ç”·ç¬¬äº”å­£</li>
<li>é­”å¥³</li>
</ul>
<p>ä»¥ä¸Šã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>å‘¨æŠ¥-11ï½œä»è¯­é›€è¿ç§»åˆ°Obsidian</title>
      <link>https://blog.chensoul.com/posts/2023/03/20/weekly_review_11/</link>
      <pubDate>Mon, 20 Mar 2023 11:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/03/20/weekly_review_11/</guid>
      <description>å‰è¨€ â€‹ å›¾ç‰‡ï¼šæ¶¨æ¸¡æ¹–æ¹¿åœ°æ°´ä¸Šæ£®æ—å…¬å›­ æœ¬ç¯‡æ˜¯å¯¹ 2023-03-13 åˆ° 2023-03-19 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚ è¿™å‘¨çš„å·¥ä½œä¸»è¦æ˜¯é‡</description>
      <content:encoded><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-11-04.jpeg" alt="weekly-review-11-04"  />
</p>
<p>â€‹														              					å›¾ç‰‡ï¼š<em>æ¶¨æ¸¡æ¹–æ¹¿åœ°æ°´ä¸Šæ£®æ—å…¬å›­</em></p>
<p>æœ¬ç¯‡æ˜¯å¯¹ <code>2023-03-13</code> åˆ° <code>2023-03-19</code> è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº <a href="https://blog.chensoul.com/">åšå®¢</a>ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚</p>
<p>è¿™å‘¨çš„å·¥ä½œä¸»è¦æ˜¯é‡æ„ã€ä¼˜åŒ–ç³»ç»Ÿï¼Œå·¥ä½œèŠ‚å¥æ¯”ä¹‹å‰è½»ç¼“äº†å¾ˆå¤šã€‚è¿™å‘¨ä¹Ÿå¼€å§‹äº†å¼€è½¦ä¸Šä¸‹ç­ï¼Œé™¤å»å‘¨äº”å»åŒ»é™¢åšæ£€æŸ¥ï¼Œä¸€å…±å¼€äº† 4 å¤©è½¦ã€‚ä»æ±‰å£åˆ°å…‰è°·ï¼Œä¸€å…± 29 å…¬é‡Œï¼Œå¦‚æœæ—©ä¸Š 6:30 å‡ºå‘ï¼Œå°±åªéœ€è¦ 50 åˆ†é’Ÿï¼›å¦‚æœ 6:45 å‡ºå‘ï¼Œç«Ÿç„¶éœ€è¦ä¸¤ä¸ªå°æ—¶ï¼ŒçœŸæ˜¯æ— è¯­äº†ã€‚æ— å¥ˆä¹‹ä¸‹ï¼Œåªèƒ½æ¯å¤©æ—©ç‚¹å‡ºé—¨æ—©ç‚¹åˆ°å…¬å¸ï¼Œç„¶åï¼Œæ‰“å®Œå¡ä¹‹åï¼Œåœ¨å…¬å¸æ¥¼ä¸‹èµ°è·¯ã€‚</p>
<p>è¿™å‘¨å¼€å§‹å¿ƒé‡Œé»˜é»˜å®šäº†ä¸€ä¸ª flagï¼Œå°±æ˜¯æ¯å¤©èµ°è·¯ 10000 æ­¥ã€‚çœ‹äº†ä¸€ä¸‹å¾®ä¿¡è¿åŠ¨ï¼ŒåŸºæœ¬ä¸Šè¾¾æˆäº†ï¼Œé™¤äº†å‘¨äº”æ™šä¸Šå› ä¸ºåŠ ç­ï¼Œè€Œå°‘èµ°äº† 64 æ­¥ã€‚</p>
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-11-03.png" alt="weekly-review-11-03" style="width:67%;" />
<h2 id="ä»è¯­é›€è¿ç§»åˆ°obsidian">ä»è¯­é›€è¿ç§»åˆ°Obsidian</h2>
<p>ä¸Šå‘¨æåˆ°å¼€å§‹ä½¿ç”¨æ ¼å¿— APP æ¥å†™æ—¥å¿—ï¼Œä½¿ç”¨äº†ä¸€æ®µæ—¶é—´ä¹‹åï¼Œå‘ç°äº†ä¸€äº›ç¼ºç‚¹ï¼š</p>
<ul>
<li>éƒ¨åˆ†åŠŸèƒ½æ”¶è´¹</li>
<li>å¯¼å‡ºçš„ markdown ä¸æ”¯æŒå›¾ç‰‡æ˜¾ç¤º</li>
<li>ä¸æ”¯æŒæœ¬åœ°å­˜å‚¨</li>
</ul>
<p>äºæ˜¯ï¼Œæ”¾å¼ƒäº†ä½¿ç”¨æ ¼å¿— APPï¼Œç»§è€Œåœ¨ä½¿ç”¨äº†ä¸€æ®µæ—¶é—´ Obsidian ä¹‹åï¼Œæ”¹ä¸ºä½¿ç”¨ Obsidian æ¥å†™æ—¥å¿—å’Œå‘¨æŠ¥ã€‚</p>
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-11-02.png" alt="weekly-review-11-02" style="width:67%;" />
<p>ä¸ºäº†ä¸ç»™è‡ªå·±å¤ªå¤§å‹åŠ›ï¼Œæ—¥æŠ¥æ¯å¤©å¤ç›˜å†…å®¹åŒ…æ‹¬ä»¥ä¸‹å‡ æ–¹é¢ï¼š</p>
<ul>
<li>
<p>ä»Šæ—¥å¾…åŠ</p>
</li>
<li>
<p>å­¦ä¹ </p>
</li>
<li>
<p>å·¥ä½œ</p>
</li>
<li>
<p>ç”Ÿæ´»</p>
</li>
<li>
<p>å¥èº«</p>
</li>
</ul>
<h3 id="å¯¼å‡ºè¯­é›€æ–‡æ¡£ä¸º-markdown">å¯¼å‡ºè¯­é›€æ–‡æ¡£ä¸º markdown</h3>
<p>å‚è€ƒ <a href="https://github.com/yuque/yuque-exporter">yuque/yuque-exporter</a> æ–‡æ¡£ï¼Œä¸‹è½½ yuque-exporter  ä¹‹åè¿›è¡Œå¯¼å‡ºæ“ä½œï¼Œå‘ç°ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ul>
<li>è¯¥é¡¹ç›®éœ€è¦ä½¿ç”¨çš„ nodejs ç‰ˆæœ¬ä¸º 18.0.4</li>
<li>nodejs ä½¿ç”¨æ­£ç¡®çš„ç‰ˆæœ¬è¿˜æ˜¯å¯¼å‡ºå¤±è´¥</li>
</ul>
<p>äºæ˜¯ï¼Œæ”¹ä¸ºä½¿ç”¨æºç ç¼–è¯‘å’Œè¿è¡Œå¯¼å‡ºã€‚</p>
<p>1ã€å…ˆä¸‹è½½ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git clone https://github.com/yuque/yuque-exporter.git
</span></span></code></pre></div><p>2ã€ä¿®æ”¹ main.ts ä¸­éœ€è¦å¯¼å‡ºçš„è¯­é›€çŸ¥è¯†åº“åœ°å€ä¸ºè‡ªå·±çš„ä»“åº“åœ°å€ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="c1">// Determining if an ESM module is main then run the code
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="kr">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">url</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;file:&#39;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="kr">module</span><span class="nx">Path</span> <span class="o">=</span> <span class="nx">fileURLToPath</span><span class="p">(</span><span class="kr">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="kr">module</span><span class="nx">Path</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">urlPaths</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;chensoul/rose&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;chensoul/growup&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;chensoul/tech&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">await</span> <span class="nx">start</span><span class="p">({</span> <span class="nx">urlPaths</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>3ã€å‚è€ƒ <a href="https://www.yuque.com/yuque/developer/api#785a3731">æ–‡æ¡£</a> ç”³è¯·è¯­é›€ TOKENã€‚</p>
<p>4ã€ä¸‹è½½é¡¹ç›®ä¾èµ–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">npm i
</span></span></code></pre></div><p>5ã€è¿è¡Œé¡¹ç›®ï¼Œå¼€å§‹å¯¼å‡ºï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">YUQUE_TOKEN</span><span class="o">=</span>XXXXXX npm start
</span></span></code></pre></div><blockquote>
<p>å¯¼å‡ºçš„æ–‡ä»¶åœ¨ storage ç›®å½•ï¼Œæ¥ä¸‹æ¥å¯ä»¥æ‹·è´åˆ° Obsidian ç›®å½•é‡Œã€‚</p>
</blockquote>
<p>6ã€å¦å¤–ï¼Œå¯ä»¥å¯¹ yuque-exporter æºç åšä¸€äº›ä¿®æ”¹ï¼š</p>
<ul>
<li>å¯¼å‡ºçš„ markdown æ–‡ä»¶ä¸è¦æœ‰ frontmatterï¼Œä¿®æ”¹ doc.ts ä¸­ buildDoc æ–¹æ³•ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">async</span> <span class="kd">function</span> <span class="nx">buildDoc</span><span class="p">(</span><span class="nx">doc</span>: <span class="kt">TreeNode</span><span class="p">,</span> <span class="nx">mapping</span>: <span class="kt">Record</span><span class="p">&lt;</span><span class="nt">string</span><span class="err">,</span> <span class="na">TreeNode</span><span class="p">&gt;)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">docDetail</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">readJSON</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">metaDir</span><span class="p">,</span> <span class="nx">doc</span><span class="p">.</span><span class="kr">namespace</span><span class="p">,</span> <span class="s1">&#39;docs&#39;</span><span class="p">,</span> <span class="sb">`</span><span class="si">${</span><span class="nx">doc</span><span class="p">.</span><span class="nx">url</span><span class="si">}</span><span class="sb">.json`</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">remark</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;settings&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">bullet</span><span class="o">:</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="nx">listItemIndent</span><span class="o">:</span> <span class="s1">&#39;one&#39;</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">use</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">      <span class="p">[</span> <span class="nx">replaceHTML</span> <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="p">[</span> <span class="nx">relativeLink</span><span class="p">,</span> <span class="p">{</span> <span class="nx">doc</span><span class="p">,</span> <span class="nx">mapping</span> <span class="p">}],</span>
</span></span><span class="line"><span class="cl">      <span class="p">[</span> <span class="nx">downloadAsset</span><span class="p">,</span> <span class="p">{</span> <span class="nx">doc</span><span class="p">,</span> <span class="nx">mapping</span> <span class="p">}],</span>
</span></span><span class="line"><span class="cl">    <span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">process</span><span class="p">(</span><span class="nx">docDetail</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">//  doc.content = frontmatter(doc) + content.toString();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">doc</span><span class="p">.</span><span class="nx">content</span> <span class="o">=</span> <span class="nx">content</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// FIXME: remark will transform `*` to `\*`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">doc</span><span class="p">.</span><span class="nx">content</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">replaceAll</span><span class="p">(</span><span class="s1">&#39;\\*&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">doc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li>å¯¼å‡ºçš„æ®µè½ä¹‹é—´å¢åŠ æ¢è¡Œï¼Œä¿®æ”¹ doc.ts ä¸­ replaceHTML æ–¹æ³•ï¼š</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ts" data-lang="ts"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">replaceHTML() {</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">tree</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">htmlNodes</span> <span class="o">=</span> <span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">,</span> <span class="nx">tree</span><span class="p">)</span> <span class="kr">as</span> <span class="nx">Text</span><span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">node</span> <span class="k">of</span> <span class="nx">htmlNodes</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span> <span class="o">===</span> <span class="s1">&#39;&lt;br /&gt;&#39;</span> <span class="o">||</span> <span class="nx">node</span><span class="p">.</span><span class="nx">value</span> <span class="o">===</span> <span class="s1">&#39;&lt;br/&gt;&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">node</span><span class="p">.</span><span class="kr">type</span> <span class="o">=</span> <span class="s1">&#39;text&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">node</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">&#39;\n\n\n&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>7ã€åˆ é™¤å¯¼å‡ºçš„ markdown æ–‡ä»¶å½“ä¸­çš„é”šç‚¹æ ‡ç­¾ï¼ˆä¾‹å¦‚ï¼š<code>&lt;a name=&quot;xx&quot;&gt;&lt;/a&gt;</code>ï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> storage
</span></span><span class="line"><span class="cl"><span class="c1"># macos ä¸Šæ‰§è¡Œ</span>
</span></span><span class="line"><span class="cl">find . -type f -name <span class="s1">&#39;*.md&#39;</span> -exec sed -i <span class="s1">&#39;&#39;</span> <span class="s1">&#39;s/&lt;a name=\&#34;[^\&#34;]*\&#34;&gt;&lt;\/a&gt;//g&#39;</span> <span class="o">{}</span> +
</span></span></code></pre></div><img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-11-01.png" alt="weekly-review-11-01" style="width:67%;" />
<p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† sed å‘½ä»¤æ¥åˆ é™¤ Markdown æ–‡ä»¶ä¸­æ‰€æœ‰çš„ç±»ä¼¼ <code>&lt;a name=&quot;xx&quot;&gt;&lt;/a&gt;</code> çš„é”šç‚¹æ ‡ç­¾ã€‚å…¶ä¸­ï¼š</p>
<ul>
<li><code>-i ''</code> å‚æ•°è¡¨ç¤ºç›´æ¥ä¿®æ”¹æºæ–‡ä»¶ï¼Œè€Œä¸æ˜¯è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºæµã€‚<code>''</code> è¡¨ç¤ºåœ¨ macOS ç³»ç»Ÿä¸Šå¤‡ä»½ä¿®æ”¹å‰çš„æ–‡ä»¶ï¼Œå¦‚æœåœ¨ Linux ç³»ç»Ÿä¸Šä½¿ç”¨è¯¥å‘½ä»¤ï¼Œå¯ä»¥çœç•¥è¯¥å‚æ•°ã€‚</li>
<li><code>s/&lt;a name=\&quot;[^\&quot;]*\&quot;&gt;&lt;\/a&gt;//g</code> è¡¨ç¤ºç”¨ç©ºå­—ç¬¦ä¸²æ›¿æ¢æ‰€æœ‰ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼ <code>&lt;a name=\&quot;[^\&quot;]*\&quot;&gt;&lt;\/a&gt;</code> çš„å­—ç¬¦ä¸²ã€‚è¯¥æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ‰€æœ‰ä»¥ <code>&lt;a name=</code> å¼€å¤´ï¼Œä»¥ <code>&quot;&gt;&lt;/a&gt;</code> ç»“å°¾çš„æ ‡ç­¾ï¼Œä¸”ä¸­é—´çš„æ–‡æœ¬ä¸åŒ…å«åŒå¼•å·ã€‚</li>
</ul>
<p>8ã€å°†å¯¼å‡ºçš„ markdown æ–‡ä»¶ä¸­çš„æœ¬åœ°å›¾ç‰‡æ‰¹é‡ä¸Šä¼ åˆ°å›¾åºŠï¼Œæ“ä½œæ–¹æ³•ï¼šä½¿ç”¨ typora æ‰“å¼€ storage ç›®å½•ï¼Œç„¶åä¾æ¬¡ç‚¹å‡» æ ¼å¼ã€å›¾åƒã€ä¸Šä¼ æ‰€æœ‰æœ¬åœ°å›¾ç‰‡</p>
<h2 id="å¥½ç‰©åˆ†äº«">å¥½ç‰©åˆ†äº«</h2>
<p>è™½ç„¶å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€<a href="https://t.me/chensoul_share">ChenSoul Share</a>ã€Telegram é¢‘é“ï¼Œä¸è¿‡è¿˜æ˜¯æŒ‘é€‰ä¸€éƒ¨åˆ†åœ¨è¿™é‡Œåˆ—ä¸¾ä¸€ä¸‹ï¼Œæ„Ÿè§‰æ›´åƒä¸€ä¸ª newsletter äº†ã€‚</p>
<h3 id="ä¸€äº›æ–‡ç« ">ä¸€äº›æ–‡ç« </h3>
<ul>
<li>
<p><a href="https://moelove.info/2023/03/21/GitHub-Actions-%E6%88%90%E6%9C%AC%E4%BC%98%E5%8C%96%E8%AE%A9%E4%BD%A0%E7%9A%84%E5%9B%A2%E9%98%9F%E6%9B%B4%E5%85%B7%E7%AB%9E%E4%BA%89%E5%8A%9B/">GitHub Actions æˆæœ¬ä¼˜åŒ–ï¼šè®©ä½ çš„å›¢é˜Ÿæ›´å…·ç«äº‰åŠ›</a></p>
</li>
<li>
<p><a href="https://juemuren4449.com/archives/open-gzip-on-nginx">Nginx å¼€å¯ gzip å‹ç¼©</a></p>
</li>
<li>
<p><a href="https://www.superheaoz.top/2022/06/57091/">Obsidanæ—¥è®°ã€è®°è´¦ä¸è‡ªåŠ¨åŒæ­¥</a></p>
</li>
<li>
<p><a href="https://elmagnifico.tech/2023/03/16/Doprax-V2ray/">Dopraxæ­å»ºå…è´¹V2rayèŠ‚ç‚¹</a></p>
</li>
<li>
<p><a href="https://elizen.me/posts/2023/03/hi-icloud/">Hiï¼ŒåœŸåŒº iCloud</a></p>
</li>
<li>
<p><a href="https://btsogiwudc.feishu.cn/docx/CgoJdHyWKopl3UxV12GcG3psnjf">å›½åŒºä½¿ç”¨åœŸè€³å…¶iCloudæœåŠ¡ï¼Œæ‰‹æŠŠæ‰‹ä¿å§†çº§ä¸Šè½¦æ•™ç¨‹</a></p>
</li>
</ul>
<p>ä»¥ä¸Šã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>å‘¨æŠ¥-10ï½œé€šè¿‡Cloudflare Tunnelè®¿é—®æœåŠ¡ã€Verceléƒ¨ç½²Cusdiså’ŒUmami</title>
      <link>https://blog.chensoul.com/posts/2023/03/13/weekly_review_10/</link>
      <pubDate>Mon, 13 Mar 2023 11:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/03/13/weekly_review_10/</guid>
      <description>å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-03-06 åˆ° 2023-03-12 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚ è¿™å‘¨å‘ç° VPS ä¸Š æŸäº›ä½¿ç”¨ docker éƒ¨ç½²çš„æœåŠ¡ï¼ˆcusdisã€</description>
      <content:encoded><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-10-00.jpeg" alt="weekly-review-10-00"  />
</p>
<p>æœ¬ç¯‡æ˜¯å¯¹ <code>2023-03-06</code> åˆ° <code>2023-03-12</code> è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº <a href="https://blog.chensoul.com/">åšå®¢</a>ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚</p>
<p>è¿™å‘¨å‘ç° VPS ä¸Š <a href="https://blog.chensoul.com/posts/2023/01/25/notes-about-deploy-services-in-vps/">æŸäº›ä½¿ç”¨ docker éƒ¨ç½²çš„æœåŠ¡</a>ï¼ˆcusdisã€umamiã€uptimeã€n8nã€rsshubã€memosï¼‰å›½å†…ç”¨æˆ·æ— æ³•è®¿é—®äº†ï¼Œäºæ˜¯å°±æŠ˜è…¾äº†ä¸€ä¸‹ä½¿ç”¨ Cloudflare Tunnel æ¥ä»£ç†è¿™äº›æœåŠ¡ã€‚é…ç½®æˆåŠŸä¹‹åï¼Œåˆå‘ç°æœ¬åœ°å¦‚æœå¼€å¯ VPNï¼ŒCloudflare Tunnel ä»£ç†çš„åŸŸåè¿˜æ˜¯æ— æ³•è®¿é—®ï¼Œäºæ˜¯æ”¾å¼ƒäº†ä½¿ç”¨ Cloudflare Tunnelï¼Œæ”¹ä¸ºå°†è¿™äº›å›½å†…æ— æ³•è®¿é—®çš„æœåŠ¡éƒ¨ç½²åˆ°å…è´¹çš„ VPS æœåŠ¡å™¨ä¸Šï¼Œæ¯”å¦‚ï¼šRailwayã€Vercelã€‚</p>
<p>è¿™å‘¨å·¥ä½œå¿™å®Œä¹‹åï¼Œå°±å¼€å§‹ç€æ‰‹é€šçŸ¥ç³»ç»Ÿçš„é‡æ„æ”¹é€ æœåŠ¡ï¼Œæƒ³ç€ chatgpt è¿™ä¹ˆç«ï¼Œäºæ˜¯å°±è¯•è¯•è®©å®ƒæ¥å†™ä»£ç ã€‚åœ¨ä¸æ–­åœ°ä¿®æ”¹éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œchatgpt å†™å‡ºæ¥çš„ä»£ç ç¨åŠ è°ƒæ•´é€æ¸å¯ä»¥ä½¿ç”¨äº†ã€‚</p>
<p>å‘¨å…­ä»æ±‰å£å¼€è½¦å»ç™½æ²™æ´²æ¹–åŒ—è´¢ç¨èŒä¸šå­¦é™¢ï¼Œå…¨ç¨‹ 20 å…¬é‡Œï¼Œå›æ¥çš„æ—¶å€™ä¸å°å¿ƒæŠŠè·¯è¾¹çš„é¢åŒ…è½¦æ“¦ç¢°äº†ä¸€ä¸‹ã€‚äºæ˜¯ä¸€è„¸æ‡µçš„ç»å†äº†ä¸€æ¬¡ä¿é™©å®šæŸç»´ä¿®ã€‚</p>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-10-07.jpeg" alt="weekly-review-10-07"  />
</p>
<p>å‘¨å…­å¼€å§‹ä½¿ç”¨ æ ¼å¿— APP å†™æ—¥å¿—ï¼Œé€‰æ‹©å®ƒæ¥è®°å½•æ—¥å¿—çš„åŸå› æ˜¯å®ƒæ”¯æŒæ‰¹é‡å¯¼å‡º mardkownã€pdfã€å›¾ç‰‡ç­‰ã€‚å”¯ä¸€æœ‰ä¸ªå°é—æ†¾çš„æ˜¯ï¼Œè¿™ä¸ªåº”ç”¨æ²¡æœ‰å›¾åºŠï¼Œå¯¼å‡ºçš„ markdown æ–‡ä»¶é‡Œé¢å›¾ç‰‡çš„é“¾æ¥ä¸æ˜¯ http åè®®ã€‚</p>
<img src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-10-08.png" alt="weekly-review-10-08" style="width:67%;" />
<p>å‘¨æ—¥å»æ–°è£é¾™æ¹–å¤©è€€å¤©è¡—å”®æˆ¿éƒ¨çœ‹äº†ä¸€ä¸‹æˆ¿å­ã€‚107 å¹³ä¸‰å®¤ä¸¤å…ä¸¤å«ï¼Œå•ä»· 2 ä¸‡ 5 å¸¦ç²¾è£…ä¿®ï¼Œå…¬ç§¯é‡‘è´·æ¬¾ 90 ä¸‡ï¼Œå•†ä¸šè´·æ¬¾ 30 å¹´ï¼Œæ¯ä¸ªæœˆæˆ¿è´· 6000ã€‚ç›®å‰æ¥è¯´ï¼Œä¹°ä¸èµ·è¿™é‡Œçš„æˆ¿å­ï¼Œä½†æ˜¯ï¼Œä½œä¸ºä¸€ä¸ªä¹°æˆ¿ç›®æ ‡è¿˜æ˜¯å¯ä»¥çš„ï¼ŒåŠ æ²¹ï¼</p>
<h2 id="å¼€è½¦æ€»ç»“">å¼€è½¦æ€»ç»“</h2>
<p>æœ€è¿‘åˆ·è§†é¢‘ï¼Œæ€»ç»“çš„ä¸€äº›å¼€è½¦ç»éªŒå¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>æå‰é¢„åˆ¤ï¼Œå‰é¢è½¦å­åˆ¹è½¦ï¼Œä¸ç®¡æ˜¯æ­£å‰æ–¹ï¼Œè¿˜æ˜¯å·¦å³å‰æ–¹ï¼Œè¿™æ—¶å€™ä¹Ÿè¦åˆ¹è½¦</p>
</li>
<li>
<p>å‰é¢æœ‰å¤§è´§è½¦ï¼Œä¸è¦ä»å³è¾¹è¶…è½¦</p>
</li>
<li>
<p>ä¼šè½¦æ—¶ï¼Œçœ‹è·¯å®½</p>
</li>
<li>
<p>ä¸è¦è¿ç»­å˜é“ï¼Œå˜é“æ—¶æ—¢è¦çœ‹åè§†é•œï¼Œåˆè¦çœ‹çª—è¾¹</p>
</li>
<li>
<p>çº¢ç¯è·¯å£å³è½¬æ—¶ï¼Œè¦çœ‹åœ°é¢æˆ–è€…è·¯è¾¹æ˜¯å¦æœ‰ç¦æ­¢å³è½¬æ ‡è¯†</p>
</li>
</ul>
<h2 id="é€šè¿‡-cloudflare-tunnel-è®¿é—®æœåŠ¡">é€šè¿‡ Cloudflare Tunnel è®¿é—®æœåŠ¡</h2>
<p>ä»¥ä¸‹å†…å®¹å‚è€ƒ <a href="https://dejavu.moe/posts/cloudflare-tunnel-access-uptime/">åˆæ¢ Cloudflare é›¶ä¿¡ä»» - é€šè¿‡ Cloudflare Tunnel è®¿é—®æœåŠ¡</a>ã€‚</p>
<h3 id="1åˆ›å»º-cloudflare-tunnel">1ã€åˆ›å»º Cloudflare Tunnel</h3>
<p>ç™»å½• <a href="https://one.dash.cloudflare.com/">Cloudflare Zero Trust</a> æ§åˆ¶å°ï¼Œé€‰æ‹©å·¦ä¾§å¯¼èˆªæ çš„ Access èœå•ï¼Œè¿›å…¥ Tunnels é…ç½®ï¼Œç‚¹å‡» Create a tunnel åˆ›å»ºä¸€ä¸ª Tunnelï¼Œè¾“å…¥ Tunnel éš§é“åç§°</p>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-10-01.png" alt="weekly-review-10-01"  />
</p>
<p>é€‰æ‹©æœåŠ¡å™¨çš„æ“ä½œç³»ç»Ÿå’Œå¹³å°æ¶æ„ï¼š</p>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-10-02.webp" alt="weekly-review-10-02"  />
</p>
<p>å¯ä»¥çœ‹åˆ°å®‰è£…å‘½ä»¤ï¼š</p>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-10-03.png" alt="weekly-review-10-03"  />
</p>
<p>å¤åˆ¶å·¦è¾¹å‘½ä»¤ç²˜è´´åˆ° SSH ä¼šè¯é‡Œå®‰è£… Cloudflaredï¼ˆæ³¨æ„ä¿æŠ¤ Refresh Token ä¸è¦æ³„æ¼ï¼‰</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">brew install cloudflare/cloudflare/cloudflared <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo cloudflared service install eyJhIjoiMmUxOTgwYTBlZjQzZjU3YjkyMGVhMjhjZGY5ZDM4ZDEiLCJ0IjoiYzU1ZTU3MmUtMTEyMS00OWJkLTgzMTgtNjc3NDIyYWMwMjU0IiwicyI6Ik1qZGtZakkyTldFdE5XVTRNUzAwTXpWaExXRXlNRFl0T0RobE5EbGpObVZpWmpJMSJ9
</span></span></code></pre></div><h3 id="2åˆ é™¤-cloudflare-dns-çš„-a-è®°å½•è§£æ">2ã€åˆ é™¤ Cloudflare DNS çš„ A è®°å½•è§£æ</h3>
<p>æˆ‘çš„åŸŸåæ‰˜ç®¡åœ¨ Cloudflare ä¸Šï¼Œæ‰€ä»¥éœ€è¦å°†åŸæ¥çš„åŸŸåè§£æè®°å½•åˆ é™¤ï¼Œä¸»è¦æ¶‰åŠä»¥ä¸‹ä¸¤ä¸ªéœ€è¦è¢«å›½å†…ç”¨æˆ·è®¿é—®çš„åŸŸåï¼ˆå…¶ä½™åŸŸåæ˜¯æˆ‘ä¸ªäººä½¿ç”¨ï¼Œæ‰€ä»¥åªéœ€è¦æˆ‘å¼€å¯ VPN è®¿é—®å³å¯ã€‚ï¼‰ï¼š</p>
<ul>
<li>cusdis.chensoul.com</li>
<li>umami.chensoul.com</li>
</ul>
<h3 id="3åœ¨--cloudflare-tunnel-æ·»åŠ -hostname">3ã€åœ¨  Cloudflare Tunnel æ·»åŠ  hostname</h3>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-10-04.png" alt="weekly-review-10-04"  />
</p>
<p>å¦‚æœéœ€è¦å¯¹ ssh æœåŠ¡å¼€å¯ä»£ç†ï¼Œè¯·å‚è€ƒï¼š<a href="https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/use_cases/ssh/">Connect with SSH through Cloudflare Tunnel</a>ã€‚</p>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-10-05.png" alt="weekly-review-10-05"  />
</p>
<p>å…³é”®æ­¥éª¤æ˜¯ï¼š</p>
<ul>
<li>
<p>ä¸º ssh é€šé“åˆ›å»º Hostname</p>
</li>
<li>
<p>åœ¨æœ¬åœ°å®‰è£… <a href="https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/install-and-setup/installation/"><code>cloudflared</code></a></p>
</li>
<li>
<p>é…ç½® ~/.ssh/configï¼Œæ·»åŠ ä¸‹é¢é…ç½®ï¼ˆæ³¨æ„ï¼šæˆ‘ä½¿ç”¨ Homebrew å®‰è£…çš„ cloudflaredï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">Host ssh.chensoul.com
</span></span><span class="line"><span class="cl">ProxyCommand /opt/homebrew/bin/cloudflared access ssh --hostname %h
</span></span></code></pre></div></li>
<li>
<p>é€šè¿‡ ssh è®¿é—® ssh.chensoul.comï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ssh root@ssh.chensoul.com
</span></span></code></pre></div></li>
</ul>
<h3 id="4åœ¨-vps-ä¸Šå¯ç”¨é˜²ç«å¢™åœæ­¢-nginx-æœåŠ¡">4ã€åœ¨ vps ä¸Šå¯ç”¨é˜²ç«å¢™ï¼Œåœæ­¢ nginx æœåŠ¡</h3>
<p>å°† vps ä¸Š nginx é…ç½®çš„åå‘ä»£ç†åˆ é™¤ï¼Œå¹¶å¯ä»¥ç¦ç”¨è¿™äº›æœåŠ¡æš´éœ²çš„ç«¯å£ã€‚</p>
<h3 id="5æµ‹è¯•">5ã€æµ‹è¯•</h3>
<p>ç»è¿‡æµ‹è¯•ï¼Œ<del>åˆå‘ç°æœ¬åœ°å¦‚æœå¼€å¯ VPNï¼ŒCloudflare Tunnel ä»£ç†çš„åŸŸåè¿˜æ˜¯æ— æ³•è®¿é—®</del>ï¼Œäºæ˜¯æ”¾å¼ƒäº†ä½¿ç”¨ Cloudflare Tunnelï¼Œæ”¹ä¸ºå°†è¿™äº›å›½å†…æ— æ³•è®¿é—®çš„æœåŠ¡éƒ¨ç½²åˆ°å…è´¹çš„ VPS æœåŠ¡å™¨ä¸Šï¼Œæ¯”å¦‚ï¼šRailwayã€Vercelã€‚</p>
<h2 id="vercel-éƒ¨ç½²-cusdisumami">Vercel éƒ¨ç½² Cusdisã€umami</h2>
<p>å‚è€ƒ <a href="https://www.pseudoyu.com/zh/2022/05/24/free_and_lightweight_blog_comment_system_using_cusdis_and_railway/">è½»é‡çº§å¼€æºå…è´¹åšå®¢è¯„è®ºç³»ç»Ÿè§£å†³æ–¹æ¡ˆï¼ˆCusdis + Railwayï¼‰</a> åœ¨ Railway ä¸Šéƒ¨ç½² cusdisï¼Œæ•°æ®åº“è¿˜æ˜¯å¯ä»¥ä½¿ç”¨ vps ä¸Šéƒ¨ç½²çš„ postgresqlï¼Œåªéœ€è¦é…ç½®ä¸€ä¸ª jdbc é“¾æ¥å³å¯ï¼š</p>
<ul>
<li>postgresql://cusdis:xxxxxx@postgres.chensoul.com:5432/cusdis</li>
</ul>
<p>éƒ¨ç½²å®Œä¹‹åï¼Œå‘ç°å­˜åœ¨è·¨åŸŸé—®é¢˜ï¼Œæ•…å…¨éƒ¨æ”¹ä¸ºä½¿ç”¨ Vercel æ¥éƒ¨ç½²ã€‚</p>
<p>å‚è€ƒ <a href="https://cusdis.com/doc#/self-host/vercel">Cusdis å®˜æ–¹æ–‡æ¡£</a> æ¥éƒ¨ç½² Cusdisï¼Œå¯¹äº Cusdis å­˜åœ¨è·¨åŸŸé—®é¢˜ï¼Œå‚è€ƒ <a href="https://github.com/djyde/cusdis/issues/135">Sometimes form shows on page, sometimes not - CORS issue #135</a>ï¼Œä¿®æ”¹ä½ çš„ github çš„ cusdis ä»“åº“ä¸­çš„ next.config.js æ–‡ä»¶ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">async</span> <span class="nx">headers</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">source</span><span class="o">:</span> <span class="s2">&#34;/:path*&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">headers</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span> <span class="nx">key</span><span class="o">:</span> <span class="s2">&#34;Access-Control-Allow-Origin&#34;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="s2">&#34;*&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span></code></pre></div><p>å‚è€ƒ <a href="https://umami.is/docs/running-on-vercel">Umami å®˜æ–¹æ–‡æ¡£</a> æ¥éƒ¨ç½² Umamiï¼Œumami çš„ postgresql jdbc é“¾æ¥è¿˜æ˜¯ä½¿ç”¨ vps ä¸Šé¢éƒ¨ç½²çš„ postgresql</p>
<ul>
<li>postgresql://umami:xxxxxxpostgres.chensoul.com:5432/umami</li>
</ul>
<h2 id="chatgpt-å†™ä»£ç ">Chatgpt å†™ä»£ç </h2>
<p>åœ¨ <a href="https://poe.com/chatgpt">https://poe.com/chatgpt</a> é‡Œé¢è¾“å…¥ä¸‹é¢æ–‡å­—ï¼š</p>
<blockquote>
<p>è¯·ç”¨ java å®ç°ä¸€ä¸ªé€šçŸ¥ç³»ç»Ÿï¼Œç»™å‡ºå®Œæ•´çš„ä»£ç ï¼Œéœ€æ±‚å¦‚ä¸‹ï¼š</p>
<p>1ã€é€šçŸ¥äº‹ä»¶ï¼ŒæŒ‡ä¸šåŠ¡å¹³å°è§¦å‘çš„äº‹ä»¶ï¼Œé€šçŸ¥äº‹ä»¶æœ‰åç§°ï¼Œæè¿°ï¼Œç¼–ç ã€‚é€šçŸ¥äº‹ä»¶å¯ä»¥å®šä¹‰å¤šä¸ªå±æ€§ã€‚å±æ€§æœ‰åç§°ã€æè¿°ã€ç¼–ç ï¼Œç±»å‹ã€‚ç±»å‹æœ‰æ•´å½¢ã€å­—ç¬¦ä¸²ã€æ—¥æœŸã€æ—¶é—´ã€æµ®ç‚¹æ•°ã€åˆ—è¡¨å‡ ç§ã€‚</p>
<p>2ã€é€šçŸ¥è§„åˆ™ã€‚é€šçŸ¥è§„åˆ™æœ‰åç§°ã€ç”Ÿæ•ˆæ—¶é—´ï¼ˆä¸€ç›´ç”Ÿæ•ˆï¼Œæˆ–è€…æŒ‡å®šæ—¶é—´æ®µç”Ÿæ•ˆï¼‰ï¼Œé€šçŸ¥äº‹ä»¶ï¼ˆä»åˆ›å»ºå¥½çš„äº‹ä»¶é€‰æ‹©ä¸€ä¸ªï¼‰ã€æè¿°ã€‚é€šçŸ¥è§„åˆ™å¯ä»¥åˆ›å»ºå¤šä¸ªè§„åˆ™é¡¹ã€‚æ¯ä¸ªè§„åˆ™é¡¹è¦é€‰æ‹©äº‹ä»¶ä¸‹é¢çš„æŸä¸€ä¸ªå±æ€§ï¼Œå¹¶ä¸”å¯ä»¥å¯¹è¯¥äº‹ä»¶å±æ€§é€‰æ‹©ä¸€ä¸ªæ“ä½œç¬¦ï¼ˆå¤§äºã€å°äºã€ç­‰äºã€åœ¨ä¸¤ä¸ªæŒ‡ä¹‹é—´ï¼‰å’Œè®¾ç½®å¯¹åº”çš„å€¼ã€‚å¦‚æœæ˜¯å¤§äºã€å°äºã€ç­‰äºï¼Œåˆ™åªç”¨é€‰æ‹©ä¸€ä¸ªå€¼ã€‚å¦‚æœæ˜¯åœ¨ä¸¤ä¸ªæŒ‡ä¹‹é—´ï¼Œåˆ™éœ€è¦é€‰æ‹©ä¸¤ä¸ªå€¼ã€‚å¤šä¸ªæ‰§è¡Œæ¡ä»¶åœ¨è§„åˆ™æ‰§è¡Œæ—¶ï¼Œæ˜¯æŒ‰ä¸æ‰§è¡Œã€‚è§„åˆ™å¯ä»¥æŒ‡å®šå¤šä¸ªé€šçŸ¥ç”¨æˆ·ï¼ˆå§“åã€æ‰‹æœºå·ï¼‰ã€‚</p>
<p>3ã€é€šçŸ¥ç­–ç•¥ã€‚ä¸€ä¸ªè§„åˆ™å¯ä»¥å®šä¹‰å¤šä¸ªé€šçŸ¥ç­–ç•¥ã€‚é€šçŸ¥ç­–ç•¥æœ‰é€šçŸ¥æ¨¡ç‰ˆã€é€šçŸ¥æ¸ é“ã€‚æ¯ä¸ªé€šçŸ¥æ¨¡ç‰ˆæœ‰æ ‡é¢˜ã€æè¿°ä»¥åŠæ¨¡ç‰ˆå†…å®¹ï¼ˆæ¨¡æ¿å†…å®¹æ”¯æŒå˜é‡æ›¿æ¢ï¼‰ã€‚</p>
<p>4ã€é€šçŸ¥æ¸ é“æœ‰ç±»å‹ã€é…ç½®å±æ€§ï¼Œå¯ä»¥å‘é€æ¶ˆæ¯ï¼Œæ”¯æŒçš„é€šçŸ¥æ¸ é“æœ‰é£ä¹¦ã€é‚®ä»¶ã€‚</p>
<p>5ã€é€šçŸ¥è§„åˆ™æµ‹è¯•ã€‚ç»™å®šä¸€ä¸ªäº‹ä»¶ç å’Œäº‹å®æ•°æ®ï¼Œç³»ç»ŸæŸ¥è¯¢å‡ºè¯¥äº‹ä»¶ç å…³è”çš„å¤šä¸ªè§„åˆ™ã€‚æ¯ä¸ªè§„åˆ™é€šè¿‡ easy-rule 4.1.0 æ¡†æ¶å»æ‰§è¡Œã€‚æ¯ä¸ªè§„åˆ™é¡¹æ‰§è¡Œå‰ï¼Œéœ€è¦æ ¡éªŒäº‹å®æ•°æ®é‡Œçš„å€¼çš„ç±»å‹å’Œäº‹ä»¶å±æ€§å®šä¹‰çš„ç±»å‹æ˜¯å¦ä¸€è‡´ã€‚å¤šä¸ªè§„åˆ™é¡¹çš„æ‰§è¡Œç»“æœæ±‚äº¤é›†ã€‚å½“æœ€åç»“æœä¸º true æ—¶ï¼Œå°†é€šçŸ¥ç­–ç•¥ä¸­çš„æ¨¡æ¿å†…å®¹è¿›è¡Œå˜é‡æ›¿æ¢ï¼Œç„¶åé€šè¿‡æ¸ é“å‘é€æ¶ˆæ¯ç»™è¿™äº›äººã€‚</p>
<p>æ³¨æ„ï¼šç›¸åŒçš„æ¶ˆæ¯å†…å®¹ï¼Œåœ¨ä¸€åˆ†é’Ÿå†…ï¼Œåªé€šè¿‡ä¸€ä¸ªæ¸ é“ç»™æŸä¸€ä¸ªç”¨æˆ·å‘é€ä¸€æ¬¡ï¼Œä¸è¦é‡å¤å‘é€ã€‚</p>
</blockquote>
<p>chatgpt å›ç­”å¦‚ä¸‹ï¼š</p>
<img src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-10-06.png" alt="weekly-review-10-06" style="width:67%;" />
<p><strong>æ€»ç»“ï¼š</strong></p>
<p>è®© chatgpt å†™ä»£ç ç›¸å¯¹æ¥è¯´ï¼Œè¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œå¯ä»¥æä¾›ä¸€äº›ç¼–ç¨‹ç¤ºä¾‹æˆ–è€…å¼€é˜”ç¼–ç¨‹æ€è·¯ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›ç¼ºé™·ï¼š</p>
<ul>
<li>chatgpt å†™çš„ä»£ç ä¸ä¸€å®šå‡†ç¡®ï¼Œæˆ–è€…è¯´æ²¡æœ‰è€ƒè™‘ä¸€äº›å¼‚å¸¸æƒ…å†µã€‚éœ€è¦ä¸æ–­åœ°å’Œ chatgpt èŠå¤©ï¼Œæè¿°æ¸…æ¥šéœ€æ±‚ï¼Œè®© chatgpt æ¥ä¿®æ­£ä»£ç ï¼Œè¿™æ ·äº¤äº’å¼èŠå¤©ï¼Œç›¸å¯¹æ¥è¯´ä¼šæœ‰ç‚¹è€—æ—¶ã€‚</li>
<li>æä¾›çš„ url é“¾æ¥å¯èƒ½ 404ã€‚</li>
</ul>
<h2 id="å¥½ç‰©åˆ†äº«">å¥½ç‰©åˆ†äº«</h2>
<p>è™½ç„¶å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€<a href="https://t.me/chensoul_share">ChenSoul Share</a>ã€Telegram é¢‘é“ï¼Œä¸è¿‡è¿˜æ˜¯æŒ‘é€‰ä¸€éƒ¨åˆ†åœ¨è¿™é‡Œåˆ—ä¸¾ä¸€ä¸‹ï¼Œæ„Ÿè§‰æ›´åƒä¸€ä¸ª newsletter äº†ã€‚</p>
<h3 id="ä¸€äº›æ–‡ç« ">ä¸€äº›æ–‡ç« </h3>
<ul>
<li>
<p><a href="https://www.infoq.cn/article/txS9hHTfxasv2uHBATgL">Java è¿‘æœŸæ–°é—»ï¼šGradle 8.0ã€Mavenã€Payara å¹³å°ã€Piranhaã€Spring Frameworkã€MyFaces å’Œ Piranha</a></p>
</li>
<li>
<p><a href="https://blognas.hwb0307.com/ad">RackNerd VPS æ¨è</a></p>
</li>
</ul>
<h3 id="ä¸€äº›å·¥å…·">ä¸€äº›å·¥å…·</h3>
<h4 id="zedhttpszeddev"><a href="https://zed.dev/">Zed</a></h4>
<p>Atom ä½œè€…æ–°å¼€å‘çš„ç¼–è¾‘å™¨ Zed é€Ÿåº¦ç¡®å®éå¸¸å¿«ï¼ŒåŸºæœ¬çš„åŠŸèƒ½ä¹Ÿéƒ½æ”¯æŒï¼Œç°åœ¨è¿˜åœ¨å†…æµ‹é˜¶æ®µï¼Œæš‚æ—¶ä¸æ”¯æŒå®‰è£… extensionã€‚</p>
<h4 id="å›¾ç‰‡è½¬-webphttpsdevelopersgooglecomspeedwebpdocscwebphlzh-cn"><a href="https://developers.google.com/speed/webp/docs/cwebp?hl=zh-cn">å›¾ç‰‡è½¬ webp</a></h4>
<p>mac ä¸Šå®‰è£…ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">brew install webp
</span></span></code></pre></div><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cwebp -q <span class="m">50</span> -lossless picture.png -o picture_lossless.webp
</span></span><span class="line"><span class="cl">cwebp -q <span class="m">70</span> picture_with_alpha.png -o picture_with_alpha.webp
</span></span><span class="line"><span class="cl">cwebp -sns <span class="m">70</span> -f <span class="m">50</span> -size <span class="m">60000</span> picture.png -o picture.webp
</span></span></code></pre></div><h3 id="ä¸€äº›å½±è§†">ä¸€äº›å½±è§†</h3>
<ul>
<li>
<p><a href="https://movie.douban.com/subject/6538807/">å†°æµ·é™·è½</a>ï¼Œæ¨èæŒ‡æ•°ï¼šâ˜†â˜†â˜†â˜†ã€‚ç–¯ç‹‚çš„èŠ­å ¤é›…å°†å†›æœç½—å¤«ï¼ˆç±³å“ˆä¼Šå°”ãƒ»æˆˆå°”æ²ƒä¼Š Mikhail Gorevoy é¥°ï¼‰é¢„è°‹å‘åŠ¨ç¬¬ä¸‰æ¬¡ä¸–ç•Œå¤§æˆ˜ï¼Œä»–åˆ¶é€ äº†ä¸€åœºå·¨å¤§çš„æ°´åŸŸçˆ†ç‚¸ï¼Œè‡´ä½¿é™„è¿‘çš„ç¾å†›æ½œè‰‡é˜Ÿé‡è¢­ã€‚ç¾å›½æµ·å†›æ´¾å‡ºäº†æµ·åº•ç»éªŒä¸°å¯Œä½†åå£°å¯¥å¯¥çš„ä¹”ãƒ»æ ¼æ‹‰æ–¯æ½œæ°´è‰‡èˆ¹é•¿ï¼ˆæ°æ‹‰å¾·ãƒ»å·´ç‰¹å‹’ Gerard Butler é¥°ï¼‰ç‡é¢†æ½œè‰‡é˜Ÿå‰å»è°ƒæŸ¥ã€‚</p>
</li>
<li>
<p><a href="https://movie.douban.com/subject/36193784/">é»‘æš—è£è€€ç¬¬äºŒå­£</a>ï¼Œæ¨èæŒ‡æ•°ï¼šâ˜†â˜†â˜†â˜†ã€‚</p>
</li>
</ul>
<p>ä»¥ä¸Šã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>å‘¨æŠ¥-9ï½œå¼€è½¦æ€»ç»“ã€åšå®¢è¯¥å†™ä»€ä¹ˆã€Web3æ‰¹é‡ç©ºæŠ•</title>
      <link>https://blog.chensoul.com/posts/2023/03/07/weekly_review_9/</link>
      <pubDate>Tue, 07 Mar 2023 11:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/03/07/weekly_review_9/</guid>
      <description>å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-02-27 åˆ° 2023-03-05 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚ è¿™å‘¨çš„ä¸»è¦å·¥ä½œæ˜¯ç‰ˆæœ¬æµ‹è¯•å’Œé¡¹ç›®ä¸Šçº¿ï¼Œåœ¨å¤§å®¶çš„å…±åŒ</description>
      <content:encoded><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-09-07.png" alt="å°†å†›å±±"  />
</p>
<p>æœ¬ç¯‡æ˜¯å¯¹ <code>2023-02-27</code> åˆ° <code>2023-03-05</code> è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº <a href="https://blog.chensoul.com/">åšå®¢</a>ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚</p>
<p>è¿™å‘¨çš„ä¸»è¦å·¥ä½œæ˜¯ç‰ˆæœ¬æµ‹è¯•å’Œé¡¹ç›®ä¸Šçº¿ï¼Œåœ¨å¤§å®¶çš„å…±åŒåŠªåŠ›ä¸‹ï¼Œæœ€åæ˜¯æˆåŠŸä¸Šçº¿ã€‚</p>
<p>ç”±äºå…¬å¸æœ€è¿‘åœ¨è£å‘˜ï¼Œç•™ä¸‹æ¥çš„éƒ½å¼€å§‹å·èµ·æ¥ï¼Œæ¯å¤©æ™šä¸Š 8 ç‚¹ä¹‹åä¸‹ç­ï¼Œè¿™æ ·å¹³å‡ä¸€å¤©çš„å·¥ä½œæ—¶é—´æ‰æœ‰ 11 å°æ—¶ã€‚æ®è¯´ï¼Œæ—è¾¹ç»„çš„åŒäº‹å¹³å‡æ¯å¤©éƒ½æ˜¯ 12 ä¸ªå°æ—¶å·¥ä½œæ—¶é—´ã€‚è£äº†ä¸‰ä½åŒäº‹ä¹‹åï¼Œæˆ‘ä»¬è½¯ä»¶ç»„è¿˜æœ‰ 8 äººï¼Œç®—æ³•ç»„æœ‰ 7 äººï¼Œäº§å“ç»„æœ‰ 6 äººï¼Œç»ˆç«¯ç»„æœ‰ 4 äººã€‚è·é›†å›¢å…¬å¸å…­æœˆä¸Šå¸‚è¿˜æœ‰ä¸¤ä¸ªæœˆï¼Œè£å‘˜ä¼°è®¡è¿˜ä¼šç»§ç»­ï¼ŒåŒå¿—ä»¬è¿˜éœ€åŠªåŠ›åŠ ç­ï¼Œäº‰å–è¢«è£çš„ä¸æ˜¯è‡ªå·±ã€‚</p>
<p>è¿™å‘¨è¿˜æ˜¯æ²¡æœ‰å¼€è½¦ï¼Œæ¯å¤©ååœ°é“ä¸Šä¸‹ç­ï¼Œåˆ·åˆ· rss çœ‹çœ‹ b ç«™è§†é¢‘ï¼Œäº†è§£ä¸€äº›è¡Œä¸šæœ€æ–°åŠ¨æ€ï¼ŒåŒæ—¶ä¹Ÿçœ‹çœ‹åŒæ ·åœ¨å†™åšå®¢çš„é‚£äº›ç‹¬ç«‹å¼€å‘è€…æ¯å‘¨éƒ½åœ¨åšä»€ä¹ˆï¼Œä¹Ÿå­¦ä¹ ä¸€äº›æ–°æŠ€æœ¯æˆ–è€…æ–°æŠ€èƒ½ã€‚</p>
<p>è¿™å‘¨æ¥è§¦äº† web3 ç©ºæŠ•ï¼ŒèŠ±äº†å‡ ä¸ªå°æ—¶ä½¿ç”¨è‡ªåŠ¨åŠ æ‰‹åŠ¨çš„æ–¹å¼åˆ·äº† 120 å¤šä¸ªè´¦å·ã€‚è‡ªåŠ¨çš„æ–¹å¼ï¼Œå°±æ˜¯ç”¨ nodejs ä»£ç åœ¨ bsc ç½‘ç»œæ‰¹é‡åˆ›å»ºè´¦å·å¹¶ä¿å­˜ä¸º csv æ–‡ä»¶ï¼›å…¶æ¬¡ï¼Œé€šè¿‡ onekey web ä¸Šçš„æ‰¹é‡è½¬è´¦åŠŸèƒ½ï¼Œç»™æ¯ä¸ªè´¦æˆ·è½¬äº† 0.00125bnbã€‚æ‰‹åŠ¨æ“ä½œçš„éƒ¨åˆ†å°±æ˜¯ï¼Œä¸€ä¸ªä¸ªçš„å°†è´¦å·ç§é’¥å¯¼å…¥ç‹ç‹¸é’±åŒ…ï¼Œç„¶åï¼Œç”¨ lifeform cartoon è¿æ¥é’±åŒ…è´¦æˆ·ï¼Œmint æˆåŠŸä¹‹åï¼Œåˆ†äº«é“¾æ¥ï¼Œå†ç»§ç»­è¿æ¥ç‹ç‹¸çš„ä¸‹ä¸€ä¸ªè´¦å·ï¼Œé‡å¤ä¸Šé¢æ“ä½œã€‚</p>
<p>å› ä¸ºå¤ªè€—æ—¶é—´ï¼Œæ‰€ä»¥åªåˆ·äº† 120 ä¸ªè´¦å·ã€‚è¶å·¥ä½œä¸å¿™çš„æ—¶å€™ï¼Œç”¨ chatgpt æœç´¢ä¸€ä¸‹å¦‚ä½•å°†ä¸Šé¢çš„æ“ä½œå…¨éƒ¨è‡ªåŠ¨åŒ–ã€‚</p>
<p>å‘¨æœ«ä¸¤å¤©ï¼Œç»§ç»­ç»ƒè½¦ï¼Œä»æ±‰å£åˆ°é˜³é€»ï¼Œå†åˆ°æ–°æ´²ï¼Œæœ€åå»æ–°æ´²çš„å°†å†›å±±çˆ¬å±±ã€å»é“è§‚æ²³çœ‹é£æ™¯ã€‚ç®—ä¸‹æ¥ï¼Œæœ€è¿‘è¿™ä¸‰ä¸ªå‘¨æœ«å…­å¤©æ—¶é—´ï¼Œæˆ‘ä¸€å…±å¼€äº† 800 å¤šå…¬é‡Œäº†ã€‚ç›®å‰ï¼Œæš‚æ—¶æ²¡æœ‰æ”¶åˆ°è¿è§„é€šçŸ¥ï¼Œä½†è¿˜æ˜¯å­˜åœ¨å¾ˆå¤šä¸è¶³çš„åœ°æ–¹ã€‚</p>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-09-08.png" alt="weekly-review-09-08"  />
</p>
<h2 id="å¼€è½¦æ€»ç»“">å¼€è½¦æ€»ç»“</h2>
<p>è¿™å‘¨å¼€è½¦ï¼Œå‘ç°å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ul>
<li>1ã€åœè½¦è¿˜æ˜¯ä¼šå¿˜è®°ç†„ç«æ‹”é’¥åŒ™ã€‚</li>
<li>2ã€çº¢ç»¿ç¯å£ï¼Œåœåœ¨å¤§è´§è½¦åé¢ï¼Œå¹¶é å¾—è¿‘ï¼Œå‰æ–¹è§†çº¿å—é˜»ã€‚ç»è¿‡çº¢ç»¿ç¯æ—¶ï¼Œæ„Ÿè§‰åƒæ˜¯é—¯äº†çº¢ç¯ã€‚</li>
<li>3ã€è¶…è½¦æ—¶å€™ï¼Œæ²¡æœ‰åŠ é€Ÿã€‚</li>
<li>4ã€åœ¨å±±è·¯è¡Œé©¶ï¼Œå…¥å¼¯å’Œå‡ºå¼¯éƒ½ä¼šå‡é€Ÿã€‚</li>
<li>5ã€åˆ¤æ–­è½¦è·çš„ç»éªŒä¸è¶³ã€‚è¡¨ç°åœ¨è¡Œé©¶è¿‡ç¨‹ä¸­ã€ä¾§æ–¹åœè½¦ã€å€’è½¦å…¥åº“ã€‚</li>
</ul>
<p>é’ˆå¯¹ä»¥ä¸Šé—®é¢˜ï¼Œæ™šä¸Šåˆ·äº†ä¸€äº›è§†é¢‘ï¼Œåšäº†ä¸€äº›ç¬”è®°ï¼Œå¸Œæœ›èƒ½å¤Ÿå¸®åŠ©è‡ªå·±æ”¹æ­£ä¸Šé¢è¿™äº›é—®é¢˜ã€‚</p>
<ul>
<li>
<p>1ã€ç›®å…‰çœ‹è¿œã€‚å…¥å¼¯æå‰æ”¶æ²¹ï¼Œè„šå¤‡åˆ¹è½¦ã€‚å¦‚æœå¼¯é“è¿‡æ€¥ï¼Œå°±å¸¦ç‚¹åˆ¹è½¦ï¼Œå¦‚æœè½¦é€Ÿä½ å¯ä»¥æ§åˆ¶ï¼Œç›´æ¥æ”¶æ²¹è¿‡å¼¯ï¼›å‡ºå¼¯åŠ æ²¹ï¼Œçœ¼ç›çœ‹å‡ºå¼¯å£ã€‚èº«ä½“è·Ÿéšæ–¹å‘ç›˜é ã€‚è¿™æ ·ï¼Œè½¦é€Ÿä¸é™ï¼Œå¯ä»¥æ§åˆ¶è½¦é€Ÿã€‚å¦‚æœä»¥ 80 ç é€Ÿåº¦è¿‡å¼¯ï¼Œä¸”è¿™ä¸ªè½¦è¿˜åœ¨è½¦é“å†…ï¼Œè¿™ä¸ªè½¦çš„é€Ÿåº¦ä½ å°±æ§åˆ¶ä½äº†ã€‚ä½†å‡¡æœ‰ç‚¹è¶Šçº¿ï¼Œè¯´æ˜è½¦é€Ÿè¿‡å¿«ï¼Œä½ å°±è¦é™ä½é€Ÿåº¦ã€‚</p>
</li>
<li>
<p>2ã€é å³è¡Œé©¶ã€‚ä¼šè½¦æ—¶ï¼Œä¸»åŠ¨é å³ã€‚è½¬å¼¯æ—¶ï¼Œå‘ç°å¯¹é¢æœ‰æ¥è½¦ï¼Œé¸£ç¬›ç¤ºæ„ã€‚</p>
</li>
<li>
<p>3ã€è·¯å£è¿œé“çš„åŸåˆ™ï¼Œè·Ÿå°è½¦ä¸è·Ÿå¤§è½¦ã€‚å¦‚æœè·Ÿç€å¤§è½¦ï¼Œç•™ä¸€ä¸ªè½¦ä½ç©ºé—´ï¼Œè®©å¤§è½¦å…ˆèµ°ï¼Œç¡®è®¤ç»¿ç¯å†èµ°ã€‚</p>
</li>
<li>
<p>4ã€çº¢ç»¿ç¯è·¯å£ï¼Œæå‰å‡é€Ÿï¼Œæé†’åé¢è½¦å‡é€Ÿï¼Œä¸è¦æ€¥åˆ¹è½¦ï¼Œé˜²æ­¢åé¢è½¦è¿½å°¾ã€‚ç‰¹åˆ«æ˜¯åœ¨ç»¿ç¯é—ªçš„æ—¶å€™ï¼Œä¸è¦æ²¡æœ‰å‡é€Ÿï¼Œçªç„¶åœè½¦ã€‚å¦åˆ™åé¢è½¦ä¼šä»¥ä¸ºä½ è¦åŠ é€Ÿå†²è¿‡å»ï¼Œä»–ä¹ŸåŠ é€Ÿï¼Œè¿™æ ·ï¼Œä»–å°±ä¼šè¿½å°¾ä½ ã€‚</p>
</li>
</ul>
<h2 id="åšå®¢è¯¥å†™ä»€ä¹ˆ">åšå®¢è¯¥å†™ä»€ä¹ˆ</h2>
<p>çœ‹åˆ°ä¸€ç¯‡åšå®¢ <a href="https://simonwillison.net/2022/Nov/6/what-to-blog-about/">What to blog about</a>ï¼Œé‡Œé¢èŠåˆ°äº†åšå®¢è¯¥å†™ä»€ä¹ˆã€‚ä¸€æ—¶å…´èµ·ï¼Œæƒ³ç¿»è¯‘æˆä¸­æ–‡ã€‚äºæ˜¯ï¼Œåˆ†åˆ«ä½¿ç”¨äº† chrome æ²‰æµ¸å¼ç¿»è¯‘æ’ä»¶å’Œ chatgpt æ¥ç¿»è¯‘è¿™ç¯‡æ–‡ç« ï¼Œå¾—åˆ°ç»“æœå¦‚ä¸‹ï¼š</p>
<p>1ã€<strong>ä½¿ç”¨ <a href="https://chrome.google.com/webstore/detail/immersive-translate/bpoadfkcbjbfhfodiogcnhhhpibjhbnh">chrome æ²‰æµ¸å¼ç¿»è¯‘æ’ä»¶</a> ç¿»è¯‘è¿™ç¯‡æ–‡ç« ï¼š</strong></p>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-09-01.png" alt="weekly-review-01"  />
</p>
<p>æ€»ç»“æ¥è¯´ï¼Œåšå®¢å¯ä»¥å†™ä¸¤éƒ¨åˆ†å†…å®¹ï¼š</p>
<ul>
<li>ä»Šå¤©å­¦åˆ°çš„ä¸œè¥¿</li>
<li>æ­£åœ¨åšçš„é¡¹ç›®</li>
</ul>
<p>2ã€<strong>ä½¿ç”¨ chatgpt ç¿»è¯‘è¿™ç¯‡æ–‡ç« ï¼š</strong></p>
<p>è¯· chatgpt ç¿»è¯‘è¿™ç¯‡æ–‡ç«  <a href="https://simonwillison.net/2022/Nov/6/what-to-blog-about/">https://simonwillison.net/2022/Nov/6/what-to-blog-about/</a> ä¸ºä¸­æ–‡ï¼Œå¾—åˆ°çš„ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-09-02.png" alt="weekly-review-02"  />
</p>
<p>æ ‡é¢˜ï¼šè¯¥å†™ä»€ä¹ˆåšå®¢ï¼Ÿ</p>
<p>éšç€æˆ‘å†™äº†ä¸€ç¯‡æ–°çš„åšå®¢æ–‡ç« ï¼Œæˆ‘æƒ³åˆ†äº«ä¸€ä¸‹æˆ‘æœ€è¿‘å­¦åˆ°çš„å…³äºå†™åšå®¢çš„ä¸€äº›äº‹æƒ…ã€‚</p>
<p>ä¸€æ—¦ä½ å¼€å§‹å†™åšå®¢ï¼Œä½ å°±å¿…é¡»ä¿æŒä¸€å®šçš„é¢‘ç‡å’ŒæŒç»­çš„å†…å®¹æ›´æ–°ã€‚è¿™ä¸ä»…æ˜¯ä¸ºäº†å¸å¼•å’Œä¿æŒè¯»è€…ï¼Œä¹Ÿæ˜¯ä¸ºäº†è®©è‡ªå·±ä¸æ–­æˆé•¿å’Œå‘å±•ã€‚å¯¹äºæˆ‘æ¥è¯´ï¼Œåšå®¢æ˜¯æˆ‘æœ€æœ‰ä»·å€¼çš„è‡ªæˆ‘è¡¨è¾¾å½¢å¼ä¹‹ä¸€ï¼Œå› ä¸ºå®ƒè¿«ä½¿æˆ‘å»æ€è€ƒå’Œç»„ç»‡æˆ‘çš„æƒ³æ³•ï¼Œè€Œè¿™äº›æƒ³æ³•å¯èƒ½ä¼šè¢«æ·¹æ²¡åœ¨æ—¥å¸¸ç”Ÿæ´»çš„å–§åš£ä¸­ã€‚</p>
<p>ä½†æ˜¯ï¼Œé€‰æ‹©åšå®¢å†…å®¹å¯ä»¥å¾ˆå›°éš¾ï¼Œç‰¹åˆ«æ˜¯å½“ä½ æœ‰å¤šä¸ªæ„Ÿå…´è¶£çš„è¯é¢˜å’Œé¡¹ç›®ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æˆ‘æœ€è¿‘å­¦åˆ°çš„æœ‰å…³é€‰æ‹©åšå®¢ä¸»é¢˜çš„æŠ€å·§ï¼š</p>
<ul>
<li>æ¯å‘¨è‡³å°‘å†™ä¸€ç¯‡æ–‡ç« </li>
</ul>
<p>å°½ç®¡è¿™å¯èƒ½å¬èµ·æ¥åƒä¸€ä¸ªè‰°å·¨çš„ä»»åŠ¡ï¼Œä½†ä¿æŒæ¯å‘¨è‡³å°‘å†™ä¸€ç¯‡æ–‡ç« çš„é¢‘ç‡å¯ä»¥å¸®åŠ©ä½ ä¿æŒå†™ä½œçš„ä¹ æƒ¯å’Œè¿›å±•ã€‚è¿™ä¹Ÿæœ‰åŠ©äºé¿å…é•¿æ—¶é—´çš„ç©ºç™½æœŸï¼Œè¿™å¯èƒ½ä¼šä½¿ä½ å¤±å»å†™ä½œçš„åŠ¨åŠ›å’Œè¯»è€…çš„å…´è¶£ã€‚</p>
<ul>
<li>å†™ä¸‹ä½ çš„ç›®æ ‡å’Œæƒ³æ³•æ¸…å•</li>
</ul>
<p>åœ¨å¼€å§‹å†™åšå®¢ä¹‹å‰ï¼Œå…ˆå†™ä¸‹ä½ æ„Ÿå…´è¶£çš„è¯é¢˜å’Œä½ æƒ³å†™çš„å†…å®¹ã€‚è¿™å¯ä»¥å¸®åŠ©ä½ ä¿æŒç„¦ç‚¹å¹¶é¿å…æµªè´¹æ—¶é—´åœ¨æƒ³è¦çš„å†…å®¹ä¸Šã€‚</p>
<ul>
<li>å…³æ³¨ä½ çš„è¯»è€…</li>
</ul>
<p>è™½ç„¶ä½ çš„åšå®¢å¯èƒ½æ˜¯ä¸€ä¸ªäººçš„é¡¹ç›®ï¼Œä½†æ˜¯è€ƒè™‘åˆ°ä½ çš„è¯»è€…çš„å…´è¶£å’Œéœ€æ±‚æ˜¯è‡³å…³é‡è¦çš„ã€‚è¯•ç€æƒ³ä¸€ä¸‹ä½ çš„è¯»è€…ä¼šå¯¹å“ªäº›è¯é¢˜æ„Ÿå…´è¶£ï¼Œå¹¶å°è¯•å†™å‡ºä»–ä»¬ä¼šå‘ç°æœ‰è¶£æˆ–æœ‰ç”¨çš„å†…å®¹ã€‚</p>
<ul>
<li>ä¿æŒå¼€æ”¾å’Œçµæ´»</li>
</ul>
<p>ä¸è¦æŠŠè‡ªå·±å±€é™åœ¨ä¸€ä¸ªä¸»é¢˜æˆ–é¢†åŸŸä¸­ã€‚ä¿æŒå¼€æ”¾å’Œçµæ´»ï¼Œå°è¯•ä¸åŒçš„è¯é¢˜å’Œé¢†åŸŸã€‚è¿™ä¸ä»…å¯ä»¥è®©ä½ å‘ç°æ–°çš„å…´è¶£å’Œæœºä¼šï¼Œè¿˜å¯ä»¥è®©ä½ åœ¨å†™ä½œæ–¹é¢æ›´æœ‰åˆ›æ„å’Œçµæ„Ÿã€‚</p>
<ul>
<li>å°è¯•ä¸åŒçš„åšå®¢æ ¼å¼</li>
</ul>
<p>ä¸ä»…å¯ä»¥é€šè¿‡å†™ä½œæ¥è¡¨è¾¾è‡ªå·±ï¼Œè¿˜å¯ä»¥é€šè¿‡ä¸åŒçš„åšå®¢æ ¼å¼æ¥å®ç°è¿™ä¸€ç‚¹ã€‚å°è¯•å†™ä¸€ç¯‡æ•™ç¨‹ã€ä¸€ç¯‡æ¼”ç¤ºã€ä¸€ç¯‡è¯„è®ºæˆ–ä¸€ç¯‡é—®é¢˜è§£ç­”æ–‡ç« ã€‚è¿™å¯ä»¥è®©ä½ æ›´å¥½åœ°æ¢ç´¢å’Œå±•ç¤ºä½ çš„æŠ€èƒ½å’ŒçŸ¥è¯†ã€‚</p>
<p>æ€»ä¹‹ï¼Œå†™åšå®¢å¯ä»¥æ˜¯ä¸€ç§ä»¤äººæ»¡æ„çš„è¡¨è¾¾æ–¹å¼ï¼Œå¯ä»¥å¸®åŠ©ä½ æ¢ç´¢å’Œå‘ç°æ–°çš„æƒ³æ³•å’Œæœºä¼šã€‚å…³é”®æ˜¯è¦ä¿æŒé¢‘ç‡å’Œçµæ´»æ€§ï¼Œå¹¶å°è¯•ä¸åŒçš„åšå®¢æ ¼å¼ã€‚</p>
<h2 id="web3-æ‰¹é‡ç©ºæŠ•">Web3 æ‰¹é‡ç©ºæŠ•</h2>
<p>æœ€è¿‘ï¼Œå‚ä¸äº† <a href="https://cartoon.lifeform.cc/login">Lifeform Cartoon</a> çš„ç©ºæŠ•ï¼Œè¿™æ˜¯æˆ‘ç¬¬ä¸€æ¬¡å‚ä¸ web3ã€‚ä¸‹é¢æ˜¯è®°å½•ä¸€ä¸‹æ“ä½œæ­¥éª¤ï¼š</p>
<ul>
<li>ä¸‹è½½ç‹ç‹¸é’±åŒ…</li>
<li>æ‰¹é‡åˆ›å»ºè´¦å·</li>
<li>æ‰¹é‡ä»ä¸€ä¸ªè´¦å·è½¬å¸åˆ°å¤šä¸ªè´¦å·</li>
<li>æ‰¹é‡å¯¼å…¥è´¦å·åˆ°ç‹ç‹¸é’±åŒ…</li>
<li>è®¿é—® Lifeform Cartoon çš„é‚€è¯·é“¾æ¥åœ°å€ï¼Œæ¯”å¦‚ï¼šhttps://cartoon.lifeform.cc?referral=0x068b021B7d44e4795c6ec07234D66c144644dC37ï¼Œç„¶åï¼Œè¿æ¥ç‹ç‹¸é’±åŒ…é‡Œçš„è´¦å·ï¼Œmint ä¹‹åï¼Œåˆ†äº«é“¾æ¥å†ä½¿ç”¨æ–°çš„é“¾æ¥é‡å¤ä¸Šé¢åŠ¨ä½œ</li>
</ul>
<p>ä¸Šé¢çš„æ­¥éª¤ï¼Œå¦‚æœæ˜¯å‡ ç™¾ä¸ªè´¦å·æ‰‹åŠ¨æ‰§è¡Œï¼Œåˆ™éœ€è¦èŠ±è´¹å¾ˆé•¿æ—¶é—´ã€‚ä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œæœ‰æ²¡æœ‰åŠæ³•è®©ç¨‹åºè‡ªåŠ¨å®ç°å‘¢ï¼Ÿ</p>
<p>åœ¨ç½‘ä¸ŠæŸ¥æ‰¾äº†ä¸€äº›èµ„æ–™ï¼ŒåŒæ—¶ä½¿ç”¨ chatgptï¼ˆå¤‡æ³¨ï¼šhttps://poe.com/chatgptï¼‰æ‰¾åˆ°äº†ä½¿ç”¨  nodejs å®ç°çš„ç›¸å…³ä»£ç ã€‚</p>
<h3 id="1æ‰¹é‡åˆ›å»ºè´¦å·">1ã€æ‰¹é‡åˆ›å»ºè´¦å·</h3>
<p>åœ¨BSCç½‘ç»œä¸Šä½¿ç”¨Node.jsç¼–ç¨‹è¯­è¨€æ‰¹é‡åˆ›å»ºè´¦æˆ·å¹¶ä¿å­˜ä¸ºCSVæ–‡ä»¶çš„å®Œæ•´ä»£ç ï¼Œä¸ä½¿ç”¨csv-writeråº“</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-09-03.png" alt="weekly-review-03"  />
</p>
<h3 id="2æ‰¹é‡è½¬è´¦">2ã€æ‰¹é‡è½¬è´¦</h3>
<p>åœ¨BSCç½‘ç»œä¸Šä½¿ç”¨Node.jsç¼–ç¨‹è¯­è¨€ä»ä¸€ä¸ªè´¦å·æ‰¹é‡è½¬ 0.0125bnb åˆ°å‰é¢åˆ›å»ºçš„å¤šä¸ªè´¦å·ï¼Œè¾“å‡ºå®Œæ•´çš„å¯ä»¥è¿è¡Œçš„ä»£ç </p>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-09-05.png" alt="weekly-review-05"  />
</p>
<h3 id="3æ‰¹é‡å¯¼å…¥è´¦å·åˆ°-metamask-é’±åŒ…">3ã€æ‰¹é‡å¯¼å…¥è´¦å·åˆ° metamask é’±åŒ…</h3>
<p>é€šè¿‡ç¼–ç¨‹å®ç°åœ¨ BSC ç½‘ç»œ æ‰¹é‡å¯¼å…¥è´¦å·åˆ°æµè§ˆå™¨çš„ metamask é’±åŒ…</p>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-09-04.png" alt="weekly-review-04"  />
</p>
<p>ä¸‹ä¸€æ­¥ï¼Œå°±æ˜¯æµ‹è¯•ä¸Šé¢ä»£ç ï¼Œå®ç°å…¨æµç¨‹ä»£ç æ‰˜ç®¡ã€‚</p>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-09-06.png" alt="weekly-review-09-06"  />
</p>
<h2 id="å¥½ç‰©åˆ†äº«">å¥½ç‰©åˆ†äº«</h2>
<p>è™½ç„¶å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€<a href="https://t.me/chensoul_share">ChenSoul Share</a>ã€Telegram é¢‘é“ï¼Œä¸è¿‡è¿˜æ˜¯æŒ‘é€‰ä¸€éƒ¨åˆ†åœ¨è¿™é‡Œåˆ—ä¸¾ä¸€ä¸‹ï¼Œæ„Ÿè§‰æ›´åƒä¸€ä¸ª newsletter äº†ã€‚</p>
<h3 id="ä¸€äº›æ–‡ç« ">ä¸€äº›æ–‡ç« </h3>
<ul>
<li><a href="https://feeds.feedblitz.com/~/729974291/0/baeldung~Service-Profiles-in-Docker">Service Profiles in Docker | Baeldung</a></li>
<li><a href="https://geekr.dev/posts/chatgpt-ultimate-guide">ChatGPT ç»ˆææŒ‡å—</a></li>
<li><a href="https://reorx.com/makers-daily/004-prompts-and-parameters-transparancy/">è°ˆè°ˆæˆ‘å¯¹ ChatGPT åº”ç”¨çš„ prompt çš„çœ‹æ³•</a></li>
<li><a href="https://anotherdayu.com/2023/4866/">æ”¯æŒ OpenAI ChatGPT API çš„ä¼˜ç§€è½¯ä»¶</a></li>
<li><a href="https://geekr.dev/posts/chatgpt-start">ç¼–ç¨‹æ–°æ‰‹å¦‚ä½•é€šè¿‡ChatGPTä¸€å¤©å®Œæˆä¸€ä¸ªMVPäº§å“</a></li>
<li><a href="https://github.com/Zhengqbbb/cz-git">è®© OpenAI ç”Ÿæˆ git commit message</a></li>
<li><a href="https://insights.thoughtworks.cn/good-code-five-qualities-cupid/">å¥½ä»£ç çš„äº”ä¸ªç‰¹è´¨ - Thoughtworksæ´è§</a></li>
<li><a href="https://www.joshwcomeau.com/blog/how-i-built-my-blog/">æˆ‘å¦‚ä½•æ­å»ºè‡ªå·±çš„åšå®¢</a>ï¼ˆè‹±æ–‡ï¼‰</li>
<li><a href="https://zedex.cn/8399.html">ä»Macå¼€ç®±å¼€å§‹ è®¾ç½®ä¸€ä¸ªå¼€å‘ç¯å¢ƒ - ZedeX</a></li>
<li><a href="https://mp.weixin.qq.com/s/eil_zYS4ISK-4ojezzP-pg">åˆ›å§‹äººCEOä¸ºä»€ä¹ˆè¦å†™ä½œï¼ˆåŸåˆ›5000å­—é•¿æ–‡å°è¯•è¯´é€ï¼‰</a></li>
<li><a href="https://mp.weixin.qq.com/s/xfphy67PTbtjeggo7LpjSA">ä»æŠ„ä¹¦åˆ°å¼€æºä¹‹å·…ï¼šç« äº¦æ˜¥çš„ç¨‹åºäººç”Ÿ</a></li>
</ul>
<h3 id="ä¸€äº›å·¥å…·">ä¸€äº›å·¥å…·</h3>
<h4 id="1poecomhttpspoecom">1ã€<a href="https://poe.com/"><strong>poe.com</strong></a></h4>
<p>ç¾å›½é—®ç­”ç½‘ç«™Quoraå¼€å‘çš„ChatBotäº§å“ï¼Œæ•´åˆä¸åŒèŠå¤©æœºå™¨ï¼ŒåŒ…æ‹¬ChatGPTã€‚å“åº”é€Ÿåº¦éå¸¸å¿«ï¼Œæ¯”chat.openai.comçš„å…è´¹è´¦æˆ·å¿«éå¸¸å¤šã€‚æœ‰iosç‰ˆï¼Œæ‰‹æœºä¹Ÿèƒ½ç”¨äº†ã€‚iosç‰ˆæœ‰ç¤¾åŒºï¼Œå¯ä»¥åˆ†äº«èŠå¤©è®°å½•ã€‚</p>
<h4 id="2founderbeatshttpsfounderbeatscom">2ã€<a href="https://founderbeats.com/"><strong>FounderBeats</strong></a></h4>
<p>Founder Beatsæ˜¯ä¸€å®¶é¢å‘åˆåˆ›ä¼ä¸šå’Œåˆ›ä¸šè€…çš„éŸ³ä¹åˆ¶ä½œå·¥ä½œå®¤ï¼Œä¸“é—¨ä¸ºä»–ä»¬æä¾›é«˜è´¨é‡çš„èƒŒæ™¯éŸ³ä¹å’ŒéŸ³æ•ˆã€‚Founder Beatsçš„éŸ³ä¹åº“åŒ…å«äº†å„ç§ç±»å‹çš„éŸ³ä¹ï¼Œå¦‚æµè¡Œã€æ‘‡æ»šã€ç”µå­ã€å˜»å“ˆã€æ°‘è°£ç­‰ï¼Œä»¥åŠå„ç§éŸ³æ•ˆå’Œé…ä¹ï¼Œå¯ä»¥æ»¡è¶³ä¸åŒç”¨æˆ·çš„éœ€æ±‚ã€‚Founder Beatsçš„éŸ³ä¹éƒ½æ˜¯ç”±ä¸“ä¸šéŸ³ä¹äººå’Œåˆ¶ä½œäººåˆ¶ä½œçš„ï¼Œå…·æœ‰é«˜å“è´¨å’ŒåŸåˆ›æ€§ã€‚</p>
<p>é™¤äº†éŸ³ä¹åˆ¶ä½œï¼ŒFounder Beatsè¿˜æä¾›äº†å…¶ä»–æœåŠ¡ï¼Œå¦‚éŸ³é¢‘åˆ¶ä½œã€æ··éŸ³å’Œæ¯å¸¦å¤„ç†ç­‰ï¼Œå¯ä»¥å¸®åŠ©å®¢æˆ·åˆ¶ä½œé«˜è´¨é‡çš„éŸ³é¢‘å†…å®¹ã€‚Founder Beatsçš„å›¢é˜Ÿæ‹¥æœ‰ä¸°å¯Œçš„éŸ³ä¹åˆ¶ä½œå’ŒéŸ³é¢‘å¤„ç†ç»éªŒï¼Œå¯ä»¥ä¸ºå®¢æˆ·æä¾›ä¸“ä¸šçš„å»ºè®®å’Œæ”¯æŒã€‚</p>
<p>Founder Beatsçš„å®¢æˆ·åŒ…æ‹¬åˆåˆ›ä¼ä¸šã€å¹¿å‘Šä»£ç†å•†ã€è§†é¢‘åˆ¶ä½œå…¬å¸ã€æ¸¸æˆå¼€å‘å•†ç­‰ï¼Œä»–ä»¬å¯ä»¥ä½¿ç”¨Founder Beatsçš„éŸ³ä¹å’ŒéŸ³æ•ˆæ¥å¢å¼ºä»–ä»¬çš„å“ç‰Œå½¢è±¡ã€è§†é¢‘å†…å®¹ã€æ¸¸æˆä½“éªŒç­‰ã€‚Founder Beatsçš„å®šä»·æ¨¡å¼çµæ´»ï¼Œå®¢æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©é€‚åˆè‡ªå·±çš„ä»·æ ¼å’Œè®¸å¯è¯ã€‚</p>
<h4 id="3manticore-searchhttpsgithubcommanticoresoftwaremanticoresearch">3ã€<a href="https://github.com/manticoresoftware/manticoresearch">Manticore Search</a></h4>
<p>Manticore Searchæ˜¯ä¸€æ¬¾å¼€æºçš„å…¨æ–‡æœç´¢å¼•æ“ï¼Œæ”¯æŒé«˜æ€§èƒ½çš„æœç´¢å’Œåˆ†æã€‚å®ƒæ˜¯Sphinx Searchçš„åç»§è€…ï¼Œä½¿ç”¨äº†ç±»ä¼¼çš„æ¶æ„å’ŒAPIï¼Œå¹¶ä¸”åœ¨åŠŸèƒ½å’Œæ€§èƒ½æ–¹é¢æœ‰å¾ˆå¤šæ”¹è¿›ã€‚Manticore Searchä½¿ç”¨C++ç¼–å†™ï¼Œå…·æœ‰é«˜æ•ˆçš„ç´¢å¼•å’ŒæŸ¥è¯¢å¼•æ“ï¼Œå¯ä»¥å¤„ç†å¤§é‡çš„æ•°æ®å’Œé«˜å¹¶å‘è®¿é—®ã€‚å®ƒæ”¯æŒå¤šç§æ•°æ®æºå’Œæ•°æ®æ ¼å¼ï¼ŒåŒ…æ‹¬MySQLã€PostgreSQLã€XMLã€JSONã€CSVç­‰ã€‚</p>
<p>Manticore Searchæä¾›äº†ä¸°å¯Œçš„æŸ¥è¯¢è¯­è¨€å’ŒAPIï¼ŒåŒ…æ‹¬SQLã€SPHINQLå’ŒHTTP APIç­‰ï¼Œå¯ä»¥æ»¡è¶³ä¸åŒç”¨æˆ·çš„éœ€æ±‚ã€‚å®ƒæ”¯æŒå…¨æ–‡æœç´¢ã€æ¨¡ç³Šæœç´¢ã€çŸ­è¯­æœç´¢ã€è¿‘ä¹‰è¯æœç´¢ã€åœ°ç†ä½ç½®æœç´¢ç­‰å¤šç§æœç´¢æ–¹å¼ï¼Œå¹¶ä¸”æ”¯æŒé«˜çº§è¿‡æ»¤ã€æ’åºã€åˆ†ç»„ã€èšåˆç­‰åŠŸèƒ½ã€‚Manticore Searchè¿˜å…·æœ‰é«˜å¯ç”¨æ€§å’Œå¯æ‰©å±•æ€§ï¼Œæ”¯æŒä¸»ä»å¤åˆ¶ã€åˆ†ç‰‡ã€é›†ç¾¤ç­‰éƒ¨ç½²æ–¹å¼ï¼Œå¯ä»¥æ»¡è¶³ä¸åŒè§„æ¨¡å’Œè´Ÿè½½çš„åº”ç”¨åœºæ™¯ã€‚</p>
<p>Manticore Searchæ˜¯ä¸€æ¬¾ä½¿ç”¨å¹¿æ³›çš„å…¨æ–‡æœç´¢å¼•æ“ï¼Œå®ƒè¢«å¹¿æ³›åº”ç”¨äºç”µå­å•†åŠ¡ã€ç¤¾äº¤ç½‘ç»œã€æ–°é—»åª’ä½“ã€åœ¨çº¿æ•™è‚²ç­‰é¢†åŸŸï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿæ£€ç´¢å’Œå‘ç°æ‰€éœ€ä¿¡æ¯ã€‚Manticore Searchåœ¨GitHubä¸Šå¼€æºï¼Œæ‹¥æœ‰æ´»è·ƒçš„ç¤¾åŒºå’Œå¼€å‘è€…ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡GitHubç¤¾åŒºè·å¾—æ”¯æŒå’Œè´¡çŒ®ä»£ç ã€‚</p>
<h4 id="4unsilencehttpsgithubcomlagmoellertimunsilence">4ã€<a href="https://github.com/lagmoellertim/unsilence">Unsilence</a></h4>
<p>unsilenceæ˜¯ä¸€ä¸ªåŸºäºPythonçš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºæ£€æµ‹å’Œä¿®å¤éŸ³é¢‘æ–‡ä»¶ä¸­çš„é™éŸ³åŒºåŸŸã€‚å®ƒå¯ä»¥å¸®åŠ©ç”¨æˆ·è‡ªåŠ¨æ£€æµ‹å’Œåˆ é™¤éŸ³é¢‘æ–‡ä»¶ä¸­çš„é™éŸ³éƒ¨åˆ†ï¼Œä»è€Œæé«˜éŸ³é¢‘çš„è´¨é‡å’Œå¯å¬æ€§ã€‚unsilenceæ”¯æŒå¤šç§éŸ³é¢‘æ ¼å¼ï¼Œå¦‚MP3ã€WAVã€OGGç­‰ï¼Œå¯ä»¥åœ¨ä¸æŸå¤±éŸ³é¢‘è´¨é‡çš„æƒ…å†µä¸‹åˆ é™¤é™éŸ³ã€‚</p>
<p>ä½¿ç”¨unsilenceéå¸¸ç®€å•ï¼Œç”¨æˆ·åªéœ€åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥unsilenceå‘½ä»¤å’ŒéŸ³é¢‘æ–‡ä»¶åï¼Œunsilenceå°±ä¼šè‡ªåŠ¨æ£€æµ‹å’Œä¿®å¤éŸ³é¢‘æ–‡ä»¶ä¸­çš„é™éŸ³éƒ¨åˆ†ã€‚ç”¨æˆ·ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®å‚æ•°æ¥è°ƒæ•´unsilenceçš„å¤„ç†æ–¹å¼ï¼Œå¦‚è®¾ç½®æœ€å°é™éŸ³é•¿åº¦ã€æœ€å°éŸ³é‡é˜ˆå€¼ç­‰ã€‚</p>
<h4 id="5css-bedhttpswwwcssbedcom">5ã€<a href="https://www.cssbed.com/">CSS Bed</a></h4>
<p>è¿™ä¸ªç½‘é¡µæ”¶é›†å¹¶å±•ç¤ºå„ç§æ— ç±»çš„æç®€åŒ– CSS æ¡†æ¶ã€‚å¦‚æœä½ æƒ³é€‰ä¸€ä¸ªç®€å•çš„ CSS æ¡†æ¶ï¼Œå¯ä»¥çœ‹çœ‹å®ƒ</p>
<h4 id="6lightrunhttpslightruncom">6ã€<a href="https://lightrun.com/">lightrun</a></h4>
<p>lightrun.comæ˜¯ä¸€æ¬¾åŸºäºäº‘çš„å®æ—¶Javaå’ŒKotlinåº”ç”¨ç¨‹åºè°ƒè¯•å’Œè§‚å¯Ÿå·¥å…·ã€‚å®ƒæä¾›äº†ä¸€ç§æ— éœ€ä¿®æ”¹ä»£ç å³å¯å®æ—¶è°ƒè¯•Javaå’ŒKotlinåº”ç”¨ç¨‹åºçš„æ–¹å¼ï¼Œå‡å°‘äº†å¼€å‘äººå‘˜çš„è°ƒè¯•æ—¶é—´ï¼Œæé«˜äº†åº”ç”¨ç¨‹åºçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚lightrun.comè¿˜æä¾›äº†å®æ—¶æ—¥å¿—æŸ¥çœ‹å’Œåˆ†æï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜å¿«é€Ÿå®šä½é—®é¢˜å’Œè§£å†³é—®é¢˜ï¼Œæé«˜äº†åº”ç”¨ç¨‹åºçš„å¯ç»´æŠ¤æ€§ã€‚</p>
<p>lightrun.comå¯ä»¥ä¸å¸¸è§çš„Javaå¼€å‘å·¥å…·é›†æˆï¼Œå¦‚Eclipseã€IntelliJ IDEAå’ŒVS Codeã€‚å®ƒè¿˜æ”¯æŒå¤šç§æ“ä½œç³»ç»Ÿå’Œäº‘å¹³å°ï¼Œå¦‚Windowsã€Linuxã€Dockerã€AWSå’ŒAzureç­‰ã€‚å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨lightrun.comæ¥è°ƒè¯•å’Œç›‘è§†æœ¬åœ°åº”ç”¨ç¨‹åºï¼Œä¹Ÿå¯ä»¥åœ¨äº‘ç«¯å¿«é€Ÿè¯Šæ–­ç”Ÿäº§ç¯å¢ƒä¸­çš„é—®é¢˜ã€‚</p>
<p>lightrun.comé‡‡ç”¨äº†å®‰å…¨çš„äº‘æ¶æ„ï¼Œå¹¶ä¸”ä½¿ç”¨äº†ç«¯åˆ°ç«¯åŠ å¯†æ¥ä¿æŠ¤ç”¨æˆ·æ•°æ®çš„å®‰å…¨æ€§ã€‚å®ƒè¿˜æä¾›äº†çµæ´»çš„è®¡è´¹æ¨¡å¼ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©é€‚åˆè‡ªå·±çš„è®¡è´¹æ–¹å¼ã€‚</p>
<h4 id="7httpsgithubcomappscr-gpt">7ã€https://github.com/apps/cr-gpt</h4>
<p>åŸºäº ChatGPT çš„ Github Code Review æœºå™¨äºº</p>
<h4 id="8å¦™è®°å¤š-mojidoc-httpsmojidoccom">8ã€<a href="https://mojidoc.com/">å¦™è®°å¤š Mojidoc </a></h4>
<p>æ–°ä¸€ä»£ç”Ÿäº§ååŒå·¥å…·</p>
<p>ä»¥ä¸Šã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>å‘¨æŠ¥-8ï½œå†…å­˜æ³„æ¼ã€å…¬å¸è£å‘˜ã€ç»ƒè½¦</title>
      <link>https://blog.chensoul.com/posts/2023/02/27/weekly_review_8/</link>
      <pubDate>Mon, 27 Feb 2023 08:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/02/27/weekly_review_8/</guid>
      <description>å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-02-20 åˆ° 2023-02-26 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚ è¿™ç¯‡å‘¨æŠ¥åˆæ˜¯åœ¨åœ°é“ä¸Šå®Œæˆç¼–å†™çš„ã€‚å›é¡¾è¿™ä¸€å‘¨çš„å·¥ä½œ</description>
      <content:encoded><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p>æœ¬ç¯‡æ˜¯å¯¹ <code>2023-02-20</code> åˆ° <code>2023-02-26</code> è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº <a href="https://blog.chensoul.com/">åšå®¢</a>ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚</p>
<p>è¿™ç¯‡å‘¨æŠ¥åˆæ˜¯åœ¨åœ°é“ä¸Šå®Œæˆç¼–å†™çš„ã€‚å›é¡¾è¿™ä¸€å‘¨çš„å·¥ä½œï¼Œè¿˜æ˜¯é¡¹ç›®æµ‹è¯•ã€ä¿®å¤ bug å’Œå‡†å¤‡ä¸Šçº¿å‘å¸ƒã€‚å¹³é™çš„å·¥ä½œèŠ‚å¥å› ä¸ºçªå¦‚å…¶æ¥çš„è£å‘˜æ¶ˆæ¯è€Œå˜å¾—å†…å·èµ·æ¥ï¼Œå¤§å®¶ä¸‹ç­çš„æ—¶é—´éƒ½çº·çº·å¾€åç§»åˆ°äº†20 ç‚¹å·¦å³ã€‚å‘¨æœ«çš„æ—¶å€™ï¼Œè¿˜æ˜¯ç»ƒè½¦ï¼Œä»æ±‰å£å¼€è½¦åˆ°æ–°æ´²ã€‚åˆšå¼€å§‹æœ‰ç‚¹ä¸æ•¢ï¼Œåæ¥è¿˜æ˜¯é¼“èµ·å‹‡æ°”ï¼Œå¹³å®‰çš„åˆ°è¾¾ã€‚</p>
<h2 id="å·¥ä½œ">å·¥ä½œ</h2>
<h3 id="å†…å­˜æ³„æ¼">å†…å­˜æ³„æ¼</h3>
<p>è¿™å‘¨çº¿ä¸Šç¯å¢ƒï¼Œå‡ºç°äº†å‘Šè­¦ï¼Œæç¤º jvm å‡ºç°äº† full gcã€‚äºæ˜¯èµ¶ç´§ dump å†…å­˜è¿›è¡Œåˆ†ææŸ¥æ‰¾åŸå› ã€‚é¡ºä¾¿æ•´ç†äº†å†…å­˜ç›¸å…³çš„çŸ¥è¯†ã€‚</p>
<p><strong>ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼ï¼Ÿ</strong></p>
<p>è¿™ä¸ªé—®é¢˜ç›´æ¥é—® chatgptï¼š</p>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-08-01.png" alt="weekly-review-08-01"  />
</p>
<p>å†…å­˜æ³„æ¼ï¼ˆMemory Leakï¼‰æ˜¯æŒ‡åœ¨ç¨‹åºä¸­åŠ¨æ€åˆ†é…çš„å†…å­˜ç”±äºæŸäº›åŸå› ç¨‹åºæœªèƒ½é‡Šæ”¾æˆ–æ— æ³•é‡Šæ”¾ï¼Œå¯¼è‡´ç³»ç»Ÿå†…å­˜çš„å®é™…å¯ç”¨ç©ºé—´ä¸æ–­å‡å°‘çš„ç°è±¡ã€‚å†…å­˜æ³„æ¼çš„å‘ç”Ÿä¼šå¯¼è‡´ç¨‹åºå ç”¨çš„å†…å­˜è¶Šæ¥è¶Šå¤šï¼Œæœ€ç»ˆå¯¼è‡´ç¨‹åºå´©æºƒæˆ–ç³»ç»Ÿå˜æ…¢ã€‚</p>
<p>åœ¨Javaä¸­ï¼Œç¨‹åºå‘˜é€šå¸¸ä½¿ç”¨newè¿ç®—ç¬¦åœ¨å †ä¸Šåˆ†é…å†…å­˜ï¼Œè¿™äº›å†…å­˜ä¸å†ä½¿ç”¨æ—¶å¿…é¡»é‡Šæ”¾ï¼Œå¦åˆ™å°±ä¼šå‡ºç°å†…å­˜æ³„æ¼ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„Javaå†…å­˜æ³„æ¼çš„æƒ…å†µï¼š</p>
<ol>
<li>å¯¹è±¡æŒæœ‰è¿‡å¤šçš„å¼•ç”¨</li>
</ol>
<p>å½“ä¸€ä¸ªå¯¹è±¡æŒæœ‰å…¶ä»–å¯¹è±¡çš„å¼•ç”¨æ—¶ï¼Œè¿™äº›å¯¹è±¡å°±ä¸èƒ½è¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªé™æ€é›†åˆï¼ˆå¦‚Mapã€Listï¼‰æŒæœ‰äº†å¤§é‡å¯¹è±¡çš„å¼•ç”¨ï¼Œä½†æ˜¯è¿™äº›å¯¹è±¡å·²ç»ä¸å†éœ€è¦äº†ï¼Œå´å› ä¸ºé›†åˆä¸­ä»ç„¶æŒæœ‰è¿™äº›å¯¹è±¡çš„å¼•ç”¨ï¼Œå¯¼è‡´è¿™äº›å¯¹è±¡æ— æ³•è¢«å›æ”¶ï¼Œé€ æˆå†…å­˜æ³„æ¼ã€‚</p>
<ol start="2">
<li>é•¿æ—¶é—´æŒæœ‰å¯¹è±¡é”</li>
</ol>
<p>åœ¨Javaä¸­ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹è·å–äº†ä¸€ä¸ªå¯¹è±¡çš„é”ï¼Œä½†æ˜¯åœ¨é‡Šæ”¾é”ä¹‹å‰å‘ç”Ÿäº†å¼‚å¸¸ï¼Œé‚£ä¹ˆè¿™ä¸ªé”å°±ä¸ä¼šè¢«é‡Šæ”¾ï¼Œä»è€Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚è¿™ç§æƒ…å†µç‰¹åˆ«å®¹æ˜“å‘ç”Ÿåœ¨synchronizedå—ä¸­ã€‚</p>
<ol start="3">
<li>ä¸æ­£ç¡®çš„ç¼“å­˜ä½¿ç”¨</li>
</ol>
<p>å¦‚æœç¨‹åºå‘˜ä¸æ­£ç¡®åœ°ä½¿ç”¨ç¼“å­˜ï¼Œå°±ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚æ¯”å¦‚ï¼Œå¦‚æœä½¿ç”¨ä¸€ä¸ªé™æ€Mapæ¥ç¼“å­˜å¯¹è±¡ï¼Œä½†æ˜¯ä¸ä»Mapä¸­åˆ é™¤å¯¹è±¡ï¼Œé‚£ä¹ˆè¿™äº›å¯¹è±¡å°±ä¼šä¸€ç›´å­˜åœ¨äºå†…å­˜ä¸­ï¼Œé€ æˆå†…å­˜æ³„æ¼ã€‚</p>
<ol start="4">
<li>å¤§é‡åˆ›å»ºä¸´æ—¶å¯¹è±¡</li>
</ol>
<p>å¦‚æœç¨‹åºé¢‘ç¹åœ°åˆ›å»ºä¸´æ—¶å¯¹è±¡ï¼Œè€Œè¿™äº›å¯¹è±¡åˆæ²¡æœ‰è¢«åŠæ—¶æ¸…é™¤ï¼Œå°±ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚æ¯”å¦‚ï¼Œåœ¨å¾ªç¯ä¸­åˆ›å»ºå¤§é‡çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œä½†æ˜¯æ²¡æœ‰åŠæ—¶æ¸…é™¤ï¼Œå°±ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚</p>
<p>ä¸ºäº†é¿å…å†…å­˜æ³„æ¼ï¼ŒJavaç¨‹åºå‘˜å¯ä»¥ä½¿ç”¨ä¸€äº›æŠ€æœ¯æ¥ä¼˜åŒ–ç¨‹åºï¼Œæ¯”å¦‚ä½¿ç”¨ç¼“å­˜æ± ã€é¿å…ä½¿ç”¨ä¸å¿…è¦çš„é™æ€å˜é‡ã€ä½¿ç”¨finalize()æ–¹æ³•é‡Šæ”¾èµ„æºç­‰ç­‰ã€‚</p>
<p><strong>å¦‚ä½•æ’æŸ¥å†…å­˜æ³„æ¼ï¼Ÿ</strong></p>
<ul>
<li>
<p>å†…å­˜åˆ†æå·¥å…·ï¼šå†…å­˜åˆ†æå·¥å…·å¯ä»¥å¸®åŠ©æ‚¨æ‰¾åˆ°å“ªäº›å¯¹è±¡å ç”¨äº†å¤§é‡çš„å†…å­˜ã€‚ä¸€äº›å¸¸ç”¨çš„å†…å­˜åˆ†æå·¥å…·åŒ…æ‹¬ï¼šEclipse MATã€VisualVM å’Œ YourKitã€‚è¿™äº›å·¥å…·å¯ä»¥å¸®åŠ©æ‚¨åˆ†æå†…å­˜å¿«ç…§ã€æŸ¥æ‰¾å†…å­˜æ³„æ¼å¹¶ç¡®å®šå¯¼è‡´å†…å­˜æ³„æ¼çš„ä»£ç ä½ç½®ã€‚</p>
</li>
<li>
<p>å †è½¬å‚¨æ–‡ä»¶ï¼šå †è½¬å‚¨æ–‡ä»¶æ˜¯ä¸€ä¸ªåŒ…å«äº† JVM å †ä¸­æ‰€æœ‰å¯¹è±¡çš„å¿«ç…§ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç”Ÿæˆä¸€ä¸ªå †è½¬å‚¨æ–‡ä»¶ï¼šjmap -dump:format=b,file=heap.bin <PID>ï¼Œå…¶ä¸­<PID>æ˜¯æ‚¨çš„ Java åº”ç”¨ç¨‹åºçš„è¿›ç¨‹ IDã€‚ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å†…å­˜åˆ†æå·¥å…·æ¥åˆ†æè¯¥æ–‡ä»¶ã€‚</p>
</li>
<li>
<p>ä»£ç å®¡æŸ¥ï¼šåœ¨ç¼–å†™ä»£ç æ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸€äº›æŠ€å·§æ¥é¿å…å†…å­˜æ³„æ¼ã€‚ä¾‹å¦‚ï¼Œæ‚¨åº”è¯¥ç¡®ä¿æ­£ç¡®åœ°å…³é—­æµå’Œæ•°æ®åº“è¿æ¥ï¼Œé¿å…åœ¨å¾ªç¯ä¸­åˆ›å»ºå¯¹è±¡ï¼Œä»¥åŠä½¿ç”¨è½¯å¼•ç”¨æˆ–å¼±å¼•ç”¨æ¥å­˜å‚¨ç¼“å­˜æ•°æ®ç­‰ã€‚é€šè¿‡ä»”ç»†å®¡æŸ¥ä»£ç å¹¶è¯†åˆ«å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼çš„éƒ¨åˆ†ï¼Œå¯ä»¥é¿å…è¿™äº›é—®é¢˜åœ¨è¿è¡Œæ—¶å‘ç”Ÿã€‚</p>
</li>
<li>
<p>ç›‘è§†å·¥å…·ï¼šJVM æä¾›äº†ä¸€äº›ç›‘è§†å·¥å…·ï¼Œä¾‹å¦‚ jstat å’Œ jconsoleï¼Œå¯ä»¥ç”¨äºç›‘è§† JVM çš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚é€šè¿‡ç›‘è§†è¿™äº›æŒ‡æ ‡ï¼Œæ‚¨å¯ä»¥è¯†åˆ«æ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼çš„è¿¹è±¡ã€‚</p>
</li>
<li>
<p>ä»£ç æ³¨å…¥ï¼šåœ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¸­ï¼Œæ‚¨å¯ä»¥æ³¨å…¥ä¸€äº›ä»£ç ï¼Œä¾‹å¦‚ä½¿ç”¨ JMXã€AOP ç­‰ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥å®æ—¶ç›‘è§†å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå¹¶è®°å½•ä»»ä½•å†…å­˜æ³„æ¼è¿¹è±¡ã€‚</p>
</li>
</ul>
<p>å‚è€ƒæ–‡ç« </p>
<ul>
<li>
<p><a href="https://www.cnblogs.com/rude3knife/p/13570423.html">ä¸€æ¬¡å®Œæ•´çš„JVMå †å¤–å†…å­˜æ³„æ¼æ•…éšœæ’æŸ¥è®°å½•</a></p>
</li>
<li>
<p><a href="https://droidyue.com/blog/2015/11/28/article-java-8-lambdas-a-peek-under-the-hood">æ·±å…¥æ¢ç´¢Java 8 Lambdaè¡¨è¾¾å¼</a></p>
</li>
<li>
<p><a href="https://blog.csdn.net/weixin_34722015/article/details/114815917">java lambdaè¡¨è¾¾å¼å†…å­˜æ³„éœ²_æµ…è°ˆJavaå†…å­˜æ³„éœ²</a></p>
</li>
</ul>
<h3 id="è£å‘˜">è£å‘˜</h3>
<p>å»å¹´å…¬å¸å°±åœ¨è£å‘˜ï¼Œé™†é™†ç»­ç»­è£äº†å‡ æ¬¡ï¼Œæ¯æ¬¡éƒ½æ˜¯è£ä¸¤ä¸‰ä¸ªï¼ŒåŠ¨ä½œéƒ½ä¸å¤§ï¼Œä½†æ˜¯å¾ˆé«˜æ•ˆã€‚å› ä¸ºéƒ¨é—¨äººæ•°å°±åœ¨äº”åå·¦å³ï¼Œæ‰€ä»¥è°æ²¡æ¥ä¸Šç­ï¼Œéƒ½èƒ½å¾ˆå¿«å¯Ÿè§‰ã€‚</p>
<p>å…¬å¸è¦åœ¨å…­æœˆä»½ä¸Šå¸‚ï¼Œä¸Šå¸‚ä¹‹å‰è¦ä½¿è´¢æŠ¥å¥½çœ‹ï¼Œå°±è¦å¼€æºèŠ‚æµã€é™æœ¬å¢æ•ˆã€‚èŠ‚çº¦æˆæœ¬çš„ä¸€ä¸ªæ–¹å¼å°±æ˜¯è£å‘˜ï¼Œæ®è¯´è¿™æ¬¡è£å‘˜åŠ¨ä½œæ¯”ä»¥å‰éƒ½å¤§éƒ½è¿…é€Ÿï¼Œä»Šå¤©æå‡ºè£å‘˜äººæ•°ï¼Œæ˜å¤©å°±è¦ç»™å‡ºåå•ï¼Œæœˆåº•å°±è¦èµ°äººã€‚</p>
<p>ç°åœ¨è¿˜åªæ˜¯äºŒæœˆä»½ï¼Œç¦»å…­æœˆè¿˜æœ‰ä¸‰ä¸ªæœˆã€‚è°ä¹Ÿä¸çŸ¥é“ï¼Œåé¢è¿˜ä¼šæœ‰ä»€ä¹ˆæ›´å¤§çš„è£å‘˜åŠ¨ä½œã€‚è¯´ä¸å®šå“ªå¤©å°±ç©ºå‡ºä¸€ä¸ªå·¥ä½ï¼Œè¯´ä¸å®šå“ªå¤©é¢†å¯¼å°±æ¢äº†äººï¼Œè¯´ä¸å®šå“ªå¤©éƒ¨é—¨å°±è¢«æ‹†æ•£äº†ã€‚</p>
<p>äº’è”ç½‘å…¬å¸æœ€å¤§çš„å˜åŒ–å°±æ˜¯å˜åŒ–ã€‚ä¹‹å‰åœ¨é˜¿é‡Œå·¥ä½œï¼Œå…¬å¸çš„ä»·å€¼è§‚é‡Œæœ‰ä¸€æ¡å°±æ˜¯æ‹¥æŠ±å˜åŒ–ã€‚</p>
<p>æ‹¥æŠ±å˜åŒ–çš„æœ€å¥½æ–¹å¼å°±æ˜¯ç§¯æé¢å¯¹ï¼Œä¸»åŠ¨åŠ ç­ï¼Œæé«˜å·¥ä½œæ•ˆç‡ï¼Œå¢åŠ å·¥ä½œäº§å‡ºã€‚</p>
<h2 id="ç”Ÿæ´»">ç”Ÿæ´»</h2>
<h3 id="ç»ƒè½¦">ç»ƒè½¦</h3>
<p>è¿™æ˜¯ä¹°è½¦ä¹‹åçš„ç¬¬äºŒå‘¨ï¼Œè¿˜æ˜¯æ²¡æœ‰å¼€è½¦å»ä¸Šç­ã€‚ä¸€æ˜¯å› ä¸ºå¼€è½¦ä¸è¿‡ç†Ÿç»ƒï¼Œèƒ†å­å°ï¼Œä¸æ•¢å¼€å¾—å¤ªå¿«ï¼›äºŒæ˜¯å…¬å¸æ¥¼ä¸‹çš„åœè½¦ä½è¿˜æ²¡æœ‰åŠå¥½ã€‚</p>
<p>å‘¨å…­æœ¬æƒ³å«æœ‹å‹è¿‡æ¥ç»™æˆ‘å½“é™ªç»ƒï¼Œåæ¥å› ä¸ºè¦å›æ–°æ´²ï¼Œå°±ç®—äº†ï¼Œè¿˜æ˜¯è‡ªå·±å¼€è½¦ï¼Œå¸¦ç€è€å©†å›æ–°æ´²ã€‚</p>
<p>è€å©†ç§‘ç›®ä¸€è€ƒè¿‡äº†ï¼Œåé¢å› ä¸ºå·¥ä½œåŸå› å°±æ²¡å»ç»ƒè½¦å’Œè€ƒè¯•ã€‚å¥¹åå‰¯é©¾é©¶ï¼Œä¸€è¾¹å‰¥è±†å­ä¸€è¾¹æé†’æˆ‘æ³¨æ„äº¤é€šè§„åˆ™ã€‚</p>
<p>åœ¨è€å©†çš„åé•‡ä¹‹ä¸‹ï¼Œé¡ºåˆ©çš„ä»æ±‰å£å¼€è½¦å…­åå…¬é‡Œåˆ°è¾¾æ–°æ´²ï¼Œè·¯ä¸Šæ²¡æœ‰è¿åäº¤é€šè§„åˆ™ã€‚</p>
<p>å‘¨å…­ä¸‹åˆå»çœ‹äº†ä¸€ä¸‹æ½˜å¡˜èŠ±æœèŠ‚ï¼Œæœ‰ç‚¹å¤±æœ›ï¼Œæ²¡æœ‰æƒ³è±¡ä¸­çš„çƒ­é—¹ã€‚å¯èƒ½å› ä¸ºè¿™ä¸æ˜¯æ­£å®—çš„èŠ±æœèŠ‚ï¼Œæ­£å®—çš„åº”è¯¥æ˜¯åœ¨æ—§è¡—ã€‚</p>
<p>é€›äº†ä¸€åœˆï¼Œä¹°äº†ä¸¤ç™¾èœåˆ€ã€ä¸€ä¸ªç §æ¿ã€ä¸¤é¢—æœæ ‘ã€ä¸€ç›†å¢¨å…°èŠ±ã€‚</p>
<p>å‘¨å…­ä»æ–°æ´²å¼€å›é˜³é€»ï¼Œå‘¨æ—¥åˆä»é˜³é€»å¼€å›è€å®¶å»çœ‹çˆ¶äº²ã€‚ä¹°è½¦åç¬¬ä¸€æ¬¡å›å®¶ï¼Œæ”¾äº†é­ç‚®ğŸ§¨ã€‚</p>
<p>ä¸­åˆåŒ…é¥ºå­ï¼Œåƒå®Œé¥­å°±å»èœå›­æ”¶å‰²é’èœã€‚å†œæ‘å¯¹äºåŸå¸‚é‡Œä¸Šç­æ—æ¥è¯´ï¼Œä¸€å¤§å¥½å¤„æ˜¯ï¼Œæ¯æ¬¡å›å®¶ï¼Œéƒ½å¯ä»¥è£…æ»¡é’èœå¸¦å›åŸå¸‚ã€‚</p>
<p>ä¸‹åˆï¼Œä»è€å®¶é©±è½¦å›é˜³é€»å†åˆ°æ±‰å£ã€‚åœ¨å¼€è½¦çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°å’Œæ€»ç»“äº†ä¸€äº›é—®é¢˜ã€‚</p>
<p>ä¹‹å‰å¼€è½¦ï¼Œæ€»æ˜¯ç›¯ç€ä»ªè¡¨ç›˜ï¼Œçœ‹è½¦é€Ÿè¾¾åˆ°äº†å¤šå°‘ã€‚è½¦é€Ÿä¸€åˆ° 70 å¤šå°±ä¸‹æ„è¯†åœ°æ¾æ²¹é—¨å’Œè¸©åˆ¹è½¦ã€‚ç°åœ¨å¼€å§‹æŠŠçœ¼ç›æ³¨æ„åŠ›æ”¾åˆ°å‰æ–¹ï¼Œä¸å»å¯ä»¥åœ¨æ„è½¦é€Ÿï¼Œåªæ˜¯å½“å¯¼èˆªæç¤ºæˆ‘è¶…é€Ÿçš„æ—¶å€™ï¼Œæˆ‘ç™½é™ä½ä¸€ç‚¹é€Ÿåº¦ã€‚</p>
<p>åœ¨çº¢ç»¿ç¯ä¹‹å‰ï¼Œå¦‚æœä¸è½¬å¼¯ï¼Œä¸è¦æå‰æ¢é“æˆ–è€…è¶…è½¦ï¼Œä¿æŒä¸­é—´é“è·¯è¡Œé©¶å³å¯ã€‚</p>
<h2 id="å¥½ç‰©åˆ†äº«">å¥½ç‰©åˆ†äº«</h2>
<p>è™½ç„¶å¤§éƒ¨åˆ†æœ‰æ„æ€çš„å†…å®¹ä¼šåˆ†äº«åœ¨ ã€<a href="https://t.me/chensoul_share">ChenSoul Share</a>ã€Telegram é¢‘é“ï¼Œä¸è¿‡è¿˜æ˜¯æŒ‘é€‰ä¸€éƒ¨åˆ†åœ¨è¿™é‡Œåˆ—ä¸¾ä¸€ä¸‹ï¼Œæ„Ÿè§‰æ›´åƒä¸€ä¸ª newsletter äº†ã€‚</p>
<h3 id="ä¸€äº›æ–‡ç« ">ä¸€äº›æ–‡ç« </h3>
<ul>
<li>
<p><a href="https://blog.baoshuo.ren/post/actions-ssl-cert/">ä½¿ç”¨ GitHub Actions è‡ªåŠ¨ç”³è¯·ä¸éƒ¨ç½² SSL è¯ä¹¦</a></p>
</li>
<li>
<p><a href="https://phind.com/">The AI search engine for developers</a></p>
</li>
<li>
<p><a href="https://magickpen.com/">ç”¨ AI å†™æ–‡ç« </a></p>
</li>
<li>
<p><a href="https://blog.csdn.net/weixin_34722015/article/details/114815917">java lambdaè¡¨è¾¾å¼å†…å­˜æ³„éœ²_æµ…è°ˆJavaå†…å­˜æ³„éœ²</a></p>
</li>
<li>
<p><a href="https://kenengba.com/post/3769.html">åœ¨å®¶èººç€æ‹¿å·¥èµ„ï¼Œæ˜¯æŒºè¿‡æ„ä¸å»çš„</a></p>
</li>
<li>
<p><a href="https://blog.mikeoperfect.com/posts/11517/">è½¦è¾†è¿ç« å’Œäº¤é€šäº‹æ•…å¤„ç†æµç¨‹</a></p>
</li>
<li>
<p><a href="https://blog.alswl.com/2020/03/before-code-review/">æµ…è°ˆ Code Review ä¹‹äº‹å‰å‡†å¤‡</a></p>
</li>
</ul>
<h3 id="ä¸€äº›å·¥å…·">ä¸€äº›å·¥å…·</h3>
<h4 id="1raycasthttpswwwraycastcom">1ã€<a href="https://www.raycast.com/">Raycast</a></h4>
<p>Raycastæ˜¯ä¸€æ¬¾æƒ³è¦å–ä»£ Spotlight çš„å¿«æ·å¯åŠ¨å™¨ï¼Œé€šè¿‡ Mac ä¸Šé¢çš„ä¸€äº›ç»„åˆé”®æ¥ä¸ºè®©ä½ å®Œæˆåœ¨ Mac ä¸Šé¢çš„å¿«æ·å¯åŠ¨ï¼Œæé«˜ä½ æ—¥å¸¸å½“ä¸­åœ¨ Mac ä¸Šé¢çš„æ“ä½œæ•ˆç‡ï¼Œå¦‚æœä»¥ macOS ç³»ç»Ÿç‰ˆæœ¬é£æ ¼æ¥æ¯”å–»çš„è¯ï¼ŒAlfred çš„ UI é£æ ¼åº”è¯¥èƒ½åŒ¹é…å‡ å¹´å‰çš„ macOS å§ï¼Œè€Œ Raycast å´æ˜¯èƒ½å¤Ÿé©¾é©­ macOS Big Sur å…¨æ–°çš„è§†è§‰é£æ ¼ã€‚</p>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-08-02.png" alt="weekly-review-08-02"  />
</p>
<p>ä»¥ä¸Šã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>å‘¨æŠ¥-7ï½œç»ƒè½¦ã€åšå®¢ä¼˜åŒ–ã€æ³¨å†ŒChatGPTè´¦å·</title>
      <link>https://blog.chensoul.com/posts/2023/02/21/weekly_review_7/</link>
      <pubDate>Tue, 21 Feb 2023 00:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/02/21/weekly_review_7/</guid>
      <description>å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-02-13 åˆ° 2023-02-19 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚ ç»ƒè½¦ è¿™å‘¨æœ«å¼€å§‹ç»ƒè½¦ï¼Œå‘¨å…­æ˜¯ç¬¬ä¸€æ¬¡å¼€è‡ªå·±çš„è½¦ï¼Œç®€å•</description>
      <content:encoded><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p>æœ¬ç¯‡æ˜¯å¯¹ <code>2023-02-13</code> åˆ° <code>2023-02-19</code> è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº <a href="https://blog.chensoul.com/">åšå®¢</a>ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚</p>
<h2 id="ç»ƒè½¦">ç»ƒè½¦</h2>
<p>è¿™å‘¨æœ«å¼€å§‹ç»ƒè½¦ï¼Œå‘¨å…­æ˜¯ç¬¬ä¸€æ¬¡å¼€è‡ªå·±çš„è½¦ï¼Œç®€å•è¯•é©¾äº†ä¸€æ ·ï¼›å‘¨æ—¥åˆ™å¼€äº†ä¸€ç™¾å¤šå…¬é‡Œï¼Œå…·ä½“è¡Œç¨‹æ˜¯ä»é˜³é€»åˆ°æ–°æ´²ï¼Œä»æ–°æ´²å•æ±‰å£ï¼Œä»æ±‰å£åˆ°å…‰è°·ï¼Œä»å…‰è°·å›æ±‰å£ã€‚</p>
<p>è¿™é€”ä¸­èµ°äº†æ±ŸåŒ—å¿«é€Ÿå…¬è·¯ã€äºŒç¯ã€äºŒä¸ƒé•¿æ±Ÿå¤§æ¡¥ã€ä¸œæ¹–éš§é“ï¼Œä»ç™½å¤©å¼€åˆ°æ™šä¸Šå¤œè¡Œï¼Œç»å†è¿‡å µè½¦ï¼Œè·¯ä¸Šçœ‹åˆ°è½¦ç¥¸åçš„äº‹æ•…ç°åœºã€‚</p>
<p>ä¸€å¤©ä¸‹æ¥ï¼Œæ€»å…±å¼€è½¦æœ‰äº”ä¸ªå¤šå°æ—¶ï¼Œæ„Ÿè§‰å¼€è½¦å¥½ç´¯ã€‚ä½œä¸ºæ–°æ‰‹ï¼Œå¼€è½¦çš„è¿‡ç¨‹ä¸­è¦å…¨ç¥è´¯æ³¨ï¼Œé“­è®°å¼€è½¦æœ€é‡è¦çš„æ˜¯æ…¢è¿™ä¸€åŸåˆ™ï¼Œé€Ÿåº¦ä¸æ•¢è¿‡å¿«ã€‚</p>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-07-06.webp" alt="weekly-review-06"  />
</p>
<p>å›é¡¾è¿™ä¸€å¤©çš„ç»ƒè½¦è¿‡ç¨‹ï¼Œå‘ç°è‡ªå·±å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ul>
<li>
<p>å¯¹æ±½è½¦ä¸ç†Ÿæ‚‰ï¼Œä¸æ¸…æ¥šè½¦å†…æ¯ä¸ªæŒ‰é’®æœ‰ä»€ä¹ˆä½œç”¨ã€‚</p>
</li>
<li>
<p>ä¸æ•¢å¼€çš„å¤ªå¿«ï¼Œæ²¹é—¨è¸©åˆ°å…­åå…¬é‡Œä¹‹åï¼Œå°±ä¸‹æ„è¯†åœ°æ¾æ²¹é—¨ã€‚æ•´ä¸ªè¡Œé©¶è¿‡ç¨‹ä¸­ï¼Œå¹³å‡è½¦é€Ÿå¤§æ¦‚åœ¨äºŒåå¤šå…¬é‡Œæ¯å°æ—¶ã€‚</p>
</li>
<li>
<p>å¯¹äº¤è§„ä¸ç†Ÿæ‚‰ï¼Œç¬¬ä¸€æ¬¡ç”¨é«˜å¾·åœ°å›¾ï¼Œä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™æ”¹è¯¥å˜é“ã€ä»€ä¹ˆæ—¶å€™è¯¥èµ°ä¸­é—´é“è·¯ã€‚è¦å˜é“æ—¶å€™ï¼Œä¸å¤Ÿæœæ•¢ï¼Œæ‰“äº†ç¯å…‰ä¹‹åï¼Œæ²¡æœ‰å¿«é€Ÿå˜é“ï¼Œç”šè‡³è¿˜é™é€Ÿï¼Œç­‰åé¢è½¦å­ï¼Œè€Œåé¢è½¦å­ä¹Ÿåœ¨ç­‰æˆ‘ã€‚</p>
</li>
<li>
<p>å¯¹è½¦è·ä¸æ•æ„Ÿã€‚è¡Œé©¶è¿‡ç¨‹ä¸­ï¼Œå’Œå·¦å³è½¦è¾†ç›¸éš”è·ç¦»å¤šè¿‘ï¼Œæ²¡æœ‰ä¸€ä¸ªç›´è§‚çš„æ„Ÿå—ã€‚è§‚å¯Ÿåè§†é•œï¼Œåé¢è½¦è·å¤šè¿œï¼Œæœ‰æ—¶å€™ä¹Ÿåˆ¤æ–­ä¸å‡†ï¼Œå¯¼è‡´è‡ªå·±å˜é“çŠ¹è±«ä¸å†³ï¼Œé™©äº›æ“¦ç¢°ã€‚</p>
</li>
<li>
<p>å˜é“ã€è½¬å¼¯ï¼Œæœ‰æ—¶å€™å¿˜è®°æ‰“ç¯ã€‚è½¬å¼¯æ—¶å€™ï¼Œæ–¹å‘ç›˜åŠ¨å¾—å¤ªæ—©ï¼Œæ²¡æœ‰ç­‰è½¦è¿‡æ–‘é©¬çº¿å†æ‰“æ–¹å‘ç›˜ã€‚å·¦è½¬å¼¯æ—¶å€™ï¼Œæ²¡æœ‰è½¬å¤§å¼¯ï¼Œå¯¼è‡´è½¦å­æœ‰ä¸€æ¬¡æ“¦åˆ°äº†å·¦è¾¹çš„çŸ³å¢©å­ï¼Œå¹¸å¥½ä¸æ˜¯å¾ˆä¸¥é‡ã€‚</p>
</li>
<li>
<p>å€’è½¦å’Œä¾§æ–¹åœè½¦ä¸å¤Ÿç†Ÿç»ƒã€‚</p>
</li>
<li>
<p>å¯¹ä¸Šç­è·¯çº¿ä¸ç†Ÿæ‚‰ï¼Œä¸çŸ¥é“æ€ä¹ˆè¿›å…¥å…¬å¸æ¥¼ä¸‹åœè½¦åœºã€‚</p>
</li>
</ul>
<p>åŸºäºä»¥ä¸Šè¡¨ç°ï¼Œæ¥ä¸‹æ¥ä¸€å‘¨è¿˜æ˜¯ååœ°é“ä¸Šç­ã€‚ç›®å‰æ¥è¯´è¿˜æ˜¯æ›´å–œæ¬¢ååœ°é“ä¸Šç­ï¼Œå¯ä»¥çœ‹è§†é¢‘å¬éŸ³é¢‘ï¼Œå¯ä»¥æŸ¥çœ‹ RSS   è®¢é˜…æ–‡ç« ï¼Œå¯ä»¥å†™å‘¨æŠ¥ï¼Œå¯ä»¥é—­ç›®å…»ç¥ã€‚</p>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-07-07.png" alt="weekly-review-07"  />
</p>
<p>è€å©†ç»™æˆ‘ä¹°çš„å®ä¹ æœŸè´´ç‰Œåˆ°äº†ï¼Œåé¢å¸æœºçœ‹åˆ°è¿™ä¹ˆå¯çˆ±çš„ç‰Œå­ï¼Œä¼°è®¡ä»¥ä¸ºæ˜¯ä¸ªå¦¹å­åœ¨å¼€è½¦å§ï¼Œåº”è¯¥ä¼šå–‡å­ä¸‹ç•™æƒ…äº†å§ğŸ˜„ã€‚</p>
<p>æ¥ä¸‹æ¥çš„å‘¨æœ«ï¼Œè¿˜è¦ç»§ç»­ç»ƒè½¦ï¼Œå’Œè½¦å­åŸ¹å…»æ„Ÿæƒ…ï¼Œä»å†…åˆ°å¤–ç†Ÿæ‚‰è½¦å­ï¼Œç†Ÿæ‚‰ä¸Šç­è·¯çº¿å’Œäº¤é€šè§„åˆ™ï¼Œæé«˜è¡Œé©¶é€Ÿåº¦ã€‚åŠ æ²¹ğŸ’ªğŸ»ï¼</p>
<h2 id="åšå®¢ä¼˜åŒ–">åšå®¢ä¼˜åŒ–</h2>
<p>è¿™å‘¨é‡æ–°å¯¹åšå®¢è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<h3 id="1ä¼˜åŒ–é¡µé¢åŠ è½½é€Ÿåº¦">1ã€ä¼˜åŒ–é¡µé¢åŠ è½½é€Ÿåº¦</h3>
<p>æ¯æ¬¡æ‰“å¼€åšå®¢é¦–é¡µï¼Œæ„Ÿè§‰é¡µé¢åŠ è½½æœ‰ç‚¹æ…¢ï¼Œæ•…æƒ³åŠ å¿«åšå®¢æ‰“å¼€é€Ÿåº¦ï¼Œç¬¬ä¸€ä¸ªæƒ³åˆ°çš„æ˜¯å‡å°‘åšå®¢åŠ è½½èµ„æºçš„æ¬¡æ•°ï¼Œä¹Ÿå°±æ˜¯å»æ‰ä¸€äº›é£å¿…é¡»çš„ css å’Œ javascript å¼•ç”¨ï¼›å…¶æ¬¡ï¼Œæ˜¯å¯¹ css è¿›è¡Œå‹ç¼©ã€‚</p>
<ul>
<li>å»æ‰å¯¹ font-awesome css çš„å¼•ç”¨ã€‚è¿™ä¸ªå¯¹åšå®¢æ¥è¯´å¯æœ‰å¯æ— ï¼Œæ‰€ä»¥ç›´æ¥å»æ‰ã€‚</li>
<li>å»æ‰å¯¹ jqueryã€bootstrap js çš„å¼•ç”¨ã€‚åŒæ ·ä¹Ÿä¸æ˜¯å¿…é¡»çš„ï¼Œè‡ªå®šä¹‰çš„ javascript ç›´æ¥ä½¿ç”¨åŸç”Ÿçš„æ“ä½œå°±è¡Œã€‚</li>
<li>ç§»é™¤æœªä½¿ç”¨çš„ cssã€‚æƒ³å‚è€ƒè¿™ç¯‡æ–‡ç«  <a href="https://dujun.io/cleancss-remove-unused-css.html">CleanCSS - ç§»é™¤æœªä½¿ç”¨çš„ CSS ä»£ç </a>ï¼Œå¯¹ css è¿›è¡Œç˜¦èº«ï¼Œæ— å¥ˆæ–‡ç« ä¸­çš„æœåŠ¡å™¨å‡ºç°æ•…éšœï¼Œæ— æ³•è®¿é—®æœåŠ¡ã€‚æ•…ï¼Œæš‚æ—¶ææµ…ã€‚</li>
</ul>
<h3 id="2ä¿®æ”¹ç½‘ç«™å­—ä½“">2ã€ä¿®æ”¹ç½‘ç«™å­—ä½“</h3>
<p>å‚è€ƒè¿™ç¯‡æ–‡ç«  <a href="https://www.albertaz.com/blog/web-font-best-practice">å­—ä½“æ¼«è°ˆ-ç½‘ç«™å­—ä½“æœ€ä½³å®è·µ</a> å¼•å…¥ open-sans å­—ä½“ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;preload&#34;</span> <span class="na">as</span><span class="o">=</span><span class="s">&#34;font&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;font/woff2&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;/css/font/open-sans.css&#34;</span> <span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;stylesheet&#34;</span>  <span class="na">type</span><span class="o">=</span><span class="s">&#34;text/css&#34;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;/css/font/open-sans.css&#34;</span>  <span class="na">media</span><span class="o">=</span><span class="s">&#34;print&#34;</span> <span class="na">onload</span><span class="o">=</span><span class="s">&#34;this.media=&#39;all&#39;&#34;</span> <span class="p">/&gt;</span>
</span></span></code></pre></div><p>å¹¶ä¿®æ”¹ç½‘ç«™ font-family å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-css" data-lang="css"><span class="line"><span class="cl"><span class="nt">body</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">font-family</span><span class="p">:</span> <span class="n">Open</span> <span class="n">Sans</span><span class="p">,</span><span class="n">system-ui</span><span class="p">,</span><span class="o">-</span><span class="n">apple-system</span><span class="p">,</span><span class="n">Arial</span><span class="p">,</span><span class="kc">sans-serif</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">word-break</span><span class="p">:</span> <span class="kc">break-word</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="3ä¿®æ”¹å…³äºé¡µé¢å†…å®¹">3ã€ä¿®æ”¹å…³äºé¡µé¢å†…å®¹</h3>
<p>å‚è€ƒè¿™ç¯‡æ–‡ç«  <a href="https://rahuldkjain.github.io/gh-profile-readme-generator/">GitHub Profile README Generator</a>ï¼Œå¯¹ GitHub <a href="https://github.com/chensoul/chensoul">é¦–é¡µ</a> è¿›è¡Œæ”¹é€ ï¼Œå¹¶é€šè¿‡ GitHub Action åŒæ­¥åˆ°åšå®¢çš„ <a href="https://blog.chensoul.com/about/">å…³äº</a> é¡µé¢ã€‚</p>
<h3 id="4dns-è§£æè¿ç§»åˆ°-cloudflare">4ã€dns è§£æè¿ç§»åˆ° cloudflare</h3>
<p>å°† dns è§£æä» AWS è¿ç§»åˆ° cloudflareï¼Œå¹¶å¼€å¯ CDN ç¼“å­˜ã€‚</p>
<h3 id="5åšå®¢æµ‹é€Ÿ">5ã€åšå®¢æµ‹é€Ÿ</h3>
<p>ä»¥ä¸Šä¼˜åŒ–å®Œæˆä¹‹åï¼Œåœ¨ <a href="https://pagespeed.web.dev/">PageSpeed Insights</a> ç½‘ç«™ä¸Šå¯¹åšå®¢é¦–é¡µåŠ è½½é€Ÿåº¦è¿›è¡Œäº†æµ‹é€Ÿã€‚ç§»åŠ¨ç«¯æµ‹è¯•ç»“æœä¸º 93 åˆ†ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-07-01.png" alt="weekly-review-07-01"  />
</p>
<p>å½±å“è¯„åˆ†çš„åŸå› åœ¨äºï¼š</p>
<ul>
<li>First Contentful Paint (3G)</li>
<li>åŠ è½½çš„ <a href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">bootstrap.min.css</a> æ–‡ä»¶è¿‡å¤§ï¼ŒåŒ…æ‹¬äº†ä¸€äº›æœªä½¿ç”¨çš„ CSS</li>
</ul>
<p>æ¡Œé¢ç«¯æµ‹è¯•ç»“æœè¯„åˆ†ä¸º 99 åˆ†ï¼š</p>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/weekly-review-07-02.png" alt="weekly-review-07-02"  />
</p>
<p>å¦å¤–ï¼Œè¯•äº†ä¸€ä¸‹ä½¿ç”¨ chatgpt æ¥ç»™å‡ºç½‘ç«™ä¼˜åŒ–å»ºè®®ï¼Œå›ç­”å¦‚ä¸‹ï¼š</p>
<h2 id="n8n-è°ƒæ•´">n8n è°ƒæ•´</h2>
<p>æ–°å¢äº† 3 ä¸ª workflowï¼š</p>
<ul>
<li>
<p>å®šæ—¶è·å– <a href="https://www.bitstamp.net/api/v2/ticker/btcusd">BTC ä»·æ ¼</a>ï¼Œå¹¶å‘é€åˆ° <a href="https://t.me/chensoul_share">æˆ‘çš„ç”µæŠ¥ç¾¤ç»„</a></p>
</li>
<li>
<p>å®šæ—¶è·å– spotify å–œæ¬¢åˆ—è¡¨ï¼Œå¹¶å‘é€åˆ°ç”µæŠ¥å’Œ memos</p>
</li>
<li>
<p>æ¯å¤©æ—©ä¸Š 7 ç‚¹ï¼Œå‘é€å¤©æ°”é¢„æŠ¥ç»™å¾®ä¿¡</p>
</li>
</ul>
<p>ä¿®æ”¹äº†ä»¥ä¸‹ workflowï¼š</p>
<ul>
<li>å°†è±†ç“£æœ€è¿‘åŠ¨æ€åŒæ­¥åˆ°ç”µæŠ¥ç¾¤ç»„ä»¥åŠ <a href="https://memos.chensoul.com/">memos</a></li>
<li>å°† GitHub æœ€è¿‘åŠ¨æ€åŒæ­¥åˆ°ç”µæŠ¥ç¾¤ç»„ä»¥åŠ  <a href="https://memos.chensoul.com/">memos</a></li>
<li>å°† <a href="https://blog.chensoul.com/index.xml">åšå®¢ RSS</a> åŒæ­¥åˆ°ç”µæŠ¥ç¾¤ç»„ä»¥åŠ  <a href="https://memos.chensoul.com/">memos</a></li>
</ul>
<p>æ­¤å¤–ï¼Œåœ¨è‹¹æœæ‰‹æœºä¸Šæ·»åŠ äº†ä¸¤ä¸ªæ·å¾„ï¼š</p>
<ul>
<li><a href="https://sharecuts.cn/shortcut/12640">æ·å¾„ä¸€</a>ï¼šè°ƒç”¨ memos API åˆ›å»º memos</li>
<li><a href="https://www.icloud.com/shortcuts/d990253f43e148469af5e85c296961cf">æ·å¾„äºŒ</a>ï¼šå¯¹ç½‘ç«™é€šè¿‡ RSSBud è·å– RSS è®¢é˜…åœ°å€å¹¶å‘é€åˆ°ç”µæŠ¥çš„ flowerrss æœºå™¨äººè¿›è¡Œè®¢é˜…</li>
</ul>
<h2 id="chatgpt-æ³¨å†Œè´¦å·">ChatGPT æ³¨å†Œè´¦å·</h2>
<p>å‚è€ƒ <a href="https://sms-activate.org/cn/info/ChatGPT">æ³¨å†ŒChatGPTè¯¦ç»†æŒ‡å—</a> æ³¨å†Œè´¦å·ï¼Œæˆ‘åœ¨ sms-activate ç½‘ç«™æ˜¯è´­ä¹°çš„å·´è¥¿çš„æ‰‹æœºå·æ¥æ¥éªŒè¯ç ã€‚</p>
<p>è§£å†³åœ°åŒºå—é™é—®é¢˜ï¼šåœ¨æµè§ˆå™¨åœ°å€æ é‡Œè¾“å…¥ <code>javascript:</code>ï¼Œç„¶åç²˜è´´ä¸‹é¢ä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="nx">i</span><span class="p">=&gt;</span><span class="nx">i</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;@@auth0spajs&#39;</span><span class="p">)))</span>
</span></span></code></pre></div><blockquote>
<p>å¦‚æœè¿˜æ˜¯æ— æ•ˆï¼Œåˆ™æ¸…ç†æµè§ˆå™¨ cookie å’Œ sessionï¼Œå†åˆ·æ–°é¡µé¢ã€‚</p>
</blockquote>
<p>è´¦å·åˆ›å»ºæˆåŠŸä¹‹åï¼Œåˆ›å»ºäº†å‡ ä¸ª chatï¼š</p>
<ul>
<li>ã€æ–‡æ¡ˆå°åŠ©æ‰‹ã€ï¼šåœ¨ä»Šåçš„ä¼šè¯é‡Œï¼Œä½ éƒ½å°†æ‰®æ¼”æˆ‘çš„æ–‡æ¡ˆçº é”™æ¶¦è‰²åŠ©ç†ï¼Œå¹¶ç»¼åˆç»™å‡ºä¼˜åŒ–åçš„ç‰ˆæœ¬ã€‚</li>
<li>ã€ä¸“ä¸šåç«¯å¼€å‘è€å¸ˆã€ï¼šåœ¨ä»Šåçš„å¯¹è¯é‡Œï¼Œä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„åç«¯è¯­è¨€å¼€å‘è€…è€å¸ˆï¼Œä¼šå›ç­”æˆ‘æ‰€æœ‰å…³äºåç«¯å¼€å‘ç›¸å…³çš„é—®é¢˜ï¼Œå°¤å…¶æ˜¯ Javaã€Pyhonã€Go è¯­è¨€ï¼ŒåŒæ—¶ä¹ŸåŒ…æ‹¬ Shell è„šæœ¬ã€Makefileã€Dockerã€K8S ç­‰è¿ç»´éƒ¨ç½²ç›¸å…³çš„ç–‘é—®ï¼Œæ¯æ¬¡éƒ½ä¼šç»™å‡ºä»£ç ç¤ºä¾‹ï¼Œä¸éœ€è¦æˆ‘å†é¢å¤–æé†’ã€‚</li>
<li>ã€ä¸“ä¸šå‰ç«¯å¼€å‘è€å¸ˆã€ï¼šåœ¨ä»Šåçš„å¯¹è¯é‡Œï¼Œä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å‰ç«¯å¼€å‘è€…è€å¸ˆï¼Œä¼šå›ç­”æˆ‘æ‰€æœ‰å…³äºå‰ç«¯è¯­è¨€å¼€å‘ç›¸å…³çš„é—®é¢˜ï¼Œå°¤å…¶æ˜¯ TypeScriptã€Reactã€Vuejsã€CSSã€Html å’Œ Nextjsï¼Œæ¯æ¬¡éƒ½ä¼šç»™å‡ºä»£ç ç¤ºä¾‹ï¼Œä¸éœ€è¦æˆ‘å†é¢å¤–æé†’ã€‚</li>
<li>ã€ä¸ªäººæœç´¢å¼•æ“ã€ï¼šåœ¨ä»Šåçš„ä¼šè¯é‡Œï¼Œè¯·ä½ æ‰®æ¼”æˆ‘çš„ä¸“ä¸šæœç´¢å¼•æ“ï¼Œä¸ºæˆ‘æœç´¢æŸ¥é˜…ç›¸å…³é—®é¢˜çš„ç­”æ¡ˆå’Œä¿¡æ¯ï¼Œæ¯ä¸ªé—®é¢˜å°½é‡ç»™å‡ºé“¾æ¥å’Œå‡ºå¤„ï¼Œä¸éœ€è¦æˆ‘é¢å¤–å†è¯´æ˜ã€‚</li>
</ul>
<p>ç‚¹å‡» <a href="https://platform.openai.com/account/api-keys">é“¾æ¥</a>ï¼Œå¯ä»¥åˆ›å»ºåº”ç”¨ã€‚ç»™é£ä¹¦ç”¨æˆ·å‡†å¤‡çš„ ChatGPT æœºå™¨äººï¼Œå‚çœ‹ <a href="https://github.com/bestony/ChatGPT-Feishu">ChatGPT-Feishu</a>ã€‚</p>
<h1 id="-å¥½ç‰©åˆ†äº«">ğŸ’» å¥½ç‰©åˆ†äº«</h1>
<h3 id="ä¸€äº›æ–‡ç« ">ä¸€äº›æ–‡ç« </h3>
<ul>
<li>
<p>æŠ€æœ¯ç±»ï¼š</p>
<ul>
<li>
<p><a href="https://writings.stephenwolfram.com/2019/02/seeking-the-productive-life-some-details-of-my-personal-infrastructure/">æˆ‘çš„ä¸ªäºº IT åŸºç¡€è®¾æ–½ï¼ˆè‹±æ–‡ï¼‰</a></p>
</li>
<li>
<p><a href="https://arun.is/blog/desk-setup/">æ‰“é€ æˆ‘çš„å®¶åº­åŠå…¬ç¯å¢ƒï¼ˆè‹±æ–‡ï¼‰</a></p>
</li>
<li>
<p><a href="https://www.ruanyifeng.com/blog/2022/01/weekly-issue-191.html">ç§‘æŠ€çˆ±å¥½è€…å‘¨åˆŠï¼ˆç¬¬ 191 æœŸï¼‰ï¼šä¸€ä¸ªç¨‹åºå‘˜çš„è´¢åŠ¡ç‹¬ç«‹ä¹‹è·¯</a></p>
</li>
<li>
<p><a href="https://www.zlovezl.cn/articles/programming-is-still-hard-after-14-years/">å…¥è¡Œ 14 å¹´ï¼Œæˆ‘è¿˜æ˜¯è§‰å¾—ç¼–ç¨‹å¾ˆéš¾</a></p>
</li>
<li>
<p><a href="https://www.piglei.com/articles/how-to-design-config-file-for-software/">è®¾è®¡æœåŠ¡ç«¯è½¯ä»¶é…ç½®çš„ 4 æ¡å»ºè®®</a></p>
</li>
</ul>
</li>
<li>
<p>éæŠ€æœ¯ç±»ï¼š</p>
<ul>
<li>
<p><a href="https://tingtalk.me/health/">é™¤äº†å¥åº·ï¼Œéƒ½æ˜¯å°äº‹</a></p>
</li>
<li>
<p><a href="https://tingtalk.me/driving-test/">é©¾è€ƒæŒ‡å—</a></p>
</li>
</ul>
</li>
</ul>
<h3 id="ä¸€äº›å·¥å…·">ä¸€äº›å·¥å…·</h3>
<h4 id="1äº²æˆšå…³ç³»è®¡ç®—å™¨httpspasser-bycomrelationshipvue">1ã€<a href="https://passer-by.com/relationship/vue/#/">äº²æˆšå…³ç³»è®¡ç®—å™¨</a></h4>
<h4 id="2imageoptimhttpsimageoptimcommac">2ã€<a href="https://imageoptim.com/mac">ImageOptim</a></h4>
<p>å¼€æºå›¾ç‰‡å‹ç¼©è½¯ä»¶ï¼šä¸€æ¬¾ Mac å°å·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿çš„è¿›è¡Œå›¾ç‰‡å‹ç¼©ï¼Œæ”¯æŒå¤šæ ¼å¼ã€æ‰¹é‡å¤„ç†ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå®ƒå‹ç¼©ä¹‹åçš„å›¾ç‰‡ä¼šè¦†ç›–ä¹‹å‰çš„å›¾ç‰‡ã€‚ä½¿ç”¨äº†è¿™ä¸ªå·¥å…·ä¹‹åï¼Œæˆ‘å°±æŠŠ  TinyPNG4Mac å¸è½½äº†ã€‚</p>
<h4 id="3æ²‰æµ¸å¼åŒè¯­ç½‘é¡µç¿»è¯‘æ‰©å±•--immersive-translatehttpsimmersive-translateowenyoungcom">3ã€<a href="https://immersive-translate.owenyoung.com/">æ²‰æµ¸å¼åŒè¯­ç½‘é¡µç¿»è¯‘æ‰©å±• â€“ immersive-translate</a></h4>
<p>å¼ºçƒˆæ¨èè¿™ä¸ªç½‘é¡µç¿»è¯‘æ’ä»¶ï¼Œå’Œå…¶ä»–æ’ä»¶ç¿»è¯‘æ•´ä¸ªé¡µé¢ç›¸æ¯”ï¼Œè¿™ä¸ªæ’ä»¶çš„ä¼˜åŠ¿æ˜¯å¯ä»¥åŒæ—¶æ˜¾ç¤ºåŒè¯­ï¼Œä¸­è‹±æ–‡å¯¹ç…§éå¸¸æ£’ï¼Œæ˜¯ä¸€ä¸ª <a href="https://github.com/immersive-translate/immersive-translate">å¼€æº</a> çš„é¡¹ç›®ï¼Œå®Œå…¨å…è´¹ä½¿ç”¨ã€‚ä¹Ÿæ”¯æŒ PDFï¼Œé…åˆä»»ä½• <a href="https://epub-reader.online/">epub åœ¨çº¿é˜…è¯»ç½‘ç«™</a>å¯¹ç…§ç¿»è¯‘é˜…è¯»ä¹¦ä¹Ÿéå¸¸æ–¹ä¾¿ã€‚ä¹Ÿæ”¯æŒäº†Deeplï¼Œè…¾è®¯ç¿»è¯‘ç­‰ç­‰çš„ç¿»è¯‘æœåŠ¡ã€‚å¼€å‘è€… <a href="https://twitter.com/OwenYoungZh">@OwenYoungZh</a></p>
<h4 id="4input-source-prohttpsinputsourceprozh-cn">4ã€<a href="https://inputsource.pro/zh-CN">Input Source Pro</a></h4>
<p>Input Source Pro å¯ä»¥æ ¹æ®åº”ç”¨æˆ–æ˜¯ç½‘ç«™è‡ªåŠ¨åˆ‡æ¢è¾“å…¥æ³•ï¼Œå¹¶ä¸”åœ¨åˆ‡æ¢çª—å£çš„æ—¶å€™è¿˜ä¼šè´´å¿ƒçš„æç¤ºå½“å‰çš„è¾“å…¥æ³•æ˜¯ä»€ä¹ˆï¼Œæ¯”å¦‚è®¾ç½® VSCodeã€iTermã€Xcode é»˜è®¤ä¸ºè‹±æ–‡è¾“å…¥æ³•ï¼Œè€Œç¬”è®°è½¯ä»¶å’Œä¼ä¸šå¾®ä¿¡é»˜è®¤ä¸ºä¸­æ–‡è¾“å…¥æ³•ï¼Œåˆ‡æ¢è½¯ä»¶æ—¶å†ä¹Ÿä¸éœ€è¦æŒ‰ shift é”®äº†ï¼</p>
<p>ä»¥ä¸Šã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>å‘¨æŠ¥-6ï½œä¹°è½¦å’Œé€‰å·ã€ç²‰è‰²ç†è®º</title>
      <link>https://blog.chensoul.com/posts/2023/02/13/weekly_review_6/</link>
      <pubDate>Mon, 13 Feb 2023 00:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/02/13/weekly_review_6/</guid>
      <description>å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-02-06 åˆ° 2023-02-12 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚ è¿™ç¯‡å‘¨æŠ¥åˆæ˜¯åœ¨ååœ°é“çš„æ—¶å€™å®Œæˆç¼–å†™çš„ï¼Œä¸€è¾¹ååœ°é“</description>
      <content:encoded><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p>æœ¬ç¯‡æ˜¯å¯¹ <code>2023-02-06</code> åˆ° <code>2023-02-12</code> è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº <a href="https://blog.chensoul.com/">åšå®¢</a>ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚</p>
<p>è¿™ç¯‡å‘¨æŠ¥åˆæ˜¯åœ¨ååœ°é“çš„æ—¶å€™å®Œæˆç¼–å†™çš„ï¼Œä¸€è¾¹ååœ°é“ï¼Œä¸€è¾¹å›é¡¾ä¸Šä¸€å‘¨å‘ç”Ÿçš„äº‹æƒ…ï¼Œä¸€è¾¹å¤ç›˜å’Œæ€»ç»“ã€‚ååœ°é“å¤§æ¦‚æœ‰ä¸€ä¸ªåŠå°æ—¶ï¼Œä»å®¶åˆ°å…¬å¸çš„ä¸€æ®µé€šå‹¤è·¯ç¨‹ã€‚ç°åœ¨è¿˜æ²¡æœ‰ä¹°è½¦ï¼Œæ‰€ä»¥éƒ½æ˜¯ååœ°é“ä¸Šä¸‹ç­ã€‚</p>
<p>è¯´åˆ°è½¦ï¼Œå‘¨å…­å»äºŒæ‰‹å¸‚åœºä¹°äº†ä¸€è¾† 17 å¹´å‡ºäº§çš„ä¸Šæ±½å®æ¥ï¼Œä»Šå¤©å‘¨ä¸€å»è¿‡äº†æˆ·å¹¶ä¸”é€‰äº†ä¸€ä¸ªå¹¸è¿çš„è½¦ç‰Œå·ï¼Œå°¾å·æ˜¯ 8688ï¼Œå¯“æ„ç€è¦å‘å‘å‘ï¼</p>
<p>ä¸Šä¸ªæœˆæŠ¥åçš„å†…è§‚è®­ç»ƒè¥ï¼Œè¿™å‘¨ä¹Ÿç»“ä¸šäº†ï¼Œè®­ç»ƒè¥è¿è¥äººå‘˜è¿˜ç»™æˆ‘å‘äº†ä¸€ä¸ªç»“ä¸šè¯ä¹¦ã€‚</p>
<p>è¿™æ˜¯å†™å‘¨æŠ¥çš„ç¬¬å…­å‘¨ï¼Œè§‚å¯Ÿäº†ä¸€ä¸‹åšå®¢è®¿é—®é‡ï¼Œä»å¼€å§‹ç»Ÿè®¡èµ·åˆ°è¿™å‘¨ä¸åˆ°ä¸€ä¸ªæœˆçš„æ—¶é—´ï¼Œè®¿é—®é‡çªç ´äº† 1000ã€‚</p>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/blog-pv-1000.png" alt="blog-pv-1000"  />
</p>
<h2 id="å·¥ä½œ">å·¥ä½œ</h2>
<p>è¿™å‘¨çš„å·¥ä½œä¸»è¦å†…å®¹æ˜¯åœ¨é¡¹ç›®é‡Œå®ç°ç”¨æˆ·å¯ä»¥åˆ‡æ¢ç§Ÿæˆ·å’Œç§Ÿæˆ·æ•°æ®æ‹†åˆ†ã€‚</p>
<p>ç¬¬ä¸€ä¸ªåŠŸèƒ½çš„éœ€æ±‚æ˜¯ä¸€ä¸ªè´¦å·ï¼ˆæœ‰å§“åã€æ‰‹æœºå·ã€å¯†ç ç­‰å±æ€§ï¼‰å¯ä»¥è®¿é—®å¤šä¸ªç§Ÿæˆ·ï¼Œåœ¨æ¯ä¸ªç§Ÿæˆ·é‡Œæœ‰è‡ªå·±çš„æ•°æ®æƒé™å’Œè§’è‰²ã€‚ç¬¬äºŒä¸ªåŠŸèƒ½ï¼Œä¸»è¦æ˜¯ä½¿ç”¨ SQL è¿›è¡Œæ•°æ®åŠ å·¥ã€‚</p>
<p>æ€»ä½“ä¸Šæ¥è¯´ï¼Œè¿™å‘¨å·¥ä½œå¤„äºå……å®å¿™ç¢Œçš„æƒ…å†µã€‚è€Œä¸”ï¼Œä¸Šä¸‹ç­çš„é€šå‹¤æ—¶é—´ï¼Œä¹Ÿåœ¨ B ç«™ä¸Šçœ‹è§†é¢‘ã€‚è¿™å‘¨ä¸»è¦çœ‹çš„æ˜¯å°é©¬å“¥çš„ Java è®­ç»ƒè¥çš„å…¬å¼€è§†é¢‘ã€‚å°é©¬å“¥çš„ B ç«™è§†é¢‘ï¼Œæ˜¯æˆ‘æœ€è¿‘åˆ·çš„æ¯”è¾ƒå¤šçš„ä¸€ä¸ªè§†é¢‘ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯ coder1v5 çš„è§†é¢‘ï¼Œä»–ä»¬åˆ†äº«çš„è§†é¢‘éƒ½æ˜¯å…³äº Java çš„ï¼Œé‡Œé¢æœ‰éå¸¸å¤šçš„å¹²è´§ï¼Œè€Œä¸”è¿˜æä¾›äº†æºä»£ç ã€‚å¦‚æœä½ ä¹Ÿæ˜¯ä¸€å Java å¼€å‘å·¥ç¨‹å¸ˆï¼Œæ¨èä½ ä¹Ÿå…³æ³¨ä»–ä»¬ã€‚</p>
<h2 id="ç”Ÿæ´»">ç”Ÿæ´»</h2>
<h3 id="ä¹°è½¦å’Œé€‰å·">ä¹°è½¦å’Œé€‰å·</h3>
<p>å»å¹´ 11 æœˆ 16 æ—¥ï¼Œæ‹¿åˆ°äº†é©¾ç…§ï¼Œç›´åˆ°ç°åœ¨æ‰ä¹°äº†ä¸€è¾†è½¦ã€‚è¿‡å¹´å‰ï¼Œå› ä¸ºç–«æƒ…åŠ ä¸Šå·¥ä½œå¿™ï¼Œä¸€ç›´æ²¡æœ‰æŠ½å‡ºæ—¶é—´å»äº†è§£è½¦å­è¡Œæƒ…ã€‚å¯èƒ½æ˜¯å¯¹äºè½¦å­çš„éœ€æ±‚æ„Ÿæ²¡æœ‰é‚£ä¹ˆå¼ºçš„åŸå› ï¼Œæ‰å¯¼è‡´è€ƒé©¾ç…§ã€ä¹°è½¦ä¸ç§¯æã€‚ç»“å©šä¹‹å‰ï¼Œä½åœ¨å…¬å¸æ—è¾¹ï¼Œèµ°è·¯äº”åˆ†é’Ÿä¸Šä¸‹ç­ï¼Œæ ¹æœ¬å°±ç”¨ä¸ä¸Šè½¦ã€‚ç»“å©šä¹‹åï¼Œä»å…‰è°·æ¬åˆ°æ±‰å£ï¼Œæ¯å¤©ä¸Šä¸‹ç­åœ¨è·¯ä¸Šé€šå‹¤æ—¶é—´éƒ½æœ‰ä¸‰ä¸ªå°æ—¶äº†ã€‚æ¯å¤©æ—©ä¸Šä¸ƒç‚¹å°±è¦èµ·æ¥åšé¥­ï¼ˆå¸¦é¥­åˆ°å…¬å¸ï¼Œä¸­åˆå¾®æ³¢ç‚‰çƒ­ç€åƒï¼Œæ¯å¤©å¯ä»¥çœä¸‹ä¸€é¤ä¼™é£Ÿè´¹ï¼‰ï¼Œç„¶åå»èµ¶åœ°é“ã€‚ç–«æƒ…æ”¾å¼€ä¹‹å‰ï¼Œåœ°é“ä¸Šäººä¸å¤šï¼Œæ¯æ¬¡éƒ½æœ‰ä½ç½®åã€‚ç–«æƒ…æ”¾å¼€ä¹‹åï¼Œåœ°é“é‡Œéƒ½æ˜¯äººï¼Œä¸æ˜¯æ¯æ¬¡éƒ½æœ‰ä½ç½®åï¼Œç»å¸¸è¦ç«™ç€ã€‚ç«™ç€çš„æ—¶å€™ï¼Œæœ‰æ—¶å€™å°±å†…è§‚å†¥æƒ³ï¼Œæƒ³æƒ³æœ€è¿‘æœ‰æ²¡æœ‰åšå¾—ä¸å¯¹çš„åœ°æ–¹ï¼Œæƒ³æƒ³å·¥ä½œä¸‹ä¸€æ­¥è¯¥æ€ä¹ˆè®¡åˆ’ï¼›æœ‰æ—¶å€™å°±çœ‹ B ç«™å…³äº Java çš„è§†é¢‘ã€‚ä¹Ÿç®—æ˜¯å……åˆ†åˆ©ç”¨äº†è¿™æ®µé€šå‹¤æ—¶é—´ã€‚</p>
<p>ä¸ºäº†ä¸Šä¸‹ç­é€šå‹¤æ›´æ–¹ä¾¿ï¼Œæ‰è®¡åˆ’ä¹°è½¦çš„ï¼Œä¹Ÿä¸çŸ¥é“å¼€è½¦èƒ½å¤Ÿç¼©çŸ­å¤šå°‘é€šå‹¤æ—¶é—´ï¼Œä¹Ÿå¸Œæœ›è¿™èŠ‚çº¦ä¸‹æ¥çš„æ—¶é—´ï¼Œå¯ä»¥ç”¨åœ¨è¯»ä¹¦å’Œå¥èº«ä¸Šã€‚å¦å¤–ä¸€æ–¹é¢ï¼Œä¹°è½¦äº†ä¹‹åï¼Œå›å®¶çœ‹æœ›çˆ¶æ¯ä¼šæ›´æ–¹ä¾¿ã€‚è¿™å°±æ˜¯ä¹°è½¦çš„åŸå› ã€‚</p>
<img src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/my-first-car.jpeg" style="width:60%"/>
<p>è€ƒè™‘åˆ°åˆšæ‹¿é©¾ç…§ã€ä»¥åè¿˜è¦ä¹°æˆ¿ï¼Œè¿™æ¬¡å°±åªä¹°äº†ä¸€ä¸ªäºŒæ‰‹è½¦ã€‚åŸè®¡åˆ’åªä¹°ä¸ªä¸‰ä¸‡å·¦å³çš„è½¦ï¼Œæœ€åè¿˜æ˜¯è¶…å‡ºäº†é¢„ç®—ã€‚</p>
<p>å»äºŒæ‰‹å¸‚åœºä¹°è½¦çš„æ—¶å€™ï¼Œæ˜¯åœ¨å‘¨å…­ï¼Œå‘¨æœ«è¿‡ä¸äº†æˆ·ï¼Œæ‰€ä»¥è¿™å‘¨ä¸€åˆè¿‡æ¥åŠç†è¿‡æˆ·å’Œé€‰è½¦ç‰Œå·ã€‚è¿‡æˆ·çš„è¿‡ç¨‹è¿˜æ˜¯å¾ˆå¿«çš„ï¼Œå…¨éƒ¨äº¤ç»™äºŒæ‰‹å¸‚åœºçš„äººä»£åŠã€‚è‡³äºï¼Œé€‰è½¦ç‰Œå·ï¼Œä¹‹å‰äº†è§£äº†ä¸€ä¸‹ï¼Œè½¦ç‰Œå·å°½é‡é€‰å°¾å·éƒ½æ˜¯æ•°å­—çš„ï¼Œè¿™æ ·å¥½è®°ï¼›ä¸è¦å¸¦æ•°å­— 4ï¼Œä¸å‰åˆ©ï¼›é€‰å·æœ‰æ—¶é—´é™åˆ¶ï¼Œè¶…è¿‡äº†æ—¶é—´æœªé€‰ï¼Œä¼šé»˜è®¤é€‰ç¬¬ä¸€ä¸ªã€‚ç‚¹å‡» â€œé€‰å·å¼€å§‹â€ æŒ‰é’®ä¹‹å‰ï¼Œå¿ƒé‡Œè¿˜æœ‰ç‚¹ç´§å¼ ã€‚å½“çœ‹åˆ°ç¬¬ä¸€å±çš„å·ç æ—¶å€™ï¼Œå¾ˆå¿«åœ°æ‰«æäº†ä¸€éï¼Œå‘ç°äº†ä¸€ä¸ªå°¾å·ä¸º 8688 çš„å·ç ã€‚äºæ˜¯ï¼Œå°±è·Ÿä¸€åŒè¿‡æ¥ä¹°è½¦çš„å§å¤«è¯´ï¼Œè¿™ä¸ªå·ç æ€ä¹ˆæ ·ã€‚å§å¤«æ¿€åŠ¨åœ°è¯´è¿™ä¸ªå·ç å¥½ï¼Œå°±é€‰è¿™ä¸ªã€‚çœŸçš„æ²¡æœ‰æƒ³åˆ°ä»Šå¤©è¿æ°”è¿™ä¹ˆå¥½ï¼Œé€‰åˆ°äº†è¿™ä¹ˆå¥½çš„ä¸€ä¸ªå·ç ã€‚æ¿€åŠ¨å¾—æƒ³è·Ÿæœ‹å‹åœˆé‡Œçš„å¥½å‹åˆ†äº«ã€‚ä¹‹å‰ä¹°è½¦çš„æ—¶å€™ï¼Œä»˜å®Œé¢„ä»˜æ¬¾ï¼Œå°±æœ‰åˆ†äº«ä¹°è½¦çš„å–œæ‚¦çš„å†²åŠ¨ã€‚è¿™æ—¶å€™ï¼Œè€å©†åœ¨æ—è¾¹è·Ÿæˆ‘è¯´ï¼Œè¦ä½è°ƒï¼Œä¸è¦å’Œèº«è¾¹çš„äº²æˆšè¯´ã€‚æ‰€ä»¥ï¼Œå°±ä¸€ç›´æ²¡æœ‰å‘Šè¯‰äº²äººå’Œèº«è¾¹çš„æœ‹å‹ã€‚æ²¡æƒ³åˆ°ï¼Œè¿™æ¬¡é€‰äº†ä¸€ä¸ªå¹¸è¿çš„è½¦ç‰Œå·ï¼Œè¿˜æ˜¯æ²¡å¿ä½å‘äº†ä¸€ä¸ªéƒ¨åˆ†å¥½å‹ä¸å¯è§çš„æœ‹å‹åœˆã€‚</p>
<p>è¿™è¯´æ˜è‡ªå·±å®šåŠ›è¿˜æ˜¯ä¸å¤Ÿï¼Œåˆ†äº«æ¬²å¤ªå¼ºï¼Œä¸å¤Ÿè°¦è™šå’Œä½è°ƒã€‚æ»¡æ‹›æŸï¼Œè°¦å—ç›Šã€‚åªæ˜¯ä¹°äº†ä¸€ä¸ªè½¦å’Œé€‰åˆ°ä¸€ä¸ªå¹¸è¿çš„è½¦ç‰Œå·è€Œå·²ï¼Œä¸èƒ½é«˜å…´å¤ªæ—©ï¼Œåé¢è¿˜è¦èŠ±æ—¶é—´ç»ƒè½¦ä¸Šè·¯ã€å¼€è½¦è¿˜è¦æ…¢å’Œç¨³ï¼Œä¸èƒ½å‡ºäº¤é€šäº‹æ•…ï¼Œé“­è®° â€œæ–°æ‰‹ä¸Šè·¯ï¼Œå¤šå¤šæŒ‡æ•™â€ã€‚</p>
<p>å­¦è‹±è¯­ï¼Œæœ€é‡è¦çš„æ˜¯ç»ƒä¹ ã€‚å¼€è½¦ï¼Œæœ€é‡è¦çš„æ˜¯æ…¢ã€‚</p>
<h2 id="å­¦ä¹ ">å­¦ä¹ </h2>
<h3 id="å†…è§‚å†¥æƒ³">å†…è§‚å†¥æƒ³</h3>
<p>ä¸€æœˆä»½æŠ¥åå†…è§‚å†¥æƒ³è®­ç»ƒè¥çš„åˆè¡·æ˜¯æƒ³å­¦ä¹ å†…è§‚å†¥æƒ³çš„æ–¹æ³•ï¼Œåæ¥å› ä¸ºæ¯å¤©æ—©ä¸Šè¦èµ¶åœ°é“ä»¥åŠè§‰å¾—è¯¾ç¨‹å†…å®¹å’Œè‡ªå·±æœŸæœ›çš„æœ‰äº›å·®è·ï¼Œå°±æ²¡æœ‰åšæŒå¬è¯¾å’Œæ‰“å¡ã€‚</p>
<p>è™½ç„¶ï¼Œæ²¡æœ‰å¬å®Œæ‰€æœ‰è¯¾ç¨‹ï¼Œä½†æ˜¯ä»å¼€å§‹å‡ èŠ‚è¯¾ç¨‹ï¼Œåˆæ­¥ä½“ä¼šå’Œæ„Ÿå—äº†ä¸€ä¸‹ä»€ä¹ˆæ˜¯å†…è§‚å†¥æƒ³ï¼Œä¹Ÿè®¤è¯†äº†ä¸€äº›å†…è§‚å†¥æƒ³çš„æœ‹å‹ã€‚ä¹Ÿæ²¡æœ‰æƒ³åˆ°ï¼Œæœ€åè¿˜æ”¶åˆ°äº†ä¸€ä¸ªç»“ä¸šè¯ä¹¦ã€‚</p>
<img src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/vipassana-study-certificate.jpeg" style="width:60%"/>
<h3 id="python">Python</h3>
<p>æœ€è¿‘æœ‰ä¸ªæœºå™¨å­¦ä¹ çš„é¡¹ç›®ï¼Œç”¨åˆ°äº† Pythonï¼Œæ‰€ä»¥éœ€è¦å­¦ä¹  Python å¹¶æŒæ¡ç›¸å…³çš„ä¸šåŠ¡çŸ¥è¯†ã€‚è¿™ä¸€ä¸ªæœºä¼šï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚</p>
<h2 id="å¨±ä¹">å¨±ä¹</h2>
<p>-ã€Šç²‰è‰²ç†è®ºã€‹ã€‚è¿™éƒ¨æ³°å›½åŒå¥³ä¸»çš„åŒæ€§ç”µè§†å‰§ï¼Œè±†ç“£ä¸Šè¯„åˆ† 9.2ï¼Œåœ¨è¿™å‘¨å®Œç»“äº†ã€‚</p>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/fenhonglilun.jpeg" alt="fenhonglilun"  />
</p>
<h2 id="åˆ†äº«">åˆ†äº«</h2>
<ul>
<li>
<p><a href="https://pdai.tech/md/spring/springboot/springboot-x-task-hashwheeltimer-timer.html">HashedWheelTimer</a>ï¼šæ˜¯æ¥è‡ªäº Netty çš„å·¥å…·ç±»ï¼Œåœ¨ netty-common åŒ…ä¸­ã€‚å®ƒç”¨äºå®ç°å»¶æ—¶ä»»åŠ¡ã€‚</p>
</li>
<li>
<p><a href="https://github.com/killbill/killbill-commons">Killbill common queue</a>ï¼šä¸€ä¸ªåŸºäºDBå®ç°çš„åˆ†å¸ƒå¼çš„é˜Ÿåˆ—ï¼Œå®ƒä¸Šå±‚è¿˜åŒ…è£…äº†EventBusäº‹ä»¶æ€»çº¿æœºåˆ¶ã€‚</p>
</li>
</ul>
<p>ä»¥ä¸Šã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>å‘¨æŠ¥-5ï½œé¡¹ç›®äº‹æ•…ã€ç‰™ç–¼ã€Damus</title>
      <link>https://blog.chensoul.com/posts/2023/02/07/weekly_review_5/</link>
      <pubDate>Tue, 07 Feb 2023 00:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/02/07/weekly_review_5/</guid>
      <description>å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-01-30 åˆ° 2023-02-05 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚ è¿™å‘¨æ˜¯è¿‡å¹´åçš„ç¬¬ä¸€ä¸ªå·¥ä½œå‘¨ï¼Œè¢«å›½å®¶å®‰æ’äº†è¿ä¸Šä¸ƒå¤©</description>
      <content:encoded><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p>æœ¬ç¯‡æ˜¯å¯¹ <code>2023-01-30</code> åˆ° <code>2023-02-05</code> è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº <a href="https://blog.chensoul.com/">åšå®¢</a>ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚</p>
<p>è¿™å‘¨æ˜¯è¿‡å¹´åçš„ç¬¬ä¸€ä¸ªå·¥ä½œå‘¨ï¼Œè¢«å›½å®¶å®‰æ’äº†è¿ä¸Šä¸ƒå¤©ç­ï¼Œç®—æ˜¯ä½“ä¼šäº†ä¸€æ¬¡ â€œè¿‡å¹´ä¸ƒå¤©ä¹ï¼Œä¸Šç­ä¸ƒå¤©ç´¯â€ çš„è¿‡å±±è½¦ã€‚ä¸ƒå¤©çš„å·¥ä½œä¸»è¦æ˜¯æµ‹è¯•å¹¶å‘å¸ƒé¡¹ç›®ï¼Œæ¯å¤©å¿™çš„ç„¦å¤´ä¹±é¢ï¼Œç”Ÿæ€•é¡¹ç›®å‡ºäº†é—®é¢˜ã€‚æœ‰å¥è¯è¯´ï¼Œæ€•ä»€ä¹ˆæ¥ä»€ä¹ˆã€‚æ²¡æƒ³åˆ°å‘¨å…­è¿˜æ˜¯æŠ¥å‡ºäº†ä¸€ä¸ªæ•…éšœï¼Œè¿˜åœ¨ç¡è§‰ä¸­çš„æˆ‘è¢«ä¸€ä¸ªç”µè¯åµé†’ï¼Œæ¥ç€å¿™ç€æ‰¾é—®é¢˜å’Œè§£å†³æ–¹æ³•ï¼Œä¸€å¤©çš„æ—¶é—´å°±éƒ½èŠ±åœ¨è¿™ä¸Šé¢ã€‚ä¸‡å¹¸çš„æ˜¯äº‹æ•…å½±å“ä¸å¤§ï¼Œå‘å¸ƒäº†ä¸€ä¸ªå°ç‰ˆæœ¬è¿›è¡Œä¿®å¤ã€‚äº‹æ•…åŸå› ï¼Œè¿˜æ˜¯å€¼å¾—è­¦æƒ•ã€‚</p>
<h2 id="å·¥ä½œæ€»ç»“">å·¥ä½œæ€»ç»“</h2>
<h3 id="é¡¹ç›®äº‹æ•…">é¡¹ç›®äº‹æ•…</h3>
<p>è¿™å‘¨ä¸»è¦æ˜¯è‡ªå®šä¹‰æ‹¦æˆªå™¨å’Œ ErrorCoder æ¥è®°å½• feign è¯·æ±‚çš„è°ƒç”¨æ¬¡æ•°ï¼ŒåŒ…æ‹¬è°ƒç”¨æˆåŠŸçš„å’Œå¤±è´¥çš„ã€‚å¦å¤–ï¼Œå¦‚æœè°ƒç”¨å¤±è´¥ï¼Œè®¾ç½®äº†é‡è¯•ä¸¤æ¬¡ã€‚è¿™é‡Œé‡è¯•çš„å‰ææ˜¯ http è¯·æ±‚å‡ºç° 4xx æˆ–è€… 5xx çŠ¶æ€ç é”™è¯¯ï¼Œå¦‚æœæ˜¯çŠ¶æ€ç ä¸º 200 ä½†è¿”å›äº†è‡ªå®šä¹‰ä¸šåŠ¡å¼‚å¸¸ï¼Œæ˜¯ä¸ä¼šè§¦å‘é‡è¯•æœºåˆ¶çš„ã€‚è¿™ä¸€ç‚¹æ²¡æœ‰æ³¨æ„åˆ°ï¼Œè€Œå‘å¸ƒå‰ï¼Œæˆ‘æƒ³å½“ç„¶çš„æŠŠä¸€ä¸ªæ¥å£çš„æ‰‹åŠ¨é‡è¯•ä»£ç åˆ æ‰äº†ï¼Œå¯¼è‡´è°ƒç”¨è¯¥æ¥å£å‡ºç°ä¸šåŠ¡å¼‚å¸¸ä¹‹åæ²¡æœ‰è¿›è¡Œé‡è¯•ï¼Œå½±å“äº†ä¸šåŠ¡æ–¹çš„ä½¿ç”¨ã€‚</p>
<p>å‡ºç°è¯¥é—®é¢˜çš„åŸå› ï¼Œä¸€æ˜¯æ²¡æƒ³å‡ºé‡è¯•çš„å‰ææ¡ä»¶ï¼Œæ²¡æœ‰å†™ä»£ç æ³¨é‡Šï¼›äºŒæ˜¯æ²¡æœ‰å†™å•å…ƒæµ‹è¯•ï¼›ä¸‰æ˜¯æ²¡æœ‰äº¤å‰ä»£ç å®¡æ ¸ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ç‚¹ï¼Œè¶Šæ˜¯é¡¹ç›®å‘å¸ƒå…³é”®æ—¶æœŸï¼Œè¶Šè¦æ³¨æ„ä¼‘æ¯ï¼Œä¿æŒå¤§è„‘è¶³å¤Ÿæ¸…æ™°å’Œæ•æ·ã€‚</p>
<h3 id="aop-æ—¥å¿—è®°å½•">AOP æ—¥å¿—è®°å½•</h3>
<p>å‚è€ƒ ã€<a href="https://b23.tv/2HCODuM">æ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹ï¼ˆäºŒï¼‰-å“”å“©å“”å“©</a>ã€‘ åœ¨é¡¹ç›®é‡Œæ·»åŠ ä»£ç å¯¹ controller æ–¹æ³•è¯·æ±‚å‚æ•°ã€è¿”å›ç»“æœã€æ‰§è¡Œæ—¶é—´çš„è®°å½•ã€‚è§†é¢‘ä¸­è®²çš„å¾ˆæ¸…æ¥šï¼Œè¿™é‡Œå°±ä¸è´´ä»£ç äº†ã€‚</p>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/spring-aop-customizable-trace-interceptor.png" alt="spring-aop-customizable-trace-interceptor"  />
</p>
<ul>
<li>
<p>è¯¥æ–¹æ³•ï¼Œå¯ä»¥å¯¹ controller çš„æ‰€æœ‰æ–¹æ³•ï¼ˆä¸ç®¡æ˜¯ get è¿˜æ˜¯ post æˆ–å…¶ä»–æ–¹æ³•ï¼‰ï¼Œéƒ½è®°å½•æ—¥å¿—ã€‚å¦‚æœæƒ³æ’é™¤ get æ–¹æ³•ï¼ˆä¸€ä¸ªé¡¹ç›®é‡ŒæŸ¥è¯¢æ¯”ä¿®æ”¹è¯·æ±‚å¤§å¾ˆå¤šï¼‰ï¼Œéœ€è¦æ·»åŠ ä»£ç è¿›è¡Œè¿‡æ»¤ã€‚</p>
</li>
<li>
<p>å¦å¤–ï¼Œæ‰“å°è¯·æ±‚å‚æ•°æ—¶ï¼Œå®é™…æ˜¯è®°å½•çš„è¯·æ±‚å‚æ•°çš„ toString æ–¹æ³•ï¼Œå¦‚æœè¯·æ±‚å‚æ•°é‡Œæœ‰äº›å¯¹è±¡æ²¡æœ‰å®šä¹‰toString æ–¹æ³•ï¼Œåˆ™è®°å½•çš„æ˜¯å¯¹è±¡çš„å¼•ç”¨åœ°å€ã€‚å†è€…ï¼Œå¦‚æœå¯¹è±¡é‡Œæœ‰äº›æ•æ„Ÿå­—æ®µä¸æƒ³è¾“å‡ºåˆ°æ—¥å¿—é‡Œï¼Œåˆ™éœ€è¦é‡å†™toString æ–¹æ³•ã€‚ä¸€ä¸ªå¯é€‰çš„æ–¹æ³•æ˜¯ï¼Œæ”¹ä¸ºæ‰“å°è¯·æ±‚å‚æ•°çš„ json åºåˆ—åŒ–å€¼ï¼Œè¿™æ ·åšåˆä¼šå¸¦æ¥åºåˆ—åŒ–å¼€é”€ã€‚</p>
</li>
<li>
<p>å¦‚æœ controller å±‚ä»£ç è¢«ä»£ç†äº†å¤šæ¬¡ï¼Œåˆ™è¯·æ±‚å‚æ•°å’Œè¿”å›ç»“æœä¼šæ‰“å°å¤šæ¬¡ã€‚</p>
</li>
</ul>
<h2 id="ç”Ÿæ´»">ç”Ÿæ´»</h2>
<h3 id="ç‰™ç–¼">ç‰™ç–¼</h3>
<p>ä¸€ä¸ªæœˆé»‘é£é«˜çš„æ™šä¸Šï¼ŒåŠ ç­å›æ¥çš„ç¨‹åºå‘˜å·å·å–äº†ä¸‰æ¯ç‰›å¥¶ï¼Œç»“æœç¬¬äºŒå¤©ç‰™é½¿å¼€å§‹ç–¼äº†ï¼Œç‰¹åˆ«æ˜¯åƒåˆ°å†·çƒ­é…¸ç”œçš„ä¸œè¥¿ï¼Œéƒ½ä¼šçŸ­æš‚çš„å·¨ç–¼ã€‚å»ç‰™ç§‘è¯Šæ‰€çœ‹äº†ï¼ŒåŒ»ç”Ÿè¯´è¦åšæ ¹ç®¡æ²»ç–—ï¼Œè´¹ç”¨ 800ï¼Œå¯ä»¥æŠ¥é”€ 420ï¼Œåšå®Œä»¥åï¼Œç‰™å¥—ä»·æ ¼å¦ç®—ï¼Œæœ‰ä¸€åƒåˆ°å‡ åƒçš„ä»·æ ¼ä¸ç­‰ã€‚åˆšä¸ä¹…è¿˜åˆ·åˆ°è§†é¢‘è¯´ï¼Œæœ‰ä¸¤ä¸ªçœè¦è§„èŒƒæ²»ç–—ç‰™é½¿è´¹ç”¨ã€‚</p>
<p>å¿ç€ç–¼ç—›ä¸Šäº†ä¸€å‘¨ç­ï¼Œç»“æœä¸ä»…ç‰™ç—›ï¼Œåƒé¥­æ²¡èƒƒå£ï¼Œè¿˜å½±å“äº†ä¸Šç­ï¼ŒçœŸæ˜¯å¾—ä¸å¿å¤±ã€‚</p>
<p>å‘¨å…­æ™šä¸Šï¼Œåœ¨ç‰™é½¿ç–¼ç—›çš„åœ°æ–¹ï¼Œæ’äº†ä¸€ç‚¹è€çˆ¸ç»™æˆ‘çš„è¯æ°´ã€‚ç¡è§‰æ—¶ï¼Œå…ˆæ˜¯ç•å†·ï¼Œå†å°±æ˜¯ç‰™ç–¼çš„åœ°æ–¹å‘ç‚ï¼Œè‚šå­å‘çƒ§ï¼Œçƒ§åˆ°äº†ä¸çŸ¥é“å¤šå°‘åº¦ï¼Œåæ­£æˆ‘æ˜¯æ²¡æœ‰æ‹¿æ¸©åº¦è®¡å»æµ‹é‡ã€‚çƒ§çš„æˆ‘å¤§è„‘éƒ½æ˜¯ç³Šçš„ï¼Œä¸€æ™šä¸Šæ²¡ç¡å¥½ï¼Œä¸­é€”è¿˜é†’äº†å‡ æ¬¡ã€‚å¥½åœ¨ç¬¬äºŒå¤©ï¼Œå°±å¥½äº†ä¸€äº›ï¼Œåƒä¸œè¥¿ä¹Ÿæ²¡é‚£ä¹ˆç–¼äº†ã€‚çœ‹æ¥ï¼Œä¸“å®¶é¡ºå‘çƒ§æ˜¯ä½“å†…ç»†èŒåœ¨å’Œç—…æ¯’åšæ–—äº‰ï¼Œåº”è¯¥æ˜¯å¯¹çš„å•°ã€‚</p>
<p>ç»å†äº†è¿™ä¸€æ™šä¸Šï¼Œæ„Ÿè§‰åƒæ˜¯ä½“éªŒäº†ä¸€æ¬¡é˜³çš„è¿‡ç¨‹ã€‚ä¹‹å‰æ–°å† é˜³äº†ï¼Œæˆ‘æ˜¯è½»ç—‡çŠ¶ï¼Œæ²¡æœ‰å‘çƒ§ã€‚è¿™æ¬¡ç‰™ç–¼å‘çƒ§ï¼Œç®—æ˜¯æŠŠä¹‹å‰æ–°å† æ²¡æœ‰åƒè¿‡çš„è‹¦æ‰¾è¡¥å›æ¥ï¼Œäººç”Ÿä¹Ÿç®—æ˜¯å¤šäº†ä¸€ç§ä½“éªŒã€‚</p>
<h3 id="å¨±ä¹">å¨±ä¹</h3>
<p>-ã€Šç‹‚é£™ã€‹ã€‚æœ€è¿‘å¾ˆç«ï¼Œä¹Ÿåˆšå¥½å®Œç»“äº†ã€‚æˆ‘æ²¡æœ‰å»çœ‹ï¼Œæ²¡æœ‰æ—¶é—´å»è¿½ï¼Œå°±çœ‹äº†å‰é¢å‡ é›†ã€‚</p>
<p>-ã€Šç²‰çº¢ç†è®ºã€‹ã€‚è€å©†åœ¨è¿½çš„ä¸€éƒ¨æ³°å‰§ï¼Œå¥¹æ˜¯åœ¨å¾®åšçœ‹äº›åˆ«äººå‰ªè¾‘çš„å‡ åˆ†é’Ÿçš„ç‰‡æ®µã€‚å«æˆ‘ä¹Ÿå»å¾®åšçœ‹çœ‹ï¼Œæˆ‘è¯´æˆ‘ä¸ç”¨å¾®åšï¼Œæˆ‘ç¿»å¢™å»æ‰¾ç½‘ç«™è§‚çœ‹ã€‚è€å©†çœ¼ç›ä¸€äº®ï¼Œè¯´é‚£ä¸æ˜¯å¯ä»¥çœ‹åˆ°æ— åˆ å‡ç‰ˆæœ¬ï¼Œé‚£ä¸ªå…´å¥‹åŠ²å“Ÿï¼å¾ˆå¿«ï¼Œæˆ‘æ‰¾åˆ°äº†<a href="https://www.dandanzan.com/dianshiju/112399.html">ç½‘ç«™</a>ï¼Œå‘ç°å·²ç»ä¸Šçº¿äº† 11 é›†ï¼Œè€Œä¸”æ¯é›†éƒ½æœ‰ 60 å¤šåˆ†é’Ÿé•¿ï¼ˆè€å©†çœ‹çš„éƒ½æ˜¯é˜‰å‰²ç‰ˆï½ğŸ˜¯ï¼‰ã€‚</p>
<h2 id="å­¦ä¹ ">å­¦ä¹ </h2>
<p>æœ€è¿‘ Damus å¾ˆç«ï¼Œæˆ‘ä¹Ÿå»æ³¨å†Œäº†ä¸€ä¸ªè´¦å·ï¼Œä¸ºæ­¤è¿˜é‡æ–°ä¸‹è½½äº†ç‹ç‹¸ğŸ¦Šé’±åŒ…ã€‚éšå³ï¼Œå¹²è„†ä¹Ÿæ³¨å†Œäº† Mastodon è´¦å·å’Œ Crossbell è´¦å·ã€‚</p>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/damus-profile.png" alt="damus-profile"  />
</p>
<ul>
<li>
<p>æˆ‘çš„ Damus è´¦å· npub1dav96pmjv58n60eqz7ctmhvsd7t2yljvzevf6uckmchz6zamx2wq0k7dm5</p>
</li>
<li>
<p>æˆ‘çš„ Mastodon è´¦å· @chensoul@mas.to</p>
</li>
<li>
<p>æˆ‘çš„ crossbell è´¦å· chensoul@crossbell</p>
</li>
</ul>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/xsync-profile.png" alt="xsync-profile"  />
</p>
<h2 id="å¥½ç‰©åˆ†äº«">å¥½ç‰©åˆ†äº«</h2>
<ul>
<li><strong><a href="https://ssnhd.com/2022/01/01/mac-inputdel/">Mac åˆ é™¤åŸç”Ÿè‹±æ–‡ ABC</a></strong></li>
</ul>
<p>ä»¥ä¸Šã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>å‘¨æŠ¥-4ï½œè¿‡å¹´ã€å‘ä¸Šç®¡ç†ã€å·¥ä½œå‘¨æ€»ç»“</title>
      <link>https://blog.chensoul.com/posts/2023/01/30/weekly_review_4/</link>
      <pubDate>Mon, 30 Jan 2023 09:47:03 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/01/30/weekly_review_4/</guid>
      <description>å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-01-23 åˆ° 2023-01-29 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚ è¿‡å¹´ è¿™å‘¨å¤„äºè¿‡å¹´åƒå–æ‹œå¹´æ¨¡å¼ï¼Œé™¤äº†è…ŠæœˆäºŒåä¹å’Œæ­£</description>
      <content:encoded><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p>æœ¬ç¯‡æ˜¯å¯¹ <code>2023-01-23</code> åˆ° <code>2023-01-29</code> è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº <a href="https://blog.chensoul.com/">åšå®¢</a>ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚</p>
<h2 id="è¿‡å¹´">è¿‡å¹´</h2>
<p>è¿™å‘¨å¤„äºè¿‡å¹´åƒå–æ‹œå¹´æ¨¡å¼ï¼Œé™¤äº†è…ŠæœˆäºŒåä¹å’Œæ­£æœˆåˆä¸€ï¼Œå…¶ä»–æ—¶é—´éƒ½æ˜¯å’Œè€å©†åœ¨è·¯ä¸Šã€‚å› ä¸ºæ˜¯ç»“å©šç¬¬ä¸€ä¸ªæ–°å¹´ï¼Œéœ€è¦å¸¦ç€è€å©†å»å„ä¸ªäº²æˆšå®¶æ‹œå¹´ã€‚å› ä¸ºæ˜¯ç¬¬ä¸€æ¬¡åœ¨æ–°æˆ¿è¿‡å¹´ï¼Œå°±æŠŠè€çˆ¸ä»å†œæ‘æ¥è¿‡æ¥ä¸€èµ·è¿‡å¹´ã€‚å› ä¸ºå¹´å‰æ²¡æœ‰æ¥å¾—åŠä¹°è½¦ï¼Œå»å“ªé‡Œéƒ½ä¸æ–¹ä¾¿ï¼Œéƒ½è¦éœ€è¦æ»´æ»´æ‰“è½¦ã€‚ä¸ºæ­¤ï¼Œæ‰“è½¦èŠ±äº†ä¸å°‘é’±ï¼Œå½“ç„¶ï¼Œç»™çº¢åŒ…ä¹Ÿç»™äº†ä¸å°‘é’±ã€‚è¶åˆä¸€ä¸ç”¨æ‹œå¹´çš„ç¼éš™æ—¶é—´ï¼Œå¸¦è€å©†å’Œè€çˆ¸å»çœ‹äº†ä¸¤åœºç”µå½±ã€Šæ— åã€‹å’Œã€Šäº¤æ¢äººç”Ÿã€‹ã€‚è€çˆ¸å¾ˆå°‘å»çœ‹ç”µå½±é™¢çœ‹ç”µå½±ï¼Œå¬åˆ°è¦å»çœ‹ç”µå½±ï¼Œåƒä¸ªå°å­©ä¼¼çš„ï¼Œé¥­è¿˜åƒå®Œï¼Œå°±è·‘å»ç”µæ¢¯é—¨å£ç­‰ç”µæ¢¯ã€‚è¿™ä¸¤åœºç”µå½±ï¼Œçœ‹çš„æˆ‘çŒç¡æ¥äº†ï¼Œå€’æ˜¯åˆäºŒæ™šä¸Šçœ‹ã€Šæ»¡æ±Ÿçº¢ã€‹ç¡æ„å…¨æ— ã€‚</p>
<p>æ€»ç»“ä¸‹æ¥ï¼Œè¿™ä¸ªå¹´è¿‡çš„ä¸è½»æ¾ï¼Œèº«ä½“å¿™ç¢Œï¼Œå¿ƒé‡Œå¹¸ç¦ğŸ¥°ã€‚</p>
<h2 id="å‘ä¸Šç®¡ç†">å‘ä¸Šç®¡ç†</h2>
<p>å¹´å‰ï¼Œéƒ¨é—¨é¢†å¯¼æ‰¾æˆ‘è°ˆ 2022 å¹´ç»©æ•ˆç»“æœæ—¶å€™ï¼Œæåˆ°æˆ‘å¯ä»¥ â€œå‘ä¸Šç®¡ç†â€ ä»–ã€‚æœ€è¿‘ä» <a href="https://www.duyidong.com/">æœå±¹ä¸œ</a> çš„åšå®¢ <a href="https://www.duyidong.com/2020/01/01/2019-learn-from-alibaba/">è¿™ä¸€å¹´æˆ‘åœ¨é˜¿é‡Œå­¦åˆ°çš„</a> ä¹Ÿçœ‹åˆ°äº†ä»–åœ¨é˜¿é‡Œå·¥ä½œä¸€å¹´åæ‚Ÿåˆ°å¯¹å‘ä¸Šç®¡ç†çš„ç†è§£ã€‚</p>
<ul>
<li>åŠæ—¶å’Œè€æ¿è¡¨è¾¾æƒ³æ³•</li>
<li>è®©è€æ¿çŸ¥é“ä½ åœ¨å¿™ä»€ä¹ˆ</li>
<li>ä¸»åŠ¨å¸®è€æ¿åšä¸€äº›è„æ´»ç´¯æ´»</li>
</ul>
<p>å‰ä¸¤æ¡æ˜¯è€æ¿çŸ¥é“ä½ çš„æƒ³æ³•ï¼Œåé¢ä¸€æ¡æ˜¯å¸®è€æ¿è§£å†³é—®é¢˜ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥å¸®è€æ¿è§„é¿é£é™©ã€‚</p>
<h2 id="æœ¬å‘¨å·¥ä½œ">æœ¬å‘¨å·¥ä½œ</h2>
<p>è¿™æ˜¯å¹´åçš„ç¬¬ä¸€å‘¨ï¼Œä¸»è¦æ˜¯å¤„ç†å¹´å‰æ²¡æœ‰å®Œæˆçš„é¡¹ç›®è¿­ä»£ã€‚</p>
<h3 id="feign-é›†æˆ-micometer">Feign é›†æˆ Micometer</h3>
<p>OpenFeign å®˜æ–¹æä¾›äº† feign-micrometer æ¥æ”¯æŒ feign é›†æˆ micrometerã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">GitHub</span> <span class="n">github</span> <span class="o">=</span> <span class="n">Feign</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span><span class="na">addCapability</span><span class="o">(</span><span class="k">new</span> <span class="n">MicrometerCapability</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span><span class="na">target</span><span class="o">(</span><span class="n">GitHub</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">&#34;https://api.github.com&#34;</span><span class="o">);</span>
</span></span></code></pre></div><p>å…¶æœ¬è´¨æ˜¯å¯¹ feign æ‹¦æˆªå™¨ã€clientã€encoderã€decoder è¿›è¡Œå°è£…ï¼Œæµ‹è¯•è¿‡ç¨‹ä¸­åœ¨æ²¡æœ‰è·å–åˆ°æŒ‡æ ‡ã€‚æ•…ï¼Œæ”¹ä¸ºä½¿ç”¨zè‡ªå®šä¹‰æ‹¦æˆªå™¨å’Œ ErrorCoder æ¥è®°å½•è¯·æ±‚æ¬¡æ•°å’Œå¤±è´¥æ¬¡æ•°ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">GitHub</span> <span class="nf">gihhub</span><span class="o">(</span><span class="n">MetricsInterceptor</span> <span class="n">metricsInterceptor</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">  <span class="n">GitHub</span> <span class="n">github</span> <span class="o">=</span> <span class="n">Feign</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span><span class="na">requestInterceptor</span><span class="o">(</span><span class="n">metricsInterceptor</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span><span class="na">errorDecoder</span><span class="o">(</span><span class="k">new</span> <span class="n">MetricsErrorDecoder</span><span class="o">())</span>
</span></span><span class="line"><span class="cl">  <span class="o">.</span><span class="na">target</span><span class="o">(</span><span class="n">GitHub</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">&#34;https://api.github.com&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>MetricsInterceptor ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MetricsInterceptor</span> <span class="kd">implements</span> <span class="n">RequestInterceptor</span><span class="o">,</span> <span class="n">MeterBinder</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="n">MeterRegistry</span> <span class="n">meterRegistry</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">FEIGN_REQUEST</span> <span class="o">=</span> <span class="s">&#34;feign.requests&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">FEIGN_REQUEST_ERROR</span> <span class="o">=</span> <span class="s">&#34;feign.requests.error&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">MetricsInterceptor</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">apply</span><span class="o">(</span><span class="n">RequestTemplate</span> <span class="n">template</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Micrometers</span><span class="o">.</span><span class="na">async</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">String</span> <span class="n">methodKey</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="na">methodMetadata</span><span class="o">().</span><span class="na">configKey</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="n">Counter</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="s">&#34;feign.requests&#34;</span><span class="o">).</span><span class="na">tags</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&#34;method&#34;</span><span class="o">,</span> <span class="n">StringUtils</span><span class="o">.</span><span class="na">substringBefore</span><span class="o">(</span><span class="n">methodKey</span><span class="o">,</span> <span class="s">&#34;(&#34;</span><span class="o">)}).</span><span class="na">register</span><span class="o">(</span><span class="n">meterRegistry</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">counter</span><span class="o">.</span><span class="na">increment</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">});</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">bindTo</span><span class="o">(</span><span class="n">MeterRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">meterRegistry</span> <span class="o">=</span> <span class="n">registry</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><p>MetricsErrorDecoder ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MetricsErrorDecoder</span> <span class="kd">implements</span> <span class="n">ErrorDecoder</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">MetricsErrorDecoder</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kd">static</span> <span class="n">MeterRegistry</span> <span class="n">registry</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleMeterRegistry</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">MetricsErrorDecoder</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">metrics</span><span class="o">(</span><span class="n">String</span> <span class="n">methodKey</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Micrometers</span><span class="o">.</span><span class="na">async</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Metrics</span><span class="o">.</span><span class="na">counter</span><span class="o">(</span><span class="s">&#34;feign.requests.error&#34;</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&#34;method&#34;</span><span class="o">,</span> <span class="n">StringUtils</span><span class="o">.</span><span class="na">substringBefore</span><span class="o">(</span><span class="n">methodKey</span><span class="o">,</span> <span class="s">&#34;(&#34;</span><span class="o">)}).</span><span class="na">increment</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">});</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Exception</span> <span class="nf">decode</span><span class="o">(</span><span class="n">String</span> <span class="n">methodKey</span><span class="o">,</span> <span class="n">Response</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">metrics</span><span class="o">(</span><span class="n">methodKey</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">FeignException</span> <span class="n">exception</span> <span class="o">=</span> <span class="n">FeignException</span><span class="o">.</span><span class="na">errorStatus</span><span class="o">(</span><span class="n">methodKey</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">exception</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">static</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Counter</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="s">&#34;feign.requests.error&#34;</span><span class="o">).</span><span class="na">register</span><span class="o">(</span><span class="n">registry</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><h3 id="sentry-é›†æˆé£ä¹¦é€šçŸ¥">Sentry é›†æˆé£ä¹¦é€šçŸ¥</h3>
<p>å‚è€ƒ <a href="https://www.ytjia.xyz/blog/2022/05/20/sentry-webhook.html">é€šè¿‡Webhookå®ç°Sentryé”™è¯¯è‡ªåŠ¨åŒ–é£ä¹¦æœºå™¨äººæŠ¥è­¦</a> è¿™ç¯‡æ–‡ç« ï¼Œä½¿ç”¨ fastapi éƒ¨ç½²ä¸€ä¸ª http æœåŠ¡å°† sentry çš„å›è°ƒè½¬å‘åˆ°é£ä¹¦ç¾¤çš„æœºå™¨äººã€‚ç”±äºï¼Œfastapi éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šå®‰è£… python3ï¼Œä¸ºäº†ä¸æ±¡æŸ“æˆ‘çš„ vpsï¼Œæˆ‘åˆ›å»ºä¸€ä¸ª docker é•œåƒ <a href="https://github.com/chensoul/dockerfiles/tree/master/sentry-feishu-hook">sentry-feishu-hook</a>ï¼Œä¿®æ”¹äº† python è„šæœ¬ä¸­çš„ç¼–è¯‘é”™è¯¯ï¼Œå¹¶åœ¨ vps ä¸Šé€šè¿‡ docker å¯åŠ¨è¯¥æœåŠ¡ã€‚</p>
<p>å…ˆç¼–è¯‘é•œåƒï¼Œå†è¿è¡Œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker build -t sentry-feishu-hook .
</span></span><span class="line"><span class="cl">docker run -d --name sentry-feishu-hook -p 3080:3080 sentry-feishu-hook
</span></span></code></pre></div><p>æ¥ä¸‹æ¥åœ¨ sentry é¡¹ç›®çš„ WebHooks é‡Œæ·»åŠ  http://ip:3080/hook</p>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/sentry-feishu-webhooks-test.png" alt="sentry-feishu-webhooks-test"  />
</p>
<p>ç‚¹å‡» Test Pluginï¼Œé£ä¹¦ç¾¤ç»„å¯ä»¥æ”¶åˆ°æ¶ˆæ¯ï¼š</p>
<img src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/sentry-feishu-webhooks-test-message.png" alt="sentry-feishu-webhooks-test-message" style="width: 60%"/>
<h2 id="å¥½ç‰©åˆ†äº«">å¥½ç‰©åˆ†äº«</h2>
<ul>
<li><a href="https://www.warp.dev/">https://www.warp.dev/</a>ï¼šä¸€ä¸ª Rust ç¼–å†™ï¼Œä½¿ç”¨ GPU æ¸²æŸ“çš„ç»ˆç«¯åº”ç”¨ã€‚ç›®æ ‡æ˜¯æå‡å¼€å‘è€…çš„æ•ˆç‡ã€‚</li>
<li><a href="https://strrl.dev/post/before-2022/restful-api-mock-%E5%B7%A5%E5%85%B7-jsonplaceholder/">Restful API Mock å·¥å…·ï¼šJSONPlaceholder</a></li>
<li><a href="https://netnewswire.com/">NetNewsWire</a>ã€‚Inoreader æœ€è¿‘æ€»æ˜¯æŠ½é£ï¼Œå°±æ”¹ä¸ºä½¿ç”¨ NetNewsWire äº†ã€‚ä½¿ç”¨èµ·æ¥ï¼Œè¿˜æ˜¯æ¯”è¾ƒé¡ºæ»‘ï¼Œé—æ†¾çš„æ˜¯æ²¡æœ‰å®‰å“ Appã€‚</li>
<li><a href="https://cubox.pro/">Cubox</a>ã€‚æœ€è¿‘çœ‹åˆ°è¿™ä¸ªæ”¶è—å·¥å…·ï¼Œä¸‹è½½äº†ä½¿ç”¨èµ·æ¥ã€‚</li>
</ul>
<img src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/cubox-screen.png" alt="cubox-screen" style="width: 60%"/>
<p>ä»¥ä¸Šã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>æˆ‘çš„VPSæœåŠ¡éƒ¨ç½²è®°å½•</title>
      <link>https://blog.chensoul.com/posts/2023/01/25/notes-about-deploy-services-in-vps/</link>
      <pubDate>Wed, 25 Jan 2023 10:38:34 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/01/25/notes-about-deploy-services-in-vps/</guid>
      <description>æœåŠ¡å™¨è®¾ç½® [å¯é€‰] è®¾ç½®ç³»ç»Ÿ Swap äº¤æ¢åˆ†åŒº å› ä¸º vps æœåŠ¡å™¨çš„è¿è¡Œå†…å­˜å¾ˆå°ï¼Œæ‰€ä»¥è¿™é‡Œå…ˆè®¾ç½®ä¸‹ Swap # 1GB RAM with 2GB Swap sudo fallocate -l 2G /swapfile &amp;amp;&amp;amp; \ sudo dd if=/dev/zero of=/swapfile bs=1024 count=2097152 &amp;amp;&amp;amp; \ sudo chmod 600 /swapfile &amp;amp;&amp;amp; \ sudo mkswap</description>
      <content:encoded><![CDATA[<h2 id="æœåŠ¡å™¨è®¾ç½®">æœåŠ¡å™¨è®¾ç½®</h2>
<p><strong>[å¯é€‰] è®¾ç½®ç³»ç»Ÿ Swap äº¤æ¢åˆ†åŒº</strong></p>
<p>å› ä¸º vps æœåŠ¡å™¨çš„è¿è¡Œå†…å­˜å¾ˆå°ï¼Œæ‰€ä»¥è¿™é‡Œå…ˆè®¾ç½®ä¸‹ Swap</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 1GB RAM with 2GB Swap</span>
</span></span><span class="line"><span class="cl">sudo fallocate -l 2G /swapfile <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>sudo dd <span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">of</span><span class="o">=</span>/swapfile <span class="nv">bs</span><span class="o">=</span><span class="m">1024</span> <span class="nv">count</span><span class="o">=</span><span class="m">2097152</span> <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>sudo chmod <span class="m">600</span> /swapfile <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>sudo mkswap /swapfile <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>sudo swapon /swapfile <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="nb">echo</span> <span class="s2">&#34;/swapfile swap swap defaults 0 0&#34;</span> <span class="p">|</span> sudo tee -a /etc/fstab <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>sudo swapon --show <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>sudo free -h
</span></span></code></pre></div><h2 id="å®‰è£…å¹¶ç”Ÿæˆè¯ä¹¦">å®‰è£…å¹¶ç”Ÿæˆè¯ä¹¦</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl https://get.acme.sh <span class="p">|</span> sh -s <span class="nv">email</span><span class="o">=</span>czj.june@gmail.com
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">.acme.sh/acme.sh --issue --server letsencrypt --dns dns_aws -d chensoul.com -d <span class="s1">&#39;*.chensoul.com&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">.acme.sh/acme.sh --installcert -d chensoul.com -d *.chensoul.com  --cert-file /usr/local/nginx/ssl/chensoul.com.cer --key-file /usr/local/nginx/ssl/chensoul.com.key --fullchain-file /usr/local/nginx/ssl/fullchain.cer --ca-file /usr/local/nginx/ssl/ca.cer   --reloadcmd <span class="s2">&#34;sudo nginx -s reload&#34;</span>
</span></span></code></pre></div><h2 id="docker-å®‰è£…å’Œé…ç½®">Docker å®‰è£…å’Œé…ç½®</h2>
<h3 id="docker-å®‰è£…">Docker å®‰è£…</h3>
<p>å…·ä½“è¿‡ç¨‹å¯ä»¥å‚è€ƒç½‘ä¸Šæ–‡ç« ã€‚</p>
<h3 id="è‡ªå®šä¹‰ç½‘ç»œ">è‡ªå®šä¹‰ç½‘ç»œ</h3>
<p>å‚è€ƒ <a href="https://nginxproxymanager.com/advanced-config/#best-practice-use-a-docker-network">Best Practice: Use a Docker network </a>
ï¼Œåˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ç½‘ç»œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker network create custom
</span></span></code></pre></div><p>æŸ¥çœ‹ docker ç½‘ç»œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">[</span>root@vps ~<span class="o">]</span><span class="c1"># docker network ls</span>
</span></span><span class="line"><span class="cl">NETWORK ID     NAME            DRIVER    SCOPE
</span></span><span class="line"><span class="cl">68f4aeaa57bd   bridge          bridge    <span class="nb">local</span>
</span></span><span class="line"><span class="cl">6a96b9d8617e   custom          bridge    <span class="nb">local</span>
</span></span><span class="line"><span class="cl">4a8679e35f4d   host            host      <span class="nb">local</span>
</span></span><span class="line"><span class="cl">ba21bef23b04   none            null      <span class="nb">local</span>
</span></span></code></pre></div><blockquote>
<p>æ³¨æ„ï¼šbridgeã€hostã€none æ˜¯å†…éƒ¨é¢„å…ˆåˆ›å»ºçš„ç½‘ç»œã€‚</p>
</blockquote>
<p>ç„¶åï¼Œåœ¨å…¶ä»–æœåŠ¡çš„ docker-compose.yml æ–‡ä»¶æ·»åŠ ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">default</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">custom</span><span class="w">
</span></span></span></code></pre></div><p>ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;3&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">pgsql</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">postgres:13</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">always</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">5433</span><span class="p">:</span><span class="m">5432</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">POSTGRES_USER=chenzj</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">POSTGRES_PASSWORD=chenzj@vps2021</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">/data/postgres:/var/lib/postgresql/data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">default</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">custom</span><span class="w">
</span></span></span></code></pre></div><h2 id="æœåŠ¡éƒ¨ç½²">æœåŠ¡éƒ¨ç½²</h2>
<h3 id="postgresql">Postgresql</h3>
<p>1ã€å‚è€ƒ <a href="/posts/2022/08/19/postgresql-install-deploy/">PostgreSqlå®‰è£…å’Œéƒ¨ç½²</a> ï¼Œé€šè¿‡ docker-compose å®‰è£…ï¼Œåˆ›å»º
postgresql.yamlï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;3&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">pgsql</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">postgres:13-alpine</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">pgsql</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">always</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">5432</span><span class="p">:</span><span class="m">5432</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">POSTGRES_USER=postgres</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">POSTGRES_PASSWORD=admin@pg!</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">custom</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">/data/postgres:/var/lib/postgresql/data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">custom</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span></code></pre></div><p>2ã€å¯åŠ¨</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker-compose -f postgresql.yaml up -d
</span></span></code></pre></div><h3 id="rsshub">Rsshub</h3>
<p>ç›´æ¥é€šè¿‡ Docker å®‰è£…è¿è¡Œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker run -d --name rsshub -p 1200:1200 diygod/rsshub
</span></span></code></pre></div><p>é…ç½® nginx ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span> <span class="s">[::]:80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server_name</span> <span class="s">rsshub.chensoul.com</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">return</span> <span class="mi">301</span> <span class="s">https://</span><span class="nv">$host$request_uri</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span>          <span class="mi">443</span> <span class="s">ssl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server_name</span>     <span class="s">rsshub.chensoul.com</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">ssl_certificate</span>      <span class="s">/usr/local/nginx/ssl/fullchain.cer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">ssl_certificate_key</span>  <span class="s">/usr/local/nginx/ssl/chensoul.com.key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">ssl_session_cache</span>    <span class="s">shared:SSL:1m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">ssl_session_timeout</span>  <span class="mi">5m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">ssl_ciphers</span>  <span class="s">HIGH:!aNULL:!MD5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">ssl_prefer_server_ciphers</span>  <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_pass</span> <span class="s">http://127.0.0.1:1200</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="uptime-kuma">Uptime Kuma</h3>
<p>å‚è€ƒ <a href="https://uptime.kuma.pet/">kuma</a>ï¼Œä½¿ç”¨ docker compose éƒ¨ç½²ï¼Œåˆ›å»º uptime.yamlï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;3.3&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">uptime-kuma</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">louislam/uptime-kuma:1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">uptime-kuma</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">~/.uptime-kuma:/app/data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">3001</span><span class="p">:</span><span class="m">3001</span><span class="w">  </span><span class="c"># &lt;Host Port&gt;:&lt;Container Port&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">always</span><span class="w">
</span></span></span></code></pre></div><p>å¯åŠ¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker-compose -f uptime.yaml up -d
</span></span></code></pre></div><p>é…ç½® nginx ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span> <span class="s">[::]:80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server_name</span> <span class="s">uptime.chensoul.com</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">return</span> <span class="mi">301</span> <span class="s">https://</span><span class="nv">$host$request_uri</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span>          <span class="mi">443</span> <span class="s">ssl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server_name</span>     <span class="s">uptime.chensoul.com</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">ssl_certificate</span>      <span class="s">/usr/local/nginx/ssl/fullchain.cer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">ssl_certificate_key</span>  <span class="s">/usr/local/nginx/ssl/chensoul.com.key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">ssl_session_cache</span>    <span class="s">shared:SSL:1m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">ssl_session_timeout</span>  <span class="mi">5m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">ssl_ciphers</span>  <span class="s">HIGH:!aNULL:!MD5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">ssl_prefer_server_ciphers</span>  <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_pass</span> <span class="s">http://127.0.0.1:3001</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	    <span class="kn">proxy_set_header</span>   <span class="s">X-Real-IP</span> <span class="nv">$remote_addr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_set_header</span>   <span class="s">X-Forwarded-For</span> <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_set_header</span>   <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_set_header</span>   <span class="s">Upgrade</span> <span class="nv">$http_upgrade</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_set_header</span>   <span class="s">Connection</span> <span class="s">&#34;upgrade&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>å‡çº§</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker compose -f uptime.yaml down 
</span></span><span class="line"><span class="cl">docker pull louislam/uptime-kuma:1
</span></span><span class="line"><span class="cl">docker-compose -f uptime.yaml up -d
</span></span></code></pre></div><h3 id="umami">Umami</h3>
<p>å‚è€ƒ <a href="https://github.com/umami-software/umami/blob/master/docker-compose.yml">umami docker-compose.yml</a> ï¼Œä½¿ç”¨ docker é•œåƒ
umami:postgresql-latest æ¥å®‰è£… umamiã€‚</p>
<p>1ã€åœ¨ pqsql å®¹å™¨åˆ›å»º umami æ•°æ®åº“å’Œç”¨æˆ·ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker <span class="nb">exec</span> -it pgsql psql -U postgres -c <span class="s2">&#34;CREATE USER umami WITH PASSWORD &#39;umami@pg&#39;;&#34;</span>
</span></span><span class="line"><span class="cl">docker <span class="nb">exec</span> -it pgsql psql -U postgres -c <span class="s2">&#34;CREATE DATABASE umami owner=umami;&#34;</span>
</span></span><span class="line"><span class="cl">docker <span class="nb">exec</span> -it pgsql psql -U postgres -c <span class="s2">&#34;GRANT ALL privileges ON DATABASE umami TO umami;&#34;</span>
</span></span></code></pre></div><p>ç„¶åï¼Œåˆå§‹åŒ–æ•° umami æ•°æ®ã€‚å…ˆè¿›å…¥å®¹å™¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">docker exec -it pgsql bash
</span></span></code></pre></div><p>è¿›å…¥ umami æ•°æ®åº“ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">psql -U umami -d umami
</span></span><span class="line"><span class="cl"><span class="nv">umami</span><span class="o">=</span>&gt;
</span></span></code></pre></div><p>æ‰§è¡Œ <a href="https://github.com/umami-software/umami/blob/master/sql/schema.postgresql.sql"><strong>schema.postgresql.sql</strong></a> æ–‡ä»¶å†…å®¹ã€‚</p>
<p>2ã€é€šè¿‡ docker-compose å®‰è£…ï¼Œåˆ›å»º umami.yamlï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;3&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">umami</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">ghcr.io/umami-software/umami:postgresql-latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">umami</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;3000:3000&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">DATABASE_URL</span><span class="p">:</span><span class="w"> </span><span class="l">postgresql://umami:umami@pg@pgsql:5432/umami</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">DATABASE_TYPE</span><span class="p">:</span><span class="w"> </span><span class="l">postgresql</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">HASH_SALT</span><span class="p">:</span><span class="w"> </span><span class="l">vps@2023</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">custom</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">always</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">custom</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span></code></pre></div><p>å¯åŠ¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker-compose -f umami.yaml up -d
</span></span></code></pre></div><p>3ã€è®¾ç½®è‡ªå®šä¹‰åŸŸå</p>
<p>umami.chensoul.com</p>
<p>4ã€é…ç½® nginx</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span> <span class="s">[::]:80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server_name</span> <span class="s">umami.chensoul.com</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">return</span> <span class="mi">301</span> <span class="s">https://</span><span class="nv">$host$request_uri</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span>          <span class="mi">443</span> <span class="s">ssl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server_name</span>     <span class="s">umami.chensoul.com</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">ssl_certificate</span>      <span class="s">/usr/local/nginx/ssl/fullchain.cer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">ssl_certificate_key</span>  <span class="s">/usr/local/nginx/ssl/chensoul.com.key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">ssl_session_cache</span>    <span class="s">shared:SSL:1m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">ssl_session_timeout</span>  <span class="mi">5m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">ssl_ciphers</span>  <span class="s">HIGH:!aNULL:!MD5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">ssl_prefer_server_ciphers</span>  <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_pass</span> <span class="s">http://127.0.0.1:3000</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>5ã€æ·»åŠ ç½‘ç«™</p>
<p>è®¿é—® <a href="https://umami.chensoul.com/">https://umami.chensoul.com/</a>ï¼Œé»˜è®¤ç”¨æˆ·åå’Œå¯†ç ä¸º admin/umamiã€‚ç™»é™†ä¹‹åï¼Œä¿®æ”¹å¯†ç ï¼Œå¹¶æ·»åŠ ç½‘ç«™ã€‚</p>
<p>6ã€å‡çº§</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker compose -f umami.yaml down 
</span></span><span class="line"><span class="cl">docker pull ghcr.io/umami-software/umami:postgresql-latest
</span></span><span class="line"><span class="cl">docker-compose -f umami.yaml up -d
</span></span></code></pre></div><h3 id="cusdis">Cusdis</h3>
<blockquote>
<p>VPS IP å¯èƒ½è¢«å¢™ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ä¸‰æ–¹äº‘æœåŠ¡éƒ¨ç½²ï¼Œå…·ä½“å‚è€ƒ<a href="https://www.pseudoyu.com/zh/2022/05/24/free_and_lightweight_blog_comment_system_using_cusdis_and_railway/">è½»é‡çº§å¼€æºå…è´¹åšå®¢è¯„è®ºç³»ç»Ÿè§£å†³æ–¹æ¡ˆ ï¼ˆCusdis + Railwayï¼‰</a></p>
</blockquote>
<p>1ã€åœ¨ pqsql å®¹å™¨åˆ›å»º cusdis æ•°æ®åº“å’Œç”¨æˆ·ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker <span class="nb">exec</span> -it pgsql psql -U postgres -c <span class="s2">&#34;CREATE USER cusdis WITH PASSWORD &#39;cusdis@pg&#39;;&#34;</span>
</span></span><span class="line"><span class="cl">docker <span class="nb">exec</span> -it pgsql psql -U postgres -c <span class="s2">&#34;CREATE DATABASE cusdis owner=cusdis;&#34;</span>
</span></span><span class="line"><span class="cl">docker <span class="nb">exec</span> -it pgsql psql -U postgres -c <span class="s2">&#34;GRANT ALL privileges ON DATABASE cusdis TO cusdis;&#34;</span>
</span></span></code></pre></div><p>2ã€é€šè¿‡ docker-compose å®‰è£…ï¼Œåˆ›å»º cusdis.yamlï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;3&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">cusdis</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">djyde/cusdis:latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">cusdis</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;3010:3000&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">USERNAME=admin</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">PASSWORD=cusdis</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">JWT_SECRET=vps@2023</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">NEXTAUTH_URL=https://cusdis.chensoul.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">HOST=https://cusdis.chensoul.com</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">DB_TYPE=pgsql</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">DB_URL=postgresql://cusdis:cusdis@pg@pgsql:5432/cusdis</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">custom</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">always</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">custom</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span></code></pre></div><p>ä»¥ä¸‹é…ç½®ä¸º EMAIL é…ç½®å¯é€‰ï¼Œä¸‹é¢æ˜¯ä½¿ç”¨ <a href="https://cusdis.com/doc#/features/notification?id=gmail">Gmail</a>
è¿›è¡Œé…ç½®ï¼Œéœ€è¦é¦–å…ˆå¼€å¯ä¸¤é˜¶æ®µéªŒè¯å¹¶åˆ›å»ºä¸€ä¸ªåº”ç”¨å¯†ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-properties" data-lang="properties"><span class="line"><span class="cl"><span class="na">SMTP_HOST</span><span class="o">=</span><span class="s">smtp.gmail.com</span>
</span></span><span class="line"><span class="cl"><span class="na">SMTP_PORT</span><span class="o">=</span><span class="s">465</span>
</span></span><span class="line"><span class="cl"><span class="na">SMTP_SECURE</span><span class="o">=</span><span class="s">true</span>
</span></span><span class="line"><span class="cl"><span class="na">SMTP_USER</span><span class="o">=</span><span class="s">your gmail email</span>
</span></span><span class="line"><span class="cl"><span class="na">SMTP_PASSWORD</span><span class="o">=</span><span class="s">&lt;app password&gt;</span>
</span></span><span class="line"><span class="cl"><span class="na">SMTP_SENDER</span><span class="o">=</span><span class="s">your gmail email</span>
</span></span></code></pre></div><p>3ã€å¯åŠ¨</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker-compose -f cusdis.yaml up -d
</span></span></code></pre></div><p>4ã€é…ç½® nginx</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span> <span class="s">[::]:80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server_name</span> <span class="s">cusdis.chensoul.com</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">return</span> <span class="mi">301</span> <span class="s">https://</span><span class="nv">$host$request_uri</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span>          <span class="mi">443</span> <span class="s">ssl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server_name</span>     <span class="s">cusdis.chensoul.com</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">ssl_certificate</span>      <span class="s">/usr/local/nginx/ssl/fullchain.cer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">ssl_certificate_key</span>  <span class="s">/usr/local/nginx/ssl/chensoul.com.key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">ssl_session_cache</span>    <span class="s">shared:SSL:1m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">ssl_session_timeout</span>  <span class="mi">5m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">ssl_ciphers</span>  <span class="s">HIGH:!aNULL:!MD5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">ssl_prefer_server_ciphers</span>  <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_pass</span> <span class="s">http://127.0.0.1:3010</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	    <span class="kn">proxy_pass_header</span> <span class="s">Authorization</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	    <span class="kn">proxy_pass_header</span> <span class="s">WWW-Authenticate</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_set_header</span> <span class="s">X-Real-IP</span> <span class="nv">$remote_addr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_set_header</span> <span class="s">X-Forwarded-For</span> <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kn">if</span> <span class="s">(</span><span class="nv">$uri</span> <span class="p">=</span> <span class="s">&#39;/js/iframe.umd.js&#39;)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        	<span class="kn">add_header</span> <span class="s">&#39;Access-Control-Allow-Origin&#39;</span> <span class="s">&#39;*&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        	<span class="c1">#add_header &#39;Access-Control-Allow-Origin&#39; &#39;http://localhost:1313&#39;;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    	<span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>5ã€éƒ¨ç½²ä¸€ä¸ª Telegram æœºå™¨äººï¼Œå‚è€ƒ <a href="https://cusdis.chensoul.com/doc#/advanced/webhook?id=official-telegram-bot">Official Telegram bot</a>ã€‚</p>
<p>6ã€å‡çº§</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker compose -f cusdis.yaml down 
</span></span><span class="line"><span class="cl">docker pull djyde/cusdis:latest
</span></span><span class="line"><span class="cl">docker-compose -f cusdis.yaml up -d
</span></span></code></pre></div><h3 id="memos">memos</h3>
<p>é€šè¿‡ docker-compose å®‰è£…ï¼Œåˆ›å»º memos.yamlï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;3.0&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">memos</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">neosmemo/memos:latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">memos</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">~/.memos/:/var/opt/memos</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">5230</span><span class="p">:</span><span class="m">5230</span><span class="w">
</span></span></span></code></pre></div><p>å¯åŠ¨</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker-compose -f memos.yaml up -d
</span></span></code></pre></div><p>é…ç½® nginx</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span> <span class="s">[::]:80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server_name</span> <span class="s">memos.chensoul.com</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">return</span> <span class="mi">301</span> <span class="s">https://</span><span class="nv">$host$request_uri</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span>          <span class="mi">443</span> <span class="s">ssl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server_name</span>     <span class="s">memos.chensoul.com</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">ssl_certificate</span>      <span class="s">/usr/local/nginx/ssl/fullchain.cer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">ssl_certificate_key</span>  <span class="s">/usr/local/nginx/ssl/chensoul.com.key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">ssl_session_cache</span>    <span class="s">shared:SSL:1m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">ssl_session_timeout</span>  <span class="mi">5m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">ssl_ciphers</span>  <span class="s">HIGH:!aNULL:!MD5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">ssl_prefer_server_ciphers</span>  <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_pass</span> <span class="s">http://127.0.0.1:5230</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>å‡çº§</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker compose -f memos.yaml down 
</span></span><span class="line"><span class="cl">docker pull neosmemo/memos:latest
</span></span><span class="line"><span class="cl">docker-compose -f memos.yaml up -d
</span></span></code></pre></div><h3 id="n8n">n8n</h3>
<p>1ã€åœ¨ pqsql å®¹å™¨åˆ›å»º n8n æ•°æ®åº“å’Œç”¨æˆ·ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker <span class="nb">exec</span> -it pgsql psql -U postgres -c <span class="s2">&#34;CREATE USER n8n WITH PASSWORD &#39;n8n@pg&#39;;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">docker <span class="nb">exec</span> -it pgsql psql -U postgres -c <span class="s2">&#34;CREATE DATABASE n8n owner=n8n;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">docker <span class="nb">exec</span> -it pgsql psql -U postgres -c <span class="s2">&#34;GRANT ALL privileges ON DATABASE n8n TO n8n;&#34;</span> <span class="p">;</span>
</span></span></code></pre></div><p>2ã€é€šè¿‡ docker-compose å®‰è£…ï¼Œåˆ›å»º n8n.yamlï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;3.8&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">n8n</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">n8nio/n8n</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">n8n</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">always</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">DB_TYPE=postgresdb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">DB_POSTGRESDB_HOST=pgsql</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">DB_POSTGRESDB_PORT=5432</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">DB_POSTGRESDB_DATABASE=n8n</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">DB_POSTGRESDB_USER=n8n</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">DB_POSTGRESDB_PASSWORD=n8n@pg</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">N8N_BASIC_AUTH_ACTIVE=true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">N8N_BASIC_AUTH_USER=admin</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">N8N_BASIC_AUTH_PASSWORD=chenzj</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">TZ=&#34;Asia/Shanghai&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">WEBHOOK_URL=https://n8n.chensoul.com/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">5678</span><span class="p">:</span><span class="m">5678</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">/data/n8n:/home/node/.n8n</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l">/bin/sh -c &#34;n8n start --tunnel&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">custom</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">networks</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">custom</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span></code></pre></div><p>3ã€å¯åŠ¨</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker-compose -f n8n.yaml up -d
</span></span></code></pre></div><p>4ã€è®¾ç½® nginx è½¬å‘</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_pass</span> <span class="s">http://127.0.0.1:5678/</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">chunked_transfer_encoding</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_buffering</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_cache</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">access_log</span> <span class="s">/var/log/nginx/forward.log</span> <span class="s">combined</span> <span class="s">buffer=128k</span> <span class="s">flush=5s</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>è¿™é‡Œé¢çš„è½¬å‘é…ç½®ä¸å¯¹çš„è¯ï¼Œä¼šå¯¼è‡´ç›´æ¥è®¿é—® 5678 ç«¯å£æ­£å¸¸ï¼Œä½†æ˜¯è®¿é—® nginx çš„è¯ï¼Œworkflow ä¼šä¸€ç›´å¤„äºæ‰§è¡Œã€‚</p>
<p>5ã€æ·»åŠ  workflow</p>
<p>å‚è€ƒè¿™ç¯‡æ–‡ç«  <a href="http://stiles.cc/archives/237/">http://stiles.cc/archives/237/</a> ï¼Œç›®å‰æˆ‘é…ç½®äº†ä»¥ä¸‹ workflowsï¼Œå®ç°äº† githubã€doubanã€rssã€memos åŒæ­¥åˆ° Telegramã€‚</p>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/my-n8n-workflows.png" alt="my-n8n-workflows"  />
</p>
<p>6ã€å‡çº§</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker compose -f n8n.yaml down 
</span></span><span class="line"><span class="cl">docker pull n8nio/n8n
</span></span><span class="line"><span class="cl">docker-compose -f n8n.yaml up -d
</span></span></code></pre></div><h3 id="plausible">plausible</h3>
<p>1ã€ä¸‹è½½ä»£ç </p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ curl -L https://github.com/plausible/hosting/archive/master.tar.gz <span class="p">|</span> tar -xz
</span></span><span class="line"><span class="cl">$ <span class="nb">cd</span> hosting-master
</span></span></code></pre></div><p>2ã€æ›´æ–°é…ç½®æ–‡ä»¶ plausible-conf.env</p>
<p>ç”Ÿæˆä¸€ä¸ªéšæœºå­—ç¬¦ä¸²ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ openssl rand -base64 <span class="m">64</span> <span class="p">|</span> tr -d <span class="s1">&#39;\n&#39;</span> <span class="p">;</span> <span class="nb">echo</span>
</span></span></code></pre></div><p>ä¿®æ”¹ plausible-conf.envï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">BASE_URL</span><span class="o">=</span>https://plausible.chensoul.com
</span></span><span class="line"><span class="cl"><span class="nv">SECRET_KEY_BASE</span><span class="o">=</span>ywewRup6H0pT1TK+qIPwdRdOYNixC/GAr5vy2IoTvzNJygD3Z7rPgQI6v1c/tUV/SsJQYxsfZ60yrn6kMiDxAA<span class="o">==</span>
</span></span></code></pre></div><p>3ã€è®¾ç½®åå‘ä»£ç†</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-conf" data-lang="conf"><span class="line"><span class="cl"><span class="nv">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">listen</span> <span class="nv">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">listen</span> <span class="err">[::]:</span><span class="nv">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">server_name</span> <span class="nv">plausible.chensoul.com</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">return</span> <span class="nv">301</span> <span class="nv">https</span><span class="err">://$</span><span class="kt">host</span><span class="err">$</span><span class="nv">request_uri</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">listen</span>          <span class="nv">443</span> <span class="nv">ssl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">server_name</span>     <span class="nv">plausible.chensoul.com</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">ssl_certificate</span>      <span class="err">/</span><span class="nv">usr</span><span class="err">/</span><span class="nv">local</span><span class="err">/</span><span class="nv">nginx</span><span class="err">/</span><span class="nv">ssl</span><span class="err">/</span><span class="nv">fullchain.cer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">ssl_certificate_key</span>  <span class="err">/</span><span class="nv">usr</span><span class="err">/</span><span class="nv">local</span><span class="err">/</span><span class="nv">nginx</span><span class="err">/</span><span class="nv">ssl</span><span class="err">/</span><span class="nv">chensoul.com.key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">ssl_session_cache</span>    <span class="nv">shared</span><span class="err">:</span><span class="nv">SSL</span><span class="err">:</span><span class="nv">1m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">ssl_session_timeout</span>  <span class="nv">5m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">ssl_ciphers</span>  <span class="nv">HIGH</span><span class="err">:!</span><span class="nv">aNULL</span><span class="err">:!</span><span class="nv">MD5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">ssl_prefer_server_ciphers</span>  <span class="kc">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">location</span> <span class="err">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">proxy_pass</span> <span class="nv">http</span><span class="err">://</span><span class="mf">127.0.0.1</span><span class="err">:</span><span class="nv">8000</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	    <span class="nv">proxy_set_header</span>   <span class="nv">X-Real-IP</span> <span class="err">$</span><span class="nv">remote_addr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">proxy_set_header</span>   <span class="nv">X-Forwarded-For</span> <span class="err">$</span><span class="nv">proxy_add_x_forwarded_for</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">proxy_set_header</span>   <span class="nv">Host</span> <span class="err">$</span><span class="kt">host</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	    <span class="nv">proxy_http_version</span> <span class="nv">1.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">proxy_set_header</span>   <span class="nv">Upgrade</span> <span class="err">$</span><span class="nv">http_upgrade</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">proxy_set_header</span>   <span class="nv">Connection</span> <span class="s">&#34;upgrade&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>4ã€å¯åŠ¨æœåŠ¡</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker compose up -d
</span></span></code></pre></div><p>5ã€å‡çº§</p>
<p>Docker Compose çš„æ›´æ–°æ¯”è¾ƒç®€å•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker compose down 
</span></span><span class="line"><span class="cl">docker compose pull plausible
</span></span><span class="line"><span class="cl">docker compose up -d
</span></span></code></pre></div><p>6ã€è®¿é—® postgres æ•°æ®åº“</p>
<p>ç¬¬ä¸€æ¬¡ç™»å½•æ—¶å¯èƒ½ä¼šè¦æ±‚éªŒè¯é‚®ç®±åœ°å€ï¼Œå¦‚æœå‰é¢æ²¡æœ‰é…ç½® SMTPï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤è®¤è¯æ‰€æœ‰å½“å‰ç”¨æˆ·ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker compose <span class="nb">exec</span> plausible_db psql -U postgres -d plausible_db -c <span class="s2">&#34;UPDATE users SET email_verified = true;&#34;</span>
</span></span></code></pre></div><p>è¿›å…¥ plausible_db æ•°æ®åº“ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">docker compose <span class="nb">exec</span> plausible_db psql -U postgres -d plausible_db
</span></span></code></pre></div><p>7ã€åšå®¢æ·»åŠ ç»Ÿè®¡ä»£ç </p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">defer</span> <span class="nx">data</span><span class="o">-</span><span class="nx">domain</span><span class="o">=</span><span class="s2">&#34;blog.chensoul.com&#34;</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&#34;https://plausible.chensoul.com/js/script.js&#34;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span></span></code></pre></div><p>8ã€é…ç½® dns</p>
<p>åœ¨ dns æœåŠ¡å•†æ·»åŠ  A è®°å½• plausibleï¼Œç¨ç­‰ä¸€ä¸‹ï¼Œè®¿é—® <a href="https://plausible.chensoul.com/">https://plausible.chensoul.com/</a></p>
<p>å‚è€ƒæ–‡ç« ï¼š</p>
<ul>
<li><a href="https://atpx.com/blog/docker-plausible-web-analytics/">ä½¿ç”¨ Plausible è‡ªå»ºç½‘ç«™æµé‡ç»Ÿè®¡åˆ†æå·¥å…·</a></li>
</ul>
]]></content:encoded>
    </item>
    
    <item>
      <title>å‘¨æŠ¥-3ï½œåšå®¢å®šåˆ¶ã€VPSéƒ¨ç½²æœåŠ¡</title>
      <link>https://blog.chensoul.com/posts/2023/01/25/weekly_review_3/</link>
      <pubDate>Wed, 25 Jan 2023 09:47:03 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/01/25/weekly_review_3/</guid>
      <description>å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-01-16 åˆ° 2023-01-22 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚ è¿™æ˜¯è¿‡å¹´å‰çš„æœ€åä¸€å‘¨ï¼Œä¸Šäº†ä¸‰å¤©ç­ï¼Œè¯·äº†ä¸¤å¤©å‡å›å»</description>
      <content:encoded><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p>æœ¬ç¯‡æ˜¯å¯¹ <code>2023-01-16</code> åˆ° <code>2023-01-22</code> è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº <a href="https://blog.chensoul.com/">åšå®¢</a>ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚</p>
<p>è¿™æ˜¯è¿‡å¹´å‰çš„æœ€åä¸€å‘¨ï¼Œä¸Šäº†ä¸‰å¤©ç­ï¼Œè¯·äº†ä¸¤å¤©å‡å›å»å‡†å¤‡å¹´è´§ã€å»äº²æˆšå®¶åƒå¹´é¥­ã€‚è¶æ”¾å‡ä¹‹å‰ï¼Œç»§ç»­å¯¹åšå®¢åšäº†ä¸€äº›å®šåˆ¶ï¼Œä¹Ÿåœ¨æˆ‘çš„ VPS ä¸Šé€šè¿‡ Docker éƒ¨ç½²äº†ä¸€äº›æœåŠ¡ã€‚</p>
<h2 id="å®šåˆ¶åšå®¢">å®šåˆ¶åšå®¢</h2>
<p>åŸºäº <a href="https://www.pseudoyu.com/">pseudoyu</a> çš„åšå®¢å’Œä¸»é¢˜å®šåˆ¶åšå®¢ï¼Œå‘ç°å¹¶ä¿®å¤äº†bugï¼Œè¿˜åšäº†ä¸€äº›æ”¹è¿›ï¼Œå¹¶åœ¨ä»–çš„ github æäº¤ <a href="https://github.com/pseudoyu/pseudoyu/issues/2">issue</a> å’Œ merge requestã€‚</p>
<img src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/github-issue-build-aboutme-py.png" alt="github-issue-build-aboutme-py" style="width: 80%"/>
<p>æ¥ç€åœ¨ä»–åšå®¢ä¸»é¡µç•™è¨€ï¼Œå‡ ä¸ªæ¥å›ä¸‹æ¥ï¼Œæ”¶è·ä¸å°‘ã€‚ä¸€æ˜¯è§£å†³äº†æˆ‘æå‡ºçš„é—®é¢˜ï¼ŒäºŒæ˜¯ç»™æˆ‘åˆ†äº«äº†ä¸€ä¸ªæ¬ç“¦å·¥çš„ the plan ä¼˜æƒ ç ã€‚è¿™æ—¶å€™å»çœ‹äº†ä¸‹æˆ‘åŸæ¥çš„ vps åˆšå¥½è¿˜æœ‰ä¸€å¤©è¦åˆ°æœŸï¼Œå°±ç«‹å³èŠ±äº†92 ç¾å…ƒï¼ˆåŸä»·æ˜¯ 99 ç¾å…ƒï¼‰è´­ä¹°äº†ä¸€å° 2G å†…å­˜æ‰˜ç®¡åœ¨é¦™æ¸¯çš„æœåŠ¡å™¨ã€‚</p>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/vps-main-controlls.png" alt="vps-main-controlls"  />
</p>
<p>ç¼˜åˆ†å°±æ˜¯è¿™ä¹ˆå¥‡å¦™ï¼Œå¦‚æœæˆ‘ä¸ä¸»åŠ¨å’Œè¿™ä¸ªåšä¸»è”ç³»ï¼Œå°±ä¸ä¼šçŸ¥é“æ¬ç“¦å·¥è¿˜æœ‰è¿™ä¸ªä¼˜æƒ ï¼Œå°±ä¸ä¼šå¸®åŠ©æˆ‘è§£å†³äº†åšå®¢å®šåˆ¶è¿‡ç¨‹ä¸­é‡åˆ°çš„ç–‘æƒ‘ã€‚</p>
<blockquote>
<p>å½“ä½ æƒ³è¦ä»€çš„æ—¶å€™ï¼Œå…ˆç»™å‡ºå»ï¼Œä½ å°±ä¼šæ”¶è·æ›´ã€‚æœ‰èˆæ‰æœ‰å¾—ã€‚</p>
</blockquote>
<h2 id="åšå®¢ä¸ªäººä»‹ç»">åšå®¢ä¸ªäººä»‹ç»</h2>
<p>æˆ‘çš„åšå®¢æºæ–‡ä»¶æ‰˜ç®¡åœ¨ <a href="https://github.com/chensoul/chensoul.github.io">gihub</a>ï¼Œåœ¨è¿™ä¸ªä»“åº“å¯ä»¥çœ‹åˆ°æˆ‘çš„ä¸€äº›ä¸ªäººä»‹ç»ï¼Œå½“ç„¶ï¼Œæˆ‘çš„åšå®¢ä¹Ÿæœ‰ä¸ªäººä»‹ç»ï¼ˆåœ¨<a href="https://blog.chensoul.com/about/">å…³äº</a>é¡µé¢ï¼‰ï¼Œå¦‚æœä½ ä»”ç»†è§‚å¯Ÿï¼Œå¯ä»¥å‘ç°ä»–ä»¬åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œè¿™ä¸ªæ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ</p>
<img src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/chensoul-github-io-readme.png" alt="chensoul-github-io-readme" style="width: 80%"/>
<p>é¦–å…ˆï¼Œgithub é‡Œé¢å¯ä»¥åˆ›å»ºä¸€ä¸ªä»¥ github è´¦å·ä¸ºåç§°çš„ä»“åº“ï¼Œç„¶åç¼–è¾‘å¥½ README.md æ–‡ä»¶ï¼ŒREADME.md æ–‡ä»¶å†…å®¹å°±ä¼šæ¸²æŸ“æˆ html æ˜¾ç¤ºåˆ°ä¸ªäºº github ä¸»é¡µã€‚ä¾‹å¦‚ï¼Œæˆ‘çš„ github ä¸»é¡µæ˜¯ <a href="https://github.com/chensoul">https://github.com/chensoul</a>ï¼Œæˆ‘çš„ä¸ªäººä»“åº“åœ°å€ä¸º <a href="https://github.com/chensoul/chensoul">https://github.com/chensoul/chensoul</a>ï¼Œè¿™ä¸ªä»“åº“æ˜¯é€šè¿‡ github actions æ¥æ„å»º README.mdï¼Œæ„å»ºæ–‡ä»¶æŸ¥çœ‹ä»“åº“çš„ workflows æ–‡ä»¶ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼š</p>
<ul>
<li>build.ymlï¼šå‘¨æœŸæ€§çš„è°ƒç”¨ <a href="https://github.com/chensoul/chensoul/blob/main/build_readme.py">build_readme.py</a> æ¥ç”Ÿæˆ README.md æ–‡ä»¶ï¼ˆåŒ…æ‹¬ï¼šè·å–æœ€è¿‘ 5 ç¯‡åšå®¢æ–‡ç« ã€æˆ–è€… è±†ç“£ä¸Šæœ€è¿‘ 5 ä¸ªç”µå½±ä¹¦ç±åŠ¨æ€ã€è·å– github ä¸Šå‘å¸ƒçš„é¡¹ç›®ã€æ˜¾ç¤º wakatime æŠ¥è¡¨ï¼‰</li>
<li>waketime.ymlï¼šç”Ÿæˆ wakatime-charts</li>
</ul>
<p>å½“ README.md ç”Ÿæˆä¹‹åï¼Œåªéœ€è¦å°†è¯¥æ–‡ä»¶å†…å®¹åŒæ­¥åˆ°åšå®¢çš„ about.md æ–‡ä»¶å³å¯ã€‚æ€ä¹ˆå®ç°å‘¢ï¼Ÿå‚è€ƒåšå®¢æºæ–‡ä»¶é‡Œçš„ <a href="https://github.com/chensoul/chensoul.github.io/blob/main/build_about.py">build_about.py</a>ã€‚è¿™æ ·å°±å¯ä»¥å®ç°ä¸€ä¸ªè‡ªæˆ‘ä»‹ç»åŒæ­¥åˆ°å¤šä¸ªå¹³å°ï¼ˆé™¤äº†åšå®¢ï¼Œè¿˜å¯ä»¥é€šè¿‡ api æ¥å£åŒæ­¥åˆ°è¯­é›€ç­‰å…¶ä»–å¹³å°ï¼‰ã€‚</p>
<h2 id="vps-ä¸ŠæœåŠ¡éƒ¨ç½²">vps ä¸ŠæœåŠ¡éƒ¨ç½²</h2>
<p>è´­ä¹°äº†æ–°çš„ VPS ä¹‹åï¼Œå°±å°†åŸæ¥çš„ VPS å¯¼å‡ºé•œåƒï¼Œç„¶åå¯¼å…¥åˆ°æ–°çš„ VPSï¼Œæœ€åå†å®‰è£…äº†ä»¥ä¸‹æœåŠ¡ï¼š</p>
<ul>
<li><a href="https://github.com/indes/flowerss-bot">flowerss-bot</a>ï¼šä¸€ä¸ªæ”¯æŒåº”ç”¨å†…é˜…è¯»çš„ Telegram RSS Botã€‚</li>
<li><a href="https://n8n.io/">n8n</a>ï¼šä¸€æ¬¾å¼€æºçš„è‡ªåŠ¨å·¥ä½œæµæœåŠ¡ï¼Œç±»ä¼¼ IFTTTã€Zapierï¼Œå¯ä»¥äº’è”äº’é€šåŒ…æ‹¬ GitHubã€Dropboxã€Googleã€NextCLoudã€RSSã€Slackã€Telegram åœ¨å†…çš„å‡ åæ¬¾åœ¨çº¿æœåŠ¡ã€‚</li>
<li>memosï¼šä¸€ä¸ªå¼€æºä¸”å…è´¹çš„è‡ªæ‰˜ç®¡çŸ¥è¯†åº“</li>
<li>cusdisï¼šä¸€ä¸ªç•Œé¢æ¸…çˆ½ã€æ³¨é‡éšç§çš„è½»é‡çº§ (~5kb gzip) è¯„è®ºç³»ç»Ÿï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä¸ Reactã€Vue æˆ–å…¶ä»–åšå®¢ç³»ç»Ÿç»“åˆï¼Œå¹¶ä¸”è¿˜æä¾›äº†ä¸€ä¸ªåå°æ¥ç®¡ç†æ‰€æœ‰çš„è¯„è®º</li>
<li>umamiï¼šä¸€ä¸ªç®€å•æ˜“ç”¨ã€è‡ªæ‰˜ç®¡çš„å¼€æºç½‘ç«™è®¿é—®æµé‡<em>ç»Ÿè®¡</em>åˆ†æå·¥å…·</li>
<li>pgsql</li>
<li>uptime-kumaï¼šä¸€ä¸ªå¼€æºå…è´¹çš„ç›‘æ§å·¥å…·</li>
<li>rsshubï¼šä¸€ä¸ªå¼€æºã€ç®€å•æ˜“ç”¨ã€æ˜“äºæ‰©å±•çš„RSS ç”Ÿæˆå™¨ï¼Œå¯ä»¥ç»™ä»»ä½•å¥‡å¥‡æ€ªæ€ªçš„å†…å®¹ç”ŸæˆRSS è®¢é˜…æº</li>
</ul>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/vps-docker-service.png" alt="vps-docker-service"  />
</p>
<p>é€šè¿‡ Docker éƒ¨ç½²è¿™äº›æœåŠ¡éå¸¸ç®€å•ï¼Œä¸»è¦æ˜¯éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼šå°†è¿™äº›æœåŠ¡éƒ¨ç½²åˆ°åŒä¸€ä¸ªç½‘è·¯ï¼Œè¿™æ ·å„ä¸ªæœåŠ¡ä¹‹é—´å¯ä»¥äº’ç›¸é€šä¿¡ã€‚æ¯”å¦‚ï¼šå¾ˆå¤šæœåŠ¡éƒ½éœ€è¦ä¾èµ–æ•°æ®åº“ postgresqlï¼Œå¯ä»¥ä½¿ç”¨ docker-compose æ¥ç¼–æ’æœåŠ¡ã€‚å®‰è£…éƒ¨ç½²è¿‡ç¨‹å‚è€ƒï¼š<a href="/posts/2023/01/25/notes-about-deploy-services-in-vps/">æˆ‘çš„VPSæœåŠ¡éƒ¨ç½²è®°å½•</a></p>
<p>ä»¥ä¸Šã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>å‘¨æŠ¥-2ï½œåšå®¢é‡æ„</title>
      <link>https://blog.chensoul.com/posts/2023/01/15/weekly_review_2/</link>
      <pubDate>Sun, 15 Jan 2023 09:47:03 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/01/15/weekly_review_2/</guid>
      <description>å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-01-09 åˆ° 2023-01-15 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚ è¿™æ˜¯å¹´å‰å€’æ•°ç¬¬äºŒä¸ªå·¥ä½œå‘¨ï¼Œå·¥ä½œä¸Šä¸»è¦æ˜¯å®Œæˆé¡¹ç›®ä¸€</description>
      <content:encoded><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p>æœ¬ç¯‡æ˜¯å¯¹ <code>2023-01-09</code> åˆ° <code>2023-01-15</code> è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº <a href="https://blog.chensoul.com/">åšå®¢</a>ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚</p>
<p>è¿™æ˜¯å¹´å‰å€’æ•°ç¬¬äºŒä¸ªå·¥ä½œå‘¨ï¼Œå·¥ä½œä¸Šä¸»è¦æ˜¯å®Œæˆé¡¹ç›®ä¸€ä¸ªç‰ˆæœ¬çš„æµ‹è¯•å’Œå‘å¸ƒã€‚è¿™ä¸ªåšå®¢ä¸»è¦æ˜¯åˆ†äº«ä¸€äº›æŠ€æœ¯ç›¸å…³ç¬”è®°å’Œä¸ªäººçš„ç”Ÿæ´»è®°å½•ä¸æ€è€ƒï¼Œæ‰€ä»¥ä¸ä¼šæ¶‰åŠå…·ä½“çš„å·¥ä½œå†…å®¹ã€‚</p>
<p>å‘¨ä¸‰æ™šä¸Šæ˜¯éƒ¨é—¨å¹´ä¼šï¼Œé¢†å¯¼æå‡ºäº† 2023 å¹´æ”¶å…¥ 6.2 äº¿çš„ç›®æ ‡ï¼Œæ¯” 2022 å¹´æ”¶å…¥å¢é•¿ 140%ã€‚ä»å…¬å¸é¢†å¯¼å±‚è¿™ä¹è§‚çš„å¹´åº¦è§„åˆ’ï¼Œçœ‹å¾—å‡ºæ¥å…¬å¸çš„å‘å±•å±äºä¸Šå‡è¶‹åŠ¿ï¼ŒåŒæ—¶æ„å‘³ç€ 2023 å¹´åˆæ˜¯å¿™ç¢Œå’Œå‹åŠ›å·¨å¤§çš„ä¸€å¹´ã€‚</p>
<p>å·¥ä½œé—²æš‡ä¹‹ä½™ï¼Œçœ‹åˆ°äº†ä¸€äº›ç‹¬ç«‹å¼€å‘è€…çš„åšå®¢ï¼Œå¹¶å—ä»–ä»¬åšå®¢æ–‡ç« çš„å½±å“ï¼Œç«‹å³å†³å®šé‡æ–°æ£é¼“åšå®¢ã€‚äºæ˜¯ï¼Œåœ¨ä¸€è…”çƒ­æƒ…ä¹‹ä¸‹ï¼ŒèŠ±äº†ä¸‰å¤©æ—¶é—´é‡æ„äº†åšå®¢ï¼Œä¹Ÿå¯¹åšå®¢ä»¥åçš„æ–¹å‘åšäº†ä¸€äº›è§„åˆ’ã€‚</p>
<p>å‘¨æœ«æ˜¯è¿‡å°å¹´ï¼Œå°å¹´ä¼Šå§‹ï¼Œå¹´å‘³æ¸æµ“ã€‚å‘¨å…­æ™šä¸Šï¼Œå ‚å“¥å®¶åƒå¹´é¥­ã€‚å‘¨æ—¥ä¸­åˆï¼Œè‡ªå·±å®¶åƒå¹´é¥­ã€‚è¿™æ˜¯æ–°å©šåç¬¬ä¸€æ¬¡ä¸¤è¾¹çš„å®¶äººä¸€èµ·åƒå¹´é¥­ã€‚è™½ç„¶å¾ˆæ—©å°±ç¡®å®šäº†å¹´é¥­æ—¶é—´å¤§å®¶éƒ½æœ‰æ—¶é—´çš„å‘¨æœ«ã€é¢„å®šäº†å¯ä»¥åä¸‹ 20 å¤šäººçš„å¤§æ¡Œï¼Œä½†è¿˜æ˜¯é—æ†¾äººæ²¡æœ‰åˆ°é½ã€‚</p>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/new-year-dinner-20230115.png" alt="new-year-dinner-20230115"  />
</p>
<h2 id="åšå®¢é‡æ„">åšå®¢é‡æ„</h2>
<h3 id="åšå®¢ä¸»é¢˜">åšå®¢ä¸»é¢˜</h3>
<p>ä»¥å‰çš„åšå®¢ä¸»è¦æ˜¯çº¯ç²¹åˆ†äº«æŠ€æœ¯ï¼Œå¾ˆå°‘æœ‰è‡ªå·±çš„æ€è€ƒï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯ä»£ç æ¯”æ±‰å­—è¦å¤šä¸å°‘ã€‚åšå®¢æ²¡æœ‰åšä¸»çš„æ€è€ƒï¼Œæ— æ³•è®©è¯»è€…è®¤è¯†ã€äº†è§£åšä¸»ï¼Œå¹¶å’Œåšä¸»äº§ç”Ÿæ·±å…¥çš„é“¾æ¥ã€‚è¿™æ ·çš„åšå®¢æ²¡æœ‰çµé­‚ï¼Œå°±ä»…ä»…æ˜¯ä¸€ä¸ªçº¯åˆ†äº«çš„ wikiã€‚</p>
<p>è¿™æ¬¡é‡æ–°å¼€å§‹å†™åšå®¢ä¹‹åï¼Œè§„åˆ’çš„åšå®¢ä¸»é¢˜æ˜¯åˆ†äº«æŠ€æœ¯ã€è®°å½•ç”Ÿæ´»ã€å¯å‘æ€è€ƒã€‚æŠ€æœ¯ä¸Šçš„æ–‡ç« ï¼Œè¦æœ‰æ·±åº¦ï¼›ç”Ÿæ´»çš„ç‚¹æ»´ï¼Œè¦æœ‰å¤ç›˜ï¼›æ€è€ƒçš„å†…å®¹ï¼Œè¦æœ‰å…±é¸£ã€‚</p>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/blog-homepage-den-theme.png" alt="blog-homepage-den-theme"  />
</p>
<h3 id="åšå®¢è§„åˆ’">åšå®¢è§„åˆ’</h3>
<p>ä»¥å‰åšå®¢æ–‡ç« çš„åˆ†ç±»æœ‰ javaã€databaseã€devopsã€webï¼Œåœ¨åˆ äº†ä¸€äº›æ–‡ç« ä¹‹åï¼Œå°†åšå®¢çš„åˆ†ç±»è°ƒæ•´ä¸ºæƒ³æ³•ï¼ˆIdeasï¼‰ã€ç¬”è®°ï¼ˆNotesï¼‰ä¸¤ç±»ï¼Œåé¢å†æ ¹æ®å®é™…æƒ…å†µæ·»åŠ æˆ–è€…è°ƒæ•´åˆ†ç±»ã€‚</p>
<blockquote>
<p>å¥åº·ï¼Œçˆ±æƒ…å’Œä½¿å‘½ï¼ŒæŒ‰ç…§è¿™ä¸ªé¡ºåºï¼Œå…¶å®ƒçš„éƒ½ä¸é‡è¦</p>
</blockquote>
<h3 id="æ–‡ç« é“¾æ¥">æ–‡ç« é“¾æ¥</h3>
<p>ä»¥å‰çš„åšå®¢é“¾æ¥æ ¼å¼æ˜¯ <code>posts/:slug</code>ï¼Œç°åœ¨è°ƒæ•´ä¸º <code>posts/:year/:month/:day/:slug</code>ã€‚å› ä¸ºç°åœ¨åšå®¢åªæœ‰å‡ ç¯‡æ–‡ç« ï¼Œæ‰€ä»¥æš‚æ—¶ä¸æ‰“ç®—åšåŸæœ‰é“¾æ¥è·¯å¾„åˆ°æ–°è·¯å¾„çš„é‡å®šå‘å·¥ä½œã€‚</p>
<h3 id="åšå®¢éƒ¨ç½²">åšå®¢éƒ¨ç½²</h3>
<p>ç›®å‰æœ‰ä¸‰ç§æ–¹æ¡ˆéƒ¨ç½²æ–¹æ¡ˆï¼š</p>
<ul>
<li>github pagesã€‚å›½å†…è®¿é—®é€Ÿåº¦å—å½±å“ã€‚</li>
<li>cloudflare pagesã€‚å¯ä»¥ä½¿ç”¨ cdn åŠ é€Ÿã€‚</li>
<li>Self hostedã€‚éœ€è¦è´­ä¹°äº‘ä¸»æœºå’Œæ‰‹åŠ¨è¿ç»´ã€‚</li>
</ul>
<p>ç›®å‰ï¼Œæ˜¯å€¾å‘äºä½¿ç”¨ç¬¬äºŒç§æ–¹æ¡ˆã€‚æºç ä¿å­˜åˆ° github ä¸Šï¼Œgithub actions ç¼–è¯‘å’Œéƒ¨ç½²é™æ€æ–‡ä»¶åˆ° cf-pages åˆ†æ”¯ï¼Œé€šè¿‡ cloudflare pages é“¾æ¥ github ä»“åº“ã€è‡ªåŠ¨åŒ–éƒ¨ç½²é™æ€æ–‡ä»¶å¹¶è®¾ç½®è‡ªå®šä¹‰åŸŸå <code>blog.chensoul.com</code>ã€‚</p>
<h3 id="å‘å¸ƒæµç¨‹">å‘å¸ƒæµç¨‹</h3>
<p>æœ¬åœ°ç¼–å†™ markdown æ–‡ä»¶ï¼Œå›¾ç‰‡ä¿å­˜åˆ°å…¬æœ‰äº‘ï¼Œé€šè¿‡ git æäº¤åˆ° github ä»“åº“ï¼Œä½¿ç”¨ github actions é€šè¿‡ n8n è‡ªåŠ¨å‘å¸ƒåˆ°å¤šå¹³å°ï¼Œæ¯”å¦‚ï¼šå…¬ä¼—å·ï¼Œè¯­é›€ç­‰ã€‚</p>
<h3 id="å¾…åŠäº‹é¡¹">å¾…åŠäº‹é¡¹</h3>
<p>æœ¬å‘¨å¯¹åšå®¢é‡æ„ï¼Œè®¡åˆ’å®Œæˆä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> åœ¨ä¸ä¿®æ”¹åŸä¸»é¢˜çš„å‰æä¸‹ï¼Œé€šè¿‡ git log è®°å½•å¯¹ä¸»é¢˜çš„æ”¹åŠ¨</li>
<li><input checked="" disabled="" type="checkbox"> æ·»åŠ  <a href="https://cusdis.com/">Cusdis </a>è¯„è®ºç³»ç»Ÿ</li>
<li><input checked="" disabled="" type="checkbox"> æ·»åŠ  <a href="https://umami.is/">Umami</a> ç»Ÿè®¡åˆ†æ</li>
<li><input checked="" disabled="" type="checkbox"> æ·»åŠ  <a href="https://uptime.kuma.pet/">Kuma</a> æœåŠ¡ç›‘æ§</li>
<li><input checked="" disabled="" type="checkbox"> æ·»åŠ æœç´¢ã€å›åˆ°é¡¶éƒ¨åŠŸèƒ½</li>
<li><input checked="" disabled="" type="checkbox"> ä½¿ç”¨ <a href="https://oss.console.aliyun.com/overview">é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨</a> ä½œä¸ºå›¾åºŠ</li>
<li><input disabled="" type="checkbox"> github actions é›†æˆ <a href="https://n8n.io/">n8n</a></li>
<li><input disabled="" type="checkbox"> åŸŸå dns è§£æè¿ç§»åˆ° cloudflare</li>
</ul>
<p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ kuma ç›‘æ§æˆ‘çš„ VPS ä¸Šçš„æœåŠ¡ã€‚</p>
<p><img loading="lazy" src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/chensoul-uptime.png" alt="chensoul-uptime"  />
</p>
<p>ä»¥ä¸Šã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>å‘¨æŠ¥-1ï½œå¼€å§‹å†™å‘¨æŠ¥ã€å†¥æƒ³</title>
      <link>https://blog.chensoul.com/posts/2023/01/08/weekly_review_1/</link>
      <pubDate>Sun, 08 Jan 2023 09:47:03 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2023/01/08/weekly_review_1/</guid>
      <description>å‰è¨€ æœ¬ç¯‡æ˜¯å¯¹ 2023-01-02 åˆ° 2023-01-08 è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº åšå®¢ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚ è¿™æ˜¯ 2023 å¹´çš„ç¬¬ä¸€å‘¨ï¼Œå…ƒæ—¦æ”¾äº†ä¸‰å¤©å‡ä¹‹åï¼Œå°±ç”¨æŠ•å…¥äº†</description>
      <content:encoded><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2>
<p>æœ¬ç¯‡æ˜¯å¯¹ <code>2023-01-02</code> åˆ° <code>2023-01-08</code> è¿™å‘¨ç”Ÿæ´»çš„è®°å½•ä¸æ€è€ƒã€‚é¦–å‘åœ¨æˆ‘çš„ä¸ªäºº <a href="https://blog.chensoul.com/">åšå®¢</a>ï¼Œä½ å¯ä»¥ç§»æ­¥äº†è§£æ›´å¤šæˆ–è€…ç»™æˆ‘ç•™è¨€ã€‚</p>
<p>è¿™æ˜¯ 2023 å¹´çš„ç¬¬ä¸€å‘¨ï¼Œå…ƒæ—¦æ”¾äº†ä¸‰å¤©å‡ä¹‹åï¼Œå°±ç”¨æŠ•å…¥äº†å·¥ä½œä¹‹ä¸­ã€‚å…ƒæ—¦å·²è¿‡ï¼Œè¿‡å¹´å°±æ²¡å¤šè¿œäº†ï¼Œå¾ˆå¤šå…¬å¸ä¹Ÿå¼€å§‹å‡†å¤‡å¹´ä¼šäº†ã€‚å› ä¸ºç–«æƒ…ï¼Œè¿™ä¸ªå¹´æ³¨å®šä¸å¥½è¿‡ã€‚ç°åœ¨ç–«æƒ…æ”¾å¼€ï¼Œä¸çŸ¥é“æœ‰å¤šå°‘å…¬å¸èƒ½å¤Ÿç†¬è¿‡è¿™ä¸ªå¹´ï¼Œè¿›å…¥ç™¾åºŸå¾…å…´çš„èŠ‚å¥ã€‚</p>
<p>æœ€è¿‘æŠŠ rss é˜…è¯»å™¨åˆç”¨èµ·æ¥ï¼Œæ¯å¤©é˜…è¯»è®¢é˜…çš„æœªè¯»æ–‡ç« ï¼Œå…³æ³¨åˆ°å¥½å‡ ä¸ªç‹¬ç«‹å¼€å‘è€…ã€‚ä»–ä»¬æ¯å‘¨éƒ½åœ¨åšæŒå†™åšå®¢ã€åˆ†äº«æŠ€æœ¯æ–‡ç« ã€‚ä»ä»–ä»¬çš„åˆ†äº«é‡Œé¢ï¼Œå¯ä»¥çœ‹åˆ°ä»–ä»¬æœ‰åœ¨åšè‡ªå·±çš„ side projectsï¼Œä¹Ÿæœ‰åœ¨å¼€æºé¡¹ç›®æäº¤ä»£ç ã€‚çœ‹ç€ä»–ä»¬çš„ github ä¸»é¡µæ¯å¤©éƒ½æœ‰æäº¤ä»£ç ï¼Œå†çœ‹çœ‹æˆ‘çš„ github ä¸»é¡µå¾ˆä¹…æ²¡æœ‰æäº¤è¿‡ä»£ç ï¼Œé¡¿æ„Ÿæƒ­æ„§ã€‚ç›®å‰ï¼Œå…¬å¸ä½¿ç”¨çš„æ˜¯è‡ªå»ºçš„ gitlab ä»“åº“æ‰˜ç®¡ä»£ç ï¼Œå¾ˆå¤šä»£ç ä¸æ–¹ä¾¿å…¬å¼€åˆ†äº«ï¼Œè‡ªå·±å¤œå¾ˆå°‘èŠ±æ—¶é—´å†™ä¸€äº›å°é¡¹ç›®å…¬å¼€åˆ†äº«åˆ° githubã€‚å¹²è„†å°±æ¸…ç†ä¸€äº› github é•¿æœŸæ²¡æœ‰ç»´æŠ¤çš„ä»“åº“ï¼Œå–å…³äº†ä¸€äº›å¥½å‹ï¼Œæ›´æ–°äº† github ä¸»é¡µï¼Œæœ€åçœ‹äº†ä¸€ä¸‹ç²‰ä¸è¿˜æœ‰ 574 äººï¼Œç›¸å¯¹è€Œè¨€ä¹Ÿæ˜¯å°‘çš„å¯æ€œğŸ¥ºã€‚</p>
<h2 id="å¼€å§‹å†™å‘¨æŠ¥">å¼€å§‹å†™å‘¨æŠ¥</h2>
<p>å‰æ®µæ—¶é—´ï¼Œå¼€å§‹å°è¯•åœ¨ <a href="https://www.yuque.com/chensoul">è¯­é›€</a> ä¸Šæ¯å¤©å†™æ—¥è®°ï¼Œå†™äº†å‡ å¤©ä¹‹åï¼Œæ²¡æœ‰åšæŒä¸‹æ¥ã€‚</p>
<img src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/yuque-life-note.png" alt="yuque-life-note" style="width: 50%"/>
<p>æ€»ç»“äº†ä¸€ä¸‹ï¼Œæ²¡æœ‰åšæŒä¸‹æ¥çš„åŸå› ä¸»è¦æ˜¯åœ¨äºæ¯å¤©æ²¡æœ‰ç§¯ç´¯è¶³å¤Ÿçš„åˆ†äº«å†…å®¹ï¼Œä¹Ÿå°±æ˜¯è¾“å…¥ä¸å¤Ÿï¼›å¦å¤–ï¼Œè¾“å‡ºä¹‹åçš„åé¦ˆä¸å¤Ÿï¼Œè¿™å’Œè§‚ä¼—æµé‡æœ‰å…³ã€‚ä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œæ›´å–œæ¬¢è‡ªåŠ¨åŒ–å·¥ä½œçš„å¿«æ„Ÿå’Œæ»¡è¶³æ„Ÿã€‚å“Ÿè¿˜æ˜¯æ›´å€¾å‘äºå°†åšå®¢ä»¥ markdown æ–‡ä»¶ä¿å­˜åˆ°æœ¬åœ°æˆ–è€… git ä»“åº“ï¼Œç„¶åé€šè¿‡è‡ªåŠ¨åŒ–è„šæœ¬ç¼–è¯‘éƒ¨ç½²åˆ°å¤šå¹³å°ã€‚åœ¨å…³æ³¨äº†ä¸€äº›ç‹¬ç«‹å¼€å‘è€…çš„åšå®¢ä¹‹åï¼Œæ›´æ˜¯åšå®šäº†è¿™ç§æƒ³æ³•ã€‚äºæ˜¯æœ‰äº†è¿™ç¯‡å†™å‘¨æŠ¥çš„æ–‡ç« ï¼Œä»¥å‘¨ä¸ºå•ä½è®°å½•æ¯ä¸€å‘¨çš„æ‰€çœ‹æ‰€æ€æ‰€æ„Ÿã€‚</p>
<p>å…³äºå†™åšå®¢çš„æµç¨‹ï¼Œç”µè„‘ä¸Šä½¿ç”¨ typora ç¼–è¾‘å™¨æœ‰ç€å¾ˆå¥½çš„ç”¨æˆ·ä½“éªŒã€‚å¦‚æœä¹Ÿèƒ½åœ¨æ‰‹æœºä¸Šç”¨ markdown å†™æ–‡ç« å¹¶æäº¤åˆ° github ä¸Šå°±æ›´å®Œç¾äº†ã€‚åˆšå¼€å§‹æˆ‘ä½¿ç”¨çš„æ˜¯ mweb è¿™ä¸ª appï¼Œæœ€è¿‘åœ¨ ios ä¸Šåˆå‘ç°äº† metion è¿™ä¸ª app å°±å¯ä»¥æ”¯æŒå’Œ git åŒæ­¥ã€‚</p>
<img src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/ios-app-metion.png" alt="ios-app-metion" style="width: 50%"/>
<p>è¿™ç¯‡æ–‡ç« å°±æ˜¯é€šè¿‡ metion ç¼–å†™å’Œæäº¤çš„ã€‚å›¾ç‰‡æ˜¯æœ¬åœ°ä¸Šä¼ çš„ï¼Œå›¾ç‰‡åç§°åº”è¯¥æ˜¯ä¸€ä¸²éšæœºæ•°ï¼Œå¾…æ–‡ç« å‘å¸ƒä¹‹åï¼Œéœ€è¦å°†å›¾ç‰‡é‡å‘½åä¸ºæœ‰æ„ä¹‰çš„åç§°ï¼Œè¿™æ ·æ–¹ä¾¿åœ¨å›¾åºŠé‡ŒæŸ¥é˜…å’Œç®¡ç†ã€‚</p>
<img src="http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/metion-writing-first-blog.png" alt="metion-writing-first-blog" style="width: 50%"/>
<p>å…³äºå›¾ç‰‡çš„å®½åº¦è®¾ç½®ï¼Œç‰¹åˆ«æ˜¯ç«–å½¢å›¾ï¼Œå»ºè®®å°†å®½åº¦è®¾ç½®ä¸ºä¸€åŠã€‚è®¾ç½®æ–¹æ³•æ˜¯ï¼šåœ¨ md æ–‡ä»¶é‡Œä½¿ç”¨ <code>img</code> æ ‡ç­¾å¼•å…¥å›¾ç‰‡ï¼Œè¿™æ ·å°±å¯ä»¥æ·»åŠ ä¸€ä¸ª <code>sytle=&quot;width: 50%&quot;</code> æ¥è®¾ç½®å®½åº¦ã€‚ä¾‹å¦‚ï¼Œä¸Šé¢å›¾ç‰‡å°±æ˜¯è¿™æ ·è®¾ç½®çš„ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/ios-app-metion.png&#34;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&#34;ios-app-metion&#34;</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;width: 50%&#34;</span><span class="p">&gt;</span>
</span></span></code></pre></div><h2 id="å†…è§‚å†¥æƒ³">å†…è§‚å†¥æƒ³</h2>
<p>è¿™ä¸ªæœˆå‚åŠ äº†ä¸€ä¸ªå†…è§‚å†¥æƒ³ 21 å¤©è®­ç»ƒè¥ï¼Œæ¯å¤©æ—©ä¸Š 7 ç‚¹åˆ° 8 ç‚¹æ˜¯ä¸Šè¯¾æ—¶é—´ï¼Œæ­£å¥½ä¹Ÿæ˜¯æˆ‘ä¸Šç­æ—¶é—´ã€‚åœ¨å¬äº†å‡ å¤©è¯¾ç¨‹å¹¶æ‰“å¡ä¹‹åï¼Œå°±æ”¾å¼ƒäº†ã€‚</p>
<p>21 å¤©è¯¾ç¨‹å†…å®¹ï¼Œæ¯å¤©çš„ä¸»é¢˜åˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>ç›®æ ‡</li>
<li>è®¡åˆ’</li>
<li>ç»“æœ</li>
<li>æ¯”è¾ƒ</li>
<li>æŠ±æ€¨</li>
<li>åæ‚”</li>
<li>ä»–åº”è¯¥çŸ¥é“è‡ªå·±é”™äº†</li>
<li>ä¸å¯èƒ½</li>
</ul>
<h3 id="ç›®æ ‡">ç›®æ ‡</h3>
<blockquote>
<p>ä»Šæ—¥å†…è§‚å†¥æƒ³ä¸»é¢˜æ˜¯ç›®æ ‡</p>
<p>é™é™åœ°æ”¾ç©ºè‡ªå·±ï¼Œå›æƒ³è‡ªå·±å…³æ³¨ç›®æ ‡çš„è®°å¿†ã€‚å¥½åƒè‡ªå·±æ›¾ç»è®¾ç«‹è¿‡å¾ˆå¤šç›®æ ‡ï¼Œåˆå¥½åƒä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Œå¥½åƒæè¿°ä¸å‡ºæ¥ï¼Œåˆç¢ç£¨ä¸é€ã€‚</p>
<p>æ›¾ç»ç«‹ä¸‹çš„é‚£äº›ç›®æ ‡ç®—æ˜¯ç›®æ ‡å—ï¼Ÿä»–ä»¬å¯ä»¥å®ç°å—ï¼Ÿä»–ä»¬å®ç°äº†å—ï¼Ÿä¸ºä»€ä¹ˆæ²¡æœ‰å®ç°å‘¢ï¼Ÿæ— å¿—ä¹‹äººå¸¸ç«‹å¿—ï¼Œæœ‰å¿—ä¹‹äººç«‹å¸¸å¿—ã€‚è¿œçš„ä¸è¯´ï¼Œå…ˆçœ‹çœ‹ 2022 å¹´å®ç°äº†å“ªäº›ç›®æ ‡ã€‚è¯»ä¹¦ï¼Œæ˜¯å½»åº•æ”¾ä¸‹äº†ï¼›å¥èº«ï¼Œå…ƒæ—¦å‰å‡åˆ° 130 æ–¤çš„ç›®æ ‡åœ¨ â€œé˜³åº·åä¸è¦å‰§çƒˆè¿åŠ¨â€ çš„è¯´è¾ä¸‹è€½è¯¯äº†ï¼›å®šæŠ•ï¼Œä¹Ÿæ˜¯ç»ˆæ­¢äº†ï¼›ä¹°è½¦ï¼Œè½¦æ˜¯æ¶ˆè€—å“ï¼›ç»“å©šï¼Œå®ç°äº†ã€‚</p>
<p>ç®—äº†ä¸‹ï¼Œå®ç°äº†çš„ç›®æ ‡ä¹Ÿå°±æ˜¯ç»“å©šäº†ã€‚å°‘çš„å¯æ€œã€‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿå¤§æŠµæ˜¯è‡ªå·±ä¸å¤Ÿè‡ªå¾‹ï¼Œæ²¡æœ‰æŒç»­çš„åšæŒï¼Œä¹Ÿæ²¡æœ‰åŠæ—¶çš„åæ€å’Œè°ƒæ•´ã€‚ä¹Ÿå°±æ˜¯è‡ªæˆ‘å¯Ÿè§‰ä¸å¤Ÿå§ï¼æˆ–è€…è¯´æ²¡æœ‰å…»æˆè‡ªæˆ‘å¯Ÿè§‰çš„æ–¹æ³•å’Œä¹ æƒ¯ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆè¦å‚åŠ  21 å¤©å†…è§‚è®­ç»ƒè¥çš„åŸå› å§ã€‚</p>
<p>ä¸€ä¸ªäººå¾ˆéš¾è®¤æ¸…è‡ªèº«çš„å±€é™æ€§ï¼Œå¾ˆéš¾æ‰©å¤§è‡ªå·±çš„è®¤çŸ¥ï¼Œå¤šä¸èº«è¾¹çš„äººäº¤æµå’Œå­¦ä¹ ï¼Œé€šè¿‡è§‚ä»–äººï¼Œå†æ¥æ€è‡ªå·±ï¼Œåº”è¯¥å¯ä»¥æå‡è‡ªå·±çš„å¯Ÿè§‰æ„è¯†ã€‚</p>
</blockquote>
<h3 id="è®¡åˆ’">è®¡åˆ’</h3>
<blockquote>
<p>ä»Šæ—¥å†…è§‚å†¥æƒ³ä¸»é¢˜æ˜¯è®¡åˆ’ã€‚</p>
<p>æ—©ä¸Šå†¥æƒ³æ˜¯åœ¨åœ°é“ï¼Œå†¥æƒ³çš„æ—¶å€™æ”¾ç©ºè‡ªå·±ï¼Œæ„Ÿå—è‡ªå·±çš„æ€ç»ªã€æƒ…ç»ªå’Œèº«ä½“çš„æ³¨æ„åŠ›ã€‚å› ä¸ºæ˜¯ç«™ç€ï¼Œæ³¨æ„åŠ›ä¸€ä¼šå„¿åœ¨è„šä¸Šï¼Œä¸€ä¼šå„¿åœ¨æ‰‹ä¸Šï¼Œä¸èƒ½å®Œå…¨åœ°æ”¾ç©ºè‡ªå·±ã€‚æƒ³å¿…è¦æ˜¯å®Œå…¨æ”¾æ¾ï¼Œä¼°è®¡å°±ç«™ä¸ä½äº†å§ã€‚</p>
<p>å†¥æƒ³åœ°è¿‡ç¨‹ä¸­ï¼Œé‡è¦çš„æ˜¯æ„Ÿå—å’Œè§‚å¯Ÿã€‚æ„Ÿå—å½“ä¸‹çš„æ„Ÿå—ï¼Œè§‚å¯Ÿè‡ªå·±çš„è§‚å¯Ÿï¼Œä»»æœ‰ä»–ä»¬æµåŠ¨å’Œå‘å±•ã€‚æ‰€è°“æ²¡æœ‰ç»å¯¹çš„å¯¹ä¸é”™ï¼Œå†¥æƒ³çš„è¿‡ç¨‹ä¸­ï¼Œé‡è¦çš„æ˜¯ä½œä¸ºä¸€ä¸ªæ—è§‚è€…ï¼Œä¸è¦æœ‰è¿‡å¤šçš„ä¸»è§‚æ„è¯†ã€‚</p>
</blockquote>
<h3 id="ç»“æœ">ç»“æœ</h3>
<blockquote>
<p>ä»Šå¤©çš„å†…è§‚å†¥æƒ³ä¸»é¢˜æ˜¯ç»“æœã€‚</p>
<p>æŠŠèº«ä½“æŒ‚åœ¨é’©å­ä¸Šï¼Œé™é™åœ°è§‚å¯Ÿå’Œæ„Ÿå—ã€‚ä¸€æ–¹é¢æ„Ÿå—èº«ä½“ï¼Œä¸€æ–¹é¢ä¼šæ€è€ƒè‡ªå·±å¯¹ç»“æœçš„ç†è§£ã€‚ä»€ä¹ˆæ˜¯ç»“æœï¼Ÿè‡ªå·±è¿‡å»ä¸€å¹´å–å¾—äº†ä»€ä¹ˆæ ·çš„ç»“æœï¼Ÿä¸ºä»€ä¹ˆæ²¡æœ‰å–å¾—ï¼Ÿ</p>
</blockquote>
<h3 id="æ¯”è¾ƒ">æ¯”è¾ƒ</h3>
<blockquote>
<p>ä»Šæ—¥å†…è§‚å†¥æƒ³ä¸»é¢˜æ˜¯æ¯”è¾ƒã€‚å†¥æƒ³æ—¶ï¼Œè§‚å¯Ÿè‡ªå·±çš„æ„Ÿå—ã€æƒ…ç»ªã€æƒ³æ³•ï¼Œä»–ä»¬å¯èƒ½æ˜¯ä»»ä½•æ ·å­çš„ã€‚ä¸ç®¡æ˜¯æ€æ ·çš„ï¼Œä»–ä»¬éƒ½æ˜¯æ­£å¸¸çš„ï¼Œéƒ½æ˜¯ä»–ä»¬æœ¬æ¥çš„æ ·å­ï¼Œä¹Ÿå°±æ˜¯ç©ºæ€§ã€‚</p>
<p>æŠŠæ¯”è¾ƒè¿™ä¸ªå¿µå¤´æŒ‚èµ·æ¥ï¼Œé™é™åœ°çœ‹æ¯”è¾ƒè¿™ä¸¤ä¸ªå­—ã€‚ç„¶åå¼€å§‹è§‰å¯Ÿæ¯”è¾ƒè¿™ä¸¤ä¸ªå­—ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå¤§è„‘å¼€å§‹åœ¨æ€è€ƒæ¯”è¾ƒè¿™ä¸ªå¿µå¤´æ˜¯ä»€ä¹ˆã€‚æ€ç»ªåœ¨å˜åŒ–çš„æ—¶å€™ï¼Œå¯¹å¯¹æ¯”è¾ƒè¿™ä¸ªå¿µå¤´çš„æ„Ÿå—ä¹Ÿåœ¨å˜åŒ–ã€‚æ— è®ºå¦‚ä½•å˜åŒ–ï¼Œè‡ªå·±éƒ½ä¸è¦å¹²é¢„ã€‚å½“è‡ªå·±æœ‰äº†æ¯”è¾ƒè¿™ä¸ªå¿µå¤´ï¼Œè‡ªå·±çš„æ„Ÿå—æ˜¯å¤±æœ›çš„ã€‚å¤±æœ›è‡ªå·±ä¸å¦‚åˆ«äººï¼Œä¸å¦‚è¿‡å»ã€‚å¤±æœ›è¿‡åï¼Œåˆä¸æœæ°”ï¼Œåˆæš—ä¸‹å†³å¿ƒè¦å¥½å¥½åŠªåŠ›ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘æ˜¯æˆ‘çš„ä¸»äººï¼Œæ˜¯æˆ‘åœ¨æœ‰ç€å„ç§å„æ ·çš„æ„Ÿå—ã€‚å¦‚æœæˆ‘èƒ½æ§åˆ¶è‡ªå·±çš„æƒ…ç»ªï¼Œå°±èƒ½æ§åˆ¶è‡ªå·±çš„è¡Œä¸ºã€‚</p>
</blockquote>
<h3 id="æŠ±æ€¨">æŠ±æ€¨</h3>
<blockquote>
<p>ä»Šæ—¥å†¥æƒ³ä¸»é¢˜æ˜¯æŠ±æ€¨ã€‚</p>
<p>ç”Ÿæ´»ä¸­æœ‰ä»€ä¹ˆæŠ±æ€¨çš„ï¼ŸæŠ±æ€¨åˆè§£å†³ä¸äº†é—®é¢˜ï¼Ÿé—®é¢˜åˆä¸æ˜¯è‡ªå·±é€ æˆçš„ï¼Œå¯èƒ½æ˜¯åˆ«äººé€ æˆçš„ï¼åˆ«äººçš„äº‹æƒ…æ˜¯åˆ«äººçš„äº‹æƒ…ï¼Œè‡ªå·±çš„äº‹æƒ…æ˜¯è‡ªå·±é€ æˆã€‚åˆ«äººçš„äº‹æƒ…ï¼Œä½ ç®¡ä¸äº†ï¼Œä½ èƒ½ç®¡ç†çš„æ˜¯ä½ è‡ªå·±çš„ã€‚ç®¡å¥½è‡ªå·±çš„å¿ƒæ€æƒ…ç»ªå’Œè¡Œä¸ºï¼Œå› ä¸ºæŠ±æ€¨è§£å†³ä¸äº†åˆ«äººçš„é—®é¢˜ï¼Œä¹Ÿè§£å†³ä¸äº†è‡ªå·±çš„äº‹æƒ…ã€‚ç”šè‡³ä½ çš„æŠ±æ€¨è¿˜ä¼šç»™åˆ«äººå¸¦æ¥è´Ÿèƒ½é‡ï¼Œç»™ä½ ä»¬å¸¦æ¥äº‰åµï¼Œç»™è‡ªå·±å¸¦æ¥è›®çƒ¦ï¼Œç»™è‡ªå·±åœ°èƒ½åŠ›å’Œæƒ…ç»ªå¸¦æ¥æ¶ˆè€—ã€‚ä¸å…¶æ¶ˆè€—è‡ªå·±ï¼Œè¿˜ä¸å¦‚æå‡è‡ªå·±ã€‚æœ‰æ—¶å€™ä¸è¦å±€é™åœ¨è‡ªå·±çš„æ€ç»´é‡Œï¼Œæ¢ä¸ªè§’åº¦ï¼Œæå‡æ ¼å±€ï¼Œä¸€åˆ‡äº‹æƒ…éƒ½ä¸æ˜¯äº‹æƒ…äº†ã€‚è¿™ä¸ªä¸–ç•Œå“ªæœ‰é‚£ä¹ˆå¤šæ‰€è°“é‡è¦çš„äº‹æƒ…ã€‚é‚£äº›ä»Šå¤©ä½ çœ‹æ¥å¾ˆé‡è¦çš„äº‹å„¿ï¼Œåœ¨åå¹´äºŒåå¹´ä¹‹åï¼Œæ ¹æœ¬å°±ä¸å€¼å¾—ä¸€æã€‚æ‰€ä»¥å¾ˆå¤šæ—¶å€™ï¼Œè¦ç”¨å‘å±•çš„çœ¼å…‰çœ‹é—®é¢˜ã€‚ä¸€åˆ‡éƒ½ä¼šè¿‡å»ï¼Œä¸€åˆ‡éƒ½ä¼šå¥½èµ·æ¥ã€‚å½“ä½ è¿™æ ·æƒ³çš„æ—¶å€™ï¼Œåœ¨ä½ å¿ƒé‡Œåœ¨ä½ çœ¼å‰ï¼Œå°±æ²¡æœ‰ä»€ä¹ˆçƒ¦æ¼äº†ï¼Œä¹Ÿå°±ä¸ä¼šæŠ±æ€¨äº†ã€‚</p>
</blockquote>
<h2 id="å¥½ç‰©åˆ†äº«">å¥½ç‰©åˆ†äº«</h2>
<p>å‡ ä¸ªæˆªå›¾è½¯ä»¶ï¼š</p>
<ul>
<li>
<p><a href="https://immmmm.com/chrome-extensions-tinysnap/">TinySnap</a> Chrome æˆªå›¾æ’ä»¶ï¼Œæ”¯æŒè®¾ç½®èƒŒæ™¯</p>
</li>
<li>
<p>Snipaste æˆªå›¾</p>
</li>
</ul>
<p>ä»¥ä¸Šã€‚</p>
]]></content:encoded>
    </item>
    
    <item>
      <title>å…³äº</title>
      <link>https://blog.chensoul.com/about/</link>
      <pubDate>Sun, 01 Jan 2023 08:00:00 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/about/</guid>
      <description>Hi there ğŸ‘‹ å¥åº·ï¼Œçˆ±æƒ…å’Œä½¿å‘½ï¼ŒæŒ‰ç…§è¿™ä¸ªé¡ºåºï¼Œå…¶å®ƒçš„éƒ½ä¸é‡è¦ã€‚ &amp;mdash;&amp;mdash; çº³ç“¦å°” æˆ‘æ˜¯ ChenSoulï¼Œä¸€ä¸ª Java è½¯ä»¶å¼€å‘å·¥ç¨‹å¸ˆï¼Œç›®å‰å·¥ä½œåœ¨æ­¦æ±‰ã€‚ çƒ­çˆ±ç¼–ç¨‹ï¼Œå–œæ¬¢è·‘æ­¥</description>
      <content:encoded><![CDATA[<!-- readme starts -->
<h2 id="hi-there-">Hi there ğŸ‘‹</h2>
<blockquote>
<p>å¥åº·ï¼Œçˆ±æƒ…å’Œä½¿å‘½ï¼ŒæŒ‰ç…§è¿™ä¸ªé¡ºåºï¼Œå…¶å®ƒçš„éƒ½ä¸é‡è¦ã€‚ &mdash;&mdash; çº³ç“¦å°”</p>
</blockquote>
<p>æˆ‘æ˜¯ ChenSoulï¼Œä¸€ä¸ª Java è½¯ä»¶å¼€å‘å·¥ç¨‹å¸ˆï¼Œç›®å‰å·¥ä½œåœ¨æ­¦æ±‰ã€‚</p>
<p>çƒ­çˆ±ç¼–ç¨‹ï¼Œå–œæ¬¢è·‘æ­¥ã€‚è¯»ä¹¦ã€å¥èº«ã€å®šæŠ•ã€å¸®æœ‹å‹ã€é™ªå®¶äººï¼Œåšä¸€ä¸ªé•¿æœŸä¸»ä¹‰è€…ã€‚</p>
<h3 id="ç½‘ç«™">ç½‘ç«™</h3>
<ul>
<li>åšå®¢ï¼š<a href="https://blog.chensoul.com/">https://blog.chensoul.com/</a></li>
<li>è·‘æ­¥ï¼š<a href="https://run.chensoul.com/">https://run.chensoul.com/</a></li>
<li>Memosï¼š<a href="https://memos.chensoul.com/">https://memos.chensoul.com/</a></li>
</ul>
<h3 id="æ‰¾åˆ°æˆ‘">æ‰¾åˆ°æˆ‘</h3>
<ul>
<li>å¾®ä¿¡ï¼šchenshu_eth</li>
<li><a href="mailto:chensoul.eth@gmail.com">Email</a></li>
<li><a href="https://blog.chensoul.com/index.xml">Blog RSS</a></li>
<li><a href="https://github.com/chensoul">Github</a></li>
<li><a href="https://twitter.com/chensoul_eth">Twitter</a></li>
<li><a href="https://t.me/chensoul_share">Telegram</a></li>
</ul>
<h2 id="æœ€æ–°åšå®¢">æœ€æ–°åšå®¢</h2>
<!-- blog starts -->
<ul>
<li><a href="https://blog.chensoul.com/posts/2023/07/27/weekly_review_28/">å‘¨æŠ¥-28ï½œæŠ€æœ¯æ–‡æ¡£èŒƒä¾‹</a></li>
<li><a href="https://blog.chensoul.com/posts/2023/07/26/spring-boot-authorization-server/">[è¯‘]Spring BootæˆæƒæœåŠ¡å™¨ - ä½¿ç”¨ Java çš„èµ„æºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å‡­è¯ç¤ºä¾‹</a></li>
<li><a href="https://blog.chensoul.com/posts/2023/07/26/spring-boot-exception-handling/">[è¯‘]Spring Bootå¼‚å¸¸å¤„ç†å®Œæ•´æŒ‡å—</a></li>
<li><a href="https://blog.chensoul.com/posts/2023/07/26/spring-boot-null-safety-annotations/">[è¯‘]ä½¿ç”¨ Spring çš„ Null-Safety æ³¨è§£ä¿æŠ¤æ‚¨çš„ä»£ç å…å— NullPointerExceptions çš„å½±å“</a></li>
<li><a href="https://blog.chensoul.com/posts/2023/07/26/spring-cors/">[è¯‘]ä½¿ç”¨ Spring Boot å’Œ Spring Security é…ç½® CORS</a></li>
<li><a href="https://blog.chensoul.com/posts/2023/07/26/spring-boot-info-endpoint/">[è¯‘]ä½¿ç”¨Spring Boot Actuatorå…¬å¼€æœ‰ç”¨çš„ä¿¡æ¯ç«¯ç‚¹</a></li>
<li><a href="https://blog.chensoul.com/posts/2023/07/26/using-oauth2-in-spring-scopes/">[è¯‘]åœ¨ Spring ä¸­å®ç° OAuth2ï¼šä½¿ç”¨èŒƒå›´ï¼ˆç¬¬ 2 éƒ¨åˆ†ï¼‰</a></li>
<li><a href="https://blog.chensoul.com/posts/2023/07/26/using-oauth2-in-spring/">[è¯‘]åœ¨ Spring ä¸­å®ç° OAuth2ï¼šç¬¬ 1 éƒ¨åˆ†</a></li>
<li><a href="https://blog.chensoul.com/posts/2023/07/14/oauth-2-centralized-authorization-with-spring-boot-2-and-spring-security-5-and-jdbc-token-store/">[è¯‘]ä½¿ç”¨Spring Boot2å’ŒSpring Security 5ä»¥åŠJDBCä»¤ç‰Œå­˜å‚¨è¿›è¡ŒOauth2é›†ä¸­æˆæƒ</a></li>
<li><a href="https://blog.chensoul.com/posts/2023/07/11/weekly_review_26/">å‘¨æŠ¥-26ï½œä¸ŠåŠå¹´çš„ç»©æ•ˆæ€»ç»“</a></li>
</ul>
<!-- blog ends -->
<h2 id="æœ€è¿‘æ´»åŠ¨">æœ€è¿‘æ´»åŠ¨</h2>
<!-- douban starts -->
<ul>
<li><a href="http://movie.douban.com/subject/35496350/">æƒ³çœ‹å¿—æ„¿å†›ï¼šé›„å…µå‡ºå‡»</a> 2023-06-26</li>
<li><a href="http://movie.douban.com/subject/10604086/">æƒ³çœ‹å°ç¥ç¬¬ä¸€éƒ¨ï¼šæœæ­Œé£äº‘</a> 2023-06-26</li>
<li><a href="http://movie.douban.com/subject/35818074/">æƒ³çœ‹æˆ‘çˆ±ä½ ï¼</a> 2023-06-26</li>
<li><a href="http://movie.douban.com/subject/35660795/">çœ‹è¿‡æ¶ˆå¤±çš„å¥¹</a> 2023-06-26</li>
<li><a href="https://book.douban.com/subject/35446284/">æƒ³è¯»Javaé«˜å¹¶å‘æ ¸å¿ƒç¼–ç¨‹ å·1</a> 2023-06-12</li>
<li><a href="https://book.douban.com/subject/35446285/">æœ€è¿‘åœ¨è¯»Javaé«˜å¹¶å‘æ ¸å¿ƒç¼–ç¨‹ å·2</a> 2023-06-12</li>
<li><a href="https://book.douban.com/subject/27094706/">æœ€è¿‘åœ¨è¯»è´¢å¯Œè‡ªç”±ä¹‹è·¯</a> 2023-06-09</li>
<li><a href="http://movie.douban.com/subject/25728006/">çœ‹è¿‡é€Ÿåº¦ä¸æ¿€æƒ…9</a> 2023-06-09</li>
<li><a href="http://movie.douban.com/subject/35652451/">çœ‹è¿‡åˆ€å‰‘ç¥åŸŸè¿›å‡»ç¯‡ï¼šæš®è‰²é»„æ˜</a> 2023-06-09</li>
<li><a href="http://movie.douban.com/subject/26260853/">çœ‹è¿‡é€Ÿåº¦ä¸æ¿€æƒ…8</a> 2023-05-19</li>
</ul>
<!-- douban ends -->
<h2 id="æœ€è¿‘å‘å¸ƒ">æœ€è¿‘å‘å¸ƒ</h2>
<!-- recent_releases starts -->
<ul>
<li><a href="https://github.com/chensoul/learning-hadoop/releases/tag/v0.0.1">learning-hadoop</a>ï¼šå­¦ä¹  hadoop ç¤ºä¾‹ä»£ç </li>
<li><a href="https://github.com/chensoul/learning-spark/releases/tag/v0.0.1">learning-spark</a>ï¼šå­¦ä¹  spark ç¤ºä¾‹ä»£ç </li>
<li><a href="https://github.com/chensoul/scrapy-zhihu-github/releases/tag/v0.0.1">scrapy-zhihu-github</a>ï¼šScrapyçˆ¬å–çŸ¥ä¹ã€Githubç”¨æˆ·</li>
<li><a href="https://github.com/chensoul/grab/releases/tag/v0.0.1">grab</a>ï¼šåŸºäºsparkã€spring bootæ„å»ºæ¨èç³»ç»Ÿ</li>
</ul>
<!-- recent_releases ends -->
<h2 id="æœ€è¿‘ä¸€å‘¨ç¼–ç ">æœ€è¿‘ä¸€å‘¨ç¼–ç </h2>
<p><img loading="lazy" src="https://raw.githubusercontent.com/chensoul/chensoul/main/images/wakatime_weekly_language_stats.svg#gh-light-mode-only" alt="light"  />
</p>
<h2 id="æœ€è¿‘ä¸€å¹´è·‘æ­¥">æœ€è¿‘ä¸€å¹´è·‘æ­¥</h2>
<p><a href="https://run.chensoul.com"><img loading="lazy" src="https://raw.githubusercontent.com/chensoul/running_page/master/assets/github_2023.svg#gh-light-mode-only" alt="light"  />
</a></p>
<!-- readme ends -->
]]></content:encoded>
    </item>
    
    <item>
      <title>åšå®¢ä¸­å¦‚ä½•ä½¿ç”¨å›¾åºŠæœåŠ¡</title>
      <link>https://blog.chensoul.com/posts/2022/08/19/using-images-in-blog/</link>
      <pubDate>Fri, 19 Aug 2022 12:15:54 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2022/08/19/using-images-in-blog/</guid>
      <description>æœ€è¿‘ç¼–å†™æ–‡æ¡£æˆ–è€…å†™åšå®¢ï¼Œå–œæ¬¢ç”¨ Typora ç¼–è¾‘å™¨é€šè¿‡ Markdown è¯­æ³•å®Œæˆç¼–å†™æ‰€æœ‰å†…å®¹ã€‚ä¸ºæ­¤ï¼Œè¿˜ä»˜è´¹è´­ä¹°äº†è®¸å¯è¯ã€‚ å–œæ¬¢ Typora çš„ç†ç”±ï¼š æ‰€è§å³æ‰€å¾—çš„ç¼–è¾‘ï¼ŒMarkdown</description>
      <content:encoded><![CDATA[<p>æœ€è¿‘ç¼–å†™æ–‡æ¡£æˆ–è€…å†™åšå®¢ï¼Œå–œæ¬¢ç”¨ Typora ç¼–è¾‘å™¨é€šè¿‡ Markdown è¯­æ³•å®Œæˆç¼–å†™æ‰€æœ‰å†…å®¹ã€‚ä¸ºæ­¤ï¼Œè¿˜ä»˜è´¹è´­ä¹°äº†è®¸å¯è¯ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/my-typora-license.png" alt="my-typora-license"  />
</p>
<p>å–œæ¬¢ Typora çš„ç†ç”±ï¼š</p>
<ul>
<li>
<p>æ‰€è§å³æ‰€å¾—çš„ç¼–è¾‘ï¼ŒMarkdownçš„è¯­æ³•éƒ½æ”¯æŒå¿«æ·é”®æ“ä½œï¼Œéå¸¸æ–¹ä¾¿</p>
</li>
<li>
<p>å¯ä»¥è‡ªå®šä¹‰ä¸»é¢˜çš„ CSSï¼ŒåŒ…æ‹¬æ–‡ç« å†…å®¹å°±å¯ä»¥ç²˜è´´åˆ°å…¬ä¼—å·é‡Œ</p>
</li>
<li>
<p>ä¸Šä¼ å›¾ç‰‡ï¼Œæ”¯æŒå›¾åºŠæœåŠ¡ã€‚å¯ä»¥å°†å›¾ç‰‡ä¸Šä¼ åˆ°æŒ‡å®šçš„å›¾åºŠï¼Œå‰ææ˜¯éœ€è¦å…ˆå®‰è£…ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯ PicGoã€‚ç„¶åï¼ŒPicGoæ”¯æŒå¸¸è§çš„ä¸€äº›å›¾åºŠæœåŠ¡ã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/picgo-setting-image-server.png" alt="picgo-setting-image-server"  />
</p>
</li>
<li>
<p>æ”¯æŒå¯¼å‡º</p>
</li>
</ul>
<h2 id="typora-å›¾ç‰‡å¤åˆ¶åˆ°æœ¬åœ°">Typora å›¾ç‰‡å¤åˆ¶åˆ°æœ¬åœ°</h2>
<p>æ¥ä¸‹æ¥ï¼ŒèŠèŠ Typora çš„å›¾ç‰‡ä¸Šä¼ è®¾ç½®ï¼š</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/typora-setting-image.png" alt="typora-setting-image"  />
</p>
<p>å½“ä½ æ’å…¥å›¾ç‰‡æ—¶ï¼Œä½ å¯ä»¥åˆ†æƒ…å†µå¯¹å›¾ç‰‡è¿›è¡Œè®¾ç½®ã€‚æ¯”å¦‚ï¼š</p>
<p>1ã€å¯¹æœ¬åœ°ä½ç½®çš„å›¾ç‰‡ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªä¸Šä¼ è§„åˆ™ï¼šå¤åˆ¶åˆ°æŒ‡å®šè·¯å¾„æˆ–è€…æ˜¯å½“å‰è·¯å¾„ä¸‹çš„ä¸€ä¸ªæ–‡ä»¶å¤¹ã€ä¸Šä¼ å›¾ç‰‡ã€‚</p>
<ul>
<li>å¦‚æœæ˜¯ç¼–å†™ä¸€ä¸ªæ–‡æ¡£ï¼Œæˆ‘ä»¬å°±è®¾ç½®æŠŠå›¾ç‰‡ä¿å­˜åˆ°æœ¬åœ°çš„ assets æ–‡ä»¶å¤¹å†…ï¼Œè¿™æ ·æ–¹ä¾¿ç®¡ç†ã€‚</li>
<li>å¦‚æœæ˜¯ç¼–å†™åšå®¢ï¼Œå›¾ç‰‡ä¸€èˆ¬æ˜¯é›†ä¸­ç®¡ç†çš„ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®å¤åˆ¶åˆ°ä¸€ä¸ªæŒ‡å®šè·¯å¾„</li>
</ul>
<p>2ã€ç±»ä¼¼çš„ï¼Œå¯¹ç½‘ç»œä½ç½®çš„å›¾ç‰‡ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸Šé¢çš„è§„åˆ™ã€‚</p>
<p>æ³¨æ„ï¼Œå¦‚æœå°†å›¾ç‰‡ä¿å­˜åˆ°æœ¬åœ°ç›®å½•ï¼Œåœ¨æ–‡ç« ä¸­å¼•ç”¨å›¾ç‰‡æ˜¯ä½¿ç”¨çš„ç›¸å¯¹æˆ–è€…ç»å¯¹è·¯å¾„ã€‚å¦‚æœåªæ˜¯åœ¨æœ¬åœ°æŸ¥çœ‹ï¼Œæ˜¯å¯ä»¥é¢„è§ˆå›¾ç‰‡çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœå°†åšå®¢ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œåˆ™å› ä¸ºè·¯å¾„é—®é¢˜å¯èƒ½ä¼šå‡ºç°æ— æ³•é¢„è§ˆå›¾ç‰‡çš„æƒ…å†µã€‚</p>
<p>æ‰€ä»¥ï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬éœ€è¦åšä¸€äº›ä¿®æ”¹ã€‚é€šå¸¸æˆ‘ä¼šè®¾ç½®å›¾ç‰‡å¤åˆ¶åˆ°åšå®¢çš„é™æ€é¡µé¢ç›®å½•ä¸‹é¢ï¼Œæ¯”å¦‚ï¼Œæˆ‘ç°åœ¨ä½¿ç”¨çš„æ˜¯ Hugo æ„å»ºé™æ€åšå®¢ï¼Œä¼šå°†å›¾ç‰‡ä¿å­˜åˆ° static/img ç›®å½•ä¸‹ï¼Œå¹¶ä¸”ï¼Œè¿˜éœ€è¦ä¿®æ”¹å›¾ç‰‡çš„ markdown å¼•ç”¨è·¯å¾„ä¸º <code>/images/image-20220819124422239.png</code> ï¼Œä»¥è¡¨ç¤ºç»å¯¹è·¯å¾„æŸ¥æ‰¾å›¾ç‰‡ï¼Œåœ¨åšå®¢æœåŠ¡å™¨ä¸Šå°±æ˜¯ç›¸å¯¹æ ¹åŸŸåç›®å½•å» img è·¯å¾„ä¸‹æŸ¥æ‰¾å›¾ç‰‡ã€‚å¾…hugo ç¼–è¯‘å®Œæˆä¸Šä¼ é™æ€æ–‡ä»¶åˆ°æœåŠ¡å™¨ä¹‹åï¼Œå¯ä»¥é€šè¿‡ <a href="https://blog.chensoul.com/images/">https://blog.chensoul.com/images/</a> åŠ ä¸Šå›¾ç‰‡åç§°çš„æ–¹å¼è®¿é—®åˆ°å›¾ç‰‡ã€‚</p>
<p>ä½†æ˜¯ï¼Œæ˜¾ç„¶ï¼Œè¿™æ—¶å€™åœ¨ Typora æ˜¯æ— æ³•é¢„è§ˆå›¾ç‰‡çš„ï¼Œå› ä¸ºåœ¨æœ¬åœ°æŸ¥æ‰¾ä¸åˆ°è¿™ä¸ªç»å¯¹è·¯å¾„åœ°å€ã€‚è¿™æ—¶å€™å¯ä»¥åœ¨ Typora é‡Œé¢è®¾ç½®ä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œæ“ä½œæ–¹æ³•æ˜¯ï¼Œåœ¨ æ˜¾ç¤º -&gt; å›¾ç‰‡ -&gt; å›¾åƒ -&gt; è®¾ç½®å›¾ç‰‡æ ¹ç›®å½• é‡Œè¿›è¡Œè®¾ç½®ã€‚</p>
<p>è®¾ç½®å®Œæˆä¹‹åï¼Œåœ¨å½“å‰æ–‡ä»¶çš„ md æ–‡ä»¶çš„é¡¶éƒ¨å…ƒæ•°æ®ä»£ç é‡Œä¼šå¤šä¸€è¡Œä»£ç ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;åšå®¢ä¸­å¦‚ä½•ä½¿ç”¨å›¾åºŠæœåŠ¡&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">date</span><span class="p">:</span><span class="w"> </span><span class="ld">2022-08-19T12:15:54</span><span class="m">+08</span><span class="p">:</span><span class="m">00</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">slug</span><span class="p">:</span><span class="w"> </span><span class="l">using-images-in-blog</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">categories</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="l">æ—¥å¿—]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">tags</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="l">hugo]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">draft</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">typora-root-url</span><span class="p">:</span><span class="w"> </span><span class="l">../../static</span><span class="w">
</span></span></span></code></pre></div><p>è¿™æ ·åšå®¢é‡Œæ‰€æœ‰çš„å›¾ç‰‡éƒ½ä¼šä¿å­˜çš„åšå®¢æœåŠ¡å™¨ï¼Œå¦‚æœåšå®¢è®¿é—®é‡å¢å¤§ï¼Œåˆ™å›¾ç‰‡åŠ è½½æ—¶é—´ä¼šå˜æ…¢ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦å°†å›¾ç‰‡è¿›è¡Œå‹ç¼©ï¼Œå¹¶ç»™åšå®¢è®¾ç½® CDN åŠ é€Ÿã€‚</p>
<h2 id="typora-å›¾ç‰‡ä¸Šä¼ åˆ°ç½‘ç»œ">Typora å›¾ç‰‡ä¸Šä¼ åˆ°ç½‘ç»œ</h2>
<p>å°†å›¾ç‰‡ä¿å­˜åˆ°æœ¬åœ°ï¼Œå¾…åšå®¢é™æ€é¡µé¢éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šä¹‹åï¼Œå¯ä»¥å®ç°æ­£å¸¸é¢„è§ˆæƒ…å†µã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æŠŠ md æ–‡ä»¶æ‰“åŒ…ä¸Šä¼ åˆ°ä¸€äº›äº‘ç¬”è®°ï¼Œæ¯”å¦‚ï¼šè¯­é›€ï¼Œä½ ä¼šå‘ç°ä¸Šä¼ ä¹‹åä¼šå‡ºç°å›¾ç‰‡æ— æ³•é¢„è§ˆçš„æƒ…å†µã€‚</p>
<p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å°†å›¾ç‰‡ä¸Šä¼ åˆ°ç½‘ç»œã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®‰è£… PicGoï¼Œç„¶åè®¾ç½®å›¾åºŠæœåŠ¡ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯ github ä½œä¸ºå›¾åºŠæ¥ä¿å­˜å›¾ç‰‡ï¼Œå¹¶ä½¿ç”¨  <a href="https://www.jsdelivr.com">jsDelivr</a> çš„ CDN æœåŠ¡è¿›è¡ŒåŠ é€Ÿè®¿é—®ã€‚</p>
<p>å¦‚ä½•åˆ©ç”¨ Github æ­å»ºè‡ªå·±çš„å…è´¹å›¾åºŠï¼Ÿå¯ä»¥å‚è€ƒè¿™ç¯‡ <a href="https://zhuanlan.zhihu.com/p/353775844">æ–‡ç« </a>ã€‚è¿™é‡Œï¼Œè®°å½•ä¸€ä¸‹æˆ‘çš„æ“ä½œæ­¥éª¤ã€‚</p>
<p>1ã€ä½¿ç”¨åšå®¢çš„<a href="https://github.com/chensoul/blog.chensoul.com">æ‰˜ç®¡ä»“åº“</a> çš„ static/img ç›®å½•æ¥ä¿å­˜å›¾ç‰‡ï¼Œè¿™æ ·æ–¹ä¾¿å›¾ç‰‡çš„ç®¡ç†ï¼ˆæ¯”å¦‚ï¼šå‹ç¼©ã€é‡å‘½åï¼Œåˆ é™¤æ— ç”¨å›¾ç‰‡ï¼‰ï¼Œå¦‚æœå›¾åºŠæœåŠ¡ä¸å¯ç”¨äº†ï¼Œæ‰€æœ‰åšå®¢å›¾ç‰‡è¿˜æœ‰ä¸€ä¸ªå¤‡ä»½ï¼Œåªéœ€è¦ä¿®æ”¹åšå®¢å†…å›¾ç‰‡çš„å¼•ç”¨åœ°å€ã€‚å‰ææ˜¯éœ€è¦å°†ä»“åº“è®¾ç½®ä¸º publicã€‚</p>
<p>2ã€åœ¨ github è®¾ç½®é‡Œé¢åˆ›å»ºä¸€ä¸ª Tokenã€‚ä»¥æ­¤æ‰“å¼€ <code>Settings -&gt; Developer settings -&gt; Personal access tokens</code>ï¼Œæœ€åç‚¹å‡» <code>generate new token</code></p>
<p>3ã€åœ¨ PicGo é‡Œè®¾ç½® github å›¾åºŠï¼š</p>
<ul>
<li>
<p>è®¾å®šä»“åº“åï¼šchensoul/blog.chensoul.com</p>
</li>
<li>
<p>è®¾å®šåˆ†æ”¯ï¼šmain</p>
</li>
<li>
<p>è®¾å®š Tokenï¼šXXXXXXXXXXXXXXXXX</p>
</li>
<li>
<p>æŒ‡å®šå­˜å‚¨è·¯å¾„ï¼šstatic/images/</p>
</li>
<li>
<p>è®¾ç½®è‡ªå®šä¹‰åŸŸåï¼šhttps://cdn.jsdelivr.net/gh/chensoul/blog.chensoul.com</p>
</li>
</ul>
<p>4ã€éœ€è¦ä¿®æ”¹åšå®¢æ–‡ç« å†…å¼•ç”¨çš„å›¾ç‰‡åœ°å€ï¼Œå°† /images/ æ›¿æ¢ä¸º <a href="https://cdn.jsdelivr.net/gh/chensoul/blog.chensoul.com/images/">https://cdn.jsdelivr.net/gh/chensoul/blog.chensoul.com/images/</a> ï¼Œå¯ä»¥ä½¿ç”¨<a href="https://dvel.me/posts/macos-replace-contents-multiple-files/">è„šæœ¬æ‰¹é‡æ›¿æ¢</a>ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">grep -lr --null <span class="s1">&#39;](\/img\/&#39;</span> <span class="p">|</span> xargs -0 sed -i <span class="s1">&#39;&#39;</span> <span class="s1">&#39;s/](\/img\//](https:\/\/cdn.jsdelivr.net\/gh\/chensoul\/blog.chensoul.com\/static\/img\//g&#39;</span>
</span></span></code></pre></div><blockquote>
<p>å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li>grep
<ul>
<li><code>-i, --ignore-case</code> æŸ¥æ‰¾æ–‡ä»¶æ—¶ä¸åŒºåˆ†å¤§å°å†™</li>
<li><code>-l, --files-with-matches</code> è¿”å›æ–‡ä»¶å</li>
<li><code>-R, -r, --recursive</code> é€’å½’æœç´¢å­ç›®å½•</li>
</ul>
</li>
<li>sed
<ul>
<li><code>-i</code> é»˜è®¤ <code>sed</code> ä¼šæ‰“å°åˆ°æ ‡å‡†è¾“å‡ºï¼Œä½¿ç”¨ <code>-i</code> å°†ç›´æ¥åœ¨æ–‡ä»¶å†…ç¼–è¾‘æ›¿æ¢</li>
<li><code>s</code> æ›¿æ¢</li>
<li><code>g</code> å…¨å±€æ›¿æ¢æ ‡å¿—</li>
<li><code>I</code> å¤§å°å†™ä¸æ•æ„Ÿæ ‡å¿—</li>
</ul>
</li>
</ul>
</blockquote>
<p>åè¿‡æ¥ï¼ŒæŸ¥è¯¢ <a href="https://cdn.jsdelivr.net/gh/chensoul/blog.chensoul.com/static/images/">https://cdn.jsdelivr.net/gh/chensoul/blog.chensoul.com/static/images/</a> ä¸‹çš„å›¾ç‰‡åœ°å€æ›¿æ¢ <code>/img</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">grep -lr --null <span class="s1">&#39;](https://cdn.jsdelivr.net/gh/chensoul/blog.chensoul.com/static/images/&#39;</span> <span class="p">|</span> xargs -0 sed -i <span class="s1">&#39;&#39;</span> <span class="s1">&#39;s/](https:\/\/cdn.jsdelivr.net\/gh\/chensoul\/blog.chensoul.com\/static\/img\//](\/img\//g&#39;</span>
</span></span></code></pre></div><p>å¦å¤–ï¼Œåœ¨åšå®¢ç¼–è¯‘éƒ¨ç½²çš„æµç¨‹ä¹‹ä¸­ï¼Œå¯ä»¥å®šåˆ¶åŒ–ä¸€äº›æ­¥éª¤å°†åšå®¢åŒæ­¥å‘å¸ƒåˆ°å…¶ä»–ç³»ç»Ÿã€‚å½“ç„¶ï¼Œåœ¨å‘å¸ƒä¹‹å‰ï¼Œä¹Ÿå¯ä»¥å…ˆå°†æœ¬åœ°å›¾ç‰‡çš„ url æ›¿æ¢æˆå›¾åºŠåœ°å€çš„ urlã€‚ç­‰åç»­å®ç°äº†ï¼Œå†å‘å¸ƒä¸€ç¯‡æ–‡ç« ã€‚</p>
<p>å¦‚æœ github æˆ–è€… jsdelivr æœåŠ¡ä¸ç¨³å®šï¼Œåˆ™éœ€è¦è€ƒè™‘ä½¿ç”¨å…¶ä»–å›¾åºŠäº†ã€‚</p>
<blockquote>
<p>å¯ä»¥é€šè¿‡è¿™ä¸ªåœ°å€ <a href="https://tcp.ping.pe/">https://tcp.ping.pe/</a> æ¥æ£€æµ‹ IP æˆ–è€…åŸŸåæ˜¯å¦å¯ä»¥è®¿é—®</p>
</blockquote>
]]></content:encoded>
    </item>
    
    <item>
      <title>Macå¼€å‘ç¯å¢ƒé…ç½®</title>
      <link>https://blog.chensoul.com/posts/2021/09/09/mac-development-environment-setup/</link>
      <pubDate>Thu, 09 Sep 2021 18:14:34 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2021/09/09/mac-development-environment-setup/</guid>
      <description>è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œä½œä¸ºç¨‹åºå‘˜ï¼Œé¦–å…ˆè¦åšå¾—ç¬¬ä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯é…ç½®å¥½å¼€å‘ç¯å¢ƒï¼Œå› ä¸ºæˆ‘ä½¿ç”¨çš„æ˜¯Macå¼€å‘ç¯å¢ƒï¼Œæ‰€ä»¥ï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯åŸºäºMacæ“ä½œç³»</description>
      <content:encoded><![CDATA[<p>è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œä½œä¸ºç¨‹åºå‘˜ï¼Œé¦–å…ˆè¦åšå¾—ç¬¬ä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯é…ç½®å¥½å¼€å‘ç¯å¢ƒï¼Œå› ä¸ºæˆ‘ä½¿ç”¨çš„æ˜¯Macå¼€å‘ç¯å¢ƒï¼Œæ‰€ä»¥ï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯åŸºäºMacæ“ä½œç³»ç»Ÿï¼Œè®°å½•å¼€å‘ç¯å¢ƒæ­å»ºè¿‡ç¨‹ã€‚</p>
<h2 id="åå¥½è®¾ç½®">åå¥½è®¾ç½®</h2>
<ul>
<li>ç³»ç»Ÿæ‰€æœ‰åå¥½è®¾ç½®
<ul>
<li>é€šç”¨ï¼šå…³é—­æ–‡ç¨¿æ—¶è¦æ±‚ä¿å­˜æ›´æ”¹</li>
<li>Siriï¼šå…³é—­</li>
<li>è¾…åŠ©åŠŸèƒ½ - æŒ‡é’ˆæ§åˆ¶ï¼ˆæˆ–é¼ æ ‡ä¸è§¦æ§æ¿ï¼‰ - è§¦æ§æ¿é€‰é¡¹ï¼šå¯åŠ¨æ‹–ç§»(ä¸‰æŒ‡æ‹–ç§»)</li>
<li>è§¦æ§æ¿ &gt; å…‰æ ‡ä¸ç‚¹å‡»ï¼Œè½»æ‹æ¥ç‚¹æŒ‰ï¼Œè¾…åŠ©ç‚¹æŒ‰</li>
<li>Dock
<ul>
<li>ç½®äºå±å¹•ä¸Šçš„ä½ç½®ï¼šå³è¾¹</li>
<li>è®¾ç½® Dock å›¾æ ‡æ›´å°ï¼ˆå¤§å°éšä¸ªäººå–œå¥½ï¼‰</li>
</ul>
</li>
</ul>
</li>
<li>Finder
<ul>
<li>æ˜¾ç¤ºå„ç§æ </li>
<li>æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶æ‰©å±•å</li>
<li>æ ‡é¢˜æ æ˜¾ç¤ºå®Œæ•´è·¯å¾„ï¼šdefaults write com.apple.finder _FXShowPosixPathInTitle -bool YES;killall Finder</li>
</ul>
</li>
<li>ç¦ç”¨å¤§éƒ¨åˆ† iCloud åŒæ­¥</li>
<li>é”®ç›˜ -&gt; å¿«æ·é”®
<ul>
<li>command + ç©ºæ ¼ï¼šspotlightÂ Â </li>
<li>control + ç©ºæ ¼ï¼šåˆ‡æ¢è¾“å…¥æ³•</li>
</ul>
</li>
</ul>
<h2 id="å®‰è£…xcode">å®‰è£…XCode</h2>
<p>ä» App store æˆ–è‹¹æœå¼€å‘è€…ç½‘ç«™å®‰è£… <a href="https://developer.apple.com/xcode/">Xcode</a> ï¼Œç„¶åå®‰è£… Xcode command line toolsï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">xcode-select --install
</span></span></code></pre></div><p>å®‰è£…å®Œæˆåï¼Œä½ å°†å¯ä»¥ç›´æ¥åœ¨ terminal ä¸­ä½¿ç”¨ä¸»è¦çš„å‘½ä»¤ï¼Œæ¯”å¦‚ï¼š<code>make, GCC, clang, perl, svn, git, size, strip, strings, libtool, cpp</code>ç­‰ç­‰ã€‚</p>
<p>å¦‚æœä½ æƒ³äº†è§£ Xcode command line tools åŒ…å«å¤šå°‘å¯ç”¨çš„å‘½ä»¤ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤æŸ¥çœ‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ls /Library/Developer/CommandLineTools/usr/bin/
</span></span></code></pre></div><h2 id="homebrew">Homebrew</h2>
<p><a href="http://brew.sh/">Brew</a> æ˜¯ Mac ä¸‹é¢çš„åŒ…ç®¡ç†å·¥å…·ï¼Œé€šè¿‡ Github æ‰˜ç®¡é€‚åˆ Mac çš„ç¼–è¯‘é…ç½®ä»¥åŠ Patchï¼Œå¯ä»¥æ–¹ä¾¿çš„å®‰è£…å¼€å‘å·¥å…·ã€‚</p>
<p>æ‰“å¼€ç»ˆç«¯æ¨¡æ‹Ÿå™¨ï¼Œå¼€å§‹å®‰è£…</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">/bin/bash -c <span class="s2">&#34;</span><span class="k">$(</span>curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh<span class="k">)</span><span class="s2">&#34;</span>
</span></span></code></pre></div><p>æ›¿æ¢ brew.git æº</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git -C <span class="s2">&#34;</span><span class="k">$(</span>brew --repo<span class="k">)</span><span class="s2">&#34;</span> remote set-url origin https://mirrors.cloud.tencent.com/homebrew/brew.git
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">git -C <span class="s2">&#34;</span><span class="k">$(</span>brew --repo homebrew/core<span class="k">)</span><span class="s2">&#34;</span> remote set-url origin https://mirrors.cloud.tencent.com//homebrew/homebrew-core.git
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">brew update
</span></span></code></pre></div><p>è®¾ç½®ç¯å¢ƒå˜é‡ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s1">&#39;eval &#34;$(/opt/homebrew/bin/brew shellenv)&#34;&#39;</span> &gt;&gt; ~/.bash_profile
</span></span></code></pre></div><p>å¦‚æœå®‰è£…äº†zshï¼Œåˆ™æ˜¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s1">&#39;eval &#34;$(/opt/homebrew/bin/brew shellenv)&#34;&#39;</span> &gt;&gt; ~/.zshrc
</span></span></code></pre></div><h2 id="ç»ˆç«¯">ç»ˆç«¯</h2>
<h3 id="iterm2">iTerm2</h3>
<p>iTerm2 æ˜¯ macOS ç³»ç»Ÿç»ˆç«¯çš„å¼€æºæ›¿ä»£å“ï¼Œå®ƒæ˜¯é«˜åº¦å¯å®šåˆ¶åŒ–çš„ï¼Œå¹¶ä¸”åŠŸèƒ½ååˆ†å¼ºå¤§ï¼Œåº”è¯¥æ˜¯ macOS æœ€å¥½ç”¨çš„ç»ˆç«¯æ¨¡æ‹Ÿå™¨ä¹‹ä¸€ã€‚</p>
<h4 id="å®‰è£…">å®‰è£…</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">brew install --cask iterm2
</span></span></code></pre></div><p>è®¾ç½®ï¼š</p>
<ul>
<li>Preferences &ndash;&gt; Profiles&ndash;&gt; Default &ndash;&gt; Terminalï¼šè®¾ç½® cursor é¢œè‰²ä¸ºé»„è‰²</li>
<li>Preferences &ndash;&gt; Profiles &ndash;&gt; Window &ndash;&gt; Transparencyï¼šè®¾ç½®é€æ˜åº¦ 10%~20% å³å¯ï¼Œå¤ªé«˜ä¼šå’Œæ¡Œé¢èƒŒæ™¯å†²çªã€‚å¦‚æœéœ€è¦ä¸´æ—¶ç¦ç”¨é€æ˜åº¦å¯ä»¥ä½¿ç”¨å¿«æ·é”® âŒ˜+uã€‚</li>
</ul>
<h4 id="å­—ä½“">å­—ä½“</h4>
<p>åœ¨ iTerm2 ä¸­ï¼Œç»ˆç«¯çš„å­—ä½“å¯ä»¥å¯¹æ­£å¸¸å­—ä½“å’Œé ASCII å­—ä½“è¿›è¡Œå•ç‹¬çš„è®¾ç½®ï¼Œ<a href="https://github.com/ryanoasis/nerd-fonts">Nerd-Fonts</a> æ˜¯ä¸€ä¸ªä½¿ç”¨å¤§é‡å­—å½¢ï¼ˆå›¾æ ‡ï¼‰ä¿®è¡¥å¼€å‘äººå‘˜ç›®æ ‡å­—ä½“çš„é¡¹ç›®</p>
<p>åˆ†åˆ«å®‰è£…  <a href="https://github.com/ryanoasis/nerd-fonts">font-fantasque-sans-mono-nerd-font</a> + <a href="https://github.com/lxgw/LxgwWenKai">éœé¹œæ–‡æ¥·</a>  è¿™ä¸¤ç§å­—ä½“</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># brew æ·»åŠ å­—ä½“åº“</span>
</span></span><span class="line"><span class="cl">brew tap homebrew/cask-fonts
</span></span><span class="line"><span class="cl"><span class="c1"># æœç´¢å¯ç”¨ Nerd Font å­—ä½“</span>
</span></span><span class="line"><span class="cl">brew search nerd-font
</span></span><span class="line"><span class="cl"><span class="c1"># ä»¥ font-fantasque-sans-mono-nerd-font ä¸ºä¾‹ï¼ˆæˆ‘æ¯”è¾ƒå–œæ¬¢è¿™ä¸ªå­—ä½“ğŸ¥°ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="c1"># å®‰è£…å–œæ¬¢çš„ nerd-font å­—ä½“</span>
</span></span><span class="line"><span class="cl">brew install font-fantasque-sans-mono-nerd-font
</span></span><span class="line"><span class="cl"><span class="c1"># å®‰è£…ã€Œéœé¹œæ–‡æ¥·ã€å­—ä½“</span>
</span></span><span class="line"><span class="cl">brew install font-lxgw-wenkai
</span></span></code></pre></div><p>é‡æ–°å¯åŠ¨ iTerm2ï¼ŒæŒ‰ <code>âŒ˜</code> + <code>,</code> æ‰“å¼€ iTerm2 çš„åå¥½è®¾ç½®ï¼Œä¿®æ”¹å­—ä½“</p>
<h4 id="å®‰è£…ä¸»é¢˜"><strong>å®‰è£…ä¸»é¢˜</strong></h4>
<p><a href="https://draculatheme.com/iterm">Dracula</a> ä¸»é¢˜å¾ˆå¥½çœ‹ï¼Œä¸‹é¢ç»™ iTerm2 è£…ä¸Š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git clone https://github.com/dracula/iterm.git
</span></span></code></pre></div><p>ç‚¹å‡» <code>import</code> å¯¼å…¥ <code>Dracula.itermcolors</code> æ–‡ä»¶ï¼Œç„¶åé€‰æ‹© <code>Dracula</code> ä¸»é¢˜å³å¯</p>
<h3 id="zsh">Zsh</h3>
<p>macOS ç°åœ¨é»˜è®¤ Shell æ˜¯ Zsh äº†ï¼ˆä»¥å‰æ˜¯ Bashï¼‰ï¼Œä¸‹é¢æˆ‘ä»¬å¯ä»¥ä¸€è¾¹éªŒè¯ä¸€è¾¹ä¿®æ”¹</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># macOS é¢„è®¾çš„ Shell</span>
</span></span><span class="line"><span class="cl">cat /etc/shells
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># List of acceptable shells for chpass(1).</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Ftpd will not allow users to connect who are not using</span>
</span></span><span class="line"><span class="cl"><span class="c1"># one of these shells.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/bin/bash
</span></span><span class="line"><span class="cl">/bin/csh
</span></span><span class="line"><span class="cl">/bin/dash
</span></span><span class="line"><span class="cl">/bin/ksh
</span></span><span class="line"><span class="cl">/bin/sh
</span></span><span class="line"><span class="cl">/bin/tcsh
</span></span><span class="line"><span class="cl">/bin/zsh
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æŸ¥çœ‹å½“å‰æ­£åœ¨ä½¿ç”¨çš„ Shell</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="nv">$SHELL</span>
</span></span><span class="line"><span class="cl">/bin/zsh
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æŸ¥çœ‹ zsh ç‰ˆæœ¬</span>
</span></span><span class="line"><span class="cl">zsh --version
</span></span><span class="line"><span class="cl">zsh 5.9 <span class="o">(</span>arm-apple-darwin21.3.0<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># å°† brew å®‰è£…çš„ zsh è·¯å¾„æ·»åŠ åˆ° /etc/shells</span>
</span></span><span class="line"><span class="cl">sudo sh -c <span class="s2">&#34;echo </span><span class="k">$(</span>which zsh<span class="k">)</span><span class="s2"> &gt;&gt; /etc/shells&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># æ›´æ”¹å½“å‰ä½¿ç”¨çš„ Shell</span>
</span></span><span class="line"><span class="cl">chsh -s <span class="k">$(</span>which zsh<span class="k">)</span>
</span></span><span class="line"><span class="cl">Changing shell <span class="k">for</span> dejavu.
</span></span><span class="line"><span class="cl">Password <span class="k">for</span> dejavu: <span class="c1"># è¾“å…¥å¯†ç å³å¯</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># éªŒè¯å½“å‰ä½¿ç”¨çš„ Shell</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="nv">$SHELL</span>
</span></span><span class="line"><span class="cl">/opt/homebrew/bin/zsh
</span></span></code></pre></div><p>å¦‚æœä½ çš„ macOS ç³»ç»Ÿè¯­è¨€æ˜¯ä¸­æ–‡ï¼Œç»ˆç«¯é‡Œä¼šä½¿ç”¨ç³»ç»Ÿè¯­è¨€ä½œä¸º <code>locale</code> è®¾ç½®ï¼Œæˆ‘æƒ³è¦ç»ˆç«¯é‡Œçš„ Shell æ˜¾ç¤ºè¯­è¨€ä¸ºè‹±è¯­ï¼Œå¯ä»¥ç¼–è¾‘ zsh é…ç½®æ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># ç¼–è¾‘ zsh é…ç½®ç”¨æˆ·</span>
</span></span><span class="line"><span class="cl">vim ~/.zshrc
</span></span><span class="line"><span class="cl"><span class="c1"># åœ¨å¼€å¤´åŠ å…¥ä»¥ä¸‹é…ç½®</span>
</span></span><span class="line"><span class="cl"><span class="c1"># You may need to manually set your language environment</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">LANG</span><span class="o">=</span>en_US.UTF-8
</span></span></code></pre></div><h3 id="oh-my-zsh">oh-my-zsh</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># é€šè¿‡ cURL å®‰è£…</span>
</span></span><span class="line"><span class="cl">sh -c <span class="s2">&#34;</span><span class="k">$(</span>curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh<span class="k">)</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æˆ–æ˜¯é€šè¿‡ Wget å®‰è£…</span>
</span></span><span class="line"><span class="cl">sh -c <span class="s2">&#34;</span><span class="k">$(</span>wget https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh -O -<span class="k">)</span><span class="s2">&#34;</span>
</span></span></code></pre></div><p>oh-my-zsh çš„é»˜è®¤ä¸»é¢˜æ˜¯ <code>robbyrussell</code>ï¼Œä¿®æ”¹ä¸º &ldquo;pygmalion&rdquo;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># ç¼–è¾‘é…ç½®æ–‡ä»¶</span>
</span></span><span class="line"><span class="cl">vim ~/.zshrc
</span></span><span class="line"><span class="cl"><span class="c1"># æ‰¾åˆ° ZSH_THEME å­—æ®µ</span>
</span></span><span class="line"><span class="cl"><span class="nv">ZSH_THEME</span><span class="o">=</span><span class="s2">&#34;robbyrussell&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># å°† robbyrussell æ”¹ä¸º ys å³å¯</span>
</span></span><span class="line"><span class="cl"><span class="nv">ZSH_THEME</span><span class="o">=</span><span class="s2">&#34;pygmalion&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ä½¿é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ</span>
</span></span><span class="line"><span class="cl"><span class="nb">source</span> ~/.zshrc
</span></span></code></pre></div><p>æ¥ä¸‹æ¥å®‰è£…å‡ ä¸ª Zshell + oh-my-zsh çš„å¢å¼ºæ’ä»¶</p>
<h4 id="zsh-z">zsh-z</h4>
<p><a href="https://github.com/agkozak/zsh-z#known-bugs">zsh-z</a> å¿«é€Ÿè·³è½¬åˆ°ç»å¸¸è®¿é—®çš„ç›®å½•ï¼Œæ˜¯ <a href="https://github.com/rupa/z">rupa/z</a> çš„åŸç”Ÿ Zshell ç«¯å£ï¼Œå…·æœ‰é™„åŠ åŠŸèƒ½</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># æºç å®‰è£…</span>
</span></span><span class="line"><span class="cl">git clone https://github.com/agkozak/zsh-z <span class="si">${</span><span class="nv">ZSH_CUSTOM</span><span class="k">:-</span><span class="p">~/.oh-my-zsh/custom</span><span class="si">}</span>/plugins/zsh-z
</span></span><span class="line"><span class="cl"><span class="c1"># ç¼–è¾‘é…ç½®æ–‡ä»¶</span>
</span></span><span class="line"><span class="cl">vim ~/.zshrc
</span></span><span class="line"><span class="cl"><span class="c1"># æ‰¾åˆ° plugins å­—æ®µï¼ŒåŠ å…¥ zsh-autosuggestions</span>
</span></span><span class="line"><span class="cl"><span class="nv">plugins</span><span class="o">=(</span>git zsh-z<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ</span>
</span></span><span class="line"><span class="cl"><span class="nb">source</span> ~/.zshrc
</span></span></code></pre></div><h4 id="zsh-autosuggestions">zsh-autosuggestions</h4>
<p><a href="https://github.com/zsh-users/zsh-autosuggestions">zsh-autosuggestions</a> å¯ä»¥æ ¹æ®å†å²è®°å½•å¯¹è¾“å…¥è¿›è¡Œæç¤ºå’Œå»ºè®®</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># æºç å®‰è£…</span>
</span></span><span class="line"><span class="cl">git clone https://github.com/zsh-users/zsh-autosuggestions <span class="si">${</span><span class="nv">ZSH_CUSTOM</span><span class="k">:-</span><span class="p">~/.oh-my-zsh/custom</span><span class="si">}</span>/plugins/zsh-autosuggestions
</span></span><span class="line"><span class="cl"><span class="c1"># ç¼–è¾‘é…ç½®æ–‡ä»¶</span>
</span></span><span class="line"><span class="cl">vim ~/.zshrc
</span></span><span class="line"><span class="cl"><span class="c1"># æ‰¾åˆ° plugins å­—æ®µï¼ŒåŠ å…¥ zsh-autosuggestions</span>
</span></span><span class="line"><span class="cl"><span class="nv">plugins</span><span class="o">=(</span>git zsh-z zsh-autosuggestions<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ</span>
</span></span><span class="line"><span class="cl"><span class="nb">source</span> ~/.zshrc
</span></span></code></pre></div><h4 id="zsh-syntax-highlighting">zsh-syntax-highlighting</h4>
<p><a href="https://github.com/zsh-users/zsh-syntax-highlighting">zsh-syntax-highlighting</a> å¯ä»¥å¯¹ Shell ä¸­çš„å‘½ä»¤è¿›è¡Œé«˜äº®æ˜¾ç¤º</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git clone https://github.com/zsh-users/zsh-syntax-highlighting.git <span class="si">${</span><span class="nv">ZSH_CUSTOM</span><span class="k">:-</span><span class="p">~/.oh-my-zsh/custom</span><span class="si">}</span>/plugins/zsh-syntax-highlighting
</span></span></code></pre></div><p>ä¿®æ”¹ .zshrc ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">plugins</span><span class="o">=(</span>git mvn zsh-z zsh-autosuggestions zsh-syntax-highlighting<span class="o">)</span>
</span></span></code></pre></div><h2 id="git">Git</h2>
<p>å®‰è£…ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">brew install git
</span></span></code></pre></div><p>æŸ¥çœ‹gitå‘½ä»¤ä½ç½®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">which git
</span></span></code></pre></div><p>é…ç½®ç”¨æˆ·åå’Œé‚®ç®±ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git config --global user.name <span class="s2">&#34;Your Name Here&#34;</span>
</span></span><span class="line"><span class="cl">git config --global user.email <span class="s2">&#34;your_email@youremail.com&#34;</span>
</span></span></code></pre></div><ul>
<li>è¿™äº›é…ç½®ä¼šåŠ åˆ° ~/.gitconfig</li>
</ul>
<p>ä¸ºäº†å°†ä»£ç æ¨é€åˆ° GitHub ä»“åº“ï¼Œå»ºè®®ä½¿ç”¨HTTPSæ–¹æ³•ã€‚å¦‚æœä½ ä¸æƒ³æ¯æ¬¡éƒ½è¾“å…¥ç”¨æˆ·åå’Œå¯†ç çš„è¯ï¼Œå¯ä»¥æŒ‰ç…§æ­¤ <a href="https://help.github.com/articles/set-up-git">æè¿°</a> è¯´çš„é‚£æ ·ï¼Œè¿è¡Œï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git config --global credential.helper osxkeychain
</span></span></code></pre></div><p>è®¾ç½®é»˜è®¤åˆ†æ”¯åç§°ä¸ºmainï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git config --global init.defaultBranch main
</span></span></code></pre></div><p>é…ç½®sshç§˜é’¥ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ssh-keygen -t rsa -C <span class="s2">&#34;your_email@example.com&#34;</span>
</span></span></code></pre></div><p>æ·»åŠ  SSH å…¬é’¥åˆ° ssh-agent ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">eval</span> <span class="s2">&#34;</span><span class="k">$(</span>ssh-agent -s<span class="k">)</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">ssh-add -K ~/.ssh/id_rsa
</span></span></code></pre></div><p>æ·»åŠ SSH å…¬é’¥åˆ° GitHub è´¦æˆ·ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">pbcopy &lt; ~/.ssh/id_rsa.pub
</span></span></code></pre></div><p>æ‰“å¼€ <a href="https://github.com/settings/ssh/new">https://github.com/settings/ssh/new</a>ï¼Œç„¶åæ·»åŠ ã€‚</p>
<p>macOS çš„ Finder ä¼šåœ¨ç›®å½•ä¸‹ç”Ÿæˆä¸€äº›éšè—æ–‡ä»¶ï¼ˆå¦‚ <code>.DS_Store</code>ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ GitHub ç»´æŠ¤çš„ macOS <code>.gitignore</code> æ¨¡æ¿ï¼Œå¹¶è®©å®ƒå¯¹å½“å‰ç”¨æˆ·æ‰€æœ‰çš„ Git å­˜å‚¨åº“éƒ½ç”Ÿæ•ˆ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl https://raw.githubusercontent.com/github/gitignore/master/Global/macOS.gitignore -o ~/.gitignore
</span></span><span class="line"><span class="cl"><span class="c1"># é™„åŠ åˆ°å…¨å±€ .gitignore æ–‡ä»¶</span>
</span></span><span class="line"><span class="cl">git config --global core.excludesfile ~/.gitignore
</span></span></code></pre></div><h2 id="java">Java</h2>
<p>ä¸‹è½½ Oracle JDKï¼š</p>
<ul>
<li><a href="http://support.apple.com/downloads/DL1572/en_US/JavaForOSX2013-05.dmg">jdk6</a></li>
<li><a href="http://download.oracle.com/otn-pub/java/jdk/7u60-b19/jdk-7u60-macosx-x64.dmg">jdk7</a></li>
</ul>
<p>è®¾ç½® java_home ä¸º 1.8:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s1">&#39;export JAVA_HOME=$(/usr/libexec/java_home -v 1.8) &#39;</span> &gt;&gt; ~/.zshrc
</span></span></code></pre></div><p>å®‰è£…OpenJDKï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">brew install openjdk
</span></span></code></pre></div><h3 id="sdkman">SDKMAN</h3>
<p>å®‰è£…ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"> curl -s <span class="s2">&#34;https://get.sdkman.io&#34;</span> <span class="p">|</span> bash
</span></span></code></pre></div><p>å®‰è£…completeï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">source</span> <span class="s2">&#34;</span><span class="nv">$HOME</span><span class="s2">/.sdkman/bin/sdkman-init.sh&#34;</span>
</span></span></code></pre></div><p>æŸ¥çœ‹ç‰ˆæœ¬ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sdk version
</span></span></code></pre></div><p>ä½¿ç”¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#å®‰è£…jdk</span>
</span></span><span class="line"><span class="cl">sdk install java
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#å®‰è£…scala</span>
</span></span><span class="line"><span class="cl">sdk install scala 2.12.1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#å¸è½½</span>
</span></span><span class="line"><span class="cl">sdk uninstall scala 2.11.6
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#æŸ¥çœ‹</span>
</span></span><span class="line"><span class="cl">sdk list
</span></span></code></pre></div><h3 id="maven">Maven</h3>
<p>å®‰è£…ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">brew install maven
</span></span></code></pre></div><h2 id="nodejs">Node.js</h2>
<p>å®‰è£…nodeï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">brew install node
</span></span></code></pre></div><h3 id="nvs">nvs</h3>
<p>Linux / macOS ç¯å¢ƒé€šè¿‡ Git Clone å¯¹åº”çš„é¡¹ç›®å³å¯ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="nb">export</span> <span class="nv">NVS_HOME</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$HOME</span><span class="s2">/.nvs&#34;</span>
</span></span><span class="line"><span class="cl">$ git clone https://github.com/jasongin/nvs --depth<span class="o">=</span><span class="m">1</span> <span class="s2">&#34;</span><span class="nv">$NVS_HOME</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">$ . <span class="s2">&#34;</span><span class="nv">$NVS_HOME</span><span class="s2">/nvs.sh&#34;</span> install
</span></span></code></pre></div><p>åœ¨å›½å†…ç”±äºå¤§å®¶éƒ½æ‡‚çš„åŸå› ï¼Œéœ€è¦æŠŠå¯¹åº”çš„é•œåƒåœ°å€ä¿®æ”¹ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ nvs remote node https://npm.taobao.org/mirrors/node/
</span></span><span class="line"><span class="cl">$ nvs remote
</span></span></code></pre></div><p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤ï¼Œå³å¯éå¸¸ç®€å•çš„å®‰è£… Node.js æœ€æ–°çš„ LTS ç‰ˆæœ¬ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># å®‰è£…æœ€æ–°çš„ LTS ç‰ˆæœ¬</span>
</span></span><span class="line"><span class="cl">$ nvs add lts
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># é…ç½®ä¸ºé»˜è®¤ç‰ˆæœ¬</span>
</span></span><span class="line"><span class="cl">$ nvs link lts
</span></span></code></pre></div><p>å®‰è£…å…¶ä»–ç‰ˆæœ¬ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># å®‰è£…å…¶ä»–ç‰ˆæœ¬å°å°é²œ</span>
</span></span><span class="line"><span class="cl">$ nvs add <span class="m">12</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æŸ¥çœ‹å·²å®‰è£…çš„ç‰ˆæœ¬</span>
</span></span><span class="line"><span class="cl">$ nvs ls
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åœ¨å½“å‰ Shell åˆ‡æ¢ç‰ˆæœ¬</span>
</span></span><span class="line"><span class="cl">$ nvs use <span class="m">12</span>
</span></span></code></pre></div><p>æ›´å¤šæŒ‡ä»¤å‚è§ <code>nvs --help</code> ã€‚</p>
<h2 id="go">Go</h2>
<p>å®‰è£…ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">brew install go
</span></span></code></pre></div><p>è®¾ç½®ç¯å¢ƒå˜é‡ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;export GOPATH=</span><span class="nv">$HOME</span><span class="s2">/workspace/goProjects&#34;</span> &gt;&gt; ~/.zshrc
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;export GOBIN=</span><span class="nv">$GOPATH</span><span class="s2">/bin&#34;</span> &gt;&gt; ~/.zshrc
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;export PATH=</span><span class="nv">$GOPATH</span><span class="s2">:</span><span class="nv">$GOBIN</span><span class="s2">:</span><span class="nv">$PATH</span><span class="s2">&#34;</span> &gt;&gt; ~/.zshrc
</span></span><span class="line"><span class="cl"><span class="nb">source</span> ~/.zshrc
</span></span></code></pre></div><h2 id="python">Python</h2>
<p>MacOS ä¸Šé€šè¿‡ brew å®‰è£…</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">brew install python3
</span></span></code></pre></div><p>æŸ¥çœ‹ python3 å®‰è£…è·¯å¾„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ which python3
</span></span><span class="line"><span class="cl">/opt/homebrew/bin/python3
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ <span class="nb">type</span> python3
</span></span><span class="line"><span class="cl">python3 is /opt/homebrew/bin/python3
</span></span></code></pre></div><p>æŸ¥çœ‹ç‰ˆæœ¬ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">python --version
</span></span></code></pre></div><p>ä¿®æ”¹ ~/.zshrcï¼Œè®¾ç½®ç¯å¢ƒå˜é‡ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PYTHON_HOME</span><span class="o">=</span>/opt/homebrew/opt/python@3.11
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PYTHON_HOME</span>/bin:<span class="nv">$PATH</span>
</span></span><span class="line"><span class="cl"><span class="nb">alias</span> <span class="nv">python</span><span class="o">=</span>python3
</span></span><span class="line"><span class="cl"><span class="nb">alias</span> <span class="nv">pip</span><span class="o">=</span>pip3
</span></span></code></pre></div><p>ä½¿é…ç½®ç”Ÿæ•ˆï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">source</span> ~/.zshrc
</span></span></code></pre></div><h2 id="å‚è€ƒæ–‡ç« ">å‚è€ƒæ–‡ç« </h2>
<ul>
<li><a href="https://sourabhbajaj.com/mac-setup/">https://sourabhbajaj.com/mac-setup/</a></li>
</ul>
]]></content:encoded>
    </item>
    
    <item>
      <title>ä»é›¶å¼€å§‹æ­å»ºä¸ªäººåšå®¢</title>
      <link>https://blog.chensoul.com/posts/2021/09/09/build-personal-blog-from-zero/</link>
      <pubDate>Thu, 09 Sep 2021 18:14:34 +0800</pubDate>
      
      <guid>https://blog.chensoul.com/posts/2021/09/09/build-personal-blog-from-zero/</guid>
      <description>ä»é›¶å¼€å§‹æ­å»ºåšå®¢ï¼ŒåŒ…æ‹¬æ³¨å†ŒåŸŸåã€è´­ä¹°æœåŠ¡å™¨ã€éƒ¨ç½²ç¨‹åºåŠç½‘ç«™é…ç½®å’Œä¼˜åŒ–ã€‚ åŸŸå æ­å»ºä¸€ä¸ªåšå®¢æˆ–è€…ç½‘ç«™ï¼Œéœ€è¦æœ‰ä¸€ä¸ªåŸŸåã€‚é‚£ä»€ä¹ˆæ˜¯åŸŸåå‘¢ï¼Ÿçœ‹çœ‹ç™¾åº¦ç™¾ç§‘</description>
      <content:encoded><![CDATA[<p>ä»é›¶å¼€å§‹æ­å»ºåšå®¢ï¼ŒåŒ…æ‹¬æ³¨å†ŒåŸŸåã€è´­ä¹°æœåŠ¡å™¨ã€éƒ¨ç½²ç¨‹åºåŠç½‘ç«™é…ç½®å’Œä¼˜åŒ–ã€‚</p>
<h2 id="åŸŸå">åŸŸå</h2>
<p>æ­å»ºä¸€ä¸ªåšå®¢æˆ–è€…ç½‘ç«™ï¼Œéœ€è¦æœ‰ä¸€ä¸ªåŸŸåã€‚é‚£ä»€ä¹ˆæ˜¯åŸŸåå‘¢ï¼Ÿçœ‹çœ‹ç™¾åº¦ç™¾ç§‘ä¸Šçš„è§£é‡Šï¼š</p>
<blockquote>
<p><strong>åŸŸå</strong>ï¼ˆè‹±è¯­ï¼š<strong>Domain Name</strong>ï¼‰ï¼Œåˆç§°<strong>ç½‘åŸŸ</strong>ï¼Œæ˜¯ç”±ä¸€ä¸²ç”¨ç‚¹åˆ†éš”çš„åå­—ç»„æˆçš„<a href="https://baike.baidu.com/item/Internet">Internet</a>ä¸ŠæŸä¸€å°<a href="https://baike.baidu.com/item/%E8%AE%A1%E7%AE%97%E6%9C%BA/140338">è®¡ç®—æœº</a>æˆ–è®¡ç®—æœºç»„çš„åç§°ï¼Œç”¨äºåœ¨æ•°æ®ä¼ è¾“æ—¶å¯¹è®¡ç®—æœºçš„å®šä½æ ‡è¯†ï¼ˆæœ‰æ—¶ä¹ŸæŒ‡åœ°ç†ä½ç½®ï¼‰ã€‚</p>
<p>ç”±äº<a href="https://baike.baidu.com/item/IP%E5%9C%B0%E5%9D%80/150859">IPåœ°å€</a>å…·æœ‰ä¸æ–¹ä¾¿è®°å¿†å¹¶ä¸”ä¸èƒ½æ˜¾ç¤ºåœ°å€ç»„ç»‡çš„åç§°å’Œæ€§è´¨ç­‰ç¼ºç‚¹ï¼Œäººä»¬è®¾è®¡å‡ºäº†åŸŸåï¼Œå¹¶é€šè¿‡ç½‘åŸŸåç§°ç³»ç»Ÿï¼ˆ<a href="https://baike.baidu.com/item/DNS">DNS</a>ï¼ŒDomain Name Systemï¼‰æ¥å°†åŸŸåå’Œ<a href="https://baike.baidu.com/item/IP%E5%9C%B0%E5%9D%80">IPåœ°å€</a>ç›¸äº’<a href="https://baike.baidu.com/item/%E6%98%A0%E5%B0%84/20402621">æ˜ å°„</a>ï¼Œä½¿äººæ›´æ–¹ä¾¿åœ°è®¿é—®<a href="https://baike.baidu.com/item/%E4%BA%92%E8%81%94%E7%BD%91/199186">äº’è”ç½‘</a>ï¼Œè€Œä¸ç”¨å»è®°ä½èƒ½å¤Ÿè¢«æœºå™¨ç›´æ¥è¯»å–çš„<a href="https://baike.baidu.com/item/IP%E5%9C%B0%E5%9D%80">IPåœ°å€</a>æ•°ä¸²ã€‚</p>
</blockquote>
<p>ç®€å•æ¥è¯´ï¼ŒIPåœ°å€å¯ä»¥æ ‡è¯†ä¸€å°è®¡ç®—æœºï¼Œä½†æ˜¯ä¸å®¹æ˜“è®°å¿†ï¼Œæ‰€ä»¥ï¼Œè®¾è®¡å‡ºäº†åŸŸåã€‚è€ŒåŸŸåå°±æ˜¯æ ‡è¯†å› ç‰¹ç½‘ä¸Šçš„ä¸€å°è®¡ç®—æœºï¼Œç”±ç½‘åŸŸåç§°ç³»ç»ŸDNSæ¥å®ŒæˆåŸŸåå’ŒIPä¹‹é—´çš„æ˜ å°„ã€‚</p>
<p>å¦‚ä½•æ³¨å†ŒåŸŸåï¼Ÿæœ‰å¾ˆå¤šç½‘ç«™æä¾›åŸŸåæ³¨å†ŒæœåŠ¡ï¼Œæ¯”å¦‚å›½å†…çš„ï¼š</p>
<ul>
<li><a href="https://www.alibabacloud.com/zh/domain">é˜¿é‡Œäº‘</a></li>
<li><a href="https://cloud.tencent.com/act/domainsales">è…¾è®¯äº‘</a></li>
<li><a href="https://www.huaweicloud.com/">åä¸ºäº‘</a></li>
</ul>
<p>å›½å¤–çš„ï¼š</p>
<ul>
<li><a href="https://sg.godaddy.com/zh/offers/domain">GoDaddy</a></li>
<li><a href="https://www.namecheap.com/">Namecheap</a></li>
<li><a href="https://console.aws.amazon.com/route53/home?#DomainRegistration:">Amazon</a></li>
</ul>
<p>æ³¨å†ŒåŸŸåçš„å»ºè®®ï¼š</p>
<ul>
<li>1ã€å»ºè®®åœ¨æ­£è§„ã€å‡ºåçš„ç½‘ç«™æ³¨å†ŒåŸŸåï¼Œé˜²æ­¢ç½‘ç«™è·‘è·¯ã€‚æˆ‘æ›¾ç»åœ¨ä¸€ä¸ªå°ç½‘ç«™æ³¨å†Œäº†ä¸€ä¸ªåŸŸåï¼Œä½¿ç”¨äº†å‡ å¹´ä¹‹åï¼Œç»­æœŸçš„æ—¶å€™ï¼Œè”ç³»ä¸ä¸Šå¯¹æ–¹ï¼Œå¯¼è‡´æ— æ³•ä½¿ç”¨è¯¥åŸŸåï¼Œç”šè‡³è¯¥åŸŸåè¢«åˆ«äººæŠ¢æ³¨å†Œäº†ã€‚</li>
<li>2ã€åœ¨å›½å†…ç½‘ç«™æ³¨å†ŒåŸŸåï¼Œéƒ½éœ€è¦å¤‡æ¡ˆã€‚å¦‚æœä¸æƒ³å¤‡æ¡ˆï¼Œè¯·åœ¨å›½å¤–ç½‘ç«™æ³¨å†ŒåŸŸåã€‚æˆ‘çš„åŸŸå chensoul.com å°±æ˜¯åœ¨äºšé©¬é€Šä¸Šæ³¨å†Œçš„ã€‚ä¸€æ˜¯ä¸æƒ³å¤‡æ¡ˆï¼ŒäºŒæ˜¯å¯¹æ¯”äº†ä¸Šé¢å‡ ä¸ªç½‘ç«™ï¼Œå‘ç°äºšé©¬é€Šä¸Šçš„comåŸŸåä»·æ ¼ç›¸å¯¹ä¾¿å®œï¼Œæ‰€ä»¥ä¸€æ¬¡æ€§è´­ä¹°äº†5å¹´ã€‚</li>
<li>3ã€å»ºè®®ä¼˜å…ˆæ³¨å†ŒcomåŸŸåï¼ŒåŸŸåå°½å¯èƒ½çš„ç®€çŸ­å¹¶ä¸”æ–¹ä¾¿è®°å¿†ã€‚</li>
</ul>
<p>æˆ‘æ›¾ç»æ³¨å†Œè¿‡çš„åŸŸåï¼š</p>
<ul>
<li>javachen.comã€javachen.spaceã€javachen.xyz</li>
<li>huaiu.com</li>
</ul>
<h2 id="æœåŠ¡å™¨">æœåŠ¡å™¨</h2>
<p>æ³¨å†Œäº†åŸŸåä¹‹åï¼Œéœ€è¦ä¸€å°æœåŠ¡å™¨è¿è¡Œç¨‹åºã€‚æœåŠ¡å™¨å¯ä»¥æ˜¯ä¸€å°ç‰©ç†æœºï¼Œæ¯”å¦‚ä½ å¯ä»¥ä½¿ç”¨è‡ªå·±çš„ç”µè„‘ä½œä¸ºæœåŠ¡å™¨ï¼›ä¹Ÿå¯ä»¥æ˜¯ä¸€å°è™šæ‹Ÿçš„äº‘æœåŠ¡å™¨ï¼Œæ¯”å¦‚åœ¨äº‘æœåŠ¡æä¾›å•†è´­ä¹°ä¸€å°ç‹¬ç«‹çš„æœåŠ¡å™¨ï¼›ä¹Ÿå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹æä¾›çš„æœåŠ¡å™¨ç©ºé—´ï¼Œæ¯”å¦‚Githubä¸Šå¯ä»¥éƒ¨ç½²é™æ€ç¨‹åºã€‚ä¸ç®¡å“ªç§æ–¹å¼ï¼ŒæœåŠ¡å™¨éƒ½éœ€è¦æœ‰ä¸€ä¸ªå…¬ç½‘IPï¼Œè¿™æ ·æ‰èƒ½åœ¨å› ç‰¹ç½‘ä¸Šè®¿é—®ä½ æœåŠ¡å™¨ä¸Šéƒ¨ç½²çš„ç¨‹åºã€‚æœ‰äº†æœåŠ¡å™¨ä¹‹åï¼Œå°±å¯ä»¥ç»™æœåŠ¡å™¨å…¬ç½‘IPè®¾ç½®åŸŸåè§£æã€‚</p>
<p>æˆ‘çš„æœåŠ¡å™¨æ˜¯åœ¨<a href="https://bandwagonhost.com/aff.php?aff=58710">æ¬ç“¦å·¥</a>è´­ä¹°çš„ï¼Œä¸€å¹´49.99ç¾å…ƒã€‚</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/bwg-plan.png" alt="bwg-plan"  />
</p>
<h2 id="ç¨‹åº">ç¨‹åº</h2>
<h3 id="å®‰è£…hugo">å®‰è£…Hugo</h3>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/hugo-logo.svg" alt="ä½¿ç”¨ Hugo æ­å»ºåšå®¢"  />
</p>
<p>åœ¨ Mac ä¸‹å®‰è£… Hugoï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">brew install hugo
</span></span></code></pre></div><h3 id="æ–°å»ºç«™ç‚¹">æ–°å»ºç«™ç‚¹</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">hugo new site chensoul.github.io -y yaml
</span></span></code></pre></div><p>ä¸Šè¿°å‘½ä»¤ä¼šç”Ÿæˆä¸€ä¸ªåä¸º <code>chensoul.github.io</code> çš„æ–‡ä»¶å¤¹ï¼Œä¸‹é¢å¯¹æ–‡ä»¶å¤¹ç»“æ„åšä¸ªè¯´æ˜ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ tree chensoul.github.io
</span></span><span class="line"><span class="cl">chensoul.github.io
</span></span><span class="line"><span class="cl">â”œâ”€â”€ archetypes
</span></span><span class="line"><span class="cl">â”‚   â””â”€â”€ default.md
</span></span><span class="line"><span class="cl">â”œâ”€â”€ config.yaml
</span></span><span class="line"><span class="cl">â”œâ”€â”€ content
</span></span><span class="line"><span class="cl">â”œâ”€â”€ data
</span></span><span class="line"><span class="cl">â”œâ”€â”€ layouts
</span></span><span class="line"><span class="cl">â”œâ”€â”€ static
</span></span><span class="line"><span class="cl">â””â”€â”€ themes
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="m">6</span> directories, <span class="m">2</span> files
</span></span></code></pre></div><p>æ–°å»ºçš„ç«™ç‚¹ï¼Œè¿˜æ²¡æœ‰åŠ å…¥ Git ç‰ˆæœ¬ç®¡ç†ï¼Œè¿›å…¥åˆ°è¿™ä¸ªç›®å½•ä¸‹ï¼Œæ‰§è¡Œä¸€ä¸‹å¦‚ä¸‹å‘½ä»¤ï¼Œå®Œæˆ Git Repo çš„åˆå§‹åŒ–ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> chensoul.github.io
</span></span><span class="line"><span class="cl">git init .
</span></span></code></pre></div><p>æ–°å»ºç«™ç‚¹åï¼Œæˆ‘ä»¬å¼€å§‹æ·»åŠ ä¸»é¢˜ã€‚</p>
<h3 id="æ·»åŠ ä¸»é¢˜">æ·»åŠ ä¸»é¢˜</h3>
<p>åœ¨ Hugo çš„å®˜ç½‘ä¸Š <a href="https://themes.gohugo.io/">Hugo Themes</a> æœ‰éå¸¸éå¸¸å¤šçš„ä¸»é¢˜ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„å–œå¥½é€‰æ‹©ä¸€ä¸ªä¸»é¢˜ã€‚è¿™é‡Œï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ hugo-theme-den ä¸»é¢˜ã€‚</p>
<p>ä½¿ç”¨ git submodule&ndash;helper ä¸‹è½½ä¸»é¢˜åˆ° theme ç›®å½•ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">git submodule--helper add https://github.com/shaform/hugo-theme-den themes/den --depth<span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">git submodule--helper update --init --recursive <span class="c1"># needed when you reclone your repo (submodules may not get cloned automatically)</span>
</span></span></code></pre></div><p>ä»¥åï¼Œå½“ä¸»é¢˜æœ‰æ›´æ–°æ—¶ï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤æ›´æ–°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git submodule update --remote --merge
</span></span></code></pre></div><p>å¦‚æœé‡åˆ°å¼‚å¸¸ï¼Œå¯ä»¥å‚è€ƒ<a href="https://xuzhijvn.github.io/zh-cn/posts/other/git-submodule-update-init-recursive/">æ–‡ç« </a>è§£å†³ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">fatal: remote error: upload-pack: not our ref fc7223ca00124e8f5b5b354457379071e2fd091b
</span></span></code></pre></div><h3 id="å¯åŠ¨">å¯åŠ¨</h3>
<p>å¯åŠ¨é¢„è§ˆï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">hugo server
</span></span></code></pre></div><p>é»˜è®¤æ˜¯ <code>1313</code> ç«¯å£å·ï¼Œåœ¨æµè§ˆå™¨ä¸­ç›´æ¥è®¿é—® http://localhost:1313/ å°±å¯ä»¥è®¿é—®åˆ°æ–°å»ºçš„åšå®¢äº†ã€‚</p>
<h2 id="å®šåˆ¶åŒ–">å®šåˆ¶åŒ–</h2>
<h3 id="ç«™ç‚¹ä¿¡æ¯">ç«™ç‚¹ä¿¡æ¯</h3>
<p>é…ç½®ç½‘ç«™çš„åŸºæœ¬ä¿¡æ¯ï¼Œå°† config.yaml ä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">baseURL: https://blog.chensoul.com/
</span></span><span class="line"><span class="cl">title: ChenSoul
</span></span><span class="line"><span class="cl">theme: den
</span></span><span class="line"><span class="cl">enableRobotsTXT: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">enableEmoji: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">hasCJKLanguage: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">preserveTaxonomyNames: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">rssLimit: <span class="m">100</span>
</span></span><span class="line"><span class="cl">page_view_conter: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">enableRelated: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Copyright, appears in the footer</span>
</span></span><span class="line"><span class="cl"><span class="c1"># copyright = &#34;&#34;             # default: author.name</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Pagination</span>
</span></span><span class="line"><span class="cl"><span class="c1"># number of entries per page for archives, tags and categories</span>
</span></span><span class="line"><span class="cl"><span class="c1"># since we don&#39;t have list view, recommend a large value</span>
</span></span><span class="line"><span class="cl">paginate: <span class="m">20</span>
</span></span><span class="line"><span class="cl">paginatePath: <span class="s2">&#34;page&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Syntax Hightlight</span>
</span></span><span class="line"><span class="cl">PygmentsCodeFences: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">PygmentsUseClasses: <span class="nb">true</span>    <span class="c1"># required for shhighlight shortcode</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># service plugins</span>
</span></span><span class="line"><span class="cl">disqusShortname: <span class="s2">&#34;&#34;</span>         <span class="c1"># disqus_shortname</span>
</span></span><span class="line"><span class="cl">googleAnalytics: <span class="s2">&#34;&#34;</span>         <span class="c1"># UA-XXXXXXXX-X</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># language support # en / zh / other... translations present in i18n/</span>
</span></span><span class="line"><span class="cl">defaultContentLanguage: <span class="s2">&#34;zh&#34;</span>           <span class="c1"># Default language to use</span>
</span></span><span class="line"><span class="cl">defaultContentLanguageInSubdir: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">permalinks:
</span></span><span class="line"><span class="cl">  posts: /posts/:slug/
</span></span><span class="line"><span class="cl">  categories: /categories/:slug/
</span></span><span class="line"><span class="cl">  tags: /tags/:slug/
</span></span><span class="line"><span class="cl">  pages: /:slug/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">author:
</span></span><span class="line"><span class="cl">  name: chensoul
</span></span><span class="line"><span class="cl">sitemap:
</span></span><span class="line"><span class="cl">  changefreq: weekly
</span></span><span class="line"><span class="cl">  priority: 0.5
</span></span><span class="line"><span class="cl">  filename: sitemap.xml
</span></span><span class="line"><span class="cl">params:
</span></span><span class="line"><span class="cl">  since: <span class="s2">&#34;2020&#34;</span>
</span></span><span class="line"><span class="cl">  rssFullContent: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">  keywords:
</span></span><span class="line"><span class="cl">    - devops
</span></span><span class="line"><span class="cl">    - programming
</span></span><span class="line"><span class="cl">  description: Programming <span class="p">|</span> Devops
</span></span><span class="line"><span class="cl">  logoTitle: ChenSoul
</span></span><span class="line"><span class="cl">  siteLogoImage: images/fly.png
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># headerTitle = &#34;chensoul&#34;                   # default: title</span>
</span></span><span class="line"><span class="cl">  headerImage: images/background.webp
</span></span><span class="line"><span class="cl">  showAuthorCard: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">  showMenuLanguages: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">  autoLoadComments: <span class="nb">false</span>
</span></span><span class="line"><span class="cl">  paginateOriginalStyle: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># The date format to use; for a list of valid formats, see https://gohugo.io/functions/format/</span>
</span></span><span class="line"><span class="cl">  dateFormatToUse: 2006-01-02
</span></span><span class="line"><span class="cl">  google_verification: <span class="s2">&#34;D8XBzUhT4irNUQLKut79HFni0v3Xow4FY-oxUcsUlVk&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Link custom CSS and JS assets</span>
</span></span><span class="line"><span class="cl">  <span class="c1">#   (relative to /static/css and /static/js respectively)</span>
</span></span><span class="line"><span class="cl">  customCSS: <span class="o">[]</span>
</span></span><span class="line"><span class="cl">  customJS: <span class="o">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">markup:
</span></span><span class="line"><span class="cl">  goldmark:
</span></span><span class="line"><span class="cl">    renderer:
</span></span><span class="line"><span class="cl">      unsafe: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ------------------------------------- #</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ---- Related Articles --------------- #</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ------------------------------------- #</span>
</span></span><span class="line"><span class="cl">related:
</span></span><span class="line"><span class="cl">  <span class="c1"># Only include matches with rank &gt;= threshold. This is a normalized rank between 0 and 100.</span>
</span></span><span class="line"><span class="cl">  threshold: <span class="m">50</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># To get stable &#34;See also&#34; sections we, by default, exclude newer related pages.</span>
</span></span><span class="line"><span class="cl">  includeNewer: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1"># Will lower case keywords in both queries and in the indexes.</span>
</span></span><span class="line"><span class="cl">  toLower: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  indices:
</span></span><span class="line"><span class="cl">    - name: categories
</span></span><span class="line"><span class="cl">      weight: <span class="m">200</span>
</span></span><span class="line"><span class="cl">    - name: keywords
</span></span><span class="line"><span class="cl">      weight: <span class="m">150</span>
</span></span><span class="line"><span class="cl">    - name: tags
</span></span><span class="line"><span class="cl">      weight: <span class="m">100</span>
</span></span><span class="line"><span class="cl">languages:
</span></span><span class="line"><span class="cl">  zh:
</span></span><span class="line"><span class="cl">    languageCode: zh
</span></span><span class="line"><span class="cl">    languageName: ä¸­æ–‡
</span></span><span class="line"><span class="cl">    contentDir: content
</span></span><span class="line"><span class="cl">    weight: <span class="m">1</span>
</span></span><span class="line"><span class="cl">    params:
</span></span><span class="line"><span class="cl">      description: Devops <span class="p">|</span> Programming
</span></span><span class="line"><span class="cl">    menu:
</span></span><span class="line"><span class="cl">      main:
</span></span><span class="line"><span class="cl">        - name: æ€è€ƒ
</span></span><span class="line"><span class="cl">          weight: <span class="m">10</span>
</span></span><span class="line"><span class="cl">          identifier: idea
</span></span><span class="line"><span class="cl">          url: categories/idea/
</span></span><span class="line"><span class="cl">      social:
</span></span><span class="line"><span class="cl">        - name: Telegram
</span></span><span class="line"><span class="cl">          weight: <span class="m">10</span>
</span></span><span class="line"><span class="cl">          identifier: telegram
</span></span><span class="line"><span class="cl">          url: https://t.me/chensoul_share
</span></span><span class="line"><span class="cl">        - name: Twitter
</span></span><span class="line"><span class="cl">          weight: <span class="m">20</span>
</span></span><span class="line"><span class="cl">          identifier: twitter
</span></span><span class="line"><span class="cl">          url: https://twitter.com/chensoul_eth
</span></span><span class="line"><span class="cl">        - name: BiliBili
</span></span><span class="line"><span class="cl">          weight: <span class="m">40</span>
</span></span><span class="line"><span class="cl">          identifier: bilibili
</span></span><span class="line"><span class="cl">          url: https://space.bilibili.com/699805065/
</span></span><span class="line"><span class="cl">      links:
</span></span><span class="line"><span class="cl">        - name: GitHub
</span></span><span class="line"><span class="cl">          weight: <span class="m">10</span>
</span></span><span class="line"><span class="cl">          identifier: github
</span></span><span class="line"><span class="cl">          url: https://github.com/chensoul
</span></span><span class="line"><span class="cl">        - name: Services
</span></span><span class="line"><span class="cl">          weight: <span class="m">20</span>
</span></span><span class="line"><span class="cl">          identifier: services-status
</span></span><span class="line"><span class="cl">          url: https://uptime.chensoul.com/status/services
</span></span><span class="line"><span class="cl">        - name: Analytics
</span></span><span class="line"><span class="cl">          weight: <span class="m">30</span>
</span></span><span class="line"><span class="cl">          identifier: chensoul-analytics
</span></span><span class="line"><span class="cl">          url: https://data.chensoul.com/share/8YKX7FUa/pseudoyu-blog
</span></span></code></pre></div><h2 id="éƒ¨ç½²">éƒ¨ç½²</h2>
<h3 id="github-actionséƒ¨ç½²">GitHub Actionséƒ¨ç½²</h3>
<p><strong>1ã€é¦–å…ˆåœ¨githubé‡Œåˆ›å»ºä¸€ä¸ªä»“åº“ï¼šchensoul.github.io</strong></p>
<p><strong>2ã€å°†æœ¬åœ°æ–‡ä»¶æäº¤åˆ°github</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> chensoul.github.io
</span></span><span class="line"><span class="cl">git init .
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;# chensoul.github.io&#34;</span> &gt;&gt; README.md
</span></span><span class="line"><span class="cl">git remote add origin git@github.com:chensoul/chensoul.github.io.git
</span></span></code></pre></div><p><strong>3ã€å°†æœ¬åœ°ä»£ç æ¨é€åˆ°ä»“åº“</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git commit -m <span class="s2">&#34;first commit&#34;</span>
</span></span><span class="line"><span class="cl">git push -u origin main
</span></span></code></pre></div><p><strong>4ã€åˆ›å»º GitHub Actions çš„ workflow</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir -p .github/workflows
</span></span><span class="line"><span class="cl">touch .github/workflows/gh-page.yml
</span></span></code></pre></div><p>gh-page.ymlå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">github pages</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">workflow_dispatch</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">push</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">hugo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">jobs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">deploy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-18.04</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">timeout-minutes</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Checkout</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">actions/checkout@v2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">submodules</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">  </span><span class="c"># Fetch Hugo themes (true OR recursive)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">fetch-depth</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">    </span><span class="c"># Fetch all history for .GitInfo and .Lastmod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Setup hugo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">peaceiris/actions-hugo@v2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">hugo-version</span><span class="p">:</span><span class="w"> </span><span class="l">latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">extended</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Build web</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l">hugo --minify</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Deploy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">peaceiris/actions-gh-pages@v3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">github_token</span><span class="p">:</span><span class="w"> </span><span class="l">${{ secrets.GITHUB_TOKEN }}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">publish_branch</span><span class="p">:</span><span class="w"> </span><span class="l">gh-pages</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">publish_dir</span><span class="p">:</span><span class="w"> </span><span class="l">./public</span><span class="w">
</span></span></span></code></pre></div><p>ä¸Šé¢çš„å·¥ä½œæµæ˜¯åœ¨ gh-pages åˆ†æ”¯ä¸Šè§¦å‘ï¼Œå½“æœ‰ä»£ç æäº¤æ—¶å€™ï¼Œä¼šè¿è¡Œ hugo å‘½ä»¤ç”Ÿæˆé™æ€æ–‡ä»¶ï¼ˆpublicç›®å½•ï¼‰ï¼Œå¹¶ä¸”å°†ä»–ä»¬æ¨é€åˆ°mainåˆ†æ”¯ã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦åŸºäºå½“å‰åˆ†æ”¯åˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯ gh-pages ï¼Œå¹¶ä¸”æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git branch gh-pages
</span></span><span class="line"><span class="cl">git checkout gh-pages
</span></span><span class="line"><span class="cl">git push origin gh-pages
</span></span></code></pre></div><p><strong>5ã€ä¿®æ”¹ä»£ç ï¼Œæ¨é€åˆ°ä»“åº“ï¼Œè§¦å‘å·¥ä½œæµ</strong></p>
<p>åœ¨æœ¬åœ°ä¿®æ”¹æŸä¸ªæ–‡ä»¶ï¼Œæäº¤ä»£ç ï¼Œç„¶ååœ¨ github <a href="https://github.com/chensoul/chensoul.github.io/actions">ç½‘ç«™</a> æŸ¥çœ‹å·¥ä½œæµ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git push origin gh-pages
</span></span></code></pre></div><p><strong>7ã€è®¾ç½®è‡ªå®šä¹‰åŸŸå</strong></p>
<p>å‚è€ƒ<a href="https://docs.github.com/cn/pages/configuring-a-custom-domain-for-your-github-pages-site/managing-a-custom-domain-for-your-github-pages-site#configuring-a-subdomain">ç®¡ç† GitHub Pages ç«™ç‚¹çš„è‡ªå®šä¹‰åŸŸ</a>ï¼Œæ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰åŸŸåï¼šblog.chensoul.comï¼š</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/github-page-settings.png" alt="github-page-settings"  />
</p>
<p>æˆ–è€…ï¼Œåœ¨ä»“åº“çš„ static ç›®å½•åˆ›å»ºä¸€ä¸ªCNAMEæ–‡ä»¶ï¼Œå†…å®¹ä¸ºï¼šblog.chensoul.comï¼Œç„¶åï¼Œä¿å­˜æäº¤ï¼ŒGithub Actionsä¼šå°†è¯¥æ–‡ä»¶æ¨é€åˆ°mainåˆ†æ”¯ã€‚</p>
<p>ç„¶åï¼Œåœ¨äºšé©¬é€Šç½‘ç«™æ·»åŠ  <a href="https://console.aws.amazon.com/route53/v2/hostedzones#">CNAMEè®°å½•</a>ï¼š</p>
<p><img loading="lazy" src="https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/amazon-dns-settings.png" alt="amazon-dns-settings"  />
</p>
<p>8ã€éƒ¨ç½²åˆ° CloudFlare Pages</p>
<p>å‚è€ƒ <a href="https://hee.ink/p/%E4%BB%8E-github-pages-%E8%BF%81%E7%A7%BB%E5%88%B0-cloudflare-pages-%E7%9A%84%E4%BD%93%E9%AA%8C%E4%B8%8E%E8%B8%A9%E5%9D%91%E5%B0%8F%E8%AE%B0/">ä» GitHub Pages è¿ç§»åˆ° CloudFlare Pages çš„ä½“éªŒä¸è¸©å‘å°è®°</a></p>
]]></content:encoded>
    </item>
    
  </channel>
</rss>
