<!doctype html><html lang=zh itemscope itemtype=http://schema.org/WebPage><head><meta name=generator content="Hugo 0.109.0"><meta charset=utf-8><title>Doris安装和部署 · ChenSoul</title><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=description content="《后来的我们 - 五月天》 一、环境准备 1、安装要求 CPU：2C（最低）8C（推荐） 内存：4G（最低）48G（推荐） 硬盘：100G（最低）400G"><meta name=keywords content="devops,programming"><meta name=google-site-verification content="D8XBzUhT4irNUQLKut79HFni0v3Xow4FY-oxUcsUlVk"><link rel=canonical href=https://blog.chensoul.com/posts/2022/08/18/doris-install-deploy/><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css integrity=sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.2.0/css/all.min.css integrity="sha512-6c4nX2tn5KbzeBJo9Ywpa0Gkt+mzCzJBrE1RB6fmpcsoN+b/w/euwIMuQKNyUoU/nToKN3a8SgNOtPrbW12fug==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=https://blog.chensoul.com/css/den.css><link rel=stylesheet href=https://blog.chensoul.com/css/custom.css><meta property="og:title" content="Doris安装和部署"><meta property="og:description" content="《后来的我们 - 五月天》 一、环境准备 1、安装要求 CPU：2C（最低）8C（推荐） 内存：4G（最低）48G（推荐） 硬盘：100G（最低）400G"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.chensoul.com/posts/2022/08/18/doris-install-deploy/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-18T09:47:03+08:00"><meta property="article:modified_time" content="2022-08-18T09:47:03+08:00"><meta itemprop=name content="Doris安装和部署"><meta itemprop=description content="《后来的我们 - 五月天》 一、环境准备 1、安装要求 CPU：2C（最低）8C（推荐） 内存：4G（最低）48G（推荐） 硬盘：100G（最低）400G"><meta itemprop=datePublished content="2022-08-18T09:47:03+08:00"><meta itemprop=dateModified content="2022-08-18T09:47:03+08:00"><meta itemprop=wordCount content="2784"><meta itemprop=keywords content="doris,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Doris安装和部署"><meta name=twitter:description content="《后来的我们 - 五月天》 一、环境准备 1、安装要求 CPU：2C（最低）8C（推荐） 内存：4G（最低）48G（推荐） 硬盘：100G（最低）400G"></head><body><div class=header-container style=background:linear-gradient(rgba(0,0,0,.2),rgba(0,0,0,.2)),url(https://blog.chensoul.com/images/background.webp);background-position:50%;background-size:cover><div class=container><nav class="header-nav navbar navbar-expand-md navbar-dark light-dark"><div class="header-logo navbar-brand"><a class=float-left href=https://blog.chensoul.com/><img class="mr20 header-logo-image" src=https://blog.chensoul.com/images/fly.png alt=logo>
ChenSoul</a></div><button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarNav aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="nav-menu collapse navbar-collapse" id=navbarNav><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://blog.chensoul.com/categories/ideas/>思考</a></li><li class=nav-item><a class=nav-link href=https://blog.chensoul.com/links/>友链</a></li><li class=nav-item><a class=nav-link href=https://blog.chensoul.com/about/>关于</a></li><li class=nav-item><a class=nav-link href=https://blog.chensoul.com/search/>搜索</a></li></ul></div></nav></div><div class="container header-wrapper"><div class=row><div class=col-lg-12><div class=header-content><h1 class=header-title>Doris安装和部署</h1><p class=header-date>作者:
chensoul
| <span>2784 字, 6 分钟</span>
| 2022-08-18
| 分类:
<a href=https://blog.chensoul.com/categories/notes/>Notes</a></p><div class=header-underline></div><div class=clearfix></div><p class="float-right header-tags"><i class="fas fa-tags" aria-hidden=true></i>
<a href=https://blog.chensoul.com/tags/doris/>doris</a></p></div></div></div></div></div><main><div class="container content"><article><figure><audio controls preload=metadata><source src=/audios/here_after_us.mp3 type=audio/mpeg></audio><p><figcaption>《后来的我们 - 五月天》</figcaption></p></figure><h2 id=一环境准备>一、环境准备</h2><h3 id=1安装要求>1、安装要求</h3><ul><li>CPU：2C（最低）8C（推荐）</li><li>内存：4G（最低）48G（推荐）</li><li>硬盘：100G（最低）400G（推荐）</li><li>平台：MacOS（Intel）、LinuxOS、Windows 虚拟机</li><li>系统：CentOS（7.1及以上）、Ubuntu（16.04 及以上）</li><li>软件：JDK（1.8及以上）、GCC（4.8.2 及以上）</li></ul><h3 id=2环境规划>2、环境规划</h3><p>开发测试环境</p><table><thead><tr><th>模块</th><th>CPU</th><th>内存</th><th>磁盘</th><th>网络</th><th>实例数量</th></tr></thead><tbody><tr><td>Frontend</td><td>8核+</td><td>8GB+</td><td>SSD 或 SATA，10GB+ *</td><td>千兆网卡</td><td>1</td></tr><tr><td>Backend</td><td>8核+</td><td>16GB+</td><td>SSD 或 SATA，50GB+ *</td><td>千兆网卡</td><td>1-3 *</td></tr></tbody></table><p>生产环境</p><table><thead><tr><th>模块</th><th>CPU</th><th>内存</th><th>磁盘</th><th>网络</th><th>实例数量（最低要求）</th></tr></thead><tbody><tr><td>Frontend</td><td>16核+</td><td>64GB+</td><td>SSD 或 RAID 卡，100GB+ *</td><td>万兆网卡</td><td>1-5 *</td></tr><tr><td>Backend</td><td>16核+</td><td>64GB+</td><td>SSD 或 SATA，100G+ *</td><td>万兆网卡</td><td>10-100 *</td></tr></tbody></table><blockquote><p>说明：</p><ul><li>FE 的磁盘空间主要用于存储元数据，包括日志和 image。通常从几百 MB 到几个 GB 不等。</li><li>BE 的磁盘空间主要用于存放用户数据，总磁盘空间按用户总数据量 * 3（3副本）计算，然后再预留额外 40% 的空间用作后台压缩以及一些中间数据的存放。</li><li>一台机器上可以部署多个 BE 实例，但是<strong>只能部署一个 FE</strong>。如果需要 3 副本数据，那么至少需要 3 台机器各部署一个 BE 实例（而不是1台机器部署3个BE实例）。<strong>多个FE所在服务器的时钟必须保持一致（允许最多5</strong>秒的时钟偏差）</li><li>测试环境也可以仅适用一个 BE 进行测试。实际生产环境，BE 实例数量直接决定了整体查询延迟。</li><li>所有部署节点关闭 Swap。</li><li>Follower 的数量<strong>必须</strong>为奇数，至少为1，Observer 数量随意。</li><li><strong>如果 FE 和 BE 混部，需注意资源竞争问题，并保证元数据目录和数据目录分属不同磁盘。</strong></li></ul></blockquote><h3 id=3网络规划>3、网络规划</h3><p>Doris 各个实例直接通过网络进行通讯。</p><table><thead><tr><th>实例</th><th>端口名称</th><th>端口</th><th>通讯方向</th><th>说明</th></tr></thead><tbody><tr><td>BE</td><td>be_port</td><td>9060</td><td>FE &ndash;> BE</td><td>BE 上 thrift server 的端口，用于接收来自 FE 的请求</td></tr><tr><td>BE</td><td>webserver_port</td><td>8040</td><td>BE &lt;&ndash;> BE</td><td>BE 上的 http server 的端口</td></tr><tr><td>BE</td><td>heartbeatport</td><td>9050</td><td>FE &ndash;> BE</td><td>BE 上心跳服务端口（thrift），用于接收来自 FE 的心跳</td></tr><tr><td>BE</td><td>brpc_port</td><td>8060</td><td>FE &lt;&ndash;> BE, BE &lt;&ndash;> BE</td><td>BE 上的 brpc 端口，用于 BE 之间通讯</td></tr><tr><td>FE</td><td>http_port</td><td>8030</td><td>FE &lt;&ndash;> FE，用户 &lt;&ndash;> FE</td><td>FE 上的 http server 端口</td></tr><tr><td>FE</td><td>rpc_port</td><td>9020</td><td>BE &ndash;> FE, FE &lt;&ndash;> FE</td><td>FE 上的 thrift server 端口，每个fe的配置需要保持一致</td></tr><tr><td>FE</td><td>query_port</td><td>9030</td><td>用户 &lt;&ndash;> FE</td><td>FE 上的 mysql server 端口</td></tr><tr><td>FE</td><td>edit_log_port</td><td>9010</td><td>FE &lt;&ndash;> FE</td><td>FE 上的 bdbje 之间通信用的端口</td></tr><tr><td>Broker</td><td>broker_ipc_port</td><td>8000</td><td>FE &ndash;> Broker, BE &ndash;> Broker</td><td>Broker 上的 thrift server，用于接收请求</td></tr></tbody></table><h3 id=4服务器配置>4、服务器配置</h3><p>作为测试，服务器相关配置如下：</p><ul><li>服务器：4C/8G</li><li>IP地址：192.168.1.107</li><li>操作系统：Centos 7.9</li><li>JDK版本：OpenJDK 1.8</li><li>操作用户：root</li></ul><h2 id=二单机部署>二、单机部署</h2><h3 id=1系统设置>1、系统设置</h3><ul><li>设置系统最大打开文件句柄数</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>cat &gt;&gt; /etc/security/limits.conf<span class=s>&lt;&lt;EOF
</span></span></span><span class=line><span class=cl><span class=s>*       soft    nproc   131072
</span></span></span><span class=line><span class=cl><span class=s>*       hard    nproc   131072
</span></span></span><span class=line><span class=cl><span class=s>*       soft    nofile  131072
</span></span></span><span class=line><span class=cl><span class=s>*       hard    nofile  131072
</span></span></span><span class=line><span class=cl><span class=s>root    soft    nproc   131072
</span></span></span><span class=line><span class=cl><span class=s>root    hard    nproc   131072
</span></span></span><span class=line><span class=cl><span class=s>root    soft    nofile  131072
</span></span></span><span class=line><span class=cl><span class=s>root    hard    nofile  131072
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></div><ul><li>设置时钟同步</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl><span class=c1># 设置时钟同步</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>yum erase -y ntp
</span></span><span class=line><span class=cl>yum install -y chrony
</span></span><span class=line><span class=cl>sed -i -e <span class=s1>&#39;/^server/d&#39;</span> /etc/chrony.conf
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;server ntp1.aliyun.com iburst&#34;</span> &gt;&gt; /etc/chrony.conf
</span></span><span class=line><span class=cl>egrep -v <span class=s2>&#34;^#|^</span>$<span class=s2>&#34;</span> /etc/chrony.conf 
</span></span><span class=line><span class=cl>systemctl start chronyd <span class=o>&amp;&amp;</span> systemctl <span class=nb>enable</span> chronyd
</span></span><span class=line><span class=cl>ss -tulp <span class=p>|</span> grep chronyd
</span></span><span class=line><span class=cl>chronyc tracking
</span></span><span class=line><span class=cl>chronyc sources
</span></span><span class=line><span class=cl>chronyc sourcestats
</span></span></code></pre></div><ul><li>关闭交换分区</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>sysctl -w vm.swappiness<span class=o>=</span><span class=m>0</span> &gt;/dev/null
</span></span><span class=line><span class=cl><span class=nb>echo</span> vm.swappiness <span class=o>=</span> <span class=m>0</span> &gt;&gt; /etc/sysctl.conf
</span></span><span class=line><span class=cl>swapoff -a <span class=o>&amp;&amp;</span> sed -i <span class=s1>&#39;/swap/s/^/#/&#39;</span> /etc/fstab
</span></span></code></pre></div><ul><li>Liunx文件系统。在安装操作系统的时候，请选择ext4文件系统</li></ul><h3 id=2安装jdk>2、安装jdk</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>yum install -y java-1.8.0-openjdk java-1.8.0-openjdk-devel
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt; EOF | sudo tee -a /etc/profile
</span></span></span><span class=line><span class=cl><span class=s>export JAVA_HOME=/usr/lib/jvm/java
</span></span></span><span class=line><span class=cl><span class=s>export CLASSPATH=.:\$JAVA_HOME/lib:\$JAVA_HOME/jre/lib:\$CLASSPATH
</span></span></span><span class=line><span class=cl><span class=s>export PATH=\$JAVA_HOME/bin:\$JAVA_HOME/jre/bin:\$PATH
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>source</span> /etc/profile
</span></span></code></pre></div><h3 id=3下载安装包>3、下载安装包</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>wget https://mirrors.aliyun.com/apache/doris/1.1/1.1.1-rc03/apache-doris-1.1.1-bin-x86.tar.gz
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>tar zxvf apache-doris-1.1.1-bin-x86.tar.gz
</span></span><span class=line><span class=cl>mv apache-doris-1.1.1-bin-x86 /opt/doris
</span></span><span class=line><span class=cl><span class=nb>cd</span> /opt/doris
</span></span></code></pre></div><h3 id=4配置-fe-和-be>4、配置 FE 和 BE</h3><blockquote><p>注意：</p><p>FE 和 BE 是混合部署在一台服务器上时，数据目录需要使用不同的磁盘。</p></blockquote><p>修改 FE，做出以下配置：</p><ul><li>设置网络</li><li>设置元数据目录<code>meta_dir</code>。默认值为 <code>${DORIS_HOME}/doris-meta</code>，需<strong>手动创建</strong>该目录。<strong>注意：生产环境强烈建议单独指定目录不要放在Doris安装目录下，最好是</strong>单独的磁盘（如果有SSD最好），测试<strong>开发</strong>环境可以使用默认<strong>配置</strong>。</li><li>数据库表名支持小写</li><li>支持导出数据到本地目录</li><li>fe.conf 中 JAVA_OPTS 默认 java 最大堆内存为 4GB，<strong>建议生产环境调整至 8G 以上</strong></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>sed -i -e <span class=s1>&#39;/^priority_networks/d&#39;</span> fe/conf/fe.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>mkdir /meta
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cat &gt;&gt; fe/conf/fe.conf <span class=s>&lt;&lt;EOF
</span></span></span><span class=line><span class=cl><span class=s>priority_networks=192.168.1.0/24
</span></span></span><span class=line><span class=cl><span class=s>meta_dir=/meta
</span></span></span><span class=line><span class=cl><span class=s>lower_case_table_names=1
</span></span></span><span class=line><span class=cl><span class=s>enable_outfile_to_local=true
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></div><p>修改 BE，做出以下配置：</p><ul><li>设置网络。</li><li>设置数据存储根目录<code>storage_root_path</code>。默认在be/storage下，需要<strong>手动创建</strong>该目录。多个路径之间使用英文状态的分号分隔。</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>sed -i -e <span class=s1>&#39;/^priority_networks/d&#39;</span> be/conf/be.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>mkdir /data/doris
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cat &gt;&gt; be/conf/be.conf <span class=s>&lt;&lt;EOF
</span></span></span><span class=line><span class=cl><span class=s>priority_networks=192.168.1.0/24
</span></span></span><span class=line><span class=cl><span class=s>storage_root_path=/data/doris
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span></code></pre></div><h3 id=5启动-fe-和-be>5、启动 FE 和 BE</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>fe/bin/start_fe.sh --daemon
</span></span><span class=line><span class=cl>be/bin/start_be.sh --daemon
</span></span></code></pre></div><blockquote><p>注意：</p><p><strong>在生产环境中，所有实例都应使用守护进程启动，以保证进程退出后，会被自动拉起。</strong></p><p>参考文章：<a href=https://www.cnblogs.com/lenmom/p/9973401.html>Apache Doris通过supervisor进行进程管理 - 老董 - 博客园</a></p></blockquote><p>可以通过如下链接查看 FE 是否启动成功：http://192.168.1.107:8030/api/bootstrap</p><p>通过如下链接查看 BE 是否启动成功：http://192.168.1.107:8040/api/health</p><h3 id=6安装-mysql-客户端>6、安装 MySql 客户端</h3><p>选择一台服务器，安装 mysql 8 客户端，这里我是在 192.168.1.107 上安装：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>wget https://dev.mysql.com/get/mysql80-community-release-el7-1.noarch.rpm
</span></span><span class=line><span class=cl>yum localinstall mysql80-community-release-el7-1.noarch.rpm
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>yum repolist all <span class=p>|</span> grep mysql
</span></span><span class=line><span class=cl>yum repolist enabled <span class=p>|</span> grep mysql
</span></span><span class=line><span class=cl>yum install yum-utils -y
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>yum-config-manager --enable mysql80-community
</span></span><span class=line><span class=cl>yum-config-manager --disable mysql57-community
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rpm --import https://repo.mysql.com/RPM-GPG-KEY-mysql-2022
</span></span><span class=line><span class=cl>yum install mysql-community-client -y
</span></span></code></pre></div><h3 id=7在-fe-上添加-be-节点>7、在 FE 上添加 BE 节点</h3><p>在 192.168.1.107 节点连接 FE，并且注册 BE 节点</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>mysql -h 192.168.1.107 -P <span class=m>9030</span> -uroot
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ALTER SYSTEM ADD BACKEND <span class=s2>&#34;192.168.1.107:9050&#34;</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=8访问-web-ui>8、访问 Web UI</h3><p>FE 节点Web UI：http://192.168.1.107:8030</p><p>BE 节点Web UI：http://192.168.1.107:8040</p><h3 id=9mysql-客户端访问>9、MySQL 客户端访问</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-SQL data-lang=SQL><span class=line><span class=cl><span class=n>mysql</span><span class=w> </span><span class=o>-</span><span class=n>h</span><span class=w> </span><span class=mi>192</span><span class=p>.</span><span class=mi>168</span><span class=p>.</span><span class=mi>1</span><span class=p>.</span><span class=mi>107</span><span class=w> </span><span class=o>-</span><span class=n>P</span><span class=w> </span><span class=mi>9030</span><span class=w> </span><span class=o>-</span><span class=n>uroot</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>&gt;</span><span class=w> </span><span class=k>SHOW</span><span class=w> </span><span class=n>DATABASES</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>&gt;</span><span class=w> </span><span class=k>CREATE</span><span class=w> </span><span class=k>DATABASE</span><span class=w> </span><span class=n>example_db</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>&gt;</span><span class=w> </span><span class=n>USE</span><span class=w> </span><span class=n>example_db</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>查看</span><span class=n>BE</span><span class=err>状态</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>&gt;</span><span class=w> </span><span class=k>SHOW</span><span class=w> </span><span class=n>PROC</span><span class=w> </span><span class=s1>&#39;/backends&#39;</span><span class=w>
</span></span></span></code></pre></div><h2 id=三集群部署>三、集群部署</h2><p>FE 角色：</p><ul><li>Follower：所有 Follower 角色的 FE 节点会组成一个可选择组，组内选择出一个 master 或者叫做 leader。当 Master 挂了，会自动选择新的 Follower 作为 Master。</li><li>Observer：Observer仅仅作为观察者来同步已经成功写入的元数据日志，并且提供元数据读服务。他不会参与多数写的逻辑。Observer 也不会参与选举。</li></ul><p>通常情况下，可以部署 1 Follower + 2 Observer 或者 3 Follower + N Observer。前者运维简单，几乎不会出现 Follower 之间的一致性协议导致这种复杂错误情况（企业大多使用这种方式）。后者可以保证元数据写的高可用，如果是高并发查询场景，可以适当增加 Observer。</p><h3 id=1在其他服务器上安装-doris>1、在其他服务器上安装 doris</h3><p>集群三个节点：</p><ul><li>192.168.1.107 FE（master follower）、BE</li><li>192.168.1.108 FE（follower）、BE</li><li>192.168.1.109 FE（follower）、BE</li></ul><p>在集群每个节点配置 hosts：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>192.168.1.107 doris-01
</span></span><span class=line><span class=cl>192.168.1.108 doris-02
</span></span><span class=line><span class=cl>192.168.1.109 doris-03
</span></span></code></pre></div><p>参考单机部署步骤，在其他服务器上安装 doris 。</p><h3 id=2启动-be>2、启动 BE</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>be/bin/start_be.sh --daemon
</span></span></code></pre></div><h3 id=3fe-扩容>3、FE 扩容</h3><p>通过 mysql 客户端登陆 Master FE 也就是 192.168.1.107</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>mysql -h 192.168.1.107 -P <span class=m>9030</span> -uroot
</span></span></code></pre></div><p>查看 FE 节点情况：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>mysql&gt; SHOW PROC <span class=s1>&#39;/frontends&#39;</span><span class=p>;</span>
</span></span></code></pre></div><p>也可以通过 http://192.168.1.107:8030/System?path=//frontends 查看</p><p><img src=https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/doris-fe-web.jpg alt=img></p><p>在 192.168.1.108 和 192.168.1.109 节点上启动 FE ：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>fe/bin/start_fe.sh --helper 192.168.1.107:9010 --daemon
</span></span></code></pre></div><blockquote><p>注意：</p><p>第一次启动需要指定 <code>--helper</code>，之后不需要。</p></blockquote><p>然后，登陆 Master FE，添加 FE 到集群：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>mysql -h 192.168.1.107 -P <span class=m>9030</span> -uroot
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ALTER SYSTEM ADD FOLLOWER  <span class=s2>&#34;192.168.1.108:9010&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>ALTER SYSTEM ADD FOLLOWER  <span class=s2>&#34;192.168.1.109:9010&#34;</span><span class=p>;</span>
</span></span></code></pre></div><p>查看 FE 状态</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>SHOW PROC <span class=s1>&#39;/frontends&#39;</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=4在-fe-中添加-be-节点>4、在 FE 中添加 BE 节点</h3><p>登陆 Master FE，注册 BE 节点</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>mysql -h 192.168.1.107 -P <span class=m>9030</span> -uroot
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ALTER SYSTEM ADD BACKEND <span class=s2>&#34;192.168.1.107:9050&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>ALTER SYSTEM ADD BACKEND <span class=s2>&#34;192.168.1.108:9050&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>ALTER SYSTEM ADD BACKEND <span class=s2>&#34;192.168.1.109:9050&#34;</span><span class=p>;</span>
</span></span></code></pre></div><p>查看BE状态</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>SHOW PROC <span class=s1>&#39;/backends&#39;</span><span class=p>;</span>
</span></span></code></pre></div><h3 id=5停止-fe-和-be>5、停止 FE 和 BE</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>fe/bin/stop_fe.sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>be/bin/stop_be.sh
</span></span></code></pre></div><h3 id=6重新初始化集群>6、重新初始化集群</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl><span class=nb>cd</span> /opt/doris
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>fe/bin/stop_fe.sh
</span></span><span class=line><span class=cl>be/bin/stop_be.sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>rm -rf /meta/* /data/doris/*
</span></span><span class=line><span class=cl>mkdir -p /meta /data/doris
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># FE master</span>
</span></span><span class=line><span class=cl>fe/bin/start_fe.sh --daemon
</span></span><span class=line><span class=cl>be/bin/start_be.sh --daemon
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># FE follwer</span>
</span></span><span class=line><span class=cl>fe/bin/start_fe.sh --helper 192.168.1.107:9010 --daemon
</span></span><span class=line><span class=cl>be/bin/start_be.sh --daemon
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>mysql -h 192.168.1.107 -P <span class=m>9030</span> -uroot
</span></span><span class=line><span class=cl>ALTER SYSTEM ADD BACKEND <span class=s2>&#34;192.168.1.107:9050&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>ALTER SYSTEM ADD BACKEND <span class=s2>&#34;192.168.1.108:9050&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>ALTER SYSTEM ADD BACKEND <span class=s2>&#34;192.168.1.109:9050&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ALTER SYSTEM ADD FOLLOWER  <span class=s2>&#34;192.168.1.108:9010&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>ALTER SYSTEM ADD FOLLOWER  <span class=s2>&#34;192.168.1.109:9010&#34;</span><span class=p>;</span>
</span></span></code></pre></div><h2 id=四总结>四、总结</h2><p>安装 doris 完整安装脚本如下，你可以按照你的需求进行修改：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>cat &gt;&gt; /etc/security/limits.conf<span class=s>&lt;&lt;EOF
</span></span></span><span class=line><span class=cl><span class=s>*       soft    nproc   131072
</span></span></span><span class=line><span class=cl><span class=s>*       hard    nproc   131072
</span></span></span><span class=line><span class=cl><span class=s>*       soft    nofile  131072
</span></span></span><span class=line><span class=cl><span class=s>*       hard    nofile  131072
</span></span></span><span class=line><span class=cl><span class=s>root    soft    nproc   131072
</span></span></span><span class=line><span class=cl><span class=s>root    hard    nproc   131072
</span></span></span><span class=line><span class=cl><span class=s>root    soft    nofile  131072
</span></span></span><span class=line><span class=cl><span class=s>root    hard    nofile  131072
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 设置时钟同步</span>
</span></span><span class=line><span class=cl>yum erase -y ntp
</span></span><span class=line><span class=cl>yum install -y chrony
</span></span><span class=line><span class=cl>sed -i -e <span class=s1>&#39;/^server/d&#39;</span> /etc/chrony.conf
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;server ntp1.aliyun.com iburst&#34;</span> &gt;&gt; /etc/chrony.conf
</span></span><span class=line><span class=cl>egrep -v <span class=s2>&#34;^#|^</span>$<span class=s2>&#34;</span> /etc/chrony.conf 
</span></span><span class=line><span class=cl>systemctl start chronyd <span class=o>&amp;&amp;</span> systemctl <span class=nb>enable</span> chronyd
</span></span><span class=line><span class=cl>ss -tulp <span class=p>|</span> grep chronyd
</span></span><span class=line><span class=cl>chronyc tracking
</span></span><span class=line><span class=cl>chronyc sources
</span></span><span class=line><span class=cl>chronyc sourcestats
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 安装 JDK </span>
</span></span><span class=line><span class=cl>yum install -y java-1.8.0-openjdk java-1.8.0-openjdk-devel
</span></span><span class=line><span class=cl>cat <span class=s>&lt;&lt; EOF | sudo tee -a /etc/profile
</span></span></span><span class=line><span class=cl><span class=s>export JAVA_HOME=/usr/lib/jvm/java
</span></span></span><span class=line><span class=cl><span class=s>export CLASSPATH=.:\$JAVA_HOME/lib:\$JAVA_HOME/jre/lib:\$CLASSPATH
</span></span></span><span class=line><span class=cl><span class=s>export PATH=\$JAVA_HOME/bin:\$JAVA_HOME/jre/bin:\$PATH
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl><span class=nb>source</span> /etc/profile
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>wget https://mirrors.aliyun.com/apache/doris/1.1/1.1.1-rc03/apache-doris-1.1.1-bin-x86.tar.gz
</span></span><span class=line><span class=cl>tar zxvf apache-doris-1.1.1-bin-x86.tar.gz
</span></span><span class=line><span class=cl>mv apache-doris-1.1.1-bin-x86 /opt/doris
</span></span><span class=line><span class=cl><span class=nb>cd</span> /opt/doris
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sed -i -e <span class=s1>&#39;/^priority_networks/d&#39;</span> fe/conf/fe.conf
</span></span><span class=line><span class=cl>mkdir /meta
</span></span><span class=line><span class=cl>cat &gt;&gt; fe/conf/fe.conf <span class=s>&lt;&lt;EOF
</span></span></span><span class=line><span class=cl><span class=s>priority_networks=192.168.1.0/24
</span></span></span><span class=line><span class=cl><span class=s>meta_dir=/meta
</span></span></span><span class=line><span class=cl><span class=s>lower_case_table_names=1
</span></span></span><span class=line><span class=cl><span class=s>enable_outfile_to_local=true
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sed -i -e <span class=s1>&#39;/^priority_networks/d&#39;</span> be/conf/be.conf
</span></span><span class=line><span class=cl>mkdir /data/doris
</span></span><span class=line><span class=cl>cat &gt;&gt; be/conf/be.conf <span class=s>&lt;&lt;EOF
</span></span></span><span class=line><span class=cl><span class=s>priority_networks=192.168.1.0/24
</span></span></span><span class=line><span class=cl><span class=s>storage_root_path=/data/doris
</span></span></span><span class=line><span class=cl><span class=s>EOF</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>fe/bin/start_fe.sh --daemon
</span></span><span class=line><span class=cl>be/bin/start_be.sh --daemon
</span></span></code></pre></div></article><h2>相关文章</h2><dl class=row><dt class=col-md-3>2022-08-18</dt><dd class=col-md-9><a href=/posts/2022/08/18/doris-cluster-elastic-expansion/>Doris集群弹性扩缩容</a></dd><dt class=col-md-3>2022-08-18</dt><dd class=col-md-9><a href=/posts/2022/08/18/doris-external-table-load/>Doris通过外部表同步数据</a></dd></dl><div class=author-card><div class=underline></div><div class=author-box><div class=author-image><a href=https://blog.chensoul.com><img src=/images/author.webp alt=chensoul></a></div><div class=author-content><p class=author-title>作者</p><p class=author-name>chensoul</p><p class=author-desc>Java 开发工程师，喜欢探索新技术。 可以在 <a href=https://github.com/chensoul>GitHub</a> 了解更多关于我的信息。</p></div></div></div><div align=center><div class=comment-underline></div></div><br><div id=cusdis_thread data-host=https://cusdis.chensoul.com data-app-id=3fce9b16-7416-4c74-9786-757bf28c1b8b data-page-id=9a293e5ab5c45a003c15b93e136f4528 data-page-url=https://blog.chensoul.com/posts/2022/08/18/doris-install-deploy/ data-page-title=Doris安装和部署></div><script async defer src=/js/cusdis.min.js></script></div></main><div class="footer gradient-2"><div class="container footer-container"><div class=row><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3"><div class=footer-title>网站地图</div><ul class=list-unstyled><li><a href=https://blog.chensoul.com/tags/>标签</a></li><li><a href=https://blog.chensoul.com/categories/>分类</a></li><li><a rel=alternate type=application/rss+xml href=https://blog.chensoul.com/index.xml></i>RSS</a></li></ul></div><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3"><div class=footer-title>社交</div><ul class=list-unstyled><li><a href=https://t.me/chenshu_eth rel=noopener target=_blank>Telegram</a></li><li><a href=https://twitter.com/chenshu_eth rel=noopener target=_blank>Twitter</a></li><li><a href=https://space.bilibili.com/699805065/ rel=noopener target=_blank>BiliBili</a></li></ul></div><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3"><div class=footer-title>关于</div><ul class=list-unstyled><li><a href=https://cusdis.chensoul.com rel=noopener target=_blank>GitHub</a></li><li><a href=https://uptime.chensoul.com/status/services rel=noopener target=_blank>Services</a></li><li><a href=https://umami.chensoul.com/share/zWO2pDuP/chenshou rel=noopener target=_blank>Analytics</a></li></ul></div><div class="col-xs-12 col-sm-3 col-md-3 col-lg-3"><p class="pull-right text-right"><small><em>Powered by <a href=https://gohugo.io/ rel=noopener target=_blank>Hugo</a></em></small><br><small><em>Theme - <a href=https://github.com/shaform/hugo-theme-den rel=noopener target=_blank>Den</a></em></small><br><small>&copy;
chensoul
2020 -
2023</small></p></div><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" id=scroll-top class=scroll-top accesskey=g><span class=arrow-icon></span></a>
<script>var mybutton=document.getElementById("scroll-top");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script></div></div></div><script src=https://code.jquery.com/jquery-3.3.1.slim.min.js integrity=sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo crossorigin=anonymous></script>
<script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script>
<script async src=https://cdn.splitbee.io/sb.js></script>
<script async defer data-website-id=f110cfa0-b737-4690-a032-2b9073a57fc3 src=https://umami.chensoul.com/umami.js></script></body></html>