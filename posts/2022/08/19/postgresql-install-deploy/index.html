<!doctype html><html lang=zh itemscope itemtype=http://schema.org/WebPage><head><meta name=generator content="Hugo 0.111.2"><meta charset=utf-8><title>PostgreSql安装和部署 · ChenSoul</title><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=description content="yum安装 安装PostgreSQL 12 yum install https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm yum install postgresql12 postgresql12-server -y 安装路径在 /usr/pgsql-12/ 安装完之后，初始化数据库并设置开机启动： /usr/pgsql-12/bin/postgresql-12-setup initdb systemctl enable postgresql-12 systemctl start postgresql-12 安装PostgreS"><meta name=keywords content="devops,programming"><meta name=google-site-verification content="nBXwg45SBRjTX78SA-mH0asrAbsdu9c1nk0ObSry7aQ"><link rel=canonical href=https://blog.chensoul.com/posts/2022/08/19/postgresql-install-deploy/><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css integrity=sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO crossorigin=anonymous><link rel=stylesheet href=https://blog.chensoul.com/css/den.css><link rel=stylesheet href=https://blog.chensoul.com/css/custom.min.css><link rel=preload as=font type=font/woff2 href=/css/font/open-sans.css><link rel=stylesheet type=text/css href=/css/font/open-sans.css media=print onload='this.media="all"'><meta property="og:title" content="PostgreSql安装和部署"><meta property="og:description" content="yum安装 安装PostgreSQL 12 yum install https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm yum install postgresql12 postgresql12-server -y 安装路径在 /usr/pgsql-12/ 安装完之后，初始化数据库并设置开机启动： /usr/pgsql-12/bin/postgresql-12-setup initdb systemctl enable postgresql-12 systemctl start postgresql-12 安装PostgreS"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.chensoul.com/posts/2022/08/19/postgresql-install-deploy/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-19T17:11:19+08:00"><meta property="article:modified_time" content="2022-08-19T17:11:19+08:00"><meta itemprop=name content="PostgreSql安装和部署"><meta itemprop=description content="yum安装 安装PostgreSQL 12 yum install https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm yum install postgresql12 postgresql12-server -y 安装路径在 /usr/pgsql-12/ 安装完之后，初始化数据库并设置开机启动： /usr/pgsql-12/bin/postgresql-12-setup initdb systemctl enable postgresql-12 systemctl start postgresql-12 安装PostgreS"><meta itemprop=datePublished content="2022-08-19T17:11:19+08:00"><meta itemprop=dateModified content="2022-08-19T17:11:19+08:00"><meta itemprop=wordCount content="794"><meta itemprop=keywords content="postgresql,docker,"><meta name=twitter:card content="summary"><meta name=twitter:title content="PostgreSql安装和部署"><meta name=twitter:description content="yum安装 安装PostgreSQL 12 yum install https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm yum install postgresql12 postgresql12-server -y 安装路径在 /usr/pgsql-12/ 安装完之后，初始化数据库并设置开机启动： /usr/pgsql-12/bin/postgresql-12-setup initdb systemctl enable postgresql-12 systemctl start postgresql-12 安装PostgreS"></head><body><div class=header-container style=background:linear-gradient(rgba(0,0,0,.2),rgba(0,0,0,.2)),url(https://blog.chensoul.com/images/background.webp);background-position:50%;background-size:cover><div class=container><nav class="header-nav navbar navbar-expand-md navbar-dark light-dark"><div class="header-logo navbar-brand"><a class=float-left href=https://blog.chensoul.com/><img class="mr20 header-logo-image" src=https://blog.chensoul.com/images/fly.png alt=logo>
ChenSoul</a></div><button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarNav aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="nav-menu collapse navbar-collapse" id=navbarNav><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://blog.chensoul.com/categories/ideas/>思考</a></li><li class=nav-item><a class=nav-link href=https://blog.chensoul.com/search/>搜索</a></li><li class=nav-item><a class=nav-link href=https://blog.chensoul.com/memos/>嘀咕</a></li><li class=nav-item><a class=nav-link href=https://blog.chensoul.com/links/>友链</a></li><li class=nav-item><a class=nav-link href=https://blog.chensoul.com/about/>关于</a></li></ul></div></nav></div><div class="container header-wrapper"><div class=row><div class=col-lg-12><div class=header-content><h1 class=header-title>PostgreSql安装和部署</h1><p class=header-date>作者:
chensoul
| <span>794 字, 2 分钟</span>
| 2022-08-19
| 分类:
<a href=https://blog.chensoul.com/categories/notes/>Notes</a></p><div class=header-underline></div><div class=clearfix></div><p class="float-right header-tags"><i class="fas fa-tags" aria-hidden=true></i>
<a href=https://blog.chensoul.com/tags/docker/>docker</a>,
<a href=https://blog.chensoul.com/tags/postgresql/>postgresql</a></p></div></div></div></div></div><main><div class="container content"><article><h2 id=yum安装>yum安装</h2><h3 id=安装postgresql-12>安装PostgreSQL 12</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yum install https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm
</span></span><span class=line><span class=cl>yum install postgresql12 postgresql12-server -y
</span></span></code></pre></div><p>安装路径在 /usr/pgsql-12/</p><p>安装完之后，初始化数据库并设置开机启动：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>/usr/pgsql-12/bin/postgresql-12-setup initdb 
</span></span><span class=line><span class=cl>systemctl <span class=nb>enable</span> postgresql-12 
</span></span><span class=line><span class=cl>systemctl start postgresql-12
</span></span></code></pre></div><h3 id=安装postgresql-96>安装PostgreSQL 9.6</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo yum install https://download.postgresql.org/pub/repos/yum/reporpms/EL-7-x86_64/pgdg-redhat-repo-latest.noarch.rpm
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo yum install postgresql96 postgresql96-server -y
</span></span></code></pre></div><p>安装路径在 /usr/pgsql-9/</p><p>安装完之后，初始化数据库并设置开机启动：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>/usr/pgsql-9.6/bin/postgresql96-setup initdb
</span></span><span class=line><span class=cl>systemctl <span class=nb>enable</span> postgresql-9.6
</span></span><span class=line><span class=cl>systemctl start postgresql-9.6
</span></span></code></pre></div><h3 id=配置数据库>配置数据库</h3><p>查找路径：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>find / -name pg_hba.conf /var/lib/pgsql/12/data/pg_hba.conf
</span></span></code></pre></div><p>修改 <code>pg_hba.conf</code>，设置远程用户访问权限：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sed -i <span class=s2>&#34;s/127.0.0.1\/32/0.0.0.0\/0/&#34;</span> /var/lib/pgsql/12/data/pg_hba.conf
</span></span><span class=line><span class=cl>sed -i <span class=s2>&#34;s/ident/trust/&#34;</span> /var/lib/pgsql/12/data/pg_hba.conf
</span></span><span class=line><span class=cl>sed -i <span class=s2>&#34;s/peer/trust/&#34;</span> /var/lib/pgsql/12/data/pg_hba.conf
</span></span></code></pre></div><ul><li>md5并提供加密的密码验证</li><li>trust意思不用密码验证</li></ul><p>修改postgresql.conf，配置监听地址：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>CONF_FILE</span><span class=o>=</span>/var/lib/pgsql/12/data/postgresql.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo sed -i <span class=s2>&#34;s/#port = 5432/port = 5432/&#34;</span> <span class=nv>$CONF_FILE</span>
</span></span><span class=line><span class=cl>sudo sed -i <span class=s2>&#34;s/max_connections = 100/max_connections = 600/&#34;</span> <span class=nv>$CONF_FILE</span>
</span></span><span class=line><span class=cl>sudo sed -i <span class=s2>&#34;s/#listen_addresses = &#39;localhost&#39;/listen_addresses = &#39;*&#39;/&#34;</span> <span class=nv>$CONF_FILE</span>
</span></span><span class=line><span class=cl>sudo sed -i <span class=s2>&#34;s/shared_buffers = 32MB/shared_buffers = 256MB/&#34;</span> <span class=nv>$CONF_FILE</span>
</span></span></code></pre></div><p>重启数据库：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>systemctl restart postgresql-12
</span></span></code></pre></div><h3 id=创建数据库>创建数据库</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>CREATE USER <span class=nb>test</span> WITH PASSWORD <span class=s1>&#39;test&#39;</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>CREATE DATABASE dataware <span class=nv>owner</span><span class=o>=</span>test<span class=p>;</span> 
</span></span><span class=line><span class=cl>GRANT ALL privileges ON DATABASE dataware TO test<span class=p>;</span>
</span></span></code></pre></div><h3 id=自动化运行脚本>自动化运行脚本</h3><p>以下是按照hive时，配置hive元数据的数据库时的自动化安装脚本，仅供参考：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=nb>readonly</span> <span class=nv>PROGNAME</span><span class=o>=</span><span class=k>$(</span>basename <span class=nv>$0</span><span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nb>readonly</span> <span class=nv>PROGDIR</span><span class=o>=</span><span class=k>$(</span>readlink -m <span class=k>$(</span>dirname <span class=nv>$0</span><span class=k>))</span>
</span></span><span class=line><span class=cl><span class=nb>readonly</span> <span class=nv>ARGS</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> <span class=sb>`</span>id -u<span class=sb>`</span> -ne <span class=m>0</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;must run as root&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>get_postgresql_major_version<span class=o>(){</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>psql_output</span><span class=o>=</span><span class=sb>`</span>psql --version<span class=sb>`</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>regex</span><span class=o>=</span><span class=s2>&#34;^psql \(PostgreSQL\) ([[:digit:]]+)\..*&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[[</span> <span class=nv>$psql_output</span> <span class=o>=</span>~ <span class=nv>$regex</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>      <span class=nb>echo</span> <span class=si>${</span><span class=nv>BASH_REMATCH</span><span class=p>[1]</span><span class=si>}</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>get_standard_conforming_strings<span class=o>(){</span>
</span></span><span class=line><span class=cl>    <span class=nb>local</span> <span class=nv>psql_version</span><span class=o>=</span><span class=k>$(</span>get_postgresql_major_version<span class=k>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[[</span> <span class=nv>$psql_version</span> -gt <span class=m>8</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;# This is needed to make Hive work with Postgresql 9.1 and above&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;# See OPSAPS-11795&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>echo</span> <span class=s2>&#34;standard_conforming_strings=off&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>check_postgresql_installed<span class=o>(){</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> -e <span class=s2>&#34;Install postgresql-server&#34;</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> ! rpm -q postgresql-server &gt;/dev/null <span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>	    yum install postgresql-server postgresql-jdbc -y &gt;/dev/null 2&gt;<span class=p>&amp;</span><span class=m>1</span>
</span></span><span class=line><span class=cl>        ln -s /usr/share/java/postgresql-jdbc.jar /usr/lib/hive/lib/postgresql-jdbc.jar
</span></span><span class=line><span class=cl>		chkconfig postgresql on
</span></span><span class=line><span class=cl>	<span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	pkill -9 postgres
</span></span><span class=line><span class=cl>	rm -rf /var/lib/pgsql/data /var/run/postgresql/.s.PGSQL.<span class=nv>$DB_PORT</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> -e <span class=s2>&#34;Init postgresql database&#34;</span>
</span></span><span class=line><span class=cl>	postgresql-setup initdb
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>configure_postgresql_conf<span class=o>(){</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> -e <span class=s2>&#34;Configure postgresql conf&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	sed -i <span class=s2>&#34;s/#port = 5432/port = </span><span class=nv>$DB_PORT</span><span class=s2>/&#34;</span> <span class=nv>$CONF_FILE</span>
</span></span><span class=line><span class=cl>	sed -i <span class=s2>&#34;s/max_connections = 100/max_connections = 600/&#34;</span> <span class=nv>$CONF_FILE</span>
</span></span><span class=line><span class=cl>	sed -i <span class=s2>&#34;s/#listen_addresses = &#39;localhost&#39;/listen_addresses = &#39;*&#39;/&#34;</span> <span class=nv>$CONF_FILE</span>
</span></span><span class=line><span class=cl>	sed -i <span class=s2>&#34;s/shared_buffers = 32MB/shared_buffers = 256MB/&#34;</span> <span class=nv>$CONF_FILE</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nb>local</span> <span class=nv>SCS</span><span class=o>=</span><span class=k>$(</span>get_standard_conforming_strings<span class=k>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;</span><span class=nv>$SCS</span><span class=s2>&#34;</span> !<span class=o>=</span> <span class=s2>&#34;&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>		<span class=nb>echo</span> -e <span class=nv>$SCS</span>
</span></span><span class=line><span class=cl>		sed -i <span class=s2>&#34;s/#standard_conforming_strings = on/standard_conforming_strings = off/&#34;</span> <span class=nv>$CONF_FILE</span>
</span></span><span class=line><span class=cl>	<span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>enable_remote_connections<span class=o>(){</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> -e <span class=s2>&#34;Enable remote connections&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	sed -i <span class=s2>&#34;s/127.0.0.1\/32/0.0.0.0\/0/&#34;</span> /var/lib/pgsql/data/pg_hba.conf
</span></span><span class=line><span class=cl>	sed -i <span class=s2>&#34;s/ident/trust/&#34;</span> /var/lib/pgsql/data/pg_hba.conf
</span></span><span class=line><span class=cl>  sed -i <span class=s2>&#34;s/peer/trust/&#34;</span> /var/lib/pgsql/data/pg_hba.conf
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>create_db<span class=o>(){</span>
</span></span><span class=line><span class=cl>	<span class=nv>DB_NAME</span><span class=o>=</span><span class=nv>$1</span>
</span></span><span class=line><span class=cl>	<span class=nv>DB_USER</span><span class=o>=</span><span class=nv>$2</span>
</span></span><span class=line><span class=cl>	<span class=nv>DB_PASSWORD</span><span class=o>=</span><span class=nv>$3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> -e <span class=s2>&#34;Create database </span><span class=nv>$DB_NAME</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>cd</span> /var/lib/pgsql/data
</span></span><span class=line><span class=cl>	su -c <span class=s2>&#34;/usr/bin/pg_ctl start -w -m fast -D /var/lib/pgsql/data&#34;</span> postgres
</span></span><span class=line><span class=cl>	su -c <span class=s2>&#34;/usr/bin/psql --command \&#34;CREATE USER </span><span class=nv>$DB_USER</span><span class=s2> WITH PASSWORD &#39;</span><span class=nv>$DB_PASSWORD</span><span class=s2>&#39;; \&#34; &#34;</span> postgres
</span></span><span class=line><span class=cl>	su -c <span class=s2>&#34;/usr/bin/psql --command \&#34;CREATE DATABASE </span><span class=nv>$DB_NAME</span><span class=s2> owner=</span><span class=nv>$DB_USER</span><span class=s2>;\&#34; &#34;</span> postgres
</span></span><span class=line><span class=cl>	su -c <span class=s2>&#34;/usr/bin/psql --command \&#34;GRANT ALL privileges ON DATABASE </span><span class=nv>$DB_NAME</span><span class=s2> TO </span><span class=nv>$DB_USER</span><span class=s2>;\&#34; &#34;</span> postgres
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>init_hive_metastore<span class=o>(){</span>
</span></span><span class=line><span class=cl>	<span class=nv>DB_NAME</span><span class=o>=</span><span class=nv>$1</span>
</span></span><span class=line><span class=cl>	<span class=nv>DB_USER</span><span class=o>=</span><span class=nv>$2</span>
</span></span><span class=line><span class=cl>	<span class=nv>DB_FILE</span><span class=o>=</span><span class=nv>$3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> -e <span class=s2>&#34;Init hive metastore using </span><span class=nv>$DB_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>	su -c <span class=s2>&#34;/usr/bin/psql -U </span><span class=nv>$DB_USER</span><span class=s2> -d </span><span class=nv>$DB_NAME</span><span class=s2> -f </span><span class=nv>$DB_FILE</span><span class=s2>&#34;</span> postgres
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>manager_db<span class=o>(){</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> -e <span class=s2>&#34;</span><span class=nv>$1</span><span class=s2> postgres&#34;</span>
</span></span><span class=line><span class=cl>	su -c <span class=s2>&#34;/usr/bin/pg_ctl </span><span class=nv>$1</span><span class=s2> -w -m fast -D /var/lib/pgsql/data&#34;</span> postgres
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>readonly</span> <span class=nv>DB_HOST</span><span class=o>=</span><span class=k>$(</span>hostname -f<span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nb>readonly</span> <span class=nv>DB_PORT</span><span class=o>=</span><span class=si>${</span><span class=nv>DB_PORT</span><span class=k>:-</span><span class=nv>5432</span><span class=si>}</span>
</span></span><span class=line><span class=cl><span class=nb>readonly</span> <span class=nv>DB_HOSTPORT</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$DB_HOST</span><span class=s2>:</span><span class=nv>$DB_PORT</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>CONF_FILE</span><span class=o>=</span><span class=s2>&#34;/var/lib/pgsql/data/postgresql.conf&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>check_postgresql_installed
</span></span><span class=line><span class=cl>configure_postgresql_conf
</span></span><span class=line><span class=cl>enable_remote_connections
</span></span><span class=line><span class=cl>create_db metastore hive hive
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>manager_db restart
</span></span><span class=line><span class=cl>init_hive_metastore metastore hive <span class=sb>`</span>ls /usr/lib/hive/scripts/metastore/upgrade/postgres/hive-schema-* <span class=p>|</span>tail -n 1<span class=sb>`</span>
</span></span></code></pre></div><h2 id=docker安装>docker安装</h2><p>使用docker-compose安装，postgresql.yaml</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pgsql</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>postgres:13-alpine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>pgsql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>5432</span><span class=p>:</span><span class=m>5432</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#- POSTGRES_DB: postgres</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>POSTGRES_USER=postgres</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>POSTGRES_PASSWORD=admin@pg!</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c>#- ./sql/schema.postgresql.sql:/docker-entrypoint-initdb.d/schema.postgresql.sql:ro</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/data/postgres:/var/lib/postgresql/data</span><span class=w>
</span></span></span></code></pre></div><p>运行容器：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose -f postgresql.yaml up -d
</span></span></code></pre></div><p>进入容器并创建数据库和用户，例如：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker <span class=nb>exec</span> -it pgsql psql -U postgres -c <span class=s2>&#34;CREATE USER cusdis WITH PASSWORD &#39;123456&#39;;&#34;</span>
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> -it pgsql psql -U postgres -c <span class=s2>&#34;CREATE DATABASE cusdis owner=cusdis;&#34;</span>
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> -it pgsql psql -U postgres -c <span class=s2>&#34;GRANT ALL privileges ON DATABASE cusdis TO cusdis;&#34;</span>
</span></span></code></pre></div></article><h2>相关文章</h2><dl class=row><dt class=col-md-3>2023-01-25</dt><dd class=col-md-9><a href=/posts/2023/01/25/notes-about-deploy-services-in-vps/>我的VPS服务部署记录</a></dd><dt class=col-md-3>2022-08-19</dt><dd class=col-md-9><a href=/posts/2022/08/19/mysql-install-deploy/>MySql安装和部署</a></dd><dt class=col-md-3>2022-08-18</dt><dd class=col-md-9><a href=/posts/2022/08/18/doris-external-table-load/>Doris通过外部表同步数据</a></dd></dl><div class=author-card><div class=underline></div><div class=author-box><div class=author-image><a href=https://blog.chensoul.com><img src=/images/author.webp alt=chensoul></a></div><div class=author-content><p class=author-title>作者</p><p class=author-name>chensoul</p><p class=author-desc>Java 开发工程师，喜欢探索新技术。 可以在 <a href=https://github.com/chensoul>GitHub</a> 了解更多关于我的信息，也欢迎加入我的 <a href=https://t.me/chensoul_share>Telegram</a> 频道。</p></div></div></div><div align=center><div class=comment-underline></div></div><br><div id=cusdis_thread data-host=https://cusdis.chensoul.com data-app-id=3fce9b16-7416-4c74-9786-757bf28c1b8b data-page-id=e29cbec325991f4f605c2245efa69382 data-page-url=https://blog.chensoul.com/posts/2022/08/19/postgresql-install-deploy/ data-page-title=PostgreSql安装和部署></div><script async defer src=/js/cusdis.min.js></script></div></main><div class="footer gradient-2"><div class="container footer-container"><div class=row><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3"><div class=footer-title>网站地图</div><ul class=list-unstyled><li><a href=https://blog.chensoul.com/tags/>标签</a></li><li><a href=https://blog.chensoul.com/categories/>分类</a></li><li><a rel=alternate type=application/rss+xml href=https://blog.chensoul.com/index.xml></i>RSS</a></li></ul></div><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3"><div class=footer-title>社交</div><ul class=list-unstyled><li><a href=https://t.me/chensoul_share rel=noopener target=_blank>Telegram</a></li><li><a href=https://twitter.com/chensoul_eth rel=noopener target=_blank>Twitter</a></li><li><a href=https://github.com/chensoul rel=noopener target=_blank>GitHub</a></li></ul></div><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3"><div class=footer-title>关于</div><ul class=list-unstyled><li><a href=https://blog.chensoul.com/memos rel=noopener target=_blank>嘀咕</a></li><li><a href=https://blog.chensoul.com/links rel=noopener target=_blank>友链</a></li><li><a href=https://blog.chensoul.com/about rel=noopener target=_blank>关于</a></li></ul></div><div class="col-xs-12 col-sm-3 col-md-3 col-lg-3"><p class="pull-right text-right"><small><em>Blog <a href=https://umami.chensoul.com/share/zWO2pDuP/chenshou rel=noopener target=_blank>analytics</a></em></small><br><small><em>Powered by <a href=https://gohugo.io/ rel=noopener target=_blank>Hugo</a></em></small><br><small><em>Theme - <a href=https://github.com/shaform/hugo-theme-den rel=noopener target=_blank>Den</a></em></small><br><small>&copy;
chensoul
2020 -
2023</small></p></div><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" id=scroll-top class=scroll-top accesskey=g><span class=arrow-icon></span></a>
<script>var topButton=document.getElementById("scroll-top");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(topButton.style.visibility="visible",topButton.style.opacity="1"):(topButton.style.visibility="hidden",topButton.style.opacity="0")}</script></div></div></div><script async defer data-website-id=f110cfa0-b737-4690-a032-2b9073a57fc3 src=https://umami.chensoul.com/umami.js></script></body></html>