<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>我的VPS服务部署记录 | ChenSoul</title><meta name=keywords content="hugo,docker,rsshub,kuma,umami,cusdis,memos,n8n"><meta name=description content="服务器设置 [可选] 设置系统 Swap 交换分区 因为 vps 服务器的运行内存很小，所以这里先设置下 Swap # 1GB RAM with 2GB Swap sudo fallocate -l 2G /swapfile && \ sudo dd if=/dev/zero of=/swapfile bs=1024 count=2097152 && \ sudo chmod 600 /swapfile && \ sudo mkswap"><meta name=author content="chensoul"><link rel=canonical href=https://blog.chensoul.com/posts/2023/01/25/notes-about-deploy-services-in-vps/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.chensoul.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.chensoul.com/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://blog.chensoul.com/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://blog.chensoul.com/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://blog.chensoul.com/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="我的VPS服务部署记录"><meta property="og:description" content="服务器设置 [可选] 设置系统 Swap 交换分区 因为 vps 服务器的运行内存很小，所以这里先设置下 Swap # 1GB RAM with 2GB Swap sudo fallocate -l 2G /swapfile && \ sudo dd if=/dev/zero of=/swapfile bs=1024 count=2097152 && \ sudo chmod 600 /swapfile && \ sudo mkswap"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.chensoul.com/posts/2023/01/25/notes-about-deploy-services-in-vps/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-01-25T10:38:34+08:00"><meta property="article:modified_time" content="2023-01-25T10:38:34+08:00"><meta property="og:site_name" content="ChenSoul"><meta name=twitter:card content="summary"><meta name=twitter:title content="我的VPS服务部署记录"><meta name=twitter:description content="服务器设置 [可选] 设置系统 Swap 交换分区 因为 vps 服务器的运行内存很小，所以这里先设置下 Swap # 1GB RAM with 2GB Swap sudo fallocate -l 2G /swapfile && \ sudo dd if=/dev/zero of=/swapfile bs=1024 count=2097152 && \ sudo chmod 600 /swapfile && \ sudo mkswap"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.chensoul.com/posts/"},{"@type":"ListItem","position":2,"name":"我的VPS服务部署记录","item":"https://blog.chensoul.com/posts/2023/01/25/notes-about-deploy-services-in-vps/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"我的VPS服务部署记录","name":"我的VPS服务部署记录","description":"服务器设置 [可选] 设置系统 Swap 交换分区 因为 vps 服务器的运行内存很小，所以这里先设置下 Swap # 1GB RAM with 2GB Swap sudo fallocate -l 2G /swapfile \u0026amp;\u0026amp; \\ sudo dd if=/dev/zero of=/swapfile bs=1024 count=2097152 \u0026amp;\u0026amp; \\ sudo chmod 600 /swapfile \u0026amp;\u0026amp; \\ sudo mkswap","keywords":["hugo","docker","rsshub","kuma","umami","cusdis","memos","n8n"],"articleBody":"服务器设置 [可选] 设置系统 Swap 交换分区\n因为 vps 服务器的运行内存很小，所以这里先设置下 Swap\n# 1GB RAM with 2GB Swap sudo fallocate -l 2G /swapfile \u0026\u0026 \\ sudo dd if=/dev/zero of=/swapfile bs=1024 count=2097152 \u0026\u0026 \\ sudo chmod 600 /swapfile \u0026\u0026 \\ sudo mkswap /swapfile \u0026\u0026 \\ sudo swapon /swapfile \u0026\u0026 \\ echo \"/swapfile swap swap defaults 0 0\" | sudo tee -a /etc/fstab \u0026\u0026 \\ sudo swapon --show \u0026\u0026 \\ sudo free -h 安装并生成证书 curl https://get.acme.sh | sh -s email=czj.june@gmail.com .acme.sh/acme.sh --issue --server letsencrypt --dns dns_aws -d chensoul.com -d '*.chensoul.com' .acme.sh/acme.sh --installcert -d chensoul.com -d *.chensoul.com --cert-file /usr/local/nginx/ssl/chensoul.com.cer --key-file /usr/local/nginx/ssl/chensoul.com.key --fullchain-file /usr/local/nginx/ssl/fullchain.cer --ca-file /usr/local/nginx/ssl/ca.cer --reloadcmd \"sudo nginx -s reload\" Docker 安装和配置 Docker 安装 具体过程可以参考网上文章。\n自定义网络 参考 Best Practice: Use a Docker network ，创建一个自定义的网络：\ndocker network create custom 查看 docker 网络：\n[root@vps ~]# docker network ls NETWORK ID NAME DRIVER SCOPE 68f4aeaa57bd bridge bridge local 6a96b9d8617e custom bridge local 4a8679e35f4d host host local ba21bef23b04 none null local 注意：bridge、host、none 是内部预先创建的网络。\n然后，在其他服务的 docker-compose.yml 文件添加：\nnetworks: default: external: true name: custom 例如：\nversion: \"3\" services: pgsql: image: postgres:13 restart: always ports: - 5433:5432 environment: - POSTGRES_USER=chenzj - POSTGRES_PASSWORD=chenzj@vps2021 volumes: - /data/postgres:/var/lib/postgresql/data networks: default: external: true name: custom 服务部署 Rsshub 直接通过 Docker 安装运行：\ndocker run -d --name rsshub -p 1200:1200 diygod/rsshub 配置 nginx ：\nserver { listen 80; listen [::]:80; server_name rsshub.chensoul.com; return 301 https://$host$request_uri; } server { listen 443 ssl; server_name rsshub.chensoul.com; ssl_certificate /usr/local/nginx/ssl/fullchain.cer; ssl_certificate_key /usr/local/nginx/ssl/chensoul.com.key; ssl_session_cache shared:SSL:1m; ssl_session_timeout 5m; ssl_ciphers HIGH:!aNULL:!MD5; ssl_prefer_server_ciphers on; location / { proxy_pass http://127.0.0.1:1200; } } Kuma 参考 kuma，使用 docker compose 部署，创建 uptime.yaml：\nversion: '3.3' services: uptime-kuma: image: louislam/uptime-kuma:1 container_name: uptime-kuma volumes: - ~/.uptime-kuma:/app/data ports: - 3001:3001 # : restart: always 启动：\ndocker-compose -f uptime.yaml up -d 配置 nginx ：\nserver { listen 80; listen [::]:80; server_name uptime.chensoul.com; return 301 https://$host$request_uri; } server { listen 443 ssl; server_name uptime.chensoul.com; ssl_certificate /usr/local/nginx/ssl/fullchain.cer; ssl_certificate_key /usr/local/nginx/ssl/chensoul.com.key; ssl_session_cache shared:SSL:1m; ssl_session_timeout 5m; ssl_ciphers HIGH:!aNULL:!MD5; ssl_prefer_server_ciphers on; location / { proxy_pass http://127.0.0.1:3001; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header Host $host; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \"upgrade\"; } } Postgresql 1、参考 PostgreSql安装和部署 ，通过 docker-compose 安装，创建 postgresql.yaml：\nversion: \"3\" services: pgsql: image: postgres:13-alpine container_name: pgsql restart: always ports: - 5432:5432 environment: - POSTGRES_USER=postgres - POSTGRES_PASSWORD=admin@pg! networks: - custom volumes: - /data/postgres:/var/lib/postgresql/data networks: custom: external: true 2、启动\ndocker-compose -f postgresql.yaml up -d Umami 参考 umami docker-compose.yml ，使用 docker 镜像 umami:postgresql-latest 来安装 umami。\n1、在 pqsql 容器创建 umami 数据库和用户：\ndocker exec -it pgsql psql -U postgres -c \"CREATE USER umami WITH PASSWORD 'umami@pg';\" docker exec -it pgsql psql -U postgres -c \"CREATE DATABASE umami owner=umami;\" docker exec -it pgsql psql -U postgres -c \"GRANT ALL privileges ON DATABASE umami TO umami;\" 然后，初始化数 umami 数据。先进入容器：\ndocker exec -it pgsql bash 进入 umami 数据库：\npsql -U umami -d umami umami=\u003e 执行 schema.postgresql.sql 文件内容。\n2、通过 docker-compose 安装，创建 umami.yaml：\nversion: '3' services: umami: image: ghcr.io/umami-software/umami:postgresql-latest container_name: umami ports: - \"3000:3000\" environment: DATABASE_URL: postgresql://umami:umami@pg@pgsql:5432/umami DATABASE_TYPE: postgresql HASH_SALT: vps@2023 networks: - custom restart: always networks: custom: external: true 启动：\ndocker-compose -f umami.yaml up -d 3、设置自定义域名\numami.chensoul.com\n4、配置 nginx\nserver { listen 80; listen [::]:80; server_name umami.chensoul.com; return 301 https://$host$request_uri; } server { listen 443 ssl; server_name umami.chensoul.com; ssl_certificate /usr/local/nginx/ssl/fullchain.cer; ssl_certificate_key /usr/local/nginx/ssl/chensoul.com.key; ssl_session_cache shared:SSL:1m; ssl_session_timeout 5m; ssl_ciphers HIGH:!aNULL:!MD5; ssl_prefer_server_ciphers on; location / { proxy_pass http://127.0.0.1:3000; } } 5、添加网站\n访问 https://umami.chensoul.com/，默认用户名和密码为 admin/umami。登陆之后，修改密码，并添加网站。\nCusdis VPS IP 可能被墙，所以可以使用三方云服务部署，具体参考轻量级开源免费博客评论系统解决方案 （Cusdis + Railway）\n1、在 pqsql 容器创建 cusdis 数据库和用户：\ndocker exec -it pgsql psql -U postgres -c \"CREATE USER cusdis WITH PASSWORD 'cusdis@pg';\" docker exec -it pgsql psql -U postgres -c \"CREATE DATABASE cusdis owner=cusdis;\" docker exec -it pgsql psql -U postgres -c \"GRANT ALL privileges ON DATABASE cusdis TO cusdis;\" 2、通过 docker-compose 安装，创建 cusdis.yaml：\nversion: '3' services: cusdis: image: djyde/cusdis:latest container_name: cusdis ports: - \"3010:3000\" environment: - USERNAME=admin - PASSWORD=cusdis - JWT_SECRET=vps@2023 - NEXTAUTH_URL=https://cusdis.chensoul.com - HOST=https://cusdis.chensoul.com - DB_TYPE=pgsql - DB_URL=postgresql://cusdis:cusdis@pg@pgsql:5432/cusdis networks: - custom restart: always networks: custom: external: true 以下配置为 EMAIL 配置可选，下面是使用 Gmail 进行配置，需要首先开启两阶段验证并创建一个应用密码：\nSMTP_HOST=smtp.gmail.com SMTP_PORT=465 SMTP_SECURE=true SMTP_USER=your gmail email SMTP_PASSWORD= SMTP_SENDER=your gmail email 3、启动\ndocker-compose -f cusdis.yaml up -d 4、配置 nginx\nserver { listen 80; listen [::]:80; server_name cusdis.chensoul.com; return 301 https://$host$request_uri; } server { listen 443 ssl; server_name cusdis.chensoul.com; ssl_certificate /usr/local/nginx/ssl/fullchain.cer; ssl_certificate_key /usr/local/nginx/ssl/chensoul.com.key; ssl_session_cache shared:SSL:1m; ssl_session_timeout 5m; ssl_ciphers HIGH:!aNULL:!MD5; ssl_prefer_server_ciphers on; location / { proxy_pass http://127.0.0.1:3010; proxy_pass_header Authorization; proxy_pass_header WWW-Authenticate; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; if ($uri = '/js/iframe.umd.js') { add_header 'Access-Control-Allow-Origin' '*'; #add_header 'Access-Control-Allow-Origin' 'http://localhost:1313'; } } } 5、部署一个 Telegram 机器人，参考 Official Telegram bot。\nmemos 通过 docker-compose 安装，创建 memos.yaml：\nversion: \"3.0\" services: memos: image: neosmemo/memos:latest container_name: memos volumes: - ~/.memos/:/var/opt/memos ports: - 5230:5230 启动\ndocker-compose -f memos.yaml up -d 配置 nginx\nserver { listen 80; listen [::]:80; server_name memos.chensoul.com; return 301 https://$host$request_uri; } server { listen 443 ssl; server_name memos.chensoul.com; ssl_certificate /usr/local/nginx/ssl/fullchain.cer; ssl_certificate_key /usr/local/nginx/ssl/chensoul.com.key; ssl_session_cache shared:SSL:1m; ssl_session_timeout 5m; ssl_ciphers HIGH:!aNULL:!MD5; ssl_prefer_server_ciphers on; location / { proxy_pass http://127.0.0.1:5230; } } n8n 1、在 pqsql 容器创建 n8n 数据库和用户：\ndocker exec -it pgsql psql -U postgres -c \"CREATE USER n8n WITH PASSWORD 'n8n@pg';\" docker exec -it pgsql psql -U postgres -c \"CREATE DATABASE n8n owner=n8n;\" docker exec -it pgsql psql -U postgres -c \"GRANT ALL privileges ON DATABASE n8n TO n8n;\" ; 2、通过 docker-compose 安装，创建 n8n.yaml：\nversion: '3.8' services: n8n: image: n8nio/n8n container_name: n8n restart: always environment: - DB_TYPE=postgresdb - DB_POSTGRESDB_HOST=pgsql - DB_POSTGRESDB_PORT=5432 - DB_POSTGRESDB_DATABASE=n8n - DB_POSTGRESDB_USER=n8n - DB_POSTGRESDB_PASSWORD=n8n@pg - N8N_BASIC_AUTH_ACTIVE=true - N8N_BASIC_AUTH_USER=admin - N8N_BASIC_AUTH_PASSWORD=chenzj - TZ=\"Asia/Shanghai\" - WEBHOOK_URL=https://n8n.chensoul.com/ ports: - 5678:5678 volumes: - /data/n8n:/home/node/.n8n command: /bin/sh -c \"n8n start --tunnel\" networks: - custom networks: custom: external: true 3、启动\ndocker-compose -f n8n.yaml up -d 4、设置 nginx 转发\nlocation / { proxy_pass http://127.0.0.1:5678/; proxy_set_header Connection ''; proxy_http_version 1.1; chunked_transfer_encoding off; proxy_buffering off; proxy_cache off; access_log /var/log/nginx/forward.log combined buffer=128k flush=5s; } 这里面的转发配置不对的话，会导致直接访问 5678 端口正常，但是访问 nginx 的话，workflow 会一直处于执行。\n5、添加 workflow\n参考这篇文章 http://stiles.cc/archives/237/ ，目前我配置了以下 workflows，实现了 github、douban、rss、memos 同步到 Telegram。\n","wordCount":"1565","inLanguage":"en","datePublished":"2023-01-25T10:38:34+08:00","dateModified":"2023-01-25T10:38:34+08:00","author":{"@type":"Person","name":"chensoul"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.chensoul.com/posts/2023/01/25/notes-about-deploy-services-in-vps/"},"publisher":{"@type":"Organization","name":"ChenSoul","logo":{"@type":"ImageObject","url":"https://blog.chensoul.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.chensoul.com/ accesskey=h title="ChenSoul (Alt + H)">ChenSoul</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.chensoul.com/categories/ideas title=周报><span>周报</span></a></li><li><a href=https://blog.chensoul.com/categories/notes title=编程><span>编程</span></a></li><li><a href=https://blog.chensoul.com/tags title=标签><span>标签</span></a></li><li><a href=https://blog.chensoul.com/about title=关于><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>我的VPS服务部署记录</h1><div class=post-meta><span title='2023-01-25 10:38:34 +0800 +0800'>2023-01-25</span>&nbsp;·&nbsp;chensoul</div></header><div class=post-content><h2 id=服务器设置>服务器设置<a hidden class=anchor aria-hidden=true href=#服务器设置>#</a></h2><p><strong>[可选] 设置系统 Swap 交换分区</strong></p><p>因为 vps 服务器的运行内存很小，所以这里先设置下 Swap</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1GB RAM with 2GB Swap</span>
</span></span><span class=line><span class=cl>sudo fallocate -l 2G /swapfile <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>sudo dd <span class=k>if</span><span class=o>=</span>/dev/zero <span class=nv>of</span><span class=o>=</span>/swapfile <span class=nv>bs</span><span class=o>=</span><span class=m>1024</span> <span class=nv>count</span><span class=o>=</span><span class=m>2097152</span> <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>sudo chmod <span class=m>600</span> /swapfile <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>sudo mkswap /swapfile <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>sudo swapon /swapfile <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span><span class=nb>echo</span> <span class=s2>&#34;/swapfile swap swap defaults 0 0&#34;</span> <span class=p>|</span> sudo tee -a /etc/fstab <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>sudo swapon --show <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>sudo free -h
</span></span></code></pre></div><h2 id=安装并生成证书>安装并生成证书<a hidden class=anchor aria-hidden=true href=#安装并生成证书>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl https://get.acme.sh <span class=p>|</span> sh -s <span class=nv>email</span><span class=o>=</span>czj.june@gmail.com
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>.acme.sh/acme.sh --issue --server letsencrypt --dns dns_aws -d chensoul.com -d <span class=s1>&#39;*.chensoul.com&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>.acme.sh/acme.sh --installcert -d chensoul.com -d *.chensoul.com  --cert-file /usr/local/nginx/ssl/chensoul.com.cer --key-file /usr/local/nginx/ssl/chensoul.com.key --fullchain-file /usr/local/nginx/ssl/fullchain.cer --ca-file /usr/local/nginx/ssl/ca.cer   --reloadcmd <span class=s2>&#34;sudo nginx -s reload&#34;</span>
</span></span></code></pre></div><h2 id=docker-安装和配置>Docker 安装和配置<a hidden class=anchor aria-hidden=true href=#docker-安装和配置>#</a></h2><h3 id=docker-安装>Docker 安装<a hidden class=anchor aria-hidden=true href=#docker-安装>#</a></h3><p>具体过程可以参考网上文章。</p><h3 id=自定义网络>自定义网络<a hidden class=anchor aria-hidden=true href=#自定义网络>#</a></h3><p>参考 <a href=https://nginxproxymanager.com/advanced-config/#best-practice-use-a-docker-network>Best Practice: Use a Docker network</a>
，创建一个自定义的网络：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker network create custom
</span></span></code></pre></div><p>查看 docker 网络：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@vps ~<span class=o>]</span><span class=c1># docker network ls</span>
</span></span><span class=line><span class=cl>NETWORK ID     NAME            DRIVER    SCOPE
</span></span><span class=line><span class=cl>68f4aeaa57bd   bridge          bridge    <span class=nb>local</span>
</span></span><span class=line><span class=cl>6a96b9d8617e   custom          bridge    <span class=nb>local</span>
</span></span><span class=line><span class=cl>4a8679e35f4d   host            host      <span class=nb>local</span>
</span></span><span class=line><span class=cl>ba21bef23b04   none            null      <span class=nb>local</span>
</span></span></code></pre></div><blockquote><p>注意：bridge、host、none 是内部预先创建的网络。</p></blockquote><p>然后，在其他服务的 docker-compose.yml 文件添加：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>external</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>custom</span><span class=w>
</span></span></span></code></pre></div><p>例如：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pgsql</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>postgres:13</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>5433</span><span class=p>:</span><span class=m>5432</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>POSTGRES_USER=chenzj</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>POSTGRES_PASSWORD=chenzj@vps2021</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/data/postgres:/var/lib/postgresql/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>external</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>custom</span><span class=w>
</span></span></span></code></pre></div><h2 id=服务部署>服务部署<a hidden class=anchor aria-hidden=true href=#服务部署>#</a></h2><h3 id=rsshub>Rsshub<a hidden class=anchor aria-hidden=true href=#rsshub>#</a></h3><p>直接通过 Docker 安装运行：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -d --name rsshub -p 1200:1200 diygod/rsshub
</span></span></code></pre></div><p>配置 nginx ：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=s>[::]:80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span> <span class=s>rsshub.chensoul.com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>return</span> <span class=mi>301</span> <span class=s>https://</span><span class=nv>$host$request_uri</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span>          <span class=mi>443</span> <span class=s>ssl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span>     <span class=s>rsshub.chensoul.com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_certificate</span>      <span class=s>/usr/local/nginx/ssl/fullchain.cer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_certificate_key</span>  <span class=s>/usr/local/nginx/ssl/chensoul.com.key</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_session_cache</span>    <span class=s>shared:SSL:1m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_session_timeout</span>  <span class=mi>5m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_ciphers</span>  <span class=s>HIGH:!aNULL:!MD5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_prefer_server_ciphers</span>  <span class=no>on</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>location</span> <span class=s>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_pass</span> <span class=s>http://127.0.0.1:1200</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=kuma>Kuma<a hidden class=anchor aria-hidden=true href=#kuma>#</a></h3><p>参考 <a href=https://uptime.kuma.pet/>kuma</a>，使用 docker compose 部署，创建 uptime.yaml：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3.3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>uptime-kuma</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>louislam/uptime-kuma:1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>uptime-kuma</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>~/.uptime-kuma:/app/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>3001</span><span class=p>:</span><span class=m>3001</span><span class=w>  </span><span class=c># &lt;Host Port&gt;:&lt;Container Port&gt;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span></code></pre></div><p>启动：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose -f uptime.yaml up -d
</span></span></code></pre></div><p>配置 nginx ：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=s>[::]:80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span> <span class=s>uptime.chensoul.com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>return</span> <span class=mi>301</span> <span class=s>https://</span><span class=nv>$host$request_uri</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span>          <span class=mi>443</span> <span class=s>ssl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span>     <span class=s>uptime.chensoul.com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_certificate</span>      <span class=s>/usr/local/nginx/ssl/fullchain.cer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_certificate_key</span>  <span class=s>/usr/local/nginx/ssl/chensoul.com.key</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_session_cache</span>    <span class=s>shared:SSL:1m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_session_timeout</span>  <span class=mi>5m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_ciphers</span>  <span class=s>HIGH:!aNULL:!MD5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_prefer_server_ciphers</span>  <span class=no>on</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>location</span> <span class=s>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_pass</span> <span class=s>http://127.0.0.1:3001</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	    <span class=kn>proxy_set_header</span>   <span class=s>X-Real-IP</span> <span class=nv>$remote_addr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span>   <span class=s>X-Forwarded-For</span> <span class=nv>$proxy_add_x_forwarded_for</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span>   <span class=s>Host</span> <span class=nv>$host</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_http_version</span> <span class=mi>1</span><span class=s>.1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span>   <span class=s>Upgrade</span> <span class=nv>$http_upgrade</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span>   <span class=s>Connection</span> <span class=s>&#34;upgrade&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=postgresql>Postgresql<a hidden class=anchor aria-hidden=true href=#postgresql>#</a></h3><p>1、参考 <a href=/posts/2022/08/19/postgresql-install-deploy/>PostgreSql安装和部署</a> ，通过 docker-compose 安装，创建
postgresql.yaml：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pgsql</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>postgres:13-alpine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>pgsql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>5432</span><span class=p>:</span><span class=m>5432</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>POSTGRES_USER=postgres</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>POSTGRES_PASSWORD=admin@pg!</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>custom</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/data/postgres:/var/lib/postgresql/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>custom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>external</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span></code></pre></div><p>2、启动</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose -f postgresql.yaml up -d
</span></span></code></pre></div><h3 id=umami>Umami<a hidden class=anchor aria-hidden=true href=#umami>#</a></h3><p>参考 <a href=https://github.com/umami-software/umami/blob/master/docker-compose.yml>umami docker-compose.yml</a> ，使用 docker 镜像
umami:postgresql-latest 来安装 umami。</p><p>1、在 pqsql 容器创建 umami 数据库和用户：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker <span class=nb>exec</span> -it pgsql psql -U postgres -c <span class=s2>&#34;CREATE USER umami WITH PASSWORD &#39;umami@pg&#39;;&#34;</span>
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> -it pgsql psql -U postgres -c <span class=s2>&#34;CREATE DATABASE umami owner=umami;&#34;</span>
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> -it pgsql psql -U postgres -c <span class=s2>&#34;GRANT ALL privileges ON DATABASE umami TO umami;&#34;</span>
</span></span></code></pre></div><p>然后，初始化数 umami 数据。先进入容器：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker exec -it pgsql bash
</span></span></code></pre></div><p>进入 umami 数据库：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>psql -U umami -d umami
</span></span><span class=line><span class=cl><span class=nv>umami</span><span class=o>=</span>&gt;
</span></span></code></pre></div><p>执行 <a href=https://github.com/umami-software/umami/blob/master/sql/schema.postgresql.sql><strong>schema.postgresql.sql</strong></a> 文件内容。</p><p>2、通过 docker-compose 安装，创建 umami.yaml：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>umami</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>ghcr.io/umami-software/umami:postgresql-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>umami</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;3000:3000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>DATABASE_URL</span><span class=p>:</span><span class=w> </span><span class=l>postgresql://umami:umami@pg@pgsql:5432/umami</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>DATABASE_TYPE</span><span class=p>:</span><span class=w> </span><span class=l>postgresql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>HASH_SALT</span><span class=p>:</span><span class=w> </span><span class=l>vps@2023</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>custom</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>custom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>external</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span></code></pre></div><p>启动：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose -f umami.yaml up -d
</span></span></code></pre></div><p>3、设置自定义域名</p><p>umami.chensoul.com</p><p>4、配置 nginx</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=s>[::]:80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span> <span class=s>umami.chensoul.com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>return</span> <span class=mi>301</span> <span class=s>https://</span><span class=nv>$host$request_uri</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span>          <span class=mi>443</span> <span class=s>ssl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span>     <span class=s>umami.chensoul.com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_certificate</span>      <span class=s>/usr/local/nginx/ssl/fullchain.cer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_certificate_key</span>  <span class=s>/usr/local/nginx/ssl/chensoul.com.key</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_session_cache</span>    <span class=s>shared:SSL:1m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_session_timeout</span>  <span class=mi>5m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_ciphers</span>  <span class=s>HIGH:!aNULL:!MD5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_prefer_server_ciphers</span>  <span class=no>on</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>location</span> <span class=s>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_pass</span> <span class=s>http://127.0.0.1:3000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>5、添加网站</p><p>访问 <a href=https://umami.chensoul.com/>https://umami.chensoul.com/</a>，默认用户名和密码为 admin/umami。登陆之后，修改密码，并添加网站。</p><h3 id=cusdis>Cusdis<a hidden class=anchor aria-hidden=true href=#cusdis>#</a></h3><blockquote><p>VPS IP 可能被墙，所以可以使用三方云服务部署，具体参考<a href=https://www.pseudoyu.com/zh/2022/05/24/free_and_lightweight_blog_comment_system_using_cusdis_and_railway/>轻量级开源免费博客评论系统解决方案 （Cusdis + Railway）</a></p></blockquote><p>1、在 pqsql 容器创建 cusdis 数据库和用户：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker <span class=nb>exec</span> -it pgsql psql -U postgres -c <span class=s2>&#34;CREATE USER cusdis WITH PASSWORD &#39;cusdis@pg&#39;;&#34;</span>
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> -it pgsql psql -U postgres -c <span class=s2>&#34;CREATE DATABASE cusdis owner=cusdis;&#34;</span>
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> -it pgsql psql -U postgres -c <span class=s2>&#34;GRANT ALL privileges ON DATABASE cusdis TO cusdis;&#34;</span>
</span></span></code></pre></div><p>2、通过 docker-compose 安装，创建 cusdis.yaml：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cusdis</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>djyde/cusdis:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>cusdis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;3010:3000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>USERNAME=admin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>PASSWORD=cusdis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>JWT_SECRET=vps@2023</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>NEXTAUTH_URL=https://cusdis.chensoul.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>HOST=https://cusdis.chensoul.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>DB_TYPE=pgsql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>DB_URL=postgresql://cusdis:cusdis@pg@pgsql:5432/cusdis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>custom</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>custom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>external</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span></code></pre></div><p>以下配置为 EMAIL 配置可选，下面是使用 <a href="https://cusdis.com/doc#/features/notification?id=gmail">Gmail</a>
进行配置，需要首先开启两阶段验证并创建一个应用密码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-properties data-lang=properties><span class=line><span class=cl><span class=na>SMTP_HOST</span><span class=o>=</span><span class=s>smtp.gmail.com</span>
</span></span><span class=line><span class=cl><span class=na>SMTP_PORT</span><span class=o>=</span><span class=s>465</span>
</span></span><span class=line><span class=cl><span class=na>SMTP_SECURE</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl><span class=na>SMTP_USER</span><span class=o>=</span><span class=s>your gmail email</span>
</span></span><span class=line><span class=cl><span class=na>SMTP_PASSWORD</span><span class=o>=</span><span class=s>&lt;app password&gt;</span>
</span></span><span class=line><span class=cl><span class=na>SMTP_SENDER</span><span class=o>=</span><span class=s>your gmail email</span>
</span></span></code></pre></div><p>3、启动</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose -f cusdis.yaml up -d
</span></span></code></pre></div><p>4、配置 nginx</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=s>[::]:80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span> <span class=s>cusdis.chensoul.com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>return</span> <span class=mi>301</span> <span class=s>https://</span><span class=nv>$host$request_uri</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span>          <span class=mi>443</span> <span class=s>ssl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span>     <span class=s>cusdis.chensoul.com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_certificate</span>      <span class=s>/usr/local/nginx/ssl/fullchain.cer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_certificate_key</span>  <span class=s>/usr/local/nginx/ssl/chensoul.com.key</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_session_cache</span>    <span class=s>shared:SSL:1m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_session_timeout</span>  <span class=mi>5m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_ciphers</span>  <span class=s>HIGH:!aNULL:!MD5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_prefer_server_ciphers</span>  <span class=no>on</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>location</span> <span class=s>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_pass</span> <span class=s>http://127.0.0.1:3010</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kn>proxy_pass_header</span> <span class=s>Authorization</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kn>proxy_pass_header</span> <span class=s>WWW-Authenticate</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>Host</span> <span class=nv>$host</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>X-Real-IP</span> <span class=nv>$remote_addr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>X-Forwarded-For</span> <span class=nv>$proxy_add_x_forwarded_for</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kn>if</span> <span class=s>(</span><span class=nv>$uri</span> <span class=p>=</span> <span class=s>&#39;/js/iframe.umd.js&#39;)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        	<span class=kn>add_header</span> <span class=s>&#39;Access-Control-Allow-Origin&#39;</span> <span class=s>&#39;*&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        	<span class=c1>#add_header &#39;Access-Control-Allow-Origin&#39; &#39;http://localhost:1313&#39;;
</span></span></span><span class=line><span class=cl><span class=c1></span>    	<span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>5、部署一个 Telegram 机器人，参考 <a href="https://cusdis.chensoul.com/doc#/advanced/webhook?id=official-telegram-bot">Official Telegram bot</a>。</p><h3 id=memos>memos<a hidden class=anchor aria-hidden=true href=#memos>#</a></h3><p>通过 docker-compose 安装，创建 memos.yaml：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3.0&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>memos</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>neosmemo/memos:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>memos</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>~/.memos/:/var/opt/memos</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>5230</span><span class=p>:</span><span class=m>5230</span><span class=w>
</span></span></span></code></pre></div><p>启动</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose -f memos.yaml up -d
</span></span></code></pre></div><p>配置 nginx</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=s>[::]:80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span> <span class=s>memos.chensoul.com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>return</span> <span class=mi>301</span> <span class=s>https://</span><span class=nv>$host$request_uri</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span>          <span class=mi>443</span> <span class=s>ssl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span>     <span class=s>memos.chensoul.com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_certificate</span>      <span class=s>/usr/local/nginx/ssl/fullchain.cer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_certificate_key</span>  <span class=s>/usr/local/nginx/ssl/chensoul.com.key</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_session_cache</span>    <span class=s>shared:SSL:1m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_session_timeout</span>  <span class=mi>5m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_ciphers</span>  <span class=s>HIGH:!aNULL:!MD5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_prefer_server_ciphers</span>  <span class=no>on</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>location</span> <span class=s>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_pass</span> <span class=s>http://127.0.0.1:5230</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=n8n>n8n<a hidden class=anchor aria-hidden=true href=#n8n>#</a></h3><p>1、在 pqsql 容器创建 n8n 数据库和用户：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker <span class=nb>exec</span> -it pgsql psql -U postgres -c <span class=s2>&#34;CREATE USER n8n WITH PASSWORD &#39;n8n@pg&#39;;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> -it pgsql psql -U postgres -c <span class=s2>&#34;CREATE DATABASE n8n owner=n8n;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> -it pgsql psql -U postgres -c <span class=s2>&#34;GRANT ALL privileges ON DATABASE n8n TO n8n;&#34;</span> <span class=p>;</span>
</span></span></code></pre></div><p>2、通过 docker-compose 安装，创建 n8n.yaml：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3.8&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>n8n</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>n8nio/n8n</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>n8n</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>DB_TYPE=postgresdb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>DB_POSTGRESDB_HOST=pgsql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>DB_POSTGRESDB_PORT=5432</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>DB_POSTGRESDB_DATABASE=n8n</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>DB_POSTGRESDB_USER=n8n</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>DB_POSTGRESDB_PASSWORD=n8n@pg</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>N8N_BASIC_AUTH_ACTIVE=true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>N8N_BASIC_AUTH_USER=admin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>N8N_BASIC_AUTH_PASSWORD=chenzj</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>TZ=&#34;Asia/Shanghai&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>WEBHOOK_URL=https://n8n.chensoul.com/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>5678</span><span class=p>:</span><span class=m>5678</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/data/n8n:/home/node/.n8n</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=l>/bin/sh -c &#34;n8n start --tunnel&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>custom</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>custom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>external</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span></code></pre></div><p>3、启动</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose -f n8n.yaml up -d
</span></span></code></pre></div><p>4、设置 nginx 转发</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>location</span> <span class=s>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>proxy_pass</span> <span class=s>http://127.0.0.1:5678/</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>proxy_set_header</span> <span class=s>Connection</span> <span class=s>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>proxy_http_version</span> <span class=mi>1</span><span class=s>.1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>chunked_transfer_encoding</span> <span class=no>off</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>proxy_buffering</span> <span class=no>off</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>proxy_cache</span> <span class=no>off</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>access_log</span> <span class=s>/var/log/nginx/forward.log</span> <span class=s>combined</span> <span class=s>buffer=128k</span> <span class=s>flush=5s</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>这里面的转发配置不对的话，会导致直接访问 5678 端口正常，但是访问 nginx 的话，workflow 会一直处于执行。</p><p>5、添加 workflow</p><p>参考这篇文章 <a href=http://stiles.cc/archives/237/>http://stiles.cc/archives/237/</a> ，目前我配置了以下 workflows，实现了 github、douban、rss、memos 同步到 Telegram。</p><p><img loading=lazy src=http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/my-n8n-workflows.png alt=my-n8n-workflows></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.chensoul.com/tags/hugo/>hugo</a></li><li><a href=https://blog.chensoul.com/tags/docker/>docker</a></li><li><a href=https://blog.chensoul.com/tags/rsshub/>rsshub</a></li><li><a href=https://blog.chensoul.com/tags/kuma/>kuma</a></li><li><a href=https://blog.chensoul.com/tags/umami/>umami</a></li><li><a href=https://blog.chensoul.com/tags/cusdis/>cusdis</a></li><li><a href=https://blog.chensoul.com/tags/memos/>memos</a></li><li><a href=https://blog.chensoul.com/tags/n8n/>n8n</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://blog.chensoul.com/>ChenSoul</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script async src=https://umami.chensoul.com/script.js data-website-id=f110cfa0-b737-4690-a032-2b9073a57fc3></script>
<script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>