<!doctype html><html lang=en-US prefix="og: http://ogp.me/ns#"><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="我的 VPS 使用的是 centos 服务器，所以以下操作都是基于 centos 系统。
服务器设置
设置 yum 源："><title>我的VPS服务部署记录 | ChenSoul</title>
<link rel=canonical href=https://blog.chensoul.cc/posts/2023/01/25/notes-about-deploy-services-in-vps/><link rel=preconnect href=https://fonts.font.im><link rel=preconnect href=https://fonts.loli.net crossorigin><link href="https://fonts.loli.net/css2?family=Roboto+Slab:wght@400;500;700&display=swap" rel=stylesheet><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.chensoul.cc/images/favicon.webp"><meta name=twitter:title content="我的VPS服务部署记录"><meta name=twitter:description content="我的 VPS 使用的是 centos 服务器，所以以下操作都是基于 centos 系统。
服务器设置 设置 yum 源："><meta name=twitter:creator content="@ichensoul"><meta property="og:locale" content="en_US"><meta property="og:site_name" content="chensoul"><meta property="og:url" content="https://blog.chensoul.cc/posts/2023/01/25/notes-about-deploy-services-in-vps/"><meta property="og:site_name" content="ChenSoul"><meta property="og:title" content="我的VPS服务部署记录"><meta property="og:description" content="我的 VPS 使用的是 centos 服务器，所以以下操作都是基于 centos 系统。
服务器设置 设置 yum 源："><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-01-25T00:00:00+00:00"><meta property="article:modified_time" content="2023-01-25T00:00:00+00:00"><meta property="article:tag" content="Vps"><meta property="article:tag" content="Memos"><meta property="article:tag" content="Umami"><meta property="article:tag" content="Docker"><meta property="article:tag" content="N8n"><meta property="article:tag" content="Postgres"><meta property="og:image" content="https://blog.chensoul.cc/images/favicon.webp"><meta itemprop=name content="我的VPS服务部署记录"><meta itemprop=description content="我的 VPS 使用的是 centos 服务器，所以以下操作都是基于 centos 系统。
服务器设置 设置 yum 源："><meta itemprop=datePublished content="2023-01-25T00:00:00+00:00"><meta itemprop=dateModified content="2023-01-25T00:00:00+00:00"><meta itemprop=wordCount content="2021"><meta itemprop=image content="https://blog.chensoul.cc/images/favicon.webp"><meta itemprop=keywords content="Vps,Memos,Umami,Docker,N8n,Postgres"><link rel=stylesheet href=https://cdnjs.loli.net/ajax/libs/font-awesome/6.4.0/css/all.min.css media=all><link rel=stylesheet href=/main.min.css type=text/css media=all><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"TechArticle","name":"我的VPS服务部署记录","headline":"我的VPS服务部署记录","inLanguage":"en-US","url":"https://blog.chensoul.cc/posts/2023/01/25/notes-about-deploy-services-in-vps/","description":"\u003cp\u003e我的 VPS 使用的是 centos 服务器，所以以下操作都是基于 centos 系统。\u003c/p\u003e\n\u003ch2 id=\"服务器设置\"\u003e服务器设置\u003c/h2\u003e\n\u003cp\u003e设置 yum 源：\u003c/p\u003e","wordCount":"2021","keywords":["vps","memos","umami","docker","n8n","postgres"],"datePublished":"2023-01-25T00:00:00Z","dateModified":"2023-01-25T00:00:00Z","author":{"@type":"Person","name":"chensoul"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.chensoul.cc/posts/2023/01/25/notes-about-deploy-services-in-vps/"},"publisher":{"@type":"Organization","name":"chensoul","url":"https://blog.chensoul.cc/posts/2023/01/25/notes-about-deploy-services-in-vps/"}},{"@context":"https://schema.org","@type":"Organization","name":"chensoul","url":"https://blog.chensoul.cc/","sameAs":["https://x.com/ichensoul","https://github.com/chensoul","https://www.linkedin.com/in/","https://www.youtube.com/@chensoul","https://t.me/chensouls"]}]}</script><script defer src=https://umami.chensoul.cc/random-string.js data-website-id=821c25f8-a31a-4607-92d7-91ee76843d00></script></head><body class="home blog post-layout-one-column"><button onclick=topFunction() id=scrollTopBtn title="Go to top">
<i class="fa-solid fa-arrow-up"></i></button><div id=header-top class=header-bar-wrap></div><div id=page class=site><a class="skip-link screen-reader-text" href=#content>Skip to content</a><header id=masthead class="site-header clearfix" role=banner><div class="header-main container clearfix"><div id=logo class="site-branding clearfix"><h1 class=site-title><a href=/ title=ChenSoul rel=home>ChenSoul</a></h1><p class=site-description>Java, Spring Boot, Microservice, Cloud, Architecture and DevOps Tutorials</p></div><div class="header-widgets clearfix"><aside id=search-2 class="header-widget widget_search"><form role=search method=get class=search-form onsubmit="return searchSite(event)"><label><span class=screen-reader-text>Search for:</span>
<input type=search class=search-field placeholder="Enter search keyword" name=query id=query title="Enter search keyword">
</label><button type=submit class=search-submit title=Search> <span class=genericon-search></span>
<span class=screen-reader-text>Search</span></button></form></aside></div></div><div id=main-navigation-wrap class=primary-navigation-wrap><nav id=main-navigation class="primary-navigation navigation container clearfix" role=navigation><ul id=menu-home class=main-navigation-menu><li class="menu-item menu-item-type-custom menu-item-object-custom
current-menu-item current_page_item menu-item-home"><a href=/>Home</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/categories/spring-boot/>Spring Boot</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/categories/architecture/>Architecture</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/categories/microservice/>Microservice</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/categories/kubernetes/>Kubernetes</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category
menu-item-has-children"><a href=/tutorials/>Tutorials</a><ul class=sub-menu><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/spring-boot-tutorials/>Spring Boot Tutorials</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/microservice-tutorials/>Microservice Tutorials</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/kubernetes-tutorials/>Kubernetes Tutorials</a></li></ul></li><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=https://github.com/chensoul target=_blank>About Me</a></li></ul></nav></div></header><div id=content class="site-content container clearfix"><section id=primary class="content-archive content-area post-content-area"><main id=main class=site-main role=main><article class="post type-post"><div class=post-inner-content><header class=entry-header><h2 class=entry-title><a href=https://blog.chensoul.cc/posts/2023/01/25/notes-about-deploy-services-in-vps/ rel=bookmark title=我的VPS服务部署记录>我的VPS服务部署记录</a></h2><div class=entry-meta><span class=meta-date><time class="entry-date published" datetime=2023-01-25T00:00:00>2023-01-25
</time></span><span class=meta-author><span class="author vcard">chensoul</span>
</span><span class="tagcloud post-tags"><i class="fa fa-tags"></i>&nbsp;
<a class="tag-cloud-link widget__link widget__link--taglist" href=/tags/vps/ title=vps>vps</a>
&nbsp;
<a class="tag-cloud-link widget__link widget__link--taglist" href=/tags/memos/ title=memos>memos</a>
&nbsp;
<a class="tag-cloud-link widget__link widget__link--taglist" href=/tags/umami/ title=umami>umami</a>
&nbsp;
<a class="tag-cloud-link widget__link widget__link--taglist" href=/tags/docker/ title=docker>docker</a>
&nbsp;
<a class="tag-cloud-link widget__link widget__link--taglist" href=/tags/n8n/ title=n8n>n8n</a>
&nbsp;
<a class="tag-cloud-link widget__link widget__link--taglist" href=/tags/postgres/ title=postgres>postgres</a></span></div></header><div class=entry-content><p>我的 VPS 使用的是 centos 服务器，所以以下操作都是基于 centos 系统。</p><h2 id=服务器设置>服务器设置</h2><p>设置 yum 源：</p><p>/etc/yum.repos.d/centos.repo</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>[base]
</span></span><span style=display:flex><span>name=CentOS-$releasever - Base
</span></span><span style=display:flex><span>baseurl=https://vault.centos.org/7.9.2009/os/$basearch/
</span></span><span style=display:flex><span>gpgcheck=1
</span></span><span style=display:flex><span>gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7
</span></span><span style=display:flex><span>enabled=1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[updates]
</span></span><span style=display:flex><span>name=CentOS-$releasever - Updates
</span></span><span style=display:flex><span>baseurl=https://vault.centos.org/7.9.2009/updates/$basearch/
</span></span><span style=display:flex><span>gpgcheck=1
</span></span><span style=display:flex><span>gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7
</span></span><span style=display:flex><span>enabled=1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[extras]
</span></span><span style=display:flex><span>name=CentOS-$releasever - Extras
</span></span><span style=display:flex><span>baseurl=https://vault.centos.org/7.9.2009/extras/$basearch/
</span></span><span style=display:flex><span>gpgcheck=1
</span></span><span style=display:flex><span>gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7
</span></span><span style=display:flex><span>enabled=1
</span></span></code></pre></div><p>更新 yum 源：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum update
</span></span></code></pre></div><p>安装常用软件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum install wget curl git vim jq ntp -y
</span></span></code></pre></div><p>设置时钟同步：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl start ntpd
</span></span><span style=display:flex><span>systemctl enable ntpd
</span></span><span style=display:flex><span>ntpdate pool.ntp.org
</span></span></code></pre></div><p><strong>[可选] 设置系统 Swap 交换分区</strong></p><p>因为 vps 服务器的运行内存很小，所以这里先设置下 Swap</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 1GB RAM with 2GB Swap</span>
</span></span><span style=display:flex><span>sudo fallocate -l 2G /swapfile <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>sudo dd <span style=color:#66d9ef>if</span><span style=color:#f92672>=</span>/dev/zero of<span style=color:#f92672>=</span>/swapfile bs<span style=color:#f92672>=</span><span style=color:#ae81ff>1024</span> count<span style=color:#f92672>=</span><span style=color:#ae81ff>2097152</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>sudo chmod <span style=color:#ae81ff>600</span> /swapfile <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>sudo mkswap /swapfile <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>sudo swapon /swapfile <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>echo <span style=color:#e6db74>&#34;/swapfile swap swap defaults 0 0&#34;</span> | sudo tee -a /etc/fstab <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>sudo swapon --show <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>sudo free -h
</span></span></code></pre></div><h2 id=安装-nginx>安装 Nginx</h2><p>参考 <a href=https://qizhanming.com/blog/2018/08/06/how-to-install-nginx-on-centos-7 target=_blank>CentOS 7 下 yum 安装和配置 Nginx</a> ，使用 yum 安装：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>rpm -ivh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>yum install nginx -y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>systemctl enable nginx
</span></span></code></pre></div><p>打开防火墙端口</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum install firewalld -y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>firewall-cmd --zone<span style=color:#f92672>=</span>public --permanent --add-service<span style=color:#f92672>=</span>http
</span></span><span style=display:flex><span>firewall-cmd --reload
</span></span></code></pre></div><p>使用反向代理需要打开网络访问权限</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>setsebool -P httpd_can_network_connect on
</span></span></code></pre></div><h2 id=安装并生成证书>安装并生成证书</h2><p>域名托管在 CloudFlare，可以参考 <a href=https://github.com/acmesh-official/acme.sh/wiki/dnsapi#dns_cf target=_blank>文章</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl https://get.acme.sh | sh -s email<span style=color:#f92672>=</span>ichensoul@gmail.com
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>export CF_Key<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;XXXXXXXXXXXXXXXXXX&#34;</span>
</span></span><span style=display:flex><span>export CF_Email<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;ichensoul@gmail.com&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>.acme.sh/acme.sh --issue --server letsencrypt --dns dns_cf -d chensoul.cc -d <span style=color:#e6db74>&#39;*.chensoul.cc&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cp .acme.sh/chensoul.cc_ecc/<span style=color:#f92672>{</span>chensoul.cc.cer,chensoul.cc.key,fullchain.cer,ca.cer<span style=color:#f92672>}</span> /etc/nginx/ssl/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>.acme.sh/acme.sh --installcert -d chensoul.cc -d *.chensoul.cc --cert-file /etc/nginx/ssl/chensoul.cc.cer --key-file /etc/nginx/ssl/chensoul.cc.key --fullchain-file /etc/nginx/ssl/fullchain.cer --ca-file /etc/nginx/ssl/ca.cer --reloadcmd <span style=color:#e6db74>&#34;sudo nginx -s reload&#34;</span>
</span></span></code></pre></div><h2 id=docker-安装和配置>Docker 安装和配置</h2><p>Docker 安装</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://get.docker.com -o get-docker.sh
</span></span><span style=display:flex><span>sh get-docker.sh
</span></span></code></pre></div><p>启动 docker：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl enable docker
</span></span><span style=display:flex><span>systemctl start docker
</span></span></code></pre></div><p>设置 iptables 允许流量转发：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>iptables -P FORWARD ACCEPT
</span></span></code></pre></div><p>安装 Compose</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -L <span style=color:#e6db74>&#34;https://github.com/docker/compose/releases/download/v2.23.3/docker-compose-</span><span style=color:#66d9ef>$(</span>uname -s<span style=color:#66d9ef>)</span><span style=color:#e6db74>-</span><span style=color:#66d9ef>$(</span>uname -m<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span> -o /usr/local/bin/docker-compose
</span></span></code></pre></div><p>设置执行权限：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chmod +x /usr/local/bin/docker-compose
</span></span></code></pre></div><p>参考 <a href=https://nginxproxymanager.com/advanced-config/#best-practice-use-a-docker-network target=_blank>Best Practice: Use a Docker network </a>，创建一个自定义的网络：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker network create custom
</span></span></code></pre></div><p>查看 docker 网络：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker network ls
</span></span><span style=display:flex><span>NETWORK ID     NAME            DRIVER    SCOPE
</span></span><span style=display:flex><span>68f4aeaa57bd   bridge          bridge    local
</span></span><span style=display:flex><span>6a96b9d8617e   custom          bridge    local
</span></span><span style=display:flex><span>4a8679e35f4d   host            host      local
</span></span><span style=display:flex><span>ba21bef23b04   none            null      local
</span></span></code></pre></div><blockquote><p>注意：bridge、host、none 是内部预先创建的网络。</p></blockquote><p>然后，在其他服务的 docker-compose.yml 文件添加：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>custom</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>custom</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>external</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><h2 id=服务部署>服务部署</h2><h3 id=postgres>Postgres</h3><p>1、使用 docker-compose 安装</p><p>postgres.yaml</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>postgres</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>postgres:17</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>postgres</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>POSTGRES_DB</span>: <span style=color:#ae81ff>postgres </span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>POSTGRES_USER</span>: <span style=color:#ae81ff>postgres</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>POSTGRES_PASSWORD</span>: <span style=color:#ae81ff>postgres</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>POSTGRES_HOST_AUTH_METHOD</span>: <span style=color:#ae81ff>trust</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>PGDATA</span>: <span style=color:#ae81ff>/data/postgres</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/data/postgres:/data/postgres</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;5432:5432&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>healthcheck</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>test</span>: [ <span style=color:#e6db74>&#39;CMD-SHELL&#39;</span>, <span style=color:#e6db74>&#39;pg_isready -U ${POSTGRES_USER}&#39;</span> ]
</span></span><span style=display:flex><span>      <span style=color:#f92672>interval</span>: <span style=color:#ae81ff>5s</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>timeout</span>: <span style=color:#ae81ff>5s</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>retries</span>: <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>custom</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>custom</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>external</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><p>2、启动</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker-compose -f postgres.yaml up -d
</span></span></code></pre></div><p>3、进入容器：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>docker exec -it postgres bash
</span></span></code></pre></div><h3 id=rsshub>Rsshub</h3><p>直接通过 Docker 安装运行：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run -d --name rsshub -p 1200:1200 diygod/rsshub
</span></span></code></pre></div><p>配置 nginx ：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#e6db74>[::]:80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>rsshub.chensoul.cc</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>return</span> <span style=color:#ae81ff>301</span> <span style=color:#e6db74>https://</span>$host$request_uri;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span>          <span style=color:#ae81ff>443</span> <span style=color:#e6db74>ssl</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span>     <span style=color:#e6db74>rsshub.chensoul.cc</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate</span>      <span style=color:#e6db74>/etc/nginx/ssl/fullchain.cer</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate_key</span>  <span style=color:#e6db74>/etc/nginx/ssl/chensoul.cc.key</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_session_cache</span>    <span style=color:#e6db74>shared:SSL:1m</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_session_timeout</span>  <span style=color:#ae81ff>5m</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_ciphers</span>  <span style=color:#e6db74>HIGH:!aNULL:!MD5</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_prefer_server_ciphers</span>  <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://127.0.0.1:1200</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=uptime-kuma>Uptime Kuma</h3><p>参考 <a href=https://uptime.kuma.pet/ target=_blank>kuma</a>，使用 docker compose 部署，创建 uptime.yaml：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>uptime-kuma</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>louislam/uptime-kuma:1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>uptime-kuma</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>~/.uptime-kuma:/app/data</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>3001</span>:<span style=color:#ae81ff>3001</span> 
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
</span></span></code></pre></div><p>启动：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker-compose -f uptime.yaml up -d
</span></span></code></pre></div><p>配置 nginx 配置文件 /etc/nginx/conf.d/uptime.conf ：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#e6db74>[::]:80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>uptime.chensoul.cc</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>return</span> <span style=color:#ae81ff>301</span> <span style=color:#e6db74>https://</span>$host$request_uri;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span>          <span style=color:#ae81ff>443</span> <span style=color:#e6db74>ssl</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span>     <span style=color:#e6db74>uptime.chensoul.cc</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate</span>      <span style=color:#e6db74>/etc/nginx/ssl/fullchain.cer</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate_key</span>  <span style=color:#e6db74>/etc/nginx/ssl/chensoul.cc.key</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_session_cache</span>    <span style=color:#e6db74>shared:SSL:1m</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_session_timeout</span>  <span style=color:#ae81ff>5m</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_ciphers</span>  <span style=color:#e6db74>HIGH:!aNULL:!MD5</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_prefer_server_ciphers</span>  <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://127.0.0.1:3001</span>;
</span></span><span style=display:flex><span>	      <span style=color:#f92672>proxy_set_header</span>   <span style=color:#e6db74>X-Real-IP</span> $remote_addr;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span>   <span style=color:#e6db74>X-Forwarded-For</span> $proxy_add_x_forwarded_for;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span>   <span style=color:#e6db74>Host</span> $host;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_http_version</span> <span style=color:#ae81ff>1</span><span style=color:#e6db74>.1</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span>   <span style=color:#e6db74>Upgrade</span> $http_upgrade;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span>   <span style=color:#e6db74>Connection</span> <span style=color:#e6db74>&#34;upgrade&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>升级</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker compose -f uptime.yaml down
</span></span><span style=display:flex><span>docker pull louislam/uptime-kuma:1
</span></span><span style=display:flex><span>docker-compose -f uptime.yaml up -d
</span></span></code></pre></div><h3 id=umami>Umami</h3><p>1、在 postgres 容器创建 umami 数据库和用户：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker exec -it postgres psql -d postgres -U postgres
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>CREATE USER umami WITH PASSWORD <span style=color:#e6db74>&#39;umami@vps!&#39;</span>;
</span></span><span style=display:flex><span>CREATE DATABASE umami owner<span style=color:#f92672>=</span>umami;
</span></span><span style=display:flex><span>ALTER DATABASE umami OWNER TO umami;
</span></span><span style=display:flex><span>GRANT ALL privileges ON DATABASE umami TO umami;
</span></span></code></pre></div><p>2、通过 docker-compose 安装，创建 umami.yaml：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>umami</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ghcr.io/umami-software/umami:postgresql-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>umami</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;3000:3000&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>DATABASE_URL</span>: <span style=color:#ae81ff>postgresql://umami:umami@vps!@postgres:5432/umami</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>DATABASE_TYPE</span>: <span style=color:#ae81ff>postgres</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>HASH_SALT</span>: <span style=color:#ae81ff>vps@2023</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>TRACKER_SCRIPT_NAME</span>: <span style=color:#ae81ff>random-string.js</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>custom</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>custom</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>external</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><p>参考 <a href=https://eallion.com/umami/ target=_blank>https://eallion.com/umami/</a>，Umami 的默认跟踪代码是被大多数的广告插件屏蔽的，被屏蔽了你就统计不到访客信息了。如果需要反屏蔽，需要在 docker-compose.yml 文件中添加环境变量：TRACKER_SCRIPT_NAME，如：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>    environment:
</span></span><span style=display:flex><span>      TRACKER_SCRIPT_NAME: random-string.js
</span></span></code></pre></div><p>然后获取到的跟踪代码的 src 会变成：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>srcipt.js =&gt; random-string.js
</span></span></code></pre></div><p>启动：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker-compose -f umami.yaml up -d
</span></span></code></pre></div><p>3、设置自定义域名</p><p>umami.chensoul.cc</p><p>4、配置 nginx 配置文件 /etc/nginx/conf.d/umami.conf</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#e6db74>[::]:80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>umami.chensoul.cc</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>return</span> <span style=color:#ae81ff>301</span> <span style=color:#e6db74>https://</span>$host$request_uri;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span>          <span style=color:#ae81ff>443</span> <span style=color:#e6db74>ssl</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span>     <span style=color:#e6db74>umami.chensoul.cc</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate</span>      <span style=color:#e6db74>/etc/nginx/ssl/fullchain.cer</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate_key</span>  <span style=color:#e6db74>/etc/nginx/ssl/chensoul.cc.key</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_session_cache</span>    <span style=color:#e6db74>shared:SSL:1m</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_session_timeout</span>  <span style=color:#ae81ff>5m</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_ciphers</span>  <span style=color:#e6db74>HIGH:!aNULL:!MD5</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_prefer_server_ciphers</span>  <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://127.0.0.1:3000</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Host</span> $host;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Real-IP</span> $remote_addr;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Forwarded-For</span> $proxy_add_x_forwarded_for;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Forwarded-Proto</span> $scheme;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>REMOTE-HOST</span> $remote_addr;
</span></span><span style=display:flex><span>        <span style=color:#f92672>add_header</span> <span style=color:#e6db74>X-Cache</span> $upstream_cache_status;
</span></span><span style=display:flex><span>        <span style=color:#75715e># 缓存
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>add_header</span> <span style=color:#e6db74>Cache-Control</span> <span style=color:#e6db74>no-cache</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>expires</span> <span style=color:#e6db74>12h</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>5、添加网站</p><p>访问 <a href=https://umami.chensoul.cc/ target=_blank>https://umami.chensoul.cc/</a>，默认用户名和密码为 admin/umami。登陆之后，修改密码，并添加网站。</p><p>6、升级</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker compose -f umami.yaml down
</span></span><span style=display:flex><span>docker pull ghcr.io/umami-software/umami:postgres-latest
</span></span><span style=display:flex><span>docker-compose -f umami.yaml up -d
</span></span></code></pre></div><h3 id=memos>memos</h3><p>1、在 postgres 容器创建 memos 数据库和用户：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker exec -it postgres psql -d postgres -U postgres
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>CREATE USER memos WITH PASSWORD <span style=color:#e6db74>&#39;memos@vps!&#39;</span>;
</span></span><span style=display:flex><span>CREATE DATABASE memos owner<span style=color:#f92672>=</span>memos;
</span></span><span style=display:flex><span>ALTER DATABASE memos OWNER TO memos;
</span></span><span style=display:flex><span>GRANT ALL privileges ON DATABASE memos TO memos;
</span></span></code></pre></div><p>2、通过 docker-compose 安装，创建 memos.yaml：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>memos</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>neosmemo/memos:0.21.0</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>memos</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>MEMOS_DRIVER=postgres</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>MEMOS_DSN=postgresql://memos:memos@vps!@postgres:5432/memos?sslmode=disable</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>~/.memos/:/var/opt/memos</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>5230</span>:<span style=color:#ae81ff>5230</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>custom</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>custom</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>external</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><p>注意：</p><ul><li>0.21.0 版本之后，去掉了分享功能</li></ul><ol start=3><li>启动</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker-compose -f memos.yaml up -d
</span></span></code></pre></div><ol start=4><li>配置 nginx 配置文件 /etc/nginx/conf.d/memos.conf</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#e6db74>[::]:80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>memos.chensoul.cc</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>return</span> <span style=color:#ae81ff>301</span> <span style=color:#e6db74>https://</span>$host$request_uri;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span>          <span style=color:#ae81ff>443</span> <span style=color:#e6db74>ssl</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span>     <span style=color:#e6db74>memos.chensoul.cc</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate</span>      <span style=color:#e6db74>/etc/nginx/ssl/fullchain.cer</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate_key</span>  <span style=color:#e6db74>/etc/nginx/ssl/chensoul.cc.key</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_session_cache</span>    <span style=color:#e6db74>shared:SSL:1m</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_session_timeout</span>  <span style=color:#ae81ff>5m</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_ciphers</span>  <span style=color:#e6db74>HIGH:!aNULL:!MD5</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_prefer_server_ciphers</span>  <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://127.0.0.1:5230</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=5><li>美化标签</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css><span style=display:flex><span><span style=color:#75715e>/* 设置 Memos 标签样式 */</span>
</span></span><span style=display:flex><span><span style=color:#f92672>span</span>.<span style=color:#a6e22e>inline-block</span>.<span style=color:#a6e22e>w-auto</span>.<span style=color:#a6e22e>text-blue-600</span>.<span style=color:#a6e22e>dark</span><span style=color:#960050;background-color:#1e0010>\</span>:<span style=color:#a6e22e>text-blue-400</span>{
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>color</span>: <span style=color:#ae81ff>#f3f3f3</span>;
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>background-color</span>: <span style=color:#ae81ff>#40b76b</span>;
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>box-shadow</span>: <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>4</span><span style=color:#66d9ef>px</span> <span style=color:#ae81ff>8</span><span style=color:#66d9ef>px</span> rgba(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0.1</span>);
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>border-radius</span>: <span style=color:#ae81ff>2</span><span style=color:#66d9ef>px</span>;
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>padding</span>: <span style=color:#ae81ff>2</span><span style=color:#66d9ef>px</span> <span style=color:#ae81ff>6</span><span style=color:#66d9ef>px</span>;
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>font-size</span>: <span style=color:#ae81ff>15</span><span style=color:#66d9ef>px</span>;
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>margin-bottom</span>: <span style=color:#ae81ff>4</span><span style=color:#66d9ef>px</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/* 设置同级下不同的标签显示不同的颜色 */</span>
</span></span><span style=display:flex><span><span style=color:#75715e>/* 第2个标签 */</span>
</span></span><span style=display:flex><span><span style=color:#f92672>span</span>.<span style=color:#a6e22e>inline-block</span>.<span style=color:#a6e22e>w-auto</span>.<span style=color:#a6e22e>text-blue-600</span>.<span style=color:#a6e22e>dark</span><span style=color:#960050;background-color:#1e0010>\</span>:<span style=color:#a6e22e>text-blue-400</span>:<span style=color:#a6e22e>nth-child</span><span style=color:#f92672>(</span><span style=color:#f92672>n</span><span style=color:#f92672>+</span><span style=color:#f92672>2</span><span style=color:#f92672>)</span> {
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>background-color</span>: <span style=color:#ae81ff>#157cf5</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>/* 第3个标签 */</span>
</span></span><span style=display:flex><span><span style=color:#f92672>span</span>.<span style=color:#a6e22e>inline-block</span>.<span style=color:#a6e22e>w-auto</span>.<span style=color:#a6e22e>text-blue-600</span>.<span style=color:#a6e22e>dark</span><span style=color:#960050;background-color:#1e0010>\</span>:<span style=color:#a6e22e>text-blue-400</span>:<span style=color:#a6e22e>nth-child</span><span style=color:#f92672>(</span><span style=color:#f92672>n</span><span style=color:#f92672>+</span><span style=color:#f92672>4</span><span style=color:#f92672>)</span> {
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>background-color</span>: <span style=color:#ae81ff>#f298a6</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>/* 设置 Memos 文本高亮样式 */</span>
</span></span><span style=display:flex><span><span style=color:#f92672>mark</span> {
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>background-color</span>: <span style=color:#ae81ff>#F27579</span>;
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>color</span>: <span style=color:#ae81ff>#f3f3f3</span>;
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>padding-left</span>:<span style=color:#ae81ff>2</span><span style=color:#66d9ef>px</span>;
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>border-radius</span>: <span style=color:#ae81ff>2</span><span style=color:#66d9ef>px</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=n8n>n8n</h3><p>1、在 postgres 容器创建 n8n 数据库和用户：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker exec -it postgres psql -d postgres -U postgres
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>CREATE USER n8n WITH PASSWORD <span style=color:#e6db74>&#39;n8n@vps!&#39;</span>;
</span></span><span style=display:flex><span>CREATE DATABASE n8n owner<span style=color:#f92672>=</span>n8n;
</span></span><span style=display:flex><span>ALTER DATABASE n8n OWNER TO n8n;
</span></span><span style=display:flex><span>GRANT ALL privileges ON DATABASE n8n TO n8n;
</span></span></code></pre></div><p>2、通过 docker-compose 安装，创建 n8n.yaml：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>n8n</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>n8nio/n8n</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>n8n</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>DB_TYPE=postgresdb</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>DB_POSTGRESDB_HOST=postgres</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>DB_POSTGRESDB_PORT=5432</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>DB_POSTGRESDB_DATABASE=n8n</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>DB_POSTGRESDB_USER=n8n</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>DB_POSTGRESDB_PASSWORD=n8n@vps!</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>TZ=&#34;Asia/Shanghai&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>GENERIC_TIMEZONE=&#34;Asia/Shanghai&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>WEBHOOK_URL=https://n8n.chensoul.cc/</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS=true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>5678</span>:<span style=color:#ae81ff>5678</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>custom</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>custom</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>external</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><p>3、启动</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker-compose -f n8n.yaml up -d
</span></span></code></pre></div><p>4、配置 nginx 配置文件 /etc/nginx/conf.d/n8n.conf</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#e6db74>[::]:80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>n8n.chensoul.cc</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>return</span> <span style=color:#ae81ff>301</span> <span style=color:#e6db74>https://</span>$host$request_uri;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span>          <span style=color:#ae81ff>443</span> <span style=color:#e6db74>ssl</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span>     <span style=color:#e6db74>n8n.chensoul.cc</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate</span>      <span style=color:#e6db74>/etc/nginx/ssl/fullchain.cer</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate_key</span>  <span style=color:#e6db74>/etc/nginx/ssl/chensoul.cc.key</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_session_cache</span>    <span style=color:#e6db74>shared:SSL:1m</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_session_timeout</span>  <span style=color:#ae81ff>5m</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_ciphers</span>  <span style=color:#e6db74>HIGH:!aNULL:!MD5</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_prefer_server_ciphers</span>  <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>      <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://127.0.0.1:5678</span>;
</span></span><span style=display:flex><span>      <span style=color:#f92672>chunked_transfer_encoding</span> <span style=color:#66d9ef>off</span>;
</span></span><span style=display:flex><span>      <span style=color:#f92672>proxy_buffering</span> <span style=color:#66d9ef>off</span>;
</span></span><span style=display:flex><span>      <span style=color:#f92672>proxy_cache</span> <span style=color:#66d9ef>off</span>;
</span></span><span style=display:flex><span>      <span style=color:#f92672>access_log</span> <span style=color:#e6db74>/var/log/nginx/n8n.log</span> <span style=color:#e6db74>combined</span> <span style=color:#e6db74>buffer=128k</span> <span style=color:#e6db74>flush=5s</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>proxy_http_version</span> <span style=color:#ae81ff>1</span><span style=color:#e6db74>.1</span>;
</span></span><span style=display:flex><span>      <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Upgrade</span> $http_upgrade;
</span></span><span style=display:flex><span>      <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Connection</span> <span style=color:#e6db74>&#34;Upgrade&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>这里面的转发配置不对的话，会导致直接访问 5678 端口正常，但是访问 nginx 的话，workflow 会一直处于执行。</p><p>5、添加 workflow</p><p>参考这篇文章 <a href=http://stiles.cc/archives/237/ target=_blank>http://stiles.cc/archives/237/</a> ，目前我配置了以下 workflows，实现了 github、douban、rss、memos 同步到 Telegram。</p><p>workflows 参考：</p><ul><li><a href=https://reorx.com/blog/sharing-my-footprints-automation/ target=_blank>Reorx</a></li><li><a href=https://www.pseudoyu.com/zh/2022/09/19/weekly_review_20220919/ target=_blank>Pseudoyu</a></li><li><a href=https://raye.xlog.app/gou-jian-ge-xing-hua-de-shu-zi-ri-ji--zi-dong-hua-gong-zuo-liu-shi-xian-xin-xi-ju-he target=_blank>raye</a></li><li><a href=https://zeabur.com/docs/marketplace/n8n target=_blank>Zeabur</a></li></ul><p>6、升级</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker compose -f n8n.yaml down
</span></span><span style=display:flex><span>docker pull n8nio/n8n
</span></span><span style=display:flex><span>docker-compose -f n8n.yaml up -d
</span></span></code></pre></div><p>7、备份</p><p>安装 jq</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum install epel-release -y
</span></span><span style=display:flex><span>yum install jq -y
</span></span></code></pre></div><p>/opt/scripts/backup_n8n.sh</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>DATE<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date +%Y%m%d<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>BACKUP_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/data/backup/n8n&#34;</span>
</span></span><span style=display:flex><span>mkdir -p $BACKUP_DIR/$DATE
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cd $BACKUP_DIR
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker exec -u node -it n8n n8n export:workflow --backup --output<span style=color:#f92672>=</span>./$DATE
</span></span><span style=display:flex><span>docker cp n8n:/home/node/$DATE <span style=color:#e6db74>${</span>BACKUP_DIR<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cd <span style=color:#e6db74>${</span>BACKUP_DIR<span style=color:#e6db74>}</span>/$DATE
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> file in <span style=color:#e6db74>`</span>ls<span style=color:#e6db74>`</span>; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    filename<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>cat <span style=color:#e6db74>&#34;</span>$file<span style=color:#e6db74>&#34;</span> | jq -r <span style=color:#e6db74>&#39;.name&#39;</span><span style=color:#66d9ef>)</span>  
</span></span><span style=display:flex><span>    mv <span style=color:#e6db74>&#34;</span>$file<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;</span>$filename<span style=color:#e6db74>&#34;</span>.json
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker exec -u node -it n8n n8n export:credentials --all --output<span style=color:#f92672>=</span>./credentials.json
</span></span><span style=display:flex><span>docker cp n8n:/home/node/credentials.json <span style=color:#e6db74>${</span>BACKUP_DIR<span style=color:#e6db74>}</span>
</span></span></code></pre></div><h3 id=bark>Bark</h3><p>Bark is an iOS App which allows you to push custom notifications to your iPhone.</p><p><a href=https://github.com/Finb/Bark target=_blank>https://github.com/Finb/Bark</a></p><p>需要的时候就可以调用 bark api 给 iPhone 推送消息。</p><ol><li><p>在ios 上安装 bark</p></li><li><p>服务端使用 docker 安装</p></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run -dt --name bark -p 8090:8080 -v /data/bark:/data finab/bark-server
</span></span></code></pre></div><ol start=3><li>在 ios bark app上添加私有服务器 <a href=http://x.x.x.x:8090 target=_blank>http://x.x.x.x:8090</a></li><li>测试</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -X <span style=color:#e6db74>&#34;POST&#34;</span> <span style=color:#e6db74>&#34;http://x.x.x.x:8090/erWZgGQoV9CqGGwHD8AkBT&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>     -H <span style=color:#e6db74>&#39;Content-Type: application/json; charset=utf-8&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>     -d <span style=color:#e6db74>$&#39;{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;body&#34;: &#34;这是一个测试&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;title&#34;: &#34;Test Title&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;badge&#34;: 1,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;category&#34;: &#34;myNotificationCategory&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;icon&#34;: &#34;https://www.usememos.com/logo-rounded.png&#34;,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;group&#34;: &#34;test&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}&#39;</span>
</span></span></code></pre></div><ol start=3><li><p>在 ios bark app 上添加私有服务器：http://x.x.x.x:8090</p></li><li><p>配置 nginx 配置文件 /etc/nginx/conf.d/bark.conf</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#e6db74>[::]:80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>bark.chensoul.cc</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>return</span> <span style=color:#ae81ff>301</span> <span style=color:#e6db74>https://</span>$host$request_uri;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span>          <span style=color:#ae81ff>443</span> <span style=color:#e6db74>ssl</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span>     <span style=color:#e6db74>bark.chensoul.cc</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate</span>      <span style=color:#e6db74>/etc/nginx/ssl/fullchain.cer</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate_key</span>  <span style=color:#e6db74>/etc/nginx/ssl/chensoul.cc.key</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_session_cache</span>    <span style=color:#e6db74>shared:SSL:1m</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_session_timeout</span>  <span style=color:#ae81ff>5m</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_ciphers</span>  <span style=color:#e6db74>HIGH:!aNULL:!MD5</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_prefer_server_ciphers</span>  <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>      <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://127.0.0.1:8090</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li></ol><h3 id=planka>Planka</h3><p>The realtime kanban board for workgroups built with React and Redux.</p><p><a href=https://github.com/plankanban/planka target=_blank>https://github.com/plankanban/planka</a></p><p>替换 Trello 的看板工具。</p><p>安装步骤，参考 <a href=https://docs.planka.cloud/docs/installation/docker/production_version target=_blank>官方文档</a>。</p><ol><li>为了使用提前安装好的 postgres 数据库，修改 docker-compose 文件：<ul><li>修改端口为 1337</li><li>修改 DATABASE_URL</li><li>修改 volumes</li><li>设置默认登录用户</li></ul></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>planka</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ghcr.io/plankanban/planka:latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>planka</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#66d9ef>on</span>-<span style=color:#ae81ff>failure</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/data/planka/user-avatars:/app/public/user-avatars</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/data/planka/project-background-images:/app/public/project-background-images</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/data/planka/attachments:/app/private/attachments</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>1337</span>:<span style=color:#ae81ff>1337</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>BASE_URL=http://localhost:1337/</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>DATABASE_URL=postgresql://planka:planka@vps!@postgres/planka</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>SECRET_KEY=notsecretkey</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - TRUST_PROXY=0</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - TOKEN_EXPIRES_IN=365 # In days</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># related: https://github.com/knex/knex/issues/2354</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># As knex does not pass query parameters from the connection string we</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># have to use environment variables in order to pass the desired values, e.g.</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - PGSSLMODE=&lt;value&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Configure knex to accept SSL certificates</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - KNEX_REJECT_UNAUTHORIZED_SSL_CERTIFICATE=false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - DEFAULT_ADMIN_EMAIL=demo@demo.demo # Do not remove if you want to prevent this user from being edited/deleted</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>DEFAULT_ADMIN_PASSWORD=demo</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>DEFAULT_ADMIN_NAME=Demo Demo</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>DEFAULT_ADMIN_USERNAME=demo</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - SHOW_DETAILED_AUTH_ERRORS=false # Set to true to show more detailed authentication error messages. It should not be enabled without a rate limiter for security reasons.</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - ALLOW_ALL_TO_CREATE_PROJECTS=true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - S3_ENDPOINT=</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - S3_REGION=</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - S3_ACCESS_KEY_ID=</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - S3_SECRET_ACCESS_KEY=</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - S3_BUCKET=</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - S3_FORCE_PATH_STYLE=true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - OIDC_ISSUER=</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - OIDC_CLIENT_ID=</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - OIDC_CLIENT_SECRET=</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - OIDC_ID_TOKEN_SIGNED_RESPONSE_ALG=</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - OIDC_USERINFO_SIGNED_RESPONSE_ALG=</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - OIDC_SCOPES=openid email profile</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - OIDC_RESPONSE_MODE=fragment</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - OIDC_USE_DEFAULT_RESPONSE_MODE=true</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - OIDC_ADMIN_ROLES=admin</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - OIDC_CLAIMS_SOURCE=userinfo</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - OIDC_EMAIL_ATTRIBUTE=email</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - OIDC_NAME_ATTRIBUTE=name</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - OIDC_USERNAME_ATTRIBUTE=preferred_username</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - OIDC_ROLES_ATTRIBUTE=groups</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - OIDC_IGNORE_USERNAME=true</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - OIDC_IGNORE_ROLES=true</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - OIDC_ENFORCED=true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Email Notifications (https://nodemailer.com/smtp/)</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - SMTP_HOST=</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - SMTP_PORT=587</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - SMTP_NAME=</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - SMTP_SECURE=true</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - SMTP_USER=</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - SMTP_PASSWORD=</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - SMTP_FROM=&#34;Demo Demo&#34; &lt;demo@demo.demo&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - SMTP_TLS_REJECT_UNAUTHORIZED=false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># Optional fields: accessToken, events, excludedEvents</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - |</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#   WEBHOOKS=[{</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#     &#34;url&#34;: &#34;http://localhost:3001&#34;,</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#     &#34;accessToken&#34;: &#34;notaccesstoken&#34;,</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#     &#34;events&#34;: [&#34;cardCreate&#34;, &#34;cardUpdate&#34;, &#34;cardDelete&#34;],</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#     &#34;excludedEvents&#34;: [&#34;notificationCreate&#34;, &#34;notificationUpdate&#34;]</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>#   }]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - SLACK_BOT_TOKEN=</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - SLACK_CHANNEL_ID=</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - GOOGLE_CHAT_WEBHOOK_URL=</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - TELEGRAM_BOT_TOKEN=</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - TELEGRAM_CHAT_ID=</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - TELEGRAM_THREAD_ID=</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>custom</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>custom</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>external</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><ol start=2><li>在 postgres 容器创建 planka 数据库和用户：</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker exec -it postgres psql -d postgres -U postgres
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>CREATE USER planka WITH PASSWORD <span style=color:#e6db74>&#39;planka@vps!&#39;</span>;
</span></span><span style=display:flex><span>CREATE DATABASE planka owner<span style=color:#f92672>=</span>planka;
</span></span><span style=display:flex><span>ALTER DATABASE planka OWNER TO planka;
</span></span><span style=display:flex><span>GRANT ALL privileges ON DATABASE planka TO planka;
</span></span></code></pre></div><p>3、启动</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker-compose -f planka.yaml up -d
</span></span></code></pre></div><p>4、配置 nginx 配置文件 /etc/nginx/conf.d/planka.conf</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#e6db74>[::]:80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>planka.chensoul.cc</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>return</span> <span style=color:#ae81ff>301</span> <span style=color:#e6db74>https://</span>$host$request_uri;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span>          <span style=color:#ae81ff>443</span> <span style=color:#e6db74>ssl</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span>     <span style=color:#e6db74>planka.chensoul.cc</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate</span>      <span style=color:#e6db74>/etc/nginx/ssl/fullchain.cer</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate_key</span>  <span style=color:#e6db74>/etc/nginx/ssl/chensoul.cc.key</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_session_cache</span>    <span style=color:#e6db74>shared:SSL:1m</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_session_timeout</span>  <span style=color:#ae81ff>5m</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_ciphers</span>  <span style=color:#e6db74>HIGH:!aNULL:!MD5</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_prefer_server_ciphers</span>  <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>      <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://127.0.0.1:1337</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=hoarder>Hoarder</h3><p>A self-hostable bookmark-everything app with a touch of AI for the data hoarders out there.</p><p>一款可自托管的书签应用程序，带有 AI智能功能。</p><p><a href=https://github.com/hoarder-app/hoarder target=_blank>https://github.com/hoarder-app/hoarder</a></p><ol><li>通过 docker-compose 安装，创建 hoarder.yaml：</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#34;3.8&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>web</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ghcr.io/hoarder-app/hoarder:${HOARDER_VERSION:-release}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>hoarder</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/data/hoarder:/data</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>3002</span>:<span style=color:#ae81ff>3000</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>NEXTAUTH_SECRET</span>: <span style=color:#ae81ff>super_random_string</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>MEILI_MASTER_KEY</span>: <span style=color:#ae81ff>another_random_string</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>NEXTAUTH_URL</span>: <span style=color:#ae81ff>https://hoarder.chensoul.cc</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>MEILI_ADDR</span>: <span style=color:#ae81ff>http://meilisearch:7700</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>BROWSER_WEB_URL</span>: <span style=color:#ae81ff>http://chrome:9222</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># OPENAI_API_KEY: ...</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>DATA_DIR</span>: <span style=color:#ae81ff>/data</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>chrome</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>gcr.io/zenika-hub/alpine-chrome:123</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>command</span>:
</span></span><span style=display:flex><span>      - --<span style=color:#66d9ef>no</span>-<span style=color:#ae81ff>sandbox</span>
</span></span><span style=display:flex><span>      - --<span style=color:#ae81ff>disable-gpu</span>
</span></span><span style=display:flex><span>      - --<span style=color:#ae81ff>disable-dev-shm-usage</span>
</span></span><span style=display:flex><span>      - --<span style=color:#ae81ff>remote-debugging-address=0.0.0.0</span>
</span></span><span style=display:flex><span>      - --<span style=color:#ae81ff>remote-debugging-port=9222</span>
</span></span><span style=display:flex><span>      - --<span style=color:#ae81ff>hide-scrollbars</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>meilisearch</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>getmeili/meilisearch:v1.11.1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>MEILI_NO_ANALYTICS</span>: <span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>meilisearch:/meili_data</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>meilisearch</span>:
</span></span></code></pre></div><ol start=2><li>启动</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker-compose -f hoarder.yaml up -d
</span></span></code></pre></div><ol start=3><li>配置 nginx 配置文件 /etc/nginx/conf.d/hoarder.conf</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#e6db74>[::]:80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>hoarder.chensoul.cc</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>return</span> <span style=color:#ae81ff>301</span> <span style=color:#e6db74>https://</span>$host$request_uri;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span>          <span style=color:#ae81ff>443</span> <span style=color:#e6db74>ssl</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span>     <span style=color:#e6db74>hoarder.chensoul.cc</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate</span>      <span style=color:#e6db74>/etc/nginx/ssl/fullchain.cer</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate_key</span>  <span style=color:#e6db74>/etc/nginx/ssl/chensoul.cc.key</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_session_cache</span>    <span style=color:#e6db74>shared:SSL:1m</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_session_timeout</span>  <span style=color:#ae81ff>5m</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_ciphers</span>  <span style=color:#e6db74>HIGH:!aNULL:!MD5</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_prefer_server_ciphers</span>  <span style=color:#66d9ef>on</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>      <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://127.0.0.1:3002</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=4><li>使用 api 接口导入 url</li></ol><p>先创建 api-key。</p><p>查询 memos 数据库（我使用的是 postgres ）中包含 url 链接的记录：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> (regexp_matches(content, <span style=color:#e6db74>&#39;https?://\S+&#39;</span>, <span style=color:#e6db74>&#39;g&#39;</span>))[<span style=color:#ae81ff>1</span>] <span style=color:#66d9ef>AS</span> url <span style=color:#66d9ef>FROM</span> memo <span style=color:#66d9ef>where</span> content <span style=color:#66d9ef>like</span> <span style=color:#e6db74>&#39;%https:%&#39;</span>
</span></span></code></pre></div><p>将查询结果保存为 all_links.txt</p><p>然后运行导入命令：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#66d9ef>while</span> IFS<span style=color:#f92672>=</span> read -r url; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    docker run --rm ghcr.io/hoarder-app/hoarder-cli:release --api-key <span style=color:#e6db74>&#34;ak1_066c79d8a9d634d4b826_d99f3a2732cab381f7c9&#34;</span> --server-addr <span style=color:#e6db74>&#34;https://hoarder.chensoul.cc/&#34;</span> bookmarks add --link <span style=color:#e6db74>&#34;</span>$url<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span> &lt; all_links.txt
</span></span></code></pre></div><h2 id=服务升级>服务升级</h2><p>/opt/scripts/upgrade.sh</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>docker pull ghcr.io/umami-software/umami:postgres-latest
</span></span><span style=display:flex><span>docker pull neosmemo/memos:latest
</span></span><span style=display:flex><span>docker pull postgres:17
</span></span><span style=display:flex><span>docker pull n8nio/n8n
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker-compose -f memos.yaml down
</span></span><span style=display:flex><span>docker-compose -f memos.yaml up -d
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker-compose -f umami.yaml down
</span></span><span style=display:flex><span>docker-compose -f umami.yaml up -d
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker-compose -f n8n.yaml down
</span></span><span style=display:flex><span>docker-compose -f n8n.yaml up -d
</span></span></code></pre></div><h2 id=数据库备份和恢复>数据库备份和恢复</h2><p>/opt/scripts/backup_db.sh</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>CONTAINER_NAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;postgres&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>BACKUP_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/data/backup/database&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>BACKUP_PREFIX<span style=color:#f92672>=</span>postgres
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>BACKUP_POSTFIX<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>date +%Y%m%d<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>DATABASES<span style=color:#f92672>=(</span><span style=color:#e6db74>&#34;memos&#34;</span> <span style=color:#e6db74>&#34;n8n&#34;</span> <span style=color:#e6db74>&#34;umami&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mkdir -p $BACKUP_DIR
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> DB_NAME in <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>DATABASES[@]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>  BACKUP_FILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>BACKUP_PREFIX<span style=color:#e6db74>}</span><span style=color:#e6db74>_</span><span style=color:#e6db74>${</span>DB_NAME<span style=color:#e6db74>}</span><span style=color:#e6db74>_</span><span style=color:#e6db74>${</span>BACKUP_POSTFIX<span style=color:#e6db74>}</span><span style=color:#e6db74>.sql&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  echo <span style=color:#e6db74>&#34;docker exec </span>$CONTAINER_NAME<span style=color:#e6db74> pg_dump -U </span>$DB_NAME<span style=color:#e6db74> -W -F p </span>$DB_NAME<span style=color:#e6db74> &gt; </span>$BACKUP_DIR<span style=color:#e6db74>/</span>$BACKUP_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  docker exec $CONTAINER_NAME pg_dump -U $DB_NAME -W -F p $DB_NAME &gt; $BACKUP_DIR/$BACKUP_FILE
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> $? -eq <span style=color:#ae81ff>0</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;DB </span>$DB_NAME<span style=color:#e6db74> backup success: </span>$BACKUP_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;DB </span>$DB_NAME<span style=color:#e6db74> backup fail&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 删除超过7天的备份文件</span>
</span></span><span style=display:flex><span>find $BACKUP_DIR -name <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>BACKUP_PREFIX<span style=color:#e6db74>}</span><span style=color:#e6db74>_*.sql&#34;</span> -type f -mtime +7 -exec rm -f <span style=color:#f92672>{}</span> <span style=color:#ae81ff>\;</span>
</span></span></code></pre></div><p>恢复：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker cp /data/backup/database postgres:/
</span></span><span style=display:flex><span>docker exec -it postgres bash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>psql -d memos -U memos
</span></span><span style=display:flex><span><span style=color:#ae81ff>\i</span> /database/postgres_memos_20241230.sql
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>psql -d umami -U umami
</span></span><span style=display:flex><span><span style=color:#ae81ff>\i</span> /database/postgres_umami_20241230.sql
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>psql -d n8n -U n8n
</span></span><span style=display:flex><span><span style=color:#ae81ff>\i</span> /database/postgres_n8n_20241230.sql
</span></span></code></pre></div><h2 id=定时任务>定时任务</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ae81ff>8</span> <span style=color:#ae81ff>9</span> * * * <span style=color:#e6db74>&#34;/root/.acme.sh&#34;</span>/acme.sh --cron --home <span style=color:#e6db74>&#34;/root/.acme.sh&#34;</span> &gt; /dev/null
</span></span><span style=display:flex><span>*/20 * * * * /usr/sbin/ntpdate pool.ntp.org &gt; /dev/null 2&gt;&amp;<span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#ae81ff>1</span> * * * sh /opt/scripts/backup_db.sh
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> <span style=color:#ae81ff>1</span> * * * sh /opt/scripts/backup_n8n.sh
</span></span></code></pre></div><h2 id=参考文章>参考文章</h2><ul><li><a href=https://www.jinhuaiyao.com/posts/what-is-running-on-my-vps/ target=_blank>我的 VPS 上运行了什么</a></li></ul></div><div><div style=font-weight:700>Share this post:</div><a class=social-link-item href="https://twitter.com/intent/tweet?text=%e6%88%91%e7%9a%84VPS%e6%9c%8d%e5%8a%a1%e9%83%a8%e7%bd%b2%e8%ae%b0%e5%bd%95 https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f01%2f25%2fnotes-about-deploy-services-in-vps%2f" target=_blank rel="noopener noreferrer" title="Click to share on Twitter"><i class="fa-brands fa-square-twitter fa-2xl" style=color:#55acee></i>
</a><a class=social-link-item href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f01%2f25%2fnotes-about-deploy-services-in-vps%2f&title=%e6%88%91%e7%9a%84VPS%e6%9c%8d%e5%8a%a1%e9%83%a8%e7%bd%b2%e8%ae%b0%e5%bd%95" target=_blank rel="noopener noreferrer" title="Click to share on LinkedIn"><i class="fa-brands fa-linkedin fa-2xl" style=color:#007bb5></i>
</a><a class=social-link-item href="https://telegram.me/share/url?text=%e6%88%91%e7%9a%84VPS%e6%9c%8d%e5%8a%a1%e9%83%a8%e7%bd%b2%e8%ae%b0%e5%bd%95&amp;url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f01%2f25%2fnotes-about-deploy-services-in-vps%2f" target=_blank rel="noopener noreferrer" title="Click to share on telegram"><i class="fa-brands fa-telegram fa-2xl" style=color:#007bb5></i>
</a><a class=social-link-item href="https://reddit.com/submit?url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f01%2f25%2fnotes-about-deploy-services-in-vps%2f&title=%e6%88%91%e7%9a%84VPS%e6%9c%8d%e5%8a%a1%e9%83%a8%e7%bd%b2%e8%ae%b0%e5%bd%95" target=_blank rel="noopener noreferrer" title="Click to share on reddit"><i class="fa-brands fa-reddit fa-2xl" style=color:#007bb5></i>
</a><a class=social-link-item href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f01%2f25%2fnotes-about-deploy-services-in-vps%2f" target=_blank rel="noopener noreferrer" title="Click to share on facebook"><i class="fa-brands fa-facebook fa-2xl" style=color:#007bb5></i>
</a><a class=social-link-item href="https://api.whatsapp.com/send?text=%e6%88%91%e7%9a%84VPS%e6%9c%8d%e5%8a%a1%e9%83%a8%e7%bd%b2%e8%ae%b0%e5%bd%95%20-%20https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f01%2f25%2fnotes-about-deploy-services-in-vps%2f" target=_blank rel="noopener noreferrer" title="Click to share on whatsapp"><i class="fa-brands fa-whatsapp fa-2xl" style=color:#007bb5></i></a></div></div></article><nav class="navigation post-navigation" role=navigation><h2 class=screen-reader-text>Post navigation</h2><div class=nav-links><div class=nav-previous><a href=/posts/2023/01/25/weekly_review_3/ rel=next><span class=post-title>周报-3｜博客定制、VPS部署服务</span></a></div><div class=nav-next><a href=/posts/2023/01/15/weekly_review_2/ rel=prev><span class=post-title>周报-2｜博客重构</span></a></div></div></nav><h2>Related content</h2><ul><li><a href=/posts/2023/10/12/git-interview-questions/>[译]DevOps 和测试人员的 Git 面试问题</a></li><li><a href=/posts/2023/10/12/http-in-depth/>[译]关于 HTTP 您需要了解的一切</a></li><li><a href=/posts/2023/05/11/git-flow-model-and-usage/>Git Flow分支模型和使用</a></li><li><a href=/posts/2024/10/17/kafka-fundamental/>Kafka 基础知识</a></li><li><a href=/posts/2024/07/19/gitlab-runner-install/>GitLab Runner安装和部署</a></li><li><a href=/posts/2024/07/15/install-gitlab-using-yum/>Gitlab安装和部署-使用yum源</a></li><li><a href=/posts/2024/07/15/git/>Git介绍</a></li><li><a href=/posts/2024/07/15/git/>Git使用</a></li><li><a href=/posts/2024/07/09/install-docker/>Docker安装和配置</a></li><li><a href=/posts/2024/07/09/docker-for-spring-boot/>使用 Docker 容器化并运行 Spring Boot 应用程序</a></li></ul></main></section></div><div id=footer class=footer-wrap><footer id=colophon class="site-footer container clearfix" role=contentinfo><div id=footer-text class=site-info><span class=credit-link>Made with 🩷
by <a href=/ target=_blank rel="noopener noreferrer">ChenSoul</a></span></div></footer></div></div><script type=text/javascript src=/main.min.js></script></body></html>