<!doctype html><html lang=zh itemscope itemtype=http://schema.org/WebPage><head><meta name=generator content="Hugo 0.110.0"><meta charset=utf-8><title>我的VPS服务部署记录 · ChenSoul</title><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=description content="Docker 安装和配置 Docker 安装 具体过程可以参考网上文章。 自定义网络 参考 Best Practice: Use a Docker network ，创建一个自定义的网络： docker network create custom 查看 docker 网络： [root@vps ~]# docker network ls NETWORK ID NAME DRIVER SCOPE 68f4aeaa57bd bridge bridge"><meta name=keywords content="devops,programming"><meta name=google-site-verification content="D8XBzUhT4irNUQLKut79HFni0v3Xow4FY-oxUcsUlVk"><link rel=canonical href=https://blog.chensoul.com/posts/2023/01/25/notes-about-deploy-services-in-vps/><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css integrity=sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO crossorigin=anonymous><link rel=stylesheet href=https://blog.chensoul.com/css/den.css><link rel=stylesheet href=https://blog.chensoul.com/css/custom.min.css><link rel=preload as=font type=font/woff2 href=/css/font/open-sans.css><link rel=stylesheet type=text/css href=/css/font/open-sans.css media=print onload='this.media="all"'><meta property="og:title" content="我的VPS服务部署记录"><meta property="og:description" content="Docker 安装和配置 Docker 安装 具体过程可以参考网上文章。 自定义网络 参考 Best Practice: Use a Docker network ，创建一个自定义的网络： docker network create custom 查看 docker 网络： [root@vps ~]# docker network ls NETWORK ID NAME DRIVER SCOPE 68f4aeaa57bd bridge bridge"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.chensoul.com/posts/2023/01/25/notes-about-deploy-services-in-vps/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-01-25T10:38:34+08:00"><meta property="article:modified_time" content="2023-01-25T10:38:34+08:00"><meta itemprop=name content="我的VPS服务部署记录"><meta itemprop=description content="Docker 安装和配置 Docker 安装 具体过程可以参考网上文章。 自定义网络 参考 Best Practice: Use a Docker network ，创建一个自定义的网络： docker network create custom 查看 docker 网络： [root@vps ~]# docker network ls NETWORK ID NAME DRIVER SCOPE 68f4aeaa57bd bridge bridge"><meta itemprop=datePublished content="2023-01-25T10:38:34+08:00"><meta itemprop=dateModified content="2023-01-25T10:38:34+08:00"><meta itemprop=wordCount content="1433"><meta itemprop=keywords content="hugo,docker,rsshub,kuma,umami,cusdis,memos,n8n,"><meta name=twitter:card content="summary"><meta name=twitter:title content="我的VPS服务部署记录"><meta name=twitter:description content="Docker 安装和配置 Docker 安装 具体过程可以参考网上文章。 自定义网络 参考 Best Practice: Use a Docker network ，创建一个自定义的网络： docker network create custom 查看 docker 网络： [root@vps ~]# docker network ls NETWORK ID NAME DRIVER SCOPE 68f4aeaa57bd bridge bridge"></head><body><div class=header-container style=background:linear-gradient(rgba(0,0,0,.2),rgba(0,0,0,.2)),url(https://blog.chensoul.com/images/background.webp);background-position:50%;background-size:cover><div class=container><nav class="header-nav navbar navbar-expand-md navbar-dark light-dark"><div class="header-logo navbar-brand"><a class=float-left href=https://blog.chensoul.com/><img class="mr20 header-logo-image" src=https://blog.chensoul.com/images/fly.png alt=logo>
ChenSoul</a></div><button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarNav aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="nav-menu collapse navbar-collapse" id=navbarNav><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://blog.chensoul.com/categories/ideas/>思考</a></li><li class=nav-item><a class=nav-link href=https://blog.chensoul.com/memos/>嘀咕</a></li><li class=nav-item><a class=nav-link href=https://blog.chensoul.com/links/>友链</a></li><li class=nav-item><a class=nav-link href=https://blog.chensoul.com/about/>关于</a></li><li class=nav-item><a class=nav-link href=https://blog.chensoul.com/search/>搜索</a></li></ul></div></nav></div><div class="container header-wrapper"><div class=row><div class=col-lg-12><div class=header-content><h1 class=header-title>我的VPS服务部署记录</h1><p class=header-date>作者:
chensoul
| <span>1433 字, 3 分钟</span>
| 2023-01-25
| 分类:
<a href=https://blog.chensoul.com/categories/notes/>Notes</a></p><div class=header-underline></div><div class=clearfix></div><p class="float-right header-tags"><i class="fas fa-tags" aria-hidden=true></i>
<a href=https://blog.chensoul.com/tags/cusdis/>cusdis</a>,
<a href=https://blog.chensoul.com/tags/docker/>docker</a>,
<a href=https://blog.chensoul.com/tags/hugo/>hugo</a>,
<a href=https://blog.chensoul.com/tags/kuma/>kuma</a>,
<a href=https://blog.chensoul.com/tags/memos/>memos</a>,
<a href=https://blog.chensoul.com/tags/n8n/>n8n</a>,
<a href=https://blog.chensoul.com/tags/rsshub/>rsshub</a>,
<a href=https://blog.chensoul.com/tags/umami/>umami</a></p></div></div></div></div></div><main><div class="container content"><article><h2 id=docker-安装和配置>Docker 安装和配置</h2><h3 id=docker-安装>Docker 安装</h3><p>具体过程可以参考网上文章。</p><h3 id=自定义网络>自定义网络</h3><p>参考 <a href=https://nginxproxymanager.com/advanced-config/#best-practice-use-a-docker-network>Best Practice: Use a Docker network</a>
，创建一个自定义的网络：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker network create custom
</span></span></code></pre></div><p>查看 docker 网络：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@vps ~<span class=o>]</span><span class=c1># docker network ls</span>
</span></span><span class=line><span class=cl>NETWORK ID     NAME            DRIVER    SCOPE
</span></span><span class=line><span class=cl>68f4aeaa57bd   bridge          bridge    <span class=nb>local</span>
</span></span><span class=line><span class=cl>6a96b9d8617e   custom          bridge    <span class=nb>local</span>
</span></span><span class=line><span class=cl>4a8679e35f4d   host            host      <span class=nb>local</span>
</span></span><span class=line><span class=cl>ba21bef23b04   none            null      <span class=nb>local</span>
</span></span></code></pre></div><blockquote><p>注意：bridge、host、none 是内部预先创建的网络。</p></blockquote><p>然后，在其他服务的 docker-compose.yml 文件添加：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>external</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>custom</span><span class=w>
</span></span></span></code></pre></div><p>例如：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pgsql</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>postgres:13</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>5433</span><span class=p>:</span><span class=m>5432</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>POSTGRES_USER=chenzj</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>POSTGRES_PASSWORD=chenzj@vps2021</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/data/postgres:/var/lib/postgresql/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>external</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>custom</span><span class=w>
</span></span></span></code></pre></div><h2 id=服务部署>服务部署</h2><h3 id=rsshub>Rsshub</h3><p>直接通过 Docker 安装运行：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -d --name rsshub -p 1200:1200 diygod/rsshub
</span></span></code></pre></div><p>配置 nginx ：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=s>[::]:80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span> <span class=s>rsshub.chensoul.com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>return</span> <span class=mi>301</span> <span class=s>https://</span><span class=nv>$host$request_uri</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span>          <span class=mi>443</span> <span class=s>ssl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span>     <span class=s>rsshub.chensoul.com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_certificate</span>      <span class=s>/usr/local/nginx/ssl/fullchain.cer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_certificate_key</span>  <span class=s>/usr/local/nginx/ssl/chensoul.com.key</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_session_cache</span>    <span class=s>shared:SSL:1m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_session_timeout</span>  <span class=mi>5m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_ciphers</span>  <span class=s>HIGH:!aNULL:!MD5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_prefer_server_ciphers</span>  <span class=no>on</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>location</span> <span class=s>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_pass</span> <span class=s>http://127.0.0.1:1200</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=kuma>Kuma</h3><p>参考 <a href=https://uptime.kuma.pet/>kuma</a>，使用 Docker 部署：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -d --restart<span class=o>=</span>always -p 3001:3001 -v uptime-kuma:/app/data --name uptime-kuma louislam/uptime-kuma:1
</span></span></code></pre></div><p>配置 nginx ：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=s>[::]:80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span> <span class=s>uptime.chensoul.com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>return</span> <span class=mi>301</span> <span class=s>https://</span><span class=nv>$host$request_uri</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span>          <span class=mi>443</span> <span class=s>ssl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span>     <span class=s>uptime.chensoul.com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_certificate</span>      <span class=s>/usr/local/nginx/ssl/fullchain.cer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_certificate_key</span>  <span class=s>/usr/local/nginx/ssl/chensoul.com.key</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_session_cache</span>    <span class=s>shared:SSL:1m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_session_timeout</span>  <span class=mi>5m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_ciphers</span>  <span class=s>HIGH:!aNULL:!MD5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_prefer_server_ciphers</span>  <span class=no>on</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>location</span> <span class=s>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_pass</span> <span class=s>http://127.0.0.1:3001</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kn>proxy_http_version</span> <span class=mi>1</span><span class=s>.1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kn>proxy_set_header</span>   <span class=s>X-Real-IP</span> <span class=nv>$remote_addr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span>   <span class=s>X-Forwarded-For</span> <span class=nv>$proxy_add_x_forwarded_for</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span>   <span class=s>Host</span> <span class=nv>$host</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span>   <span class=s>Upgrade</span> <span class=nv>$http_upgrade</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span>   <span class=s>Connection</span> <span class=s>&#34;upgrade&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span>   <span class=s>Host</span> <span class=nv>$host</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=postgresql>Postgresql</h3><p>1、参考 <a href=/posts/2022/08/19/postgresql-install-deploy/>PostgreSql安装和部署</a> ，通过 docker-compose 安装，创建
postgresql.yaml：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>pgsql</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>postgres:13-alpine</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>pgsql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>5432</span><span class=p>:</span><span class=m>5432</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>POSTGRES_USER=postgres</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>POSTGRES_PASSWORD=admin@pg!</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>custom</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/data/postgres:/var/lib/postgresql/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>custom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>external</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span></code></pre></div><p>2、启动</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose -f postgresql.yaml up 
</span></span></code></pre></div><h3 id=umami>Umami</h3><p>参考 <a href=https://github.com/umami-software/umami/blob/master/docker-compose.yml>umami docker-compose.yml</a> ，使用 docker 镜像
umami:postgresql-latest 来安装 umami。</p><p>1、在 pqsql 容器创建 umami 数据库和用户：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker <span class=nb>exec</span> -it pgsql psql -U postgres -c <span class=s2>&#34;CREATE USER umami WITH PASSWORD &#39;umami@pg&#39;;&#34;</span>
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> -it pgsql psql -U postgres -c <span class=s2>&#34;CREATE DATABASE umami owner=umami;&#34;</span>
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> -it pgsql psql -U postgres -c <span class=s2>&#34;GRANT ALL privileges ON DATABASE umami TO umami;&#34;</span>
</span></span></code></pre></div><p>然后，初始化数 umami 数据。先进入容器：</p><pre tabindex=0><code>docker exec -it pgsql bash
</code></pre><p>进入 umami 数据库：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>psql -U umami -d umami
</span></span><span class=line><span class=cl><span class=nv>umami</span><span class=o>=</span>&gt;
</span></span></code></pre></div><p>执行 <a href=https://github.com/umami-software/umami/blob/master/sql/schema.postgresql.sql><strong>schema.postgresql.sql</strong></a> 文件内容。</p><p>2、通过 docker-compose 安装，创建 umami.yaml：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>umami</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>ghcr.io/umami-software/umami:postgresql-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>umami</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;3000:3000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>DATABASE_URL</span><span class=p>:</span><span class=w> </span><span class=l>postgresql://umami:umami@pg@pgsql:5432/umami</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>DATABASE_TYPE</span><span class=p>:</span><span class=w> </span><span class=l>postgresql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>HASH_SALT</span><span class=p>:</span><span class=w> </span><span class=l>vps@2023</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>custom</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>custom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>external</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span></code></pre></div><p>启动：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose -f umami.yaml up 
</span></span></code></pre></div><p>3、设置自定义域名</p><p>umami.chensoul.com</p><p>4、配置 nginx</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=s>[::]:80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span> <span class=s>umami.chensoul.com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>return</span> <span class=mi>301</span> <span class=s>https://</span><span class=nv>$host$request_uri</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span>          <span class=mi>443</span> <span class=s>ssl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span>     <span class=s>umami.chensoul.com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_certificate</span>      <span class=s>/usr/local/nginx/ssl/fullchain.cer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_certificate_key</span>  <span class=s>/usr/local/nginx/ssl/chensoul.com.key</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_session_cache</span>    <span class=s>shared:SSL:1m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_session_timeout</span>  <span class=mi>5m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_ciphers</span>  <span class=s>HIGH:!aNULL:!MD5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_prefer_server_ciphers</span>  <span class=no>on</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>location</span> <span class=s>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_pass</span> <span class=s>http://127.0.0.1:3000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>5、添加网站</p><p>访问 <a href=https://umami.chensoul.com/>https://umami.chensoul.com/</a>，默认用户名和密码为 admin/umami。登陆之后，修改密码，并添加网站。</p><h3 id=cusdis>Cusdis</h3><p>1、在 pqsql 容器创建 cusdis 数据库和用户：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker <span class=nb>exec</span> -it pgsql psql -U postgres -c <span class=s2>&#34;CREATE USER cusdis WITH PASSWORD &#39;cusdis@pg&#39;;&#34;</span>
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> -it pgsql psql -U postgres -c <span class=s2>&#34;CREATE DATABASE cusdis owner=cusdis;&#34;</span>
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> -it pgsql psql -U postgres -c <span class=s2>&#34;GRANT ALL privileges ON DATABASE cusdis TO cusdis;&#34;</span>
</span></span></code></pre></div><p>2、通过 docker-compose 安装，创建 cusdis.yaml：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>cusdis</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>djyde/cusdis:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>cusdis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;3010:3000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>USERNAME=admin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>PASSWORD=cusdis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>JWT_SECRET=vps@2023</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>NEXTAUTH_URL=https://cusdis.chensoul.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>DB_TYPE=pgsql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>DB_URL=postgresql://cusdis:cusdis@pg@pgsql:5432/cusdis</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>custom  </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>custom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>external</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>    
</span></span></span></code></pre></div><p>以下配置为 EMAIL 配置可选，下面是使用 <a href="https://cusdis.com/doc#/features/notification?id=gmail">Gmail</a>
进行配置，需要首先开启两阶段验证并创建一个应用密码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-properties data-lang=properties><span class=line><span class=cl><span class=na>SMTP_HOST</span><span class=o>=</span><span class=s>smtp.gmail.com</span>
</span></span><span class=line><span class=cl><span class=na>SMTP_PORT</span><span class=o>=</span><span class=s>465</span>
</span></span><span class=line><span class=cl><span class=na>SMTP_SECURE</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl><span class=na>SMTP_USER</span><span class=o>=</span><span class=s>your gmail email</span>
</span></span><span class=line><span class=cl><span class=na>SMTP_PASSWORD</span><span class=o>=</span><span class=s>&lt;app password&gt;</span>
</span></span><span class=line><span class=cl><span class=na>SMTP_SENDER</span><span class=o>=</span><span class=s>your gmail email</span>
</span></span></code></pre></div><p>3、启动</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose -f cusdis.yaml up -d
</span></span></code></pre></div><p>4、配置 nginx</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=s>[::]:80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span> <span class=s>cusdis.chensoul.com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>return</span> <span class=mi>301</span> <span class=s>https://</span><span class=nv>$host$request_uri</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span>          <span class=mi>443</span> <span class=s>ssl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span>     <span class=s>cusdis.chensoul.com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_certificate</span>      <span class=s>/usr/local/nginx/ssl/fullchain.cer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_certificate_key</span>  <span class=s>/usr/local/nginx/ssl/chensoul.com.key</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_session_cache</span>    <span class=s>shared:SSL:1m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_session_timeout</span>  <span class=mi>5m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_ciphers</span>  <span class=s>HIGH:!aNULL:!MD5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_prefer_server_ciphers</span>  <span class=no>on</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>location</span> <span class=s>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_pass</span> <span class=s>http://127.0.0.1:3010</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kn>proxy_pass_header</span> <span class=s>Authorization</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kn>proxy_pass_header</span> <span class=s>WWW-Authenticate</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>Host</span> <span class=nv>$host</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>X-Real-IP</span> <span class=nv>$remote_addr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>X-Forwarded-For</span> <span class=nv>$proxy_add_x_forwarded_for</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kn>if</span> <span class=s>(</span><span class=nv>$uri</span> <span class=p>=</span> <span class=s>&#39;/js/iframe.umd.js&#39;)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        	<span class=kn>add_header</span> <span class=s>&#39;Access-Control-Allow-Origin&#39;</span> <span class=s>&#39;*&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        	<span class=c1>#add_header &#39;Access-Control-Allow-Origin&#39; &#39;http://localhost:1313&#39;;
</span></span></span><span class=line><span class=cl><span class=c1></span>    	<span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=artalk>Artalk</h3><p>通过 docker-compose 安装，创建 artalk.yaml：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3.5&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>artalk</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>artalk</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>artalk/artalk-go</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>23366</span><span class=p>:</span><span class=m>23366</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>~/.artalk:/data</span><span class=w>
</span></span></span></code></pre></div><p>启动</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose -f artalk.yaml up -d
</span></span></code></pre></div><p>配置 nginx</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=s>[::]:80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span> <span class=s>artalk.chensoul.com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>return</span> <span class=mi>301</span> <span class=s>https://</span><span class=nv>$host$request_uri</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span>          <span class=mi>443</span> <span class=s>ssl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span>     <span class=s>artalk.chensoul.com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_certificate</span>      <span class=s>/usr/local/nginx/ssl/fullchain.cer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_certificate_key</span>  <span class=s>/usr/local/nginx/ssl/chensoul.com.key</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_session_cache</span>    <span class=s>shared:SSL:1m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_session_timeout</span>  <span class=mi>5m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_ciphers</span>  <span class=s>HIGH:!aNULL:!MD5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_prefer_server_ciphers</span>  <span class=no>on</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>location</span> <span class=s>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_pass</span> <span class=s>http://127.0.0.1:23366</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>在SSH客户端中输入下面的命令，设置输入信息设置管理员账号</p><pre tabindex=0><code class=language-build data-lang=build>docker exec -it artalk artalk admin
</code></pre><h3 id=memos>memos</h3><p>通过 docker-compose 安装，创建 memos.yaml：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;3.0&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>memos</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>neosmemo/memos:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>memos</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>~/.memos/:/var/opt/memos</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>5230</span><span class=p>:</span><span class=m>5230</span><span class=w>
</span></span></span></code></pre></div><p>启动</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose -f memos.yaml up -d
</span></span></code></pre></div><p>配置 nginx</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=s>[::]:80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span> <span class=s>memos.chensoul.com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>return</span> <span class=mi>301</span> <span class=s>https://</span><span class=nv>$host$request_uri</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span>          <span class=mi>443</span> <span class=s>ssl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span>     <span class=s>memos.chensoul.com</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_certificate</span>      <span class=s>/usr/local/nginx/ssl/fullchain.cer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_certificate_key</span>  <span class=s>/usr/local/nginx/ssl/chensoul.com.key</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_session_cache</span>    <span class=s>shared:SSL:1m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_session_timeout</span>  <span class=mi>5m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_ciphers</span>  <span class=s>HIGH:!aNULL:!MD5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_prefer_server_ciphers</span>  <span class=no>on</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>location</span> <span class=s>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_pass</span> <span class=s>http://127.0.0.1:5230</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=n8n>n8n</h3><p>1、在 pqsql 容器创建 n8n 数据库和用户：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker <span class=nb>exec</span> -it pgsql psql -U postgres -c <span class=s2>&#34;CREATE USER n8n WITH PASSWORD &#39;n8n@pg&#39;;&#34;</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> -it pgsql psql -U postgres -c <span class=s2>&#34;CREATE DATABASE n8n owner=n8n;&#34;</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>docker <span class=nb>exec</span> -it pgsql psql -U postgres -c <span class=s2>&#34;GRANT ALL privileges ON DATABASE n8n TO n8n;&#34;</span> <span class=p>;</span>
</span></span></code></pre></div><p>2、通过 docker-compose 安装，创建 n8n.yaml：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3.8&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>n8n</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>n8nio/n8n</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>n8n</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>DB_TYPE=postgresdb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>DB_POSTGRESDB_HOST=pgsql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>DB_POSTGRESDB_PORT=5432</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>DB_POSTGRESDB_DATABASE=n8n</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>DB_POSTGRESDB_USER=n8n</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>DB_POSTGRESDB_PASSWORD=n8n@pg</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>N8N_BASIC_AUTH_ACTIVE=true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>N8N_BASIC_AUTH_USER=admin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>N8N_BASIC_AUTH_PASSWORD=chenzj</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>TZ=&#34;Asia/Shanghai&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>WEBHOOK_URL=https://n8n.chensoul.com/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>5678</span><span class=p>:</span><span class=m>5678</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>/data/n8n:/home/node/.n8n</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=l>/bin/sh -c &#34;n8n start --tunnel&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>custom  </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>networks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>custom</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>external</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w> 
</span></span></span></code></pre></div><p>3、启动</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker-compose -f n8n.yaml up -d
</span></span></code></pre></div><p>4、设置 nginx 转发</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=k>location</span> <span class=s>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>proxy_pass</span> <span class=s>http://127.0.0.1:5678/</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>proxy_set_header</span> <span class=s>Connection</span> <span class=s>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>proxy_http_version</span> <span class=mi>1</span><span class=s>.1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>chunked_transfer_encoding</span> <span class=no>off</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>proxy_buffering</span> <span class=no>off</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>proxy_cache</span> <span class=no>off</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>access_log</span> <span class=s>/var/log/nginx/forward.log</span> <span class=s>combined</span> <span class=s>buffer=128k</span> <span class=s>flush=5s</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>这里面的转发配置不对的话，会导致直接访问 5678 端口正常，但是访问 nginx 的话，workflow 会一直处于执行。</p><p>5、添加 workflow</p><p>参考这篇文章 <a href=http://stiles.cc/archives/237/>http://stiles.cc/archives/237/</a> ，目前我配置了以下 workflows，实现了 github、douban、rss、memos 同步到 Telegram。</p><p><img src=http://chensoul.oss-cn-hangzhou.aliyuncs.com/images/my-n8n-workflows.png alt=my-n8n-workflows></p></article><h2>相关文章</h2><dl class=row><dt class=col-md-3>2023-02-21</dt><dd class=col-md-9><a href=/posts/2023/02/21/weekly_review_7/>周报-7｜练车、博客优化、注册ChatGPT账号</a></dd><dt class=col-md-3>2023-01-25</dt><dd class=col-md-9><a href=/posts/2023/01/25/weekly_review_3/>周报-3｜博客定制、VPS部署服务</a></dd><dt class=col-md-3>2023-01-15</dt><dd class=col-md-9><a href=/posts/2023/01/15/weekly_review_2/>周报-2｜博客重构</a></dd><dt class=col-md-3>2023-01-08</dt><dd class=col-md-9><a href=/posts/2023/01/08/weekly_review_1/>周报-1｜开始写周报、冥想</a></dd><dt class=col-md-3>2022-08-19</dt><dd class=col-md-9><a href=/posts/2022/08/19/postgresql-install-deploy/>PostgreSql安装和部署</a></dd><dt class=col-md-3>2022-08-19</dt><dd class=col-md-9><a href=/posts/2022/08/19/mysql-install-deploy/>MySql安装和部署</a></dd><dt class=col-md-3>2022-08-19</dt><dd class=col-md-9><a href=/posts/2022/08/19/using-images-in-blog/>博客中如何使用图床服务</a></dd><dt class=col-md-3>2021-09-09</dt><dd class=col-md-9><a href=/posts/2021/09/09/build-personal-blog-from-zero/>从零开始搭建个人博客</a></dd></dl><div class=author-card><div class=underline></div><div class=author-box><div class=author-image><a href=https://blog.chensoul.com><img src=/images/author.webp alt=chensoul></a></div><div class=author-content><p class=author-title>作者</p><p class=author-name>chensoul</p><p class=author-desc>Java 开发工程师，喜欢探索新技术。 可以在 <a href=https://github.com/chensoul>GitHub</a> 了解更多关于我的信息，也欢迎加入我的 <a href=https://t.me/chensoul_share>Telegram</a> 频道。</p></div></div></div><div align=center><div class=comment-underline></div></div><br><div id=cusdis_thread data-host=https://cusdis.chensoul.com data-app-id=3fce9b16-7416-4c74-9786-757bf28c1b8b data-page-id=21a92d5cb746fbeea17944569278664b data-page-url=https://blog.chensoul.com/posts/2023/01/25/notes-about-deploy-services-in-vps/ data-page-title=我的VPS服务部署记录></div><script async defer src=/js/cusdis.min.js></script></div></main><div class="footer gradient-2"><div class="container footer-container"><div class=row><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3"><div class=footer-title>网站地图</div><ul class=list-unstyled><li><a href=https://blog.chensoul.com/tags/>标签</a></li><li><a href=https://blog.chensoul.com/categories/>分类</a></li><li><a rel=alternate type=application/rss+xml href=https://blog.chensoul.com/index.xml></i>RSS</a></li></ul></div><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3"><div class=footer-title>社交</div><ul class=list-unstyled><li><a href=https://t.me/chensoul_share rel=noopener target=_blank>Telegram</a></li><li><a href=https://twitter.com/chensoul_eth rel=noopener target=_blank>Twitter</a></li><li><a href=https://github.com/chensoul rel=noopener target=_blank>GitHub</a></li></ul></div><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3"><div class=footer-title>关于</div><ul class=list-unstyled><li><a href=https://blog.chensoul.com/memos rel=noopener target=_blank>嘀咕</a></li><li><a href=https://blog.chensoul.com/links rel=noopener target=_blank>友链</a></li><li><a href=https://blog.chensoul.com/about rel=noopener target=_blank>关于</a></li></ul></div><div class="col-xs-12 col-sm-3 col-md-3 col-lg-3"><p class="pull-right text-right"><small><em>Blog <a href=https://umami.chensoul.com/share/zWO2pDuP/chenshou rel=noopener target=_blank>analytics</a></em></small><br><small><em>Powered by <a href=https://gohugo.io/ rel=noopener target=_blank>Hugo</a></em></small><br><small><em>Theme - <a href=https://github.com/shaform/hugo-theme-den rel=noopener target=_blank>Den</a></em></small><br><small>&copy;
chensoul
2020 -
2023</small></p></div><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" id=scroll-top class=scroll-top accesskey=g><span class=arrow-icon></span></a>
<script>var topButton=document.getElementById("scroll-top");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(topButton.style.visibility="visible",topButton.style.opacity="1"):(topButton.style.visibility="hidden",topButton.style.opacity="0")}</script></div></div></div><script async defer data-website-id=f110cfa0-b737-4690-a032-2b9073a57fc3 src=https://umami.chensoul.com/umami.js></script></body></html>