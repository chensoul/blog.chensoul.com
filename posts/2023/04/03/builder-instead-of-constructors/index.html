<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>《Effective Java 3》笔记2：使用构造器代替构造方法 | ChenSoul</title><meta name=keywords content="java"><meta name=description content="本文是 《Effective Java 3》第二章的学习笔记，在整理笔记过程中，通过 chatgpt 的帮助做了一些扩展。 介绍 当一个类需要多个构造函数参数时，可以考虑使"><meta name=author content="chensoul"><link rel=canonical href=https://blog.chensoul.com/posts/2023/04/03/builder-instead-of-constructors/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.chensoul.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.chensoul.com/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://blog.chensoul.com/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://blog.chensoul.com/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://blog.chensoul.com/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="《Effective Java 3》笔记2：使用构造器代替构造方法"><meta property="og:description" content="本文是 《Effective Java 3》第二章的学习笔记，在整理笔记过程中，通过 chatgpt 的帮助做了一些扩展。 介绍 当一个类需要多个构造函数参数时，可以考虑使"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.chensoul.com/posts/2023/04/03/builder-instead-of-constructors/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-04-03T16:00:00+08:00"><meta property="article:modified_time" content="2023-04-03T16:00:00+08:00"><meta property="og:site_name" content="ChenSoul"><meta name=twitter:card content="summary"><meta name=twitter:title content="《Effective Java 3》笔记2：使用构造器代替构造方法"><meta name=twitter:description content="本文是 《Effective Java 3》第二章的学习笔记，在整理笔记过程中，通过 chatgpt 的帮助做了一些扩展。 介绍 当一个类需要多个构造函数参数时，可以考虑使"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.chensoul.com/posts/"},{"@type":"ListItem","position":2,"name":"《Effective Java 3》笔记2：使用构造器代替构造方法","item":"https://blog.chensoul.com/posts/2023/04/03/builder-instead-of-constructors/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"《Effective Java 3》笔记2：使用构造器代替构造方法","name":"《Effective Java 3》笔记2：使用构造器代替构造方法","description":"本文是 《Effective Java 3》第二章的学习笔记，在整理笔记过程中，通过 chatgpt 的帮助做了一些扩展。 介绍 当一个类需要多个构造函数参数时，可以考虑使","keywords":["java"],"articleBody":"本文是 《Effective Java 3》第二章的学习笔记，在整理笔记过程中，通过 chatgpt 的帮助做了一些扩展。\n介绍 当一个类需要多个构造函数参数时，可以考虑使用构建器模式来创建对象。构建器模式是一种创建对象的设计模式，它可以通过链式调用方法的方式来设置对象的构造参数，并最终返回一个构造完整的对象。\n优点 使用构建器模式的原因有以下几点：\n避免构造函数参数过多的问题：当一个类需要多个构造函数参数时，构造函数的参数列表可能会变得很长，这会导致代码难以理解和维护。使用构建器模式可以将构造函数参数拆分成多个方法，从而使代码更加清晰易懂。 提高代码的可读性和可维护性：使用构建器模式可以使代码更加易懂和易维护，因为可以通过方法名来清晰地表达每个参数的含义。 提供更多的灵活性和可定制性：构建器模式可以提供更多的灵活性和可定制性，因为可以在构造对象时进行更多的逻辑处理和判断。例如，可以在构建器中添加验证逻辑，以确保参数的有效性。 支持多线程环境：构建器模式可以支持多线程环境，因为每个构建器都是独立的，不会受到其他线程的影响。 以下是一个例子：\npublic class NutritionFacts { private final int servingSize; private final int servings; private final int calories; private final int fat; private final int sodium; private final int carbohydrate; private NutritionFacts(Builder builder) { this.servingSize = builder.servingSize; this.servings = builder.servings; this.calories = builder.calories; this.fat = builder.fat; this.sodium = builder.sodium; this.carbohydrate = builder.carbohydrate; } //省略 get set public static class Builder { // Required parameters private final int servingSize; private final int servings; // Optional parameters - initialized to default values private int calories = 0; private int fat = 0; private int sodium = 0; private int carbohydrate = 0; public Builder(int servingSize, int servings) { this.servingSize = servingSize; this.servings = servings; } public Builder calories(int calories) { this.calories = calories; return this; } public Builder fat(int fat) { this.fat = fat; return this; } public Builder sodium(int sodium) { this.sodium = sodium; return this; } public Builder carbohydrate(int carbohydrate) { this.carbohydrate = carbohydrate; return this; } public NutritionFacts build() { return new NutritionFacts(this); } } } 在上述示例中，我们定义了一个名为 NutritionFacts 的类，它包含了一些营养成分的信息，例如每份的大小、总份数、卡路里、脂肪、钠和碳水化合物等成员变量。我们还定义了一个名为 Builder 的静态内部类，用于构建 NutritionFacts 对象。\n在 Builder 类中，我们定义了一个带有两个参数的构造方法，并在其中初始化了必需的成员变量 servingSize 和 servings。我们还定义了一些可选的方法，用于设置 NutritionFacts 对象的卡路里、脂肪、钠和碳水化合物等成员变量。这些方法都支持链式调用，并返回 Builder 对象本身，以便进行多次方法调用。\n在 Builder 类中，我们最终定义了一个 build() 方法，用于创建 NutritionFacts 对象并返回。在 build() 方法中，我们调用 NutritionFacts 的私有构造器并将 Builder 对象作为参数传递进去，从而创建 NutritionFacts 对象并初始化其成员变量。\n现在，我们可以使用 NutritionFacts.Builder 类来创建 NutritionFacts 对象，并使用链式调用来设置 NutritionFacts 对象的成员变量。例如，我们可以使用以下代码来创建一个每份大小为 240ml、总共有 8 份、卡路里为 100、脂肪为 2、钠为 35、碳水化合物为 27 的 NutritionFacts 对象：\nNutritionFacts cocaCola = new NutritionFacts.Builder(240, 8) .calories(100) .fat(2) .sodium(35) .carbohydrate(27) .build(); 在上述代码中，我们首先创建了一个 NutritionFacts.Builder 对象，并在构造函数中传递了每份大小和总份数等参数。然后，我们使用链式调用来设置卡路里、脂肪、钠和碳水化合物等成员变量，并最终调用 build() 方法来创建 NutritionFacts 对象。\n可以使用 lombok 注解来简化代码，但是，无法在构造器的构造方法里设置必要参数。\nimport lombok.Builder; @Builder public class NutritionFacts { private final int servingSize; private final int servings; private final int calories; private final int fat; private final int sodium; private final int carbohydrate; } 缺点 虽然构建器模式可以提高代码的可读性、可维护性以及提供更多的灵活性和可定制性，但它也有一些缺点，包括：\n增加代码复杂度：使用构建器模式会增加代码的复杂度，因为需要创建一个独立的构建器类，并且需要在构建器类中定义多个方法来设置对象的属性。这会增加代码量并且需要更多的时间来编写和维护代码。 增加内存开销：使用构建器模式需要创建一个独立的构建器对象，并且需要在构建器对象中保存对象的属性。这会增加内存开销，并且在创建对象时需要更多的时间和资源。 对于简单对象不适用：构建器模式更适用于构造复杂对象，对于简单对象来说，使用构建器模式可能会增加代码的复杂度和开销。 需要额外的代码：使用构建器模式需要编写额外的代码来创建构建器类和定义方法。如果只需要构造一个简单的对象，使用构建器模式可能会浪费时间和资源。 层次构建器 层次构建器（Hierarchical Builder）是一种构建器模式的扩展，它允许创建层次结构的对象，并支持在父对象中嵌套子对象。它通常由一个抽象的构建器接口，多个具体的构建器实现和一个指导者（Director）组成。\n在层次构建器中，每个构建器都负责创建特定类型的对象，并且可以在其构建方法中调用其他构建器的构建方法来创建嵌套的子对象。指导者负责协调构建器的顺序和调用构建器的方法来构建对象层次结构。\n层次构建器模式的优点包括：\n支持创建复杂的对象层次结构，能够构建包含多个层次和嵌套子对象的对象。 提供了更好的可读性和可维护性，因为每个构建器都只需要关注一个特定类型的对象，而且可以通过方法名来清晰地表达每个参数的含义。 提供了更多的灵活性和可定制性，因为可以在构建器中添加验证逻辑，以确保参数的有效性，并且可以动态地组合构建器来创建不同类型的对象。 层次构建器模式的缺点包括：\n代码量：由于层次构建器模式需要定义多个构建器类，因此代码量会比较大，尤其是在构建复杂对象时。\n嵌套层次：层次构建器模式中的对象层次结构是通过嵌套多个构建器实现的，这会导致代码的嵌套层次较深，可能会影响代码的可读性和可维护性。\n可能会增加内存开销：因为每个构建器都需要创建一个独立的对象，并且需要在构建器对象中保存对象的属性。对于大型对象和多级嵌套结构，开销可能会很大。\n不适合简单对象的构建：层次构建器模式适用于构建复杂对象层次结构，但对于简单的对象构建，使用层次构建器模式可能会显得过于繁琐和不必要。\n使用 举例 1 1、定义抽象的构建器接口，用于创建不同类型的对象和添加子对象：\npublic interface ComputerBuilder { void buildCPU(String model); void buildGPU(String model); void buildMemory(int size); void addStorage(String type, int size); void addPeripheral(String type); Computer getResult(); } 2、创建具体的构建器实现，用于构建不同类型的对象和添加子对象：\npublic class DesktopBuilder implements ComputerBuilder { private Desktop computer = new Desktop(); public void buildCPU(String model) { computer.setCPU(new CPU(model)); } public void buildGPU(String model) { computer.setGPU(new GPU(model)); } public void buildMemory(int size) { computer.setMemory(new Memory(size)); } public void addStorage(String type, int size) { computer.addStorage(new Storage(type, size)); } public void addPeripheral(String type) { computer.addPeripheral(new Peripheral(type)); } public Computer getResult() { return computer; } } public class LaptopBuilder implements ComputerBuilder { private Laptop computer = new Laptop(); public void buildCPU(String model) { computer.setCPU(new CPU(model)); } public void buildGPU(String model) { computer.setGPU(new GPU(model)); } public void buildMemory(int size) { computer.setMemory(new Memory(size)); } public void addStorage(String type, int size) { computer.addStorage(new Storage(type, size)); } public void addPeripheral(String type) { computer.addPeripheral(new Peripheral(type)); } public Computer getResult() { return computer; } } 3、创建指导者类，用于协调构建器的顺序和调用构建器的方法来构建对象层次结构：\npublic class ComputerDirector { private ComputerBuilder builder; public ComputerDirector(ComputerBuilder builder) { this.builder = builder; } public void construct() { builder.buildCPU(\"Intel Core i7\"); builder.buildGPU(\"Nvidia GeForce RTX 3080\"); builder.buildMemory(16); builder.addStorage(\"SSD\", 512); builder.addPeripheral(\"Keyboard\"); builder.addPeripheral(\"Mouse\"); } } 4、使用层次构建器模式创建计算机系统对象：\nComputerBuilder desktopBuilder = new DesktopBuilder(); ComputerBuilder laptopBuilder = new LaptopBuilder(); ComputerDirector director = new ComputerDirector(desktopBuilder); director.construct(); Computer desktop = desktopBuilder.getResult(); director = new ComputerDirector(laptopBuilder); director.construct(); Computer laptop = laptopBuilder.getResult(); // 将两个计算机系统对象组合成一个更大的计算机系统对象 ComputerSystem system = new ComputerSystem(); system.addComputer(desktop); system.addComputer(laptop); 在上面的示例中，DesktopBuilder和LaptopBuilder分别是具体的构建器实现，用于创建桌面计算机和笔记本电脑对象。ComputerDirector是指导者类，用于协调构建器的顺序和调用构建器的方法来构建对象层次结构。使用ComputerDirector构建计算机系统对象时，可以先使用DesktopBuilder构建桌面计算机对象，再使用LaptopBuilder构建笔记本电脑对象，最后将两个计算机系统对象组合成一个更大的计算机系统对象。\n下面是另一个使用层次构建器模式创建层次结构对象的例子，假设需要创建一个组织结构的层次结构对象，其中包含多个部门和嵌套子部门：\n1、定义抽象的构建器接口，用于创建不同类型的对象和添加子对象：\npublic interface DepartmentBuilder { void buildName(String name); void buildManager(String manager); void addSubDepartment(Department subDepartment); Department getResult(); } public abstract class DepartmentImpl implements Department { protected String name; protected String manager; protected List\u003cDepartment\u003e subDepartments = new ArrayList\u003c\u003e(); public void setName(String name) { this.name = name; } public void setManager(String manager) { this.manager = manager; } public void addSubDepartment(Department subDepartment) { subDepartments.add(subDepartment); } public void removeSubDepartment(Department subDepartment) { subDepartments.remove(subDepartment); } public List\u003cDepartment\u003e getSubDepartments() { return subDepartments; } public String getName() { return name; } public String getManager() { return manager; } } public class DevelopmentDepartment extends DepartmentImpl { // 添加特定于开发部门的属性和方法 } public class SalesDepartment extends DepartmentImpl { // 添加特定于销售部门的属性和方法 } 2、创建具体的构建器实现，用于构建不同类型的对象和添加子对象：\npublic class SalesDepartmentBuilder implements DepartmentBuilder { private SalesDepartment department = new SalesDepartment(); public void buildName(String name) { department.setName(name); } public void buildManager(String manager) { department.setManager(manager); } public void addSubDepartment(Department subDepartment) { department.addSubDepartment(subDepartment); } public Department getResult() { return department; } } public class DevelopmentDepartmentBuilder implements DepartmentBuilder { private DevelopmentDepartment department = new DevelopmentDepartment(); public void buildName(String name) { department.setName(name); } public void buildManager(String manager) { department.setManager(manager); } public void addSubDepartment(Department subDepartment) { department.addSubDepartment(subDepartment); } public Department getResult() { return department; } } 3、创建指导者类，用于协调构建器的顺序和调用构建器的方法来构建对象层次结构：\npublic class OrganizationDirector { private DepartmentBuilder builder; public OrganizationDirector(DepartmentBuilder builder) { this.builder = builder; } public void construct() { builder.buildName(\"Organization\"); builder.buildManager(\"CEO\"); Department salesDept = new SalesDepartment(); salesDept.setName(\"Sales Department\"); salesDept.setManager(\"Sales Manager\"); builder.addSubDepartment(salesDept); Department devDept = new DevelopmentDepartment(); devDept.setName(\"Development Department\"); devDept.setManager(\"Development Manager\"); Department frontendDevDept = new DevelopmentDepartment(); frontendDevDept.setName(\"Front-end Development Department\"); frontendDevDept.setManager(\"Front-end Development Manager\"); devDept.addSubDepartment(frontendDevDept); Department backendDevDept = new DevelopmentDepartment(); backendDevDept.setName(\"Back-end Development Department\"); backendDevDept.setManager(\"Back-end Development Manager\"); devDept.addSubDepartment(backendDevDept); builder.addSubDepartment(devDept); } } 4、使用层次构建器模式创建组织结构对象：\nDepartmentBuilder salesDeptBuilder = new SalesDepartmentBuilder(); DepartmentBuilder devDeptBuilder = new DevelopmentDepartmentBuilder(); OrganizationDirector director = new OrganizationDirector(salesDeptBuilder); director.construct(); Department salesDept = salesDeptBuilder.getResult(); director = new OrganizationDirector(devDeptBuilder); director.construct(); Department devDept = devDeptBuilder.getResult(); // 将两个部门对象组合成一个更大的组织结构对象 Organization organization = new Organization(); organization.addDepartment(salesDept); organization.addDepartment(devDept); 在上面的示例中，SalesDepartmentBuilder和DevelopmentDepartmentBuilder分别是具体的构建器实现，用于创建销售部门和开发部门对象。OrganizationDirector是指导者类，用于协调构建器的顺序和调用构建器的方法来构建对象层次结构。使用OrganizationDirector构建组织结构对象时，可以先使用SalesDepartmentBuilder构建销售部门对象，再使用DevelopmentDepartmentBuilder构建开发部门对象，最后将两个部门对象组合成一个更大的组织结构对象。\n举例 2 public abstract class ComputerComponent { private final String manufacturer; private final String model; // ... protected ComputerComponent(Builder\u003c?\u003e builder) { manufacturer = builder.manufacturer; model = builder.model; // ... } public String getManufacturer() { return manufacturer; } public String getModel() { return model; } public static abstract class Builder\u003cT extends Builder\u003cT\u003e\u003e { private String manufacturer; private String model; // ... public T setManufacturer(String manufacturer) { this.manufacturer = manufacturer; return self(); } public T setModel(String model) { this.model = model; return self(); } protected abstract T self(); public abstract ComputerComponent build(); } } public class Motherboard extends ComputerComponent { private final String socketType; // ... protected Motherboard(Builder builder) { super(builder); socketType = builder.socketType; // ... } public String getSocketType() { return socketType; } public static class Builder extends ComputerComponent.Builder\u003cBuilder\u003e { private String socketType; // ... public Builder setSocketType(String socketType) { this.socketType = socketType; return this; } @Override protected Builder self() { return this; } @Override public Motherboard build() { return new Motherboard(this); } } } public class CPU extends ComputerComponent { private final int coreCount; // ... protected CPU(Builder builder) { super(builder); coreCount = builder.coreCount; // ... } public int getCoreCount() { return coreCount; } public static class Builder extends ComputerComponent.Builder\u003cBuilder\u003e { private int coreCount; // ... public Builder setCoreCount(int coreCount) { this.coreCount = coreCount; return this; } @Override protected Builder self() { return this; } @Override public CPU build() { return new CPU(this); } } } public class Computer { private final Motherboard motherboard; private final CPU cpu; // ... protected Computer(Builder builder) { motherboard = builder.motherboard; cpu = builder.cpu; // ... } public Motherboard getMotherboard() { return motherboard; } public CPU getCpu() { return cpu; } public static class Builder { private Motherboard motherboard; private CPU cpu; // ... public Builder setMotherboard(Motherboard motherboard) { this.motherboard = motherboard; return this; } public Builder setCpu(CPU cpu) { this.cpu = cpu; return this; } public Computer build() { return new Computer(this); } } } 使用示例：\nMotherboard.Builder motherboardBuilder = new Motherboard.Builder() .setManufacturer(\"ASUS\") .setModel(\"ROG Strix Z590-E Gaming\") .setSocketType(\"LGA 1200\") // ... CPU.Builder cpuBuilder = new CPU.Builder() .setManufacturer(\"Intel\") .setModel(\"Core i9-11900K\") .setCoreCount(8) // ... Computer.Builder computerBuilder = new Computer.Builder() .setMotherboard(motherboardBuilder.build()) .setCpu(cpuBuilder.build()) // ... Computer computer = computerBuilder.build(); 在这个示例中，ComputerComponent 类是一个抽象基类，定义了计算机组件的基本属性和方法。它还定义了一个抽象的构建器类，用于构建它的子类的实例。\n每个 ComputerComponent 的具体子类都有自己的具体构建器类，该类扩展了抽象构建器类。具体构建器提供了设置相应组件属性的方法，例如主板的制造商、型号和插座类型，处理器的时钟速度和内存的容量。\nComputer 类代表一个完整的计算机系统，并具有用于构建 Computer 类的实例的构建器类。Computer.Builder 类提供了设置每个组件属性的方法，使用 Consumer 函数接口来接受配置相应构建器的 lambda 表达式。\n使用 以下是几个常见开源框架中使用建造者模式的例子：\nRetrofit Retrofit是一个Android和Java平台上的RESTful API库，它使用建造者模式来创建RestAdapter对象。RestAdapter.Builder类是一个建造者类，它包含了一系列的方法，用于设置Retrofit的配置选项，如设置API的base URL、设置HTTP Client、设置Converter等。\n示例代码：\nRestAdapter restAdapter = new RestAdapter.Builder() .setEndpoint(\"https://api.github.com\") .setClient(new OkClient()) .setLogLevel(RestAdapter.LogLevel.FULL) .build(); Gson Gson是一个用于在Java对象和JSON数据之间进行序列化和反序列化的库。它使用建造者模式来创建Gson对象。GsonBuilder类是一个建造者类，它包含了一系列的方法，用于配置Gson的行为，如设置日期格式、设置字段的命名策略等。\n示例代码：\nGson gson = new GsonBuilder() .setDateFormat(\"yyyy-MM-dd'T'HH:mm:ssZ\") .setFieldNamingPolicy(FieldNamingPolicy.LOWER_CASE_WITH_UNDERSCORES) .create(); Apache HttpClient Apache HttpClient是一个用于创建HTTP客户端的库，它使用建造者模式来创建HttpClient对象。HttpClientBuilder类是一个建造者类，它包含了一系列的方法，用于配置HttpClient的行为，如设置连接池、设置代理、设置Cookie管理器等。\n示例代码：\nHttpClient httpClient = HttpClientBuilder.create() .setMaxConnTotal(100) .setMaxConnPerRoute(10) .setProxy(new HttpHost(\"localhost\", 8080)) .setDefaultCookieStore(new BasicCookieStore()) .build(); Apache Kafka Apache Kafka是一个分布式消息队列系统，它使用建造者模式来创建Producer和Consumer对象。ProducerConfig和ConsumerConfig类是建造者类，它们包含了一系列的方法，用于配置Producer和Consumer的行为，如设置broker地址、设置序列化器等。\n示例代码：\nProperties producerProps = new Properties(); producerProps.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, \"localhost:9092\"); producerProps.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName()); producerProps.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName()); Producer\u003cString, String\u003e producer = new KafkaProducer\u003c\u003e(producerProps); Properties consumerProps = new Properties(); consumerProps.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, \"localhost:9092\"); consumerProps.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName()); consumerProps.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName()); consumerProps.put(ConsumerConfig.GROUP_ID_CONFIG, \"my-group\"); Consumer\u003cString, String\u003e consumer = new KafkaConsumer\u003c\u003e(consumerProps); Apache Commons Configuration Apache Commons Configuration是一个用于读取和写入各种配置文件的库，它使用建造者模式来创建Configuration对象。ConfigurationBuilder类是一个建造者类，它包含了一系列的方法，用于配置Configuration的行为，如设置配置文件类型、设置属性的分隔符等。\n示例代码：\nConfiguration config = new ConfigurationBuilder() .setDelimiterParsingDisabled(true) .setFile(new File(\"config.properties\")) .setListDelimiterHandler(new DefaultListDelimiterHandler(',')) .build(); Guava Guava是一个Google开发的Java库，它包含了许多实用的工具类和数据结构，其中包括使用建造者模式来创建的ImmutableList、ImmutableMap和ImmutableSet等不可变集合类。\n示例代码：\nImmutableList\u003cString\u003e list = ImmutableList.\u003cString\u003ebuilder() .add(\"foo\") .add(\"bar\") .add(\"baz\") .build(); ImmutableMap\u003cString, Integer\u003e map = ImmutableMap.\u003cString, Integer\u003ebuilder() .put(\"foo\", 1) .put(\"bar\", 2) .put(\"baz\", 3) .build(); ImmutableSet\u003cString\u003e set = ImmutableSet.\u003cString\u003ebuilder() .add(\"foo\") .add(\"bar\") .add(\"baz\") .build(); JPA Java Persistence API（JPA）是Java EE平台的一个ORM框架，它使用建造者模式来创建EntityManagerFactory对象。EntityManagerFactoryBuilder类是一个建造者类，它包含了一系列的方法，用于配置EntityManagerFactory的行为，如设置数据源、设置JPA的属性等。\n示例代码：\nEntityManagerFactory entityManagerFactory = new EntityManagerFactoryBuilder() .dataSource(myDataSource) .persistenceUnit(\"myPersistenceUnit\") .properties(myProperties) .build(); Spring Framework Spring Framework是一个Java平台上的开源应用程序框架，它使用建造者模式来创建RestTemplate和HttpHeaders对象。RestTemplateBuilder和HttpHeadersBuilder类是建造者类，它们包含了一系列的方法，用于配置RestTemplate和HttpHeaders的行为，如设置连接超时、设置请求头等。\n示例代码：\nRestTemplate restTemplate = new RestTemplateBuilder() .setConnectTimeout(Duration.ofSeconds(10)) .setReadTimeout(Duration.ofSeconds(10)) .build(); HttpHeaders headers = new HttpHeadersBuilder() .setContentType(MediaType.APPLICATION_JSON) .build(); 优化 建造者模式的优化主要包括以下几个方面：\n使用静态内部类优化建造者模式 建造者模式通常使用一个Builder类来构建复杂对象，为了避免Builder类变得过于臃肿，可以将其设计为静态内部类，这样可以使代码更加清晰，同时也能够保证线程安全。\n使用流式接口优化建造者模式 流式接口是一种链式调用的方式，它可以将多个方法调用连接起来，形成一个链式结构，使得代码更加简洁易读。在建造者模式中，可以使用流式接口来优化Builder类，使得客户端可以通过链式调用的方式来创建复杂对象，从而简化代码。\n使用默认值优化建造者模式 在建造者模式中，有些属性是必须的，而有些属性是可选的，可以使用默认值来为可选属性设置默认值，从而避免客户端必须为每个可选属性都提供值的情况，同时也能够简化客户端代码。\n使用Java 8中的Optional类优化建造者模式 Java 8中引入了Optional类，该类可以用于处理可能为null的值，可以进一步优化建造者模式中的代码。\n在建造者模式中，我们通常需要设置多个属性，其中有些属性可能是可选的，如果直接使用null来表示可选属性的值，可能会导致代码出现空指针异常，而使用Optional类可以避免这个问题。\n下面是一个使用Optional类优化建造者模式的示例代码：\nimport java.util.Optional; public class Computer { private String cpu; private String memory; private String hardDisk; private Optional\u003cString\u003e graphicsCard; private Computer(ComputerBuilder builder) { this.cpu = builder.cpu; this.memory = builder.memory; this.hardDisk = builder.hardDisk; this.graphicsCard = builder.graphicsCard; } // 省略getter方法 public static class ComputerBuilder { private String cpu; private String memory; private String hardDisk; private Optional\u003cString\u003e graphicsCard = Optional.empty(); public ComputerBuilder setCpu(String cpu) { this.cpu = cpu; return this; } public ComputerBuilder setMemory(String memory) { this.memory = memory; return this; } public ComputerBuilder setHardDisk(String hardDisk) { this.hardDisk = hardDisk; return this; } public ComputerBuilder setGraphicsCard(String graphicsCard) { this.graphicsCard = Optional.ofNullable(graphicsCard); return this; } public Computer build() { return new Computer(this); } } } 在这个示例代码中，我们使用 Optional 类来表示可选属性的值，将graphicsCard属性的类型改为Optional。在 ComputerBuilder 类中，我们使用 Optional.ofNullable 方法来将可选属性的值转换为 Optional 对象，并在调用 build 方法时，将 Optional 对象转换为普通的字符串类型。\n使用 Lambda表达式优化建造者模式 Lambda表达式是Java 8中引入的一种新的语言特性，可以进一步优化建造者模式中的代码，使得代码更加简洁易读。\n在建造者模式中，我们通常需要定义多个属性，并在构造方法中进行初始化。使用Lambda表达式可以避免定义多个属性的问题，将属性的赋值操作通过Lambda表达式传递给构造方法。\n下面是一个使用Lambda表达式优化建造者模式的示例代码：\nimport java.util.Optional; import java.util.function.Consumer; public class Computer { private String cpu; private String memory; private String hardDisk; private Optional\u003cString\u003e graphicsCard; private Computer(Consumer\u003cComputerBuilder\u003e builder) { ComputerBuilder computerBuilder = new ComputerBuilder(); builder.accept(computerBuilder); this.cpu = computerBuilder.cpu; this.memory = computerBuilder.memory; this.hardDisk = computerBuilder.hardDisk; this.graphicsCard = computerBuilder.graphicsCard; } // 省略getter方法 public static class ComputerBuilder { private String cpu; private String memory; private String hardDisk; private Optional\u003cString\u003e graphicsCard = Optional.empty(); public ComputerBuilder setCpu(String cpu) { this.cpu = cpu; return this; } public ComputerBuilder setMemory(String memory) { this.memory = memory; return this; } public ComputerBuilder setHardDisk(String hardDisk) { this.hardDisk = hardDisk; return this; } public ComputerBuilder setGraphicsCard(String graphicsCard) { this.graphicsCard = Optional.ofNullable(graphicsCard); return this; } } public static void main(String[] args) { Computer computer = new Computer(builder -\u003e builder .setCpu(\"Intel i7\") .setMemory(\"16GB\") .setHardDisk(\"512GB SSD\") .setGraphicsCard(\"NVIDIA GTX 1660\")); } } 在这个示例代码中，我们将 Computer 类的构造方法改为接收一个 Consumer 类型的参数，这个参数表示一个包含属性赋值操作的 Lambda 表达式。在构造方法中，我们先创建一个ComputerBuilder 对象，然后通过 Lambda 表达式调用 ComputerBuilder 对象的方法来设置属性值，并最终通过 ComputerBuilder 对象创建 Computer 对象。\n使用泛型和反射优化 class EntityCreator\u003cT\u003e { private Class\u003cT\u003e classInstance; private T entityObj; public EntityCreator(Class\u003cT\u003e classInstance, Object... initParams) throws Exception { this.classInstance = classInstance; Class\u003c?\u003e[] paramTypes = new Class\u003c?\u003e[initParams.length]; for (int index = 0, length = initParams.length; index \u003c length; index++) { String checkStr = initParams[index].getClass().getSimpleName(); if (checkStr.contains(\"Integer\")) { paramTypes[index] = int.class; } if (checkStr.contains(\"Double\")) { paramTypes[index] = double.class; } if (checkStr.contains(\"Boolean\")) { paramTypes[index] = boolean.class; } if (checkStr.contains(\"String\")) { paramTypes[index] = initParams[index].getClass(); } } Constructor\u003cT\u003e constructor = classInstance.getDeclaredConstructor(paramTypes); constructor.setAccessible(true); this.entityObj = constructor.newInstance(initParams); } public EntityCreator\u003cT\u003e setValue(String paramName, Object paramValue) throws Exception { Field field = classInstance.getDeclaredField(paramName); field.setAccessible(true); field.set(entityObj, paramValue); return this; } public T build() { return entityObj; } } ​\t如此，可移除整个内部 Builder 类，NutritionFacts 类私有构造的参数仅包括两个必填的 servingSize、servings 字段：\npublic class NutritionFacts { // Required parameters private final int servingSize; private final int servings; // Optional parameters - initialized to default values private int calories = 0; private int fat = 0; private int sodium = 0; private int carbohydrate = 0; private NutritionFacts(int servingSize, int servings) { this.servingSize = servingSize; this.servings = servings; } } 该案例的客户端代码改为：\nNutritionFacts cocaCola = new EntityCreator\u003c\u003e(NutritionFacts.class, 240, 8) .setValue(\"calories\", 100) .setValue(\"sodium\", 35) .setValue(\"carbohydrate\", 27).build(); ","wordCount":"7004","inLanguage":"en","datePublished":"2023-04-03T16:00:00+08:00","dateModified":"2023-04-03T16:00:00+08:00","author":{"@type":"Person","name":"chensoul"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.chensoul.com/posts/2023/04/03/builder-instead-of-constructors/"},"publisher":{"@type":"Organization","name":"ChenSoul","logo":{"@type":"ImageObject","url":"https://blog.chensoul.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.chensoul.com/ accesskey=h title="ChenSoul (Alt + H)">ChenSoul</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.chensoul.com/categories/ideas title=周报><span>周报</span></a></li><li><a href=https://blog.chensoul.com/categories/notes title=编程><span>编程</span></a></li><li><a href=https://blog.chensoul.com/tags title=标签><span>标签</span></a></li><li><a href=https://blog.chensoul.com/about title=关于><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>《Effective Java 3》笔记2：使用构造器代替构造方法</h1><div class=post-meta><span title='2023-04-03 16:00:00 +0800 +0800'>2023-04-03</span>&nbsp;·&nbsp;chensoul</div></header><div class=post-content><p>本文是 《Effective Java 3》第二章的学习笔记，在整理笔记过程中，通过 chatgpt 的帮助做了一些扩展。</p><h2 id=介绍>介绍<a hidden class=anchor aria-hidden=true href=#介绍>#</a></h2><p>当一个类需要多个构造函数参数时，可以考虑使用<strong>构建器模式</strong>来创建对象。构建器模式是一种创建对象的设计模式，它可以通过链式调用方法的方式来设置对象的构造参数，并最终返回一个构造完整的对象。</p><h2 id=优点>优点<a hidden class=anchor aria-hidden=true href=#优点>#</a></h2><p>使用构建器模式的原因有以下几点：</p><ol><li>避免构造函数参数过多的问题：当一个类需要多个构造函数参数时，构造函数的参数列表可能会变得很长，这会导致代码难以理解和维护。使用构建器模式可以将构造函数参数拆分成多个方法，从而使代码更加清晰易懂。</li><li>提高代码的可读性和可维护性：使用构建器模式可以使代码更加易懂和易维护，因为可以通过方法名来清晰地表达每个参数的含义。</li><li>提供更多的灵活性和可定制性：构建器模式可以提供更多的灵活性和可定制性，因为可以在构造对象时进行更多的逻辑处理和判断。例如，可以在构建器中添加验证逻辑，以确保参数的有效性。</li><li>支持多线程环境：构建器模式可以支持多线程环境，因为每个构建器都是独立的，不会受到其他线程的影响。</li></ol><p>以下是一个例子：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>NutritionFacts</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>servingSize</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>servings</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>calories</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>fat</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>sodium</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>carbohydrate</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=nf>NutritionFacts</span><span class=o>(</span><span class=n>Builder</span> <span class=n>builder</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>servingSize</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>servingSize</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>servings</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>servings</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>calories</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>calories</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>fat</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>fat</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>sodium</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>sodium</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>carbohydrate</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>carbohydrate</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>//省略 get set
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>Builder</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Required parameters
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>servingSize</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>servings</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Optional parameters - initialized to default values
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kd>private</span> <span class=kt>int</span> <span class=n>calories</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=kt>int</span> <span class=n>fat</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=kt>int</span> <span class=n>sodium</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=kt>int</span> <span class=n>carbohydrate</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=nf>Builder</span><span class=o>(</span><span class=kt>int</span> <span class=n>servingSize</span><span class=o>,</span> <span class=kt>int</span> <span class=n>servings</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>servingSize</span> <span class=o>=</span> <span class=n>servingSize</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>servings</span> <span class=o>=</span> <span class=n>servings</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>Builder</span> <span class=nf>calories</span><span class=o>(</span><span class=kt>int</span> <span class=n>calories</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>calories</span> <span class=o>=</span> <span class=n>calories</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>Builder</span> <span class=nf>fat</span><span class=o>(</span><span class=kt>int</span> <span class=n>fat</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>fat</span> <span class=o>=</span> <span class=n>fat</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>Builder</span> <span class=nf>sodium</span><span class=o>(</span><span class=kt>int</span> <span class=n>sodium</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>sodium</span> <span class=o>=</span> <span class=n>sodium</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>Builder</span> <span class=nf>carbohydrate</span><span class=o>(</span><span class=kt>int</span> <span class=n>carbohydrate</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>carbohydrate</span> <span class=o>=</span> <span class=n>carbohydrate</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>NutritionFacts</span> <span class=nf>build</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>new</span> <span class=n>NutritionFacts</span><span class=o>(</span><span class=k>this</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>在上述示例中，我们定义了一个名为 NutritionFacts 的类，它包含了一些营养成分的信息，例如每份的大小、总份数、卡路里、脂肪、钠和碳水化合物等成员变量。我们还定义了一个名为 Builder 的静态内部类，用于构建 NutritionFacts 对象。</p><p>在 Builder 类中，我们定义了一个带有两个参数的构造方法，并在其中初始化了必需的成员变量 servingSize 和 servings。我们还定义了一些可选的方法，用于设置 NutritionFacts 对象的卡路里、脂肪、钠和碳水化合物等成员变量。这些方法都支持链式调用，并返回 Builder 对象本身，以便进行多次方法调用。</p><p>在 Builder 类中，我们最终定义了一个 build() 方法，用于创建 NutritionFacts 对象并返回。在 build() 方法中，我们调用 NutritionFacts 的私有构造器并将 Builder 对象作为参数传递进去，从而创建 NutritionFacts 对象并初始化其成员变量。</p><p>现在，我们可以使用 NutritionFacts.Builder 类来创建 NutritionFacts 对象，并使用链式调用来设置 NutritionFacts 对象的成员变量。例如，我们可以使用以下代码来创建一个每份大小为 240ml、总共有 8 份、卡路里为 100、脂肪为 2、钠为 35、碳水化合物为 27 的 NutritionFacts 对象：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>NutritionFacts</span> <span class=n>cocaCola</span> <span class=o>=</span> <span class=k>new</span> <span class=n>NutritionFacts</span><span class=o>.</span><span class=na>Builder</span><span class=o>(</span><span class=mi>240</span><span class=o>,</span> <span class=mi>8</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>calories</span><span class=o>(</span><span class=mi>100</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>fat</span><span class=o>(</span><span class=mi>2</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>sodium</span><span class=o>(</span><span class=mi>35</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>carbohydrate</span><span class=o>(</span><span class=mi>27</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span></code></pre></div><p>在上述代码中，我们首先创建了一个 NutritionFacts.Builder 对象，并在构造函数中传递了每份大小和总份数等参数。然后，我们使用链式调用来设置卡路里、脂肪、钠和碳水化合物等成员变量，并最终调用 build() 方法来创建 NutritionFacts 对象。</p><p>可以使用 lombok 注解来简化代码，但是，<strong>无法在构造器的构造方法里设置必要参数。</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span> <span class=nn>lombok.Builder</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Builder</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>NutritionFacts</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>servingSize</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>servings</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>calories</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>fat</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>sodium</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>carbohydrate</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=缺点>缺点<a hidden class=anchor aria-hidden=true href=#缺点>#</a></h2><p>虽然构建器模式可以提高代码的可读性、可维护性以及提供更多的灵活性和可定制性，但它也有一些缺点，包括：</p><ol><li>增加代码复杂度：使用构建器模式会增加代码的复杂度，因为需要创建一个独立的构建器类，并且需要在构建器类中定义多个方法来设置对象的属性。这会增加代码量并且需要更多的时间来编写和维护代码。</li><li>增加内存开销：使用构建器模式需要创建一个独立的构建器对象，并且需要在构建器对象中保存对象的属性。这会增加内存开销，并且在创建对象时需要更多的时间和资源。</li><li>对于简单对象不适用：构建器模式更适用于构造复杂对象，对于简单对象来说，使用构建器模式可能会增加代码的复杂度和开销。</li><li>需要额外的代码：使用构建器模式需要编写额外的代码来创建构建器类和定义方法。如果只需要构造一个简单的对象，使用构建器模式可能会浪费时间和资源。</li></ol><h2 id=层次构建器>层次构建器<a hidden class=anchor aria-hidden=true href=#层次构建器>#</a></h2><p>层次构建器（Hierarchical Builder）是一种构建器模式的扩展，它允许创建层次结构的对象，并支持在父对象中嵌套子对象。它通常由一个抽象的构建器接口，多个具体的构建器实现和一个指导者（Director）组成。</p><p>在层次构建器中，每个构建器都负责创建特定类型的对象，并且可以在其构建方法中调用其他构建器的构建方法来创建嵌套的子对象。指导者负责协调构建器的顺序和调用构建器的方法来构建对象层次结构。</p><p>层次构建器模式的优点包括：</p><ol><li>支持创建复杂的对象层次结构，能够构建包含多个层次和嵌套子对象的对象。</li><li>提供了更好的可读性和可维护性，因为每个构建器都只需要关注一个特定类型的对象，而且可以通过方法名来清晰地表达每个参数的含义。</li><li>提供了更多的灵活性和可定制性，因为可以在构建器中添加验证逻辑，以确保参数的有效性，并且可以动态地组合构建器来创建不同类型的对象。</li></ol><p>层次构建器模式的缺点包括：</p><ol><li><p>代码量：由于层次构建器模式需要定义多个构建器类，因此代码量会比较大，尤其是在构建复杂对象时。</p></li><li><p>嵌套层次：层次构建器模式中的对象层次结构是通过嵌套多个构建器实现的，这会导致代码的嵌套层次较深，可能会影响代码的可读性和可维护性。</p></li><li><p>可能会增加内存开销：因为每个构建器都需要创建一个独立的对象，并且需要在构建器对象中保存对象的属性。对于大型对象和多级嵌套结构，开销可能会很大。</p></li><li><p>不适合简单对象的构建：层次构建器模式适用于构建复杂对象层次结构，但对于简单的对象构建，使用层次构建器模式可能会显得过于繁琐和不必要。</p></li></ol><h3 id=使用>使用<a hidden class=anchor aria-hidden=true href=#使用>#</a></h3><h4 id=举例-1>举例 1<a hidden class=anchor aria-hidden=true href=#举例-1>#</a></h4><p>1、定义抽象的构建器接口，用于创建不同类型的对象和添加子对象：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>ComputerBuilder</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>buildCPU</span><span class=o>(</span><span class=n>String</span> <span class=n>model</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>buildGPU</span><span class=o>(</span><span class=n>String</span> <span class=n>model</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>buildMemory</span><span class=o>(</span><span class=kt>int</span> <span class=n>size</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>addStorage</span><span class=o>(</span><span class=n>String</span> <span class=n>type</span><span class=o>,</span> <span class=kt>int</span> <span class=n>size</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>addPeripheral</span><span class=o>(</span><span class=n>String</span> <span class=n>type</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Computer</span> <span class=nf>getResult</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>2、创建具体的构建器实现，用于构建不同类型的对象和添加子对象：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>DesktopBuilder</span> <span class=kd>implements</span> <span class=n>ComputerBuilder</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Desktop</span> <span class=n>computer</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Desktop</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>buildCPU</span><span class=o>(</span><span class=n>String</span> <span class=n>model</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>computer</span><span class=o>.</span><span class=na>setCPU</span><span class=o>(</span><span class=k>new</span> <span class=n>CPU</span><span class=o>(</span><span class=n>model</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>buildGPU</span><span class=o>(</span><span class=n>String</span> <span class=n>model</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>computer</span><span class=o>.</span><span class=na>setGPU</span><span class=o>(</span><span class=k>new</span> <span class=n>GPU</span><span class=o>(</span><span class=n>model</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>buildMemory</span><span class=o>(</span><span class=kt>int</span> <span class=n>size</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>computer</span><span class=o>.</span><span class=na>setMemory</span><span class=o>(</span><span class=k>new</span> <span class=n>Memory</span><span class=o>(</span><span class=n>size</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>addStorage</span><span class=o>(</span><span class=n>String</span> <span class=n>type</span><span class=o>,</span> <span class=kt>int</span> <span class=n>size</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>computer</span><span class=o>.</span><span class=na>addStorage</span><span class=o>(</span><span class=k>new</span> <span class=n>Storage</span><span class=o>(</span><span class=n>type</span><span class=o>,</span> <span class=n>size</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>addPeripheral</span><span class=o>(</span><span class=n>String</span> <span class=n>type</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>computer</span><span class=o>.</span><span class=na>addPeripheral</span><span class=o>(</span><span class=k>new</span> <span class=n>Peripheral</span><span class=o>(</span><span class=n>type</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Computer</span> <span class=nf>getResult</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>computer</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>LaptopBuilder</span> <span class=kd>implements</span> <span class=n>ComputerBuilder</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Laptop</span> <span class=n>computer</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Laptop</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>buildCPU</span><span class=o>(</span><span class=n>String</span> <span class=n>model</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>computer</span><span class=o>.</span><span class=na>setCPU</span><span class=o>(</span><span class=k>new</span> <span class=n>CPU</span><span class=o>(</span><span class=n>model</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>buildGPU</span><span class=o>(</span><span class=n>String</span> <span class=n>model</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>computer</span><span class=o>.</span><span class=na>setGPU</span><span class=o>(</span><span class=k>new</span> <span class=n>GPU</span><span class=o>(</span><span class=n>model</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>buildMemory</span><span class=o>(</span><span class=kt>int</span> <span class=n>size</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>computer</span><span class=o>.</span><span class=na>setMemory</span><span class=o>(</span><span class=k>new</span> <span class=n>Memory</span><span class=o>(</span><span class=n>size</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>addStorage</span><span class=o>(</span><span class=n>String</span> <span class=n>type</span><span class=o>,</span> <span class=kt>int</span> <span class=n>size</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>computer</span><span class=o>.</span><span class=na>addStorage</span><span class=o>(</span><span class=k>new</span> <span class=n>Storage</span><span class=o>(</span><span class=n>type</span><span class=o>,</span> <span class=n>size</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>addPeripheral</span><span class=o>(</span><span class=n>String</span> <span class=n>type</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>computer</span><span class=o>.</span><span class=na>addPeripheral</span><span class=o>(</span><span class=k>new</span> <span class=n>Peripheral</span><span class=o>(</span><span class=n>type</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Computer</span> <span class=nf>getResult</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>computer</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>3、创建指导者类，用于协调构建器的顺序和调用构建器的方法来构建对象层次结构：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ComputerDirector</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>ComputerBuilder</span> <span class=n>builder</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>ComputerDirector</span><span class=o>(</span><span class=n>ComputerBuilder</span> <span class=n>builder</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>builder</span> <span class=o>=</span> <span class=n>builder</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>construct</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>builder</span><span class=o>.</span><span class=na>buildCPU</span><span class=o>(</span><span class=s>&#34;Intel Core i7&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>builder</span><span class=o>.</span><span class=na>buildGPU</span><span class=o>(</span><span class=s>&#34;Nvidia GeForce RTX 3080&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>builder</span><span class=o>.</span><span class=na>buildMemory</span><span class=o>(</span><span class=mi>16</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>builder</span><span class=o>.</span><span class=na>addStorage</span><span class=o>(</span><span class=s>&#34;SSD&#34;</span><span class=o>,</span> <span class=mi>512</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>builder</span><span class=o>.</span><span class=na>addPeripheral</span><span class=o>(</span><span class=s>&#34;Keyboard&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>builder</span><span class=o>.</span><span class=na>addPeripheral</span><span class=o>(</span><span class=s>&#34;Mouse&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>4、使用层次构建器模式创建计算机系统对象：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>ComputerBuilder</span> <span class=n>desktopBuilder</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DesktopBuilder</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>ComputerBuilder</span> <span class=n>laptopBuilder</span> <span class=o>=</span> <span class=k>new</span> <span class=n>LaptopBuilder</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ComputerDirector</span> <span class=n>director</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ComputerDirector</span><span class=o>(</span><span class=n>desktopBuilder</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>director</span><span class=o>.</span><span class=na>construct</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>Computer</span> <span class=n>desktop</span> <span class=o>=</span> <span class=n>desktopBuilder</span><span class=o>.</span><span class=na>getResult</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>director</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ComputerDirector</span><span class=o>(</span><span class=n>laptopBuilder</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>director</span><span class=o>.</span><span class=na>construct</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>Computer</span> <span class=n>laptop</span> <span class=o>=</span> <span class=n>laptopBuilder</span><span class=o>.</span><span class=na>getResult</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 将两个计算机系统对象组合成一个更大的计算机系统对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>ComputerSystem</span> <span class=n>system</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ComputerSystem</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>system</span><span class=o>.</span><span class=na>addComputer</span><span class=o>(</span><span class=n>desktop</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>system</span><span class=o>.</span><span class=na>addComputer</span><span class=o>(</span><span class=n>laptop</span><span class=o>);</span>
</span></span></code></pre></div><p>在上面的示例中，DesktopBuilder和LaptopBuilder分别是具体的构建器实现，用于创建桌面计算机和笔记本电脑对象。ComputerDirector是指导者类，用于协调构建器的顺序和调用构建器的方法来构建对象层次结构。使用ComputerDirector构建计算机系统对象时，可以先使用DesktopBuilder构建桌面计算机对象，再使用LaptopBuilder构建笔记本电脑对象，最后将两个计算机系统对象组合成一个更大的计算机系统对象。</p><p>下面是另一个使用层次构建器模式创建层次结构对象的例子，假设需要创建一个组织结构的层次结构对象，其中包含多个部门和嵌套子部门：</p><p>1、定义抽象的构建器接口，用于创建不同类型的对象和添加子对象：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>DepartmentBuilder</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>buildName</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>buildManager</span><span class=o>(</span><span class=n>String</span> <span class=n>manager</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>addSubDepartment</span><span class=o>(</span><span class=n>Department</span> <span class=n>subDepartment</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Department</span> <span class=nf>getResult</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>DepartmentImpl</span> <span class=kd>implements</span> <span class=n>Department</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=n>String</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=n>String</span> <span class=n>manager</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Department</span><span class=o>&gt;</span> <span class=n>subDepartments</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setName</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>name</span> <span class=o>=</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setManager</span><span class=o>(</span><span class=n>String</span> <span class=n>manager</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>manager</span> <span class=o>=</span> <span class=n>manager</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>addSubDepartment</span><span class=o>(</span><span class=n>Department</span> <span class=n>subDepartment</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>subDepartments</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>subDepartment</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>removeSubDepartment</span><span class=o>(</span><span class=n>Department</span> <span class=n>subDepartment</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>subDepartments</span><span class=o>.</span><span class=na>remove</span><span class=o>(</span><span class=n>subDepartment</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Department</span><span class=o>&gt;</span> <span class=nf>getSubDepartments</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>subDepartments</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getName</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getManager</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>manager</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>DevelopmentDepartment</span> <span class=kd>extends</span> <span class=n>DepartmentImpl</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 添加特定于开发部门的属性和方法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SalesDepartment</span> <span class=kd>extends</span> <span class=n>DepartmentImpl</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 添加特定于销售部门的属性和方法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span>
</span></span></code></pre></div><p>2、创建具体的构建器实现，用于构建不同类型的对象和添加子对象：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SalesDepartmentBuilder</span> <span class=kd>implements</span> <span class=n>DepartmentBuilder</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>SalesDepartment</span> <span class=n>department</span> <span class=o>=</span> <span class=k>new</span> <span class=n>SalesDepartment</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>buildName</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>department</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=n>name</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>buildManager</span><span class=o>(</span><span class=n>String</span> <span class=n>manager</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>department</span><span class=o>.</span><span class=na>setManager</span><span class=o>(</span><span class=n>manager</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>addSubDepartment</span><span class=o>(</span><span class=n>Department</span> <span class=n>subDepartment</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>department</span><span class=o>.</span><span class=na>addSubDepartment</span><span class=o>(</span><span class=n>subDepartment</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Department</span> <span class=nf>getResult</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>department</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>DevelopmentDepartmentBuilder</span> <span class=kd>implements</span> <span class=n>DepartmentBuilder</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>DevelopmentDepartment</span> <span class=n>department</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DevelopmentDepartment</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>buildName</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>department</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=n>name</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>buildManager</span><span class=o>(</span><span class=n>String</span> <span class=n>manager</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>department</span><span class=o>.</span><span class=na>setManager</span><span class=o>(</span><span class=n>manager</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>addSubDepartment</span><span class=o>(</span><span class=n>Department</span> <span class=n>subDepartment</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>department</span><span class=o>.</span><span class=na>addSubDepartment</span><span class=o>(</span><span class=n>subDepartment</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Department</span> <span class=nf>getResult</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>department</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>3、创建指导者类，用于协调构建器的顺序和调用构建器的方法来构建对象层次结构：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>OrganizationDirector</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>DepartmentBuilder</span> <span class=n>builder</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>OrganizationDirector</span><span class=o>(</span><span class=n>DepartmentBuilder</span> <span class=n>builder</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>builder</span> <span class=o>=</span> <span class=n>builder</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>construct</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>builder</span><span class=o>.</span><span class=na>buildName</span><span class=o>(</span><span class=s>&#34;Organization&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>builder</span><span class=o>.</span><span class=na>buildManager</span><span class=o>(</span><span class=s>&#34;CEO&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>Department</span> <span class=n>salesDept</span> <span class=o>=</span> <span class=k>new</span> <span class=n>SalesDepartment</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>salesDept</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=s>&#34;Sales Department&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>salesDept</span><span class=o>.</span><span class=na>setManager</span><span class=o>(</span><span class=s>&#34;Sales Manager&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>builder</span><span class=o>.</span><span class=na>addSubDepartment</span><span class=o>(</span><span class=n>salesDept</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>Department</span> <span class=n>devDept</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DevelopmentDepartment</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>devDept</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=s>&#34;Development Department&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>devDept</span><span class=o>.</span><span class=na>setManager</span><span class=o>(</span><span class=s>&#34;Development Manager&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>Department</span> <span class=n>frontendDevDept</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DevelopmentDepartment</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>frontendDevDept</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=s>&#34;Front-end Development Department&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>frontendDevDept</span><span class=o>.</span><span class=na>setManager</span><span class=o>(</span><span class=s>&#34;Front-end Development Manager&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>devDept</span><span class=o>.</span><span class=na>addSubDepartment</span><span class=o>(</span><span class=n>frontendDevDept</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>Department</span> <span class=n>backendDevDept</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DevelopmentDepartment</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>backendDevDept</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=s>&#34;Back-end Development Department&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>backendDevDept</span><span class=o>.</span><span class=na>setManager</span><span class=o>(</span><span class=s>&#34;Back-end Development Manager&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>devDept</span><span class=o>.</span><span class=na>addSubDepartment</span><span class=o>(</span><span class=n>backendDevDept</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>builder</span><span class=o>.</span><span class=na>addSubDepartment</span><span class=o>(</span><span class=n>devDept</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>4、使用层次构建器模式创建组织结构对象：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>DepartmentBuilder</span> <span class=n>salesDeptBuilder</span> <span class=o>=</span> <span class=k>new</span> <span class=n>SalesDepartmentBuilder</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>DepartmentBuilder</span> <span class=n>devDeptBuilder</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DevelopmentDepartmentBuilder</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>OrganizationDirector</span> <span class=n>director</span> <span class=o>=</span> <span class=k>new</span> <span class=n>OrganizationDirector</span><span class=o>(</span><span class=n>salesDeptBuilder</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>director</span><span class=o>.</span><span class=na>construct</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>Department</span> <span class=n>salesDept</span> <span class=o>=</span> <span class=n>salesDeptBuilder</span><span class=o>.</span><span class=na>getResult</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>director</span> <span class=o>=</span> <span class=k>new</span> <span class=n>OrganizationDirector</span><span class=o>(</span><span class=n>devDeptBuilder</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>director</span><span class=o>.</span><span class=na>construct</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>Department</span> <span class=n>devDept</span> <span class=o>=</span> <span class=n>devDeptBuilder</span><span class=o>.</span><span class=na>getResult</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 将两个部门对象组合成一个更大的组织结构对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Organization</span> <span class=n>organization</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Organization</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>organization</span><span class=o>.</span><span class=na>addDepartment</span><span class=o>(</span><span class=n>salesDept</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>organization</span><span class=o>.</span><span class=na>addDepartment</span><span class=o>(</span><span class=n>devDept</span><span class=o>);</span>
</span></span></code></pre></div><p>在上面的示例中，SalesDepartmentBuilder和DevelopmentDepartmentBuilder分别是具体的构建器实现，用于创建销售部门和开发部门对象。OrganizationDirector是指导者类，用于协调构建器的顺序和调用构建器的方法来构建对象层次结构。使用OrganizationDirector构建组织结构对象时，可以先使用SalesDepartmentBuilder构建销售部门对象，再使用DevelopmentDepartmentBuilder构建开发部门对象，最后将两个部门对象组合成一个更大的组织结构对象。</p><h4 id=举例-2>举例 2<a hidden class=anchor aria-hidden=true href=#举例-2>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>ComputerComponent</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>manufacturer</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>model</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=nf>ComputerComponent</span><span class=o>(</span><span class=n>Builder</span><span class=o>&lt;?&gt;</span> <span class=n>builder</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>manufacturer</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>manufacturer</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>model</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>model</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getManufacturer</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>manufacturer</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getModel</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>model</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>Builder</span><span class=o>&lt;</span><span class=n>T</span> <span class=kd>extends</span> <span class=n>Builder</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=n>String</span> <span class=n>manufacturer</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=n>String</span> <span class=n>model</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>T</span> <span class=nf>setManufacturer</span><span class=o>(</span><span class=n>String</span> <span class=n>manufacturer</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>manufacturer</span> <span class=o>=</span> <span class=n>manufacturer</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>self</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>T</span> <span class=nf>setModel</span><span class=o>(</span><span class=n>String</span> <span class=n>model</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>model</span> <span class=o>=</span> <span class=n>model</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>self</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>protected</span> <span class=kd>abstract</span> <span class=n>T</span> <span class=nf>self</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kd>abstract</span> <span class=n>ComputerComponent</span> <span class=nf>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Motherboard</span> <span class=kd>extends</span> <span class=n>ComputerComponent</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>socketType</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=nf>Motherboard</span><span class=o>(</span><span class=n>Builder</span> <span class=n>builder</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>(</span><span class=n>builder</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>socketType</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>socketType</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getSocketType</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>socketType</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>Builder</span> <span class=kd>extends</span> <span class=n>ComputerComponent</span><span class=o>.</span><span class=na>Builder</span><span class=o>&lt;</span><span class=n>Builder</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=n>String</span> <span class=n>socketType</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>Builder</span> <span class=nf>setSocketType</span><span class=o>(</span><span class=n>String</span> <span class=n>socketType</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>socketType</span> <span class=o>=</span> <span class=n>socketType</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>        <span class=kd>protected</span> <span class=n>Builder</span> <span class=nf>self</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>Motherboard</span> <span class=nf>build</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>new</span> <span class=n>Motherboard</span><span class=o>(</span><span class=k>this</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>CPU</span> <span class=kd>extends</span> <span class=n>ComputerComponent</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>coreCount</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=nf>CPU</span><span class=o>(</span><span class=n>Builder</span> <span class=n>builder</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>(</span><span class=n>builder</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>coreCount</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>coreCount</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>getCoreCount</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>coreCount</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>Builder</span> <span class=kd>extends</span> <span class=n>ComputerComponent</span><span class=o>.</span><span class=na>Builder</span><span class=o>&lt;</span><span class=n>Builder</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=kt>int</span> <span class=n>coreCount</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>Builder</span> <span class=nf>setCoreCount</span><span class=o>(</span><span class=kt>int</span> <span class=n>coreCount</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>coreCount</span> <span class=o>=</span> <span class=n>coreCount</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>        <span class=kd>protected</span> <span class=n>Builder</span> <span class=nf>self</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>CPU</span> <span class=nf>build</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>new</span> <span class=n>CPU</span><span class=o>(</span><span class=k>this</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Computer</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=n>Motherboard</span> <span class=n>motherboard</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=n>CPU</span> <span class=n>cpu</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=nf>Computer</span><span class=o>(</span><span class=n>Builder</span> <span class=n>builder</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>motherboard</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>motherboard</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>cpu</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>cpu</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Motherboard</span> <span class=nf>getMotherboard</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>motherboard</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>CPU</span> <span class=nf>getCpu</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>cpu</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>Builder</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=n>Motherboard</span> <span class=n>motherboard</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=n>CPU</span> <span class=n>cpu</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>Builder</span> <span class=nf>setMotherboard</span><span class=o>(</span><span class=n>Motherboard</span> <span class=n>motherboard</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>motherboard</span> <span class=o>=</span> <span class=n>motherboard</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>Builder</span> <span class=nf>setCpu</span><span class=o>(</span><span class=n>CPU</span> <span class=n>cpu</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>cpu</span> <span class=o>=</span> <span class=n>cpu</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>Computer</span> <span class=nf>build</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>new</span> <span class=n>Computer</span><span class=o>(</span><span class=k>this</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>使用示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Motherboard</span><span class=o>.</span><span class=na>Builder</span> <span class=n>motherboardBuilder</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Motherboard</span><span class=o>.</span><span class=na>Builder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>setManufacturer</span><span class=o>(</span><span class=s>&#34;ASUS&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>setModel</span><span class=o>(</span><span class=s>&#34;ROG Strix Z590-E Gaming&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>setSocketType</span><span class=o>(</span><span class=s>&#34;LGA 1200&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=n>CPU</span><span class=o>.</span><span class=na>Builder</span> <span class=n>cpuBuilder</span> <span class=o>=</span> <span class=k>new</span> <span class=n>CPU</span><span class=o>.</span><span class=na>Builder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>setManufacturer</span><span class=o>(</span><span class=s>&#34;Intel&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>setModel</span><span class=o>(</span><span class=s>&#34;Core i9-11900K&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>setCoreCount</span><span class=o>(</span><span class=mi>8</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=n>Computer</span><span class=o>.</span><span class=na>Builder</span> <span class=n>computerBuilder</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Computer</span><span class=o>.</span><span class=na>Builder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>setMotherboard</span><span class=o>(</span><span class=n>motherboardBuilder</span><span class=o>.</span><span class=na>build</span><span class=o>())</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>setCpu</span><span class=o>(</span><span class=n>cpuBuilder</span><span class=o>.</span><span class=na>build</span><span class=o>())</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=n>Computer</span> <span class=n>computer</span> <span class=o>=</span> <span class=n>computerBuilder</span><span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span></code></pre></div><p>在这个示例中，<code>ComputerComponent</code> 类是一个抽象基类，定义了计算机组件的基本属性和方法。它还定义了一个抽象的构建器类，用于构建它的子类的实例。</p><p>每个 <code>ComputerComponent</code> 的具体子类都有自己的具体构建器类，该类扩展了抽象构建器类。具体构建器提供了设置相应组件属性的方法，例如主板的制造商、型号和插座类型，处理器的时钟速度和内存的容量。</p><p><code>Computer</code> 类代表一个完整的计算机系统，并具有用于构建 <code>Computer</code> 类的实例的构建器类。<code>Computer.Builder</code> 类提供了设置每个组件属性的方法，使用 <code>Consumer</code> 函数接口来接受配置相应构建器的 lambda 表达式。</p><h2 id=使用-1>使用<a hidden class=anchor aria-hidden=true href=#使用-1>#</a></h2><p>以下是几个常见开源框架中使用建造者模式的例子：</p><h3 id=retrofit>Retrofit<a hidden class=anchor aria-hidden=true href=#retrofit>#</a></h3><p>Retrofit是一个Android和Java平台上的RESTful API库，它使用建造者模式来创建RestAdapter对象。RestAdapter.Builder类是一个建造者类，它包含了一系列的方法，用于设置Retrofit的配置选项，如设置API的base URL、设置HTTP Client、设置Converter等。</p><p>示例代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>RestAdapter</span> <span class=n>restAdapter</span> <span class=o>=</span> <span class=k>new</span> <span class=n>RestAdapter</span><span class=o>.</span><span class=na>Builder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>setEndpoint</span><span class=o>(</span><span class=s>&#34;https://api.github.com&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>setClient</span><span class=o>(</span><span class=k>new</span> <span class=n>OkClient</span><span class=o>())</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>setLogLevel</span><span class=o>(</span><span class=n>RestAdapter</span><span class=o>.</span><span class=na>LogLevel</span><span class=o>.</span><span class=na>FULL</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span></code></pre></div><h3 id=gson>Gson<a hidden class=anchor aria-hidden=true href=#gson>#</a></h3><p>Gson是一个用于在Java对象和JSON数据之间进行序列化和反序列化的库。它使用建造者模式来创建Gson对象。GsonBuilder类是一个建造者类，它包含了一系列的方法，用于配置Gson的行为，如设置日期格式、设置字段的命名策略等。</p><p>示例代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Gson</span> <span class=n>gson</span> <span class=o>=</span> <span class=k>new</span> <span class=n>GsonBuilder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>setDateFormat</span><span class=o>(</span><span class=s>&#34;yyyy-MM-dd&#39;T&#39;HH:mm:ssZ&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>setFieldNamingPolicy</span><span class=o>(</span><span class=n>FieldNamingPolicy</span><span class=o>.</span><span class=na>LOWER_CASE_WITH_UNDERSCORES</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>create</span><span class=o>();</span>
</span></span></code></pre></div><h3 id=apache-httpclient>Apache HttpClient<a hidden class=anchor aria-hidden=true href=#apache-httpclient>#</a></h3><p>Apache HttpClient是一个用于创建HTTP客户端的库，它使用建造者模式来创建HttpClient对象。HttpClientBuilder类是一个建造者类，它包含了一系列的方法，用于配置HttpClient的行为，如设置连接池、设置代理、设置Cookie管理器等。</p><p>示例代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>HttpClient</span> <span class=n>httpClient</span> <span class=o>=</span> <span class=n>HttpClientBuilder</span><span class=o>.</span><span class=na>create</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>setMaxConnTotal</span><span class=o>(</span><span class=mi>100</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>setMaxConnPerRoute</span><span class=o>(</span><span class=mi>10</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>setProxy</span><span class=o>(</span><span class=k>new</span> <span class=n>HttpHost</span><span class=o>(</span><span class=s>&#34;localhost&#34;</span><span class=o>,</span> <span class=mi>8080</span><span class=o>))</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>setDefaultCookieStore</span><span class=o>(</span><span class=k>new</span> <span class=n>BasicCookieStore</span><span class=o>())</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span></code></pre></div><h3 id=apache-kafka>Apache Kafka<a hidden class=anchor aria-hidden=true href=#apache-kafka>#</a></h3><p>Apache Kafka是一个分布式消息队列系统，它使用建造者模式来创建Producer和Consumer对象。ProducerConfig和ConsumerConfig类是建造者类，它们包含了一系列的方法，用于配置Producer和Consumer的行为，如设置broker地址、设置序列化器等。</p><p>示例代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Properties</span> <span class=n>producerProps</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Properties</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>producerProps</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>ProducerConfig</span><span class=o>.</span><span class=na>BOOTSTRAP_SERVERS_CONFIG</span><span class=o>,</span> <span class=s>&#34;localhost:9092&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>producerProps</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>ProducerConfig</span><span class=o>.</span><span class=na>KEY_SERIALIZER_CLASS_CONFIG</span><span class=o>,</span> <span class=n>StringSerializer</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>getName</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=n>producerProps</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>ProducerConfig</span><span class=o>.</span><span class=na>VALUE_SERIALIZER_CLASS_CONFIG</span><span class=o>,</span> <span class=n>StringSerializer</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>getName</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Producer</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>String</span><span class=o>&gt;</span> <span class=n>producer</span> <span class=o>=</span> <span class=k>new</span> <span class=n>KafkaProducer</span><span class=o>&lt;&gt;(</span><span class=n>producerProps</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Properties</span> <span class=n>consumerProps</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Properties</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>consumerProps</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>ConsumerConfig</span><span class=o>.</span><span class=na>BOOTSTRAP_SERVERS_CONFIG</span><span class=o>,</span> <span class=s>&#34;localhost:9092&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>consumerProps</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>ConsumerConfig</span><span class=o>.</span><span class=na>KEY_DESERIALIZER_CLASS_CONFIG</span><span class=o>,</span> <span class=n>StringDeserializer</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>getName</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=n>consumerProps</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>ConsumerConfig</span><span class=o>.</span><span class=na>VALUE_DESERIALIZER_CLASS_CONFIG</span><span class=o>,</span> <span class=n>StringDeserializer</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>getName</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=n>consumerProps</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>ConsumerConfig</span><span class=o>.</span><span class=na>GROUP_ID_CONFIG</span><span class=o>,</span> <span class=s>&#34;my-group&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Consumer</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>String</span><span class=o>&gt;</span> <span class=n>consumer</span> <span class=o>=</span> <span class=k>new</span> <span class=n>KafkaConsumer</span><span class=o>&lt;&gt;(</span><span class=n>consumerProps</span><span class=o>);</span>
</span></span></code></pre></div><h3 id=apache-commons-configuration>Apache Commons Configuration<a hidden class=anchor aria-hidden=true href=#apache-commons-configuration>#</a></h3><p>Apache Commons Configuration是一个用于读取和写入各种配置文件的库，它使用建造者模式来创建Configuration对象。ConfigurationBuilder类是一个建造者类，它包含了一系列的方法，用于配置Configuration的行为，如设置配置文件类型、设置属性的分隔符等。</p><p>示例代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Configuration</span> <span class=n>config</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ConfigurationBuilder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>setDelimiterParsingDisabled</span><span class=o>(</span><span class=kc>true</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>setFile</span><span class=o>(</span><span class=k>new</span> <span class=n>File</span><span class=o>(</span><span class=s>&#34;config.properties&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>setListDelimiterHandler</span><span class=o>(</span><span class=k>new</span> <span class=n>DefaultListDelimiterHandler</span><span class=o>(</span><span class=sc>&#39;,&#39;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span></code></pre></div><h3 id=guava>Guava<a hidden class=anchor aria-hidden=true href=#guava>#</a></h3><p>Guava是一个Google开发的Java库，它包含了许多实用的工具类和数据结构，其中包括使用建造者模式来创建的ImmutableList、ImmutableMap和ImmutableSet等不可变集合类。</p><p>示例代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>ImmutableList</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>list</span> <span class=o>=</span> <span class=n>ImmutableList</span><span class=o>.&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=n>builder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=s>&#34;foo&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=s>&#34;bar&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=s>&#34;baz&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ImmutableMap</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Integer</span><span class=o>&gt;</span> <span class=n>map</span> <span class=o>=</span> <span class=n>ImmutableMap</span><span class=o>.&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Integer</span><span class=o>&gt;</span><span class=n>builder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;foo&#34;</span><span class=o>,</span> <span class=mi>1</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;bar&#34;</span><span class=o>,</span> <span class=mi>2</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;baz&#34;</span><span class=o>,</span> <span class=mi>3</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ImmutableSet</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>set</span> <span class=o>=</span> <span class=n>ImmutableSet</span><span class=o>.&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=n>builder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=s>&#34;foo&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=s>&#34;bar&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=s>&#34;baz&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span></code></pre></div><h3 id=jpa>JPA<a hidden class=anchor aria-hidden=true href=#jpa>#</a></h3><p>Java Persistence API（JPA）是Java EE平台的一个ORM框架，它使用建造者模式来创建EntityManagerFactory对象。EntityManagerFactoryBuilder类是一个建造者类，它包含了一系列的方法，用于配置EntityManagerFactory的行为，如设置数据源、设置JPA的属性等。</p><p>示例代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>EntityManagerFactory</span> <span class=n>entityManagerFactory</span> <span class=o>=</span> <span class=k>new</span> <span class=n>EntityManagerFactoryBuilder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>dataSource</span><span class=o>(</span><span class=n>myDataSource</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>persistenceUnit</span><span class=o>(</span><span class=s>&#34;myPersistenceUnit&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>properties</span><span class=o>(</span><span class=n>myProperties</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span></code></pre></div><h3 id=spring-framework>Spring Framework<a hidden class=anchor aria-hidden=true href=#spring-framework>#</a></h3><p>Spring Framework是一个Java平台上的开源应用程序框架，它使用建造者模式来创建RestTemplate和HttpHeaders对象。RestTemplateBuilder和HttpHeadersBuilder类是建造者类，它们包含了一系列的方法，用于配置RestTemplate和HttpHeaders的行为，如设置连接超时、设置请求头等。</p><p>示例代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>RestTemplate</span> <span class=n>restTemplate</span> <span class=o>=</span> <span class=k>new</span> <span class=n>RestTemplateBuilder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>setConnectTimeout</span><span class=o>(</span><span class=n>Duration</span><span class=o>.</span><span class=na>ofSeconds</span><span class=o>(</span><span class=mi>10</span><span class=o>))</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>setReadTimeout</span><span class=o>(</span><span class=n>Duration</span><span class=o>.</span><span class=na>ofSeconds</span><span class=o>(</span><span class=mi>10</span><span class=o>))</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>HttpHeaders</span> <span class=n>headers</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HttpHeadersBuilder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>setContentType</span><span class=o>(</span><span class=n>MediaType</span><span class=o>.</span><span class=na>APPLICATION_JSON</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span></code></pre></div><h2 id=优化>优化<a hidden class=anchor aria-hidden=true href=#优化>#</a></h2><p>建造者模式的优化主要包括以下几个方面：</p><h3 id=使用静态内部类优化建造者模式>使用静态内部类优化建造者模式<a hidden class=anchor aria-hidden=true href=#使用静态内部类优化建造者模式>#</a></h3><p>建造者模式通常使用一个Builder类来构建复杂对象，为了避免Builder类变得过于臃肿，可以将其设计为静态内部类，这样可以使代码更加清晰，同时也能够保证线程安全。</p><h3 id=使用流式接口优化建造者模式>使用流式接口优化建造者模式<a hidden class=anchor aria-hidden=true href=#使用流式接口优化建造者模式>#</a></h3><p>流式接口是一种链式调用的方式，它可以将多个方法调用连接起来，形成一个链式结构，使得代码更加简洁易读。在建造者模式中，可以使用流式接口来优化Builder类，使得客户端可以通过链式调用的方式来创建复杂对象，从而简化代码。</p><h3 id=使用默认值优化建造者模式>使用默认值优化建造者模式<a hidden class=anchor aria-hidden=true href=#使用默认值优化建造者模式>#</a></h3><p>在建造者模式中，有些属性是必须的，而有些属性是可选的，可以使用默认值来为可选属性设置默认值，从而避免客户端必须为每个可选属性都提供值的情况，同时也能够简化客户端代码。</p><h3 id=使用java-8中的optional类优化建造者模式>使用Java 8中的Optional类优化建造者模式<a hidden class=anchor aria-hidden=true href=#使用java-8中的optional类优化建造者模式>#</a></h3><p>Java 8中引入了Optional类，该类可以用于处理可能为null的值，可以进一步优化建造者模式中的代码。</p><p>在建造者模式中，我们通常需要设置多个属性，其中有些属性可能是可选的，如果直接使用null来表示可选属性的值，可能会导致代码出现空指针异常，而使用Optional类可以避免这个问题。</p><p>下面是一个使用Optional类优化建造者模式的示例代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.Optional</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Computer</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>cpu</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>memory</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>hardDisk</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>graphicsCard</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=nf>Computer</span><span class=o>(</span><span class=n>ComputerBuilder</span> <span class=n>builder</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>cpu</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>cpu</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>memory</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>memory</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>hardDisk</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>hardDisk</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>graphicsCard</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>graphicsCard</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 省略getter方法
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>ComputerBuilder</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=n>String</span> <span class=n>cpu</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=n>String</span> <span class=n>memory</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=n>String</span> <span class=n>hardDisk</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>graphicsCard</span> <span class=o>=</span> <span class=n>Optional</span><span class=o>.</span><span class=na>empty</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>ComputerBuilder</span> <span class=nf>setCpu</span><span class=o>(</span><span class=n>String</span> <span class=n>cpu</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>cpu</span> <span class=o>=</span> <span class=n>cpu</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>ComputerBuilder</span> <span class=nf>setMemory</span><span class=o>(</span><span class=n>String</span> <span class=n>memory</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>memory</span> <span class=o>=</span> <span class=n>memory</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>ComputerBuilder</span> <span class=nf>setHardDisk</span><span class=o>(</span><span class=n>String</span> <span class=n>hardDisk</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>hardDisk</span> <span class=o>=</span> <span class=n>hardDisk</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>ComputerBuilder</span> <span class=nf>setGraphicsCard</span><span class=o>(</span><span class=n>String</span> <span class=n>graphicsCard</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>graphicsCard</span> <span class=o>=</span> <span class=n>Optional</span><span class=o>.</span><span class=na>ofNullable</span><span class=o>(</span><span class=n>graphicsCard</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>Computer</span> <span class=nf>build</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>new</span> <span class=n>Computer</span><span class=o>(</span><span class=k>this</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>在这个示例代码中，我们使用 <code>Optional</code> 类来表示可选属性的值，将graphicsCard属性的类型改为<code>Optional&lt;String></code>。在 ComputerBuilder 类中，我们使用 <code>Optional.ofNullable </code>方法来将可选属性的值转换为 Optional 对象，并在调用 build 方法时，将 Optional 对象转换为普通的字符串类型。</p><h3 id=使用-lambda表达式优化建造者模式>使用 Lambda表达式优化建造者模式<a hidden class=anchor aria-hidden=true href=#使用-lambda表达式优化建造者模式>#</a></h3><p>Lambda表达式是Java 8中引入的一种新的语言特性，可以进一步优化建造者模式中的代码，使得代码更加简洁易读。</p><p>在建造者模式中，我们通常需要定义多个属性，并在构造方法中进行初始化。使用Lambda表达式可以避免定义多个属性的问题，将属性的赋值操作通过Lambda表达式传递给构造方法。</p><p>下面是一个使用Lambda表达式优化建造者模式的示例代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.Optional</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.function.Consumer</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Computer</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>cpu</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>memory</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>hardDisk</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>graphicsCard</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=nf>Computer</span><span class=o>(</span><span class=n>Consumer</span><span class=o>&lt;</span><span class=n>ComputerBuilder</span><span class=o>&gt;</span> <span class=n>builder</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>ComputerBuilder</span> <span class=n>computerBuilder</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ComputerBuilder</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>builder</span><span class=o>.</span><span class=na>accept</span><span class=o>(</span><span class=n>computerBuilder</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>cpu</span> <span class=o>=</span> <span class=n>computerBuilder</span><span class=o>.</span><span class=na>cpu</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>memory</span> <span class=o>=</span> <span class=n>computerBuilder</span><span class=o>.</span><span class=na>memory</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>hardDisk</span> <span class=o>=</span> <span class=n>computerBuilder</span><span class=o>.</span><span class=na>hardDisk</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>graphicsCard</span> <span class=o>=</span> <span class=n>computerBuilder</span><span class=o>.</span><span class=na>graphicsCard</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 省略getter方法
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>ComputerBuilder</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=n>String</span> <span class=n>cpu</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=n>String</span> <span class=n>memory</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=n>String</span> <span class=n>hardDisk</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>graphicsCard</span> <span class=o>=</span> <span class=n>Optional</span><span class=o>.</span><span class=na>empty</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>ComputerBuilder</span> <span class=nf>setCpu</span><span class=o>(</span><span class=n>String</span> <span class=n>cpu</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>cpu</span> <span class=o>=</span> <span class=n>cpu</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>ComputerBuilder</span> <span class=nf>setMemory</span><span class=o>(</span><span class=n>String</span> <span class=n>memory</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>memory</span> <span class=o>=</span> <span class=n>memory</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>ComputerBuilder</span> <span class=nf>setHardDisk</span><span class=o>(</span><span class=n>String</span> <span class=n>hardDisk</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>hardDisk</span> <span class=o>=</span> <span class=n>hardDisk</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>ComputerBuilder</span> <span class=nf>setGraphicsCard</span><span class=o>(</span><span class=n>String</span> <span class=n>graphicsCard</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>graphicsCard</span> <span class=o>=</span> <span class=n>Optional</span><span class=o>.</span><span class=na>ofNullable</span><span class=o>(</span><span class=n>graphicsCard</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Computer</span> <span class=n>computer</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Computer</span><span class=o>(</span><span class=n>builder</span> <span class=o>-&gt;</span> <span class=n>builder</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>setCpu</span><span class=o>(</span><span class=s>&#34;Intel i7&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>setMemory</span><span class=o>(</span><span class=s>&#34;16GB&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>setHardDisk</span><span class=o>(</span><span class=s>&#34;512GB SSD&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>setGraphicsCard</span><span class=o>(</span><span class=s>&#34;NVIDIA GTX 1660&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>在这个示例代码中，我们将 Computer 类的构造方法改为接收一个 <code>Consumer&lt;ComputerBuilder> </code>类型的参数，这个参数表示一个包含属性赋值操作的 Lambda 表达式。在构造方法中，我们先创建一个ComputerBuilder 对象，然后通过 Lambda 表达式调用 ComputerBuilder 对象的方法来设置属性值，并最终通过 ComputerBuilder 对象创建 Computer 对象。</p><h3 id=使用泛型和反射优化>使用泛型和反射优化<a hidden class=anchor aria-hidden=true href=#使用泛型和反射优化>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>class</span> <span class=nc>EntityCreator</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Class</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>classInstance</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>T</span> <span class=n>entityObj</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>EntityCreator</span><span class=o>(</span><span class=n>Class</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>classInstance</span><span class=o>,</span> <span class=n>Object</span><span class=o>...</span> <span class=n>initParams</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>classInstance</span> <span class=o>=</span> <span class=n>classInstance</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Class</span><span class=o>&lt;?&gt;[]</span> <span class=n>paramTypes</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Class</span><span class=o>&lt;?&gt;[</span><span class=n>initParams</span><span class=o>.</span><span class=na>length</span><span class=o>];</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>index</span> <span class=o>=</span> <span class=mi>0</span><span class=o>,</span> <span class=n>length</span> <span class=o>=</span> <span class=n>initParams</span><span class=o>.</span><span class=na>length</span><span class=o>;</span> <span class=n>index</span> <span class=o>&lt;</span> <span class=n>length</span><span class=o>;</span> <span class=n>index</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>String</span> <span class=n>checkStr</span> <span class=o>=</span> <span class=n>initParams</span><span class=o>[</span><span class=n>index</span><span class=o>].</span><span class=na>getClass</span><span class=o>().</span><span class=na>getSimpleName</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=o>(</span><span class=n>checkStr</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=s>&#34;Integer&#34;</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>paramTypes</span><span class=o>[</span><span class=n>index</span><span class=o>]</span> <span class=o>=</span> <span class=kt>int</span><span class=o>.</span><span class=na>class</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=o>(</span><span class=n>checkStr</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=s>&#34;Double&#34;</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>paramTypes</span><span class=o>[</span><span class=n>index</span><span class=o>]</span> <span class=o>=</span> <span class=kt>double</span><span class=o>.</span><span class=na>class</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=o>(</span><span class=n>checkStr</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=s>&#34;Boolean&#34;</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>paramTypes</span><span class=o>[</span><span class=n>index</span><span class=o>]</span> <span class=o>=</span> <span class=kt>boolean</span><span class=o>.</span><span class=na>class</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=o>(</span><span class=n>checkStr</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=s>&#34;String&#34;</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>paramTypes</span><span class=o>[</span><span class=n>index</span><span class=o>]</span> <span class=o>=</span> <span class=n>initParams</span><span class=o>[</span><span class=n>index</span><span class=o>].</span><span class=na>getClass</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=n>Constructor</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>constructor</span> <span class=o>=</span> <span class=n>classInstance</span><span class=o>.</span><span class=na>getDeclaredConstructor</span><span class=o>(</span><span class=n>paramTypes</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>constructor</span><span class=o>.</span><span class=na>setAccessible</span><span class=o>(</span><span class=kc>true</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>entityObj</span> <span class=o>=</span> <span class=n>constructor</span><span class=o>.</span><span class=na>newInstance</span><span class=o>(</span><span class=n>initParams</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>EntityCreator</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=nf>setValue</span><span class=o>(</span><span class=n>String</span> <span class=n>paramName</span><span class=o>,</span> <span class=n>Object</span> <span class=n>paramValue</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Field</span> <span class=n>field</span> <span class=o>=</span> <span class=n>classInstance</span><span class=o>.</span><span class=na>getDeclaredField</span><span class=o>(</span><span class=n>paramName</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>field</span><span class=o>.</span><span class=na>setAccessible</span><span class=o>(</span><span class=kc>true</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>field</span><span class=o>.</span><span class=na>set</span><span class=o>(</span><span class=n>entityObj</span><span class=o>,</span> <span class=n>paramValue</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>T</span> <span class=nf>build</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>entityObj</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>​ 如此，可移除整个内部 Builder 类，NutritionFacts 类私有构造的参数仅包括两个必填的 servingSize、servings 字段：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>NutritionFacts</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Required parameters
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>servingSize</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>servings</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Optional parameters - initialized to default values
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>calories</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>fat</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>sodium</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>carbohydrate</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=nf>NutritionFacts</span><span class=o>(</span><span class=kt>int</span> <span class=n>servingSize</span><span class=o>,</span> <span class=kt>int</span> <span class=n>servings</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>servingSize</span> <span class=o>=</span> <span class=n>servingSize</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>servings</span> <span class=o>=</span> <span class=n>servings</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>该案例的客户端代码改为：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>NutritionFacts</span> <span class=n>cocaCola</span> <span class=o>=</span> <span class=k>new</span> <span class=n>EntityCreator</span><span class=o>&lt;&gt;(</span><span class=n>NutritionFacts</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=mi>240</span><span class=o>,</span> <span class=mi>8</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>setValue</span><span class=o>(</span><span class=s>&#34;calories&#34;</span><span class=o>,</span> <span class=mi>100</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>setValue</span><span class=o>(</span><span class=s>&#34;sodium&#34;</span><span class=o>,</span> <span class=mi>35</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>setValue</span><span class=o>(</span><span class=s>&#34;carbohydrate&#34;</span><span class=o>,</span> <span class=mi>27</span><span class=o>).</span><span class=na>build</span><span class=o>();</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.chensoul.com/tags/java/>java</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://blog.chensoul.com/>ChenSoul</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script async src=https://umami.chensoul.com/script.js data-website-id=f110cfa0-b737-4690-a032-2b9073a57fc3></script>
<script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>