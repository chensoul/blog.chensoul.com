<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>《Effective Java 3》笔记2：使用构造器代替构造方法 | ChenSoul</title><meta name=keywords content="java"><meta name=description content="本文是 《Effective Java 3》第二章的学习笔记，在整理笔记过程中，通过 chatgpt 的帮助做了一些扩展。
介绍 当一个类需要多个构造函数参数时，可以考虑使用构建器模式来创建对象。构建器模式是一种创建对象的设计模式，它可以通过链式调用方法的方式来设置对象的构造参数，并最终返回一个构造完整的对象。
优点 使用构建器模式的原因有以下几点：
避免构造函数参数过多的问题：当一个类需要多个构造函数参数时，构造函数的参数列表可能会变得很长，这会导致代码难以理解和维护。使用构建器模式可以将构造函数参数拆分成多个方法，从而使代码更加清晰易懂。 提高代码的可读性和可维护性：使用构建器模式可以使代码更加易懂和易维护，因为可以通过方法名来清晰地表达每个参数的含义。 提供更多的灵活性和可定制性：构建器模式可以提供更多的灵活性和可定制性，因为可以在构造对象时进行更多的逻辑处理和判断。例如，可以在构建器中添加验证逻辑，以确保参数的有效性。 支持多线程环境：构建器模式可以支持多线程环境，因为每个构建器都是独立的，不会受到其他线程的影响。 以下是一个例子：
public class NutritionFacts { private final int servingSize; private final int servings; private final int calories; private final int fat; private final int sodium; private final int carbohydrate; private NutritionFacts(Builder builder) { this.servingSize = builder.servingSize; this.servings = builder.servings; this.calories = builder.calories; this.fat = builder.fat; this.sodium = builder.sodium; this.carbohydrate = builder.carbohydrate; } //省略 get set public static class Builder { // Required parameters private final int servingSize; private final int servings; // Optional parameters - initialized to default values private int calories = 0; private int fat = 0; private int sodium = 0; private int carbohydrate = 0; public Builder(int servingSize, int servings) { this."><meta name=author content="chensoul"><link rel=canonical href=https://blog.chensoul.com/posts/2023/04/03/builder-instead-of-constructors/><link crossorigin=anonymous href=/assets/css/stylesheet.min.c0bdcf61a84b821409b092c03af60edc8ea542c6d2dc20cff93150bcfd67d65d.css integrity="sha256-wL3PYahLghQJsJLAOvYO3I6lQsbS3CDP+TFQvP1n1l0=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.chensoul.com/favicon.ico><link rel=apple-touch-icon href=https://blog.chensoul.com/apple-touch-icon.png><meta name=twitter:title content="《Effective Java 3》笔记2：使用构造器代替构造方法 | ChenSoul"><meta name=twitter:description content="本文是 《Effective Java 3》第二章的学习笔记，在整理笔记过程中，通过 chatgpt 的帮助做了一些扩展。
介绍 当一个类需要多个构造函数参数时，可以考虑使用构建器模式来创建对象。构建器模式是一种创建对象的设计模式，它可以通过链式调用方法的方式来设置对象的构造参数，并最终返回一个构造完整的对象。
优点 使用构建器模式的原因有以下几点：
避免构造函数参数过多的问题：当一个类需要多个构造函数参数时，构造函数的参数列表可能会变得很长，这会导致代码难以理解和维护。使用构建器模式可以将构造函数参数拆分成多个方法，从而使代码更加清晰易懂。 提高代码的可读性和可维护性：使用构建器模式可以使代码更加易懂和易维护，因为可以通过方法名来清晰地表达每个参数的含义。 提供更多的灵活性和可定制性：构建器模式可以提供更多的灵活性和可定制性，因为可以在构造对象时进行更多的逻辑处理和判断。例如，可以在构建器中添加验证逻辑，以确保参数的有效性。 支持多线程环境：构建器模式可以支持多线程环境，因为每个构建器都是独立的，不会受到其他线程的影响。 以下是一个例子：
public class NutritionFacts { private final int servingSize; private final int servings; private final int calories; private final int fat; private final int sodium; private final int carbohydrate; private NutritionFacts(Builder builder) { this.servingSize = builder.servingSize; this.servings = builder.servings; this.calories = builder.calories; this.fat = builder.fat; this.sodium = builder.sodium; this.carbohydrate = builder.carbohydrate; } //省略 get set public static class Builder { // Required parameters private final int servingSize; private final int servings; // Optional parameters - initialized to default values private int calories = 0; private int fat = 0; private int sodium = 0; private int carbohydrate = 0; public Builder(int servingSize, int servings) { this."><meta property="og:title" content="《Effective Java 3》笔记2：使用构造器代替构造方法 | ChenSoul"><meta property="og:description" content="本文是 《Effective Java 3》第二章的学习笔记，在整理笔记过程中，通过 chatgpt 的帮助做了一些扩展。
介绍 当一个类需要多个构造函数参数时，可以考虑使用构建器模式来创建对象。构建器模式是一种创建对象的设计模式，它可以通过链式调用方法的方式来设置对象的构造参数，并最终返回一个构造完整的对象。
优点 使用构建器模式的原因有以下几点：
避免构造函数参数过多的问题：当一个类需要多个构造函数参数时，构造函数的参数列表可能会变得很长，这会导致代码难以理解和维护。使用构建器模式可以将构造函数参数拆分成多个方法，从而使代码更加清晰易懂。 提高代码的可读性和可维护性：使用构建器模式可以使代码更加易懂和易维护，因为可以通过方法名来清晰地表达每个参数的含义。 提供更多的灵活性和可定制性：构建器模式可以提供更多的灵活性和可定制性，因为可以在构造对象时进行更多的逻辑处理和判断。例如，可以在构建器中添加验证逻辑，以确保参数的有效性。 支持多线程环境：构建器模式可以支持多线程环境，因为每个构建器都是独立的，不会受到其他线程的影响。 以下是一个例子：
public class NutritionFacts { private final int servingSize; private final int servings; private final int calories; private final int fat; private final int sodium; private final int carbohydrate; private NutritionFacts(Builder builder) { this.servingSize = builder.servingSize; this.servings = builder.servings; this.calories = builder.calories; this.fat = builder.fat; this.sodium = builder.sodium; this.carbohydrate = builder.carbohydrate; } //省略 get set public static class Builder { // Required parameters private final int servingSize; private final int servings; // Optional parameters - initialized to default values private int calories = 0; private int fat = 0; private int sodium = 0; private int carbohydrate = 0; public Builder(int servingSize, int servings) { this."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.chensoul.com/posts/2023/04/03/builder-instead-of-constructors/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-04-03T16:00:00+08:00"><meta property="article:modified_time" content="2023-04-03T16:00:00+08:00"><meta property="og:site_name" content="ChenSoul"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.chensoul.com/posts/"},{"@type":"ListItem","position":2,"name":"《Effective Java 3》笔记2：使用构造器代替构造方法","item":"https://blog.chensoul.com/posts/2023/04/03/builder-instead-of-constructors/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"《Effective Java 3》笔记2：使用构造器代替构造方法 | ChenSoul","name":"《Effective Java 3》笔记2：使用构造器代替构造方法","description":"本文是 《Effective Java 3》第二章的学习笔记，在整理笔记过程中，通过 chatgpt 的帮助做了一些扩展。\n介绍 当一个类需要多个构造函数参数时，可以考虑使用构建器模式来创建对象。构建器模式是一种创建对象的设计模式，它可以通过链式调用方法的方式来设置对象的构造参数，并最终返回一个构造完整的对象。\n优点 使用构建器模式的原因有以下几点：\n避免构造函数参数过多的问题：当一个类需要多个构造函数参数时，构造函数的参数列表可能会变得很长，这会导致代码难以理解和维护。使用构建器模式可以将构造函数参数拆分成多个方法，从而使代码更加清晰易懂。 提高代码的可读性和可维护性：使用构建器模式可以使代码更加易懂和易维护，因为可以通过方法名来清晰地表达每个参数的含义。 提供更多的灵活性和可定制性：构建器模式可以提供更多的灵活性和可定制性，因为可以在构造对象时进行更多的逻辑处理和判断。例如，可以在构建器中添加验证逻辑，以确保参数的有效性。 支持多线程环境：构建器模式可以支持多线程环境，因为每个构建器都是独立的，不会受到其他线程的影响。 以下是一个例子：\npublic class NutritionFacts { private final int servingSize; private final int servings; private final int calories; private final int fat; private final int sodium; private final int carbohydrate; private NutritionFacts(Builder builder) { this.servingSize = builder.servingSize; this.servings = builder.servings; this.calories = builder.calories; this.fat = builder.fat; this.sodium = builder.sodium; this.carbohydrate = builder.carbohydrate; } //省略 get set public static class Builder { // Required parameters private final int servingSize; private final int servings; // Optional parameters - initialized to default values private int calories = 0; private int fat = 0; private int sodium = 0; private int carbohydrate = 0; public Builder(int servingSize, int servings) { this.","keywords":["java"],"wordCount":"2000","inLanguage":"en","datePublished":"2023-04-03T16:00:00+08:00","dateModified":"2023-04-03T16:00:00+08:00","author":[{"@type":"Person","name":"chensoul"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.chensoul.com/posts/2023/04/03/builder-instead-of-constructors/"},"publisher":{"@type":"Organization","name":"ChenSoul","logo":{"@type":"ImageObject","url":"https://blog.chensoul.com/favicon.ico"}}}</script><meta name=baidu-site-verification content="codeva-FYpQY8JdLU"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary-bg:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list-page{background:var(--theme)}.list-page:not(.dark)::-webkit-scrollbar-track{background:0 0}.list-page:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript></head><body class="type-posts kind-page layout-" id=top><script data-no-instant>function switchTheme(e){switch(e){case"light":document.body.classList.remove("dark");break;case"dark":document.body.classList.add("dark");break;default:window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")}}function isDarkTheme(){return document.body.className.includes("dark")}function getPrefTheme(){return localStorage.getItem("pref-theme")}function setPrefTheme(e){switchTheme(e),localStorage.setItem("pref-theme",e)}const toggleThemeCallbacks={};toggleThemeCallbacks.main=e=>{setPrefTheme(e?"light":"dark")},window.addEventListener("toggle-theme",function(){const e=isDarkTheme();for(const t in toggleThemeCallbacks)toggleThemeCallbacks[t](e)});function toggleThemeListener(){window.dispatchEvent(new CustomEvent("toggle-theme"))}</script><script>(function(){const t="auto",e=getPrefTheme(),n=e||t;switchTheme(n)})()</script><header class=header><nav class=nav><div class=logo><a href=https://blog.chensoul.com/ accesskey=h title="ChenSoul (Alt + H)">ChenSoul</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://blog.chensoul.com/categories/weekly/ title=周报>周报</a></li><li><a href=https://blog.chensoul.com/categories/ title=分类>分类</a></li><li><a href=https://blog.chensoul.com/tags/ title=标签>标签</a></li><li><a href=https://github.com/chensoul/ title=关于 target=_blank>关于<span class=external-link><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-external-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M11 7H6A2 2 0 004 9v9a2 2 0 002 2h9a2 2 0 002-2v-5"/><line x1="10" y1="14" x2="20" y2="4"/><polyline points="15 4 20 4 20 9"/></svg></span></a></li></ul></nav></header><main class="main post"><article class=post-single><header class=post-header><h1 class=post-title>《Effective Java 3》笔记2：使用构造器代替构造方法</h1><div class=post-meta><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>2023-04-03</span></span><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon" style="user-select:text"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z" style="user-select:text"/><line x1="7" y1="7" x2="7" y2="7" style="user-select:text"/></svg>
<span class=post-tags><a href=https://blog.chensoul.com/tags/java/>java</a></span></span><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>10 min</span></span></div></header><div class="toc side right"><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e4%bb%8b%e7%bb%8d aria-label=介绍>介绍</a></li><li><a href=#%e4%bc%98%e7%82%b9 aria-label=优点>优点</a></li><li><a href=#%e7%bc%ba%e7%82%b9 aria-label=缺点>缺点</a></li><li><a href=#%e5%b1%82%e6%ac%a1%e6%9e%84%e5%bb%ba%e5%99%a8 aria-label=层次构建器>层次构建器</a><ul><li><a href=#%e4%bd%bf%e7%94%a8 aria-label=使用>使用</a><ul><li><a href=#%e4%b8%be%e4%be%8b-1 aria-label="举例 1">举例 1</a></li><li><a href=#%e4%b8%be%e4%be%8b-2 aria-label="举例 2">举例 2</a></li></ul></li></ul></li><li><a href=#%e4%bd%bf%e7%94%a8-1 aria-label=使用>使用</a><ul><li><a href=#retrofit aria-label=Retrofit>Retrofit</a></li><li><a href=#gson aria-label=Gson>Gson</a></li><li><a href=#apache-httpclient aria-label="Apache HttpClient">Apache HttpClient</a></li><li><a href=#apache-kafka aria-label="Apache Kafka">Apache Kafka</a></li><li><a href=#apache-commons-configuration aria-label="Apache Commons Configuration">Apache Commons Configuration</a></li><li><a href=#guava aria-label=Guava>Guava</a></li><li><a href=#jpa aria-label=JPA>JPA</a></li><li><a href=#spring-framework aria-label="Spring Framework">Spring Framework</a></li></ul></li><li><a href=#%e4%bc%98%e5%8c%96 aria-label=优化>优化</a><ul><li><a href=#%e4%bd%bf%e7%94%a8%e9%9d%99%e6%80%81%e5%86%85%e9%83%a8%e7%b1%bb%e4%bc%98%e5%8c%96%e5%bb%ba%e9%80%a0%e8%80%85%e6%a8%a1%e5%bc%8f aria-label=使用静态内部类优化建造者模式>使用静态内部类优化建造者模式</a></li><li><a href=#%e4%bd%bf%e7%94%a8%e6%b5%81%e5%bc%8f%e6%8e%a5%e5%8f%a3%e4%bc%98%e5%8c%96%e5%bb%ba%e9%80%a0%e8%80%85%e6%a8%a1%e5%bc%8f aria-label=使用流式接口优化建造者模式>使用流式接口优化建造者模式</a></li><li><a href=#%e4%bd%bf%e7%94%a8%e9%bb%98%e8%ae%a4%e5%80%bc%e4%bc%98%e5%8c%96%e5%bb%ba%e9%80%a0%e8%80%85%e6%a8%a1%e5%bc%8f aria-label=使用默认值优化建造者模式>使用默认值优化建造者模式</a></li><li><a href=#%e4%bd%bf%e7%94%a8-java-8-%e4%b8%ad%e7%9a%84-optional-%e7%b1%bb%e4%bc%98%e5%8c%96%e5%bb%ba%e9%80%a0%e8%80%85%e6%a8%a1%e5%bc%8f aria-label="使用 Java 8 中的 Optional 类优化建造者模式">使用 Java 8 中的 Optional 类优化建造者模式</a></li><li><a href=#%e4%bd%bf%e7%94%a8-lambda-%e8%a1%a8%e8%be%be%e5%bc%8f%e4%bc%98%e5%8c%96%e5%bb%ba%e9%80%a0%e8%80%85%e6%a8%a1%e5%bc%8f aria-label="使用 Lambda 表达式优化建造者模式">使用 Lambda 表达式优化建造者模式</a></li><li><a href=#%e4%bd%bf%e7%94%a8%e6%b3%9b%e5%9e%8b%e5%92%8c%e5%8f%8d%e5%b0%84%e4%bc%98%e5%8c%96 aria-label=使用泛型和反射优化>使用泛型和反射优化</a></li></ul></li></ul></div></details></div><div class=post-content><p>本文是 《Effective Java 3》第二章的学习笔记，在整理笔记过程中，通过 chatgpt 的帮助做了一些扩展。</p><h2 id=介绍>介绍</h2><p>当一个类需要多个构造函数参数时，可以考虑使用<strong>构建器模式</strong>来创建对象。构建器模式是一种创建对象的设计模式，它可以通过链式调用方法的方式来设置对象的构造参数，并最终返回一个构造完整的对象。</p><h2 id=优点>优点</h2><p>使用构建器模式的原因有以下几点：</p><ol><li>避免构造函数参数过多的问题：当一个类需要多个构造函数参数时，构造函数的参数列表可能会变得很长，这会导致代码难以理解和维护。使用构建器模式可以将构造函数参数拆分成多个方法，从而使代码更加清晰易懂。</li><li>提高代码的可读性和可维护性：使用构建器模式可以使代码更加易懂和易维护，因为可以通过方法名来清晰地表达每个参数的含义。</li><li>提供更多的灵活性和可定制性：构建器模式可以提供更多的灵活性和可定制性，因为可以在构造对象时进行更多的逻辑处理和判断。例如，可以在构建器中添加验证逻辑，以确保参数的有效性。</li><li>支持多线程环境：构建器模式可以支持多线程环境，因为每个构建器都是独立的，不会受到其他线程的影响。</li></ol><p>以下是一个例子：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>NutritionFacts</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>servingSize</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>servings</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>calories</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>fat</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>sodium</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>carbohydrate</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=nf>NutritionFacts</span><span class=o>(</span><span class=n>Builder</span> <span class=n>builder</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>servingSize</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>servingSize</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>servings</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>servings</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>calories</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>calories</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>fat</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>fat</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>sodium</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>sodium</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>carbohydrate</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>carbohydrate</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>//省略 get set
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>Builder</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Required parameters
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>servingSize</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>servings</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Optional parameters - initialized to default values
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kd>private</span> <span class=kt>int</span> <span class=n>calories</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=kt>int</span> <span class=n>fat</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=kt>int</span> <span class=n>sodium</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=kt>int</span> <span class=n>carbohydrate</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=nf>Builder</span><span class=o>(</span><span class=kt>int</span> <span class=n>servingSize</span><span class=o>,</span> <span class=kt>int</span> <span class=n>servings</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>servingSize</span> <span class=o>=</span> <span class=n>servingSize</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>servings</span> <span class=o>=</span> <span class=n>servings</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>Builder</span> <span class=nf>calories</span><span class=o>(</span><span class=kt>int</span> <span class=n>calories</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>calories</span> <span class=o>=</span> <span class=n>calories</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>Builder</span> <span class=nf>fat</span><span class=o>(</span><span class=kt>int</span> <span class=n>fat</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>fat</span> <span class=o>=</span> <span class=n>fat</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>Builder</span> <span class=nf>sodium</span><span class=o>(</span><span class=kt>int</span> <span class=n>sodium</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>sodium</span> <span class=o>=</span> <span class=n>sodium</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>Builder</span> <span class=nf>carbohydrate</span><span class=o>(</span><span class=kt>int</span> <span class=n>carbohydrate</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>carbohydrate</span> <span class=o>=</span> <span class=n>carbohydrate</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>NutritionFacts</span> <span class=nf>build</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>new</span> <span class=n>NutritionFacts</span><span class=o>(</span><span class=k>this</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>在上述示例中，我们定义了一个名为 NutritionFacts 的类，它包含了一些营养成分的信息，例如每份的大小、总份数、卡路里、脂肪、钠和碳水化合物等成员变量。我们还定义了一个名为 Builder 的静态内部类，用于构建 NutritionFacts 对象。</p><p>在 Builder 类中，我们定义了一个带有两个参数的构造方法，并在其中初始化了必需的成员变量 servingSize 和 servings。我们还定义了一些可选的方法，用于设置 NutritionFacts 对象的卡路里、脂肪、钠和碳水化合物等成员变量。这些方法都支持链式调用，并返回 Builder 对象本身，以便进行多次方法调用。</p><p>在 Builder 类中，我们最终定义了一个 build() 方法，用于创建 NutritionFacts 对象并返回。在 build() 方法中，我们调用 NutritionFacts 的私有构造器并将 Builder 对象作为参数传递进去，从而创建 NutritionFacts 对象并初始化其成员变量。</p><p>现在，我们可以使用 NutritionFacts.Builder 类来创建 NutritionFacts 对象，并使用链式调用来设置 NutritionFacts 对象的成员变量。例如，我们可以使用以下代码来创建一个每份大小为 240ml、总共有 8 份、卡路里为 100、脂肪为 2、钠为 35、碳水化合物为 27 的 NutritionFacts 对象：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>NutritionFacts</span> <span class=n>cocaCola</span> <span class=o>=</span> <span class=k>new</span> <span class=n>NutritionFacts</span><span class=o>.</span><span class=na>Builder</span><span class=o>(</span><span class=mi>240</span><span class=o>,</span> <span class=mi>8</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>calories</span><span class=o>(</span><span class=mi>100</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>fat</span><span class=o>(</span><span class=mi>2</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>sodium</span><span class=o>(</span><span class=mi>35</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>carbohydrate</span><span class=o>(</span><span class=mi>27</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span></code></pre></div><p>在上述代码中，我们首先创建了一个 NutritionFacts.Builder 对象，并在构造函数中传递了每份大小和总份数等参数。然后，我们使用链式调用来设置卡路里、脂肪、钠和碳水化合物等成员变量，并最终调用 build() 方法来创建 NutritionFacts 对象。</p><p>可以使用 lombok 注解来简化代码，但是，<strong>无法在构造器的构造方法里设置必要参数。</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span> <span class=nn>lombok.Builder</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Builder</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>NutritionFacts</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>servingSize</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>servings</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>calories</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>fat</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>sodium</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>carbohydrate</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=缺点>缺点</h2><p>虽然构建器模式可以提高代码的可读性、可维护性以及提供更多的灵活性和可定制性，但它也有一些缺点，包括：</p><ol><li>增加代码复杂度：使用构建器模式会增加代码的复杂度，因为需要创建一个独立的构建器类，并且需要在构建器类中定义多个方法来设置对象的属性。这会增加代码量并且需要更多的时间来编写和维护代码。</li><li>增加内存开销：使用构建器模式需要创建一个独立的构建器对象，并且需要在构建器对象中保存对象的属性。这会增加内存开销，并且在创建对象时需要更多的时间和资源。</li><li>对于简单对象不适用：构建器模式更适用于构造复杂对象，对于简单对象来说，使用构建器模式可能会增加代码的复杂度和开销。</li><li>需要额外的代码：使用构建器模式需要编写额外的代码来创建构建器类和定义方法。如果只需要构造一个简单的对象，使用构建器模式可能会浪费时间和资源。</li></ol><h2 id=层次构建器>层次构建器</h2><p>层次构建器（Hierarchical Builder）是一种构建器模式的扩展，它允许创建层次结构的对象，并支持在父对象中嵌套子对象。它通常由一个抽象的构建器接口，多个具体的构建器实现和一个指导者（Director）组成。</p><p>在层次构建器中，每个构建器都负责创建特定类型的对象，并且可以在其构建方法中调用其他构建器的构建方法来创建嵌套的子对象。指导者负责协调构建器的顺序和调用构建器的方法来构建对象层次结构。</p><p>层次构建器模式的优点包括：</p><ol><li>支持创建复杂的对象层次结构，能够构建包含多个层次和嵌套子对象的对象。</li><li>提供了更好的可读性和可维护性，因为每个构建器都只需要关注一个特定类型的对象，而且可以通过方法名来清晰地表达每个参数的含义。</li><li>提供了更多的灵活性和可定制性，因为可以在构建器中添加验证逻辑，以确保参数的有效性，并且可以动态地组合构建器来创建不同类型的对象。</li></ol><p>层次构建器模式的缺点包括：</p><ol><li><p>代码量：由于层次构建器模式需要定义多个构建器类，因此代码量会比较大，尤其是在构建复杂对象时。</p></li><li><p>嵌套层次：层次构建器模式中的对象层次结构是通过嵌套多个构建器实现的，这会导致代码的嵌套层次较深，可能会影响代码的可读性和可维护性。</p></li><li><p>可能会增加内存开销：因为每个构建器都需要创建一个独立的对象，并且需要在构建器对象中保存对象的属性。对于大型对象和多级嵌套结构，开销可能会很大。</p></li><li><p>不适合简单对象的构建：层次构建器模式适用于构建复杂对象层次结构，但对于简单的对象构建，使用层次构建器模式可能会显得过于繁琐和不必要。</p></li></ol><h3 id=使用>使用</h3><h4 id=举例-1>举例 1</h4><p>1、定义抽象的构建器接口，用于创建不同类型的对象和添加子对象：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>ComputerBuilder</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>buildCPU</span><span class=o>(</span><span class=n>String</span> <span class=n>model</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>buildGPU</span><span class=o>(</span><span class=n>String</span> <span class=n>model</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>buildMemory</span><span class=o>(</span><span class=kt>int</span> <span class=n>size</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>addStorage</span><span class=o>(</span><span class=n>String</span> <span class=n>type</span><span class=o>,</span> <span class=kt>int</span> <span class=n>size</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>addPeripheral</span><span class=o>(</span><span class=n>String</span> <span class=n>type</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Computer</span> <span class=nf>getResult</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>2、创建具体的构建器实现，用于构建不同类型的对象和添加子对象：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>DesktopBuilder</span> <span class=kd>implements</span> <span class=n>ComputerBuilder</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Desktop</span> <span class=n>computer</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Desktop</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>buildCPU</span><span class=o>(</span><span class=n>String</span> <span class=n>model</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>computer</span><span class=o>.</span><span class=na>setCPU</span><span class=o>(</span><span class=k>new</span> <span class=n>CPU</span><span class=o>(</span><span class=n>model</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>buildGPU</span><span class=o>(</span><span class=n>String</span> <span class=n>model</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>computer</span><span class=o>.</span><span class=na>setGPU</span><span class=o>(</span><span class=k>new</span> <span class=n>GPU</span><span class=o>(</span><span class=n>model</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>buildMemory</span><span class=o>(</span><span class=kt>int</span> <span class=n>size</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>computer</span><span class=o>.</span><span class=na>setMemory</span><span class=o>(</span><span class=k>new</span> <span class=n>Memory</span><span class=o>(</span><span class=n>size</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>addStorage</span><span class=o>(</span><span class=n>String</span> <span class=n>type</span><span class=o>,</span> <span class=kt>int</span> <span class=n>size</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>computer</span><span class=o>.</span><span class=na>addStorage</span><span class=o>(</span><span class=k>new</span> <span class=n>Storage</span><span class=o>(</span><span class=n>type</span><span class=o>,</span> <span class=n>size</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>addPeripheral</span><span class=o>(</span><span class=n>String</span> <span class=n>type</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>computer</span><span class=o>.</span><span class=na>addPeripheral</span><span class=o>(</span><span class=k>new</span> <span class=n>Peripheral</span><span class=o>(</span><span class=n>type</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Computer</span> <span class=nf>getResult</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>computer</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>LaptopBuilder</span> <span class=kd>implements</span> <span class=n>ComputerBuilder</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Laptop</span> <span class=n>computer</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Laptop</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>buildCPU</span><span class=o>(</span><span class=n>String</span> <span class=n>model</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>computer</span><span class=o>.</span><span class=na>setCPU</span><span class=o>(</span><span class=k>new</span> <span class=n>CPU</span><span class=o>(</span><span class=n>model</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>buildGPU</span><span class=o>(</span><span class=n>String</span> <span class=n>model</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>computer</span><span class=o>.</span><span class=na>setGPU</span><span class=o>(</span><span class=k>new</span> <span class=n>GPU</span><span class=o>(</span><span class=n>model</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>buildMemory</span><span class=o>(</span><span class=kt>int</span> <span class=n>size</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>computer</span><span class=o>.</span><span class=na>setMemory</span><span class=o>(</span><span class=k>new</span> <span class=n>Memory</span><span class=o>(</span><span class=n>size</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>addStorage</span><span class=o>(</span><span class=n>String</span> <span class=n>type</span><span class=o>,</span> <span class=kt>int</span> <span class=n>size</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>computer</span><span class=o>.</span><span class=na>addStorage</span><span class=o>(</span><span class=k>new</span> <span class=n>Storage</span><span class=o>(</span><span class=n>type</span><span class=o>,</span> <span class=n>size</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>addPeripheral</span><span class=o>(</span><span class=n>String</span> <span class=n>type</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>computer</span><span class=o>.</span><span class=na>addPeripheral</span><span class=o>(</span><span class=k>new</span> <span class=n>Peripheral</span><span class=o>(</span><span class=n>type</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Computer</span> <span class=nf>getResult</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>computer</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>3、创建指导者类，用于协调构建器的顺序和调用构建器的方法来构建对象层次结构：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>ComputerDirector</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>ComputerBuilder</span> <span class=n>builder</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>ComputerDirector</span><span class=o>(</span><span class=n>ComputerBuilder</span> <span class=n>builder</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>builder</span> <span class=o>=</span> <span class=n>builder</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>construct</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>builder</span><span class=o>.</span><span class=na>buildCPU</span><span class=o>(</span><span class=s>&#34;Intel Core i7&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>builder</span><span class=o>.</span><span class=na>buildGPU</span><span class=o>(</span><span class=s>&#34;Nvidia GeForce RTX 3080&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>builder</span><span class=o>.</span><span class=na>buildMemory</span><span class=o>(</span><span class=mi>16</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>builder</span><span class=o>.</span><span class=na>addStorage</span><span class=o>(</span><span class=s>&#34;SSD&#34;</span><span class=o>,</span> <span class=mi>512</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>builder</span><span class=o>.</span><span class=na>addPeripheral</span><span class=o>(</span><span class=s>&#34;Keyboard&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>builder</span><span class=o>.</span><span class=na>addPeripheral</span><span class=o>(</span><span class=s>&#34;Mouse&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>4、使用层次构建器模式创建计算机系统对象：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>ComputerBuilder</span> <span class=n>desktopBuilder</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DesktopBuilder</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>ComputerBuilder</span> <span class=n>laptopBuilder</span> <span class=o>=</span> <span class=k>new</span> <span class=n>LaptopBuilder</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ComputerDirector</span> <span class=n>director</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ComputerDirector</span><span class=o>(</span><span class=n>desktopBuilder</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>director</span><span class=o>.</span><span class=na>construct</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>Computer</span> <span class=n>desktop</span> <span class=o>=</span> <span class=n>desktopBuilder</span><span class=o>.</span><span class=na>getResult</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>director</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ComputerDirector</span><span class=o>(</span><span class=n>laptopBuilder</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>director</span><span class=o>.</span><span class=na>construct</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>Computer</span> <span class=n>laptop</span> <span class=o>=</span> <span class=n>laptopBuilder</span><span class=o>.</span><span class=na>getResult</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 将两个计算机系统对象组合成一个更大的计算机系统对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>ComputerSystem</span> <span class=n>system</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ComputerSystem</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>system</span><span class=o>.</span><span class=na>addComputer</span><span class=o>(</span><span class=n>desktop</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>system</span><span class=o>.</span><span class=na>addComputer</span><span class=o>(</span><span class=n>laptop</span><span class=o>);</span>
</span></span></code></pre></div><p>在上面的示例中，DesktopBuilder 和 LaptopBuilder 分别是具体的构建器实现，用于创建桌面计算机和笔记本电脑对象。ComputerDirector 是指导者类，用于协调构建器的顺序和调用构建器的方法来构建对象层次结构。使用 ComputerDirector 构建计算机系统对象时，可以先使用 DesktopBuilder 构建桌面计算机对象，再使用 LaptopBuilder 构建笔记本电脑对象，最后将两个计算机系统对象组合成一个更大的计算机系统对象。</p><p>下面是另一个使用层次构建器模式创建层次结构对象的例子，假设需要创建一个组织结构的层次结构对象，其中包含多个部门和嵌套子部门：</p><p>1、定义抽象的构建器接口，用于创建不同类型的对象和添加子对象：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>DepartmentBuilder</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>buildName</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>buildManager</span><span class=o>(</span><span class=n>String</span> <span class=n>manager</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>addSubDepartment</span><span class=o>(</span><span class=n>Department</span> <span class=n>subDepartment</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>Department</span> <span class=nf>getResult</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>DepartmentImpl</span> <span class=kd>implements</span> <span class=n>Department</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=n>String</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=n>String</span> <span class=n>manager</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Department</span><span class=o>&gt;</span> <span class=n>subDepartments</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setName</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>name</span> <span class=o>=</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setManager</span><span class=o>(</span><span class=n>String</span> <span class=n>manager</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>manager</span> <span class=o>=</span> <span class=n>manager</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>addSubDepartment</span><span class=o>(</span><span class=n>Department</span> <span class=n>subDepartment</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>subDepartments</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>subDepartment</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>removeSubDepartment</span><span class=o>(</span><span class=n>Department</span> <span class=n>subDepartment</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>subDepartments</span><span class=o>.</span><span class=na>remove</span><span class=o>(</span><span class=n>subDepartment</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>Department</span><span class=o>&gt;</span> <span class=nf>getSubDepartments</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>subDepartments</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getName</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>name</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getManager</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>manager</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>DevelopmentDepartment</span> <span class=kd>extends</span> <span class=n>DepartmentImpl</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 添加特定于开发部门的属性和方法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SalesDepartment</span> <span class=kd>extends</span> <span class=n>DepartmentImpl</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 添加特定于销售部门的属性和方法
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>}</span>
</span></span></code></pre></div><p>2、创建具体的构建器实现，用于构建不同类型的对象和添加子对象：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SalesDepartmentBuilder</span> <span class=kd>implements</span> <span class=n>DepartmentBuilder</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>SalesDepartment</span> <span class=n>department</span> <span class=o>=</span> <span class=k>new</span> <span class=n>SalesDepartment</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>buildName</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>department</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=n>name</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>buildManager</span><span class=o>(</span><span class=n>String</span> <span class=n>manager</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>department</span><span class=o>.</span><span class=na>setManager</span><span class=o>(</span><span class=n>manager</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>addSubDepartment</span><span class=o>(</span><span class=n>Department</span> <span class=n>subDepartment</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>department</span><span class=o>.</span><span class=na>addSubDepartment</span><span class=o>(</span><span class=n>subDepartment</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Department</span> <span class=nf>getResult</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>department</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>DevelopmentDepartmentBuilder</span> <span class=kd>implements</span> <span class=n>DepartmentBuilder</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>DevelopmentDepartment</span> <span class=n>department</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DevelopmentDepartment</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>buildName</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>department</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=n>name</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>buildManager</span><span class=o>(</span><span class=n>String</span> <span class=n>manager</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>department</span><span class=o>.</span><span class=na>setManager</span><span class=o>(</span><span class=n>manager</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>addSubDepartment</span><span class=o>(</span><span class=n>Department</span> <span class=n>subDepartment</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>department</span><span class=o>.</span><span class=na>addSubDepartment</span><span class=o>(</span><span class=n>subDepartment</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Department</span> <span class=nf>getResult</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>department</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>3、创建指导者类，用于协调构建器的顺序和调用构建器的方法来构建对象层次结构：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>OrganizationDirector</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>DepartmentBuilder</span> <span class=n>builder</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>OrganizationDirector</span><span class=o>(</span><span class=n>DepartmentBuilder</span> <span class=n>builder</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>builder</span> <span class=o>=</span> <span class=n>builder</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>construct</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>builder</span><span class=o>.</span><span class=na>buildName</span><span class=o>(</span><span class=s>&#34;Organization&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>builder</span><span class=o>.</span><span class=na>buildManager</span><span class=o>(</span><span class=s>&#34;CEO&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>Department</span> <span class=n>salesDept</span> <span class=o>=</span> <span class=k>new</span> <span class=n>SalesDepartment</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>salesDept</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=s>&#34;Sales Department&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>salesDept</span><span class=o>.</span><span class=na>setManager</span><span class=o>(</span><span class=s>&#34;Sales Manager&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>builder</span><span class=o>.</span><span class=na>addSubDepartment</span><span class=o>(</span><span class=n>salesDept</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>Department</span> <span class=n>devDept</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DevelopmentDepartment</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>devDept</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=s>&#34;Development Department&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>devDept</span><span class=o>.</span><span class=na>setManager</span><span class=o>(</span><span class=s>&#34;Development Manager&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>Department</span> <span class=n>frontendDevDept</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DevelopmentDepartment</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>frontendDevDept</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=s>&#34;Front-end Development Department&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>frontendDevDept</span><span class=o>.</span><span class=na>setManager</span><span class=o>(</span><span class=s>&#34;Front-end Development Manager&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>devDept</span><span class=o>.</span><span class=na>addSubDepartment</span><span class=o>(</span><span class=n>frontendDevDept</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>Department</span> <span class=n>backendDevDept</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DevelopmentDepartment</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>backendDevDept</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=s>&#34;Back-end Development Department&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>backendDevDept</span><span class=o>.</span><span class=na>setManager</span><span class=o>(</span><span class=s>&#34;Back-end Development Manager&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>devDept</span><span class=o>.</span><span class=na>addSubDepartment</span><span class=o>(</span><span class=n>backendDevDept</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>builder</span><span class=o>.</span><span class=na>addSubDepartment</span><span class=o>(</span><span class=n>devDept</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>4、使用层次构建器模式创建组织结构对象：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>DepartmentBuilder</span> <span class=n>salesDeptBuilder</span> <span class=o>=</span> <span class=k>new</span> <span class=n>SalesDepartmentBuilder</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>DepartmentBuilder</span> <span class=n>devDeptBuilder</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DevelopmentDepartmentBuilder</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>OrganizationDirector</span> <span class=n>director</span> <span class=o>=</span> <span class=k>new</span> <span class=n>OrganizationDirector</span><span class=o>(</span><span class=n>salesDeptBuilder</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>director</span><span class=o>.</span><span class=na>construct</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>Department</span> <span class=n>salesDept</span> <span class=o>=</span> <span class=n>salesDeptBuilder</span><span class=o>.</span><span class=na>getResult</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>director</span> <span class=o>=</span> <span class=k>new</span> <span class=n>OrganizationDirector</span><span class=o>(</span><span class=n>devDeptBuilder</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>director</span><span class=o>.</span><span class=na>construct</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>Department</span> <span class=n>devDept</span> <span class=o>=</span> <span class=n>devDeptBuilder</span><span class=o>.</span><span class=na>getResult</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 将两个部门对象组合成一个更大的组织结构对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Organization</span> <span class=n>organization</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Organization</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>organization</span><span class=o>.</span><span class=na>addDepartment</span><span class=o>(</span><span class=n>salesDept</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>organization</span><span class=o>.</span><span class=na>addDepartment</span><span class=o>(</span><span class=n>devDept</span><span class=o>);</span>
</span></span></code></pre></div><p>在上面的示例中，SalesDepartmentBuilder 和 DevelopmentDepartmentBuilder 分别是具体的构建器实现，用于创建销售部门和开发部门对象。OrganizationDirector 是指导者类，用于协调构建器的顺序和调用构建器的方法来构建对象层次结构。使用 OrganizationDirector 构建组织结构对象时，可以先使用 SalesDepartmentBuilder 构建销售部门对象，再使用 DevelopmentDepartmentBuilder 构建开发部门对象，最后将两个部门对象组合成一个更大的组织结构对象。</p><h4 id=举例-2>举例 2</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>ComputerComponent</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>manufacturer</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>model</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=nf>ComputerComponent</span><span class=o>(</span><span class=n>Builder</span><span class=o>&lt;?&gt;</span> <span class=n>builder</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>manufacturer</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>manufacturer</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>model</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>model</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getManufacturer</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>manufacturer</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getModel</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>model</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>Builder</span><span class=o>&lt;</span><span class=n>T</span> <span class=kd>extends</span> <span class=n>Builder</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=n>String</span> <span class=n>manufacturer</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=n>String</span> <span class=n>model</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>T</span> <span class=nf>setManufacturer</span><span class=o>(</span><span class=n>String</span> <span class=n>manufacturer</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>manufacturer</span> <span class=o>=</span> <span class=n>manufacturer</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>self</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>T</span> <span class=nf>setModel</span><span class=o>(</span><span class=n>String</span> <span class=n>model</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>model</span> <span class=o>=</span> <span class=n>model</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>self</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>protected</span> <span class=kd>abstract</span> <span class=n>T</span> <span class=nf>self</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=kd>abstract</span> <span class=n>ComputerComponent</span> <span class=nf>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Motherboard</span> <span class=kd>extends</span> <span class=n>ComputerComponent</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>socketType</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=nf>Motherboard</span><span class=o>(</span><span class=n>Builder</span> <span class=n>builder</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>(</span><span class=n>builder</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>socketType</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>socketType</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getSocketType</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>socketType</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>Builder</span> <span class=kd>extends</span> <span class=n>ComputerComponent</span><span class=o>.</span><span class=na>Builder</span><span class=o>&lt;</span><span class=n>Builder</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=n>String</span> <span class=n>socketType</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>Builder</span> <span class=nf>setSocketType</span><span class=o>(</span><span class=n>String</span> <span class=n>socketType</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>socketType</span> <span class=o>=</span> <span class=n>socketType</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>        <span class=kd>protected</span> <span class=n>Builder</span> <span class=nf>self</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>Motherboard</span> <span class=nf>build</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>new</span> <span class=n>Motherboard</span><span class=o>(</span><span class=k>this</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>CPU</span> <span class=kd>extends</span> <span class=n>ComputerComponent</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>coreCount</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=nf>CPU</span><span class=o>(</span><span class=n>Builder</span> <span class=n>builder</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>super</span><span class=o>(</span><span class=n>builder</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>coreCount</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>coreCount</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>getCoreCount</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>coreCount</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>Builder</span> <span class=kd>extends</span> <span class=n>ComputerComponent</span><span class=o>.</span><span class=na>Builder</span><span class=o>&lt;</span><span class=n>Builder</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=kt>int</span> <span class=n>coreCount</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>Builder</span> <span class=nf>setCoreCount</span><span class=o>(</span><span class=kt>int</span> <span class=n>coreCount</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>coreCount</span> <span class=o>=</span> <span class=n>coreCount</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>        <span class=kd>protected</span> <span class=n>Builder</span> <span class=nf>self</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>CPU</span> <span class=nf>build</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>new</span> <span class=n>CPU</span><span class=o>(</span><span class=k>this</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Computer</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=n>Motherboard</span> <span class=n>motherboard</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=n>CPU</span> <span class=n>cpu</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=nf>Computer</span><span class=o>(</span><span class=n>Builder</span> <span class=n>builder</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>motherboard</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>motherboard</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>cpu</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>cpu</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Motherboard</span> <span class=nf>getMotherboard</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>motherboard</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>CPU</span> <span class=nf>getCpu</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>cpu</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>Builder</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=n>Motherboard</span> <span class=n>motherboard</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=n>CPU</span> <span class=n>cpu</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>Builder</span> <span class=nf>setMotherboard</span><span class=o>(</span><span class=n>Motherboard</span> <span class=n>motherboard</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>motherboard</span> <span class=o>=</span> <span class=n>motherboard</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>Builder</span> <span class=nf>setCpu</span><span class=o>(</span><span class=n>CPU</span> <span class=n>cpu</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>cpu</span> <span class=o>=</span> <span class=n>cpu</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>Computer</span> <span class=nf>build</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>new</span> <span class=n>Computer</span><span class=o>(</span><span class=k>this</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>使用示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Motherboard</span><span class=o>.</span><span class=na>Builder</span> <span class=n>motherboardBuilder</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Motherboard</span><span class=o>.</span><span class=na>Builder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>setManufacturer</span><span class=o>(</span><span class=s>&#34;ASUS&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>setModel</span><span class=o>(</span><span class=s>&#34;ROG Strix Z590-E Gaming&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>setSocketType</span><span class=o>(</span><span class=s>&#34;LGA 1200&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=n>CPU</span><span class=o>.</span><span class=na>Builder</span> <span class=n>cpuBuilder</span> <span class=o>=</span> <span class=k>new</span> <span class=n>CPU</span><span class=o>.</span><span class=na>Builder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>setManufacturer</span><span class=o>(</span><span class=s>&#34;Intel&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>setModel</span><span class=o>(</span><span class=s>&#34;Core i9-11900K&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>setCoreCount</span><span class=o>(</span><span class=mi>8</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=n>Computer</span><span class=o>.</span><span class=na>Builder</span> <span class=n>computerBuilder</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Computer</span><span class=o>.</span><span class=na>Builder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>setMotherboard</span><span class=o>(</span><span class=n>motherboardBuilder</span><span class=o>.</span><span class=na>build</span><span class=o>())</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>setCpu</span><span class=o>(</span><span class=n>cpuBuilder</span><span class=o>.</span><span class=na>build</span><span class=o>())</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=n>Computer</span> <span class=n>computer</span> <span class=o>=</span> <span class=n>computerBuilder</span><span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span></code></pre></div><p>在这个示例中，<code>ComputerComponent</code> 类是一个抽象基类，定义了计算机组件的基本属性和方法。它还定义了一个抽象的构建器类，用于构建它的子类的实例。</p><p>每个 <code>ComputerComponent</code> 的具体子类都有自己的具体构建器类，该类扩展了抽象构建器类。具体构建器提供了设置相应组件属性的方法，例如主板的制造商、型号和插座类型，处理器的时钟速度和内存的容量。</p><p><code>Computer</code> 类代表一个完整的计算机系统，并具有用于构建 <code>Computer</code> 类的实例的构建器类。<code>Computer.Builder</code> 类提供了设置每个组件属性的方法，使用 <code>Consumer</code> 函数接口来接受配置相应构建器的 lambda 表达式。</p><h2 id=使用-1>使用</h2><p>以下是几个常见开源框架中使用建造者模式的例子：</p><h3 id=retrofit>Retrofit</h3><p>Retrofit 是一个 Android 和 Java 平台上的 RESTful API 库，它使用建造者模式来创建 RestAdapter 对象。RestAdapter.Builder 类是一个建造者类，它包含了一系列的方法，用于设置 Retrofit 的配置选项，如设置 API 的 base URL、设置 HTTP Client、设置 Converter 等。</p><p>示例代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>RestAdapter</span> <span class=n>restAdapter</span> <span class=o>=</span> <span class=k>new</span> <span class=n>RestAdapter</span><span class=o>.</span><span class=na>Builder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>setEndpoint</span><span class=o>(</span><span class=s>&#34;https://api.github.com&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>setClient</span><span class=o>(</span><span class=k>new</span> <span class=n>OkClient</span><span class=o>())</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>setLogLevel</span><span class=o>(</span><span class=n>RestAdapter</span><span class=o>.</span><span class=na>LogLevel</span><span class=o>.</span><span class=na>FULL</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span></code></pre></div><h3 id=gson>Gson</h3><p>Gson 是一个用于在 Java 对象和 JSON 数据之间进行序列化和反序列化的库。它使用建造者模式来创建 Gson 对象。GsonBuilder 类是一个建造者类，它包含了一系列的方法，用于配置 Gson 的行为，如设置日期格式、设置字段的命名策略等。</p><p>示例代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Gson</span> <span class=n>gson</span> <span class=o>=</span> <span class=k>new</span> <span class=n>GsonBuilder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>setDateFormat</span><span class=o>(</span><span class=s>&#34;yyyy-MM-dd&#39;T&#39;HH:mm:ssZ&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>setFieldNamingPolicy</span><span class=o>(</span><span class=n>FieldNamingPolicy</span><span class=o>.</span><span class=na>LOWER_CASE_WITH_UNDERSCORES</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>create</span><span class=o>();</span>
</span></span></code></pre></div><h3 id=apache-httpclient>Apache HttpClient</h3><p>Apache HttpClient 是一个用于创建 HTTP 客户端的库，它使用建造者模式来创建 HttpClient 对象。HttpClientBuilder 类是一个建造者类，它包含了一系列的方法，用于配置 HttpClient 的行为，如设置连接池、设置代理、设置 Cookie 管理器等。</p><p>示例代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>HttpClient</span> <span class=n>httpClient</span> <span class=o>=</span> <span class=n>HttpClientBuilder</span><span class=o>.</span><span class=na>create</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>setMaxConnTotal</span><span class=o>(</span><span class=mi>100</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>setMaxConnPerRoute</span><span class=o>(</span><span class=mi>10</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>setProxy</span><span class=o>(</span><span class=k>new</span> <span class=n>HttpHost</span><span class=o>(</span><span class=s>&#34;localhost&#34;</span><span class=o>,</span> <span class=mi>8080</span><span class=o>))</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>setDefaultCookieStore</span><span class=o>(</span><span class=k>new</span> <span class=n>BasicCookieStore</span><span class=o>())</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span></code></pre></div><h3 id=apache-kafka>Apache Kafka</h3><p>Apache Kafka 是一个分布式消息队列系统，它使用建造者模式来创建 Producer 和 Consumer 对象。ProducerConfig 和 ConsumerConfig 类是建造者类，它们包含了一系列的方法，用于配置 Producer 和 Consumer 的行为，如设置 broker 地址、设置序列化器等。</p><p>示例代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Properties</span> <span class=n>producerProps</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Properties</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>producerProps</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>ProducerConfig</span><span class=o>.</span><span class=na>BOOTSTRAP_SERVERS_CONFIG</span><span class=o>,</span> <span class=s>&#34;localhost:9092&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>producerProps</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>ProducerConfig</span><span class=o>.</span><span class=na>KEY_SERIALIZER_CLASS_CONFIG</span><span class=o>,</span> <span class=n>StringSerializer</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>getName</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=n>producerProps</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>ProducerConfig</span><span class=o>.</span><span class=na>VALUE_SERIALIZER_CLASS_CONFIG</span><span class=o>,</span> <span class=n>StringSerializer</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>getName</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Producer</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>String</span><span class=o>&gt;</span> <span class=n>producer</span> <span class=o>=</span> <span class=k>new</span> <span class=n>KafkaProducer</span><span class=o>&lt;&gt;(</span><span class=n>producerProps</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Properties</span> <span class=n>consumerProps</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Properties</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=n>consumerProps</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>ConsumerConfig</span><span class=o>.</span><span class=na>BOOTSTRAP_SERVERS_CONFIG</span><span class=o>,</span> <span class=s>&#34;localhost:9092&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl><span class=n>consumerProps</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>ConsumerConfig</span><span class=o>.</span><span class=na>KEY_DESERIALIZER_CLASS_CONFIG</span><span class=o>,</span> <span class=n>StringDeserializer</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>getName</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=n>consumerProps</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>ConsumerConfig</span><span class=o>.</span><span class=na>VALUE_DESERIALIZER_CLASS_CONFIG</span><span class=o>,</span> <span class=n>StringDeserializer</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>getName</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=n>consumerProps</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>ConsumerConfig</span><span class=o>.</span><span class=na>GROUP_ID_CONFIG</span><span class=o>,</span> <span class=s>&#34;my-group&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Consumer</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>String</span><span class=o>&gt;</span> <span class=n>consumer</span> <span class=o>=</span> <span class=k>new</span> <span class=n>KafkaConsumer</span><span class=o>&lt;&gt;(</span><span class=n>consumerProps</span><span class=o>);</span>
</span></span></code></pre></div><h3 id=apache-commons-configuration>Apache Commons Configuration</h3><p>Apache Commons Configuration 是一个用于读取和写入各种配置文件的库，它使用建造者模式来创建 Configuration 对象。ConfigurationBuilder 类是一个建造者类，它包含了一系列的方法，用于配置 Configuration 的行为，如设置配置文件类型、设置属性的分隔符等。</p><p>示例代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Configuration</span> <span class=n>config</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ConfigurationBuilder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>setDelimiterParsingDisabled</span><span class=o>(</span><span class=kc>true</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>setFile</span><span class=o>(</span><span class=k>new</span> <span class=n>File</span><span class=o>(</span><span class=s>&#34;config.properties&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>setListDelimiterHandler</span><span class=o>(</span><span class=k>new</span> <span class=n>DefaultListDelimiterHandler</span><span class=o>(</span><span class=sc>&#39;,&#39;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span></code></pre></div><h3 id=guava>Guava</h3><p>Guava 是一个 Google 开发的 Java 库，它包含了许多实用的工具类和数据结构，其中包括使用建造者模式来创建的 ImmutableList、ImmutableMap 和 ImmutableSet 等不可变集合类。</p><p>示例代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>ImmutableList</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>list</span> <span class=o>=</span> <span class=n>ImmutableList</span><span class=o>.&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=n>builder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=s>&#34;foo&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=s>&#34;bar&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=s>&#34;baz&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ImmutableMap</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Integer</span><span class=o>&gt;</span> <span class=n>map</span> <span class=o>=</span> <span class=n>ImmutableMap</span><span class=o>.&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Integer</span><span class=o>&gt;</span><span class=n>builder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;foo&#34;</span><span class=o>,</span> <span class=mi>1</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;bar&#34;</span><span class=o>,</span> <span class=mi>2</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=s>&#34;baz&#34;</span><span class=o>,</span> <span class=mi>3</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ImmutableSet</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>set</span> <span class=o>=</span> <span class=n>ImmutableSet</span><span class=o>.&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=n>builder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=s>&#34;foo&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=s>&#34;bar&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=s>&#34;baz&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span></code></pre></div><h3 id=jpa>JPA</h3><p>Java Persistence API（JPA）是 Java EE 平台的一个 ORM 框架，它使用建造者模式来创建 EntityManagerFactory 对象。EntityManagerFactoryBuilder 类是一个建造者类，它包含了一系列的方法，用于配置 EntityManagerFactory 的行为，如设置数据源、设置 JPA 的属性等。</p><p>示例代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>EntityManagerFactory</span> <span class=n>entityManagerFactory</span> <span class=o>=</span> <span class=k>new</span> <span class=n>EntityManagerFactoryBuilder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>dataSource</span><span class=o>(</span><span class=n>myDataSource</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>persistenceUnit</span><span class=o>(</span><span class=s>&#34;myPersistenceUnit&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>properties</span><span class=o>(</span><span class=n>myProperties</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span></code></pre></div><h3 id=spring-framework>Spring Framework</h3><p>Spring Framework 是一个 Java 平台上的开源应用程序框架，它使用建造者模式来创建 RestTemplate 和 HttpHeaders 对象。RestTemplateBuilder 和 HttpHeadersBuilder 类是建造者类，它们包含了一系列的方法，用于配置 RestTemplate 和 HttpHeaders 的行为，如设置连接超时、设置请求头等。</p><p>示例代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>RestTemplate</span> <span class=n>restTemplate</span> <span class=o>=</span> <span class=k>new</span> <span class=n>RestTemplateBuilder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>setConnectTimeout</span><span class=o>(</span><span class=n>Duration</span><span class=o>.</span><span class=na>ofSeconds</span><span class=o>(</span><span class=mi>10</span><span class=o>))</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>setReadTimeout</span><span class=o>(</span><span class=n>Duration</span><span class=o>.</span><span class=na>ofSeconds</span><span class=o>(</span><span class=mi>10</span><span class=o>))</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>HttpHeaders</span> <span class=n>headers</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HttpHeadersBuilder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>setContentType</span><span class=o>(</span><span class=n>MediaType</span><span class=o>.</span><span class=na>APPLICATION_JSON</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span></code></pre></div><h2 id=优化>优化</h2><p>建造者模式的优化主要包括以下几个方面：</p><h3 id=使用静态内部类优化建造者模式>使用静态内部类优化建造者模式</h3><p>建造者模式通常使用一个 Builder 类来构建复杂对象，为了避免 Builder 类变得过于臃肿，可以将其设计为静态内部类，这样可以使代码更加清晰，同时也能够保证线程安全。</p><h3 id=使用流式接口优化建造者模式>使用流式接口优化建造者模式</h3><p>流式接口是一种链式调用的方式，它可以将多个方法调用连接起来，形成一个链式结构，使得代码更加简洁易读。在建造者模式中，可以使用流式接口来优化 Builder 类，使得客户端可以通过链式调用的方式来创建复杂对象，从而简化代码。</p><h3 id=使用默认值优化建造者模式>使用默认值优化建造者模式</h3><p>在建造者模式中，有些属性是必须的，而有些属性是可选的，可以使用默认值来为可选属性设置默认值，从而避免客户端必须为每个可选属性都提供值的情况，同时也能够简化客户端代码。</p><h3 id=使用-java-8-中的-optional-类优化建造者模式>使用 Java 8 中的 Optional 类优化建造者模式</h3><p>Java 8 中引入了 Optional 类，该类可以用于处理可能为 null 的值，可以进一步优化建造者模式中的代码。</p><p>在建造者模式中，我们通常需要设置多个属性，其中有些属性可能是可选的，如果直接使用 null 来表示可选属性的值，可能会导致代码出现空指针异常，而使用 Optional 类可以避免这个问题。</p><p>下面是一个使用 Optional 类优化建造者模式的示例代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.Optional</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Computer</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>cpu</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>memory</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>hardDisk</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>graphicsCard</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=nf>Computer</span><span class=o>(</span><span class=n>ComputerBuilder</span> <span class=n>builder</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>cpu</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>cpu</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>memory</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>memory</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>hardDisk</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>hardDisk</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>graphicsCard</span> <span class=o>=</span> <span class=n>builder</span><span class=o>.</span><span class=na>graphicsCard</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 省略getter方法
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>ComputerBuilder</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=n>String</span> <span class=n>cpu</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=n>String</span> <span class=n>memory</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=n>String</span> <span class=n>hardDisk</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>graphicsCard</span> <span class=o>=</span> <span class=n>Optional</span><span class=o>.</span><span class=na>empty</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>ComputerBuilder</span> <span class=nf>setCpu</span><span class=o>(</span><span class=n>String</span> <span class=n>cpu</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>cpu</span> <span class=o>=</span> <span class=n>cpu</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>ComputerBuilder</span> <span class=nf>setMemory</span><span class=o>(</span><span class=n>String</span> <span class=n>memory</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>memory</span> <span class=o>=</span> <span class=n>memory</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>ComputerBuilder</span> <span class=nf>setHardDisk</span><span class=o>(</span><span class=n>String</span> <span class=n>hardDisk</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>hardDisk</span> <span class=o>=</span> <span class=n>hardDisk</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>ComputerBuilder</span> <span class=nf>setGraphicsCard</span><span class=o>(</span><span class=n>String</span> <span class=n>graphicsCard</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>graphicsCard</span> <span class=o>=</span> <span class=n>Optional</span><span class=o>.</span><span class=na>ofNullable</span><span class=o>(</span><span class=n>graphicsCard</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>Computer</span> <span class=nf>build</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>new</span> <span class=n>Computer</span><span class=o>(</span><span class=k>this</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>在这个示例代码中，我们使用 <code>Optional</code> 类来表示可选属性的值，将 graphicsCard 属性的类型改为<code>Optional&lt;String></code>。在 ComputerBuilder 类中，我们使用 <code>Optional.ofNullable </code>方法来将可选属性的值转换为 Optional 对象，并在调用 build 方法时，将 Optional 对象转换为普通的字符串类型。</p><h3 id=使用-lambda-表达式优化建造者模式>使用 Lambda 表达式优化建造者模式</h3><p>Lambda 表达式是 Java 8 中引入的一种新的语言特性，可以进一步优化建造者模式中的代码，使得代码更加简洁易读。</p><p>在建造者模式中，我们通常需要定义多个属性，并在构造方法中进行初始化。使用 Lambda 表达式可以避免定义多个属性的问题，将属性的赋值操作通过 Lambda 表达式传递给构造方法。</p><p>下面是一个使用 Lambda 表达式优化建造者模式的示例代码：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.Optional</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.function.Consumer</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>Computer</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>cpu</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>memory</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=n>hardDisk</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>graphicsCard</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=nf>Computer</span><span class=o>(</span><span class=n>Consumer</span><span class=o>&lt;</span><span class=n>ComputerBuilder</span><span class=o>&gt;</span> <span class=n>builder</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>ComputerBuilder</span> <span class=n>computerBuilder</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ComputerBuilder</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>builder</span><span class=o>.</span><span class=na>accept</span><span class=o>(</span><span class=n>computerBuilder</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>cpu</span> <span class=o>=</span> <span class=n>computerBuilder</span><span class=o>.</span><span class=na>cpu</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>memory</span> <span class=o>=</span> <span class=n>computerBuilder</span><span class=o>.</span><span class=na>memory</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>hardDisk</span> <span class=o>=</span> <span class=n>computerBuilder</span><span class=o>.</span><span class=na>hardDisk</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>graphicsCard</span> <span class=o>=</span> <span class=n>computerBuilder</span><span class=o>.</span><span class=na>graphicsCard</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// 省略getter方法
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>ComputerBuilder</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=n>String</span> <span class=n>cpu</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=n>String</span> <span class=n>memory</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=n>String</span> <span class=n>hardDisk</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>graphicsCard</span> <span class=o>=</span> <span class=n>Optional</span><span class=o>.</span><span class=na>empty</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>ComputerBuilder</span> <span class=nf>setCpu</span><span class=o>(</span><span class=n>String</span> <span class=n>cpu</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>cpu</span> <span class=o>=</span> <span class=n>cpu</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>ComputerBuilder</span> <span class=nf>setMemory</span><span class=o>(</span><span class=n>String</span> <span class=n>memory</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>memory</span> <span class=o>=</span> <span class=n>memory</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>ComputerBuilder</span> <span class=nf>setHardDisk</span><span class=o>(</span><span class=n>String</span> <span class=n>hardDisk</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>hardDisk</span> <span class=o>=</span> <span class=n>hardDisk</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>ComputerBuilder</span> <span class=nf>setGraphicsCard</span><span class=o>(</span><span class=n>String</span> <span class=n>graphicsCard</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>graphicsCard</span> <span class=o>=</span> <span class=n>Optional</span><span class=o>.</span><span class=na>ofNullable</span><span class=o>(</span><span class=n>graphicsCard</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Computer</span> <span class=n>computer</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Computer</span><span class=o>(</span><span class=n>builder</span> <span class=o>-&gt;</span> <span class=n>builder</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>setCpu</span><span class=o>(</span><span class=s>&#34;Intel i7&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>setMemory</span><span class=o>(</span><span class=s>&#34;16GB&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>setHardDisk</span><span class=o>(</span><span class=s>&#34;512GB SSD&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>setGraphicsCard</span><span class=o>(</span><span class=s>&#34;NVIDIA GTX 1660&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>在这个示例代码中，我们将 Computer 类的构造方法改为接收一个 <code>Consumer&lt;ComputerBuilder> </code>类型的参数，这个参数表示一个包含属性赋值操作的 Lambda 表达式。在构造方法中，我们先创建一个 ComputerBuilder 对象，然后通过 Lambda 表达式调用 ComputerBuilder 对象的方法来设置属性值，并最终通过 ComputerBuilder 对象创建 Computer 对象。</p><h3 id=使用泛型和反射优化>使用泛型和反射优化</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>class</span> <span class=nc>EntityCreator</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>Class</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>classInstance</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>T</span> <span class=n>entityObj</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>EntityCreator</span><span class=o>(</span><span class=n>Class</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>classInstance</span><span class=o>,</span> <span class=n>Object</span><span class=o>...</span> <span class=n>initParams</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>classInstance</span> <span class=o>=</span> <span class=n>classInstance</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Class</span><span class=o>&lt;?&gt;[]</span> <span class=n>paramTypes</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Class</span><span class=o>&lt;?&gt;[</span><span class=n>initParams</span><span class=o>.</span><span class=na>length</span><span class=o>];</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=o>(</span><span class=kt>int</span> <span class=n>index</span> <span class=o>=</span> <span class=mi>0</span><span class=o>,</span> <span class=n>length</span> <span class=o>=</span> <span class=n>initParams</span><span class=o>.</span><span class=na>length</span><span class=o>;</span> <span class=n>index</span> <span class=o>&lt;</span> <span class=n>length</span><span class=o>;</span> <span class=n>index</span><span class=o>++)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>String</span> <span class=n>checkStr</span> <span class=o>=</span> <span class=n>initParams</span><span class=o>[</span><span class=n>index</span><span class=o>].</span><span class=na>getClass</span><span class=o>().</span><span class=na>getSimpleName</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=o>(</span><span class=n>checkStr</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=s>&#34;Integer&#34;</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>paramTypes</span><span class=o>[</span><span class=n>index</span><span class=o>]</span> <span class=o>=</span> <span class=kt>int</span><span class=o>.</span><span class=na>class</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=o>(</span><span class=n>checkStr</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=s>&#34;Double&#34;</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>paramTypes</span><span class=o>[</span><span class=n>index</span><span class=o>]</span> <span class=o>=</span> <span class=kt>double</span><span class=o>.</span><span class=na>class</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=o>(</span><span class=n>checkStr</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=s>&#34;Boolean&#34;</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>paramTypes</span><span class=o>[</span><span class=n>index</span><span class=o>]</span> <span class=o>=</span> <span class=kt>boolean</span><span class=o>.</span><span class=na>class</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=o>(</span><span class=n>checkStr</span><span class=o>.</span><span class=na>contains</span><span class=o>(</span><span class=s>&#34;String&#34;</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>paramTypes</span><span class=o>[</span><span class=n>index</span><span class=o>]</span> <span class=o>=</span> <span class=n>initParams</span><span class=o>[</span><span class=n>index</span><span class=o>].</span><span class=na>getClass</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=n>Constructor</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>constructor</span> <span class=o>=</span> <span class=n>classInstance</span><span class=o>.</span><span class=na>getDeclaredConstructor</span><span class=o>(</span><span class=n>paramTypes</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>constructor</span><span class=o>.</span><span class=na>setAccessible</span><span class=o>(</span><span class=kc>true</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>entityObj</span> <span class=o>=</span> <span class=n>constructor</span><span class=o>.</span><span class=na>newInstance</span><span class=o>(</span><span class=n>initParams</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>EntityCreator</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=nf>setValue</span><span class=o>(</span><span class=n>String</span> <span class=n>paramName</span><span class=o>,</span> <span class=n>Object</span> <span class=n>paramValue</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Field</span> <span class=n>field</span> <span class=o>=</span> <span class=n>classInstance</span><span class=o>.</span><span class=na>getDeclaredField</span><span class=o>(</span><span class=n>paramName</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>field</span><span class=o>.</span><span class=na>setAccessible</span><span class=o>(</span><span class=kc>true</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>field</span><span class=o>.</span><span class=na>set</span><span class=o>(</span><span class=n>entityObj</span><span class=o>,</span> <span class=n>paramValue</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>this</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>T</span> <span class=nf>build</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>entityObj</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>​ 如此，可移除整个内部 Builder 类，NutritionFacts 类私有构造的参数仅包括两个必填的 servingSize、servings 字段：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>NutritionFacts</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Required parameters
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>servingSize</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>servings</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Optional parameters - initialized to default values
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>calories</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>fat</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>sodium</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kt>int</span> <span class=n>carbohydrate</span> <span class=o>=</span> <span class=mi>0</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=nf>NutritionFacts</span><span class=o>(</span><span class=kt>int</span> <span class=n>servingSize</span><span class=o>,</span> <span class=kt>int</span> <span class=n>servings</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>servingSize</span> <span class=o>=</span> <span class=n>servingSize</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>servings</span> <span class=o>=</span> <span class=n>servings</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>该案例的客户端代码改为：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>NutritionFacts</span> <span class=n>cocaCola</span> <span class=o>=</span> <span class=k>new</span> <span class=n>EntityCreator</span><span class=o>&lt;&gt;(</span><span class=n>NutritionFacts</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=mi>240</span><span class=o>,</span> <span class=mi>8</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>setValue</span><span class=o>(</span><span class=s>&#34;calories&#34;</span><span class=o>,</span> <span class=mi>100</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>setValue</span><span class=o>(</span><span class=s>&#34;sodium&#34;</span><span class=o>,</span> <span class=mi>35</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>setValue</span><span class=o>(</span><span class=s>&#34;carbohydrate&#34;</span><span class=o>,</span> <span class=mi>27</span><span class=o>).</span><span class=na>build</span><span class=o>();</span>
</span></span></code></pre></div></div><footer class=post-footer><nav class=paginav><a class=prev href=https://blog.chensoul.com/posts/2023/04/04/weekly_review_13/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></svg>&nbsp;Prev Page</span><br><span>周报-13｜健身、记账、更新SSL证书、代码提交百度站点收录</span></a>
<a class=next href=https://blog.chensoul.com/posts/2023/04/03/static-factory-methods-instead-of-constructors/><span class=title>Next Page&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span><br><span>《Effective Java 3》笔记1：静态工厂方法代替构造函数</span></a></nav></footer><div class=comments-separator></div></article></main><footer class=footer><span>&copy; 2023 <a href=https://blog.chensoul.com/>ChenSoul</a></span><span style=display:inline-block;margin-left:1em>
<a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA</a></span>
<span style=display:inline-block;margin-left:1em>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
    <a href=https://github.com/reorx/hugo-PaperModX/ rel=noopener target=_blank>PaperModX</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script async src=https://umami.chensoul.com/random-string.js data-website-id=821c25f8-a31a-4607-92d7-91ee76843d00></script>
<script>(function(){const t=""=="1";if(t)return;let e=document.getElementById("theme-toggle");e.removeEventListener("click",toggleThemeListener),e.addEventListener("click",toggleThemeListener)})()</script><script>(function(){let e=document.getElementById("menu");e&&(e.scrollLeft=localStorage.getItem("menu-scroll-position"),e.onscroll=function(){localStorage.setItem("menu-scroll-position",e.scrollLeft)});const t=""=="1",n="1"=="1";if(window.matchMedia("(prefers-reduced-motion: reduce)").matches||t||n)return;document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})})()</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>if(window.scrollListeners)for(const e of scrollListeners)window.removeEventListener("scroll",e);window.scrollListeners=[]</script><script src=/js/medium-zoom.min.js data-no-instant></script>
<script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script>(function(){const a="1"=="1";if(!a)return;if(!document.querySelector(".toc")){console.log("no toc found, ignore toc scroll");return}const r=window.scrollListeners,t=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id]"),n="active";let e=t[0];o(e).classList.add(n);const c=()=>{const s=[];for(const e of t)if(l(e)<5)s.push(e);else break;s.length>0?newActiveHeading=s[s.length-1]:newActiveHeading=t[0],e!=newActiveHeading&&(o(e).classList.remove(n),e=newActiveHeading,o(e).classList.add(n))};let s=null;const i=()=>{s!==null&&clearTimeout(s),s=setTimeout(c,50)};window.addEventListener("scroll",i,!1),r.push(i);function o(e){const t=encodeURI(e.getAttribute("id")).toLowerCase();return document.querySelector(`.toc ul li a[href="#${t}"]`)}function l(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect();return t.top}})()</script><script>mediumZoom(".entry-cover img"),mediumZoom(".post-content img:not([no-zoom])")</script><script src=/js/instantclick.min.js data-no-instant></script>
<script data-no-instant>InstantClick.init()</script></body></html>