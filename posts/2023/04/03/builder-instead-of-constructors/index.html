<!doctype html><html lang=en-US prefix="og: http://ogp.me/ns#"><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="本文是 《Effective Java 3》第二章的学习笔记，在整理笔记过程中，通过 chatgpt 的帮助做了一些扩展。"><title>《Effective Java 3》笔记2：使用构造器代替构造方法 | ChenSoul</title>
<link rel=canonical href=https://blog.chensoul.cc/posts/2023/04/03/builder-instead-of-constructors/><link rel=preconnect href=https://fonts.font.im><link rel=preconnect href=https://fonts.loli.net crossorigin><link href="https://fonts.loli.net/css2?family=Roboto+Slab:wght@400;500;700&display=swap" rel=stylesheet><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.chensoul.cc/images/favicon.webp"><meta name=twitter:title content="《Effective Java 3》笔记2：使用构造器代替构造方法"><meta name=twitter:description content="本文是 《Effective Java 3》第二章的学习笔记，在整理笔记过程中，通过 chatgpt 的帮助做了一些扩展。"><meta name=twitter:creator content="@ichensoul"><meta property="og:locale" content="en_US"><meta property="og:site_name" content="chensoul"><meta property="og:url" content="https://blog.chensoul.cc/posts/2023/04/03/builder-instead-of-constructors/"><meta property="og:site_name" content="ChenSoul"><meta property="og:title" content="《Effective Java 3》笔记2：使用构造器代替构造方法"><meta property="og:description" content="本文是 《Effective Java 3》第二章的学习笔记，在整理笔记过程中，通过 chatgpt 的帮助做了一些扩展。"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-04-03T00:00:00+00:00"><meta property="article:modified_time" content="2023-04-03T00:00:00+00:00"><meta property="article:tag" content="Java"><meta property="og:image" content="https://blog.chensoul.cc/images/favicon.webp"><meta itemprop=name content="《Effective Java 3》笔记2：使用构造器代替构造方法"><meta itemprop=description content="本文是 《Effective Java 3》第二章的学习笔记，在整理笔记过程中，通过 chatgpt 的帮助做了一些扩展。"><meta itemprop=datePublished content="2023-04-03T00:00:00+00:00"><meta itemprop=dateModified content="2023-04-03T00:00:00+00:00"><meta itemprop=wordCount content="2000"><meta itemprop=image content="https://blog.chensoul.cc/images/favicon.webp"><meta itemprop=keywords content="Java"><link rel=stylesheet href=https://cdnjs.loli.net/ajax/libs/font-awesome/6.4.0/css/all.min.css media=all><link rel=stylesheet href=/main.min.css type=text/css media=all><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"TechArticle","name":"《Effective Java 3》笔记2：使用构造器代替构造方法","headline":"《Effective Java 3》笔记2：使用构造器代替构造方法","inLanguage":"en-US","url":"https://blog.chensoul.cc/posts/2023/04/03/builder-instead-of-constructors/","description":"\u003cp\u003e本文是 《Effective Java 3》第二章的学习笔记，在整理笔记过程中，通过 chatgpt 的帮助做了一些扩展。\u003c/p\u003e","wordCount":"2000","keywords":["java"],"datePublished":"2023-04-03T00:00:00Z","dateModified":"2023-04-03T00:00:00Z","author":{"@type":"Person","name":"chensoul"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.chensoul.cc/posts/2023/04/03/builder-instead-of-constructors/"},"publisher":{"@type":"Organization","name":"chensoul","url":"https://blog.chensoul.cc/posts/2023/04/03/builder-instead-of-constructors/"}},{"@context":"https://schema.org","@type":"Organization","name":"chensoul","url":"https://blog.chensoul.cc/","sameAs":["https://x.com/ichensoul","https://github.com/chensoul","https://www.linkedin.com/in/","https://www.youtube.com/@chensoul","https://t.me/chensouls"]}]}</script></head><body class="home blog post-layout-one-column"><button onclick=topFunction() id=scrollTopBtn title="Go to top">
<i class="fa-solid fa-arrow-up"></i></button><div id=header-top class=header-bar-wrap></div><div id=page class=site><a class="skip-link screen-reader-text" href=#content>Skip to content</a><header id=masthead class="site-header clearfix" role=banner><div class="header-main container clearfix"><div id=logo class="site-branding clearfix"><h1 class=site-title><a href=/ title=ChenSoul rel=home>ChenSoul</a></h1><p class=site-description>Java, Spring Boot, Microservice, Cloud, Architecture and DevOps Tutorials</p></div><div class="header-widgets clearfix"><aside id=search-2 class="header-widget widget_search"><form role=search method=get class=search-form onsubmit="return searchSite(event)"><label><span class=screen-reader-text>Search for:</span>
<input type=search class=search-field placeholder="Enter search keyword" name=query id=query title="Enter search keyword">
</label><button type=submit class=search-submit title=Search> <span class=genericon-search></span>
<span class=screen-reader-text>Search</span></button></form></aside></div></div><div id=main-navigation-wrap class=primary-navigation-wrap><nav id=main-navigation class="primary-navigation navigation container clearfix" role=navigation><ul id=menu-home class=main-navigation-menu><li class="menu-item menu-item-type-custom menu-item-object-custom
current-menu-item current_page_item menu-item-home"><a href=/>Home</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/categories/spring-boot/>Spring Boot</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/categories/architecture/>Architecture</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/categories/microservice/>Microservice</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/categories/kubernetes/>Kubernetes</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category
menu-item-has-children"><a href=/tutorials/>Tutorials</a><ul class=sub-menu><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/spring-boot-tutorials/>Spring Boot Tutorials</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/microservice-tutorials/>Microservice Tutorials</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/kubernetes-tutorials/>Kubernetes Tutorials</a></li></ul></li><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=https://github.com/chensoul target=_blank>About Me</a></li></ul></nav></div></header><div id=content class="site-content container clearfix"><section id=primary class="content-archive content-area post-content-area"><main id=main class=site-main role=main><article class="post type-post"><div class=post-inner-content><header class=entry-header><h2 class=entry-title><a href=https://blog.chensoul.cc/posts/2023/04/03/builder-instead-of-constructors/ rel=bookmark title="《Effective Java 3》笔记2：使用构造器代替构造方法">《Effective Java 3》笔记2：使用构造器代替构造方法</a></h2><hr><div class=entry-meta><span class=meta-date><time class="entry-date published" datetime=2023-04-03T00:00:00>2023-04-03
</time></span><span class=meta-author><span class="author vcard">chensoul</span>
</span><span class="tagcloud post-tags"><i class="fa fa-tags"></i>&nbsp;
<a class="tag-cloud-link widget__link widget__link--taglist" href=/tags/java/ title=java>java</a></span></div></header><div style=background-color:#f1f3f5;margin-top:20px><aside style=margin:5px><span style=font-size:20px;font-weight:700>Table of Contents</span><div style=padding-left:30px><nav id=TableOfContents><ul><li><a href=#介绍>介绍</a></li><li><a href=#优点>优点</a></li><li><a href=#缺点>缺点</a></li><li><a href=#层次构建器>层次构建器</a><ul><li><a href=#使用>使用</a></li></ul></li><li><a href=#使用-1>使用</a><ul><li><a href=#retrofit>Retrofit</a></li><li><a href=#gson>Gson</a></li><li><a href=#apache-httpclient>Apache HttpClient</a></li><li><a href=#apache-kafka>Apache Kafka</a></li><li><a href=#apache-commons-configuration>Apache Commons Configuration</a></li><li><a href=#guava>Guava</a></li><li><a href=#jpa>JPA</a></li><li><a href=#spring-framework>Spring Framework</a></li></ul></li><li><a href=#优化>优化</a><ul><li><a href=#使用静态内部类优化建造者模式>使用静态内部类优化建造者模式</a></li><li><a href=#使用流式接口优化建造者模式>使用流式接口优化建造者模式</a></li><li><a href=#使用默认值优化建造者模式>使用默认值优化建造者模式</a></li><li><a href=#使用-java-8-中的-optional-类优化建造者模式>使用 Java 8 中的 Optional 类优化建造者模式</a></li><li><a href=#使用-lambda-表达式优化建造者模式>使用 Lambda 表达式优化建造者模式</a></li><li><a href=#使用泛型和反射优化>使用泛型和反射优化</a></li></ul></li></ul></nav></div></aside></div><div class=entry-content><p>本文是 《Effective Java 3》第二章的学习笔记，在整理笔记过程中，通过 chatgpt 的帮助做了一些扩展。</p><h2 id=介绍>介绍</h2><p>当一个类需要多个构造函数参数时，可以考虑使用<strong>构建器模式</strong>来创建对象。构建器模式是一种创建对象的设计模式，它可以通过链式调用方法的方式来设置对象的构造参数，并最终返回一个构造完整的对象。</p><h2 id=优点>优点</h2><p>使用构建器模式的原因有以下几点：</p><ol><li>避免构造函数参数过多的问题：当一个类需要多个构造函数参数时，构造函数的参数列表可能会变得很长，这会导致代码难以理解和维护。使用构建器模式可以将构造函数参数拆分成多个方法，从而使代码更加清晰易懂。</li><li>提高代码的可读性和可维护性：使用构建器模式可以使代码更加易懂和易维护，因为可以通过方法名来清晰地表达每个参数的含义。</li><li>提供更多的灵活性和可定制性：构建器模式可以提供更多的灵活性和可定制性，因为可以在构造对象时进行更多的逻辑处理和判断。例如，可以在构建器中添加验证逻辑，以确保参数的有效性。</li><li>支持多线程环境：构建器模式可以支持多线程环境，因为每个构建器都是独立的，不会受到其他线程的影响。</li></ol><p>以下是一个例子：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NutritionFacts</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> servingSize;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> servings;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> calories;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> fat;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> sodium;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> carbohydrate;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>NutritionFacts</span>(Builder builder) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>servingSize</span> <span style=color:#f92672>=</span> builder.<span style=color:#a6e22e>servingSize</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>servings</span> <span style=color:#f92672>=</span> builder.<span style=color:#a6e22e>servings</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>calories</span> <span style=color:#f92672>=</span> builder.<span style=color:#a6e22e>calories</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>fat</span> <span style=color:#f92672>=</span> builder.<span style=color:#a6e22e>fat</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>sodium</span> <span style=color:#f92672>=</span> builder.<span style=color:#a6e22e>sodium</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>carbohydrate</span> <span style=color:#f92672>=</span> builder.<span style=color:#a6e22e>carbohydrate</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>//省略 get set</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Builder</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Required parameters</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> servingSize;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> servings;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Optional parameters - initialized to default values</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> calories <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> fat <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> sodium <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> carbohydrate <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>Builder</span>(<span style=color:#66d9ef>int</span> servingSize, <span style=color:#66d9ef>int</span> servings) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>servingSize</span> <span style=color:#f92672>=</span> servingSize;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>servings</span> <span style=color:#f92672>=</span> servings;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> Builder <span style=color:#a6e22e>calories</span>(<span style=color:#66d9ef>int</span> calories) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>calories</span> <span style=color:#f92672>=</span> calories;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> Builder <span style=color:#a6e22e>fat</span>(<span style=color:#66d9ef>int</span> fat) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>fat</span> <span style=color:#f92672>=</span> fat;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> Builder <span style=color:#a6e22e>sodium</span>(<span style=color:#66d9ef>int</span> sodium) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>sodium</span> <span style=color:#f92672>=</span> sodium;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> Builder <span style=color:#a6e22e>carbohydrate</span>(<span style=color:#66d9ef>int</span> carbohydrate) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>carbohydrate</span> <span style=color:#f92672>=</span> carbohydrate;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> NutritionFacts <span style=color:#a6e22e>build</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> NutritionFacts(<span style=color:#66d9ef>this</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>在上述示例中，我们定义了一个名为 NutritionFacts 的类，它包含了一些营养成分的信息，例如每份的大小、总份数、卡路里、脂肪、钠和碳水化合物等成员变量。我们还定义了一个名为 Builder 的静态内部类，用于构建 NutritionFacts 对象。</p><p>在 Builder 类中，我们定义了一个带有两个参数的构造方法，并在其中初始化了必需的成员变量 servingSize 和 servings。我们还定义了一些可选的方法，用于设置 NutritionFacts 对象的卡路里、脂肪、钠和碳水化合物等成员变量。这些方法都支持链式调用，并返回 Builder 对象本身，以便进行多次方法调用。</p><p>在 Builder 类中，我们最终定义了一个 build() 方法，用于创建 NutritionFacts 对象并返回。在 build() 方法中，我们调用 NutritionFacts 的私有构造器并将 Builder 对象作为参数传递进去，从而创建 NutritionFacts 对象并初始化其成员变量。</p><p>现在，我们可以使用 NutritionFacts.Builder 类来创建 NutritionFacts 对象，并使用链式调用来设置 NutritionFacts 对象的成员变量。例如，我们可以使用以下代码来创建一个每份大小为 240ml、总共有 8 份、卡路里为 100、脂肪为 2、钠为 35、碳水化合物为 27 的 NutritionFacts 对象：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>NutritionFacts cocaCola <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> NutritionFacts.<span style=color:#a6e22e>Builder</span>(240, 8)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>calories</span>(100)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>fat</span>(2)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>sodium</span>(35)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>carbohydrate</span>(27)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>build</span>();
</span></span></code></pre></div><p>在上述代码中，我们首先创建了一个 NutritionFacts.Builder 对象，并在构造函数中传递了每份大小和总份数等参数。然后，我们使用链式调用来设置卡路里、脂肪、钠和碳水化合物等成员变量，并最终调用 build() 方法来创建 NutritionFacts 对象。</p><p>可以使用 lombok 注解来简化代码，但是，<strong>无法在构造器的构造方法里设置必要参数。</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> lombok.Builder;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Builder</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NutritionFacts</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> servingSize;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> servings;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> calories;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> fat;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> sodium;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> carbohydrate;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=缺点>缺点</h2><p>虽然构建器模式可以提高代码的可读性、可维护性以及提供更多的灵活性和可定制性，但它也有一些缺点，包括：</p><ol><li>增加代码复杂度：使用构建器模式会增加代码的复杂度，因为需要创建一个独立的构建器类，并且需要在构建器类中定义多个方法来设置对象的属性。这会增加代码量并且需要更多的时间来编写和维护代码。</li><li>增加内存开销：使用构建器模式需要创建一个独立的构建器对象，并且需要在构建器对象中保存对象的属性。这会增加内存开销，并且在创建对象时需要更多的时间和资源。</li><li>对于简单对象不适用：构建器模式更适用于构造复杂对象，对于简单对象来说，使用构建器模式可能会增加代码的复杂度和开销。</li><li>需要额外的代码：使用构建器模式需要编写额外的代码来创建构建器类和定义方法。如果只需要构造一个简单的对象，使用构建器模式可能会浪费时间和资源。</li></ol><h2 id=层次构建器>层次构建器</h2><p>层次构建器（Hierarchical Builder）是一种构建器模式的扩展，它允许创建层次结构的对象，并支持在父对象中嵌套子对象。它通常由一个抽象的构建器接口，多个具体的构建器实现和一个指导者（Director）组成。</p><p>在层次构建器中，每个构建器都负责创建特定类型的对象，并且可以在其构建方法中调用其他构建器的构建方法来创建嵌套的子对象。指导者负责协调构建器的顺序和调用构建器的方法来构建对象层次结构。</p><p>层次构建器模式的优点包括：</p><ol><li>支持创建复杂的对象层次结构，能够构建包含多个层次和嵌套子对象的对象。</li><li>提供了更好的可读性和可维护性，因为每个构建器都只需要关注一个特定类型的对象，而且可以通过方法名来清晰地表达每个参数的含义。</li><li>提供了更多的灵活性和可定制性，因为可以在构建器中添加验证逻辑，以确保参数的有效性，并且可以动态地组合构建器来创建不同类型的对象。</li></ol><p>层次构建器模式的缺点包括：</p><ol><li><p>代码量：由于层次构建器模式需要定义多个构建器类，因此代码量会比较大，尤其是在构建复杂对象时。</p></li><li><p>嵌套层次：层次构建器模式中的对象层次结构是通过嵌套多个构建器实现的，这会导致代码的嵌套层次较深，可能会影响代码的可读性和可维护性。</p></li><li><p>可能会增加内存开销：因为每个构建器都需要创建一个独立的对象，并且需要在构建器对象中保存对象的属性。对于大型对象和多级嵌套结构，开销可能会很大。</p></li><li><p>不适合简单对象的构建：层次构建器模式适用于构建复杂对象层次结构，但对于简单的对象构建，使用层次构建器模式可能会显得过于繁琐和不必要。</p></li></ol><h3 id=使用>使用</h3><h4 id=举例-1>举例 1</h4><p>1、定义抽象的构建器接口，用于创建不同类型的对象和添加子对象：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>ComputerBuilder</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>buildCPU</span>(String model);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>buildGPU</span>(String model);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>buildMemory</span>(<span style=color:#66d9ef>int</span> size);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addStorage</span>(String type, <span style=color:#66d9ef>int</span> size);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addPeripheral</span>(String type);
</span></span><span style=display:flex><span>    Computer <span style=color:#a6e22e>getResult</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>2、创建具体的构建器实现，用于构建不同类型的对象和添加子对象：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DesktopBuilder</span> <span style=color:#66d9ef>implements</span> ComputerBuilder {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Desktop computer <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Desktop();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>buildCPU</span>(String model) {
</span></span><span style=display:flex><span>        computer.<span style=color:#a6e22e>setCPU</span>(<span style=color:#66d9ef>new</span> CPU(model));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>buildGPU</span>(String model) {
</span></span><span style=display:flex><span>        computer.<span style=color:#a6e22e>setGPU</span>(<span style=color:#66d9ef>new</span> GPU(model));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>buildMemory</span>(<span style=color:#66d9ef>int</span> size) {
</span></span><span style=display:flex><span>        computer.<span style=color:#a6e22e>setMemory</span>(<span style=color:#66d9ef>new</span> Memory(size));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addStorage</span>(String type, <span style=color:#66d9ef>int</span> size) {
</span></span><span style=display:flex><span>        computer.<span style=color:#a6e22e>addStorage</span>(<span style=color:#66d9ef>new</span> Storage(type, size));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addPeripheral</span>(String type) {
</span></span><span style=display:flex><span>        computer.<span style=color:#a6e22e>addPeripheral</span>(<span style=color:#66d9ef>new</span> Peripheral(type));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Computer <span style=color:#a6e22e>getResult</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> computer;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LaptopBuilder</span> <span style=color:#66d9ef>implements</span> ComputerBuilder {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Laptop computer <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Laptop();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>buildCPU</span>(String model) {
</span></span><span style=display:flex><span>        computer.<span style=color:#a6e22e>setCPU</span>(<span style=color:#66d9ef>new</span> CPU(model));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>buildGPU</span>(String model) {
</span></span><span style=display:flex><span>        computer.<span style=color:#a6e22e>setGPU</span>(<span style=color:#66d9ef>new</span> GPU(model));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>buildMemory</span>(<span style=color:#66d9ef>int</span> size) {
</span></span><span style=display:flex><span>        computer.<span style=color:#a6e22e>setMemory</span>(<span style=color:#66d9ef>new</span> Memory(size));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addStorage</span>(String type, <span style=color:#66d9ef>int</span> size) {
</span></span><span style=display:flex><span>        computer.<span style=color:#a6e22e>addStorage</span>(<span style=color:#66d9ef>new</span> Storage(type, size));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addPeripheral</span>(String type) {
</span></span><span style=display:flex><span>        computer.<span style=color:#a6e22e>addPeripheral</span>(<span style=color:#66d9ef>new</span> Peripheral(type));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Computer <span style=color:#a6e22e>getResult</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> computer;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>3、创建指导者类，用于协调构建器的顺序和调用构建器的方法来构建对象层次结构：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ComputerDirector</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> ComputerBuilder builder;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>ComputerDirector</span>(ComputerBuilder builder) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>builder</span> <span style=color:#f92672>=</span> builder;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>construct</span>() {
</span></span><span style=display:flex><span>        builder.<span style=color:#a6e22e>buildCPU</span>(<span style=color:#e6db74>&#34;Intel Core i7&#34;</span>);
</span></span><span style=display:flex><span>        builder.<span style=color:#a6e22e>buildGPU</span>(<span style=color:#e6db74>&#34;Nvidia GeForce RTX 3080&#34;</span>);
</span></span><span style=display:flex><span>        builder.<span style=color:#a6e22e>buildMemory</span>(16);
</span></span><span style=display:flex><span>        builder.<span style=color:#a6e22e>addStorage</span>(<span style=color:#e6db74>&#34;SSD&#34;</span>, 512);
</span></span><span style=display:flex><span>        builder.<span style=color:#a6e22e>addPeripheral</span>(<span style=color:#e6db74>&#34;Keyboard&#34;</span>);
</span></span><span style=display:flex><span>        builder.<span style=color:#a6e22e>addPeripheral</span>(<span style=color:#e6db74>&#34;Mouse&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>4、使用层次构建器模式创建计算机系统对象：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>ComputerBuilder desktopBuilder <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> DesktopBuilder();
</span></span><span style=display:flex><span>ComputerBuilder laptopBuilder <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> LaptopBuilder();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ComputerDirector director <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ComputerDirector(desktopBuilder);
</span></span><span style=display:flex><span>director.<span style=color:#a6e22e>construct</span>();
</span></span><span style=display:flex><span>Computer desktop <span style=color:#f92672>=</span> desktopBuilder.<span style=color:#a6e22e>getResult</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>director <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ComputerDirector(laptopBuilder);
</span></span><span style=display:flex><span>director.<span style=color:#a6e22e>construct</span>();
</span></span><span style=display:flex><span>Computer laptop <span style=color:#f92672>=</span> laptopBuilder.<span style=color:#a6e22e>getResult</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 将两个计算机系统对象组合成一个更大的计算机系统对象</span>
</span></span><span style=display:flex><span>ComputerSystem system <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ComputerSystem();
</span></span><span style=display:flex><span>system.<span style=color:#a6e22e>addComputer</span>(desktop);
</span></span><span style=display:flex><span>system.<span style=color:#a6e22e>addComputer</span>(laptop);
</span></span></code></pre></div><p>在上面的示例中，DesktopBuilder 和 LaptopBuilder 分别是具体的构建器实现，用于创建桌面计算机和笔记本电脑对象。ComputerDirector 是指导者类，用于协调构建器的顺序和调用构建器的方法来构建对象层次结构。使用 ComputerDirector 构建计算机系统对象时，可以先使用 DesktopBuilder 构建桌面计算机对象，再使用 LaptopBuilder 构建笔记本电脑对象，最后将两个计算机系统对象组合成一个更大的计算机系统对象。</p><p>下面是另一个使用层次构建器模式创建层次结构对象的例子，假设需要创建一个组织结构的层次结构对象，其中包含多个部门和嵌套子部门：</p><p>1、定义抽象的构建器接口，用于创建不同类型的对象和添加子对象：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>DepartmentBuilder</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>buildName</span>(String name);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>buildManager</span>(String manager);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addSubDepartment</span>(Department subDepartment);
</span></span><span style=display:flex><span>    Department <span style=color:#a6e22e>getResult</span>();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DepartmentImpl</span> <span style=color:#66d9ef>implements</span> Department {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> String name;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> String manager;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> List<span style=color:#f92672>&lt;</span>Department<span style=color:#f92672>&gt;</span> subDepartments <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setName</span>(String name) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> name;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setManager</span>(String manager) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>manager</span> <span style=color:#f92672>=</span> manager;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addSubDepartment</span>(Department subDepartment) {
</span></span><span style=display:flex><span>        subDepartments.<span style=color:#a6e22e>add</span>(subDepartment);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>removeSubDepartment</span>(Department subDepartment) {
</span></span><span style=display:flex><span>        subDepartments.<span style=color:#a6e22e>remove</span>(subDepartment);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>Department<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getSubDepartments</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> subDepartments;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getName</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> name;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getManager</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> manager;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DevelopmentDepartment</span> <span style=color:#66d9ef>extends</span> DepartmentImpl {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 添加特定于开发部门的属性和方法</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SalesDepartment</span> <span style=color:#66d9ef>extends</span> DepartmentImpl {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 添加特定于销售部门的属性和方法</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>2、创建具体的构建器实现，用于构建不同类型的对象和添加子对象：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SalesDepartmentBuilder</span> <span style=color:#66d9ef>implements</span> DepartmentBuilder {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> SalesDepartment department <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SalesDepartment();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>buildName</span>(String name) {
</span></span><span style=display:flex><span>        department.<span style=color:#a6e22e>setName</span>(name);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>buildManager</span>(String manager) {
</span></span><span style=display:flex><span>        department.<span style=color:#a6e22e>setManager</span>(manager);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addSubDepartment</span>(Department subDepartment) {
</span></span><span style=display:flex><span>        department.<span style=color:#a6e22e>addSubDepartment</span>(subDepartment);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Department <span style=color:#a6e22e>getResult</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> department;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DevelopmentDepartmentBuilder</span> <span style=color:#66d9ef>implements</span> DepartmentBuilder {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> DevelopmentDepartment department <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> DevelopmentDepartment();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>buildName</span>(String name) {
</span></span><span style=display:flex><span>        department.<span style=color:#a6e22e>setName</span>(name);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>buildManager</span>(String manager) {
</span></span><span style=display:flex><span>        department.<span style=color:#a6e22e>setManager</span>(manager);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>addSubDepartment</span>(Department subDepartment) {
</span></span><span style=display:flex><span>        department.<span style=color:#a6e22e>addSubDepartment</span>(subDepartment);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Department <span style=color:#a6e22e>getResult</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> department;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>3、创建指导者类，用于协调构建器的顺序和调用构建器的方法来构建对象层次结构：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrganizationDirector</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> DepartmentBuilder builder;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>OrganizationDirector</span>(DepartmentBuilder builder) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>builder</span> <span style=color:#f92672>=</span> builder;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>construct</span>() {
</span></span><span style=display:flex><span>        builder.<span style=color:#a6e22e>buildName</span>(<span style=color:#e6db74>&#34;Organization&#34;</span>);
</span></span><span style=display:flex><span>        builder.<span style=color:#a6e22e>buildManager</span>(<span style=color:#e6db74>&#34;CEO&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Department salesDept <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SalesDepartment();
</span></span><span style=display:flex><span>        salesDept.<span style=color:#a6e22e>setName</span>(<span style=color:#e6db74>&#34;Sales Department&#34;</span>);
</span></span><span style=display:flex><span>        salesDept.<span style=color:#a6e22e>setManager</span>(<span style=color:#e6db74>&#34;Sales Manager&#34;</span>);
</span></span><span style=display:flex><span>        builder.<span style=color:#a6e22e>addSubDepartment</span>(salesDept);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Department devDept <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> DevelopmentDepartment();
</span></span><span style=display:flex><span>        devDept.<span style=color:#a6e22e>setName</span>(<span style=color:#e6db74>&#34;Development Department&#34;</span>);
</span></span><span style=display:flex><span>        devDept.<span style=color:#a6e22e>setManager</span>(<span style=color:#e6db74>&#34;Development Manager&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Department frontendDevDept <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> DevelopmentDepartment();
</span></span><span style=display:flex><span>        frontendDevDept.<span style=color:#a6e22e>setName</span>(<span style=color:#e6db74>&#34;Front-end Development Department&#34;</span>);
</span></span><span style=display:flex><span>        frontendDevDept.<span style=color:#a6e22e>setManager</span>(<span style=color:#e6db74>&#34;Front-end Development Manager&#34;</span>);
</span></span><span style=display:flex><span>        devDept.<span style=color:#a6e22e>addSubDepartment</span>(frontendDevDept);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Department backendDevDept <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> DevelopmentDepartment();
</span></span><span style=display:flex><span>        backendDevDept.<span style=color:#a6e22e>setName</span>(<span style=color:#e6db74>&#34;Back-end Development Department&#34;</span>);
</span></span><span style=display:flex><span>        backendDevDept.<span style=color:#a6e22e>setManager</span>(<span style=color:#e6db74>&#34;Back-end Development Manager&#34;</span>);
</span></span><span style=display:flex><span>        devDept.<span style=color:#a6e22e>addSubDepartment</span>(backendDevDept);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        builder.<span style=color:#a6e22e>addSubDepartment</span>(devDept);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>4、使用层次构建器模式创建组织结构对象：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>DepartmentBuilder salesDeptBuilder <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SalesDepartmentBuilder();
</span></span><span style=display:flex><span>DepartmentBuilder devDeptBuilder <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> DevelopmentDepartmentBuilder();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>OrganizationDirector director <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> OrganizationDirector(salesDeptBuilder);
</span></span><span style=display:flex><span>director.<span style=color:#a6e22e>construct</span>();
</span></span><span style=display:flex><span>Department salesDept <span style=color:#f92672>=</span> salesDeptBuilder.<span style=color:#a6e22e>getResult</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>director <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> OrganizationDirector(devDeptBuilder);
</span></span><span style=display:flex><span>director.<span style=color:#a6e22e>construct</span>();
</span></span><span style=display:flex><span>Department devDept <span style=color:#f92672>=</span> devDeptBuilder.<span style=color:#a6e22e>getResult</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 将两个部门对象组合成一个更大的组织结构对象</span>
</span></span><span style=display:flex><span>Organization organization <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Organization();
</span></span><span style=display:flex><span>organization.<span style=color:#a6e22e>addDepartment</span>(salesDept);
</span></span><span style=display:flex><span>organization.<span style=color:#a6e22e>addDepartment</span>(devDept);
</span></span></code></pre></div><p>在上面的示例中，SalesDepartmentBuilder 和 DevelopmentDepartmentBuilder 分别是具体的构建器实现，用于创建销售部门和开发部门对象。OrganizationDirector 是指导者类，用于协调构建器的顺序和调用构建器的方法来构建对象层次结构。使用 OrganizationDirector 构建组织结构对象时，可以先使用 SalesDepartmentBuilder 构建销售部门对象，再使用 DevelopmentDepartmentBuilder 构建开发部门对象，最后将两个部门对象组合成一个更大的组织结构对象。</p><h4 id=举例-2>举例 2</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ComputerComponent</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> String manufacturer;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> String model;
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#a6e22e>ComputerComponent</span>(Builder<span style=color:#f92672>&lt;?&gt;</span> builder) {
</span></span><span style=display:flex><span>        manufacturer <span style=color:#f92672>=</span> builder.<span style=color:#a6e22e>manufacturer</span>;
</span></span><span style=display:flex><span>        model <span style=color:#f92672>=</span> builder.<span style=color:#a6e22e>model</span>;
</span></span><span style=display:flex><span>        <span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getManufacturer</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> manufacturer;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getModel</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> model;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Builder</span><span style=color:#f92672>&lt;</span>T <span style=color:#66d9ef>extends</span> Builder<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;&gt;</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> String manufacturer;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> String model;
</span></span><span style=display:flex><span>        <span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> T <span style=color:#a6e22e>setManufacturer</span>(String manufacturer) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>manufacturer</span> <span style=color:#f92672>=</span> manufacturer;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> self();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> T <span style=color:#a6e22e>setModel</span>(String model) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>model</span> <span style=color:#f92672>=</span> model;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> self();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>abstract</span> T <span style=color:#a6e22e>self</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> ComputerComponent <span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Motherboard</span> <span style=color:#66d9ef>extends</span> ComputerComponent {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> String socketType;
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#a6e22e>Motherboard</span>(Builder builder) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span>(builder);
</span></span><span style=display:flex><span>        socketType <span style=color:#f92672>=</span> builder.<span style=color:#a6e22e>socketType</span>;
</span></span><span style=display:flex><span>        <span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getSocketType</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> socketType;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Builder</span> <span style=color:#66d9ef>extends</span> ComputerComponent.<span style=color:#a6e22e>Builder</span><span style=color:#f92672>&lt;</span>Builder<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> String socketType;
</span></span><span style=display:flex><span>        <span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> Builder <span style=color:#a6e22e>setSocketType</span>(String socketType) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>socketType</span> <span style=color:#f92672>=</span> socketType;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>protected</span> Builder <span style=color:#a6e22e>self</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> Motherboard <span style=color:#a6e22e>build</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Motherboard(<span style=color:#66d9ef>this</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CPU</span> <span style=color:#66d9ef>extends</span> ComputerComponent {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> coreCount;
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#a6e22e>CPU</span>(Builder builder) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span>(builder);
</span></span><span style=display:flex><span>        coreCount <span style=color:#f92672>=</span> builder.<span style=color:#a6e22e>coreCount</span>;
</span></span><span style=display:flex><span>        <span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getCoreCount</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> coreCount;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Builder</span> <span style=color:#66d9ef>extends</span> ComputerComponent.<span style=color:#a6e22e>Builder</span><span style=color:#f92672>&lt;</span>Builder<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> coreCount;
</span></span><span style=display:flex><span>        <span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> Builder <span style=color:#a6e22e>setCoreCount</span>(<span style=color:#66d9ef>int</span> coreCount) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>coreCount</span> <span style=color:#f92672>=</span> coreCount;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>protected</span> Builder <span style=color:#a6e22e>self</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> CPU <span style=color:#a6e22e>build</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> CPU(<span style=color:#66d9ef>this</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Computer</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Motherboard motherboard;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> CPU cpu;
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#a6e22e>Computer</span>(Builder builder) {
</span></span><span style=display:flex><span>        motherboard <span style=color:#f92672>=</span> builder.<span style=color:#a6e22e>motherboard</span>;
</span></span><span style=display:flex><span>        cpu <span style=color:#f92672>=</span> builder.<span style=color:#a6e22e>cpu</span>;
</span></span><span style=display:flex><span>        <span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Motherboard <span style=color:#a6e22e>getMotherboard</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> motherboard;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> CPU <span style=color:#a6e22e>getCpu</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> cpu;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Builder</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> Motherboard motherboard;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> CPU cpu;
</span></span><span style=display:flex><span>        <span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> Builder <span style=color:#a6e22e>setMotherboard</span>(Motherboard motherboard) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>motherboard</span> <span style=color:#f92672>=</span> motherboard;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> Builder <span style=color:#a6e22e>setCpu</span>(CPU cpu) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>cpu</span> <span style=color:#f92672>=</span> cpu;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> Computer <span style=color:#a6e22e>build</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Computer(<span style=color:#66d9ef>this</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>使用示例：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Motherboard.<span style=color:#a6e22e>Builder</span> motherboardBuilder <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Motherboard.<span style=color:#a6e22e>Builder</span>()
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>setManufacturer</span>(<span style=color:#e6db74>&#34;ASUS&#34;</span>)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>setModel</span>(<span style=color:#e6db74>&#34;ROG Strix Z590-E Gaming&#34;</span>)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>setSocketType</span>(<span style=color:#e6db74>&#34;LGA 1200&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>CPU.<span style=color:#a6e22e>Builder</span> cpuBuilder <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> CPU.<span style=color:#a6e22e>Builder</span>()
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>setManufacturer</span>(<span style=color:#e6db74>&#34;Intel&#34;</span>)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>setModel</span>(<span style=color:#e6db74>&#34;Core i9-11900K&#34;</span>)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>setCoreCount</span>(8)
</span></span><span style=display:flex><span>        <span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Computer.<span style=color:#a6e22e>Builder</span> computerBuilder <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Computer.<span style=color:#a6e22e>Builder</span>()
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>setMotherboard</span>(motherboardBuilder.<span style=color:#a6e22e>build</span>())
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>setCpu</span>(cpuBuilder.<span style=color:#a6e22e>build</span>())
</span></span><span style=display:flex><span>        <span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Computer computer <span style=color:#f92672>=</span> computerBuilder.<span style=color:#a6e22e>build</span>();
</span></span></code></pre></div><p>在这个示例中，<code>ComputerComponent</code> 类是一个抽象基类，定义了计算机组件的基本属性和方法。它还定义了一个抽象的构建器类，用于构建它的子类的实例。</p><p>每个 <code>ComputerComponent</code> 的具体子类都有自己的具体构建器类，该类扩展了抽象构建器类。具体构建器提供了设置相应组件属性的方法，例如主板的制造商、型号和插座类型，处理器的时钟速度和内存的容量。</p><p><code>Computer</code> 类代表一个完整的计算机系统，并具有用于构建 <code>Computer</code> 类的实例的构建器类。<code>Computer.Builder</code> 类提供了设置每个组件属性的方法，使用 <code>Consumer</code> 函数接口来接受配置相应构建器的 lambda 表达式。</p><h2 id=使用-1>使用</h2><p>以下是几个常见开源框架中使用建造者模式的例子：</p><h3 id=retrofit>Retrofit</h3><p>Retrofit 是一个 Android 和 Java 平台上的 RESTful API 库，它使用建造者模式来创建 RestAdapter 对象。RestAdapter.Builder 类是一个建造者类，它包含了一系列的方法，用于设置 Retrofit 的配置选项，如设置 API 的 base URL、设置 HTTP Client、设置 Converter 等。</p><p>示例代码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>RestAdapter restAdapter <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> RestAdapter.<span style=color:#a6e22e>Builder</span>()
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>setEndpoint</span>(<span style=color:#e6db74>&#34;https://api.github.com&#34;</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>setClient</span>(<span style=color:#66d9ef>new</span> OkClient())
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>setLogLevel</span>(RestAdapter.<span style=color:#a6e22e>LogLevel</span>.<span style=color:#a6e22e>FULL</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>build</span>();
</span></span></code></pre></div><h3 id=gson>Gson</h3><p>Gson 是一个用于在 Java 对象和 JSON 数据之间进行序列化和反序列化的库。它使用建造者模式来创建 Gson 对象。GsonBuilder 类是一个建造者类，它包含了一系列的方法，用于配置 Gson 的行为，如设置日期格式、设置字段的命名策略等。</p><p>示例代码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Gson gson <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> GsonBuilder()
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>setDateFormat</span>(<span style=color:#e6db74>&#34;yyyy-MM-dd&#39;T&#39;HH:mm:ssZ&#34;</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>setFieldNamingPolicy</span>(FieldNamingPolicy.<span style=color:#a6e22e>LOWER_CASE_WITH_UNDERSCORES</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>create</span>();
</span></span></code></pre></div><h3 id=apache-httpclient>Apache HttpClient</h3><p>Apache HttpClient 是一个用于创建 HTTP 客户端的库，它使用建造者模式来创建 HttpClient 对象。HttpClientBuilder 类是一个建造者类，它包含了一系列的方法，用于配置 HttpClient 的行为，如设置连接池、设置代理、设置 Cookie 管理器等。</p><p>示例代码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>HttpClient httpClient <span style=color:#f92672>=</span> HttpClientBuilder.<span style=color:#a6e22e>create</span>()
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>setMaxConnTotal</span>(100)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>setMaxConnPerRoute</span>(10)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>setProxy</span>(<span style=color:#66d9ef>new</span> HttpHost(<span style=color:#e6db74>&#34;localhost&#34;</span>, 8080))
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>setDefaultCookieStore</span>(<span style=color:#66d9ef>new</span> BasicCookieStore())
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>build</span>();
</span></span></code></pre></div><h3 id=apache-kafka>Apache Kafka</h3><p>Apache Kafka 是一个分布式消息队列系统，它使用建造者模式来创建 Producer 和 Consumer 对象。ProducerConfig 和 ConsumerConfig 类是建造者类，它们包含了一系列的方法，用于配置 Producer 和 Consumer 的行为，如设置 broker 地址、设置序列化器等。</p><p>示例代码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Properties producerProps <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Properties();
</span></span><span style=display:flex><span>producerProps.<span style=color:#a6e22e>put</span>(ProducerConfig.<span style=color:#a6e22e>BOOTSTRAP_SERVERS_CONFIG</span>, <span style=color:#e6db74>&#34;localhost:9092&#34;</span>);
</span></span><span style=display:flex><span>producerProps.<span style=color:#a6e22e>put</span>(ProducerConfig.<span style=color:#a6e22e>KEY_SERIALIZER_CLASS_CONFIG</span>, StringSerializer.<span style=color:#a6e22e>class</span>.<span style=color:#a6e22e>getName</span>());
</span></span><span style=display:flex><span>producerProps.<span style=color:#a6e22e>put</span>(ProducerConfig.<span style=color:#a6e22e>VALUE_SERIALIZER_CLASS_CONFIG</span>, StringSerializer.<span style=color:#a6e22e>class</span>.<span style=color:#a6e22e>getName</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Producer<span style=color:#f92672>&lt;</span>String, String<span style=color:#f92672>&gt;</span> producer <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> KafkaProducer<span style=color:#f92672>&lt;&gt;</span>(producerProps);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Properties consumerProps <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Properties();
</span></span><span style=display:flex><span>consumerProps.<span style=color:#a6e22e>put</span>(ConsumerConfig.<span style=color:#a6e22e>BOOTSTRAP_SERVERS_CONFIG</span>, <span style=color:#e6db74>&#34;localhost:9092&#34;</span>);
</span></span><span style=display:flex><span>consumerProps.<span style=color:#a6e22e>put</span>(ConsumerConfig.<span style=color:#a6e22e>KEY_DESERIALIZER_CLASS_CONFIG</span>, StringDeserializer.<span style=color:#a6e22e>class</span>.<span style=color:#a6e22e>getName</span>());
</span></span><span style=display:flex><span>consumerProps.<span style=color:#a6e22e>put</span>(ConsumerConfig.<span style=color:#a6e22e>VALUE_DESERIALIZER_CLASS_CONFIG</span>, StringDeserializer.<span style=color:#a6e22e>class</span>.<span style=color:#a6e22e>getName</span>());
</span></span><span style=display:flex><span>consumerProps.<span style=color:#a6e22e>put</span>(ConsumerConfig.<span style=color:#a6e22e>GROUP_ID_CONFIG</span>, <span style=color:#e6db74>&#34;my-group&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Consumer<span style=color:#f92672>&lt;</span>String, String<span style=color:#f92672>&gt;</span> consumer <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> KafkaConsumer<span style=color:#f92672>&lt;&gt;</span>(consumerProps);
</span></span></code></pre></div><h3 id=apache-commons-configuration>Apache Commons Configuration</h3><p>Apache Commons Configuration 是一个用于读取和写入各种配置文件的库，它使用建造者模式来创建 Configuration 对象。ConfigurationBuilder 类是一个建造者类，它包含了一系列的方法，用于配置 Configuration 的行为，如设置配置文件类型、设置属性的分隔符等。</p><p>示例代码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Configuration config <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ConfigurationBuilder()
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>setDelimiterParsingDisabled</span>(<span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>setFile</span>(<span style=color:#66d9ef>new</span> File(<span style=color:#e6db74>&#34;config.properties&#34;</span>))
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>setListDelimiterHandler</span>(<span style=color:#66d9ef>new</span> DefaultListDelimiterHandler(<span style=color:#e6db74>&#39;,&#39;</span>))
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>build</span>();
</span></span></code></pre></div><h3 id=guava>Guava</h3><p>Guava 是一个 Google 开发的 Java 库，它包含了许多实用的工具类和数据结构，其中包括使用建造者模式来创建的 ImmutableList、ImmutableMap 和 ImmutableSet 等不可变集合类。</p><p>示例代码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>ImmutableList<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> list <span style=color:#f92672>=</span> ImmutableList.<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span>builder()
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;foo&#34;</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;bar&#34;</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;baz&#34;</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ImmutableMap<span style=color:#f92672>&lt;</span>String, Integer<span style=color:#f92672>&gt;</span> map <span style=color:#f92672>=</span> ImmutableMap.<span style=color:#f92672>&lt;</span>String, Integer<span style=color:#f92672>&gt;</span>builder()
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>put</span>(<span style=color:#e6db74>&#34;foo&#34;</span>, 1)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>put</span>(<span style=color:#e6db74>&#34;bar&#34;</span>, 2)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>put</span>(<span style=color:#e6db74>&#34;baz&#34;</span>, 3)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ImmutableSet<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> set <span style=color:#f92672>=</span> ImmutableSet.<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span>builder()
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;foo&#34;</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;bar&#34;</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>add</span>(<span style=color:#e6db74>&#34;baz&#34;</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>build</span>();
</span></span></code></pre></div><h3 id=jpa>JPA</h3><p>Java Persistence API（JPA）是 Java EE 平台的一个 ORM 框架，它使用建造者模式来创建 EntityManagerFactory 对象。EntityManagerFactoryBuilder 类是一个建造者类，它包含了一系列的方法，用于配置 EntityManagerFactory 的行为，如设置数据源、设置 JPA 的属性等。</p><p>示例代码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>EntityManagerFactory entityManagerFactory <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> EntityManagerFactoryBuilder()
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>dataSource</span>(myDataSource)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>persistenceUnit</span>(<span style=color:#e6db74>&#34;myPersistenceUnit&#34;</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>properties</span>(myProperties)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>build</span>();
</span></span></code></pre></div><h3 id=spring-framework>Spring Framework</h3><p>Spring Framework 是一个 Java 平台上的开源应用程序框架，它使用建造者模式来创建 RestTemplate 和 HttpHeaders 对象。RestTemplateBuilder 和 HttpHeadersBuilder 类是建造者类，它们包含了一系列的方法，用于配置 RestTemplate 和 HttpHeaders 的行为，如设置连接超时、设置请求头等。</p><p>示例代码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>RestTemplate restTemplate <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> RestTemplateBuilder()
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>setConnectTimeout</span>(Duration.<span style=color:#a6e22e>ofSeconds</span>(10))
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>setReadTimeout</span>(Duration.<span style=color:#a6e22e>ofSeconds</span>(10))
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>HttpHeaders headers <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HttpHeadersBuilder()
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>setContentType</span>(MediaType.<span style=color:#a6e22e>APPLICATION_JSON</span>)
</span></span><span style=display:flex><span>    .<span style=color:#a6e22e>build</span>();
</span></span></code></pre></div><h2 id=优化>优化</h2><p>建造者模式的优化主要包括以下几个方面：</p><h3 id=使用静态内部类优化建造者模式>使用静态内部类优化建造者模式</h3><p>建造者模式通常使用一个 Builder 类来构建复杂对象，为了避免 Builder 类变得过于臃肿，可以将其设计为静态内部类，这样可以使代码更加清晰，同时也能够保证线程安全。</p><h3 id=使用流式接口优化建造者模式>使用流式接口优化建造者模式</h3><p>流式接口是一种链式调用的方式，它可以将多个方法调用连接起来，形成一个链式结构，使得代码更加简洁易读。在建造者模式中，可以使用流式接口来优化 Builder 类，使得客户端可以通过链式调用的方式来创建复杂对象，从而简化代码。</p><h3 id=使用默认值优化建造者模式>使用默认值优化建造者模式</h3><p>在建造者模式中，有些属性是必须的，而有些属性是可选的，可以使用默认值来为可选属性设置默认值，从而避免客户端必须为每个可选属性都提供值的情况，同时也能够简化客户端代码。</p><h3 id=使用-java-8-中的-optional-类优化建造者模式>使用 Java 8 中的 Optional 类优化建造者模式</h3><p>Java 8 中引入了 Optional 类，该类可以用于处理可能为 null 的值，可以进一步优化建造者模式中的代码。</p><p>在建造者模式中，我们通常需要设置多个属性，其中有些属性可能是可选的，如果直接使用 null 来表示可选属性的值，可能会导致代码出现空指针异常，而使用 Optional 类可以避免这个问题。</p><p>下面是一个使用 Optional 类优化建造者模式的示例代码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> java.util.Optional;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Computer</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String cpu;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String memory;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String hardDisk;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Optional<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> graphicsCard;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>Computer</span>(ComputerBuilder builder) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>cpu</span> <span style=color:#f92672>=</span> builder.<span style=color:#a6e22e>cpu</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>memory</span> <span style=color:#f92672>=</span> builder.<span style=color:#a6e22e>memory</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>hardDisk</span> <span style=color:#f92672>=</span> builder.<span style=color:#a6e22e>hardDisk</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>graphicsCard</span> <span style=color:#f92672>=</span> builder.<span style=color:#a6e22e>graphicsCard</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 省略getter方法</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ComputerBuilder</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> String cpu;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> String memory;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> String hardDisk;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> Optional<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> graphicsCard <span style=color:#f92672>=</span> Optional.<span style=color:#a6e22e>empty</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> ComputerBuilder <span style=color:#a6e22e>setCpu</span>(String cpu) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>cpu</span> <span style=color:#f92672>=</span> cpu;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> ComputerBuilder <span style=color:#a6e22e>setMemory</span>(String memory) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>memory</span> <span style=color:#f92672>=</span> memory;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> ComputerBuilder <span style=color:#a6e22e>setHardDisk</span>(String hardDisk) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>hardDisk</span> <span style=color:#f92672>=</span> hardDisk;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> ComputerBuilder <span style=color:#a6e22e>setGraphicsCard</span>(String graphicsCard) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>graphicsCard</span> <span style=color:#f92672>=</span> Optional.<span style=color:#a6e22e>ofNullable</span>(graphicsCard);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> Computer <span style=color:#a6e22e>build</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Computer(<span style=color:#66d9ef>this</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>在这个示例代码中，我们使用 <code>Optional</code> 类来表示可选属性的值，将 graphicsCard 属性的类型改为<code>Optional&lt;String></code>。在 ComputerBuilder 类中，我们使用 <code>Optional.ofNullable </code>方法来将可选属性的值转换为 Optional 对象，并在调用 build 方法时，将 Optional 对象转换为普通的字符串类型。</p><h3 id=使用-lambda-表达式优化建造者模式>使用 Lambda 表达式优化建造者模式</h3><p>Lambda 表达式是 Java 8 中引入的一种新的语言特性，可以进一步优化建造者模式中的代码，使得代码更加简洁易读。</p><p>在建造者模式中，我们通常需要定义多个属性，并在构造方法中进行初始化。使用 Lambda 表达式可以避免定义多个属性的问题，将属性的赋值操作通过 Lambda 表达式传递给构造方法。</p><p>下面是一个使用 Lambda 表达式优化建造者模式的示例代码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> java.util.Optional;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.function.Consumer;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Computer</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String cpu;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String memory;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String hardDisk;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Optional<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> graphicsCard;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>Computer</span>(Consumer<span style=color:#f92672>&lt;</span>ComputerBuilder<span style=color:#f92672>&gt;</span> builder) {
</span></span><span style=display:flex><span>        ComputerBuilder computerBuilder <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ComputerBuilder();
</span></span><span style=display:flex><span>        builder.<span style=color:#a6e22e>accept</span>(computerBuilder);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>cpu</span> <span style=color:#f92672>=</span> computerBuilder.<span style=color:#a6e22e>cpu</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>memory</span> <span style=color:#f92672>=</span> computerBuilder.<span style=color:#a6e22e>memory</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>hardDisk</span> <span style=color:#f92672>=</span> computerBuilder.<span style=color:#a6e22e>hardDisk</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>graphicsCard</span> <span style=color:#f92672>=</span> computerBuilder.<span style=color:#a6e22e>graphicsCard</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 省略getter方法</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ComputerBuilder</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> String cpu;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> String memory;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> String hardDisk;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> Optional<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> graphicsCard <span style=color:#f92672>=</span> Optional.<span style=color:#a6e22e>empty</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> ComputerBuilder <span style=color:#a6e22e>setCpu</span>(String cpu) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>cpu</span> <span style=color:#f92672>=</span> cpu;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> ComputerBuilder <span style=color:#a6e22e>setMemory</span>(String memory) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>memory</span> <span style=color:#f92672>=</span> memory;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> ComputerBuilder <span style=color:#a6e22e>setHardDisk</span>(String hardDisk) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>hardDisk</span> <span style=color:#f92672>=</span> hardDisk;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> ComputerBuilder <span style=color:#a6e22e>setGraphicsCard</span>(String graphicsCard) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>graphicsCard</span> <span style=color:#f92672>=</span> Optional.<span style=color:#a6e22e>ofNullable</span>(graphicsCard);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>        Computer computer <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Computer(builder <span style=color:#f92672>-&gt;</span> builder
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>setCpu</span>(<span style=color:#e6db74>&#34;Intel i7&#34;</span>)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>setMemory</span>(<span style=color:#e6db74>&#34;16GB&#34;</span>)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>setHardDisk</span>(<span style=color:#e6db74>&#34;512GB SSD&#34;</span>)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>setGraphicsCard</span>(<span style=color:#e6db74>&#34;NVIDIA GTX 1660&#34;</span>));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>在这个示例代码中，我们将 Computer 类的构造方法改为接收一个 <code>Consumer&lt;ComputerBuilder> </code>类型的参数，这个参数表示一个包含属性赋值操作的 Lambda 表达式。在构造方法中，我们先创建一个 ComputerBuilder 对象，然后通过 Lambda 表达式调用 ComputerBuilder 对象的方法来设置属性值，并最终通过 ComputerBuilder 对象创建 Computer 对象。</p><h3 id=使用泛型和反射优化>使用泛型和反射优化</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>EntityCreator</span><span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Class<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> classInstance;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> T entityObj;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>EntityCreator</span>(Class<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> classInstance, Object... initParams) <span style=color:#66d9ef>throws</span> Exception {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>classInstance</span> <span style=color:#f92672>=</span> classInstance;
</span></span><span style=display:flex><span>        Class<span style=color:#f92672>&lt;?&gt;[]</span> paramTypes <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Class<span style=color:#f92672>&lt;?&gt;[</span>initParams.<span style=color:#a6e22e>length</span><span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> index <span style=color:#f92672>=</span> 0, length <span style=color:#f92672>=</span> initParams.<span style=color:#a6e22e>length</span>; index <span style=color:#f92672>&lt;</span> length; index<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            String checkStr <span style=color:#f92672>=</span> initParams<span style=color:#f92672>[</span>index<span style=color:#f92672>]</span>.<span style=color:#a6e22e>getClass</span>().<span style=color:#a6e22e>getSimpleName</span>();
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (checkStr.<span style=color:#a6e22e>contains</span>(<span style=color:#e6db74>&#34;Integer&#34;</span>)) {
</span></span><span style=display:flex><span>                paramTypes<span style=color:#f92672>[</span>index<span style=color:#f92672>]</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>int</span>.<span style=color:#a6e22e>class</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (checkStr.<span style=color:#a6e22e>contains</span>(<span style=color:#e6db74>&#34;Double&#34;</span>)) {
</span></span><span style=display:flex><span>                paramTypes<span style=color:#f92672>[</span>index<span style=color:#f92672>]</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>double</span>.<span style=color:#a6e22e>class</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (checkStr.<span style=color:#a6e22e>contains</span>(<span style=color:#e6db74>&#34;Boolean&#34;</span>)) {
</span></span><span style=display:flex><span>                paramTypes<span style=color:#f92672>[</span>index<span style=color:#f92672>]</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>boolean</span>.<span style=color:#a6e22e>class</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (checkStr.<span style=color:#a6e22e>contains</span>(<span style=color:#e6db74>&#34;String&#34;</span>)) {
</span></span><span style=display:flex><span>                paramTypes<span style=color:#f92672>[</span>index<span style=color:#f92672>]</span> <span style=color:#f92672>=</span> initParams<span style=color:#f92672>[</span>index<span style=color:#f92672>]</span>.<span style=color:#a6e22e>getClass</span>();
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        Constructor<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> constructor <span style=color:#f92672>=</span> classInstance.<span style=color:#a6e22e>getDeclaredConstructor</span>(paramTypes);
</span></span><span style=display:flex><span>        constructor.<span style=color:#a6e22e>setAccessible</span>(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>entityObj</span> <span style=color:#f92672>=</span> constructor.<span style=color:#a6e22e>newInstance</span>(initParams);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> EntityCreator<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>setValue</span>(String paramName, Object paramValue) <span style=color:#66d9ef>throws</span> Exception {
</span></span><span style=display:flex><span>        Field field <span style=color:#f92672>=</span> classInstance.<span style=color:#a6e22e>getDeclaredField</span>(paramName);
</span></span><span style=display:flex><span>        field.<span style=color:#a6e22e>setAccessible</span>(<span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>        field.<span style=color:#a6e22e>set</span>(entityObj, paramValue);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> T <span style=color:#a6e22e>build</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> entityObj;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>​ 如此，可移除整个内部 Builder 类，NutritionFacts 类私有构造的参数仅包括两个必填的 servingSize、servings 字段：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NutritionFacts</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Required parameters</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> servingSize;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>int</span> servings;
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Optional parameters - initialized to default values</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> calories <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> fat <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> sodium <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> carbohydrate <span style=color:#f92672>=</span> 0;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>NutritionFacts</span>(<span style=color:#66d9ef>int</span> servingSize, <span style=color:#66d9ef>int</span> servings) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>servingSize</span> <span style=color:#f92672>=</span> servingSize;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>servings</span> <span style=color:#f92672>=</span> servings;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>该案例的客户端代码改为：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>NutritionFacts cocaCola <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> EntityCreator<span style=color:#f92672>&lt;&gt;</span>(NutritionFacts.<span style=color:#a6e22e>class</span>, 240, 8)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>setValue</span>(<span style=color:#e6db74>&#34;calories&#34;</span>, 100)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>setValue</span>(<span style=color:#e6db74>&#34;sodium&#34;</span>, 35)
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>setValue</span>(<span style=color:#e6db74>&#34;carbohydrate&#34;</span>, 27).<span style=color:#a6e22e>build</span>();
</span></span></code></pre></div></div><div><div style=font-weight:700>Share this post:</div><a class=social-link-item href="https://twitter.com/intent/tweet?text=%e3%80%8aEffective%20Java%203%e3%80%8b%e7%ac%94%e8%ae%b02%ef%bc%9a%e4%bd%bf%e7%94%a8%e6%9e%84%e9%80%a0%e5%99%a8%e4%bb%a3%e6%9b%bf%e6%9e%84%e9%80%a0%e6%96%b9%e6%b3%95 https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f04%2f03%2fbuilder-instead-of-constructors%2f" target=_blank rel="noopener noreferrer" title="Click to share on Twitter"><i class="fa-brands fa-square-twitter fa-2xl" style=color:#55acee></i>
</a><a class=social-link-item href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f04%2f03%2fbuilder-instead-of-constructors%2f&title=%e3%80%8aEffective%20Java%203%e3%80%8b%e7%ac%94%e8%ae%b02%ef%bc%9a%e4%bd%bf%e7%94%a8%e6%9e%84%e9%80%a0%e5%99%a8%e4%bb%a3%e6%9b%bf%e6%9e%84%e9%80%a0%e6%96%b9%e6%b3%95" target=_blank rel="noopener noreferrer" title="Click to share on LinkedIn"><i class="fa-brands fa-linkedin fa-2xl" style=color:#007bb5></i>
</a><a class=social-link-item href="https://telegram.me/share/url?text=%e3%80%8aEffective%20Java%203%e3%80%8b%e7%ac%94%e8%ae%b02%ef%bc%9a%e4%bd%bf%e7%94%a8%e6%9e%84%e9%80%a0%e5%99%a8%e4%bb%a3%e6%9b%bf%e6%9e%84%e9%80%a0%e6%96%b9%e6%b3%95&amp;url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f04%2f03%2fbuilder-instead-of-constructors%2f" target=_blank rel="noopener noreferrer" title="Click to share on telegram"><i class="fa-brands fa-telegram fa-2xl" style=color:#007bb5></i>
</a><a class=social-link-item href="https://reddit.com/submit?url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f04%2f03%2fbuilder-instead-of-constructors%2f&title=%e3%80%8aEffective%20Java%203%e3%80%8b%e7%ac%94%e8%ae%b02%ef%bc%9a%e4%bd%bf%e7%94%a8%e6%9e%84%e9%80%a0%e5%99%a8%e4%bb%a3%e6%9b%bf%e6%9e%84%e9%80%a0%e6%96%b9%e6%b3%95" target=_blank rel="noopener noreferrer" title="Click to share on reddit"><i class="fa-brands fa-reddit fa-2xl" style=color:#007bb5></i>
</a><a class=social-link-item href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f04%2f03%2fbuilder-instead-of-constructors%2f" target=_blank rel="noopener noreferrer" title="Click to share on facebook"><i class="fa-brands fa-facebook fa-2xl" style=color:#007bb5></i>
</a><a class=social-link-item href="https://api.whatsapp.com/send?text=%e3%80%8aEffective%20Java%203%e3%80%8b%e7%ac%94%e8%ae%b02%ef%bc%9a%e4%bd%bf%e7%94%a8%e6%9e%84%e9%80%a0%e5%99%a8%e4%bb%a3%e6%9b%bf%e6%9e%84%e9%80%a0%e6%96%b9%e6%b3%95%20-%20https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f04%2f03%2fbuilder-instead-of-constructors%2f" target=_blank rel="noopener noreferrer" title="Click to share on whatsapp"><i class="fa-brands fa-whatsapp fa-2xl" style=color:#007bb5></i></a></div></div></article><nav class="navigation post-navigation" role=navigation><h2 class=screen-reader-text>Post navigation</h2><div class=nav-links><div class=nav-previous><a href=/posts/2023/04/03/static-factory-methods-instead-of-constructors/ rel=next><span class=post-title>《Effective Java 3》笔记1：静态工厂方法代替构造函数</span></a></div><div class=nav-next><a href=/posts/2023/03/28/weekly_review_12/ rel=prev><span class=post-title>周报-12｜车辆被堵、开车总结、Effective Java3笔记</span></a></div></div></nav><h2>Related content</h2><ul><li><a href=/posts/2023/12/14/all-things-about-microprofile/>All things about MicroProfile</a></li><li><a href=/posts/2023/11/02/jhipster-intro/>JHipster安装和介绍</a></li><li><a href=/posts/2023/10/26/java-design-patterns-circuit-breaker/>Java设计模式：Circuit Breaker</a></li><li><a href=/posts/2023/10/16/java-design-patterns-chain/>Java设计模式：Chain</a></li><li><a href=/posts/2023/10/13/java-design-patterns-callback/>Java设计模式：Callback</a></li><li><a href=/posts/2023/09/25/java-design-patterns-cahcing/>Java设计模式：Caching</a></li><li><a href=/posts/2023/09/22/java-design-patterns-bytecode/>Java设计模式：Bytecode</a></li><li><a href=/posts/2023/09/05/java-design-patterns-builder/>Java设计模式：Builder</a></li><li><a href=/posts/2023/09/05/java-design-patterns-business-delegate/>Java设计模式：Business Delegate</a></li><li><a href=/posts/2023/08/28/java-design-patterns-bridge/>Java设计模式：Bridge</a></li></ul></main></section></div><div id=footer class=footer-wrap><footer id=colophon class="site-footer container clearfix" role=contentinfo><div id=footer-text class=site-info><span class=credit-link><a href=/ target=_blank rel="noopener noreferrer">ChenSoul</a>
Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a>
<a style=margin-left:20px href=/privacy_policy/ target=_blank rel="noopener noreferrer">Privacy Policy</a></span></div></footer></div></div><script type=text/javascript src=/main.min.js></script></body></html>