<!doctype html><html lang=en-US prefix="og: http://ogp.me/ns#"><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="本文主要介绍 Abstract Document 模式，在 Java Design Patterns 网站上有对该模式进行介绍。这里主要是做个笔记，并添加一些扩展，以加深对该设计模式的理解。"><title>Java设计模式：Abstract Document | ChenSoul</title>
<link rel=canonical href=https://blog.chensoul.cc/posts/2023/05/22/java-design-patterns-abstract-document/><link rel=preconnect href=https://fonts.font.im><link rel=preconnect href=https://fonts.loli.net crossorigin><link href="https://fonts.loli.net/css2?family=Roboto+Slab:wght@400;500;700&display=swap" rel=stylesheet><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.chensoul.cc/raw-images/favicon.jpg"><meta name=twitter:title content="Java设计模式：Abstract Document"><meta name=twitter:description content="本文主要介绍 Abstract Document 模式，在 Java Design Patterns 网站上有对该模式进行介绍。这里主要是做个笔记，并添加一些扩展，以加深对该设计模式的理解。"><meta property="og:locale" content="en_US"><meta property="og:site_name" content="chensoul"><meta property="og:url" content="https://blog.chensoul.cc/posts/2023/05/22/java-design-patterns-abstract-document/"><meta property="og:site_name" content="ChenSoul"><meta property="og:title" content="Java设计模式：Abstract Document"><meta property="og:description" content="本文主要介绍 Abstract Document 模式，在 Java Design Patterns 网站上有对该模式进行介绍。这里主要是做个笔记，并添加一些扩展，以加深对该设计模式的理解。"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-05-22T00:00:00+00:00"><meta property="article:modified_time" content="2023-05-22T00:00:00+00:00"><meta property="article:tag" content="Java"><meta property="og:image" content="https://blog.chensoul.cc/raw-images/favicon.jpg"><meta itemprop=name content="Java设计模式：Abstract Document"><meta itemprop=description content="本文主要介绍 Abstract Document 模式，在 Java Design Patterns 网站上有对该模式进行介绍。这里主要是做个笔记，并添加一些扩展，以加深对该设计模式的理解。"><meta itemprop=datePublished content="2023-05-22T00:00:00+00:00"><meta itemprop=dateModified content="2023-05-22T00:00:00+00:00"><meta itemprop=wordCount content="1874"><meta itemprop=image content="https://blog.chensoul.cc/raw-images/favicon.jpg"><meta itemprop=keywords content="Java"><link rel=stylesheet href=https://cdnjs.loli.net/ajax/libs/font-awesome/6.4.0/css/all.min.css media=all><link rel=stylesheet href=/main.min.css type=text/css media=all><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"TechArticle","name":"Java设计模式：Abstract Document","headline":"Java设计模式：Abstract Document","inLanguage":"en-US","url":"https://blog.chensoul.cc/posts/2023/05/22/java-design-patterns-abstract-document/","description":"\u003cp\u003e本文主要介绍 Abstract Document 模式，在 \u003ca href=\"https://java-design-patterns.com/\" target=\"_blank\"\u003eJava Design Patterns\u003c/a\u003e 网站上有对该模式进行介绍。这里主要是做个笔记，并添加一些扩展，以加深对该设计模式的理解。\u003c/p\u003e","wordCount":"1874","keywords":["java"],"datePublished":"2023-05-22T00:00:00Z","dateModified":"2023-05-22T00:00:00Z","author":{"@type":"Person","name":"chensoul"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.chensoul.cc/posts/2023/05/22/java-design-patterns-abstract-document/"},"publisher":{"@type":"Organization","name":"chensoul","url":"https://blog.chensoul.cc/posts/2023/05/22/java-design-patterns-abstract-document/"}},{"@context":"https://schema.org","@type":"Organization","name":"chensoul","url":"https://blog.chensoul.cc/","sameAs":["https://twitter.com/","https://github.com/chensoul","https://www.linkedin.com/in/"]}]}</script></head><body class="home blog post-layout-one-column"><button onclick=topFunction() id=scrollTopBtn title="Go to top">
<i class="fa-solid fa-arrow-up"></i></button><div id=header-top class=header-bar-wrap></div><div id=page class=site><a class="skip-link screen-reader-text" href=#content>Skip to content</a><header id=masthead class="site-header clearfix" role=banner><div class="header-main container clearfix"><div id=logo class="site-branding clearfix"><h1 class=site-title><a href=/ title=ChenSoul rel=home>ChenSoul</a></h1><p class=site-description>Java, Spring Boot, Microservice, Cloud, Architecture and DevOps Tutorials</p></div><div class="header-widgets clearfix"><aside id=search-2 class="header-widget widget_search"><form role=search method=get class=search-form onsubmit="return searchSite(event)"><label><span class=screen-reader-text>Search for:</span>
<input type=search class=search-field placeholder="Enter search keyword" name=query id=query title="Enter search keyword">
</label><button type=submit class=search-submit title=Search> <span class=genericon-search></span>
<span class=screen-reader-text>Search</span></button></form></aside></div></div><div id=main-navigation-wrap class=primary-navigation-wrap><nav id=main-navigation class="primary-navigation navigation container clearfix" role=navigation><ul id=menu-home class=main-navigation-menu><li class="menu-item menu-item-type-custom menu-item-object-custom
current-menu-item current_page_item menu-item-home"><a href=/>Home</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/categories/spring-boot/>Spring Boot</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/categories/architecture/>Architecture</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/categories/microservice/>Microservice</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/categories/kubernetes/>Kubernetes</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category
menu-item-has-children"><a href=/tutorials/>Tutorials</a><ul class=sub-menu><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/spring-boot-tutorials/>Spring Boot Tutorials</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/microservice-tutorials/>Microservice Tutorials</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/kubernetes-tutorials/>Kubernetes Tutorials</a></li></ul></li><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=https://github.com/chensoul target=_blank>About Me</a></li></ul></nav></div></header><div id=content class="site-content container clearfix"><section id=primary class="content-archive content-area post-content-area"><main id=main class=site-main role=main><article class="post type-post"><div class=post-inner-content><header class=entry-header><h2 class=entry-title><a href=https://blog.chensoul.cc/posts/2023/05/22/java-design-patterns-abstract-document/ rel=bookmark title="Java设计模式：Abstract Document">Java设计模式：Abstract Document</a></h2><hr><div class=entry-meta><span class=meta-date><time class="entry-date published" datetime=2023-05-22T00:00:00>2023-05-22
</time></span><span class=meta-author><span class="author vcard">chensoul</span>
</span><span class="tagcloud post-tags"><i class="fa fa-tags"></i>&nbsp;
<a class="tag-cloud-link widget__link widget__link--taglist" href=/tags/java/ title=java>java</a></span></div></header><div class=entry-content><p>本文主要介绍 Abstract Document 模式，在 <a href=https://java-design-patterns.com/ target=_blank>Java Design Patterns</a> 网站上有对该模式进行介绍。这里主要是做个笔记，并添加一些扩展，以加深对该设计模式的理解。</p><blockquote><p><a href=https://java-design-patterns.com/ target=_blank>Java Design Patterns</a> 提供了各种 Java 设计模式的介绍、示例代码和用例说明。该网站旨在帮助 Java 开发人员了解和应用各种常见的设计模式，以提高代码的可读性、可维护性和可扩展性。</p><p>Java Design Patterns 网站提供了多种设计模式分类方式，包括创建型模式（Creational Patterns）、结构型模式（Structural Patterns）和行为型模式（Behavioral Patterns），以及其他一些常见的模式。</p><p>对于每个设计模式，该网站提供了详细的介绍、示例代码和用例说明，并且提供了一些常见的使用场景和注意事项。开发人员可以根据自己的需求选择适合自己的设计模式，并且可以参考示例代码和用例说明来理解和应用该模式。</p><p>此外，Java Design Patterns 网站还提供了一些其他资源，如设计模式的 UML 图、设计模式的优缺点、设计模式的比较等。这些资源可以帮助开发人员更好地理解和应用设计模式。</p><p>中文网站：<a href=https://java-design-patterns.com/zh/ target=_blank>https://java-design-patterns.com/zh/</a></p><p>Github 上源码仓库（非官方）：<a href=https://github.com/iluwatar/java-design-patterns target=_blank>https://github.com/iluwatar/java-design-patterns</a></p></blockquote><h2 id=目的>目的</h2><p>使用动态属性，并在保持类型安全的同时实现非类型化语言的灵活性。</p><blockquote><p>抽象文档模式中的属性对象可以动态添加和删除属性，并且属性类型是在运行时确定的，这使得抽象文档模式具有一定的灵活性和可扩展性。</p><p>在抽象文档模式中，属性对象通常使用 Map 或者 List 等数据结构来实现。动态属性的添加和删除可以通过 Map 的 put 和 remove 方法实现，而属性的类型可以通过泛型来确定。</p></blockquote><h2 id=解释>解释</h2><p>抽象文档模式使您能够处理其他非静态属性。 此模式使用特征的概念来实现类型安全，并将不同类的属性分离为一组接口。</p><p>真实世界例子</p><blockquote><p>考虑由多个部分组成的汽车。 但是，我们不知道特定汽车是否真的拥有所有零件，或者仅仅是零件中的一部分。 我们的汽车是动态而且非常灵活的。</p></blockquote><p>通俗的说</p><blockquote><p>抽象文档模式允许在对象不知道的情况下将属性附加到对象。</p></blockquote><p>维基百科说</p><blockquote><p>面向对象的结构设计模式，用于组织松散类型的键值存储中的对象并使用类型化的视图公开数据。 该模式的目的是在强类型语言中实现组件之间的高度灵活性，在这种语言中，可以在不丢失类型安全支持的情况下，将新属性动态地添加到对象树中。 该模式利用特征将类的不同属性分成不同的接口。</p></blockquote><p><strong>程序示例</strong></p><p>让我们首先定义基类<code>Document</code>和<code>AbstractDocument</code>。 它们基本上使对象拥有属性映射和任意数量的子对象。</p><blockquote><p>以下代码在 java 8 中编译正常。</p></blockquote><p>Document 接口：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Document</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  Void <span style=color:#a6e22e>put</span>(String key, Object value);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  Object <span style=color:#a6e22e>get</span>(String key);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> Stream<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>children</span>(String key, Function<span style=color:#f92672>&lt;</span>Map<span style=color:#f92672>&lt;</span>String, Object<span style=color:#f92672>&gt;</span>, T<span style=color:#f92672>&gt;</span> constructor);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><blockquote><p>以下接口不使用 Java 8 的 Stream API：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Document</span> {
</span></span><span style=display:flex><span>  Object <span style=color:#a6e22e>get</span>(String key);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>put</span>(String key, Object value);
</span></span><span style=display:flex><span>  List<span style=color:#f92672>&lt;</span>Document<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>children</span>(String key);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></blockquote><p>AbstractDocument 抽象类：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AbstractDocument</span> <span style=color:#66d9ef>implements</span> Document {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Map<span style=color:#f92672>&lt;</span>String, Object<span style=color:#f92672>&gt;</span> properties;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>protected</span> <span style=color:#a6e22e>AbstractDocument</span>(Map<span style=color:#f92672>&lt;</span>String, Object<span style=color:#f92672>&gt;</span> properties) {
</span></span><span style=display:flex><span>		Objects.<span style=color:#a6e22e>requireNonNull</span>(properties, <span style=color:#e6db74>&#34;properties map is required&#34;</span>);
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>properties</span> <span style=color:#f92672>=</span> properties;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> Void <span style=color:#a6e22e>put</span>(String key, Object value) {
</span></span><span style=display:flex><span>		properties.<span style=color:#a6e22e>put</span>(key, value);
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>get</span>(String key) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> properties.<span style=color:#a6e22e>get</span>(key);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> Stream<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>children</span>(String key, Function<span style=color:#f92672>&lt;</span>Map<span style=color:#f92672>&lt;</span>String, Object<span style=color:#f92672>&gt;</span>, T<span style=color:#f92672>&gt;</span> constructor) {
</span></span><span style=display:flex><span>		<span style=color:#75715e>// java 9</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//		return Stream.ofNullable(get(key))</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//			.filter(Objects::nonNull)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//			.map(el -&gt; (List&lt;Map&lt;String, Object&gt;&gt;) el)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//			.findAny()</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//			.stream()</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//			.flatMap(Collection::stream)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>//			.map(constructor);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// java 8</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> Optional.<span style=color:#a6e22e>ofNullable</span>(get(key))
</span></span><span style=display:flex><span>			.<span style=color:#a6e22e>filter</span>(el <span style=color:#f92672>-&gt;</span> el <span style=color:#66d9ef>instanceof</span> List<span style=color:#f92672>&lt;?&gt;</span>)
</span></span><span style=display:flex><span>			.<span style=color:#a6e22e>map</span>(el <span style=color:#f92672>-&gt;</span> (List<span style=color:#f92672>&lt;</span>Map<span style=color:#f92672>&lt;</span>String, Object<span style=color:#f92672>&gt;&gt;</span>) el)
</span></span><span style=display:flex><span>			.<span style=color:#a6e22e>map</span>(List::stream)
</span></span><span style=display:flex><span>			.<span style=color:#a6e22e>orElseGet</span>(Stream::empty)
</span></span><span style=display:flex><span>			.<span style=color:#a6e22e>map</span>(constructor);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>toString</span>() {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> properties.<span style=color:#a6e22e>toString</span>();
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>接下来，我们定义一个枚举“属性”和一组类型，价格，模型和零件的接口。 这使我们能够为 Car 类创建静态外观的界面。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>enum</span> Property {
</span></span><span style=display:flex><span>  PARTS, TYPE, PRICE, MODEL
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>HasType</span> <span style=color:#66d9ef>extends</span> Document {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>default</span> Optional<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getType</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> Optional.<span style=color:#a6e22e>ofNullable</span>((String) get(Property.<span style=color:#a6e22e>TYPE</span>.<span style=color:#a6e22e>toString</span>()));
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>HasPrice</span> <span style=color:#66d9ef>extends</span> Document {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>default</span> Optional<span style=color:#f92672>&lt;</span>Number<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getPrice</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> Optional.<span style=color:#a6e22e>ofNullable</span>((Number) get(Property.<span style=color:#a6e22e>PRICE</span>.<span style=color:#a6e22e>toString</span>()));
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>HasModel</span> <span style=color:#66d9ef>extends</span> Document {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>default</span> Optional<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getModel</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> Optional.<span style=color:#a6e22e>ofNullable</span>((String) get(Property.<span style=color:#a6e22e>MODEL</span>.<span style=color:#a6e22e>toString</span>()));
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>HasParts</span> <span style=color:#66d9ef>extends</span> Document {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>default</span> Stream<span style=color:#f92672>&lt;</span>Part<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getParts</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> children(Property.<span style=color:#a6e22e>PARTS</span>.<span style=color:#a6e22e>toString</span>(), Part::<span style=color:#66d9ef>new</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Part</span> <span style=color:#66d9ef>extends</span> AbstractDocument <span style=color:#66d9ef>implements</span> HasType, HasModel, HasPrice {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>Part</span>(Map<span style=color:#f92672>&lt;</span>String, Object<span style=color:#f92672>&gt;</span> properties) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>super</span>(properties);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>现在我们准备介绍 <code>Car</code>。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Car</span> <span style=color:#66d9ef>extends</span> AbstractDocument <span style=color:#66d9ef>implements</span> HasModel, HasPrice, HasParts {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>Car</span>(Map<span style=color:#f92672>&lt;</span>String, Object<span style=color:#f92672>&gt;</span> properties) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>super</span>(properties);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>最后是完整示例中的<code>Car</code>构造和使用方式。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>App</span> {
</span></span><span style=display:flex><span>	<span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * Program entry point.
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 *
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 * @param args command line args
</span></span></span><span style=display:flex><span><span style=color:#75715e>	 */</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>		log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;Constructing parts and car&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		Map<span style=color:#f92672>&lt;</span>String, Object<span style=color:#f92672>&gt;</span> wheelProperties <span style=color:#f92672>=</span> ImmutableMap.<span style=color:#a6e22e>of</span>(
</span></span><span style=display:flex><span>			Property.<span style=color:#a6e22e>TYPE</span>.<span style=color:#a6e22e>toString</span>(), <span style=color:#e6db74>&#34;wheel&#34;</span>,
</span></span><span style=display:flex><span>			Property.<span style=color:#a6e22e>MODEL</span>.<span style=color:#a6e22e>toString</span>(), <span style=color:#e6db74>&#34;15C&#34;</span>,
</span></span><span style=display:flex><span>			Property.<span style=color:#a6e22e>PRICE</span>.<span style=color:#a6e22e>toString</span>(), 100L);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		Map<span style=color:#f92672>&lt;</span>String, Object<span style=color:#f92672>&gt;</span> doorProperties <span style=color:#f92672>=</span> ImmutableMap.<span style=color:#a6e22e>of</span>(
</span></span><span style=display:flex><span>			Property.<span style=color:#a6e22e>TYPE</span>.<span style=color:#a6e22e>toString</span>(), <span style=color:#e6db74>&#34;door&#34;</span>,
</span></span><span style=display:flex><span>			Property.<span style=color:#a6e22e>MODEL</span>.<span style=color:#a6e22e>toString</span>(), <span style=color:#e6db74>&#34;Lambo&#34;</span>,
</span></span><span style=display:flex><span>			Property.<span style=color:#a6e22e>PRICE</span>.<span style=color:#a6e22e>toString</span>(), 300L);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		Map<span style=color:#f92672>&lt;</span>String, Object<span style=color:#f92672>&gt;</span> carProperties <span style=color:#f92672>=</span> ImmutableMap.<span style=color:#a6e22e>of</span>(
</span></span><span style=display:flex><span>			Property.<span style=color:#a6e22e>MODEL</span>.<span style=color:#a6e22e>toString</span>(), <span style=color:#e6db74>&#34;300SL&#34;</span>,
</span></span><span style=display:flex><span>			Property.<span style=color:#a6e22e>PRICE</span>.<span style=color:#a6e22e>toString</span>(), 10000L,
</span></span><span style=display:flex><span>			Property.<span style=color:#a6e22e>PARTS</span>.<span style=color:#a6e22e>toString</span>(), ImmutableList.<span style=color:#a6e22e>of</span>(wheelProperties, doorProperties));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		Car car <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Car(carProperties);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;Here is our car:&#34;</span>);
</span></span><span style=display:flex><span>		log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;-&gt; model: {}&#34;</span>, car.<span style=color:#a6e22e>getModel</span>().<span style=color:#a6e22e>orElse</span>(<span style=color:#66d9ef>null</span>));
</span></span><span style=display:flex><span>		log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;-&gt; price: {}&#34;</span>, car.<span style=color:#a6e22e>getPrice</span>().<span style=color:#a6e22e>orElse</span>(<span style=color:#66d9ef>null</span>));
</span></span><span style=display:flex><span>		log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;-&gt; parts: &#34;</span>);
</span></span><span style=display:flex><span>		car.<span style=color:#a6e22e>getParts</span>().<span style=color:#a6e22e>forEach</span>(p <span style=color:#f92672>-&gt;</span> log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;\t{}/{}/{}&#34;</span>,
</span></span><span style=display:flex><span>			p.<span style=color:#a6e22e>getType</span>().<span style=color:#a6e22e>orElse</span>(<span style=color:#66d9ef>null</span>),
</span></span><span style=display:flex><span>			p.<span style=color:#a6e22e>getModel</span>().<span style=color:#a6e22e>orElse</span>(<span style=color:#66d9ef>null</span>),
</span></span><span style=display:flex><span>			p.<span style=color:#a6e22e>getPrice</span>().<span style=color:#a6e22e>orElse</span>(<span style=color:#66d9ef>null</span>))
</span></span><span style=display:flex><span>		);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>再来一个示例代码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Person</span> <span style=color:#66d9ef>extends</span> AbstractDocument{
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>Person</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>super</span>(Map.<span style=color:#a6e22e>of</span>(
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;name&#34;</span>, <span style=color:#e6db74>&#34;John Doe&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;age&#34;</span>, 30,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;hobbies&#34;</span>, List.<span style=color:#a6e22e>of</span>(<span style=color:#e6db74>&#34;Sports&#34;</span>, <span style=color:#e6db74>&#34;Music&#34;</span>));
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PersonApp</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>		Person person <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Person();
</span></span><span style=display:flex><span>		log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;name: {}&#34;</span>, person.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;name&#34;</span>));
</span></span><span style=display:flex><span>		log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;age: {}&#34;</span>, person.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;age&#34;</span>));
</span></span><span style=display:flex><span>		log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;hobbies: {}&#34;</span>, person.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;hobbies&#34;</span>));
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=类图>类图</h2><p><img src=https://java-design-patterns.com/assets/abstract-document-9f6a2e8d.png alt="alt text"></p><h2 id=适用性>适用性</h2><p>使用抽象文档模式，当</p><ul><li>需要即时添加新属性</li><li>你想要一种灵活的方式来以树状结构组织域</li><li>你想要更宽松的耦合系统</li></ul><p>下面是抽象文档模式的一些实际应用：</p><h3 id=1xml-和-json-解析>1、XML 和 JSON 解析</h3><p>抽象文档模式可以用于解析 XML 和 JSON 数据。由于 XML 和 JSON 数据通常包含动态属性，因此抽象文档模式可以提供一种灵活的方式来处理这些数据。通过将 XML 或 JSON 数据映射到文档和属性对象，可以轻松地访问和修改这些数据。</p><h4 id=xml-解析>XML 解析</h4><p>假设我们有一个简单的 XML 文件，内容如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;bookstore&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;book</span> <span style=color:#a6e22e>category=</span><span style=color:#e6db74>&#34;cooking&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;title</span> <span style=color:#a6e22e>lang=</span><span style=color:#e6db74>&#34;en&#34;</span><span style=color:#f92672>&gt;</span>Everyday Italian<span style=color:#f92672>&lt;/title&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;author&gt;</span>Giada De Laurentiis<span style=color:#f92672>&lt;/author&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;year&gt;</span>2005<span style=color:#f92672>&lt;/year&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;price&gt;</span>30.00<span style=color:#f92672>&lt;/price&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;/book&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;book</span> <span style=color:#a6e22e>category=</span><span style=color:#e6db74>&#34;children&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;title</span> <span style=color:#a6e22e>lang=</span><span style=color:#e6db74>&#34;en&#34;</span><span style=color:#f92672>&gt;</span>Harry Potter<span style=color:#f92672>&lt;/title&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;author&gt;</span>J.K. Rowling<span style=color:#f92672>&lt;/author&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;year&gt;</span>2003<span style=color:#f92672>&lt;/year&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;price&gt;</span>29.99<span style=color:#f92672>&lt;/price&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;/book&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/bookstore&gt;</span>
</span></span></code></pre></div><p>我们可以使用抽象文档模式来解析这个 XML 文件，首先定义一个<code>Document</code>接口，如下所示：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Document</span> {
</span></span><span style=display:flex><span>  Object <span style=color:#a6e22e>get</span>(String key);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>put</span>(String key, Object value);
</span></span><span style=display:flex><span>  List<span style=color:#f92672>&lt;</span>Document<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>children</span>(String key);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>然后定义一个具体的 XML 文档类，如下所示：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>XmlDocument</span> <span style=color:#66d9ef>implements</span> Document {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Element element;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>XmlDocument</span>(Element element) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>element</span> <span style=color:#f92672>=</span> element}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>get</span>(String key) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> element.<span style=color:#a6e22e>getAttribute</span>(key);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>put</span>(String key, Object value) {
</span></span><span style=display:flex><span>    element.<span style=color:#a6e22e>setAttribute</span>(key, value.<span style=color:#a6e22e>toString</span>());
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>Document<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>children</span>(String key) {
</span></span><span style=display:flex><span>    NodeList nodes <span style=color:#f92672>=</span> element.<span style=color:#a6e22e>getElementsByTagName</span>(key);
</span></span><span style=display:flex><span>    List<span style=color:#f92672>&lt;</span>Document<span style=color:#f92672>&gt;</span> children <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0; i <span style=color:#f92672>&lt;</span> nodes.<span style=color:#a6e22e>getLength</span>(); i<span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>      children.<span style=color:#a6e22e>add</span>(<span style=color:#66d9ef>new</span> XmlDocument((Element) nodes.<span style=color:#a6e22e>item</span>(i)));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> children;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>在这个具体的 XML 文档类中，我们实现了<code>Document</code>接口的三个方法，其中<code>children</code>方法使用了 DOM API 来获取子元素列表，并将每个子元素包装成一个新的<code>XmlDocument</code>对象。</p><p>现在，我们可以使用这个具体的 XML 文档类来解析 XML 文件，如下所示：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>DocumentBuilderFactory dbFactory <span style=color:#f92672>=</span> DocumentBuilderFactory.<span style=color:#a6e22e>newInstance</span>();
</span></span><span style=display:flex><span>DocumentBuilder dBuilder <span style=color:#f92672>=</span> dbFactory.<span style=color:#a6e22e>newDocumentBuilder</span>();
</span></span><span style=display:flex><span>Document doc <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> XmlDocument(dBuilder.<span style=color:#a6e22e>parse</span>(<span style=color:#66d9ef>new</span> File(<span style=color:#e6db74>&#34;books.xml&#34;</span>)).<span style=color:#a6e22e>getDocumentElement</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 获取根元素的属性值</span>
</span></span><span style=display:flex><span>String bookstoreCategory <span style=color:#f92672>=</span> (String) doc.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;category&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 获取所有书的信息</span>
</span></span><span style=display:flex><span>List<span style=color:#f92672>&lt;</span>Document<span style=color:#f92672>&gt;</span> books <span style=color:#f92672>=</span> doc.<span style=color:#a6e22e>children</span>(<span style=color:#e6db74>&#34;book&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> (Document book : books) {
</span></span><span style=display:flex><span>  String category <span style=color:#f92672>=</span> (String)doc.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;category&#34;</span>);
</span></span><span style=display:flex><span>  String title <span style=color:#f92672>=</span> (String) book.<span style=color:#a6e22e>children</span>(<span style=color:#e6db74>&#34;title&#34;</span>).<span style=color:#a6e22e>get</span>(0).<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;&#34;</span>);
</span></span><span style=display:flex><span>  String author <span style=color:#f92672>=</span> (String) book.<span style=color:#a6e22e>children</span>(<span style=color:#e6db74>&#34;author&#34;</span>).<span style=color:#a6e22e>get</span>(0).<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>int</span> year <span style=color:#f92672>=</span> (<span style=color:#66d9ef>int</span>) book.<span style=color:#a6e22e>children</span>(<span style=color:#e6db74>&#34;year&#34;</span>).<span style=color:#a6e22e>get</span>(0).<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>double</span> price <span style=color:#f92672>=</span> (<span style=color:#66d9ef>double</span>) book.<span style=color:#a6e22e>children</span>(<span style=color:#e6db74>&#34;price&#34;</span>).<span style=color:#a6e22e>get</span>(0).<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;&#34;</span>);
</span></span><span style=display:flex><span>  System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(<span style=color:#e6db74>&#34;Category: &#34;</span> <span style=color:#f92672>+</span> category <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;, Title: &#34;</span> <span style=color:#f92672>+</span> title <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;, Author: &#34;</span> <span style=color:#f92672>+</span> author <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;, Year: &#34;</span> <span style=color:#f92672>+</span> year <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;, Price: &#34;</span> <span style=color:#f92672>+</span> price);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=json-解析>JSON 解析</h4><p>假设我们有一个简单的 JSON 文件，以下是<code>example.json</code>文件的内容：：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;John Smith&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;age&#34;</span>: <span style=color:#ae81ff>35</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;address&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;street&#34;</span>: <span style=color:#e6db74>&#34;123 Main St&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;city&#34;</span>: <span style=color:#e6db74>&#34;Anytown&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;state&#34;</span>: <span style=color:#e6db74>&#34;CA&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;zip&#34;</span>: <span style=color:#e6db74>&#34;12345&#34;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;phone&#34;</span>: [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;home&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;number&#34;</span>: <span style=color:#e6db74>&#34;555-1234&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;work&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;number&#34;</span>: <span style=color:#e6db74>&#34;555-5678&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>我们可以使用抽象文档模式来解析这个 JSON 文件，首先定义一个<code>Document</code>接口，如下所示：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>Document</span> {
</span></span><span style=display:flex><span>  Object <span style=color:#a6e22e>get</span>(String key);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>put</span>(String key, Object value);
</span></span><span style=display:flex><span>  List<span style=color:#f92672>&lt;</span>Document<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>children</span>(String key);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>然后定义一个具体的 JSON 文档类，如下所示：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> com.google.gson.*;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.ArrayList;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.List;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>JsonDocument</span> <span style=color:#66d9ef>implements</span> Document {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> JsonObject object;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>JsonDocument</span>(JsonObject object) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>object</span> <span style=color:#f92672>=</span> object;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>get</span>(String key) {
</span></span><span style=display:flex><span>        JsonElement element <span style=color:#f92672>=</span> object.<span style=color:#a6e22e>get</span>(key);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (element <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (element.<span style=color:#a6e22e>isJsonPrimitive</span>()) {
</span></span><span style=display:flex><span>            JsonPrimitive primitive <span style=color:#f92672>=</span> element.<span style=color:#a6e22e>getAsJsonPrimitive</span>();
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (primitive.<span style=color:#a6e22e>isNumber</span>()) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> primitive.<span style=color:#a6e22e>getAsNumber</span>();
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (primitive.<span style=color:#a6e22e>isBoolean</span>()) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> primitive.<span style=color:#a6e22e>getAsBoolean</span>();
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> primitive.<span style=color:#a6e22e>getAsString</span>();
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (element.<span style=color:#a6e22e>isJsonObject</span>()) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> JsonDocument(element.<span style=color:#a6e22e>getAsJsonObject</span>());
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (element.<span style=color:#a6e22e>isJsonArray</span>()) {
</span></span><span style=display:flex><span>            JsonArray array <span style=color:#f92672>=</span> element.<span style=color:#a6e22e>getAsJsonArray</span>();
</span></span><span style=display:flex><span>            List<span style=color:#f92672>&lt;</span>Document<span style=color:#f92672>&gt;</span> children <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> (JsonElement child : array) {
</span></span><span style=display:flex><span>                children.<span style=color:#a6e22e>add</span>(<span style=color:#66d9ef>new</span> JsonDocument(child.<span style=color:#a6e22e>getAsJsonObject</span>()));
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> children;
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>put</span>(String key, Object value) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (value <span style=color:#66d9ef>instanceof</span> String) {
</span></span><span style=display:flex><span>            object.<span style=color:#a6e22e>addProperty</span>(key, (String) value);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (value <span style=color:#66d9ef>instanceof</span> Number) {
</span></span><span style=display:flex><span>            object.<span style=color:#a6e22e>addProperty</span>(key, (Number) value);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (value <span style=color:#66d9ef>instanceof</span> Boolean) {
</span></span><span style=display:flex><span>            object.<span style=color:#a6e22e>addProperty</span>(key, (Boolean) value);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (value <span style=color:#66d9ef>instanceof</span> Document) {
</span></span><span style=display:flex><span>            JsonDocument jsonDocument <span style=color:#f92672>=</span> (JsonDocument) value;
</span></span><span style=display:flex><span>            object.<span style=color:#a6e22e>add</span>(key, jsonDocument.<span style=color:#a6e22e>object</span>);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (value <span style=color:#66d9ef>instanceof</span> List) {
</span></span><span style=display:flex><span>            List<span style=color:#f92672>&lt;</span>Document<span style=color:#f92672>&gt;</span> children <span style=color:#f92672>=</span> (List<span style=color:#f92672>&lt;</span>Document<span style=color:#f92672>&gt;</span>) value;
</span></span><span style=display:flex><span>            JsonArray array <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> JsonArray();
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> (Document child : children) {
</span></span><span style=display:flex><span>                JsonDocument jsonChild <span style=color:#f92672>=</span> (JsonDocument) child;
</span></span><span style=display:flex><span>                array.<span style=color:#a6e22e>add</span>(jsonChild.<span style=color:#a6e22e>object</span>);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            object.<span style=color:#a6e22e>add</span>(key, array);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>Document<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>children</span>(String key) {
</span></span><span style=display:flex><span>        JsonElement element <span style=color:#f92672>=</span> object.<span style=color:#a6e22e>get</span>(key);
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>Document<span style=color:#f92672>&gt;</span> children <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (element <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> element.<span style=color:#a6e22e>isJsonArray</span>()) {
</span></span><span style=display:flex><span>            JsonArray array <span style=color:#f92672>=</span> element.<span style=color:#a6e22e>getAsJsonArray</span>();
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> (JsonElement child : array) {
</span></span><span style=display:flex><span>                children.<span style=color:#a6e22e>add</span>(<span style=color:#66d9ef>new</span> JsonDocument(child.<span style=color:#a6e22e>getAsJsonObject</span>()));
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> children;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>现在，我们可以使用这个具体的 JSON 文档类来解析 JSON 文件，如下所示：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>JsonParsingExample</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 读取JSON文件并解析</span>
</span></span><span style=display:flex><span>            Gson gson <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Gson();
</span></span><span style=display:flex><span>            JsonElement jsonElement <span style=color:#f92672>=</span> gson.<span style=color:#a6e22e>fromJson</span>(<span style=color:#66d9ef>new</span> FileReader(<span style=color:#e6db74>&#34;example.json&#34;</span>), JsonElement.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span>            JsonDocument doc <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> JsonDocument(jsonElement.<span style=color:#a6e22e>getAsJsonObject</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 获取根元素的属性值</span>
</span></span><span style=display:flex><span>            String name <span style=color:#f92672>=</span> (String) doc.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;name&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>int</span> age <span style=color:#f92672>=</span> (<span style=color:#66d9ef>int</span>) doc.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;age&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 获取地址</span>
</span></span><span style=display:flex><span>            JsonDocument address <span style=color:#f92672>=</span> (JsonDocument) doc.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;address&#34;</span>);
</span></span><span style=display:flex><span>            String street <span style=color:#f92672>=</span> (String) address.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;street&#34;</span>);
</span></span><span style=display:flex><span>            String city <span style=color:#f92672>=</span> (String) address.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;city&#34;</span>);
</span></span><span style=display:flex><span>            String state <span style=color:#f92672>=</span> (String) address.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;state&#34;</span>);
</span></span><span style=display:flex><span>            String zip <span style=color:#f92672>=</span> (String) address.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;zip&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 获取电话号码</span>
</span></span><span style=display:flex><span>            List<span style=color:#f92672>&lt;</span>Document<span style=color:#f92672>&gt;</span> phoneList <span style=color:#f92672>=</span> doc.<span style=color:#a6e22e>children</span>(<span style=color:#e6db74>&#34;phone&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> (Document phone : phoneList) {
</span></span><span style=display:flex><span>                String type <span style=color:#f92672>=</span> (String) phone.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;type&#34;</span>);
</span></span><span style=display:flex><span>                String number <span style=color:#f92672>=</span> (String) phone.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#34;number&#34;</span>);
</span></span><span style=display:flex><span>                System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(type <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;: &#34;</span> <span style=color:#f92672>+</span> number);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (Exception e) {
</span></span><span style=display:flex><span>            e.<span style=color:#a6e22e>printStackTrace</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=2动态配置>2、动态配置</h3><p>抽象文档模式可以用于动态配置。通过将配置数据映射到文档和属性对象，可以轻松地访问和修改配置数据。此外，由于抽象文档模式支持动态属性，因此可以在运行时添加或删除属性，从而使配置更加灵活。</p><p>假设有一个学生信息管理系统，需要存储和检索学生信息。学生信息包括学生姓名、学生年龄、学生性别、学生家庭地址等属性。由于学生属性可能会随时变化，因此需要使用一种灵活的方式来处理这些属性，并且需要轻松地访问和修改这些属性。</p><p>为了实现这个功能，可以使用抽象文档模式。定义一个学生文档类（StudentDocument），该类包含学生属性的访问器和修改器方法，并且支持动态属性。然后，定义一个学生属性类（Property），该类包含属性名称、属性类型和属性值等属性，并且支持动态属性。最后，使用一个构建器（Builder）类来创建具体的学生文档对象，并将学生属性添加到文档中。</p><p>示例代码如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> java.util.ArrayList;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.List;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Property</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String name;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Object value;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>Property</span>(String name, Object value) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> name;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> value;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getName</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> name;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>getValue</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> value;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setValue</span>(Object value) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> value;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Document</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> List<span style=color:#f92672>&lt;</span>Property<span style=color:#f92672>&gt;</span> properties <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ArrayList<span style=color:#f92672>&lt;&gt;</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>getProperty</span>(String name) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (Property property : properties) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (property.<span style=color:#a6e22e>getName</span>().<span style=color:#a6e22e>equals</span>(name)) {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> property.<span style=color:#a6e22e>getValue</span>();
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setProperty</span>(String name, Object value) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (Property property : properties) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (property.<span style=color:#a6e22e>getName</span>().<span style=color:#a6e22e>equals</span>(name)) {
</span></span><span style=display:flex><span>                property.<span style=color:#a6e22e>setValue</span>(value);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        properties.<span style=color:#a6e22e>add</span>(<span style=color:#66d9ef>new</span> Property(name, value));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>StudentDocument</span> <span style=color:#66d9ef>extends</span> Document {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getName</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> (String) getProperty(<span style=color:#e6db74>&#34;name&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setName</span>(String name) {
</span></span><span style=display:flex><span>        setProperty(<span style=color:#e6db74>&#34;name&#34;</span>, name);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>getAge</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> (<span style=color:#66d9ef>int</span>) getProperty(<span style=color:#e6db74>&#34;age&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setAge</span>(<span style=color:#66d9ef>int</span> age) {
</span></span><span style=display:flex><span>        setProperty(<span style=color:#e6db74>&#34;age&#34;</span>, age);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getGender</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> (String) getProperty(<span style=color:#e6db74>&#34;gender&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setGender</span>(String gender) {
</span></span><span style=display:flex><span>        setProperty(<span style=color:#e6db74>&#34;gender&#34;</span>, gender);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>getAddress</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> (String) getProperty(<span style=color:#e6db74>&#34;address&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setAddress</span>(Stringaddress) {
</span></span><span style=display:flex><span>        setProperty(<span style=color:#e6db74>&#34;address&#34;</span>, address);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>StudentBuilder</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> StudentDocument student <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> StudentDocument();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setName</span>(String name) {
</span></span><span style=display:flex><span>        student.<span style=color:#a6e22e>setName</span>(name);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setAge</span>(<span style=color:#66d9ef>int</span> age) {
</span></span><span style=display:flex><span>        student.<span style=color:#a6e22e>setAge</span>(age);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setGender</span>(String gender) {
</span></span><span style=display:flex><span>        student.<span style=color:#a6e22e>setGender</span>(gender);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>setAddress</span>(String address) {
</span></span><span style=display:flex><span>        student.<span style=color:#a6e22e>setAddress</span>(address);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> StudentDocument <span style=color:#a6e22e>build</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> student;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>使用抽象文档模式，可以轻松地访问和修改学生属性，如下所示：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>StudentBuilder builder <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> StudentBuilder();
</span></span><span style=display:flex><span>builder.<span style=color:#a6e22e>setName</span>(<span style=color:#e6db74>&#34;Tom&#34;</span>);
</span></span><span style=display:flex><span>builder.<span style=color:#a6e22e>setAge</span>(18);
</span></span><span style=display:flex><span>builder.<span style=color:#a6e22e>setGender</span>(<span style=color:#e6db74>&#34;Male&#34;</span>);
</span></span><span style=display:flex><span>builder.<span style=color:#a6e22e>setAddress</span>(<span style=color:#e6db74>&#34;Beijing&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>StudentDocument student <span style=color:#f92672>=</span> builder.<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(student.<span style=color:#a6e22e>getName</span>()); <span style=color:#75715e>// 输出：Tom</span>
</span></span><span style=display:flex><span>student.<span style=color:#a6e22e>setAddress</span>(<span style=color:#e6db74>&#34;Shanghai&#34;</span>);
</span></span><span style=display:flex><span>System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(student.<span style=color:#a6e22e>getAddress</span>()); <span style=color:#75715e>// 输出：Shanghai</span>
</span></span><span style=display:flex><span>student.<span style=color:#a6e22e>setProperty</span>(<span style=color:#e6db74>&#34;phoneNumber&#34;</span>, <span style=color:#e6db74>&#34;1234567890&#34;</span>);
</span></span><span style=display:flex><span>System.<span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>println</span>(student.<span style=color:#a6e22e>getProperty</span>(<span style=color:#e6db74>&#34;phoneNumber&#34;</span>)); <span style=color:#75715e>// 输出：1234567890</span>
</span></span></code></pre></div><h3 id=3业务规则引擎>3、业务规则引擎</h3><p>抽象文档模式可以用于实现业务规则引擎。通过将规则数据映射到文档和属性对象，可以轻松地访问和修改规则数据。此外，由于抽象文档模式支持动态属性，因此可以在运行时添加或删除规则，从而使规则引擎更加灵活。</p><p>假设我们有一个简单的业务规则，用于确定用户是否有资格获得某项奖励。这个规则可能涉及到多个条件，例如用户的年龄、所在地区以及购物金额等。</p><p>我们可以将这个规则表示为一个文档，例如一个 JSON 文档，其中每个属性对应一个规则条件。例如：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;age&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;operator&#34;</span>: <span style=color:#e6db74>&#34;&gt;=&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;value&#34;</span>: <span style=color:#ae81ff>18</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;region&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;operator&#34;</span>: <span style=color:#e6db74>&#34;in&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;value&#34;</span>: [<span style=color:#e6db74>&#34;east&#34;</span>, <span style=color:#e6db74>&#34;south&#34;</span>]
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;amount&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;operator&#34;</span>: <span style=color:#e6db74>&#34;&gt;=&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;value&#34;</span>: <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>然后，我们可以使用抽象文档模式来解析这个文档，并将其转换为一个规则对象。例如，我们可以创建一个名为<code>Rule</code>的类，它包含三个属性：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Rule</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> String key;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> String operator;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Object value;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Object secondValue;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>Rule</span>(String key, String operator, Object value) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>(key, operator, value, <span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#a6e22e>Rule</span>(String key, String operator, Object value, Object secondValue) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>key</span> <span style=color:#f92672>=</span> key;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>operator</span> <span style=color:#f92672>=</span> operator;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> value;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>secondValue</span> <span style=color:#f92672>=</span> secondValue;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>evaluate</span>(Document document) {
</span></span><span style=display:flex><span>        Object documentValue <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>get</span>(key);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (documentValue <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>switch</span> (operator) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;&gt;=&#34;</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> compare(documentValue, value) <span style=color:#f92672>&gt;=</span> 0;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;&lt;=&#34;</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> compare(documentValue, value) <span style=color:#f92672>&lt;=</span> 0;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;&gt;&#34;</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> compare(documentValue, value) <span style=color:#f92672>&gt;</span> 0;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;&lt;&#34;</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> compare(documentValue, value) <span style=color:#f92672>&lt;</span> 0;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;==&#34;</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> compare(documentValue,value) <span style=color:#f92672>==</span> 0;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;!=&#34;</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> compare(documentValue, value) <span style=color:#f92672>!=</span> 0;
</span></span><span style=display:flex><span>          	<span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;in&#34;</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (value <span style=color:#66d9ef>instanceof</span> List) {
</span></span><span style=display:flex><span>                    List<span style=color:#f92672>&lt;?&gt;</span> listValue <span style=color:#f92672>=</span> (List<span style=color:#f92672>&lt;?&gt;</span>) value;
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>for</span> (Object item : listValue) {
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span> (compare(documentValue, item) <span style=color:#f92672>==</span> 0) {
</span></span><span style=display:flex><span>                            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;not in&#34;</span>:
</span></span><span style=display:flex><span>            		<span style=color:#66d9ef>boolean</span> found<span style=color:#f92672>=</span><span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (value <span style=color:#66d9ef>instanceof</span> List) {
</span></span><span style=display:flex><span>                    List<span style=color:#f92672>&lt;?&gt;</span> listValue <span style=color:#f92672>=</span> (List<span style=color:#f92672>&lt;?&gt;</span>) value;
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>for</span> (Object item : listValue) {
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span> (compare(documentValue, item) <span style=color:#f92672>==</span> 0) {
</span></span><span style=display:flex><span>                            found<span style=color:#f92672>=</span><span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>                          	<span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#f92672>!</span>found;
</span></span><span style=display:flex><span>          	<span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;between&#34;</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (secondValue <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>int</span> cmp1 <span style=color:#f92672>=</span> compare(documentValue, value);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>int</span> cmp2 <span style=color:#f92672>=</span> compare(documentValue, secondValue);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> cmp1 <span style=color:#f92672>&gt;=</span> 0 <span style=color:#f92672>&amp;&amp;</span> cmp2 <span style=color:#f92672>&lt;=</span> 0;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;not between&#34;</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (secondValue <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>int</span> cmp1 <span style=color:#f92672>=</span> compare(documentValue, value);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>int</span> cmp2 <span style=color:#f92672>=</span> compare(documentValue, secondValue);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> cmp1 <span style=color:#f92672>&lt;</span> 0 <span style=color:#f92672>||</span> cmp2 <span style=color:#f92672>&gt;</span> 0;
</span></span><span style=display:flex><span>          	<span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;regex&#34;</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (documentValue <span style=color:#66d9ef>instanceof</span> String <span style=color:#f92672>&amp;&amp;</span> value <span style=color:#66d9ef>instanceof</span> String) {
</span></span><span style=display:flex><span>                    String strValue <span style=color:#f92672>=</span> (String) value;
</span></span><span style=display:flex><span>                    String strDocumentValue <span style=color:#f92672>=</span> (String) documentValue;
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> strDocumentValue.<span style=color:#a6e22e>matches</span>(strValue);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;startswith&#34;</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span>(documentValue <span style=color:#66d9ef>instanceof</span> String <span style=color:#f92672>&amp;&amp;</span> value <span style=color:#66d9ef>instanceof</span> String) {
</span></span><span style=display:flex><span>                    String strValue <span style=color:#f92672>=</span> (String) value;
</span></span><span style=display:flex><span>                    String strDocumentValue <span style=color:#f92672>=</span> (String) documentValue;
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> strDocumentValue.<span style=color:#a6e22e>startsWith</span>(strValue);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;endswith&#34;</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (documentValue <span style=color:#66d9ef>instanceof</span> String <span style=color:#f92672>&amp;&amp;</span> value <span style=color:#66d9ef>instanceof</span> String) {
</span></span><span style=display:flex><span>                    String strValue <span style=color:#f92672>=</span> (String) value;
</span></span><span style=display:flex><span>                    String strDocumentValue <span style=color:#f92672>=</span> (String) documentValue;
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> strDocumentValue.<span style=color:#a6e22e>endsWith</span>(strValue);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;like&#34;</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (documentValue <span style=color:#66d9ef>instanceof</span> String <span style=color:#f92672>&amp;&amp;</span> value <span style=color:#66d9ef>instanceof</span> String) {
</span></span><span style=display:flex><span>                    String strValue <span style=color:#f92672>=</span> (String) value;
</span></span><span style=display:flex><span>                    String strDocumentValue <span style=color:#f92672>=</span> (String) documentValue;
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> strDocumentValue.<span style=color:#a6e22e>contains</span>(strValue);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>          	<span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;not like&#34;</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (documentValue <span style=color:#66d9ef>instanceof</span> String <span style=color:#f92672>&amp;&amp;</span> value <span style=color:#66d9ef>instanceof</span> String) {
</span></span><span style=display:flex><span>                    String strValue <span style=color:#f92672>=</span> (String) value;
</span></span><span style=display:flex><span>                    String strDocumentValue <span style=color:#f92672>=</span> (String) documentValue;
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> <span style=color:#f92672>!</span>strDocumentValue.<span style=color:#a6e22e>contains</span>(strValue);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>           	<span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>int</span> <span style=color:#a6e22e>compare</span>(Object a, Object b) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (a <span style=color:#66d9ef>instanceof</span> Number <span style=color:#f92672>&amp;&amp;</span> b <span style=color:#66d9ef>instanceof</span> Number) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> Double.<span style=color:#a6e22e>compare</span>(((Number) a).<span style=color:#a6e22e>doubleValue</span>(), ((Number) b).<span style=color:#a6e22e>doubleValue</span>());
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (a <span style=color:#66d9ef>instanceof</span> String <span style=color:#f92672>&amp;&amp;</span> b <span style=color:#66d9ef>instanceof</span> String) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> ((String) a).<span style=color:#a6e22e>compareTo</span>((String) b);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> a.<span style=color:#a6e22e>toString</span>().<span style=color:#a6e22e>compareTo</span>(b.<span style=color:#a6e22e>toString</span>());
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>Rule</code>类有一个<code>evaluate</code>方法，它接受一个<code>Document</code>对象，并根据规则条件对文档进行评估。例如，对于上面的规则文档，我们可以创建三个<code>Rule</code>对象：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Rule ageRule <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Rule(<span style=color:#e6db74>&#34;age&#34;</span>, <span style=color:#e6db74>&#34;between&#34;</span>, 18, 30);
</span></span><span style=display:flex><span>Rule regionRule <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Rule(<span style=color:#e6db74>&#34;region&#34;</span>, <span style=color:#e6db74>&#34;in&#34;</span>, Arrays.<span style=color:#a6e22e>asList</span>(<span style=color:#e6db74>&#34;east&#34;</span>, <span style=color:#e6db74>&#34;south&#34;</span>));
</span></span><span style=display:flex><span>Rule amountRule <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Rule(<span style=color:#e6db74>&#34;amount&#34;</span>, <span style=color:#e6db74>&#34;&gt;=&#34;</span>, 1000);
</span></span></code></pre></div><p>然后，我们可以将这些规则应用于用户数据，例如一个存储在数据库中的用户记录。我们可以将用户数据表示为一个文档，例如一个 XML 文档：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;user&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;name&gt;</span>John Doe<span style=color:#f92672>&lt;/name&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;age&gt;</span>25<span style=color:#f92672>&lt;/age&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;region&gt;</span>east<span style=color:#f92672>&lt;/region&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;amount&gt;</span>1200<span style=color:#f92672>&lt;/amount&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/user&gt;</span>
</span></span></code></pre></div><p>我们可以使用抽象文档模式解析该文档并将其转换为<code>Document</code>对象。然后，我们可以使用<code>Rule</code>对象和<code>Document</code>对象来评估用户是否有资格获得奖励。例如：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>Document userDocument <span style=color:#f92672>=</span> ... <span style=color:#75715e>// 解析用户数据为一个Document对象</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>boolean</span> isEligible <span style=color:#f92672>=</span> ageRule.<span style=color:#a6e22e>evaluate</span>(userDocument) <span style=color:#f92672>&amp;&amp;</span> regionRule.<span style=color:#a6e22e>evaluate</span>(userDocument) <span style=color:#f92672>&amp;&amp;</span> amountRule.<span style=color:#a6e22e>evaluate</span>(userDocument);
</span></span></code></pre></div><h3 id=4数据库映射>4、数据库映射</h3><p>抽象文档模式可以用于将数据库数据映射到文档和属性对象上。通过将数据库表映射到文档对象，将表的列映射到属性对象，可以轻松地访问和修改数据库数据。</p></div><div><div style=font-weight:700>Share this post:</div><a class=social-link-item href="https://twitter.com/intent/tweet?text=Java%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f%ef%bc%9aAbstract%20Document https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f05%2f22%2fjava-design-patterns-abstract-document%2f" target=_blank rel="noopener noreferrer" title="Click to share on Twitter"><i class="fa-brands fa-square-twitter fa-2xl" style=color:#55acee></i>
</a><a class=social-link-item href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f05%2f22%2fjava-design-patterns-abstract-document%2f&title=Java%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f%ef%bc%9aAbstract%20Document" target=_blank rel="noopener noreferrer" title="Click to share on LinkedIn"><i class="fa-brands fa-linkedin fa-2xl" style=color:#007bb5></i>
</a><a class=social-link-item href="https://telegram.me/share/url?text=Java%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f%ef%bc%9aAbstract%20Document&amp;url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f05%2f22%2fjava-design-patterns-abstract-document%2f" target=_blank rel="noopener noreferrer" title="Click to share on telegram"><i class="fa-brands fa-telegram fa-2xl" style=color:#007bb5></i>
</a><a class=social-link-item href="https://reddit.com/submit?url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f05%2f22%2fjava-design-patterns-abstract-document%2f&title=Java%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f%ef%bc%9aAbstract%20Document" target=_blank rel="noopener noreferrer" title="Click to share on reddit"><i class="fa-brands fa-reddit fa-2xl" style=color:#007bb5></i>
</a><a class=social-link-item href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f05%2f22%2fjava-design-patterns-abstract-document%2f" target=_blank rel="noopener noreferrer" title="Click to share on facebook"><i class="fa-brands fa-facebook fa-2xl" style=color:#007bb5></i>
</a><a class=social-link-item href="https://api.whatsapp.com/send?text=Java%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f%ef%bc%9aAbstract%20Document%20-%20https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f05%2f22%2fjava-design-patterns-abstract-document%2f" target=_blank rel="noopener noreferrer" title="Click to share on whatsapp"><i class="fa-brands fa-whatsapp fa-2xl" style=color:#007bb5></i></a></div></div></article><nav class="navigation post-navigation" role=navigation><h2 class=screen-reader-text>Post navigation</h2><div class=nav-links><div class=nav-previous><a href=/posts/2023/05/22/docker-continuous-integration/ rel=next><span class=post-title>[译]Build Robust Continuous Integration With Docker and Friends</span></a></div><div class=nav-next><a href=/posts/2023/05/22/java-design-patterns-abstract-factory/ rel=prev><span class=post-title>Java设计模式：Abstract Factory</span></a></div></div></nav><h2>Related content</h2><ul><li><a href=/posts/2023/12/14/all-things-about-microprofile/>All things about MicroProfile</a></li><li><a href=/posts/2023/11/02/jhipster-intro/>JHipster安装和介绍</a></li><li><a href=/posts/2023/10/26/java-design-patterns-circuit-breaker/>Java设计模式：Circuit Breaker</a></li><li><a href=/posts/2023/10/16/java-design-patterns-chain/>Java设计模式：Chain</a></li><li><a href=/posts/2023/10/13/java-design-patterns-callback/>Java设计模式：Callback</a></li><li><a href=/posts/2023/09/25/java-design-patterns-cahcing/>Java设计模式：Caching</a></li><li><a href=/posts/2023/09/22/java-design-patterns-bytecode/>Java设计模式：Bytecode</a></li><li><a href=/posts/2023/09/05/java-design-patterns-builder/>Java设计模式：Builder</a></li><li><a href=/posts/2023/09/05/java-design-patterns-business-delegate/>Java设计模式：Business Delegate</a></li><li><a href=/posts/2023/08/28/java-design-patterns-bridge/>Java设计模式：Bridge</a></li></ul></main></section></div><div id=footer class=footer-wrap><footer id=colophon class="site-footer container clearfix" role=contentinfo><div id=footer-text class=site-info><span class=credit-link><a href=/ target=_blank rel="noopener noreferrer">ChenSoul</a>
Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a>
<a style=margin-left:20px href=/privacy_policy/ target=_blank rel="noopener noreferrer">Privacy Policy</a></span></div></footer></div></div><script type=text/javascript src=/main.min.js></script></body></html>