<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[译]使用Spring Boot2和Spring Security 5以及JDBC令牌存储进行Oauth2集中授权 | ChenSoul</title>
<meta name=keywords content="java,spring,spring boot,spring security"><meta name=description content="在这篇文章中，我们将了解如何使用 Spring Boot 2 和 Spring Security 5 OAuth2 来实现集中授权的授权服务器以及如何通过 GUI 对其进行管理，还将提供资源服务器演示以及 github 下的整个项目。
很多示例涵盖了基于早期版本的 Spring boot 2 和 Spring Security 5 使用内存令牌实现 Oauth2，因此想法是使用 MySql 数据库作为令牌存储。
为了深入探讨这个主题，我们必须：
配置 Spring 安全。 配置数据库。 创建授权服务器。 创建资源服务器。 使用 curl 客户端使用访问令牌获取安全资源。 什么是 Oauth 2？ OAuth 2.0 是行业标准授权协议。 OAuth 2.0 取代了 2006 年创建的原始 OAuth 协议上所做的工作。OAuth 2.0 注重客户端开发人员的简单性，同时为 Web 应用程序、桌面应用程序、移动电话和客厅设备提供特定的授权流程。
该规范及其扩展正在 IETF OAuth 工作组内开发。
Oauth 2 角色 OAuth2 定义了 4 个角色：
资源所有者：通常是您自己。
资源服务器：托管受保护数据的服务器（例如 Google 托管您的个人资料和个人信息）。
客户端：请求访问资源服务器的应用程序（网站、Javascript 应用程序或移动应用程序&mldr;&mldr;）。
授权服务器：向客户端颁发访问令牌的服务器。该令牌将用于客户端请求资源服务器。该服务器可以与资源服务器相同（相同的物理服务器和相同的应用程序），而且经常是这种情况。
下图说明了角色流程：
授权类型 OAuth 2 为不同的用例提供了多种“授权类型”。定义的授权类型型有：
授权码：授权码授予是使用您的 Facebook 或 Google 帐户登录应用程序的功能。 密码：旨在用于基于用户代理的客户端。其次，授权服务器不会像授权代码授予那样返回授权代码来交换访问令牌，而是返回访问令牌。 客户端凭据：客户端可以仅使用其客户端凭据（或其他支持的身份验证方式）请求访问令牌，当客户端请求访问其下的受保护资源控制权，或先前已被其他资源所有者控制的与授权服务器安排。 隐式授权：隐式授权是一种简化的授权代码流，针对使用 JavaScript 等脚本语言在浏览器中实现的客户端进行了优化。在隐式流程中，而不是向客户端发出授权代码，直接向客户端颁发访问令牌。 示范 让我们动手吧
业务层 为简单起见，我们的主要业务应用程序将是使用一个实体的产品 API，我们的访问规则将是：
PRODUCT_CREATE PRODUCT_UPDATE PRODUCT_DISPLAY PRODUCT_ADMIN OAuth2 客户端设置 要设置 Oauth 2 客户端，我们需要创建下表 [有关更多详细信息，请参阅链接]"><meta name=author content="chensoul"><link rel=canonical href=https://blog.chensoul.cc/posts/2023/07/14/oauth-2-centralized-authorization-with-spring-boot-2-and-spring-security-5-and-jdbc-token-store/><meta name=google-site-verification content="nBXwg45SBRjTX78SA-mH0asrAbsdu9c1nk0ObSry7aQ"><link crossorigin=anonymous href=/assets/css/stylesheet.41fda683d7f28f86c97812787adcc91d7e2ab1225be098c611c57b4995b061db.css integrity="sha256-Qf2mg9fyj4bJeBJ4etzJHX4qsSJb4JjGEcV7SZWwYds=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.chensoul.cc/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.chensoul.cc/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.chensoul.cc/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.chensoul.cc/apple-touch-icon.png><link rel=mask-icon href=https://blog.chensoul.cc/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.chensoul.cc/posts/2023/07/14/oauth-2-centralized-authorization-with-spring-boot-2-and-spring-security-5-and-jdbc-token-store/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta name=baidu-site-verification content="codeva-FYpQY8JdLU"><meta property="og:title" content="[译]使用Spring Boot2和Spring Security 5以及JDBC令牌存储进行Oauth2集中授权"><meta property="og:description" content="在这篇文章中，我们将了解如何使用 Spring Boot 2 和 Spring Security 5 OAuth2 来实现集中授权的授权服务器以及如何通过 GUI 对其进行管理，还将提供资源服务器演示以及 github 下的整个项目。
很多示例涵盖了基于早期版本的 Spring boot 2 和 Spring Security 5 使用内存令牌实现 Oauth2，因此想法是使用 MySql 数据库作为令牌存储。
为了深入探讨这个主题，我们必须：
配置 Spring 安全。 配置数据库。 创建授权服务器。 创建资源服务器。 使用 curl 客户端使用访问令牌获取安全资源。 什么是 Oauth 2？ OAuth 2.0 是行业标准授权协议。 OAuth 2.0 取代了 2006 年创建的原始 OAuth 协议上所做的工作。OAuth 2.0 注重客户端开发人员的简单性，同时为 Web 应用程序、桌面应用程序、移动电话和客厅设备提供特定的授权流程。
该规范及其扩展正在 IETF OAuth 工作组内开发。
Oauth 2 角色 OAuth2 定义了 4 个角色：
资源所有者：通常是您自己。
资源服务器：托管受保护数据的服务器（例如 Google 托管您的个人资料和个人信息）。
客户端：请求访问资源服务器的应用程序（网站、Javascript 应用程序或移动应用程序&mldr;&mldr;）。
授权服务器：向客户端颁发访问令牌的服务器。该令牌将用于客户端请求资源服务器。该服务器可以与资源服务器相同（相同的物理服务器和相同的应用程序），而且经常是这种情况。
下图说明了角色流程：
授权类型 OAuth 2 为不同的用例提供了多种“授权类型”。定义的授权类型型有：
授权码：授权码授予是使用您的 Facebook 或 Google 帐户登录应用程序的功能。 密码：旨在用于基于用户代理的客户端。其次，授权服务器不会像授权代码授予那样返回授权代码来交换访问令牌，而是返回访问令牌。 客户端凭据：客户端可以仅使用其客户端凭据（或其他支持的身份验证方式）请求访问令牌，当客户端请求访问其下的受保护资源控制权，或先前已被其他资源所有者控制的与授权服务器安排。 隐式授权：隐式授权是一种简化的授权代码流，针对使用 JavaScript 等脚本语言在浏览器中实现的客户端进行了优化。在隐式流程中，而不是向客户端发出授权代码，直接向客户端颁发访问令牌。 示范 让我们动手吧
业务层 为简单起见，我们的主要业务应用程序将是使用一个实体的产品 API，我们的访问规则将是：
PRODUCT_CREATE PRODUCT_UPDATE PRODUCT_DISPLAY PRODUCT_ADMIN OAuth2 客户端设置 要设置 Oauth 2 客户端，我们需要创建下表 [有关更多详细信息，请参阅链接]"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.chensoul.cc/posts/2023/07/14/oauth-2-centralized-authorization-with-spring-boot-2-and-spring-security-5-and-jdbc-token-store/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-07-14T00:00:00+08:00"><meta property="article:modified_time" content="2023-07-14T00:00:00+08:00"><meta property="og:site_name" content="ChenSoul"><meta name=twitter:card content="summary"><meta name=twitter:title content="[译]使用Spring Boot2和Spring Security 5以及JDBC令牌存储进行Oauth2集中授权"><meta name=twitter:description content="在这篇文章中，我们将了解如何使用 Spring Boot 2 和 Spring Security 5 OAuth2 来实现集中授权的授权服务器以及如何通过 GUI 对其进行管理，还将提供资源服务器演示以及 github 下的整个项目。
很多示例涵盖了基于早期版本的 Spring boot 2 和 Spring Security 5 使用内存令牌实现 Oauth2，因此想法是使用 MySql 数据库作为令牌存储。
为了深入探讨这个主题，我们必须：
配置 Spring 安全。 配置数据库。 创建授权服务器。 创建资源服务器。 使用 curl 客户端使用访问令牌获取安全资源。 什么是 Oauth 2？ OAuth 2.0 是行业标准授权协议。 OAuth 2.0 取代了 2006 年创建的原始 OAuth 协议上所做的工作。OAuth 2.0 注重客户端开发人员的简单性，同时为 Web 应用程序、桌面应用程序、移动电话和客厅设备提供特定的授权流程。
该规范及其扩展正在 IETF OAuth 工作组内开发。
Oauth 2 角色 OAuth2 定义了 4 个角色：
资源所有者：通常是您自己。
资源服务器：托管受保护数据的服务器（例如 Google 托管您的个人资料和个人信息）。
客户端：请求访问资源服务器的应用程序（网站、Javascript 应用程序或移动应用程序&mldr;&mldr;）。
授权服务器：向客户端颁发访问令牌的服务器。该令牌将用于客户端请求资源服务器。该服务器可以与资源服务器相同（相同的物理服务器和相同的应用程序），而且经常是这种情况。
下图说明了角色流程：
授权类型 OAuth 2 为不同的用例提供了多种“授权类型”。定义的授权类型型有：
授权码：授权码授予是使用您的 Facebook 或 Google 帐户登录应用程序的功能。 密码：旨在用于基于用户代理的客户端。其次，授权服务器不会像授权代码授予那样返回授权代码来交换访问令牌，而是返回访问令牌。 客户端凭据：客户端可以仅使用其客户端凭据（或其他支持的身份验证方式）请求访问令牌，当客户端请求访问其下的受保护资源控制权，或先前已被其他资源所有者控制的与授权服务器安排。 隐式授权：隐式授权是一种简化的授权代码流，针对使用 JavaScript 等脚本语言在浏览器中实现的客户端进行了优化。在隐式流程中，而不是向客户端发出授权代码，直接向客户端颁发访问令牌。 示范 让我们动手吧
业务层 为简单起见，我们的主要业务应用程序将是使用一个实体的产品 API，我们的访问规则将是：
PRODUCT_CREATE PRODUCT_UPDATE PRODUCT_DISPLAY PRODUCT_ADMIN OAuth2 客户端设置 要设置 Oauth 2 客户端，我们需要创建下表 [有关更多详细信息，请参阅链接]"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.chensoul.cc/posts/"},{"@type":"ListItem","position":2,"name":"[译]使用Spring Boot2和Spring Security 5以及JDBC令牌存储进行Oauth2集中授权","item":"https://blog.chensoul.cc/posts/2023/07/14/oauth-2-centralized-authorization-with-spring-boot-2-and-spring-security-5-and-jdbc-token-store/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[译]使用Spring Boot2和Spring Security 5以及JDBC令牌存储进行Oauth2集中授权","name":"[译]使用Spring Boot2和Spring Security 5以及JDBC令牌存储进行Oauth2集中授权","description":"在这篇文章中，我们将了解如何使用 Spring Boot 2 和 Spring Security 5 OAuth2 来实现集中授权的授权服务器以及如何通过 GUI 对其进行管理，还将提供资源服务器演示以及 github 下的整个项目。\n很多示例涵盖了基于早期版本的 Spring boot 2 和 Spring Security 5 使用内存令牌实现 Oauth2，因此想法是使用 MySql 数据库作为令牌存储。\n为了深入探讨这个主题，我们必须：\n配置 Spring 安全。 配置数据库。 创建授权服务器。 创建资源服务器。 使用 curl 客户端使用访问令牌获取安全资源。 什么是 Oauth 2？ OAuth 2.0 是行业标准授权协议。 OAuth 2.0 取代了 2006 年创建的原始 OAuth 协议上所做的工作。OAuth 2.0 注重客户端开发人员的简单性，同时为 Web 应用程序、桌面应用程序、移动电话和客厅设备提供特定的授权流程。\n该规范及其扩展正在 IETF OAuth 工作组内开发。\nOauth 2 角色 OAuth2 定义了 4 个角色：\n资源所有者：通常是您自己。\n资源服务器：托管受保护数据的服务器（例如 Google 托管您的个人资料和个人信息）。\n客户端：请求访问资源服务器的应用程序（网站、Javascript 应用程序或移动应用程序\u0026hellip;\u0026hellip;）。\n授权服务器：向客户端颁发访问令牌的服务器。该令牌将用于客户端请求资源服务器。该服务器可以与资源服务器相同（相同的物理服务器和相同的应用程序），而且经常是这种情况。\n下图说明了角色流程：\n授权类型 OAuth 2 为不同的用例提供了多种“授权类型”。定义的授权类型型有：\n授权码：授权码授予是使用您的 Facebook 或 Google 帐户登录应用程序的功能。 密码：旨在用于基于用户代理的客户端。其次，授权服务器不会像授权代码授予那样返回授权代码来交换访问令牌，而是返回访问令牌。 客户端凭据：客户端可以仅使用其客户端凭据（或其他支持的身份验证方式）请求访问令牌，当客户端请求访问其下的受保护资源控制权，或先前已被其他资源所有者控制的与授权服务器安排。 隐式授权：隐式授权是一种简化的授权代码流，针对使用 JavaScript 等脚本语言在浏览器中实现的客户端进行了优化。在隐式流程中，而不是向客户端发出授权代码，直接向客户端颁发访问令牌。 示范 让我们动手吧\n业务层 为简单起见，我们的主要业务应用程序将是使用一个实体的产品 API，我们的访问规则将是：\nPRODUCT_CREATE PRODUCT_UPDATE PRODUCT_DISPLAY PRODUCT_ADMIN OAuth2 客户端设置 要设置 Oauth 2 客户端，我们需要创建下表 [有关更多详细信息，请参阅链接]","keywords":["java","spring","spring boot","spring security"],"articleBody":"在这篇文章中，我们将了解如何使用 Spring Boot 2 和 Spring Security 5 OAuth2 来实现集中授权的授权服务器以及如何通过 GUI 对其进行管理，还将提供资源服务器演示以及 github 下的整个项目。\n很多示例涵盖了基于早期版本的 Spring boot 2 和 Spring Security 5 使用内存令牌实现 Oauth2，因此想法是使用 MySql 数据库作为令牌存储。\n为了深入探讨这个主题，我们必须：\n配置 Spring 安全。 配置数据库。 创建授权服务器。 创建资源服务器。 使用 curl 客户端使用访问令牌获取安全资源。 什么是 Oauth 2？ OAuth 2.0 是行业标准授权协议。 OAuth 2.0 取代了 2006 年创建的原始 OAuth 协议上所做的工作。OAuth 2.0 注重客户端开发人员的简单性，同时为 Web 应用程序、桌面应用程序、移动电话和客厅设备提供特定的授权流程。\n该规范及其扩展正在 IETF OAuth 工作组内开发。\nOauth 2 角色 OAuth2 定义了 4 个角色：\n资源所有者：通常是您自己。\n资源服务器：托管受保护数据的服务器（例如 Google 托管您的个人资料和个人信息）。\n客户端：请求访问资源服务器的应用程序（网站、Javascript 应用程序或移动应用程序……）。\n授权服务器：向客户端颁发访问令牌的服务器。该令牌将用于客户端请求资源服务器。该服务器可以与资源服务器相同（相同的物理服务器和相同的应用程序），而且经常是这种情况。\n下图说明了角色流程：\n授权类型 OAuth 2 为不同的用例提供了多种“授权类型”。定义的授权类型型有：\n授权码：授权码授予是使用您的 Facebook 或 Google 帐户登录应用程序的功能。 密码：旨在用于基于用户代理的客户端。其次，授权服务器不会像授权代码授予那样返回授权代码来交换访问令牌，而是返回访问令牌。 客户端凭据：客户端可以仅使用其客户端凭据（或其他支持的身份验证方式）请求访问令牌，当客户端请求访问其下的受保护资源控制权，或先前已被其他资源所有者控制的与授权服务器安排。 隐式授权：隐式授权是一种简化的授权代码流，针对使用 JavaScript 等脚本语言在浏览器中实现的客户端进行了优化。在隐式流程中，而不是向客户端发出授权代码，直接向客户端颁发访问令牌。 示范 让我们动手吧\n业务层 为简单起见，我们的主要业务应用程序将是使用一个实体的产品 API，我们的访问规则将是：\nPRODUCT_CREATE PRODUCT_UPDATE PRODUCT_DISPLAY PRODUCT_ADMIN OAuth2 客户端设置 要设置 Oauth 2 客户端，我们需要创建下表 [有关更多详细信息，请参阅链接]\nOAUTH_CLIENT_DETAILS OAUTH_CLIENT_DETAILS OAUTH_CLIENT_TOKEN OAUTH_CLIENT_TOKEN OAUTH_ACCESS_TOKEN OAUTH_ACCESS_TOKEN OAUTH_REFRESH_TOKEN OAUTH_REFRESH_TOKEN OAUTHCODE OAUTH代码 OAUTH_APPROVALS OAUTH_APPROVALS 我们将调用像“product_api”这样的资源服务器 对于该服务器，我们定义一个客户端，称为：\n读-写-客户端（授权授权类型：读、写） INSERT INTO OAUTH_CLIENT_DETAILS(CLIENT_ID, RESOURCE_IDS, CLIENT_SECRET, SCOPE, AUTHORIZED_GRANT_TYPES, AUTHORITIES, ACCESS_TOKEN_VALIDITY, REFRESH_TOKEN_VALIDITY) VALUES ('read-write-client', 'product-api','$2a$10$BurTWIy5NTF9GJJH4magz.9Bd4bBurWYG8tmXxeQh1vs7r/wnCFG2','read,write', 'client_credentials', 'ROLE_PRODUCT_ADMIN', 10800, 2592000); #password [hashed with BCCrypt] :user 权限和用户设置 Spring Security 附带两个有用的接口：\nUserDetails — 提供核心用户信息。\nGrantedAuthority — 表示授予身份验证对象的权限。\n下面的脚本将加载所有权限和凭据（用户）：\nINSERT INTO authority VALUES(1,'ROLE_OAUTH_ADMIN'); INSERT INTO authority VALUES(2,'ROLE_ADMIN_PRODUCT'); INSERT INTO authority VALUES(3,'ROLE_RESOURCE_ADMIN'); INSERT INTO credentials VALUES(1,b'1','oauth_admin','$2a$10$BurTWIy5NTF9GJJH4magz.9Bd4bBurWYG8tmXxeQh1vs7r/wnCFG2','0'); INSERT INTO credentials VALUES(2,b'1','resource_admin','$2a$10$BurTWIy5NTF9GJJH4magz.9Bd4bBurWYG8tmXxeQh1vs7r/wnCFG2','0'); INSERT INTO credentials VALUES(3,b'1','user','$2a$10$BurTWIy5NTF9GJJH4magz.9Bd4bBurWYG8tmXxeQh1vs7r/wnCFG2','0'); INSERT INTO credentials_authorities VALUES (1, 1); INSERT INTO credentials_authorities VALUES (2, 3); INSERT INTO credentials_authorities VALUES (3, 2); #Password : user API 层 对于演示，基于 Spring Boot 开发了 RESTful 应用程序并公开以下端点：\nSpring 安全配置 我们必须提供 UserDetailsService 接口的实现，以便获取用户凭据和权限，如下所示\n为了向应用程序提供安全性，我们将使用 @EnableWebSecurity 注解和 WebSecurityConfigurerAdapter\npackage com.aak.configuration; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.builders.WebSecurity; import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity; import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter; import org.springframework.security.core.userdetails.UserDetailsService; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; import org.springframework.security.crypto.password.PasswordEncoder; import org.springframework.security.provisioning.JdbcUserDetailsManager; import org.springframework.security.web.util.matcher.AntPathRequestMatcher; /** * Created by ahmed on 20.5.18. */ @EnableWebSecurity @Configuration public class WebSecurityConfiguration extends WebSecurityConfigurerAdapter { @Bean public PasswordEncoder passwordEncoder() { return new BCryptPasswordEncoder(); } @Bean @Override public UserDetailsService userDetailsServiceBean() throws Exception { return new JdbcUserDetails(); } @Override public void configure(WebSecurity web) throws Exception { web.ignoring().antMatchers(\"/webjars/**\"); } @Override protected void configure(HttpSecurity http) throws Exception { http .authorizeRequests() .antMatchers(\"/login\",\"/logout.do\").permitAll() .antMatchers(\"/**\").authenticated() .and() .formLogin() .loginProcessingUrl(\"/login.do\") .usernameParameter(\"username\") .passwordParameter(\"password\") .loginPage(\"/login\") .and() .logout() .logoutRequestMatcher(new AntPathRequestMatcher(\"/logout.do\")) .and() .userDetailsService(userDetailsServiceBean()); } @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception { auth.userDetailsService(userDetailsServiceBean()) .passwordEncoder(passwordEncoder()); } } OAuth2 配置 要设置 Oauth 2，需要实现两个组件\nAuthorization Server 授权服务器 Resource Server 资源服务器 授权服务器 授权服务器负责验证用户身份并提供令牌，使用@EnableAuthorizationServer 注解启用授权服务器配置\npackage com.aak.configuration; import org.springframework.boot.context.properties.ConfigurationProperties; import org.springframework.boot.jdbc.DataSourceBuilder; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.oauth2.config.annotation.configurers.ClientDetailsServiceConfigurer; import org.springframework.security.oauth2.config.annotation.web.configuration.AuthorizationServerConfigurerAdapter; import org.springframework.security.oauth2.config.annotation.web.configuration.EnableAuthorizationServer; import org.springframework.security.oauth2.config.annotation.web.configurers.AuthorizationServerEndpointsConfigurer; import org.springframework.security.oauth2.config.annotation.web.configurers.AuthorizationServerSecurityConfigurer; import org.springframework.security.oauth2.provider.approval.ApprovalStore; import org.springframework.security.oauth2.provider.approval.JdbcApprovalStore; import org.springframework.security.oauth2.provider.client.JdbcClientDetailsService; import org.springframework.security.oauth2.provider.code.AuthorizationCodeServices; import org.springframework.security.oauth2.provider.code.JdbcAuthorizationCodeServices; import org.springframework.security.oauth2.provider.token.TokenStore; import org.springframework.security.oauth2.provider.token.store.JdbcTokenStore; import javax.sql.DataSource; /** * Created by ahmed on 21.5.18. */ @Configuration @EnableAuthorizationServer public class AuthorizationServerConfiguration extends AuthorizationServerConfigurerAdapter { @Bean @ConfigurationProperties(prefix = \"spring.datasource\") public DataSource oauthDataSource() { return DataSourceBuilder.create().build(); } @Bean public JdbcClientDetailsService clientDetailsService() { return new JdbcClientDetailsService(oauthDataSource()); } @Bean public TokenStore tokenStore() { return new JdbcTokenStore(oauthDataSource()); } @Bean public ApprovalStore approvalStore() { return new JdbcApprovalStore(oauthDataSource()); } @Bean public AuthorizationCodeServices authorizationCodeServices() { return new JdbcAuthorizationCodeServices(oauthDataSource()); } @Override public void configure(ClientDetailsServiceConfigurer clients) throws Exception { clients.withClientDetails(clientDetailsService()); } @Override public void configure(AuthorizationServerSecurityConfigurer oauthServer) throws Exception { } @Override public void configure(AuthorizationServerEndpointsConfigurer endpoints) throws Exception { endpoints .approvalStore(approvalStore()) .authorizationCodeServices(authorizationCodeServices()) .tokenStore(tokenStore()); } } 成功配置运行授权服务器后，您将获得登录页面来管理授权服务器\n使用 oauth_admin/user 作为用户名/密码访问 Oauth2 仪表板，您可以在其中创建服务器客户端\n资源服务器 资源服务器托管受 OAuth2 令牌保护的资源（基本上是我们的产品 API）\npackage com.aak.configuration; import org.springframework.boot.context.properties.ConfigurationProperties; import org.springframework.boot.jdbc.DataSourceBuilder; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.http.HttpMethod; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.oauth2.config.annotation.web.configuration.EnableResourceServer; import org.springframework.security.oauth2.config.annotation.web.configuration.ResourceServerConfigurerAdapter; import org.springframework.security.oauth2.config.annotation.web.configurers.ResourceServerSecurityConfigurer; import org.springframework.security.oauth2.provider.token.TokenStore; import org.springframework.security.oauth2.provider.token.store.JdbcTokenStore; import javax.sql.DataSource; /** * Created by ahmed on 30.5.18. */ @EnableResourceServer @Configuration public class ResourcesServerConfiguration extends ResourceServerConfigurerAdapter { @Bean @ConfigurationProperties(prefix=\"spring.datasource\") public DataSource ouathDataSource(){return DataSourceBuilder.create().build();} @Override public void configure(ResourceServerSecurityConfigurer resources)throws Exception{ TokenStore tokenStore=new JdbcTokenStore(ouathDataSource()); resources.resourceId(\"product_api\").tokenStore(tokenStore); } @Override public void configure(HttpSecurity http) throws Exception{ http .authorizeRequests() .antMatchers(HttpMethod.GET, \"/**\").access(\"#oauth2.hasScope('read')\") .antMatchers(HttpMethod.POST, \"/**\").access(\"#oauth2.hasScope('write')\") .antMatchers(HttpMethod.PATCH, \"/**\").access(\"#oauth2.hasScope('write')\") .antMatchers(HttpMethod.PUT, \"/**\").access(\"#oauth2.hasScope('write')\") .antMatchers(HttpMethod.DELETE, \"/**\").access(\"#oauth2.hasScope('write')\") .and() .headers().addHeaderWriter((request, response) -\u003e { response.addHeader(\"Access-Control-Allow-Origin\", \"*\"); if (request.getMethod().equals(\"OPTIONS\")) { response.setHeader(\"Access-Control-Allow-Methods\", request.getHeader(\"Access-Control-Request-Method\")); response.setHeader(\"Access-Control-Allow-Headers\", request.getHeader(\"Access-Control-Request-Headers\")); } }); } } 使用以下 Curl 客户端测试产品列表端点：\n#!/bin/sh TOKEN=`curl -s -u curl_client:user -X POST localhost:8081/oauth/token\\?grant_type=client_credentials | egrep -o ‘[a-f0–9-]{20,}’` echo “ tGot token for curl client as :$TOKEN” curl localhost:8083/product/products -H “Authorization: Bearer $TOKEN” 运行 Curl 客户端 bash 脚本后得到响应：\n$ ./client.sh Got token for curl client as : 3be01519–0cab-4049-b87d-617c48bda502 [{“version”:0,”name”:”product_1\",”available”:false},{“version”:0,”name”:”product_2\",”available”:true}] 从 github 上查看整个代码：https://github.com/Akourtiim/oauth2-spring-boot-2.0.2.git\n参考：\nhttps://tools.ietf.org/html/rfc6749 https://dzone.com/articles/secure-spring-rest-with-spring-security-and-oauth2 http://www.bubblecode.net/en/2016/01/22/understanding-oauth2/ https://github.com/FrontierPsychiatrist/spring-oauth-example 原文链接：Oauth 2 Centralized Authorization with Spring Boot 2.0.2 and Spring Security 5 and JDBC token store\n","wordCount":"645","inLanguage":"en","datePublished":"2023-07-14T00:00:00+08:00","dateModified":"2023-07-14T00:00:00+08:00","author":{"@type":"Person","name":"chensoul"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.chensoul.cc/posts/2023/07/14/oauth-2-centralized-authorization-with-spring-boot-2-and-spring-security-5-and-jdbc-token-store/"},"publisher":{"@type":"Organization","name":"ChenSoul","logo":{"@type":"ImageObject","url":"https://blog.chensoul.cc/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.chensoul.cc/ accesskey=h title="ChenSoul (Alt + H)">ChenSoul</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.chensoul.cc/categories title=分类><span>分类</span></a></li><li><a href=https://blog.chensoul.cc/tags title=标签><span>标签</span></a></li><li><a href=https://blog.chensoul.cc/search title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li><li><a href=https://blog.chensoul.cc/index.xml title=订阅><span>订阅</span></a></li><li><a href=https://github.com/chensoul title=关于><span>关于</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">[译]使用Spring Boot2和Spring Security 5以及JDBC令牌存储进行Oauth2集中授权</h1><div class=post-meta><span title='2023-07-14 00:00:00 +0800 CST'>2023-07-14</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;645 words&nbsp;·&nbsp;chensoul</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e4%bb%80%e4%b9%88%e6%98%af-oauth-2 aria-label="什么是 Oauth 2？">什么是 Oauth 2？</a></li><li><a href=#oauth-2-%e8%a7%92%e8%89%b2 aria-label="Oauth 2 角色">Oauth 2 角色</a></li><li><a href=#%e6%8e%88%e6%9d%83%e7%b1%bb%e5%9e%8b aria-label=授权类型>授权类型</a></li><li><a href=#%e7%a4%ba%e8%8c%83 aria-label=示范>示范</a><ul><li><a href=#%e4%b8%9a%e5%8a%a1%e5%b1%82 aria-label=业务层>业务层</a></li><li><a href=#oauth2-%e5%ae%a2%e6%88%b7%e7%ab%af%e8%ae%be%e7%bd%ae aria-label="OAuth2 客户端设置">OAuth2 客户端设置</a></li><li><a href=#%e6%9d%83%e9%99%90%e5%92%8c%e7%94%a8%e6%88%b7%e8%ae%be%e7%bd%ae aria-label=权限和用户设置>权限和用户设置</a></li><li><a href=#api-%e5%b1%82 aria-label="API 层">API 层</a></li><li><a href=#spring-%e5%ae%89%e5%85%a8%e9%85%8d%e7%bd%ae aria-label="Spring 安全配置">Spring 安全配置</a></li><li><a href=#oauth2-%e9%85%8d%e7%bd%ae aria-label="OAuth2 配置">OAuth2 配置</a></li><li><a href=#%e6%8e%88%e6%9d%83%e6%9c%8d%e5%8a%a1%e5%99%a8 aria-label=授权服务器>授权服务器</a></li></ul></li><li><a href=#%e8%b5%84%e6%ba%90%e6%9c%8d%e5%8a%a1%e5%99%a8 aria-label=资源服务器>资源服务器</a></li></ul></div></details></div><div class=post-content><p>在这篇文章中，我们将了解如何使用 Spring Boot 2 和 Spring Security 5 OAuth2 来实现集中授权的授权服务器以及如何通过 GUI 对其进行管理，还将提供资源服务器演示以及 github 下的整个项目。</p><p>很多示例涵盖了基于早期版本的 Spring boot 2 和 Spring Security 5 使用内存令牌实现 Oauth2，因此想法是使用 MySql 数据库作为令牌存储。</p><p>为了深入探讨这个主题，我们必须：</p><ul><li>配置 Spring 安全。</li><li>配置数据库。</li><li>创建授权服务器。</li><li>创建资源服务器。</li><li>使用 curl 客户端使用访问令牌获取安全资源。</li></ul><h2 id=什么是-oauth-2>什么是 Oauth 2？<a hidden class=anchor aria-hidden=true href=#什么是-oauth-2>#</a></h2><p>OAuth 2.0 是行业标准授权协议。 OAuth 2.0 取代了 2006 年创建的原始 OAuth 协议上所做的工作。OAuth 2.0 注重客户端开发人员的简单性，同时为 Web 应用程序、桌面应用程序、移动电话和客厅设备提供特定的授权流程。</p><p>该规范及其扩展正在 <a href=https://www.ietf.org/mailman/listinfo/oauth>IETF OAuth 工作组内</a>开发。</p><h2 id=oauth-2-角色>Oauth 2 角色<a hidden class=anchor aria-hidden=true href=#oauth-2-角色>#</a></h2><p>OAuth2 定义了 4 个角色：</p><ul><li><p>资源所有者：通常是您自己。</p></li><li><p>资源服务器：托管受保护数据的服务器（例如 Google 托管您的个人资料和个人信息）。</p></li><li><p>客户端：请求访问资源服务器的应用程序（网站、Javascript 应用程序或移动应用程序&mldr;&mldr;）。</p></li><li><p>授权服务器：向客户端颁发访问令牌的服务器。该令牌将用于客户端请求资源服务器。该服务器可以与资源服务器相同（相同的物理服务器和相同的应用程序），而且经常是这种情况。</p></li></ul><p>下图说明了角色流程：</p><p><img loading=lazy src=https://miro.medium.com/v2/resize:fit:862/1*LrU0kZBljjwd32vLy5IlwA.png alt=img></p><h2 id=授权类型>授权类型<a hidden class=anchor aria-hidden=true href=#授权类型>#</a></h2><p>OAuth 2 为不同的用例提供了多种“授权类型”。定义的授权类型型有：</p><ul><li>授权码：授权码授予是使用您的 Facebook 或 Google 帐户登录应用程序的功能。</li><li>密码：旨在用于基于用户代理的客户端。其次，授权服务器不会像授权代码授予那样返回授权代码来交换访问令牌，而是返回访问令牌。</li><li>客户端凭据：客户端可以仅使用其客户端凭据（或其他支持的身份验证方式）请求访问令牌，当客户端请求访问其下的受保护资源控制权，或先前已被其他资源所有者控制的与授权服务器安排。</li><li>隐式授权：隐式授权是一种简化的授权代码流，针对使用 JavaScript 等脚本语言在浏览器中实现的客户端进行了优化。在隐式流程中，而不是向客户端发出授权代码，直接向客户端颁发访问令牌。</li></ul><h2 id=示范>示范<a hidden class=anchor aria-hidden=true href=#示范>#</a></h2><p>让我们动手吧</p><h3 id=业务层><strong>业务层</strong><a hidden class=anchor aria-hidden=true href=#业务层>#</a></h3><p>为简单起见，我们的主要业务应用程序将是使用一个实体的产品 API，我们的访问规则将是：</p><ul><li>PRODUCT_CREATE</li><li>PRODUCT_UPDATE</li><li>PRODUCT_DISPLAY</li><li>PRODUCT_ADMIN</li></ul><h3 id=oauth2-客户端设置>OAuth2 客户端设置<a hidden class=anchor aria-hidden=true href=#oauth2-客户端设置>#</a></h3><p>要设置 Oauth 2 客户端，我们需要创建下表 [有关更多详细信息，请参阅链接]</p><ul><li><a href=https://github.com/spring-projects/spring-security-oauth/blob/2.2.1.RELEASE/spring-security-oauth2/src/main/java/org/springframework/security/oauth2/provider/client/JdbcClientDetailsService.java>OAUTH_CLIENT_DETAILS OAUTH_CLIENT_DETAILS</a></li><li><a href=https://github.com/spring-projects/spring-security-oauth/blob/2.2.1.RELEASE/spring-security-oauth2/src/main/java/org/springframework/security/oauth2/client/token/JdbcClientTokenServices.java>OAUTH_CLIENT_TOKEN OAUTH_CLIENT_TOKEN</a></li><li><a href=https://github.com/spring-projects/spring-security-oauth/blob/2.2.1.RELEASE/spring-security-oauth2/src/main/java/org/springframework/security/oauth2/provider/token/store/JdbcTokenStore.java>OAUTH_ACCESS_TOKEN OAUTH_ACCESS_TOKEN</a></li><li><a href=https://github.com/spring-projects/spring-security-oauth/blob/2.2.1.RELEASE/spring-security-oauth2/src/main/java/org/springframework/security/oauth2/provider/token/store/JdbcTokenStore.java>OAUTH_REFRESH_TOKEN OAUTH_REFRESH_TOKEN</a></li><li><a href=https://github.com/spring-projects/spring-security-oauth/blob/2.2.1.RELEASE/spring-security-oauth2/src/main/java/org/springframework/security/oauth2/provider/code/JdbcAuthorizationCodeServices.java>OAUTH<em>CODE OAUTH</em>代码</a></li><li><a href=https://github.com/spring-projects/spring-security-oauth/blob/2.2.1.RELEASE/spring-security-oauth2/src/main/java/org/springframework/security/oauth2/provider/approval/JdbcApprovalStore.java>OAUTH_APPROVALS OAUTH_APPROVALS</a></li></ul><p>我们将调用像“product_api”这样的资源服务器 对于该服务器，我们定义一个客户端，称为：</p><ul><li>读-写-客户端（授权授权类型：读、写）</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>OAUTH_CLIENT_DETAILS</span><span class=p>(</span><span class=n>CLIENT_ID</span><span class=p>,</span><span class=w> </span><span class=n>RESOURCE_IDS</span><span class=p>,</span><span class=w> </span><span class=n>CLIENT_SECRET</span><span class=p>,</span><span class=w> </span><span class=k>SCOPE</span><span class=p>,</span><span class=w> </span><span class=n>AUTHORIZED_GRANT_TYPES</span><span class=p>,</span><span class=w> </span><span class=n>AUTHORITIES</span><span class=p>,</span><span class=w> </span><span class=n>ACCESS_TOKEN_VALIDITY</span><span class=p>,</span><span class=w> </span><span class=n>REFRESH_TOKEN_VALIDITY</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=s1>&#39;read-write-client&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;product-api&#39;</span><span class=p>,</span><span class=s1>&#39;$2a$10$BurTWIy5NTF9GJJH4magz.9Bd4bBurWYG8tmXxeQh1vs7r/wnCFG2&#39;</span><span class=p>,</span><span class=s1>&#39;read,write&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;client_credentials&#39;</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;ROLE_PRODUCT_ADMIN&#39;</span><span class=p>,</span><span class=w> </span><span class=mi>10800</span><span class=p>,</span><span class=w> </span><span class=mi>2592000</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=n>password</span><span class=w> </span><span class=p>[</span><span class=n>hashed</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=n>BCCrypt</span><span class=p>]</span><span class=w> </span><span class=p>:</span><span class=k>user</span><span class=w>
</span></span></span></code></pre></div><h3 id=权限和用户设置>权限和用户设置<a hidden class=anchor aria-hidden=true href=#权限和用户设置>#</a></h3><p>Spring Security 附带两个有用的接口：</p><ul><li><p><a href=https://docs.spring.io/spring-security/site/docs/5.0.x/api/org/springframework/security/core/userdetails/UserDetails.html>UserDetails</a> — 提供核心用户信息。</p></li><li><p><a href=https://docs.spring.io/spring-security/site/docs/5.0.x/api/org/springframework/security/core/GrantedAuthority.html>GrantedAuthority</a> — 表示授予身份验证对象的权限。</p></li></ul><p>下面的脚本将加载所有权限和凭据（用户）：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>authority</span><span class=w>  </span><span class=k>VALUES</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=s1>&#39;ROLE_OAUTH_ADMIN&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>authority</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=s1>&#39;ROLE_ADMIN_PRODUCT&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>authority</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=s1>&#39;ROLE_RESOURCE_ADMIN&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>credentials</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>b</span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=s1>&#39;oauth_admin&#39;</span><span class=p>,</span><span class=s1>&#39;$2a$10$BurTWIy5NTF9GJJH4magz.9Bd4bBurWYG8tmXxeQh1vs7r/wnCFG2&#39;</span><span class=p>,</span><span class=s1>&#39;0&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>credentials</span><span class=w> </span><span class=k>VALUES</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=n>b</span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=s1>&#39;resource_admin&#39;</span><span class=p>,</span><span class=s1>&#39;$2a$10$BurTWIy5NTF9GJJH4magz.9Bd4bBurWYG8tmXxeQh1vs7r/wnCFG2&#39;</span><span class=p>,</span><span class=s1>&#39;0&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>credentials</span><span class=w>  </span><span class=k>VALUES</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=n>b</span><span class=s1>&#39;1&#39;</span><span class=p>,</span><span class=s1>&#39;user&#39;</span><span class=p>,</span><span class=s1>&#39;$2a$10$BurTWIy5NTF9GJJH4magz.9Bd4bBurWYG8tmXxeQh1vs7r/wnCFG2&#39;</span><span class=p>,</span><span class=s1>&#39;0&#39;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>credentials_authorities</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>credentials_authorities</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>credentials_authorities</span><span class=w> </span><span class=k>VALUES</span><span class=w> </span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=n>Password</span><span class=w> </span><span class=p>:</span><span class=w> </span><span class=k>user</span><span class=w>
</span></span></span></code></pre></div><h3 id=api-层>API 层<a hidden class=anchor aria-hidden=true href=#api-层>#</a></h3><p>对于演示，基于 Spring Boot 开发了 RESTful 应用程序并公开以下端点：</p><p><img loading=lazy src=https://miro.medium.com/v2/resize:fit:1400/1*hHVGQGdvto-JkXNCZxzNyw.jpeg alt=img></p><h3 id=spring-安全配置>Spring 安全配置<a hidden class=anchor aria-hidden=true href=#spring-安全配置>#</a></h3><p>我们必须提供 <a href=https://docs.spring.io/spring-security/site/docs/4.2.3.RELEASE/apidocs/org/springframework/security/core/userdetails/UserDetailsService.html>UserDetailsService</a> 接口的实现，以便获取用户凭据和权限，如下所示</p><p><img loading=lazy src=https://miro.medium.com/v2/resize:fit:1400/1*dyyiX3P9XSdsPuYQyc4_kA.jpeg alt=img></p><p>为了向应用程序提供安全性，我们将使用 <a href=https://docs.spring.io/spring-security/site/docs/4.2.3.RELEASE/apidocs/org/springframework/security/config/annotation/web/configuration/EnableWebSecurity.html>@EnableWebSecurity</a> 注解和 WebSecurityConfigurerAdapter</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>com.aak.configuration</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.context.annotation.Bean</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.context.annotation.Configuration</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.config.annotation.web.builders.WebSecurity</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.config.annotation.web.configuration.EnableWebSecurity</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.core.userdetails.UserDetailsService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.crypto.password.PasswordEncoder</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.provisioning.JdbcUserDetailsManager</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.web.util.matcher.AntPathRequestMatcher</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Created by ahmed on 20.5.18.
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@EnableWebSecurity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>WebSecurityConfiguration</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>WebSecurityConfigurerAdapter</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>PasswordEncoder</span><span class=w> </span><span class=nf>passwordEncoder</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>BCryptPasswordEncoder</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>UserDetailsService</span><span class=w> </span><span class=nf>userDetailsServiceBean</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JdbcUserDetails</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>configure</span><span class=p>(</span><span class=n>WebSecurity</span><span class=w> </span><span class=n>web</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>web</span><span class=p>.</span><span class=na>ignoring</span><span class=p>().</span><span class=na>antMatchers</span><span class=p>(</span><span class=s>&#34;/webjars/**&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>protected</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>configure</span><span class=p>(</span><span class=n>HttpSecurity</span><span class=w> </span><span class=n>http</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>authorizeRequests</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>antMatchers</span><span class=p>(</span><span class=s>&#34;/login&#34;</span><span class=p>,</span><span class=s>&#34;/logout.do&#34;</span><span class=p>).</span><span class=na>permitAll</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>antMatchers</span><span class=p>(</span><span class=s>&#34;/**&#34;</span><span class=p>).</span><span class=na>authenticated</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>and</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>formLogin</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>loginProcessingUrl</span><span class=p>(</span><span class=s>&#34;/login.do&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>usernameParameter</span><span class=p>(</span><span class=s>&#34;username&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>passwordParameter</span><span class=p>(</span><span class=s>&#34;password&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>loginPage</span><span class=p>(</span><span class=s>&#34;/login&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>and</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>logout</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>logoutRequestMatcher</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>AntPathRequestMatcher</span><span class=p>(</span><span class=s>&#34;/logout.do&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>and</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>userDetailsService</span><span class=p>(</span><span class=n>userDetailsServiceBean</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>protected</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>configure</span><span class=p>(</span><span class=n>AuthenticationManagerBuilder</span><span class=w> </span><span class=n>auth</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>auth</span><span class=p>.</span><span class=na>userDetailsService</span><span class=p>(</span><span class=n>userDetailsServiceBean</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>passwordEncoder</span><span class=p>(</span><span class=n>passwordEncoder</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><h3 id=oauth2-配置>OAuth2 配置<a hidden class=anchor aria-hidden=true href=#oauth2-配置>#</a></h3><p>要设置 Oauth 2，需要实现两个组件</p><ul><li>Authorization Server 授权服务器</li><li>Resource Server 资源服务器</li></ul><h3 id=授权服务器>授权服务器<a hidden class=anchor aria-hidden=true href=#授权服务器>#</a></h3><p>授权服务器负责验证用户身份并提供令牌，使用@EnableAuthorizationServer 注解启用授权服务器配置</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>com.aak.configuration</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.boot.context.properties.ConfigurationProperties</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.boot.jdbc.DataSourceBuilder</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.context.annotation.Bean</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.context.annotation.Configuration</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.oauth2.config.annotation.configurers.ClientDetailsServiceConfigurer</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.oauth2.config.annotation.web.configuration.AuthorizationServerConfigurerAdapter</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.oauth2.config.annotation.web.configuration.EnableAuthorizationServer</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.oauth2.config.annotation.web.configurers.AuthorizationServerEndpointsConfigurer</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.oauth2.config.annotation.web.configurers.AuthorizationServerSecurityConfigurer</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.oauth2.provider.approval.ApprovalStore</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.oauth2.provider.approval.JdbcApprovalStore</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.oauth2.provider.client.JdbcClientDetailsService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.oauth2.provider.code.AuthorizationCodeServices</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.oauth2.provider.code.JdbcAuthorizationCodeServices</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.oauth2.provider.token.TokenStore</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.oauth2.provider.token.store.JdbcTokenStore</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>javax.sql.DataSource</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Created by ahmed on 21.5.18.
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@EnableAuthorizationServer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>AuthorizationServerConfiguration</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>AuthorizationServerConfigurerAdapter</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ConfigurationProperties</span><span class=p>(</span><span class=n>prefix</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;spring.datasource&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>DataSource</span><span class=w> </span><span class=nf>oauthDataSource</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>DataSourceBuilder</span><span class=p>.</span><span class=na>create</span><span class=p>().</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>JdbcClientDetailsService</span><span class=w> </span><span class=nf>clientDetailsService</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JdbcClientDetailsService</span><span class=p>(</span><span class=n>oauthDataSource</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>TokenStore</span><span class=w> </span><span class=nf>tokenStore</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JdbcTokenStore</span><span class=p>(</span><span class=n>oauthDataSource</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>ApprovalStore</span><span class=w> </span><span class=nf>approvalStore</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JdbcApprovalStore</span><span class=p>(</span><span class=n>oauthDataSource</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>AuthorizationCodeServices</span><span class=w> </span><span class=nf>authorizationCodeServices</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JdbcAuthorizationCodeServices</span><span class=p>(</span><span class=n>oauthDataSource</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>configure</span><span class=p>(</span><span class=n>ClientDetailsServiceConfigurer</span><span class=w> </span><span class=n>clients</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>clients</span><span class=p>.</span><span class=na>withClientDetails</span><span class=p>(</span><span class=n>clientDetailsService</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>configure</span><span class=p>(</span><span class=n>AuthorizationServerSecurityConfigurer</span><span class=w> </span><span class=n>oauthServer</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>configure</span><span class=p>(</span><span class=n>AuthorizationServerEndpointsConfigurer</span><span class=w> </span><span class=n>endpoints</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>endpoints</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>approvalStore</span><span class=p>(</span><span class=n>approvalStore</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>authorizationCodeServices</span><span class=p>(</span><span class=n>authorizationCodeServices</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>tokenStore</span><span class=p>(</span><span class=n>tokenStore</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>成功配置运行授权服务器后，您将获得登录页面来管理授权服务器</p><p><img loading=lazy src=https://miro.medium.com/v2/resize:fit:1400/1*2pQ9mmQ-AvOv3uBctFPHew.jpeg alt=img></p><p>使用 oauth_admin/user 作为用户名/密码访问 Oauth2 仪表板，您可以在其中创建服务器客户端</p><p><img loading=lazy src=https://miro.medium.com/v2/resize:fit:1400/1*L4h4ZNPrYt0sa8Qln_c4NA.jpeg alt=img></p><h2 id=资源服务器>资源服务器<a hidden class=anchor aria-hidden=true href=#资源服务器>#</a></h2><p>资源服务器托管受 OAuth2 令牌保护的资源（基本上是我们的产品 API）</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>com.aak.configuration</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.boot.context.properties.ConfigurationProperties</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.boot.jdbc.DataSourceBuilder</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.context.annotation.Bean</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.context.annotation.Configuration</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.http.HttpMethod</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.oauth2.config.annotation.web.configuration.EnableResourceServer</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.oauth2.config.annotation.web.configuration.ResourceServerConfigurerAdapter</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.oauth2.config.annotation.web.configurers.ResourceServerSecurityConfigurer</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.oauth2.provider.token.TokenStore</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.oauth2.provider.token.store.JdbcTokenStore</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>javax.sql.DataSource</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Created by ahmed on 30.5.18.
</span></span></span><span class=line><span class=cl><span class=cm> */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@EnableResourceServer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ResourcesServerConfiguration</span><span class=w>  </span><span class=kd>extends</span><span class=w> </span><span class=n>ResourceServerConfigurerAdapter</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ConfigurationProperties</span><span class=p>(</span><span class=n>prefix</span><span class=o>=</span><span class=s>&#34;spring.datasource&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>DataSource</span><span class=w> </span><span class=nf>ouathDataSource</span><span class=p>(){</span><span class=k>return</span><span class=w> </span><span class=n>DataSourceBuilder</span><span class=p>.</span><span class=na>create</span><span class=p>().</span><span class=na>build</span><span class=p>();}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>configure</span><span class=p>(</span><span class=n>ResourceServerSecurityConfigurer</span><span class=w> </span><span class=n>resources</span><span class=p>)</span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>TokenStore</span><span class=w> </span><span class=n>tokenStore</span><span class=o>=</span><span class=k>new</span><span class=w> </span><span class=n>JdbcTokenStore</span><span class=p>(</span><span class=n>ouathDataSource</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>resources</span><span class=p>.</span><span class=na>resourceId</span><span class=p>(</span><span class=s>&#34;product_api&#34;</span><span class=p>).</span><span class=na>tokenStore</span><span class=p>(</span><span class=n>tokenStore</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>configure</span><span class=p>(</span><span class=n>HttpSecurity</span><span class=w> </span><span class=n>http</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>authorizeRequests</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>antMatchers</span><span class=p>(</span><span class=n>HttpMethod</span><span class=p>.</span><span class=na>GET</span><span class=p>,</span><span class=w> </span><span class=s>&#34;/**&#34;</span><span class=p>).</span><span class=na>access</span><span class=p>(</span><span class=s>&#34;#oauth2.hasScope(&#39;read&#39;)&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>antMatchers</span><span class=p>(</span><span class=n>HttpMethod</span><span class=p>.</span><span class=na>POST</span><span class=p>,</span><span class=w> </span><span class=s>&#34;/**&#34;</span><span class=p>).</span><span class=na>access</span><span class=p>(</span><span class=s>&#34;#oauth2.hasScope(&#39;write&#39;)&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>antMatchers</span><span class=p>(</span><span class=n>HttpMethod</span><span class=p>.</span><span class=na>PATCH</span><span class=p>,</span><span class=w> </span><span class=s>&#34;/**&#34;</span><span class=p>).</span><span class=na>access</span><span class=p>(</span><span class=s>&#34;#oauth2.hasScope(&#39;write&#39;)&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>antMatchers</span><span class=p>(</span><span class=n>HttpMethod</span><span class=p>.</span><span class=na>PUT</span><span class=p>,</span><span class=w> </span><span class=s>&#34;/**&#34;</span><span class=p>).</span><span class=na>access</span><span class=p>(</span><span class=s>&#34;#oauth2.hasScope(&#39;write&#39;)&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>antMatchers</span><span class=p>(</span><span class=n>HttpMethod</span><span class=p>.</span><span class=na>DELETE</span><span class=p>,</span><span class=w> </span><span class=s>&#34;/**&#34;</span><span class=p>).</span><span class=na>access</span><span class=p>(</span><span class=s>&#34;#oauth2.hasScope(&#39;write&#39;)&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>and</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>headers</span><span class=p>().</span><span class=na>addHeaderWriter</span><span class=p>((</span><span class=n>request</span><span class=p>,</span><span class=w> </span><span class=n>response</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            			</span><span class=n>response</span><span class=p>.</span><span class=na>addHeader</span><span class=p>(</span><span class=s>&#34;Access-Control-Allow-Origin&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;*&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=n>request</span><span class=p>.</span><span class=na>getMethod</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=s>&#34;OPTIONS&#34;</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                      </span><span class=n>response</span><span class=p>.</span><span class=na>setHeader</span><span class=p>(</span><span class=s>&#34;Access-Control-Allow-Methods&#34;</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getHeader</span><span class=p>(</span><span class=s>&#34;Access-Control-Request-Method&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                      </span><span class=n>response</span><span class=p>.</span><span class=na>setHeader</span><span class=p>(</span><span class=s>&#34;Access-Control-Allow-Headers&#34;</span><span class=p>,</span><span class=w> </span><span class=n>request</span><span class=p>.</span><span class=na>getHeader</span><span class=p>(</span><span class=s>&#34;Access-Control-Request-Headers&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>});</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>使用以下 Curl 客户端测试产品列表端点：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/sh
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=nv>TOKEN</span><span class=o>=</span><span class=sb>`</span>curl -s -u curl_client:user -X POST localhost:8081/oauth/token<span class=se>\?</span><span class=nv>grant_type</span><span class=o>=</span>client_credentials <span class=p>|</span> egrep -o ‘<span class=o>[</span>a-f0–9-<span class=o>]{</span>20,<span class=o>}</span>’<span class=sb>`</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> “ tGot token <span class=k>for</span> curl client as :<span class=nv>$TOKEN</span>”
</span></span><span class=line><span class=cl>curl localhost:8083/product/products -H “Authorization: Bearer <span class=nv>$TOKEN</span>”
</span></span></code></pre></div><p>运行 Curl 客户端 bash 脚本后得到响应：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ ./client.sh
</span></span><span class=line><span class=cl>Got token <span class=k>for</span> curl client as : 3be01519–0cab-4049-b87d-617c48bda502
</span></span><span class=line><span class=cl><span class=o>[{</span>“version”:0,”name”:”product_1<span class=s2>&#34;,”available”:false},{“version”:0,”name”:”product_2&#34;</span>,”available”:true<span class=o>}]</span>
</span></span></code></pre></div><p>从 github 上查看整个代码：https://github.com/Akourtiim/oauth2-spring-boot-2.0.2.git</p><p><strong>参考：</strong></p><ul><li><a href=https://tools.ietf.org/html/rfc6749>https://tools.ietf.org/html/rfc6749</a></li><li><a href=https://dzone.com/articles/secure-spring-rest-with-spring-security-and-oauth2>https://dzone.com/articles/secure-spring-rest-with-spring-security-and-oauth2</a></li><li><a href=http://www.bubblecode.net/en/2016/01/22/understanding-oauth2/>http://www.bubblecode.net/en/2016/01/22/understanding-oauth2/</a></li><li><a href=https://github.com/FrontierPsychiatrist/spring-oauth-example>https://github.com/FrontierPsychiatrist/spring-oauth-example</a></li></ul><p>原文链接：<a href=https://akourtim-ahmed.medium.com/oauth-2-centralized-authorization-with-spring-boot-2-0-2-and-spring-security-5-and-jdbc-token-store-8dbc063bd5d4>Oauth 2 Centralized Authorization with Spring Boot 2.0.2 and Spring Security 5 and JDBC token store</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.chensoul.cc/tags/java/>Java</a></li><li><a href=https://blog.chensoul.cc/tags/spring/>Spring</a></li><li><a href=https://blog.chensoul.cc/tags/spring-boot/>Spring-Boot</a></li><li><a href=https://blog.chensoul.cc/tags/spring-security/>Spring-Security</a></li></ul><nav class=paginav><a class=prev href=https://blog.chensoul.cc/posts/2023/07/26/using-oauth2-in-spring/><span class=title>« Prev</span><br><span>[译]在 Spring 中实现 OAuth2：第 1 部分</span>
</a><a class=next href=https://blog.chensoul.cc/posts/2023/07/11/weekly_review_26/><span class=title>Next »</span><br><span>周报-26｜上半年的绩效总结</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share [译]使用Spring Boot2和Spring Security 5以及JDBC令牌存储进行Oauth2集中授权 on x" href="https://x.com/intent/tweet/?text=%5b%e8%af%91%5d%e4%bd%bf%e7%94%a8Spring%20Boot2%e5%92%8cSpring%20Security%205%e4%bb%a5%e5%8f%8aJDBC%e4%bb%a4%e7%89%8c%e5%ad%98%e5%82%a8%e8%bf%9b%e8%a1%8cOauth2%e9%9b%86%e4%b8%ad%e6%8e%88%e6%9d%83&amp;url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f07%2f14%2foauth-2-centralized-authorization-with-spring-boot-2-and-spring-security-5-and-jdbc-token-store%2f&amp;hashtags=java%2cspring%2cspringboot%2cspringsecurity"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [译]使用Spring Boot2和Spring Security 5以及JDBC令牌存储进行Oauth2集中授权 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f07%2f14%2foauth-2-centralized-authorization-with-spring-boot-2-and-spring-security-5-and-jdbc-token-store%2f&amp;title=%5b%e8%af%91%5d%e4%bd%bf%e7%94%a8Spring%20Boot2%e5%92%8cSpring%20Security%205%e4%bb%a5%e5%8f%8aJDBC%e4%bb%a4%e7%89%8c%e5%ad%98%e5%82%a8%e8%bf%9b%e8%a1%8cOauth2%e9%9b%86%e4%b8%ad%e6%8e%88%e6%9d%83&amp;summary=%5b%e8%af%91%5d%e4%bd%bf%e7%94%a8Spring%20Boot2%e5%92%8cSpring%20Security%205%e4%bb%a5%e5%8f%8aJDBC%e4%bb%a4%e7%89%8c%e5%ad%98%e5%82%a8%e8%bf%9b%e8%a1%8cOauth2%e9%9b%86%e4%b8%ad%e6%8e%88%e6%9d%83&amp;source=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f07%2f14%2foauth-2-centralized-authorization-with-spring-boot-2-and-spring-security-5-and-jdbc-token-store%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [译]使用Spring Boot2和Spring Security 5以及JDBC令牌存储进行Oauth2集中授权 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f07%2f14%2foauth-2-centralized-authorization-with-spring-boot-2-and-spring-security-5-and-jdbc-token-store%2f&title=%5b%e8%af%91%5d%e4%bd%bf%e7%94%a8Spring%20Boot2%e5%92%8cSpring%20Security%205%e4%bb%a5%e5%8f%8aJDBC%e4%bb%a4%e7%89%8c%e5%ad%98%e5%82%a8%e8%bf%9b%e8%a1%8cOauth2%e9%9b%86%e4%b8%ad%e6%8e%88%e6%9d%83"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [译]使用Spring Boot2和Spring Security 5以及JDBC令牌存储进行Oauth2集中授权 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f07%2f14%2foauth-2-centralized-authorization-with-spring-boot-2-and-spring-security-5-and-jdbc-token-store%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [译]使用Spring Boot2和Spring Security 5以及JDBC令牌存储进行Oauth2集中授权 on whatsapp" href="https://api.whatsapp.com/send?text=%5b%e8%af%91%5d%e4%bd%bf%e7%94%a8Spring%20Boot2%e5%92%8cSpring%20Security%205%e4%bb%a5%e5%8f%8aJDBC%e4%bb%a4%e7%89%8c%e5%ad%98%e5%82%a8%e8%bf%9b%e8%a1%8cOauth2%e9%9b%86%e4%b8%ad%e6%8e%88%e6%9d%83%20-%20https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f07%2f14%2foauth-2-centralized-authorization-with-spring-boot-2-and-spring-security-5-and-jdbc-token-store%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [译]使用Spring Boot2和Spring Security 5以及JDBC令牌存储进行Oauth2集中授权 on telegram" href="https://telegram.me/share/url?text=%5b%e8%af%91%5d%e4%bd%bf%e7%94%a8Spring%20Boot2%e5%92%8cSpring%20Security%205%e4%bb%a5%e5%8f%8aJDBC%e4%bb%a4%e7%89%8c%e5%ad%98%e5%82%a8%e8%bf%9b%e8%a1%8cOauth2%e9%9b%86%e4%b8%ad%e6%8e%88%e6%9d%83&amp;url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f07%2f14%2foauth-2-centralized-authorization-with-spring-boot-2-and-spring-security-5-and-jdbc-token-store%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [译]使用Spring Boot2和Spring Security 5以及JDBC令牌存储进行Oauth2集中授权 on ycombinator" href="https://news.ycombinator.com/submitlink?t=%5b%e8%af%91%5d%e4%bd%bf%e7%94%a8Spring%20Boot2%e5%92%8cSpring%20Security%205%e4%bb%a5%e5%8f%8aJDBC%e4%bb%a4%e7%89%8c%e5%ad%98%e5%82%a8%e8%bf%9b%e8%a1%8cOauth2%e9%9b%86%e4%b8%ad%e6%8e%88%e6%9d%83&u=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f07%2f14%2foauth-2-centralized-authorization-with-spring-boot-2-and-spring-security-5-and-jdbc-token-store%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://blog.chensoul.cc/>ChenSoul</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script async src=https://umami.chensoul.cc/random-string.js data-website-id=821c25f8-a31a-4607-92d7-91ee76843d00></script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>