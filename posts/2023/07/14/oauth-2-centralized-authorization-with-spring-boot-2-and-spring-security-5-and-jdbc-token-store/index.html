<!doctype html><html lang=en-US prefix="og: http://ogp.me/ns#"><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•ä½¿ç”¨ Spring Boot 2 å’Œ Spring Security 5 OAuth2 æ¥å®ç°é›†ä¸­æˆæƒçš„æˆæƒæœåŠ¡å™¨ä»¥åŠå¦‚ä½•é€šè¿‡ GUI å¯¹å…¶è¿›è¡Œç®¡ç†ï¼Œè¿˜å°†æä¾›èµ„æºæœåŠ¡å™¨æ¼”ç¤ºä»¥åŠ github ä¸‹çš„æ•´ä¸ªé¡¹ç›®ã€‚"><title>[è¯‘]ä½¿ç”¨Spring Boot2å’ŒSpring Security 5ä»¥åŠJDBCä»¤ç‰Œå­˜å‚¨è¿›è¡ŒOauth2é›†ä¸­æˆæƒ | ChenSoul</title>
<link rel=canonical href=https://blog.chensoul.cc/posts/2023/07/14/oauth-2-centralized-authorization-with-spring-boot-2-and-spring-security-5-and-jdbc-token-store/><link rel=preconnect href=https://fonts.font.im><link rel=preconnect href=https://fonts.loli.net crossorigin><link href="https://fonts.loli.net/css2?family=Roboto+Slab:wght@400;500;700&display=swap" rel=stylesheet><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.chensoul.cc/images/favicon.webp"><meta name=twitter:title content="[è¯‘]ä½¿ç”¨Spring Boot2å’ŒSpring Security 5ä»¥åŠJDBCä»¤ç‰Œå­˜å‚¨è¿›è¡ŒOauth2é›†ä¸­æˆæƒ"><meta name=twitter:description content="åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•ä½¿ç”¨ Spring Boot 2 å’Œ Spring Security 5 OAuth2 æ¥å®ç°é›†ä¸­æˆæƒçš„æˆæƒæœåŠ¡å™¨ä»¥åŠå¦‚ä½•é€šè¿‡ GUI å¯¹å…¶è¿›è¡Œç®¡ç†ï¼Œè¿˜å°†æä¾›èµ„æºæœåŠ¡å™¨æ¼”ç¤ºä»¥åŠ github ä¸‹çš„æ•´ä¸ªé¡¹ç›®ã€‚"><meta name=twitter:creator content="@ichensoul"><meta property="og:locale" content="en_US"><meta property="og:site_name" content="chensoul"><meta property="og:url" content="https://blog.chensoul.cc/posts/2023/07/14/oauth-2-centralized-authorization-with-spring-boot-2-and-spring-security-5-and-jdbc-token-store/"><meta property="og:site_name" content="ChenSoul"><meta property="og:title" content="[è¯‘]ä½¿ç”¨Spring Boot2å’ŒSpring Security 5ä»¥åŠJDBCä»¤ç‰Œå­˜å‚¨è¿›è¡ŒOauth2é›†ä¸­æˆæƒ"><meta property="og:description" content="åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•ä½¿ç”¨ Spring Boot 2 å’Œ Spring Security 5 OAuth2 æ¥å®ç°é›†ä¸­æˆæƒçš„æˆæƒæœåŠ¡å™¨ä»¥åŠå¦‚ä½•é€šè¿‡ GUI å¯¹å…¶è¿›è¡Œç®¡ç†ï¼Œè¿˜å°†æä¾›èµ„æºæœåŠ¡å™¨æ¼”ç¤ºä»¥åŠ github ä¸‹çš„æ•´ä¸ªé¡¹ç›®ã€‚"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-07-14T00:00:00+00:00"><meta property="article:modified_time" content="2023-07-14T00:00:00+00:00"><meta property="article:tag" content="Spring-Security"><meta property="article:tag" content="Oauth2"><meta property="og:image" content="https://blog.chensoul.cc/images/favicon.webp"><meta itemprop=name content="[è¯‘]ä½¿ç”¨Spring Boot2å’ŒSpring Security 5ä»¥åŠJDBCä»¤ç‰Œå­˜å‚¨è¿›è¡ŒOauth2é›†ä¸­æˆæƒ"><meta itemprop=description content="åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•ä½¿ç”¨ Spring Boot 2 å’Œ Spring Security 5 OAuth2 æ¥å®ç°é›†ä¸­æˆæƒçš„æˆæƒæœåŠ¡å™¨ä»¥åŠå¦‚ä½•é€šè¿‡ GUI å¯¹å…¶è¿›è¡Œç®¡ç†ï¼Œè¿˜å°†æä¾›èµ„æºæœåŠ¡å™¨æ¼”ç¤ºä»¥åŠ github ä¸‹çš„æ•´ä¸ªé¡¹ç›®ã€‚"><meta itemprop=datePublished content="2023-07-14T00:00:00+00:00"><meta itemprop=dateModified content="2023-07-14T00:00:00+00:00"><meta itemprop=wordCount content="527"><meta itemprop=image content="https://blog.chensoul.cc/images/favicon.webp"><meta itemprop=keywords content="Spring-Security,Oauth2"><link rel=stylesheet href=https://cdnjs.loli.net/ajax/libs/font-awesome/6.4.0/css/all.min.css media=all><link rel=stylesheet href=/main.min.css type=text/css media=all><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"TechArticle","name":"[è¯‘]ä½¿ç”¨Spring Boot2å’ŒSpring Security 5ä»¥åŠJDBCä»¤ç‰Œå­˜å‚¨è¿›è¡ŒOauth2é›†ä¸­æˆæƒ","headline":"[è¯‘]ä½¿ç”¨Spring Boot2å’ŒSpring Security 5ä»¥åŠJDBCä»¤ç‰Œå­˜å‚¨è¿›è¡ŒOauth2é›†ä¸­æˆæƒ","inLanguage":"en-US","url":"https://blog.chensoul.cc/posts/2023/07/14/oauth-2-centralized-authorization-with-spring-boot-2-and-spring-security-5-and-jdbc-token-store/","description":"\u003cp\u003eåœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•ä½¿ç”¨ Spring Boot 2 å’Œ Spring Security 5 OAuth2 æ¥å®ç°é›†ä¸­æˆæƒçš„æˆæƒæœåŠ¡å™¨ä»¥åŠå¦‚ä½•é€šè¿‡ GUI å¯¹å…¶è¿›è¡Œç®¡ç†ï¼Œè¿˜å°†æä¾›èµ„æºæœåŠ¡å™¨æ¼”ç¤ºä»¥åŠ github ä¸‹çš„æ•´ä¸ªé¡¹ç›®ã€‚\u003c/p\u003e","wordCount":"527","keywords":["spring-security","oauth2"],"datePublished":"2023-07-14T00:00:00Z","dateModified":"2023-07-14T00:00:00Z","author":{"@type":"Person","name":"chensoul"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.chensoul.cc/posts/2023/07/14/oauth-2-centralized-authorization-with-spring-boot-2-and-spring-security-5-and-jdbc-token-store/"},"publisher":{"@type":"Organization","name":"chensoul","url":"https://blog.chensoul.cc/posts/2023/07/14/oauth-2-centralized-authorization-with-spring-boot-2-and-spring-security-5-and-jdbc-token-store/"}},{"@context":"https://schema.org","@type":"Organization","name":"chensoul","url":"https://blog.chensoul.cc/","sameAs":["https://x.com/ichensoul","https://github.com/chensoul","https://www.linkedin.com/in/","https://www.youtube.com/@chensoul","https://t.me/chensouls"]}]}</script><script defer src=https://umami.chensoul.cc/random-string.js data-website-id=821c25f8-a31a-4607-92d7-91ee76843d00></script></head><body class="home blog post-layout-one-column"><button onclick=topFunction() id=scrollTopBtn title="Go to top">
<i class="fa-solid fa-arrow-up"></i></button><div id=header-top class=header-bar-wrap></div><div id=page class=site><a class="skip-link screen-reader-text" href=#content>Skip to content</a><header id=masthead class="site-header clearfix" role=banner><div class="header-main container clearfix"><div id=logo class="site-branding clearfix"><h1 class=site-title><a href=/ title=ChenSoul rel=home>ChenSoul</a></h1><p class=site-description>Java, Spring Boot, Microservice, Cloud, Architecture and DevOps Tutorials</p></div><div class="header-widgets clearfix"><aside id=search-2 class="header-widget widget_search"><form role=search method=get class=search-form onsubmit="return searchSite(event)"><label><span class=screen-reader-text>Search for:</span>
<input type=search class=search-field placeholder="Enter search keyword" name=query id=query title="Enter search keyword">
</label><button type=submit class=search-submit title=Search> <span class=genericon-search></span>
<span class=screen-reader-text>Search</span></button></form></aside></div></div><div id=main-navigation-wrap class=primary-navigation-wrap><nav id=main-navigation class="primary-navigation navigation container clearfix" role=navigation><ul id=menu-home class=main-navigation-menu><li class="menu-item menu-item-type-custom menu-item-object-custom
current-menu-item current_page_item menu-item-home"><a href=/>Home</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/categories/spring-boot/>Spring Boot</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/categories/architecture/>Architecture</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/categories/microservice/>Microservice</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/categories/kubernetes/>Kubernetes</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category
menu-item-has-children"><a href=/tutorials/>Tutorials</a><ul class=sub-menu><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/spring-boot-tutorials/>Spring Boot Tutorials</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/microservice-tutorials/>Microservice Tutorials</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/kubernetes-tutorials/>Kubernetes Tutorials</a></li></ul></li><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=https://github.com/chensoul target=_blank>About Me</a></li></ul></nav></div></header><div id=content class="site-content container clearfix"><section id=primary class="content-archive content-area post-content-area"><main id=main class=site-main role=main><article class="post type-post"><div class=post-inner-content><header class=entry-header><h2 class=entry-title><a href=https://blog.chensoul.cc/posts/2023/07/14/oauth-2-centralized-authorization-with-spring-boot-2-and-spring-security-5-and-jdbc-token-store/ rel=bookmark title="[è¯‘]ä½¿ç”¨Spring Boot2å’ŒSpring Security 5ä»¥åŠJDBCä»¤ç‰Œå­˜å‚¨è¿›è¡ŒOauth2é›†ä¸­æˆæƒ">[è¯‘]ä½¿ç”¨Spring Boot2å’ŒSpring Security 5ä»¥åŠJDBCä»¤ç‰Œå­˜å‚¨è¿›è¡ŒOauth2é›†ä¸­æˆæƒ</a></h2><div class=entry-meta><span class=meta-date><time class="entry-date published" datetime=2023-07-14T00:00:00>2023-07-14
</time></span><span class=meta-author><span class="author vcard">chensoul</span>
</span><span class="tagcloud post-tags"><i class="fa fa-tags"></i>&nbsp;
<a class="tag-cloud-link widget__link widget__link--taglist" href=/tags/spring-security/ title=spring-security>spring-security</a>
&nbsp;
<a class="tag-cloud-link widget__link widget__link--taglist" href=/tags/oauth2/ title=oauth2>oauth2</a></span></div></header><div class=entry-content><p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†äº†è§£å¦‚ä½•ä½¿ç”¨ Spring Boot 2 å’Œ Spring Security 5 OAuth2 æ¥å®ç°é›†ä¸­æˆæƒçš„æˆæƒæœåŠ¡å™¨ä»¥åŠå¦‚ä½•é€šè¿‡ GUI å¯¹å…¶è¿›è¡Œç®¡ç†ï¼Œè¿˜å°†æä¾›èµ„æºæœåŠ¡å™¨æ¼”ç¤ºä»¥åŠ github ä¸‹çš„æ•´ä¸ªé¡¹ç›®ã€‚</p><p>å¾ˆå¤šç¤ºä¾‹æ¶µç›–äº†åŸºäºæ—©æœŸç‰ˆæœ¬çš„ Spring boot 2 å’Œ Spring Security 5 ä½¿ç”¨å†…å­˜ä»¤ç‰Œå®ç° Oauth2ï¼Œå› æ­¤æƒ³æ³•æ˜¯ä½¿ç”¨ MySql æ•°æ®åº“ä½œä¸ºä»¤ç‰Œå­˜å‚¨ã€‚</p><p>ä¸ºäº†æ·±å…¥æ¢è®¨è¿™ä¸ªä¸»é¢˜ï¼Œæˆ‘ä»¬å¿…é¡»ï¼š</p><ul><li>é…ç½® Spring å®‰å…¨ã€‚</li><li>é…ç½®æ•°æ®åº“ã€‚</li><li>åˆ›å»ºæˆæƒæœåŠ¡å™¨ã€‚</li><li>åˆ›å»ºèµ„æºæœåŠ¡å™¨ã€‚</li><li>ä½¿ç”¨ curl å®¢æˆ·ç«¯ä½¿ç”¨è®¿é—®ä»¤ç‰Œè·å–å®‰å…¨èµ„æºã€‚</li></ul><h2 id=ä»€ä¹ˆæ˜¯-oauth-2>ä»€ä¹ˆæ˜¯ Oauth 2ï¼Ÿ</h2><p>OAuth 2.0 æ˜¯è¡Œä¸šæ ‡å‡†æˆæƒåè®®ã€‚ OAuth 2.0 å–ä»£äº† 2006 å¹´åˆ›å»ºçš„åŸå§‹ OAuth åè®®ä¸Šæ‰€åšçš„å·¥ä½œã€‚OAuth 2.0 æ³¨é‡å®¢æˆ·ç«¯å¼€å‘äººå‘˜çš„ç®€å•æ€§ï¼ŒåŒæ—¶ä¸º Web åº”ç”¨ç¨‹åºã€æ¡Œé¢åº”ç”¨ç¨‹åºã€ç§»åŠ¨ç”µè¯å’Œå®¢å…è®¾å¤‡æä¾›ç‰¹å®šçš„æˆæƒæµç¨‹ã€‚</p><p>è¯¥è§„èŒƒåŠå…¶æ‰©å±•æ­£åœ¨ <a href=https://www.ietf.org/mailman/listinfo/oauth target=_blank>IETF OAuth å·¥ä½œç»„å†…</a>å¼€å‘ã€‚</p><h2 id=oauth-2-è§’è‰²>Oauth 2 è§’è‰²</h2><p>OAuth2 å®šä¹‰äº† 4 ä¸ªè§’è‰²ï¼š</p><ul><li><p>èµ„æºæ‰€æœ‰è€…ï¼šé€šå¸¸æ˜¯æ‚¨è‡ªå·±ã€‚</p></li><li><p>èµ„æºæœåŠ¡å™¨ï¼šæ‰˜ç®¡å—ä¿æŠ¤æ•°æ®çš„æœåŠ¡å™¨ï¼ˆä¾‹å¦‚ Google æ‰˜ç®¡æ‚¨çš„ä¸ªäººèµ„æ–™å’Œä¸ªäººä¿¡æ¯ï¼‰ã€‚</p></li><li><p>å®¢æˆ·ç«¯ï¼šè¯·æ±‚è®¿é—®èµ„æºæœåŠ¡å™¨çš„åº”ç”¨ç¨‹åºï¼ˆç½‘ç«™ã€Javascript åº”ç”¨ç¨‹åºæˆ–ç§»åŠ¨åº”ç”¨ç¨‹åº&mldr;&mldr;ï¼‰ã€‚</p></li><li><p>æˆæƒæœåŠ¡å™¨ï¼šå‘å®¢æˆ·ç«¯é¢å‘è®¿é—®ä»¤ç‰Œçš„æœåŠ¡å™¨ã€‚è¯¥ä»¤ç‰Œå°†ç”¨äºå®¢æˆ·ç«¯è¯·æ±‚èµ„æºæœåŠ¡å™¨ã€‚è¯¥æœåŠ¡å™¨å¯ä»¥ä¸èµ„æºæœåŠ¡å™¨ç›¸åŒï¼ˆç›¸åŒçš„ç‰©ç†æœåŠ¡å™¨å’Œç›¸åŒçš„åº”ç”¨ç¨‹åºï¼‰ï¼Œè€Œä¸”ç»å¸¸æ˜¯è¿™ç§æƒ…å†µã€‚</p></li></ul><p>ä¸‹å›¾è¯´æ˜äº†è§’è‰²æµç¨‹ï¼š</p><p><img src=/images/oauth-2-centralized-authorization-01.webp alt=img></p><h2 id=æˆæƒç±»å‹>æˆæƒç±»å‹</h2><p>OAuth 2 ä¸ºä¸åŒçš„ç”¨ä¾‹æä¾›äº†å¤šç§â€œæˆæƒç±»å‹â€ã€‚å®šä¹‰çš„æˆæƒç±»å‹å‹æœ‰ï¼š</p><ul><li>æˆæƒç ï¼šæˆæƒç æˆäºˆæ˜¯ä½¿ç”¨æ‚¨çš„ Facebook æˆ– Google å¸æˆ·ç™»å½•åº”ç”¨ç¨‹åºçš„åŠŸèƒ½ã€‚</li><li>å¯†ç ï¼šæ—¨åœ¨ç”¨äºåŸºäºç”¨æˆ·ä»£ç†çš„å®¢æˆ·ç«¯ã€‚å…¶æ¬¡ï¼ŒæˆæƒæœåŠ¡å™¨ä¸ä¼šåƒæˆæƒä»£ç æˆäºˆé‚£æ ·è¿”å›æˆæƒä»£ç æ¥äº¤æ¢è®¿é—®ä»¤ç‰Œï¼Œè€Œæ˜¯è¿”å›è®¿é—®ä»¤ç‰Œã€‚</li><li>å®¢æˆ·ç«¯å‡­æ®ï¼šå®¢æˆ·ç«¯å¯ä»¥ä»…ä½¿ç”¨å…¶å®¢æˆ·ç«¯å‡­æ®ï¼ˆæˆ–å…¶ä»–æ”¯æŒçš„èº«ä»½éªŒè¯æ–¹å¼ï¼‰è¯·æ±‚è®¿é—®ä»¤ç‰Œï¼Œå½“å®¢æˆ·ç«¯è¯·æ±‚è®¿é—®å…¶ä¸‹çš„å—ä¿æŠ¤èµ„æºæ§åˆ¶æƒï¼Œæˆ–å…ˆå‰å·²è¢«å…¶ä»–èµ„æºæ‰€æœ‰è€…æ§åˆ¶çš„ä¸æˆæƒæœåŠ¡å™¨å®‰æ’ã€‚</li><li>éšå¼æˆæƒï¼šéšå¼æˆæƒæ˜¯ä¸€ç§ç®€åŒ–çš„æˆæƒä»£ç æµï¼Œé’ˆå¯¹ä½¿ç”¨ JavaScript ç­‰è„šæœ¬è¯­è¨€åœ¨æµè§ˆå™¨ä¸­å®ç°çš„å®¢æˆ·ç«¯è¿›è¡Œäº†ä¼˜åŒ–ã€‚åœ¨éšå¼æµç¨‹ä¸­ï¼Œè€Œä¸æ˜¯å‘å®¢æˆ·ç«¯å‘å‡ºæˆæƒä»£ç ï¼Œç›´æ¥å‘å®¢æˆ·ç«¯é¢å‘è®¿é—®ä»¤ç‰Œã€‚</li></ul><h2 id=ç¤ºèŒƒ>ç¤ºèŒƒ</h2><p>è®©æˆ‘ä»¬åŠ¨æ‰‹å§</p><h3 id=ä¸šåŠ¡å±‚><strong>ä¸šåŠ¡å±‚</strong></h3><p>ä¸ºç®€å•èµ·è§ï¼Œæˆ‘ä»¬çš„ä¸»è¦ä¸šåŠ¡åº”ç”¨ç¨‹åºå°†æ˜¯ä½¿ç”¨ä¸€ä¸ªå®ä½“çš„äº§å“ APIï¼Œæˆ‘ä»¬çš„è®¿é—®è§„åˆ™å°†æ˜¯ï¼š</p><ul><li>PRODUCT_CREATE</li><li>PRODUCT_UPDATE</li><li>PRODUCT_DISPLAY</li><li>PRODUCT_ADMIN</li></ul><h3 id=oauth2-å®¢æˆ·ç«¯è®¾ç½®>OAuth2 å®¢æˆ·ç«¯è®¾ç½®</h3><p>è¦è®¾ç½® Oauth 2 å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸‹è¡¨ [æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…é“¾æ¥]</p><ul><li><a href=https://github.com/spring-projects/spring-security-oauth/blob/2.2.1.RELEASE/spring-security-oauth2/src/main/java/org/springframework/security/oauth2/provider/client/JdbcClientDetailsService.java target=_blank>OAUTH_CLIENT_DETAILS</a></li><li><a href=https://github.com/spring-projects/spring-security-oauth/blob/2.2.1.RELEASE/spring-security-oauth2/src/main/java/org/springframework/security/oauth2/client/token/JdbcClientTokenServices.java target=_blank>OAUTH_CLIENT_TOKEN</a></li><li><a href=https://github.com/spring-projects/spring-security-oauth/blob/2.2.1.RELEASE/spring-security-oauth2/src/main/java/org/springframework/security/oauth2/provider/token/store/JdbcTokenStore.java target=_blank>OAUTH_ACCESS_TOKEN</a></li><li><a href=https://github.com/spring-projects/spring-security-oauth/blob/2.2.1.RELEASE/spring-security-oauth2/src/main/java/org/springframework/security/oauth2/provider/token/store/JdbcTokenStore.java target=_blank>OAUTH_REFRESH_TOKEN</a></li><li><a href=https://github.com/spring-projects/spring-security-oauth/blob/2.2.1.RELEASE/spring-security-oauth2/src/main/java/org/springframework/security/oauth2/provider/code/JdbcAuthorizationCodeServices.java target=_blank>OAUTH CODE</a></li><li><a href=https://github.com/spring-projects/spring-security-oauth/blob/2.2.1.RELEASE/spring-security-oauth2/src/main/java/org/springframework/security/oauth2/provider/approval/JdbcApprovalStore.java target=_blank>OAUTH_APPROVALS</a></li></ul><p>æˆ‘ä»¬å°†è°ƒç”¨åƒâ€œproduct_apiâ€è¿™æ ·çš„èµ„æºæœåŠ¡å™¨ å¯¹äºè¯¥æœåŠ¡å™¨ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œç§°ä¸ºï¼š</p><ul><li>è¯»-å†™-å®¢æˆ·ç«¯ï¼ˆæˆæƒæˆæƒç±»å‹ï¼šè¯»ã€å†™ï¼‰</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> OAUTH_CLIENT_DETAILS(CLIENT_ID, RESOURCE_IDS, CLIENT_SECRET, <span style=color:#66d9ef>SCOPE</span>, AUTHORIZED_GRANT_TYPES, AUTHORITIES, ACCESS_TOKEN_VALIDITY, REFRESH_TOKEN_VALIDITY)
</span></span><span style=display:flex><span><span style=color:#66d9ef>VALUES</span> (<span style=color:#e6db74>&#39;read-write-client&#39;</span>, <span style=color:#e6db74>&#39;product-api&#39;</span>,<span style=color:#e6db74>&#39;$2a$10$BurTWIy5NTF9GJJH4magz.9Bd4bBurWYG8tmXxeQh1vs7r/wnCFG2&#39;</span>,<span style=color:#e6db74>&#39;read,write&#39;</span>, <span style=color:#e6db74>&#39;client_credentials&#39;</span>, <span style=color:#e6db74>&#39;ROLE_PRODUCT_ADMIN&#39;</span>, <span style=color:#ae81ff>10800</span>, <span style=color:#ae81ff>2592000</span>);
</span></span><span style=display:flex><span><span style=color:#f92672>#</span>password [hashed <span style=color:#66d9ef>with</span> BCCrypt] :<span style=color:#66d9ef>user</span>
</span></span></code></pre></div><h3 id=æƒé™å’Œç”¨æˆ·è®¾ç½®>æƒé™å’Œç”¨æˆ·è®¾ç½®</h3><p>Spring Security é™„å¸¦ä¸¤ä¸ªæœ‰ç”¨çš„æ¥å£ï¼š</p><ul><li><p><a href=https://docs.spring.io/spring-security/site/docs/5.0.x/api/org/springframework/security/core/userdetails/UserDetails.html target=_blank>UserDetails</a> â€” æä¾›æ ¸å¿ƒç”¨æˆ·ä¿¡æ¯ã€‚</p></li><li><p><a href=https://docs.spring.io/spring-security/site/docs/5.0.x/api/org/springframework/security/core/GrantedAuthority.html target=_blank>GrantedAuthority</a> â€” è¡¨ç¤ºæˆäºˆèº«ä»½éªŒè¯å¯¹è±¡çš„æƒé™ã€‚</p></li></ul><p>ä¸‹é¢çš„è„šæœ¬å°†åŠ è½½æ‰€æœ‰æƒé™å’Œå‡­æ®ï¼ˆç”¨æˆ·ï¼‰ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> authority  <span style=color:#66d9ef>VALUES</span>(<span style=color:#ae81ff>1</span>,<span style=color:#e6db74>&#39;ROLE_OAUTH_ADMIN&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> authority <span style=color:#66d9ef>VALUES</span>(<span style=color:#ae81ff>2</span>,<span style=color:#e6db74>&#39;ROLE_ADMIN_PRODUCT&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> authority <span style=color:#66d9ef>VALUES</span>(<span style=color:#ae81ff>3</span>,<span style=color:#e6db74>&#39;ROLE_RESOURCE_ADMIN&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> credentials <span style=color:#66d9ef>VALUES</span>(<span style=color:#ae81ff>1</span>,b<span style=color:#e6db74>&#39;1&#39;</span>,<span style=color:#e6db74>&#39;oauth_admin&#39;</span>,<span style=color:#e6db74>&#39;$2a$10$BurTWIy5NTF9GJJH4magz.9Bd4bBurWYG8tmXxeQh1vs7r/wnCFG2&#39;</span>,<span style=color:#e6db74>&#39;0&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> credentials <span style=color:#66d9ef>VALUES</span>(<span style=color:#ae81ff>2</span>,b<span style=color:#e6db74>&#39;1&#39;</span>,<span style=color:#e6db74>&#39;resource_admin&#39;</span>,<span style=color:#e6db74>&#39;$2a$10$BurTWIy5NTF9GJJH4magz.9Bd4bBurWYG8tmXxeQh1vs7r/wnCFG2&#39;</span>,<span style=color:#e6db74>&#39;0&#39;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> credentials  <span style=color:#66d9ef>VALUES</span>(<span style=color:#ae81ff>3</span>,b<span style=color:#e6db74>&#39;1&#39;</span>,<span style=color:#e6db74>&#39;user&#39;</span>,<span style=color:#e6db74>&#39;$2a$10$BurTWIy5NTF9GJJH4magz.9Bd4bBurWYG8tmXxeQh1vs7r/wnCFG2&#39;</span>,<span style=color:#e6db74>&#39;0&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> credentials_authorities <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> credentials_authorities <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>INSERT</span> <span style=color:#66d9ef>INTO</span> credentials_authorities <span style=color:#66d9ef>VALUES</span> (<span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>2</span>);
</span></span><span style=display:flex><span><span style=color:#f92672>#</span>Password : <span style=color:#66d9ef>user</span>
</span></span></code></pre></div><h3 id=api-å±‚>API å±‚</h3><p>å¯¹äºæ¼”ç¤ºï¼ŒåŸºäº Spring Boot å¼€å‘äº† RESTful åº”ç”¨ç¨‹åºå¹¶å…¬å¼€ä»¥ä¸‹ç«¯ç‚¹ï¼š</p><p><img src=/images/oauth-2-centralized-authorization-02.webp alt=img></p><h3 id=spring-å®‰å…¨é…ç½®>Spring å®‰å…¨é…ç½®</h3><p>æˆ‘ä»¬å¿…é¡»æä¾› <a href=https://docs.spring.io/spring-security/site/docs/4.2.3.RELEASE/apidocs/org/springframework/security/core/userdetails/UserDetailsService.html target=_blank>UserDetailsService</a> æ¥å£çš„å®ç°ï¼Œä»¥ä¾¿è·å–ç”¨æˆ·å‡­æ®å’Œæƒé™ï¼Œå¦‚ä¸‹æ‰€ç¤º</p><p><img src=/images/oauth-2-centralized-authorization-03.webp alt=img></p><p>ä¸ºäº†å‘åº”ç”¨ç¨‹åºæä¾›å®‰å…¨æ€§ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ <a href=https://docs.spring.io/spring-security/site/docs/4.2.3.RELEASE/apidocs/org/springframework/security/config/annotation/web/configuration/EnableWebSecurity.html target=_blank>@EnableWebSecurity</a> æ³¨è§£å’Œ WebSecurityConfigurerAdapter</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@EnableWebSecurity</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WebSecurityConfiguration</span> <span style=color:#66d9ef>extends</span> WebSecurityConfigurerAdapter {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> PasswordEncoder <span style=color:#a6e22e>passwordEncoder</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> BCryptPasswordEncoder();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> UserDetailsService <span style=color:#a6e22e>userDetailsServiceBean</span>() <span style=color:#66d9ef>throws</span> Exception {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> JdbcUserDetails();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span>(WebSecurity web) <span style=color:#66d9ef>throws</span> Exception {
</span></span><span style=display:flex><span>        web.<span style=color:#a6e22e>ignoring</span>().<span style=color:#a6e22e>antMatchers</span>(<span style=color:#e6db74>&#34;/webjars/**&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span>(HttpSecurity http) <span style=color:#66d9ef>throws</span> Exception {
</span></span><span style=display:flex><span>        http
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>authorizeRequests</span>()
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>antMatchers</span>(<span style=color:#e6db74>&#34;/login&#34;</span>,<span style=color:#e6db74>&#34;/logout.do&#34;</span>).<span style=color:#a6e22e>permitAll</span>()
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>antMatchers</span>(<span style=color:#e6db74>&#34;/**&#34;</span>).<span style=color:#a6e22e>authenticated</span>()
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>and</span>()
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>formLogin</span>()
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>loginProcessingUrl</span>(<span style=color:#e6db74>&#34;/login.do&#34;</span>)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>usernameParameter</span>(<span style=color:#e6db74>&#34;username&#34;</span>)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>passwordParameter</span>(<span style=color:#e6db74>&#34;password&#34;</span>)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>loginPage</span>(<span style=color:#e6db74>&#34;/login&#34;</span>)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>and</span>()
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>logout</span>()
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>logoutRequestMatcher</span>(<span style=color:#66d9ef>new</span> AntPathRequestMatcher(<span style=color:#e6db74>&#34;/logout.do&#34;</span>))
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>and</span>()
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>userDetailsService</span>(userDetailsServiceBean());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span>(AuthenticationManagerBuilder auth) <span style=color:#66d9ef>throws</span> Exception {
</span></span><span style=display:flex><span>        auth.<span style=color:#a6e22e>userDetailsService</span>(userDetailsServiceBean())
</span></span><span style=display:flex><span>        .<span style=color:#a6e22e>passwordEncoder</span>(passwordEncoder());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=oauth2-é…ç½®>OAuth2 é…ç½®</h3><p>è¦è®¾ç½® Oauth 2ï¼Œéœ€è¦å®ç°ä¸¤ä¸ªç»„ä»¶</p><ul><li>Authorization Server æˆæƒæœåŠ¡å™¨</li><li>Resource Server èµ„æºæœåŠ¡å™¨</li></ul><h3 id=æˆæƒæœåŠ¡å™¨>æˆæƒæœåŠ¡å™¨</h3><p>æˆæƒæœåŠ¡å™¨è´Ÿè´£éªŒè¯ç”¨æˆ·èº«ä»½å¹¶æä¾›ä»¤ç‰Œï¼Œä½¿ç”¨@EnableAuthorizationServer æ³¨è§£å¯ç”¨æˆæƒæœåŠ¡å™¨é…ç½®</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@EnableAuthorizationServer</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>AuthorizationServerConfiguration</span> <span style=color:#66d9ef>extends</span> AuthorizationServerConfigurerAdapter {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@ConfigurationProperties</span>(prefix <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;spring.datasource&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> DataSource <span style=color:#a6e22e>oauthDataSource</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> DataSourceBuilder.<span style=color:#a6e22e>create</span>().<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> JdbcClientDetailsService <span style=color:#a6e22e>clientDetailsService</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> JdbcClientDetailsService(oauthDataSource());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> TokenStore <span style=color:#a6e22e>tokenStore</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> JdbcTokenStore(oauthDataSource());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> ApprovalStore <span style=color:#a6e22e>approvalStore</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> JdbcApprovalStore(oauthDataSource());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> AuthorizationCodeServices <span style=color:#a6e22e>authorizationCodeServices</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> JdbcAuthorizationCodeServices(oauthDataSource());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span>(ClientDetailsServiceConfigurer clients) <span style=color:#66d9ef>throws</span> Exception {
</span></span><span style=display:flex><span>        clients.<span style=color:#a6e22e>withClientDetails</span>(clientDetailsService());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span>(AuthorizationServerSecurityConfigurer oauthServer) <span style=color:#66d9ef>throws</span> Exception {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span>(AuthorizationServerEndpointsConfigurer endpoints) <span style=color:#66d9ef>throws</span> Exception {
</span></span><span style=display:flex><span>        endpoints
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>approvalStore</span>(approvalStore())
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>authorizationCodeServices</span>(authorizationCodeServices())
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>tokenStore</span>(tokenStore());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>æˆåŠŸé…ç½®è¿è¡ŒæˆæƒæœåŠ¡å™¨åï¼Œæ‚¨å°†è·å¾—ç™»å½•é¡µé¢æ¥ç®¡ç†æˆæƒæœåŠ¡å™¨</p><p><img src=/images/oauth-2-centralized-authorization-04.webp alt=img></p><p>ä½¿ç”¨ oauth_admin/user ä½œä¸ºç”¨æˆ·å/å¯†ç è®¿é—® Oauth2 ä»ªè¡¨æ¿ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­åˆ›å»ºæœåŠ¡å™¨å®¢æˆ·ç«¯</p><p><img src=/images/oauth-2-centralized-authorization-05.webp alt=img></p><h2 id=èµ„æºæœåŠ¡å™¨>èµ„æºæœåŠ¡å™¨</h2><p>èµ„æºæœåŠ¡å™¨æ‰˜ç®¡å— OAuth2 ä»¤ç‰Œä¿æŠ¤çš„èµ„æºï¼ˆåŸºæœ¬ä¸Šæ˜¯æˆ‘ä»¬çš„äº§å“ APIï¼‰</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@EnableResourceServer</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Configuration</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ResourcesServerConfiguration</span>  <span style=color:#66d9ef>extends</span> ResourceServerConfigurerAdapter {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@ConfigurationProperties</span>(prefix<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;spring.datasource&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> DataSource <span style=color:#a6e22e>ouathDataSource</span>(){<span style=color:#66d9ef>return</span> DataSourceBuilder.<span style=color:#a6e22e>create</span>().<span style=color:#a6e22e>build</span>();}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span>(ResourceServerSecurityConfigurer resources)<span style=color:#66d9ef>throws</span> Exception{
</span></span><span style=display:flex><span>        TokenStore tokenStore<span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> JdbcTokenStore(ouathDataSource());
</span></span><span style=display:flex><span>        resources.<span style=color:#a6e22e>resourceId</span>(<span style=color:#e6db74>&#34;product_api&#34;</span>).<span style=color:#a6e22e>tokenStore</span>(tokenStore);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>configure</span>(HttpSecurity http) <span style=color:#66d9ef>throws</span> Exception{
</span></span><span style=display:flex><span>        http
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>authorizeRequests</span>()
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>antMatchers</span>(HttpMethod.<span style=color:#a6e22e>GET</span>, <span style=color:#e6db74>&#34;/**&#34;</span>).<span style=color:#a6e22e>access</span>(<span style=color:#e6db74>&#34;#oauth2.hasScope(&#39;read&#39;)&#34;</span>)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>antMatchers</span>(HttpMethod.<span style=color:#a6e22e>POST</span>, <span style=color:#e6db74>&#34;/**&#34;</span>).<span style=color:#a6e22e>access</span>(<span style=color:#e6db74>&#34;#oauth2.hasScope(&#39;write&#39;)&#34;</span>)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>antMatchers</span>(HttpMethod.<span style=color:#a6e22e>PATCH</span>, <span style=color:#e6db74>&#34;/**&#34;</span>).<span style=color:#a6e22e>access</span>(<span style=color:#e6db74>&#34;#oauth2.hasScope(&#39;write&#39;)&#34;</span>)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>antMatchers</span>(HttpMethod.<span style=color:#a6e22e>PUT</span>, <span style=color:#e6db74>&#34;/**&#34;</span>).<span style=color:#a6e22e>access</span>(<span style=color:#e6db74>&#34;#oauth2.hasScope(&#39;write&#39;)&#34;</span>)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>antMatchers</span>(HttpMethod.<span style=color:#a6e22e>DELETE</span>, <span style=color:#e6db74>&#34;/**&#34;</span>).<span style=color:#a6e22e>access</span>(<span style=color:#e6db74>&#34;#oauth2.hasScope(&#39;write&#39;)&#34;</span>)
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>and</span>()
</span></span><span style=display:flex><span>                .<span style=color:#a6e22e>headers</span>().<span style=color:#a6e22e>addHeaderWriter</span>((request, response) <span style=color:#f92672>-&gt;</span> {
</span></span><span style=display:flex><span>            			response.<span style=color:#a6e22e>addHeader</span>(<span style=color:#e6db74>&#34;Access-Control-Allow-Origin&#34;</span>, <span style=color:#e6db74>&#34;*&#34;</span>);
</span></span><span style=display:flex><span>                  <span style=color:#66d9ef>if</span> (request.<span style=color:#a6e22e>getMethod</span>().<span style=color:#a6e22e>equals</span>(<span style=color:#e6db74>&#34;OPTIONS&#34;</span>)) {
</span></span><span style=display:flex><span>                      response.<span style=color:#a6e22e>setHeader</span>(<span style=color:#e6db74>&#34;Access-Control-Allow-Methods&#34;</span>, request.<span style=color:#a6e22e>getHeader</span>(<span style=color:#e6db74>&#34;Access-Control-Request-Method&#34;</span>));
</span></span><span style=display:flex><span>                      response.<span style=color:#a6e22e>setHeader</span>(<span style=color:#e6db74>&#34;Access-Control-Allow-Headers&#34;</span>, request.<span style=color:#a6e22e>getHeader</span>(<span style=color:#e6db74>&#34;Access-Control-Request-Headers&#34;</span>));
</span></span><span style=display:flex><span>                  }
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ä½¿ç”¨ä»¥ä¸‹ Curl å®¢æˆ·ç«¯æµ‹è¯•äº§å“åˆ—è¡¨ç«¯ç‚¹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/sh
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>TOKEN<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>curl -s -u curl_client:user -X POST localhost:8081/oauth/token<span style=color:#ae81ff>\?</span>grant_type<span style=color:#f92672>=</span>client_credentials | egrep -o â€˜<span style=color:#f92672>[</span>a-f0â€“9-<span style=color:#f92672>]{</span>20,<span style=color:#f92672>}</span>â€™<span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;Got token for curl client as :</span>$TOKEN<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>curl localhost:8083/product/products -H <span style=color:#e6db74>&#34;Authorization: Bearer </span>$TOKEN<span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><p>è¿è¡Œ Curl å®¢æˆ·ç«¯ bash è„šæœ¬åå¾—åˆ°å“åº”ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ./client.sh
</span></span><span style=display:flex><span>Got token <span style=color:#66d9ef>for</span> curl client as : 3be01519â€“0cab-4049-b87d-617c48bda502
</span></span><span style=display:flex><span><span style=color:#f92672>[{</span>â€œversionâ€:0,â€nameâ€:â€product_1<span style=color:#e6db74>&#34;,â€availableâ€:false},{â€œversionâ€:0,â€nameâ€:â€product_2&#34;</span>,â€availableâ€:true<span style=color:#f92672>}]</span>
</span></span></code></pre></div><p>ä» github ä¸ŠæŸ¥çœ‹æ•´ä¸ªä»£ç ï¼šhttps://github.com/Akourtiim/oauth2-spring-boot-2.0.2.git</p><p><strong>å‚è€ƒï¼š</strong></p><ul><li><a href=https://tools.ietf.org/html/rfc6749 target=_blank>https://tools.ietf.org/html/rfc6749</a></li><li><a href=https://dzone.com/articles/secure-spring-rest-with-spring-security-and-oauth2 target=_blank>https://dzone.com/articles/secure-spring-rest-with-spring-security-and-oauth2</a></li><li><a href=http://www.bubblecode.net/en/2016/01/22/understanding-oauth2/ target=_blank>http://www.bubblecode.net/en/2016/01/22/understanding-oauth2/</a></li><li><a href=https://github.com/FrontierPsychiatrist/spring-oauth-example target=_blank>https://github.com/FrontierPsychiatrist/spring-oauth-example</a></li></ul><p>åŸæ–‡é“¾æ¥ï¼š<a href=https://akourtim-ahmed.medium.com/oauth-2-centralized-authorization-with-spring-boot-2-0-2-and-spring-security-5-and-jdbc-token-store-8dbc063bd5d4 target=_blank>Oauth 2 Centralized Authorization with Spring Boot 2.0.2 and Spring Security 5 and JDBC token store</a></p></div><div><div style=font-weight:700>Share this post:</div><a class=social-link-item href="https://twitter.com/intent/tweet?text=%5b%e8%af%91%5d%e4%bd%bf%e7%94%a8Spring%20Boot2%e5%92%8cSpring%20Security%205%e4%bb%a5%e5%8f%8aJDBC%e4%bb%a4%e7%89%8c%e5%ad%98%e5%82%a8%e8%bf%9b%e8%a1%8cOauth2%e9%9b%86%e4%b8%ad%e6%8e%88%e6%9d%83 https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f07%2f14%2foauth-2-centralized-authorization-with-spring-boot-2-and-spring-security-5-and-jdbc-token-store%2f" target=_blank rel="noopener noreferrer" title="Click to share on Twitter"><i class="fa-brands fa-square-twitter fa-2xl" style=color:#55acee></i>
</a><a class=social-link-item href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f07%2f14%2foauth-2-centralized-authorization-with-spring-boot-2-and-spring-security-5-and-jdbc-token-store%2f&title=%5b%e8%af%91%5d%e4%bd%bf%e7%94%a8Spring%20Boot2%e5%92%8cSpring%20Security%205%e4%bb%a5%e5%8f%8aJDBC%e4%bb%a4%e7%89%8c%e5%ad%98%e5%82%a8%e8%bf%9b%e8%a1%8cOauth2%e9%9b%86%e4%b8%ad%e6%8e%88%e6%9d%83" target=_blank rel="noopener noreferrer" title="Click to share on LinkedIn"><i class="fa-brands fa-linkedin fa-2xl" style=color:#007bb5></i>
</a><a class=social-link-item href="https://telegram.me/share/url?text=%5b%e8%af%91%5d%e4%bd%bf%e7%94%a8Spring%20Boot2%e5%92%8cSpring%20Security%205%e4%bb%a5%e5%8f%8aJDBC%e4%bb%a4%e7%89%8c%e5%ad%98%e5%82%a8%e8%bf%9b%e8%a1%8cOauth2%e9%9b%86%e4%b8%ad%e6%8e%88%e6%9d%83&amp;url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f07%2f14%2foauth-2-centralized-authorization-with-spring-boot-2-and-spring-security-5-and-jdbc-token-store%2f" target=_blank rel="noopener noreferrer" title="Click to share on telegram"><i class="fa-brands fa-telegram fa-2xl" style=color:#007bb5></i>
</a><a class=social-link-item href="https://reddit.com/submit?url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f07%2f14%2foauth-2-centralized-authorization-with-spring-boot-2-and-spring-security-5-and-jdbc-token-store%2f&title=%5b%e8%af%91%5d%e4%bd%bf%e7%94%a8Spring%20Boot2%e5%92%8cSpring%20Security%205%e4%bb%a5%e5%8f%8aJDBC%e4%bb%a4%e7%89%8c%e5%ad%98%e5%82%a8%e8%bf%9b%e8%a1%8cOauth2%e9%9b%86%e4%b8%ad%e6%8e%88%e6%9d%83" target=_blank rel="noopener noreferrer" title="Click to share on reddit"><i class="fa-brands fa-reddit fa-2xl" style=color:#007bb5></i>
</a><a class=social-link-item href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f07%2f14%2foauth-2-centralized-authorization-with-spring-boot-2-and-spring-security-5-and-jdbc-token-store%2f" target=_blank rel="noopener noreferrer" title="Click to share on facebook"><i class="fa-brands fa-facebook fa-2xl" style=color:#007bb5></i>
</a><a class=social-link-item href="https://api.whatsapp.com/send?text=%5b%e8%af%91%5d%e4%bd%bf%e7%94%a8Spring%20Boot2%e5%92%8cSpring%20Security%205%e4%bb%a5%e5%8f%8aJDBC%e4%bb%a4%e7%89%8c%e5%ad%98%e5%82%a8%e8%bf%9b%e8%a1%8cOauth2%e9%9b%86%e4%b8%ad%e6%8e%88%e6%9d%83%20-%20https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f07%2f14%2foauth-2-centralized-authorization-with-spring-boot-2-and-spring-security-5-and-jdbc-token-store%2f" target=_blank rel="noopener noreferrer" title="Click to share on whatsapp"><i class="fa-brands fa-whatsapp fa-2xl" style=color:#007bb5></i></a></div></div></article><nav class="navigation post-navigation" role=navigation><h2 class=screen-reader-text>Post navigation</h2><div class=nav-links><div class=nav-previous><a href=/posts/2023/07/26/using-oauth2-in-spring/ rel=next><span class=post-title>[è¯‘]åœ¨ Spring ä¸­å®ç° OAuth2ï¼šç¬¬ 1 éƒ¨åˆ†</span></a></div><div class=nav-next><a href=/posts/2023/07/11/weekly_review_26/ rel=prev><span class=post-title>å‘¨æŠ¥-26ï½œä¸ŠåŠå¹´çš„ç»©æ•ˆæ€»ç»“</span></a></div></div></nav><h2>Related content</h2><ul><li><a href=/posts/2023/10/13/new-features-in-spring-boot-3-and-spring-6/>[è¯‘]Spring Boot3å’ŒSpring6ä¸­çš„æ–°ç‰¹æ€§</a></li><li><a href=/posts/2023/10/12/spring-security-interview-questions/>[è¯‘]Spring Security é¢è¯•é—®é¢˜</a></li><li><a href=/posts/2023/09/19/spring-security-tutorial/>[è¯‘]Spring Security ä¸ JWT for REST API</a></li><li><a href=/posts/2023/09/19/spring-security-jwt/>[è¯‘]å¦‚ä½•ä½¿ç”¨Spring Securityå’ŒJWTä¿æŠ¤æ‚¨çš„REST API</a></li><li><a href=/posts/2023/08/25/global-error-handler-in-a-spring-rest-api/>[è¯‘]REST API çš„è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯å¤„ç†</a></li><li><a href=/posts/2023/08/25/spring-events/>[è¯‘]Spring Events</a></li><li><a href=/posts/2023/08/25/spring-security-async-principal-propagation/>[è¯‘]ä½¿ç”¨@Asyncè¿›è¡ŒSpring Securityä¸Šä¸‹æ–‡ä¼ æ’­</a></li><li><a href=/posts/2023/08/25/exception-handling-for-rest-with-spring/>[è¯‘]ä½¿ç”¨Springè¿›è¡ŒRESTçš„é”™è¯¯å¤„ç†</a></li><li><a href=/posts/2023/08/25/spring-async/>[è¯‘]å¦‚ä½•åœ¨Springä¸­æ‰§è¡Œ@Async</a></li><li><a href=/posts/2023/08/18/how-to-implement-jwt-authentication-in-spring-boot-project/>[è¯‘]Spring Booté¡¹ç›®å¦‚ä½•å®ç°JWTè®¤è¯ï¼Ÿ</a></li></ul></main></section></div><div id=footer class=footer-wrap><footer id=colophon class="site-footer container clearfix" role=contentinfo><div id=footer-text class=site-info><span class=credit-link>Made with ğŸ©·
by <a href=/ target=_blank rel="noopener noreferrer">ChenSoul</a></span></div></footer></div></div><script type=text/javascript src=/main.min.js></script></body></html>