<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[译]在 Spring 中实现 OAuth2：使用范围（第 2 部分） | ChenSoul</title><meta name=keywords content="java,spring,maven,gradle"><meta name=description content="在分布式、快节奏的环境中，开发团队通常希望了解他们部署应用程序的时间、部署的应用程序版本、部署的 Git 提交等等。 Spring Boot Actuator帮助我们监控"><meta name=author content="chensoul"><link rel=canonical href=https://blog.chensoul.com/posts/2023/07/26/spring-boot-info-endpoint/><meta name=google-site-verification content="nBXwg45SBRjTX78SA-mH0asrAbsdu9c1nk0ObSry7aQ"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="8E787EFCDB0CE747FE1A4DA0ABEC66E4"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.chensoul.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.chensoul.com/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://blog.chensoul.com/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://blog.chensoul.com/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://blog.chensoul.com/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta name=baidu-site-verification content="codeva-FYpQY8JdLU"><meta property="og:title" content="[译]在 Spring 中实现 OAuth2：使用范围（第 2 部分）"><meta property="og:description" content="在分布式、快节奏的环境中，开发团队通常希望了解他们部署应用程序的时间、部署的应用程序版本、部署的 Git 提交等等。 Spring Boot Actuator帮助我们监控"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.chensoul.com/posts/2023/07/26/spring-boot-info-endpoint/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-07-26T07:05:00+08:00"><meta property="article:modified_time" content="2023-07-26T07:05:00+08:00"><meta property="og:site_name" content="ChenSoul"><meta name=twitter:card content="summary"><meta name=twitter:title content="[译]在 Spring 中实现 OAuth2：使用范围（第 2 部分）"><meta name=twitter:description content="在分布式、快节奏的环境中，开发团队通常希望了解他们部署应用程序的时间、部署的应用程序版本、部署的 Git 提交等等。 Spring Boot Actuator帮助我们监控"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.chensoul.com/posts/"},{"@type":"ListItem","position":2,"name":"[译]在 Spring 中实现 OAuth2：使用范围（第 2 部分）","item":"https://blog.chensoul.com/posts/2023/07/26/spring-boot-info-endpoint/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[译]在 Spring 中实现 OAuth2：使用范围（第 2 部分）","name":"[译]在 Spring 中实现 OAuth2：使用范围（第 2 部分）","description":"在分布式、快节奏的环境中，开发团队通常希望了解他们部署应用程序的时间、部署的应用程序版本、部署的 Git 提交等等。 Spring Boot Actuator帮助我们监控","keywords":["java","spring","maven","gradle"],"articleBody":"在分布式、快节奏的环境中，开发团队通常希望了解他们部署应用程序的时间、部署的应用程序版本、部署的 Git 提交等等。\nSpring Boot Actuator帮助我们监控和管理应用程序。它公开了提供应用程序运行状况、指标和其他相关信息的各种端点。\n在本文中，我们将了解如何使用 Spring Boot Actuator 和 Maven/Gradle 构建插件将此类信息添加到我们的项目中。\n示例代码 本文附有 GitHub 上的工作代码示例。\n启用 Spring Boot 执行器 Spring Boot Actuator是Spring Boot的一个子项目。在本节中，我们将快速了解如何引导示例项目并启用 /info 端点。如果您想了解更多有关 Spring Boot Actuator 的信息，已经有一个很棒的教程了。\n让我们使用 Spring Initializr 快速创建一个 Spring Boot 项目。我们将需要以下依赖项：\n依赖性 目的 Spring Boot Actuator 公开应用程序管理端点，例如 info 。 Spring Web 启用 Web 应用程序行为。 如果有帮助，这里是 Maven 和 Gradle 中预填充项目的链接。\n项目构建后，我们将通过 HTTP 公开内置的 /info 端点。默认情况下， /info Web 端点处于禁用状态。我们可以通过在 application.properties 配置中添加 management.endpoints.web.exposure.include 属性来简单地启用它：\nmanagement.endpoints.web.exposure.include=health,info 让我们运行 Spring Boot 应用程序并在浏览器中打开 URL http://localhost:8080/actuator/info 。目前还看不到任何有用的东西，因为我们仍然需要进行一些配置更改。在下一节中，我们将了解如何在此响应中添加信息丰富的构建信息。\n保护端点 如果您公开公开端点，请确保适当保护它们。我们不应在不知情的情况下泄露任何敏感信息。\nSpring Boot应用程序信息 Spring 从应用程序上下文中定义的各种 InfoContributor bean 收集有用的应用程序信息。下面是默认 InfoContributor beans 的摘要：\nID Bean Name 用法 build BuildInfoContributor 公开构建信息。 env EnvironmentInfoContributor 公开 Environment 中名称以 info. 开头的任何属性 git GitInfoContributor 公开 Git 相关信息。 java JavaInfoContributor 公开 Java 运行时信息。 默认情况下， env 和 java 贡献者被禁用。\n首先，我们将通过在 application.properties 中添加以下键值对来启用 java 贡献者：\nmanagement.info.java.enabled=true 让我们重新运行该应用程序。如果我们在浏览器中再次打开执行器 /info 端点，我们会得到如下输出：\n{ \"java\": { \"vendor\": \"Eclipse Adoptium\", \"version\": \"11.0.14\", \"runtime\": { \"name\": \"OpenJDK Runtime Environment\", \"version\": \"11.0.14+9\" }, \"jvm\": { \"name\": \"OpenJDK 64-Bit Server VM\", \"vendor\": \"Eclipse Adoptium\", \"version\": \"11.0.14+9\" } } } 根据安装的 Java 版本，您可能会看到不同的值。\n现在，是时候显示环境变量了。 Spring 会选取属性名称以 info 开头的任何环境变量。要查看实际效果，让我们在 application.properties 文件中添加以下属性：\nmanagement.info.env.enabled=true info.app.website=reflectoring.io 重新启动应用程序后，我们将开始看到添加到执行器 info 端点的以下信息：\n{ \"app\": { \"website\": \"reflectoring.io\" } } 请随意添加您想要的任意数量的信息变量:)\n在以下部分中，我们将了解如何添加 Git 和应用程序构建特定信息。\n添加构建信息 添加有用的构建信息有助于快速识别构建工件名称、版本、创建时间等。它可以方便地检查团队是否部署了应用程序的相关版本。 Spring Boot 允许使用 Maven 或 Gradle 构建插件轻松添加此内容。\n使用 Maven 插件 Spring Boot Maven 插件捆绑了许多有用的功能，例如创建可执行 jar 或 war 存档、运行应用程序等。它还提供了一种添加应用程序构建信息的方法。\n如果存在有效的 META-INF/build-info.properties 文件，Spring Boot Actuator 将显示构建详细信息。 Spring Boot Maven 插件的 build-info 目标是创建此文件。\n如果您使用 Spring Initializr 引导项目，则默认情况下该插件将出现在 pom.xml 中。我们只需添加 build-info 执行目标，如下所示：\norg.springframework.boot spring-boot-maven-plugin 2.6.4 build-info 如果我们现在运行命令 ./mvnw spring-boot:run （对于 Linux/macOS）或 mvnw.bat spring-boot:run （对于 Windows），所需的文件将在 target/classes/META-INF/build-info.properties 中创建。\n文件内容将与此类似：\nbuild.artifact=spring-boot-build-info build.group=io.reflectoring build.name=spring-boot-build-info build.time=2022-03-06T05\\:53\\:45.236Z build.version=0.0.1-SNAPSHOT 我们还可以使用 additionalProperties 属性将自定义属性添加到此列表：\nbuild-info value1 value2 如果我们现在运行应用程序并在浏览器中打开 http://localhost:8080/actuator/info 端点，我们将看到类似于以下内容的响应：\n{ \"build\": { \"custom\": { \"key2\": \"value2\", \"key1\": \"value1\" }, \"version\": \"0.0.1-SNAPSHOT\", \"artifact\": \"spring-boot-build-info\", \"name\": \"spring-boot-build-info\", \"time\": \"2022-03-06T06:34:30.306Z\", \"group\": \"io.reflectoring\" } } 如果您想排除任何可以使用 excludeInfoProperties 配置的属性。让我们看看如何排除 artifact 属性：\nartifact 请参阅 Spring Boot 官方文档了解更多信息。\n现在，是时候看看我们如何使用 Spring Boot Gradle 插件实现相同的输出了。\n使用 Gradle 插件 添加构建信息的最简单方法是使用插件 DSL。在 build.gradle 文件中，我们需要添加以下块：\nspringBoot { buildInfo() } 如果我们现在同步 Gradle 项目，我们可以看到一个新任务 bootBuildInfo 可供使用。运行该任务将生成带有构建信息的类似 build/resources/main/META-INF/build-info.properties 文件（源自项目）。使用 DSL，我们可以自定义现有值或添加新属性：\nspringBoot { buildInfo { properties { name = 'Sample App' additional = [ 'customKey': 'customValue' ] } } } 是时候使用 ./gradlew bootRun （对于 macOS/Linux）或 gradlew.bat bootRun （对于 Windows）命令运行应用程序了。应用程序运行后，我们可以在浏览器中打开 http://localhost:8080/actuator/info 端点并找到响应：\n{ \"build\": { \"customKey\": \"customValue\", \"version\": \"0.0.1-SNAPSHOT\", \"artifact\": \"spring-boot-build-info\", \"name\": \"Sample App\", \"time\": \"2022-03-06T09:11:53.380Z\", \"group\": \"io.reflectoring\" } } 我们可以通过将其值设置为 null 来从生成的构建信息中排除任何默认属性。例如：\nproperties { group = null } 想了解更多关于该插件的信息，可以参考 Spring Boot 官方文档。\n添加 Git 信息 Git 信息可以方便地快速识别生产中是否存在相关代码或者分布式部署是否与预期同步。 Spring Boot 可以使用 Maven 和 Gradle 插件轻松地将 Git 属性包含在 Actuator 端点中。\n使用这个插件我们可以生成一个 git.properties 文件。此文件的存在将自动配置 GitProperties bean，供 GitInfoContributor bean 使用来整理相关信息。\n默认情况下，将公开以下信息：\ngit.branch git.commit.id git.commit.time 以下管理应用程序属性控制 Git 相关信息：\n应用属性 目的 management.info.git.enabled=false 完全从 info 端点禁用 Git 信息 management.info.git.mode=full 显示 git.properties 文件中的所有属性 使用 Maven 插件 Maven Git Commit ID 插件通过 spring-boot-starter-parent pom.xml 进行管理。要使用它，我们必须编辑 pom.xml 如下：\npl.project13.maven git-commit-id-plugin 如果我们运行该项目并在浏览器中打开 /actuator/info 端点，它将返回Git相关信息：\n{ \"git\": { \"branch\": \"main\", \"commit\": { \"id\": \"5404bdf\", \"time\": \"2022-03-06T10:34:16Z\" } } } 我们还可以检查 target/classes/git.properties 下生成的文件。这对我来说是这样的：\n#Generated by Git-Commit-Id-Plugin git.branch=main git.build.host=mylaptop git.build.time=2022-03-06T23\\:22\\:16+0530 git.build.user.email=user@email.com git.build.user.name=user git.build.version=0.0.1-SNAPSHOT git.closest.tag.commit.count= git.closest.tag.name= git.commit.author.time=2022-03-06T22\\:46\\:56+0530 git.commit.committer.time=2022-03-06T22\\:46\\:56+0530 git.commit.id=e9fa20d4914367c1632e3a0eb8ca4d2f32b31a89 git.commit.id.abbrev=e9fa20d git.commit.id.describe=e9fa20d-dirty git.commit.id.describe-short=e9fa20d-dirty git.commit.message.full=Update config git.commit.message.short=Update config git.commit.time=2022-03-06T22\\:46\\:56+0530 git.commit.user.email=saikat@email.com git.commit.user.name=Saikat git.dirty=true git.local.branch.ahead=NO_REMOTE git.local.branch.behind=NO_REMOTE git.remote.origin.url=Unknown git.tags= git.total.commit.count=2 这个插件带有很多配置选项。例如，要包含/排除特定属性，我们可以添加 configuration 部分，如下所示：\ntime git.commit.id 它将生成如下输出：\n{ \"git\": { \"commit\": { \"id\": \"5404bdf\" } } } 译者备注：\n使用 4.9.10 版本时，如果想指定输出内容，需要这样设置：\npl.project13.maven git-commit-id-plugin 4.9.10 revision true yyyy-MM-dd HH:mm:ss GMT+8 git.branch,git.build.time,git.build.version,git.commit.id,git.commit.time,git.commit.message.full 现在让我们看看 Gradle 用户可以使用哪些选项。\n使用 Gradle 插件 在 build.gradle 中，我们将添加 gradle-git-properties 插件：\nplugins { id 'com.gorylenko.gradle-git-properties' version '2.4.0' } 现在让我们构建 Gradle 项目。我们可以看到 build/resources/main/git.properties 文件已创建。并且，执行器 info 端点将显示相同的数据：\n{ \"git\": { \"branch\": \"main\", \"commit\": { \"id\": \"5404bdf\", \"time\": \"2022-03-06T10:34:16Z\" } } } 该插件也提供了多种使用属性 gitProperties 配置输出的方法。例如，我们通过添加以下内容来限制要出现的键：\ngitProperties { keys = ['git.commit.id'] } 重新运行应用程序现在将显示有限的 Git 信息：\n{ \"git\": { \"commit\": { \"id\": \"5404bdf\" } } } 结论 在本文中，我们学习了如何使用 Spring Actuator 来公开有关我们应用程序的相关信息。我们了解了如何将有关构建、环境、Git 和 Java 环境的信息添加到 Actuator /info 端点。我们还研究了如何通过 Maven/Gradle 构建插件配置和控制所有这些信息。\n您可以使用 GitHub 上的代码来尝试一个完整的应用程序来说明这些想法。\n原文链接：https://reflectoring.io/spring-boot-info-endpoint/\n","wordCount":"2518","inLanguage":"en","datePublished":"2023-07-26T07:05:00+08:00","dateModified":"2023-07-26T07:05:00+08:00","author":{"@type":"Person","name":"chensoul"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.chensoul.com/posts/2023/07/26/spring-boot-info-endpoint/"},"publisher":{"@type":"Organization","name":"ChenSoul","logo":{"@type":"ImageObject","url":"https://blog.chensoul.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.chensoul.com/ accesskey=h title="ChenSoul (Alt + H)">ChenSoul</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.chensoul.com/categories/ideas title=周报><span>周报</span></a></li><li><a href=https://blog.chensoul.com/categories/notes title=编程><span>编程</span></a></li><li><a href=https://blog.chensoul.com/tags title=标签><span>标签</span></a></li><li><a href=https://blog.chensoul.com/about title=关于><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>[译]在 Spring 中实现 OAuth2：使用范围（第 2 部分）</h1><div class=post-meta><span title='2023-07-26 07:05:00 +0800 +0800'>2023-07-26</span>&nbsp;·&nbsp;chensoul</div></header><div class=post-content><p>在分布式、快节奏的环境中，开发团队通常希望了解他们部署应用程序的时间、部署的应用程序版本、部署的 Git 提交等等。</p><p>Spring Boot Actuator帮助我们监控和管理应用程序。它公开了提供应用程序运行状况、指标和其他相关信息的各种端点。</p><p>在本文中，我们将了解如何使用 Spring Boot Actuator 和 Maven/Gradle 构建插件将此类信息添加到我们的项目中。</p><h2 id=示例代码>示例代码<a hidden class=anchor aria-hidden=true href=#示例代码>#</a></h2><p>本文附有 GitHub 上的工作<a href=https://github.com/thombergs/code-examples/tree/master/spring-boot/spring-boot-app-info>代码示例</a>。</p><h2 id=启用-spring-boot-执行器>启用 Spring Boot 执行器<a hidden class=anchor aria-hidden=true href=#启用-spring-boot-执行器>#</a></h2><p>Spring Boot Actuator是Spring Boot的一个子项目。在本节中，我们将快速了解如何引导示例项目并启用 <code>/info</code> 端点。如果您想了解更多有关 Spring Boot Actuator 的信息，已经有一个很棒的<a href=https://reflectoring.io/exploring-a-spring-boot-app-with-actuator-and-jq/>教程</a>了。</p><p>让我们使用 <a href=https://start.spring.io/>Spring Initializr</a> 快速创建一个 Spring Boot 项目。我们将需要以下依赖项：</p><table><thead><tr><th>依赖性</th><th>目的</th></tr></thead><tbody><tr><td>Spring Boot Actuator</td><td>公开应用程序管理端点，例如 <code>info</code> 。</td></tr><tr><td>Spring Web</td><td>启用 Web 应用程序行为。</td></tr></tbody></table><p>如果有帮助，这里是 <a href="https://start.spring.io/#!type=maven-project&amp;language=java&amp;platformVersion=2.6.4&amp;packaging=jar&amp;jvmVersion=11&amp;groupId=io.reflectoring&amp;artifactId=demo&amp;name=Demo%20Application&amp;description=Demo%20project%20for%20Spring%20Boot%20Application%20Info&amp;packageName=io.reflectoring.demo&amp;dependencies=web,actuator">Maven</a> 和 <a href="https://start.spring.io/#!type=gradle-project&amp;language=java&amp;platformVersion=2.6.4&amp;packaging=jar&amp;jvmVersion=11&amp;groupId=io.reflectoring&amp;artifactId=demo&amp;name=Demo%20Application&amp;description=Demo%20project%20for%20Spring%20Boot%20Application%20Info&amp;packageName=io.reflectoring.demo&amp;dependencies=web,actuator">Gradle</a> 中预填充项目的链接。</p><p>项目构建后，我们将通过 HTTP 公开内置的 <code>/info</code> 端点。默认情况下， <code>/info</code> Web 端点处于禁用状态。我们可以通过在 <code>application.properties</code> 配置中添加 <code>management.endpoints.web.exposure.include</code> 属性来简单地启用它：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-properties data-lang=properties><span class=line><span class=cl><span class=na>management.endpoints.web.exposure.include</span><span class=o>=</span><span class=s>health,info</span>
</span></span></code></pre></div><p>让我们运行 Spring Boot 应用程序并在浏览器中打开 URL <code>http://localhost:8080/actuator/info</code> 。目前还看不到任何有用的东西，因为我们仍然需要进行一些配置更改。在下一节中，我们将了解如何在此响应中添加信息丰富的构建信息。</p><blockquote><h4 id=保护端点>保护端点<a hidden class=anchor aria-hidden=true href=#保护端点>#</a></h4><p>如果您公开公开端点，请确保适当<a href=https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html#actuator.endpoints.security>保护</a>它们。我们不应在不知情的情况下泄露任何敏感信息。</p></blockquote><h2 id=spring-boot应用程序信息>Spring Boot应用程序信息<a hidden class=anchor aria-hidden=true href=#spring-boot应用程序信息>#</a></h2><p>Spring 从应用程序上下文中定义的各种 <a href=https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/actuate/info/InfoContributor.html>InfoContributor</a> bean 收集有用的应用程序信息。下面是默认 <code>InfoContributor</code> beans 的摘要：</p><table><thead><tr><th>ID</th><th>Bean Name</th><th>用法</th></tr></thead><tbody><tr><td><code>build</code></td><td><code>BuildInfoContributor</code></td><td>公开构建信息。</td></tr><tr><td><code>env</code></td><td><code>EnvironmentInfoContributor</code></td><td>公开 <code>Environment</code> 中名称以 <code>info.</code> 开头的任何属性</td></tr><tr><td><code>git</code></td><td><code>GitInfoContributor</code></td><td>公开 Git 相关信息。</td></tr><tr><td><code>java</code></td><td><code>JavaInfoContributor</code></td><td>公开 Java 运行时信息。</td></tr></tbody></table><p><strong>默认情况下， <code>env</code> 和 <code>java</code> 贡献者被禁用。</strong></p><p>首先，我们将通过在 <code>application.properties</code> 中添加以下键值对来启用 <code>java</code> 贡献者：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-properties data-lang=properties><span class=line><span class=cl><span class=na>management.info.java.enabled</span><span class=o>=</span><span class=s>true</span>
</span></span></code></pre></div><p>让我们重新运行该应用程序。如果我们在浏览器中再次打开执行器 <code>/info</code> 端点，我们会得到如下输出：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;java&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;vendor&#34;</span><span class=p>:</span> <span class=s2>&#34;Eclipse Adoptium&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;11.0.14&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;runtime&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;OpenJDK Runtime Environment&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;11.0.14+9&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;jvm&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;OpenJDK 64-Bit Server VM&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;vendor&#34;</span><span class=p>:</span> <span class=s2>&#34;Eclipse Adoptium&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;11.0.14+9&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>根据安装的 Java 版本，您可能会看到不同的值。</p><p>现在，是时候显示环境变量了。 Spring 会选取属性名称以 <code>info</code> 开头的任何环境变量。要查看实际效果，让我们在 <code>application.properties</code> 文件中添加以下属性：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-properties data-lang=properties><span class=line><span class=cl><span class=na>management.info.env.enabled</span><span class=o>=</span><span class=s>true</span>
</span></span><span class=line><span class=cl><span class=na>info.app.website</span><span class=o>=</span><span class=s>reflectoring.io</span>
</span></span></code></pre></div><p>重新启动应用程序后，我们将开始看到添加到执行器 <code>info</code> 端点的以下信息：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;app&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;website&#34;</span><span class=p>:</span> <span class=s2>&#34;reflectoring.io&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>请随意添加您想要的任意数量的信息变量:)</p><p>在以下部分中，我们将了解如何添加 Git 和应用程序构建特定信息。</p><h2 id=添加构建信息>添加构建信息<a hidden class=anchor aria-hidden=true href=#添加构建信息>#</a></h2><p>添加有用的<a href=https://docs.spring.io/spring-boot/docs/current/reference/html/howto.html#howto.build.generate-info>构建信息</a>有助于快速识别构建工件名称、版本、创建时间等。它可以方便地检查团队是否部署了应用程序的相关版本。 Spring Boot 允许使用 Maven 或 Gradle 构建插件轻松添加此内容。</p><h3 id=使用-maven-插件>使用 Maven 插件<a hidden class=anchor aria-hidden=true href=#使用-maven-插件>#</a></h3><p>Spring Boot Maven 插件捆绑了许多有用的功能，例如创建可执行 jar 或 war 存档、运行应用程序等。它还提供了一种添加应用程序构建信息的方法。</p><p>如果存在有效的 <code>META-INF/build-info.properties</code> 文件，Spring Boot Actuator 将显示构建详细信息。 Spring Boot Maven 插件的 <code>build-info</code> 目标是创建此文件。</p><p>如果您使用 Spring Initializr 引导项目，则默认情况下该插件将出现在 <code>pom.xml</code> 中。我们只需添加 <code>build-info</code> 执行目标，如下所示：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;groupId&gt;</span>org.springframework.boot<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;version&gt;</span>2.6.4<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;executions&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;execution&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;goals&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;goal&gt;</span>build-info<span class=nt>&lt;/goal&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/goals&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/execution&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/executions&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/plugin&gt;</span>
</span></span></code></pre></div><p>如果我们现在运行命令 <code>./mvnw spring-boot:run</code> （对于 Linux/macOS）或 <code>mvnw.bat spring-boot:run</code> （对于 Windows），所需的文件将在 <code>target/classes/META-INF/build-info.properties</code> 中创建。</p><p><strong>文件内容将与此类似：</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-properties data-lang=properties><span class=line><span class=cl><span class=na>build.artifact</span><span class=o>=</span><span class=s>spring-boot-build-info</span>
</span></span><span class=line><span class=cl><span class=na>build.group</span><span class=o>=</span><span class=s>io.reflectoring</span>
</span></span><span class=line><span class=cl><span class=na>build.name</span><span class=o>=</span><span class=s>spring-boot-build-info</span>
</span></span><span class=line><span class=cl><span class=na>build.time</span><span class=o>=</span><span class=s>2022-03-06T05\:53\:45.236Z</span>
</span></span><span class=line><span class=cl><span class=na>build.version</span><span class=o>=</span><span class=s>0.0.1-SNAPSHOT</span>
</span></span></code></pre></div><p>我们还可以使用 <code>additionalProperties</code> 属性将自定义属性添加到此列表：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;execution&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;goals&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;goal&gt;</span>build-info<span class=nt>&lt;/goal&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/goals&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;additionalProperties&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;custom.key1&gt;</span>value1<span class=nt>&lt;/custom.key1&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;custom.key2&gt;</span>value2<span class=nt>&lt;/custom.key2&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/additionalProperties&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/execution&gt;</span>
</span></span></code></pre></div><p>如果我们现在运行应用程序并在浏览器中打开 <code>http://localhost:8080/actuator/info</code> 端点，我们将看到类似于以下内容的响应：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;build&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;custom&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;key2&#34;</span><span class=p>:</span> <span class=s2>&#34;value2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;key1&#34;</span><span class=p>:</span> <span class=s2>&#34;value1&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;0.0.1-SNAPSHOT&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;artifact&#34;</span><span class=p>:</span> <span class=s2>&#34;spring-boot-build-info&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;spring-boot-build-info&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;time&#34;</span><span class=p>:</span> <span class=s2>&#34;2022-03-06T06:34:30.306Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;group&#34;</span><span class=p>:</span> <span class=s2>&#34;io.reflectoring&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>如果您想排除任何可以使用 <code>excludeInfoProperties</code> 配置的属性。让我们看看如何排除 <code>artifact</code> 属性：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;excludeInfoProperties&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;infoProperty&gt;</span>artifact<span class=nt>&lt;/infoProperty&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/excludeInfoProperties&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/configuration&gt;</span>
</span></span></code></pre></div><p>请参阅 Spring Boot <a href=https://docs.spring.io/spring-boot/docs/current/maven-plugin/reference/htmlsingle/#goals-build-info>官方文档</a>了解更多信息。</p><p>现在，是时候看看我们如何使用 Spring Boot Gradle 插件实现相同的输出了。</p><h3 id=使用-gradle-插件>使用 Gradle 插件<a hidden class=anchor aria-hidden=true href=#使用-gradle-插件>#</a></h3><p>添加构建信息的最简单方法是使用插件 DSL。在 <code>build.gradle</code> 文件中，我们需要添加以下块：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gradle data-lang=gradle><span class=line><span class=cl><span class=n>springBoot</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>buildInfo</span><span class=o>()</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>如果我们现在同步 Gradle 项目，我们可以看到一个新任务 <code>bootBuildInfo</code> 可供使用。运行该任务将生成带有构建信息的类似 <code>build/resources/main/META-INF/build-info.properties</code> 文件（源自项目）。使用 DSL，我们可以自定义现有值或添加新属性：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gradle data-lang=gradle><span class=line><span class=cl><span class=n>springBoot</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>buildInfo</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>properties</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;Sample App&#39;</span>
</span></span><span class=line><span class=cl>      <span class=n>additional</span> <span class=o>=</span> <span class=o>[</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;customKey&#39;</span><span class=o>:</span> <span class=s1>&#39;customValue&#39;</span>
</span></span><span class=line><span class=cl>      <span class=o>]</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>是时候使用 <code>./gradlew bootRun</code> （对于 macOS/Linux）或 <code>gradlew.bat bootRun</code> （对于 Windows）命令运行应用程序了。应用程序运行后，我们可以在浏览器中打开 <code>http://localhost:8080/actuator/info</code> 端点并找到响应：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;build&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;customKey&#34;</span><span class=p>:</span> <span class=s2>&#34;customValue&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;version&#34;</span><span class=p>:</span> <span class=s2>&#34;0.0.1-SNAPSHOT&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;artifact&#34;</span><span class=p>:</span> <span class=s2>&#34;spring-boot-build-info&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;Sample App&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;time&#34;</span><span class=p>:</span> <span class=s2>&#34;2022-03-06T09:11:53.380Z&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;group&#34;</span><span class=p>:</span> <span class=s2>&#34;io.reflectoring&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>我们可以通过将其值设置为 <code>null</code> 来从生成的构建信息中排除任何默认属性。例如：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gradle data-lang=gradle><span class=line><span class=cl><span class=n>properties</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>group</span> <span class=o>=</span> <span class=kc>null</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>想了解更多关于该插件的信息，可以参考 Spring Boot <a href=https://docs.spring.io/spring-boot/docs/current/gradle-plugin/reference/htmlsingle/#integrating-with-actuator>官方文档</a>。</p><h2 id=添加-git-信息>添加 Git 信息<a hidden class=anchor aria-hidden=true href=#添加-git-信息>#</a></h2><p><a href=https://docs.spring.io/spring-boot/docs/current/reference/html/howto.html#howto.build.generate-git-info>Git 信息</a>可以方便地快速识别生产中是否存在相关代码或者分布式部署是否与预期同步。 Spring Boot 可以使用 Maven 和 Gradle 插件轻松地将 Git 属性包含在 Actuator 端点中。</p><p>使用这个插件我们可以生成一个 <code>git.properties</code> 文件。此文件的存在将自动配置 <a href=https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/info/GitProperties.html>GitProperties</a> bean，供 <a href=https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/actuate/info/GitInfoContributor.html>GitInfoContributor</a> bean 使用来整理相关信息。</p><p><strong>默认情况下，将公开以下信息：</strong></p><ul><li><code>git.branch</code></li><li><code>git.commit.id</code></li><li><code>git.commit.time</code></li></ul><p>以下管理应用程序属性控制 Git 相关信息：</p><table><thead><tr><th>应用属性</th><th>目的</th></tr></thead><tbody><tr><td><code>management.info.git.enabled=false</code></td><td>完全从 <code>info</code> 端点禁用 Git 信息</td></tr><tr><td><code>management.info.git.mode=full</code></td><td>显示 <code>git.properties</code> 文件中的所有属性</td></tr></tbody></table><h3 id=使用-maven-插件-1>使用 Maven 插件<a hidden class=anchor aria-hidden=true href=#使用-maven-插件-1>#</a></h3><p><a href=https://github.com/git-commit-id/git-commit-id-maven-plugin>Maven Git Commit ID 插件</a>通过 <code>spring-boot-starter-parent</code> pom.xml 进行管理。要使用它，我们必须编辑 <code>pom.xml</code> 如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;groupId&gt;</span>pl.project13.maven<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;artifactId&gt;</span>git-commit-id-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/plugin&gt;</span>
</span></span></code></pre></div><p>如果我们运行该项目并在浏览器中打开 <code>/actuator/info</code> 端点，它将返回Git相关信息：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;git&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;branch&#34;</span><span class=p>:</span> <span class=s2>&#34;main&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;commit&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;5404bdf&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;time&#34;</span><span class=p>:</span> <span class=s2>&#34;2022-03-06T10:34:16Z&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>我们还可以检查 <code>target/classes/git.properties</code> 下生成的文件。这对我来说是这样的：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Generated by Git-Commit-Id-Plugin
</span></span><span class=line><span class=cl>git.branch=main
</span></span><span class=line><span class=cl>git.build.host=mylaptop
</span></span><span class=line><span class=cl>git.build.time=2022-03-06T23\:22\:16+0530
</span></span><span class=line><span class=cl>git.build.user.email=user@email.com
</span></span><span class=line><span class=cl>git.build.user.name=user
</span></span><span class=line><span class=cl>git.build.version=0.0.1-SNAPSHOT
</span></span><span class=line><span class=cl>git.closest.tag.commit.count=
</span></span><span class=line><span class=cl>git.closest.tag.name=
</span></span><span class=line><span class=cl>git.commit.author.time=2022-03-06T22\:46\:56+0530
</span></span><span class=line><span class=cl>git.commit.committer.time=2022-03-06T22\:46\:56+0530
</span></span><span class=line><span class=cl>git.commit.id=e9fa20d4914367c1632e3a0eb8ca4d2f32b31a89
</span></span><span class=line><span class=cl>git.commit.id.abbrev=e9fa20d
</span></span><span class=line><span class=cl>git.commit.id.describe=e9fa20d-dirty
</span></span><span class=line><span class=cl>git.commit.id.describe-short=e9fa20d-dirty
</span></span><span class=line><span class=cl>git.commit.message.full=Update config
</span></span><span class=line><span class=cl>git.commit.message.short=Update config
</span></span><span class=line><span class=cl>git.commit.time=2022-03-06T22\:46\:56+0530
</span></span><span class=line><span class=cl>git.commit.user.email=saikat@email.com
</span></span><span class=line><span class=cl>git.commit.user.name=Saikat
</span></span><span class=line><span class=cl>git.dirty=true
</span></span><span class=line><span class=cl>git.local.branch.ahead=NO_REMOTE
</span></span><span class=line><span class=cl>git.local.branch.behind=NO_REMOTE
</span></span><span class=line><span class=cl>git.remote.origin.url=Unknown
</span></span><span class=line><span class=cl>git.tags=
</span></span><span class=line><span class=cl>git.total.commit.count=2
</span></span></code></pre></div><p>这个插件带有很多<a href=https://github.com/git-commit-id/git-commit-id-maven-plugin/blob/master/docs/using-the-plugin.md>配置</a>选项。例如，要包含/排除特定属性，我们可以添加 <code>configuration</code> 部分，如下所示：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;excludeProperties&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;excludeProperty&gt;</span>time<span class=nt>&lt;/excludeProperty&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/excludeProperties&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;includeOnlyProperties&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;property&gt;</span>git.commit.id<span class=nt>&lt;/property&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/includeOnlyProperties&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/configuration&gt;</span>
</span></span></code></pre></div><p>它将生成如下输出：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;git&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;commit&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;5404bdf&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><blockquote><p>译者备注：</p><p>使用 4.9.10 版本时，如果想指定输出内容，需要这样设置：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;groupId&gt;</span>pl.project13.maven<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;artifactId&gt;</span>git-commit-id-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;version&gt;</span>4.9.10<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;executions&gt;</span>
</span></span><span class=line><span class=cl>       <span class=nt>&lt;execution&gt;</span>
</span></span><span class=line><span class=cl>           <span class=nt>&lt;goals&gt;</span>
</span></span><span class=line><span class=cl>               <span class=nt>&lt;goal&gt;</span>revision<span class=nt>&lt;/goal&gt;</span>
</span></span><span class=line><span class=cl>           <span class=nt>&lt;/goals&gt;</span>
</span></span><span class=line><span class=cl>       <span class=nt>&lt;/execution&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;/executions&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>       <span class=nt>&lt;generateGitPropertiesFile&gt;</span>true<span class=nt>&lt;/generateGitPropertiesFile&gt;</span>
</span></span><span class=line><span class=cl>       <span class=nt>&lt;dateFormat&gt;</span>yyyy-MM-dd HH:mm:ss<span class=nt>&lt;/dateFormat&gt;</span>
</span></span><span class=line><span class=cl>       <span class=nt>&lt;dateFormatTimeZone&gt;</span>GMT+8<span class=nt>&lt;/dateFormatTimeZone&gt;</span>           <span class=nt>&lt;includeOnlyProperties&gt;</span>git.branch,git.build.time,git.build.version,git.commit.id,git.commit.time,git.commit.message.full<span class=nt>&lt;/includeOnlyProperties&gt;</span>
</span></span><span class=line><span class=cl>   <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/plugin&gt;</span>
</span></span></code></pre></div></blockquote><p>现在让我们看看 Gradle 用户可以使用哪些选项。</p><h3 id=使用-gradle-插件-1>使用 Gradle 插件<a hidden class=anchor aria-hidden=true href=#使用-gradle-插件-1>#</a></h3><p>在 <code>build.gradle</code> 中，我们将添加 <code>gradle-git-properties</code> 插件：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gradle data-lang=gradle><span class=line><span class=cl><span class=n>plugins</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>id</span> <span class=s1>&#39;com.gorylenko.gradle-git-properties&#39;</span> <span class=n>version</span> <span class=s1>&#39;2.4.0&#39;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>现在让我们构建 Gradle 项目。我们可以看到 <code>build/resources/main/git.properties</code> 文件已创建。并且，执行器 <code>info</code> 端点将显示相同的数据：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;git&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;branch&#34;</span><span class=p>:</span> <span class=s2>&#34;main&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;commit&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;5404bdf&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;time&#34;</span><span class=p>:</span> <span class=s2>&#34;2022-03-06T10:34:16Z&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>该插件也提供了多种使用属性 <code>gitProperties</code> 配置输出的方法。例如，我们通过添加以下内容来限制要出现的键：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gradle data-lang=gradle><span class=line><span class=cl><span class=n>gitProperties</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=n>keys</span> <span class=o>=</span> <span class=o>[</span><span class=s1>&#39;git.commit.id&#39;</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>重新运行应用程序现在将显示有限的 Git 信息：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;git&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;commit&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;5404bdf&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=结论>结论<a hidden class=anchor aria-hidden=true href=#结论>#</a></h2><p>在本文中，我们学习了如何使用 Spring Actuator 来公开有关我们应用程序的相关信息。我们了解了如何将有关构建、环境、Git 和 Java 环境的信息添加到 Actuator <code>/info</code> 端点。我们还研究了如何通过 Maven/Gradle 构建插件配置和控制所有这些信息。</p><p>您可以使用 GitHub 上的<a href=https://github.com/thombergs/code-examples/tree/master/spring-boot/spring-boot-app-info>代码</a>来尝试一个完整的应用程序来说明这些想法。</p><p>原文链接：<a href=https://reflectoring.io/spring-boot-info-endpoint/>https://reflectoring.io/spring-boot-info-endpoint/</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.chensoul.com/tags/java/>java</a></li><li><a href=https://blog.chensoul.com/tags/spring/>spring</a></li><li><a href=https://blog.chensoul.com/tags/maven/>maven</a></li><li><a href=https://blog.chensoul.com/tags/gradle/>gradle</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://blog.chensoul.com/>ChenSoul</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script async src=https://umami.chensoul.com/script.js data-website-id=f110cfa0-b737-4690-a032-2b9073a57fc3></script>
<script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>