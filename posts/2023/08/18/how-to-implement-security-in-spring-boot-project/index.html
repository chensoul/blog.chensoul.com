<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[译]Spring Boot项目如何实现Security？ | ChenSoul</title><meta name=keywords content="java,spring,spring boot,spring security"><meta name=description content="如今，几乎每个客户都要求在实时应用程序中实现强大的安全功能。安全功能对于保持机密性、完整性和可用性的需求是非常有效的。现实世界中有很多类型的"><meta name=author content="chensoul"><link rel=canonical href=https://blog.chensoul.com/posts/2023/08/18/how-to-implement-security-in-spring-boot-project/><meta name=google-site-verification content="nBXwg45SBRjTX78SA-mH0asrAbsdu9c1nk0ObSry7aQ"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="8E787EFCDB0CE747FE1A4DA0ABEC66E4"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.chensoul.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.chensoul.com/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://blog.chensoul.com/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://blog.chensoul.com/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://blog.chensoul.com/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta name=baidu-site-verification content="codeva-FYpQY8JdLU"><meta property="og:title" content="[译]Spring Boot项目如何实现Security？"><meta property="og:description" content="如今，几乎每个客户都要求在实时应用程序中实现强大的安全功能。安全功能对于保持机密性、完整性和可用性的需求是非常有效的。现实世界中有很多类型的"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.chensoul.com/posts/2023/08/18/how-to-implement-security-in-spring-boot-project/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-18T10:00:00+08:00"><meta property="article:modified_time" content="2023-08-18T10:00:00+08:00"><meta property="og:site_name" content="ChenSoul"><meta name=twitter:card content="summary"><meta name=twitter:title content="[译]Spring Boot项目如何实现Security？"><meta name=twitter:description content="如今，几乎每个客户都要求在实时应用程序中实现强大的安全功能。安全功能对于保持机密性、完整性和可用性的需求是非常有效的。现实世界中有很多类型的"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.chensoul.com/posts/"},{"@type":"ListItem","position":2,"name":"[译]Spring Boot项目如何实现Security？","item":"https://blog.chensoul.com/posts/2023/08/18/how-to-implement-security-in-spring-boot-project/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[译]Spring Boot项目如何实现Security？","name":"[译]Spring Boot项目如何实现Security？","description":"如今，几乎每个客户都要求在实时应用程序中实现强大的安全功能。安全功能对于保持机密性、完整性和可用性的需求是非常有效的。现实世界中有很多类型的","keywords":["java","spring","spring boot","spring security"],"articleBody":" 如今，几乎每个客户都要求在实时应用程序中实现强大的安全功能。安全功能对于保持机密性、完整性和可用性的需求是非常有效的。现实世界中有很多类型的安全性，但我们作为开发人员将重点关注应用程序/软件安全性。\n此外，在应用程序安全方面，我们的工作基本上是确保两件事。首先，只有有效的用户才能访问该应用程序。其次，如果用户有效，他/她只能访问该应用程序中允许的数据/信息。我认为，没有什么可以解释它们，因为您必须已经了解这两个术语，即身份验证和授权。\n您可能已经猜到我们将在当前主题“如何在 Spring Boot 项目中实现安全性？”中讨论什么内容。\n在本文中，我们将从基本原理开始学习。接下来，我们将逐步结束它，直到我们有信心在 Spring Boot 应用程序中实现安全功能。因此，让我们开始逐步讨论“如何在Spring Boot项目中实现安全性？”。 Spring Boot 教程页面上有一系列有关 Spring Boot Security 的教程。\n我们在本文中介绍了两个版本的“如何在 Spring Boot 项目中实现安全性？”的示例：使用 WebSecurityConfigurerAdapter 和不使用 WebSecurityConfigurerAdapter。此外，还涵盖了使用 Spring Boot 3.0 及更高版本的“如何在 Spring Boot 项目中实现安全性？”的示例。\n您将从本文中学到什么？ 为什么我们需要在 Spring Boot 应用程序中实现安全性？\nSecurity 在 Spring Boot 应用程序内部如何工作？\njavax.servlet.Filter在Spring Boot应用程序中实现安全性方面的作用是什么？\nSpring Boot项目中使用了多少种授权类型？\nSpring Boot项目中有多少种实现安全性的方法？\n在 Spring Boot 项目中实现 WebSecurity的步骤是什么？\n另外，如何在Spring Boot项目中使用@EnableWebSecurity、@Configuration、@Bean？\n如何实现内存中身份验证安全示例\n如何实现JDBC认证安全示例\n如何在 Spring Boot 项目中使用 Thymeleaf ？\n如何测试启用安全的功能？\n相反，如何禁用应用程序的安全功能？\n最后但并非最不重要的一点是，您将学习“如何在 Spring Boot 项目中实现安全性？”使用 WebSecurityConfigurerAdapter 和不使用 WebSecurityConfigurerAdapter。\n为什么我们需要应用程序中的安全性？ 现在，随着恶意攻击将重点从操作系统和网络转移到应用程序/软件和移动设备/设备，一天的数据面临最大的风险。此外，从业务/客户的角度来看，应用程序安全在维护信任、建立品牌形象和降低风险方面发挥着重要作用。事实上，没有其中任何一项，都无法想象一家成功的企业。\n总之，无论您是为了内部使用、销售目的还是购买目的而创建应用程序，安全性都是每个应用程序最重要的功能。\n根据最新的 2020 年 Verizon 数据泄露调查报告，所有数据泄露中有 43% 是针对 Web 应用程序的攻击。这一数字比 2019 年增加了一倍。此外，86% 的违规行为都是出于经济动机。\nSpring Boot 应用程序内部安全性如何工作？ 从根本上来说，Spring Security 的工作原理是 JAAS（Java 身份验证和授权服务）。简而言之，它适用于 Filter (javax.servlet.Filter) 概念。我们都知道，如果我们想在 servlet 请求之前应用一些预处理逻辑，可以使用过滤器。同样的概念也被应用于在 Spring boot 项目中实现安全功能。\nDelegatingFilterProxy 是 Spring Security 模块提供的 org.springframework.web.filter 包下的预定义类，在这里充当过滤器。\n如下图所示，当用户向应用程序发送请求时，请求会先经过安全过滤器，然后再发送给 DispatcherServlet。如果用户验证此过滤器的安全性，则只有请求才会发送到 DispatcherServlet 来满足用户的目的。\nSpring Boot应用程序使用了多少种授权类型？ 有四种最常用的授权实现类型。他们是 ：\n1) permitAll 允许全部 PermitAll 表示无需任何授权即可访问当前页面。\n示例 URL：/login、/home、/contactUs、/aboutUs ..等。\n2) authenticated已认证 它表示需要登录（用户名/密码）并且不需要授权（基于角色的访问）。\n示例 URL：/updateUserDetails、/inbox、/settings 等。\n3) hasAuthority hasAuthority 表示用户应该具有身份验证和基于角色的授权访问权限。\n示例 URL+role：/approveRequest + MANAGER、/blockUser + ADMIN、/addUser + ADMIN …等。\n4) hasAnyAuthority 有任何权限 它表示用户应该具有身份验证和基于多个角色的授权访问。就像经理和人力资源这两个角色都可以访问特定页面。 示例 URLs+role: /approveRequest + (MANAGER \u0026 HR)\n在 Spring Boot Web 应用程序中实现安全性有哪些不同的方法？ 简而言之，在 Spring Boot Web 应用程序中实现安全性有三种最常见的方法。他们是\nIn-Memory Security 内存安全 在这种类型的实现中，我们将数据存储在 RAM（内存中）中，并在有请求时验证数据。我们在测试或开发环境中使用这种方法。在生产应用中不建议使用此方法。\n使用数据库(JDBC) 在这种类型的实现中，我们将数据存储在数据库中，并在请求到来时验证数据/登录。但它是基于程序员提供的 SQL 查询来工作的。\nUsing UserDetailsService 使用用户详细信息服务 我们将数据存储在数据库中，并在请求到来时验证数据。但 UserDetailsS​​ervice 是基于 ORM（Spring Data JPA）工作的。简而言之，UserDetailsS​​ervice是Spring Security模块提供的一个接口。在登录表单中输入用户名后，当我们单击登录按钮时，将调用该服务。随后，它根据提供的用户名找到用户。它包含一个方法 loadUserByUsername(String username) 返回 UserDetails 对象。此外，UserDetails 对象为我们提供了用户名。\n在 Spring Boot 应用程序中实现 Web 安全的步骤是什么？ 以下是步骤：\n编写一个类“SecurityConfig.java”，它扩展了预定义的抽象类 WebSecurityConfigurerAdapter.java\n在“SecurityConfig.java”之上相应地应用注释@Configuration和@EnableWebSecurity。不用说，注释@EnableWebSecurity是为了在Web应用程序中启用安全功能。\n覆盖下面两种方法同时实现身份验证和授权逻辑。\nconfigure(AuthenticationManagerBuilder auth) configure(HttpSecurity http) 此外，通过使用@Autowired（如DataSource、BCryptPasswordEncoder等）注入其他对象依赖项（如果有），并在需要的地方使用它们。\n同样重要的是，根据需要编写控制器类和视图页面。\n最后，如果您不实施内存中身份验证，请更新 application.properties 文件中的数据库属性。\n注意：从 Spring Security 5.7.0-M2 开始，WebSecurityConfigurerAdapter 已被弃用。为了了解实现自定义配置类的新方法，请访问有关不使用 WebSecurityConfigurerAdapter 的 Spring Security 的单独文章。\n如何实现内存中身份验证安全性的示例 例如，让我们考虑一个小型组织的应用程序，其中我们有三个角色：员工、经理和管理员。此外，我们将对某些特定页面进行基于角色的限制访问。一方面，某些页面可供多个角色访问，另一方面，某些页面没有限制（所有角色均可访问）。此外，我们将使用 thymeleaf 来创建页面。此外，我们将有一个控制器类来满足用户的请求。\nSoftware/Technologies Used 使用的软件/技术 STS (Spring Tool Suite) : Version-\u003e 4.7.1.RELEASE JDK14 (JDK8 or later versions are sufficient) 步骤#1：在STS(Spring Tool Suite)中创建一个Spring Boot Starter项目 创建入门项目时，选择“Spring Security”、“Thymeleaf”、“Spring Web”和“Spring Boot DevTools”作为入门项目依赖项。要了解“如何创建 Spring Boot Starter 项目？”，请访问内部链接。\n步骤#2：编写控制器类 请检查以下代码作为控制器类。\nHomeController.java\npackage com.dev.springboot.security.controller; import org.springframework.stereotype.Controller; import org.springframework.web.bind.annotation.GetMapping; @Controller public class HomeController { @GetMapping(\"/home\") public String getHomePage() { return \"homePage\"; } @GetMapping(\"/welcome\") public String getWelcomePage() { return \"welcomePage\"; } @GetMapping(\"/admin\") public String getAdminPage() { return \"adminPage\"; } @GetMapping(\"/emp\") public String getEmployeePage() { return \"empPage\"; } @GetMapping(\"/mgr\") public String getManagerPage() { return \"mgrPage\"; } @GetMapping(\"/common\") public String getCommonPage() { return \"commonPage\"; } @GetMapping(\"/accessDenied\") public String getAccessDeniedPage() { return \"accessDeniedPage\"; } } 步骤#3：编写 UI 页面 (Thymeleaf) 以下文件是 UI 页面。因此，仅将它们放在“src/main/resources/templates”文件夹中。\nhomepage.html\n\u003c!DOCTYPE html\u003e \u003chtml xmlns:th=\"http://www.thymeleaf.org\"\u003e \u003chead\u003e \u003cmeta charset=\"ISO-8859-1\"\u003e \u003ctitle\u003eInsert title here\u003c/title\u003e \u003c/head\u003e \u003cbody\u003e \u003ch3\u003e welcome to Home Page \u003c/h3\u003e This page is accessible to ALL. \u003c/body\u003e \u003c/html\u003e welcomePage.html\n\u003c!DOCTYPE html\u003e \u003chtml xmlns:th=\"http://www.thymeleaf.org\"\u003e \u003chead\u003e \u003cmeta charset=\"ISO-8859-1\"\u003e \u003ctitle\u003eInsert title here\u003c/title\u003e \u003c/head\u003e \u003cbody\u003e \u003ch3\u003e Welcome Page after successful Login\u003c/h3\u003e \u003ca th:href=\"@{/logout}\" \u003eLOGOUT\u003c/a\u003e \u003c/body\u003e \u003c/html\u003e adminPage.html\n\u003c!DOCTYPE html\u003e \u003chtml xmlns:th=\"http://www.thymeleaf.org\"\u003e \u003chead\u003e \u003cmeta charset=\"ISO-8859-1\"\u003e \u003ctitle\u003eInsert title here\u003c/title\u003e \u003c/head\u003e \u003cbody\u003e \u003ch3\u003e Admin Page \u003c/h3\u003e Only Admins are allowed to access this page.!!! \u003ca th:href=\"@{/logout}\" \u003eLOGOUT\u003c/a\u003e \u003c/body\u003e \u003c/html\u003e empPage.html\n\u003c!DOCTYPE html\u003e \u003chtml xmlns:th=\"http://www.thymeleaf.org\"\u003e \u003chead\u003e \u003cmeta charset=\"ISO-8859-1\"\u003e \u003ctitle\u003eInsert title here\u003c/title\u003e \u003c/head\u003e \u003cbody\u003e \u003ch3\u003e Employee Page \u003c/h3\u003e \u003ca th:href=\"@{/logout}\" \u003eLOGOUT\u003c/a\u003e \u003c/body\u003e \u003c/html\u003e mgrPage.html\n\u003c!DOCTYPE html\u003e \u003chtml xmlns:th=\"http://www.thymeleaf.org\"\u003e \u003chead\u003e \u003cmeta charset=\"ISO-8859-1\"\u003e \u003ctitle\u003eInsert title here\u003c/title\u003e \u003c/head\u003e \u003cbody\u003e \u003ch3\u003e Manager Page \u003c/h3\u003e \u003ca th:href=\"@{/logout}\" \u003eLOGOUT\u003c/a\u003e \u003c/body\u003e \u003c/html\u003e commonPage.html\n\u003c!DOCTYPE html\u003e \u003chtml xmlns:th=\"http://www.thymeleaf.org\"\u003e \u003chead\u003e \u003cmeta charset=\"ISO-8859-1\"\u003e \u003ctitle\u003eInsert title here\u003c/title\u003e \u003c/head\u003e \u003cbody\u003e \u003ch3\u003e COMMON Page \u003c/h3\u003e Both Manager \u0026 Employee are allowed to access this page. ! \u003ca th:href=\"@{/logout}\" \u003eLOGOUT\u003c/a\u003e \u003c/body\u003e \u003c/html\u003e accessDeniedPage.html\n\u003c!DOCTYPE html\u003e \u003chtml xmlns:th=\"http://www.thymeleaf.org\"\u003e \u003chead\u003e \u003cmeta charset=\"ISO-8859-1\"\u003e \u003ctitle\u003eInsert title here\u003c/title\u003e \u003c/head\u003e \u003cbody\u003e \u003ch3\u003eYou are not allowed to access this page. Please go to Welcome Page\u003c/h3\u003e \u003ca th:href=\"@{/welcome}\" \u003eWelcome\u003c/a\u003e \u003ca th:href=\"@{/logout}\" \u003eLOGOUT\u003c/a\u003e \u003c/body\u003e \u003c/html\u003e 步骤#4：编写SecurityConfig类 此类对于实现包含所有安全相关逻辑的安全功能而言是最重要的。如下面的代码示例所示，如果我们不想对密码进行编码，我们可以在密码值之前使用“{noop}”。\n步骤#4A：Spring Security 5.7.0以下版本的代码 SecurityConfig.java\npackage com.dev.springboot.security; import org.springframework.context.annotation.Configuration; import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity; import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter; import org.springframework.security.web.util.matcher.AntPathRequestMatcher; @Configuration @EnableWebSecurity public class SecurityConfig extends WebSecurityConfigurerAdapter { @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception { // {noop} =\u003e No operation for password encoder\t(no password encoding needed) auth.inMemoryAuthentication().withUser(\"devs\").password(\"{noop}devs\").authorities(\"ADMIN\"); auth.inMemoryAuthentication().withUser(\"ns\").password(\"{noop}ns\").authorities(\"EMPLOYEE\"); auth.inMemoryAuthentication().withUser(\"vs\").password(\"{noop}vs\").authorities(\"MANAGER\"); } @Override protected void configure(HttpSecurity http) throws Exception { //declares which Page(URL) will have What access type http.authorizeRequests() .antMatchers(\"/home\").permitAll() .antMatchers(\"/welcome\").authenticated() .antMatchers(\"/admin\").hasAuthority(\"ADMIN\") .antMatchers(\"/emp\").hasAuthority(\"EMPLOYEE\") .antMatchers(\"/mgr\").hasAuthority(\"MANAGER\") .antMatchers(\"/common\").hasAnyAuthority(\"EMPLOYEE\",\"MANAGER\") // Any other URLs which are not configured in above antMatchers // generally declared aunthenticated() in real time .anyRequest().authenticated() //Login Form Details .and() .formLogin() .defaultSuccessUrl(\"/welcome\", true) //Logout Form Details .and() .logout() .logoutRequestMatcher(new AntPathRequestMatcher(\"/logout\")) //Exception Details\t.and()\t.exceptionHandling() .accessDeniedPage(\"/accessDenied\") ; } } 步骤#4B：Spring Security 5.7以上版本和Spring Security 6.0以下版本的代码 由于根据 Spring 官网发布的公告，WebSecurityConfigurerAdapter 已从 Spring Security 5.7.0-M2 中弃用，因此，2022 年 2 月 21 日，我们将不使用 WebSecurityConfigurerAdapter 来编写 SecurityConfig 类，如下所示：\nSecurityConfig.java\npackage com.dev.springboot.security; import java.util.ArrayList; import java.util.List; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity; import org.springframework.security.core.GrantedAuthority; import org.springframework.security.core.authority.SimpleGrantedAuthority; import org.springframework.security.core.userdetails.User; import org.springframework.security.core.userdetails.UserDetails; import org.springframework.security.provisioning.InMemoryUserDetailsManager; import org.springframework.security.web.SecurityFilterChain; import org.springframework.security.web.util.matcher.AntPathRequestMatcher; @Configuration @EnableWebSecurity public class SecurityConfig { @Bean protected InMemoryUserDetailsManager configAuthentication() { List\u003cUserDetails\u003e users = new ArrayList\u003c\u003e(); List\u003cGrantedAuthority\u003e adminAuthority = new ArrayList\u003c\u003e(); adminAuthority.add(new SimpleGrantedAuthority(\"ADMIN\")); UserDetails admin= new User(\"devs\", \"{noop}devs\", adminAuthority); users.add(admin); List\u003cGrantedAuthority\u003e employeeAuthority = new ArrayList\u003c\u003e(); adminAuthority.add(new SimpleGrantedAuthority(\"EMPLOYEE\")); UserDetails employee= new User(\"ns\", \"{noop}ns\", employeeAuthority); users.add(employee); List\u003cGrantedAuthority\u003e managerAuthority = new ArrayList\u003c\u003e(); adminAuthority.add(new SimpleGrantedAuthority(\"MANAGER\")); UserDetails manager= new User(\"vs\", \"{noop}vs\", managerAuthority); users.add(manager); return new InMemoryUserDetailsManager(users); } @Bean protected SecurityFilterChain filterChain(HttpSecurity http) throws Exception { //declares which Page(URL) will have What access type http.authorizeRequests() .antMatchers(\"/home\").permitAll() .antMatchers(\"/welcome\").authenticated() .antMatchers(\"/admin\").hasAuthority(\"ADMIN\") .antMatchers(\"/emp\").hasAuthority(\"EMPLOYEE\") .antMatchers(\"/mgr\").hasAuthority(\"MANAGER\") .antMatchers(\"/common\").hasAnyAuthority(\"EMPLOYEE\",\"MANAGER\") // Any other URLs which are not configured in above antMatchers // generally declared aunthenticated() in real time .anyRequest().authenticated() //Login Form Details .and() .formLogin() .defaultSuccessUrl(\"/welcome\", true) //Logout Form Details .and() .logout() .logoutRequestMatcher(new AntPathRequestMatcher(\"/logout\")) //Exception Details\t.and()\t.exceptionHandling() .accessDeniedPage(\"/accessDenied\") ; return http.build(); } } 步骤#4C：Spring Security 6.0.0 及更高版本的代码（Spring Boot 3.0+） 从 Spring Security 6.0（2022 年 11 月发布）开始，WebSecurityConfigurerAdapter 已从 Spring Security API 中完全删除。它还影响了 2022 年 11 月新发布的 Spring Boot 3.0。因此，如果您使用 Spring Framework 6.0+ 或 Spring Boot 3.0+，无论哪种情况，SecurityConfig.java 的实现应如下所示。此外，您还可以检查Spring Framework 6.0中与Spring Security相关的更改。\nSecurityConfig.java\npackage com.dev.springboot.security; import java.util.ArrayList; import java.util.List; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity; import org.springframework.security.core.GrantedAuthority; import org.springframework.security.core.authority.SimpleGrantedAuthority; import org.springframework.security.core.userdetails.User; import org.springframework.security.core.userdetails.UserDetails; import org.springframework.security.provisioning.InMemoryUserDetailsManager; import org.springframework.security.web.SecurityFilterChain; import org.springframework.security.web.util.matcher.AntPathRequestMatcher; @Configuration @EnableWebSecurity public class SecurityConfig { @Bean protected InMemoryUserDetailsManager configAuthentication() { List\u003cUserDetails\u003e users = new ArrayList\u003c\u003e(); List\u003cGrantedAuthority\u003e adminAuthority = new ArrayList\u003c\u003e(); adminAuthority.add(new SimpleGrantedAuthority(\"ADMIN\")); UserDetails admin= new User(\"devs\", \"{noop}devs\", adminAuthority); users.add(admin); List\u003cGrantedAuthority\u003e employeeAuthority = new ArrayList\u003c\u003e(); adminAuthority.add(new SimpleGrantedAuthority(\"EMPLOYEE\")); UserDetails employee= new User(\"ns\", \"{noop}ns\", employeeAuthority); users.add(employee); List\u003cGrantedAuthority\u003e managerAuthority = new ArrayList\u003c\u003e(); adminAuthority.add(new SimpleGrantedAuthority(\"MANAGER\")); UserDetails manager= new User(\"vs\", \"{noop}vs\", managerAuthority); users.add(manager); return new InMemoryUserDetailsManager(users); } @Bean protected SecurityFilterChain filterChain(HttpSecurity http) throws Exception { //declares which Page(URL) will have What access type http.authorizeHttpRequests() .requestMatchers(\"/home\").permitAll() .requestMatchers(\"/welcome\").authenticated() .requestMatchers(\"/admin\").hasAuthority(\"ADMIN\") .requestMatchers(\"/emp\").hasAuthority(\"EMPLOYEE\") .requestMatchers(\"/mgr\").hasAuthority(\"MANAGER\") .requestMatchers(\"/common\").hasAnyAuthority(\"EMPLOYEE\",\"MANAGER\") // Any other URLs which are not configured in above antMatchers // generally declared aunthenticated() in real time .anyRequest().authenticated() //Login Form Details .and() .formLogin() .defaultSuccessUrl(\"/welcome\", true) //Logout Form Details .and() .logout() .logoutRequestMatcher(new AntPathRequestMatcher(\"/logout\")) //Exception Details\t.and()\t.exceptionHandling() .accessDeniedPage(\"/accessDenied\") ; return http.build(); } } 注意：在上面的代码中，观察Spring Security 6.0中的API变化：antMatchers()被requestMatchers()替换，authorizeRequests()被authorizeHttpRequests()替换。\n您的项目结构将如下图所示。\n如何实现 JDBC 身份验证安全性示例 在这种身份验证方法中，我们根据数据库中的现有值验证凭据和角色。此外，在此示例中，我们还将研究密码加密逻辑。首先，我们将在数据库中插入一些虚拟数据，然后相应地测试安全功能。归根结底，如果我们比较前面示例的功能，我们将把用户凭据和角色保存到数据库而不是 RAM 中。\n此外，在此示例中，我们将提供用于实现密码加密逻辑的附加代码。因此，上一个示例中的所有文件在此示例中也将有效。\n此外，我们将有一个配置类来创建 BCryptPasswordEncoder 对象来对密码进行编码，并在 application.properties 中创建数据库属性条目以连接数据库。不用说，SecurityConfig 类的实现这次会有所不同。\n使用的软件/技术 STS (Spring Tool Suite) : Version-\u003e 4.7.1.RELEASE MySQL Database : Version -\u003e8.0.19 MySQL Community Server JDK14 (JDK8 or later versions are sufficient) 步骤#1：在数据库中插入一些虚拟记录 请注意，此步骤仅用于测试目的。如果您最近已经使用用户凭据和角色映射创建了数据库，请忽略此步骤。在步骤#1A 中，我们将创建一些密码编码值，然后在步骤#1B 中将它们插入到数据库中。\n步骤#1A：使用 BCryptPasswordEncoder 创建编码密码值 我们将使用 BCryptPasswordEncoder 生成一些编码密码值，如下所示\nBCryptPasswordEncoderTest.java\npackage com.dev.springboot.security.util; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; public class BCryptPasswordEncoderTest { public static void main(String[] args) { BCryptPasswordEncoder bpe = new BCryptPasswordEncoder(); String encodedPWD = bpe.encode(\"devs@A!5003\"); System.out.println(encodedPWD); } } 输出\n$2a$10$qnOB2PH1CqRvw8f5epvHzOlrounRkVGi.Y5ho6ENdmj/C1DmPdAsy 步骤#1B：创建数据库并插入虚拟记录 执行MySQL DB命令如下：\nTo create the database as 'testbootsecurity' ♦ create database testbootsecurity; To take 'testbootsecurity' in use: ♦ use testbootsecurity; To create the user table: ♦ create table user (user_id int, user_name varchar(30), user_pwd varchar(100), user_role varchar(20), user_enabled int); To check the description of user table: ♦ desc user; INSERT INTO user values(501,'devs','$2a$10$qnOB2PH1CqRvw8f5epvHzOlrounRkVGi.Y5ho6ENdmj/C1DmPdAsy','ADMIN',1); INSERT INTO user values(502,'ns','$2a$10$mmUMC5ZwoVnEQYV7/R6m.uWWtj7EiIo3lKasBObkOCc12huVUWpMC','EMPLOYEE',1); INSERT INTO user values(503,'vs','$2a$10$kqEC/fhQ7SNDhnncOQ9pb.yXXxJ/c7a1SQx2QPNZ.47fUmvF3Wb.i','MANAGER',1); ♦ select * from user; (To check if values are inserted into DB) 此外，在实现 SecurityConfig.java 类的 configure(AuthenticationManagerBuilder auth) 方法时，我们将需要以下两个查询。\nQuery#1 : Retrieve username,password,enabled using username ; ♦ select user_name,user_pwd,user_enabled from user where user_name=?; Query#2 : Retrieve username,role using username; ♦ select user_name,user_role from user where user_name=?; 步骤#2：在STS(Spring Tool Suite)中创建一个Spring Boot Starter项目 创建入门项目时，选择“Spring Security”、“Thymeleaf”、“Spring Web”、“JDBC API”、“MySQL Driver”和“Spring Boot DevTools”作为入门项目依赖项。\n步骤#3：从上一个示例复制控制器类和 UI 页面 复制 HomeController.java 以及前面示例中的所有 thymeleaf 页面。\n步骤#4：创建 AppConfig.java 以创建 BCryptPasswordEncoder 对象 如下创建AppConfig.java。在实现 SecurityConfig.java 类时，我们将需要 BCryptPasswordEncoder 对象。\nAppConfig.java\npackage com.dev.springboot.security.jdbc.config; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; @Configuration public class AppConfig { @Bean public BCryptPasswordEncoder encode() { return new BCryptPasswordEncoder(); } } 步骤#5：更新 application.properties 文件中的数据库属性 更新 application.properties 以连接到 MySQL DB，如下所示。请注意，我们可以省略 driver-class-name，因为 Spring Boot 会自动从数据库 URL 中找到它。\n#application.properties ------------------------------------------------------------------- spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver spring.datasource.url=jdbc:mysql://localhost:3306/testBootSecurity spring.datasource.username=root spring.datasource.password=devs 步骤#6：更新SecurityConfig.java 从前面的示例中复制 SecurityConfig.java 并更新 configure( AuthenticationManagerBuilder auth) 方法，如下所示。\n步骤#6A：Spring Security 5.7.0以下版本的代码 SecurityConfig.java\npackage com.dev.springboot.security.jdbc.config; import javax.sql.DataSource; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.context.annotation.Configuration; import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity; import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; import org.springframework.security.web.util.matcher.AntPathRequestMatcher; @Configuration @EnableWebSecurity public class SecurityConfig extends WebSecurityConfigurerAdapter { @Autowired private DataSource dataSource; @Autowired private BCryptPasswordEncoder passwordEncoder; @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception { auth.jdbcAuthentication() .dataSource(dataSource) //creates database connection .usersByUsernameQuery(\"select user_name,user_pwd,user_enabled from user where user_name=?\") .authoritiesByUsernameQuery(\"select user_name,user_role from user where user_name=?\") .passwordEncoder(passwordEncoder); } @Override public void configure(HttpSecurity http) throws Exception { http.authorizeRequests() .antMatchers(\"/home\").permitAll() .antMatchers(\"/welcome\").authenticated() .antMatchers(\"/admin\").hasAuthority(\"ADMIN\") .antMatchers(\"/emp\").hasAuthority(\"EMPLOYEE\") .antMatchers(\"/mgr\").hasAuthority(\"MANAGER\") .anyRequest().authenticated() .and() .formLogin() .defaultSuccessUrl(\"/welcome\",true) .and() .logout() .logoutRequestMatcher(new AntPathRequestMatcher(\"/logout\")) .and() .exceptionHandling() .accessDeniedPage(\"/accessDenied\") ; } } 步骤#6B：Spring Security 5.7.0以上版本和Spring Security 6.0.0以下版本的代码 由于根据 Spring 官网发布的公告，WebSecurityConfigurerAdapter 已从 Spring Security 5.7.0-M2 中弃用，因此，2022 年 2 月 21 日，我们将不使用 WebSecurityConfigurerAdapter 来编写 SecurityConfig 类，如下所示：\nSecurityConfig.java\npackage com.dev.springboot.security.jdbc.config; import javax.sql.DataSource; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity; import org.springframework.security.core.userdetails.User; import org.springframework.security.core.userdetails.UserDetails; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; import org.springframework.security.crypto.factory.PasswordEncoderFactories; import org.springframework.security.provisioning.JdbcUserDetailsManager; import org.springframework.security.provisioning.UserDetailsManager; import org.springframework.security.web.SecurityFilterChain; import org.springframework.security.web.util.matcher.AntPathRequestMatcher; @Configuration @EnableWebSecurity public class SecurityConfig { @Autowired private DataSource dataSource; @Autowired private BCryptPasswordEncoder passwordEncoder; @Bean public UserDetailsManager authenticateUsers() { UserDetails user = User.withUsername(\"devs\"). password(PasswordEncoderFactories.createDelegatingPasswordEncoder().encode(\"password\")).build(); JdbcUserDetailsManager users = new JdbcUserDetailsManager(dataSource); users.setAuthoritiesByUsernameQuery(\"select user_name,user_pwd,user_enabled from user where user_name=?\"); users.setUsersByUsernameQuery(\"select user_name,user_role from user where user_name=?\"); users.createUser(user); return users; } @Bean protected SecurityFilterChain filterChain(HttpSecurity http) throws Exception { http.authorizeRequests() .antMatchers(\"/home\").permitAll() .antMatchers(\"/welcome\").authenticated() .antMatchers(\"/admin\").hasAuthority(\"ADMIN\") .antMatchers(\"/emp\").hasAuthority(\"EMPLOYEE\") .antMatchers(\"/mgr\").hasAuthority(\"MANAGER\") .anyRequest().authenticated() .and() .formLogin() .defaultSuccessUrl(\"/welcome\",true) .and() .logout() .logoutRequestMatcher(new AntPathRequestMatcher(\"/logout\")) .and() .exceptionHandling() .accessDeniedPage(\"/accessDenied\") ; return http.build(); } } 步骤#6C：Spring Security 6.0.0 及更高版本的代码（Spring Boot 3.0+） 从 Spring Security 6.0（2022 年 11 月发布）开始，WebSecurityConfigurerAdapter 已从 Spring Security API 中完全删除。它还影响了 2022 年 11 月新发布的 Spring Boot 3.0。因此，如果您使用 Spring Framework 6.0+ 或 Spring Boot 3.0+，无论哪种情况，SecurityConfig.java 的实现应如下所示。此外，您还可以检查Spring Framework 6.0中与Spring Security相关的更改。\nSecurityConfig.java\npackage com.dev.springboot.security.jdbc.config; import javax.sql.DataSource; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity; import org.springframework.security.core.userdetails.User; import org.springframework.security.core.userdetails.UserDetails; import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder; import org.springframework.security.crypto.factory.PasswordEncoderFactories; import org.springframework.security.provisioning.JdbcUserDetailsManager; import org.springframework.security.provisioning.UserDetailsManager; import org.springframework.security.web.SecurityFilterChain; import org.springframework.security.web.util.matcher.AntPathRequestMatcher; @Configuration @EnableWebSecurity public class SecurityConfig { @Autowired private DataSource dataSource; @Autowired private BCryptPasswordEncoder passwordEncoder; @Bean public UserDetailsManager authenticateUsers() { UserDetails user = User.withUsername(\"devs\"). password(PasswordEncoderFactories.createDelegatingPasswordEncoder().encode(\"password\")).build(); JdbcUserDetailsManager users = new JdbcUserDetailsManager(dataSource); users.setAuthoritiesByUsernameQuery(\"select user_name,user_pwd,user_enabled from user where user_name=?\"); users.setUsersByUsernameQuery(\"select user_name,user_role from user where user_name=?\"); users.createUser(user); return users; } @Bean protected SecurityFilterChain filterChain(HttpSecurity http) throws Exception { http.authorizeHttpRequests() .requestMatchers(\"/home\").permitAll() .requestMatchers(\"/welcome\").authenticated() .requestMatchers(\"/admin\").hasAuthority(\"ADMIN\") .requestMatchers(\"/emp\").hasAuthority(\"EMPLOYEE\") .requestMatchers(\"/mgr\").hasAuthority(\"MANAGER\") .anyRequest().authenticated() .and() .formLogin() .defaultSuccessUrl(\"/welcome\",true) .and() .logout() .logoutRequestMatcher(new AntPathRequestMatcher(\"/logout\")) .and() .exceptionHandling() .accessDeniedPage(\"/accessDenied\") ; return http.build(); } } 注意：在上面的代码中，观察Spring Security 6.0中的API变化：antMatchers()被requestMatchers()替换，authorizeRequests()被authorizeHttpRequests()替换。\n如何测试启用安全的应用程序？ 同时完成大量理论和编码步骤之后，是时候测试“如何在 Spring Boot 项目中实现安全性？”了。请按照以下步骤操作。\n启动应用程序，然后右键单击该项目，然后选择“Run As”»“Spring Boot App”。\n输入首页网址http://localhost:8080/home，检查是否存在每个人都可以访问，甚至无需登录应用程序。\n输入管理页面URL http://localhost:8080/admin，然后它应该被重定向到内置登录页面（由Spring Security提供）\n使用提供的管理员凭据登录，您将被重定向到欢迎页面。\n输入URL http://localhost:8080/admin，然后您就可以看到管理页面了。\n当您使用管理员凭据登录时，您还可以通过点击其他页面 URL 来查看所有页面。\n随后对其他角色也重复上述步骤并检查用户是否可以根据授予的角色访问该页面。\nSpring Boot项目如何实现安全性？ ：Spring Boot 3.0 及以上 Spring Boot 3.0 在 Spring Security 模块中进行了重大 API 级别更改。因此，如果您使用 Spring Boot 3.0 或更高版本，则需要遵循以下指南以及使用 JDK 17。\n在SecurityConfig.java中： 使用authorizeHttpRequests()代替authorizeRequests()\n使用 requestMatchers() 代替 antMatchers()\n使用 RegexRequestMatchers() 代替 regexMatchers()\n在实体类中： 在 import 语句中，使用“jakarta”代替“javax”。例如：使用“jakarta.persistence.Entity;”代替“javax.persistence.Entity;”。 FAQ 如何禁用应用程序的安全功能？ 同样重要的是，有时我们需要禁用安全功能，特别是在开发和测试环境中，以避免再次输入凭据。为此，我们可以相应地在 pom.xml 文件中注释以下两个依赖项。\n概括 随后，通过“如何在 Spring Boot 项目中实现安全性？”的所有理论和示例部分，最后，我们能够在 Spring Boot 项目中实现 Web 安全性。当然，在本文中我们介绍了两种实现安全功能的方法。此外，我们可以在另一篇文章中了解UserDetailsS​​ervice（实现安全性的第三种方式）。此外，有关 Spring Boot Security 的完整教程请访问此处。后续如有更新，我们也会及时更新。也请随时在下面的评论部分提供您的意见。\n原文链接：https://javatechonline.com/how-to-implement-security-in-spring-boot-project/\n","wordCount":"7012","inLanguage":"en","datePublished":"2023-08-18T10:00:00+08:00","dateModified":"2023-08-18T10:00:00+08:00","author":{"@type":"Person","name":"chensoul"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.chensoul.com/posts/2023/08/18/how-to-implement-security-in-spring-boot-project/"},"publisher":{"@type":"Organization","name":"ChenSoul","logo":{"@type":"ImageObject","url":"https://blog.chensoul.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.chensoul.com/ accesskey=h title="ChenSoul (Alt + H)">ChenSoul</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.chensoul.com/categories/ideas title=周报><span>周报</span></a></li><li><a href=https://blog.chensoul.com/categories/notes title=编程><span>编程</span></a></li><li><a href=https://blog.chensoul.com/tags title=标签><span>标签</span></a></li><li><a href=https://blog.chensoul.com/about title=关于><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>[译]Spring Boot项目如何实现Security？</h1><div class=post-meta><span title='2023-08-18 10:00:00 +0800 +0800'>2023-08-18</span>&nbsp;·&nbsp;chensoul</div></header><div class=post-content><p><img loading=lazy src="https://javatechonline.com/ezoimgfmt/i0.wp.com/javatechonline.com/wp-content/uploads/2020/11/SpringSecurityBasics-1.jpg?resize=550%2C525&amp;is-pending-load=1#038;ssl=1&amp;ezimgfmt=rs:550x525/rscb4/ngcb3/notWebP" alt="How to implement Security in Spring Boot Project?"></p><p>如今，几乎每个客户都要求在实时应用程序中实现强大的安全功能。安全功能对于保持机密性、完整性和可用性的需求是非常有效的。现实世界中有很多类型的安全性，但我们作为开发人员将重点关注应用程序/软件安全性。</p><p>此外，在应用程序安全方面，我们的工作基本上是确保两件事。首先，只有有效的用户才能访问该应用程序。其次，如果用户有效，他/她只能访问该应用程序中允许的数据/信息。我认为，没有什么可以解释它们，因为您必须已经了解这两个术语，即身份验证和授权。</p><p>您可能已经猜到我们将在当前主题“如何在 Spring Boot 项目中实现安全性？”中讨论什么内容。</p><p>在本文中，我们将从基本原理开始学习。接下来，我们将逐步结束它，直到我们有信心在 Spring Boot 应用程序中实现安全功能。因此，让我们开始逐步讨论“如何在Spring Boot项目中实现安全性？”。 Spring Boot 教程页面上有一系列有关 <a href=https://javatechonline.com/spring-boot-tutorial/#Spring_Boot_Security>Spring Boot Security 的教程</a>。</p><p>我们在本文中介绍了两个版本的“如何在 Spring Boot 项目中实现安全性？”的示例：使用 WebSecurityConfigurerAdapter 和不使用 WebSecurityConfigurerAdapter。此外，还涵盖了使用 Spring Boot 3.0 及更高版本的“如何在 Spring Boot 项目中实现安全性？”的示例。</p><h2 id=您将从本文中学到什么>您将从本文中学到什么？<a hidden class=anchor aria-hidden=true href=#您将从本文中学到什么>#</a></h2><ol><li><p>为什么我们需要在 Spring Boot 应用程序中实现安全性？</p></li><li><p>Security 在 Spring Boot 应用程序内部如何工作？</p></li><li><p>javax.servlet.Filter在Spring Boot应用程序中实现安全性方面的作用是什么？</p></li><li><p>Spring Boot项目中使用了多少种授权类型？</p></li><li><p>Spring Boot项目中有多少种实现安全性的方法？</p></li><li><p>在 Spring Boot 项目中实现 WebSecurity的步骤是什么？</p></li><li><p>另外，如何在Spring Boot项目中使用@EnableWebSecurity、@Configuration、@Bean？</p></li><li><p>如何实现内存中身份验证安全示例</p></li><li><p>如何实现JDBC认证安全示例</p></li><li><p>如何在 Spring Boot 项目中使用 Thymeleaf ？</p></li><li><p>如何测试启用安全的功能？</p></li><li><p>相反，如何禁用应用程序的安全功能？</p></li><li><p>最后但并非最不重要的一点是，您将学习“如何在 Spring Boot 项目中实现安全性？”使用 WebSecurityConfigurerAdapter 和不使用 WebSecurityConfigurerAdapter。</p></li></ol><h2 id=为什么我们需要应用程序中的安全性>为什么我们需要应用程序中的安全性？<a hidden class=anchor aria-hidden=true href=#为什么我们需要应用程序中的安全性>#</a></h2><p>现在，随着恶意攻击将重点从操作系统和网络转移到应用程序/软件和移动设备/设备，一天的数据面临最大的风险。此外，从业务/客户的角度来看，应用程序安全在维护信任、建立品牌形象和降低风险方面发挥着重要作用。事实上，没有其中任何一项，都无法想象一家成功的企业。</p><p>总之，无论您是为了内部使用、销售目的还是购买目的而创建应用程序，安全性都是每个应用程序最重要的功能。</p><p>根据最新的 2020 年 Verizon 数据泄露调查报告，所有数据泄露中有 43% 是针对 Web 应用程序的攻击。这一数字比 2019 年增加了一倍。此外，86% 的违规行为都是出于经济动机。</p><h2 id=spring-boot-应用程序内部安全性如何工作>Spring Boot 应用程序内部安全性如何工作？<a hidden class=anchor aria-hidden=true href=#spring-boot-应用程序内部安全性如何工作>#</a></h2><p>从根本上来说，Spring Security 的工作原理是 JAAS（Java 身份验证和授权服务）。简而言之，它适用于 Filter (javax.servlet.Filter) 概念。我们都知道，如果我们想在 servlet 请求之前应用一些预处理逻辑，可以使用过滤器。同样的概念也被应用于在 Spring boot 项目中实现安全功能。</p><p>DelegatingFilterProxy 是 Spring Security 模块提供的 org.springframework.web.filter 包下的预定义类，在这里充当过滤器。</p><p>如下图所示，当用户向应用程序发送请求时，请求会先经过安全过滤器，然后再发送给 DispatcherServlet。如果用户验证此过滤器的安全性，则只有请求才会发送到 DispatcherServlet 来满足用户的目的。</p><p><img loading=lazy src=https://i0.wp.com/javatechonline.com/wp-content/uploads/2020/11/SpringSecurity1-1-1.jpg alt=img></p><h2 id=spring-boot应用程序使用了多少种授权类型>Spring Boot应用程序使用了多少种授权类型？<a hidden class=anchor aria-hidden=true href=#spring-boot应用程序使用了多少种授权类型>#</a></h2><p>有四种最常用的授权实现类型。他们是 ：</p><h3 id=1-permitall-允许全部>1) permitAll 允许全部<a hidden class=anchor aria-hidden=true href=#1-permitall-允许全部>#</a></h3><p>PermitAll 表示无需任何授权即可访问当前页面。</p><p>示例 URL：/login、/home、/contactUs、/aboutUs ..等。</p><h3 id=2-authenticated已认证>2) authenticated已认证<a hidden class=anchor aria-hidden=true href=#2-authenticated已认证>#</a></h3><p>它表示需要登录（用户名/密码）并且不需要授权（基于角色的访问）。</p><p>示例 URL：/updateUserDetails、/inbox、/settings 等。</p><h3 id=3-hasauthority>3) hasAuthority<a hidden class=anchor aria-hidden=true href=#3-hasauthority>#</a></h3><p>hasAuthority 表示用户应该具有身份验证和基于角色的授权访问权限。</p><p>示例 URL+role：/approveRequest + MANAGER、/blockUser + ADMIN、/addUser + ADMIN …等。</p><h3 id=4-hasanyauthority-有任何权限>4) hasAnyAuthority 有任何权限<a hidden class=anchor aria-hidden=true href=#4-hasanyauthority-有任何权限>#</a></h3><p>它表示用户应该具有身份验证和基于多个角色的授权访问。就像经理和人力资源这两个角色都可以访问特定页面。
示例 URLs+role: /approveRequest + (MANAGER & HR)</p><h2 id=在-spring-boot-web-应用程序中实现安全性有哪些不同的方法>在 Spring Boot Web 应用程序中实现安全性有哪些不同的方法？<a hidden class=anchor aria-hidden=true href=#在-spring-boot-web-应用程序中实现安全性有哪些不同的方法>#</a></h2><p>简而言之，在 Spring Boot Web 应用程序中实现安全性有三种最常见的方法。他们是</p><h3 id=in-memory-security-内存安全>In-Memory Security 内存安全<a hidden class=anchor aria-hidden=true href=#in-memory-security-内存安全>#</a></h3><p>在这种类型的实现中，我们将数据存储在 RAM（内存中）中，并在有请求时验证数据。我们在测试或开发环境中使用这种方法。在生产应用中不建议使用此方法。</p><h3 id=使用数据库jdbc>使用数据库(JDBC)<a hidden class=anchor aria-hidden=true href=#使用数据库jdbc>#</a></h3><p>在这种类型的实现中，我们将数据存储在数据库中，并在请求到来时验证数据/登录。但它是基于程序员提供的 SQL 查询来工作的。</p><h3 id=using-userdetailsservice-使用用户详细信息服务>Using UserDetailsService 使用用户详细信息服务<a hidden class=anchor aria-hidden=true href=#using-userdetailsservice-使用用户详细信息服务>#</a></h3><p>我们将数据存储在数据库中，并在请求到来时验证数据。但 UserDetailsS​​ervice 是基于 ORM（Spring Data JPA）工作的。简而言之，UserDetailsS​​ervice是Spring Security模块提供的一个接口。在登录表单中输入用户名后，当我们单击登录按钮时，将调用该服务。随后，它根据提供的用户名找到用户。它包含一个方法 loadUserByUsername(String username) 返回 UserDetails 对象。此外，UserDetails 对象为我们提供了用户名。</p><h2 id=在-spring-boot-应用程序中实现-web-安全的步骤是什么>在 Spring Boot 应用程序中实现 Web 安全的步骤是什么？<a hidden class=anchor aria-hidden=true href=#在-spring-boot-应用程序中实现-web-安全的步骤是什么>#</a></h2><p>以下是步骤：</p><p><img loading=lazy src="https://javatechonline.com/ezoimgfmt/i0.wp.com/javatechonline.com/wp-content/uploads/2020/11/SpringSecurity2-1-1.jpg?resize=640%2C303&amp;is-pending-load=1#038;ssl=1&amp;ezimgfmt=rs:640x303/rscb4/ng:webp/ngcb3" alt=SpringSecurity2></p><ol><li><p>编写一个类“SecurityConfig.java”，它扩展了预定义的抽象类 WebSecurityConfigurerAdapter.java</p></li><li><p>在“SecurityConfig.java”之上相应地应用注释@Configuration和@EnableWebSecurity。不用说，注释@EnableWebSecurity是为了在Web应用程序中启用安全功能。</p></li><li><p>覆盖下面两种方法同时实现身份验证和授权逻辑。</p></li></ol><ul><li>configure(AuthenticationManagerBuilder auth)</li><li>configure(HttpSecurity http)</li></ul><ol start=4><li><p>此外，通过使用@Autowired（如DataSource、BCryptPasswordEncoder等）注入其他对象依赖项（如果有），并在需要的地方使用它们。</p></li><li><p>同样重要的是，根据需要编写控制器类和视图页面。</p></li><li><p>最后，如果您不实施内存中身份验证，请更新 application.properties 文件中的数据库属性。</p></li></ol><p>注意：从 Spring Security 5.7.0-M2 开始，WebSecurityConfigurerAdapter 已被弃用。为了了解实现自定义配置类的新方法，请访问有关<a href=https://javatechonline.com/spring-security-without-websecurityconfigureradapter/>不使用 WebSecurityConfigurerAdapter 的 Spring Security</a> 的单独文章。</p><h2 id=如何实现内存中身份验证安全性的示例>如何实现内存中身份验证安全性的示例<a hidden class=anchor aria-hidden=true href=#如何实现内存中身份验证安全性的示例>#</a></h2><p>例如，让我们考虑一个小型组织的应用程序，其中我们有三个角色：员工、经理和管理员。此外，我们将对某些特定页面进行基于角色的限制访问。一方面，某些页面可供多个角色访问，另一方面，某些页面没有限制（所有角色均可访问）。此外，我们将使用 thymeleaf 来创建页面。此外，我们将有一个控制器类来满足用户的请求。</p><h3 id=softwaretechnologies-used-使用的软件技术>Software/Technologies Used 使用的软件/技术<a hidden class=anchor aria-hidden=true href=#softwaretechnologies-used-使用的软件技术>#</a></h3><ul><li>STS (Spring Tool Suite) : Version-> 4.7.1.RELEASE</li><li>JDK14 (JDK8 or later versions are sufficient)</li></ul><h3 id=步骤1在stsspring-tool-suite中创建一个spring-boot-starter项目>步骤#1：在STS(Spring Tool Suite)中创建一个Spring Boot Starter项目<a hidden class=anchor aria-hidden=true href=#步骤1在stsspring-tool-suite中创建一个spring-boot-starter项目>#</a></h3><p>创建入门项目时，选择“Spring Security”、“Thymeleaf”、“Spring Web”和“Spring Boot DevTools”作为入门项目依赖项。要了解“如何创建 Spring Boot Starter 项目？”，请访问<a href=https://javatechonline.com/saving-data-into-database-using-spring-boot-data-jpa-step-by-step-tutorial/#Step_1_Creating_Starter_Project_using_STS>内部链接</a>。</p><h3 id=步骤2编写控制器类>步骤#2：编写控制器类<a hidden class=anchor aria-hidden=true href=#步骤2编写控制器类>#</a></h3><p>请检查以下代码作为控制器类。</p><p>HomeController.java</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>com.dev.springboot.security.controller</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.stereotype.Controller</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.web.bind.annotation.GetMapping</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Controller</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>HomeController</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=nd>@GetMapping</span><span class=o>(</span><span class=s>&#34;/home&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>String</span> <span class=nf>getHomePage</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=s>&#34;homePage&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=nd>@GetMapping</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>String</span> <span class=nf>getWelcomePage</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=s>&#34;welcomePage&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=nd>@GetMapping</span><span class=o>(</span><span class=s>&#34;/admin&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>String</span> <span class=nf>getAdminPage</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=s>&#34;adminPage&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=nd>@GetMapping</span><span class=o>(</span><span class=s>&#34;/emp&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>String</span> <span class=nf>getEmployeePage</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=s>&#34;empPage&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=nd>@GetMapping</span><span class=o>(</span><span class=s>&#34;/mgr&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>String</span> <span class=nf>getManagerPage</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=s>&#34;mgrPage&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=nd>@GetMapping</span><span class=o>(</span><span class=s>&#34;/common&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>String</span> <span class=nf>getCommonPage</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=s>&#34;commonPage&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=nd>@GetMapping</span><span class=o>(</span><span class=s>&#34;/accessDenied&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>String</span> <span class=nf>getAccessDeniedPage</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=s>&#34;accessDeniedPage&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h3 id=步骤3编写-ui-页面-thymeleaf>步骤#3：编写 UI 页面 (Thymeleaf)<a hidden class=anchor aria-hidden=true href=#步骤3编写-ui-页面-thymeleaf>#</a></h3><p>以下文件是 UI 页面。因此，仅将它们放在“src/main/resources/templates”文件夹中。</p><p>homepage.html</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span> <span class=na>xmlns:th</span><span class=o>=</span><span class=s>&#34;http://www.thymeleaf.org&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;ISO-8859-1&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Insert title here<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span> welcome to Home Page <span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>This page is accessible to ALL.
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>welcomePage.html</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span> <span class=na>xmlns:th</span><span class=o>=</span><span class=s>&#34;http://www.thymeleaf.org&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;ISO-8859-1&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Insert title here<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span> Welcome Page after successful Login<span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>a</span> <span class=na>th:href</span><span class=o>=</span><span class=s>&#34;@{/logout}&#34;</span> <span class=p>&gt;</span>LOGOUT<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>adminPage.html</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span> <span class=na>xmlns:th</span><span class=o>=</span><span class=s>&#34;http://www.thymeleaf.org&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;ISO-8859-1&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Insert title here<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span> Admin Page <span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>Only Admins are allowed to access this page.!!!
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>a</span> <span class=na>th:href</span><span class=o>=</span><span class=s>&#34;@{/logout}&#34;</span> <span class=p>&gt;</span>LOGOUT<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>empPage.html</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span> <span class=na>xmlns:th</span><span class=o>=</span><span class=s>&#34;http://www.thymeleaf.org&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;ISO-8859-1&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Insert title here<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span> Employee Page <span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>a</span> <span class=na>th:href</span><span class=o>=</span><span class=s>&#34;@{/logout}&#34;</span> <span class=p>&gt;</span>LOGOUT<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>mgrPage.html</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span> <span class=na>xmlns:th</span><span class=o>=</span><span class=s>&#34;http://www.thymeleaf.org&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;ISO-8859-1&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Insert title here<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span> Manager Page <span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>a</span> <span class=na>th:href</span><span class=o>=</span><span class=s>&#34;@{/logout}&#34;</span> <span class=p>&gt;</span>LOGOUT<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>commonPage.html</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span> <span class=na>xmlns:th</span><span class=o>=</span><span class=s>&#34;http://www.thymeleaf.org&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;ISO-8859-1&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Insert title here<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span> COMMON Page <span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>Both Manager <span class=err>&amp;</span> Employee are allowed to access this page. !
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>a</span> <span class=na>th:href</span><span class=o>=</span><span class=s>&#34;@{/logout}&#34;</span> <span class=p>&gt;</span>LOGOUT<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>accessDeniedPage.html</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span> <span class=na>xmlns:th</span><span class=o>=</span><span class=s>&#34;http://www.thymeleaf.org&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;ISO-8859-1&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Insert title here<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span>You are not allowed to access this page. Please go to Welcome Page<span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>a</span> <span class=na>th:href</span><span class=o>=</span><span class=s>&#34;@{/welcome}&#34;</span> <span class=p>&gt;</span>Welcome<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>a</span> <span class=na>th:href</span><span class=o>=</span><span class=s>&#34;@{/logout}&#34;</span> <span class=p>&gt;</span>LOGOUT<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><h3 id=步骤4编写securityconfig类>步骤#4：编写SecurityConfig类<a hidden class=anchor aria-hidden=true href=#步骤4编写securityconfig类>#</a></h3><p>此类对于实现包含所有安全相关逻辑的安全功能而言是最重要的。如下面的代码示例所示，如果我们不想对密码进行编码，我们可以在密码值之前使用“{noop}”。</p><h4 id=步骤4aspring-security-570以下版本的代码>步骤#4A：Spring Security 5.7.0以下版本的代码<a hidden class=anchor aria-hidden=true href=#步骤4aspring-security-570以下版本的代码>#</a></h4><p>SecurityConfig.java</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>com.dev.springboot.security</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.context.annotation.Configuration</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.configuration.EnableWebSecurity</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.web.util.matcher.AntPathRequestMatcher</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Configuration</span>
</span></span><span class=line><span class=cl><span class=nd>@EnableWebSecurity</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SecurityConfig</span> <span class=kd>extends</span> <span class=n>WebSecurityConfigurerAdapter</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Override</span>
</span></span><span class=line><span class=cl>	<span class=kd>protected</span> <span class=kt>void</span> <span class=nf>configure</span><span class=o>(</span><span class=n>AuthenticationManagerBuilder</span> <span class=n>auth</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=c1>// {noop} =&gt; No operation for password encoder	(no password encoding needed)
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=n>auth</span><span class=o>.</span><span class=na>inMemoryAuthentication</span><span class=o>().</span><span class=na>withUser</span><span class=o>(</span><span class=s>&#34;devs&#34;</span><span class=o>).</span><span class=na>password</span><span class=o>(</span><span class=s>&#34;{noop}devs&#34;</span><span class=o>).</span><span class=na>authorities</span><span class=o>(</span><span class=s>&#34;ADMIN&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>auth</span><span class=o>.</span><span class=na>inMemoryAuthentication</span><span class=o>().</span><span class=na>withUser</span><span class=o>(</span><span class=s>&#34;ns&#34;</span><span class=o>).</span><span class=na>password</span><span class=o>(</span><span class=s>&#34;{noop}ns&#34;</span><span class=o>).</span><span class=na>authorities</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>auth</span><span class=o>.</span><span class=na>inMemoryAuthentication</span><span class=o>().</span><span class=na>withUser</span><span class=o>(</span><span class=s>&#34;vs&#34;</span><span class=o>).</span><span class=na>password</span><span class=o>(</span><span class=s>&#34;{noop}vs&#34;</span><span class=o>).</span><span class=na>authorities</span><span class=o>(</span><span class=s>&#34;MANAGER&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=nd>@Override</span>
</span></span><span class=line><span class=cl>	<span class=kd>protected</span> <span class=kt>void</span> <span class=nf>configure</span><span class=o>(</span><span class=n>HttpSecurity</span> <span class=n>http</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=c1>//declares which Page(URL) will have What access type
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=n>http</span><span class=o>.</span><span class=na>authorizeRequests</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/home&#34;</span><span class=o>).</span><span class=na>permitAll</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>).</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/admin&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;ADMIN&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/emp&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/mgr&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;MANAGER&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/common&#34;</span><span class=o>).</span><span class=na>hasAnyAuthority</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>,</span><span class=s>&#34;MANAGER&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=c1>// Any other URLs which are not configured in above antMatchers
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=c1>// generally declared aunthenticated() in real time
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=o>.</span><span class=na>anyRequest</span><span class=o>().</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=c1>//Login Form Details
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>formLogin</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>defaultSuccessUrl</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>,</span> <span class=kc>true</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=c1>//Logout Form Details
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>logout</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>logoutRequestMatcher</span><span class=o>(</span><span class=k>new</span> <span class=n>AntPathRequestMatcher</span><span class=o>(</span><span class=s>&#34;/logout&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>				
</span></span><span class=line><span class=cl>		<span class=c1>//Exception Details		
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>	
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>exceptionHandling</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>accessDeniedPage</span><span class=o>(</span><span class=s>&#34;/accessDenied&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h4 id=步骤4bspring-security-57以上版本和spring-security-60以下版本的代码>步骤#4B：Spring Security 5.7以上版本和Spring Security 6.0以下版本的代码<a hidden class=anchor aria-hidden=true href=#步骤4bspring-security-57以上版本和spring-security-60以下版本的代码>#</a></h4><p>由于<a href=https://javatechonline.com/spring-security-without-websecurityconfigureradapter/>根据 Spring 官网发布的公告</a>，WebSecurityConfigurerAdapter 已从 Spring Security 5.7.0-M2 中弃用，因此，2022 年 2 月 21 日，我们将不使用 WebSecurityConfigurerAdapter 来编写 SecurityConfig 类，如下所示：</p><p>SecurityConfig.java</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>com.dev.springboot.security</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.ArrayList</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.List</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.context.annotation.Bean</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.context.annotation.Configuration</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.configuration.EnableWebSecurity</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.core.GrantedAuthority</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.core.authority.SimpleGrantedAuthority</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.core.userdetails.User</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.core.userdetails.UserDetails</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.provisioning.InMemoryUserDetailsManager</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.web.SecurityFilterChain</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.web.util.matcher.AntPathRequestMatcher</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Configuration</span>
</span></span><span class=line><span class=cl><span class=nd>@EnableWebSecurity</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SecurityConfig</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Bean</span>
</span></span><span class=line><span class=cl>	<span class=kd>protected</span> <span class=n>InMemoryUserDetailsManager</span> <span class=nf>configAuthentication</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=n>List</span><span class=o>&lt;</span><span class=n>UserDetails</span><span class=o>&gt;</span> <span class=n>users</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>		<span class=n>List</span><span class=o>&lt;</span><span class=n>GrantedAuthority</span><span class=o>&gt;</span> <span class=n>adminAuthority</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>		<span class=n>adminAuthority</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>new</span> <span class=n>SimpleGrantedAuthority</span><span class=o>(</span><span class=s>&#34;ADMIN&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>		<span class=n>UserDetails</span> <span class=n>admin</span><span class=o>=</span> <span class=k>new</span> <span class=n>User</span><span class=o>(</span><span class=s>&#34;devs&#34;</span><span class=o>,</span> <span class=s>&#34;{noop}devs&#34;</span><span class=o>,</span> <span class=n>adminAuthority</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>users</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>admin</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=n>List</span><span class=o>&lt;</span><span class=n>GrantedAuthority</span><span class=o>&gt;</span> <span class=n>employeeAuthority</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>		<span class=n>adminAuthority</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>new</span> <span class=n>SimpleGrantedAuthority</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>		<span class=n>UserDetails</span> <span class=n>employee</span><span class=o>=</span> <span class=k>new</span> <span class=n>User</span><span class=o>(</span><span class=s>&#34;ns&#34;</span><span class=o>,</span> <span class=s>&#34;{noop}ns&#34;</span><span class=o>,</span> <span class=n>employeeAuthority</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>users</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>employee</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=n>List</span><span class=o>&lt;</span><span class=n>GrantedAuthority</span><span class=o>&gt;</span> <span class=n>managerAuthority</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>		<span class=n>adminAuthority</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>new</span> <span class=n>SimpleGrantedAuthority</span><span class=o>(</span><span class=s>&#34;MANAGER&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>		<span class=n>UserDetails</span> <span class=n>manager</span><span class=o>=</span> <span class=k>new</span> <span class=n>User</span><span class=o>(</span><span class=s>&#34;vs&#34;</span><span class=o>,</span> <span class=s>&#34;{noop}vs&#34;</span><span class=o>,</span> <span class=n>managerAuthority</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>users</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>manager</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=k>new</span> <span class=n>InMemoryUserDetailsManager</span><span class=o>(</span><span class=n>users</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=nd>@Bean</span>
</span></span><span class=line><span class=cl>	<span class=kd>protected</span> <span class=n>SecurityFilterChain</span> <span class=nf>filterChain</span><span class=o>(</span><span class=n>HttpSecurity</span> <span class=n>http</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=c1>//declares which Page(URL) will have What access type
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=n>http</span><span class=o>.</span><span class=na>authorizeRequests</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/home&#34;</span><span class=o>).</span><span class=na>permitAll</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>).</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/admin&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;ADMIN&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/emp&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/mgr&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;MANAGER&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/common&#34;</span><span class=o>).</span><span class=na>hasAnyAuthority</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>,</span><span class=s>&#34;MANAGER&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=c1>// Any other URLs which are not configured in above antMatchers
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=c1>// generally declared aunthenticated() in real time
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=o>.</span><span class=na>anyRequest</span><span class=o>().</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=c1>//Login Form Details
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>formLogin</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>defaultSuccessUrl</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>,</span> <span class=kc>true</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=c1>//Logout Form Details
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>logout</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>logoutRequestMatcher</span><span class=o>(</span><span class=k>new</span> <span class=n>AntPathRequestMatcher</span><span class=o>(</span><span class=s>&#34;/logout&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>				
</span></span><span class=line><span class=cl>		<span class=c1>//Exception Details		
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>	
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>exceptionHandling</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>accessDeniedPage</span><span class=o>(</span><span class=s>&#34;/accessDenied&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>;</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>http</span><span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h4 id=步骤4cspring-security-600-及更高版本的代码spring-boot-30>步骤#4C：Spring Security 6.0.0 及更高版本的代码（Spring Boot 3.0+）<a hidden class=anchor aria-hidden=true href=#步骤4cspring-security-600-及更高版本的代码spring-boot-30>#</a></h4><p>从 Spring Security 6.0（2022 年 11 月发布）开始，WebSecurityConfigurerAdapter 已从 Spring Security API 中完全删除。它还影响了 2022 年 11 月<a href=https://javatechonline.com/new-features-in-spring-boot-3-and-spring-6/>新发布的 Spring Boot 3.0</a>。因此，如果您使用 Spring Framework 6.0+ 或 Spring Boot 3.0+，无论哪种情况，SecurityConfig.java 的实现应如下所示。此外，您还可以检查<a href=https://javatechonline.com/how-to-migrate-spring-boot-2-to-spring-boot-3/#Review_Specific_to_Spring_Security_Dependency>Spring Framework 6.0中与Spring Security相关的更改</a>。</p><p>SecurityConfig.java</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>com.dev.springboot.security</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.ArrayList</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.List</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.context.annotation.Bean</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.context.annotation.Configuration</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.configuration.EnableWebSecurity</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.core.GrantedAuthority</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.core.authority.SimpleGrantedAuthority</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.core.userdetails.User</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.core.userdetails.UserDetails</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.provisioning.InMemoryUserDetailsManager</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.web.SecurityFilterChain</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.web.util.matcher.AntPathRequestMatcher</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Configuration</span>
</span></span><span class=line><span class=cl><span class=nd>@EnableWebSecurity</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SecurityConfig</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Bean</span>
</span></span><span class=line><span class=cl>	<span class=kd>protected</span> <span class=n>InMemoryUserDetailsManager</span> <span class=nf>configAuthentication</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=n>List</span><span class=o>&lt;</span><span class=n>UserDetails</span><span class=o>&gt;</span> <span class=n>users</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>		<span class=n>List</span><span class=o>&lt;</span><span class=n>GrantedAuthority</span><span class=o>&gt;</span> <span class=n>adminAuthority</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>		<span class=n>adminAuthority</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>new</span> <span class=n>SimpleGrantedAuthority</span><span class=o>(</span><span class=s>&#34;ADMIN&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>		<span class=n>UserDetails</span> <span class=n>admin</span><span class=o>=</span> <span class=k>new</span> <span class=n>User</span><span class=o>(</span><span class=s>&#34;devs&#34;</span><span class=o>,</span> <span class=s>&#34;{noop}devs&#34;</span><span class=o>,</span> <span class=n>adminAuthority</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>users</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>admin</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=n>List</span><span class=o>&lt;</span><span class=n>GrantedAuthority</span><span class=o>&gt;</span> <span class=n>employeeAuthority</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>		<span class=n>adminAuthority</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>new</span> <span class=n>SimpleGrantedAuthority</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>		<span class=n>UserDetails</span> <span class=n>employee</span><span class=o>=</span> <span class=k>new</span> <span class=n>User</span><span class=o>(</span><span class=s>&#34;ns&#34;</span><span class=o>,</span> <span class=s>&#34;{noop}ns&#34;</span><span class=o>,</span> <span class=n>employeeAuthority</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>users</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>employee</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=n>List</span><span class=o>&lt;</span><span class=n>GrantedAuthority</span><span class=o>&gt;</span> <span class=n>managerAuthority</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>		<span class=n>adminAuthority</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>new</span> <span class=n>SimpleGrantedAuthority</span><span class=o>(</span><span class=s>&#34;MANAGER&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>		<span class=n>UserDetails</span> <span class=n>manager</span><span class=o>=</span> <span class=k>new</span> <span class=n>User</span><span class=o>(</span><span class=s>&#34;vs&#34;</span><span class=o>,</span> <span class=s>&#34;{noop}vs&#34;</span><span class=o>,</span> <span class=n>managerAuthority</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>users</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>manager</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=k>new</span> <span class=n>InMemoryUserDetailsManager</span><span class=o>(</span><span class=n>users</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=nd>@Bean</span>
</span></span><span class=line><span class=cl>	<span class=kd>protected</span> <span class=n>SecurityFilterChain</span> <span class=nf>filterChain</span><span class=o>(</span><span class=n>HttpSecurity</span> <span class=n>http</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=c1>//declares which Page(URL) will have What access type
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=n>http</span><span class=o>.</span><span class=na>authorizeHttpRequests</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>requestMatchers</span><span class=o>(</span><span class=s>&#34;/home&#34;</span><span class=o>).</span><span class=na>permitAll</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>requestMatchers</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>).</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>requestMatchers</span><span class=o>(</span><span class=s>&#34;/admin&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;ADMIN&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>requestMatchers</span><span class=o>(</span><span class=s>&#34;/emp&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>requestMatchers</span><span class=o>(</span><span class=s>&#34;/mgr&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;MANAGER&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>requestMatchers</span><span class=o>(</span><span class=s>&#34;/common&#34;</span><span class=o>).</span><span class=na>hasAnyAuthority</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>,</span><span class=s>&#34;MANAGER&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=c1>// Any other URLs which are not configured in above antMatchers
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=c1>// generally declared aunthenticated() in real time
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=o>.</span><span class=na>anyRequest</span><span class=o>().</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=c1>//Login Form Details
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>formLogin</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>defaultSuccessUrl</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>,</span> <span class=kc>true</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=c1>//Logout Form Details
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>logout</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>logoutRequestMatcher</span><span class=o>(</span><span class=k>new</span> <span class=n>AntPathRequestMatcher</span><span class=o>(</span><span class=s>&#34;/logout&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>				
</span></span><span class=line><span class=cl>		<span class=c1>//Exception Details		
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>	
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>exceptionHandling</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>accessDeniedPage</span><span class=o>(</span><span class=s>&#34;/accessDenied&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>;</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>http</span><span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>注意：在上面的代码中，观察Spring Security 6.0中的API变化：antMatchers()被requestMatchers()替换，authorizeRequests()被authorizeHttpRequests()替换。</p><p>您的项目结构将如下图所示。</p><p><img loading=lazy src=https://i0.wp.com/javatechonline.com/wp-content/uploads/2020/11/SpringSecurity5.jpg alt=img></p><h2 id=如何实现-jdbc-身份验证安全性示例>如何实现 JDBC 身份验证安全性示例<a hidden class=anchor aria-hidden=true href=#如何实现-jdbc-身份验证安全性示例>#</a></h2><p>在这种身份验证方法中，我们根据数据库中的现有值验证凭据和角色。此外，在此示例中，我们还将研究密码加密逻辑。首先，我们将在数据库中插入一些虚拟数据，然后相应地测试安全功能。归根结底，如果我们比较前面示例的功能，我们将把用户凭据和角色保存到数据库而不是 RAM 中。</p><p>此外，在此示例中，我们将提供用于实现密码加密逻辑的附加代码。因此，上一个示例中的所有文件在此示例中也将有效。</p><p>此外，我们将有一个配置类来创建 BCryptPasswordEncoder 对象来对密码进行编码，并在 application.properties 中创建数据库属性条目以连接数据库。不用说，SecurityConfig 类的实现这次会有所不同。</p><h3 id=使用的软件技术>使用的软件/技术<a hidden class=anchor aria-hidden=true href=#使用的软件技术>#</a></h3><ul><li>STS (Spring Tool Suite) : Version-> 4.7.1.RELEASE</li><li>MySQL Database : Version ->8.0.19 MySQL Community Server</li><li>JDK14 (JDK8 or later versions are sufficient)</li></ul><h3 id=步骤1在数据库中插入一些虚拟记录>步骤#1：在数据库中插入一些虚拟记录<a hidden class=anchor aria-hidden=true href=#步骤1在数据库中插入一些虚拟记录>#</a></h3><p>请注意，此步骤仅用于测试目的。如果您最近已经使用用户凭据和角色映射创建了数据库，请忽略此步骤。在步骤#1A 中，我们将创建一些密码编码值，然后在步骤#1B 中将它们插入到数据库中。</p><h4 id=步骤1a使用-bcryptpasswordencoder-创建编码密码值>步骤#1A：使用 BCryptPasswordEncoder 创建编码密码值<a hidden class=anchor aria-hidden=true href=#步骤1a使用-bcryptpasswordencoder-创建编码密码值>#</a></h4><p>我们将使用 BCryptPasswordEncoder 生成一些编码密码值，如下所示</p><p>BCryptPasswordEncoderTest.java</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>com.dev.springboot.security.util</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>BCryptPasswordEncoderTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=n>BCryptPasswordEncoder</span> <span class=n>bpe</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BCryptPasswordEncoder</span><span class=o>();</span>
</span></span><span class=line><span class=cl>		<span class=n>String</span> <span class=n>encodedPWD</span> <span class=o>=</span> <span class=n>bpe</span><span class=o>.</span><span class=na>encode</span><span class=o>(</span><span class=s>&#34;devs@A!5003&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>encodedPWD</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$2a$10$qnOB2PH1CqRvw8f5epvHzOlrounRkVGi.Y5ho6ENdmj/C1DmPdAsy
</span></span></code></pre></div><h4 id=步骤1b创建数据库并插入虚拟记录>步骤#1B：创建数据库并插入虚拟记录<a hidden class=anchor aria-hidden=true href=#步骤1b创建数据库并插入虚拟记录>#</a></h4><p>执行MySQL DB命令如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>To create the database as &#39;testbootsecurity&#39;
</span></span><span class=line><span class=cl>♦ create database testbootsecurity;
</span></span><span class=line><span class=cl>To take &#39;testbootsecurity&#39; in use:
</span></span><span class=line><span class=cl>♦ use testbootsecurity;
</span></span><span class=line><span class=cl>To create the user table:
</span></span><span class=line><span class=cl>♦ create table user (user_id int, user_name varchar(30), user_pwd varchar(100), user_role varchar(20), user_enabled int);
</span></span><span class=line><span class=cl>To check the description of user table:
</span></span><span class=line><span class=cl>♦ desc user;
</span></span><span class=line><span class=cl>INSERT INTO user values(501,&#39;devs&#39;,&#39;$2a$10$qnOB2PH1CqRvw8f5epvHzOlrounRkVGi.Y5ho6ENdmj/C1DmPdAsy&#39;,&#39;ADMIN&#39;,1);
</span></span><span class=line><span class=cl>INSERT INTO user values(502,&#39;ns&#39;,&#39;$2a$10$mmUMC5ZwoVnEQYV7/R6m.uWWtj7EiIo3lKasBObkOCc12huVUWpMC&#39;,&#39;EMPLOYEE&#39;,1);
</span></span><span class=line><span class=cl>INSERT INTO user values(503,&#39;vs&#39;,&#39;$2a$10$kqEC/fhQ7SNDhnncOQ9pb.yXXxJ/c7a1SQx2QPNZ.47fUmvF3Wb.i&#39;,&#39;MANAGER&#39;,1);
</span></span><span class=line><span class=cl>♦ select * from user;  (To check if values are inserted into DB)
</span></span></code></pre></div><p>此外，在实现 SecurityConfig.java 类的 configure(AuthenticationManagerBuilder auth) 方法时，我们将需要以下两个查询。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Query#1 : Retrieve username,password,enabled using username ;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>♦ select user_name,user_pwd,user_enabled from user where user_name=?;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Query#2 : Retrieve username,role using username;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>♦ select user_name,user_role from user where user_name=?;
</span></span></code></pre></div><h3 id=步骤2在stsspring-tool-suite中创建一个spring-boot-starter项目>步骤#2：在STS(Spring Tool Suite)中创建一个Spring Boot Starter项目<a hidden class=anchor aria-hidden=true href=#步骤2在stsspring-tool-suite中创建一个spring-boot-starter项目>#</a></h3><p>创建入门项目时，选择“Spring Security”、“Thymeleaf”、“Spring Web”、“JDBC API”、“MySQL Driver”和“Spring Boot DevTools”作为入门项目依赖项。</p><h3 id=步骤3从上一个示例复制控制器类和-ui-页面>步骤#3：从上一个示例复制控制器类和 UI 页面<a hidden class=anchor aria-hidden=true href=#步骤3从上一个示例复制控制器类和-ui-页面>#</a></h3><p>复制 HomeController.java 以及前面示例中的所有 thymeleaf 页面。</p><h3 id=步骤4创建-appconfigjava-以创建-bcryptpasswordencoder-对象>步骤#4：创建 AppConfig.java 以创建 BCryptPasswordEncoder 对象<a hidden class=anchor aria-hidden=true href=#步骤4创建-appconfigjava-以创建-bcryptpasswordencoder-对象>#</a></h3><p>如下创建AppConfig.java。在实现 SecurityConfig.java 类时，我们将需要 BCryptPasswordEncoder 对象。</p><p>AppConfig.java</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>com.dev.springboot.security.jdbc.config</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.context.annotation.Bean</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.context.annotation.Configuration</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Configuration</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>AppConfig</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=nd>@Bean</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>BCryptPasswordEncoder</span> <span class=nf>encode</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=k>new</span> <span class=n>BCryptPasswordEncoder</span><span class=o>();</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h3 id=步骤5更新-applicationproperties-文件中的数据库属性>步骤#5：更新 application.properties 文件中的数据库属性<a hidden class=anchor aria-hidden=true href=#步骤5更新-applicationproperties-文件中的数据库属性>#</a></h3><p>更新 application.properties 以连接到 MySQL DB，如下所示。请注意，我们可以省略 driver-class-name，因为 Spring Boot 会自动从数据库 URL 中找到它。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#application.properties
</span></span><span class=line><span class=cl>-------------------------------------------------------------------
</span></span><span class=line><span class=cl>spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
</span></span><span class=line><span class=cl>spring.datasource.url=jdbc:mysql://localhost:3306/testBootSecurity
</span></span><span class=line><span class=cl>spring.datasource.username=root
</span></span><span class=line><span class=cl>spring.datasource.password=devs
</span></span></code></pre></div><h3 id=步骤6更新securityconfigjava>步骤#6：更新SecurityConfig.java<a hidden class=anchor aria-hidden=true href=#步骤6更新securityconfigjava>#</a></h3><p>从前面的示例中复制 SecurityConfig.java 并更新 configure( AuthenticationManagerBuilder auth) 方法，如下所示。</p><h4 id=步骤6aspring-security-570以下版本的代码>步骤#6A：Spring Security 5.7.0以下版本的代码<a hidden class=anchor aria-hidden=true href=#步骤6aspring-security-570以下版本的代码>#</a></h4><p>SecurityConfig.java</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>com.dev.springboot.security.jdbc.config</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>javax.sql.DataSource</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.beans.factory.annotation.Autowired</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.context.annotation.Configuration</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.configuration.EnableWebSecurity</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.web.util.matcher.AntPathRequestMatcher</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Configuration</span>
</span></span><span class=line><span class=cl><span class=nd>@EnableWebSecurity</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SecurityConfig</span> <span class=kd>extends</span> <span class=n>WebSecurityConfigurerAdapter</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=nd>@Autowired</span>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=n>DataSource</span> <span class=n>dataSource</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=nd>@Autowired</span>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=n>BCryptPasswordEncoder</span> <span class=n>passwordEncoder</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=nd>@Override</span>
</span></span><span class=line><span class=cl>	<span class=kd>protected</span> <span class=kt>void</span> <span class=nf>configure</span><span class=o>(</span><span class=n>AuthenticationManagerBuilder</span> <span class=n>auth</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=n>auth</span><span class=o>.</span><span class=na>jdbcAuthentication</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>dataSource</span><span class=o>(</span><span class=n>dataSource</span><span class=o>)</span>     <span class=c1>//creates database connection
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=o>.</span><span class=na>usersByUsernameQuery</span><span class=o>(</span><span class=s>&#34;select user_name,user_pwd,user_enabled from user where user_name=?&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>authoritiesByUsernameQuery</span><span class=o>(</span><span class=s>&#34;select user_name,user_role from user where user_name=?&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>passwordEncoder</span><span class=o>(</span><span class=n>passwordEncoder</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=nd>@Override</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>configure</span><span class=o>(</span><span class=n>HttpSecurity</span> <span class=n>http</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=n>http</span><span class=o>.</span><span class=na>authorizeRequests</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/home&#34;</span><span class=o>).</span><span class=na>permitAll</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>).</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/admin&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;ADMIN&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/emp&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/mgr&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;MANAGER&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>anyRequest</span><span class=o>().</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>formLogin</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>defaultSuccessUrl</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>,</span><span class=kc>true</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>logout</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>logoutRequestMatcher</span><span class=o>(</span><span class=k>new</span> <span class=n>AntPathRequestMatcher</span><span class=o>(</span><span class=s>&#34;/logout&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>exceptionHandling</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>accessDeniedPage</span><span class=o>(</span><span class=s>&#34;/accessDenied&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>;</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h4 id=步骤6bspring-security-570以上版本和spring-security-600以下版本的代码>步骤#6B：Spring Security 5.7.0以上版本和Spring Security 6.0.0以下版本的代码<a hidden class=anchor aria-hidden=true href=#步骤6bspring-security-570以上版本和spring-security-600以下版本的代码>#</a></h4><p>由于根据 Spring 官网发布的公告，<a href=https://javatechonline.com/spring-security-without-websecurityconfigureradapter/>WebSecurityConfigurerAdapter 已从 Spring Security 5.7.0-M2 中弃用</a>，因此，2022 年 2 月 21 日，我们将不使用 WebSecurityConfigurerAdapter 来编写 SecurityConfig 类，如下所示：</p><p>SecurityConfig.java</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>com.dev.springboot.security.jdbc.config</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>javax.sql.DataSource</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.beans.factory.annotation.Autowired</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.context.annotation.Bean</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.context.annotation.Configuration</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.configuration.EnableWebSecurity</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.core.userdetails.User</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.core.userdetails.UserDetails</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.crypto.factory.PasswordEncoderFactories</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.provisioning.JdbcUserDetailsManager</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.provisioning.UserDetailsManager</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.web.SecurityFilterChain</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.web.util.matcher.AntPathRequestMatcher</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Configuration</span>
</span></span><span class=line><span class=cl><span class=nd>@EnableWebSecurity</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SecurityConfig</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=nd>@Autowired</span>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=n>DataSource</span> <span class=n>dataSource</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=nd>@Autowired</span>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=n>BCryptPasswordEncoder</span> <span class=n>passwordEncoder</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=nd>@Bean</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>UserDetailsManager</span> <span class=nf>authenticateUsers</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=n>UserDetails</span> <span class=n>user</span> <span class=o>=</span> <span class=n>User</span><span class=o>.</span><span class=na>withUsername</span><span class=o>(</span><span class=s>&#34;devs&#34;</span><span class=o>).</span>
</span></span><span class=line><span class=cl>				<span class=n>password</span><span class=o>(</span><span class=n>PasswordEncoderFactories</span><span class=o>.</span><span class=na>createDelegatingPasswordEncoder</span><span class=o>().</span><span class=na>encode</span><span class=o>(</span><span class=s>&#34;password&#34;</span><span class=o>)).</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>		<span class=n>JdbcUserDetailsManager</span> <span class=n>users</span> <span class=o>=</span> <span class=k>new</span> <span class=n>JdbcUserDetailsManager</span><span class=o>(</span><span class=n>dataSource</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>users</span><span class=o>.</span><span class=na>setAuthoritiesByUsernameQuery</span><span class=o>(</span><span class=s>&#34;select user_name,user_pwd,user_enabled from user where user_name=?&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>users</span><span class=o>.</span><span class=na>setUsersByUsernameQuery</span><span class=o>(</span><span class=s>&#34;select user_name,user_role from user where user_name=?&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>users</span><span class=o>.</span><span class=na>createUser</span><span class=o>(</span><span class=n>user</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>users</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=nd>@Bean</span>
</span></span><span class=line><span class=cl>	<span class=kd>protected</span> <span class=n>SecurityFilterChain</span> <span class=nf>filterChain</span><span class=o>(</span><span class=n>HttpSecurity</span> <span class=n>http</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=n>http</span><span class=o>.</span><span class=na>authorizeRequests</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/home&#34;</span><span class=o>).</span><span class=na>permitAll</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>).</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/admin&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;ADMIN&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/emp&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/mgr&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;MANAGER&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>anyRequest</span><span class=o>().</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>formLogin</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>defaultSuccessUrl</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>,</span><span class=kc>true</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>logout</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>logoutRequestMatcher</span><span class=o>(</span><span class=k>new</span> <span class=n>AntPathRequestMatcher</span><span class=o>(</span><span class=s>&#34;/logout&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>exceptionHandling</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>accessDeniedPage</span><span class=o>(</span><span class=s>&#34;/accessDenied&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>;</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>http</span><span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h4 id=步骤6cspring-security-600-及更高版本的代码spring-boot-30>步骤#6C：Spring Security 6.0.0 及更高版本的代码（Spring Boot 3.0+）<a hidden class=anchor aria-hidden=true href=#步骤6cspring-security-600-及更高版本的代码spring-boot-30>#</a></h4><p>从 Spring Security 6.0（2022 年 11 月发布）开始，WebSecurityConfigurerAdapter 已从 Spring Security API 中完全删除。它还影响了 2022 年 11 月新发布的 Spring Boot 3.0。因此，如果您使用 Spring Framework 6.0+ 或 Spring Boot 3.0+，无论哪种情况，SecurityConfig.java 的实现应如下所示。此外，您还可以检查Spring Framework 6.0中与Spring Security相关的更改。</p><p>SecurityConfig.java</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>com.dev.springboot.security.jdbc.config</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>javax.sql.DataSource</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.beans.factory.annotation.Autowired</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.context.annotation.Bean</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.context.annotation.Configuration</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.configuration.EnableWebSecurity</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.core.userdetails.User</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.core.userdetails.UserDetails</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.crypto.factory.PasswordEncoderFactories</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.provisioning.JdbcUserDetailsManager</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.provisioning.UserDetailsManager</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.web.SecurityFilterChain</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.web.util.matcher.AntPathRequestMatcher</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Configuration</span>
</span></span><span class=line><span class=cl><span class=nd>@EnableWebSecurity</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SecurityConfig</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=nd>@Autowired</span>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=n>DataSource</span> <span class=n>dataSource</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=nd>@Autowired</span>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=n>BCryptPasswordEncoder</span> <span class=n>passwordEncoder</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=nd>@Bean</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>UserDetailsManager</span> <span class=nf>authenticateUsers</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=n>UserDetails</span> <span class=n>user</span> <span class=o>=</span> <span class=n>User</span><span class=o>.</span><span class=na>withUsername</span><span class=o>(</span><span class=s>&#34;devs&#34;</span><span class=o>).</span>
</span></span><span class=line><span class=cl>				<span class=n>password</span><span class=o>(</span><span class=n>PasswordEncoderFactories</span><span class=o>.</span><span class=na>createDelegatingPasswordEncoder</span><span class=o>().</span><span class=na>encode</span><span class=o>(</span><span class=s>&#34;password&#34;</span><span class=o>)).</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>		<span class=n>JdbcUserDetailsManager</span> <span class=n>users</span> <span class=o>=</span> <span class=k>new</span> <span class=n>JdbcUserDetailsManager</span><span class=o>(</span><span class=n>dataSource</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>users</span><span class=o>.</span><span class=na>setAuthoritiesByUsernameQuery</span><span class=o>(</span><span class=s>&#34;select user_name,user_pwd,user_enabled from user where user_name=?&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>users</span><span class=o>.</span><span class=na>setUsersByUsernameQuery</span><span class=o>(</span><span class=s>&#34;select user_name,user_role from user where user_name=?&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>users</span><span class=o>.</span><span class=na>createUser</span><span class=o>(</span><span class=n>user</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>users</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=nd>@Bean</span>
</span></span><span class=line><span class=cl>	<span class=kd>protected</span> <span class=n>SecurityFilterChain</span> <span class=nf>filterChain</span><span class=o>(</span><span class=n>HttpSecurity</span> <span class=n>http</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=n>http</span><span class=o>.</span><span class=na>authorizeHttpRequests</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>requestMatchers</span><span class=o>(</span><span class=s>&#34;/home&#34;</span><span class=o>).</span><span class=na>permitAll</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>requestMatchers</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>).</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>requestMatchers</span><span class=o>(</span><span class=s>&#34;/admin&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;ADMIN&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>requestMatchers</span><span class=o>(</span><span class=s>&#34;/emp&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>requestMatchers</span><span class=o>(</span><span class=s>&#34;/mgr&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;MANAGER&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>anyRequest</span><span class=o>().</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>formLogin</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>defaultSuccessUrl</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>,</span><span class=kc>true</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>logout</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>logoutRequestMatcher</span><span class=o>(</span><span class=k>new</span> <span class=n>AntPathRequestMatcher</span><span class=o>(</span><span class=s>&#34;/logout&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>		
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>exceptionHandling</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>accessDeniedPage</span><span class=o>(</span><span class=s>&#34;/accessDenied&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>;</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>http</span><span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>注意：在上面的代码中，观察Spring Security 6.0中的API变化：antMatchers()被requestMatchers()替换，authorizeRequests()被authorizeHttpRequests()替换。</p><h2 id=如何测试启用安全的应用程序>如何测试启用安全的应用程序？<a hidden class=anchor aria-hidden=true href=#如何测试启用安全的应用程序>#</a></h2><p>同时完成大量理论和编码步骤之后，是时候测试“如何在 Spring Boot 项目中实现安全性？”了。请按照以下步骤操作。</p><ol><li><p>启动应用程序，然后右键单击该项目，然后选择“Run As”&#187;“Spring Boot App”。</p></li><li><p>输入首页网址http://localhost:8080/home，检查是否存在每个人都可以访问，甚至无需登录应用程序。</p></li><li><p>输入管理页面URL http://localhost:8080/admin，然后它应该被重定向到内置登录页面（由Spring Security提供）</p></li><li><p>使用提供的管理员凭据登录，您将被重定向到欢迎页面。</p></li><li><p>输入URL http://localhost:8080/admin，然后您就可以看到管理页面了。</p></li><li><p>当您使用管理员凭据登录时，您还可以通过点击其他页面 URL 来查看所有页面。</p></li></ol><p>随后对其他角色也重复上述步骤并检查用户是否可以根据授予的角色访问该页面。</p><h2 id=spring-boot项目如何实现安全性-spring-boot-30-及以上>Spring Boot项目如何实现安全性？ ：Spring Boot 3.0 及以上<a hidden class=anchor aria-hidden=true href=#spring-boot项目如何实现安全性-spring-boot-30-及以上>#</a></h2><p>Spring Boot 3.0 在 Spring Security 模块中进行了重大 API 级别更改。因此，如果您使用 Spring Boot 3.0 或更高版本，则需要遵循以下指南以及使用 JDK 17。</p><ol><li>在SecurityConfig.java中：</li></ol><ul><li><p>使用authorizeHttpRequests()代替authorizeRequests()</p></li><li><p>使用 requestMatchers() 代替 antMatchers()</p></li><li><p>使用 RegexRequestMatchers() 代替 regexMatchers()</p></li></ul><ol start=2><li>在实体类中：</li></ol><ul><li>在 import 语句中，使用“jakarta”代替“javax”。例如：使用“jakarta.persistence.Entity;”代替“javax.persistence.Entity;”。</li></ul><h2 id=faq>FAQ<a hidden class=anchor aria-hidden=true href=#faq>#</a></h2><h3 id=如何禁用应用程序的安全功能>如何禁用应用程序的安全功能？<a hidden class=anchor aria-hidden=true href=#如何禁用应用程序的安全功能>#</a></h3><p>同样重要的是，有时我们需要禁用安全功能，特别是在开发和测试环境中，以避免再次输入凭据。为此，我们可以相应地在 pom.xml 文件中注释以下两个依赖项。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=c>&lt;!-- 
</span></span></span><span class=line><span class=cl><span class=c>&lt;dependency&gt;
</span></span></span><span class=line><span class=cl><span class=c>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
</span></span></span><span class=line><span class=cl><span class=c>    &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
</span></span></span><span class=line><span class=cl><span class=c>&lt;/dependency&gt;
</span></span></span><span class=line><span class=cl><span class=c>&lt;dependency&gt;
</span></span></span><span class=line><span class=cl><span class=c>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
</span></span></span><span class=line><span class=cl><span class=c>    &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;
</span></span></span><span class=line><span class=cl><span class=c>&lt;/dependency&gt;
</span></span></span><span class=line><span class=cl><span class=c>--&gt;</span>
</span></span></code></pre></div><h2 id=概括>概括<a hidden class=anchor aria-hidden=true href=#概括>#</a></h2><p>随后，通过“如何在 Spring Boot 项目中实现安全性？”的所有理论和示例部分，最后，我们能够在 Spring Boot 项目中实现 Web 安全性。当然，在本文中我们介绍了两种实现安全功能的方法。此外，我们可以在<a href=https://javatechonline.com/how-to-implement-security-in-spring-boot-using-userdetailsservice/>另一篇文章</a>中了解UserDetailsS​​ervice（实现安全性的第三种方式）。此外，有关 Spring Boot Security 的完整教程请访问<a href=https://javatechonline.com/spring-boot/#Spring_Boot_Security>此处</a>。后续如有更新，我们也会及时更新。也请随时在下面的评论部分提供您的意见。</p><p>原文链接：<a href=https://javatechonline.com/how-to-implement-security-in-spring-boot-project/>https://javatechonline.com/how-to-implement-security-in-spring-boot-project/</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.chensoul.com/tags/java/>java</a></li><li><a href=https://blog.chensoul.com/tags/spring/>spring</a></li><li><a href=https://blog.chensoul.com/tags/spring-boot/>spring boot</a></li><li><a href=https://blog.chensoul.com/tags/spring-security/>spring security</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://blog.chensoul.com/>ChenSoul</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script async src=https://umami.chensoul.com/script.js data-website-id=821c25f8-a31a-4607-92d7-91ee76843d00></script>
<script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>