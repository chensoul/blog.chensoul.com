<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[译]Spring Boot项目如何实现Security？ | ChenSoul</title><meta name=keywords content="java,spring,spring boot,spring security"><meta name=description content="如今，几乎每个客户都要求在实时应用程序中实现强大的安全功能。安全功能对于保持机密性、完整性和可用性的需求是非常有效的。现实世界中有很多类型的安全性，但我们作为开发人员将重点关注应用程序/软件安全性。
此外，在应用程序安全方面，我们的工作基本上是确保两件事。首先，只有有效的用户才能访问该应用程序。其次，如果用户有效，他/她只能访问该应用程序中允许的数据/信息。我认为，没有什么可以解释它们，因为您必须已经了解这两个术语，即身份验证和授权。
您可能已经猜到我们将在当前主题“如何在 Spring Boot 项目中实现安全性？”中讨论什么内容。
在本文中，我们将从基本原理开始学习。接下来，我们将逐步结束它，直到我们有信心在 Spring Boot 应用程序中实现安全功能。因此，让我们开始逐步讨论“如何在 Spring Boot 项目中实现安全性？”。 Spring Boot 教程页面上有一系列有关 Spring Boot Security 的教程。
我们在本文中介绍了两个版本的“如何在 Spring Boot 项目中实现安全性？”的示例：使用 WebSecurityConfigurerAdapter 和不使用 WebSecurityConfigurerAdapter。此外，还涵盖了使用 Spring Boot 3.0 及更高版本的“如何在 Spring Boot 项目中实现安全性？”的示例。
您将从本文中学到什么？ 为什么我们需要在 Spring Boot 应用程序中实现安全性？
Security 在 Spring Boot 应用程序内部如何工作？
javax.servlet.Filter 在 Spring Boot 应用程序中实现安全性方面的作用是什么？
Spring Boot 项目中使用了多少种授权类型？
Spring Boot 项目中有多少种实现安全性的方法？
在 Spring Boot 项目中实现 WebSecurity 的步骤是什么？
另外，如何在 Spring Boot 项目中使用@EnableWebSecurity、@Configuration、@Bean？
如何实现内存中身份验证安全示例
如何实现 JDBC 认证安全示例"><meta name=author content="chensoul"><link rel=canonical href=https://blog.chensoul.com/posts/2023/08/18/how-to-implement-security-in-spring-boot-project/><link crossorigin=anonymous href=/assets/css/stylesheet.min.c0bdcf61a84b821409b092c03af60edc8ea542c6d2dc20cff93150bcfd67d65d.css integrity="sha256-wL3PYahLghQJsJLAOvYO3I6lQsbS3CDP+TFQvP1n1l0=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.chensoul.com/favicon.ico><link rel=apple-touch-icon href=https://blog.chensoul.com/apple-touch-icon.png><meta name=twitter:title content="[译]Spring Boot项目如何实现Security？ | ChenSoul"><meta name=twitter:description content="如今，几乎每个客户都要求在实时应用程序中实现强大的安全功能。安全功能对于保持机密性、完整性和可用性的需求是非常有效的。现实世界中有很多类型的安全性，但我们作为开发人员将重点关注应用程序/软件安全性。
此外，在应用程序安全方面，我们的工作基本上是确保两件事。首先，只有有效的用户才能访问该应用程序。其次，如果用户有效，他/她只能访问该应用程序中允许的数据/信息。我认为，没有什么可以解释它们，因为您必须已经了解这两个术语，即身份验证和授权。
您可能已经猜到我们将在当前主题“如何在 Spring Boot 项目中实现安全性？”中讨论什么内容。
在本文中，我们将从基本原理开始学习。接下来，我们将逐步结束它，直到我们有信心在 Spring Boot 应用程序中实现安全功能。因此，让我们开始逐步讨论“如何在 Spring Boot 项目中实现安全性？”。 Spring Boot 教程页面上有一系列有关 Spring Boot Security 的教程。
我们在本文中介绍了两个版本的“如何在 Spring Boot 项目中实现安全性？”的示例：使用 WebSecurityConfigurerAdapter 和不使用 WebSecurityConfigurerAdapter。此外，还涵盖了使用 Spring Boot 3.0 及更高版本的“如何在 Spring Boot 项目中实现安全性？”的示例。
您将从本文中学到什么？ 为什么我们需要在 Spring Boot 应用程序中实现安全性？
Security 在 Spring Boot 应用程序内部如何工作？
javax.servlet.Filter 在 Spring Boot 应用程序中实现安全性方面的作用是什么？
Spring Boot 项目中使用了多少种授权类型？
Spring Boot 项目中有多少种实现安全性的方法？
在 Spring Boot 项目中实现 WebSecurity 的步骤是什么？
另外，如何在 Spring Boot 项目中使用@EnableWebSecurity、@Configuration、@Bean？
如何实现内存中身份验证安全示例
如何实现 JDBC 认证安全示例"><meta property="og:title" content="[译]Spring Boot项目如何实现Security？ | ChenSoul"><meta property="og:description" content="如今，几乎每个客户都要求在实时应用程序中实现强大的安全功能。安全功能对于保持机密性、完整性和可用性的需求是非常有效的。现实世界中有很多类型的安全性，但我们作为开发人员将重点关注应用程序/软件安全性。
此外，在应用程序安全方面，我们的工作基本上是确保两件事。首先，只有有效的用户才能访问该应用程序。其次，如果用户有效，他/她只能访问该应用程序中允许的数据/信息。我认为，没有什么可以解释它们，因为您必须已经了解这两个术语，即身份验证和授权。
您可能已经猜到我们将在当前主题“如何在 Spring Boot 项目中实现安全性？”中讨论什么内容。
在本文中，我们将从基本原理开始学习。接下来，我们将逐步结束它，直到我们有信心在 Spring Boot 应用程序中实现安全功能。因此，让我们开始逐步讨论“如何在 Spring Boot 项目中实现安全性？”。 Spring Boot 教程页面上有一系列有关 Spring Boot Security 的教程。
我们在本文中介绍了两个版本的“如何在 Spring Boot 项目中实现安全性？”的示例：使用 WebSecurityConfigurerAdapter 和不使用 WebSecurityConfigurerAdapter。此外，还涵盖了使用 Spring Boot 3.0 及更高版本的“如何在 Spring Boot 项目中实现安全性？”的示例。
您将从本文中学到什么？ 为什么我们需要在 Spring Boot 应用程序中实现安全性？
Security 在 Spring Boot 应用程序内部如何工作？
javax.servlet.Filter 在 Spring Boot 应用程序中实现安全性方面的作用是什么？
Spring Boot 项目中使用了多少种授权类型？
Spring Boot 项目中有多少种实现安全性的方法？
在 Spring Boot 项目中实现 WebSecurity 的步骤是什么？
另外，如何在 Spring Boot 项目中使用@EnableWebSecurity、@Configuration、@Bean？
如何实现内存中身份验证安全示例
如何实现 JDBC 认证安全示例"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.chensoul.com/posts/2023/08/18/how-to-implement-security-in-spring-boot-project/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-18T10:00:00+08:00"><meta property="article:modified_time" content="2023-08-18T10:00:00+08:00"><meta property="og:site_name" content="ChenSoul"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.chensoul.com/posts/"},{"@type":"ListItem","position":2,"name":"[译]Spring Boot项目如何实现Security？","item":"https://blog.chensoul.com/posts/2023/08/18/how-to-implement-security-in-spring-boot-project/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[译]Spring Boot项目如何实现Security？ | ChenSoul","name":"[译]Spring Boot项目如何实现Security？","description":"如今，几乎每个客户都要求在实时应用程序中实现强大的安全功能。安全功能对于保持机密性、完整性和可用性的需求是非常有效的。现实世界中有很多类型的安全性，但我们作为开发人员将重点关注应用程序/软件安全性。\n此外，在应用程序安全方面，我们的工作基本上是确保两件事。首先，只有有效的用户才能访问该应用程序。其次，如果用户有效，他/她只能访问该应用程序中允许的数据/信息。我认为，没有什么可以解释它们，因为您必须已经了解这两个术语，即身份验证和授权。\n您可能已经猜到我们将在当前主题“如何在 Spring Boot 项目中实现安全性？”中讨论什么内容。\n在本文中，我们将从基本原理开始学习。接下来，我们将逐步结束它，直到我们有信心在 Spring Boot 应用程序中实现安全功能。因此，让我们开始逐步讨论“如何在 Spring Boot 项目中实现安全性？”。 Spring Boot 教程页面上有一系列有关 Spring Boot Security 的教程。\n我们在本文中介绍了两个版本的“如何在 Spring Boot 项目中实现安全性？”的示例：使用 WebSecurityConfigurerAdapter 和不使用 WebSecurityConfigurerAdapter。此外，还涵盖了使用 Spring Boot 3.0 及更高版本的“如何在 Spring Boot 项目中实现安全性？”的示例。\n您将从本文中学到什么？ 为什么我们需要在 Spring Boot 应用程序中实现安全性？\nSecurity 在 Spring Boot 应用程序内部如何工作？\njavax.servlet.Filter 在 Spring Boot 应用程序中实现安全性方面的作用是什么？\nSpring Boot 项目中使用了多少种授权类型？\nSpring Boot 项目中有多少种实现安全性的方法？\n在 Spring Boot 项目中实现 WebSecurity 的步骤是什么？\n另外，如何在 Spring Boot 项目中使用@EnableWebSecurity、@Configuration、@Bean？\n如何实现内存中身份验证安全示例\n如何实现 JDBC 认证安全示例","keywords":["java","spring","spring boot","spring security"],"wordCount":"1807","inLanguage":"en","datePublished":"2023-08-18T10:00:00+08:00","dateModified":"2023-08-18T10:00:00+08:00","author":[{"@type":"Person","name":"chensoul"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.chensoul.com/posts/2023/08/18/how-to-implement-security-in-spring-boot-project/"},"publisher":{"@type":"Organization","name":"ChenSoul","logo":{"@type":"ImageObject","url":"https://blog.chensoul.com/favicon.ico"}}}</script><meta name=baidu-site-verification content="codeva-FYpQY8JdLU"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary-bg:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list-page{background:var(--theme)}.list-page:not(.dark)::-webkit-scrollbar-track{background:0 0}.list-page:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript></head><body class="type-posts kind-page layout-" id=top><script data-no-instant>function switchTheme(e){switch(e){case"light":document.body.classList.remove("dark");break;case"dark":document.body.classList.add("dark");break;default:window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")}}function isDarkTheme(){return document.body.className.includes("dark")}function getPrefTheme(){return localStorage.getItem("pref-theme")}function setPrefTheme(e){switchTheme(e),localStorage.setItem("pref-theme",e)}const toggleThemeCallbacks={};toggleThemeCallbacks.main=e=>{setPrefTheme(e?"light":"dark")},window.addEventListener("toggle-theme",function(){const e=isDarkTheme();for(const t in toggleThemeCallbacks)toggleThemeCallbacks[t](e)});function toggleThemeListener(){window.dispatchEvent(new CustomEvent("toggle-theme"))}</script><script>(function(){const t="auto",e=getPrefTheme(),n=e||t;switchTheme(n)})()</script><header class=header><nav class=nav><div class=logo><a href=https://blog.chensoul.com/ accesskey=h title="ChenSoul (Alt + H)">ChenSoul</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://blog.chensoul.com/categories/weekly/ title=周报>周报</a></li><li><a href=https://blog.chensoul.com/categories/ title=分类>分类</a></li><li><a href=https://blog.chensoul.com/tags/ title=标签>标签</a></li><li><a href=https://github.com/chensoul/ title=关于 target=_blank>关于<span class=external-link><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-external-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M11 7H6A2 2 0 004 9v9a2 2 0 002 2h9a2 2 0 002-2v-5"/><line x1="10" y1="14" x2="20" y2="4"/><polyline points="15 4 20 4 20 9"/></svg></span></a></li></ul></nav></header><main class="main post"><article class=post-single><header class=post-header><h1 class=post-title>[译]Spring Boot项目如何实现Security？</h1><div class=post-meta><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>2023-08-18</span></span><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon" style="user-select:text"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z" style="user-select:text"/><line x1="7" y1="7" x2="7" y2="7" style="user-select:text"/></svg>
<span class=post-tags><a href=https://blog.chensoul.com/tags/java/>java</a><a href=https://blog.chensoul.com/tags/spring/>spring</a><a href=https://blog.chensoul.com/tags/spring-boot/>spring boot</a><a href=https://blog.chensoul.com/tags/spring-security/>spring security</a></span></span><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>9 min</span></span></div></header><div class="toc side right"><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e6%82%a8%e5%b0%86%e4%bb%8e%e6%9c%ac%e6%96%87%e4%b8%ad%e5%ad%a6%e5%88%b0%e4%bb%80%e4%b9%88 aria-label=您将从本文中学到什么？>您将从本文中学到什么？</a></li><li><a href=#%e4%b8%ba%e4%bb%80%e4%b9%88%e6%88%91%e4%bb%ac%e9%9c%80%e8%a6%81%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f%e4%b8%ad%e7%9a%84%e5%ae%89%e5%85%a8%e6%80%a7 aria-label=为什么我们需要应用程序中的安全性？>为什么我们需要应用程序中的安全性？</a></li><li><a href=#spring-boot-%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f%e5%86%85%e9%83%a8%e5%ae%89%e5%85%a8%e6%80%a7%e5%a6%82%e4%bd%95%e5%b7%a5%e4%bd%9c aria-label="Spring Boot 应用程序内部安全性如何工作？">Spring Boot 应用程序内部安全性如何工作？</a></li><li><a href=#spring-boot-%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f%e4%bd%bf%e7%94%a8%e4%ba%86%e5%a4%9a%e5%b0%91%e7%a7%8d%e6%8e%88%e6%9d%83%e7%b1%bb%e5%9e%8b aria-label="Spring Boot 应用程序使用了多少种授权类型？">Spring Boot 应用程序使用了多少种授权类型？</a><ul><li><a href=#1-permitall-%e5%85%81%e8%ae%b8%e5%85%a8%e9%83%a8 aria-label="1) permitAll 允许全部">1) permitAll 允许全部</a></li><li><a href=#2-authenticated-%e5%b7%b2%e8%ae%a4%e8%af%81 aria-label="2) authenticated 已认证">2) authenticated 已认证</a></li><li><a href=#3-hasauthority aria-label="3) hasAuthority">3) hasAuthority</a></li><li><a href=#4-hasanyauthority-%e6%9c%89%e4%bb%bb%e4%bd%95%e6%9d%83%e9%99%90 aria-label="4) hasAnyAuthority 有任何权限">4) hasAnyAuthority 有任何权限</a></li></ul></li><li><a href=#%e5%9c%a8-spring-boot-web-%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f%e4%b8%ad%e5%ae%9e%e7%8e%b0%e5%ae%89%e5%85%a8%e6%80%a7%e6%9c%89%e5%93%aa%e4%ba%9b%e4%b8%8d%e5%90%8c%e7%9a%84%e6%96%b9%e6%b3%95 aria-label="在 Spring Boot Web 应用程序中实现安全性有哪些不同的方法？">在 Spring Boot Web 应用程序中实现安全性有哪些不同的方法？</a><ul><li><a href=#in-memory-security-%e5%86%85%e5%ad%98%e5%ae%89%e5%85%a8 aria-label="In-Memory Security 内存安全">In-Memory Security 内存安全</a></li><li><a href=#%e4%bd%bf%e7%94%a8%e6%95%b0%e6%8d%ae%e5%ba%93jdbc aria-label=使用数据库(JDBC)>使用数据库(JDBC)</a></li><li><a href=#using-userdetailsservice-%e4%bd%bf%e7%94%a8%e7%94%a8%e6%88%b7%e8%af%a6%e7%bb%86%e4%bf%a1%e6%81%af%e6%9c%8d%e5%8a%a1 aria-label="Using UserDetailsService 使用用户详细信息服务">Using UserDetailsService 使用用户详细信息服务</a></li></ul></li><li><a href=#%e5%9c%a8-spring-boot-%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f%e4%b8%ad%e5%ae%9e%e7%8e%b0-web-%e5%ae%89%e5%85%a8%e7%9a%84%e6%ad%a5%e9%aa%a4%e6%98%af%e4%bb%80%e4%b9%88 aria-label="在 Spring Boot 应用程序中实现 Web 安全的步骤是什么？">在 Spring Boot 应用程序中实现 Web 安全的步骤是什么？</a></li><li><a href=#%e5%a6%82%e4%bd%95%e5%ae%9e%e7%8e%b0%e5%86%85%e5%ad%98%e4%b8%ad%e8%ba%ab%e4%bb%bd%e9%aa%8c%e8%af%81%e5%ae%89%e5%85%a8%e6%80%a7%e7%9a%84%e7%a4%ba%e4%be%8b aria-label=如何实现内存中身份验证安全性的示例>如何实现内存中身份验证安全性的示例</a><ul><li><a href=#softwaretechnologies-used-%e4%bd%bf%e7%94%a8%e7%9a%84%e8%bd%af%e4%bb%b6%e6%8a%80%e6%9c%af aria-label="Software/Technologies Used 使用的软件/技术">Software/Technologies Used 使用的软件/技术</a></li><li><a href=#%e6%ad%a5%e9%aa%a41%e5%9c%a8-stsspring-tool-suite%e4%b8%ad%e5%88%9b%e5%bb%ba%e4%b8%80%e4%b8%aa-spring-boot-starter-%e9%a1%b9%e7%9b%ae aria-label="步骤#1：在 STS(Spring Tool Suite)中创建一个 Spring Boot Starter 项目">步骤#1：在 STS(Spring Tool Suite)中创建一个 Spring Boot Starter 项目</a></li><li><a href=#%e6%ad%a5%e9%aa%a42%e7%bc%96%e5%86%99%e6%8e%a7%e5%88%b6%e5%99%a8%e7%b1%bb aria-label=步骤#2：编写控制器类>步骤#2：编写控制器类</a></li><li><a href=#%e6%ad%a5%e9%aa%a43%e7%bc%96%e5%86%99-ui-%e9%a1%b5%e9%9d%a2-thymeleaf aria-label="步骤#3：编写 UI 页面 (Thymeleaf)">步骤#3：编写 UI 页面 (Thymeleaf)</a></li><li><a href=#%e6%ad%a5%e9%aa%a44%e7%bc%96%e5%86%99-securityconfig-%e7%b1%bb aria-label="步骤#4：编写 SecurityConfig 类">步骤#4：编写 SecurityConfig 类</a><ul><li><a href=#%e6%ad%a5%e9%aa%a44aspring-security-570-%e4%bb%a5%e4%b8%8b%e7%89%88%e6%9c%ac%e7%9a%84%e4%bb%a3%e7%a0%81 aria-label="步骤#4A：Spring Security 5.7.0 以下版本的代码">步骤#4A：Spring Security 5.7.0 以下版本的代码</a></li><li><a href=#%e6%ad%a5%e9%aa%a44bspring-security-57-%e4%bb%a5%e4%b8%8a%e7%89%88%e6%9c%ac%e5%92%8c-spring-security-60-%e4%bb%a5%e4%b8%8b%e7%89%88%e6%9c%ac%e7%9a%84%e4%bb%a3%e7%a0%81 aria-label="步骤#4B：Spring Security 5.7 以上版本和 Spring Security 6.0 以下版本的代码">步骤#4B：Spring Security 5.7 以上版本和 Spring Security 6.0 以下版本的代码</a></li><li><a href=#%e6%ad%a5%e9%aa%a44cspring-security-600-%e5%8f%8a%e6%9b%b4%e9%ab%98%e7%89%88%e6%9c%ac%e7%9a%84%e4%bb%a3%e7%a0%81spring-boot-30 aria-label="步骤#4C：Spring Security 6.0.0 及更高版本的代码（Spring Boot 3.0+）">步骤#4C：Spring Security 6.0.0 及更高版本的代码（Spring Boot 3.0+）</a></li></ul></li></ul></li><li><a href=#%e5%a6%82%e4%bd%95%e5%ae%9e%e7%8e%b0-jdbc-%e8%ba%ab%e4%bb%bd%e9%aa%8c%e8%af%81%e5%ae%89%e5%85%a8%e6%80%a7%e7%a4%ba%e4%be%8b aria-label="如何实现 JDBC 身份验证安全性示例">如何实现 JDBC 身份验证安全性示例</a><ul><li><a href=#%e4%bd%bf%e7%94%a8%e7%9a%84%e8%bd%af%e4%bb%b6%e6%8a%80%e6%9c%af aria-label=使用的软件/技术>使用的软件/技术</a></li><li><a href=#%e6%ad%a5%e9%aa%a41%e5%9c%a8%e6%95%b0%e6%8d%ae%e5%ba%93%e4%b8%ad%e6%8f%92%e5%85%a5%e4%b8%80%e4%ba%9b%e8%99%9a%e6%8b%9f%e8%ae%b0%e5%bd%95 aria-label=步骤#1：在数据库中插入一些虚拟记录>步骤#1：在数据库中插入一些虚拟记录</a><ul><li><a href=#%e6%ad%a5%e9%aa%a41a%e4%bd%bf%e7%94%a8-bcryptpasswordencoder-%e5%88%9b%e5%bb%ba%e7%bc%96%e7%a0%81%e5%af%86%e7%a0%81%e5%80%bc aria-label="步骤#1A：使用 BCryptPasswordEncoder 创建编码密码值">步骤#1A：使用 BCryptPasswordEncoder 创建编码密码值</a></li><li><a href=#%e6%ad%a5%e9%aa%a41b%e5%88%9b%e5%bb%ba%e6%95%b0%e6%8d%ae%e5%ba%93%e5%b9%b6%e6%8f%92%e5%85%a5%e8%99%9a%e6%8b%9f%e8%ae%b0%e5%bd%95 aria-label=步骤#1B：创建数据库并插入虚拟记录>步骤#1B：创建数据库并插入虚拟记录</a></li></ul></li><li><a href=#%e6%ad%a5%e9%aa%a42%e5%9c%a8-stsspring-tool-suite%e4%b8%ad%e5%88%9b%e5%bb%ba%e4%b8%80%e4%b8%aa-spring-boot-starter-%e9%a1%b9%e7%9b%ae aria-label="步骤#2：在 STS(Spring Tool Suite)中创建一个 Spring Boot Starter 项目">步骤#2：在 STS(Spring Tool Suite)中创建一个 Spring Boot Starter 项目</a></li><li><a href=#%e6%ad%a5%e9%aa%a43%e4%bb%8e%e4%b8%8a%e4%b8%80%e4%b8%aa%e7%a4%ba%e4%be%8b%e5%a4%8d%e5%88%b6%e6%8e%a7%e5%88%b6%e5%99%a8%e7%b1%bb%e5%92%8c-ui-%e9%a1%b5%e9%9d%a2 aria-label="步骤#3：从上一个示例复制控制器类和 UI 页面">步骤#3：从上一个示例复制控制器类和 UI 页面</a></li><li><a href=#%e6%ad%a5%e9%aa%a44%e5%88%9b%e5%bb%ba-appconfigjava-%e4%bb%a5%e5%88%9b%e5%bb%ba-bcryptpasswordencoder-%e5%af%b9%e8%b1%a1 aria-label="步骤#4：创建 AppConfig.java 以创建 BCryptPasswordEncoder 对象">步骤#4：创建 AppConfig.java 以创建 BCryptPasswordEncoder 对象</a></li><li><a href=#%e6%ad%a5%e9%aa%a45%e6%9b%b4%e6%96%b0-applicationproperties-%e6%96%87%e4%bb%b6%e4%b8%ad%e7%9a%84%e6%95%b0%e6%8d%ae%e5%ba%93%e5%b1%9e%e6%80%a7 aria-label="步骤#5：更新 application.properties 文件中的数据库属性">步骤#5：更新 application.properties 文件中的数据库属性</a></li><li><a href=#%e6%ad%a5%e9%aa%a46%e6%9b%b4%e6%96%b0-securityconfigjava aria-label="步骤#6：更新 SecurityConfig.java">步骤#6：更新 SecurityConfig.java</a><ul><li><a href=#%e6%ad%a5%e9%aa%a46aspring-security-570-%e4%bb%a5%e4%b8%8b%e7%89%88%e6%9c%ac%e7%9a%84%e4%bb%a3%e7%a0%81 aria-label="步骤#6A：Spring Security 5.7.0 以下版本的代码">步骤#6A：Spring Security 5.7.0 以下版本的代码</a></li><li><a href=#%e6%ad%a5%e9%aa%a46bspring-security-570-%e4%bb%a5%e4%b8%8a%e7%89%88%e6%9c%ac%e5%92%8c-spring-security-600-%e4%bb%a5%e4%b8%8b%e7%89%88%e6%9c%ac%e7%9a%84%e4%bb%a3%e7%a0%81 aria-label="步骤#6B：Spring Security 5.7.0 以上版本和 Spring Security 6.0.0 以下版本的代码">步骤#6B：Spring Security 5.7.0 以上版本和 Spring Security 6.0.0 以下版本的代码</a></li><li><a href=#%e6%ad%a5%e9%aa%a46cspring-security-600-%e5%8f%8a%e6%9b%b4%e9%ab%98%e7%89%88%e6%9c%ac%e7%9a%84%e4%bb%a3%e7%a0%81spring-boot-30 aria-label="步骤#6C：Spring Security 6.0.0 及更高版本的代码（Spring Boot 3.0+）">步骤#6C：Spring Security 6.0.0 及更高版本的代码（Spring Boot 3.0+）</a></li></ul></li></ul></li><li><a href=#%e5%a6%82%e4%bd%95%e6%b5%8b%e8%af%95%e5%90%af%e7%94%a8%e5%ae%89%e5%85%a8%e7%9a%84%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f aria-label=如何测试启用安全的应用程序？>如何测试启用安全的应用程序？</a></li><li><a href=#spring-boot-%e9%a1%b9%e7%9b%ae%e5%a6%82%e4%bd%95%e5%ae%9e%e7%8e%b0%e5%ae%89%e5%85%a8%e6%80%a7-spring-boot-30-%e5%8f%8a%e4%bb%a5%e4%b8%8a aria-label="Spring Boot 项目如何实现安全性？ ：Spring Boot 3.0 及以上">Spring Boot 项目如何实现安全性？ ：Spring Boot 3.0 及以上</a></li><li><a href=#faq aria-label=FAQ>FAQ</a><ul><li><a href=#%e5%a6%82%e4%bd%95%e7%a6%81%e7%94%a8%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f%e7%9a%84%e5%ae%89%e5%85%a8%e5%8a%9f%e8%83%bd aria-label=如何禁用应用程序的安全功能？>如何禁用应用程序的安全功能？</a></li></ul></li><li><a href=#%e6%a6%82%e6%8b%ac aria-label=概括>概括</a></li></ul></div></details></div><div class=post-content><p><img loading=lazy src="https://javatechonline.com/ezoimgfmt/i0.wp.com/javatechonline.com/wp-content/uploads/2020/11/SpringSecurityBasics-1.jpg?resize=550%2C525&amp;is-pending-load=1#038;ssl=1&amp;ezimgfmt=rs:550x525/rscb4/ngcb3/notWebP" alt="How to implement Security in Spring Boot Project?"></p><p>如今，几乎每个客户都要求在实时应用程序中实现强大的安全功能。安全功能对于保持机密性、完整性和可用性的需求是非常有效的。现实世界中有很多类型的安全性，但我们作为开发人员将重点关注应用程序/软件安全性。</p><p>此外，在应用程序安全方面，我们的工作基本上是确保两件事。首先，只有有效的用户才能访问该应用程序。其次，如果用户有效，他/她只能访问该应用程序中允许的数据/信息。我认为，没有什么可以解释它们，因为您必须已经了解这两个术语，即身份验证和授权。</p><p>您可能已经猜到我们将在当前主题“如何在 Spring Boot 项目中实现安全性？”中讨论什么内容。</p><p>在本文中，我们将从基本原理开始学习。接下来，我们将逐步结束它，直到我们有信心在 Spring Boot 应用程序中实现安全功能。因此，让我们开始逐步讨论“如何在 Spring Boot 项目中实现安全性？”。 Spring Boot 教程页面上有一系列有关 <a href=https://javatechonline.com/spring-boot-tutorial/#Spring_Boot_Security>Spring Boot Security 的教程</a>。</p><p>我们在本文中介绍了两个版本的“如何在 Spring Boot 项目中实现安全性？”的示例：使用 WebSecurityConfigurerAdapter 和不使用 WebSecurityConfigurerAdapter。此外，还涵盖了使用 Spring Boot 3.0 及更高版本的“如何在 Spring Boot 项目中实现安全性？”的示例。</p><h2 id=您将从本文中学到什么>您将从本文中学到什么？</h2><ol><li><p>为什么我们需要在 Spring Boot 应用程序中实现安全性？</p></li><li><p>Security 在 Spring Boot 应用程序内部如何工作？</p></li><li><p>javax.servlet.Filter 在 Spring Boot 应用程序中实现安全性方面的作用是什么？</p></li><li><p>Spring Boot 项目中使用了多少种授权类型？</p></li><li><p>Spring Boot 项目中有多少种实现安全性的方法？</p></li><li><p>在 Spring Boot 项目中实现 WebSecurity 的步骤是什么？</p></li><li><p>另外，如何在 Spring Boot 项目中使用@EnableWebSecurity、@Configuration、@Bean？</p></li><li><p>如何实现内存中身份验证安全示例</p></li><li><p>如何实现 JDBC 认证安全示例</p></li><li><p>如何在 Spring Boot 项目中使用 Thymeleaf ？</p></li><li><p>如何测试启用安全的功能？</p></li><li><p>相反，如何禁用应用程序的安全功能？</p></li><li><p>最后但并非最不重要的一点是，您将学习“如何在 Spring Boot 项目中实现安全性？”使用 WebSecurityConfigurerAdapter 和不使用 WebSecurityConfigurerAdapter。</p></li></ol><h2 id=为什么我们需要应用程序中的安全性>为什么我们需要应用程序中的安全性？</h2><p>现在，随着恶意攻击将重点从操作系统和网络转移到应用程序/软件和移动设备/设备，一天的数据面临最大的风险。此外，从业务/客户的角度来看，应用程序安全在维护信任、建立品牌形象和降低风险方面发挥着重要作用。事实上，没有其中任何一项，都无法想象一家成功的企业。</p><p>总之，无论您是为了内部使用、销售目的还是购买目的而创建应用程序，安全性都是每个应用程序最重要的功能。</p><p>根据最新的 2020 年 Verizon 数据泄露调查报告，所有数据泄露中有 43% 是针对 Web 应用程序的攻击。这一数字比 2019 年增加了一倍。此外，86% 的违规行为都是出于经济动机。</p><h2 id=spring-boot-应用程序内部安全性如何工作>Spring Boot 应用程序内部安全性如何工作？</h2><p>从根本上来说，Spring Security 的工作原理是 JAAS（Java 身份验证和授权服务）。简而言之，它适用于 Filter (javax.servlet.Filter) 概念。我们都知道，如果我们想在 servlet 请求之前应用一些预处理逻辑，可以使用过滤器。同样的概念也被应用于在 Spring boot 项目中实现安全功能。</p><p>DelegatingFilterProxy 是 Spring Security 模块提供的 org.springframework.web.filter 包下的预定义类，在这里充当过滤器。</p><p>如下图所示，当用户向应用程序发送请求时，请求会先经过安全过滤器，然后再发送给 DispatcherServlet。如果用户验证此过滤器的安全性，则只有请求才会发送到 DispatcherServlet 来满足用户的目的。</p><p><img loading=lazy src=https://i0.wp.com/javatechonline.com/wp-content/uploads/2020/11/SpringSecurity1-1-1.jpg alt=img></p><h2 id=spring-boot-应用程序使用了多少种授权类型>Spring Boot 应用程序使用了多少种授权类型？</h2><p>有四种最常用的授权实现类型。他们是 ：</p><h3 id=1-permitall-允许全部>1) permitAll 允许全部</h3><p>PermitAll 表示无需任何授权即可访问当前页面。</p><p>示例 URL：/login、/home、/contactUs、/aboutUs ..等。</p><h3 id=2-authenticated-已认证>2) authenticated 已认证</h3><p>它表示需要登录（用户名/密码）并且不需要授权（基于角色的访问）。</p><p>示例 URL：/updateUserDetails、/inbox、/settings 等。</p><h3 id=3-hasauthority>3) hasAuthority</h3><p>hasAuthority 表示用户应该具有身份验证和基于角色的授权访问权限。</p><p>示例 URL+role：/approveRequest + MANAGER、/blockUser + ADMIN、/addUser + ADMIN …等。</p><h3 id=4-hasanyauthority-有任何权限>4) hasAnyAuthority 有任何权限</h3><p>它表示用户应该具有身份验证和基于多个角色的授权访问。就像经理和人力资源这两个角色都可以访问特定页面。
示例 URLs+role: /approveRequest + (MANAGER & HR)</p><h2 id=在-spring-boot-web-应用程序中实现安全性有哪些不同的方法>在 Spring Boot Web 应用程序中实现安全性有哪些不同的方法？</h2><p>简而言之，在 Spring Boot Web 应用程序中实现安全性有三种最常见的方法。他们是</p><h3 id=in-memory-security-内存安全>In-Memory Security 内存安全</h3><p>在这种类型的实现中，我们将数据存储在 RAM（内存中）中，并在有请求时验证数据。我们在测试或开发环境中使用这种方法。在生产应用中不建议使用此方法。</p><h3 id=使用数据库jdbc>使用数据库(JDBC)</h3><p>在这种类型的实现中，我们将数据存储在数据库中，并在请求到来时验证数据/登录。但它是基于程序员提供的 SQL 查询来工作的。</p><h3 id=using-userdetailsservice-使用用户详细信息服务>Using UserDetailsService 使用用户详细信息服务</h3><p>我们将数据存储在数据库中，并在请求到来时验证数据。但 UserDetailsS​​ervice 是基于 ORM（Spring Data JPA）工作的。简而言之，UserDetailsS​​ervice 是 Spring Security 模块提供的一个接口。在登录表单中输入用户名后，当我们单击登录按钮时，将调用该服务。随后，它根据提供的用户名找到用户。它包含一个方法 loadUserByUsername(String username) 返回 UserDetails 对象。此外，UserDetails 对象为我们提供了用户名。</p><h2 id=在-spring-boot-应用程序中实现-web-安全的步骤是什么>在 Spring Boot 应用程序中实现 Web 安全的步骤是什么？</h2><p>以下是步骤：</p><p><img loading=lazy src="https://javatechonline.com/ezoimgfmt/i0.wp.com/javatechonline.com/wp-content/uploads/2020/11/SpringSecurity2-1-1.jpg?resize=640%2C303&amp;is-pending-load=1#038;ssl=1&amp;ezimgfmt=rs:640x303/rscb4/ng:webp/ngcb3" alt=SpringSecurity2></p><ol><li><p>编写一个类“SecurityConfig.java”，它扩展了预定义的抽象类 WebSecurityConfigurerAdapter.java</p></li><li><p>在“SecurityConfig.java”之上相应地应用注释@Configuration 和@EnableWebSecurity。不用说，注释@EnableWebSecurity 是为了在 Web 应用程序中启用安全功能。</p></li><li><p>覆盖下面两种方法同时实现身份验证和授权逻辑。</p></li></ol><ul><li>configure(AuthenticationManagerBuilder auth)</li><li>configure(HttpSecurity http)</li></ul><ol start=4><li><p>此外，通过使用@Autowired（如 DataSource、BCryptPasswordEncoder 等）注入其他对象依赖项（如果有），并在需要的地方使用它们。</p></li><li><p>同样重要的是，根据需要编写控制器类和视图页面。</p></li><li><p>最后，如果您不实施内存中身份验证，请更新 application.properties 文件中的数据库属性。</p></li></ol><p>注意：从 Spring Security 5.7.0-M2 开始，WebSecurityConfigurerAdapter 已被弃用。为了了解实现自定义配置类的新方法，请访问有关<a href=https://javatechonline.com/spring-security-without-websecurityconfigureradapter/>不使用 WebSecurityConfigurerAdapter 的 Spring Security</a> 的单独文章。</p><h2 id=如何实现内存中身份验证安全性的示例>如何实现内存中身份验证安全性的示例</h2><p>例如，让我们考虑一个小型组织的应用程序，其中我们有三个角色：员工、经理和管理员。此外，我们将对某些特定页面进行基于角色的限制访问。一方面，某些页面可供多个角色访问，另一方面，某些页面没有限制（所有角色均可访问）。此外，我们将使用 thymeleaf 来创建页面。此外，我们将有一个控制器类来满足用户的请求。</p><h3 id=softwaretechnologies-used-使用的软件技术>Software/Technologies Used 使用的软件/技术</h3><ul><li>STS (Spring Tool Suite) : Version-> 4.7.1.RELEASE</li><li>JDK14 (JDK8 or later versions are sufficient)</li></ul><h3 id=步骤1在-stsspring-tool-suite中创建一个-spring-boot-starter-项目>步骤#1：在 STS(Spring Tool Suite)中创建一个 Spring Boot Starter 项目</h3><p>创建入门项目时，选择“Spring Security”、“Thymeleaf”、“Spring Web”和“Spring Boot DevTools”作为入门项目依赖项。要了解“如何创建 Spring Boot Starter 项目？”，请访问<a href=https://javatechonline.com/saving-data-into-database-using-spring-boot-data-jpa-step-by-step-tutorial/#Step_1_Creating_Starter_Project_using_STS>内部链接</a>。</p><h3 id=步骤2编写控制器类>步骤#2：编写控制器类</h3><p>请检查以下代码作为控制器类。</p><p>HomeController.java</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>com.dev.springboot.security.controller</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.stereotype.Controller</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.web.bind.annotation.GetMapping</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Controller</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>HomeController</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@GetMapping</span><span class=o>(</span><span class=s>&#34;/home&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>String</span> <span class=nf>getHomePage</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=s>&#34;homePage&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@GetMapping</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>String</span> <span class=nf>getWelcomePage</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=s>&#34;welcomePage&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@GetMapping</span><span class=o>(</span><span class=s>&#34;/admin&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>String</span> <span class=nf>getAdminPage</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=s>&#34;adminPage&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@GetMapping</span><span class=o>(</span><span class=s>&#34;/emp&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>String</span> <span class=nf>getEmployeePage</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=s>&#34;empPage&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@GetMapping</span><span class=o>(</span><span class=s>&#34;/mgr&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>String</span> <span class=nf>getManagerPage</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=s>&#34;mgrPage&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@GetMapping</span><span class=o>(</span><span class=s>&#34;/common&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>String</span> <span class=nf>getCommonPage</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=s>&#34;commonPage&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@GetMapping</span><span class=o>(</span><span class=s>&#34;/accessDenied&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>String</span> <span class=nf>getAccessDeniedPage</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=s>&#34;accessDeniedPage&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h3 id=步骤3编写-ui-页面-thymeleaf>步骤#3：编写 UI 页面 (Thymeleaf)</h3><p>以下文件是 UI 页面。因此，仅将它们放在“src/main/resources/templates”文件夹中。</p><p>homepage.html</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span> <span class=na>xmlns:th</span><span class=o>=</span><span class=s>&#34;http://www.thymeleaf.org&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;ISO-8859-1&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Insert title here<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span>welcome to Home Page<span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    This page is accessible to ALL.
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>welcomePage.html</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span> <span class=na>xmlns:th</span><span class=o>=</span><span class=s>&#34;http://www.thymeleaf.org&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;ISO-8859-1&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Insert title here<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span>Welcome Page after successful Login<span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>a</span> <span class=na>th:href</span><span class=o>=</span><span class=s>&#34;@{/logout}&#34;</span><span class=p>&gt;</span>LOGOUT<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>adminPage.html</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span> <span class=na>xmlns:th</span><span class=o>=</span><span class=s>&#34;http://www.thymeleaf.org&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;ISO-8859-1&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Insert title here<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span>Admin Page<span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    Only Admins are allowed to access this page.!!!
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>a</span> <span class=na>th:href</span><span class=o>=</span><span class=s>&#34;@{/logout}&#34;</span><span class=p>&gt;</span>LOGOUT<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>empPage.html</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span> <span class=na>xmlns:th</span><span class=o>=</span><span class=s>&#34;http://www.thymeleaf.org&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;ISO-8859-1&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Insert title here<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span>Employee Page<span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>a</span> <span class=na>th:href</span><span class=o>=</span><span class=s>&#34;@{/logout}&#34;</span><span class=p>&gt;</span>LOGOUT<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>mgrPage.html</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span> <span class=na>xmlns:th</span><span class=o>=</span><span class=s>&#34;http://www.thymeleaf.org&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;ISO-8859-1&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Insert title here<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span>Manager Page<span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>a</span> <span class=na>th:href</span><span class=o>=</span><span class=s>&#34;@{/logout}&#34;</span><span class=p>&gt;</span>LOGOUT<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>commonPage.html</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span> <span class=na>xmlns:th</span><span class=o>=</span><span class=s>&#34;http://www.thymeleaf.org&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;ISO-8859-1&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Insert title here<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span>COMMON Page<span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    Both Manager <span class=err>&amp;</span> Employee are allowed to access this page. !
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>a</span> <span class=na>th:href</span><span class=o>=</span><span class=s>&#34;@{/logout}&#34;</span><span class=p>&gt;</span>LOGOUT<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>accessDeniedPage.html</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span> <span class=na>xmlns:th</span><span class=o>=</span><span class=s>&#34;http://www.thymeleaf.org&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meta</span> <span class=na>charset</span><span class=o>=</span><span class=s>&#34;ISO-8859-1&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Insert title here<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>h3</span><span class=p>&gt;</span>You are not allowed to access this page. Please go to Welcome Page<span class=p>&lt;/</span><span class=nt>h3</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>a</span> <span class=na>th:href</span><span class=o>=</span><span class=s>&#34;@{/welcome}&#34;</span><span class=p>&gt;</span>Welcome<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>a</span> <span class=na>th:href</span><span class=o>=</span><span class=s>&#34;@{/logout}&#34;</span><span class=p>&gt;</span>LOGOUT<span class=p>&lt;/</span><span class=nt>a</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><h3 id=步骤4编写-securityconfig-类>步骤#4：编写 SecurityConfig 类</h3><p>此类对于实现包含所有安全相关逻辑的安全功能而言是最重要的。如下面的代码示例所示，如果我们不想对密码进行编码，我们可以在密码值之前使用“{noop}”。</p><h4 id=步骤4aspring-security-570-以下版本的代码>步骤#4A：Spring Security 5.7.0 以下版本的代码</h4><p>SecurityConfig.java</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>com.dev.springboot.security</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.context.annotation.Configuration</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.configuration.EnableWebSecurity</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.web.util.matcher.AntPathRequestMatcher</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Configuration</span>
</span></span><span class=line><span class=cl><span class=nd>@EnableWebSecurity</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SecurityConfig</span> <span class=kd>extends</span> <span class=n>WebSecurityConfigurerAdapter</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Override</span>
</span></span><span class=line><span class=cl>	<span class=kd>protected</span> <span class=kt>void</span> <span class=nf>configure</span><span class=o>(</span><span class=n>AuthenticationManagerBuilder</span> <span class=n>auth</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=c1>// {noop} =&gt; No operation for password encoder	(no password encoding needed)
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=n>auth</span><span class=o>.</span><span class=na>inMemoryAuthentication</span><span class=o>().</span><span class=na>withUser</span><span class=o>(</span><span class=s>&#34;devs&#34;</span><span class=o>).</span><span class=na>password</span><span class=o>(</span><span class=s>&#34;{noop}devs&#34;</span><span class=o>).</span><span class=na>authorities</span><span class=o>(</span><span class=s>&#34;ADMIN&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>auth</span><span class=o>.</span><span class=na>inMemoryAuthentication</span><span class=o>().</span><span class=na>withUser</span><span class=o>(</span><span class=s>&#34;ns&#34;</span><span class=o>).</span><span class=na>password</span><span class=o>(</span><span class=s>&#34;{noop}ns&#34;</span><span class=o>).</span><span class=na>authorities</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>auth</span><span class=o>.</span><span class=na>inMemoryAuthentication</span><span class=o>().</span><span class=na>withUser</span><span class=o>(</span><span class=s>&#34;vs&#34;</span><span class=o>).</span><span class=na>password</span><span class=o>(</span><span class=s>&#34;{noop}vs&#34;</span><span class=o>).</span><span class=na>authorities</span><span class=o>(</span><span class=s>&#34;MANAGER&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Override</span>
</span></span><span class=line><span class=cl>	<span class=kd>protected</span> <span class=kt>void</span> <span class=nf>configure</span><span class=o>(</span><span class=n>HttpSecurity</span> <span class=n>http</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=c1>//declares which Page(URL) will have What access type
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=n>http</span><span class=o>.</span><span class=na>authorizeRequests</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/home&#34;</span><span class=o>).</span><span class=na>permitAll</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>).</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/admin&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;ADMIN&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/emp&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/mgr&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;MANAGER&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/common&#34;</span><span class=o>).</span><span class=na>hasAnyAuthority</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>,</span><span class=s>&#34;MANAGER&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=c1>// Any other URLs which are not configured in above antMatchers
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=c1>// generally declared aunthenticated() in real time
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=o>.</span><span class=na>anyRequest</span><span class=o>().</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=c1>//Login Form Details
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>formLogin</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>defaultSuccessUrl</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>,</span> <span class=kc>true</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=c1>//Logout Form Details
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>logout</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>logoutRequestMatcher</span><span class=o>(</span><span class=k>new</span> <span class=n>AntPathRequestMatcher</span><span class=o>(</span><span class=s>&#34;/logout&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=c1>//Exception Details
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>exceptionHandling</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>accessDeniedPage</span><span class=o>(</span><span class=s>&#34;/accessDenied&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h4 id=步骤4bspring-security-57-以上版本和-spring-security-60-以下版本的代码>步骤#4B：Spring Security 5.7 以上版本和 Spring Security 6.0 以下版本的代码</h4><p>由于<a href=https://javatechonline.com/spring-security-without-websecurityconfigureradapter/>根据 Spring 官网发布的公告</a>，WebSecurityConfigurerAdapter 已从 Spring Security 5.7.0-M2 中弃用，因此，2022 年 2 月 21 日，我们将不使用 WebSecurityConfigurerAdapter 来编写 SecurityConfig 类，如下所示：</p><p>SecurityConfig.java</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>com.dev.springboot.security</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.ArrayList</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.List</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.context.annotation.Bean</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.context.annotation.Configuration</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.configuration.EnableWebSecurity</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.core.GrantedAuthority</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.core.authority.SimpleGrantedAuthority</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.core.userdetails.User</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.core.userdetails.UserDetails</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.provisioning.InMemoryUserDetailsManager</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.web.SecurityFilterChain</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.web.util.matcher.AntPathRequestMatcher</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Configuration</span>
</span></span><span class=line><span class=cl><span class=nd>@EnableWebSecurity</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SecurityConfig</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Bean</span>
</span></span><span class=line><span class=cl>	<span class=kd>protected</span> <span class=n>InMemoryUserDetailsManager</span> <span class=nf>configAuthentication</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=n>List</span><span class=o>&lt;</span><span class=n>UserDetails</span><span class=o>&gt;</span> <span class=n>users</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>		<span class=n>List</span><span class=o>&lt;</span><span class=n>GrantedAuthority</span><span class=o>&gt;</span> <span class=n>adminAuthority</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>		<span class=n>adminAuthority</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>new</span> <span class=n>SimpleGrantedAuthority</span><span class=o>(</span><span class=s>&#34;ADMIN&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>		<span class=n>UserDetails</span> <span class=n>admin</span><span class=o>=</span> <span class=k>new</span> <span class=n>User</span><span class=o>(</span><span class=s>&#34;devs&#34;</span><span class=o>,</span> <span class=s>&#34;{noop}devs&#34;</span><span class=o>,</span> <span class=n>adminAuthority</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>users</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>admin</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=n>List</span><span class=o>&lt;</span><span class=n>GrantedAuthority</span><span class=o>&gt;</span> <span class=n>employeeAuthority</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>		<span class=n>adminAuthority</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>new</span> <span class=n>SimpleGrantedAuthority</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>		<span class=n>UserDetails</span> <span class=n>employee</span><span class=o>=</span> <span class=k>new</span> <span class=n>User</span><span class=o>(</span><span class=s>&#34;ns&#34;</span><span class=o>,</span> <span class=s>&#34;{noop}ns&#34;</span><span class=o>,</span> <span class=n>employeeAuthority</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>users</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>employee</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=n>List</span><span class=o>&lt;</span><span class=n>GrantedAuthority</span><span class=o>&gt;</span> <span class=n>managerAuthority</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>		<span class=n>adminAuthority</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>new</span> <span class=n>SimpleGrantedAuthority</span><span class=o>(</span><span class=s>&#34;MANAGER&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>		<span class=n>UserDetails</span> <span class=n>manager</span><span class=o>=</span> <span class=k>new</span> <span class=n>User</span><span class=o>(</span><span class=s>&#34;vs&#34;</span><span class=o>,</span> <span class=s>&#34;{noop}vs&#34;</span><span class=o>,</span> <span class=n>managerAuthority</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>users</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>manager</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=k>new</span> <span class=n>InMemoryUserDetailsManager</span><span class=o>(</span><span class=n>users</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Bean</span>
</span></span><span class=line><span class=cl>	<span class=kd>protected</span> <span class=n>SecurityFilterChain</span> <span class=nf>filterChain</span><span class=o>(</span><span class=n>HttpSecurity</span> <span class=n>http</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=c1>//declares which Page(URL) will have What access type
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=n>http</span><span class=o>.</span><span class=na>authorizeRequests</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/home&#34;</span><span class=o>).</span><span class=na>permitAll</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>).</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/admin&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;ADMIN&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/emp&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/mgr&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;MANAGER&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/common&#34;</span><span class=o>).</span><span class=na>hasAnyAuthority</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>,</span><span class=s>&#34;MANAGER&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=c1>// Any other URLs which are not configured in above antMatchers
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=c1>// generally declared aunthenticated() in real time
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=o>.</span><span class=na>anyRequest</span><span class=o>().</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=c1>//Login Form Details
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>formLogin</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>defaultSuccessUrl</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>,</span> <span class=kc>true</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=c1>//Logout Form Details
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>logout</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>logoutRequestMatcher</span><span class=o>(</span><span class=k>new</span> <span class=n>AntPathRequestMatcher</span><span class=o>(</span><span class=s>&#34;/logout&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=c1>//Exception Details
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>exceptionHandling</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>accessDeniedPage</span><span class=o>(</span><span class=s>&#34;/accessDenied&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>http</span><span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h4 id=步骤4cspring-security-600-及更高版本的代码spring-boot-30>步骤#4C：Spring Security 6.0.0 及更高版本的代码（Spring Boot 3.0+）</h4><p>从 Spring Security 6.0（2022 年 11 月发布）开始，WebSecurityConfigurerAdapter 已从 Spring Security API 中完全删除。它还影响了 2022 年 11 月<a href=https://javatechonline.com/new-features-in-spring-boot-3-and-spring-6/>新发布的 Spring Boot 3.0</a>。因此，如果您使用 Spring Framework 6.0+ 或 Spring Boot 3.0+，无论哪种情况，SecurityConfig.java 的实现应如下所示。此外，您还可以检查<a href=https://javatechonline.com/how-to-migrate-spring-boot-2-to-spring-boot-3/#Review_Specific_to_Spring_Security_Dependency>Spring Framework 6.0 中与 Spring Security 相关的更改</a>。</p><p>SecurityConfig.java</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>com.dev.springboot.security</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.ArrayList</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.List</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.context.annotation.Bean</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.context.annotation.Configuration</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.configuration.EnableWebSecurity</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.core.GrantedAuthority</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.core.authority.SimpleGrantedAuthority</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.core.userdetails.User</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.core.userdetails.UserDetails</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.provisioning.InMemoryUserDetailsManager</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.web.SecurityFilterChain</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.web.util.matcher.AntPathRequestMatcher</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Configuration</span>
</span></span><span class=line><span class=cl><span class=nd>@EnableWebSecurity</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SecurityConfig</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Bean</span>
</span></span><span class=line><span class=cl>	<span class=kd>protected</span> <span class=n>InMemoryUserDetailsManager</span> <span class=nf>configAuthentication</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=n>List</span><span class=o>&lt;</span><span class=n>UserDetails</span><span class=o>&gt;</span> <span class=n>users</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>		<span class=n>List</span><span class=o>&lt;</span><span class=n>GrantedAuthority</span><span class=o>&gt;</span> <span class=n>adminAuthority</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>		<span class=n>adminAuthority</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>new</span> <span class=n>SimpleGrantedAuthority</span><span class=o>(</span><span class=s>&#34;ADMIN&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>		<span class=n>UserDetails</span> <span class=n>admin</span><span class=o>=</span> <span class=k>new</span> <span class=n>User</span><span class=o>(</span><span class=s>&#34;devs&#34;</span><span class=o>,</span> <span class=s>&#34;{noop}devs&#34;</span><span class=o>,</span> <span class=n>adminAuthority</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>users</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>admin</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=n>List</span><span class=o>&lt;</span><span class=n>GrantedAuthority</span><span class=o>&gt;</span> <span class=n>employeeAuthority</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>		<span class=n>adminAuthority</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>new</span> <span class=n>SimpleGrantedAuthority</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>		<span class=n>UserDetails</span> <span class=n>employee</span><span class=o>=</span> <span class=k>new</span> <span class=n>User</span><span class=o>(</span><span class=s>&#34;ns&#34;</span><span class=o>,</span> <span class=s>&#34;{noop}ns&#34;</span><span class=o>,</span> <span class=n>employeeAuthority</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>users</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>employee</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=n>List</span><span class=o>&lt;</span><span class=n>GrantedAuthority</span><span class=o>&gt;</span> <span class=n>managerAuthority</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>		<span class=n>adminAuthority</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>new</span> <span class=n>SimpleGrantedAuthority</span><span class=o>(</span><span class=s>&#34;MANAGER&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>		<span class=n>UserDetails</span> <span class=n>manager</span><span class=o>=</span> <span class=k>new</span> <span class=n>User</span><span class=o>(</span><span class=s>&#34;vs&#34;</span><span class=o>,</span> <span class=s>&#34;{noop}vs&#34;</span><span class=o>,</span> <span class=n>managerAuthority</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>users</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>manager</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=k>new</span> <span class=n>InMemoryUserDetailsManager</span><span class=o>(</span><span class=n>users</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Bean</span>
</span></span><span class=line><span class=cl>	<span class=kd>protected</span> <span class=n>SecurityFilterChain</span> <span class=nf>filterChain</span><span class=o>(</span><span class=n>HttpSecurity</span> <span class=n>http</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=c1>//declares which Page(URL) will have What access type
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=n>http</span><span class=o>.</span><span class=na>authorizeHttpRequests</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>requestMatchers</span><span class=o>(</span><span class=s>&#34;/home&#34;</span><span class=o>).</span><span class=na>permitAll</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>requestMatchers</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>).</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>requestMatchers</span><span class=o>(</span><span class=s>&#34;/admin&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;ADMIN&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>requestMatchers</span><span class=o>(</span><span class=s>&#34;/emp&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>requestMatchers</span><span class=o>(</span><span class=s>&#34;/mgr&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;MANAGER&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>requestMatchers</span><span class=o>(</span><span class=s>&#34;/common&#34;</span><span class=o>).</span><span class=na>hasAnyAuthority</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>,</span><span class=s>&#34;MANAGER&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=c1>// Any other URLs which are not configured in above antMatchers
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=c1>// generally declared aunthenticated() in real time
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=o>.</span><span class=na>anyRequest</span><span class=o>().</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=c1>//Login Form Details
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>formLogin</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>defaultSuccessUrl</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>,</span> <span class=kc>true</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=c1>//Logout Form Details
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>logout</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>logoutRequestMatcher</span><span class=o>(</span><span class=k>new</span> <span class=n>AntPathRequestMatcher</span><span class=o>(</span><span class=s>&#34;/logout&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=c1>//Exception Details
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>exceptionHandling</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>accessDeniedPage</span><span class=o>(</span><span class=s>&#34;/accessDenied&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>http</span><span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>注意：在上面的代码中，观察 Spring Security 6.0 中的 API 变化：antMatchers()被 requestMatchers()替换，authorizeRequests()被 authorizeHttpRequests()替换。</p><p>您的项目结构将如下图所示。</p><p><img loading=lazy src=https://i0.wp.com/javatechonline.com/wp-content/uploads/2020/11/SpringSecurity5.jpg alt=img></p><h2 id=如何实现-jdbc-身份验证安全性示例>如何实现 JDBC 身份验证安全性示例</h2><p>在这种身份验证方法中，我们根据数据库中的现有值验证凭据和角色。此外，在此示例中，我们还将研究密码加密逻辑。首先，我们将在数据库中插入一些虚拟数据，然后相应地测试安全功能。归根结底，如果我们比较前面示例的功能，我们将把用户凭据和角色保存到数据库而不是 RAM 中。</p><p>此外，在此示例中，我们将提供用于实现密码加密逻辑的附加代码。因此，上一个示例中的所有文件在此示例中也将有效。</p><p>此外，我们将有一个配置类来创建 BCryptPasswordEncoder 对象来对密码进行编码，并在 application.properties 中创建数据库属性条目以连接数据库。不用说，SecurityConfig 类的实现这次会有所不同。</p><h3 id=使用的软件技术>使用的软件/技术</h3><ul><li>STS (Spring Tool Suite) : Version-> 4.7.1.RELEASE</li><li>MySQL Database : Version ->8.0.19 MySQL Community Server</li><li>JDK14 (JDK8 or later versions are sufficient)</li></ul><h3 id=步骤1在数据库中插入一些虚拟记录>步骤#1：在数据库中插入一些虚拟记录</h3><p>请注意，此步骤仅用于测试目的。如果您最近已经使用用户凭据和角色映射创建了数据库，请忽略此步骤。在步骤#1A 中，我们将创建一些密码编码值，然后在步骤#1B 中将它们插入到数据库中。</p><h4 id=步骤1a使用-bcryptpasswordencoder-创建编码密码值>步骤#1A：使用 BCryptPasswordEncoder 创建编码密码值</h4><p>我们将使用 BCryptPasswordEncoder 生成一些编码密码值，如下所示</p><p>BCryptPasswordEncoderTest.java</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>com.dev.springboot.security.util</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>BCryptPasswordEncoderTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=n>BCryptPasswordEncoder</span> <span class=n>bpe</span> <span class=o>=</span> <span class=k>new</span> <span class=n>BCryptPasswordEncoder</span><span class=o>();</span>
</span></span><span class=line><span class=cl>		<span class=n>String</span> <span class=n>encodedPWD</span> <span class=o>=</span> <span class=n>bpe</span><span class=o>.</span><span class=na>encode</span><span class=o>(</span><span class=s>&#34;devs@A!5003&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>encodedPWD</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>输出</p><pre tabindex=0><code>$2a$10$qnOB2PH1CqRvw8f5epvHzOlrounRkVGi.Y5ho6ENdmj/C1DmPdAsy
</code></pre><h4 id=步骤1b创建数据库并插入虚拟记录>步骤#1B：创建数据库并插入虚拟记录</h4><p>执行 MySQL DB 命令如下：</p><pre tabindex=0><code>To create the database as &#39;testbootsecurity&#39;
♦ create database testbootsecurity;
To take &#39;testbootsecurity&#39; in use:
♦ use testbootsecurity;
To create the user table:
♦ create table user (user_id int, user_name varchar(30), user_pwd varchar(100), user_role varchar(20), user_enabled int);
To check the description of user table:
♦ desc user;
INSERT INTO user values(501,&#39;devs&#39;,&#39;$2a$10$qnOB2PH1CqRvw8f5epvHzOlrounRkVGi.Y5ho6ENdmj/C1DmPdAsy&#39;,&#39;ADMIN&#39;,1);
INSERT INTO user values(502,&#39;ns&#39;,&#39;$2a$10$mmUMC5ZwoVnEQYV7/R6m.uWWtj7EiIo3lKasBObkOCc12huVUWpMC&#39;,&#39;EMPLOYEE&#39;,1);
INSERT INTO user values(503,&#39;vs&#39;,&#39;$2a$10$kqEC/fhQ7SNDhnncOQ9pb.yXXxJ/c7a1SQx2QPNZ.47fUmvF3Wb.i&#39;,&#39;MANAGER&#39;,1);
♦ select * from user;  (To check if values are inserted into DB)
</code></pre><p>此外，在实现 SecurityConfig.java 类的 configure(AuthenticationManagerBuilder auth) 方法时，我们将需要以下两个查询。</p><pre tabindex=0><code>Query#1 : Retrieve username,password,enabled using username ;

♦ select user_name,user_pwd,user_enabled from user where user_name=?;

Query#2 : Retrieve username,role using username;

♦ select user_name,user_role from user where user_name=?;
</code></pre><h3 id=步骤2在-stsspring-tool-suite中创建一个-spring-boot-starter-项目>步骤#2：在 STS(Spring Tool Suite)中创建一个 Spring Boot Starter 项目</h3><p>创建入门项目时，选择“Spring Security”、“Thymeleaf”、“Spring Web”、“JDBC API”、“MySQL Driver”和“Spring Boot DevTools”作为入门项目依赖项。</p><h3 id=步骤3从上一个示例复制控制器类和-ui-页面>步骤#3：从上一个示例复制控制器类和 UI 页面</h3><p>复制 HomeController.java 以及前面示例中的所有 thymeleaf 页面。</p><h3 id=步骤4创建-appconfigjava-以创建-bcryptpasswordencoder-对象>步骤#4：创建 AppConfig.java 以创建 BCryptPasswordEncoder 对象</h3><p>如下创建 AppConfig.java。在实现 SecurityConfig.java 类时，我们将需要 BCryptPasswordEncoder 对象。</p><p>AppConfig.java</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>com.dev.springboot.security.jdbc.config</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.context.annotation.Bean</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.context.annotation.Configuration</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Configuration</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>AppConfig</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Bean</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=n>BCryptPasswordEncoder</span> <span class=nf>encode</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=k>new</span> <span class=n>BCryptPasswordEncoder</span><span class=o>();</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h3 id=步骤5更新-applicationproperties-文件中的数据库属性>步骤#5：更新 application.properties 文件中的数据库属性</h3><p>更新 application.properties 以连接到 MySQL DB，如下所示。请注意，我们可以省略 driver-class-name，因为 Spring Boot 会自动从数据库 URL 中找到它。</p><pre tabindex=0><code>#application.properties
-------------------------------------------------------------------
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.url=jdbc:mysql://localhost:3306/testBootSecurity
spring.datasource.username=root
spring.datasource.password=devs
</code></pre><h3 id=步骤6更新-securityconfigjava>步骤#6：更新 SecurityConfig.java</h3><p>从前面的示例中复制 SecurityConfig.java 并更新 configure( AuthenticationManagerBuilder auth) 方法，如下所示。</p><h4 id=步骤6aspring-security-570-以下版本的代码>步骤#6A：Spring Security 5.7.0 以下版本的代码</h4><p>SecurityConfig.java</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>com.dev.springboot.security.jdbc.config</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>javax.sql.DataSource</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.beans.factory.annotation.Autowired</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.context.annotation.Configuration</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.configuration.EnableWebSecurity</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.web.util.matcher.AntPathRequestMatcher</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Configuration</span>
</span></span><span class=line><span class=cl><span class=nd>@EnableWebSecurity</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SecurityConfig</span> <span class=kd>extends</span> <span class=n>WebSecurityConfigurerAdapter</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Autowired</span>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=n>DataSource</span> <span class=n>dataSource</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Autowired</span>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=n>BCryptPasswordEncoder</span> <span class=n>passwordEncoder</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Override</span>
</span></span><span class=line><span class=cl>	<span class=kd>protected</span> <span class=kt>void</span> <span class=nf>configure</span><span class=o>(</span><span class=n>AuthenticationManagerBuilder</span> <span class=n>auth</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=n>auth</span><span class=o>.</span><span class=na>jdbcAuthentication</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>dataSource</span><span class=o>(</span><span class=n>dataSource</span><span class=o>)</span>     <span class=c1>//creates database connection
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=o>.</span><span class=na>usersByUsernameQuery</span><span class=o>(</span><span class=s>&#34;select user_name,user_pwd,user_enabled from user where user_name=?&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>authoritiesByUsernameQuery</span><span class=o>(</span><span class=s>&#34;select user_name,user_role from user where user_name=?&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>passwordEncoder</span><span class=o>(</span><span class=n>passwordEncoder</span><span class=o>);</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Override</span>
</span></span><span class=line><span class=cl>	<span class=kd>public</span> <span class=kt>void</span> <span class=nf>configure</span><span class=o>(</span><span class=n>HttpSecurity</span> <span class=n>http</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=n>http</span><span class=o>.</span><span class=na>authorizeRequests</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/home&#34;</span><span class=o>).</span><span class=na>permitAll</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>).</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/admin&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;ADMIN&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/emp&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/mgr&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;MANAGER&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>anyRequest</span><span class=o>().</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>formLogin</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>defaultSuccessUrl</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>,</span><span class=kc>true</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>logout</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>logoutRequestMatcher</span><span class=o>(</span><span class=k>new</span> <span class=n>AntPathRequestMatcher</span><span class=o>(</span><span class=s>&#34;/logout&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>exceptionHandling</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>accessDeniedPage</span><span class=o>(</span><span class=s>&#34;/accessDenied&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h4 id=步骤6bspring-security-570-以上版本和-spring-security-600-以下版本的代码>步骤#6B：Spring Security 5.7.0 以上版本和 Spring Security 6.0.0 以下版本的代码</h4><p>由于根据 Spring 官网发布的公告，<a href=https://javatechonline.com/spring-security-without-websecurityconfigureradapter/>WebSecurityConfigurerAdapter 已从 Spring Security 5.7.0-M2 中弃用</a>，因此，2022 年 2 月 21 日，我们将不使用 WebSecurityConfigurerAdapter 来编写 SecurityConfig 类，如下所示：</p><p>SecurityConfig.java</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>com.dev.springboot.security.jdbc.config</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>javax.sql.DataSource</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.beans.factory.annotation.Autowired</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.context.annotation.Bean</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.context.annotation.Configuration</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.configuration.EnableWebSecurity</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.core.userdetails.User</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.core.userdetails.UserDetails</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.crypto.factory.PasswordEncoderFactories</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.provisioning.JdbcUserDetailsManager</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.provisioning.UserDetailsManager</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.web.SecurityFilterChain</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.web.util.matcher.AntPathRequestMatcher</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Configuration</span>
</span></span><span class=line><span class=cl><span class=nd>@EnableWebSecurity</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SecurityConfig</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Autowired</span>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=n>DataSource</span> <span class=n>dataSource</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Autowired</span>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=n>BCryptPasswordEncoder</span> <span class=n>passwordEncoder</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Bean</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>UserDetailsManager</span> <span class=nf>authenticateUsers</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=n>UserDetails</span> <span class=n>user</span> <span class=o>=</span> <span class=n>User</span><span class=o>.</span><span class=na>withUsername</span><span class=o>(</span><span class=s>&#34;devs&#34;</span><span class=o>).</span>
</span></span><span class=line><span class=cl>				<span class=n>password</span><span class=o>(</span><span class=n>PasswordEncoderFactories</span><span class=o>.</span><span class=na>createDelegatingPasswordEncoder</span><span class=o>().</span><span class=na>encode</span><span class=o>(</span><span class=s>&#34;password&#34;</span><span class=o>)).</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>		<span class=n>JdbcUserDetailsManager</span> <span class=n>users</span> <span class=o>=</span> <span class=k>new</span> <span class=n>JdbcUserDetailsManager</span><span class=o>(</span><span class=n>dataSource</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>users</span><span class=o>.</span><span class=na>setAuthoritiesByUsernameQuery</span><span class=o>(</span><span class=s>&#34;select user_name,user_pwd,user_enabled from user where user_name=?&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>users</span><span class=o>.</span><span class=na>setUsersByUsernameQuery</span><span class=o>(</span><span class=s>&#34;select user_name,user_role from user where user_name=?&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>users</span><span class=o>.</span><span class=na>createUser</span><span class=o>(</span><span class=n>user</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>users</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Bean</span>
</span></span><span class=line><span class=cl>	<span class=kd>protected</span> <span class=n>SecurityFilterChain</span> <span class=nf>filterChain</span><span class=o>(</span><span class=n>HttpSecurity</span> <span class=n>http</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=n>http</span><span class=o>.</span><span class=na>authorizeRequests</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/home&#34;</span><span class=o>).</span><span class=na>permitAll</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>).</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/admin&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;ADMIN&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/emp&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/mgr&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;MANAGER&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>anyRequest</span><span class=o>().</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>formLogin</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>defaultSuccessUrl</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>,</span><span class=kc>true</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>logout</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>logoutRequestMatcher</span><span class=o>(</span><span class=k>new</span> <span class=n>AntPathRequestMatcher</span><span class=o>(</span><span class=s>&#34;/logout&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>exceptionHandling</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>accessDeniedPage</span><span class=o>(</span><span class=s>&#34;/accessDenied&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>;</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>http</span><span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h4 id=步骤6cspring-security-600-及更高版本的代码spring-boot-30>步骤#6C：Spring Security 6.0.0 及更高版本的代码（Spring Boot 3.0+）</h4><p>从 Spring Security 6.0（2022 年 11 月发布）开始，WebSecurityConfigurerAdapter 已从 Spring Security API 中完全删除。它还影响了 2022 年 11 月新发布的 Spring Boot 3.0。因此，如果您使用 Spring Framework 6.0+ 或 Spring Boot 3.0+，无论哪种情况，SecurityConfig.java 的实现应如下所示。此外，您还可以检查 Spring Framework 6.0 中与 Spring Security 相关的更改。</p><p>SecurityConfig.java</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span> <span class=nn>com.dev.springboot.security.jdbc.config</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>javax.sql.DataSource</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.beans.factory.annotation.Autowired</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.context.annotation.Bean</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.context.annotation.Configuration</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.configuration.EnableWebSecurity</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.core.userdetails.User</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.core.userdetails.UserDetails</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.crypto.factory.PasswordEncoderFactories</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.provisioning.JdbcUserDetailsManager</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.provisioning.UserDetailsManager</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.web.SecurityFilterChain</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.web.util.matcher.AntPathRequestMatcher</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Configuration</span>
</span></span><span class=line><span class=cl><span class=nd>@EnableWebSecurity</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SecurityConfig</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Autowired</span>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=n>DataSource</span> <span class=n>dataSource</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Autowired</span>
</span></span><span class=line><span class=cl>	<span class=kd>private</span> <span class=n>BCryptPasswordEncoder</span> <span class=n>passwordEncoder</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Bean</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>UserDetailsManager</span> <span class=nf>authenticateUsers</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=n>UserDetails</span> <span class=n>user</span> <span class=o>=</span> <span class=n>User</span><span class=o>.</span><span class=na>withUsername</span><span class=o>(</span><span class=s>&#34;devs&#34;</span><span class=o>).</span>
</span></span><span class=line><span class=cl>				<span class=n>password</span><span class=o>(</span><span class=n>PasswordEncoderFactories</span><span class=o>.</span><span class=na>createDelegatingPasswordEncoder</span><span class=o>().</span><span class=na>encode</span><span class=o>(</span><span class=s>&#34;password&#34;</span><span class=o>)).</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>		<span class=n>JdbcUserDetailsManager</span> <span class=n>users</span> <span class=o>=</span> <span class=k>new</span> <span class=n>JdbcUserDetailsManager</span><span class=o>(</span><span class=n>dataSource</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>users</span><span class=o>.</span><span class=na>setAuthoritiesByUsernameQuery</span><span class=o>(</span><span class=s>&#34;select user_name,user_pwd,user_enabled from user where user_name=?&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>users</span><span class=o>.</span><span class=na>setUsersByUsernameQuery</span><span class=o>(</span><span class=s>&#34;select user_name,user_role from user where user_name=?&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=n>users</span><span class=o>.</span><span class=na>createUser</span><span class=o>(</span><span class=n>user</span><span class=o>);</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>users</span><span class=o>;</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nd>@Bean</span>
</span></span><span class=line><span class=cl>	<span class=kd>protected</span> <span class=n>SecurityFilterChain</span> <span class=nf>filterChain</span><span class=o>(</span><span class=n>HttpSecurity</span> <span class=n>http</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=n>http</span><span class=o>.</span><span class=na>authorizeHttpRequests</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>requestMatchers</span><span class=o>(</span><span class=s>&#34;/home&#34;</span><span class=o>).</span><span class=na>permitAll</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>requestMatchers</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>).</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>requestMatchers</span><span class=o>(</span><span class=s>&#34;/admin&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;ADMIN&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>requestMatchers</span><span class=o>(</span><span class=s>&#34;/emp&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>requestMatchers</span><span class=o>(</span><span class=s>&#34;/mgr&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;MANAGER&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>anyRequest</span><span class=o>().</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>formLogin</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>defaultSuccessUrl</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>,</span><span class=kc>true</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>logout</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>logoutRequestMatcher</span><span class=o>(</span><span class=k>new</span> <span class=n>AntPathRequestMatcher</span><span class=o>(</span><span class=s>&#34;/logout&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>exceptionHandling</span><span class=o>()</span>
</span></span><span class=line><span class=cl>		<span class=o>.</span><span class=na>accessDeniedPage</span><span class=o>(</span><span class=s>&#34;/accessDenied&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>		<span class=o>;</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>http</span><span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>注意：在上面的代码中，观察 Spring Security 6.0 中的 API 变化：antMatchers()被 requestMatchers()替换，authorizeRequests()被 authorizeHttpRequests()替换。</p><h2 id=如何测试启用安全的应用程序>如何测试启用安全的应用程序？</h2><p>同时完成大量理论和编码步骤之后，是时候测试“如何在 Spring Boot 项目中实现安全性？”了。请按照以下步骤操作。</p><ol><li><p>启动应用程序，然后右键单击该项目，然后选择“Run As”&#187;“Spring Boot App”。</p></li><li><p>输入首页网址 http://localhost:8080/home，检查是否存在每个人都可以访问，甚至无需登录应用程序。</p></li><li><p>输入管理页面 URL http://localhost:8080/admin，然后它应该被重定向到内置登录页面（由 Spring Security 提供）</p></li><li><p>使用提供的管理员凭据登录，您将被重定向到欢迎页面。</p></li><li><p>输入 URL http://localhost:8080/admin，然后您就可以看到管理页面了。</p></li><li><p>当您使用管理员凭据登录时，您还可以通过点击其他页面 URL 来查看所有页面。</p></li></ol><p>随后对其他角色也重复上述步骤并检查用户是否可以根据授予的角色访问该页面。</p><h2 id=spring-boot-项目如何实现安全性-spring-boot-30-及以上>Spring Boot 项目如何实现安全性？ ：Spring Boot 3.0 及以上</h2><p>Spring Boot 3.0 在 Spring Security 模块中进行了重大 API 级别更改。因此，如果您使用 Spring Boot 3.0 或更高版本，则需要遵循以下指南以及使用 JDK 17。</p><ol><li>在 SecurityConfig.java 中：</li></ol><ul><li><p>使用 authorizeHttpRequests()代替 authorizeRequests()</p></li><li><p>使用 requestMatchers() 代替 antMatchers()</p></li><li><p>使用 RegexRequestMatchers() 代替 regexMatchers()</p></li></ul><ol start=2><li>在实体类中：</li></ol><ul><li>在 import 语句中，使用“jakarta”代替“javax”。例如：使用“jakarta.persistence.Entity;”代替“javax.persistence.Entity;”。</li></ul><h2 id=faq>FAQ</h2><h3 id=如何禁用应用程序的安全功能>如何禁用应用程序的安全功能？</h3><p>同样重要的是，有时我们需要禁用安全功能，特别是在开发和测试环境中，以避免再次输入凭据。为此，我们可以相应地在 pom.xml 文件中注释以下两个依赖项。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=c>&lt;!--
</span></span></span><span class=line><span class=cl><span class=c>&lt;dependency&gt;
</span></span></span><span class=line><span class=cl><span class=c>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
</span></span></span><span class=line><span class=cl><span class=c>    &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
</span></span></span><span class=line><span class=cl><span class=c>&lt;/dependency&gt;
</span></span></span><span class=line><span class=cl><span class=c>&lt;dependency&gt;
</span></span></span><span class=line><span class=cl><span class=c>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
</span></span></span><span class=line><span class=cl><span class=c>    &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;
</span></span></span><span class=line><span class=cl><span class=c>&lt;/dependency&gt;
</span></span></span><span class=line><span class=cl><span class=c>--&gt;</span>
</span></span></code></pre></div><h2 id=概括>概括</h2><p>随后，通过“如何在 Spring Boot 项目中实现安全性？”的所有理论和示例部分，最后，我们能够在 Spring Boot 项目中实现 Web 安全性。当然，在本文中我们介绍了两种实现安全功能的方法。此外，我们可以在<a href=https://javatechonline.com/how-to-implement-security-in-spring-boot-using-userdetailsservice/>另一篇文章</a>中了解 UserDetailsS​​ervice（实现安全性的第三种方式）。此外，有关 Spring Boot Security 的完整教程请访问<a href=https://javatechonline.com/spring-boot/#Spring_Boot_Security>此处</a>。后续如有更新，我们也会及时更新。也请随时在下面的评论部分提供您的意见。</p><p>原文链接：<a href=https://javatechonline.com/how-to-implement-security-in-spring-boot-project/>https://javatechonline.com/how-to-implement-security-in-spring-boot-project/</a></p></div><footer class=post-footer><nav class=paginav><a class=prev href=https://blog.chensoul.com/posts/2023/08/18/how-to-implement-security-in-spring-boot3-using-userdetailsservice/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></svg>&nbsp;Prev Page</span><br><span>[译]如何在Spring Boot3中使用UserDetailsService实现安全性？</span></a>
<a class=next href=https://blog.chensoul.com/posts/2023/08/16/spring-security/><span class=title>Next Page&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span><br><span>[译]Spring Security 和 Spring Boot 入门</span></a></nav></footer><div class=comments-separator></div></article></main><footer class=footer><span>&copy; 2023 <a href=https://blog.chensoul.com/>ChenSoul</a></span><span style=display:inline-block;margin-left:1em>
<a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA</a></span>
<span style=display:inline-block;margin-left:1em>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
    <a href=https://github.com/reorx/hugo-PaperModX/ rel=noopener target=_blank>PaperModX</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script async src=https://umami.chensoul.com/random-string.js data-website-id=821c25f8-a31a-4607-92d7-91ee76843d00></script>
<script>(function(){const t=""=="1";if(t)return;let e=document.getElementById("theme-toggle");e.removeEventListener("click",toggleThemeListener),e.addEventListener("click",toggleThemeListener)})()</script><script>(function(){let e=document.getElementById("menu");e&&(e.scrollLeft=localStorage.getItem("menu-scroll-position"),e.onscroll=function(){localStorage.setItem("menu-scroll-position",e.scrollLeft)});const t=""=="1",n="1"=="1";if(window.matchMedia("(prefers-reduced-motion: reduce)").matches||t||n)return;document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})})()</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>if(window.scrollListeners)for(const e of scrollListeners)window.removeEventListener("scroll",e);window.scrollListeners=[]</script><script src=/js/medium-zoom.min.js data-no-instant></script>
<script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script>(function(){const a="1"=="1";if(!a)return;if(!document.querySelector(".toc")){console.log("no toc found, ignore toc scroll");return}const r=window.scrollListeners,t=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id]"),n="active";let e=t[0];o(e).classList.add(n);const c=()=>{const s=[];for(const e of t)if(l(e)<5)s.push(e);else break;s.length>0?newActiveHeading=s[s.length-1]:newActiveHeading=t[0],e!=newActiveHeading&&(o(e).classList.remove(n),e=newActiveHeading,o(e).classList.add(n))};let s=null;const i=()=>{s!==null&&clearTimeout(s),s=setTimeout(c,50)};window.addEventListener("scroll",i,!1),r.push(i);function o(e){const t=encodeURI(e.getAttribute("id")).toLowerCase();return document.querySelector(`.toc ul li a[href="#${t}"]`)}function l(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect();return t.top}})()</script><script>mediumZoom(".entry-cover img"),mediumZoom(".post-content img:not([no-zoom])")</script><script src=/js/instantclick.min.js data-no-instant></script>
<script data-no-instant>InstantClick.init()</script></body></html>