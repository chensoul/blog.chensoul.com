<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[译]没有WebSecurityConfigurerAdapter的Spring Security.md | ChenSoul</title><meta name=keywords content="java"><meta name=description content="在 Spring Security 模块的上下文中，WebSecurityConfigurerAdapter 是一个抽象类，根据 Spring 官方网站 2022 年 2 月 21 日发布的公告，该类已从 Spring"><meta name=author content="chensoul"><link rel=canonical href=https://blog.chensoul.com/posts/2023/08/18/spring-security-without-websecurityconfigureradapter/><meta name=google-site-verification content="nBXwg45SBRjTX78SA-mH0asrAbsdu9c1nk0ObSry7aQ"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="8E787EFCDB0CE747FE1A4DA0ABEC66E4"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.chensoul.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.chensoul.com/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://blog.chensoul.com/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://blog.chensoul.com/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://blog.chensoul.com/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta name=baidu-site-verification content="codeva-FYpQY8JdLU"><meta property="og:title" content="[译]没有WebSecurityConfigurerAdapter的Spring Security.md"><meta property="og:description" content="在 Spring Security 模块的上下文中，WebSecurityConfigurerAdapter 是一个抽象类，根据 Spring 官方网站 2022 年 2 月 21 日发布的公告，该类已从 Spring"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.chensoul.com/posts/2023/08/18/spring-security-without-websecurityconfigureradapter/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-18T11:30:00+08:00"><meta property="article:modified_time" content="2023-08-18T11:30:00+08:00"><meta property="og:site_name" content="ChenSoul"><meta name=twitter:card content="summary"><meta name=twitter:title content="[译]没有WebSecurityConfigurerAdapter的Spring Security.md"><meta name=twitter:description content="在 Spring Security 模块的上下文中，WebSecurityConfigurerAdapter 是一个抽象类，根据 Spring 官方网站 2022 年 2 月 21 日发布的公告，该类已从 Spring"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.chensoul.com/posts/"},{"@type":"ListItem","position":2,"name":"[译]没有WebSecurityConfigurerAdapter的Spring Security.md","item":"https://blog.chensoul.com/posts/2023/08/18/spring-security-without-websecurityconfigureradapter/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[译]没有WebSecurityConfigurerAdapter的Spring Security.md","name":"[译]没有WebSecurityConfigurerAdapter的Spring Security.md","description":"在 Spring Security 模块的上下文中，WebSecurityConfigurerAdapter 是一个抽象类，根据 Spring 官方网站 2022 年 2 月 21 日发布的公告，该类已从 Spring","keywords":["java"],"articleBody":" 在 Spring Security 模块的上下文中，WebSecurityConfigurerAdapter 是一个抽象类，根据 Spring 官方网站 2022 年 2 月 21 日发布的公告，该类已从 Spring Security 5.7.0-M2 中弃用。它通常用于扩展配置() 方法由自定义配置子类实现。因此，它鼓励用户转向基于组件的安全配置。为了支持对这种新配置设计的更改，我们将讨论常见用例列表和未来建议的替代方案。因此，我们将讨论没有 WebSecurityConfigurerAdapter 的 Spring Security 用例的实现。\n了解这一变化很重要，因为迟早我们将使用最新版本的 Spring Security 来开发安全功能。让我们讨论“没有 WebSecurityConfigurerAdapter 的 Spring Security”主题及其相关概念。\n什么是 WebSecurityConfigurerAdapter？ WebSecurityConfigurerAdapter是Spring Security模块提供的一个抽象类。一般来说，我们使用它来重写它的configure()方法来定义我们的安全配置类。通常，我们在应用程序中实现 Spring Security 时使用两个具有不同参数的 configure() 方法。一种用于声明与身份验证相关的配置，另一种用于声明与授权相关的配置。该代码类似于下面的代码片段。\n@Configuration @EnableWebSecurity public class SecurityConfiguration extends WebSecurityConfigurerAdapter { @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception { // configure Authentication ...... } @Override protected void configure(HttpSecurity http) throws Exception { // configure Authorization ...... } } 为什么我们需要学习这个改变？ 如果您使用 Spring Boot 2.7.0 和 maven，它将自动下载 Spring Security 5.7.0 或更高版本。在这种情况下，您会发现 WebSecurityConfigurerAdapter 已被弃用。如果您仍然想使用此类而不弃用，您可以在 pom.xml 中将 Spring Boot 版本更改为较低版本（例如 2.6.6 ），如下所示。它将自动下载低于 5.7.0 的 Spring Security 版本，并且弃用警告将消失。\n但是，如果您不使用 Spring Boot，而是使用简单的 Spring Security 模块，您甚至可以降低 Spring Security 的版本。\norg.springframework.boot spring-boot-starter-parent 2.6.6 这样，我们就可以在没有WebSecurityConfigurerAdapter的情况下实现Spring Security。\n我们需要在哪里实施这一改变？ 以下是一些可能实施此更改的情况。\n如果您使用的是 Spring Boot 2.7.0 或更高版本\n如果您正在使用 Spring Security 5.7.0 或更高版本\n如果你的项目得到如上所述升级或迁移到更高版本\n如果您想使用最新版本的 Spring Boot 自定义 Spring Security 配置\n如果您想删除 WebSecurityConfigurerAdapter Deprecated 的烦人警告\n如果你想在没有WebSecurityConfigurerAdapter的情况下实现Spring Security。\n如何删除已弃用的警告？ 下面就让我们一步一步来学习吧：\n如果您使用STS作为IDE来开发项目，则需要降低Spring Boot的版本。如果您使用的是 Spring Boot 2.7.0 或更高版本，请将其设为 2.6.x（例如 2.6.6）。您可以通过更新 pom.xml 来做到这一点。完成后，它将自动下载 Spring Security 模块的兼容版本。\n检查您的配置类是否扩展了 WebSecurityConfigurerAdapter 类。已弃用的警告应该消失。现在您可以在没有 WebSecurityConfigurerAdapter 的情况下实现 Spring Security。\n如何在没有 WebSecurityConfigurerAdapter 的情况下使用 Spring Security？ 如上所述，通常我们会在自定义配置类中继承 WebSecurityConfigurerAdapter 的 configure() 方法。因此，我们需要找到这些方法的替代方案，因为自 Spring Security 5.7.0-M2 发布以来，WebSecurityConfigurerAdapter 已被弃用。\n让我们讨论一些例子\n示例#1：使用 WebSecurityConfigurerAdapter 此示例演示了 HttpSecurity 配置。通常，我们编写它来声明授权工件。\n@Configuration @EnableWebSecurity public class WebSecurityConfig extends WebSecurityConfigurerAdapter { @Override protected void configure(HttpSecurity http) throws Exception { http.cors().and().csrf().disable() .and().sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS) .and().authorizeRequests() .antMatchers(\"/home\").permitAll() .antMatchers(\"/welcome\").authenticated() .antMatchers(\"/admin\").hasAuthority(\"ADMIN\") .antMatchers(\"/emp\").hasAuthority(\"EMPLOYEE\") .antMatchers(\"/mgr\").hasAuthority(\"MANAGER\") .anyRequest().authenticated() ; } } 示例#1：没有 WebSecurityConfigurerAdapter 下面的代码演示了在没有 WebSecurityConfigurerAdapter 的情况下实现 Spring Security 的可能解决方案。\n@Configuration @EnableWebSecurity public class WebSecurityConfig { @Bean public SecurityFilterChain filterChain(HttpSecurity http) throws Exception { http.cors().and().csrf().disable() .and().sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS) .and().authorizeRequests() .antMatchers(\"/home\").permitAll() .antMatchers(\"/welcome\").authenticated() .antMatchers(\"/admin\").hasAuthority(\"ADMIN\") .antMatchers(\"/emp\").hasAuthority(\"EMPLOYEE\") .antMatchers(\"/mgr\").hasAuthority(\"MANAGER\") .anyRequest().authenticated(); return http.build(); } } 在这里，我们需要执行以下步骤：\n步骤#1：删除@override，因为我们不会从任何类中扩展和覆盖它。 步骤＃2：在此方法上应用@Bean注释 步骤#3：现在将方法返回类型声明为 SecurityFilterChain，而不是 void 步骤#4：根据需要更新方法名称。比如说filterChain。 步骤#5：方法结束时，主体返回http.build()。这里http是HttpSecurity类型的变量。 示例#2：使用 WebSecurityConfigurerAdapter 在下面的示例中，我们使用了这两种方法。\nimport org.springframework.context.annotation.Configuration; import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity; import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter; import org.springframework.security.web.util.matcher.AntPathRequestMatcher; @Configuration @EnableWebSecurity public class SecurityConfig extends WebSecurityConfigurerAdapter { @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception { // {noop} =\u003e No operation for password encoder (no password encoding needed) auth.inMemoryAuthentication() .withUser(\"devs\") .password (\"{noop} devs\") //no password encoding needed .authorities(\"ADMIN\"); auth.inMemoryAuthentication().withUser(\"ns\").password(\"{noop}ns\").authorities(\"EMPLOYEE\"); auth.inMemoryAuthentication().withUser(\"vs\").password(\"{noop}vs\").authorities(\"MANAGER\"); } @Override protected void configure(HttpSecurity http) throws Exception { //declares which Page(URL) will have What access type http.authorizeRequests() .antMatchers(\"/home\").permitAll() .antMatchers(\"/welcome\").authenticated() .antMatchers(\"/admin\").hasAuthority(\"ADMIN\") .antMatchers(\"/emp\").hasAuthority(\"EMPLOYEE\") .antMatchers(\"/mgr\").hasAuthority(\"MANAGER\") .antMatchers(\"/common\").hasAnyAuthority(\"EMPLOYEE\",\"MANAGER\") // Any other URLs which are not configured in above antMatchers // generally declared aunthenticated() in real time .anyRequest().authenticated() // Login Form Details .and() .formLogin() .defaultSuccessUrl(\"/welcome\", true) // Logout Form Details .and() .logout() .logoutRequestMatcher(new AntPathRequestMatcher(\"/logout\")) // Exception Details .and() .exceptionHandling() .accessDeniedPage(\"/accessDenied\") ; } } 示例#2：没有 WebSecurityConfigurerAdapter 下面的代码演示了在没有 WebSecurityConfigurerAdapter 的情况下实现 Spring Security 的可能解决方案。\nimport java.util.ArrayList; import java.util.List; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity; import org.springframework.security.core.GrantedAuthority; import org.springframework.security.core.authority.SimpleGrantedAuthority; import org.springframework.security.core.userdetails.User; import org.springframework.security.core.userdetails.UserDetails; import org.springframework.security.provisioning.InMemoryUserDetailsManager; import org.springframework.security.web.SecurityFilterChain; import org.springframework.security.web.util.matcher.AntPathRequestMatcher; @Configuration @EnableWebSecurity public class SecurityConfigNew { @Bean protected InMemoryUserDetailsManager configAuthentication() { List\u003cUserDetails\u003e users = new ArrayList\u003c\u003e(); List\u003cGrantedAuthority\u003e adminAuthority = new ArrayList\u003c\u003e(); adminAuthority.add(new SimpleGrantedAuthority(\"ADMIN\")); UserDetails admin= new User(\"devs\", \"{noop}devs\", adminAuthority); users.add(admin); List\u003cGrantedAuthority\u003e employeeAuthority = new ArrayList\u003c\u003e(); adminAuthority.add(new SimpleGrantedAuthority(\"EMPLOYEE\")); UserDetails employee= new User(\"ns\", \"{noop}ns\", employeeAuthority); users.add(employee); List\u003cGrantedAuthority\u003e managerAuthority = new ArrayList\u003c\u003e(); adminAuthority.add(new SimpleGrantedAuthority(\"MANAGER\")); UserDetails manager= new User(\"vs\", \"{noop}vs\", managerAuthority); users.add(manager); return new InMemoryUserDetailsManager(users); } @Bean protected SecurityFilterChain filterChain(HttpSecurity http) throws Exception { //declares which Page(URL) will have What access type http.authorizeRequests() .antMatchers(\"/home\").permitAll() .antMatchers(\"/welcome\").authenticated() .antMatchers(\"/admin\").hasAuthority(\"ADMIN\") .antMatchers(\"/emp\").hasAuthority(\"EMPLOYEE\") .antMatchers(\"/mgr\").hasAuthority(\"MANAGER\") .antMatchers(\"/common\").hasAnyAuthority(\"EMPLOYEE\",\"MANAGER\") // Any other URLs which are not configured in above antMatchers // generally declared aunthenticated() in real time .anyRequest().authenticated() // Login Form Details .and() .formLogin() .defaultSuccessUrl(\"/welcome\", true) // Logout Form Details .and() .logout() .logoutRequestMatcher(new AntPathRequestMatcher(\"/logout\")) // Exception Details .and() .exceptionHandling() .accessDeniedPage(\"/accessDenied\") ; return http.build(); } } 上面的代码片段是使用 Spring Security 的内存中身份验证的示例。\n示例#3：使用 WebSecurityConfigurerAdapter @Configuration @EnableWebSecurity public class WebSecurityConfig extends WebSecurityConfigurerAdapter { @Autowire UserDetailsService userDetailsService; @Override public void configure(AuthenticationManagerBuilder authenticationManagerBuilder) throws Exception { authenticationManagerBuilder.userDetailsService(userDetailsService).passwordEncoder(passwordEncoder()); } @Bean public PasswordEncoder passwordEncoder() { return new BCryptPasswordEncoder(); } } 示例#3：没有 WebSecurityConfigurerAdapter 下面的代码演示了在没有 WebSecurityConfigurerAdapter 的情况下实现 Spring Security 的可能解决方案。\n@Configuration @EnableWebSecurity public class WebSecurityConfig { @Bean AuthenticationManager authenticationManager(AuthenticationConfiguration authenticationConfiguration) throws Exception { return authenticationConfiguration.getAuthenticationManager(); } } 在这里，在旧版本中我们注入 AuthenticationManagerBuilder，设置 userDetailsS​​ervice、passwordEncoder 并构建它。但是 AuthenticationManager 已经在这一步中创建了。它是按照我们想要的方式创建的（使用 userDetailsS​​ervice 和 passwordEncoder）。\n示例#4：使用 WebSecurityConfigurerAdapter 在实现网络安全配置时，WebSecurityCustomizer 是一个回调接口，可用于自定义 WebSecurity。\n@Configuration @EnableWebSecurity public class SecurityConfiguration extends WebSecurityConfigurerAdapter { @Override public void configure(WebSecurity web) { web.ignoring().antMatchers(\"/ignore1\", \"/ignore2\"); } } 示例#4：没有 WebSecurityConfigurerAdapter 从 Spring Security 5.7.0-M2 开始，推荐的方法是注册 WebSecurityCustomizer bean。下面的代码演示了在没有 WebSecurityConfigurerAdapter 的情况下实现 Spring Security 的可能解决方案：\n@Configuration @EnableWebSecurity public class SecurityConfiguration { @Bean public WebSecurityCustomizer webSecurityCustomizer() { return (web) -\u003e web.ignoring().antMatchers(\"/ignore1\", \"/ignore2\"); } } 示例#5：使用 WebSecurityConfigurerAdapter 下面的代码演示了 Spring Security 上下文中 JDBC 身份验证的变化。\nong\u003e@Configuration @EnableWebSecurity public class SecurityConfig extends WebSecurityConfigurerAdapter { @Autowired private DataSource dataSource; @Autowired private BCryptPasswordEncoder passwordEncoder; @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception { auth.jdbcAuthentication() .dataSource(dataSource) //creates database connection .usersByUsernameQuery(\"select user_name,user_pwd,user_enabled from user where user_name=?\") .authoritiesByUsernameQuery(\"select user_name,user_role from user where user_name=?\") .passwordEncoder(passwordEncoder); } } 示例#5：没有 WebSecurityConfigurerAdapter 展望未来，如果我们想在没有 WebSecurityConfigurerAdapter 的情况下实现 Spring Security，新代码将如下所示。\n@Configuration @EnableWebSecurity public class SecurityConfig { @Autowired private DataSource dataSource; @Bean public UserDetailsManager authenticateUsers() { UserDetails user = User.withUsername(\"username\") .password(PasswordEncoderFactories.createDelegatingPasswordEncoder().encode(\"password\")).build(); JdbcUserDetailsManager users = new JdbcUserDetailsManager(dataSource); users.setAuthoritiesByUsernameQuery(\"select user_name,user_pwd,user_enabled from user where user_name=?\"); users.setUsersByUsernameQuery(\"select user_name,user_role from user where user_name=?\"); users.createUser(user); return users; } } 新的实现将如上所示。这可能不是确切的解决方案。\nSpring Security 6.0.0 或更高版本中有哪些弃用更新？ 如果您使用 Spring Security 6.0.0 或更高版本（以及 Spring Boot 3.0 或更高版本），您还会看到其他 API 弃用。例如，以下是需要进行的一些更改：\nauthorizeRequests() -\u003eauthorizeHttpRequests()\nantMatchers() -\u003e requestMatchers()\nregexMatchers() -\u003e RegexRequestMatchers()\nFAQ 在哪里可以找到“没有 WebSecurityConfigurerAdapter 的 Spring Security 的完整示例？” 以下是查找“没有 WebSecurityConfigurerAdapter 的 Spring Security”完整示例的链接：\nHow To Implement Security In Spring Boot Project?\nHow to implement Role Based Spring Security Without WebSecurityConfigurerAdapter in Spring Boot using UserDetailsService?\nHow to implement JWT Authentication in Spring Boot Project?\n结论 在完成了“没有 WebSecurityConfigurerAdapter 的 Spring Security”的所有理论和示例部分之后，最后，我们应该准备好在实时项目中处理警告“WebSecurityConfigurerAdapter Deprecated”。此外，我们希望您扩展“没有 WebSecurityConfigurerAdapter 的 Spring Security”一文中提供的知识，并在您的项目中相应地实现该概念。如需进一步学习 Spring Security，您可以访问 Spring Security 使用 Spring Boot 系列教程。另外，如果后续有任何更新，我们也会对文章进行相应的更新。此外，请随时在下面的评论部分提供您的意见。\n原文链接：https://javatechonline.com/spring-security-without-websecurityconfigureradapter/\n","wordCount":"2938","inLanguage":"en","datePublished":"2023-08-18T11:30:00+08:00","dateModified":"2023-08-18T11:30:00+08:00","author":{"@type":"Person","name":"chensoul"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.chensoul.com/posts/2023/08/18/spring-security-without-websecurityconfigureradapter/"},"publisher":{"@type":"Organization","name":"ChenSoul","logo":{"@type":"ImageObject","url":"https://blog.chensoul.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.chensoul.com/ accesskey=h title="ChenSoul (Alt + H)">ChenSoul</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.chensoul.com/categories/ideas title=周报><span>周报</span></a></li><li><a href=https://blog.chensoul.com/categories/notes title=编程><span>编程</span></a></li><li><a href=https://blog.chensoul.com/tags title=标签><span>标签</span></a></li><li><a href=https://blog.chensoul.com/about title=关于><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>[译]没有WebSecurityConfigurerAdapter的Spring Security.md</h1><div class=post-meta><span title='2023-08-18 11:30:00 +0800 +0800'>2023-08-18</span>&nbsp;·&nbsp;chensoul</div></header><div class=post-content><p><img loading=lazy src=https://javatechonline.com/ezoimgfmt/i0.wp.com/javatechonline.com/wp-content/uploads/2022/07/SpringSecurityWithoutWSCA-1.jpg alt="Spring Security Without WebSecurityConfigurerAdapter">
在 Spring Security 模块的上下文中，WebSecurityConfigurerAdapter 是一个抽象类，根据 <a href=https://spring.io/blog/2022/02/21/spring-security-without-the-websecurityconfigureradapter>Spring 官方网站</a> 2022 年 2 月 21 日发布的公告，该类已从 Spring Security 5.7.0-M2 中弃用。它通常用于扩展配置() 方法由自定义配置子类实现。因此，它鼓励用户转向基于组件的安全配置。为了支持对这种新配置设计的更改，我们将讨论常见用例列表和未来建议的替代方案。因此，我们将讨论没有 WebSecurityConfigurerAdapter 的 Spring Security 用例的实现。</p><p>了解这一变化很重要，因为迟早我们将使用最新版本的 Spring Security 来开发安全功能。让我们讨论“没有 WebSecurityConfigurerAdapter 的 Spring Security”主题及其相关概念。</p><h2 id=什么是-websecurityconfigureradapter>什么是 WebSecurityConfigurerAdapter？<a hidden class=anchor aria-hidden=true href=#什么是-websecurityconfigureradapter>#</a></h2><p>WebSecurityConfigurerAdapter是Spring Security模块提供的一个抽象类。一般来说，我们使用它来重写它的configure()方法来定义我们的安全配置类。通常，我们在应用程序中实现 Spring Security 时使用两个具有不同参数的 configure() 方法。一种用于声明与身份验证相关的配置，另一种用于声明与授权相关的配置。该代码类似于下面的代码片段。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span>
</span></span><span class=line><span class=cl><span class=nd>@EnableWebSecurity</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SecurityConfiguration</span> <span class=kd>extends</span> <span class=n>WebSecurityConfigurerAdapter</span> <span class=o>{</span>    
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>configure</span><span class=o>(</span><span class=n>AuthenticationManagerBuilder</span> <span class=n>auth</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>         <span class=c1>// configure Authentication ......
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>configure</span><span class=o>(</span><span class=n>HttpSecurity</span> <span class=n>http</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>       
</span></span><span class=line><span class=cl>        <span class=c1>// configure Authorization ......           
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=o>}</span>       
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=为什么我们需要学习这个改变>为什么我们需要学习这个改变？<a hidden class=anchor aria-hidden=true href=#为什么我们需要学习这个改变>#</a></h2><p>如果您使用 Spring Boot 2.7.0 和 maven，它将自动下载 Spring Security 5.7.0 或更高版本。在这种情况下，您会发现 WebSecurityConfigurerAdapter 已被弃用。如果您仍然想使用此类而不弃用，您可以在 pom.xml 中将 Spring Boot 版本更改为较低版本（例如 2.6.6 ），如下所示。它将自动下载低于 5.7.0 的 Spring Security 版本，并且弃用警告将消失。</p><p>但是，如果您不使用 Spring Boot，而是使用简单的 Spring Security 模块，您甚至可以降低 Spring Security 的版本。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;parent&gt;</span> 
</span></span><span class=line><span class=cl>	<span class=nt>&lt;groupId&gt;</span>org.springframework.boot<span class=nt>&lt;/groupId&gt;</span> 
</span></span><span class=line><span class=cl>	<span class=nt>&lt;artifactId&gt;</span>spring-boot-starter-parent<span class=nt>&lt;/artifactId&gt;</span> 
</span></span><span class=line><span class=cl>	<span class=nt>&lt;version&gt;</span>2.6.6<span class=nt>&lt;/version&gt;</span> 
</span></span><span class=line><span class=cl><span class=nt>&lt;/parent&gt;</span>
</span></span></code></pre></div><p>这样，我们就可以在没有WebSecurityConfigurerAdapter的情况下实现Spring Security。</p><h2 id=我们需要在哪里实施这一改变>我们需要在哪里实施这一改变？<a hidden class=anchor aria-hidden=true href=#我们需要在哪里实施这一改变>#</a></h2><p>以下是一些可能实施此更改的情况。</p><ol><li><p>如果您使用的是 Spring Boot 2.7.0 或更高版本</p></li><li><p>如果您正在使用 Spring Security 5.7.0 或更高版本</p></li><li><p>如果你的项目得到如上所述升级或迁移到更高版本</p></li><li><p>如果您想使用最新版本的 Spring Boot 自定义 Spring Security 配置</p></li><li><p>如果您想删除 WebSecurityConfigurerAdapter Deprecated 的烦人警告</p></li><li><p>如果你想在没有WebSecurityConfigurerAdapter的情况下实现Spring Security。</p></li></ol><h2 id=如何删除已弃用的警告>如何删除已弃用的警告？<a hidden class=anchor aria-hidden=true href=#如何删除已弃用的警告>#</a></h2><p>下面就让我们一步一步来学习吧：</p><ol><li><p>如果您使用STS作为IDE来开发项目，则需要降低Spring Boot的版本。如果您使用的是 Spring Boot 2.7.0 或更高版本，请将其设为 2.6.x（例如 2.6.6）。您可以通过更新 pom.xml 来做到这一点。完成后，它将自动下载 Spring Security 模块的兼容版本。</p></li><li><p>检查您的配置类是否扩展了 WebSecurityConfigurerAdapter 类。已弃用的警告应该消失。现在您可以在没有 WebSecurityConfigurerAdapter 的情况下实现 Spring Security。</p></li></ol><h2 id=如何在没有-websecurityconfigureradapter-的情况下使用-spring-security>如何在没有 WebSecurityConfigurerAdapter 的情况下使用 Spring Security？<a hidden class=anchor aria-hidden=true href=#如何在没有-websecurityconfigureradapter-的情况下使用-spring-security>#</a></h2><p>如上所述，通常我们会在自定义配置类中继承 WebSecurityConfigurerAdapter 的 configure() 方法。因此，我们需要找到这些方法的替代方案，因为自 Spring Security 5.7.0-M2 发布以来，WebSecurityConfigurerAdapter 已被弃用。</p><p>让我们讨论一些例子</p><h3 id=示例1使用-websecurityconfigureradapter>示例#1：使用 WebSecurityConfigurerAdapter<a hidden class=anchor aria-hidden=true href=#示例1使用-websecurityconfigureradapter>#</a></h3><p>此示例演示了 HttpSecurity 配置。通常，我们编写它来声明授权工件。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span> 
</span></span><span class=line><span class=cl><span class=nd>@EnableWebSecurity</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>WebSecurityConfig</span> <span class=kd>extends</span> <span class=n>WebSecurityConfigurerAdapter</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=nd>@Override</span> 
</span></span><span class=line><span class=cl>   <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>configure</span><span class=o>(</span><span class=n>HttpSecurity</span> <span class=n>http</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl>     <span class=n>http</span><span class=o>.</span><span class=na>cors</span><span class=o>().</span><span class=na>and</span><span class=o>().</span><span class=na>csrf</span><span class=o>().</span><span class=na>disable</span><span class=o>()</span>
</span></span><span class=line><span class=cl>         <span class=o>.</span><span class=na>and</span><span class=o>().</span><span class=na>sessionManagement</span><span class=o>().</span><span class=na>sessionCreationPolicy</span><span class=o>(</span><span class=n>SessionCreationPolicy</span><span class=o>.</span><span class=na>STATELESS</span><span class=o>)</span>
</span></span><span class=line><span class=cl>         <span class=o>.</span><span class=na>and</span><span class=o>().</span><span class=na>authorizeRequests</span><span class=o>()</span> 
</span></span><span class=line><span class=cl>         <span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/home&#34;</span><span class=o>).</span><span class=na>permitAll</span><span class=o>()</span>
</span></span><span class=line><span class=cl>         <span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>).</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>         <span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/admin&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;ADMIN&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>         <span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/emp&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>         <span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/mgr&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;MANAGER&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>         <span class=o>.</span><span class=na>anyRequest</span><span class=o>().</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>     <span class=o>;</span> 
</span></span><span class=line><span class=cl>   <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h3 id=示例1没有-websecurityconfigureradapter>示例#1：没有 WebSecurityConfigurerAdapter<a hidden class=anchor aria-hidden=true href=#示例1没有-websecurityconfigureradapter>#</a></h3><p>下面的代码演示了在没有 WebSecurityConfigurerAdapter 的情况下实现 Spring Security 的可能解决方案。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span> 
</span></span><span class=line><span class=cl><span class=nd>@EnableWebSecurity</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>WebSecurityConfig</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=nd>@Bean</span>
</span></span><span class=line><span class=cl>   <span class=kd>public</span> <span class=n>SecurityFilterChain</span> <span class=nf>filterChain</span><span class=o>(</span><span class=n>HttpSecurity</span> <span class=n>http</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl>      <span class=n>http</span><span class=o>.</span><span class=na>cors</span><span class=o>().</span><span class=na>and</span><span class=o>().</span><span class=na>csrf</span><span class=o>().</span><span class=na>disable</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>and</span><span class=o>().</span><span class=na>sessionManagement</span><span class=o>().</span><span class=na>sessionCreationPolicy</span><span class=o>(</span><span class=n>SessionCreationPolicy</span><span class=o>.</span><span class=na>STATELESS</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>and</span><span class=o>().</span><span class=na>authorizeRequests</span><span class=o>()</span> 
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/home&#34;</span><span class=o>).</span><span class=na>permitAll</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>).</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/admin&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;ADMIN&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/emp&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/mgr&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;MANAGER&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>anyRequest</span><span class=o>().</span><span class=na>authenticated</span><span class=o>();</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>http</span><span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>   <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>在这里，我们需要执行以下步骤：</p><ul><li>步骤#1：删除@override，因为我们不会从任何类中扩展和覆盖它。</li><li>步骤＃2：在此方法上应用@Bean注释</li><li>步骤#3：现在将方法返回类型声明为 SecurityFilterChain，而不是 void</li><li>步骤#4：根据需要更新方法名称。比如说filterChain。</li><li>步骤#5：方法结束时，主体返回http.build()。这里http是HttpSecurity类型的变量。</li></ul><h3 id=示例2使用-websecurityconfigureradapter>示例#2：使用 WebSecurityConfigurerAdapter<a hidden class=anchor aria-hidden=true href=#示例2使用-websecurityconfigureradapter>#</a></h3><p>在下面的示例中，我们使用了这两种方法。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.context.annotation.Configuration</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.configuration.EnableWebSecurity</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.web.util.matcher.AntPathRequestMatcher</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Configuration</span>
</span></span><span class=line><span class=cl><span class=nd>@EnableWebSecurity</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SecurityConfig</span> <span class=kd>extends</span> <span class=n>WebSecurityConfigurerAdapter</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>   <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>configure</span><span class=o>(</span><span class=n>AuthenticationManagerBuilder</span> <span class=n>auth</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// {noop} =&gt; No operation for password encoder (no password encoding needed)
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=n>auth</span><span class=o>.</span><span class=na>inMemoryAuthentication</span><span class=o>()</span>
</span></span><span class=line><span class=cl>          <span class=o>.</span><span class=na>withUser</span><span class=o>(</span><span class=s>&#34;devs&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>          <span class=o>.</span><span class=na>password</span> <span class=o>(</span><span class=s>&#34;{noop} devs&#34;</span><span class=o>)</span> <span class=c1>//no password encoding needed
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=o>.</span><span class=na>authorities</span><span class=o>(</span><span class=s>&#34;ADMIN&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=n>auth</span><span class=o>.</span><span class=na>inMemoryAuthentication</span><span class=o>().</span><span class=na>withUser</span><span class=o>(</span><span class=s>&#34;ns&#34;</span><span class=o>).</span><span class=na>password</span><span class=o>(</span><span class=s>&#34;{noop}ns&#34;</span><span class=o>).</span><span class=na>authorities</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>auth</span><span class=o>.</span><span class=na>inMemoryAuthentication</span><span class=o>().</span><span class=na>withUser</span><span class=o>(</span><span class=s>&#34;vs&#34;</span><span class=o>).</span><span class=na>password</span><span class=o>(</span><span class=s>&#34;{noop}vs&#34;</span><span class=o>).</span><span class=na>authorities</span><span class=o>(</span><span class=s>&#34;MANAGER&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>   <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>   <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>configure</span><span class=o>(</span><span class=n>HttpSecurity</span> <span class=n>http</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>//declares which Page(URL) will have What access type
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=n>http</span><span class=o>.</span><span class=na>authorizeRequests</span><span class=o>()</span>
</span></span><span class=line><span class=cl>          <span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/home&#34;</span><span class=o>).</span><span class=na>permitAll</span><span class=o>()</span>
</span></span><span class=line><span class=cl>          <span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>).</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>          <span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/admin&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;ADMIN&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>          <span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/emp&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>          <span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/mgr&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;MANAGER&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>          <span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/common&#34;</span><span class=o>).</span><span class=na>hasAnyAuthority</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>,</span><span class=s>&#34;MANAGER&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// Any other URLs which are not configured in above antMatchers
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=c1>// generally declared aunthenticated() in real time
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=o>.</span><span class=na>anyRequest</span><span class=o>().</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// Login Form Details
</span></span></span><span class=line><span class=cl><span class=c1></span>         <span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>         <span class=o>.</span><span class=na>formLogin</span><span class=o>()</span>
</span></span><span class=line><span class=cl>         <span class=o>.</span><span class=na>defaultSuccessUrl</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>,</span> <span class=kc>true</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// Logout Form Details
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>logout</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>logoutRequestMatcher</span><span class=o>(</span><span class=k>new</span> <span class=n>AntPathRequestMatcher</span><span class=o>(</span><span class=s>&#34;/logout&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// Exception Details 
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=o>.</span><span class=na>and</span><span class=o>()</span> 
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>exceptionHandling</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>accessDeniedPage</span><span class=o>(</span><span class=s>&#34;/accessDenied&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=o>;</span>
</span></span><span class=line><span class=cl>   <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h3 id=示例2没有-websecurityconfigureradapter>示例#2：没有 WebSecurityConfigurerAdapter<a hidden class=anchor aria-hidden=true href=#示例2没有-websecurityconfigureradapter>#</a></h3><p>下面的代码演示了在没有 WebSecurityConfigurerAdapter 的情况下实现 Spring Security 的可能解决方案。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.ArrayList</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>java.util.List</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.context.annotation.Bean</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.context.annotation.Configuration</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.config.annotation.web.configuration.EnableWebSecurity</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.core.GrantedAuthority</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.core.authority.SimpleGrantedAuthority</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.core.userdetails.User</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.core.userdetails.UserDetails</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.provisioning.InMemoryUserDetailsManager</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.web.SecurityFilterChain</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>org.springframework.security.web.util.matcher.AntPathRequestMatcher</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@Configuration</span>
</span></span><span class=line><span class=cl><span class=nd>@EnableWebSecurity</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SecurityConfigNew</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Bean</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=n>InMemoryUserDetailsManager</span> <span class=nf>configAuthentication</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=n>List</span><span class=o>&lt;</span><span class=n>UserDetails</span><span class=o>&gt;</span> <span class=n>users</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>       <span class=n>List</span><span class=o>&lt;</span><span class=n>GrantedAuthority</span><span class=o>&gt;</span> <span class=n>adminAuthority</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>       <span class=n>adminAuthority</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>new</span> <span class=n>SimpleGrantedAuthority</span><span class=o>(</span><span class=s>&#34;ADMIN&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>       <span class=n>UserDetails</span> <span class=n>admin</span><span class=o>=</span> <span class=k>new</span> <span class=n>User</span><span class=o>(</span><span class=s>&#34;devs&#34;</span><span class=o>,</span> <span class=s>&#34;{noop}devs&#34;</span><span class=o>,</span> <span class=n>adminAuthority</span><span class=o>);</span>
</span></span><span class=line><span class=cl>       <span class=n>users</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>admin</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=n>List</span><span class=o>&lt;</span><span class=n>GrantedAuthority</span><span class=o>&gt;</span> <span class=n>employeeAuthority</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>       <span class=n>adminAuthority</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>new</span> <span class=n>SimpleGrantedAuthority</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>       <span class=n>UserDetails</span> <span class=n>employee</span><span class=o>=</span> <span class=k>new</span> <span class=n>User</span><span class=o>(</span><span class=s>&#34;ns&#34;</span><span class=o>,</span> <span class=s>&#34;{noop}ns&#34;</span><span class=o>,</span> <span class=n>employeeAuthority</span><span class=o>);</span>
</span></span><span class=line><span class=cl>       <span class=n>users</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>employee</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=n>List</span><span class=o>&lt;</span><span class=n>GrantedAuthority</span><span class=o>&gt;</span> <span class=n>managerAuthority</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;();</span>
</span></span><span class=line><span class=cl>       <span class=n>adminAuthority</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=k>new</span> <span class=n>SimpleGrantedAuthority</span><span class=o>(</span><span class=s>&#34;MANAGER&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>       <span class=n>UserDetails</span> <span class=n>manager</span><span class=o>=</span> <span class=k>new</span> <span class=n>User</span><span class=o>(</span><span class=s>&#34;vs&#34;</span><span class=o>,</span> <span class=s>&#34;{noop}vs&#34;</span><span class=o>,</span> <span class=n>managerAuthority</span><span class=o>);</span>
</span></span><span class=line><span class=cl>       <span class=n>users</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>manager</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=k>return</span> <span class=k>new</span> <span class=n>InMemoryUserDetailsManager</span><span class=o>(</span><span class=n>users</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Bean</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=n>SecurityFilterChain</span> <span class=nf>filterChain</span><span class=o>(</span><span class=n>HttpSecurity</span> <span class=n>http</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>//declares which Page(URL) will have What access type
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>http</span><span class=o>.</span><span class=na>authorizeRequests</span><span class=o>()</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/home&#34;</span><span class=o>).</span><span class=na>permitAll</span><span class=o>()</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>).</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/admin&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;ADMIN&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/emp&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/mgr&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=s>&#34;MANAGER&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/common&#34;</span><span class=o>).</span><span class=na>hasAnyAuthority</span><span class=o>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=o>,</span><span class=s>&#34;MANAGER&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Any other URLs which are not configured in above antMatchers
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// generally declared aunthenticated() in real time
</span></span></span><span class=line><span class=cl><span class=c1></span>           <span class=o>.</span><span class=na>anyRequest</span><span class=o>().</span><span class=na>authenticated</span><span class=o>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Login Form Details
</span></span></span><span class=line><span class=cl><span class=c1></span>           <span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>           <span class=o>.</span><span class=na>formLogin</span><span class=o>()</span>
</span></span><span class=line><span class=cl>           <span class=o>.</span><span class=na>defaultSuccessUrl</span><span class=o>(</span><span class=s>&#34;/welcome&#34;</span><span class=o>,</span> <span class=kc>true</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Logout Form Details
</span></span></span><span class=line><span class=cl><span class=c1></span>          <span class=o>.</span><span class=na>and</span><span class=o>()</span>
</span></span><span class=line><span class=cl>          <span class=o>.</span><span class=na>logout</span><span class=o>()</span>
</span></span><span class=line><span class=cl>         <span class=o>.</span><span class=na>logoutRequestMatcher</span><span class=o>(</span><span class=k>new</span> <span class=n>AntPathRequestMatcher</span><span class=o>(</span><span class=s>&#34;/logout&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Exception Details 
</span></span></span><span class=line><span class=cl><span class=c1></span>         <span class=o>.</span><span class=na>and</span><span class=o>()</span> 
</span></span><span class=line><span class=cl>         <span class=o>.</span><span class=na>exceptionHandling</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>accessDeniedPage</span><span class=o>(</span><span class=s>&#34;/accessDenied&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>http</span><span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>上面的代码片段是使用 Spring Security 的内存中身份验证的示例。</p><h3 id=示例3使用-websecurityconfigureradapter>示例#3：使用 WebSecurityConfigurerAdapter<a hidden class=anchor aria-hidden=true href=#示例3使用-websecurityconfigureradapter>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span> 
</span></span><span class=line><span class=cl><span class=nd>@EnableWebSecurity</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>WebSecurityConfig</span> <span class=kd>extends</span> <span class=n>WebSecurityConfigurerAdapter</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Autowire</span>
</span></span><span class=line><span class=cl>    <span class=n>UserDetailsService</span> <span class=n>userDetailsService</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>configure</span><span class=o>(</span><span class=n>AuthenticationManagerBuilder</span> <span class=n>authenticationManagerBuilder</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>authenticationManagerBuilder</span><span class=o>.</span><span class=na>userDetailsService</span><span class=o>(</span><span class=n>userDetailsService</span><span class=o>).</span><span class=na>passwordEncoder</span><span class=o>(</span><span class=n>passwordEncoder</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Bean</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>PasswordEncoder</span> <span class=nf>passwordEncoder</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>BCryptPasswordEncoder</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h3 id=示例3没有-websecurityconfigureradapter>示例#3：没有 WebSecurityConfigurerAdapter<a hidden class=anchor aria-hidden=true href=#示例3没有-websecurityconfigureradapter>#</a></h3><p>下面的代码演示了在没有 WebSecurityConfigurerAdapter 的情况下实现 Spring Security 的可能解决方案。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span> 
</span></span><span class=line><span class=cl><span class=nd>@EnableWebSecurity</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>WebSecurityConfig</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Bean</span>
</span></span><span class=line><span class=cl>    <span class=n>AuthenticationManager</span> <span class=nf>authenticationManager</span><span class=o>(</span><span class=n>AuthenticationConfiguration</span> <span class=n>authenticationConfiguration</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span> 
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>authenticationConfiguration</span><span class=o>.</span><span class=na>getAuthenticationManager</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>在这里，在旧版本中我们注入 AuthenticationManagerBuilder，设置 userDetailsS​​ervice、passwordEncoder 并构建它。但是 AuthenticationManager 已经在这一步中创建了。它是按照我们想要的方式创建的（使用 userDetailsS​​ervice 和 passwordEncoder）。</p><h3 id=示例4使用-websecurityconfigureradapter>示例#4：使用 WebSecurityConfigurerAdapter<a hidden class=anchor aria-hidden=true href=#示例4使用-websecurityconfigureradapter>#</a></h3><p>在实现网络安全配置时，WebSecurityCustomizer 是一个回调接口，可用于自定义 WebSecurity。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span>  
</span></span><span class=line><span class=cl><span class=nd>@EnableWebSecurity</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SecurityConfiguration</span> <span class=kd>extends</span> <span class=n>WebSecurityConfigurerAdapter</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>configure</span><span class=o>(</span><span class=n>WebSecurity</span> <span class=n>web</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>web</span><span class=o>.</span><span class=na>ignoring</span><span class=o>().</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/ignore1&#34;</span><span class=o>,</span> <span class=s>&#34;/ignore2&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h3 id=示例4没有-websecurityconfigureradapter>示例#4：没有 WebSecurityConfigurerAdapter<a hidden class=anchor aria-hidden=true href=#示例4没有-websecurityconfigureradapter>#</a></h3><p>从 Spring Security 5.7.0-M2 开始，推荐的方法是注册 WebSecurityCustomizer bean。下面的代码演示了在没有 WebSecurityConfigurerAdapter 的情况下实现 Spring Security 的可能解决方案：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span>  
</span></span><span class=line><span class=cl><span class=nd>@EnableWebSecurity</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SecurityConfiguration</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Bean</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>WebSecurityCustomizer</span> <span class=nf>webSecurityCustomizer</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>(</span><span class=n>web</span><span class=o>)</span> <span class=o>-&gt;</span> <span class=n>web</span><span class=o>.</span><span class=na>ignoring</span><span class=o>().</span><span class=na>antMatchers</span><span class=o>(</span><span class=s>&#34;/ignore1&#34;</span><span class=o>,</span> <span class=s>&#34;/ignore2&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h3 id=示例5使用-websecurityconfigureradapter>示例#5：使用 WebSecurityConfigurerAdapter<a hidden class=anchor aria-hidden=true href=#示例5使用-websecurityconfigureradapter>#</a></h3><p>下面的代码演示了 Spring Security 上下文中 JDBC 身份验证的变化。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>ong</span><span class=o>&gt;</span><span class=nd>@Configuration</span>
</span></span><span class=line><span class=cl><span class=nd>@EnableWebSecurity</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SecurityConfig</span> <span class=kd>extends</span> <span class=n>WebSecurityConfigurerAdapter</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Autowired</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>DataSource</span> <span class=n>dataSource</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Autowired</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>BCryptPasswordEncoder</span> <span class=n>passwordEncoder</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>configure</span><span class=o>(</span><span class=n>AuthenticationManagerBuilder</span> <span class=n>auth</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=n>auth</span><span class=o>.</span><span class=na>jdbcAuthentication</span><span class=o>()</span>
</span></span><span class=line><span class=cl>           <span class=o>.</span><span class=na>dataSource</span><span class=o>(</span><span class=n>dataSource</span><span class=o>)</span> <span class=c1>//creates database connection
</span></span></span><span class=line><span class=cl><span class=c1></span>           <span class=o>.</span><span class=na>usersByUsernameQuery</span><span class=o>(</span><span class=s>&#34;select user_name,user_pwd,user_enabled from user where user_name=?&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>           <span class=o>.</span><span class=na>authoritiesByUsernameQuery</span><span class=o>(</span><span class=s>&#34;select user_name,user_role from user where user_name=?&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>           <span class=o>.</span><span class=na>passwordEncoder</span><span class=o>(</span><span class=n>passwordEncoder</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h3 id=示例5没有-websecurityconfigureradapter>示例#5：没有 WebSecurityConfigurerAdapter<a hidden class=anchor aria-hidden=true href=#示例5没有-websecurityconfigureradapter>#</a></h3><p>展望未来，如果我们想在没有 WebSecurityConfigurerAdapter 的情况下实现 Spring Security，新代码将如下所示。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span>
</span></span><span class=line><span class=cl><span class=nd>@EnableWebSecurity</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SecurityConfig</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=nd>@Autowired</span> 
</span></span><span class=line><span class=cl>   <span class=kd>private</span> <span class=n>DataSource</span> <span class=n>dataSource</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>   <span class=nd>@Bean</span>
</span></span><span class=line><span class=cl>   <span class=kd>public</span> <span class=n>UserDetailsManager</span> <span class=nf>authenticateUsers</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=n>UserDetails</span> <span class=n>user</span> <span class=o>=</span> <span class=n>User</span><span class=o>.</span><span class=na>withUsername</span><span class=o>(</span><span class=s>&#34;username&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>password</span><span class=o>(</span><span class=n>PasswordEncoderFactories</span><span class=o>.</span><span class=na>createDelegatingPasswordEncoder</span><span class=o>().</span><span class=na>encode</span><span class=o>(</span><span class=s>&#34;password&#34;</span><span class=o>)).</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>      <span class=n>JdbcUserDetailsManager</span> <span class=n>users</span> <span class=o>=</span> <span class=k>new</span> <span class=n>JdbcUserDetailsManager</span><span class=o>(</span><span class=n>dataSource</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>users</span><span class=o>.</span><span class=na>setAuthoritiesByUsernameQuery</span><span class=o>(</span><span class=s>&#34;select user_name,user_pwd,user_enabled from user where user_name=?&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>users</span><span class=o>.</span><span class=na>setUsersByUsernameQuery</span><span class=o>(</span><span class=s>&#34;select user_name,user_role from user where user_name=?&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>users</span><span class=o>.</span><span class=na>createUser</span><span class=o>(</span><span class=n>user</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>users</span><span class=o>;</span>
</span></span><span class=line><span class=cl>   <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>新的实现将如上所示。这可能不是确切的解决方案。</p><h2 id=spring-security-600-或更高版本中有哪些弃用更新>Spring Security 6.0.0 或更高版本中有哪些弃用更新？<a hidden class=anchor aria-hidden=true href=#spring-security-600-或更高版本中有哪些弃用更新>#</a></h2><p>如果您使用 Spring Security 6.0.0 或更高版本（以及 Spring Boot 3.0 或更高版本），您还会看到其他 API 弃用。例如，以下是需要进行的一些更改：</p><ul><li><p>authorizeRequests() ->authorizeHttpRequests()</p></li><li><p>antMatchers() -> requestMatchers()</p></li><li><p>regexMatchers() -> RegexRequestMatchers()</p></li></ul><h2 id=faq>FAQ<a hidden class=anchor aria-hidden=true href=#faq>#</a></h2><h3 id=在哪里可以找到没有-websecurityconfigureradapter-的-spring-security-的完整示例>在哪里可以找到“没有 WebSecurityConfigurerAdapter 的 Spring Security 的完整示例？”<a hidden class=anchor aria-hidden=true href=#在哪里可以找到没有-websecurityconfigureradapter-的-spring-security-的完整示例>#</a></h3><p>以下是查找“没有 WebSecurityConfigurerAdapter 的 Spring Security”完整示例的链接：</p><ol><li><p><a href=https://javatechonline.com/how-to-implement-security-in-spring-boot-project/>How To Implement Security In Spring Boot Project?</a></p></li><li><p><a href=https://javatechonline.com/how-to-implement-security-in-spring-boot-using-userdetailsservice/>How to implement Role Based Spring Security Without WebSecurityConfigurerAdapter in Spring Boot using UserDetailsService?</a></p></li><li><p><a href=https://javatechonline.com/how-to-implement-jwt-authentication-in-spring-boot-project/>How to implement JWT Authentication in Spring Boot Project?</a></p></li></ol><h2 id=结论>结论<a hidden class=anchor aria-hidden=true href=#结论>#</a></h2><p>在完成了“没有 WebSecurityConfigurerAdapter 的 Spring Security”的所有理论和示例部分之后，最后，我们应该准备好在实时项目中处理警告“WebSecurityConfigurerAdapter Deprecated”。此外，我们希望您扩展“没有 WebSecurityConfigurerAdapter 的 Spring Security”一文中提供的知识，并在您的项目中相应地实现该概念。如需进一步学习 Spring Security，您可以访问 Spring Security 使用 Spring Boot 系列教程。另外，如果后续有任何更新，我们也会对文章进行相应的更新。此外，请随时在下面的评论部分提供您的意见。</p><p>原文链接：<a href=https://javatechonline.com/spring-security-without-websecurityconfigureradapter/>https://javatechonline.com/spring-security-without-websecurityconfigureradapter/</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.chensoul.com/tags/java/>java</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://blog.chensoul.com/>ChenSoul</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script async src=https://umami.chensoul.com/script.js data-website-id=96086d6c-67d3-4bd4-820b-6c4733c7b608></script>
<script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>