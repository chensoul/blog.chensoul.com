<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[译]没有WebSecurityConfigurerAdapter的Spring Security.md | ChenSoul</title>
<meta name=keywords content="spring-security"><meta name=description content="
在 Spring Security 模块的上下文中，WebSecurityConfigurerAdapter 是一个抽象类，根据 Spring 官方网站 2022 年 2 月 21 日发布的公告，该类已从 Spring Security 5.7.0-M2 中弃用。它通常用于扩展 configure() 方法由自定义配置子类实现。因此，它鼓励用户转向基于组件的安全配置。为了支持对这种新配置设计的更改，我们将讨论常见用例列表和未来建议的替代方案。因此，我们将讨论没有 WebSecurityConfigurerAdapter 的 Spring Security 用例的实现。"><meta name=author content="chensoul"><link rel=canonical href=https://blog.chensoul.cc/posts/2023/08/18/spring-security-without-websecurityconfigureradapter/><meta name=google-site-verification content="nBXwg45SBRjTX78SA-mH0asrAbsdu9c1nk0ObSry7aQ"><link crossorigin=anonymous href=/assets/css/stylesheet.899d9a536396b9b03c9eae0c99cc6ec954a90da94036f5390d131eb8071bb417.css integrity="sha256-iZ2aU2OWubA8nq4MmcxuyVSpDalANvU5DRMeuAcbtBc=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.chensoul.cc/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.chensoul.cc/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.chensoul.cc/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.chensoul.cc/apple-touch-icon.png><link rel=mask-icon href=https://blog.chensoul.cc/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.chensoul.cc/posts/2023/08/18/spring-security-without-websecurityconfigureradapter/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta name=baidu-site-verification content="codeva-FYpQY8JdLU"><meta property="og:title" content="[译]没有WebSecurityConfigurerAdapter的Spring Security.md"><meta property="og:description" content="
在 Spring Security 模块的上下文中，WebSecurityConfigurerAdapter 是一个抽象类，根据 Spring 官方网站 2022 年 2 月 21 日发布的公告，该类已从 Spring Security 5.7.0-M2 中弃用。它通常用于扩展 configure() 方法由自定义配置子类实现。因此，它鼓励用户转向基于组件的安全配置。为了支持对这种新配置设计的更改，我们将讨论常见用例列表和未来建议的替代方案。因此，我们将讨论没有 WebSecurityConfigurerAdapter 的 Spring Security 用例的实现。"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.chensoul.cc/posts/2023/08/18/spring-security-without-websecurityconfigureradapter/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-18T00:00:00+08:00"><meta property="article:modified_time" content="2023-08-18T00:00:00+08:00"><meta property="og:site_name" content="ChenSoul"><meta name=twitter:card content="summary"><meta name=twitter:title content="[译]没有WebSecurityConfigurerAdapter的Spring Security.md"><meta name=twitter:description content="
在 Spring Security 模块的上下文中，WebSecurityConfigurerAdapter 是一个抽象类，根据 Spring 官方网站 2022 年 2 月 21 日发布的公告，该类已从 Spring Security 5.7.0-M2 中弃用。它通常用于扩展 configure() 方法由自定义配置子类实现。因此，它鼓励用户转向基于组件的安全配置。为了支持对这种新配置设计的更改，我们将讨论常见用例列表和未来建议的替代方案。因此，我们将讨论没有 WebSecurityConfigurerAdapter 的 Spring Security 用例的实现。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.chensoul.cc/posts/"},{"@type":"ListItem","position":2,"name":"[译]没有WebSecurityConfigurerAdapter的Spring Security.md","item":"https://blog.chensoul.cc/posts/2023/08/18/spring-security-without-websecurityconfigureradapter/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[译]没有WebSecurityConfigurerAdapter的Spring Security.md","name":"[译]没有WebSecurityConfigurerAdapter的Spring Security.md","description":"\n在 Spring Security 模块的上下文中，WebSecurityConfigurerAdapter 是一个抽象类，根据 Spring 官方网站 2022 年 2 月 21 日发布的公告，该类已从 Spring Security 5.7.0-M2 中弃用。它通常用于扩展 configure() 方法由自定义配置子类实现。因此，它鼓励用户转向基于组件的安全配置。为了支持对这种新配置设计的更改，我们将讨论常见用例列表和未来建议的替代方案。因此，我们将讨论没有 WebSecurityConfigurerAdapter 的 Spring Security 用例的实现。\n","keywords":["spring-security"],"articleBody":"\n在 Spring Security 模块的上下文中，WebSecurityConfigurerAdapter 是一个抽象类，根据 Spring 官方网站 2022 年 2 月 21 日发布的公告，该类已从 Spring Security 5.7.0-M2 中弃用。它通常用于扩展 configure() 方法由自定义配置子类实现。因此，它鼓励用户转向基于组件的安全配置。为了支持对这种新配置设计的更改，我们将讨论常见用例列表和未来建议的替代方案。因此，我们将讨论没有 WebSecurityConfigurerAdapter 的 Spring Security 用例的实现。\n了解这一变化很重要，因为迟早我们将使用最新版本的 Spring Security 来开发安全功能。让我们讨论“没有 WebSecurityConfigurerAdapter 的 Spring Security”主题及其相关概念。\n什么是 WebSecurityConfigurerAdapter？ WebSecurityConfigurerAdapter 是 Spring Security 模块提供的一个抽象类。一般来说，我们使用它来重写它的 configure()方法来定义我们的安全配置类。通常，我们在应用程序中实现 Spring Security 时使用两个具有不同参数的 configure() 方法。一种用于声明与身份验证相关的配置，另一种用于声明与授权相关的配置。该代码类似于下面的代码片段。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 @Configuration @EnableWebSecurity public class SecurityConfiguration extends WebSecurityConfigurerAdapter { @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception { // configure Authentication ...... } @Override protected void configure(HttpSecurity http) throws Exception { // configure Authorization ...... } } 为什么我们需要学习这个改变？ 如果您使用 Spring Boot 2.7.0 和 maven，它将自动下载 Spring Security 5.7.0 或更高版本。在这种情况下，您会发现 WebSecurityConfigurerAdapter 已被弃用。如果您仍然想使用此类而不弃用，您可以在 pom.xml 中将 Spring Boot 版本更改为较低版本（例如 2.6.6 ），如下所示。它将自动下载低于 5.7.0 的 Spring Security 版本，并且弃用警告将消失。\n但是，如果您不使用 Spring Boot，而是使用简单的 Spring Security 模块，您甚至可以降低 Spring Security 的版本。\n1 2 3 4 5 org.springframework.boot spring-boot-starter-parent 2.6.6 这样，我们就可以在没有 WebSecurityConfigurerAdapter 的情况下实现 Spring Security。\n我们需要在哪里实施这一改变？ 以下是一些可能实施此更改的情况。\n如果您使用的是 Spring Boot 2.7.0 或更高版本\n如果您正在使用 Spring Security 5.7.0 或更高版本\n如果你的项目得到如上所述升级或迁移到更高版本\n如果您想使用最新版本的 Spring Boot 自定义 Spring Security 配置\n如果您想删除 WebSecurityConfigurerAdapter Deprecated 的烦人警告\n如果你想在没有 WebSecurityConfigurerAdapter 的情况下实现 Spring Security。\n如何删除已弃用的警告？ 下面就让我们一步一步来学习吧：\n如果您使用 STS 作为 IDE 来开发项目，则需要降低 Spring Boot 的版本。如果您使用的是 Spring Boot 2.7.0 或更高版本，请将其设为 2.6.x（例如 2.6.6）。您可以通过更新 pom.xml 来做到这一点。完成后，它将自动下载 Spring Security 模块的兼容版本。\n检查您的配置类是否扩展了 WebSecurityConfigurerAdapter 类。已弃用的警告应该消失。现在您可以在没有 WebSecurityConfigurerAdapter 的情况下实现 Spring Security。\n如何在没有 WebSecurityConfigurerAdapter 的情况下使用 Spring Security？ 如上所述，通常我们会在自定义配置类中继承 WebSecurityConfigurerAdapter 的 configure() 方法。因此，我们需要找到这些方法的替代方案，因为自 Spring Security 5.7.0-M2 发布以来，WebSecurityConfigurerAdapter 已被弃用。\n让我们讨论一些例子\n示例#1：使用 WebSecurityConfigurerAdapter 此示例演示了 HttpSecurity 配置。通常，我们编写它来声明授权工件。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 @Configuration @EnableWebSecurity public class WebSecurityConfig extends WebSecurityConfigurerAdapter { @Override protected void configure(HttpSecurity http) throws Exception { http.cors().and().csrf().disable() .and().sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS) .and().authorizeRequests() .antMatchers(\"/home\").permitAll() .antMatchers(\"/welcome\").authenticated() .antMatchers(\"/admin\").hasAuthority(\"ADMIN\") .antMatchers(\"/emp\").hasAuthority(\"EMPLOYEE\") .antMatchers(\"/mgr\").hasAuthority(\"MANAGER\") .anyRequest().authenticated() ; } } 示例#1：没有 WebSecurityConfigurerAdapter 下面的代码演示了在没有 WebSecurityConfigurerAdapter 的情况下实现 Spring Security 的可能解决方案。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 @Configuration @EnableWebSecurity public class WebSecurityConfig { @Bean public SecurityFilterChain filterChain(HttpSecurity http) throws Exception { http.cors().and().csrf().disable() .and().sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS) .and().authorizeRequests() .antMatchers(\"/home\").permitAll() .antMatchers(\"/welcome\").authenticated() .antMatchers(\"/admin\").hasAuthority(\"ADMIN\") .antMatchers(\"/emp\").hasAuthority(\"EMPLOYEE\") .antMatchers(\"/mgr\").hasAuthority(\"MANAGER\") .anyRequest().authenticated(); return http.build(); } } 在这里，我们需要执行以下步骤：\n步骤#1：删除@override，因为我们不会从任何类中扩展和覆盖它。 步骤＃2：在此方法上应用@Bean 注解 步骤#3：现在将方法返回类型声明为 SecurityFilterChain，而不是 void 步骤#4：根据需要更新方法名称。比如说 filterChain。 步骤#5：方法结束时，主体返回 http.build()。这里 http 是 HttpSecurity 类型的变量。 示例#2：使用 WebSecurityConfigurerAdapter 在下面的示例中，我们使用了这两种方法。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 import org.springframework.context.annotation.Configuration; import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity; import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter; import org.springframework.security.web.util.matcher.AntPathRequestMatcher; @Configuration @EnableWebSecurity public class SecurityConfig extends WebSecurityConfigurerAdapter { @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception { // {noop} =\u003e No operation for password encoder (no password encoding needed) auth.inMemoryAuthentication() .withUser(\"devs\") .password (\"{noop} devs\") //no password encoding needed .authorities(\"ADMIN\"); auth.inMemoryAuthentication().withUser(\"ns\").password(\"{noop}ns\").authorities(\"EMPLOYEE\"); auth.inMemoryAuthentication().withUser(\"vs\").password(\"{noop}vs\").authorities(\"MANAGER\"); } @Override protected void configure(HttpSecurity http) throws Exception { //declares which Page(URL) will have What access type http.authorizeRequests() .antMatchers(\"/home\").permitAll() .antMatchers(\"/welcome\").authenticated() .antMatchers(\"/admin\").hasAuthority(\"ADMIN\") .antMatchers(\"/emp\").hasAuthority(\"EMPLOYEE\") .antMatchers(\"/mgr\").hasAuthority(\"MANAGER\") .antMatchers(\"/common\").hasAnyAuthority(\"EMPLOYEE\",\"MANAGER\") // Any other URLs which are not configured in above antMatchers // generally declared aunthenticated() in real time .anyRequest().authenticated() // Login Form Details .and() .formLogin() .defaultSuccessUrl(\"/welcome\", true) // Logout Form Details .and() .logout() .logoutRequestMatcher(new AntPathRequestMatcher(\"/logout\")) // Exception Details .and() .exceptionHandling() .accessDeniedPage(\"/accessDenied\") ; } } 示例#2：没有 WebSecurityConfigurerAdapter 下面的代码演示了在没有 WebSecurityConfigurerAdapter 的情况下实现 Spring Security 的可能解决方案。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 import java.util.ArrayList; import java.util.List; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.security.config.annotation.web.builders.HttpSecurity; import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity; import org.springframework.security.core.GrantedAuthority; import org.springframework.security.core.authority.SimpleGrantedAuthority; import org.springframework.security.core.userdetails.User; import org.springframework.security.core.userdetails.UserDetails; import org.springframework.security.provisioning.InMemoryUserDetailsManager; import org.springframework.security.web.SecurityFilterChain; import org.springframework.security.web.util.matcher.AntPathRequestMatcher; @Configuration @EnableWebSecurity public class SecurityConfigNew { @Bean protected InMemoryUserDetailsManager configAuthentication() { List\u003cUserDetails\u003e users = new ArrayList\u003c\u003e(); List\u003cGrantedAuthority\u003e adminAuthority = new ArrayList\u003c\u003e(); adminAuthority.add(new SimpleGrantedAuthority(\"ADMIN\")); UserDetails admin= new User(\"devs\", \"{noop}devs\", adminAuthority); users.add(admin); List\u003cGrantedAuthority\u003e employeeAuthority = new ArrayList\u003c\u003e(); adminAuthority.add(new SimpleGrantedAuthority(\"EMPLOYEE\")); UserDetails employee= new User(\"ns\", \"{noop}ns\", employeeAuthority); users.add(employee); List\u003cGrantedAuthority\u003e managerAuthority = new ArrayList\u003c\u003e(); adminAuthority.add(new SimpleGrantedAuthority(\"MANAGER\")); UserDetails manager= new User(\"vs\", \"{noop}vs\", managerAuthority); users.add(manager); return new InMemoryUserDetailsManager(users); } @Bean protected SecurityFilterChain filterChain(HttpSecurity http) throws Exception { //declares which Page(URL) will have What access type http.authorizeRequests() .antMatchers(\"/home\").permitAll() .antMatchers(\"/welcome\").authenticated() .antMatchers(\"/admin\").hasAuthority(\"ADMIN\") .antMatchers(\"/emp\").hasAuthority(\"EMPLOYEE\") .antMatchers(\"/mgr\").hasAuthority(\"MANAGER\") .antMatchers(\"/common\").hasAnyAuthority(\"EMPLOYEE\",\"MANAGER\") // Any other URLs which are not configured in above antMatchers // generally declared aunthenticated() in real time .anyRequest().authenticated() // Login Form Details .and() .formLogin() .defaultSuccessUrl(\"/welcome\", true) // Logout Form Details .and() .logout() .logoutRequestMatcher(new AntPathRequestMatcher(\"/logout\")) // Exception Details .and() .exceptionHandling() .accessDeniedPage(\"/accessDenied\") ; return http.build(); } } 上面的代码片段是使用 Spring Security 的内存中身份验证的示例。\n示例#3：使用 WebSecurityConfigurerAdapter 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 @Configuration @EnableWebSecurity public class WebSecurityConfig extends WebSecurityConfigurerAdapter { @Autowire UserDetailsService userDetailsService; @Override public void configure(AuthenticationManagerBuilder authenticationManagerBuilder) throws Exception { authenticationManagerBuilder.userDetailsService(userDetailsService).passwordEncoder(passwordEncoder()); } @Bean public PasswordEncoder passwordEncoder() { return new BCryptPasswordEncoder(); } } 示例#3：没有 WebSecurityConfigurerAdapter 下面的代码演示了在没有 WebSecurityConfigurerAdapter 的情况下实现 Spring Security 的可能解决方案。\n1 2 3 4 5 6 7 8 9 @Configuration @EnableWebSecurity public class WebSecurityConfig { @Bean AuthenticationManager authenticationManager(AuthenticationConfiguration authenticationConfiguration) throws Exception { return authenticationConfiguration.getAuthenticationManager(); } } 在这里，在旧版本中我们注入 AuthenticationManagerBuilder，设置 userDetailsS​​ervice、passwordEncoder 并构建它。但是 AuthenticationManager 已经在这一步中创建了。它是按照我们想要的方式创建的（使用 userDetailsS​​ervice 和 passwordEncoder）。\n示例#4：使用 WebSecurityConfigurerAdapter 在实现网络安全配置时，WebSecurityCustomizer 是一个回调接口，可用于自定义 WebSecurity。\n1 2 3 4 5 6 7 8 9 @Configuration @EnableWebSecurity public class SecurityConfiguration extends WebSecurityConfigurerAdapter { @Override public void configure(WebSecurity web) { web.ignoring().antMatchers(\"/ignore1\", \"/ignore2\"); } } 示例#4：没有 WebSecurityConfigurerAdapter 从 Spring Security 5.7.0-M2 开始，推荐的方法是注册 WebSecurityCustomizer bean。下面的代码演示了在没有 WebSecurityConfigurerAdapter 的情况下实现 Spring Security 的可能解决方案：\n1 2 3 4 5 6 7 8 9 @Configuration @EnableWebSecurity public class SecurityConfiguration { @Bean public WebSecurityCustomizer webSecurityCustomizer() { return (web) -\u003e web.ignoring().antMatchers(\"/ignore1\", \"/ignore2\"); } } 示例#5：使用 WebSecurityConfigurerAdapter 下面的代码演示了 Spring Security 上下文中 JDBC 身份验证的变化。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 ong\u003e@Configuration @EnableWebSecurity public class SecurityConfig extends WebSecurityConfigurerAdapter { @Autowired private DataSource dataSource; @Autowired private BCryptPasswordEncoder passwordEncoder; @Override protected void configure(AuthenticationManagerBuilder auth) throws Exception { auth.jdbcAuthentication() .dataSource(dataSource) //creates database connection .usersByUsernameQuery(\"select user_name,user_pwd,user_enabled from user where user_name=?\") .authoritiesByUsernameQuery(\"select user_name,user_role from user where user_name=?\") .passwordEncoder(passwordEncoder); } } 示例#5：没有 WebSecurityConfigurerAdapter 展望未来，如果我们想在没有 WebSecurityConfigurerAdapter 的情况下实现 Spring Security，新代码将如下所示。\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 @Configuration @EnableWebSecurity public class SecurityConfig { @Autowired private DataSource dataSource; @Bean public UserDetailsManager authenticateUsers() { UserDetails user = User.withUsername(\"username\") .password(PasswordEncoderFactories.createDelegatingPasswordEncoder().encode(\"password\")).build(); JdbcUserDetailsManager users = new JdbcUserDetailsManager(dataSource); users.setAuthoritiesByUsernameQuery(\"select user_name,user_pwd,user_enabled from user where user_name=?\"); users.setUsersByUsernameQuery(\"select user_name,user_role from user where user_name=?\"); users.createUser(user); return users; } } 新的实现将如上所示。这可能不是确切的解决方案。\nSpring Security 6.0.0 或更高版本中有哪些弃用更新？ 如果您使用 Spring Security 6.0.0 或更高版本（以及 Spring Boot 3.0 或更高版本），您还会看到其他 API 弃用。例如，以下是需要进行的一些更改：\nauthorizeRequests() -\u003eauthorizeHttpRequests()\nantMatchers() -\u003e requestMatchers()\nregexMatchers() -\u003e RegexRequestMatchers()\nFAQ 在哪里可以找到“没有 WebSecurityConfigurerAdapter 的 Spring Security 的完整示例？” 以下是查找“没有 WebSecurityConfigurerAdapter 的 Spring Security”完整示例的链接：\nHow To Implement Security In Spring Boot Project?\nHow to implement Role Based Spring Security Without WebSecurityConfigurerAdapter in Spring Boot using UserDetailsService?\nHow to implement JWT Authentication in Spring Boot Project?\n结论 在完成了“没有 WebSecurityConfigurerAdapter 的 Spring Security”的所有理论和示例部分之后，最后，我们应该准备好在实时项目中处理警告“WebSecurityConfigurerAdapter Deprecated”。此外，我们希望您扩展“没有 WebSecurityConfigurerAdapter 的 Spring Security”一文中提供的知识，并在您的项目中相应地实现该概念。如需进一步学习 Spring Security，您可以访问 Spring Security 使用 Spring Boot 系列教程。另外，如果后续有任何更新，我们也会对文章进行相应的更新。此外，请随时在下面的评论部分提供您的意见。\n原文链接：https://javatechonline.com/spring-security-without-websecurityconfigureradapter/\n","wordCount":"3077","inLanguage":"en","datePublished":"2023-08-18T00:00:00+08:00","dateModified":"2023-08-18T00:00:00+08:00","author":{"@type":"Person","name":"chensoul"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.chensoul.cc/posts/2023/08/18/spring-security-without-websecurityconfigureradapter/"},"publisher":{"@type":"Organization","name":"ChenSoul","logo":{"@type":"ImageObject","url":"https://blog.chensoul.cc/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.chensoul.cc/ accesskey=h title="ChenSoul (Alt + H)">ChenSoul</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.chensoul.cc/categories title=分类><span>分类</span></a></li><li><a href=https://blog.chensoul.cc/tags title=标签><span>标签</span></a></li><li><a href=https://blog.chensoul.cc/search title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li><li><a href=https://blog.chensoul.cc/index.xml title=订阅><span>订阅</span></a></li><li><a href=https://github.com/chensoul title=关于><span>关于</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">[译]没有WebSecurityConfigurerAdapter的Spring Security.md</h1><div class=post-meta><span title='2023-08-18 00:00:00 +0800 CST'>2023-08-18</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;3077 words&nbsp;·&nbsp;chensoul</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e4%bb%80%e4%b9%88%e6%98%af-websecurityconfigureradapter aria-label="什么是 WebSecurityConfigurerAdapter？">什么是 WebSecurityConfigurerAdapter？</a></li><li><a href=#%e4%b8%ba%e4%bb%80%e4%b9%88%e6%88%91%e4%bb%ac%e9%9c%80%e8%a6%81%e5%ad%a6%e4%b9%a0%e8%bf%99%e4%b8%aa%e6%94%b9%e5%8f%98 aria-label=为什么我们需要学习这个改变？>为什么我们需要学习这个改变？</a></li><li><a href=#%e6%88%91%e4%bb%ac%e9%9c%80%e8%a6%81%e5%9c%a8%e5%93%aa%e9%87%8c%e5%ae%9e%e6%96%bd%e8%bf%99%e4%b8%80%e6%94%b9%e5%8f%98 aria-label=我们需要在哪里实施这一改变？>我们需要在哪里实施这一改变？</a></li><li><a href=#%e5%a6%82%e4%bd%95%e5%88%a0%e9%99%a4%e5%b7%b2%e5%bc%83%e7%94%a8%e7%9a%84%e8%ad%a6%e5%91%8a aria-label=如何删除已弃用的警告？>如何删除已弃用的警告？</a></li><li><a href=#%e5%a6%82%e4%bd%95%e5%9c%a8%e6%b2%a1%e6%9c%89-websecurityconfigureradapter-%e7%9a%84%e6%83%85%e5%86%b5%e4%b8%8b%e4%bd%bf%e7%94%a8-spring-security aria-label="如何在没有 WebSecurityConfigurerAdapter 的情况下使用 Spring Security？">如何在没有 WebSecurityConfigurerAdapter 的情况下使用 Spring Security？</a><ul><li><a href=#%e7%a4%ba%e4%be%8b1%e4%bd%bf%e7%94%a8-websecurityconfigureradapter aria-label="示例#1：使用 WebSecurityConfigurerAdapter">示例#1：使用 WebSecurityConfigurerAdapter</a></li><li><a href=#%e7%a4%ba%e4%be%8b1%e6%b2%a1%e6%9c%89-websecurityconfigureradapter aria-label="示例#1：没有 WebSecurityConfigurerAdapter">示例#1：没有 WebSecurityConfigurerAdapter</a></li><li><a href=#%e7%a4%ba%e4%be%8b2%e4%bd%bf%e7%94%a8-websecurityconfigureradapter aria-label="示例#2：使用 WebSecurityConfigurerAdapter">示例#2：使用 WebSecurityConfigurerAdapter</a></li><li><a href=#%e7%a4%ba%e4%be%8b2%e6%b2%a1%e6%9c%89-websecurityconfigureradapter aria-label="示例#2：没有 WebSecurityConfigurerAdapter">示例#2：没有 WebSecurityConfigurerAdapter</a></li><li><a href=#%e7%a4%ba%e4%be%8b3%e4%bd%bf%e7%94%a8-websecurityconfigureradapter aria-label="示例#3：使用 WebSecurityConfigurerAdapter">示例#3：使用 WebSecurityConfigurerAdapter</a></li><li><a href=#%e7%a4%ba%e4%be%8b3%e6%b2%a1%e6%9c%89-websecurityconfigureradapter aria-label="示例#3：没有 WebSecurityConfigurerAdapter">示例#3：没有 WebSecurityConfigurerAdapter</a></li><li><a href=#%e7%a4%ba%e4%be%8b4%e4%bd%bf%e7%94%a8-websecurityconfigureradapter aria-label="示例#4：使用 WebSecurityConfigurerAdapter">示例#4：使用 WebSecurityConfigurerAdapter</a></li><li><a href=#%e7%a4%ba%e4%be%8b4%e6%b2%a1%e6%9c%89-websecurityconfigureradapter aria-label="示例#4：没有 WebSecurityConfigurerAdapter">示例#4：没有 WebSecurityConfigurerAdapter</a></li><li><a href=#%e7%a4%ba%e4%be%8b5%e4%bd%bf%e7%94%a8-websecurityconfigureradapter aria-label="示例#5：使用 WebSecurityConfigurerAdapter">示例#5：使用 WebSecurityConfigurerAdapter</a></li><li><a href=#%e7%a4%ba%e4%be%8b5%e6%b2%a1%e6%9c%89-websecurityconfigureradapter aria-label="示例#5：没有 WebSecurityConfigurerAdapter">示例#5：没有 WebSecurityConfigurerAdapter</a></li></ul></li><li><a href=#spring-security-600-%e6%88%96%e6%9b%b4%e9%ab%98%e7%89%88%e6%9c%ac%e4%b8%ad%e6%9c%89%e5%93%aa%e4%ba%9b%e5%bc%83%e7%94%a8%e6%9b%b4%e6%96%b0 aria-label="Spring Security 6.0.0 或更高版本中有哪些弃用更新？">Spring Security 6.0.0 或更高版本中有哪些弃用更新？</a></li><li><a href=#faq aria-label=FAQ>FAQ</a><ul><li><a href=#%e5%9c%a8%e5%93%aa%e9%87%8c%e5%8f%af%e4%bb%a5%e6%89%be%e5%88%b0%e6%b2%a1%e6%9c%89-websecurityconfigureradapter-%e7%9a%84-spring-security-%e7%9a%84%e5%ae%8c%e6%95%b4%e7%a4%ba%e4%be%8b aria-label="在哪里可以找到“没有 WebSecurityConfigurerAdapter 的 Spring Security 的完整示例？”">在哪里可以找到“没有 WebSecurityConfigurerAdapter 的 Spring Security 的完整示例？”</a></li></ul></li><li><a href=#%e7%bb%93%e8%ae%ba aria-label=结论>结论</a></li></ul></div></details></div><div class=post-content><p><img alt="WebSecurityConfigurerAdapter Deprecated" loading=lazy src=https://javatechonline.com/wp-content/uploads/2022/07/WebSecurityConfigurerAdapter-Deprecated-1.jpg></p><p>在 Spring Security 模块的上下文中，WebSecurityConfigurerAdapter 是一个抽象类，根据 <a href=https://spring.io/blog/2022/02/21/spring-security-without-the-websecurityconfigureradapter target=_blank>Spring 官方网站</a> 2022 年 2 月 21 日发布的公告，该类已从 Spring Security 5.7.0-M2 中弃用。它通常用于扩展 configure() 方法由自定义配置子类实现。因此，它鼓励用户转向基于组件的安全配置。为了支持对这种新配置设计的更改，我们将讨论常见用例列表和未来建议的替代方案。因此，我们将讨论没有 WebSecurityConfigurerAdapter 的 Spring Security 用例的实现。</p><p>了解这一变化很重要，因为迟早我们将使用最新版本的 Spring Security 来开发安全功能。让我们讨论“没有 WebSecurityConfigurerAdapter 的 Spring Security”主题及其相关概念。</p><h2 id=什么是-websecurityconfigureradapter>什么是 WebSecurityConfigurerAdapter？<a hidden class=anchor aria-hidden=true href=#什么是-websecurityconfigureradapter>#</a></h2><p>WebSecurityConfigurerAdapter 是 Spring Security 模块提供的一个抽象类。一般来说，我们使用它来重写它的 configure()方法来定义我们的安全配置类。通常，我们在应用程序中实现 Spring Security 时使用两个具有不同参数的 configure() 方法。一种用于声明与身份验证相关的配置，另一种用于声明与授权相关的配置。该代码类似于下面的代码片段。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@EnableWebSecurity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>SecurityConfiguration</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>WebSecurityConfigurerAdapter</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>protected</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>configure</span><span class=p>(</span><span class=n>AuthenticationManagerBuilder</span><span class=w> </span><span class=n>auth</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=c1>// configure Authentication ......</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>protected</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>configure</span><span class=p>(</span><span class=n>HttpSecurity</span><span class=w> </span><span class=n>http</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// configure Authorization ......</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=为什么我们需要学习这个改变>为什么我们需要学习这个改变？<a hidden class=anchor aria-hidden=true href=#为什么我们需要学习这个改变>#</a></h2><p>如果您使用 Spring Boot 2.7.0 和 maven，它将自动下载 Spring Security 5.7.0 或更高版本。在这种情况下，您会发现 WebSecurityConfigurerAdapter 已被弃用。如果您仍然想使用此类而不弃用，您可以在 pom.xml 中将 Spring Boot 版本更改为较低版本（例如 2.6.6 ），如下所示。它将自动下载低于 5.7.0 的 Spring Security 版本，并且弃用警告将消失。</p><p>但是，如果您不使用 Spring Boot，而是使用简单的 Spring Security 模块，您甚至可以降低 Spring Security 的版本。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;parent&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;groupId&gt;</span>org.springframework.boot<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;artifactId&gt;</span>spring-boot-starter-parent<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;version&gt;</span>2.6.6<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/parent&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>这样，我们就可以在没有 WebSecurityConfigurerAdapter 的情况下实现 Spring Security。</p><h2 id=我们需要在哪里实施这一改变>我们需要在哪里实施这一改变？<a hidden class=anchor aria-hidden=true href=#我们需要在哪里实施这一改变>#</a></h2><p>以下是一些可能实施此更改的情况。</p><ol><li><p>如果您使用的是 Spring Boot 2.7.0 或更高版本</p></li><li><p>如果您正在使用 Spring Security 5.7.0 或更高版本</p></li><li><p>如果你的项目得到如上所述升级或迁移到更高版本</p></li><li><p>如果您想使用最新版本的 Spring Boot 自定义 Spring Security 配置</p></li><li><p>如果您想删除 WebSecurityConfigurerAdapter Deprecated 的烦人警告</p></li><li><p>如果你想在没有 WebSecurityConfigurerAdapter 的情况下实现 Spring Security。</p></li></ol><h2 id=如何删除已弃用的警告>如何删除已弃用的警告？<a hidden class=anchor aria-hidden=true href=#如何删除已弃用的警告>#</a></h2><p>下面就让我们一步一步来学习吧：</p><ol><li><p>如果您使用 STS 作为 IDE 来开发项目，则需要降低 Spring Boot 的版本。如果您使用的是 Spring Boot 2.7.0 或更高版本，请将其设为 2.6.x（例如 2.6.6）。您可以通过更新 pom.xml 来做到这一点。完成后，它将自动下载 Spring Security 模块的兼容版本。</p></li><li><p>检查您的配置类是否扩展了 WebSecurityConfigurerAdapter 类。已弃用的警告应该消失。现在您可以在没有 WebSecurityConfigurerAdapter 的情况下实现 Spring Security。</p></li></ol><h2 id=如何在没有-websecurityconfigureradapter-的情况下使用-spring-security>如何在没有 WebSecurityConfigurerAdapter 的情况下使用 Spring Security？<a hidden class=anchor aria-hidden=true href=#如何在没有-websecurityconfigureradapter-的情况下使用-spring-security>#</a></h2><p>如上所述，通常我们会在自定义配置类中继承 WebSecurityConfigurerAdapter 的 configure() 方法。因此，我们需要找到这些方法的替代方案，因为自 Spring Security 5.7.0-M2 发布以来，WebSecurityConfigurerAdapter 已被弃用。</p><p>让我们讨论一些例子</p><h3 id=示例1使用-websecurityconfigureradapter>示例#1：使用 WebSecurityConfigurerAdapter<a hidden class=anchor aria-hidden=true href=#示例1使用-websecurityconfigureradapter>#</a></h3><p>此示例演示了 HttpSecurity 配置。通常，我们编写它来声明授权工件。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@EnableWebSecurity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>WebSecurityConfig</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>WebSecurityConfigurerAdapter</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=kd>protected</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>configure</span><span class=p>(</span><span class=n>HttpSecurity</span><span class=w> </span><span class=n>http</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=n>http</span><span class=p>.</span><span class=na>cors</span><span class=p>().</span><span class=na>and</span><span class=p>().</span><span class=na>csrf</span><span class=p>().</span><span class=na>disable</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=p>.</span><span class=na>and</span><span class=p>().</span><span class=na>sessionManagement</span><span class=p>().</span><span class=na>sessionCreationPolicy</span><span class=p>(</span><span class=n>SessionCreationPolicy</span><span class=p>.</span><span class=na>STATELESS</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=p>.</span><span class=na>and</span><span class=p>().</span><span class=na>authorizeRequests</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=p>.</span><span class=na>antMatchers</span><span class=p>(</span><span class=s>&#34;/home&#34;</span><span class=p>).</span><span class=na>permitAll</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=p>.</span><span class=na>antMatchers</span><span class=p>(</span><span class=s>&#34;/welcome&#34;</span><span class=p>).</span><span class=na>authenticated</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=p>.</span><span class=na>antMatchers</span><span class=p>(</span><span class=s>&#34;/admin&#34;</span><span class=p>).</span><span class=na>hasAuthority</span><span class=p>(</span><span class=s>&#34;ADMIN&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=p>.</span><span class=na>antMatchers</span><span class=p>(</span><span class=s>&#34;/emp&#34;</span><span class=p>).</span><span class=na>hasAuthority</span><span class=p>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=p>.</span><span class=na>antMatchers</span><span class=p>(</span><span class=s>&#34;/mgr&#34;</span><span class=p>).</span><span class=na>hasAuthority</span><span class=p>(</span><span class=s>&#34;MANAGER&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=p>.</span><span class=na>anyRequest</span><span class=p>().</span><span class=na>authenticated</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=示例1没有-websecurityconfigureradapter>示例#1：没有 WebSecurityConfigurerAdapter<a hidden class=anchor aria-hidden=true href=#示例1没有-websecurityconfigureradapter>#</a></h3><p>下面的代码演示了在没有 WebSecurityConfigurerAdapter 的情况下实现 Spring Security 的可能解决方案。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@EnableWebSecurity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>WebSecurityConfig</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=kd>public</span><span class=w> </span><span class=n>SecurityFilterChain</span><span class=w> </span><span class=nf>filterChain</span><span class=p>(</span><span class=n>HttpSecurity</span><span class=w> </span><span class=n>http</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>http</span><span class=p>.</span><span class=na>cors</span><span class=p>().</span><span class=na>and</span><span class=p>().</span><span class=na>csrf</span><span class=p>().</span><span class=na>disable</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>and</span><span class=p>().</span><span class=na>sessionManagement</span><span class=p>().</span><span class=na>sessionCreationPolicy</span><span class=p>(</span><span class=n>SessionCreationPolicy</span><span class=p>.</span><span class=na>STATELESS</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>and</span><span class=p>().</span><span class=na>authorizeRequests</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>antMatchers</span><span class=p>(</span><span class=s>&#34;/home&#34;</span><span class=p>).</span><span class=na>permitAll</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>antMatchers</span><span class=p>(</span><span class=s>&#34;/welcome&#34;</span><span class=p>).</span><span class=na>authenticated</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>antMatchers</span><span class=p>(</span><span class=s>&#34;/admin&#34;</span><span class=p>).</span><span class=na>hasAuthority</span><span class=p>(</span><span class=s>&#34;ADMIN&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>antMatchers</span><span class=p>(</span><span class=s>&#34;/emp&#34;</span><span class=p>).</span><span class=na>hasAuthority</span><span class=p>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>antMatchers</span><span class=p>(</span><span class=s>&#34;/mgr&#34;</span><span class=p>).</span><span class=na>hasAuthority</span><span class=p>(</span><span class=s>&#34;MANAGER&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>anyRequest</span><span class=p>().</span><span class=na>authenticated</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>return</span><span class=w> </span><span class=n>http</span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>在这里，我们需要执行以下步骤：</p><ul><li>步骤#1：删除@override，因为我们不会从任何类中扩展和覆盖它。</li><li>步骤＃2：在此方法上应用@Bean 注解</li><li>步骤#3：现在将方法返回类型声明为 SecurityFilterChain，而不是 void</li><li>步骤#4：根据需要更新方法名称。比如说 filterChain。</li><li>步骤#5：方法结束时，主体返回 http.build()。这里 http 是 HttpSecurity 类型的变量。</li></ul><h3 id=示例2使用-websecurityconfigureradapter>示例#2：使用 WebSecurityConfigurerAdapter<a hidden class=anchor aria-hidden=true href=#示例2使用-websecurityconfigureradapter>#</a></h3><p>在下面的示例中，我们使用了这两种方法。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.context.annotation.Configuration</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.config.annotation.web.configuration.EnableWebSecurity</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.web.util.matcher.AntPathRequestMatcher</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@EnableWebSecurity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>SecurityConfig</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>WebSecurityConfigurerAdapter</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=kd>protected</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>configure</span><span class=p>(</span><span class=n>AuthenticationManagerBuilder</span><span class=w> </span><span class=n>auth</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c1>// {noop} =&gt; No operation for password encoder (no password encoding needed)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>auth</span><span class=p>.</span><span class=na>inMemoryAuthentication</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=p>.</span><span class=na>withUser</span><span class=p>(</span><span class=s>&#34;devs&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=p>.</span><span class=na>password</span><span class=w> </span><span class=p>(</span><span class=s>&#34;{noop} devs&#34;</span><span class=p>)</span><span class=w> </span><span class=c1>//no password encoding needed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=p>.</span><span class=na>authorities</span><span class=p>(</span><span class=s>&#34;ADMIN&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>auth</span><span class=p>.</span><span class=na>inMemoryAuthentication</span><span class=p>().</span><span class=na>withUser</span><span class=p>(</span><span class=s>&#34;ns&#34;</span><span class=p>).</span><span class=na>password</span><span class=p>(</span><span class=s>&#34;{noop}ns&#34;</span><span class=p>).</span><span class=na>authorities</span><span class=p>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>auth</span><span class=p>.</span><span class=na>inMemoryAuthentication</span><span class=p>().</span><span class=na>withUser</span><span class=p>(</span><span class=s>&#34;vs&#34;</span><span class=p>).</span><span class=na>password</span><span class=p>(</span><span class=s>&#34;{noop}vs&#34;</span><span class=p>).</span><span class=na>authorities</span><span class=p>(</span><span class=s>&#34;MANAGER&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=kd>protected</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>configure</span><span class=p>(</span><span class=n>HttpSecurity</span><span class=w> </span><span class=n>http</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c1>//declares which Page(URL) will have What access type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>http</span><span class=p>.</span><span class=na>authorizeRequests</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=p>.</span><span class=na>antMatchers</span><span class=p>(</span><span class=s>&#34;/home&#34;</span><span class=p>).</span><span class=na>permitAll</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=p>.</span><span class=na>antMatchers</span><span class=p>(</span><span class=s>&#34;/welcome&#34;</span><span class=p>).</span><span class=na>authenticated</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=p>.</span><span class=na>antMatchers</span><span class=p>(</span><span class=s>&#34;/admin&#34;</span><span class=p>).</span><span class=na>hasAuthority</span><span class=p>(</span><span class=s>&#34;ADMIN&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=p>.</span><span class=na>antMatchers</span><span class=p>(</span><span class=s>&#34;/emp&#34;</span><span class=p>).</span><span class=na>hasAuthority</span><span class=p>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=p>.</span><span class=na>antMatchers</span><span class=p>(</span><span class=s>&#34;/mgr&#34;</span><span class=p>).</span><span class=na>hasAuthority</span><span class=p>(</span><span class=s>&#34;MANAGER&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=p>.</span><span class=na>antMatchers</span><span class=p>(</span><span class=s>&#34;/common&#34;</span><span class=p>).</span><span class=na>hasAnyAuthority</span><span class=p>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=p>,</span><span class=s>&#34;MANAGER&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c1>// Any other URLs which are not configured in above antMatchers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c1>// generally declared aunthenticated() in real time</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=p>.</span><span class=na>anyRequest</span><span class=p>().</span><span class=na>authenticated</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c1>// Login Form Details</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=p>.</span><span class=na>and</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=p>.</span><span class=na>formLogin</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=p>.</span><span class=na>defaultSuccessUrl</span><span class=p>(</span><span class=s>&#34;/welcome&#34;</span><span class=p>,</span><span class=w> </span><span class=kc>true</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c1>// Logout Form Details</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>and</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>logout</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>logoutRequestMatcher</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>AntPathRequestMatcher</span><span class=p>(</span><span class=s>&#34;/logout&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c1>// Exception Details</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>and</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>exceptionHandling</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>accessDeniedPage</span><span class=p>(</span><span class=s>&#34;/accessDenied&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=示例2没有-websecurityconfigureradapter>示例#2：没有 WebSecurityConfigurerAdapter<a hidden class=anchor aria-hidden=true href=#示例2没有-websecurityconfigureradapter>#</a></h3><p>下面的代码演示了在没有 WebSecurityConfigurerAdapter 的情况下实现 Spring Security 的可能解决方案。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>java.util.ArrayList</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.List</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.context.annotation.Bean</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.context.annotation.Configuration</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.config.annotation.web.builders.HttpSecurity</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.config.annotation.web.configuration.EnableWebSecurity</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.core.GrantedAuthority</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.core.authority.SimpleGrantedAuthority</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.core.userdetails.User</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.core.userdetails.UserDetails</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.provisioning.InMemoryUserDetailsManager</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.web.SecurityFilterChain</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.web.util.matcher.AntPathRequestMatcher</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@EnableWebSecurity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>SecurityConfigNew</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>protected</span><span class=w> </span><span class=n>InMemoryUserDetailsManager</span><span class=w> </span><span class=nf>configAuthentication</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>List</span><span class=o>&lt;</span><span class=n>UserDetails</span><span class=o>&gt;</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>List</span><span class=o>&lt;</span><span class=n>GrantedAuthority</span><span class=o>&gt;</span><span class=w> </span><span class=n>adminAuthority</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>adminAuthority</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>SimpleGrantedAuthority</span><span class=p>(</span><span class=s>&#34;ADMIN&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>UserDetails</span><span class=w> </span><span class=n>admin</span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>User</span><span class=p>(</span><span class=s>&#34;devs&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;{noop}devs&#34;</span><span class=p>,</span><span class=w> </span><span class=n>adminAuthority</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>users</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>admin</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>List</span><span class=o>&lt;</span><span class=n>GrantedAuthority</span><span class=o>&gt;</span><span class=w> </span><span class=n>employeeAuthority</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>adminAuthority</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>SimpleGrantedAuthority</span><span class=p>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>UserDetails</span><span class=w> </span><span class=n>employee</span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>User</span><span class=p>(</span><span class=s>&#34;ns&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;{noop}ns&#34;</span><span class=p>,</span><span class=w> </span><span class=n>employeeAuthority</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>users</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>employee</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>List</span><span class=o>&lt;</span><span class=n>GrantedAuthority</span><span class=o>&gt;</span><span class=w> </span><span class=n>managerAuthority</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>adminAuthority</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>SimpleGrantedAuthority</span><span class=p>(</span><span class=s>&#34;MANAGER&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>UserDetails</span><span class=w> </span><span class=n>manager</span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>User</span><span class=p>(</span><span class=s>&#34;vs&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;{noop}vs&#34;</span><span class=p>,</span><span class=w> </span><span class=n>managerAuthority</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>users</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>manager</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>InMemoryUserDetailsManager</span><span class=p>(</span><span class=n>users</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>protected</span><span class=w> </span><span class=n>SecurityFilterChain</span><span class=w> </span><span class=nf>filterChain</span><span class=p>(</span><span class=n>HttpSecurity</span><span class=w> </span><span class=n>http</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//declares which Page(URL) will have What access type</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>http</span><span class=p>.</span><span class=na>authorizeRequests</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>antMatchers</span><span class=p>(</span><span class=s>&#34;/home&#34;</span><span class=p>).</span><span class=na>permitAll</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>antMatchers</span><span class=p>(</span><span class=s>&#34;/welcome&#34;</span><span class=p>).</span><span class=na>authenticated</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>antMatchers</span><span class=p>(</span><span class=s>&#34;/admin&#34;</span><span class=p>).</span><span class=na>hasAuthority</span><span class=p>(</span><span class=s>&#34;ADMIN&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>antMatchers</span><span class=p>(</span><span class=s>&#34;/emp&#34;</span><span class=p>).</span><span class=na>hasAuthority</span><span class=p>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>antMatchers</span><span class=p>(</span><span class=s>&#34;/mgr&#34;</span><span class=p>).</span><span class=na>hasAuthority</span><span class=p>(</span><span class=s>&#34;MANAGER&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>antMatchers</span><span class=p>(</span><span class=s>&#34;/common&#34;</span><span class=p>).</span><span class=na>hasAnyAuthority</span><span class=p>(</span><span class=s>&#34;EMPLOYEE&#34;</span><span class=p>,</span><span class=s>&#34;MANAGER&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Any other URLs which are not configured in above antMatchers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// generally declared aunthenticated() in real time</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>           </span><span class=p>.</span><span class=na>anyRequest</span><span class=p>().</span><span class=na>authenticated</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Login Form Details</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>           </span><span class=p>.</span><span class=na>and</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>           </span><span class=p>.</span><span class=na>formLogin</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>           </span><span class=p>.</span><span class=na>defaultSuccessUrl</span><span class=p>(</span><span class=s>&#34;/welcome&#34;</span><span class=p>,</span><span class=w> </span><span class=kc>true</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Logout Form Details</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=p>.</span><span class=na>and</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=p>.</span><span class=na>logout</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=p>.</span><span class=na>logoutRequestMatcher</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>AntPathRequestMatcher</span><span class=p>(</span><span class=s>&#34;/logout&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>// Exception Details</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=p>.</span><span class=na>and</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=p>.</span><span class=na>exceptionHandling</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>accessDeniedPage</span><span class=p>(</span><span class=s>&#34;/accessDenied&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>http</span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>上面的代码片段是使用 Spring Security 的内存中身份验证的示例。</p><h3 id=示例3使用-websecurityconfigureradapter>示例#3：使用 WebSecurityConfigurerAdapter<a hidden class=anchor aria-hidden=true href=#示例3使用-websecurityconfigureradapter>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@EnableWebSecurity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>WebSecurityConfig</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>WebSecurityConfigurerAdapter</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowire</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>UserDetailsService</span><span class=w> </span><span class=n>userDetailsService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>configure</span><span class=p>(</span><span class=n>AuthenticationManagerBuilder</span><span class=w> </span><span class=n>authenticationManagerBuilder</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>authenticationManagerBuilder</span><span class=p>.</span><span class=na>userDetailsService</span><span class=p>(</span><span class=n>userDetailsService</span><span class=p>).</span><span class=na>passwordEncoder</span><span class=p>(</span><span class=n>passwordEncoder</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>PasswordEncoder</span><span class=w> </span><span class=nf>passwordEncoder</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>BCryptPasswordEncoder</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=示例3没有-websecurityconfigureradapter>示例#3：没有 WebSecurityConfigurerAdapter<a hidden class=anchor aria-hidden=true href=#示例3没有-websecurityconfigureradapter>#</a></h3><p>下面的代码演示了在没有 WebSecurityConfigurerAdapter 的情况下实现 Spring Security 的可能解决方案。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@EnableWebSecurity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>WebSecurityConfig</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>AuthenticationManager</span><span class=w> </span><span class=nf>authenticationManager</span><span class=p>(</span><span class=n>AuthenticationConfiguration</span><span class=w> </span><span class=n>authenticationConfiguration</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>authenticationConfiguration</span><span class=p>.</span><span class=na>getAuthenticationManager</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>在这里，在旧版本中我们注入 AuthenticationManagerBuilder，设置 userDetailsS​​ervice、passwordEncoder 并构建它。但是 AuthenticationManager 已经在这一步中创建了。它是按照我们想要的方式创建的（使用 userDetailsS​​ervice 和 passwordEncoder）。</p><h3 id=示例4使用-websecurityconfigureradapter>示例#4：使用 WebSecurityConfigurerAdapter<a hidden class=anchor aria-hidden=true href=#示例4使用-websecurityconfigureradapter>#</a></h3><p>在实现网络安全配置时，WebSecurityCustomizer 是一个回调接口，可用于自定义 WebSecurity。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@EnableWebSecurity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>SecurityConfiguration</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>WebSecurityConfigurerAdapter</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>configure</span><span class=p>(</span><span class=n>WebSecurity</span><span class=w> </span><span class=n>web</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>web</span><span class=p>.</span><span class=na>ignoring</span><span class=p>().</span><span class=na>antMatchers</span><span class=p>(</span><span class=s>&#34;/ignore1&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;/ignore2&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=示例4没有-websecurityconfigureradapter>示例#4：没有 WebSecurityConfigurerAdapter<a hidden class=anchor aria-hidden=true href=#示例4没有-websecurityconfigureradapter>#</a></h3><p>从 Spring Security 5.7.0-M2 开始，推荐的方法是注册 WebSecurityCustomizer bean。下面的代码演示了在没有 WebSecurityConfigurerAdapter 的情况下实现 Spring Security 的可能解决方案：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@EnableWebSecurity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>SecurityConfiguration</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>WebSecurityCustomizer</span><span class=w> </span><span class=nf>webSecurityCustomizer</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=p>(</span><span class=n>web</span><span class=p>)</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>web</span><span class=p>.</span><span class=na>ignoring</span><span class=p>().</span><span class=na>antMatchers</span><span class=p>(</span><span class=s>&#34;/ignore1&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;/ignore2&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=示例5使用-websecurityconfigureradapter>示例#5：使用 WebSecurityConfigurerAdapter<a hidden class=anchor aria-hidden=true href=#示例5使用-websecurityconfigureradapter>#</a></h3><p>下面的代码演示了 Spring Security 上下文中 JDBC 身份验证的变化。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>ong</span><span class=o>&gt;</span><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@EnableWebSecurity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>SecurityConfig</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>WebSecurityConfigurerAdapter</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>DataSource</span><span class=w> </span><span class=n>dataSource</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>BCryptPasswordEncoder</span><span class=w> </span><span class=n>passwordEncoder</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>protected</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>configure</span><span class=p>(</span><span class=n>AuthenticationManagerBuilder</span><span class=w> </span><span class=n>auth</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>Exception</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=n>auth</span><span class=p>.</span><span class=na>jdbcAuthentication</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>           </span><span class=p>.</span><span class=na>dataSource</span><span class=p>(</span><span class=n>dataSource</span><span class=p>)</span><span class=w> </span><span class=c1>//creates database connection</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>           </span><span class=p>.</span><span class=na>usersByUsernameQuery</span><span class=p>(</span><span class=s>&#34;select user_name,user_pwd,user_enabled from user where user_name=?&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>           </span><span class=p>.</span><span class=na>authoritiesByUsernameQuery</span><span class=p>(</span><span class=s>&#34;select user_name,user_role from user where user_name=?&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>           </span><span class=p>.</span><span class=na>passwordEncoder</span><span class=p>(</span><span class=n>passwordEncoder</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=示例5没有-websecurityconfigureradapter>示例#5：没有 WebSecurityConfigurerAdapter<a hidden class=anchor aria-hidden=true href=#示例5没有-websecurityconfigureradapter>#</a></h3><p>展望未来，如果我们想在没有 WebSecurityConfigurerAdapter 的情况下实现 Spring Security，新代码将如下所示。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@EnableWebSecurity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>SecurityConfig</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=kd>private</span><span class=w> </span><span class=n>DataSource</span><span class=w> </span><span class=n>dataSource</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=kd>public</span><span class=w> </span><span class=n>UserDetailsManager</span><span class=w> </span><span class=nf>authenticateUsers</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>UserDetails</span><span class=w> </span><span class=n>user</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>User</span><span class=p>.</span><span class=na>withUsername</span><span class=p>(</span><span class=s>&#34;username&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>password</span><span class=p>(</span><span class=n>PasswordEncoderFactories</span><span class=p>.</span><span class=na>createDelegatingPasswordEncoder</span><span class=p>().</span><span class=na>encode</span><span class=p>(</span><span class=s>&#34;password&#34;</span><span class=p>)).</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>JdbcUserDetailsManager</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>JdbcUserDetailsManager</span><span class=p>(</span><span class=n>dataSource</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>users</span><span class=p>.</span><span class=na>setAuthoritiesByUsernameQuery</span><span class=p>(</span><span class=s>&#34;select user_name,user_pwd,user_enabled from user where user_name=?&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>users</span><span class=p>.</span><span class=na>setUsersByUsernameQuery</span><span class=p>(</span><span class=s>&#34;select user_name,user_role from user where user_name=?&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>users</span><span class=p>.</span><span class=na>createUser</span><span class=p>(</span><span class=n>user</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>return</span><span class=w> </span><span class=n>users</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>新的实现将如上所示。这可能不是确切的解决方案。</p><h2 id=spring-security-600-或更高版本中有哪些弃用更新>Spring Security 6.0.0 或更高版本中有哪些弃用更新？<a hidden class=anchor aria-hidden=true href=#spring-security-600-或更高版本中有哪些弃用更新>#</a></h2><p>如果您使用 Spring Security 6.0.0 或更高版本（以及 Spring Boot 3.0 或更高版本），您还会看到其他 API 弃用。例如，以下是需要进行的一些更改：</p><ul><li><p>authorizeRequests() ->authorizeHttpRequests()</p></li><li><p>antMatchers() -> requestMatchers()</p></li><li><p>regexMatchers() -> RegexRequestMatchers()</p></li></ul><h2 id=faq>FAQ<a hidden class=anchor aria-hidden=true href=#faq>#</a></h2><h3 id=在哪里可以找到没有-websecurityconfigureradapter-的-spring-security-的完整示例>在哪里可以找到“没有 WebSecurityConfigurerAdapter 的 Spring Security 的完整示例？”<a hidden class=anchor aria-hidden=true href=#在哪里可以找到没有-websecurityconfigureradapter-的-spring-security-的完整示例>#</a></h3><p>以下是查找“没有 WebSecurityConfigurerAdapter 的 Spring Security”完整示例的链接：</p><ol><li><p><a href=https://javatechonline.com/how-to-implement-security-in-spring-boot-project/ target=_blank>How To Implement Security In Spring Boot Project?</a></p></li><li><p><a href=https://javatechonline.com/how-to-implement-security-in-spring-boot-using-userdetailsservice/ target=_blank>How to implement Role Based Spring Security Without WebSecurityConfigurerAdapter in Spring Boot using UserDetailsService?</a></p></li><li><p><a href=https://javatechonline.com/how-to-implement-jwt-authentication-in-spring-boot-project/ target=_blank>How to implement JWT Authentication in Spring Boot Project?</a></p></li></ol><h2 id=结论>结论<a hidden class=anchor aria-hidden=true href=#结论>#</a></h2><p>在完成了“没有 WebSecurityConfigurerAdapter 的 Spring Security”的所有理论和示例部分之后，最后，我们应该准备好在实时项目中处理警告“WebSecurityConfigurerAdapter Deprecated”。此外，我们希望您扩展“没有 WebSecurityConfigurerAdapter 的 Spring Security”一文中提供的知识，并在您的项目中相应地实现该概念。如需进一步学习 Spring Security，您可以访问 Spring Security 使用 Spring Boot 系列教程。另外，如果后续有任何更新，我们也会对文章进行相应的更新。此外，请随时在下面的评论部分提供您的意见。</p><p>原文链接：<a href=https://javatechonline.com/spring-security-without-websecurityconfigureradapter/ target=_blank>https://javatechonline.com/spring-security-without-websecurityconfigureradapter/</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.chensoul.cc/tags/spring-security/>Spring-Security</a></li></ul><nav class=paginav><a class=prev href=https://blog.chensoul.cc/posts/2023/08/18/how-to-implement-security-in-spring-boot3-using-userdetailsservice/><span class=title>« Prev</span><br><span>[译]如何在Spring Boot3中使用UserDetailsService实现安全性？</span>
</a><a class=next href=https://blog.chensoul.cc/posts/2023/08/16/spring-security-with-jwt/><span class=title>Next »</span><br><span>[译]Spring Security - JWT</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share [译]没有WebSecurityConfigurerAdapter的Spring Security.md on x" href="https://x.com/intent/tweet/?text=%5b%e8%af%91%5d%e6%b2%a1%e6%9c%89WebSecurityConfigurerAdapter%e7%9a%84Spring%20Security.md&amp;url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f08%2f18%2fspring-security-without-websecurityconfigureradapter%2f&amp;hashtags=spring-security"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [译]没有WebSecurityConfigurerAdapter的Spring Security.md on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f08%2f18%2fspring-security-without-websecurityconfigureradapter%2f&amp;title=%5b%e8%af%91%5d%e6%b2%a1%e6%9c%89WebSecurityConfigurerAdapter%e7%9a%84Spring%20Security.md&amp;summary=%5b%e8%af%91%5d%e6%b2%a1%e6%9c%89WebSecurityConfigurerAdapter%e7%9a%84Spring%20Security.md&amp;source=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f08%2f18%2fspring-security-without-websecurityconfigureradapter%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [译]没有WebSecurityConfigurerAdapter的Spring Security.md on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f08%2f18%2fspring-security-without-websecurityconfigureradapter%2f&title=%5b%e8%af%91%5d%e6%b2%a1%e6%9c%89WebSecurityConfigurerAdapter%e7%9a%84Spring%20Security.md"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [译]没有WebSecurityConfigurerAdapter的Spring Security.md on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f08%2f18%2fspring-security-without-websecurityconfigureradapter%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [译]没有WebSecurityConfigurerAdapter的Spring Security.md on whatsapp" href="https://api.whatsapp.com/send?text=%5b%e8%af%91%5d%e6%b2%a1%e6%9c%89WebSecurityConfigurerAdapter%e7%9a%84Spring%20Security.md%20-%20https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f08%2f18%2fspring-security-without-websecurityconfigureradapter%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [译]没有WebSecurityConfigurerAdapter的Spring Security.md on telegram" href="https://telegram.me/share/url?text=%5b%e8%af%91%5d%e6%b2%a1%e6%9c%89WebSecurityConfigurerAdapter%e7%9a%84Spring%20Security.md&amp;url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f08%2f18%2fspring-security-without-websecurityconfigureradapter%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [译]没有WebSecurityConfigurerAdapter的Spring Security.md on ycombinator" href="https://news.ycombinator.com/submitlink?t=%5b%e8%af%91%5d%e6%b2%a1%e6%9c%89WebSecurityConfigurerAdapter%e7%9a%84Spring%20Security.md&u=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f08%2f18%2fspring-security-without-websecurityconfigureradapter%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://blog.chensoul.cc/>ChenSoul</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script async src=https://umami.chensoul.cc/random-string.js data-website-id=821c25f8-a31a-4607-92d7-91ee76843d00></script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>