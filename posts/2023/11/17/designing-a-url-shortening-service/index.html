<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>如何设计一个短网址服务 | ChenSoul</title>
<meta name=keywords content="architecture"><meta name=description content="如何生成一个短网址服务，参考 Design a URL Shortening Service / TinyURL 和 Designing a URL Shortening service like TinyURL 两篇文章，整理如下笔记。
其中主要包括以下内容：
设计一个系统有哪些步骤 需求 预估 设计 高层次设计 API 设计 细节设计 评估 设计一个短网址服务的细节 设计步骤 Requirements 需求
功能性需求 短 URL 生成：我们的服务应该能够为给定 URL 生成唯一的较短别名。 重定向：给定一个短链接，我们的系统应该能够将用户重定向到原始 URL。 自定义短链接：用户应该能够使用我们的系统为其 URL 生成自定义短链接。 删除：在赋予权限的情况下，用户应该能够删除我们系统生成的短链接。 更新：如果有适当的权限，用户应该能够更新与短链接关联的长 URL。 过期时间：短链接必须有一个默认的过期时间，但用户应该可以根据自己的需求设置过期时间。 分功能性需求：可用性、可靠性、扩展性、可维护性、容错性 可用性：我们的系统应该具有高可用性，因为即使是第二次停机的一小部分也会导致 URL 重定向失败。由于我们系统的域位于 URL 中，因此我们没有停机时间的优势，并且我们的设计必须灌输容错条件。 可扩展性：我们的系统应该能够随着需求的增加而水平扩展。 可读性：我们的系统生成的短链接应该易于阅读、区分和输入。 延迟：系统应以低延迟执行，以便为用户提供流畅的体验。 不可预测性：从安全角度来看，我们的系统生成的短链接应该是高度不可预测的。这确保了下一个短 URL 不会连续生成，从而消除了有人猜测我们的系统已经生成或将生成的所有短 URL 的可能性。 Estimation 估计
流量 读写比：1:100 每月请求数：2 亿 单条记录占用空间：500B 记录保存多长时间：5 年 每日活跃用户 (DAU) ：1 亿 存储 5 年记录数：2 亿 x 5 x 12 =120 亿 总存储：120 亿 x 500B= 120 亿 x 0.5KB=6TB 带宽 每秒写请求：2 亿 / 30 /24 /60 /60 = 77次/s 写入带宽：77 x 500B =38KB/s 读带宽：38 x 100 =3."><meta name=author content="chensoul"><link rel=canonical href=https://blog.chensoul.cc/posts/2023/11/17/designing-a-url-shortening-service/><meta name=google-site-verification content="nBXwg45SBRjTX78SA-mH0asrAbsdu9c1nk0ObSry7aQ"><link crossorigin=anonymous href=/assets/css/stylesheet.41fda683d7f28f86c97812787adcc91d7e2ab1225be098c611c57b4995b061db.css integrity="sha256-Qf2mg9fyj4bJeBJ4etzJHX4qsSJb4JjGEcV7SZWwYds=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.chensoul.cc/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.chensoul.cc/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.chensoul.cc/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.chensoul.cc/apple-touch-icon.png><link rel=mask-icon href=https://blog.chensoul.cc/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.chensoul.cc/posts/2023/11/17/designing-a-url-shortening-service/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta name=baidu-site-verification content="codeva-FYpQY8JdLU"><meta property="og:title" content="如何设计一个短网址服务"><meta property="og:description" content="如何生成一个短网址服务，参考 Design a URL Shortening Service / TinyURL 和 Designing a URL Shortening service like TinyURL 两篇文章，整理如下笔记。
其中主要包括以下内容：
设计一个系统有哪些步骤 需求 预估 设计 高层次设计 API 设计 细节设计 评估 设计一个短网址服务的细节 设计步骤 Requirements 需求
功能性需求 短 URL 生成：我们的服务应该能够为给定 URL 生成唯一的较短别名。 重定向：给定一个短链接，我们的系统应该能够将用户重定向到原始 URL。 自定义短链接：用户应该能够使用我们的系统为其 URL 生成自定义短链接。 删除：在赋予权限的情况下，用户应该能够删除我们系统生成的短链接。 更新：如果有适当的权限，用户应该能够更新与短链接关联的长 URL。 过期时间：短链接必须有一个默认的过期时间，但用户应该可以根据自己的需求设置过期时间。 分功能性需求：可用性、可靠性、扩展性、可维护性、容错性 可用性：我们的系统应该具有高可用性，因为即使是第二次停机的一小部分也会导致 URL 重定向失败。由于我们系统的域位于 URL 中，因此我们没有停机时间的优势，并且我们的设计必须灌输容错条件。 可扩展性：我们的系统应该能够随着需求的增加而水平扩展。 可读性：我们的系统生成的短链接应该易于阅读、区分和输入。 延迟：系统应以低延迟执行，以便为用户提供流畅的体验。 不可预测性：从安全角度来看，我们的系统生成的短链接应该是高度不可预测的。这确保了下一个短 URL 不会连续生成，从而消除了有人猜测我们的系统已经生成或将生成的所有短 URL 的可能性。 Estimation 估计
流量 读写比：1:100 每月请求数：2 亿 单条记录占用空间：500B 记录保存多长时间：5 年 每日活跃用户 (DAU) ：1 亿 存储 5 年记录数：2 亿 x 5 x 12 =120 亿 总存储：120 亿 x 500B= 120 亿 x 0.5KB=6TB 带宽 每秒写请求：2 亿 / 30 /24 /60 /60 = 77次/s 写入带宽：77 x 500B =38KB/s 读带宽：38 x 100 =3."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.chensoul.cc/posts/2023/11/17/designing-a-url-shortening-service/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-11-17T00:00:00+08:00"><meta property="article:modified_time" content="2023-11-17T00:00:00+08:00"><meta property="og:site_name" content="ChenSoul"><meta name=twitter:card content="summary"><meta name=twitter:title content="如何设计一个短网址服务"><meta name=twitter:description content="如何生成一个短网址服务，参考 Design a URL Shortening Service / TinyURL 和 Designing a URL Shortening service like TinyURL 两篇文章，整理如下笔记。
其中主要包括以下内容：
设计一个系统有哪些步骤 需求 预估 设计 高层次设计 API 设计 细节设计 评估 设计一个短网址服务的细节 设计步骤 Requirements 需求
功能性需求 短 URL 生成：我们的服务应该能够为给定 URL 生成唯一的较短别名。 重定向：给定一个短链接，我们的系统应该能够将用户重定向到原始 URL。 自定义短链接：用户应该能够使用我们的系统为其 URL 生成自定义短链接。 删除：在赋予权限的情况下，用户应该能够删除我们系统生成的短链接。 更新：如果有适当的权限，用户应该能够更新与短链接关联的长 URL。 过期时间：短链接必须有一个默认的过期时间，但用户应该可以根据自己的需求设置过期时间。 分功能性需求：可用性、可靠性、扩展性、可维护性、容错性 可用性：我们的系统应该具有高可用性，因为即使是第二次停机的一小部分也会导致 URL 重定向失败。由于我们系统的域位于 URL 中，因此我们没有停机时间的优势，并且我们的设计必须灌输容错条件。 可扩展性：我们的系统应该能够随着需求的增加而水平扩展。 可读性：我们的系统生成的短链接应该易于阅读、区分和输入。 延迟：系统应以低延迟执行，以便为用户提供流畅的体验。 不可预测性：从安全角度来看，我们的系统生成的短链接应该是高度不可预测的。这确保了下一个短 URL 不会连续生成，从而消除了有人猜测我们的系统已经生成或将生成的所有短 URL 的可能性。 Estimation 估计
流量 读写比：1:100 每月请求数：2 亿 单条记录占用空间：500B 记录保存多长时间：5 年 每日活跃用户 (DAU) ：1 亿 存储 5 年记录数：2 亿 x 5 x 12 =120 亿 总存储：120 亿 x 500B= 120 亿 x 0.5KB=6TB 带宽 每秒写请求：2 亿 / 30 /24 /60 /60 = 77次/s 写入带宽：77 x 500B =38KB/s 读带宽：38 x 100 =3."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.chensoul.cc/posts/"},{"@type":"ListItem","position":2,"name":"如何设计一个短网址服务","item":"https://blog.chensoul.cc/posts/2023/11/17/designing-a-url-shortening-service/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"如何设计一个短网址服务","name":"如何设计一个短网址服务","description":"如何生成一个短网址服务，参考 Design a URL Shortening Service / TinyURL 和 Designing a URL Shortening service like TinyURL 两篇文章，整理如下笔记。\n其中主要包括以下内容：\n设计一个系统有哪些步骤 需求 预估 设计 高层次设计 API 设计 细节设计 评估 设计一个短网址服务的细节 设计步骤 Requirements 需求\n功能性需求 短 URL 生成：我们的服务应该能够为给定 URL 生成唯一的较短别名。 重定向：给定一个短链接，我们的系统应该能够将用户重定向到原始 URL。 自定义短链接：用户应该能够使用我们的系统为其 URL 生成自定义短链接。 删除：在赋予权限的情况下，用户应该能够删除我们系统生成的短链接。 更新：如果有适当的权限，用户应该能够更新与短链接关联的长 URL。 过期时间：短链接必须有一个默认的过期时间，但用户应该可以根据自己的需求设置过期时间。 分功能性需求：可用性、可靠性、扩展性、可维护性、容错性 可用性：我们的系统应该具有高可用性，因为即使是第二次停机的一小部分也会导致 URL 重定向失败。由于我们系统的域位于 URL 中，因此我们没有停机时间的优势，并且我们的设计必须灌输容错条件。 可扩展性：我们的系统应该能够随着需求的增加而水平扩展。 可读性：我们的系统生成的短链接应该易于阅读、区分和输入。 延迟：系统应以低延迟执行，以便为用户提供流畅的体验。 不可预测性：从安全角度来看，我们的系统生成的短链接应该是高度不可预测的。这确保了下一个短 URL 不会连续生成，从而消除了有人猜测我们的系统已经生成或将生成的所有短 URL 的可能性。 Estimation 估计\n流量 读写比：1:100 每月请求数：2 亿 单条记录占用空间：500B 记录保存多长时间：5 年 每日活跃用户 (DAU) ：1 亿 存储 5 年记录数：2 亿 x 5 x 12 =120 亿 总存储：120 亿 x 500B= 120 亿 x 0.5KB=6TB 带宽 每秒写请求：2 亿 / 30 /24 /60 /60 = 77次/s 写入带宽：77 x 500B =38KB/s 读带宽：38 x 100 =3.","keywords":["architecture"],"articleBody":"如何生成一个短网址服务，参考 Design a URL Shortening Service / TinyURL 和 Designing a URL Shortening service like TinyURL 两篇文章，整理如下笔记。\n其中主要包括以下内容：\n设计一个系统有哪些步骤 需求 预估 设计 高层次设计 API 设计 细节设计 评估 设计一个短网址服务的细节 设计步骤 Requirements 需求\n功能性需求 短 URL 生成：我们的服务应该能够为给定 URL 生成唯一的较短别名。 重定向：给定一个短链接，我们的系统应该能够将用户重定向到原始 URL。 自定义短链接：用户应该能够使用我们的系统为其 URL 生成自定义短链接。 删除：在赋予权限的情况下，用户应该能够删除我们系统生成的短链接。 更新：如果有适当的权限，用户应该能够更新与短链接关联的长 URL。 过期时间：短链接必须有一个默认的过期时间，但用户应该可以根据自己的需求设置过期时间。 分功能性需求：可用性、可靠性、扩展性、可维护性、容错性 可用性：我们的系统应该具有高可用性，因为即使是第二次停机的一小部分也会导致 URL 重定向失败。由于我们系统的域位于 URL 中，因此我们没有停机时间的优势，并且我们的设计必须灌输容错条件。 可扩展性：我们的系统应该能够随着需求的增加而水平扩展。 可读性：我们的系统生成的短链接应该易于阅读、区分和输入。 延迟：系统应以低延迟执行，以便为用户提供流畅的体验。 不可预测性：从安全角度来看，我们的系统生成的短链接应该是高度不可预测的。这确保了下一个短 URL 不会连续生成，从而消除了有人猜测我们的系统已经生成或将生成的所有短 URL 的可能性。 Estimation 估计\n流量 读写比：1:100 每月请求数：2 亿 单条记录占用空间：500B 记录保存多长时间：5 年 每日活跃用户 (DAU) ：1 亿 存储 5 年记录数：2 亿 x 5 x 12 =120 亿 总存储：120 亿 x 500B= 120 亿 x 0.5KB=6TB 带宽 每秒写请求：2 亿 / 30 /24 /60 /60 = 77次/s 写入带宽：77 x 500B =38KB/s 读带宽：38 x 100 =3.8MB/s 内存：存储的 20% 每天缓存内存：77 x 100 x 24 x 3600 x 20% x 500B = 66GB 服务器： 数据量：1亿 /8000=12500 为什么按单台服务器处理并发请求 8000 计算？ Design 设计\nHigh-Level design 高层次设计\n组件\n数据库：需要数据库来存储长 URL 和相应的短 URL 的映射。 序列器：Sequencer 将提供唯一的 ID，作为每个短 URL 生成的起点。 负载均衡：各个层的负载均衡器将确保可用服务器之间的请求平稳分配。 缓存：缓存将用于存储最频繁的短 URL 相关请求。 限流器：将使用速率限制器来避免系统被利用。 服务器：用于处理和导航服务请求以及运行应用程序逻辑。 Base-58 编码器：用于将序列器的数字输出转换为更可读和更可用的字母数字形式。 设计图\nApplication Programming Interfaces (APIs) API 设计\nREST API 创建短网址 shortURL(api_dev_key, original_url, custom_alias=None, expiry_date=None) 重定向短网址 redirectURL(api_dev_key, url_key) 删除短网址 deleteURL(api_dev_key, url_key) Detailed design 详细设计\n组件 数据库：\n存储\n用户表\nID、name URL 的映射\nID、url、createDate、expireDate、userId 选择 NoSQL：\n选择 MongoDB：\n它使用领导者-跟随者协议，使得使用副本进行大量读取成为可能。 MongoDB 确保并发写入操作的原子性，并通过针对记录重复问题返回重复键错误来避免冲突。 为什么不选择 Cassandra、Riak 和 DynamoDB 等 NoSQL 数据库？\nCassandra、Riak 和 DynamoDB 等 NoSQL 数据库在读取阶段需要读取修复，因此读取写入性能较慢。\n它们是无领导者的 NoSQL 数据库，在并发写入时提供较弱的数据一致性保证。\n序列器：\n用于生成唯一 ID 的序列器 序列器生成 64 位的整数 ID，大小限制为从 1 亿到 2^63-1，最大位数为 20 表示一个十进制数字所需的位数 log2(10) ≈ 3.32 64位数值ID中的十进制数字的总位数 64/3.32 ≈ 20 将生成的 ID 转换为 58 进制，最大位数为 11 表示一个58进制数字所需的位数 log2(58) ≈ 5.8585 64位数值ID中的58进制数字的总位数 64/5.8585 ≈ 11 生命周期 可用的 ID 数量 2^64 -10^9= 18446644 亿 可以使用多少年 18446644 亿 / 24亿=7686143363.63年 Base-58 编码器 从 64 字符（包括 A-Z、a-z、0-9、 + 和 / ）删除 6 个（+、/、0 、 O 、 I 和 l）以增强可读性 负载均衡\n本地负载均衡 客户端和应用服务器之间 应用服务器和数据库服务器之间 应用服务器和缓存服务器之间 全局负载均衡 数据库地理位置一致 如果使用数据中心，则可以在短地址中添加字符表示数据中心：http://service.com/x/short123 缓存\n限制每个用户的配额 读密集型，选择 Memcached 使用 LRU 缓存来淘汰不经常访问的网址 限流器：固定窗口计数器算法\n设计图 工作流 创建短网址\n自定义非必填，别名长度不能大于 11，不能小于 3 重定向短网址\n使用 302 重定向：可以对短网址进行统计 301 永久重定向：第一次请求拿到长链接后，下次浏览器再去请求短链的话，不会向短网址服务器请求了，而是直接从浏览器的缓存里拿，减少对服务器的压力 302 临时重定向：每次去请求短链都会去请求短网址服务器（除非响应中用 Cache-Control 或 Expired 暗示浏览器进行缓存） 删除短网址\n用户通过 Rest API 删除 用户访问过期的短网址时，删除 运行定时任务，先删数据库记录，再删缓存。如果需要再保险一点，再启用延时双删，或者直接同步数据库的 binlog 来删缓存 Evaluation 评估\n高可用 每天备份存储和缓存服务器，最好一天两次 全局服务器负载平衡来处理系统的流量。 速率限制器限制每个用户的资源分配。 扩展性 数据库的水平分片。 MongoDB - 作为 NoSQL 数据库。 基于一致性哈希的数据分布。 可读性 引入 Base-58 编码器来生成短 URL。 删除非字母数字字符。 删除相似的字符。 延迟 MongoDB 低延迟和高吞吐量。 分布式缓存，最大限度减少服务延迟。 不可预计性 ID 唯一且不可预测 参考文章 Designing a URL Shortening service like TinyURL\nDesign a URL Shortening Service / TinyURL\n后端面试之系统设计-短网址（Short URL）服务怎么设计？\n[万字长文] 系统设计之路：如何设计一个URL短链服务\n短 URL 系统是怎么设计的？ - iammutex 的回答 - 知乎\n","wordCount":"371","inLanguage":"en","datePublished":"2023-11-17T00:00:00+08:00","dateModified":"2023-11-17T00:00:00+08:00","author":{"@type":"Person","name":"chensoul"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.chensoul.cc/posts/2023/11/17/designing-a-url-shortening-service/"},"publisher":{"@type":"Organization","name":"ChenSoul","logo":{"@type":"ImageObject","url":"https://blog.chensoul.cc/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.chensoul.cc/ accesskey=h title="ChenSoul (Alt + H)">ChenSoul</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.chensoul.cc/categories title=分类><span>分类</span></a></li><li><a href=https://blog.chensoul.cc/tags title=标签><span>标签</span></a></li><li><a href=https://blog.chensoul.cc/search title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li><li><a href=https://blog.chensoul.cc/index.xml title=订阅><span>订阅</span></a></li><li><a href=https://github.com/chensoul title=关于><span>关于</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">如何设计一个短网址服务</h1><div class=post-meta><span title='2023-11-17 00:00:00 +0800 CST'>2023-11-17</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;371 words&nbsp;·&nbsp;chensoul</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e8%ae%be%e8%ae%a1%e6%ad%a5%e9%aa%a4 aria-label=设计步骤>设计步骤</a></li><li><a href=#%e5%8f%82%e8%80%83%e6%96%87%e7%ab%a0 aria-label=参考文章>参考文章</a></li></ul></div></details></div><div class=post-content><p>如何生成一个短网址服务，参考 <a href=https://www.educative.io/courses/grokking-modern-system-design-interview-for-engineers-managers/system-design-tinyurl>Design a URL Shortening Service / TinyURL</a> 和 <a href=https://www.designgurus.io/course-play/grokking-the-system-design-interview/doc/638c0b5dac93e7ae59a1af6b>Designing a URL Shortening service like TinyURL</a> 两篇文章，整理如下笔记。</p><p>其中主要包括以下内容：</p><ul><li>设计一个系统有哪些步骤<ul><li>需求</li><li>预估</li><li>设计<ul><li>高层次设计</li><li>API 设计</li><li>细节设计</li></ul></li><li>评估</li></ul></li><li>设计一个短网址服务的细节</li></ul><h2 id=设计步骤>设计步骤<a hidden class=anchor aria-hidden=true href=#设计步骤>#</a></h2><ul><li><p>Requirements 需求</p><ul><li>功能性需求<ul><li>短 URL 生成：我们的服务应该能够为给定 URL 生成唯一的较短别名。</li><li>重定向：给定一个短链接，我们的系统应该能够将用户重定向到原始 URL。</li><li>自定义短链接：用户应该能够使用我们的系统为其 URL 生成自定义短链接。</li><li>删除：在赋予权限的情况下，用户应该能够删除我们系统生成的短链接。</li><li>更新：如果有适当的权限，用户应该能够更新与短链接关联的长 URL。</li><li>过期时间：短链接必须有一个默认的过期时间，但用户应该可以根据自己的需求设置过期时间。</li></ul></li><li>分功能性需求：可用性、可靠性、扩展性、可维护性、容错性<ul><li>可用性：我们的系统应该具有高可用性，因为即使是第二次停机的一小部分也会导致 URL 重定向失败。由于我们系统的域位于 URL 中，因此我们没有停机时间的优势，并且我们的设计必须灌输容错条件。</li><li>可扩展性：我们的系统应该能够随着需求的增加而水平扩展。</li><li>可读性：我们的系统生成的短链接应该易于阅读、区分和输入。</li><li>延迟：系统应以低延迟执行，以便为用户提供流畅的体验。</li><li>不可预测性：从安全角度来看，我们的系统生成的短链接应该是高度不可预测的。这确保了下一个短 URL 不会连续生成，从而消除了有人猜测我们的系统已经生成或将生成的所有短 URL 的可能性。</li></ul></li></ul></li><li><p>Estimation 估计</p><ul><li>流量<ul><li>读写比：1:100</li><li>每月请求数：2 亿</li><li>单条记录占用空间：500B</li><li>记录保存多长时间：5 年</li><li>每日活跃用户 (DAU) ：1 亿</li></ul></li><li>存储<ul><li>5 年记录数：2 亿 x 5 x 12 =120 亿</li><li>总存储：120 亿 x 500B= 120 亿 x 0.5KB=6TB</li></ul></li><li>带宽<ul><li>每秒写请求：2 亿 / 30 /24 /60 /60 = 77次/s</li><li>写入带宽：77 x 500B =38KB/s</li><li>读带宽：38 x 100 =3.8MB/s</li></ul></li><li>内存：存储的 20%<ul><li>每天缓存内存：77 x 100 x 24 x 3600 x 20% x 500B = 66GB</li></ul></li><li>服务器：<ul><li>数据量：1亿 /8000=12500<ul><li>为什么按单台服务器处理并发请求 8000 计算？</li></ul></li></ul></li></ul></li><li><p>Design 设计</p><ul><li><p>High-Level design 高层次设计</p><ul><li><p>组件</p><ul><li>数据库：需要数据库来存储长 URL 和相应的短 URL 的映射。</li><li>序列器：Sequencer 将提供唯一的 ID，作为每个短 URL 生成的起点。</li><li>负载均衡：各个层的负载均衡器将确保可用服务器之间的请求平稳分配。</li><li>缓存：缓存将用于存储最频繁的短 URL 相关请求。</li><li>限流器：将使用速率限制器来避免系统被利用。</li><li>服务器：用于处理和导航服务请求以及运行应用程序逻辑。</li><li>Base-58 编码器：用于将序列器的数字输出转换为更可读和更可用的字母数字形式。</li></ul></li><li><p>设计图</p><p><img loading=lazy src=https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/tinyurl-6.webp alt=image-20231117101338021></p></li></ul></li><li><p>Application Programming Interfaces (APIs) API 设计</p><ul><li>REST API<ul><li>创建短网址<ul><li><code>shortURL(api_dev_key, original_url, custom_alias=None, expiry_date=None)</code></li></ul></li><li>重定向短网址<ul><li><code>redirectURL(api_dev_key, url_key)</code></li></ul></li><li>删除短网址<ul><li><code>deleteURL(api_dev_key, url_key)</code></li></ul></li></ul></li></ul></li><li><p>Detailed design 详细设计</p><ul><li>组件<ul><li><p>数据库：</p><ul><li><p>存储</p><ul><li><p>用户表</p><ul><li>ID、name</li></ul></li><li><p>URL 的映射</p><ul><li>ID、url、createDate、expireDate、userId</li></ul></li></ul></li><li><p>选择 NoSQL：</p><ul><li><p>选择 MongoDB：</p><ul><li>它使用领导者-跟随者协议，使得使用副本进行大量读取成为可能。</li><li>MongoDB 确保并发写入操作的原子性，并通过针对记录重复问题返回重复键错误来避免冲突。</li></ul></li><li><p>为什么不选择 Cassandra、Riak 和 DynamoDB 等 NoSQL 数据库？</p><ul><li><p>Cassandra、Riak 和 DynamoDB 等 NoSQL 数据库在读取阶段需要读取修复，因此读取写入性能较慢。</p></li><li><p>它们是无领导者的 NoSQL 数据库，在并发写入时提供较弱的数据一致性保证。</p></li></ul></li></ul></li></ul></li><li><p>序列器：</p><ul><li>用于生成唯一 ID 的序列器<ul><li>序列器生成 64 位的整数 ID，大小限制为从 1 亿到 2^63-1，最大位数为 20<ul><li>表示一个十进制数字所需的位数 log2(10) ≈ 3.32</li><li>64位数值ID中的十进制数字的总位数 64/3.32 ≈ 20</li></ul></li><li>将生成的 ID 转换为 58 进制，最大位数为 11<ul><li>表示一个58进制数字所需的位数 log2(58) ≈ 5.8585</li><li>64位数值ID中的58进制数字的总位数 64/5.8585 ≈ 11</li></ul></li><li>生命周期<ul><li>可用的 ID 数量 2^64 -10^9= 18446644 亿</li><li>可以使用多少年 18446644 亿 / 24亿=7686143363.63年</li></ul></li></ul></li><li>Base-58 编码器<ul><li>从 64 字符（包括 A-Z、a-z、0-9、 <code>+</code> 和 <code>/</code> ）删除 6 个（<code>+</code>、<code>/</code>、<code>0</code> 、 <code>O</code> 、 <code>I</code> 和 <code>l</code>）以增强可读性</li></ul></li></ul></li><li><p>负载均衡</p><ul><li>本地负载均衡<ul><li>客户端和应用服务器之间</li><li>应用服务器和数据库服务器之间</li><li>应用服务器和缓存服务器之间</li></ul></li><li>全局负载均衡<ul><li>数据库地理位置一致</li><li>如果使用数据中心，则可以在短地址中添加字符表示数据中心：<a href=http://service.com/x/short123/>http://service.com/x/short123</a></li></ul></li></ul></li><li><p>缓存</p><ul><li>限制每个用户的配额</li><li>读密集型，选择 Memcached</li><li>使用 LRU 缓存来淘汰不经常访问的网址</li></ul></li><li><p>限流器：固定窗口计数器算法</p></li></ul></li><li>设计图</li><li>工作流<ul><li><p>创建短网址</p><ul><li>自定义非必填，别名长度不能大于 11，不能小于 3</li></ul></li><li><p>重定向短网址</p><ul><li>使用 302 重定向：可以对短网址进行统计<ul><li>301 永久重定向：第一次请求拿到长链接后，下次浏览器再去请求短链的话，不会向短网址服务器请求了，而是直接从浏览器的缓存里拿，减少对服务器的压力</li><li>302 临时重定向：每次去请求短链都会去请求短网址服务器（除非响应中用 Cache-Control 或 Expired 暗示浏览器进行缓存）</li></ul></li></ul></li><li><p>删除短网址</p><ul><li>用户通过 Rest API 删除</li><li>用户访问过期的短网址时，删除</li><li>运行定时任务，先删数据库记录，再删缓存。如果需要再保险一点，再启用延时双删，或者直接同步数据库的 binlog 来删缓存</li></ul></li></ul></li></ul></li></ul></li><li><p>Evaluation 评估</p><ul><li>高可用<ul><li>每天备份存储和缓存服务器，最好一天两次</li><li>全局服务器负载平衡来处理系统的流量。</li><li>速率限制器限制每个用户的资源分配。</li></ul></li><li>扩展性<ul><li>数据库的水平分片。</li><li>MongoDB - 作为 NoSQL 数据库。</li><li>基于一致性哈希的数据分布。</li></ul></li><li>可读性<ul><li>引入 Base-58 编码器来生成短 URL。</li><li>删除非字母数字字符。</li><li>删除相似的字符。</li></ul></li><li>延迟<ul><li>MongoDB 低延迟和高吞吐量。</li><li>分布式缓存，最大限度减少服务延迟。</li></ul></li><li>不可预计性<ul><li>ID 唯一且不可预测</li></ul></li></ul></li></ul><h2 id=参考文章>参考文章<a hidden class=anchor aria-hidden=true href=#参考文章>#</a></h2><ul><li><p><a href=https://www.designgurus.io/course-play/grokking-the-system-design-interview/doc/638c0b5dac93e7ae59a1af6b>Designing a URL Shortening service like TinyURL</a></p></li><li><p><a href=https://www.educative.io/courses/grokking-modern-system-design-interview-for-engineers-managers/system-design-tinyurl>Design a URL Shortening Service / TinyURL</a></p></li><li><p><a href=https://www.techxiaofei.com/post/system_design/short_url/>后端面试之系统设计-短网址（Short URL）服务怎么设计？</a></p></li><li><p><a href="https://mp.weixin.qq.com/s?__biz=Mzg3NjU1NzM1Mw==&amp;mid=2247490066&amp;idx=1&amp;sn=d133a358dbc79f2ca9293dae57f31532&amp;chksm=cf313f54f846b642bff07d81d94ab42ea744fca0e7a299b8e76f1f6a97a74685222ec80b0ca1&amp;token=996492862&amp;lang=zh_CN#rd">[万字长文] 系统设计之路：如何设计一个URL短链服务</a></p></li><li><p><a href=https://www.zhihu.com/question/29270034/answer/46446911>短 URL 系统是怎么设计的？ - iammutex 的回答 - 知乎</a></p></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.chensoul.cc/tags/architecture/>Architecture</a></li></ul><nav class=paginav><a class=prev href=https://blog.chensoul.cc/posts/2023/11/17/dns/><span class=title>« Prev</span><br><span>[译]《Grokking the System Design Interview》域名系统</span>
</a><a class=next href=https://blog.chensoul.cc/posts/2023/11/16/system-design-master-template/><span class=title>Next »</span><br><span>[译]《Grokking the System Design Interview》系统设计主模板</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share 如何设计一个短网址服务 on x" href="https://x.com/intent/tweet/?text=%e5%a6%82%e4%bd%95%e8%ae%be%e8%ae%a1%e4%b8%80%e4%b8%aa%e7%9f%ad%e7%bd%91%e5%9d%80%e6%9c%8d%e5%8a%a1&amp;url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f11%2f17%2fdesigning-a-url-shortening-service%2f&amp;hashtags=architecture"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 如何设计一个短网址服务 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f11%2f17%2fdesigning-a-url-shortening-service%2f&amp;title=%e5%a6%82%e4%bd%95%e8%ae%be%e8%ae%a1%e4%b8%80%e4%b8%aa%e7%9f%ad%e7%bd%91%e5%9d%80%e6%9c%8d%e5%8a%a1&amp;summary=%e5%a6%82%e4%bd%95%e8%ae%be%e8%ae%a1%e4%b8%80%e4%b8%aa%e7%9f%ad%e7%bd%91%e5%9d%80%e6%9c%8d%e5%8a%a1&amp;source=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f11%2f17%2fdesigning-a-url-shortening-service%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 如何设计一个短网址服务 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f11%2f17%2fdesigning-a-url-shortening-service%2f&title=%e5%a6%82%e4%bd%95%e8%ae%be%e8%ae%a1%e4%b8%80%e4%b8%aa%e7%9f%ad%e7%bd%91%e5%9d%80%e6%9c%8d%e5%8a%a1"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 如何设计一个短网址服务 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f11%2f17%2fdesigning-a-url-shortening-service%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 如何设计一个短网址服务 on whatsapp" href="https://api.whatsapp.com/send?text=%e5%a6%82%e4%bd%95%e8%ae%be%e8%ae%a1%e4%b8%80%e4%b8%aa%e7%9f%ad%e7%bd%91%e5%9d%80%e6%9c%8d%e5%8a%a1%20-%20https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f11%2f17%2fdesigning-a-url-shortening-service%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 如何设计一个短网址服务 on telegram" href="https://telegram.me/share/url?text=%e5%a6%82%e4%bd%95%e8%ae%be%e8%ae%a1%e4%b8%80%e4%b8%aa%e7%9f%ad%e7%bd%91%e5%9d%80%e6%9c%8d%e5%8a%a1&amp;url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f11%2f17%2fdesigning-a-url-shortening-service%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 如何设计一个短网址服务 on ycombinator" href="https://news.ycombinator.com/submitlink?t=%e5%a6%82%e4%bd%95%e8%ae%be%e8%ae%a1%e4%b8%80%e4%b8%aa%e7%9f%ad%e7%bd%91%e5%9d%80%e6%9c%8d%e5%8a%a1&u=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f11%2f17%2fdesigning-a-url-shortening-service%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://blog.chensoul.cc/>ChenSoul</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script async src=https://umami.chensoul.cc/random-string.js data-website-id=821c25f8-a31a-4607-92d7-91ee76843d00></script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>