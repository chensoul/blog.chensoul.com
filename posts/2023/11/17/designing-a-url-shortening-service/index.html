<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>如何设计一个短网址服务 | ChenSoul</title>
<meta name=keywords content="architecture"><meta name=description content="如何生成一个短网址服务，参考 Design a URL Shortening Service / TinyURL 和 Designing a URL Shortening service like TinyURL 两篇文章，整理如下笔记。
其中主要包括以下内容：
设计一个系统有哪些步骤 需求 预估 设计 高层次设计 API 设计 细节设计 评估 设计一个短网址服务的细节 设计步骤 Requirements 需求
功能性需求 短 URL 生成：我们的服务应该能够为给定 URL 生成唯一的较短别名。 重定向：给定一个短链接，我们的系统应该能够将用户重定向到原始 URL。 自定义短链接：用户应该能够使用我们的系统为其 URL 生成自定义短链接。 删除：在赋予权限的情况下，用户应该能够删除我们系统生成的短链接。 更新：如果有适当的权限，用户应该能够更新与短链接关联的长 URL。 过期时间：短链接必须有一个默认的过期时间，但用户应该可以根据自己的需求设置过期时间。 分功能性需求：可用性、可靠性、扩展性、可维护性、容错性 可用性：我们的系统应该具有高可用性，因为即使是第二次停机的一小部分也会导致 URL 重定向失败。由于我们系统的域位于 URL 中，因此我们没有停机时间的优势，并且我们的设计必须灌输容错条件。 可扩展性：我们的系统应该能够随着需求的增加而水平扩展。 可读性：我们的系统生成的短链接应该易于阅读、区分和输入。 延迟：系统应以低延迟执行，以便为用户提供流畅的体验。 不可预测性：从安全角度来看，我们的系统生成的短链接应该是高度不可预测的。这确保了下一个短 URL 不会连续生成，从而消除了有人猜测我们的系统已经生成或将生成的所有短 URL 的可能性。 Estimation 估计
流量 读写比：1:100 每月请求数：2 亿 单条记录占用空间：500B 记录保存多长时间：5 年 每日活跃用户 (DAU) ：1 亿 存储 5 年记录数：2 亿 x 5 x 12 =120 亿 总存储：120 亿 x 500B= 120 亿 x 0.5KB=6TB 带宽 每秒写请求：2 亿 / 30 /24 /60 /60 = 77次/s 写入带宽：77 x 500B =38KB/s 读带宽：38 x 100 =3."><meta name=author content="chensoul"><link rel=canonical href=https://blog.chensoul.cc/posts/2023/11/17/designing-a-url-shortening-service/><link crossorigin=anonymous href=/assets/css/stylesheet.min.d6db7ab468e55ea6647d68be426a17bae21ff1cddbf1741e547ed2086d010444.css integrity="sha256-1tt6tGjlXqZkfWi+QmoXuuIf8c3b8XQeVH7SCG0BBEQ=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.chensoul.cc/favicon.ico><link rel=apple-touch-icon href=https://blog.chensoul.cc/apple-touch-icon.png><meta name=twitter:title content="如何设计一个短网址服务 | ChenSoul"><meta name=twitter:description content="如何生成一个短网址服务，参考 Design a URL Shortening Service / TinyURL 和 Designing a URL Shortening service like TinyURL 两篇文章，整理如下笔记。
其中主要包括以下内容：
设计一个系统有哪些步骤 需求 预估 设计 高层次设计 API 设计 细节设计 评估 设计一个短网址服务的细节 设计步骤 Requirements 需求
功能性需求 短 URL 生成：我们的服务应该能够为给定 URL 生成唯一的较短别名。 重定向：给定一个短链接，我们的系统应该能够将用户重定向到原始 URL。 自定义短链接：用户应该能够使用我们的系统为其 URL 生成自定义短链接。 删除：在赋予权限的情况下，用户应该能够删除我们系统生成的短链接。 更新：如果有适当的权限，用户应该能够更新与短链接关联的长 URL。 过期时间：短链接必须有一个默认的过期时间，但用户应该可以根据自己的需求设置过期时间。 分功能性需求：可用性、可靠性、扩展性、可维护性、容错性 可用性：我们的系统应该具有高可用性，因为即使是第二次停机的一小部分也会导致 URL 重定向失败。由于我们系统的域位于 URL 中，因此我们没有停机时间的优势，并且我们的设计必须灌输容错条件。 可扩展性：我们的系统应该能够随着需求的增加而水平扩展。 可读性：我们的系统生成的短链接应该易于阅读、区分和输入。 延迟：系统应以低延迟执行，以便为用户提供流畅的体验。 不可预测性：从安全角度来看，我们的系统生成的短链接应该是高度不可预测的。这确保了下一个短 URL 不会连续生成，从而消除了有人猜测我们的系统已经生成或将生成的所有短 URL 的可能性。 Estimation 估计
流量 读写比：1:100 每月请求数：2 亿 单条记录占用空间：500B 记录保存多长时间：5 年 每日活跃用户 (DAU) ：1 亿 存储 5 年记录数：2 亿 x 5 x 12 =120 亿 总存储：120 亿 x 500B= 120 亿 x 0.5KB=6TB 带宽 每秒写请求：2 亿 / 30 /24 /60 /60 = 77次/s 写入带宽：77 x 500B =38KB/s 读带宽：38 x 100 =3."><meta property="og:title" content="如何设计一个短网址服务 | ChenSoul"><meta property="og:description" content="如何生成一个短网址服务，参考 Design a URL Shortening Service / TinyURL 和 Designing a URL Shortening service like TinyURL 两篇文章，整理如下笔记。
其中主要包括以下内容：
设计一个系统有哪些步骤 需求 预估 设计 高层次设计 API 设计 细节设计 评估 设计一个短网址服务的细节 设计步骤 Requirements 需求
功能性需求 短 URL 生成：我们的服务应该能够为给定 URL 生成唯一的较短别名。 重定向：给定一个短链接，我们的系统应该能够将用户重定向到原始 URL。 自定义短链接：用户应该能够使用我们的系统为其 URL 生成自定义短链接。 删除：在赋予权限的情况下，用户应该能够删除我们系统生成的短链接。 更新：如果有适当的权限，用户应该能够更新与短链接关联的长 URL。 过期时间：短链接必须有一个默认的过期时间，但用户应该可以根据自己的需求设置过期时间。 分功能性需求：可用性、可靠性、扩展性、可维护性、容错性 可用性：我们的系统应该具有高可用性，因为即使是第二次停机的一小部分也会导致 URL 重定向失败。由于我们系统的域位于 URL 中，因此我们没有停机时间的优势，并且我们的设计必须灌输容错条件。 可扩展性：我们的系统应该能够随着需求的增加而水平扩展。 可读性：我们的系统生成的短链接应该易于阅读、区分和输入。 延迟：系统应以低延迟执行，以便为用户提供流畅的体验。 不可预测性：从安全角度来看，我们的系统生成的短链接应该是高度不可预测的。这确保了下一个短 URL 不会连续生成，从而消除了有人猜测我们的系统已经生成或将生成的所有短 URL 的可能性。 Estimation 估计
流量 读写比：1:100 每月请求数：2 亿 单条记录占用空间：500B 记录保存多长时间：5 年 每日活跃用户 (DAU) ：1 亿 存储 5 年记录数：2 亿 x 5 x 12 =120 亿 总存储：120 亿 x 500B= 120 亿 x 0.5KB=6TB 带宽 每秒写请求：2 亿 / 30 /24 /60 /60 = 77次/s 写入带宽：77 x 500B =38KB/s 读带宽：38 x 100 =3."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.chensoul.cc/posts/2023/11/17/designing-a-url-shortening-service/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-11-17T16:30:00+08:00"><meta property="article:modified_time" content="2023-11-17T16:30:00+08:00"><meta property="og:site_name" content="ChenSoul"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://blog.chensoul.cc/posts/"},{"@type":"ListItem","position":3,"name":"如何设计一个短网址服务","item":"https://blog.chensoul.cc/posts/2023/11/17/designing-a-url-shortening-service/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"如何设计一个短网址服务 | ChenSoul","name":"如何设计一个短网址服务","description":"如何生成一个短网址服务，参考 Design a URL Shortening Service / TinyURL 和 Designing a URL Shortening service like TinyURL 两篇文章，整理如下笔记。\n其中主要包括以下内容：\n设计一个系统有哪些步骤 需求 预估 设计 高层次设计 API 设计 细节设计 评估 设计一个短网址服务的细节 设计步骤 Requirements 需求\n功能性需求 短 URL 生成：我们的服务应该能够为给定 URL 生成唯一的较短别名。 重定向：给定一个短链接，我们的系统应该能够将用户重定向到原始 URL。 自定义短链接：用户应该能够使用我们的系统为其 URL 生成自定义短链接。 删除：在赋予权限的情况下，用户应该能够删除我们系统生成的短链接。 更新：如果有适当的权限，用户应该能够更新与短链接关联的长 URL。 过期时间：短链接必须有一个默认的过期时间，但用户应该可以根据自己的需求设置过期时间。 分功能性需求：可用性、可靠性、扩展性、可维护性、容错性 可用性：我们的系统应该具有高可用性，因为即使是第二次停机的一小部分也会导致 URL 重定向失败。由于我们系统的域位于 URL 中，因此我们没有停机时间的优势，并且我们的设计必须灌输容错条件。 可扩展性：我们的系统应该能够随着需求的增加而水平扩展。 可读性：我们的系统生成的短链接应该易于阅读、区分和输入。 延迟：系统应以低延迟执行，以便为用户提供流畅的体验。 不可预测性：从安全角度来看，我们的系统生成的短链接应该是高度不可预测的。这确保了下一个短 URL 不会连续生成，从而消除了有人猜测我们的系统已经生成或将生成的所有短 URL 的可能性。 Estimation 估计\n流量 读写比：1:100 每月请求数：2 亿 单条记录占用空间：500B 记录保存多长时间：5 年 每日活跃用户 (DAU) ：1 亿 存储 5 年记录数：2 亿 x 5 x 12 =120 亿 总存储：120 亿 x 500B= 120 亿 x 0.5KB=6TB 带宽 每秒写请求：2 亿 / 30 /24 /60 /60 = 77次/s 写入带宽：77 x 500B =38KB/s 读带宽：38 x 100 =3.","keywords":["architecture"],"wordCount":"371","inLanguage":"en","datePublished":"2023-11-17T16:30:00+08:00","dateModified":"2023-11-17T16:30:00+08:00","author":[{"@type":"Person","name":"chensoul"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.chensoul.cc/posts/2023/11/17/designing-a-url-shortening-service/"},"publisher":{"@type":"Organization","name":"ChenSoul","logo":{"@type":"ImageObject","url":"https://blog.chensoul.cc/favicon.ico"}}}</script><meta name=baidu-site-verification content="codeva-FYpQY8JdLU"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary-bg:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list-page{background:var(--theme)}.list-page:not(.dark)::-webkit-scrollbar-track{background:0 0}.list-page:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript></head><body class="type-posts kind-page layout-" id=top><script data-no-instant>function switchTheme(e){switch(e){case"light":document.body.classList.remove("dark");break;case"dark":document.body.classList.add("dark");break;default:window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")}}function isDarkTheme(){return document.body.className.includes("dark")}function getPrefTheme(){return localStorage.getItem("pref-theme")}function setPrefTheme(e){switchTheme(e),localStorage.setItem("pref-theme",e)}const toggleThemeCallbacks={};toggleThemeCallbacks.main=e=>{setPrefTheme(e?"light":"dark")},window.addEventListener("toggle-theme",function(){const e=isDarkTheme();for(const t in toggleThemeCallbacks)toggleThemeCallbacks[t](e)});function toggleThemeListener(){window.dispatchEvent(new CustomEvent("toggle-theme"))}</script><script>(function(){const t="auto",e=getPrefTheme(),n=e||t;switchTheme(n)})()</script><header class=header><nav class=nav><div class=logo><a href=https://blog.chensoul.cc accesskey=h title="ChenSoul (Alt + H)">ChenSoul</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://blog.chensoul.cc/categories/review/ title=总结>总结</a></li><li><a href=https://blog.chensoul.cc/categories/ title=分类>分类</a></li><li><a href=https://blog.chensoul.cc/tags/ title=标签>标签</a></li><li><a href=https://github.com/chensoul/ title=关于 target=_blank>关于<span class=external-link><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-external-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M11 7H6A2 2 0 004 9v9a2 2 0 002 2h9a2 2 0 002-2v-5"/><line x1="10" y1="14" x2="20" y2="4"/><polyline points="15 4 20 4 20 9"/></svg></span></a></li></ul></nav></header><main class="main post"><article class=post-single><header class=post-header><h1 class=post-title>如何设计一个短网址服务</h1><div class=post-meta><span class=meta-item><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg><span>2023-11-17</span></span><span class=meta-item>
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon" style="user-select:text"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z" style="user-select:text"/><line x1="7" y1="7" x2="7" y2="7" style="user-select:text"/></svg><span class=post-tags><a href=https://blog.chensoul.cc/tags/architecture/>architecture</a></span></span><span class=meta-item>
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><span>2 min</span></span></div></header><div class="toc side right"><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e8%ae%be%e8%ae%a1%e6%ad%a5%e9%aa%a4 aria-label=设计步骤>设计步骤</a></li><li><a href=#%e5%8f%82%e8%80%83%e6%96%87%e7%ab%a0 aria-label=参考文章>参考文章</a></li></ul></div></details></div><div class=post-content><p>如何生成一个短网址服务，参考 <a href=https://www.educative.io/courses/grokking-modern-system-design-interview-for-engineers-managers/system-design-tinyurl>Design a URL Shortening Service / TinyURL</a> 和 <a href=https://www.designgurus.io/course-play/grokking-the-system-design-interview/doc/638c0b5dac93e7ae59a1af6b>Designing a URL Shortening service like TinyURL</a> 两篇文章，整理如下笔记。</p><p>其中主要包括以下内容：</p><ul><li>设计一个系统有哪些步骤<ul><li>需求</li><li>预估</li><li>设计<ul><li>高层次设计</li><li>API 设计</li><li>细节设计</li></ul></li><li>评估</li></ul></li><li>设计一个短网址服务的细节</li></ul><h2 id=设计步骤>设计步骤</h2><ul><li><p>Requirements 需求</p><ul><li>功能性需求<ul><li>短 URL 生成：我们的服务应该能够为给定 URL 生成唯一的较短别名。</li><li>重定向：给定一个短链接，我们的系统应该能够将用户重定向到原始 URL。</li><li>自定义短链接：用户应该能够使用我们的系统为其 URL 生成自定义短链接。</li><li>删除：在赋予权限的情况下，用户应该能够删除我们系统生成的短链接。</li><li>更新：如果有适当的权限，用户应该能够更新与短链接关联的长 URL。</li><li>过期时间：短链接必须有一个默认的过期时间，但用户应该可以根据自己的需求设置过期时间。</li></ul></li><li>分功能性需求：可用性、可靠性、扩展性、可维护性、容错性<ul><li>可用性：我们的系统应该具有高可用性，因为即使是第二次停机的一小部分也会导致 URL 重定向失败。由于我们系统的域位于 URL 中，因此我们没有停机时间的优势，并且我们的设计必须灌输容错条件。</li><li>可扩展性：我们的系统应该能够随着需求的增加而水平扩展。</li><li>可读性：我们的系统生成的短链接应该易于阅读、区分和输入。</li><li>延迟：系统应以低延迟执行，以便为用户提供流畅的体验。</li><li>不可预测性：从安全角度来看，我们的系统生成的短链接应该是高度不可预测的。这确保了下一个短 URL 不会连续生成，从而消除了有人猜测我们的系统已经生成或将生成的所有短 URL 的可能性。</li></ul></li></ul></li><li><p>Estimation 估计</p><ul><li>流量<ul><li>读写比：1:100</li><li>每月请求数：2 亿</li><li>单条记录占用空间：500B</li><li>记录保存多长时间：5 年</li><li>每日活跃用户 (DAU) ：1 亿</li></ul></li><li>存储<ul><li>5 年记录数：2 亿 x 5 x 12 =120 亿</li><li>总存储：120 亿 x 500B= 120 亿 x 0.5KB=6TB</li></ul></li><li>带宽<ul><li>每秒写请求：2 亿 / 30 /24 /60 /60 = 77次/s</li><li>写入带宽：77 x 500B =38KB/s</li><li>读带宽：38 x 100 =3.8MB/s</li></ul></li><li>内存：存储的 20%<ul><li>每天缓存内存：77 x 100 x 24 x 3600 x 20% x 500B = 66GB</li></ul></li><li>服务器：<ul><li>数据量：1亿 /8000=12500<ul><li>为什么按单台服务器处理并发请求 8000 计算？</li></ul></li></ul></li></ul></li><li><p>Design 设计</p><ul><li><p>High-Level design 高层次设计</p><ul><li><p>组件</p><ul><li>数据库：需要数据库来存储长 URL 和相应的短 URL 的映射。</li><li>序列器：Sequencer 将提供唯一的 ID，作为每个短 URL 生成的起点。</li><li>负载均衡：各个层的负载均衡器将确保可用服务器之间的请求平稳分配。</li><li>缓存：缓存将用于存储最频繁的短 URL 相关请求。</li><li>限流器：将使用速率限制器来避免系统被利用。</li><li>服务器：用于处理和导航服务请求以及运行应用程序逻辑。</li><li>Base-58 编码器：用于将序列器的数字输出转换为更可读和更可用的字母数字形式。</li></ul></li><li><p>设计图</p><p><img loading=lazy src=https://chensoul.oss-cn-hangzhou.aliyuncs.com/images/tinyurl-6.webp alt=image-20231117101338021></p></li></ul></li><li><p>Application Programming Interfaces (APIs) API 设计</p><ul><li>REST API<ul><li>创建短网址<ul><li><code>shortURL(api_dev_key, original_url, custom_alias=None, expiry_date=None)</code></li></ul></li><li>重定向短网址<ul><li><code>redirectURL(api_dev_key, url_key)</code></li></ul></li><li>删除短网址<ul><li><code>deleteURL(api_dev_key, url_key)</code></li></ul></li></ul></li></ul></li><li><p>Detailed design 详细设计</p><ul><li>组件<ul><li><p>数据库：</p><ul><li><p>存储</p><ul><li><p>用户表</p><ul><li>ID、name</li></ul></li><li><p>URL 的映射</p><ul><li>ID、url、createDate、expireDate、userId</li></ul></li></ul></li><li><p>选择 NoSQL：</p><ul><li><p>选择 MongoDB：</p><ul><li>它使用领导者-跟随者协议，使得使用副本进行大量读取成为可能。</li><li>MongoDB 确保并发写入操作的原子性，并通过针对记录重复问题返回重复键错误来避免冲突。</li></ul></li><li><p>为什么不选择 Cassandra、Riak 和 DynamoDB 等 NoSQL 数据库？</p><ul><li><p>Cassandra、Riak 和 DynamoDB 等 NoSQL 数据库在读取阶段需要读取修复，因此读取写入性能较慢。</p></li><li><p>它们是无领导者的 NoSQL 数据库，在并发写入时提供较弱的数据一致性保证。</p></li></ul></li></ul></li></ul></li><li><p>序列器：</p><ul><li>用于生成唯一 ID 的序列器<ul><li>序列器生成 64 位的整数 ID，大小限制为从 1 亿到 2^63-1，最大位数为 20<ul><li>表示一个十进制数字所需的位数 log2(10) ≈ 3.32</li><li>64位数值ID中的十进制数字的总位数 64/3.32 ≈ 20</li></ul></li><li>将生成的 ID 转换为 58 进制，最大位数为 11<ul><li>表示一个58进制数字所需的位数 log2(58) ≈ 5.8585</li><li>64位数值ID中的58进制数字的总位数 64/5.8585 ≈ 11</li></ul></li><li>生命周期<ul><li>可用的 ID 数量 2^64 -10^9= 18446644 亿</li><li>可以使用多少年 18446644 亿 / 24亿=7686143363.63年</li></ul></li></ul></li><li>Base-58 编码器<ul><li>从 64 字符（包括 A-Z、a-z、0-9、 <code>+</code> 和 <code>/</code> ）删除 6 个（<code>+</code>、<code>/</code>、<code>0</code> 、 <code>O</code> 、 <code>I</code> 和 <code>l</code>）以增强可读性</li></ul></li></ul></li><li><p>负载均衡</p><ul><li>本地负载均衡<ul><li>客户端和应用服务器之间</li><li>应用服务器和数据库服务器之间</li><li>应用服务器和缓存服务器之间</li></ul></li><li>全局负载均衡<ul><li>数据库地理位置一致</li><li>如果使用数据中心，则可以在短地址中添加字符表示数据中心：<a href=http://service.com/x/short123/>http://service.com/x/short123</a></li></ul></li></ul></li><li><p>缓存</p><ul><li>限制每个用户的配额</li><li>读密集型，选择 Memcached</li><li>使用 LRU 缓存来淘汰不经常访问的网址</li></ul></li><li><p>限流器：固定窗口计数器算法</p></li></ul></li><li>设计图</li><li>工作流<ul><li><p>创建短网址</p><ul><li>自定义非必填，别名长度不能大于 11，不能小于 3</li></ul></li><li><p>重定向短网址</p><ul><li>使用 302 重定向：可以对短网址进行统计<ul><li>301 永久重定向：第一次请求拿到长链接后，下次浏览器再去请求短链的话，不会向短网址服务器请求了，而是直接从浏览器的缓存里拿，减少对服务器的压力</li><li>302 临时重定向：每次去请求短链都会去请求短网址服务器（除非响应中用 Cache-Control 或 Expired 暗示浏览器进行缓存）</li></ul></li></ul></li><li><p>删除短网址</p><ul><li>用户通过 Rest API 删除</li><li>用户访问过期的短网址时，删除</li><li>运行定时任务，先删数据库记录，再删缓存。如果需要再保险一点，再启用延时双删，或者直接同步数据库的 binlog 来删缓存</li></ul></li></ul></li></ul></li></ul></li><li><p>Evaluation 评估</p><ul><li>高可用<ul><li>每天备份存储和缓存服务器，最好一天两次</li><li>全局服务器负载平衡来处理系统的流量。</li><li>速率限制器限制每个用户的资源分配。</li></ul></li><li>扩展性<ul><li>数据库的水平分片。</li><li>MongoDB - 作为 NoSQL 数据库。</li><li>基于一致性哈希的数据分布。</li></ul></li><li>可读性<ul><li>引入 Base-58 编码器来生成短 URL。</li><li>删除非字母数字字符。</li><li>删除相似的字符。</li></ul></li><li>延迟<ul><li>MongoDB 低延迟和高吞吐量。</li><li>分布式缓存，最大限度减少服务延迟。</li></ul></li><li>不可预计性<ul><li>ID 唯一且不可预测</li></ul></li></ul></li></ul><h2 id=参考文章>参考文章</h2><ul><li><p><a href=https://www.designgurus.io/course-play/grokking-the-system-design-interview/doc/638c0b5dac93e7ae59a1af6b>Designing a URL Shortening service like TinyURL</a></p></li><li><p><a href=https://www.educative.io/courses/grokking-modern-system-design-interview-for-engineers-managers/system-design-tinyurl>Design a URL Shortening Service / TinyURL</a></p></li><li><p><a href=https://www.techxiaofei.com/post/system_design/short_url/>后端面试之系统设计-短网址（Short URL）服务怎么设计？</a></p></li><li><p><a href="https://mp.weixin.qq.com/s?__biz=Mzg3NjU1NzM1Mw==&amp;mid=2247490066&amp;idx=1&amp;sn=d133a358dbc79f2ca9293dae57f31532&amp;chksm=cf313f54f846b642bff07d81d94ab42ea744fca0e7a299b8e76f1f6a97a74685222ec80b0ca1&amp;token=996492862&amp;lang=zh_CN#rd">[万字长文] 系统设计之路：如何设计一个URL短链服务</a></p></li><li><p><a href=https://www.zhihu.com/question/29270034/answer/46446911>短 URL 系统是怎么设计的？ - iammutex 的回答 - 知乎</a></p></li></ul></div><footer class=post-footer><nav class=paginav><a class=prev href=https://blog.chensoul.cc/posts/2023/11/17/dns/><span class=title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></svg>&nbsp;Prev Page</span><br><span>[译]《Grokking the System Design Interview》域名系统</span>
</a><a class=next href=https://blog.chensoul.cc/posts/2023/11/16/system-design-master-template/><span class=title>Next Page&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span><br><span>[译]《Grokking the System Design Interview》系统设计主模板</span></a></nav></footer><div class=comments-separator></div></article></main><footer class=footer><span>&copy; 2024 <a href=https://blog.chensoul.cc>ChenSoul</a></span><span style=display:inline-block;margin-left:1em>
<a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA</a>
</span><span style=display:inline-block;margin-left:1em>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
    <a href=https://github.com/reorx/hugo-PaperModX/ rel=noopener target=_blank>PaperModX</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script async src=https://umami.chensoul.cc/random-string.js data-website-id=821c25f8-a31a-4607-92d7-91ee76843d00></script><script>(function(){const t=""=="1";if(t)return;let e=document.getElementById("theme-toggle");e.removeEventListener("click",toggleThemeListener),e.addEventListener("click",toggleThemeListener)})()</script><script>(function(){let e=document.getElementById("menu");e&&(e.scrollLeft=localStorage.getItem("menu-scroll-position"),e.onscroll=function(){localStorage.setItem("menu-scroll-position",e.scrollLeft)});const t=""=="1",n="1"=="1";if(window.matchMedia("(prefers-reduced-motion: reduce)").matches||t||n)return;document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})})()</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>if(window.scrollListeners)for(const e of scrollListeners)window.removeEventListener("scroll",e);window.scrollListeners=[]</script><script src=/js/medium-zoom.min.js data-no-instant></script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script>(function(){const a="1"=="1";if(!a)return;if(!document.querySelector(".toc")){console.log("no toc found, ignore toc scroll");return}const r=window.scrollListeners,t=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id]"),n="active";let e=t[0];o(e).classList.add(n);const c=()=>{const s=[];for(const e of t)if(l(e)<5)s.push(e);else break;s.length>0?newActiveHeading=s[s.length-1]:newActiveHeading=t[0],e!=newActiveHeading&&(o(e).classList.remove(n),e=newActiveHeading,o(e).classList.add(n))};let s=null;const i=()=>{s!==null&&clearTimeout(s),s=setTimeout(c,50)};window.addEventListener("scroll",i,!1),r.push(i);function o(e){const t=encodeURI(e.getAttribute("id")).toLowerCase();return document.querySelector(`.toc ul li a[href="#${t}"]`)}function l(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect();return t.top}})()</script><script>mediumZoom(".entry-cover img"),mediumZoom(".post-content img:not([no-zoom])")</script><script src=/js/instantclick.min.js data-no-instant></script><script data-no-instant>InstantClick.init()</script></body></html>