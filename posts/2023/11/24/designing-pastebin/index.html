<!doctype html><html lang=en-US prefix="og: http://ogp.me/ns#"><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="è¿™æ˜¯ä¸€ç¯‡åŒè¯­ç¿»è¯‘çš„æ–‡ç« ï¼ŒåŸæ–‡å‡ºè‡ª grok_system_design_interview.pdf çš„ä¸€ç¯‡æ–‡ç« ã€ŠDesigning Pastebinã€‹è®¾è®¡ Pastebinã€‚

Letâ€™s design a Pastebin like web service, where users can store plain text. Users of the service will enter a piece of text and get a randomly generated URL to access it. Similar Services: pastebin.com, pasted.co, chopapp.com Difficulty Level: Easy"><title>[è¯‘]ã€ŠGrokking the System Design Interviewã€‹è®¾è®¡Pastebin | ChenSoul</title>
<link rel=canonical href=https://blog.chensoul.cc/posts/2023/11/24/designing-pastebin/><link rel=preconnect href=https://fonts.font.im><link rel=preconnect href=https://fonts.loli.net crossorigin><link href="https://fonts.loli.net/css2?family=Roboto+Slab:wght@400;500;700&display=swap" rel=stylesheet><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.chensoul.cc/images/favicon.webp"><meta name=twitter:title content="[è¯‘]ã€ŠGrokking the System Design Interviewã€‹è®¾è®¡Pastebin"><meta name=twitter:description content="è¿™æ˜¯ä¸€ç¯‡åŒè¯­ç¿»è¯‘çš„æ–‡ç« ï¼ŒåŸæ–‡å‡ºè‡ª grok_system_design_interview.pdf çš„ä¸€ç¯‡æ–‡ç« ã€ŠDesigning Pastebinã€‹è®¾è®¡ Pastebinã€‚
Letâ€™s design a Pastebin like web service, where users can store plain text. Users of the service will enter a piece of text and get a randomly generated URL to access it. Similar Services: pastebin.com, pasted.co, chopapp.com Difficulty Level: Easy"><meta name=twitter:creator content="@ichensoul"><meta property="og:locale" content="en_US"><meta property="og:site_name" content="chensoul"><meta property="og:url" content="https://blog.chensoul.cc/posts/2023/11/24/designing-pastebin/"><meta property="og:site_name" content="ChenSoul"><meta property="og:title" content="[è¯‘]ã€ŠGrokking the System Design Interviewã€‹è®¾è®¡Pastebin"><meta property="og:description" content="è¿™æ˜¯ä¸€ç¯‡åŒè¯­ç¿»è¯‘çš„æ–‡ç« ï¼ŒåŸæ–‡å‡ºè‡ª grok_system_design_interview.pdf çš„ä¸€ç¯‡æ–‡ç« ã€ŠDesigning Pastebinã€‹è®¾è®¡ Pastebinã€‚
Letâ€™s design a Pastebin like web service, where users can store plain text. Users of the service will enter a piece of text and get a randomly generated URL to access it. Similar Services: pastebin.com, pasted.co, chopapp.com Difficulty Level: Easy"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-11-24T00:00:00+00:00"><meta property="article:modified_time" content="2023-11-24T00:00:00+00:00"><meta property="article:tag" content="Architecture"><meta property="og:image" content="https://blog.chensoul.cc/images/favicon.webp"><meta itemprop=name content="[è¯‘]ã€ŠGrokking the System Design Interviewã€‹è®¾è®¡Pastebin"><meta itemprop=description content="è¿™æ˜¯ä¸€ç¯‡åŒè¯­ç¿»è¯‘çš„æ–‡ç« ï¼ŒåŸæ–‡å‡ºè‡ª grok_system_design_interview.pdf çš„ä¸€ç¯‡æ–‡ç« ã€ŠDesigning Pastebinã€‹è®¾è®¡ Pastebinã€‚
Letâ€™s design a Pastebin like web service, where users can store plain text. Users of the service will enter a piece of text and get a randomly generated URL to access it. Similar Services: pastebin.com, pasted.co, chopapp.com Difficulty Level: Easy"><meta itemprop=datePublished content="2023-11-24T00:00:00+00:00"><meta itemprop=dateModified content="2023-11-24T00:00:00+00:00"><meta itemprop=wordCount content="2069"><meta itemprop=image content="https://blog.chensoul.cc/images/favicon.webp"><meta itemprop=keywords content="Architecture"><link rel=stylesheet href=https://cdnjs.loli.net/ajax/libs/font-awesome/6.4.0/css/all.min.css media=all><link rel=stylesheet href=/main.min.css type=text/css media=all><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"TechArticle","name":"[è¯‘]ã€ŠGrokking the System Design Interviewã€‹è®¾è®¡Pastebin","headline":"[è¯‘]ã€ŠGrokking the System Design Interviewã€‹è®¾è®¡Pastebin","inLanguage":"en-US","url":"https://blog.chensoul.cc/posts/2023/11/24/designing-pastebin/","description":"\u003cp\u003eè¿™æ˜¯ä¸€ç¯‡åŒè¯­ç¿»è¯‘çš„æ–‡ç« ï¼ŒåŸæ–‡å‡ºè‡ª \u003ca href=\"https://github.com/sharanyaa/grok_sdi_educative/blob/master/grok_system_design_interview.pdf\" target=\"_blank\"\u003egrok_system_design_interview.pdf\u003c/a\u003e çš„ä¸€ç¯‡æ–‡ç« ã€ŠDesigning Pastebinã€‹è®¾è®¡ Pastebinã€‚\u003c/p\u003e\n\u003chr\u003e\n\u003cp\u003eLetâ€™s design a Pastebin like web service, where users can store plain text. Users of the service will enter a piece of text and get a randomly generated URL to access it. Similar Services: pastebin.com, pasted.co, chopapp.com Difficulty Level: Easy\u003c/p\u003e","wordCount":"2069","keywords":["architecture"],"datePublished":"2023-11-24T00:00:00Z","dateModified":"2023-11-24T00:00:00Z","author":{"@type":"Person","name":"chensoul"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.chensoul.cc/posts/2023/11/24/designing-pastebin/"},"publisher":{"@type":"Organization","name":"chensoul","url":"https://blog.chensoul.cc/posts/2023/11/24/designing-pastebin/"}},{"@context":"https://schema.org","@type":"Organization","name":"chensoul","url":"https://blog.chensoul.cc/","sameAs":["https://x.com/ichensoul","https://github.com/chensoul","https://www.linkedin.com/in/","https://www.youtube.com/@chensoul","https://t.me/chensouls"]}]}</script><script defer src=https://umami.chensoul.cc/random-string.js data-website-id=821c25f8-a31a-4607-92d7-91ee76843d00></script></head><body class="home blog post-layout-one-column"><button onclick=topFunction() id=scrollTopBtn title="Go to top">
<i class="fa-solid fa-arrow-up"></i></button><div id=header-top class=header-bar-wrap></div><div id=page class=site><a class="skip-link screen-reader-text" href=#content>Skip to content</a><header id=masthead class="site-header clearfix" role=banner><div class="header-main container clearfix"><div id=logo class="site-branding clearfix"><h1 class=site-title><a href=/ title=ChenSoul rel=home>ChenSoul</a></h1><p class=site-description>Java, Spring Boot, Microservice, Cloud, Architecture and DevOps Tutorials</p></div><div class="header-widgets clearfix"><aside id=search-2 class="header-widget widget_search"><form role=search method=get class=search-form onsubmit="return searchSite(event)"><label><span class=screen-reader-text>Search for:</span>
<input type=search class=search-field placeholder="Enter search keyword" name=query id=query title="Enter search keyword">
</label><button type=submit class=search-submit title=Search> <span class=genericon-search></span>
<span class=screen-reader-text>Search</span></button></form></aside></div></div><div id=main-navigation-wrap class=primary-navigation-wrap><nav id=main-navigation class="primary-navigation navigation container clearfix" role=navigation><ul id=menu-home class=main-navigation-menu><li class="menu-item menu-item-type-custom menu-item-object-custom
current-menu-item current_page_item menu-item-home"><a href=/>Home</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/categories/spring-boot/>Spring Boot</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/categories/architecture/>Architecture</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/categories/microservice/>Microservice</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/categories/kubernetes/>Kubernetes</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category
menu-item-has-children"><a href=/tutorials/>Tutorials</a><ul class=sub-menu><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/spring-boot-tutorials/>Spring Boot Tutorials</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/microservice-tutorials/>Microservice Tutorials</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/kubernetes-tutorials/>Kubernetes Tutorials</a></li></ul></li><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=https://github.com/chensoul target=_blank>About Me</a></li></ul></nav></div></header><div id=content class="site-content container clearfix"><section id=primary class="content-archive content-area post-content-area"><main id=main class=site-main role=main><article class="post type-post"><div class=post-inner-content><header class=entry-header><h2 class=entry-title><a href=https://blog.chensoul.cc/posts/2023/11/24/designing-pastebin/ rel=bookmark title="[è¯‘]ã€ŠGrokking the System Design Interviewã€‹è®¾è®¡Pastebin">[è¯‘]ã€ŠGrokking the System Design Interviewã€‹è®¾è®¡Pastebin</a></h2><div class=entry-meta><span class=meta-date><time class="entry-date published" datetime=2023-11-24T00:00:00>2023-11-24
</time></span><span class=meta-author><span class="author vcard">chensoul</span>
</span><span class="tagcloud post-tags"><i class="fa fa-tags"></i>&nbsp;
<a class="tag-cloud-link widget__link widget__link--taglist" href=/tags/architecture/ title=architecture>architecture</a></span></div></header><div class=entry-content><p>è¿™æ˜¯ä¸€ç¯‡åŒè¯­ç¿»è¯‘çš„æ–‡ç« ï¼ŒåŸæ–‡å‡ºè‡ª <a href=https://github.com/sharanyaa/grok_sdi_educative/blob/master/grok_system_design_interview.pdf target=_blank>grok_system_design_interview.pdf</a> çš„ä¸€ç¯‡æ–‡ç« ã€ŠDesigning Pastebinã€‹è®¾è®¡ Pastebinã€‚</p><hr><p>Letâ€™s design a Pastebin like web service, where users can store plain text. Users of the service will enter a piece of text and get a randomly generated URL to access it. Similar Services: pastebin.com, pasted.co, chopapp.com Difficulty Level: Easy</p><blockquote><p>è®©æˆ‘ä»¬è®¾è®¡ä¸€ä¸ªç±»ä¼¼ Pastebin çš„ Web æœåŠ¡ï¼Œç”¨æˆ·å¯ä»¥åœ¨å…¶ä¸­å­˜å‚¨çº¯æ–‡æœ¬ã€‚è¯¥æœåŠ¡çš„ç”¨æˆ·å°†è¾“å…¥ä¸€æ®µæ–‡æœ¬å¹¶è·å¾—ä¸€ä¸ªéšæœºç”Ÿæˆçš„ URL æ¥è®¿é—®å®ƒã€‚ç±»ä¼¼æœåŠ¡ï¼špastebin.comã€pasted.coã€hopapp.com éš¾åº¦çº§åˆ«ï¼šç®€å•</p></blockquote><h2 id=1-what-is-pastebin>1. What is Pastebin?</h2><blockquote><p>1.Pastebinæ˜¯ä»€ä¹ˆï¼Ÿ</p></blockquote><p>Pastebin like services enable users to store plain text or images over the network (typically the Internet) and generate unique URLs to access the uploaded data. Such services are also used to share data over the network quickly, as users would just need to pass the URL to let other users see it.</p><blockquote><p>Pastebin ä¹‹ç±»çš„æœåŠ¡ä½¿ç”¨æˆ·èƒ½å¤Ÿé€šè¿‡ç½‘ç»œï¼ˆé€šå¸¸æ˜¯äº’è”ç½‘ï¼‰å­˜å‚¨çº¯æ–‡æœ¬æˆ–å›¾åƒï¼Œå¹¶ç”Ÿæˆå”¯ä¸€çš„ URL æ¥è®¿é—®ä¸Šä¼ çš„æ•°æ®ã€‚æ­¤ç±»æœåŠ¡è¿˜ç”¨äºé€šè¿‡ç½‘ç»œå¿«é€Ÿå…±äº«æ•°æ®ï¼Œå› ä¸ºç”¨æˆ·åªéœ€ä¼ é€’ URL å³å¯è®©å…¶ä»–ç”¨æˆ·çœ‹åˆ°å®ƒã€‚</p></blockquote><p>If you havenâ€™t used <a href=http://pastebin.com/ target=_blank>pastebin.com</a> before, please try creating a new â€˜Pasteâ€™ there and spend some time going through the different options their service offers. This will help you a lot in understanding this chapter.</p><blockquote><p>å¦‚æœæ‚¨ä»¥å‰æ²¡æœ‰ä½¿ç”¨è¿‡ pastebin.comï¼Œè¯·å°è¯•åœ¨é‚£é‡Œåˆ›å»ºä¸€ä¸ªæ–°çš„â€œç²˜è´´â€ï¼Œå¹¶èŠ±ä¸€äº›æ—¶é—´æµè§ˆä»–ä»¬çš„æœåŠ¡æä¾›çš„ä¸åŒé€‰é¡¹ã€‚è¿™å°†å¯¹ä½ ç†è§£æœ¬ç« æœ‰å¾ˆå¤§å¸®åŠ©ã€‚</p></blockquote><h2 id=2-requirements-and-goals-of-the-system>2. Requirements and Goals of the System</h2><blockquote><ol start=2><li>ç³»ç»Ÿçš„è¦æ±‚å’Œç›®æ ‡</li></ol></blockquote><p>Our Pastebin service should meet the following requirements:</p><blockquote><p>æˆ‘ä»¬çš„ Pastebin æœåŠ¡åº”æ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š</p></blockquote><p><strong>Functional Requirements:</strong></p><blockquote><p><strong>åŠŸèƒ½è¦æ±‚ï¼š</strong></p></blockquote><ol><li><p>Users should be able to upload or â€œpasteâ€ their data and get a unique URL to access it.</p><blockquote><p>ç”¨æˆ·åº”è¯¥èƒ½å¤Ÿä¸Šä¼ æˆ–â€œç²˜è´´â€ä»–ä»¬çš„æ•°æ®å¹¶è·å¾—å”¯ä¸€çš„ URL æ¥è®¿é—®å®ƒã€‚</p></blockquote></li><li><p>Users will only be able to upload text.</p><blockquote><p>ç”¨æˆ·åªèƒ½ä¸Šä¼ æ–‡æœ¬ã€‚</p></blockquote></li><li><p>Data and links will expire after a specific timespan automatically; users should also be able to specify expiration time.</p><blockquote><p>æ•°æ®å’Œé“¾æ¥å°†åœ¨ç‰¹å®šæ—¶é—´æ®µåè‡ªåŠ¨è¿‡æœŸï¼›ç”¨æˆ·è¿˜åº”è¯¥èƒ½å¤ŸæŒ‡å®šè¿‡æœŸæ—¶é—´ã€‚</p></blockquote></li><li><p>Users should optionally be able to pick a custom alias for their paste.</p><blockquote><p>ç”¨æˆ·åº”è¯¥å¯ä»¥é€‰æ‹©ä¸ºå…¶ç²˜è´´é€‰æ‹©è‡ªå®šä¹‰åˆ«åã€‚</p></blockquote></li></ol><p><strong>Non-Functional Requirements:</strong></p><blockquote><p><strong>éåŠŸèƒ½æ€§è¦æ±‚ï¼š</strong></p></blockquote><ol><li><p>The system should be highly reliable, any data uploaded should not be lost.</p><blockquote><p>ç³»ç»Ÿåº”é«˜åº¦å¯é ï¼Œä¸Šä¼ çš„ä»»ä½•æ•°æ®éƒ½ä¸åº”ä¸¢å¤±ã€‚</p></blockquote></li><li><p>The system should be highly available. This is required because if our service is down, users will not be able to access their Pastes.</p><blockquote><p>ç³»ç»Ÿåº”è¯¥æ˜¯é«˜å¯ç”¨çš„ã€‚è¿™æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºå¦‚æœæˆ‘ä»¬çš„æœåŠ¡å‡ºç°æ•…éšœï¼Œç”¨æˆ·å°†æ— æ³•è®¿é—®ä»–ä»¬çš„ç²˜è´´ã€‚</p></blockquote></li><li><p>Users should be able to access their Pastes in real-time with minimum latency.</p><blockquote><p>ç”¨æˆ·åº”è¯¥èƒ½å¤Ÿä»¥æœ€å°çš„å»¶è¿Ÿå®æ—¶è®¿é—®ä»–ä»¬çš„ç²˜è´´ã€‚</p></blockquote></li><li><p>Paste links should not be guessable (not predictable).</p><blockquote><p>ç²˜è´´é“¾æ¥ä¸åº”æ˜¯å¯çŒœæµ‹çš„ï¼ˆä¸å¯é¢„æµ‹çš„ï¼‰ã€‚</p></blockquote></li></ol><p><strong>Extended Requirements:</strong></p><blockquote><p><strong>æ‰©å±•è¦æ±‚ï¼š</strong></p></blockquote><ol><li><p>Analytics, e.g., how many times a paste was accessed?</p><blockquote><p>åˆ†æï¼Œä¾‹å¦‚ç²˜è´´è¢«è®¿é—®äº†å¤šå°‘æ¬¡ï¼Ÿ</p></blockquote></li><li><p>Our service should also be accessible through REST APIs by other services.</p><blockquote><p>æˆ‘ä»¬çš„æœåŠ¡è¿˜åº”è¯¥å¯ä»¥ç”±å…¶ä»–æœåŠ¡é€šè¿‡ REST API è®¿é—®ã€‚</p></blockquote></li></ol><h2 id=3-some-design-considerations>3. Some Design Considerations</h2><blockquote><ol start=3><li>ä¸€äº›è®¾è®¡è€ƒè™‘</li></ol></blockquote><p>Pastebin shares some requirements with <a href=https://www.educative.io/collection/page/5668639101419520/5649050225344512/5668600916475904 target=_blank>URL Shortening service</a>, but there are some additional design considerations we should keep in mind.</p><blockquote><p>Pastebin ä¸ URL ç¼©çŸ­æœåŠ¡æœ‰ä¸€äº›å…±åŒçš„è¦æ±‚ï¼Œä½†æˆ‘ä»¬è¿˜åº”è¯¥ç‰¢è®°ä¸€äº›é¢å¤–çš„è®¾è®¡æ³¨æ„äº‹é¡¹ã€‚</p></blockquote><p><strong>What should be the limit on the amount of text user can paste at a time?</strong> We can limit users not to have Pastes bigger than 10MB to stop the abuse of the service.</p><blockquote><p>ç”¨æˆ·ä¸€æ¬¡å¯ä»¥ç²˜è´´çš„æ–‡æœ¬é‡çš„é™åˆ¶åº”è¯¥æ˜¯å¤šå°‘ï¼Ÿæˆ‘ä»¬å¯ä»¥é™åˆ¶ç”¨æˆ·ç²˜è´´çš„å¤§å°ä¸å¾—è¶…è¿‡ 10MBï¼Œä»¥é˜»æ­¢æ»¥ç”¨æœåŠ¡ã€‚</p></blockquote><p><strong>Should we impose size limits on custom URLs?</strong> Since our service supports custom URLs, users can pick any URL that they like, but providing a custom URL is not mandatory. However, it is reasonable (and often desirable) to impose a size limit on custom URLs, so that we have a consistent URL database.</p><blockquote><p>æˆ‘ä»¬åº”è¯¥å¯¹è‡ªå®šä¹‰ URL æ–½åŠ å¤§å°é™åˆ¶å—ï¼Ÿç”±äºæˆ‘ä»¬çš„æœåŠ¡æ”¯æŒè‡ªå®šä¹‰ URLï¼Œå› æ­¤ç”¨æˆ·å¯ä»¥é€‰æ‹©ä»–ä»¬å–œæ¬¢çš„ä»»ä½• URLï¼Œä½†æä¾›è‡ªå®šä¹‰ URL ä¸æ˜¯å¼ºåˆ¶æ€§çš„ã€‚ç„¶è€Œï¼Œå¯¹è‡ªå®šä¹‰ URL æ–½åŠ å¤§å°é™åˆ¶æ˜¯åˆç†çš„ï¼ˆè€Œä¸”é€šå¸¸æ˜¯å¯å–çš„ï¼‰ï¼Œè¿™æ ·æˆ‘ä»¬å°±æœ‰ä¸€ä¸ªä¸€è‡´çš„ URL æ•°æ®åº“ã€‚</p></blockquote><h2 id=4-capacity-estimation-and-constraints>4. Capacity Estimation and Constraints</h2><blockquote><ol start=4><li>å®¹é‡ä¼°è®¡å’Œçº¦æŸ</li></ol></blockquote><p>Our services will be read-heavy; there will be more read requests compared to new Pastes creation. We can assume a 5:1 ratio between read and write.</p><blockquote><p>æˆ‘ä»¬çš„æœåŠ¡å°†éœ€è¦å¤§é‡é˜…è¯»ï¼›ä¸åˆ›å»ºæ–°çš„ç²˜è´´ç›¸æ¯”ï¼Œå°†ä¼šæœ‰æ›´å¤šçš„è¯»å–è¯·æ±‚ã€‚æˆ‘ä»¬å¯ä»¥å‡è®¾è¯»å’Œå†™ä¹‹é—´çš„æ¯”ä¾‹ä¸º 5:1ã€‚</p></blockquote><p><strong>Traffic estimates:</strong> Pastebin services are not expected to have traffic similar to Twitter or Facebook, letâ€™s assume here that we get one million new pastes added to our system every day. This leaves us with five million reads per day.</p><blockquote><p>æµé‡ä¼°è®¡ï¼šPastebin æœåŠ¡é¢„è®¡ä¸ä¼šæœ‰ç±»ä¼¼äº Twitter æˆ– Facebook çš„æµé‡ï¼Œæˆ‘ä»¬å‡è®¾æ¯å¤©æœ‰ 100 ä¸‡ä¸ªæ–°ç²˜è´´æ·»åŠ åˆ°æˆ‘ä»¬çš„ç³»ç»Ÿä¸­ã€‚è¿™ä½¿å¾—æˆ‘ä»¬æ¯å¤©çš„é˜…è¯»é‡è¾¾åˆ° 500 ä¸‡æ¬¡ã€‚</p></blockquote><p>New Pastes per second:</p><blockquote><p>æ¯ç§’æ–°ç²˜è´´æ•°ï¼š</p></blockquote><p>1M / (24 hours * 3600 seconds) ~= 12 pastes/sec</p><p>Paste reads per second:</p><blockquote><p>ç²˜è´´æ¯ç§’è¯»å–æ¬¡æ•°ï¼š</p></blockquote><p>5M / (24 hours * 3600 seconds) ~= 58 reads/sec</p><p><strong>Storage estimates:</strong> Users can upload maximum 10MB of data; commonly Pastebin like services are</p><blockquote><p>å­˜å‚¨é¢„ä¼°ï¼šç”¨æˆ·æœ€å¤šå¯ä¸Šä¼ 10MBæ•°æ®ï¼›é€šå¸¸ç±»ä¼¼ Pastebin çš„æœåŠ¡æ˜¯</p></blockquote><p>used to share source code, configs or logs. Such texts are not huge, so letâ€™s assume that each paste on average contains 10KB.</p><blockquote><p>ç”¨äºå…±äº«æºä»£ç ã€é…ç½®æˆ–æ—¥å¿—ã€‚è¿™äº›æ–‡æœ¬å¹¶ä¸å¤§ï¼Œæ‰€ä»¥æˆ‘ä»¬å‡è®¾æ¯ä¸ªç²˜è´´å¹³å‡åŒ…å« 10KBã€‚</p></blockquote><p>At this rate, we will be storing 10GB of data per day.</p><blockquote><p>æŒ‰ç…§è¿™ä¸ªé€Ÿåº¦ï¼Œæˆ‘ä»¬æ¯å¤©å°†å­˜å‚¨ 10GB çš„æ•°æ®ã€‚</p></blockquote><p>1M * 10KB => 10 GB/day</p><p>If we want to store this data for ten years we would need the total storage capacity of 36TB.</p><blockquote><p>å¦‚æœæˆ‘ä»¬æƒ³å­˜å‚¨è¿™äº›æ•°æ®åå¹´ï¼Œæˆ‘ä»¬éœ€è¦ 36TB çš„æ€»å­˜å‚¨å®¹é‡ã€‚</p></blockquote><p>With 1M pastes every day we will have 3.6 billion Pastes in 10 years. We need to generate and store keys to uniquely identify these pastes. If we use base64 encoding ([A-Z, a-z, 0-9, ., -]) we would need six letters strings:</p><blockquote><p>æ¯å¤©æœ‰ 100 ä¸‡ä¸ªç„Šè†ï¼Œ10 å¹´åæˆ‘ä»¬å°†æ‹¥æœ‰ 36 äº¿ä¸ªç„Šè†ã€‚æˆ‘ä»¬éœ€è¦ç”Ÿæˆå¹¶å­˜å‚¨å¯†é’¥æ¥å”¯ä¸€æ ‡è¯†è¿™äº›ç²˜è´´ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨ Base64 ç¼–ç ï¼ˆ[A-Z, a-z, 0-9, ., -]ï¼‰ï¼Œæˆ‘ä»¬å°†éœ€è¦å…­ä¸ªå­—æ¯çš„å­—ç¬¦ä¸²ï¼š</p></blockquote><p>64^6 ~= 68.7 billion unique strings</p><blockquote><p>64^6 ~= 687 äº¿ä¸ªå”¯ä¸€å­—ç¬¦ä¸²</p></blockquote><p>If it takes one byte to store one character, total size required to store 3.6B keys would be:</p><blockquote><p>å¦‚æœéœ€è¦ 1 ä¸ªå­—èŠ‚å­˜å‚¨ 1 ä¸ªå­—ç¬¦ï¼Œåˆ™å­˜å‚¨ 3.6B ä¸ªå¯†é’¥æ‰€éœ€çš„æ€»å¤§å°ä¸ºï¼š</p></blockquote><p>3.6B * 6 => 22 GB</p><p>22GB is negligible compared to 36TB. To keep some margin, we will assume a 70% capacity model (meaning we donâ€™t want to use more than 70% of our total storage capacity at any point), which raises our storage needs to 51.4TB.</p><blockquote><p>ä¸ 36TB ç›¸æ¯”ï¼Œ22GB å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚ä¸ºäº†ä¿ç•™ä¸€å®šçš„ä½™é‡ï¼Œæˆ‘ä»¬å°†å‡è®¾ 70% çš„å®¹é‡æ¨¡å‹ï¼ˆè¿™æ„å‘³ç€æˆ‘ä»¬åœ¨ä»»ä½•æ—¶å€™éƒ½ä¸æƒ³ä½¿ç”¨è¶…è¿‡æ€»å­˜å‚¨å®¹é‡çš„ 70%ï¼‰ï¼Œè¿™ä¼šå°†æˆ‘ä»¬çš„å­˜å‚¨éœ€æ±‚æé«˜åˆ° 51.4TBã€‚</p></blockquote><p><strong>Bandwidth estimates:</strong> For write requests, we expect 12 new pastes per second, resulting in 120KB of ingress per second.</p><blockquote><p>å¸¦å®½ä¼°è®¡ï¼šå¯¹äºå†™å…¥è¯·æ±‚ï¼Œæˆ‘ä»¬é¢„è®¡æ¯ç§’ 12 ä¸ªæ–°ç²˜è´´ï¼Œå¯¼è‡´æ¯ç§’ 120KB çš„å…¥å£ã€‚</p></blockquote><p>12 * 10KB => 120 KB/s</p><p>As for the read request, we expect 58 requests per second. Therefore, total data egress (sent to users) will be 0.6 MB/s.</p><blockquote><p>è‡³äºè¯»å–è¯·æ±‚ï¼Œæˆ‘ä»¬é¢„è®¡æ¯ç§’æœ‰ 58 ä¸ªè¯·æ±‚ã€‚å› æ­¤ï¼Œæ€»æ•°æ®è¾“å‡ºï¼ˆå‘é€ç»™ç”¨æˆ·ï¼‰å°†ä¸º 0.6 MB/sã€‚</p></blockquote><p>58 * 10KB => 0.6 MB/s</p><p>Although total ingress and egress are not big, we should keep these numbers in mind while designing our service.</p><blockquote><p>å°½ç®¡å…¥å£å’Œå‡ºå£æ€»é‡å¹¶ä¸å¤§ï¼Œä½†æˆ‘ä»¬åœ¨è®¾è®¡æœåŠ¡æ—¶åº”è¯¥ç‰¢è®°è¿™äº›æ•°å­—ã€‚</p></blockquote><p><strong>Memory estimates:</strong> We can cache some of the hot pastes that are frequently accessed. Following the 80-20 rule, meaning 20% of hot pastes generate 80% of traffic, we would like to cache these 20% pastes</p><blockquote><p>å†…å­˜ä¼°ç®—ï¼šæˆ‘ä»¬å¯ä»¥ç¼“å­˜ä¸€äº›ç»å¸¸è®¿é—®çš„çƒ­è´´ã€‚éµå¾ª 80-20 è§„åˆ™ï¼Œå³ 20% çš„çƒ­é—¨ç²˜è´´äº§ç”Ÿ 80% çš„æµé‡ï¼Œæˆ‘ä»¬å¸Œæœ›ç¼“å­˜è¿™ 20% çš„ç²˜è´´</p></blockquote><p>Since we have 5M read requests per day, to cache 20% of these requests, we would need:</p><blockquote><p>ç”±äºæˆ‘ä»¬æ¯å¤©æœ‰ 500 ä¸‡ä¸ªè¯»å–è¯·æ±‚ï¼Œä¸ºäº†ç¼“å­˜è¿™äº›è¯·æ±‚çš„ 20%ï¼Œæˆ‘ä»¬éœ€è¦ï¼š</p></blockquote><p>0.2 * 5M * 10KB ~= 10 GB</p><h2 id=5-system-apis>5. System APIs</h2><blockquote><ol start=5><li>ç³»ç»ŸAPI</li></ol></blockquote><p>We can have SOAP or REST APIs to expose the functionality of our service. Following could be the definitions of the APIs to create/retrieve/delete Pastes:</p><blockquote><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ SOAP æˆ– REST API æ¥å…¬å¼€æˆ‘ä»¬æœåŠ¡çš„åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯åˆ›å»º/æ£€ç´¢/åˆ é™¤ç²˜è´´çš„ API çš„å®šä¹‰ï¼š</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>addPaste(api_dev_key, paste_data, custom_url=None user_name=None, paste_name=None,
</span></span><span style=display:flex><span>expire_date=None)
</span></span></code></pre></div><p><strong>Parameters:</strong></p><blockquote><p><strong>å‚æ•°ï¼š</strong></p></blockquote><p>api_dev_key (string): The API developer key of a registered account. This will be used to, among other things, throttle users based on their allocated quota. paste_data (string): Textual data of the paste. custom_url (string): Optional custom URL.</p><blockquote><p>api_dev_key (string): æ³¨å†Œè´¦æˆ·çš„APIå¼€å‘è€…å¯†é’¥ã€‚é™¤å…¶ä»–å¤–ï¼Œè¿™å°†ç”¨äºæ ¹æ®åˆ†é…çš„é…é¢é™åˆ¶ç”¨æˆ·ã€‚ Paste_dataï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šç²˜è´´çš„æ–‡æœ¬æ•°æ®ã€‚ custom_urlï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šå¯é€‰çš„è‡ªå®šä¹‰ URLã€‚</p></blockquote><p>user_name (string): Optional user name to be used to generate URL. paste_name (string): Optional name of the paste expire_date (string): Optional expiration date for the paste.</p><blockquote><p>user_nameï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šç”¨äºç”Ÿæˆ URL çš„å¯é€‰ç”¨æˆ·åã€‚ Paste_nameï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šç²˜è´´çš„å¯é€‰åç§° expire_dateï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šç²˜è´´çš„å¯é€‰åˆ°æœŸæ—¥æœŸã€‚</p></blockquote><p><strong>Returns:</strong> (string) A successful insertion returns the URL through which the paste can be accessed, otherwise, it will return an error code.</p><blockquote><p>è¿”å›ï¼šï¼ˆå­—ç¬¦ä¸²ï¼‰æˆåŠŸæ’å…¥å°†è¿”å›å¯è®¿é—®ç²˜è´´çš„ URLï¼Œå¦åˆ™å°†è¿”å›é”™è¯¯ä»£ç ã€‚</p></blockquote><p>Similarly, we can have retrieve and delete Paste APIs:</p><blockquote><p>åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥æ£€ç´¢å’Œåˆ é™¤ç²˜è´´ APIï¼š</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>getPaste(api_dev_key, api_paste_key)
</span></span></code></pre></div><p>Where â€œapi_paste_keyâ€ is a string representing the Paste Key of the paste to be retrieved. This API will return the textual data of the paste.</p><blockquote><p>å…¶ä¸­â€œapi_paste_keyâ€æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè¦æ£€ç´¢çš„ç²˜è´´çš„ç²˜è´´å¯†é’¥ã€‚è¯¥ API å°†è¿”å›ç²˜è´´çš„æ–‡æœ¬æ•°æ®ã€‚</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>deletePaste(api_dev_key, api_paste_key)
</span></span></code></pre></div><p>A successful deletion returns â€˜trueâ€™, otherwise returns â€˜falseâ€™.</p><blockquote><p>æˆåŠŸåˆ é™¤è¿”å›â€œtrueâ€ï¼Œå¦åˆ™è¿”å›â€œfalseâ€ã€‚</p></blockquote><h2 id=6-database-design>6. Database Design</h2><blockquote><ol start=6><li>æ•°æ®åº“è®¾è®¡</li></ol></blockquote><p>A few observations about the nature of the data we are storing:</p><blockquote><p>å…³äºæˆ‘ä»¬å­˜å‚¨çš„æ•°æ®çš„æ€§è´¨çš„ä¸€äº›è§‚å¯Ÿï¼š</p></blockquote><ol><li><p>We need to store billions of records.</p><blockquote><p>æˆ‘ä»¬éœ€è¦å­˜å‚¨æ•°åäº¿æ¡è®°å½•ã€‚</p></blockquote></li><li><p>Each metadata object we are storing would be small (less than 100 bytes).</p><blockquote><p>æˆ‘ä»¬å­˜å‚¨çš„æ¯ä¸ªå…ƒæ•°æ®å¯¹è±¡éƒ½å¾ˆå°ï¼ˆå°äº 100 å­—èŠ‚ï¼‰ã€‚</p></blockquote></li><li><p>Each paste object we are storing can be of medium size (it can be a few MB).</p><blockquote><p>æˆ‘ä»¬å­˜å‚¨çš„æ¯ä¸ªç²˜è´´å¯¹è±¡å¯ä»¥æ˜¯ä¸­ç­‰å¤§å°ï¼ˆå¯ä»¥æ˜¯å‡  MBï¼‰ã€‚</p></blockquote></li><li><p>There are no relationships between records, except if we want to store which user created what Paste.</p><blockquote><p>è®°å½•ä¹‹é—´æ²¡æœ‰å…³ç³»ï¼Œé™¤éæˆ‘ä»¬æƒ³è¦å­˜å‚¨å“ªä¸ªç”¨æˆ·åˆ›å»ºäº†å“ªä¸ªç²˜è´´ã€‚</p></blockquote></li><li><p>Our service is read-heavy.</p><blockquote><p>æˆ‘ä»¬çš„æœåŠ¡æ˜¯é‡è¯»çš„ã€‚</p></blockquote></li></ol><p><strong>Database Schema:</strong></p><blockquote><p><strong>æ•°æ®åº“æ¶æ„ï¼š</strong></p></blockquote><p>We would need two tables, one for storing information about the Pastes and the other for usersâ€™ data.</p><blockquote><p>æˆ‘ä»¬éœ€è¦ä¸¤ä¸ªè¡¨ï¼Œä¸€ä¸ªç”¨äºå­˜å‚¨æœ‰å…³ç²˜è´´çš„ä¿¡æ¯ï¼Œå¦ä¸€ä¸ªç”¨äºå­˜å‚¨ç”¨æˆ·æ•°æ®ã€‚</p></blockquote><p>Here, â€˜URlHashâ€™ is the URL equivalent of the TinyURL and â€˜ContentKeyâ€™ is the object key storing the contents of the paste.</p><blockquote><p>è¿™é‡Œï¼Œâ€œURlHashâ€æ˜¯ç›¸å½“äº TinyURL çš„ URLï¼Œâ€œContentKeyâ€æ˜¯å­˜å‚¨ç²˜è´´å†…å®¹çš„å¯¹è±¡é”®ã€‚</p></blockquote><h2 id=7-high-level-design>7. High Level Design</h2><blockquote><ol start=7><li>é«˜å±‚è®¾è®¡</li></ol></blockquote><p>At a high level, we need an application layer that will serve all the read and write requests. Application layer will talk to a storage layer to store and retrieve data. We can segregate our storage layer with one database storing metadata related to each paste, users, etc., while the other storing the paste contents in some object storage (like <a href=https://en.wikipedia.org/wiki/Amazon_S3 target=_blank>Amazon S3</a>). This division of data will also allow us to scale them individually.</p><blockquote><p>åœ¨è¾ƒé«˜çš„å±‚é¢ä¸Šï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåº”ç”¨ç¨‹åºå±‚æ¥æœåŠ¡æ‰€æœ‰çš„è¯»å†™è¯·æ±‚ã€‚åº”ç”¨å±‚å°†ä¸å­˜å‚¨å±‚é€šä¿¡ä»¥å­˜å‚¨å’Œæ£€ç´¢æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥å°†å­˜å‚¨å±‚éš”ç¦»ï¼Œä¸€ä¸ªæ•°æ®åº“å­˜å‚¨ä¸æ¯ä¸ªç²˜è´´ã€ç”¨æˆ·ç­‰ç›¸å…³çš„å…ƒæ•°æ®ï¼Œè€Œå¦ä¸€ä¸ªæ•°æ®åº“å°†ç²˜è´´å†…å®¹å­˜å‚¨åœ¨æŸäº›å¯¹è±¡å­˜å‚¨ï¼ˆå¦‚ Amazon S3ï¼‰ä¸­ã€‚è¿™ç§æ•°æ®åˆ’åˆ†è¿˜å…è®¸æˆ‘ä»¬å•ç‹¬ç¼©æ”¾å®ƒä»¬ã€‚</p></blockquote><p><img src=/images/pastebin-01.webp alt=image-20231116090334771></p><h2 id=8-component-design>8. Component Design</h2><blockquote><ol start=8><li>ç»„ä»¶è®¾è®¡</li></ol></blockquote><p><strong>a. Application layer</strong></p><blockquote><p><strong>a. åº”ç”¨å±‚</strong></p></blockquote><p>Our application layer will process all incoming and outgoing requests. The application servers will be talking to the backend data store components to serve the requests.</p><blockquote><p>æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå±‚å°†å¤„ç†æ‰€æœ‰ä¼ å…¥å’Œä¼ å‡ºçš„è¯·æ±‚ã€‚åº”ç”¨ç¨‹åºæœåŠ¡å™¨å°†ä¸åç«¯æ•°æ®å­˜å‚¨ç»„ä»¶é€šä¿¡ä»¥æœåŠ¡è¯·æ±‚ã€‚</p></blockquote><p><strong>How to handle a write request?</strong> Upon receiving a write request, our application server will generate a six-letter random string, which would serve as the key of the paste (if the user has not provided a custom key). The application server will then store the contents of the paste and the generated key in the database. After the successful insertion, the server can return the key to the user. One possible problem here could be that the insertion fails because of a duplicate key. Since we are generating a random key, there is a possibility that the newly generated key could match an existing one. In that case, we should regenerate a new key and try again. We should keep retrying until we donâ€™t see failure due to the duplicate key. We should return an error to the user if the custom key they have provided is already present in our database.</p><blockquote><p>å¦‚ä½•å¤„ç†å†™è¯·æ±‚ï¼Ÿæ”¶åˆ°å†™å…¥è¯·æ±‚åï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæœåŠ¡å™¨å°†ç”Ÿæˆä¸€ä¸ªå…­å­—æ¯çš„éšæœºå­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²å°†ç”¨ä½œç²˜è´´çš„å¯†é’¥ï¼ˆå¦‚æœç”¨æˆ·æœªæä¾›è‡ªå®šä¹‰å¯†é’¥ï¼‰ã€‚ç„¶ååº”ç”¨ç¨‹åºæœåŠ¡å™¨ä¼šå°†ç²˜è´´çš„å†…å®¹å’Œç”Ÿæˆçš„å¯†é’¥å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ã€‚æ’å…¥æˆåŠŸåï¼ŒæœåŠ¡å™¨å¯ä»¥å°†å¯†é’¥è¿”å›ç»™ç”¨æˆ·ã€‚è¿™é‡Œä¸€ä¸ªå¯èƒ½çš„é—®é¢˜æ˜¯æ’å…¥ç”±äºé‡å¤çš„é”®è€Œå¤±è´¥ã€‚ç”±äºæˆ‘ä»¬ç”Ÿæˆéšæœºå¯†é’¥ï¼Œå› æ­¤æ–°ç”Ÿæˆçš„å¯†é’¥æœ‰å¯èƒ½ä¸ç°æœ‰å¯†é’¥åŒ¹é…ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥é‡æ–°ç”Ÿæˆä¸€ä¸ªæ–°å¯†é’¥å¹¶é‡è¯•ã€‚æˆ‘ä»¬åº”è¯¥ä¸æ–­é‡è¯•ï¼Œç›´åˆ°çœ‹ä¸åˆ°ç”±äºé‡å¤å¯†é’¥è€Œå¯¼è‡´çš„å¤±è´¥ã€‚å¦‚æœç”¨æˆ·æä¾›çš„è‡ªå®šä¹‰å¯†é’¥å·²å­˜åœ¨äºæˆ‘ä»¬çš„æ•°æ®åº“ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥å‘ç”¨æˆ·è¿”å›é”™è¯¯ã€‚</p></blockquote><p>Another solution of the above problem could be to run a standalone <strong>Key Generation Service</strong> (KGS) that generates random six letters strings beforehand and stores them in a database (letâ€™s call it key-DB). Whenever we want to store a new paste, we will just take one of the already generated keys and use it. This approach will make things quite simple and fast since we will not be worrying about duplications or collisions. KGS will make sure all the keys inserted in key-DB are unique. KGS can use two tables to store keys, one for keys that are not used yet and one for all the used keys. As soon as KGS gives some keys to an application server, it can move these to the used keys table. KGS can always keep some keys in memory so that whenever a server needs them, it can quickly provide them. As soon as KGS loads some keys in memory, it can move them to the used keys table, this way we can make sure each server gets unique keys. If KGS dies before using all the keys loaded in memory, we will be wasting those keys. We can ignore these keys given that we have a huge number of them.</p><blockquote><p>ä¸Šè¿°é—®é¢˜çš„å¦ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯è¿è¡Œä¸€ä¸ªç‹¬ç«‹çš„å¯†é’¥ç”ŸæˆæœåŠ¡ï¼ˆKGSï¼‰ï¼Œè¯¥æœåŠ¡é¢„å…ˆç”Ÿæˆéšæœºçš„å…­ä¸ªå­—æ¯å­—ç¬¦ä¸²å¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸ºå¯†é’¥æ•°æ®åº“ï¼‰ã€‚æ¯å½“æˆ‘ä»¬æƒ³è¦å­˜å‚¨æ–°çš„ç²˜è´´æ—¶ï¼Œæˆ‘ä»¬åªéœ€è·å–å·²ç”Ÿæˆçš„å¯†é’¥ä¹‹ä¸€å¹¶ä½¿ç”¨å®ƒå³å¯ã€‚è¿™ç§æ–¹æ³•å°†ä½¿äº‹æƒ…å˜å¾—éå¸¸ç®€å•å’Œå¿«é€Ÿï¼Œå› ä¸ºæˆ‘ä»¬ä¸ä¼šæ‹…å¿ƒé‡å¤æˆ–å†²çªã€‚ KGS å°†ç¡®ä¿æ’å…¥ key-DB ä¸­çš„æ‰€æœ‰å¯†é’¥éƒ½æ˜¯å”¯ä¸€çš„ã€‚ KGS å¯ä»¥ä½¿ç”¨ä¸¤å¼ è¡¨æ¥å­˜å‚¨å¯†é’¥ï¼Œä¸€å¼ ç”¨äºå°šæœªä½¿ç”¨çš„å¯†é’¥ï¼Œä¸€å¼ ç”¨äºæ‰€æœ‰å·²ä½¿ç”¨çš„å¯†é’¥ã€‚ä¸€æ—¦ KGS å‘åº”ç”¨ç¨‹åºæœåŠ¡å™¨æä¾›ä¸€äº›å¯†é’¥ï¼Œå®ƒå°±å¯ä»¥å°†è¿™äº›å¯†é’¥ç§»åŠ¨åˆ°å·²ä½¿ç”¨çš„å¯†é’¥è¡¨ä¸­ã€‚ KGS å¯ä»¥å§‹ç»ˆå°†ä¸€äº›å¯†é’¥ä¿ç•™åœ¨å†…å­˜ä¸­ï¼Œä»¥ä¾¿æ¯å½“æœåŠ¡å™¨éœ€è¦å®ƒä»¬æ—¶ï¼Œå®ƒå¯ä»¥å¿«é€Ÿæä¾›å®ƒä»¬ã€‚ä¸€æ—¦ KGS åœ¨å†…å­˜ä¸­åŠ è½½ä¸€äº›å¯†é’¥ï¼Œå®ƒå°±å¯ä»¥å°†å®ƒä»¬ç§»åŠ¨åˆ°å·²ä½¿ç”¨çš„å¯†é’¥è¡¨ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç¡®ä¿æ¯ä¸ªæœåŠ¡å™¨éƒ½è·å¾—å”¯ä¸€çš„å¯†é’¥ã€‚å¦‚æœ KGS åœ¨ä½¿ç”¨å†…å­˜ä¸­åŠ è½½çš„æ‰€æœ‰å¯†é’¥ä¹‹å‰å°±æ­»æ‰äº†ï¼Œæˆ‘ä»¬å°†æµªè´¹è¿™äº›å¯†é’¥ã€‚é‰´äºæˆ‘ä»¬æœ‰å¤§é‡çš„å¯†é’¥ï¼Œæˆ‘ä»¬å¯ä»¥å¿½ç•¥è¿™äº›å¯†é’¥ã€‚</p></blockquote><p><strong>Isnâ€™t KGS a single point of failure?</strong> Yes, it is. To solve this, we can have a standby replica of KGS and whenever the primary server dies it can take over to generate and provide keys.</p><blockquote><p>KGS ä¸æ˜¯å•ç‚¹æ•…éšœå—ï¼Ÿæ˜¯çš„ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥æ‹¥æœ‰ä¸€ä¸ª KGS çš„å¤‡ç”¨å‰¯æœ¬ï¼Œæ¯å½“ä¸»æœåŠ¡å™¨æŒ‚æ‰æ—¶ï¼Œå®ƒå°±å¯ä»¥æ¥ç®¡ç”Ÿæˆå’Œæä¾›å¯†é’¥ã€‚</p></blockquote><p><strong>Can each app server cache some keys from key-DB?</strong> Yes, this can surely speed things up. Although in this case, if the application server dies before consuming all the keys, we will end up losing those keys. This could be acceptable since we have 68B unique six letters keys, which are a lot more than we require.</p><blockquote><p>æ¯ä¸ªåº”ç”¨ç¨‹åºæœåŠ¡å™¨å¯ä»¥ç¼“å­˜å¯†é’¥æ•°æ®åº“ä¸­çš„ä¸€äº›å¯†é’¥å—ï¼Ÿæ˜¯çš„ï¼Œè¿™è‚¯å®šå¯ä»¥åŠ å¿«é€Ÿåº¦ã€‚å°½ç®¡åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœåº”ç”¨ç¨‹åºæœåŠ¡å™¨åœ¨æ¶ˆè€—æ‰€æœ‰å¯†é’¥ä¹‹å‰æ­»äº¡ï¼Œæˆ‘ä»¬æœ€ç»ˆå°†ä¸¢å¤±è¿™äº›å¯†é’¥ã€‚è¿™æ˜¯å¯ä»¥æ¥å—çš„ï¼Œå› ä¸ºæˆ‘ä»¬æœ‰ 68B ä¸ªç‹¬ç‰¹çš„å…­ä¸ªå­—æ¯é”®ï¼Œè¿™æ¯”æˆ‘ä»¬éœ€è¦çš„å¤šå¾—å¤šã€‚</p></blockquote><p><strong>How does it handle a paste read request?</strong> Upon receiving a read paste request, the application service layer contacts the datastore. The datastore searches for the key, and if it is found, returns the pasteâ€™s contents. Otherwise, an error code is returned.</p><blockquote><p>å®ƒå¦‚ä½•å¤„ç†ç²˜è´´è¯»å–è¯·æ±‚ï¼Ÿåœ¨æ¥æ”¶åˆ°è¯»å–ç²˜è´´è¯·æ±‚åï¼Œåº”ç”¨ç¨‹åºæœåŠ¡å±‚è”ç³»æ•°æ®å­˜å‚¨ã€‚æ•°æ®å­˜å‚¨åŒºæœç´¢å¯†é’¥ï¼Œå¦‚æœæ‰¾åˆ°ï¼Œåˆ™è¿”å›ç²˜è´´çš„å†…å®¹ã€‚å¦åˆ™ï¼Œè¿”å›é”™è¯¯ä»£ç ã€‚</p></blockquote><p><strong>b. Datastore layer b.æ•°æ®å­˜å‚¨å±‚</strong></p><p>We can divide our datastore layer into two:</p><blockquote><p>æˆ‘ä»¬å¯ä»¥å°†æ•°æ®å­˜å‚¨å±‚åˆ†ä¸ºä¸¤å±‚ï¼š</p></blockquote><ol><li><p>Metadata database: We can use a relational database like MySQL or a Distributed Key-Value store like Dynamo or Cassandra.</p><blockquote><p>å…ƒæ•°æ®æ•°æ®åº“ï¼šæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…³ç³»æ•°æ®åº“ï¼ˆä¾‹å¦‚ MySQLï¼‰æˆ–åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨ï¼ˆä¾‹å¦‚ Dynamo æˆ– Cassandraï¼‰ã€‚</p></blockquote></li><li><p>Object storage: We can store our contents in an Object Storage like Amazonâ€™s S3. Whenever we feel like hitting our full capacity on content storage, we can easily increase it by adding more servers.</p><blockquote><p>å¯¹è±¡å­˜å‚¨ï¼šæˆ‘ä»¬å¯ä»¥å°†å†…å®¹å­˜å‚¨åœ¨å¯¹è±¡å­˜å‚¨ä¸­ï¼Œä¾‹å¦‚ Amazon çš„ S3ã€‚æ¯å½“æˆ‘ä»¬æƒ³è¦å……åˆ†åˆ©ç”¨å†…å®¹å­˜å‚¨å®¹é‡æ—¶ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥é€šè¿‡æ·»åŠ æ›´å¤šæœåŠ¡å™¨æ¥è½»æ¾å¢åŠ å®¹é‡ã€‚</p></blockquote></li></ol><p><img src=/images/pastebin-02.webp alt=image-20231116090313481></p><p>Detailed component design for Pastebin</p><blockquote><p>Pastebin çš„è¯¦ç»†ç»„ä»¶è®¾è®¡</p></blockquote><h2 id=9-purging-or-db-cleanup>9. Purging or DB Cleanup</h2><blockquote><ol start=9><li>æ¸…é™¤æˆ–æ•°æ®åº“æ¸…ç†</li></ol></blockquote><p>Please see <a href=https://www.educative.io/collection/page/5668639101419520/5649050225344512/5668600916475904 target=_blank>Designing a URL Shortening service</a>.</p><blockquote><p>è¯·å‚é˜…è®¾è®¡ URL ç¼©çŸ­æœåŠ¡ã€‚</p></blockquote><h2 id=10-data-partitioning-and-replication>10. Data Partitioning and Replication</h2><blockquote><ol start=10><li>æ•°æ®åˆ†åŒºå’Œå¤åˆ¶</li></ol></blockquote><p>Please see <a href=https://www.educative.io/collection/page/5668639101419520/5649050225344512/5668600916475904 target=_blank>Designing a URL Shortening service</a>.</p><blockquote><p>è¯·å‚é˜…è®¾è®¡ URL ç¼©çŸ­æœåŠ¡ã€‚</p></blockquote><h2 id=11-cache-and-load-balancer>11. Cache and Load Balancer</h2><blockquote><ol start=11><li>ç¼“å­˜å’Œè´Ÿè½½å‡è¡¡å™¨</li></ol></blockquote><p>Please see <a href=https://www.educative.io/collection/page/5668639101419520/5649050225344512/5668600916475904 target=_blank>Designing a URL Shortening service</a>.</p><blockquote><p>è¯·å‚é˜…è®¾è®¡ URL ç¼©çŸ­æœåŠ¡ã€‚</p></blockquote><h2 id=12-security-and-permissions>12. Security and Permissions</h2><blockquote><ol start=12><li>å®‰å…¨å’Œæƒé™</li></ol></blockquote><p>Please see <a href=https://www.educative.io/collection/page/5668639101419520/5649050225344512/5668600916475904 target=_blank>Designing a URL Shortening service</a>.</p><blockquote><p>è¯·å‚é˜…è®¾è®¡ URL ç¼©çŸ­æœåŠ¡ã€‚</p></blockquote></div><div><div style=font-weight:700>Share this post:</div><a class=social-link-item href="https://twitter.com/intent/tweet?text=%5b%e8%af%91%5d%e3%80%8aGrokking%20the%20System%20Design%20Interview%e3%80%8b%e8%ae%be%e8%ae%a1Pastebin https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f11%2f24%2fdesigning-pastebin%2f" target=_blank rel="noopener noreferrer" title="Click to share on Twitter"><i class="fa-brands fa-square-twitter fa-2xl" style=color:#55acee></i>
</a><a class=social-link-item href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f11%2f24%2fdesigning-pastebin%2f&title=%5b%e8%af%91%5d%e3%80%8aGrokking%20the%20System%20Design%20Interview%e3%80%8b%e8%ae%be%e8%ae%a1Pastebin" target=_blank rel="noopener noreferrer" title="Click to share on LinkedIn"><i class="fa-brands fa-linkedin fa-2xl" style=color:#007bb5></i>
</a><a class=social-link-item href="https://telegram.me/share/url?text=%5b%e8%af%91%5d%e3%80%8aGrokking%20the%20System%20Design%20Interview%e3%80%8b%e8%ae%be%e8%ae%a1Pastebin&amp;url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f11%2f24%2fdesigning-pastebin%2f" target=_blank rel="noopener noreferrer" title="Click to share on telegram"><i class="fa-brands fa-telegram fa-2xl" style=color:#007bb5></i>
</a><a class=social-link-item href="https://reddit.com/submit?url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f11%2f24%2fdesigning-pastebin%2f&title=%5b%e8%af%91%5d%e3%80%8aGrokking%20the%20System%20Design%20Interview%e3%80%8b%e8%ae%be%e8%ae%a1Pastebin" target=_blank rel="noopener noreferrer" title="Click to share on reddit"><i class="fa-brands fa-reddit fa-2xl" style=color:#007bb5></i>
</a><a class=social-link-item href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f11%2f24%2fdesigning-pastebin%2f" target=_blank rel="noopener noreferrer" title="Click to share on facebook"><i class="fa-brands fa-facebook fa-2xl" style=color:#007bb5></i>
</a><a class=social-link-item href="https://api.whatsapp.com/send?text=%5b%e8%af%91%5d%e3%80%8aGrokking%20the%20System%20Design%20Interview%e3%80%8b%e8%ae%be%e8%ae%a1Pastebin%20-%20https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f11%2f24%2fdesigning-pastebin%2f" target=_blank rel="noopener noreferrer" title="Click to share on whatsapp"><i class="fa-brands fa-whatsapp fa-2xl" style=color:#007bb5></i></a></div></div></article><nav class="navigation post-navigation" role=navigation><h2 class=screen-reader-text>Post navigation</h2><div class=nav-links><div class=nav-previous><a href=/posts/2023/11/24/designing-instagram/ rel=next><span class=post-title>[è¯‘]ã€ŠGrokking the System Design Interviewã€‹è®¾è®¡Instagram</span></a></div><div class=nav-next><a href=/posts/2023/11/17/dns/ rel=prev><span class=post-title>[è¯‘]ã€ŠGrokking the System Design Interviewã€‹åŸŸåç³»ç»Ÿ</span></a></div></div></nav><h2>Related content</h2><ul><li><a href=/posts/2023/12/14/designing-twitter/>[è¯‘]ã€ŠGrokking the System Design Interviewã€‹è®¾è®¡Twitter</a></li><li><a href=/posts/2023/12/05/distributed-id-generator/>å¦‚ä½•è®¾è®¡ä¸€ä¸ªåˆ†å¸ƒå¼IDç”Ÿæˆå™¨ä¿è¯IDæŒ‰æ—¶é—´æœ‰åºï¼Ÿ</a></li><li><a href=/posts/2023/11/24/designing-dropbox/>[è¯‘]ã€ŠGrokking the System Design Interviewã€‹è®¾è®¡Dropbox</a></li><li><a href=/posts/2023/11/24/designing-facebook-messenger/>[è¯‘]ã€ŠGrokking the System Design Interviewã€‹è®¾è®¡Facebook Messenger</a></li><li><a href=/posts/2023/11/24/designing-instagram/>[è¯‘]ã€ŠGrokking the System Design Interviewã€‹è®¾è®¡Instagram</a></li><li><a href=/posts/2023/11/17/dns/>[è¯‘]ã€ŠGrokking the System Design Interviewã€‹åŸŸåç³»ç»Ÿ</a></li><li><a href=/posts/2023/11/17/designing-a-url-shortening-service/>å¦‚ä½•è®¾è®¡ä¸€ä¸ªçŸ­ç½‘å€æœåŠ¡</a></li><li><a href=/posts/2023/11/16/system-design-master-template/>[è¯‘]ã€ŠGrokking the System Design Interviewã€‹ç³»ç»Ÿè®¾è®¡ä¸»æ¨¡æ¿</a></li><li><a href=/posts/2023/11/16/sdi-a-step-by-step-guide/>[è¯‘]ã€ŠGrokking the System Design Interviewã€‹ç³»ç»Ÿè®¾è®¡è®¿è°ˆï¼šåˆ†æ­¥æŒ‡å—</a></li><li><a href=/posts/2023/11/16/designing-a-url-shortening-service/>[è¯‘]ã€ŠGrokking the System Design Interviewã€‹è®¾è®¡ç±»ä¼¼ TinyURL çš„ URL ç¼©çŸ­æœåŠ¡</a></li></ul></main></section></div><div id=footer class=footer-wrap><footer id=colophon class="site-footer container clearfix" role=contentinfo><div id=footer-text class=site-info><span class=credit-link>Made with ğŸ©·
by <a href=/ target=_blank rel="noopener noreferrer">ChenSoul</a></span></div></footer></div></div><script type=text/javascript src=/main.min.js></script></body></html>