<!doctype html><html lang=en-US prefix="og: http://ogp.me/ns#"><head><meta charset=utf-8><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Today I Learned. 今天分享内容：发布到 Maven 中央仓库的第一个项目。
最近在 Github 上创建了一个 Pom 类型的 Maven 项目 chensoul-parent，该项目主页 https://chensoul.github.io/chensoul-parent/ ，这是我的第一个发布对 Maven 中央仓库的项目。"><title>2023-12-13｜发布到Maven中央仓库的第一个项目 | ChenSoul</title>
<link rel=canonical href=https://blog.chensoul.cc/posts/2023/12/13/til/><link rel=preconnect href=https://fonts.font.im><link rel=preconnect href=https://fonts.loli.net crossorigin><link href="https://fonts.loli.net/css2?family=Roboto+Slab:wght@400;500;700&display=swap" rel=stylesheet><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.chensoul.cc/images/favicon.webp"><meta name=twitter:title content="2023-12-13｜发布到Maven中央仓库的第一个项目"><meta name=twitter:description content="Today I Learned. 今天分享内容：发布到 Maven 中央仓库的第一个项目。
最近在 Github 上创建了一个 Pom 类型的 Maven 项目 chensoul-parent，该项目主页 https://chensoul.github.io/chensoul-parent/ ，这是我的第一个发布对 Maven 中央仓库的项目。"><meta name=twitter:creator content="@ichensoul"><meta property="og:locale" content="en_US"><meta property="og:site_name" content="chensoul"><meta property="og:url" content="https://blog.chensoul.cc/posts/2023/12/13/til/"><meta property="og:site_name" content="ChenSoul"><meta property="og:title" content="2023-12-13｜发布到Maven中央仓库的第一个项目"><meta property="og:description" content="Today I Learned. 今天分享内容：发布到 Maven 中央仓库的第一个项目。
最近在 Github 上创建了一个 Pom 类型的 Maven 项目 chensoul-parent，该项目主页 https://chensoul.github.io/chensoul-parent/ ，这是我的第一个发布对 Maven 中央仓库的项目。"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-12-13T00:00:00+00:00"><meta property="article:modified_time" content="2023-12-13T00:00:00+00:00"><meta property="article:tag" content="Maven"><meta property="og:image" content="https://blog.chensoul.cc/images/favicon.webp"><meta itemprop=name content="2023-12-13｜发布到Maven中央仓库的第一个项目"><meta itemprop=description content="Today I Learned. 今天分享内容：发布到 Maven 中央仓库的第一个项目。
最近在 Github 上创建了一个 Pom 类型的 Maven 项目 chensoul-parent，该项目主页 https://chensoul.github.io/chensoul-parent/ ，这是我的第一个发布对 Maven 中央仓库的项目。"><meta itemprop=datePublished content="2023-12-13T00:00:00+00:00"><meta itemprop=dateModified content="2023-12-13T00:00:00+00:00"><meta itemprop=wordCount content="1058"><meta itemprop=image content="https://blog.chensoul.cc/images/favicon.webp"><meta itemprop=keywords content="Maven"><link rel=stylesheet href=https://cdnjs.loli.net/ajax/libs/font-awesome/6.4.0/css/all.min.css media=all><link rel=stylesheet href=/main.min.css type=text/css media=all><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"TechArticle","name":"2023-12-13｜发布到Maven中央仓库的第一个项目","headline":"2023-12-13｜发布到Maven中央仓库的第一个项目","inLanguage":"en-US","url":"https://blog.chensoul.cc/posts/2023/12/13/til/","description":"\u003cp\u003eToday I Learned. 今天分享内容：发布到 Maven 中央仓库的第一个项目。\u003c/p\u003e\n\u003cp\u003e最近在 Github 上创建了一个 Pom 类型的 Maven 项目 \u003ca href=\"https://github.com/chensoul/chensoul-parent/\" target=\"_blank\"\u003echensoul-parent\u003c/a\u003e，该项目主页 \u003ca href=\"https://chensoul.github.io/chensoul-parent/\" target=\"_blank\"\u003ehttps://chensoul.github.io/chensoul-parent/\u003c/a\u003e ，这是我的第一个发布对 Maven 中央仓库的项目。\u003c/p\u003e","wordCount":"1058","keywords":["maven"],"datePublished":"2023-12-13T00:00:00Z","dateModified":"2023-12-13T00:00:00Z","author":{"@type":"Person","name":"chensoul"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.chensoul.cc/posts/2023/12/13/til/"},"publisher":{"@type":"Organization","name":"chensoul","url":"https://blog.chensoul.cc/posts/2023/12/13/til/"}},{"@context":"https://schema.org","@type":"Organization","name":"chensoul","url":"https://blog.chensoul.cc/","sameAs":["https://x.com/ichensoul","https://github.com/chensoul","https://www.linkedin.com/in/","https://www.youtube.com/@chensoul","https://t.me/chensouls"]}]}</script><script defer src=https://umami.chensoul.cc/random-string.js data-website-id=821c25f8-a31a-4607-92d7-91ee76843d00></script></head><body class="home blog post-layout-one-column"><button onclick=topFunction() id=scrollTopBtn title="Go to top">
<i class="fa-solid fa-arrow-up"></i></button><div id=header-top class=header-bar-wrap></div><div id=page class=site><a class="skip-link screen-reader-text" href=#content>Skip to content</a><header id=masthead class="site-header clearfix" role=banner><div class="header-main container clearfix"><div id=logo class="site-branding clearfix"><h1 class=site-title><a href=/ title=ChenSoul rel=home>ChenSoul</a></h1><p class=site-description>Java, Spring Boot, Microservice, Cloud, Architecture and DevOps Tutorials</p></div><div class="header-widgets clearfix"><aside id=search-2 class="header-widget widget_search"><form role=search method=get class=search-form onsubmit="return searchSite(event)"><label><span class=screen-reader-text>Search for:</span>
<input type=search class=search-field placeholder="Enter search keyword" name=query id=query title="Enter search keyword">
</label><button type=submit class=search-submit title=Search> <span class=genericon-search></span>
<span class=screen-reader-text>Search</span></button></form></aside></div></div><div id=main-navigation-wrap class=primary-navigation-wrap><nav id=main-navigation class="primary-navigation navigation container clearfix" role=navigation><ul id=menu-home class=main-navigation-menu><li class="menu-item menu-item-type-custom menu-item-object-custom
current-menu-item current_page_item menu-item-home"><a href=/>Home</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/categories/spring-boot/>Spring Boot</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/categories/architecture/>Architecture</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/categories/microservice/>Microservice</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/categories/kubernetes/>Kubernetes</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category
menu-item-has-children"><a href=/tutorials/>Tutorials</a><ul class=sub-menu><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/spring-boot-tutorials/>Spring Boot Tutorials</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/microservice-tutorials/>Microservice Tutorials</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category"><a href=/kubernetes-tutorials/>Kubernetes Tutorials</a></li></ul></li><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=https://github.com/chensoul target=_blank>About Me</a></li></ul></nav></div></header><div id=content class="site-content container clearfix"><section id=primary class="content-archive content-area post-content-area"><main id=main class=site-main role=main><article class="post type-post"><div class=post-inner-content><header class=entry-header><h2 class=entry-title><a href=https://blog.chensoul.cc/posts/2023/12/13/til/ rel=bookmark title=2023-12-13｜发布到Maven中央仓库的第一个项目>2023-12-13｜发布到Maven中央仓库的第一个项目</a></h2><div class=entry-meta><span class=meta-date><time class="entry-date published" datetime=2023-12-13T00:00:00>2023-12-13
</time></span><span class=meta-author><span class="author vcard">chensoul</span>
</span><span class="tagcloud post-tags"><i class="fa fa-tags"></i>&nbsp;
<a class="tag-cloud-link widget__link widget__link--taglist" href=/tags/maven/ title=maven>maven</a></span></div></header><div class=entry-content><p>Today I Learned. 今天分享内容：发布到 Maven 中央仓库的第一个项目。</p><p>最近在 Github 上创建了一个 Pom 类型的 Maven 项目 <a href=https://github.com/chensoul/chensoul-parent/ target=_blank>chensoul-parent</a>，该项目主页 <a href=https://chensoul.github.io/chensoul-parent/ target=_blank>https://chensoul.github.io/chensoul-parent/</a> ，这是我的第一个发布对 Maven 中央仓库的项目。</p><p><img src=/images/daily-review-20231213-00.webp alt=daily-review-20231213-00></p><p>其主要用途是管理常用的 Maven Plugin 插件。在编写该项目的过程中，参考了一些开源项目，他们分别是：</p><ul><li><a href=https://github.com/eclipse/microprofile target=_blank>https://github.com/eclipse/microprofile</a> Eclipse 的一套开源微服务框架实现</li><li><a href=https://github.com/microbean/microbean-function target=_blank>https://github.com/microbean/microbean-function</a> microBean™ 的 Java 扩展</li><li><a href=https://github.com/naturalett/maven-hello-world target=_blank>https://github.com/naturalett/maven-hello-world</a> 一个 Maven 发布 Jar 的 hello world 的示例项目</li><li><a href=https://github.com/eclipse-store/store target=_blank>https://github.com/eclipse-store/store</a> Eclipse 开源的一个高性能 Java 原生持久存储。微秒响应时间。超高吞吐量。最小延迟。创建超快速内存数据库应用程序和微服务。</li></ul><p>该项目打包之后是一个 pom 文件，任何 Maven 项目都可以继承这个项目，这样可以免去自己管理 Mave Plugin 插件的麻烦。这里面的 Mave Plugin 插件包括：</p><ul><li>编译</li><li>打包</li><li>发布</li><li>测试，并生成测试报告</li><li>质量检测，包括代码风格检查、漏洞检测</li><li>生成网站并发布到 github pages</li></ul><p>发布先是使用的 Maven Release Plugin 和 Nexus Staging Maven Plugin 插件，后来觉得 Maven Release Plugin 插件做的事情太多了，不如手动执行命令，于是去掉了 Maven Release Plugin 插件。</p><p>关于 Nexus Staging Maven Plugin 插件的使用了，起初我使用了这个仓库发布 Maven 构建的<a href=https://github.com/microbean/microbean-function/blob/main/.github/workflows/mvn-release-prepare-perform.yaml target=_blank>脚本</a> 。这个脚本比较复杂，于是找到了 <a href=https://github.com/naturalett/maven-hello-world target=_blank>https://github.com/naturalett/maven-hello-world</a> 这个仓库，其对应的博客 《<a href=https://itnext.io/publishing-artifacts-to-maven-central-using-github-actions-a-step-by-step-guide-fd65ef075fd4 target=_blank>Publishing Artifacts to Maven Central using GitHub Actions: A Step-by-Step Guide</a>》，对于如何部署构建到 Maven 中央仓库、如何使用 Github Action 说的比较清楚。如果你对于如何使用这个插件，可以阅读该文章，本文不作赘述。</p><p>我对 Github Action 的 Workflow 做过一些优化。优化后的 Workflow 文件内容如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;Maven Release&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>workflow_dispatch</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>inputs</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>releaseVersion</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>description</span>: <span style=color:#e6db74>&#34;Define the RELEASE version&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>required</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>default</span>: <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>developmentVersion</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>description</span>: <span style=color:#e6db74>&#34;Define the SNAPSHOT version&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>required</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>default</span>: <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>autoReleaseAfterClose</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>description</span>: <span style=color:#e6db74>&#34;Auto release after close&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>required</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>default</span>: <span style=color:#e6db74>&#34;false&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v2</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Set up Maven Central Repository</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/setup-java@v4</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>java-version</span>: <span style=color:#ae81ff>11</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>distribution</span>: <span style=color:#e6db74>&#34;temurin&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>java-package</span>: <span style=color:#e6db74>&#34;jdk&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>cache</span>: <span style=color:#e6db74>&#34;maven&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>server-id</span>: <span style=color:#ae81ff>ossrh</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>server-username</span>: <span style=color:#ae81ff>OSSRH_USERNAME</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>server-password</span>: <span style=color:#ae81ff>OSSRH_TOKEN</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>gpg-passphrase</span>: <span style=color:#ae81ff>MAVEN_GPG_PASSPHRASE</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>gpg-private-key</span>: <span style=color:#ae81ff>${{ secrets.MAVEN_GPG_PRIVATE_KEY }}</span>
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Configure Git User</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          git config --global user.email &#34;github-actions[bot]@users.noreply.github.com&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          git config --global user.name &#34;github-actions[bot]&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          echo &#34;sha_short=$(git rev-parse --short HEAD)&#34; &gt;&gt; $GITHUB_ENV</span>
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Verify Whether a Release is Ready</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>shell</span>: <span style=color:#ae81ff>bash</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          if [ &#34;${{ github.event.inputs.autoReleaseAfterClose }}&#34; == &#34;true&#34; ] ; then
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            echo &#34;auto_release=true&#34; &gt;&gt; $GITHUB_ENV
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          else
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            echo &#34;auto_release=false&#34; &gt;&gt; $GITHUB_ENV
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          fi</span>
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Fetch Artifact Information</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>shell</span>: <span style=color:#ae81ff>bash</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          # remove &#39;-SNAPSHOT&#39; from version
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          echo &#34;artifact_version=$(grep -m1 &#39;&lt;version&gt;&#39; pom.xml | sed &#39;s/.*&lt;version&gt;\([^&lt;]*\)&lt;\/version&gt;.*/\1/&#39; | sed &#39;s/-SNAPSHOT$//&#39;)&#34; &gt;&gt; &#34;$GITHUB_ENV&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          echo &#34;artifact_name=$(grep -m1 &#39;&lt;artifactId&gt;&#39; pom.xml | sed &#39;s/.*&lt;artifactId&gt;\([^&lt;]*\)&lt;\/artifactId&gt;.*/\1/&#39;)&#34; &gt;&gt; &#34;$GITHUB_ENV&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          echo &#34;artifact_packaging=$(grep -m1 &#39;&lt;packaging&gt;&#39; pom.xml | sed &#39;s/.*&lt;packaging&gt;\([^&lt;]*\)&lt;\/packaging&gt;.*/\1/&#39;)&#34; &gt;&gt; &#34;$GITHUB_ENV&#34;</span>
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Release With Maven</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          echo &#34;${{ env.artifact_name }} ${{ env.artifact_version }} ${{ env.artifact_packaging }}&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          mvn --ntp -B -U \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            release:prepare \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            release:perform \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            -DreleaseVersion=${{ github.event.inputs.releaseVersion }} \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            -DdevelopmentVersion=${{ github.event.inputs.developmentVersion }} \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            deploy \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            -Prelease \
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            -Dgpg.passphrase=${{ secrets.MAVEN_GPG_PASSPHRASE }}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          ls -al ./target/</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>OSSRH_USERNAME</span>: <span style=color:#ae81ff>${{ secrets.OSSRH_USERNAME }}</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>OSSRH_TOKEN</span>: <span style=color:#ae81ff>${{ secrets.OSSRH_TOKEN }}</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>MAVEN_GPG_PASSPHRASE</span>: <span style=color:#ae81ff>${{ secrets.MAVEN_GPG_PASSPHRASE }}</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>AUTO_RELEASE_AFTER_CLOSE</span>: <span style=color:#ae81ff>${{ env.auto_release }}</span>
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Upload Artifact</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/upload-artifact@v3</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>name</span>: <span style=color:#ae81ff>${{ env.artifact_name }}-${{ env.artifact_version }}</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>path</span>: <span style=color:#ae81ff>./target/${{ env.artifact_name }}-${{ env.artifact_version }}.${{ env.artifact_packaging }}</span>
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Workflow Release Notes</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>peter-evans/repository-dispatch@v2</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>event-type</span>: <span style=color:#ae81ff>github-release</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>client-payload</span>: <span style=color:#e6db74>&#39;{&#34;auto_release&#34;: &#34;${{ env.auto_release }}&#34;, &#34;artifact&#34;: &#34;${{ env.artifact_name }}-${{ env.artifact_version }}&#34;}&#39;</span>
</span></span></code></pre></div><p>在 Github Action 手动执行该 Workflow 文件时，可以指定正式版本、开发版本以及是否将 Maven 构建发布到中央仓库。如果是，则会触发 github-release.yml 这个 Workflow 在该 github 仓库创建一个 Release，效果如下：</p><p><img src=/images/daily-review-20231213-01.webp alt=daily-review-20231214-01></p><p><a href=https://github.com/naturalett/maven-hello-world target=_blank>https://github.com/naturalett/maven-hello-world</a> 这个仓库使用了 settings.xml 文件用于在 Github Action 中设置用户名和密码，这不是一个很好的解决方案。</p><p>随后，在 <a href=https://github.com/eclipse-store/store target=_blank>https://github.com/eclipse-store/store</a> 仓库中找到了使用 Github Action 发布 Maven 构建 的一个比较<a href=https://github.com/eclipse-store/store/blob/main/.github/workflows/maven_release.yml target=_blank>简洁的实现</a>。从该文件的注释可以看到 Github Action 官方文档有关于<a href=https://github.com/actions/setup-java/blob/main/docs/advanced-usage.md#apache-maven-with-a-settings-path target=_blank>使用 Maven 的介绍</a> 。</p><p>于是，在去掉 Maven Release Plugin 之后，又把 settings.xml 文件删除了。个人觉得是否创建 Github Release 应该手动控制更好一些，于是将 github-release.yml 这个 Workflow 也从我的仓库中删除了。</p><p>在 <a href=https://github.com/eclipse/microprofile-config target=_blank>microprofile-config</a> 仓库里发现了一个 <a href=https://github.com/eclipse/microprofile-config/blob/main/.github/dependabot.yml target=_blank>dependabot.yml</a> ，于是把这个文件加入了我的项目中。添加该文件之后，会有一个机器人每天检查项目中使用的 maven 插件版本是否是最新版本，如果不是，则会创建一个 pull request。</p><p><img src=/images/daily-review-20231213-02.webp alt=daily-review-20231214-01></p><p>更多技术内容和如此使用，请查看<a href=https://github.com/chensoul/chensoul-parent/blob/main/pom.xml target=_blank>源码</a>。</p><h2 id=maven-项目到中央仓库流程>Maven 项目到中央仓库流程</h2><p>发布 Maven 项目到中央仓库流程：</p><h3 id=1-pomxml-配置如下信息>1. pom.xml 配置如下信息</h3><ul><li>License 信息</li><li>开发人员信息</li><li>SCM 信息</li><li>Javadoc 和 Sources 插件</li><li>Distribution 管理</li><li>设置一个 profile （可选）</li></ul><p>以 <a href=https://github.com/chensoul/chensoul-parent/ target=_blank>chensoul-parent</a> 项目为例，License 信息如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>		<span style=color:#f92672>&lt;licenses&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;license&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;name&gt;</span>Apache License 2.0<span style=color:#f92672>&lt;/name&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;url&gt;</span>https://www.apache.org/licenses/LICENSE-2.0.txt<span style=color:#f92672>&lt;/url&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;comments&gt;</span>The Apache License, Version 2.0<span style=color:#f92672>&lt;/comments&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;distribution&gt;</span>repo<span style=color:#f92672>&lt;/distribution&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/license&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/licenses&gt;</span>
</span></span></code></pre></div><p>开发人员信息：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>		<span style=color:#f92672>&lt;organization&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;name&gt;</span>ChenSoul™<span style=color:#f92672>&lt;/name&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;url&gt;</span>https://blog.chensoul.cc/<span style=color:#f92672>&lt;/url&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/organization&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;developers&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;developer&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;id&gt;</span>chensoul<span style=color:#f92672>&lt;/id&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;name&gt;</span>chensoul<span style=color:#f92672>&lt;/name&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;email&gt;</span>chensoul.eth@gmail.com<span style=color:#f92672>&lt;/email&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;url&gt;</span>https://blog.chensoul.cc<span style=color:#f92672>&lt;/url&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;roles&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;role&gt;</span>architect<span style=color:#f92672>&lt;/role&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>&lt;role&gt;</span>developer<span style=color:#f92672>&lt;/role&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;/roles&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;timezone&gt;</span>+8<span style=color:#f92672>&lt;/timezone&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/developer&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/developers&gt;</span>
</span></span></code></pre></div><p>SCM 信息：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>		<span style=color:#f92672>&lt;scm&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;connection&gt;</span>scm:git:https://github.com/chensoul/chensoul-parent.git<span style=color:#f92672>&lt;/connection&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;developerConnection&gt;</span>scm:git:https://github.com/chensoul/chensoul-parent.git<span style=color:#f92672>&lt;/developerConnection&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;url&gt;</span>https://github.com/chensoul/chensoul-parent.git<span style=color:#f92672>&lt;/url&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;tag&gt;</span>HEAD<span style=color:#f92672>&lt;/tag&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/scm&gt;</span>
</span></span></code></pre></div><p>Javadoc 和 Sources 插件：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;build&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;pluginManagement&gt;</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>&lt;plugins&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;plugin&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;groupId&gt;</span>org.apache.maven.plugins<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;artifactId&gt;</span>maven-source-plugin<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;version&gt;</span>3.3.0<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;executions&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;execution&gt;</span>
</span></span><span style=display:flex><span>                  <span style=color:#f92672>&lt;id&gt;</span>attach-sources<span style=color:#f92672>&lt;/id&gt;</span>
</span></span><span style=display:flex><span>                  <span style=color:#f92672>&lt;goals&gt;</span>
</span></span><span style=display:flex><span>                      <span style=color:#f92672>&lt;goal&gt;</span>jar-no-fork<span style=color:#f92672>&lt;/goal&gt;</span>
</span></span><span style=display:flex><span>                  <span style=color:#f92672>&lt;/goals&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;/execution&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;/executions&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/plugin&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;plugin&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;groupId&gt;</span>org.apache.maven.plugins<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;artifactId&gt;</span>maven-javadoc-plugin<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;version&gt;</span>3.6.3<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;configuration&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;additionalJOptions</span> <span style=color:#a6e22e>combine.children=</span><span style=color:#e6db74>&#34;append&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>                  <span style=color:#f92672>&lt;additionalJOption&gt;</span>-J-Dhttp.agent=maven-javadoc-plugin<span style=color:#f92672>&lt;/additionalJOption&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;/additionalJOptions&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;attach&gt;</span>true<span style=color:#f92672>&lt;/attach&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;doclint&gt;</span>none<span style=color:#f92672>&lt;/doclint&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;doctitle&gt;</span>&amp;lt;a href=&#34;${project.url}&#34; target=&#34;_top&#34;&amp;gt;${project.artifactId}&amp;lt;/a&amp;gt;
</span></span><span style=display:flex><span>                  ${project.version}
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;/doctitle&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;docfilessubdirs&gt;</span>true<span style=color:#f92672>&lt;/docfilessubdirs&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;windowtitle&gt;</span>${project.name}<span style=color:#f92672>&lt;/windowtitle&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;header&gt;</span><span style=color:#75715e>&lt;![CDATA[&lt;br&gt;${project.name} v${project.version}]]&gt;</span><span style=color:#f92672>&lt;/header&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;bottom&gt;</span>
</span></span><span style=display:flex><span>                  <span style=color:#75715e>&lt;![CDATA[Copyright &amp;copy; ${project.inceptionYear}&amp;ndash;{currentYear}, &lt;a href=&#34;${project.organization.url}&#34; target=&#34;_parent&#34;&gt;${project.organization.name}&lt;/a&gt;. All rights reserved.]]&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;/bottom&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;/configuration&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;executions&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;execution&gt;</span>
</span></span><span style=display:flex><span>                  <span style=color:#f92672>&lt;id&gt;</span>attach-javadocs<span style=color:#f92672>&lt;/id&gt;</span>
</span></span><span style=display:flex><span>                  <span style=color:#f92672>&lt;goals&gt;</span>
</span></span><span style=display:flex><span>                      <span style=color:#f92672>&lt;goal&gt;</span>jar<span style=color:#f92672>&lt;/goal&gt;</span>
</span></span><span style=display:flex><span>                  <span style=color:#f92672>&lt;/goals&gt;</span>
</span></span><span style=display:flex><span>              <span style=color:#f92672>&lt;/execution&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>&lt;/executions&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/plugin&gt;</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>&lt;/plugins&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;/pluginManagement&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/build&gt;</span>
</span></span></code></pre></div><p>Distribution 管理信息：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;distributionManagement&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;repository&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;id&gt;</span>ossrh<span style=color:#f92672>&lt;/id&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;url&gt;</span>https://s01.oss.sonatype.org/service/local/staging/deploy/maven2/<span style=color:#f92672>&lt;/url&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/repository&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;snapshotRepository&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;id&gt;</span>ossrh<span style=color:#f92672>&lt;/id&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;url&gt;</span>https://s01.oss.sonatype.org/content/repositories/snapshots<span style=color:#f92672>&lt;/url&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;uniqueVersion&gt;</span>true<span style=color:#f92672>&lt;/uniqueVersion&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/snapshotRepository&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/distributionManagement&gt;</span>
</span></span></code></pre></div><p>设置一个 profile：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;profile&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;id&gt;</span>release<span style=color:#f92672>&lt;/id&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;build&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;plugins&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;plugin&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;groupId&gt;</span>org.apache.maven.plugins<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;artifactId&gt;</span>maven-javadoc-plugin<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/plugin&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;plugin&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;groupId&gt;</span>org.apache.maven.plugins<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;artifactId&gt;</span>maven-release-plugin<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/plugin&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;plugin&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;groupId&gt;</span>org.apache.maven.plugins<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;artifactId&gt;</span>maven-enforcer-plugin<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/plugin&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;plugin&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;groupId&gt;</span>org.apache.maven.plugins<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;artifactId&gt;</span>maven-gpg-plugin<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/plugin&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;plugin&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;groupId&gt;</span>pl.project13.maven<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;artifactId&gt;</span>git-commit-id-plugin<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/plugin&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;plugin&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;groupId&gt;</span>org.sonatype.plugins<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;artifactId&gt;</span>nexus-staging-maven-plugin<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;/plugin&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/plugins&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;/build&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/profile&gt;</span>
</span></span></code></pre></div><h3 id=2-gpg-设置>2. GPG 设置</h3><ul><li>安装 GPG</li><li>生成 key</li><li>上传 key</li></ul><p>MacOs 上操作如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brew install gpg
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Generate a key</span>
</span></span><span style=display:flex><span>gpg --gen-key
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># List your key</span>
</span></span><span style=display:flex><span>gpg --list-keys
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Define a key expiration</span>
</span></span><span style=display:flex><span>: <span style=color:#e6db74>&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  Press 1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  Type expire
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  Type the expiration Months\Years
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  Type save
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#39;</span>
</span></span><span style=display:flex><span>gpg --edit-key &lt;Your Key - You Can Get From The Command Above --list-keys&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Distribute your public key to a key server</span>
</span></span><span style=display:flex><span>gpg --keyserver keyserver.ubuntu.com --send-keys &lt;Your Key - You Can Get From The Command Above --list-keys&gt;
</span></span></code></pre></div><h3 id=3-创建-sonatype-账号>3. 创建 Sonatype 账号</h3><ul><li><p>在 <a href=https://issues.sonatype.org/ target=_blank>Sonatype Jira</a> 上创建用户，并提交 Issure</p></li><li><p>在 settings.xml 中配置 Sonatype 用户名和密码以及 gpg 密钥</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;servers&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;server&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;id&gt;</span>gpg.passphrase<span style=color:#f92672>&lt;/id&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;passphrase&gt;</span>xxxx<span style=color:#f92672>&lt;/passphrase&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/server&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;server&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;id&gt;</span>ossrh<span style=color:#f92672>&lt;/id&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;username&gt;</span>xxxx<span style=color:#f92672>&lt;/username&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;password&gt;</span>xxxxx<span style=color:#f92672>&lt;/password&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/server&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/servers&gt;</span>
</span></span></code></pre></div></li></ul><h3 id=4-部署-maven>4. 部署 Maven</h3><p>deploy 命令：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mvn clean source:jar javadoc:jar deploy -DskipTests -P release
</span></span></code></pre></div><p>执行成功之后，可以在下面三个仓库查看：</p><ul><li><a href=https://s01.oss.sonatype.org/content/repositories/snapshots/com/chensoul/chensoul-parent/ target=_blank>SNAPSHOT artifacts</a></li><li><a href=https://central.sonatype.com/artifact/com.chensoul/chensoul-parent target=_blank>Sontype Release artifacts</a></li><li><a href=https://repo.maven.apache.org/maven2/com/chensoul/chensoul-parent/ target=_blank>Maven Release artifacts</a></li><li><a href=https://central.sonatype.com/artifact/com.chensoul/chensoul-parent target=_blank>Maven central release</a></li></ul><p>例如，如果当前项目为快照版本：1.0.35-SNAPSHOT，执行上面 deploy 命令之后，在 <a href=https://s01.oss.sonatype.org/content/repositories/snapshots/com/chensoul/chensoul-parent/1.0.35-SNAPSHOT/ target=_blank>SNAPSHOT artifacts</a> 可以看到上传的内容：</p><p><img src=/images/daily-review-20231213-03.webp alt=daily-review-20231213-03></p><p>如果当前项目为正式版本：1.0.35，执行上面 deploy 命令之后，可以看到输出日志：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Uploaded to ossrh: https://s01.oss.sonatype.org:443/service/local/staging/deployByRepositoryId/comchensoul-1107/com/chensoul/chensoul-parent/1.0.35/chensoul-parent-1.0.35.pom.asc <span style=color:#f92672>(</span><span style=color:#ae81ff>228</span> B at <span style=color:#ae81ff>425</span> B/s<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>  * Upload of locally staged artifacts finished.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span>  * Closing staging repository with ID <span style=color:#e6db74>&#34;comchensoul-1107&#34;</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Waiting <span style=color:#66d9ef>for</span> operation to complete...
</span></span><span style=display:flex><span>.................
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> Remote staged <span style=color:#ae81ff>1</span> repositories, finished with success.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> ------------------------------------------------------------------------
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> BUILD SUCCESS
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> ------------------------------------------------------------------------
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> Total time:  01:15 min
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> Finished at: 2023-12-20T09:21:20+08:00
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> ------------------------------------------------------------------------
</span></span></code></pre></div><p>登陆 <a href=https://s01.oss.sonatype.org/ target=_blank>https://s01.oss.sonatype.org/</a> 之后，在 <a href=https://s01.oss.sonatype.org/#stagingRepositories target=_blank>https://s01.oss.sonatype.org/#stagingRepositories</a> 可以查看到 comchensoul-1107 这个 staging 仓库。</p><p><img src=/images/daily-review-20231213-04.webp alt=daily-review-20231213-04></p><p>staging 意思是该仓库还不是正式仓库，在 <a href=https://repo.maven.apache.org/maven2/com/chensoul/chensoul-parent/ target=_blank>Maven Release artifacts</a> 还查询不到。如果想将该 staging 仓库发布到 Release 仓库，则需要点击上图中的 Release 按钮。然后等几分钟就可以中 Release 仓库看到：</p><p><img src=/images/daily-review-20231213-05.webp alt=daily-review-20231213-05></p><p><a href=https://repo.maven.apache.org/maven2/com/chensoul/chensoul-parent/ target=_blank>https://repo.maven.apache.org</a> 、<a href=https://mvnrepository.com/artifact/com.chensoul/chensoul-parent target=_blank>https://mvnrepository.com/</a> 同步有延时，还没有查询到。</p><p>如果想在 staging 仓库关闭之后自动 Release 到正式仓库，可以使用 nexus-staging-maven-plugin 插件。在 release profile 中添加：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- https://itnext.io/publishing-artifacts-to-maven-central-using-github-actions-a-step-by-step-guide-fd65ef075fd4 --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;plugin&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;groupId&gt;</span>org.sonatype.plugins<span style=color:#f92672>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;artifactId&gt;</span>nexus-staging-maven-plugin<span style=color:#f92672>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;version&gt;</span>1.7.0<span style=color:#f92672>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;extensions&gt;</span>true<span style=color:#f92672>&lt;/extensions&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;configuration&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;serverId&gt;</span>ossrh<span style=color:#f92672>&lt;/serverId&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;nexusUrl&gt;</span>https://s01.oss.sonatype.org/<span style=color:#f92672>&lt;/nexusUrl&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>&lt;autoReleaseAfterClose&gt;</span>true<span style=color:#f92672>&lt;/autoReleaseAfterClose&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/configuration&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/plugin&gt;</span>
</span></span></code></pre></div><p>然后在 deploy 命令后添加参数：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mvn --ntp -B -U clean source:jar javadoc:jar deploy -P release -DskipTests
</span></span></code></pre></div><h3 id=5-在-github-actions-配置-cicd>5. 在 GitHub Actions 配置 CICD</h3><p>配置一个 release.yml 文件，文件内容参考如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>Release Version</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>on</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>push</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>branches</span>: [ <span style=color:#e6db74>&#34;main&#34;</span> ]
</span></span><span style=display:flex><span>    <span style=color:#f92672>tags</span>: [ <span style=color:#e6db74>&#34;*&#34;</span> ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>if</span>: <span style=color:#e6db74>&#34;!contains(github.event.head_commit.message, &#39;[CI Skip]&#39;)&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>strategy</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>matrix</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>java</span>: [ <span style=color:#e6db74>&#39;8&#39;</span> ]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Checkout</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v4</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Set up Java ${{ matrix.Java }}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/setup-java@v4</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>with</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>distribution</span>: <span style=color:#e6db74>&#39;temurin&#39;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>java-version</span>: <span style=color:#ae81ff>${{ matrix.java }}</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>cache</span>: <span style=color:#ae81ff>maven</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>server-id</span>: <span style=color:#ae81ff>ossrh</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>server-username</span>: <span style=color:#ae81ff>OSSRH_USERNAME</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>server-password</span>: <span style=color:#ae81ff>OSSRH_TOKEN</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>gpg-passphrase</span>: <span style=color:#ae81ff>MAVEN_GPG_PASSPHRASE</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>gpg-private-key</span>: <span style=color:#ae81ff>${{ secrets.MAVEN_GPG_PRIVATE_KEY }}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Maven Release</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>mvn --ntp -B -U clean source:jar javadoc:jar deploy -P release -DskipTests</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>OSSRH_USERNAME</span>: <span style=color:#ae81ff>${{ secrets.OSSRH_USERNAME }}</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>OSSRH_TOKEN</span>: <span style=color:#ae81ff>${{ secrets.OSSRH_TOKEN }}</span>
</span></span><span style=display:flex><span>          <span style=color:#75715e># https://maven.apache.org/plugins/maven-gpg-plugin/usage.html#sign-artifacts-with-gnupg</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>MAVEN_GPG_PASSPHRASE</span>: <span style=color:#ae81ff>${{ secrets.MAVEN_GPG_PASSPHRASE }}</span>
</span></span></code></pre></div><p>需要自 GitHub Actions 的 Actions 页面配置以下 Secrets：</p><ul><li>OSSRH_USERNAME</li><li>OSSRH_TOKEN</li><li>MAVEN_GPG_PASSPHRASE</li><li>MAVEN_GPG_PRIVATE_KEY</li></ul><p>其 Maven 执行命令：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mvn -ntp -B -U clean deploy -P release
</span></span></code></pre></div><h3 id=6-在项目里面配置-sonatype-仓库>6. 在项目里面配置 sonatype 仓库</h3><p>在 pom.xml 中添加：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#f92672>&lt;repositories&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>&lt;!-- 如果使用浏览器访问时，需要添加 groupId 才显示内容 --&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;repository&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;id&gt;</span>oss-snapshots<span style=color:#f92672>&lt;/id&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;url&gt;</span>https://oss.sonatype.org/content/repositories/snapshots/<span style=color:#f92672>&lt;/url&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;releases&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;enabled&gt;</span>false<span style=color:#f92672>&lt;/enabled&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/releases&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;snapshots&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;enabled&gt;</span>true<span style=color:#f92672>&lt;/enabled&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/snapshots&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/repository&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;repository&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;id&gt;</span>oss-snapshots-s01<span style=color:#f92672>&lt;/id&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;url&gt;</span>https://s01.oss.sonatype.org/content/repositories/snapshots/<span style=color:#f92672>&lt;/url&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;releases&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;enabled&gt;</span>false<span style=color:#f92672>&lt;/enabled&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/releases&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;snapshots&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;enabled&gt;</span>true<span style=color:#f92672>&lt;/enabled&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/snapshots&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/repository&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/repositories&gt;</span>
</span></span></code></pre></div><p>&ndash; EOF</p></div><div><div style=font-weight:700>Share this post:</div><a class=social-link-item href="https://twitter.com/intent/tweet?text=2023-12-13%ef%bd%9c%e5%8f%91%e5%b8%83%e5%88%b0Maven%e4%b8%ad%e5%a4%ae%e4%bb%93%e5%ba%93%e7%9a%84%e7%ac%ac%e4%b8%80%e4%b8%aa%e9%a1%b9%e7%9b%ae https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f12%2f13%2ftil%2f" target=_blank rel="noopener noreferrer" title="Click to share on Twitter"><i class="fa-brands fa-square-twitter fa-2xl" style=color:#55acee></i>
</a><a class=social-link-item href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f12%2f13%2ftil%2f&title=2023-12-13%ef%bd%9c%e5%8f%91%e5%b8%83%e5%88%b0Maven%e4%b8%ad%e5%a4%ae%e4%bb%93%e5%ba%93%e7%9a%84%e7%ac%ac%e4%b8%80%e4%b8%aa%e9%a1%b9%e7%9b%ae" target=_blank rel="noopener noreferrer" title="Click to share on LinkedIn"><i class="fa-brands fa-linkedin fa-2xl" style=color:#007bb5></i>
</a><a class=social-link-item href="https://telegram.me/share/url?text=2023-12-13%ef%bd%9c%e5%8f%91%e5%b8%83%e5%88%b0Maven%e4%b8%ad%e5%a4%ae%e4%bb%93%e5%ba%93%e7%9a%84%e7%ac%ac%e4%b8%80%e4%b8%aa%e9%a1%b9%e7%9b%ae&amp;url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f12%2f13%2ftil%2f" target=_blank rel="noopener noreferrer" title="Click to share on telegram"><i class="fa-brands fa-telegram fa-2xl" style=color:#007bb5></i>
</a><a class=social-link-item href="https://reddit.com/submit?url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f12%2f13%2ftil%2f&title=2023-12-13%ef%bd%9c%e5%8f%91%e5%b8%83%e5%88%b0Maven%e4%b8%ad%e5%a4%ae%e4%bb%93%e5%ba%93%e7%9a%84%e7%ac%ac%e4%b8%80%e4%b8%aa%e9%a1%b9%e7%9b%ae" target=_blank rel="noopener noreferrer" title="Click to share on reddit"><i class="fa-brands fa-reddit fa-2xl" style=color:#007bb5></i>
</a><a class=social-link-item href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f12%2f13%2ftil%2f" target=_blank rel="noopener noreferrer" title="Click to share on facebook"><i class="fa-brands fa-facebook fa-2xl" style=color:#007bb5></i>
</a><a class=social-link-item href="https://api.whatsapp.com/send?text=2023-12-13%ef%bd%9c%e5%8f%91%e5%b8%83%e5%88%b0Maven%e4%b8%ad%e5%a4%ae%e4%bb%93%e5%ba%93%e7%9a%84%e7%ac%ac%e4%b8%80%e4%b8%aa%e9%a1%b9%e7%9b%ae%20-%20https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f12%2f13%2ftil%2f" target=_blank rel="noopener noreferrer" title="Click to share on whatsapp"><i class="fa-brands fa-whatsapp fa-2xl" style=color:#007bb5></i></a></div></div></article><nav class="navigation post-navigation" role=navigation><h2 class=screen-reader-text>Post navigation</h2><div class=nav-links><div class=nav-previous><a href=/posts/2023/12/14/all-things-about-microprofile/ rel=next><span class=post-title>All things about MicroProfile</span></a></div><div class=nav-next><a href=/posts/2023/12/12/til/ rel=prev><span class=post-title>2023-12-12｜RMI、Java漏洞安全、Semgrep漏洞检测</span></a></div></div></nav><h2>Related content</h2><ul><li><a href=/posts/2023/12/28/til/>2023-12-28｜今天做了什么</a></li><li><a href=/posts/2023/12/27/til/>2023-12-27｜今天做了什么</a></li><li><a href=/posts/2023/12/22/til/>2023-12-22｜今天做了什么</a></li><li><a href=/posts/2023/12/21/til/>2023-12-21｜Spring Security对OAuth2的支持及实现方式</a></li><li><a href=/posts/2023/12/20/til/>2023-12-20｜Maven配置继承和生命周期、源码运行Nacos 2.3.0控制台</a></li><li><a href=/posts/2023/12/19/til/>2023-12-19｜Spring Security OAuth2配置JWT、Github Actions配置代码扫描</a></li><li><a href=/posts/2023/12/18/til/>2023-12-18｜使用Spring Security实现OAuth2授权和认证</a></li><li><a href=/posts/2023/12/15/til/>2023-12-15｜JNDI InitialContext源码分析、ClassLoader加载机制</a></li><li><a href=/posts/2023/12/14/til/>2023-12-14｜购买新的VPS服务器、最近在做什么</a></li><li><a href=/posts/2023/12/12/til/>2023-12-12｜RMI、Java漏洞安全、Semgrep漏洞检测</a></li></ul></main></section></div><div id=footer class=footer-wrap><footer id=colophon class="site-footer container clearfix" role=contentinfo><div id=footer-text class=site-info><span class=credit-link>Made with 🩷
by <a href=/ target=_blank rel="noopener noreferrer">ChenSoul</a></span></div></footer></div></div><script type=text/javascript src=/main.min.js></script></body></html>