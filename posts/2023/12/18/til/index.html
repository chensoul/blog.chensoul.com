<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>2023-12-18｜使用Spring Security实现OAuth2授权和认证 | ChenSoul</title>
<meta name=keywords content="java,spring-security,oauth2"><meta name=description content="Today I Learned. 今天分享内容：使用Spring Security实现OAuth2授权和认证。
最近在开发 Spring Cloud 微服务时，需要对 OAuth2 的异常处理进行定制，从网上搜到一个 github 仓库：oauth2。这篇仓库的代码实现了 OAuth2 的四种授权模式、I18N 国际化、异常处理、JWT Token，我 fork 了一份代码，做了一些改动，去掉了 webflux、eureka 相关代码。
代码仓库地址：https://github.com/chensoul/spring-security-oauth2-legacy，相关依赖的版本：
spring-boot: 2.7.18 org.springframework.security.oauth:spring-security-oauth2-autoconfigure: 2.6.8 org.springframework.security.oauth:spring-security-oauth2: 2.5.2.RELEASE org.springframework.security:spring-security-jwt 1.1.1.RELEASE 特性 统一异常处理 参考spring security的 ExceptionTranslationFilter 类
异常处理类 AccessDeniedHandler AuthenticationEntryPoint jwt key生成 生成 JKS 文件 keytool -genkeypair -alias myalias -storetype PKCS12 -keyalg RSA -keypass mypass -keystore mykeystore.jks -storepass mypass -validity 3650 导出公钥 # 保存为 public.cer 文件： keytool -exportcert -alias myalias -storepass mypass -keystore mykeystore.jks -file public.cer # 保存为 public.key 文件 keytool -list -rfc --keystore mykeystore.jks -storepass mypass | openssl x509 -inform pem -pubkey > public.key 导出私钥，将其保存为 private.key 文件： keytool -importkeystore -srckeystore mykeystore."><meta name=author content="chensoul"><link rel=canonical href=https://blog.chensoul.cc/posts/2023/12/18/til/><meta name=google-site-verification content="nBXwg45SBRjTX78SA-mH0asrAbsdu9c1nk0ObSry7aQ"><link crossorigin=anonymous href=/assets/css/stylesheet.48da2331f774073f2b09ec285a9c0e15fd969021a9d2d0fb60b7cbb73cef5ecc.css integrity="sha256-SNojMfd0Bz8rCewoWpwOFf2WkCGp0tD7YLfLtzzvXsw=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.chensoul.cc/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.chensoul.cc/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.chensoul.cc/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.chensoul.cc/apple-touch-icon.png><link rel=mask-icon href=https://blog.chensoul.cc/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.chensoul.cc/posts/2023/12/18/til/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta name=baidu-site-verification content="codeva-FYpQY8JdLU"><meta property="og:title" content="2023-12-18｜使用Spring Security实现OAuth2授权和认证"><meta property="og:description" content="Today I Learned. 今天分享内容：使用Spring Security实现OAuth2授权和认证。
最近在开发 Spring Cloud 微服务时，需要对 OAuth2 的异常处理进行定制，从网上搜到一个 github 仓库：oauth2。这篇仓库的代码实现了 OAuth2 的四种授权模式、I18N 国际化、异常处理、JWT Token，我 fork 了一份代码，做了一些改动，去掉了 webflux、eureka 相关代码。
代码仓库地址：https://github.com/chensoul/spring-security-oauth2-legacy，相关依赖的版本：
spring-boot: 2.7.18 org.springframework.security.oauth:spring-security-oauth2-autoconfigure: 2.6.8 org.springframework.security.oauth:spring-security-oauth2: 2.5.2.RELEASE org.springframework.security:spring-security-jwt 1.1.1.RELEASE 特性 统一异常处理 参考spring security的 ExceptionTranslationFilter 类
异常处理类 AccessDeniedHandler AuthenticationEntryPoint jwt key生成 生成 JKS 文件 keytool -genkeypair -alias myalias -storetype PKCS12 -keyalg RSA -keypass mypass -keystore mykeystore.jks -storepass mypass -validity 3650 导出公钥 # 保存为 public.cer 文件： keytool -exportcert -alias myalias -storepass mypass -keystore mykeystore.jks -file public.cer # 保存为 public.key 文件 keytool -list -rfc --keystore mykeystore.jks -storepass mypass | openssl x509 -inform pem -pubkey > public.key 导出私钥，将其保存为 private.key 文件： keytool -importkeystore -srckeystore mykeystore."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.chensoul.cc/posts/2023/12/18/til/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-12-18T18:50:00+08:00"><meta property="article:modified_time" content="2023-12-18T18:50:00+08:00"><meta property="og:site_name" content="ChenSoul"><meta name=twitter:card content="summary"><meta name=twitter:title content="2023-12-18｜使用Spring Security实现OAuth2授权和认证"><meta name=twitter:description content="Today I Learned. 今天分享内容：使用Spring Security实现OAuth2授权和认证。
最近在开发 Spring Cloud 微服务时，需要对 OAuth2 的异常处理进行定制，从网上搜到一个 github 仓库：oauth2。这篇仓库的代码实现了 OAuth2 的四种授权模式、I18N 国际化、异常处理、JWT Token，我 fork 了一份代码，做了一些改动，去掉了 webflux、eureka 相关代码。
代码仓库地址：https://github.com/chensoul/spring-security-oauth2-legacy，相关依赖的版本：
spring-boot: 2.7.18 org.springframework.security.oauth:spring-security-oauth2-autoconfigure: 2.6.8 org.springframework.security.oauth:spring-security-oauth2: 2.5.2.RELEASE org.springframework.security:spring-security-jwt 1.1.1.RELEASE 特性 统一异常处理 参考spring security的 ExceptionTranslationFilter 类
异常处理类 AccessDeniedHandler AuthenticationEntryPoint jwt key生成 生成 JKS 文件 keytool -genkeypair -alias myalias -storetype PKCS12 -keyalg RSA -keypass mypass -keystore mykeystore.jks -storepass mypass -validity 3650 导出公钥 # 保存为 public.cer 文件： keytool -exportcert -alias myalias -storepass mypass -keystore mykeystore.jks -file public.cer # 保存为 public.key 文件 keytool -list -rfc --keystore mykeystore.jks -storepass mypass | openssl x509 -inform pem -pubkey > public.key 导出私钥，将其保存为 private.key 文件： keytool -importkeystore -srckeystore mykeystore."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.chensoul.cc/posts/"},{"@type":"ListItem","position":2,"name":"2023-12-18｜使用Spring Security实现OAuth2授权和认证","item":"https://blog.chensoul.cc/posts/2023/12/18/til/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"2023-12-18｜使用Spring Security实现OAuth2授权和认证","name":"2023-12-18｜使用Spring Security实现OAuth2授权和认证","description":"Today I Learned. 今天分享内容：使用Spring Security实现OAuth2授权和认证。\n最近在开发 Spring Cloud 微服务时，需要对 OAuth2 的异常处理进行定制，从网上搜到一个 github 仓库：oauth2。这篇仓库的代码实现了 OAuth2 的四种授权模式、I18N 国际化、异常处理、JWT Token，我 fork 了一份代码，做了一些改动，去掉了 webflux、eureka 相关代码。\n代码仓库地址：https://github.com/chensoul/spring-security-oauth2-legacy，相关依赖的版本：\nspring-boot: 2.7.18 org.springframework.security.oauth:spring-security-oauth2-autoconfigure: 2.6.8 org.springframework.security.oauth:spring-security-oauth2: 2.5.2.RELEASE org.springframework.security:spring-security-jwt 1.1.1.RELEASE 特性 统一异常处理 参考spring security的 ExceptionTranslationFilter 类\n异常处理类 AccessDeniedHandler AuthenticationEntryPoint jwt key生成 生成 JKS 文件 keytool -genkeypair -alias myalias -storetype PKCS12 -keyalg RSA -keypass mypass -keystore mykeystore.jks -storepass mypass -validity 3650 导出公钥 # 保存为 public.cer 文件： keytool -exportcert -alias myalias -storepass mypass -keystore mykeystore.jks -file public.cer # 保存为 public.key 文件 keytool -list -rfc --keystore mykeystore.jks -storepass mypass | openssl x509 -inform pem -pubkey \u0026gt; public.key 导出私钥，将其保存为 private.key 文件： keytool -importkeystore -srckeystore mykeystore.","keywords":["java","spring-security","oauth2"],"articleBody":"Today I Learned. 今天分享内容：使用Spring Security实现OAuth2授权和认证。\n最近在开发 Spring Cloud 微服务时，需要对 OAuth2 的异常处理进行定制，从网上搜到一个 github 仓库：oauth2。这篇仓库的代码实现了 OAuth2 的四种授权模式、I18N 国际化、异常处理、JWT Token，我 fork 了一份代码，做了一些改动，去掉了 webflux、eureka 相关代码。\n代码仓库地址：https://github.com/chensoul/spring-security-oauth2-legacy，相关依赖的版本：\nspring-boot: 2.7.18 org.springframework.security.oauth:spring-security-oauth2-autoconfigure: 2.6.8 org.springframework.security.oauth:spring-security-oauth2: 2.5.2.RELEASE org.springframework.security:spring-security-jwt 1.1.1.RELEASE 特性 统一异常处理 参考spring security的 ExceptionTranslationFilter 类\n异常处理类 AccessDeniedHandler AuthenticationEntryPoint jwt key生成 生成 JKS 文件 keytool -genkeypair -alias myalias -storetype PKCS12 -keyalg RSA -keypass mypass -keystore mykeystore.jks -storepass mypass -validity 3650 导出公钥 # 保存为 public.cer 文件： keytool -exportcert -alias myalias -storepass mypass -keystore mykeystore.jks -file public.cer # 保存为 public.key 文件 keytool -list -rfc --keystore mykeystore.jks -storepass mypass | openssl x509 -inform pem -pubkey \u003e public.key 导出私钥，将其保存为 private.key 文件： keytool -importkeystore -srckeystore mykeystore.jks -srcstorepass mypass -destkeystore private.p12 -deststoretype PKCS12 -deststorepass mypass -destkeypass mypass openssl pkcs12 -in private.p12 -nodes -nocerts -out private.key I18N国际化 参考 LocaleConfiguration 类 支持 @Inner 注解实现内部接口不用认证 参考以下类：\nInner InnerAspect FeignOAuth2RequestInterceptor ResourceServerConfig PermitUrlProperties OAuth 2.0授权模式 密码模式（resource owner password credentials） 授权码模式（authorization code） 简化模式（implicit） 客户端模式（client credentials） 密码模式（resource owner password credentials） 这种模式是最不推荐的，因为client可能存了用户密码 这种模式主要用来做遗留项目升级为oauth2的适配方案 当然如果client是自家的应用，也是可以 支持refresh token 授权码模式（authorization code） 这种模式算是正宗的oauth2的授权模式 设计了auth code，通过这个code再获取token 支持refresh token 简化模式（implicit） 这种模式比授权码模式少了code环节，回调url直接携带token 这种模式的使用场景是基于浏览器的应用 这种模式基于安全性考虑，建议把token时效设置短一些 不支持refresh token 客户端模式（client credentials） 这种模式直接根据client的id和密钥即可获取token，无需用户参与 这种模式比较合适消费api的后端服务，比如拉取一组用户信息等 不支持refresh token，主要是没有必要 关于refresh token refresh token的初衷主要是为了用户体验不想用户重复输入账号密码来换取新token，因而设计了refresh token用于换取新token 这种模式由于没有用户参与，而且也不需要用户账号密码，仅仅根据自己的id和密钥就可以换取新token，因而没必要refresh token 授权接口及相关参数 授权模式 请求路径 请求方法 请求头 请求参数 用户名密码(password) /oauth/token post Content-Type:application/x-www-form-urlencoded grant_type:passwordusername:userpassword:123456scope:serverclient_id:clientclient_secret:secret 客户端凭证(client_credentials) /oauth/token post Content-Type:application/x-www-form-urlencoded grant_type:client_credentialsscope:userinfo resourceclient_id:clientclient_secret:secret 客户端授权码(authorization_code) /oauth/authorize get Content-Type:application/x-www-form-urlencoded response_type=code\u0026scope=server\u0026client_id=client\u0026redirect_uri=https://www.taobao.com 客户端授权码(authorization_code) /oauth/authorize get Content-Type:application/x-www-form-urlencoded response_type:authorization_codecode:gE3Ekaredirect_uri:https://www.jd.comscope:server 简化模式(implicit) /oauth/authorize get Content-Type:application/x-www-form-urlencoded response_type:tokenclient_id:clientredirect_uri:https://www.jd.comscope:server state:123456 小结 密码模式（resource owner password credentials）(为遗留系统设计)(支持refresh token) 授权码模式（authorization code）(正宗方式)(支持refresh token) 简化模式（implicit）(为web浏览器应用设计)(不支持refresh token) 客户端模式（client credentials）(为后台api服务消费者设计)(不支持refresh token) 参考资料 spring-security-oauth-samples 官方schema.sql ","wordCount":"228","inLanguage":"en","datePublished":"2023-12-18T18:50:00+08:00","dateModified":"2023-12-18T18:50:00+08:00","author":{"@type":"Person","name":"chensoul"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.chensoul.cc/posts/2023/12/18/til/"},"publisher":{"@type":"Organization","name":"ChenSoul","logo":{"@type":"ImageObject","url":"https://blog.chensoul.cc/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.chensoul.cc/ accesskey=h title="ChenSoul (Alt + H)">ChenSoul</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.chensoul.cc/categories title=分类><span>分类</span></a></li><li><a href=https://blog.chensoul.cc/tags title=标签><span>标签</span></a></li><li><a href=https://blog.chensoul.cc/search title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li><li><a href=https://blog.chensoul.cc/index.xml title=订阅><span>订阅</span></a></li><li><a href=https://github.com/chensoul title=关于><span>关于</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">2023-12-18｜使用Spring Security实现OAuth2授权和认证</h1><div class=post-meta><span title='2023-12-18 18:50:00 +0800 +0800'>2023-12-18</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;228 words&nbsp;·&nbsp;chensoul</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e7%89%b9%e6%80%a7 aria-label=特性>特性</a></li><li><a href=#%e7%bb%9f%e4%b8%80%e5%bc%82%e5%b8%b8%e5%a4%84%e7%90%86 aria-label=统一异常处理>统一异常处理</a></li><li><a href=#%e5%bc%82%e5%b8%b8%e5%a4%84%e7%90%86%e7%b1%bb aria-label=异常处理类>异常处理类</a></li><li><a href=#jwt-key%e7%94%9f%e6%88%90 aria-label="jwt key生成">jwt key生成</a></li><li><a href=#i18n%e5%9b%bd%e9%99%85%e5%8c%96 aria-label=I18N国际化>I18N国际化</a></li><li><a href=#%e6%94%af%e6%8c%81-inner-%e6%b3%a8%e8%a7%a3%e5%ae%9e%e7%8e%b0%e5%86%85%e9%83%a8%e6%8e%a5%e5%8f%a3%e4%b8%8d%e7%94%a8%e8%ae%a4%e8%af%81 aria-label="支持 @Inner 注解实现内部接口不用认证">支持 @Inner 注解实现内部接口不用认证</a></li><li><a href=#oauth-20%e6%8e%88%e6%9d%83%e6%a8%a1%e5%bc%8f aria-label="OAuth 2.0授权模式">OAuth 2.0授权模式</a><ul><li><a href=#%e5%af%86%e7%a0%81%e6%a8%a1%e5%bc%8fresource-owner-password-credentials aria-label="密码模式（resource owner password credentials）">密码模式（resource owner password credentials）</a></li><li><a href=#%e6%8e%88%e6%9d%83%e7%a0%81%e6%a8%a1%e5%bc%8fauthorization-code aria-label="授权码模式（authorization code）">授权码模式（authorization code）</a></li><li><a href=#%e7%ae%80%e5%8c%96%e6%a8%a1%e5%bc%8fimplicit aria-label=简化模式（implicit）>简化模式（implicit）</a></li><li><a href=#%e5%ae%a2%e6%88%b7%e7%ab%af%e6%a8%a1%e5%bc%8fclient-credentials aria-label="客户端模式（client credentials）">客户端模式（client credentials）</a></li><li><a href=#%e5%85%b3%e4%ba%8erefresh-token aria-label="关于refresh token">关于refresh token</a></li><li><a href=#%e6%8e%88%e6%9d%83%e6%8e%a5%e5%8f%a3%e5%8f%8a%e7%9b%b8%e5%85%b3%e5%8f%82%e6%95%b0 aria-label=授权接口及相关参数>授权接口及相关参数</a></li><li><a href=#%e5%b0%8f%e7%bb%93 aria-label=小结>小结</a></li></ul></li><li><a href=#%e5%8f%82%e8%80%83%e8%b5%84%e6%96%99 aria-label=参考资料>参考资料</a></li></ul></div></details></div><div class=post-content><p>Today I Learned. 今天分享内容：使用Spring Security实现OAuth2授权和认证。</p><p>最近在开发 Spring Cloud 微服务时，需要对 OAuth2 的异常处理进行定制，从网上搜到一个 github 仓库：<a href=https://github.com/selfancy/oauth2>oauth2</a>。这篇仓库的代码实现了 OAuth2 的四种授权模式、I18N 国际化、异常处理、JWT Token，我 fork 了一份代码，做了一些改动，去掉了 webflux、eureka 相关代码。</p><p>代码仓库地址：https://github.com/chensoul/spring-security-oauth2-legacy，相关依赖的版本：</p><ul><li>spring-boot: 2.7.18</li><li>org.springframework.security.oauth:spring-security-oauth2-autoconfigure: 2.6.8</li><li>org.springframework.security.oauth:spring-security-oauth2: 2.5.2.RELEASE</li><li>org.springframework.security:spring-security-jwt 1.1.1.RELEASE</li></ul><h2 id=特性>特性<a hidden class=anchor aria-hidden=true href=#特性>#</a></h2><h2 id=统一异常处理>统一异常处理<a hidden class=anchor aria-hidden=true href=#统一异常处理>#</a></h2><blockquote><p>参考spring security的 <strong>ExceptionTranslationFilter</strong> 类</p></blockquote><h2 id=异常处理类>异常处理类<a hidden class=anchor aria-hidden=true href=#异常处理类>#</a></h2><ul><li>AccessDeniedHandler</li><li>AuthenticationEntryPoint</li></ul><h2 id=jwt-key生成>jwt key生成<a hidden class=anchor aria-hidden=true href=#jwt-key生成>#</a></h2><ul><li>生成 JKS 文件</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>keytool -genkeypair -alias myalias -storetype PKCS12 -keyalg RSA -keypass mypass -keystore mykeystore.jks -storepass mypass -validity <span class=m>3650</span>
</span></span></code></pre></div><ul><li>导出公钥</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 保存为 public.cer 文件：</span>
</span></span><span class=line><span class=cl>keytool -exportcert -alias myalias -storepass mypass -keystore mykeystore.jks -file public.cer
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 保存为 public.key 文件</span>
</span></span><span class=line><span class=cl>keytool -list -rfc --keystore mykeystore.jks -storepass mypass <span class=p>|</span> openssl x509 -inform pem -pubkey &gt; public.key
</span></span></code></pre></div><ul><li>导出私钥，将其保存为 private.key 文件：</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>keytool -importkeystore -srckeystore mykeystore.jks -srcstorepass mypass -destkeystore private.p12 -deststoretype PKCS12 -deststorepass mypass -destkeypass mypass
</span></span><span class=line><span class=cl>openssl pkcs12 -in private.p12 -nodes -nocerts -out private.key
</span></span></code></pre></div><h2 id=i18n国际化>I18N国际化<a hidden class=anchor aria-hidden=true href=#i18n国际化>#</a></h2><ul><li>参考 <strong>LocaleConfiguration</strong> 类</li></ul><h2 id=支持-inner-注解实现内部接口不用认证>支持 @Inner 注解实现内部接口不用认证<a hidden class=anchor aria-hidden=true href=#支持-inner-注解实现内部接口不用认证>#</a></h2><p>参考以下类：</p><ul><li>Inner</li><li>InnerAspect</li><li>FeignOAuth2RequestInterceptor</li><li>ResourceServerConfig</li><li>PermitUrlProperties</li></ul><h2 id=oauth-20授权模式>OAuth 2.0授权模式<a hidden class=anchor aria-hidden=true href=#oauth-20授权模式>#</a></h2><ul><li>密码模式（resource owner password credentials）</li><li>授权码模式（authorization code）</li><li>简化模式（implicit）</li><li>客户端模式（client credentials）</li></ul><blockquote><h3 id=密码模式resource-owner-password-credentials>密码模式（resource owner password credentials）<a hidden class=anchor aria-hidden=true href=#密码模式resource-owner-password-credentials>#</a></h3><ul><li>这种模式是最不推荐的，因为client可能存了用户密码</li><li>这种模式主要用来做遗留项目升级为oauth2的适配方案</li><li>当然如果client是自家的应用，也是可以</li><li>支持refresh token</li></ul></blockquote><blockquote><h3 id=授权码模式authorization-code>授权码模式（authorization code）<a hidden class=anchor aria-hidden=true href=#授权码模式authorization-code>#</a></h3><ul><li>这种模式算是正宗的oauth2的授权模式</li><li>设计了auth code，通过这个code再获取token</li><li>支持refresh token</li></ul></blockquote><blockquote><h3 id=简化模式implicit>简化模式（implicit）<a hidden class=anchor aria-hidden=true href=#简化模式implicit>#</a></h3><ul><li>这种模式比授权码模式少了code环节，回调url直接携带token</li><li>这种模式的使用场景是基于浏览器的应用</li><li>这种模式基于安全性考虑，建议把token时效设置短一些</li><li>不支持refresh token</li></ul></blockquote><blockquote><h3 id=客户端模式client-credentials>客户端模式（client credentials）<a hidden class=anchor aria-hidden=true href=#客户端模式client-credentials>#</a></h3><ul><li>这种模式直接根据client的id和密钥即可获取token，无需用户参与</li><li>这种模式比较合适消费api的后端服务，比如拉取一组用户信息等</li><li>不支持refresh token，主要是没有必要</li></ul></blockquote><blockquote><h3 id=关于refresh-token>关于refresh token<a hidden class=anchor aria-hidden=true href=#关于refresh-token>#</a></h3><ul><li>refresh token的初衷主要是为了用户体验不想用户重复输入账号密码来换取新token，因而设计了refresh token用于换取新token</li><li>这种模式由于没有用户参与，而且也不需要用户账号密码，仅仅根据自己的id和密钥就可以换取新token，因而没必要refresh token</li></ul></blockquote><h3 id=授权接口及相关参数>授权接口及相关参数<a hidden class=anchor aria-hidden=true href=#授权接口及相关参数>#</a></h3><table><thead><tr><th>授权模式</th><th>请求路径</th><th>请求方法</th><th>请求头</th><th>请求参数</th></tr></thead><tbody><tr><td>用户名密码(password)</td><td>/oauth/token</td><td>post</td><td>Content-Type:application/x-www-form-urlencoded</td><td>grant_type:password<br>username:user<br>password:123456<br>scope:server<br>client_id:client<br>client_secret:secret</td></tr><tr><td>客户端凭证(client_credentials)</td><td>/oauth/token</td><td>post</td><td>Content-Type:application/x-www-form-urlencoded</td><td>grant_type:client_credentials<br>scope:userinfo resource<br>client_id:client<br>client_secret:secret</td></tr><tr><td>客户端授权码(authorization_code)</td><td>/oauth/authorize</td><td>get</td><td>Content-Type:application/x-www-form-urlencoded</td><td>response_type=code&amp;scope=server&amp;client_id=client&amp;redirect_uri=https://www.taobao.com</td></tr><tr><td>客户端授权码(authorization_code)</td><td>/oauth/authorize</td><td>get</td><td>Content-Type:application/x-www-form-urlencoded</td><td>response_type:authorization_code<br>code:gE3Eka<br>redirect_uri:https://www.jd.com<br>scope:server</td></tr><tr><td>简化模式(implicit)</td><td>/oauth/authorize</td><td>get</td><td>Content-Type:application/x-www-form-urlencoded</td><td>response_type:token<br>client_id:client<br>redirect_uri:https://www.jd.com<br>scope:server<br>state:123456</td></tr></tbody></table><h3 id=小结>小结<a hidden class=anchor aria-hidden=true href=#小结>#</a></h3><ul><li>密码模式（resource owner password credentials）(为遗留系统设计)(支持refresh token)</li><li>授权码模式（authorization code）(正宗方式)(支持refresh token)</li><li>简化模式（implicit）(为web浏览器应用设计)(不支持refresh token)</li><li>客户端模式（client credentials）(为后台api服务消费者设计)(不支持refresh token)</li></ul><h2 id=参考资料>参考资料<a hidden class=anchor aria-hidden=true href=#参考资料>#</a></h2><ul><li><a href=https://github.com/spring-projects/spring-security-oauth/tree/master/samples>spring-security-oauth-samples</a></li><li><a href=https://github.com/spring-projects/spring-security-oauth/blob/master/spring-security-oauth2/src/test/resources/schema.sql>官方schema.sql</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.chensoul.cc/tags/java/>Java</a></li><li><a href=https://blog.chensoul.cc/tags/spring-security/>Spring-Security</a></li><li><a href=https://blog.chensoul.cc/tags/oauth2/>Oauth2</a></li></ul><nav class=paginav><a class=prev href=https://blog.chensoul.cc/posts/2023/12/19/til/><span class=title>« Prev</span><br><span>2023-12-19｜Spring Security OAuth2配置JWT、Github Actions配置代码扫描</span>
</a><a class=next href=https://blog.chensoul.cc/posts/2023/12/15/til/><span class=title>Next »</span><br><span>2023-12-15｜JNDI InitialContext源码分析、ClassLoader加载机制</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share 2023-12-18｜使用Spring Security实现OAuth2授权和认证 on x" href="https://x.com/intent/tweet/?text=2023-12-18%ef%bd%9c%e4%bd%bf%e7%94%a8Spring%20Security%e5%ae%9e%e7%8e%b0OAuth2%e6%8e%88%e6%9d%83%e5%92%8c%e8%ae%a4%e8%af%81&amp;url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f12%2f18%2ftil%2f&amp;hashtags=java%2cspring-security%2coauth2"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 2023-12-18｜使用Spring Security实现OAuth2授权和认证 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f12%2f18%2ftil%2f&amp;title=2023-12-18%ef%bd%9c%e4%bd%bf%e7%94%a8Spring%20Security%e5%ae%9e%e7%8e%b0OAuth2%e6%8e%88%e6%9d%83%e5%92%8c%e8%ae%a4%e8%af%81&amp;summary=2023-12-18%ef%bd%9c%e4%bd%bf%e7%94%a8Spring%20Security%e5%ae%9e%e7%8e%b0OAuth2%e6%8e%88%e6%9d%83%e5%92%8c%e8%ae%a4%e8%af%81&amp;source=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f12%2f18%2ftil%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 2023-12-18｜使用Spring Security实现OAuth2授权和认证 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f12%2f18%2ftil%2f&title=2023-12-18%ef%bd%9c%e4%bd%bf%e7%94%a8Spring%20Security%e5%ae%9e%e7%8e%b0OAuth2%e6%8e%88%e6%9d%83%e5%92%8c%e8%ae%a4%e8%af%81"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 2023-12-18｜使用Spring Security实现OAuth2授权和认证 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f12%2f18%2ftil%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 2023-12-18｜使用Spring Security实现OAuth2授权和认证 on whatsapp" href="https://api.whatsapp.com/send?text=2023-12-18%ef%bd%9c%e4%bd%bf%e7%94%a8Spring%20Security%e5%ae%9e%e7%8e%b0OAuth2%e6%8e%88%e6%9d%83%e5%92%8c%e8%ae%a4%e8%af%81%20-%20https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f12%2f18%2ftil%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 2023-12-18｜使用Spring Security实现OAuth2授权和认证 on telegram" href="https://telegram.me/share/url?text=2023-12-18%ef%bd%9c%e4%bd%bf%e7%94%a8Spring%20Security%e5%ae%9e%e7%8e%b0OAuth2%e6%8e%88%e6%9d%83%e5%92%8c%e8%ae%a4%e8%af%81&amp;url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f12%2f18%2ftil%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 2023-12-18｜使用Spring Security实现OAuth2授权和认证 on ycombinator" href="https://news.ycombinator.com/submitlink?t=2023-12-18%ef%bd%9c%e4%bd%bf%e7%94%a8Spring%20Security%e5%ae%9e%e7%8e%b0OAuth2%e6%8e%88%e6%9d%83%e5%92%8c%e8%ae%a4%e8%af%81&u=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2023%2f12%2f18%2ftil%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://blog.chensoul.cc/>ChenSoul</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script async src=https://umami.chensoul.cc/random-string.js data-website-id=821c25f8-a31a-4607-92d7-91ee76843d00></script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>