<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>2024-01-31｜Redis事务 | ChenSoul</title>
<meta name=keywords content="redis"><meta name=description content="今天做了什么： 下载 《Microservices with Spring Boot 3 and Spring Cloud》，源码在 github Redis 事务 Redis事务 原理 Redis 是一个内存数据库，它支持事务操作。Redis 事务是一系列的命令操作，这些命令会被一起执行，要么"><meta name=author content="chensoul"><link rel=canonical href=https://blog.chensoul.cc/posts/2024/01/31/til/><meta name=google-site-verification content="nBXwg45SBRjTX78SA-mH0asrAbsdu9c1nk0ObSry7aQ"><link crossorigin=anonymous href=/assets/css/stylesheet.899d9a536396b9b03c9eae0c99cc6ec954a90da94036f5390d131eb8071bb417.css integrity="sha256-iZ2aU2OWubA8nq4MmcxuyVSpDalANvU5DRMeuAcbtBc=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.chensoul.cc/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.chensoul.cc/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.chensoul.cc/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.chensoul.cc/apple-touch-icon.png><link rel=mask-icon href=https://blog.chensoul.cc/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.chensoul.cc/posts/2024/01/31/til/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta name=baidu-site-verification content="codeva-FYpQY8JdLU"><meta property="og:title" content="2024-01-31｜Redis事务"><meta property="og:description" content="今天做了什么： 下载 《Microservices with Spring Boot 3 and Spring Cloud》，源码在 github Redis 事务 Redis事务 原理 Redis 是一个内存数据库，它支持事务操作。Redis 事务是一系列的命令操作，这些命令会被一起执行，要么"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.chensoul.cc/posts/2024/01/31/til/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-01-31T00:00:00+08:00"><meta property="article:modified_time" content="2024-01-31T00:00:00+08:00"><meta property="og:site_name" content="ChenSoul"><meta name=twitter:card content="summary"><meta name=twitter:title content="2024-01-31｜Redis事务"><meta name=twitter:description content="今天做了什么： 下载 《Microservices with Spring Boot 3 and Spring Cloud》，源码在 github Redis 事务 Redis事务 原理 Redis 是一个内存数据库，它支持事务操作。Redis 事务是一系列的命令操作，这些命令会被一起执行，要么"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.chensoul.cc/posts/"},{"@type":"ListItem","position":2,"name":"2024-01-31｜Redis事务","item":"https://blog.chensoul.cc/posts/2024/01/31/til/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"2024-01-31｜Redis事务","name":"2024-01-31｜Redis事务","description":"今天做了什么： 下载 《Microservices with Spring Boot 3 and Spring Cloud》，源码在 github Redis 事务 Redis事务 原理 Redis 是一个内存数据库，它支持事务操作。Redis 事务是一系列的命令操作，这些命令会被一起执行，要么","keywords":["redis"],"articleBody":"今天做了什么：\n下载 《Microservices with Spring Boot 3 and Spring Cloud》，源码在 github\nRedis 事务\nRedis事务 原理 Redis 是一个内存数据库，它支持事务操作。Redis 事务是一系列的命令操作，这些命令会被一起执行，要么全部成功，要么全部失败。在事务执行期间，其他客户端提交的命令不会被插入到事务中，确保事务的原子性。\nRedis 事务使用以下命令进行管理：\nMULTI：标记事务的开始。 EXEC：执行事务中的所有命令。 DISCARD：取消事务，放弃之前的所有命令。 WATCH：监视一个或多个键，如果在事务执行之前有其他客户端对这些键进行了修改，则事务会被中止。 UNWATCH：取消对所有键的监视。 在执行事务之前，先使用 MULTI 命令标记事务的开始，然后按顺序执行多个命令。在所有命令都被添加到事务队列之后，使用 EXEC 命令来执行事务中的所有命令。如果执行成功，事务中的所有命令会被一起执行，然后返回结果。如果在执行事务期间发生错误，事务会被中止，所有的修改都会被回滚。\n示例 以下是一个使用 Redis 事务的示例：\n1 2 3 4 5 6 7 8 9 10 11 12 13 #开启事务 MULTI SET key1 \"value1\" SET key2 \"value2\" GET key1 GET key2 #执行事务 EXEC # 取消事务 discard 上述事务包含了两个 SET 命令和两个 GET 命令。在 EXEC 命令执行之后，将会依次执行这些命令，并返回相应的结果。\n需要注意的是，Redis 的事务是乐观锁，并不会在执行期间对键进行加锁。因此，在使用事务时要注意并发操作可能引发的竞态条件。\nRedis对于命令执行错误处理，有两种解决方式：\n语法错误（编译） 执行错误（运行） 语法错误：执行命令的语法不正确。\n1 2 3 4 5 6 7 8 9 10 11 12 13 #开启事务 multi #命令 set name zhangsan set age seterror sex male #执行事务 exec #获取正确指令数据 get name 此时整个事务队列中，存在一条正确指令，两条语法错误指令， 当执行exec后，会直接返回错误，正确的命令也不会执行。\n执行错误：命令在运行过程中出现错误。\n1 2 3 4 5 6 7 8 9 10 11 12 13 #开启事务 multi #命令 set lesson java rpush lesson eureka feign nacos set lesson redis #执行事务 exec #获取数据 get lesson 通过上面事务执行可以看到，语法本身是没有问题的，所以运行之前redis无法发现错误，但是在执行时出现了错误，因此只会错误的命令不执行， 而正确的命令仍然能够正常执行。\nSpringBoot实现事务操作 1）修改RedisConfig配置类，开启事务控制\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 @Configuration public class RedisConfig { @Autowired private RedisConnectionFactory redisConnectionFactory; @Bean public RedisTemplate\u003cString, Object\u003e redisTemplate() { RedisTemplate\u003cString, Object\u003e template = new RedisTemplate\u003c\u003e(); template.setConnectionFactory(redisConnectionFactory); // 设置序列化器等其他配置... template.setKeySerializer(new StringRedisSerializer()); template.setValueSerializer(new GenericJackson2JsonRedisSerializer()); //开启redis事务控制 template.setEnableTransactionSupport(true); return template; } } 2）自定义方法，测试事务效果\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 @Test public void multiTest(){ //开启事务 redisTemplate.multi(); try{ redisTemplate.opsForValue().set(\"lesson\",\"java\"); redisTemplate.opsForSet().add(\"lesson\",\"eureka\",\"feign\",\"gateway\"); redisTemplate.opsForValue().set(\"lesson\",\"redis\"); System.out.println(redisTemplate.opsForValue().get(\"lesson\")); }catch (Exception e){ //回滚 System.out.println(\"出现异常\"); redisTemplate.discard(); }finally { redisTemplate.exec(); } } FAQ Redis 事务的原子性是如何保证的？ Redis 事务的原子性是通过 Redis 的单线程执行和乐观锁来保证的。\n在 Redis 中，事务的执行是通过将多个命令按顺序放入事务队列中，然后由 Redis 依次执行这些命令。在事务执行期间，Redis 会确保其他客户端提交的命令不会被插入到当前事务中，从而保证事务的原子性。\n当执行 EXEC 命令时，Redis 会按照顺序执行事务队列中的所有命令，并返回每个命令的执行结果。如果在执行期间出现错误，例如其中一个命令返回了错误，Redis 会终止事务的执行，并返回相应的错误信息。\n此外，Redis 使用乐观锁来保证事务的原子性。在事务执行期间，Redis 不会对事务中的键进行加锁。相反，Redis 会在执行事务之前使用 WATCH 命令监视一个或多个键。如果在事务执行期间有其他客户端对这些被监视的键进行了修改，Redis 会中止事务的执行，并返回一个错误。通过使用乐观锁，Redis 确保了事务在执行期间不会被其他客户端的修改所干扰。\n需要注意的是，Redis 的事务并不是隔离的，即事务执行期间其他客户端提交的命令仍然可以修改事务中的键。因此，在使用 Redis 事务时，需要注意并发操作可能引发的竞态条件。如果需要更严格的隔离性，可以使用 Redis 的 WATCH 和 MULTI 命令结合 Lua 脚本来实现更复杂的事务逻辑。\nRedis 事务的乐观锁是如何工作的？ Redis 的事务乐观锁机制是通过 WATCH 命令和检测事务执行期间键的变化来实现的。\n当调用 WATCH 命令时，Redis 会监视一个或多个键。在事务执行期间，如果任何被监视的键发生了变化（被其他客户端修改），Redis 将中止事务的执行。\n以下是乐观锁在 Redis 事务中的工作原理：\n客户端调用 WATCH 命令，指定要监视的键。 Redis 开始监视这些键，并记录它们的当前值。 客户端开始执行事务中的命令。 在执行 EXEC 命令之前，Redis 检查被监视的键是否发生了变化。 如果任何被监视的键发生了变化，Redis 中止事务的执行，并返回一个错误。 如果被监视的键没有发生变化，则 Redis 执行事务中的命令，并返回结果。 乐观锁的关键在于在执行 EXEC 命令之前检查键的变化。如果在事务执行期间，有其他客户端修改了被监视的键，那么 Redis 会中止事务的执行，因为它无法保证事务的原子性。\n需要注意的是，乐观锁并不会对被监视的键进行加锁。它只是在事务执行之前检查键的变化情况。这意味着其他客户端仍然可以修改被监视的键，但是当事务执行时，如果键发生了变化，事务将被中止。\n乐观锁在 Redis 事务中的应用场景是保证在执行事务期间被监视的键没有被其他客户端修改。如果需要更严格的隔离性，可以结合使用 WATCH 和 MULTI 命令以及 Lua 脚本来实现更复杂的事务逻辑。\nRedis 事务是否支持嵌套？ 在 Redis 中，事务是不支持嵌套的。也就是说，你不能在一个事务中开启另一个事务。\n当你调用 MULTI 命令开始一个事务后，后续的命令都会被添加到当前事务队列中，直到调用 EXEC 命令执行事务。事务中的命令会按照顺序执行，要么全部成功，要么全部失败。\n虽然 Redis 提供了 MULTI 和 EXEC 命令来支持事务，但这并不意味着事务的嵌套。如果在一个事务中调用 MULTI 命令开启另一个事务，实际上仍然是在当前事务中执行了一个 MULTI 命令，而不是启动了一个新的嵌套事务。因此，嵌套事务的概念在 Redis 中并不存在。\n如果你需要在 Redis 中进行复杂的操作，可以使用 Lua 脚本来实现。Lua 脚本可以在一个原子性操作中执行多个 Redis 命令，并且支持条件判断和流程控制，以满足更复杂的业务需求。\nRedis 是否支持回滚事务？ 在 Redis 中，事务是支持回滚的。当事务执行过程中发生错误或者通过客户端显式地调用 DISCARD 命令时，Redis 将会回滚事务中的所有命令，将数据恢复到事务执行之前的状态。\n以下是 Redis 中回滚事务的情况：\n当事务执行过程中发生错误时，比如其中一个命令返回了错误，Redis 将自动中止事务的执行，并丢弃事务队列中尚未执行的命令。这样可以确保事务的原子性，未执行的命令不会对数据产生影响。 客户端可以显式地调用 DISCARD 命令来取消事务，放弃之前的所有命令。这将导致 Redis 丢弃事务队列中的所有命令，并将数据恢复到事务开始之前的状态。 需要注意的是，Redis 的事务回滚只会影响当前连接的事务，不会对其他客户端产生影响。如果一个客户端在执行事务期间发生错误或者回滚，其他客户端的操作不会受到影响，它们仍然可以正常地操作和访问 Redis 数据库。\n另外，需要注意的是 Redis 的事务并不是隔离的，即事务执行期间其他客户端提交的命令仍然可以修改事务中的键。因此，在使用 Redis 事务时，需要注意并发操作可能引发的竞态条件。如果需要更严格的隔离性，可以结合使用 WATCH 和 MULTI 命令以及 Lua 脚本来实现更复杂的事务逻辑和控制。\n","wordCount":"2909","inLanguage":"en","datePublished":"2024-01-31T00:00:00+08:00","dateModified":"2024-01-31T00:00:00+08:00","author":{"@type":"Person","name":"chensoul"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.chensoul.cc/posts/2024/01/31/til/"},"publisher":{"@type":"Organization","name":"ChenSoul","logo":{"@type":"ImageObject","url":"https://blog.chensoul.cc/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.chensoul.cc/ accesskey=h title="ChenSoul (Alt + H)">ChenSoul</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.chensoul.cc/categories title=分类><span>分类</span></a></li><li><a href=https://blog.chensoul.cc/tags title=标签><span>标签</span></a></li><li><a href=https://blog.chensoul.cc/search title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li><li><a href=https://blog.chensoul.cc/index.xml title=订阅><span>订阅</span></a></li><li><a href=https://github.com/chensoul title=关于><span>关于</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">2024-01-31｜Redis事务</h1><div class=post-meta><span title='2024-01-31 00:00:00 +0800 CST'>2024-01-31</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;2909 words&nbsp;·&nbsp;chensoul</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#redis%e4%ba%8b%e5%8a%a1 aria-label=Redis事务>Redis事务</a><ul><li><a href=#%e5%8e%9f%e7%90%86 aria-label=原理>原理</a></li><li><a href=#%e7%a4%ba%e4%be%8b aria-label=示例>示例</a></li><li><a href=#springboot%e5%ae%9e%e7%8e%b0%e4%ba%8b%e5%8a%a1%e6%93%8d%e4%bd%9c aria-label=SpringBoot实现事务操作>SpringBoot实现事务操作</a></li><li><a href=#faq aria-label=FAQ>FAQ</a><ul><li><a href=#redis-%e4%ba%8b%e5%8a%a1%e7%9a%84%e5%8e%9f%e5%ad%90%e6%80%a7%e6%98%af%e5%a6%82%e4%bd%95%e4%bf%9d%e8%af%81%e7%9a%84 aria-label="Redis 事务的原子性是如何保证的？">Redis 事务的原子性是如何保证的？</a></li><li><a href=#redis-%e4%ba%8b%e5%8a%a1%e7%9a%84%e4%b9%90%e8%a7%82%e9%94%81%e6%98%af%e5%a6%82%e4%bd%95%e5%b7%a5%e4%bd%9c%e7%9a%84 aria-label="Redis 事务的乐观锁是如何工作的？">Redis 事务的乐观锁是如何工作的？</a></li><li><a href=#redis-%e4%ba%8b%e5%8a%a1%e6%98%af%e5%90%a6%e6%94%af%e6%8c%81%e5%b5%8c%e5%a5%97 aria-label="Redis 事务是否支持嵌套？">Redis 事务是否支持嵌套？</a></li><li><a href=#redis-%e6%98%af%e5%90%a6%e6%94%af%e6%8c%81%e5%9b%9e%e6%bb%9a%e4%ba%8b%e5%8a%a1 aria-label="Redis 是否支持回滚事务？">Redis 是否支持回滚事务？</a></li></ul></li></ul></li></ul></div></details></div><div class=post-content><p>今天做了什么：</p><ol><li><p>下载 《<a href=https://download.packt.com/free-ebook/9781805128694>Microservices with Spring Boot 3 and Spring Cloud</a>》，源码在 <a href=https://github.com/PacktPublishing/Microservices-with-Spring-Boot-and-Spring-Cloud-Third-Edition>github</a></p></li><li><p>Redis 事务</p></li></ol><h1 id=redis事务>Redis事务<a hidden class=anchor aria-hidden=true href=#redis事务>#</a></h1><h2 id=原理>原理<a hidden class=anchor aria-hidden=true href=#原理>#</a></h2><p>Redis 是一个内存数据库，它支持事务操作。Redis 事务是一系列的命令操作，这些命令会被一起执行，要么全部成功，要么全部失败。在事务执行期间，其他客户端提交的命令不会被插入到事务中，确保事务的原子性。</p><p>Redis 事务使用以下命令进行管理：</p><ol><li><code>MULTI</code>：标记事务的开始。</li><li><code>EXEC</code>：执行事务中的所有命令。</li><li><code>DISCARD</code>：取消事务，放弃之前的所有命令。</li><li><code>WATCH</code>：监视一个或多个键，如果在事务执行之前有其他客户端对这些键进行了修改，则事务会被中止。</li><li><code>UNWATCH</code>：取消对所有键的监视。</li></ol><p>在执行事务之前，先使用 <code>MULTI</code> 命令标记事务的开始，然后按顺序执行多个命令。在所有命令都被添加到事务队列之后，使用 <code>EXEC</code> 命令来执行事务中的所有命令。如果执行成功，事务中的所有命令会被一起执行，然后返回结果。如果在执行事务期间发生错误，事务会被中止，所有的修改都会被回滚。</p><h2 id=示例>示例<a hidden class=anchor aria-hidden=true href=#示例>#</a></h2><p>以下是一个使用 Redis 事务的示例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#开启事务</span>
</span></span><span class=line><span class=cl>MULTI
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>SET key1 <span class=s2>&#34;value1&#34;</span>
</span></span><span class=line><span class=cl>SET key2 <span class=s2>&#34;value2&#34;</span>
</span></span><span class=line><span class=cl>GET key1
</span></span><span class=line><span class=cl>GET key2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#执行事务</span>
</span></span><span class=line><span class=cl>EXEC
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 取消事务</span>
</span></span><span class=line><span class=cl>discard
</span></span></code></pre></td></tr></table></div></div><p>上述事务包含了两个 <code>SET</code> 命令和两个 <code>GET</code> 命令。在 <code>EXEC</code> 命令执行之后，将会依次执行这些命令，并返回相应的结果。</p><p>需要注意的是，Redis 的事务是乐观锁，并不会在执行期间对键进行加锁。因此，在使用事务时要注意并发操作可能引发的竞态条件。</p><p>Redis对于命令执行错误处理，有两种解决方式：</p><ul><li>语法错误（编译）</li><li>执行错误（运行）</li></ul><p>语法错误：<strong>执行命令的语法不正确</strong>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#开启事务</span>
</span></span><span class=line><span class=cl>multi
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#命令</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> name zhangsan
</span></span><span class=line><span class=cl><span class=nb>set</span> age
</span></span><span class=line><span class=cl>seterror sex male
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#执行事务</span>
</span></span><span class=line><span class=cl><span class=nb>exec</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#获取正确指令数据</span>
</span></span><span class=line><span class=cl>get name
</span></span></code></pre></td></tr></table></div></div><p>此时整个事务队列中，存在<strong>一条正确指令，两条语法错误指令</strong>， 当执行exec后，会直接返回错误，正确的命令也不会执行。</p><p>执行错误：<strong>命令在运行过程中出现错误</strong>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#开启事务</span>
</span></span><span class=line><span class=cl>multi
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#命令</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> lesson java
</span></span><span class=line><span class=cl>rpush lesson eureka feign nacos
</span></span><span class=line><span class=cl><span class=nb>set</span> lesson redis
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#执行事务</span>
</span></span><span class=line><span class=cl><span class=nb>exec</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#获取数据</span>
</span></span><span class=line><span class=cl>get lesson
</span></span></code></pre></td></tr></table></div></div><p>通过上面事务执行可以看到，语法本身是没有问题的，所以运行之前redis无法发现错误，但是在执行时出现了错误，因此只会错误的命令不执行， 而正确的命令仍然能够正常执行。</p><h2 id=springboot实现事务操作>SpringBoot实现事务操作<a hidden class=anchor aria-hidden=true href=#springboot实现事务操作>#</a></h2><p>1）修改RedisConfig配置类，开启事务控制</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>RedisConfig</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nd>@Autowired</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=n>RedisConnectionFactory</span><span class=w> </span><span class=n>redisConnectionFactory</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nd>@Bean</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=n>RedisTemplate</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=nf>redisTemplate</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>RedisTemplate</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>&gt;</span><span class=w> </span><span class=n>template</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>RedisTemplate</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>template</span><span class=p>.</span><span class=na>setConnectionFactory</span><span class=p>(</span><span class=n>redisConnectionFactory</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c1>// 设置序列化器等其他配置...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>template</span><span class=p>.</span><span class=na>setKeySerializer</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>StringRedisSerializer</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>template</span><span class=p>.</span><span class=na>setValueSerializer</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>GenericJackson2JsonRedisSerializer</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c1>//开启redis事务控制</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>template</span><span class=p>.</span><span class=na>setEnableTransactionSupport</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>return</span><span class=w> </span><span class=n>template</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>2）自定义方法，测试事务效果</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>multiTest</span><span class=p>(){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>//开启事务</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>redisTemplate</span><span class=p>.</span><span class=na>multi</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>try</span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>redisTemplate</span><span class=p>.</span><span class=na>opsForValue</span><span class=p>().</span><span class=na>set</span><span class=p>(</span><span class=s>&#34;lesson&#34;</span><span class=p>,</span><span class=s>&#34;java&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>redisTemplate</span><span class=p>.</span><span class=na>opsForSet</span><span class=p>().</span><span class=na>add</span><span class=p>(</span><span class=s>&#34;lesson&#34;</span><span class=p>,</span><span class=s>&#34;eureka&#34;</span><span class=p>,</span><span class=s>&#34;feign&#34;</span><span class=p>,</span><span class=s>&#34;gateway&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>redisTemplate</span><span class=p>.</span><span class=na>opsForValue</span><span class=p>().</span><span class=na>set</span><span class=p>(</span><span class=s>&#34;lesson&#34;</span><span class=p>,</span><span class=s>&#34;redis&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>redisTemplate</span><span class=p>.</span><span class=na>opsForValue</span><span class=p>().</span><span class=na>get</span><span class=p>(</span><span class=s>&#34;lesson&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=c1>//回滚</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;出现异常&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>redisTemplate</span><span class=p>.</span><span class=na>discard</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=k>finally</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>redisTemplate</span><span class=p>.</span><span class=na>exec</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=faq>FAQ<a hidden class=anchor aria-hidden=true href=#faq>#</a></h2><h3 id=redis-事务的原子性是如何保证的>Redis 事务的原子性是如何保证的？<a hidden class=anchor aria-hidden=true href=#redis-事务的原子性是如何保证的>#</a></h3><p>Redis 事务的原子性是通过 Redis 的单线程执行和乐观锁来保证的。</p><p>在 Redis 中，事务的执行是通过将多个命令按顺序放入事务队列中，然后由 Redis 依次执行这些命令。在事务执行期间，Redis 会确保其他客户端提交的命令不会被插入到当前事务中，从而保证事务的原子性。</p><p>当执行 <code>EXEC</code> 命令时，Redis 会按照顺序执行事务队列中的所有命令，并返回每个命令的执行结果。如果在执行期间出现错误，例如其中一个命令返回了错误，Redis 会终止事务的执行，并返回相应的错误信息。</p><p>此外，Redis 使用乐观锁来保证事务的原子性。在事务执行期间，Redis 不会对事务中的键进行加锁。相反，Redis 会在执行事务之前使用 <code>WATCH</code> 命令监视一个或多个键。如果在事务执行期间有其他客户端对这些被监视的键进行了修改，Redis 会中止事务的执行，并返回一个错误。通过使用乐观锁，Redis 确保了事务在执行期间不会被其他客户端的修改所干扰。</p><p>需要注意的是，Redis 的事务并不是隔离的，即事务执行期间其他客户端提交的命令仍然可以修改事务中的键。因此，在使用 Redis 事务时，需要注意并发操作可能引发的竞态条件。如果需要更严格的隔离性，可以使用 Redis 的 WATCH 和 MULTI 命令结合 Lua 脚本来实现更复杂的事务逻辑。</p><h3 id=redis-事务的乐观锁是如何工作的>Redis 事务的乐观锁是如何工作的？<a hidden class=anchor aria-hidden=true href=#redis-事务的乐观锁是如何工作的>#</a></h3><p>Redis 的事务乐观锁机制是通过 <code>WATCH</code> 命令和检测事务执行期间键的变化来实现的。</p><p>当调用 <code>WATCH</code> 命令时，Redis 会监视一个或多个键。在事务执行期间，如果任何被监视的键发生了变化（被其他客户端修改），Redis 将中止事务的执行。</p><p>以下是乐观锁在 Redis 事务中的工作原理：</p><ol><li>客户端调用 <code>WATCH</code> 命令，指定要监视的键。</li><li>Redis 开始监视这些键，并记录它们的当前值。</li><li>客户端开始执行事务中的命令。</li><li>在执行 <code>EXEC</code> 命令之前，Redis 检查被监视的键是否发生了变化。</li><li>如果任何被监视的键发生了变化，Redis 中止事务的执行，并返回一个错误。</li><li>如果被监视的键没有发生变化，则 Redis 执行事务中的命令，并返回结果。</li></ol><p>乐观锁的关键在于在执行 <code>EXEC</code> 命令之前检查键的变化。如果在事务执行期间，有其他客户端修改了被监视的键，那么 Redis 会中止事务的执行，因为它无法保证事务的原子性。</p><p>需要注意的是，乐观锁并不会对被监视的键进行加锁。它只是在事务执行之前检查键的变化情况。这意味着其他客户端仍然可以修改被监视的键，但是当事务执行时，如果键发生了变化，事务将被中止。</p><p>乐观锁在 Redis 事务中的应用场景是保证在执行事务期间被监视的键没有被其他客户端修改。如果需要更严格的隔离性，可以结合使用 WATCH 和 MULTI 命令以及 Lua 脚本来实现更复杂的事务逻辑。</p><h3 id=redis-事务是否支持嵌套>Redis 事务是否支持嵌套？<a hidden class=anchor aria-hidden=true href=#redis-事务是否支持嵌套>#</a></h3><p>在 Redis 中，事务是不支持嵌套的。也就是说，你不能在一个事务中开启另一个事务。</p><p>当你调用 <code>MULTI</code> 命令开始一个事务后，后续的命令都会被添加到当前事务队列中，直到调用 <code>EXEC</code> 命令执行事务。事务中的命令会按照顺序执行，要么全部成功，要么全部失败。</p><p>虽然 Redis 提供了 <code>MULTI</code> 和 <code>EXEC</code> 命令来支持事务，但这并不意味着事务的嵌套。如果在一个事务中调用 <code>MULTI</code> 命令开启另一个事务，实际上仍然是在当前事务中执行了一个 <code>MULTI</code> 命令，而不是启动了一个新的嵌套事务。因此，嵌套事务的概念在 Redis 中并不存在。</p><p>如果你需要在 Redis 中进行复杂的操作，可以使用 Lua 脚本来实现。Lua 脚本可以在一个原子性操作中执行多个 Redis 命令，并且支持条件判断和流程控制，以满足更复杂的业务需求。</p><h3 id=redis-是否支持回滚事务>Redis 是否支持回滚事务？<a hidden class=anchor aria-hidden=true href=#redis-是否支持回滚事务>#</a></h3><p>在 Redis 中，事务是支持回滚的。当事务执行过程中发生错误或者通过客户端显式地调用 <code>DISCARD</code> 命令时，Redis 将会回滚事务中的所有命令，将数据恢复到事务执行之前的状态。</p><p>以下是 Redis 中回滚事务的情况：</p><ol><li>当事务执行过程中发生错误时，比如其中一个命令返回了错误，Redis 将自动中止事务的执行，并丢弃事务队列中尚未执行的命令。这样可以确保事务的原子性，未执行的命令不会对数据产生影响。</li><li>客户端可以显式地调用 <code>DISCARD</code> 命令来取消事务，放弃之前的所有命令。这将导致 Redis 丢弃事务队列中的所有命令，并将数据恢复到事务开始之前的状态。</li></ol><p>需要注意的是，Redis 的事务回滚只会影响当前连接的事务，不会对其他客户端产生影响。如果一个客户端在执行事务期间发生错误或者回滚，其他客户端的操作不会受到影响，它们仍然可以正常地操作和访问 Redis 数据库。</p><p>另外，需要注意的是 Redis 的事务并不是隔离的，即事务执行期间其他客户端提交的命令仍然可以修改事务中的键。因此，在使用 Redis 事务时，需要注意并发操作可能引发的竞态条件。如果需要更严格的隔离性，可以结合使用 WATCH 和 MULTI 命令以及 Lua 脚本来实现更复杂的事务逻辑和控制。</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.chensoul.cc/tags/redis/>Redis</a></li></ul><nav class=paginav><a class=prev href=https://blog.chensoul.cc/posts/2024/02/01/til/><span class=title>« Prev</span><br><span>2024-02-01｜使用 Spring Initializr 创建项目</span>
</a><a class=next href=https://blog.chensoul.cc/posts/2024/01/30/til/><span class=title>Next »</span><br><span>2024-01-30｜Mybatis plus和Jackson配置</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share 2024-01-31｜Redis事务 on x" href="https://x.com/intent/tweet/?text=2024-01-31%ef%bd%9cRedis%e4%ba%8b%e5%8a%a1&amp;url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f01%2f31%2ftil%2f&amp;hashtags=redis"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 2024-01-31｜Redis事务 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f01%2f31%2ftil%2f&amp;title=2024-01-31%ef%bd%9cRedis%e4%ba%8b%e5%8a%a1&amp;summary=2024-01-31%ef%bd%9cRedis%e4%ba%8b%e5%8a%a1&amp;source=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f01%2f31%2ftil%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 2024-01-31｜Redis事务 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f01%2f31%2ftil%2f&title=2024-01-31%ef%bd%9cRedis%e4%ba%8b%e5%8a%a1"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 2024-01-31｜Redis事务 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f01%2f31%2ftil%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 2024-01-31｜Redis事务 on whatsapp" href="https://api.whatsapp.com/send?text=2024-01-31%ef%bd%9cRedis%e4%ba%8b%e5%8a%a1%20-%20https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f01%2f31%2ftil%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 2024-01-31｜Redis事务 on telegram" href="https://telegram.me/share/url?text=2024-01-31%ef%bd%9cRedis%e4%ba%8b%e5%8a%a1&amp;url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f01%2f31%2ftil%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 2024-01-31｜Redis事务 on ycombinator" href="https://news.ycombinator.com/submitlink?t=2024-01-31%ef%bd%9cRedis%e4%ba%8b%e5%8a%a1&u=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f01%2f31%2ftil%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://blog.chensoul.cc/>ChenSoul</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script async src=https://umami.chensoul.cc/random-string.js data-website-id=821c25f8-a31a-4607-92d7-91ee76843d00></script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>