<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Jenkins安装和部署-使用Docker | ChenSoul</title>
<meta name=keywords content="jenkins"><meta name=description content='使用 Docker 安装 $ docker volume create --name jenkins_data $ docker run -p 8080:8080 -p 50000:50000 -v jenkins_data:/var/jenkins_home jenkins/jenkins:jdk21 第一次启动 Jenkins 时，Docker 日志将包含如下消息：
Jenkins initial setup is required. An admin user has been created and a password generated. Please use the following password to proceed to installation: 1883c809f01b4ed585fb5c3e0156543a This may also be found at: /var/jenkins_home/secrets/initialAdminPassword 那串随机的数字和字母是初始管理员密码，这是完成 Jenkins 配置所必需的。
使用 Docker Compose 安装 services: jenkins: image: jenkins/jenkins:jdk21 ports: - "8080:8080" - "50000:50000" volumes: - jenkins_data:/var/jenkins_home - /var/run/docker.sock:/var/run/docker.sock - /etc/localtime:/etc/localtime:ro volumes: jenkins_data: 在 Docker 中下载并运行 Jenkins 参考 在 Docker 中下载并运行 Jenkins。
定制官方 Jenkins Docker 镜像，例如，安装 curl、maven、docker-ce-cli
FROM jenkins/jenkins:jdk21 USER root RUN apt-get update && apt-get install -y curl maven lsb-release RUN curl -fsSLo /usr/share/keyrings/docker-archive-keyring.'><meta name=author content="chensoul"><link rel=canonical href=https://blog.chensoul.cc/posts/2024/06/26/install-jenkins/><meta name=google-site-verification content="nBXwg45SBRjTX78SA-mH0asrAbsdu9c1nk0ObSry7aQ"><link crossorigin=anonymous href=/assets/css/stylesheet.48da2331f774073f2b09ec285a9c0e15fd969021a9d2d0fb60b7cbb73cef5ecc.css integrity="sha256-SNojMfd0Bz8rCewoWpwOFf2WkCGp0tD7YLfLtzzvXsw=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.chensoul.cc/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.chensoul.cc/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.chensoul.cc/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.chensoul.cc/apple-touch-icon.png><link rel=mask-icon href=https://blog.chensoul.cc/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.chensoul.cc/posts/2024/06/26/install-jenkins/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta name=baidu-site-verification content="codeva-FYpQY8JdLU"><meta property="og:title" content="Jenkins安装和部署-使用Docker"><meta property="og:description" content='使用 Docker 安装 $ docker volume create --name jenkins_data $ docker run -p 8080:8080 -p 50000:50000 -v jenkins_data:/var/jenkins_home jenkins/jenkins:jdk21 第一次启动 Jenkins 时，Docker 日志将包含如下消息：
Jenkins initial setup is required. An admin user has been created and a password generated. Please use the following password to proceed to installation: 1883c809f01b4ed585fb5c3e0156543a This may also be found at: /var/jenkins_home/secrets/initialAdminPassword 那串随机的数字和字母是初始管理员密码，这是完成 Jenkins 配置所必需的。
使用 Docker Compose 安装 services: jenkins: image: jenkins/jenkins:jdk21 ports: - "8080:8080" - "50000:50000" volumes: - jenkins_data:/var/jenkins_home - /var/run/docker.sock:/var/run/docker.sock - /etc/localtime:/etc/localtime:ro volumes: jenkins_data: 在 Docker 中下载并运行 Jenkins 参考 在 Docker 中下载并运行 Jenkins。
定制官方 Jenkins Docker 镜像，例如，安装 curl、maven、docker-ce-cli
FROM jenkins/jenkins:jdk21 USER root RUN apt-get update && apt-get install -y curl maven lsb-release RUN curl -fsSLo /usr/share/keyrings/docker-archive-keyring.'><meta property="og:type" content="article"><meta property="og:url" content="https://blog.chensoul.cc/posts/2024/06/26/install-jenkins/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-06-26T16:00:00+08:00"><meta property="article:modified_time" content="2024-06-26T16:00:00+08:00"><meta property="og:site_name" content="ChenSoul"><meta name=twitter:card content="summary"><meta name=twitter:title content="Jenkins安装和部署-使用Docker"><meta name=twitter:description content='使用 Docker 安装 $ docker volume create --name jenkins_data $ docker run -p 8080:8080 -p 50000:50000 -v jenkins_data:/var/jenkins_home jenkins/jenkins:jdk21 第一次启动 Jenkins 时，Docker 日志将包含如下消息：
Jenkins initial setup is required. An admin user has been created and a password generated. Please use the following password to proceed to installation: 1883c809f01b4ed585fb5c3e0156543a This may also be found at: /var/jenkins_home/secrets/initialAdminPassword 那串随机的数字和字母是初始管理员密码，这是完成 Jenkins 配置所必需的。
使用 Docker Compose 安装 services: jenkins: image: jenkins/jenkins:jdk21 ports: - "8080:8080" - "50000:50000" volumes: - jenkins_data:/var/jenkins_home - /var/run/docker.sock:/var/run/docker.sock - /etc/localtime:/etc/localtime:ro volumes: jenkins_data: 在 Docker 中下载并运行 Jenkins 参考 在 Docker 中下载并运行 Jenkins。
定制官方 Jenkins Docker 镜像，例如，安装 curl、maven、docker-ce-cli
FROM jenkins/jenkins:jdk21 USER root RUN apt-get update && apt-get install -y curl maven lsb-release RUN curl -fsSLo /usr/share/keyrings/docker-archive-keyring.'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.chensoul.cc/posts/"},{"@type":"ListItem","position":2,"name":"Jenkins安装和部署-使用Docker","item":"https://blog.chensoul.cc/posts/2024/06/26/install-jenkins/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Jenkins安装和部署-使用Docker","name":"Jenkins安装和部署-使用Docker","description":"使用 Docker 安装 $ docker volume create --name jenkins_data $ docker run -p 8080:8080 -p 50000:50000 -v jenkins_data:/var/jenkins_home jenkins/jenkins:jdk21 第一次启动 Jenkins 时，Docker 日志将包含如下消息：\nJenkins initial setup is required. An admin user has been created and a password generated. Please use the following password to proceed to installation: 1883c809f01b4ed585fb5c3e0156543a This may also be found at: /var/jenkins_home/secrets/initialAdminPassword 那串随机的数字和字母是初始管理员密码，这是完成 Jenkins 配置所必需的。\n使用 Docker Compose 安装 services: jenkins: image: jenkins/jenkins:jdk21 ports: - \u0026#34;8080:8080\u0026#34; - \u0026#34;50000:50000\u0026#34; volumes: - jenkins_data:/var/jenkins_home - /var/run/docker.sock:/var/run/docker.sock - /etc/localtime:/etc/localtime:ro volumes: jenkins_data: 在 Docker 中下载并运行 Jenkins 参考 在 Docker 中下载并运行 Jenkins。\n定制官方 Jenkins Docker 镜像，例如，安装 curl、maven、docker-ce-cli\nFROM jenkins/jenkins:jdk21 USER root RUN apt-get update \u0026amp;\u0026amp; apt-get install -y curl maven lsb-release RUN curl -fsSLo /usr/share/keyrings/docker-archive-keyring.","keywords":["jenkins"],"articleBody":"使用 Docker 安装 $ docker volume create --name jenkins_data $ docker run -p 8080:8080 -p 50000:50000 -v jenkins_data:/var/jenkins_home jenkins/jenkins:jdk21 第一次启动 Jenkins 时，Docker 日志将包含如下消息：\nJenkins initial setup is required. An admin user has been created and a password generated. Please use the following password to proceed to installation: 1883c809f01b4ed585fb5c3e0156543a This may also be found at: /var/jenkins_home/secrets/initialAdminPassword 那串随机的数字和字母是初始管理员密码，这是完成 Jenkins 配置所必需的。\n使用 Docker Compose 安装 services: jenkins: image: jenkins/jenkins:jdk21 ports: - \"8080:8080\" - \"50000:50000\" volumes: - jenkins_data:/var/jenkins_home - /var/run/docker.sock:/var/run/docker.sock - /etc/localtime:/etc/localtime:ro volumes: jenkins_data: 在 Docker 中下载并运行 Jenkins 参考 在 Docker 中下载并运行 Jenkins。\n定制官方 Jenkins Docker 镜像，例如，安装 curl、maven、docker-ce-cli\nFROM jenkins/jenkins:jdk21 USER root RUN apt-get update \u0026\u0026 apt-get install -y curl maven lsb-release RUN curl -fsSLo /usr/share/keyrings/docker-archive-keyring.asc \\ https://download.docker.com/linux/debian/gpg RUN echo \"deb [arch=$(dpkg --print-architecture) \\ signed-by=/usr/share/keyrings/docker-archive-keyring.asc] \\ https://download.docker.com/linux/debian \\ $(lsb_release -cs) stable\" \u003e /etc/apt/sources.list.d/docker.list RUN apt-get update \u0026\u0026 apt-get install -y docker-ce-cli USER jenkins RUN jenkins-plugin-cli --plugins \"blueocean docker-workflow\" 更多定制，可以参考 https://github.com/taypo/jenkins/blob/master/Dockerfile\n从该 Dockerfile 构建一个新的 Docker 镜像，并为该镜像分配一个有意义的名称，例如“myjenkins-blueocean：2.452.2-1”：\ndocker build -t myjenkins-blueocean:2.452.2-1 . 创建一个 docker-compose 文件：\nservices: jenkins-docker: image: docker:dind environment: - DOCKER_TLS_CERTDIR=/certs ports: - \"2376:2376\" volumes: - jenkins_docker_certs:/certs/client - jenkins_data:/var/jenkins_home jenkins-blueocean: image: myjenkins-blueocean:2.452.2-1 environment: - DOCKER_HOST=tcp://jenkins-docker:2376 - DOCKER_CERT_PATH=/certs/client - DOCKER_TLS_VERIFY=1 ports: - \"8080:8080\" - \"50000:50000\" volumes: - jenkins_docker_certs:/certs/client:ro - jenkins_data:/var/jenkins_home volumes: jenkins_data: jenkins_docker_certs: Jenkins 设置 登录之后，修改默认默默，安装插件，并创建第一个用户。\n配置 JDK 和 Maven JDK 可以使用 jenkins 镜像自带的，jenkins 默认使用 JDK17，如果需要指定 JDK 版本，可以使用 jenkins/jenkins:xx-jdk8 镜像。JAVA_HOME 地址 /opt/java/openjdk\nMaven 可以进入容器安装，或者在 jenkins 配置通过命令自动安装。\n配置镜像加速 打开宿主机 Jenkins 工作目录下的hudson.model.UpdateCenter.xml文件。url 修改为国内的清华大学官方镜像地址，最终内容如下：\n\u003c?xml version='1.1' encoding='UTF-8'?\u003e default https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json 配置Github SSH key 在Jenkins用户下，生成一对ssh key，将公钥放到github，私钥配置到上面docker token同样的位置即可。这样在job中可以使用ssh从github clone code。注意如果首次连接提示：\nNo ECDSA host key is known for github.houston.softwaregrp.net and you have requested strict checking. 可以采用下面的方法解决：\n配置SSH登录 如果在Jenkins Pipeline中需要ssh到远程server，需要配置下ssh key，把生成好的public key放到远端server的authorized keys里面就行了。\n配置反向代理 参考 《CI：如何使用 Docker Compose 在 arm64 macOS 中为 Jenkins 创建 Nginx 反向代理？》。\n准备好 SSL 文件，放置 /etc/nginx/ssl 目录\n安装 nginx。\n创建一个 nginx conf 文件 jenkins.conf 放到 nginx 的相应目录下。\n# Required for Jenkins websocket agents map $http_upgrade $connection_upgrade { default upgrade; '' close; } server { listen 80; server_name jenkins.chensoul.cc; rewrite ^ https://$http_host$request_uri? permanent; } server { listen 443 ssl; server_name jenkins.chensoul.cc; ssl_certificate /etc/nginx/ssl/all.crt; ssl_certificate_key /etc/nginx/ssl/all.key; ssl_session_timeout 5m; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE; ssl_prefer_server_ciphers on; client_max_body_size 1g; access_log /var/log/nginx/jenkins.log; # pass through headers from Jenkins that Nginx considers invalid ignore_invalid_headers off; location ~ \"^/static/[0-9a-fA-F]{8}\\/(.*)$\" { # rewrite all static files into requests to the root # E.g /static/12345678/css/something.css will become /css/something.css rewrite \"^/static/[0-9a-fA-F]{8}\\/(.*)\" /$1 last; } location / { proxy_pass http://192.168.1.107:8080; proxy_redirect default; proxy_http_version 1.1; # Required for Jenkins websocket agents proxy_set_header Connection $connection_upgrade; proxy_set_header Upgrade $http_upgrade; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto http; proxy_max_temp_file_size 0; proxy_connect_timeout 150; proxy_send_timeout 100; proxy_read_timeout 100; proxy_buffer_size 8k; proxy_buffers 4 32k; proxy_busy_buffers_size 64k; proxy_temp_file_write_size 64k; } } 192.168.1.107 为宿主机的 IP 地址。 向 Jenkins 镜像添加其他软件 创建一个 Dockerfile 文件\nFROM jenkins/jenkins:lts USER root RUN apt update \u0026\u0026 \\ apt install -y --no-install-recommends gnupg curl ca-certificates apt-transport-https USER jenkins 安装新插件的最简单方法是使用 Jenkins Web UI，另外也可以使用 jenkins-plugin-cli，Jenkins 插件可以从 Jenkins 插件网站 查找。\n比如，下面 Dockerfile 文件安装了 Git 插件：\nFROM jenkins/jenkins:lts USER root RUN apt update \u0026\u0026 \\ apt install -y --no-install-recommends gnupg curl ca-certificates apt-transport-https USER jenkins RUN jenkins-plugin-cli --plugins git:5.2.2 备份 docker run --rm -v jenkins_data:/var/jenkins_home -v $(pwd):/backup ubuntu tar cvf /backup/backup.tar /var/jenkins_home 将 Docker 镜像作为服务运行 要创建新的 systemd 服务，请将以下内容保存到文件/etc/systemd/system/docker-jenkins.service：\n[Unit] Description=Jenkins [Service] SyslogIdentifier=docker-jenkins ExecStartPre=-/usr/bin/docker create -m 0b -p 8080:8080 -p 50000:50000 --restart=always --name jenkins jenkins/jenkins:lts ExecStart=/usr/bin/docker start -a jenkins ExecStop=-/usr/bin/docker stop --time=0 jenkins [Install] WantedBy=multi-user.target 要加载新的服务文件，请运行以下命令：\nsudo systemctl daemon-reload 要启动该服务，请运行以下命令：\nsudo systemctl start docker-jenkins 要使服务在重新启动时运行，请运行以下命令：\nsudo systemctl enable docker-jenkins 要查看服务日志，请运行以下命令：\nsudo journalctl -u docker-jenkins -f 参考文章 Docker 安装 Jenkins 并实现项目自动化部署\nHow to install Jenkins using Docker Compose?\n","wordCount":"574","inLanguage":"en","datePublished":"2024-06-26T16:00:00+08:00","dateModified":"2024-06-26T16:00:00+08:00","author":{"@type":"Person","name":"chensoul"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.chensoul.cc/posts/2024/06/26/install-jenkins/"},"publisher":{"@type":"Organization","name":"ChenSoul","logo":{"@type":"ImageObject","url":"https://blog.chensoul.cc/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.chensoul.cc/ accesskey=h title="ChenSoul (Alt + H)">ChenSoul</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.chensoul.cc/categories title=分类><span>分类</span></a></li><li><a href=https://blog.chensoul.cc/tags title=标签><span>标签</span></a></li><li><a href=https://blog.chensoul.cc/search title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li><li><a href=https://blog.chensoul.cc/index.xml title=订阅><span>订阅</span></a></li><li><a href=https://github.com/chensoul title=关于><span>关于</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Jenkins安装和部署-使用Docker</h1><div class=post-meta><span title='2024-06-26 16:00:00 +0800 +0800'>2024-06-26</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;574 words&nbsp;·&nbsp;chensoul</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e4%bd%bf%e7%94%a8-docker-%e5%ae%89%e8%a3%85 aria-label="使用 Docker 安装">使用 Docker 安装</a></li><li><a href=#%e4%bd%bf%e7%94%a8-docker-compose-%e5%ae%89%e8%a3%85 aria-label="使用 Docker Compose 安装">使用 Docker Compose 安装</a></li><li><a href=#%e5%9c%a8-docker-%e4%b8%ad%e4%b8%8b%e8%bd%bd%e5%b9%b6%e8%bf%90%e8%a1%8c-jenkins aria-label="在 Docker 中下载并运行 Jenkins">在 Docker 中下载并运行 Jenkins</a></li><li><a href=#jenkins-%e8%ae%be%e7%bd%ae aria-label="Jenkins 设置">Jenkins 设置</a><ul><li><a href=#%e9%85%8d%e7%bd%ae-jdk-%e5%92%8c-maven aria-label="配置 JDK 和 Maven">配置 JDK 和 Maven</a></li><li><a href=#%e9%85%8d%e7%bd%ae%e9%95%9c%e5%83%8f%e5%8a%a0%e9%80%9f aria-label=配置镜像加速>配置镜像加速</a></li><li><a href=#%e9%85%8d%e7%bd%aegithub-ssh-key aria-label="配置Github SSH key">配置Github SSH key</a></li><li><a href=#%e9%85%8d%e7%bd%aessh%e7%99%bb%e5%bd%95 aria-label=配置SSH登录>配置SSH登录</a></li><li><a href=#%e9%85%8d%e7%bd%ae%e5%8f%8d%e5%90%91%e4%bb%a3%e7%90%86 aria-label=配置反向代理>配置反向代理</a></li></ul></li><li><a href=#%e5%90%91-jenkins-%e9%95%9c%e5%83%8f%e6%b7%bb%e5%8a%a0%e5%85%b6%e4%bb%96%e8%bd%af%e4%bb%b6 aria-label="向 Jenkins 镜像添加其他软件">向 Jenkins 镜像添加其他软件</a></li><li><a href=#%e5%a4%87%e4%bb%bd aria-label=备份>备份</a></li><li><a href=#%e5%b0%86-docker-%e9%95%9c%e5%83%8f%e4%bd%9c%e4%b8%ba%e6%9c%8d%e5%8a%a1%e8%bf%90%e8%a1%8c aria-label="将 Docker 镜像作为服务运行">将 Docker 镜像作为服务运行</a></li><li><a href=#%e5%8f%82%e8%80%83%e6%96%87%e7%ab%a0 aria-label=参考文章>参考文章</a></li></ul></div></details></div><div class=post-content><h2 id=使用-docker-安装>使用 Docker 安装<a hidden class=anchor aria-hidden=true href=#使用-docker-安装>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker volume create --name jenkins_data
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ docker run -p 8080:8080 -p 50000:50000 -v jenkins_data:/var/jenkins_home jenkins/jenkins:jdk21
</span></span></code></pre></div><p>第一次启动 Jenkins 时，Docker 日志将包含如下消息：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Jenkins initial setup is required. An admin user has been created and a password generated.
</span></span><span class=line><span class=cl>Please use the following password to proceed to installation:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>1883c809f01b4ed585fb5c3e0156543a
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>This may also be found at: /var/jenkins_home/secrets/initialAdminPassword
</span></span></code></pre></div><p>那串随机的数字和字母是初始管理员密码，这是完成 Jenkins 配置所必需的。</p><h2 id=使用-docker-compose-安装>使用 Docker Compose 安装<a hidden class=anchor aria-hidden=true href=#使用-docker-compose-安装>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nt>jenkins</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>jenkins/jenkins:jdk21</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=s2>&#34;8080:8080&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=s2>&#34;50000:50000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>jenkins_data:/var/jenkins_home</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>/var/run/docker.sock:/var/run/docker.sock</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>/etc/localtime:/etc/localtime:ro</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>jenkins_data</span><span class=p>:</span><span class=w>
</span></span></span></code></pre></div><h2 id=在-docker-中下载并运行-jenkins>在 Docker 中下载并运行 Jenkins<a hidden class=anchor aria-hidden=true href=#在-docker-中下载并运行-jenkins>#</a></h2><p>参考 <a href=https://www.jenkins.io/doc/book/installing/docker/>在 Docker 中下载并运行 Jenkins</a>。</p><p>定制官方 Jenkins Docker 镜像，例如，安装 curl、maven、docker-ce-cli</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> jenkins/jenkins:jdk21</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>USER</span><span class=s> root</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> apt-get update <span class=o>&amp;&amp;</span> apt-get install -y curl maven lsb-release<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> curl -fsSLo /usr/share/keyrings/docker-archive-keyring.asc <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  https://download.docker.com/linux/debian/gpg<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> <span class=nb>echo</span> <span class=s2>&#34;deb [arch=</span><span class=k>$(</span>dpkg --print-architecture<span class=k>)</span><span class=s2> \
</span></span></span><span class=line><span class=cl><span class=s2>  signed-by=/usr/share/keyrings/docker-archive-keyring.asc] \
</span></span></span><span class=line><span class=cl><span class=s2>  https://download.docker.com/linux/debian \
</span></span></span><span class=line><span class=cl><span class=s2>  </span><span class=k>$(</span>lsb_release -cs<span class=k>)</span><span class=s2> stable&#34;</span> &gt; /etc/apt/sources.list.d/docker.list<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> apt-get update <span class=o>&amp;&amp;</span> apt-get install -y docker-ce-cli<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>USER</span><span class=s> jenkins</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> jenkins-plugin-cli --plugins <span class=s2>&#34;blueocean docker-workflow&#34;</span><span class=err>
</span></span></span></code></pre></div><blockquote><p>更多定制，可以参考 <a href=https://github.com/taypo/jenkins/blob/master/Dockerfile>https://github.com/taypo/jenkins/blob/master/Dockerfile</a></p></blockquote><p>从该 Dockerfile 构建一个新的 Docker 镜像，并为该镜像分配一个有意义的名称，例如“myjenkins-blueocean：2.452.2-1”：</p><pre tabindex=0><code>docker build -t myjenkins-blueocean:2.452.2-1 .
</code></pre><p>创建一个 docker-compose 文件：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>jenkins-docker</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>docker:dind</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>DOCKER_TLS_CERTDIR=/certs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=s2>&#34;2376:2376&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>jenkins_docker_certs:/certs/client</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>jenkins_data:/var/jenkins_home</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>jenkins-blueocean</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>myjenkins-blueocean:2.452.2-1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>DOCKER_HOST=tcp://jenkins-docker:2376</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>DOCKER_CERT_PATH=/certs/client</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>DOCKER_TLS_VERIFY=1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=s2>&#34;8080:8080&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=s2>&#34;50000:50000&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>jenkins_docker_certs:/certs/client:ro</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=l>jenkins_data:/var/jenkins_home</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>jenkins_data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>jenkins_docker_certs</span><span class=p>:</span><span class=w>
</span></span></span></code></pre></div><h2 id=jenkins-设置>Jenkins 设置<a hidden class=anchor aria-hidden=true href=#jenkins-设置>#</a></h2><p>登录之后，修改默认默默，安装插件，并创建第一个用户。</p><h3 id=配置-jdk-和-maven>配置 JDK 和 Maven<a hidden class=anchor aria-hidden=true href=#配置-jdk-和-maven>#</a></h3><p>JDK 可以使用 jenkins 镜像自带的，jenkins 默认使用 JDK17，如果需要指定 JDK 版本，可以使用 <code>jenkins/jenkins:xx-jdk8</code> 镜像。JAVA_HOME 地址 <strong>/opt/java/openjdk</strong></p><p>Maven 可以进入容器安装，或者在 jenkins 配置通过命令自动安装。</p><h3 id=配置镜像加速>配置镜像加速<a hidden class=anchor aria-hidden=true href=#配置镜像加速>#</a></h3><p>打开宿主机 Jenkins 工作目录下的hudson.model.UpdateCenter.xml文件。url 修改为国内的清华大学官方镜像地址，最终内容如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#39;1.1&#39; encoding=&#39;UTF-8&#39;?&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;sites&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;site&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;id&gt;</span>default<span class=nt>&lt;/id&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;url&gt;</span>https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json<span class=nt>&lt;/url&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/site&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/sites&gt;</span>
</span></span></code></pre></div><h3 id=配置github-ssh-key>配置Github SSH key<a hidden class=anchor aria-hidden=true href=#配置github-ssh-key>#</a></h3><p>在Jenkins用户下，生成一对ssh key，将公钥放到github，私钥配置到上面docker token同样的位置即可。这样在job中可以使用ssh从github clone code。注意如果首次连接提示：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>No ECDSA host key is known <span class=k>for</span> github.houston.softwaregrp.net and you have requested strict checking.
</span></span></code></pre></div><p>可以采用下面的方法解决：</p><p><img loading=lazy src=https://developer.qcloudimg.com/http-save/yehe-9281266/f783d4864d48e3dfe0dbb61d7f545203.jpg alt=img></p><h3 id=配置ssh登录>配置SSH登录<a hidden class=anchor aria-hidden=true href=#配置ssh登录>#</a></h3><p>如果在Jenkins Pipeline中需要ssh到远程server，需要配置下ssh key，把生成好的public key放到远端server的authorized keys里面就行了。</p><h3 id=配置反向代理>配置反向代理<a hidden class=anchor aria-hidden=true href=#配置反向代理>#</a></h3><p>参考 《<a href=https://akarshseggemu.medium.com/ci-how-to-create-a-nginx-reverse-proxy-for-jenkins-in-arm64-macos-using-docker-compose-4f79c2c6013c>CI：如何使用 Docker Compose 在 arm64 macOS 中为 Jenkins 创建 Nginx 反向代理？</a>》。</p><ol><li><p>准备好 SSL 文件，放置 /etc/nginx/ssl 目录</p></li><li><p>安装 nginx。</p></li><li><p>创建一个 nginx conf 文件 jenkins.conf 放到 nginx 的相应目录下。</p></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-nginx data-lang=nginx><span class=line><span class=cl><span class=c1># Required for Jenkins websocket agents
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>map</span> <span class=nv>$http_upgrade</span> <span class=nv>$connection_upgrade</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kn>default</span> <span class=s>upgrade</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kn>&#39;&#39;</span> <span class=s>close</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=mi>80</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span> <span class=s>jenkins.chensoul.cc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>rewrite</span> <span class=s>^</span> <span class=s>https://</span><span class=nv>$http_host$request_uri?</span> <span class=s>permanent</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kn>listen</span> <span class=mi>443</span> <span class=s>ssl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>server_name</span> <span class=s>jenkins.chensoul.cc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_certificate</span> <span class=s>/etc/nginx/ssl/all.crt</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_certificate_key</span> <span class=s>/etc/nginx/ssl/all.key</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_session_timeout</span> <span class=mi>5m</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_protocols</span> <span class=s>TLSv1</span> <span class=s>TLSv1.1</span> <span class=s>TLSv1.2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_ciphers</span> <span class=s>ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kn>ssl_prefer_server_ciphers</span> <span class=no>on</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>client_max_body_size</span> <span class=s>1g</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kn>access_log</span> <span class=s>/var/log/nginx/jenkins.log</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># pass through headers from Jenkins that Nginx considers invalid
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kn>ignore_invalid_headers</span> <span class=no>off</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>location</span> <span class=p>~</span> <span class=sr>&#34;^/static/[0-9a-fA-F]</span><span class=p>{</span><span class=kn>8}\/(.*)$&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    	<span class=c1># rewrite all static files into requests to the root
</span></span></span><span class=line><span class=cl><span class=c1></span>    	<span class=c1># E.g /static/12345678/css/something.css will become /css/something.css
</span></span></span><span class=line><span class=cl><span class=c1></span>    	<span class=kn>rewrite</span> <span class=s>&#34;^/static/[0-9a-fA-F]</span><span class=p>{</span><span class=kn>8}\/(.*)&#34;</span> <span class=s>/</span><span class=nv>$1</span> <span class=s>last</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kn>location</span> <span class=s>/</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_pass</span> <span class=s>http://192.168.1.107:8080</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_redirect</span>     <span class=s>default</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_http_version</span> <span class=mi>1</span><span class=s>.1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Required for Jenkins websocket agents
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kn>proxy_set_header</span>   <span class=s>Connection</span>        <span class=nv>$connection_upgrade</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span>   <span class=s>Upgrade</span>           <span class=nv>$http_upgrade</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>Host</span> <span class=nv>$host</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>X-Real-IP</span> <span class=nv>$remote_addr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>X-Forwarded-For</span> <span class=nv>$proxy_add_x_forwarded_for</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_set_header</span> <span class=s>X-Forwarded-Proto</span> <span class=s>http</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_max_temp_file_size</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_connect_timeout</span> <span class=mi>150</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_send_timeout</span> <span class=mi>100</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_read_timeout</span> <span class=mi>100</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_buffer_size</span> <span class=mi>8k</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_buffers</span> <span class=mi>4</span> <span class=mi>32k</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_busy_buffers_size</span> <span class=mi>64k</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kn>proxy_temp_file_write_size</span> <span class=mi>64k</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ul><li>192.168.1.107 为宿主机的 IP 地址。</li></ul><h2 id=向-jenkins-镜像添加其他软件>向 Jenkins 镜像添加其他软件<a hidden class=anchor aria-hidden=true href=#向-jenkins-镜像添加其他软件>#</a></h2><p>创建一个 Dockerfile 文件</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> jenkins/jenkins:lts</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>USER</span><span class=s> root</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> apt update <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    apt install -y --no-install-recommends gnupg curl ca-certificates apt-transport-https<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>USER</span><span class=s> jenkins</span><span class=err>
</span></span></span></code></pre></div><p>安装新插件的最简单方法是使用 Jenkins Web UI，另外也可以使用 jenkins-plugin-cli，Jenkins 插件可以从 <a href=https://plugins.jenkins.io/>Jenkins 插件网站</a> 查找。</p><p>比如，下面 Dockerfile 文件安装了 Git 插件：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> jenkins/jenkins:lts</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>USER</span><span class=s> root</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> apt update <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    apt install -y --no-install-recommends gnupg curl ca-certificates apt-transport-https<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>USER</span><span class=s> jenkins</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> jenkins-plugin-cli --plugins git:5.2.2<span class=err>
</span></span></span></code></pre></div><h2 id=备份>备份<a hidden class=anchor aria-hidden=true href=#备份>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run --rm -v jenkins_data:/var/jenkins_home -v <span class=k>$(</span><span class=nb>pwd</span><span class=k>)</span>:/backup ubuntu tar cvf /backup/backup.tar /var/jenkins_home
</span></span></code></pre></div><h2 id=将-docker-镜像作为服务运行>将 Docker 镜像作为服务运行<a hidden class=anchor aria-hidden=true href=#将-docker-镜像作为服务运行>#</a></h2><p>要创建新的 systemd 服务，请将以下内容保存到文件<code>/etc/systemd/system/docker-jenkins.service</code>：</p><pre tabindex=0><code>[Unit]
Description=Jenkins

[Service]
SyslogIdentifier=docker-jenkins
ExecStartPre=-/usr/bin/docker create -m 0b -p 8080:8080 -p 50000:50000 --restart=always --name jenkins jenkins/jenkins:lts
ExecStart=/usr/bin/docker start -a jenkins
ExecStop=-/usr/bin/docker stop --time=0 jenkins

[Install]
WantedBy=multi-user.target
</code></pre><p>要加载新的服务文件，请运行以下命令：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl daemon-reload
</span></span></code></pre></div><p>要启动该服务，请运行以下命令：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl start docker-jenkins
</span></span></code></pre></div><p>要使服务在重新启动时运行，请运行以下命令：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl <span class=nb>enable</span> docker-jenkins
</span></span></code></pre></div><p>要查看服务日志，请运行以下命令：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo journalctl -u docker-jenkins -f
</span></span></code></pre></div><h2 id=参考文章>参考文章<a hidden class=anchor aria-hidden=true href=#参考文章>#</a></h2><ul><li><p><a href=https://cloud.tencent.com/developer/article/2347137>Docker 安装 Jenkins 并实现项目自动化部署</a></p></li><li><p><a href=https://www.czerniga.it/2021/11/07/how-to-install-jenkins-using-docker-compose/>How to install Jenkins using Docker Compose?</a></p></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.chensoul.cc/tags/jenkins/>Jenkins</a></li></ul><nav class=paginav><a class=prev href=https://blog.chensoul.cc/posts/2024/06/26/install-gitlab/><span class=title>« Prev</span><br><span>Gitlab安装和部署-使用Docker</span>
</a><a class=next href=https://blog.chensoul.cc/posts/2024/06/26/install-cert-manager/><span class=title>Next »</span><br><span>Tengine动态裁剪图片</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Jenkins安装和部署-使用Docker on x" href="https://x.com/intent/tweet/?text=Jenkins%e5%ae%89%e8%a3%85%e5%92%8c%e9%83%a8%e7%bd%b2-%e4%bd%bf%e7%94%a8Docker&amp;url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f06%2f26%2finstall-jenkins%2f&amp;hashtags=jenkins"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Jenkins安装和部署-使用Docker on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f06%2f26%2finstall-jenkins%2f&amp;title=Jenkins%e5%ae%89%e8%a3%85%e5%92%8c%e9%83%a8%e7%bd%b2-%e4%bd%bf%e7%94%a8Docker&amp;summary=Jenkins%e5%ae%89%e8%a3%85%e5%92%8c%e9%83%a8%e7%bd%b2-%e4%bd%bf%e7%94%a8Docker&amp;source=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f06%2f26%2finstall-jenkins%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Jenkins安装和部署-使用Docker on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f06%2f26%2finstall-jenkins%2f&title=Jenkins%e5%ae%89%e8%a3%85%e5%92%8c%e9%83%a8%e7%bd%b2-%e4%bd%bf%e7%94%a8Docker"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Jenkins安装和部署-使用Docker on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f06%2f26%2finstall-jenkins%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Jenkins安装和部署-使用Docker on whatsapp" href="https://api.whatsapp.com/send?text=Jenkins%e5%ae%89%e8%a3%85%e5%92%8c%e9%83%a8%e7%bd%b2-%e4%bd%bf%e7%94%a8Docker%20-%20https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f06%2f26%2finstall-jenkins%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Jenkins安装和部署-使用Docker on telegram" href="https://telegram.me/share/url?text=Jenkins%e5%ae%89%e8%a3%85%e5%92%8c%e9%83%a8%e7%bd%b2-%e4%bd%bf%e7%94%a8Docker&amp;url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f06%2f26%2finstall-jenkins%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Jenkins安装和部署-使用Docker on ycombinator" href="https://news.ycombinator.com/submitlink?t=Jenkins%e5%ae%89%e8%a3%85%e5%92%8c%e9%83%a8%e7%bd%b2-%e4%bd%bf%e7%94%a8Docker&u=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f06%2f26%2finstall-jenkins%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://blog.chensoul.cc/>ChenSoul</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script async src=https://umami.chensoul.cc/random-string.js data-website-id=821c25f8-a31a-4607-92d7-91ee76843d00></script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>