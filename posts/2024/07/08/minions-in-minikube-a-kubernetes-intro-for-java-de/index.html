<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[译]Minikube 中的 Minions - 面向 Java 开发人员的 Kubernetes 简介 | ChenSoul</title>
<meta name=keywords content="kubernetes,minikube"><meta name=description content="我们希望我们的微服务是可复制、可替换的工作程序，我们可以轻松升级或降级，无需停机，管理也只需最少。我们可能会说我们希望他们是我们的奴才。在本文中，我们将通过一个简单的示例来了解 Kubernetes 通过创建和编排奴才大军可以为我们做些什么。您可以按照本文进行编码，也可以从此处克隆项目。"><meta name=author content="chensoul"><link rel=canonical href=https://blog.chensoul.cc/posts/2024/07/08/minions-in-minikube-a-kubernetes-intro-for-java-de/><meta name=google-site-verification content="nBXwg45SBRjTX78SA-mH0asrAbsdu9c1nk0ObSry7aQ"><link crossorigin=anonymous href=/assets/css/stylesheet.899d9a536396b9b03c9eae0c99cc6ec954a90da94036f5390d131eb8071bb417.css integrity="sha256-iZ2aU2OWubA8nq4MmcxuyVSpDalANvU5DRMeuAcbtBc=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.chensoul.cc/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.chensoul.cc/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.chensoul.cc/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.chensoul.cc/apple-touch-icon.png><link rel=mask-icon href=https://blog.chensoul.cc/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://blog.chensoul.cc/posts/2024/07/08/minions-in-minikube-a-kubernetes-intro-for-java-de/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta name=baidu-site-verification content="codeva-FYpQY8JdLU"><meta property="og:title" content="[译]Minikube 中的 Minions - 面向 Java 开发人员的 Kubernetes 简介"><meta property="og:description" content="我们希望我们的微服务是可复制、可替换的工作程序，我们可以轻松升级或降级，无需停机，管理也只需最少。我们可能会说我们希望他们是我们的奴才。在本文中，我们将通过一个简单的示例来了解 Kubernetes 通过创建和编排奴才大军可以为我们做些什么。您可以按照本文进行编码，也可以从此处克隆项目。"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.chensoul.cc/posts/2024/07/08/minions-in-minikube-a-kubernetes-intro-for-java-de/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-07-08T00:00:00+08:00"><meta property="article:modified_time" content="2024-07-08T00:00:00+08:00"><meta property="og:site_name" content="ChenSoul"><meta name=twitter:card content="summary"><meta name=twitter:title content="[译]Minikube 中的 Minions - 面向 Java 开发人员的 Kubernetes 简介"><meta name=twitter:description content="我们希望我们的微服务是可复制、可替换的工作程序，我们可以轻松升级或降级，无需停机，管理也只需最少。我们可能会说我们希望他们是我们的奴才。在本文中，我们将通过一个简单的示例来了解 Kubernetes 通过创建和编排奴才大军可以为我们做些什么。您可以按照本文进行编码，也可以从此处克隆项目。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.chensoul.cc/posts/"},{"@type":"ListItem","position":2,"name":"[译]Minikube 中的 Minions - 面向 Java 开发人员的 Kubernetes 简介","item":"https://blog.chensoul.cc/posts/2024/07/08/minions-in-minikube-a-kubernetes-intro-for-java-de/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[译]Minikube 中的 Minions - 面向 Java 开发人员的 Kubernetes 简介","name":"[译]Minikube 中的 Minions - 面向 Java 开发人员的 Kubernetes 简介","description":"我们希望我们的微服务是可复制、可替换的工作程序，我们可以轻松升级或降级，无需停机，管理也只需最少。我们可能会说我们希望他们是我们的奴才。在本文中，我们将通过一个简单的示例来了解 Kubernetes 通过创建和编排奴才大军可以为我们做些什么。您可以按照本文进行编码，也可以从此处克隆项目。\n","keywords":["kubernetes","minikube"],"articleBody":"我们希望我们的微服务是可复制、可替换的工作程序，我们可以轻松升级或降级，无需停机，管理也只需最少。我们可能会说我们希望他们是我们的奴才。在本文中，我们将通过一个简单的示例来了解 Kubernetes 通过创建和编排奴才大军可以为我们做些什么。您可以按照本文进行编码，也可以从此处克隆项目。\n先决条件 我们需要将微服务容器化，以便在 Kubernetes 中运行它们 — 我们将使用Docker来实现这一点。我们将使用Minikube，而不是使用云托管的 Kubernetes，这样我们就可以在本地进行沙盒处理。\n目的 我们的仆从大军将是 Java 微服务。我们希望我们的大军中有不同类型的仆从，这样我们才能看到 Kubernetes 能为我们做些什么。因此，我们的目标是让每个微服务都响应一个简单的 http 请求，响应如下：\n我们将使用 ASCII 艺术来代表仆从类型。\n构建Java Minion服务 我们可以使用带有 Web starter 依赖项的Spring Initializr 将我们的微服务作为 Spring Boot Web 应用程序启动：\n在项目中，我们将创建一个带注释的控制器来 @RestController 处理请求。我们将使用 @RequestMapping(method=GET) 来提供响应主体。因此，首先我们可以执行以下操作：\n1 2 3 4 5 6 7 @RequestMapping( method=GET) @ResponseBody public String minion() throws UnknownHostException { StringBuilder stringBuilder = new StringBuilder(); stringBuilder.append(\"Host: \").append(InetAddress.getLocalHost().getHostName()).append(\"\"); return stringBuilder.toString(); } 但这并不能完全满足我们的要求。我们可以在这里输出 ASCII 艺术，但是我们要选择哪种类型的 Minion？为此，我们可以使用一个技巧。我们将创建一个可以采用我们选择的任何 Minion 类型的应用程序。为此，我们需要它包含一个 ASCII 艺术 Minion 库。因此，我们创建了一个名为 MinionsLibrary 的类，我们用它来注释， @Component 并在其中创建一个映射，我们用来自此博客 的一些 Minion 来初始化它：\n1 2 3 4 5 6 7 8 9 10 11 @Component public class MinionsLibrary { private Map\u003cString,String\u003e map = new HashMap\u003c\u003e(); public MinionsLibrary(){ map.put(\"one-eyed-minion\",\u003cCOPY-PASTE MINION ASCII ART HERE\u003e); map.put(\"two-eyed-minion\",\u003cCOPY-PASTE MINION ASCII ART HERE\u003e); map.put(\"sad-minion\",\u003cCOPY-PASTE MINION ASCII ART HERE\u003e); map.put(\"happy-minion\",\u003cCOPY-PASTE MINION ASCII ART HERE\u003e); } } 或者，您可以从 https://github.com/ryandawsonuk/minions/tree/master/src/main/java/org/minions/demo 获取该类。\n然后我们可以告诉我们的微服务要使用哪种类型的 minion。我们可以使用 spring 应用程序名称属性（稍后我们将能够使用 docker 环境变量进行设置）来执行此操作。它还将帮助我们稍后在响应中显示应用程序的版本，因此现在我们的控制器变为：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 @RestController public class Controller { private final String version = \"0.1\"; private MinionsLibrary minionsLibrary; @Value(\"${spring.application.name}\") private String appName; public Controller(MinionsLibrary minionsLibrary){ this.minionsLibrary=minionsLibrary; } @RequestMapping( method=GET) @ResponseBody public String minion() throws UnknownHostException { StringBuilder stringBuilder = new StringBuilder(); stringBuilder.append(\"Host: \").append(InetAddress.getLocalHost().getHostName()).append(\"\"); stringBuilder.append(\"Minion Type: \").append(appName).append(\"\"); stringBuilder.append(\"IP: \").append(InetAddress.getLocalHost().getHostAddress()).append(\"\"); stringBuilder.append(\"Version: \").append(version).append(\"\"); stringBuilder.append(minionsLibrary.getMinion(appName)); return stringBuilder.toString(); } } 现在将选择库“image”来匹配应用程序名称，该名称将是minion类型名称（例如“one-eyed-minion”）。\nDocker 化和部署 我们需要为我们的应用程序创建一个 Docker 镜像。我们希望在 Docker 镜像中构建可执行 jar，然后在容器启动时启动 Java 应用程序。我们可以使用多阶段 Docker 构建来执行此操作。Dockerfile 是：\n1 2 3 4 5 6 7 8 FROM maven:3.5-jdk-8 as BUILDMINION COPY src /usr/src/myapp/src COPY pom.xml /usr/src/myapp RUN mvn -f /usr/src/myapp/pom.xml clean package -DskipTests FROM openjdk:alpine COPY --from=BUILDMINION /usr/src/myapp/target/*.jar /maven/ CMD java $JAVA_OPTS -jar maven/*.jar 直到“FROM openjdk:alpine”为止，所有步骤都会构建 JAR，然后只需将 jar 复制到基于轻量级 openjdk:alpine 映像的后续构建阶段即可。我们从公开的 JAVA_OPTS 参数开始，这样我们就可以选择限制内存消耗（请参阅有关减少内存消耗的文章）。\ndocker build . -t minion然后我们可以使用命令“ ”构建图像\n我们可以通过创建一个 Kubernetes 部署文件来部署它——我们称之为“minion-army.yml”。它将包含每个 minion 类型的条目。以下是一个 minion 类型的条目：\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 apiVersion: apps/v1beta1 kind: Deployment metadata: name: one-eyed-minion labels: serviceType: one-eyed-minion spec: replicas: 2 template: metadata: name: one-eyed-minion labels: serviceType: one-eyed-minion spec: containers: - name: one-eyed-minion image: minion:latest imagePullPolicy: Never ports: - containerPort: 8080 env: - name: JAVA_OPTS value: -Xmx64m -Xms64m - name: SPRING_APPLICATION_NAME value: \"one-eyed-minion\" --- apiVersion: v1 kind: Service metadata: name: one-eyed-minion-entrypoint namespace: default spec: selector: serviceType: one-eyed-minion ports: - port: 8080 targetPort: 8080 nodePort: 30080 type: NodePort 请注意，“SPRING_APPLICATION_NAME”变量会自动与 · 属性匹配，因此此 minion 服务将成为 one-eyed-minion。此 minion 类型将有两个实例（副本）可用，Kubernetes 服务将自动将请求路由到其中一个。\n该服务将暴露给 Kubernetes 之外的世界——使用 Minikube，对端口 30080 的请求将发送到该服务。（该服务的这一部分对于真正的 Kubernetes 来说会有所不同，因为我们将使用 LoadBalancer 而不是 NodePort，并且不会受限于 minikube 端口范围。）该服务将使用与该服务匹配的 Pod 来处理它。我们将为每种 minion 类型提供一个服务。\nMinion 类型的 Deployment 将创建两个 Pod。每个 Pod 都是该类型的 Minion。\n我们可以针对每种类型的 minion 重复上述配置，每次增加外部端口号，以便使用不同的端口。或者，我们可以使用此Github 存储库，它还具有额外的配置，可以在不停机的情况下进行 minion 版本升级。（如果我们使用 helm，我们可以避免此处的重复，但我们不想添加不必要的工具。）\n创建军队 首先启动minikube：\n1 minikube start --memory 4000 --cpus 3 等待它启动，然后将你的 Docker 注册表链接到 Minikube 注册表并为 Minikube 构建 minion 映像：\n1 2 eval $(minikube docker-env) docker build . -t minion 然后我们就可以部署军队：\n1 kubectl create -f minion-army.yml 查看部队类型：\n1 2 3 4 open http://$(minikube ip):30080 open http://$(minikube ip):30081 open http://$(minikube ip):30082 open http://$(minikube ip):30083 每个页面看起来都很像文章开头的 happy-minion 页面。\nkubectl get pods 我们可以通过执行“ ”或执行“ minikube dashboard”并进入 Pods 页面来查看整个军队 ：\n创造更多部队 我们可以在 minikube 仪表板的 Deployments 部分下创建更多特定类型的 minions：\n一个小兵倒下，另一个小兵接替他的位置 假设当我们从浏览器访问 Happy Minion 服务时，我们得到了以下结果：\n如果我们杀死“happy-minion-58c9c46d67-j84s9”会发生什么？我们可以尝试从仪表板的 Pods 部分删除，或者：\n1 kubectl delete pod happy-minion-58c9c46d67-j84s9 如果您在浏览器中多次点击刷新（可能需要一段时间才能杀死该 minion），您会看到该服务正在使用该类型的另一个 minion。如果您转到仪表板的 Pods 部分，您会看到 Kubernetes 创建了一个新的 Pod 来代替您删除的 Pod，这样该部署就剩下两个了。\n升级 Minion 我们还可以看到我们的 minions 上的滚动升级。为此，我们应该在 minions-army.yml 文件中的每个部署部分的“spec”部分下（它可以直接位于同一级别的“replicas”下方）包含以下内容：\n1 2 3 4 5 6 minReadySeconds: 10 strategy: type: RollingUpdate rollingUpdate: maxUnavailable: 1 maxSurge: 1 然后我们可以将Controller类中的版本改为0.2，保存然后执行：\n1 docker build . -t minion:0.2 然后打开 minion-army.yml 并查找并将所有“latest”替换为“0.2”。保存更改并执行以下操作：\n1 kubectl apply -f minion-army.yml --record 刷新其中一个 minion 类型的浏览器以查看版本变化，该变化与从 kubectl rollout status deploy 中看到的变化一致，其中 是一种 minion 类型（例如 one-eyed-minion）。\nMinion 回滚 要查看已部署的历史记录，请执行 kubectl rollout history deploy 并回滚，请执行 kubectl rollout undo deploy --to-revision=1 （可能需要一点时间）\n销毁军队 用以下方法消灭军队：\n1 kubectl delete -f minion-army.yml 使用“minikube stop”停止 minikube。\n原文链接：https://dzone.com/articles/minions-in-minikube-a-kubernetes-intro-for-java-de\n","wordCount":"2639","inLanguage":"en","datePublished":"2024-07-08T00:00:00+08:00","dateModified":"2024-07-08T00:00:00+08:00","author":{"@type":"Person","name":"chensoul"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.chensoul.cc/posts/2024/07/08/minions-in-minikube-a-kubernetes-intro-for-java-de/"},"publisher":{"@type":"Organization","name":"ChenSoul","logo":{"@type":"ImageObject","url":"https://blog.chensoul.cc/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.chensoul.cc/ accesskey=h title="ChenSoul (Alt + H)">ChenSoul</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.chensoul.cc/categories title=分类><span>分类</span></a></li><li><a href=https://blog.chensoul.cc/tags title=标签><span>标签</span></a></li><li><a href=https://blog.chensoul.cc/search title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li><li><a href=https://blog.chensoul.cc/index.xml title=订阅><span>订阅</span></a></li><li><a href=https://github.com/chensoul title=关于><span>关于</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">[译]Minikube 中的 Minions - 面向 Java 开发人员的 Kubernetes 简介</h1><div class=post-meta><span title='2024-07-08 00:00:00 +0800 CST'>2024-07-08</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;2639 words&nbsp;·&nbsp;chensoul</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e5%85%88%e5%86%b3%e6%9d%a1%e4%bb%b6 aria-label=先决条件>先决条件</a></li><li><a href=#%e7%9b%ae%e7%9a%84 aria-label=目的>目的</a></li><li><a href=#%e6%9e%84%e5%bb%bajava-minion%e6%9c%8d%e5%8a%a1 aria-label="构建Java Minion服务">构建Java Minion服务</a></li><li><a href=#docker-%e5%8c%96%e5%92%8c%e9%83%a8%e7%bd%b2 aria-label="Docker 化和部署">Docker 化和部署</a></li><li><a href=#%e5%88%9b%e5%bb%ba%e5%86%9b%e9%98%9f aria-label=创建军队>创建军队</a></li><li><a href=#%e5%88%9b%e9%80%a0%e6%9b%b4%e5%a4%9a%e9%83%a8%e9%98%9f aria-label=创造更多部队>创造更多部队</a></li><li><a href=#%e4%b8%80%e4%b8%aa%e5%b0%8f%e5%85%b5%e5%80%92%e4%b8%8b%e5%8f%a6%e4%b8%80%e4%b8%aa%e5%b0%8f%e5%85%b5%e6%8e%a5%e6%9b%bf%e4%bb%96%e7%9a%84%e4%bd%8d%e7%bd%ae aria-label=一个小兵倒下，另一个小兵接替他的位置>一个小兵倒下，另一个小兵接替他的位置</a></li><li><a href=#%e5%8d%87%e7%ba%a7-minion aria-label="升级 Minion">升级 Minion</a></li><li><a href=#minion-%e5%9b%9e%e6%bb%9a aria-label="Minion 回滚">Minion 回滚</a></li><li><a href=#%e9%94%80%e6%af%81%e5%86%9b%e9%98%9f aria-label=销毁军队>销毁军队</a></li></ul></div></details></div><div class=post-content><p>我们希望我们的微服务是可复制、可替换的工作程序，我们可以轻松升级或降级，无需停机，管理也只需最少。我们可能会说我们希望他们是我们的奴才。在本文中，我们将通过一个简单的示例来了解 Kubernetes 通过创建和编排奴才大军可以为我们做些什么。您可以按照本文进行编码，也可以从<a href=https://github.com/ryandawsonuk/minions/blob/master/minion-army.yml target=_blank>此处</a>克隆项目。</p><h2 id=先决条件>先决条件<a hidden class=anchor aria-hidden=true href=#先决条件>#</a></h2><p>我们需要将微服务容器化，以便在 Kubernetes 中运行它们 — 我们将使用Docker来实现这一点。我们将使用<a href=https://kubernetes.io/docs/tasks/tools/install-minikube/ target=_blank>Minikube</a>，而不是使用云托管的 Kubernetes，这样我们就可以在本地进行沙盒处理。</p><h2 id=目的>目的<a hidden class=anchor aria-hidden=true href=#目的>#</a></h2><p>我们的仆从大军将是 Java 微服务。我们希望我们的大军中有不同类型的仆从，这样我们才能看到 Kubernetes 能为我们做些什么。因此，我们的目标是让每个微服务都响应一个简单的 http 请求，响应如下：</p><p><img loading=lazy src=https://dz2cdn1.dzone.com/storage/temp/14049619-1602610139303.png alt=img></p><p>我们将使用 ASCII 艺术来代表仆从类型。</p><h2 id=构建java-minion服务>构建Java Minion服务<a hidden class=anchor aria-hidden=true href=#构建java-minion服务>#</a></h2><p>我们可以使用带有 Web starter 依赖项的<a href=https://start.spring.io/ target=_blank>Spring Initializr </a>将我们的微服务作为 Spring Boot Web 应用程序启动：</p><p><img loading=lazy src=https://dz2cdn1.dzone.com/storage/temp/14049621-1602610254793.png alt=img></p><p>在项目中，我们将创建一个带注释的控制器来 <code>@RestController</code> 处理请求。我们将使用 <code>@RequestMapping(method=GET)</code> 来提供响应主体。因此，首先我们可以执行以下操作：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@RequestMapping</span><span class=p>(</span><span class=w> </span><span class=n>method</span><span class=o>=</span><span class=n>GET</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@ResponseBody</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>minion</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>UnknownHostException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=n>StringBuilder</span><span class=w> </span><span class=n>stringBuilder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>StringBuilder</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=n>stringBuilder</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&#34;Host: &#34;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>InetAddress</span><span class=p>.</span><span class=na>getLocalHost</span><span class=p>().</span><span class=na>getHostName</span><span class=p>()).</span><span class=na>append</span><span class=p>(</span><span class=s>&#34;&lt;br/&gt;&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=k>return</span><span class=w> </span><span class=n>stringBuilder</span><span class=p>.</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>但这并不能完全满足我们的要求。我们可以在这里输出 ASCII 艺术，但是我们要选择哪种类型的 Minion？为此，我们可以使用一个技巧。我们将创建一个可以采用我们选择的任何 Minion 类型的应用程序。为此，我们需要它包含一个 ASCII 艺术 Minion 库。因此，我们创建了一个名为 MinionsLibrary 的类，我们用它来注释， <code>@Component</code> 并在其中创建一个映射，我们用来自此<a href=http://textart4u.blogspot.co.uk/2013/08/minions-emoticons-text-art-for-facebook.html target=_blank>博客</a> 的一些 Minion 来初始化它：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Component</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>MinionsLibrary</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=n>String</span><span class=o>&gt;</span><span class=w> </span><span class=n>map</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>MinionsLibrary</span><span class=p>(){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;one-eyed-minion&#34;</span><span class=p>,</span><span class=o>&lt;</span><span class=n>COPY</span><span class=o>-</span><span class=n>PASTE</span><span class=w> </span><span class=n>MINION</span><span class=w> </span><span class=n>ASCII</span><span class=w> </span><span class=n>ART</span><span class=w> </span><span class=n>HERE</span><span class=o>&gt;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;two-eyed-minion&#34;</span><span class=p>,</span><span class=o>&lt;</span><span class=n>COPY</span><span class=o>-</span><span class=n>PASTE</span><span class=w> </span><span class=n>MINION</span><span class=w> </span><span class=n>ASCII</span><span class=w> </span><span class=n>ART</span><span class=w> </span><span class=n>HERE</span><span class=o>&gt;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;sad-minion&#34;</span><span class=p>,</span><span class=o>&lt;</span><span class=n>COPY</span><span class=o>-</span><span class=n>PASTE</span><span class=w> </span><span class=n>MINION</span><span class=w> </span><span class=n>ASCII</span><span class=w> </span><span class=n>ART</span><span class=w> </span><span class=n>HERE</span><span class=o>&gt;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;happy-minion&#34;</span><span class=p>,</span><span class=o>&lt;</span><span class=n>COPY</span><span class=o>-</span><span class=n>PASTE</span><span class=w> </span><span class=n>MINION</span><span class=w> </span><span class=n>ASCII</span><span class=w> </span><span class=n>ART</span><span class=w> </span><span class=n>HERE</span><span class=o>&gt;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>或者，您可以从 <a href=https://github.com/ryandawsonuk/minions/tree/master/src/main/java/org/minions/demo target=_blank>https://github.com/ryandawsonuk/minions/tree/master/src/main/java/org/minions/demo</a> 获取该类。</p><p>然后我们可以告诉我们的微服务要使用哪种类型的 minion。我们可以使用 spring 应用程序名称属性（稍后我们将能够使用 docker 环境变量进行设置）来执行此操作。它还将帮助我们稍后在响应中显示应用程序的版本，因此现在我们的控制器变为：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@RestController</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Controller</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>version</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;0.1&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>MinionsLibrary</span><span class=w> </span><span class=n>minionsLibrary</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Value</span><span class=p>(</span><span class=s>&#34;${spring.application.name}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>appName</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=nf>Controller</span><span class=p>(</span><span class=n>MinionsLibrary</span><span class=w> </span><span class=n>minionsLibrary</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>minionsLibrary</span><span class=o>=</span><span class=n>minionsLibrary</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@RequestMapping</span><span class=p>(</span><span class=w> </span><span class=n>method</span><span class=o>=</span><span class=n>GET</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ResponseBody</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>minion</span><span class=p>()</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>UnknownHostException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>StringBuilder</span><span class=w> </span><span class=n>stringBuilder</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>StringBuilder</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>stringBuilder</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&#34;Host: &#34;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>InetAddress</span><span class=p>.</span><span class=na>getLocalHost</span><span class=p>().</span><span class=na>getHostName</span><span class=p>()).</span><span class=na>append</span><span class=p>(</span><span class=s>&#34;&lt;br/&gt;&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>stringBuilder</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&#34;Minion Type: &#34;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>appName</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=s>&#34;&lt;br/&gt;&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>stringBuilder</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&#34;IP: &#34;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>InetAddress</span><span class=p>.</span><span class=na>getLocalHost</span><span class=p>().</span><span class=na>getHostAddress</span><span class=p>()).</span><span class=na>append</span><span class=p>(</span><span class=s>&#34;&lt;br/&gt;&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>stringBuilder</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&#34;Version: &#34;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>version</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=s>&#34;&lt;br/&gt;&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>stringBuilder</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>minionsLibrary</span><span class=p>.</span><span class=na>getMinion</span><span class=p>(</span><span class=n>appName</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>stringBuilder</span><span class=p>.</span><span class=na>toString</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>现在将选择库“image”来匹配应用程序名称，该名称将是minion类型名称（例如“one-eyed-minion”）。</p><h2 id=docker-化和部署>Docker 化和部署<a hidden class=anchor aria-hidden=true href=#docker-化和部署>#</a></h2><p>我们需要为我们的应用程序创建一个 Docker 镜像。我们希望在 Docker 镜像中构建可执行 jar，然后在容器启动时启动 Java 应用程序。我们可以使用多阶段 Docker 构建来执行此操作。Dockerfile 是：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> maven:3.5-jdk-8 as BUILDMINION</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> src /usr/src/myapp/src<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> pom.xml /usr/src/myapp<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> mvn -f /usr/src/myapp/pom.xml clean package -DskipTests<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> openjdk:alpine</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>BUILDMINION /usr/src/myapp/target/*.jar /maven/<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> java <span class=nv>$JAVA_OPTS</span> -jar maven/*.jar<span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>直到“FROM openjdk:alpine”为止，所有步骤都会构建 JAR，然后只需将 jar 复制到基于轻量级 openjdk:alpine 映像的后续构建阶段即可。我们从公开的 <code>JAVA_OPTS</code> 参数开始，这样我们就可以选择限制内存消耗（请参阅有关减少内存消耗的<a href=https://dzone.com/articles/how-to-decrease-jvm-memory-consumption-in-docker-u target=_blank>文章</a>）。</p><p><code>docker build . -t minion</code>然后我们可以使用命令“ ”构建图像</p><p>我们可以通过创建一个 Kubernetes 部署文件来部署它——我们称之为“minion-army.yml”。它将包含每个 minion 类型的条目。以下是一个 minion 类型的条目：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>one-eyed-minion</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nt>serviceType</span><span class=p>:</span><span class=w> </span><span class=l>one-eyed-minion</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>one-eyed-minion</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=nt>serviceType</span><span class=p>:</span><span class=w> </span><span class=l>one-eyed-minion</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>one-eyed-minion</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>minion:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Never</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>JAVA_OPTS</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>           </span><span class=nt>value</span><span class=p>:</span><span class=w> </span>-<span class=l>Xmx64m -Xms64m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>SPRING_APPLICATION_NAME</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>           </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;one-eyed-minion&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>one-eyed-minion-entrypoint</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nt>serviceType</span><span class=p>:</span><span class=w> </span><span class=l>one-eyed-minion</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=nt>nodePort</span><span class=p>:</span><span class=w> </span><span class=m>30080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>NodePort</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>请注意，“SPRING_APPLICATION_NAME”变量会自动与 · 属性匹配，因此此 minion 服务将成为 one-eyed-minion。此 minion 类型将有两个实例（副本）可用，Kubernetes 服务将自动将请求路由到其中一个。</p><p>该服务将暴露给 Kubernetes 之外的世界——使用 Minikube，对端口 30080 的请求将发送到该服务。（该服务的这一部分对于真正的 Kubernetes 来说会有所不同，因为我们将使用 LoadBalancer 而不是 NodePort，并且不会受限于 minikube 端口范围。）该服务将使用与该服务匹配的 Pod 来处理它。我们将为每种 minion 类型提供一个服务。</p><p>Minion 类型的 Deployment 将创建两个 Pod。每个 Pod 都是该类型的 Minion。</p><p>我们可以针对每种类型的 minion 重复上述配置，每次增加外部端口号，以便使用不同的端口。或者，我们可以使用此<a href=https://github.com/ryandawsonuk/minions/blob/master/minion-army.yml target=_blank>Github 存储库</a>，它还具有额外的配置，可以在不停机的情况下进行 minion 版本升级。（如果我们使用 helm，我们可以避免此处的重复，但我们不想添加不必要的工具。）</p><h2 id=创建军队>创建军队<a hidden class=anchor aria-hidden=true href=#创建军队>#</a></h2><p>首先启动minikube：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>minikube start --memory <span class=m>4000</span> --cpus <span class=m>3</span>
</span></span></code></pre></td></tr></table></div></div><p>等待它启动，然后将你的 Docker 注册表链接到 Minikube 注册表并为 Minikube 构建 minion 映像：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>eval</span> <span class=k>$(</span>minikube docker-env<span class=k>)</span>
</span></span><span class=line><span class=cl>docker build . -t minion
</span></span></code></pre></td></tr></table></div></div><p>然后我们就可以部署军队：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl create -f minion-army.yml
</span></span></code></pre></td></tr></table></div></div><p>查看部队类型：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>open http://<span class=k>$(</span>minikube ip<span class=k>)</span>:30080
</span></span><span class=line><span class=cl>open http://<span class=k>$(</span>minikube ip<span class=k>)</span>:30081
</span></span><span class=line><span class=cl>open http://<span class=k>$(</span>minikube ip<span class=k>)</span>:30082
</span></span><span class=line><span class=cl>open http://<span class=k>$(</span>minikube ip<span class=k>)</span>:30083
</span></span></code></pre></td></tr></table></div></div><p>每个页面看起来都很像文章开头的 happy-minion 页面。</p><p><code>kubectl get pods</code> 我们可以通过执行“ ”或执行“ <code>minikube dashboard</code>”并进入 Pods 页面来查看整个军队 ：</p><p><img loading=lazy src=https://dz2cdn1.dzone.com/storage/temp/14049623-1602610290861.png alt=img></p><h2 id=创造更多部队>创造更多部队<a hidden class=anchor aria-hidden=true href=#创造更多部队>#</a></h2><p>我们可以在 minikube 仪表板的 Deployments 部分下创建更多特定类型的 minions：</p><p><img loading=lazy src=https://dz2cdn1.dzone.com/storage/temp/14049624-1602610317165.png alt=img></p><h2 id=一个小兵倒下另一个小兵接替他的位置>一个小兵倒下，另一个小兵接替他的位置<a hidden class=anchor aria-hidden=true href=#一个小兵倒下另一个小兵接替他的位置>#</a></h2><p>假设当我们从浏览器访问 Happy Minion 服务时，我们得到了以下结果：</p><p><img loading=lazy src=https://dz2cdn1.dzone.com/storage/temp/14049627-1602610353544.png alt=img></p><p>如果我们杀死“happy-minion-58c9c46d67-j84s9”会发生什么？我们可以尝试从仪表板的 Pods 部分删除，或者：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl delete pod happy-minion-58c9c46d67-j84s9
</span></span></code></pre></td></tr></table></div></div><p>如果您在浏览器中多次点击刷新（可能需要一段时间才能杀死该 minion），您会看到该服务正在使用该类型的另一个 minion。如果您转到仪表板的 Pods 部分，您会看到 Kubernetes 创建了一个新的 Pod 来代替您删除的 Pod，这样该部署就剩下两个了。</p><h2 id=升级-minion>升级 Minion<a hidden class=anchor aria-hidden=true href=#升级-minion>#</a></h2><p>我们还可以看到我们的 minions 上的滚动升级。为此，我们应该在 minions-army.yml 文件中的每个部署部分的“spec”部分下（它可以直接位于同一级别的“replicas”下方）包含以下内容：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>minReadySeconds</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>strategy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>RollingUpdate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nt>rollingUpdate</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=nt>maxUnavailable</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=nt>maxSurge</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>然后我们可以将Controller类中的版本改为0.2，保存然后执行：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker build . -t minion:0.2
</span></span></code></pre></td></tr></table></div></div><p>然后打开 minion-army.yml 并查找并将所有“latest”替换为“0.2”。保存更改并执行以下操作：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>kubectl apply -f minion-army.yml --record
</span></span></code></pre></td></tr></table></div></div><p>刷新其中一个 minion 类型的浏览器以查看版本变化，该变化与从 <code>kubectl rollout status deploy</code> 中看到的变化一致，其中 <code>&lt;deployment_name></code> 是一种 minion 类型（例如 <code>one-eyed-minion</code>）。</p><h2 id=minion-回滚>Minion 回滚<a hidden class=anchor aria-hidden=true href=#minion-回滚>#</a></h2><p>要查看已部署的历史记录，请执行 <code>kubectl rollout history deploy &lt;deployment_name></code>并回滚，请执行 <code>kubectl rollout undo deploy &lt;deployment_name> --to-revision=1</code> （可能需要一点时间）</p><h2 id=销毁军队>销毁军队<a hidden class=anchor aria-hidden=true href=#销毁军队>#</a></h2><p>用以下方法消灭军队：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl delete -f minion-army.yml
</span></span></code></pre></td></tr></table></div></div><p>使用“minikube stop”停止 minikube。</p><p>原文链接：<a href=https://dzone.com/articles/minions-in-minikube-a-kubernetes-intro-for-java-de target=_blank>https://dzone.com/articles/minions-in-minikube-a-kubernetes-intro-for-java-de</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.chensoul.cc/tags/kubernetes/>Kubernetes</a></li><li><a href=https://blog.chensoul.cc/tags/minikube/>Minikube</a></li></ul><nav class=paginav><a class=prev href=https://blog.chensoul.cc/posts/2024/07/09/docker-for-spring-boot/><span class=title>« Prev</span><br><span>使用 Docker 容器化并运行 Spring Boot 应用程序</span>
</a><a class=next href=https://blog.chensoul.cc/posts/2024/07/08/kubernetes-for-java-developers/><span class=title>Next »</span><br><span>[译]面向 Java 开发人员的 Kubernetes</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share [译]Minikube 中的 Minions - 面向 Java 开发人员的 Kubernetes 简介 on x" href="https://x.com/intent/tweet/?text=%5b%e8%af%91%5dMinikube%20%e4%b8%ad%e7%9a%84%20Minions%20-%20%e9%9d%a2%e5%90%91%20Java%20%e5%bc%80%e5%8f%91%e4%ba%ba%e5%91%98%e7%9a%84%20Kubernetes%20%e7%ae%80%e4%bb%8b&amp;url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f07%2f08%2fminions-in-minikube-a-kubernetes-intro-for-java-de%2f&amp;hashtags=kubernetes%2cminikube"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [译]Minikube 中的 Minions - 面向 Java 开发人员的 Kubernetes 简介 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f07%2f08%2fminions-in-minikube-a-kubernetes-intro-for-java-de%2f&amp;title=%5b%e8%af%91%5dMinikube%20%e4%b8%ad%e7%9a%84%20Minions%20-%20%e9%9d%a2%e5%90%91%20Java%20%e5%bc%80%e5%8f%91%e4%ba%ba%e5%91%98%e7%9a%84%20Kubernetes%20%e7%ae%80%e4%bb%8b&amp;summary=%5b%e8%af%91%5dMinikube%20%e4%b8%ad%e7%9a%84%20Minions%20-%20%e9%9d%a2%e5%90%91%20Java%20%e5%bc%80%e5%8f%91%e4%ba%ba%e5%91%98%e7%9a%84%20Kubernetes%20%e7%ae%80%e4%bb%8b&amp;source=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f07%2f08%2fminions-in-minikube-a-kubernetes-intro-for-java-de%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [译]Minikube 中的 Minions - 面向 Java 开发人员的 Kubernetes 简介 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f07%2f08%2fminions-in-minikube-a-kubernetes-intro-for-java-de%2f&title=%5b%e8%af%91%5dMinikube%20%e4%b8%ad%e7%9a%84%20Minions%20-%20%e9%9d%a2%e5%90%91%20Java%20%e5%bc%80%e5%8f%91%e4%ba%ba%e5%91%98%e7%9a%84%20Kubernetes%20%e7%ae%80%e4%bb%8b"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [译]Minikube 中的 Minions - 面向 Java 开发人员的 Kubernetes 简介 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f07%2f08%2fminions-in-minikube-a-kubernetes-intro-for-java-de%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [译]Minikube 中的 Minions - 面向 Java 开发人员的 Kubernetes 简介 on whatsapp" href="https://api.whatsapp.com/send?text=%5b%e8%af%91%5dMinikube%20%e4%b8%ad%e7%9a%84%20Minions%20-%20%e9%9d%a2%e5%90%91%20Java%20%e5%bc%80%e5%8f%91%e4%ba%ba%e5%91%98%e7%9a%84%20Kubernetes%20%e7%ae%80%e4%bb%8b%20-%20https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f07%2f08%2fminions-in-minikube-a-kubernetes-intro-for-java-de%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [译]Minikube 中的 Minions - 面向 Java 开发人员的 Kubernetes 简介 on telegram" href="https://telegram.me/share/url?text=%5b%e8%af%91%5dMinikube%20%e4%b8%ad%e7%9a%84%20Minions%20-%20%e9%9d%a2%e5%90%91%20Java%20%e5%bc%80%e5%8f%91%e4%ba%ba%e5%91%98%e7%9a%84%20Kubernetes%20%e7%ae%80%e4%bb%8b&amp;url=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f07%2f08%2fminions-in-minikube-a-kubernetes-intro-for-java-de%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [译]Minikube 中的 Minions - 面向 Java 开发人员的 Kubernetes 简介 on ycombinator" href="https://news.ycombinator.com/submitlink?t=%5b%e8%af%91%5dMinikube%20%e4%b8%ad%e7%9a%84%20Minions%20-%20%e9%9d%a2%e5%90%91%20Java%20%e5%bc%80%e5%8f%91%e4%ba%ba%e5%91%98%e7%9a%84%20Kubernetes%20%e7%ae%80%e4%bb%8b&u=https%3a%2f%2fblog.chensoul.cc%2fposts%2f2024%2f07%2f08%2fminions-in-minikube-a-kubernetes-intro-for-java-de%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://blog.chensoul.cc/>ChenSoul</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script async src=https://umami.chensoul.cc/random-string.js data-website-id=821c25f8-a31a-4607-92d7-91ee76843d00></script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>