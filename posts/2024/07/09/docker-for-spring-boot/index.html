<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>使用 Docker 容器化并运行 Spring Boot 应用程序 | ChenSoul</title>
<meta name=keywords content="spring-boot,docker"><meta name=description content="本文翻译自 Docker 官方网站的《Java language-specific guide》文章，并做了一些改动。
Java 入门指南教您如何使用 Docker 创建容器化的 Spring Boot 应用程序。在本模块中，您将学习如何：
使用 Maven 容器化并运行 Spring Boot 应用程序 设置本地开发环境以将数据库连接到容器，配置调试器，并使用 Compose Watch 进行实时重新加载 在容器内运行单元测试 使用 GitHub Actions 为应用程序配置 CI/CD 管道 将容器化应用程序本地部署到 Kubernetes 以测试和调试您的部署 完成 Java 入门模块后，您应该能够根据本指南中提供的示例和说明来容器化您自己的 Java 应用程序。
容器化你的应用 先决条件 您已安装最新版本的 Docker Desktop，Docker 会定期添加新功能，本指南的某些部分可能仅适用于最新版本的 Docker Desktop。
您有一个 Git 客户端。本节中的示例使用基于命令行的 Git 客户端，但您可以使用任何客户端。
获取示例应用程序 将要使用的示例应用程序克隆到本地开发机器。在终端中运行以下命令来克隆存储库。
$ git clone https://github.com/spring-projects/spring-petclinic.git $ cd spring-petclinic 初始化 Docker 资产 现在您有了一个应用程序，您可以使用它docker init来创建必要的 Docker 资产来容器化您的应用程序。在 spring-petclinic 中已包含 Docker 资产。系统将提示您覆盖现有 Docker 资产。要继续本指南，请选择y覆盖它们。
$ docker init Welcome to the Docker Init CLI! This utility will walk you through creating the following files with sensible defaults for your project: - .dockerignore - Dockerfile - compose."><meta name=author content="chensoul"><link rel=canonical href=https://blog.chensoul.cc/posts/2024/07/09/docker-for-spring-boot/><link crossorigin=anonymous href=/assets/css/stylesheet.min.d6db7ab468e55ea6647d68be426a17bae21ff1cddbf1741e547ed2086d010444.css integrity="sha256-1tt6tGjlXqZkfWi+QmoXuuIf8c3b8XQeVH7SCG0BBEQ=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.chensoul.cc/favicon.ico><link rel=apple-touch-icon href=https://blog.chensoul.cc/apple-touch-icon.png><link rel=alternate hreflang=en href=https://blog.chensoul.cc/posts/2024/07/09/docker-for-spring-boot/><meta name=twitter:title content="使用 Docker 容器化并运行 Spring Boot 应用程序 | ChenSoul"><meta name=twitter:description content="本文翻译自 Docker 官方网站的《Java language-specific guide》文章，并做了一些改动。
Java 入门指南教您如何使用 Docker 创建容器化的 Spring Boot 应用程序。在本模块中，您将学习如何：
使用 Maven 容器化并运行 Spring Boot 应用程序 设置本地开发环境以将数据库连接到容器，配置调试器，并使用 Compose Watch 进行实时重新加载 在容器内运行单元测试 使用 GitHub Actions 为应用程序配置 CI/CD 管道 将容器化应用程序本地部署到 Kubernetes 以测试和调试您的部署 完成 Java 入门模块后，您应该能够根据本指南中提供的示例和说明来容器化您自己的 Java 应用程序。
容器化你的应用 先决条件 您已安装最新版本的 Docker Desktop，Docker 会定期添加新功能，本指南的某些部分可能仅适用于最新版本的 Docker Desktop。
您有一个 Git 客户端。本节中的示例使用基于命令行的 Git 客户端，但您可以使用任何客户端。
获取示例应用程序 将要使用的示例应用程序克隆到本地开发机器。在终端中运行以下命令来克隆存储库。
$ git clone https://github.com/spring-projects/spring-petclinic.git $ cd spring-petclinic 初始化 Docker 资产 现在您有了一个应用程序，您可以使用它docker init来创建必要的 Docker 资产来容器化您的应用程序。在 spring-petclinic 中已包含 Docker 资产。系统将提示您覆盖现有 Docker 资产。要继续本指南，请选择y覆盖它们。
$ docker init Welcome to the Docker Init CLI! This utility will walk you through creating the following files with sensible defaults for your project: - .dockerignore - Dockerfile - compose."><meta property="og:title" content="使用 Docker 容器化并运行 Spring Boot 应用程序 | ChenSoul"><meta property="og:description" content="本文翻译自 Docker 官方网站的《Java language-specific guide》文章，并做了一些改动。
Java 入门指南教您如何使用 Docker 创建容器化的 Spring Boot 应用程序。在本模块中，您将学习如何：
使用 Maven 容器化并运行 Spring Boot 应用程序 设置本地开发环境以将数据库连接到容器，配置调试器，并使用 Compose Watch 进行实时重新加载 在容器内运行单元测试 使用 GitHub Actions 为应用程序配置 CI/CD 管道 将容器化应用程序本地部署到 Kubernetes 以测试和调试您的部署 完成 Java 入门模块后，您应该能够根据本指南中提供的示例和说明来容器化您自己的 Java 应用程序。
容器化你的应用 先决条件 您已安装最新版本的 Docker Desktop，Docker 会定期添加新功能，本指南的某些部分可能仅适用于最新版本的 Docker Desktop。
您有一个 Git 客户端。本节中的示例使用基于命令行的 Git 客户端，但您可以使用任何客户端。
获取示例应用程序 将要使用的示例应用程序克隆到本地开发机器。在终端中运行以下命令来克隆存储库。
$ git clone https://github.com/spring-projects/spring-petclinic.git $ cd spring-petclinic 初始化 Docker 资产 现在您有了一个应用程序，您可以使用它docker init来创建必要的 Docker 资产来容器化您的应用程序。在 spring-petclinic 中已包含 Docker 资产。系统将提示您覆盖现有 Docker 资产。要继续本指南，请选择y覆盖它们。
$ docker init Welcome to the Docker Init CLI! This utility will walk you through creating the following files with sensible defaults for your project: - .dockerignore - Dockerfile - compose."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.chensoul.cc/posts/2024/07/09/docker-for-spring-boot/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-07-09T16:00:00+08:00"><meta property="article:modified_time" content="2024-07-09T16:00:00+08:00"><meta property="og:site_name" content="ChenSoul"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.chensoul.cc/posts/"},{"@type":"ListItem","position":2,"name":"使用 Docker 容器化并运行 Spring Boot 应用程序","item":"https://blog.chensoul.cc/posts/2024/07/09/docker-for-spring-boot/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"使用 Docker 容器化并运行 Spring Boot 应用程序 | ChenSoul","name":"使用 Docker 容器化并运行 Spring Boot 应用程序","description":"本文翻译自 Docker 官方网站的《Java language-specific guide》文章，并做了一些改动。\nJava 入门指南教您如何使用 Docker 创建容器化的 Spring Boot 应用程序。在本模块中，您将学习如何：\n使用 Maven 容器化并运行 Spring Boot 应用程序 设置本地开发环境以将数据库连接到容器，配置调试器，并使用 Compose Watch 进行实时重新加载 在容器内运行单元测试 使用 GitHub Actions 为应用程序配置 CI/CD 管道 将容器化应用程序本地部署到 Kubernetes 以测试和调试您的部署 完成 Java 入门模块后，您应该能够根据本指南中提供的示例和说明来容器化您自己的 Java 应用程序。\n容器化你的应用 先决条件 您已安装最新版本的 Docker Desktop，Docker 会定期添加新功能，本指南的某些部分可能仅适用于最新版本的 Docker Desktop。\n您有一个 Git 客户端。本节中的示例使用基于命令行的 Git 客户端，但您可以使用任何客户端。\n获取示例应用程序 将要使用的示例应用程序克隆到本地开发机器。在终端中运行以下命令来克隆存储库。\n$ git clone https://github.com/spring-projects/spring-petclinic.git $ cd spring-petclinic 初始化 Docker 资产 现在您有了一个应用程序，您可以使用它docker init来创建必要的 Docker 资产来容器化您的应用程序。在 spring-petclinic 中已包含 Docker 资产。系统将提示您覆盖现有 Docker 资产。要继续本指南，请选择y覆盖它们。\n$ docker init Welcome to the Docker Init CLI! This utility will walk you through creating the following files with sensible defaults for your project: - .dockerignore - Dockerfile - compose.","keywords":["spring-boot","docker"],"wordCount":"1453","inLanguage":"en","datePublished":"2024-07-09T16:00:00+08:00","dateModified":"2024-07-09T16:00:00+08:00","author":[{"@type":"Person","name":"chensoul"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.chensoul.cc/posts/2024/07/09/docker-for-spring-boot/"},"publisher":{"@type":"Organization","name":"ChenSoul","logo":{"@type":"ImageObject","url":"https://blog.chensoul.cc/favicon.ico"}}}</script><meta name=baidu-site-verification content="codeva-FYpQY8JdLU"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary-bg:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list-page{background:var(--theme)}.list-page:not(.dark)::-webkit-scrollbar-track{background:0 0}.list-page:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript></head><body class="type-posts kind-page layout-" id=top><script data-no-instant>function switchTheme(e){switch(e){case"light":document.body.classList.remove("dark");break;case"dark":document.body.classList.add("dark");break;default:window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")}}function isDarkTheme(){return document.body.className.includes("dark")}function getPrefTheme(){return localStorage.getItem("pref-theme")}function setPrefTheme(e){switchTheme(e),localStorage.setItem("pref-theme",e)}const toggleThemeCallbacks={};toggleThemeCallbacks.main=e=>{setPrefTheme(e?"light":"dark")},window.addEventListener("toggle-theme",function(){const e=isDarkTheme();for(const t in toggleThemeCallbacks)toggleThemeCallbacks[t](e)});function toggleThemeListener(){window.dispatchEvent(new CustomEvent("toggle-theme"))}</script><script>(function(){const t="auto",e=getPrefTheme(),n=e||t;switchTheme(n)})()</script><header class=header><nav class=nav><div class=logo><a href=https://blog.chensoul.cc/ accesskey=h title="ChenSoul (Alt + H)">ChenSoul</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://blog.chensoul.cc/categories/review/ title=总结>总结</a></li><li><a href=https://blog.chensoul.cc/categories/ title=分类>分类</a></li><li><a href=https://blog.chensoul.cc/tags/ title=标签>标签</a></li><li><a href=https://github.com/chensoul/ title=关于 target=_blank>关于<span class=external-link><svg class="icon icon-tabler icon-tabler-external-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M11 7H6A2 2 0 004 9v9a2 2 0 002 2h9a2 2 0 002-2v-5"/><line x1="10" y1="14" x2="20" y2="4"/><polyline points="15 4 20 4 20 9"/></svg></span></a></li></ul></nav></header><main class="main post"><article class=post-single><header class=post-header><h1 class=post-title>使用 Docker 容器化并运行 Spring Boot 应用程序</h1><div class=post-meta><span class=meta-item><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg>
<span>2024-07-09</span></span><span class=meta-item>
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon" style="user-select:text"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z" style="user-select:text"/><line x1="7" y1="7" x2="7" y2="7" style="user-select:text"/></svg>
<span class=post-tags><a href=https://blog.chensoul.cc/tags/spring-boot/>Spring-Boot</a><a href=https://blog.chensoul.cc/tags/docker/>Docker</a></span></span><span class=meta-item>
<svg width="24" height="24" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>7 min</span></span></div></header><div class="toc side right"><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e5%ae%b9%e5%99%a8%e5%8c%96%e4%bd%a0%e7%9a%84%e5%ba%94%e7%94%a8 aria-label=容器化你的应用>容器化你的应用</a><ul><li><a href=#%e5%85%88%e5%86%b3%e6%9d%a1%e4%bb%b6 aria-label=先决条件>先决条件</a></li><li><a href=#%e8%8e%b7%e5%8f%96%e7%a4%ba%e4%be%8b%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f aria-label=获取示例应用程序>获取示例应用程序</a></li><li><a href=#%e5%88%9d%e5%a7%8b%e5%8c%96-docker-%e8%b5%84%e4%ba%a7 aria-label="初始化 Docker 资产">初始化 Docker 资产</a></li><li><a href=#%e8%bf%90%e8%a1%8c%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f aria-label=运行应用程序>运行应用程序</a></li><li><a href=#%e6%a6%82%e6%8b%ac aria-label=概括>概括</a></li></ul></li><li><a href=#%e4%bd%bf%e7%94%a8%e5%ae%b9%e5%99%a8%e8%bf%9b%e8%a1%8c-java-%e5%bc%80%e5%8f%91 aria-label="使用容器进行 Java 开发">使用容器进行 Java 开发</a><ul><li><a href=#%e6%b7%bb%e5%8a%a0%e6%9c%ac%e5%9c%b0%e6%95%b0%e6%8d%ae%e5%ba%93%e5%b9%b6%e4%bf%9d%e5%ad%98%e6%95%b0%e6%8d%ae aria-label=添加本地数据库并保存数据>添加本地数据库并保存数据</a></li><li><a href=#%e7%94%a8%e4%ba%8e%e5%bc%80%e5%8f%91%e7%9a%84-dockerfile aria-label="用于开发的 Dockerfile">用于开发的 Dockerfile</a></li><li><a href=#%e4%bd%bf%e7%94%a8-compose-%e8%bf%9b%e8%a1%8c%e6%9c%ac%e5%9c%b0%e5%bc%80%e5%8f%91 aria-label="使用 Compose 进行本地开发">使用 Compose 进行本地开发</a></li><li><a href=#%e8%bf%9e%e6%8e%a5%e8%b0%83%e8%af%95%e5%99%a8 aria-label=连接调试器>连接调试器</a></li><li><a href=#%e8%87%aa%e5%8a%a8%e6%9b%b4%e6%96%b0%e6%9c%8d%e5%8a%a1 aria-label=自动更新服务>自动更新服务</a></li><li><a href=#%e6%a6%82%e6%8b%ac-1 aria-label=概括>概括</a></li></ul></li><li><a href=#%e8%bf%90%e8%a1%8c-java-%e6%b5%8b%e8%af%95 aria-label="运行 Java 测试">运行 Java 测试</a><ul><li><a href=#%e6%a6%82%e8%bf%b0 aria-label=概述>概述</a></li><li><a href=#%e7%94%a8%e4%ba%8e%e6%b5%8b%e8%af%95%e7%9a%84%e5%a4%9a%e9%98%b6%e6%ae%b5-dockerfile aria-label="用于测试的多阶段 Dockerfile">用于测试的多阶段 Dockerfile</a></li><li><a href=#%e6%a6%82%e6%8b%ac-2 aria-label=概括>概括</a></li></ul></li><li><a href=#%e4%b8%ba-java-%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f%e9%85%8d%e7%bd%ae-cicd aria-label="为 Java 应用程序配置 CI/CD">为 Java 应用程序配置 CI/CD</a><ul><li><a href=#%e5%85%88%e5%86%b3%e6%9d%a1%e4%bb%b6-1 aria-label=先决条件>先决条件</a></li><li><a href=#%e6%a6%82%e8%bf%b0-1 aria-label=概述>概述</a></li><li><a href=#%e7%ac%ac%e4%b8%80%e6%ad%a5%e5%88%9b%e5%bb%ba%e5%ad%98%e5%82%a8%e5%ba%93 aria-label=第一步：创建存储库>第一步：创建存储库</a></li><li><a href=#%e7%ac%ac%e4%ba%8c%e6%ad%a5%e8%ae%be%e7%bd%ae%e5%b7%a5%e4%bd%9c%e6%b5%81%e7%a8%8b aria-label=第二步：设置工作流程>第二步：设置工作流程</a></li><li><a href=#%e7%ac%ac%e4%b8%89%e6%ad%a5%e8%bf%90%e8%a1%8c%e5%b7%a5%e4%bd%9c%e6%b5%81%e7%a8%8b aria-label=第三步：运行工作流程>第三步：运行工作流程</a></li><li><a href=#%e6%a6%82%e6%8b%ac-3 aria-label=概括>概括</a></li></ul></li><li><a href=#%e6%b5%8b%e8%af%95-kubernetes-%e9%83%a8%e7%bd%b2 aria-label="测试 Kubernetes 部署">测试 Kubernetes 部署</a><ul><li><a href=#%e5%85%88%e5%86%b3%e6%9d%a1%e4%bb%b6-2 aria-label=先决条件>先决条件</a></li><li><a href=#%e6%a6%82%e8%bf%b0-2 aria-label=概述>概述</a></li><li><a href=#%e5%88%9b%e5%bb%ba-kubernetes-yaml-%e6%96%87%e4%bb%b6 aria-label="创建 Kubernetes YAML 文件">创建 Kubernetes YAML 文件</a></li><li><a href=#%e9%83%a8%e7%bd%b2%e5%b9%b6%e6%a3%80%e6%9f%a5%e6%82%a8%e7%9a%84%e5%ba%94%e7%94%a8%e7%a8%8b%e5%ba%8f aria-label=部署并检查您的应用程序>部署并检查您的应用程序</a></li><li><a href=#%e6%a6%82%e6%8b%ac-4 aria-label=概括>概括</a></li></ul></li></ul></div></details></div><div class=post-content><blockquote><p>本文翻译自 Docker 官方网站的《<a href=https://docs.docker.com/language/java/>Java language-specific guide</a>》文章，并做了一些改动。</p></blockquote><p>Java 入门指南教您如何使用 Docker 创建容器化的 Spring Boot 应用程序。在本模块中，您将学习如何：</p><ul><li>使用 Maven 容器化并运行 Spring Boot 应用程序</li><li>设置本地开发环境以将数据库连接到容器，配置调试器，并使用 Compose Watch 进行实时重新加载</li><li>在容器内运行单元测试</li><li>使用 GitHub Actions 为应用程序配置 CI/CD 管道</li><li>将容器化应用程序本地部署到 Kubernetes 以测试和调试您的部署</li></ul><p>完成 Java 入门模块后，您应该能够根据本指南中提供的示例和说明来容器化您自己的 Java 应用程序。</p><h1 id=容器化你的应用>容器化你的应用</h1><h2 id=先决条件>先决条件</h2><ul><li><p>您已安装最新版本的 <a href=https://docs.docker.com/get-docker/>Docker Desktop</a>，Docker 会定期添加新功能，本指南的某些部分可能仅适用于最新版本的 Docker Desktop。</p></li><li><p>您有一个 <a href=https://git-scm.com/downloads>Git 客户端</a>。本节中的示例使用基于命令行的 Git 客户端，但您可以使用任何客户端。</p></li></ul><h2 id=获取示例应用程序>获取示例应用程序</h2><p>将要使用的示例应用程序克隆到本地开发机器。在终端中运行以下命令来克隆存储库。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ git clone https://github.com/spring-projects/spring-petclinic.git
</span></span><span class=line><span class=cl>$ <span class=nb>cd</span> spring-petclinic
</span></span></code></pre></div><h2 id=初始化-docker-资产>初始化 Docker 资产</h2><p>现在您有了一个应用程序，您可以使用它<code>docker init</code>来创建必要的 Docker 资产来容器化您的应用程序。在 spring-petclinic 中已包含 Docker 资产。系统将提示您覆盖现有 Docker 资产。要继续本指南，请选择<code>y</code>覆盖它们。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker init
</span></span><span class=line><span class=cl>Welcome to the Docker Init CLI!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>This utility will walk you through creating the following files with sensible defaults <span class=k>for</span> your project:
</span></span><span class=line><span class=cl>  - .dockerignore
</span></span><span class=line><span class=cl>  - Dockerfile
</span></span><span class=line><span class=cl>  - compose.yaml
</span></span><span class=line><span class=cl>  - README.Docker.md
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Let<span class=s1>&#39;s get started!
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>WARNING: The following Docker files already exist in this directory:
</span></span></span><span class=line><span class=cl><span class=s1>  - docker-compose.yml
</span></span></span><span class=line><span class=cl><span class=s1>? Do you want to overwrite them? Yes
</span></span></span><span class=line><span class=cl><span class=s1>? What application platform does your project use? Java
</span></span></span><span class=line><span class=cl><span class=s1>? What&#39;</span>s the relative directory <span class=o>(</span>with a leading .<span class=o>)</span> <span class=k>for</span> your app? ./src
</span></span><span class=line><span class=cl>? What version of Java <span class=k>do</span> you want to use? <span class=m>21</span>
</span></span><span class=line><span class=cl>? What port does your server listen on? <span class=m>8080</span>
</span></span></code></pre></div><p>您的目录中现在应该有以下三个新文件<code>spring-petclinic</code> 。</p><ul><li><a href=https://docs.docker.com/reference/dockerfile/>Dockerfile</a></li><li><a href=https://docs.docker.com/reference/dockerfile/#dockerignore-file>.dockerignore</a></li><li><a href=https://docs.docker.com/compose/compose-file/>docker-compose.yaml</a></li></ul><h2 id=运行应用程序>运行应用程序</h2><p>在目录内<code>spring-petclinic</code>，在终端运行以下命令。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker compose up --build
</span></span></code></pre></div><p>首次构建并运行应用程序时，Docker 会下载依赖项并构建应用程序。这可能需要几分钟，具体取决于您的网络连接。</p><p>打开浏览器并通过 <a href=http://localhost:8080/>http://localhost:8080</a>查看应用程序。您应该看到一个宠物诊所的简单应用程序。</p><p>在终端中，按<code>ctrl</code>+<code>c</code>停止应用程序。</p><p>您可以通过添加选项来运行与终端分离的应用程序<code>-d</code> 。在<code>spring-petclinic</code>目录中，在终端中运行以下命令。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker compose up --build -d
</span></span></code></pre></div><p>打开浏览器并通过 <a href=http://localhost:8080/>http://localhost:8080</a>查看应用程序。您应该看到一个宠物诊所的简单应用程序。</p><p>在终端中，运行以下命令来停止应用程序。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker compose down
</span></span></code></pre></div><p>有关 Compose 命令的更多信息，请参阅 <a href=https://docs.docker.com/compose/reference/>Compose CLI 参考</a>。</p><h2 id=概括>概括</h2><p>在本节中，您了解了如何使用 Docker 容器化并运行 Java 应用程序。</p><p>相关信息：</p><ul><li><a href=https://docs.docker.com/reference/cli/docker/init/>docker init 参考</a></li></ul><h1 id=使用容器进行-java-开发>使用容器进行 Java 开发</h1><p>在本部分中，您将逐步为上一节中容器化的应用程序设置本地开发环境。这包括：</p><ul><li>添加本地数据库并持久保存数据</li><li>创建开发容器来连接调试器</li><li>配置 Compose 以在您编辑和保存代码时自动更新正在运行的 Compose 服务</li></ul><h2 id=添加本地数据库并保存数据>添加本地数据库并保存数据</h2><p>您可以使用容器来设置本地服务，例如数据库。在本部分中，您将更新文件<code>docker-compose.yaml</code>以定义数据库服务和用于保存数据的卷。此外，此特定应用程序使用系统属性来定义数据库类型，因此您需要更新以<code>Dockerfile</code>在启动应用程序时传入系统属性。</p><p>在克隆的存储库的目录中，<code>docker-compose.yaml</code>在 IDE 或文本编辑器中打开文件。<code>docker init</code>添加了一个示例数据库服务，但它需要针对您的独特应用程序进行一些更改。</p><p>在该<code>docker-compose.yaml</code>文件中，您需要执行以下操作：</p><ul><li>取消注释所有数据库指令。现在您将使用数据库服务而不是本地存储来存储数据。</li><li>删除顶级<code>secrets</code>元素以及<code>db</code> 服务内的元素。此示例使用环境变量作为密码而不是机密。</li><li><code>user</code>从服务中删除元素<code>db</code>。此示例在环境变量中指定用户。</li><li>更新数据库环境变量。这些由 Postgres 镜像定义。有关更多详细信息，请参阅 <a href=https://hub.docker.com/_/postgres>Postgres 官方 Docker 镜像</a>。</li><li>更新服务的健康检查测试<code>db</code>并指定用户。默认情况下，健康检查使用 root 用户，而不是<code>petclinic</code>您定义的用户。</li><li>将数据库 URL 添加为服务中的环境变量<code>server</code>。这将覆盖 中定义的默认值 <code>spring-petclinic/src/main/resources/application-postgres.properties</code>。</li></ul><p>以下是更新后的<code>compose.yaml</code>文件。所有注释均已删除。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>server</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=l>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>8080</span><span class=p>:</span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>db</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class=l>service_healthy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>POSTGRES_URL=jdbc:postgresql://db:5432/petclinic</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>db</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>postgres</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>db-data:/var/lib/postgresql/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>POSTGRES_DB=petclinic</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>POSTGRES_USER=petclinic</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>POSTGRES_PASSWORD=petclinic</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>5432</span><span class=p>:</span><span class=m>5432</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>healthcheck</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=s2>&#34;CMD&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;pg_isready&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;-U&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;petclinic&#34;</span><span class=w> </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class=l>5s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>db-data</span><span class=p>:</span><span class=w>
</span></span></span></code></pre></div><p><code>Dockerfile</code>在 IDE 或文本编辑器中打开。在<code>ENTRYPOINT</code>指令中，更新指令以传入 <code>spring-petclinic/src/resources/db/postgres/petclinic_db_setup_postgres.txt</code> 文件中指定的系统属性。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl><span class=gd>- ENTRYPOINT [ &#34;java&#34;, &#34;org.springframework.boot.loader.launch.JarLauncher&#34; ]
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+ ENTRYPOINT [ &#34;java&#34;, &#34;-Dspring.profiles.active=postgres&#34;, &#34;org.springframework.boot.loader.launch.JarLauncher&#34; ]
</span></span></span></code></pre></div><p>保存并关闭所有文件。</p><p>现在，运行以下<code>docker compose up</code>命令来启动您的应用程序。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> docker compose up --build
</span></span></code></pre></div><p>打开浏览器并通过 <a href=http://localhost:8080/>http://localhost:8080</a>查看应用程序。您应该看到一个宠物诊所的简单应用程序。</p><p>在终端中，按<code>ctrl</code>+<code>c</code>停止应用程序。</p><h2 id=用于开发的-dockerfile>用于开发的 Dockerfile</h2><p>您现在拥有的 Dockerfile 非常适合小型、安全的生产映像，其中仅包含运行应用程序所需的组件。在开发时，您可能需要具有不同环境的其他映像。</p><p>例如，在开发图像中，您可能希望设置图像来启动应用程序，以便您可以将调试器连接到正在运行的 Java 进程。</p><p>您无需管理多个 Dockerfile，只需添加一个新阶段即可。然后，您的 Dockerfile 可以生成可用于生产的最终映像以及开发映像。</p><p>将 Dockerfile 的内容替换为以下内容。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=c># syntax=docker/dockerfile:1</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># https://docs.docker.com/reference/dockerfile/</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># https://docs.docker.com/build/guide/multi-stage/</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> maven:3-eclipse-temurin-21-alpine AS base</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /build</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> ./src src/<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> sed -i -E <span class=s1>&#39;159a &lt;mirror&gt;\n&lt;id&gt;aliyun&lt;/id&gt;\n&lt;name&gt;Aliyun Mirror&lt;/name&gt;\n&lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt;\n&lt;mirrorOf&gt;central&lt;/mirrorOf&gt;\n&lt;/mirror&gt;&#39;</span> /usr/share/maven/conf/settings.xml<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> base AS package</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /build</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> --mount<span class=o>=</span><span class=nv>type</span><span class=o>=</span>bind,source<span class=o>=</span>pom.xml,target<span class=o>=</span>pom.xml <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --mount<span class=o>=</span><span class=nv>type</span><span class=o>=</span>cache,target<span class=o>=</span>/root/.m2 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    mvn package -DskipTests <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    mv target/<span class=k>$(</span>mvn help:evaluate -Dexpression<span class=o>=</span>project.artifactId -q -DforceStdout<span class=k>)</span>-<span class=k>$(</span>mvn help:evaluate -Dexpression<span class=o>=</span>project.version -q -DforceStdout<span class=k>)</span>.jar target/app.jar<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> package AS extract</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /build</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> java -Djarmode<span class=o>=</span>layertools -jar target/app.jar extract --destination target/extracted<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> eclipse-temurin:21-jre-jammy AS final</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># See https://docs.docker.com/go/dockerfile-user-best-practices/</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ARG</span> <span class=nv>UID</span><span class=o>=</span><span class=m>10001</span>
</span></span><span class=line><span class=cl><span class=k>RUN</span> adduser <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --disabled-password <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --gecos <span class=s2>&#34;&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --home <span class=s2>&#34;/nonexistent&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --shell <span class=s2>&#34;/sbin/nologin&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --no-create-home <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --uid <span class=s2>&#34;</span><span class=si>${</span><span class=nv>UID</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    appuser<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>USER</span><span class=s> appuser</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>extract /build/target/extracted/dependencies/ ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>extract /build/target/extracted/spring-boot-loader/ ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>extract /build/target/extracted/snapshot-dependencies/ ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>extract /build/target/extracted/application/ ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 8080</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENTRYPOINT</span> <span class=p>[</span> <span class=s2>&#34;java&#34;</span><span class=p>,</span> <span class=s2>&#34;-Dspring.profiles.active=postgres&#34;</span><span class=p>,</span> <span class=s2>&#34;org.springframework.boot.loader.launch.JarLauncher&#34;</span> <span class=p>]</span><span class=err>
</span></span></span></code></pre></div><p>保存并关闭<code>Dockerfile</code>。</p><h2 id=使用-compose-进行本地开发>使用 Compose 进行本地开发</h2><p>当前 Compose 文件无法启动您的开发容器。为此，您必须更新 Compose 文件以定位开发阶段。此外，更新服务器服务的端口映射以提供对调试器的访问权限。</p><p><code>petclinic</code>在 IDE 或文本编辑器中 打开并创建一个名为 <code>docker-compose.dev.yml</code> 的新文件。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>server</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=l>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>target</span><span class=p>:</span><span class=w> </span><span class=l>development</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>8080</span><span class=p>:</span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>8000</span><span class=p>:</span><span class=m>8000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>db</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class=l>service_healthy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>POSTGRES_URL=jdbc:postgresql://db:5432/petclinic</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>db</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>postgres</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>db-data:/var/lib/postgresql/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>POSTGRES_DB=petclinic</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>POSTGRES_USER=petclinic</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>POSTGRES_PASSWORD=petclinic</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>5432</span><span class=p>:</span><span class=m>5432</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>healthcheck</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=s2>&#34;CMD&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;pg_isready&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;-U&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;petclinic&#34;</span><span class=w> </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class=l>5s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>db-data</span><span class=p>:</span><span class=w>
</span></span></span></code></pre></div><p>现在，启动您的应用程序并确认它正在运行。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker compose up --build
</span></span></code></pre></div><p>最后，测试您的 API 端点。运行以下 curl 命令：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ curl  --request GET <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --url http://localhost:8080/vets <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --header <span class=s1>&#39;content-type: application/json&#39;</span>
</span></span></code></pre></div><p>您应该收到以下回复：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;vetList&#34;</span><span class=p>:[{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=mi>1</span><span class=p>,</span><span class=nt>&#34;firstName&#34;</span><span class=p>:</span><span class=s2>&#34;James&#34;</span><span class=p>,</span><span class=nt>&#34;lastName&#34;</span><span class=p>:</span><span class=s2>&#34;Carter&#34;</span><span class=p>,</span><span class=nt>&#34;specialties&#34;</span><span class=p>:[],</span><span class=nt>&#34;nrOfSpecialties&#34;</span><span class=p>:</span><span class=mi>0</span><span class=p>,</span><span class=nt>&#34;new&#34;</span><span class=p>:</span><span class=kc>false</span><span class=p>},{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&#34;firstName&#34;</span><span class=p>:</span><span class=s2>&#34;Helen&#34;</span><span class=p>,</span><span class=nt>&#34;lastName&#34;</span><span class=p>:</span><span class=s2>&#34;Leary&#34;</span><span class=p>,</span><span class=nt>&#34;specialties&#34;</span><span class=p>:[{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=mi>1</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;radiology&#34;</span><span class=p>,</span><span class=nt>&#34;new&#34;</span><span class=p>:</span><span class=kc>false</span><span class=p>}],</span><span class=nt>&#34;nrOfSpecialties&#34;</span><span class=p>:</span><span class=mi>1</span><span class=p>,</span><span class=nt>&#34;new&#34;</span><span class=p>:</span><span class=kc>false</span><span class=p>},{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=mi>3</span><span class=p>,</span><span class=nt>&#34;firstName&#34;</span><span class=p>:</span><span class=s2>&#34;Linda&#34;</span><span class=p>,</span><span class=nt>&#34;lastName&#34;</span><span class=p>:</span><span class=s2>&#34;Douglas&#34;</span><span class=p>,</span><span class=nt>&#34;specialties&#34;</span><span class=p>:[{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=mi>3</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;dentistry&#34;</span><span class=p>,</span><span class=nt>&#34;new&#34;</span><span class=p>:</span><span class=kc>false</span><span class=p>},{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;surgery&#34;</span><span class=p>,</span><span class=nt>&#34;new&#34;</span><span class=p>:</span><span class=kc>false</span><span class=p>}],</span><span class=nt>&#34;nrOfSpecialties&#34;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&#34;new&#34;</span><span class=p>:</span><span class=kc>false</span><span class=p>},{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=mi>4</span><span class=p>,</span><span class=nt>&#34;firstName&#34;</span><span class=p>:</span><span class=s2>&#34;Rafael&#34;</span><span class=p>,</span><span class=nt>&#34;lastName&#34;</span><span class=p>:</span><span class=s2>&#34;Ortega&#34;</span><span class=p>,</span><span class=nt>&#34;specialties&#34;</span><span class=p>:[{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=mi>2</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;surgery&#34;</span><span class=p>,</span><span class=nt>&#34;new&#34;</span><span class=p>:</span><span class=kc>false</span><span class=p>}],</span><span class=nt>&#34;nrOfSpecialties&#34;</span><span class=p>:</span><span class=mi>1</span><span class=p>,</span><span class=nt>&#34;new&#34;</span><span class=p>:</span><span class=kc>false</span><span class=p>},{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=mi>5</span><span class=p>,</span><span class=nt>&#34;firstName&#34;</span><span class=p>:</span><span class=s2>&#34;Henry&#34;</span><span class=p>,</span><span class=nt>&#34;lastName&#34;</span><span class=p>:</span><span class=s2>&#34;Stevens&#34;</span><span class=p>,</span><span class=nt>&#34;specialties&#34;</span><span class=p>:[{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=mi>1</span><span class=p>,</span><span class=nt>&#34;name&#34;</span><span class=p>:</span><span class=s2>&#34;radiology&#34;</span><span class=p>,</span><span class=nt>&#34;new&#34;</span><span class=p>:</span><span class=kc>false</span><span class=p>}],</span><span class=nt>&#34;nrOfSpecialties&#34;</span><span class=p>:</span><span class=mi>1</span><span class=p>,</span><span class=nt>&#34;new&#34;</span><span class=p>:</span><span class=kc>false</span><span class=p>},{</span><span class=nt>&#34;id&#34;</span><span class=p>:</span><span class=mi>6</span><span class=p>,</span><span class=nt>&#34;firstName&#34;</span><span class=p>:</span><span class=s2>&#34;Sharon&#34;</span><span class=p>,</span><span class=nt>&#34;lastName&#34;</span><span class=p>:</span><span class=s2>&#34;Jenkins&#34;</span><span class=p>,</span><span class=nt>&#34;specialties&#34;</span><span class=p>:[],</span><span class=nt>&#34;nrOfSpecialties&#34;</span><span class=p>:</span><span class=mi>0</span><span class=p>,</span><span class=nt>&#34;new&#34;</span><span class=p>:</span><span class=kc>false</span><span class=p>}]}</span>
</span></span></code></pre></div><h2 id=连接调试器>连接调试器</h2><p>您将使用 IntelliJ IDEA 自带的调试器。您可以使用此 IDE 的社区版本。在 IntelliJ IDEA 中打开您的项目，转到**“运行”<strong>菜单，然后</strong>转到“编辑配置”**。添加类似于以下内容的新远程 JVM 调试配置：</p><p><img loading=lazy src=https://docs.docker.com/language/java/images/connect-debugger.webp alt="Java 连接调试器"></p><p>设置断点。</p><p>打开<code>src/main/java/org/springframework/samples/petclinic/vet/VetController.java</code>并在函数内部添加断点<code>showResourcesVetList</code>。</p><p>要启动调试会话，请选择<strong>运行</strong>菜单，然后<strong>选择调试*NameOfYourConfiguration*</strong>。</p><p><img loading=lazy src=https://docs.docker.com/language/java/images/debug-menu.webp alt=调试菜单></p><p>您现在应该可以在 Compose 应用程序的日志中看到该连接。</p><p><img loading=lazy src=https://docs.docker.com/language/java/images/compose-logs.webp alt=撰写日志文件></p><p>您现在可以调用服务器端点。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ curl --request GET --url http://localhost:8080/vets
</span></span></code></pre></div><p>您应该已经看到代码在标记的行上中断，现在您可以像平常一样使用调试器。您还可以检查和观察变量、设置条件断点、查看堆栈跟踪以及执行许多其他操作。</p><p><img loading=lazy src=https://docs.docker.com/language/java/images/debugger-breakpoint.webp alt=调试器代码断点></p><p>按下<code>ctrl+c</code>终端即可停止您的应用程序。</p><h2 id=自动更新服务>自动更新服务</h2><p>使用 Compose Watch 可在您编辑和保存代码时自动更新正在运行的 Compose 服务。有关 Compose Watch 的更多详细信息，请参阅 <a href=https://docs.docker.com/compose/file-watch/>使用 Compose Watch</a>。</p><p>在 IDE 或文本编辑器中打开您的<code>docker-compose.yaml</code>文件，然后添加 Compose Watch 指令。以下是更新后的<code>docker-compose.yaml</code> 文件。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>server</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class=l>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>target</span><span class=p>:</span><span class=w> </span><span class=l>development</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>8080</span><span class=p>:</span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>8000</span><span class=p>:</span><span class=m>8000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>db</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class=l>service_healthy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>POSTGRES_URL=jdbc:postgresql://db:5432/petclinic</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>develop</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>watch</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>action</span><span class=p>:</span><span class=w> </span><span class=l>rebuild</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>db</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>postgres</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>db-data:/var/lib/postgresql/data</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>POSTGRES_DB=petclinic</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>POSTGRES_USER=petclinic</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>POSTGRES_PASSWORD=petclinic</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=m>5432</span><span class=p>:</span><span class=m>5432</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>healthcheck</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=s2>&#34;CMD&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;pg_isready&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;-U&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;petclinic&#34;</span><span class=w> </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class=l>10s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class=l>5s</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>db-data</span><span class=p>:</span><span class=w>
</span></span></span></code></pre></div><p>运行以下命令以使用 Compose Watch 运行您的应用程序。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker compose watch
</span></span></code></pre></div><p>打开 Web 浏览器并通过 http://localhost:8080 查看应用程序 。您应该会看到 Spring Pet Clinic 主页。</p><p>现在，对本地计算机上应用程序源文件的任何更改都将自动反映在正在运行的容器中。</p><p><code>spring-petclinic/src/main/resources/templates/fragments/layout.html</code>在 IDE 或文本编辑器中打开并<code>Home</code>通过添加感叹号来更新导航字符串。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl><span class=gd>-   &lt;li th:replace=&#34;~{::menuItem (&#39;/&#39;,&#39;home&#39;,&#39;home page&#39;,&#39;home&#39;,&#39;Home&#39;)}&#34;&gt;
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   &lt;li th:replace=&#34;~{::menuItem (&#39;/&#39;,&#39;home&#39;,&#39;home page&#39;,&#39;home&#39;,&#39;Home!&#39;)}&#34;&gt;
</span></span></span></code></pre></div><p>保存更改<code>layout.html</code>，然后您可以在容器自动重建时继续开发。</p><p>容器重建并运行后，刷新 <a href=http://localhost:8080/>http://localhost:8080</a>，然后验证 **Home！**现在是否出现在菜单中。</p><p>按下<code>ctrl+c</code>终端即可停止 Compose Watch。</p><h2 id=概括-1>概括</h2><p>在本部分中，您了解了如何在本地运行数据库并持久保存数据。您还创建了一个包含 JDK 的开发映像，并允许您附加调试器。最后，您设置了 Compose 文件以公开调试端口，并配置了 Compose Watch 以实时重新加载您的更改。</p><p>相关信息：</p><ul><li><a href=https://docs.docker.com/compose/compose-file/>Compose file reference</a></li><li><a href=https://docs.docker.com/compose/file-watch/>Compose Watch</a></li><li><a href=https://docs.docker.com/reference/dockerfile/>Dockerfile reference</a></li></ul><h1 id=运行-java-测试>运行 Java 测试</h1><h2 id=概述>概述</h2><p>测试是现代软件开发的重要组成部分。测试对不同的开发团队来说可能意味着很多事情。有单元测试、集成测试和端到端测试。在本指南中，您将了解如何在 Docker 中运行单元测试。</p><h2 id=用于测试的多阶段-dockerfile>用于测试的多阶段 Dockerfile</h2><p>在以下示例中，您将把测试命令拉入 Dockerfile。将 Dockerfile 的内容替换为以下内容。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=c># syntax=docker/dockerfile:1</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># https://docs.docker.com/reference/dockerfile/</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># https://docs.docker.com/build/guide/multi-stage/</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> maven:3-eclipse-temurin-21-alpine AS base</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /build</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> ./src src/<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> sed -i -E <span class=s1>&#39;159a &lt;mirror&gt;\n&lt;id&gt;aliyun&lt;/id&gt;\n&lt;name&gt;Aliyun Mirror&lt;/name&gt;\n&lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt;\n&lt;mirrorOf&gt;central&lt;/mirrorOf&gt;\n&lt;/mirror&gt;&#39;</span> /usr/share/maven/conf/settings.xml<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> base AS test</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /build</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> --mount<span class=o>=</span><span class=nv>type</span><span class=o>=</span>bind,source<span class=o>=</span>pom.xml,target<span class=o>=</span>pom.xml <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --mount<span class=o>=</span><span class=nv>type</span><span class=o>=</span>cache,target<span class=o>=</span>/root/.m2 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    mvn test<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> base AS package</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /build</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> --mount<span class=o>=</span><span class=nv>type</span><span class=o>=</span>bind,source<span class=o>=</span>pom.xml,target<span class=o>=</span>pom.xml <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --mount<span class=o>=</span><span class=nv>type</span><span class=o>=</span>cache,target<span class=o>=</span>/root/.m2 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    mvn package -DskipTests <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    mv target/<span class=k>$(</span>mvn help:evaluate -Dexpression<span class=o>=</span>project.artifactId -q -DforceStdout<span class=k>)</span>-<span class=k>$(</span>mvn help:evaluate -Dexpression<span class=o>=</span>project.version -q -DforceStdout<span class=k>)</span>.jar target/app.jar<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> package AS extract</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /build</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> java -Djarmode<span class=o>=</span>layertools -jar target/app.jar extract --destination target/extracted<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> extract AS development</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /build</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> cp -r /build/target/extracted/dependencies/. ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> cp -r /build/target/extracted/spring-boot-loader/. ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> cp -r /build/target/extracted/snapshot-dependencies/. ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> cp -r /build/target/extracted/application/. ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> <span class=p>[</span> <span class=s2>&#34;java&#34;</span><span class=p>,</span> <span class=s2>&#34;-Dspring-boot.run.jvmArguments=&#39;-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:8000&#39;&#34;</span><span class=p>,</span> <span class=s2>&#34;org.springframework.boot.loader.launch.JarLauncher&#34;</span> <span class=p>]</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> eclipse-temurin:21-jre-jammy AS final</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /app</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># See https://docs.docker.com/go/dockerfile-user-best-practices/</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ARG</span> <span class=nv>UID</span><span class=o>=</span><span class=m>10001</span>
</span></span><span class=line><span class=cl><span class=k>RUN</span> adduser <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --disabled-password <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --gecos <span class=s2>&#34;&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --home <span class=s2>&#34;/nonexistent&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --shell <span class=s2>&#34;/sbin/nologin&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --no-create-home <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --uid <span class=s2>&#34;</span><span class=si>${</span><span class=nv>UID</span><span class=si>}</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    appuser<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>USER</span><span class=s> appuser</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>extract /build/target/extracted/dependencies/ ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>extract /build/target/extracted/spring-boot-loader/ ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>extract /build/target/extracted/snapshot-dependencies/ ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> --from<span class=o>=</span>extract /build/target/extracted/application/ ./<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 8080</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENTRYPOINT</span> <span class=p>[</span> <span class=s2>&#34;java&#34;</span><span class=p>,</span> <span class=s2>&#34;-Dspring.profiles.active=postgres&#34;</span><span class=p>,</span> <span class=s2>&#34;org.springframework.boot.loader.launch.JarLauncher&#34;</span> <span class=p>]</span><span class=err>
</span></span></span></code></pre></div><p>现在，构建您的映像并运行测试。您将运行命令<code>docker build</code>并添加<code>--target test</code>标志，以便专门运行测试构建阶段。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker build -t java-docker-image-test --progress<span class=o>=</span>plain --no-cache --target<span class=o>=</span><span class=nb>test</span> .
</span></span></code></pre></div><p>您应该看到包含以下内容的输出</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>...
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=gp>#</span><span class=m>15</span> 101.3 <span class=o>[</span>WARNING<span class=o>]</span> Tests run: 45, Failures: 0, Errors: 0, Skipped: <span class=m>2</span>
</span></span><span class=line><span class=cl><span class=gp>#</span><span class=m>15</span> 101.3 <span class=o>[</span>INFO<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=gp>#</span><span class=m>15</span> 101.3 <span class=o>[</span>INFO<span class=o>]</span> ------------------------------------------------------------------------
</span></span><span class=line><span class=cl><span class=gp>#</span><span class=m>15</span> 101.3 <span class=o>[</span>INFO<span class=o>]</span> BUILD SUCCESS
</span></span><span class=line><span class=cl><span class=gp>#</span><span class=m>15</span> 101.3 <span class=o>[</span>INFO<span class=o>]</span> ------------------------------------------------------------------------
</span></span><span class=line><span class=cl><span class=gp>#</span><span class=m>15</span> 101.3 <span class=o>[</span>INFO<span class=o>]</span> Total time:  01:39 min
</span></span><span class=line><span class=cl><span class=gp>#</span><span class=m>15</span> 101.3 <span class=o>[</span>INFO<span class=o>]</span> Finished at: 2024-02-01T23:24:48Z
</span></span><span class=line><span class=cl><span class=gp>#</span><span class=m>15</span> 101.3 <span class=o>[</span>INFO<span class=o>]</span> ------------------------------------------------------------------------
</span></span><span class=line><span class=cl><span class=gp>#</span><span class=m>15</span> DONE 101.4s
</span></span></code></pre></div><h2 id=概括-2>概括</h2><p>在本节中，您学习了如何在构建图像时运行测试。</p><p>相关信息：</p><ul><li><a href=https://docs.docker.com/build/guide/>使用 Docker 指南进行构建</a></li></ul><h1 id=为-java-应用程序配置-cicd>为 Java 应用程序配置 CI/CD</h1><h2 id=先决条件-1>先决条件</h2><p>完成本指南的前面部分，从 <a href=https://docs.docker.com/language/java/containerize/>容器化您的应用</a>开始。您必须拥有 <a href=https://github.com/signup>GitHub</a>帐户和 <a href=https://hub.docker.com/signup>Docker</a>帐户才能完成此部分。</p><h2 id=概述-1>概述</h2><p>在本部分中，您将了解如何设置和使用 GitHub Actions 构建 Docker 映像并将其推送到 Docker Hub。您将完成以下步骤：</p><ol><li>在 GitHub 上创建一个新的存储库。</li><li>定义 GitHub Actions 工作流程。</li><li>运行工作流程。</li></ol><h2 id=第一步创建存储库>第一步：创建存储库</h2><p>创建 GitHub 存储库，配置 Docker Hub 凭据并推送源代码。</p><ol><li><p>在 GitHub 上<a href=https://github.com/new>创建一个新的存储库</a>。</p></li><li><p>打开存储库<strong>设置</strong>，然后转到<strong>机密和变量</strong>> <strong>操作</strong>。</p></li><li><p>创建一个名为的新<strong>Repository 变量</strong><code>DOCKER_USERNAME</code>，并以您的 Docker ID 作为值。</p></li><li><p>为 Docker Hub创建一个新的 <a href=https://docs.docker.com/security/for-developers/access-tokens/#create-an-access-token>个人访问令牌 (PAT)</a>。您可以将此令牌命名为 <code>docker-tutorial</code> 。确保访问权限包括读取和写入。</p></li><li><p>将 PAT 作为<strong>存储库机密</strong>添加到您的 GitHub 存储库中，名称为 <code>DOCKER_TOKEN</code>。</p></li><li><p>在您机器上的本地存储库中，运行以下命令将源更改为您刚刚创建的存储库。确保更改 <code>your-username</code>为您的 GitHub 用户名和<code>your-repository</code>您创建的存储库的名称。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ git remote set-url origin https://github.com/your-username/your-repository.git
</span></span></code></pre></div></li><li><p>运行以下命令将本地存储库暂存、提交并推送到 GitHub。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ git add -A
</span></span><span class=line><span class=cl>$ git commit -m <span class=s2>&#34;my commit&#34;</span>
</span></span><span class=line><span class=cl>$ git push -u origin main
</span></span></code></pre></div></li></ol><h2 id=第二步设置工作流程>第二步：设置工作流程</h2><p>设置 GitHub Actions 工作流程以构建、测试和将映像推送到 Docker Hub。</p><ol><li><p>转到 GitHub 上的存储库，然后选择“操作”选项卡。该项目已经具有<code>maven-build</code>使用 Maven 构建和测试 Java 应用程序的工作流程。如果需要，您可以选择禁用此工作流程，因为您不会在本指南中使用它。您将创建一个新的替代工作流程来构建、测试和推送您的映像。</p></li><li><p>选择<strong>新工作流程</strong>。</p></li><li><p>选择<strong>自己设置工作流程</strong>。</p><p><code>.github/workflows/docker</code>默认情况下，这将带您进入一个在存储库中创建新的 GitHub 操作工作流文件的页面。</p></li><li><p>在编辑器窗口中，复制并粘贴以下 YAML 配置。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># https://github.com/docker/metadata-action</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build Docker Image</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=s2>&#34;main&#34;</span><span class=w> </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>tags</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=s2>&#34;*&#34;</span><span class=w> </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>release</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>types</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=l>created ]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Docker meta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>meta</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>docker/metadata-action@v5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>images</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>            ${{ secrets.DOCKER_USERNAME }}/${{ github.event.repository.name }}</span><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>tags</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>            type=ref,event=tag
</span></span></span><span class=line><span class=cl><span class=sd>            type=semver,pattern={{version}}
</span></span></span><span class=line><span class=cl><span class=sd>            type=semver,pattern={{major}}.{{minor}}
</span></span></span><span class=line><span class=cl><span class=sd>            type=semver,pattern={{major}}
</span></span></span><span class=line><span class=cl><span class=sd>            type=raw,latest</span><span class=w>            
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Set up Docker Buildx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>docker/setup-buildx-action@v3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Set up QEMU</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>docker/setup-qemu-action@v3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Set up Docker Buildx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>docker/setup-buildx-action@v3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Login to Docker Hub</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>github.event_name != &#39;pull_request&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>docker/login-action@v3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>username</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.DOCKER_USERNAME }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.DOCKER_TOKEN }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build and push</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>docker/build-push-action@v6</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>file</span><span class=p>:</span><span class=w> </span><span class=l>Dockerfile</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>platforms</span><span class=p>:</span><span class=w> </span><span class=l>linux/amd64,linux/arm64</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>target</span><span class=p>:</span><span class=w> </span><span class=l>final</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>tags</span><span class=p>:</span><span class=w> </span><span class=l>${{ steps.meta.outputs.tags }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>push</span><span class=p>:</span><span class=w> </span><span class=l>${{ github.event_name != &#39;pull_request&#39; }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>labels</span><span class=p>:</span><span class=w> </span><span class=l>${{ steps.meta.outputs.labels }}</span><span class=w>
</span></span></span></code></pre></div><p>有关的 YAML 语法的更多信息<code>docker/build-push-action</code>，请参阅 <a href=https://github.com/docker/build-push-action/blob/master/README.md>GitHub Action README</a>。</p></li></ol><h2 id=第三步运行工作流程>第三步：运行工作流程</h2><p>保存工作流文件并运行作业。</p><ol><li><p>选择**提交更改&mldr;**并将更改推送到<code>main</code>分支。</p><p>推送提交后，工作流程将自动启动。</p></li><li><p>转到**“操作”**选项卡。它显示工作流程。</p><p>选择工作流程可以显示所有步骤的细目。</p></li><li><p>工作流程完成后，转到 <a href=https://hub.docker.com/repositories>Docker Hub 上的存储库</a>。</p><p>如果您在该列表中看到新的存储库，则表示 GitHub Actions 已成功将映像推送到 Docker Hub。</p></li></ol><h2 id=概括-3>概括</h2><p>在本节中，您学习了如何为您的应用程序设置 GitHub Actions 工作流程。</p><p>相关信息：</p><ul><li><a href=https://docs.docker.com/build/ci/github-actions/>GitHub Actions 简介</a></li><li><a href=https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions>GitHub Actions 的工作流程语法</a></li></ul><h1 id=测试-kubernetes-部署>测试 Kubernetes 部署</h1><h2 id=先决条件-2>先决条件</h2><ul><li>完成本指南前面的所有部分，从 <a href=https://docs.docker.com/language/java/containerize/>“容器化你的应用”</a>开始。</li><li>在 Docker Desktop 中<a href=https://docs.docker.com/desktop/kubernetes/#install-and-turn-on-kubernetes>打开 Kubernetes</a>。</li></ul><h2 id=概述-2>概述</h2><p>在本部分中，您将了解如何使用 Docker Desktop 将应用程序部署到开发机器上功能齐全的 Kubernetes 环境。这样，您可以在部署之前在本地测试和调试 Kubernetes 上的工作负载。</p><h2 id=创建-kubernetes-yaml-文件>创建 Kubernetes YAML 文件</h2><p>在您的<code>spring-petclinic</code>目录中，创建一个名为 的文件 <code>docker-java-kubernetes.yaml</code>。在 IDE 或文本编辑器中打开该文件并添加以下内容。将其替换为您的 Docker 用户名和您在<a href=https://docs.docker.com/language/java/configure-ci-cd/>为 Java 应用程序配置 CI/CD</a><code>DOCKER_USERNAME/REPO_NAME</code>中创建的存储库的名称 。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>docker-java-demo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>service</span><span class=p>:</span><span class=w> </span><span class=l>server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>service</span><span class=p>:</span><span class=w> </span><span class=l>server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>server-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>DOCKER_USERNAME/REPO_NAME</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>service-entrypoint</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>NodePort</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>service</span><span class=p>:</span><span class=w> </span><span class=l>server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>nodePort</span><span class=p>:</span><span class=w> </span><span class=m>30001</span><span class=w>
</span></span></span></code></pre></div><p>在此 Kubernetes YAML 文件中，有两个对象，由以下字符分隔<code>---</code>：</p><ul><li>部署，描述一组可扩展的相同 Pod。在这种情况下，您将只获得一个副本或 Pod 的副本。该 Pod（如下所述）中只有一个容器。该容器是根据 GitHub Actions 在<a href=https://docs.docker.com/language/java/configure-ci-cd/>为 Java 应用程序配置 CI/CD</a><code>template</code>中构建的映像创建的 。</li><li>NodePort 服务会将流量从主机上的端口 30001 路由到其路由到的 pod 内的端口 8080，从而允许您从网络访问您的应用程序。</li></ul><p>要了解有关 Kubernetes 对象的更多信息，请参阅 <a href=https://kubernetes.io/docs/home/>Kubernetes 文档</a>。</p><h2 id=部署并检查您的应用程序>部署并检查您的应用程序</h2><ol><li><p>在终端中，导航到 Kubernetes<code>spring-petclinic</code>并将其部署到 Kubernetes。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> kubectl apply -f docker-java-kubernetes.yaml
</span></span></code></pre></div><p>您应该看到如下所示的输出，表明您的 Kubernetes 对象已成功创建。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>deployment.apps/docker-java-demo created
</span></span><span class=line><span class=cl>service/service-entrypoint created
</span></span></code></pre></div></li><li><p>通过列出您的部署来确保一切正常。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get deployments
</span></span></code></pre></div><p>您的部署应列出如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>NAME                 READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>docker-java-demo     1/1     <span class=m>1</span>            <span class=m>1</span>           15s
</span></span></code></pre></div><p>这表明您在 YAML 中请求的所有 pod 均已启动并正在运行。对您的服务执行相同的检查。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl get services
</span></span></code></pre></div><p>您应该获得如下输出。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>NAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>          AGE
</span></span><span class=line><span class=cl>kubernetes           ClusterIP   10.96.0.1       &lt;none&gt;        443/TCP          23h
</span></span><span class=line><span class=cl>service-entrypoint   NodePort    10.99.128.230   &lt;none&gt;        8080:30001/TCP   75s
</span></span></code></pre></div><p>除了默认<code>kubernetes</code>服务之外，您还可以看到您的<code>service-entrypoint</code>服务在端口 30001/TCP 上接受流量。</p></li><li><p>在终端中，curl 服务。请注意，此示例中未部署数据库。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ curl --request GET <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --url http://localhost:30001/actuator/health <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>  --header <span class=s1>&#39;content-type: application/json&#39;</span>
</span></span></code></pre></div><p>您应该获得如下输出。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span><span class=nt>&#34;status&#34;</span><span class=p>:</span><span class=s2>&#34;UP&#34;</span><span class=p>,</span><span class=nt>&#34;groups&#34;</span><span class=p>:[</span><span class=s2>&#34;liveness&#34;</span><span class=p>,</span><span class=s2>&#34;readiness&#34;</span><span class=p>]}</span>
</span></span></code></pre></div></li><li><p>运行以下命令来关闭您的应用程序。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ kubectl delete -f docker-java-kubernetes.yaml
</span></span></code></pre></div></li></ol><h2 id=概括-4>概括</h2><p>在本节中，您学习了如何使用 Docker Desktop 将应用程序部署到开发机器上功能齐全的 Kubernetes 环境。</p><p>相关信息：</p><ul><li><a href=https://kubernetes.io/docs/home/>Kubernetes 文档</a></li><li><a href=https://docs.docker.com/desktop/kubernetes/>使用 Docker Desktop 在 Kubernetes 上部署</a></li><li><a href=https://docs.docker.com/engine/swarm/>Swarm 模式概述</a></li></ul></div><footer class=post-footer><nav class=paginav><a class=prev href=https://blog.chensoul.cc/posts/2024/07/10/springdoc-with-spring-boot/><span class=title><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left" style="user-select:text"><line x1="19" y1="12" x2="5" y2="12" style="user-select:text"/><polyline points="12 19 5 12 12 5" style="user-select:text"/></svg>&nbsp;Prev Page</span><br><span>Spring Boot集成SpringDoc生成Api文档</span>
</a><a class=next href=https://blog.chensoul.cc/posts/2024/07/09/install-docker/><span class=title>Next Page&nbsp;<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span><br><span>Docker安装和配置</span></a></nav></footer><div class=comments-separator></div></article></main><footer class=footer><span>&copy; 2024 <a href=https://blog.chensoul.cc/>ChenSoul</a></span><span style=display:inline-block;margin-left:1em>
<a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA</a>
</span><span style=display:inline-block;margin-left:1em>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
    <a href=https://github.com/reorx/hugo-PaperModX/ rel=noopener target=_blank>PaperModX</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script async src=https://umami.chensoul.cc/random-string.js data-website-id=821c25f8-a31a-4607-92d7-91ee76843d00></script><script>(function(){const t=""=="1";if(t)return;let e=document.getElementById("theme-toggle");e.removeEventListener("click",toggleThemeListener),e.addEventListener("click",toggleThemeListener)})()</script><script>(function(){let e=document.getElementById("menu");e&&(e.scrollLeft=localStorage.getItem("menu-scroll-position"),e.onscroll=function(){localStorage.setItem("menu-scroll-position",e.scrollLeft)});const t=""=="1",n="1"=="1";if(window.matchMedia("(prefers-reduced-motion: reduce)").matches||t||n)return;document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})})()</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>if(window.scrollListeners)for(const e of scrollListeners)window.removeEventListener("scroll",e);window.scrollListeners=[]</script><script src=/js/medium-zoom.min.js data-no-instant></script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script>(function(){const a="1"=="1";if(!a)return;if(!document.querySelector(".toc")){console.log("no toc found, ignore toc scroll");return}const r=window.scrollListeners,t=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id]"),n="active";let e=t[0];o(e).classList.add(n);const c=()=>{const s=[];for(const e of t)if(l(e)<5)s.push(e);else break;s.length>0?newActiveHeading=s[s.length-1]:newActiveHeading=t[0],e!=newActiveHeading&&(o(e).classList.remove(n),e=newActiveHeading,o(e).classList.add(n))};let s=null;const i=()=>{s!==null&&clearTimeout(s),s=setTimeout(c,50)};window.addEventListener("scroll",i,!1),r.push(i);function o(e){const t=encodeURI(e.getAttribute("id")).toLowerCase();return document.querySelector(`.toc ul li a[href="#${t}"]`)}function l(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect();return t.top}})()</script><script>mediumZoom(".entry-cover img"),mediumZoom(".post-content img:not([no-zoom])")</script><script src=/js/instantclick.min.js data-no-instant></script><script data-no-instant>InstantClick.init()</script></body></html>