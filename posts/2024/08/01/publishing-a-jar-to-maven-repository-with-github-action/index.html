<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Github Action 发布 Jar 到 Maven 中央仓库 | ChenSoul</title>
<meta name=keywords content="maven,java"><meta name=description content="前提条件 在 Github 创建一个 Maven 项目 安装 gpg 并创建 gpg 秘钥和公钥，参考 How to Publish Artifacts to Maven Central 创建 OSSRH 账号，参考 Generate a Token on OSSRH Sonatype Nexus Repository Manager servers 创建 Maven 项目 首先在Github上面创建项目：https://github.com/chensoul/maven-hello-world
增加两个 Maven 插件：
<plugin> <groupId>org.apache.maven.plugins</groupId> <artifactId>maven-gpg-plugin</artifactId> <version>3.2.2</version> <executions> <execution> <goals> <goal>sign</goal> </goals> <phase>verify</phase> </execution> </executions> </plugin> <plugin> <groupId>org.sonatype.plugins</groupId> <artifactId>nexus-staging-maven-plugin</artifactId> <version>1.7.0</version> <extensions>true</extensions> <configuration> <serverId>ossrh</serverId> <nexusUrl>https://s01.oss.sonatype.org/</nexusUrl> <autoReleaseAfterClose>true</autoReleaseAfterClose> <keepStagingRepositoryOnCloseRuleFailure>false</keepStagingRepositoryOnCloseRuleFailure> </configuration> </plugin> 可以将上面的两个插件加入到 pom.xml 的 build 节点下面，也可以配置到 profile 节点下。https://github.com/chensoul/maven-hello-world 项目中使用的是第二种方式，具体见 https://github.com/chensoul/chensoul-parent 的 pom.xml 文件。
<profiles> <profile> <id>release</id> <build> <plugins> <plugin> <groupId>org.apache.maven.plugins</groupId> <artifactId>maven-source-plugin</artifactId> </plugin> <plugin> <groupId>org.apache.maven.plugins</groupId> <artifactId>maven-javadoc-plugin</artifactId> </plugin> <plugin> <groupId>org.apache.maven.plugins</groupId> <artifactId>maven-enforcer-plugin</artifactId> </plugin> <plugin> <groupId>pl.project13.maven</groupId> <artifactId>git-commit-id-plugin</artifactId> </plugin> <plugin> <groupId>org.apache.maven.plugins</groupId> <artifactId>maven-release-plugin</artifactId> <version>${maven-release-plugin.version}</version> <configuration> <scmCommentPrefix>[CI Skip]</scmCommentPrefix> <autoVersionSubmodules>true</autoVersionSubmodules> <useReleaseProfile>false</useReleaseProfile> <releaseProfiles>release</releaseProfiles> <goals>deploy</goals> </configuration> </plugin> <!"><meta name=author content="chensoul"><link rel=canonical href=https://blog.chensoul.cc/posts/2024/08/01/publishing-a-jar-to-maven-repository-with-github-action/><link crossorigin=anonymous href=/assets/css/stylesheet.min.d6db7ab468e55ea6647d68be426a17bae21ff1cddbf1741e547ed2086d010444.css integrity="sha256-1tt6tGjlXqZkfWi+QmoXuuIf8c3b8XQeVH7SCG0BBEQ=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.chensoul.cc/favicon.ico><link rel=apple-touch-icon href=https://blog.chensoul.cc/apple-touch-icon.png><link rel=alternate hreflang=en href=https://blog.chensoul.cc/posts/2024/08/01/publishing-a-jar-to-maven-repository-with-github-action/><meta name=twitter:title content="Github Action 发布 Jar 到 Maven 中央仓库 | ChenSoul"><meta name=twitter:description content="前提条件 在 Github 创建一个 Maven 项目 安装 gpg 并创建 gpg 秘钥和公钥，参考 How to Publish Artifacts to Maven Central 创建 OSSRH 账号，参考 Generate a Token on OSSRH Sonatype Nexus Repository Manager servers 创建 Maven 项目 首先在Github上面创建项目：https://github.com/chensoul/maven-hello-world
增加两个 Maven 插件：
<plugin> <groupId>org.apache.maven.plugins</groupId> <artifactId>maven-gpg-plugin</artifactId> <version>3.2.2</version> <executions> <execution> <goals> <goal>sign</goal> </goals> <phase>verify</phase> </execution> </executions> </plugin> <plugin> <groupId>org.sonatype.plugins</groupId> <artifactId>nexus-staging-maven-plugin</artifactId> <version>1.7.0</version> <extensions>true</extensions> <configuration> <serverId>ossrh</serverId> <nexusUrl>https://s01.oss.sonatype.org/</nexusUrl> <autoReleaseAfterClose>true</autoReleaseAfterClose> <keepStagingRepositoryOnCloseRuleFailure>false</keepStagingRepositoryOnCloseRuleFailure> </configuration> </plugin> 可以将上面的两个插件加入到 pom.xml 的 build 节点下面，也可以配置到 profile 节点下。https://github.com/chensoul/maven-hello-world 项目中使用的是第二种方式，具体见 https://github.com/chensoul/chensoul-parent 的 pom.xml 文件。
<profiles> <profile> <id>release</id> <build> <plugins> <plugin> <groupId>org.apache.maven.plugins</groupId> <artifactId>maven-source-plugin</artifactId> </plugin> <plugin> <groupId>org.apache.maven.plugins</groupId> <artifactId>maven-javadoc-plugin</artifactId> </plugin> <plugin> <groupId>org.apache.maven.plugins</groupId> <artifactId>maven-enforcer-plugin</artifactId> </plugin> <plugin> <groupId>pl.project13.maven</groupId> <artifactId>git-commit-id-plugin</artifactId> </plugin> <plugin> <groupId>org.apache.maven.plugins</groupId> <artifactId>maven-release-plugin</artifactId> <version>${maven-release-plugin.version}</version> <configuration> <scmCommentPrefix>[CI Skip]</scmCommentPrefix> <autoVersionSubmodules>true</autoVersionSubmodules> <useReleaseProfile>false</useReleaseProfile> <releaseProfiles>release</releaseProfiles> <goals>deploy</goals> </configuration> </plugin> <!"><meta property="og:title" content="Github Action 发布 Jar 到 Maven 中央仓库 | ChenSoul"><meta property="og:description" content="前提条件 在 Github 创建一个 Maven 项目 安装 gpg 并创建 gpg 秘钥和公钥，参考 How to Publish Artifacts to Maven Central 创建 OSSRH 账号，参考 Generate a Token on OSSRH Sonatype Nexus Repository Manager servers 创建 Maven 项目 首先在Github上面创建项目：https://github.com/chensoul/maven-hello-world
增加两个 Maven 插件：
<plugin> <groupId>org.apache.maven.plugins</groupId> <artifactId>maven-gpg-plugin</artifactId> <version>3.2.2</version> <executions> <execution> <goals> <goal>sign</goal> </goals> <phase>verify</phase> </execution> </executions> </plugin> <plugin> <groupId>org.sonatype.plugins</groupId> <artifactId>nexus-staging-maven-plugin</artifactId> <version>1.7.0</version> <extensions>true</extensions> <configuration> <serverId>ossrh</serverId> <nexusUrl>https://s01.oss.sonatype.org/</nexusUrl> <autoReleaseAfterClose>true</autoReleaseAfterClose> <keepStagingRepositoryOnCloseRuleFailure>false</keepStagingRepositoryOnCloseRuleFailure> </configuration> </plugin> 可以将上面的两个插件加入到 pom.xml 的 build 节点下面，也可以配置到 profile 节点下。https://github.com/chensoul/maven-hello-world 项目中使用的是第二种方式，具体见 https://github.com/chensoul/chensoul-parent 的 pom.xml 文件。
<profiles> <profile> <id>release</id> <build> <plugins> <plugin> <groupId>org.apache.maven.plugins</groupId> <artifactId>maven-source-plugin</artifactId> </plugin> <plugin> <groupId>org.apache.maven.plugins</groupId> <artifactId>maven-javadoc-plugin</artifactId> </plugin> <plugin> <groupId>org.apache.maven.plugins</groupId> <artifactId>maven-enforcer-plugin</artifactId> </plugin> <plugin> <groupId>pl.project13.maven</groupId> <artifactId>git-commit-id-plugin</artifactId> </plugin> <plugin> <groupId>org.apache.maven.plugins</groupId> <artifactId>maven-release-plugin</artifactId> <version>${maven-release-plugin.version}</version> <configuration> <scmCommentPrefix>[CI Skip]</scmCommentPrefix> <autoVersionSubmodules>true</autoVersionSubmodules> <useReleaseProfile>false</useReleaseProfile> <releaseProfiles>release</releaseProfiles> <goals>deploy</goals> </configuration> </plugin> <!"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.chensoul.cc/posts/2024/08/01/publishing-a-jar-to-maven-repository-with-github-action/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-08-01T08:00:00+08:00"><meta property="article:modified_time" content="2024-08-01T08:00:00+08:00"><meta property="og:site_name" content="ChenSoul"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.chensoul.cc/posts/"},{"@type":"ListItem","position":2,"name":"Github Action 发布 Jar 到 Maven 中央仓库","item":"https://blog.chensoul.cc/posts/2024/08/01/publishing-a-jar-to-maven-repository-with-github-action/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Github Action 发布 Jar 到 Maven 中央仓库 | ChenSoul","name":"Github Action 发布 Jar 到 Maven 中央仓库","description":"前提条件 在 Github 创建一个 Maven 项目 安装 gpg 并创建 gpg 秘钥和公钥，参考 How to Publish Artifacts to Maven Central 创建 OSSRH 账号，参考 Generate a Token on OSSRH Sonatype Nexus Repository Manager servers 创建 Maven 项目 首先在Github上面创建项目：https://github.com/chensoul/maven-hello-world\n增加两个 Maven 插件：\n\u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-gpg-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.2.2\u0026lt;/version\u0026gt; \u0026lt;executions\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;sign\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;phase\u0026gt;verify\u0026lt;/phase\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;/executions\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.sonatype.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;nexus-staging-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.7.0\u0026lt;/version\u0026gt; \u0026lt;extensions\u0026gt;true\u0026lt;/extensions\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;serverId\u0026gt;ossrh\u0026lt;/serverId\u0026gt; \u0026lt;nexusUrl\u0026gt;https://s01.oss.sonatype.org/\u0026lt;/nexusUrl\u0026gt; \u0026lt;autoReleaseAfterClose\u0026gt;true\u0026lt;/autoReleaseAfterClose\u0026gt; \u0026lt;keepStagingRepositoryOnCloseRuleFailure\u0026gt;false\u0026lt;/keepStagingRepositoryOnCloseRuleFailure\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt; 可以将上面的两个插件加入到 pom.xml 的 build 节点下面，也可以配置到 profile 节点下。https://github.com/chensoul/maven-hello-world 项目中使用的是第二种方式，具体见 https://github.com/chensoul/chensoul-parent 的 pom.xml 文件。\n\u0026lt;profiles\u0026gt; \u0026lt;profile\u0026gt; \u0026lt;id\u0026gt;release\u0026lt;/id\u0026gt; \u0026lt;build\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-source-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-javadoc-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-enforcer-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;pl.project13.maven\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;git-commit-id-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-release-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${maven-release-plugin.version}\u0026lt;/version\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;scmCommentPrefix\u0026gt;[CI Skip]\u0026lt;/scmCommentPrefix\u0026gt; \u0026lt;autoVersionSubmodules\u0026gt;true\u0026lt;/autoVersionSubmodules\u0026gt; \u0026lt;useReleaseProfile\u0026gt;false\u0026lt;/useReleaseProfile\u0026gt; \u0026lt;releaseProfiles\u0026gt;release\u0026lt;/releaseProfiles\u0026gt; \u0026lt;goals\u0026gt;deploy\u0026lt;/goals\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;!","keywords":["maven","java"],"wordCount":"1035","inLanguage":"en","datePublished":"2024-08-01T08:00:00+08:00","dateModified":"2024-08-01T08:00:00+08:00","author":[{"@type":"Person","name":"chensoul"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.chensoul.cc/posts/2024/08/01/publishing-a-jar-to-maven-repository-with-github-action/"},"publisher":{"@type":"Organization","name":"ChenSoul","logo":{"@type":"ImageObject","url":"https://blog.chensoul.cc/favicon.ico"}}}</script><meta name=baidu-site-verification content="codeva-FYpQY8JdLU"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary-bg:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list-page{background:var(--theme)}.list-page:not(.dark)::-webkit-scrollbar-track{background:0 0}.list-page:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript></head><body class="type-posts kind-page layout-" id=top><script data-no-instant>function switchTheme(e){switch(e){case"light":document.body.classList.remove("dark");break;case"dark":document.body.classList.add("dark");break;default:window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")}}function isDarkTheme(){return document.body.className.includes("dark")}function getPrefTheme(){return localStorage.getItem("pref-theme")}function setPrefTheme(e){switchTheme(e),localStorage.setItem("pref-theme",e)}const toggleThemeCallbacks={};toggleThemeCallbacks.main=e=>{setPrefTheme(e?"light":"dark")},window.addEventListener("toggle-theme",function(){const e=isDarkTheme();for(const t in toggleThemeCallbacks)toggleThemeCallbacks[t](e)});function toggleThemeListener(){window.dispatchEvent(new CustomEvent("toggle-theme"))}</script><script>(function(){const t="auto",e=getPrefTheme(),n=e||t;switchTheme(n)})()</script><header class=header><nav class=nav><div class=logo><a href=https://blog.chensoul.cc/ accesskey=h title="ChenSoul (Alt + H)">ChenSoul</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://blog.chensoul.cc/categories/review/ title=总结>总结</a></li><li><a href=https://blog.chensoul.cc/categories/ title=分类>分类</a></li><li><a href=https://blog.chensoul.cc/tags/ title=标签>标签</a></li><li><a href=https://github.com/chensoul/ title=关于 target=_blank>关于<span class=external-link><svg class="icon icon-tabler icon-tabler-external-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M11 7H6A2 2 0 004 9v9a2 2 0 002 2h9a2 2 0 002-2v-5"/><line x1="10" y1="14" x2="20" y2="4"/><polyline points="15 4 20 4 20 9"/></svg></span></a></li></ul></nav></header><main class="main post"><article class=post-single><header class=post-header><h1 class=post-title>Github Action 发布 Jar 到 Maven 中央仓库</h1><div class=post-meta><span class=meta-item><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg>
<span>2024-08-01</span></span><span class=meta-item>
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon" style="user-select:text"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z" style="user-select:text"/><line x1="7" y1="7" x2="7" y2="7" style="user-select:text"/></svg>
<span class=post-tags><a href=https://blog.chensoul.cc/tags/maven/>Maven</a><a href=https://blog.chensoul.cc/tags/java/>Java</a></span></span><span class=meta-item>
<svg width="24" height="24" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>5 min</span></span></div></header><div class="toc side right"><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e5%89%8d%e6%8f%90%e6%9d%a1%e4%bb%b6 aria-label=前提条件>前提条件</a></li><li><a href=#%e5%88%9b%e5%bb%ba-maven-%e9%a1%b9%e7%9b%ae aria-label="创建 Maven 项目">创建 Maven 项目</a></li><li><a href=#%e5%ae%89%e8%a3%85-gpg-%e5%b9%b6%e5%88%9b%e5%bb%ba%e5%85%ac%e7%a7%98%e9%92%a5 aria-label="安装 GPG 并创建公秘钥">安装 GPG 并创建公秘钥</a></li><li><a href=#%e4%bd%bf%e7%94%a8-maven-%e5%8f%91%e5%b8%83-jar aria-label="使用 Maven 发布 jar">使用 Maven 发布 jar</a></li><li><a href=#%e9%85%8d%e7%bd%aegithub-actions aria-label="配置Github Actions">配置Github Actions</a><ul><li><a href=#actionssetup-java aria-label=actions/setup-java>actions/setup-java</a></li><li><a href=#qcastelgithub-actions-maven-release aria-label=qcastel/github-actions-maven-release>qcastel/github-actions-maven-release</a></li></ul></li><li><a href=#%e6%80%bb%e7%bb%93 aria-label=总结>总结</a></li></ul></div></details></div><div class=post-content><h2 id=前提条件>前提条件</h2><ol><li>在 Github 创建一个 Maven 项目</li><li>安装 gpg 并创建 gpg 秘钥和公钥，参考 <a href=https://dzone.com/articles/how-to-publish-artifacts-to-maven-central>How to Publish Artifacts to Maven Central</a></li><li>创建 OSSRH 账号，参考 <a href=https://central.sonatype.org/publish/generate-token/#generate-a-token-on-ossrh-sonatype-nexus-repository-manager-servers>Generate a Token on OSSRH Sonatype Nexus Repository Manager servers</a></li></ol><h2 id=创建-maven-项目>创建 Maven 项目</h2><p>首先在Github上面创建项目：<a href=https://github.com/chensoul/maven-hello-world>https://github.com/chensoul/maven-hello-world</a></p><p>增加两个 Maven 插件：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;groupId&gt;</span>org.apache.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;artifactId&gt;</span>maven-gpg-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;version&gt;</span>3.2.2<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;executions&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;execution&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;goals&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;goal&gt;</span>sign<span class=nt>&lt;/goal&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/goals&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;phase&gt;</span>verify<span class=nt>&lt;/phase&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/execution&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/executions&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;groupId&gt;</span>org.sonatype.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;artifactId&gt;</span>nexus-staging-maven-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;version&gt;</span>1.7.0<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;extensions&gt;</span>true<span class=nt>&lt;/extensions&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;serverId&gt;</span>ossrh<span class=nt>&lt;/serverId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;nexusUrl&gt;</span>https://s01.oss.sonatype.org/<span class=nt>&lt;/nexusUrl&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;autoReleaseAfterClose&gt;</span>true<span class=nt>&lt;/autoReleaseAfterClose&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;keepStagingRepositoryOnCloseRuleFailure&gt;</span>false<span class=nt>&lt;/keepStagingRepositoryOnCloseRuleFailure&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/plugin&gt;</span>
</span></span></code></pre></div><p>可以将上面的两个插件加入到 pom.xml 的 build 节点下面，也可以配置到 profile 节点下。<a href=https://github.com/chensoul/maven-hello-world>https://github.com/chensoul/maven-hello-world</a> 项目中使用的是第二种方式，具体见 <a href=https://github.com/chensoul/chensoul-parent>https://github.com/chensoul/chensoul-parent</a> 的 pom.xml 文件。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;profiles&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;profile&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;id&gt;</span>release<span class=nt>&lt;/id&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;build&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;plugins&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>org.apache.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>maven-source-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>org.apache.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>maven-javadoc-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>org.apache.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>maven-enforcer-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>pl.project13.maven<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>git-commit-id-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>org.apache.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>maven-release-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;version&gt;</span>${maven-release-plugin.version}<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;scmCommentPrefix&gt;</span>[CI Skip]<span class=nt>&lt;/scmCommentPrefix&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;autoVersionSubmodules&gt;</span>true<span class=nt>&lt;/autoVersionSubmodules&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;useReleaseProfile&gt;</span>false<span class=nt>&lt;/useReleaseProfile&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;releaseProfiles&gt;</span>release<span class=nt>&lt;/releaseProfiles&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;goals&gt;</span>deploy<span class=nt>&lt;/goals&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>          <span class=c>&lt;!-- https://blog.sonatype.com/2010/01/how-to-generate-pgp-signatures-with-maven/ --&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>org.apache.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>maven-gpg-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;version&gt;</span>${maven-gpg-plugin.version}<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;executions&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;execution&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;goals&gt;</span>
</span></span><span class=line><span class=cl>                  <span class=nt>&lt;goal&gt;</span>sign<span class=nt>&lt;/goal&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;/goals&gt;</span>
</span></span><span class=line><span class=cl>                <span class=nt>&lt;phase&gt;</span>verify<span class=nt>&lt;/phase&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;/execution&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/executions&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;groupId&gt;</span>org.sonatype.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;artifactId&gt;</span>nexus-staging-maven-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;version&gt;</span>${nexus-staging-maven-plugin.version}<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;extensions&gt;</span>true<span class=nt>&lt;/extensions&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;serverId&gt;</span>ossrh<span class=nt>&lt;/serverId&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;nexusUrl&gt;</span>https://s01.oss.sonatype.org/<span class=nt>&lt;/nexusUrl&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;autoReleaseAfterClose&gt;</span>true<span class=nt>&lt;/autoReleaseAfterClose&gt;</span>
</span></span><span class=line><span class=cl>              <span class=nt>&lt;keepStagingRepositoryOnCloseRuleFailure&gt;</span>false<span class=nt>&lt;/keepStagingRepositoryOnCloseRuleFailure&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl>          <span class=nt>&lt;/plugin&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/plugins&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nt>&lt;/build&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/profile&gt;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/profiles&gt;</span>
</span></span></code></pre></div><p>nexus-staging-maven-plugin 插件配置的 serverId 是 ossrh ，需要和 distributionManagement 中的配置一致：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;distributionManagement&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;snapshotRepository&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;id&gt;</span>ossrh<span class=nt>&lt;/id&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;url&gt;</span>https://s01.oss.sonatype.org/content/repositories/snapshots<span class=nt>&lt;/url&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/snapshotRepository&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;repository&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;id&gt;</span>ossrh<span class=nt>&lt;/id&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;url&gt;</span>https://s01.oss.sonatype.org/service/local/staging/deploy/maven2/<span class=nt>&lt;/url&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/repository&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/distributionManagement&gt;</span>
</span></span></code></pre></div><p>您需要在 <a href=https://issues.sonatype.org/secure/Dashboard.jspa>Sonatype JIRA</a> 上注册一个帐户并为此创建一个<a href="https://issues.sonatype.org/secure/CreateIssue.jspa?issuetype=21&amp;pid=10134">Issure</a>。</p><p>将您的 Sonatype JIRA 凭证添加到您的<code>~/.m2/settings.xml</code>文件中，如下所示：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;server&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;id&gt;</span>ossrh<span class=nt>&lt;/id&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;username&gt;</span>LSJkOqOi<span class=nt>&lt;/username&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;password&gt;</span>3oJOIO5+ah7LIcRSmDC2YDGjE9PRbgxoE2UbXjOrSzC1<span class=nt>&lt;/password&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/server&gt;</span>
</span></span></code></pre></div><h2 id=安装-gpg-并创建公秘钥>安装 GPG 并创建公秘钥</h2><p>macos 上安装 gpg：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>brew install gpg
</span></span></code></pre></div><p>参考 <a href=https://central.sonatype.org/publish/requirements/gpg/#generating-a-key-pair>Generating a Key Pair</a> 生成 GPG 密钥。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ gpg --gen-key
</span></span><span class=line><span class=cl>gpg <span class=o>(</span>GnuPG<span class=o>)</span> 2.4.5<span class=p>;</span> Copyright <span class=o>(</span>C<span class=o>)</span> <span class=m>2024</span> g10 Code GmbH
</span></span><span class=line><span class=cl>This is free software: you are free to change and redistribute it.
</span></span><span class=line><span class=cl>There is NO WARRANTY, to the extent permitted by law.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>注意：使用 “gpg --full-generate-key” 以获得一个全功能的密钥生成对话框。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>GnuPG 需要构建用户标识以辨认您的密钥。
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>真实姓名： chensoul
</span></span><span class=line><span class=cl>电子邮件地址： ichensoul@gmail.com
</span></span><span class=line><span class=cl>您选定了此用户标识：
</span></span><span class=line><span class=cl>    “chensoul &lt;ichensoul@gmail.com&gt;”
</span></span></code></pre></div><p>按提示输入两次密码，这里我使用 chensoul 作为密码 。</p><p>查看生成的 key：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># gpg --list-secret-keys --keyid-format=long</span>
</span></span><span class=line><span class=cl><span class=o>[</span>keyboxd<span class=o>]</span>
</span></span><span class=line><span class=cl>---------
</span></span><span class=line><span class=cl>sec   ed25519/93C5993B9F7B43EE 2024-05-08 <span class=o>[</span>SC<span class=o>]</span> <span class=o>[</span>有效至：2027-05-08<span class=o>]</span>
</span></span><span class=line><span class=cl>      C83119F1B90238633D766D4B93C5993B9F7B43EE
</span></span><span class=line><span class=cl>uid                   <span class=o>[</span> 绝对 <span class=o>]</span> chensoul &lt;ichensoul@gmail.com&gt;
</span></span><span class=line><span class=cl>ssb   cv25519/116B95FF0068A7E8 2024-05-08 <span class=o>[</span>E<span class=o>]</span> <span class=o>[</span>有效至：2027-05-08<span class=o>]</span>
</span></span></code></pre></div><p>上传公开的 key：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># keyserver.ubuntu.com</span>
</span></span><span class=line><span class=cl><span class=c1># keys.openpgp.org</span>
</span></span><span class=line><span class=cl><span class=c1># pgp.mit.edu</span>
</span></span><span class=line><span class=cl>gpg --keyserver keys.openpgp.org --send-keys C83119F1B90238633D766D4B93C5993B9F7B43EE
</span></span></code></pre></div><p>修改 <code>~/.m2/settings.xml</code> 文件，添加：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;server&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;id&gt;</span>gpg.passphrase<span class=nt>&lt;/id&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;passphrase&gt;&lt;PASSPHRASE_GPG&gt;&lt;/passphrase&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/server&gt;</span>
</span></span></code></pre></div><p>将 <code>&lt;PASSPHRASE_GPG></code> 替换为创建 gpg key 时设置的密码。</p><h2 id=使用-maven-发布-jar>使用 Maven 发布 jar</h2><p>使用下面命令发布 jar 到 sonatype 仓库：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mvn -P release clean deploy
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>mvn -P release clean deploy
</span></span></code></pre></div><p>如果当前项目的版本为快照版，则发布后的 jar 在 <a href=https://s01.oss.sonatype.org/content/repositories/snapshots/com/chensoul/maven-hello-world/>https://s01.oss.sonatype.org/content/repositories/snapshots/com/chensoul/maven-hello-world/</a></p><p>如果当前项目的版本为正式版，稍等几分钟，可以在以下仓库查看发布的 jar:</p><ul><li><a href=https://central.sonatype.com/artifact/com.chensoul/maven-hello-world>https://central.sonatype.com/artifact/com.chensoul/maven-hello-world</a></li><li><a href=https://s01.oss.sonatype.org/service/local/repositories/releases/content/com/chensoul/maven-hello-world>https://s01.oss.sonatype.org/service/local/repositories/releases/content/com/chensoul/maven-hello-world</a></li><li><a href=https://repo.maven.apache.org/maven2/com/chensoul/maven-hello-world>https://repo.maven.apache.org/maven2/com/chensoul/maven-hello-world</a></li></ul><h2 id=配置github-actions>配置Github Actions</h2><p>使用 Github Actions 发布 jar 到 maven 仓库，目前发现有两个 action 可以实现该目的：</p><ul><li><p><a href=https://github.com/actions/setup-java>actions/setup-java</a></p></li><li><p><a href=https://github.com/qcastel/github-actions-maven-release>qcastel/github-actions-maven-release</a></p></li></ul><h3 id=actionssetup-java>actions/setup-java</h3><p>使用 <a href=https://github.com/actions/setup-java>actions/setup-java</a> ，参考使用文档，在项目的 .github/workflows 目录下创建 maven-release.yml文件：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Maven Release</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=s2>&#34;main&#34;</span><span class=w> </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>tags</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=s2>&#34;*&#34;</span><span class=w> </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>release</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>types</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=l>created ]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;!contains(github.event.head_commit.message, &#39;[CI Skip]&#39;)&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Checkout</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Set up JDK 8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/setup-java@v4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>distribution</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;temurin&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>java-version</span><span class=p>:</span><span class=w> </span><span class=m>8</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>cache</span><span class=p>:</span><span class=w> </span><span class=l>maven</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>server-id</span><span class=p>:</span><span class=w> </span><span class=l>ossrh</span><span class=w> </span><span class=c># Value of the distributionManagement/repository/id field of the pom.xml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>server-username</span><span class=p>:</span><span class=w> </span><span class=l>MAVEN_USERNAME</span><span class=w> </span><span class=c># 变量</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>server-password</span><span class=p>:</span><span class=w> </span><span class=l>MAVEN_TOKEN</span><span class=w> </span><span class=c># 变量</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>gpg-passphrase</span><span class=p>:</span><span class=w> </span><span class=l>GPG_PASSPHRASE</span><span class=w> </span><span class=c># 变量</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>gpg-private-key</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.MAVEN_GPG_PRIVATE_KEY }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Java Maven Release</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>mvn -ntp -B -U clean deploy -P release -DskipTests</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>MAVEN_USERNAME</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.OSSRH_USERNAME }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>MAVEN_TOKEN</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.OSSRH_TOKEN }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>GPG_PASSPHRASE</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.MAVEN_GPG_PASSPHRASE }}</span><span class=w>
</span></span></span></code></pre></div><p>根据上面的 yaml 文件，需要在当前项目的 Settings&ndash;>Secrets&ndash;>Actions 创建以下 Secrets：</p><ul><li><strong>OSSRH_TOKEN</strong></li><li><strong>OSSRH_USERNAME</strong></li><li><strong>MAVEN_GPG_PRIVATE_KEY</strong></li><li><strong>MAVEN_GPG_PASSPHRASE</strong></li></ul><p><strong>MAVEN_GPG_PRIVATE_KEY</strong> 通过如下命令获取：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ gpg --list-keys
</span></span><span class=line><span class=cl><span class=o>[</span>keyboxd<span class=o>]</span>
</span></span><span class=line><span class=cl>---------
</span></span><span class=line><span class=cl>pub   ed25519 2024-05-08 <span class=o>[</span>SC<span class=o>]</span> <span class=o>[</span>有效至：2027-05-08<span class=o>]</span>
</span></span><span class=line><span class=cl>      C83119F1B90238633D766D4B93C5993B9F7B43EE
</span></span><span class=line><span class=cl>uid             <span class=o>[</span> 绝对 <span class=o>]</span> chensoul &lt;ichensoul@gmail.com&gt;
</span></span><span class=line><span class=cl>sub   cv25519 2024-05-08 <span class=o>[</span>E<span class=o>]</span> <span class=o>[</span>有效至：2027-05-08<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ gpg --armor --export-secret-keys C83119F1B90238633D766D4B93C5993B9F7B43EE
</span></span><span class=line><span class=cl>-----BEGIN PGP PRIVATE KEY BLOCK-----
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>lIYEZjrnpBYJKwYBBAHaRw8BAQdAmMtUf7k2poUBYhlca7U7le2vGPEHgAtHZ1MH
</span></span><span class=line><span class=cl>DGOSZR3+BwMCiYrT2G14W736nwBjZvOLsJKjxsSqVN9bRLATEg3veHW/59Jw4DaI
</span></span><span class=line><span class=cl>QN5DX8ier7D2rXM9fkJfYyLg3wNVAcT7dmcQOVM5wkgL1B7EEz3/aLQeY2hlbnNv
</span></span><span class=line><span class=cl>dWwgPGljaGVuc291bEBnbWFpbC5jb20+iJkEExYKAEEWIQTIMRnxuQI4Yz12bUuT
</span></span><span class=line><span class=cl>xZk7n3tD7gUCZjrnpAIbAwUJBaOagAULCQgHAgIiAgYVCgkICwIEFgIDAQIeBwIX
</span></span><span class=line><span class=cl>gAAKCRCTxZk7n3tD7sgGAQCBRsbdVDn1NuVYXOPEAKAFUFWgowb0tkH7w5VzWWD2
</span></span><span class=line><span class=cl>hwD+IHR5JiegnI376upOLiUzQ5cZN8gJ3fn0oau5ELp1lQSciwRmOuekEgorBgEE
</span></span><span class=line><span class=cl>AZdVAQUBAQdAnfkcIuOOyU+ihUX/Z8nU9634MbTG0OHfEZCbm9pgdH4DAQgH/gcD
</span></span><span class=line><span class=cl>AqPKEqB6fGQq+u4+7gYGW2vgkeiTjWJCwVw8VJEwn53+gdQ0q7irfnOOqYNXJbye
</span></span><span class=line><span class=cl>n2NM9IucSZpcVk8gKhJmc8hJR4uNifh0i820vEjyszeIfgQYFgoAJhYhBMgxGfG5
</span></span><span class=line><span class=cl>AjhjPXZtS5PFmTufe0PuBQJmOuekAhsMBQkFo5qAAAoJEJPFmTufe0PubSkA/R6I
</span></span><span class=line><span class=cl>/7+oavy/FP9r6PfV1oI5yiAy7RMue1BuIcbRMoabAPkBBQq/ms9DZ5GA25ZpSuOH
</span></span><span class=line><span class=cl>S3ee7QZPNjtkA2s/eQsPAQ<span class=o>==</span>
</span></span></code></pre></div><h3 id=qcastelgithub-actions-maven-release>qcastel/github-actions-maven-release</h3><p>使用 <a href=https://github.com/qcastel/github-actions-maven-release>qcastel/github-actions-maven-release</a> ，参考使用文档，在项目的 .github/workflows 目录下创建 maven-release.yml文件：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Maven Release</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=s2>&#34;main&#34;</span><span class=w> </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>tags</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=s2>&#34;*&#34;</span><span class=w> </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>release</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>types</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=w> </span><span class=l>created ]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>build</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;!contains(github.event.head_commit.message, &#39;[CI Skip]&#39;)&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Checkout</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Java Maven Release</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>qcastel/github-actions-maven-release@master</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>JAVA_HOME</span><span class=p>:</span><span class=w> </span><span class=l>/usr/lib/jvm/java-1.8-openjdk/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>git-release-bot-name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;release-bot&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>git-release-bot-email</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;release-bot@chensoul.cc&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>release-branch-name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;main&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>maven-args</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;-ntp -B -U -P release&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>maven-servers</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.MVN_REPO_SERVERS }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>ssh-private-key</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.SSH_PRIVATE_KEY }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>gpg-enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>gpg-key-id</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.MAVEN_GPG_ID }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>gpg-key</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.MAVEN_GPG_KEY }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>gpg-passphrase</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.MAVEN_GPG_PASSPHRASE }}</span><span class=w>
</span></span></span></code></pre></div><p>根据上面的 yaml 文件，需要在当前项目的 Settings&ndash;>Secrets&ndash;>Actions 创建以下 Secrets：</p><ul><li><strong>MVN_REPO_SERVERS</strong></li><li><strong>SSH_PRIVATE_KEY</strong></li><li><strong>MAVEN_GPG_ID</strong></li><li><strong>MAVEN_GPG_KEY</strong></li><li><strong>MAVEN_GPG_PASSPHRASE</strong></li></ul><p><strong>MVN_REPO_SERVERS</strong> 如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>
</span></span><span class=line><span class=cl>  <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;id&#34;</span>: <span class=s2>&#34;ossrh&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;username&#34;</span>: <span class=s2>&#34;LSJkOqOi&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;password&#34;</span>: <span class=s2>&#34;3oJOIO5+ah7LIcRSmDC2YDGjE9PRbgxoE2UbXjOrSzC1&#34;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>,
</span></span><span class=line><span class=cl>  <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;id&#34;</span>: <span class=s2>&#34;gpg.passphrase&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;passphrase&#34;</span>: <span class=s2>&#34;chensoul&#34;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>]</span>
</span></span></code></pre></div><p><strong>SSH_PRIVATE_KEY</strong> 通过下面命令获取：</p><p>1、在 docker 容器中生成</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run -it qcastel/maven-release:latest  bash
</span></span></code></pre></div><p>ssh 公钥和秘钥</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ssh-keygen -b <span class=m>2048</span> -t rsa -f ~/.ssh/id_rsa -q -N <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s2>&#34;Copy the following SSH private key and add it to your repo secrets under the name &#39;SSH_PRIVATE_KEY&#39;:&#34;</span>
</span></span><span class=line><span class=cl>base64 ~/.ssh/id_rsa
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s2>&#34; &#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s2>&#34;Copy the encoded SSH public key and add it as one of your repo deploy keys with write access:&#34;</span>
</span></span><span class=line><span class=cl>cat ~/.ssh/id_rsa.pub
</span></span></code></pre></div><p>输出内容如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Copy the following SSH private key and add it to your repo secrets under the name <span class=s1>&#39;SSH_PRIVATE_KEY&#39;</span>:
</span></span><span class=line><span class=cl>LS0tLS1CRUdJTiBPUEVOU1NIIFBSSVZBVEUgS0VZLS0tLS0KYjNCbGJuTnphQzFyWlhrdGRqRUFB QUFBQkc1dmJtVUFBQUFFYm05dVpRQUFBQUFBQUFBQkFBQUJGd0FBQUFkemMyZ3RjbgpOaEFBQUFB d0VBQVFBQUFRRUExQUFBclFpZFNRS25pY3g5VmNaQVdtTlI1ZWY0Q2tSbEJCZTdVdk5QNGNMMlAv eDRReXJpCmdWcGV2Um8wVHE0eUptWFN2L3hnclByNk5CQmk0STlXRmp6Q2l0a3phcTg3OGwyNVdt UUt5cTUyang5TWJ0MmhCZzVrdUsKZ05pRGxvMWNaY1VpZHd4ak9sNzVlVHpWaHpoSGZ4ZnphZTZY N0QybE1jeFUrd2d3MFJHZlpITjUvRUZWQ3JHRUhKdHlGSQpReFd1VDY0c3RNMElrVjA3azBPRlQy SHhYNlB6OUpvRjhRRm9SZmVjU0RUM2tPRk5rTVVicDVTNkkxNWxtTjB0YnNHVGNsClYxWFpwWUkr NHRFWWphN1EwWnlWaVBCVUJnWnBuUlpQNFRmOEIwRzhsVDdqSlNPWDM0YkRFWkFoMVM4bnRCQzc3 aFUyMUIKWGJDZHV6ZlpXUUFBQThoN29jU3VlNkhFcmdBQUFBZHpjMmd0Y25OaEFBQUJBUURVQUFD dENKMUpBcWVKekgxVnhrQmFZMQpIbDUvZ0tSR1VFRjd0UzgwL2h3dlkvL0hoREt1S0JXbDY5R2pS T3JqSW1aZEsvL0dDcyt2bzBFR0xnajFZV1BNS0syVE5xCnJ6dnlYYmxhWkFyS3JuYVBIMHh1M2FF R0RtUzRxQTJJT1dqVnhseFNKM0RHTTZYdmw1UE5XSE9FZC9GL05wN3Bmc1BhVXgKekZUN0NERFJF WjlrYzNuOFFWVUtzWVFjbTNJVWhERmE1UHJpeTB6UWlSWFR1VFE0VlBZZkZmby9QMG1nWHhBV2hG OTV4SQpOUGVRNFUyUXhSdW5sTG9qWG1XWTNTMXV3Wk55VlhWZG1sZ2o3aTBSaU5ydERSbkpXSThG UUdCbW1kRmsvaE4vd0hRYnlWClB1TWxJNWZmaHNNUmtDSFZMeWUwRUx2dUZUYlVGZHNKMjdOOWxa QUFBQUF3RUFBUUFBQVFCSzBqMXExSEYraFJ0UVBRVzMKTWlNZ1E1RnlETzZ6NFBPdUFCb3k2b0Mw OHpRcDNSY3N6WVBubDFkOGNqVW4xNzhIWWtTQlViZGxGYWNjblBQb3dXM21wMApjWjdoS0JncHNy clB4djlJTUNpWlI2YXRkMUFXK0ZUYXNxcU5VdDBPVTVIYXNUcTZ2WHAvN1drcTZ0ZUp3OGtvQi9I MjN5CmhyVGs1eFJ1WnZPckxGcS9vdXBQeXhVS1M0SzRVOG5JYjBnZjVjT3RXeUlWZFdKQ05EdU9R ZW1sdDBRajN3RjZPWkNpcU8KRGxaMFd3MWwrRzJpUWZFLzM2ODR0UXpKemVKeFgybEJaN0tmQStP bEcyZENPeXZwY01Ic1J4TE5ITy85aWpqUmNXWUVtMgp4SDVYQmRkZldlKzBkYkxxZFhoWHJHTnpx QjlSbjBTWGZ1QVRnSzZENjBsSkFBQUFnUUN6VmhONUh1YXVvOExzVVR1dkNRCkNibVhnakhuS1hB NDBqV1pyVmlucEgvbmcxNkNudlE5UmJhb041am1JWURUZEJ3TVp4dXZSck9JUTloeUZnUDVCSHRL dTgKQlhvZ08ybERySDFVRzA4bzN6ZHNhUTJaaGp0aEE5TFlMcXpvYkVtSEpndkwxemJjRVBWMHJC cm1SMXArL0trN3Y5OHd0eQpPT2VnYXVqK0djUXdBQUFJRUE5ZklKc0t2SGdsQVp1eS9sMzJWS3Q4 cTN4UFl4SUlrMVJKczV4bDRJUGFTZ0xsR0pzVFgwCll2bll1THcrb2NCMlVaazRxUUlML3I5bTRt cVhEOTF6bXhxZTNUKzZqOHk0ODBvbS91UWRma3h6MWdNWkljdDlkR2Z3RE8KczRBckNPSkx0TVI4 WG53emxXM1VLZnJhTDFRUFZMVUs3OWpSM29kN2k2VmNWMlpnY0FBQUNCQU55cXRMZk85NUhkU3Mz RwpyMWYvOStVRUJjV0xMSnpHMEl2OEZtd3J6ci9ZbksrbXpmR2dMVHNPeUgwV1pMZkVnYlJkUGxC aVJmTjFXQk1oWHZKRWhaCkp4YTY1N0IxTUExano1eEE2OElCcEJxUlhvNWZ6QmdHNFg0UGVNZkQz dXR5M0NENVR4Y2sxL0c1L2krUXpXNFhlR2RLNkkKaml1OGg5TXo3YkUxZHUyZkFBQUFFWEp2YjNS <span class=nv>QVlqa3dZelJtWWpKbE9HVmxBUT09Ci0tLS0tRU5EIE9QRU5TU0ggUFJJVkFURSBLRVktLS0tLQo</span><span class=o>=</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Copy the encoded SSH public key and add it as one of your repo deploy keys with write access:
</span></span><span class=line><span class=cl>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDUAACtCJ1JAqeJzH1VxkBaY1Hl5/gKRGUEF7tS80/hwvY//HhDKuKBWl69GjROrjImZdK//GCs+vo0EGLgj1YWPMKK2TNqrzvyXblaZArKrnaPH0xu3aEGDmS4qA2IOWjVxlxSJ3DGM6Xvl5PNWHOEd/F/Np7pfsPaUxzFT7CDDREZ9kc3n8QVUKsYQcm3IUhDFa5Priy0zQiRXTuTQ4VPYfFfo/P0mgXxAWhF95xINPeQ4U2QxRunlLojXmWY3S1uwZNyVXVdmlgj7i0RiNrtDRnJWI8FQGBmmdFk/hN/wHQbyVPuMlI5ffhsMRkCHVLye0ELvuFTbUFdsJ27N9lZ root@b90c4fb2e8ee
</span></span></code></pre></div><p>2、或者直接使用本地的 ssh</p><p>macos 系统上执行命令：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s2>&#34;Copy the following SSH private key and add it to your repo secrets under the name &#39;SSH_PRIVATE_KEY&#39;:&#34;</span>
</span></span><span class=line><span class=cl>base64 -i ~/.ssh/id_rsa
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s2>&#34; &#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s2>&#34;Copy the encoded SSH public key and add it as one of your repo deploy keys with write access:&#34;</span>
</span></span><span class=line><span class=cl>cat ~/.ssh/id_rsa.pub
</span></span></code></pre></div><p>将私钥粘贴到 Secrets 中 <strong>SSH_PRIVATE_KEY</strong> 的值内，将公钥添加到你的 github 账号的 <a href=https://github.com/settings/ssh/new>SSH keys</a> 中。</p><p>获取 <strong>MAVEN_GPG_ID</strong>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ gpg --list-secret-keys --keyid-format LONG
</span></span><span class=line><span class=cl><span class=o>[</span>keyboxd<span class=o>]</span>
</span></span><span class=line><span class=cl>---------
</span></span><span class=line><span class=cl>sec   ed25519/93C5993B9F7B43EE 2024-05-08 <span class=o>[</span>SC<span class=o>]</span> <span class=o>[</span>有效至：2027-05-08<span class=o>]</span>
</span></span><span class=line><span class=cl>      C83119F1B90238633D766D4B93C5993B9F7B43EE
</span></span><span class=line><span class=cl>uid                   <span class=o>[</span> 绝对 <span class=o>]</span> chensoul &lt;ichensoul@gmail.com&gt;
</span></span><span class=line><span class=cl>ssb   cv25519/116B95FF0068A7E8 2024-05-08 <span class=o>[</span>E<span class=o>]</span> <span class=o>[</span>有效至：2027-05-08<span class=o>]</span>
</span></span></code></pre></div><blockquote><p>这里 <strong>MAVEN_GPG_ID</strong> 对应 93C5993B9F7B43EE</p></blockquote><p>获取 <strong>MAVEN_GPG_KEY</strong>，运行下面命令，输入密码，即 <strong>MAVEN_GPG_PASSPHRASE</strong> 对应的内容</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=s1>&#39;Public key to add in your bot github account:&#39;</span>
</span></span><span class=line><span class=cl>gpg --armor --export 93C5993B9F7B43EE
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s1>&#39;Private key to add to the CI secrets under GITHUB_GPG_KEY:&#39;</span>
</span></span><span class=line><span class=cl>gpg --export-secret-keys --armor 93C5993B9F7B43EE <span class=p>|</span> base64
</span></span></code></pre></div><p>输出内容：</p><p>公钥：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>-----BEGIN PGP PUBLIC KEY BLOCK-----
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>mDMEZjrnpBYJKwYBBAHaRw8BAQdAmMtUf7k2poUBYhlca7U7le2vGPEHgAtHZ1MH
</span></span><span class=line><span class=cl>DGOSZR20HmNoZW5zb3VsIDxpY2hlbnNvdWxAZ21haWwuY29tPoiZBBMWCgBBFiEE
</span></span><span class=line><span class=cl>yDEZ8bkCOGM9dm1Lk8WZO597Q+4FAmY656QCGwMFCQWjmoAFCwkIBwICIgIGFQoJ
</span></span><span class=line><span class=cl>CAsCBBYCAwECHgcCF4AACgkQk8WZO597Q+7IBgEAgUbG3VQ59TblWFzjxACgBVBV
</span></span><span class=line><span class=cl>oKMG9LZB+8OVc1lg9ocA/iB0eSYnoJyN++rqTi4lM0OXGTfICd359KGruRC6dZUE
</span></span><span class=line><span class=cl>uDgEZjrnpBIKKwYBBAGXVQEFAQEHQJ35HCLjjslPooVF/2fJ1Pet+DG0xtDh3xGQ
</span></span><span class=line><span class=cl>m5vaYHR+AwEIB4h+BBgWCgAmFiEEyDEZ8bkCOGM9dm1Lk8WZO597Q+4FAmY656QC
</span></span><span class=line><span class=cl>GwwFCQWjmoAACgkQk8WZO597Q+5tKQD9Hoj/v6hq/L8U/2vo99XWgjnKIDLtEy57
</span></span><span class=line><span class=cl>UG4hxtEyhpsA+QEFCr+az0NnkYDblmlK44dLd57tBk82O2QDaz95Cw8B
</span></span><span class=line><span class=cl><span class=o>=</span>YFZg
</span></span><span class=line><span class=cl>-----END PGP PUBLIC KEY BLOCK-----
</span></span></code></pre></div><p>私钥：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>LS0tLS1CRUdJTiBQR1AgUFJJVkFURSBLRVkgQkxPQ0stLS0tLQoKbElZRVpqcm5wQllKS3dZQkJBSGFSdzhCQVFkQW1NdFVmN2sycG9VQllobGNhN1U3bGUydkdQRUhnQXRIWjFNSApER09TWlIzK0J3TUNwOTJOaVVIQnU0VDZ3UHRFSWt1cGtTM2M0c21WOWZUUXRtRDM3bTJuOTlzbnRWNmllYU8vCi9TKzUvR2FyWDNMTUhoTmtkdnVpOHZSMk1hNDNhNFdzVmFpR1RiZWF6eHNHbVE1TGo4ZXUvTFFlWTJobGJuTnYKZFd3Z1BHbGphR1Z1YzI5MWJFQm5iV0ZwYkM1amIyMCtpSmtFRXhZS0FFRVdJUVRJTVJueHVRSTRZejEyYlV1VAp4Wms3bjN0RDdnVUNaanJucEFJYkF3VUpCYU9hZ0FVTENRZ0hBZ0lpQWdZVkNna0lDd0lFRmdJREFRSWVCd0lYCmdBQUtDUkNUeFprN24zdEQ3c2dHQVFDQlJzYmRWRG4xTnVWWVhPUEVBS0FGVUZXZ293YjB0a0g3dzVWeldXRDIKaHdEK0lIUjVKaWVnbkkzNzZ1cE9MaVV6UTVjWk44Z0ozZm4wb2F1NUVMcDFsUVNjaXdSbU91ZWtFZ29yQmdFRQpBWmRWQVFVQkFRZEFuZmtjSXVPT3lVK2loVVgvWjhuVTk2MzRNYlRHME9IZkVaQ2JtOXBnZEg0REFRZ0gvZ2NECkFtYllUMStNNjB6bStna1lyMk54Yys1U3hqYmd6bTA1ajFURW42TnUwVTUyUmRoMzJvTVRYU2ZIa2RlakdiVmkKMDNKemRkVnZ6Kzl6U2FzQVpMMVA1ZytBa0dGbTBHYVFLTldnOUVRQzVBK0lmZ1FZRmdvQUpoWWhCTWd4R2ZHNQpBamhqUFhadFM1UEZtVHVmZTBQdUJRSm1PdWVrQWhzTUJRa0ZvNXFBQUFvSkVKUEZtVHVmZTBQdWJTa0EvUjZJCi83K29hdnkvRlA5cjZQZl
</span></span></code></pre></div><p>将上面输出私钥的内容添加到 Secrets 中 <strong>MAVEN_GPG_KEY</strong> 的值里面，将公钥内容添加到你的 github 账号的 <a href=https://github.com/settings/gpg/new>GPG keys</a> 中。</p><p>修改代码，提交到 github，会触发一个 github action ，查看日志，可以看到：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Not using access token authentication, as no access token <span class=o>(</span>via env GITREPO_ACCESS_TOKEN<span class=o>)</span> defined or because an SSH key is defined and setup <span class=o>(</span>via env SSH_PRIVATE_KEY<span class=o>)</span>
</span></span><span class=line><span class=cl>Do mvn release:prepare with options  -DdevelopmentVersion<span class=o>=</span><span class=si>${</span><span class=nv>parsedVersion</span><span class=p>.majorVersion</span><span class=si>}</span>.<span class=si>${</span><span class=nv>parsedVersion</span><span class=p>.minorVersion</span><span class=si>}</span>.<span class=si>${</span><span class=nv>parsedVersion</span><span class=p>.nextIncrementalVersion</span><span class=si>}</span>-SNAPSHOT and arguments -ntp -B -U -P release
</span></span></code></pre></div><p>从日志可以看到，qcastel/github-actions-maven-release 使用了 maven 的 maven-release-plugin 插件，会发布正式版的 jar 到 maven 中央仓库。为了 避免在开发阶段每次提交都发布一个正式版本到中央仓库，可以修改 release-branch-name 为 release 分支，即限定提交到指定分支时候，从触发 maven 发布。</p><p>可以添加下面参数，跳过 release:perform ，即不会发布 jar 到 maven 中央仓库，<strong>但是 maven-release-plugin 插件还是会修改项目的版本，并创建 tag。</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>with:
</span></span><span class=line><span class=cl>    skip-perform: <span class=nb>true</span>
</span></span></code></pre></div><p>创建的 tag 名称格式为：项目名称-版本</p><p></p><p>tag 名称格式可以在 maven-release-plugin 插件中配置：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;plugin&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;groupId&gt;</span>org.apache.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;artifactId&gt;</span>maven-release-plugin<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;version&gt;</span>${maven-release-plugin.version}<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;configuration&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;scmCommentPrefix&gt;</span>[CI Skip]<span class=nt>&lt;/scmCommentPrefix&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;autoVersionSubmodules&gt;</span>true<span class=nt>&lt;/autoVersionSubmodules&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;useReleaseProfile&gt;</span>false<span class=nt>&lt;/useReleaseProfile&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;releaseProfiles&gt;</span>release<span class=nt>&lt;/releaseProfiles&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;tagNameFormat&gt;</span>v@{version}<span class=nt>&lt;/tagNameFormat&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;goals&gt;</span>deploy<span class=nt>&lt;/goals&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nt>&lt;/configuration&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/plugin&gt;</span>
</span></span></code></pre></div><h2 id=总结>总结</h2><p>如果使用 <a href=https://github.com/qcastel/github-actions-maven-release>qcastel/github-actions-maven-release</a> ，maven-release-plugin 插件会修改版本，并且创建 tag ，但是并不会创建 github release。</p><p>使用 <a href=https://github.com/release-drafter/release-drafter>https://github.com/release-drafter/release-drafter</a> 这个 actions 可以更加 pull request 自动创建 github releae，基于此，更倾向于使用 <a href=https://github.com/actions/setup-java>actions/setup-java</a> 来发布 jar 到 Maven 仓库。</p></div><footer class=post-footer><nav class=paginav><a class=next href=https://blog.chensoul.cc/posts/2024/07/24/jms20-means-less-code/><span class=title>Next Page&nbsp;<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span><br><span>[译]JMS 2.0 的十个好处意味着可以减少代码编写量</span></a></nav></footer><div class=comments-separator></div></article></main><footer class=footer><span>&copy; 2024 <a href=https://blog.chensoul.cc/>ChenSoul</a></span><span style=display:inline-block;margin-left:1em>
<a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA</a>
</span><span style=display:inline-block;margin-left:1em>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
    <a href=https://github.com/reorx/hugo-PaperModX/ rel=noopener target=_blank>PaperModX</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script async src=https://umami.chensoul.cc/random-string.js data-website-id=821c25f8-a31a-4607-92d7-91ee76843d00></script><script>(function(){const t=""=="1";if(t)return;let e=document.getElementById("theme-toggle");e.removeEventListener("click",toggleThemeListener),e.addEventListener("click",toggleThemeListener)})()</script><script>(function(){let e=document.getElementById("menu");e&&(e.scrollLeft=localStorage.getItem("menu-scroll-position"),e.onscroll=function(){localStorage.setItem("menu-scroll-position",e.scrollLeft)});const t=""=="1",n="1"=="1";if(window.matchMedia("(prefers-reduced-motion: reduce)").matches||t||n)return;document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})})()</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>if(window.scrollListeners)for(const e of scrollListeners)window.removeEventListener("scroll",e);window.scrollListeners=[]</script><script src=/js/medium-zoom.min.js data-no-instant></script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script>(function(){const a="1"=="1";if(!a)return;if(!document.querySelector(".toc")){console.log("no toc found, ignore toc scroll");return}const r=window.scrollListeners,t=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id]"),n="active";let e=t[0];o(e).classList.add(n);const c=()=>{const s=[];for(const e of t)if(l(e)<5)s.push(e);else break;s.length>0?newActiveHeading=s[s.length-1]:newActiveHeading=t[0],e!=newActiveHeading&&(o(e).classList.remove(n),e=newActiveHeading,o(e).classList.add(n))};let s=null;const i=()=>{s!==null&&clearTimeout(s),s=setTimeout(c,50)};window.addEventListener("scroll",i,!1),r.push(i);function o(e){const t=encodeURI(e.getAttribute("id")).toLowerCase();return document.querySelector(`.toc ul li a[href="#${t}"]`)}function l(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect();return t.top}})()</script><script>mediumZoom(".entry-cover img"),mediumZoom(".post-content img:not([no-zoom])")</script><script src=/js/instantclick.min.js data-no-instant></script><script data-no-instant>InstantClick.init()</script></body></html>